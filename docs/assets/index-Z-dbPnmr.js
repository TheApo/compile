(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))i(l);new MutationObserver(l=>{for(const c of l)if(c.type==="childList")for(const s of c.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function a(l){const c={};return l.integrity&&(c.integrity=l.integrity),l.referrerPolicy&&(c.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?c.credentials="include":l.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function i(l){if(l.ep)return;l.ep=!0;const c=a(l);fetch(l.href,c)}})();function om(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Yi={exports:{}},Xr={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var nh;function am(){if(nh)return Xr;nh=1;var t=Symbol.for("react.transitional.element"),o=Symbol.for("react.fragment");function a(i,l,c){var s=null;if(c!==void 0&&(s=""+c),l.key!==void 0&&(s=""+l.key),"key"in l){c={};for(var f in l)f!=="key"&&(c[f]=l[f])}else c=l;return l=c.ref,{$$typeof:t,type:i,key:s,ref:l!==void 0?l:null,props:c}}return Xr.Fragment=o,Xr.jsx=a,Xr.jsxs=a,Xr}var oh;function rm(){return oh||(oh=1,Yi.exports=am()),Yi.exports}var u=rm(),Wi={exports:{}},Zr={},Qi={exports:{}},Xi={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ah;function lm(){return ah||(ah=1,(function(t){function o(F,B){var W=F.length;F.push(B);e:for(;0<W;){var _e=W-1>>>1,U=F[_e];if(0<l(U,B))F[_e]=B,F[W]=U,W=_e;else break e}}function a(F){return F.length===0?null:F[0]}function i(F){if(F.length===0)return null;var B=F[0],W=F.pop();if(W!==B){F[0]=W;e:for(var _e=0,U=F.length,P=U>>>1;_e<P;){var Z=2*(_e+1)-1,Q=F[Z],pe=Z+1,Ce=F[pe];if(0>l(Q,W))pe<U&&0>l(Ce,Q)?(F[_e]=Ce,F[pe]=W,_e=pe):(F[_e]=Q,F[Z]=W,_e=Z);else if(pe<U&&0>l(Ce,W))F[_e]=Ce,F[pe]=W,_e=pe;else break e}}return B}function l(F,B){var W=F.sortIndex-B.sortIndex;return W!==0?W:F.id-B.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var c=performance;t.unstable_now=function(){return c.now()}}else{var s=Date,f=s.now();t.unstable_now=function(){return s.now()-f}}var p=[],h=[],y=1,g=null,v=3,w=!1,C=!1,x=!1,b=!1,E=typeof setTimeout=="function"?setTimeout:null,S=typeof clearTimeout=="function"?clearTimeout:null,j=typeof setImmediate<"u"?setImmediate:null;function R(F){for(var B=a(h);B!==null;){if(B.callback===null)i(h);else if(B.startTime<=F)i(h),B.sortIndex=B.expirationTime,o(p,B);else break;B=a(h)}}function A(F){if(x=!1,R(F),!C)if(a(p)!==null)C=!0,N||(N=!0,H());else{var B=a(h);B!==null&&z(A,B.startTime-F)}}var N=!1,I=-1,V=5,L=-1;function D(){return b?!0:!(t.unstable_now()-L<V)}function O(){if(b=!1,N){var F=t.unstable_now();L=F;var B=!0;try{e:{C=!1,x&&(x=!1,S(I),I=-1),w=!0;var W=v;try{t:{for(R(F),g=a(p);g!==null&&!(g.expirationTime>F&&D());){var _e=g.callback;if(typeof _e=="function"){g.callback=null,v=g.priorityLevel;var U=_e(g.expirationTime<=F);if(F=t.unstable_now(),typeof U=="function"){g.callback=U,R(F),B=!0;break t}g===a(p)&&i(p),R(F)}else i(p);g=a(p)}if(g!==null)B=!0;else{var P=a(h);P!==null&&z(A,P.startTime-F),B=!1}}break e}finally{g=null,v=W,w=!1}B=void 0}}finally{B?H():N=!1}}}var H;if(typeof j=="function")H=function(){j(O)};else if(typeof MessageChannel<"u"){var te=new MessageChannel,ne=te.port2;te.port1.onmessage=O,H=function(){ne.postMessage(null)}}else H=function(){E(O,0)};function z(F,B){I=E(function(){F(t.unstable_now())},B)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(F){F.callback=null},t.unstable_forceFrameRate=function(F){0>F||125<F?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):V=0<F?Math.floor(1e3/F):5},t.unstable_getCurrentPriorityLevel=function(){return v},t.unstable_next=function(F){switch(v){case 1:case 2:case 3:var B=3;break;default:B=v}var W=v;v=B;try{return F()}finally{v=W}},t.unstable_requestPaint=function(){b=!0},t.unstable_runWithPriority=function(F,B){switch(F){case 1:case 2:case 3:case 4:case 5:break;default:F=3}var W=v;v=F;try{return B()}finally{v=W}},t.unstable_scheduleCallback=function(F,B,W){var _e=t.unstable_now();switch(typeof W=="object"&&W!==null?(W=W.delay,W=typeof W=="number"&&0<W?_e+W:_e):W=_e,F){case 1:var U=-1;break;case 2:U=250;break;case 5:U=1073741823;break;case 4:U=1e4;break;default:U=5e3}return U=W+U,F={id:y++,callback:B,priorityLevel:F,startTime:W,expirationTime:U,sortIndex:-1},W>_e?(F.sortIndex=W,o(h,F),a(p)===null&&F===a(h)&&(x?(S(I),I=-1):x=!0,z(A,W-_e))):(F.sortIndex=U,o(p,F),C||w||(C=!0,N||(N=!0,H()))),F},t.unstable_shouldYield=D,t.unstable_wrapCallback=function(F){var B=v;return function(){var W=v;v=B;try{return F.apply(this,arguments)}finally{v=W}}}})(Xi)),Xi}var rh;function cm(){return rh||(rh=1,Qi.exports=lm()),Qi.exports}var Zi={exports:{}},Pe={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var lh;function sm(){if(lh)return Pe;lh=1;var t=Symbol.for("react.transitional.element"),o=Symbol.for("react.portal"),a=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),l=Symbol.for("react.profiler"),c=Symbol.for("react.consumer"),s=Symbol.for("react.context"),f=Symbol.for("react.forward_ref"),p=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),y=Symbol.for("react.lazy"),g=Symbol.iterator;function v(U){return U===null||typeof U!="object"?null:(U=g&&U[g]||U["@@iterator"],typeof U=="function"?U:null)}var w={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},C=Object.assign,x={};function b(U,P,Z){this.props=U,this.context=P,this.refs=x,this.updater=Z||w}b.prototype.isReactComponent={},b.prototype.setState=function(U,P){if(typeof U!="object"&&typeof U!="function"&&U!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,U,P,"setState")},b.prototype.forceUpdate=function(U){this.updater.enqueueForceUpdate(this,U,"forceUpdate")};function E(){}E.prototype=b.prototype;function S(U,P,Z){this.props=U,this.context=P,this.refs=x,this.updater=Z||w}var j=S.prototype=new E;j.constructor=S,C(j,b.prototype),j.isPureReactComponent=!0;var R=Array.isArray,A={H:null,A:null,T:null,S:null,V:null},N=Object.prototype.hasOwnProperty;function I(U,P,Z,Q,pe,Ce){return Z=Ce.ref,{$$typeof:t,type:U,key:P,ref:Z!==void 0?Z:null,props:Ce}}function V(U,P){return I(U.type,P,void 0,void 0,void 0,U.props)}function L(U){return typeof U=="object"&&U!==null&&U.$$typeof===t}function D(U){var P={"=":"=0",":":"=2"};return"$"+U.replace(/[=:]/g,function(Z){return P[Z]})}var O=/\/+/g;function H(U,P){return typeof U=="object"&&U!==null&&U.key!=null?D(""+U.key):P.toString(36)}function te(){}function ne(U){switch(U.status){case"fulfilled":return U.value;case"rejected":throw U.reason;default:switch(typeof U.status=="string"?U.then(te,te):(U.status="pending",U.then(function(P){U.status==="pending"&&(U.status="fulfilled",U.value=P)},function(P){U.status==="pending"&&(U.status="rejected",U.reason=P)})),U.status){case"fulfilled":return U.value;case"rejected":throw U.reason}}throw U}function z(U,P,Z,Q,pe){var Ce=typeof U;(Ce==="undefined"||Ce==="boolean")&&(U=null);var ve=!1;if(U===null)ve=!0;else switch(Ce){case"bigint":case"string":case"number":ve=!0;break;case"object":switch(U.$$typeof){case t:case o:ve=!0;break;case y:return ve=U._init,z(ve(U._payload),P,Z,Q,pe)}}if(ve)return pe=pe(U),ve=Q===""?"."+H(U,0):Q,R(pe)?(Z="",ve!=null&&(Z=ve.replace(O,"$&/")+"/"),z(pe,P,Z,"",function(de){return de})):pe!=null&&(L(pe)&&(pe=V(pe,Z+(pe.key==null||U&&U.key===pe.key?"":(""+pe.key).replace(O,"$&/")+"/")+ve)),P.push(pe)),1;ve=0;var ke=Q===""?".":Q+":";if(R(U))for(var Xe=0;Xe<U.length;Xe++)Q=U[Xe],Ce=ke+H(Q,Xe),ve+=z(Q,P,Z,Ce,pe);else if(Xe=v(U),typeof Xe=="function")for(U=Xe.call(U),Xe=0;!(Q=U.next()).done;)Q=Q.value,Ce=ke+H(Q,Xe++),ve+=z(Q,P,Z,Ce,pe);else if(Ce==="object"){if(typeof U.then=="function")return z(ne(U),P,Z,Q,pe);throw P=String(U),Error("Objects are not valid as a React child (found: "+(P==="[object Object]"?"object with keys {"+Object.keys(U).join(", ")+"}":P)+"). If you meant to render a collection of children, use an array instead.")}return ve}function F(U,P,Z){if(U==null)return U;var Q=[],pe=0;return z(U,Q,"","",function(Ce){return P.call(Z,Ce,pe++)}),Q}function B(U){if(U._status===-1){var P=U._result;P=P(),P.then(function(Z){(U._status===0||U._status===-1)&&(U._status=1,U._result=Z)},function(Z){(U._status===0||U._status===-1)&&(U._status=2,U._result=Z)}),U._status===-1&&(U._status=0,U._result=P)}if(U._status===1)return U._result.default;throw U._result}var W=typeof reportError=="function"?reportError:function(U){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var P=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof U=="object"&&U!==null&&typeof U.message=="string"?String(U.message):String(U),error:U});if(!window.dispatchEvent(P))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",U);return}console.error(U)};function _e(){}return Pe.Children={map:F,forEach:function(U,P,Z){F(U,function(){P.apply(this,arguments)},Z)},count:function(U){var P=0;return F(U,function(){P++}),P},toArray:function(U){return F(U,function(P){return P})||[]},only:function(U){if(!L(U))throw Error("React.Children.only expected to receive a single React element child.");return U}},Pe.Component=b,Pe.Fragment=a,Pe.Profiler=l,Pe.PureComponent=S,Pe.StrictMode=i,Pe.Suspense=p,Pe.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=A,Pe.__COMPILER_RUNTIME={__proto__:null,c:function(U){return A.H.useMemoCache(U)}},Pe.cache=function(U){return function(){return U.apply(null,arguments)}},Pe.cloneElement=function(U,P,Z){if(U==null)throw Error("The argument must be a React element, but you passed "+U+".");var Q=C({},U.props),pe=U.key,Ce=void 0;if(P!=null)for(ve in P.ref!==void 0&&(Ce=void 0),P.key!==void 0&&(pe=""+P.key),P)!N.call(P,ve)||ve==="key"||ve==="__self"||ve==="__source"||ve==="ref"&&P.ref===void 0||(Q[ve]=P[ve]);var ve=arguments.length-2;if(ve===1)Q.children=Z;else if(1<ve){for(var ke=Array(ve),Xe=0;Xe<ve;Xe++)ke[Xe]=arguments[Xe+2];Q.children=ke}return I(U.type,pe,void 0,void 0,Ce,Q)},Pe.createContext=function(U){return U={$$typeof:s,_currentValue:U,_currentValue2:U,_threadCount:0,Provider:null,Consumer:null},U.Provider=U,U.Consumer={$$typeof:c,_context:U},U},Pe.createElement=function(U,P,Z){var Q,pe={},Ce=null;if(P!=null)for(Q in P.key!==void 0&&(Ce=""+P.key),P)N.call(P,Q)&&Q!=="key"&&Q!=="__self"&&Q!=="__source"&&(pe[Q]=P[Q]);var ve=arguments.length-2;if(ve===1)pe.children=Z;else if(1<ve){for(var ke=Array(ve),Xe=0;Xe<ve;Xe++)ke[Xe]=arguments[Xe+2];pe.children=ke}if(U&&U.defaultProps)for(Q in ve=U.defaultProps,ve)pe[Q]===void 0&&(pe[Q]=ve[Q]);return I(U,Ce,void 0,void 0,null,pe)},Pe.createRef=function(){return{current:null}},Pe.forwardRef=function(U){return{$$typeof:f,render:U}},Pe.isValidElement=L,Pe.lazy=function(U){return{$$typeof:y,_payload:{_status:-1,_result:U},_init:B}},Pe.memo=function(U,P){return{$$typeof:h,type:U,compare:P===void 0?null:P}},Pe.startTransition=function(U){var P=A.T,Z={};A.T=Z;try{var Q=U(),pe=A.S;pe!==null&&pe(Z,Q),typeof Q=="object"&&Q!==null&&typeof Q.then=="function"&&Q.then(_e,W)}catch(Ce){W(Ce)}finally{A.T=P}},Pe.unstable_useCacheRefresh=function(){return A.H.useCacheRefresh()},Pe.use=function(U){return A.H.use(U)},Pe.useActionState=function(U,P,Z){return A.H.useActionState(U,P,Z)},Pe.useCallback=function(U,P){return A.H.useCallback(U,P)},Pe.useContext=function(U){return A.H.useContext(U)},Pe.useDebugValue=function(){},Pe.useDeferredValue=function(U,P){return A.H.useDeferredValue(U,P)},Pe.useEffect=function(U,P,Z){var Q=A.H;if(typeof Z=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return Q.useEffect(U,P)},Pe.useId=function(){return A.H.useId()},Pe.useImperativeHandle=function(U,P,Z){return A.H.useImperativeHandle(U,P,Z)},Pe.useInsertionEffect=function(U,P){return A.H.useInsertionEffect(U,P)},Pe.useLayoutEffect=function(U,P){return A.H.useLayoutEffect(U,P)},Pe.useMemo=function(U,P){return A.H.useMemo(U,P)},Pe.useOptimistic=function(U,P){return A.H.useOptimistic(U,P)},Pe.useReducer=function(U,P,Z){return A.H.useReducer(U,P,Z)},Pe.useRef=function(U){return A.H.useRef(U)},Pe.useState=function(U){return A.H.useState(U)},Pe.useSyncExternalStore=function(U,P,Z){return A.H.useSyncExternalStore(U,P,Z)},Pe.useTransition=function(){return A.H.useTransition()},Pe.version="19.1.1",Pe}var ch;function yd(){return ch||(ch=1,Zi.exports=sm()),Zi.exports}var Ki={exports:{}},cn={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var sh;function im(){if(sh)return cn;sh=1;var t=yd();function o(p){var h="https://react.dev/errors/"+p;if(1<arguments.length){h+="?args[]="+encodeURIComponent(arguments[1]);for(var y=2;y<arguments.length;y++)h+="&args[]="+encodeURIComponent(arguments[y])}return"Minified React error #"+p+"; visit "+h+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function a(){}var i={d:{f:a,r:function(){throw Error(o(522))},D:a,C:a,L:a,m:a,X:a,S:a,M:a},p:0,findDOMNode:null},l=Symbol.for("react.portal");function c(p,h,y){var g=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:l,key:g==null?null:""+g,children:p,containerInfo:h,implementation:y}}var s=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function f(p,h){if(p==="font")return"";if(typeof h=="string")return h==="use-credentials"?h:""}return cn.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=i,cn.createPortal=function(p,h){var y=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11)throw Error(o(299));return c(p,h,null,y)},cn.flushSync=function(p){var h=s.T,y=i.p;try{if(s.T=null,i.p=2,p)return p()}finally{s.T=h,i.p=y,i.d.f()}},cn.preconnect=function(p,h){typeof p=="string"&&(h?(h=h.crossOrigin,h=typeof h=="string"?h==="use-credentials"?h:"":void 0):h=null,i.d.C(p,h))},cn.prefetchDNS=function(p){typeof p=="string"&&i.d.D(p)},cn.preinit=function(p,h){if(typeof p=="string"&&h&&typeof h.as=="string"){var y=h.as,g=f(y,h.crossOrigin),v=typeof h.integrity=="string"?h.integrity:void 0,w=typeof h.fetchPriority=="string"?h.fetchPriority:void 0;y==="style"?i.d.S(p,typeof h.precedence=="string"?h.precedence:void 0,{crossOrigin:g,integrity:v,fetchPriority:w}):y==="script"&&i.d.X(p,{crossOrigin:g,integrity:v,fetchPriority:w,nonce:typeof h.nonce=="string"?h.nonce:void 0})}},cn.preinitModule=function(p,h){if(typeof p=="string")if(typeof h=="object"&&h!==null){if(h.as==null||h.as==="script"){var y=f(h.as,h.crossOrigin);i.d.M(p,{crossOrigin:y,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0})}}else h==null&&i.d.M(p)},cn.preload=function(p,h){if(typeof p=="string"&&typeof h=="object"&&h!==null&&typeof h.as=="string"){var y=h.as,g=f(y,h.crossOrigin);i.d.L(p,y,{crossOrigin:g,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0,type:typeof h.type=="string"?h.type:void 0,fetchPriority:typeof h.fetchPriority=="string"?h.fetchPriority:void 0,referrerPolicy:typeof h.referrerPolicy=="string"?h.referrerPolicy:void 0,imageSrcSet:typeof h.imageSrcSet=="string"?h.imageSrcSet:void 0,imageSizes:typeof h.imageSizes=="string"?h.imageSizes:void 0,media:typeof h.media=="string"?h.media:void 0})}},cn.preloadModule=function(p,h){if(typeof p=="string")if(h){var y=f(h.as,h.crossOrigin);i.d.m(p,{as:typeof h.as=="string"&&h.as!=="script"?h.as:void 0,crossOrigin:y,integrity:typeof h.integrity=="string"?h.integrity:void 0})}else i.d.m(p)},cn.requestFormReset=function(p){i.d.r(p)},cn.unstable_batchedUpdates=function(p,h){return p(h)},cn.useFormState=function(p,h,y){return s.H.useFormState(p,h,y)},cn.useFormStatus=function(){return s.H.useHostTransitionStatus()},cn.version="19.1.1",cn}var ih;function dm(){if(ih)return Ki.exports;ih=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(o){console.error(o)}}return t(),Ki.exports=im(),Ki.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var dh;function um(){if(dh)return Zr;dh=1;var t=cm(),o=yd(),a=dm();function i(e){var n="https://react.dev/errors/"+e;if(1<arguments.length){n+="?args[]="+encodeURIComponent(arguments[1]);for(var r=2;r<arguments.length;r++)n+="&args[]="+encodeURIComponent(arguments[r])}return"Minified React error #"+e+"; visit "+n+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function l(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function c(e){var n=e,r=e;if(e.alternate)for(;n.return;)n=n.return;else{e=n;do n=e,(n.flags&4098)!==0&&(r=n.return),e=n.return;while(e)}return n.tag===3?r:null}function s(e){if(e.tag===13){var n=e.memoizedState;if(n===null&&(e=e.alternate,e!==null&&(n=e.memoizedState)),n!==null)return n.dehydrated}return null}function f(e){if(c(e)!==e)throw Error(i(188))}function p(e){var n=e.alternate;if(!n){if(n=c(e),n===null)throw Error(i(188));return n!==e?null:e}for(var r=e,d=n;;){var _=r.return;if(_===null)break;var m=_.alternate;if(m===null){if(d=_.return,d!==null){r=d;continue}break}if(_.child===m.child){for(m=_.child;m;){if(m===r)return f(_),e;if(m===d)return f(_),n;m=m.sibling}throw Error(i(188))}if(r.return!==d.return)r=_,d=m;else{for(var k=!1,q=_.child;q;){if(q===r){k=!0,r=_,d=m;break}if(q===d){k=!0,d=_,r=m;break}q=q.sibling}if(!k){for(q=m.child;q;){if(q===r){k=!0,r=m,d=_;break}if(q===d){k=!0,d=m,r=_;break}q=q.sibling}if(!k)throw Error(i(189))}}if(r.alternate!==d)throw Error(i(190))}if(r.tag!==3)throw Error(i(188));return r.stateNode.current===r?e:n}function h(e){var n=e.tag;if(n===5||n===26||n===27||n===6)return e;for(e=e.child;e!==null;){if(n=h(e),n!==null)return n;e=e.sibling}return null}var y=Object.assign,g=Symbol.for("react.element"),v=Symbol.for("react.transitional.element"),w=Symbol.for("react.portal"),C=Symbol.for("react.fragment"),x=Symbol.for("react.strict_mode"),b=Symbol.for("react.profiler"),E=Symbol.for("react.provider"),S=Symbol.for("react.consumer"),j=Symbol.for("react.context"),R=Symbol.for("react.forward_ref"),A=Symbol.for("react.suspense"),N=Symbol.for("react.suspense_list"),I=Symbol.for("react.memo"),V=Symbol.for("react.lazy"),L=Symbol.for("react.activity"),D=Symbol.for("react.memo_cache_sentinel"),O=Symbol.iterator;function H(e){return e===null||typeof e!="object"?null:(e=O&&e[O]||e["@@iterator"],typeof e=="function"?e:null)}var te=Symbol.for("react.client.reference");function ne(e){if(e==null)return null;if(typeof e=="function")return e.$$typeof===te?null:e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case C:return"Fragment";case b:return"Profiler";case x:return"StrictMode";case A:return"Suspense";case N:return"SuspenseList";case L:return"Activity"}if(typeof e=="object")switch(e.$$typeof){case w:return"Portal";case j:return(e.displayName||"Context")+".Provider";case S:return(e._context.displayName||"Context")+".Consumer";case R:var n=e.render;return e=e.displayName,e||(e=n.displayName||n.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case I:return n=e.displayName||null,n!==null?n:ne(e.type)||"Memo";case V:n=e._payload,e=e._init;try{return ne(e(n))}catch{}}return null}var z=Array.isArray,F=o.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,B=a.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,W={pending:!1,data:null,method:null,action:null},_e=[],U=-1;function P(e){return{current:e}}function Z(e){0>U||(e.current=_e[U],_e[U]=null,U--)}function Q(e,n){U++,_e[U]=e.current,e.current=n}var pe=P(null),Ce=P(null),ve=P(null),ke=P(null);function Xe(e,n){switch(Q(ve,n),Q(Ce,e),Q(pe,null),n.nodeType){case 9:case 11:e=(e=n.documentElement)&&(e=e.namespaceURI)?Df(e):0;break;default:if(e=n.tagName,n=n.namespaceURI)n=Df(n),e=Tf(n,e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}Z(pe),Q(pe,e)}function de(){Z(pe),Z(Ce),Z(ve)}function ce(e){e.memoizedState!==null&&Q(ke,e);var n=pe.current,r=Tf(n,e.type);n!==r&&(Q(Ce,e),Q(pe,r))}function le(e){Ce.current===e&&(Z(pe),Z(Ce)),ke.current===e&&(Z(ke),zr._currentValue=W)}var re=Object.prototype.hasOwnProperty,se=t.unstable_scheduleCallback,ge=t.unstable_cancelCallback,me=t.unstable_shouldYield,Se=t.unstable_requestPaint,$e=t.unstable_now,xe=t.unstable_getCurrentPriorityLevel,at=t.unstable_ImmediatePriority,nt=t.unstable_UserBlockingPriority,Ke=t.unstable_NormalPriority,Rt=t.unstable_LowPriority,De=t.unstable_IdlePriority,gt=t.log,Ot=t.unstable_setDisableYieldValue,an=null,yt=null;function dt(e){if(typeof gt=="function"&&Ot(e),yt&&typeof yt.setStrictMode=="function")try{yt.setStrictMode(an,e)}catch{}}var Nt=Math.clz32?Math.clz32:je,fa=Math.log,ye=Math.LN2;function je(e){return e>>>=0,e===0?32:31-(fa(e)/ye|0)|0}var Ve=256,Te=4194304;function Ne(e){var n=e&42;if(n!==0)return n;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return e&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function xt(e,n,r){var d=e.pendingLanes;if(d===0)return 0;var _=0,m=e.suspendedLanes,k=e.pingedLanes;e=e.warmLanes;var q=d&134217727;return q!==0?(d=q&~m,d!==0?_=Ne(d):(k&=q,k!==0?_=Ne(k):r||(r=q&~e,r!==0&&(_=Ne(r))))):(q=d&~m,q!==0?_=Ne(q):k!==0?_=Ne(k):r||(r=d&~e,r!==0&&(_=Ne(r)))),_===0?0:n!==0&&n!==_&&(n&m)===0&&(m=_&-_,r=n&-n,m>=r||m===32&&(r&4194048)!==0)?n:_}function Je(e,n){return(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&n)===0}function At(e,n){switch(e){case 1:case 2:case 4:case 8:case 64:return n+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function un(){var e=Ve;return Ve<<=1,(Ve&4194048)===0&&(Ve=256),e}function Tt(){var e=Te;return Te<<=1,(Te&62914560)===0&&(Te=4194304),e}function Yo(e){for(var n=[],r=0;31>r;r++)n.push(e);return n}function In(e,n){e.pendingLanes|=n,n!==268435456&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function Oc(e,n,r,d,_,m){var k=e.pendingLanes;e.pendingLanes=r,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=r,e.entangledLanes&=r,e.errorRecoveryDisabledLanes&=r,e.shellSuspendCounter=0;var q=e.entanglements,M=e.expirationTimes,ee=e.hiddenUpdates;for(r=k&~r;0<r;){var ie=31-Nt(r),he=1<<ie;q[ie]=0,M[ie]=-1;var oe=ee[ie];if(oe!==null)for(ee[ie]=null,ie=0;ie<oe.length;ie++){var ae=oe[ie];ae!==null&&(ae.lane&=-536870913)}r&=~he}d!==0&&il(e,d,0),m!==0&&_===0&&e.tag!==0&&(e.suspendedLanes|=m&~(k&~n))}function il(e,n,r){e.pendingLanes|=n,e.suspendedLanes&=~n;var d=31-Nt(n);e.entangledLanes|=n,e.entanglements[d]=e.entanglements[d]|1073741824|r&4194090}function tr(e,n){var r=e.entangledLanes|=n;for(e=e.entanglements;r;){var d=31-Nt(r),_=1<<d;_&n|e[d]&n&&(e[d]|=n),r&=~_}}function nr(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function or(e){return e&=-e,2<e?8<e?(e&134217727)!==0?32:268435456:8:2}function dl(){var e=B.p;return e!==0?e:(e=window.event,e===void 0?32:Xf(e.type))}function Lc(e,n){var r=B.p;try{return B.p=e,n()}finally{B.p=r}}var Qn=Math.random().toString(36).slice(2),Bt="__reactFiber$"+Qn,Qt="__reactProps$"+Qn,no="__reactContainer$"+Qn,ha="__reactEvents$"+Qn,we="__reactListeners$"+Qn,be="__reactHandles$"+Qn,Le="__reactResources$"+Qn,ut="__reactMarker$"+Qn;function Lt(e){delete e[Bt],delete e[Qt],delete e[ha],delete e[we],delete e[be]}function rn(e){var n=e[Bt];if(n)return n;for(var r=e.parentNode;r;){if(n=r[no]||r[Bt]){if(r=n.alternate,n.child!==null||r!==null&&r.child!==null)for(e=Uf(e);e!==null;){if(r=e[Bt])return r;e=Uf(e)}return n}e=r,r=e.parentNode}return null}function Xt(e){if(e=e[Bt]||e[no]){var n=e.tag;if(n===5||n===6||n===13||n===26||n===27||n===3)return e}return null}function wn(e){var n=e.tag;if(n===5||n===26||n===27||n===6)return e.stateNode;throw Error(i(33))}function Mn(e){var n=e[Le];return n||(n=e[Le]={hoistableStyles:new Map,hoistableScripts:new Map}),n}function ft(e){e[ut]=!0}var ul=new Set,Pc={};function Vt(e,n){xo(e,n),xo(e+"Capture",n)}function xo(e,n){for(Pc[e]=n,e=0;e<n.length;e++)ul.add(n[e])}var Ic=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),pl={},fl={};function Mc(e){return re.call(fl,e)?!0:re.call(pl,e)?!1:Ic.test(e)?fl[e]=!0:(pl[e]=!0,!1)}function So(e,n,r){if(Mc(n))if(r===null)e.removeAttribute(n);else{switch(typeof r){case"undefined":case"function":case"symbol":e.removeAttribute(n);return;case"boolean":var d=n.toLowerCase().slice(0,5);if(d!=="data-"&&d!=="aria-"){e.removeAttribute(n);return}}e.setAttribute(n,""+r)}}function Pt(e,n,r){if(r===null)e.removeAttribute(n);else{switch(typeof r){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(n);return}e.setAttribute(n,""+r)}}function Xn(e,n,r,d){if(d===null)e.removeAttribute(r);else{switch(typeof d){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(r);return}e.setAttributeNS(n,r,""+d)}}var Wo,xd;function _a(e){if(Wo===void 0)try{throw Error()}catch(r){var n=r.stack.trim().match(/\n( *(at )?)/);Wo=n&&n[1]||"",xd=-1<r.stack.indexOf(`
    at`)?" (<anonymous>)":-1<r.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Wo+e+xd}var Hc=!1;function Bc(e,n){if(!e||Hc)return"";Hc=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var d={DetermineComponentFrameRoot:function(){try{if(n){var he=function(){throw Error()};if(Object.defineProperty(he.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(he,[])}catch(ae){var oe=ae}Reflect.construct(e,[],he)}else{try{he.call()}catch(ae){oe=ae}e.call(he.prototype)}}else{try{throw Error()}catch(ae){oe=ae}(he=e())&&typeof he.catch=="function"&&he.catch(function(){})}}catch(ae){if(ae&&oe&&typeof ae.stack=="string")return[ae.stack,oe.stack]}return[null,null]}};d.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var _=Object.getOwnPropertyDescriptor(d.DetermineComponentFrameRoot,"name");_&&_.configurable&&Object.defineProperty(d.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var m=d.DetermineComponentFrameRoot(),k=m[0],q=m[1];if(k&&q){var M=k.split(`
`),ee=q.split(`
`);for(_=d=0;d<M.length&&!M[d].includes("DetermineComponentFrameRoot");)d++;for(;_<ee.length&&!ee[_].includes("DetermineComponentFrameRoot");)_++;if(d===M.length||_===ee.length)for(d=M.length-1,_=ee.length-1;1<=d&&0<=_&&M[d]!==ee[_];)_--;for(;1<=d&&0<=_;d--,_--)if(M[d]!==ee[_]){if(d!==1||_!==1)do if(d--,_--,0>_||M[d]!==ee[_]){var ie=`
`+M[d].replace(" at new "," at ");return e.displayName&&ie.includes("<anonymous>")&&(ie=ie.replace("<anonymous>",e.displayName)),ie}while(1<=d&&0<=_);break}}}finally{Hc=!1,Error.prepareStackTrace=r}return(r=e?e.displayName||e.name:"")?_a(r):""}function Z_(e){switch(e.tag){case 26:case 27:case 5:return _a(e.type);case 16:return _a("Lazy");case 13:return _a("Suspense");case 19:return _a("SuspenseList");case 0:case 15:return Bc(e.type,!1);case 11:return Bc(e.type.render,!1);case 1:return Bc(e.type,!0);case 31:return _a("Activity");default:return""}}function Sd(e){try{var n="";do n+=Z_(e),e=e.return;while(e);return n}catch(r){return`
Error generating stack: `+r.message+`
`+r.stack}}function kn(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function bd(e){var n=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(n==="checkbox"||n==="radio")}function K_(e){var n=bd(e)?"checked":"value",r=Object.getOwnPropertyDescriptor(e.constructor.prototype,n),d=""+e[n];if(!e.hasOwnProperty(n)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var _=r.get,m=r.set;return Object.defineProperty(e,n,{configurable:!0,get:function(){return _.call(this)},set:function(k){d=""+k,m.call(this,k)}}),Object.defineProperty(e,n,{enumerable:r.enumerable}),{getValue:function(){return d},setValue:function(k){d=""+k},stopTracking:function(){e._valueTracker=null,delete e[n]}}}}function hl(e){e._valueTracker||(e._valueTracker=K_(e))}function Ed(e){if(!e)return!1;var n=e._valueTracker;if(!n)return!0;var r=n.getValue(),d="";return e&&(d=bd(e)?e.checked?"true":"false":e.value),e=d,e!==r?(n.setValue(e),!0):!1}function _l(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}var J_=/[\n"\\]/g;function Dn(e){return e.replace(J_,function(n){return"\\"+n.charCodeAt(0).toString(16)+" "})}function Vc(e,n,r,d,_,m,k,q){e.name="",k!=null&&typeof k!="function"&&typeof k!="symbol"&&typeof k!="boolean"?e.type=k:e.removeAttribute("type"),n!=null?k==="number"?(n===0&&e.value===""||e.value!=n)&&(e.value=""+kn(n)):e.value!==""+kn(n)&&(e.value=""+kn(n)):k!=="submit"&&k!=="reset"||e.removeAttribute("value"),n!=null?zc(e,k,kn(n)):r!=null?zc(e,k,kn(r)):d!=null&&e.removeAttribute("value"),_==null&&m!=null&&(e.defaultChecked=!!m),_!=null&&(e.checked=_&&typeof _!="function"&&typeof _!="symbol"),q!=null&&typeof q!="function"&&typeof q!="symbol"&&typeof q!="boolean"?e.name=""+kn(q):e.removeAttribute("name")}function Rd(e,n,r,d,_,m,k,q){if(m!=null&&typeof m!="function"&&typeof m!="symbol"&&typeof m!="boolean"&&(e.type=m),n!=null||r!=null){if(!(m!=="submit"&&m!=="reset"||n!=null))return;r=r!=null?""+kn(r):"",n=n!=null?""+kn(n):r,q||n===e.value||(e.value=n),e.defaultValue=n}d=d??_,d=typeof d!="function"&&typeof d!="symbol"&&!!d,e.checked=q?e.checked:!!d,e.defaultChecked=!!d,k!=null&&typeof k!="function"&&typeof k!="symbol"&&typeof k!="boolean"&&(e.name=k)}function zc(e,n,r){n==="number"&&_l(e.ownerDocument)===e||e.defaultValue===""+r||(e.defaultValue=""+r)}function ya(e,n,r,d){if(e=e.options,n){n={};for(var _=0;_<r.length;_++)n["$"+r[_]]=!0;for(r=0;r<e.length;r++)_=n.hasOwnProperty("$"+e[r].value),e[r].selected!==_&&(e[r].selected=_),_&&d&&(e[r].defaultSelected=!0)}else{for(r=""+kn(r),n=null,_=0;_<e.length;_++){if(e[_].value===r){e[_].selected=!0,d&&(e[_].defaultSelected=!0);return}n!==null||e[_].disabled||(n=e[_])}n!==null&&(n.selected=!0)}}function Ad(e,n,r){if(n!=null&&(n=""+kn(n),n!==e.value&&(e.value=n),r==null)){e.defaultValue!==n&&(e.defaultValue=n);return}e.defaultValue=r!=null?""+kn(r):""}function jd(e,n,r,d){if(n==null){if(d!=null){if(r!=null)throw Error(i(92));if(z(d)){if(1<d.length)throw Error(i(93));d=d[0]}r=d}r==null&&(r=""),n=r}r=kn(n),e.defaultValue=r,d=e.textContent,d===r&&d!==""&&d!==null&&(e.value=d)}function ga(e,n){if(n){var r=e.firstChild;if(r&&r===e.lastChild&&r.nodeType===3){r.nodeValue=n;return}}e.textContent=n}var ey=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function kd(e,n,r){var d=n.indexOf("--")===0;r==null||typeof r=="boolean"||r===""?d?e.setProperty(n,""):n==="float"?e.cssFloat="":e[n]="":d?e.setProperty(n,r):typeof r!="number"||r===0||ey.has(n)?n==="float"?e.cssFloat=r:e[n]=(""+r).trim():e[n]=r+"px"}function Dd(e,n,r){if(n!=null&&typeof n!="object")throw Error(i(62));if(e=e.style,r!=null){for(var d in r)!r.hasOwnProperty(d)||n!=null&&n.hasOwnProperty(d)||(d.indexOf("--")===0?e.setProperty(d,""):d==="float"?e.cssFloat="":e[d]="");for(var _ in n)d=n[_],n.hasOwnProperty(_)&&r[_]!==d&&kd(e,_,d)}else for(var m in n)n.hasOwnProperty(m)&&kd(e,m,n[m])}function Gc(e){if(e.indexOf("-")===-1)return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ty=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),ny=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function yl(e){return ny.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}var Yc=null;function Wc(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var ma=null,va=null;function Td(e){var n=Xt(e);if(n&&(e=n.stateNode)){var r=e[Qt]||null;e:switch(e=n.stateNode,n.type){case"input":if(Vc(e,r.value,r.defaultValue,r.defaultValue,r.checked,r.defaultChecked,r.type,r.name),n=r.name,r.type==="radio"&&n!=null){for(r=e;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll('input[name="'+Dn(""+n)+'"][type="radio"]'),n=0;n<r.length;n++){var d=r[n];if(d!==e&&d.form===e.form){var _=d[Qt]||null;if(!_)throw Error(i(90));Vc(d,_.value,_.defaultValue,_.defaultValue,_.checked,_.defaultChecked,_.type,_.name)}}for(n=0;n<r.length;n++)d=r[n],d.form===e.form&&Ed(d)}break e;case"textarea":Ad(e,r.value,r.defaultValue);break e;case"select":n=r.value,n!=null&&ya(e,!!r.multiple,n,!1)}}}var Qc=!1;function Fd(e,n,r){if(Qc)return e(n,r);Qc=!0;try{var d=e(n);return d}finally{if(Qc=!1,(ma!==null||va!==null)&&(tc(),ma&&(n=ma,e=va,va=ma=null,Td(n),e)))for(n=0;n<e.length;n++)Td(e[n])}}function ar(e,n){var r=e.stateNode;if(r===null)return null;var d=r[Qt]||null;if(d===null)return null;r=d[n];e:switch(n){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(d=!d.disabled)||(e=e.type,d=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!d;break e;default:e=!1}if(e)return null;if(r&&typeof r!="function")throw Error(i(231,n,typeof r));return r}var oo=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Xc=!1;if(oo)try{var rr={};Object.defineProperty(rr,"passive",{get:function(){Xc=!0}}),window.addEventListener("test",rr,rr),window.removeEventListener("test",rr,rr)}catch{Xc=!1}var bo=null,Zc=null,gl=null;function qd(){if(gl)return gl;var e,n=Zc,r=n.length,d,_="value"in bo?bo.value:bo.textContent,m=_.length;for(e=0;e<r&&n[e]===_[e];e++);var k=r-e;for(d=1;d<=k&&n[r-d]===_[m-d];d++);return gl=_.slice(e,1<d?1-d:void 0)}function ml(e){var n=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&n===13&&(e=13)):e=n,e===10&&(e=13),32<=e||e===13?e:0}function vl(){return!0}function Nd(){return!1}function _n(e){function n(r,d,_,m,k){this._reactName=r,this._targetInst=_,this.type=d,this.nativeEvent=m,this.target=k,this.currentTarget=null;for(var q in e)e.hasOwnProperty(q)&&(r=e[q],this[q]=r?r(m):m[q]);return this.isDefaultPrevented=(m.defaultPrevented!=null?m.defaultPrevented:m.returnValue===!1)?vl:Nd,this.isPropagationStopped=Nd,this}return y(n.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=vl)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=vl)},persist:function(){},isPersistent:vl}),n}var Qo={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},wl=_n(Qo),lr=y({},Qo,{view:0,detail:0}),oy=_n(lr),Kc,Jc,cr,Cl=y({},lr,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ts,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==cr&&(cr&&e.type==="mousemove"?(Kc=e.screenX-cr.screenX,Jc=e.screenY-cr.screenY):Jc=Kc=0,cr=e),Kc)},movementY:function(e){return"movementY"in e?e.movementY:Jc}}),Ud=_n(Cl),ay=y({},Cl,{dataTransfer:0}),ry=_n(ay),ly=y({},lr,{relatedTarget:0}),es=_n(ly),cy=y({},Qo,{animationName:0,elapsedTime:0,pseudoElement:0}),sy=_n(cy),iy=y({},Qo,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),dy=_n(iy),uy=y({},Qo,{data:0}),$d=_n(uy),py={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},fy={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},hy={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function _y(e){var n=this.nativeEvent;return n.getModifierState?n.getModifierState(e):(e=hy[e])?!!n[e]:!1}function ts(){return _y}var yy=y({},lr,{key:function(e){if(e.key){var n=py[e.key]||e.key;if(n!=="Unidentified")return n}return e.type==="keypress"?(e=ml(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?fy[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ts,charCode:function(e){return e.type==="keypress"?ml(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?ml(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),gy=_n(yy),my=y({},Cl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Od=_n(my),vy=y({},lr,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ts}),wy=_n(vy),Cy=y({},Qo,{propertyName:0,elapsedTime:0,pseudoElement:0}),xy=_n(Cy),Sy=y({},Cl,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),by=_n(Sy),Ey=y({},Qo,{newState:0,oldState:0}),Ry=_n(Ey),Ay=[9,13,27,32],ns=oo&&"CompositionEvent"in window,sr=null;oo&&"documentMode"in document&&(sr=document.documentMode);var jy=oo&&"TextEvent"in window&&!sr,Ld=oo&&(!ns||sr&&8<sr&&11>=sr),Pd=" ",Id=!1;function Md(e,n){switch(e){case"keyup":return Ay.indexOf(n.keyCode)!==-1;case"keydown":return n.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Hd(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var wa=!1;function ky(e,n){switch(e){case"compositionend":return Hd(n);case"keypress":return n.which!==32?null:(Id=!0,Pd);case"textInput":return e=n.data,e===Pd&&Id?null:e;default:return null}}function Dy(e,n){if(wa)return e==="compositionend"||!ns&&Md(e,n)?(e=qd(),gl=Zc=bo=null,wa=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(n.ctrlKey||n.altKey||n.metaKey)||n.ctrlKey&&n.altKey){if(n.char&&1<n.char.length)return n.char;if(n.which)return String.fromCharCode(n.which)}return null;case"compositionend":return Ld&&n.locale!=="ko"?null:n.data;default:return null}}var Ty={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Bd(e){var n=e&&e.nodeName&&e.nodeName.toLowerCase();return n==="input"?!!Ty[e.type]:n==="textarea"}function Vd(e,n,r,d){ma?va?va.push(d):va=[d]:ma=d,n=cc(n,"onChange"),0<n.length&&(r=new wl("onChange","change",null,r,d),e.push({event:r,listeners:n}))}var ir=null,dr=null;function Fy(e){Ef(e,0)}function xl(e){var n=wn(e);if(Ed(n))return e}function zd(e,n){if(e==="change")return n}var Gd=!1;if(oo){var os;if(oo){var as="oninput"in document;if(!as){var Yd=document.createElement("div");Yd.setAttribute("oninput","return;"),as=typeof Yd.oninput=="function"}os=as}else os=!1;Gd=os&&(!document.documentMode||9<document.documentMode)}function Wd(){ir&&(ir.detachEvent("onpropertychange",Qd),dr=ir=null)}function Qd(e){if(e.propertyName==="value"&&xl(dr)){var n=[];Vd(n,dr,e,Wc(e)),Fd(Fy,n)}}function qy(e,n,r){e==="focusin"?(Wd(),ir=n,dr=r,ir.attachEvent("onpropertychange",Qd)):e==="focusout"&&Wd()}function Ny(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return xl(dr)}function Uy(e,n){if(e==="click")return xl(n)}function $y(e,n){if(e==="input"||e==="change")return xl(n)}function Oy(e,n){return e===n&&(e!==0||1/e===1/n)||e!==e&&n!==n}var Cn=typeof Object.is=="function"?Object.is:Oy;function ur(e,n){if(Cn(e,n))return!0;if(typeof e!="object"||e===null||typeof n!="object"||n===null)return!1;var r=Object.keys(e),d=Object.keys(n);if(r.length!==d.length)return!1;for(d=0;d<r.length;d++){var _=r[d];if(!re.call(n,_)||!Cn(e[_],n[_]))return!1}return!0}function Xd(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Zd(e,n){var r=Xd(e);e=0;for(var d;r;){if(r.nodeType===3){if(d=e+r.textContent.length,e<=n&&d>=n)return{node:r,offset:n-e};e=d}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=Xd(r)}}function Kd(e,n){return e&&n?e===n?!0:e&&e.nodeType===3?!1:n&&n.nodeType===3?Kd(e,n.parentNode):"contains"in e?e.contains(n):e.compareDocumentPosition?!!(e.compareDocumentPosition(n)&16):!1:!1}function Jd(e){e=e!=null&&e.ownerDocument!=null&&e.ownerDocument.defaultView!=null?e.ownerDocument.defaultView:window;for(var n=_l(e.document);n instanceof e.HTMLIFrameElement;){try{var r=typeof n.contentWindow.location.href=="string"}catch{r=!1}if(r)e=n.contentWindow;else break;n=_l(e.document)}return n}function rs(e){var n=e&&e.nodeName&&e.nodeName.toLowerCase();return n&&(n==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||n==="textarea"||e.contentEditable==="true")}var Ly=oo&&"documentMode"in document&&11>=document.documentMode,Ca=null,ls=null,pr=null,cs=!1;function eu(e,n,r){var d=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;cs||Ca==null||Ca!==_l(d)||(d=Ca,"selectionStart"in d&&rs(d)?d={start:d.selectionStart,end:d.selectionEnd}:(d=(d.ownerDocument&&d.ownerDocument.defaultView||window).getSelection(),d={anchorNode:d.anchorNode,anchorOffset:d.anchorOffset,focusNode:d.focusNode,focusOffset:d.focusOffset}),pr&&ur(pr,d)||(pr=d,d=cc(ls,"onSelect"),0<d.length&&(n=new wl("onSelect","select",null,n,r),e.push({event:n,listeners:d}),n.target=Ca)))}function Xo(e,n){var r={};return r[e.toLowerCase()]=n.toLowerCase(),r["Webkit"+e]="webkit"+n,r["Moz"+e]="moz"+n,r}var xa={animationend:Xo("Animation","AnimationEnd"),animationiteration:Xo("Animation","AnimationIteration"),animationstart:Xo("Animation","AnimationStart"),transitionrun:Xo("Transition","TransitionRun"),transitionstart:Xo("Transition","TransitionStart"),transitioncancel:Xo("Transition","TransitionCancel"),transitionend:Xo("Transition","TransitionEnd")},ss={},tu={};oo&&(tu=document.createElement("div").style,"AnimationEvent"in window||(delete xa.animationend.animation,delete xa.animationiteration.animation,delete xa.animationstart.animation),"TransitionEvent"in window||delete xa.transitionend.transition);function Zo(e){if(ss[e])return ss[e];if(!xa[e])return e;var n=xa[e],r;for(r in n)if(n.hasOwnProperty(r)&&r in tu)return ss[e]=n[r];return e}var nu=Zo("animationend"),ou=Zo("animationiteration"),au=Zo("animationstart"),Py=Zo("transitionrun"),Iy=Zo("transitionstart"),My=Zo("transitioncancel"),ru=Zo("transitionend"),lu=new Map,is="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");is.push("scrollEnd");function Hn(e,n){lu.set(e,n),Vt(n,[e])}var cu=new WeakMap;function Tn(e,n){if(typeof e=="object"&&e!==null){var r=cu.get(e);return r!==void 0?r:(n={value:e,source:n,stack:Sd(n)},cu.set(e,n),n)}return{value:e,source:n,stack:Sd(n)}}var Fn=[],Sa=0,ds=0;function Sl(){for(var e=Sa,n=ds=Sa=0;n<e;){var r=Fn[n];Fn[n++]=null;var d=Fn[n];Fn[n++]=null;var _=Fn[n];Fn[n++]=null;var m=Fn[n];if(Fn[n++]=null,d!==null&&_!==null){var k=d.pending;k===null?_.next=_:(_.next=k.next,k.next=_),d.pending=_}m!==0&&su(r,_,m)}}function bl(e,n,r,d){Fn[Sa++]=e,Fn[Sa++]=n,Fn[Sa++]=r,Fn[Sa++]=d,ds|=d,e.lanes|=d,e=e.alternate,e!==null&&(e.lanes|=d)}function us(e,n,r,d){return bl(e,n,r,d),El(e)}function ba(e,n){return bl(e,null,null,n),El(e)}function su(e,n,r){e.lanes|=r;var d=e.alternate;d!==null&&(d.lanes|=r);for(var _=!1,m=e.return;m!==null;)m.childLanes|=r,d=m.alternate,d!==null&&(d.childLanes|=r),m.tag===22&&(e=m.stateNode,e===null||e._visibility&1||(_=!0)),e=m,m=m.return;return e.tag===3?(m=e.stateNode,_&&n!==null&&(_=31-Nt(r),e=m.hiddenUpdates,d=e[_],d===null?e[_]=[n]:d.push(n),n.lane=r|536870912),m):null}function El(e){if(50<Or)throw Or=0,gi=null,Error(i(185));for(var n=e.return;n!==null;)e=n,n=e.return;return e.tag===3?e.stateNode:null}var Ea={};function Hy(e,n,r,d){this.tag=e,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=n,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=d,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function xn(e,n,r,d){return new Hy(e,n,r,d)}function ps(e){return e=e.prototype,!(!e||!e.isReactComponent)}function ao(e,n){var r=e.alternate;return r===null?(r=xn(e.tag,n,e.key,e.mode),r.elementType=e.elementType,r.type=e.type,r.stateNode=e.stateNode,r.alternate=e,e.alternate=r):(r.pendingProps=n,r.type=e.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=e.flags&65011712,r.childLanes=e.childLanes,r.lanes=e.lanes,r.child=e.child,r.memoizedProps=e.memoizedProps,r.memoizedState=e.memoizedState,r.updateQueue=e.updateQueue,n=e.dependencies,r.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext},r.sibling=e.sibling,r.index=e.index,r.ref=e.ref,r.refCleanup=e.refCleanup,r}function iu(e,n){e.flags&=65011714;var r=e.alternate;return r===null?(e.childLanes=0,e.lanes=n,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=r.childLanes,e.lanes=r.lanes,e.child=r.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=r.memoizedProps,e.memoizedState=r.memoizedState,e.updateQueue=r.updateQueue,e.type=r.type,n=r.dependencies,e.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),e}function Rl(e,n,r,d,_,m){var k=0;if(d=e,typeof e=="function")ps(e)&&(k=1);else if(typeof e=="string")k=Vg(e,r,pe.current)?26:e==="html"||e==="head"||e==="body"?27:5;else e:switch(e){case L:return e=xn(31,r,n,_),e.elementType=L,e.lanes=m,e;case C:return Ko(r.children,_,m,n);case x:k=8,_|=24;break;case b:return e=xn(12,r,n,_|2),e.elementType=b,e.lanes=m,e;case A:return e=xn(13,r,n,_),e.elementType=A,e.lanes=m,e;case N:return e=xn(19,r,n,_),e.elementType=N,e.lanes=m,e;default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case E:case j:k=10;break e;case S:k=9;break e;case R:k=11;break e;case I:k=14;break e;case V:k=16,d=null;break e}k=29,r=Error(i(130,e===null?"null":typeof e,"")),d=null}return n=xn(k,r,n,_),n.elementType=e,n.type=d,n.lanes=m,n}function Ko(e,n,r,d){return e=xn(7,e,d,n),e.lanes=r,e}function fs(e,n,r){return e=xn(6,e,null,n),e.lanes=r,e}function hs(e,n,r){return n=xn(4,e.children!==null?e.children:[],e.key,n),n.lanes=r,n.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},n}var Ra=[],Aa=0,Al=null,jl=0,qn=[],Nn=0,Jo=null,ro=1,lo="";function ea(e,n){Ra[Aa++]=jl,Ra[Aa++]=Al,Al=e,jl=n}function du(e,n,r){qn[Nn++]=ro,qn[Nn++]=lo,qn[Nn++]=Jo,Jo=e;var d=ro;e=lo;var _=32-Nt(d)-1;d&=~(1<<_),r+=1;var m=32-Nt(n)+_;if(30<m){var k=_-_%5;m=(d&(1<<k)-1).toString(32),d>>=k,_-=k,ro=1<<32-Nt(n)+_|r<<_|d,lo=m+e}else ro=1<<m|r<<_|d,lo=e}function _s(e){e.return!==null&&(ea(e,1),du(e,1,0))}function ys(e){for(;e===Al;)Al=Ra[--Aa],Ra[Aa]=null,jl=Ra[--Aa],Ra[Aa]=null;for(;e===Jo;)Jo=qn[--Nn],qn[Nn]=null,lo=qn[--Nn],qn[Nn]=null,ro=qn[--Nn],qn[Nn]=null}var pn=null,jt=null,ot=!1,ta=null,Zn=!1,gs=Error(i(519));function na(e){var n=Error(i(418,""));throw _r(Tn(n,e)),gs}function uu(e){var n=e.stateNode,r=e.type,d=e.memoizedProps;switch(n[Bt]=e,n[Qt]=d,r){case"dialog":Qe("cancel",n),Qe("close",n);break;case"iframe":case"object":case"embed":Qe("load",n);break;case"video":case"audio":for(r=0;r<Pr.length;r++)Qe(Pr[r],n);break;case"source":Qe("error",n);break;case"img":case"image":case"link":Qe("error",n),Qe("load",n);break;case"details":Qe("toggle",n);break;case"input":Qe("invalid",n),Rd(n,d.value,d.defaultValue,d.checked,d.defaultChecked,d.type,d.name,!0),hl(n);break;case"select":Qe("invalid",n);break;case"textarea":Qe("invalid",n),jd(n,d.value,d.defaultValue,d.children),hl(n)}r=d.children,typeof r!="string"&&typeof r!="number"&&typeof r!="bigint"||n.textContent===""+r||d.suppressHydrationWarning===!0||kf(n.textContent,r)?(d.popover!=null&&(Qe("beforetoggle",n),Qe("toggle",n)),d.onScroll!=null&&Qe("scroll",n),d.onScrollEnd!=null&&Qe("scrollend",n),d.onClick!=null&&(n.onclick=sc),n=!0):n=!1,n||na(e)}function pu(e){for(pn=e.return;pn;)switch(pn.tag){case 5:case 13:Zn=!1;return;case 27:case 3:Zn=!0;return;default:pn=pn.return}}function fr(e){if(e!==pn)return!1;if(!ot)return pu(e),ot=!0,!1;var n=e.tag,r;if((r=n!==3&&n!==27)&&((r=n===5)&&(r=e.type,r=!(r!=="form"&&r!=="button")||qi(e.type,e.memoizedProps)),r=!r),r&&jt&&na(e),pu(e),n===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(i(317));e:{for(e=e.nextSibling,n=0;e;){if(e.nodeType===8)if(r=e.data,r==="/$"){if(n===0){jt=Vn(e.nextSibling);break e}n--}else r!=="$"&&r!=="$!"&&r!=="$?"||n++;e=e.nextSibling}jt=null}}else n===27?(n=jt,Io(e.type)?(e=Oi,Oi=null,jt=e):jt=n):jt=pn?Vn(e.stateNode.nextSibling):null;return!0}function hr(){jt=pn=null,ot=!1}function fu(){var e=ta;return e!==null&&(mn===null?mn=e:mn.push.apply(mn,e),ta=null),e}function _r(e){ta===null?ta=[e]:ta.push(e)}var ms=P(null),oa=null,co=null;function Eo(e,n,r){Q(ms,n._currentValue),n._currentValue=r}function so(e){e._currentValue=ms.current,Z(ms)}function vs(e,n,r){for(;e!==null;){var d=e.alternate;if((e.childLanes&n)!==n?(e.childLanes|=n,d!==null&&(d.childLanes|=n)):d!==null&&(d.childLanes&n)!==n&&(d.childLanes|=n),e===r)break;e=e.return}}function ws(e,n,r,d){var _=e.child;for(_!==null&&(_.return=e);_!==null;){var m=_.dependencies;if(m!==null){var k=_.child;m=m.firstContext;e:for(;m!==null;){var q=m;m=_;for(var M=0;M<n.length;M++)if(q.context===n[M]){m.lanes|=r,q=m.alternate,q!==null&&(q.lanes|=r),vs(m.return,r,e),d||(k=null);break e}m=q.next}}else if(_.tag===18){if(k=_.return,k===null)throw Error(i(341));k.lanes|=r,m=k.alternate,m!==null&&(m.lanes|=r),vs(k,r,e),k=null}else k=_.child;if(k!==null)k.return=_;else for(k=_;k!==null;){if(k===e){k=null;break}if(_=k.sibling,_!==null){_.return=k.return,k=_;break}k=k.return}_=k}}function yr(e,n,r,d){e=null;for(var _=n,m=!1;_!==null;){if(!m){if((_.flags&524288)!==0)m=!0;else if((_.flags&262144)!==0)break}if(_.tag===10){var k=_.alternate;if(k===null)throw Error(i(387));if(k=k.memoizedProps,k!==null){var q=_.type;Cn(_.pendingProps.value,k.value)||(e!==null?e.push(q):e=[q])}}else if(_===ke.current){if(k=_.alternate,k===null)throw Error(i(387));k.memoizedState.memoizedState!==_.memoizedState.memoizedState&&(e!==null?e.push(zr):e=[zr])}_=_.return}e!==null&&ws(n,e,r,d),n.flags|=262144}function kl(e){for(e=e.firstContext;e!==null;){if(!Cn(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function aa(e){oa=e,co=null,e=e.dependencies,e!==null&&(e.firstContext=null)}function ln(e){return hu(oa,e)}function Dl(e,n){return oa===null&&aa(e),hu(e,n)}function hu(e,n){var r=n._currentValue;if(n={context:n,memoizedValue:r,next:null},co===null){if(e===null)throw Error(i(308));co=n,e.dependencies={lanes:0,firstContext:n},e.flags|=524288}else co=co.next=n;return r}var By=typeof AbortController<"u"?AbortController:function(){var e=[],n=this.signal={aborted:!1,addEventListener:function(r,d){e.push(d)}};this.abort=function(){n.aborted=!0,e.forEach(function(r){return r()})}},Vy=t.unstable_scheduleCallback,zy=t.unstable_NormalPriority,It={$$typeof:j,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Cs(){return{controller:new By,data:new Map,refCount:0}}function gr(e){e.refCount--,e.refCount===0&&Vy(zy,function(){e.controller.abort()})}var mr=null,xs=0,ja=0,ka=null;function Gy(e,n){if(mr===null){var r=mr=[];xs=0,ja=bi(),ka={status:"pending",value:void 0,then:function(d){r.push(d)}}}return xs++,n.then(_u,_u),n}function _u(){if(--xs===0&&mr!==null){ka!==null&&(ka.status="fulfilled");var e=mr;mr=null,ja=0,ka=null;for(var n=0;n<e.length;n++)(0,e[n])()}}function Yy(e,n){var r=[],d={status:"pending",value:null,reason:null,then:function(_){r.push(_)}};return e.then(function(){d.status="fulfilled",d.value=n;for(var _=0;_<r.length;_++)(0,r[_])(n)},function(_){for(d.status="rejected",d.reason=_,_=0;_<r.length;_++)(0,r[_])(void 0)}),d}var yu=F.S;F.S=function(e,n){typeof n=="object"&&n!==null&&typeof n.then=="function"&&Gy(e,n),yu!==null&&yu(e,n)};var ra=P(null);function Ss(){var e=ra.current;return e!==null?e:ht.pooledCache}function Tl(e,n){n===null?Q(ra,ra.current):Q(ra,n.pool)}function gu(){var e=Ss();return e===null?null:{parent:It._currentValue,pool:e}}var vr=Error(i(460)),mu=Error(i(474)),Fl=Error(i(542)),bs={then:function(){}};function vu(e){return e=e.status,e==="fulfilled"||e==="rejected"}function ql(){}function wu(e,n,r){switch(r=e[r],r===void 0?e.push(n):r!==n&&(n.then(ql,ql),n=r),n.status){case"fulfilled":return n.value;case"rejected":throw e=n.reason,xu(e),e;default:if(typeof n.status=="string")n.then(ql,ql);else{if(e=ht,e!==null&&100<e.shellSuspendCounter)throw Error(i(482));e=n,e.status="pending",e.then(function(d){if(n.status==="pending"){var _=n;_.status="fulfilled",_.value=d}},function(d){if(n.status==="pending"){var _=n;_.status="rejected",_.reason=d}})}switch(n.status){case"fulfilled":return n.value;case"rejected":throw e=n.reason,xu(e),e}throw wr=n,vr}}var wr=null;function Cu(){if(wr===null)throw Error(i(459));var e=wr;return wr=null,e}function xu(e){if(e===vr||e===Fl)throw Error(i(483))}var Ro=!1;function Es(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Rs(e,n){e=e.updateQueue,n.updateQueue===e&&(n.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function Ao(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function jo(e,n,r){var d=e.updateQueue;if(d===null)return null;if(d=d.shared,(rt&2)!==0){var _=d.pending;return _===null?n.next=n:(n.next=_.next,_.next=n),d.pending=n,n=El(e),su(e,null,r),n}return bl(e,d,n,r),El(e)}function Cr(e,n,r){if(n=n.updateQueue,n!==null&&(n=n.shared,(r&4194048)!==0)){var d=n.lanes;d&=e.pendingLanes,r|=d,n.lanes=r,tr(e,r)}}function As(e,n){var r=e.updateQueue,d=e.alternate;if(d!==null&&(d=d.updateQueue,r===d)){var _=null,m=null;if(r=r.firstBaseUpdate,r!==null){do{var k={lane:r.lane,tag:r.tag,payload:r.payload,callback:null,next:null};m===null?_=m=k:m=m.next=k,r=r.next}while(r!==null);m===null?_=m=n:m=m.next=n}else _=m=n;r={baseState:d.baseState,firstBaseUpdate:_,lastBaseUpdate:m,shared:d.shared,callbacks:d.callbacks},e.updateQueue=r;return}e=r.lastBaseUpdate,e===null?r.firstBaseUpdate=n:e.next=n,r.lastBaseUpdate=n}var js=!1;function xr(){if(js){var e=ka;if(e!==null)throw e}}function Sr(e,n,r,d){js=!1;var _=e.updateQueue;Ro=!1;var m=_.firstBaseUpdate,k=_.lastBaseUpdate,q=_.shared.pending;if(q!==null){_.shared.pending=null;var M=q,ee=M.next;M.next=null,k===null?m=ee:k.next=ee,k=M;var ie=e.alternate;ie!==null&&(ie=ie.updateQueue,q=ie.lastBaseUpdate,q!==k&&(q===null?ie.firstBaseUpdate=ee:q.next=ee,ie.lastBaseUpdate=M))}if(m!==null){var he=_.baseState;k=0,ie=ee=M=null,q=m;do{var oe=q.lane&-536870913,ae=oe!==q.lane;if(ae?(Ze&oe)===oe:(d&oe)===oe){oe!==0&&oe===ja&&(js=!0),ie!==null&&(ie=ie.next={lane:0,tag:q.tag,payload:q.payload,callback:null,next:null});e:{var Ue=e,Fe=q;oe=n;var it=r;switch(Fe.tag){case 1:if(Ue=Fe.payload,typeof Ue=="function"){he=Ue.call(it,he,oe);break e}he=Ue;break e;case 3:Ue.flags=Ue.flags&-65537|128;case 0:if(Ue=Fe.payload,oe=typeof Ue=="function"?Ue.call(it,he,oe):Ue,oe==null)break e;he=y({},he,oe);break e;case 2:Ro=!0}}oe=q.callback,oe!==null&&(e.flags|=64,ae&&(e.flags|=8192),ae=_.callbacks,ae===null?_.callbacks=[oe]:ae.push(oe))}else ae={lane:oe,tag:q.tag,payload:q.payload,callback:q.callback,next:null},ie===null?(ee=ie=ae,M=he):ie=ie.next=ae,k|=oe;if(q=q.next,q===null){if(q=_.shared.pending,q===null)break;ae=q,q=ae.next,ae.next=null,_.lastBaseUpdate=ae,_.shared.pending=null}}while(!0);ie===null&&(M=he),_.baseState=M,_.firstBaseUpdate=ee,_.lastBaseUpdate=ie,m===null&&(_.shared.lanes=0),$o|=k,e.lanes=k,e.memoizedState=he}}function Su(e,n){if(typeof e!="function")throw Error(i(191,e));e.call(n)}function bu(e,n){var r=e.callbacks;if(r!==null)for(e.callbacks=null,e=0;e<r.length;e++)Su(r[e],n)}var Da=P(null),Nl=P(0);function Eu(e,n){e=yo,Q(Nl,e),Q(Da,n),yo=e|n.baseLanes}function ks(){Q(Nl,yo),Q(Da,Da.current)}function Ds(){yo=Nl.current,Z(Da),Z(Nl)}var ko=0,Be=null,ct=null,Ut=null,Ul=!1,Ta=!1,la=!1,$l=0,br=0,Fa=null,Wy=0;function Ft(){throw Error(i(321))}function Ts(e,n){if(n===null)return!1;for(var r=0;r<n.length&&r<e.length;r++)if(!Cn(e[r],n[r]))return!1;return!0}function Fs(e,n,r,d,_,m){return ko=m,Be=n,n.memoizedState=null,n.updateQueue=null,n.lanes=0,F.H=e===null||e.memoizedState===null?sp:ip,la=!1,m=r(d,_),la=!1,Ta&&(m=Au(n,r,d,_)),Ru(e),m}function Ru(e){F.H=Hl;var n=ct!==null&&ct.next!==null;if(ko=0,Ut=ct=Be=null,Ul=!1,br=0,Fa=null,n)throw Error(i(300));e===null||zt||(e=e.dependencies,e!==null&&kl(e)&&(zt=!0))}function Au(e,n,r,d){Be=e;var _=0;do{if(Ta&&(Fa=null),br=0,Ta=!1,25<=_)throw Error(i(301));if(_+=1,Ut=ct=null,e.updateQueue!=null){var m=e.updateQueue;m.lastEffect=null,m.events=null,m.stores=null,m.memoCache!=null&&(m.memoCache.index=0)}F.H=tg,m=n(r,d)}while(Ta);return m}function Qy(){var e=F.H,n=e.useState()[0];return n=typeof n.then=="function"?Er(n):n,e=e.useState()[0],(ct!==null?ct.memoizedState:null)!==e&&(Be.flags|=1024),n}function qs(){var e=$l!==0;return $l=0,e}function Ns(e,n,r){n.updateQueue=e.updateQueue,n.flags&=-2053,e.lanes&=~r}function Us(e){if(Ul){for(e=e.memoizedState;e!==null;){var n=e.queue;n!==null&&(n.pending=null),e=e.next}Ul=!1}ko=0,Ut=ct=Be=null,Ta=!1,br=$l=0,Fa=null}function yn(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ut===null?Be.memoizedState=Ut=e:Ut=Ut.next=e,Ut}function $t(){if(ct===null){var e=Be.alternate;e=e!==null?e.memoizedState:null}else e=ct.next;var n=Ut===null?Be.memoizedState:Ut.next;if(n!==null)Ut=n,ct=e;else{if(e===null)throw Be.alternate===null?Error(i(467)):Error(i(310));ct=e,e={memoizedState:ct.memoizedState,baseState:ct.baseState,baseQueue:ct.baseQueue,queue:ct.queue,next:null},Ut===null?Be.memoizedState=Ut=e:Ut=Ut.next=e}return Ut}function $s(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Er(e){var n=br;return br+=1,Fa===null&&(Fa=[]),e=wu(Fa,e,n),n=Be,(Ut===null?n.memoizedState:Ut.next)===null&&(n=n.alternate,F.H=n===null||n.memoizedState===null?sp:ip),e}function Ol(e){if(e!==null&&typeof e=="object"){if(typeof e.then=="function")return Er(e);if(e.$$typeof===j)return ln(e)}throw Error(i(438,String(e)))}function Os(e){var n=null,r=Be.updateQueue;if(r!==null&&(n=r.memoCache),n==null){var d=Be.alternate;d!==null&&(d=d.updateQueue,d!==null&&(d=d.memoCache,d!=null&&(n={data:d.data.map(function(_){return _.slice()}),index:0})))}if(n==null&&(n={data:[],index:0}),r===null&&(r=$s(),Be.updateQueue=r),r.memoCache=n,r=n.data[n.index],r===void 0)for(r=n.data[n.index]=Array(e),d=0;d<e;d++)r[d]=D;return n.index++,r}function io(e,n){return typeof n=="function"?n(e):n}function Ll(e){var n=$t();return Ls(n,ct,e)}function Ls(e,n,r){var d=e.queue;if(d===null)throw Error(i(311));d.lastRenderedReducer=r;var _=e.baseQueue,m=d.pending;if(m!==null){if(_!==null){var k=_.next;_.next=m.next,m.next=k}n.baseQueue=_=m,d.pending=null}if(m=e.baseState,_===null)e.memoizedState=m;else{n=_.next;var q=k=null,M=null,ee=n,ie=!1;do{var he=ee.lane&-536870913;if(he!==ee.lane?(Ze&he)===he:(ko&he)===he){var oe=ee.revertLane;if(oe===0)M!==null&&(M=M.next={lane:0,revertLane:0,action:ee.action,hasEagerState:ee.hasEagerState,eagerState:ee.eagerState,next:null}),he===ja&&(ie=!0);else if((ko&oe)===oe){ee=ee.next,oe===ja&&(ie=!0);continue}else he={lane:0,revertLane:ee.revertLane,action:ee.action,hasEagerState:ee.hasEagerState,eagerState:ee.eagerState,next:null},M===null?(q=M=he,k=m):M=M.next=he,Be.lanes|=oe,$o|=oe;he=ee.action,la&&r(m,he),m=ee.hasEagerState?ee.eagerState:r(m,he)}else oe={lane:he,revertLane:ee.revertLane,action:ee.action,hasEagerState:ee.hasEagerState,eagerState:ee.eagerState,next:null},M===null?(q=M=oe,k=m):M=M.next=oe,Be.lanes|=he,$o|=he;ee=ee.next}while(ee!==null&&ee!==n);if(M===null?k=m:M.next=q,!Cn(m,e.memoizedState)&&(zt=!0,ie&&(r=ka,r!==null)))throw r;e.memoizedState=m,e.baseState=k,e.baseQueue=M,d.lastRenderedState=m}return _===null&&(d.lanes=0),[e.memoizedState,d.dispatch]}function Ps(e){var n=$t(),r=n.queue;if(r===null)throw Error(i(311));r.lastRenderedReducer=e;var d=r.dispatch,_=r.pending,m=n.memoizedState;if(_!==null){r.pending=null;var k=_=_.next;do m=e(m,k.action),k=k.next;while(k!==_);Cn(m,n.memoizedState)||(zt=!0),n.memoizedState=m,n.baseQueue===null&&(n.baseState=m),r.lastRenderedState=m}return[m,d]}function ju(e,n,r){var d=Be,_=$t(),m=ot;if(m){if(r===void 0)throw Error(i(407));r=r()}else r=n();var k=!Cn((ct||_).memoizedState,r);k&&(_.memoizedState=r,zt=!0),_=_.queue;var q=Tu.bind(null,d,_,e);if(Rr(2048,8,q,[e]),_.getSnapshot!==n||k||Ut!==null&&Ut.memoizedState.tag&1){if(d.flags|=2048,qa(9,Pl(),Du.bind(null,d,_,r,n),null),ht===null)throw Error(i(349));m||(ko&124)!==0||ku(d,n,r)}return r}function ku(e,n,r){e.flags|=16384,e={getSnapshot:n,value:r},n=Be.updateQueue,n===null?(n=$s(),Be.updateQueue=n,n.stores=[e]):(r=n.stores,r===null?n.stores=[e]:r.push(e))}function Du(e,n,r,d){n.value=r,n.getSnapshot=d,Fu(n)&&qu(e)}function Tu(e,n,r){return r(function(){Fu(n)&&qu(e)})}function Fu(e){var n=e.getSnapshot;e=e.value;try{var r=n();return!Cn(e,r)}catch{return!0}}function qu(e){var n=ba(e,2);n!==null&&An(n,e,2)}function Is(e){var n=yn();if(typeof e=="function"){var r=e;if(e=r(),la){dt(!0);try{r()}finally{dt(!1)}}}return n.memoizedState=n.baseState=e,n.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:io,lastRenderedState:e},n}function Nu(e,n,r,d){return e.baseState=r,Ls(e,ct,typeof d=="function"?d:io)}function Xy(e,n,r,d,_){if(Ml(e))throw Error(i(485));if(e=n.action,e!==null){var m={payload:_,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(k){m.listeners.push(k)}};F.T!==null?r(!0):m.isTransition=!1,d(m),r=n.pending,r===null?(m.next=n.pending=m,Uu(n,m)):(m.next=r.next,n.pending=r.next=m)}}function Uu(e,n){var r=n.action,d=n.payload,_=e.state;if(n.isTransition){var m=F.T,k={};F.T=k;try{var q=r(_,d),M=F.S;M!==null&&M(k,q),$u(e,n,q)}catch(ee){Ms(e,n,ee)}finally{F.T=m}}else try{m=r(_,d),$u(e,n,m)}catch(ee){Ms(e,n,ee)}}function $u(e,n,r){r!==null&&typeof r=="object"&&typeof r.then=="function"?r.then(function(d){Ou(e,n,d)},function(d){return Ms(e,n,d)}):Ou(e,n,r)}function Ou(e,n,r){n.status="fulfilled",n.value=r,Lu(n),e.state=r,n=e.pending,n!==null&&(r=n.next,r===n?e.pending=null:(r=r.next,n.next=r,Uu(e,r)))}function Ms(e,n,r){var d=e.pending;if(e.pending=null,d!==null){d=d.next;do n.status="rejected",n.reason=r,Lu(n),n=n.next;while(n!==d)}e.action=null}function Lu(e){e=e.listeners;for(var n=0;n<e.length;n++)(0,e[n])()}function Pu(e,n){return n}function Iu(e,n){if(ot){var r=ht.formState;if(r!==null){e:{var d=Be;if(ot){if(jt){t:{for(var _=jt,m=Zn;_.nodeType!==8;){if(!m){_=null;break t}if(_=Vn(_.nextSibling),_===null){_=null;break t}}m=_.data,_=m==="F!"||m==="F"?_:null}if(_){jt=Vn(_.nextSibling),d=_.data==="F!";break e}}na(d)}d=!1}d&&(n=r[0])}}return r=yn(),r.memoizedState=r.baseState=n,d={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Pu,lastRenderedState:n},r.queue=d,r=rp.bind(null,Be,d),d.dispatch=r,d=Is(!1),m=Gs.bind(null,Be,!1,d.queue),d=yn(),_={state:n,dispatch:null,action:e,pending:null},d.queue=_,r=Xy.bind(null,Be,_,m,r),_.dispatch=r,d.memoizedState=e,[n,r,!1]}function Mu(e){var n=$t();return Hu(n,ct,e)}function Hu(e,n,r){if(n=Ls(e,n,Pu)[0],e=Ll(io)[0],typeof n=="object"&&n!==null&&typeof n.then=="function")try{var d=Er(n)}catch(k){throw k===vr?Fl:k}else d=n;n=$t();var _=n.queue,m=_.dispatch;return r!==n.memoizedState&&(Be.flags|=2048,qa(9,Pl(),Zy.bind(null,_,r),null)),[d,m,e]}function Zy(e,n){e.action=n}function Bu(e){var n=$t(),r=ct;if(r!==null)return Hu(n,r,e);$t(),n=n.memoizedState,r=$t();var d=r.queue.dispatch;return r.memoizedState=e,[n,d,!1]}function qa(e,n,r,d){return e={tag:e,create:r,deps:d,inst:n,next:null},n=Be.updateQueue,n===null&&(n=$s(),Be.updateQueue=n),r=n.lastEffect,r===null?n.lastEffect=e.next=e:(d=r.next,r.next=e,e.next=d,n.lastEffect=e),e}function Pl(){return{destroy:void 0,resource:void 0}}function Vu(){return $t().memoizedState}function Il(e,n,r,d){var _=yn();d=d===void 0?null:d,Be.flags|=e,_.memoizedState=qa(1|n,Pl(),r,d)}function Rr(e,n,r,d){var _=$t();d=d===void 0?null:d;var m=_.memoizedState.inst;ct!==null&&d!==null&&Ts(d,ct.memoizedState.deps)?_.memoizedState=qa(n,m,r,d):(Be.flags|=e,_.memoizedState=qa(1|n,m,r,d))}function zu(e,n){Il(8390656,8,e,n)}function Gu(e,n){Rr(2048,8,e,n)}function Yu(e,n){return Rr(4,2,e,n)}function Wu(e,n){return Rr(4,4,e,n)}function Qu(e,n){if(typeof n=="function"){e=e();var r=n(e);return function(){typeof r=="function"?r():n(null)}}if(n!=null)return e=e(),n.current=e,function(){n.current=null}}function Xu(e,n,r){r=r!=null?r.concat([e]):null,Rr(4,4,Qu.bind(null,n,e),r)}function Hs(){}function Zu(e,n){var r=$t();n=n===void 0?null:n;var d=r.memoizedState;return n!==null&&Ts(n,d[1])?d[0]:(r.memoizedState=[e,n],e)}function Ku(e,n){var r=$t();n=n===void 0?null:n;var d=r.memoizedState;if(n!==null&&Ts(n,d[1]))return d[0];if(d=e(),la){dt(!0);try{e()}finally{dt(!1)}}return r.memoizedState=[d,n],d}function Bs(e,n,r){return r===void 0||(ko&1073741824)!==0?e.memoizedState=n:(e.memoizedState=r,e=tf(),Be.lanes|=e,$o|=e,r)}function Ju(e,n,r,d){return Cn(r,n)?r:Da.current!==null?(e=Bs(e,r,d),Cn(e,n)||(zt=!0),e):(ko&42)===0?(zt=!0,e.memoizedState=r):(e=tf(),Be.lanes|=e,$o|=e,n)}function ep(e,n,r,d,_){var m=B.p;B.p=m!==0&&8>m?m:8;var k=F.T,q={};F.T=q,Gs(e,!1,n,r);try{var M=_(),ee=F.S;if(ee!==null&&ee(q,M),M!==null&&typeof M=="object"&&typeof M.then=="function"){var ie=Yy(M,d);Ar(e,n,ie,Rn(e))}else Ar(e,n,d,Rn(e))}catch(he){Ar(e,n,{then:function(){},status:"rejected",reason:he},Rn())}finally{B.p=m,F.T=k}}function Ky(){}function Vs(e,n,r,d){if(e.tag!==5)throw Error(i(476));var _=tp(e).queue;ep(e,_,n,W,r===null?Ky:function(){return np(e),r(d)})}function tp(e){var n=e.memoizedState;if(n!==null)return n;n={memoizedState:W,baseState:W,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:io,lastRenderedState:W},next:null};var r={};return n.next={memoizedState:r,baseState:r,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:io,lastRenderedState:r},next:null},e.memoizedState=n,e=e.alternate,e!==null&&(e.memoizedState=n),n}function np(e){var n=tp(e).next.queue;Ar(e,n,{},Rn())}function zs(){return ln(zr)}function op(){return $t().memoizedState}function ap(){return $t().memoizedState}function Jy(e){for(var n=e.return;n!==null;){switch(n.tag){case 24:case 3:var r=Rn();e=Ao(r);var d=jo(n,e,r);d!==null&&(An(d,n,r),Cr(d,n,r)),n={cache:Cs()},e.payload=n;return}n=n.return}}function eg(e,n,r){var d=Rn();r={lane:d,revertLane:0,action:r,hasEagerState:!1,eagerState:null,next:null},Ml(e)?lp(n,r):(r=us(e,n,r,d),r!==null&&(An(r,e,d),cp(r,n,d)))}function rp(e,n,r){var d=Rn();Ar(e,n,r,d)}function Ar(e,n,r,d){var _={lane:d,revertLane:0,action:r,hasEagerState:!1,eagerState:null,next:null};if(Ml(e))lp(n,_);else{var m=e.alternate;if(e.lanes===0&&(m===null||m.lanes===0)&&(m=n.lastRenderedReducer,m!==null))try{var k=n.lastRenderedState,q=m(k,r);if(_.hasEagerState=!0,_.eagerState=q,Cn(q,k))return bl(e,n,_,0),ht===null&&Sl(),!1}catch{}finally{}if(r=us(e,n,_,d),r!==null)return An(r,e,d),cp(r,n,d),!0}return!1}function Gs(e,n,r,d){if(d={lane:2,revertLane:bi(),action:d,hasEagerState:!1,eagerState:null,next:null},Ml(e)){if(n)throw Error(i(479))}else n=us(e,r,d,2),n!==null&&An(n,e,2)}function Ml(e){var n=e.alternate;return e===Be||n!==null&&n===Be}function lp(e,n){Ta=Ul=!0;var r=e.pending;r===null?n.next=n:(n.next=r.next,r.next=n),e.pending=n}function cp(e,n,r){if((r&4194048)!==0){var d=n.lanes;d&=e.pendingLanes,r|=d,n.lanes=r,tr(e,r)}}var Hl={readContext:ln,use:Ol,useCallback:Ft,useContext:Ft,useEffect:Ft,useImperativeHandle:Ft,useLayoutEffect:Ft,useInsertionEffect:Ft,useMemo:Ft,useReducer:Ft,useRef:Ft,useState:Ft,useDebugValue:Ft,useDeferredValue:Ft,useTransition:Ft,useSyncExternalStore:Ft,useId:Ft,useHostTransitionStatus:Ft,useFormState:Ft,useActionState:Ft,useOptimistic:Ft,useMemoCache:Ft,useCacheRefresh:Ft},sp={readContext:ln,use:Ol,useCallback:function(e,n){return yn().memoizedState=[e,n===void 0?null:n],e},useContext:ln,useEffect:zu,useImperativeHandle:function(e,n,r){r=r!=null?r.concat([e]):null,Il(4194308,4,Qu.bind(null,n,e),r)},useLayoutEffect:function(e,n){return Il(4194308,4,e,n)},useInsertionEffect:function(e,n){Il(4,2,e,n)},useMemo:function(e,n){var r=yn();n=n===void 0?null:n;var d=e();if(la){dt(!0);try{e()}finally{dt(!1)}}return r.memoizedState=[d,n],d},useReducer:function(e,n,r){var d=yn();if(r!==void 0){var _=r(n);if(la){dt(!0);try{r(n)}finally{dt(!1)}}}else _=n;return d.memoizedState=d.baseState=_,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:_},d.queue=e,e=e.dispatch=eg.bind(null,Be,e),[d.memoizedState,e]},useRef:function(e){var n=yn();return e={current:e},n.memoizedState=e},useState:function(e){e=Is(e);var n=e.queue,r=rp.bind(null,Be,n);return n.dispatch=r,[e.memoizedState,r]},useDebugValue:Hs,useDeferredValue:function(e,n){var r=yn();return Bs(r,e,n)},useTransition:function(){var e=Is(!1);return e=ep.bind(null,Be,e.queue,!0,!1),yn().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,n,r){var d=Be,_=yn();if(ot){if(r===void 0)throw Error(i(407));r=r()}else{if(r=n(),ht===null)throw Error(i(349));(Ze&124)!==0||ku(d,n,r)}_.memoizedState=r;var m={value:r,getSnapshot:n};return _.queue=m,zu(Tu.bind(null,d,m,e),[e]),d.flags|=2048,qa(9,Pl(),Du.bind(null,d,m,r,n),null),r},useId:function(){var e=yn(),n=ht.identifierPrefix;if(ot){var r=lo,d=ro;r=(d&~(1<<32-Nt(d)-1)).toString(32)+r,n=""+n+"R"+r,r=$l++,0<r&&(n+="H"+r.toString(32)),n+=""}else r=Wy++,n=""+n+"r"+r.toString(32)+"";return e.memoizedState=n},useHostTransitionStatus:zs,useFormState:Iu,useActionState:Iu,useOptimistic:function(e){var n=yn();n.memoizedState=n.baseState=e;var r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return n.queue=r,n=Gs.bind(null,Be,!0,r),r.dispatch=n,[e,n]},useMemoCache:Os,useCacheRefresh:function(){return yn().memoizedState=Jy.bind(null,Be)}},ip={readContext:ln,use:Ol,useCallback:Zu,useContext:ln,useEffect:Gu,useImperativeHandle:Xu,useInsertionEffect:Yu,useLayoutEffect:Wu,useMemo:Ku,useReducer:Ll,useRef:Vu,useState:function(){return Ll(io)},useDebugValue:Hs,useDeferredValue:function(e,n){var r=$t();return Ju(r,ct.memoizedState,e,n)},useTransition:function(){var e=Ll(io)[0],n=$t().memoizedState;return[typeof e=="boolean"?e:Er(e),n]},useSyncExternalStore:ju,useId:op,useHostTransitionStatus:zs,useFormState:Mu,useActionState:Mu,useOptimistic:function(e,n){var r=$t();return Nu(r,ct,e,n)},useMemoCache:Os,useCacheRefresh:ap},tg={readContext:ln,use:Ol,useCallback:Zu,useContext:ln,useEffect:Gu,useImperativeHandle:Xu,useInsertionEffect:Yu,useLayoutEffect:Wu,useMemo:Ku,useReducer:Ps,useRef:Vu,useState:function(){return Ps(io)},useDebugValue:Hs,useDeferredValue:function(e,n){var r=$t();return ct===null?Bs(r,e,n):Ju(r,ct.memoizedState,e,n)},useTransition:function(){var e=Ps(io)[0],n=$t().memoizedState;return[typeof e=="boolean"?e:Er(e),n]},useSyncExternalStore:ju,useId:op,useHostTransitionStatus:zs,useFormState:Bu,useActionState:Bu,useOptimistic:function(e,n){var r=$t();return ct!==null?Nu(r,ct,e,n):(r.baseState=e,[e,r.queue.dispatch])},useMemoCache:Os,useCacheRefresh:ap},Na=null,jr=0;function Bl(e){var n=jr;return jr+=1,Na===null&&(Na=[]),wu(Na,e,n)}function kr(e,n){n=n.props.ref,e.ref=n!==void 0?n:null}function Vl(e,n){throw n.$$typeof===g?Error(i(525)):(e=Object.prototype.toString.call(n),Error(i(31,e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)))}function dp(e){var n=e._init;return n(e._payload)}function up(e){function n(X,G){if(e){var K=X.deletions;K===null?(X.deletions=[G],X.flags|=16):K.push(G)}}function r(X,G){if(!e)return null;for(;G!==null;)n(X,G),G=G.sibling;return null}function d(X){for(var G=new Map;X!==null;)X.key!==null?G.set(X.key,X):G.set(X.index,X),X=X.sibling;return G}function _(X,G){return X=ao(X,G),X.index=0,X.sibling=null,X}function m(X,G,K){return X.index=K,e?(K=X.alternate,K!==null?(K=K.index,K<G?(X.flags|=67108866,G):K):(X.flags|=67108866,G)):(X.flags|=1048576,G)}function k(X){return e&&X.alternate===null&&(X.flags|=67108866),X}function q(X,G,K,ue){return G===null||G.tag!==6?(G=fs(K,X.mode,ue),G.return=X,G):(G=_(G,K),G.return=X,G)}function M(X,G,K,ue){var Re=K.type;return Re===C?ie(X,G,K.props.children,ue,K.key):G!==null&&(G.elementType===Re||typeof Re=="object"&&Re!==null&&Re.$$typeof===V&&dp(Re)===G.type)?(G=_(G,K.props),kr(G,K),G.return=X,G):(G=Rl(K.type,K.key,K.props,null,X.mode,ue),kr(G,K),G.return=X,G)}function ee(X,G,K,ue){return G===null||G.tag!==4||G.stateNode.containerInfo!==K.containerInfo||G.stateNode.implementation!==K.implementation?(G=hs(K,X.mode,ue),G.return=X,G):(G=_(G,K.children||[]),G.return=X,G)}function ie(X,G,K,ue,Re){return G===null||G.tag!==7?(G=Ko(K,X.mode,ue,Re),G.return=X,G):(G=_(G,K),G.return=X,G)}function he(X,G,K){if(typeof G=="string"&&G!==""||typeof G=="number"||typeof G=="bigint")return G=fs(""+G,X.mode,K),G.return=X,G;if(typeof G=="object"&&G!==null){switch(G.$$typeof){case v:return K=Rl(G.type,G.key,G.props,null,X.mode,K),kr(K,G),K.return=X,K;case w:return G=hs(G,X.mode,K),G.return=X,G;case V:var ue=G._init;return G=ue(G._payload),he(X,G,K)}if(z(G)||H(G))return G=Ko(G,X.mode,K,null),G.return=X,G;if(typeof G.then=="function")return he(X,Bl(G),K);if(G.$$typeof===j)return he(X,Dl(X,G),K);Vl(X,G)}return null}function oe(X,G,K,ue){var Re=G!==null?G.key:null;if(typeof K=="string"&&K!==""||typeof K=="number"||typeof K=="bigint")return Re!==null?null:q(X,G,""+K,ue);if(typeof K=="object"&&K!==null){switch(K.$$typeof){case v:return K.key===Re?M(X,G,K,ue):null;case w:return K.key===Re?ee(X,G,K,ue):null;case V:return Re=K._init,K=Re(K._payload),oe(X,G,K,ue)}if(z(K)||H(K))return Re!==null?null:ie(X,G,K,ue,null);if(typeof K.then=="function")return oe(X,G,Bl(K),ue);if(K.$$typeof===j)return oe(X,G,Dl(X,K),ue);Vl(X,K)}return null}function ae(X,G,K,ue,Re){if(typeof ue=="string"&&ue!==""||typeof ue=="number"||typeof ue=="bigint")return X=X.get(K)||null,q(G,X,""+ue,Re);if(typeof ue=="object"&&ue!==null){switch(ue.$$typeof){case v:return X=X.get(ue.key===null?K:ue.key)||null,M(G,X,ue,Re);case w:return X=X.get(ue.key===null?K:ue.key)||null,ee(G,X,ue,Re);case V:var ze=ue._init;return ue=ze(ue._payload),ae(X,G,K,ue,Re)}if(z(ue)||H(ue))return X=X.get(K)||null,ie(G,X,ue,Re,null);if(typeof ue.then=="function")return ae(X,G,K,Bl(ue),Re);if(ue.$$typeof===j)return ae(X,G,K,Dl(G,ue),Re);Vl(G,ue)}return null}function Ue(X,G,K,ue){for(var Re=null,ze=null,Ae=G,qe=G=0,Yt=null;Ae!==null&&qe<K.length;qe++){Ae.index>qe?(Yt=Ae,Ae=null):Yt=Ae.sibling;var et=oe(X,Ae,K[qe],ue);if(et===null){Ae===null&&(Ae=Yt);break}e&&Ae&&et.alternate===null&&n(X,Ae),G=m(et,G,qe),ze===null?Re=et:ze.sibling=et,ze=et,Ae=Yt}if(qe===K.length)return r(X,Ae),ot&&ea(X,qe),Re;if(Ae===null){for(;qe<K.length;qe++)Ae=he(X,K[qe],ue),Ae!==null&&(G=m(Ae,G,qe),ze===null?Re=Ae:ze.sibling=Ae,ze=Ae);return ot&&ea(X,qe),Re}for(Ae=d(Ae);qe<K.length;qe++)Yt=ae(Ae,X,qe,K[qe],ue),Yt!==null&&(e&&Yt.alternate!==null&&Ae.delete(Yt.key===null?qe:Yt.key),G=m(Yt,G,qe),ze===null?Re=Yt:ze.sibling=Yt,ze=Yt);return e&&Ae.forEach(function(zo){return n(X,zo)}),ot&&ea(X,qe),Re}function Fe(X,G,K,ue){if(K==null)throw Error(i(151));for(var Re=null,ze=null,Ae=G,qe=G=0,Yt=null,et=K.next();Ae!==null&&!et.done;qe++,et=K.next()){Ae.index>qe?(Yt=Ae,Ae=null):Yt=Ae.sibling;var zo=oe(X,Ae,et.value,ue);if(zo===null){Ae===null&&(Ae=Yt);break}e&&Ae&&zo.alternate===null&&n(X,Ae),G=m(zo,G,qe),ze===null?Re=zo:ze.sibling=zo,ze=zo,Ae=Yt}if(et.done)return r(X,Ae),ot&&ea(X,qe),Re;if(Ae===null){for(;!et.done;qe++,et=K.next())et=he(X,et.value,ue),et!==null&&(G=m(et,G,qe),ze===null?Re=et:ze.sibling=et,ze=et);return ot&&ea(X,qe),Re}for(Ae=d(Ae);!et.done;qe++,et=K.next())et=ae(Ae,X,qe,et.value,ue),et!==null&&(e&&et.alternate!==null&&Ae.delete(et.key===null?qe:et.key),G=m(et,G,qe),ze===null?Re=et:ze.sibling=et,ze=et);return e&&Ae.forEach(function(nm){return n(X,nm)}),ot&&ea(X,qe),Re}function it(X,G,K,ue){if(typeof K=="object"&&K!==null&&K.type===C&&K.key===null&&(K=K.props.children),typeof K=="object"&&K!==null){switch(K.$$typeof){case v:e:{for(var Re=K.key;G!==null;){if(G.key===Re){if(Re=K.type,Re===C){if(G.tag===7){r(X,G.sibling),ue=_(G,K.props.children),ue.return=X,X=ue;break e}}else if(G.elementType===Re||typeof Re=="object"&&Re!==null&&Re.$$typeof===V&&dp(Re)===G.type){r(X,G.sibling),ue=_(G,K.props),kr(ue,K),ue.return=X,X=ue;break e}r(X,G);break}else n(X,G);G=G.sibling}K.type===C?(ue=Ko(K.props.children,X.mode,ue,K.key),ue.return=X,X=ue):(ue=Rl(K.type,K.key,K.props,null,X.mode,ue),kr(ue,K),ue.return=X,X=ue)}return k(X);case w:e:{for(Re=K.key;G!==null;){if(G.key===Re)if(G.tag===4&&G.stateNode.containerInfo===K.containerInfo&&G.stateNode.implementation===K.implementation){r(X,G.sibling),ue=_(G,K.children||[]),ue.return=X,X=ue;break e}else{r(X,G);break}else n(X,G);G=G.sibling}ue=hs(K,X.mode,ue),ue.return=X,X=ue}return k(X);case V:return Re=K._init,K=Re(K._payload),it(X,G,K,ue)}if(z(K))return Ue(X,G,K,ue);if(H(K)){if(Re=H(K),typeof Re!="function")throw Error(i(150));return K=Re.call(K),Fe(X,G,K,ue)}if(typeof K.then=="function")return it(X,G,Bl(K),ue);if(K.$$typeof===j)return it(X,G,Dl(X,K),ue);Vl(X,K)}return typeof K=="string"&&K!==""||typeof K=="number"||typeof K=="bigint"?(K=""+K,G!==null&&G.tag===6?(r(X,G.sibling),ue=_(G,K),ue.return=X,X=ue):(r(X,G),ue=fs(K,X.mode,ue),ue.return=X,X=ue),k(X)):r(X,G)}return function(X,G,K,ue){try{jr=0;var Re=it(X,G,K,ue);return Na=null,Re}catch(Ae){if(Ae===vr||Ae===Fl)throw Ae;var ze=xn(29,Ae,null,X.mode);return ze.lanes=ue,ze.return=X,ze}finally{}}}var Ua=up(!0),pp=up(!1),Un=P(null),Kn=null;function Do(e){var n=e.alternate;Q(Mt,Mt.current&1),Q(Un,e),Kn===null&&(n===null||Da.current!==null||n.memoizedState!==null)&&(Kn=e)}function fp(e){if(e.tag===22){if(Q(Mt,Mt.current),Q(Un,e),Kn===null){var n=e.alternate;n!==null&&n.memoizedState!==null&&(Kn=e)}}else To()}function To(){Q(Mt,Mt.current),Q(Un,Un.current)}function uo(e){Z(Un),Kn===e&&(Kn=null),Z(Mt)}var Mt=P(0);function zl(e){for(var n=e;n!==null;){if(n.tag===13){var r=n.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||$i(r)))return n}else if(n.tag===19&&n.memoizedProps.revealOrder!==void 0){if((n.flags&128)!==0)return n}else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return null;n=n.return}n.sibling.return=n.return,n=n.sibling}return null}function Ys(e,n,r,d){n=e.memoizedState,r=r(d,n),r=r==null?n:y({},n,r),e.memoizedState=r,e.lanes===0&&(e.updateQueue.baseState=r)}var Ws={enqueueSetState:function(e,n,r){e=e._reactInternals;var d=Rn(),_=Ao(d);_.payload=n,r!=null&&(_.callback=r),n=jo(e,_,d),n!==null&&(An(n,e,d),Cr(n,e,d))},enqueueReplaceState:function(e,n,r){e=e._reactInternals;var d=Rn(),_=Ao(d);_.tag=1,_.payload=n,r!=null&&(_.callback=r),n=jo(e,_,d),n!==null&&(An(n,e,d),Cr(n,e,d))},enqueueForceUpdate:function(e,n){e=e._reactInternals;var r=Rn(),d=Ao(r);d.tag=2,n!=null&&(d.callback=n),n=jo(e,d,r),n!==null&&(An(n,e,r),Cr(n,e,r))}};function hp(e,n,r,d,_,m,k){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(d,m,k):n.prototype&&n.prototype.isPureReactComponent?!ur(r,d)||!ur(_,m):!0}function _p(e,n,r,d){e=n.state,typeof n.componentWillReceiveProps=="function"&&n.componentWillReceiveProps(r,d),typeof n.UNSAFE_componentWillReceiveProps=="function"&&n.UNSAFE_componentWillReceiveProps(r,d),n.state!==e&&Ws.enqueueReplaceState(n,n.state,null)}function ca(e,n){var r=n;if("ref"in n){r={};for(var d in n)d!=="ref"&&(r[d]=n[d])}if(e=e.defaultProps){r===n&&(r=y({},r));for(var _ in e)r[_]===void 0&&(r[_]=e[_])}return r}var Gl=typeof reportError=="function"?reportError:function(e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var n=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof e=="object"&&e!==null&&typeof e.message=="string"?String(e.message):String(e),error:e});if(!window.dispatchEvent(n))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",e);return}console.error(e)};function yp(e){Gl(e)}function gp(e){console.error(e)}function mp(e){Gl(e)}function Yl(e,n){try{var r=e.onUncaughtError;r(n.value,{componentStack:n.stack})}catch(d){setTimeout(function(){throw d})}}function vp(e,n,r){try{var d=e.onCaughtError;d(r.value,{componentStack:r.stack,errorBoundary:n.tag===1?n.stateNode:null})}catch(_){setTimeout(function(){throw _})}}function Qs(e,n,r){return r=Ao(r),r.tag=3,r.payload={element:null},r.callback=function(){Yl(e,n)},r}function wp(e){return e=Ao(e),e.tag=3,e}function Cp(e,n,r,d){var _=r.type.getDerivedStateFromError;if(typeof _=="function"){var m=d.value;e.payload=function(){return _(m)},e.callback=function(){vp(n,r,d)}}var k=r.stateNode;k!==null&&typeof k.componentDidCatch=="function"&&(e.callback=function(){vp(n,r,d),typeof _!="function"&&(Oo===null?Oo=new Set([this]):Oo.add(this));var q=d.stack;this.componentDidCatch(d.value,{componentStack:q!==null?q:""})})}function ng(e,n,r,d,_){if(r.flags|=32768,d!==null&&typeof d=="object"&&typeof d.then=="function"){if(n=r.alternate,n!==null&&yr(n,r,_,!0),r=Un.current,r!==null){switch(r.tag){case 13:return Kn===null?vi():r.alternate===null&&kt===0&&(kt=3),r.flags&=-257,r.flags|=65536,r.lanes=_,d===bs?r.flags|=16384:(n=r.updateQueue,n===null?r.updateQueue=new Set([d]):n.add(d),Ci(e,d,_)),!1;case 22:return r.flags|=65536,d===bs?r.flags|=16384:(n=r.updateQueue,n===null?(n={transitions:null,markerInstances:null,retryQueue:new Set([d])},r.updateQueue=n):(r=n.retryQueue,r===null?n.retryQueue=new Set([d]):r.add(d)),Ci(e,d,_)),!1}throw Error(i(435,r.tag))}return Ci(e,d,_),vi(),!1}if(ot)return n=Un.current,n!==null?((n.flags&65536)===0&&(n.flags|=256),n.flags|=65536,n.lanes=_,d!==gs&&(e=Error(i(422),{cause:d}),_r(Tn(e,r)))):(d!==gs&&(n=Error(i(423),{cause:d}),_r(Tn(n,r))),e=e.current.alternate,e.flags|=65536,_&=-_,e.lanes|=_,d=Tn(d,r),_=Qs(e.stateNode,d,_),As(e,_),kt!==4&&(kt=2)),!1;var m=Error(i(520),{cause:d});if(m=Tn(m,r),$r===null?$r=[m]:$r.push(m),kt!==4&&(kt=2),n===null)return!0;d=Tn(d,r),r=n;do{switch(r.tag){case 3:return r.flags|=65536,e=_&-_,r.lanes|=e,e=Qs(r.stateNode,d,e),As(r,e),!1;case 1:if(n=r.type,m=r.stateNode,(r.flags&128)===0&&(typeof n.getDerivedStateFromError=="function"||m!==null&&typeof m.componentDidCatch=="function"&&(Oo===null||!Oo.has(m))))return r.flags|=65536,_&=-_,r.lanes|=_,_=wp(_),Cp(_,e,r,d),As(r,_),!1}r=r.return}while(r!==null);return!1}var xp=Error(i(461)),zt=!1;function Zt(e,n,r,d){n.child=e===null?pp(n,null,r,d):Ua(n,e.child,r,d)}function Sp(e,n,r,d,_){r=r.render;var m=n.ref;if("ref"in d){var k={};for(var q in d)q!=="ref"&&(k[q]=d[q])}else k=d;return aa(n),d=Fs(e,n,r,k,m,_),q=qs(),e!==null&&!zt?(Ns(e,n,_),po(e,n,_)):(ot&&q&&_s(n),n.flags|=1,Zt(e,n,d,_),n.child)}function bp(e,n,r,d,_){if(e===null){var m=r.type;return typeof m=="function"&&!ps(m)&&m.defaultProps===void 0&&r.compare===null?(n.tag=15,n.type=m,Ep(e,n,m,d,_)):(e=Rl(r.type,null,d,n,n.mode,_),e.ref=n.ref,e.return=n,n.child=e)}if(m=e.child,!oi(e,_)){var k=m.memoizedProps;if(r=r.compare,r=r!==null?r:ur,r(k,d)&&e.ref===n.ref)return po(e,n,_)}return n.flags|=1,e=ao(m,d),e.ref=n.ref,e.return=n,n.child=e}function Ep(e,n,r,d,_){if(e!==null){var m=e.memoizedProps;if(ur(m,d)&&e.ref===n.ref)if(zt=!1,n.pendingProps=d=m,oi(e,_))(e.flags&131072)!==0&&(zt=!0);else return n.lanes=e.lanes,po(e,n,_)}return Xs(e,n,r,d,_)}function Rp(e,n,r){var d=n.pendingProps,_=d.children,m=e!==null?e.memoizedState:null;if(d.mode==="hidden"){if((n.flags&128)!==0){if(d=m!==null?m.baseLanes|r:r,e!==null){for(_=n.child=e.child,m=0;_!==null;)m=m|_.lanes|_.childLanes,_=_.sibling;n.childLanes=m&~d}else n.childLanes=0,n.child=null;return Ap(e,n,d,r)}if((r&536870912)!==0)n.memoizedState={baseLanes:0,cachePool:null},e!==null&&Tl(n,m!==null?m.cachePool:null),m!==null?Eu(n,m):ks(),fp(n);else return n.lanes=n.childLanes=536870912,Ap(e,n,m!==null?m.baseLanes|r:r,r)}else m!==null?(Tl(n,m.cachePool),Eu(n,m),To(),n.memoizedState=null):(e!==null&&Tl(n,null),ks(),To());return Zt(e,n,_,r),n.child}function Ap(e,n,r,d){var _=Ss();return _=_===null?null:{parent:It._currentValue,pool:_},n.memoizedState={baseLanes:r,cachePool:_},e!==null&&Tl(n,null),ks(),fp(n),e!==null&&yr(e,n,d,!0),null}function Wl(e,n){var r=n.ref;if(r===null)e!==null&&e.ref!==null&&(n.flags|=4194816);else{if(typeof r!="function"&&typeof r!="object")throw Error(i(284));(e===null||e.ref!==r)&&(n.flags|=4194816)}}function Xs(e,n,r,d,_){return aa(n),r=Fs(e,n,r,d,void 0,_),d=qs(),e!==null&&!zt?(Ns(e,n,_),po(e,n,_)):(ot&&d&&_s(n),n.flags|=1,Zt(e,n,r,_),n.child)}function jp(e,n,r,d,_,m){return aa(n),n.updateQueue=null,r=Au(n,d,r,_),Ru(e),d=qs(),e!==null&&!zt?(Ns(e,n,m),po(e,n,m)):(ot&&d&&_s(n),n.flags|=1,Zt(e,n,r,m),n.child)}function kp(e,n,r,d,_){if(aa(n),n.stateNode===null){var m=Ea,k=r.contextType;typeof k=="object"&&k!==null&&(m=ln(k)),m=new r(d,m),n.memoizedState=m.state!==null&&m.state!==void 0?m.state:null,m.updater=Ws,n.stateNode=m,m._reactInternals=n,m=n.stateNode,m.props=d,m.state=n.memoizedState,m.refs={},Es(n),k=r.contextType,m.context=typeof k=="object"&&k!==null?ln(k):Ea,m.state=n.memoizedState,k=r.getDerivedStateFromProps,typeof k=="function"&&(Ys(n,r,k,d),m.state=n.memoizedState),typeof r.getDerivedStateFromProps=="function"||typeof m.getSnapshotBeforeUpdate=="function"||typeof m.UNSAFE_componentWillMount!="function"&&typeof m.componentWillMount!="function"||(k=m.state,typeof m.componentWillMount=="function"&&m.componentWillMount(),typeof m.UNSAFE_componentWillMount=="function"&&m.UNSAFE_componentWillMount(),k!==m.state&&Ws.enqueueReplaceState(m,m.state,null),Sr(n,d,m,_),xr(),m.state=n.memoizedState),typeof m.componentDidMount=="function"&&(n.flags|=4194308),d=!0}else if(e===null){m=n.stateNode;var q=n.memoizedProps,M=ca(r,q);m.props=M;var ee=m.context,ie=r.contextType;k=Ea,typeof ie=="object"&&ie!==null&&(k=ln(ie));var he=r.getDerivedStateFromProps;ie=typeof he=="function"||typeof m.getSnapshotBeforeUpdate=="function",q=n.pendingProps!==q,ie||typeof m.UNSAFE_componentWillReceiveProps!="function"&&typeof m.componentWillReceiveProps!="function"||(q||ee!==k)&&_p(n,m,d,k),Ro=!1;var oe=n.memoizedState;m.state=oe,Sr(n,d,m,_),xr(),ee=n.memoizedState,q||oe!==ee||Ro?(typeof he=="function"&&(Ys(n,r,he,d),ee=n.memoizedState),(M=Ro||hp(n,r,M,d,oe,ee,k))?(ie||typeof m.UNSAFE_componentWillMount!="function"&&typeof m.componentWillMount!="function"||(typeof m.componentWillMount=="function"&&m.componentWillMount(),typeof m.UNSAFE_componentWillMount=="function"&&m.UNSAFE_componentWillMount()),typeof m.componentDidMount=="function"&&(n.flags|=4194308)):(typeof m.componentDidMount=="function"&&(n.flags|=4194308),n.memoizedProps=d,n.memoizedState=ee),m.props=d,m.state=ee,m.context=k,d=M):(typeof m.componentDidMount=="function"&&(n.flags|=4194308),d=!1)}else{m=n.stateNode,Rs(e,n),k=n.memoizedProps,ie=ca(r,k),m.props=ie,he=n.pendingProps,oe=m.context,ee=r.contextType,M=Ea,typeof ee=="object"&&ee!==null&&(M=ln(ee)),q=r.getDerivedStateFromProps,(ee=typeof q=="function"||typeof m.getSnapshotBeforeUpdate=="function")||typeof m.UNSAFE_componentWillReceiveProps!="function"&&typeof m.componentWillReceiveProps!="function"||(k!==he||oe!==M)&&_p(n,m,d,M),Ro=!1,oe=n.memoizedState,m.state=oe,Sr(n,d,m,_),xr();var ae=n.memoizedState;k!==he||oe!==ae||Ro||e!==null&&e.dependencies!==null&&kl(e.dependencies)?(typeof q=="function"&&(Ys(n,r,q,d),ae=n.memoizedState),(ie=Ro||hp(n,r,ie,d,oe,ae,M)||e!==null&&e.dependencies!==null&&kl(e.dependencies))?(ee||typeof m.UNSAFE_componentWillUpdate!="function"&&typeof m.componentWillUpdate!="function"||(typeof m.componentWillUpdate=="function"&&m.componentWillUpdate(d,ae,M),typeof m.UNSAFE_componentWillUpdate=="function"&&m.UNSAFE_componentWillUpdate(d,ae,M)),typeof m.componentDidUpdate=="function"&&(n.flags|=4),typeof m.getSnapshotBeforeUpdate=="function"&&(n.flags|=1024)):(typeof m.componentDidUpdate!="function"||k===e.memoizedProps&&oe===e.memoizedState||(n.flags|=4),typeof m.getSnapshotBeforeUpdate!="function"||k===e.memoizedProps&&oe===e.memoizedState||(n.flags|=1024),n.memoizedProps=d,n.memoizedState=ae),m.props=d,m.state=ae,m.context=M,d=ie):(typeof m.componentDidUpdate!="function"||k===e.memoizedProps&&oe===e.memoizedState||(n.flags|=4),typeof m.getSnapshotBeforeUpdate!="function"||k===e.memoizedProps&&oe===e.memoizedState||(n.flags|=1024),d=!1)}return m=d,Wl(e,n),d=(n.flags&128)!==0,m||d?(m=n.stateNode,r=d&&typeof r.getDerivedStateFromError!="function"?null:m.render(),n.flags|=1,e!==null&&d?(n.child=Ua(n,e.child,null,_),n.child=Ua(n,null,r,_)):Zt(e,n,r,_),n.memoizedState=m.state,e=n.child):e=po(e,n,_),e}function Dp(e,n,r,d){return hr(),n.flags|=256,Zt(e,n,r,d),n.child}var Zs={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Ks(e){return{baseLanes:e,cachePool:gu()}}function Js(e,n,r){return e=e!==null?e.childLanes&~r:0,n&&(e|=$n),e}function Tp(e,n,r){var d=n.pendingProps,_=!1,m=(n.flags&128)!==0,k;if((k=m)||(k=e!==null&&e.memoizedState===null?!1:(Mt.current&2)!==0),k&&(_=!0,n.flags&=-129),k=(n.flags&32)!==0,n.flags&=-33,e===null){if(ot){if(_?Do(n):To(),ot){var q=jt,M;if(M=q){e:{for(M=q,q=Zn;M.nodeType!==8;){if(!q){q=null;break e}if(M=Vn(M.nextSibling),M===null){q=null;break e}}q=M}q!==null?(n.memoizedState={dehydrated:q,treeContext:Jo!==null?{id:ro,overflow:lo}:null,retryLane:536870912,hydrationErrors:null},M=xn(18,null,null,0),M.stateNode=q,M.return=n,n.child=M,pn=n,jt=null,M=!0):M=!1}M||na(n)}if(q=n.memoizedState,q!==null&&(q=q.dehydrated,q!==null))return $i(q)?n.lanes=32:n.lanes=536870912,null;uo(n)}return q=d.children,d=d.fallback,_?(To(),_=n.mode,q=Ql({mode:"hidden",children:q},_),d=Ko(d,_,r,null),q.return=n,d.return=n,q.sibling=d,n.child=q,_=n.child,_.memoizedState=Ks(r),_.childLanes=Js(e,k,r),n.memoizedState=Zs,d):(Do(n),ei(n,q))}if(M=e.memoizedState,M!==null&&(q=M.dehydrated,q!==null)){if(m)n.flags&256?(Do(n),n.flags&=-257,n=ti(e,n,r)):n.memoizedState!==null?(To(),n.child=e.child,n.flags|=128,n=null):(To(),_=d.fallback,q=n.mode,d=Ql({mode:"visible",children:d.children},q),_=Ko(_,q,r,null),_.flags|=2,d.return=n,_.return=n,d.sibling=_,n.child=d,Ua(n,e.child,null,r),d=n.child,d.memoizedState=Ks(r),d.childLanes=Js(e,k,r),n.memoizedState=Zs,n=_);else if(Do(n),$i(q)){if(k=q.nextSibling&&q.nextSibling.dataset,k)var ee=k.dgst;k=ee,d=Error(i(419)),d.stack="",d.digest=k,_r({value:d,source:null,stack:null}),n=ti(e,n,r)}else if(zt||yr(e,n,r,!1),k=(r&e.childLanes)!==0,zt||k){if(k=ht,k!==null&&(d=r&-r,d=(d&42)!==0?1:nr(d),d=(d&(k.suspendedLanes|r))!==0?0:d,d!==0&&d!==M.retryLane))throw M.retryLane=d,ba(e,d),An(k,e,d),xp;q.data==="$?"||vi(),n=ti(e,n,r)}else q.data==="$?"?(n.flags|=192,n.child=e.child,n=null):(e=M.treeContext,jt=Vn(q.nextSibling),pn=n,ot=!0,ta=null,Zn=!1,e!==null&&(qn[Nn++]=ro,qn[Nn++]=lo,qn[Nn++]=Jo,ro=e.id,lo=e.overflow,Jo=n),n=ei(n,d.children),n.flags|=4096);return n}return _?(To(),_=d.fallback,q=n.mode,M=e.child,ee=M.sibling,d=ao(M,{mode:"hidden",children:d.children}),d.subtreeFlags=M.subtreeFlags&65011712,ee!==null?_=ao(ee,_):(_=Ko(_,q,r,null),_.flags|=2),_.return=n,d.return=n,d.sibling=_,n.child=d,d=_,_=n.child,q=e.child.memoizedState,q===null?q=Ks(r):(M=q.cachePool,M!==null?(ee=It._currentValue,M=M.parent!==ee?{parent:ee,pool:ee}:M):M=gu(),q={baseLanes:q.baseLanes|r,cachePool:M}),_.memoizedState=q,_.childLanes=Js(e,k,r),n.memoizedState=Zs,d):(Do(n),r=e.child,e=r.sibling,r=ao(r,{mode:"visible",children:d.children}),r.return=n,r.sibling=null,e!==null&&(k=n.deletions,k===null?(n.deletions=[e],n.flags|=16):k.push(e)),n.child=r,n.memoizedState=null,r)}function ei(e,n){return n=Ql({mode:"visible",children:n},e.mode),n.return=e,e.child=n}function Ql(e,n){return e=xn(22,e,null,n),e.lanes=0,e.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},e}function ti(e,n,r){return Ua(n,e.child,null,r),e=ei(n,n.pendingProps.children),e.flags|=2,n.memoizedState=null,e}function Fp(e,n,r){e.lanes|=n;var d=e.alternate;d!==null&&(d.lanes|=n),vs(e.return,n,r)}function ni(e,n,r,d,_){var m=e.memoizedState;m===null?e.memoizedState={isBackwards:n,rendering:null,renderingStartTime:0,last:d,tail:r,tailMode:_}:(m.isBackwards=n,m.rendering=null,m.renderingStartTime=0,m.last=d,m.tail=r,m.tailMode=_)}function qp(e,n,r){var d=n.pendingProps,_=d.revealOrder,m=d.tail;if(Zt(e,n,d.children,r),d=Mt.current,(d&2)!==0)d=d&1|2,n.flags|=128;else{if(e!==null&&(e.flags&128)!==0)e:for(e=n.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&Fp(e,r,n);else if(e.tag===19)Fp(e,r,n);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break e;for(;e.sibling===null;){if(e.return===null||e.return===n)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}d&=1}switch(Q(Mt,d),_){case"forwards":for(r=n.child,_=null;r!==null;)e=r.alternate,e!==null&&zl(e)===null&&(_=r),r=r.sibling;r=_,r===null?(_=n.child,n.child=null):(_=r.sibling,r.sibling=null),ni(n,!1,_,r,m);break;case"backwards":for(r=null,_=n.child,n.child=null;_!==null;){if(e=_.alternate,e!==null&&zl(e)===null){n.child=_;break}e=_.sibling,_.sibling=r,r=_,_=e}ni(n,!0,r,null,m);break;case"together":ni(n,!1,null,null,void 0);break;default:n.memoizedState=null}return n.child}function po(e,n,r){if(e!==null&&(n.dependencies=e.dependencies),$o|=n.lanes,(r&n.childLanes)===0)if(e!==null){if(yr(e,n,r,!1),(r&n.childLanes)===0)return null}else return null;if(e!==null&&n.child!==e.child)throw Error(i(153));if(n.child!==null){for(e=n.child,r=ao(e,e.pendingProps),n.child=r,r.return=n;e.sibling!==null;)e=e.sibling,r=r.sibling=ao(e,e.pendingProps),r.return=n;r.sibling=null}return n.child}function oi(e,n){return(e.lanes&n)!==0?!0:(e=e.dependencies,!!(e!==null&&kl(e)))}function og(e,n,r){switch(n.tag){case 3:Xe(n,n.stateNode.containerInfo),Eo(n,It,e.memoizedState.cache),hr();break;case 27:case 5:ce(n);break;case 4:Xe(n,n.stateNode.containerInfo);break;case 10:Eo(n,n.type,n.memoizedProps.value);break;case 13:var d=n.memoizedState;if(d!==null)return d.dehydrated!==null?(Do(n),n.flags|=128,null):(r&n.child.childLanes)!==0?Tp(e,n,r):(Do(n),e=po(e,n,r),e!==null?e.sibling:null);Do(n);break;case 19:var _=(e.flags&128)!==0;if(d=(r&n.childLanes)!==0,d||(yr(e,n,r,!1),d=(r&n.childLanes)!==0),_){if(d)return qp(e,n,r);n.flags|=128}if(_=n.memoizedState,_!==null&&(_.rendering=null,_.tail=null,_.lastEffect=null),Q(Mt,Mt.current),d)break;return null;case 22:case 23:return n.lanes=0,Rp(e,n,r);case 24:Eo(n,It,e.memoizedState.cache)}return po(e,n,r)}function Np(e,n,r){if(e!==null)if(e.memoizedProps!==n.pendingProps)zt=!0;else{if(!oi(e,r)&&(n.flags&128)===0)return zt=!1,og(e,n,r);zt=(e.flags&131072)!==0}else zt=!1,ot&&(n.flags&1048576)!==0&&du(n,jl,n.index);switch(n.lanes=0,n.tag){case 16:e:{e=n.pendingProps;var d=n.elementType,_=d._init;if(d=_(d._payload),n.type=d,typeof d=="function")ps(d)?(e=ca(d,e),n.tag=1,n=kp(null,n,d,e,r)):(n.tag=0,n=Xs(null,n,d,e,r));else{if(d!=null){if(_=d.$$typeof,_===R){n.tag=11,n=Sp(null,n,d,e,r);break e}else if(_===I){n.tag=14,n=bp(null,n,d,e,r);break e}}throw n=ne(d)||d,Error(i(306,n,""))}}return n;case 0:return Xs(e,n,n.type,n.pendingProps,r);case 1:return d=n.type,_=ca(d,n.pendingProps),kp(e,n,d,_,r);case 3:e:{if(Xe(n,n.stateNode.containerInfo),e===null)throw Error(i(387));d=n.pendingProps;var m=n.memoizedState;_=m.element,Rs(e,n),Sr(n,d,null,r);var k=n.memoizedState;if(d=k.cache,Eo(n,It,d),d!==m.cache&&ws(n,[It],r,!0),xr(),d=k.element,m.isDehydrated)if(m={element:d,isDehydrated:!1,cache:k.cache},n.updateQueue.baseState=m,n.memoizedState=m,n.flags&256){n=Dp(e,n,d,r);break e}else if(d!==_){_=Tn(Error(i(424)),n),_r(_),n=Dp(e,n,d,r);break e}else{switch(e=n.stateNode.containerInfo,e.nodeType){case 9:e=e.body;break;default:e=e.nodeName==="HTML"?e.ownerDocument.body:e}for(jt=Vn(e.firstChild),pn=n,ot=!0,ta=null,Zn=!0,r=pp(n,null,d,r),n.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling}else{if(hr(),d===_){n=po(e,n,r);break e}Zt(e,n,d,r)}n=n.child}return n;case 26:return Wl(e,n),e===null?(r=Pf(n.type,null,n.pendingProps,null))?n.memoizedState=r:ot||(r=n.type,e=n.pendingProps,d=ic(ve.current).createElement(r),d[Bt]=n,d[Qt]=e,Jt(d,r,e),ft(d),n.stateNode=d):n.memoizedState=Pf(n.type,e.memoizedProps,n.pendingProps,e.memoizedState),null;case 27:return ce(n),e===null&&ot&&(d=n.stateNode=$f(n.type,n.pendingProps,ve.current),pn=n,Zn=!0,_=jt,Io(n.type)?(Oi=_,jt=Vn(d.firstChild)):jt=_),Zt(e,n,n.pendingProps.children,r),Wl(e,n),e===null&&(n.flags|=4194304),n.child;case 5:return e===null&&ot&&((_=d=jt)&&(d=Tg(d,n.type,n.pendingProps,Zn),d!==null?(n.stateNode=d,pn=n,jt=Vn(d.firstChild),Zn=!1,_=!0):_=!1),_||na(n)),ce(n),_=n.type,m=n.pendingProps,k=e!==null?e.memoizedProps:null,d=m.children,qi(_,m)?d=null:k!==null&&qi(_,k)&&(n.flags|=32),n.memoizedState!==null&&(_=Fs(e,n,Qy,null,null,r),zr._currentValue=_),Wl(e,n),Zt(e,n,d,r),n.child;case 6:return e===null&&ot&&((e=r=jt)&&(r=Fg(r,n.pendingProps,Zn),r!==null?(n.stateNode=r,pn=n,jt=null,e=!0):e=!1),e||na(n)),null;case 13:return Tp(e,n,r);case 4:return Xe(n,n.stateNode.containerInfo),d=n.pendingProps,e===null?n.child=Ua(n,null,d,r):Zt(e,n,d,r),n.child;case 11:return Sp(e,n,n.type,n.pendingProps,r);case 7:return Zt(e,n,n.pendingProps,r),n.child;case 8:return Zt(e,n,n.pendingProps.children,r),n.child;case 12:return Zt(e,n,n.pendingProps.children,r),n.child;case 10:return d=n.pendingProps,Eo(n,n.type,d.value),Zt(e,n,d.children,r),n.child;case 9:return _=n.type._context,d=n.pendingProps.children,aa(n),_=ln(_),d=d(_),n.flags|=1,Zt(e,n,d,r),n.child;case 14:return bp(e,n,n.type,n.pendingProps,r);case 15:return Ep(e,n,n.type,n.pendingProps,r);case 19:return qp(e,n,r);case 31:return d=n.pendingProps,r=n.mode,d={mode:d.mode,children:d.children},e===null?(r=Ql(d,r),r.ref=n.ref,n.child=r,r.return=n,n=r):(r=ao(e.child,d),r.ref=n.ref,n.child=r,r.return=n,n=r),n;case 22:return Rp(e,n,r);case 24:return aa(n),d=ln(It),e===null?(_=Ss(),_===null&&(_=ht,m=Cs(),_.pooledCache=m,m.refCount++,m!==null&&(_.pooledCacheLanes|=r),_=m),n.memoizedState={parent:d,cache:_},Es(n),Eo(n,It,_)):((e.lanes&r)!==0&&(Rs(e,n),Sr(n,null,null,r),xr()),_=e.memoizedState,m=n.memoizedState,_.parent!==d?(_={parent:d,cache:d},n.memoizedState=_,n.lanes===0&&(n.memoizedState=n.updateQueue.baseState=_),Eo(n,It,d)):(d=m.cache,Eo(n,It,d),d!==_.cache&&ws(n,[It],r,!0))),Zt(e,n,n.pendingProps.children,r),n.child;case 29:throw n.pendingProps}throw Error(i(156,n.tag))}function fo(e){e.flags|=4}function Up(e,n){if(n.type!=="stylesheet"||(n.state.loading&4)!==0)e.flags&=-16777217;else if(e.flags|=16777216,!Vf(n)){if(n=Un.current,n!==null&&((Ze&4194048)===Ze?Kn!==null:(Ze&62914560)!==Ze&&(Ze&536870912)===0||n!==Kn))throw wr=bs,mu;e.flags|=8192}}function Xl(e,n){n!==null&&(e.flags|=4),e.flags&16384&&(n=e.tag!==22?Tt():536870912,e.lanes|=n,Pa|=n)}function Dr(e,n){if(!ot)switch(e.tailMode){case"hidden":n=e.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e.tail=null:r.sibling=null;break;case"collapsed":r=e.tail;for(var d=null;r!==null;)r.alternate!==null&&(d=r),r=r.sibling;d===null?n||e.tail===null?e.tail=null:e.tail.sibling=null:d.sibling=null}}function St(e){var n=e.alternate!==null&&e.alternate.child===e.child,r=0,d=0;if(n)for(var _=e.child;_!==null;)r|=_.lanes|_.childLanes,d|=_.subtreeFlags&65011712,d|=_.flags&65011712,_.return=e,_=_.sibling;else for(_=e.child;_!==null;)r|=_.lanes|_.childLanes,d|=_.subtreeFlags,d|=_.flags,_.return=e,_=_.sibling;return e.subtreeFlags|=d,e.childLanes=r,n}function ag(e,n,r){var d=n.pendingProps;switch(ys(n),n.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return St(n),null;case 1:return St(n),null;case 3:return r=n.stateNode,d=null,e!==null&&(d=e.memoizedState.cache),n.memoizedState.cache!==d&&(n.flags|=2048),so(It),de(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(e===null||e.child===null)&&(fr(n)?fo(n):e===null||e.memoizedState.isDehydrated&&(n.flags&256)===0||(n.flags|=1024,fu())),St(n),null;case 26:return r=n.memoizedState,e===null?(fo(n),r!==null?(St(n),Up(n,r)):(St(n),n.flags&=-16777217)):r?r!==e.memoizedState?(fo(n),St(n),Up(n,r)):(St(n),n.flags&=-16777217):(e.memoizedProps!==d&&fo(n),St(n),n.flags&=-16777217),null;case 27:le(n),r=ve.current;var _=n.type;if(e!==null&&n.stateNode!=null)e.memoizedProps!==d&&fo(n);else{if(!d){if(n.stateNode===null)throw Error(i(166));return St(n),null}e=pe.current,fr(n)?uu(n):(e=$f(_,d,r),n.stateNode=e,fo(n))}return St(n),null;case 5:if(le(n),r=n.type,e!==null&&n.stateNode!=null)e.memoizedProps!==d&&fo(n);else{if(!d){if(n.stateNode===null)throw Error(i(166));return St(n),null}if(e=pe.current,fr(n))uu(n);else{switch(_=ic(ve.current),e){case 1:e=_.createElementNS("http://www.w3.org/2000/svg",r);break;case 2:e=_.createElementNS("http://www.w3.org/1998/Math/MathML",r);break;default:switch(r){case"svg":e=_.createElementNS("http://www.w3.org/2000/svg",r);break;case"math":e=_.createElementNS("http://www.w3.org/1998/Math/MathML",r);break;case"script":e=_.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild);break;case"select":e=typeof d.is=="string"?_.createElement("select",{is:d.is}):_.createElement("select"),d.multiple?e.multiple=!0:d.size&&(e.size=d.size);break;default:e=typeof d.is=="string"?_.createElement(r,{is:d.is}):_.createElement(r)}}e[Bt]=n,e[Qt]=d;e:for(_=n.child;_!==null;){if(_.tag===5||_.tag===6)e.appendChild(_.stateNode);else if(_.tag!==4&&_.tag!==27&&_.child!==null){_.child.return=_,_=_.child;continue}if(_===n)break e;for(;_.sibling===null;){if(_.return===null||_.return===n)break e;_=_.return}_.sibling.return=_.return,_=_.sibling}n.stateNode=e;e:switch(Jt(e,r,d),r){case"button":case"input":case"select":case"textarea":e=!!d.autoFocus;break e;case"img":e=!0;break e;default:e=!1}e&&fo(n)}}return St(n),n.flags&=-16777217,null;case 6:if(e&&n.stateNode!=null)e.memoizedProps!==d&&fo(n);else{if(typeof d!="string"&&n.stateNode===null)throw Error(i(166));if(e=ve.current,fr(n)){if(e=n.stateNode,r=n.memoizedProps,d=null,_=pn,_!==null)switch(_.tag){case 27:case 5:d=_.memoizedProps}e[Bt]=n,e=!!(e.nodeValue===r||d!==null&&d.suppressHydrationWarning===!0||kf(e.nodeValue,r)),e||na(n)}else e=ic(e).createTextNode(d),e[Bt]=n,n.stateNode=e}return St(n),null;case 13:if(d=n.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(_=fr(n),d!==null&&d.dehydrated!==null){if(e===null){if(!_)throw Error(i(318));if(_=n.memoizedState,_=_!==null?_.dehydrated:null,!_)throw Error(i(317));_[Bt]=n}else hr(),(n.flags&128)===0&&(n.memoizedState=null),n.flags|=4;St(n),_=!1}else _=fu(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=_),_=!0;if(!_)return n.flags&256?(uo(n),n):(uo(n),null)}if(uo(n),(n.flags&128)!==0)return n.lanes=r,n;if(r=d!==null,e=e!==null&&e.memoizedState!==null,r){d=n.child,_=null,d.alternate!==null&&d.alternate.memoizedState!==null&&d.alternate.memoizedState.cachePool!==null&&(_=d.alternate.memoizedState.cachePool.pool);var m=null;d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(m=d.memoizedState.cachePool.pool),m!==_&&(d.flags|=2048)}return r!==e&&r&&(n.child.flags|=8192),Xl(n,n.updateQueue),St(n),null;case 4:return de(),e===null&&ji(n.stateNode.containerInfo),St(n),null;case 10:return so(n.type),St(n),null;case 19:if(Z(Mt),_=n.memoizedState,_===null)return St(n),null;if(d=(n.flags&128)!==0,m=_.rendering,m===null)if(d)Dr(_,!1);else{if(kt!==0||e!==null&&(e.flags&128)!==0)for(e=n.child;e!==null;){if(m=zl(e),m!==null){for(n.flags|=128,Dr(_,!1),e=m.updateQueue,n.updateQueue=e,Xl(n,e),n.subtreeFlags=0,e=r,r=n.child;r!==null;)iu(r,e),r=r.sibling;return Q(Mt,Mt.current&1|2),n.child}e=e.sibling}_.tail!==null&&$e()>Jl&&(n.flags|=128,d=!0,Dr(_,!1),n.lanes=4194304)}else{if(!d)if(e=zl(m),e!==null){if(n.flags|=128,d=!0,e=e.updateQueue,n.updateQueue=e,Xl(n,e),Dr(_,!0),_.tail===null&&_.tailMode==="hidden"&&!m.alternate&&!ot)return St(n),null}else 2*$e()-_.renderingStartTime>Jl&&r!==536870912&&(n.flags|=128,d=!0,Dr(_,!1),n.lanes=4194304);_.isBackwards?(m.sibling=n.child,n.child=m):(e=_.last,e!==null?e.sibling=m:n.child=m,_.last=m)}return _.tail!==null?(n=_.tail,_.rendering=n,_.tail=n.sibling,_.renderingStartTime=$e(),n.sibling=null,e=Mt.current,Q(Mt,d?e&1|2:e&1),n):(St(n),null);case 22:case 23:return uo(n),Ds(),d=n.memoizedState!==null,e!==null?e.memoizedState!==null!==d&&(n.flags|=8192):d&&(n.flags|=8192),d?(r&536870912)!==0&&(n.flags&128)===0&&(St(n),n.subtreeFlags&6&&(n.flags|=8192)):St(n),r=n.updateQueue,r!==null&&Xl(n,r.retryQueue),r=null,e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(r=e.memoizedState.cachePool.pool),d=null,n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(d=n.memoizedState.cachePool.pool),d!==r&&(n.flags|=2048),e!==null&&Z(ra),null;case 24:return r=null,e!==null&&(r=e.memoizedState.cache),n.memoizedState.cache!==r&&(n.flags|=2048),so(It),St(n),null;case 25:return null;case 30:return null}throw Error(i(156,n.tag))}function rg(e,n){switch(ys(n),n.tag){case 1:return e=n.flags,e&65536?(n.flags=e&-65537|128,n):null;case 3:return so(It),de(),e=n.flags,(e&65536)!==0&&(e&128)===0?(n.flags=e&-65537|128,n):null;case 26:case 27:case 5:return le(n),null;case 13:if(uo(n),e=n.memoizedState,e!==null&&e.dehydrated!==null){if(n.alternate===null)throw Error(i(340));hr()}return e=n.flags,e&65536?(n.flags=e&-65537|128,n):null;case 19:return Z(Mt),null;case 4:return de(),null;case 10:return so(n.type),null;case 22:case 23:return uo(n),Ds(),e!==null&&Z(ra),e=n.flags,e&65536?(n.flags=e&-65537|128,n):null;case 24:return so(It),null;case 25:return null;default:return null}}function $p(e,n){switch(ys(n),n.tag){case 3:so(It),de();break;case 26:case 27:case 5:le(n);break;case 4:de();break;case 13:uo(n);break;case 19:Z(Mt);break;case 10:so(n.type);break;case 22:case 23:uo(n),Ds(),e!==null&&Z(ra);break;case 24:so(It)}}function Tr(e,n){try{var r=n.updateQueue,d=r!==null?r.lastEffect:null;if(d!==null){var _=d.next;r=_;do{if((r.tag&e)===e){d=void 0;var m=r.create,k=r.inst;d=m(),k.destroy=d}r=r.next}while(r!==_)}}catch(q){pt(n,n.return,q)}}function Fo(e,n,r){try{var d=n.updateQueue,_=d!==null?d.lastEffect:null;if(_!==null){var m=_.next;d=m;do{if((d.tag&e)===e){var k=d.inst,q=k.destroy;if(q!==void 0){k.destroy=void 0,_=n;var M=r,ee=q;try{ee()}catch(ie){pt(_,M,ie)}}}d=d.next}while(d!==m)}}catch(ie){pt(n,n.return,ie)}}function Op(e){var n=e.updateQueue;if(n!==null){var r=e.stateNode;try{bu(n,r)}catch(d){pt(e,e.return,d)}}}function Lp(e,n,r){r.props=ca(e.type,e.memoizedProps),r.state=e.memoizedState;try{r.componentWillUnmount()}catch(d){pt(e,n,d)}}function Fr(e,n){try{var r=e.ref;if(r!==null){switch(e.tag){case 26:case 27:case 5:var d=e.stateNode;break;case 30:d=e.stateNode;break;default:d=e.stateNode}typeof r=="function"?e.refCleanup=r(d):r.current=d}}catch(_){pt(e,n,_)}}function Jn(e,n){var r=e.ref,d=e.refCleanup;if(r!==null)if(typeof d=="function")try{d()}catch(_){pt(e,n,_)}finally{e.refCleanup=null,e=e.alternate,e!=null&&(e.refCleanup=null)}else if(typeof r=="function")try{r(null)}catch(_){pt(e,n,_)}else r.current=null}function Pp(e){var n=e.type,r=e.memoizedProps,d=e.stateNode;try{e:switch(n){case"button":case"input":case"select":case"textarea":r.autoFocus&&d.focus();break e;case"img":r.src?d.src=r.src:r.srcSet&&(d.srcset=r.srcSet)}}catch(_){pt(e,e.return,_)}}function ai(e,n,r){try{var d=e.stateNode;Rg(d,e.type,r,n),d[Qt]=n}catch(_){pt(e,e.return,_)}}function Ip(e){return e.tag===5||e.tag===3||e.tag===26||e.tag===27&&Io(e.type)||e.tag===4}function ri(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||Ip(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.tag===27&&Io(e.type)||e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function li(e,n,r){var d=e.tag;if(d===5||d===6)e=e.stateNode,n?(r.nodeType===9?r.body:r.nodeName==="HTML"?r.ownerDocument.body:r).insertBefore(e,n):(n=r.nodeType===9?r.body:r.nodeName==="HTML"?r.ownerDocument.body:r,n.appendChild(e),r=r._reactRootContainer,r!=null||n.onclick!==null||(n.onclick=sc));else if(d!==4&&(d===27&&Io(e.type)&&(r=e.stateNode,n=null),e=e.child,e!==null))for(li(e,n,r),e=e.sibling;e!==null;)li(e,n,r),e=e.sibling}function Zl(e,n,r){var d=e.tag;if(d===5||d===6)e=e.stateNode,n?r.insertBefore(e,n):r.appendChild(e);else if(d!==4&&(d===27&&Io(e.type)&&(r=e.stateNode),e=e.child,e!==null))for(Zl(e,n,r),e=e.sibling;e!==null;)Zl(e,n,r),e=e.sibling}function Mp(e){var n=e.stateNode,r=e.memoizedProps;try{for(var d=e.type,_=n.attributes;_.length;)n.removeAttributeNode(_[0]);Jt(n,d,r),n[Bt]=e,n[Qt]=r}catch(m){pt(e,e.return,m)}}var ho=!1,qt=!1,ci=!1,Hp=typeof WeakSet=="function"?WeakSet:Set,Gt=null;function lg(e,n){if(e=e.containerInfo,Ti=_c,e=Jd(e),rs(e)){if("selectionStart"in e)var r={start:e.selectionStart,end:e.selectionEnd};else e:{r=(r=e.ownerDocument)&&r.defaultView||window;var d=r.getSelection&&r.getSelection();if(d&&d.rangeCount!==0){r=d.anchorNode;var _=d.anchorOffset,m=d.focusNode;d=d.focusOffset;try{r.nodeType,m.nodeType}catch{r=null;break e}var k=0,q=-1,M=-1,ee=0,ie=0,he=e,oe=null;t:for(;;){for(var ae;he!==r||_!==0&&he.nodeType!==3||(q=k+_),he!==m||d!==0&&he.nodeType!==3||(M=k+d),he.nodeType===3&&(k+=he.nodeValue.length),(ae=he.firstChild)!==null;)oe=he,he=ae;for(;;){if(he===e)break t;if(oe===r&&++ee===_&&(q=k),oe===m&&++ie===d&&(M=k),(ae=he.nextSibling)!==null)break;he=oe,oe=he.parentNode}he=ae}r=q===-1||M===-1?null:{start:q,end:M}}else r=null}r=r||{start:0,end:0}}else r=null;for(Fi={focusedElem:e,selectionRange:r},_c=!1,Gt=n;Gt!==null;)if(n=Gt,e=n.child,(n.subtreeFlags&1024)!==0&&e!==null)e.return=n,Gt=e;else for(;Gt!==null;){switch(n=Gt,m=n.alternate,e=n.flags,n.tag){case 0:break;case 11:case 15:break;case 1:if((e&1024)!==0&&m!==null){e=void 0,r=n,_=m.memoizedProps,m=m.memoizedState,d=r.stateNode;try{var Ue=ca(r.type,_,r.elementType===r.type);e=d.getSnapshotBeforeUpdate(Ue,m),d.__reactInternalSnapshotBeforeUpdate=e}catch(Fe){pt(r,r.return,Fe)}}break;case 3:if((e&1024)!==0){if(e=n.stateNode.containerInfo,r=e.nodeType,r===9)Ui(e);else if(r===1)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":Ui(e);break;default:e.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((e&1024)!==0)throw Error(i(163))}if(e=n.sibling,e!==null){e.return=n.return,Gt=e;break}Gt=n.return}}function Bp(e,n,r){var d=r.flags;switch(r.tag){case 0:case 11:case 15:qo(e,r),d&4&&Tr(5,r);break;case 1:if(qo(e,r),d&4)if(e=r.stateNode,n===null)try{e.componentDidMount()}catch(k){pt(r,r.return,k)}else{var _=ca(r.type,n.memoizedProps);n=n.memoizedState;try{e.componentDidUpdate(_,n,e.__reactInternalSnapshotBeforeUpdate)}catch(k){pt(r,r.return,k)}}d&64&&Op(r),d&512&&Fr(r,r.return);break;case 3:if(qo(e,r),d&64&&(e=r.updateQueue,e!==null)){if(n=null,r.child!==null)switch(r.child.tag){case 27:case 5:n=r.child.stateNode;break;case 1:n=r.child.stateNode}try{bu(e,n)}catch(k){pt(r,r.return,k)}}break;case 27:n===null&&d&4&&Mp(r);case 26:case 5:qo(e,r),n===null&&d&4&&Pp(r),d&512&&Fr(r,r.return);break;case 12:qo(e,r);break;case 13:qo(e,r),d&4&&Gp(e,r),d&64&&(e=r.memoizedState,e!==null&&(e=e.dehydrated,e!==null&&(r=_g.bind(null,r),qg(e,r))));break;case 22:if(d=r.memoizedState!==null||ho,!d){n=n!==null&&n.memoizedState!==null||qt,_=ho;var m=qt;ho=d,(qt=n)&&!m?No(e,r,(r.subtreeFlags&8772)!==0):qo(e,r),ho=_,qt=m}break;case 30:break;default:qo(e,r)}}function Vp(e){var n=e.alternate;n!==null&&(e.alternate=null,Vp(n)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(n=e.stateNode,n!==null&&Lt(n)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var mt=null,gn=!1;function _o(e,n,r){for(r=r.child;r!==null;)zp(e,n,r),r=r.sibling}function zp(e,n,r){if(yt&&typeof yt.onCommitFiberUnmount=="function")try{yt.onCommitFiberUnmount(an,r)}catch{}switch(r.tag){case 26:qt||Jn(r,n),_o(e,n,r),r.memoizedState?r.memoizedState.count--:r.stateNode&&(r=r.stateNode,r.parentNode.removeChild(r));break;case 27:qt||Jn(r,n);var d=mt,_=gn;Io(r.type)&&(mt=r.stateNode,gn=!1),_o(e,n,r),Mr(r.stateNode),mt=d,gn=_;break;case 5:qt||Jn(r,n);case 6:if(d=mt,_=gn,mt=null,_o(e,n,r),mt=d,gn=_,mt!==null)if(gn)try{(mt.nodeType===9?mt.body:mt.nodeName==="HTML"?mt.ownerDocument.body:mt).removeChild(r.stateNode)}catch(m){pt(r,n,m)}else try{mt.removeChild(r.stateNode)}catch(m){pt(r,n,m)}break;case 18:mt!==null&&(gn?(e=mt,Nf(e.nodeType===9?e.body:e.nodeName==="HTML"?e.ownerDocument.body:e,r.stateNode),Qr(e)):Nf(mt,r.stateNode));break;case 4:d=mt,_=gn,mt=r.stateNode.containerInfo,gn=!0,_o(e,n,r),mt=d,gn=_;break;case 0:case 11:case 14:case 15:qt||Fo(2,r,n),qt||Fo(4,r,n),_o(e,n,r);break;case 1:qt||(Jn(r,n),d=r.stateNode,typeof d.componentWillUnmount=="function"&&Lp(r,n,d)),_o(e,n,r);break;case 21:_o(e,n,r);break;case 22:qt=(d=qt)||r.memoizedState!==null,_o(e,n,r),qt=d;break;default:_o(e,n,r)}}function Gp(e,n){if(n.memoizedState===null&&(e=n.alternate,e!==null&&(e=e.memoizedState,e!==null&&(e=e.dehydrated,e!==null))))try{Qr(e)}catch(r){pt(n,n.return,r)}}function cg(e){switch(e.tag){case 13:case 19:var n=e.stateNode;return n===null&&(n=e.stateNode=new Hp),n;case 22:return e=e.stateNode,n=e._retryCache,n===null&&(n=e._retryCache=new Hp),n;default:throw Error(i(435,e.tag))}}function si(e,n){var r=cg(e);n.forEach(function(d){var _=yg.bind(null,e,d);r.has(d)||(r.add(d),d.then(_,_))})}function Sn(e,n){var r=n.deletions;if(r!==null)for(var d=0;d<r.length;d++){var _=r[d],m=e,k=n,q=k;e:for(;q!==null;){switch(q.tag){case 27:if(Io(q.type)){mt=q.stateNode,gn=!1;break e}break;case 5:mt=q.stateNode,gn=!1;break e;case 3:case 4:mt=q.stateNode.containerInfo,gn=!0;break e}q=q.return}if(mt===null)throw Error(i(160));zp(m,k,_),mt=null,gn=!1,m=_.alternate,m!==null&&(m.return=null),_.return=null}if(n.subtreeFlags&13878)for(n=n.child;n!==null;)Yp(n,e),n=n.sibling}var Bn=null;function Yp(e,n){var r=e.alternate,d=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:Sn(n,e),bn(e),d&4&&(Fo(3,e,e.return),Tr(3,e),Fo(5,e,e.return));break;case 1:Sn(n,e),bn(e),d&512&&(qt||r===null||Jn(r,r.return)),d&64&&ho&&(e=e.updateQueue,e!==null&&(d=e.callbacks,d!==null&&(r=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=r===null?d:r.concat(d))));break;case 26:var _=Bn;if(Sn(n,e),bn(e),d&512&&(qt||r===null||Jn(r,r.return)),d&4){var m=r!==null?r.memoizedState:null;if(d=e.memoizedState,r===null)if(d===null)if(e.stateNode===null){e:{d=e.type,r=e.memoizedProps,_=_.ownerDocument||_;t:switch(d){case"title":m=_.getElementsByTagName("title")[0],(!m||m[ut]||m[Bt]||m.namespaceURI==="http://www.w3.org/2000/svg"||m.hasAttribute("itemprop"))&&(m=_.createElement(d),_.head.insertBefore(m,_.querySelector("head > title"))),Jt(m,d,r),m[Bt]=e,ft(m),d=m;break e;case"link":var k=Hf("link","href",_).get(d+(r.href||""));if(k){for(var q=0;q<k.length;q++)if(m=k[q],m.getAttribute("href")===(r.href==null||r.href===""?null:r.href)&&m.getAttribute("rel")===(r.rel==null?null:r.rel)&&m.getAttribute("title")===(r.title==null?null:r.title)&&m.getAttribute("crossorigin")===(r.crossOrigin==null?null:r.crossOrigin)){k.splice(q,1);break t}}m=_.createElement(d),Jt(m,d,r),_.head.appendChild(m);break;case"meta":if(k=Hf("meta","content",_).get(d+(r.content||""))){for(q=0;q<k.length;q++)if(m=k[q],m.getAttribute("content")===(r.content==null?null:""+r.content)&&m.getAttribute("name")===(r.name==null?null:r.name)&&m.getAttribute("property")===(r.property==null?null:r.property)&&m.getAttribute("http-equiv")===(r.httpEquiv==null?null:r.httpEquiv)&&m.getAttribute("charset")===(r.charSet==null?null:r.charSet)){k.splice(q,1);break t}}m=_.createElement(d),Jt(m,d,r),_.head.appendChild(m);break;default:throw Error(i(468,d))}m[Bt]=e,ft(m),d=m}e.stateNode=d}else Bf(_,e.type,e.stateNode);else e.stateNode=Mf(_,d,e.memoizedProps);else m!==d?(m===null?r.stateNode!==null&&(r=r.stateNode,r.parentNode.removeChild(r)):m.count--,d===null?Bf(_,e.type,e.stateNode):Mf(_,d,e.memoizedProps)):d===null&&e.stateNode!==null&&ai(e,e.memoizedProps,r.memoizedProps)}break;case 27:Sn(n,e),bn(e),d&512&&(qt||r===null||Jn(r,r.return)),r!==null&&d&4&&ai(e,e.memoizedProps,r.memoizedProps);break;case 5:if(Sn(n,e),bn(e),d&512&&(qt||r===null||Jn(r,r.return)),e.flags&32){_=e.stateNode;try{ga(_,"")}catch(ae){pt(e,e.return,ae)}}d&4&&e.stateNode!=null&&(_=e.memoizedProps,ai(e,_,r!==null?r.memoizedProps:_)),d&1024&&(ci=!0);break;case 6:if(Sn(n,e),bn(e),d&4){if(e.stateNode===null)throw Error(i(162));d=e.memoizedProps,r=e.stateNode;try{r.nodeValue=d}catch(ae){pt(e,e.return,ae)}}break;case 3:if(pc=null,_=Bn,Bn=dc(n.containerInfo),Sn(n,e),Bn=_,bn(e),d&4&&r!==null&&r.memoizedState.isDehydrated)try{Qr(n.containerInfo)}catch(ae){pt(e,e.return,ae)}ci&&(ci=!1,Wp(e));break;case 4:d=Bn,Bn=dc(e.stateNode.containerInfo),Sn(n,e),bn(e),Bn=d;break;case 12:Sn(n,e),bn(e);break;case 13:Sn(n,e),bn(e),e.child.flags&8192&&e.memoizedState!==null!=(r!==null&&r.memoizedState!==null)&&(hi=$e()),d&4&&(d=e.updateQueue,d!==null&&(e.updateQueue=null,si(e,d)));break;case 22:_=e.memoizedState!==null;var M=r!==null&&r.memoizedState!==null,ee=ho,ie=qt;if(ho=ee||_,qt=ie||M,Sn(n,e),qt=ie,ho=ee,bn(e),d&8192)e:for(n=e.stateNode,n._visibility=_?n._visibility&-2:n._visibility|1,_&&(r===null||M||ho||qt||sa(e)),r=null,n=e;;){if(n.tag===5||n.tag===26){if(r===null){M=r=n;try{if(m=M.stateNode,_)k=m.style,typeof k.setProperty=="function"?k.setProperty("display","none","important"):k.display="none";else{q=M.stateNode;var he=M.memoizedProps.style,oe=he!=null&&he.hasOwnProperty("display")?he.display:null;q.style.display=oe==null||typeof oe=="boolean"?"":(""+oe).trim()}}catch(ae){pt(M,M.return,ae)}}}else if(n.tag===6){if(r===null){M=n;try{M.stateNode.nodeValue=_?"":M.memoizedProps}catch(ae){pt(M,M.return,ae)}}}else if((n.tag!==22&&n.tag!==23||n.memoizedState===null||n===e)&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;r===n&&(r=null),n=n.return}r===n&&(r=null),n.sibling.return=n.return,n=n.sibling}d&4&&(d=e.updateQueue,d!==null&&(r=d.retryQueue,r!==null&&(d.retryQueue=null,si(e,r))));break;case 19:Sn(n,e),bn(e),d&4&&(d=e.updateQueue,d!==null&&(e.updateQueue=null,si(e,d)));break;case 30:break;case 21:break;default:Sn(n,e),bn(e)}}function bn(e){var n=e.flags;if(n&2){try{for(var r,d=e.return;d!==null;){if(Ip(d)){r=d;break}d=d.return}if(r==null)throw Error(i(160));switch(r.tag){case 27:var _=r.stateNode,m=ri(e);Zl(e,m,_);break;case 5:var k=r.stateNode;r.flags&32&&(ga(k,""),r.flags&=-33);var q=ri(e);Zl(e,q,k);break;case 3:case 4:var M=r.stateNode.containerInfo,ee=ri(e);li(e,ee,M);break;default:throw Error(i(161))}}catch(ie){pt(e,e.return,ie)}e.flags&=-3}n&4096&&(e.flags&=-4097)}function Wp(e){if(e.subtreeFlags&1024)for(e=e.child;e!==null;){var n=e;Wp(n),n.tag===5&&n.flags&1024&&n.stateNode.reset(),e=e.sibling}}function qo(e,n){if(n.subtreeFlags&8772)for(n=n.child;n!==null;)Bp(e,n.alternate,n),n=n.sibling}function sa(e){for(e=e.child;e!==null;){var n=e;switch(n.tag){case 0:case 11:case 14:case 15:Fo(4,n,n.return),sa(n);break;case 1:Jn(n,n.return);var r=n.stateNode;typeof r.componentWillUnmount=="function"&&Lp(n,n.return,r),sa(n);break;case 27:Mr(n.stateNode);case 26:case 5:Jn(n,n.return),sa(n);break;case 22:n.memoizedState===null&&sa(n);break;case 30:sa(n);break;default:sa(n)}e=e.sibling}}function No(e,n,r){for(r=r&&(n.subtreeFlags&8772)!==0,n=n.child;n!==null;){var d=n.alternate,_=e,m=n,k=m.flags;switch(m.tag){case 0:case 11:case 15:No(_,m,r),Tr(4,m);break;case 1:if(No(_,m,r),d=m,_=d.stateNode,typeof _.componentDidMount=="function")try{_.componentDidMount()}catch(ee){pt(d,d.return,ee)}if(d=m,_=d.updateQueue,_!==null){var q=d.stateNode;try{var M=_.shared.hiddenCallbacks;if(M!==null)for(_.shared.hiddenCallbacks=null,_=0;_<M.length;_++)Su(M[_],q)}catch(ee){pt(d,d.return,ee)}}r&&k&64&&Op(m),Fr(m,m.return);break;case 27:Mp(m);case 26:case 5:No(_,m,r),r&&d===null&&k&4&&Pp(m),Fr(m,m.return);break;case 12:No(_,m,r);break;case 13:No(_,m,r),r&&k&4&&Gp(_,m);break;case 22:m.memoizedState===null&&No(_,m,r),Fr(m,m.return);break;case 30:break;default:No(_,m,r)}n=n.sibling}}function ii(e,n){var r=null;e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(r=e.memoizedState.cachePool.pool),e=null,n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(e=n.memoizedState.cachePool.pool),e!==r&&(e!=null&&e.refCount++,r!=null&&gr(r))}function di(e,n){e=null,n.alternate!==null&&(e=n.alternate.memoizedState.cache),n=n.memoizedState.cache,n!==e&&(n.refCount++,e!=null&&gr(e))}function eo(e,n,r,d){if(n.subtreeFlags&10256)for(n=n.child;n!==null;)Qp(e,n,r,d),n=n.sibling}function Qp(e,n,r,d){var _=n.flags;switch(n.tag){case 0:case 11:case 15:eo(e,n,r,d),_&2048&&Tr(9,n);break;case 1:eo(e,n,r,d);break;case 3:eo(e,n,r,d),_&2048&&(e=null,n.alternate!==null&&(e=n.alternate.memoizedState.cache),n=n.memoizedState.cache,n!==e&&(n.refCount++,e!=null&&gr(e)));break;case 12:if(_&2048){eo(e,n,r,d),e=n.stateNode;try{var m=n.memoizedProps,k=m.id,q=m.onPostCommit;typeof q=="function"&&q(k,n.alternate===null?"mount":"update",e.passiveEffectDuration,-0)}catch(M){pt(n,n.return,M)}}else eo(e,n,r,d);break;case 13:eo(e,n,r,d);break;case 23:break;case 22:m=n.stateNode,k=n.alternate,n.memoizedState!==null?m._visibility&2?eo(e,n,r,d):qr(e,n):m._visibility&2?eo(e,n,r,d):(m._visibility|=2,$a(e,n,r,d,(n.subtreeFlags&10256)!==0)),_&2048&&ii(k,n);break;case 24:eo(e,n,r,d),_&2048&&di(n.alternate,n);break;default:eo(e,n,r,d)}}function $a(e,n,r,d,_){for(_=_&&(n.subtreeFlags&10256)!==0,n=n.child;n!==null;){var m=e,k=n,q=r,M=d,ee=k.flags;switch(k.tag){case 0:case 11:case 15:$a(m,k,q,M,_),Tr(8,k);break;case 23:break;case 22:var ie=k.stateNode;k.memoizedState!==null?ie._visibility&2?$a(m,k,q,M,_):qr(m,k):(ie._visibility|=2,$a(m,k,q,M,_)),_&&ee&2048&&ii(k.alternate,k);break;case 24:$a(m,k,q,M,_),_&&ee&2048&&di(k.alternate,k);break;default:$a(m,k,q,M,_)}n=n.sibling}}function qr(e,n){if(n.subtreeFlags&10256)for(n=n.child;n!==null;){var r=e,d=n,_=d.flags;switch(d.tag){case 22:qr(r,d),_&2048&&ii(d.alternate,d);break;case 24:qr(r,d),_&2048&&di(d.alternate,d);break;default:qr(r,d)}n=n.sibling}}var Nr=8192;function Oa(e){if(e.subtreeFlags&Nr)for(e=e.child;e!==null;)Xp(e),e=e.sibling}function Xp(e){switch(e.tag){case 26:Oa(e),e.flags&Nr&&e.memoizedState!==null&&Gg(Bn,e.memoizedState,e.memoizedProps);break;case 5:Oa(e);break;case 3:case 4:var n=Bn;Bn=dc(e.stateNode.containerInfo),Oa(e),Bn=n;break;case 22:e.memoizedState===null&&(n=e.alternate,n!==null&&n.memoizedState!==null?(n=Nr,Nr=16777216,Oa(e),Nr=n):Oa(e));break;default:Oa(e)}}function Zp(e){var n=e.alternate;if(n!==null&&(e=n.child,e!==null)){n.child=null;do n=e.sibling,e.sibling=null,e=n;while(e!==null)}}function Ur(e){var n=e.deletions;if((e.flags&16)!==0){if(n!==null)for(var r=0;r<n.length;r++){var d=n[r];Gt=d,Jp(d,e)}Zp(e)}if(e.subtreeFlags&10256)for(e=e.child;e!==null;)Kp(e),e=e.sibling}function Kp(e){switch(e.tag){case 0:case 11:case 15:Ur(e),e.flags&2048&&Fo(9,e,e.return);break;case 3:Ur(e);break;case 12:Ur(e);break;case 22:var n=e.stateNode;e.memoizedState!==null&&n._visibility&2&&(e.return===null||e.return.tag!==13)?(n._visibility&=-3,Kl(e)):Ur(e);break;default:Ur(e)}}function Kl(e){var n=e.deletions;if((e.flags&16)!==0){if(n!==null)for(var r=0;r<n.length;r++){var d=n[r];Gt=d,Jp(d,e)}Zp(e)}for(e=e.child;e!==null;){switch(n=e,n.tag){case 0:case 11:case 15:Fo(8,n,n.return),Kl(n);break;case 22:r=n.stateNode,r._visibility&2&&(r._visibility&=-3,Kl(n));break;default:Kl(n)}e=e.sibling}}function Jp(e,n){for(;Gt!==null;){var r=Gt;switch(r.tag){case 0:case 11:case 15:Fo(8,r,n);break;case 23:case 22:if(r.memoizedState!==null&&r.memoizedState.cachePool!==null){var d=r.memoizedState.cachePool.pool;d!=null&&d.refCount++}break;case 24:gr(r.memoizedState.cache)}if(d=r.child,d!==null)d.return=r,Gt=d;else e:for(r=e;Gt!==null;){d=Gt;var _=d.sibling,m=d.return;if(Vp(d),d===r){Gt=null;break e}if(_!==null){_.return=m,Gt=_;break e}Gt=m}}}var sg={getCacheForType:function(e){var n=ln(It),r=n.data.get(e);return r===void 0&&(r=e(),n.data.set(e,r)),r}},ig=typeof WeakMap=="function"?WeakMap:Map,rt=0,ht=null,We=null,Ze=0,lt=0,En=null,Uo=!1,La=!1,ui=!1,yo=0,kt=0,$o=0,ia=0,pi=0,$n=0,Pa=0,$r=null,mn=null,fi=!1,hi=0,Jl=1/0,ec=null,Oo=null,Kt=0,Lo=null,Ia=null,Ma=0,_i=0,yi=null,ef=null,Or=0,gi=null;function Rn(){if((rt&2)!==0&&Ze!==0)return Ze&-Ze;if(F.T!==null){var e=ja;return e!==0?e:bi()}return dl()}function tf(){$n===0&&($n=(Ze&536870912)===0||ot?un():536870912);var e=Un.current;return e!==null&&(e.flags|=32),$n}function An(e,n,r){(e===ht&&(lt===2||lt===9)||e.cancelPendingCommit!==null)&&(Ha(e,0),Po(e,Ze,$n,!1)),In(e,r),((rt&2)===0||e!==ht)&&(e===ht&&((rt&2)===0&&(ia|=r),kt===4&&Po(e,Ze,$n,!1)),to(e))}function nf(e,n,r){if((rt&6)!==0)throw Error(i(327));var d=!r&&(n&124)===0&&(n&e.expiredLanes)===0||Je(e,n),_=d?pg(e,n):wi(e,n,!0),m=d;do{if(_===0){La&&!d&&Po(e,n,0,!1);break}else{if(r=e.current.alternate,m&&!dg(r)){_=wi(e,n,!1),m=!1;continue}if(_===2){if(m=n,e.errorRecoveryDisabledLanes&m)var k=0;else k=e.pendingLanes&-536870913,k=k!==0?k:k&536870912?536870912:0;if(k!==0){n=k;e:{var q=e;_=$r;var M=q.current.memoizedState.isDehydrated;if(M&&(Ha(q,k).flags|=256),k=wi(q,k,!1),k!==2){if(ui&&!M){q.errorRecoveryDisabledLanes|=m,ia|=m,_=4;break e}m=mn,mn=_,m!==null&&(mn===null?mn=m:mn.push.apply(mn,m))}_=k}if(m=!1,_!==2)continue}}if(_===1){Ha(e,0),Po(e,n,0,!0);break}e:{switch(d=e,m=_,m){case 0:case 1:throw Error(i(345));case 4:if((n&4194048)!==n)break;case 6:Po(d,n,$n,!Uo);break e;case 2:mn=null;break;case 3:case 5:break;default:throw Error(i(329))}if((n&62914560)===n&&(_=hi+300-$e(),10<_)){if(Po(d,n,$n,!Uo),xt(d,0,!0)!==0)break e;d.timeoutHandle=Ff(of.bind(null,d,r,mn,ec,fi,n,$n,ia,Pa,Uo,m,2,-0,0),_);break e}of(d,r,mn,ec,fi,n,$n,ia,Pa,Uo,m,0,-0,0)}}break}while(!0);to(e)}function of(e,n,r,d,_,m,k,q,M,ee,ie,he,oe,ae){if(e.timeoutHandle=-1,he=n.subtreeFlags,(he&8192||(he&16785408)===16785408)&&(Vr={stylesheets:null,count:0,unsuspend:zg},Xp(n),he=Yg(),he!==null)){e.cancelPendingCommit=he(uf.bind(null,e,n,m,r,d,_,k,q,M,ie,1,oe,ae)),Po(e,m,k,!ee);return}uf(e,n,m,r,d,_,k,q,M)}function dg(e){for(var n=e;;){var r=n.tag;if((r===0||r===11||r===15)&&n.flags&16384&&(r=n.updateQueue,r!==null&&(r=r.stores,r!==null)))for(var d=0;d<r.length;d++){var _=r[d],m=_.getSnapshot;_=_.value;try{if(!Cn(m(),_))return!1}catch{return!1}}if(r=n.child,n.subtreeFlags&16384&&r!==null)r.return=n,n=r;else{if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return!0;n=n.return}n.sibling.return=n.return,n=n.sibling}}return!0}function Po(e,n,r,d){n&=~pi,n&=~ia,e.suspendedLanes|=n,e.pingedLanes&=~n,d&&(e.warmLanes|=n),d=e.expirationTimes;for(var _=n;0<_;){var m=31-Nt(_),k=1<<m;d[m]=-1,_&=~k}r!==0&&il(e,r,n)}function tc(){return(rt&6)===0?(Lr(0),!1):!0}function mi(){if(We!==null){if(lt===0)var e=We.return;else e=We,co=oa=null,Us(e),Na=null,jr=0,e=We;for(;e!==null;)$p(e.alternate,e),e=e.return;We=null}}function Ha(e,n){var r=e.timeoutHandle;r!==-1&&(e.timeoutHandle=-1,jg(r)),r=e.cancelPendingCommit,r!==null&&(e.cancelPendingCommit=null,r()),mi(),ht=e,We=r=ao(e.current,null),Ze=n,lt=0,En=null,Uo=!1,La=Je(e,n),ui=!1,Pa=$n=pi=ia=$o=kt=0,mn=$r=null,fi=!1,(n&8)!==0&&(n|=n&32);var d=e.entangledLanes;if(d!==0)for(e=e.entanglements,d&=n;0<d;){var _=31-Nt(d),m=1<<_;n|=e[_],d&=~m}return yo=n,Sl(),r}function af(e,n){Be=null,F.H=Hl,n===vr||n===Fl?(n=Cu(),lt=3):n===mu?(n=Cu(),lt=4):lt=n===xp?8:n!==null&&typeof n=="object"&&typeof n.then=="function"?6:1,En=n,We===null&&(kt=1,Yl(e,Tn(n,e.current)))}function rf(){var e=F.H;return F.H=Hl,e===null?Hl:e}function lf(){var e=F.A;return F.A=sg,e}function vi(){kt=4,Uo||(Ze&4194048)!==Ze&&Un.current!==null||(La=!0),($o&134217727)===0&&(ia&134217727)===0||ht===null||Po(ht,Ze,$n,!1)}function wi(e,n,r){var d=rt;rt|=2;var _=rf(),m=lf();(ht!==e||Ze!==n)&&(ec=null,Ha(e,n)),n=!1;var k=kt;e:do try{if(lt!==0&&We!==null){var q=We,M=En;switch(lt){case 8:mi(),k=6;break e;case 3:case 2:case 9:case 6:Un.current===null&&(n=!0);var ee=lt;if(lt=0,En=null,Ba(e,q,M,ee),r&&La){k=0;break e}break;default:ee=lt,lt=0,En=null,Ba(e,q,M,ee)}}ug(),k=kt;break}catch(ie){af(e,ie)}while(!0);return n&&e.shellSuspendCounter++,co=oa=null,rt=d,F.H=_,F.A=m,We===null&&(ht=null,Ze=0,Sl()),k}function ug(){for(;We!==null;)cf(We)}function pg(e,n){var r=rt;rt|=2;var d=rf(),_=lf();ht!==e||Ze!==n?(ec=null,Jl=$e()+500,Ha(e,n)):La=Je(e,n);e:do try{if(lt!==0&&We!==null){n=We;var m=En;t:switch(lt){case 1:lt=0,En=null,Ba(e,n,m,1);break;case 2:case 9:if(vu(m)){lt=0,En=null,sf(n);break}n=function(){lt!==2&&lt!==9||ht!==e||(lt=7),to(e)},m.then(n,n);break e;case 3:lt=7;break e;case 4:lt=5;break e;case 7:vu(m)?(lt=0,En=null,sf(n)):(lt=0,En=null,Ba(e,n,m,7));break;case 5:var k=null;switch(We.tag){case 26:k=We.memoizedState;case 5:case 27:var q=We;if(!k||Vf(k)){lt=0,En=null;var M=q.sibling;if(M!==null)We=M;else{var ee=q.return;ee!==null?(We=ee,nc(ee)):We=null}break t}}lt=0,En=null,Ba(e,n,m,5);break;case 6:lt=0,En=null,Ba(e,n,m,6);break;case 8:mi(),kt=6;break e;default:throw Error(i(462))}}fg();break}catch(ie){af(e,ie)}while(!0);return co=oa=null,F.H=d,F.A=_,rt=r,We!==null?0:(ht=null,Ze=0,Sl(),kt)}function fg(){for(;We!==null&&!me();)cf(We)}function cf(e){var n=Np(e.alternate,e,yo);e.memoizedProps=e.pendingProps,n===null?nc(e):We=n}function sf(e){var n=e,r=n.alternate;switch(n.tag){case 15:case 0:n=jp(r,n,n.pendingProps,n.type,void 0,Ze);break;case 11:n=jp(r,n,n.pendingProps,n.type.render,n.ref,Ze);break;case 5:Us(n);default:$p(r,n),n=We=iu(n,yo),n=Np(r,n,yo)}e.memoizedProps=e.pendingProps,n===null?nc(e):We=n}function Ba(e,n,r,d){co=oa=null,Us(n),Na=null,jr=0;var _=n.return;try{if(ng(e,_,n,r,Ze)){kt=1,Yl(e,Tn(r,e.current)),We=null;return}}catch(m){if(_!==null)throw We=_,m;kt=1,Yl(e,Tn(r,e.current)),We=null;return}n.flags&32768?(ot||d===1?e=!0:La||(Ze&536870912)!==0?e=!1:(Uo=e=!0,(d===2||d===9||d===3||d===6)&&(d=Un.current,d!==null&&d.tag===13&&(d.flags|=16384))),df(n,e)):nc(n)}function nc(e){var n=e;do{if((n.flags&32768)!==0){df(n,Uo);return}e=n.return;var r=ag(n.alternate,n,yo);if(r!==null){We=r;return}if(n=n.sibling,n!==null){We=n;return}We=n=e}while(n!==null);kt===0&&(kt=5)}function df(e,n){do{var r=rg(e.alternate,e);if(r!==null){r.flags&=32767,We=r;return}if(r=e.return,r!==null&&(r.flags|=32768,r.subtreeFlags=0,r.deletions=null),!n&&(e=e.sibling,e!==null)){We=e;return}We=e=r}while(e!==null);kt=6,We=null}function uf(e,n,r,d,_,m,k,q,M){e.cancelPendingCommit=null;do oc();while(Kt!==0);if((rt&6)!==0)throw Error(i(327));if(n!==null){if(n===e.current)throw Error(i(177));if(m=n.lanes|n.childLanes,m|=ds,Oc(e,r,m,k,q,M),e===ht&&(We=ht=null,Ze=0),Ia=n,Lo=e,Ma=r,_i=m,yi=_,ef=d,(n.subtreeFlags&10256)!==0||(n.flags&10256)!==0?(e.callbackNode=null,e.callbackPriority=0,gg(Ke,function(){return yf(),null})):(e.callbackNode=null,e.callbackPriority=0),d=(n.flags&13878)!==0,(n.subtreeFlags&13878)!==0||d){d=F.T,F.T=null,_=B.p,B.p=2,k=rt,rt|=4;try{lg(e,n,r)}finally{rt=k,B.p=_,F.T=d}}Kt=1,pf(),ff(),hf()}}function pf(){if(Kt===1){Kt=0;var e=Lo,n=Ia,r=(n.flags&13878)!==0;if((n.subtreeFlags&13878)!==0||r){r=F.T,F.T=null;var d=B.p;B.p=2;var _=rt;rt|=4;try{Yp(n,e);var m=Fi,k=Jd(e.containerInfo),q=m.focusedElem,M=m.selectionRange;if(k!==q&&q&&q.ownerDocument&&Kd(q.ownerDocument.documentElement,q)){if(M!==null&&rs(q)){var ee=M.start,ie=M.end;if(ie===void 0&&(ie=ee),"selectionStart"in q)q.selectionStart=ee,q.selectionEnd=Math.min(ie,q.value.length);else{var he=q.ownerDocument||document,oe=he&&he.defaultView||window;if(oe.getSelection){var ae=oe.getSelection(),Ue=q.textContent.length,Fe=Math.min(M.start,Ue),it=M.end===void 0?Fe:Math.min(M.end,Ue);!ae.extend&&Fe>it&&(k=it,it=Fe,Fe=k);var X=Zd(q,Fe),G=Zd(q,it);if(X&&G&&(ae.rangeCount!==1||ae.anchorNode!==X.node||ae.anchorOffset!==X.offset||ae.focusNode!==G.node||ae.focusOffset!==G.offset)){var K=he.createRange();K.setStart(X.node,X.offset),ae.removeAllRanges(),Fe>it?(ae.addRange(K),ae.extend(G.node,G.offset)):(K.setEnd(G.node,G.offset),ae.addRange(K))}}}}for(he=[],ae=q;ae=ae.parentNode;)ae.nodeType===1&&he.push({element:ae,left:ae.scrollLeft,top:ae.scrollTop});for(typeof q.focus=="function"&&q.focus(),q=0;q<he.length;q++){var ue=he[q];ue.element.scrollLeft=ue.left,ue.element.scrollTop=ue.top}}_c=!!Ti,Fi=Ti=null}finally{rt=_,B.p=d,F.T=r}}e.current=n,Kt=2}}function ff(){if(Kt===2){Kt=0;var e=Lo,n=Ia,r=(n.flags&8772)!==0;if((n.subtreeFlags&8772)!==0||r){r=F.T,F.T=null;var d=B.p;B.p=2;var _=rt;rt|=4;try{Bp(e,n.alternate,n)}finally{rt=_,B.p=d,F.T=r}}Kt=3}}function hf(){if(Kt===4||Kt===3){Kt=0,Se();var e=Lo,n=Ia,r=Ma,d=ef;(n.subtreeFlags&10256)!==0||(n.flags&10256)!==0?Kt=5:(Kt=0,Ia=Lo=null,_f(e,e.pendingLanes));var _=e.pendingLanes;if(_===0&&(Oo=null),or(r),n=n.stateNode,yt&&typeof yt.onCommitFiberRoot=="function")try{yt.onCommitFiberRoot(an,n,void 0,(n.current.flags&128)===128)}catch{}if(d!==null){n=F.T,_=B.p,B.p=2,F.T=null;try{for(var m=e.onRecoverableError,k=0;k<d.length;k++){var q=d[k];m(q.value,{componentStack:q.stack})}}finally{F.T=n,B.p=_}}(Ma&3)!==0&&oc(),to(e),_=e.pendingLanes,(r&4194090)!==0&&(_&42)!==0?e===gi?Or++:(Or=0,gi=e):Or=0,Lr(0)}}function _f(e,n){(e.pooledCacheLanes&=n)===0&&(n=e.pooledCache,n!=null&&(e.pooledCache=null,gr(n)))}function oc(e){return pf(),ff(),hf(),yf()}function yf(){if(Kt!==5)return!1;var e=Lo,n=_i;_i=0;var r=or(Ma),d=F.T,_=B.p;try{B.p=32>r?32:r,F.T=null,r=yi,yi=null;var m=Lo,k=Ma;if(Kt=0,Ia=Lo=null,Ma=0,(rt&6)!==0)throw Error(i(331));var q=rt;if(rt|=4,Kp(m.current),Qp(m,m.current,k,r),rt=q,Lr(0,!1),yt&&typeof yt.onPostCommitFiberRoot=="function")try{yt.onPostCommitFiberRoot(an,m)}catch{}return!0}finally{B.p=_,F.T=d,_f(e,n)}}function gf(e,n,r){n=Tn(r,n),n=Qs(e.stateNode,n,2),e=jo(e,n,2),e!==null&&(In(e,2),to(e))}function pt(e,n,r){if(e.tag===3)gf(e,e,r);else for(;n!==null;){if(n.tag===3){gf(n,e,r);break}else if(n.tag===1){var d=n.stateNode;if(typeof n.type.getDerivedStateFromError=="function"||typeof d.componentDidCatch=="function"&&(Oo===null||!Oo.has(d))){e=Tn(r,e),r=wp(2),d=jo(n,r,2),d!==null&&(Cp(r,d,n,e),In(d,2),to(d));break}}n=n.return}}function Ci(e,n,r){var d=e.pingCache;if(d===null){d=e.pingCache=new ig;var _=new Set;d.set(n,_)}else _=d.get(n),_===void 0&&(_=new Set,d.set(n,_));_.has(r)||(ui=!0,_.add(r),e=hg.bind(null,e,n,r),n.then(e,e))}function hg(e,n,r){var d=e.pingCache;d!==null&&d.delete(n),e.pingedLanes|=e.suspendedLanes&r,e.warmLanes&=~r,ht===e&&(Ze&r)===r&&(kt===4||kt===3&&(Ze&62914560)===Ze&&300>$e()-hi?(rt&2)===0&&Ha(e,0):pi|=r,Pa===Ze&&(Pa=0)),to(e)}function mf(e,n){n===0&&(n=Tt()),e=ba(e,n),e!==null&&(In(e,n),to(e))}function _g(e){var n=e.memoizedState,r=0;n!==null&&(r=n.retryLane),mf(e,r)}function yg(e,n){var r=0;switch(e.tag){case 13:var d=e.stateNode,_=e.memoizedState;_!==null&&(r=_.retryLane);break;case 19:d=e.stateNode;break;case 22:d=e.stateNode._retryCache;break;default:throw Error(i(314))}d!==null&&d.delete(n),mf(e,r)}function gg(e,n){return se(e,n)}var ac=null,Va=null,xi=!1,rc=!1,Si=!1,da=0;function to(e){e!==Va&&e.next===null&&(Va===null?ac=Va=e:Va=Va.next=e),rc=!0,xi||(xi=!0,vg())}function Lr(e,n){if(!Si&&rc){Si=!0;do for(var r=!1,d=ac;d!==null;){if(e!==0){var _=d.pendingLanes;if(_===0)var m=0;else{var k=d.suspendedLanes,q=d.pingedLanes;m=(1<<31-Nt(42|e)+1)-1,m&=_&~(k&~q),m=m&201326741?m&201326741|1:m?m|2:0}m!==0&&(r=!0,xf(d,m))}else m=Ze,m=xt(d,d===ht?m:0,d.cancelPendingCommit!==null||d.timeoutHandle!==-1),(m&3)===0||Je(d,m)||(r=!0,xf(d,m));d=d.next}while(r);Si=!1}}function mg(){vf()}function vf(){rc=xi=!1;var e=0;da!==0&&(Ag()&&(e=da),da=0);for(var n=$e(),r=null,d=ac;d!==null;){var _=d.next,m=wf(d,n);m===0?(d.next=null,r===null?ac=_:r.next=_,_===null&&(Va=r)):(r=d,(e!==0||(m&3)!==0)&&(rc=!0)),d=_}Lr(e)}function wf(e,n){for(var r=e.suspendedLanes,d=e.pingedLanes,_=e.expirationTimes,m=e.pendingLanes&-62914561;0<m;){var k=31-Nt(m),q=1<<k,M=_[k];M===-1?((q&r)===0||(q&d)!==0)&&(_[k]=At(q,n)):M<=n&&(e.expiredLanes|=q),m&=~q}if(n=ht,r=Ze,r=xt(e,e===n?r:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),d=e.callbackNode,r===0||e===n&&(lt===2||lt===9)||e.cancelPendingCommit!==null)return d!==null&&d!==null&&ge(d),e.callbackNode=null,e.callbackPriority=0;if((r&3)===0||Je(e,r)){if(n=r&-r,n===e.callbackPriority)return n;switch(d!==null&&ge(d),or(r)){case 2:case 8:r=nt;break;case 32:r=Ke;break;case 268435456:r=De;break;default:r=Ke}return d=Cf.bind(null,e),r=se(r,d),e.callbackPriority=n,e.callbackNode=r,n}return d!==null&&d!==null&&ge(d),e.callbackPriority=2,e.callbackNode=null,2}function Cf(e,n){if(Kt!==0&&Kt!==5)return e.callbackNode=null,e.callbackPriority=0,null;var r=e.callbackNode;if(oc()&&e.callbackNode!==r)return null;var d=Ze;return d=xt(e,e===ht?d:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),d===0?null:(nf(e,d,n),wf(e,$e()),e.callbackNode!=null&&e.callbackNode===r?Cf.bind(null,e):null)}function xf(e,n){if(oc())return null;nf(e,n,!0)}function vg(){kg(function(){(rt&6)!==0?se(at,mg):vf()})}function bi(){return da===0&&(da=un()),da}function Sf(e){return e==null||typeof e=="symbol"||typeof e=="boolean"?null:typeof e=="function"?e:yl(""+e)}function bf(e,n){var r=n.ownerDocument.createElement("input");return r.name=n.name,r.value=n.value,e.id&&r.setAttribute("form",e.id),n.parentNode.insertBefore(r,n),e=new FormData(e),r.parentNode.removeChild(r),e}function wg(e,n,r,d,_){if(n==="submit"&&r&&r.stateNode===_){var m=Sf((_[Qt]||null).action),k=d.submitter;k&&(n=(n=k[Qt]||null)?Sf(n.formAction):k.getAttribute("formAction"),n!==null&&(m=n,k=null));var q=new wl("action","action",null,d,_);e.push({event:q,listeners:[{instance:null,listener:function(){if(d.defaultPrevented){if(da!==0){var M=k?bf(_,k):new FormData(_);Vs(r,{pending:!0,data:M,method:_.method,action:m},null,M)}}else typeof m=="function"&&(q.preventDefault(),M=k?bf(_,k):new FormData(_),Vs(r,{pending:!0,data:M,method:_.method,action:m},m,M))},currentTarget:_}]})}}for(var Ei=0;Ei<is.length;Ei++){var Ri=is[Ei],Cg=Ri.toLowerCase(),xg=Ri[0].toUpperCase()+Ri.slice(1);Hn(Cg,"on"+xg)}Hn(nu,"onAnimationEnd"),Hn(ou,"onAnimationIteration"),Hn(au,"onAnimationStart"),Hn("dblclick","onDoubleClick"),Hn("focusin","onFocus"),Hn("focusout","onBlur"),Hn(Py,"onTransitionRun"),Hn(Iy,"onTransitionStart"),Hn(My,"onTransitionCancel"),Hn(ru,"onTransitionEnd"),xo("onMouseEnter",["mouseout","mouseover"]),xo("onMouseLeave",["mouseout","mouseover"]),xo("onPointerEnter",["pointerout","pointerover"]),xo("onPointerLeave",["pointerout","pointerover"]),Vt("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Vt("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Vt("onBeforeInput",["compositionend","keypress","textInput","paste"]),Vt("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Vt("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Vt("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Pr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Sg=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Pr));function Ef(e,n){n=(n&4)!==0;for(var r=0;r<e.length;r++){var d=e[r],_=d.event;d=d.listeners;e:{var m=void 0;if(n)for(var k=d.length-1;0<=k;k--){var q=d[k],M=q.instance,ee=q.currentTarget;if(q=q.listener,M!==m&&_.isPropagationStopped())break e;m=q,_.currentTarget=ee;try{m(_)}catch(ie){Gl(ie)}_.currentTarget=null,m=M}else for(k=0;k<d.length;k++){if(q=d[k],M=q.instance,ee=q.currentTarget,q=q.listener,M!==m&&_.isPropagationStopped())break e;m=q,_.currentTarget=ee;try{m(_)}catch(ie){Gl(ie)}_.currentTarget=null,m=M}}}}function Qe(e,n){var r=n[ha];r===void 0&&(r=n[ha]=new Set);var d=e+"__bubble";r.has(d)||(Rf(n,e,2,!1),r.add(d))}function Ai(e,n,r){var d=0;n&&(d|=4),Rf(r,e,d,n)}var lc="_reactListening"+Math.random().toString(36).slice(2);function ji(e){if(!e[lc]){e[lc]=!0,ul.forEach(function(r){r!=="selectionchange"&&(Sg.has(r)||Ai(r,!1,e),Ai(r,!0,e))});var n=e.nodeType===9?e:e.ownerDocument;n===null||n[lc]||(n[lc]=!0,Ai("selectionchange",!1,n))}}function Rf(e,n,r,d){switch(Xf(n)){case 2:var _=Xg;break;case 8:_=Zg;break;default:_=Hi}r=_.bind(null,n,r,e),_=void 0,!Xc||n!=="touchstart"&&n!=="touchmove"&&n!=="wheel"||(_=!0),d?_!==void 0?e.addEventListener(n,r,{capture:!0,passive:_}):e.addEventListener(n,r,!0):_!==void 0?e.addEventListener(n,r,{passive:_}):e.addEventListener(n,r,!1)}function ki(e,n,r,d,_){var m=d;if((n&1)===0&&(n&2)===0&&d!==null)e:for(;;){if(d===null)return;var k=d.tag;if(k===3||k===4){var q=d.stateNode.containerInfo;if(q===_)break;if(k===4)for(k=d.return;k!==null;){var M=k.tag;if((M===3||M===4)&&k.stateNode.containerInfo===_)return;k=k.return}for(;q!==null;){if(k=rn(q),k===null)return;if(M=k.tag,M===5||M===6||M===26||M===27){d=m=k;continue e}q=q.parentNode}}d=d.return}Fd(function(){var ee=m,ie=Wc(r),he=[];e:{var oe=lu.get(e);if(oe!==void 0){var ae=wl,Ue=e;switch(e){case"keypress":if(ml(r)===0)break e;case"keydown":case"keyup":ae=gy;break;case"focusin":Ue="focus",ae=es;break;case"focusout":Ue="blur",ae=es;break;case"beforeblur":case"afterblur":ae=es;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ae=Ud;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ae=ry;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ae=wy;break;case nu:case ou:case au:ae=sy;break;case ru:ae=xy;break;case"scroll":case"scrollend":ae=oy;break;case"wheel":ae=by;break;case"copy":case"cut":case"paste":ae=dy;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ae=Od;break;case"toggle":case"beforetoggle":ae=Ry}var Fe=(n&4)!==0,it=!Fe&&(e==="scroll"||e==="scrollend"),X=Fe?oe!==null?oe+"Capture":null:oe;Fe=[];for(var G=ee,K;G!==null;){var ue=G;if(K=ue.stateNode,ue=ue.tag,ue!==5&&ue!==26&&ue!==27||K===null||X===null||(ue=ar(G,X),ue!=null&&Fe.push(Ir(G,ue,K))),it)break;G=G.return}0<Fe.length&&(oe=new ae(oe,Ue,null,r,ie),he.push({event:oe,listeners:Fe}))}}if((n&7)===0){e:{if(oe=e==="mouseover"||e==="pointerover",ae=e==="mouseout"||e==="pointerout",oe&&r!==Yc&&(Ue=r.relatedTarget||r.fromElement)&&(rn(Ue)||Ue[no]))break e;if((ae||oe)&&(oe=ie.window===ie?ie:(oe=ie.ownerDocument)?oe.defaultView||oe.parentWindow:window,ae?(Ue=r.relatedTarget||r.toElement,ae=ee,Ue=Ue?rn(Ue):null,Ue!==null&&(it=c(Ue),Fe=Ue.tag,Ue!==it||Fe!==5&&Fe!==27&&Fe!==6)&&(Ue=null)):(ae=null,Ue=ee),ae!==Ue)){if(Fe=Ud,ue="onMouseLeave",X="onMouseEnter",G="mouse",(e==="pointerout"||e==="pointerover")&&(Fe=Od,ue="onPointerLeave",X="onPointerEnter",G="pointer"),it=ae==null?oe:wn(ae),K=Ue==null?oe:wn(Ue),oe=new Fe(ue,G+"leave",ae,r,ie),oe.target=it,oe.relatedTarget=K,ue=null,rn(ie)===ee&&(Fe=new Fe(X,G+"enter",Ue,r,ie),Fe.target=K,Fe.relatedTarget=it,ue=Fe),it=ue,ae&&Ue)t:{for(Fe=ae,X=Ue,G=0,K=Fe;K;K=za(K))G++;for(K=0,ue=X;ue;ue=za(ue))K++;for(;0<G-K;)Fe=za(Fe),G--;for(;0<K-G;)X=za(X),K--;for(;G--;){if(Fe===X||X!==null&&Fe===X.alternate)break t;Fe=za(Fe),X=za(X)}Fe=null}else Fe=null;ae!==null&&Af(he,oe,ae,Fe,!1),Ue!==null&&it!==null&&Af(he,it,Ue,Fe,!0)}}e:{if(oe=ee?wn(ee):window,ae=oe.nodeName&&oe.nodeName.toLowerCase(),ae==="select"||ae==="input"&&oe.type==="file")var Re=zd;else if(Bd(oe))if(Gd)Re=$y;else{Re=Ny;var ze=qy}else ae=oe.nodeName,!ae||ae.toLowerCase()!=="input"||oe.type!=="checkbox"&&oe.type!=="radio"?ee&&Gc(ee.elementType)&&(Re=zd):Re=Uy;if(Re&&(Re=Re(e,ee))){Vd(he,Re,r,ie);break e}ze&&ze(e,oe,ee),e==="focusout"&&ee&&oe.type==="number"&&ee.memoizedProps.value!=null&&zc(oe,"number",oe.value)}switch(ze=ee?wn(ee):window,e){case"focusin":(Bd(ze)||ze.contentEditable==="true")&&(Ca=ze,ls=ee,pr=null);break;case"focusout":pr=ls=Ca=null;break;case"mousedown":cs=!0;break;case"contextmenu":case"mouseup":case"dragend":cs=!1,eu(he,r,ie);break;case"selectionchange":if(Ly)break;case"keydown":case"keyup":eu(he,r,ie)}var Ae;if(ns)e:{switch(e){case"compositionstart":var qe="onCompositionStart";break e;case"compositionend":qe="onCompositionEnd";break e;case"compositionupdate":qe="onCompositionUpdate";break e}qe=void 0}else wa?Md(e,r)&&(qe="onCompositionEnd"):e==="keydown"&&r.keyCode===229&&(qe="onCompositionStart");qe&&(Ld&&r.locale!=="ko"&&(wa||qe!=="onCompositionStart"?qe==="onCompositionEnd"&&wa&&(Ae=qd()):(bo=ie,Zc="value"in bo?bo.value:bo.textContent,wa=!0)),ze=cc(ee,qe),0<ze.length&&(qe=new $d(qe,e,null,r,ie),he.push({event:qe,listeners:ze}),Ae?qe.data=Ae:(Ae=Hd(r),Ae!==null&&(qe.data=Ae)))),(Ae=jy?ky(e,r):Dy(e,r))&&(qe=cc(ee,"onBeforeInput"),0<qe.length&&(ze=new $d("onBeforeInput","beforeinput",null,r,ie),he.push({event:ze,listeners:qe}),ze.data=Ae)),wg(he,e,ee,r,ie)}Ef(he,n)})}function Ir(e,n,r){return{instance:e,listener:n,currentTarget:r}}function cc(e,n){for(var r=n+"Capture",d=[];e!==null;){var _=e,m=_.stateNode;if(_=_.tag,_!==5&&_!==26&&_!==27||m===null||(_=ar(e,r),_!=null&&d.unshift(Ir(e,_,m)),_=ar(e,n),_!=null&&d.push(Ir(e,_,m))),e.tag===3)return d;e=e.return}return[]}function za(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5&&e.tag!==27);return e||null}function Af(e,n,r,d,_){for(var m=n._reactName,k=[];r!==null&&r!==d;){var q=r,M=q.alternate,ee=q.stateNode;if(q=q.tag,M!==null&&M===d)break;q!==5&&q!==26&&q!==27||ee===null||(M=ee,_?(ee=ar(r,m),ee!=null&&k.unshift(Ir(r,ee,M))):_||(ee=ar(r,m),ee!=null&&k.push(Ir(r,ee,M)))),r=r.return}k.length!==0&&e.push({event:n,listeners:k})}var bg=/\r\n?/g,Eg=/\u0000|\uFFFD/g;function jf(e){return(typeof e=="string"?e:""+e).replace(bg,`
`).replace(Eg,"")}function kf(e,n){return n=jf(n),jf(e)===n}function sc(){}function st(e,n,r,d,_,m){switch(r){case"children":typeof d=="string"?n==="body"||n==="textarea"&&d===""||ga(e,d):(typeof d=="number"||typeof d=="bigint")&&n!=="body"&&ga(e,""+d);break;case"className":Pt(e,"class",d);break;case"tabIndex":Pt(e,"tabindex",d);break;case"dir":case"role":case"viewBox":case"width":case"height":Pt(e,r,d);break;case"style":Dd(e,d,m);break;case"data":if(n!=="object"){Pt(e,"data",d);break}case"src":case"href":if(d===""&&(n!=="a"||r!=="href")){e.removeAttribute(r);break}if(d==null||typeof d=="function"||typeof d=="symbol"||typeof d=="boolean"){e.removeAttribute(r);break}d=yl(""+d),e.setAttribute(r,d);break;case"action":case"formAction":if(typeof d=="function"){e.setAttribute(r,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof m=="function"&&(r==="formAction"?(n!=="input"&&st(e,n,"name",_.name,_,null),st(e,n,"formEncType",_.formEncType,_,null),st(e,n,"formMethod",_.formMethod,_,null),st(e,n,"formTarget",_.formTarget,_,null)):(st(e,n,"encType",_.encType,_,null),st(e,n,"method",_.method,_,null),st(e,n,"target",_.target,_,null)));if(d==null||typeof d=="symbol"||typeof d=="boolean"){e.removeAttribute(r);break}d=yl(""+d),e.setAttribute(r,d);break;case"onClick":d!=null&&(e.onclick=sc);break;case"onScroll":d!=null&&Qe("scroll",e);break;case"onScrollEnd":d!=null&&Qe("scrollend",e);break;case"dangerouslySetInnerHTML":if(d!=null){if(typeof d!="object"||!("__html"in d))throw Error(i(61));if(r=d.__html,r!=null){if(_.children!=null)throw Error(i(60));e.innerHTML=r}}break;case"multiple":e.multiple=d&&typeof d!="function"&&typeof d!="symbol";break;case"muted":e.muted=d&&typeof d!="function"&&typeof d!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(d==null||typeof d=="function"||typeof d=="boolean"||typeof d=="symbol"){e.removeAttribute("xlink:href");break}r=yl(""+d),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",r);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":d!=null&&typeof d!="function"&&typeof d!="symbol"?e.setAttribute(r,""+d):e.removeAttribute(r);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":d&&typeof d!="function"&&typeof d!="symbol"?e.setAttribute(r,""):e.removeAttribute(r);break;case"capture":case"download":d===!0?e.setAttribute(r,""):d!==!1&&d!=null&&typeof d!="function"&&typeof d!="symbol"?e.setAttribute(r,d):e.removeAttribute(r);break;case"cols":case"rows":case"size":case"span":d!=null&&typeof d!="function"&&typeof d!="symbol"&&!isNaN(d)&&1<=d?e.setAttribute(r,d):e.removeAttribute(r);break;case"rowSpan":case"start":d==null||typeof d=="function"||typeof d=="symbol"||isNaN(d)?e.removeAttribute(r):e.setAttribute(r,d);break;case"popover":Qe("beforetoggle",e),Qe("toggle",e),So(e,"popover",d);break;case"xlinkActuate":Xn(e,"http://www.w3.org/1999/xlink","xlink:actuate",d);break;case"xlinkArcrole":Xn(e,"http://www.w3.org/1999/xlink","xlink:arcrole",d);break;case"xlinkRole":Xn(e,"http://www.w3.org/1999/xlink","xlink:role",d);break;case"xlinkShow":Xn(e,"http://www.w3.org/1999/xlink","xlink:show",d);break;case"xlinkTitle":Xn(e,"http://www.w3.org/1999/xlink","xlink:title",d);break;case"xlinkType":Xn(e,"http://www.w3.org/1999/xlink","xlink:type",d);break;case"xmlBase":Xn(e,"http://www.w3.org/XML/1998/namespace","xml:base",d);break;case"xmlLang":Xn(e,"http://www.w3.org/XML/1998/namespace","xml:lang",d);break;case"xmlSpace":Xn(e,"http://www.w3.org/XML/1998/namespace","xml:space",d);break;case"is":So(e,"is",d);break;case"innerText":case"textContent":break;default:(!(2<r.length)||r[0]!=="o"&&r[0]!=="O"||r[1]!=="n"&&r[1]!=="N")&&(r=ty.get(r)||r,So(e,r,d))}}function Di(e,n,r,d,_,m){switch(r){case"style":Dd(e,d,m);break;case"dangerouslySetInnerHTML":if(d!=null){if(typeof d!="object"||!("__html"in d))throw Error(i(61));if(r=d.__html,r!=null){if(_.children!=null)throw Error(i(60));e.innerHTML=r}}break;case"children":typeof d=="string"?ga(e,d):(typeof d=="number"||typeof d=="bigint")&&ga(e,""+d);break;case"onScroll":d!=null&&Qe("scroll",e);break;case"onScrollEnd":d!=null&&Qe("scrollend",e);break;case"onClick":d!=null&&(e.onclick=sc);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Pc.hasOwnProperty(r))e:{if(r[0]==="o"&&r[1]==="n"&&(_=r.endsWith("Capture"),n=r.slice(2,_?r.length-7:void 0),m=e[Qt]||null,m=m!=null?m[r]:null,typeof m=="function"&&e.removeEventListener(n,m,_),typeof d=="function")){typeof m!="function"&&m!==null&&(r in e?e[r]=null:e.hasAttribute(r)&&e.removeAttribute(r)),e.addEventListener(n,d,_);break e}r in e?e[r]=d:d===!0?e.setAttribute(r,""):So(e,r,d)}}}function Jt(e,n,r){switch(n){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Qe("error",e),Qe("load",e);var d=!1,_=!1,m;for(m in r)if(r.hasOwnProperty(m)){var k=r[m];if(k!=null)switch(m){case"src":d=!0;break;case"srcSet":_=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(i(137,n));default:st(e,n,m,k,r,null)}}_&&st(e,n,"srcSet",r.srcSet,r,null),d&&st(e,n,"src",r.src,r,null);return;case"input":Qe("invalid",e);var q=m=k=_=null,M=null,ee=null;for(d in r)if(r.hasOwnProperty(d)){var ie=r[d];if(ie!=null)switch(d){case"name":_=ie;break;case"type":k=ie;break;case"checked":M=ie;break;case"defaultChecked":ee=ie;break;case"value":m=ie;break;case"defaultValue":q=ie;break;case"children":case"dangerouslySetInnerHTML":if(ie!=null)throw Error(i(137,n));break;default:st(e,n,d,ie,r,null)}}Rd(e,m,q,M,ee,k,_,!1),hl(e);return;case"select":Qe("invalid",e),d=k=m=null;for(_ in r)if(r.hasOwnProperty(_)&&(q=r[_],q!=null))switch(_){case"value":m=q;break;case"defaultValue":k=q;break;case"multiple":d=q;default:st(e,n,_,q,r,null)}n=m,r=k,e.multiple=!!d,n!=null?ya(e,!!d,n,!1):r!=null&&ya(e,!!d,r,!0);return;case"textarea":Qe("invalid",e),m=_=d=null;for(k in r)if(r.hasOwnProperty(k)&&(q=r[k],q!=null))switch(k){case"value":d=q;break;case"defaultValue":_=q;break;case"children":m=q;break;case"dangerouslySetInnerHTML":if(q!=null)throw Error(i(91));break;default:st(e,n,k,q,r,null)}jd(e,d,_,m),hl(e);return;case"option":for(M in r)if(r.hasOwnProperty(M)&&(d=r[M],d!=null))switch(M){case"selected":e.selected=d&&typeof d!="function"&&typeof d!="symbol";break;default:st(e,n,M,d,r,null)}return;case"dialog":Qe("beforetoggle",e),Qe("toggle",e),Qe("cancel",e),Qe("close",e);break;case"iframe":case"object":Qe("load",e);break;case"video":case"audio":for(d=0;d<Pr.length;d++)Qe(Pr[d],e);break;case"image":Qe("error",e),Qe("load",e);break;case"details":Qe("toggle",e);break;case"embed":case"source":case"link":Qe("error",e),Qe("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(ee in r)if(r.hasOwnProperty(ee)&&(d=r[ee],d!=null))switch(ee){case"children":case"dangerouslySetInnerHTML":throw Error(i(137,n));default:st(e,n,ee,d,r,null)}return;default:if(Gc(n)){for(ie in r)r.hasOwnProperty(ie)&&(d=r[ie],d!==void 0&&Di(e,n,ie,d,r,void 0));return}}for(q in r)r.hasOwnProperty(q)&&(d=r[q],d!=null&&st(e,n,q,d,r,null))}function Rg(e,n,r,d){switch(n){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var _=null,m=null,k=null,q=null,M=null,ee=null,ie=null;for(ae in r){var he=r[ae];if(r.hasOwnProperty(ae)&&he!=null)switch(ae){case"checked":break;case"value":break;case"defaultValue":M=he;default:d.hasOwnProperty(ae)||st(e,n,ae,null,d,he)}}for(var oe in d){var ae=d[oe];if(he=r[oe],d.hasOwnProperty(oe)&&(ae!=null||he!=null))switch(oe){case"type":m=ae;break;case"name":_=ae;break;case"checked":ee=ae;break;case"defaultChecked":ie=ae;break;case"value":k=ae;break;case"defaultValue":q=ae;break;case"children":case"dangerouslySetInnerHTML":if(ae!=null)throw Error(i(137,n));break;default:ae!==he&&st(e,n,oe,ae,d,he)}}Vc(e,k,q,M,ee,ie,m,_);return;case"select":ae=k=q=oe=null;for(m in r)if(M=r[m],r.hasOwnProperty(m)&&M!=null)switch(m){case"value":break;case"multiple":ae=M;default:d.hasOwnProperty(m)||st(e,n,m,null,d,M)}for(_ in d)if(m=d[_],M=r[_],d.hasOwnProperty(_)&&(m!=null||M!=null))switch(_){case"value":oe=m;break;case"defaultValue":q=m;break;case"multiple":k=m;default:m!==M&&st(e,n,_,m,d,M)}n=q,r=k,d=ae,oe!=null?ya(e,!!r,oe,!1):!!d!=!!r&&(n!=null?ya(e,!!r,n,!0):ya(e,!!r,r?[]:"",!1));return;case"textarea":ae=oe=null;for(q in r)if(_=r[q],r.hasOwnProperty(q)&&_!=null&&!d.hasOwnProperty(q))switch(q){case"value":break;case"children":break;default:st(e,n,q,null,d,_)}for(k in d)if(_=d[k],m=r[k],d.hasOwnProperty(k)&&(_!=null||m!=null))switch(k){case"value":oe=_;break;case"defaultValue":ae=_;break;case"children":break;case"dangerouslySetInnerHTML":if(_!=null)throw Error(i(91));break;default:_!==m&&st(e,n,k,_,d,m)}Ad(e,oe,ae);return;case"option":for(var Ue in r)if(oe=r[Ue],r.hasOwnProperty(Ue)&&oe!=null&&!d.hasOwnProperty(Ue))switch(Ue){case"selected":e.selected=!1;break;default:st(e,n,Ue,null,d,oe)}for(M in d)if(oe=d[M],ae=r[M],d.hasOwnProperty(M)&&oe!==ae&&(oe!=null||ae!=null))switch(M){case"selected":e.selected=oe&&typeof oe!="function"&&typeof oe!="symbol";break;default:st(e,n,M,oe,d,ae)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Fe in r)oe=r[Fe],r.hasOwnProperty(Fe)&&oe!=null&&!d.hasOwnProperty(Fe)&&st(e,n,Fe,null,d,oe);for(ee in d)if(oe=d[ee],ae=r[ee],d.hasOwnProperty(ee)&&oe!==ae&&(oe!=null||ae!=null))switch(ee){case"children":case"dangerouslySetInnerHTML":if(oe!=null)throw Error(i(137,n));break;default:st(e,n,ee,oe,d,ae)}return;default:if(Gc(n)){for(var it in r)oe=r[it],r.hasOwnProperty(it)&&oe!==void 0&&!d.hasOwnProperty(it)&&Di(e,n,it,void 0,d,oe);for(ie in d)oe=d[ie],ae=r[ie],!d.hasOwnProperty(ie)||oe===ae||oe===void 0&&ae===void 0||Di(e,n,ie,oe,d,ae);return}}for(var X in r)oe=r[X],r.hasOwnProperty(X)&&oe!=null&&!d.hasOwnProperty(X)&&st(e,n,X,null,d,oe);for(he in d)oe=d[he],ae=r[he],!d.hasOwnProperty(he)||oe===ae||oe==null&&ae==null||st(e,n,he,oe,d,ae)}var Ti=null,Fi=null;function ic(e){return e.nodeType===9?e:e.ownerDocument}function Df(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Tf(e,n){if(e===0)switch(n){case"svg":return 1;case"math":return 2;default:return 0}return e===1&&n==="foreignObject"?0:e}function qi(e,n){return e==="textarea"||e==="noscript"||typeof n.children=="string"||typeof n.children=="number"||typeof n.children=="bigint"||typeof n.dangerouslySetInnerHTML=="object"&&n.dangerouslySetInnerHTML!==null&&n.dangerouslySetInnerHTML.__html!=null}var Ni=null;function Ag(){var e=window.event;return e&&e.type==="popstate"?e===Ni?!1:(Ni=e,!0):(Ni=null,!1)}var Ff=typeof setTimeout=="function"?setTimeout:void 0,jg=typeof clearTimeout=="function"?clearTimeout:void 0,qf=typeof Promise=="function"?Promise:void 0,kg=typeof queueMicrotask=="function"?queueMicrotask:typeof qf<"u"?function(e){return qf.resolve(null).then(e).catch(Dg)}:Ff;function Dg(e){setTimeout(function(){throw e})}function Io(e){return e==="head"}function Nf(e,n){var r=n,d=0,_=0;do{var m=r.nextSibling;if(e.removeChild(r),m&&m.nodeType===8)if(r=m.data,r==="/$"){if(0<d&&8>d){r=d;var k=e.ownerDocument;if(r&1&&Mr(k.documentElement),r&2&&Mr(k.body),r&4)for(r=k.head,Mr(r),k=r.firstChild;k;){var q=k.nextSibling,M=k.nodeName;k[ut]||M==="SCRIPT"||M==="STYLE"||M==="LINK"&&k.rel.toLowerCase()==="stylesheet"||r.removeChild(k),k=q}}if(_===0){e.removeChild(m),Qr(n);return}_--}else r==="$"||r==="$?"||r==="$!"?_++:d=r.charCodeAt(0)-48;else d=0;r=m}while(r);Qr(n)}function Ui(e){var n=e.firstChild;for(n&&n.nodeType===10&&(n=n.nextSibling);n;){var r=n;switch(n=n.nextSibling,r.nodeName){case"HTML":case"HEAD":case"BODY":Ui(r),Lt(r);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(r.rel.toLowerCase()==="stylesheet")continue}e.removeChild(r)}}function Tg(e,n,r,d){for(;e.nodeType===1;){var _=r;if(e.nodeName.toLowerCase()!==n.toLowerCase()){if(!d&&(e.nodeName!=="INPUT"||e.type!=="hidden"))break}else if(d){if(!e[ut])switch(n){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if(m=e.getAttribute("rel"),m==="stylesheet"&&e.hasAttribute("data-precedence"))break;if(m!==_.rel||e.getAttribute("href")!==(_.href==null||_.href===""?null:_.href)||e.getAttribute("crossorigin")!==(_.crossOrigin==null?null:_.crossOrigin)||e.getAttribute("title")!==(_.title==null?null:_.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(m=e.getAttribute("src"),(m!==(_.src==null?null:_.src)||e.getAttribute("type")!==(_.type==null?null:_.type)||e.getAttribute("crossorigin")!==(_.crossOrigin==null?null:_.crossOrigin))&&m&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else if(n==="input"&&e.type==="hidden"){var m=_.name==null?null:""+_.name;if(_.type==="hidden"&&e.getAttribute("name")===m)return e}else return e;if(e=Vn(e.nextSibling),e===null)break}return null}function Fg(e,n,r){if(n==="")return null;for(;e.nodeType!==3;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!r||(e=Vn(e.nextSibling),e===null))return null;return e}function $i(e){return e.data==="$!"||e.data==="$?"&&e.ownerDocument.readyState==="complete"}function qg(e,n){var r=e.ownerDocument;if(e.data!=="$?"||r.readyState==="complete")n();else{var d=function(){n(),r.removeEventListener("DOMContentLoaded",d)};r.addEventListener("DOMContentLoaded",d),e._reactRetry=d}}function Vn(e){for(;e!=null;e=e.nextSibling){var n=e.nodeType;if(n===1||n===3)break;if(n===8){if(n=e.data,n==="$"||n==="$!"||n==="$?"||n==="F!"||n==="F")break;if(n==="/$")return null}}return e}var Oi=null;function Uf(e){e=e.previousSibling;for(var n=0;e;){if(e.nodeType===8){var r=e.data;if(r==="$"||r==="$!"||r==="$?"){if(n===0)return e;n--}else r==="/$"&&n++}e=e.previousSibling}return null}function $f(e,n,r){switch(n=ic(r),e){case"html":if(e=n.documentElement,!e)throw Error(i(452));return e;case"head":if(e=n.head,!e)throw Error(i(453));return e;case"body":if(e=n.body,!e)throw Error(i(454));return e;default:throw Error(i(451))}}function Mr(e){for(var n=e.attributes;n.length;)e.removeAttributeNode(n[0]);Lt(e)}var On=new Map,Of=new Set;function dc(e){return typeof e.getRootNode=="function"?e.getRootNode():e.nodeType===9?e:e.ownerDocument}var go=B.d;B.d={f:Ng,r:Ug,D:$g,C:Og,L:Lg,m:Pg,X:Mg,S:Ig,M:Hg};function Ng(){var e=go.f(),n=tc();return e||n}function Ug(e){var n=Xt(e);n!==null&&n.tag===5&&n.type==="form"?np(n):go.r(e)}var Ga=typeof document>"u"?null:document;function Lf(e,n,r){var d=Ga;if(d&&typeof n=="string"&&n){var _=Dn(n);_='link[rel="'+e+'"][href="'+_+'"]',typeof r=="string"&&(_+='[crossorigin="'+r+'"]'),Of.has(_)||(Of.add(_),e={rel:e,crossOrigin:r,href:n},d.querySelector(_)===null&&(n=d.createElement("link"),Jt(n,"link",e),ft(n),d.head.appendChild(n)))}}function $g(e){go.D(e),Lf("dns-prefetch",e,null)}function Og(e,n){go.C(e,n),Lf("preconnect",e,n)}function Lg(e,n,r){go.L(e,n,r);var d=Ga;if(d&&e&&n){var _='link[rel="preload"][as="'+Dn(n)+'"]';n==="image"&&r&&r.imageSrcSet?(_+='[imagesrcset="'+Dn(r.imageSrcSet)+'"]',typeof r.imageSizes=="string"&&(_+='[imagesizes="'+Dn(r.imageSizes)+'"]')):_+='[href="'+Dn(e)+'"]';var m=_;switch(n){case"style":m=Ya(e);break;case"script":m=Wa(e)}On.has(m)||(e=y({rel:"preload",href:n==="image"&&r&&r.imageSrcSet?void 0:e,as:n},r),On.set(m,e),d.querySelector(_)!==null||n==="style"&&d.querySelector(Hr(m))||n==="script"&&d.querySelector(Br(m))||(n=d.createElement("link"),Jt(n,"link",e),ft(n),d.head.appendChild(n)))}}function Pg(e,n){go.m(e,n);var r=Ga;if(r&&e){var d=n&&typeof n.as=="string"?n.as:"script",_='link[rel="modulepreload"][as="'+Dn(d)+'"][href="'+Dn(e)+'"]',m=_;switch(d){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":m=Wa(e)}if(!On.has(m)&&(e=y({rel:"modulepreload",href:e},n),On.set(m,e),r.querySelector(_)===null)){switch(d){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(r.querySelector(Br(m)))return}d=r.createElement("link"),Jt(d,"link",e),ft(d),r.head.appendChild(d)}}}function Ig(e,n,r){go.S(e,n,r);var d=Ga;if(d&&e){var _=Mn(d).hoistableStyles,m=Ya(e);n=n||"default";var k=_.get(m);if(!k){var q={loading:0,preload:null};if(k=d.querySelector(Hr(m)))q.loading=5;else{e=y({rel:"stylesheet",href:e,"data-precedence":n},r),(r=On.get(m))&&Li(e,r);var M=k=d.createElement("link");ft(M),Jt(M,"link",e),M._p=new Promise(function(ee,ie){M.onload=ee,M.onerror=ie}),M.addEventListener("load",function(){q.loading|=1}),M.addEventListener("error",function(){q.loading|=2}),q.loading|=4,uc(k,n,d)}k={type:"stylesheet",instance:k,count:1,state:q},_.set(m,k)}}}function Mg(e,n){go.X(e,n);var r=Ga;if(r&&e){var d=Mn(r).hoistableScripts,_=Wa(e),m=d.get(_);m||(m=r.querySelector(Br(_)),m||(e=y({src:e,async:!0},n),(n=On.get(_))&&Pi(e,n),m=r.createElement("script"),ft(m),Jt(m,"link",e),r.head.appendChild(m)),m={type:"script",instance:m,count:1,state:null},d.set(_,m))}}function Hg(e,n){go.M(e,n);var r=Ga;if(r&&e){var d=Mn(r).hoistableScripts,_=Wa(e),m=d.get(_);m||(m=r.querySelector(Br(_)),m||(e=y({src:e,async:!0,type:"module"},n),(n=On.get(_))&&Pi(e,n),m=r.createElement("script"),ft(m),Jt(m,"link",e),r.head.appendChild(m)),m={type:"script",instance:m,count:1,state:null},d.set(_,m))}}function Pf(e,n,r,d){var _=(_=ve.current)?dc(_):null;if(!_)throw Error(i(446));switch(e){case"meta":case"title":return null;case"style":return typeof r.precedence=="string"&&typeof r.href=="string"?(n=Ya(r.href),r=Mn(_).hoistableStyles,d=r.get(n),d||(d={type:"style",instance:null,count:0,state:null},r.set(n,d)),d):{type:"void",instance:null,count:0,state:null};case"link":if(r.rel==="stylesheet"&&typeof r.href=="string"&&typeof r.precedence=="string"){e=Ya(r.href);var m=Mn(_).hoistableStyles,k=m.get(e);if(k||(_=_.ownerDocument||_,k={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},m.set(e,k),(m=_.querySelector(Hr(e)))&&!m._p&&(k.instance=m,k.state.loading=5),On.has(e)||(r={rel:"preload",as:"style",href:r.href,crossOrigin:r.crossOrigin,integrity:r.integrity,media:r.media,hrefLang:r.hrefLang,referrerPolicy:r.referrerPolicy},On.set(e,r),m||Bg(_,e,r,k.state))),n&&d===null)throw Error(i(528,""));return k}if(n&&d!==null)throw Error(i(529,""));return null;case"script":return n=r.async,r=r.src,typeof r=="string"&&n&&typeof n!="function"&&typeof n!="symbol"?(n=Wa(r),r=Mn(_).hoistableScripts,d=r.get(n),d||(d={type:"script",instance:null,count:0,state:null},r.set(n,d)),d):{type:"void",instance:null,count:0,state:null};default:throw Error(i(444,e))}}function Ya(e){return'href="'+Dn(e)+'"'}function Hr(e){return'link[rel="stylesheet"]['+e+"]"}function If(e){return y({},e,{"data-precedence":e.precedence,precedence:null})}function Bg(e,n,r,d){e.querySelector('link[rel="preload"][as="style"]['+n+"]")?d.loading=1:(n=e.createElement("link"),d.preload=n,n.addEventListener("load",function(){return d.loading|=1}),n.addEventListener("error",function(){return d.loading|=2}),Jt(n,"link",r),ft(n),e.head.appendChild(n))}function Wa(e){return'[src="'+Dn(e)+'"]'}function Br(e){return"script[async]"+e}function Mf(e,n,r){if(n.count++,n.instance===null)switch(n.type){case"style":var d=e.querySelector('style[data-href~="'+Dn(r.href)+'"]');if(d)return n.instance=d,ft(d),d;var _=y({},r,{"data-href":r.href,"data-precedence":r.precedence,href:null,precedence:null});return d=(e.ownerDocument||e).createElement("style"),ft(d),Jt(d,"style",_),uc(d,r.precedence,e),n.instance=d;case"stylesheet":_=Ya(r.href);var m=e.querySelector(Hr(_));if(m)return n.state.loading|=4,n.instance=m,ft(m),m;d=If(r),(_=On.get(_))&&Li(d,_),m=(e.ownerDocument||e).createElement("link"),ft(m);var k=m;return k._p=new Promise(function(q,M){k.onload=q,k.onerror=M}),Jt(m,"link",d),n.state.loading|=4,uc(m,r.precedence,e),n.instance=m;case"script":return m=Wa(r.src),(_=e.querySelector(Br(m)))?(n.instance=_,ft(_),_):(d=r,(_=On.get(m))&&(d=y({},r),Pi(d,_)),e=e.ownerDocument||e,_=e.createElement("script"),ft(_),Jt(_,"link",d),e.head.appendChild(_),n.instance=_);case"void":return null;default:throw Error(i(443,n.type))}else n.type==="stylesheet"&&(n.state.loading&4)===0&&(d=n.instance,n.state.loading|=4,uc(d,r.precedence,e));return n.instance}function uc(e,n,r){for(var d=r.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),_=d.length?d[d.length-1]:null,m=_,k=0;k<d.length;k++){var q=d[k];if(q.dataset.precedence===n)m=q;else if(m!==_)break}m?m.parentNode.insertBefore(e,m.nextSibling):(n=r.nodeType===9?r.head:r,n.insertBefore(e,n.firstChild))}function Li(e,n){e.crossOrigin==null&&(e.crossOrigin=n.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=n.referrerPolicy),e.title==null&&(e.title=n.title)}function Pi(e,n){e.crossOrigin==null&&(e.crossOrigin=n.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=n.referrerPolicy),e.integrity==null&&(e.integrity=n.integrity)}var pc=null;function Hf(e,n,r){if(pc===null){var d=new Map,_=pc=new Map;_.set(r,d)}else _=pc,d=_.get(r),d||(d=new Map,_.set(r,d));if(d.has(e))return d;for(d.set(e,null),r=r.getElementsByTagName(e),_=0;_<r.length;_++){var m=r[_];if(!(m[ut]||m[Bt]||e==="link"&&m.getAttribute("rel")==="stylesheet")&&m.namespaceURI!=="http://www.w3.org/2000/svg"){var k=m.getAttribute(n)||"";k=e+k;var q=d.get(k);q?q.push(m):d.set(k,[m])}}return d}function Bf(e,n,r){e=e.ownerDocument||e,e.head.insertBefore(r,n==="title"?e.querySelector("head > title"):null)}function Vg(e,n,r){if(r===1||n.itemProp!=null)return!1;switch(e){case"meta":case"title":return!0;case"style":if(typeof n.precedence!="string"||typeof n.href!="string"||n.href==="")break;return!0;case"link":if(typeof n.rel!="string"||typeof n.href!="string"||n.href===""||n.onLoad||n.onError)break;switch(n.rel){case"stylesheet":return e=n.disabled,typeof n.precedence=="string"&&e==null;default:return!0}case"script":if(n.async&&typeof n.async!="function"&&typeof n.async!="symbol"&&!n.onLoad&&!n.onError&&n.src&&typeof n.src=="string")return!0}return!1}function Vf(e){return!(e.type==="stylesheet"&&(e.state.loading&3)===0)}var Vr=null;function zg(){}function Gg(e,n,r){if(Vr===null)throw Error(i(475));var d=Vr;if(n.type==="stylesheet"&&(typeof r.media!="string"||matchMedia(r.media).matches!==!1)&&(n.state.loading&4)===0){if(n.instance===null){var _=Ya(r.href),m=e.querySelector(Hr(_));if(m){e=m._p,e!==null&&typeof e=="object"&&typeof e.then=="function"&&(d.count++,d=fc.bind(d),e.then(d,d)),n.state.loading|=4,n.instance=m,ft(m);return}m=e.ownerDocument||e,r=If(r),(_=On.get(_))&&Li(r,_),m=m.createElement("link"),ft(m);var k=m;k._p=new Promise(function(q,M){k.onload=q,k.onerror=M}),Jt(m,"link",r),n.instance=m}d.stylesheets===null&&(d.stylesheets=new Map),d.stylesheets.set(n,e),(e=n.state.preload)&&(n.state.loading&3)===0&&(d.count++,n=fc.bind(d),e.addEventListener("load",n),e.addEventListener("error",n))}}function Yg(){if(Vr===null)throw Error(i(475));var e=Vr;return e.stylesheets&&e.count===0&&Ii(e,e.stylesheets),0<e.count?function(n){var r=setTimeout(function(){if(e.stylesheets&&Ii(e,e.stylesheets),e.unsuspend){var d=e.unsuspend;e.unsuspend=null,d()}},6e4);return e.unsuspend=n,function(){e.unsuspend=null,clearTimeout(r)}}:null}function fc(){if(this.count--,this.count===0){if(this.stylesheets)Ii(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}}var hc=null;function Ii(e,n){e.stylesheets=null,e.unsuspend!==null&&(e.count++,hc=new Map,n.forEach(Wg,e),hc=null,fc.call(e))}function Wg(e,n){if(!(n.state.loading&4)){var r=hc.get(e);if(r)var d=r.get(null);else{r=new Map,hc.set(e,r);for(var _=e.querySelectorAll("link[data-precedence],style[data-precedence]"),m=0;m<_.length;m++){var k=_[m];(k.nodeName==="LINK"||k.getAttribute("media")!=="not all")&&(r.set(k.dataset.precedence,k),d=k)}d&&r.set(null,d)}_=n.instance,k=_.getAttribute("data-precedence"),m=r.get(k)||d,m===d&&r.set(null,_),r.set(k,_),this.count++,d=fc.bind(this),_.addEventListener("load",d),_.addEventListener("error",d),m?m.parentNode.insertBefore(_,m.nextSibling):(e=e.nodeType===9?e.head:e,e.insertBefore(_,e.firstChild)),n.state.loading|=4}}var zr={$$typeof:j,Provider:null,Consumer:null,_currentValue:W,_currentValue2:W,_threadCount:0};function Qg(e,n,r,d,_,m,k,q){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Yo(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Yo(0),this.hiddenUpdates=Yo(null),this.identifierPrefix=d,this.onUncaughtError=_,this.onCaughtError=m,this.onRecoverableError=k,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=q,this.incompleteTransitions=new Map}function zf(e,n,r,d,_,m,k,q,M,ee,ie,he){return e=new Qg(e,n,r,k,q,M,ee,he),n=1,m===!0&&(n|=24),m=xn(3,null,null,n),e.current=m,m.stateNode=e,n=Cs(),n.refCount++,e.pooledCache=n,n.refCount++,m.memoizedState={element:d,isDehydrated:r,cache:n},Es(m),e}function Gf(e){return e?(e=Ea,e):Ea}function Yf(e,n,r,d,_,m){_=Gf(_),d.context===null?d.context=_:d.pendingContext=_,d=Ao(n),d.payload={element:r},m=m===void 0?null:m,m!==null&&(d.callback=m),r=jo(e,d,n),r!==null&&(An(r,e,n),Cr(r,e,n))}function Wf(e,n){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var r=e.retryLane;e.retryLane=r!==0&&r<n?r:n}}function Mi(e,n){Wf(e,n),(e=e.alternate)&&Wf(e,n)}function Qf(e){if(e.tag===13){var n=ba(e,67108864);n!==null&&An(n,e,67108864),Mi(e,67108864)}}var _c=!0;function Xg(e,n,r,d){var _=F.T;F.T=null;var m=B.p;try{B.p=2,Hi(e,n,r,d)}finally{B.p=m,F.T=_}}function Zg(e,n,r,d){var _=F.T;F.T=null;var m=B.p;try{B.p=8,Hi(e,n,r,d)}finally{B.p=m,F.T=_}}function Hi(e,n,r,d){if(_c){var _=Bi(d);if(_===null)ki(e,n,d,yc,r),Zf(e,d);else if(Jg(_,e,n,r,d))d.stopPropagation();else if(Zf(e,d),n&4&&-1<Kg.indexOf(e)){for(;_!==null;){var m=Xt(_);if(m!==null)switch(m.tag){case 3:if(m=m.stateNode,m.current.memoizedState.isDehydrated){var k=Ne(m.pendingLanes);if(k!==0){var q=m;for(q.pendingLanes|=2,q.entangledLanes|=2;k;){var M=1<<31-Nt(k);q.entanglements[1]|=M,k&=~M}to(m),(rt&6)===0&&(Jl=$e()+500,Lr(0))}}break;case 13:q=ba(m,2),q!==null&&An(q,m,2),tc(),Mi(m,2)}if(m=Bi(d),m===null&&ki(e,n,d,yc,r),m===_)break;_=m}_!==null&&d.stopPropagation()}else ki(e,n,d,null,r)}}function Bi(e){return e=Wc(e),Vi(e)}var yc=null;function Vi(e){if(yc=null,e=rn(e),e!==null){var n=c(e);if(n===null)e=null;else{var r=n.tag;if(r===13){if(e=s(n),e!==null)return e;e=null}else if(r===3){if(n.stateNode.current.memoizedState.isDehydrated)return n.tag===3?n.stateNode.containerInfo:null;e=null}else n!==e&&(e=null)}}return yc=e,null}function Xf(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(xe()){case at:return 2;case nt:return 8;case Ke:case Rt:return 32;case De:return 268435456;default:return 32}default:return 32}}var zi=!1,Mo=null,Ho=null,Bo=null,Gr=new Map,Yr=new Map,Vo=[],Kg="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Zf(e,n){switch(e){case"focusin":case"focusout":Mo=null;break;case"dragenter":case"dragleave":Ho=null;break;case"mouseover":case"mouseout":Bo=null;break;case"pointerover":case"pointerout":Gr.delete(n.pointerId);break;case"gotpointercapture":case"lostpointercapture":Yr.delete(n.pointerId)}}function Wr(e,n,r,d,_,m){return e===null||e.nativeEvent!==m?(e={blockedOn:n,domEventName:r,eventSystemFlags:d,nativeEvent:m,targetContainers:[_]},n!==null&&(n=Xt(n),n!==null&&Qf(n)),e):(e.eventSystemFlags|=d,n=e.targetContainers,_!==null&&n.indexOf(_)===-1&&n.push(_),e)}function Jg(e,n,r,d,_){switch(n){case"focusin":return Mo=Wr(Mo,e,n,r,d,_),!0;case"dragenter":return Ho=Wr(Ho,e,n,r,d,_),!0;case"mouseover":return Bo=Wr(Bo,e,n,r,d,_),!0;case"pointerover":var m=_.pointerId;return Gr.set(m,Wr(Gr.get(m)||null,e,n,r,d,_)),!0;case"gotpointercapture":return m=_.pointerId,Yr.set(m,Wr(Yr.get(m)||null,e,n,r,d,_)),!0}return!1}function Kf(e){var n=rn(e.target);if(n!==null){var r=c(n);if(r!==null){if(n=r.tag,n===13){if(n=s(r),n!==null){e.blockedOn=n,Lc(e.priority,function(){if(r.tag===13){var d=Rn();d=nr(d);var _=ba(r,d);_!==null&&An(_,r,d),Mi(r,d)}});return}}else if(n===3&&r.stateNode.current.memoizedState.isDehydrated){e.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}e.blockedOn=null}function gc(e){if(e.blockedOn!==null)return!1;for(var n=e.targetContainers;0<n.length;){var r=Bi(e.nativeEvent);if(r===null){r=e.nativeEvent;var d=new r.constructor(r.type,r);Yc=d,r.target.dispatchEvent(d),Yc=null}else return n=Xt(r),n!==null&&Qf(n),e.blockedOn=r,!1;n.shift()}return!0}function Jf(e,n,r){gc(e)&&r.delete(n)}function em(){zi=!1,Mo!==null&&gc(Mo)&&(Mo=null),Ho!==null&&gc(Ho)&&(Ho=null),Bo!==null&&gc(Bo)&&(Bo=null),Gr.forEach(Jf),Yr.forEach(Jf)}function mc(e,n){e.blockedOn===n&&(e.blockedOn=null,zi||(zi=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,em)))}var vc=null;function eh(e){vc!==e&&(vc=e,t.unstable_scheduleCallback(t.unstable_NormalPriority,function(){vc===e&&(vc=null);for(var n=0;n<e.length;n+=3){var r=e[n],d=e[n+1],_=e[n+2];if(typeof d!="function"){if(Vi(d||r)===null)continue;break}var m=Xt(r);m!==null&&(e.splice(n,3),n-=3,Vs(m,{pending:!0,data:_,method:r.method,action:d},d,_))}}))}function Qr(e){function n(M){return mc(M,e)}Mo!==null&&mc(Mo,e),Ho!==null&&mc(Ho,e),Bo!==null&&mc(Bo,e),Gr.forEach(n),Yr.forEach(n);for(var r=0;r<Vo.length;r++){var d=Vo[r];d.blockedOn===e&&(d.blockedOn=null)}for(;0<Vo.length&&(r=Vo[0],r.blockedOn===null);)Kf(r),r.blockedOn===null&&Vo.shift();if(r=(e.ownerDocument||e).$$reactFormReplay,r!=null)for(d=0;d<r.length;d+=3){var _=r[d],m=r[d+1],k=_[Qt]||null;if(typeof m=="function")k||eh(r);else if(k){var q=null;if(m&&m.hasAttribute("formAction")){if(_=m,k=m[Qt]||null)q=k.formAction;else if(Vi(_)!==null)continue}else q=k.action;typeof q=="function"?r[d+1]=q:(r.splice(d,3),d-=3),eh(r)}}}function Gi(e){this._internalRoot=e}wc.prototype.render=Gi.prototype.render=function(e){var n=this._internalRoot;if(n===null)throw Error(i(409));var r=n.current,d=Rn();Yf(r,d,e,n,null,null)},wc.prototype.unmount=Gi.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var n=e.containerInfo;Yf(e.current,2,null,e,null,null),tc(),n[no]=null}};function wc(e){this._internalRoot=e}wc.prototype.unstable_scheduleHydration=function(e){if(e){var n=dl();e={blockedOn:null,target:e,priority:n};for(var r=0;r<Vo.length&&n!==0&&n<Vo[r].priority;r++);Vo.splice(r,0,e),r===0&&Kf(e)}};var th=o.version;if(th!=="19.1.1")throw Error(i(527,th,"19.1.1"));B.findDOMNode=function(e){var n=e._reactInternals;if(n===void 0)throw typeof e.render=="function"?Error(i(188)):(e=Object.keys(e).join(","),Error(i(268,e)));return e=p(n),e=e!==null?h(e):null,e=e===null?null:e.stateNode,e};var tm={bundleType:0,version:"19.1.1",rendererPackageName:"react-dom",currentDispatcherRef:F,reconcilerVersion:"19.1.1"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Cc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Cc.isDisabled&&Cc.supportsFiber)try{an=Cc.inject(tm),yt=Cc}catch{}}return Zr.createRoot=function(e,n){if(!l(e))throw Error(i(299));var r=!1,d="",_=yp,m=gp,k=mp,q=null;return n!=null&&(n.unstable_strictMode===!0&&(r=!0),n.identifierPrefix!==void 0&&(d=n.identifierPrefix),n.onUncaughtError!==void 0&&(_=n.onUncaughtError),n.onCaughtError!==void 0&&(m=n.onCaughtError),n.onRecoverableError!==void 0&&(k=n.onRecoverableError),n.unstable_transitionCallbacks!==void 0&&(q=n.unstable_transitionCallbacks)),n=zf(e,1,!1,null,null,r,d,_,m,k,q,null),e[no]=n.current,ji(e),new Gi(n)},Zr.hydrateRoot=function(e,n,r){if(!l(e))throw Error(i(299));var d=!1,_="",m=yp,k=gp,q=mp,M=null,ee=null;return r!=null&&(r.unstable_strictMode===!0&&(d=!0),r.identifierPrefix!==void 0&&(_=r.identifierPrefix),r.onUncaughtError!==void 0&&(m=r.onUncaughtError),r.onCaughtError!==void 0&&(k=r.onCaughtError),r.onRecoverableError!==void 0&&(q=r.onRecoverableError),r.unstable_transitionCallbacks!==void 0&&(M=r.unstable_transitionCallbacks),r.formState!==void 0&&(ee=r.formState)),n=zf(e,1,!0,n,r??null,d,_,m,k,q,M,ee),n.context=Gf(null),r=n.current,d=Rn(),d=nr(d),_=Ao(d),_.callback=null,jo(r,_,d),r=d,n.current.lanes=r,In(n,r),to(n),e[no]=n.current,ji(e),new wc(n)},Zr.version="19.1.1",Zr}var uh;function pm(){if(uh)return Wi.exports;uh=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(o){console.error(o)}}return t(),Wi.exports=um(),Wi.exports}var fm=pm(),J=yd();const Ji=om(J);/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function hm({onClose:t}){return u.jsx("div",{className:"modal-overlay",onClick:t,children:u.jsxs("div",{className:"modal-content",onClick:o=>o.stopPropagation(),children:[u.jsx("button",{className:"btn btn-back modal-close-btn",onClick:t,children:"X"}),u.jsx("h2",{children:"Game Rules"}),u.jsx("h3",{children:"Objective"}),u.jsx("p",{children:"You play as an artificial intelligence trying to compile your own 3 protocols. To do this, you play command cards on the protocols over several rounds and execute their effects. If you reach a total value of at least 10 with your own command cards on a protocol and exceed the other person's total value in the same row, you may compile the protocol (turn it over). The first person to compile their 3 protocols wins."}),u.jsx("h3",{children:"Game Flow"}),u.jsx("p",{children:"The person who chose a protocol first begins. You always play alternately until one person wins. On your turn, handle the following 6 phases in sequence:"}),u.jsxs("ol",{children:[u.jsx("li",{children:"Start"}),u.jsx("li",{children:"Check Control"}),u.jsx("li",{children:"Check Compile"}),u.jsx("li",{children:"Perform Action"}),u.jsx("li",{children:"Check Hand Limit"}),u.jsx("li",{children:"End"})]}),u.jsx("h3",{children:"Phases in Detail"}),u.jsxs("p",{children:[u.jsx("strong",{children:"1. Start:"}),' Resolve all visible "Start" effects of your face-up command cards in an order of your choice.']}),u.jsxs("p",{children:[u.jsx("strong",{children:"2. Check Control:"})," If the total value of your command cards in at least 2 rows is higher than the total value of the other person's command cards in the corresponding rows, take the control card and place it in front of you."]}),u.jsxs("p",{children:[u.jsx("strong",{children:"3. Check Compile:"})," If you can compile protocols, you must now compile 1 of them. If you can compile multiple protocols, choose 1 of them. If you have compiled, you must skip phase 4 and proceed directly to phase 5."]}),u.jsxs("p",{children:[u.jsx("strong",{children:"Compile Action:"}),` If your cards in a row have a total value of 10 or more AND this is higher than the other person's total value in that row, you must compile your protocol in that row. To do this, both of you remove all cards on your side of that row and place them on your respective discard piles. Then, turn your protocol in that row to the "Compiled" side. If you compile this protocol again later, you draw 1 card from the other person's deck as a reward instead. Use it from now on as if it were your own card.`]}),u.jsxs("p",{children:[u.jsx("strong",{children:"4. Perform Action:"}),' Play 1 command card from your hand OR fill your hand. If you have no hand cards, you must perform the "Fill Hand" action. If you have 5 or more hand cards, you may not perform the "Fill Hand" action.']}),u.jsxs("p",{children:[u.jsx("strong",{children:"5. Check Hand Limit:"})," If you have more than 5 command cards in your hand, you must reduce to your hand limit: discard hand cards until you have only 5."]}),u.jsxs("p",{children:[u.jsx("strong",{children:"6. End:"}),' Resolve all visible "End" effects of your face-up command cards in an order of your choice.']}),u.jsx("h3",{children:"Glossary"}),u.jsxs("p",{children:[u.jsx("strong",{children:"Clear Cache:"})," Discard down to 5 cards in hand."]}),u.jsxs("p",{children:[u.jsx("strong",{children:"Compile:"})," To delete all cards in a line on both players sides and flip a protocol."]}),u.jsxs("p",{children:[u.jsx("strong",{children:"Covered:"})," A card with another card on top of it is covered."]}),u.jsxs("p",{children:[u.jsx("strong",{children:"Delete:"})," Move a card from the field to the trash."]}),u.jsxs("p",{children:[u.jsx("strong",{children:"Discard:"})," Move a card from hand to the owners trash."]}),u.jsxs("p",{children:[u.jsx("strong",{children:"Flip:"})," Change the facing of a card from face-down to face-up, or from face-up to face-down."]}),u.jsxs("p",{children:[u.jsx("strong",{children:"Line:"})," The area of play through both protocols. The field is made up of 3 lines, each passing through 2 opposing protocols."]}),u.jsxs("p",{children:[u.jsx("strong",{children:"Protocol:"})," The header that dictates which line you are allowed to play cards into."]}),u.jsxs("p",{children:[u.jsx("strong",{children:"Rearrange:"})," Change the position of protocols."]}),u.jsxs("p",{children:[u.jsx("strong",{children:"Refresh:"})," Draw until you have 5 cards in hand."]}),u.jsxs("p",{children:[u.jsx("strong",{children:"Return:"})," Move a card from the field to its owners hand."]}),u.jsxs("p",{children:[u.jsx("strong",{children:"Reveal:"})," Publicly share information that was hidden or private without effect, then return it to its previous state."]}),u.jsxs("p",{children:[u.jsx("strong",{children:"Shift:"})," Move a card to another line on the same side of the field."]}),u.jsxs("p",{children:[u.jsx("strong",{children:"Stack:"})," The cards in a line on one players side."]}),u.jsxs("p",{children:[u.jsx("strong",{children:"Trash:"})," Where discarded and deleted cards go. This is reshuffled to reform your deck when need be."]}),u.jsxs("p",{children:[u.jsx("strong",{children:"Uncovered:"})," The card at the end of a stack, furthest from the protocol is the uncovered card."]})]})})}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const nn=({card:t,onPointerDown:o,onPointerEnter:a,onPointerLeave:i,isFaceUp:l,faceDownValue:c=2,isSelected:s,isMultiSelected:f,isTargetable:p,isSourceOfEffect:h,style:y,additionalClassName:g,animationState:v})=>{const w=({content:I,className:V})=>u.jsx("div",{className:`card-rule-box ${V||""}`,dangerouslySetInnerHTML:{__html:I}}),x=(v==null?void 0:v.type)==="playCard"&&v.cardId===t.id?`is-entering-${v.owner}`:"",E=(v==null?void 0:v.type)==="deleteCard"&&v.cardId===t.id?`is-deleting-${v.owner}`:"",S=(v==null?void 0:v.type)==="drawCard"||(v==null?void 0:v.type)==="discardCard"?v.owner:void 0,j=S==="player"&&(v==null?void 0:v.type)==="drawCard"&&v.cardIds.includes(t.id),R=S==="player"&&(v==null?void 0:v.type)==="discardCard"&&v.cardIds.includes(t.id),A=["card-component"];t.protocol&&A.push(`card-protocol-${t.protocol.toLowerCase()}`),t.color&&A.push("has-custom-color"),t.pattern&&A.push(`card-pattern-${t.pattern}`),s&&A.push("selected"),f&&A.push("multi-selected"),R&&A.push("is-discarding"),p&&A.push("is-targetable"),h&&A.push("is-source-of-effect"),x&&A.push(x),E&&A.push(E),j&&A.push("is-drawing"),g&&A.push(g);const N={...y};return t.color&&(N["--card-custom-color"]=t.color),u.jsx("div",{className:A.join(" "),onPointerDown:o,onPointerEnter:a,onPointerLeave:i,role:"button",tabIndex:o?0:-1,style:N,children:u.jsxs("div",{className:`card-inner ${l?"":"is-flipped"}`,children:[u.jsxs("div",{className:"card-face card-front",children:[u.jsxs("div",{className:"card-header",children:[u.jsx("span",{className:`card-protocol ${t.protocol.length<=8?"short-protocol":""}`,children:t.protocol.slice(0,8)}),u.jsx("span",{className:"card-value",children:t.value})]}),u.jsxs("div",{className:"card-body",children:[u.jsx(w,{content:t.top,className:"card-rule-top"}),u.jsx(w,{content:t.middle,className:"card-rule-middle"}),u.jsx(w,{content:t.bottom,className:"card-rule-bottom"})]})]}),u.jsx("div",{className:"card-face card-back",children:u.jsx("div",{className:"card-back-value",children:c})})]})})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const wt=[{protocol:"Apathy",value:0,top:"Your total value in this line is increased by 1 for each face-down card in this line.",middle:"",bottom:"",keywords:{},category:"Aux 1"},{protocol:"Apathy",value:1,top:"",middle:"Flip all other face-up cards in this line.",bottom:"",keywords:{flip:!0},category:"Aux 1"},{protocol:"Apathy",value:2,top:"Ignore all middle commands of cards in this line.",middle:"",bottom:"<div><span class='emphasis'>When this card would be covered:</span> First, flip this card.</div>",keywords:{flip:!0},category:"Aux 1"},{protocol:"Apathy",value:3,top:"",middle:"Flip 1 of your opponent's face-up cards.",bottom:"",keywords:{flip:!0},category:"Aux 1"},{protocol:"Apathy",value:4,top:"",middle:"You may flip 1 of your face-up covered cards.",bottom:"",keywords:{flip:!0},category:"Aux 1"},{protocol:"Apathy",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Aux 1"},{protocol:"Chaos",value:0,top:"",middle:"In each line, flip 1 covered card.",bottom:"<div><span class='emphasis'>Start:</span> Draw the top card of your opponent's deck. Your opponent draws the top card of your deck.</div>",keywords:{flip:!0,draw:!0},category:"Main 2"},{protocol:"Chaos",value:1,top:"",middle:"Rearrange your protocols. Rearrange your opponent's protocols.",bottom:"",keywords:{},category:"Main 2"},{protocol:"Chaos",value:2,top:"",middle:"Shift 1 of your covered cards.",bottom:"",keywords:{shift:!0},category:"Main 2"},{protocol:"Chaos",value:3,top:"",middle:"",bottom:"You may play cards without matching protocols.",keywords:{play:!0},category:"Main 2"},{protocol:"Chaos",value:4,top:"",middle:"",bottom:"<div><span class='emphasis'>End:</span> Discard your hand. Draw the same amount of cards.</div>",keywords:{discard:!0,draw:!0},category:"Main 2"},{protocol:"Chaos",value:5,top:"",middle:"Discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 2"},{protocol:"Darkness",value:0,top:"",middle:"Draw 3 cards. Shift 1 of your opponent's covered cards.",bottom:"",keywords:{draw:!0,shift:!0},category:"Main 1"},{protocol:"Darkness",value:1,top:"",middle:"Flip 1 of your opponent's cards. You may shift that card.",bottom:"",keywords:{flip:!0,shift:!0},category:"Main 1"},{protocol:"Darkness",value:2,top:"All face-down cards in this stack have a value of 4.",middle:"You may flip 1 covered card in this line.",bottom:"",keywords:{flip:!0},category:"Main 1"},{protocol:"Darkness",value:3,top:"",middle:"Play 1 card face-down in another line.",bottom:"",keywords:{play:!0},category:"Main 1"},{protocol:"Darkness",value:4,top:"",middle:"Shift 1 face-down card.",bottom:"",keywords:{shift:!0},category:"Main 1"},{protocol:"Darkness",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Death",value:0,top:"",middle:"Delete 1 card from each other line.",bottom:"",keywords:{delete:!0},category:"Main 1"},{protocol:"Death",value:1,top:"<div><span class='emphasis'>Start:</span> You may draw 1 card. If you do, delete 1 other card, then delete this card.</div>",middle:"",bottom:"",keywords:{draw:!0,delete:!0},category:"Main 1"},{protocol:"Death",value:2,top:"",middle:"Delete all cards in 1 line with values of 1 or 2.",bottom:"",keywords:{delete:!0},category:"Main 1"},{protocol:"Death",value:3,top:"",middle:"Delete 1 face-down card.",bottom:"",keywords:{delete:!0},category:"Main 1"},{protocol:"Death",value:4,top:"",middle:"Delete a card with a value of 0 or 1.",bottom:"",keywords:{delete:!0},category:"Main 1"},{protocol:"Death",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Fire",value:0,top:"",middle:"Flip 1 other card. Draw 2 cards.",bottom:"<div><span class='emphasis'>When this card would be covered:</span> First, draw 1 card and flip 1 other card.</div>",keywords:{draw:!0,flip:!0},category:"Main 1"},{protocol:"Fire",value:1,top:"",middle:"Discard 1 card. If you do, delete 1 card.",bottom:"",keywords:{delete:!0,discard:!0},category:"Main 1"},{protocol:"Fire",value:2,top:"",middle:"Discard 1 card. If you do, return 1 card.",bottom:"",keywords:{discard:!0,return:!0},category:"Main 1"},{protocol:"Fire",value:3,top:"",middle:"",bottom:"<div><span class='emphasis'>End:</span> You may discard 1 card. If you do, flip 1 card.</div>",keywords:{discard:!0,flip:!0},category:"Main 1"},{protocol:"Fire",value:4,top:"",middle:"Discard 1 or more cards. Draw the amount discarded plus 1.",bottom:"",keywords:{discard:!0,draw:!0},category:"Main 1"},{protocol:"Fire",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Gravity",value:0,top:"",middle:"For every 2 cards in this line, play the top card of your deck face-down under this card.",bottom:"",keywords:{play:!0},category:"Main 1"},{protocol:"Gravity",value:1,top:"",middle:"Draw 2 cards. Shift 1 card either to or from this line.",bottom:"",keywords:{draw:!0,shift:!0},category:"Main 1"},{protocol:"Gravity",value:2,top:"",middle:"Flip 1 card. Shift that card to this line.",bottom:"",keywords:{flip:!0,shift:!0},category:"Main 1"},{protocol:"Gravity",value:4,top:"",middle:"Shift 1 face-down card to this line.",bottom:"",keywords:{shift:!0},category:"Main 1"},{protocol:"Gravity",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Gravity",value:6,top:"",middle:"Your opponent plays the top card of their deck face-down in this line.",bottom:"",keywords:{play:!0},category:"Main 1"},{protocol:"Hate",value:0,top:"",middle:"Delete 1 card.",bottom:"",keywords:{delete:!0},category:"Aux 1"},{protocol:"Hate",value:1,top:"",middle:"Discard 3 cards. Delete 1 card. Delete 1 card.",bottom:"",keywords:{delete:!0,discard:!0},category:"Aux 1"},{protocol:"Hate",value:2,top:"",middle:"Delete your highest value uncovered card. Delete your opponent's highest value uncovered card.",bottom:"",keywords:{delete:!0},category:"Aux 1"},{protocol:"Hate",value:3,top:"<div><span class='emphasis'>After you delete cards:</span> Draw 1 card.</div>",middle:"",bottom:"",keywords:{draw:!0},category:"Aux 1"},{protocol:"Hate",value:4,top:"",middle:"",bottom:"<div><span class='emphasis'>When this card would be covered:</span> First, delete the lowest value covered card in this line.</div>",keywords:{delete:!0},category:"Aux 1"},{protocol:"Hate",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Aux 1"},{protocol:"Life",value:0,top:"",middle:"Play the top card of your deck face-down in each line where you have a card.",bottom:"<div><span class='emphasis'>When this card would be covered:</span> First, delete this card.</div>",keywords:{delete:!0,play:!0},category:"Main 1"},{protocol:"Life",value:1,top:"",middle:"Flip 1 card. Flip 1 card.",bottom:"",keywords:{flip:!0},category:"Main 1"},{protocol:"Life",value:2,top:"",middle:"Draw 1 card. You may flip 1 face-down card.",bottom:"",keywords:{draw:!0,flip:!0},category:"Main 1"},{protocol:"Life",value:3,top:"",middle:"",bottom:"<div><span class='emphasis'>When this card would be covered:</span> First, play the top card of your deck face-down in another line.</div>",keywords:{play:!0},category:"Main 1"},{protocol:"Life",value:4,top:"",middle:"If this card is covering a card, draw 1 card.",bottom:"",keywords:{draw:!0},category:"Main 1"},{protocol:"Life",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Light",value:0,top:"",middle:"Flip 1 card. Draw cards equal to that card's value.",bottom:"",keywords:{draw:!0,flip:!0},category:"Main 1"},{protocol:"Light",value:1,top:"",middle:"",bottom:"<div><span class='emphasis'>End:</span> Draw 1 card.</div>",keywords:{draw:!0},category:"Main 1"},{protocol:"Light",value:2,top:"",middle:"Draw 2 cards. Reveal 1 face-down card. You may shift or flip that card.",bottom:"",keywords:{draw:!0,flip:!0,reveal:!0,shift:!0},category:"Main 1"},{protocol:"Light",value:3,top:"",middle:"Shift all face-down cards in this line to another line.",bottom:"",keywords:{shift:!0},category:"Main 1"},{protocol:"Light",value:4,top:"",middle:"Your opponent reveals their hand.",bottom:"",keywords:{reveal:!0},category:"Main 1"},{protocol:"Light",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Love",value:1,top:"",middle:"Draw the top card of your opponent's deck.",bottom:"<div><span class='emphasis'>End:</span> You may give 1 card from your hand to your opponent. If you do, draw 2 cards.</div>",keywords:{draw:!0,give:!0},category:"Aux 1"},{protocol:"Love",value:2,top:"",middle:"Your opponent draws 1 card. Refresh.",bottom:"",keywords:{draw:!0,refresh:!0},category:"Aux 1"},{protocol:"Love",value:3,top:"",middle:"Take 1 random card from your opponent's hand. Give 1 card from your hand to your opponent.",bottom:"",keywords:{give:!0,take:!0},category:"Aux 1"},{protocol:"Love",value:4,top:"",middle:"Reveal 1 card from your hand. Flip 1 card.",bottom:"",keywords:{flip:!0,reveal:!0},category:"Aux 1"},{protocol:"Love",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Aux 1"},{protocol:"Love",value:6,top:"",middle:"Your opponent draws 2 cards.",bottom:"",keywords:{draw:!0},category:"Aux 1"},{protocol:"Metal",value:0,top:"Your opponent's total value in this line is reduced by 2.",middle:"Flip 1 card.",bottom:"",keywords:{flip:!0},category:"Main 1"},{protocol:"Metal",value:1,top:"",middle:"Draw 2 cards. Your opponent cannot compile next turn.",bottom:"",keywords:{draw:!0},category:"Main 1"},{protocol:"Metal",value:2,top:"Your opponent cannot play cards face-down in this line.",middle:"",bottom:"",keywords:{},category:"Main 1"},{protocol:"Metal",value:3,top:"",middle:"Draw 1 card. Delete all cards in 1 other line with 8 or more cards.",bottom:"",keywords:{delete:!0,draw:!0},category:"Main 1"},{protocol:"Metal",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Metal",value:6,top:"<div><span class='emphasis'>When this card would be covered or flipped:</span> First, delete this card.</div>",middle:"",bottom:"",keywords:{delete:!0},category:"Main 1"},{protocol:"Plague",value:0,top:"",middle:"Your opponent discards 1 card.",bottom:"Your opponent cannot play cards in this line.",keywords:{discard:!0},category:"Main 1"},{protocol:"Plague",value:1,top:"<div><span class='emphasis'>After your opponent discards cards:</span> Draw 1 card.</div>",middle:"Your opponent discards 1 card.",bottom:"",keywords:{discard:!0,draw:!0},category:"Main 1"},{protocol:"Plague",value:2,top:"",middle:"Dicard 1 or more cards. Your opponent discards the amount of cards discarded plus 1.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Plague",value:3,top:"",middle:"Flip each other face-up card.",bottom:"",keywords:{flip:!0},category:"Main 1"},{protocol:"Plague",value:4,top:"",middle:"",bottom:"<div><span class='emphasis'>End:</span> Your opponent deletes 1 of their face-down cards. You may flip this card.</div>",keywords:{delete:!0,flip:!0},category:"Main 1"},{protocol:"Plague",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Psychic",value:0,top:"",middle:"Draw 2 cards. Your opponent discards 2 cards, then reveals their hand.",bottom:"",keywords:{discard:!0,draw:!0,reveal:!0},category:"Main 1"},{protocol:"Psychic",value:1,top:"Your opponent can only play cards face-down.",middle:"",bottom:"<div><span class='emphasis'>Start:</span> Flip this card.</div>",keywords:{flip:!0},category:"Main 1"},{protocol:"Psychic",value:2,top:"",middle:"Your opponent discards 2 cards. Rearrange their protocols.",bottom:"",keywords:{discard:!0,rearrange:!0},category:"Main 1"},{protocol:"Psychic",value:3,top:"",middle:"Your opponent discards 1 card. Shift 1 of their cards.",bottom:"",keywords:{discard:!0,shift:!0},category:"Main 1"},{protocol:"Psychic",value:4,top:"",middle:"",bottom:"<div><span class='emphasis'>End:</span> You may return 1 of your opponent's cards. If you do, flip this card.</div>",keywords:{flip:!0,return:!0},category:"Main 1"},{protocol:"Psychic",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Speed",value:0,top:"",middle:"Play 1 card.",bottom:"",keywords:{play:!0},category:"Main 1"},{protocol:"Speed",value:1,top:"<div><span class='emphasis'>After you clear cache:</span> Draw 1 card.</div>",middle:"Draw 2 cards.",bottom:"",keywords:{draw:!0},category:"Main 1"},{protocol:"Speed",value:2,top:"<div><span class='emphasis'>When this card would be deleted by compiling:</span> Shift this card, even if this card is covered.</div>",middle:"",bottom:"",keywords:{shift:!0},category:"Main 1"},{protocol:"Speed",value:3,top:"",middle:"Shift 1 of your other cards.",bottom:"<div><span class='emphasis'>End:</span> You may shift 1 of your cards. If you do, flip this card.</div>",keywords:{flip:!0,shift:!0},category:"Main 1"},{protocol:"Speed",value:4,top:"",middle:"Shift 1 of your opponent's face-down cards.",bottom:"",keywords:{shift:!0},category:"Main 1"},{protocol:"Speed",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Spirit",value:0,top:"",middle:"Refresh. Draw 1 card.",bottom:"Skip your check cache phase.",keywords:{draw:!0,refresh:!0},category:"Main 1"},{protocol:"Spirit",value:1,top:"You can play cards in any line.",middle:"Draw 2 cards.",bottom:"<div><span class='emphasis'>Start:</span> Either discard 1 card or flip this card.</div>",keywords:{discard:!0,draw:!0,flip:!0},category:"Main 1"},{protocol:"Spirit",value:2,top:"",middle:"You may flip 1 card.",bottom:"",keywords:{flip:!0},category:"Main 1"},{protocol:"Spirit",value:3,top:"<div><span class='emphasis'>After you draw cards:</span> You may shift this card, even if this card is covered.</div>",middle:"",bottom:"",keywords:{shift:!0},category:"Main 1"},{protocol:"Spirit",value:4,top:"",middle:"Swap the positions of 2 of your protocols",bottom:"",keywords:{swap:!0},category:"Main 1"},{protocol:"Spirit",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Water",value:0,top:"",middle:"Flip 1 other card. Flip this card.",bottom:"",keywords:{flip:!0},category:"Main 1"},{protocol:"Water",value:1,top:"",middle:"Play the top card of your deck face-down in each other line.",bottom:"",keywords:{play:!0},category:"Main 1"},{protocol:"Water",value:2,top:"",middle:"Draw 2 cards. Rearrange your protocols.",bottom:"",keywords:{draw:!0,rearrange:!0},category:"Main 1"},{protocol:"Water",value:3,top:"",middle:"Return all cards with a value of 2 in 1 line.",bottom:"",keywords:{return:!0},category:"Main 1"},{protocol:"Water",value:4,top:"",middle:"Return 1 of your cards.",bottom:"",keywords:{return:!0},category:"Main 1"},{protocol:"Water",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Frost",value:0,top:"",middle:"Draw 1 card for each face-down card.",bottom:"",keywords:{draw:!0},category:"Fan-Content"},{protocol:"Frost",value:1,top:"Cards cannot be flipped face-up.",middle:"",bottom:"Protocols cannot be rearranged.",keywords:{flip:!0,rearrange:!0},category:"Fan-Content"},{protocol:"Frost",value:2,top:"",middle:"Play a card face-down.",bottom:"",keywords:{play:!0},category:"Fan-Content"},{protocol:"Frost",value:3,top:"Cards cannot shift from or to this line.",middle:"",bottom:"",keywords:{shift:!0},category:"Fan-Content"},{protocol:"Frost",value:4,top:"",middle:"You may flip 1 card of your face-up covered cards.",bottom:"",keywords:{flip:!0},category:"Fan-Content"},{protocol:"Frost",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Fan-Content"},{protocol:"Anarchy",value:0,top:"",middle:"Shift 1 card. For each line that contains a face-up card without matching protocol, draw 1 card.",bottom:"",keywords:{shift:!0,draw:!0},category:"Fan-Content"},{protocol:"Anarchy",value:1,top:"Cards can only be played without matching protocols.",middle:"Shift 1 other card to a line without a matching protocol.",bottom:"",keywords:{shift:!0,play:!0},category:"Fan-Content"},{protocol:"Anarchy",value:2,top:"",middle:"Delete a covered or uncovered card in a line with a matching protocol.",bottom:"",keywords:{delete:!0},category:"Fan-Content"},{protocol:"Anarchy",value:3,top:"",middle:"Swap the positions of 2 of your opponent's protocols.",bottom:"<div><span class='emphasis'>End:</span> Rearrange your protocols. Anarchy cannot be on this line.</div>",keywords:{swap:!0,rearrange:!0},category:"Fan-Content"},{protocol:"Anarchy",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Fan-Content"},{protocol:"Anarchy",value:6,top:"<div><span class='emphasis'>Start:</span> Flip this card, if this card is in the line with the Anarchy protocol.</div>",middle:"",bottom:"",keywords:{flip:!0},category:"Fan-Content"}],_m=new Set(wt.map(t=>t.protocol)),Oh=Array.from(_m).sort();/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Xa=t=>{var i,l,c,s,f,p,h,y,g,v,w,C,x,b,E,S,j,R,A,N,I,V,L,D,O,H,te,ne,z,F,B,W,_e,U,P,Z,Q,pe,Ce,ve,ke,Xe,de,ce,le,re,se,ge,me,Se,$e,xe,at,nt,Ke,Rt,De,gt,Ot,an,yt,dt,Nt,fa;const o=t.params;let a="";switch(o.action){case"refresh":{a="Refresh.";break}case"mutual_draw":{const ye=o.count||1;a=`Draw the top card${ye!==1?"s":""} of your opponent's deck. Your opponent draws the top card${ye!==1?"s":""} of your deck.`;break}case"draw":{if(t.useCardFromPreviousEffect){o.target==="opponent"?a="Opponent draws cards equal to that card's value.":a="Draw cards equal to that card's value.";break}if(o.countType==="count_face_down"){a="Draw 1 card for each face-down card.";break}if(o.conditional){switch(o.conditional.type){case"count_face_down":a="Draw 1 card for each face-down card.";break;case"is_covering":a=`Draw ${o.count} card${o.count!==1?"s":""} if this card is covering another.`;break;case"non_matching_protocols":a="Draw 1 card for each line with a non-matching protocol.";break}break}let ye="";if(o.countType==="equal_to_discarded"){const Ve=o.countOffset||0;Ve===1?ye+="Draw 1 more card than the amount discarded.":Ve===0?ye+="Draw the same amount of cards.":ye+=`Draw the amount discarded plus ${Ve}.`,a=ye;break}else if(o.countType==="equal_to_card_value"){ye+="Draw cards equal to that card's value.",a=ye;break}else if(o.countType==="hand_size"){ye+="Draw the same amount of cards.",a=ye;break}const je=o.optional?"You may ":"";if(o.source==="opponent_deck")ye+=`${je}Draw ${o.count} card${o.count!==1?"s":""} from opponent's deck.`;else if(o.target==="opponent")ye+=`Opponent draws ${o.count} card${o.count!==1?"s":""}.`;else{const Ve=o.optional?"draw":"Draw";ye+=`${je}${Ve} ${o.count} card${o.count!==1?"s":""}.`}a=ye;break}case"flip":{if(t.useCardFromPreviousEffect){a=`${o.optional?"May flip":"Flip"} that card.`;break}if(o.flipSelf){let At=(o.optional,"Flip this card");((i=o.advancedConditional)==null?void 0:i.type)==="protocol_match"&&(At+=`, if this card is in the line with the ${o.advancedConditional.protocol||"[Protocol]"} protocol`),a=At+".";break}const ye=o.optional?"You may flip":"Flip",je=((l=o.targetFilter)==null?void 0:l.owner)==="own",Ve=((c=o.targetFilter)==null?void 0:c.owner)==="opponent";let Te="";je&&(Te="your "),Ve&&(Te="opponent's "),((s=o.targetFilter)==null?void 0:s.position)==="covered"&&(Te+="covered "),((f=o.targetFilter)==null?void 0:f.faceState)==="face_down"&&(Te+="face-down "),((p=o.targetFilter)==null?void 0:p.faceState)==="face_up"&&(Te+="face-up "),(h=o.targetFilter)!=null&&h.excludeSelf&&(Te+="other ");let Ne="";o.count==="all"?Ne="all":o.count==="each"?o.eachLineScope==="each_line"?(Ne="1",Te=Te+"(in each line) "):Ne="each":Ne=o.count.toString();const xt=o.count===1?"card":"cards";let Je="";je&&((y=o.targetFilter)==null?void 0:y.position)==="covered"&&((g=o.targetFilter)==null?void 0:g.faceState)==="face_up"&&o.optional?Je=`${ye} ${Ne} of your ${o.targetFilter.faceState.replace("_","-")} ${o.targetFilter.position} cards`:Je=`${ye} ${Ne} ${Te}${xt}`,o.scope==="this_lane"?Je+=" in this line":o.scope==="each_lane"&&(Je=`In each line, ${Je.charAt(0).toLowerCase()+Je.slice(1)}`),Je+=".",o.selfFlipAfter&&(Je+=" Then flip this card."),a=Je;break}case"shift":{const ye=o.optional?"You may shift":"Shift";if(t.useCardFromPreviousEffect){let Tt=`${ye} that card`;((v=o.destinationRestriction)==null?void 0:v.type)==="to_this_lane"?Tt+=" to this line":((w=o.destinationRestriction)==null?void 0:w.type)==="to_another_line"?Tt+=" to another line":((C=o.destinationRestriction)==null?void 0:C.type)==="non_matching_protocol"?Tt+=" to a line without a matching protocol":((x=o.destinationRestriction)==null?void 0:x.type)==="specific_lane"&&(Tt+=" within this line"),a=Tt+".";break}const je=o.count||1,Ve=((b=o.targetFilter)==null?void 0:b.owner)==="own",Te=((E=o.targetFilter)==null?void 0:E.position)==="covered";if(Ve&&Te&&je===1){let Tt=`${ye} 1 of your covered cards`;((S=o.destinationRestriction)==null?void 0:S.type)==="non_matching_protocol"?Tt+=" to a line without a matching protocol":((j=o.destinationRestriction)==null?void 0:j.type)==="specific_lane"?Tt+=" within this line":((R=o.destinationRestriction)==null?void 0:R.type)==="to_another_line"&&(Tt+=" to another line"),a=Tt+".";break}if(((A=o.targetFilter)==null?void 0:A.owner)==="own"&&((N=o.targetFilter)==null?void 0:N.excludeSelf)===!1&&(!((I=o.targetFilter)!=null&&I.faceState)||((V=o.targetFilter)==null?void 0:V.faceState)==="any")&&(!o.destinationRestriction||((L=o.destinationRestriction)==null?void 0:L.type)==="any")&&je===1){let Tt=`${ye} this card`;((D=o.targetFilter)==null?void 0:D.position)==="any"&&(Tt+=", even if this card is covered"),a=Tt+".";break}let xt="";((O=o.targetFilter)==null?void 0:O.owner)==="opponent"&&(xt+="of your opponent's "),(H=o.targetFilter)!=null&&H.excludeSelf&&(xt+="other "),((te=o.targetFilter)==null?void 0:te.position)==="covered"&&(xt+="covered "),((ne=o.targetFilter)==null?void 0:ne.faceState)==="face_down"&&(xt+="face-down "),((z=o.targetFilter)==null?void 0:z.faceState)==="face_up"&&(xt+="face-up ");const Je=o.count==="all"?"all":"1";let un=`${ye} ${Je} ${xt}${Je==="1"?"card":"cards"}`;((F=o.destinationRestriction)==null?void 0:F.type)==="non_matching_protocol"?un+=" to a line without a matching protocol":((B=o.destinationRestriction)==null?void 0:B.type)==="specific_lane"?un+=" within this line":((W=o.destinationRestriction)==null?void 0:W.type)==="to_another_line"?un+=" to another line":((_e=o.destinationRestriction)==null?void 0:_e.type)==="to_this_lane"?un+=" to this line":((U=o.destinationRestriction)==null?void 0:U.type)==="to_or_from_this_lane"&&(un+=" either to or from this line"),a=un+".";break}case"delete":{if(t.useCardFromPreviousEffect){a="Delete that card.";break}if(o.deleteSelf){a="Delete this card.";break}let ye="Delete ";const je=((P=o.targetFilter)==null?void 0:P.position)==="any",Ve=((Z=o.targetFilter)==null?void 0:Z.calculation)==="highest_value"||((Q=o.targetFilter)==null?void 0:Q.calculation)==="lowest_value",Te=((pe=o.targetFilter)==null?void 0:pe.owner)==="own"||((Ce=o.targetFilter)==null?void 0:Ce.owner)==="opponent",Ne=o.count===1&&Ve&&Te;if(o.count==="all_in_lane"?ye+="all ":Ne||(ye+=je?"a ":`${o.count} `),Ne&&(((ve=o.targetFilter)==null?void 0:ve.owner)==="own"?ye+="your ":((ke=o.targetFilter)==null?void 0:ke.owner)==="opponent"&&(ye+="opponent's ")),((Xe=o.targetFilter)==null?void 0:Xe.calculation)==="highest_value"?ye+="highest value ":((de=o.targetFilter)==null?void 0:de.calculation)==="lowest_value"&&(ye+="lowest value "),(ce=o.targetFilter)!=null&&ce.valueRange){const{min:At,max:un}=o.targetFilter.valueRange,Tt=[];for(let In=At;In<=un;In++)Tt.push(In);const Yo=Tt.join(" or ");ye+=`value ${Yo} `}Ne||(((le=o.targetFilter)==null?void 0:le.owner)==="own"?ye+="your ":((re=o.targetFilter)==null?void 0:re.owner)==="opponent"&&(ye+="opponent's ")),je?ye+="covered or uncovered ":((se=o.targetFilter)==null?void 0:se.position)==="covered"&&(ye+="covered "),((ge=o.targetFilter)==null?void 0:ge.faceState)==="face_down"?ye+="face-down ":((me=o.targetFilter)==null?void 0:me.faceState)==="face_up"&&(ye+="face-up ");const xt=o.excludeSelf?"other ":"",Je=o.count===1?"card":"cards";ye+=xt+Je,o.selectLane&&(ye+=" in 1 line"),o.protocolMatching==="must_match"?ye+=" in a line with a matching protocol":o.protocolMatching==="must_not_match"&&(ye+=" in a line without a matching protocol"),((Se=o.scope)==null?void 0:Se.type)==="this_line"?ye+=" in this line":(($e=o.scope)==null?void 0:$e.type)==="other_lanes"?ye+=" in other lanes":((xe=o.scope)==null?void 0:xe.type)==="each_other_line"&&(ye+=" from each other line"),a=ye+".";break}case"discard":{if(t.useCardFromPreviousEffect){o.actor==="opponent"?a="Opponent discards that card.":a="Discard that card.";break}const ye=o.variableCount;let je="";if(ye)je="1 or more cards";else if(o.count==="all")je="your hand";else{const Te=o.count===1?"card":"cards";je=`${o.count} ${Te}`}const Ve=o.optional?"You may discard":o.count==="all"?"Discard":"You discard";o.actor==="opponent"?o.count==="all"?a="Opponent discards their hand.":a=`Opponent discards ${je}.`:a=`${Ve} ${je}.`;break}case"return":{if(t.useCardFromPreviousEffect){a="Return that card to hand.";break}const je=o.selectLane||!1?" in 1 line":"";if(((at=o.targetFilter)==null?void 0:at.valueEquals)!==void 0){a=`Return all cards with a value of ${o.targetFilter.valueEquals}${je}.`;break}const Ve=o.count==="all"?"all cards":o.count===1?"1 card":`${o.count} cards`,Te=((nt=o.targetFilter)==null?void 0:nt.owner)||"any";let Ne="";Te==="own"?Ne=" of your":Te==="opponent"&&(Ne=" of opponent's"),a=`Return ${Ve}${Ne}${je}.`;break}case"play":{if(t.useCardFromPreviousEffect){a=`Play that card ${o.faceDown?"face-down":"face-up"}.`;break}const ye=o.actor,je=o.count||1,Ve=o.faceDown?"face-down":"face-up";let Te="",Ne="";ye==="opponent"?(Te="Your opponent plays",o.source==="deck"?Ne=je===1?"the top card of their deck":`${je} cards from their deck`:Ne=je===1?"a card from their hand":`${je} cards from their hand`):(Te="Play",o.source==="deck"?Ne=je===1?"the top card of your deck":`${je} cards from your deck`:Ne=je===1?"a card from your hand":`${je} cards from your hand`);let xt="";((Ke=o.condition)==null?void 0:Ke.type)==="per_x_cards_in_line"&&(xt=`For every ${o.condition.cardCount||2} cards in this line, `,Te=Te.toLowerCase());let Je=`${xt}${Te} ${Ne} ${Ve}`;if(((Rt=o.destinationRule)==null?void 0:Rt.type)==="other_lines")Je+=" to other lines";else if(((De=o.destinationRule)==null?void 0:De.type)==="another_line")Je+=" in another line";else if(((gt=o.destinationRule)==null?void 0:gt.type)==="each_other_line")Je+=" in each other line";else if(((Ot=o.destinationRule)==null?void 0:Ot.type)==="under_this_card")Je+=" under this card";else if(((an=o.destinationRule)==null?void 0:an.type)==="each_line_with_card"){const At=o.destinationRule.ownerFilter;At==="own"?Je+=" in each line where you have a card":At==="opponent"?Je+=" in each line where opponent has a card":Je+=" to each line with a card"}else((yt=o.destinationRule)==null?void 0:yt.type)==="specific_lane"&&(Je+=" in this line");a=Je+".";break}case"rearrange_protocols":case"swap_protocols":{const ye=o.target==="opponent"?"your opponent's":o.target==="both_sequential"?"both players'":"your";let je="";o.action==="rearrange_protocols"?je=`Rearrange ${ye} protocols`:je=`Swap the positions of 2 of ${ye} protocols`,o.restriction&&o.restriction.disallowedProtocol&&(je+=`. ${o.restriction.disallowedProtocol} cannot be on this line`),a=je+".";break}case"reveal":case"give":{if(t.useCardFromPreviousEffect){a=`${o.action==="give"?"Give":"Reveal"} that card.`;break}const ye=o.action==="give"?"Give":"Reveal";if(o.source==="board"){const Ne=((dt=o.targetFilter)==null?void 0:dt.faceState)==="face_down"?"face-down ":"",xt=o.count||1;let At=`Reveal ${xt} ${Ne}${xt===1?"card":"cards"}`;o.optional?At+=". You may shift or flip that card":o.followUpAction==="flip"?At+=". Then flip it":o.followUpAction==="shift"&&(At+=". Then shift it"),a=At+".";break}if(o.count===-1){o.source==="opponent_hand"?a=o.action==="reveal"?"Your opponent reveals their hand.":"Give your entire hand to your opponent.":a=o.action==="reveal"?"Reveal your hand.":"Give your entire hand.";break}const je=o.count===1?"card":"cards",Ve=o.source==="opponent_hand"?"opponent's hand":"your hand";let Te=`${ye} ${o.count} ${je} from ${Ve}`;o.followUpAction==="flip"?Te+=". Then flip it.":o.followUpAction==="shift"?Te+=". Then shift it.":Te+=".",a=Te;break}case"take":{const ye=o.count===1?"card":"cards",je=o.random?"random ":"";a=`Take ${o.count} ${je}${ye} from opponent's hand.`;break}case"choice":{const ye=o.options||[];if(ye.length===0){a="Effect";break}if(ye.length===2){const je=ye.map(Ve=>{const Te={params:Ve.params};let Ne=Xa(Te);return Ne.endsWith(".")&&(Ne=Ne.slice(0,-1)),Ne=Ne.charAt(0).toLowerCase()+Ne.slice(1),Ne});a=`Either ${je[0]} or ${je[1]}.`}else a="Effect";break}case"passive_rule":{const ye=o.rule;switch(ye==null?void 0:ye.type){case"require_non_matching_protocol":a="Cards can only be played without matching protocols.";break;case"block_all_play":a="Cards cannot be played in this line.";break;case"ignore_middle_commands":a="Ignore all middle commands of cards in this line.";break;case"block_face_down_play":a="Opponent can't play cards face-down in this line.";break;case"require_face_down_play":a="Opponent can only play cards face-down in this line.";break;case"allow_any_protocol_play":a="You may play cards without matching protocols.";break;case"block_flips":a=ye.scope==="global"?"Cards cannot be flipped face-up.":"Cards can't be flipped face-up in this line.";break;case"block_protocol_rearrange":a="Protocols can't be rearranged.";break;case"block_shifts_from_lane":a="Cards can't shift from this line.";break;case"block_shifts_to_lane":a="Cards can't shift to this line.";break;case"block_shifts_from_and_to_lane":a="Cards cannot shift from or to this line.";break;case"skip_check_cache_phase":a="Skip check cache phase.";break;default:a="Passive rule effect."}break}case"value_modifier":{const ye=o.modifier;switch(ye==null?void 0:ye.type){case"add_per_condition":{const je=ye.scope==="this_lane"?"in this line":"",Ve=ye.target==="own_total"?"Your total value":ye.target==="opponent_total"?"Opponent's total value":"Total value";let Te="";ye.condition==="per_face_down_card"?Te="for each face-down card":ye.condition==="per_face_up_card"?Te="for each face-up card":ye.condition==="per_card"&&(Te="for each card");const Ne=ye.value>=0?"+":"";a=`${Ve} ${je} is increased by ${Ne}${ye.value} ${Te} ${je}.`.replace(/\s+/g," ");break}case"set_to_fixed":{let je="";ye.target==="own_cards"?je="your":ye.target==="opponent_cards"?je="opponent's":je="all";let Ve="";((Nt=ye.filter)==null?void 0:Nt.faceState)==="face_down"?Ve=" face-down":((fa=ye.filter)==null?void 0:fa.faceState)==="face_up"&&(Ve=" face-up");let Te="";ye.scope==="this_lane"&&(Te=" in this stack"),a=`All ${je}${Ve} cards${Te} have a value of ${ye.value}.`;break}case"add_to_total":{const je=ye.target==="opponent_total"?"Opponent total":"Your total",Ve=ye.value>=0?"+":"";a=`${je} ${Ve}${ye.value}.`;break}default:a="Value modifier effect."}break}default:a="Effect";break}if(t.conditional&&t.conditional.thenEffect){const ye=Xa(t.conditional.thenEffect);t.conditional.type==="then"?a=`${a.endsWith(".")?a.slice(0,-1):a}, then ${ye.toLowerCase()}`:a=`${a} If you do, ${ye.toLowerCase()}`}return a},ym=t=>{const o={};for(const a of t){const l=a.params.action;l==="draw"&&(o.draw=!0),l==="flip"&&(o.flip=!0),l==="shift"&&(o.shift=!0),l==="delete"&&(o.delete=!0),l==="discard"&&(o.discard=!0),l==="return"&&(o.return=!0),l==="play"&&(o.play=!0),l==="reveal"&&(o.reveal=!0),l==="give"&&(o.give=!0),l==="take"&&(o.take=!0)}return o},Za=t=>t.length===0?"":t.map(o=>{const a=Xa(o),i=o.trigger;if(i==="start")return`<div><span class='emphasis'>Start:</span> ${a}</div>`;if(i==="end")return`<div><span class='emphasis'>End:</span> ${a}</div>`;if(i==="on_cover")return`<div><span class='emphasis'>When this card would be covered:</span> First, ${a.toLowerCase()}</div>`;if(i==="after_draw"||i==="after_delete"||i==="after_shift"||i==="after_flip"){const l=o.reactiveTriggerActor||"self",c=l==="self"?"you":l==="opponent"?"opponent":"a card is";let s="";return i==="after_draw"?s=l==="any"?"drawn":"draw cards":i==="after_delete"?s=l==="any"?"deleted":"delete cards":i==="after_shift"?s=l==="any"?"shifted":"shift cards":i==="after_flip"&&(s=l==="any"?"flipped":"flip cards"),`<div><span class='emphasis'>${l==="any"?`After ${c} ${s}`:`After ${c} ${s}`}:</span> ${a}</div>`}return a}).join(" "),gm=(t,o)=>{var p,h,y;const a=((p=t.text)==null?void 0:p.top)!==void 0?t.text.top:Za(t.topEffects),i=((h=t.text)==null?void 0:h.middle)!==void 0?t.text.middle:Za(t.middleEffects),l=((y=t.text)==null?void 0:y.bottom)!==void 0?t.text.bottom:Za(t.bottomEffects),c=[...t.topEffects,...t.middleEffects,...t.bottomEffects],s=ym(c);return{protocol:o.name,value:t.value,top:a,middle:i,bottom:l,keywords:s,category:"Custom",color:o.color,pattern:o.pattern,customEffects:{topEffects:t.topEffects,middleEffects:t.middleEffects,bottomEffects:t.bottomEffects}}},mm=t=>t.cards.map(o=>gm(o,t)),er=()=>{try{const t=localStorage.getItem("custom_protocols_v1");if(!t)return[];const a=JSON.parse(t).protocols||[],i=[];for(const l of a){const c=mm(l);i.push(...c)}return i}catch(t){return console.error("Failed to load custom protocol cards:",t),[]}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Lh="customProtocolsEnabled";function Nc(){try{return localStorage.getItem(Lh)==="true"}catch{return!1}}function vm(t){try{localStorage.setItem(Lh,t?"true":"false")}catch{}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */let Ac=null;function wm(){if(!Ac){const o=Nc()?er():[];Ac=[...wt,...o]}return Ac}function tl(){Ac=null}function vo(t){const o=wm(),a=[];for(const i of t){const l=o.filter(c=>c.protocol===i);a.push(...l)}return a}function zn(t){const o=[...t];for(let a=o.length-1;a>0;a--){const i=Math.floor(Math.random()*(a+1));[o[a],o[i]]=[o[i],o[a]]}return o}function ph({onNavigate:t,difficulty:o,setDifficulty:a,useControl:i,onUseControlChange:l}){const[c,s]=J.useState(!1),[f,p]=J.useState(null),[h,y]=J.useState(null),[g,v]=J.useState(null),[w,C]=J.useState([]),[x,b]=J.useState(Nc()),[E,S]=J.useState(0);J.useEffect(()=>{const R=new Set;for(;R.size<2&&R.size<wt.length;)R.add(Math.floor(Math.random()*wt.length));const A=Array.from(R).map(N=>wt[N]);A.length>0&&(v(A[0]),y(A[0])),A.length>1&&p(A[1]),C(zn(wt))},[]);const j=()=>{const R=E+1;if(S(R),R>=5){const A=!x;b(A),vm(A),S(0)}};return u.jsxs("div",{className:"screen main-menu",children:[c&&u.jsx(hm,{onClose:()=>s(!1)}),u.jsx("h1",{children:"COMPILE: MAIN 1"}),u.jsxs("div",{className:"main-menu-attribution",children:[u.jsxs("p",{children:["based on the card game ",u.jsx("a",{href:"https://boardgamegeek.com/boardgame/406652/compile-main-1",target:"_blank",rel:"noopener noreferrer",children:"Compile: Main 1"})," designed by ",u.jsx("a",{href:"https://justgravyllc.com/",target:"_blank",rel:"noopener noreferrer",children:"Michael Yang"})]}),u.jsxs("p",{children:[u.jsx("span",{onClick:j,style:{cursor:"default",userSelect:"none"},children:"developed"})," by ",u.jsx("a",{href:"https://apo-games.de/",target:"_blank",rel:"noopener noreferrer",children:"Dirk Aporius"})]})]}),u.jsxs("div",{className:"main-menu-layout",children:[u.jsx("div",{className:"main-menu-preview decorative-card",children:h&&u.jsx(nn,{card:{...h,id:"preview",isFaceUp:!0},isFaceUp:!0})}),u.jsxs("div",{className:"main-menu-actions-container",children:[u.jsxs("div",{className:"main-menu-start-group",children:[u.jsxs("div",{className:"difficulty-selector",children:[u.jsx("h3",{className:"difficulty-title",children:"Difficulty"}),u.jsxs("div",{className:"difficulty-options",children:[u.jsx("button",{className:`btn ${o==="easy"?"active":""}`,onClick:()=>a("easy"),children:"Easy"}),u.jsx("button",{className:`btn ${o==="normal"?"active":""}`,onClick:()=>a("normal"),children:"Normal"}),u.jsx("button",{className:`btn ${o==="hard"?"active":""}`,onClick:()=>a("hard"),children:"Hard"})]})]}),u.jsxs("div",{className:"control-mechanic-selector",children:[u.jsx("input",{type:"checkbox",id:"control-mechanic",checked:i,onChange:R=>l(R.target.checked)}),u.jsx("label",{htmlFor:"control-mechanic",children:"Use Control Mechanic"})]}),u.jsx("button",{className:"btn btn-start",onClick:()=>t("ProtocolSelection"),children:"Start Game"})]}),u.jsxs("div",{className:"main-menu-other-actions",children:[u.jsx("button",{className:"btn",onClick:()=>t("CardLibrary"),children:"Cards"}),u.jsx("button",{className:"btn",onClick:()=>t("Statistics"),children:"Statistics"}),x&&u.jsx("button",{className:"btn",onClick:()=>t("CustomProtocols"),children:"Custom Protocols"}),u.jsx("button",{className:"btn",onClick:()=>s(!0),children:"Rules"}),u.jsx("p",{className:"version-info",children:"Version 0.25"})]})]}),u.jsx("div",{className:"decorative-card decorative-card-right",children:f&&u.jsx(nn,{card:{...f,id:"deco-2",isFaceUp:!0},isFaceUp:!0})})]}),u.jsx("div",{className:"card-ticker-container",onPointerLeave:()=>y(g),children:u.jsxs("div",{className:"card-ticker-track",children:[w.map((R,A)=>u.jsx(nn,{card:{...R,id:`ticker-1-${A}`,isFaceUp:!0},isFaceUp:!0,additionalClassName:"in-hand",onPointerEnter:()=>y(R)},`ticker-1-${A}`)),w.map((R,A)=>u.jsx(nn,{card:{...R,id:`ticker-2-${A}`,isFaceUp:!0},isFaceUp:!0,additionalClassName:"in-hand",onPointerEnter:()=>y(R)},`ticker-2-${A}`))]})})]})}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function gd({title:t,onBack:o}){return u.jsxs("header",{className:"app-header",children:[u.jsx("h2",{children:t}),o&&u.jsx("button",{className:"btn btn-back",onClick:o,children:"Back"})]})}const xc=[{player:"Player",picks:1},{player:"Opponent",picks:2},{player:"Player",picks:2},{player:"Opponent",picks:1}];function Cm({onBack:t,onStartGame:o}){const[a,i]=J.useState(0),[l,c]=J.useState([]),[s,f]=J.useState([]),[p,h]=J.useState([]),[y,g]=J.useState(!1),[v,w]=J.useState(null),[C,x]=J.useState(null),[b,E]=J.useState(0);J.useEffect(()=>{tl(),E(P=>P+1)},[]);const S=J.useMemo(()=>{const P=Nc(),Z=P?er():[],Q=[...wt,...Z];return console.log("[Protocol Selection] Total cards loaded:",Q.length,"(base:",wt.length,", custom:",Z.length,", enabled:",P,")"),Q},[b]),j=J.useMemo(()=>{const P=new Set(S.map(Q=>Q.protocol)),Z=Array.from(P).sort();return console.log("[Protocol Selection] Unique protocols:",Z),Z},[S]),R=J.useMemo(()=>{const P=new Set(S.map(Z=>Z.category));return Array.from(P).sort()},[S]),[A,N]=J.useState(()=>new Set(R));J.useEffect(()=>{N(new Set(R))},[R]);const I=P=>{const Z=S.find(Q=>Q.protocol===P);return(Z==null?void 0:Z.category)||""},V=P=>{const Q=S.find(pe=>pe.protocol===P);return Q!=null&&Q.color?{"--card-custom-color":Q.color,borderColor:Q.color}:{}},L=P=>{const Q=S.find(pe=>pe.protocol===P);return Q!=null&&Q.pattern?`pattern-${Q.pattern}`:""},D=J.useMemo(()=>j.filter(P=>{const Z=I(P);return A.has(Z)}),[A]),O=P=>{N(Z=>{const Q=new Set(Z);return Q.has(P)?Q.delete(P):Q.add(P),Q})},H=xc[a],te=(H==null?void 0:H.player)==="Player",ne=(H==null?void 0:H.player)==="Opponent",z=J.useMemo(()=>new Set([...l,...s]),[l,s]),F=J.useMemo(()=>p.map(P=>({name:P,cards:S.filter(Z=>Z.protocol===P).sort((Z,Q)=>Z.value-Q.value)})),[p]),B=P=>{if(!te||y)return;const Z=S.filter(Q=>Q.protocol===P).sort((Q,pe)=>Q.value-pe.value);Z.length>0&&x(Z[0]),h(Q=>{if(Q.includes(P))return Q.filter(pe=>pe!==P);if(Q.length<H.picks)return[...Q,P];if(Q.length===H.picks){const pe=Q.slice(1);return pe.push(P),pe}return Q})},W=async()=>{if(!te||y||p.length!==H.picks)return;g(!0);const P=[...p];h([]);for(const Z of P)c(Q=>[...Q,Z]),await new Promise(Q=>setTimeout(Q,300));g(!1),i(Z=>Z+1)};J.useEffect(()=>{ne&&!y&&a<xc.length&&(async()=>{g(!0),await new Promise(ve=>setTimeout(ve,100));const Z=[],Q=j.filter(ve=>!(z.has(ve)||I(ve)==="Custom")),pe=[],Ce=Z.filter(ve=>Q.includes(ve));for(let ve=0;ve<H.picks;ve++)if(Ce.length>0){const ke=Ce.shift();pe.push(ke);const Xe=Q.indexOf(ke);Xe>-1&&Q.splice(Xe,1)}else if(Q.length>0){const ke=Math.floor(Math.random()*Q.length);pe.push(Q.splice(ke,1)[0])}for(const ve of pe)await new Promise(ke=>setTimeout(ke,1e3)),w(ve),await new Promise(ke=>setTimeout(ke,1e3)),w(null),f(ke=>[...ke,ve]);g(!1),i(ve=>ve+1)})()},[a,ne,y,z,H]),J.useEffect(()=>{a>=xc.length&&!y&&setTimeout(()=>{o(l,s)},1e3)},[a,y,o,l,s]);const _e=P=>{const Z=["protocol-card",`card-protocol-${P.toLowerCase()}`];return p.includes(P)&&Z.push("selected"),z.has(P)&&Z.push("chosen"),v===P&&Z.push("is-scanning"),Z.join(" ")},U=()=>y&&ne?"Opponent is selecting protocols...":(H==null?void 0:H.player)==="Player"?`Player, select ${H.picks} protocol(s). (${p.length}/${H.picks})`:a>=xc.length?"Finalizing selections...":"Waiting for Opponent...";return u.jsxs("div",{className:"screen protocol-selection-screen",children:[u.jsx(gd,{title:"Protocol Selection",onBack:t}),u.jsxs("div",{className:"protocol-selection-layout",children:[u.jsxs("div",{className:"protocol-selection-sidebar",children:[u.jsxs("div",{className:"player-protocols-area",children:[u.jsx("h3",{children:"Your Protocols"}),l.map(P=>u.jsx("div",{className:`protocol-display-card player card-protocol-${P.toLowerCase()} ${L(P)}`,style:V(P),children:P},P))]}),u.jsx("div",{className:"protocol-preview-area",children:C?u.jsx(nn,{card:{...C,id:"preview",isFaceUp:!0},isFaceUp:!0}):u.jsx("p",{children:F.length>0?"Hover over a card below to see details.":"Select a protocol to see its cards."})})]}),u.jsxs("div",{className:"protocol-grid-container",children:[u.jsx("p",{children:U()}),u.jsx("div",{className:"category-filters",children:R.map(P=>u.jsxs("label",{className:"category-filter-item",children:[u.jsx("input",{type:"checkbox",checked:A.has(P),onChange:()=>O(P)}),u.jsx("span",{children:P})]},P))}),u.jsx("div",{className:"protocol-grid-scroll-wrapper",children:u.jsx("div",{className:"protocol-grid",children:D.map(P=>{const Z=V(P),pe={fontSize:P.length>10?"0.65em":"1em"};return u.jsxs("div",{className:`${_e(P)} ${L(P)}`,style:Z,onClick:()=>B(P),role:"button","aria-disabled":z.has(P)||!te||y,tabIndex:!z.has(P)&&te&&!y?0:-1,onKeyPress:Ce=>Ce.key==="Enter"&&B(P),children:[u.jsx("span",{className:"protocol-category-label",children:I(P)}),u.jsx("span",{className:"protocol-name",style:pe,children:P})]},P)})})}),te&&u.jsx("button",{className:"btn",onClick:W,disabled:y||p.length!==(H==null?void 0:H.picks),children:"Confirm Selection"})]}),u.jsxs("div",{className:"opponent-protocols-area",children:[u.jsx("h3",{children:"Opponent Protocols"}),s.map(P=>u.jsx("div",{className:`protocol-display-card opponent card-protocol-${P.toLowerCase()} ${L(P)}`,style:V(P),children:P},P))]})]}),u.jsx("div",{className:"selected-protocol-cards-container",children:F.length>0&&[...F].reverse().map(P=>u.jsx("div",{className:"protocol-card-row",children:P.cards.map(Z=>u.jsx(nn,{card:{...Z,id:`selection-${Z.protocol}-${Z.value}`,isFaceUp:!0},isFaceUp:!0,additionalClassName:"in-hand",onClick:()=>x(Z),onPointerEnter:()=>x(Z)},`${P.name}-${Z.value}`))},P.name))})]})}const xm="modulepreload",Sm=function(t){return"/"+t},fh={},bm=function(o,a,i){let l=Promise.resolve();if(a&&a.length>0){let s=function(h){return Promise.all(h.map(y=>Promise.resolve(y).then(g=>({status:"fulfilled",value:g}),g=>({status:"rejected",reason:g}))))};document.getElementsByTagName("link");const f=document.querySelector("meta[property=csp-nonce]"),p=(f==null?void 0:f.nonce)||(f==null?void 0:f.getAttribute("nonce"));l=s(a.map(h=>{if(h=Sm(h),h in fh)return;fh[h]=!0;const y=h.endsWith(".css"),g=y?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${g}`))return;const v=document.createElement("link");if(v.rel=y?"stylesheet":xm,y||(v.as="script"),v.crossOrigin="",v.href=h,p&&v.setAttribute("nonce",p),document.head.appendChild(v),y)return new Promise((w,C)=>{v.addEventListener("load",w),v.addEventListener("error",()=>C(new Error(`Unable to preload CSS for ${h}`)))})}))}function c(s){const f=new Event("vite:preloadError",{cancelable:!0});if(f.payload=s,window.dispatchEvent(f),!f.defaultPrevented)throw s}return l.then(s=>{for(const f of s||[])f.status==="rejected"&&c(f.reason);return o().catch(c)})},tn=[];for(let t=0;t<256;++t)tn.push((t+256).toString(16).slice(1));function Em(t,o=0){return(tn[t[o+0]]+tn[t[o+1]]+tn[t[o+2]]+tn[t[o+3]]+"-"+tn[t[o+4]]+tn[t[o+5]]+"-"+tn[t[o+6]]+tn[t[o+7]]+"-"+tn[t[o+8]]+tn[t[o+9]]+"-"+tn[t[o+10]]+tn[t[o+11]]+tn[t[o+12]]+tn[t[o+13]]+tn[t[o+14]]+tn[t[o+15]]).toLowerCase()}let ed;const Rm=new Uint8Array(16);function Am(){if(!ed){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");ed=crypto.getRandomValues.bind(crypto)}return ed(Rm)}const jm=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),hh={randomUUID:jm};function Oe(t,o,a){var l;if(hh.randomUUID&&!t)return hh.randomUUID();t=t||{};const i=t.random??((l=t.rng)==null?void 0:l.call(t))??Am();if(i.length<16)throw new Error("Random bytes length must be >= 16");return i[6]=i[6]&15|64,i[8]=i[8]&63|128,Em(i)}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const $=(t,o,a,i)=>{let l=t._logIndentLevel||0;t._currentPhaseContext&&l===0&&(l=1);const c={player:o,message:a,indentLevel:l,sourceCard:t._currentEffectSource,phase:t._currentPhaseContext,sourceCardRef:i==null?void 0:i.sourceCardRef,targetCardRefs:i==null?void 0:i.targetCardRefs};return{...t,log:[...t.log,c]}},Co=t=>({...t,_logIndentLevel:(t._logIndentLevel||0)+1}),jn=t=>({...t,_logIndentLevel:Math.max(0,(t._logIndentLevel||0)-1)}),Ie=(t,o)=>({...t,_currentEffectSource:o}),Ye=(t,o)=>({...t,_currentPhaseContext:o});/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const km=(t,o,a,i)=>{const{cardOwner:l,opponent:c}=i,s=a[l].lanes[o],f=a[c].lanes[o],p=new Set;if(s.filter(h=>h.id!==t.id&&h.isFaceUp).forEach(h=>p.add(h.id)),f.filter(h=>h.isFaceUp).forEach(h=>p.add(h.id)),p.size>0){let h={...a};return h=$(h,l,`Apathy-1: Flip ${p.size} card(s) face-down in the line.`),{newState:Wt(p,h)}}return{newState:a}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Dm=(t,o,a,i)=>{const{cardOwner:l,opponent:c}=i;let s={...a};return s[c].lanes.map(p=>p.length>0?p[p.length-1]:null).filter(p=>p!==null&&p.isFaceUp).length>0&&(s.actionRequired={type:"select_opponent_face_up_card_to_flip",count:1,sourceCardId:t.id,actor:l}),{newState:s}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Tm=(t,o,a,i)=>{const{cardOwner:l}=i;let c={...a};return c[l].lanes.flatMap(f=>f.filter((p,h)=>p.isFaceUp&&h<f.length-1)).length>0&&(c.actionRequired={type:"select_own_face_up_covered_card_to_flip",count:1,optional:!0,sourceCardId:t.id,actor:l}),{newState:c}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const en=(t,o,a,i)=>{const{cardOwner:l}=i;let c={...a};return c[l].hand.length>0&&(c.actionRequired={type:"discard",actor:l,count:1,sourceCardId:t.id}),{newState:c}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function Wn(t){const o=[];for(const a of["player","opponent"])t[a].lanes.forEach((i,l)=>{i.forEach((c,s)=>{if(c.isFaceUp){const f=c;if(f.customEffects){const p=s===i.length-1;(f.customEffects.topEffects||[]).forEach(g=>{g.params.action==="passive_rule"&&g.trigger==="passive"&&o.push({rule:g.params.rule,cardOwner:a,laneIndex:l})}),(f.customEffects.middleEffects||[]).forEach(g=>{g.params.action==="passive_rule"&&g.trigger==="passive"&&o.push({rule:g.params.rule,cardOwner:a,laneIndex:l})}),p&&(f.customEffects.bottomEffects||[]).forEach(v=>{v.params.action==="passive_rule"&&v.trigger==="passive"&&o.push({rule:v.params.rule,cardOwner:a,laneIndex:l})})}c.protocol==="Frost"&&c.value===1&&(o.push({rule:{type:"block_flips",target:"all",scope:"global"},cardOwner:a,laneIndex:l}),s===i.length-1&&o.push({rule:{type:"block_protocol_rearrange",target:"all",scope:"global"},cardOwner:a,laneIndex:l})),c.protocol==="Frost"&&c.value===3&&o.push({rule:{type:"block_shifts_from_and_to_lane",target:"all",scope:"this_lane"},cardOwner:a,laneIndex:l})}})});return o}function Fm(t,o,a,i,l){const c=Wn(t),s=o==="player"?"opponent":"player",f=t[o].protocols[a],p=t[s].protocols[a],h=l===f||l===p;for(const{rule:y,cardOwner:g,laneIndex:v}of c){const w=y.scope==="global"||v===a,C=y.target==="all"||y.target==="self"&&g===o||y.target==="opponent"&&g===s;if(!(!w||!C))switch(y.type){case"block_all_play":return{allowed:!1,reason:"Cannot play cards in this lane (passive rule)"};case"block_face_down_play":if(!i)return{allowed:!1,reason:"Cannot play cards face-down in this lane (passive rule)"};break;case"block_face_up_play":if(i)return{allowed:!1,reason:"Cannot play cards face-up in this lane (passive rule)"};break;case"require_face_down_play":if(i)return{allowed:!1,reason:"Can only play cards face-down (passive rule)"};break;case"allow_any_protocol_play":break;case"require_non_matching_protocol":if(i&&h)return{allowed:!1,reason:"Can only play cards without matching protocols (passive rule)"};break}}return{allowed:!0}}function md(t){return Wn(t).some(({rule:a})=>a.type==="require_non_matching_protocol"&&a.scope==="global")}function vd(t,o,a){const i=Wn(t),l=o==="player"?"opponent":"player";return i.some(({rule:c,cardOwner:s,laneIndex:f})=>{if(c.type!=="allow_any_protocol_play")return!1;const p=c.scope==="global"||a!==void 0&&f===a,h=c.target==="all"||c.target==="self"&&s===o||c.target==="opponent"&&s===l;return p&&h})}function qm(t,o){const a=Wn(t);for(const{rule:i,laneIndex:l}of a)if(!(i.type!=="block_flips"||!(i.scope==="global"||l===o)))return{allowed:!1,reason:"Cards cannot be flipped face-up in this lane (passive rule)"};return{allowed:!0}}function kc(t,o,a){const i=Wn(t);for(const{rule:l,laneIndex:c}of i){if(l.type==="block_shifts_from_lane"&&c===o)return l.scope,{allowed:!1,reason:"Cards cannot shift from this lane (passive rule)"};if(l.type==="block_shifts_to_lane"&&c===a)return l.scope,{allowed:!1,reason:"Cards cannot shift to this lane (passive rule)"};if(l.type==="block_shifts_from_and_to_lane"&&(c===o||c===a))return{allowed:!1,reason:"Cards cannot shift from or to this lane (passive rule)"}}return{allowed:!0}}function Nm(t){const o=Wn(t);for(const{rule:a}of o)if(a.type==="block_protocol_rearrange")return{allowed:!1,reason:"Protocols cannot be rearranged (passive rule)"};return{allowed:!0}}function Um(t,o){return Wn(t).some(({rule:i,laneIndex:l})=>i.type!=="ignore_middle_commands"?!1:i.scope==="global"||l===o)}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Dt=t=>Wn(t).some(({rule:a})=>a.type==="block_flips"),Uc=t=>Wn(t).some(({rule:a})=>a.type==="block_protocol_rearrange");/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const $m=(t,o,a,i)=>{const{cardOwner:l}=i,c=Dt(a),s=h=>{const y=a.player.lanes[h],g=a.opponent.lanes[h],v=[...y.filter((C,x)=>x<y.length-1),...g.filter((C,x)=>x<g.length-1)];return(c?v.filter(C=>C.isFaceUp):v).length>0},f=[0,1,2].filter(h=>s(h));if(f.length>0){const h=f[0],y=f.slice(1);return{newState:{...a,actionRequired:{type:"select_covered_card_to_flip_for_chaos_0",sourceCardId:t.id,laneIndex:h,remainingLanes:y,actor:l}}}}return{newState:$(a,l,c?"Chaos-0: Cannot flip face-down covered cards (Frost-1 is active).":"Chaos-0: No covered cards to flip.")}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Om=(t,o,a,i)=>{const{cardOwner:l}=i,c=l==="player"?"opponent":"player";let s=$(a,l,`${l==="player"?"Player":"Opponent"}'s Chaos-1 triggers.`);return Uc(s)?(s=$(s,l,"Frost-1 blocks protocol rearrangement. All protocols remain unchanged."),{newState:s}):(s.actionRequired={type:"prompt_rearrange_protocols",sourceCardId:t.id,target:l,actor:l},s.queuedActions=[...s.queuedActions||[],{type:"prompt_rearrange_protocols",sourceCardId:t.id,target:c,actor:l}],{newState:s})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Lm=(t,o,a,i)=>{const{cardOwner:l}=i;return a[l].lanes.some(s=>s.length>1)?{newState:{...a,actionRequired:{type:"select_own_covered_card_to_shift",sourceCardId:t.id,actor:l}}}:{newState:a}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Pm=(t,o,a,i)=>{const{cardOwner:l}=i;return a[l].hand.length===0?{newState:$(a,l,"Chaos-5: No cards to discard.")}:{newState:{...a,actionRequired:{type:"discard",actor:l,count:1,sourceCardId:t.id}}}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Im=(t,o,a,i)=>{const{cardOwner:l,opponent:c}=i;let s=tt(a,l,3);return s=$(s,l,"Darkness-0: Draw 3 cards."),s[c].lanes.flatMap(p=>p.filter((h,y)=>y<p.length-1)).length>0&&(s=$(s,l,"Darkness-0: Prompts to shift 1 of opponent's covered cards."),s.actionRequired={type:"select_opponent_covered_card_to_shift",sourceCardId:t.id,actor:l}),{newState:s}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Mm=(t,o,a,i)=>{const{cardOwner:l,opponent:c}=i;let s={...a};return s[c].lanes.flat().length>0&&(s.actionRequired={type:"select_opponent_card_to_flip",sourceCardId:t.id,actor:l}),{newState:s}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Hm=(t,o,a,i)=>{const{cardOwner:l,opponent:c}=i;let s={...a};const f=[s.player,s.opponent].some(v=>v.lanes.some(w=>{const C=w[w.length-1];return C&&C.isFaceUp&&C.protocol==="Frost"&&C.value===1})),p=s[l].lanes[o].filter((v,w,C)=>w<C.length-1),h=s[c].lanes[o].filter((v,w,C)=>w<C.length-1),y=[...p,...h];return(f?y.filter(v=>v.isFaceUp):y).length>0&&(s.actionRequired={type:"select_covered_card_in_line_to_flip_optional",laneIndex:o,sourceCardId:t.id,optional:!0,actor:l}),{newState:s}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Bm=(t,o,a,i)=>{const{cardOwner:l}=i;let c={...a};return c[l].hand.length>0&&(c.actionRequired={type:"select_card_from_hand_to_play",disallowedLaneIndex:o,sourceCardId:t.id,isFaceDown:!0,actor:l}),{newState:c}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Vm=(t,o,a,i)=>{const{cardOwner:l}=i;let c={...a};const s=[];for(const f of["player","opponent"])for(const p of a[f].lanes)if(p.length>0){const h=p[p.length-1];h.isFaceUp||s.push(h)}return s.length>0?(c=$(c,l,"Darkness-4: Prompts to shift 1 face-down card."),c.actionRequired={type:"select_face_down_card_to_shift_for_darkness_4",sourceCardId:t.id,actor:l}):c=$(c,l,"Darkness-4: No valid face-down card to shift."),{newState:c}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const zm=(t,o,a,i)=>{const{cardOwner:l}=i,c={...a},s={...c[l]},f=[];for(let E=0;E<3;E++)c[l].lanes[E].length>0&&f.push(E);if(f.length===0)return{newState:a};const{drawnCards:p,remainingDeck:h,newDiscard:y}=on(s.deck,s.discard,f.length);if(p.length===0)return{newState:a};const g=p.map(E=>({...E,id:Oe(),isFaceUp:!1}));let v=c,w=[];for(let E=0;E<f.length;E++){const S=f[E],j=v[l].lanes[S];if(j.length>0){const R=j[j.length-1],A={...i,triggerType:"cover"},N=pa(R,S,v,A);if(v=N.newState,N.animationRequests&&w.push(...N.animationRequests),v.actionRequired)break}}const C={...v[l]},x=[...C.lanes];for(let E=0;E<g.length;E++){const S=f[E];x[S]=[...x[S],g[E]]}C.lanes=x,C.deck=h,C.discard=y;let b={...v,[l]:C};return b=$(b,l,`Life-0: Plays ${p.length} card(s) face-down.`),{newState:b,animationRequests:w.length>0?w:void 0}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Gm=(t,o,a,i)=>{const{cardOwner:l}=i,c=Dt(a),s=[...a.player.lanes.flat(),...a.opponent.lanes.flat()];if((c?s.filter(h=>h.isFaceUp):s).length>0){let h={...a};return h=$(h,l,"Life-1: Prompts to flip 2 cards."),h.actionRequired={type:"select_any_card_to_flip",count:2,sourceCardId:t.id,actor:l},{newState:h}}return{newState:$(a,l,c?"Life-1: Cannot flip face-down cards (Frost-1 is active).":"Life-1: No cards to flip.")}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Ym=(t,o,a,i)=>{const{cardOwner:l}=i;let c=tt(a,l,1);return c=$(c,l,"Life-2: Draw 1 card."),[c.player,c.opponent].some(p=>p.lanes.some(h=>{const y=h[h.length-1];return y&&y.isFaceUp&&y.protocol==="Frost"&&y.value===1}))?(c=$(c,l,"Life-2: Cannot flip face-down cards (Frost-1 is active)."),{newState:c}):([...c.player.lanes.flat(),...c.opponent.lanes.flat()].filter(p=>!p.isFaceUp).length>0&&(c.actionRequired={type:"select_any_face_down_card_to_flip_optional",sourceCardId:t.id,optional:!0,actor:l}),{newState:c})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Wm=(t,o,a,i)=>{const{cardOwner:l}=i;if(a[l].lanes[o].length>1){let s=tt(a,l,1);return s=$(s,l,"Life-4: Card is covering another, draw 1 card."),{newState:s}}return{newState:a}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Qm=(t,o,a,i)=>{const{cardOwner:l}=i;let c=zh(a,l,1);return c=$(c,l,`Love-1: ${l==="player"?"Player":"Opponent"} draws the top card of the opponent's deck.`),{newState:c}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Xm=(t,o,a,i)=>{const{cardOwner:l,opponent:c}=i;let s={...a};return s=$(s,l,"Love-2: Opponent draws 1 card."),s=tt(s,c,1),s=wd(s,l),{newState:s}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Zm=(t,o,a,i)=>{const{cardOwner:l,opponent:c}=i;let s={...a};const f={...s[c]},p={...s[l]};if(f.hand.length===0)return s=$(s,l,"Love-3: Opponent has no cards to take."),{newState:s};const h=Math.floor(Math.random()*f.hand.length),y=f.hand.splice(h,1)[0];p.hand.push(y),s={...s,[l]:p,[c]:f};const g=l==="player"?"Player":"Opponent",v=l==="player"?`${y.protocol}-${y.value}`:"a random card";return s=$(s,l,`Love-3: ${g} takes ${v} from the opponent.`),s.actionRequired={type:"select_card_from_hand_to_give",sourceCardId:t.id,sourceEffect:"love_3",actor:l},{newState:s}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Km=(t,o,a,i)=>{const{cardOwner:l}=i;let c={...a};return c[l].hand.length>0&&(c.actionRequired={type:"select_card_from_hand_to_reveal",sourceCardId:t.id,actor:l}),{newState:c}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Jm=(t,o,a,i)=>{const{cardOwner:l,opponent:c}=i;let s=tt(a,c,2);return s=$(s,l,"Love-6: Opponent draws 2 cards."),{newState:s}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const ev=(t,o,a,i)=>{const{cardOwner:l}=i,c=Dt(a),s=[...a.player.lanes.flat(),...a.opponent.lanes.flat()];return(c?s.filter(h=>h.isFaceUp):s).length>0?{newState:{...a,actionRequired:{type:"select_any_card_to_flip",count:1,sourceCardId:t.id,actor:l}}}:{newState:$(a,l,c?"Metal-0: Cannot flip face-down cards (Frost-1 is active).":"Metal-0: No cards to flip.")}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const tv=(t,o,a,i)=>{const{cardOwner:l,opponent:c}=i;let s={...a};s=tt(s,l,2),s=$(s,l,"Metal-1: Draw 2 cards.");const f={...s[c],cannotCompile:!0};return s={...s,[c]:f},s=$(s,l,"Metal-1: Opponent cannot compile next turn."),{newState:s}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const nv=(t,o,a,i)=>{const{cardOwner:l}=i;let c=tt(a,l,1);c=$(c,l,"Metal-3: Draw 1 card.");const s=[0,1,2].filter(p=>p!==o);let f=!1;for(const p of s)if(c.player.lanes[p].length+c.opponent.lanes[p].length>=8){f=!0;break}return f&&(c.actionRequired={type:"select_lane_for_metal_3_delete",sourceCardId:t.id,disallowedLaneIndex:o,actor:l}),{newState:c}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const ov=(t,o,a,i)=>{const{opponent:l}=i;let c={...a};return c[l].hand.length>0&&(c.actionRequired={type:"discard",actor:l,count:1,sourceCardId:t.id}),{newState:c}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const av=(t,o,a,i)=>{const{opponent:l}=i;let c={...a};return c[l].hand.length>0&&(c.actionRequired={type:"discard",actor:l,count:1,sourceCardId:t.id}),{newState:c}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const rv=(t,o,a,i)=>{let l={...a};const{cardOwner:c,opponent:s}=i;return l[c].hand.length>0&&(c==="player"?l.actionRequired={type:"plague_2_player_discard",sourceCardId:t.id,actor:c}:l.actionRequired={type:"plague_2_opponent_discard",sourceCardId:t.id,actor:c}),{newState:l}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const lv=(t,o,a,i)=>{const{cardOwner:l}=i,c=new Set;for(const s of["player","opponent"])for(const f of a[s].lanes)if(f.length>0){const p=f[f.length-1];p.id!==t.id&&p.isFaceUp&&c.add(p.id)}if(c.size>0){let s={...a};return s=$(s,l,`Plague-3: Flip ${c.size} card(s) face-down.`),{newState:Wt(new Set(c),s)}}return{newState:a}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const cv=(t,o,a,i)=>{const{cardOwner:l,opponent:c}=i;let s=tt(a,l,2);s=$(s,l,"Psychic-0: Draw 2 cards.");const f=s[c].hand.length;return f>0&&(s.actionRequired={type:"discard",actor:c,count:Math.min(2,f),sourceCardId:t.id},s.queuedActions=[...s.queuedActions||[],{type:"reveal_opponent_hand",sourceCardId:t.id,actor:l}]),{newState:s}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const sv=(t,o,a,i)=>{const{cardOwner:l,opponent:c}=i;let s={...a};const f=s[c].hand.length,p={type:"prompt_rearrange_protocols",sourceCardId:t.id,target:c,actor:l};return f>0?(s.actionRequired={type:"discard",actor:c,count:Math.min(2,f),sourceCardId:t.id},s.queuedActions=[...s.queuedActions||[],p]):s.actionRequired=p,{newState:s}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const iv=(t,o,a,i)=>{const{cardOwner:l,opponent:c}=i;let s={...a};const f=s[c].hand.length,p={type:"select_any_opponent_card_to_shift",sourceCardId:t.id,actor:l};return f>0?(s.actionRequired={type:"discard",actor:c,count:1,sourceCardId:t.id},s.queuedActions=[...s.queuedActions||[],p]):s[c].lanes.flat().length>0&&(s.actionRequired=p),{newState:s}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const dv=(t,o,a,i)=>{const{cardOwner:l}=i;let c={...a};return c[l].hand.length>0&&(c=$(c,l,"Speed-0: Play another card."),c.actionRequired={type:"select_card_from_hand_to_play",disallowedLaneIndex:-1,sourceCardId:t.id,actor:l}),{newState:c}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const uv=(t,o,a,i)=>{const{cardOwner:l}=i;let c=tt(a,l,2);return c=$(c,l,"Speed-1: Draw 2 cards."),{newState:c}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const pv=(t,o,a,i)=>{const{cardOwner:l}=i,c=[];for(const s of a[l].lanes)if(s.length>0){const f=s[s.length-1];f.id!==t.id&&c.push(f)}return c.length>0?{newState:{...a,actionRequired:{type:"select_own_other_card_to_shift",sourceCardId:t.id,actor:l}}}:{newState:a}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const fv=(t,o,a,i)=>{const{cardOwner:l,opponent:c}=i,s=[];for(const p of a[c].lanes)if(p.length>0){const h=p[p.length-1];h.isFaceUp||s.push(h)}return s.length>0?{newState:{...a,actionRequired:{type:"select_opponent_face_down_card_to_shift",sourceCardId:t.id,actor:l}}}:{newState:$(a,l,"Speed-4: Opponent has no valid (uncovered) face-down cards to shift.")}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const hv=(t,o,a,i)=>{const{cardOwner:l}=i;let c={...a};return c=wd(c,l),c=tt(c,l,1),c=$(c,l,"Spirit-0: Draw 1 card."),{newState:c}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const _v=(t,o,a,i)=>{const{cardOwner:l}=i;let c=tt(a,l,2);return c=$(c,l,"Spirit-1: Draw 2 cards."),{newState:c}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const yv=(t,o,a,i)=>{const{cardOwner:l}=i,c=[a.player,a.opponent].some(p=>p.lanes.some(h=>{const y=h[h.length-1];return y&&y.isFaceUp&&y.protocol==="Frost"&&y.value===1})),s=[...a.player.lanes.flat(),...a.opponent.lanes.flat()];return(c?s.filter(p=>p.isFaceUp):s).length>0?{newState:{...a,actionRequired:{type:"select_any_card_to_flip_optional",sourceCardId:t.id,optional:!0,actor:l}}}:{newState:a}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const gv=(t,o,a,i)=>{const{cardOwner:l}=i,c=$(a,l,"Spirit-4 prompts to swap protocols.");return c.actionRequired={type:"prompt_swap_protocols",sourceCardId:t.id,actor:l,target:l},{newState:c}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const mv=(t,o,a,i)=>{const{cardOwner:l}=i,c=[];for(const f of["player","opponent"])for(const p of a[f].lanes)if(p.length>0){const h=p[p.length-1];h.id!==t.id&&c.push(h)}return c.length>0?{newState:{...a,actionRequired:{type:"select_cards_to_delete",count:1,sourceCardId:t.id,disallowedIds:[t.id],actor:l}}}:{newState:$(a,l,"Hate-0: No valid (uncovered) cards to delete.")}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const vv=(t,o,a,i)=>{const{cardOwner:l}=i;let c={...a};const s=c[l],f=Math.min(3,s.hand.length);return f>0?c.actionRequired={type:"select_cards_from_hand_to_discard_for_hate_1",count:f,sourceCardId:t.id,actor:l}:c.actionRequired={type:"select_cards_to_delete",count:2,sourceCardId:t.id,disallowedIds:[],actor:l},{newState:c}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const wv=(t,o,a,i)=>{const{cardOwner:l}=i;let c={...a};return c.actionRequired={type:"select_own_highest_card_to_delete_for_hate_2",actor:l,sourceCardId:t.id,count:1},{newState:c}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Cv=(t,o,a,i)=>{const{cardOwner:l}=i,f=[0,1,2].filter(p=>p!==o).filter(p=>a.player.lanes[p].length>0||a.opponent.lanes[p].length>0).length;return f>0?{newState:{...a,actionRequired:{type:"select_card_from_other_lanes_to_delete",sourceCardId:t.id,disallowedLaneIndex:o,lanesSelected:[],count:f,actor:l}}}:{newState:a}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const xv=(t,o,a,i)=>{const{cardOwner:l}=i;return{newState:{...a,actionRequired:{type:"select_lane_for_death_2",sourceCardId:t.id,actor:l}}}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Sv=(t,o,a,i)=>{const{cardOwner:l}=i,c=[];for(const f of["player","opponent"])for(const p of a[f].lanes)if(p.length>0){const h=p[p.length-1];h.isFaceUp||c.push(h)}return c.length>0?{newState:{...a,actionRequired:{type:"select_face_down_card_to_delete",sourceCardId:t.id,actor:l}}}:{newState:$(a,l,"Death-3: No valid targets (uncovered face-down cards) found.")}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const bv=(t,o,a,i)=>{const{cardOwner:l}=i,c=[];for(const f of["player","opponent"])for(const p of a[f].lanes)if(p.length>0){const h=p[p.length-1];h.isFaceUp&&(h.value===0||h.value===1)&&c.push(h)}return c.length>0?{newState:{...a,actionRequired:{type:"select_low_value_card_to_delete",sourceCardId:t.id,actor:l}}}:{newState:$(a,l,"Death-4: No valid targets (face-up, uncovered card with value 0 or 1) found.")}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Ev=(t,o,a,i)=>{const{cardOwner:l}=i,c=Dt(a),s=[...a.player.lanes.flat(),...a.opponent.lanes.flat()].filter(p=>p.id!==t.id);if((c?s.filter(p=>p.isFaceUp):s).length>0)return{newState:{...a,actionRequired:{type:"select_any_other_card_to_flip",sourceCardId:t.id,draws:2,actor:l}}};{let p=c?$(a,l,"Fire-0: Cannot flip face-down cards (Frost-1 is active). Drawing 2 cards."):$(a,l,"Fire-0: No other cards to flip, drawing 2 cards.");return p=tt(p,l,2),{newState:p}}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Rv=(t,o,a,i)=>{const{cardOwner:l}=i;let c={...a};return c[l].hand.length>0&&(c.actionRequired={type:"discard",actor:l,count:1,sourceCardId:t.id,sourceEffect:"fire_1"}),{newState:c}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Av=(t,o,a,i)=>{const{cardOwner:l}=i;let c={...a};return c[l].hand.length>0&&(c.actionRequired={type:"discard",actor:l,count:1,sourceCardId:t.id,sourceEffect:"fire_2"}),{newState:c}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const jv=(t,o,a,i)=>{const{cardOwner:l}=i;return a[l].hand.length>0?{newState:{...a,actionRequired:{type:"select_cards_from_hand_to_discard_for_fire_4",sourceCardId:t.id,actor:l}}}:{newState:a}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const kv=(t,o,a,i)=>{const{cardOwner:l,opponent:c}=i,s=a[l].lanes[o].length,f=a[c].lanes[o].length,p=s+f,h=Math.floor(p/2);if(h===0)return{newState:a};let y={...a};const g={...y[l]},{drawnCards:v,remainingDeck:w,newDiscard:C}=on(g.deck,g.discard,h);if(v.length===0)return{newState:y};const x=v.map(S=>({...S,id:Oe(),isFaceUp:!1})),b=[...g.lanes[o]];b.splice(b.length-1,0,...x);const E=[...g.lanes];return E[o]=b,y[l]={...g,lanes:E,deck:w,discard:C},y=$(y,l,`Gravity-0: Plays ${v.length} card(s) face-down under itself.`),{newState:y}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Dv=(t,o,a,i)=>{const{cardOwner:l}=i;let c=tt(a,l,2);c=$(c,l,"Gravity-1: Draw 2 cards.");const s=[...c.player.lanes.flat(),...c.opponent.lanes.flat()],f=()=>{const p=h=>{const y=c.player.lanes[h].some(v=>v.isFaceUp&&v.protocol==="Frost"&&v.value===3),g=c.opponent.lanes[h].some(v=>v.isFaceUp&&v.protocol==="Frost"&&v.value===3);return y||g};for(const h of s){let y=-1;for(let g=0;g<3;g++){if(c.player.lanes[g].some(v=>v.id===h.id)){y=g;break}if(c.opponent.lanes[g].some(v=>v.id===h.id)){y=g;break}}if(y!==-1){for(let g=0;g<3;g++)if(!(g===y||!(y===o)&&!(g===o))&&!p(y)&&!p(g))return!0}}return!1};return s.length>0&&f()?c.actionRequired={type:"select_card_to_shift_for_gravity_1",sourceCardId:t.id,sourceLaneIndex:o,actor:l}:s.length>0&&(c=$(c,l,"Gravity-1: No valid shift targets available (blocked by Frost-3 or lane restrictions).")),{newState:c}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Tv=(t,o,a,i)=>{const{cardOwner:l}=i,c=Dt(a);let s={...a};const f=[...s.player.lanes.flat(),...s.opponent.lanes.flat()];return(c?f.filter(h=>h.isFaceUp):f).length>0?(s.actionRequired={type:"select_card_to_flip_and_shift_for_gravity_2",sourceCardId:t.id,targetLaneIndex:o,actor:l},{newState:s}):(s=$(s,l,c?"Gravity-2: Cannot flip face-down cards (Frost-1 is active).":"Gravity-2: No cards to flip."),{newState:s})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Fv=(t,o,a,i)=>{const{cardOwner:l}=i;let c={...a};const s=[],f=["player","opponent"];for(const p of f)c[p].lanes.forEach((h,y)=>{if(y!==o&&h.length>0){const g=h[h.length-1];g.isFaceUp||s.push(g)}});return s.length>0?c.actionRequired={type:"select_face_down_card_to_shift_for_gravity_4",sourceCardId:t.id,targetLaneIndex:o,actor:l}:c=$(c,l,"Gravity-4: No valid face-down cards in other lines to shift."),{newState:c}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const qv=(t,o,a,i)=>{const{cardOwner:l,opponent:c}=i,s={...a},f={...s[c]},{drawnCards:p,remainingDeck:h,newDiscard:y}=on(f.deck,f.discard,1);if(p.length===0)return{newState:a};let g=s,v={newState:g};const w=s[c].lanes[o];if(w.length>0){const j=w[w.length-1],R={cardOwner:c,actor:l,currentTurn:i.currentTurn,opponent:l,triggerType:"cover"};v=pa(j,o,s,R),g=v.newState}const C={...p[0],id:Oe(),isFaceUp:!1},x={...g[c]},b=[...x.lanes];b[o]=[...b[o],C],x.lanes=b,x.deck=h,x.discard=y;let E={...g,[c]:x};const S=E[c].protocols[o];return E=$(E,l,`Gravity-6: Opponent plays the top card of their deck face-down into Protocol ${S}.`),{newState:E,animationRequests:v.animationRequests}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Nv=(t,o,a,i)=>{const{cardOwner:l}=i,c=Dt(a),s=[...a.player.lanes.flat(),...a.opponent.lanes.flat()];return(c?s.filter(h=>h.isFaceUp):s).length>0?{newState:{...a,actionRequired:{type:"select_card_to_flip_for_light_0",sourceCardId:t.id,actor:l}}}:{newState:$(a,l,c?"Light-0: Cannot flip face-down cards (Frost-1 is active).":"Light-0: No cards to flip.")}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Uv=(t,o,a,i)=>{const{cardOwner:l}=i;let c=tt(a,l,2);c=$(c,l,"Light-2: Draw 2 cards.");const s=[];for(const f of["player","opponent"])for(const p of c[f].lanes)if(p.length>0){const h=p[p.length-1];h.isFaceUp||s.push(h)}return s.length>0?c.actionRequired={type:"select_face_down_card_to_reveal_for_light_2",sourceCardId:t.id,actor:l}:c=$(c,l,"Light-2: No valid face-down cards to reveal."),{newState:c}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const $v=(t,o,a,i)=>{const{cardOwner:l,opponent:c}=i;let s={...a};return[...s[l].lanes[o],...s[c].lanes[o]].filter(p=>!p.isFaceUp).length>0&&(s.actionRequired={type:"select_lane_to_shift_cards_for_light_3",sourceCardId:t.id,sourceLaneIndex:o,actor:l}),{newState:s}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Ov=(t,o,a,i)=>{const{cardOwner:l,opponent:c}=i;let s={...a};const f={...s[c]};if(f.hand.length>0){f.hand=f.hand.map(h=>({...h,isRevealed:!0})),s[c]=f;const p=`${t.protocol}-${t.value}`;s=$(s,l,`${p}: Your opponent reveals their hand.`)}else{const p=`${t.protocol}-${t.value}`;s=$(s,l,`${p}: Opponent has no cards to reveal.`)}return{newState:s}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Lv=(t,o,a,i)=>{const{cardOwner:l}=i,c=Dt(a),s=[...a.player.lanes.flat(),...a.opponent.lanes.flat()].filter(h=>h.id!==t.id);if((c?s.filter(h=>h.isFaceUp):s).length>0){const h={type:"select_any_other_card_to_flip_for_water_0",sourceCardId:t.id,actor:l};return{newState:{...a,actionRequired:h}}}return{newState:$(a,l,c?"Water-0: Cannot flip face-down cards (Frost-1 is active).":"Water-0: No other cards to flip.")}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Pv=(t,o,a,i)=>{const{cardOwner:l}=i,c={...a},s={...c[l]},f=[0,1,2].filter(E=>E!==o);if(f.length===0)return{newState:a};const{drawnCards:p,remainingDeck:h,newDiscard:y}=on(s.deck,s.discard,f.length);if(p.length===0)return{newState:a};const g=p.map(E=>({...E,id:Oe(),isFaceUp:!1}));let v=c,w=[];for(let E=0;E<f.length;E++){const S=f[E],j=v[l].lanes[S];if(j.length>0){const R=j[j.length-1],A={...i,triggerType:"cover"},N=pa(R,S,v,A);if(v=N.newState,N.animationRequests&&w.push(...N.animationRequests),v.actionRequired)break}}const C={...v[l]},x=[...C.lanes];for(let E=0;E<g.length;E++){const S=f[E];x[S]=[...x[S],g[E]]}C.lanes=x,C.deck=h,C.discard=y;let b={...v,[l]:C};return b=$(b,l,`Water-1: Plays ${p.length} card(s) face-down in other lines.`),{newState:b,animationRequests:w.length>0?w:void 0}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Iv=(t,o,a,i)=>{const{cardOwner:l}=i;let c=tt(a,l,2);return c=$(c,l,"Water-2: Draw 2 cards."),Uc(c)?(c=$(c,l,`Frost-1 blocks protocol rearrangement. ${l==="player"?"Player's":"Opponent's"} protocols remain unchanged.`),{newState:c}):(c.actionRequired={type:"prompt_rearrange_protocols",sourceCardId:t.id,target:l,actor:l},{newState:c})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Mv=(t,o,a,i)=>{const{cardOwner:l}=i;return{newState:{...a,actionRequired:{type:"select_lane_for_water_3",sourceCardId:t.id,actor:l}}}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Hv=(t,o,a,i)=>{const{cardOwner:l}=i;return{newState:{...a,actionRequired:{type:"select_own_card_to_return_for_water_4",sourceCardId:t.id,actor:l}}}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Bv=(t,o,a,i)=>{const{cardOwner:l}=i;let c={...a};const s=[];for(const f of["player","opponent"])for(const p of c[f].lanes)p.length>0&&s.push(p[p.length-1]);return s.length===0?(c=$(c,l,"Anarchy-0: No uncovered cards to shift. Skipping to conditional draw."),c=ol(c,l),{newState:c}):(c.actionRequired={type:"select_card_to_shift_for_anarchy_0",sourceCardId:t.id,actor:l},{newState:c})},ol=(t,o)=>{let a={...t};a=Ie(a,"Anarchy-0"),a=Ye(a,"middle");let i=0;for(let l=0;l<3;l++){const c=a.player.protocols[l],s=a.opponent.protocols[l],f=a.player.lanes[l].filter(g=>g.isFaceUp),p=a.opponent.lanes[l].filter(g=>g.isFaceUp);[...f,...p].some(g=>g.protocol!==c&&g.protocol!==s)&&i++}return i>0?(a=tt(a,o,i),a=$(a,o,`${o==="player"?"Player":"Opponent"} draws ${i} card(s) from non-matching protocols.`)):a=$(a,o,"No non-matching face-up cards found. No draw."),a=Ie(a,void 0),a=Ye(a,void 0),a};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Vv=(t,o,a,i)=>{const{cardOwner:l}=i;let c={...a};const s=[];for(const p of["player","opponent"])for(let h=0;h<c[p].lanes.length;h++){const y=c[p].lanes[h];if(y.length>0){const g=y[y.length-1];g.id!==t.id&&s.push({card:g,currentLane:h})}}if(s.length===0)return c=$(c,l,"Anarchy-1: No other uncovered cards to shift."),{newState:c};let f=!1;for(const{card:p,currentLane:h}of s){const y=p.protocol;for(let g=0;g<3;g++){if(g===h)continue;const v=c.player.protocols[g],w=c.opponent.protocols[g];if(y!==v&&y!==w){f=!0;break}}if(f)break}return f?(c.actionRequired={type:"select_card_to_shift_for_anarchy_1",sourceCardId:t.id,actor:l},{newState:c}):(c=$(c,l,"Anarchy-1: No valid targets (all cards match protocols in all other lanes)."),{newState:c})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const zv=(t,o,a,i)=>{const{cardOwner:l}=i;let c={...a};const s=[];for(let f=0;f<c.player.lanes.length;f++){const p=c.player.protocols[f],h=c.opponent.protocols[f];for(const y of c.player.lanes[f])(y.protocol===p||y.protocol===h)&&s.push(y);for(const y of c.opponent.lanes[f])(y.protocol===p||y.protocol===h)&&s.push(y)}return s.length===0?(c=$(c,l,"Anarchy-2: No valid targets (no cards in lanes with matching protocols)."),{newState:c}):(c.actionRequired={type:"select_card_to_delete_for_anarchy_2",sourceCardId:t.id,actor:l},{newState:c})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Gv=(t,o,a,i)=>{const{cardOwner:l,opponent:c}=i,s=$(a,l,"Anarchy-3 prompts to swap opponent's protocols.");return s.actionRequired={type:"prompt_swap_protocols",sourceCardId:t.id,actor:l,target:c},{newState:s}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Yv=(t,o,a,i)=>{const{cardOwner:l,opponent:c}=i;let s=0;a[l].lanes.forEach(p=>{p.forEach(h=>{h.isFaceUp||s++})}),a[c].lanes.forEach(p=>{p.forEach(h=>{h.isFaceUp||s++})});let f={...a};return s>0?(f=tt(f,l,s),f=$(f,l,`Frost-0: Counted ${s} face-down card(s). Draw ${s} card(s).`)):f=$(f,l,"Frost-0: No face-down cards on the field. Draw 0 cards."),{newState:f}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Wv=(t,o,a,i)=>{const{cardOwner:l}=i;let c={...a};return c[l].hand.length>0&&(c.actionRequired={type:"select_card_from_hand_to_play",sourceCardId:t.id,isFaceDown:!0,actor:l}),{newState:c}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Qv=(t,o,a,i)=>{const{cardOwner:l}=i;let c={...a};return c[l].lanes.flatMap(f=>f.filter((p,h)=>p.isFaceUp&&h<f.length-1)).length>0&&(c.actionRequired={type:"select_own_face_up_covered_card_to_flip",count:1,optional:!0,sourceCardId:t.id,actor:l}),{newState:c}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Xv={"Anarchy-0":Bv,"Anarchy-1":Vv,"Anarchy-2":zv,"Anarchy-3":Gv,"Anarchy-5":en,"Apathy-1":km,"Apathy-3":Dm,"Apathy-4":Tm,"Apathy-5":en,"Chaos-0":$m,"Chaos-1":Om,"Chaos-2":Lm,"Chaos-5":Pm,"Darkness-0":Im,"Darkness-1":Mm,"Darkness-2":Hm,"Darkness-3":Bm,"Darkness-4":Vm,"Darkness-5":en,"Death-0":Cv,"Death-2":xv,"Death-3":Sv,"Death-4":bv,"Death-5":en,"Fire-0":Ev,"Fire-1":Rv,"Fire-2":Av,"Fire-4":jv,"Fire-5":en,"Gravity-0":kv,"Gravity-1":Dv,"Gravity-2":Tv,"Gravity-4":Fv,"Gravity-5":en,"Gravity-6":qv,"Hate-0":mv,"Hate-1":vv,"Hate-2":wv,"Hate-5":en,"Life-0":zm,"Life-1":Gm,"Life-2":Ym,"Life-4":Wm,"Life-5":en,"Light-0":Nv,"Light-2":Uv,"Light-3":$v,"Light-4":Ov,"Light-5":en,"Love-1":Qm,"Love-2":Xm,"Love-3":Zm,"Love-4":Km,"Love-5":en,"Love-6":Jm,"Metal-0":ev,"Metal-1":tv,"Metal-3":nv,"Metal-5":en,"Plague-0":ov,"Plague-1":av,"Plague-2":rv,"Plague-3":lv,"Plague-5":en,"Psychic-0":cv,"Psychic-2":sv,"Psychic-3":iv,"Psychic-5":en,"Speed-0":dv,"Speed-1":uv,"Speed-3":pv,"Speed-4":fv,"Speed-5":en,"Spirit-0":hv,"Spirit-1":_v,"Spirit-2":yv,"Spirit-4":gv,"Spirit-5":en,"Water-0":Lv,"Water-1":Pv,"Water-2":Iv,"Water-3":Mv,"Water-4":Hv,"Water-5":en,"Frost-0":Yv,"Frost-2":Wv,"Frost-4":Qv,"Frost-5":en};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Zv=(t,o,a)=>{const{cardOwner:i}=a,l=i==="player"?"opponent":"player";let c={...o};if(c[l].deck.length>0){const s=c[l].deck.shift();s.id=Oe(),c[i].hand.push(s),c=$(c,i,`${i==="player"?"Player":"Opponent"} drew ${s.protocol}-${s.value} from ${l==="player"?"Player":"Opponent"}'s deck via Chaos-0.`)}else c=$(c,i,`${i==="player"?"Player":"Opponent"} could not draw from ${l==="player"?"Player":"Opponent"}'s deck (empty) via Chaos-0.`);if(c[i].deck.length>0){const s=c[i].deck.shift();s.id=Oe(),c[l].hand.push(s),c=$(c,l,`${l==="player"?"Player":"Opponent"} drew 1 card from ${i==="player"?"Player":"Opponent"}'s deck via Chaos-0.`)}else c=$(c,l,`${l==="player"?"Player":"Opponent"} could not draw from ${i==="player"?"Player":"Opponent"}'s deck (empty) via Chaos-0.`);return{newState:c}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Kv=(t,o,a)=>{const{cardOwner:i}=a;return{newState:{...o,actionRequired:{type:"prompt_death_1_effect",sourceCardId:t.id,optional:!0,actor:i}}}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Jv=(t,o,a)=>{const{cardOwner:i}=a,l=`${t.protocol}-${t.value}`;let c=$(o,i,`${l} Start Phase: Flipping itself.`);return c=Wt(new Set([t.id]),c),c.animationState={type:"flipCard",cardId:t.id},{newState:c}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const e0=(t,o,a)=>{const{cardOwner:i}=a;return{newState:{...o,actionRequired:{type:"prompt_spirit_1_start",sourceCardId:t.id,actor:i}}}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const t0=(t,o,a)=>{const{cardOwner:i}=a;let l=-1;for(let p=0;p<3;p++)if(o[i].lanes[p].some(y=>y.id===t.id)){l=p;break}if(l===-1)return{newState:o};const c=o.player.protocols[l],s=o.opponent.protocols[l];if(c==="Anarchy"||s==="Anarchy"){const p=`${t.protocol}-${t.value}`;let h=$(o,i,`${p} Start Phase: In Anarchy line - flipping itself.`);return h=Wt(new Set([t.id]),h),h.animationState={type:"flipCard",cardId:t.id},{newState:h}}else return{newState:o}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const n0={"Anarchy-6":t0,"Chaos-0":Zv,"Death-1":Kv,"Psychic-1":Jv,"Spirit-1":e0};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const o0=(t,o,a)=>{const{cardOwner:i}=a,l=o[i].hand.length;if(l===0)return{newState:o};let c={...o};const s={...c[i]};return s.discard=[...s.discard,...s.hand],s.hand=[],c[i]=s,c=$(c,i,`Chaos-4: Discarded ${l} card(s).`),c=tt(c,i,l),c=$(c,i,`Chaos-4: Drew ${l} card(s).`),{newState:c}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const a0=(t,o,a)=>{const{cardOwner:i,opponent:l}=a,c=[];for(const f of o[l].lanes)if(f.length>0){const p=f[f.length-1];p.isFaceUp||c.push(p)}return c.length>0?{newState:{...o,actionRequired:{type:"plague_4_opponent_delete",sourceCardId:t.id,actor:l}}}:{newState:{...$(o,i,"Plague-4: Opponent has no targetable face-down cards to delete."),actionRequired:{type:"plague_4_player_flip_optional",sourceCardId:t.id,optional:!0,actor:i}}}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const r0=(t,o,a)=>{const{cardOwner:i}=a;let l=tt(o,i,1);return l=$(l,i,"Light-1 End Phase: Draw 1 card."),{newState:l}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const l0=(t,o,a)=>{const{cardOwner:i}=a;return o[i].hand.length>0?{newState:{...o,actionRequired:{type:"prompt_fire_3_discard",sourceCardId:t.id,optional:!0,actor:i}}}:{newState:o}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const c0=(t,o,a)=>{const{cardOwner:i}=a,l=[];for(const c of o[i].lanes)if(c.length>0){const s=c[c.length-1];l.push(s)}return l.length>0?{newState:{...o,actionRequired:{type:"prompt_shift_for_speed_3",sourceCardId:t.id,optional:!0,actor:i}}}:{newState:o}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const s0=(t,o,a)=>{const{cardOwner:i}=a;return o[i].hand.length>0?{newState:{...o,actionRequired:{type:"prompt_give_card_for_love_1",sourceCardId:t.id,optional:!0,actor:i}}}:{newState:o}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const i0=(t,o,a)=>{const{cardOwner:i,opponent:l}=a;return o[l].lanes.flat().length>0?{newState:{...o,actionRequired:{type:"prompt_return_for_psychic_4",sourceCardId:t.id,optional:!0,actor:i}}}:{newState:o}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const d0=(t,o,a)=>{const{cardOwner:i}=a;if(Uc(o))return{newState:$(o,i,`Frost-1 blocks protocol rearrangement. ${i==="player"?"Player's":"Opponent's"} protocols remain unchanged.`)};let l=-1;for(let s=0;s<3;s++){const f=o[i].lanes[s],p=f.length>0?f[f.length-1]:null;if(p&&p.id===t.id&&p.isFaceUp){l=s;break}}if(l===-1)return{newState:o};const c=$(o,i,`Anarchy-3: Rearrange protocols (Anarchy cannot be on line ${l}).`);return c.actionRequired={type:"prompt_rearrange_protocols",sourceCardId:t.id,target:i,actor:i,disallowedProtocolForLane:{laneIndex:l,protocol:"Anarchy"}},{newState:c}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const u0={"Chaos-4":o0,"Plague-4":a0,"Light-1":r0,"Fire-3":l0,"Speed-3":c0,"Love-1":s0,"Psychic-4":i0,"Anarchy-3":d0};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const p0=(t,o,a,i)=>{const{cardOwner:l}=i,c=["player","opponent"],s=[];for(const g of c){const v=a[g].lanes[o];for(let w=0;w<v.length;w++)s.push({card:v[w],owner:g})}if(s.length===0)return{newState:a};const f=s.reduce((g,v)=>{const w=C=>C.card.isFaceUp?C.card.value:a[C.owner].lanes[o].some(b=>b.isFaceUp&&b.protocol==="Darkness"&&b.value===2)?4:2;return w(v)<w(g)?v:g}),p=f.card.isFaceUp?`${f.card.protocol}-${f.card.value}`:"a face-down card",h=f.owner==="player"?"Player's":"Opponent's";return{newState:$(a,l,`Effect triggers, deleting the lowest value covered card (${h} ${p}).`),animationRequests:[{type:"delete",cardId:f.card.id,owner:f.owner}]}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const f0=(t,o,a,i)=>{const{cardOwner:l}=i,c=`${t.protocol}-${t.value}`;let s=$(a,l,`${c} On-Cover: Draw 1 card.`);return s=tt(s,l,1),[...s.player.lanes.flat(),...s.opponent.lanes.flat()].filter(p=>p.id!==t.id).length>0?(s=$(s,l,`${c} On-Cover: Prompts to flip another card.`),s.actionRequired={type:"select_any_other_card_to_flip",sourceCardId:t.id,draws:0,actor:l},a.turn!==l&&(s._interruptedTurn=a.turn,s._interruptedPhase=a.phase,s.turn=l)):s=$(s,l,`${c} On-Cover: No other cards to flip.`),{newState:s}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const h0=(t,o,a,i)=>{const{cardOwner:l}=i;if(a[l].deck.length>0||a[l].discard.length>0){let c={...a};return c.actionRequired={type:"select_lane_for_life_3_play",sourceCardId:t.id,disallowedLaneIndex:o,actor:l},a.turn!==l&&(c._interruptedTurn=a.turn,c._interruptedPhase=a.phase,c.turn=l),{newState:c}}return{newState:a}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const _0=(t,o,a,i)=>{const{actor:l,cardOwner:c}=i,s=`${t.protocol}-${t.value}`;let f=$(a,l,`${s} effect triggers: flipping itself face-down.`);return f=Wt(new Set([t.id]),f),{newState:f}},y0=(t,o,a,i)=>{const{actor:l,cardOwner:c}=i,s=`${t.protocol}-${t.value}`;return{newState:$(a,l,`${s} effect triggers: deleting itself.`),animationRequests:[{type:"delete",cardId:t.id,owner:c}]}},g0=(t,o,a,i)=>{const{actor:l,cardOwner:c}=i,s=`${t.protocol}-${t.value}`;return{newState:$(a,l,`${s} effect triggers on cover: deleting itself.`),animationRequests:[{type:"delete",cardId:t.id,owner:c}]}},m0={"Apathy-2":_0,"Hate-4":p0,"Fire-0":f0,"Life-0":y0,"Life-3":h0,"Metal-6":g0};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function sl(t,o,a,i){const{cardOwner:l,opponent:c,triggerType:s}=i,f=a[l].lanes[o];if(!f.find(w=>w.id===t.id))return{newState:a};if(!(f.length>0&&f[f.length-1].id===t.id))return{newState:a};if(Um(a,o))return{newState:a};const y=t;if(y.customEffects&&y.customEffects.middleEffects&&y.customEffects.middleEffects.length>0){let w=a;(s==="middle"||s==="play")&&(w=Co(w));const C=`${t.protocol}-${t.value}`;w=Ie(w,C),w=Ye(w,"middle");let x=w;for(let E=0;E<y.customEffects.middleEffects.length;E++){const S=y.customEffects.middleEffects[E];if(x=hn(t,o,x,i,S).newState,x.actionRequired){const R=y.customEffects.middleEffects.slice(E+1);return R.length>0&&(x._pendingCustomEffects={sourceCardId:t.id,laneIndex:o,context:i,effects:R}),{newState:Ee(x)}}}return{newState:Ee(x)}}const g=`${t.protocol}-${t.value}`,v=Xv[g];if(v){let w=a;(s==="middle"||s==="play")&&(w=Co(w));const C=`${t.protocol}-${t.value}`;w=Ie(w,C),w=Ye(w,"middle");const x=v(t,o,w,i);let b=x.newState;const E=Ee(b);return{...x,newState:E}}return{newState:a}}function pa(t,o,a,i){var f;if(!t.isFaceUp)return{newState:a};const l=t;if(l.customEffects&&l.customEffects.bottomEffects){const p=l.customEffects.bottomEffects.filter(h=>h.trigger==="on_cover");if(p.length>0){console.log("[DEBUG executeOnCoverEffect] Found",p.length,"on-cover effects for",`${t.protocol}-${t.value}`);const h=`${t.protocol}-${t.value}`;let y=Ie(a,h);y=Ye(y,void 0);let g=y;const v=[];for(const x of p){console.log("[DEBUG executeOnCoverEffect] Executing effect:",JSON.stringify(x.params));const b=hn(t,o,g,i,x);if(console.log("[DEBUG executeOnCoverEffect] After executeCustomEffect, actionRequired:",((f=b.newState.actionRequired)==null?void 0:f.type)||"null"),g=b.newState,b.animationRequests&&v.push(...b.animationRequests),g.actionRequired){let E=Co(g);return{newState:Ee(E),animationRequests:v.length>0?v:void 0}}}let w=Co(g);return{newState:Ee(w),animationRequests:v.length>0?v:void 0}}}const c=`${t.protocol}-${t.value}`,s=m0[c];if(s){const p=`${t.protocol}-${t.value}`;let h=Ie(a,p);h=Ye(h,void 0);const y=s(t,o,h,i);let g=Co(y.newState);const v=Ee(g);return{...y,newState:v}}return{newState:a}}function Ph(t,o,a){const i=t.turn;let l={...t};const c=o==="Start"?l.processedStartEffectIds||[]:l.processedEndEffectIds||[],s=[],f=new Set;l[i].lanes.flat().forEach(p=>{p.isFaceUp&&p.top.includes(`'emphasis'>${o}:`)&&!c.includes(p.id)&&!f.has(p.id)&&(s.push({card:p,box:"top"}),f.add(p.id))}),l[i].lanes.forEach(p=>{if(p.length>0){const h=p[p.length-1];h.isFaceUp&&h.bottom.includes(`'emphasis'>${o}:`)&&!c.includes(h.id)&&!f.has(h.id)&&(s.push({card:h,box:"bottom"}),f.add(h.id))}});for(const{card:p,box:h}of s){const y=l[i].lanes.find(S=>S.some(j=>j.id===p.id));if(!y||!y.some(S=>S.id===p.id&&S.isFaceUp)||h==="bottom"&&!(y[y.length-1].id===p.id))continue;const v=i==="player"?"opponent":"player",w={cardOwner:i,actor:i,currentTurn:t.turn,opponent:v,triggerType:o==="Start"?"start":"end"},C=p,x=o==="Start"?"start":"end";if(C.customEffects){const S=h==="top"?C.customEffects.topEffects:C.customEffects.bottomEffects,j=(S==null?void 0:S.filter(R=>R.trigger===x))||[];if(j.length>0){l=Co(l);const R=`${p.protocol}-${p.value}`,A=o==="Start"?"start":"end";l=Ie(l,R),l=Ye(l,A),l=$(l,i,`${o} Effect: ${p.protocol}-${p.value} triggers.`);const N=l[i].lanes.findIndex(V=>V.some(L=>L.id===p.id));for(const V of j){const L=hn(p,N,l,w,V);if(l=Ee(L.newState),l.actionRequired){const D=o==="Start"?"processedStartEffectIds":"processedEndEffectIds";return l[D]=[...l[D]||[],p.id],{newState:l}}}const I=o==="Start"?"processedStartEffectIds":"processedEndEffectIds";l[I]=[...l[I]||[],p.id],l=jn(l),l=Ie(l,void 0),l=Ye(l,void 0);continue}}const b=`${p.protocol}-${p.value}`,E=a[b];if(E){l=Co(l);const S=`${p.protocol}-${p.value}`,j=o==="Start"?"start":"end";l=Ie(l,S),l=Ye(l,j),l=$(l,i,`${o} Effect: ${p.protocol}-${p.value} triggers.`);const R=E(p,l,w);l=Ee(R.newState);const A=o==="Start"?"processedStartEffectIds":"processedEndEffectIds";if(l[A]=[...l[A]||[],p.id],l.actionRequired)return{newState:l};l=jn(l),l=Ie(l,void 0),l=Ye(l,void 0)}}return{newState:l}}function Ih(t){return Ph(t,"Start",n0)}function v0(t){return Ph(t,"End",u0)}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const w0=t=>{if(!t.useControlMechanic)return t;const o=t.turn,a=o==="player"?"opponent":"player",i=t[o],l=t[a];let c=0;const s=i.laneValues[0],f=i.laneValues[1],p=i.laneValues[2],h=l.laneValues[0],y=l.laneValues[1],g=l.laneValues[2];if(s>h&&c++,f>y&&c++,p>g&&c++,c>=2&&t.controlCardHolder!==o){let v=Ie(t,void 0);return v=Ye(v,void 0),v={...v,_logIndentLevel:0},v=$(v,o,`${o==="player"?"Player":"Opponent"} gains the Control Component.`),{...v,controlCardHolder:o}}return t},Ka=t=>{if(t.winner)return t;const o=t.turn;let a={...t};switch(a=Ie(a,void 0),a=Ye(a,void 0),a={...a,_logIndentLevel:0},t.phase){case"start":return a=Ih(a).newState,a.actionRequired?a:(a=Ie(a,void 0),a=Ye(a,void 0),a={...a,_logIndentLevel:0},{...a,phase:"control"});case"control":{const i=w0(a);let l=Ie(i,void 0);return l=Ye(l,void 0),l={...l,_logIndentLevel:0},{...l,phase:"compile"}}case"compile":{const i=Yh(a,o);return i.length>0?{...a,compilableLanes:i}:(a=Ie(a,void 0),a=Ye(a,void 0),a={...a,_logIndentLevel:0},{...a,phase:"action",compilableLanes:[]})}case"action":return a=Ie(a,void 0),a=Ye(a,void 0),a={...a,_logIndentLevel:0},{...a,phase:"hand_limit"};case"hand_limit":{const i=a[o],l=i.lanes.some(f=>f.length>0&&f[f.length-1].isFaceUp&&f[f.length-1].protocol==="Spirit"&&f[f.length-1].value===0),s=Wn(a).some(({rule:f,cardOwner:p})=>f.type==="skip_check_cache_phase"&&(f.target==="self"&&p===o||f.target==="all")&&p===o);if(l||s){let f=$(a,o,"Skipping Check Cache phase.");return f=Ie(f,void 0),f=Ye(f,void 0),f={...f,_logIndentLevel:0},{...f,phase:"end"}}if(i.hand.length>5){const f=i.hand.length-5;return{...$(a,o,`Check Cache: ${o==="player"?"Player":"Opponent"} has ${i.hand.length} cards, must discard ${f}.`),actionRequired:{type:"discard",actor:o,count:f}}}return a=Ie(a,void 0),a=Ye(a,void 0),a={...a,_logIndentLevel:0},{...a,phase:"end"}}case"end":{const i={...a};a=v0(a).newState;const l=i.actionRequired,c=a.actionRequired;if(c&&c!==l||a.queuedActions&&a.queuedActions.length>0&&(a=Dc(a),a.actionRequired))return a;const s=o==="player"?"opponent":"player",f={...a[o],cannotCompile:!1};return a=Ie(a,void 0),a=Ye(a,void 0),a={...a,_logIndentLevel:0},{...a,[o]:f,turn:s,phase:"start",processedStartEffectIds:[],processedEndEffectIds:[],processedSpeed1TriggerThisTurn:!1,processedUncoverEventIds:[],_interruptedTurn:void 0,_interruptedPhase:void 0}}}return t};function Ge(t){const o=t._pendingCustomEffects;if(!o||o.effects.length===0)return t;const a={type:"execute_remaining_custom_effects",sourceCardId:o.sourceCardId,laneIndex:o.laneIndex,effects:o.effects,context:o.context,actor:o.context.cardOwner,selectedCardFromPreviousEffect:o.selectedCardFromPreviousEffect},i={...t,queuedActions:[...t.queuedActions||[],a]};return delete i._pendingCustomEffects,i}const Yn=t=>{let o=Ge(t);if(!o.queuedActions||o.queuedActions.length===0)return o;let a=[...o.queuedActions];for(;a.length>0;){const i=a.shift();if(i.sourceCardId&&i.type!=="flip_self_for_water_0"&&i.type!=="flip_self_for_psychic_4"){const l=fe(o,i.sourceCardId);if(!l||!l.card.isFaceUp){const c=l?`${l.card.protocol}-${l.card.value}`:"a card";o=$(o,i.actor,`Queued effect from ${c} was cancelled because the source is no longer active.`);continue}}if(i.type==="flip_self_for_water_0"){console.log("[WATER-0 FLIP] Processing flip_self_for_water_0 in processQueuedActions");const{sourceCardId:l,actor:c}=i,s=fe(o,l),f=dn(o,l);if(console.log("[DEBUG] Water-0 self-flip queue processing:",{sourceCardId:l,foundCard:!!s,cardName:s?`${s.card.protocol}-${s.card.value}`:"NOT_FOUND",isFaceUp:s==null?void 0:s.card.isFaceUp,isUncovered:f,willExecute:!!(s&&s.card.isFaceUp&&f)}),s&&s.card.isFaceUp&&f){const p=`${s.card.protocol}-${s.card.value}`;console.log("[WATER-0 FLIP] Executing self-flip"),o=$(o,c,`${p}: Flips itself.`),o=Wt(new Set([l]),o),o.animationState={type:"flipCard",cardId:l}}else{const p=s?`${s.card.protocol}-${s.card.value}`:"Water-0",h=s?s.card.isFaceUp?"now covered":"flipped face-down":"deleted";console.log("[WATER-0 FLIP] Cancelling self-flip - reason:",h),o=$(o,c,`The self-flip effect from ${p} was cancelled because it is ${h}.`)}continue}if(i.type==="flip_self_for_psychic_4"){const{sourceCardId:l,actor:c}=i,s=fe(o,l),f=dn(o,l);if(s&&s.card.isFaceUp&&f){const p=`${s.card.protocol}-${s.card.value}`;o=$(o,c,`${p}: Flips itself.`),o=Wt(new Set([l]),o),o.animationState={type:"flipCard",cardId:l}}else{const p=s?`${s.card.protocol}-${s.card.value}`:"Psychic-4",h=s?s.card.isFaceUp?"now covered":"flipped face-down":"deleted";o=$(o,c,`The self-flip effect from ${p} was cancelled because it is ${h}.`)}continue}if(i.type==="anarchy_0_conditional_draw"){const{sourceCardId:l,actor:c}=i,s=fe(o,l);if(s&&s.card.isFaceUp)o=ol(o,c),o=jn(o);else{const f=s?`${s.card.protocol}-${s.card.value}`:"Anarchy-0";o=$(o,c,`The conditional draw from ${f} was cancelled because the source is no longer active.`),o=jn(o)}continue}if(i.type==="execute_remaining_custom_effects"){const{sourceCardId:l,laneIndex:c,effects:s,context:f,selectedCardFromPreviousEffect:p}=i,h=fe(o,l);if(!h){o=$(o,f.cardOwner,"Remaining effects cancelled because the source card was deleted or returned.");continue}if(!h.card.isFaceUp){const g=`${h.card.protocol}-${h.card.value}`;o=$(o,f.cardOwner,`Remaining effects from ${g} cancelled because it was flipped face-down.`);continue}if(!dn(o,l)){const g=`${h.card.protocol}-${h.card.value}`;o=$(o,f.cardOwner,`Remaining effects from ${g} cancelled because it is now covered.`);continue}p&&(o._selectedCardFromPreviousEffect=p);for(let g=0;g<s.length;g++){const v=s[g],w=hn(h.card,c,o,f,v);if(o=w.newState,w.animationRequests&&w.animationRequests.length>0&&!o.actionRequired){console.log(`[execute_remaining_custom_effects] Effect ${g+1} has ${w.animationRequests.length} animations - stopping to show them`);const C=s.slice(g+1);if(C.length>0){const b={type:"execute_remaining_custom_effects",sourceCardId:l,laneIndex:c,effects:C,context:f,actor:f.cardOwner};o.queuedActions=[b,...a||[]]}else o.queuedActions=a;const x=w.animationRequests[0];return x.type==="draw"?o.animationState={type:"draw",player:x.player,count:x.count}:x.type==="play"?o.animationState={type:"playCard",cardId:x.cardId}:x.type==="delete"&&(o.animationState={type:"deleteCard",cardId:x.cardId}),o}if(o.actionRequired){const C=s.slice(g+1);if(C.length>0&&(console.log(`[processQueuedActions] Stopping at effect ${g+1}/${s.length}, ${C.length} effects remaining`),o._pendingCustomEffects={sourceCardId:l,laneIndex:c,context:f,effects:C}),o._interruptedTurn){const x=o._interruptedTurn,b=o._interruptedPhase||o.phase;delete o._interruptedTurn,delete o._interruptedPhase,o.turn=x,o.phase=b}return o.queuedActions=a,o}}continue}if(i.type==="speed_3_self_flip_after_shift"){const{sourceCardId:l,actor:c}=i,s=fe(o,l),f=dn(o,l);if(s&&s.card.isFaceUp&&f)o=$(o,c,"Speed-3: Flipping itself after shifting a card."),o=Wt(new Set([l]),o),o.animationState={type:"flipCard",cardId:l};else{const p=s?`${s.card.protocol}-${s.card.value}`:"Speed-3",h=s?s.card.isFaceUp?"now covered":"flipped face-down":"deleted";o=$(o,c,`The self-flip effect from ${p} was cancelled because it is ${h}.`)}continue}if(i.type==="reveal_opponent_hand"){const l=o.turn==="player"?"opponent":"player",c={...o[l]};if(c.hand.length>0){c.hand=c.hand.map(p=>({...p,isRevealed:!0})),o[l]=c;const s=fe(o,i.sourceCardId),f=s?`${s.card.protocol}-${s.card.value}`:"A card effect";o=$(o,o.turn,`${f}: Opponent reveals their hand.`)}else{const s=fe(o,i.sourceCardId),f=s?`${s.card.protocol}-${s.card.value}`:"A card effect";o=$(o,o.turn,`${f}: Opponent has no cards to reveal.`)}continue}if(i.type==="gravity_2_shift_after_flip"){const{cardToShiftId:l,targetLaneIndex:c,cardOwner:s,actor:f,sourceCardId:p}=i,h=fe(o,l),y=fe(o,p),g=dn(o,p),v=y&&y.card.isFaceUp&&g;if(!h||!v){const w=y?`${y.card.protocol}-${y.card.value}`:"Gravity-2";o=$(o,f,`${w}: Shift cancelled because the card no longer exists or is not active.`)}else o=Ln(o,l,s,c,f).newState;continue}if(i.type==="select_any_opponent_card_to_shift"){const l=i.actor==="player"?"opponent":"player";if(o[l].lanes.flat().length===0){const c=fe(o,i.sourceCardId),s=c?`${c.card.protocol}-${c.card.value}`:"A card effect";o=$(o,i.actor,`${s}: Opponent has no cards to shift, skipping effect.`);continue}}if(i.type==="shift_flipped_card_optional"){const l=fe(o,i.sourceCardId),c=dn(o,i.sourceCardId);if(!l||!l.card.isFaceUp||!c){const s=l?`${l.card.protocol}-${l.card.value}`:"the source card";o=$(o,i.actor,`Shift from ${s} was cancelled because the source is no longer active.`);continue}}return o.actionRequired=i,o.queuedActions=a,o}return{...o,queuedActions:[],actionRequired:null}},Dc=t=>{var l,c;if(t.winner)return t;if(((l=t.actionRequired)==null?void 0:l.type)==="execute_remaining_custom_effects"){const s=t.actionRequired,f={...t,actionRequired:null,queuedActions:[s,...t.queuedActions||[]]};return Yn(f)}if(t.actionRequired)return t;if(t.queuedActions&&t.queuedActions.length>0){const s=Yn(t);if(s.actionRequired)return s;t=s}if(t._interruptedTurn){const s=t._interruptedTurn,f=t._interruptedPhase||t.phase;let p={...t};if(delete p._interruptedTurn,delete p._interruptedPhase,p.turn=s,p.phase=f,f==="start"||f==="end"){if(p.queuedActions&&p.queuedActions.length>0&&(p=Yn(p)),!p.actionRequired&&f==="end"){const h=p.turn==="player"?"opponent":"player",y={...p[p.turn],cannotCompile:!1};return p=Ie(p,void 0),p=Ye(p,void 0),p={...p,_logIndentLevel:0},{...p,[p.turn]:y,turn:h,phase:"start",processedStartEffectIds:[],processedEndEffectIds:[],processedSpeed1TriggerThisTurn:!1,processedUncoverEventIds:[],_interruptedTurn:void 0,_interruptedPhase:void 0}}return p}t=p}if(((c=t.actionRequired)==null?void 0:c.type)==="prompt_rearrange_protocols"&&t.actionRequired.originalAction){console.log("[DEBUG processEndOfAction] FALLBACK HANDLER TRIGGERED - This should NOT happen if resolveRearrangeProtocols was called!"),console.log("[DEBUG processEndOfAction] originalAction:",t.actionRequired.originalAction);const s=t.actionRequired.originalAction;let f={...t,actionRequired:null,controlCardHolder:null};if(s.type==="compile")return al(f);if(s.type==="fill_hand"){console.log("[DEBUG processEndOfAction] Using fallback drawForPlayer, hand before:",f[f.turn].hand.length);const p=tt(f,f.turn,5-f[f.turn].hand.length);return console.log("[DEBUG processEndOfAction] After fallback drawForPlayer, hand:",p[p.turn].hand.length),al(p)}}if(t.queuedEffect){const{card:s,laneIndex:f}=t.queuedEffect,p={...t,queuedEffect:void 0},h=fe(p,s.id);if(h){const{card:y,owner:g}=h,v={cardOwner:g,actor:g,currentTurn:p.turn,opponent:g==="player"?"opponent":"player",triggerType:"play"},{newState:w}=sl(y,f,p,v);if(w.actionRequired)return w;t=w}else console.warn(`Skipping queued effect for ${s.protocol}-${s.value} as it is no longer on the board.`),t=$(t,t.turn,`Skipping queued effect for ${s.protocol}-${s.value} as it is no longer on the board.`),t=p}if(t.queuedActions&&t.queuedActions.length>0){let s={...t},f=[...s.queuedActions];for(;f.length>0;){const p=f.shift();if(p.sourceCardId&&p.type!=="flip_self_for_water_0"&&p.type!=="flip_self_for_psychic_4"){const h=fe(s,p.sourceCardId);if(!h||!h.card.isFaceUp){const y=h?`${h.card.protocol}-${h.card.value}`:"a card";s=$(s,p.actor,`Queued effect from ${y} was cancelled because the source is no longer active.`);continue}}if(p.type==="flip_self_for_water_0"){console.log("[WATER-0 FLIP] Processing flip_self_for_water_0 in processEndOfAction (SECOND LOCATION - SHOULD NOT BE CALLED)");const{sourceCardId:h,actor:y}=p,g=fe(s,h),v=dn(s,h);if(console.log("[DEBUG] Water-0 self-flip queue processing (processEndOfAction):",{sourceCardId:h,foundCard:!!g,cardName:g?`${g.card.protocol}-${g.card.value}`:"NOT_FOUND",isFaceUp:g==null?void 0:g.card.isFaceUp,isUncovered:v,willExecute:!!(g&&g.card.isFaceUp&&v)}),g&&g.card.isFaceUp&&v){const w=`${g.card.protocol}-${g.card.value}`;console.log("[WATER-0 FLIP] Executing self-flip (processEndOfAction)"),s=$(s,y,`${w}: Flips itself.`),s=Wt(new Set([h]),s),s.animationState={type:"flipCard",cardId:h}}else{const w=g?`${g.card.protocol}-${g.card.value}`:"Water-0",C=g?g.card.isFaceUp?"now covered":"flipped face-down":"deleted";console.log("[WATER-0 FLIP] Cancelling self-flip (processEndOfAction) - reason:",C),s=$(s,y,`The self-flip effect from ${w} was cancelled because it is ${C}.`)}continue}if(p.type==="flip_self_for_psychic_4"){const{sourceCardId:h,actor:y}=p,g=fe(s,h),v=dn(s,h);if(g&&g.card.isFaceUp&&v){const w=`${g.card.protocol}-${g.card.value}`;s=$(s,y,`${w}: Flips itself.`),s=Wt(new Set([h]),s),s.animationState={type:"flipCard",cardId:h}}else{const w=g?`${g.card.protocol}-${g.card.value}`:"Psychic-4",C=g?g.card.isFaceUp?"now covered":"flipped face-down":"deleted";s=$(s,y,`The self-flip effect from ${w} was cancelled because it is ${C}.`)}continue}if(p.type==="anarchy_0_conditional_draw"){const{sourceCardId:h,actor:y}=p,g=fe(s,h);if(g&&g.card.isFaceUp)s=ol(s,y),s=jn(s);else{const v=g?`${g.card.protocol}-${g.card.value}`:"Anarchy-0";s=$(s,y,`The conditional draw from ${v} was cancelled because the source is no longer active.`),s=jn(s)}continue}if(p.type==="speed_3_self_flip_after_shift"){const{sourceCardId:h,actor:y}=p,g=fe(s,h),v=dn(s,h);if(g&&g.card.isFaceUp&&v)s=$(s,y,"Speed-3: Flipping itself after shifting a card."),s=Wt(new Set([h]),s),s.animationState={type:"flipCard",cardId:h};else{const w=g?`${g.card.protocol}-${g.card.value}`:"Speed-3",C=g?g.card.isFaceUp?"now covered":"flipped face-down":"deleted";s=$(s,y,`The self-flip effect from ${w} was cancelled because it is ${C}.`)}continue}if(p.type==="reveal_opponent_hand"){const h=s.turn==="player"?"opponent":"player",y={...s[h]};if(y.hand.length>0){y.hand=y.hand.map(w=>({...w,isRevealed:!0})),s[h]=y;const g=fe(s,p.sourceCardId),v=g?`${g.card.protocol}-${g.card.value}`:"A card effect";s=$(s,s.turn,`${v}: Opponent reveals their hand.`)}else{const g=fe(s,p.sourceCardId),v=g?`${g.card.protocol}-${g.card.value}`:"A card effect";s=$(s,s.turn,`${v}: Opponent has no cards to reveal.`)}continue}if(p.type==="select_any_opponent_card_to_shift"){const h=p.actor==="player"?"opponent":"player";if(s[h].lanes.flat().length===0){const y=fe(s,p.sourceCardId),g=y?`${y.card.protocol}-${y.card.value}`:"A card effect";s=$(s,p.actor,`${g}: Opponent has no cards to shift, skipping effect.`);continue}}if(p.type==="shift_flipped_card_optional"){const h=fe(s,p.sourceCardId),y=dn(s,p.sourceCardId);if(!h||!h.card.isFaceUp||!y){const g=h?`${h.card.protocol}-${h.card.value}`:"the source card";s=$(s,p.actor,`Shift from ${g} was cancelled because the source is no longer active.`);continue}}return s.actionRequired=p,s.queuedActions=f,s}t={...s,queuedActions:[],actionRequired:null}}const o=t.phase==="action"?"hand_limit":t.phase;let a={...t,phase:o,compilableLanes:[],processedUncoverEventIds:[]};const i=t.turn;for(;a.turn===i&&!a.winner;){const s=a.actionRequired,f=a.phase;a=Ka(a);const p=a.actionRequired;if(p&&p!==s)break;if(a.phase===f&&a.turn===i){console.error("Game is stuck in a phase loop:",a.phase);break}}return a},al=t=>{if(t.winner)return t;let o={...t};if(o._interruptedTurn){const i=o._interruptedTurn,l=o._interruptedPhase||o.phase;delete o._interruptedTurn,delete o._interruptedPhase,o.turn=i,o.phase=l}const a=o.turn;for(;o.turn===a&&!o.actionRequired&&!o.winner;){const i=o.phase;if(i==="action")break;if(i==="compile"){const c=Yh(o,a);if(c.length>0){o={...o,compilableLanes:c};break}}const l=o.phase;if(o=Ka(o),l===o.phase&&!o.actionRequired){console.error("Game is stuck in an automatic phase loop:",l),console.error("State:",{phase:o.phase,turn:o.turn,actionRequired:o.actionRequired,queuedActions:o.queuedActions,interruptedTurn:o._interruptedTurn});break}}return o},Mh=t=>{let o={...t,actionRequired:null};const a=Ih(o).newState;if(a.actionRequired)return a;let i=a;return i.phase!=="control"&&(i={...i,phase:"control"}),i=Ka(i),i.actionRequired||(i=Ka(i)),i},Hh=t=>{if(t.winner)return t;let o={...t,phase:"start"};return o=Ka(o),o.actionRequired?o:al(o)},_h=Object.freeze(Object.defineProperty({__proto__:null,advancePhase:Ka,continueTurnAfterStartPhaseAction:Mh,continueTurnProgression:al,processEndOfAction:Dc,processQueuedActions:Yn,processStartOfTurn:Hh,queuePendingCustomEffects:Ge},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function fe(t,o){if(!o)return null;for(const a of["player","opponent"])for(const i of t[a].lanes){const l=i.find(c=>c.id===o);if(l)return{card:l,owner:a}}return null}function dn(t,o){if(!o)return!1;for(const a of["player","opponent"])for(const i of t[a].lanes)if(i.length>0&&i[i.length-1].id===o)return!0;return!1}function C0(t,o,a){var f;let i={...t};const l=(f=t.actionRequired)==null?void 0:f.followUpEffect,c=fe(i,o),s=c?Et(c.card,i[c.owner].lanes.find(p=>p.some(h=>h.id===o))||[]):0;if(i=Ge(i),i.actionRequired=null,l&&a){const p=fe(i,a);if(p){console.log("[Custom Effect] Executing conditional follow-up effect after flip");const h={cardOwner:p.owner,opponent:p.owner==="player"?"opponent":"player",currentTurn:i.turn,actor:p.owner,referencedCard:c==null?void 0:c.card,referencedCardValue:s};console.log(`[Context Propagation] Flipped card ${c==null?void 0:c.card.protocol}-${c==null?void 0:c.card.value}, value: ${s}`);let y=-1;for(let g=0;g<i[p.owner].lanes.length;g++)if(i[p.owner].lanes[g].some(v=>v.id===a)){y=g;break}if(y!==-1)return hn(p.card,y,i,h,l).newState}}return i}function Bh(t,o,a,i){var g,v,w,C;let l={...t};const c=(g=t.actionRequired)==null?void 0:g.followUpEffect,s=(v=t.actionRequired)==null?void 0:v.conditionalType;if(l=Ge(l),l.actionRequired=null,i&&(l=jn(l)),c&&i){const x=fe(l,i);if(x){const b=((w=t.actionRequired)==null?void 0:w.previousHandSize)||0,E=l[o].hand.length,S=Math.max(0,b-E);if(!(s==="then"||s==="if_executed"&&S>0))return console.log(`[Custom Effect] Skipping follow-up effect - conditional type: ${s}, discarded: ${S}`),l;console.log(`[Custom Effect] Executing conditional follow-up effect after discard (type: ${s})`);const R={cardOwner:x.owner,opponent:x.owner==="player"?"opponent":"player",currentTurn:l.turn,actor:o,discardedCount:S,previousHandSize:b};console.log(`[Context Propagation] Discarded ${S} cards, previousHandSize: ${b}`);let A=-1;for(let N=0;N<l[x.owner].lanes.length;N++)if(l[x.owner].lanes[N].some(I=>I.id===i)){A=N;break}if(A!==-1)return hn(x.card,A,l,R,c).newState}return l}if(!a||!i)return l;const f=(C=fe(l,i))==null?void 0:C.card,p=f?`${f.protocol}-${f.value}`:"A card effect",h=l.queuedActions&&l.queuedActions.length>0;let y=null;switch(a){case"fire_1":l=$(l,o,`${p}: Discard successful. Prompting to delete 1 card.`),y={type:"select_cards_to_delete",count:1,sourceCardId:i,disallowedIds:[i],actor:o};break;case"fire_2":l=$(l,o,`${p}: Discard successful. Prompting to return 1 card.`),y={type:"select_card_to_return",sourceCardId:i,actor:o};break;case"fire_3":l=$(l,o,`${p}: Discard successful. Prompting to flip 1 card.`),y={type:"select_card_to_flip_for_fire_3",sourceCardId:i,actor:o};break}if(y)if(h){const x=l.queuedActions||[],b=x.filter(S=>S.type==="shift_flipped_card_optional"||S.type==="gravity_2_shift_after_flip"),E=x.filter(S=>S.type!=="shift_flipped_card_optional"&&S.type!=="gravity_2_shift_after_flip");l.queuedActions=[...E,y,...b]}else l.actionRequired=y;return l}function Go(t,o,a=null){const i=fe(t,o);if(!i)return t;const{card:l,owner:c}=i;if(!l.isFaceUp){let b=-1;for(let E=0;E<t[c].lanes.length;E++)if(t[c].lanes[E].some(S=>S.id===o)){b=E;break}if(b!==-1){const E=qm(t,b);if(!E.allowed)return console.log(`Flip blocked: ${E.reason}`),t}}let f=Ct(t,"on_flip",{player:c,cardId:o}).newState;if(!fe(f,o))return console.log(`[on_flip] Card ${l.protocol}-${l.value} no longer exists after on_flip effect`),f;const h=f.actionRequired&&"actor"in f.actionRequired?f.actionRequired.actor:f.turn,y=h==="player"?"Player":"Opponent",g=c==="player"?"Player's":"Opponent's",v=l.isFaceUp?"face-down":"face-up",w=`${l.protocol}-${l.value}`;f=$(f,h,`${y} flips ${g} ${w} ${v}.`);const C={...f.stats[h],cardsFlipped:f.stats[h].cardsFlipped+1},x={...f[h],stats:C};return f={...f,[h]:x,stats:{...f.stats,[h]:C}},f=Wt(new Set([o]),f),f.animationState={type:"flipCard",cardId:o},f.actionRequired=a,f}function sn(t,o,a){var s;const i=t[o].lanes[a];if(i.length===0)return{newState:t};const l=i[i.length-1],c=dn(t,l.id);if(l.isFaceUp&&c){const f=`${l.id}-${a}`;if((s=t.processedUncoverEventIds)!=null&&s.includes(f))return{newState:t};const p=`${l.protocol}-${l.value}`;let h=Ie(t,p);h=Ye(h,"uncover"),h=$(h,o,`${l.protocol}-${l.value} is uncovered and its effects are re-triggered.`),h=Co(h),h.processedUncoverEventIds=[...h.processedUncoverEventIds||[],f];const y={cardOwner:o,actor:o,currentTurn:h.turn,opponent:o==="player"?"opponent":"player",triggerType:"uncover"},g=sl(l,a,h,y);if(g.newState.actionRequired||(g.newState=jn(g.newState),g.newState=Ie(g.newState,void 0),g.newState=Ye(g.newState,void 0)),g.newState.actionRequired){g.newState=Ge(g.newState);const v=g.newState.actionRequired.actor;if(t._interruptedTurn&&v===t._interruptedTurn)return g.newState.queuedActions=[...g.newState.queuedActions||[],g.newState.actionRequired],g.newState.actionRequired=null,g;v!==t.turn&&(g.newState._interruptedTurn=t.turn,g.newState._interruptedPhase=t.phase,g.newState.turn=v,g.newState.actionRequired.type==="prompt_rearrange_protocols"&&(g.newState.actionRequired={...g.newState.actionRequired,originalAction:{type:"resume_interrupted_turn",interruptedTurn:t.turn,interruptedPhase:t.phase}}))}else g.newState._interruptedTurn&&(g.newState.turn=g.newState._interruptedTurn,g.newState._interruptedTurn=void 0);return g}return{newState:t}}function jc(t,o){const a=fe(t,o);if(!a)return{newState:t};const{card:i,owner:l}=a,c=t[l].lanes.findIndex(b=>b.some(E=>E.id===i.id));if(c===-1)return{newState:t};const s=t[l].lanes[c],f=s.length>0&&s[s.length-1].id===o,p=s.length>1&&!f;let h={...t};const y={...h[l]};y.lanes=y.lanes.map(b=>b.filter(E=>E.id!==o)),y.hand=[...y.hand,{...i,isFaceUp:!0,isRevealed:!1}],h[l]=y;const g=h.actionRequired&&"actor"in h.actionRequired?h.actionRequired.actor:h.turn,v=g==="player"?"Player":"Opponent",w=l==="player"?"Player's":"Opponent's",C=`${i.protocol}-${i.value}`;h=$(h,g,`${v} returns ${w} ${C} to their hand.`),h=Ge(h),h.actionRequired=null;const x=Ee(h);return(f||p)&&x[l].lanes[c].length>0?sn(x,l,c):{newState:x}}function Ln(t,o,a,i,l){var ne;console.log("[DEBUG internalShiftCard] Attempting to shift card",o,"to lane",i,"owner:",a);const c=fe(t,o);if(!c||c.owner!==a)return{newState:t};const{card:s}=c,f=t[a];let p=-1;for(let z=0;z<f.lanes.length;z++)if(f.lanes[z].some(F=>F.id===o)){p=z;break}if(p===-1)return{newState:t};console.log("[DEBUG internalShiftCard] Shifting from lane",p,"to lane",i);const h=kc(t,p,i);if(!h.allowed)return console.log(`[SHIFT BLOCKED] ${h.reason}`),{newState:t};const y=t[a].lanes[p],g=y.length>0&&y[y.length-1].id===o,v=f.lanes.map((z,F)=>F===p?z.filter(B=>B.id!==o):z),w=v[i].length>0?v[i][v[i].length-1]:null;console.log("[DEBUG internalShiftCard] Card to be covered:",w?`${w.protocol}-${w.value} (faceUp: ${w.isFaceUp})`:"null"),console.log("[DEBUG internalShiftCard] Target lane has",v[i].length,"cards before shift");const C=v.map((z,F)=>F===i?[...z,s]:z),x={...f,lanes:C};let b={...t,[a]:x};(!t._currentEffectSource||!t._currentPhaseContext)&&(b=Ie(b,void 0),b=Ye(b,void 0));const E=l==="player"?"Player":"Opponent",S=a==="player"?"Player's":"Opponent's",j=s.isFaceUp?`${s.protocol}-${s.value}`:"a card",R=b[a].protocols[i];b=$(b,l,`${E} shifts ${S} ${j} to Protocol ${R}.`);const A={...b.stats[l],cardsShifted:b.stats[l].cardsShifted+1},N={...b[l],stats:A};b={...b,[l]:N,stats:{...b.stats,[l]:A}},b=Ge(b),b.actionRequired=null;let I=Ee(b),V={newState:I};if(w){console.log("[DEBUG internalShiftCard] Executing on-cover effect for",`${w.protocol}-${w.value}`),console.log("[DEBUG internalShiftCard] cardToBeCovered has customEffects?",!!w.customEffects),w.customEffects&&console.log("[DEBUG internalShiftCard] bottomEffects:",JSON.stringify(w.customEffects.bottomEffects));const z={cardOwner:a,actor:l,currentTurn:I.turn,opponent:a==="player"?"opponent":"player",triggerType:"cover"};V=pa(w,i,I,z),console.log("[DEBUG internalShiftCard] After executeOnCoverEffect, actionRequired:",((ne=V.newState.actionRequired)==null?void 0:ne.type)||"null")}let L=V.newState,D=[...V.animationRequests||[]];if(g){const z=sn(L,a,p);L=z.newState,z.animationRequests&&D.push(...z.animationRequests)}const O=L[a].lanes[i],H=O.length>0&&O[O.length-1].id===o,te=!g;if(H&&s.isFaceUp&&te){const z=sn(L,a,i);return z.animationRequests&&D.push(...z.animationRequests),{newState:z.newState,animationRequests:D.length>0?D:void 0}}return{newState:L,animationRequests:D.length>0?D:void 0}}const x0=(t,o,a)=>{let i=0;for(const l of["player","opponent"])for(let c=0;c<t[l].lanes.length;c++){const s=t[l].lanes[c];if(s.length>0){const f=s[s.length-1];o.includes(f.id)||i++}}return i},wo=(t,o)=>{const a=fe(t,o);if(!a)return{newState:t};const{card:i,owner:l}=a,c=t[l].lanes.findIndex(p=>p.some(h=>h.id===i.id));if(c===-1)return{newState:t};const s={cardOwner:l,actor:l,currentTurn:t.turn,opponent:l==="player"?"opponent":"player",triggerType:"flip"},f=sl(i,c,t,s);if(f.newState.actionRequired){f.newState=Ge(f.newState);const p=f.newState.actionRequired.actor;if(t._interruptedTurn&&p===t._interruptedTurn)return f.newState.queuedActions=[...f.newState.queuedActions||[],f.newState.actionRequired],f.newState=Ge(f.newState),f.newState.actionRequired=null,f;p!==t.turn&&(f.newState._interruptedTurn=t.turn,f.newState._interruptedPhase=t.phase,f.newState.turn=p,f.newState.actionRequired.type==="prompt_rearrange_protocols"&&(f.newState.actionRequired={...f.newState.actionRequired,originalAction:{type:"resume_interrupted_turn",interruptedTurn:t.turn,interruptedPhase:t.phase}}))}return f};function Tc(t,o){const a=[];if(t[o].lanes.forEach((l,c)=>{if(l.length>0){const s=l[l.length-1],f=Et(s,l);a.push({card:s,laneIndex:c,owner:o,value:f})}}),a.length===0)return[];const i=Math.max(...a.map(l=>l.value));return a.filter(l=>l.value===i)}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function hn(t,o,a,i,l,c){const s=l.params,f=s.action,p=fe(a,t.id);if(!p)return{newState:a};if(!p.card.isFaceUp)return{newState:a};const h=l.position||"middle",g=l.trigger==="on_cover";if(h!=="top"&&!g&&!dn(a,t.id))return{newState:a};const w=f==="reveal"&&s.source==="board";if(s.optional===!0&&!w){console.log(`[Custom Effect] Optional effect detected (${f}) - creating prompt`);let x={...a};return x.actionRequired={type:"prompt_optional_effect",actor:i.cardOwner,sourceCardId:t.id,effectDef:l,laneIndex:o},{newState:x}}let C;switch(f){case"refresh":{const x=i.actor,b=a[x].hand.length,E=Math.max(0,5-b);if(E>0){const{drawnCards:S,remainingDeck:j,newDiscard:R}=on(a[x].deck,a[x].discard,E);let A={...a,[x]:{...a[x],hand:[...a[x].hand,...S],deck:j,discard:R}};A=$(A,x,`[Refresh] Drew ${S.length} cards to reach hand size 5.`),A=Ct(A,"after_draw",{player:x,count:S.length}).newState,C={newState:A}}else C={newState:$(a,x,`[Refresh] Hand already at ${b} cards, no draw needed.`)};break}case"mutual_draw":{const x=i.actor,b=x==="player"?"opponent":"player",E=s.count||1;let S={...a};if(S[b].deck.length>0){const{drawnCards:j,remainingDeck:R,newDiscard:A}=on(S[b].deck,S[b].discard,E);if(j.length>0){const N=j.map(L=>({...L,id:Oe(),isFaceUp:!0}));S={...S,[b]:{...S[b],deck:R,discard:A},[x]:{...S[x],hand:[...S[x].hand,...N]}};const I=x==="player"?"Player":"Opponent",V=b==="player"?"Player":"Opponent";S=$(S,x,`${I} drew ${j.length} card(s) from ${V}'s deck.`)}}if(S[x].deck.length>0){const{drawnCards:j,remainingDeck:R,newDiscard:A}=on(S[x].deck,S[x].discard,E);if(j.length>0){const N=j.map(L=>({...L,id:Oe(),isFaceUp:!0}));S={...S,[x]:{...S[x],deck:R,discard:A},[b]:{...S[b],hand:[...S[b].hand,...N]}};const I=b==="player"?"Player":"Opponent",V=x==="player"?"Player":"Opponent";S=$(S,b,`${I} drew ${j.length} card(s) from ${V}'s deck.`)}}C={newState:S};break}case"draw":C=S0(t,o,a,i,s);break;case"flip":C=b0(t,o,a,i,s);break;case"delete":C=E0(t,o,a,i,s);break;case"discard":C=R0(t,o,a,i,s);break;case"shift":C=A0(t,o,a,i,s);break;case"return":C=j0(t,o,a,i,s);break;case"play":C=k0(t,o,a,i,s);break;case"rearrange_protocols":case"swap_protocols":C=D0(t,o,a,i,s);break;case"reveal":case"give":C=T0(t,o,a,i,s);break;case"take":C=F0(t,o,a,i,s);break;case"choice":C=q0(t,o,a,i,s);break;default:console.error(`[Custom Effect] Unknown action: ${f}`),C={newState:a};break}if(l.conditional&&l.conditional.thenEffect){const{newState:x}=C;if(console.log("[Custom Effect] Effect has conditional follow-up:",l.id,"Conditional type:",l.conditional.type,"Action created?",!!x.actionRequired),x.actionRequired)console.log("[Custom Effect] Storing follow-up effect for later execution:",l.conditional.thenEffect.id),C={newState:{...x,actionRequired:{...x.actionRequired,followUpEffect:l.conditional.thenEffect,conditionalType:l.conditional.type}}};else{console.log("[Custom Effect] Executing conditional follow-up effect immediately");let b=i;const E=x._discardContext;E&&(b={...i,discardedCount:E.discardedCount,previousHandSize:E.previousHandSize},delete x._discardContext,console.log("[Custom Effect] Propagated discard context:",b)),C=hn(t,o,x,b,l.conditional.thenEffect)}}return C}function S0(t,o,a,i,l){var C,x,b,E;const{cardOwner:c}=i,f=(l.target||"self")==="opponent"?i.opponent:c;if(l.conditional){let S=0;switch(l.conditional.type){case"non_matching_protocols":{for(let L=0;L<3;L++){const D=a.player.protocols[L],O=a.opponent.protocols[L],H=a.player.lanes[L].filter(F=>F.isFaceUp),te=a.opponent.lanes[L].filter(F=>F.isFaceUp);[...H,...te].some(F=>F.protocol!==D&&F.protocol!==O)&&S++}console.log(`[Draw Effect] non_matching_protocols: ${S} lanes have non-matching face-up cards`);break}case"count_face_down":{let L=0;for(const D of["player","opponent"])for(const O of a[D].lanes)L+=O.filter(H=>!H.isFaceUp).length;S=L,console.log(`[Draw Effect] count_face_down: ${S} face-down cards on entire board`);break}case"is_covering":{const L=a[c].lanes[o],D=L.length>1;S=D?l.count||1:0,console.log(`[Draw Effect] is_covering: ${D?"yes":"no"} (lane has ${L.length} cards)`);break}}let j=S;if(j<=0)return console.log(`[Draw Effect] Conditional count is ${j}, skipping draw`),{newState:a};const{drawnCards:R,remainingDeck:A}=yh(a[f].deck,a[f].hand,j);let N={...a};N[f]={...N[f],deck:A,hand:R},N=$(N,f,`${f==="player"?"Player":"Opponent"} draws ${j} card${j!==1?"s":""} from non-matching protocols.`),j>0&&(N=Ct(N,"after_draw",{player:f}).newState);const V=j>0?[{type:"draw",player:f,count:j}]:void 0;return{newState:N,animationRequests:V}}let p=l.count||1;switch(l.countType||"fixed"){case"equal_to_card_value":{const S=a.lastCustomEffectTargetCardId;if(console.log("[Draw Effect - Light-0 DEBUG] Starting equal_to_card_value check"),console.log(`[Draw Effect - Light-0 DEBUG] lastCustomEffectTargetCardId: ${S}`),console.log("[Draw Effect - Light-0 DEBUG] Full state keys:",Object.keys(a)),console.log("[Draw Effect - Light-0 DEBUG] actionRequired:",(C=a.actionRequired)==null?void 0:C.type),S){const j=fe(a,S);if(console.log("[Draw Effect - Light-0 DEBUG] findCardOnBoard result:",j?`${j.card.protocol}-${j.card.value}`:"null"),j){const R=j.owner,A=a[R].lanes.find(N=>N.some(I=>I.id===S))||[];p=Et(j.card,A),console.log(`[Draw Effect] Using referenced card value: ${p} from card ${j.card.protocol}-${j.card.value}`)}else{p=0;let R=$(a,c,"Cannot draw cards - referenced card is no longer on board (was returned/deleted).");return console.log("[Draw Effect] Referenced card not found on board - was likely returned/deleted by its own effect. Skipping draw."),{newState:R}}}else p=i.referencedCardValue||0,console.log(`[Draw Effect - Light-0 DEBUG] No lastCustomEffectTargetCardId, using context.referencedCardValue: ${p}`);break}case"equal_to_discarded":p=(i.discardedCount||0)+(l.countOffset||0),console.log(`[Draw Effect] Using discarded count: ${i.discardedCount} + offset ${l.countOffset} = ${p}`);break;case"hand_size":case"previous_hand_size":p=i.previousHandSize||i.handSize||0,console.log(`[Draw Effect] Using previous hand size: ${p}`);break;case"count_face_down":{let S=0;for(const j of["player","opponent"])for(const R of a[j].lanes)S+=R.filter(A=>!A.isFaceUp).length;p=S*(l.count||1),console.log(`[Draw Effect] count_face_down: ${S} face-down cards on board, drawing ${p} cards`);break}case"fixed":default:p=l.count||1;break}if(p<=0)return console.log(`[Draw Effect] Count is ${p}, skipping draw`),console.log(`[Draw Effect DEBUG] Returning state - turn: ${a.turn}, phase: ${a.phase}, actionRequired: ${((x=a.actionRequired)==null?void 0:x.type)||"null"}`),{newState:a};if(((b=l.advancedConditional)==null?void 0:b.type)==="protocol_match"){const S=l.advancedConditional.protocol,j=a[c].protocols[o];if(j!==S)return console.log(`[Draw Effect] Protocol match failed: card is in ${j} lane, requires ${S}. Skipping draw.`),{newState:a};console.log(`[Draw Effect] Protocol match success: card is in ${j} lane (requires ${S}).`)}let y={...a};if(((E=l.advancedConditional)==null?void 0:E.type)==="compile_block"){const S=l.advancedConditional.turnDuration||1,j=c==="player"?"opponent":"player";y={...y,compileBlockedUntilTurn:(y.turnNumber||0)+S,compileBlockedPlayer:j},console.log(`[Draw Effect] Opponent's compile blocked for ${S} turn(s).`),y=$(y,c,`Opponent can't compile for ${S} turn${S!==1?"s":""}.`)}if(l.optional)return y.actionRequired={type:"prompt_optional_draw",sourceCardId:t.id,actor:c,count:p,drawingPlayer:f},{newState:y};const{drawnCards:g,remainingDeck:v}=yh(y[f].deck,y[f].hand,p);return y[f]={...y[f],deck:v,hand:g},y=$(y,f,`${f==="player"?"Player":"Opponent"} draws ${p} card${p!==1?"s":""}.`),g.length>0&&(y=Ct(y,"after_draw",{player:f,count:g.length}).newState),{newState:y}}function b0(t,o,a,i,l){var w;const{cardOwner:c}=i;if(console.log("[DEBUG executeFlipEffect] Called with params:",JSON.stringify(l)),console.log("[DEBUG executeFlipEffect] card:",`${t.protocol}-${t.value}`,"laneIndex:",o,"cardOwner:",c),l.useCardFromPreviousEffect&&a.lastCustomEffectTargetCardId){const C=a.lastCustomEffectTargetCardId,x=fe(a,C);if(!x)return{newState:$(a,c,"Target card from previous effect no longer exists. Flip skipped.")};let b={...a};const E=x.owner,S=b[E].lanes.findIndex(j=>j.some(R=>R.id===C));if(S!==-1){const R=b[E].lanes[S].find(A=>A.id===C);if(R){R.isFaceUp=!R.isFaceUp;const A=R.isFaceUp?"face-up":"face-down";b=$(b,c,`Flips that card ${A}.`)}}return{newState:b}}if(l.scope==="each_lane"){const C=l.targetFilter||{},x=Dt(a),b=A=>{const N=a.player.lanes[A],I=a.opponent.lanes[A];let V=[];if(C.position==="covered"?V=[...N.filter((D,O)=>O<N.length-1),...I.filter((D,O)=>O<I.length-1)]:V=[...N,...I],C.owner==="own")V=V.filter(D=>N.includes(D)&&c==="player"||I.includes(D)&&c==="opponent");else if(C.owner==="opponent"){const D=c==="player"?"opponent":"player";V=V.filter(O=>N.includes(O)&&D==="player"||I.includes(O)&&D==="opponent")}return C.excludeSelf&&(V=V.filter(D=>D.id!==t.id)),(x?V.filter(D=>D.isFaceUp):V).length>0},E=[0,1,2].filter(A=>b(A));if(E.length===0)return{newState:$(a,c,x?"No valid face-up targets to flip (Frost-1 is active).":"No valid targets to flip in any lane.")};const S=E[0],j=E.slice(1);let R={...a};return R.actionRequired={type:"select_card_to_flip",sourceCardId:t.id,actor:c,currentLaneIndex:S,remainingLanes:j,targetFilter:l.targetFilter,params:l},{newState:R}}if(l.flipSelf){if(console.log("[DEBUG executeFlipEffect] flipSelf mode - card:",`${t.protocol}-${t.value}`,"laneIndex:",o,"cardOwner:",c),console.log("[DEBUG executeFlipEffect] Lanes:",a[c].lanes.map((E,S)=>`Lane ${S}: ${E.map(j=>j.id.substring(0,8)).join(", ")}`)),console.log("[DEBUG executeFlipEffect] Looking for card.id:",t.id),((w=l.advancedConditional)==null?void 0:w.type)==="protocol_match"){const E=l.advancedConditional.protocol,S=a[c].protocols[o];if(S!==E)return console.log(`[Flip Effect] Protocol match failed: card is in ${S} lane, requires ${E}. Skipping flip.`),{newState:a};console.log(`[Flip Effect] Protocol match success: card is in ${S} lane (requires ${E}).`)}let C={...a};const x=C[c].lanes[o],b=x.find(E=>E.id===t.id);if(console.log("[DEBUG executeFlipEffect] cardInLane found?",!!b,"lane length:",x.length),b){b.isFaceUp=!b.isFaceUp;const E=c==="player"?"Player":"Opponent",S=b.isFaceUp?"face-up":"face-down";C=$(C,c,`${E} flips this card ${S}.`),console.log("[DEBUG executeFlipEffect] Flipped card to",S)}else console.log("[DEBUG executeFlipEffect] Card NOT found in lane! Lane cards:",x.map(E=>E.id));return{newState:C}}const s=l.count||1;if(l.scope==="this_lane"&&(s==="all"||typeof s!="number")){let C={...a};const x=c==="player"?"opponent":"player",b=l.targetFilter||{},E=Dt(a),S=new Set,j=C[c].lanes[o];for(const A of j)b.excludeSelf&&A.id===t.id||b.faceState==="face_up"&&!A.isFaceUp||b.faceState==="face_down"&&A.isFaceUp||b.owner!=="opponent"&&(E&&!A.isFaceUp||S.add(A.id));const R=C[x].lanes[o];for(const A of R)b.faceState==="face_up"&&!A.isFaceUp||b.faceState==="face_down"&&A.isFaceUp||b.owner!=="own"&&(E&&!A.isFaceUp||S.add(A.id));if(S.size>0){C=$(C,c,`Flipping ${S.size} card(s) in this lane.`);for(const A of S)for(const N of["player","opponent"])for(const I of C[N].lanes){const V=I.find(L=>L.id===A);V&&(V.isFaceUp=!V.isFaceUp)}return{newState:C}}else return C=$(C,c,"No cards to flip in this lane."),{newState:C}}const p=l.targetFilter||{},h=p.position||"uncovered",y=Dt(a),g=[];for(const C of["player","opponent"])for(let x=0;x<a[C].lanes.length;x++){const b=a[C].lanes[x];if(!(l.scope==="this_lane"&&x!==o))for(let E=0;E<b.length;E++){const S=b[E],j=E===b.length-1;p.excludeSelf&&S.id===t.id||p.owner==="own"&&C!==c||p.owner==="opponent"&&C===c||h==="uncovered"&&!j||h==="covered"&&j||p.faceState==="face_up"&&!S.isFaceUp||p.faceState==="face_down"&&S.isFaceUp||y&&!S.isFaceUp||g.push(S.id)}}if(g.length===0)return{newState:$(a,c,"No valid cards to flip. Effect skipped.")};let v=$(a,c,`[Custom Flip effect - selecting ${s} card(s) to flip]`);return v.actionRequired={type:"select_card_to_flip",count:s,sourceCardId:t.id,actor:c,targetFilter:l.targetFilter,optional:l.optional||!1,scope:l.scope,laneIndex:l.scope==="this_lane"?o:void 0},{newState:v}}function E0(t,o,a,i,l){var x,b,E,S,j;const{cardOwner:c}=i;let s=l.count||1;if(l.useCardFromPreviousEffect&&a.lastCustomEffectTargetCardId){const R=a.lastCustomEffectTargetCardId,A=fe(a,R);if(!A)return{newState:$(a,c,"Target card from previous effect no longer exists. Delete skipped.")};let N={...a};const I=A.owner,V=N[I].lanes.findIndex(L=>L.some(D=>D.id===R));if(V!==-1){const L=[...N[I].lanes[V]],D=L.findIndex(O=>O.id===R);if(D!==-1){const O=D===L.length-1;L.splice(D,1);const H=[...N[I].lanes];H[V]=L,N={...N,[I]:{...N[I],lanes:H}};const te=A.card.isFaceUp?`${A.card.protocol}-${A.card.value}`:"that card";N=$(N,c,`Deletes ${te}.`);const ne={...N.stats[c],cardsDeleted:N.stats[c].cardsDeleted+1};return N={...N,stats:{...N.stats,[c]:ne}},O&&L.length>0&&(N=sn(N,I,V).newState),{newState:N,animationRequests:[{type:"delete",cardId:R,owner:I}]}}}return{newState:N}}if((x=l.scope)!=null&&x.minCardsInLane){const R=l.scope.minCardsInLane,A=a.lanes[o].length;if(A<R)return console.log(`[Delete Effect] Line filter not met: ${A} < ${R} cards in lane. Skipping delete.`),{newState:a};console.log(`[Delete Effect] Line filter met: ${A} >= ${R} cards in lane.`)}const f=l.actorChooses||"effect_owner",p=((b=l.targetFilter)==null?void 0:b.owner)||"any";let h=c;f==="card_owner"&&p==="opponent"&&(h=i.opponent);const y=l.targetFilter||{},g=y.position||"uncovered",v=[];for(const R of["player","opponent"])for(let A=0;A<a[R].lanes.length;A++){if(((E=l.scope)==null?void 0:E.type)==="this_line"&&A!==o)continue;const N=a[R].lanes[A];for(let I=0;I<N.length;I++){const V=N[I],L=I===N.length-1;if(!(l.excludeSelf&&V.id===t.id)&&!(y.owner==="own"&&R!==h)&&!(y.owner==="opponent"&&R===h)&&!(g==="uncovered"&&!L)&&!(g==="covered"&&L)){if(g==="covered_by_context"&&i.triggerType==="cover"){if(R!==i.cardOwner&&L)continue}else if(g==="covered_by_context"&&L)continue;if(!(y.faceState==="face_up"&&!V.isFaceUp)&&!(y.faceState==="face_down"&&V.isFaceUp)){if(y.valueRange){const{min:D,max:O}=y.valueRange;if(V.value<D||V.value>O)continue}if(l.protocolMatching){const D=a.player.protocols[A],O=a.opponent.protocols[A],H=V.protocol,te=H===D||H===O;if(l.protocolMatching==="must_match"&&!te||l.protocolMatching==="must_not_match"&&te)continue}v.push(V.id)}}}}if(v.length===0)return{newState:$(a,c,"No valid cards to delete. Effect skipped.")};if(l.upTo){const R=s;if(s=Math.min(s,v.length),console.log(`[Delete Effect] upTo mode: requesting ${R}, adjusted to ${s} (available targets: ${v.length})`),s===0)return{newState:$(a,c,"No valid targets available. Delete effect skipped.")}}let w=v;if(y.calculation==="highest_value"||y.calculation==="lowest_value"){const R=new Map;for(const I of v){const V=fe(a,I);if(!V)continue;let L=-1;for(let O=0;O<a[V.owner].lanes.length;O++)if(a[V.owner].lanes[O].some(H=>H.id===I)){L=O;break}let D=V.card.value;!V.card.isFaceUp&&L!==-1&&(D=a[V.owner].lanes[L].some(H=>H.isFaceUp&&H.protocol==="Darkness"&&H.value===2)?4:2),R.set(I,D)}const A=Array.from(R.values()),N=y.calculation==="highest_value"?Math.max(...A):Math.min(...A);w=v.filter(I=>R.get(I)===N),console.log(`[Delete Effect] Filtered by ${y.calculation}: ${w.length} card(s) with value ${N}`)}if(l.autoExecute){console.log(`[Delete Effect] Auto-executing delete for ${w.length} card(s)`);const R=w.slice(0,s);let A=a;const N=[];for(const I of R){const V=fe(A,I);if(!V)continue;const{card:L,owner:D}=V;let O=-1;for(let U=0;U<A[D].lanes.length;U++)if(A[D].lanes[U].some(P=>P.id===I)){O=U;break}if(O===-1)continue;const H=A[D].lanes[O],te=H[H.length-1].id===I,ne=L.isFaceUp?`${L.protocol}-${L.value}`:"a face-down card";A=$(A,c,`Effect triggers, deleting the lowest value covered card (${D==="player"?"Player's":"Opponent's"} ${ne}).`);const F=[...H],B=F.findIndex(U=>U.id===I);F.splice(B,1);const W=[...A[D].lanes];W[O]=F,A={...A,[D]:{...A[D],lanes:W}};const _e={...A.stats[c],cardsDeleted:A.stats[c].cardsDeleted+1};A={...A,stats:{...A.stats,[c]:_e}},N.push({type:"delete",cardId:I,owner:D}),te&&F.length>0&&(A=sn(A,D,O).newState)}return{newState:A,animationRequests:N}}let C={...a};if(l.deleteSelf){console.log(`[deleteSelf] Trying to delete card ${t.protocol}-${t.value} (id: ${t.id}), laneIndex from params: ${o}`);const R=c,A=a[R].lanes[o];if(console.log(`[deleteSelf] owner=${R}, laneIndex=${o}, lane.length=${A==null?void 0:A.length}`),!A||A.length===0)return console.log(`[deleteSelf] Lane is ${A?"empty":"null"}! Skipping delete.`),C=$(C,c,"Card already deleted. Delete effect skipped."),{newState:C};const N=A.findIndex(ne=>ne.id===t.id);if(N===-1)return console.log(`[deleteSelf] Card not found in lane ${o}!`),C=$(C,c,"Card already deleted. Delete effect skipped."),{newState:C};const I=a[R].lanes[o],V=I.length>0&&I[I.length-1].id===t.id;console.log(`[deleteSelf] Card is ${V?"TOP":"COVERED"} card in CURRENT lane (length=${I.length}), cardIndex=${N}`),C=$(C,c,`Deleting ${t.protocol}-${t.value}.`);const L=[...I],D=L.findIndex(ne=>ne.id===t.id);if(D===-1)return console.log("[deleteSelf] Card no longer in lane! Already deleted or moved."),{newState:C};console.log(`[deleteSelf] Removing card at index ${D} from lane`),L.splice(D,1);const O=[...C[R].lanes];O[o]=L,C={...C,[R]:{...C[R],lanes:O}};const H={...C.stats[c],cardsDeleted:C.stats[c].cardsDeleted+1};C={...C,stats:{...C.stats,[c]:H}};const te=[{type:"delete",cardId:t.id,owner:R}];if(V&&L.length>0&&i.triggerType!=="cover"){const ne=sn(C,R,o);C=ne.newState,ne.animationRequests&&te.push(...ne.animationRequests)}return{newState:C,animationRequests:te}}if(l.selectLane)return C.actionRequired={type:"select_lane_for_delete",sourceCardId:t.id,actor:h,count:l.count,targetFilter:l.targetFilter,deleteAll:l.count==="all"||l.count===void 0},{newState:C};if(((S=l.scope)==null?void 0:S.type)==="each_lane"){const R=V=>{for(const L of["player","opponent"]){const D=a[L].lanes[V];for(let O=0;O<D.length;O++){const H=D[O],te=O===D.length-1;if(!(l.excludeSelf&&H.id===t.id)&&!(y.owner==="own"&&L!==h)&&!(y.owner==="opponent"&&L===h)&&!(g==="uncovered"&&!te)&&!(g==="covered"&&te)&&!(y.faceState==="face_up"&&!H.isFaceUp)&&!(y.faceState==="face_down"&&H.isFaceUp))return!0}}return!1},A=[0,1,2].filter(V=>R(V));if(A.length===0)return C=$(C,c,"No valid targets to delete in any lane."),{newState:C};const N=A[0],I=A.slice(1);return C.actionRequired={type:"select_cards_to_delete",count:s,sourceCardId:t.id,actor:h,currentLaneIndex:N,remainingLanes:I,disallowedIds:l.excludeSelf?[t.id]:[],targetFilter:l.targetFilter,scope:l.scope,protocolMatching:l.protocolMatching,params:l},{newState:C}}if(((j=l.scope)==null?void 0:j.type)==="each_other_line"){const N=[0,1,2].filter(I=>I!==o).filter(I=>a.player.lanes[I].length>0||a.opponent.lanes[I].length>0).length;return N===0?(C=$(C,c,"No other lanes have cards. Effect skipped."),{newState:C}):(C.actionRequired={type:"select_card_from_other_lanes_to_delete",sourceCardId:t.id,disallowedLaneIndex:o,lanesSelected:[],count:N,actor:h,targetFilter:l.targetFilter},{newState:C})}return C.actionRequired={type:"select_cards_to_delete",count:s,sourceCardId:t.id,actor:h,disallowedIds:l.excludeSelf?[t.id]:[],allowedIds:w.length<v.length?w:void 0,targetFilter:l.targetFilter,scope:l.scope,protocolMatching:l.protocolMatching},{newState:C}}function R0(t,o,a,i,l){const{cardOwner:c}=i,s=l.actor==="opponent"?i.opponent:c;let f=l.count||1;if((l.countType||"fixed")==="equal_to_discarded"&&(f=(i.discardedCount||0)+(l.countOffset||0),console.log(`[Discard Effect] Using dynamic count: ${i.discardedCount} + ${l.countOffset} = ${f}`),f<=0))return console.log("[Discard Effect] Dynamic count is 0 or less, skipping discard."),{newState:a};if(a[s].hand.length===0)return console.log(`[Discard Effect] ${s} has no cards to discard - skipping effect.`),{newState:a};if(l.upTo){const y=f;f=Math.min(f,a[s].hand.length),console.log(`[Discard Effect] upTo mode: requesting ${y}, adjusted to ${f} (hand size: ${a[s].hand.length})`)}if(f==="all"){console.log(`[Discard Effect] Auto-discarding entire hand for ${s}`);const y=a[s].hand,g=y.map(({id:S,isFaceUp:j,...R})=>R),v=[],w=[...a[s].discard,...g],C={...a[s].stats,cardsDiscarded:a[s].stats.cardsDiscarded+g.length},x={...a[s],hand:v,discard:w,stats:C};let b={...a,[s]:x,stats:{...a.stats,[s]:C}};const E=s==="player"?"Player":"Opponent";if(s==="player"||g.every(S=>S.isRevealed)){const S=g.map(j=>`${j.protocol}-${j.value}`).join(", ");b=$(b,s,`${E} discards entire hand (${g.length} cards: ${S}).`)}else b=$(b,s,`${E} discards entire hand (${g.length} cards).`);return b._discardContext={actor:s,discardedCount:g.length,previousHandSize:y.length,sourceCardId:t.id},{newState:b}}let h={...a};return h.actionRequired={type:"discard",actor:s,count:f,sourceCardId:t.id,variableCount:l.variableCount||!1,previousHandSize:a[s].hand.length},{newState:h}}function A0(t,o,a,i,l){const{cardOwner:c}=i;let s={...a};if(l.useCardFromPreviousEffect&&a.lastCustomEffectTargetCardId){const N=a.lastCustomEffectTargetCardId,I=fe(a,N);if(!I)return{newState:$(a,c,"Target card from previous effect no longer exists. Shift skipped.")};const V=l.destinationRestriction;if((V==null?void 0:V.type)==="to_this_lane"){const D=V.laneIndex==="current"?o:V.laneIndex;if(D===void 0||D<0||D>2)return console.error(`[Shift Effect] Invalid target lane index: ${D}`),{newState:a};console.log(`[Custom Shift with useCardFromPreviousEffect] Executing immediate shift to lane ${D}`);const O=Ln(a,N,I.owner,D,c);return{newState:O.newState,animationRequests:O.animationRequests}}let L=-1;for(let D=0;D<a[I.owner].lanes.length;D++)if(a[I.owner].lanes[D].some(O=>O.id===N)){L=D;break}return L===-1?{newState:a}:(s.actionRequired={type:"select_lane_for_shift",cardToShiftId:N,cardOwner:I.owner,originalLaneIndex:L,sourceCardId:t.id,actor:c,destinationRestriction:V},{newState:s})}const f=a._selectedCardFromPreviousEffect;if(f){delete s._selectedCardFromPreviousEffect;const N=l.destinationRestriction;if((N==null?void 0:N.type)==="to_this_lane"){const I=N.laneIndex==="current"?o:N.laneIndex;if(I===void 0||I<0||I>2)return console.error(`[Shift Effect] Invalid target lane index: ${I}`),{newState:s};const V=fe(s,f);if(!V)return console.error(`[Shift Effect] Selected card not found: ${f}`),{newState:s};console.log(`[Custom Shift] Executing immediate shift to lane ${I}`);const L=Ln(s,f,V.owner,I,c);return{newState:L.newState,animationRequests:L.animationRequests}}return s.actionRequired={type:"shift_flipped_card_optional",cardId:f,sourceCardId:t.id,optional:l.optional||!1,actor:c},{newState:s}}const p=l.targetFilter||{},h=p.position||"uncovered",y=p.faceState||"any",g=p.owner||"any",v=p.excludeSelf||!1,w=l.count||1;if(!(h==="covered"||h==="uncovered"||y!=="any"||v)&&w===1&&g==="own")return s=$(s,c,"[Custom Shift effect - selecting destination lane for this card]"),s.actionRequired={type:"shift_flipped_card_optional",cardId:t.id,sourceCardId:t.id,optional:l.optional||!1,actor:c},{newState:s};const x=[];for(const N of["player","opponent"])if(!(g==="own"&&N!==c)&&!(g==="opponent"&&N===c))for(let I=0;I<s[N].lanes.length;I++){if(l.scope==="this_lane"&&I!==o)continue;const V=s[N].lanes[I];for(let L=0;L<V.length;L++){const D=V[L];if(v&&D.id===t.id)continue;const O=L===V.length-1;h==="uncovered"&&!O||h==="covered"&&O||y==="face_up"&&!D.isFaceUp||y==="face_down"&&D.isFaceUp||x.push({card:D,currentLane:I,owner:N})}}if(x.length===0)return s=$(s,c,"[Custom Shift] No valid cards to shift."),{newState:s};if((w==="all"||typeof w!="number"&&w!==1)&&x.length>0){const N=[],I=l.destinationRestriction;for(let V=0;V<3;V++){if((I==null?void 0:I.type)==="to_another_line"){if(V===o)continue}else if((I==null?void 0:I.type)==="to_this_lane"){const L=I.laneIndex==="current"?o:I.laneIndex;if(V!==L)continue}else if(!I&&V===o)continue;N.push(V)}return N.length===0?(s=$(s,c,"[Custom Shift] No valid destination lanes for shifting all cards."),{newState:s}):(s=$(s,c,`Shifting ${x.length} card(s) from this lane.`),s.actionRequired={type:"select_lane_for_shift_all",sourceCardId:t.id,actor:c,cardsToShift:x.map(V=>({cardId:V.card.id,owner:V.owner})),validDestinationLanes:N,sourceLaneIndex:o},{newState:s})}const E=l.destinationRestriction;let S=!1;const j=(E==null?void 0:E.laneIndex)==="current"?o:E==null?void 0:E.laneIndex;for(const{card:N,currentLane:I,owner:V}of x){if((E==null?void 0:E.type)==="non_matching_protocol"&&!N.isFaceUp)continue;const L=N.protocol;for(let D=0;D<3;D++){if(E){if(E.type==="non_matching_protocol"){if(D===I)continue;const O=s.player.protocols[D],H=s.opponent.protocols[D];if(L===O||L===H)continue}else if(E.type==="specific_lane"){if(D!==I)continue}else if(E.type==="to_this_lane"){if(D!==j||I===j)continue}else if(E.type==="to_another_line"&&D===I)continue}else if(D===I)continue;S=!0;break}if(S)break}if(!S)return s=$(s,c,"[Custom Shift] No valid shift destinations available."),{newState:s};s=$(s,c,"[Custom Shift effect - selecting card to shift]");const R=E&&j!==void 0?{...E,laneIndex:j}:E,A=(E==null?void 0:E.type)==="to_this_lane"&&j!==void 0?j:void 0;return s.actionRequired={type:"select_card_to_shift",sourceCardId:t.id,actor:c,targetFilter:l.targetFilter,destinationRestriction:R,sourceLaneIndex:o,targetLaneIndex:A},{newState:s}}function j0(t,o,a,i,l){var g;const{cardOwner:c,opponent:s}=i,f=l.count==="all"?99:l.count||1,p=((g=l.targetFilter)==null?void 0:g.owner)||"any";if(l.selectLane){let v=$(a,c,"[Custom Return effect - selecting lane to return cards]");return v.actionRequired={type:"select_lane_for_return",sourceCardId:t.id,actor:c,count:l.count,targetFilter:l.targetFilter},{newState:v}}let h=[];if(p==="own"?h=a[c].lanes.flat():p==="opponent"?h=a[s].lanes.flat():h=[...a.player.lanes.flat(),...a.opponent.lanes.flat()],h.length===0)return{newState:$(a,c,"No cards on board to return. Effect skipped.")};let y=$(a,c,`[Custom Return effect - selecting ${f} card(s) to return]`);return y.actionRequired={type:"select_card_to_return",sourceCardId:t.id,actor:c,targetOwner:p},{newState:y}}function k0(t,o,a,i,l){var w,C,x,b,E,S,j;const{cardOwner:c,opponent:s}=i,f=l.count||1,p=l.source||"hand",h=l.faceDown||!1,y=l.actor==="opponent"?s:c;if(p==="deck"&&((w=l.destinationRule)==null?void 0:w.type)==="each_other_line"){const R=[0,1,2].filter(z=>z!==o);if(R.length===0)return{newState:a};const A=a[y];if(A.deck.length===0&&A.discard.length===0)return{newState:$(a,c,`[Custom Play effect] ${y} has no cards in deck/discard - skipping.`)};const{drawnCards:N,remainingDeck:I,newDiscard:V}=on(A.deck,A.discard,R.length);if(N.length===0)return{newState:a};const L=N.map(z=>({...z,id:Oe(),isFaceUp:!1})),D=[...A.lanes];for(let z=0;z<L.length;z++){const F=R[z];D[F]=[...D[F],L[z]]}const O={...A,lanes:D,deck:I,discard:V};let H={...a,[y]:O};const te=fe(a,t.id),ne=te?`${te.card.protocol}-${te.card.value}`:"a card effect";return H=$(H,c,`${ne}: Plays ${N.length} card(s) face-down in other lines.`),{newState:H}}if(p==="deck"&&((C=l.destinationRule)==null?void 0:C.type)==="each_line_with_card"){const R=l.destinationRule.ownerFilter||"any",A=R==="own"?y:R==="opponent"?y==="player"?"opponent":"player":null,N=[];for(let Z=0;Z<3;Z++)A?a[A].lanes[Z].length>0&&N.push(Z):(a.player.lanes[Z].length>0||a.opponent.lanes[Z].length>0)&&N.push(Z);if(N.length===0)return{newState:a};const I=a[y];if(I.deck.length===0&&I.discard.length===0)return{newState:$(a,c,`[Custom Play effect] ${y} has no cards in deck/discard - skipping.`)};const{drawnCards:V,remainingDeck:L,newDiscard:D}=on(I.deck,I.discard,N.length);if(V.length===0)return{newState:a};const O=V.map(Z=>({...Z,id:Oe(),isFaceUp:!h}));let H=a;const te=[];for(let Z=0;Z<N.length;Z++){const Q=N[Z],pe=H[y].lanes[Q];if(pe.length>0){const Ce=pe[pe.length-1],ve={...i,triggerType:"cover"},ke=pa(Ce,Q,H,ve);if(H=ke.newState,ke.animationRequests&&te.push(...ke.animationRequests),H.actionRequired)break}}const ne=[...H[y].lanes],z=[];for(let Z=0;Z<O.length;Z++){const Q=N[Z];ne[Q]=[...ne[Q],O[Z]],z.push({type:"play",cardId:O[Z].id,owner:y,laneIndex:Q,isFaceUp:O[Z].isFaceUp})}const F={...H[y],lanes:ne,deck:L,discard:D};let B={...H,[y]:F};const W=fe(a,t.id),_e=W?`${W.card.protocol}-${W.card.value}`:"a card effect",U=R==="own"?"where you have a card":R==="opponent"?"where opponent has a card":"with a card";B=$(B,c,`${_e}: Plays ${V.length} card(s) face-down in each line ${U}.`);const P=[...te,...z];return{newState:B,animationRequests:P.length>0?P:void 0}}if(p==="deck"&&((x=l.destinationRule)==null?void 0:x.type)==="another_line"){console.log(`[another_line] Life-3 triggered! laneIndex=${o}, source=${p}`);const R=[0,1,2].filter(N=>N!==o);if(console.log(`[another_line] Other lane indices: ${R}`),R.length===0)return console.log("[another_line] No other lanes available!"),{newState:a};let A=$(a,c,"[Custom Play effect - select another line to play]");return A.actionRequired={type:"select_lane_for_play",sourceCardId:t.id,actor:y,count:l.count||1,isFaceDown:l.faceDown,excludeCurrentLane:!0,currentLaneIndex:o,source:l.source},console.log("[another_line] Created prompt for user to select lane"),{newState:A}}if(p==="deck"&&((b=l.destinationRule)==null?void 0:b.type)==="under_this_card"&&((E=l.condition)==null?void 0:E.type)==="per_x_cards_in_line"){const R=l.condition.cardCount||2,A=a[c].lanes[o].length,N=a[s].lanes[o].length,I=A+N,V=Math.floor(I/R);if(V===0)return{newState:a};const L=a[y];if(L.deck.length===0&&L.discard.length===0)return{newState:a};const{drawnCards:D,remainingDeck:O,newDiscard:H}=on(L.deck,L.discard,V);if(D.length===0)return{newState:a};const te=D.map(U=>({...U,id:Oe(),isFaceUp:!1})),ne=[...L.lanes[o]];ne.splice(ne.length-1,0,...te);const z=[...L.lanes];z[o]=ne;const F={...L,lanes:z,deck:O,discard:H};let B={...a,[y]:F};const W=fe(a,t.id),_e=W?`${W.card.protocol}-${W.card.value}`:"a card effect";return B=$(B,c,`${_e}: Plays ${D.length} card(s) face-down under itself.`),{newState:B}}if(p==="deck"&&((S=l.destinationRule)==null?void 0:S.type)==="specific_lane"){const R=l.destinationRule.laneIndex==="current"?o:l.destinationRule.laneIndex;if(R===void 0||R<0||R>2)return console.error(`[Play Effect] Invalid lane index: ${R}`),{newState:a};const A=a[y];if(A.deck.length===0&&A.discard.length===0)return{newState:$(a,c,`[Custom Play effect] ${y} has no cards in deck/discard - skipping.`)};const{drawnCards:N,remainingDeck:I,newDiscard:V}=on(A.deck,A.discard,f);if(N.length===0)return{newState:a};const L=N.map(W=>({...W,id:Oe(),isFaceUp:!h})),D=[...A.lanes];D[R]=[...D[R],...L];const O={...A,lanes:D,deck:I,discard:V};let H={...a,[y]:O};const te=fe(a,t.id),ne=te?`${te.card.protocol}-${te.card.value}`:"a card effect",z=y==="player"?"Player":"Opponent",F=h?"face-down":"face-up",B=a.player.protocols[R];return H=$(H,c,`${ne}: ${z} plays ${N.length} card(s) ${F} in ${B} line.`),{newState:H}}if(p==="hand"&&a[y].hand.length===0)return console.log(`[Play Effect] ${y} has no cards in hand to play - skipping effect.`),{newState:a};let g=$(a,c,`[Custom Play effect - playing ${f} card(s) ${h?"face-down":"face-up"} from ${p}]`),v;return(j=l.destinationRule)!=null&&j.excludeCurrentLane&&(v=o),g.actionRequired={type:"select_card_from_hand_to_play",count:f,sourceCardId:t.id,actor:y,faceDown:h,source:p,disallowedLaneIndex:v,destinationRule:l.destinationRule,condition:l.condition},{newState:g}}function D0(t,o,a,i,l){const{cardOwner:c,opponent:s}=i,f=l.action,h=(l.target||"own")==="opponent"?s:c,y=c;if(Uc(a)&&f==="rearrange_protocols")return{newState:$(a,c,"Protocols cannot be rearranged (Frost-1 bottom effect is active).")};let v=$(a,c,`[Custom Protocol effect - ${f} for ${h}]`),w;return l.restriction&&(w={laneIndex:l.restriction.laneIndex==="current"?o:l.restriction.laneIndex,protocol:l.restriction.disallowedProtocol}),f==="rearrange_protocols"?v.actionRequired={type:"prompt_rearrange_protocols",actor:y,target:h,sourceCardId:t.id,disallowedProtocolForLane:w}:f==="swap_protocols"&&(v.actionRequired={type:"prompt_swap_protocols",actor:y,target:h,sourceCardId:t.id,disallowedProtocolForLane:w}),{newState:v}}function T0(t,o,a,i,l){const{cardOwner:c,opponent:s}=i,f=l.count||1,p=l.action,h=l.source||"own_hand";if(p==="reveal"&&h==="board"){const g=l.targetFilter||{owner:"any",position:"uncovered",faceState:"face_down"},v=l.followUpAction,w=l.optional!==!1,C=[],x=g.owner==="own"?[c]:g.owner==="opponent"?[s]:[c,s];for(const E of x)for(let S=0;S<a[E].lanes.length;S++){const j=a[E].lanes[S];if(j.length>0){let R=[];g.position==="uncovered"?R=[j[j.length-1]]:g.position==="covered"?R=j.slice(0,-1):R=[...j];const A=R.filter(N=>g.faceState==="face_up"?N.isFaceUp:g.faceState==="face_down"?!N.isFaceUp:!0);C.push(...A)}}if(C.length===0)return{newState:$(a,c,"No valid cards to reveal. Effect skipped.")};let b={...a};return b.actionRequired={type:"select_board_card_to_reveal_custom",sourceCardId:t.id,actor:c,targetFilter:g,followUpAction:v,optional:w},{newState:b}}if(p==="reveal"&&h==="opponent_hand"){let g={...a};const v={...g[s]};if(v.hand.length>0){v.hand=v.hand.map(C=>({...C,isRevealed:!0})),g[s]=v;const w=`${t.protocol}-${t.value}`;g=$(g,c,`${w}: Your opponent reveals their hand.`)}else{const w=`${t.protocol}-${t.value}`;g=$(g,c,`${w}: Opponent has no cards to reveal.`)}return{newState:g}}if(a[c].hand.length===0)return{newState:$(a,c,`No cards in hand to ${p}. Effect skipped.`)};let y=$(a,c,`[Custom ${p} effect - selecting ${f} card(s)]`);return p==="reveal"?y.actionRequired={type:"select_card_from_hand_to_reveal",count:f,sourceCardId:t.id,actor:c}:p==="give"&&(y.actionRequired={type:"select_card_from_hand_to_give",count:f,sourceCardId:t.id,actor:c}),{newState:y}}function F0(t,o,a,i,l){const{cardOwner:c,opponent:s}=i,f=l.count||1,p=l.random!==!1;if(a[s].hand.length===0)return{newState:$(a,c,"Opponent has no cards in hand. Effect skipped.")};let h=$(a,c,`[Custom Take effect - taking ${f} card(s) from opponent's hand]`);return h.actionRequired={type:p?"take_random_from_opponent_hand":"take_from_opponent_hand",count:f,sourceCardId:t.id,actor:c},{newState:h}}function q0(t,o,a,i,l){const{cardOwner:c}=i,s=l.options||[];if(s.length!==2)return console.error(`[Choice Effect] Expected 2 options, got ${s.length}`),{newState:a};let f=$(a,c,"[Custom Choice effect - choose one of two options]");return f.actionRequired={type:"custom_choice",options:s,sourceCardId:t.id,actor:c,laneIndex:o},{newState:f}}function yh(t,o,a){const i=Math.min(a,t.length),l=t.slice(0,i).map(f=>({...f,id:Oe(),isFaceUp:!0})),c=[...o,...l],s=t.slice(i);return{drawnCards:c,remainingDeck:s}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function Ct(t,o,a){let i={...t};if(i._processingReactiveEffects)return console.log(`[Reactive Effects] Already processing reactive effects, skipping ${o}`),{newState:i};i={...i,_processingReactiveEffects:!0};const l=[];for(const c of["player","opponent"])i[c].lanes.forEach((s,f)=>{s.forEach(p=>{if(p.isFaceUp){const h=p;h.customEffects&&h.customEffects.topEffects&&h.customEffects.topEffects.filter(g=>g.trigger===o).length>0&&l.push({card:p,owner:c,laneIndex:f,box:"top"})}})});if(l.length===0)return delete i._processingReactiveEffects,{newState:i};console.log(`[Reactive Effects] Found ${l.length} card(s) with ${o} trigger`);for(const{card:c,owner:s,laneIndex:f}of l){const p=i[s].lanes[f];if(!(p==null?void 0:p.some(E=>E.id===c.id&&E.isFaceUp))){console.log(`[Reactive Effects] Card ${c.protocol}-${c.value} no longer face-up, skipping`);continue}if(o==="before_compile_delete"&&(a==null?void 0:a.cardId)!==c.id||o==="on_flip"&&(a==null?void 0:a.cardId)!==c.id||(o==="on_cover"||o==="on_flip")&&a!=null&&a.cardId&&a.cardId!==c.id)continue;const v=c.customEffects.topEffects.filter(E=>E.trigger===o||E.trigger==="on_cover_or_flip"&&(o==="on_cover"||o==="on_flip")).filter(E=>{const S=E.reactiveTriggerActor||"self";if(!(a!=null&&a.player))return!0;if(S==="self"){if(a.player!==s)return console.log(`[Reactive Effects] Skipping ${c.protocol}-${c.value} ${o} - triggerActor=self, but triggered by ${a.player} (owner: ${s})`),!1}else if(S==="opponent"&&a.player===s)return console.log(`[Reactive Effects] Skipping ${c.protocol}-${c.value} ${o} - triggerActor=opponent, but triggered by ${a.player} (owner: ${s})`),!1;return!0});if(v.length===0)continue;const w=`${c.protocol}-${c.value}`;i=Co(i),i=Ie(i,w),i=Ye(i,void 0);const C=N0(o);i=$(i,s,`${C}: ${w} triggers.`);const x=s==="player"?"opponent":"player",b={cardOwner:s,actor:s,currentTurn:i.turn,opponent:x,triggerType:o};for(const E of v){const S=hn(c,f,i,b,E);if(i=Ee(S.newState),i.actionRequired)return console.log(`[Reactive Effects] Action required after ${w} reactive effect`),delete i._processingReactiveEffects,{newState:i}}i=jn(i),i=Ie(i,void 0),i=Ye(i,void 0)}return delete i._processingReactiveEffects,{newState:i}}function N0(t){switch(t){case"after_delete":return"After you delete cards";case"after_opponent_discard":return"After opponent discards";case"after_draw":return"After you draw cards";case"after_clear_cache":return"After you clear cache";case"before_compile_delete":return"Before deleted by compile";case"after_flip":return"After cards are flipped";case"after_shift":return"After cards are shifted";case"after_play":return"After cards are played";case"on_flip":return"When this card would be flipped";case"on_cover_or_flip":return"When this card would be covered or flipped";default:return t}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function on(t,o,a){let i=[...t],l=[...o],c=[],s=!1;for(let f=0;f<a;f++){if(i.length===0){if(l.length===0)break;i=zn(l),l=[],s=!0}c.push(i.shift())}return{drawnCards:c,remainingDeck:i,newDiscard:l,reshuffled:s}}function Vh(t,o){const a=t[o];let i=t;const l=a.lanes.flat().filter(c=>c.protocol==="Spirit"&&c.value===3&&c.isFaceUp);if(l.length>0)for(const c of l){i=$(i,o,"Spirit-3 triggers after drawing: You may shift this card.");const s={type:"prompt_shift_for_spirit_3",sourceCardId:c.id,optional:!0,actor:o};i.queuedActions=[...i.queuedActions||[],s]}return i}function tt(t,o,a){const i=t[o],{drawnCards:l,remainingDeck:c,newDiscard:s,reshuffled:f}=on(i.deck,i.discard,a);if(l.length===0)return t;const p=l.map(w=>({...w,id:Oe(),isFaceUp:!0})),h=p.map(w=>w.id),y={...i.stats,cardsDrawn:i.stats.cardsDrawn+l.length},g={...i,deck:c,discard:s,hand:[...i.hand,...p],stats:y};let v={...t,[o]:g,stats:{...t.stats,[o]:y}};return h.length>0&&(v.animationState={type:"drawCard",owner:o,cardIds:h}),f&&(v=$(v,o,`${o==="player"?"Player":"Opponent"}'s deck is empty. Discard pile has been reshuffled into the deck.`)),l.length>0&&(v=Vh(v,o),v=Ct(v,"after_draw",{player:o,count:l.length}).newState),v}function zh(t,o,a){const i=o==="player"?"opponent":"player";let l={...t};const c={...l[i]},s={...l[o]},{drawnCards:f,remainingDeck:p,newDiscard:h,reshuffled:y}=on(c.deck,c.discard,a);if(f.length>0){const g=f.map(C=>({...C,id:Oe(),isFaceUp:!0})),v=g.map(C=>C.id);s.hand=[...s.hand,...g];const w={...s.stats,cardsDrawn:s.stats.cardsDrawn+f.length};s.stats=w,c.deck=p,c.discard=h,l={...l,[o]:s,[i]:c,stats:{...l.stats,[o]:w}},v.length>0&&(l.animationState={type:"drawCard",owner:o,cardIds:v}),y&&(l=$(l,o,`${i==="player"?"Player":"Opponent"}'s deck is empty. Discard pile has been reshuffled into the deck.`)),l=Vh(l,o)}return l}function wd(t,o){const i=5-t[o].hand.length;if(i<=0)return t;const l=o==="player"?"Player":"Opponent";let c=tt(t,o,i);const s={...c[o],stats:{...c[o].stats,handsRefreshed:c[o].stats.handsRefreshed+1}};return c={...c,[o]:s,stats:{...c.stats,[o]:s.stats}},$(c,o,`${l} refreshes their hand, drawing ${i} card(s).`)}function Wt(t,o){const a={...o},i=l=>l.map(c=>c.map(s=>t.has(s.id)?{...s,isFaceUp:!s.isFaceUp}:s));return a.player.lanes=i(a.player.lanes),a.opponent.lanes=i(a.opponent.lanes),Ee(a)}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const gh=t=>{const o=zn(vo(t)),{drawnCards:a,remainingDeck:i}=on(o,[],5),l={cardsPlayed:0,cardsDiscarded:0,cardsDeleted:0,cardsFlipped:0,cardsShifted:0,cardsDrawn:a.length,handsRefreshed:0},c=a.map(s=>({...s,id:Oe(),isFaceUp:!0}));return{protocols:t,deck:i,hand:c,lanes:[[],[],[]],discard:[],compiled:[!1,!1,!1],laneValues:[0,0,0],cannotCompile:!1,stats:l}},Kr=(t,o,a,i="player")=>{const l=gh(t),c=gh(o),s={player:l,opponent:c,turn:i,phase:"start",controlCardHolder:null,useControlMechanic:a,winner:null,log:[],actionRequired:null,queuedActions:[],animationState:null,compilableLanes:[],processedStartEffectIds:[],processedEndEffectIds:[],lastPlayedCardId:void 0,stats:{player:l.stats,opponent:c.stats}},f=i==="player"?"Player":"Opponent",p=t.join(", "),h=o.join(", ");let y=$(s,"player","Game Started.");return y=$(y,"player",`Player protocols: ${p}`),y=$(y,"opponent",`Opponent protocols: ${h}`),y=$(y,"player",`${f} goes first.`),y},Et=(t,o,a,i,l)=>{if(t.isFaceUp)return t.value;if(o.some(s=>s.isFaceUp&&s.protocol==="Darkness"&&s.value===2))return 4;if(a&&i!==void 0&&l!==void 0){const s=Gh(a);for(const f of s)if(f.type==="set_to_fixed"){if(!(f.scope==="global"||f.scope==="this_lane"&&f.laneIndex===i))continue;const h=f.cardOwner;if(f.target==="own_cards"&&h!==l||f.target==="opponent_cards"&&h===l)continue;const y=f.filter;if(y&&(!y.faceState||y.faceState==="any"||y.faceState==="face_down"&&!t.isFaceUp||y.faceState==="face_up"&&t.isFaceUp))return f.value}}return 2},mh=(t,o,a,i)=>{let l=0;for(const c of t)c.isFaceUp?l+=c.value:l+=Et(c,t,o,a,i);return Math.max(0,l)};function Gh(t){const o=[];for(const a of["player","opponent"])t[a].lanes.forEach((i,l)=>{i.forEach(c=>{if(c.isFaceUp){const s=c;s.customEffects&&[...s.customEffects.topEffects||[],...s.customEffects.middleEffects||[],...s.customEffects.bottomEffects||[]].forEach(p=>{p.params.action==="value_modifier"&&p.trigger==="passive"&&o.push({...p.params.modifier,cardOwner:a,laneIndex:l})})}})});return o}function U0(t,o,a){const i=Gh(t),l=[...o],c=[...a];for(const s of i){const{type:f,value:p,condition:h,target:y,scope:g,filter:v,cardOwner:w,laneIndex:C}=s,x=g==="global"?[0,1,2]:[C];for(const b of x)switch(f){case"add_per_condition":{if(!h)continue;let E=0;const S=t.player.lanes[b],j=t.opponent.lanes[b];h==="per_face_down_card"?E=S.filter(R=>!R.isFaceUp).length+j.filter(R=>!R.isFaceUp).length:h==="per_face_up_card"?E=S.filter(R=>R.isFaceUp).length+j.filter(R=>R.isFaceUp).length:h==="per_card"&&(E=S.length+j.length),y==="own_total"&&w==="player"?l[b]+=p*E:y==="own_total"&&w==="opponent"||y==="opponent_total"&&w==="player"?c[b]+=p*E:y==="opponent_total"&&w==="opponent"&&(l[b]+=p*E);break}case"set_to_fixed":break;case"add_to_total":{y==="own_total"&&w==="player"?l[b]+=p:y==="own_total"&&w==="opponent"||y==="opponent_total"&&w==="player"?c[b]+=p:y==="opponent_total"&&w==="opponent"&&(l[b]+=p);break}}}return{finalPlayerValues:l.map(s=>Math.max(0,s)),finalOpponentValues:c.map(s=>Math.max(0,s))}}function $0(t,o,a){let i=[...o],l=[...a];for(let c=0;c<3;c++)t.opponent.lanes[c].some(s=>s.isFaceUp&&s.protocol==="Metal"&&s.value===0)&&(i[c]=Math.max(0,i[c]-2)),t.player.lanes[c].some(s=>s.isFaceUp&&s.protocol==="Metal"&&s.value===0)&&(l[c]=Math.max(0,l[c]-2));for(let c=0;c<3;c++){for(const s of t.player.lanes[c])if(s.isFaceUp)switch(`${s.protocol}-${s.value}`){case"Apathy-0":{const f=t.player.lanes[c].filter(h=>!h.isFaceUp).length,p=t.opponent.lanes[c].filter(h=>!h.isFaceUp).length;i[c]+=f+p;break}case"Darkness-2":{const f=t.player.lanes[c].filter(p=>!p.isFaceUp).length;i[c]+=f*2;break}}for(const s of t.opponent.lanes[c])if(s.isFaceUp)switch(`${s.protocol}-${s.value}`){case"Apathy-0":{const f=t.player.lanes[c].filter(h=>!h.isFaceUp).length,p=t.opponent.lanes[c].filter(h=>!h.isFaceUp).length;l[c]+=f+p;break}case"Darkness-2":{const f=t.opponent.lanes[c].filter(p=>!p.isFaceUp).length;l[c]+=f*2;break}}}return{finalPlayerValues:i,finalOpponentValues:l}}const Ee=t=>{const o=t.player.lanes.map((s,f)=>mh(s,t,f,"player")),a=t.opponent.lanes.map((s,f)=>mh(s,t,f,"opponent")),i=$0(t,o,a),{finalPlayerValues:l,finalOpponentValues:c}=U0(t,i.finalPlayerValues,i.finalOpponentValues);return{...t,player:{...t.player,laneValues:l},opponent:{...t.opponent,laneValues:c}}},Yh=(t,o)=>{const a=[],i=t[o],l=t[o==="player"?"opponent":"player"];if(!i.cannotCompile)for(let c=0;c<3;c++){const s=i.laneValues[c],f=l.laneValues[c];s>=10&&s>f&&a.push(c)}return a};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Gn=(t,o)=>{if(t[o].lanes.flat().some(l=>l.isFaceUp&&l.protocol==="Hate"&&l.value===3)){let l={...t};return l=Ie(l,"Hate-3"),l=Ye(l,void 0),l=$(l,o,"Triggers after deleting cards: Draw 1 card."),l=tt(l,o,1),l=Ie(l,void 0),l}return t};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const O0=["select_covered_card_to_flip_for_chaos_0","select_any_other_card_to_flip","select_opponent_face_up_card_to_flip","select_own_face_up_covered_card_to_flip","select_covered_card_in_line_to_flip_optional","select_any_card_to_flip_optional","select_any_face_down_card_to_flip_optional","select_card_to_flip_for_fire_3","select_card_to_flip","select_opponent_card_to_flip","select_any_card_to_flip","select_card_to_flip_for_light_0","select_any_other_card_to_flip_for_water_0","select_card_to_flip_and_shift_for_gravity_2","select_face_down_card_to_reveal_for_light_2"];function L0(t,o,a){if(!a||!O0.includes(a.type))return null;const i=fe(t,o);if(i&&i.card.protocol==="Metal"&&i.card.value===6){const l="actor"in a?a.actor:t.turn,c=l==="player"?"Player":"Opponent",s=i.owner==="player"?"Player's":"Opponent's";let f="An effect";if("sourceCardId"in a&&a.sourceCardId){const E=fe(t,a.sourceCardId);E&&(f=`${E.card.protocol}-${E.card.value}`)}let p=$(t,l,`${f}: ${c} flips ${s} Metal-6.`);p=$(p,l,"Metal-6: Deletes itself when flipped.");const h={...t.stats[l],cardsDeleted:t.stats[l].cardsDeleted+1},y={...t[l],stats:h};p={...p,[l]:y,stats:{...p.stats,[l]:h}};const g=i.owner,v=t[g].lanes.findIndex(E=>E.some(S=>S.id===o)),w=t[g].lanes[v],C=w&&w.length>0&&w[w.length-1].id===o,x=w&&w.length>1,b=(E,S)=>{var A,N;let j=Gn(E,E.turn);if(j=Ct(j,"after_delete",{player:E.turn}).newState,C&&x&&(j=sn(j,g,v).newState,console.log("[Metal-6 Delete] Uncover effect triggered. actionRequired:",((A=j.actionRequired)==null?void 0:A.type)||"null")),(a==null?void 0:a.type)==="select_card_to_flip_for_light_0")return j=$(j,a.actor,"Light-0: Drawing 6 card(s) after Metal-6 was deleted."),j=tt(j,a.actor,6),j=Ge(j),j.actionRequired=null,j.actionRequired?j:S(j);if((a==null?void 0:a.type)==="select_any_other_card_to_flip_for_water_0"){const I={type:"flip_self_for_water_0",sourceCardId:a.sourceCardId,actor:a.actor};return j.actionRequired?(j.queuedActions=[I,...j.queuedActions||[]],console.log("[WATER-0 + Metal-6] Interrupt detected, queued self-flip. Queue:",j.queuedActions.length),j):(j.queuedActions=[I],j=Ge(j),j=Yn(j),console.log("[WATER-0 + Metal-6] No interrupt, processed self-flip. actionRequired:",((N=j.actionRequired)==null?void 0:N.type)||"null"),j.actionRequired?j:S(j))}if(a&&"count"in a&&a.count>1){const I=a.count-1;return j.actionRequired={...a,count:I},j}if(E.actionRequired||E.queuedActions&&E.queuedActions.length>0)return{...j,actionRequired:E.actionRequired,queuedActions:E.queuedActions};if(j=Ge(j),j.actionRequired=null,j.queuedActions&&j.queuedActions.length>0){const I=[...j.queuedActions],V=I.shift();return{...j,actionRequired:V,queuedActions:I}}return S(j)};return{nextState:{...p,actionRequired:null},requiresAnimation:{animationRequests:[{type:"delete",cardId:o,owner:i.owner}],onCompleteCallback:b},requiresTurnEnd:!1}}return null}const ud=(t,o)=>{var s,f,p,h,y,g,v,w,C,x,b;if(!t.actionRequired)return{nextState:t};let a={...t},i=!0,l=null;const c=L0(t,o,t.actionRequired);if(c)return c;switch(t.actionRequired.type){case"select_covered_card_to_flip_for_chaos_0":{const{actor:E,sourceCardId:S,remainingLanes:j}=t.actionRequired,R=fe(t,o);if(a=Go(t,o),R&&!R.card.isFaceUp){const A=wo(a,o);a=A.newState,A.animationRequests&&(l={animationRequests:A.animationRequests,onCompleteCallback:(N,I)=>N.actionRequired||N.queuedActions&&N.queuedActions.length>0?N:I(N)})}if(j.length>0){const A=j[0],N=j.slice(1);a.actionRequired={type:"select_covered_card_to_flip_for_chaos_0",sourceCardId:S,laneIndex:A,remainingLanes:N,actor:E},i=!1}else a=Ge(a),a.actionRequired=null,a.queuedActions&&a.queuedActions.length>0&&(i=!1);break}case"select_any_other_card_to_flip":case"select_opponent_face_up_card_to_flip":case"select_own_face_up_covered_card_to_flip":case"select_covered_card_in_line_to_flip_optional":case"select_any_card_to_flip_optional":case"select_any_face_down_card_to_flip_optional":case"select_card_to_flip_for_fire_3":case"select_card_to_flip":{const E=fe(t,o),S="draws"in t.actionRequired?t.actionRequired.draws:0;a=Go(t,o);const j=o;if(a.lastCustomEffectTargetCardId=j,S&&S>0){const{actor:D,sourceCardId:O}=t.actionRequired,H=fe(a,O),te=H?`${H.card.protocol}-${H.card.value}`:"A card effect";a=$(a,D,`${te}: Drawing ${S} card(s).`),a=tt(a,D,S)}if(E&&!E.card.isFaceUp){const D=wo(a,o);a=D.newState,a.lastCustomEffectTargetCardId=j,D.animationRequests&&(l={animationRequests:D.animationRequests,onCompleteCallback:(O,H)=>O.actionRequired||O.queuedActions&&O.queuedActions.length>0?O:H(O)})}const R=(s=t.actionRequired)==null?void 0:s.followUpEffect,A=(f=t.actionRequired)==null?void 0:f.sourceCardId;R&&A&&(a=C0(a,o,A));const N=((p=t.actionRequired)==null?void 0:p.actor)||t.turn;a=Ct(a,"after_flip",{player:N,cardId:o}).newState;const V=a._pendingCustomEffects;if(V&&V.effects.length>0){console.log("[SOFTLOCK DEBUG] Queueing pending effects after flip:"),console.log("  - cardOwner from context:",V.context.cardOwner),console.log("  - flipActor (prev actor):",N),console.log("  - current turn:",a.turn),console.log("  - actionRequired actor:",(h=a.actionRequired)==null?void 0:h.actor),console.log("  - remaining effects:",V.effects.length);const D={type:"execute_remaining_custom_effects",sourceCardId:V.sourceCardId,laneIndex:V.laneIndex,effects:V.effects,context:V.context,actor:V.context.cardOwner,selectedCardFromPreviousEffect:V.effects[0].useCardFromPreviousEffect?o:void 0};console.log("  - queued action actor:",D.actor),a.queuedActions=[...a.queuedActions||[],D],console.log("  - queue length after:",a.queuedActions.length),delete a._pendingCustomEffects}const L=(y=t.actionRequired)==null?void 0:y.remainingLanes;if(L&&L.length>0&&!a.actionRequired){const D=L[0],O=L.slice(1),H=(g=t.actionRequired)==null?void 0:g.params,te=(v=t.actionRequired)==null?void 0:v.sourceCardId,ne=(w=t.actionRequired)==null?void 0:w.actor,z=(C=t.actionRequired)==null?void 0:C.targetFilter;a.actionRequired={type:"select_card_to_flip",sourceCardId:te,actor:ne,currentLaneIndex:D,remainingLanes:O,targetFilter:z,params:H}}(a.actionRequired||a.queuedActions&&a.queuedActions.length>0)&&(i=!1);break}case"select_opponent_card_to_flip":{const{actor:E,sourceCardId:S}=t.actionRequired,j=fe(t,o),R={type:"shift_flipped_card_optional",cardId:o,sourceCardId:S,optional:!0,actor:E};if(a=Go(t,o,R),j&&!j.card.isFaceUp){const A=wo(a,o),N=A.newState.actionRequired;N&&N!==R&&fe(A.newState,o)&&(A.newState.queuedActions=[...A.newState.queuedActions||[],R]),a=A.newState,A.animationRequests&&(l={animationRequests:A.animationRequests,onCompleteCallback:I=>I})}i=!1;break}case"select_card_to_shift_for_anarchy_0":case"select_card_to_shift_for_anarchy_1":case"select_card_to_shift_for_gravity_1":case"shift_flipped_card_optional":case"select_opponent_covered_card_to_shift":case"select_own_covered_card_to_shift":case"select_face_down_card_to_shift_for_darkness_4":case"select_any_opponent_card_to_shift":case"select_card_to_shift":{if(t.actionRequired.type==="shift_flipped_card_optional"){const S=t.actionRequired.sourceCardId,j=fe(t,S);if(!j||!j.card.isFaceUp){const R=j?`${j.card.protocol}-${j.card.value}`:"the source card";a=$(t,t.actionRequired.actor,`Shift from ${R} was cancelled because the source is no longer active.`),a=Ge(a),a.actionRequired=null,i=!0;break}}const E=fe(t,o);if(E){const{owner:S}=E;let j=-1;for(let R=0;R<t[S].lanes.length;R++)if(t[S].lanes[R].some(A=>A.id===o)){j=R;break}if(j!==-1){const R=t.actionRequired.targetLaneIndex;if(R!==void 0){const N=t.actionRequired.actor;a=Ln(t,o,S,R,N).newState,i=!a.actionRequired;break}const A={type:"select_lane_for_shift",cardToShiftId:o,cardOwner:S,originalLaneIndex:j,sourceCardId:t.actionRequired.sourceCardId,actor:t.actionRequired.actor,destinationRestriction:t.actionRequired.destinationRestriction};a.actionRequired=A}}i=!1;break}case"select_face_down_card_to_shift_for_gravity_4":{const{targetLaneIndex:E,actor:S}=t.actionRequired,j=fe(t,o);if(!j)return{nextState:t,requiresTurnEnd:!0};const R=Ln(t,o,j.owner,E,S);a=R.newState,R.animationRequests?(l={animationRequests:R.animationRequests,onCompleteCallback:(A,N)=>A.actionRequired?A:N(A)},i=!1):i=!a.actionRequired;break}case"select_own_other_card_to_shift":{const E=fe(t,o);if(E){const{owner:S}=E;let j=-1;for(let R=0;R<t[S].lanes.length;R++)if(t[S].lanes[R].some(A=>A.id===o)){j=R;break}if(j!==-1){const R={type:"select_lane_for_shift",cardToShiftId:o,cardOwner:S,originalLaneIndex:j,sourceCardId:t.actionRequired.sourceCardId,actor:t.actionRequired.actor};a.actionRequired=R}}i=!1;break}case"select_opponent_face_down_card_to_shift":{const E=fe(t,o);if(E){const{owner:S}=E;let j=-1;for(let R=0;R<t[S].lanes.length;R++)if(t[S].lanes[R].some(A=>A.id===o)){j=R;break}if(j!==-1){const R={type:"select_lane_for_shift",cardToShiftId:o,cardOwner:S,originalLaneIndex:j,sourceCardId:t.actionRequired.sourceCardId,actor:t.actionRequired.actor};a.actionRequired=R}}i=!1;break}case"select_own_card_to_shift_for_speed_3":{const E=fe(t,o);if(E){const{owner:S}=E;let j=-1;for(let R=0;R<t[S].lanes.length;R++)if(t[S].lanes[R].some(A=>A.id===o)){j=R;break}if(j!==-1){const R={type:"select_lane_for_shift",cardToShiftId:o,cardOwner:S,originalLaneIndex:j,sourceCardId:t.actionRequired.sourceCardId,actor:t.actionRequired.actor,sourceEffect:"speed_3_end"};a.actionRequired=R}}i=!1;break}case"select_card_to_delete_for_death_1":{const{sourceCardId:E,actor:S}=t.actionRequired,j=fe(t,o),R=fe(t,E);if(!j||!R)return{nextState:t};const A=S==="player"?"Player":"Opponent",N=j.owner==="player"?"Player's":"Opponent's",I=j.card.isFaceUp?`${j.card.protocol}-${j.card.value}`:"a face-down card";a=$(a,S,`Death-1: ${A} deletes ${N} ${I} and the Death-1 card itself.`);const V={...a.stats[S],cardsDeleted:a.stats[S].cardsDeleted+2},L={...a[S],stats:V};a={...a,[S]:L,stats:{...a.stats,[S]:V}};const D=t[j.owner].lanes.findIndex(F=>F.some(B=>B.id===o)),O=t[j.owner].lanes[D],H=O&&O.length>0&&O[O.length-1].id===o,te=t[R.owner].lanes.findIndex(F=>F.some(B=>B.id===E)),ne=t[R.owner].lanes[te],z=ne&&ne.length>0&&ne[ne.length-1].id===E;a=Ge(a),a.actionRequired=null,l={animationRequests:[{type:"delete",cardId:o,owner:j.owner},{type:"delete",cardId:E,owner:R.owner}],onCompleteCallback:(F,B)=>{let W=Gn(F,S);if(W=Gn(W,S),W=Ct(W,"after_delete",{player:S}).newState,H&&(W=sn(W,j.owner,D).newState),z&&(W=sn(W,R.owner,te).newState),W=jn(W),W.actionRequired)return W;if(W.queuedActions&&W.queuedActions.length>0){const U=[...W.queuedActions],P=U.shift();return{...W,actionRequired:P,queuedActions:U}}return B(W)}},i=!1;break}case"delete_self":{const{sourceCardId:E,cardToDeleteId:S,actor:j}=t.actionRequired,R=fe(t,S);if(!R){a=$(t,j,"Card no longer on board. Delete skipped."),a=Ge(a),a.actionRequired=null,i=!0;break}const{owner:A,laneIndex:N}=R,I=t[A].lanes[N][t[A].lanes[N].length-1].id===S,V=[...t[A].lanes[N]],L=V.findIndex(te=>te.id===S);V.splice(L,1);const D=[...t[A].lanes];D[N]=V;let O={...t,[A]:{...t[A],lanes:D}};a=Ge(O),a.actionRequired=null;const H={...a.stats[j],cardsDeleted:a.stats[j].cardsDeleted+1};a={...a,stats:{...a.stats,[j]:H}},I&&V.length>0&&(a=sn(a,A,N).newState),i=!0;break}case"select_cards_to_delete":case"select_face_down_card_to_delete":case"select_low_value_card_to_delete":case"select_card_from_other_lanes_to_delete":case"select_card_to_delete_for_anarchy_2":{const{sourceCardId:E,actor:S}=t.actionRequired,j=fe(t,E);if(!j||!j.card.isFaceUp){const B=j?`${j.card.protocol}-${j.card.value}`:"the source card";a=$(t,S,`Effect from ${B} was cancelled because the source is no longer active.`),a=Ge(a),a.actionRequired=null,i=!0;break}const R=fe(t,o);if(!R)return{nextState:t};if(t.actionRequired.type==="select_card_to_delete_for_anarchy_2"){const B=t[R.owner].lanes.findIndex(W=>W.some(_e=>_e.id===o));if(B!==-1){const W=t.player.protocols[B],_e=t.opponent.protocols[B],U=R.card.protocol;if(U!==W&&U!==_e)return console.error(`Illegal Anarchy-2 delete: ${U}-${R.card.value} in lane ${B} (protocols: ${W}/${_e}) - card must be in lane with matching protocol`),{nextState:t}}}if(t.actionRequired.protocolMatching){const B=t.actionRequired.protocolMatching,W=t[R.owner].lanes.findIndex(_e=>_e.some(U=>U.id===o));if(W!==-1){const _e=t.player.protocols[W],U=t.opponent.protocols[W],P=R.card.protocol,Z=P===_e||P===U;if(B==="must_match"&&!Z)return console.error(`Illegal delete: ${P}-${R.card.value} in lane ${W} (protocols: ${_e}/${U}) - card must be in lane with matching protocol`),{nextState:t};if(B==="must_not_match"&&Z)return console.error(`Illegal delete: ${P}-${R.card.value} in lane ${W} (protocols: ${_e}/${U}) - card must be in lane without matching protocol`),{nextState:t}}}const A=S==="player"?"Player":"Opponent",N=R.owner==="player"?"Player's":"Opponent's",I=t[R.owner].lanes.findIndex(B=>B.some(W=>W.id===o)),V=I!==-1?t[R.owner].protocols[I]:"unknown",L=R.card.isFaceUp?`${R.card.protocol}-${R.card.value}`:`face-down card in Protocol ${V}`,D=fe(t,t.actionRequired.sourceCardId),O=D?`${D.card.protocol}-${D.card.value}`:"a card effect";a=$(a,S,`${O}: ${A} deletes ${N} ${L}.`);const H={...a.stats[S],cardsDeleted:a.stats[S].cardsDeleted+1},te={...a[S],stats:H};a={...a,[S]:te,stats:{...a.stats,[S]:H}};const ne=t[R.owner].lanes.findIndex(B=>B.some(W=>W.id===o)),z=t[R.owner].lanes[ne],F=z&&z.length>0&&z[z.length-1].id===o;a=Ge(a),a.actionRequired=null,l={animationRequests:[{type:"delete",cardId:o,owner:R.owner}],onCompleteCallback:(B,W)=>{var de,ce;const _e=t.actionRequired.actor,U=t.actionRequired;console.log("[DELETE CALLBACK] Started! followUpEffect?",!!U.followUpEffect);let P=Gn(B,_e);P=Ct(P,"after_delete",{player:_e}).newState,P=Ge(P);let Q=null;const pe=fe(P,U.sourceCardId),Ce=dn(P,U.sourceCardId),ve=U.followUpEffect;if(pe&&pe.card.isFaceUp&&Ce){const le=U.remainingLanes;if(U.type==="select_cards_to_delete"&&le&&le.length>0){const re=le[0],se=le.slice(1);Q={type:"select_cards_to_delete",count:((de=U.params)==null?void 0:de.count)||U.count,sourceCardId:U.sourceCardId,actor:U.actor,currentLaneIndex:re,remainingLanes:se,disallowedIds:(ce=U.params)!=null&&ce.excludeSelf?[U.sourceCardId]:[],targetFilter:U.targetFilter,scope:U.scope,protocolMatching:U.protocolMatching,params:U.params}}else if(U.type==="select_cards_to_delete"&&U.count>1)Q={type:"select_cards_to_delete",count:U.count-1,sourceCardId:U.sourceCardId,disallowedIds:[...U.disallowedIds,o],actor:U.actor,followUpEffect:ve};else if(U.type==="select_card_from_other_lanes_to_delete"&&U.count>1){const re=t[R.owner].lanes.findIndex(Se=>Se.some($e=>$e.id===o)),se=[...U.lanesSelected,re];[0,1,2].filter(Se=>Se!==U.disallowedLaneIndex&&!se.includes(Se)).some(Se=>P.player.lanes[Se].length>0||P.opponent.lanes[Se].length>0)?Q={type:"select_card_from_other_lanes_to_delete",count:U.count-1,sourceCardId:U.sourceCardId,disallowedLaneIndex:U.disallowedLaneIndex,lanesSelected:se,actor:U.actor}:P=$(P,U.actor,"No cards left in remaining lanes. Effect skipped.")}}else if("count"in U&&U.count>1){const le=pe?`${pe.card.protocol}-${pe.card.value}`:"the source card",re=!pe||!pe.card.isFaceUp?"the source is no longer active":"the source was covered";P=$(P,U.actor,`Remaining deletes from ${le} were cancelled because ${re}.`)}let ke=!1;if(F){const le=P,re=sn(le,R.owner,ne),se=re.newState._interruptedTurn!==void 0;le._interruptedTurn&&!re.newState._interruptedTurn&&(ke=!0);const ge=[...re.newState.queuedActions||[]];Q&&(se?ge.push(Q):ge.unshift(Q)),P={...re.newState,queuedActions:ge}}else Q&&(P.queuedActions=[...P.queuedActions||[],Q]);if(P.actionRequired)return P;if(P.queuedActions&&P.queuedActions.length>0){const le=P.queuedActions[0];if((le==null?void 0:le.type)==="execute_remaining_custom_effects"){const ge=Yn(P);return ge.actionRequired?ge:W(ge)}const re=[...P.queuedActions],se=re.shift();if((se==null?void 0:se.type)==="shift_flipped_card_optional"||(se==null?void 0:se.type)==="gravity_2_shift_after_flip"){const ge=fe(P,se.sourceCardId),me=dn(P,se.sourceCardId);if(!ge||!ge.card.isFaceUp||!me){const Se=ge?`${ge.card.protocol}-${ge.card.value}`:"the source card";let $e=$(P,se.actor,`Shift from ${Se} was cancelled because the source is no longer active.`);if(re.length>0){const xe=re.shift();return{...$e,actionRequired:xe,queuedActions:re}}else return W({...$e,actionRequired:null,queuedActions:[]})}}return{...P,actionRequired:se,queuedActions:re}}if(ke){if(console.log("[DELETE CALLBACK] Interrupt resolved, checking for queued actions"),P.queuedActions&&P.queuedActions.length>0){console.log("[DELETE CALLBACK] Found queued actions after interrupt:",P.queuedActions.length);const le=[...P.queuedActions],re=le.shift();return{...P,actionRequired:re,queuedActions:le}}return console.log("[DELETE CALLBACK] No queued actions after interrupt, returning early"),P}if(console.log("[DELETE CALLBACK] Reached followUpEffect check. followUpEffect?",!!ve,"sourceCardInfo?",!!pe,"isFaceUp?",pe==null?void 0:pe.card.isFaceUp),ve&&pe&&pe.card.isFaceUp)if(!((ve.position||"middle")!=="top")||Ce){console.log("[Death-1 Follow-up] Executing follow-up effect after delete:",ve);const ge=P[pe.owner].lanes.findIndex(nt=>nt.some(Ke=>Ke.id===U.sourceCardId)),me=U.actor==="player"?"opponent":"player",Se=ve.trigger||"on_play",$e={cardOwner:U.actor,actor:U.actor,currentTurn:P.turn,opponent:me,triggerType:Se};P=hn(pe.card,ge,P,$e,ve).newState,console.log("[Death-1 Follow-up] Result actionRequired:",P.actionRequired);const at=fe(P,U.sourceCardId);if(console.log("[Death-1 Follow-up] Card still exists after deleteSelf?",!!at),P.actionRequired)return P}else console.log("[Death-1 Follow-up] Follow-up effect requires uncovered but card is covered");else console.log("[Death-1 Follow-up] No follow-up effect or source card not valid:",{hasFollowUp:!!ve,hasSourceCard:!!pe,isFaceUp:pe==null?void 0:pe.card.isFaceUp,isUncovered:Ce});return W(P)}},i=!1;break}case"plague_4_opponent_delete":{const E=fe(t,o);if(!E)return{nextState:t};const S=t.actionRequired.actor;a=$(a,S,"Plague-4: Opponent deletes one of their face-down cards.");const j={...a.stats[S],cardsDeleted:a.stats[S].cardsDeleted+1},R={...a[S],stats:j};a={...a,[S]:R,stats:{...a.stats,[S]:j}};const A=t[E.owner].lanes.findIndex(V=>V.some(L=>L.id===o)),N=t[E.owner].lanes[A],I=N&&N.length>0&&N[N.length-1].id===o;a=Ge(a),a.actionRequired=null,l={animationRequests:[{type:"delete",cardId:o,owner:E.owner}],onCompleteCallback:(V,L)=>{let D=Gn(V,S);D=Ct(D,"after_delete",{player:S}).newState,I&&(D=sn(D,E.owner,A).newState);const H=fe(D,t.actionRequired.sourceCardId),te=(H==null?void 0:H.owner)||t.turn,ne={type:"plague_4_player_flip_optional",sourceCardId:t.actionRequired.sourceCardId,optional:!0,actor:te};return D.actionRequired?D.queuedActions=[...D.queuedActions||[],ne]:D.actionRequired=ne,D}},i=!1;break}case"select_own_highest_card_to_delete_for_hate_2":{const{sourceCardId:E,actor:S}=t.actionRequired,j=fe(t,o);if(!j)return{nextState:t};if(!Tc(t,S).some(te=>te.card.id===o))return a=$(t,S,"Invalid selection: Card is not one of your highest value uncovered cards."),{nextState:t};const N=S==="player"?"Player":"Opponent",I=j.card.isFaceUp?`${j.card.protocol}-${j.card.value}`:"a face-down card";a=$(a,S,`Hate-2: ${N} deletes their highest value uncovered card (${I}).`);const V={...a.stats[S],cardsDeleted:a.stats[S].cardsDeleted+1},L={...a[S],stats:V};a={...a,[S]:L,stats:{...a.stats,[S]:V}};const D=t[j.owner].lanes.findIndex(te=>te.some(ne=>ne.id===o)),O=t[j.owner].lanes[D],H=O&&O.length>0&&O[O.length-1].id===o;a=Ge(a),a.actionRequired=null,l={animationRequests:[{type:"delete",cardId:o,owner:j.owner}],onCompleteCallback:(te,ne)=>{let z=Gn(te,S);z=Ct(z,"after_delete",{player:S}).newState,H&&(z=sn(z,j.owner,D).newState);const B=fe(z,E),W=B&&dn(z,E);if(B&&B.card.isFaceUp&&W){const _e={type:"select_opponent_highest_card_to_delete_for_hate_2",sourceCardId:E,actor:S,count:1};return z.actionRequired?z.queuedActions=[...z.queuedActions||[],_e]:z.actionRequired=_e,z}else{const _e=B?B.card.isFaceUp?"is now covered":"was flipped face-down":"deleted itself";return z=$(z,S,`Hate-2 ${_e}, second clause does not trigger.`),ne(z)}}},i=!1;break}case"select_opponent_highest_card_to_delete_for_hate_2":{const{sourceCardId:E,actor:S}=t.actionRequired,j=S==="player"?"opponent":"player",R=fe(t,o);if(!R)return{nextState:t};if(!Tc(t,j).some(z=>z.card.id===o))return a=$(t,S,"Invalid selection: Card is not one of opponent's highest value uncovered cards."),{nextState:t};a=Ie(a,"Hate-2"),a=Ye(a,"middle");const I=S==="player"?"Player":"Opponent",V=R.owner==="player"?"Player's":"Opponent's",L=R.card.isFaceUp?`${R.card.protocol}-${R.card.value}`:"a face-down card";a=$(a,S,`${I} deletes ${V} highest value uncovered card (${L}).`);const D={...a.stats[S],cardsDeleted:a.stats[S].cardsDeleted+1},O={...a[S],stats:D};a={...a,[S]:O,stats:{...a.stats,[S]:D}};const H=t[R.owner].lanes.findIndex(z=>z.some(F=>F.id===o)),te=t[R.owner].lanes[H],ne=te&&te.length>0&&te[te.length-1].id===o;a=Ge(a),a.actionRequired=null,l={animationRequests:[{type:"delete",cardId:o,owner:R.owner}],onCompleteCallback:(z,F)=>{let B=Gn(z,S);return B=Ct(B,"after_delete",{player:S}).newState,ne&&(B=sn(B,R.owner,H).newState),F(B)}},i=!1;break}case"select_card_to_return":{const E=jc(t,o);a=E.newState,E.animationRequests&&(l={animationRequests:E.animationRequests,onCompleteCallback:(S,j)=>S.actionRequired?S:j(S)}),i=!a.actionRequired;break}case"select_opponent_card_to_return":{const{sourceCardId:E,actor:S}=t.actionRequired,j=jc(t,o);let R=j.newState;if(R.actionRequired){const A={type:"flip_self_for_psychic_4",sourceCardId:E,actor:S};R.queuedActions=[A,...R.queuedActions||[]],a=R,i=!1}else{const A=fe(R,E);if(A){const N=`${A.card.protocol}-${A.card.value}`;R=$(R,S,`${N}: Flips itself.`),R=Wt(new Set([E]),R),R.animationState={type:"flipCard",cardId:E}}a=R,i=!0}j.animationRequests&&(l={animationRequests:j.animationRequests,onCompleteCallback:(A,N)=>A.actionRequired?A:N(A)});break}case"select_own_card_to_return_for_water_4":{const E=jc(t,o);a=E.newState,E.animationRequests?l={animationRequests:E.animationRequests,onCompleteCallback:(S,j)=>{const R=Yn(S);return R.actionRequired?R:j(R)}}:a=Yn(a),i=!a.actionRequired;break}case"select_any_card_to_flip":{const E=fe(t,o),{count:S,sourceCardId:j,actor:R}=t.actionRequired,A=fe(t,j);if(!A||!A.card.isFaceUp){const V=A?`${A.card.protocol}-${A.card.value}`:"a card";a=$(t,R,`Effect from ${V} was cancelled because the source is no longer active.`),a=Ge(a),a.actionRequired=null,i=!0;break}let N=null;S>1&&(N={type:"select_any_card_to_flip",count:S-1,sourceCardId:j,actor:R});let I=Go(t,o,N);if(E&&!E.card.isFaceUp){const V=wo(I,o),L=V.newState.actionRequired;L&&L!==N&&N&&(V.newState.queuedActions=[...V.newState.queuedActions||[],N]),a=V.newState,V.animationRequests&&(l={animationRequests:V.animationRequests,onCompleteCallback:(D,O)=>D.actionRequired||D.queuedActions&&D.queuedActions.length>0?D:O(D)})}else a=I;i=!a.actionRequired&&(!a.queuedActions||a.queuedActions.length===0);break}case"select_card_to_flip_for_light_0":{const{sourceCardId:E,actor:S}=t.actionRequired,j=fe(t,o);let R=Go(t,o,null);const A=fe(R,o);let N=0;if(A){const I=A.owner,V=R[I].lanes.find(L=>L.some(D=>D.id===o))||[];N=Et(A.card,V)}N>0&&(R=$(R,S,`Light-0: Drawing ${N} card(s).`),R=tt(R,S,N)),j&&!j.card.isFaceUp?a=wo(R,o).newState:a=R,i=!a.actionRequired;break}case"select_any_other_card_to_flip_for_water_0":{const{sourceCardId:E,actor:S}=t.actionRequired,j=fe(t,o);let R=Go(t,o,null),A={newState:R};j&&!j.card.isFaceUp&&(A=wo(R,o));let N=A.newState;const I={type:"flip_self_for_water_0",sourceCardId:E,actor:S};console.log("[DEBUG] cardResolver - Water-0 self-flip action CREATED:",{sourceCardId:E,actor:S,hasInterrupt:!!N.actionRequired,existingQueueLength:((x=N.queuedActions)==null?void 0:x.length)||0}),N.actionRequired?(N.queuedActions=[I,...N.queuedActions||[]],console.log("[WATER-0 QUEUE] Added to BEGINNING of queue (interrupt case), new queue length:",N.queuedActions.length),console.log("[WATER-0 QUEUE] Current actionRequired:",N.actionRequired.type)):(N.queuedActions=[I],console.log("[WATER-0 QUEUE] Created NEW queue (no interrupt), queue length:",N.queuedActions.length)),a=N,a.queuedActions&&a.queuedActions.length>0&&!a.actionRequired&&(console.log("[WATER-0 NO INTERRUPT] Queue exists but no actionRequired - processing queue immediately"),a=Yn(a),console.log("[WATER-0 NO INTERRUPT] After queue processing - actionRequired?",((b=a.actionRequired)==null?void 0:b.type)||"null")),i=!a.actionRequired,A.animationRequests&&(l={animationRequests:A.animationRequests,onCompleteCallback:(L,D)=>L.actionRequired?L:D(L)});break}case"select_card_to_flip_and_shift_for_gravity_2":{const E=fe(t,o),{sourceCardId:S,targetLaneIndex:j,actor:R}=t.actionRequired;let A=Go(t,o,null);if(E&&!E.card.isFaceUp){const I=wo(A,o),V=I.newState.actionRequired;if(console.log("[Gravity-2] After flip, interruptAction:",(V==null?void 0:V.type)||"none"),V){const L=fe(I.newState,o);if(console.log("[Gravity-2] Flipped card still exists:",!!L),L){const D={type:"gravity_2_shift_after_flip",cardToShiftId:o,targetLaneIndex:j,cardOwner:E.owner,sourceCardId:S,actor:R};I.newState.queuedActions=[...I.newState.queuedActions||[],D],console.log("[Gravity-2] Queued shift action. Queue length:",I.newState.queuedActions.length)}a=I.newState,i=!1;break}A=I.newState}console.log("[Gravity-2] No interrupt detected, performing immediate shift"),a=Ln(A,o,E.owner,j,R).newState,i=!a.actionRequired;break}case"gravity_2_shift_after_flip":{const{cardToShiftId:E,targetLaneIndex:S,cardOwner:j,actor:R,sourceCardId:A}=t.actionRequired,N=fe(t,E),I=fe(t,A),V=I&&I.card.isFaceUp;if(!N||!V){a={...t,actionRequired:null},i=!0;break}a=Ln(t,E,j,S,R).newState,i=!a.actionRequired;break}case"select_face_down_card_to_reveal_for_light_2":{const{sourceCardId:E,actor:S}=t.actionRequired,j=S.charAt(0).toUpperCase()+S.slice(1),R=fe(t,o),A=R?`${R.card.protocol}-${R.card.value}`:"a card";a=$(t,S,`Light-2: ${j} reveals ${A}.`),a.actionRequired={type:"prompt_shift_or_flip_for_light_2",sourceCardId:E,revealedCardId:o,optional:!0,actor:S},i=!1;break}case"select_board_card_to_reveal_custom":{const{sourceCardId:E,actor:S,followUpAction:j,optional:R}=t.actionRequired,A=S.charAt(0).toUpperCase()+S.slice(1),N=fe(t,o);if(!N)return{nextState:t,requiresTurnEnd:!0};const I=N.owner,V=t[I].lanes.findIndex(te=>te.some(ne=>ne.id===o));if(V===-1)return{nextState:t,requiresTurnEnd:!0};const L=[...t[I].lanes[V]],D=L.findIndex(te=>te.id===o);if(D===-1)return{nextState:t,requiresTurnEnd:!0};L[D]={...L[D],isFaceUp:!0};const O=[...t[I].lanes];O[V]=L,a={...t,[I]:{...t[I],lanes:O}};const H=`${L[D].protocol}-${L[D].value}`;a=$(a,S,`${A} reveals ${H}.`),a.actionRequired={type:"prompt_shift_or_flip_board_card_custom",sourceCardId:E,revealedCardId:o,followUpAction:j,optional:R!==!1,actor:S},i=!1;break}default:return{nextState:t,requiresTurnEnd:!0}}if(!l&&a.actionRequired===null){if(a.queuedActions&&a.queuedActions.length>0){const E=[...a.queuedActions],S=E.shift();if((S==null?void 0:S.type)==="execute_remaining_custom_effects")return{nextState:{...Ge(a),actionRequired:null,queuedActions:[S,...E]},requiresTurnEnd:!1};if((S==null?void 0:S.type)==="shift_flipped_card_optional"||(S==null?void 0:S.type)==="gravity_2_shift_after_flip"){const j=fe(a,S.sourceCardId),R=dn(a,S.sourceCardId);if(!j||!j.card.isFaceUp||!R){const A=j?`${j.card.protocol}-${j.card.value}`:"the source card",N=$(a,S.actor,`Shift from ${A} was cancelled because the source is no longer active.`);if(E.length>0){const I=E.shift();return{nextState:{...N,actionRequired:I,queuedActions:E},requiresTurnEnd:!1}}else return{nextState:{...N,actionRequired:null,queuedActions:[]},requiresTurnEnd:!0}}}return{nextState:{...a,actionRequired:S,queuedActions:E},requiresTurnEnd:!1}}}else!l&&a.actionRequired!==null&&(i=!1);return{nextState:a,requiresAnimation:l,requiresTurnEnd:i}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const pd=(t,o,a,i,l)=>{const c={...t[l]},s=c.hand.find(L=>L.id===o);if(!s)return{newState:t};const f=Fm(t,l,a,i,s.protocol);if(!f.allowed)return console.error(`Illegal Move: ${l} tried to play ${s.protocol}-${s.value} - ${f.reason}`),{newState:t};const p=l==="player"?"opponent":"player",h=t[p].lanes[a],y=h.length>0?h[h.length-1]:null;if(y&&y.isFaceUp&&y.protocol==="Plague"&&y.value===0)return{newState:t};if(!i&&y&&y.isFaceUp&&y.protocol==="Metal"&&y.value===2)return console.error(`Illegal Move: ${l} tried to play face-down against Metal-2 in lane ${a}`),{newState:t};if(i){const L=c.protocols[a],D=t[p].protocols[a],O=[...t.player.lanes.flat(),...t.opponent.lanes.flat()].some(W=>W.isFaceUp&&W.protocol==="Psychic"&&W.value===1),H=[...t.player.lanes.flat(),...t.opponent.lanes.flat()].some(W=>W.isFaceUp&&W.protocol==="Anarchy"&&W.value===1),te=md(t),ne=t[l].lanes.flat().some(W=>W.isFaceUp&&W.protocol==="Spirit"&&W.value===1),z=t[l].lanes.some(W=>{if(W.length===0)return!1;const _e=W[W.length-1];return _e.isFaceUp&&_e.protocol==="Chaos"&&_e.value===3}),F=vd(t,l,a);let B;if(H||te?B=s.protocol!==L&&s.protocol!==D&&!O:B=(s.protocol===L||s.protocol===D||ne||z||F)&&!O,!B){const W=H||te?"Non-matching protocol required":"matching protocol required";return console.error(`Illegal Move: ${l} tried to play ${s.protocol}-${s.value} face-up in lane ${a} (${W}, protocols: player=${L}, opponent=${D})`),{newState:t}}}let g={newState:t};const v=t[l].lanes[a];if(v.length>0){const L=v[v.length-1],D={cardOwner:l,actor:l,currentTurn:t.turn,opponent:l==="player"?"opponent":"player",triggerType:"cover"};g=pa(L,a,t,D)}const w=g.newState,C={...w[l]},x={...s,isFaceUp:i,isRevealed:!1},b={...C.stats,cardsPlayed:C.stats.cardsPlayed+1},E={...C,hand:C.hand.filter(L=>L.id!==o),lanes:C.lanes.map((L,D)=>D===a?[...L,x]:L),stats:b};let S={...w,[l]:E,stats:{...w.stats,[l]:b}};const j=t.queuedActions||[],R=w.queuedActions||[];R===j||R.length===j.length&&R.every((L,D)=>L===j[D])?j.length>0&&(S.queuedActions=j):(console.log("[DEBUG] playCard - Merging queuedActions: oldQueue:",j.length,"coverQueue:",R.length),S.queuedActions=[...j,...R]),S.lastPlayedCardId=x.id,S=Ee(S),S=Ie(S,void 0),S=Ye(S,void 0);const A=l==="player"?"Player":"Opponent",N=S[l].protocols[a];let I;if(l==="opponent"&&!i)I=`${A} plays a face-down card into Protocol ${N}.`;else{const L=`${s.protocol}-${s.value}`;I=`${A} plays ${L}`,i||(I+=" face-down"),I+=` into Protocol ${N}.`}if(S=$(S,l,I),S=Ct(S,"after_play",{player:l,cardId:x.id}).newState,w.actionRequired)return i&&(S.queuedEffect={card:x,laneIndex:a}),{newState:S,animationRequests:g.animationRequests};{if(l==="opponent")return i&&(S.queuedEffect={card:x,laneIndex:a}),{newState:S,animationRequests:g.animationRequests};let L={newState:S};if(i&&!S.actionRequired){const O={cardOwner:l,actor:l,currentTurn:S.turn,opponent:l==="player"?"opponent":"player",triggerType:"play"};L=sl(x,a,S,O)}const D=[...g.animationRequests||[],...L.animationRequests||[]];return{newState:L.newState,animationRequests:D.length>0?D:void 0}}},rl=(t,o)=>{console.log("[DEBUG performFillHand] Called for player:",o,"Current hand length:",t[o].hand.length);let a=Ie(t,void 0);a=Ye(a,void 0),a={...a,_logIndentLevel:0};const i=wd(a,o);return console.log("[DEBUG performFillHand] After refresh, hand length:",i[o].hand.length),i},Wh=(t,o)=>t.useControlMechanic&&t.controlCardHolder===o?{...$(t,o,`${o==="player"?"Player":"Opponent"} has Control and may rearrange protocols before refreshing.`),controlCardHolder:null,actionRequired:{type:"prompt_use_control_mechanic",sourceCardId:"CONTROL_MECHANIC",actor:o,originalAction:{type:"fill_hand"}}}:rl(t,o);/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const fd=(t,o)=>{var l,c,s,f;if(!t.actionRequired)return{nextState:t};let a={...t},i=null;switch(t.actionRequired.type){case"select_lane_for_shift_all":{const{cardsToShift:p,validDestinationLanes:h,sourceLaneIndex:y,actor:g,sourceCardId:v}=t.actionRequired;if(!h.includes(o))return console.error(`Illegal shift: Lane ${o} is not a valid destination`),{nextState:t};if(o===y)return console.error(`Illegal shift: Cannot shift to the same lane ${y}`),{nextState:t};let w={...t};const C=[];for(const{cardId:x,owner:b}of p){if(!fe(w,x))continue;const S=w[b].lanes.findIndex(A=>A.some(N=>N.id===x));if(S===-1)continue;const j=kc(w,S,o);if(!j.allowed){console.log(`Card ${x} cannot be shifted: ${j.reason}`);continue}const R=Ln(w,x,b,o,g);w=R.newState,R.animationRequests&&C.push(...R.animationRequests)}a=w,a=Ge(a),a.actionRequired=null,C.length>0&&(i={animationRequests:C,onCompleteCallback:(x,b)=>x.actionRequired||x.queuedActions&&x.queuedActions.length>0?x:b(x)});break}case"select_lane_for_shift":{const{cardToShiftId:p,cardOwner:h,actor:y,sourceEffect:g,originalLaneIndex:v,sourceCardId:w}=t.actionRequired;if(o===v)return console.error(`Illegal shift: Cannot shift to the same lane ${v}`),{nextState:t};const C=fe(t,w),x=fe(t,p);if(C&&C.card.protocol==="Anarchy"&&C.card.value===1&&x&&x.card.isFaceUp){const j=t.player.protocols[o],R=t.opponent.protocols[o],A=x.card.protocol;if(A===j||A===R)return console.error(`Illegal Anarchy-1 shift: ${A}-${x.card.value} cannot be shifted to lane ${o} (protocols: ${j}/${R}) - matching protocol not allowed`),{nextState:t}}if(C&&C.card.protocol==="Gravity"&&C.card.value===1){let j=-1;for(let R=0;R<t[C.owner].lanes.length;R++)if(t[C.owner].lanes[R].some(A=>A.id===w)){j=R;break}if(j!==-1&&!(v===j)&&!(o===j))return console.error(`Illegal Gravity-1 shift: Must shift to or from Gravity lane ${j}, but tried ${v}  ${o}`),{nextState:t}}if(t.actionRequired.destinationRestriction&&x){const j=t.actionRequired.destinationRestriction;if(j.type==="non_matching_protocol"&&x.card.isFaceUp){const R=t.player.protocols[o],A=t.opponent.protocols[o],N=x.card.protocol;if(N===R||N===A)return console.error(`Illegal shift: ${N} cannot be shifted to lane ${o} (protocols: ${R}/${A}) - matching protocol not allowed`),{nextState:t}}if(j.type==="to_or_from_this_lane"){const R=j.laneIndex==="current"&&C?(()=>{for(let A=0;A<t[C.owner].lanes.length;A++)if(t[C.owner].lanes[A].some(N=>N.id===w))return A;return-1})():j.laneIndex;if(R!==void 0&&R!==-1&&!(v===R)&&!(o===R))return console.error(`Illegal shift: Must shift to or from lane ${R}, but tried ${v}  ${o}`),{nextState:t}}}const b=kc(t,v,o);if(!b.allowed)return console.error(`Illegal shift: Cannot shift from lane ${v} to ${o} - ${b.reason}`),{nextState:t};const E=Ln(t,p,h,o,y);a=E.newState;const S=a.actionRequired!==null;if(E.animationRequests)i={animationRequests:E.animationRequests,onCompleteCallback:(j,R)=>{let A=j;if(S){if(g==="speed_3_end"){const H={type:"speed_3_self_flip_after_shift",sourceCardId:t.actionRequired.sourceCardId,actor:y};A.queuedActions=[...A.queuedActions||[],H]}const L=fe(A,w);if(L&&L.card.protocol==="Anarchy"&&L.card.value===0&&L.card.isFaceUp){const O=A[L.owner].lanes.find(te=>te.some(ne=>ne.id===w));if(O&&O.length>0&&O[O.length-1].id===w){const te={type:"anarchy_0_conditional_draw",sourceCardId:w,actor:y};A.queuedActions=[...A.queuedActions||[],te]}else A=$(A,y,"Anarchy-0's conditional draw is cancelled because the card is now covered.")}const D=A._pendingCustomEffects;if(D){console.log(`[laneResolver] Queueing ${D.effects.length} pending effects due to interrupt`);const O=fe(A,D.sourceCardId);if(O&&O.card.isFaceUp){const H=A[O.owner].lanes.find(ne=>ne.some(z=>z.id===D.sourceCardId));if(H&&H.length>0&&H[H.length-1].id===D.sourceCardId){const ne={type:"execute_remaining_custom_effects",sourceCardId:D.sourceCardId,laneIndex:D.laneIndex,effects:D.effects,context:D.context,actor:y};A.queuedActions=[...A.queuedActions||[],ne]}}delete A._pendingCustomEffects}return A}if(g==="speed_3_end"){const L=t.actionRequired.sourceCardId;A=$(A,y,"Speed-3: Flipping itself after shifting a card."),A=Wt(new Set([L]),A),A.animationState={type:"flipCard",cardId:L}}const N=fe(A,w);if(N&&N.card.protocol==="Anarchy"&&N.card.value===0&&N.card.isFaceUp){const L=A[N.owner].lanes.find(O=>O.some(H=>H.id===w));L&&L.length>0&&L[L.length-1].id===w?A=ol(A,y):A=$(A,y,"Anarchy-0's conditional draw is cancelled because the card is now covered.")}const I=A._pendingCustomEffects;if(I){console.log(`[laneResolver] Executing ${I.effects.length} pending effects after shift`);const L=fe(A,I.sourceCardId);if(L&&L.card.isFaceUp){const D=A[L.owner].lanes.find(H=>H.some(te=>te.id===I.sourceCardId));if(D&&D.length>0&&D[D.length-1].id===I.sourceCardId){for(const H of I.effects)A=hn(L.card,I.laneIndex,A,I.context,H).newState;delete A._pendingCustomEffects}else A=$(A,y,"Pending effects cancelled because source card is now covered."),delete A._pendingCustomEffects}else delete A._pendingCustomEffects}if(w&&(A=jn(A)),A=Ct(A,"after_shift",{player:y,cardId:p}).newState,A=Ge(A),A.actionRequired=null,A.queuedActions&&A.queuedActions.length>0){const L=A.queuedActions[0];L.type==="execute_remaining_custom_effects"?(A=Yn(A),A.animationState&&(A={...A,animationState:null})):(A.queuedActions=A.queuedActions.slice(1),A.actionRequired=L)}return R(A)}};else if(S){if(g==="speed_3_end"){const A={type:"speed_3_self_flip_after_shift",sourceCardId:t.actionRequired.sourceCardId,actor:y};a.queuedActions=[...a.queuedActions||[],A]}const j=fe(a,w);if(j&&j.card.protocol==="Anarchy"&&j.card.value===0&&j.card.isFaceUp){const R=a[j.owner].lanes.find(N=>N.some(I=>I.id===w));if(R&&R.length>0&&R[R.length-1].id===w){const N={type:"anarchy_0_conditional_draw",sourceCardId:w,actor:y};a.queuedActions=[...a.queuedActions||[],N]}else a=$(a,y,"Anarchy-0's conditional draw is cancelled because the card is now covered.")}}else{if(g==="speed_3_end"){const N=t.actionRequired.sourceCardId;a=$(a,y,"Speed-3: Flipping itself after shifting a card."),a=Wt(new Set([N]),a),a.animationState={type:"flipCard",cardId:N}}const j=a._pendingCustomEffects;if(j){console.log(`[laneResolver NO ANIM] Executing ${j.effects.length} pending effects after shift`);const N=fe(a,j.sourceCardId);if(N&&N.card.isFaceUp){const I=a[N.owner].lanes.find(L=>L.some(D=>D.id===j.sourceCardId));if(I&&I.length>0&&I[I.length-1].id===j.sourceCardId){for(const L of j.effects)a=hn(N.card,j.laneIndex,a,j.context,L).newState;delete a._pendingCustomEffects}else a=$(a,y,"Pending effects cancelled because source card is now covered."),delete a._pendingCustomEffects}else delete a._pendingCustomEffects}const R=fe(a,w);if(R&&R.card.protocol==="Anarchy"&&R.card.value===0&&R.card.isFaceUp){const N=a[R.owner].lanes.find(V=>V.some(L=>L.id===w));N&&N.length>0&&N[N.length-1].id===w?a=ol(a,y):a=$(a,y,"Anarchy-0's conditional draw is cancelled because the card is now covered.")}if(w&&(a=jn(a)),a=Ct(a,"after_shift",{player:y,cardId:p}).newState,a=Ge(a),a.actionRequired=null,a.queuedActions&&a.queuedActions.length>0){const N=a.queuedActions[0];if(N.type==="execute_remaining_custom_effects"){if(a=Yn(a),a.animationState&&!a.actionRequired){const I=a.animationState;I.type==="draw"&&(i={animationRequests:[{type:"draw",player:I.player,count:I.count}],onCompleteCallback:(V,L)=>{const D={...V,animationState:null};return L(D)}},a={...a,animationState:null})}}else a.queuedActions=a.queuedActions.slice(1),a.actionRequired=N}}break}case"shift_flipped_card_optional":{const p=t.actionRequired.cardId,h=t.actionRequired.actor;let y=null;for(const v of["player","opponent"])if(t[v].lanes.flat().some(w=>w.id===p)){y=v;break}if(!y){console.error("[shift_flipped_card_optional] Card not found on board:",p),a=t;break}const g=Ln(t,p,y,o,h);a=g.newState,g.animationRequests&&(i={animationRequests:g.animationRequests,onCompleteCallback:(v,w)=>w(v)});break}case"select_lane_for_play":{const{cardInHandId:p,isFaceDown:h,actor:y,source:g}=t.actionRequired;if(g==="deck"){console.log("[select_lane_for_play] Playing from deck to lane",o);const E={...t,actionRequired:null},S=E[y],{drawnCards:j,remainingDeck:R,newDiscard:A}=on(S.deck,S.discard,1);if(j.length===0){console.error("No cards in deck/discard to play"),a=E;break}const N={...j[0],id:Oe(),isFaceUp:!h},I=[...S.lanes];I[o]=[...I[o],N];const V={...S,lanes:I,deck:R,discard:A};a={...E,[y]:V},i={animationRequests:[{type:"play",cardId:N.id,owner:y,laneIndex:o,isFaceUp:N.isFaceUp}],onCompleteCallback:(L,D)=>D(L)};break}const v=t[y].hand.find(E=>E.id===p);if(!v){console.error("Card for play not found in hand"),a={...t,actionRequired:null};break}const w={...t,actionRequired:null};let C;if(typeof h=="boolean")C=!h;else{const E=t[y].lanes.flat().some(A=>A.isFaceUp&&A.protocol==="Spirit"&&A.value===1),S=t[y].lanes.some(A=>{if(A.length===0)return!1;const N=A[A.length-1];return N.isFaceUp&&N.protocol==="Chaos"&&N.value===3}),j=y==="player"?"opponent":"player",R=t[j].lanes.flat().some(A=>A.isFaceUp&&A.protocol==="Psychic"&&A.value===1);C=(E||S||v.protocol===t[y].protocols[o]||v.protocol===t[j].protocols[o])&&!R}const{newState:x,animationRequests:b}=pd(w,p,o,C,y);a=x,console.log("[LANE RESOLVER] After playCard - actionRequired?",((l=a.actionRequired)==null?void 0:l.type)||"null","queuedActions?",((c=a.queuedActions)==null?void 0:c.length)||0,"animationRequests?",(b==null?void 0:b.length)||0),b&&(i={animationRequests:b,onCompleteCallback:(E,S)=>{var j;return console.log("[PLAY CALLBACK] Animation complete. queuedActions?",((j=E.queuedActions)==null?void 0:j.length)||0),E.queuedActions&&E.queuedActions.length>0&&console.log("[PLAY CALLBACK] Queue found! First action:",E.queuedActions[0].type),console.log("[PLAY CALLBACK] Calling endTurnCb"),S(E)}});break}case"select_lane_for_delete":{const p=t.actionRequired.actor,h=p==="player"?"Player":"Opponent",y=t.player.protocols[o],g=t.actionRequired.targetFilter||{},v=fe(t,t.actionRequired.sourceCardId),w=v?`${v.card.protocol}-${v.card.value}`:"a card effect";a=$(a,p,`${w}: ${h} targets Protocol ${y}.`);const C=[],x=[];for(const b of["player","opponent"]){const E=t[b],S=E.lanes[o].some(j=>j.isFaceUp&&j.protocol==="Darkness"&&j.value===2)?4:2;for(const j of E.lanes[o]){const R=j.isFaceUp?j.value:S;if(g.valueRange){const{min:I,max:V}=g.valueRange;if(R<I||R>V)continue}if(g.faceState==="face_up"&&!j.isFaceUp||g.faceState==="face_down"&&j.isFaceUp||g.owner==="own"&&b!==p||g.owner==="opponent"&&b===p)continue;C.push({type:"delete",cardId:j.id,owner:b});const A=b==="player"?"Player's":"Opponent's",N=j.isFaceUp?`${j.protocol}-${j.value}`:"a face-down card";x.push(`${A} ${N}`)}}if(x.length>0){a=$(a,p,`${w}: Deleting ${x.join(", ")}.`);const b={...a.stats[p],cardsDeleted:a.stats[p].cardsDeleted+x.length},E={...a[p],stats:b};a={...a,[p]:E,stats:{...a.stats,[p]:b}}}a=Ge(a),a.actionRequired=null,C.length>0&&(i={animationRequests:C,onCompleteCallback:(b,E)=>{let S=b;for(let R=0;R<C.length;R++)S=Gn(S,p);return S=Ct(S,"after_delete",{player:p}).newState,E(S)}});break}case"select_lane_for_return":{const p=t.actionRequired.actor,h=p==="player"?"Player":"Opponent",y=t.player.protocols[o],g=t.actionRequired.targetFilter||{},v=fe(t,t.actionRequired.sourceCardId),w=v?`${v.card.protocol}-${v.card.value}`:"a card effect";a=$(a,p,`${w}: ${h} targets Protocol ${y}.`);const C=[],x=[];for(const b of["player","opponent"]){const E=t[b],S=E.lanes[o].some(j=>j.isFaceUp&&j.protocol==="Darkness"&&j.value===2)?4:2;for(const j of E.lanes[o]){const R=j.isFaceUp?j.value:S;if(g.valueEquals!==void 0&&R!==g.valueEquals||g.faceState==="face_up"&&!j.isFaceUp||g.faceState==="face_down"&&j.isFaceUp||g.owner==="own"&&b!==p||g.owner==="opponent"&&b===p)continue;C.push({type:"return",cardId:j.id,owner:b});const A=b==="player"?"Player's":"Opponent's",N=j.isFaceUp?`${j.protocol}-${j.value}`:"a face-down card";x.push(`${A} ${N}`)}}if(C.length===0){a=$(a,p,`${w}: No matching cards in Protocol ${y}.`),a=Ge(a),a.actionRequired=null;break}x.length>0&&(a=$(a,p,`${w}: Returning ${x.join(", ")}.`)),a=Ge(a),a.actionRequired=null,C.length>0&&(i={animationRequests:C,onCompleteCallback:(b,E)=>E(b)});break}case"select_lane_for_death_2":{const p=t.actionRequired.actor,h=p==="player"?"Player":"Opponent",y=t.player.protocols[o];a=$(a,p,`Death-2: ${h} targets Protocol ${y}.`);const g=[],v=[];for(const w of["player","opponent"]){const C=t[w],x=C.lanes[o].some(b=>b.isFaceUp&&b.protocol==="Darkness"&&b.value===2)?4:2;for(const b of C.lanes[o]){const E=b.isFaceUp?b.value:x;if(E===1||E===2){g.push({type:"delete",cardId:b.id,owner:w});const S=w==="player"?"Player's":"Opponent's",j=b.isFaceUp?`${b.protocol}-${b.value}`:"a face-down card";v.push(`${S} ${j}`)}}}if(v.length>0){const w=fe(t,t.actionRequired.sourceCardId),C=w?`${w.card.protocol}-${w.card.value}`:"Death-2";a=$(a,p,`${C}: Deleting ${v.join(", ")}.`);const x={...a.stats[p],cardsDeleted:a.stats[p].cardsDeleted+v.length},b={...a[p],stats:x};a={...a,[p]:b,stats:{...a.stats,[p]:x}}}a=Ge(a),a.actionRequired=null,g.length>0&&(i={animationRequests:g,onCompleteCallback:(w,C)=>{let x=w;for(let E=0;E<g.length;E++)x=Gn(x,p);return x=Ct(x,"after_delete",{player:p}).newState,C(x)}});break}case"select_lane_for_metal_3_delete":{const p=t.actionRequired.actor,h=p==="player"?"Player":"Opponent",y=t.player.protocols[o],g=t.player.lanes[o].length+t.opponent.lanes[o].length;if(g<8){a=$(a,p,`Metal-3: ${h} cannot delete Protocol ${y} (only ${g} cards, need 8+).`),a=Ge(a),a.actionRequired=null;break}a=$(a,p,`Metal-3: ${h} targets Protocol ${y} for deletion.`);const v=[];for(const x of["player","opponent"])for(const b of t[x].lanes[o])v.push({type:"delete",cardId:b.id,owner:x});const w={...a.stats[p],cardsDeleted:a.stats[p].cardsDeleted+v.length},C={...a[p],stats:w};a={...a,[p]:C,stats:{...a.stats,[p]:w}},a=Ge(a),a.actionRequired=null,v.length>0&&(i={animationRequests:v,onCompleteCallback:(x,b)=>{let E=x;for(let j=0;j<v.length;j++)E=Gn(E,p);return E=Ct(E,"after_delete",{player:p}).newState,b(E)}});break}case"select_lane_for_life_3_play":{const{actor:p}=t.actionRequired,h={...t,actionRequired:null};let y=h,g={newState:y};const v=h[p].lanes[o].length>0?h[p].lanes[o][h[p].lanes[o].length-1]:null;if(v){const E={cardOwner:p,actor:p,currentTurn:h.turn,opponent:p==="player"?"opponent":"player",triggerType:"cover"};g=pa(v,o,h,E),y=g.newState}const w={...y[p]},{drawnCards:C,remainingDeck:x,newDiscard:b}=on(w.deck,w.discard,1);if(C.length>0){const E={...C[0],id:Oe(),isFaceUp:!1},S=[...w.lanes];S[o]=[...S[o],E];const j={...w,lanes:S,deck:x,discard:b};a={...y,[p]:j},a=$(a,p,"Life-3 On-Cover: Plays a card face-down."),g.animationRequests&&(i={animationRequests:g.animationRequests,onCompleteCallback:(R,A)=>A(R)})}else a=y;break}case"select_lane_to_shift_revealed_card_for_light_2":{const{revealedCardId:p,actor:h}=t.actionRequired,y=fe(t,p);if(y){const g=Ln(t,p,y.owner,o,h);a=g.newState,g.animationRequests&&(i={animationRequests:g.animationRequests,onCompleteCallback:(v,w)=>v.actionRequired?v:w(v)})}break}case"select_lane_to_shift_revealed_board_card_custom":{const{revealedCardId:p,actor:h}=t.actionRequired,y=fe(t,p);if(y){const g=Ln(t,p,y.owner,o,h);a=g.newState,g.animationRequests&&(i={animationRequests:g.animationRequests,onCompleteCallback:(v,w)=>v.actionRequired?v:w(v)})}break}case"select_lane_to_shift_cards_for_light_3":{const{sourceLaneIndex:p,actor:h}=t.actionRequired,y=h==="player"?"opponent":"player",g=t[h].lanes[p].filter(S=>!S.isFaceUp),v=t[y].lanes[p].filter(S=>!S.isFaceUp),w=t[h].lanes.map((S,j)=>j===p?S.filter(R=>R.isFaceUp):j===o?[...S,...g]:S),C=t[y].lanes.map((S,j)=>j===p?S.filter(R=>R.isFaceUp):j===o?[...S,...v]:S),x=g.length+v.length,b={...t.stats[h],cardsShifted:t.stats[h].cardsShifted+x},E={...t[h],lanes:w,stats:b};if(a={...t,[h]:E,[y]:{...t[y],lanes:C},stats:{...t.stats,[h]:b},actionRequired:null},x>0){const S=t[h].protocols[p],j=t[h].protocols[o];a=$(a,h,`Light-3: Shifts ${x} face-down card(s) from Protocol ${S} to Protocol ${j}.`)}break}case"select_lane_for_water_3":{const p=t.actionRequired.actor,h=p==="player"?"opponent":"player",y={...t[p]},g={...t[h]},v=y.lanes[o].filter(E=>Et(E,y.lanes[o])===2),w=g.lanes[o].filter(E=>Et(E,g.lanes[o])===2);if(v.length===0&&w.length===0){a={...t,actionRequired:null};break}const C=new Set(v.map(E=>E.id)),x=new Set(w.map(E=>E.id));y.lanes[o]=y.lanes[o].filter(E=>!C.has(E.id)),g.lanes[o]=g.lanes[o].filter(E=>!x.has(E.id)),y.hand.push(...v),g.hand.push(...w),a={...t,[p]:y,[h]:g,actionRequired:null};const b=v.length+w.length;if(b>0){const E=p==="player"?"Player":"Opponent",S=fe(t,t.actionRequired.sourceCardId),j=S?`${S.card.protocol}-${S.card.value}`:"a card effect";a=$(a,p,`${j}: ${E} selects ${["left","middle","right"][o]} lane and returns ${b} card(s) with value 2 (Player: ${v.length}, Opponent: ${w.length}).`)}break}default:return{nextState:t}}return console.log("[LANE RESOLVER END] Returning - actionRequired?",((s=a.actionRequired)==null?void 0:s.type)||"null","queuedActions?",((f=a.queuedActions)==null?void 0:f.length)||0,"requiresAnimation?",i?"yes":"no"),{nextState:Ee(a),requiresAnimation:i}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const vh=(t,o)=>{const a=o==="player"?"opponent":"player";if(t[a].lanes.flat().some(c=>c.isFaceUp&&c.protocol==="Plague"&&c.value===1)){let c={...t};return c=Ie(c,"Plague-1"),c=Ye(c,void 0),c=$(c,a,"Triggers after opponent discards: Draw 1 card."),c=tt(c,a,1),c=Ie(c,void 0),c}return t};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const wh=(t,o)=>{if(t.processedSpeed1TriggerThisTurn)return t;if(t[o].lanes.flat().some(l=>l.isFaceUp&&l.protocol==="Speed"&&l.value===1)){let l={...t};return l=Ie(l,"Speed-1"),l=Ye(l,void 0),l=$(l,o,"Triggers after clearing cache: Draw 1 card."),l=tt(l,o,1),l.processedSpeed1TriggerThisTurn=!0,l=Ie(l,void 0),l.phase="end",l}return t},ua=(t,o,a)=>{var I,V,L;const i=t[a],l=new Set(o),c=i.hand.filter(D=>l.has(D.id));if(c.length===0)return t;const s=i.hand.filter(D=>!l.has(D.id)),f=[...i.discard,...c.map(({id:D,isFaceUp:O,...H})=>H)],p=((I=t.animationState)==null?void 0:I.type)==="discardCard"&&((V=t.animationState.originalAction)==null?void 0:V.type)==="discard"?t.animationState.originalAction:((L=t.actionRequired)==null?void 0:L.type)==="discard"?t.actionRequired:null,h={...i.stats,cardsDiscarded:i.stats.cardsDiscarded+c.length},y={...i,hand:s,discard:f,stats:h},g=p==null?void 0:p.followUpEffect,v=p==null?void 0:p.conditionalType,w=p==null?void 0:p.previousHandSize;let C={...t,[a]:y,stats:{...t.stats,[a]:h},actionRequired:g?{type:"discard_completed",followUpEffect:g,conditionalType:v,previousHandSize:w,sourceCardId:p==null?void 0:p.sourceCardId,actor:a}:null};if(p!=null&&p.sourceCardId){const D=C.player.lanes.flat().find(O=>O.id===p.sourceCardId)||C.opponent.lanes.flat().find(O=>O.id===p.sourceCardId);if(D){const O=`${D.protocol}-${D.value}`;C=Ie(C,O),C=Ye(C,"middle")}else C=Ie(C,void 0),C=Ye(C,void 0),C={...C,_logIndentLevel:0}}else C=Ie(C,void 0),C=Ye(C,void 0),C={...C,_logIndentLevel:0};const x=a==="player"?"Player":"Opponent";let b;if(a==="player"||c.every(D=>D.isRevealed)){const D=c.map(O=>`${O.protocol}-${O.value}`).join(", ");b=`${x} discards ${D}.`}else{const D=c.length===1?"card":"cards";b=`${x} discards ${c.length} ${D}.`}C=$(C,a,b);const E=(D,O)=>{const H=t.phase==="hand_limit"&&!(O!=null&&O.sourceCardId);let te=D;H&&(te=wh(te,a),te=Ct(te,"after_clear_cache",{player:a}).newState);const ne=vh(te,a),B=Ct(ne,"after_opponent_discard",{player:a==="player"?"opponent":"player"}).newState;return Bh(B,a,O==null?void 0:O.sourceEffect,O==null?void 0:O.sourceCardId)};if(p&&p.actor===a){const D=p.count-o.length;return D>0?(C.actionRequired={...p,count:D},C):E(C,p)}const S=t.actionRequired;if(S&&S.type==="discard"&&S.actor===a){const D=S.count-o.length;return D>0?(C.actionRequired={...S,count:D},C):E(C,S)}const j=t.phase==="hand_limit";let R=vh(C,a);return R=Ct(R,"after_opponent_discard",{player:a==="player"?"opponent":"player"}).newState,j&&(R=wh(R,a),R=Ct(R,"after_clear_cache",{player:a}).newState),R},P0=(t,o)=>{var s;if(((s=t.actionRequired)==null?void 0:s.type)!=="plague_2_player_discard")return t;const a=t.actionRequired.actor,i=a==="player"?"opponent":"player";let l=ua(t,o,a);const c=o.length+1;return l[i].hand.length>0?l.actionRequired={type:"discard",actor:i,count:Math.min(c,l[i].hand.length),sourceCardId:t.actionRequired.sourceCardId}:(l=Ge(l),l.actionRequired=null),l},hd=(t,o)=>{var s;if(((s=t.actionRequired)==null?void 0:s.type)!=="plague_2_opponent_discard")return t;const a=t.actionRequired.actor,i=a==="player"?"opponent":"player";let l=ua(t,o,a);const c=o.length+1;return l[i].hand.length>0?l.actionRequired={type:"discard",actor:i,count:Math.min(c,l[i].hand.length),sourceCardId:t.actionRequired.sourceCardId}:(l=Ge(l),l.actionRequired=null),l},Ch=(t,o)=>{var p,h,y;const a=((p=t.actionRequired)==null?void 0:p.type)==="discard"&&((h=t.actionRequired)==null?void 0:h.variableCount),i=((y=t.actionRequired)==null?void 0:y.type)==="select_cards_from_hand_to_discard_for_fire_4";if(!a&&!i)return t;const l=t.actionRequired.actor,c=t.actionRequired.sourceCardId;let s=ua(t,o,l);if(a&&c)return Bh(s,l,void 0,c);const f=o.length+1;return s=$(s,l,`Fire-4: Drawing ${f} card(s).`),s=tt(s,l,f),s},td=(t,o)=>{var p;if(((p=t.actionRequired)==null?void 0:p.type)!=="select_cards_from_hand_to_discard_for_hate_1")return t;const{sourceCardId:a,actor:i}=t.actionRequired;let l=ua(t,o,i);const s=x0(l,[]),f=Math.min(2,s);return f>0?l.actionRequired={type:"select_cards_to_delete",count:f,sourceCardId:a,disallowedIds:[],actor:i}:(l=$(l,i,"Hate-1: No valid targets to delete."),l=Ge(l),l.actionRequired=null),l};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const nl=(t,o,a)=>{const i=t.turn,l=i==="player"?"opponent":"player";let c={...t};if(c.compileBlockedPlayer===i&&c.compileBlockedUntilTurn>(c.turnNumber||0)){const O=i==="player"?"Player":"Opponent";return console.log(`[Compile Block] ${O}'s compile is blocked until turn ${c.compileBlockedUntilTurn}`),c=$(c,i,`${O} can't compile - blocked by opponent's effect.`),c}if(c.useControlMechanic&&c.controlCardHolder===i){const O=i==="player"?"Player":"Opponent";return c=Ie(c,void 0),c=Ye(c,void 0),c={...c,_logIndentLevel:0},c=$(c,i,`${O} has Control and may rearrange protocols before compiling.`),c.actionRequired={type:"prompt_use_control_mechanic",sourceCardId:"CONTROL_MECHANIC",actor:i,originalAction:{type:"compile",laneIndex:o}},c.controlCardHolder=null,c}let p={...c[i]},h={...c[l]};const y=p.compiled[o],g=[];for(const O of[i,l])c[O].lanes[o].forEach(te=>{if(te.isFaceUp){const ne=te;ne.customEffects&&ne.customEffects.topEffects&&ne.customEffects.topEffects.some(F=>F.trigger==="before_compile_delete")&&g.push({card:te,owner:O})}});for(const{card:O,owner:H}of g)console.log(`[before_compile_delete] Executing effect for custom card ${O.protocol}-${O.value}`),c=Ct(c,"before_compile_delete",{player:H,cardId:O.id}).newState;p={...c[i]},h={...c[l]};const v=[],w=[],C=p.lanes[o].filter(O=>O.protocol==="Speed"&&O.value===2&&O.isFaceUp?(v.push(O),!1):!0),x=h.lanes[o].filter(O=>O.protocol==="Speed"&&O.value===2&&O.isFaceUp?(w.push(O),!1):!0),b={...p.stats,cardsDeleted:p.stats.cardsDeleted+C.length},E={...h.stats,cardsDeleted:h.stats.cardsDeleted+x.length};p.stats=b,h.stats=E,p.discard=[...p.discard,...C.map(({id:O,isFaceUp:H,...te})=>te)],h.discard=[...h.discard,...x.map(({id:O,isFaceUp:H,...te})=>te)];const S=[...p.lanes];S[o]=v,p.lanes=S;const j=[...h.lanes];j[o]=w,h.lanes=j;const R=[...p.compiled];R[o]=!0,p.compiled=R,c={...c,[i]:p,[l]:h,stats:{...c.stats,[i]:b,[l]:E}},c=Ie(c,void 0),c=Ye(c,void 0),c={...c,_logIndentLevel:0};const A=i==="player"?"Player":"Opponent",N=p.protocols[o];if(c=$(c,i,`${A} compiles Protocol ${N}!`),y&&(c=$(c,i,`${A} draws 1 card from the opponent's deck as a re-compile reward.`),c=zh(c,i,1)),c=Ee(c),p.compiled.every(O=>O===!0))return c.winner=i,a(i,c),c;C.length+x.length>0&&(c=Gn(c,i),c=Ct(c,"after_delete",{player:i}).newState);const D=[...v,...w].map(O=>{const H=fe(c,O.id).owner;return c=$(c,H,"Speed-2 survives compilation and must be shifted."),{type:"select_lane_for_shift",cardToShiftId:O.id,cardOwner:H,originalLaneIndex:o,sourceCardId:O.id,actor:H}});if(D.length>0){const O=D.shift();c.actionRequired=O,c.queuedActions=D,O.actor!==i&&(c._interruptedTurn=i,c._interruptedPhase=c.phase,c.turn=O.actor)}else c.actionRequired=null,c.queuedActions=[];return c},Qh=(t,o)=>t,I0=(t,o)=>{var h;if(((h=t.actionRequired)==null?void 0:h.type)!=="select_card_from_hand_to_play")return t;const{disallowedLaneIndex:a,sourceCardId:i,isFaceDown:l,actor:c,destinationRule:s,condition:f,faceDown:p}=t.actionRequired;return{...t,actionRequired:{type:"select_lane_for_play",cardInHandId:o,disallowedLaneIndex:a,sourceCardId:i,isFaceDown:l||p,actor:c,destinationRule:s,condition:f}}},xh=t=>{if(!t.actionRequired||!("optional"in t.actionRequired)||!t.actionRequired.optional)return t;const o="actor"in t.actionRequired?t.actionRequired.actor:t.turn,a=o==="player"?"Player":"Opponent";let i={...t,actionRequired:null};return i=$(i,o,`${a} skips the optional action.`),i},Sh=t=>{var c;if(((c=t.actionRequired)==null?void 0:c.type)!=="reveal_opponent_hand")return t;const o=t.actionRequired.actor,a=o==="player"?"opponent":"player";let i={...t};const l={...i[a]};if(l.hand.length>0){l.hand=l.hand.map(p=>({...p,isRevealed:!0})),i[a]=l;const s=fe(i,t.actionRequired.sourceCardId),f=s?`${s.card.protocol}-${s.card.value}`:"A card effect";i=$(i,o,`${f}: Opponent reveals their hand.`)}return i.actionRequired=null,i},bh=(t,o)=>Go(t,o),Eh=(t,o)=>jc(t,o).newState;/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Rh=(t,o)=>{var p,h;if(console.log("[DEBUG resolveOptionalDrawPrompt] Called with accept:",o,"actionRequired type:",(p=t.actionRequired)==null?void 0:p.type),((h=t.actionRequired)==null?void 0:h.type)!=="prompt_optional_draw")return console.log("[DEBUG resolveOptionalDrawPrompt] Type mismatch! Returning prev state."),t;const{sourceCardId:a,actor:i,count:l,drawingPlayer:c}=t.actionRequired,s=i.charAt(0).toUpperCase()+i.slice(1);let f={...t};if(o){f=$(f,i,`${s} chooses to draw ${l} card${l!==1?"s":""}.`),f=tt(f,c||i,l);const y=t.actionRequired.followUpEffect;if(y){const g=fe(f,a);if(g){const v=f[g.owner].lanes.findIndex(b=>b.some(E=>E.id===a)),w=i==="player"?"opponent":"player",C={cardOwner:i,actor:i,currentTurn:f.turn,opponent:w,triggerType:"start"};f=hn(g.card,v,f,C,y).newState,f=Ge(f)}else f.actionRequired=null}else f.actionRequired=null}else f=$(f,i,`${s} skips the draw.`),f.actionRequired=null;return f},Ah=(t,o)=>{var s;if(((s=t.actionRequired)==null?void 0:s.type)!=="prompt_death_1_effect")return t;const{sourceCardId:a,actor:i}=t.actionRequired,l=i.charAt(0).toUpperCase()+i.slice(1);let c={...t};return o?(c=$(c,i,`Death-1: ${l} chooses to draw and delete.`),c=tt(c,i,1),c.actionRequired={type:"select_card_to_delete_for_death_1",sourceCardId:a,actor:i}):(c=$(c,i,`Death-1: ${l} skips the effect.`),c.actionRequired=null),c},nd=(t,o)=>{var c;if(((c=t.actionRequired)==null?void 0:c.type)!=="prompt_give_card_for_love_1")return t;const{actor:a}=t.actionRequired,i=a.charAt(0).toUpperCase()+a.slice(1);let l={...t};return o?(l=$(l,a,`Love-1 End: ${i} chooses to give 1 card to draw 2.`),l.actionRequired={type:"select_card_from_hand_to_give",sourceCardId:t.actionRequired.sourceCardId,sourceEffect:"love_1_end",actor:a}):(l=$(l,a,`Love-1 End: ${i} skips the effect.`),l.actionRequired=null),l},jh=(t,o,a)=>{var l;if(((l=t.actionRequired)==null?void 0:l.type)!=="plague_4_player_flip_optional")return t;let i={...t,actionRequired:null};if(i=Ie(i,"Plague-4"),i=Ye(i,"end"),o){const{sourceCardId:c}=t.actionRequired;i=$(i,a,`${a==="player"?"Player":"Opponent"} chooses to flip the card.`),i=Wt(new Set([c]),i),i.animationState={type:"flipCard",cardId:c}}else i=$(i,a,`${a==="player"?"Player":"Opponent"} skips flipping the card.`);return i=Ie(i,void 0),i=Ye(i,void 0),i=jn(i),i},kh=(t,o)=>{var c;if(((c=t.actionRequired)==null?void 0:c.type)!=="prompt_fire_3_discard")return t;const{actor:a}=t.actionRequired,i=a.charAt(0).toUpperCase()+a.slice(1);let l={...t};return o?(l=$(l,a,`Fire-3 End: ${i} chooses to discard 1 to flip 1.`),l.actionRequired={type:"discard",actor:a,count:1,sourceCardId:t.actionRequired.sourceCardId,sourceEffect:"fire_3"}):(l=$(l,a,`Fire-3 End: ${i} skips the effect.`),l.actionRequired=null),l},Dh=(t,o)=>{var h,y,g;if(((h=t.actionRequired)==null?void 0:h.type)!=="prompt_optional_discard_custom")return t;const{actor:a,count:i,sourceCardId:l}=t.actionRequired,c=a.charAt(0).toUpperCase()+a.slice(1);let s={...t};const f=(y=t.actionRequired)==null?void 0:y.followUpEffect,p=(g=t.actionRequired)==null?void 0:g.conditionalType;return o?(s=$(s,a,`${c} chooses to discard ${i} card(s).`),s.actionRequired={type:"discard",actor:a,count:i,sourceCardId:l,followUpEffect:f,conditionalType:p,previousHandSize:s[a].hand.length}):(s=$(s,a,`${c} skips the discard.`),s.actionRequired=null),s},M0=(t,o)=>{var p,h,y;if(console.log("[DEBUG resolveOptionalEffectPrompt] Called with accept:",o,"actionRequired type:",(p=t.actionRequired)==null?void 0:p.type),((h=t.actionRequired)==null?void 0:h.type)!=="prompt_optional_effect")return t;const{actor:a,sourceCardId:i,effectDef:l,laneIndex:c}=t.actionRequired;console.log("[DEBUG resolveOptionalEffectPrompt] effectDef:",l.id,"has conditional?",!!l.conditional);const s=a.charAt(0).toUpperCase()+a.slice(1);let f={...t};if(o){const g=l.params.action;f=$(f,a,`${s} chooses to execute the optional ${g} effect.`),f.actionRequired=null;const v=[...f.player.lanes.flat(),...f.opponent.lanes.flat()].find(b=>b.id===i);if(!v)return console.error("[Optional Effect] Source card not found!"),f;const w={cardOwner:a,opponent:a==="player"?"opponent":"player",currentTurn:f.turn,actor:a},C={...l,params:{...l.params,optional:!1},conditional:void 0},x=hn(v,c,f,w,C);return console.log("[DEBUG resolveOptionalEffectPrompt] After executeCustomEffect, actionRequired:",((y=x.newState.actionRequired)==null?void 0:y.type)||"null"),l.conditional&&l.conditional.type==="if_executed"&&l.conditional.thenEffect?(console.log("[DEBUG resolveOptionalEffectPrompt] Executing if_executed followUp:",l.conditional.thenEffect.id),hn(v,c,x.newState,w,l.conditional.thenEffect).newState):x.newState}else{const g=l.params.action;return f=$(f,a,`${s} skips the optional ${g} effect.`),f.actionRequired=null,f}},Th=(t,o)=>{var s;if(((s=t.actionRequired)==null?void 0:s.type)!=="prompt_shift_for_speed_3")return t;const{actor:a,sourceCardId:i}=t.actionRequired,l=a.charAt(0).toUpperCase()+a.slice(1);let c={...t};if(o){const f=[];for(const p of c[a].lanes)if(p.length>0){const h=p[p.length-1];h.id!==i&&f.push(h)}f.length>0?(c=$(c,a,`Speed-3 End: ${l} chooses to shift a card.`),c.actionRequired={type:"select_own_card_to_shift_for_speed_3",sourceCardId:i,actor:a}):(c=$(c,a,`Speed-3 End: ${l} has no cards to shift, skipping effect.`),c.actionRequired=null)}else c=$(c,a,`Speed-3 End: ${l} skips the shift.`),c.actionRequired=null;return c},od=(t,o)=>{var f;if(((f=t.actionRequired)==null?void 0:f.type)!=="prompt_shift_or_flip_for_light_2")return t;const{actor:a,sourceCardId:i,revealedCardId:l}=t.actionRequired,c=a.charAt(0).toUpperCase()+a.slice(1);let s={...t};switch(o){case"shift":s=$(s,a,`Light-2: ${c} chooses to shift the revealed card.`),s.actionRequired={type:"select_lane_to_shift_revealed_card_for_light_2",sourceCardId:i,revealedCardId:l,actor:a};break;case"flip":{s=$(s,a,`Light-2: ${c} chooses to flip the revealed card face-up.`);const p={...s,actionRequired:null};let h=Wt(new Set([l]),p);h.animationState={type:"flipCard",cardId:l},s=wo(h,l).newState;break}case"skip":s=$(s,a,`Light-2: ${c} chooses to do nothing with the revealed card.`),s.actionRequired=null;break}return s},ad=(t,o,a)=>{var j;if(((j=t.actionRequired)==null?void 0:j.type)!=="prompt_rearrange_protocols")return t;const i=Nm(t);if(!i.allowed)return console.error(`Protocol rearrangement blocked: ${i.reason}`),t;const{target:l,actor:c,originalAction:s,sourceCardId:f,disallowedProtocolForLane:p}=t.actionRequired;if(p){const{laneIndex:R,protocol:A}=p;if(o[R]===A)return console.error(`Illegal rearrange: ${A} cannot be placed on lane ${R} due to Anarchy-3 restriction`),t}let h={...t};const y={...h[l]},g={};y.protocols.forEach((R,A)=>{g[R]=y.compiled[A]});const v=o.map(R=>g[R]);y.protocols=o,y.compiled=v,h[l]=y,h.actionRequired=null;const w=h._pendingCustomEffects;if(w&&w.effects.length>0){console.log("[resolveRearrangeProtocols] Found pending effects:",w.effects.length);const R={type:"execute_remaining_custom_effects",sourceCardId:w.sourceCardId,laneIndex:w.laneIndex,effects:w.effects,context:w.context,actor:c};h.queuedActions=[...h.queuedActions||[],R],delete h._pendingCustomEffects,console.log("[resolveRearrangeProtocols] Queued pending effects")}let C="Control Action";if(f!=="CONTROL_MECHANIC"){const R=[...h.player.lanes.flat(),...h.opponent.lanes.flat()].find(A=>A.id===f);R&&(C=`${R.protocol}-${R.value}`)}const x=c.charAt(0).toUpperCase()+c.slice(1),b=l===c?"their own":"the opponent's",E=o.join(" | ");h=$(h,c,`${C}: ${x} rearranges ${b} protocols.`),h=$(h,c,`New protocol order for ${l}: ${E}`);let S=Ee(h);if(s){if(console.log("[DEBUG resolveRearrangeProtocols] originalAction:",s),s.type==="compile")return S=$(S,c,"Resuming Compile action..."),nl(S,s.laneIndex,a);if(s.type==="fill_hand"){console.log("[DEBUG resolveRearrangeProtocols] Calling performFillHand for actor:",c,"hand before:",S[c].hand.length),S=$(S,c,"Resuming Refresh action...");const R=rl(S,c);return console.log("[DEBUG resolveRearrangeProtocols] After performFillHand, hand length:",R[c].hand.length),console.log("[DEBUG resolveRearrangeProtocols] RETURNING state with",R[c].hand.length,"cards"),R}else s.type==="continue_turn"?s.queuedSpeed2Actions&&s.queuedSpeed2Actions.length>0?(S=$(S,c,"Processing remaining Speed-2 effects..."),S.queuedActions=[...s.queuedSpeed2Actions,...S.queuedActions||[]]):(S=$(S,c,"Turn ends after compile."),S.phase="hand_limit"):s.type==="resume_interrupted_turn"&&(S=$(S,c,"Resuming interrupted turn..."),S._interruptedTurn=s.interruptedTurn,S._interruptedPhase=s.interruptedPhase,s.queuedSpeed2Actions&&s.queuedSpeed2Actions.length>0&&(S.queuedActions=[...s.queuedSpeed2Actions,...S.queuedActions||[]]))}return S},rd=(t,o)=>{var c;if(((c=t.actionRequired)==null?void 0:c.type)!=="prompt_return_for_psychic_4")return t;const{actor:a}=t.actionRequired,i=a.charAt(0).toUpperCase()+a.slice(1);let l={...t};return o?(l=$(l,a,`Psychic-4 End: ${i} chooses to return an opponent's card.`),l.actionRequired={type:"select_opponent_card_to_return",sourceCardId:t.actionRequired.sourceCardId,actor:a}):(l=$(l,a,`Psychic-4 End: ${i} skips the effect.`),l.actionRequired=null),l},ld=(t,o)=>{var s;if(((s=t.actionRequired)==null?void 0:s.type)!=="prompt_spirit_1_start")return t;const{actor:a,sourceCardId:i}=t.actionRequired,l=a.charAt(0).toUpperCase()+a.slice(1);let c={...t};return o==="discard"?(c=$(c,a,`Spirit-1 Start: ${l} chooses to discard 1 card.`),c.actionRequired={type:"discard",actor:a,count:1,sourceCardId:i,sourceEffect:"spirit_1_start"}):(c=$(c,a,`Spirit-1 Start: ${l} chooses to flip the card.`),c=Wt(new Set([i]),c),c.animationState={type:"flipCard",cardId:i},c.actionRequired=null),c},cd=(t,o)=>{var s;if(((s=t.actionRequired)==null?void 0:s.type)!=="prompt_shift_for_spirit_3")return t;const{actor:a,sourceCardId:i}=t.actionRequired,l=a.charAt(0).toUpperCase()+a.slice(1);let c={...t};if(o){const f=fe(c,i);if(f){const{owner:p,card:h}=f;let y=-1;for(let g=0;g<c[p].lanes.length;g++)if(c[p].lanes[g].some(v=>v.id===h.id)){y=g;break}y!==-1&&(c=$(c,a,`Spirit-3 Trigger: ${l} chooses to shift the card.`),c.actionRequired={type:"select_lane_for_shift",cardToShiftId:i,cardOwner:p,originalLaneIndex:y,sourceCardId:i,actor:a})}}else c=$(c,a,`Spirit-3 Trigger: ${l} skips the shift.`),c.actionRequired=null;return c},Fh=(t,o,a)=>{var S;if(((S=t.actionRequired)==null?void 0:S.type)!=="prompt_swap_protocols")return t;const{actor:i,target:l,originalAction:c,sourceCardId:s}=t.actionRequired,f={...t[l]},[p,h]=o.sort((j,R)=>j-R),y=[...f.protocols],g=[...f.compiled];[y[p],y[h]]=[y[h],y[p]],[g[p],g[h]]=[g[h],g[p]],f.protocols=y,f.compiled=g;let v={...t,[l]:f,actionRequired:null};const w=v._pendingCustomEffects;if(w&&w.effects.length>0){console.log("[resolveSwapProtocols] Found pending effects:",w.effects.length);const j={type:"execute_remaining_custom_effects",sourceCardId:w.sourceCardId,laneIndex:w.laneIndex,effects:w.effects,context:w.context,actor:i};v.queuedActions=[...v.queuedActions||[],j],delete v._pendingCustomEffects,console.log("[resolveSwapProtocols] Queued pending effects")}const C=i.charAt(0).toUpperCase()+i.slice(1),x=l.charAt(0).toUpperCase()+l.slice(1);v=$(v,i,`${s==="CONTROL_MECHANIC"?"Control":"Spirit-4"}: ${C} swaps ${x}'s protocols ${y[h]} and ${y[p]}.`),s==="CONTROL_MECHANIC"&&(v.controlCardHolder=null);let E=Ee(v);if(c){if(c.type==="compile")return E=$(E,i,"Resuming Compile action..."),nl(E,c.laneIndex,a);if(c.type==="fill_hand")return E=$(E,i,"Resuming Refresh action..."),rl(E,i)}return E},H0=(t,o)=>{var v;if(((v=t.actionRequired)==null?void 0:v.type)!=="prompt_shift_or_flip_board_card_custom")return t;const{actor:a,sourceCardId:i,revealedCardId:l,followUpAction:c,optional:s}=t.actionRequired,f=a.charAt(0).toUpperCase()+a.slice(1),p=fe(t,l);if(!p)return t;if(c&&o!=="skip"&&o!==c)return console.error(`Invalid choice: ${o}, followUpAction restricts to: ${c}`),t;const h=p.owner,y=t[h].lanes.findIndex(w=>w.some(C=>C.id===l));if(y===-1)return t;let g={...t};switch(o){case"shift":{const w=[...g[h].lanes[y]],C=w.findIndex(x=>x.id===l);if(C!==-1){w[C]={...w[C],isFaceUp:!1};const x=[...g[h].lanes];x[y]=w,g={...g,[h]:{...g[h],lanes:x}}}g=$(g,a,`${f} chooses to shift the revealed card (face-down).`),g.actionRequired={type:"select_lane_to_shift_revealed_board_card_custom",sourceCardId:i,revealedCardId:l,actor:a};break}case"flip":{g=$(g,a,`${f} chooses to flip the revealed card face-up permanently.`);const w={...g,actionRequired:null};g=wo(w,l).newState;break}case"skip":{const w=[...g[h].lanes[y]],C=w.findIndex(x=>x.id===l);if(C!==-1){w[C]={...w[C],isFaceUp:!1};const x=[...g[h].lanes];x[y]=w,g={...g,[h]:{...g[h],lanes:x}}}g=$(g,a,`${f} chooses to do nothing with the revealed card.`),g.actionRequired=null;break}}return g};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const sd=(t,o)=>{if(!t.actionRequired)return t;const{actionRequired:a}=t,i=a.actor,l=i==="player"?"opponent":"player";switch(a.type){case"select_card_from_hand_to_give":{const c=t[i].hand.find(g=>g.id===o);if(!c)return t;let s={...t};const f={...s[i]},p={...s[l]};f.hand=f.hand.filter(g=>g.id!==o),p.hand=[...p.hand,c],s={...s,[i]:f,[l]:p};const h=i==="player"?"Player":"Opponent",y=`${c.protocol}-${c.value}`;return s=$(s,i,`${h} gives ${y} to the opponent.`),a.sourceEffect==="love_1_end"&&(s=$(s,i,`Love-1: ${h} draws 2 cards.`),s=tt(s,i,2)),s.actionRequired=null,s}case"select_card_from_hand_to_reveal":{const c=t[i].hand.find(g=>g.id===o);if(!c)return t;let s={...t};const f={...s[i]},p=f.hand.map(g=>g.id===o?{...g,isRevealed:!0}:g);f.hand=p,s={...s,[i]:f};const h=i==="player"?"Player":"Opponent",y=`${c.protocol}-${c.value}`;return s=$(s,i,`Love-4: ${h} reveals ${y} from their hand.`),s.actionRequired={type:"select_any_card_to_flip",count:1,sourceCardId:a.sourceCardId,actor:i},s}default:return t}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const B0=(t,o)=>{var w;if(((w=t.actionRequired)==null?void 0:w.type)!=="custom_choice")return t;const{options:a,sourceCardId:i,actor:l,laneIndex:c}=t.actionRequired;if(o<0||o>=a.length)return console.error(`[Choice Resolver] Invalid option index: ${o}`),t;const s=a[o],f=fe(t,i);if(!f){console.error(`[Choice Resolver] Source card ${i} not found`);let C={...t};return C.actionRequired=null,C}const p=l==="player"?"opponent":"player",h={cardOwner:l,actor:l,currentTurn:t.turn,opponent:p};let y={...t,actionRequired:null};console.log(`[Choice Resolver] Executing option ${o}`);const g=hn(f.card,c,y,h,s);return Ee(g.newState)};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function Xh(t){const o=t.player,a=[],i=[];for(let l=0;l<3;l++)o.compiled[l]?a.push(l):i.push(l);if(a.length===0||i.length===0)return!1;for(const l of a)for(const c of i)if(o.laneValues[c]-o.laneValues[l]>0)return!0;return!1}function Zh(t){const o=t.opponent,a=[],i=[];for(let l=0;l<3;l++)o.compiled[l]?a.push(l):i.push(l);if(a.length===0||i.length===0)return!1;for(const l of a)for(const c of i){const f=10-o.laneValues[l];if(f>=0&&f<=3){const h=10-o.laneValues[c];if(f<h)return!0}}return!1}function Cd(t,o){if(!o||o.type!=="prompt_rearrange_protocols")return{type:"rearrangeProtocols",newOrder:[...t.opponent.protocols]};const a=o.target,i=o.disallowedProtocolForLane,l=y=>{if(!i)return!0;const{laneIndex:g,protocol:v}=i;return y[g]!==v},c=t.opponent,s=t.player,f=c.compiled.filter(y=>y).length;if(s.compiled.filter(y=>y).length===2&&f===2){const y=s.compiled.findIndex(C=>!C),g=c.compiled.findIndex(C=>!C),v=s.laneValues[y],w=c.laneValues[g];if(v>w&&a==="player"){let C=-1,x=1/0;for(let b=0;b<3;b++)s.compiled[b]&&s.laneValues[b]<x&&(x=s.laneValues[b],C=b);if(C!==-1&&x<=v){const b=[...s.protocols];return[b[y],b[C]]=[b[C],b[y]],{type:"rearrangeProtocols",newOrder:b}}return{type:"rearrangeProtocols",newOrder:[...s.protocols]}}if(v<=w&&a==="opponent"){let C=-1,x=-1;for(let b=0;b<3;b++)c.compiled[b]&&c.laneValues[b]>x&&(x=c.laneValues[b],C=b);if(C!==-1&&x>w&&x>0){const b=[...c.protocols];return[b[g],b[C]]=[b[C],b[g]],{type:"rearrangeProtocols",newOrder:b}}return{type:"rearrangeProtocols",newOrder:[...c.protocols]}}}if(a==="player"){const y=[],g=[];for(let C=0;C<3;C++)s.compiled[C]?y.push(C):g.push(C);if(y.length===0||g.length===0)return{type:"rearrangeProtocols",newOrder:[...s.protocols]};let v=null;for(const C of y)for(const x of g){const b=s.laneValues[x]-s.laneValues[C];(!v||b>v.score)&&(v={compiledIdx:C,uncompiledIdx:x,score:b})}if(v&&v.score>0){const C=[...s.protocols];return[C[v.compiledIdx],C[v.uncompiledIdx]]=[C[v.uncompiledIdx],C[v.compiledIdx]],{type:"rearrangeProtocols",newOrder:C}}if(o.sourceCardId!=="CONTROL_MECHANIC"){const C=[...s.protocols];return[C[0],C[1]]=[C[1],C[0]],{type:"rearrangeProtocols",newOrder:C}}return{type:"rearrangeProtocols",newOrder:[...s.protocols]}}if(a==="opponent"){const y=[],g=[];for(let C=0;C<3;C++)c.compiled[C]?y.push(C):g.push(C);if(y.length===0||g.length===0){if(o.sourceCardId!=="CONTROL_MECHANIC"){const x=[...c.protocols];return[x[0],x[1]]=[x[1],x[0]],{type:"rearrangeProtocols",newOrder:x}}return{type:"rearrangeProtocols",newOrder:[...c.protocols]}}let v=null;for(const C of y)for(const x of g){const E=10-c.laneValues[C];E>=0&&(!v||E<v.distanceToWin)&&(v={compiledIdx:C,uncompiledIdx:x,distanceToWin:E})}if(v&&v.distanceToWin<=3){const x=10-c.laneValues[v.uncompiledIdx];if(v.distanceToWin<x){const b=[...c.protocols];return[b[v.compiledIdx],b[v.uncompiledIdx]]=[b[v.uncompiledIdx],b[v.compiledIdx]],{type:"rearrangeProtocols",newOrder:b}}}if(o.sourceCardId!=="CONTROL_MECHANIC"){const C=[...c.protocols];return[C[0],C[1]]=[C[1],C[0]],{type:"rearrangeProtocols",newOrder:C}}return{type:"rearrangeProtocols",newOrder:[...c.protocols]}}const h=a==="player"?[...s.protocols]:[...c.protocols];if(l(h))return{type:"rearrangeProtocols",newOrder:h};for(let y=0;y<3;y++)for(let g=y+1;g<3;g++){const v=[...h];if([v[y],v[g]]=[v[g],v[y]],l(v))return{type:"rearrangeProtocols",newOrder:v}}return{type:"rearrangeProtocols",newOrder:h}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const V0=t=>{const{opponent:o,player:a}=t;if(o.hand.length===0)return null;const i=v=>{const w=t.player.lanes[v];if(w.length===0)return!1;const C=w[w.length-1];return C.isFaceUp&&C.protocol==="Plague"&&C.value===0},l=v=>t.player.laneValues[v]>=10&&t.player.laneValues[v]>t.opponent.laneValues[v],c=a.lanes.flat().some(v=>v.isFaceUp&&v.protocol==="Psychic"&&v.value===1);for(let v=0;v<3;v++)if(!i(v)&&!l(v)&&!o.compiled[v]&&(o.laneValues[v]===8||o.laneValues[v]===9))return{cardId:o.hand[0].id,laneIndex:v,isFaceUp:!1};const s=o.hand.filter(v=>v.protocol==="Water"&&v.value===4?o.lanes.flat().some(x=>x.protocol!=="Water"):!0);if(s.length===0)return null;const f=[...s].sort((v,w)=>w.value-v.value),p=f.find(v=>{if(v.protocol==="Metal"&&v.value===6){for(let w=0;w<3;w++)if(o.laneValues[w]+6>=10)return!0;return!1}return!0})||f[0];let h=!1;if(p.protocol==="Hate"&&p.value===2){for(let v=0;v<3;v++)if(o.protocols[v]==="Hate"){let w=0;for(let C=0;C<3;C++){const x=o.lanes[C];if(x.length>0&&C!==v){const b=x[x.length-1],E=b.isFaceUp?b.value:2;E>w&&(w=E)}}if(2>=w){h=!0;break}}}if(!c&&!h){const v=o.lanes.flat().some(x=>x.isFaceUp&&x.protocol==="Spirit"&&x.value===1),w=o.lanes.some(x=>{if(x.length===0)return!1;const b=x[x.length-1];return b.isFaceUp&&b.protocol==="Chaos"&&b.value===3}),C=[...a.lanes.flat(),...o.lanes.flat()].some(x=>x.isFaceUp&&x.protocol==="Anarchy"&&x.value===1);for(let x=0;x<3;x++){if(i(x)||l(x))continue;let b;if(C?b=p.protocol!==o.protocols[x]&&p.protocol!==a.protocols[x]:b=p.protocol===o.protocols[x]||p.protocol===a.protocols[x]||v||w,b)return{cardId:p.id,laneIndex:x,isFaceUp:!0}}}const y=[0,1,2].filter(v=>t.player.lanes[v].some(C=>C.isFaceUp&&C.protocol==="Metal"&&C.value===2)?!1:!i(v)&&!l(v));if(y.length===0)return null;const g=y[Math.floor(Math.random()*y.length)];return{cardId:p.id,laneIndex:g,isFaceUp:!1}},z0=(t,o)=>{switch(o.type){case"prompt_use_control_mechanic":{const{player:l}=t,c=l.compiled.some(f=>f),s=l.compiled.filter(f=>!f).length;return c&&s>0?{type:"resolveControlMechanicPrompt",choice:"player"}:{type:"resolveControlMechanicPrompt",choice:"skip"}}case"discard":return{type:"discardCards",cardIds:[...t.opponent.hand].sort((l,c)=>l.value-c.value).slice(0,o.count).map(l=>l.id)};case"select_opponent_card_to_flip":{const c=(p=>t[p].lanes.map(h=>h.length>0?h[h.length-1]:null).filter(h=>h!==null))("player");if(c.length===0)return{type:"skip"};const s=c.filter(p=>!p.isFaceUp);return s.length>0?{type:"flipCard",cardId:s[0].id}:{type:"flipCard",cardId:c.filter(p=>p.isFaceUp).sort((p,h)=>h.value-p.value)[0].id}}case"select_card_to_delete_for_anarchy_2":{const l=(f,p,h)=>{const y=t[p].protocols[h];return f.protocol===y},c=[];if(t.player.lanes.forEach((f,p)=>{f.forEach(h=>{h.isFaceUp&&l(h,"player",p)&&c.push(h)})}),c.length>0)return{type:"deleteCard",cardId:c[0].id};const s=[];return t.opponent.lanes.forEach((f,p)=>{f.forEach(h=>{h.isFaceUp&&l(h,"opponent",p)&&s.push(h)})}),s.length>0?{type:"deleteCard",cardId:s[0].id}:{type:"skip"}}case"select_cards_to_delete":case"select_face_down_card_to_delete":case"select_card_to_delete_for_death_1":case"plague_4_opponent_delete":{const l="disallowedIds"in o&&o.disallowedIds?o.disallowedIds:[],c=p=>t[p].lanes.map(h=>h.length>0?h[h.length-1]:null).filter(h=>h!==null),s=c("player").filter(p=>!l.includes(p.id));if(s.length>0)return{type:"deleteCard",cardId:s[0].id};const f=c("opponent").filter(p=>!l.includes(p.id));return f.length>0?{type:"deleteCard",cardId:f[0].id}:{type:"skip"}}case"select_card_from_other_lanes_to_delete":{const{disallowedLaneIndex:l,lanesSelected:c}=o,s=[];for(let f=0;f<3;f++){if(f===l||c.includes(f))continue;const p=t.player.lanes[f];if(p.length>0){s.push(p[p.length-1]);continue}const h=t.opponent.lanes[f];h.length>0&&s.push(h[h.length-1])}return s.length>0?{type:"deleteCard",cardId:s[0].id}:{type:"skip"}}case"select_low_value_card_to_delete":{const l=[];for(const s of["player","opponent"])for(const f of t[s].lanes)f.length>0&&l.push(f[f.length-1]);const c=l.filter(s=>s.isFaceUp&&(s.value===0||s.value===1));return c.length>0?{type:"deleteCard",cardId:c[0].id}:{type:"skip"}}case"select_own_highest_card_to_delete_for_hate_2":{const l=o.actor,c=[];if(t[l].lanes.forEach((p,h)=>{if(p.length>0){const y=p[p.length-1],g=y.isFaceUp?y.value:2;c.push({card:y,laneIndex:h,value:g})}}),c.length===0)return{type:"skip"};const s=Math.max(...c.map(p=>p.value));return{type:"deleteCard",cardId:c.filter(p=>p.value===s)[0].card.id}}case"select_opponent_highest_card_to_delete_for_hate_2":{const c=o.actor==="player"?"opponent":"player",s=[];if(t[c].lanes.forEach((h,y)=>{if(h.length>0){const g=h[h.length-1],v=g.isFaceUp?g.value:2;s.push({card:g,laneIndex:y,value:v})}}),s.length===0)return{type:"skip"};const f=Math.max(...s.map(h=>h.value));return{type:"deleteCard",cardId:s.filter(h=>h.value===f)[0].card.id}}case"select_own_face_up_covered_card_to_flip":return{type:"skip"};case"select_face_down_card_to_reveal_for_light_2":{const l=h=>t[h].lanes.map(y=>y.length>0?y[y.length-1]:null).filter(y=>y!==null),c=l("player"),s=l("opponent"),f=c.filter(h=>!h.isFaceUp);if(f.length>0)return{type:"deleteCard",cardId:f[0].id};const p=s.filter(h=>!h.isFaceUp);return p.length>0?{type:"deleteCard",cardId:p[0].id}:{type:"skip"}}case"select_opponent_face_up_card_to_flip":{const c=(s=>t[s].lanes.map(f=>f.length>0?f[f.length-1]:null).filter(f=>f!==null))("player").filter(s=>s.isFaceUp);return c.length>0?(c.sort((s,f)=>f.value-s.value),{type:"flipCard",cardId:c[0].id}):{type:"skip"}}case"select_any_other_card_to_flip":case"select_any_card_to_flip":case"select_any_card_to_flip_optional":case"select_card_to_flip_for_fire_3":case"select_card_to_flip_for_light_0":case"select_any_other_card_to_flip_for_water_0":case"select_any_face_down_card_to_flip_optional":case"select_covered_card_to_flip_for_chaos_0":case"select_covered_card_in_line_to_flip_optional":{const l=Dt(t),c="optional"in o&&o.optional,f=!["select_any_other_card_to_flip","select_any_other_card_to_flip_for_water_0"].includes(o.type),p=o.type==="select_any_face_down_card_to_flip_optional";if(o.type==="select_covered_card_to_flip_for_chaos_0"){const{laneIndex:v}=o,w=t.player.lanes[v].filter((x,b,E)=>b<E.length-1);if(w.length>0)return{type:"flipCard",cardId:w[0].id};const C=t.opponent.lanes[v].filter((x,b,E)=>b<E.length-1);return C.length>0?{type:"flipCard",cardId:C[0].id}:{type:"skip"}}if(o.type==="select_covered_card_in_line_to_flip_optional"){const{laneIndex:v}=o,w=t.player.lanes[v].filter((x,b,E)=>b<E.length-1);if(w.length>0)return{type:"flipCard",cardId:w[0].id};const C=t.opponent.lanes[v].filter((x,b,E)=>b<E.length-1);return C.length>0?{type:"flipCard",cardId:C[0].id}:{type:"skip"}}const h=v=>t[v].lanes.map(w=>w.length>0?w[w.length-1]:null).filter(w=>w!==null),y=h("player"),g=h("opponent");if(!p){const v=y.filter(w=>w.isFaceUp).sort((w,C)=>C.value-w.value);if(v.length>0)return{type:"flipCard",cardId:v[0].id}}if(!l){const v=g.filter(w=>!w.isFaceUp);if(v.length>0)return{type:"flipCard",cardId:v[0].id}}if(!l){const v=y.filter(w=>!w.isFaceUp);if(v.length>0)return{type:"flipCard",cardId:v[0].id}}if(!p){const v=g.filter(C=>!(!C.isFaceUp||!f&&C.id===o.sourceCardId)),w=v.filter(C=>{const x=t.opponent.lanes.findIndex(b=>b.length>0&&b[b.length-1].id===C.id);return x!==-1&&t.opponent.compiled[x]});if(w.length>0&&!c)return{type:"flipCard",cardId:w[0].id};if(v.length>0&&!c)return{type:"flipCard",cardId:v[0].id}}return{type:"skip"}}case"select_card_to_return":case"select_opponent_card_to_return":{const l=[];return t.player.lanes.forEach(c=>{c.length>0&&l.push(c[c.length-1])}),t.opponent.lanes.forEach(c=>{c.length>0&&l.push(c[c.length-1])}),l.length>0?{type:"returnCard",cardId:l[0].id}:"optional"in o&&o.optional?{type:"skip"}:{type:"skip"}}case"select_own_card_to_return_for_water_4":{const l=[];return t.opponent.lanes.forEach(c=>{c.length>0&&l.push(c[c.length-1])}),l.length>0?{type:"returnCard",cardId:l[Math.floor(Math.random()*l.length)].id}:"optional"in o&&o.optional?{type:"skip"}:{type:"skip"}}case"select_card_to_shift_for_anarchy_0":{const l=[...t.player.lanes.flat(),...t.opponent.lanes.flat()];return l.length>0?{type:"shiftCard",cardId:l[Math.floor(Math.random()*l.length)].id}:{type:"skip"}}case"select_card_to_shift_for_anarchy_1":{const{sourceCardId:l}=o,c=[...t.player.lanes.flat(),...t.opponent.lanes.flat()].filter(s=>s.id!==l);return c.length>0?{type:"shiftCard",cardId:c[Math.floor(Math.random()*c.length)].id}:{type:"skip"}}case"select_card_to_shift_for_gravity_1":{const l=[...t.player.lanes.flat(),...t.opponent.lanes.flat()];return l.length>0?{type:"shiftCard",cardId:l[Math.floor(Math.random()*l.length)].id}:{type:"skip"}}case"select_card_to_flip_and_shift_for_gravity_2":{const l=f=>t[f].lanes.map(p=>p.length>0?p[p.length-1]:null).filter(p=>p!==null),c=l("player");if(c.length>0)return{type:"deleteCard",cardId:c[Math.floor(Math.random()*c.length)].id};const s=l("opponent");return s.length>0?{type:"deleteCard",cardId:s[Math.floor(Math.random()*s.length)].id}:{type:"skip"}}case"select_face_down_card_to_shift_for_gravity_4":{const{targetLaneIndex:l}=o,c=[];for(const s of["player","opponent"])for(let f=0;f<t[s].lanes.length;f++)if(f!==l)for(const p of t[s].lanes[f])p.isFaceUp||c.push(p);return c.length>0?{type:"deleteCard",cardId:c[Math.floor(Math.random()*c.length)].id}:{type:"skip"}}case"select_face_down_card_to_shift_for_darkness_4":{const l=[];for(const c of["player","opponent"])for(const s of t[c].lanes)if(s.length>0){const f=s[s.length-1];f.isFaceUp||l.push(f)}return l.length>0?{type:"deleteCard",cardId:l[Math.floor(Math.random()*l.length)].id}:{type:"skip"}}case"shift_flipped_card_optional":{const l=fe(t,o.cardId);if(!l)return{type:"skip"};let c=-1;const s=t[l.owner];for(let p=0;p<s.lanes.length;p++)if(s.lanes[p].some(h=>h.id===o.cardId)){c=p;break}if(c===-1)return{type:"skip"};const f=[0,1,2].filter(p=>p!==c);return f.length>0?{type:"selectLane",laneIndex:f[Math.floor(Math.random()*f.length)]}:{type:"skip"}}case"select_lane_for_play":{let l=[0,1,2];"disallowedLaneIndex"in o&&o.disallowedLaneIndex!==void 0&&(l=l.filter(s=>s!==o.disallowedLaneIndex));const c="player";return l=l.filter(s=>{const f=t[c].lanes[s],p=f.length>0?f[f.length-1]:null,h=p&&p.isFaceUp&&p.protocol==="Plague"&&p.value===0,y=o.isFaceDown&&f.some(g=>g.isFaceUp&&g.protocol==="Metal"&&g.value===2);return!h&&!y}),l.length>0?{type:"selectLane",laneIndex:l[Math.floor(Math.random()*l.length)]}:{type:"skip"}}case"select_lane_for_shift":{let l=[0,1,2];if("disallowedLaneIndex"in o&&o.disallowedLaneIndex!==void 0&&(l=l.filter(c=>c!==o.disallowedLaneIndex)),"originalLaneIndex"in o&&o.originalLaneIndex!==void 0&&(l=l.filter(c=>c!==o.originalLaneIndex)),"sourceCardId"in o){const c=[...t.player.lanes.flat(),...t.opponent.lanes.flat()].find(s=>s.id===o.sourceCardId);if(c&&c.protocol==="Gravity"&&c.value===1){let s=null;for(let f=0;f<3;f++)if([...t.player.lanes[f],...t.opponent.lanes[f]].some(h=>h.id===o.sourceCardId)){s=f;break}s!==null&&"originalLaneIndex"in o&&(o.originalLaneIndex===s||(l=[s]))}if(c&&c.protocol==="Anarchy"&&c.value===1){const s="cardToShiftId"in o?o.cardToShiftId:null;if(s){const f=[...t.player.lanes.flat(),...t.opponent.lanes.flat()].find(p=>p.id===s);f&&(l=l.filter(p=>{const h=t.player.protocols[p],y=t.opponent.protocols[p],g=f.protocol;return g!==h&&g!==y}))}}}return l.length>0?{type:"selectLane",laneIndex:l[Math.floor(Math.random()*l.length)]}:{type:"selectLane",laneIndex:0}}case"select_lane_for_death_2":case"select_lane_for_life_3_play":case"select_lane_to_shift_revealed_card_for_light_2":case"select_lane_to_shift_cards_for_light_3":{let l=[0,1,2];return"disallowedLaneIndex"in o&&o.disallowedLaneIndex!==void 0&&(l=l.filter(c=>c!==o.disallowedLaneIndex)),"originalLaneIndex"in o&&o.originalLaneIndex!==void 0&&(l=l.filter(c=>c!==o.originalLaneIndex)),l.length>0?{type:"selectLane",laneIndex:l[Math.floor(Math.random()*l.length)]}:"optional"in o&&o.optional?{type:"skip"}:{type:"skip"}}case"select_lane_for_metal_3_delete":{let l=[0,1,2];return"disallowedLaneIndex"in o&&o.disallowedLaneIndex!==void 0&&(l=l.filter(c=>c!==o.disallowedLaneIndex)),l=l.filter(c=>t.player.lanes[c].length+t.opponent.lanes[c].length>=8),l.length>0?{type:"selectLane",laneIndex:l[Math.floor(Math.random()*l.length)]}:{type:"skip"}}case"select_lane_for_water_3":{const c=(s=>{const f=[];for(let p=0;p<3;p++){let h=!1;for(const y of["player","opponent"]){const g=s[y].lanes[p],w=g.some(C=>C.isFaceUp&&C.protocol==="Darkness"&&C.value===2)?4:2;for(const C of g)if((C.isFaceUp?C.value:w)===2){h=!0;break}if(h)break}h&&f.push(p)}return f})(t);return c.length>0?{type:"selectLane",laneIndex:c[Math.floor(Math.random()*c.length)]}:{type:"selectLane",laneIndex:0}}case"prompt_death_1_effect":return{type:"resolveDeath1Prompt",accept:Math.random()>.7};case"prompt_give_card_for_love_1":return{type:"resolveLove1Prompt",accept:!1};case"plague_4_player_flip_optional":return{type:"resolvePlague4Flip",accept:!1};case"prompt_fire_3_discard":return{type:"resolveFire3Prompt",accept:!1};case"prompt_shift_for_speed_3":return{type:"resolveSpeed3Prompt",accept:!1};case"prompt_shift_for_spirit_3":return{type:"resolveSpirit3Prompt",accept:!1};case"prompt_return_for_psychic_4":return{type:"resolvePsychic4Prompt",accept:!1};case"prompt_spirit_1_start":return{type:"resolveSpirit1Prompt",choice:"flip"};case"prompt_shift_or_flip_for_light_2":{const{revealedCardId:l}=o,c=fe(t,l);return c?c.owner==="opponent"?{type:"resolveLight2Prompt",choice:"flip"}:{type:"resolveLight2Prompt",choice:"skip"}:{type:"skip"}}case"plague_2_opponent_discard":return t.opponent.hand.length>0?{type:"resolvePlague2Discard",cardIds:[t.opponent.hand[0].id]}:{type:"skip"};case"select_cards_from_hand_to_discard_for_fire_4":{const l=Math.min(3,t.opponent.hand.length);return l===0?{type:"skip"}:{type:"resolveFire4Discard",cardIds:t.opponent.hand.slice(0,l).map(s=>s.id)}}case"select_cards_from_hand_to_discard_for_hate_1":return t.opponent.hand.length>0?{type:"resolveHate1Discard",cardIds:t.opponent.hand.slice(0,o.count).map(l=>l.id)}:{type:"skip"};case"select_card_from_hand_to_play":if(t.opponent.hand.length>0){const l=t.opponent.hand[0];let c=[0,1,2].filter(s=>s!==o.disallowedLaneIndex);if(c=c.filter(s=>{const f=t.player.lanes[s],p=f.length>0?f[f.length-1]:null,h=p&&p.isFaceUp&&p.protocol==="Plague"&&p.value===0,y=o.isFaceDown&&f.some(g=>g.isFaceUp&&g.protocol==="Metal"&&g.value===2);return!h&&!y}),c.length>0)return{type:"playCard",cardId:l.id,laneIndex:c[0],isFaceUp:!1}}return{type:"skip"};case"select_card_from_hand_to_give":return t.opponent.hand.length>0?{type:"giveCard",cardId:t.opponent.hand[0].id}:{type:"skip"};case"select_card_from_hand_to_reveal":return t.opponent.hand.length>0?{type:"revealCard",cardId:t.opponent.hand[0].id}:{type:"skip"};case"prompt_rearrange_protocols":return Cd(t,o);case"prompt_swap_protocols":{const l=Math.floor(Math.random()*3);let c=Math.floor(Math.random()*3);for(;l===c;)c=Math.floor(Math.random()*3);return{type:"resolveSwapProtocols",indices:[l,c]}}case"select_opponent_face_down_card_to_shift":{const l=[];for(const c of t.player.lanes)if(c.length>0){const s=c[c.length-1];s.isFaceUp||l.push(s)}return l.length>0?{type:"deleteCard",cardId:l[Math.floor(Math.random()*l.length)].id}:{type:"skip"}}case"select_own_other_card_to_shift":{const l=t.opponent.lanes.flat().find(c=>c.id!==o.sourceCardId);return l?{type:"deleteCard",cardId:l.id}:{type:"skip"}}case"select_own_card_to_shift_for_speed_3":return{type:"deleteCard",cardId:t.opponent.lanes.flat()[0].id};case"select_opponent_covered_card_to_shift":{const l=[];for(const c of t.player.lanes)for(let s=0;s<c.length-1;s++)l.push(c[s]);return l.length>0?{type:"deleteCard",cardId:l[Math.floor(Math.random()*l.length)].id}:{type:"skip"}}case"select_own_covered_card_to_shift":{const l=[];for(const c of t.opponent.lanes)for(let s=0;s<c.length-1;s++)l.push(c[s]);return l.length>0?{type:"deleteCard",cardId:l[Math.floor(Math.random()*l.length)].id}:{type:"skip"}}case"select_any_opponent_card_to_shift":{const l=t.player.lanes.map(c=>c.length>0?c[c.length-1]:null).filter(c=>c!==null);return l.length>0?{type:"deleteCard",cardId:l[Math.floor(Math.random()*l.length)].id}:{type:"skip"}}case"flip_self_for_water_0":return o.sourceCardId?{type:"flipCard",cardId:o.sourceCardId}:{type:"skip"};case"plague_2_player_discard":return{type:"skip"};case"reveal_opponent_hand":return{type:"skip"}}return{type:"skip"}},G0=(t,o)=>{if(o)return z0(t,o);if(t.phase==="compile"&&t.compilableLanes.length>0)return{type:"compile",laneIndex:t.compilableLanes[0]};if(t.phase==="action"){const a=V0(t);return a?{type:"playCard",...a}:{type:"fillHand"}}return{type:"fillHand"}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * NORMAL AI - Plays like a human player
 * - Makes good strategic decisions
 * - No memory of revealed cards
 * - 20% chance to make suboptimal moves for realism
 * - Balanced between Easy and Hard
 */const ll=["delete","flip","shift","return","discard"],bt=t=>{let o=12-t.value;return ll.some(a=>t.keywords[a])&&(o+=6),t.keywords.draw&&(o+=3),t.keywords.play&&(o+=8),t.keywords.prevent&&(o+=4),o},Sc=(t,o,a)=>{let i;for(const c of a[o].lanes)if(c.some(s=>s.id===t.id)){i=c;break}if(!i)return 0;if(!t.isFaceUp)return i.some(s=>s.isFaceUp&&s.protocol==="Darkness"&&s.value===2)?4:2;let l=t.value*2.5;return t.top.length>0&&(l+=6),(t.bottom.includes("Start:")||t.bottom.includes("End:"))&&(l+=8),t.bottom.includes("covered:")&&(l+=5),ll.some(c=>t.keywords[c])&&(l+=4),l},el=()=>Math.random()<.2,id=t=>t+(Math.random()*10-5),Y0=t=>{const o=[],a=l=>{const c=t.player.lanes[l];if(c.length===0)return!1;const s=c[c.length-1];return s.isFaceUp&&s.protocol==="Plague"&&s.value===0},i=t.player.lanes.flat().some(l=>l.isFaceUp&&l.protocol==="Psychic"&&l.value===1);for(const l of t.opponent.hand)for(let c=0;c<3;c++){if(a(c))continue;if(l.protocol==="Water"&&l.value===4){let C=!1;for(let x=0;x<3;x++)if(x!==c&&t.opponent.lanes[x].length>0){C=!0;break}if(!C)continue}if(t.opponent.compiled[c])continue;if(l.protocol==="Metal"&&l.value===6){const x=t.opponent.laneValues[c]+6;if(x<10)continue;const b=t.player.laneValues[c];if(x<=b)continue}const s=t.player.laneValues[c]>=10&&t.player.laneValues[c]>t.opponent.laneValues[c]&&!t.player.compiled[c],f=bt(l);let p=!1;if(l.protocol==="Hate"&&l.value===2){let C=0;for(let x=0;x<3;x++){const b=t.opponent.lanes[x];if(b.length>0&&x!==c){const E=b[b.length-1],S=E.isFaceUp?E.value:2;S>C&&(C=S)}}2>=C&&(p=!0)}const h=t.opponent.lanes.flat().some(C=>C.isFaceUp&&C.protocol==="Spirit"&&C.value===1),y=t.opponent.lanes.some(C=>{if(C.length===0)return!1;const x=C[C.length-1];return x.isFaceUp&&x.protocol==="Chaos"&&x.value===3}),g=[...t.player.lanes.flat(),...t.opponent.lanes.flat()].some(C=>C.isFaceUp&&C.protocol==="Anarchy"&&C.value===1);let v;if(g?v=l.protocol!==t.opponent.protocols[c]&&l.protocol!==t.player.protocols[c]&&!i&&!p:v=(l.protocol===t.opponent.protocols[c]||l.protocol===t.player.protocols[c]||h||y)&&!i&&!p,v){let C=0,x=`Play ${l.protocol}-${l.value} face-up in lane ${c}`;const b=l.value,E=t.opponent.laneValues[c]+b;s?E>t.player.laneValues[c]?(C=180+E*5,x+=" [Blocks compile!]"):(C=-150,x+=" [Fails to block]"):(C+=f,C+=b*1.5,E>=10&&E>t.player.laneValues[c]&&!t.opponent.compiled[c]?(C+=120,x+=" [Compile setup]"):E>=8&&!t.opponent.compiled[c]&&(C+=40,x+=" [Near compile]"),ll.some(j=>l.keywords[j])&&t.player.laneValues[c]>=6&&(C+=30,x+=" [Disruption]")),o.push({move:{type:"playCard",cardId:l.id,laneIndex:c,isFaceUp:!0},score:id(C),reason:x})}if(!t.player.lanes[c].some(C=>C.isFaceUp&&C.protocol==="Metal"&&C.value===2)){const C=Et({...l,isFaceUp:!1},t.opponent.lanes[c]),x=t.opponent.laneValues[c]+C;let b=0,E=`Play ${l.protocol}-${l.value} face-down in lane ${c}`;s?x>t.player.laneValues[c]?(b=170+x*5,E+=" [Blocks compile]"):(b=-140,E+=" [Fails to block]"):(b+=C*2,l.protocol==="Hate"&&l.value===2&&(b+=25,E+=" [Hate-2 effect bonus]"),x>=10&&x>t.player.laneValues[c]&&!t.opponent.compiled[c]&&(b+=110,E+=" [Compile setup]")),o.push({move:{type:"playCard",cardId:l.id,laneIndex:c,isFaceUp:!1},score:id(b),reason:E})}}if(t.opponent.hand.length<5){let l=8;const c=t.opponent.hand.reduce((s,f)=>s+bt(f),0)/(t.opponent.hand.length||1);t.opponent.hand.length===0?l=500:c<12&&(l=35),o.push({move:{type:"fillHand"},score:id(l),reason:"Refill hand"})}return o.length===0?{type:"fillHand"}:(o.sort((l,c)=>c.score-l.score),el()&&o.length>1&&o[1].score>0?o[1].move:o[0].move)},W0=(t,o)=>{switch(o.type){case"prompt_use_control_mechanic":return Xh(t)?{type:"resolveControlMechanicPrompt",choice:"player"}:Zh(t)&&!el()?{type:"resolveControlMechanicPrompt",choice:"opponent"}:{type:"resolveControlMechanicPrompt",choice:"skip"};case"discard":return{type:"discardCards",cardIds:[...t.opponent.hand].sort((i,l)=>{const c=ll.some(f=>i.keywords[f]),s=ll.some(f=>l.keywords[f]);return c&&!s?1:!c&&s?-1:bt(i)-bt(l)}).slice(0,o.count).map(i=>i.id)};case"select_opponent_card_to_flip":{const i=(c=>t[c].lanes.map(s=>s.length>0?s[s.length-1]:null).filter(s=>s!==null))("player");if(i.length===0)return{type:"skip"};const l=i.map(c=>({cardId:c.id,score:c.isFaceUp?c.value+5:3}));return l.sort((c,s)=>s.score-c.score),{type:"flipCard",cardId:l[0].cardId}}case"select_card_to_delete_for_anarchy_2":{const a=(c,s,f)=>{const p=t[s].protocols[f];return c.protocol===p},i=[];if(t.player.lanes.forEach((c,s)=>{c.forEach(f=>{f.isFaceUp&&a(f,"player",s)&&i.push(f)})}),i.length>0)return{type:"deleteCard",cardId:i.sort((s,f)=>f.value-s.value)[0].id};const l=[];return t.opponent.lanes.forEach((c,s)=>{c.forEach(f=>{f.isFaceUp&&a(f,"opponent",s)&&l.push(f)})}),l.length>0?{type:"deleteCard",cardId:l.sort((s,f)=>s.value-f.value)[0].id}:{type:"skip"}}case"select_cards_to_delete":case"select_card_to_delete_for_death_1":{const a=o.type==="select_cards_to_delete"?o.disallowedIds:[o.sourceCardId],i=s=>t[s].lanes.map(f=>f.length>0?f[f.length-1]:null).filter(f=>f!==null),l=i("player").filter(s=>!a.includes(s.id));if(l.length>0){const s=l.map(f=>{const p=t.player.lanes.findIndex(g=>g.some(v=>v.id===f.id)),h=t.player.laneValues[p],y=h>=10&&h>t.opponent.laneValues[p];return{cardId:f.id,score:Sc(f,"player",t)+h+(y?50:0)}});return s.sort((f,p)=>p.score-f.score),{type:"deleteCard",cardId:s[0].cardId}}const c=i("opponent").filter(s=>!a.includes(s.id));return c.length>0?{type:"deleteCard",cardId:c.sort((f,p)=>f.value-p.value)[0].id}:{type:"skip"}}case"select_any_card_to_flip":case"select_any_other_card_to_flip":case"select_any_face_down_card_to_flip_optional":case"select_any_card_to_flip_optional":{const a=Dt(t),i=f=>t[f].lanes.map(p=>p.length>0?p[p.length-1]:null).filter(p=>p!==null),l=i("player"),c=i("opponent"),s=[];return l.forEach(f=>{f.isFaceUp?s.push({cardId:f.id,score:Sc(f,"player",t)+10}):a||s.push({cardId:f.id,score:3})}),a||c.forEach(f=>{f.isFaceUp||s.push({cardId:f.id,score:f.value+8})}),s.length===0?{type:"skip"}:(s.sort((f,p)=>p.score-f.score),{type:"flipCard",cardId:s[0].cardId})}case"plague_2_opponent_discard":return t.opponent.hand.length===0?{type:"skip"}:{type:"resolvePlague2Discard",cardIds:[[...t.opponent.hand].sort((i,l)=>bt(i)-bt(l))[0].id]};case"select_cards_from_hand_to_discard_for_fire_4":{const a=Math.min(3,t.opponent.hand.length);return a===0?{type:"skip"}:{type:"resolveFire4Discard",cardIds:[...t.opponent.hand].sort((c,s)=>bt(c)-bt(s)).slice(0,a).map(c=>c.id)}}case"select_cards_from_hand_to_discard_for_hate_1":{const a=Math.min(o.count,t.opponent.hand.length);return a===0?{type:"skip"}:{type:"resolveHate1Discard",cardIds:[...t.opponent.hand].sort((c,s)=>bt(c)-bt(s)).slice(0,a).map(c=>c.id)}}case"select_card_from_hand_to_play":{if(t.opponent.hand.length===0)return{type:"skip"};const a=o.isFaceDown===!0;let i=[0,1,2].filter(s=>s!==o.disallowedLaneIndex);if(i=i.filter(s=>{const f=t.player.lanes[s],p=f.length>0?f[f.length-1]:null;return!(p&&p.isFaceUp&&p.protocol==="Plague"&&p.value===0)}),i.length===0)return{type:"skip"};const l=[];for(const s of t.opponent.hand)for(const f of i){if(!a){const y=t.opponent.lanes.flat().some(C=>C.isFaceUp&&C.protocol==="Spirit"&&C.value===1),g=t.opponent.lanes.some(C=>{if(C.length===0)return!1;const x=C[C.length-1];return x.isFaceUp&&x.protocol==="Chaos"&&x.value===3}),v=[...t.player.lanes.flat(),...t.opponent.lanes.flat()].some(C=>C.isFaceUp&&C.protocol==="Anarchy"&&C.value===1);let w;if(v?w=s.protocol!==t.opponent.protocols[f]&&s.protocol!==t.player.protocols[f]:w=s.protocol===t.opponent.protocols[f]||s.protocol===t.player.protocols[f]||y||g,w){const C=s.value,x=t.opponent.laneValues[f]+C;let b=bt(s)+C*2;x>=10&&x>t.player.laneValues[f]&&(b+=100),l.push({cardId:s.id,laneIndex:f,isFaceUp:!0,score:b})}}if(!t.player.lanes[f].some(y=>y.isFaceUp&&y.protocol==="Metal"&&y.value===2)){const y=Et({...s,isFaceUp:!1},t.opponent.lanes[f]),g=t.opponent.laneValues[f]+y;let v=y*2;g>=10&&g>t.player.laneValues[f]&&(v+=80),l.push({cardId:s.id,laneIndex:f,isFaceUp:!1,score:v})}}if(l.length===0)return{type:"skip"};l.sort((s,f)=>f.score-s.score);const c=l[0];return{type:"playCard",cardId:c.cardId,laneIndex:c.laneIndex,isFaceUp:c.isFaceUp}}case"select_card_from_hand_to_give":return t.opponent.hand.length===0?{type:"skip"}:{type:"giveCard",cardId:[...t.opponent.hand].sort((i,l)=>bt(i)-bt(l))[0].id};case"select_card_from_hand_to_reveal":return t.opponent.hand.length===0?{type:"skip"}:{type:"revealCard",cardId:[...t.opponent.hand].sort((i,l)=>bt(l)-bt(i))[0].id};case"select_lane_for_death_2":{const a=[0,1,2].map(i=>{let l=0,c=0;return t.player.lanes[i].forEach(s=>{s.isFaceUp&&(s.value===1||s.value===2)&&l++}),t.opponent.lanes[i].forEach(s=>{s.isFaceUp&&(s.value===1||s.value===2)&&c++}),{laneIndex:i,score:l*10-c*5}});return a.sort((i,l)=>l.score-i.score),{type:"selectLane",laneIndex:a[0].laneIndex}}case"select_card_to_return":case"select_opponent_card_to_return":{const a=[];if(t.player.lanes.forEach(l=>{l.length>0&&a.push(l[l.length-1])}),a.length>0)return a.sort((l,c)=>Sc(c,"player",t)-Sc(l,"player",t)),{type:"returnCard",cardId:a[0].id};const i=[];return t.opponent.lanes.forEach(l=>{l.length>0&&i.push(l[l.length-1])}),i.length>0?(i.sort((l,c)=>l.value-c.value),{type:"returnCard",cardId:i[0].id}):{type:"skip"}}case"select_lane_for_play":case"select_lane_for_life_3_play":{let a=[0,1,2].filter(l=>!("disallowedLaneIndex"in o)||l!==o.disallowedLaneIndex);if(a=a.filter(l=>{const c=t.player.lanes[l],s=c.length>0?c[c.length-1]:null,f=s&&s.isFaceUp&&s.protocol==="Plague"&&s.value===0,p="isFaceDown"in o&&o.isFaceDown&&c.some(h=>h.isFaceUp&&h.protocol==="Metal"&&h.value===2);return!f&&!p}),a.length===0)return{type:"skip"};const i=a.map(l=>{const c=t.opponent.laneValues[l]-t.player.laneValues[l];return{laneIndex:l,score:-c}});return i.sort((l,c)=>c.score-l.score),{type:"selectLane",laneIndex:i[0].laneIndex}}case"prompt_rearrange_protocols":return Cd(t,o);case"prompt_swap_protocols":{const{target:a}=o,i=t[a].protocols,l=t[a].hand,c=[[0,1],[0,2],[1,2]];let s=[0,1],f=-1/0;for(const p of c){const[h,y]=p,g=[...i];[g[h],g[y]]=[g[y],g[h]];let v=0;if(a==="opponent")for(const w of l){const C=w.protocol===i[h],x=w.protocol===i[y],b=w.protocol===g[h],E=w.protocol===g[y];b&&!C&&(v+=bt(w)),E&&!x&&(v+=bt(w)),!b&&C&&(v-=bt(w)),!E&&x&&(v-=bt(w))}else for(const w of l){const C=w.protocol===i[h],x=w.protocol===i[y],b=w.protocol===g[h],E=w.protocol===g[y];b&&!C&&(v-=bt(w)),E&&!x&&(v-=bt(w)),!b&&C&&(v+=bt(w)),!E&&x&&(v+=bt(w))}v>f&&(f=v,s=p)}return{type:"resolveSwapProtocols",indices:s}}case"select_lane_for_shift":{let a=[0,1,2].filter(i=>!("disallowedLaneIndex"in o)||i!==o.disallowedLaneIndex).filter(i=>!("originalLaneIndex"in o)||i!==o.originalLaneIndex);if("sourceCardId"in o){const i=[...t.player.lanes.flat(),...t.opponent.lanes.flat()].find(l=>l.id===o.sourceCardId);if(i&&i.protocol==="Gravity"&&i.value===1){let l=null;for(let c=0;c<3;c++)if([...t.player.lanes[c],...t.opponent.lanes[c]].some(f=>f.id===o.sourceCardId)){l=c;break}l!==null&&"originalLaneIndex"in o&&(o.originalLaneIndex===l||(a=[l]))}if(i&&i.protocol==="Anarchy"&&i.value===1){const l="cardToShiftId"in o?o.cardToShiftId:null;if(l){const c=[...t.player.lanes.flat(),...t.opponent.lanes.flat()].find(s=>s.id===l);c&&(a=a.filter(s=>{const f=t.player.protocols[s],p=t.opponent.protocols[s],h=c.protocol;return h!==f&&h!==p}))}}}return a.length>0?{type:"selectLane",laneIndex:a[Math.floor(Math.random()*a.length)]}:{type:"selectLane",laneIndex:0}}case"select_lane_for_water_3":case"select_lane_to_shift_cards_for_light_3":{const a=[0,1,2].filter(i=>!("disallowedLaneIndex"in o)||i!==o.disallowedLaneIndex).filter(i=>!("originalLaneIndex"in o)||i!==o.originalLaneIndex);return a.length>0?{type:"selectLane",laneIndex:a[Math.floor(Math.random()*a.length)]}:{type:"selectLane",laneIndex:0}}case"select_lane_for_metal_3_delete":{const a=[0,1,2].filter(i=>!("disallowedLaneIndex"in o)||i!==o.disallowedLaneIndex).filter(i=>!("originalLaneIndex"in o)||i!==o.originalLaneIndex).filter(i=>t.player.lanes[i].length+t.opponent.lanes[i].length>=8);return a.length>0?{type:"selectLane",laneIndex:a[Math.floor(Math.random()*a.length)]}:{type:"skip"}}case"prompt_death_1_effect":return{type:"resolveDeath1Prompt",accept:!el()};case"prompt_give_card_for_love_1":return{type:"resolveLove1Prompt",accept:!1};case"plague_4_player_flip_optional":return{type:"resolvePlague4Flip",accept:!1};case"prompt_fire_3_discard":return{type:"resolveFire3Prompt",accept:t.opponent.hand.length>2};case"prompt_shift_for_speed_3":return{type:"resolveSpeed3Prompt",accept:!el()};case"prompt_shift_for_spirit_3":return{type:"resolveSpirit3Prompt",accept:!el()};case"prompt_return_for_psychic_4":return{type:"resolvePsychic4Prompt",accept:!0};case"prompt_spirit_1_start":return{type:"resolveSpirit1Prompt",choice:"flip"};case"select_card_from_other_lanes_to_delete":{const{disallowedLaneIndex:a,lanesSelected:i}=o,l=[];for(let c=0;c<3;c++){if(c===a||i.includes(c))continue;const s=t.player.lanes[c];if(s.length>0){l.push(s[s.length-1]);continue}const f=t.opponent.lanes[c];f.length>0&&l.push(f[f.length-1])}return l.length>0?{type:"deleteCard",cardId:l[0].id}:{type:"skip"}}case"select_face_down_card_to_delete":{const a="disallowedIds"in o&&Array.isArray(o.disallowedIds)?o.disallowedIds:[],i=s=>t[s].lanes.map(f=>f.length>0?f[f.length-1]:null).filter(f=>f!==null),l=i("player").filter(s=>!a.includes(s.id));if(l.length>0)return{type:"deleteCard",cardId:l[0].id};const c=i("opponent").filter(s=>!a.includes(s.id));return c.length>0?{type:"deleteCard",cardId:c[0].id}:{type:"skip"}}case"select_low_value_card_to_delete":{const a=[];for(const l of["player","opponent"])for(const c of t[l].lanes)c.length>0&&a.push(c[c.length-1]);const i=a.filter(l=>l.isFaceUp&&(l.value===0||l.value===1));return i.length>0?{type:"deleteCard",cardId:i[0].id}:{type:"skip"}}case"select_own_highest_card_to_delete_for_hate_2":{const a=o.actor,i=[];if(t[a].lanes.forEach((s,f)=>{if(s.length>0){const p=s[s.length-1],h=p.isFaceUp?p.value:2;i.push({card:p,laneIndex:f,value:h})}}),i.length===0)return{type:"skip"};const l=Math.max(...i.map(s=>s.value));return{type:"deleteCard",cardId:i.filter(s=>s.value===l)[0].card.id}}case"select_opponent_highest_card_to_delete_for_hate_2":{const i=o.actor==="player"?"opponent":"player",l=[];if(t[i].lanes.forEach((f,p)=>{if(f.length>0){const h=f[f.length-1],y=h.isFaceUp?h.value:2;l.push({card:h,laneIndex:p,value:y})}}),l.length===0)return{type:"skip"};const c=Math.max(...l.map(f=>f.value));return{type:"deleteCard",cardId:l.filter(f=>f.value===c)[0].card.id}}case"select_opponent_face_up_card_to_flip":{const i=(l=>t[l].lanes.map(c=>c.length>0?c[c.length-1]:null).filter(c=>c!==null))("player").filter(l=>l.isFaceUp);return i.length>0?(i.sort((l,c)=>c.value-l.value),{type:"flipCard",cardId:i[0].id}):{type:"skip"}}case"select_face_down_card_to_reveal_for_light_2":{const a=f=>t[f].lanes.map(p=>p.length>0?p[p.length-1]:null).filter(p=>p!==null),i=a("player"),l=a("opponent"),c=i.filter(f=>!f.isFaceUp);if(c.length>0)return{type:"deleteCard",cardId:c[0].id};const s=l.filter(f=>!f.isFaceUp);return s.length>0?{type:"deleteCard",cardId:s[0].id}:{type:"skip"}}case"select_any_other_card_to_flip_for_water_0":case"select_card_to_flip_for_fire_3":case"select_card_to_flip_for_light_0":case"select_covered_card_to_flip_for_chaos_0":case"select_covered_card_in_line_to_flip_optional":{const a="optional"in o&&o.optional,l=!["select_any_other_card_to_flip","select_any_other_card_to_flip_for_water_0"].includes(o.type);if(o.type==="select_covered_card_to_flip_for_chaos_0"){const{laneIndex:y}=o,g=t.player.lanes[y].filter((w,C,x)=>C<x.length-1);if(g.length>0)return{type:"flipCard",cardId:g[0].id};const v=t.opponent.lanes[y].filter((w,C,x)=>C<x.length-1);return v.length>0?{type:"flipCard",cardId:v[0].id}:{type:"skip"}}if(o.type==="select_covered_card_in_line_to_flip_optional"){const{laneIndex:y}=o,g=t.player.lanes[y].filter((w,C,x)=>C<x.length-1);if(g.length>0)return{type:"flipCard",cardId:g[0].id};const v=t.opponent.lanes[y].filter((w,C,x)=>C<x.length-1);return v.length>0?{type:"flipCard",cardId:v[0].id}:{type:"skip"}}const c=y=>t[y].lanes.map(g=>g.length>0?g[g.length-1]:null).filter(g=>g!==null),s=c("player"),f=c("opponent");{const y=s.filter(g=>g.isFaceUp).sort((g,v)=>v.value-g.value);if(y.length>0)return{type:"flipCard",cardId:y[0].id}}const p=f.filter(y=>!y.isFaceUp);if(p.length>0)return{type:"flipCard",cardId:p[0].id};const h=s.filter(y=>!y.isFaceUp);if(h.length>0)return{type:"flipCard",cardId:h[0].id};{const y=f.filter(v=>!(!v.isFaceUp||!l&&v.id===o.sourceCardId)),g=y.filter(v=>{const w=t.opponent.lanes.findIndex(C=>C.length>0&&C[C.length-1].id===v.id);return w!==-1&&t.opponent.compiled[w]});if(g.length>0&&!a)return{type:"flipCard",cardId:g[0].id};if(y.length>0&&!a)return{type:"flipCard",cardId:y[0].id}}return{type:"skip"}}case"select_own_card_to_return_for_water_4":{const a=[];return t.opponent.lanes.forEach(i=>{i.length>0&&a.push(i[i.length-1])}),a.length>0?{type:"returnCard",cardId:a[Math.floor(Math.random()*a.length)].id}:"optional"in o&&o.optional?{type:"skip"}:{type:"skip"}}case"select_card_to_shift_for_anarchy_0":{const a=[...t.player.lanes.flat(),...t.opponent.lanes.flat()];return a.length>0?{type:"shiftCard",cardId:a[Math.floor(Math.random()*a.length)].id}:{type:"skip"}}case"select_card_to_shift_for_anarchy_1":{const{sourceCardId:a}=o,i=[...t.player.lanes.flat(),...t.opponent.lanes.flat()].filter(l=>l.id!==a);return i.length>0?{type:"shiftCard",cardId:i[Math.floor(Math.random()*i.length)].id}:{type:"skip"}}case"select_card_to_shift_for_gravity_1":{const a=[...t.player.lanes.flat(),...t.opponent.lanes.flat()];return a.length>0?{type:"shiftCard",cardId:a[Math.floor(Math.random()*a.length)].id}:{type:"skip"}}case"select_card_to_flip_and_shift_for_gravity_2":{const a=c=>t[c].lanes.map(s=>s.length>0?s[s.length-1]:null).filter(s=>s!==null),i=a("player");if(i.length>0)return{type:"deleteCard",cardId:i[Math.floor(Math.random()*i.length)].id};const l=a("opponent");return l.length>0?{type:"deleteCard",cardId:l[Math.floor(Math.random()*l.length)].id}:{type:"skip"}}case"select_face_down_card_to_shift_for_gravity_4":{const{targetLaneIndex:a}=o,i=[];for(const l of["player","opponent"])for(let c=0;c<t[l].lanes.length;c++)if(c!==a)for(const s of t[l].lanes[c])s.isFaceUp||i.push(s);return i.length>0?{type:"deleteCard",cardId:i[Math.floor(Math.random()*i.length)].id}:{type:"skip"}}case"select_face_down_card_to_shift_for_darkness_4":{const a=[];for(const i of["player","opponent"])for(const l of t[i].lanes)if(l.length>0){const c=l[l.length-1];c.isFaceUp||a.push(c)}return a.length>0?{type:"deleteCard",cardId:a[Math.floor(Math.random()*a.length)].id}:{type:"skip"}}case"shift_flipped_card_optional":{const a=fe(t,o.cardId);if(!a)return{type:"skip"};let i=-1;const l=t[a.owner];for(let s=0;s<l.lanes.length;s++)if(l.lanes[s].some(f=>f.id===o.cardId)){i=s;break}if(i===-1)return{type:"skip"};const c=[0,1,2].filter(s=>s!==i);return c.length>0?{type:"selectLane",laneIndex:c[Math.floor(Math.random()*c.length)]}:{type:"skip"}}case"select_lane_to_shift_revealed_card_for_light_2":{let a=[0,1,2];return"disallowedLaneIndex"in o&&o.disallowedLaneIndex!==void 0&&(a=a.filter(i=>i!==o.disallowedLaneIndex)),"originalLaneIndex"in o&&o.originalLaneIndex!==void 0&&(a=a.filter(i=>i!==o.originalLaneIndex)),a.length>0?{type:"selectLane",laneIndex:a[Math.floor(Math.random()*a.length)]}:"optional"in o&&o.optional?{type:"skip"}:{type:"skip"}}case"select_opponent_face_down_card_to_shift":{const a=[];for(const i of t.player.lanes)if(i.length>0){const l=i[i.length-1];l.isFaceUp||a.push(l)}return a.length>0?{type:"deleteCard",cardId:a[Math.floor(Math.random()*a.length)].id}:{type:"skip"}}case"select_own_card_to_shift_for_speed_3":return{type:"deleteCard",cardId:t.opponent.lanes.flat()[0].id};case"select_opponent_covered_card_to_shift":{const a=[];for(const i of t.player.lanes)for(let l=0;l<i.length-1;l++)a.push(i[l]);return a.length>0?{type:"deleteCard",cardId:a[Math.floor(Math.random()*a.length)].id}:{type:"skip"}}case"select_own_covered_card_to_shift":{const a=[];for(const i of t.opponent.lanes)for(let l=0;l<i.length-1;l++)a.push(i[l]);return a.length>0?{type:"deleteCard",cardId:a[Math.floor(Math.random()*a.length)].id}:{type:"skip"}}case"select_card_to_shift":{const a=o.targetFilter||{},i=[];for(const l of["player","opponent"]){const c=l==="opponent";if(!(a.owner==="own"&&!c)&&!(a.owner==="opponent"&&c))for(const s of t[l].lanes)for(let f=0;f<s.length;f++){const p=s[f],h=f===s.length-1;a.position==="uncovered"&&!h||a.position==="covered"&&h||a.faceState==="face_up"&&!p.isFaceUp||a.faceState==="face_down"&&p.isFaceUp||a.excludeSelf&&p.id===o.sourceCardId||i.push(p)}}return i.length>0?{type:"deleteCard",cardId:i[Math.floor(Math.random()*i.length)].id}:{type:"skip"}}case"select_any_opponent_card_to_shift":{const a=t.player.lanes.map(i=>i.length>0?i[i.length-1]:null).filter(i=>i!==null);return a.length>0?{type:"deleteCard",cardId:a[Math.floor(Math.random()*a.length)].id}:{type:"skip"}}case"select_own_other_card_to_shift":{const a=t.opponent.lanes.flat().find(i=>i.id!==o.sourceCardId);return a?{type:"deleteCard",cardId:a.id}:{type:"skip"}}case"select_own_face_up_covered_card_to_flip":return{type:"skip"};case"prompt_shift_or_flip_for_light_2":{const{revealedCardId:a}=o,i=fe(t,a);return i?i.owner==="opponent"?{type:"resolveLight2Prompt",choice:"flip"}:{type:"resolveLight2Prompt",choice:"skip"}:{type:"skip"}}case"plague_4_opponent_delete":{const a="disallowedIds"in o&&Array.isArray(o.disallowedIds)?o.disallowedIds:[],i=s=>t[s].lanes.map(f=>f.length>0?f[f.length-1]:null).filter(f=>f!==null),l=i("player").filter(s=>!a.includes(s.id));if(l.length>0)return{type:"deleteCard",cardId:l[0].id};const c=i("opponent").filter(s=>!a.includes(s.id));return c.length>0?{type:"deleteCard",cardId:c[0].id}:{type:"skip"}}case"flip_self_for_water_0":return o.sourceCardId?{type:"flipCard",cardId:o.sourceCardId}:{type:"skip"};case"reveal_opponent_hand":return{type:"skip"};default:{if("optional"in o&&o.optional)return{type:"skip"};const a=[...t.player.lanes.flat(),...t.opponent.lanes.flat()];return a.length>0&&(o.type.includes("select_")||o.type.includes("shift"))?{type:"deleteCard",cardId:a[0].id}:{type:"skip"}}}},Q0=(t,o)=>o?W0(t,o):t.phase==="compile"&&t.compilableLanes.length>0?{type:"compile",laneIndex:t.compilableLanes.reduce((i,l)=>t.opponent.laneValues[l]>t.opponent.laneValues[i]?l:i)}:t.phase==="action"?Y0(t):{type:"fillHand"};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * IMPROVED HARD AI with Memory & Strategic Thinking
 */let Pn={knownPlayerCards:new Map,knownOwnCards:new Map,suspectedThreats:new Set,lastPlayerLaneValues:[0,0,0],turnsPlayed:0};const Kh=t=>{Pn.turnsPlayed++,t.player.lanes.flat().forEach(o=>{o.isFaceUp&&Pn.knownPlayerCards.set(o.id,o)}),t.opponent.lanes.flat().forEach(o=>{o.isFaceUp&&Pn.knownOwnCards.set(o.id,o)}),t.player.lanes.forEach((o,a)=>{t.player.laneValues[a]>=7&&o.forEach(i=>{i.isFaceUp||Pn.suspectedThreats.add(i.id)})}),Pn.lastPlayerLaneValues=[...t.player.laneValues]},Ja=["delete","flip","shift","return","discard"],vt=(t,o)=>{var i,l,c,s;let a=0;if(t.keywords.delete){const f=o.player.lanes.flat().length,p=(i=t.middle.match(/Delete (\d+)/))==null?void 0:i[1];if(p){const h=Math.min(parseInt(p),f);a+=h*100}}if(t.keywords.flip&&t.middle.includes("opponent")){const f=o.player.lanes.flat().filter(p=>p.isFaceUp);if(f.length>0){const p=Math.min(1,f.length);a+=p*2*50}}if(t.keywords.flip&&(t.middle.includes("your")||t.middle.includes("1 of YOUR"))){const f=o.opponent.lanes.flat().filter(p=>!p.isFaceUp);if(f.length>0){const p=Math.min(1,f.length);a+=p*2*50}}if(t.keywords.discard&&!t.middle.includes("opponent")){const f=(l=t.middle.match(/Discard (\d+)/))==null?void 0:l[1];f&&(a-=parseInt(f)*30)}if(t.keywords.discard&&t.middle.includes("opponent")){const f=(c=t.middle.match(/(\d+)/))==null?void 0:c[1];if(f&&o.player.hand.length>0){const p=Math.min(parseInt(f),o.player.hand.length);a+=p*30}}if(t.keywords.return&&o.opponent.lanes.flat().length>0&&(a+=20),t.keywords.shift&&o.player.lanes.flat().length+o.opponent.lanes.flat().length>0&&(a+=30),t.keywords.draw){const f=(s=t.middle.match(/Draw (\d+)/))==null?void 0:s[1];f&&(a+=parseInt(f)*20)}return t.keywords.play&&(a+=40),a},_t=(t,o,a)=>{let i;for(const c of a[o].lanes)if(c.some(s=>s.id===t.id)){i=c;break}if(!i)return 0;if(!t.isFaceUp){const s=i.some(f=>f.isFaceUp&&f.protocol==="Darkness"&&f.value===2)?4:2;if(Pn.knownPlayerCards.has(t.id)){const f=Pn.knownPlayerCards.get(t.id);return f.value*2+(Ja.some(p=>f.keywords[p])?8:0)}return Pn.suspectedThreats.has(t.id)?s+6:s}let l=t.value*2.5;return t.top.length>0&&(l+=8),(t.bottom.includes("Start:")||t.bottom.includes("End:"))&&(l+=10),t.bottom.includes("covered:")&&(l+=6),Ja.some(c=>t.keywords[c])&&(l+=5),l},mo=(t,o,a,i)=>{const l=i[o].laneValues[a],c=i[o].compiled[a];if(o==="opponent"){if(c)return 1e4;const s=10-l;return s<=0?-1e4:s<=3?-5e3:1e3}else{if(c)return 0;let s=l*1e3;return l>=10&&l>i.opponent.laneValues[a]&&(s+=1e5),s}},X0=(t,o,a,i)=>{const l=i[o].laneValues[a],c=i[o].compiled[a],s=Et(t,i[o].lanes[a]);if(o==="opponent"){if(c)return-1e4;const f=l+s,p=10-f;return p<=0?f>i.player.laneValues[a]?5e4:3e4:p<=3?2e4:1e4-l*100}else{if(c)return 1e5;const f=l+s;return f>=10&&f>i.opponent.laneValues[a]?-1e5:5e4-l*1e3}},dd=t=>{let o=0;return t.keywords.delete&&(o+=30),t.keywords.discard&&(o+=20),t.keywords.return&&(o+=15),t.keywords.shift&&(o+=10),t.keywords.draw&&(o+=8),t.keywords.play&&(o+=25),t.keywords.prevent&&(o+=12),t.keywords.flip&&(o+=10),t.protocol==="Hate"&&t.value===1&&(o+=40),t.protocol==="Death"&&t.value===3&&(o+=35),t.protocol==="Fire"&&t.value===4&&(o+=30),t.protocol==="Psychic"&&t.value===0&&(o+=25),o},Ht=(t,o,a,i)=>{const l=i[o].laneValues[a],c=i[o].compiled[a];if(o==="player")if(t.isFaceUp){let f=-(2-t.value)*100;const p=dd(t);return f+=p*10,l>=8&&(f+=200),f}else if(Pn.knownPlayerCards.has(t.id)){const s=Pn.knownPlayerCards.get(t.id);if(s.value<=1)return-800;const f=dd(s);return s.value>=4||f>30?-400:-300}else return-600;else{if(t.isFaceUp)return t.value<=1&&!(t.keywords&&(t.keywords.play||t.keywords.uncover))?50:-1e3;{let s;Pn.knownOwnCards.has(t.id)&&(s=Pn.knownOwnCards.get(t.id));const f=(s==null?void 0:s.value)??t.value,p=s?dd(s):10;let h=f*100;if(h+=p*5,!c){const y=l-2+f;y>=10&&y>i.player.laneValues[a]?h+=500:y>=7&&(h+=200)}return f<=1&&h<300&&(h=10),h}}},Z0=t=>{const o=t.opponent.compiled.filter(x=>x).length,a=t.player.compiled.filter(x=>x).length,i=o===2,l=o>=2||o===1&&a===0,c=t.player.laneValues.map((x,b)=>({lane:b,value:x,canCompile:x>=10&&x>t.opponent.laneValues[b]&&!t.player.compiled[b]})),s=c.some(x=>x.canCompile),f=c.some(x=>x.value>=8&&!x.canCompile),p=s||f&&t.opponent.hand.length<3,h=t.player.laneValues.some(x=>x>=6)&&t.opponent.hand.some(x=>Ja.some(b=>x.keywords[b])),y=c.reduce((x,b)=>b.value>c[x].value?b.lane:x,0);let g=-1,v=-999;for(let x=0;x<3;x++)if(!t.opponent.compiled[x]){const b=t.opponent.laneValues[x]-t.player.laneValues[x];(b>v||b===v&&t.opponent.laneValues[x]>=10)&&(v=b,g=x)}let w=!1,C=-1;if(t.player.hand.length<=1&&t.opponent.hand.length>=2)for(let x=0;x<3;x++){if(t.opponent.compiled[x])continue;if(t.opponent.laneValues[x]-t.player.laneValues[x]>=-2){w=!0,C=x;break}}return{shouldDisrupt:h,shouldRush:l,needsDefense:p,criticalLane:y,oneAwayFromWin:i,closestToWin:g,canWinByOutlasting:w,outLastLane:C}},K0=t=>{Kh(t);const o=[],a=Z0(t),i=w=>{const C=t.player.lanes[w];if(C.length===0)return!1;const x=C[C.length-1];return x.isFaceUp&&x.protocol==="Plague"&&x.value===0},l=t.player.lanes.flat().some(w=>w.isFaceUp&&w.protocol==="Psychic"&&w.value===1),c=t.player.compiled.filter(w=>w).length,s=t.useControlMechanic&&c>=2,f=t.opponent.compiled.filter(w=>w).length,p=t.useControlMechanic&&t.controlCardHolder==="player",h=f>=1&&p,y=(w,C)=>t.opponent.lanes[w].filter(x=>x.protocol===C).length,g=w=>{if(!h)return 0;let C=0;t.opponent.lanes.forEach((E,S)=>{if(!t.opponent.compiled[S]){const j=t.opponent.laneValues[S];j>C&&(C=j)}});const x=t.opponent.laneValues[w];return x<C&&!t.opponent.compiled[w]?500+(C-x)*50:0},v=w=>{const C=t.player.laneValues[w],x=t.opponent.laneValues[w],b=t.player.compiled[w];if(C<10||b||C<=x)return!1;const E=t.opponent.lanes.flat().some(A=>A.isFaceUp&&A.protocol==="Spirit"&&A.value===1),S=t.opponent.lanes.some(A=>{if(A.length===0)return!1;const N=A[A.length-1];return N.isFaceUp&&N.protocol==="Chaos"&&N.value===3}),j=t.opponent.protocols[w],R=t.player.protocols[w];for(const A of t.opponent.hand){const I=(A.protocol===j||A.protocol===R||E||S)&&!l?A.value:0,L=t.player.lanes[w].some(H=>H.isFaceUp&&H.protocol==="Metal"&&H.value===2)?0:Et({...A,isFaceUp:!1},t.opponent.lanes[w]),D=Math.max(I,L);if(x+D>=C)return!1}return!0};for(const w of t.opponent.hand){const C=t.opponent.lanes.flat().length+t.player.lanes.flat().length;if(!(w.value===0&&C===0))for(let x=0;x<3;x++){if(i(x))continue;if(w.protocol==="Water"&&w.value===4){let z=!1;for(let F=0;F<3;F++)if(F!==x&&t.opponent.lanes[F].length>0){z=!0;break}if(!z)continue}if(t.opponent.compiled[x]&&(!t.useControlMechanic||t.opponent.laneValues[x]>=t.player.laneValues[x]))continue;if(w.protocol==="Metal"&&w.value===6){const F=t.opponent.laneValues[x]+6;if(!(F>=10))continue;const W=t.player.laneValues[x];if(F<=W)continue}const b=w.protocol==="Hate"&&w.value===2;let E=!1,S=!1;if(b){const z=F=>{const B={...w,isFaceUp:F},W=t.opponent.lanes.map((U,P)=>{if(P===x){const Z=[...U,B];return{card:B,laneContext:Z}}else if(U.length>0)return{card:U[U.length-1],laneContext:U};return null}).filter(U=>U!==null);if(W.length===0)return!1;const _e=W.reduce((U,P)=>{const Z=Et(U.card,U.laneContext);return Et(P.card,P.laneContext)>Z?P:U});return _e.card.protocol==="Hate"&&_e.card.value===2&&_e.card.isFaceUp===F};E=z(!0),S=z(!1)}const j=t.player.laneValues[x]>=10&&t.player.laneValues[x]>t.opponent.laneValues[x]&&!t.player.compiled[x],R=t.player.laneValues[x]>=10&&!t.player.compiled[x],A=t.opponent.laneValues[x]<=t.player.laneValues[x]+2,N=R&&A,I=vt(w,t),V=w.protocol===t.opponent.protocols[x],L=w.protocol===t.player.protocols[x],D=t.opponent.lanes.flat().some(z=>z.isFaceUp&&z.protocol==="Spirit"&&z.value===1),O=t.opponent.lanes.some(z=>{if(z.length===0)return!1;const F=z[z.length-1];return F.isFaceUp&&F.protocol==="Chaos"&&F.value===3}),H=[...t.player.lanes.flat(),...t.opponent.lanes.flat()].some(z=>z.isFaceUp&&z.protocol==="Anarchy"&&z.value===1);let te;if(H?te=!V&&!L&&!l:te=(V||L||D||O)&&!l,te&&!(b&&E)){let z=0,F=`Play ${w.protocol}-${w.value} face-up in lane ${x}.`;const B=w.value,W=t.opponent.laneValues[x]+B;if(j)z=B*1e3+I*10,W>=t.player.laneValues[x]?(z+=1e4,F+=" [BLOCKS IMMEDIATE COMPILE]"):(z-=5,F+=" [FAILS TO BLOCK]");else if(a.oneAwayFromWin&&x===a.closestToWin)W>=10&&W>t.player.laneValues[x]?(z=2e4,F+=" [GAME-WINNING COMPILE!!!]"):(z=5e3+W*50,F+=" [Building winning lane]");else if(a.canWinByOutlasting&&x===a.outLastLane)W>=10&&W>t.player.laneValues[x]?(z=18e3,F+=" [OUTLAST WIN]"):(z=8e3+W*30,F+=" [OUTLAST: Building]");else{if(z=B*1e3+I*10,W>=10&&W>t.player.laneValues[x]&&!t.opponent.compiled[x])z+=3e3,F+=" [COMPILES PROTOCOL!]";else if(W>=10&&t.player.laneValues[x]>=10&&!t.opponent.compiled[x]&&(W>=t.player.laneValues[x]||w.keywords.delete)){const Q=t.player.laneValues[x]-W;z+=2500-Q*50,F+=` [FIGHTING STANDOFF: ${W} vs ${t.player.laneValues[x]}]`}else W>=5&&!t.opponent.compiled[x]?(z+=1e3+W*50,F+=` [Building: ${W}/10]`):W<5&&!t.opponent.compiled[x]&&(z+=200+W*20,F+=` [Weak lane: ${W}/10]`);const _e=y(x,w.protocol);if(_e>0){const Q=_e*800;z+=Q,F+=` [SYNERGY: ${_e+1}x ${w.protocol}]`}const U=t.opponent.laneValues[x],P=g(x);if(P>0?(z+=P,F+=` [DIVERSIFY: +${P}]`):U>=6?(z+=600,F+=" [Concentration]"):U>=3&&(z+=200),Ja.some(Q=>w.keywords[Q])&&(a.shouldDisrupt&&(z+=400,F+=" [Disruption]"),t.player.laneValues[x]>=7&&(z+=200,F+=" [vs threat]")),s&&t.opponent.compiled[x]){const Q=W-t.player.laneValues[x];Q>0&&(z+=1500+Q*100,F+=` [CONTROL: lead +${Q}]`)}(w.keywords.play||w.keywords.draw)&&(z+=300,F+=" [Card+]"),t.opponent.compiled[x]&&!s&&(z-=3,F+=" [WASTED in compiled]"),N&&W<=t.player.laneValues[x]&&(z-=1,F+=" [DANGER: Falls behind]"),v(x)&&(z-=4e3,F+=" [UNDEFENDABLE LANE]")}o.push({move:{type:"playCard",cardId:w.id,laneIndex:x,isFaceUp:!0},score:z,reason:F})}if(!t.player.lanes[x].some(z=>z.isFaceUp&&z.protocol==="Metal"&&z.value===2)&&!(b&&S)){const z=Et({...w,isFaceUp:!1},t.opponent.lanes[x]),F=t.opponent.laneValues[x]+z;let B=0,W=`Play ${w.protocol}-${w.value} face-down in lane ${x}.`;if(j)F>t.player.laneValues[x]?(B=9e3,W+=" [BLOCKS COMPILE]"):(B=-4e3,W+=" [FAILS TO BLOCK]");else if(a.oneAwayFromWin&&x===a.closestToWin)F>=10&&F>t.player.laneValues[x]?(B=17e3,W+=" [GAME-WIN]"):(B=4500+F*40,W+=" [Building win]");else if(a.canWinByOutlasting&&x===a.outLastLane)F>=10&&F>t.player.laneValues[x]?(B=16e3,W+=" [OUTLAST WIN]"):(B=7e3+F*25,W+=" [OUTLAST]");else{if(B=z*50,F>=10&&F>t.player.laneValues[x]&&!t.opponent.compiled[x])B+=6e3,W+=" [COMPILES]";else if(F>=10&&t.player.laneValues[x]>=10&&!t.opponent.compiled[x]&&(F>=t.player.laneValues[x]||w.keywords.delete)){const Z=t.player.laneValues[x]-F;B+=5e3-Z*100,W+=` [STANDOFF: ${F} vs ${t.player.laneValues[x]}]`}else F>=8&&!t.opponent.compiled[x]?(B+=2e3-(10-F)*300,W+=` [Close: ${F}/10]`):F>=5&&!t.opponent.compiled[x]?(B+=600+F*30,W+=` [Building: ${F}/10]`):t.opponent.compiled[x]||(B+=100+F*15,W+=` [Weak: ${F}/10]`);const _e=y(x,w.protocol);_e>0&&(B+=_e*400,W+=` [SYNERGY: ${_e+1}x]`);const U=t.opponent.laneValues[x],P=g(x);P>0?(B+=P/2,W+=" [DIVERSIFY]"):U>=6&&(B+=300,W+=" [Conc]"),vt(w,t)>=150&&!a.oneAwayFromWin&&(B-=800,W+=" [Wasting effect]"),t.opponent.compiled[x]&&!s&&(B-=2500,W+=" [WASTED]"),N&&F<=t.player.laneValues[x]&&(B-=1500,W+=" [DANGER]"),v(x)&&(B-=4e3,W+=" [UNDEFENDABLE LANE]")}o.push({move:{type:"playCard",cardId:w.id,laneIndex:x,isFaceUp:!1},score:B,reason:W})}}}if(t.opponent.hand.length<5){let w=-5e3,C="Refresh hand";if(t.opponent.hand.length===0)w=1e3,C="Refresh hand (EMPTY - must draw!)";else if(t.opponent.hand.length===1){const x=t.opponent.hand[0];let b=!1;for(let E=0;E<3;E++){if(i(E))continue;const S=t.opponent.laneValues[E]+x.value,j=t.opponent.laneValues[E]+Et({...x,isFaceUp:!1},t.opponent.lanes[E]);if((S>=10||j>=10)&&!t.opponent.compiled[E]){b=!0;break}if(S>=5||j>=5){b=!0;break}}b||(w=500,C="Refresh hand (1 card - not useful)")}else{const x=t.useControlMechanic&&t.controlCardHolder==="opponent",b=t.player.compiled.filter(E=>E).length;x&&b>=1&&t.player.laneValues.some((S,j)=>!t.player.compiled[j]&&S>=10&&S>t.opponent.laneValues[j])&&(w=2e3,C="Refresh hand (CONTROL - stop player's next compile!)")}a.oneAwayFromWin&&t.opponent.hand.some(b=>{const E=a.closestToWin;if(E===-1)return!1;const S=t.opponent.laneValues[E]+b.value,j=t.opponent.laneValues[E]+Et({...b,isFaceUp:!1},t.opponent.lanes[E]);return S>=10||j>=10})&&(w=-5e3,C="Refresh hand (CAN WIN - DON'T REFRESH!)"),o.push({move:{type:"fillHand"},score:w,reason:C})}return o.length===0?{type:"fillHand"}:(o.sort((w,C)=>C.score-w.score),o[0].move)},J0=(t,o)=>{var a,i;switch(Kh(t),o.type){case"prompt_use_control_mechanic":return Xh(t)?{type:"resolveControlMechanicPrompt",choice:"player"}:Zh(t)?{type:"resolveControlMechanicPrompt",choice:"opponent"}:{type:"resolveControlMechanicPrompt",choice:"skip"};case"discard":return{type:"discardCards",cardIds:[...t.opponent.hand].sort((c,s)=>{const f=Ja.some(h=>c.keywords[h]),p=Ja.some(h=>s.keywords[h]);return f&&!p?1:!f&&p?-1:vt(c,t)-vt(s,t)}).slice(0,o.count).map(c=>c.id)};case"select_opponent_card_to_flip":{const l=[];return t.player.lanes.forEach((c,s)=>{if(c.length>0){const f=c[c.length-1],p=Ht(f,"player",s,t);l.push({card:f,laneIndex:s,score:p})}}),l.length===0?{type:"skip"}:(l.sort((c,s)=>s.score-c.score),{type:"flipCard",cardId:l[0].card.id})}case"select_card_to_delete_for_anarchy_2":{const l=(s,f,p)=>{const h=t[f].protocols[p];return s.protocol===h},c=[];return t.player.lanes.forEach((s,f)=>{s.forEach((p,h)=>{if(!p.isFaceUp||!l(p,"player",f))return;const y=h===s.length-1,g=_t(p,"player",t),v=t.player.laneValues[f],w=v>=10&&v>t.opponent.laneValues[f];let C=g+v*.5+(w?100:0);y&&(C+=50),c.push({card:p,owner:"player",laneIndex:f,score:C})})}),t.opponent.lanes.forEach((s,f)=>{s.forEach((p,h)=>{if(!p.isFaceUp||!l(p,"opponent",f))return;const y=h===s.length-1;let v=-_t(p,"opponent",t)-50;y||(v-=20),c.push({card:p,owner:"opponent",laneIndex:f,score:v})})}),c.length===0?{type:"skip"}:(c.sort((s,f)=>f.score-s.score),{type:"deleteCard",cardId:c[0].card.id})}case"select_cards_to_delete":case"select_card_to_delete_for_death_1":{const l=o.type==="select_cards_to_delete"?o.disallowedIds:[o.sourceCardId],c=p=>t[p].lanes.map((h,y)=>h.length>0?{card:h[h.length-1],laneIndex:y}:null).filter(h=>h!==null),s=c("player").filter(({card:p})=>!l.includes(p.id));if(s.length>0){const p=s.map(({card:h,laneIndex:y})=>{const g=t.player.laneValues[y],v=g>=10&&g>t.opponent.laneValues[y],C=t.player.compiled[y]?-1e3:0;return{cardId:h.id,score:_t(h,"player",t)*2+g+(v?100:0)+C}});return p.sort((h,y)=>y.score-h.score),{type:"deleteCard",cardId:p[0].cardId}}const f=c("opponent").filter(({card:p})=>!l.includes(p.id));return f.length>0?{type:"deleteCard",cardId:f.sort((h,y)=>_t(h.card,"opponent",t)-_t(y.card,"opponent",t))[0].card.id}:{type:"skip"}}case"select_any_card_to_flip":case"select_any_other_card_to_flip":{const l=Dt(t),c=[],s=o.type==="select_any_other_card_to_flip"?o.sourceCardId:null;return t.player.lanes.forEach((f,p)=>{if(f.length>0){const h=f[f.length-1];if(l&&!h.isFaceUp)return;if(h.id!==s){const y=Ht(h,"player",p,t);c.push({card:h,laneIndex:p,owner:"player",score:y})}}}),t.opponent.lanes.forEach((f,p)=>{if(f.length>0){const h=f[f.length-1];if(l&&!h.isFaceUp)return;if(h.id!==s){const y=Ht(h,"opponent",p,t);c.push({card:h,laneIndex:p,owner:"opponent",score:y})}}}),c.length===0?{type:"skip"}:(c.sort((f,p)=>p.score-f.score),{type:"flipCard",cardId:c[0].card.id})}case"select_any_face_down_card_to_flip_optional":{const l=[];return t.player.lanes.forEach((c,s)=>{if(c.length>0){const f=c[c.length-1];if(!f.isFaceUp){const p=Ht(f,"player",s,t);l.push({card:f,laneIndex:s,owner:"player",score:p})}}}),t.opponent.lanes.forEach((c,s)=>{if(c.length>0){const f=c[c.length-1];if(!f.isFaceUp){const p=Ht(f,"opponent",s,t);l.push({card:f,laneIndex:s,owner:"opponent",score:p})}}}),l.length===0?{type:"skip"}:(l.sort((c,s)=>s.score-c.score),{type:"flipCard",cardId:l[0].card.id})}case"select_any_card_to_flip_optional":{const l=[];return t.player.lanes.forEach((c,s)=>{if(c.length>0){const f=c[c.length-1],p=Ht(f,"player",s,t);l.push({card:f,laneIndex:s,owner:"player",score:p})}}),t.opponent.lanes.forEach((c,s)=>{if(c.length>0){const f=c[c.length-1],p=Ht(f,"opponent",s,t);l.push({card:f,laneIndex:s,owner:"opponent",score:p})}}),l.length===0?{type:"skip"}:(l.sort((c,s)=>s.score-c.score),{type:"flipCard",cardId:l[0].card.id})}case"select_own_face_up_covered_card_to_flip":{const l=[];return t.opponent.lanes.forEach((c,s)=>{for(let f=0;f<c.length-1;f++){const p=c[f];if(p.isFaceUp){const h=Ht(p,"opponent",s,t);l.push({card:p,laneIndex:s,score:h})}}}),l.length===0?{type:"skip"}:(l.sort((c,s)=>s.score-c.score),l[0].score>0?{type:"flipCard",cardId:l[0].card.id}:{type:"skip"})}case"select_face_down_card_to_reveal_for_light_2":{const l=[];return t.player.lanes.forEach((c,s)=>{if(c.length>0){const f=c[c.length-1];if(!f.isFaceUp){const p=Ht(f,"player",s,t);l.push({card:f,laneIndex:s,owner:"player",score:p})}}}),t.opponent.lanes.forEach((c,s)=>{if(c.length>0){const f=c[c.length-1];if(!f.isFaceUp){const p=Ht(f,"opponent",s,t);l.push({card:f,laneIndex:s,owner:"opponent",score:p})}}}),l.length===0?{type:"skip"}:(l.sort((c,s)=>s.score-c.score),{type:"flipCard",cardId:l[0].card.id})}case"select_opponent_face_up_card_to_flip":{const l=[];return t.player.lanes.forEach((c,s)=>{if(c.length>0){const f=c[c.length-1];if(f.isFaceUp){const p=Ht(f,"player",s,t);l.push({card:f,laneIndex:s,score:p})}}}),l.length===0?{type:"skip"}:(l.sort((c,s)=>s.score-c.score),{type:"flipCard",cardId:l[0].card.id})}case"select_card_to_flip_for_fire_3":case"select_card_to_flip_for_light_0":case"select_any_other_card_to_flip_for_water_0":case"select_covered_card_to_flip_for_chaos_0":case"select_covered_card_in_line_to_flip_optional":{const l=[];if(o.type==="select_covered_card_to_flip_for_chaos_0"){const{laneIndex:c}=o;t.player.lanes[c].forEach((s,f,p)=>{if(f<p.length-1){const h=Ht(s,"player",c,t);l.push({card:s,laneIndex:c,owner:"player",score:h})}}),t.opponent.lanes[c].forEach((s,f,p)=>{if(f<p.length-1){const h=Ht(s,"opponent",c,t);l.push({card:s,laneIndex:c,owner:"opponent",score:h})}})}else if(o.type==="select_covered_card_in_line_to_flip_optional"){const{laneIndex:c}=o;t.player.lanes[c].forEach((s,f,p)=>{if(f<p.length-1){const h=Ht(s,"player",c,t);l.push({card:s,laneIndex:c,owner:"player",score:h})}}),t.opponent.lanes[c].forEach((s,f,p)=>{if(f<p.length-1){const h=Ht(s,"opponent",c,t);l.push({card:s,laneIndex:c,owner:"opponent",score:h})}})}else{const c=o.type==="select_any_other_card_to_flip_for_water_0"?o.sourceCardId:null;t.player.lanes.forEach((s,f)=>{if(s.length>0){const p=s[s.length-1];if(p.id!==c){const h=Ht(p,"player",f,t);l.push({card:p,laneIndex:f,owner:"player",score:h})}}}),t.opponent.lanes.forEach((s,f)=>{if(s.length>0){const p=s[s.length-1];if(p.id!==c){const h=Ht(p,"opponent",f,t);l.push({card:p,laneIndex:f,owner:"opponent",score:h})}}})}return l.length===0?{type:"skip"}:(l.sort((c,s)=>s.score-c.score),{type:"flipCard",cardId:l[0].card.id})}case"select_card_from_other_lanes_to_delete":{const{disallowedLaneIndex:l,lanesSelected:c}=o,s=[],f=[];for(let p=0;p<3;p++){if(p===l||c.includes(p))continue;const h=t.player.lanes[p];h.length>0&&s.push({card:h[h.length-1],laneIndex:p,isCompiled:t.player.compiled[p]});const y=t.opponent.lanes[p];y.length>0&&f.push({card:y[y.length-1],laneIndex:p})}return s.length>0?(s.sort((p,h)=>{const y=p.isCompiled?-1e3:0,g=h.isCompiled?-1e3:0,v=_t(p.card,"player",t)+y;return _t(h.card,"player",t)+g-v}),{type:"deleteCard",cardId:s[0].card.id}):f.length>0?(f.sort((p,h)=>_t(p.card,"opponent",t)-_t(h.card,"opponent",t)),{type:"deleteCard",cardId:f[0].card.id}):{type:"skip"}}case"select_low_value_card_to_delete":{const l=[];for(const s of["player","opponent"])for(let f=0;f<3;f++){const p=t[s].lanes[f];p.length>0&&l.push({card:p[p.length-1],owner:s,laneIndex:f})}const c=l.filter(({card:s})=>s.isFaceUp&&(s.value===0||s.value===1));return c.length>0?(c.sort((s,f)=>{const p=s.owner==="player",h=f.owner==="player";if(p&&!h)return-1;if(!p&&h)return 1;if(p&&h){const y=t.player.compiled[s.laneIndex],g=t.player.compiled[f.laneIndex];if(!y&&g)return-1;if(y&&!g)return 1}return _t(f.card,f.owner,t)-_t(s.card,s.owner,t)}),{type:"deleteCard",cardId:c[0].card.id}):{type:"skip"}}case"select_own_highest_card_to_delete_for_hate_2":{const l=o.actor,c=[];if(t[l].lanes.forEach((p,h)=>{if(p.length>0){const y=p[p.length-1],g=y.isFaceUp?y.value:2;c.push({card:y,laneIndex:h,value:g})}}),c.length===0)return{type:"skip"};const s=Math.max(...c.map(p=>p.value)),f=c.filter(p=>p.value===s);return f.sort((p,h)=>{const y=t[l].laneValues[p.laneIndex],g=t[l].laneValues[h.laneIndex],v=t[l].compiled[p.laneIndex],w=t[l].compiled[h.laneIndex];return v&&!w?-1:!v&&w?1:y-g}),{type:"deleteCard",cardId:f[0].card.id}}case"select_opponent_highest_card_to_delete_for_hate_2":{const c=o.actor==="player"?"opponent":"player",s=[];if(t[c].lanes.forEach((h,y)=>{if(h.length>0){const g=h[h.length-1],v=g.isFaceUp?g.value:2;s.push({card:g,laneIndex:y,value:v})}}),s.length===0)return{type:"skip"};const f=Math.max(...s.map(h=>h.value)),p=s.filter(h=>h.value===f);return p.sort((h,y)=>{const g=t[c].laneValues[h.laneIndex],v=t[c].laneValues[y.laneIndex],w=t[c].compiled[h.laneIndex],C=t[c].compiled[y.laneIndex];return!w&&C?-1:w&&!C?1:v-g}),{type:"deleteCard",cardId:p[0].card.id}}case"select_own_card_to_return_for_water_4":{const l=[];if(t.opponent.lanes.forEach(c=>{if(c.length>0){const s=c[c.length-1];l.push({card:s,lane:c})}}),l.length>0){const c=l.map(({card:s,lane:f})=>{let h=-Et(s,f);return(s.keywords.delete||s.keywords.play||s.keywords.draw||s.keywords.flip||s.keywords.return)&&s.id!==o.sourceCardId&&(h+=8),{card:s,score:h}});return c.sort((s,f)=>f.score-s.score),{type:"returnCard",cardId:c[0].card.id}}return{type:"skip"}}case"gravity_2_shift_after_flip":case"shift_flipped_card_optional":{const l=o.type==="gravity_2_shift_after_flip"?o.cardToShiftId:o.cardId,c=fe(t,l);if(!c||c.owner!=="player")return{type:"skip"};const{card:s}=c;let f=-1;for(let y=0;y<t.player.lanes.length;y++)if(t.player.lanes[y].some(g=>g.id===l)){f=y;break}if(f===-1)return{type:"skip"};const p=[0,1,2].filter(y=>y!==f);if(p.length===0)return{type:"skip"};const h=p.map(y=>{const g=Et(s,t.player.lanes[y]),v=t.player.laneValues[y]+g;let C=-(v-t.opponent.laneValues[y]);const x=t.player.compiled[y];return v>=10&&v>t.opponent.laneValues[y]?C-=1e3:x&&(C+=800),{laneIndex:y,score:C}});return h.sort((y,g)=>g.score-y.score),{type:"selectLane",laneIndex:h[0].laneIndex}}case"select_lane_for_shift":{const{cardToShiftId:l,cardOwner:c,originalLaneIndex:s,sourceCardId:f}=o,p=(a=fe(t,l))==null?void 0:a.card;if(!p)return{type:"skip"};const h=(i=fe(t,f))==null?void 0:i.card;let y=null;if(h&&h.protocol==="Gravity"&&h.value===1){for(let w=0;w<3;w++)if([...t.player.lanes[w],...t.opponent.lanes[w]].some(x=>x.id===f)){y=w;break}}let g=[0,1,2].filter(w=>w!==s);y!==null&&(s===y?g=g:g=[y]),h&&h.protocol==="Anarchy"&&h.value===1&&(g=g.filter(w=>{const C=t.player.protocols[w],x=t.opponent.protocols[w],b=p.protocol;return b!==C&&b!==x}));const v=g.map(w=>({laneIndex:w,score:X0(p,c,w,t)}));return v.sort((w,C)=>C.score-w.score),{type:"selectLane",laneIndex:v[0].laneIndex}}case"select_own_card_to_shift_for_speed_3":{const l=[];return t.opponent.lanes.forEach((c,s)=>{if(c.length===0)return;const f=c[c.length-1],p=t.opponent.compiled[s];let h=-1/0;for(let y=0;y<3;y++){if(y===s)continue;const g=t.opponent.laneValues[y];if(t.opponent.compiled[y])continue;const w=g+2,C=t.player.laneValues[y];let x=0;p?(x+=1e4,w>=10&&w>C?x+=5e4:w>=8&&(x+=5e3)):w>=10&&w>C?x+=5e4:x=-1e4,x>h&&(h=x)}l.push({card:f,sourceLaneIndex:s,bestScore:h})}),l.length===0?{type:"skip"}:(l.sort((c,s)=>s.bestScore-c.bestScore),l[0].bestScore>0?{type:"shiftCard",cardId:l[0].card.id}:{type:"skip"})}case"select_lane_for_water_3":{const l=(s,f)=>{let p=0,h=0;for(const y of["player","opponent"]){const g=s[y].lanes[f],w=g.some(C=>C.isFaceUp&&C.protocol==="Darkness"&&C.value===2)?4:2;for(const C of g)(C.isFaceUp?C.value:w)===2&&(y==="player"?p++:h++)}return{playerTargets:p,opponentTargets:h}},c=[0,1,2].map(s=>{const{playerTargets:f,opponentTargets:p}=l(t,s),h=5-t.player.hand.length,y=f*(12+h)-p*6;return{laneIndex:s,score:y}});return c.sort((s,f)=>f.score-s.score),{type:"selectLane",laneIndex:c[0].laneIndex}}case"prompt_rearrange_protocols":return Cd(t,o);case"prompt_swap_protocols":{const{target:l}=o,c=t[l].protocols,s=t[l].hand,f=[[0,1],[0,2],[1,2]];let p=[0,1],h=-1/0;for(const y of f){const[g,v]=y,w=[...c];[w[g],w[v]]=[w[v],w[g]];let C=0;if(l==="opponent")for(const x of s){const b=x.protocol===c[g],E=x.protocol===c[v],S=x.protocol===w[g],j=x.protocol===w[v];S&&!b&&(C+=vt(x,t)),j&&!E&&(C+=vt(x,t)),!S&&b&&(C-=vt(x,t)),!j&&E&&(C-=vt(x,t))}else for(const x of s){const b=x.protocol===c[g],E=x.protocol===c[v],S=x.protocol===w[g],j=x.protocol===w[v];S&&!b&&(C-=vt(x,t)),j&&!E&&(C-=vt(x,t)),!S&&b&&(C+=vt(x,t)),!j&&E&&(C+=vt(x,t))}C>h&&(h=C,p=y)}return{type:"resolveSwapProtocols",indices:p}}case"select_card_to_shift_for_anarchy_0":{const l=[];return t.opponent.lanes.forEach((c,s)=>{if(c.length===0)return;const f=c[c.length-1],p=mo(f,"opponent",s,t);l.push({card:f,laneIndex:s,score:p})}),t.player.lanes.forEach((c,s)=>{if(c.length===0)return;const f=c[c.length-1],p=mo(f,"player",s,t);l.push({card:f,laneIndex:s,score:p})}),l.length===0?{type:"skip"}:(l.sort((c,s)=>s.score-c.score),{type:"shiftCard",cardId:l[0].card.id})}case"select_card_to_shift_for_anarchy_1":{const{sourceCardId:l}=o,c=[];return t.opponent.lanes.forEach((s,f)=>{if(s.length===0)return;const p=s[s.length-1];if(p.id===l)return;const h=mo(p,"opponent",f,t);c.push({card:p,laneIndex:f,score:h})}),t.player.lanes.forEach((s,f)=>{if(s.length===0)return;const p=s[s.length-1];if(p.id===l)return;const h=mo(p,"player",f,t);c.push({card:p,laneIndex:f,score:h})}),c.length===0?{type:"skip"}:(c.sort((s,f)=>f.score-s.score),{type:"shiftCard",cardId:c[0].card.id})}case"select_card_to_shift_for_gravity_1":{const{sourceLaneIndex:l}=o,c=[];return t.opponent.lanes.forEach((s,f)=>{if(s.length===0)return;const p=s[s.length-1],h=mo(p,"opponent",f,t);c.push({card:p,laneIndex:f,score:h})}),t.player.lanes.forEach((s,f)=>{if(s.length===0)return;const p=s[s.length-1],h=mo(p,"player",f,t);c.push({card:p,laneIndex:f,score:h})}),c.length===0?{type:"skip"}:(c.sort((s,f)=>f.score-s.score),{type:"shiftCard",cardId:c[0].card.id})}case"select_card_to_flip_and_shift_for_gravity_2":{const l=[];return t.player.lanes.forEach((c,s)=>{if(c.length>0){const f=c[c.length-1],p=Ht(f,"player",s,t);l.push({card:f,laneIndex:s,owner:"player",score:p})}}),t.opponent.lanes.forEach((c,s)=>{if(c.length>0){const f=c[c.length-1],p=Ht(f,"opponent",s,t);l.push({card:f,laneIndex:s,owner:"opponent",score:p})}}),l.length===0?{type:"skip"}:(l.sort((c,s)=>s.score-c.score),{type:"flipCard",cardId:l[0].card.id})}case"select_face_down_card_to_shift_for_gravity_4":{const{targetLaneIndex:l}=o;let c=null,s=-1/0;for(let f=0;f<3;f++){if(f===l||t.player.lanes[f].filter(j=>!j.isFaceUp).length===0)continue;const h=t.player.lanes[f][t.player.lanes[f].length-1];if(h.isFaceUp)continue;const y=t.player.laneValues[f],g=t.opponent.laneValues[f],v=y-g,C=t.player.lanes[f].some(j=>j.isFaceUp&&j.protocol==="Darkness"&&j.value===2)?4:2;let x=C*5;v>0&&(x+=v*10),y>=8&&(x+=50),y>=10&&y>g&&!t.player.compiled[f]&&(x+=200);const b=t.player.compiled[f],E=t.player.laneValues[l]+C,S=t.opponent.laneValues[l];E>=10&&E>S&&!t.player.compiled[l]?x-=500:t.player.compiled[l]?x+=400:b&&(x+=300),x>s&&(s=x,c=h)}if(c)return{type:"deleteCard",cardId:c.id};for(let f=0;f<3;f++){if(f===l)continue;const p=t.opponent.lanes[f][t.opponent.lanes[f].length-1];if(!p||p.isFaceUp)continue;const h=t.opponent.laneValues[f],y=t.player.laneValues[f],g=h-y,w=t.opponent.lanes[f].some(E=>E.isFaceUp&&E.protocol==="Darkness"&&E.value===2)?4:2;let C=0;t.opponent.compiled[f]&&(C+=100),g>3&&(C+=g*5);const x=t.opponent.laneValues[l],b=t.player.laneValues[l];x+w>=10&&x+w>b&&!t.opponent.compiled[l]&&(C+=150),C>s&&(s=C,c=p)}return c?{type:"deleteCard",cardId:c.id}:{type:"skip"}}case"select_face_down_card_to_shift_for_darkness_4":{const l=[];return t.player.lanes.forEach((c,s)=>{if(c.length>0){const f=c[c.length-1];if(!f.isFaceUp){const p=t.player.laneValues[s],h=t.opponent.laneValues[s],y=p-h;let w=(c.some(x=>x.isFaceUp&&x.protocol==="Darkness"&&x.value===2)?4:2)*3;const C=t.player.compiled[s];y>0&&(w+=y*8),p>=10&&p>h&&!t.player.compiled[s]?w+=150:p>=8&&(w+=40),C&&(w+=300),l.push({cardId:f.id,score:w,owner:"player"})}}}),t.opponent.lanes.forEach((c,s)=>{if(c.length>0){const f=c[c.length-1];if(!f.isFaceUp){const p=t.opponent.laneValues[s],h=t.player.laneValues[s],y=p-h;let g=0;t.opponent.compiled[s]?g=50:y>5&&(g=25+y*2),l.push({cardId:f.id,score:g,owner:"opponent"})}}}),l.length>0?(l.sort((c,s)=>s.score-c.score),{type:"deleteCard",cardId:l[0].cardId}):{type:"skip"}}case"select_opponent_face_down_card_to_shift":{const l=[];return t.player.lanes.forEach((c,s)=>{if(c.length===0)return;const f=c[c.length-1];if(!f.isFaceUp){const p=mo(f,"player",s,t);l.push({card:f,laneIndex:s,score:p})}}),l.length===0?{type:"skip"}:(l.sort((c,s)=>s.score-c.score),{type:"shiftCard",cardId:l[0].card.id})}case"select_any_opponent_card_to_shift":{const l=[];return t.player.lanes.forEach((c,s)=>{if(c.length===0)return;const f=c[c.length-1],p=mo(f,"player",s,t);l.push({card:f,laneIndex:s,score:p})}),l.length===0?{type:"skip"}:(l.sort((c,s)=>s.score-c.score),{type:"shiftCard",cardId:l[0].card.id})}case"select_card_from_hand_to_play":{if(t.opponent.hand.length===0)return{type:"skip"};const l=[0,1,2].filter(p=>p!==o.disallowedLaneIndex);if(l.length===0)return{type:"skip"};const c=o.isFaceDown===!0,s=[];for(const p of t.opponent.hand)for(const h of l){if(!c){const w=t.opponent.lanes.flat().some(b=>b.isFaceUp&&b.protocol==="Spirit"&&b.value===1),C=t.opponent.lanes.some(b=>{if(b.length===0)return!1;const E=b[b.length-1];return E.isFaceUp&&E.protocol==="Chaos"&&E.value===3});if(p.protocol===t.opponent.protocols[h]||p.protocol===t.player.protocols[h]||w||C){const b=p.value,E=t.opponent.laneValues[h]+b;let S=vt(p,t)+b*2;E>=10&&E>t.player.laneValues[h]&&(S+=500),s.push({cardId:p.id,laneIndex:h,isFaceUp:!0,score:S})}}const y=Et({...p,isFaceUp:!1},t.opponent.lanes[h]),g=t.opponent.laneValues[h]+y;let v=y*2;g>=10&&g>t.player.laneValues[h]&&(v+=400),s.push({cardId:p.id,laneIndex:h,isFaceUp:!1,score:v})}if(s.length===0)return{type:"skip"};s.sort((p,h)=>h.score-p.score);const f=s[0];return{type:"playCard",cardId:f.cardId,laneIndex:f.laneIndex,isFaceUp:f.isFaceUp}}case"select_card_from_hand_to_give":return t.opponent.hand.length===0?{type:"skip"}:{type:"giveCard",cardId:[...t.opponent.hand].sort((c,s)=>vt(c,t)-vt(s,t))[0].id};case"select_card_from_hand_to_reveal":return t.opponent.hand.length===0?{type:"skip"}:{type:"revealCard",cardId:[...t.opponent.hand].sort((c,s)=>vt(s,t)-vt(c,t))[0].id};case"plague_2_opponent_discard":return t.opponent.hand.length===0?{type:"skip"}:{type:"resolvePlague2Discard",cardIds:[[...t.opponent.hand].sort((c,s)=>vt(c,t)-vt(s,t))[0].id]};case"select_cards_from_hand_to_discard_for_fire_4":{const l=Math.min(3,t.opponent.hand.length);return l===0?{type:"skip"}:{type:"resolveFire4Discard",cardIds:[...t.opponent.hand].sort((f,p)=>vt(f,t)-vt(p,t)).slice(0,l).map(f=>f.id)}}case"select_cards_from_hand_to_discard_for_hate_1":{const l=Math.min(o.count,t.opponent.hand.length);return l===0?{type:"skip"}:{type:"resolveHate1Discard",cardIds:[...t.opponent.hand].sort((f,p)=>vt(f,t)-vt(p,t)).slice(0,l).map(f=>f.id)}}case"select_lane_for_death_2":{const l=[0,1,2].map(c=>{let s=0,f=0;t.player.lanes[c].forEach(h=>{h.isFaceUp&&(h.value===1||h.value===2)&&s++}),t.opponent.lanes[c].forEach(h=>{h.isFaceUp&&(h.value===1||h.value===2)&&f++});const p=s*10-f*5;return{laneIndex:c,score:p}});return l.sort((c,s)=>s.score-c.score),{type:"selectLane",laneIndex:l[0].laneIndex}}case"select_card_to_return":{const l=[];if(t.player.lanes.forEach(s=>{s.length>0&&l.push(s[s.length-1])}),l.length>0)return l.sort((s,f)=>_t(f,"player",t)-_t(s,"player",t)),{type:"returnCard",cardId:l[0].id};const c=[];return t.opponent.lanes.forEach(s=>{s.length>0&&c.push(s[s.length-1])}),c.length>0?(c.sort((s,f)=>_t(s,"opponent",t)-_t(f,"opponent",t)),{type:"returnCard",cardId:c[0].id}):{type:"skip"}}case"select_opponent_card_to_return":{const l=[];return t.player.lanes.forEach(c=>{c.length>0&&l.push(c[c.length-1])}),l.length>0?(l.sort((c,s)=>_t(s,"player",t)-_t(c,"player",t)),{type:"returnCard",cardId:l[0].id}):{type:"skip"}}case"select_lane_for_play":{const{cardInHandId:l,disallowedLaneIndex:c}=o,s=t.opponent.hand.find(h=>h.id===l);if(!s)return{type:"skip"};const p=[0,1,2].filter(h=>h!==c).map(h=>{const y=o.isFaceDown?Et({...s,isFaceUp:!1},t.opponent.lanes[h]):s.value,g=t.opponent.laneValues[h]+y;let v=g-t.player.laneValues[h];return g>=10&&g>t.player.laneValues[h]&&(v+=200),{laneIndex:h,score:v}});return p.sort((h,y)=>y.score-h.score),{type:"selectLane",laneIndex:p[0].laneIndex}}case"select_lane_for_life_3_play":{const c=[0,1,2].map(s=>{const f=t.opponent.laneValues[s]-t.player.laneValues[s];return{laneIndex:s,score:f}});return c.sort((s,f)=>s.score-f.score),{type:"selectLane",laneIndex:c[0].laneIndex}}case"select_face_down_card_to_delete":{const l=[];return t.player.lanes.forEach((c,s)=>{if(c.length>0){const f=c[c.length-1];if(!f.isFaceUp){const p=t.player.laneValues[s],y=t.player.compiled[s]?-1e3:0;l.push({cardId:f.id,score:p+10+y})}}}),l.length>0?(l.sort((c,s)=>s.score-c.score),{type:"deleteCard",cardId:l[0].cardId}):(t.opponent.lanes.forEach(c=>{if(c.length>0){const s=c[c.length-1];s.isFaceUp||l.push({cardId:s.id,score:-5})}}),l.length>0?(l.sort((c,s)=>s.score-c.score),{type:"deleteCard",cardId:l[0].cardId}):{type:"skip"})}case"select_own_other_card_to_shift":{const l=[];return t.opponent.lanes.forEach((c,s)=>{if(c.length===0)return;const f=c[c.length-1];if(f.id===o.sourceCardId)return;const p=mo(f,"opponent",s,t);l.push({card:f,laneIndex:s,score:p})}),l.length===0?{type:"skip"}:(l.sort((c,s)=>s.score-c.score),{type:"shiftCard",cardId:l[0].card.id})}case"select_lane_to_shift_cards_for_light_3":{const l=o.sourceLaneIndex,c=o.actor,s=[0,1,2].filter(p=>p!==l);if(s.length===0)return{type:"skip"};const f=s.map(p=>{let h=0;const y=t[c].laneValues[p];return h+=(10-y)*10,t[c].compiled[p]||(h+=100),{laneIndex:p,score:h}});return f.sort((p,h)=>h.score-p.score),{type:"selectLane",laneIndex:f[0].laneIndex}}case"select_lane_to_shift_revealed_card_for_light_2":{const l=o.revealedCardId;let c=null,s=null;for(let p=0;p<3;p++){if(t.opponent.lanes[p].some(h=>h.id===l)){c="opponent",s=p;break}if(t.player.lanes[p].some(h=>h.id===l)){c="player",s=p;break}}let f=[0,1,2];if(s!==null&&(f=f.filter(p=>p!==s)),f.length>0){const p=c==="opponent"?t.opponent.lanes:t.player.lanes;return f.sort((h,y)=>p[h].length-p[y].length),{type:"selectLane",laneIndex:f[0]}}return{type:"skip"}}case"select_lane_for_metal_3_delete":{const l=[0,1,2].map(c=>{const s=t.player.lanes[c],f=Math.max(...s.map(p=>p.isFaceUp?p.value:2),0);return{laneIndex:c,score:f}});return l.sort((c,s)=>s.score-c.score),{type:"selectLane",laneIndex:l[0].laneIndex}}case"prompt_death_1_effect":return{type:"resolveDeath1Prompt",accept:!0};case"prompt_give_card_for_love_1":return{type:"resolveLove1Prompt",accept:!1};case"plague_4_player_flip_optional":{if(o.sourceCardId){const l=fe(t,o.sourceCardId);if(l&&!l.card.isFaceUp){const c=l.card;if(c.keywords.flip||c.keywords.shift||c.keywords.draw)return{type:"resolvePlague4Flip",accept:!0}}}return{type:"resolvePlague4Flip",accept:!1}}case"prompt_fire_3_discard":{if(t.opponent.hand.length<=1)return{type:"resolveFire3Prompt",accept:!1};const l=p=>t[p].lanes.map(h=>h.length>0?h[h.length-1]:null).filter(h=>h!==null),c=l("player"),s=l("opponent");let f=-999;return c.forEach(p=>{if(p.isFaceUp){const y=_t(p,"player",t)+10;y>f&&(f=y)}}),s.forEach(p=>{if(p.isFaceUp){const y=_t(p,"opponent",t)+10;y>f&&(f=y)}else{const h=_t(p,"opponent",t),v=-(_t({...p,isFaceUp:!0},"opponent",t)-h);v>f&&(f=v)}}),{type:"resolveFire3Prompt",accept:f>5}}case"prompt_shift_for_speed_3":{const l=[];return t.opponent.lanes.forEach((s,f)=>{if(s.length===0)return;const p=s[s.length-1],h=t.opponent.compiled[f];let y=-1/0;for(let g=0;g<3;g++){if(g===f)continue;const v=t.opponent.laneValues[g];if(t.opponent.compiled[g])continue;const C=v+2,x=t.player.laneValues[g];let b=0;h?(b+=1e4,C>=10&&C>x?b+=5e4:C>=8&&(b+=5e3)):C>=10&&C>x?b+=5e4:b=-1e4,b>y&&(y=b)}l.push({card:p,sourceLaneIndex:f,bestScore:y})}),l.length===0?{type:"resolveSpeed3Prompt",accept:!1}:(l.sort((s,f)=>f.bestScore-s.bestScore),{type:"resolveSpeed3Prompt",accept:l[0].bestScore>0})}case"prompt_shift_for_spirit_3":return{type:"resolveSpirit3Prompt",accept:!0};case"prompt_return_for_psychic_4":return{type:"resolvePsychic4Prompt",accept:!0};case"prompt_spirit_1_start":return{type:"resolveSpirit1Prompt",choice:"flip"};case"flip_self_for_water_0":return o.sourceCardId?{type:"flipCard",cardId:o.sourceCardId}:{type:"skip"};case"plague_2_player_discard":return{type:"skip"};case"plague_4_opponent_delete":{const l=[];return t.opponent.lanes.forEach(c=>{if(c.length>0){const s=c[c.length-1];s.isFaceUp||l.push(s)}}),l.length>0?(l.sort((c,s)=>c.value-s.value),{type:"deleteCard",cardId:l[0].id}):{type:"skip"}}case"reveal_opponent_hand":return{type:"skip"};case"prompt_shift_or_flip_for_light_2":{const{revealedCardId:l}=o,c=fe(t,l);if(!c)return{type:"skip"};const{card:s,owner:f}=c;let p=0;f==="opponent"?p=vt(s,t)+s.value:p=-_t(s,"player",t);let h=0,y=-1;for(let g=0;g<t[f].lanes.length;g++)if(t[f].lanes[g].some(v=>v.id===l)){y=g;break}if(y!==-1){const g=[0,1,2].filter(v=>v!==y);if(g.length>0){let v=-1/0;for(const w of g){let C=0;if(f==="opponent"){const x=t.opponent.laneValues[w]+Et(s,[])-t.player.laneValues[w],b=t.opponent.laneValues[y]-t.player.laneValues[y];C=x-b}else{const x=t.player.laneValues[w]+Et(s,[])-t.opponent.laneValues[w];C=t.player.laneValues[y]-t.opponent.laneValues[y]-x}C>v&&(v=C)}h=v}}return p>h&&p>0?{type:"resolveLight2Prompt",choice:"flip"}:h>0?{type:"resolveLight2Prompt",choice:"shift"}:{type:"resolveLight2Prompt",choice:"skip"}}case"select_opponent_covered_card_to_shift":{const l=[];for(let c=0;c<t.player.lanes.length;c++){const s=t.player.lanes[c];for(let f=0;f<s.length-1;f++)l.push({card:s[f],laneIndex:c})}return l.length>0?(l.sort((c,s)=>{const f=t.player.compiled[c.laneIndex],p=t.player.compiled[s.laneIndex];if(f&&!p)return-1;if(!f&&p)return 1;const h=t.player.laneValues[c.laneIndex],y=t.player.laneValues[s.laneIndex];return h!==y?y-h:_t(s.card,"player",t)-_t(c.card,"player",t)}),{type:"shiftCard",cardId:l[0].card.id}):{type:"skip"}}case"select_own_covered_card_to_shift":{const l=[];for(let c=0;c<t.opponent.lanes.length;c++){const s=t.opponent.lanes[c];for(let f=0;f<s.length-1;f++)l.push({card:s[f],laneIndex:c})}return l.length>0?(l.sort((c,s)=>{const f=t.opponent.compiled[c.laneIndex],p=t.opponent.compiled[s.laneIndex];if(f&&!p)return 1;if(!f&&p)return-1;const h=t.opponent.laneValues[c.laneIndex],y=t.opponent.laneValues[s.laneIndex];return h!==y?h-y:_t(c.card,"opponent",t)-_t(s.card,"opponent",t)}),{type:"shiftCard",cardId:l[0].card.id}):{type:"skip"}}default:return{type:"skip"}}},ew=(t,o)=>o?J0(t,o):t.phase==="compile"&&t.compilableLanes.length>0?{type:"compile",laneIndex:t.compilableLanes.reduce((i,l)=>{const c=t.opponent.laneValues[i]-t.player.laneValues[i],s=t.opponent.laneValues[l]-t.player.laneValues[l];return t.opponent.compiled.filter(p=>p).length===0,s>c?l:i})}:t.phase==="action"?K0(t):{type:"fillHand"};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Fc=(t,o,a)=>{switch(a){case"normal":return Q0(t,o);case"hard":return ew(t,o);default:return G0(t,o)}},tw=(t,o,a,i,l,c,s,f,p)=>{o(h=>{const y=h.actionRequired;if(!y||!((h.turn==="player"||h._interruptedTurn==="player")&&"actor"in y&&y.actor==="opponent"))return h;const w=Fc(h,y,a);if(w.type==="discardCards"&&y.type==="discard"){const x=i.discardCards(h,w.cardIds,"opponent");return x.actionRequired?x:l.processEndOfAction(x)}if(w.type==="resolvePlague2Discard"&&y.type==="plague_2_opponent_discard"){const x=i.resolvePlague2OpponentDiscard(h,w.cardIds);return x.actionRequired?x:l.processEndOfAction(x)}if(w.type==="resolveHate1Discard"&&y.type==="select_cards_from_hand_to_discard_for_hate_1")return i.resolveHate1Discard(h,w.cardIds);if(w.type==="rearrangeProtocols"&&y.type==="prompt_rearrange_protocols"){p&&y.sourceCardId==="CONTROL_MECHANIC"&&y.actor&&p(y.actor),console.log("[DEBUG aiManager] Before resolveRearrangeProtocols, actor hand:",h[y.actor].hand.length);const x=i.resolveRearrangeProtocols(h,w.newOrder);console.log("[DEBUG aiManager] After resolveRearrangeProtocols, actor hand:",x[y.actor].hand.length);const b=l.processEndOfAction(x);return console.log("[DEBUG aiManager] After processEndOfAction, actor hand:",b[y.actor].hand.length),b}if(y.type==="reveal_opponent_hand"){const x=i.revealOpponentHand(h);return l.processEndOfAction(x)}if(w.type==="resolveSpirit3Prompt"&&y.type==="prompt_shift_for_spirit_3"){const x=i.resolveSpirit3Prompt(h,w.accept);return x.actionRequired&&x.actionRequired.actor==="opponent"?x:l.processEndOfAction(x)}if(w.type==="selectLane"){const{nextState:x,requiresAnimation:b}=f(h,w.laneIndex);return b?(c(b.animationRequests,()=>{o(E=>{const S=b.onCompleteCallback(E,j=>j);return S.actionRequired&&S.actionRequired.actor==="opponent"?S:l.processEndOfAction(S)})}),x):l.processEndOfAction(x)}if(w.type==="deleteCard"||w.type==="flipCard"||w.type==="returnCard"||w.type==="shiftCard"){const{nextState:x,requiresAnimation:b}=s(h,w.cardId);return b?(c(b.animationRequests,()=>{o(E=>{const S=b.onCompleteCallback(E,j=>j);return S.actionRequired&&S.actionRequired.actor==="opponent"?S:l.processEndOfAction(S)})}),x):x.actionRequired&&x.actionRequired.actor==="opponent"?x:l.processEndOfAction(x)}console.warn(`AI has no logic for mandatory action during player turn, clearing it: ${y.type}`);const C={...h,actionRequired:null};return l.processEndOfAction(C)})},nw=(t,o,a,i,l,c,s)=>{const f=Fc(t,t.actionRequired,a),p=t.actionRequired;if(f.type==="skip"){const y=i.skipAction(t);return t.phase==="start"?c.continueTurnAfterStartPhaseAction(y):c.processEndOfAction(y)}if(f.type==="resolveControlMechanicPrompt"&&p.type==="prompt_use_control_mechanic"){const{choice:y}=f,{originalAction:g,actor:v}=p;if(y==="skip"){let w=$(t,v,"Opponent skips rearranging protocols.");if(w.actionRequired=null,g.type==="compile"){const C=g.laneIndex;return setTimeout(()=>{o(x=>{const b=i.compileLane(x,C);return b.winner?b:{...c.processEndOfAction(b),animationState:null}})},1e3),{...w,animationState:{type:"compile",laneIndex:C},compilableLanes:[]}}else if(g.type==="fill_hand"){const C=i.fillHand(w,v);return c.processEndOfAction(C)}else return c.processEndOfAction(w)}else{const w=y;let b=$(t,v,`Opponent chooses to rearrange ${w==="opponent"?"the player's":"their own"} protocols.`);return b.actionRequired={type:"prompt_rearrange_protocols",sourceCardId:"CONTROL_MECHANIC",target:w,actor:v,originalAction:g},b}}if(f.type==="resolveDeath1Prompt"&&p.type==="prompt_death_1_effect"){const y=i.resolveDeath1Prompt(t,f.accept);return y.actionRequired?y:c.continueTurnAfterStartPhaseAction(y)}if(f.type==="resolveLove1Prompt"&&p.type==="prompt_give_card_for_love_1"){const y=i.resolveLove1Prompt(t,f.accept);return y.actionRequired?y:c.processEndOfAction(y)}if(f.type==="resolvePlague2Discard"&&p.type==="plague_2_opponent_discard")return hd(t,f.cardIds);if(f.type==="resolvePlague4Flip"&&p.type==="plague_4_player_flip_optional")return i.resolvePlague4Flip(t,f.accept,"opponent");if(f.type==="resolveFire3Prompt"&&p.type==="prompt_fire_3_discard"){const y=i.resolveFire3Prompt(t,f.accept);return y.actionRequired?y:c.processEndOfAction(y)}if(f.type==="resolveOptionalDiscardCustomPrompt"&&p.type==="prompt_optional_discard_custom"){const y=i.resolveOptionalDiscardCustomPrompt(t,f.accept);return y.actionRequired?y:c.processEndOfAction(y)}if(f.type==="resolveOptionalEffectPrompt"&&p.type==="prompt_optional_effect"){const y=i.resolveOptionalEffectPrompt(t,f.accept);return y.actionRequired?y:c.processEndOfAction(y)}if(f.type==="resolveSpeed3Prompt"&&p.type==="prompt_shift_for_speed_3"){const y=i.resolveSpeed3Prompt(t,f.accept);return y.actionRequired?y:c.processEndOfAction(y)}if(f.type==="resolvePsychic4Prompt"&&p.type==="prompt_return_for_psychic_4"){const y=i.resolvePsychic4Prompt(t,f.accept);return y.actionRequired?y:c.processEndOfAction(y)}if(f.type==="resolveSpirit1Prompt"&&p.type==="prompt_spirit_1_start"){const y=i.resolveSpirit1Prompt(t,f.choice);return y.actionRequired?y:c.continueTurnAfterStartPhaseAction(y)}if(f.type==="resolveSpirit3Prompt"&&p.type==="prompt_shift_for_spirit_3"){const y=i.resolveSpirit3Prompt(t,f.accept);return y.actionRequired?y:c.processEndOfAction(y)}if(f.type==="resolveSwapProtocols"&&p.type==="prompt_swap_protocols"){const y=i.resolveSwapProtocols(t,f.indices);return c.processEndOfAction(y)}if(f.type==="resolveFire4Discard"&&p.type==="select_cards_from_hand_to_discard_for_fire_4"){const y=i.resolveFire4Discard(t,f.cardIds);return c.processEndOfAction(y)}if(f.type==="resolveHate1Discard"&&p.type==="select_cards_from_hand_to_discard_for_hate_1")return i.resolveHate1Discard(t,f.cardIds);if(f.type==="resolveLight2Prompt"&&p.type==="prompt_shift_or_flip_for_light_2"){const y=i.resolveLight2Prompt(t,f.choice);return y.actionRequired?y:c.processEndOfAction(y)}if(f.type==="rearrangeProtocols"&&p.type==="prompt_rearrange_protocols"){s&&p.sourceCardId==="CONTROL_MECHANIC"&&p.actor&&s(p.actor),console.log("[DEBUG aiManager 2] Before resolveRearrangeProtocols, actor hand:",t[p.actor].hand.length);const y=i.resolveRearrangeProtocols(t,f.newOrder);console.log("[DEBUG aiManager 2] After resolveRearrangeProtocols, actor hand:",y[p.actor].hand.length);const g=c.processEndOfAction(y);return console.log("[DEBUG aiManager 2] After processEndOfAction, actor hand:",g[p.actor].hand.length),g}if(f.type==="selectLane"&&(p.type==="select_lane_for_shift"||p.type==="select_lane_for_death_2"||p.type==="select_lane_for_play"||p.type==="select_lane_for_water_3"||p.type==="select_lane_for_metal_3_delete"||p.type==="select_lane_for_life_3_play"||p.type==="shift_flipped_card_optional"||p.type==="gravity_2_shift_after_flip"||p.type==="select_lane_to_shift_revealed_card_for_light_2"||p.type==="select_lane_to_shift_cards_for_light_3")){const{nextState:y,requiresAnimation:g}=fd(t,f.laneIndex);if(g){const{animationRequests:v,onCompleteCallback:w}=g;return l(v,()=>{o(C=>w(C,x=>t.phase==="start"?c.continueTurnAfterStartPhaseAction(x):c.processEndOfAction(x)))}),y}return c.processEndOfAction(y)}if(f.type==="flipCard"||f.type==="deleteCard"||f.type==="returnCard"||f.type==="shiftCard"){const{nextState:y,requiresAnimation:g,requiresTurnEnd:v}=ud(t,f.cardId);if(g){const{animationRequests:w,onCompleteCallback:C}=g;return l(w,()=>{o(x=>C(x,b=>b.actionRequired?(cl(b,o,a,i,l,c),b):b.phase==="start"?c.continueTurnAfterStartPhaseAction(b):c.processEndOfAction(b)))}),y}return v?c.processEndOfAction(y):y}if(f.type==="playCard"&&p.type==="select_card_from_hand_to_play"){const{cardId:y,laneIndex:g,isFaceUp:v}=f,{newState:w,animationRequests:C}=i.playCard({...t,actionRequired:null},y,g,v,"opponent"),x={...w,animationState:{type:"playCard",cardId:y,owner:"opponent"}};return setTimeout(()=>{o(b=>{let E={...b,animationState:null};return C&&C.length>0?(l(C,()=>o(S=>c.processEndOfAction(S))),E):E.actionRequired?(cl(E,o,a,i,l,c),E):c.processEndOfAction(E)})},500),x}if(f.type==="discardCards"&&p.type==="discard"){const y=i.discardCards(t,f.cardIds,"opponent");return y.actionRequired?y:c.processEndOfAction(y)}if(f.type==="giveCard"&&p.type==="select_card_from_hand_to_give"){const y=i.resolveActionWithHandCard(t,f.cardId);return y.actionRequired?y:c.processEndOfAction(y)}if(f.type==="revealCard"&&p.type==="select_card_from_hand_to_reveal")return i.resolveActionWithHandCard(t,f.cardId);console.warn(`AI has no logic for mandatory action, clearing it: ${p.type}`);const h={...t,actionRequired:null};return c.processEndOfAction(h)},cl=(t,o,a,i,l,c,s)=>{o(f=>{if(f.turn!=="opponent"||f.winner||f.animationState||!["start","compile","action","hand_limit","end"].includes(f.phase))return f;if(f.actionRequired){const y=f.actionRequired;let g=!1;if((y.type==="discard"&&y.actor==="player"||y.type==="plague_4_opponent_delete"&&y.actor==="opponent"||"actor"in y&&y.actor==="player")&&(g=!0),g)return f}let h={...f};if(h.actionRequired&&h.actionRequired.type==="reveal_opponent_hand"){const y=i.revealOpponentHand(h);return c.processEndOfAction(y)}if(h.phase==="start"&&(h=c.processStartOfTurn(h)),h.actionRequired)return nw(h,o,a,i,l,c,s);if(h.phase==="compile"&&h.compilableLanes.length>0){const y=Fc(h,null,a);if(y.type==="compile"){const g=y.laneIndex,v=Qh(h);return v.actionRequired?v:(setTimeout(()=>{o(w=>{const C=i.compileLane(w,g);return C.winner?C:{...c.processEndOfAction(C),animationState:null}})},1e3),{...v,animationState:{type:"compile",laneIndex:g},compilableLanes:[]})}}if(h.phase==="action"){const y=Fc(h,null,a);if(y.type==="fillHand"){const g=Wh(h,"opponent");return g.actionRequired?g:c.processEndOfAction(g)}if(y.type==="playCard"){const{newState:g,animationRequests:v}=i.playCard(h,y.cardId,y.laneIndex,y.isFaceUp,"opponent"),w={...g,animationState:{type:"playCard",cardId:y.cardId,owner:"opponent"}};return setTimeout(()=>{const C=()=>{o(x=>{let b={...x},E={newState:b};if(!b.actionRequired){if(b.queuedEffect){const{card:A,laneIndex:N}=b.queuedEffect,I={cardOwner:"opponent",actor:"opponent",currentTurn:b.turn,opponent:"player",triggerType:"play"};E=sl(A,N,b,I),E.newState.queuedEffect=void 0}}const S=E.animationRequests,j=E.newState,R=()=>{o(A=>(A.actionRequired?cl(A,o,a,i,l,c):o(c.processEndOfAction(A)),A))};return S&&S.length>0?(l(S,R),j):(j.actionRequired?cl(j,o,a,i,l,c):o(c.processEndOfAction(j)),j)})};o(x=>{const b={...x,animationState:null};return v&&v.length>0?l(v,C):C(),b})},500),w}}return h.phase==="end"||h.phase==="hand_limit"?c.continueTurnProgression(h):c.processEndOfAction(h)})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function ow(t,o){let a=null,i=null;const l=["player","opponent"];for(const y of l){for(const g of t[y].lanes){const v=g.find(w=>w.id===o);if(v){a=y,i=v;break}}if(a)break}if(!a||!i)return console.error("Card to delete not found on board:",o),t;const c={...t},s={...c[a]};s.lanes=s.lanes.map(y=>y.filter(g=>g.id!==o));const{id:f,isFaceUp:p,...h}=i;return s.discard=[...s.discard,h],c[a]=s,c}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const aw=(t,o,a,i,l,c="player",s)=>{const[f,p]=J.useState(()=>{const de=Kr(t,o,l,c);return Ee(de)}),[h,y]=J.useState(null),g=J.useRef(!1),v=J.useRef(0);J.useEffect(()=>{f.turn!==c&&f.log.length<=4&&p(de=>{const ce=c==="player"?"Player":"Opponent",le=[...de.log];return le.length>0&&(le[le.length-1]={player:"player",message:`${ce} goes first.`}),{...de,turn:c,log:le}})},[c,f.turn,f.log.length]);const w=J.useCallback(de=>{switch(de){case"start":return Mh;case"end":return al;default:return Dc}},[]),C=J.useCallback((de,ce)=>{const le=re=>{if(re.length===0){ce();return}const[se,...ge]=re;se.type==="delete"?(p(me=>({...me,animationState:{type:"deleteCard",cardId:se.cardId,owner:se.owner}})),setTimeout(()=>{p(me=>{const Se=me[se.owner].lanes.findIndex(at=>at.some(nt=>nt.id===se.cardId)),$e=Se!==-1&&me[se.owner].lanes[Se].length>0&&me[se.owner].lanes[Se][me[se.owner].lanes[Se].length-1].id===se.cardId;let xe=ow(me,se.cardId);return xe=Ee(xe),$e&&Se!==-1&&(xe=sn(xe,se.owner,Se).newState),{...xe,animationState:null}}),setTimeout(()=>{ge.length>0?le(ge):ce()},10)},500)):se.type==="return"?(p(me=>({...me,animationState:{type:"returnCard",cardId:se.cardId,owner:se.owner}})),setTimeout(()=>{p(me=>{const Se=me[se.owner].lanes.findIndex(Ke=>Ke.some(Rt=>Rt.id===se.cardId)),$e=Se!==-1&&me[se.owner].lanes[Se].length>0&&me[se.owner].lanes[Se][me[se.owner].lanes[Se].length-1].id===se.cardId,xe=me[se.owner].lanes.flat().find(Ke=>Ke.id===se.cardId);if(!xe)return{...me,animationState:null};const at=me[se.owner].lanes.map(Ke=>Ke.filter(Rt=>Rt.id!==se.cardId));let nt={...me,[se.owner]:{...me[se.owner],lanes:at,hand:[...me[se.owner].hand,xe]}};return nt=Ee(nt),$e&&Se!==-1&&nt[se.owner].lanes[Se].length>0&&(nt=sn(nt,se.owner,Se).newState),{...nt,animationState:null}}),setTimeout(()=>{ge.length>0?le(ge):ce()},10)},500)):se.type==="play"?(p(me=>({...me,animationState:{type:"playCard",cardId:se.cardId,owner:se.owner}})),setTimeout(()=>{p(me=>({...me,animationState:null})),setTimeout(()=>{ge.length>0?le(ge):ce()},10)},500)):se.type==="draw"?(p(me=>({...me,animationState:{type:"draw",player:se.player,count:se.count}})),setTimeout(()=>{p(me=>({...me,animationState:null})),setTimeout(()=>{ge.length>0?le(ge):ce()},10)},500)):setTimeout(()=>{ge.length>0?le(ge):ce()},10)};le(de)},[]),x=(de,ce)=>{if(!h||f.turn!=="player"||f.phase!=="action")return;const le=h;y(null),p(re=>{const se=w(re.phase),{newState:ge,animationRequests:me}=pd(re,le,de,ce,"player"),Se={...ge,animationState:{type:"playCard",cardId:le,owner:"player"}};return setTimeout(()=>{p($e=>{let xe={...$e,animationState:null};return me&&me.length>0?(C(me,()=>{p(at=>se(at))}),xe):xe.actionRequired?xe:se(xe)})},500),Se})},b=()=>{f.turn!=="player"||f.phase!=="action"||f.actionRequired||p(de=>{const ce=w(de.phase),le=Wh(de,"player");return le.actionRequired?le:ce(le)})},E=J.useCallback(de=>{p(ce=>{var le;return((le=ce.actionRequired)==null?void 0:le.type)!=="discard"||ce.actionRequired.actor!=="player"?ce:{...ce,animationState:{type:"discardCard",owner:"player",cardIds:[de],originalAction:ce.actionRequired}}})},[]),S=J.useCallback(de=>{p(ce=>{if(ce.winner||ce.phase!=="compile")return ce;const le=w(ce.phase),se={...Qh(ce),animationState:{type:"compile",laneIndex:de},compilableLanes:[]};return setTimeout(()=>{p(ge=>{var xe;const me=nl(ge,de,a);if(me.winner)return me;if(((xe=me.actionRequired)==null?void 0:xe.type)==="prompt_use_control_mechanic")return{...me,animationState:null};const Se=me._compileAnimations;if(Se&&Se.length>0){C(Se,()=>{p(nt=>{const Ke={...nt};return delete Ke._compileAnimations,{...le(Ke),animationState:null}})});const at={...me};return delete at._compileAnimations,at}return{...le(me),animationState:null}})},1e3),se})},[a,w]),j=de=>{p(ce=>{const le=ce.turn,re=w(ce.phase),{nextState:se,requiresAnimation:ge,requiresTurnEnd:me}=ud(ce,de);return ge?(C(ge.animationRequests,()=>{p(Se=>{const $e=Se.turn!==le?xe=>xe:re;return ge.onCompleteCallback(Se,$e)})}),se):se.actionRequired?se:re(se)})},R=de=>{p(ce=>{const le=w(ce.phase),{nextState:re,requiresAnimation:se}=fd(ce,de);return se?(C(se.animationRequests,()=>{p(ge=>se.onCompleteCallback(ge,le))}),re):re.actionRequired?re:le(re)})},A=de=>{p(ce=>{const le=w(ce.phase),re=sd(ce,de);return re.actionRequired?re:le(re)})},N=de=>{p(ce=>I0(ce,de))},I=()=>{p(de=>{var re,se;const ce=w(de.phase);let le={...de,animationState:null};return((re=le.actionRequired)==null?void 0:re.type)==="prompt_shift_or_flip_for_light_2"?le=od(le,"skip"):le=xh(le),((se=le.actionRequired)==null?void 0:se.type)==="plague_4_player_flip_optional"?le:ce(le)})},V=J.useCallback(de=>{p(ce=>{var se;if(((se=ce.actionRequired)==null?void 0:se.type)!=="prompt_use_control_mechanic")return ce;const{originalAction:le,actor:re}=ce.actionRequired;if(de==="skip"){let ge=$(ce,re,"Player skips rearranging protocols.");if(ge.actionRequired=null,le.type==="compile"){const Se={...ge,animationState:{type:"compile",laneIndex:le.laneIndex},compilableLanes:[]};return setTimeout(()=>{p($e=>{const xe=nl($e,le.laneIndex,a);return xe.winner?xe:{...w(xe.phase)(xe),animationState:null}})},1e3),Se}else if(le.type==="continue_turn"){let me={...ge};return le.queuedSpeed2Actions&&le.queuedSpeed2Actions.length>0&&(me.queuedActions=[...le.queuedSpeed2Actions,...me.queuedActions||[]]),w(me.phase)(me)}else if(le.type==="resume_interrupted_turn"){let me={...ge};return me._interruptedTurn=le.interruptedTurn,me._interruptedPhase=le.interruptedPhase,le.queuedSpeed2Actions&&le.queuedSpeed2Actions.length>0&&(me.queuedActions=[...le.queuedSpeed2Actions,...me.queuedActions||[]]),Dc(me)}else{const me=rl(ge,re);return w(me.phase)(me)}}else{const ge=de;let $e=$(ce,re,`${re==="player"?"Player":"Opponent"} chooses to rearrange ${ge==="player"?"their own":"the opponent's"} protocols.`);return $e.actionRequired={type:"prompt_rearrange_protocols",sourceCardId:"CONTROL_MECHANIC",target:ge,actor:re,originalAction:le},$e}})},[a,w]),L=J.useCallback(de=>{p(ce=>{const le=w(ce.phase),re=Rh(ce,de);return re.actionRequired?re:le(re)})},[w]),D=J.useCallback(de=>{p(ce=>{const le=w(ce.phase),re=Ah(ce,de);return re.actionRequired?re:le(re)})},[w]),O=J.useCallback(de=>{p(ce=>{const le=w(ce.phase),re=nd(ce,de);return de?re:le(re)})},[w]),H=J.useCallback(de=>{p(ce=>{var le;return((le=ce.actionRequired)==null?void 0:le.type)!=="plague_2_player_discard"?ce:{...ce,animationState:{type:"discardCard",owner:"player",cardIds:de,originalAction:ce.actionRequired}}})},[]),te=J.useCallback(de=>{p(ce=>{const le=w(ce.phase),re=jh(ce,de,"player");return le(re)})},[w]),ne=J.useCallback(de=>{p(ce=>{const le=w(ce.phase),re=kh(ce,de);return de?re:le(re)})},[w]),z=J.useCallback(de=>{p(ce=>{const le=w(ce.phase),re=Dh(ce,de);return de?re:le(re)})},[w]),F=J.useCallback(de=>{p(ce=>{const le=w(ce.phase),re=M0(ce,de);return de?re:le(re)})},[w]),B=J.useCallback(de=>{p(ce=>{const le=w(ce.phase),re=Th(ce,de);return de?re:le(re)})},[w]),W=J.useCallback(de=>{p(ce=>{var se,ge,me;const le=((se=ce.actionRequired)==null?void 0:se.type)==="select_cards_from_hand_to_discard_for_fire_4",re=((ge=ce.actionRequired)==null?void 0:ge.type)==="discard"&&((me=ce.actionRequired)==null?void 0:me.variableCount);return!le&&!re?ce:{...ce,animationState:{type:"discardCard",owner:"player",cardIds:de,originalAction:ce.actionRequired}}})},[]),_e=J.useCallback(de=>{p(ce=>{var le;return((le=ce.actionRequired)==null?void 0:le.type)!=="select_cards_from_hand_to_discard_for_hate_1"?ce:{...ce,animationState:{type:"discardCard",owner:"player",cardIds:de,originalAction:ce.actionRequired}}})},[]),U=J.useCallback(de=>{p(ce=>{const le=w(ce.phase),re=od(ce,de);return re.actionRequired?re:le(re)})},[w]),P=J.useCallback(de=>{p(ce=>{const le=w(ce.phase),re=H0(ce,de);return re.actionRequired?re:le(re)})},[w]),Z=J.useCallback(de=>{p(ce=>{var ge,me;s&&((ge=ce.actionRequired)==null?void 0:ge.sourceCardId)==="CONTROL_MECHANIC"&&((me=ce.actionRequired)!=null&&me.actor)&&s(ce.actionRequired.actor);const le=w(ce.phase);console.log("[DEBUG useGameState resolveRearrangeProtocols] Before resolvers.resolveRearrangeProtocols, hand:",ce.opponent.hand.length);const re=ad(ce,de,a);if(console.log("[DEBUG useGameState resolveRearrangeProtocols] After resolvers.resolveRearrangeProtocols, hand:",re.opponent.hand.length),re.winner)return re;const se=le(re);return console.log("[DEBUG useGameState resolveRearrangeProtocols] After turnProgressionCb, hand:",se.opponent.hand.length),se})},[w,a,s]),Q=J.useCallback(de=>{p(ce=>{const le=w(ce.phase),re=rd(ce,de);return de?re:le(re)})},[w]),pe=J.useCallback(de=>{p(ce=>{const le=w(ce.phase),re=ld(ce,de);return re.actionRequired?re:le(re)})},[w]),Ce=J.useCallback(de=>{p(ce=>{const le=w(ce.phase),re=cd(ce,de);return re.actionRequired?re:le(re)})},[w]),ve=J.useCallback(de=>{p(ce=>{const le=w(ce.phase),re=B0(ce,de);return re.actionRequired?re:le(re)})},[w]),ke=J.useCallback(de=>{p(ce=>{const le=w(ce.phase),re=Fh(ce,de,a);return re.winner?re:le(re)})},[w,a]),Xe=J.useCallback(de=>{g.current=!1,v.current++,p(ce=>{if(typeof de=="function")return de(ce);const le=de;if(le==="speed-0-interrupt"){const re=["Speed","Life","Water"],se=["Metal","Death","Hate"];let ge=zn(vo(re)),me=zn(vo(se));const Se=(gt,Ot,an)=>{const yt=gt.findIndex(dt=>dt.protocol===Ot&&dt.value===an);return yt>-1?gt.splice(yt,1)[0]:wt.find(dt=>dt.protocol===Ot&&dt.value===an)},$e=Se(ge,"Speed",0),xe=Se(me,"Metal",0),at=Se(ge,"Speed",1),nt=Se(ge,"Life",1),Ke=Se(ge,"Water",1),Rt=Se(ge,"Speed",3);let De=Kr(re,se,l,c);return De.player.lanes=[[],[],[]],De.player.lanes[0]=[{...$e,id:Oe(),isFaceUp:!1}],De.player.hand=[{...at,id:Oe(),isFaceUp:!0},{...nt,id:Oe(),isFaceUp:!0},{...Ke,id:Oe(),isFaceUp:!0},{...Rt,id:Oe(),isFaceUp:!0}],De.player.deck=ge,De.player.discard=[],De.opponent.lanes=[[],[],[]],De.opponent.hand=[{...xe,id:Oe(),isFaceUp:!0}],De.opponent.deck=me,De.opponent.discard=[],De.turn="opponent",De.phase="start",De.actionRequired=null,De.queuedActions=[],De=Ee(De),De=$(De,"player","DEBUG: Dynamic Speed-0 interrupt scenario set up. AI will play Metal-0."),De}else if(le==="speed-1-trigger"){const re=["Speed","Life","Water"],se=["Metal","Death","Hate"];let ge=zn(vo(re));const me=zn(vo(se)),$e=((Ke,Rt,De)=>{const gt=Ke.findIndex(Ot=>Ot.protocol===Rt&&Ot.value===De);return gt>-1?Ke.splice(gt,1)[0]:wt.find(Ot=>Ot.protocol===Rt&&Ot.value===De)})(ge,"Speed",1);let xe=Kr(re,se,l,c);xe.player.lanes=[[],[],[]],xe.player.lanes[0]=[{...$e,id:Oe(),isFaceUp:!0}];const{drawnCards:at,remainingDeck:nt}=on(ge,[],6);return xe.player.hand=at.map(Ke=>({...Ke,id:Oe(),isFaceUp:!0})),xe.player.deck=nt,xe.player.discard=[],xe.opponent.lanes=[[],[],[]],xe.opponent.hand=[],xe.opponent.deck=me,xe.opponent.discard=[],xe.turn="player",xe.phase="hand_limit",xe.actionRequired={type:"discard",actor:"player",count:1},xe.queuedActions=[],xe=Ee(xe),xe=$(xe,"player","DEBUG: Speed-1 discard trigger scenario set up."),xe}else if(le==="fire-oncover-test"){const re=["Death","Hate","Water"],se=["Fire","Plague","Metal"],ge=zn(vo(re));let me=zn(vo(se));const Se=(gt,Ot,an)=>{const yt=gt.findIndex(dt=>dt.protocol===Ot&&dt.value===an);return yt>-1?gt.splice(yt,1)[0]:wt.find(dt=>dt.protocol===Ot&&dt.value===an)},$e=Se(me,"Fire",0),xe=Se(me,"Fire",2),at=Se(me,"Fire",3),nt=wt.find(gt=>gt.protocol==="Death"&&gt.value===1),Ke=wt.find(gt=>gt.protocol==="Hate"&&gt.value===2),Rt=wt.find(gt=>gt.protocol==="Water"&&gt.value===3);let De=Kr(re,se,l,"opponent");return De.player.lanes=[[{...nt,id:Oe(),isFaceUp:!0}],[{...Ke,id:Oe(),isFaceUp:!0}],[{...Rt,id:Oe(),isFaceUp:!0}]],De.player.hand=[],De.player.deck=ge,De.player.discard=[],De.opponent.lanes=[[{...$e,id:Oe(),isFaceUp:!0}],[],[]],De.opponent.hand=[{...at,id:Oe(),isFaceUp:!0},{...xe,id:Oe(),isFaceUp:!0}],De.opponent.deck=me,De.opponent.discard=[],De.turn="opponent",De.phase="action",De.actionRequired=null,De.queuedActions=[],De=Ee(De),De=$(De,"opponent","DEBUG: Fire On-Cover test scenario. Opponent has Fire-0 in play, Fire-3 and Fire-2 in hand. Ready to play Fire-3."),De}else if(le==="speed-2-control-test"){const re=["Speed","Light","Water"],se=["Fire","Plague","Metal"],ge=zn(vo(re)),me=zn(vo(se)),$e=((at,nt,Ke)=>{const Rt=at.findIndex(De=>De.protocol===nt&&De.value===Ke);return Rt>-1?at.splice(Rt,1)[0]:wt.find(De=>De.protocol===nt&&De.value===Ke)})(ge,"Speed",2);let xe=Kr(re,se,!0,"player");return xe.player.lanes=[[{...$e,id:Oe(),isFaceUp:!0}],[],[]],xe.player.protocols[0]="Speed",xe.player.laneValues[0]=10,xe.player.hand=[],xe.player.deck=ge,xe.player.discard=[],xe.controlCardHolder="player",xe.opponent.lanes=[[],[],[]],xe.opponent.hand=[],xe.opponent.deck=me,xe.opponent.discard=[],xe.turn="player",xe.phase="compile",xe.compilableLanes=[0],xe.actionRequired=null,xe.queuedActions=[],xe=Ee(xe),xe=$(xe,"player","DEBUG: Speed-2 + Control test scenario. Player has Speed-2 (value 10), Control Component active. Ready to compile Protocol Speed!"),xe}return ce})},[l]);return J.useEffect(()=>{const de=f.animationState;if(!de)return;let ce=0,le=!1;if(de.type==="flipCard"?(ce=600,le=!0):de.type==="drawCard"?(ce=1e3,le=!0):de.type==="discardCard"&&(ce=800,le=!0),le){const re=setTimeout(()=>{p(se=>({...se,animationState:null}))},ce);return()=>clearTimeout(re)}},[f.animationState]),J.useEffect(()=>{const de=f.animationState;if((de==null?void 0:de.type)==="discardCard"&&de.owner==="player"){const ce=setTimeout(()=>{p(le=>{const re=le.animationState;if((re==null?void 0:re.type)!=="discardCard"||!re.originalAction)return le;const{cardIds:se,originalAction:ge}=re,me=w(le.phase);let Se;return ge.type==="plague_2_player_discard"?Se=P0(le,se):ge.type==="select_cards_from_hand_to_discard_for_fire_4"?Se=Ch(le,se):ge.type==="select_cards_from_hand_to_discard_for_hate_1"?Se=td(le,se):Se=ua(le,se,"player"),Se.animationState=null,Se.actionRequired?Se:me(Se)})},500);return()=>clearTimeout(ce)}},[f.animationState,w]),J.useEffect(()=>{if(f.turn==="opponent"&&!f.winner&&!f.animationState&&!f._interruptedTurn&&!g.current){g.current=!0;const de=v.current,ce=f,le=setTimeout(()=>{v.current===de&&cl(ce,p,i,{compileLane:(re,se)=>nl(re,se,a),playCard:pd,fillHand:rl,discardCards:ua,flipCard:bh,deleteCard:(re,se)=>({newState:re,animationRequests:[{type:"delete",cardId:se,owner:"opponent"}]}),returnCard:Eh,skipAction:xh,resolveOptionalDrawPrompt:Rh,resolveDeath1Prompt:Ah,resolveLove1Prompt:nd,resolvePlague4Flip:(re,se)=>jh(re,se,"opponent"),resolvePlague2Discard:hd,resolveFire3Prompt:kh,resolveOptionalDiscardCustomPrompt:Dh,resolveSpeed3Prompt:Th,resolveFire4Discard:Ch,resolveHate1Discard:td,resolveLight2Prompt:od,resolveRearrangeProtocols:(re,se)=>ad(re,se,a),resolveActionWithHandCard:sd,resolvePsychic4Prompt:rd,resolveSpirit1Prompt:ld,resolveSpirit3Prompt:cd,resolveSwapProtocols:(re,se)=>Fh(re,se,a),revealOpponentHand:Sh},C,_h,s)},1500);return()=>{clearTimeout(le),g.current=!1}}},[f.turn,f.winner,f.animationState,f._interruptedTurn,i,a,C,f.actionRequired]),J.useEffect(()=>{const de=f.actionRequired,ce=f.turn==="player"||f._interruptedTurn==="player",le=de&&"actor"in de&&de.actor==="opponent";ce&&!f.animationState&&le&&!g.current&&(g.current=!0,tw(f,p,i,{discardCards:ua,flipCard:bh,returnCard:Eh,deleteCard:(se,ge)=>({newState:se,animationRequests:[{type:"delete",cardId:ge,owner:"opponent"}]}),resolveActionWithHandCard:sd,resolveLove1Prompt:nd,resolveHate1Discard:td,resolvePlague2OpponentDiscard:hd,revealOpponentHand:Sh,resolveRearrangeProtocols:(se,ge)=>ad(se,ge,a),resolveSpirit3Prompt:cd,resolveSpirit1Prompt:ld,resolvePsychic4Prompt:rd},_h,C,ud,fd,s),g.current=!1)},[f.actionRequired,f.turn,f.animationState,i,C,a]),J.useEffect(()=>{p(de=>de.turn==="player"&&de.phase==="start"&&!de.actionRequired?Hh(de):de)},[f.turn,f.phase]),{gameState:f,selectedCard:h,setSelectedCard:y,playSelectedCard:x,fillHand:b,discardCardFromHand:E,compileLane:S,resolveActionWithCard:j,resolveActionWithLane:R,selectHandCardForAction:N,skipAction:I,resolvePlague2Discard:H,resolveActionWithHandCard:A,resolvePlague4Flip:te,resolveFire3Prompt:ne,resolveOptionalDiscardCustomPrompt:z,resolveOptionalEffectPrompt:F,resolveFire4Discard:W,resolveHate1Discard:_e,resolveLight2Prompt:U,resolveRevealBoardCardPrompt:P,resolveRearrangeProtocols:Z,resolveSpeed3Prompt:B,resolveOptionalDrawPrompt:L,resolveDeath1Prompt:D,resolveLove1Prompt:O,resolvePsychic4Prompt:Q,resolveSpirit1Prompt:pe,resolveSpirit3Prompt:Ce,resolveSwapProtocols:ke,resolveControlMechanicPrompt:V,resolveCustomChoice:ve,setupTestScenario:Xe}},qh=({cards:t,isPlayable:o,isCompilable:a,isShiftTarget:i,isEffectTarget:l,isMatching:c,onLanePointerDown:s,onPlayFaceDown:f,onCardPointerDown:p,onCardPointerEnter:h,onCardPointerLeave:y,owner:g,animationState:v,isCardTargetable:w,laneIndex:C,sourceCardId:x,gameState:b})=>{const E=["lane"];return o&&E.push("playable"),c&&E.push("matching-protocol"),a&&E.push("compilable"),i&&E.push("shift-target"),l&&E.push("effect-target"),u.jsxs("div",{className:E.join(" "),onPointerDown:s,children:[o&&c&&g==="player"&&f&&u.jsx("button",{className:"btn btn-play-facedown",onPointerDown:S=>{S.stopPropagation(),f()},children:"Play Face-Down"}),u.jsx("div",{className:"lane-stack",children:t.map((S,j)=>{var N;const R=((N=b.actionRequired)==null?void 0:N.type)==="prompt_shift_or_flip_for_light_2"&&b.actionRequired.revealedCardId===S.id,A=Et(S,t,b,C,g);return u.jsx(nn,{card:S,isFaceUp:S.isFaceUp||R,style:{"--i":j},onPointerDown:I=>{I.stopPropagation(),p(S)},onPointerEnter:()=>h(S),animationState:v,isTargetable:w(S),isSourceOfEffect:S.id===x,faceDownValue:A},S.id)})})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const vn=(t,o)=>Wn(t).some(({rule:i,laneIndex:l})=>i.type==="block_shifts_from_and_to_lane"&&l===o),qc=(t,o)=>{var f;const{actionRequired:a}=o;if(!a||"actor"in a&&a.actor!=="player")return!1;let i=null,l=-1,c=[];for(const p of["player","opponent"]){for(let h=0;h<o[p].lanes.length;h++)if(o[p].lanes[h].some(y=>y.id===t.id)){i=p,l=h,c=o[p].lanes[h];break}if(i)break}if(!i)return!1;const s=t.id===((f=c[c.length-1])==null?void 0:f.id);switch(a.type){case"select_opponent_face_up_card_to_flip":return i==="opponent"&&t.isFaceUp&&s;case"select_card_to_flip":{const p=a.targetFilter||{},h=c.findIndex(v=>v.id===t.id),y=a.currentLaneIndex;if(y!==void 0&&l!==y)return!1;const g=p.position||"uncovered";return!(g==="uncovered"&&!s||g==="covered"&&h>=c.length-1||p.owner==="own"&&i!==a.actor||p.owner==="opponent"&&i===a.actor||p.faceState==="face_up"&&!t.isFaceUp||p.faceState==="face_down"&&t.isFaceUp||p.excludeSelf&&t.id===a.sourceCardId)}case"select_own_face_up_covered_card_to_flip":{const p=c.findIndex(h=>h.id===t.id);return i==="player"&&t.isFaceUp&&p<c.length-1}case"select_opponent_covered_card_to_shift":{const p=c.findIndex(y=>y.id===t.id),h=o.turn==="player"?"opponent":"player";return vn(o,l)?!1:i===h&&p<c.length-1}case"select_own_covered_card_to_shift":{const p=c.findIndex(h=>h.id===t.id);return vn(o,l)?!1:i===a.actor&&p<c.length-1}case"select_covered_card_in_line_to_flip_optional":{const h=c.findIndex(g=>g.id===t.id)<c.length-1;return Dt(o)&&!t.isFaceUp?!1:l===a.laneIndex&&h}case"select_covered_card_to_flip_for_chaos_0":{const h=c.findIndex(g=>g.id===t.id)<c.length-1;return Dt(o)&&!t.isFaceUp?!1:l===a.laneIndex&&h}case"shift_flipped_card_optional":return vn(o,l)?!1:t.id===a.cardId;case"select_opponent_card_to_flip":return Dt(o)&&!t.isFaceUp?!1:i==="opponent"&&s;case"select_face_down_card_to_shift_for_darkness_4":return vn(o,l)?!1:!t.isFaceUp&&s;case"select_cards_to_delete":{if(a.disallowedIds.includes(t.id))return!1;const p=a.allowedIds;if(p&&!p.includes(t.id))return!1;const h=a.currentLaneIndex;if(h!==void 0&&l!==h)return!1;const y=a.targetFilter;if(y){const g=c.findIndex(C=>C.id===t.id),v=y.position||"uncovered";if(v==="uncovered"&&!s||v==="covered"&&g>=c.length-1||y.faceState==="face_up"&&!t.isFaceUp||y.faceState==="face_down"&&t.isFaceUp)return!1;if(y.valueRange){const{min:C,max:x}=y.valueRange;if(t.value<C||t.value>x)return!1}if(y.owner==="own"&&i!==a.actor||y.owner==="opponent"&&i===a.actor)return!1;const w=a.protocolMatching;if(w){const C=o.player.protocols[l],x=o.opponent.protocols[l],b=t.protocol,E=b===C||b===x;if(w==="must_match"&&!E||w==="must_not_match"&&E)return!1}return!0}return s}case"select_card_to_delete_for_death_1":return t.id!==a.sourceCardId&&s;case"select_face_down_card_to_delete":return!t.isFaceUp&&s;case"select_low_value_card_to_delete":return t.isFaceUp&&(t.value===0||t.value===1)&&s;case"select_card_from_other_lanes_to_delete":{const{disallowedLaneIndex:p,lanesSelected:h}=a;return l!==p&&!h.includes(l)&&s}case"plague_4_opponent_delete":return(o.turn==="player"?"opponent":"player")==="player"?i==="player"&&!t.isFaceUp&&s:!1;case"select_any_other_card_to_flip":return Dt(o)&&!t.isFaceUp?!1:t.id!==a.sourceCardId&&s;case"select_card_to_return":{const p=a.targetOwner||"any",h=a.actor;return p==="own"?i===h&&s:p==="opponent"?i!==h&&s:s}case"select_card_to_flip_for_fire_3":return Dt(o)&&!t.isFaceUp?!1:s;case"select_card_to_shift_for_gravity_1":return vn(o,l)?!1:s;case"select_card_to_flip_and_shift_for_gravity_2":return vn(o,l)||Dt(o)&&!t.isFaceUp?!1:s;case"select_face_down_card_to_shift_for_gravity_4":return vn(o,l)?!1:!t.isFaceUp&&l!==a.targetLaneIndex&&s;case"select_any_card_to_flip":case"select_any_card_to_flip_optional":return Dt(o)&&!t.isFaceUp?!1:s;case"select_any_face_down_card_to_flip_optional":return!t.isFaceUp&&s;case"select_card_to_flip_for_light_0":return Dt(o)&&!t.isFaceUp?!1:s;case"select_face_down_card_to_reveal_for_light_2":return!t.isFaceUp&&s;case"select_board_card_to_reveal_custom":{const p=a.targetFilter;if(!p)return!t.isFaceUp&&s;const h=c.findIndex(g=>g.id===t.id),y=p.position||"uncovered";return!(y==="uncovered"&&!s||y==="covered"&&h>=c.length-1||p.owner==="own"&&i!==a.actor||p.owner==="opponent"&&i===a.actor||p.faceState==="face_up"&&!t.isFaceUp||p.faceState==="face_down"&&t.isFaceUp)}case"select_any_other_card_to_flip_for_water_0":return Dt(o)&&!t.isFaceUp?!1:t.id!==a.sourceCardId&&s;case"select_own_card_to_return_for_water_4":return i===a.actor&&s;case"select_own_other_card_to_shift":return vn(o,l)?!1:i===a.actor&&t.id!==a.sourceCardId&&s;case"select_own_card_to_shift_for_speed_3":return vn(o,l)?!1:i===a.actor&&s;case"select_opponent_face_down_card_to_shift":return vn(o,l)?!1:i!==a.actor&&!t.isFaceUp&&s;case"select_any_opponent_card_to_shift":return vn(o,l)?!1:i!==a.actor&&s;case"select_opponent_card_to_return":return i==="opponent"&&s;case"select_own_highest_card_to_delete_for_hate_2":return s?Tc(o,a.actor).some(h=>h.card.id===t.id):!1;case"select_opponent_highest_card_to_delete_for_hate_2":{if(!s)return!1;const p=a.actor==="player"?"opponent":"player";return Tc(o,p).some(y=>y.card.id===t.id)}case"select_card_to_delete_for_anarchy_2":{const p=o.player.protocols[l],h=o.opponent.protocols[l],y=t.protocol;return y===p||y===h}case"select_card_to_shift_for_anarchy_1":return vn(o,l)?!1:s;case"select_card_to_shift_for_anarchy_0":return vn(o,l)?!1:s;case"select_card_to_shift":{if(vn(o,l))return!1;const p=a.targetFilter||{},h=a.destinationRestriction;if((h==null?void 0:h.type)==="non_matching_protocol"&&!t.isFaceUp)return!1;const y=c.findIndex(g=>g.id===t.id);return!(p.position==="uncovered"&&!s||p.position==="covered"&&y>=c.length-1||p.owner==="own"&&i!==a.actor||p.owner==="opponent"&&i===a.actor||p.faceState==="face_up"&&!t.isFaceUp||p.faceState==="face_down"&&t.isFaceUp||p.excludeSelf&&t.id===a.sourceCardId)}default:return!1}},rw=({gameState:t,onLanePointerDown:o,onPlayFaceDown:a,onCardPointerDown:i,onCardPointerEnter:l,onCardPointerLeave:c,onOpponentHandCardPointerEnter:s,onOpponentHandCardPointerLeave:f,selectedCardId:p,sourceCardId:h})=>{const{player:y,opponent:g,animationState:v,phase:w,turn:C,compilableLanes:x,actionRequired:b,controlCardHolder:E}=t,S=L=>{const D=w==="compile"&&C==="player"&&!b&&x.includes(L),O=C==="player",H=w==="action"&&!b&&p,te=(b==null?void 0:b.type)==="select_lane_for_play";if(!O||!H&&!te)return{isPlayable:!1,isMatching:!1,isCompilable:D};let ne;if(H)ne=y.hand.find(Ce=>Ce.id===p);else if(te){if(b.source==="deck")return b.excludeCurrentLane&&L===b.currentLaneIndex?{isPlayable:!1,isMatching:!1,isCompilable:D}:{isPlayable:!0,isMatching:!1,isCompilable:D};ne=y.hand.find(Ce=>Ce.id===b.cardInHandId)}if(!ne)return{isPlayable:!1,isMatching:!1,isCompilable:D};if(te&&L===b.disallowedLaneIndex)return{isPlayable:!1,isMatching:!1,isCompilable:D};const z=g.lanes[L];if(z.length>0&&z[z.length-1].isFaceUp&&z[z.length-1].protocol==="Plague"&&z[z.length-1].value===0)return{isPlayable:!1,isMatching:!1,isCompilable:D};const B=g.lanes.flat().some(Ce=>Ce.isFaceUp&&Ce.protocol==="Psychic"&&Ce.value===1),W=y.lanes.flat().some(Ce=>Ce.isFaceUp&&Ce.protocol==="Spirit"&&Ce.value===1),_e=y.lanes.some(Ce=>{if(Ce.length===0)return!1;const ve=Ce[Ce.length-1];return ve.isFaceUp&&ve.protocol==="Chaos"&&ve.value===3}),U=[...y.lanes.flat(),...g.lanes.flat()].some(Ce=>Ce.isFaceUp&&Ce.protocol==="Anarchy"&&Ce.value===1),P=md(t),Z=vd(t,"player",L);let Q;return U||P?Q=ne.protocol!==y.protocols[L]&&ne.protocol!==g.protocols[L]&&!B:Q=(W||Z||_e||ne.protocol===y.protocols[L]||ne.protocol===g.protocols[L])&&!B,z.some(Ce=>Ce.isFaceUp&&Ce.protocol==="Metal"&&Ce.value===2)&&!Q?{isPlayable:!1,isMatching:!1,isCompilable:D}:te&&(b.isFaceDown||b.faceDown)?{isPlayable:!0,isMatching:!1,isCompilable:D}:{isPlayable:!0,isMatching:Q,isCompilable:D}},j=L=>{if(!b||b.actor!=="player")return!1;switch(b.type){case"select_lane_for_delete":case"select_lane_for_death_2":case"select_lane_for_water_3":case"select_lane_for_return":return!0;case"select_lane_for_metal_3_delete":return L===b.disallowedLaneIndex?!1:y.lanes[L].length+g.lanes[L].length>=8;default:return!1}},R=(L,D)=>{if(!b||b.actor!=="player")return!1;const O=b.type==="select_lane_for_shift"?b.originalLaneIndex:(b.type==="select_card_to_shift",-1);if(O!==-1&&!kc(t,O,L).allowed)return!1;switch(b.type){case"select_lane_for_shift":{if(D!==b.cardOwner||L===b.originalLaneIndex)return!1;const H=[...t.player.lanes.flat(),...t.opponent.lanes.flat()].find(ne=>ne.id===b.sourceCardId),te=b.destinationRestriction;if(te&&te.type==="to_or_from_this_lane"){let ne=te.laneIndex;if(te.laneIndex==="current"&&H)for(const z of["player","opponent"]){for(let F=0;F<t[z].lanes.length;F++)if(t[z].lanes[F].some(B=>B.id===b.sourceCardId)){ne=F;break}if(typeof ne=="number")break}if(typeof ne=="number"&&!(b.originalLaneIndex===ne)&&!(L===ne))return!1}else if(H&&H.protocol==="Gravity"&&H.value===1){let ne=-1;for(const z of["player","opponent"]){for(let F=0;F<t[z].lanes.length;F++)if(t[z].lanes[F].some(B=>B.id===b.sourceCardId)){ne=F;break}if(ne!==-1)break}if(ne!==-1&&!(b.originalLaneIndex===ne)&&!(L===ne))return!1}return!0}case"shift_flipped_card_optional":{const H=b.cardId;let te=null,ne=-1;for(let z=0;z<y.lanes.length;z++)if(y.lanes[z].some(F=>F.id===H)){te="player",ne=z;break}if(te===null){for(let z=0;z<g.lanes.length;z++)if(g.lanes[z].some(F=>F.id===H)){te="opponent",ne=z;break}}return D!==te?!1:L!==ne}case"select_lane_for_life_3_play":return D==="player"&&L!==b.disallowedLaneIndex;case"select_lane_to_shift_revealed_card_for_light_2":return D==="player";case"select_lane_to_shift_revealed_board_card_custom":{const H=b.revealedCardId;if(![...t.player.lanes.flat(),...t.opponent.lanes.flat()].find(F=>F.id===H))return!1;let ne=null,z=-1;for(const F of["player","opponent"]){for(let B=0;B<t[F].lanes.length;B++)if(t[F].lanes[B].some(W=>W.id===H)){ne=F,z=B;break}if(ne)break}return D===ne&&L!==z}case"select_lane_for_shift_all":{const H=b.sourceLaneIndex;return L!==H}case"select_lane_to_shift_cards_for_light_3":return L!==b.sourceLaneIndex;default:return!1}},A=(L,D,O)=>{let H=[L];return D&&H.push("compiled"),(v==null?void 0:v.type)==="compile"&&v.laneIndex===O&&H.push("is-compiling"),H.join(" ")},N=()=>E==="player"?"player-controlled":E==="opponent"?"opponent-controlled":"neutral",I=()=>E==="player"?"Player has control.":E==="opponent"?"Opponent has control.":"Control is neutral.",V=()=>E==="player"?"Control Player":E==="opponent"?"Control Opponent":"Control Neutral";return u.jsxs("div",{className:"game-board",children:[u.jsx("div",{className:"opponent-hand-area",children:g.hand.map(L=>u.jsx(nn,{card:L,isFaceUp:L.isRevealed||!1,additionalClassName:"in-hand",onPointerEnter:()=>s(L)},L.id))}),u.jsx("div",{className:`player-side opponent-side ${C==="opponent"?"active-turn":""}`,children:u.jsx("div",{className:"lanes",children:g.lanes.map((L,D)=>u.jsx(qh,{cards:L,isPlayable:!1,isCompilable:!1,isShiftTarget:R(D,"opponent"),isEffectTarget:j(D),onLanePointerDown:()=>o(D),onCardPointerDown:O=>i(O,"opponent",D),onCardPointerEnter:O=>l(O,"opponent"),onCardPointerLeave:()=>c(),owner:"opponent",animationState:v,isCardTargetable:O=>qc(O,t),laneIndex:D,sourceCardId:h,gameState:t},`opp-lane-${D}`))})}),u.jsxs("div",{className:"protocol-bars-container",children:[t.useControlMechanic&&u.jsxs("div",{className:"control-coin-container",children:[u.jsx("div",{className:`control-coin ${N()}`,title:I(),children:"C"}),u.jsx("div",{className:`control-coin-label ${N()}`,children:V()})]}),u.jsx("div",{className:`protocol-bar opponent-bar ${C==="opponent"?"active-turn":""}`,children:g.protocols.map((L,D)=>u.jsxs("div",{className:A("protocol-display",g.compiled[D],D),children:[u.jsx("span",{className:"protocol-name",children:L}),u.jsx("span",{className:"protocol-value",children:g.laneValues[D]})]},`opp-proto-${L}-${D}`))}),u.jsx("div",{className:`protocol-bar player-bar ${C==="player"?"active-turn":""}`,children:y.protocols.map((L,D)=>u.jsxs("div",{className:A("protocol-display",y.compiled[D],D),children:[u.jsx("span",{className:"protocol-name",children:L}),u.jsx("span",{className:"protocol-value",children:y.laneValues[D]})]},`player-proto-${L}-${D}`))})]}),u.jsx("div",{className:`player-side ${C==="player"?"active-turn":""}`,children:u.jsx("div",{className:"lanes",children:y.lanes.map((L,D)=>{const{isPlayable:O,isMatching:H,isCompilable:te}=S(D);return u.jsx(qh,{cards:L,isPlayable:O,isMatching:H,isCompilable:te,isShiftTarget:R(D,"player"),isEffectTarget:j(D),onLanePointerDown:()=>o(D),onPlayFaceDown:()=>a(D),onCardPointerDown:ne=>i(ne,"player",D),onCardPointerEnter:ne=>l(ne,"player"),onCardPointerLeave:()=>c(),owner:"player",animationState:v,isCardTargetable:ne=>qc(ne,t),laneIndex:D,sourceCardId:h,gameState:t},`player-lane-${D}`)})})})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const lw=({gameState:t,onFillHand:o,onSkipAction:a,onResolvePlague2Discard:i,onResolvePlague4Flip:l,onResolveFire3Prompt:c,onResolveOptionalDiscardCustomPrompt:s,onResolveOptionalEffectPrompt:f,onResolveSpeed3Prompt:p,onResolveFire4Discard:h,onResolveHate1Discard:y,onResolveLight2Prompt:g,onResolveRevealBoardCardPrompt:v,onResolveOptionalDrawPrompt:w,onResolveDeath1Prompt:C,onResolveLove1Prompt:x,onResolvePsychic4Prompt:b,onResolveSpirit1Prompt:E,onResolveSpirit3Prompt:S,onResolveControlMechanicPrompt:j,onResolveCustomChoice:R,selectedCardId:A,multiSelectedCardIds:N,actionRequiredClass:I})=>{const{phase:V,turn:L,actionRequired:D,player:O,compilableLanes:H}=t,te=_e=>{for(const U of["player","opponent"])for(const P of t[U].lanes){const Z=P.find(Q=>Q.id===_e);if(Z)return Z}return null},ne=D==null?void 0:D.sourceCardId,z=ne?te(ne):null,F=L.charAt(0).toUpperCase()+L.slice(1),B=()=>{var _e,U,P,Z;if(L!=="player"&&(!D||D.actor!=="player"))return u.jsx("button",{className:"btn",disabled:!0,children:"Processing..."});if((D==null?void 0:D.type)==="prompt_use_control_mechanic")return u.jsxs(u.Fragment,{children:[u.jsx("button",{className:"btn",onClick:()=>j("player"),children:"Rearrange Own"}),u.jsx("button",{className:"btn",onClick:()=>j("opponent"),children:"Rearrange Opponent's"}),u.jsx("button",{className:"btn btn-back",onClick:()=>j("skip"),children:"Skip"})]});if((D==null?void 0:D.type)==="prompt_optional_draw")return u.jsxs(u.Fragment,{children:[u.jsx("button",{className:"btn",onClick:()=>w(!0),children:"Draw"}),u.jsx("button",{className:"btn btn-back",onClick:()=>w(!1),children:"Skip"})]});if((D==null?void 0:D.type)==="prompt_death_1_effect")return u.jsxs(u.Fragment,{children:[u.jsx("button",{className:"btn",onClick:()=>C(!0),children:"Draw & Delete"}),u.jsx("button",{className:"btn btn-back",onClick:()=>C(!1),children:"Skip"})]});if((D==null?void 0:D.type)==="prompt_give_card_for_love_1")return u.jsxs(u.Fragment,{children:[u.jsx("button",{className:"btn",onClick:()=>x(!0),children:"Give 1 Card"}),u.jsx("button",{className:"btn btn-back",onClick:()=>x(!1),children:"Skip"})]});if((D==null?void 0:D.type)==="prompt_fire_3_discard")return u.jsxs(u.Fragment,{children:[u.jsx("button",{className:"btn",onClick:()=>c(!0),children:"Discard 1 Card"}),u.jsx("button",{className:"btn btn-back",onClick:()=>c(!1),children:"Skip"})]});if((D==null?void 0:D.type)==="prompt_optional_discard_custom")return u.jsxs(u.Fragment,{children:[u.jsxs("button",{className:"btn",onClick:()=>s(!0),children:["Discard ",D.count," Card(s)"]}),u.jsx("button",{className:"btn btn-back",onClick:()=>s(!1),children:"Skip"})]});if((D==null?void 0:D.type)==="prompt_optional_effect"){const Q=((U=(_e=D.effectDef)==null?void 0:_e.params)==null?void 0:U.action)||"effect",pe=(Z=(P=D.effectDef)==null?void 0:P.params)==null?void 0:Z.count,Ce=pe?`${Q} ${pe}`:Q;return u.jsxs(u.Fragment,{children:[u.jsxs("button",{className:"btn",onClick:()=>f(!0),children:["Execute (",Ce,")"]}),u.jsx("button",{className:"btn btn-back",onClick:()=>f(!1),children:"Skip"})]})}if((D==null?void 0:D.type)==="prompt_shift_for_speed_3")return u.jsxs(u.Fragment,{children:[u.jsx("button",{className:"btn",onClick:()=>p(!0),children:"Shift"}),u.jsx("button",{className:"btn btn-back",onClick:()=>p(!1),children:"Skip"})]});if((D==null?void 0:D.type)==="prompt_spirit_1_start")return u.jsxs(u.Fragment,{children:[u.jsx("button",{className:"btn",onClick:()=>E("discard"),children:"Discard 1"}),u.jsx("button",{className:"btn btn-back",onClick:()=>E("flip"),children:"Flip Card"})]});if((D==null?void 0:D.type)==="prompt_shift_for_spirit_3")return u.jsxs(u.Fragment,{children:[u.jsx("button",{className:"btn",onClick:()=>S(!0),children:"Shift"}),u.jsx("button",{className:"btn btn-back",onClick:()=>S(!1),children:"Skip"})]});if((D==null?void 0:D.type)==="custom_choice"){const Q=D.options||[];if(Q.length===2){const pe=Q[0].params,Ce=Q[1].params,ve=ke=>ke.action==="discard"?`Discard ${ke.count||1}`:ke.action==="flip"&&ke.flipSelf?"Flip This Card":ke.action==="draw"?`Draw ${ke.count||1}`:"Option";return u.jsxs(u.Fragment,{children:[u.jsx("button",{className:"btn",onClick:()=>R(0),children:ve(pe)}),u.jsx("button",{className:"btn btn-back",onClick:()=>R(1),children:ve(Ce)})]})}}if((D==null?void 0:D.type)==="prompt_return_for_psychic_4")return u.jsxs(u.Fragment,{children:[u.jsx("button",{className:"btn",onClick:()=>b(!0),children:"Return Card"}),u.jsx("button",{className:"btn btn-back",onClick:()=>b(!1),children:"Skip"})]});if((D==null?void 0:D.type)==="prompt_shift_or_flip_for_light_2")return u.jsxs(u.Fragment,{children:[u.jsx("button",{className:"btn",onClick:()=>g("shift"),children:"Shift"}),u.jsx("button",{className:"btn",onClick:()=>g("flip"),children:"Flip Back"}),u.jsx("button",{className:"btn btn-back",onClick:()=>g("skip"),children:"Skip"})]});if((D==null?void 0:D.type)==="prompt_shift_or_flip_board_card_custom")return u.jsxs(u.Fragment,{children:[u.jsx("button",{className:"btn",onClick:()=>v("shift"),children:"Shift"}),u.jsx("button",{className:"btn",onClick:()=>v("flip"),children:"Flip"}),u.jsx("button",{className:"btn btn-back",onClick:()=>v("skip"),children:"Skip"})]});if((D==null?void 0:D.type)==="discard"&&D.variableCount&&D.actor==="player")return u.jsxs("button",{className:"btn",onClick:()=>h(N),disabled:N.length<1,children:["Confirm Discard (",N.length,")"]});if((D==null?void 0:D.type)==="plague_2_player_discard"||(D==null?void 0:D.type)==="select_cards_from_hand_to_discard_for_fire_4"||(D==null?void 0:D.type)==="select_cards_from_hand_to_discard_for_hate_1"){let Q,pe=0;return D.type==="plague_2_player_discard"?(Q=i,pe=1):D.type==="select_cards_from_hand_to_discard_for_fire_4"?(Q=h,pe=1):(Q=y,pe=D.count),u.jsxs("button",{className:"btn",onClick:()=>Q(N),disabled:N.length<pe,children:["Confirm Discard (",N.length,")"]})}if((D==null?void 0:D.type)==="plague_4_player_flip_optional")return u.jsxs(u.Fragment,{children:[u.jsx("button",{className:"btn",onClick:()=>l(!0),children:"Flip Plague-4"}),u.jsx("button",{className:"btn btn-back",onClick:()=>l(!1),children:"Skip"})]});if(D&&"optional"in D&&D.optional)return u.jsx("button",{className:"btn btn-back",onClick:a,children:"Skip Action"});if(D)return u.jsx("button",{className:"btn",disabled:!0,children:"Action Required"});if(V==="compile"&&H.length>0)return u.jsx("button",{className:"btn",disabled:!0,children:"Select Lane to Compile"});if(V==="action"){const Q=O.hand.length<5;return O.hand.length===0?u.jsx("button",{className:"btn",onClick:o,children:"Refresh (Required)"}):u.jsx("button",{className:"btn",onClick:o,disabled:!Q||!!A,children:"Refresh"})}return u.jsx("button",{className:"btn",disabled:!0,children:"Processing..."})},W=()=>{var _e,U,P,Z;if(D)switch(D.type){case"discard":return D.actor==="player"?D.variableCount?"Action: Select 1 or more cards to discard":`Action: Discard ${D.count} card(s) from your hand`:"Waiting for Opponent to discard...";case"prompt_use_control_mechanic":return"Control Action: Rearrange protocols?";case"select_opponent_face_up_card_to_flip":return"Action: Select an opponent's face-up card to flip";case"select_own_face_up_covered_card_to_flip":return"Action: Select one of your face-up, covered cards to flip";case"select_opponent_covered_card_to_shift":return"Action: Select one of your opponent's covered cards to shift";case"select_own_covered_card_to_shift":return"Action: Select one of your covered cards to shift";case"select_lane_for_shift":return"Action: Select a new lane for the card";case"select_lane_for_shift_all":return"Action: Select a lane to shift all cards to";case"select_opponent_card_to_flip":return"Action: Select an opponent's card to flip";case"shift_flipped_card_optional":return"Action: You may shift the card you just flipped. Select a lane or skip.";case"select_covered_card_in_line_to_flip_optional":return"Action: You may flip one of your covered cards in this lane. Select a card or skip.";case"select_card_from_hand_to_play":return"Action: Select a card from your hand to play";case"select_lane_for_play":return"Action: Select another lane to play your card in";case"select_face_down_card_to_shift_for_darkness_4":return"Action: Select any face-down card to shift";case"select_cards_to_delete":return`Action: Select a card to delete (${D.count} remaining)`;case"select_face_down_card_to_delete":return"Action: Select a face-down card to delete";case"select_low_value_card_to_delete":return"Action: Select a card with value 0 or 1 to delete";case"select_card_from_other_lanes_to_delete":return`Action: Select a card to delete (${D.count} remaining)`;case"select_lane_for_death_2":return"Action: Select a lane to delete cards with value 1 or 2";case"select_lane_for_delete":return"Action: Select a lane";case"prompt_optional_draw":return"Optional: Draw card(s)?";case"prompt_death_1_effect":return"Start Phase: Use Death-1 effect?";case"select_card_to_delete_for_death_1":return"Action: Select a card to delete";case"delete_self":return"Deleting card...";case"prompt_give_card_for_love_1":return"End Phase: Give 1 card to draw 2?";case"select_card_from_hand_to_give":return"Action: Select a card from your hand to give";case"select_card_from_hand_to_reveal":return"Action: Select a card from your hand to reveal";case"plague_2_player_discard":return"Action: Select 1 or more cards to discard";case"plague_4_opponent_delete":return"Waiting for opponent to delete one of their face-down cards";case"plague_4_player_flip_optional":return"Action: You may flip Plague-4";case"select_any_other_card_to_flip":return"Action: Select any other card to flip";case"select_card_to_return":return"Action: Select a card to return to its owner's hand";case"select_covered_card_to_flip_for_chaos_0":return"Action: Select a covered card to flip in this lane";case"prompt_fire_3_discard":return"End Phase: Discard 1 card to flip 1 card?";case"prompt_optional_discard_custom":return`Optional: Discard ${D.count} card(s) to continue?`;case"prompt_optional_effect":{const Q=((U=(_e=D.effectDef)==null?void 0:_e.params)==null?void 0:U.action)||"effect",pe=(Z=(P=D.effectDef)==null?void 0:P.params)==null?void 0:Z.count;return`Optional: Execute ${Q}${pe?` ${pe}`:""}?`}case"select_card_to_flip_for_fire_3":return"Action: Select a card to flip";case"prompt_shift_for_speed_3":return"End Phase: Shift 1 card?";case"select_own_card_to_shift_for_speed_3":case"select_own_other_card_to_shift":return"Action: Select one of your cards to shift";case"select_opponent_face_down_card_to_shift":return"Action: Select an opponent's face-down card to shift";case"prompt_spirit_1_start":return"Start Phase: Discard 1 card or flip Spirit-1?";case"select_any_card_to_flip_optional":return"Action: You may flip one card. Select a card or skip.";case"prompt_shift_for_spirit_3":return"Triggered: You may shift your Spirit-3. Select a lane or skip.";case"prompt_swap_protocols":return"Action: Swap two protocols.";case"select_cards_from_hand_to_discard_for_fire_4":return"Action: Select 1 or more cards to discard";case"select_cards_from_hand_to_discard_for_hate_1":return`Action: Select ${D.count} card(s) to discard for Hate-1`;case"select_any_card_to_flip":return`Action: Select a card to flip (${D.count} remaining)`;case"select_any_face_down_card_to_flip_optional":return"Action: You may flip a face-down card. Select a card or skip.";case"select_lane_for_life_3_play":return"Action: Select another lane to play a card into";case"select_card_to_flip_for_light_0":return"Action: Select any card to flip";case"select_face_down_card_to_reveal_for_light_2":return"Action: Select a face-down card to reveal";case"prompt_shift_or_flip_for_light_2":return"Action: Choose to shift, flip back, or skip";case"prompt_shift_or_flip_board_card_custom":return"Action: Choose to shift, flip, or skip";case"select_board_card_to_reveal_custom":return"Action: Select a face-down card to reveal";case"select_lane_to_shift_revealed_card_for_light_2":return"Action: Select a lane to shift the revealed card to";case"select_lane_to_shift_revealed_board_card_custom":return"Action: Select a lane to shift the revealed card to";case"select_lane_to_shift_cards_for_light_3":return"Action: Select a lane to shift all face-down cards to";case"select_lane_for_metal_3_delete":return"Action: Select a lane with 8+ cards to delete";case"select_any_other_card_to_flip_for_water_0":return"Action: Select any other card to flip";case"prompt_rearrange_protocols":return"Action: Rearrange protocols";case"select_lane_for_water_3":return"Action: Select a lane to return cards from";case"select_own_card_to_return_for_water_4":return"Action: Select one of your cards to return to your hand";case"prompt_return_for_psychic_4":return"End Phase: Return an opponent's card?";case"select_any_opponent_card_to_shift":return"Action: Select an opponent's card to shift";case"select_opponent_card_to_return":return"Action: Select an opponent's card to return";case"select_own_highest_card_to_delete_for_hate_2":return"Action: Select your highest value uncovered card to delete";case"select_opponent_highest_card_to_delete_for_hate_2":return"Action: Select opponent's highest value uncovered card to delete";case"custom_choice":{const Q=D.options||[];if(Q.length===2){const pe=Q[0].params,Ce=Q[1].params,ve=ke=>ke.action==="discard"?`you discard ${ke.count||1} card${ke.count!==1?"s":""}`:ke.action==="flip"&&ke.flipSelf?"flip this card":ke.action==="draw"?`draw ${ke.count||1} card${ke.count!==1?"s":""}`:"option";return`Either ${ve(pe)} or ${ve(Ce)}.`}return"Action: Make a choice"}default:return"Action Required"}return V==="compile"&&H.length>0?"Phase: Compile":`Phase: ${V.replace("_"," ")}`};return u.jsxs("div",{className:`phase-controller ${I}`,children:[u.jsxs("div",{className:"effect-source-info",children:[u.jsxs("span",{children:[F,"'s Turn"]}),D&&z&&u.jsxs(u.Fragment,{children:[" | Effect from: ",u.jsxs("span",{children:[z.protocol,"-",z.value]})]}),(D==null?void 0:D.sourceCardId)==="CONTROL_MECHANIC"&&u.jsxs(u.Fragment,{children:[" | Effect from: ",u.jsx("span",{children:"Control Component"})]})]}),u.jsxs("div",{className:"phase-controller-main",children:[u.jsx("div",{className:"phase-info",children:W()}),u.jsx("div",{className:"phase-actions",children:B()})]})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const cw=({gameState:t,turn:o,animationState:a,difficulty:i,onPlayerClick:l,onOpponentClick:c})=>{const{player:s,opponent:f}=t,p=y=>{const g=["info-section"];return g.push(y==="player"?"player-info":"opponent-info"),o===y&&g.push("active-turn"),(a==null?void 0:a.type)==="drawCard"&&a.owner===y&&g.push("is-drawing"),(a==null?void 0:a.type)==="discardCard"&&a.owner===y&&g.push("is-discarding"),g.join(" ")},h=y=>{const g=y==="player"?s:f,v=y==="player"?l:c,w=y==="player"?"Player":`Opponent${i?` (${i.charAt(0).toUpperCase()+i.slice(1)})`:""}`;return u.jsx("div",{className:p(y),onClick:v,children:u.jsxs("div",{className:"info-section-body",children:[u.jsx("h3",{children:w}),u.jsxs("div",{className:"info-line",children:[u.jsx("span",{children:"Hand:"}),u.jsx("span",{children:g.hand.length})]}),u.jsxs("div",{className:"info-line",children:[u.jsx("span",{children:"Deck:"}),u.jsx("span",{children:g.deck.length})]}),u.jsxs("div",{className:"info-line",children:[u.jsx("span",{children:"Trash:"}),u.jsx("span",{children:g.discard.length})]})]})})};return u.jsxs("div",{className:"game-info-panel",children:[h("opponent"),h("player")]})},sw=/\b([A-Z][a-z]+(?:_custom)?)-(\d)\b/g;function bc(t,o){return{...t,id:`preview-${t.protocol}-${t.value}`,isFaceUp:o}}function Jh(t){const o=t.match(/^([A-Z][a-z]+(?:_custom)?)-(\d)$/);return o?{protocol:o[1],value:parseInt(o[2],10)}:null}function e_(t){const o=[];let a;const i=new RegExp(sw);for(;(a=i.exec(t))!==null;)o.push({protocol:a[1],value:parseInt(a[2],10)});return o}function Nh(t,o){if(t.sourceCardRef||t.targetCardRefs&&t.targetCardRefs.length>0)return!0;if(t.sourceCard){const i=Jh(t.sourceCard);if(i&&o.some(l=>l.protocol===i.protocol&&l.value===i.value))return!0}const a=e_(t.message);return!!(a.length>0&&a.some(i=>o.some(l=>l.protocol===i.protocol&&l.value===i.value)))}function iw(t,o){const a={source:null,targets:[]};if(t.sourceCardRef){const i=o.find(l=>l.protocol===t.sourceCardRef.protocol&&l.value===t.sourceCardRef.value);i&&(a.source=bc(i,t.sourceCardRef.isFaceUp))}if(t.targetCardRefs&&t.targetCardRefs.length>0)for(const i of t.targetCardRefs){const l=o.find(c=>c.protocol===i.protocol&&c.value===i.value);l&&a.targets.push(bc(l,i.isFaceUp))}if(!a.source&&a.targets.length===0){if(t.sourceCard){const l=Jh(t.sourceCard);if(l){const c=o.find(s=>s.protocol===l.protocol&&s.value===l.value);c&&(a.source=bc(c,!0))}}const i=e_(t.message);for(const l of i){const c=o.find(s=>s.protocol===l.protocol&&s.value===l.value);if(c){const s=bc(c,!0);a.source?(a.source.protocol!==l.protocol||a.source.value!==l.value)&&a.targets.push(s):a.source=s}}}return a}function dw({log:t,onClose:o}){const[a,i]=J.useState(null),[l,c]=J.useState(0),s=J.useMemo(()=>{const y=er();return[...wt,...y]},[]),f=y=>{let g="";if(y.phase){const v=y.phase.charAt(0).toUpperCase()+y.phase.slice(1);g+=`[${v}] `}return y.sourceCard&&!y.message.startsWith(y.sourceCard)&&(g+=`${y.sourceCard}: `),`${g}${y.message}`},p=J.useMemo(()=>{if(a===null)return null;const y=t[a];return y?iw(y,s):null},[a,t,s]),h=(y,g)=>{Nh(g,s)&&(a===y?p&&p.targets.length>1?c(v=>(v+1)%p.targets.length):(i(null),c(0)):(i(y),c(0)))};return u.jsx("div",{className:"modal-overlay",onClick:o,children:u.jsxs("div",{className:"modal-content log-modal-content log-modal-with-preview",onClick:y=>y.stopPropagation(),children:[u.jsx("button",{className:"btn btn-back modal-close-btn",onClick:o,children:"X"}),u.jsx("h2",{children:"Game Log"}),u.jsxs("div",{className:"log-content-wrapper",children:[u.jsx("div",{className:"log-preview-area log-preview-left",children:(p==null?void 0:p.source)&&u.jsx("div",{className:"log-preview-card",children:u.jsx(nn,{card:p.source,isFaceUp:p.source.isFaceUp})})}),u.jsx("ol",{className:"log-list",children:t.map((y,g)=>{const v=y.indentLevel!==void 0,w=v?{paddingLeft:`${y.indentLevel*20+40}px`}:{};v&&y.indentLevel===0&&(w.fontWeight="bold");const C=Nh(y,s),x=a===g;return u.jsx("li",{className:`log-entry log-entry-${y.player}${C?" log-entry-clickable":""}${x?" log-entry-selected":""}`,style:w,onClick:()=>h(g,y),children:f(y)},g)})}),u.jsx("div",{className:"log-preview-area log-preview-right",children:(p==null?void 0:p.targets)&&p.targets.length>0&&u.jsxs("div",{className:"log-preview-card",children:[u.jsx(nn,{card:p.targets[l],isFaceUp:p.targets[l].isFaceUp}),p.targets.length>1&&u.jsxs("div",{className:"log-preview-counter",children:[l+1," / ",p.targets.length]})]})})]})]})})}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const uw=({message:t,player:o})=>u.jsx("div",{className:`toaster toaster-${o}`,children:t});function pw({gameState:t,targetPlayer:o,onConfirm:a}){var z;const[i]=J.useState([...t[o].protocols]),[l,c]=J.useState([...t[o].protocols]),s=J.useRef(null),f=J.useRef(null),p=J.useRef(0),h=J.useRef(null),y=J.useRef(0),g=((z=t.actionRequired)==null?void 0:z.type)==="prompt_rearrange_protocols"?t.actionRequired.disallowedProtocolForLane:void 0,v=J.useMemo(()=>{if(l.length!==i.length)return!1;for(let F=0;F<l.length;F++)if(l[F]!==i[F])return!0;return!1},[l,i]),w=J.useMemo(()=>{if(!g)return!1;const{laneIndex:F,protocol:B}=g;return l[F]===B},[l,g]),C=t[o],b=t[o==="player"?"opponent":"player"],E=C.laneValues,S=C.compiled,j=(F,B)=>{let W=[F];return B&&W.push("compiled"),W.join(" ")},R=(F,B)=>{s.current=B,F.dataTransfer.effectAllowed="move"},A=(F,B)=>{F.preventDefault(),f.current=B},N=()=>{if(s.current!==null&&f.current!==null&&s.current!==f.current){const F=[...l],B=F[s.current];F[s.current]=F[f.current],F[f.current]=B,s.current=null,f.current=null,c(F)}},I=F=>{F.preventDefault()},V=(F,B)=>{h.current=B,p.current=F.touches[0].clientY,y.current=F.touches[0].clientY},L=F=>{var _e;if(h.current===null)return;y.current=F.touches[0].clientY;const B=F.touches[0],W=document.elementFromPoint(B.clientX,B.clientY);if(W){const U=W.closest(".rearrange-item");if(U){const Z=Array.from(((_e=U.parentElement)==null?void 0:_e.children)||[]).indexOf(U);Z!==-1&&Z!==h.current&&(f.current=Z)}}},D=()=>{if(h.current!==null&&f.current!==null&&h.current!==f.current){const F=[...l],B=F[h.current];F[h.current]=F[f.current],F[f.current]=B,c(F)}h.current=null,f.current=null,p.current=0,y.current=0},O=o==="player",H=O?"Rearrange Your Protocols":"Rearrange Opponent's Protocols",te=u.jsx("div",{className:`protocol-bar ${O?"player-bar":"opponent-bar"} rearrange-editable`,onDragOver:I,children:l.map((F,B)=>{const W=F!==i[B],_e=g&&g.laneIndex===B&&F===g.protocol,U=j("protocol-display rearrange-item",S[B]);return u.jsxs("div",{className:`${U} ${W?"changed":""} ${_e?"violation":""}`,draggable:!0,onDragStart:P=>R(P,B),onDragEnter:P=>A(P,B),onDragEnd:N,onTouchStart:P=>V(P,B),onTouchMove:L,onTouchEnd:D,children:[u.jsx("span",{className:"protocol-name",children:F}),u.jsx("span",{className:"protocol-value",children:E[B]})]},`${F}-${B}`)})}),ne=u.jsx("div",{className:`protocol-bar ${O?"opponent-bar":"player-bar"}`,children:b.protocols.map((F,B)=>u.jsxs("div",{className:j("protocol-display",b.compiled[B]),children:[u.jsx("span",{className:"protocol-name",children:F}),u.jsx("span",{className:"protocol-value",children:b.laneValues[B]})]},`other-proto-${F}-${B}`))});return u.jsx("div",{className:"modal-overlay",children:u.jsxs("div",{className:"modal-content rearrange-modal-content",onClick:F=>F.stopPropagation(),children:[u.jsx("h2",{children:H}),u.jsx("p",{children:"Drag and drop the protocols to reorder them. You must change the order to continue."}),g&&u.jsxs("p",{className:"warning-text",children:[" ",u.jsx("strong",{children:g.protocol})," cannot be placed on line ",u.jsx("strong",{children:g.laneIndex})," due to Anarchy-3's restriction."]}),u.jsx("div",{className:"rearrange-board-view",children:u.jsxs("div",{className:"protocol-bars-container",children:[O?ne:te,O?te:ne]})}),u.jsxs("div",{className:"rearrange-actions",children:[u.jsx("button",{className:"btn",onClick:()=>a(l),disabled:!v||w,children:"Confirm Rearrangement"}),w&&u.jsxs("p",{className:"error-text",children:["Cannot confirm: ",g.protocol," is on line ",g.laneIndex]})]})]})})}function fw({gameState:t,targetPlayer:o,onConfirm:a}){const[i,l]=J.useState([]),c=t[o],s=o==="player",f=s?"Swap Your Protocols":"Swap Opponent's Protocols",p=g=>{i.includes(g)?l(v=>v.filter(w=>w!==g)):i.length<2&&l(v=>[...v,g])},h=()=>{i.length===2&&a(i)},y=g=>{let v=["protocol-display","rearrange-item"];return c.compiled[g]&&v.push("compiled"),i.includes(g)&&v.push("selected"),v.join(" ")};return u.jsx("div",{className:"modal-overlay",children:u.jsxs("div",{className:"modal-content rearrange-modal-content",onClick:g=>g.stopPropagation(),children:[u.jsx("h2",{children:f}),u.jsx("p",{children:"Select two protocols to swap their positions. This action is mandatory."}),u.jsx("div",{className:"rearrange-board-view",children:u.jsx("div",{className:"protocol-bars-container",children:u.jsx("div",{className:`protocol-bar ${s?"player-bar":"opponent-bar"}`,children:c.protocols.map((g,v)=>u.jsxs("div",{className:y(v),onClick:()=>p(v),children:[u.jsx("span",{className:"protocol-name",children:g}),u.jsx("span",{className:"protocol-value",children:c.laneValues[v]})]},g))})})}),u.jsx("div",{className:"rearrange-actions",children:u.jsx("button",{className:"btn",onClick:h,disabled:i.length!==2,children:"Confirm Swap"})})]})})}function hw({player:t,playerState:o,onClose:a}){const i=t.charAt(0).toUpperCase()+t.slice(1),[l,c]=J.useState(null),s=p=>{c(p)},f=(p,h,y)=>{const g=p.map((v,w)=>({...v,id:`${h}-${v.protocol}-${v.value}-${w}`,isFaceUp:y}));return u.jsxs(u.Fragment,{children:[u.jsxs("h3",{children:[h," (",g.length,")"]}),u.jsx("div",{className:"debug-card-grid",children:g.length>0?g.map(v=>u.jsx("div",{onClick:w=>{w.stopPropagation(),c(v)},onMouseEnter:()=>s(v),onMouseLeave:()=>s(null),style:{cursor:"pointer"},children:u.jsx(nn,{card:v,isFaceUp:y,additionalClassName:"in-hand"})},v.id)):u.jsxs("p",{className:"no-cards",children:["No cards in ",h.toLowerCase(),"."]})})]})};return u.jsx("div",{className:"modal-overlay",onClick:a,children:u.jsxs("div",{className:"modal-content debug-modal-content debug-modal-with-preview",onClick:p=>p.stopPropagation(),children:[u.jsx("button",{className:"btn btn-back modal-close-btn",onClick:a,children:"X"}),u.jsxs("h2",{children:[i,"'s Info"]}),u.jsxs("div",{className:"debug-content-wrapper",children:[u.jsx("div",{className:"debug-preview-area",children:l&&u.jsx("div",{className:"debug-preview-card",children:u.jsx(nn,{card:l,isFaceUp:l.isFaceUp})})}),u.jsxs("div",{className:"debug-grids-area",children:[f(o.deck,"Deck",!1),f(o.discard,"Discard Pile",!0)]})]})]})})}function _w({onComplete:t}){const[o,a]=J.useState("choose"),[i,l]=J.useState(null),[c,s]=J.useState(null),[f,p]=J.useState(!1),h=g=>{l(g),a("flipping"),p(!0);const v=Math.random()<.5?"heads":"tails";setTimeout(()=>{s(v),p(!1),a("result")},2e3)},y=()=>{if(c===null||i===null)return;const g=c===i;t(g?"player":"opponent",i,g)};return u.jsx("div",{className:"coin-flip-modal-overlay",children:u.jsxs("div",{className:"modal-content coin-flip-modal-content",onClick:g=>g.stopPropagation(),children:[o==="choose"&&u.jsxs(u.Fragment,{children:[u.jsx("h2",{children:"Coin Flip"}),u.jsx("p",{children:"Choose heads or tails to determine who starts the game."}),u.jsxs("div",{className:"coin-flip-choices",children:[u.jsxs("button",{className:"btn coin-flip-choice-btn",onClick:()=>h("heads"),children:[u.jsx("div",{className:"coin-choice-icon",children:"H"}),u.jsx("div",{className:"coin-choice-label",children:"Heads"})]}),u.jsxs("button",{className:"btn coin-flip-choice-btn",onClick:()=>h("tails"),children:[u.jsx("div",{className:"coin-choice-icon",children:"T"}),u.jsx("div",{className:"coin-choice-label",children:"Tails"})]})]})]}),o==="flipping"&&u.jsxs(u.Fragment,{children:[u.jsx("h2",{children:"Flipping..."}),u.jsxs("p",{children:["You chose: ",u.jsx("span",{className:"coin-flip-highlight",children:i==="heads"?"Heads":"Tails"})]}),u.jsx("div",{className:"coin-flip-animation-container",children:u.jsxs("div",{className:`coin-3d ${f?"is-flipping":""}`,children:[u.jsx("div",{className:"coin-face coin-heads",children:"H"}),u.jsx("div",{className:"coin-face coin-tails",children:"T"})]})})]}),o==="result"&&c&&i&&u.jsxs(u.Fragment,{children:[u.jsx("h2",{children:"Result"}),u.jsxs("p",{children:["You chose: ",u.jsx("span",{className:"coin-flip-highlight",children:i==="heads"?"Heads":"Tails"})]}),u.jsx("div",{className:"coin-flip-animation-container",children:u.jsxs("div",{className:`coin-3d result-${c}`,children:[u.jsx("div",{className:"coin-face coin-heads",children:"H"}),u.jsx("div",{className:"coin-face coin-tails",children:"T"})]})}),u.jsxs("p",{className:"coin-flip-result-text",children:["The coin landed on: ",u.jsx("span",{className:"coin-flip-highlight",children:c==="heads"?"Heads":"Tails"})]}),c===i?u.jsx("p",{className:"coin-flip-winner-text",children:"You won! You will start the game."}):u.jsx("p",{className:"coin-flip-loser-text",children:"Opponent won! Opponent will start the game."}),u.jsx("button",{className:"btn",onClick:y,children:"Continue"})]})]})})}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const t_="compile_game_statistics",n_=1;function Uh(){const t=Oh,o={};return t.forEach(a=>{o[a]={timesUsed:0,wins:0,losses:0}}),{version:n_,global:{totalGamesPlayed:0,totalGamesWon:0,totalGamesLost:0,totalPlaytime:0,fastestWin:null,longestGame:null,lastGameDuration:null,currentStreak:0,longestWinStreak:0,longestLoseStreak:0},protocols:o,aiDifficulty:{easy:{played:0,wins:0,losses:0},normal:{played:0,wins:0,losses:0},hard:{played:0,wins:0,losses:0}},cards:{played:{},deleted:{}},actions:{totalCardsDrawn:0,totalCardsPlayed:0,totalShifts:0,totalDeletes:0,totalDiscards:0,totalFlips:0,totalCompiles:0,totalRefreshes:0},control:{gamesWithControl:0,gamesWithoutControl:0,playerRearranges:0,aiRearranges:0,totalRearranges:0},coinFlip:{headsChosen:0,tailsChosen:0,headsWon:0,tailsWon:0}}}function o_(){var t,o,a,i,l,c,s,f,p,h;try{const y=localStorage.getItem(t_);if(!y)return Uh();const g=JSON.parse(y),v=Oh,w={...g.protocols||{}};v.forEach(b=>{w[b]||(w[b]={timesUsed:0,wins:0,losses:0})});const C={...g,version:n_,global:{...g.global,lastGameDuration:((t=g.global)==null?void 0:t.lastGameDuration)||null},protocols:w,control:{gamesWithControl:((o=g.control)==null?void 0:o.gamesWithControl)||0,gamesWithoutControl:((a=g.control)==null?void 0:a.gamesWithoutControl)||0,playerRearranges:((i=g.control)==null?void 0:i.playerRearranges)||0,aiRearranges:((l=g.control)==null?void 0:l.aiRearranges)||0,totalRearranges:((c=g.control)==null?void 0:c.totalRearranges)||0},coinFlip:g.coinFlip||{headsChosen:0,tailsChosen:0,headsWon:0,tailsWon:0},actions:{...g.actions,totalCompiles:((s=g.actions)==null?void 0:s.totalCompiles)||0,totalRefreshes:((f=g.actions)==null?void 0:f.totalRefreshes)||0}};return(!((p=g.control)!=null&&p.playerRearranges)||!g.coinFlip||!((h=g.actions)!=null&&h.totalCompiles)||Object.keys(w).length!==Object.keys(g.protocols||{}).length)&&Qa(C),C}catch(y){return console.error("Failed to load statistics:",y),Uh()}}function Qa(t){try{localStorage.setItem(t_,JSON.stringify(t))}catch(o){console.error("Failed to save statistics:",o)}}function yw(t,o,a,i,l,c=!1,s,f){const p=o==="player",h={...t.global},y={...t.protocols},g={easy:{...t.aiDifficulty.easy},normal:{...t.aiDifficulty.normal},hard:{...t.aiDifficulty.hard}},v={...t.control},w={...t.actions},C={...t.coinFlip},x={played:{...t.cards.played},deleted:{...t.cards.deleted}};return h.totalGamesPlayed++,p?h.totalGamesWon++:h.totalGamesLost++,h.totalPlaytime+=l,p&&(h.fastestWin===null||l<h.fastestWin)&&(h.fastestWin=l),(h.longestGame===null||l>h.longestGame)&&(h.longestGame=l),h.lastGameDuration=l,p?(h.currentStreak>=0?h.currentStreak++:h.currentStreak=1,h.currentStreak>h.longestWinStreak&&(h.longestWinStreak=h.currentStreak)):(h.currentStreak<=0?h.currentStreak--:h.currentStreak=-1,Math.abs(h.currentStreak)>h.longestLoseStreak&&(h.longestLoseStreak=Math.abs(h.currentStreak))),a.forEach(b=>{y[b]?y[b]={...y[b]}:y[b]={timesUsed:0,wins:0,losses:0},y[b].timesUsed++,p?y[b].wins++:y[b].losses++}),g[i].played++,p?g[i].wins++:g[i].losses++,c?v.gamesWithControl++:v.gamesWithoutControl++,s&&(w.totalCardsPlayed+=s.cardsPlayed,w.totalCardsDrawn+=s.cardsDrawn,w.totalDiscards+=s.cardsDiscarded,w.totalDeletes+=s.cardsDeleted,w.totalFlips+=s.cardsFlipped,w.totalShifts+=s.cardsShifted,w.totalRefreshes+=s.handsRefreshed),f!==void 0&&(w.totalCompiles+=f),{version:t.version,global:h,protocols:y,aiDifficulty:g,cards:x,actions:w,control:v,coinFlip:C}}function gw(t,o){const a={...t,cards:{...t.cards,played:{...t.cards.played}}};return a.cards.played[o]||(a.cards.played[o]=0),a.cards.played[o]++,a}function mw(t,o){const a={...t,cards:{...t.cards,deleted:{...t.cards.deleted}}};return a.cards.deleted[o]||(a.cards.deleted[o]=0),a.cards.deleted[o]++,a}function vw(t,o){const a={...t,control:{...t.control}};return o==="player"?a.control.playerRearranges++:a.control.aiRearranges++,a.control.totalRearranges++,a}function ww(t,o,a){const i={...t,coinFlip:{...t.coinFlip}};return o==="heads"?(i.coinFlip.headsChosen++,a&&i.coinFlip.headsWon++):(i.coinFlip.tailsChosen++,a&&i.coinFlip.tailsWon++),i}function Cw(t){return t.global.totalGamesPlayed===0?0:t.global.totalGamesWon/t.global.totalGamesPlayed*100}function xw(t){return t.global.totalGamesPlayed===0?0:Math.floor(t.global.totalPlaytime/t.global.totalGamesPlayed)}function Sw(t){return Object.entries(t.protocols).map(([a,i])=>({protocol:a,timesUsed:i.timesUsed,winRate:i.timesUsed>0?i.wins/i.timesUsed*100:0})).sort((a,i)=>i.timesUsed-a.timesUsed).slice(0,5)}function bw(t){return Object.entries(t.protocols).filter(([a,i])=>i.timesUsed>=3).map(([a,i])=>({protocol:a,timesUsed:i.timesUsed,winRate:i.wins/i.timesUsed*100})).sort((a,i)=>i.winRate-a.winRate).slice(0,5)}function Ew(t){return Object.entries(t.protocols).map(([a,i])=>({protocol:a,timesUsed:i.timesUsed,winRate:i.timesUsed>0?i.wins/i.timesUsed*100:0})).sort((a,i)=>a.timesUsed-i.timesUsed).slice(0,5)}function Rw(t){return Object.entries(t.cards.played).map(([a,i])=>({card:a,count:i})).sort((a,i)=>i.count-a.count).slice(0,5)}function Aw(t){return Object.entries(t.cards.deleted).map(([a,i])=>({card:a,count:i})).sort((a,i)=>i.count-a.count).slice(0,5)}function Jr(t){const o=Math.floor(t/3600),a=Math.floor(t%3600/60),i=t%60;return o>0?`${o}h ${a}m`:a>0?`${a}m ${i}s`:`${i}s`}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function jw(t,o,a){const[i,l]=J.useState(()=>o_()),c=J.useRef(null),s=J.useCallback(()=>{c.current=Date.now()},[]),f=J.useCallback((v,w)=>{l(C=>{const x=`${v}-${w}`,b=gw(C,x);return Qa(b),b})},[]),p=J.useCallback((v,w)=>{l(C=>{const x=`${v}-${w}`,b=mw(C,x);return Qa(b),b})},[]),h=J.useCallback((v,w)=>{l(C=>{const x=ww(C,v,w);return Qa(x),x})},[]),y=J.useCallback(v=>{l(w=>{const C=vw(w,v);return Qa(C),C})},[]),g=J.useCallback((v,w,C)=>{if(c.current===null)return;const x=Math.floor((Date.now()-c.current)/1e3);l(b=>{const E=yw(b,v,t,o,x,a,w,C);return Qa(E),E}),c.current=null},[t,o,a]);return{statistics:i,startGame:s,endGame:g,trackPlayerCardPlayed:f,trackPlayerCardDeleted:p,trackPlayerCoinFlip:h,trackPlayerRearrange:y}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function T(t,o,a=!0){let i=wt.find(l=>l.protocol===t&&l.value===o);return i||(i=er().find(c=>c.protocol===t&&c.value===o)),i?{id:Oe(),protocol:i.protocol,value:i.value,top:i.top,middle:i.middle,bottom:i.bottom,keywords:i.keywords,isFaceUp:a,isRevealed:!1,...i.customEffects&&{customEffects:i.customEffects}}:(console.warn(`Card not found: ${t}-${o}`),{id:Oe(),protocol:t,value:o,top:"",middle:"",bottom:"",keywords:{},isFaceUp:a,isRevealed:!1})}function Y(t,o,a,i){const l={...t},c={...l[o]},s=[...c.lanes];return s[a]=[...s[a],i],c.lanes=s,l[o]=c,l}function $h(t,o){const a=[],i=[...wt,...er()];for(const l of t){const c=i.filter(s=>s.protocol===l);for(const s of c)o.some(p=>p.protocol===s.protocol&&p.value===s.value)||a.push(T(s.protocol,s.value,!0))}return a}function Me(t,o,a,i,l){return{...t,player:{...t.player,protocols:o,lanes:[[],[],[]],hand:[]},opponent:{...t.opponent,protocols:a,lanes:[[],[],[]],hand:[]},turn:i,phase:l,actionRequired:null,queuedActions:[],_interruptedTurn:void 0,_interruptedPhase:void 0,processedStartEffectIds:[],processedEndEffectIds:[],processedUncoverEventIds:[]}}function He(t){const o=[...t.player.hand,...t.player.lanes.flat()],a=[...t.opponent.hand,...t.opponent.lanes.flat()],i=$h(t.player.protocols,o),l=$h(t.opponent.protocols,a),c=t.turn==="player"?"Player":"Opponent",s=[{player:"player",message:`Player protocols: ${t.player.protocols.join(", ")}`},{player:"opponent",message:`Opponent protocols: ${t.opponent.protocols.join(", ")}`},{player:t.turn,message:`${c} goes first.`},{player:"player",message:"---"},{player:t.turn,message:`[Test Scenario] Phase: ${t.phase}`}];return{...t,player:{...t.player,deck:i,discard:[],compiled:[!1,!1,!1]},opponent:{...t.opponent,deck:l,discard:[],compiled:[!1,!1,!1]},log:s}}const a_={name:"Psychic-3 Uncover whrend Opponent's Turn",description:"Player lscht Opponent's face-down card  Psychic-3 uncovered  Player discardet, Opponent shiftet",setup:t=>{let o=Me(t,["Hate","Fire","Water"],["Psychic","Death","Spirit"],"player","action");return o.player.hand=[T("Hate",0,!0),T("Fire",1,!0),T("Water",1,!0)],o=Y(o,"opponent",1,T("Psychic",3,!0)),o=Y(o,"opponent",1,T("Fire",1,!1)),o=Ee(o),He(o)}},r_={name:"Psychic-4 End Effect mit Uncover-Interrupt",description:"Psychic-4 returnt Fire-2  Fire-4 uncovered  Interrupt  Psychic-4 flip aus Queue",setup:t=>{let o=Me(t,["Fire","Water","Spirit"],["Psychic","Death","Metal"],"opponent","end");return o=Y(o,"opponent",0,T("Psychic",4,!0)),o=Y(o,"player",1,T("Fire",4,!0)),o=Y(o,"player",1,T("Fire",2,!0)),o.opponent.hand=[T("Water",1),T("Water",2)],o=Ee(o),He(o)}},l_={name:"Spirit-3 Draw whrend End Phase",description:"Spirit-3 draw in End Phase  Shift-prompt in Queue  Player kann lanes klicken",setup:t=>{let o=Me(t,["Spirit","Fire","Water"],["Death","Metal","Psychic"],"player","action");o=Y(o,"player",0,T("Spirit",3,!0));const a=wt.find(c=>c.protocol==="Fire"&&c.value===1),i=wt.find(c=>c.protocol==="Water"&&c.value===1),l=wt.find(c=>c.protocol==="Spirit"&&c.value===1);return o.player.deck=[a,i,l],o=Ee(o),He(o)}},c_={name:"Plague-2 Actor Propagation",description:"Player spielt Plague-2  Player discardet  Opponent discardet (actor korrekt)",setup:t=>{let o=Me(t,["Plague","Death","Hate"],["Fire","Water","Spirit"],"player","action");return o.player.hand=[T("Plague",2,!0),T("Fire",1),T("Water",1),T("Spirit",1)],o.opponent.hand=[T("Fire",2),T("Water",2),T("Spirit",2),T("Death",2)],o=Ee(o),He(o)}},s_={name:"Darkness-1 Flip + Shift mit Interrupt",description:"Darkness-1 flippt Fire-0  Delete-Interrupt  Player shiftet",setup:t=>{let o=Me(t,["Darkness","Fire","Water"],["Spirit","Death","Metal"],"player","action");return o.player.hand=[T("Darkness",1,!0)],o=Y(o,"opponent",0,T("Fire",0,!1)),o=Ee(o),He(o)}},i_={name:"Plague-4 Owner vs Turn Check",description:"Plague-4 End  Player deletet  Opponent (owner) wird fr flip gefragt",setup:t=>{let o=Me(t,["Fire","Water","Spirit"],["Plague","Death","Metal"],"opponent","end");return o=Y(o,"opponent",0,T("Plague",4,!0)),o=Y(o,"player",1,T("Water",2,!1)),o=Ee(o),He(o)}},d_={name:"Water Owner vs Turn Check",description:"Plague-4 End  Player deletet  Opponent (owner) wird fr flip gefragt",setup:t=>{let o=Me(t,["Fire","Water","Spirit"],["Plague","Death","Metal"],"player","action");return o=Y(o,"opponent",0,T("Plague",4,!0)),o=Y(o,"player",2,T("Water",4,!1)),o.player.hand=[T("Water",0,!0),T("Fire",1),T("Water",1),T("Spirit",1)],o.opponent.hand=[T("Fire",2),T("Water",2),T("Spirit",2),T("Death",2)],o=Ee(o),He(o)}},u_={name:"Hate-1 Multi-Delete mit Uncover-Interrupt",description:"Hate-1 lscht Plague-0  Plague-5 uncovered  Interrupt  Player macht 2. Delete",setup:t=>{let o=Me(t,["Fire","Hate","Water"],["Plague","Death","Metal"],"player","action");return o.player.hand=[T("Hate",1,!0),T("Psychic",2,!0),T("Psychic",4,!0),T("Hate",4,!0),T("Water",1,!0)],o=Y(o,"opponent",0,T("Plague",2,!0)),o=Y(o,"opponent",0,T("Plague",0,!0)),o.opponent.hand=[T("Fire",2,!0),T("Water",2,!0),T("Spirit",2,!0),T("Death",2,!0),T("Metal",2,!0)],o=Ee(o),He(o)}},p_={name:"Darkness-1  Hate-0 Flip  Multi-Effect Chain",description:" Darkness-1 flippt Hate-0  Delete-Interrupt  Draw-Interrupt  Shift aus Queue",setup:t=>{let o=Me(t,["Darkness","Fire","Water"],["Hate","Death","Metal"],"player","action");o.player.hand=[T("Darkness",1,!0)],o=Y(o,"opponent",0,T("Hate",0,!1)),o=Y(o,"opponent",1,T("Hate",3,!0)),o=Y(o,"opponent",2,T("Fire",1,!1)),o=Y(o,"player",1,T("Water",2,!0)),o.opponent.hand=[T("Death",2),T("Metal",3)];const a=wt.find(i=>i.protocol==="Death"&&i.value===1);return o.opponent.deck=[a],o=Ee(o),He(o)}},f_={name:"Water-4 Return  Turn End",description:" Water-4 returnt Karte  Turn endet (Bug-Fix: Opponent spielt nicht zweimal)",setup:t=>{let o=Me(t,["Hate","Spirit","Light"],["Fire","Water","Death"],"opponent","action");return o.opponent.hand=[T("Water",4,!0)],o=Y(o,"opponent",0,T("Life",4,!0)),o=Y(o,"opponent",2,T("Death",4,!1)),o=Y(o,"player",1,T("Spirit",1,!0)),o=Y(o,"player",2,T("Light",5,!1)),o.player.hand=[T("Fire",1),T("Spirit",2),T("Hate",4)],o=Ee(o),He(o)}},h_={name:"Psychic-3 Discard + Shift",description:" Psychic-3 On-Play  Player discardet  AI shiftet (Bug-Fix: AI kann shiften)",setup:t=>{let o=Me(t,["Fire","Water","Spirit"],["Psychic","Death","Metal"],"opponent","action");return o.opponent.hand=[T("Psychic",3,!0)],o.player.hand=[T("Fire",1),T("Water",2),T("Spirit",1)],o=Y(o,"player",0,T("Fire",2,!0)),o=Y(o,"player",1,T("Water",3,!0)),o=Y(o,"player",2,T("Spirit",4,!0)),o=Ee(o),He(o)}},__={name:"Death-1 Delete  Speed-3 Uncover",description:" Death-1 lscht Light-0  Speed-3 uncovered  Player shiftet (Bug-Fix Test)",setup:t=>{let o=Me(t,["Speed","Light","Water"],["Death","Fire","Metal"],"opponent","start");return o=Y(o,"player",0,T("Speed",3,!0)),o=Y(o,"player",0,T("Light",0,!0)),o=Y(o,"player",1,T("Water",1,!0)),o=Y(o,"opponent",0,T("Death",1,!0)),o.player.hand=[],o.opponent.hand=[],o=Ee(o),He(o)}},y_={name:"Gravity-2 Flip  Metal-5 Discard  Shift",description:" Gravity-2 flippt Metal-5  Discard Interrupt  shiften (Bug-Fix: AI stuck)",setup:t=>{let o=Me(t,["Fire","Water","Light"],["Gravity","Metal","Fire"],"opponent","action");return o.opponent.hand=[T("Gravity",2,!0),T("Fire",1)],o=Y(o,"opponent",1,T("Metal",5,!1)),o=Y(o,"player",0,T("Fire",2,!0)),o=Y(o,"player",2,T("Light",3,!0)),o.player.hand=[T("Water",1),T("Fire",3)],o=Ee(o),He(o)}},g_={name:"Hate-2 Player spielt (Einfach)",description:" Player spielt Hate-2  Whlt eigene & Gegners hchste Karte",setup:t=>{let o=Me(t,["Hate","Water","Light"],["Metal","Death","Gravity"],"player","action");return o.player.hand=[T("Hate",2,!0)],o=Y(o,"player",0,T("Fire",4,!0)),o=Y(o,"player",1,T("Water",2,!0)),o=Y(o,"player",2,T("Light",5,!0)),o=Y(o,"opponent",0,T("Metal",3,!0)),o=Y(o,"opponent",1,T("Death",5,!0)),o=Y(o,"opponent",2,T("Gravity",2,!1)),o=Ee(o),He(o)}},m_={name:"Hate-2 AI spielt (Normal)",description:" AI spielt Hate-2  AI whlt eigene & Players hchste automatisch",setup:t=>{let o=Me(t,["Water","Spirit","Light"],["Hate","Metal","Death"],"opponent","action");return o.opponent.hand=[T("Hate",2,!0)],o=Y(o,"opponent",0,T("Fire",5,!0)),o=Y(o,"opponent",1,T("Metal",3,!0)),o=Y(o,"opponent",2,T("Death",2,!1)),o=Y(o,"player",0,T("Water",4,!0)),o=Y(o,"player",1,T("Spirit",5,!0)),o=Y(o,"player",2,T("Light",2,!0)),o=Ee(o),He(o)}},v_={name:"Hate-2 AI spielt (Normal) mit Auswahl",description:" AI spielt Hate-2  AI whlt eigene & Players hchste automatisch",setup:t=>{let o=Me(t,["Water","Spirit","Light"],["Hate","Metal","Death"],"opponent","action");return o.opponent.hand=[T("Hate",2,!0)],o=Y(o,"opponent",0,T("Fire",5,!0)),o=Y(o,"opponent",1,T("Metal",3,!0)),o=Y(o,"opponent",2,T("Death",2,!1)),o=Y(o,"player",0,T("Water",4,!0)),o=Y(o,"player",1,T("Spirit",5,!0)),o=Y(o,"player",2,T("Light",5,!0)),o=Ee(o),He(o)}},w_={name:"Hate-2 Selbst-Lschung",description:" Hate-2 lscht sich selbst  Zweite Klausel entfllt (Regelwerk-Check)",setup:t=>{let o=Me(t,["Hate","Fire","Water"],["Metal","Death","Gravity"],"player","action");return o.player.hand=[T("Hate",2,!0)],o=Y(o,"player",1,T("Fire",1,!0)),o=Y(o,"player",2,T("Water",0,!0)),o=Y(o,"opponent",0,T("Metal",3,!0)),o=Y(o,"opponent",1,T("Death",5,!0)),o=Ee(o),He(o)}},C_={name:"Hate-2 Gleichstand (Auswahl)",description:" Hate-2 mit mehreren hchsten  Player muss whlen (Tied values)",setup:t=>{let o=Me(t,["Hate","Water","Spirit"],["Metal","Death","Gravity"],"player","action");return o.player.hand=[T("Hate",2,!0)],o=Y(o,"player",0,T("Fire",4,!0)),o=Y(o,"player",1,T("Water",4,!0)),o=Y(o,"player",2,T("Spirit",4,!0)),o=Y(o,"opponent",0,T("Metal",5,!0)),o=Y(o,"opponent",1,T("Death",5,!0)),o=Y(o,"opponent",2,T("Gravity",2,!1)),o=Ee(o),He(o)}},x_={name:"Hate-2 Face-Down Karten",description:" Hate-2 mit face-down  Alle face-down sind value 2 (Tied mit Hate-2)",setup:t=>{let o=Me(t,["Hate","Fire","Water"],["Metal","Death","Gravity"],"player","action");return o.player.hand=[T("Hate",2,!0)],o=Y(o,"player",1,T("Fire",5,!1)),o=Y(o,"player",2,T("Water",5,!1)),o=Y(o,"opponent",0,T("Metal",5,!0)),o=Y(o,"opponent",1,T("Death",4,!1)),o=Y(o,"opponent",2,T("Gravity",1,!0)),o=Ee(o),He(o)}},S_={name:"Hate-2 AI Play-Validation",description:" AI spielt Hate-2 NICHT face-up wenn es sich selbst lschen wrde",setup:t=>{let o=Me(t,["Fire","Water","Spirit"],["Hate","Death","Metal"],"opponent","action");return o.opponent.hand=[T("Hate",2,!0)],o=Y(o,"opponent",1,T("Fire",0,!0)),o=Y(o,"opponent",2,T("Water",1,!0)),o=Y(o,"player",0,T("Fire",5,!0)),o=Y(o,"player",1,T("Water",4,!0)),o=Ee(o),He(o)}},b_={name:"Hate-2 AI spielt OFFEN (Optimal)",description:" AI spielt Hate-2 offen weil nicht hchste Karte",setup:t=>{let o=Me(t,["Water","Spirit","Light"],["Hate","Metal","Death"],"opponent","action");return o.opponent.hand=[T("Hate",2,!0)],o=Y(o,"opponent",0,T("Fire",5,!0)),o=Y(o,"opponent",1,T("Metal",4,!0)),o=Y(o,"opponent",2,T("Death",3,!0)),o=Y(o,"player",0,T("Water",2,!0)),o=Y(o,"player",1,T("Spirit",5,!0)),o=Y(o,"player",2,T("Light",1,!0)),o=Ee(o),He(o)}},kw={name:"Chaos-3 Protocol-Free Playing",description:"Player with Chaos-3 can play any card face-up in any lane",setup:t=>{let o=Me(t,["Chaos","Fire","Water"],["Spirit","Death","Metal"],"player","action");return o=Y(o,"player",0,T("Chaos",3,!0)),o.player.hand=[T("Gravity",2,!0),T("Hate",3,!0),T("Love",1,!0)],o=Ee(o),He(o)}},Dw={name:"Frost-3 Blocks Shifts (Covered)",description:"Frost-3 should prevent shifts even when covered (Top-Box effect always active)",setup:t=>{let o=Me(t,["Gravity","Water","Fire"],["Frost","Metal","Death"],"player","action");return o=Y(o,"opponent",0,T("Frost",3,!0)),o=Y(o,"opponent",0,T("Metal",2,!1)),o=Y(o,"player",1,T("Water",2,!0)),o.player.hand=[T("Gravity",1,!0),T("Fire",2,!0)],o=Ee(o),He(o)}},Tw={name:"Water-0 Softlock Bug Fix",description:"Water-0 self-flip should be cancelled when card becomes covered before self-flip executes",setup:t=>{let o=Me(t,["Water","Darkness","Light"],["Apathy","Fire","Death"],"player","action");return o=Y(o,"player",1,T("Darkness",3,!1)),o.player.hand=[T("Water",0,!0),T("Darkness",2,!0),T("Fire",1,!0)],o=Ee(o),He(o)}},Fw={name:"Dark_cust-1 Flip and Shift Chain",description:"Dark_cust-1 should flip opponent card, then allow shifting that same card",setup:t=>{let o=Me(t,["Dark_cust","Water","Fire"],["Metal","Fire","Death"],"player","action");return o=Y(o,"opponent",0,T("Metal",2,!1)),o=Y(o,"opponent",1,T("Fire",1,!0)),o=Y(o,"opponent",2,T("Hate",0,!1)),o.player.hand=[T("Dark_cust",1,!0),T("Water",2,!0),T("Fire",3,!0)],o=Ee(o),He(o)}},qw={name:"Dark_cust-1 Flips Speed-3 - Middle Effect Execution",description:"When Dark_cust-1 flips Speed-3, Speed-3's middle effect (shift) should execute before Dark_cust-1's shift",setup:t=>{let o=Me(t,["Dark_cust","Water","Fire"],["Speed","Fire","Metal"],"player","action");return o=Y(o,"opponent",0,T("Speed",3,!1)),o=Y(o,"opponent",1,T("Fire",1,!0)),o=Y(o,"opponent",2,T("Metal",2,!0)),o.player.hand=[T("Dark_cust",1,!0),T("Water",2,!0),T("Fire",3,!0)],o=Ee(o),He(o)}},Nw={name:"Dark_cust-1 Flips Speed-3 - Middle Effect Execution",description:"When Dark_cust-1 flips Speed-3, Speed-3's middle effect (shift) should execute before Dark_cust-1's shift",setup:t=>{let o=Me(t,["Darkness","Water","Fire"],["Speed","Fire","Metal"],"player","action");return o=Y(o,"opponent",0,T("Speed",3,!1)),o=Y(o,"opponent",1,T("Fire",1,!0)),o=Y(o,"opponent",2,T("Metal",2,!0)),o.player.hand=[T("Darkness",1,!0),T("Water",2,!0),T("Fire",3,!0)],o=Ee(o),He(o)}},E_={name:"Fire_custom-1 & Fire_custom-2 Conditional Test",description:" Fire_custom-1 (discard -> delete) & Fire_custom-2 (discard -> return) if_executed logic",setup:t=>{let o=Me(t,["Fire_custom","Water","Spirit"],["Metal","Death","Fire"],"player","action");return o.player.hand=[T("Fire_custom",1,!0),T("Fire_custom",2,!0),T("Fire_custom",0,!0),T("Fire_custom",3,!0),T("Fire_custom",4,!0),T("Fire_custom",5,!0)],o=Y(o,"opponent",0,T("Metal",3,!0)),o=Y(o,"opponent",1,T("Death",4,!0)),o=Y(o,"opponent",2,T("Fire",2,!0)),o=Y(o,"opponent",0,T("Metal",1,!0)),o=Y(o,"player",2,T("Spirit",3,!0)),o=Y(o,"player",1,T("Water",3,!0)),o=Y(o,"player",2,T("Spirit",2,!0)),o=Ee(o),He(o)}},R_={name:"Anarchy_custom Test Playground",description:" All Anarchy_custom cards on hand for testing",setup:t=>{let o=Me(t,["Anarchy_custom","Water","Spirit"],["Metal","Death","Fire"],"player","action");return o.player.hand=[T("Anarchy_custom",0,!0),T("Anarchy_custom",1,!0),T("Anarchy_custom",2,!0),T("Anarchy_custom",3,!0),T("Anarchy_custom",5,!0),T("Anarchy_custom",6,!0)],o=Y(o,"opponent",0,T("Metal",3,!0)),o=Y(o,"opponent",1,T("Death",4,!1)),o=Y(o,"opponent",2,T("Fire",2,!0)),o=Y(o,"opponent",0,T("Metal",1,!0)),o=Y(o,"player",2,T("Spirit",3,!0)),o=Y(o,"player",1,T("Water",3,!0)),o=Y(o,"player",2,T("Spirit",2,!0)),o=Ee(o),He(o)}},A_={name:"Dark_cust Test Playground",description:" All Dark_cust cards on hand for testing",setup:t=>{let o=Me(t,["Dark_cust","Water","Spirit"],["Metal","Death","Fire"],"player","action");return o.player.hand=[T("Dark_cust",0,!0),T("Dark_cust",1,!0),T("Dark_cust",2,!0),T("Dark_cust",3,!0),T("Dark_cust",4,!0),T("Dark_cust",5,!0)],o=Y(o,"opponent",0,T("Metal",3,!1)),o=Y(o,"opponent",1,T("Death",4,!0)),o=Y(o,"opponent",2,T("Fire",2,!1)),o=Y(o,"opponent",0,T("Metal",1,!0)),o=Y(o,"opponent",1,T("Death",2,!1)),o=Y(o,"player",2,T("Spirit",3,!0)),o=Y(o,"player",1,T("Water",3,!0)),o=Y(o,"player",2,T("Spirit",2,!0)),o=Ee(o),He(o)}},j_={name:"Apathy_custom Test Playground",description:" All Apathy_custom cards on hand for testing",setup:t=>{let o=Me(t,["Apathy_custom","Water","Spirit"],["Metal","Death","Fire"],"player","action");return o.player.hand=[T("Apathy_custom",0,!0),T("Apathy_custom",1,!0),T("Apathy_custom",2,!0),T("Apathy_custom",3,!0),T("Apathy_custom",4,!0),T("Apathy_custom",5,!0)],o=Y(o,"opponent",0,T("Metal",3,!0)),o=Y(o,"opponent",1,T("Death",4,!0)),o=Y(o,"opponent",2,T("Fire",2,!0)),o=Y(o,"opponent",0,T("Metal",1,!0)),o=Y(o,"opponent",2,T("Fire",1,!1)),o=Y(o,"player",2,T("Spirit",3,!0)),o=Y(o,"player",1,T("Water",3,!0)),o=Y(o,"player",2,T("Spirit",2,!0)),o=Ee(o),He(o)}},k_={name:"Death_custom Test Playground",description:" All Death_custom cards on hand for testing",setup:t=>{let o=Me(t,["Death_cust","Water","Spirit"],["Metal","Death","Fire"],"player","action");return o.player.hand=[T("Death_cust",0,!0),T("Death_cust",1,!0),T("Death_cust",2,!0),T("Death_cust",3,!0),T("Death_cust",4,!0),T("Death_cust",5,!0)],o=Y(o,"opponent",0,T("Metal",0,!0)),o=Y(o,"opponent",1,T("Death",1,!0)),o=Y(o,"opponent",2,T("Fire",3,!0)),o=Y(o,"opponent",0,T("Metal",2,!0)),o=Y(o,"opponent",1,T("Death",4,!1)),o=Y(o,"player",2,T("Spirit",3,!0)),o=Y(o,"player",1,T("Water",3,!0)),o=Y(o,"player",2,T("Spirit",2,!0)),o=Ee(o),He(o)}},D_={name:"Water_custom Test Playground",description:" All Water_custom cards on hand for testing - wash away and renew",setup:t=>{let o=Me(t,["Water_custom","Fire","Spirit"],["Metal","Death","Light"],"player","action");return o.player.hand=[T("Water_custom",0,!0),T("Water_custom",1,!0),T("Water_custom",2,!0),T("Water_custom",3,!0),T("Water_custom",4,!0),T("Water_custom",5,!0)],o=Y(o,"opponent",0,T("Metal",2,!0)),o=Y(o,"opponent",1,T("Death",3,!0)),o=Y(o,"opponent",2,T("Light",2,!0)),o=Y(o,"opponent",0,T("Metal",4,!0)),o=Y(o,"opponent",1,T("Death",2,!1)),o=Y(o,"opponent",2,T("Light",5,!1)),o=Y(o,"player",1,T("Fire",2,!0)),o=Y(o,"player",2,T("Spirit",3,!0)),o=Y(o,"player",1,T("Fire",4,!0)),o=Y(o,"player",2,T("Spirit",5,!1)),o=Ee(o),He(o)}},T_={name:"Spirit_custom Test Playground",description:" All Spirit_custom cards on hand - true strength from within",setup:t=>{let o=Me(t,["Spirit_custom","Fire","Water"],["Metal","Death","Light"],"player","action");return o.player.hand=[T("Spirit_custom",0,!0),T("Spirit_custom",1,!0),T("Spirit_custom",2,!0),T("Spirit_custom",3,!0),T("Spirit_custom",4,!0),T("Spirit_custom",5,!0)],o=Y(o,"opponent",0,T("Metal",3,!0)),o=Y(o,"opponent",1,T("Death",2,!1)),o=Y(o,"opponent",2,T("Light",4,!0)),o=Y(o,"opponent",0,T("Metal",5,!1)),o=Y(o,"opponent",2,T("Light",3,!0)),o=Y(o,"player",1,T("Fire",2,!0)),o=Y(o,"player",2,T("Water",4,!0)),o=Y(o,"player",1,T("Fire",3,!1)),o=Ee(o),He(o)}},F_={name:"Chaos_custom Test Playground",description:" All Chaos_custom cards on hand - embrace the unpredictable",setup:t=>{let o=Me(t,["Chaos_custom","Fire","Water"],["Metal","Death","Light"],"player","action");return o.player.hand=[T("Chaos_custom",0,!0),T("Chaos_custom",1,!0),T("Chaos_custom",2,!0),T("Chaos_custom",3,!0),T("Chaos_custom",4,!0),T("Chaos_custom",5,!0)],o=Y(o,"opponent",0,T("Metal",2,!0)),o=Y(o,"opponent",0,T("Metal",4,!0)),o=Y(o,"opponent",1,T("Death",3,!1)),o=Y(o,"opponent",1,T("Death",5,!0)),o=Y(o,"opponent",2,T("Light",1,!0)),o=Y(o,"opponent",2,T("Light",3,!1)),o=Y(o,"player",0,T("Fire",2,!0)),o=Y(o,"player",0,T("Fire",4,!0)),o=Y(o,"player",1,T("Water",3,!1)),o=Y(o,"player",1,T("Water",5,!0)),o=Y(o,"player",2,T("Fire",1,!0)),o=Ee(o),He(o)}},q_={name:"Gravity_custom Test Playground",description:" All Gravity_custom cards on hand - pull everything together",setup:t=>{let o=Me(t,["Fire","Gravity_custom","Water"],["Metal","Death","Light"],"player","action");return o.player.hand=[T("Gravity_custom",0,!0),T("Gravity_custom",1,!0),T("Gravity_custom",2,!0),T("Gravity_custom",4,!0),T("Gravity_custom",5,!0),T("Gravity_custom",6,!0)],o=Y(o,"player",0,T("Fire",1,!0)),o=Y(o,"player",2,T("Water",2,!1)),o=Y(o,"opponent",0,T("Metal",3,!1)),o=Y(o,"opponent",0,T("Metal",4,!0)),o=Y(o,"opponent",1,T("Death",2,!1)),o=Y(o,"opponent",1,T("Death",3,!0)),o=Y(o,"opponent",2,T("Light",4,!1)),o.opponent.deck=[T("Metal",5,!0),T("Death",4,!0),T("Light",5,!0)],o=Ee(o),He(o)}},N_={name:"Frost_custom Test Playground",description:" All Frost_custom cards on hand - pull everything together",setup:t=>{let o=Me(t,["Fire","Frost_custom","Water"],["Metal","Death","Light"],"player","action");return o.player.hand=[T("Frost_custom",0,!0),T("Frost_custom",1,!0),T("Frost_custom",2,!0),T("Frost_custom",3,!0),T("Frost_custom",4,!0),T("Frost_custom",5,!0)],o=Y(o,"player",0,T("Fire",1,!0)),o=Y(o,"player",2,T("Water",2,!1)),o=Y(o,"opponent",0,T("Metal",3,!1)),o=Y(o,"opponent",0,T("Metal",4,!0)),o=Y(o,"opponent",1,T("Death",2,!1)),o=Y(o,"opponent",1,T("Death",3,!0)),o=Y(o,"opponent",2,T("Light",4,!1)),o.opponent.deck=[T("Metal",5,!0),T("Death",4,!0),T("Light",5,!0)],o=Ee(o),He(o)}},U_={name:"Hate_custom Test Playground",description:" All Hate_custom cards on hand - test deletion mechanics",setup:t=>{let o=Me(t,["Hate_custom","Water","Spirit"],["Metal","Death","Fire"],"player","action");return o.player.hand=[T("Hate_custom",0,!0),T("Hate_custom",1,!0),T("Hate_custom",2,!0),T("Hate_custom",3,!0),T("Hate_custom",4,!0),T("Hate_custom",5,!0)],o=Y(o,"player",1,T("Water",1,!0)),o=Y(o,"player",1,T("Water",2,!0)),o=Y(o,"player",1,T("Water",3,!0)),o=Y(o,"player",2,T("Spirit",2,!0)),o=Y(o,"player",2,T("Spirit",4,!1)),o=Y(o,"opponent",0,T("Metal",5,!0)),o=Y(o,"opponent",1,T("Death",2,!0)),o=Y(o,"opponent",1,T("Death",4,!0)),o=Y(o,"opponent",2,T("Fire",3,!1)),o.player.deck=[T("Water",0,!0),T("Water",4,!0),T("Spirit",0,!0),T("Spirit",5,!0)],o.opponent.deck=[T("Metal",3,!0),T("Death",5,!0),T("Fire",1,!0)],o=Ee(o),He(o)}},$_={name:"Life_custom Test Playground",description:" All Life_custom cards on hand - test play and flip mechanics",setup:t=>{let o=Me(t,["Life_custom","Water","Spirit"],["Metal","Death","Fire"],"player","action");return o.player.hand=[T("Life_custom",0,!0),T("Life_custom",1,!0),T("Life_custom",2,!0),T("Life_custom",3,!0),T("Life_custom",4,!0),T("Life_custom",5,!0)],o=Y(o,"player",1,T("Water",1,!0)),o=Y(o,"player",1,T("Water",2,!0)),o=Y(o,"player",1,T("Water",3,!0)),o=Y(o,"player",2,T("Spirit",2,!0)),o=Y(o,"player",2,T("Spirit",4,!1)),o=Y(o,"opponent",0,T("Metal",3,!1)),o=Y(o,"opponent",1,T("Death",2,!0)),o=Y(o,"opponent",1,T("Death",4,!1)),o=Y(o,"opponent",2,T("Fire",5,!1)),o.player.deck=[T("Water",0,!0),T("Water",3,!0),T("Water",4,!0),T("Spirit",0,!0),T("Spirit",1,!0),T("Spirit",2,!0),T("Spirit",3,!0),T("Spirit",4,!0)],o.opponent.deck=[T("Metal",1,!0),T("Death",3,!0),T("Fire",2,!0)],o=Ee(o),He(o)}},O_={name:"Light_custom Test Playground",description:" All Light_custom cards on hand - burn away the dark",setup:t=>{let o=Me(t,["Light_custom","Water","Spirit"],["Metal","Death","Fire"],"player","action");return o.player.hand=[T("Light_custom",0,!0),T("Light_custom",1,!0),T("Light_custom",2,!0),T("Light_custom",3,!0),T("Light_custom",4,!0),T("Light_custom",5,!0)],o=Y(o,"opponent",0,T("Fire",3,!1)),o=Y(o,"opponent",1,T("Metal",4,!1)),o=Y(o,"opponent",2,T("Death",5,!0)),o=Y(o,"player",1,T("Water",2,!1)),o=Y(o,"player",1,T("Water",3,!1)),o=Y(o,"player",1,T("Water",4,!1)),o=Y(o,"player",0,T("Spirit",1,!0)),o=Y(o,"player",0,T("Spirit",2,!1)),o=Y(o,"player",2,T("Spirit",5,!1)),o.player.deck=[T("Water",0,!0),T("Water",1,!0),T("Spirit",0,!0),T("Spirit",3,!0),T("Spirit",4,!0)],o.opponent.hand=[T("Metal",1,!0),T("Death",2,!0),T("Fire",3,!0),T("Metal",0,!0)],o=Ee(o),He(o)}},L_=[a_,r_,l_,c_,s_,i_,d_,u_,p_,f_,h_,__,y_,g_,m_,v_,w_,C_,x_,S_,b_,kw,Dw,Tw,Fw,qw,Nw,E_,R_,A_,j_,k_,D_,T_,F_,q_,N_,U_,$_,O_],Uw=Object.freeze(Object.defineProperty({__proto__:null,allScenarios:L_,scenario10_Hate1Interrupt:u_,scenario11_Darkness1HateChain:p_,scenario12_Water4TurnEnd:f_,scenario13_Psychic3ShiftTest:h_,scenario14_Death1UncoverTest:__,scenario15_Gravity2ShiftInterrupt:y_,scenario16_Hate2PlayerPlays:g_,scenario171_Hate2AIPlays:v_,scenario17_Hate2AIPlays:m_,scenario18_Hate2SelfDelete:w_,scenario19_Hate2MultipleTies:C_,scenario1_Psychic3Uncover:a_,scenario20_Hate2FaceDown:x_,scenario21_Hate2AIValidation:S_,scenario22_Hate2AIPlaysOpen:b_,scenario29_FireCustomConditional:E_,scenario2_Psychic4EndEffect:r_,scenario30_AnarchyCustomPlayground:R_,scenario31_DarkCustPlayground:A_,scenario32_ApathyCustomPlayground:j_,scenario33_DeathCustomPlayground:k_,scenario34_WaterCustomPlayground:D_,scenario35_SpiritCustomPlayground:T_,scenario36_ChaosCustomPlayground:F_,scenario37_GravityCustomPlayground:q_,scenario38_FrostCustomPlayground:N_,scenario39_HateCustomPlayground:U_,scenario3_Spirit3EndPhase:l_,scenario40_LifeCustomPlayground:$_,scenario41_LightCustomPlayground:O_,scenario4_Plague2Actor:c_,scenario5_Darkness1Interrupt:s_,scenario8_Plague4Owner:i_,scenario9_Water:d_},Symbol.toStringTag,{value:"Module"})),$w=({onLoadScenario:t,onSkipCoinFlip:o})=>{const[a,i]=J.useState(!1);return a?u.jsxs("div",{style:{position:"fixed",top:"20px",left:"20px",width:"400px",maxHeight:"600px",backgroundColor:"#2c2c2c",border:"2px solid #ff6b6b",borderRadius:"8px",padding:"20px",zIndex:9999,overflowY:"auto",color:"white",fontFamily:"monospace"},children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"20px"},children:[u.jsx("h3",{style:{margin:0},children:" Debug Panel"}),u.jsx("button",{onClick:()=>i(!1),style:{backgroundColor:"transparent",border:"none",color:"white",cursor:"pointer",fontSize:"20px"},children:""})]}),u.jsx("div",{style:{marginBottom:"15px",fontSize:"12px",color:"#aaa"},children:"Lade vordefinierte Test-Szenarien zum Testen der Actor/Owner-Fixes."}),u.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:L_.map((l,c)=>u.jsxs("div",{style:{backgroundColor:"#1a1a1a",padding:"12px",borderRadius:"5px",border:"1px solid #444"},children:[u.jsx("div",{style:{fontWeight:"bold",marginBottom:"5px",color:"#4ecdc4"},children:l.name}),u.jsx("div",{style:{fontSize:"11px",color:"#bbb",marginBottom:"10px"},children:l.description}),u.jsx("button",{onClick:()=>{o&&o(),t(l.setup),i(!1)},style:{padding:"6px 12px",backgroundColor:"#4ecdc4",color:"#1a1a1a",border:"none",borderRadius:"3px",cursor:"pointer",fontWeight:"bold",fontSize:"12px"},children:"Load Scenario"})]},c))}),u.jsx("div",{style:{marginTop:"20px",fontSize:"11px",color:"#666",textAlign:"center"},children:"Drcke ESC oder klicke  zum Schlieen"})]}):u.jsx("button",{onClick:()=>i(!0),style:{position:"fixed",top:"20px",left:"20px",padding:"10px 20px",backgroundColor:"#ff6b6b",color:"white",border:"none",borderRadius:"5px",cursor:"pointer",fontWeight:"bold",zIndex:9999,fontSize:"14px"},children:" DEBUG"})},Ow=(t,o)=>{if(!o)return null;for(const a of["player","opponent"])for(const i of t[a].lanes){const l=i.find(c=>c.id===o);if(l)return{card:l,owner:a}}return null},Lw=new Set(["discard","select_card_from_hand_to_play","select_card_from_hand_to_give","select_card_from_hand_to_reveal","plague_2_player_discard","select_cards_from_hand_to_discard_for_fire_4","select_cards_from_hand_to_discard_for_hate_1"]);function Pw({onBack:t,onEndGame:o,playerProtocols:a,opponentProtocols:i,difficulty:l,useControlMechanic:c,startingPlayer:s="player"}){var Qt,no,ha;const[f,p]=J.useState(null),[h,y]=J.useState(!0),{startGame:g,endGame:v,trackPlayerCoinFlip:w,trackPlayerRearrange:C}=jw(a,l,c),x=J.useCallback((we,be,Le)=>{p(we),y(!1),w(be,Le)},[w]),b=J.useCallback(()=>{p("player"),y(!1),g()},[g]);J.useEffect(()=>{!h&&f&&g()},[h,f,g]);const E=J.useCallback((we,be)=>{const Le=be.player.compiled.filter(ut=>ut).length;v(we,be.stats.player,Le),o(we,be)},[v,o]),{gameState:S,selectedCard:j,setSelectedCard:R,playSelectedCard:A,fillHand:N,discardCardFromHand:I,compileLane:V,resolveActionWithCard:L,resolveActionWithLane:D,selectHandCardForAction:O,resolveActionWithHandCard:H,skipAction:te,resolveOptionalDrawPrompt:ne,resolveDeath1Prompt:z,resolveLove1Prompt:F,resolvePlague2Discard:B,resolvePlague4Flip:W,resolveFire3Prompt:_e,resolveOptionalDiscardCustomPrompt:U,resolveOptionalEffectPrompt:P,resolveFire4Discard:Z,resolveHate1Discard:Q,resolveLight2Prompt:pe,resolveRevealBoardCardPrompt:Ce,resolveRearrangeProtocols:ve,resolveSpirit1Prompt:ke,resolveSpirit3Prompt:Xe,resolveSwapProtocols:de,resolveSpeed3Prompt:ce,resolvePsychic4Prompt:le,resolveControlMechanicPrompt:re,resolveCustomChoice:se,setupTestScenario:ge}=aw(a,i,E,l,c,f??"player",C),[me,Se]=J.useState(null),[$e,xe]=J.useState([]),[at,nt]=J.useState(!1),[Ke,Rt]=J.useState([]),De=J.useRef(S.log.length),[gt,Ot]=J.useState(!1),[an,yt]=J.useState(!1),[dt,Nt]=J.useState(null),[fa,ye]=J.useState(!1),[je,Ve]=J.useState(0),Te=J.useRef(null),Ne=J.useRef(S);J.useEffect(()=>{Ne.current=S},[S]);const xt=()=>{const we=je+1;if(Ve(we),we>=5){ye(be=>!be),Ve(0),Te.current&&(clearTimeout(Te.current),Te.current=null);return}Te.current&&clearTimeout(Te.current),Te.current=setTimeout(()=>{Ve(0),Te.current=null},2e3)},Je=J.useMemo(()=>{if(S.lastPlayedCardId){const we=Ow(S,S.lastPlayedCardId);if(we){const be=we.owner==="player"||we.card.isFaceUp;return{card:we.card,showContents:be}}}return null},[S.lastPlayedCardId,S.player.lanes,S.opponent.lanes]),At=me||Je;J.useEffect(()=>{S.log.length>De.current&&S.log.slice(De.current).forEach(be=>{if(be.message!=="Game Started."){const Le={message:be.message,player:be.player,id:Oe()};Rt(ut=>[...ut,Le]),setTimeout(()=>{Rt(ut=>ut.filter(Lt=>Lt.id!==Le.id))},5e3)}}),De.current=S.log.length},[S.log]),J.useEffect(()=>{var be,Le,ut,Lt,rn;!(((be=S.actionRequired)==null?void 0:be.type)==="discard"&&((Le=S.actionRequired)==null?void 0:Le.variableCount))&&((ut=S.actionRequired)==null?void 0:ut.type)!=="plague_2_player_discard"&&((Lt=S.actionRequired)==null?void 0:Lt.type)!=="select_cards_from_hand_to_discard_for_fire_4"&&((rn=S.actionRequired)==null?void 0:rn.type)!=="select_cards_from_hand_to_discard_for_hate_1"&&xe([])},[S.actionRequired]),J.useEffect(()=>{var we,be;Ot(((we=S.actionRequired)==null?void 0:we.type)==="prompt_rearrange_protocols"&&S.actionRequired.actor==="player"),yt(((be=S.actionRequired)==null?void 0:be.type)==="prompt_swap_protocols"&&S.actionRequired.actor==="player")},[S.actionRequired]),J.useEffect(()=>{const we=be=>{be.ctrlKey&&be.shiftKey&&(be.preventDefault(),be.key.toLowerCase()==="d"?(console.log("Debug: Toggling debug button visibility."),ye(Le=>!Le)):be.key.toLowerCase()==="w"?(console.log("Debug: Forcing player win."),o("player",S)):be.key.toLowerCase()==="o"?(console.log("Debug: Forcing opponent win."),o("opponent",S)):be.key.toLowerCase()==="p"?(console.log("Debug: Setting up Speed-0 interrupt scenario."),ge("speed-0-interrupt")):be.key.toLowerCase()==="l"?(console.log("Debug: Setting up Speed-1 discard trigger scenario."),ge("speed-1-trigger")):be.key.toLowerCase()==="f"?(console.log("Debug: Setting up Fire On-Cover test scenario."),ge("fire-oncover-test")):be.key.toLowerCase()==="s"?(console.log("Debug: Setting up Speed-2 + Control test scenario."),ge("speed-2-control-test")):be.key.toLowerCase()==="u"&&(console.log("Debug: Setting up Death-1 Uncover test scenario."),bm(()=>Promise.resolve().then(()=>Uw),void 0).then(Le=>{ge(Le.scenario14_Death1UncoverTest.setup)})))};return window.addEventListener("keydown",we),()=>{window.removeEventListener("keydown",we)}},[S,o,ge]);const un=we=>{const be=Ne.current;if(be.animationState)return;const{actionRequired:Le,turn:ut,phase:Lt,compilableLanes:rn,player:Xt,opponent:wn}=be;if(ut==="player"&&Lt==="compile"&&rn.includes(we)){if(Le){console.warn("Compile click blocked by pending action:",Le);return}V(we);return}if(Le&&Le.actor==="player"&&["select_lane_for_shift","select_lane_for_shift_all","shift_flipped_card_optional","select_lane_for_play","select_lane_for_delete","select_lane_for_death_2","select_lane_for_life_3_play","select_lane_to_shift_revealed_card_for_light_2","select_lane_to_shift_revealed_board_card_custom","select_lane_to_shift_cards_for_light_3","select_lane_for_water_3","select_lane_for_metal_3_delete","select_lane_for_return"].includes(Le.type)){D(we);return}const Mn=wn.lanes.flat().some(Vt=>Vt.isFaceUp&&Vt.protocol==="Psychic"&&Vt.value===1),ft=wn.lanes[we],ul=ft.length>0&&ft[ft.length-1].isFaceUp&&ft[ft.length-1].protocol==="Plague"&&ft[ft.length-1].value===0;if(j&&Lt==="action"&&!Le&&Xt.hand.some(Vt=>Vt.id===j)&&!ul){const Vt=Xt.hand.find(Pt=>Pt.id===j),xo=Xt.lanes.flat().some(Pt=>Pt.isFaceUp&&Pt.protocol==="Spirit"&&Pt.value===1),Ic=Xt.lanes.some((Pt,Xn)=>{if(Pt.length===0)return!1;const Wo=Pt[Pt.length-1];return Wo.isFaceUp&&Wo.protocol==="Chaos"&&Wo.value===3}),pl=[...Xt.lanes.flat(),...wn.lanes.flat()].some(Pt=>Pt.isFaceUp&&Pt.protocol==="Anarchy"&&Pt.value===1),fl=md(be),Mc=vd(be,"player",we);let So;pl||fl?So=Vt.protocol!==Xt.protocols[we]&&Vt.protocol!==wn.protocols[we]&&!Mn:So=(xo||Mc||Ic||Vt.protocol===Xt.protocols[we]||Vt.protocol===wn.protocols[we])&&!Mn,A(we,So),Se(null);return}j&&(R(null),Se(null))},Tt=we=>{const be=Ne.current;if(be.animationState||!j)return;const{phase:Le,actionRequired:ut,player:Lt}=be;Le!=="action"||ut||!Lt.hand.some(rn=>rn.id===j)||(A(we,!1),Se(null))},Yo=we=>{const be=Ne.current;if(!be.animationState){if(be.actionRequired){if(be.actionRequired.type==="discard"&&be.actionRequired.actor==="player")if(be.actionRequired.variableCount){xe(Le=>Le.includes(we.id)?Le.filter(ut=>ut!==we.id):[...Le,we.id]);return}else{I(we.id);return}if(be.actionRequired.type==="select_card_from_hand_to_play"){O(we.id);return}if(be.actionRequired.type==="select_card_from_hand_to_give"||be.actionRequired.type==="select_card_from_hand_to_reveal"){H(we.id);return}if(be.actionRequired.type==="plague_2_player_discard"||be.actionRequired.type==="select_cards_from_hand_to_discard_for_fire_4"||be.actionRequired.type==="select_cards_from_hand_to_discard_for_hate_1"){xe(Le=>Le.includes(we.id)?Le.filter(ut=>ut!==we.id):[...Le,we.id]);return}return}be.turn!=="player"||be.phase!=="action"&&be.phase!=="compile"||(we.id===j?(R(null),Se(null)):(R(we.id),Se({card:we,showContents:!0})))}},In=(we,be,Le)=>{const ut=Ne.current;if(ut.animationState)return;const{actionRequired:Lt,turn:rn,phase:Xt,compilableLanes:wn}=ut;if(rn==="player"&&Xt==="compile"&&wn.includes(Le)){un(Le);return}if(rn==="player"&&!Lt&&j&&Xt==="action"){un(Le);return}if(Lt&&Lt.actor==="player"&&(Lt.type==="select_own_highest_card_to_delete_for_hate_2"||Lt.type==="select_opponent_highest_card_to_delete_for_hate_2")&&qc(we,ut)){L(we.id);return}if(qc(we,ut))L(we.id);else if(j)R(null),Se(null);else{const Mn=be==="player"||we.isFaceUp;Se({card:we,showContents:Mn})}},Oc=we=>{j||Se({card:we,showContents:!0})},il=(we,be)=>{if(!j){const Le=be==="player"||we.isFaceUp;Se({card:we,showContents:Le})}},tr=()=>{j||Se(null)},nr=we=>{!j&&!S.actionRequired&&Se({card:we,showContents:we.isRevealed||!1})},or=()=>{if(!At)return null;const{card:we,showContents:be}=At;return u.jsx(nn,{card:we,isFaceUp:be})},dl=S.turn==="player"&&!S.actionRequired&&S.phase==="compile"&&S.compilableLanes.length>0,Lc=((Qt=S.actionRequired)==null?void 0:Qt.sourceCardId)??null,Qn=J.useMemo(()=>{var we;return(we=S.actionRequired)!=null&&we.actor?S.actionRequired.actor==="player"?"action-required-player":"action-required-opponent":""},[S.actionRequired]),Bt=J.useMemo(()=>{const we=S.actionRequired;return we&&we.actor==="player"?Lw.has(we.type)?"":"hand-in-background":""},[S.actionRequired]);return u.jsxs("div",{className:"screen game-screen",children:[dt&&u.jsx(hw,{player:dt,playerState:S[dt],onClose:()=>Nt(null)}),gt&&((no=S.actionRequired)==null?void 0:no.type)==="prompt_rearrange_protocols"&&u.jsx(pw,{gameState:S,targetPlayer:S.actionRequired.target,onConfirm:we=>{var be,Le;((be=S.actionRequired)==null?void 0:be.sourceCardId)==="CONTROL_MECHANIC"&&((Le=S.actionRequired)!=null&&Le.actor)&&C(S.actionRequired.actor),ve(we),Ot(!1)}}),an&&((ha=S.actionRequired)==null?void 0:ha.type)==="prompt_swap_protocols"&&u.jsx(fw,{gameState:S,targetPlayer:S.actionRequired.target,onConfirm:we=>{de(we),yt(!1)}}),u.jsx("div",{className:"toaster-container",children:Ke.map(we=>u.jsx(uw,{message:we.message,player:we.player},we.id))}),at&&u.jsx(dw,{log:S.log,onClose:()=>nt(!1)}),u.jsx("button",{className:"btn log-button",onClick:()=>nt(!0),children:"Log"}),u.jsxs("div",{className:"game-screen-layout",children:[u.jsxs("div",{className:"game-preview-container",children:[u.jsx("h2",{onClick:xt,style:{cursor:"pointer",userSelect:"none"},title:"Click 5 times to toggle debug mode",children:"Mainframe"}),u.jsx(cw,{gameState:S,turn:S.turn,animationState:S.animationState,difficulty:l,onPlayerClick:()=>Nt("player"),onOpponentClick:()=>Nt("opponent")}),u.jsx("div",{className:"preview-card-area",children:or()}),u.jsx("button",{className:"btn btn-back",onClick:t,children:"Back"})]}),u.jsxs("div",{className:"game-main-area",children:[dl&&u.jsx("div",{className:"compile-prompt-container",children:u.jsx("h3",{children:"Select a Protocol to Compile"})}),u.jsx(rw,{gameState:S,onLanePointerDown:un,onPlayFaceDown:Tt,selectedCardId:j,onCardPointerDown:In,onCardPointerEnter:il,onCardPointerLeave:tr,onOpponentHandCardPointerEnter:nr,onOpponentHandCardPointerLeave:tr,sourceCardId:Lc}),u.jsxs("div",{className:"player-action-area",children:[u.jsx(lw,{gameState:S,onFillHand:N,onSkipAction:te,onResolveOptionalDrawPrompt:ne,onResolveDeath1Prompt:z,onResolveLove1Prompt:F,onResolvePlague2Discard:B,onResolvePlague4Flip:W,onResolveFire3Prompt:_e,onResolveOptionalDiscardCustomPrompt:U,onResolveOptionalEffectPrompt:P,onResolveSpeed3Prompt:ce,onResolveFire4Discard:Z,onResolveHate1Discard:Q,onResolveLight2Prompt:pe,onResolveRevealBoardCardPrompt:Ce,onResolvePsychic4Prompt:le,onResolveSpirit1Prompt:ke,onResolveSpirit3Prompt:Xe,onResolveControlMechanicPrompt:re,onResolveCustomChoice:se,selectedCardId:j,multiSelectedCardIds:$e,actionRequiredClass:Qn}),u.jsx("div",{className:`player-hand-area ${Bt}`,children:S.player.hand.map(we=>u.jsx(nn,{card:we,isFaceUp:!0,onPointerDown:()=>Yo(we),onPointerEnter:()=>Oc(we),isSelected:we.id===j,isMultiSelected:$e.includes(we.id),animationState:S.animationState,additionalClassName:"in-hand"},we.id))})]})]})]}),h&&u.jsx(_w,{onComplete:x}),fa&&u.jsx($w,{onLoadScenario:ge,onSkipCoinFlip:b})]})}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function Iw({onPlayAgain:t,winner:o,finalState:a,difficulty:i}){if(!a)return u.jsxs("div",{className:"screen",children:[u.jsx("h1",{children:"Loading Results..."}),u.jsx("button",{className:"btn",onClick:t,children:"Back to Menu"})]});const l=o==="player",c=(s,f)=>{let p=[s];return f&&p.push("compiled"),p.join(" ")};return u.jsx("div",{className:`screen results-screen ${l?"victory":"defeat"}`,children:u.jsxs("div",{className:"results-screen-content",children:[u.jsxs("header",{className:"results-header",children:[u.jsx("h1",{children:l?"VICTORY":"DEFEAT"}),u.jsx("p",{children:l?"System compiled successfully.":"Critical error in the mainframe."})]}),u.jsxs("div",{className:"results-body",children:[u.jsxs("div",{className:"final-score-section",children:[u.jsx("h3",{children:"Final Score"}),u.jsxs("h4",{className:"results-label results-opponent-label",children:["Opponent (",i.charAt(0).toUpperCase()+i.slice(1),")"]}),u.jsxs("div",{className:"protocol-bars-container",children:[u.jsx("div",{className:"protocol-bar opponent-bar",children:a.opponent.protocols.map((s,f)=>u.jsxs("div",{className:c("protocol-display",a.opponent.compiled[f]),children:[u.jsx("span",{className:"protocol-name",children:s}),u.jsx("span",{className:"protocol-value",children:a.opponent.laneValues[f]})]},`opp-proto-${s}-${f}`))}),u.jsx("div",{className:"protocol-bar player-bar",children:a.player.protocols.map((s,f)=>u.jsxs("div",{className:c("protocol-display",a.player.compiled[f]),children:[u.jsx("span",{className:"protocol-name",children:s}),u.jsx("span",{className:"protocol-value",children:a.player.laneValues[f]})]},`player-proto-${s}-${f}`))})]}),u.jsx("h4",{className:"results-label results-player-label",children:"Player"})]}),u.jsxs("div",{className:"stats-section",children:[u.jsx("h3",{children:"Statistics"}),u.jsxs("div",{className:"stats-grid",children:[u.jsxs("div",{className:"stat-item",children:[u.jsx("span",{className:"stat-item-label",children:"Cards Played"}),u.jsx("span",{className:"stat-item-value opponent",children:a.stats.opponent.cardsPlayed}),u.jsx("span",{className:"stat-item-value player",children:a.stats.player.cardsPlayed})]}),u.jsxs("div",{className:"stat-item",children:[u.jsx("span",{className:"stat-item-label",children:"Cards Drawn"}),u.jsx("span",{className:"stat-item-value opponent",children:a.stats.opponent.cardsDrawn}),u.jsx("span",{className:"stat-item-value player",children:a.stats.player.cardsDrawn})]}),u.jsxs("div",{className:"stat-item",children:[u.jsx("span",{className:"stat-item-label",children:"Cards Discarded"}),u.jsx("span",{className:"stat-item-value opponent",children:a.stats.opponent.cardsDiscarded}),u.jsx("span",{className:"stat-item-value player",children:a.stats.player.cardsDiscarded})]}),u.jsxs("div",{className:"stat-item",children:[u.jsx("span",{className:"stat-item-label",children:"Cards Deleted"}),u.jsx("span",{className:"stat-item-value opponent",children:a.stats.opponent.cardsDeleted}),u.jsx("span",{className:"stat-item-value player",children:a.stats.player.cardsDeleted})]}),u.jsxs("div",{className:"stat-item",children:[u.jsx("span",{className:"stat-item-label",children:"Cards Flipped"}),u.jsx("span",{className:"stat-item-value opponent",children:a.stats.opponent.cardsFlipped}),u.jsx("span",{className:"stat-item-value player",children:a.stats.player.cardsFlipped})]}),u.jsxs("div",{className:"stat-item",children:[u.jsx("span",{className:"stat-item-label",children:"Cards Shifted"}),u.jsx("span",{className:"stat-item-value opponent",children:a.stats.opponent.cardsShifted}),u.jsx("span",{className:"stat-item-value player",children:a.stats.player.cardsShifted})]})]})]})]}),u.jsx("button",{className:"btn",onClick:t,children:"Play Again"})]})})}function Mw({onBack:t}){const[o,a]=J.useState(0);J.useEffect(()=>{tl(),a(b=>b+1)},[]);const i=J.useMemo(()=>{console.log("[Card Library] Loading cards, refreshKey:",o);const b=Nc(),E=b?er():[],S=[...wt,...E];return console.log("[Card Library] Total cards:",S.length,"(base:",wt.length,", custom:",E.length,", enabled:",b,")"),S},[o]),l=J.useMemo(()=>{const b=new Set(i.map(E=>E.protocol));return Array.from(b).sort()},[i]),[c,s]=J.useState(null),f=J.useMemo(()=>{const b=new Set(i.map(E=>E.category));return Array.from(b).sort()},[i]),[p,h]=J.useState(()=>new Set(f));J.useEffect(()=>{i.length>0&&!c&&s(i[0])},[i,c]);const y=b=>{h(E=>{const S=new Set(E);return S.has(b)?S.delete(b):S.add(b),S})},g=b=>{const E=i.find(S=>S.protocol===b);return(E==null?void 0:E.category)||""},v=J.useMemo(()=>l.filter(b=>{const E=g(b);return p.has(E)}),[l,p,i]),w=J.useMemo(()=>{const b={};for(const E of i)b[E.protocol]||(b[E.protocol]=[]),b[E.protocol].push(E);for(const E in b)b[E].sort((S,j)=>S.value-j.value);return b},[i]),C=b=>{s(b)},x=()=>{if(!c)return null;const b={...c,id:"preview",isFaceUp:!0};return u.jsx(nn,{card:b,isFaceUp:!0})};return u.jsxs("div",{className:"screen card-library-screen",children:[u.jsx(gd,{title:"Card Library",onBack:t}),u.jsxs("div",{className:"card-library-layout",children:[u.jsxs("div",{className:"game-preview-container",children:[u.jsx("h2",{children:"Card Preview"}),u.jsx("div",{className:"preview-card-area",children:x()})]}),u.jsxs("div",{className:"card-list-container",children:[u.jsx("div",{className:"category-filters",children:f.map(b=>u.jsxs("label",{className:"category-filter-item",children:[u.jsx("input",{type:"checkbox",checked:p.has(b),onChange:()=>y(b)}),u.jsx("span",{children:b})]},b))}),v.map(b=>u.jsxs("div",{className:"protocol-group",children:[u.jsxs("h3",{children:[b,u.jsxs("span",{className:"protocol-category-label",children:[" (",g(b),")"]})]}),u.jsx("div",{className:"protocol-card-grid",children:w[b].map(E=>{const S={...E,id:`${E.protocol}-${E.value}`,isFaceUp:!0};return u.jsx(nn,{card:S,isFaceUp:!0,additionalClassName:"in-hand",onPointerEnter:()=>C(E),onPointerDown:()=>C(E)},S.id)})})]},b))]})]})]})}function Hw({onBack:t}){const o=o_(),a=Cw(o),i=xw(o),l=Sw(o),c=bw(o),s=Ew(o),f=Rw(o),p=Aw(o);return u.jsxs("div",{className:"screen statistics-screen",children:[u.jsx(gd,{title:"STATISTICS",onBack:t}),u.jsxs("div",{className:"stats-content",children:[u.jsxs("section",{className:"stats-section",children:[u.jsx("h2",{className:"section-title",children:"Overview"}),u.jsxs("div",{className:"stats-grid",children:[u.jsxs("div",{className:"stat-item",children:[u.jsx("span",{className:"stat-label",children:"Games Played"}),u.jsx("span",{className:"stat-value",children:o.global.totalGamesPlayed})]}),u.jsxs("div",{className:"stat-item",children:[u.jsx("span",{className:"stat-label",children:"Win Rate"}),u.jsxs("span",{className:"stat-value",children:[a.toFixed(1),"%"]})]}),u.jsxs("div",{className:"stat-item",children:[u.jsx("span",{className:"stat-label",children:"Games Won"}),u.jsx("span",{className:"stat-value win",children:o.global.totalGamesWon})]}),u.jsxs("div",{className:"stat-item",children:[u.jsx("span",{className:"stat-label",children:"Games Lost"}),u.jsx("span",{className:"stat-value loss",children:o.global.totalGamesLost})]})]})]}),u.jsxs("section",{className:"stats-section",children:[u.jsx("h2",{className:"section-title",children:"Streaks"}),u.jsxs("div",{className:"stats-grid",children:[u.jsxs("div",{className:"stat-item",children:[u.jsx("span",{className:"stat-label",children:"Current Streak"}),u.jsx("span",{className:`stat-value ${o.global.currentStreak>0?"win":o.global.currentStreak<0?"loss":""}`,children:o.global.currentStreak>0?`+${o.global.currentStreak}`:o.global.currentStreak})]}),u.jsxs("div",{className:"stat-item",children:[u.jsx("span",{className:"stat-label",children:"Best Win Streak"}),u.jsx("span",{className:"stat-value win",children:o.global.longestWinStreak})]})]})]}),u.jsxs("section",{className:"stats-section",children:[u.jsx("h2",{className:"section-title",children:"Playtime"}),u.jsxs("div",{className:"stats-grid",children:[u.jsxs("div",{className:"stat-item",children:[u.jsx("span",{className:"stat-label",children:"Total Playtime"}),u.jsx("span",{className:"stat-value",children:Jr(o.global.totalPlaytime)})]}),u.jsxs("div",{className:"stat-item",children:[u.jsx("span",{className:"stat-label",children:"Average Game"}),u.jsx("span",{className:"stat-value",children:Jr(i)})]}),o.global.fastestWin&&u.jsxs("div",{className:"stat-item",children:[u.jsx("span",{className:"stat-label",children:"Fastest Win"}),u.jsx("span",{className:"stat-value",children:Jr(o.global.fastestWin)})]}),o.global.longestGame&&u.jsxs("div",{className:"stat-item",children:[u.jsx("span",{className:"stat-label",children:"Longest Game"}),u.jsx("span",{className:"stat-value",children:Jr(o.global.longestGame)})]}),o.global.lastGameDuration&&u.jsxs("div",{className:"stat-item",children:[u.jsx("span",{className:"stat-label",children:"Last Game"}),u.jsx("span",{className:"stat-value",children:Jr(o.global.lastGameDuration)})]})]})]}),u.jsxs("section",{className:"stats-section",children:[u.jsx("h2",{className:"section-title",children:"AI Performance"}),u.jsx("div",{className:"ai-stats",children:["easy","normal","hard"].map(h=>{const y=o.aiDifficulty[h],g=y.played>0?y.wins/y.played*100:0;return u.jsxs("div",{className:"ai-item",children:[u.jsx("span",{className:"ai-name",children:h}),u.jsxs("span",{className:"ai-record",children:[u.jsxs("span",{className:"win",children:[y.wins,"W"]})," - ",u.jsxs("span",{className:"loss",children:[y.losses,"L"]})]}),u.jsxs("span",{className:"ai-winrate",children:["(",g.toFixed(1),"%)"]})]},h)})})]}),c.length>0&&u.jsxs("section",{className:"stats-section",children:[u.jsx("h2",{className:"section-title",children:"Best Win Rate"}),u.jsx("div",{className:"protocol-list",children:c.map((h,y)=>u.jsxs("div",{className:"protocol-item",children:[u.jsxs("span",{className:"protocol-rank",children:[y+1,"."]}),u.jsx("span",{className:"protocol-name",children:h.protocol}),u.jsxs("span",{className:"protocol-stats win",children:[h.winRate.toFixed(0),"%  ",h.timesUsed]})]},h.protocol))})]}),l.length>0&&u.jsxs("section",{className:"stats-section",children:[u.jsx("h2",{className:"section-title",children:"Favorite Protocols"}),u.jsx("div",{className:"protocol-list",children:l.map((h,y)=>u.jsxs("div",{className:"protocol-item",children:[u.jsxs("span",{className:"protocol-rank",children:[y+1,"."]}),u.jsx("span",{className:"protocol-name",children:h.protocol}),u.jsxs("span",{className:"protocol-stats",children:[h.timesUsed,"  ",h.winRate.toFixed(0),"%"]})]},h.protocol))})]}),s.length>0&&u.jsxs("section",{className:"stats-section",children:[u.jsx("h2",{className:"section-title",children:"Least Used Protocols"}),u.jsx("div",{className:"protocol-list",children:s.map((h,y)=>u.jsxs("div",{className:"protocol-item",children:[u.jsxs("span",{className:"protocol-rank",children:[y+1,"."]}),u.jsx("span",{className:"protocol-name",children:h.protocol}),u.jsxs("span",{className:"protocol-stats",children:[h.timesUsed,"  ",h.winRate.toFixed(0),"%"]})]},h.protocol))})]}),f.length>0&&u.jsxs("section",{className:"stats-section",children:[u.jsx("h2",{className:"section-title",children:"Most Played Cards"}),u.jsx("div",{className:"card-list",children:f.map((h,y)=>u.jsxs("div",{className:"card-item",children:[u.jsxs("span",{className:"card-rank",children:[y+1,"."]}),u.jsx("span",{className:"card-name",children:h.card}),u.jsxs("span",{className:"card-count",children:[h.count,""]})]},h.card))})]}),p.length>0&&u.jsxs("section",{className:"stats-section",children:[u.jsx("h2",{className:"section-title",children:"Most Deleted Cards"}),u.jsx("div",{className:"card-list",children:p.map((h,y)=>u.jsxs("div",{className:"card-item",children:[u.jsxs("span",{className:"card-rank",children:[y+1,"."]}),u.jsx("span",{className:"card-name",children:h.card}),u.jsxs("span",{className:"card-count",children:[h.count,""]})]},h.card))})]}),u.jsxs("section",{className:"stats-section",children:[u.jsx("h2",{className:"section-title",children:"Control Mechanic"}),u.jsxs("div",{className:"stats-grid",children:[u.jsxs("div",{className:"stat-item",children:[u.jsx("span",{className:"stat-label",children:"With Control"}),u.jsx("span",{className:"stat-value",children:o.control.gamesWithControl})]}),u.jsxs("div",{className:"stat-item",children:[u.jsx("span",{className:"stat-label",children:"Without Control"}),u.jsx("span",{className:"stat-value",children:o.control.gamesWithoutControl})]}),u.jsxs("div",{className:"stat-item",children:[u.jsx("span",{className:"stat-label",children:"Your Rearranges"}),u.jsx("span",{className:"stat-value",children:o.control.playerRearranges})]}),u.jsxs("div",{className:"stat-item",children:[u.jsx("span",{className:"stat-label",children:"AI Rearranges"}),u.jsx("span",{className:"stat-value",children:o.control.aiRearranges})]}),u.jsxs("div",{className:"stat-item",children:[u.jsx("span",{className:"stat-label",children:"Total Rearranges"}),u.jsx("span",{className:"stat-value",children:o.control.totalRearranges})]})]})]}),u.jsxs("section",{className:"stats-section",children:[u.jsx("h2",{className:"section-title",children:"Coin Flip"}),u.jsxs("div",{className:"stats-grid",children:[u.jsxs("div",{className:"stat-item",children:[u.jsx("span",{className:"stat-label",children:"Heads Chosen"}),u.jsxs("span",{className:"stat-value",children:[o.coinFlip.headsChosen," (",o.coinFlip.headsChosen>0?(o.coinFlip.headsWon/o.coinFlip.headsChosen*100).toFixed(0):0,"%)"]})]}),u.jsxs("div",{className:"stat-item",children:[u.jsx("span",{className:"stat-label",children:"Tails Chosen"}),u.jsxs("span",{className:"stat-value",children:[o.coinFlip.tailsChosen," (",o.coinFlip.tailsChosen>0?(o.coinFlip.tailsWon/o.coinFlip.tailsChosen*100).toFixed(0):0,"%)"]})]})]})]}),u.jsxs("section",{className:"stats-section full-width",children:[u.jsx("h2",{className:"section-title",children:"Actions"}),u.jsxs("div",{className:"stats-grid",style:{gridTemplateColumns:"repeat(4, 1fr)"},children:[u.jsxs("div",{className:"stat-item",children:[u.jsx("span",{className:"stat-label",children:"Cards Played"}),u.jsx("span",{className:"stat-value",children:o.actions.totalCardsPlayed})]}),u.jsxs("div",{className:"stat-item",children:[u.jsx("span",{className:"stat-label",children:"Cards Drawn"}),u.jsx("span",{className:"stat-value",children:o.actions.totalCardsDrawn})]}),u.jsxs("div",{className:"stat-item",children:[u.jsx("span",{className:"stat-label",children:"Discards"}),u.jsx("span",{className:"stat-value",children:o.actions.totalDiscards})]}),u.jsxs("div",{className:"stat-item",children:[u.jsx("span",{className:"stat-label",children:"Deletes"}),u.jsx("span",{className:"stat-value",children:o.actions.totalDeletes})]}),u.jsxs("div",{className:"stat-item",children:[u.jsx("span",{className:"stat-label",children:"Flips"}),u.jsx("span",{className:"stat-value",children:o.actions.totalFlips})]}),u.jsxs("div",{className:"stat-item",children:[u.jsx("span",{className:"stat-label",children:"Shifts"}),u.jsx("span",{className:"stat-value",children:o.actions.totalShifts})]}),u.jsxs("div",{className:"stat-item",children:[u.jsx("span",{className:"stat-label",children:"Compiles"}),u.jsx("span",{className:"stat-value",children:o.actions.totalCompiles})]}),u.jsxs("div",{className:"stat-item",children:[u.jsx("span",{className:"stat-label",children:"Refreshes"}),u.jsx("span",{className:"stat-value",children:o.actions.totalRefreshes})]})]})]})]})]})}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const P_="custom_protocols_v1",_d=1,$c=()=>{try{const t=localStorage.getItem(P_);if(!t)return[];const o=JSON.parse(t);return o.version!==_d&&console.warn(`Custom protocol storage version mismatch: expected ${_d}, got ${o.version}`),o.protocols||[]}catch(t){return console.error("Error loading custom protocols:",t),[]}},I_=t=>{try{const o={protocols:t,version:_d};localStorage.setItem(P_,JSON.stringify(o))}catch(o){console.error("Error saving custom protocols:",o)}},fn=t=>{const o=$c(),a=o.findIndex(i=>i.id===t.id);a>=0?o[a]=t:o.push(t),I_(o)},Bw=t=>{const a=$c().filter(i=>i.id!==t);I_(a)},Vw=(t,o)=>{const a=(l,c)=>{l=l.replace("#","");const s=parseInt(l.substring(0,2),16),f=parseInt(l.substring(2,4),16),p=parseInt(l.substring(4,6),16);return`rgba(${s}, ${f}, ${p}, ${c})`},i={borderColor:o};switch(t){case"solid":return{...i,backgroundColor:o};case"radial":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`radial-gradient(circle at 50% 50%, ${a(o,.25)} 0%, transparent 60%)`};case"dual-radial":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 0% 0%, ${a(o,.2)}, transparent 50%),
                    radial-gradient(at 100% 100%, ${a(o,.2)}, transparent 50%)
                `};case"multi-radial":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 0%, ${a(o,.2)}, transparent 70%),
                    radial-gradient(circle at 20% 30%, ${a(o,.15)}, transparent 40%),
                    radial-gradient(circle at 80% 70%, ${a(o,.2)}, transparent 50%)
                `};case"chaos":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 10% 10%, hsla(60, 100%, 50%, 0.15), transparent 30%),
                    radial-gradient(at 90% 20%, hsla(180, 100%, 50%, 0.15), transparent 35%),
                    radial-gradient(at 30% 80%, hsla(300, 100%, 50%, 0.15), transparent 40%),
                    radial-gradient(at 70% 60%, hsla(0, 100%, 50%, 0.1), transparent 25%)
                `};case"grid":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(circle at 50% 50%, ${a(o,.2)} 0%, transparent 40%),
                    linear-gradient(hsla(0,0%,100%,0.03) 1px, transparent 1px),
                    linear-gradient(90deg, hsla(0,0%,100%,0.03) 1px, transparent 1px)
                `,backgroundSize:"100% 100%, 20px 20px, 20px 20px"};case"diagonal-lines":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 0% 100%, ${a(o,.25)}, transparent 70%),
                    repeating-linear-gradient(120deg, transparent, transparent 15px, ${a(o,.05)} 15px, ${a(o,.05)} 30px)
                `};case"cross-diagonal":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 50%, ${a(o,.25)} 0%, transparent 50%),
                    repeating-linear-gradient(45deg, transparent, transparent 8px, ${a(o,.08)} 8px, ${a(o,.08)} 16px),
                    repeating-linear-gradient(-45deg, transparent, transparent 8px, ${a(o,.06)} 8px, ${a(o,.06)} 16px)
                `};case"horizontal-lines":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 80% 80%, ${a(o,.1)}, transparent 50%),
                    repeating-linear-gradient(0deg, hsla(0,0%,100%,0.02), hsla(0,0%,100%,0.02) 1px, transparent 1px, transparent 3px)
                `};case"vertical-lines":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 10% 10%, ${a(o,.2)}, transparent 50%),
                    repeating-linear-gradient(175deg, transparent, transparent 1px, ${a(o,.05)} 1px, ${a(o,.05)} 2px)
                `};case"cross":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    linear-gradient(0deg, transparent 40%, ${a(o,.1)} 50%, transparent 60%),
                    linear-gradient(90deg, transparent 48%, ${a(o,.2)} 50%, transparent 52%)
                `};case"hexagons":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 0%, ${a(o,.2)}, transparent 70%),
                    url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='28' height='49' viewBox='0 0 28 49'%3E%3Cg fill-rule='evenodd'%3E%3Cg id='hexagons' fill='${encodeURIComponent(o)}' fill-opacity='0.05' fill-rule='nonzero'%3E%3Cpath d='M13.99 9.25l13 7.5v15l-13 7.5L1 31.75v-15l12.99-7.5zM3 17.9v12.7l10.99 6.34 11-6.35V17.9l-11-6.34L3 17.9zM0 15l12.99-7.5L26 15v18.5l-13 7.5L0 33.5V15z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")
                `};case"stripes":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 100%, ${a(o,.25)}, transparent 60%),
                    linear-gradient(135deg, hsla(0,0%,0%,0.1) 23%, transparent 23%, transparent 25%, hsla(0,0%,0%,0.1) 25%, hsla(0,0%,0%,0.1) 27%, transparent 27%, transparent 73%, hsla(0,0%,0%,0.1) 73%, hsla(0,0%,0%,0.1) 75%, transparent 75%, transparent 77%, hsla(0,0%,0%,0.1) 77%)
                `};default:return{...i,backgroundColor:o}}},zw=({protocols:t,onCreateNew:o,onEdit:a,onDelete:i,onBack:l})=>{const[c,s]=Ji.useState(!1),[f,p]=Ji.useState(""),[h,y]=Ji.useState(""),g=()=>{y("");try{const v=JSON.parse(f);if(!v.name||!v.color||!v.pattern||!Array.isArray(v.cards)){y("Invalid protocol format. Missing required fields.");return}if(v.cards.length!==6){y("Invalid protocol: must have exactly 6 cards.");return}const w=t.find(C=>C.name.toLowerCase()===v.name.toLowerCase());if(w){confirm(`A protocol named "${v.name}" already exists. Overwrite it?`)&&(v.id=w.id,onImport(v),s(!1),p(""),alert("Protocol imported and overwritten successfully!"));return}v.id=Date.now().toString(),v.createdAt=new Date().toISOString(),onImport(v),s(!1),p(""),alert("Protocol imported successfully!")}catch{y("Invalid JSON format. Please check your input.")}};return u.jsxs("div",{className:"protocol-list",children:[u.jsxs("div",{className:"list-header",children:[u.jsx("h2",{children:"Custom Protocols"}),u.jsxs("div",{className:"header-actions",children:[u.jsx("button",{onClick:()=>s(!0),className:"btn",children:"Import Protocol"}),l&&u.jsx("button",{onClick:l,className:"btn btn-back",children:"Back"})]})]}),c&&u.jsx("div",{className:"custom-protocol-modal-overlay",onClick:()=>s(!1),children:u.jsxs("div",{className:"custom-protocol-modal-content",onClick:v=>v.stopPropagation(),children:[u.jsx("h3",{children:"Import Protocol"}),u.jsx("p",{children:"Paste the protocol JSON below:"}),u.jsx("textarea",{value:f,onChange:v=>p(v.target.value),placeholder:'{"name":"Protocol Name","color":"#1976D2",...}',rows:10,className:"import-textarea"}),h&&u.jsx("div",{className:"error-message",children:h}),u.jsxs("div",{className:"custom-protocol-modal-actions",children:[u.jsx("button",{onClick:()=>s(!1),className:"btn btn-back",children:"Cancel"}),u.jsx("button",{onClick:g,className:"btn",children:"Import"})]})]})}),u.jsxs("div",{className:"protocols-grid",children:[u.jsxs("div",{className:"protocol-card new-protocol-card",onClick:o,children:[u.jsx("div",{className:"protocol-header new-protocol-header",children:u.jsxs("div",{className:"protocol-header-content",children:[u.jsx("h3",{children:"+ New Protocol"}),u.jsx("p",{className:"header-description",children:"Create a custom protocol"})]})}),u.jsx("div",{className:"protocol-body new-protocol-body"})]}),t.map(v=>u.jsx("div",{className:"protocol-card",style:Vw(v.pattern,v.color),onClick:()=>a(v),children:u.jsxs("div",{className:"protocol-header-content",children:[u.jsx("h3",{children:v.name}),v.description&&u.jsx("p",{className:"header-description",children:v.description})]})},v.id))]})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const M_=({params:t,onChange:o})=>{var a,i,l,c;return u.jsxs("div",{className:"param-editor draw-effect-editor",children:[u.jsx("h4",{children:"Draw Effect Parameters"}),u.jsxs("label",{children:["Count Type",u.jsxs("select",{value:t.countType||"fixed",onChange:s=>{const f=s.target.value;o({...t,countType:f,countOffset:f==="equal_to_discarded"?0:void 0})},children:[u.jsx("option",{value:"fixed",children:"Fixed Amount"}),u.jsx("option",{value:"equal_to_card_value",children:"Equal to Card Value (from previous effect)"}),u.jsx("option",{value:"equal_to_discarded",children:"Equal to Discarded Cards"}),u.jsx("option",{value:"hand_size",children:"Equal to Hand Size"})]})]}),(!t.countType||t.countType==="fixed")&&u.jsxs("label",{children:["Card Count",u.jsx("input",{type:"number",min:1,max:6,value:t.count,onChange:s=>o({...t,count:parseInt(s.target.value)||1})})]}),t.countType==="equal_to_discarded"&&u.jsxs("label",{children:["Offset (+/-)",u.jsx("input",{type:"number",min:-5,max:5,value:t.countOffset||0,onChange:s=>o({...t,countOffset:parseInt(s.target.value)||0})}),u.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:'Example: +1 for "discard count plus 1" (Fire-4)'})]}),u.jsxs("label",{children:["Target",u.jsxs("select",{value:t.target,onChange:s=>o({...t,target:s.target.value}),children:[u.jsx("option",{value:"self",children:"Self"}),u.jsx("option",{value:"opponent",children:"Opponent"})]})]}),u.jsxs("label",{children:["Source",u.jsxs("select",{value:t.source,onChange:s=>o({...t,source:s.target.value}),children:[u.jsx("option",{value:"own_deck",children:"Own Deck"}),u.jsx("option",{value:"opponent_deck",children:"Opponent's Deck"})]})]}),u.jsxs("label",{children:[u.jsx("input",{type:"checkbox",checked:t.preAction==="refresh",onChange:s=>o({...t,preAction:s.target.checked?"refresh":void 0})}),"Refresh hand first (shuffle hand into deck, then draw)"]}),u.jsxs("label",{children:[u.jsx("input",{type:"checkbox",checked:t.optional||!1,onChange:s=>o({...t,optional:s.target.checked})}),'Optional ("You may draw" instead of "Draw")']}),u.jsxs("label",{children:["Conditional",u.jsxs("select",{value:((a=t.conditional)==null?void 0:a.type)||"none",onChange:s=>{if(s.target.value==="none"){const{conditional:f,...p}=t;o(p)}else o({...t,conditional:{type:s.target.value}})},children:[u.jsx("option",{value:"none",children:"None"}),u.jsx("option",{value:"count_face_down",children:"1 per face-down card (all on board)"}),u.jsx("option",{value:"is_covering",children:"Only if this card is covering another"}),u.jsx("option",{value:"non_matching_protocols",children:"1 per line with non-matching protocol"})]})]}),u.jsxs("label",{children:["Advanced Conditional",u.jsxs("select",{value:((i=t.advancedConditional)==null?void 0:i.type)||"none",onChange:s=>{if(s.target.value==="none"){const{advancedConditional:f,...p}=t;o(p)}else s.target.value==="protocol_match"?o({...t,advancedConditional:{type:"protocol_match",protocol:""}}):s.target.value==="compile_block"&&o({...t,advancedConditional:{type:"compile_block",turnDuration:1}})},children:[u.jsx("option",{value:"none",children:"None"}),u.jsx("option",{value:"protocol_match",children:"Only if in line with matching protocol (Anarchy-6)"}),u.jsx("option",{value:"compile_block",children:"Block opponent's compile next turn (Metal-1)"})]})]}),((l=t.advancedConditional)==null?void 0:l.type)==="protocol_match"&&u.jsxs("label",{children:["Required Protocol",u.jsx("input",{type:"text",placeholder:"e.g., Fire, Water, Lightning",value:t.advancedConditional.protocol||"",onChange:s=>o({...t,advancedConditional:{...t.advancedConditional,type:"protocol_match",protocol:s.target.value}})}),u.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"Only draw if this card is in a line with this protocol"})]}),((c=t.advancedConditional)==null?void 0:c.type)==="compile_block"&&u.jsxs("label",{children:["Block Duration (turns)",u.jsx("input",{type:"number",min:1,max:3,value:t.advancedConditional.turnDuration||1,onChange:s=>o({...t,advancedConditional:{...t.advancedConditional,type:"compile_block",turnDuration:parseInt(s.target.value)||1}})}),u.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"Opponent can't compile for this many turns"})]}),u.jsxs("div",{className:"effect-preview",children:[u.jsx("strong",{children:"Preview:"})," ",Gw(t)]})]})},Gw=t=>{if(t.conditional)switch(t.conditional.type){case"count_face_down":return"Draw 1 card for each face-down card.";case"is_covering":return`Draw ${t.count} card${t.count!==1?"s":""} if this card is covering another.`;case"non_matching_protocols":return"Draw 1 card for each line with a non-matching protocol."}let o="";t.preAction==="refresh"&&(o="Refresh your hand. ");const a=t.countType||"fixed";let i="";switch(a){case"equal_to_card_value":i="cards equal to that card's value";break;case"equal_to_discarded":const l=t.countOffset||0;l>0?i=`the amount discarded plus ${l}`:l<0?i=`the amount discarded minus ${Math.abs(l)}`:i="the same amount of cards";break;case"hand_size":i="the same amount of cards";break;default:i=`${t.count} card${t.count!==1?"s":""}`;break}if(t.source==="opponent_deck"?o+=`Draw ${i} from opponent's deck.`:t.target==="opponent"?o+=`Opponent draws ${i}.`:o+=`Draw ${i}.`,t.advancedConditional)switch(t.advancedConditional.type){case"protocol_match":const l=t.advancedConditional.protocol||"[Protocol]";o+=` Only if in ${l} line.`;break;case"compile_block":const c=t.advancedConditional.turnDuration||1;o+=` Opponent can't compile for ${c} ${c===1?"turn":"turns"}.`;break}return o};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Yw=({params:t,onChange:o})=>u.jsxs("div",{className:"param-editor refresh-effect-editor",children:[u.jsx("h4",{children:"Refresh Effect Parameters"}),u.jsx("p",{className:"effect-description",children:'Refresh fills the hand to 5 cards (Spirit-0: "Refresh.")'}),u.jsxs("label",{children:["Target",u.jsxs("select",{value:t.target||"self",onChange:a=>o({...t,target:a.target.value}),children:[u.jsx("option",{value:"self",children:"Self"}),u.jsx("option",{value:"opponent",children:"Opponent"})]})]})]});/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Ww=({params:t,onChange:o})=>u.jsxs("div",{className:"param-editor mutual-draw-effect-editor",children:[u.jsx("h4",{children:"Mutual Draw Effect Parameters"}),u.jsx("p",{className:"effect-description",children:`Both players draw from each other's decks (Chaos-0: "Draw the top card of your opponent's deck. Your opponent draws the top card of your deck.")`}),u.jsxs("label",{children:["Count",u.jsx("input",{type:"number",min:"1",max:"10",value:t.count||1,onChange:a=>o({...t,count:parseInt(a.target.value)||1})})]})]});/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const H_=({params:t,onChange:o})=>{var i,l;const a=t.targetFilter||{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1};return u.jsxs("div",{className:"param-editor flip-effect-editor",children:[u.jsx("h4",{children:"Flip Effect Parameters"}),u.jsxs("label",{children:["Card Count/Scope",u.jsxs("select",{value:t.count==="all"?"all":t.count==="each"?"each":t.count.toString(),onChange:c=>{const s=c.target.value;o(s==="all"?{...t,count:"all"}:s==="each"?{...t,count:"each"}:{...t,count:parseInt(s)})},children:[u.jsx("option",{value:"1",children:"1 card"}),u.jsx("option",{value:"2",children:"2 cards"}),u.jsx("option",{value:"3",children:"3 cards"}),u.jsx("option",{value:"all",children:"All matching cards"}),u.jsx("option",{value:"each",children:"Each matching card"})]})]}),typeof t.count=="number"&&u.jsxs("label",{children:["Scope",u.jsxs("select",{value:t.scope||"any",onChange:c=>o({...t,scope:c.target.value}),children:[u.jsx("option",{value:"any",children:"Any lane"}),u.jsx("option",{value:"this_lane",children:"This lane only"}),u.jsx("option",{value:"each_lane",children:'Each lane (Chaos-0: "In each line...")'})]})]}),u.jsxs("label",{children:[u.jsx("input",{type:"checkbox",checked:t.optional,onChange:c=>o({...t,optional:c.target.checked})}),'Optional ("May flip" instead of "Flip")']}),t.count==="each"&&u.jsxs("label",{children:["Each Line Scope",u.jsxs("select",{value:t.eachLineScope||"all_lines",onChange:c=>o({...t,eachLineScope:c.target.value}),children:[u.jsx("option",{value:"all_lines",children:"Each card on board"}),u.jsx("option",{value:"each_line",children:"1 card in each line"})]})]}),u.jsxs("label",{children:[u.jsx("input",{type:"checkbox",checked:t.selfFlipAfter||!1,onChange:c=>o({...t,selfFlipAfter:c.target.checked})}),"Then flip this card"]}),u.jsxs("label",{children:[u.jsx("input",{type:"checkbox",checked:t.flipSelf||!1,onChange:c=>o({...t,flipSelf:c.target.checked})}),"Flip this card (instead of selecting target)"]}),u.jsx("h5",{children:"Advanced Conditional"}),u.jsxs("label",{children:["Conditional Type",u.jsxs("select",{value:((i=t.advancedConditional)==null?void 0:i.type)||"",onChange:c=>{if(c.target.value===""){const{advancedConditional:s,...f}=t;o(f)}else o({...t,advancedConditional:{type:c.target.value}})},children:[u.jsx("option",{value:"",children:"None"}),u.jsx("option",{value:"protocol_match",children:"Only if in specific protocol line"})]})]}),((l=t.advancedConditional)==null?void 0:l.type)==="protocol_match"&&u.jsxs("label",{children:["Required Protocol",u.jsx("input",{type:"text",value:t.advancedConditional.protocol||"",onChange:c=>o({...t,advancedConditional:{...t.advancedConditional,protocol:c.target.value}}),placeholder:"e.g., Anarchy, Fire, Death"})]}),u.jsx("h5",{children:"Target Filter"}),u.jsxs("label",{children:["Owner",u.jsxs("select",{value:a.owner,onChange:c=>o({...t,targetFilter:{...a,owner:c.target.value}}),children:[u.jsx("option",{value:"any",children:"Any"}),u.jsx("option",{value:"own",children:"Own"}),u.jsx("option",{value:"opponent",children:"Opponent"})]})]}),u.jsxs("label",{children:["Position",u.jsxs("select",{value:a.position,onChange:c=>o({...t,targetFilter:{...a,position:c.target.value}}),children:[u.jsx("option",{value:"any",children:"Any"}),u.jsx("option",{value:"uncovered",children:"Uncovered (top card)"}),u.jsx("option",{value:"covered",children:"Covered"}),u.jsx("option",{value:"covered_in_this_line",children:"Covered in this line"})]})]}),u.jsxs("label",{children:["Face State",u.jsxs("select",{value:a.faceState,onChange:c=>o({...t,targetFilter:{...a,faceState:c.target.value}}),children:[u.jsx("option",{value:"any",children:"Any"}),u.jsx("option",{value:"face_up",children:"Face-up"}),u.jsx("option",{value:"face_down",children:"Face-down"})]})]}),u.jsxs("label",{children:[u.jsx("input",{type:"checkbox",checked:a.excludeSelf,onChange:c=>o({...t,targetFilter:{...a,excludeSelf:c.target.checked}})}),'Exclude self ("other cards")']}),u.jsxs("div",{className:"effect-preview",children:[u.jsx("strong",{children:"Preview:"})," ",Qw(t)]})]})},Qw=t=>{var f;if(t.flipSelf){let p=t.optional?"May flip this card":"Flip this card";return((f=t.advancedConditional)==null?void 0:f.type)==="protocol_match"&&(p+=`, if this card is in the line with the ${t.advancedConditional.protocol||"[Protocol]"} protocol`),p+=".",p}const o=t.targetFilter||{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1},a=t.optional?"May flip":"Flip";let i="";o.owner==="opponent"&&(i="opponent's "),o.position==="covered"&&(i+="covered "),o.position==="uncovered"&&(i+="uncovered "),o.faceState==="face_down"&&(i+="face-down "),o.faceState==="face_up"&&(i+="face-up "),o.excludeSelf&&(i+="other ");let l="";t.count==="all"?l="all":t.count==="each"?t.eachLineScope==="each_line"?(l="1",i=i+"(in each line) "):l="each":l=t.count.toString();const c=t.count===1?"card":"cards";let s=`${a} ${l} ${i}${c}`;return t.scope==="this_lane"?s+=" in this line":t.scope==="each_lane"&&(s=`In each line, ${a.toLowerCase()} ${l} ${i}${c}`),s+=".",t.selfFlipAfter&&(s+=" Then flip this card."),s};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const B_=({params:t,onChange:o})=>{var a;return u.jsxs("div",{className:"param-editor",children:[u.jsx("h4",{children:"Shift Effect"}),u.jsxs("label",{children:["Count/Scope",u.jsxs("select",{value:t.count==="all"?"all":"1",onChange:i=>{if(i.target.value==="all")o({...t,count:"all"});else{const{count:l,...c}=t;o(c)}},children:[u.jsx("option",{value:"1",children:"1 card"}),u.jsx("option",{value:"all",children:"All matching cards"})]})]}),u.jsxs("label",{children:["Target Owner",u.jsxs("select",{value:t.targetFilter.owner,onChange:i=>o({...t,targetFilter:{...t.targetFilter,owner:i.target.value}}),children:[u.jsx("option",{value:"any",children:"Any"}),u.jsx("option",{value:"own",children:"Own"}),u.jsx("option",{value:"opponent",children:"Opponent"})]})]}),u.jsxs("label",{children:["Position",u.jsxs("select",{value:t.targetFilter.position,onChange:i=>o({...t,targetFilter:{...t.targetFilter,position:i.target.value}}),children:[u.jsx("option",{value:"any",children:"Any"}),u.jsx("option",{value:"uncovered",children:"Uncovered"}),u.jsx("option",{value:"covered",children:"Covered"})]})]}),u.jsxs("label",{children:["Face State",u.jsxs("select",{value:t.targetFilter.faceState,onChange:i=>o({...t,targetFilter:{...t.targetFilter,faceState:i.target.value}}),children:[u.jsx("option",{value:"any",children:"Any"}),u.jsx("option",{value:"face_up",children:"Face-up"}),u.jsx("option",{value:"face_down",children:"Face-down"})]})]}),u.jsxs("label",{children:[u.jsx("input",{type:"checkbox",checked:t.targetFilter.excludeSelf||!1,onChange:i=>o({...t,targetFilter:{...t.targetFilter,excludeSelf:i.target.checked}})}),'Exclude self ("other card")']}),u.jsxs("label",{children:[u.jsx("input",{type:"checkbox",checked:t.optional||!1,onChange:i=>o({...t,optional:i.target.checked})}),'Optional ("You may shift" instead of "Shift")']}),u.jsxs("label",{children:["Destination",u.jsxs("select",{value:((a=t.destinationRestriction)==null?void 0:a.type)||"any",onChange:i=>{if(i.target.value==="any"){const{destinationRestriction:l,...c}=t;o(c)}else o({...t,destinationRestriction:{type:i.target.value}})},children:[u.jsx("option",{value:"any",children:"Any line"}),u.jsx("option",{value:"to_another_line",children:"To another line"}),u.jsx("option",{value:"non_matching_protocol",children:"Non-matching protocol"}),u.jsx("option",{value:"specific_lane",children:"This line (within)"})]})]}),u.jsxs("div",{className:"effect-preview",children:[u.jsx("strong",{children:"Preview:"})," ",Xw(t)]})]})},Xw=t=>{var s,f,p;const o=t.optional?"You may shift":"Shift";let a="";t.targetFilter.owner==="opponent"&&(a+="opponent's "),t.targetFilter.excludeSelf&&(a+="other "),t.targetFilter.position==="covered"&&(a+="covered "),t.targetFilter.position==="uncovered"&&(a+="uncovered "),t.targetFilter.faceState==="face_down"&&(a+="face-down "),t.targetFilter.faceState==="face_up"&&(a+="face-up ");const i=t.count==="all"?"all":"1";let c=`${o} ${i} ${a}${i==="1"?"card":"cards"}`;return((s=t.destinationRestriction)==null?void 0:s.type)==="non_matching_protocol"?c+=" to a line without a matching protocol":((f=t.destinationRestriction)==null?void 0:f.type)==="specific_lane"?c+=" within this line":((p=t.destinationRestriction)==null?void 0:p.type)==="to_another_line"&&(c+=" to another line"),c+"."};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const V_=({params:t,onChange:o})=>{var i,l,c,s,f;const a=t.targetFilter||{position:"uncovered",faceState:"any"};return u.jsxs("div",{className:"param-editor delete-effect-editor",children:[u.jsx("h4",{children:"Delete Effect Parameters"}),u.jsxs("label",{children:["Anzahl",u.jsxs("select",{value:typeof t.count=="number"?t.count.toString():"all",onChange:p=>o({...t,count:p.target.value==="all"?"all_in_lane":parseInt(p.target.value)}),children:[u.jsx("option",{value:"1",children:"1"}),u.jsx("option",{value:"2",children:"2"}),u.jsx("option",{value:"3",children:"3"}),u.jsx("option",{value:"all",children:"Alle in einer Lane"})]})]}),u.jsxs("label",{children:[u.jsx("input",{type:"checkbox",checked:t.excludeSelf,onChange:p=>o({...t,excludeSelf:p.target.checked})}),"Exclude self (other cards only)"]}),u.jsxs("label",{children:[u.jsx("input",{type:"checkbox",checked:t.deleteSelf||!1,onChange:p=>o({...t,deleteSelf:p.target.checked})}),"Delete this card (ignores all other settings)"]}),u.jsx("h5",{children:"Target Filter"}),u.jsxs("label",{children:["Position",u.jsxs("select",{value:a.position,onChange:p=>o({...t,targetFilter:{...a,position:p.target.value}}),children:[u.jsx("option",{value:"any",children:"Any"}),u.jsx("option",{value:"uncovered",children:"Uncovered"}),u.jsx("option",{value:"covered",children:"Covered"})]})]}),u.jsxs("label",{children:["Face State",u.jsxs("select",{value:a.faceState,onChange:p=>o({...t,targetFilter:{...a,faceState:p.target.value}}),children:[u.jsx("option",{value:"any",children:"Any"}),u.jsx("option",{value:"face_up",children:"Face-up"}),u.jsx("option",{value:"face_down",children:"Face-down"})]})]}),u.jsxs("label",{children:["Owner",u.jsxs("select",{value:a.owner||"any",onChange:p=>{const h=p.target.value,y={...a};h==="any"?delete y.owner:y.owner=h,o({...t,targetFilter:y})},children:[u.jsx("option",{value:"any",children:"Any (own or opponent)"}),u.jsx("option",{value:"own",children:"Own cards only"}),u.jsx("option",{value:"opponent",children:"Opponent's cards only"})]})]}),u.jsxs("label",{children:["Calculation",u.jsxs("select",{value:a.calculation||"none",onChange:p=>{const h=p.target.value,y={...a};h==="none"?delete y.calculation:y.calculation=h,o({...t,targetFilter:y})},children:[u.jsx("option",{value:"none",children:"None"}),u.jsx("option",{value:"highest_value",children:"Highest value"}),u.jsx("option",{value:"lowest_value",children:"Lowest value"})]})]}),u.jsxs("label",{children:["Value Range (specific values to target)",u.jsxs("select",{value:a.valueRange?`${a.valueRange.min}-${a.valueRange.max}`:"none",onChange:p=>{const h=p.target.value,y={...a};h==="none"?delete y.valueRange:h==="0-1"?y.valueRange={min:0,max:1}:h==="1-2"?y.valueRange={min:1,max:2}:h==="0-0"&&(y.valueRange={min:0,max:0}),o({...t,targetFilter:y})},children:[u.jsx("option",{value:"none",children:"Any value"}),u.jsx("option",{value:"0-0",children:"Value 0 only"}),u.jsx("option",{value:"0-1",children:"Values 0 or 1"}),u.jsx("option",{value:"1-2",children:"Values 1 or 2"})]})]}),u.jsx("h5",{children:"Scope"}),u.jsxs("label",{children:["Lane Scope",u.jsxs("select",{value:((i=t.scope)==null?void 0:i.type)||"any",onChange:p=>{const h=p.target.value;if(h==="any"){const{scope:y,...g}=t;o(g)}else o({...t,scope:{type:h}})},children:[u.jsx("option",{value:"any",children:"Any lane"}),u.jsx("option",{value:"this_line",children:"This line only"}),u.jsx("option",{value:"other_lanes",children:"Other lanes"}),u.jsx("option",{value:"each_other_line",children:"Each other line (1 per line)"}),u.jsx("option",{value:"each_lane",children:"Each lane (flexible, 1 per line)"})]})]}),(((l=t.scope)==null?void 0:l.type)==="other_lanes"||((c=t.scope)==null?void 0:c.type)==="any")&&u.jsxs("label",{children:["Minimum Cards in Lane",u.jsxs("select",{value:((s=t.scope)==null?void 0:s.minCardsInLane)||0,onChange:p=>{const h=parseInt(p.target.value);if(h===0){const y={...t.scope};delete y.minCardsInLane,o({...t,scope:y})}else o({...t,scope:{...t.scope,minCardsInLane:h}})},children:[u.jsx("option",{value:0,children:"No minimum"}),u.jsx("option",{value:8,children:"8 or more cards (Metal-3)"}),u.jsx("option",{value:6,children:"6 or more cards"}),u.jsx("option",{value:4,children:"4 or more cards"})]}),((f=t.scope)==null?void 0:f.minCardsInLane)&&u.jsxs("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:["Only delete from lanes with ",t.scope.minCardsInLane,"+ cards total."]})]}),u.jsxs("label",{children:["Who Chooses Target?",u.jsxs("select",{value:t.actorChooses||"effect_owner",onChange:p=>{const h=p.target.value;if(h==="effect_owner"){const{actorChooses:y,...g}=t;o(g)}else o({...t,actorChooses:h})},children:[u.jsx("option",{value:"effect_owner",children:"Effect owner chooses (default)"}),u.jsx("option",{value:"card_owner",children:"Card owner chooses (Plague-4: opponent deletes their own)"})]}),t.actorChooses==="card_owner"&&u.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"The owner of the targeted card chooses which card to delete."})]}),u.jsxs("div",{className:"effect-preview",children:[u.jsx("strong",{children:"Preview:"})," ",Zw(t)]})]})},Zw=t=>{var l,c,s,f,p,h;let o="Delete ";t.count==="all_in_lane"?o+="all ":o+=`${t.count} `;const a=t.targetFilter||{position:"uncovered",faceState:"any"};a.calculation==="highest_value"?o+="highest value ":a.calculation==="lowest_value"&&(o+="lowest value "),a.valueRange&&(o+=`value ${a.valueRange.min}-${a.valueRange.max} `),a.position==="covered"?o+="covered ":a.position==="uncovered"&&(o+="uncovered "),a.faceState==="face_down"?o+="face-down ":a.faceState==="face_up"&&(o+="face-up ");const i=t.count===1?"card":"cards";return o+=i,((l=t.scope)==null?void 0:l.type)==="this_line"?o+=" in this line":((c=t.scope)==null?void 0:c.type)==="other_lanes"?(o+=" in other lanes",t.scope.minCardsInLane&&(o+=` with ${t.scope.minCardsInLane}+ cards`)):((s=t.scope)==null?void 0:s.type)==="each_other_line"||((f=t.scope)==null?void 0:f.type)==="each_other_line"?o+=" from each other line":((p=t.scope)==null?void 0:p.type)==="each_lane"?o=`In each line, ${o.toLowerCase()}`:((h=t.scope)==null?void 0:h.type)==="any"&&t.scope.minCardsInLane&&(o+=` in lanes with ${t.scope.minCardsInLane}+ cards`),a.owner==="own"?o+=" (your cards)":a.owner==="opponent"&&(o+=" (opponent's cards)"),t.excludeSelf&&(o+=" (excluding self)"),t.actorChooses==="card_owner"?(o+=". Card owner chooses which.",o):o+"."};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const z_=({params:t,onChange:o})=>{const a=t.countType||"fixed",i=t.variableCount,l=a==="equal_to_discarded";return u.jsxs("div",{className:"param-editor",children:[u.jsx("h4",{children:"Discard Effect"}),u.jsxs("label",{children:["Count Type",u.jsxs("select",{value:a,onChange:c=>o({...t,countType:c.target.value}),children:[u.jsx("option",{value:"fixed",children:"Fixed Count"}),u.jsx("option",{value:"equal_to_discarded",children:"Equal to Previously Discarded (Plague-2)"})]})]}),a==="fixed"&&u.jsxs("label",{children:["Count",u.jsxs("select",{value:i?"variable":t.count.toString(),onChange:c=>{const s=c.target.value;if(s==="variable")o({...t,variableCount:!0,count:1});else if(s==="all"){const{variableCount:f,...p}=t;o({...p,count:"all"})}else{const{variableCount:f,...p}=t;o({...p,count:parseInt(s)})}},children:[u.jsx("option",{value:"1",children:"1 card"}),u.jsx("option",{value:"2",children:"2 cards"}),u.jsx("option",{value:"3",children:"3 cards"}),u.jsx("option",{value:"all",children:"All cards (entire hand)"}),u.jsx("option",{value:"variable",children:"1 or more cards (variable)"})]})]}),l&&u.jsxs("label",{children:["Offset (add to count)",u.jsx("input",{type:"number",value:t.countOffset||0,onChange:c=>o({...t,countOffset:parseInt(c.target.value)}),min:"-5",max:"5"})]}),u.jsxs("label",{children:["Actor",u.jsxs("select",{value:t.actor,onChange:c=>o({...t,actor:c.target.value}),children:[u.jsx("option",{value:"self",children:"Self"}),u.jsx("option",{value:"opponent",children:"Opponent"})]})]}),u.jsxs("div",{className:"effect-preview",children:[u.jsx("strong",{children:"Preview:"})," ",Kw(t)]})]})},Kw=t=>{const o=t.variableCount,a=t.countType||"fixed";let i="";if(a==="equal_to_discarded"){const l=t.countOffset||0;i=`(amount discarded${l>0?` + ${l}`:l<0?` - ${Math.abs(l)}`:""}) cards`}else if(o)i="1 or more cards";else if(t.count==="all")i="your hand";else{const l=t.count===1?"card":"cards";i=`${t.count} ${l}`}return t.actor==="opponent"?t.count==="all"?"Opponent discards their hand.":`Opponent discards ${i}.`:`Discard ${i}.`};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const G_=({params:t,onChange:o})=>{var c,s;const a=((c=t.targetFilter)==null?void 0:c.owner)||"any",i=(s=t.targetFilter)==null?void 0:s.valueEquals,l=t.selectLane||!1;return u.jsxs("div",{className:"param-editor",children:[u.jsx("h4",{children:"Return Effect"}),u.jsxs("label",{children:["Count",u.jsxs("select",{value:typeof t.count=="number"?t.count.toString():"all",onChange:f=>o({...t,count:f.target.value==="all"?"all":parseInt(f.target.value)}),children:[u.jsx("option",{value:"1",children:"1"}),u.jsx("option",{value:"2",children:"2"}),u.jsx("option",{value:"all",children:"All"})]})]}),u.jsxs("label",{children:["Whose cards?",u.jsxs("select",{value:a,onChange:f=>o({...t,targetFilter:{...t.targetFilter,owner:f.target.value}}),children:[u.jsx("option",{value:"any",children:"Any card (own or opponent)"}),u.jsx("option",{value:"own",children:"Only own cards"}),u.jsx("option",{value:"opponent",children:"Only opponent cards"})]})]}),u.jsxs("label",{children:[u.jsx("input",{type:"checkbox",checked:l,onChange:f=>{if(f.target.checked)o({...t,selectLane:!0});else{const{selectLane:p,...h}=t;o(h)}}}),'Select lane first (Water-3: "in 1 line")']}),u.jsxs("label",{children:[u.jsx("input",{type:"checkbox",checked:i!==void 0,onChange:f=>{if(f.target.checked)o({...t,targetFilter:{...t.targetFilter,valueEquals:2}});else{const{valueEquals:p,...h}=t.targetFilter||{};o({...t,targetFilter:h})}}}),"Filter by value"]}),i!==void 0&&u.jsxs("label",{children:["Value to return",u.jsx("input",{type:"number",min:0,max:6,value:i,onChange:f=>o({...t,targetFilter:{...t.targetFilter,valueEquals:parseInt(f.target.value)||0}})})]}),u.jsxs("div",{className:"effect-preview",children:[u.jsx("strong",{children:"Preview:"})," ",Jw(t)]})]})},Jw=t=>{var s,f;const o=t.selectLane||!1;if(((s=t.targetFilter)==null?void 0:s.valueEquals)!==void 0){const p=o?" in 1 line":"";return`Return all cards with a value of ${t.targetFilter.valueEquals}${p}.`}const a=t.count==="all"?"all cards":t.count===1?"1 card":`${t.count} cards`,i=((f=t.targetFilter)==null?void 0:f.owner)||"any";let l="";return i==="own"?l=" of your":i==="opponent"&&(l=" of opponent's"),`Return ${a}${l}${o?" in 1 line":""}.`};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Y_=({params:t,onChange:o})=>{var a,i;return u.jsxs("div",{className:"param-editor",children:[u.jsx("h4",{children:"Play Effect"}),u.jsxs("label",{children:["Actor (who plays)",u.jsxs("select",{value:t.actor||"self",onChange:l=>{if(l.target.value==="self"){const{actor:c,...s}=t;o(s)}else o({...t,actor:l.target.value})},children:[u.jsx("option",{value:"self",children:"You"}),u.jsx("option",{value:"opponent",children:"Opponent"})]})]}),u.jsxs("label",{children:["Source",u.jsxs("select",{value:t.source,onChange:l=>o({...t,source:l.target.value}),children:[u.jsx("option",{value:"hand",children:"Hand"}),u.jsx("option",{value:"deck",children:"Deck"})]})]}),u.jsxs("label",{children:["Anzahl",u.jsx("input",{type:"number",min:1,max:6,value:t.count,onChange:l=>o({...t,count:parseInt(l.target.value)||1})})]}),u.jsxs("label",{children:[u.jsx("input",{type:"checkbox",checked:t.faceDown,onChange:l=>o({...t,faceDown:l.target.checked})}),"Face-down"]}),u.jsxs("label",{children:["Destination",u.jsxs("select",{value:t.destinationRule.type,onChange:l=>o({...t,destinationRule:{...t.destinationRule,type:l.target.value}}),children:[u.jsx("option",{value:"other_lines",children:"Other lines (choose 1)"}),u.jsx("option",{value:"each_other_line",children:"Each other line (1 per line)"}),u.jsx("option",{value:"specific_lane",children:"Specific lane (this line)"}),u.jsx("option",{value:"each_line_with_card",children:"Each line with card"}),u.jsx("option",{value:"under_this_card",children:"Under this card"})]})]}),u.jsxs("label",{children:["Condition",u.jsxs("select",{value:((a=t.condition)==null?void 0:a.type)||"none",onChange:l=>{const c=l.target.value;if(c==="none"){const{condition:s,...f}=t;o(f)}else o(c==="per_x_cards_in_line"?{...t,condition:{type:c,cardCount:2}}:{...t,condition:{type:c}})},children:[u.jsx("option",{value:"none",children:"None (always play)"}),u.jsx("option",{value:"per_x_cards_in_line",children:"For every X cards in this line"}),u.jsx("option",{value:"only_in_lines_with_cards",children:"Only in lines where you have a card"})]})]}),((i=t.condition)==null?void 0:i.type)==="per_x_cards_in_line"&&u.jsxs("label",{children:["Cards per play (X)",u.jsx("input",{type:"number",min:1,max:6,value:t.condition.cardCount||2,onChange:l=>o({...t,condition:{...t.condition,cardCount:parseInt(l.target.value)||2}})}),u.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:'Gravity-0: "For every 2 cards in this line, play..."  X = 2'})]}),u.jsxs("div",{className:"effect-preview",children:[u.jsx("strong",{children:"Preview:"})," ",e1(t)]})]})},e1=t=>{var f,p;const o=t.actor,a=t.count===1?"card":"cards",i=t.faceDown?"face-down":"face-up";let l="",c="";o==="opponent"?(l="Opponent plays",c=t.source==="deck"?"from their deck":"from their hand"):(l="Play",c=t.source==="deck"?"from your deck":"from your hand");let s="";if(((f=t.condition)==null?void 0:f.type)==="per_x_cards_in_line")s=`For every ${t.condition.cardCount||2} cards in this line, `,s+=`${l.toLowerCase()} ${t.count} ${a} ${i} ${c}`;else{if(((p=t.condition)==null?void 0:p.type)==="only_in_lines_with_cards")return s=`${l} ${t.count} ${a} ${i} ${c}`,s+=" only in lines where you have a card",s+".";s=`${l} ${t.count} ${a} ${i} ${c}`}return t.destinationRule.type==="other_lines"?s+=" to other lines":t.destinationRule.type==="each_other_line"?s+=" in each other line":t.destinationRule.type==="under_this_card"?s+=" under this card":t.destinationRule.type==="each_line_with_card"?s+=" to each line with a card":t.destinationRule.type==="specific_lane"&&(s+=" in this line"),s+"."};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const W_=({params:t,onChange:o})=>u.jsxs("div",{className:"param-editor",children:[u.jsx("h4",{children:"Protocol Effect"}),u.jsxs("label",{children:["Action",u.jsxs("select",{value:t.action,onChange:a=>o({...t,action:a.target.value}),children:[u.jsx("option",{value:"rearrange_protocols",children:"Rearrange"}),u.jsx("option",{value:"swap_protocols",children:"Swap"})]})]}),u.jsxs("label",{children:["Target",u.jsxs("select",{value:t.target,onChange:a=>o({...t,target:a.target.value}),children:[u.jsx("option",{value:"own",children:"Own"}),u.jsx("option",{value:"opponent",children:"Opponent"}),u.jsx("option",{value:"both_sequential",children:"Beide (nacheinander)"})]})]}),u.jsx("h5",{children:"Restriction (Anarchy-3)"}),u.jsxs("label",{children:[u.jsx("input",{type:"checkbox",checked:!!t.restriction,onChange:a=>{if(a.target.checked)o({...t,restriction:{disallowedProtocol:"",laneIndex:"current"}});else{const{restriction:i,...l}=t;o(l)}}}),"Add restriction (protocol cannot be on specific lane)"]}),t.restriction&&u.jsxs(u.Fragment,{children:[u.jsxs("label",{children:["Disallowed Protocol",u.jsx("input",{type:"text",value:t.restriction.disallowedProtocol,onChange:a=>o({...t,restriction:{...t.restriction,disallowedProtocol:a.target.value}}),placeholder:"e.g., Anarchy, Fire, Death"})]}),u.jsxs("label",{children:["Lane",u.jsxs("select",{value:t.restriction.laneIndex,onChange:a=>o({...t,restriction:{...t.restriction,laneIndex:a.target.value==="current"?"current":parseInt(a.target.value)}}),children:[u.jsx("option",{value:"current",children:"Current lane (where this card is)"}),u.jsx("option",{value:"0",children:"Lane 1 (Left)"}),u.jsx("option",{value:"1",children:"Lane 2 (Middle)"}),u.jsx("option",{value:"2",children:"Lane 3 (Right)"})]})]})]}),u.jsxs("div",{className:"effect-preview",children:[u.jsx("strong",{children:"Preview:"})," ",t1(t)]})]}),t1=t=>{const o=t.target==="opponent"?"opponent's":t.target==="both_sequential"?"both players'":"your";let a="";if(t.action==="rearrange_protocols"?a=`Rearrange ${o} protocols.`:a=`Swap 2 ${o} protocols.`,t.restriction&&t.restriction.disallowedProtocol){const i=t.restriction.laneIndex==="current"?"this line":`lane ${typeof t.restriction.laneIndex=="number"?t.restriction.laneIndex+1:t.restriction.laneIndex}`;a+=` ${t.restriction.disallowedProtocol} cannot be on ${i}.`}return a};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Q_=({params:t,onChange:o})=>u.jsxs("div",{className:"param-editor",children:[u.jsx("h4",{children:"Reveal/Give Effect"}),u.jsxs("label",{children:["Action",u.jsxs("select",{value:t.action,onChange:a=>o({...t,action:a.target.value}),children:[u.jsx("option",{value:"reveal",children:"Reveal"}),u.jsx("option",{value:"give",children:"Give"})]})]}),u.jsxs("label",{children:["Source",u.jsxs("select",{value:t.source,onChange:a=>o({...t,source:a.target.value}),children:[u.jsx("option",{value:"own_hand",children:"Your hand"}),u.jsx("option",{value:"opponent_hand",children:"Opponent's hand"})]})]}),u.jsxs("label",{children:["Anzahl",u.jsx("input",{type:"number",min:1,max:6,value:t.count,onChange:a=>o({...t,count:parseInt(a.target.value)||1})})]}),u.jsxs("label",{children:["Follow-up action",u.jsxs("select",{value:t.followUpAction||"none",onChange:a=>{if(a.target.value==="none"){const{followUpAction:i,...l}=t;o(l)}else o({...t,followUpAction:a.target.value})},children:[u.jsx("option",{value:"none",children:"None"}),u.jsx("option",{value:"flip",children:"Then flip"}),u.jsx("option",{value:"shift",children:"Then shift"})]})]}),u.jsxs("div",{className:"effect-preview",children:[u.jsx("strong",{children:"Preview:"})," ",n1(t)]})]}),n1=t=>{const o=t.count===1?"card":"cards",a=t.action==="give"?"Give":"Reveal",i=t.source==="opponent_hand"?"opponent's hand":"your hand";let l=`${a} ${t.count} ${o} from ${i}`;return t.followUpAction==="flip"?l+=". Then flip it.":t.followUpAction==="shift"?l+=". Then shift it.":l+=".",l};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const X_=({params:t,onChange:o})=>u.jsxs("div",{className:"param-editor take-effect-editor",children:[u.jsx("h4",{children:"Take Effect Parameters"}),u.jsxs("label",{children:["Card Count",u.jsx("input",{type:"number",min:1,max:6,value:t.count,onChange:a=>o({...t,count:parseInt(a.target.value)||1})})]}),u.jsxs("label",{children:["Source",u.jsx("select",{value:t.source,onChange:a=>o({...t,source:a.target.value}),children:u.jsx("option",{value:"opponent_hand",children:"Opponent's Hand"})})]}),u.jsxs("label",{children:[u.jsx("input",{type:"checkbox",checked:t.random,onChange:a=>o({...t,random:a.target.checked})}),"Random (if unchecked, you choose)"]}),u.jsxs("div",{className:"effect-preview",children:[u.jsx("strong",{children:"Preview:"})," ",o1(t)]})]}),o1=t=>{const o=t.count===1?"card":"cards",a=t.random?"random ":"";return`Take ${t.count} ${a}${o} from opponent's hand.`},Ec=t=>{switch(t){case"draw":return{action:"draw",count:1,target:"self",source:"own_deck"};case"flip":return{action:"flip",count:1,targetFilter:{owner:"any",position:"any",faceState:"any",excludeSelf:!1},optional:!1};case"shift":return{action:"shift",targetFilter:{owner:"any",position:"any",faceState:"any"},destinationRestriction:{type:"any"}};case"delete":return{action:"delete",count:1,targetFilter:{position:"any",faceState:"any"},scope:{type:"anywhere"},excludeSelf:!1};case"discard":return{action:"discard",count:1,actor:"self"};case"return":return{action:"return",count:1,targetFilter:{},scope:{type:"any_card"}};case"play":return{action:"play",source:"hand",count:1,faceDown:!1,destinationRule:{type:"other_lines"}};case"rearrange_protocols":return{action:"rearrange_protocols",target:"own"};case"swap_protocols":return{action:"swap_protocols",target:"own"};case"reveal":case"give":return{action:t,source:"own_hand",count:1};case"take":return{action:"take",source:"opponent_hand",count:1,random:!0};default:return{}}},a1=({params:t,onChange:o})=>{const[a,i]=J.useState(""),[l,c]=J.useState(""),[s,f]=J.useState(null),p=t.options||[],h=p[0],y=p[1],g=()=>{if(!a)return;const R={id:Oe(),params:Ec(a),position:"middle",trigger:"on_play"};o({...t,options:[R,y].filter(Boolean)}),i(""),f(1)},v=()=>{if(!l)return;const R={id:Oe(),params:Ec(l),position:"middle",trigger:"on_play"};o({...t,options:[h,R].filter(Boolean)}),c(""),f(2)},w=()=>{o({...t,options:[y].filter(Boolean)}),s===1&&f(null)},C=()=>{o({...t,options:[h].filter(Boolean)}),s===2&&f(null)},x=R=>{const A={...h,params:R};o({...t,options:[A,y].filter(Boolean)})},b=R=>{const A={...y,params:R};o({...t,options:[h,A].filter(Boolean)})},E=R=>{const A=Ec(R),N={...h,params:A};o({...t,options:[N,y].filter(Boolean)})},S=R=>{const A=Ec(R),N={...y,params:A};o({...t,options:[h,N].filter(Boolean)})},j=(R,A)=>{switch(R.params.action){case"draw":return u.jsx(M_,{params:R.params,onChange:A});case"flip":return u.jsx(H_,{params:R.params,onChange:A});case"shift":return u.jsx(B_,{params:R.params,onChange:A});case"delete":return u.jsx(V_,{params:R.params,onChange:A});case"discard":return u.jsx(z_,{params:R.params,onChange:A});case"return":return u.jsx(G_,{params:R.params,onChange:A});case"play":return u.jsx(Y_,{params:R.params,onChange:A});case"rearrange_protocols":case"swap_protocols":return u.jsx(W_,{params:R.params,onChange:A});case"reveal":case"give":return u.jsx(Q_,{params:R.params,onChange:A});case"take":return u.jsx(X_,{params:R.params,onChange:A});default:return u.jsx("div",{children:"Unknown effect type"})}};return u.jsxs("div",{style:{padding:"10px",backgroundColor:"#2c1d63",borderRadius:"4px",border:"1px solid rgba(97, 239, 255, 0.3)"},children:[u.jsx("h4",{style:{color:"#61EFFF",marginTop:0},children:"Either/Or Choice"}),u.jsx("p",{style:{color:"#F0F0F0",fontSize:"14px",marginBottom:"15px"},children:'Player chooses one of two options. Example: "Either discard 1 card or flip this card"'}),u.jsxs("div",{style:{marginBottom:"15px",padding:"10px",backgroundColor:"rgba(97, 239, 255, 0.05)",borderRadius:"4px"},children:[u.jsx("label",{style:{color:"#61EFFF",display:"block",marginBottom:"10px",fontWeight:"bold"},children:"Option 1:"}),h?u.jsxs(u.Fragment,{children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"10px"},children:[u.jsxs("select",{value:h.params.action,onChange:R=>E(R.target.value),style:{flex:1,padding:"8px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px"},children:[u.jsx("option",{value:"draw",children:"Draw Cards"}),u.jsx("option",{value:"flip",children:"Flip Cards"}),u.jsx("option",{value:"shift",children:"Shift Card"}),u.jsx("option",{value:"delete",children:"Delete Cards"}),u.jsx("option",{value:"discard",children:"Discard Cards"}),u.jsx("option",{value:"return",children:"Return to Hand"}),u.jsx("option",{value:"play",children:"Play from Hand/Deck"})]}),u.jsx("button",{onClick:()=>f(s===1?null:1),style:{padding:"8px 15px",backgroundColor:s===1?"#8B0000":"#61EFFF",color:s===1?"#F0F0F0":"#0A051A",border:"none",borderRadius:"4px",cursor:"pointer",fontWeight:"bold"},children:s===1?"Hide":"Edit"}),u.jsx("button",{onClick:w,style:{padding:"8px 15px",backgroundColor:"#8B0000",color:"#F0F0F0",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Remove"})]}),s===1&&u.jsx("div",{style:{marginTop:"10px"},children:j(h,x)})]}):u.jsxs("div",{style:{display:"flex",gap:"10px"},children:[u.jsxs("select",{value:a,onChange:R=>i(R.target.value),style:{flex:1,padding:"8px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px"},children:[u.jsx("option",{value:"",children:"Choose Action"}),u.jsx("option",{value:"draw",children:"Draw Cards"}),u.jsx("option",{value:"flip",children:"Flip Cards"}),u.jsx("option",{value:"shift",children:"Shift Card"}),u.jsx("option",{value:"delete",children:"Delete Cards"}),u.jsx("option",{value:"discard",children:"Discard Cards"}),u.jsx("option",{value:"return",children:"Return to Hand"}),u.jsx("option",{value:"play",children:"Play from Hand/Deck"})]}),u.jsx("button",{onClick:g,disabled:!a,style:{padding:"8px 15px",backgroundColor:a?"#61EFFF":"#444",color:"#0A051A",border:"none",borderRadius:"4px",cursor:a?"pointer":"not-allowed",fontWeight:"bold"},children:"Add"})]})]}),u.jsxs("div",{style:{padding:"10px",backgroundColor:"rgba(97, 239, 255, 0.05)",borderRadius:"4px"},children:[u.jsx("label",{style:{color:"#61EFFF",display:"block",marginBottom:"10px",fontWeight:"bold"},children:"Option 2:"}),y?u.jsxs(u.Fragment,{children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"10px"},children:[u.jsxs("select",{value:y.params.action,onChange:R=>S(R.target.value),style:{flex:1,padding:"8px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px"},children:[u.jsx("option",{value:"draw",children:"Draw Cards"}),u.jsx("option",{value:"flip",children:"Flip Cards"}),u.jsx("option",{value:"shift",children:"Shift Card"}),u.jsx("option",{value:"delete",children:"Delete Cards"}),u.jsx("option",{value:"discard",children:"Discard Cards"}),u.jsx("option",{value:"return",children:"Return to Hand"}),u.jsx("option",{value:"play",children:"Play from Hand/Deck"})]}),u.jsx("button",{onClick:()=>f(s===2?null:2),style:{padding:"8px 15px",backgroundColor:s===2?"#8B0000":"#61EFFF",color:s===2?"#F0F0F0":"#0A051A",border:"none",borderRadius:"4px",cursor:"pointer",fontWeight:"bold"},children:s===2?"Hide":"Edit"}),u.jsx("button",{onClick:C,style:{padding:"8px 15px",backgroundColor:"#8B0000",color:"#F0F0F0",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Remove"})]}),s===2&&u.jsx("div",{style:{marginTop:"10px"},children:j(y,b)})]}):u.jsxs("div",{style:{display:"flex",gap:"10px"},children:[u.jsxs("select",{value:l,onChange:R=>c(R.target.value),style:{flex:1,padding:"8px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px"},children:[u.jsx("option",{value:"",children:"Choose Action"}),u.jsx("option",{value:"draw",children:"Draw Cards"}),u.jsx("option",{value:"flip",children:"Flip Cards"}),u.jsx("option",{value:"shift",children:"Shift Card"}),u.jsx("option",{value:"delete",children:"Delete Cards"}),u.jsx("option",{value:"discard",children:"Discard Cards"}),u.jsx("option",{value:"return",children:"Return to Hand"}),u.jsx("option",{value:"play",children:"Play from Hand/Deck"})]}),u.jsx("button",{onClick:v,disabled:!l,style:{padding:"8px 15px",backgroundColor:l?"#61EFFF":"#444",color:"#0A051A",border:"none",borderRadius:"4px",cursor:l?"pointer":"not-allowed",fontWeight:"bold"},children:"Add"})]})]}),p.length===2&&u.jsx("div",{style:{marginTop:"15px",padding:"10px",backgroundColor:"rgba(97, 239, 255, 0.1)",borderRadius:"4px"},children:u.jsx("p",{style:{color:"#61EFFF",fontSize:"14px",margin:0},children:" Both options configured. Player will choose one during gameplay."})})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const r1=({params:t,onChange:o})=>{var c,s,f;const a=((c=t.rule)==null?void 0:c.type)||"block_all_play",i=((s=t.rule)==null?void 0:s.target)||"opponent",l=((f=t.rule)==null?void 0:f.scope)||"this_lane";return u.jsxs("div",{className:"param-editor passive-rule-editor",children:[u.jsx("h4",{children:"Passive Rule Parameters"}),u.jsx("p",{style:{color:"#8A79E8",fontSize:"14px",marginBottom:"15px"},children:"This rule is active while the card is face-up. It modifies game behavior."}),u.jsxs("label",{children:["Rule Type",u.jsxs("select",{value:a,onChange:p=>o({...t,rule:{...t.rule,type:p.target.value,target:i,scope:l}}),children:[u.jsxs("optgroup",{label:"Play Restrictions",children:[u.jsx("option",{value:"block_face_down_play",children:"Block Face-Down Plays (Metal-2)"}),u.jsx("option",{value:"block_face_up_play",children:"Block Face-Up Plays"}),u.jsx("option",{value:"block_all_play",children:"Block All Plays (Plague-0)"}),u.jsx("option",{value:"require_face_down_play",children:"Require Face-Down Plays (Psychic-1)"})]}),u.jsxs("optgroup",{label:"Protocol Matching",children:[u.jsx("option",{value:"allow_any_protocol_play",children:"Allow Any Protocol (Spirit-1, Chaos-3)"}),u.jsx("option",{value:"require_non_matching_protocol",children:"Require Non-Matching (Anarchy-1)"})]}),u.jsxs("optgroup",{label:"Action Blocks",children:[u.jsx("option",{value:"block_flips",children:"Block Flips (Frost-1)"}),u.jsx("option",{value:"block_protocol_rearrange",children:"Block Protocol Rearrange (Frost-1)"}),u.jsx("option",{value:"block_shifts_from_lane",children:"Block Shifts From Lane (Frost-3)"}),u.jsx("option",{value:"block_shifts_to_lane",children:"Block Shifts To Lane (Frost-3)"})]}),u.jsx("optgroup",{label:"Effect Modifications",children:u.jsx("option",{value:"ignore_middle_commands",children:"Ignore Middle Commands (Apathy-2)"})}),u.jsx("optgroup",{label:"Phase Modifications",children:u.jsx("option",{value:"skip_check_cache_phase",children:"Skip Check Cache Phase (Spirit-0)"})})]})]}),u.jsxs("label",{children:["Affected Player",u.jsxs("select",{value:i,onChange:p=>o({...t,rule:{...t.rule,type:a,target:p.target.value,scope:l}}),children:[u.jsx("option",{value:"self",children:"Self (You)"}),u.jsx("option",{value:"opponent",children:"Opponent"}),u.jsx("option",{value:"all",children:"All Players"})]})]}),u.jsxs("label",{children:["Scope",u.jsxs("select",{value:l,onChange:p=>o({...t,rule:{...t.rule,type:a,target:i,scope:p.target.value}}),children:[u.jsx("option",{value:"this_lane",children:"This Lane Only"}),u.jsx("option",{value:"global",children:"Global (All Lanes)"})]})]}),u.jsxs("div",{className:"effect-preview",children:[u.jsx("strong",{children:"Preview:"})," ",l1(t)]})]})},l1=t=>{var s,f,p;const o=((s=t.rule)==null?void 0:s.type)||"block_all_play",a=((f=t.rule)==null?void 0:f.target)||"opponent",i=((p=t.rule)==null?void 0:p.scope)||"this_lane",l=a==="self"?"You":a==="opponent"?"Your opponent":"All players",c=i==="this_lane"?" in this lane":"";switch(o){case"block_face_down_play":return`${l} cannot play cards face-down${c}.`;case"block_face_up_play":return`${l} cannot play cards face-up${c}.`;case"block_all_play":return`${l} cannot play cards${c}.`;case"require_face_down_play":return`${l} can only play cards face-down${c}.`;case"allow_any_protocol_play":return`${l} may play cards without matching protocols${c}.`;case"require_non_matching_protocol":return`${l} can only play cards without matching protocols${c}.`;case"block_flips":return`Cards cannot be flipped face-up${c}.`;case"block_protocol_rearrange":return"Protocols cannot be rearranged.";case"block_shifts_from_lane":return"Cards cannot shift from this lane.";case"block_shifts_to_lane":return"Cards cannot shift to this lane.";case"ignore_middle_commands":return`Ignore all middle commands of cards${c}.`;case"skip_check_cache_phase":return"Skip your check cache phase.";default:return"Passive rule active."}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const c1=({params:t,onChange:o})=>{var g,v,w,C,x,b,E,S,j;const a=((g=t.modifier)==null?void 0:g.type)||"add_per_condition",i=((v=t.modifier)==null?void 0:v.value)||1,l=((w=t.modifier)==null?void 0:w.condition)||"per_face_down_card",c=((C=t.modifier)==null?void 0:C.target)||"own_total",s=((x=t.modifier)==null?void 0:x.scope)||"this_lane",f=((E=(b=t.modifier)==null?void 0:b.filter)==null?void 0:E.faceState)||"face_down",p=((j=(S=t.modifier)==null?void 0:S.filter)==null?void 0:j.position)||"any",h=a==="add_per_condition",y=a==="set_to_fixed"&&(c==="own_cards"||c==="opponent_cards"||c==="all_cards");return u.jsxs("div",{className:"param-editor value-modifier-editor",children:[u.jsx("h4",{children:"Value Modifier Parameters"}),u.jsx("p",{style:{color:"#8A79E8",fontSize:"14px",marginBottom:"15px"},children:"This modifier is active while the card is face-up. It modifies card values or lane totals."}),u.jsxs("label",{children:["Modifier Type",u.jsxs("select",{value:a,onChange:R=>o({...t,modifier:{...t.modifier,type:R.target.value,value:i,condition:h?l:void 0,target:c,scope:s,filter:y?{faceState:f,position:p}:void 0}}),children:[u.jsx("option",{value:"add_per_condition",children:"Add Per Condition (Apathy-0: +1 per face-down)"}),u.jsx("option",{value:"set_to_fixed",children:"Set Cards To Fixed Value (Darkness-2: face-down = 4)"}),u.jsx("option",{value:"add_to_total",children:"Add To Lane Total (Metal-0: opponent total -2)"})]})]}),u.jsxs("label",{children:["Value",u.jsx("input",{type:"number",value:i,onChange:R=>o({...t,modifier:{...t.modifier,type:a,value:parseInt(R.target.value)||0,condition:h?l:void 0,target:c,scope:s,filter:y?{faceState:f,position:p}:void 0}}),style:{width:"100%",padding:"8px",marginTop:"5px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px"}}),u.jsxs("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:[a==="add_per_condition"&&"Value to add per condition (e.g., +1)",a==="set_to_fixed"&&"Fixed value to set cards to (e.g., 4)",a==="add_to_total"&&"Value to add to total (use negative for subtraction, e.g., -2)"]})]}),h&&u.jsxs("label",{children:["Condition",u.jsxs("select",{value:l,onChange:R=>o({...t,modifier:{...t.modifier,type:a,value:i,condition:R.target.value,target:c,scope:s,filter:y?{faceState:f,position:p}:void 0}}),children:[u.jsx("option",{value:"per_face_down_card",children:"Per Face-Down Card"}),u.jsx("option",{value:"per_face_up_card",children:"Per Face-Up Card"}),u.jsx("option",{value:"per_card",children:"Per Card (any)"})]})]}),u.jsxs("label",{children:["Target",u.jsxs("select",{value:c,onChange:R=>o({...t,modifier:{...t.modifier,type:a,value:i,condition:h?l:void 0,target:R.target.value,scope:s,filter:y?{faceState:f,position:p}:void 0}}),children:[u.jsxs("optgroup",{label:"Card Values",children:[u.jsx("option",{value:"own_cards",children:"Own Cards"}),u.jsx("option",{value:"opponent_cards",children:"Opponent Cards"}),u.jsx("option",{value:"all_cards",children:"All Cards"})]}),u.jsxs("optgroup",{label:"Lane Totals",children:[u.jsx("option",{value:"own_total",children:"Own Total"}),u.jsx("option",{value:"opponent_total",children:"Opponent Total"})]})]})]}),y&&u.jsxs(u.Fragment,{children:[u.jsxs("label",{children:["Card Face State (Filter)",u.jsxs("select",{value:f,onChange:R=>o({...t,modifier:{...t.modifier,type:a,value:i,condition:h?l:void 0,target:c,scope:s,filter:{faceState:R.target.value,position:p}}}),children:[u.jsx("option",{value:"face_down",children:"Face-Down Only"}),u.jsx("option",{value:"face_up",children:"Face-Up Only"}),u.jsx("option",{value:"any",children:"Any"})]})]}),u.jsxs("label",{children:["Card Position (Filter)",u.jsxs("select",{value:p,onChange:R=>o({...t,modifier:{...t.modifier,type:a,value:i,condition:h?l:void 0,target:c,scope:s,filter:{faceState:f,position:R.target.value}}}),children:[u.jsx("option",{value:"any",children:"Any Position"}),u.jsx("option",{value:"covered",children:"Covered Only"}),u.jsx("option",{value:"uncovered",children:"Uncovered Only"})]})]})]}),u.jsxs("label",{children:["Scope",u.jsxs("select",{value:s,onChange:R=>o({...t,modifier:{...t.modifier,type:a,value:i,condition:h?l:void 0,target:c,scope:R.target.value,filter:y?{faceState:f,position:p}:void 0}}),children:[u.jsx("option",{value:"this_lane",children:"This Lane Only"}),u.jsx("option",{value:"global",children:"Global (All Lanes)"})]})]}),u.jsxs("div",{className:"effect-preview",children:[u.jsx("strong",{children:"Preview:"})," ",s1(t)]})]})},s1=t=>{var h,y,g,v,w,C,x;const o=((h=t.modifier)==null?void 0:h.type)||"add_per_condition",a=((y=t.modifier)==null?void 0:y.value)||0,i=((g=t.modifier)==null?void 0:g.condition)||"per_face_down_card",l=((v=t.modifier)==null?void 0:v.target)||"own_total",c=((w=t.modifier)==null?void 0:w.scope)||"this_lane",s=((x=(C=t.modifier)==null?void 0:C.filter)==null?void 0:x.faceState)||"face_down",f=c==="this_lane"?" in this lane":"";let p="";switch(l){case"own_cards":p="your cards";break;case"opponent_cards":p="opponent's cards";break;case"all_cards":p="all cards";break;case"own_total":p="your total value";break;case"opponent_total":p="opponent's total value";break}switch(o){case"add_per_condition":{let b="";switch(i){case"per_face_down_card":b="face-down card";break;case"per_face_up_card":b="face-up card";break;case"per_card":b="card";break}const E=a>=0?"+":"";return`${p}${f} is increased by ${E}${a} for each ${b}${f}.`}case"set_to_fixed":return`All ${s==="face_down"?"face-down ":s==="face_up"?"face-up ":""}${p}${f} have a value of ${a}.`;case"add_to_total":{const b=a>=0?"increased":"reduced",E=Math.abs(a);return`${p}${f} is ${b} by ${E}.`}default:return"Value modifier active."}},Rc=t=>{switch(t){case"draw":return{action:"draw",count:1,target:"self",source:"own_deck"};case"refresh":return{action:"refresh",target:"self"};case"mutual_draw":return{action:"mutual_draw",count:1};case"flip":return{action:"flip",count:1,targetFilter:{owner:"any",position:"any",faceState:"any",excludeSelf:!1},optional:!1};case"shift":return{action:"shift",targetFilter:{owner:"any",position:"any",faceState:"any"},destinationRestriction:{type:"any"}};case"delete":return{action:"delete",count:1,targetFilter:{position:"any",faceState:"any"},scope:{type:"anywhere"},excludeSelf:!1};case"discard":return{action:"discard",count:1,actor:"self"};case"return":return{action:"return",count:1,targetFilter:{},scope:{type:"any_card"}};case"play":return{action:"play",source:"hand",count:1,faceDown:!1,destinationRule:{type:"other_lines"}};case"rearrange_protocols":return{action:"rearrange_protocols",target:"own"};case"swap_protocols":return{action:"swap_protocols",target:"own"};case"reveal":case"give":return{action:t,source:"own_hand",count:1};case"take":return{action:"take",source:"opponent_hand",count:1,random:!0};case"choice":return{action:"choice",options:[]};case"passive_rule":return{action:"passive_rule",rule:{type:"block_all_play",target:"opponent",scope:"this_lane"}};case"value_modifier":return{action:"value_modifier",modifier:{type:"add_per_condition",value:1,condition:"per_face_down_card",target:"own_total",scope:"this_lane"}};default:return{}}},i1=({effect:t,onChange:o})=>{const a=v=>{o({...t,params:v})},i=v=>{if(v){const w={id:Oe(),params:Rc("draw"),position:t.position,trigger:t.trigger};o({...t,conditional:{type:"then",thenEffect:w}})}else{const{conditional:w,...C}=t;o(C)}},l=v=>{t.conditional&&o({...t,conditional:{...t.conditional,type:v}})},c=v=>{t.conditional&&o({...t,conditional:{...t.conditional,thenEffect:v}})},s=v=>{if(!t.conditional)return;const w=Rc(v),C={...t.conditional.thenEffect,params:w};o({...t,conditional:{...t.conditional,thenEffect:C}})},f=v=>{if(t.conditional)if(v){const w={id:Oe(),params:Rc("delete"),position:t.position,trigger:t.trigger};o({...t,conditional:{...t.conditional,thenEffect:{...t.conditional.thenEffect,conditional:{type:"then",thenEffect:w}}}})}else{const{conditional:w,...C}=t.conditional.thenEffect;o({...t,conditional:{...t.conditional,thenEffect:C}})}},p=v=>{var w;(w=t.conditional)!=null&&w.thenEffect.conditional&&o({...t,conditional:{...t.conditional,thenEffect:{...t.conditional.thenEffect,conditional:{...t.conditional.thenEffect.conditional,type:v}}}})},h=v=>{var w;(w=t.conditional)!=null&&w.thenEffect.conditional&&o({...t,conditional:{...t.conditional,thenEffect:{...t.conditional.thenEffect,conditional:{...t.conditional.thenEffect.conditional,thenEffect:v}}}})},y=v=>{var x;if(!((x=t.conditional)!=null&&x.thenEffect.conditional))return;const w=Rc(v),C={...t.conditional.thenEffect.conditional.thenEffect,params:w};o({...t,conditional:{...t.conditional,thenEffect:{...t.conditional.thenEffect,conditional:{...t.conditional.thenEffect.conditional,thenEffect:C}}}})},g=(v,w)=>{switch(v.params.action){case"draw":return u.jsx(M_,{params:v.params,onChange:w});case"refresh":return u.jsx(Yw,{params:v.params,onChange:w});case"mutual_draw":return u.jsx(Ww,{params:v.params,onChange:w});case"flip":return u.jsx(H_,{params:v.params,onChange:w});case"shift":return u.jsx(B_,{params:v.params,onChange:w});case"delete":return u.jsx(V_,{params:v.params,onChange:w});case"discard":return u.jsx(z_,{params:v.params,onChange:w});case"return":return u.jsx(G_,{params:v.params,onChange:w});case"play":return u.jsx(Y_,{params:v.params,onChange:w});case"rearrange_protocols":case"swap_protocols":return u.jsx(W_,{params:v.params,onChange:w});case"reveal":case"give":return u.jsx(Q_,{params:v.params,onChange:w});case"take":return u.jsx(X_,{params:v.params,onChange:w});case"choice":return u.jsx(a1,{params:v.params,onChange:w});case"passive_rule":return u.jsx(r1,{params:v.params,onChange:w});case"value_modifier":return u.jsx(c1,{params:v.params,onChange:w});default:return u.jsx("div",{children:"Unknown effect type"})}};return u.jsxs("div",{className:"effect-editor",children:[u.jsxs("div",{className:"main-effect",children:[u.jsx("h3",{children:"Main Effect"}),g(t,a)]}),u.jsxs("div",{style:{marginTop:"15px"},children:[u.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[u.jsx("input",{type:"checkbox",checked:!!t.useCardFromPreviousEffect,onChange:v=>o({...t,useCardFromPreviousEffect:v.target.checked})}),u.jsx("span",{children:`Use card from previous effect (for "shift THAT card", "draw equal to THAT card's value", etc.)`})]}),t.useCardFromPreviousEffect&&u.jsx("small",{style:{display:"block",marginLeft:"24px",marginTop:"4px",color:"#8A79E8"},children:"This effect will target/use the card selected by the previous effect in the chain."})]}),(t.trigger==="after_draw"||t.trigger==="after_delete"||t.trigger==="after_shift"||t.trigger==="after_flip"||t.trigger==="after_clear_cache"||t.trigger==="after_opponent_discard")&&u.jsxs("div",{style:{marginTop:"15px"},children:[u.jsxs("label",{children:["Trigger Actor (who triggers this effect?)",u.jsxs("select",{value:t.reactiveTriggerActor||"self",onChange:v=>o({...t,reactiveTriggerActor:v.target.value}),style:{width:"100%",padding:"8px",marginTop:"5px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px",cursor:"pointer"},children:[u.jsx("option",{value:"self",children:"Only when YOU perform the action (default)"}),u.jsx("option",{value:"opponent",children:"Only when OPPONENT performs the action"}),u.jsx("option",{value:"any",children:"When ANYONE performs the action"})]})]}),u.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:t.reactiveTriggerActor==="self"||!t.reactiveTriggerActor?"Effect triggers only when YOU delete/draw/etc.":t.reactiveTriggerActor==="opponent"?"Effect triggers only when OPPONENT deletes/draws/etc.":"Effect triggers when ANYONE deletes/draws/etc."})]}),u.jsxs("div",{className:"conditional-section",style:{marginTop:"20px",borderTop:"1px solid #2c1d63",paddingTop:"15px"},children:[u.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"10px"},children:[u.jsx("input",{type:"checkbox",checked:!!t.conditional,onChange:v=>i(v.target.checked)}),u.jsx("strong",{children:"Add follow-up effect"})]}),t.conditional&&u.jsxs("div",{className:"follow-up-effect",style:{marginLeft:"20px",padding:"10px",backgroundColor:"#2c1d63",borderRadius:"4px",border:"1px solid rgba(97, 239, 255, 0.2)"},children:[u.jsx("h4",{style:{marginTop:0},children:"Follow-Up Effect"}),u.jsxs("label",{children:["Connection Type",u.jsxs("select",{value:t.conditional.type||"then",onChange:v=>l(v.target.value),style:{width:"100%",padding:"8px",marginTop:"5px",marginBottom:"15px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px",cursor:"pointer"},children:[u.jsx("option",{value:"then",children:"Then (always executes)"}),u.jsx("option",{value:"if_executed",children:"If you do (only if first effect succeeds)"})]})]}),u.jsxs("label",{children:["Effect Type",u.jsxs("select",{value:t.conditional.thenEffect.params.action,onChange:v=>s(v.target.value),style:{width:"100%",padding:"8px",marginTop:"5px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px",cursor:"pointer"},children:[u.jsx("option",{value:"draw",children:"Draw Cards"}),u.jsx("option",{value:"flip",children:"Flip Cards"}),u.jsx("option",{value:"shift",children:"Shift Card"}),u.jsx("option",{value:"delete",children:"Delete Cards"}),u.jsx("option",{value:"discard",children:"Discard Cards"}),u.jsx("option",{value:"return",children:"Return to Hand"}),u.jsx("option",{value:"play",children:"Play from Hand/Deck"}),u.jsx("option",{value:"reveal",children:"Reveal Hand"}),u.jsx("option",{value:"give",children:"Give Cards"}),u.jsx("option",{value:"take",children:"Take from Hand"}),u.jsx("option",{value:"choice",children:"Either/Or Choice"})]})]}),u.jsx("div",{style:{marginTop:"15px"},children:g(t.conditional.thenEffect,v=>c({...t.conditional.thenEffect,params:v}))}),u.jsxs("div",{className:"nested-conditional-section",style:{marginTop:"15px",borderTop:"1px solid rgba(97, 239, 255, 0.2)",paddingTop:"15px"},children:[u.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"10px"},children:[u.jsx("input",{type:"checkbox",checked:!!t.conditional.thenEffect.conditional,onChange:v=>f(v.target.checked)}),u.jsx("strong",{children:"Add 2nd follow-up effect"})]}),t.conditional.thenEffect.conditional&&u.jsxs("div",{className:"nested-follow-up-effect",style:{marginLeft:"10px",padding:"10px",backgroundColor:"#1A113B",borderRadius:"4px",border:"1px solid rgba(97, 239, 255, 0.2)"},children:[u.jsx("h5",{style:{marginTop:0,fontSize:"0.9rem"},children:"2nd Follow-Up Effect"}),u.jsxs("label",{children:["Connection Type",u.jsxs("select",{value:t.conditional.thenEffect.conditional.type||"then",onChange:v=>p(v.target.value),style:{width:"100%",padding:"6px",marginTop:"5px",marginBottom:"10px",backgroundColor:"#0D0825",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px",cursor:"pointer",fontSize:"0.9rem"},children:[u.jsx("option",{value:"then",children:"Then (always executes)"}),u.jsx("option",{value:"if_executed",children:"If you do (only if first effect succeeds)"})]})]}),u.jsxs("label",{children:["Effect Type",u.jsxs("select",{value:t.conditional.thenEffect.conditional.thenEffect.params.action,onChange:v=>y(v.target.value),style:{width:"100%",padding:"6px",marginTop:"5px",backgroundColor:"#0D0825",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px",cursor:"pointer",fontSize:"0.9rem"},children:[u.jsx("option",{value:"draw",children:"Draw Cards"}),u.jsx("option",{value:"flip",children:"Flip Cards"}),u.jsx("option",{value:"shift",children:"Shift Card"}),u.jsx("option",{value:"delete",children:"Delete Cards"}),u.jsx("option",{value:"discard",children:"Discard Cards"}),u.jsx("option",{value:"return",children:"Return to Hand"}),u.jsx("option",{value:"play",children:"Play from Hand/Deck"}),u.jsx("option",{value:"reveal",children:"Reveal Hand"}),u.jsx("option",{value:"give",children:"Give Cards"}),u.jsx("option",{value:"take",children:"Take from Hand"})]})]}),u.jsx("div",{style:{marginTop:"10px"},children:g(t.conditional.thenEffect.conditional.thenEffect,v=>h({...t.conditional.thenEffect.conditional.thenEffect,params:v}))})]})]})]})]})]})},d1=({card:t,protocolName:o,protocolColor:a,protocolPattern:i,onChange:l})=>{const[c,s]=J.useState(null),[f,p]=J.useState(null),[h,y]=J.useState(!1);J.useEffect(()=>{s(null)},[t.value]);const g=(O,H,te)=>{const ne={id:Oe(),params:u1(H),position:O,trigger:te},z={...t};O==="top"?z.topEffects=[...z.topEffects,ne]:O==="middle"?z.middleEffects=[...z.middleEffects,ne]:z.bottomEffects=[...z.bottomEffects,ne],l(z);const F=O==="top"?z.topEffects.length-1:O==="middle"?z.middleEffects.length-1:z.bottomEffects.length-1;s({box:O,effectIndex:F,effect:ne})},v=(O,H)=>{p({box:O,effectIndex:H})},w=()=>{if(!f)return;const{box:O,effectIndex:H}=f,te={...t};O==="top"?te.topEffects.splice(H,1):O==="middle"?te.middleEffects.splice(H,1):te.bottomEffects.splice(H,1),l(te),c&&c.box===O&&c.effectIndex===H&&s(null),p(null)},C=O=>{if(!c)return;const{box:H,effectIndex:te}=c,ne={...t};H==="top"?(ne.topEffects=[...ne.topEffects],ne.topEffects[te]=O):H==="middle"?(ne.middleEffects=[...ne.middleEffects],ne.middleEffects[te]=O):(ne.bottomEffects=[...ne.bottomEffects],ne.bottomEffects[te]=O),l(ne),s({box:H,effectIndex:te,effect:O})},x=(O,H)=>{const te=O==="top"?t.topEffects[H]:O==="middle"?t.middleEffects[H]:t.bottomEffects[H];s({box:O,effectIndex:H,effect:te})},b=O=>{switch(O){case"passive":return"";case"on_play":return"";case"start":return"Start";case"end":return"End";case"on_cover":return"On Cover";case"after_delete":return"After you delete cards";case"after_opponent_discard":return"After opponent discards";case"after_draw":return"After you draw cards";case"after_clear_cache":return"After you clear cache";case"before_compile_delete":return"Before deleted by compile";case"after_flip":return"After cards are flipped";case"after_shift":return"After cards are shifted";case"after_play":return"After cards are played";case"on_flip":return"When this card would be flipped";case"on_cover_or_flip":return"When covered or flipped";default:return O}},E=O=>{const H={...t,value:O};l(H)},S=Za(t.topEffects),j=Za(t.middleEffects),R=Za(t.bottomEffects),A=JSON.stringify({top:t.topEffects.map(O=>({id:O.id,params:O.params})),middle:t.middleEffects.map(O=>({id:O.id,params:O.params})),bottom:t.bottomEffects.map(O=>({id:O.id,params:O.params}))}),N=`${o}-${t.value}-${A}`,I={id:N,protocol:o,value:t.value,top:S,middle:j,bottom:R,isFaceUp:!0,owner:"player",laneIndex:0,category:"Custom",keywords:{}},V=(O,H)=>{O=O.replace("#","");const te=parseInt(O.substring(0,2),16),ne=parseInt(O.substring(2,4),16),z=parseInt(O.substring(4,6),16);return`rgba(${te}, ${ne}, ${z}, ${H})`},L=`card-custom-preview pattern-${i}`,D={"--custom-color":a,"--custom-color-alpha-05":V(a,.05),"--custom-color-alpha-06":V(a,.06),"--custom-color-alpha-08":V(a,.08),"--custom-color-alpha-10":V(a,.1),"--custom-color-alpha-15":V(a,.15),"--custom-color-alpha-20":V(a,.2),"--custom-color-alpha-25":V(a,.25),borderColor:a};return u.jsxs("div",{className:"card-editor-container",children:[u.jsxs("div",{className:"card-editor-content",children:[u.jsxs("div",{className:"card-live-preview",children:[u.jsx("h4",{children:"Card Preview"}),u.jsxs("label",{className:"card-value-selector",children:["Card Value:",u.jsxs("select",{value:t.value,onChange:O=>E(Number(O.target.value)),children:[u.jsx("option",{value:-1,children:"-1"}),u.jsx("option",{value:0,children:"0"}),u.jsx("option",{value:1,children:"1"}),u.jsx("option",{value:2,children:"2"}),u.jsx("option",{value:3,children:"3"}),u.jsx("option",{value:4,children:"4"}),u.jsx("option",{value:5,children:"5"}),u.jsx("option",{value:6,children:"6"})]})]}),u.jsx("div",{className:"card-preview-wrapper",style:D,children:u.jsx(nn,{card:I,isFaceUp:!0,additionalClassName:L},N)})]}),u.jsx("div",{className:"card-effects-editor",children:u.jsxs("div",{className:"card-preview",style:{borderColor:a},children:[u.jsx("div",{className:"card-header",style:{backgroundColor:a},children:u.jsxs("h3",{children:[o,"-",t.value]})}),u.jsxs("div",{className:"card-box top-box",children:[u.jsx("h4",{children:"Top Box (Passive/Reactive)"}),u.jsx("p",{className:"box-description",children:"Passive effects or reactive triggers"}),u.jsxs("div",{className:"effects-list",children:[t.topEffects.map((O,H)=>u.jsxs("div",{className:"effect-item",children:[u.jsxs("span",{onClick:()=>x("top",H),children:[O.trigger!=="passive"&&u.jsxs("strong",{children:[b(O.trigger),":"]})," ",Xa(O)]}),u.jsx("button",{onClick:()=>v("top",H),children:""})]},O.id)),t.topEffects.length===0&&u.jsx("p",{className:"empty-box",children:"No effects"})]}),u.jsxs("div",{className:"add-effect-controls",children:[u.jsxs("select",{id:"top-trigger",defaultValue:"",children:[u.jsx("option",{value:"",children:"Choose Trigger"}),u.jsx("optgroup",{label:"Passive",children:u.jsx("option",{value:"passive",children:"Passive (always active)"})}),u.jsxs("optgroup",{label:"Phase Triggers",children:[u.jsx("option",{value:"start",children:"Start Phase"}),u.jsx("option",{value:"end",children:"End Phase"}),u.jsx("option",{value:"on_cover",children:"On Cover"})]}),u.jsxs("optgroup",{label:"Reactive Triggers",children:[u.jsx("option",{value:"after_delete",children:"After you delete cards"}),u.jsx("option",{value:"after_opponent_discard",children:"After opponent discards"}),u.jsx("option",{value:"after_draw",children:"After you draw cards"}),u.jsx("option",{value:"after_clear_cache",children:"After you clear cache"}),u.jsx("option",{value:"before_compile_delete",children:"Before deleted by compile"}),u.jsx("option",{value:"after_flip",children:"After cards are flipped"}),u.jsx("option",{value:"after_shift",children:"After cards are shifted"}),u.jsx("option",{value:"after_play",children:"After cards are played"}),u.jsx("option",{value:"on_flip",children:"When this card would be flipped"})]})]}),u.jsxs("select",{id:"top-action",defaultValue:"",children:[u.jsx("option",{value:"",children:"Choose Action"}),u.jsx("option",{value:"draw",children:"Draw Cards"}),u.jsx("option",{value:"refresh",children:"Refresh Hand"}),u.jsx("option",{value:"mutual_draw",children:"Mutual Draw (Exchange)"}),u.jsx("option",{value:"flip",children:"Flip Cards"}),u.jsx("option",{value:"shift",children:"Shift Card"}),u.jsx("option",{value:"delete",children:"Delete Cards"}),u.jsx("option",{value:"discard",children:"Discard Cards"}),u.jsx("option",{value:"return",children:"Return to Hand"}),u.jsx("option",{value:"play",children:"Play from Hand/Deck"}),u.jsx("option",{value:"rearrange_protocols",children:"Rearrange Protocols"}),u.jsx("option",{value:"swap_protocols",children:"Swap Protocols"}),u.jsx("option",{value:"reveal",children:"Reveal Hand"}),u.jsx("option",{value:"give",children:"Give Cards"}),u.jsx("option",{value:"take",children:"Take from Hand"}),u.jsx("option",{value:"choice",children:"Either/Or Choice"}),u.jsx("option",{value:"passive_rule",children:"Passive Rule"}),u.jsx("option",{value:"value_modifier",children:"Value Modifier"})]}),u.jsx("button",{className:"btn btn-add-effect",onClick:()=>{const O=document.getElementById("top-trigger"),H=document.getElementById("top-action"),te=O.value,ne=H.value;te&&ne?(g("top",ne,te),O.value="",H.value=""):y(!0)},children:"+"})]})]}),u.jsxs("div",{className:"card-box middle-box",children:[u.jsx("h4",{children:"Middle Box (On Play)"}),u.jsx("p",{className:"box-description",children:"When played or uncovered"}),u.jsxs("div",{className:"effects-list",children:[t.middleEffects.map((O,H)=>u.jsxs("div",{className:"effect-item",children:[u.jsx("span",{onClick:()=>x("middle",H),children:Xa(O)}),u.jsx("button",{onClick:()=>v("middle",H),children:""})]},O.id)),t.middleEffects.length===0&&u.jsx("p",{className:"empty-box",children:"No effects"})]}),u.jsxs("select",{onChange:O=>{O.target.value&&(g("middle",O.target.value,"on_play"),O.target.value="")},children:[u.jsx("option",{value:"",children:"+ Add Effect"}),u.jsx("option",{value:"draw",children:"Draw Cards"}),u.jsx("option",{value:"refresh",children:"Refresh Hand"}),u.jsx("option",{value:"flip",children:"Flip Cards"}),u.jsx("option",{value:"shift",children:"Shift Card"}),u.jsx("option",{value:"delete",children:"Delete Cards"}),u.jsx("option",{value:"discard",children:"Discard Cards"}),u.jsx("option",{value:"return",children:"Return to Hand"}),u.jsx("option",{value:"play",children:"Play from Hand/Deck"}),u.jsx("option",{value:"rearrange_protocols",children:"Rearrange Protocols"}),u.jsx("option",{value:"swap_protocols",children:"Swap Protocols"}),u.jsx("option",{value:"reveal",children:"Reveal Hand"}),u.jsx("option",{value:"give",children:"Give Cards"}),u.jsx("option",{value:"take",children:"Take from Hand"}),u.jsx("option",{value:"choice",children:"Either/Or Choice"}),u.jsx("option",{value:"passive_rule",children:"Passive Rule"}),u.jsx("option",{value:"value_modifier",children:"Value Modifier"})]})]}),u.jsxs("div",{className:"card-box bottom-box",children:[u.jsx("h4",{children:"Bottom Box (Triggered)"}),u.jsx("p",{className:"box-description",children:"Only when uncovered AND face-up"}),u.jsxs("div",{className:"effects-list",children:[t.bottomEffects.map((O,H)=>u.jsxs("div",{className:"effect-item",children:[u.jsxs("span",{onClick:()=>x("bottom",H),children:[u.jsxs("strong",{children:[b(O.trigger),":"]})," ",Xa(O)]}),u.jsx("button",{onClick:()=>v("bottom",H),children:""})]},O.id)),t.bottomEffects.length===0&&u.jsx("p",{className:"empty-box",children:"No effects"})]}),u.jsxs("div",{className:"bottom-effect-add",children:[u.jsxs("select",{id:"bottom-trigger",children:[u.jsx("option",{value:"",children:"1. Choose Trigger"}),u.jsx("option",{value:"start",children:"Start Phase"}),u.jsx("option",{value:"end",children:"End Phase"}),u.jsx("option",{value:"on_cover",children:"On Cover"})]}),u.jsxs("select",{id:"bottom-action",children:[u.jsx("option",{value:"",children:"2. Choose Effect"}),u.jsx("option",{value:"draw",children:"Draw Cards"}),u.jsx("option",{value:"refresh",children:"Refresh Hand"}),u.jsx("option",{value:"mutual_draw",children:"Mutual Draw (Exchange)"}),u.jsx("option",{value:"flip",children:"Flip Cards"}),u.jsx("option",{value:"shift",children:"Shift Card"}),u.jsx("option",{value:"delete",children:"Delete Cards"}),u.jsx("option",{value:"discard",children:"Discard Cards"}),u.jsx("option",{value:"return",children:"Return to Hand"}),u.jsx("option",{value:"play",children:"Play from Hand/Deck"}),u.jsx("option",{value:"rearrange_protocols",children:"Rearrange Protocols"}),u.jsx("option",{value:"swap_protocols",children:"Swap Protocols"}),u.jsx("option",{value:"reveal",children:"Reveal Hand"}),u.jsx("option",{value:"give",children:"Give Cards"}),u.jsx("option",{value:"take",children:"Take from Hand"}),u.jsx("option",{value:"choice",children:"Either/Or Choice"}),u.jsx("option",{value:"passive_rule",children:"Passive Rule"}),u.jsx("option",{value:"value_modifier",children:"Value Modifier"})]}),u.jsx("button",{className:"btn btn-add-effect",onClick:()=>{const O=document.getElementById("bottom-trigger"),H=document.getElementById("bottom-action"),te=O.value,ne=H.value;te&&ne?(g("bottom",ne,te),O.value="",H.value=""):y(!0)},children:"+"})]})]})]})})]}),c&&u.jsxs("div",{className:"effect-parameter-editor",children:[u.jsx("h3",{children:"Configure Effect"}),u.jsx(i1,{effect:c.effect,onChange:C}),u.jsx("button",{onClick:()=>s(null),className:"btn",children:"Done"})]}),f&&u.jsx("div",{className:"custom-protocol-modal-overlay",onClick:()=>p(null),children:u.jsxs("div",{className:"custom-protocol-modal-content",onClick:O=>O.stopPropagation(),children:[u.jsx("h3",{children:"Delete Effect"}),u.jsx("p",{children:"Are you sure you want to delete this effect?"}),u.jsxs("div",{className:"custom-protocol-modal-actions",children:[u.jsx("button",{onClick:()=>p(null),className:"btn btn-back",children:"Cancel"}),u.jsx("button",{onClick:w,className:"btn btn-delete",children:"Delete"})]})]})}),h&&u.jsx("div",{className:"custom-protocol-modal-overlay",onClick:()=>y(!1),children:u.jsxs("div",{className:"custom-protocol-modal-content",onClick:O=>O.stopPropagation(),children:[u.jsx("h3",{children:"Missing Selection"}),u.jsx("p",{children:"Please select both a trigger and an effect before adding."}),u.jsx("div",{className:"custom-protocol-modal-actions",children:u.jsx("button",{onClick:()=>y(!1),className:"btn",children:"OK"})})]})})]})},u1=t=>{switch(t){case"draw":return{action:"draw",count:1,target:"self",source:"own_deck"};case"flip":return{action:"flip",count:1,targetFilter:{owner:"any",position:"any",faceState:"any",excludeSelf:!1},optional:!1};case"shift":return{action:"shift",targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1}};case"delete":return{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"any"},excludeSelf:!0};case"discard":return{action:"discard",count:1,actor:"self"};case"return":return{action:"return",count:1,targetFilter:{},scope:{type:"any_card"}};case"play":return{action:"play",source:"hand",count:1,faceDown:!0,destinationRule:{type:"other_lines"}};case"rearrange_protocols":return{action:"rearrange_protocols",target:"own"};case"swap_protocols":return{action:"swap_protocols",target:"own"};case"reveal":case"give":return{action:t,source:"own_hand",count:1};case"take":return{action:"take",source:"opponent_hand",count:1,random:!0};case"choice":return{action:"choice",options:[]};case"passive_rule":return{action:"passive_rule",rule:{type:"block_all_play",target:"opponent",scope:"this_lane"}};case"value_modifier":return{action:"value_modifier",modifier:{type:"add_per_condition",value:1,condition:"per_face_down_card",target:"own_total",scope:"this_lane"}};default:return{}}},p1=(t,o)=>{const a=(l,c)=>{l=l.replace("#","");const s=parseInt(l.substring(0,2),16),f=parseInt(l.substring(2,4),16),p=parseInt(l.substring(4,6),16);return`rgba(${s}, ${f}, ${p}, ${c})`},i={borderColor:o};switch(t){case"solid":return{...i,backgroundColor:o};case"radial":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`radial-gradient(circle at 50% 50%, ${a(o,.25)} 0%, transparent 60%)`};case"dual-radial":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 0% 0%, ${a(o,.2)}, transparent 50%),
                    radial-gradient(at 100% 100%, ${a(o,.2)}, transparent 50%)
                `};case"multi-radial":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 0%, ${a(o,.2)}, transparent 70%),
                    radial-gradient(circle at 20% 30%, ${a(o,.15)}, transparent 40%),
                    radial-gradient(circle at 80% 70%, ${a(o,.2)}, transparent 50%)
                `};case"chaos":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 10% 10%, hsla(60, 100%, 50%, 0.15), transparent 30%),
                    radial-gradient(at 90% 20%, hsla(180, 100%, 50%, 0.15), transparent 35%),
                    radial-gradient(at 30% 80%, hsla(300, 100%, 50%, 0.15), transparent 40%),
                    radial-gradient(at 70% 60%, hsla(0, 100%, 50%, 0.1), transparent 25%)
                `};case"grid":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(circle at 50% 50%, ${a(o,.2)} 0%, transparent 40%),
                    linear-gradient(hsla(0,0%,100%,0.03) 1px, transparent 1px),
                    linear-gradient(90deg, hsla(0,0%,100%,0.03) 1px, transparent 1px)
                `,backgroundSize:"100% 100%, 20px 20px, 20px 20px"};case"diagonal-lines":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 0% 100%, ${a(o,.25)}, transparent 70%),
                    repeating-linear-gradient(120deg, transparent, transparent 15px, ${a(o,.05)} 15px, ${a(o,.05)} 30px)
                `};case"cross-diagonal":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 50%, ${a(o,.25)} 0%, transparent 50%),
                    repeating-linear-gradient(45deg, transparent, transparent 8px, ${a(o,.08)} 8px, ${a(o,.08)} 16px),
                    repeating-linear-gradient(-45deg, transparent, transparent 8px, ${a(o,.06)} 8px, ${a(o,.06)} 16px)
                `};case"horizontal-lines":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 80% 80%, ${a(o,.1)}, transparent 50%),
                    repeating-linear-gradient(0deg, hsla(0,0%,100%,0.02), hsla(0,0%,100%,0.02) 1px, transparent 1px, transparent 3px)
                `};case"vertical-lines":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 10% 10%, ${a(o,.2)}, transparent 50%),
                    repeating-linear-gradient(175deg, transparent, transparent 1px, ${a(o,.05)} 1px, ${a(o,.05)} 2px)
                `};case"cross":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    linear-gradient(0deg, transparent 40%, ${a(o,.1)} 50%, transparent 60%),
                    linear-gradient(90deg, transparent 48%, ${a(o,.2)} 50%, transparent 52%)
                `};case"hexagons":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 0%, ${a(o,.2)}, transparent 70%),
                    url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='28' height='49' viewBox='0 0 28 49'%3E%3Cg fill-rule='evenodd'%3E%3Cg id='hexagons' fill='%23ffffff' fill-opacity='0.05' fill-rule='nonzero'%3E%3Cpath d='M13.99 9.25l13 7.5v15l-13 7.5L1 31.75v-15l12.99-7.5zM3 17.9v12.7l10.99 6.34 11-6.35V17.9l-11-6.34L3 17.9zM0 15l12.99-7.5L26 15v18.5l-13 7.5L0 33.5V15z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")
                `};case"stripes":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 100%, ${a(o,.25)}, transparent 60%),
                    linear-gradient(135deg, hsla(0,0%,0%,0.1) 23%, transparent 23%, transparent 25%, hsla(0,0%,0%,0.1) 25%, hsla(0,0%,0%,0.1) 27%, transparent 27%, transparent 73%, hsla(0,0%,0%,0.1) 73%, hsla(0,0%,0%,0.1) 75%, transparent 75%, transparent 77%, hsla(0,0%,0%,0.1) 77%)
                `};case"frost":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(circle at 50% 50%, ${a(o,.2)} 0%, transparent 50%),
                    repeating-linear-gradient(30deg, transparent, transparent 10px, ${a(o,.08)} 10px, ${a(o,.08)} 11px),
                    repeating-linear-gradient(-30deg, transparent, transparent 10px, ${a(o,.08)} 10px, ${a(o,.08)} 11px),
                    repeating-linear-gradient(90deg, transparent, transparent 8px, ${a(o,.05)} 8px, ${a(o,.05)} 9px)
                `};default:return i}},f1=[{name:"Anarchy",hex:"#EA5A3C"},{name:"Apathy",hex:"#989A9A"},{name:"Chaos",hex:"#E53FE5"},{name:"Darkness",hex:"#A772D4"},{name:"Death",hex:"#E25656"},{name:"Fire",hex:"#F06838"},{name:"Gravity",hex:"#7599EB"},{name:"Hate",hex:"#E03E5E"},{name:"Life",hex:"#3CE076"},{name:"Light",hex:"#FFEB7F"},{name:"Love",hex:"#F074D9"},{name:"Metal",hex:"#B3B8BD"},{name:"Plague",hex:"#A2CD3A"},{name:"Psychic",hex:"#C971EB"},{name:"Speed",hex:"#33DDDD"},{name:"Spirit",hex:"#42D4A8"},{name:"Water",hex:"#3FA4EB"}],h1=[{name:"Solid",value:"solid",description:"Solid color background"},{name:"Radial Glow",value:"radial",description:"Single radial gradient glow"},{name:"Dual Radial",value:"dual-radial",description:"Two radial gradient spots"},{name:"Multi Radial",value:"multi-radial",description:"Multiple radial gradient spots"},{name:"Chaos",value:"chaos",description:"Colorful chaotic spots"},{name:"Grid",value:"grid",description:"Grid line pattern"},{name:"Diagonal Lines",value:"diagonal-lines",description:"Repeating diagonal lines"},{name:"Cross Diagonal",value:"cross-diagonal",description:"Crossed diagonal lines"},{name:"Horizontal Lines",value:"horizontal-lines",description:"Fine horizontal lines"},{name:"Vertical Lines",value:"vertical-lines",description:"Fine vertical lines"},{name:"Cross Pattern",value:"cross",description:"Cross/plus pattern"},{name:"Hexagons",value:"hexagons",description:"Hexagon pattern"},{name:"Stripes",value:"stripes",description:"Diagonal stripe pattern"},{name:"Frost",value:"frost",description:"Icy crystalline pattern with crossing lines"}],_1=({onSave:t,onCancel:o,onDelete:a,initialProtocol:i})=>{const[l,c]=J.useState("name"),[s,f]=J.useState(0),[p,h]=J.useState(!1),[y,g]=J.useState(""),[v,w]=J.useState(!1);console.log("ProtocolWizard render - initialProtocol:",i);const[C,x]=J.useState((i==null?void 0:i.name)||""),[b,E]=J.useState((i==null?void 0:i.description)||""),[S,j]=J.useState((i==null?void 0:i.color)||"#1976D2"),[R,A]=J.useState((i==null?void 0:i.pattern)||"solid"),[N,I]=J.useState((i==null?void 0:i.cards)||[{value:0,topEffects:[],middleEffects:[],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[],bottomEffects:[]}]);console.log("ProtocolWizard state - name:",C,"color:",S,"pattern:",R);const V=()=>{if(l==="name"){if(!C.trim()){alert("Please enter a protocol name.");return}c("color")}else l==="color"?c("pattern"):l==="pattern"&&c("cards")},L=F=>{const B=[...N];B[s]=F,I(B)},D=()=>{const F={id:(i==null?void 0:i.id)||Oe(),name:C,description:b,author:"Player",createdAt:(i==null?void 0:i.createdAt)||new Date().toISOString(),color:S,pattern:R,cards:N};t(F)},O=()=>{i&&a&&a(i.id),w(!1)},H=()=>{const F={id:(i==null?void 0:i.id)||Oe(),name:C,description:b,author:"Player",createdAt:(i==null?void 0:i.createdAt)||new Date().toISOString(),color:S,pattern:R,cards:N},B=JSON.stringify(F,null,2);g(B),h(!0)},te=()=>{navigator.clipboard.writeText(y).then(()=>{alert("Protocol JSON copied to clipboard!"),h(!1)}).catch(()=>{alert("Failed to copy to clipboard. Please try again.")})},ne=F=>!(!C.trim()&&F!=="name"),z=F=>{if(!ne(F)){alert("Please enter a protocol name first.");return}c(F)};return u.jsxs("div",{className:"protocol-wizard",children:[u.jsxs("div",{className:"wizard-header",children:[u.jsx("h2",{children:i?`Edit Protocol: ${C}`:"Create New Protocol"}),u.jsxs("div",{className:"wizard-progress",children:[u.jsx("button",{className:`step ${l==="name"?"active":"done"}`,onClick:()=>z("name"),type:"button",children:"1. Name"}),u.jsx("button",{className:`step ${l==="color"?"active":l==="pattern"||l==="cards"?"done":""}`,onClick:()=>z("color"),disabled:!ne("color"),type:"button",children:"2. Color"}),u.jsx("button",{className:`step ${l==="pattern"?"active":l==="cards"?"done":""}`,onClick:()=>z("pattern"),disabled:!ne("pattern"),type:"button",children:"3. Pattern"}),u.jsx("button",{className:`step ${l==="cards"?"active":""}`,onClick:()=>z("cards"),disabled:!ne("cards"),type:"button",children:"4. Cards"})]})]}),u.jsxs("div",{className:"wizard-content",children:[l==="name"&&u.jsxs("div",{className:"wizard-step name-step",children:[u.jsx("h3",{children:"Step 1: Name and Description"}),u.jsxs("label",{children:["Protocol Name *",u.jsx("input",{type:"text",value:C,onChange:F=>x(F.target.value),placeholder:"e.g. Lightning, Shadow, Void",autoFocus:!0})]}),u.jsxs("label",{children:["Description",u.jsx("textarea",{value:b,onChange:F=>E(F.target.value),placeholder:"Describe the strategy and theme of your protocol",rows:4})]})]}),l==="color"&&u.jsxs("div",{className:"wizard-step color-step",children:[u.jsx("h3",{children:"Step 2: Choose Color"}),u.jsx("div",{className:"color-preview",style:{backgroundColor:S},children:u.jsx("span",{children:C||"Your Protocol"})}),u.jsx("h4",{children:"Predefined Colors"}),u.jsx("div",{className:"color-grid",children:f1.map(F=>u.jsx("button",{className:`color-option ${S===F.hex?"selected":""}`,style:{backgroundColor:F.hex},onClick:()=>j(F.hex),title:F.name,children:S===F.hex&&""},F.hex))}),u.jsx("h4",{children:"Custom Color"}),u.jsxs("div",{className:"custom-color",children:[u.jsx("input",{type:"color",value:S,onChange:F=>j(F.target.value)}),u.jsx("input",{type:"text",value:S,onChange:F=>j(F.target.value),placeholder:"#1976D2"})]})]}),l==="pattern"&&u.jsxs("div",{className:"wizard-step pattern-step",children:[u.jsx("h3",{children:"Step 3: Choose Card Pattern"}),u.jsx("div",{className:"pattern-selection-grid",children:h1.map(F=>{const B=p1(F.value,S);return u.jsxs("div",{className:`pattern-option ${R===F.value?"selected":""}`,onClick:()=>A(F.value),children:[u.jsxs("div",{className:"pattern-preview",style:B,children:[C||"Protocol","-0"]}),u.jsx("h4",{children:F.name}),u.jsx("p",{children:F.description}),R===F.value&&u.jsx("div",{className:"selected-badge",children:" Selected"})]},F.value)})})]}),l==="cards"&&u.jsxs("div",{className:"wizard-step cards-step",children:[u.jsx("h3",{children:"Step 4: Configure Cards"}),u.jsx("div",{className:"card-navigation",children:N.map((F,B)=>u.jsxs("button",{className:`card-nav-btn ${s===B?"active":""}`,onClick:()=>f(B),type:"button",children:["Card ",F.value]},B))}),u.jsx(d1,{card:N[s],protocolName:C,protocolColor:S,protocolPattern:R,onChange:L})]})]}),u.jsxs("div",{className:"wizard-actions",children:[u.jsxs("div",{className:"wizard-actions-left",children:[u.jsx("button",{onClick:o,className:"btn btn-back",children:"Cancel"}),i&&a&&u.jsx("button",{onClick:()=>w(!0),className:"btn btn-delete",children:"Delete Protocol"})]}),u.jsxs("div",{className:"wizard-actions-right",children:[i&&u.jsxs(u.Fragment,{children:[u.jsx("button",{onClick:H,className:"btn btn-export",children:"Export JSON"}),u.jsx("button",{onClick:D,className:"btn",children:"Save"})]}),!i&&u.jsxs(u.Fragment,{children:[l!=="cards"&&u.jsx("button",{onClick:V,className:"btn",children:"Next"}),l==="cards"&&u.jsxs(u.Fragment,{children:[u.jsx("button",{onClick:H,className:"btn btn-export",children:"Export JSON"}),u.jsx("button",{onClick:D,className:"btn",children:"Save"})]})]})]})]}),p&&u.jsx("div",{className:"custom-protocol-modal-overlay",onClick:()=>h(!1),children:u.jsxs("div",{className:"custom-protocol-modal-content custom-protocol-modal-large",onClick:F=>F.stopPropagation(),children:[u.jsx("h3",{children:"Export Protocol JSON"}),u.jsx("p",{children:"Copy the JSON below to share or backup your protocol:"}),u.jsx("textarea",{value:y,readOnly:!0,rows:15,className:"export-textarea",onClick:F=>F.target.select()}),u.jsxs("div",{className:"custom-protocol-modal-actions",children:[u.jsx("button",{onClick:()=>h(!1),className:"btn btn-back",children:"Close"}),u.jsx("button",{onClick:te,className:"btn",children:"Copy to Clipboard"})]})]})}),v&&u.jsx("div",{className:"custom-protocol-modal-overlay",onClick:()=>w(!1),children:u.jsxs("div",{className:"custom-protocol-modal-content",onClick:F=>F.stopPropagation(),children:[u.jsx("h3",{children:"Delete Protocol"}),u.jsxs("p",{children:['Are you sure you want to delete "',C,'"?']}),u.jsx("p",{style:{color:"var(--danger-color)",fontSize:"0.9rem"},children:"This action cannot be undone."}),u.jsxs("div",{className:"custom-protocol-modal-actions",children:[u.jsx("button",{onClick:()=>w(!1),className:"btn btn-back",children:"Cancel"}),u.jsx("button",{onClick:O,className:"btn btn-delete",children:"Delete"})]})]})})]})},y1=({onBack:t})=>{const[o,a]=J.useState("list"),[i,l]=J.useState([]),[c,s]=J.useState(void 0);J.useEffect(()=>{f()},[]);const f=()=>{const C=$c();l(C)},p=()=>{s(void 0),a("create")},h=C=>{console.log("handleEdit called with protocol:",C),s(C),a("edit"),console.log("View set to edit, editingProtocol:",C)},y=C=>{Bw(C),tl(),f(),a("list"),s(void 0)},g=C=>{fn(C),tl(),f(),a("list"),s(void 0)},v=C=>{fn(C),tl(),f()},w=()=>{a("list"),s(void 0)};return u.jsxs("div",{className:"custom-protocol-creator",children:[o==="list"&&u.jsx(zw,{protocols:i,onCreateNew:p,onEdit:h,onDelete:y,onImport:v,onBack:t}),(o==="create"||o==="edit")&&u.jsx(_1,{onSave:g,onCancel:w,onDelete:y,initialProtocol:c})]})},g1="anarchy-custom-001",m1="Anarchy_custom",v1="Custom recreation of Anarchy protocol to validate editor capabilities",w1="System Validation",C1="2025-11-08T00:00:00.000Z",x1="#8B0000",S1="chaos",b1=[{value:0,topEffects:[],middleEffects:[{id:"anarchy-0-shift",params:{action:"shift",targetFilter:{owner:"any",position:"uncovered",faceState:"any"}},position:"middle",trigger:"on_play"},{id:"anarchy-0-draw",params:{action:"draw",count:1,target:"self",source:"own_deck",conditional:{type:"non_matching_protocols"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[{id:"anarchy-1-passive",params:{action:"passive_rule",rule:{type:"require_non_matching_protocol",target:"all",scope:"global"}},position:"top",trigger:"passive"}],middleEffects:[{id:"anarchy-1-shift",params:{action:"shift",targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!0},destinationRestriction:{type:"non_matching_protocol"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"anarchy-2-delete",params:{action:"delete",count:1,targetFilter:{position:"any",faceState:"face_up"},protocolMatching:"must_match",excludeSelf:!1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"anarchy-3-swap",params:{action:"swap_protocols",target:"opponent"},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"anarchy-3-end-rearrange",params:{action:"rearrange_protocols",target:"own",restriction:{disallowedProtocol:"Anarchy_custom",laneIndex:"current"}},position:"bottom",trigger:"end"}]},{value:5,topEffects:[],middleEffects:[{id:"anarchy-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:6,topEffects:[{id:"anarchy-6-start-flip",params:{action:"flip",count:1,flipSelf:!0,optional:!1,targetFilter:{owner:"any",position:"any",faceState:"any",excludeSelf:!1},advancedConditional:{type:"protocol_match",protocol:"Anarchy_custom"}},position:"top",trigger:"start"}],middleEffects:[],bottomEffects:[]}],E1={id:g1,name:m1,description:v1,author:w1,createdAt:C1,color:x1,pattern:S1,cards:b1},R1="apathy_custom",A1="Apathy_custom",j1="Custom implementation of Apathy protocol",k1="System",D1="2025-01-08T00:00:00Z",T1="#9E9E9E",F1="radial",q1=[{value:0,topEffects:[{id:"apathy-0-value-modifier",params:{action:"value_modifier",modifier:{type:"add_per_condition",value:1,condition:"per_face_down_card",target:"own_total",scope:"this_lane"}},position:"top",trigger:"passive"}],middleEffects:[],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"apathy-1-flip-all",params:{action:"flip",count:"all",optional:!1,scope:"this_lane",targetFilter:{owner:"any",position:"any",faceState:"face_up",excludeSelf:!0}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:2,topEffects:[{id:"apathy-2-passive",params:{action:"passive_rule",rule:{type:"ignore_middle_commands",target:"all",scope:"this_lane"}},position:"top",trigger:"passive"}],middleEffects:[],bottomEffects:[{id:"apathy-2-on-cover",params:{action:"flip",count:1,flipSelf:!0,optional:!1,targetFilter:{owner:"any",position:"any",faceState:"any",excludeSelf:!1}},position:"bottom",trigger:"on_cover"}]},{value:3,topEffects:[],middleEffects:[{id:"apathy-3-flip-opponent",params:{action:"flip",count:1,optional:!1,targetFilter:{owner:"opponent",position:"uncovered",faceState:"face_up",excludeSelf:!1}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"apathy-4-flip-covered",params:{action:"flip",count:1,optional:!0,targetFilter:{owner:"own",position:"covered",faceState:"face_up",excludeSelf:!1}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"apathy-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],N1={id:R1,name:A1,description:j1,author:k1,createdAt:D1,color:T1,pattern:F1,cards:q1},U1="chaos_custom_1",$1="Chaos_custom",O1="Embrace the unpredictable. Custom protocol migration of original Chaos protocol.",L1="#E64DB8",P1="chaos",I1=[{value:0,topEffects:[],middleEffects:[{id:"chaos_0_flip_covered",trigger:"on_play",params:{action:"flip",count:1,scope:"each_lane",targetFilter:{owner:"any",position:"covered",faceState:"any"}},position:"middle"}],bottomEffects:[{id:"chaos_0_start_swap_draws",trigger:"start",params:{action:"mutual_draw",count:1},position:"bottom"}]},{value:1,topEffects:[],middleEffects:[{id:"chaos_1_rearrange_own",trigger:"on_play",params:{action:"rearrange_protocols",target:"own"},position:"middle"},{id:"chaos_1_rearrange_opponent",trigger:"on_play",params:{action:"rearrange_protocols",target:"opponent"},position:"middle"}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"chaos_2_shift_covered",trigger:"on_play",params:{action:"shift",count:1,targetFilter:{owner:"own",position:"covered",faceState:"any"}},position:"middle"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[],bottomEffects:[{id:"chaos_3_allow_any_protocol",trigger:"passive",params:{action:"passive_rule",rule:{type:"allow_any_protocol_play",target:"self",scope:"global"}},position:"bottom"}]},{value:4,topEffects:[],middleEffects:[],bottomEffects:[{id:"chaos_4_end_discard_draw",trigger:"end",params:{action:"discard",count:"all",actor:"self"},conditional:{type:"then",thenEffect:{id:"chaos_4_draw_after_discard",trigger:"on_play",params:{action:"draw",count:1,countType:"equal_to_discarded",countOffset:0,target:"self",source:"own_deck"},position:"bottom"}},position:"bottom"}]},{value:5,topEffects:[],middleEffects:[{id:"chaos_5_discard",trigger:"on_play",params:{action:"discard",count:1,actor:"self"},position:"middle"}],bottomEffects:[]}],M1={id:U1,name:$1,description:O1,color:L1,pattern:P1,cards:I1},H1="dark_cust_v2",B1="Dark_cust",V1="Custom Darkness protocol - manipulate face-down cards, flip and shift",z1="System",G1="2025-01-08T00:00:00Z",Y1="#1a0033",W1="grid",Q1=[{value:0,topEffects:[],middleEffects:[{id:"dark-0-draw",params:{action:"draw",count:3,target:"self",source:"own_deck"},position:"middle",trigger:"on_play"},{id:"dark-0-shift",params:{action:"shift",targetFilter:{owner:"opponent",position:"covered",faceState:"any",excludeSelf:!1},destinationRestriction:{type:"any"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"dark-1-flip",params:{action:"flip",count:1,optional:!1,targetFilter:{owner:"opponent",position:"uncovered",faceState:"any",excludeSelf:!1}},position:"middle",trigger:"on_play"},{id:"dark-1-shift",params:{action:"shift",optional:!0,targetFilter:{owner:"any",position:"any",faceState:"any",excludeSelf:!1},destinationRestriction:{type:"any"}},position:"middle",trigger:"on_play",useCardFromPreviousEffect:!0}],bottomEffects:[]},{value:2,topEffects:[{id:"dark-2-value-modifier",params:{action:"value_modifier",modifier:{type:"set_to_fixed",value:4,target:"own_cards",scope:"this_lane",filter:{faceState:"face_down",position:"any"}}},position:"top",trigger:"passive"}],middleEffects:[{id:"dark-2-flip",params:{action:"flip",count:1,optional:!0,scope:"this_lane",targetFilter:{owner:"any",position:"covered",faceState:"any",excludeSelf:!1}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"dark-3-play",params:{action:"play",source:"hand",count:1,faceDown:!0,destinationRule:{type:"other_lines",excludeCurrentLane:!0}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"dark-4-shift",params:{action:"shift",targetFilter:{owner:"any",position:"uncovered",faceState:"face_down",excludeSelf:!1},destinationRestriction:{type:"any"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"dark-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],X1={id:H1,name:B1,description:V1,author:z1,createdAt:G1,color:Y1,pattern:W1,cards:Q1},Z1="death_custom_v1",K1="Death_cust",J1="Custom Death protocol - delete cards with various conditions",eC="System",tC="2025-01-09T00:00:00Z",nC="#8B0000",oC="stripes",aC=[{value:0,topEffects:[],middleEffects:[{id:"death-0-delete-from-each-lane",params:{action:"delete",count:1,scope:{type:"each_other_line"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[{id:"death-1-optional-draw",params:{action:"draw",count:1,optional:!0},position:"top",trigger:"start",conditional:{type:"if_executed",thenEffect:{id:"death-1-delete-other",params:{action:"delete",count:1,excludeSelf:!0},position:"top",trigger:"start",conditional:{type:"then",thenEffect:{id:"death-1-delete-self",params:{action:"delete",count:1,targetFilter:{position:"any",owner:"own"},deleteSelf:!0},position:"top",trigger:"start"}}}}}],middleEffects:[],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"death-2-delete-lane-values",params:{action:"delete",count:"all",selectLane:!0,targetFilter:{faceState:"any",valueRange:{min:1,max:2}}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"death-3-delete-facedown",params:{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"face_down"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"death-4-delete-low-value",params:{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"face_up",valueRange:{min:0,max:1}}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"death-5-discard",params:{action:"discard",count:1},position:"middle",trigger:"on_play"}],bottomEffects:[]}],rC={id:Z1,name:K1,description:J1,author:eC,createdAt:tC,color:nC,pattern:oC,cards:aC},lC="fire-custom-001",cC="Fire_custom",sC="Fire protocol - discard cards to fuel powerful effects",iC="System",dC="2025-11-09T00:00:00.000Z",uC="#F06838",pC="radial",fC=[{value:0,topEffects:[],middleEffects:[{id:"fire-0-flip",params:{action:"flip",count:1,targetFilter:{excludeSelf:!0}},position:"middle",trigger:"on_play"},{id:"fire-0-draw",params:{action:"draw",count:2},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"fire-0-oncover-draw",params:{action:"draw",count:1},position:"bottom",trigger:"on_cover",conditional:{type:"then",thenEffect:{id:"fire-0-oncover-flip",params:{action:"flip",count:1,targetFilter:{excludeSelf:!0}},position:"bottom",trigger:"on_cover"}}}]},{value:1,topEffects:[],middleEffects:[{id:"fire-1-discard",params:{action:"discard",count:1},position:"middle",trigger:"on_play",conditional:{type:"if_executed",thenEffect:{id:"fire-1-delete",params:{action:"delete",count:1},position:"middle",trigger:"on_play"}}}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"fire-2-discard",params:{action:"discard",count:1},position:"middle",trigger:"on_play",conditional:{type:"if_executed",thenEffect:{id:"fire-2-return",params:{action:"return",count:1},position:"middle",trigger:"on_play"}}}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[],bottomEffects:[{id:"fire-3-discard",params:{action:"discard",count:1,optional:!0},position:"bottom",trigger:"end",conditional:{type:"if_executed",thenEffect:{id:"fire-3-flip",params:{action:"flip",count:1},position:"bottom",trigger:"end"}}}]},{value:4,topEffects:[],middleEffects:[{id:"fire-4-discard-variable",params:{action:"discard",count:1,variableCount:!0},position:"middle",trigger:"on_play",conditional:{type:"then",thenEffect:{id:"fire-4-draw-based-on-discard",params:{action:"draw",countType:"equal_to_discarded",countOffset:1},position:"middle",trigger:"on_play"}}}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"fire-5-discard",params:{action:"discard",count:1,optional:!1},position:"middle",trigger:"on_play"}],bottomEffects:[]}],hC={id:lC,name:cC,description:sC,author:iC,createdAt:dC,color:uC,pattern:pC,cards:fC},_C="frost_custom_1",yC="Frost_custom",gC="Freeze the game state. Frost blocks actions and preserves face-down cards.",mC="#87CEEB",vC="frost",wC=[{value:0,topEffects:[],middleEffects:[{id:"frost_0_draw_per_face_down",trigger:"on_play",position:"middle",params:{action:"draw",count:1,source:"own_deck",target:"self",countType:"count_face_down"}}],bottomEffects:[]},{value:1,topEffects:[{id:"frost_1_block_flips",trigger:"passive",position:"top",params:{action:"passive_rule",rule:{type:"block_flips",target:"all",scope:"global"}}}],middleEffects:[],bottomEffects:[{id:"frost_1_block_rearrange",trigger:"passive",position:"bottom",params:{action:"passive_rule",rule:{type:"block_protocol_rearrange",target:"all",scope:"global"}}}]},{value:2,topEffects:[],middleEffects:[{id:"frost_2_play_face_down",trigger:"on_play",position:"middle",params:{action:"play",count:1,source:"hand",faceDown:!0}}],bottomEffects:[]},{value:3,topEffects:[{id:"frost_3_block_shifts",trigger:"passive",position:"top",params:{action:"passive_rule",rule:{type:"block_shifts_from_and_to_lane",target:"all",scope:"this_lane"}}}],middleEffects:[],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"frost_4_flip_covered",trigger:"on_play",position:"middle",params:{action:"flip",count:1,optional:!0,targetFilter:{owner:"own",faceState:"face_up",position:"covered"}}}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"frost_5_discard",trigger:"on_play",position:"middle",params:{action:"discard",count:1,target:"self"}}],bottomEffects:[]}],CC={id:_C,name:yC,description:gC,color:mC,pattern:vC,cards:wC},xC="hate-custom-001",SC="Hate_custom",bC="Focused on deletion and sacrifice. Delete cards to gain advantage.",EC="System Migration",RC="2025-11-13T00:00:00.000Z",AC="#E67A7A",jC="diagonal-lines",kC=[{value:0,topEffects:[],middleEffects:[{id:"hate-0-delete",params:{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"any"},scope:{type:"anywhere"},excludeSelf:!1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"hate-1-discard",params:{action:"discard",count:3,actor:"self",upTo:!0},position:"middle",trigger:"on_play"},{id:"hate-1-delete-1",params:{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"any"},scope:{type:"anywhere"},excludeSelf:!1,upTo:!0},position:"middle",trigger:"on_play"},{id:"hate-1-delete-2",params:{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"any"},scope:{type:"anywhere"},excludeSelf:!1,upTo:!0},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"hate-2-delete-own",params:{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"any",calculation:"highest_value",owner:"own"},scope:{type:"anywhere"},excludeSelf:!1},position:"middle",trigger:"on_play"},{id:"hate-2-delete-opponent",params:{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"any",calculation:"highest_value",owner:"opponent"},scope:{type:"anywhere"},excludeSelf:!1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[{id:"hate-3-reactive-draw",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"top",trigger:"after_delete",reactiveTriggerActor:"self"}],middleEffects:[],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[],bottomEffects:[{id:"hate-4-on-cover-delete",params:{action:"delete",count:1,targetFilter:{position:"covered_by_context",faceState:"any",calculation:"lowest_value"},scope:{type:"this_line"},excludeSelf:!1,autoExecute:!0},position:"bottom",trigger:"on_cover"}]},{value:5,topEffects:[],middleEffects:[{id:"hate-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],DC={id:xC,name:SC,description:bC,author:EC,createdAt:RC,color:AC,pattern:jC,cards:kC},TC="water_custom_1",FC="Water_custom",qC="Wash away and renew. Custom protocol migration of original Water protocol.",NC="#5DADE2",UC="multi-radial",$C=[{value:0,topEffects:[],middleEffects:[{id:"water_0_flip_other",trigger:"immediate",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!0},optional:!1},position:"middle"},{id:"water_0_flip_self",trigger:"immediate",params:{action:"flip",flipSelf:!0},position:"middle"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"water_1_play",trigger:"immediate",params:{action:"play",source:"deck",count:1,faceDown:!0,destinationRule:{type:"each_other_line"}},position:"middle"}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"water_2_draw",trigger:"immediate",params:{action:"draw",count:2},position:"middle"},{id:"water_2_rearrange",trigger:"immediate",params:{action:"rearrange_protocols",target:"own"},position:"middle"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"water_3_return",trigger:"immediate",params:{action:"return",count:"all",targetFilter:{owner:"any",valueEquals:2},selectLane:!0},position:"middle"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"water_4_return",trigger:"immediate",params:{action:"return",count:1,targetFilter:{owner:"own"}},position:"middle"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"water_5_discard",trigger:"immediate",params:{action:"discard",count:1,actor:"self"},position:"middle"}],bottomEffects:[]}],OC={id:TC,name:FC,description:qC,color:NC,pattern:UC,cards:$C},LC="spirit_custom_1",PC="Spirit_custom",IC="True strength from within. Custom protocol migration of original Spirit protocol.",MC="#5DD9C1",HC="dual-radial",BC=[{value:0,topEffects:[],middleEffects:[{id:"spirit_0_refresh",trigger:"on_play",params:{action:"refresh",target:"self"},position:"middle"},{id:"spirit_0_draw",trigger:"on_play",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"middle"}],bottomEffects:[{id:"spirit_0_skip_cache",trigger:"passive",params:{action:"passive_rule",rule:{type:"skip_check_cache_phase",target:"self",scope:"global"}},position:"bottom"}]},{value:1,topEffects:[{id:"spirit_1_play_anywhere",trigger:"passive",params:{action:"passive_rule",rule:{type:"allow_any_protocol_play",target:"self",scope:"global"}},position:"top"}],middleEffects:[{id:"spirit_1_draw",trigger:"on_play",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"middle"}],bottomEffects:[{id:"spirit_1_choice",trigger:"start",params:{action:"choice",options:[{id:"spirit_1_choice_discard",trigger:"on_play",params:{action:"discard",count:1,actor:"self"},position:"bottom"},{id:"spirit_1_choice_flip",trigger:"on_play",params:{action:"flip",flipSelf:!0},position:"bottom"}]},position:"bottom"}]},{value:2,topEffects:[],middleEffects:[{id:"spirit_2_flip",trigger:"on_play",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1},optional:!0},position:"middle"}],bottomEffects:[]},{value:3,topEffects:[{id:"spirit_3_shift",trigger:"after_draw",reactiveTriggerActor:"self",params:{action:"shift",count:1,optional:!0,targetFilter:{owner:"own",position:"any",faceState:"any",excludeSelf:!1}},position:"top"}],middleEffects:[],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"spirit_4_swap",trigger:"on_play",params:{action:"swap_protocols",target:"own"},position:"middle"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"spirit_5_discard",trigger:"on_play",params:{action:"discard",count:1,actor:"self"},position:"middle"}],bottomEffects:[]}],VC={id:LC,name:PC,description:IC,color:MC,pattern:HC,cards:BC},zC="gravity_custom_1",GC="Gravity_custom",YC="Pull everything together. Gravity draws cards towards this line.",WC="#7599EB",QC="grid",XC=[{value:0,topEffects:[],middleEffects:[{id:"gravity_0_play_per_2_cards",trigger:"on_play",params:{action:"play",source:"deck",count:1,faceDown:!0,destinationRule:{type:"under_this_card"},condition:{type:"per_x_cards_in_line",cardCount:2},actor:"self"},position:"middle"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"gravity_1_draw_2",trigger:"on_play",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"middle"},{id:"gravity_1_shift_to_or_from",trigger:"on_play",params:{action:"shift",targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1},destinationRestriction:{type:"to_or_from_this_lane",laneIndex:"current"}},position:"middle"}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"gravity_2_flip",trigger:"on_play",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1},optional:!1},position:"middle"},{id:"gravity_2_shift_to_this_line",trigger:"on_play",params:{action:"shift",targetFilter:{owner:"any",position:"any",faceState:"any",excludeSelf:!1},destinationRestriction:{type:"to_this_lane",laneIndex:"current"}},position:"middle",useCardFromPreviousEffect:!0}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"gravity_4_shift_face_down_to_this_line",trigger:"on_play",params:{action:"shift",targetFilter:{owner:"any",position:"uncovered",faceState:"face_down",excludeSelf:!1},destinationRestriction:{type:"to_this_lane",laneIndex:"current"}},position:"middle"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"gravity_5_discard",trigger:"on_play",params:{action:"discard",count:1,actor:"self"},position:"middle"}],bottomEffects:[]},{value:6,topEffects:[],middleEffects:[{id:"gravity_6_opponent_plays",trigger:"on_play",params:{action:"play",source:"deck",count:1,faceDown:!0,destinationRule:{type:"specific_lane",laneIndex:"current"},actor:"opponent"},position:"middle",comment:"Opponent plays top of their deck in this line"}],bottomEffects:[]}],ZC={id:zC,name:GC,description:YC,color:WC,pattern:QC,cards:XC},KC="life_custom_1",JC="Life_custom",ex="Life begets more life. Play cards from your deck to grow your presence.",tx="#3CE076",nx="hexagons",ox=[{value:0,topEffects:[],middleEffects:[{id:"life_0_play_each_line_with_card",trigger:"on_play",position:"middle",params:{action:"play",source:"deck",count:1,faceDown:!0,destinationRule:{type:"each_line_with_card",ownerFilter:"own"},actor:"self"}}],bottomEffects:[{id:"life_0_on_cover_delete_self",trigger:"on_cover",position:"bottom",params:{action:"delete",deleteSelf:!0}}]},{value:1,topEffects:[],middleEffects:[{id:"life_1_flip_1",trigger:"on_play",position:"middle",params:{action:"flip",count:1,optional:!1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1}}},{id:"life_1_flip_2",trigger:"on_play",position:"middle",params:{action:"flip",count:1,optional:!1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1}}}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"life_2_draw",trigger:"on_play",position:"middle",params:{action:"draw",count:1,target:"self",source:"own_deck"}},{id:"life_2_flip",trigger:"on_play",position:"middle",params:{action:"flip",count:1,optional:!0,targetFilter:{owner:"any",position:"uncovered",faceState:"face_down",excludeSelf:!1}}}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[],bottomEffects:[{id:"life_3_on_cover_play",trigger:"on_cover",position:"bottom",params:{action:"play",source:"deck",count:1,faceDown:!0,destinationRule:{type:"another_line",excludeCurrentLane:!0},actor:"self"}}]},{value:4,topEffects:[],middleEffects:[{id:"life_4_conditional_draw",trigger:"on_play",position:"middle",params:{action:"draw",count:1,target:"self",source:"own_deck",conditional:{type:"is_covering"}}}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"life_5_discard",trigger:"on_play",position:"middle",params:{action:"discard",count:1,actor:"self"}}],bottomEffects:[]}],ax={id:KC,name:JC,description:ex,color:tx,pattern:nx,cards:ox},rx="light_custom_1",lx="Light_custom",cx="Burn away the dark. Light protocol reveals and manipulates through illumination.",sx="System",ix="2025-11-14T00:00:00.000Z",dx="#F4D03F",ux="radial",px=[{value:0,topEffects:[],middleEffects:[{id:"light-0-flip",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1},optional:!1},position:"middle",trigger:"on_play"},{id:"light-0-draw",params:{action:"draw",count:1,target:"self",source:"own_deck",countType:"equal_to_card_value"},position:"middle",trigger:"on_play",useCardFromPreviousEffect:!0}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[],bottomEffects:[{id:"light-1-draw",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"bottom",trigger:"end"}]},{value:2,topEffects:[],middleEffects:[{id:"light-2-draw",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"middle",trigger:"on_play"},{id:"light-2-reveal-board-card",params:{action:"reveal",source:"board",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"face_down"},optional:!0},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"light-3-shift-all",params:{action:"shift",count:"all",targetFilter:{owner:"any",position:"any",faceState:"face_down",excludeSelf:!1},destinationRestriction:{type:"to_another_line"},scope:"this_lane"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"light-4-reveal",params:{action:"reveal",source:"opponent_hand",count:-1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"light-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],fx={id:rx,name:lx,description:cx,author:sx,createdAt:ix,color:dx,pattern:ux,cards:px};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const hx=()=>{try{const t=$c();console.log("[Default Protocols] Loading/Updating Anarchy_custom protocol..."),fn(E1),console.log("[Default Protocols] Anarchy_custom loaded/updated successfully!"),console.log("[Default Protocols] Loading/Updating Apathy_custom protocol..."),fn(N1),console.log("[Default Protocols] Apathy_custom loaded/updated successfully!"),console.log("[Default Protocols] Loading/Updating Dark_cust protocol..."),fn(X1),console.log("[Default Protocols] Dark_cust loaded/updated successfully!"),console.log("[Default Protocols] Loading/Updating Death_cust protocol..."),fn(rC),console.log("[Default Protocols] Death_cust loaded/updated successfully!"),console.log("[Default Protocols] Loading/Updating Fire protocol..."),fn(hC),console.log("[Default Protocols] Fire loaded/updated successfully!"),console.log("[Default Protocols] Loading/Updating Water_custom protocol..."),fn(OC),console.log("[Default Protocols] Water_custom loaded/updated successfully!"),console.log("[Default Protocols] Loading/Updating Spirit_custom protocol..."),fn(VC),console.log("[Default Protocols] Spirit_custom loaded/updated successfully!"),console.log("[Default Protocols] Loading/Updating Chaos_custom protocol..."),fn(M1),console.log("[Default Protocols] Chaos_custom loaded/updated successfully!"),console.log("[Default Protocols] Loading/Updating Gravity_custom protocol..."),fn(ZC),console.log("[Default Protocols] Gravity_custom loaded/updated successfully!"),console.log("[Default Protocols] Loading/Updating Frost_custom protocol..."),fn(CC),console.log("[Default Protocols] Frost_custom loaded/updated successfully!"),console.log("[Default Protocols] Loading/Updating Hate_custom protocol..."),fn(DC),console.log("[Default Protocols] Hate_custom loaded/updated successfully!"),console.log("[Default Protocols] Loading/Updating Life_custom protocol..."),fn(ax),console.log("[Default Protocols] Life_custom loaded/updated successfully!"),console.log("[Default Protocols] Loading/Updating Light_custom protocol..."),fn(fx),console.log("[Default Protocols] Light_custom loaded/updated successfully!")}catch(t){console.error("[Default Protocols] Error loading default protocols:",t)}};function _x(){const[t,o]=J.useState("MainMenu"),[a,i]=J.useState([]),[l,c]=J.useState([]),[s,f]=J.useState(null),[p,h]=J.useState("easy"),[y,g]=J.useState(null),[v,w]=J.useState(!0),[C,x]=J.useState("player");J.useEffect(()=>{hx()},[]);const b=J.useCallback(()=>{o("MainMenu"),i([]),c([]),f(null),g(null)},[]);J.useEffect(()=>{const R=A=>{A.key==="Escape"&&b()};return window.addEventListener("keydown",R),()=>{window.removeEventListener("keydown",R)}},[b]);const E=J.useCallback((R,A)=>{i(R),c(A),f(null),g(null),x("player"),o("GameScreen")},[]),S=J.useCallback((R,A)=>{f(R),g(A),o("ResultsScreen")},[]),j=()=>{switch(t){case"MainMenu":return u.jsx(ph,{onNavigate:R=>o(R),difficulty:p,setDifficulty:h,useControl:v,onUseControlChange:w});case"ProtocolSelection":return u.jsx(Cm,{onBack:b,onStartGame:E});case"GameScreen":return u.jsx(Pw,{onBack:b,onEndGame:S,playerProtocols:a,opponentProtocols:l,difficulty:p,useControlMechanic:v,startingPlayer:C});case"ResultsScreen":return u.jsx(Iw,{onPlayAgain:b,winner:s,finalState:y,difficulty:p});case"CardLibrary":return u.jsx(Mw,{onBack:b});case"Statistics":return u.jsx(Hw,{onBack:b});case"CustomProtocols":return u.jsx(y1,{onBack:b});default:return u.jsx(ph,{onNavigate:R=>o(R),difficulty:p,setDifficulty:h,useControl:v,onUseControlChange:w})}};return u.jsx(u.Fragment,{children:j()})}const yx=document.getElementById("root"),gx=fm.createRoot(yx);gx.render(u.jsx(_x,{}));
