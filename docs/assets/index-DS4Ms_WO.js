(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))c(i);new MutationObserver(i=>{for(const d of i)if(d.type==="childList")for(const f of d.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&c(f)}).observe(document,{childList:!0,subtree:!0});function l(i){const d={};return i.integrity&&(d.integrity=i.integrity),i.referrerPolicy&&(d.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?d.credentials="include":i.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function c(i){if(i.ep)return;i.ep=!0;const d=l(i);fetch(i.href,d)}})();var Ed={exports:{}},Bl={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ph;function Z_(){if(Ph)return Bl;Ph=1;var a=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function l(c,i,d){var f=null;if(d!==void 0&&(f=""+d),i.key!==void 0&&(f=""+i.key),"key"in i){d={};for(var p in i)p!=="key"&&(d[p]=i[p])}else d=i;return i=d.ref,{$$typeof:a,type:c,key:f,ref:i!==void 0?i:null,props:d}}return Bl.Fragment=t,Bl.jsx=l,Bl.jsxs=l,Bl}var Uh;function K_(){return Uh||(Uh=1,Ed.exports=Z_()),Ed.exports}var o=K_(),jd={exports:{}},Yl={},kd={exports:{}},Rd={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Oh;function J_(){return Oh||(Oh=1,(function(a){function t(T,L){var B=T.length;T.push(L);e:for(;0<B;){var G=B-1>>>1,ae=T[G];if(0<i(ae,L))T[G]=L,T[B]=ae,B=G;else break e}}function l(T){return T.length===0?null:T[0]}function c(T){if(T.length===0)return null;var L=T[0],B=T.pop();if(B!==L){T[0]=B;e:for(var G=0,ae=T.length,M=ae>>>1;G<M;){var W=2*(G+1)-1,oe=T[W],Q=W+1,V=T[Q];if(0>i(oe,B))Q<ae&&0>i(V,oe)?(T[G]=V,T[Q]=B,G=Q):(T[G]=oe,T[W]=B,G=W);else if(Q<ae&&0>i(V,B))T[G]=V,T[Q]=B,G=Q;else break e}}return L}function i(T,L){var B=T.sortIndex-L.sortIndex;return B!==0?B:T.id-L.id}if(a.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var d=performance;a.unstable_now=function(){return d.now()}}else{var f=Date,p=f.now();a.unstable_now=function(){return f.now()-p}}var u=[],h=[],y=1,g=null,_=3,x=!1,S=!1,E=!1,b=!1,j=typeof setTimeout=="function"?setTimeout:null,C=typeof clearTimeout=="function"?clearTimeout:null,R=typeof setImmediate<"u"?setImmediate:null;function A(T){for(var L=l(h);L!==null;){if(L.callback===null)c(h);else if(L.startTime<=T)c(h),L.sortIndex=L.expirationTime,t(u,L);else break;L=l(h)}}function I(T){if(E=!1,A(T),!S)if(l(u)!==null)S=!0,U||(U=!0,k());else{var L=l(h);L!==null&&D(I,L.startTime-T)}}var U=!1,$=-1,Z=5,ee=-1;function z(){return b?!0:!(a.unstable_now()-ee<Z)}function O(){if(b=!1,U){var T=a.unstable_now();ee=T;var L=!0;try{e:{S=!1,E&&(E=!1,C($),$=-1),x=!0;var B=_;try{t:{for(A(T),g=l(u);g!==null&&!(g.expirationTime>T&&z());){var G=g.callback;if(typeof G=="function"){g.callback=null,_=g.priorityLevel;var ae=G(g.expirationTime<=T);if(T=a.unstable_now(),typeof ae=="function"){g.callback=ae,A(T),L=!0;break t}g===l(u)&&c(u),A(T)}else c(u);g=l(u)}if(g!==null)L=!0;else{var M=l(h);M!==null&&D(I,M.startTime-T),L=!1}}break e}finally{g=null,_=B,x=!1}L=void 0}}finally{L?k():U=!1}}}var k;if(typeof R=="function")k=function(){R(O)};else if(typeof MessageChannel<"u"){var q=new MessageChannel,F=q.port2;q.port1.onmessage=O,k=function(){F.postMessage(null)}}else k=function(){j(O,0)};function D(T,L){$=j(function(){T(a.unstable_now())},L)}a.unstable_IdlePriority=5,a.unstable_ImmediatePriority=1,a.unstable_LowPriority=4,a.unstable_NormalPriority=3,a.unstable_Profiling=null,a.unstable_UserBlockingPriority=2,a.unstable_cancelCallback=function(T){T.callback=null},a.unstable_forceFrameRate=function(T){0>T||125<T?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Z=0<T?Math.floor(1e3/T):5},a.unstable_getCurrentPriorityLevel=function(){return _},a.unstable_next=function(T){switch(_){case 1:case 2:case 3:var L=3;break;default:L=_}var B=_;_=L;try{return T()}finally{_=B}},a.unstable_requestPaint=function(){b=!0},a.unstable_runWithPriority=function(T,L){switch(T){case 1:case 2:case 3:case 4:case 5:break;default:T=3}var B=_;_=T;try{return L()}finally{_=B}},a.unstable_scheduleCallback=function(T,L,B){var G=a.unstable_now();switch(typeof B=="object"&&B!==null?(B=B.delay,B=typeof B=="number"&&0<B?G+B:G):B=G,T){case 1:var ae=-1;break;case 2:ae=250;break;case 5:ae=1073741823;break;case 4:ae=1e4;break;default:ae=5e3}return ae=B+ae,T={id:y++,callback:L,priorityLevel:T,startTime:B,expirationTime:ae,sortIndex:-1},B>G?(T.sortIndex=B,t(h,T),l(u)===null&&T===l(h)&&(E?(C($),$=-1):E=!0,D(I,B-G))):(T.sortIndex=ae,t(u,T),S||x||(S=!0,U||(U=!0,k()))),T},a.unstable_shouldYield=z,a.unstable_wrapCallback=function(T){var L=_;return function(){var B=_;_=L;try{return T.apply(this,arguments)}finally{_=B}}}})(Rd)),Rd}var Mh;function e0(){return Mh||(Mh=1,kd.exports=J_()),kd.exports}var Nd={exports:{}},Xe={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Hh;function t0(){if(Hh)return Xe;Hh=1;var a=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),l=Symbol.for("react.fragment"),c=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),d=Symbol.for("react.consumer"),f=Symbol.for("react.context"),p=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),y=Symbol.for("react.lazy"),g=Symbol.for("react.activity"),_=Symbol.iterator;function x(M){return M===null||typeof M!="object"?null:(M=_&&M[_]||M["@@iterator"],typeof M=="function"?M:null)}var S={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},E=Object.assign,b={};function j(M,W,oe){this.props=M,this.context=W,this.refs=b,this.updater=oe||S}j.prototype.isReactComponent={},j.prototype.setState=function(M,W){if(typeof M!="object"&&typeof M!="function"&&M!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,M,W,"setState")},j.prototype.forceUpdate=function(M){this.updater.enqueueForceUpdate(this,M,"forceUpdate")};function C(){}C.prototype=j.prototype;function R(M,W,oe){this.props=M,this.context=W,this.refs=b,this.updater=oe||S}var A=R.prototype=new C;A.constructor=R,E(A,j.prototype),A.isPureReactComponent=!0;var I=Array.isArray;function U(){}var $={H:null,A:null,T:null,S:null},Z=Object.prototype.hasOwnProperty;function ee(M,W,oe){var Q=oe.ref;return{$$typeof:a,type:M,key:W,ref:Q!==void 0?Q:null,props:oe}}function z(M,W){return ee(M.type,W,M.props)}function O(M){return typeof M=="object"&&M!==null&&M.$$typeof===a}function k(M){var W={"=":"=0",":":"=2"};return"$"+M.replace(/[=:]/g,function(oe){return W[oe]})}var q=/\/+/g;function F(M,W){return typeof M=="object"&&M!==null&&M.key!=null?k(""+M.key):W.toString(36)}function D(M){switch(M.status){case"fulfilled":return M.value;case"rejected":throw M.reason;default:switch(typeof M.status=="string"?M.then(U,U):(M.status="pending",M.then(function(W){M.status==="pending"&&(M.status="fulfilled",M.value=W)},function(W){M.status==="pending"&&(M.status="rejected",M.reason=W)})),M.status){case"fulfilled":return M.value;case"rejected":throw M.reason}}throw M}function T(M,W,oe,Q,V){var J=typeof M;(J==="undefined"||J==="boolean")&&(M=null);var me=!1;if(M===null)me=!0;else switch(J){case"bigint":case"string":case"number":me=!0;break;case"object":switch(M.$$typeof){case a:case t:me=!0;break;case y:return me=M._init,T(me(M._payload),W,oe,Q,V)}}if(me)return V=V(M),me=Q===""?"."+F(M,0):Q,I(V)?(oe="",me!=null&&(oe=me.replace(q,"$&/")+"/"),T(V,W,oe,"",function(K){return K})):V!=null&&(O(V)&&(V=z(V,oe+(V.key==null||M&&M.key===V.key?"":(""+V.key).replace(q,"$&/")+"/")+me)),W.push(V)),1;me=0;var ge=Q===""?".":Q+":";if(I(M))for(var Y=0;Y<M.length;Y++)Q=M[Y],J=ge+F(Q,Y),me+=T(Q,W,oe,J,V);else if(Y=x(M),typeof Y=="function")for(M=Y.call(M),Y=0;!(Q=M.next()).done;)Q=Q.value,J=ge+F(Q,Y++),me+=T(Q,W,oe,J,V);else if(J==="object"){if(typeof M.then=="function")return T(D(M),W,oe,Q,V);throw W=String(M),Error("Objects are not valid as a React child (found: "+(W==="[object Object]"?"object with keys {"+Object.keys(M).join(", ")+"}":W)+"). If you meant to render a collection of children, use an array instead.")}return me}function L(M,W,oe){if(M==null)return M;var Q=[],V=0;return T(M,Q,"","",function(J){return W.call(oe,J,V++)}),Q}function B(M){if(M._status===-1){var W=M._result;W=W(),W.then(function(oe){(M._status===0||M._status===-1)&&(M._status=1,M._result=oe)},function(oe){(M._status===0||M._status===-1)&&(M._status=2,M._result=oe)}),M._status===-1&&(M._status=0,M._result=W)}if(M._status===1)return M._result.default;throw M._result}var G=typeof reportError=="function"?reportError:function(M){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var W=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof M=="object"&&M!==null&&typeof M.message=="string"?String(M.message):String(M),error:M});if(!window.dispatchEvent(W))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",M);return}console.error(M)},ae={map:L,forEach:function(M,W,oe){L(M,function(){W.apply(this,arguments)},oe)},count:function(M){var W=0;return L(M,function(){W++}),W},toArray:function(M){return L(M,function(W){return W})||[]},only:function(M){if(!O(M))throw Error("React.Children.only expected to receive a single React element child.");return M}};return Xe.Activity=g,Xe.Children=ae,Xe.Component=j,Xe.Fragment=l,Xe.Profiler=i,Xe.PureComponent=R,Xe.StrictMode=c,Xe.Suspense=u,Xe.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=$,Xe.__COMPILER_RUNTIME={__proto__:null,c:function(M){return $.H.useMemoCache(M)}},Xe.cache=function(M){return function(){return M.apply(null,arguments)}},Xe.cacheSignal=function(){return null},Xe.cloneElement=function(M,W,oe){if(M==null)throw Error("The argument must be a React element, but you passed "+M+".");var Q=E({},M.props),V=M.key;if(W!=null)for(J in W.key!==void 0&&(V=""+W.key),W)!Z.call(W,J)||J==="key"||J==="__self"||J==="__source"||J==="ref"&&W.ref===void 0||(Q[J]=W[J]);var J=arguments.length-2;if(J===1)Q.children=oe;else if(1<J){for(var me=Array(J),ge=0;ge<J;ge++)me[ge]=arguments[ge+2];Q.children=me}return ee(M.type,V,Q)},Xe.createContext=function(M){return M={$$typeof:f,_currentValue:M,_currentValue2:M,_threadCount:0,Provider:null,Consumer:null},M.Provider=M,M.Consumer={$$typeof:d,_context:M},M},Xe.createElement=function(M,W,oe){var Q,V={},J=null;if(W!=null)for(Q in W.key!==void 0&&(J=""+W.key),W)Z.call(W,Q)&&Q!=="key"&&Q!=="__self"&&Q!=="__source"&&(V[Q]=W[Q]);var me=arguments.length-2;if(me===1)V.children=oe;else if(1<me){for(var ge=Array(me),Y=0;Y<me;Y++)ge[Y]=arguments[Y+2];V.children=ge}if(M&&M.defaultProps)for(Q in me=M.defaultProps,me)V[Q]===void 0&&(V[Q]=me[Q]);return ee(M,J,V)},Xe.createRef=function(){return{current:null}},Xe.forwardRef=function(M){return{$$typeof:p,render:M}},Xe.isValidElement=O,Xe.lazy=function(M){return{$$typeof:y,_payload:{_status:-1,_result:M},_init:B}},Xe.memo=function(M,W){return{$$typeof:h,type:M,compare:W===void 0?null:W}},Xe.startTransition=function(M){var W=$.T,oe={};$.T=oe;try{var Q=M(),V=$.S;V!==null&&V(oe,Q),typeof Q=="object"&&Q!==null&&typeof Q.then=="function"&&Q.then(U,G)}catch(J){G(J)}finally{W!==null&&oe.types!==null&&(W.types=oe.types),$.T=W}},Xe.unstable_useCacheRefresh=function(){return $.H.useCacheRefresh()},Xe.use=function(M){return $.H.use(M)},Xe.useActionState=function(M,W,oe){return $.H.useActionState(M,W,oe)},Xe.useCallback=function(M,W){return $.H.useCallback(M,W)},Xe.useContext=function(M){return $.H.useContext(M)},Xe.useDebugValue=function(){},Xe.useDeferredValue=function(M,W){return $.H.useDeferredValue(M,W)},Xe.useEffect=function(M,W){return $.H.useEffect(M,W)},Xe.useEffectEvent=function(M){return $.H.useEffectEvent(M)},Xe.useId=function(){return $.H.useId()},Xe.useImperativeHandle=function(M,W,oe){return $.H.useImperativeHandle(M,W,oe)},Xe.useInsertionEffect=function(M,W){return $.H.useInsertionEffect(M,W)},Xe.useLayoutEffect=function(M,W){return $.H.useLayoutEffect(M,W)},Xe.useMemo=function(M,W){return $.H.useMemo(M,W)},Xe.useOptimistic=function(M,W){return $.H.useOptimistic(M,W)},Xe.useReducer=function(M,W,oe){return $.H.useReducer(M,W,oe)},Xe.useRef=function(M){return $.H.useRef(M)},Xe.useState=function(M){return $.H.useState(M)},Xe.useSyncExternalStore=function(M,W,oe){return $.H.useSyncExternalStore(M,W,oe)},Xe.useTransition=function(){return $.H.useTransition()},Xe.version="19.2.3",Xe}var zh;function Wd(){return zh||(zh=1,Nd.exports=t0()),Nd.exports}var Td={exports:{}},cn={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Vh;function n0(){if(Vh)return cn;Vh=1;var a=Wd();function t(u){var h="https://react.dev/errors/"+u;if(1<arguments.length){h+="?args[]="+encodeURIComponent(arguments[1]);for(var y=2;y<arguments.length;y++)h+="&args[]="+encodeURIComponent(arguments[y])}return"Minified React error #"+u+"; visit "+h+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function l(){}var c={d:{f:l,r:function(){throw Error(t(522))},D:l,C:l,L:l,m:l,X:l,S:l,M:l},p:0,findDOMNode:null},i=Symbol.for("react.portal");function d(u,h,y){var g=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:i,key:g==null?null:""+g,children:u,containerInfo:h,implementation:y}}var f=a.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function p(u,h){if(u==="font")return"";if(typeof h=="string")return h==="use-credentials"?h:""}return cn.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=c,cn.createPortal=function(u,h){var y=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11)throw Error(t(299));return d(u,h,null,y)},cn.flushSync=function(u){var h=f.T,y=c.p;try{if(f.T=null,c.p=2,u)return u()}finally{f.T=h,c.p=y,c.d.f()}},cn.preconnect=function(u,h){typeof u=="string"&&(h?(h=h.crossOrigin,h=typeof h=="string"?h==="use-credentials"?h:"":void 0):h=null,c.d.C(u,h))},cn.prefetchDNS=function(u){typeof u=="string"&&c.d.D(u)},cn.preinit=function(u,h){if(typeof u=="string"&&h&&typeof h.as=="string"){var y=h.as,g=p(y,h.crossOrigin),_=typeof h.integrity=="string"?h.integrity:void 0,x=typeof h.fetchPriority=="string"?h.fetchPriority:void 0;y==="style"?c.d.S(u,typeof h.precedence=="string"?h.precedence:void 0,{crossOrigin:g,integrity:_,fetchPriority:x}):y==="script"&&c.d.X(u,{crossOrigin:g,integrity:_,fetchPriority:x,nonce:typeof h.nonce=="string"?h.nonce:void 0})}},cn.preinitModule=function(u,h){if(typeof u=="string")if(typeof h=="object"&&h!==null){if(h.as==null||h.as==="script"){var y=p(h.as,h.crossOrigin);c.d.M(u,{crossOrigin:y,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0})}}else h==null&&c.d.M(u)},cn.preload=function(u,h){if(typeof u=="string"&&typeof h=="object"&&h!==null&&typeof h.as=="string"){var y=h.as,g=p(y,h.crossOrigin);c.d.L(u,y,{crossOrigin:g,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0,type:typeof h.type=="string"?h.type:void 0,fetchPriority:typeof h.fetchPriority=="string"?h.fetchPriority:void 0,referrerPolicy:typeof h.referrerPolicy=="string"?h.referrerPolicy:void 0,imageSrcSet:typeof h.imageSrcSet=="string"?h.imageSrcSet:void 0,imageSizes:typeof h.imageSizes=="string"?h.imageSizes:void 0,media:typeof h.media=="string"?h.media:void 0})}},cn.preloadModule=function(u,h){if(typeof u=="string")if(h){var y=p(h.as,h.crossOrigin);c.d.m(u,{as:typeof h.as=="string"&&h.as!=="script"?h.as:void 0,crossOrigin:y,integrity:typeof h.integrity=="string"?h.integrity:void 0})}else c.d.m(u)},cn.requestFormReset=function(u){c.d.r(u)},cn.unstable_batchedUpdates=function(u,h){return u(h)},cn.useFormState=function(u,h,y){return f.H.useFormState(u,h,y)},cn.useFormStatus=function(){return f.H.useHostTransitionStatus()},cn.version="19.2.3",cn}var Bh;function a0(){if(Bh)return Td.exports;Bh=1;function a(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(a)}catch(t){console.error(t)}}return a(),Td.exports=n0(),Td.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Yh;function o0(){if(Yh)return Yl;Yh=1;var a=e0(),t=Wd(),l=a0();function c(e){var n="https://react.dev/errors/"+e;if(1<arguments.length){n+="?args[]="+encodeURIComponent(arguments[1]);for(var r=2;r<arguments.length;r++)n+="&args[]="+encodeURIComponent(arguments[r])}return"Minified React error #"+e+"; visit "+n+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function d(e){var n=e,r=e;if(e.alternate)for(;n.return;)n=n.return;else{e=n;do n=e,(n.flags&4098)!==0&&(r=n.return),e=n.return;while(e)}return n.tag===3?r:null}function f(e){if(e.tag===13){var n=e.memoizedState;if(n===null&&(e=e.alternate,e!==null&&(n=e.memoizedState)),n!==null)return n.dehydrated}return null}function p(e){if(e.tag===31){var n=e.memoizedState;if(n===null&&(e=e.alternate,e!==null&&(n=e.memoizedState)),n!==null)return n.dehydrated}return null}function u(e){if(d(e)!==e)throw Error(c(188))}function h(e){var n=e.alternate;if(!n){if(n=d(e),n===null)throw Error(c(188));return n!==e?null:e}for(var r=e,s=n;;){var m=r.return;if(m===null)break;var w=m.alternate;if(w===null){if(s=m.return,s!==null){r=s;continue}break}if(m.child===w.child){for(w=m.child;w;){if(w===r)return u(m),e;if(w===s)return u(m),n;w=w.sibling}throw Error(c(188))}if(r.return!==s.return)r=m,s=w;else{for(var N=!1,H=m.child;H;){if(H===r){N=!0,r=m,s=w;break}if(H===s){N=!0,s=m,r=w;break}H=H.sibling}if(!N){for(H=w.child;H;){if(H===r){N=!0,r=w,s=m;break}if(H===s){N=!0,s=w,r=m;break}H=H.sibling}if(!N)throw Error(c(189))}}if(r.alternate!==s)throw Error(c(190))}if(r.tag!==3)throw Error(c(188));return r.stateNode.current===r?e:n}function y(e){var n=e.tag;if(n===5||n===26||n===27||n===6)return e;for(e=e.child;e!==null;){if(n=y(e),n!==null)return n;e=e.sibling}return null}var g=Object.assign,_=Symbol.for("react.element"),x=Symbol.for("react.transitional.element"),S=Symbol.for("react.portal"),E=Symbol.for("react.fragment"),b=Symbol.for("react.strict_mode"),j=Symbol.for("react.profiler"),C=Symbol.for("react.consumer"),R=Symbol.for("react.context"),A=Symbol.for("react.forward_ref"),I=Symbol.for("react.suspense"),U=Symbol.for("react.suspense_list"),$=Symbol.for("react.memo"),Z=Symbol.for("react.lazy"),ee=Symbol.for("react.activity"),z=Symbol.for("react.memo_cache_sentinel"),O=Symbol.iterator;function k(e){return e===null||typeof e!="object"?null:(e=O&&e[O]||e["@@iterator"],typeof e=="function"?e:null)}var q=Symbol.for("react.client.reference");function F(e){if(e==null)return null;if(typeof e=="function")return e.$$typeof===q?null:e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case E:return"Fragment";case j:return"Profiler";case b:return"StrictMode";case I:return"Suspense";case U:return"SuspenseList";case ee:return"Activity"}if(typeof e=="object")switch(e.$$typeof){case S:return"Portal";case R:return e.displayName||"Context";case C:return(e._context.displayName||"Context")+".Consumer";case A:var n=e.render;return e=e.displayName,e||(e=n.displayName||n.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case $:return n=e.displayName||null,n!==null?n:F(e.type)||"Memo";case Z:n=e._payload,e=e._init;try{return F(e(n))}catch{}}return null}var D=Array.isArray,T=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,L=l.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,B={pending:!1,data:null,method:null,action:null},G=[],ae=-1;function M(e){return{current:e}}function W(e){0>ae||(e.current=G[ae],G[ae]=null,ae--)}function oe(e,n){ae++,G[ae]=e.current,e.current=n}var Q=M(null),V=M(null),J=M(null),me=M(null);function ge(e,n){switch(oe(J,n),oe(V,e),oe(Q,null),n.nodeType){case 9:case 11:e=(e=n.documentElement)&&(e=e.namespaceURI)?sh(e):0;break;default:if(e=n.tagName,n=n.namespaceURI)n=sh(n),e=ch(n,e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}W(Q),oe(Q,e)}function Y(){W(Q),W(V),W(J)}function K(e){e.memoizedState!==null&&oe(me,e);var n=Q.current,r=ch(n,e.type);n!==r&&(oe(V,e),oe(Q,r))}function X(e){V.current===e&&(W(Q),W(V)),me.current===e&&(W(me),Ml._currentValue=B)}var se,ie;function _e(e){if(se===void 0)try{throw Error()}catch(r){var n=r.stack.trim().match(/\n( *(at )?)/);se=n&&n[1]||"",ie=-1<r.stack.indexOf(`
    at`)?" (<anonymous>)":-1<r.stack.indexOf("@")?"@unknown:0:0":""}return`
`+se+e+ie}var ye=!1;function ke(e,n){if(!e||ye)return"";ye=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var s={DetermineComponentFrameRoot:function(){try{if(n){var xe=function(){throw Error()};if(Object.defineProperty(xe.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(xe,[])}catch(he){var pe=he}Reflect.construct(e,[],xe)}else{try{xe.call()}catch(he){pe=he}e.call(xe.prototype)}}else{try{throw Error()}catch(he){pe=he}(xe=e())&&typeof xe.catch=="function"&&xe.catch(function(){})}}catch(he){if(he&&pe&&typeof he.stack=="string")return[he.stack,pe.stack]}return[null,null]}};s.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var m=Object.getOwnPropertyDescriptor(s.DetermineComponentFrameRoot,"name");m&&m.configurable&&Object.defineProperty(s.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var w=s.DetermineComponentFrameRoot(),N=w[0],H=w[1];if(N&&H){var te=N.split(`
`),ue=H.split(`
`);for(m=s=0;s<te.length&&!te[s].includes("DetermineComponentFrameRoot");)s++;for(;m<ue.length&&!ue[m].includes("DetermineComponentFrameRoot");)m++;if(s===te.length||m===ue.length)for(s=te.length-1,m=ue.length-1;1<=s&&0<=m&&te[s]!==ue[m];)m--;for(;1<=s&&0<=m;s--,m--)if(te[s]!==ue[m]){if(s!==1||m!==1)do if(s--,m--,0>m||te[s]!==ue[m]){var ve=`
`+te[s].replace(" at new "," at ");return e.displayName&&ve.includes("<anonymous>")&&(ve=ve.replace("<anonymous>",e.displayName)),ve}while(1<=s&&0<=m);break}}}finally{ye=!1,Error.prepareStackTrace=r}return(r=e?e.displayName||e.name:"")?_e(r):""}function Ie(e,n){switch(e.tag){case 26:case 27:case 5:return _e(e.type);case 16:return _e("Lazy");case 13:return e.child!==n&&n!==null?_e("Suspense Fallback"):_e("Suspense");case 19:return _e("SuspenseList");case 0:case 15:return ke(e.type,!1);case 11:return ke(e.type.render,!1);case 1:return ke(e.type,!0);case 31:return _e("Activity");default:return""}}function be(e){try{var n="",r=null;do n+=Ie(e,r),r=e,e=e.return;while(e);return n}catch(s){return`
Error generating stack: `+s.message+`
`+s.stack}}var Pe=Object.prototype.hasOwnProperty,$e=a.unstable_scheduleCallback,Ae=a.unstable_cancelCallback,Le=a.unstable_shouldYield,Re=a.unstable_requestPaint,Ne=a.unstable_now,ht=a.unstable_getCurrentPriorityLevel,ct=a.unstable_ImmediatePriority,Ct=a.unstable_UserBlockingPriority,wt=a.unstable_NormalPriority,na=a.unstable_LowPriority,En=a.unstable_IdlePriority,aa=a.log,Ta=a.unstable_setDisableYieldValue,pn=null,Mt=null;function tn(e){if(typeof aa=="function"&&Ta(e),Mt&&typeof Mt.setStrictMode=="function")try{Mt.setStrictMode(pn,e)}catch{}}var It=Math.clz32?Math.clz32:ya,oa=Math.log,Aa=Math.LN2;function ya(e){return e>>>=0,e===0?32:31-(oa(e)/Aa|0)|0}var On=256,fn=262144,Jt=4194304;function Qt(e){var n=e&42;if(n!==0)return n;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return e&261888;case 262144:case 524288:case 1048576:case 2097152:return e&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return e&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function Mn(e,n,r){var s=e.pendingLanes;if(s===0)return 0;var m=0,w=e.suspendedLanes,N=e.pingedLanes;e=e.warmLanes;var H=s&134217727;return H!==0?(s=H&~w,s!==0?m=Qt(s):(N&=H,N!==0?m=Qt(N):r||(r=H&~e,r!==0&&(m=Qt(r))))):(H=s&~w,H!==0?m=Qt(H):N!==0?m=Qt(N):r||(r=s&~e,r!==0&&(m=Qt(r)))),m===0?0:n!==0&&n!==m&&(n&w)===0&&(w=m&-m,r=n&-n,w>=r||w===32&&(r&4194048)!==0)?n:m}function jn(e,n){return(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&n)===0}function Da(e,n){switch(e){case 1:case 2:case 4:case 8:case 64:return n+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ga(){var e=Jt;return Jt<<=1,(Jt&62914560)===0&&(Jt=4194304),e}function ra(e){for(var n=[],r=0;31>r;r++)n.push(e);return n}function hn(e,n){e.pendingLanes|=n,n!==268435456&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function la(e,n,r,s,m,w){var N=e.pendingLanes;e.pendingLanes=r,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=r,e.entangledLanes&=r,e.errorRecoveryDisabledLanes&=r,e.shellSuspendCounter=0;var H=e.entanglements,te=e.expirationTimes,ue=e.hiddenUpdates;for(r=N&~r;0<r;){var ve=31-It(r),xe=1<<ve;H[ve]=0,te[ve]=-1;var pe=ue[ve];if(pe!==null)for(ue[ve]=null,ve=0;ve<pe.length;ve++){var he=pe[ve];he!==null&&(he.lane&=-536870913)}r&=~xe}s!==0&&va(e,s,0),w!==0&&m===0&&e.tag!==0&&(e.suspendedLanes|=w&~(N&~n))}function va(e,n,r){e.pendingLanes|=n,e.suspendedLanes&=~n;var s=31-It(n);e.entangledLanes|=n,e.entanglements[s]=e.entanglements[s]|1073741824|r&261930}function _a(e,n){var r=e.entangledLanes|=n;for(e=e.entanglements;r;){var s=31-It(r),m=1<<s;m&n|e[s]&n&&(e[s]|=n),r&=~m}}function wa(e,n){var r=n&-n;return r=(r&42)!==0?1:sa(r),(r&(e.suspendedLanes|n))!==0?0:r}function sa(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function ca(e){return e&=-e,2<e?8<e?(e&134217727)!==0?32:268435456:8:2}function ia(){var e=L.p;return e!==0?e:(e=window.event,e===void 0?32:Ah(e.type))}function xa(e,n){var r=L.p;try{return L.p=e,n()}finally{L.p=r}}var fe=Math.random().toString(36).slice(2),je="__reactFiber$"+fe,qe="__reactProps$"+fe,ze="__reactContainer$"+fe,Oe="__reactEvents$"+fe,Qe="__reactListeners$"+fe,Je="__reactHandles$"+fe,rt="__reactResources$"+fe,Ve="__reactMarker$"+fe;function lt(e){delete e[je],delete e[qe],delete e[Oe],delete e[Qe],delete e[Je]}function Pt(e){var n=e[je];if(n)return n;for(var r=e.parentNode;r;){if(n=r[ze]||r[je]){if(r=n.alternate,n.child!==null||r!==null&&r.child!==null)for(e=mh(e);e!==null;){if(r=e[je])return r;e=mh(e)}return n}e=r,r=e.parentNode}return null}function mn(e){if(e=e[je]||e[ze]){var n=e.tag;if(n===5||n===6||n===13||n===31||n===26||n===27||n===3)return e}return null}function Xt(e){var n=e.tag;if(n===5||n===26||n===27||n===6)return e.stateNode;throw Error(c(33))}function Et(e){var n=e[rt];return n||(n=e[rt]={hoistableStyles:new Map,hoistableScripts:new Map}),n}function Ft(e){e[Ve]=!0}var to=new Set,no={};function kn(e,n){Hn(e,n),Hn(e+"Capture",n)}function Hn(e,n){for(no[e]=n,e=0;e<n.length;e++)to.add(n[e])}var Uo=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Ce={},Te={};function Ye(e){return Pe.call(Te,e)?!0:Pe.call(Ce,e)?!1:Uo.test(e)?Te[e]=!0:(Ce[e]=!0,!1)}function at(e,n,r){if(Ye(n))if(r===null)e.removeAttribute(n);else{switch(typeof r){case"undefined":case"function":case"symbol":e.removeAttribute(n);return;case"boolean":var s=n.toLowerCase().slice(0,5);if(s!=="data-"&&s!=="aria-"){e.removeAttribute(n);return}}e.setAttribute(n,""+r)}}function qt(e,n,r){if(r===null)e.removeAttribute(n);else{switch(typeof r){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(n);return}e.setAttribute(n,""+r)}}function Lt(e,n,r,s){if(s===null)e.removeAttribute(r);else{switch(typeof s){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(r);return}e.setAttributeNS(n,r,""+s)}}function Vt(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function dn(e){var n=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(n==="checkbox"||n==="radio")}function zn(e,n,r){var s=Object.getOwnPropertyDescriptor(e.constructor.prototype,n);if(!e.hasOwnProperty(n)&&typeof s<"u"&&typeof s.get=="function"&&typeof s.set=="function"){var m=s.get,w=s.set;return Object.defineProperty(e,n,{configurable:!0,get:function(){return m.call(this)},set:function(N){r=""+N,w.call(this,N)}}),Object.defineProperty(e,n,{enumerable:s.enumerable}),{getValue:function(){return r},setValue:function(N){r=""+N},stopTracking:function(){e._valueTracker=null,delete e[n]}}}}function da(e){if(!e._valueTracker){var n=dn(e)?"checked":"value";e._valueTracker=zn(e,n,""+e[n])}}function Rn(e){if(!e)return!1;var n=e._valueTracker;if(!n)return!0;var r=n.getValue(),s="";return e&&(s=dn(e)?e.checked?"true":"false":e.value),e=s,e!==r?(n.setValue(e),!0):!1}function Fa(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}var rl=/[\n"\\]/g;function jt(e){return e.replace(rl,function(n){return"\\"+n.charCodeAt(0).toString(16)+" "})}function ao(e,n,r,s,m,w,N,H){e.name="",N!=null&&typeof N!="function"&&typeof N!="symbol"&&typeof N!="boolean"?e.type=N:e.removeAttribute("type"),n!=null?N==="number"?(n===0&&e.value===""||e.value!=n)&&(e.value=""+Vt(n)):e.value!==""+Vt(n)&&(e.value=""+Vt(n)):N!=="submit"&&N!=="reset"||e.removeAttribute("value"),n!=null?oo(e,N,Vt(n)):r!=null?oo(e,N,Vt(r)):s!=null&&e.removeAttribute("value"),m==null&&w!=null&&(e.defaultChecked=!!w),m!=null&&(e.checked=m&&typeof m!="function"&&typeof m!="symbol"),H!=null&&typeof H!="function"&&typeof H!="symbol"&&typeof H!="boolean"?e.name=""+Vt(H):e.removeAttribute("name")}function Oo(e,n,r,s,m,w,N,H){if(w!=null&&typeof w!="function"&&typeof w!="symbol"&&typeof w!="boolean"&&(e.type=w),n!=null||r!=null){if(!(w!=="submit"&&w!=="reset"||n!=null)){da(e);return}r=r!=null?""+Vt(r):"",n=n!=null?""+Vt(n):r,H||n===e.value||(e.value=n),e.defaultValue=n}s=s??m,s=typeof s!="function"&&typeof s!="symbol"&&!!s,e.checked=H?e.checked:!!s,e.defaultChecked=!!s,N!=null&&typeof N!="function"&&typeof N!="symbol"&&typeof N!="boolean"&&(e.name=N),da(e)}function oo(e,n,r){n==="number"&&Fa(e.ownerDocument)===e||e.defaultValue===""+r||(e.defaultValue=""+r)}function ua(e,n,r,s){if(e=e.options,n){n={};for(var m=0;m<r.length;m++)n["$"+r[m]]=!0;for(r=0;r<e.length;r++)m=n.hasOwnProperty("$"+e[r].value),e[r].selected!==m&&(e[r].selected=m),m&&s&&(e[r].defaultSelected=!0)}else{for(r=""+Vt(r),n=null,m=0;m<e.length;m++){if(e[m].value===r){e[m].selected=!0,s&&(e[m].defaultSelected=!0);return}n!==null||e[m].disabled||(n=e[m])}n!==null&&(n.selected=!0)}}function Mo(e,n,r){if(n!=null&&(n=""+Vt(n),n!==e.value&&(e.value=n),r==null)){e.defaultValue!==n&&(e.defaultValue=n);return}e.defaultValue=r!=null?""+Vt(r):""}function Ho(e,n,r,s){if(n==null){if(s!=null){if(r!=null)throw Error(c(92));if(D(s)){if(1<s.length)throw Error(c(93));s=s[0]}r=s}r==null&&(r=""),n=r}r=Vt(n),e.defaultValue=r,s=e.textContent,s===r&&s!==""&&s!==null&&(e.value=s),da(e)}function yn(e,n){if(n){var r=e.firstChild;if(r&&r===e.lastChild&&r.nodeType===3){r.nodeValue=n;return}}e.textContent=n}var Zt=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function hr(e,n,r){var s=n.indexOf("--")===0;r==null||typeof r=="boolean"||r===""?s?e.setProperty(n,""):n==="float"?e.cssFloat="":e[n]="":s?e.setProperty(n,r):typeof r!="number"||r===0||Zt.has(n)?n==="float"?e.cssFloat=r:e[n]=(""+r).trim():e[n]=r+"px"}function qa(e,n,r){if(n!=null&&typeof n!="object")throw Error(c(62));if(e=e.style,r!=null){for(var s in r)!r.hasOwnProperty(s)||n!=null&&n.hasOwnProperty(s)||(s.indexOf("--")===0?e.setProperty(s,""):s==="float"?e.cssFloat="":e[s]="");for(var m in n)s=n[m],n.hasOwnProperty(m)&&r[m]!==s&&hr(e,m,s)}else for(var w in n)n.hasOwnProperty(w)&&hr(e,w,n[w])}function mr(e){if(e.indexOf("-")===-1)return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ns=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),as=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function zo(e){return as.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}function Vn(){}var yr=null;function gr(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var $a=null,Ia=null;function Vo(e){var n=mn(e);if(n&&(e=n.stateNode)){var r=e[qe]||null;e:switch(e=n.stateNode,n.type){case"input":if(ao(e,r.value,r.defaultValue,r.defaultValue,r.checked,r.defaultChecked,r.type,r.name),n=r.name,r.type==="radio"&&n!=null){for(r=e;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll('input[name="'+jt(""+n)+'"][type="radio"]'),n=0;n<r.length;n++){var s=r[n];if(s!==e&&s.form===e.form){var m=s[qe]||null;if(!m)throw Error(c(90));ao(s,m.value,m.defaultValue,m.defaultValue,m.checked,m.defaultChecked,m.type,m.name)}}for(n=0;n<r.length;n++)s=r[n],s.form===e.form&&Rn(s)}break e;case"textarea":Mo(e,r.value,r.defaultValue);break e;case"select":n=r.value,n!=null&&ua(e,!!r.multiple,n,!1)}}}var Ue=!1;function os(e,n,r){if(Ue)return e(n,r);Ue=!0;try{var s=e(n);return s}finally{if(Ue=!1,($a!==null||Ia!==null)&&(Ys(),$a&&(n=$a,e=Ia,Ia=$a=null,Vo(n),e)))for(n=0;n<e.length;n++)Vo(e[n])}}function Ca(e,n){var r=e.stateNode;if(r===null)return null;var s=r[qe]||null;if(s===null)return null;r=s[n];e:switch(n){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(s=!s.disabled)||(e=e.type,s=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!s;break e;default:e=!1}if(e)return null;if(r&&typeof r!="function")throw Error(c(231,n,typeof r));return r}var Bn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),rs=!1;if(Bn)try{var ro={};Object.defineProperty(ro,"passive",{get:function(){rs=!0}}),window.addEventListener("test",ro,ro),window.removeEventListener("test",ro,ro)}catch{rs=!1}var lo=null,jc=null,ls=null;function su(){if(ls)return ls;var e,n=jc,r=n.length,s,m="value"in lo?lo.value:lo.textContent,w=m.length;for(e=0;e<r&&n[e]===m[e];e++);var N=r-e;for(s=1;s<=N&&n[r-s]===m[w-s];s++);return ls=m.slice(e,1<s?1-s:void 0)}function ss(e){var n=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&n===13&&(e=13)):e=n,e===10&&(e=13),32<=e||e===13?e:0}function cs(){return!0}function cu(){return!1}function gn(e){function n(r,s,m,w,N){this._reactName=r,this._targetInst=m,this.type=s,this.nativeEvent=w,this.target=N,this.currentTarget=null;for(var H in e)e.hasOwnProperty(H)&&(r=e[H],this[H]=r?r(w):w[H]);return this.isDefaultPrevented=(w.defaultPrevented!=null?w.defaultPrevented:w.returnValue===!1)?cs:cu,this.isPropagationStopped=cu,this}return g(n.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=cs)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=cs)},persist:function(){},isPersistent:cs}),n}var Bo={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},is=gn(Bo),ll=g({},Bo,{view:0,detail:0}),Qg=gn(ll),kc,Rc,sl,ds=g({},ll,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Tc,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==sl&&(sl&&e.type==="mousemove"?(kc=e.screenX-sl.screenX,Rc=e.screenY-sl.screenY):Rc=kc=0,sl=e),kc)},movementY:function(e){return"movementY"in e?e.movementY:Rc}}),iu=gn(ds),Xg=g({},ds,{dataTransfer:0}),Zg=gn(Xg),Kg=g({},ll,{relatedTarget:0}),Nc=gn(Kg),Jg=g({},Bo,{animationName:0,elapsedTime:0,pseudoElement:0}),ev=gn(Jg),tv=g({},Bo,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),nv=gn(tv),av=g({},Bo,{data:0}),du=gn(av),ov={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},rv={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},lv={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function sv(e){var n=this.nativeEvent;return n.getModifierState?n.getModifierState(e):(e=lv[e])?!!n[e]:!1}function Tc(){return sv}var cv=g({},ll,{key:function(e){if(e.key){var n=ov[e.key]||e.key;if(n!=="Unidentified")return n}return e.type==="keypress"?(e=ss(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?rv[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Tc,charCode:function(e){return e.type==="keypress"?ss(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?ss(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),iv=gn(cv),dv=g({},ds,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),uu=gn(dv),uv=g({},ll,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Tc}),pv=gn(uv),fv=g({},Bo,{propertyName:0,elapsedTime:0,pseudoElement:0}),hv=gn(fv),mv=g({},ds,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),yv=gn(mv),gv=g({},Bo,{newState:0,oldState:0}),vv=gn(gv),_v=[9,13,27,32],Ac=Bn&&"CompositionEvent"in window,cl=null;Bn&&"documentMode"in document&&(cl=document.documentMode);var wv=Bn&&"TextEvent"in window&&!cl,pu=Bn&&(!Ac||cl&&8<cl&&11>=cl),fu=" ",hu=!1;function mu(e,n){switch(e){case"keyup":return _v.indexOf(n.keyCode)!==-1;case"keydown":return n.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function yu(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var vr=!1;function xv(e,n){switch(e){case"compositionend":return yu(n);case"keypress":return n.which!==32?null:(hu=!0,fu);case"textInput":return e=n.data,e===fu&&hu?null:e;default:return null}}function Cv(e,n){if(vr)return e==="compositionend"||!Ac&&mu(e,n)?(e=su(),ls=jc=lo=null,vr=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(n.ctrlKey||n.altKey||n.metaKey)||n.ctrlKey&&n.altKey){if(n.char&&1<n.char.length)return n.char;if(n.which)return String.fromCharCode(n.which)}return null;case"compositionend":return pu&&n.locale!=="ko"?null:n.data;default:return null}}var Sv={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function gu(e){var n=e&&e.nodeName&&e.nodeName.toLowerCase();return n==="input"?!!Sv[e.type]:n==="textarea"}function vu(e,n,r,s){$a?Ia?Ia.push(s):Ia=[s]:$a=s,n=Js(n,"onChange"),0<n.length&&(r=new is("onChange","change",null,r,s),e.push({event:r,listeners:n}))}var il=null,dl=null;function bv(e){th(e,0)}function us(e){var n=Xt(e);if(Rn(n))return e}function _u(e,n){if(e==="change")return n}var wu=!1;if(Bn){var Dc;if(Bn){var Fc="oninput"in document;if(!Fc){var xu=document.createElement("div");xu.setAttribute("oninput","return;"),Fc=typeof xu.oninput=="function"}Dc=Fc}else Dc=!1;wu=Dc&&(!document.documentMode||9<document.documentMode)}function Cu(){il&&(il.detachEvent("onpropertychange",Su),dl=il=null)}function Su(e){if(e.propertyName==="value"&&us(dl)){var n=[];vu(n,dl,e,gr(e)),os(bv,n)}}function Ev(e,n,r){e==="focusin"?(Cu(),il=n,dl=r,il.attachEvent("onpropertychange",Su)):e==="focusout"&&Cu()}function jv(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return us(dl)}function kv(e,n){if(e==="click")return us(n)}function Rv(e,n){if(e==="input"||e==="change")return us(n)}function Nv(e,n){return e===n&&(e!==0||1/e===1/n)||e!==e&&n!==n}var Nn=typeof Object.is=="function"?Object.is:Nv;function ul(e,n){if(Nn(e,n))return!0;if(typeof e!="object"||e===null||typeof n!="object"||n===null)return!1;var r=Object.keys(e),s=Object.keys(n);if(r.length!==s.length)return!1;for(s=0;s<r.length;s++){var m=r[s];if(!Pe.call(n,m)||!Nn(e[m],n[m]))return!1}return!0}function bu(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Eu(e,n){var r=bu(e);e=0;for(var s;r;){if(r.nodeType===3){if(s=e+r.textContent.length,e<=n&&s>=n)return{node:r,offset:n-e};e=s}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=bu(r)}}function ju(e,n){return e&&n?e===n?!0:e&&e.nodeType===3?!1:n&&n.nodeType===3?ju(e,n.parentNode):"contains"in e?e.contains(n):e.compareDocumentPosition?!!(e.compareDocumentPosition(n)&16):!1:!1}function ku(e){e=e!=null&&e.ownerDocument!=null&&e.ownerDocument.defaultView!=null?e.ownerDocument.defaultView:window;for(var n=Fa(e.document);n instanceof e.HTMLIFrameElement;){try{var r=typeof n.contentWindow.location.href=="string"}catch{r=!1}if(r)e=n.contentWindow;else break;n=Fa(e.document)}return n}function qc(e){var n=e&&e.nodeName&&e.nodeName.toLowerCase();return n&&(n==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||n==="textarea"||e.contentEditable==="true")}var Tv=Bn&&"documentMode"in document&&11>=document.documentMode,_r=null,$c=null,pl=null,Ic=!1;function Ru(e,n,r){var s=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;Ic||_r==null||_r!==Fa(s)||(s=_r,"selectionStart"in s&&qc(s)?s={start:s.selectionStart,end:s.selectionEnd}:(s=(s.ownerDocument&&s.ownerDocument.defaultView||window).getSelection(),s={anchorNode:s.anchorNode,anchorOffset:s.anchorOffset,focusNode:s.focusNode,focusOffset:s.focusOffset}),pl&&ul(pl,s)||(pl=s,s=Js($c,"onSelect"),0<s.length&&(n=new is("onSelect","select",null,n,r),e.push({event:n,listeners:s}),n.target=_r)))}function Yo(e,n){var r={};return r[e.toLowerCase()]=n.toLowerCase(),r["Webkit"+e]="webkit"+n,r["Moz"+e]="moz"+n,r}var wr={animationend:Yo("Animation","AnimationEnd"),animationiteration:Yo("Animation","AnimationIteration"),animationstart:Yo("Animation","AnimationStart"),transitionrun:Yo("Transition","TransitionRun"),transitionstart:Yo("Transition","TransitionStart"),transitioncancel:Yo("Transition","TransitionCancel"),transitionend:Yo("Transition","TransitionEnd")},Lc={},Nu={};Bn&&(Nu=document.createElement("div").style,"AnimationEvent"in window||(delete wr.animationend.animation,delete wr.animationiteration.animation,delete wr.animationstart.animation),"TransitionEvent"in window||delete wr.transitionend.transition);function Go(e){if(Lc[e])return Lc[e];if(!wr[e])return e;var n=wr[e],r;for(r in n)if(n.hasOwnProperty(r)&&r in Nu)return Lc[e]=n[r];return e}var Tu=Go("animationend"),Au=Go("animationiteration"),Du=Go("animationstart"),Av=Go("transitionrun"),Dv=Go("transitionstart"),Fv=Go("transitioncancel"),Fu=Go("transitionend"),qu=new Map,Pc="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Pc.push("scrollEnd");function pa(e,n){qu.set(e,n),kn(n,[e])}var ps=typeof reportError=="function"?reportError:function(e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var n=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof e=="object"&&e!==null&&typeof e.message=="string"?String(e.message):String(e),error:e});if(!window.dispatchEvent(n))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",e);return}console.error(e)},Yn=[],xr=0,Uc=0;function fs(){for(var e=xr,n=Uc=xr=0;n<e;){var r=Yn[n];Yn[n++]=null;var s=Yn[n];Yn[n++]=null;var m=Yn[n];Yn[n++]=null;var w=Yn[n];if(Yn[n++]=null,s!==null&&m!==null){var N=s.pending;N===null?m.next=m:(m.next=N.next,N.next=m),s.pending=m}w!==0&&$u(r,m,w)}}function hs(e,n,r,s){Yn[xr++]=e,Yn[xr++]=n,Yn[xr++]=r,Yn[xr++]=s,Uc|=s,e.lanes|=s,e=e.alternate,e!==null&&(e.lanes|=s)}function Oc(e,n,r,s){return hs(e,n,r,s),ms(e)}function Wo(e,n){return hs(e,null,null,n),ms(e)}function $u(e,n,r){e.lanes|=r;var s=e.alternate;s!==null&&(s.lanes|=r);for(var m=!1,w=e.return;w!==null;)w.childLanes|=r,s=w.alternate,s!==null&&(s.childLanes|=r),w.tag===22&&(e=w.stateNode,e===null||e._visibility&1||(m=!0)),e=w,w=w.return;return e.tag===3?(w=e.stateNode,m&&n!==null&&(m=31-It(r),e=w.hiddenUpdates,s=e[m],s===null?e[m]=[n]:s.push(n),n.lane=r|536870912),w):null}function ms(e){if(50<ql)throw ql=0,Qi=null,Error(c(185));for(var n=e.return;n!==null;)e=n,n=e.return;return e.tag===3?e.stateNode:null}var Cr={};function qv(e,n,r,s){this.tag=e,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=n,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=s,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Tn(e,n,r,s){return new qv(e,n,r,s)}function Mc(e){return e=e.prototype,!(!e||!e.isReactComponent)}function La(e,n){var r=e.alternate;return r===null?(r=Tn(e.tag,n,e.key,e.mode),r.elementType=e.elementType,r.type=e.type,r.stateNode=e.stateNode,r.alternate=e,e.alternate=r):(r.pendingProps=n,r.type=e.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=e.flags&65011712,r.childLanes=e.childLanes,r.lanes=e.lanes,r.child=e.child,r.memoizedProps=e.memoizedProps,r.memoizedState=e.memoizedState,r.updateQueue=e.updateQueue,n=e.dependencies,r.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext},r.sibling=e.sibling,r.index=e.index,r.ref=e.ref,r.refCleanup=e.refCleanup,r}function Iu(e,n){e.flags&=65011714;var r=e.alternate;return r===null?(e.childLanes=0,e.lanes=n,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=r.childLanes,e.lanes=r.lanes,e.child=r.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=r.memoizedProps,e.memoizedState=r.memoizedState,e.updateQueue=r.updateQueue,e.type=r.type,n=r.dependencies,e.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),e}function ys(e,n,r,s,m,w){var N=0;if(s=e,typeof e=="function")Mc(e)&&(N=1);else if(typeof e=="string")N=U_(e,r,Q.current)?26:e==="html"||e==="head"||e==="body"?27:5;else e:switch(e){case ee:return e=Tn(31,r,n,m),e.elementType=ee,e.lanes=w,e;case E:return Qo(r.children,m,w,n);case b:N=8,m|=24;break;case j:return e=Tn(12,r,n,m|2),e.elementType=j,e.lanes=w,e;case I:return e=Tn(13,r,n,m),e.elementType=I,e.lanes=w,e;case U:return e=Tn(19,r,n,m),e.elementType=U,e.lanes=w,e;default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case R:N=10;break e;case C:N=9;break e;case A:N=11;break e;case $:N=14;break e;case Z:N=16,s=null;break e}N=29,r=Error(c(130,e===null?"null":typeof e,"")),s=null}return n=Tn(N,r,n,m),n.elementType=e,n.type=s,n.lanes=w,n}function Qo(e,n,r,s){return e=Tn(7,e,s,n),e.lanes=r,e}function Hc(e,n,r){return e=Tn(6,e,null,n),e.lanes=r,e}function Lu(e){var n=Tn(18,null,null,0);return n.stateNode=e,n}function zc(e,n,r){return n=Tn(4,e.children!==null?e.children:[],e.key,n),n.lanes=r,n.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},n}var Pu=new WeakMap;function Gn(e,n){if(typeof e=="object"&&e!==null){var r=Pu.get(e);return r!==void 0?r:(n={value:e,source:n,stack:be(n)},Pu.set(e,n),n)}return{value:e,source:n,stack:be(n)}}var Sr=[],br=0,gs=null,fl=0,Wn=[],Qn=0,so=null,Sa=1,ba="";function Pa(e,n){Sr[br++]=fl,Sr[br++]=gs,gs=e,fl=n}function Uu(e,n,r){Wn[Qn++]=Sa,Wn[Qn++]=ba,Wn[Qn++]=so,so=e;var s=Sa;e=ba;var m=32-It(s)-1;s&=~(1<<m),r+=1;var w=32-It(n)+m;if(30<w){var N=m-m%5;w=(s&(1<<N)-1).toString(32),s>>=N,m-=N,Sa=1<<32-It(n)+m|r<<m|s,ba=w+e}else Sa=1<<w|r<<m|s,ba=e}function Vc(e){e.return!==null&&(Pa(e,1),Uu(e,1,0))}function Bc(e){for(;e===gs;)gs=Sr[--br],Sr[br]=null,fl=Sr[--br],Sr[br]=null;for(;e===so;)so=Wn[--Qn],Wn[Qn]=null,ba=Wn[--Qn],Wn[Qn]=null,Sa=Wn[--Qn],Wn[Qn]=null}function Ou(e,n){Wn[Qn++]=Sa,Wn[Qn++]=ba,Wn[Qn++]=so,Sa=n.id,ba=n.overflow,so=e}var nn=null,At=null,ft=!1,co=null,Xn=!1,Yc=Error(c(519));function io(e){var n=Error(c(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw hl(Gn(n,e)),Yc}function Mu(e){var n=e.stateNode,r=e.type,s=e.memoizedProps;switch(n[je]=e,n[qe]=s,r){case"dialog":dt("cancel",n),dt("close",n);break;case"iframe":case"object":case"embed":dt("load",n);break;case"video":case"audio":for(r=0;r<Il.length;r++)dt(Il[r],n);break;case"source":dt("error",n);break;case"img":case"image":case"link":dt("error",n),dt("load",n);break;case"details":dt("toggle",n);break;case"input":dt("invalid",n),Oo(n,s.value,s.defaultValue,s.checked,s.defaultChecked,s.type,s.name,!0);break;case"select":dt("invalid",n);break;case"textarea":dt("invalid",n),Ho(n,s.value,s.defaultValue,s.children)}r=s.children,typeof r!="string"&&typeof r!="number"&&typeof r!="bigint"||n.textContent===""+r||s.suppressHydrationWarning===!0||rh(n.textContent,r)?(s.popover!=null&&(dt("beforetoggle",n),dt("toggle",n)),s.onScroll!=null&&dt("scroll",n),s.onScrollEnd!=null&&dt("scrollend",n),s.onClick!=null&&(n.onclick=Vn),n=!0):n=!1,n||io(e,!0)}function Hu(e){for(nn=e.return;nn;)switch(nn.tag){case 5:case 31:case 13:Xn=!1;return;case 27:case 3:Xn=!0;return;default:nn=nn.return}}function Er(e){if(e!==nn)return!1;if(!ft)return Hu(e),ft=!0,!1;var n=e.tag,r;if((r=n!==3&&n!==27)&&((r=n===5)&&(r=e.type,r=!(r!=="form"&&r!=="button")||dd(e.type,e.memoizedProps)),r=!r),r&&At&&io(e),Hu(e),n===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(c(317));At=hh(e)}else if(n===31){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(c(317));At=hh(e)}else n===27?(n=At,bo(e.type)?(e=md,md=null,At=e):At=n):At=nn?Kn(e.stateNode.nextSibling):null;return!0}function Xo(){At=nn=null,ft=!1}function Gc(){var e=co;return e!==null&&(xn===null?xn=e:xn.push.apply(xn,e),co=null),e}function hl(e){co===null?co=[e]:co.push(e)}var Wc=M(null),Zo=null,Ua=null;function uo(e,n,r){oe(Wc,n._currentValue),n._currentValue=r}function Oa(e){e._currentValue=Wc.current,W(Wc)}function Qc(e,n,r){for(;e!==null;){var s=e.alternate;if((e.childLanes&n)!==n?(e.childLanes|=n,s!==null&&(s.childLanes|=n)):s!==null&&(s.childLanes&n)!==n&&(s.childLanes|=n),e===r)break;e=e.return}}function Xc(e,n,r,s){var m=e.child;for(m!==null&&(m.return=e);m!==null;){var w=m.dependencies;if(w!==null){var N=m.child;w=w.firstContext;e:for(;w!==null;){var H=w;w=m;for(var te=0;te<n.length;te++)if(H.context===n[te]){w.lanes|=r,H=w.alternate,H!==null&&(H.lanes|=r),Qc(w.return,r,e),s||(N=null);break e}w=H.next}}else if(m.tag===18){if(N=m.return,N===null)throw Error(c(341));N.lanes|=r,w=N.alternate,w!==null&&(w.lanes|=r),Qc(N,r,e),N=null}else N=m.child;if(N!==null)N.return=m;else for(N=m;N!==null;){if(N===e){N=null;break}if(m=N.sibling,m!==null){m.return=N.return,N=m;break}N=N.return}m=N}}function jr(e,n,r,s){e=null;for(var m=n,w=!1;m!==null;){if(!w){if((m.flags&524288)!==0)w=!0;else if((m.flags&262144)!==0)break}if(m.tag===10){var N=m.alternate;if(N===null)throw Error(c(387));if(N=N.memoizedProps,N!==null){var H=m.type;Nn(m.pendingProps.value,N.value)||(e!==null?e.push(H):e=[H])}}else if(m===me.current){if(N=m.alternate,N===null)throw Error(c(387));N.memoizedState.memoizedState!==m.memoizedState.memoizedState&&(e!==null?e.push(Ml):e=[Ml])}m=m.return}e!==null&&Xc(n,e,r,s),n.flags|=262144}function vs(e){for(e=e.firstContext;e!==null;){if(!Nn(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function Ko(e){Zo=e,Ua=null,e=e.dependencies,e!==null&&(e.firstContext=null)}function an(e){return zu(Zo,e)}function _s(e,n){return Zo===null&&Ko(e),zu(e,n)}function zu(e,n){var r=n._currentValue;if(n={context:n,memoizedValue:r,next:null},Ua===null){if(e===null)throw Error(c(308));Ua=n,e.dependencies={lanes:0,firstContext:n},e.flags|=524288}else Ua=Ua.next=n;return r}var $v=typeof AbortController<"u"?AbortController:function(){var e=[],n=this.signal={aborted:!1,addEventListener:function(r,s){e.push(s)}};this.abort=function(){n.aborted=!0,e.forEach(function(r){return r()})}},Iv=a.unstable_scheduleCallback,Lv=a.unstable_NormalPriority,Bt={$$typeof:R,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Zc(){return{controller:new $v,data:new Map,refCount:0}}function ml(e){e.refCount--,e.refCount===0&&Iv(Lv,function(){e.controller.abort()})}var yl=null,Kc=0,kr=0,Rr=null;function Pv(e,n){if(yl===null){var r=yl=[];Kc=0,kr=td(),Rr={status:"pending",value:void 0,then:function(s){r.push(s)}}}return Kc++,n.then(Vu,Vu),n}function Vu(){if(--Kc===0&&yl!==null){Rr!==null&&(Rr.status="fulfilled");var e=yl;yl=null,kr=0,Rr=null;for(var n=0;n<e.length;n++)(0,e[n])()}}function Uv(e,n){var r=[],s={status:"pending",value:null,reason:null,then:function(m){r.push(m)}};return e.then(function(){s.status="fulfilled",s.value=n;for(var m=0;m<r.length;m++)(0,r[m])(n)},function(m){for(s.status="rejected",s.reason=m,m=0;m<r.length;m++)(0,r[m])(void 0)}),s}var Bu=T.S;T.S=function(e,n){Nf=Ne(),typeof n=="object"&&n!==null&&typeof n.then=="function"&&Pv(e,n),Bu!==null&&Bu(e,n)};var Jo=M(null);function Jc(){var e=Jo.current;return e!==null?e:Tt.pooledCache}function ws(e,n){n===null?oe(Jo,Jo.current):oe(Jo,n.pool)}function Yu(){var e=Jc();return e===null?null:{parent:Bt._currentValue,pool:e}}var Nr=Error(c(460)),ei=Error(c(474)),xs=Error(c(542)),Cs={then:function(){}};function Gu(e){return e=e.status,e==="fulfilled"||e==="rejected"}function Wu(e,n,r){switch(r=e[r],r===void 0?e.push(n):r!==n&&(n.then(Vn,Vn),n=r),n.status){case"fulfilled":return n.value;case"rejected":throw e=n.reason,Xu(e),e;default:if(typeof n.status=="string")n.then(Vn,Vn);else{if(e=Tt,e!==null&&100<e.shellSuspendCounter)throw Error(c(482));e=n,e.status="pending",e.then(function(s){if(n.status==="pending"){var m=n;m.status="fulfilled",m.value=s}},function(s){if(n.status==="pending"){var m=n;m.status="rejected",m.reason=s}})}switch(n.status){case"fulfilled":return n.value;case"rejected":throw e=n.reason,Xu(e),e}throw tr=n,Nr}}function er(e){try{var n=e._init;return n(e._payload)}catch(r){throw r!==null&&typeof r=="object"&&typeof r.then=="function"?(tr=r,Nr):r}}var tr=null;function Qu(){if(tr===null)throw Error(c(459));var e=tr;return tr=null,e}function Xu(e){if(e===Nr||e===xs)throw Error(c(483))}var Tr=null,gl=0;function Ss(e){var n=gl;return gl+=1,Tr===null&&(Tr=[]),Wu(Tr,e,n)}function vl(e,n){n=n.props.ref,e.ref=n!==void 0?n:null}function bs(e,n){throw n.$$typeof===_?Error(c(525)):(e=Object.prototype.toString.call(n),Error(c(31,e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)))}function Zu(e){function n(ce,re){if(e){var de=ce.deletions;de===null?(ce.deletions=[re],ce.flags|=16):de.push(re)}}function r(ce,re){if(!e)return null;for(;re!==null;)n(ce,re),re=re.sibling;return null}function s(ce){for(var re=new Map;ce!==null;)ce.key!==null?re.set(ce.key,ce):re.set(ce.index,ce),ce=ce.sibling;return re}function m(ce,re){return ce=La(ce,re),ce.index=0,ce.sibling=null,ce}function w(ce,re,de){return ce.index=de,e?(de=ce.alternate,de!==null?(de=de.index,de<re?(ce.flags|=67108866,re):de):(ce.flags|=67108866,re)):(ce.flags|=1048576,re)}function N(ce){return e&&ce.alternate===null&&(ce.flags|=67108866),ce}function H(ce,re,de,we){return re===null||re.tag!==6?(re=Hc(de,ce.mode,we),re.return=ce,re):(re=m(re,de),re.return=ce,re)}function te(ce,re,de,we){var Be=de.type;return Be===E?ve(ce,re,de.props.children,we,de.key):re!==null&&(re.elementType===Be||typeof Be=="object"&&Be!==null&&Be.$$typeof===Z&&er(Be)===re.type)?(re=m(re,de.props),vl(re,de),re.return=ce,re):(re=ys(de.type,de.key,de.props,null,ce.mode,we),vl(re,de),re.return=ce,re)}function ue(ce,re,de,we){return re===null||re.tag!==4||re.stateNode.containerInfo!==de.containerInfo||re.stateNode.implementation!==de.implementation?(re=zc(de,ce.mode,we),re.return=ce,re):(re=m(re,de.children||[]),re.return=ce,re)}function ve(ce,re,de,we,Be){return re===null||re.tag!==7?(re=Qo(de,ce.mode,we,Be),re.return=ce,re):(re=m(re,de),re.return=ce,re)}function xe(ce,re,de){if(typeof re=="string"&&re!==""||typeof re=="number"||typeof re=="bigint")return re=Hc(""+re,ce.mode,de),re.return=ce,re;if(typeof re=="object"&&re!==null){switch(re.$$typeof){case x:return de=ys(re.type,re.key,re.props,null,ce.mode,de),vl(de,re),de.return=ce,de;case S:return re=zc(re,ce.mode,de),re.return=ce,re;case Z:return re=er(re),xe(ce,re,de)}if(D(re)||k(re))return re=Qo(re,ce.mode,de,null),re.return=ce,re;if(typeof re.then=="function")return xe(ce,Ss(re),de);if(re.$$typeof===R)return xe(ce,_s(ce,re),de);bs(ce,re)}return null}function pe(ce,re,de,we){var Be=re!==null?re.key:null;if(typeof de=="string"&&de!==""||typeof de=="number"||typeof de=="bigint")return Be!==null?null:H(ce,re,""+de,we);if(typeof de=="object"&&de!==null){switch(de.$$typeof){case x:return de.key===Be?te(ce,re,de,we):null;case S:return de.key===Be?ue(ce,re,de,we):null;case Z:return de=er(de),pe(ce,re,de,we)}if(D(de)||k(de))return Be!==null?null:ve(ce,re,de,we,null);if(typeof de.then=="function")return pe(ce,re,Ss(de),we);if(de.$$typeof===R)return pe(ce,re,_s(ce,de),we);bs(ce,de)}return null}function he(ce,re,de,we,Be){if(typeof we=="string"&&we!==""||typeof we=="number"||typeof we=="bigint")return ce=ce.get(de)||null,H(re,ce,""+we,Be);if(typeof we=="object"&&we!==null){switch(we.$$typeof){case x:return ce=ce.get(we.key===null?de:we.key)||null,te(re,ce,we,Be);case S:return ce=ce.get(we.key===null?de:we.key)||null,ue(re,ce,we,Be);case Z:return we=er(we),he(ce,re,de,we,Be)}if(D(we)||k(we))return ce=ce.get(de)||null,ve(re,ce,we,Be,null);if(typeof we.then=="function")return he(ce,re,de,Ss(we),Be);if(we.$$typeof===R)return he(ce,re,de,_s(re,we),Be);bs(re,we)}return null}function Me(ce,re,de,we){for(var Be=null,mt=null,He=re,tt=re=0,pt=null;He!==null&&tt<de.length;tt++){He.index>tt?(pt=He,He=null):pt=He.sibling;var yt=pe(ce,He,de[tt],we);if(yt===null){He===null&&(He=pt);break}e&&He&&yt.alternate===null&&n(ce,He),re=w(yt,re,tt),mt===null?Be=yt:mt.sibling=yt,mt=yt,He=pt}if(tt===de.length)return r(ce,He),ft&&Pa(ce,tt),Be;if(He===null){for(;tt<de.length;tt++)He=xe(ce,de[tt],we),He!==null&&(re=w(He,re,tt),mt===null?Be=He:mt.sibling=He,mt=He);return ft&&Pa(ce,tt),Be}for(He=s(He);tt<de.length;tt++)pt=he(He,ce,tt,de[tt],we),pt!==null&&(e&&pt.alternate!==null&&He.delete(pt.key===null?tt:pt.key),re=w(pt,re,tt),mt===null?Be=pt:mt.sibling=pt,mt=pt);return e&&He.forEach(function(No){return n(ce,No)}),ft&&Pa(ce,tt),Be}function Ge(ce,re,de,we){if(de==null)throw Error(c(151));for(var Be=null,mt=null,He=re,tt=re=0,pt=null,yt=de.next();He!==null&&!yt.done;tt++,yt=de.next()){He.index>tt?(pt=He,He=null):pt=He.sibling;var No=pe(ce,He,yt.value,we);if(No===null){He===null&&(He=pt);break}e&&He&&No.alternate===null&&n(ce,He),re=w(No,re,tt),mt===null?Be=No:mt.sibling=No,mt=No,He=pt}if(yt.done)return r(ce,He),ft&&Pa(ce,tt),Be;if(He===null){for(;!yt.done;tt++,yt=de.next())yt=xe(ce,yt.value,we),yt!==null&&(re=w(yt,re,tt),mt===null?Be=yt:mt.sibling=yt,mt=yt);return ft&&Pa(ce,tt),Be}for(He=s(He);!yt.done;tt++,yt=de.next())yt=he(He,ce,tt,yt.value,we),yt!==null&&(e&&yt.alternate!==null&&He.delete(yt.key===null?tt:yt.key),re=w(yt,re,tt),mt===null?Be=yt:mt.sibling=yt,mt=yt);return e&&He.forEach(function(X_){return n(ce,X_)}),ft&&Pa(ce,tt),Be}function Nt(ce,re,de,we){if(typeof de=="object"&&de!==null&&de.type===E&&de.key===null&&(de=de.props.children),typeof de=="object"&&de!==null){switch(de.$$typeof){case x:e:{for(var Be=de.key;re!==null;){if(re.key===Be){if(Be=de.type,Be===E){if(re.tag===7){r(ce,re.sibling),we=m(re,de.props.children),we.return=ce,ce=we;break e}}else if(re.elementType===Be||typeof Be=="object"&&Be!==null&&Be.$$typeof===Z&&er(Be)===re.type){r(ce,re.sibling),we=m(re,de.props),vl(we,de),we.return=ce,ce=we;break e}r(ce,re);break}else n(ce,re);re=re.sibling}de.type===E?(we=Qo(de.props.children,ce.mode,we,de.key),we.return=ce,ce=we):(we=ys(de.type,de.key,de.props,null,ce.mode,we),vl(we,de),we.return=ce,ce=we)}return N(ce);case S:e:{for(Be=de.key;re!==null;){if(re.key===Be)if(re.tag===4&&re.stateNode.containerInfo===de.containerInfo&&re.stateNode.implementation===de.implementation){r(ce,re.sibling),we=m(re,de.children||[]),we.return=ce,ce=we;break e}else{r(ce,re);break}else n(ce,re);re=re.sibling}we=zc(de,ce.mode,we),we.return=ce,ce=we}return N(ce);case Z:return de=er(de),Nt(ce,re,de,we)}if(D(de))return Me(ce,re,de,we);if(k(de)){if(Be=k(de),typeof Be!="function")throw Error(c(150));return de=Be.call(de),Ge(ce,re,de,we)}if(typeof de.then=="function")return Nt(ce,re,Ss(de),we);if(de.$$typeof===R)return Nt(ce,re,_s(ce,de),we);bs(ce,de)}return typeof de=="string"&&de!==""||typeof de=="number"||typeof de=="bigint"?(de=""+de,re!==null&&re.tag===6?(r(ce,re.sibling),we=m(re,de),we.return=ce,ce=we):(r(ce,re),we=Hc(de,ce.mode,we),we.return=ce,ce=we),N(ce)):r(ce,re)}return function(ce,re,de,we){try{gl=0;var Be=Nt(ce,re,de,we);return Tr=null,Be}catch(He){if(He===Nr||He===xs)throw He;var mt=Tn(29,He,null,ce.mode);return mt.lanes=we,mt.return=ce,mt}finally{}}}var nr=Zu(!0),Ku=Zu(!1),po=!1;function ti(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function ni(e,n){e=e.updateQueue,n.updateQueue===e&&(n.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function fo(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function ho(e,n,r){var s=e.updateQueue;if(s===null)return null;if(s=s.shared,(vt&2)!==0){var m=s.pending;return m===null?n.next=n:(n.next=m.next,m.next=n),s.pending=n,n=ms(e),$u(e,null,r),n}return hs(e,s,n,r),ms(e)}function _l(e,n,r){if(n=n.updateQueue,n!==null&&(n=n.shared,(r&4194048)!==0)){var s=n.lanes;s&=e.pendingLanes,r|=s,n.lanes=r,_a(e,r)}}function ai(e,n){var r=e.updateQueue,s=e.alternate;if(s!==null&&(s=s.updateQueue,r===s)){var m=null,w=null;if(r=r.firstBaseUpdate,r!==null){do{var N={lane:r.lane,tag:r.tag,payload:r.payload,callback:null,next:null};w===null?m=w=N:w=w.next=N,r=r.next}while(r!==null);w===null?m=w=n:w=w.next=n}else m=w=n;r={baseState:s.baseState,firstBaseUpdate:m,lastBaseUpdate:w,shared:s.shared,callbacks:s.callbacks},e.updateQueue=r;return}e=r.lastBaseUpdate,e===null?r.firstBaseUpdate=n:e.next=n,r.lastBaseUpdate=n}var oi=!1;function wl(){if(oi){var e=Rr;if(e!==null)throw e}}function xl(e,n,r,s){oi=!1;var m=e.updateQueue;po=!1;var w=m.firstBaseUpdate,N=m.lastBaseUpdate,H=m.shared.pending;if(H!==null){m.shared.pending=null;var te=H,ue=te.next;te.next=null,N===null?w=ue:N.next=ue,N=te;var ve=e.alternate;ve!==null&&(ve=ve.updateQueue,H=ve.lastBaseUpdate,H!==N&&(H===null?ve.firstBaseUpdate=ue:H.next=ue,ve.lastBaseUpdate=te))}if(w!==null){var xe=m.baseState;N=0,ve=ue=te=null,H=w;do{var pe=H.lane&-536870913,he=pe!==H.lane;if(he?(ut&pe)===pe:(s&pe)===pe){pe!==0&&pe===kr&&(oi=!0),ve!==null&&(ve=ve.next={lane:0,tag:H.tag,payload:H.payload,callback:null,next:null});e:{var Me=e,Ge=H;pe=n;var Nt=r;switch(Ge.tag){case 1:if(Me=Ge.payload,typeof Me=="function"){xe=Me.call(Nt,xe,pe);break e}xe=Me;break e;case 3:Me.flags=Me.flags&-65537|128;case 0:if(Me=Ge.payload,pe=typeof Me=="function"?Me.call(Nt,xe,pe):Me,pe==null)break e;xe=g({},xe,pe);break e;case 2:po=!0}}pe=H.callback,pe!==null&&(e.flags|=64,he&&(e.flags|=8192),he=m.callbacks,he===null?m.callbacks=[pe]:he.push(pe))}else he={lane:pe,tag:H.tag,payload:H.payload,callback:H.callback,next:null},ve===null?(ue=ve=he,te=xe):ve=ve.next=he,N|=pe;if(H=H.next,H===null){if(H=m.shared.pending,H===null)break;he=H,H=he.next,he.next=null,m.lastBaseUpdate=he,m.shared.pending=null}}while(!0);ve===null&&(te=xe),m.baseState=te,m.firstBaseUpdate=ue,m.lastBaseUpdate=ve,w===null&&(m.shared.lanes=0),_o|=N,e.lanes=N,e.memoizedState=xe}}function Ju(e,n){if(typeof e!="function")throw Error(c(191,e));e.call(n)}function ep(e,n){var r=e.callbacks;if(r!==null)for(e.callbacks=null,e=0;e<r.length;e++)Ju(r[e],n)}var Ar=M(null),Es=M(0);function tp(e,n){e=Qa,oe(Es,e),oe(Ar,n),Qa=e|n.baseLanes}function ri(){oe(Es,Qa),oe(Ar,Ar.current)}function li(){Qa=Es.current,W(Ar),W(Es)}var An=M(null),Zn=null;function mo(e){var n=e.alternate;oe(Ht,Ht.current&1),oe(An,e),Zn===null&&(n===null||Ar.current!==null||n.memoizedState!==null)&&(Zn=e)}function si(e){oe(Ht,Ht.current),oe(An,e),Zn===null&&(Zn=e)}function np(e){e.tag===22?(oe(Ht,Ht.current),oe(An,e),Zn===null&&(Zn=e)):yo()}function yo(){oe(Ht,Ht.current),oe(An,An.current)}function Dn(e){W(An),Zn===e&&(Zn=null),W(Ht)}var Ht=M(0);function js(e){for(var n=e;n!==null;){if(n.tag===13){var r=n.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||fd(r)||hd(r)))return n}else if(n.tag===19&&(n.memoizedProps.revealOrder==="forwards"||n.memoizedProps.revealOrder==="backwards"||n.memoizedProps.revealOrder==="unstable_legacy-backwards"||n.memoizedProps.revealOrder==="together")){if((n.flags&128)!==0)return n}else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return null;n=n.return}n.sibling.return=n.return,n=n.sibling}return null}var Ma=0,et=null,kt=null,Yt=null,ks=!1,Dr=!1,ar=!1,Rs=0,Cl=0,Fr=null,Ov=0;function Ut(){throw Error(c(321))}function ci(e,n){if(n===null)return!1;for(var r=0;r<n.length&&r<e.length;r++)if(!Nn(e[r],n[r]))return!1;return!0}function ii(e,n,r,s,m,w){return Ma=w,et=n,n.memoizedState=null,n.updateQueue=null,n.lanes=0,T.H=e===null||e.memoizedState===null?Up:bi,ar=!1,w=r(s,m),ar=!1,Dr&&(w=op(n,r,s,m)),ap(e),w}function ap(e){T.H=El;var n=kt!==null&&kt.next!==null;if(Ma=0,Yt=kt=et=null,ks=!1,Cl=0,Fr=null,n)throw Error(c(300));e===null||Gt||(e=e.dependencies,e!==null&&vs(e)&&(Gt=!0))}function op(e,n,r,s){et=e;var m=0;do{if(Dr&&(Fr=null),Cl=0,Dr=!1,25<=m)throw Error(c(301));if(m+=1,Yt=kt=null,e.updateQueue!=null){var w=e.updateQueue;w.lastEffect=null,w.events=null,w.stores=null,w.memoCache!=null&&(w.memoCache.index=0)}T.H=Op,w=n(r,s)}while(Dr);return w}function Mv(){var e=T.H,n=e.useState()[0];return n=typeof n.then=="function"?Sl(n):n,e=e.useState()[0],(kt!==null?kt.memoizedState:null)!==e&&(et.flags|=1024),n}function di(){var e=Rs!==0;return Rs=0,e}function ui(e,n,r){n.updateQueue=e.updateQueue,n.flags&=-2053,e.lanes&=~r}function pi(e){if(ks){for(e=e.memoizedState;e!==null;){var n=e.queue;n!==null&&(n.pending=null),e=e.next}ks=!1}Ma=0,Yt=kt=et=null,Dr=!1,Cl=Rs=0,Fr=null}function un(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Yt===null?et.memoizedState=Yt=e:Yt=Yt.next=e,Yt}function zt(){if(kt===null){var e=et.alternate;e=e!==null?e.memoizedState:null}else e=kt.next;var n=Yt===null?et.memoizedState:Yt.next;if(n!==null)Yt=n,kt=e;else{if(e===null)throw et.alternate===null?Error(c(467)):Error(c(310));kt=e,e={memoizedState:kt.memoizedState,baseState:kt.baseState,baseQueue:kt.baseQueue,queue:kt.queue,next:null},Yt===null?et.memoizedState=Yt=e:Yt=Yt.next=e}return Yt}function Ns(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Sl(e){var n=Cl;return Cl+=1,Fr===null&&(Fr=[]),e=Wu(Fr,e,n),n=et,(Yt===null?n.memoizedState:Yt.next)===null&&(n=n.alternate,T.H=n===null||n.memoizedState===null?Up:bi),e}function Ts(e){if(e!==null&&typeof e=="object"){if(typeof e.then=="function")return Sl(e);if(e.$$typeof===R)return an(e)}throw Error(c(438,String(e)))}function fi(e){var n=null,r=et.updateQueue;if(r!==null&&(n=r.memoCache),n==null){var s=et.alternate;s!==null&&(s=s.updateQueue,s!==null&&(s=s.memoCache,s!=null&&(n={data:s.data.map(function(m){return m.slice()}),index:0})))}if(n==null&&(n={data:[],index:0}),r===null&&(r=Ns(),et.updateQueue=r),r.memoCache=n,r=n.data[n.index],r===void 0)for(r=n.data[n.index]=Array(e),s=0;s<e;s++)r[s]=z;return n.index++,r}function Ha(e,n){return typeof n=="function"?n(e):n}function As(e){var n=zt();return hi(n,kt,e)}function hi(e,n,r){var s=e.queue;if(s===null)throw Error(c(311));s.lastRenderedReducer=r;var m=e.baseQueue,w=s.pending;if(w!==null){if(m!==null){var N=m.next;m.next=w.next,w.next=N}n.baseQueue=m=w,s.pending=null}if(w=e.baseState,m===null)e.memoizedState=w;else{n=m.next;var H=N=null,te=null,ue=n,ve=!1;do{var xe=ue.lane&-536870913;if(xe!==ue.lane?(ut&xe)===xe:(Ma&xe)===xe){var pe=ue.revertLane;if(pe===0)te!==null&&(te=te.next={lane:0,revertLane:0,gesture:null,action:ue.action,hasEagerState:ue.hasEagerState,eagerState:ue.eagerState,next:null}),xe===kr&&(ve=!0);else if((Ma&pe)===pe){ue=ue.next,pe===kr&&(ve=!0);continue}else xe={lane:0,revertLane:ue.revertLane,gesture:null,action:ue.action,hasEagerState:ue.hasEagerState,eagerState:ue.eagerState,next:null},te===null?(H=te=xe,N=w):te=te.next=xe,et.lanes|=pe,_o|=pe;xe=ue.action,ar&&r(w,xe),w=ue.hasEagerState?ue.eagerState:r(w,xe)}else pe={lane:xe,revertLane:ue.revertLane,gesture:ue.gesture,action:ue.action,hasEagerState:ue.hasEagerState,eagerState:ue.eagerState,next:null},te===null?(H=te=pe,N=w):te=te.next=pe,et.lanes|=xe,_o|=xe;ue=ue.next}while(ue!==null&&ue!==n);if(te===null?N=w:te.next=H,!Nn(w,e.memoizedState)&&(Gt=!0,ve&&(r=Rr,r!==null)))throw r;e.memoizedState=w,e.baseState=N,e.baseQueue=te,s.lastRenderedState=w}return m===null&&(s.lanes=0),[e.memoizedState,s.dispatch]}function mi(e){var n=zt(),r=n.queue;if(r===null)throw Error(c(311));r.lastRenderedReducer=e;var s=r.dispatch,m=r.pending,w=n.memoizedState;if(m!==null){r.pending=null;var N=m=m.next;do w=e(w,N.action),N=N.next;while(N!==m);Nn(w,n.memoizedState)||(Gt=!0),n.memoizedState=w,n.baseQueue===null&&(n.baseState=w),r.lastRenderedState=w}return[w,s]}function rp(e,n,r){var s=et,m=zt(),w=ft;if(w){if(r===void 0)throw Error(c(407));r=r()}else r=n();var N=!Nn((kt||m).memoizedState,r);if(N&&(m.memoizedState=r,Gt=!0),m=m.queue,vi(cp.bind(null,s,m,e),[e]),m.getSnapshot!==n||N||Yt!==null&&Yt.memoizedState.tag&1){if(s.flags|=2048,qr(9,{destroy:void 0},sp.bind(null,s,m,r,n),null),Tt===null)throw Error(c(349));w||(Ma&127)!==0||lp(s,n,r)}return r}function lp(e,n,r){e.flags|=16384,e={getSnapshot:n,value:r},n=et.updateQueue,n===null?(n=Ns(),et.updateQueue=n,n.stores=[e]):(r=n.stores,r===null?n.stores=[e]:r.push(e))}function sp(e,n,r,s){n.value=r,n.getSnapshot=s,ip(n)&&dp(e)}function cp(e,n,r){return r(function(){ip(n)&&dp(e)})}function ip(e){var n=e.getSnapshot;e=e.value;try{var r=n();return!Nn(e,r)}catch{return!0}}function dp(e){var n=Wo(e,2);n!==null&&Cn(n,e,2)}function yi(e){var n=un();if(typeof e=="function"){var r=e;if(e=r(),ar){tn(!0);try{r()}finally{tn(!1)}}}return n.memoizedState=n.baseState=e,n.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ha,lastRenderedState:e},n}function up(e,n,r,s){return e.baseState=r,hi(e,kt,typeof s=="function"?s:Ha)}function Hv(e,n,r,s,m){if(qs(e))throw Error(c(485));if(e=n.action,e!==null){var w={payload:m,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(N){w.listeners.push(N)}};T.T!==null?r(!0):w.isTransition=!1,s(w),r=n.pending,r===null?(w.next=n.pending=w,pp(n,w)):(w.next=r.next,n.pending=r.next=w)}}function pp(e,n){var r=n.action,s=n.payload,m=e.state;if(n.isTransition){var w=T.T,N={};T.T=N;try{var H=r(m,s),te=T.S;te!==null&&te(N,H),fp(e,n,H)}catch(ue){gi(e,n,ue)}finally{w!==null&&N.types!==null&&(w.types=N.types),T.T=w}}else try{w=r(m,s),fp(e,n,w)}catch(ue){gi(e,n,ue)}}function fp(e,n,r){r!==null&&typeof r=="object"&&typeof r.then=="function"?r.then(function(s){hp(e,n,s)},function(s){return gi(e,n,s)}):hp(e,n,r)}function hp(e,n,r){n.status="fulfilled",n.value=r,mp(n),e.state=r,n=e.pending,n!==null&&(r=n.next,r===n?e.pending=null:(r=r.next,n.next=r,pp(e,r)))}function gi(e,n,r){var s=e.pending;if(e.pending=null,s!==null){s=s.next;do n.status="rejected",n.reason=r,mp(n),n=n.next;while(n!==s)}e.action=null}function mp(e){e=e.listeners;for(var n=0;n<e.length;n++)(0,e[n])()}function yp(e,n){return n}function gp(e,n){if(ft){var r=Tt.formState;if(r!==null){e:{var s=et;if(ft){if(At){t:{for(var m=At,w=Xn;m.nodeType!==8;){if(!w){m=null;break t}if(m=Kn(m.nextSibling),m===null){m=null;break t}}w=m.data,m=w==="F!"||w==="F"?m:null}if(m){At=Kn(m.nextSibling),s=m.data==="F!";break e}}io(s)}s=!1}s&&(n=r[0])}}return r=un(),r.memoizedState=r.baseState=n,s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:yp,lastRenderedState:n},r.queue=s,r=Ip.bind(null,et,s),s.dispatch=r,s=yi(!1),w=Si.bind(null,et,!1,s.queue),s=un(),m={state:n,dispatch:null,action:e,pending:null},s.queue=m,r=Hv.bind(null,et,m,w,r),m.dispatch=r,s.memoizedState=e,[n,r,!1]}function vp(e){var n=zt();return _p(n,kt,e)}function _p(e,n,r){if(n=hi(e,n,yp)[0],e=As(Ha)[0],typeof n=="object"&&n!==null&&typeof n.then=="function")try{var s=Sl(n)}catch(N){throw N===Nr?xs:N}else s=n;n=zt();var m=n.queue,w=m.dispatch;return r!==n.memoizedState&&(et.flags|=2048,qr(9,{destroy:void 0},zv.bind(null,m,r),null)),[s,w,e]}function zv(e,n){e.action=n}function wp(e){var n=zt(),r=kt;if(r!==null)return _p(n,r,e);zt(),n=n.memoizedState,r=zt();var s=r.queue.dispatch;return r.memoizedState=e,[n,s,!1]}function qr(e,n,r,s){return e={tag:e,create:r,deps:s,inst:n,next:null},n=et.updateQueue,n===null&&(n=Ns(),et.updateQueue=n),r=n.lastEffect,r===null?n.lastEffect=e.next=e:(s=r.next,r.next=e,e.next=s,n.lastEffect=e),e}function xp(){return zt().memoizedState}function Ds(e,n,r,s){var m=un();et.flags|=e,m.memoizedState=qr(1|n,{destroy:void 0},r,s===void 0?null:s)}function Fs(e,n,r,s){var m=zt();s=s===void 0?null:s;var w=m.memoizedState.inst;kt!==null&&s!==null&&ci(s,kt.memoizedState.deps)?m.memoizedState=qr(n,w,r,s):(et.flags|=e,m.memoizedState=qr(1|n,w,r,s))}function Cp(e,n){Ds(8390656,8,e,n)}function vi(e,n){Fs(2048,8,e,n)}function Vv(e){et.flags|=4;var n=et.updateQueue;if(n===null)n=Ns(),et.updateQueue=n,n.events=[e];else{var r=n.events;r===null?n.events=[e]:r.push(e)}}function Sp(e){var n=zt().memoizedState;return Vv({ref:n,nextImpl:e}),function(){if((vt&2)!==0)throw Error(c(440));return n.impl.apply(void 0,arguments)}}function bp(e,n){return Fs(4,2,e,n)}function Ep(e,n){return Fs(4,4,e,n)}function jp(e,n){if(typeof n=="function"){e=e();var r=n(e);return function(){typeof r=="function"?r():n(null)}}if(n!=null)return e=e(),n.current=e,function(){n.current=null}}function kp(e,n,r){r=r!=null?r.concat([e]):null,Fs(4,4,jp.bind(null,n,e),r)}function _i(){}function Rp(e,n){var r=zt();n=n===void 0?null:n;var s=r.memoizedState;return n!==null&&ci(n,s[1])?s[0]:(r.memoizedState=[e,n],e)}function Np(e,n){var r=zt();n=n===void 0?null:n;var s=r.memoizedState;if(n!==null&&ci(n,s[1]))return s[0];if(s=e(),ar){tn(!0);try{e()}finally{tn(!1)}}return r.memoizedState=[s,n],s}function wi(e,n,r){return r===void 0||(Ma&1073741824)!==0&&(ut&261930)===0?e.memoizedState=n:(e.memoizedState=r,e=Af(),et.lanes|=e,_o|=e,r)}function Tp(e,n,r,s){return Nn(r,n)?r:Ar.current!==null?(e=wi(e,r,s),Nn(e,n)||(Gt=!0),e):(Ma&42)===0||(Ma&1073741824)!==0&&(ut&261930)===0?(Gt=!0,e.memoizedState=r):(e=Af(),et.lanes|=e,_o|=e,n)}function Ap(e,n,r,s,m){var w=L.p;L.p=w!==0&&8>w?w:8;var N=T.T,H={};T.T=H,Si(e,!1,n,r);try{var te=m(),ue=T.S;if(ue!==null&&ue(H,te),te!==null&&typeof te=="object"&&typeof te.then=="function"){var ve=Uv(te,s);bl(e,n,ve,$n(e))}else bl(e,n,s,$n(e))}catch(xe){bl(e,n,{then:function(){},status:"rejected",reason:xe},$n())}finally{L.p=w,N!==null&&H.types!==null&&(N.types=H.types),T.T=N}}function Bv(){}function xi(e,n,r,s){if(e.tag!==5)throw Error(c(476));var m=Dp(e).queue;Ap(e,m,n,B,r===null?Bv:function(){return Fp(e),r(s)})}function Dp(e){var n=e.memoizedState;if(n!==null)return n;n={memoizedState:B,baseState:B,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ha,lastRenderedState:B},next:null};var r={};return n.next={memoizedState:r,baseState:r,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ha,lastRenderedState:r},next:null},e.memoizedState=n,e=e.alternate,e!==null&&(e.memoizedState=n),n}function Fp(e){var n=Dp(e);n.next===null&&(n=e.alternate.memoizedState),bl(e,n.next.queue,{},$n())}function Ci(){return an(Ml)}function qp(){return zt().memoizedState}function $p(){return zt().memoizedState}function Yv(e){for(var n=e.return;n!==null;){switch(n.tag){case 24:case 3:var r=$n();e=fo(r);var s=ho(n,e,r);s!==null&&(Cn(s,n,r),_l(s,n,r)),n={cache:Zc()},e.payload=n;return}n=n.return}}function Gv(e,n,r){var s=$n();r={lane:s,revertLane:0,gesture:null,action:r,hasEagerState:!1,eagerState:null,next:null},qs(e)?Lp(n,r):(r=Oc(e,n,r,s),r!==null&&(Cn(r,e,s),Pp(r,n,s)))}function Ip(e,n,r){var s=$n();bl(e,n,r,s)}function bl(e,n,r,s){var m={lane:s,revertLane:0,gesture:null,action:r,hasEagerState:!1,eagerState:null,next:null};if(qs(e))Lp(n,m);else{var w=e.alternate;if(e.lanes===0&&(w===null||w.lanes===0)&&(w=n.lastRenderedReducer,w!==null))try{var N=n.lastRenderedState,H=w(N,r);if(m.hasEagerState=!0,m.eagerState=H,Nn(H,N))return hs(e,n,m,0),Tt===null&&fs(),!1}catch{}finally{}if(r=Oc(e,n,m,s),r!==null)return Cn(r,e,s),Pp(r,n,s),!0}return!1}function Si(e,n,r,s){if(s={lane:2,revertLane:td(),gesture:null,action:s,hasEagerState:!1,eagerState:null,next:null},qs(e)){if(n)throw Error(c(479))}else n=Oc(e,r,s,2),n!==null&&Cn(n,e,2)}function qs(e){var n=e.alternate;return e===et||n!==null&&n===et}function Lp(e,n){Dr=ks=!0;var r=e.pending;r===null?n.next=n:(n.next=r.next,r.next=n),e.pending=n}function Pp(e,n,r){if((r&4194048)!==0){var s=n.lanes;s&=e.pendingLanes,r|=s,n.lanes=r,_a(e,r)}}var El={readContext:an,use:Ts,useCallback:Ut,useContext:Ut,useEffect:Ut,useImperativeHandle:Ut,useLayoutEffect:Ut,useInsertionEffect:Ut,useMemo:Ut,useReducer:Ut,useRef:Ut,useState:Ut,useDebugValue:Ut,useDeferredValue:Ut,useTransition:Ut,useSyncExternalStore:Ut,useId:Ut,useHostTransitionStatus:Ut,useFormState:Ut,useActionState:Ut,useOptimistic:Ut,useMemoCache:Ut,useCacheRefresh:Ut};El.useEffectEvent=Ut;var Up={readContext:an,use:Ts,useCallback:function(e,n){return un().memoizedState=[e,n===void 0?null:n],e},useContext:an,useEffect:Cp,useImperativeHandle:function(e,n,r){r=r!=null?r.concat([e]):null,Ds(4194308,4,jp.bind(null,n,e),r)},useLayoutEffect:function(e,n){return Ds(4194308,4,e,n)},useInsertionEffect:function(e,n){Ds(4,2,e,n)},useMemo:function(e,n){var r=un();n=n===void 0?null:n;var s=e();if(ar){tn(!0);try{e()}finally{tn(!1)}}return r.memoizedState=[s,n],s},useReducer:function(e,n,r){var s=un();if(r!==void 0){var m=r(n);if(ar){tn(!0);try{r(n)}finally{tn(!1)}}}else m=n;return s.memoizedState=s.baseState=m,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:m},s.queue=e,e=e.dispatch=Gv.bind(null,et,e),[s.memoizedState,e]},useRef:function(e){var n=un();return e={current:e},n.memoizedState=e},useState:function(e){e=yi(e);var n=e.queue,r=Ip.bind(null,et,n);return n.dispatch=r,[e.memoizedState,r]},useDebugValue:_i,useDeferredValue:function(e,n){var r=un();return wi(r,e,n)},useTransition:function(){var e=yi(!1);return e=Ap.bind(null,et,e.queue,!0,!1),un().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,n,r){var s=et,m=un();if(ft){if(r===void 0)throw Error(c(407));r=r()}else{if(r=n(),Tt===null)throw Error(c(349));(ut&127)!==0||lp(s,n,r)}m.memoizedState=r;var w={value:r,getSnapshot:n};return m.queue=w,Cp(cp.bind(null,s,w,e),[e]),s.flags|=2048,qr(9,{destroy:void 0},sp.bind(null,s,w,r,n),null),r},useId:function(){var e=un(),n=Tt.identifierPrefix;if(ft){var r=ba,s=Sa;r=(s&~(1<<32-It(s)-1)).toString(32)+r,n="_"+n+"R_"+r,r=Rs++,0<r&&(n+="H"+r.toString(32)),n+="_"}else r=Ov++,n="_"+n+"r_"+r.toString(32)+"_";return e.memoizedState=n},useHostTransitionStatus:Ci,useFormState:gp,useActionState:gp,useOptimistic:function(e){var n=un();n.memoizedState=n.baseState=e;var r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return n.queue=r,n=Si.bind(null,et,!0,r),r.dispatch=n,[e,n]},useMemoCache:fi,useCacheRefresh:function(){return un().memoizedState=Yv.bind(null,et)},useEffectEvent:function(e){var n=un(),r={impl:e};return n.memoizedState=r,function(){if((vt&2)!==0)throw Error(c(440));return r.impl.apply(void 0,arguments)}}},bi={readContext:an,use:Ts,useCallback:Rp,useContext:an,useEffect:vi,useImperativeHandle:kp,useInsertionEffect:bp,useLayoutEffect:Ep,useMemo:Np,useReducer:As,useRef:xp,useState:function(){return As(Ha)},useDebugValue:_i,useDeferredValue:function(e,n){var r=zt();return Tp(r,kt.memoizedState,e,n)},useTransition:function(){var e=As(Ha)[0],n=zt().memoizedState;return[typeof e=="boolean"?e:Sl(e),n]},useSyncExternalStore:rp,useId:qp,useHostTransitionStatus:Ci,useFormState:vp,useActionState:vp,useOptimistic:function(e,n){var r=zt();return up(r,kt,e,n)},useMemoCache:fi,useCacheRefresh:$p};bi.useEffectEvent=Sp;var Op={readContext:an,use:Ts,useCallback:Rp,useContext:an,useEffect:vi,useImperativeHandle:kp,useInsertionEffect:bp,useLayoutEffect:Ep,useMemo:Np,useReducer:mi,useRef:xp,useState:function(){return mi(Ha)},useDebugValue:_i,useDeferredValue:function(e,n){var r=zt();return kt===null?wi(r,e,n):Tp(r,kt.memoizedState,e,n)},useTransition:function(){var e=mi(Ha)[0],n=zt().memoizedState;return[typeof e=="boolean"?e:Sl(e),n]},useSyncExternalStore:rp,useId:qp,useHostTransitionStatus:Ci,useFormState:wp,useActionState:wp,useOptimistic:function(e,n){var r=zt();return kt!==null?up(r,kt,e,n):(r.baseState=e,[e,r.queue.dispatch])},useMemoCache:fi,useCacheRefresh:$p};Op.useEffectEvent=Sp;function Ei(e,n,r,s){n=e.memoizedState,r=r(s,n),r=r==null?n:g({},n,r),e.memoizedState=r,e.lanes===0&&(e.updateQueue.baseState=r)}var ji={enqueueSetState:function(e,n,r){e=e._reactInternals;var s=$n(),m=fo(s);m.payload=n,r!=null&&(m.callback=r),n=ho(e,m,s),n!==null&&(Cn(n,e,s),_l(n,e,s))},enqueueReplaceState:function(e,n,r){e=e._reactInternals;var s=$n(),m=fo(s);m.tag=1,m.payload=n,r!=null&&(m.callback=r),n=ho(e,m,s),n!==null&&(Cn(n,e,s),_l(n,e,s))},enqueueForceUpdate:function(e,n){e=e._reactInternals;var r=$n(),s=fo(r);s.tag=2,n!=null&&(s.callback=n),n=ho(e,s,r),n!==null&&(Cn(n,e,r),_l(n,e,r))}};function Mp(e,n,r,s,m,w,N){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(s,w,N):n.prototype&&n.prototype.isPureReactComponent?!ul(r,s)||!ul(m,w):!0}function Hp(e,n,r,s){e=n.state,typeof n.componentWillReceiveProps=="function"&&n.componentWillReceiveProps(r,s),typeof n.UNSAFE_componentWillReceiveProps=="function"&&n.UNSAFE_componentWillReceiveProps(r,s),n.state!==e&&ji.enqueueReplaceState(n,n.state,null)}function or(e,n){var r=n;if("ref"in n){r={};for(var s in n)s!=="ref"&&(r[s]=n[s])}if(e=e.defaultProps){r===n&&(r=g({},r));for(var m in e)r[m]===void 0&&(r[m]=e[m])}return r}function zp(e){ps(e)}function Vp(e){console.error(e)}function Bp(e){ps(e)}function $s(e,n){try{var r=e.onUncaughtError;r(n.value,{componentStack:n.stack})}catch(s){setTimeout(function(){throw s})}}function Yp(e,n,r){try{var s=e.onCaughtError;s(r.value,{componentStack:r.stack,errorBoundary:n.tag===1?n.stateNode:null})}catch(m){setTimeout(function(){throw m})}}function ki(e,n,r){return r=fo(r),r.tag=3,r.payload={element:null},r.callback=function(){$s(e,n)},r}function Gp(e){return e=fo(e),e.tag=3,e}function Wp(e,n,r,s){var m=r.type.getDerivedStateFromError;if(typeof m=="function"){var w=s.value;e.payload=function(){return m(w)},e.callback=function(){Yp(n,r,s)}}var N=r.stateNode;N!==null&&typeof N.componentDidCatch=="function"&&(e.callback=function(){Yp(n,r,s),typeof m!="function"&&(wo===null?wo=new Set([this]):wo.add(this));var H=s.stack;this.componentDidCatch(s.value,{componentStack:H!==null?H:""})})}function Wv(e,n,r,s,m){if(r.flags|=32768,s!==null&&typeof s=="object"&&typeof s.then=="function"){if(n=r.alternate,n!==null&&jr(n,r,m,!0),r=An.current,r!==null){switch(r.tag){case 31:case 13:return Zn===null?Gs():r.alternate===null&&Ot===0&&(Ot=3),r.flags&=-257,r.flags|=65536,r.lanes=m,s===Cs?r.flags|=16384:(n=r.updateQueue,n===null?r.updateQueue=new Set([s]):n.add(s),Ki(e,s,m)),!1;case 22:return r.flags|=65536,s===Cs?r.flags|=16384:(n=r.updateQueue,n===null?(n={transitions:null,markerInstances:null,retryQueue:new Set([s])},r.updateQueue=n):(r=n.retryQueue,r===null?n.retryQueue=new Set([s]):r.add(s)),Ki(e,s,m)),!1}throw Error(c(435,r.tag))}return Ki(e,s,m),Gs(),!1}if(ft)return n=An.current,n!==null?((n.flags&65536)===0&&(n.flags|=256),n.flags|=65536,n.lanes=m,s!==Yc&&(e=Error(c(422),{cause:s}),hl(Gn(e,r)))):(s!==Yc&&(n=Error(c(423),{cause:s}),hl(Gn(n,r))),e=e.current.alternate,e.flags|=65536,m&=-m,e.lanes|=m,s=Gn(s,r),m=ki(e.stateNode,s,m),ai(e,m),Ot!==4&&(Ot=2)),!1;var w=Error(c(520),{cause:s});if(w=Gn(w,r),Fl===null?Fl=[w]:Fl.push(w),Ot!==4&&(Ot=2),n===null)return!0;s=Gn(s,r),r=n;do{switch(r.tag){case 3:return r.flags|=65536,e=m&-m,r.lanes|=e,e=ki(r.stateNode,s,e),ai(r,e),!1;case 1:if(n=r.type,w=r.stateNode,(r.flags&128)===0&&(typeof n.getDerivedStateFromError=="function"||w!==null&&typeof w.componentDidCatch=="function"&&(wo===null||!wo.has(w))))return r.flags|=65536,m&=-m,r.lanes|=m,m=Gp(m),Wp(m,e,r,s),ai(r,m),!1}r=r.return}while(r!==null);return!1}var Ri=Error(c(461)),Gt=!1;function on(e,n,r,s){n.child=e===null?Ku(n,null,r,s):nr(n,e.child,r,s)}function Qp(e,n,r,s,m){r=r.render;var w=n.ref;if("ref"in s){var N={};for(var H in s)H!=="ref"&&(N[H]=s[H])}else N=s;return Ko(n),s=ii(e,n,r,N,w,m),H=di(),e!==null&&!Gt?(ui(e,n,m),za(e,n,m)):(ft&&H&&Vc(n),n.flags|=1,on(e,n,s,m),n.child)}function Xp(e,n,r,s,m){if(e===null){var w=r.type;return typeof w=="function"&&!Mc(w)&&w.defaultProps===void 0&&r.compare===null?(n.tag=15,n.type=w,Zp(e,n,w,s,m)):(e=ys(r.type,null,s,n,n.mode,m),e.ref=n.ref,e.return=n,n.child=e)}if(w=e.child,!Ii(e,m)){var N=w.memoizedProps;if(r=r.compare,r=r!==null?r:ul,r(N,s)&&e.ref===n.ref)return za(e,n,m)}return n.flags|=1,e=La(w,s),e.ref=n.ref,e.return=n,n.child=e}function Zp(e,n,r,s,m){if(e!==null){var w=e.memoizedProps;if(ul(w,s)&&e.ref===n.ref)if(Gt=!1,n.pendingProps=s=w,Ii(e,m))(e.flags&131072)!==0&&(Gt=!0);else return n.lanes=e.lanes,za(e,n,m)}return Ni(e,n,r,s,m)}function Kp(e,n,r,s){var m=s.children,w=e!==null?e.memoizedState:null;if(e===null&&n.stateNode===null&&(n.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),s.mode==="hidden"){if((n.flags&128)!==0){if(w=w!==null?w.baseLanes|r:r,e!==null){for(s=n.child=e.child,m=0;s!==null;)m=m|s.lanes|s.childLanes,s=s.sibling;s=m&~w}else s=0,n.child=null;return Jp(e,n,w,r,s)}if((r&536870912)!==0)n.memoizedState={baseLanes:0,cachePool:null},e!==null&&ws(n,w!==null?w.cachePool:null),w!==null?tp(n,w):ri(),np(n);else return s=n.lanes=536870912,Jp(e,n,w!==null?w.baseLanes|r:r,r,s)}else w!==null?(ws(n,w.cachePool),tp(n,w),yo(),n.memoizedState=null):(e!==null&&ws(n,null),ri(),yo());return on(e,n,m,r),n.child}function jl(e,n){return e!==null&&e.tag===22||n.stateNode!==null||(n.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),n.sibling}function Jp(e,n,r,s,m){var w=Jc();return w=w===null?null:{parent:Bt._currentValue,pool:w},n.memoizedState={baseLanes:r,cachePool:w},e!==null&&ws(n,null),ri(),np(n),e!==null&&jr(e,n,s,!0),n.childLanes=m,null}function Is(e,n){return n=Ps({mode:n.mode,children:n.children},e.mode),n.ref=e.ref,e.child=n,n.return=e,n}function ef(e,n,r){return nr(n,e.child,null,r),e=Is(n,n.pendingProps),e.flags|=2,Dn(n),n.memoizedState=null,e}function Qv(e,n,r){var s=n.pendingProps,m=(n.flags&128)!==0;if(n.flags&=-129,e===null){if(ft){if(s.mode==="hidden")return e=Is(n,s),n.lanes=536870912,jl(null,e);if(si(n),(e=At)?(e=fh(e,Xn),e=e!==null&&e.data==="&"?e:null,e!==null&&(n.memoizedState={dehydrated:e,treeContext:so!==null?{id:Sa,overflow:ba}:null,retryLane:536870912,hydrationErrors:null},r=Lu(e),r.return=n,n.child=r,nn=n,At=null)):e=null,e===null)throw io(n);return n.lanes=536870912,null}return Is(n,s)}var w=e.memoizedState;if(w!==null){var N=w.dehydrated;if(si(n),m)if(n.flags&256)n.flags&=-257,n=ef(e,n,r);else if(n.memoizedState!==null)n.child=e.child,n.flags|=128,n=null;else throw Error(c(558));else if(Gt||jr(e,n,r,!1),m=(r&e.childLanes)!==0,Gt||m){if(s=Tt,s!==null&&(N=wa(s,r),N!==0&&N!==w.retryLane))throw w.retryLane=N,Wo(e,N),Cn(s,e,N),Ri;Gs(),n=ef(e,n,r)}else e=w.treeContext,At=Kn(N.nextSibling),nn=n,ft=!0,co=null,Xn=!1,e!==null&&Ou(n,e),n=Is(n,s),n.flags|=4096;return n}return e=La(e.child,{mode:s.mode,children:s.children}),e.ref=n.ref,n.child=e,e.return=n,e}function Ls(e,n){var r=n.ref;if(r===null)e!==null&&e.ref!==null&&(n.flags|=4194816);else{if(typeof r!="function"&&typeof r!="object")throw Error(c(284));(e===null||e.ref!==r)&&(n.flags|=4194816)}}function Ni(e,n,r,s,m){return Ko(n),r=ii(e,n,r,s,void 0,m),s=di(),e!==null&&!Gt?(ui(e,n,m),za(e,n,m)):(ft&&s&&Vc(n),n.flags|=1,on(e,n,r,m),n.child)}function tf(e,n,r,s,m,w){return Ko(n),n.updateQueue=null,r=op(n,s,r,m),ap(e),s=di(),e!==null&&!Gt?(ui(e,n,w),za(e,n,w)):(ft&&s&&Vc(n),n.flags|=1,on(e,n,r,w),n.child)}function nf(e,n,r,s,m){if(Ko(n),n.stateNode===null){var w=Cr,N=r.contextType;typeof N=="object"&&N!==null&&(w=an(N)),w=new r(s,w),n.memoizedState=w.state!==null&&w.state!==void 0?w.state:null,w.updater=ji,n.stateNode=w,w._reactInternals=n,w=n.stateNode,w.props=s,w.state=n.memoizedState,w.refs={},ti(n),N=r.contextType,w.context=typeof N=="object"&&N!==null?an(N):Cr,w.state=n.memoizedState,N=r.getDerivedStateFromProps,typeof N=="function"&&(Ei(n,r,N,s),w.state=n.memoizedState),typeof r.getDerivedStateFromProps=="function"||typeof w.getSnapshotBeforeUpdate=="function"||typeof w.UNSAFE_componentWillMount!="function"&&typeof w.componentWillMount!="function"||(N=w.state,typeof w.componentWillMount=="function"&&w.componentWillMount(),typeof w.UNSAFE_componentWillMount=="function"&&w.UNSAFE_componentWillMount(),N!==w.state&&ji.enqueueReplaceState(w,w.state,null),xl(n,s,w,m),wl(),w.state=n.memoizedState),typeof w.componentDidMount=="function"&&(n.flags|=4194308),s=!0}else if(e===null){w=n.stateNode;var H=n.memoizedProps,te=or(r,H);w.props=te;var ue=w.context,ve=r.contextType;N=Cr,typeof ve=="object"&&ve!==null&&(N=an(ve));var xe=r.getDerivedStateFromProps;ve=typeof xe=="function"||typeof w.getSnapshotBeforeUpdate=="function",H=n.pendingProps!==H,ve||typeof w.UNSAFE_componentWillReceiveProps!="function"&&typeof w.componentWillReceiveProps!="function"||(H||ue!==N)&&Hp(n,w,s,N),po=!1;var pe=n.memoizedState;w.state=pe,xl(n,s,w,m),wl(),ue=n.memoizedState,H||pe!==ue||po?(typeof xe=="function"&&(Ei(n,r,xe,s),ue=n.memoizedState),(te=po||Mp(n,r,te,s,pe,ue,N))?(ve||typeof w.UNSAFE_componentWillMount!="function"&&typeof w.componentWillMount!="function"||(typeof w.componentWillMount=="function"&&w.componentWillMount(),typeof w.UNSAFE_componentWillMount=="function"&&w.UNSAFE_componentWillMount()),typeof w.componentDidMount=="function"&&(n.flags|=4194308)):(typeof w.componentDidMount=="function"&&(n.flags|=4194308),n.memoizedProps=s,n.memoizedState=ue),w.props=s,w.state=ue,w.context=N,s=te):(typeof w.componentDidMount=="function"&&(n.flags|=4194308),s=!1)}else{w=n.stateNode,ni(e,n),N=n.memoizedProps,ve=or(r,N),w.props=ve,xe=n.pendingProps,pe=w.context,ue=r.contextType,te=Cr,typeof ue=="object"&&ue!==null&&(te=an(ue)),H=r.getDerivedStateFromProps,(ue=typeof H=="function"||typeof w.getSnapshotBeforeUpdate=="function")||typeof w.UNSAFE_componentWillReceiveProps!="function"&&typeof w.componentWillReceiveProps!="function"||(N!==xe||pe!==te)&&Hp(n,w,s,te),po=!1,pe=n.memoizedState,w.state=pe,xl(n,s,w,m),wl();var he=n.memoizedState;N!==xe||pe!==he||po||e!==null&&e.dependencies!==null&&vs(e.dependencies)?(typeof H=="function"&&(Ei(n,r,H,s),he=n.memoizedState),(ve=po||Mp(n,r,ve,s,pe,he,te)||e!==null&&e.dependencies!==null&&vs(e.dependencies))?(ue||typeof w.UNSAFE_componentWillUpdate!="function"&&typeof w.componentWillUpdate!="function"||(typeof w.componentWillUpdate=="function"&&w.componentWillUpdate(s,he,te),typeof w.UNSAFE_componentWillUpdate=="function"&&w.UNSAFE_componentWillUpdate(s,he,te)),typeof w.componentDidUpdate=="function"&&(n.flags|=4),typeof w.getSnapshotBeforeUpdate=="function"&&(n.flags|=1024)):(typeof w.componentDidUpdate!="function"||N===e.memoizedProps&&pe===e.memoizedState||(n.flags|=4),typeof w.getSnapshotBeforeUpdate!="function"||N===e.memoizedProps&&pe===e.memoizedState||(n.flags|=1024),n.memoizedProps=s,n.memoizedState=he),w.props=s,w.state=he,w.context=te,s=ve):(typeof w.componentDidUpdate!="function"||N===e.memoizedProps&&pe===e.memoizedState||(n.flags|=4),typeof w.getSnapshotBeforeUpdate!="function"||N===e.memoizedProps&&pe===e.memoizedState||(n.flags|=1024),s=!1)}return w=s,Ls(e,n),s=(n.flags&128)!==0,w||s?(w=n.stateNode,r=s&&typeof r.getDerivedStateFromError!="function"?null:w.render(),n.flags|=1,e!==null&&s?(n.child=nr(n,e.child,null,m),n.child=nr(n,null,r,m)):on(e,n,r,m),n.memoizedState=w.state,e=n.child):e=za(e,n,m),e}function af(e,n,r,s){return Xo(),n.flags|=256,on(e,n,r,s),n.child}var Ti={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Ai(e){return{baseLanes:e,cachePool:Yu()}}function Di(e,n,r){return e=e!==null?e.childLanes&~r:0,n&&(e|=qn),e}function of(e,n,r){var s=n.pendingProps,m=!1,w=(n.flags&128)!==0,N;if((N=w)||(N=e!==null&&e.memoizedState===null?!1:(Ht.current&2)!==0),N&&(m=!0,n.flags&=-129),N=(n.flags&32)!==0,n.flags&=-33,e===null){if(ft){if(m?mo(n):yo(),(e=At)?(e=fh(e,Xn),e=e!==null&&e.data!=="&"?e:null,e!==null&&(n.memoizedState={dehydrated:e,treeContext:so!==null?{id:Sa,overflow:ba}:null,retryLane:536870912,hydrationErrors:null},r=Lu(e),r.return=n,n.child=r,nn=n,At=null)):e=null,e===null)throw io(n);return hd(e)?n.lanes=32:n.lanes=536870912,null}var H=s.children;return s=s.fallback,m?(yo(),m=n.mode,H=Ps({mode:"hidden",children:H},m),s=Qo(s,m,r,null),H.return=n,s.return=n,H.sibling=s,n.child=H,s=n.child,s.memoizedState=Ai(r),s.childLanes=Di(e,N,r),n.memoizedState=Ti,jl(null,s)):(mo(n),Fi(n,H))}var te=e.memoizedState;if(te!==null&&(H=te.dehydrated,H!==null)){if(w)n.flags&256?(mo(n),n.flags&=-257,n=qi(e,n,r)):n.memoizedState!==null?(yo(),n.child=e.child,n.flags|=128,n=null):(yo(),H=s.fallback,m=n.mode,s=Ps({mode:"visible",children:s.children},m),H=Qo(H,m,r,null),H.flags|=2,s.return=n,H.return=n,s.sibling=H,n.child=s,nr(n,e.child,null,r),s=n.child,s.memoizedState=Ai(r),s.childLanes=Di(e,N,r),n.memoizedState=Ti,n=jl(null,s));else if(mo(n),hd(H)){if(N=H.nextSibling&&H.nextSibling.dataset,N)var ue=N.dgst;N=ue,s=Error(c(419)),s.stack="",s.digest=N,hl({value:s,source:null,stack:null}),n=qi(e,n,r)}else if(Gt||jr(e,n,r,!1),N=(r&e.childLanes)!==0,Gt||N){if(N=Tt,N!==null&&(s=wa(N,r),s!==0&&s!==te.retryLane))throw te.retryLane=s,Wo(e,s),Cn(N,e,s),Ri;fd(H)||Gs(),n=qi(e,n,r)}else fd(H)?(n.flags|=192,n.child=e.child,n=null):(e=te.treeContext,At=Kn(H.nextSibling),nn=n,ft=!0,co=null,Xn=!1,e!==null&&Ou(n,e),n=Fi(n,s.children),n.flags|=4096);return n}return m?(yo(),H=s.fallback,m=n.mode,te=e.child,ue=te.sibling,s=La(te,{mode:"hidden",children:s.children}),s.subtreeFlags=te.subtreeFlags&65011712,ue!==null?H=La(ue,H):(H=Qo(H,m,r,null),H.flags|=2),H.return=n,s.return=n,s.sibling=H,n.child=s,jl(null,s),s=n.child,H=e.child.memoizedState,H===null?H=Ai(r):(m=H.cachePool,m!==null?(te=Bt._currentValue,m=m.parent!==te?{parent:te,pool:te}:m):m=Yu(),H={baseLanes:H.baseLanes|r,cachePool:m}),s.memoizedState=H,s.childLanes=Di(e,N,r),n.memoizedState=Ti,jl(e.child,s)):(mo(n),r=e.child,e=r.sibling,r=La(r,{mode:"visible",children:s.children}),r.return=n,r.sibling=null,e!==null&&(N=n.deletions,N===null?(n.deletions=[e],n.flags|=16):N.push(e)),n.child=r,n.memoizedState=null,r)}function Fi(e,n){return n=Ps({mode:"visible",children:n},e.mode),n.return=e,e.child=n}function Ps(e,n){return e=Tn(22,e,null,n),e.lanes=0,e}function qi(e,n,r){return nr(n,e.child,null,r),e=Fi(n,n.pendingProps.children),e.flags|=2,n.memoizedState=null,e}function rf(e,n,r){e.lanes|=n;var s=e.alternate;s!==null&&(s.lanes|=n),Qc(e.return,n,r)}function $i(e,n,r,s,m,w){var N=e.memoizedState;N===null?e.memoizedState={isBackwards:n,rendering:null,renderingStartTime:0,last:s,tail:r,tailMode:m,treeForkCount:w}:(N.isBackwards=n,N.rendering=null,N.renderingStartTime=0,N.last=s,N.tail=r,N.tailMode=m,N.treeForkCount=w)}function lf(e,n,r){var s=n.pendingProps,m=s.revealOrder,w=s.tail;s=s.children;var N=Ht.current,H=(N&2)!==0;if(H?(N=N&1|2,n.flags|=128):N&=1,oe(Ht,N),on(e,n,s,r),s=ft?fl:0,!H&&e!==null&&(e.flags&128)!==0)e:for(e=n.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&rf(e,r,n);else if(e.tag===19)rf(e,r,n);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break e;for(;e.sibling===null;){if(e.return===null||e.return===n)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}switch(m){case"forwards":for(r=n.child,m=null;r!==null;)e=r.alternate,e!==null&&js(e)===null&&(m=r),r=r.sibling;r=m,r===null?(m=n.child,n.child=null):(m=r.sibling,r.sibling=null),$i(n,!1,m,r,w,s);break;case"backwards":case"unstable_legacy-backwards":for(r=null,m=n.child,n.child=null;m!==null;){if(e=m.alternate,e!==null&&js(e)===null){n.child=m;break}e=m.sibling,m.sibling=r,r=m,m=e}$i(n,!0,r,null,w,s);break;case"together":$i(n,!1,null,null,void 0,s);break;default:n.memoizedState=null}return n.child}function za(e,n,r){if(e!==null&&(n.dependencies=e.dependencies),_o|=n.lanes,(r&n.childLanes)===0)if(e!==null){if(jr(e,n,r,!1),(r&n.childLanes)===0)return null}else return null;if(e!==null&&n.child!==e.child)throw Error(c(153));if(n.child!==null){for(e=n.child,r=La(e,e.pendingProps),n.child=r,r.return=n;e.sibling!==null;)e=e.sibling,r=r.sibling=La(e,e.pendingProps),r.return=n;r.sibling=null}return n.child}function Ii(e,n){return(e.lanes&n)!==0?!0:(e=e.dependencies,!!(e!==null&&vs(e)))}function Xv(e,n,r){switch(n.tag){case 3:ge(n,n.stateNode.containerInfo),uo(n,Bt,e.memoizedState.cache),Xo();break;case 27:case 5:K(n);break;case 4:ge(n,n.stateNode.containerInfo);break;case 10:uo(n,n.type,n.memoizedProps.value);break;case 31:if(n.memoizedState!==null)return n.flags|=128,si(n),null;break;case 13:var s=n.memoizedState;if(s!==null)return s.dehydrated!==null?(mo(n),n.flags|=128,null):(r&n.child.childLanes)!==0?of(e,n,r):(mo(n),e=za(e,n,r),e!==null?e.sibling:null);mo(n);break;case 19:var m=(e.flags&128)!==0;if(s=(r&n.childLanes)!==0,s||(jr(e,n,r,!1),s=(r&n.childLanes)!==0),m){if(s)return lf(e,n,r);n.flags|=128}if(m=n.memoizedState,m!==null&&(m.rendering=null,m.tail=null,m.lastEffect=null),oe(Ht,Ht.current),s)break;return null;case 22:return n.lanes=0,Kp(e,n,r,n.pendingProps);case 24:uo(n,Bt,e.memoizedState.cache)}return za(e,n,r)}function sf(e,n,r){if(e!==null)if(e.memoizedProps!==n.pendingProps)Gt=!0;else{if(!Ii(e,r)&&(n.flags&128)===0)return Gt=!1,Xv(e,n,r);Gt=(e.flags&131072)!==0}else Gt=!1,ft&&(n.flags&1048576)!==0&&Uu(n,fl,n.index);switch(n.lanes=0,n.tag){case 16:e:{var s=n.pendingProps;if(e=er(n.elementType),n.type=e,typeof e=="function")Mc(e)?(s=or(e,s),n.tag=1,n=nf(null,n,e,s,r)):(n.tag=0,n=Ni(null,n,e,s,r));else{if(e!=null){var m=e.$$typeof;if(m===A){n.tag=11,n=Qp(null,n,e,s,r);break e}else if(m===$){n.tag=14,n=Xp(null,n,e,s,r);break e}}throw n=F(e)||e,Error(c(306,n,""))}}return n;case 0:return Ni(e,n,n.type,n.pendingProps,r);case 1:return s=n.type,m=or(s,n.pendingProps),nf(e,n,s,m,r);case 3:e:{if(ge(n,n.stateNode.containerInfo),e===null)throw Error(c(387));s=n.pendingProps;var w=n.memoizedState;m=w.element,ni(e,n),xl(n,s,null,r);var N=n.memoizedState;if(s=N.cache,uo(n,Bt,s),s!==w.cache&&Xc(n,[Bt],r,!0),wl(),s=N.element,w.isDehydrated)if(w={element:s,isDehydrated:!1,cache:N.cache},n.updateQueue.baseState=w,n.memoizedState=w,n.flags&256){n=af(e,n,s,r);break e}else if(s!==m){m=Gn(Error(c(424)),n),hl(m),n=af(e,n,s,r);break e}else{switch(e=n.stateNode.containerInfo,e.nodeType){case 9:e=e.body;break;default:e=e.nodeName==="HTML"?e.ownerDocument.body:e}for(At=Kn(e.firstChild),nn=n,ft=!0,co=null,Xn=!0,r=Ku(n,null,s,r),n.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling}else{if(Xo(),s===m){n=za(e,n,r);break e}on(e,n,s,r)}n=n.child}return n;case 26:return Ls(e,n),e===null?(r=_h(n.type,null,n.pendingProps,null))?n.memoizedState=r:ft||(r=n.type,e=n.pendingProps,s=ec(J.current).createElement(r),s[je]=n,s[qe]=e,rn(s,r,e),Ft(s),n.stateNode=s):n.memoizedState=_h(n.type,e.memoizedProps,n.pendingProps,e.memoizedState),null;case 27:return K(n),e===null&&ft&&(s=n.stateNode=yh(n.type,n.pendingProps,J.current),nn=n,Xn=!0,m=At,bo(n.type)?(md=m,At=Kn(s.firstChild)):At=m),on(e,n,n.pendingProps.children,r),Ls(e,n),e===null&&(n.flags|=4194304),n.child;case 5:return e===null&&ft&&((m=s=At)&&(s=j_(s,n.type,n.pendingProps,Xn),s!==null?(n.stateNode=s,nn=n,At=Kn(s.firstChild),Xn=!1,m=!0):m=!1),m||io(n)),K(n),m=n.type,w=n.pendingProps,N=e!==null?e.memoizedProps:null,s=w.children,dd(m,w)?s=null:N!==null&&dd(m,N)&&(n.flags|=32),n.memoizedState!==null&&(m=ii(e,n,Mv,null,null,r),Ml._currentValue=m),Ls(e,n),on(e,n,s,r),n.child;case 6:return e===null&&ft&&((e=r=At)&&(r=k_(r,n.pendingProps,Xn),r!==null?(n.stateNode=r,nn=n,At=null,e=!0):e=!1),e||io(n)),null;case 13:return of(e,n,r);case 4:return ge(n,n.stateNode.containerInfo),s=n.pendingProps,e===null?n.child=nr(n,null,s,r):on(e,n,s,r),n.child;case 11:return Qp(e,n,n.type,n.pendingProps,r);case 7:return on(e,n,n.pendingProps,r),n.child;case 8:return on(e,n,n.pendingProps.children,r),n.child;case 12:return on(e,n,n.pendingProps.children,r),n.child;case 10:return s=n.pendingProps,uo(n,n.type,s.value),on(e,n,s.children,r),n.child;case 9:return m=n.type._context,s=n.pendingProps.children,Ko(n),m=an(m),s=s(m),n.flags|=1,on(e,n,s,r),n.child;case 14:return Xp(e,n,n.type,n.pendingProps,r);case 15:return Zp(e,n,n.type,n.pendingProps,r);case 19:return lf(e,n,r);case 31:return Qv(e,n,r);case 22:return Kp(e,n,r,n.pendingProps);case 24:return Ko(n),s=an(Bt),e===null?(m=Jc(),m===null&&(m=Tt,w=Zc(),m.pooledCache=w,w.refCount++,w!==null&&(m.pooledCacheLanes|=r),m=w),n.memoizedState={parent:s,cache:m},ti(n),uo(n,Bt,m)):((e.lanes&r)!==0&&(ni(e,n),xl(n,null,null,r),wl()),m=e.memoizedState,w=n.memoizedState,m.parent!==s?(m={parent:s,cache:s},n.memoizedState=m,n.lanes===0&&(n.memoizedState=n.updateQueue.baseState=m),uo(n,Bt,s)):(s=w.cache,uo(n,Bt,s),s!==m.cache&&Xc(n,[Bt],r,!0))),on(e,n,n.pendingProps.children,r),n.child;case 29:throw n.pendingProps}throw Error(c(156,n.tag))}function Va(e){e.flags|=4}function Li(e,n,r,s,m){if((n=(e.mode&32)!==0)&&(n=!1),n){if(e.flags|=16777216,(m&335544128)===m)if(e.stateNode.complete)e.flags|=8192;else if($f())e.flags|=8192;else throw tr=Cs,ei}else e.flags&=-16777217}function cf(e,n){if(n.type!=="stylesheet"||(n.state.loading&4)!==0)e.flags&=-16777217;else if(e.flags|=16777216,!bh(n))if($f())e.flags|=8192;else throw tr=Cs,ei}function Us(e,n){n!==null&&(e.flags|=4),e.flags&16384&&(n=e.tag!==22?ga():536870912,e.lanes|=n,Pr|=n)}function kl(e,n){if(!ft)switch(e.tailMode){case"hidden":n=e.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e.tail=null:r.sibling=null;break;case"collapsed":r=e.tail;for(var s=null;r!==null;)r.alternate!==null&&(s=r),r=r.sibling;s===null?n||e.tail===null?e.tail=null:e.tail.sibling=null:s.sibling=null}}function Dt(e){var n=e.alternate!==null&&e.alternate.child===e.child,r=0,s=0;if(n)for(var m=e.child;m!==null;)r|=m.lanes|m.childLanes,s|=m.subtreeFlags&65011712,s|=m.flags&65011712,m.return=e,m=m.sibling;else for(m=e.child;m!==null;)r|=m.lanes|m.childLanes,s|=m.subtreeFlags,s|=m.flags,m.return=e,m=m.sibling;return e.subtreeFlags|=s,e.childLanes=r,n}function Zv(e,n,r){var s=n.pendingProps;switch(Bc(n),n.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Dt(n),null;case 1:return Dt(n),null;case 3:return r=n.stateNode,s=null,e!==null&&(s=e.memoizedState.cache),n.memoizedState.cache!==s&&(n.flags|=2048),Oa(Bt),Y(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(e===null||e.child===null)&&(Er(n)?Va(n):e===null||e.memoizedState.isDehydrated&&(n.flags&256)===0||(n.flags|=1024,Gc())),Dt(n),null;case 26:var m=n.type,w=n.memoizedState;return e===null?(Va(n),w!==null?(Dt(n),cf(n,w)):(Dt(n),Li(n,m,null,s,r))):w?w!==e.memoizedState?(Va(n),Dt(n),cf(n,w)):(Dt(n),n.flags&=-16777217):(e=e.memoizedProps,e!==s&&Va(n),Dt(n),Li(n,m,e,s,r)),null;case 27:if(X(n),r=J.current,m=n.type,e!==null&&n.stateNode!=null)e.memoizedProps!==s&&Va(n);else{if(!s){if(n.stateNode===null)throw Error(c(166));return Dt(n),null}e=Q.current,Er(n)?Mu(n):(e=yh(m,s,r),n.stateNode=e,Va(n))}return Dt(n),null;case 5:if(X(n),m=n.type,e!==null&&n.stateNode!=null)e.memoizedProps!==s&&Va(n);else{if(!s){if(n.stateNode===null)throw Error(c(166));return Dt(n),null}if(w=Q.current,Er(n))Mu(n);else{var N=ec(J.current);switch(w){case 1:w=N.createElementNS("http://www.w3.org/2000/svg",m);break;case 2:w=N.createElementNS("http://www.w3.org/1998/Math/MathML",m);break;default:switch(m){case"svg":w=N.createElementNS("http://www.w3.org/2000/svg",m);break;case"math":w=N.createElementNS("http://www.w3.org/1998/Math/MathML",m);break;case"script":w=N.createElement("div"),w.innerHTML="<script><\/script>",w=w.removeChild(w.firstChild);break;case"select":w=typeof s.is=="string"?N.createElement("select",{is:s.is}):N.createElement("select"),s.multiple?w.multiple=!0:s.size&&(w.size=s.size);break;default:w=typeof s.is=="string"?N.createElement(m,{is:s.is}):N.createElement(m)}}w[je]=n,w[qe]=s;e:for(N=n.child;N!==null;){if(N.tag===5||N.tag===6)w.appendChild(N.stateNode);else if(N.tag!==4&&N.tag!==27&&N.child!==null){N.child.return=N,N=N.child;continue}if(N===n)break e;for(;N.sibling===null;){if(N.return===null||N.return===n)break e;N=N.return}N.sibling.return=N.return,N=N.sibling}n.stateNode=w;e:switch(rn(w,m,s),m){case"button":case"input":case"select":case"textarea":s=!!s.autoFocus;break e;case"img":s=!0;break e;default:s=!1}s&&Va(n)}}return Dt(n),Li(n,n.type,e===null?null:e.memoizedProps,n.pendingProps,r),null;case 6:if(e&&n.stateNode!=null)e.memoizedProps!==s&&Va(n);else{if(typeof s!="string"&&n.stateNode===null)throw Error(c(166));if(e=J.current,Er(n)){if(e=n.stateNode,r=n.memoizedProps,s=null,m=nn,m!==null)switch(m.tag){case 27:case 5:s=m.memoizedProps}e[je]=n,e=!!(e.nodeValue===r||s!==null&&s.suppressHydrationWarning===!0||rh(e.nodeValue,r)),e||io(n,!0)}else e=ec(e).createTextNode(s),e[je]=n,n.stateNode=e}return Dt(n),null;case 31:if(r=n.memoizedState,e===null||e.memoizedState!==null){if(s=Er(n),r!==null){if(e===null){if(!s)throw Error(c(318));if(e=n.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(c(557));e[je]=n}else Xo(),(n.flags&128)===0&&(n.memoizedState=null),n.flags|=4;Dt(n),e=!1}else r=Gc(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=r),e=!0;if(!e)return n.flags&256?(Dn(n),n):(Dn(n),null);if((n.flags&128)!==0)throw Error(c(558))}return Dt(n),null;case 13:if(s=n.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(m=Er(n),s!==null&&s.dehydrated!==null){if(e===null){if(!m)throw Error(c(318));if(m=n.memoizedState,m=m!==null?m.dehydrated:null,!m)throw Error(c(317));m[je]=n}else Xo(),(n.flags&128)===0&&(n.memoizedState=null),n.flags|=4;Dt(n),m=!1}else m=Gc(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=m),m=!0;if(!m)return n.flags&256?(Dn(n),n):(Dn(n),null)}return Dn(n),(n.flags&128)!==0?(n.lanes=r,n):(r=s!==null,e=e!==null&&e.memoizedState!==null,r&&(s=n.child,m=null,s.alternate!==null&&s.alternate.memoizedState!==null&&s.alternate.memoizedState.cachePool!==null&&(m=s.alternate.memoizedState.cachePool.pool),w=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(w=s.memoizedState.cachePool.pool),w!==m&&(s.flags|=2048)),r!==e&&r&&(n.child.flags|=8192),Us(n,n.updateQueue),Dt(n),null);case 4:return Y(),e===null&&rd(n.stateNode.containerInfo),Dt(n),null;case 10:return Oa(n.type),Dt(n),null;case 19:if(W(Ht),s=n.memoizedState,s===null)return Dt(n),null;if(m=(n.flags&128)!==0,w=s.rendering,w===null)if(m)kl(s,!1);else{if(Ot!==0||e!==null&&(e.flags&128)!==0)for(e=n.child;e!==null;){if(w=js(e),w!==null){for(n.flags|=128,kl(s,!1),e=w.updateQueue,n.updateQueue=e,Us(n,e),n.subtreeFlags=0,e=r,r=n.child;r!==null;)Iu(r,e),r=r.sibling;return oe(Ht,Ht.current&1|2),ft&&Pa(n,s.treeForkCount),n.child}e=e.sibling}s.tail!==null&&Ne()>Vs&&(n.flags|=128,m=!0,kl(s,!1),n.lanes=4194304)}else{if(!m)if(e=js(w),e!==null){if(n.flags|=128,m=!0,e=e.updateQueue,n.updateQueue=e,Us(n,e),kl(s,!0),s.tail===null&&s.tailMode==="hidden"&&!w.alternate&&!ft)return Dt(n),null}else 2*Ne()-s.renderingStartTime>Vs&&r!==536870912&&(n.flags|=128,m=!0,kl(s,!1),n.lanes=4194304);s.isBackwards?(w.sibling=n.child,n.child=w):(e=s.last,e!==null?e.sibling=w:n.child=w,s.last=w)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=Ne(),e.sibling=null,r=Ht.current,oe(Ht,m?r&1|2:r&1),ft&&Pa(n,s.treeForkCount),e):(Dt(n),null);case 22:case 23:return Dn(n),li(),s=n.memoizedState!==null,e!==null?e.memoizedState!==null!==s&&(n.flags|=8192):s&&(n.flags|=8192),s?(r&536870912)!==0&&(n.flags&128)===0&&(Dt(n),n.subtreeFlags&6&&(n.flags|=8192)):Dt(n),r=n.updateQueue,r!==null&&Us(n,r.retryQueue),r=null,e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(r=e.memoizedState.cachePool.pool),s=null,n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(s=n.memoizedState.cachePool.pool),s!==r&&(n.flags|=2048),e!==null&&W(Jo),null;case 24:return r=null,e!==null&&(r=e.memoizedState.cache),n.memoizedState.cache!==r&&(n.flags|=2048),Oa(Bt),Dt(n),null;case 25:return null;case 30:return null}throw Error(c(156,n.tag))}function Kv(e,n){switch(Bc(n),n.tag){case 1:return e=n.flags,e&65536?(n.flags=e&-65537|128,n):null;case 3:return Oa(Bt),Y(),e=n.flags,(e&65536)!==0&&(e&128)===0?(n.flags=e&-65537|128,n):null;case 26:case 27:case 5:return X(n),null;case 31:if(n.memoizedState!==null){if(Dn(n),n.alternate===null)throw Error(c(340));Xo()}return e=n.flags,e&65536?(n.flags=e&-65537|128,n):null;case 13:if(Dn(n),e=n.memoizedState,e!==null&&e.dehydrated!==null){if(n.alternate===null)throw Error(c(340));Xo()}return e=n.flags,e&65536?(n.flags=e&-65537|128,n):null;case 19:return W(Ht),null;case 4:return Y(),null;case 10:return Oa(n.type),null;case 22:case 23:return Dn(n),li(),e!==null&&W(Jo),e=n.flags,e&65536?(n.flags=e&-65537|128,n):null;case 24:return Oa(Bt),null;case 25:return null;default:return null}}function df(e,n){switch(Bc(n),n.tag){case 3:Oa(Bt),Y();break;case 26:case 27:case 5:X(n);break;case 4:Y();break;case 31:n.memoizedState!==null&&Dn(n);break;case 13:Dn(n);break;case 19:W(Ht);break;case 10:Oa(n.type);break;case 22:case 23:Dn(n),li(),e!==null&&W(Jo);break;case 24:Oa(Bt)}}function Rl(e,n){try{var r=n.updateQueue,s=r!==null?r.lastEffect:null;if(s!==null){var m=s.next;r=m;do{if((r.tag&e)===e){s=void 0;var w=r.create,N=r.inst;s=w(),N.destroy=s}r=r.next}while(r!==m)}}catch(H){bt(n,n.return,H)}}function go(e,n,r){try{var s=n.updateQueue,m=s!==null?s.lastEffect:null;if(m!==null){var w=m.next;s=w;do{if((s.tag&e)===e){var N=s.inst,H=N.destroy;if(H!==void 0){N.destroy=void 0,m=n;var te=r,ue=H;try{ue()}catch(ve){bt(m,te,ve)}}}s=s.next}while(s!==w)}}catch(ve){bt(n,n.return,ve)}}function uf(e){var n=e.updateQueue;if(n!==null){var r=e.stateNode;try{ep(n,r)}catch(s){bt(e,e.return,s)}}}function pf(e,n,r){r.props=or(e.type,e.memoizedProps),r.state=e.memoizedState;try{r.componentWillUnmount()}catch(s){bt(e,n,s)}}function Nl(e,n){try{var r=e.ref;if(r!==null){switch(e.tag){case 26:case 27:case 5:var s=e.stateNode;break;case 30:s=e.stateNode;break;default:s=e.stateNode}typeof r=="function"?e.refCleanup=r(s):r.current=s}}catch(m){bt(e,n,m)}}function Ea(e,n){var r=e.ref,s=e.refCleanup;if(r!==null)if(typeof s=="function")try{s()}catch(m){bt(e,n,m)}finally{e.refCleanup=null,e=e.alternate,e!=null&&(e.refCleanup=null)}else if(typeof r=="function")try{r(null)}catch(m){bt(e,n,m)}else r.current=null}function ff(e){var n=e.type,r=e.memoizedProps,s=e.stateNode;try{e:switch(n){case"button":case"input":case"select":case"textarea":r.autoFocus&&s.focus();break e;case"img":r.src?s.src=r.src:r.srcSet&&(s.srcset=r.srcSet)}}catch(m){bt(e,e.return,m)}}function Pi(e,n,r){try{var s=e.stateNode;w_(s,e.type,r,n),s[qe]=n}catch(m){bt(e,e.return,m)}}function hf(e){return e.tag===5||e.tag===3||e.tag===26||e.tag===27&&bo(e.type)||e.tag===4}function Ui(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||hf(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.tag===27&&bo(e.type)||e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Oi(e,n,r){var s=e.tag;if(s===5||s===6)e=e.stateNode,n?(r.nodeType===9?r.body:r.nodeName==="HTML"?r.ownerDocument.body:r).insertBefore(e,n):(n=r.nodeType===9?r.body:r.nodeName==="HTML"?r.ownerDocument.body:r,n.appendChild(e),r=r._reactRootContainer,r!=null||n.onclick!==null||(n.onclick=Vn));else if(s!==4&&(s===27&&bo(e.type)&&(r=e.stateNode,n=null),e=e.child,e!==null))for(Oi(e,n,r),e=e.sibling;e!==null;)Oi(e,n,r),e=e.sibling}function Os(e,n,r){var s=e.tag;if(s===5||s===6)e=e.stateNode,n?r.insertBefore(e,n):r.appendChild(e);else if(s!==4&&(s===27&&bo(e.type)&&(r=e.stateNode),e=e.child,e!==null))for(Os(e,n,r),e=e.sibling;e!==null;)Os(e,n,r),e=e.sibling}function mf(e){var n=e.stateNode,r=e.memoizedProps;try{for(var s=e.type,m=n.attributes;m.length;)n.removeAttributeNode(m[0]);rn(n,s,r),n[je]=e,n[qe]=r}catch(w){bt(e,e.return,w)}}var Ba=!1,Wt=!1,Mi=!1,yf=typeof WeakSet=="function"?WeakSet:Set,en=null;function Jv(e,n){if(e=e.containerInfo,cd=sc,e=ku(e),qc(e)){if("selectionStart"in e)var r={start:e.selectionStart,end:e.selectionEnd};else e:{r=(r=e.ownerDocument)&&r.defaultView||window;var s=r.getSelection&&r.getSelection();if(s&&s.rangeCount!==0){r=s.anchorNode;var m=s.anchorOffset,w=s.focusNode;s=s.focusOffset;try{r.nodeType,w.nodeType}catch{r=null;break e}var N=0,H=-1,te=-1,ue=0,ve=0,xe=e,pe=null;t:for(;;){for(var he;xe!==r||m!==0&&xe.nodeType!==3||(H=N+m),xe!==w||s!==0&&xe.nodeType!==3||(te=N+s),xe.nodeType===3&&(N+=xe.nodeValue.length),(he=xe.firstChild)!==null;)pe=xe,xe=he;for(;;){if(xe===e)break t;if(pe===r&&++ue===m&&(H=N),pe===w&&++ve===s&&(te=N),(he=xe.nextSibling)!==null)break;xe=pe,pe=xe.parentNode}xe=he}r=H===-1||te===-1?null:{start:H,end:te}}else r=null}r=r||{start:0,end:0}}else r=null;for(id={focusedElem:e,selectionRange:r},sc=!1,en=n;en!==null;)if(n=en,e=n.child,(n.subtreeFlags&1028)!==0&&e!==null)e.return=n,en=e;else for(;en!==null;){switch(n=en,w=n.alternate,e=n.flags,n.tag){case 0:if((e&4)!==0&&(e=n.updateQueue,e=e!==null?e.events:null,e!==null))for(r=0;r<e.length;r++)m=e[r],m.ref.impl=m.nextImpl;break;case 11:case 15:break;case 1:if((e&1024)!==0&&w!==null){e=void 0,r=n,m=w.memoizedProps,w=w.memoizedState,s=r.stateNode;try{var Me=or(r.type,m);e=s.getSnapshotBeforeUpdate(Me,w),s.__reactInternalSnapshotBeforeUpdate=e}catch(Ge){bt(r,r.return,Ge)}}break;case 3:if((e&1024)!==0){if(e=n.stateNode.containerInfo,r=e.nodeType,r===9)pd(e);else if(r===1)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":pd(e);break;default:e.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((e&1024)!==0)throw Error(c(163))}if(e=n.sibling,e!==null){e.return=n.return,en=e;break}en=n.return}}function gf(e,n,r){var s=r.flags;switch(r.tag){case 0:case 11:case 15:Ga(e,r),s&4&&Rl(5,r);break;case 1:if(Ga(e,r),s&4)if(e=r.stateNode,n===null)try{e.componentDidMount()}catch(N){bt(r,r.return,N)}else{var m=or(r.type,n.memoizedProps);n=n.memoizedState;try{e.componentDidUpdate(m,n,e.__reactInternalSnapshotBeforeUpdate)}catch(N){bt(r,r.return,N)}}s&64&&uf(r),s&512&&Nl(r,r.return);break;case 3:if(Ga(e,r),s&64&&(e=r.updateQueue,e!==null)){if(n=null,r.child!==null)switch(r.child.tag){case 27:case 5:n=r.child.stateNode;break;case 1:n=r.child.stateNode}try{ep(e,n)}catch(N){bt(r,r.return,N)}}break;case 27:n===null&&s&4&&mf(r);case 26:case 5:Ga(e,r),n===null&&s&4&&ff(r),s&512&&Nl(r,r.return);break;case 12:Ga(e,r);break;case 31:Ga(e,r),s&4&&wf(e,r);break;case 13:Ga(e,r),s&4&&xf(e,r),s&64&&(e=r.memoizedState,e!==null&&(e=e.dehydrated,e!==null&&(r=c_.bind(null,r),R_(e,r))));break;case 22:if(s=r.memoizedState!==null||Ba,!s){n=n!==null&&n.memoizedState!==null||Wt,m=Ba;var w=Wt;Ba=s,(Wt=n)&&!w?Wa(e,r,(r.subtreeFlags&8772)!==0):Ga(e,r),Ba=m,Wt=w}break;case 30:break;default:Ga(e,r)}}function vf(e){var n=e.alternate;n!==null&&(e.alternate=null,vf(n)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(n=e.stateNode,n!==null&&lt(n)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var $t=null,vn=!1;function Ya(e,n,r){for(r=r.child;r!==null;)_f(e,n,r),r=r.sibling}function _f(e,n,r){if(Mt&&typeof Mt.onCommitFiberUnmount=="function")try{Mt.onCommitFiberUnmount(pn,r)}catch{}switch(r.tag){case 26:Wt||Ea(r,n),Ya(e,n,r),r.memoizedState?r.memoizedState.count--:r.stateNode&&(r=r.stateNode,r.parentNode.removeChild(r));break;case 27:Wt||Ea(r,n);var s=$t,m=vn;bo(r.type)&&($t=r.stateNode,vn=!1),Ya(e,n,r),Pl(r.stateNode),$t=s,vn=m;break;case 5:Wt||Ea(r,n);case 6:if(s=$t,m=vn,$t=null,Ya(e,n,r),$t=s,vn=m,$t!==null)if(vn)try{($t.nodeType===9?$t.body:$t.nodeName==="HTML"?$t.ownerDocument.body:$t).removeChild(r.stateNode)}catch(w){bt(r,n,w)}else try{$t.removeChild(r.stateNode)}catch(w){bt(r,n,w)}break;case 18:$t!==null&&(vn?(e=$t,uh(e.nodeType===9?e.body:e.nodeName==="HTML"?e.ownerDocument.body:e,r.stateNode),Yr(e)):uh($t,r.stateNode));break;case 4:s=$t,m=vn,$t=r.stateNode.containerInfo,vn=!0,Ya(e,n,r),$t=s,vn=m;break;case 0:case 11:case 14:case 15:go(2,r,n),Wt||go(4,r,n),Ya(e,n,r);break;case 1:Wt||(Ea(r,n),s=r.stateNode,typeof s.componentWillUnmount=="function"&&pf(r,n,s)),Ya(e,n,r);break;case 21:Ya(e,n,r);break;case 22:Wt=(s=Wt)||r.memoizedState!==null,Ya(e,n,r),Wt=s;break;default:Ya(e,n,r)}}function wf(e,n){if(n.memoizedState===null&&(e=n.alternate,e!==null&&(e=e.memoizedState,e!==null))){e=e.dehydrated;try{Yr(e)}catch(r){bt(n,n.return,r)}}}function xf(e,n){if(n.memoizedState===null&&(e=n.alternate,e!==null&&(e=e.memoizedState,e!==null&&(e=e.dehydrated,e!==null))))try{Yr(e)}catch(r){bt(n,n.return,r)}}function e_(e){switch(e.tag){case 31:case 13:case 19:var n=e.stateNode;return n===null&&(n=e.stateNode=new yf),n;case 22:return e=e.stateNode,n=e._retryCache,n===null&&(n=e._retryCache=new yf),n;default:throw Error(c(435,e.tag))}}function Ms(e,n){var r=e_(e);n.forEach(function(s){if(!r.has(s)){r.add(s);var m=i_.bind(null,e,s);s.then(m,m)}})}function _n(e,n){var r=n.deletions;if(r!==null)for(var s=0;s<r.length;s++){var m=r[s],w=e,N=n,H=N;e:for(;H!==null;){switch(H.tag){case 27:if(bo(H.type)){$t=H.stateNode,vn=!1;break e}break;case 5:$t=H.stateNode,vn=!1;break e;case 3:case 4:$t=H.stateNode.containerInfo,vn=!0;break e}H=H.return}if($t===null)throw Error(c(160));_f(w,N,m),$t=null,vn=!1,w=m.alternate,w!==null&&(w.return=null),m.return=null}if(n.subtreeFlags&13886)for(n=n.child;n!==null;)Cf(n,e),n=n.sibling}var fa=null;function Cf(e,n){var r=e.alternate,s=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:_n(n,e),wn(e),s&4&&(go(3,e,e.return),Rl(3,e),go(5,e,e.return));break;case 1:_n(n,e),wn(e),s&512&&(Wt||r===null||Ea(r,r.return)),s&64&&Ba&&(e=e.updateQueue,e!==null&&(s=e.callbacks,s!==null&&(r=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=r===null?s:r.concat(s))));break;case 26:var m=fa;if(_n(n,e),wn(e),s&512&&(Wt||r===null||Ea(r,r.return)),s&4){var w=r!==null?r.memoizedState:null;if(s=e.memoizedState,r===null)if(s===null)if(e.stateNode===null){e:{s=e.type,r=e.memoizedProps,m=m.ownerDocument||m;t:switch(s){case"title":w=m.getElementsByTagName("title")[0],(!w||w[Ve]||w[je]||w.namespaceURI==="http://www.w3.org/2000/svg"||w.hasAttribute("itemprop"))&&(w=m.createElement(s),m.head.insertBefore(w,m.querySelector("head > title"))),rn(w,s,r),w[je]=e,Ft(w),s=w;break e;case"link":var N=Ch("link","href",m).get(s+(r.href||""));if(N){for(var H=0;H<N.length;H++)if(w=N[H],w.getAttribute("href")===(r.href==null||r.href===""?null:r.href)&&w.getAttribute("rel")===(r.rel==null?null:r.rel)&&w.getAttribute("title")===(r.title==null?null:r.title)&&w.getAttribute("crossorigin")===(r.crossOrigin==null?null:r.crossOrigin)){N.splice(H,1);break t}}w=m.createElement(s),rn(w,s,r),m.head.appendChild(w);break;case"meta":if(N=Ch("meta","content",m).get(s+(r.content||""))){for(H=0;H<N.length;H++)if(w=N[H],w.getAttribute("content")===(r.content==null?null:""+r.content)&&w.getAttribute("name")===(r.name==null?null:r.name)&&w.getAttribute("property")===(r.property==null?null:r.property)&&w.getAttribute("http-equiv")===(r.httpEquiv==null?null:r.httpEquiv)&&w.getAttribute("charset")===(r.charSet==null?null:r.charSet)){N.splice(H,1);break t}}w=m.createElement(s),rn(w,s,r),m.head.appendChild(w);break;default:throw Error(c(468,s))}w[je]=e,Ft(w),s=w}e.stateNode=s}else Sh(m,e.type,e.stateNode);else e.stateNode=xh(m,s,e.memoizedProps);else w!==s?(w===null?r.stateNode!==null&&(r=r.stateNode,r.parentNode.removeChild(r)):w.count--,s===null?Sh(m,e.type,e.stateNode):xh(m,s,e.memoizedProps)):s===null&&e.stateNode!==null&&Pi(e,e.memoizedProps,r.memoizedProps)}break;case 27:_n(n,e),wn(e),s&512&&(Wt||r===null||Ea(r,r.return)),r!==null&&s&4&&Pi(e,e.memoizedProps,r.memoizedProps);break;case 5:if(_n(n,e),wn(e),s&512&&(Wt||r===null||Ea(r,r.return)),e.flags&32){m=e.stateNode;try{yn(m,"")}catch(Me){bt(e,e.return,Me)}}s&4&&e.stateNode!=null&&(m=e.memoizedProps,Pi(e,m,r!==null?r.memoizedProps:m)),s&1024&&(Mi=!0);break;case 6:if(_n(n,e),wn(e),s&4){if(e.stateNode===null)throw Error(c(162));s=e.memoizedProps,r=e.stateNode;try{r.nodeValue=s}catch(Me){bt(e,e.return,Me)}}break;case 3:if(ac=null,m=fa,fa=tc(n.containerInfo),_n(n,e),fa=m,wn(e),s&4&&r!==null&&r.memoizedState.isDehydrated)try{Yr(n.containerInfo)}catch(Me){bt(e,e.return,Me)}Mi&&(Mi=!1,Sf(e));break;case 4:s=fa,fa=tc(e.stateNode.containerInfo),_n(n,e),wn(e),fa=s;break;case 12:_n(n,e),wn(e);break;case 31:_n(n,e),wn(e),s&4&&(s=e.updateQueue,s!==null&&(e.updateQueue=null,Ms(e,s)));break;case 13:_n(n,e),wn(e),e.child.flags&8192&&e.memoizedState!==null!=(r!==null&&r.memoizedState!==null)&&(zs=Ne()),s&4&&(s=e.updateQueue,s!==null&&(e.updateQueue=null,Ms(e,s)));break;case 22:m=e.memoizedState!==null;var te=r!==null&&r.memoizedState!==null,ue=Ba,ve=Wt;if(Ba=ue||m,Wt=ve||te,_n(n,e),Wt=ve,Ba=ue,wn(e),s&8192)e:for(n=e.stateNode,n._visibility=m?n._visibility&-2:n._visibility|1,m&&(r===null||te||Ba||Wt||rr(e)),r=null,n=e;;){if(n.tag===5||n.tag===26){if(r===null){te=r=n;try{if(w=te.stateNode,m)N=w.style,typeof N.setProperty=="function"?N.setProperty("display","none","important"):N.display="none";else{H=te.stateNode;var xe=te.memoizedProps.style,pe=xe!=null&&xe.hasOwnProperty("display")?xe.display:null;H.style.display=pe==null||typeof pe=="boolean"?"":(""+pe).trim()}}catch(Me){bt(te,te.return,Me)}}}else if(n.tag===6){if(r===null){te=n;try{te.stateNode.nodeValue=m?"":te.memoizedProps}catch(Me){bt(te,te.return,Me)}}}else if(n.tag===18){if(r===null){te=n;try{var he=te.stateNode;m?ph(he,!0):ph(te.stateNode,!1)}catch(Me){bt(te,te.return,Me)}}}else if((n.tag!==22&&n.tag!==23||n.memoizedState===null||n===e)&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;r===n&&(r=null),n=n.return}r===n&&(r=null),n.sibling.return=n.return,n=n.sibling}s&4&&(s=e.updateQueue,s!==null&&(r=s.retryQueue,r!==null&&(s.retryQueue=null,Ms(e,r))));break;case 19:_n(n,e),wn(e),s&4&&(s=e.updateQueue,s!==null&&(e.updateQueue=null,Ms(e,s)));break;case 30:break;case 21:break;default:_n(n,e),wn(e)}}function wn(e){var n=e.flags;if(n&2){try{for(var r,s=e.return;s!==null;){if(hf(s)){r=s;break}s=s.return}if(r==null)throw Error(c(160));switch(r.tag){case 27:var m=r.stateNode,w=Ui(e);Os(e,w,m);break;case 5:var N=r.stateNode;r.flags&32&&(yn(N,""),r.flags&=-33);var H=Ui(e);Os(e,H,N);break;case 3:case 4:var te=r.stateNode.containerInfo,ue=Ui(e);Oi(e,ue,te);break;default:throw Error(c(161))}}catch(ve){bt(e,e.return,ve)}e.flags&=-3}n&4096&&(e.flags&=-4097)}function Sf(e){if(e.subtreeFlags&1024)for(e=e.child;e!==null;){var n=e;Sf(n),n.tag===5&&n.flags&1024&&n.stateNode.reset(),e=e.sibling}}function Ga(e,n){if(n.subtreeFlags&8772)for(n=n.child;n!==null;)gf(e,n.alternate,n),n=n.sibling}function rr(e){for(e=e.child;e!==null;){var n=e;switch(n.tag){case 0:case 11:case 14:case 15:go(4,n,n.return),rr(n);break;case 1:Ea(n,n.return);var r=n.stateNode;typeof r.componentWillUnmount=="function"&&pf(n,n.return,r),rr(n);break;case 27:Pl(n.stateNode);case 26:case 5:Ea(n,n.return),rr(n);break;case 22:n.memoizedState===null&&rr(n);break;case 30:rr(n);break;default:rr(n)}e=e.sibling}}function Wa(e,n,r){for(r=r&&(n.subtreeFlags&8772)!==0,n=n.child;n!==null;){var s=n.alternate,m=e,w=n,N=w.flags;switch(w.tag){case 0:case 11:case 15:Wa(m,w,r),Rl(4,w);break;case 1:if(Wa(m,w,r),s=w,m=s.stateNode,typeof m.componentDidMount=="function")try{m.componentDidMount()}catch(ue){bt(s,s.return,ue)}if(s=w,m=s.updateQueue,m!==null){var H=s.stateNode;try{var te=m.shared.hiddenCallbacks;if(te!==null)for(m.shared.hiddenCallbacks=null,m=0;m<te.length;m++)Ju(te[m],H)}catch(ue){bt(s,s.return,ue)}}r&&N&64&&uf(w),Nl(w,w.return);break;case 27:mf(w);case 26:case 5:Wa(m,w,r),r&&s===null&&N&4&&ff(w),Nl(w,w.return);break;case 12:Wa(m,w,r);break;case 31:Wa(m,w,r),r&&N&4&&wf(m,w);break;case 13:Wa(m,w,r),r&&N&4&&xf(m,w);break;case 22:w.memoizedState===null&&Wa(m,w,r),Nl(w,w.return);break;case 30:break;default:Wa(m,w,r)}n=n.sibling}}function Hi(e,n){var r=null;e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(r=e.memoizedState.cachePool.pool),e=null,n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(e=n.memoizedState.cachePool.pool),e!==r&&(e!=null&&e.refCount++,r!=null&&ml(r))}function zi(e,n){e=null,n.alternate!==null&&(e=n.alternate.memoizedState.cache),n=n.memoizedState.cache,n!==e&&(n.refCount++,e!=null&&ml(e))}function ha(e,n,r,s){if(n.subtreeFlags&10256)for(n=n.child;n!==null;)bf(e,n,r,s),n=n.sibling}function bf(e,n,r,s){var m=n.flags;switch(n.tag){case 0:case 11:case 15:ha(e,n,r,s),m&2048&&Rl(9,n);break;case 1:ha(e,n,r,s);break;case 3:ha(e,n,r,s),m&2048&&(e=null,n.alternate!==null&&(e=n.alternate.memoizedState.cache),n=n.memoizedState.cache,n!==e&&(n.refCount++,e!=null&&ml(e)));break;case 12:if(m&2048){ha(e,n,r,s),e=n.stateNode;try{var w=n.memoizedProps,N=w.id,H=w.onPostCommit;typeof H=="function"&&H(N,n.alternate===null?"mount":"update",e.passiveEffectDuration,-0)}catch(te){bt(n,n.return,te)}}else ha(e,n,r,s);break;case 31:ha(e,n,r,s);break;case 13:ha(e,n,r,s);break;case 23:break;case 22:w=n.stateNode,N=n.alternate,n.memoizedState!==null?w._visibility&2?ha(e,n,r,s):Tl(e,n):w._visibility&2?ha(e,n,r,s):(w._visibility|=2,$r(e,n,r,s,(n.subtreeFlags&10256)!==0||!1)),m&2048&&Hi(N,n);break;case 24:ha(e,n,r,s),m&2048&&zi(n.alternate,n);break;default:ha(e,n,r,s)}}function $r(e,n,r,s,m){for(m=m&&((n.subtreeFlags&10256)!==0||!1),n=n.child;n!==null;){var w=e,N=n,H=r,te=s,ue=N.flags;switch(N.tag){case 0:case 11:case 15:$r(w,N,H,te,m),Rl(8,N);break;case 23:break;case 22:var ve=N.stateNode;N.memoizedState!==null?ve._visibility&2?$r(w,N,H,te,m):Tl(w,N):(ve._visibility|=2,$r(w,N,H,te,m)),m&&ue&2048&&Hi(N.alternate,N);break;case 24:$r(w,N,H,te,m),m&&ue&2048&&zi(N.alternate,N);break;default:$r(w,N,H,te,m)}n=n.sibling}}function Tl(e,n){if(n.subtreeFlags&10256)for(n=n.child;n!==null;){var r=e,s=n,m=s.flags;switch(s.tag){case 22:Tl(r,s),m&2048&&Hi(s.alternate,s);break;case 24:Tl(r,s),m&2048&&zi(s.alternate,s);break;default:Tl(r,s)}n=n.sibling}}var Al=8192;function Ir(e,n,r){if(e.subtreeFlags&Al)for(e=e.child;e!==null;)Ef(e,n,r),e=e.sibling}function Ef(e,n,r){switch(e.tag){case 26:Ir(e,n,r),e.flags&Al&&e.memoizedState!==null&&O_(r,fa,e.memoizedState,e.memoizedProps);break;case 5:Ir(e,n,r);break;case 3:case 4:var s=fa;fa=tc(e.stateNode.containerInfo),Ir(e,n,r),fa=s;break;case 22:e.memoizedState===null&&(s=e.alternate,s!==null&&s.memoizedState!==null?(s=Al,Al=16777216,Ir(e,n,r),Al=s):Ir(e,n,r));break;default:Ir(e,n,r)}}function jf(e){var n=e.alternate;if(n!==null&&(e=n.child,e!==null)){n.child=null;do n=e.sibling,e.sibling=null,e=n;while(e!==null)}}function Dl(e){var n=e.deletions;if((e.flags&16)!==0){if(n!==null)for(var r=0;r<n.length;r++){var s=n[r];en=s,Rf(s,e)}jf(e)}if(e.subtreeFlags&10256)for(e=e.child;e!==null;)kf(e),e=e.sibling}function kf(e){switch(e.tag){case 0:case 11:case 15:Dl(e),e.flags&2048&&go(9,e,e.return);break;case 3:Dl(e);break;case 12:Dl(e);break;case 22:var n=e.stateNode;e.memoizedState!==null&&n._visibility&2&&(e.return===null||e.return.tag!==13)?(n._visibility&=-3,Hs(e)):Dl(e);break;default:Dl(e)}}function Hs(e){var n=e.deletions;if((e.flags&16)!==0){if(n!==null)for(var r=0;r<n.length;r++){var s=n[r];en=s,Rf(s,e)}jf(e)}for(e=e.child;e!==null;){switch(n=e,n.tag){case 0:case 11:case 15:go(8,n,n.return),Hs(n);break;case 22:r=n.stateNode,r._visibility&2&&(r._visibility&=-3,Hs(n));break;default:Hs(n)}e=e.sibling}}function Rf(e,n){for(;en!==null;){var r=en;switch(r.tag){case 0:case 11:case 15:go(8,r,n);break;case 23:case 22:if(r.memoizedState!==null&&r.memoizedState.cachePool!==null){var s=r.memoizedState.cachePool.pool;s!=null&&s.refCount++}break;case 24:ml(r.memoizedState.cache)}if(s=r.child,s!==null)s.return=r,en=s;else e:for(r=e;en!==null;){s=en;var m=s.sibling,w=s.return;if(vf(s),s===r){en=null;break e}if(m!==null){m.return=w,en=m;break e}en=w}}}var t_={getCacheForType:function(e){var n=an(Bt),r=n.data.get(e);return r===void 0&&(r=e(),n.data.set(e,r)),r},cacheSignal:function(){return an(Bt).controller.signal}},n_=typeof WeakMap=="function"?WeakMap:Map,vt=0,Tt=null,it=null,ut=0,St=0,Fn=null,vo=!1,Lr=!1,Vi=!1,Qa=0,Ot=0,_o=0,lr=0,Bi=0,qn=0,Pr=0,Fl=null,xn=null,Yi=!1,zs=0,Nf=0,Vs=1/0,Bs=null,wo=null,Kt=0,xo=null,Ur=null,Xa=0,Gi=0,Wi=null,Tf=null,ql=0,Qi=null;function $n(){return(vt&2)!==0&&ut!==0?ut&-ut:T.T!==null?td():ia()}function Af(){if(qn===0)if((ut&536870912)===0||ft){var e=fn;fn<<=1,(fn&3932160)===0&&(fn=262144),qn=e}else qn=536870912;return e=An.current,e!==null&&(e.flags|=32),qn}function Cn(e,n,r){(e===Tt&&(St===2||St===9)||e.cancelPendingCommit!==null)&&(Or(e,0),Co(e,ut,qn,!1)),hn(e,r),((vt&2)===0||e!==Tt)&&(e===Tt&&((vt&2)===0&&(lr|=r),Ot===4&&Co(e,ut,qn,!1)),ja(e))}function Df(e,n,r){if((vt&6)!==0)throw Error(c(327));var s=!r&&(n&127)===0&&(n&e.expiredLanes)===0||jn(e,n),m=s?r_(e,n):Zi(e,n,!0),w=s;do{if(m===0){Lr&&!s&&Co(e,n,0,!1);break}else{if(r=e.current.alternate,w&&!a_(r)){m=Zi(e,n,!1),w=!1;continue}if(m===2){if(w=n,e.errorRecoveryDisabledLanes&w)var N=0;else N=e.pendingLanes&-536870913,N=N!==0?N:N&536870912?536870912:0;if(N!==0){n=N;e:{var H=e;m=Fl;var te=H.current.memoizedState.isDehydrated;if(te&&(Or(H,N).flags|=256),N=Zi(H,N,!1),N!==2){if(Vi&&!te){H.errorRecoveryDisabledLanes|=w,lr|=w,m=4;break e}w=xn,xn=m,w!==null&&(xn===null?xn=w:xn.push.apply(xn,w))}m=N}if(w=!1,m!==2)continue}}if(m===1){Or(e,0),Co(e,n,0,!0);break}e:{switch(s=e,w=m,w){case 0:case 1:throw Error(c(345));case 4:if((n&4194048)!==n)break;case 6:Co(s,n,qn,!vo);break e;case 2:xn=null;break;case 3:case 5:break;default:throw Error(c(329))}if((n&62914560)===n&&(m=zs+300-Ne(),10<m)){if(Co(s,n,qn,!vo),Mn(s,0,!0)!==0)break e;Xa=n,s.timeoutHandle=ih(Ff.bind(null,s,r,xn,Bs,Yi,n,qn,lr,Pr,vo,w,"Throttled",-0,0),m);break e}Ff(s,r,xn,Bs,Yi,n,qn,lr,Pr,vo,w,null,-0,0)}}break}while(!0);ja(e)}function Ff(e,n,r,s,m,w,N,H,te,ue,ve,xe,pe,he){if(e.timeoutHandle=-1,xe=n.subtreeFlags,xe&8192||(xe&16785408)===16785408){xe={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Vn},Ef(n,w,xe);var Me=(w&62914560)===w?zs-Ne():(w&4194048)===w?Nf-Ne():0;if(Me=M_(xe,Me),Me!==null){Xa=w,e.cancelPendingCommit=Me(Mf.bind(null,e,n,w,r,s,m,N,H,te,ve,xe,null,pe,he)),Co(e,w,N,!ue);return}}Mf(e,n,w,r,s,m,N,H,te)}function a_(e){for(var n=e;;){var r=n.tag;if((r===0||r===11||r===15)&&n.flags&16384&&(r=n.updateQueue,r!==null&&(r=r.stores,r!==null)))for(var s=0;s<r.length;s++){var m=r[s],w=m.getSnapshot;m=m.value;try{if(!Nn(w(),m))return!1}catch{return!1}}if(r=n.child,n.subtreeFlags&16384&&r!==null)r.return=n,n=r;else{if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return!0;n=n.return}n.sibling.return=n.return,n=n.sibling}}return!0}function Co(e,n,r,s){n&=~Bi,n&=~lr,e.suspendedLanes|=n,e.pingedLanes&=~n,s&&(e.warmLanes|=n),s=e.expirationTimes;for(var m=n;0<m;){var w=31-It(m),N=1<<w;s[w]=-1,m&=~N}r!==0&&va(e,r,n)}function Ys(){return(vt&6)===0?($l(0),!1):!0}function Xi(){if(it!==null){if(St===0)var e=it.return;else e=it,Ua=Zo=null,pi(e),Tr=null,gl=0,e=it;for(;e!==null;)df(e.alternate,e),e=e.return;it=null}}function Or(e,n){var r=e.timeoutHandle;r!==-1&&(e.timeoutHandle=-1,S_(r)),r=e.cancelPendingCommit,r!==null&&(e.cancelPendingCommit=null,r()),Xa=0,Xi(),Tt=e,it=r=La(e.current,null),ut=n,St=0,Fn=null,vo=!1,Lr=jn(e,n),Vi=!1,Pr=qn=Bi=lr=_o=Ot=0,xn=Fl=null,Yi=!1,(n&8)!==0&&(n|=n&32);var s=e.entangledLanes;if(s!==0)for(e=e.entanglements,s&=n;0<s;){var m=31-It(s),w=1<<m;n|=e[m],s&=~w}return Qa=n,fs(),r}function qf(e,n){et=null,T.H=El,n===Nr||n===xs?(n=Qu(),St=3):n===ei?(n=Qu(),St=4):St=n===Ri?8:n!==null&&typeof n=="object"&&typeof n.then=="function"?6:1,Fn=n,it===null&&(Ot=1,$s(e,Gn(n,e.current)))}function $f(){var e=An.current;return e===null?!0:(ut&4194048)===ut?Zn===null:(ut&62914560)===ut||(ut&536870912)!==0?e===Zn:!1}function If(){var e=T.H;return T.H=El,e===null?El:e}function Lf(){var e=T.A;return T.A=t_,e}function Gs(){Ot=4,vo||(ut&4194048)!==ut&&An.current!==null||(Lr=!0),(_o&134217727)===0&&(lr&134217727)===0||Tt===null||Co(Tt,ut,qn,!1)}function Zi(e,n,r){var s=vt;vt|=2;var m=If(),w=Lf();(Tt!==e||ut!==n)&&(Bs=null,Or(e,n)),n=!1;var N=Ot;e:do try{if(St!==0&&it!==null){var H=it,te=Fn;switch(St){case 8:Xi(),N=6;break e;case 3:case 2:case 9:case 6:An.current===null&&(n=!0);var ue=St;if(St=0,Fn=null,Mr(e,H,te,ue),r&&Lr){N=0;break e}break;default:ue=St,St=0,Fn=null,Mr(e,H,te,ue)}}o_(),N=Ot;break}catch(ve){qf(e,ve)}while(!0);return n&&e.shellSuspendCounter++,Ua=Zo=null,vt=s,T.H=m,T.A=w,it===null&&(Tt=null,ut=0,fs()),N}function o_(){for(;it!==null;)Pf(it)}function r_(e,n){var r=vt;vt|=2;var s=If(),m=Lf();Tt!==e||ut!==n?(Bs=null,Vs=Ne()+500,Or(e,n)):Lr=jn(e,n);e:do try{if(St!==0&&it!==null){n=it;var w=Fn;t:switch(St){case 1:St=0,Fn=null,Mr(e,n,w,1);break;case 2:case 9:if(Gu(w)){St=0,Fn=null,Uf(n);break}n=function(){St!==2&&St!==9||Tt!==e||(St=7),ja(e)},w.then(n,n);break e;case 3:St=7;break e;case 4:St=5;break e;case 7:Gu(w)?(St=0,Fn=null,Uf(n)):(St=0,Fn=null,Mr(e,n,w,7));break;case 5:var N=null;switch(it.tag){case 26:N=it.memoizedState;case 5:case 27:var H=it;if(N?bh(N):H.stateNode.complete){St=0,Fn=null;var te=H.sibling;if(te!==null)it=te;else{var ue=H.return;ue!==null?(it=ue,Ws(ue)):it=null}break t}}St=0,Fn=null,Mr(e,n,w,5);break;case 6:St=0,Fn=null,Mr(e,n,w,6);break;case 8:Xi(),Ot=6;break e;default:throw Error(c(462))}}l_();break}catch(ve){qf(e,ve)}while(!0);return Ua=Zo=null,T.H=s,T.A=m,vt=r,it!==null?0:(Tt=null,ut=0,fs(),Ot)}function l_(){for(;it!==null&&!Le();)Pf(it)}function Pf(e){var n=sf(e.alternate,e,Qa);e.memoizedProps=e.pendingProps,n===null?Ws(e):it=n}function Uf(e){var n=e,r=n.alternate;switch(n.tag){case 15:case 0:n=tf(r,n,n.pendingProps,n.type,void 0,ut);break;case 11:n=tf(r,n,n.pendingProps,n.type.render,n.ref,ut);break;case 5:pi(n);default:df(r,n),n=it=Iu(n,Qa),n=sf(r,n,Qa)}e.memoizedProps=e.pendingProps,n===null?Ws(e):it=n}function Mr(e,n,r,s){Ua=Zo=null,pi(n),Tr=null,gl=0;var m=n.return;try{if(Wv(e,m,n,r,ut)){Ot=1,$s(e,Gn(r,e.current)),it=null;return}}catch(w){if(m!==null)throw it=m,w;Ot=1,$s(e,Gn(r,e.current)),it=null;return}n.flags&32768?(ft||s===1?e=!0:Lr||(ut&536870912)!==0?e=!1:(vo=e=!0,(s===2||s===9||s===3||s===6)&&(s=An.current,s!==null&&s.tag===13&&(s.flags|=16384))),Of(n,e)):Ws(n)}function Ws(e){var n=e;do{if((n.flags&32768)!==0){Of(n,vo);return}e=n.return;var r=Zv(n.alternate,n,Qa);if(r!==null){it=r;return}if(n=n.sibling,n!==null){it=n;return}it=n=e}while(n!==null);Ot===0&&(Ot=5)}function Of(e,n){do{var r=Kv(e.alternate,e);if(r!==null){r.flags&=32767,it=r;return}if(r=e.return,r!==null&&(r.flags|=32768,r.subtreeFlags=0,r.deletions=null),!n&&(e=e.sibling,e!==null)){it=e;return}it=e=r}while(e!==null);Ot=6,it=null}function Mf(e,n,r,s,m,w,N,H,te){e.cancelPendingCommit=null;do Qs();while(Kt!==0);if((vt&6)!==0)throw Error(c(327));if(n!==null){if(n===e.current)throw Error(c(177));if(w=n.lanes|n.childLanes,w|=Uc,la(e,r,w,N,H,te),e===Tt&&(it=Tt=null,ut=0),Ur=n,xo=e,Xa=r,Gi=w,Wi=m,Tf=s,(n.subtreeFlags&10256)!==0||(n.flags&10256)!==0?(e.callbackNode=null,e.callbackPriority=0,d_(wt,function(){return Yf(),null})):(e.callbackNode=null,e.callbackPriority=0),s=(n.flags&13878)!==0,(n.subtreeFlags&13878)!==0||s){s=T.T,T.T=null,m=L.p,L.p=2,N=vt,vt|=4;try{Jv(e,n,r)}finally{vt=N,L.p=m,T.T=s}}Kt=1,Hf(),zf(),Vf()}}function Hf(){if(Kt===1){Kt=0;var e=xo,n=Ur,r=(n.flags&13878)!==0;if((n.subtreeFlags&13878)!==0||r){r=T.T,T.T=null;var s=L.p;L.p=2;var m=vt;vt|=4;try{Cf(n,e);var w=id,N=ku(e.containerInfo),H=w.focusedElem,te=w.selectionRange;if(N!==H&&H&&H.ownerDocument&&ju(H.ownerDocument.documentElement,H)){if(te!==null&&qc(H)){var ue=te.start,ve=te.end;if(ve===void 0&&(ve=ue),"selectionStart"in H)H.selectionStart=ue,H.selectionEnd=Math.min(ve,H.value.length);else{var xe=H.ownerDocument||document,pe=xe&&xe.defaultView||window;if(pe.getSelection){var he=pe.getSelection(),Me=H.textContent.length,Ge=Math.min(te.start,Me),Nt=te.end===void 0?Ge:Math.min(te.end,Me);!he.extend&&Ge>Nt&&(N=Nt,Nt=Ge,Ge=N);var ce=Eu(H,Ge),re=Eu(H,Nt);if(ce&&re&&(he.rangeCount!==1||he.anchorNode!==ce.node||he.anchorOffset!==ce.offset||he.focusNode!==re.node||he.focusOffset!==re.offset)){var de=xe.createRange();de.setStart(ce.node,ce.offset),he.removeAllRanges(),Ge>Nt?(he.addRange(de),he.extend(re.node,re.offset)):(de.setEnd(re.node,re.offset),he.addRange(de))}}}}for(xe=[],he=H;he=he.parentNode;)he.nodeType===1&&xe.push({element:he,left:he.scrollLeft,top:he.scrollTop});for(typeof H.focus=="function"&&H.focus(),H=0;H<xe.length;H++){var we=xe[H];we.element.scrollLeft=we.left,we.element.scrollTop=we.top}}sc=!!cd,id=cd=null}finally{vt=m,L.p=s,T.T=r}}e.current=n,Kt=2}}function zf(){if(Kt===2){Kt=0;var e=xo,n=Ur,r=(n.flags&8772)!==0;if((n.subtreeFlags&8772)!==0||r){r=T.T,T.T=null;var s=L.p;L.p=2;var m=vt;vt|=4;try{gf(e,n.alternate,n)}finally{vt=m,L.p=s,T.T=r}}Kt=3}}function Vf(){if(Kt===4||Kt===3){Kt=0,Re();var e=xo,n=Ur,r=Xa,s=Tf;(n.subtreeFlags&10256)!==0||(n.flags&10256)!==0?Kt=5:(Kt=0,Ur=xo=null,Bf(e,e.pendingLanes));var m=e.pendingLanes;if(m===0&&(wo=null),ca(r),n=n.stateNode,Mt&&typeof Mt.onCommitFiberRoot=="function")try{Mt.onCommitFiberRoot(pn,n,void 0,(n.current.flags&128)===128)}catch{}if(s!==null){n=T.T,m=L.p,L.p=2,T.T=null;try{for(var w=e.onRecoverableError,N=0;N<s.length;N++){var H=s[N];w(H.value,{componentStack:H.stack})}}finally{T.T=n,L.p=m}}(Xa&3)!==0&&Qs(),ja(e),m=e.pendingLanes,(r&261930)!==0&&(m&42)!==0?e===Qi?ql++:(ql=0,Qi=e):ql=0,$l(0)}}function Bf(e,n){(e.pooledCacheLanes&=n)===0&&(n=e.pooledCache,n!=null&&(e.pooledCache=null,ml(n)))}function Qs(){return Hf(),zf(),Vf(),Yf()}function Yf(){if(Kt!==5)return!1;var e=xo,n=Gi;Gi=0;var r=ca(Xa),s=T.T,m=L.p;try{L.p=32>r?32:r,T.T=null,r=Wi,Wi=null;var w=xo,N=Xa;if(Kt=0,Ur=xo=null,Xa=0,(vt&6)!==0)throw Error(c(331));var H=vt;if(vt|=4,kf(w.current),bf(w,w.current,N,r),vt=H,$l(0,!1),Mt&&typeof Mt.onPostCommitFiberRoot=="function")try{Mt.onPostCommitFiberRoot(pn,w)}catch{}return!0}finally{L.p=m,T.T=s,Bf(e,n)}}function Gf(e,n,r){n=Gn(r,n),n=ki(e.stateNode,n,2),e=ho(e,n,2),e!==null&&(hn(e,2),ja(e))}function bt(e,n,r){if(e.tag===3)Gf(e,e,r);else for(;n!==null;){if(n.tag===3){Gf(n,e,r);break}else if(n.tag===1){var s=n.stateNode;if(typeof n.type.getDerivedStateFromError=="function"||typeof s.componentDidCatch=="function"&&(wo===null||!wo.has(s))){e=Gn(r,e),r=Gp(2),s=ho(n,r,2),s!==null&&(Wp(r,s,n,e),hn(s,2),ja(s));break}}n=n.return}}function Ki(e,n,r){var s=e.pingCache;if(s===null){s=e.pingCache=new n_;var m=new Set;s.set(n,m)}else m=s.get(n),m===void 0&&(m=new Set,s.set(n,m));m.has(r)||(Vi=!0,m.add(r),e=s_.bind(null,e,n,r),n.then(e,e))}function s_(e,n,r){var s=e.pingCache;s!==null&&s.delete(n),e.pingedLanes|=e.suspendedLanes&r,e.warmLanes&=~r,Tt===e&&(ut&r)===r&&(Ot===4||Ot===3&&(ut&62914560)===ut&&300>Ne()-zs?(vt&2)===0&&Or(e,0):Bi|=r,Pr===ut&&(Pr=0)),ja(e)}function Wf(e,n){n===0&&(n=ga()),e=Wo(e,n),e!==null&&(hn(e,n),ja(e))}function c_(e){var n=e.memoizedState,r=0;n!==null&&(r=n.retryLane),Wf(e,r)}function i_(e,n){var r=0;switch(e.tag){case 31:case 13:var s=e.stateNode,m=e.memoizedState;m!==null&&(r=m.retryLane);break;case 19:s=e.stateNode;break;case 22:s=e.stateNode._retryCache;break;default:throw Error(c(314))}s!==null&&s.delete(n),Wf(e,r)}function d_(e,n){return $e(e,n)}var Xs=null,Hr=null,Ji=!1,Zs=!1,ed=!1,So=0;function ja(e){e!==Hr&&e.next===null&&(Hr===null?Xs=Hr=e:Hr=Hr.next=e),Zs=!0,Ji||(Ji=!0,p_())}function $l(e,n){if(!ed&&Zs){ed=!0;do for(var r=!1,s=Xs;s!==null;){if(e!==0){var m=s.pendingLanes;if(m===0)var w=0;else{var N=s.suspendedLanes,H=s.pingedLanes;w=(1<<31-It(42|e)+1)-1,w&=m&~(N&~H),w=w&201326741?w&201326741|1:w?w|2:0}w!==0&&(r=!0,Kf(s,w))}else w=ut,w=Mn(s,s===Tt?w:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),(w&3)===0||jn(s,w)||(r=!0,Kf(s,w));s=s.next}while(r);ed=!1}}function u_(){Qf()}function Qf(){Zs=Ji=!1;var e=0;So!==0&&C_()&&(e=So);for(var n=Ne(),r=null,s=Xs;s!==null;){var m=s.next,w=Xf(s,n);w===0?(s.next=null,r===null?Xs=m:r.next=m,m===null&&(Hr=r)):(r=s,(e!==0||(w&3)!==0)&&(Zs=!0)),s=m}Kt!==0&&Kt!==5||$l(e),So!==0&&(So=0)}function Xf(e,n){for(var r=e.suspendedLanes,s=e.pingedLanes,m=e.expirationTimes,w=e.pendingLanes&-62914561;0<w;){var N=31-It(w),H=1<<N,te=m[N];te===-1?((H&r)===0||(H&s)!==0)&&(m[N]=Da(H,n)):te<=n&&(e.expiredLanes|=H),w&=~H}if(n=Tt,r=ut,r=Mn(e,e===n?r:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),s=e.callbackNode,r===0||e===n&&(St===2||St===9)||e.cancelPendingCommit!==null)return s!==null&&s!==null&&Ae(s),e.callbackNode=null,e.callbackPriority=0;if((r&3)===0||jn(e,r)){if(n=r&-r,n===e.callbackPriority)return n;switch(s!==null&&Ae(s),ca(r)){case 2:case 8:r=Ct;break;case 32:r=wt;break;case 268435456:r=En;break;default:r=wt}return s=Zf.bind(null,e),r=$e(r,s),e.callbackPriority=n,e.callbackNode=r,n}return s!==null&&s!==null&&Ae(s),e.callbackPriority=2,e.callbackNode=null,2}function Zf(e,n){if(Kt!==0&&Kt!==5)return e.callbackNode=null,e.callbackPriority=0,null;var r=e.callbackNode;if(Qs()&&e.callbackNode!==r)return null;var s=ut;return s=Mn(e,e===Tt?s:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),s===0?null:(Df(e,s,n),Xf(e,Ne()),e.callbackNode!=null&&e.callbackNode===r?Zf.bind(null,e):null)}function Kf(e,n){if(Qs())return null;Df(e,n,!0)}function p_(){b_(function(){(vt&6)!==0?$e(ct,u_):Qf()})}function td(){if(So===0){var e=kr;e===0&&(e=On,On<<=1,(On&261888)===0&&(On=256)),So=e}return So}function Jf(e){return e==null||typeof e=="symbol"||typeof e=="boolean"?null:typeof e=="function"?e:zo(""+e)}function eh(e,n){var r=n.ownerDocument.createElement("input");return r.name=n.name,r.value=n.value,e.id&&r.setAttribute("form",e.id),n.parentNode.insertBefore(r,n),e=new FormData(e),r.parentNode.removeChild(r),e}function f_(e,n,r,s,m){if(n==="submit"&&r&&r.stateNode===m){var w=Jf((m[qe]||null).action),N=s.submitter;N&&(n=(n=N[qe]||null)?Jf(n.formAction):N.getAttribute("formAction"),n!==null&&(w=n,N=null));var H=new is("action","action",null,s,m);e.push({event:H,listeners:[{instance:null,listener:function(){if(s.defaultPrevented){if(So!==0){var te=N?eh(m,N):new FormData(m);xi(r,{pending:!0,data:te,method:m.method,action:w},null,te)}}else typeof w=="function"&&(H.preventDefault(),te=N?eh(m,N):new FormData(m),xi(r,{pending:!0,data:te,method:m.method,action:w},w,te))},currentTarget:m}]})}}for(var nd=0;nd<Pc.length;nd++){var ad=Pc[nd],h_=ad.toLowerCase(),m_=ad[0].toUpperCase()+ad.slice(1);pa(h_,"on"+m_)}pa(Tu,"onAnimationEnd"),pa(Au,"onAnimationIteration"),pa(Du,"onAnimationStart"),pa("dblclick","onDoubleClick"),pa("focusin","onFocus"),pa("focusout","onBlur"),pa(Av,"onTransitionRun"),pa(Dv,"onTransitionStart"),pa(Fv,"onTransitionCancel"),pa(Fu,"onTransitionEnd"),Hn("onMouseEnter",["mouseout","mouseover"]),Hn("onMouseLeave",["mouseout","mouseover"]),Hn("onPointerEnter",["pointerout","pointerover"]),Hn("onPointerLeave",["pointerout","pointerover"]),kn("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),kn("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),kn("onBeforeInput",["compositionend","keypress","textInput","paste"]),kn("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),kn("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),kn("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Il="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),y_=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Il));function th(e,n){n=(n&4)!==0;for(var r=0;r<e.length;r++){var s=e[r],m=s.event;s=s.listeners;e:{var w=void 0;if(n)for(var N=s.length-1;0<=N;N--){var H=s[N],te=H.instance,ue=H.currentTarget;if(H=H.listener,te!==w&&m.isPropagationStopped())break e;w=H,m.currentTarget=ue;try{w(m)}catch(ve){ps(ve)}m.currentTarget=null,w=te}else for(N=0;N<s.length;N++){if(H=s[N],te=H.instance,ue=H.currentTarget,H=H.listener,te!==w&&m.isPropagationStopped())break e;w=H,m.currentTarget=ue;try{w(m)}catch(ve){ps(ve)}m.currentTarget=null,w=te}}}}function dt(e,n){var r=n[Oe];r===void 0&&(r=n[Oe]=new Set);var s=e+"__bubble";r.has(s)||(nh(n,e,2,!1),r.add(s))}function od(e,n,r){var s=0;n&&(s|=4),nh(r,e,s,n)}var Ks="_reactListening"+Math.random().toString(36).slice(2);function rd(e){if(!e[Ks]){e[Ks]=!0,to.forEach(function(r){r!=="selectionchange"&&(y_.has(r)||od(r,!1,e),od(r,!0,e))});var n=e.nodeType===9?e:e.ownerDocument;n===null||n[Ks]||(n[Ks]=!0,od("selectionchange",!1,n))}}function nh(e,n,r,s){switch(Ah(n)){case 2:var m=V_;break;case 8:m=B_;break;default:m=wd}r=m.bind(null,n,r,e),m=void 0,!rs||n!=="touchstart"&&n!=="touchmove"&&n!=="wheel"||(m=!0),s?m!==void 0?e.addEventListener(n,r,{capture:!0,passive:m}):e.addEventListener(n,r,!0):m!==void 0?e.addEventListener(n,r,{passive:m}):e.addEventListener(n,r,!1)}function ld(e,n,r,s,m){var w=s;if((n&1)===0&&(n&2)===0&&s!==null)e:for(;;){if(s===null)return;var N=s.tag;if(N===3||N===4){var H=s.stateNode.containerInfo;if(H===m)break;if(N===4)for(N=s.return;N!==null;){var te=N.tag;if((te===3||te===4)&&N.stateNode.containerInfo===m)return;N=N.return}for(;H!==null;){if(N=Pt(H),N===null)return;if(te=N.tag,te===5||te===6||te===26||te===27){s=w=N;continue e}H=H.parentNode}}s=s.return}os(function(){var ue=w,ve=gr(r),xe=[];e:{var pe=qu.get(e);if(pe!==void 0){var he=is,Me=e;switch(e){case"keypress":if(ss(r)===0)break e;case"keydown":case"keyup":he=iv;break;case"focusin":Me="focus",he=Nc;break;case"focusout":Me="blur",he=Nc;break;case"beforeblur":case"afterblur":he=Nc;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":he=iu;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":he=Zg;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":he=pv;break;case Tu:case Au:case Du:he=ev;break;case Fu:he=hv;break;case"scroll":case"scrollend":he=Qg;break;case"wheel":he=yv;break;case"copy":case"cut":case"paste":he=nv;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":he=uu;break;case"toggle":case"beforetoggle":he=vv}var Ge=(n&4)!==0,Nt=!Ge&&(e==="scroll"||e==="scrollend"),ce=Ge?pe!==null?pe+"Capture":null:pe;Ge=[];for(var re=ue,de;re!==null;){var we=re;if(de=we.stateNode,we=we.tag,we!==5&&we!==26&&we!==27||de===null||ce===null||(we=Ca(re,ce),we!=null&&Ge.push(Ll(re,we,de))),Nt)break;re=re.return}0<Ge.length&&(pe=new he(pe,Me,null,r,ve),xe.push({event:pe,listeners:Ge}))}}if((n&7)===0){e:{if(pe=e==="mouseover"||e==="pointerover",he=e==="mouseout"||e==="pointerout",pe&&r!==yr&&(Me=r.relatedTarget||r.fromElement)&&(Pt(Me)||Me[ze]))break e;if((he||pe)&&(pe=ve.window===ve?ve:(pe=ve.ownerDocument)?pe.defaultView||pe.parentWindow:window,he?(Me=r.relatedTarget||r.toElement,he=ue,Me=Me?Pt(Me):null,Me!==null&&(Nt=d(Me),Ge=Me.tag,Me!==Nt||Ge!==5&&Ge!==27&&Ge!==6)&&(Me=null)):(he=null,Me=ue),he!==Me)){if(Ge=iu,we="onMouseLeave",ce="onMouseEnter",re="mouse",(e==="pointerout"||e==="pointerover")&&(Ge=uu,we="onPointerLeave",ce="onPointerEnter",re="pointer"),Nt=he==null?pe:Xt(he),de=Me==null?pe:Xt(Me),pe=new Ge(we,re+"leave",he,r,ve),pe.target=Nt,pe.relatedTarget=de,we=null,Pt(ve)===ue&&(Ge=new Ge(ce,re+"enter",Me,r,ve),Ge.target=de,Ge.relatedTarget=Nt,we=Ge),Nt=we,he&&Me)t:{for(Ge=g_,ce=he,re=Me,de=0,we=ce;we;we=Ge(we))de++;we=0;for(var Be=re;Be;Be=Ge(Be))we++;for(;0<de-we;)ce=Ge(ce),de--;for(;0<we-de;)re=Ge(re),we--;for(;de--;){if(ce===re||re!==null&&ce===re.alternate){Ge=ce;break t}ce=Ge(ce),re=Ge(re)}Ge=null}else Ge=null;he!==null&&ah(xe,pe,he,Ge,!1),Me!==null&&Nt!==null&&ah(xe,Nt,Me,Ge,!0)}}e:{if(pe=ue?Xt(ue):window,he=pe.nodeName&&pe.nodeName.toLowerCase(),he==="select"||he==="input"&&pe.type==="file")var mt=_u;else if(gu(pe))if(wu)mt=Rv;else{mt=jv;var He=Ev}else he=pe.nodeName,!he||he.toLowerCase()!=="input"||pe.type!=="checkbox"&&pe.type!=="radio"?ue&&mr(ue.elementType)&&(mt=_u):mt=kv;if(mt&&(mt=mt(e,ue))){vu(xe,mt,r,ve);break e}He&&He(e,pe,ue),e==="focusout"&&ue&&pe.type==="number"&&ue.memoizedProps.value!=null&&oo(pe,"number",pe.value)}switch(He=ue?Xt(ue):window,e){case"focusin":(gu(He)||He.contentEditable==="true")&&(_r=He,$c=ue,pl=null);break;case"focusout":pl=$c=_r=null;break;case"mousedown":Ic=!0;break;case"contextmenu":case"mouseup":case"dragend":Ic=!1,Ru(xe,r,ve);break;case"selectionchange":if(Tv)break;case"keydown":case"keyup":Ru(xe,r,ve)}var tt;if(Ac)e:{switch(e){case"compositionstart":var pt="onCompositionStart";break e;case"compositionend":pt="onCompositionEnd";break e;case"compositionupdate":pt="onCompositionUpdate";break e}pt=void 0}else vr?mu(e,r)&&(pt="onCompositionEnd"):e==="keydown"&&r.keyCode===229&&(pt="onCompositionStart");pt&&(pu&&r.locale!=="ko"&&(vr||pt!=="onCompositionStart"?pt==="onCompositionEnd"&&vr&&(tt=su()):(lo=ve,jc="value"in lo?lo.value:lo.textContent,vr=!0)),He=Js(ue,pt),0<He.length&&(pt=new du(pt,e,null,r,ve),xe.push({event:pt,listeners:He}),tt?pt.data=tt:(tt=yu(r),tt!==null&&(pt.data=tt)))),(tt=wv?xv(e,r):Cv(e,r))&&(pt=Js(ue,"onBeforeInput"),0<pt.length&&(He=new du("onBeforeInput","beforeinput",null,r,ve),xe.push({event:He,listeners:pt}),He.data=tt)),f_(xe,e,ue,r,ve)}th(xe,n)})}function Ll(e,n,r){return{instance:e,listener:n,currentTarget:r}}function Js(e,n){for(var r=n+"Capture",s=[];e!==null;){var m=e,w=m.stateNode;if(m=m.tag,m!==5&&m!==26&&m!==27||w===null||(m=Ca(e,r),m!=null&&s.unshift(Ll(e,m,w)),m=Ca(e,n),m!=null&&s.push(Ll(e,m,w))),e.tag===3)return s;e=e.return}return[]}function g_(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5&&e.tag!==27);return e||null}function ah(e,n,r,s,m){for(var w=n._reactName,N=[];r!==null&&r!==s;){var H=r,te=H.alternate,ue=H.stateNode;if(H=H.tag,te!==null&&te===s)break;H!==5&&H!==26&&H!==27||ue===null||(te=ue,m?(ue=Ca(r,w),ue!=null&&N.unshift(Ll(r,ue,te))):m||(ue=Ca(r,w),ue!=null&&N.push(Ll(r,ue,te)))),r=r.return}N.length!==0&&e.push({event:n,listeners:N})}var v_=/\r\n?/g,__=/\u0000|\uFFFD/g;function oh(e){return(typeof e=="string"?e:""+e).replace(v_,`
`).replace(__,"")}function rh(e,n){return n=oh(n),oh(e)===n}function Rt(e,n,r,s,m,w){switch(r){case"children":typeof s=="string"?n==="body"||n==="textarea"&&s===""||yn(e,s):(typeof s=="number"||typeof s=="bigint")&&n!=="body"&&yn(e,""+s);break;case"className":qt(e,"class",s);break;case"tabIndex":qt(e,"tabindex",s);break;case"dir":case"role":case"viewBox":case"width":case"height":qt(e,r,s);break;case"style":qa(e,s,w);break;case"data":if(n!=="object"){qt(e,"data",s);break}case"src":case"href":if(s===""&&(n!=="a"||r!=="href")){e.removeAttribute(r);break}if(s==null||typeof s=="function"||typeof s=="symbol"||typeof s=="boolean"){e.removeAttribute(r);break}s=zo(""+s),e.setAttribute(r,s);break;case"action":case"formAction":if(typeof s=="function"){e.setAttribute(r,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof w=="function"&&(r==="formAction"?(n!=="input"&&Rt(e,n,"name",m.name,m,null),Rt(e,n,"formEncType",m.formEncType,m,null),Rt(e,n,"formMethod",m.formMethod,m,null),Rt(e,n,"formTarget",m.formTarget,m,null)):(Rt(e,n,"encType",m.encType,m,null),Rt(e,n,"method",m.method,m,null),Rt(e,n,"target",m.target,m,null)));if(s==null||typeof s=="symbol"||typeof s=="boolean"){e.removeAttribute(r);break}s=zo(""+s),e.setAttribute(r,s);break;case"onClick":s!=null&&(e.onclick=Vn);break;case"onScroll":s!=null&&dt("scroll",e);break;case"onScrollEnd":s!=null&&dt("scrollend",e);break;case"dangerouslySetInnerHTML":if(s!=null){if(typeof s!="object"||!("__html"in s))throw Error(c(61));if(r=s.__html,r!=null){if(m.children!=null)throw Error(c(60));e.innerHTML=r}}break;case"multiple":e.multiple=s&&typeof s!="function"&&typeof s!="symbol";break;case"muted":e.muted=s&&typeof s!="function"&&typeof s!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(s==null||typeof s=="function"||typeof s=="boolean"||typeof s=="symbol"){e.removeAttribute("xlink:href");break}r=zo(""+s),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",r);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":s!=null&&typeof s!="function"&&typeof s!="symbol"?e.setAttribute(r,""+s):e.removeAttribute(r);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":s&&typeof s!="function"&&typeof s!="symbol"?e.setAttribute(r,""):e.removeAttribute(r);break;case"capture":case"download":s===!0?e.setAttribute(r,""):s!==!1&&s!=null&&typeof s!="function"&&typeof s!="symbol"?e.setAttribute(r,s):e.removeAttribute(r);break;case"cols":case"rows":case"size":case"span":s!=null&&typeof s!="function"&&typeof s!="symbol"&&!isNaN(s)&&1<=s?e.setAttribute(r,s):e.removeAttribute(r);break;case"rowSpan":case"start":s==null||typeof s=="function"||typeof s=="symbol"||isNaN(s)?e.removeAttribute(r):e.setAttribute(r,s);break;case"popover":dt("beforetoggle",e),dt("toggle",e),at(e,"popover",s);break;case"xlinkActuate":Lt(e,"http://www.w3.org/1999/xlink","xlink:actuate",s);break;case"xlinkArcrole":Lt(e,"http://www.w3.org/1999/xlink","xlink:arcrole",s);break;case"xlinkRole":Lt(e,"http://www.w3.org/1999/xlink","xlink:role",s);break;case"xlinkShow":Lt(e,"http://www.w3.org/1999/xlink","xlink:show",s);break;case"xlinkTitle":Lt(e,"http://www.w3.org/1999/xlink","xlink:title",s);break;case"xlinkType":Lt(e,"http://www.w3.org/1999/xlink","xlink:type",s);break;case"xmlBase":Lt(e,"http://www.w3.org/XML/1998/namespace","xml:base",s);break;case"xmlLang":Lt(e,"http://www.w3.org/XML/1998/namespace","xml:lang",s);break;case"xmlSpace":Lt(e,"http://www.w3.org/XML/1998/namespace","xml:space",s);break;case"is":at(e,"is",s);break;case"innerText":case"textContent":break;default:(!(2<r.length)||r[0]!=="o"&&r[0]!=="O"||r[1]!=="n"&&r[1]!=="N")&&(r=ns.get(r)||r,at(e,r,s))}}function sd(e,n,r,s,m,w){switch(r){case"style":qa(e,s,w);break;case"dangerouslySetInnerHTML":if(s!=null){if(typeof s!="object"||!("__html"in s))throw Error(c(61));if(r=s.__html,r!=null){if(m.children!=null)throw Error(c(60));e.innerHTML=r}}break;case"children":typeof s=="string"?yn(e,s):(typeof s=="number"||typeof s=="bigint")&&yn(e,""+s);break;case"onScroll":s!=null&&dt("scroll",e);break;case"onScrollEnd":s!=null&&dt("scrollend",e);break;case"onClick":s!=null&&(e.onclick=Vn);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!no.hasOwnProperty(r))e:{if(r[0]==="o"&&r[1]==="n"&&(m=r.endsWith("Capture"),n=r.slice(2,m?r.length-7:void 0),w=e[qe]||null,w=w!=null?w[r]:null,typeof w=="function"&&e.removeEventListener(n,w,m),typeof s=="function")){typeof w!="function"&&w!==null&&(r in e?e[r]=null:e.hasAttribute(r)&&e.removeAttribute(r)),e.addEventListener(n,s,m);break e}r in e?e[r]=s:s===!0?e.setAttribute(r,""):at(e,r,s)}}}function rn(e,n,r){switch(n){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":dt("error",e),dt("load",e);var s=!1,m=!1,w;for(w in r)if(r.hasOwnProperty(w)){var N=r[w];if(N!=null)switch(w){case"src":s=!0;break;case"srcSet":m=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(c(137,n));default:Rt(e,n,w,N,r,null)}}m&&Rt(e,n,"srcSet",r.srcSet,r,null),s&&Rt(e,n,"src",r.src,r,null);return;case"input":dt("invalid",e);var H=w=N=m=null,te=null,ue=null;for(s in r)if(r.hasOwnProperty(s)){var ve=r[s];if(ve!=null)switch(s){case"name":m=ve;break;case"type":N=ve;break;case"checked":te=ve;break;case"defaultChecked":ue=ve;break;case"value":w=ve;break;case"defaultValue":H=ve;break;case"children":case"dangerouslySetInnerHTML":if(ve!=null)throw Error(c(137,n));break;default:Rt(e,n,s,ve,r,null)}}Oo(e,w,H,te,ue,N,m,!1);return;case"select":dt("invalid",e),s=N=w=null;for(m in r)if(r.hasOwnProperty(m)&&(H=r[m],H!=null))switch(m){case"value":w=H;break;case"defaultValue":N=H;break;case"multiple":s=H;default:Rt(e,n,m,H,r,null)}n=w,r=N,e.multiple=!!s,n!=null?ua(e,!!s,n,!1):r!=null&&ua(e,!!s,r,!0);return;case"textarea":dt("invalid",e),w=m=s=null;for(N in r)if(r.hasOwnProperty(N)&&(H=r[N],H!=null))switch(N){case"value":s=H;break;case"defaultValue":m=H;break;case"children":w=H;break;case"dangerouslySetInnerHTML":if(H!=null)throw Error(c(91));break;default:Rt(e,n,N,H,r,null)}Ho(e,s,m,w);return;case"option":for(te in r)if(r.hasOwnProperty(te)&&(s=r[te],s!=null))switch(te){case"selected":e.selected=s&&typeof s!="function"&&typeof s!="symbol";break;default:Rt(e,n,te,s,r,null)}return;case"dialog":dt("beforetoggle",e),dt("toggle",e),dt("cancel",e),dt("close",e);break;case"iframe":case"object":dt("load",e);break;case"video":case"audio":for(s=0;s<Il.length;s++)dt(Il[s],e);break;case"image":dt("error",e),dt("load",e);break;case"details":dt("toggle",e);break;case"embed":case"source":case"link":dt("error",e),dt("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(ue in r)if(r.hasOwnProperty(ue)&&(s=r[ue],s!=null))switch(ue){case"children":case"dangerouslySetInnerHTML":throw Error(c(137,n));default:Rt(e,n,ue,s,r,null)}return;default:if(mr(n)){for(ve in r)r.hasOwnProperty(ve)&&(s=r[ve],s!==void 0&&sd(e,n,ve,s,r,void 0));return}}for(H in r)r.hasOwnProperty(H)&&(s=r[H],s!=null&&Rt(e,n,H,s,r,null))}function w_(e,n,r,s){switch(n){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var m=null,w=null,N=null,H=null,te=null,ue=null,ve=null;for(he in r){var xe=r[he];if(r.hasOwnProperty(he)&&xe!=null)switch(he){case"checked":break;case"value":break;case"defaultValue":te=xe;default:s.hasOwnProperty(he)||Rt(e,n,he,null,s,xe)}}for(var pe in s){var he=s[pe];if(xe=r[pe],s.hasOwnProperty(pe)&&(he!=null||xe!=null))switch(pe){case"type":w=he;break;case"name":m=he;break;case"checked":ue=he;break;case"defaultChecked":ve=he;break;case"value":N=he;break;case"defaultValue":H=he;break;case"children":case"dangerouslySetInnerHTML":if(he!=null)throw Error(c(137,n));break;default:he!==xe&&Rt(e,n,pe,he,s,xe)}}ao(e,N,H,te,ue,ve,w,m);return;case"select":he=N=H=pe=null;for(w in r)if(te=r[w],r.hasOwnProperty(w)&&te!=null)switch(w){case"value":break;case"multiple":he=te;default:s.hasOwnProperty(w)||Rt(e,n,w,null,s,te)}for(m in s)if(w=s[m],te=r[m],s.hasOwnProperty(m)&&(w!=null||te!=null))switch(m){case"value":pe=w;break;case"defaultValue":H=w;break;case"multiple":N=w;default:w!==te&&Rt(e,n,m,w,s,te)}n=H,r=N,s=he,pe!=null?ua(e,!!r,pe,!1):!!s!=!!r&&(n!=null?ua(e,!!r,n,!0):ua(e,!!r,r?[]:"",!1));return;case"textarea":he=pe=null;for(H in r)if(m=r[H],r.hasOwnProperty(H)&&m!=null&&!s.hasOwnProperty(H))switch(H){case"value":break;case"children":break;default:Rt(e,n,H,null,s,m)}for(N in s)if(m=s[N],w=r[N],s.hasOwnProperty(N)&&(m!=null||w!=null))switch(N){case"value":pe=m;break;case"defaultValue":he=m;break;case"children":break;case"dangerouslySetInnerHTML":if(m!=null)throw Error(c(91));break;default:m!==w&&Rt(e,n,N,m,s,w)}Mo(e,pe,he);return;case"option":for(var Me in r)if(pe=r[Me],r.hasOwnProperty(Me)&&pe!=null&&!s.hasOwnProperty(Me))switch(Me){case"selected":e.selected=!1;break;default:Rt(e,n,Me,null,s,pe)}for(te in s)if(pe=s[te],he=r[te],s.hasOwnProperty(te)&&pe!==he&&(pe!=null||he!=null))switch(te){case"selected":e.selected=pe&&typeof pe!="function"&&typeof pe!="symbol";break;default:Rt(e,n,te,pe,s,he)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Ge in r)pe=r[Ge],r.hasOwnProperty(Ge)&&pe!=null&&!s.hasOwnProperty(Ge)&&Rt(e,n,Ge,null,s,pe);for(ue in s)if(pe=s[ue],he=r[ue],s.hasOwnProperty(ue)&&pe!==he&&(pe!=null||he!=null))switch(ue){case"children":case"dangerouslySetInnerHTML":if(pe!=null)throw Error(c(137,n));break;default:Rt(e,n,ue,pe,s,he)}return;default:if(mr(n)){for(var Nt in r)pe=r[Nt],r.hasOwnProperty(Nt)&&pe!==void 0&&!s.hasOwnProperty(Nt)&&sd(e,n,Nt,void 0,s,pe);for(ve in s)pe=s[ve],he=r[ve],!s.hasOwnProperty(ve)||pe===he||pe===void 0&&he===void 0||sd(e,n,ve,pe,s,he);return}}for(var ce in r)pe=r[ce],r.hasOwnProperty(ce)&&pe!=null&&!s.hasOwnProperty(ce)&&Rt(e,n,ce,null,s,pe);for(xe in s)pe=s[xe],he=r[xe],!s.hasOwnProperty(xe)||pe===he||pe==null&&he==null||Rt(e,n,xe,pe,s,he)}function lh(e){switch(e){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function x_(){if(typeof performance.getEntriesByType=="function"){for(var e=0,n=0,r=performance.getEntriesByType("resource"),s=0;s<r.length;s++){var m=r[s],w=m.transferSize,N=m.initiatorType,H=m.duration;if(w&&H&&lh(N)){for(N=0,H=m.responseEnd,s+=1;s<r.length;s++){var te=r[s],ue=te.startTime;if(ue>H)break;var ve=te.transferSize,xe=te.initiatorType;ve&&lh(xe)&&(te=te.responseEnd,N+=ve*(te<H?1:(H-ue)/(te-ue)))}if(--s,n+=8*(w+N)/(m.duration/1e3),e++,10<e)break}}if(0<e)return n/e/1e6}return navigator.connection&&(e=navigator.connection.downlink,typeof e=="number")?e:5}var cd=null,id=null;function ec(e){return e.nodeType===9?e:e.ownerDocument}function sh(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function ch(e,n){if(e===0)switch(n){case"svg":return 1;case"math":return 2;default:return 0}return e===1&&n==="foreignObject"?0:e}function dd(e,n){return e==="textarea"||e==="noscript"||typeof n.children=="string"||typeof n.children=="number"||typeof n.children=="bigint"||typeof n.dangerouslySetInnerHTML=="object"&&n.dangerouslySetInnerHTML!==null&&n.dangerouslySetInnerHTML.__html!=null}var ud=null;function C_(){var e=window.event;return e&&e.type==="popstate"?e===ud?!1:(ud=e,!0):(ud=null,!1)}var ih=typeof setTimeout=="function"?setTimeout:void 0,S_=typeof clearTimeout=="function"?clearTimeout:void 0,dh=typeof Promise=="function"?Promise:void 0,b_=typeof queueMicrotask=="function"?queueMicrotask:typeof dh<"u"?function(e){return dh.resolve(null).then(e).catch(E_)}:ih;function E_(e){setTimeout(function(){throw e})}function bo(e){return e==="head"}function uh(e,n){var r=n,s=0;do{var m=r.nextSibling;if(e.removeChild(r),m&&m.nodeType===8)if(r=m.data,r==="/$"||r==="/&"){if(s===0){e.removeChild(m),Yr(n);return}s--}else if(r==="$"||r==="$?"||r==="$~"||r==="$!"||r==="&")s++;else if(r==="html")Pl(e.ownerDocument.documentElement);else if(r==="head"){r=e.ownerDocument.head,Pl(r);for(var w=r.firstChild;w;){var N=w.nextSibling,H=w.nodeName;w[Ve]||H==="SCRIPT"||H==="STYLE"||H==="LINK"&&w.rel.toLowerCase()==="stylesheet"||r.removeChild(w),w=N}}else r==="body"&&Pl(e.ownerDocument.body);r=m}while(r);Yr(n)}function ph(e,n){var r=e;e=0;do{var s=r.nextSibling;if(r.nodeType===1?n?(r._stashedDisplay=r.style.display,r.style.display="none"):(r.style.display=r._stashedDisplay||"",r.getAttribute("style")===""&&r.removeAttribute("style")):r.nodeType===3&&(n?(r._stashedText=r.nodeValue,r.nodeValue=""):r.nodeValue=r._stashedText||""),s&&s.nodeType===8)if(r=s.data,r==="/$"){if(e===0)break;e--}else r!=="$"&&r!=="$?"&&r!=="$~"&&r!=="$!"||e++;r=s}while(r)}function pd(e){var n=e.firstChild;for(n&&n.nodeType===10&&(n=n.nextSibling);n;){var r=n;switch(n=n.nextSibling,r.nodeName){case"HTML":case"HEAD":case"BODY":pd(r),lt(r);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(r.rel.toLowerCase()==="stylesheet")continue}e.removeChild(r)}}function j_(e,n,r,s){for(;e.nodeType===1;){var m=r;if(e.nodeName.toLowerCase()!==n.toLowerCase()){if(!s&&(e.nodeName!=="INPUT"||e.type!=="hidden"))break}else if(s){if(!e[Ve])switch(n){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if(w=e.getAttribute("rel"),w==="stylesheet"&&e.hasAttribute("data-precedence"))break;if(w!==m.rel||e.getAttribute("href")!==(m.href==null||m.href===""?null:m.href)||e.getAttribute("crossorigin")!==(m.crossOrigin==null?null:m.crossOrigin)||e.getAttribute("title")!==(m.title==null?null:m.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(w=e.getAttribute("src"),(w!==(m.src==null?null:m.src)||e.getAttribute("type")!==(m.type==null?null:m.type)||e.getAttribute("crossorigin")!==(m.crossOrigin==null?null:m.crossOrigin))&&w&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else if(n==="input"&&e.type==="hidden"){var w=m.name==null?null:""+m.name;if(m.type==="hidden"&&e.getAttribute("name")===w)return e}else return e;if(e=Kn(e.nextSibling),e===null)break}return null}function k_(e,n,r){if(n==="")return null;for(;e.nodeType!==3;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!r||(e=Kn(e.nextSibling),e===null))return null;return e}function fh(e,n){for(;e.nodeType!==8;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!n||(e=Kn(e.nextSibling),e===null))return null;return e}function fd(e){return e.data==="$?"||e.data==="$~"}function hd(e){return e.data==="$!"||e.data==="$?"&&e.ownerDocument.readyState!=="loading"}function R_(e,n){var r=e.ownerDocument;if(e.data==="$~")e._reactRetry=n;else if(e.data!=="$?"||r.readyState!=="loading")n();else{var s=function(){n(),r.removeEventListener("DOMContentLoaded",s)};r.addEventListener("DOMContentLoaded",s),e._reactRetry=s}}function Kn(e){for(;e!=null;e=e.nextSibling){var n=e.nodeType;if(n===1||n===3)break;if(n===8){if(n=e.data,n==="$"||n==="$!"||n==="$?"||n==="$~"||n==="&"||n==="F!"||n==="F")break;if(n==="/$"||n==="/&")return null}}return e}var md=null;function hh(e){e=e.nextSibling;for(var n=0;e;){if(e.nodeType===8){var r=e.data;if(r==="/$"||r==="/&"){if(n===0)return Kn(e.nextSibling);n--}else r!=="$"&&r!=="$!"&&r!=="$?"&&r!=="$~"&&r!=="&"||n++}e=e.nextSibling}return null}function mh(e){e=e.previousSibling;for(var n=0;e;){if(e.nodeType===8){var r=e.data;if(r==="$"||r==="$!"||r==="$?"||r==="$~"||r==="&"){if(n===0)return e;n--}else r!=="/$"&&r!=="/&"||n++}e=e.previousSibling}return null}function yh(e,n,r){switch(n=ec(r),e){case"html":if(e=n.documentElement,!e)throw Error(c(452));return e;case"head":if(e=n.head,!e)throw Error(c(453));return e;case"body":if(e=n.body,!e)throw Error(c(454));return e;default:throw Error(c(451))}}function Pl(e){for(var n=e.attributes;n.length;)e.removeAttributeNode(n[0]);lt(e)}var Jn=new Map,gh=new Set;function tc(e){return typeof e.getRootNode=="function"?e.getRootNode():e.nodeType===9?e:e.ownerDocument}var Za=L.d;L.d={f:N_,r:T_,D:A_,C:D_,L:F_,m:q_,X:I_,S:$_,M:L_};function N_(){var e=Za.f(),n=Ys();return e||n}function T_(e){var n=mn(e);n!==null&&n.tag===5&&n.type==="form"?Fp(n):Za.r(e)}var zr=typeof document>"u"?null:document;function vh(e,n,r){var s=zr;if(s&&typeof n=="string"&&n){var m=jt(n);m='link[rel="'+e+'"][href="'+m+'"]',typeof r=="string"&&(m+='[crossorigin="'+r+'"]'),gh.has(m)||(gh.add(m),e={rel:e,crossOrigin:r,href:n},s.querySelector(m)===null&&(n=s.createElement("link"),rn(n,"link",e),Ft(n),s.head.appendChild(n)))}}function A_(e){Za.D(e),vh("dns-prefetch",e,null)}function D_(e,n){Za.C(e,n),vh("preconnect",e,n)}function F_(e,n,r){Za.L(e,n,r);var s=zr;if(s&&e&&n){var m='link[rel="preload"][as="'+jt(n)+'"]';n==="image"&&r&&r.imageSrcSet?(m+='[imagesrcset="'+jt(r.imageSrcSet)+'"]',typeof r.imageSizes=="string"&&(m+='[imagesizes="'+jt(r.imageSizes)+'"]')):m+='[href="'+jt(e)+'"]';var w=m;switch(n){case"style":w=Vr(e);break;case"script":w=Br(e)}Jn.has(w)||(e=g({rel:"preload",href:n==="image"&&r&&r.imageSrcSet?void 0:e,as:n},r),Jn.set(w,e),s.querySelector(m)!==null||n==="style"&&s.querySelector(Ul(w))||n==="script"&&s.querySelector(Ol(w))||(n=s.createElement("link"),rn(n,"link",e),Ft(n),s.head.appendChild(n)))}}function q_(e,n){Za.m(e,n);var r=zr;if(r&&e){var s=n&&typeof n.as=="string"?n.as:"script",m='link[rel="modulepreload"][as="'+jt(s)+'"][href="'+jt(e)+'"]',w=m;switch(s){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":w=Br(e)}if(!Jn.has(w)&&(e=g({rel:"modulepreload",href:e},n),Jn.set(w,e),r.querySelector(m)===null)){switch(s){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(r.querySelector(Ol(w)))return}s=r.createElement("link"),rn(s,"link",e),Ft(s),r.head.appendChild(s)}}}function $_(e,n,r){Za.S(e,n,r);var s=zr;if(s&&e){var m=Et(s).hoistableStyles,w=Vr(e);n=n||"default";var N=m.get(w);if(!N){var H={loading:0,preload:null};if(N=s.querySelector(Ul(w)))H.loading=5;else{e=g({rel:"stylesheet",href:e,"data-precedence":n},r),(r=Jn.get(w))&&yd(e,r);var te=N=s.createElement("link");Ft(te),rn(te,"link",e),te._p=new Promise(function(ue,ve){te.onload=ue,te.onerror=ve}),te.addEventListener("load",function(){H.loading|=1}),te.addEventListener("error",function(){H.loading|=2}),H.loading|=4,nc(N,n,s)}N={type:"stylesheet",instance:N,count:1,state:H},m.set(w,N)}}}function I_(e,n){Za.X(e,n);var r=zr;if(r&&e){var s=Et(r).hoistableScripts,m=Br(e),w=s.get(m);w||(w=r.querySelector(Ol(m)),w||(e=g({src:e,async:!0},n),(n=Jn.get(m))&&gd(e,n),w=r.createElement("script"),Ft(w),rn(w,"link",e),r.head.appendChild(w)),w={type:"script",instance:w,count:1,state:null},s.set(m,w))}}function L_(e,n){Za.M(e,n);var r=zr;if(r&&e){var s=Et(r).hoistableScripts,m=Br(e),w=s.get(m);w||(w=r.querySelector(Ol(m)),w||(e=g({src:e,async:!0,type:"module"},n),(n=Jn.get(m))&&gd(e,n),w=r.createElement("script"),Ft(w),rn(w,"link",e),r.head.appendChild(w)),w={type:"script",instance:w,count:1,state:null},s.set(m,w))}}function _h(e,n,r,s){var m=(m=J.current)?tc(m):null;if(!m)throw Error(c(446));switch(e){case"meta":case"title":return null;case"style":return typeof r.precedence=="string"&&typeof r.href=="string"?(n=Vr(r.href),r=Et(m).hoistableStyles,s=r.get(n),s||(s={type:"style",instance:null,count:0,state:null},r.set(n,s)),s):{type:"void",instance:null,count:0,state:null};case"link":if(r.rel==="stylesheet"&&typeof r.href=="string"&&typeof r.precedence=="string"){e=Vr(r.href);var w=Et(m).hoistableStyles,N=w.get(e);if(N||(m=m.ownerDocument||m,N={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},w.set(e,N),(w=m.querySelector(Ul(e)))&&!w._p&&(N.instance=w,N.state.loading=5),Jn.has(e)||(r={rel:"preload",as:"style",href:r.href,crossOrigin:r.crossOrigin,integrity:r.integrity,media:r.media,hrefLang:r.hrefLang,referrerPolicy:r.referrerPolicy},Jn.set(e,r),w||P_(m,e,r,N.state))),n&&s===null)throw Error(c(528,""));return N}if(n&&s!==null)throw Error(c(529,""));return null;case"script":return n=r.async,r=r.src,typeof r=="string"&&n&&typeof n!="function"&&typeof n!="symbol"?(n=Br(r),r=Et(m).hoistableScripts,s=r.get(n),s||(s={type:"script",instance:null,count:0,state:null},r.set(n,s)),s):{type:"void",instance:null,count:0,state:null};default:throw Error(c(444,e))}}function Vr(e){return'href="'+jt(e)+'"'}function Ul(e){return'link[rel="stylesheet"]['+e+"]"}function wh(e){return g({},e,{"data-precedence":e.precedence,precedence:null})}function P_(e,n,r,s){e.querySelector('link[rel="preload"][as="style"]['+n+"]")?s.loading=1:(n=e.createElement("link"),s.preload=n,n.addEventListener("load",function(){return s.loading|=1}),n.addEventListener("error",function(){return s.loading|=2}),rn(n,"link",r),Ft(n),e.head.appendChild(n))}function Br(e){return'[src="'+jt(e)+'"]'}function Ol(e){return"script[async]"+e}function xh(e,n,r){if(n.count++,n.instance===null)switch(n.type){case"style":var s=e.querySelector('style[data-href~="'+jt(r.href)+'"]');if(s)return n.instance=s,Ft(s),s;var m=g({},r,{"data-href":r.href,"data-precedence":r.precedence,href:null,precedence:null});return s=(e.ownerDocument||e).createElement("style"),Ft(s),rn(s,"style",m),nc(s,r.precedence,e),n.instance=s;case"stylesheet":m=Vr(r.href);var w=e.querySelector(Ul(m));if(w)return n.state.loading|=4,n.instance=w,Ft(w),w;s=wh(r),(m=Jn.get(m))&&yd(s,m),w=(e.ownerDocument||e).createElement("link"),Ft(w);var N=w;return N._p=new Promise(function(H,te){N.onload=H,N.onerror=te}),rn(w,"link",s),n.state.loading|=4,nc(w,r.precedence,e),n.instance=w;case"script":return w=Br(r.src),(m=e.querySelector(Ol(w)))?(n.instance=m,Ft(m),m):(s=r,(m=Jn.get(w))&&(s=g({},r),gd(s,m)),e=e.ownerDocument||e,m=e.createElement("script"),Ft(m),rn(m,"link",s),e.head.appendChild(m),n.instance=m);case"void":return null;default:throw Error(c(443,n.type))}else n.type==="stylesheet"&&(n.state.loading&4)===0&&(s=n.instance,n.state.loading|=4,nc(s,r.precedence,e));return n.instance}function nc(e,n,r){for(var s=r.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),m=s.length?s[s.length-1]:null,w=m,N=0;N<s.length;N++){var H=s[N];if(H.dataset.precedence===n)w=H;else if(w!==m)break}w?w.parentNode.insertBefore(e,w.nextSibling):(n=r.nodeType===9?r.head:r,n.insertBefore(e,n.firstChild))}function yd(e,n){e.crossOrigin==null&&(e.crossOrigin=n.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=n.referrerPolicy),e.title==null&&(e.title=n.title)}function gd(e,n){e.crossOrigin==null&&(e.crossOrigin=n.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=n.referrerPolicy),e.integrity==null&&(e.integrity=n.integrity)}var ac=null;function Ch(e,n,r){if(ac===null){var s=new Map,m=ac=new Map;m.set(r,s)}else m=ac,s=m.get(r),s||(s=new Map,m.set(r,s));if(s.has(e))return s;for(s.set(e,null),r=r.getElementsByTagName(e),m=0;m<r.length;m++){var w=r[m];if(!(w[Ve]||w[je]||e==="link"&&w.getAttribute("rel")==="stylesheet")&&w.namespaceURI!=="http://www.w3.org/2000/svg"){var N=w.getAttribute(n)||"";N=e+N;var H=s.get(N);H?H.push(w):s.set(N,[w])}}return s}function Sh(e,n,r){e=e.ownerDocument||e,e.head.insertBefore(r,n==="title"?e.querySelector("head > title"):null)}function U_(e,n,r){if(r===1||n.itemProp!=null)return!1;switch(e){case"meta":case"title":return!0;case"style":if(typeof n.precedence!="string"||typeof n.href!="string"||n.href==="")break;return!0;case"link":if(typeof n.rel!="string"||typeof n.href!="string"||n.href===""||n.onLoad||n.onError)break;switch(n.rel){case"stylesheet":return e=n.disabled,typeof n.precedence=="string"&&e==null;default:return!0}case"script":if(n.async&&typeof n.async!="function"&&typeof n.async!="symbol"&&!n.onLoad&&!n.onError&&n.src&&typeof n.src=="string")return!0}return!1}function bh(e){return!(e.type==="stylesheet"&&(e.state.loading&3)===0)}function O_(e,n,r,s){if(r.type==="stylesheet"&&(typeof s.media!="string"||matchMedia(s.media).matches!==!1)&&(r.state.loading&4)===0){if(r.instance===null){var m=Vr(s.href),w=n.querySelector(Ul(m));if(w){n=w._p,n!==null&&typeof n=="object"&&typeof n.then=="function"&&(e.count++,e=oc.bind(e),n.then(e,e)),r.state.loading|=4,r.instance=w,Ft(w);return}w=n.ownerDocument||n,s=wh(s),(m=Jn.get(m))&&yd(s,m),w=w.createElement("link"),Ft(w);var N=w;N._p=new Promise(function(H,te){N.onload=H,N.onerror=te}),rn(w,"link",s),r.instance=w}e.stylesheets===null&&(e.stylesheets=new Map),e.stylesheets.set(r,n),(n=r.state.preload)&&(r.state.loading&3)===0&&(e.count++,r=oc.bind(e),n.addEventListener("load",r),n.addEventListener("error",r))}}var vd=0;function M_(e,n){return e.stylesheets&&e.count===0&&lc(e,e.stylesheets),0<e.count||0<e.imgCount?function(r){var s=setTimeout(function(){if(e.stylesheets&&lc(e,e.stylesheets),e.unsuspend){var w=e.unsuspend;e.unsuspend=null,w()}},6e4+n);0<e.imgBytes&&vd===0&&(vd=62500*x_());var m=setTimeout(function(){if(e.waitingForImages=!1,e.count===0&&(e.stylesheets&&lc(e,e.stylesheets),e.unsuspend)){var w=e.unsuspend;e.unsuspend=null,w()}},(e.imgBytes>vd?50:800)+n);return e.unsuspend=r,function(){e.unsuspend=null,clearTimeout(s),clearTimeout(m)}}:null}function oc(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)lc(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}}var rc=null;function lc(e,n){e.stylesheets=null,e.unsuspend!==null&&(e.count++,rc=new Map,n.forEach(H_,e),rc=null,oc.call(e))}function H_(e,n){if(!(n.state.loading&4)){var r=rc.get(e);if(r)var s=r.get(null);else{r=new Map,rc.set(e,r);for(var m=e.querySelectorAll("link[data-precedence],style[data-precedence]"),w=0;w<m.length;w++){var N=m[w];(N.nodeName==="LINK"||N.getAttribute("media")!=="not all")&&(r.set(N.dataset.precedence,N),s=N)}s&&r.set(null,s)}m=n.instance,N=m.getAttribute("data-precedence"),w=r.get(N)||s,w===s&&r.set(null,m),r.set(N,m),this.count++,s=oc.bind(this),m.addEventListener("load",s),m.addEventListener("error",s),w?w.parentNode.insertBefore(m,w.nextSibling):(e=e.nodeType===9?e.head:e,e.insertBefore(m,e.firstChild)),n.state.loading|=4}}var Ml={$$typeof:R,Provider:null,Consumer:null,_currentValue:B,_currentValue2:B,_threadCount:0};function z_(e,n,r,s,m,w,N,H,te){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=ra(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ra(0),this.hiddenUpdates=ra(null),this.identifierPrefix=s,this.onUncaughtError=m,this.onCaughtError=w,this.onRecoverableError=N,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=te,this.incompleteTransitions=new Map}function Eh(e,n,r,s,m,w,N,H,te,ue,ve,xe){return e=new z_(e,n,r,N,te,ue,ve,xe,H),n=1,w===!0&&(n|=24),w=Tn(3,null,null,n),e.current=w,w.stateNode=e,n=Zc(),n.refCount++,e.pooledCache=n,n.refCount++,w.memoizedState={element:s,isDehydrated:r,cache:n},ti(w),e}function jh(e){return e?(e=Cr,e):Cr}function kh(e,n,r,s,m,w){m=jh(m),s.context===null?s.context=m:s.pendingContext=m,s=fo(n),s.payload={element:r},w=w===void 0?null:w,w!==null&&(s.callback=w),r=ho(e,s,n),r!==null&&(Cn(r,e,n),_l(r,e,n))}function Rh(e,n){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var r=e.retryLane;e.retryLane=r!==0&&r<n?r:n}}function _d(e,n){Rh(e,n),(e=e.alternate)&&Rh(e,n)}function Nh(e){if(e.tag===13||e.tag===31){var n=Wo(e,67108864);n!==null&&Cn(n,e,67108864),_d(e,67108864)}}function Th(e){if(e.tag===13||e.tag===31){var n=$n();n=sa(n);var r=Wo(e,n);r!==null&&Cn(r,e,n),_d(e,n)}}var sc=!0;function V_(e,n,r,s){var m=T.T;T.T=null;var w=L.p;try{L.p=2,wd(e,n,r,s)}finally{L.p=w,T.T=m}}function B_(e,n,r,s){var m=T.T;T.T=null;var w=L.p;try{L.p=8,wd(e,n,r,s)}finally{L.p=w,T.T=m}}function wd(e,n,r,s){if(sc){var m=xd(s);if(m===null)ld(e,n,s,cc,r),Dh(e,s);else if(G_(m,e,n,r,s))s.stopPropagation();else if(Dh(e,s),n&4&&-1<Y_.indexOf(e)){for(;m!==null;){var w=mn(m);if(w!==null)switch(w.tag){case 3:if(w=w.stateNode,w.current.memoizedState.isDehydrated){var N=Qt(w.pendingLanes);if(N!==0){var H=w;for(H.pendingLanes|=2,H.entangledLanes|=2;N;){var te=1<<31-It(N);H.entanglements[1]|=te,N&=~te}ja(w),(vt&6)===0&&(Vs=Ne()+500,$l(0))}}break;case 31:case 13:H=Wo(w,2),H!==null&&Cn(H,w,2),Ys(),_d(w,2)}if(w=xd(s),w===null&&ld(e,n,s,cc,r),w===m)break;m=w}m!==null&&s.stopPropagation()}else ld(e,n,s,null,r)}}function xd(e){return e=gr(e),Cd(e)}var cc=null;function Cd(e){if(cc=null,e=Pt(e),e!==null){var n=d(e);if(n===null)e=null;else{var r=n.tag;if(r===13){if(e=f(n),e!==null)return e;e=null}else if(r===31){if(e=p(n),e!==null)return e;e=null}else if(r===3){if(n.stateNode.current.memoizedState.isDehydrated)return n.tag===3?n.stateNode.containerInfo:null;e=null}else n!==e&&(e=null)}}return cc=e,null}function Ah(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(ht()){case ct:return 2;case Ct:return 8;case wt:case na:return 32;case En:return 268435456;default:return 32}default:return 32}}var Sd=!1,Eo=null,jo=null,ko=null,Hl=new Map,zl=new Map,Ro=[],Y_="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Dh(e,n){switch(e){case"focusin":case"focusout":Eo=null;break;case"dragenter":case"dragleave":jo=null;break;case"mouseover":case"mouseout":ko=null;break;case"pointerover":case"pointerout":Hl.delete(n.pointerId);break;case"gotpointercapture":case"lostpointercapture":zl.delete(n.pointerId)}}function Vl(e,n,r,s,m,w){return e===null||e.nativeEvent!==w?(e={blockedOn:n,domEventName:r,eventSystemFlags:s,nativeEvent:w,targetContainers:[m]},n!==null&&(n=mn(n),n!==null&&Nh(n)),e):(e.eventSystemFlags|=s,n=e.targetContainers,m!==null&&n.indexOf(m)===-1&&n.push(m),e)}function G_(e,n,r,s,m){switch(n){case"focusin":return Eo=Vl(Eo,e,n,r,s,m),!0;case"dragenter":return jo=Vl(jo,e,n,r,s,m),!0;case"mouseover":return ko=Vl(ko,e,n,r,s,m),!0;case"pointerover":var w=m.pointerId;return Hl.set(w,Vl(Hl.get(w)||null,e,n,r,s,m)),!0;case"gotpointercapture":return w=m.pointerId,zl.set(w,Vl(zl.get(w)||null,e,n,r,s,m)),!0}return!1}function Fh(e){var n=Pt(e.target);if(n!==null){var r=d(n);if(r!==null){if(n=r.tag,n===13){if(n=f(r),n!==null){e.blockedOn=n,xa(e.priority,function(){Th(r)});return}}else if(n===31){if(n=p(r),n!==null){e.blockedOn=n,xa(e.priority,function(){Th(r)});return}}else if(n===3&&r.stateNode.current.memoizedState.isDehydrated){e.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}e.blockedOn=null}function ic(e){if(e.blockedOn!==null)return!1;for(var n=e.targetContainers;0<n.length;){var r=xd(e.nativeEvent);if(r===null){r=e.nativeEvent;var s=new r.constructor(r.type,r);yr=s,r.target.dispatchEvent(s),yr=null}else return n=mn(r),n!==null&&Nh(n),e.blockedOn=r,!1;n.shift()}return!0}function qh(e,n,r){ic(e)&&r.delete(n)}function W_(){Sd=!1,Eo!==null&&ic(Eo)&&(Eo=null),jo!==null&&ic(jo)&&(jo=null),ko!==null&&ic(ko)&&(ko=null),Hl.forEach(qh),zl.forEach(qh)}function dc(e,n){e.blockedOn===n&&(e.blockedOn=null,Sd||(Sd=!0,a.unstable_scheduleCallback(a.unstable_NormalPriority,W_)))}var uc=null;function $h(e){uc!==e&&(uc=e,a.unstable_scheduleCallback(a.unstable_NormalPriority,function(){uc===e&&(uc=null);for(var n=0;n<e.length;n+=3){var r=e[n],s=e[n+1],m=e[n+2];if(typeof s!="function"){if(Cd(s||r)===null)continue;break}var w=mn(r);w!==null&&(e.splice(n,3),n-=3,xi(w,{pending:!0,data:m,method:r.method,action:s},s,m))}}))}function Yr(e){function n(te){return dc(te,e)}Eo!==null&&dc(Eo,e),jo!==null&&dc(jo,e),ko!==null&&dc(ko,e),Hl.forEach(n),zl.forEach(n);for(var r=0;r<Ro.length;r++){var s=Ro[r];s.blockedOn===e&&(s.blockedOn=null)}for(;0<Ro.length&&(r=Ro[0],r.blockedOn===null);)Fh(r),r.blockedOn===null&&Ro.shift();if(r=(e.ownerDocument||e).$$reactFormReplay,r!=null)for(s=0;s<r.length;s+=3){var m=r[s],w=r[s+1],N=m[qe]||null;if(typeof w=="function")N||$h(r);else if(N){var H=null;if(w&&w.hasAttribute("formAction")){if(m=w,N=w[qe]||null)H=N.formAction;else if(Cd(m)!==null)continue}else H=N.action;typeof H=="function"?r[s+1]=H:(r.splice(s,3),s-=3),$h(r)}}}function Ih(){function e(w){w.canIntercept&&w.info==="react-transition"&&w.intercept({handler:function(){return new Promise(function(N){return m=N})},focusReset:"manual",scroll:"manual"})}function n(){m!==null&&(m(),m=null),s||setTimeout(r,20)}function r(){if(!s&&!navigation.transition){var w=navigation.currentEntry;w&&w.url!=null&&navigation.navigate(w.url,{state:w.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var s=!1,m=null;return navigation.addEventListener("navigate",e),navigation.addEventListener("navigatesuccess",n),navigation.addEventListener("navigateerror",n),setTimeout(r,100),function(){s=!0,navigation.removeEventListener("navigate",e),navigation.removeEventListener("navigatesuccess",n),navigation.removeEventListener("navigateerror",n),m!==null&&(m(),m=null)}}}function bd(e){this._internalRoot=e}pc.prototype.render=bd.prototype.render=function(e){var n=this._internalRoot;if(n===null)throw Error(c(409));var r=n.current,s=$n();kh(r,s,e,n,null,null)},pc.prototype.unmount=bd.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var n=e.containerInfo;kh(e.current,2,null,e,null,null),Ys(),n[ze]=null}};function pc(e){this._internalRoot=e}pc.prototype.unstable_scheduleHydration=function(e){if(e){var n=ia();e={blockedOn:null,target:e,priority:n};for(var r=0;r<Ro.length&&n!==0&&n<Ro[r].priority;r++);Ro.splice(r,0,e),r===0&&Fh(e)}};var Lh=t.version;if(Lh!=="19.2.3")throw Error(c(527,Lh,"19.2.3"));L.findDOMNode=function(e){var n=e._reactInternals;if(n===void 0)throw typeof e.render=="function"?Error(c(188)):(e=Object.keys(e).join(","),Error(c(268,e)));return e=h(n),e=e!==null?y(e):null,e=e===null?null:e.stateNode,e};var Q_={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:T,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var fc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!fc.isDisabled&&fc.supportsFiber)try{pn=fc.inject(Q_),Mt=fc}catch{}}return Yl.createRoot=function(e,n){if(!i(e))throw Error(c(299));var r=!1,s="",m=zp,w=Vp,N=Bp;return n!=null&&(n.unstable_strictMode===!0&&(r=!0),n.identifierPrefix!==void 0&&(s=n.identifierPrefix),n.onUncaughtError!==void 0&&(m=n.onUncaughtError),n.onCaughtError!==void 0&&(w=n.onCaughtError),n.onRecoverableError!==void 0&&(N=n.onRecoverableError)),n=Eh(e,1,!1,null,null,r,s,null,m,w,N,Ih),e[ze]=n.current,rd(e),new bd(n)},Yl.hydrateRoot=function(e,n,r){if(!i(e))throw Error(c(299));var s=!1,m="",w=zp,N=Vp,H=Bp,te=null;return r!=null&&(r.unstable_strictMode===!0&&(s=!0),r.identifierPrefix!==void 0&&(m=r.identifierPrefix),r.onUncaughtError!==void 0&&(w=r.onUncaughtError),r.onCaughtError!==void 0&&(N=r.onCaughtError),r.onRecoverableError!==void 0&&(H=r.onRecoverableError),r.formState!==void 0&&(te=r.formState)),n=Eh(e,1,!0,n,r??null,s,m,te,w,N,H,Ih),n.context=jh(null),r=n.current,s=$n(),s=sa(s),m=fo(s),m.callback=null,ho(r,m,s),r=s,n.current.lanes=r,hn(n,r),ja(n),e[ze]=n.current,rd(e),new pc(n)},Yl.version="19.2.3",Yl}var Gh;function r0(){if(Gh)return jd.exports;Gh=1;function a(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(a)}catch(t){console.error(t)}}return a(),jd.exports=o0(),jd.exports}var l0=r0(),le=Wd();/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const xt=({card:a,onPointerDown:t,onPointerEnter:l,onPointerLeave:c,isFaceUp:i,faceDownValue:d=2,isSelected:f,isMultiSelected:p,isTargetable:u,isSourceOfEffect:h,style:y,additionalClassName:g,animationState:_})=>{const x=Z=>Z.replace(/<[^>]*>/g,"").length,S=({content:Z,className:ee})=>{const z=x(Z),O=z>95,q=z>140?"very-long-text":O?"long-text":"";return o.jsx("div",{className:`card-rule-box ${ee||""} ${q}`,dangerouslySetInnerHTML:{__html:Z}})},b=(_==null?void 0:_.type)==="playCard"&&_.cardId===a.id?`is-entering-${_.owner}`:"",C=(_==null?void 0:_.type)==="deleteCard"&&_.cardId===a.id?`is-deleting-${_.owner}`:"",R=(_==null?void 0:_.type)==="drawCard"||(_==null?void 0:_.type)==="discardCard"?_.owner:void 0,A=R==="player"&&(_==null?void 0:_.type)==="drawCard"&&_.cardIds.includes(a.id),I=R==="player"&&(_==null?void 0:_.type)==="discardCard"&&_.cardIds.includes(a.id),U=["card-component"];a.protocol&&U.push(`card-protocol-${a.protocol.toLowerCase()}`),a.color&&U.push("has-custom-color"),a.pattern&&U.push(`card-pattern-${a.pattern}`),f&&U.push("selected"),p&&U.push("multi-selected"),I&&U.push("is-discarding"),u&&U.push("is-targetable"),h&&U.push("is-source-of-effect"),b&&U.push(b),C&&U.push(C),A&&U.push("is-drawing"),g&&U.push(g);const $={...y};return a.color&&($["--card-custom-color"]=a.color),o.jsx("div",{className:U.join(" "),onPointerDown:t,onPointerEnter:l,onPointerLeave:c,role:"button",tabIndex:t?0:-1,style:$,children:o.jsxs("div",{className:`card-inner ${i?"":"is-flipped"}`,children:[o.jsxs("div",{className:"card-face card-front",children:[o.jsxs("div",{className:"card-header",children:[o.jsx("span",{className:`card-protocol ${a.protocol.length<=10?"short-protocol":""}`,children:a.protocol.slice(0,10)}),o.jsx("span",{className:"card-value",children:a.value})]}),o.jsxs("div",{className:"card-body",children:[o.jsx(S,{content:a.top,className:"card-rule-top"}),o.jsx(S,{content:a.middle,className:"card-rule-middle"}),o.jsx(S,{content:a.bottom,className:"card-rule-bottom"})]})]}),o.jsx("div",{className:"card-face card-back",children:o.jsx("div",{className:"card-back-value",children:d})})]})})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Ln=[{protocol:"Apathy",value:0,top:"Your total value in this line is increased by 1 for each face-down card in this line.",middle:"",bottom:"",keywords:{},category:"Aux 1"},{protocol:"Apathy",value:1,top:"",middle:"Flip all other face-up cards in this line.",bottom:"",keywords:{flip:!0},category:"Aux 1"},{protocol:"Apathy",value:2,top:"Ignore all middle commands of cards in this line.",middle:"",bottom:"<div><span class='emphasis'>When this card would be covered:</span> First, flip this card.</div>",keywords:{flip:!0},category:"Aux 1"},{protocol:"Apathy",value:3,top:"",middle:"Flip 1 of your opponent's face-up cards.",bottom:"",keywords:{flip:!0},category:"Aux 1"},{protocol:"Apathy",value:4,top:"",middle:"You may flip 1 of your face-up covered cards.",bottom:"",keywords:{flip:!0},category:"Aux 1"},{protocol:"Apathy",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Aux 1"},{protocol:"Chaos",value:0,top:"",middle:"In each line, flip 1 covered card.",bottom:"<div><span class='emphasis'>Start:</span> Draw the top card of your opponent's deck. Your opponent draws the top card of your deck.</div>",keywords:{flip:!0,draw:!0},category:"Main 2"},{protocol:"Chaos",value:1,top:"",middle:"Rearrange your protocols. Rearrange your opponent's protocols.",bottom:"",keywords:{},category:"Main 2"},{protocol:"Chaos",value:2,top:"",middle:"Shift 1 of your covered cards.",bottom:"",keywords:{shift:!0},category:"Main 2"},{protocol:"Chaos",value:3,top:"",middle:"",bottom:"You may play cards without matching protocols.",keywords:{play:!0},category:"Main 2"},{protocol:"Chaos",value:4,top:"",middle:"",bottom:"<div><span class='emphasis'>End:</span> Discard your hand. Draw the same amount of cards.</div>",keywords:{discard:!0,draw:!0},category:"Main 2"},{protocol:"Chaos",value:5,top:"",middle:"Discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 2"},{protocol:"Darkness",value:0,top:"",middle:"Draw 3 cards. Shift 1 of your opponent's covered cards.",bottom:"",keywords:{draw:!0,shift:!0},category:"Main 1"},{protocol:"Darkness",value:1,top:"",middle:"Flip 1 of your opponent's cards. You may shift that card.",bottom:"",keywords:{flip:!0,shift:!0},category:"Main 1"},{protocol:"Darkness",value:2,top:"All face-down cards in this stack have a value of 4.",middle:"You may flip 1 covered card in this line.",bottom:"",keywords:{flip:!0},category:"Main 1"},{protocol:"Darkness",value:3,top:"",middle:"Play 1 card face-down in another line.",bottom:"",keywords:{play:!0},category:"Main 1"},{protocol:"Darkness",value:4,top:"",middle:"Shift 1 face-down card.",bottom:"",keywords:{shift:!0},category:"Main 1"},{protocol:"Darkness",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Death",value:0,top:"",middle:"Delete 1 card from each other line.",bottom:"",keywords:{delete:!0},category:"Main 1"},{protocol:"Death",value:1,top:"<div><span class='emphasis'>Start:</span> You may draw 1 card. If you do, delete 1 other card, then delete this card.</div>",middle:"",bottom:"",keywords:{draw:!0,delete:!0},category:"Main 1"},{protocol:"Death",value:2,top:"",middle:"Delete all cards in 1 line with values of 1 or 2.",bottom:"",keywords:{delete:!0},category:"Main 1"},{protocol:"Death",value:3,top:"",middle:"Delete 1 face-down card.",bottom:"",keywords:{delete:!0},category:"Main 1"},{protocol:"Death",value:4,top:"",middle:"Delete a card with a value of 0 or 1.",bottom:"",keywords:{delete:!0},category:"Main 1"},{protocol:"Death",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Fire",value:0,top:"",middle:"Flip 1 other card. Draw 2 cards.",bottom:"<div><span class='emphasis'>When this card would be covered:</span> First, draw 1 card and flip 1 other card.</div>",keywords:{draw:!0,flip:!0},category:"Main 1"},{protocol:"Fire",value:1,top:"",middle:"Discard 1 card. If you do, delete 1 card.",bottom:"",keywords:{delete:!0,discard:!0},category:"Main 1"},{protocol:"Fire",value:2,top:"",middle:"Discard 1 card. If you do, return 1 card.",bottom:"",keywords:{discard:!0,return:!0},category:"Main 1"},{protocol:"Fire",value:3,top:"",middle:"",bottom:"<div><span class='emphasis'>End:</span> You may discard 1 card. If you do, flip 1 card.</div>",keywords:{discard:!0,flip:!0},category:"Main 1"},{protocol:"Fire",value:4,top:"",middle:"Discard 1 or more cards. Draw the amount discarded plus 1.",bottom:"",keywords:{discard:!0,draw:!0},category:"Main 1"},{protocol:"Fire",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Gravity",value:0,top:"",middle:"For every 2 cards in this line, play the top card of your deck face-down under this card.",bottom:"",keywords:{play:!0},category:"Main 1"},{protocol:"Gravity",value:1,top:"",middle:"Draw 2 cards. Shift 1 card either to or from this line.",bottom:"",keywords:{draw:!0,shift:!0},category:"Main 1"},{protocol:"Gravity",value:2,top:"",middle:"Flip 1 card. Shift that card to this line.",bottom:"",keywords:{flip:!0,shift:!0},category:"Main 1"},{protocol:"Gravity",value:4,top:"",middle:"Shift 1 face-down card to this line.",bottom:"",keywords:{shift:!0},category:"Main 1"},{protocol:"Gravity",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Gravity",value:6,top:"",middle:"Your opponent plays the top card of their deck face-down in this line.",bottom:"",keywords:{play:!0},category:"Main 1"},{protocol:"Hate",value:0,top:"",middle:"Delete 1 card.",bottom:"",keywords:{delete:!0},category:"Aux 1"},{protocol:"Hate",value:1,top:"",middle:"Discard 3 cards. Delete 1 card. Delete 1 card.",bottom:"",keywords:{delete:!0,discard:!0},category:"Aux 1"},{protocol:"Hate",value:2,top:"",middle:"Delete your highest value uncovered card. Delete your opponent's highest value uncovered card.",bottom:"",keywords:{delete:!0},category:"Aux 1"},{protocol:"Hate",value:3,top:"<div><span class='emphasis'>After you delete cards:</span> Draw 1 card.</div>",middle:"",bottom:"",keywords:{draw:!0},category:"Aux 1"},{protocol:"Hate",value:4,top:"",middle:"",bottom:"<div><span class='emphasis'>When this card would be covered:</span> First, delete the lowest value covered card in this line.</div>",keywords:{delete:!0},category:"Aux 1"},{protocol:"Hate",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Aux 1"},{protocol:"Life",value:0,top:"",middle:"Play the top card of your deck face-down in each line where you have a card.",bottom:"<div><span class='emphasis'>When this card would be covered:</span> First, delete this card.</div>",keywords:{delete:!0,play:!0},category:"Main 1"},{protocol:"Life",value:1,top:"",middle:"Flip 1 card. Flip 1 card.",bottom:"",keywords:{flip:!0},category:"Main 1"},{protocol:"Life",value:2,top:"",middle:"Draw 1 card. You may flip 1 face-down card.",bottom:"",keywords:{draw:!0,flip:!0},category:"Main 1"},{protocol:"Life",value:3,top:"",middle:"",bottom:"<div><span class='emphasis'>When this card would be covered:</span> First, play the top card of your deck face-down in another line.</div>",keywords:{play:!0},category:"Main 1"},{protocol:"Life",value:4,top:"",middle:"If this card is covering a card, draw 1 card.",bottom:"",keywords:{draw:!0},category:"Main 1"},{protocol:"Life",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Light",value:0,top:"",middle:"Flip 1 card. Draw cards equal to that card's value.",bottom:"",keywords:{draw:!0,flip:!0},category:"Main 1"},{protocol:"Light",value:1,top:"",middle:"",bottom:"<div><span class='emphasis'>End:</span> Draw 1 card.</div>",keywords:{draw:!0},category:"Main 1"},{protocol:"Light",value:2,top:"",middle:"Draw 2 cards. Reveal 1 face-down card. You may shift or flip that card.",bottom:"",keywords:{draw:!0,flip:!0,reveal:!0,shift:!0},category:"Main 1"},{protocol:"Light",value:3,top:"",middle:"Shift all face-down cards in this line to another line.",bottom:"",keywords:{shift:!0},category:"Main 1"},{protocol:"Light",value:4,top:"",middle:"Your opponent reveals their hand.",bottom:"",keywords:{reveal:!0},category:"Main 1"},{protocol:"Light",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Love",value:1,top:"",middle:"Draw the top card of your opponent's deck.",bottom:"<div><span class='emphasis'>End:</span> You may give 1 card from your hand to your opponent. If you do, draw 2 cards.</div>",keywords:{draw:!0,give:!0},category:"Aux 1"},{protocol:"Love",value:2,top:"",middle:"Your opponent draws 1 card. Refresh.",bottom:"",keywords:{draw:!0,refresh:!0},category:"Aux 1"},{protocol:"Love",value:3,top:"",middle:"Take 1 random card from your opponent's hand. Give 1 card from your hand to your opponent.",bottom:"",keywords:{give:!0,take:!0},category:"Aux 1"},{protocol:"Love",value:4,top:"",middle:"Reveal 1 card from your hand. Flip 1 card.",bottom:"",keywords:{flip:!0,reveal:!0},category:"Aux 1"},{protocol:"Love",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Aux 1"},{protocol:"Love",value:6,top:"",middle:"Your opponent draws 2 cards.",bottom:"",keywords:{draw:!0},category:"Aux 1"},{protocol:"Metal",value:0,top:"Your opponent's total value in this line is reduced by 2.",middle:"Flip 1 card.",bottom:"",keywords:{flip:!0},category:"Main 1"},{protocol:"Metal",value:1,top:"",middle:"Draw 2 cards. Your opponent cannot compile next turn.",bottom:"",keywords:{draw:!0},category:"Main 1"},{protocol:"Metal",value:2,top:"Your opponent cannot play cards face-down in this line.",middle:"",bottom:"",keywords:{},category:"Main 1"},{protocol:"Metal",value:3,top:"",middle:"Draw 1 card. Delete all cards in 1 other line with 8 or more cards.",bottom:"",keywords:{delete:!0,draw:!0},category:"Main 1"},{protocol:"Metal",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Metal",value:6,top:"<div><span class='emphasis'>When this card would be covered or flipped:</span> First, delete this card.</div>",middle:"",bottom:"",keywords:{delete:!0},category:"Main 1"},{protocol:"Plague",value:0,top:"",middle:"Your opponent discards 1 card.",bottom:"Your opponent cannot play cards in this line.",keywords:{discard:!0},category:"Main 1"},{protocol:"Plague",value:1,top:"<div><span class='emphasis'>After your opponent discards cards:</span> Draw 1 card.</div>",middle:"Your opponent discards 1 card.",bottom:"",keywords:{discard:!0,draw:!0},category:"Main 1"},{protocol:"Plague",value:2,top:"",middle:"Dicard 1 or more cards. Your opponent discards the amount of cards discarded plus 1.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Plague",value:3,top:"",middle:"Flip each other face-up card.",bottom:"",keywords:{flip:!0},category:"Main 1"},{protocol:"Plague",value:4,top:"",middle:"",bottom:"<div><span class='emphasis'>End:</span> Your opponent deletes 1 of their face-down cards. You may flip this card.</div>",keywords:{delete:!0,flip:!0},category:"Main 1"},{protocol:"Plague",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Psychic",value:0,top:"",middle:"Draw 2 cards. Your opponent discards 2 cards, then reveals their hand.",bottom:"",keywords:{discard:!0,draw:!0,reveal:!0},category:"Main 1"},{protocol:"Psychic",value:1,top:"Your opponent can only play cards face-down.",middle:"",bottom:"<div><span class='emphasis'>Start:</span> Flip this card.</div>",keywords:{flip:!0},category:"Main 1"},{protocol:"Psychic",value:2,top:"",middle:"Your opponent discards 2 cards. Rearrange their protocols.",bottom:"",keywords:{discard:!0,rearrange:!0},category:"Main 1"},{protocol:"Psychic",value:3,top:"",middle:"Your opponent discards 1 card. Shift 1 of their cards.",bottom:"",keywords:{discard:!0,shift:!0},category:"Main 1"},{protocol:"Psychic",value:4,top:"",middle:"",bottom:"<div><span class='emphasis'>End:</span> You may return 1 of your opponent's cards. If you do, flip this card.</div>",keywords:{flip:!0,return:!0},category:"Main 1"},{protocol:"Psychic",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Speed",value:0,top:"",middle:"Play 1 card.",bottom:"",keywords:{play:!0},category:"Main 1"},{protocol:"Speed",value:1,top:"<div><span class='emphasis'>After you clear cache:</span> Draw 1 card.</div>",middle:"Draw 2 cards.",bottom:"",keywords:{draw:!0},category:"Main 1"},{protocol:"Speed",value:2,top:"<div><span class='emphasis'>When this card would be deleted by compiling:</span> Shift this card, even if this card is covered.</div>",middle:"",bottom:"",keywords:{shift:!0},category:"Main 1"},{protocol:"Speed",value:3,top:"",middle:"Shift 1 of your other cards.",bottom:"<div><span class='emphasis'>End:</span> You may shift 1 of your cards. If you do, flip this card.</div>",keywords:{flip:!0,shift:!0},category:"Main 1"},{protocol:"Speed",value:4,top:"",middle:"Shift 1 of your opponent's face-down cards.",bottom:"",keywords:{shift:!0},category:"Main 1"},{protocol:"Speed",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Spirit",value:0,top:"",middle:"Refresh. Draw 1 card.",bottom:"Skip your check cache phase.",keywords:{draw:!0,refresh:!0},category:"Main 1"},{protocol:"Spirit",value:1,top:"You can play cards in any line.",middle:"Draw 2 cards.",bottom:"<div><span class='emphasis'>Start:</span> Either discard 1 card or flip this card.</div>",keywords:{discard:!0,draw:!0,flip:!0},category:"Main 1"},{protocol:"Spirit",value:2,top:"",middle:"You may flip 1 card.",bottom:"",keywords:{flip:!0},category:"Main 1"},{protocol:"Spirit",value:3,top:"<div><span class='emphasis'>After you draw cards:</span> You may shift this card, even if this card is covered.</div>",middle:"",bottom:"",keywords:{shift:!0},category:"Main 1"},{protocol:"Spirit",value:4,top:"",middle:"Swap the positions of 2 of your protocols",bottom:"",keywords:{swap:!0},category:"Main 1"},{protocol:"Spirit",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Water",value:0,top:"",middle:"Flip 1 other card. Flip this card.",bottom:"",keywords:{flip:!0},category:"Main 1"},{protocol:"Water",value:1,top:"",middle:"Play the top card of your deck face-down in each other line.",bottom:"",keywords:{play:!0},category:"Main 1"},{protocol:"Water",value:2,top:"",middle:"Draw 2 cards. Rearrange your protocols.",bottom:"",keywords:{draw:!0,rearrange:!0},category:"Main 1"},{protocol:"Water",value:3,top:"",middle:"Return all cards with a value of 2 in 1 line.",bottom:"",keywords:{return:!0},category:"Main 1"},{protocol:"Water",value:4,top:"",middle:"Return 1 of your cards.",bottom:"",keywords:{return:!0},category:"Main 1"},{protocol:"Water",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Frost",value:0,top:"",middle:"Draw 1 card for each face-down card.",bottom:"",keywords:{draw:!0},category:"Fan-Content"},{protocol:"Frost",value:1,top:"Cards cannot be flipped face-up.",middle:"",bottom:"Protocols cannot be rearranged.",keywords:{flip:!0,rearrange:!0},category:"Fan-Content"},{protocol:"Frost",value:2,top:"",middle:"Play a card face-down.",bottom:"",keywords:{play:!0},category:"Fan-Content"},{protocol:"Frost",value:3,top:"Cards cannot shift from or to this line.",middle:"",bottom:"",keywords:{shift:!0},category:"Fan-Content"},{protocol:"Frost",value:4,top:"",middle:"You may flip 1 card of your face-up covered cards.",bottom:"",keywords:{flip:!0},category:"Fan-Content"},{protocol:"Frost",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Fan-Content"},{protocol:"Anarchy",value:0,top:"",middle:"Shift 1 card. For each line that contains a face-up card without matching protocol, draw 1 card.",bottom:"",keywords:{shift:!0,draw:!0},category:"Fan-Content"},{protocol:"Anarchy",value:1,top:"Cards can only be played without matching protocols.",middle:"Shift 1 other card to a line without a matching protocol.",bottom:"",keywords:{shift:!0,play:!0},category:"Fan-Content"},{protocol:"Anarchy",value:2,top:"",middle:"Delete a covered or uncovered card in a line with a matching protocol.",bottom:"",keywords:{delete:!0},category:"Fan-Content"},{protocol:"Anarchy",value:3,top:"",middle:"Swap the positions of 2 of your opponent's protocols.",bottom:"<div><span class='emphasis'>End:</span> Rearrange your protocols. Anarchy cannot be on this line.</div>",keywords:{swap:!0,rearrange:!0},category:"Fan-Content"},{protocol:"Anarchy",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Fan-Content"},{protocol:"Anarchy",value:6,top:"<div><span class='emphasis'>Start:</span> Flip this card, if this card is in the line with the Anarchy protocol.</div>",middle:"",bottom:"",keywords:{flip:!0},category:"Fan-Content"}],s0=new Set(Ln.map(a=>a.protocol)),c0=Array.from(s0).sort();/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Zr=a=>{var c,i,d,f,p,u,h,y,g,_,x,S,E,b,j,C,R,A,I,U,$,Z,ee,z,O,k,q,F,D,T,L,B,G,ae,M,W,oe,Q,V,J,me,ge,Y,K,X,se,ie,_e,ye,ke,Ie,be,Pe,$e,Ae,Le,Re,Ne,ht,ct,Ct,wt,na,En,aa,Ta,pn,Mt,tn,It,oa,Aa,ya,On,fn,Jt,Qt,Mn,jn,Da,ga,ra,hn,la,va,_a,wa,sa,ca,ia,xa;const t=a.params;let l="";switch(t.action){case"refresh":{t.target==="opponent"?l="Your opponent refreshes their hand.":l="Refresh.";break}case"mutual_draw":{const fe=t.count||1;l=`Draw the top card${fe!==1?"s":""} of your opponent's deck. Your opponent draws the top card${fe!==1?"s":""} of your deck.`;break}case"draw":{if(a.useCardFromPreviousEffect){t.target==="opponent"?l="Opponent draws cards equal to that card's value.":l="Draw cards equal to that card's value.";break}if(t.revealFromDrawn){const qe=t.count||3;let Oe=`Draw ${qe} ${qe===1?"card":"cards"}.`;const Qe=t.revealFromDrawn.count||1,Je=Qe==="all"?"all cards":Qe===1?"1 card":`${Qe} cards`;(t.revealFromDrawn.valueSource||"stated_number")==="stated_number"?Oe+=` Reveal ${Je} drawn with the face-up value of your stated number.`:Oe+=` Reveal ${Je} drawn.`,t.revealFromDrawn.thenAction==="may_play"&&(Oe+=" You may play it."),l=Oe;break}if(t.countType==="count_face_down"){l="Draw 1 card for each face-down card.";break}if(t.conditional){switch(t.conditional.type){case"count_face_down":l="Draw 1 card for each face-down card.";break;case"is_covering":l=`Draw ${t.count} card${t.count!==1?"s":""} if this card is covering another.`;break;case"non_matching_protocols":l="Draw 1 card for each line with a non-matching protocol.";break}break}let fe="";if(t.countType==="equal_to_discarded"){const qe=t.countOffset||0;qe===1?fe+="Draw 1 more card than the amount discarded.":qe===0?fe+="Draw the same amount of cards.":fe+=`Draw the amount discarded plus ${qe}.`,l=fe;break}else if(t.countType==="equal_to_card_value"){fe+="Draw cards equal to that card's value.",l=fe;break}else if(t.countType==="hand_size"){fe+="Draw the same amount of cards.",l=fe;break}else if(t.countType==="all_matching"&&((c=t.valueFilter)==null?void 0:c.equals)!==void 0){const qe=t.valueFilter.equals;fe+=`Draw all cards with a value of ${qe}.`,l=fe;break}else if(((i=t.valueFilter)==null?void 0:i.equals)!==void 0&&t.count){const qe=t.valueFilter.equals,ze=t.count===1?"card":"cards",Oe=t.fromRevealed?" revealed this way":"";fe+=`Draw ${t.count} ${ze} with a value of ${qe}${Oe}.`,l=fe;break}if(((d=t.advancedConditional)==null?void 0:d.type)==="empty_hand"){const qe=t.count||1;l=`If you have no cards in hand, draw ${qe} card${qe!==1?"s":""}.`;break}if(((f=t.advancedConditional)==null?void 0:f.type)==="opponent_higher_value_in_lane"){const qe=t.count||1;l=`If your opponent has a higher total value than you do in this line, draw ${qe} card${qe!==1?"s":""}.`;break}const je=t.optional?"You may ":"";if(t.source==="opponent_deck"){const qe=t.count===1?"the top card":`the top ${t.count} cards`;fe+=`${je}Draw ${qe} of your opponent's deck.`}else if(t.target==="opponent")fe+=`Opponent draws ${t.count} card${t.count!==1?"s":""}.`;else{const qe=t.optional?"draw":"Draw";fe+=`${je}${qe} ${t.count} card${t.count!==1?"s":""}.`}l=fe;break}case"flip":{if(a.useCardFromPreviousEffect){const lt=t.optional?"May flip":"Flip",Pt=t.skipMiddleCommand?", ignoring its middle commands":"";l=`${lt} that card${Pt}.`;break}if(t.flipSelf){if(((p=t.advancedConditional)==null?void 0:p.type)==="opponent_higher_value_in_lane"){l="If your opponent has a higher value in this line than you do, flip this card.";break}if(((u=t.advancedConditional)==null?void 0:u.type)==="hand_size_greater_than"){const Pt=t.advancedConditional.threshold??0;l=`If you have more than ${Pt} ${Pt===1?"card":"cards"} in your hand, flip this card.`;break}let lt=t.optional?"You may flip this card":"Flip this card";((h=t.advancedConditional)==null?void 0:h.type)==="protocol_match"&&(lt+=`, if this card is in the line with the ${t.advancedConditional.protocol||"[Protocol]"} protocol`),l=lt+".";break}const fe=t.optional?"You may flip":"Flip",je=((y=t.targetFilter)==null?void 0:y.owner)==="own",qe=((g=t.targetFilter)==null?void 0:g.owner)==="opponent",ze=(_=t.targetFilter)==null?void 0:_.excludeSelf;let Oe="";je&&ze?Oe+="of your other ":je?Oe+="of your ":qe?Oe+="of your opponent's ":ze&&(Oe+="other "),((x=t.targetFilter)==null?void 0:x.position)==="any"?Oe+="covered or uncovered ":((S=t.targetFilter)==null?void 0:S.position)==="covered"&&(Oe+="covered "),((E=t.targetFilter)==null?void 0:E.faceState)==="face_down"&&(Oe+="face-down "),((b=t.targetFilter)==null?void 0:b.faceState)==="face_up"&&(Oe+="face-up ");let Qe="";t.count==="all"?Qe="all":t.count==="each"?t.eachLineScope==="each_line"?(Qe="1",Oe=Oe+"(in each line) "):Qe="each":Qe=t.count.toString();const rt=je||qe?"cards":t.count===1?"card":"cards";let Ve="";if(je&&((j=t.targetFilter)==null?void 0:j.position)==="covered"&&((C=t.targetFilter)==null?void 0:C.faceState)==="face_up"&&t.optional?Ve=`${fe} ${Qe} of your ${t.targetFilter.faceState.replace("_","-")} ${t.targetFilter.position} cards`:Ve=`${fe} ${Qe} ${Oe}${rt}`,t.scope==="this_lane"){const lt=((R=t.targetFilter)==null?void 0:R.owner)==="own";Ve+=lt?" in this stack":" in this line"}else t.scope==="each_lane"&&(Ve=`In each line, ${Ve.charAt(0).toLowerCase()+Ve.slice(1)}`);t.sameLaneAsFirst&&(Ve+=" in the same line"),(A=t.targetFilter)!=null&&A.valueMinGreaterThanHandSize&&(Ve+=" that has a value greater than the number of cards in your hand"),Ve+=".",t.selfFlipAfter&&(Ve+=" Then flip this card."),l=Ve;break}case"shift":{const fe=t.optional?"You may shift":"Shift";if(((I=t.advancedConditional)==null?void 0:I.type)==="empty_hand"){l=`If you have no cards in hand, ${fe.toLowerCase()} 1 card.`;break}if(((U=t.advancedConditional)==null?void 0:U.type)==="opponent_higher_value_in_lane"){l=`If your opponent has a higher total value than you do in this line, ${fe.toLowerCase()} 1 card.`;break}if((($=t.advancedConditional)==null?void 0:$.type)==="this_card_is_covered"){l=`If this card is covered, ${fe.toLowerCase()} it.`;break}if(t.shiftSelf){if(((Z=t.destinationRestriction)==null?void 0:Z.type)==="opponent_highest_value_lane"){l=`${fe} this card to the line where your opponent has their highest total value.`;break}let Et=`${fe} this card`;t.allowCoveredSelf&&(Et+=", even if this card is covered"),l=Et+".";break}if(a.useCardFromPreviousEffect){let Et=`${fe} that card`;((ee=t.destinationRestriction)==null?void 0:ee.type)==="to_this_lane"?Et+=" to this line":((z=t.destinationRestriction)==null?void 0:z.type)==="to_another_line"?Et+=" to another line":((O=t.destinationRestriction)==null?void 0:O.type)==="non_matching_protocol"?Et+=" to a line without a matching protocol":((k=t.destinationRestriction)==null?void 0:k.type)==="specific_lane"&&(Et+=" within this line"),l=Et+".";break}const je=t.count||1,qe=((q=t.targetFilter)==null?void 0:q.owner)==="own",ze=((F=t.targetFilter)==null?void 0:F.position)==="covered";if(qe&&ze&&je===1){let Et=`${fe} 1 of your covered cards`;((D=t.destinationRestriction)==null?void 0:D.type)==="non_matching_protocol"?Et+=" to a line without a matching protocol":((T=t.destinationRestriction)==null?void 0:T.type)==="specific_lane"?Et+=" within this line":((L=t.destinationRestriction)==null?void 0:L.type)==="to_another_line"&&(Et+=" to another line"),l=Et+".";break}if(((B=t.targetFilter)==null?void 0:B.owner)==="own"&&((G=t.targetFilter)==null?void 0:G.position)==="any"&&!((ae=t.targetFilter)!=null&&ae.excludeSelf)&&je===1){l=`${fe} this card, even if this card is covered`+".";break}if(qe&&!ze&&!((M=t.targetFilter)!=null&&M.excludeSelf)&&je===1){l=`${fe} 1 of your cards`+".";break}let Qe="";const Je=((W=t.targetFilter)==null?void 0:W.owner)==="opponent",rt=(oe=t.targetFilter)==null?void 0:oe.excludeSelf,Ve=((Q=t.targetFilter)==null?void 0:Q.position)==="any";qe&&rt?Qe+="of your other ":Je?Qe+="of your opponent's ":rt&&(Qe+="other "),Ve?Qe+="covered or uncovered ":((V=t.targetFilter)==null?void 0:V.position)==="covered"&&(Qe+="covered "),((J=t.targetFilter)==null?void 0:J.faceState)==="face_down"&&(Qe+="face-down "),((me=t.targetFilter)==null?void 0:me.faceState)==="face_up"&&(Qe+="face-up ");const lt=t.count==="all"?"all":"1";let Xt=`${fe} ${lt} ${Qe}${qe&&rt||Je?"cards":lt==="1"?"card":"cards"}`;t.scope==="this_lane"&&(Xt+=" in this line"),((ge=t.destinationRestriction)==null?void 0:ge.type)==="non_matching_protocol"?Xt+=" to a line without a matching protocol":((Y=t.destinationRestriction)==null?void 0:Y.type)==="specific_lane"?Xt+=" within this line":((K=t.destinationRestriction)==null?void 0:K.type)==="to_another_line"?Xt+=" to another line":((X=t.destinationRestriction)==null?void 0:X.type)==="to_this_lane"?Xt+=" to this line":((se=t.destinationRestriction)==null?void 0:se.type)==="to_or_from_this_lane"&&(Xt+=" either to or from this line"),l=Xt+".";break}case"delete":{if(((ie=t.advancedConditional)==null?void 0:ie.type)==="empty_hand"){const Je=t.count||1;l=`If you have no cards in hand, delete ${Je} card${Je!==1?"s":""}.`;break}if(((_e=t.advancedConditional)==null?void 0:_e.type)==="opponent_higher_value_in_lane"){const Je=t.count||1;l=`If your opponent has a higher total value than you do in this line, delete ${Je} card${Je!==1?"s":""}.`;break}if(a.useCardFromPreviousEffect){l="Delete that card.";break}if(t.deleteSelf){l="Delete this card.";break}if(((ye=t.laneCondition)==null?void 0:ye.type)==="opponent_higher_value"){const Je=t.count||1,rt=((ke=t.targetFilter)==null?void 0:ke.owner)==="opponent"?"of your opponent's ":"";l=`Delete ${Je} ${rt}${Je===1?"card":"cards"} in a line where they have a higher total value than you do.`;break}let fe=t.optional?"You may delete ":"Delete ";const je=((Ie=t.targetFilter)==null?void 0:Ie.position)==="any",qe=((be=t.targetFilter)==null?void 0:be.calculation)==="highest_value"||((Pe=t.targetFilter)==null?void 0:Pe.calculation)==="lowest_value",ze=(($e=t.targetFilter)==null?void 0:$e.owner)==="own"||((Ae=t.targetFilter)==null?void 0:Ae.owner)==="opponent",Oe=t.count===1&&qe&&ze;if(t.count==="all_in_lane"?fe+="all ":Oe||(fe+=je?"a ":`${t.count} `),Oe&&(((Le=t.targetFilter)==null?void 0:Le.owner)==="own"?fe+="your ":((Re=t.targetFilter)==null?void 0:Re.owner)==="opponent"&&(fe+="opponent's ")),((Ne=t.targetFilter)==null?void 0:Ne.calculation)==="highest_value"?fe+="highest value ":((ht=t.targetFilter)==null?void 0:ht.calculation)==="lowest_value"&&(fe+="lowest value "),(ct=t.targetFilter)!=null&&ct.valueRange){const{min:Je,max:rt}=t.targetFilter.valueRange,Ve=[];for(let Pt=Je;Pt<=rt;Pt++)Ve.push(Pt);const lt=Ve.join(" or ");fe+=`value ${lt} `}Oe||(((Ct=t.targetFilter)==null?void 0:Ct.owner)==="own"?fe+="your ":((wt=t.targetFilter)==null?void 0:wt.owner)==="opponent"&&(fe+="opponent's ")),t.excludeSelf&&(fe+="other "),je?fe+="covered or uncovered ":((na=t.targetFilter)==null?void 0:na.position)==="covered"&&(fe+="covered "),((En=t.targetFilter)==null?void 0:En.faceState)==="face_down"?fe+="face-down ":((aa=t.targetFilter)==null?void 0:aa.faceState)==="face_up"&&(fe+="face-up ");const Qe=t.count===1?"card":"cards";fe+=Qe,t.selectLane&&(fe+=" in 1 line"),t.protocolMatching==="must_match"?fe+=" in a line with a matching protocol":t.protocolMatching==="must_not_match"&&(fe+=" in a line without a matching protocol"),((Ta=t.scope)==null?void 0:Ta.type)==="this_line"?fe+=" in this line":((pn=t.scope)==null?void 0:pn.type)==="other_lanes"?fe+=" in other lanes":((Mt=t.scope)==null?void 0:Mt.type)==="each_other_line"&&(fe+=" from each other line"),((tn=t.targetFilter)==null?void 0:tn.valueSource)==="previous_effect_card"&&(fe+=" that shares a value with the discarded card"),l=fe+".";break}case"discard":{if(t.source==="top_deck_own"){l="Discard the top card of your deck.";break}if(t.source==="top_deck_opponent"){l="Discard the top card of your opponent's deck.";break}if(t.source==="entire_deck"){l="Discard your entire deck.";break}if(t.useCardFromPreviousEffect){t.actor==="opponent"?l="Opponent discards that card.":l="discard that card.";break}if(t.countType==="equal_to_discarded"){const ze=t.countOffset||0;t.actor==="opponent"?ze===1?l="Your opponent discards the amount of cards discarded plus 1.":ze===0?l="Your opponent discards the same amount of cards.":l=`Your opponent discards the amount discarded plus ${ze}.`:ze===1?l="Discard 1 more card than the amount discarded.":ze===0?l="Discard the same amount of cards.":l=`Discard the amount discarded plus ${ze}.`;break}const fe=t.variableCount;let je="";if(fe)je="1 or more cards";else if(t.count==="all")je="your hand";else{const ze=t.count===1?"card":"cards";je=`${t.count} ${ze}`}const qe=t.optional?"You may discard":t.count==="all"||fe?"Discard":"You discard";if(t.actor==="both"){if(t.count==="all")l="Both players discard their hand.";else{const ze=t.count===1?"card":"cards";l=`Both players discard ${t.count} ${ze}.`}break}if(t.actor==="opponent")if(t.count==="all")l="Opponent discards their hand.";else if(t.random){const ze=t.count===1?"card":"cards";l=`Your opponent discards ${t.count} random ${ze}.`}else l=`Your opponent discards ${je}.`;else l=`${qe} ${je}.`;break}case"return":{if(((It=t.advancedConditional)==null?void 0:It.type)==="empty_hand"){const Ve=t.count||1;l=`If you have no cards in hand, return ${Ve} card${Ve!==1?"s":""}.`;break}if(((oa=t.advancedConditional)==null?void 0:oa.type)==="opponent_higher_value_in_lane"){const Ve=t.count||1;l=`If your opponent has a higher total value than you do in this line, return ${Ve} card${Ve!==1?"s":""}.`;break}if(a.useCardFromPreviousEffect){l="Return that card to hand.";break}const je=t.selectLane||!1?" in 1 line":"";if(((Aa=t.targetFilter)==null?void 0:Aa.valueEquals)!==void 0){l=`Return all cards with a value of ${t.targetFilter.valueEquals}${je}.`;break}const qe=((ya=t.targetFilter)==null?void 0:ya.owner)||"any",ze=((On=t.targetFilter)==null?void 0:On.position)||"uncovered";let Oe="";ze==="any"?Oe="covered or uncovered ":ze==="covered"&&(Oe="covered ");const Qe=t.count==="all"?`all ${Oe}cards`:t.count===1?`1 ${Oe}card`:`${t.count} ${Oe}cards`;let Je="";qe==="own"?Je=" of your":qe==="opponent"&&(Je=" of your opponent's"),l=`${t.optional?"You may r":"R"}eturn ${Qe}${Je}${je}.`;break}case"play":{if(((fn=t.advancedConditional)==null?void 0:fn.type)==="empty_hand"){const Ve=t.count||1;l=`If you have no cards in hand, play ${Ve} card${Ve!==1?"s":""}.`;break}if(((Jt=t.advancedConditional)==null?void 0:Jt.type)==="opponent_higher_value_in_lane"){const Ve=t.count||1;l=`If your opponent has a higher total value than you do in this line, play ${Ve} card${Ve!==1?"s":""}.`;break}if(a.useCardFromPreviousEffect){const Ve=t.faceDown===!0?"face-down":t.faceDown===!1?"face-up":"";let lt="";((Qt=t.destinationRule)==null?void 0:Qt.type)==="other_lines"&&(lt=" in another line"),l=Ve?`Play that card ${Ve}${lt}.`:`Play that card${lt}.`;break}if(t.source==="trash"){const Ve=t.count||1;l=`Play ${Ve} ${Ve===1?"card":"cards"} from your trash.`;break}const fe=t.actor,je=t.count||1,qe=t.faceDown===!0?" face-down":t.faceDown===!1?" face-up":"";let ze="",Oe="";const Qe=((Mn=t.valueFilter)==null?void 0:Mn.equals)!==void 0?` with a value of ${t.valueFilter.equals}`:"";fe==="opponent"?(ze="Your opponent plays",t.source==="deck"?Oe=je===1?"the top card of their deck":`${je} cards from their deck`:Oe=je===1?`a card${Qe} from their hand`:`${je} cards${Qe} from their hand`):(ze=t.optional?"You may play":"Play",t.source==="deck"?Oe=je===1?"the top card of your deck":`${je} cards from your deck`:Oe=je===1?`1 card${Qe}`:`${je} cards${Qe}`);let Je="";((jn=t.condition)==null?void 0:jn.type)==="per_x_cards_in_line"&&(Je=`For every ${t.condition.cardCount||2} cards in this line, `,ze=ze.toLowerCase());let rt=`${Je}${ze} ${Oe}${qe}`;if(((Da=t.destinationRule)==null?void 0:Da.type)==="other_lines")rt+=" to other lines";else if(((ga=t.destinationRule)==null?void 0:ga.type)==="another_line")rt+=" in another line";else if(((ra=t.destinationRule)==null?void 0:ra.type)==="each_other_line")rt+=" in each other line";else if(((hn=t.destinationRule)==null?void 0:hn.type)==="under_this_card")rt+=" under this card";else if(((la=t.destinationRule)==null?void 0:la.type)==="each_line_with_card"){const Ve=t.destinationRule.ownerFilter,lt=t.destinationRule.cardFilter;(lt==null?void 0:lt.faceState)==="face_down"?rt+=" in each line with a face-down card":(lt==null?void 0:lt.faceState)==="face_up"?rt+=" in each line with a face-up card":Ve==="own"?rt+=" in each line where you have a card":Ve==="opponent"?rt+=" in each line where opponent has a card":rt+=" to each line with a card"}else if(((va=t.destinationRule)==null?void 0:va.type)==="line_with_matching_cards"){const Ve=t.destinationRule.cardFilter;(Ve==null?void 0:Ve.faceState)==="face_down"?rt+=" in a line with a face-down card":(Ve==null?void 0:Ve.faceState)==="face_up"?rt+=" in a line with a face-up card":rt+=" in a line with a card"}else((_a=t.destinationRule)==null?void 0:_a.type)==="specific_lane"&&(rt+=" in this line");l=rt+".";break}case"rearrange_protocols":case"swap_protocols":{const fe=t.target==="opponent"?"your opponent's":t.target==="both_sequential"?"both players'":"your";let je="";t.action==="rearrange_protocols"?je=`Rearrange ${fe} protocols`:je=`Swap the positions of 2 of ${fe} protocols`,t.restriction&&t.restriction.disallowedProtocol&&(je+=`. ${t.restriction.disallowedProtocol} cannot be on this line`),l=je+".";break}case"reveal":case"give":{if(a.useCardFromPreviousEffect){l=`${t.action==="give"?"Give":"Reveal"} that card.`;break}if(t.action,t.source==="board"){const Je=((wa=t.targetFilter)==null?void 0:wa.faceState)==="face_down"?"face-down ":"",rt=t.count||1;let lt=`Reveal ${rt} ${Je}${rt===1?"card":"cards"}`;t.optional?lt+=". You may shift or flip that card":t.followUpAction==="flip"?lt+=". Then flip it":t.followUpAction==="shift"&&(lt+=". Then shift it"),l=lt+".";break}if(t.source==="own_deck_top"){let Je="Reveal the top card of your deck";t.followUpAction==="may_discard"&&(Je+=". You may discard it"),l=Je+".";break}if(t.source==="own_deck"){l="Reveal your deck.";break}if(t.source==="own_trash"){const Je=t.count||1;l=`Reveal ${Je} ${Je===1?"card":"cards"} from your trash.`;break}if(t.count===-1){t.source==="opponent_hand"?l=t.action==="reveal"?"Your opponent reveals their hand.":"Give your entire hand to your opponent.":l=t.action==="reveal"?"Reveal your hand.":"Give your entire hand.";break}const fe=t.count===1?"card":"cards",je=t.source==="opponent_hand"?"opponent's hand":"your hand",qe=t.optional?"You may ":"",ze=t.action==="give"?"give":"reveal",Oe=t.action==="give"?"Give":"Reveal";let Qe;t.optional?Qe=`${qe}${ze} ${t.count} ${fe} from ${je}`:Qe=`${Oe} ${t.count} ${fe} from ${je}`,t.action==="give"&&t.source!=="opponent_hand"&&(Qe+=" to your opponent"),t.followUpAction==="flip"?Qe+=". Then flip it.":t.followUpAction==="shift"?Qe+=". Then shift it.":Qe+=".",l=Qe;break}case"take":{const fe=t.count===1?"card":"cards",je=t.random!==!1?"random ":"";l=`Take ${t.count} ${je}${fe} from your opponent's hand.`;break}case"choice":{const fe=t.options||[];if(fe.length===0){l="Effect";break}if(fe.length===2){const je=fe.map(qe=>{const ze={params:qe.params};let Oe=Zr(ze);return Oe.endsWith(".")&&(Oe=Oe.slice(0,-1)),Oe=Oe.charAt(0).toLowerCase()+Oe.slice(1),Oe});l=`Either ${je[0]} or ${je[1]}.`}else l="Effect";break}case"passive_rule":{const fe=t.rule;switch(fe==null?void 0:fe.type){case"require_non_matching_protocol":l="Cards can only be played without matching protocols.";break;case"block_all_play":fe.target==="opponent"?l="Your opponent cannot play cards in this line.":fe.target==="self"?l="You cannot play cards in this line.":l="Cards cannot be played in this line.";break;case"ignore_middle_commands":if(fe.onlyDuringYourTurn&&fe.target==="opponent"&&fe.scope==="global")l="During your turn, your opponent's cards do not have middle commands.";else if(fe.onlyDuringYourTurn){const je=fe.target==="opponent"?"your opponent's ":fe.target==="self"?"your ":"",qe=fe.scope==="global"?"":" in this line";l=`During your turn, ignore all middle commands of ${je}cards${qe}.`}else l="Ignore all middle commands of cards in this line.";break;case"block_face_down_play":l="Opponent can't play cards face-down in this line.";break;case"require_face_down_play":l=fe.scope==="global"?"Your opponent can only play cards face-down.":"Opponent can only play cards face-down in this line.";break;case"allow_any_protocol_play":l="You may play cards without matching protocols.";break;case"allow_play_on_opponent_side":l="You may play this card in any line on either player's side.";break;case"block_flips":l=fe.scope==="global"?"Cards cannot be flipped face-up.":"Cards can't be flipped face-up in this line.";break;case"block_protocol_rearrange":l="Protocols can't be rearranged.";break;case"block_shifts_from_lane":l="Cards can't shift from this line.";break;case"block_shifts_to_lane":l="Cards can't shift to this line.";break;case"block_shifts_from_and_to_lane":l="Cards cannot shift from or to this line.";break;case"skip_check_cache_phase":l="Skip check cache phase.";break;case"block_flip_this_card":l="This card cannot be flipped.";break;case"block_draw_conditional":{const je=fe.conditionTarget||"self",qe=fe.blockTarget||"self",ze=je==="self"?"you have":"your opponent has";let Oe;qe==="self"?Oe="you cannot draw":qe==="opponent"?Oe="your opponent cannot draw":Oe="neither player can draw",l=`If ${ze} any cards in hand, ${Oe} cards.`;break}default:l="Passive rule effect."}break}case"value_modifier":{const fe=t.modifier;switch(fe==null?void 0:fe.type){case"add_per_condition":{const je=fe.scope==="this_lane"?"in this line":"",qe=fe.target==="own_total"?"Your total value":fe.target==="opponent_total"?"Your opponent's total value":"Total value";let ze="",Oe="";fe.condition==="per_face_down_card"?(ze="for each face-down card",Oe=je):fe.condition==="per_face_up_card"?(ze="for each face-up card",Oe=je):fe.condition==="per_card"?(ze="for each card",Oe=je):fe.condition==="per_card_in_hand"?ze="for each card in your hand":fe.condition==="per_opponent_card_in_lane"&&(ze="for each of your opponent's cards",Oe=je);const Qe=Math.abs(fe.value),Je=fe.value>=0?"increased":"reduced";l=`${qe} ${je} is ${Je} by ${Qe} ${ze} ${Oe}.`.replace(/\s+/g," ").trim();break}case"set_to_fixed":{let je="";fe.target==="own_cards"?je="your":fe.target==="opponent_cards"?je="opponent's":je="all";let qe="";((sa=fe.filter)==null?void 0:sa.faceState)==="face_down"?qe=" face-down":((ca=fe.filter)==null?void 0:ca.faceState)==="face_up"&&(qe=" face-up");let ze="";fe.scope==="this_lane"&&(ze=" in this stack"),l=`All ${je}${qe} cards${ze} have a value of ${fe.value}.`;break}case"add_to_total":{const je=fe.scope==="this_lane"?" in this line":"";fe.target==="opponent_total"?fe.value<0?l=`Your opponent's total value${je} is reduced by ${Math.abs(fe.value)}.`:l=`Your opponent's total value${je} is increased by ${fe.value}.`:fe.value<0?l=`Your total value${je} is reduced by ${Math.abs(fe.value)}.`:l=`Your total value${je} is increased by ${fe.value}.`;break}default:l="Value modifier effect."}break}case"block_compile":{l=`${t.target==="opponent"?"Your opponent":"You"} cannot compile next turn.`;break}case"delete_all_in_lane":{const fe=((ia=t.laneCondition)==null?void 0:ia.count)||8;l=`Delete all cards in ${t.excludeCurrentLane?"1 other line":"1 line"} with ${fe} or more cards.`;break}case"modify_value":{const fe=t.modifier||0,je=t.target==="opponent"?"Your opponent's":"Your",qe=fe<0?`reduced by ${Math.abs(fe)}`:`increased by ${fe}`;l=`${je} total value in this line is ${qe}.`;break}case"block_play_face_down":{l="Your opponent cannot play cards face-down in this line.";break}case"shuffle_trash":{let je=`${t.optional!==!1?"You may shuffle":"Shuffle"} your trash into your deck.`;((xa=t.advancedConditional)==null?void 0:xa.type)==="trash_not_empty"&&(je=`If there are any cards in your trash, ${je.charAt(0).toLowerCase()+je.slice(1)}`),l=je;break}case"shuffle_deck":{l="Shuffle your deck.";break}case"redirect_return_to_deck":{l=`Put that card on top of their deck ${t.faceDown!==!1?"face-down ":""}instead.`;break}case"state_number":{l="State a number.";break}case"state_protocol":{l="State a protocol.";break}case"swap_stacks":{l="Swap all of your cards in one of your stacks with another one of your stacks.";break}case"copy_opponent_middle":{l=`${t.optional?"You may resolve":"Resolve"} the middle command of 1 of your opponent's cards as if it were on this card.`;break}default:l="Effect";break}if(a.conditional&&a.conditional.thenEffect){let fe=Zr(a.conditional.thenEffect);const je=a.conditional.thenEffect.params;je!=null&&je.useCardFromPreviousEffect&&(fe=fe.replace(/\d+ cards?/i,"that card")),a.conditional.type==="then"?l=`${l.endsWith(".")?l.slice(0,-1):l}, then ${fe.toLowerCase()}`:a.conditional.type==="optional"?l=`${l.endsWith(".")?l.slice(0,-1):l}. You may ${fe.toLowerCase()}`:a.conditional.type==="if_protocol_matches_stated"?l=`${l} If the discarded card matches the stated protocol, ${fe.toLowerCase()}`:l=`${l} If you do, ${fe.toLowerCase()}`}return l},i0=a=>{const t={};for(const l of a){const i=l.params.action;i==="draw"&&(t.draw=!0),i==="flip"&&(t.flip=!0),i==="shift"&&(t.shift=!0),i==="delete"&&(t.delete=!0),i==="discard"&&(t.discard=!0),i==="return"&&(t.return=!0),i==="play"&&(t.play=!0),i==="reveal"&&(t.reveal=!0),i==="give"&&(t.give=!0),i==="take"&&(t.take=!0)}return t},ir=a=>a.length===0?"":a.map(t=>{var i;const l=Zr(t),c=t.trigger;if(c==="start")return`<div><span class='emphasis'>Start:</span> ${l}</div>`;if(c==="end")return`<div><span class='emphasis'>End:</span> ${l}</div>`;if(c==="on_cover")return`<div><span class='emphasis'>When this card would be covered:</span> First, ${l.toLowerCase()}</div>`;if(c==="on_flip")return`<div><span class='emphasis'>When this card would be flipped:</span> First, ${l.toLowerCase()}</div>`;if(c==="on_cover_or_flip")return`<div><span class='emphasis'>When this card would be covered or flipped:</span> First, ${l.toLowerCase()}</div>`;if(c==="after_draw"||c==="after_delete"||c==="after_discard"||c==="after_shift"||c==="after_flip"||c==="after_clear_cache"){const d=t.reactiveTriggerActor||"self",f=d==="self"?"you":d==="opponent"?"opponent":"a card is";let p="";c==="after_draw"?p=d==="any"?"drawn":"draw cards":c==="after_delete"?p=d==="any"?"deleted":"delete cards":c==="after_discard"?p=d==="any"?"discarded":"discard cards":c==="after_shift"?p=d==="any"?"shifted":"shift cards":c==="after_flip"?p=d==="any"?"flipped":"flip cards":c==="after_clear_cache"&&(p="clear cache");const u=t.onlyDuringOpponentTurn?" during your opponent's turn":"";return`<div><span class='emphasis'>${`After ${f} ${p}${u}`}:</span> ${l}</div>`}if(c==="after_opponent_discard")return`<div><span class='emphasis'>After your opponent discards cards:</span> ${l}</div>`;if(c==="after_opponent_draw")return`<div><span class='emphasis'>After your opponent draws cards:</span> ${l}</div>`;if(c==="after_refresh")return`<div><span class='emphasis'>After you refresh:</span> ${l}</div>`;if(c==="after_opponent_refresh")return`<div><span class='emphasis'>After your opponent refreshes:</span> ${l}</div>`;if(c==="after_compile")return`<div><span class='emphasis'>After you compile:</span> ${l}</div>`;if(c==="after_opponent_compile")return`<div><span class='emphasis'>After your opponent compiles:</span> ${l}</div>`;if(c==="after_shuffle"){const d=t.reactiveTriggerActor||"self";let f="After you shuffle your deck:";return d==="opponent"?f="After your opponent shuffles their deck:":d==="any"&&(f="After any player shuffles their deck:"),`<div><span class='emphasis'>${f}</span> ${l}</div>`}if(c==="after_play"){const d=t.reactiveTriggerActor||"self",f=t.reactiveScope||"global";return d==="opponent"&&f==="this_lane"?`<div><span class='emphasis'>After your opponent plays a card in this line:</span> ${l}</div>`:d==="opponent"?`<div><span class='emphasis'>After your opponent plays a card:</span> ${l}</div>`:f==="this_lane"?`<div><span class='emphasis'>After you play a card in this line:</span> ${l}</div>`:`<div><span class='emphasis'>After you play a card:</span> ${l}</div>`}return c==="before_compile_delete"?`<div><span class='emphasis'>When this card would be deleted by compiling:</span> ${l}</div>`:c==="when_card_returned"?`<div><span class='emphasis'>When a card would be returned to ${(((i=t.params)==null?void 0:i.targetOwner)||"opponent")==="opponent"?"your opponent's":"your"} hand:</span> ${l}</div>`:l}).join(" "),d0=(a,t)=>{var u,h,y;const l=((u=a.text)==null?void 0:u.top)!==void 0?a.text.top:ir(a.topEffects),c=((h=a.text)==null?void 0:h.middle)!==void 0?a.text.middle:ir(a.middleEffects),i=((y=a.text)==null?void 0:y.bottom)!==void 0?a.text.bottom:ir(a.bottomEffects),d=[...a.topEffects,...a.middleEffects,...a.bottomEffects],f=i0(d);return{protocol:t.name,value:a.value,top:l,middle:c,bottom:i,keywords:f,category:t.category||"Custom",color:t.color,pattern:t.pattern,customEffects:{topEffects:a.topEffects,middleEffects:a.middleEffects,bottomEffects:a.bottomEffects}}},u0=a=>a.cards.map(t=>d0(t,a)),Po=()=>{try{const a=localStorage.getItem("custom_protocols_v1");if(!a)return[];const l=JSON.parse(a).protocols||[],c=[];for(const i of l){const d=u0(i);c.push(...d)}return c}catch(a){return console.error("Failed to load custom protocol cards:",a),[]}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const gm="custom_protocols_v1",Ld=1,pr=()=>{try{const a=localStorage.getItem(gm);if(!a)return[];const t=JSON.parse(a);return t.version!==Ld&&console.warn(`Custom protocol storage version mismatch: expected ${Ld}, got ${t.version}`),t.protocols||[]}catch(a){return console.error("Error loading custom protocols:",a),[]}},Qd=a=>{try{const t={protocols:a,version:Ld};localStorage.setItem(gm,JSON.stringify(t))}catch(t){console.error("Error saving custom protocols:",t)}},_t=a=>{const t=pr(),l=t.findIndex(c=>c.id===a.id);l>=0?t[l]=a:t.push(a),Qd(t)},p0=a=>{const l=pr().filter(c=>c.id!==a);Qd(l)},f0=["anarchy-custom-001","apathy_custom","chaos_custom_1","clarity-custom-001","corruption-custom-001","courage-custom-001","darkness_custom_v1","death_custom_v1","fear_custom","fire-custom-001","frost_custom_1","gravity_custom_1","hate-custom-001","ice_custom","life_custom_1","light_custom_1","love_custom_v1","luck-custom-001","metal_custom_1","mirror-custom-001","peace-custom-001","plague-custom-001","psychic_custom_v1","smoke-custom-001","speed_custom_1","spirit_custom_1","time-custom-001","war-custom-001","water_custom_1"],Jr=a=>f0.includes(a.id),h0=(a,t)=>{const l=(i,d)=>{i=i.replace("#","");const f=parseInt(i.substring(0,2),16),p=parseInt(i.substring(2,4),16),u=parseInt(i.substring(4,6),16);return`rgba(${f}, ${p}, ${u}, ${d})`},c={borderColor:t};switch(a){case"solid":return{...c,backgroundColor:t};case"radial":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`radial-gradient(circle at 50% 50%, ${l(t,.25)} 0%, transparent 60%)`};case"dual-radial":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 0% 0%, ${l(t,.2)}, transparent 50%),
                    radial-gradient(at 100% 100%, ${l(t,.2)}, transparent 50%)
                `};case"multi-radial":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 0%, ${l(t,.2)}, transparent 70%),
                    radial-gradient(circle at 20% 30%, ${l(t,.15)}, transparent 40%),
                    radial-gradient(circle at 80% 70%, ${l(t,.2)}, transparent 50%)
                `};case"chaos":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 10% 10%, hsla(60, 100%, 50%, 0.15), transparent 30%),
                    radial-gradient(at 90% 20%, hsla(180, 100%, 50%, 0.15), transparent 35%),
                    radial-gradient(at 30% 80%, hsla(300, 100%, 50%, 0.15), transparent 40%),
                    radial-gradient(at 70% 60%, hsla(0, 100%, 50%, 0.1), transparent 25%)
                `};case"grid":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(circle at 50% 50%, ${l(t,.2)} 0%, transparent 40%),
                    linear-gradient(hsla(0,0%,100%,0.03) 1px, transparent 1px),
                    linear-gradient(90deg, hsla(0,0%,100%,0.03) 1px, transparent 1px)
                `,backgroundSize:"100% 100%, 20px 20px, 20px 20px"};case"diagonal-lines":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 0% 100%, ${l(t,.25)}, transparent 70%),
                    repeating-linear-gradient(120deg, transparent, transparent 15px, ${l(t,.05)} 15px, ${l(t,.05)} 30px)
                `};case"cross-diagonal":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 50%, ${l(t,.25)} 0%, transparent 50%),
                    repeating-linear-gradient(45deg, transparent, transparent 8px, ${l(t,.08)} 8px, ${l(t,.08)} 16px),
                    repeating-linear-gradient(-45deg, transparent, transparent 8px, ${l(t,.06)} 8px, ${l(t,.06)} 16px)
                `};case"horizontal-lines":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 80% 80%, ${l(t,.1)}, transparent 50%),
                    repeating-linear-gradient(0deg, hsla(0,0%,100%,0.02), hsla(0,0%,100%,0.02) 1px, transparent 1px, transparent 3px)
                `};case"vertical-lines":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 10% 10%, ${l(t,.2)}, transparent 50%),
                    repeating-linear-gradient(175deg, transparent, transparent 1px, ${l(t,.05)} 1px, ${l(t,.05)} 2px)
                `};case"cross":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    linear-gradient(0deg, transparent 40%, ${l(t,.1)} 50%, transparent 60%),
                    linear-gradient(90deg, transparent 48%, ${l(t,.2)} 50%, transparent 52%)
                `};case"hexagons":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 0%, ${l(t,.2)}, transparent 70%),
                    url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='28' height='49' viewBox='0 0 28 49'%3E%3Cg fill-rule='evenodd'%3E%3Cg id='hexagons' fill='${encodeURIComponent(t)}' fill-opacity='0.05' fill-rule='nonzero'%3E%3Cpath d='M13.99 9.25l13 7.5v15l-13 7.5L1 31.75v-15l12.99-7.5zM3 17.9v12.7l10.99 6.34 11-6.35V17.9l-11-6.34L3 17.9zM0 15l12.99-7.5L26 15v18.5l-13 7.5L0 33.5V15z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")
                `};case"stripes":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 100%, ${l(t,.25)}, transparent 60%),
                    linear-gradient(135deg, hsla(0,0%,0%,0.1) 23%, transparent 23%, transparent 25%, hsla(0,0%,0%,0.1) 25%, hsla(0,0%,0%,0.1) 27%, transparent 27%, transparent 73%, hsla(0,0%,0%,0.1) 73%, hsla(0,0%,0%,0.1) 75%, transparent 75%, transparent 77%, hsla(0,0%,0%,0.1) 77%)
                `};default:return{...c,backgroundColor:t}}},m0=({protocols:a,onCreateNew:t,onEdit:l,onDelete:c,onImport:i,onBack:d})=>{const[f,p]=le.useState(!1),[u,h]=le.useState(!1),[y,g]=le.useState(""),[_,x]=le.useState(""),S=f?a:a.filter(b=>!Jr(b)),E=()=>{x("");try{const b=JSON.parse(y);if(!b.name||!b.color||!b.pattern||!Array.isArray(b.cards)){x("Invalid protocol format. Missing required fields.");return}if(b.cards.length!==6){x("Invalid protocol: must have exactly 6 cards.");return}const j=a.find(C=>C.name.toLowerCase()===b.name.toLowerCase());if(j){confirm(`A protocol named "${b.name}" already exists. Overwrite it?`)&&(b.id=j.id,i(b),h(!1),g(""),alert("Protocol imported and overwritten successfully!"));return}b.id=Date.now().toString(),b.createdAt=new Date().toISOString(),i(b),h(!1),g(""),alert("Protocol imported successfully!")}catch{x("Invalid JSON format. Please check your input.")}};return o.jsxs("div",{className:"protocol-list",children:[o.jsxs("div",{className:"list-header",children:[o.jsx("h2",{children:"Custom Protocols"}),o.jsxs("div",{className:"header-actions",children:[o.jsxs("label",{className:"system-protocols-toggle",children:[o.jsx("input",{type:"checkbox",checked:f,onChange:b=>p(b.target.checked)}),"Show System Protocols"]}),o.jsx("button",{onClick:()=>h(!0),className:"btn",children:"Import Protocol"}),d&&o.jsx("button",{onClick:d,className:"btn btn-back",children:"Back"})]})]}),u&&o.jsx("div",{className:"custom-protocol-modal-overlay",onClick:()=>h(!1),children:o.jsxs("div",{className:"custom-protocol-modal-content",onClick:b=>b.stopPropagation(),children:[o.jsx("h3",{children:"Import Protocol"}),o.jsx("p",{children:"Paste the protocol JSON below:"}),o.jsx("textarea",{value:y,onChange:b=>g(b.target.value),placeholder:'{"name":"Protocol Name","color":"#1976D2",...}',rows:10,className:"import-textarea"}),_&&o.jsx("div",{className:"error-message",children:_}),o.jsxs("div",{className:"custom-protocol-modal-actions",children:[o.jsx("button",{onClick:()=>h(!1),className:"btn btn-back",children:"Cancel"}),o.jsx("button",{onClick:E,className:"btn",children:"Import"})]})]})}),o.jsxs("div",{className:"protocols-grid",children:[o.jsxs("div",{className:"protocol-card new-protocol-card",onClick:t,children:[o.jsx("div",{className:"protocol-header new-protocol-header",children:o.jsxs("div",{className:"protocol-header-content",children:[o.jsx("h3",{children:"+ New Protocol"}),o.jsx("p",{className:"header-description",children:"Create a custom protocol"})]})}),o.jsx("div",{className:"protocol-body new-protocol-body"})]}),S.map(b=>{const j=Jr(b);return o.jsx("div",{className:`protocol-card ${j?"system-protocol":""}`,style:h0(b.pattern,b.color),onClick:()=>l(b),children:o.jsxs("div",{className:"protocol-header-content",children:[o.jsx("h3",{children:b.name}),j&&o.jsx("span",{className:"system-badge",children:"System"}),b.description&&o.jsx("p",{className:"header-description",children:b.description})]})},b.id)})]})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const vm="customProtocolsEnabled";function Xd(){try{return localStorage.getItem(vm)==="true"}catch{return!1}}function y0(a){try{localStorage.setItem(vm,a?"true":"false")}catch{}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */let vc=null;function g0(){if(!vc){const a=Xd(),t=Po(),l=pr(),c=new Set(l.filter(i=>Jr(i)).map(i=>i.name));vc=t.filter(i=>c.has(i.protocol)||a)}return vc}function Ql(){vc=null}function Ja(a){const t=g0(),l=[];for(const c of a){const i=t.filter(d=>d.protocol===c);l.push(...i)}return l}function In(a){const t=[...a];for(let l=t.length-1;l>0;l--){const c=Math.floor(Math.random()*(l+1));[t[l],t[c]]=[t[c],t[l]]}return t}function Wh({onNavigate:a,difficulty:t,setDifficulty:l,useControl:c,onUseControlChange:i}){const[d,f]=le.useState(null),[p,u]=le.useState(null),[h,y]=le.useState(null),[g,_]=le.useState([]),[x,S]=le.useState(!0),[E,b]=le.useState(0);le.useEffect(()=>{const C=new Set;for(;C.size<2&&C.size<Ln.length;)C.add(Math.floor(Math.random()*Ln.length));const R=Array.from(C).map(A=>Ln[A]);R.length>0&&(y(R[0]),u(R[0])),R.length>1&&f(R[1]),_(In(Ln))},[]);const j=()=>{const C=E+1;if(b(C),C>=5){const R=!x;S(R),y0(R),b(0)}};return o.jsxs("div",{className:"screen main-menu",children:[o.jsx("h1",{children:"COMPILE: MAIN 1"}),o.jsxs("div",{className:"main-menu-attribution",children:[o.jsxs("p",{children:["based on the card game ",o.jsx("a",{href:"https://boardgamegeek.com/boardgame/406652/compile-main-1",target:"_blank",rel:"noopener noreferrer",children:"Compile: Main 1"})," designed by ",o.jsx("a",{href:"https://justgravyllc.com/",target:"_blank",rel:"noopener noreferrer",children:"Michael Yang"})]}),o.jsxs("p",{children:[o.jsx("span",{onClick:j,style:{cursor:"default",userSelect:"none"},children:"developed"})," by ",o.jsx("a",{href:"https://apo-games.de/",target:"_blank",rel:"noopener noreferrer",children:"Dirk Aporius"})]})]}),o.jsxs("div",{className:"main-menu-layout",children:[o.jsx("div",{className:"main-menu-preview decorative-card",children:p&&o.jsx(xt,{card:{...p,id:"preview",isFaceUp:!0},isFaceUp:!0})}),o.jsxs("div",{className:"main-menu-actions-container",children:[o.jsxs("div",{className:"main-menu-start-group",children:[o.jsxs("div",{className:"difficulty-selector",children:[o.jsx("h3",{className:"difficulty-title",children:"Difficulty"}),o.jsxs("div",{className:"difficulty-options",children:[o.jsx("button",{className:`btn ${t==="easy"?"active":""}`,onClick:()=>l("easy"),children:"Easy"}),o.jsx("button",{className:`btn ${t==="normal"?"active":""}`,onClick:()=>l("normal"),children:"Normal"}),o.jsx("button",{className:`btn btn-wip ${t==="hard"?"active":""}`,disabled:!0,children:"Hard"})]})]}),o.jsxs("div",{className:"control-mechanic-selector",children:[o.jsx("input",{type:"checkbox",id:"control-mechanic",checked:c,onChange:C=>i(C.target.checked)}),o.jsx("label",{htmlFor:"control-mechanic",children:"Use Control Mechanic"})]}),o.jsx("button",{className:"btn btn-start",onClick:()=>a("ProtocolSelection"),children:"Start Game"})]}),o.jsxs("div",{className:"main-menu-other-actions",children:[o.jsx("button",{className:"btn",onClick:()=>a("CardLibrary"),children:"Cards"}),o.jsx("button",{className:"btn",onClick:()=>a("Statistics"),children:"Statistics"}),x&&o.jsx("button",{className:"btn",onClick:()=>a("CustomProtocols"),children:"Custom Protocols"}),o.jsx("button",{className:"btn",onClick:()=>a("Rules"),children:"Rules"}),o.jsx("p",{className:"version-info",children:"Version 0.26"})]})]}),o.jsx("div",{className:"decorative-card decorative-card-right",children:d&&o.jsx(xt,{card:{...d,id:"deco-2",isFaceUp:!0},isFaceUp:!0})})]}),o.jsx("div",{className:"card-ticker-container",onPointerLeave:()=>u(h),children:o.jsxs("div",{className:"card-ticker-track",children:[g.map((C,R)=>o.jsx(xt,{card:{...C,id:`ticker-1-${R}`,isFaceUp:!0},isFaceUp:!0,additionalClassName:"in-hand",onPointerEnter:()=>u(C)},`ticker-1-${R}`)),g.map((C,R)=>o.jsx(xt,{card:{...C,id:`ticker-2-${R}`,isFaceUp:!0},isFaceUp:!0,additionalClassName:"in-hand",onPointerEnter:()=>u(C)},`ticker-2-${R}`))]})})]})}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function bc({title:a,onBack:t}){return o.jsxs("header",{className:"app-header",children:[o.jsx("h2",{children:a}),t&&o.jsx("button",{className:"btn btn-back",onClick:t,children:"Back"})]})}const hc=[{player:"Player",picks:1},{player:"Opponent",picks:2},{player:"Player",picks:2},{player:"Opponent",picks:1}];function v0({onBack:a,onStartGame:t}){const[l,c]=le.useState(0),[i,d]=le.useState([]),[f,p]=le.useState([]),[u,h]=le.useState([]),[y,g]=le.useState(!1),[_,x]=le.useState(null),[S,E]=le.useState(null),[b,j]=le.useState(0);le.useEffect(()=>{Ql(),j(Q=>Q+1)},[]);const C=le.useMemo(()=>{const Q=Xd(),V=Po(),J=pr(),me=new Set(J.filter(Y=>Jr(Y)).map(Y=>Y.name)),ge=V.filter(Y=>me.has(Y.protocol)||Q);return console.log("[Protocol Selection] Total cards loaded:",ge.length,"(custom enabled:",Q,")"),ge},[b]),R=le.useMemo(()=>{const Q=new Set(C.map(J=>J.protocol)),V=Array.from(Q).sort();return console.log("[Protocol Selection] Unique protocols:",V),V},[C]),A=le.useMemo(()=>{const Q=new Set(C.map(V=>V.category));return Array.from(Q).sort()},[C]),I=["Fan-Content","Main 2"],[U,$]=le.useState(new Set),[Z,ee]=le.useState(!1);le.useEffect(()=>{if(A.length>0&&!Z){const Q=new Set(A);I.forEach(V=>Q.delete(V)),$(Q),ee(!0)}},[A,Z]);const z=Q=>{const V=C.find(J=>J.protocol===Q);return(V==null?void 0:V.category)||""},O=Q=>{const J=C.find(me=>me.protocol===Q);return J!=null&&J.color?{"--card-custom-color":J.color,borderColor:J.color}:{}},k=Q=>{const J=C.find(me=>me.protocol===Q);return J!=null&&J.pattern?`pattern-${J.pattern}`:""},q=le.useMemo(()=>R.filter(Q=>{const V=z(Q);return U.has(V)}),[U]),F=Q=>{$(V=>{const J=new Set(V);return J.has(Q)?J.delete(Q):J.add(Q),J})},D=hc[l],T=(D==null?void 0:D.player)==="Player",L=(D==null?void 0:D.player)==="Opponent",B=le.useMemo(()=>new Set([...i,...f]),[i,f]),G=le.useMemo(()=>u.map(Q=>({name:Q,cards:C.filter(V=>V.protocol===Q).sort((V,J)=>V.value-J.value)})),[u]),ae=Q=>{if(!T||y)return;const V=C.filter(J=>J.protocol===Q).sort((J,me)=>J.value-me.value);V.length>0&&E(V[0]),h(J=>{if(J.includes(Q))return J.filter(me=>me!==Q);if(J.length<D.picks)return[...J,Q];if(J.length===D.picks){const me=J.slice(1);return me.push(Q),me}return J})},M=async()=>{if(!T||y||u.length!==D.picks)return;g(!0);const Q=[...u];h([]);for(const V of Q)d(J=>[...J,V]),await new Promise(J=>setTimeout(J,300));g(!1),c(V=>V+1)};le.useEffect(()=>{L&&!y&&l<hc.length&&(async()=>{g(!0),await new Promise(X=>setTimeout(X,100));const V=[],J=R.filter(X=>{if(B.has(X))return!1;const se=z(X);return U.has(se)}),me=R.filter(X=>!B.has(X)),ge=J.length>=D.picks?[...J]:[...me],Y=[],K=V.filter(X=>ge.includes(X));for(let X=0;X<D.picks;X++)if(K.length>0){const se=K.shift();Y.push(se);const ie=ge.indexOf(se);ie>-1&&ge.splice(ie,1)}else if(ge.length>0){const se=Math.floor(Math.random()*ge.length);Y.push(ge.splice(se,1)[0])}for(const X of Y)await new Promise(se=>setTimeout(se,1e3)),x(X),await new Promise(se=>setTimeout(se,1e3)),x(null),p(se=>[...se,X]);g(!1),c(X=>X+1)})()},[l,L,y,B,D,U,R,z]),le.useEffect(()=>{l>=hc.length&&!y&&setTimeout(()=>{t(i,f)},1e3)},[l,y,t,i,f]);const W=Q=>{const V=["protocol-card",`card-protocol-${Q.toLowerCase()}`];return u.includes(Q)&&V.push("selected"),B.has(Q)&&V.push("chosen"),_===Q&&V.push("is-scanning"),V.join(" ")},oe=()=>y&&L?"Opponent is selecting protocols...":(D==null?void 0:D.player)==="Player"?`Player, select ${D.picks} protocol(s). (${u.length}/${D.picks})`:l>=hc.length?"Finalizing selections...":"Waiting for Opponent...";return o.jsxs("div",{className:"screen protocol-selection-screen",children:[o.jsx(bc,{title:"Protocol Selection",onBack:a}),o.jsxs("div",{className:"protocol-selection-layout",children:[o.jsxs("div",{className:"protocol-selection-sidebar",children:[o.jsxs("div",{className:"player-protocols-area",children:[o.jsx("h3",{children:"Your Protocols"}),i.map(Q=>o.jsx("div",{className:`protocol-display-card player card-protocol-${Q.toLowerCase()} ${k(Q)}`,style:O(Q),children:Q},Q))]}),o.jsx("div",{className:"protocol-preview-area",children:S?o.jsx(xt,{card:{...S,id:"preview",isFaceUp:!0},isFaceUp:!0}):o.jsx("p",{children:G.length>0?"Hover over a card below to see details.":"Select a protocol to see its cards."})})]}),o.jsxs("div",{className:"protocol-grid-container",children:[o.jsx("p",{children:oe()}),o.jsx("div",{className:"category-filters",children:A.map(Q=>o.jsxs("label",{className:"category-filter-item",children:[o.jsx("input",{type:"checkbox",checked:U.has(Q),onChange:()=>F(Q)}),o.jsx("span",{children:Q})]},Q))}),o.jsx("div",{className:"protocol-grid-scroll-wrapper",children:o.jsx("div",{className:"protocol-grid",children:q.map(Q=>{const V=O(Q),me={fontSize:Q.length>10?"0.65em":"1em"};return o.jsxs("div",{className:`${W(Q)} ${k(Q)}`,style:V,onClick:()=>ae(Q),role:"button","aria-disabled":B.has(Q)||!T||y,tabIndex:!B.has(Q)&&T&&!y?0:-1,onKeyPress:ge=>ge.key==="Enter"&&ae(Q),children:[o.jsx("span",{className:"protocol-category-label",children:z(Q)}),o.jsx("span",{className:"protocol-name",style:me,children:Q})]},Q)})})}),T&&o.jsx("button",{className:"btn",onClick:M,disabled:y||u.length!==(D==null?void 0:D.picks),children:"Confirm Selection"})]}),o.jsxs("div",{className:"opponent-protocols-area",children:[o.jsx("h3",{children:"Opponent Protocols"}),f.map(Q=>o.jsx("div",{className:`protocol-display-card opponent card-protocol-${Q.toLowerCase()} ${k(Q)}`,style:O(Q),children:Q},Q))]})]}),o.jsx("div",{className:"selected-protocol-cards-container",children:G.length>0&&[...G].reverse().map(Q=>o.jsx("div",{className:"protocol-card-row",children:Q.cards.map(V=>o.jsx(xt,{card:{...V,id:`selection-${V.protocol}-${V.value}`,isFaceUp:!0},isFaceUp:!0,additionalClassName:"in-hand",onClick:()=>E(V),onPointerEnter:()=>E(V)},`${Q.name}-${V.value}`))},Q.name))})]})}const _0="modulepreload",w0=function(a){return"/"+a},Qh={},x0=function(t,l,c){let i=Promise.resolve();if(l&&l.length>0){let f=function(h){return Promise.all(h.map(y=>Promise.resolve(y).then(g=>({status:"fulfilled",value:g}),g=>({status:"rejected",reason:g}))))};document.getElementsByTagName("link");const p=document.querySelector("meta[property=csp-nonce]"),u=(p==null?void 0:p.nonce)||(p==null?void 0:p.getAttribute("nonce"));i=f(l.map(h=>{if(h=w0(h),h in Qh)return;Qh[h]=!0;const y=h.endsWith(".css"),g=y?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${g}`))return;const _=document.createElement("link");if(_.rel=y?"stylesheet":_0,y||(_.as="script"),_.crossOrigin="",_.href=h,u&&_.setAttribute("nonce",u),document.head.appendChild(_),y)return new Promise((x,S)=>{_.addEventListener("load",x),_.addEventListener("error",()=>S(new Error(`Unable to preload CSS for ${h}`)))})}))}function d(f){const p=new Event("vite:preloadError",{cancelable:!0});if(p.payload=f,window.dispatchEvent(p),!p.defaultPrevented)throw f}return i.then(f=>{for(const p of f||[])p.status==="rejected"&&d(p.reason);return t().catch(d)})},sn=[];for(let a=0;a<256;++a)sn.push((a+256).toString(16).slice(1));function C0(a,t=0){return(sn[a[t+0]]+sn[a[t+1]]+sn[a[t+2]]+sn[a[t+3]]+"-"+sn[a[t+4]]+sn[a[t+5]]+"-"+sn[a[t+6]]+sn[a[t+7]]+"-"+sn[a[t+8]]+sn[a[t+9]]+"-"+sn[a[t+10]]+sn[a[t+11]]+sn[a[t+12]]+sn[a[t+13]]+sn[a[t+14]]+sn[a[t+15]]).toLowerCase()}let Ad;const S0=new Uint8Array(16);function b0(){if(!Ad){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Ad=crypto.getRandomValues.bind(crypto)}return Ad(S0)}const E0=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Xh={randomUUID:E0};function ot(a,t,l){var i;if(Xh.randomUUID&&!a)return Xh.randomUUID();a=a||{};const c=a.random??((i=a.rng)==null?void 0:i.call(a))??b0();if(c.length<16)throw new Error("Random bytes length must be >= 16");return c[6]=c[6]&15|64,c[8]=c[8]&63|128,C0(c)}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const ne=(a,t,l,c)=>{let i=a._logIndentLevel||0;a._currentPhaseContext&&i===0&&(i=1);const d={player:t,message:l,indentLevel:i,sourceCard:a._currentEffectSource,phase:a._currentPhaseContext,sourceCardRef:c==null?void 0:c.sourceCardRef,targetCardRefs:c==null?void 0:c.targetCardRefs};return{...a,log:[...a.log,d]}},Ra=a=>({...a,_logIndentLevel:(a._logIndentLevel||0)+1}),$o=a=>({...a,_logIndentLevel:Math.max(0,(a._logIndentLevel||0)-1)}),We=(a,t)=>({...a,_currentEffectSource:t}),Ke=(a,t)=>({...a,_currentPhaseContext:t});/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function bn(a){const t=[];for(const l of["player","opponent"])a[l].lanes.forEach((c,i)=>{c.forEach((d,f)=>{if(d.isFaceUp){const p=d;if(p.customEffects){const u=f===c.length-1;(p.customEffects.topEffects||[]).forEach(g=>{g.params.action==="passive_rule"&&g.trigger==="passive"&&t.push({rule:g.params.rule,cardOwner:l,laneIndex:i,sourceCardId:d.id})}),(p.customEffects.middleEffects||[]).forEach(g=>{g.params.action==="passive_rule"&&g.trigger==="passive"&&t.push({rule:g.params.rule,cardOwner:l,laneIndex:i,sourceCardId:d.id})}),u&&(p.customEffects.bottomEffects||[]).forEach(_=>{_.params.action==="passive_rule"&&_.trigger==="passive"&&t.push({rule:_.params.rule,cardOwner:l,laneIndex:i,sourceCardId:d.id})})}d.protocol==="Frost"&&d.value===1&&(t.push({rule:{type:"block_flips",target:"all",scope:"global"},cardOwner:l,laneIndex:i}),f===c.length-1&&t.push({rule:{type:"block_protocol_rearrange",target:"all",scope:"global"},cardOwner:l,laneIndex:i})),d.protocol==="Frost"&&d.value===3&&t.push({rule:{type:"block_shifts_from_and_to_lane",target:"all",scope:"this_lane"},cardOwner:l,laneIndex:i})}})});return t}function eo(a,t,l,c,i,d){var S,E,b;const f=bn(a),p=t==="player"?"opponent":"player",u=a[t].protocols[l],h=a[p].protocols[l],y=i===u||i===h;let g=!1;if(d){const j=d;g=[...((S=j.customEffects)==null?void 0:S.topEffects)||[],...((E=j.customEffects)==null?void 0:E.middleEffects)||[],...((b=j.customEffects)==null?void 0:b.bottomEffects)||[]].some(R=>{var A,I,U;return((A=R.params)==null?void 0:A.action)==="passive_rule"&&((U=(I=R.params)==null?void 0:I.rule)==null?void 0:U.type)==="allow_play_on_opponent_side"})}for(const{rule:j,cardOwner:C,laneIndex:R}of f){const A=j.scope==="global"||R===l,I=j.target==="all"||j.target==="self"&&C===t||j.target==="opponent"&&C===p;if(!(!A||!I))switch(j.type){case"block_all_play":return{allowed:!1,reason:"Cannot play cards in this lane (passive rule)"};case"block_face_down_play":if(!c)return{allowed:!1,reason:"Cannot play cards face-down in this lane (passive rule)"};break;case"block_face_up_play":if(c)return{allowed:!1,reason:"Cannot play cards face-up in this lane (passive rule)"};break;case"require_face_down_play":if(c)return{allowed:!1,reason:"Can only play cards face-down (passive rule)"};break;case"allow_any_protocol_play":break;case"require_non_matching_protocol":if(c&&y)return{allowed:!1,reason:"Can only play cards without matching protocols (passive rule)"};break}}const _=f.some(({rule:j,cardOwner:C,laneIndex:R})=>{if(j.type!=="allow_any_protocol_play")return!1;const A=j.scope==="global"||R===l,I=j.target==="all"||j.target==="self"&&C===t||j.target==="opponent"&&C===p;return A&&I}),x=f.some(({rule:j,cardOwner:C,laneIndex:R})=>{if(j.type!=="require_non_matching_protocol")return!1;const A=j.scope==="global"||R===l,I=j.target==="all"||j.target==="self"&&C===t||j.target==="opponent"&&C===p;return A&&I});return c&&!y&&!_&&!x&&!g?{allowed:!1,reason:"Face-up play requires matching protocol"}:{allowed:!0}}function Ec(a){return bn(a).some(({rule:l})=>l.type==="require_non_matching_protocol"&&l.scope==="global")}function ts(a,t,l){const c=bn(a),i=t==="player"?"opponent":"player";return c.some(({rule:d,cardOwner:f,laneIndex:p})=>{if(d.type!=="allow_any_protocol_play")return!1;const u=d.scope==="global"||l!==void 0&&p===l,h=d.target==="all"||d.target==="self"&&f===t||d.target==="opponent"&&f===i;return u&&h})}function Kl(a,t){const l=t.customEffects;return l?(l.bottomEffects||[]).some(i=>{var d,f,p;return((d=i.params)==null?void 0:d.action)!=="passive_rule"?!1:((p=(f=i.params)==null?void 0:f.rule)==null?void 0:p.type)==="allow_play_on_opponent_side"}):!1}function j0(a,t){const l=bn(a);for(const{rule:c,laneIndex:i}of l)if(!(c.type!=="block_flips"||!(c.scope==="global"||i===t)))return{allowed:!1,reason:"Cards cannot be flipped face-up in this lane (passive rule)"};return{allowed:!0}}function Jl(a,t,l){const c=bn(a);for(const{rule:i,laneIndex:d}of c){if(i.type==="block_shifts_from_lane"&&d===t)return i.scope,{allowed:!1,reason:"Cards cannot shift from this lane (passive rule)"};if(i.type==="block_shifts_to_lane"&&d===l)return i.scope,{allowed:!1,reason:"Cards cannot shift to this lane (passive rule)"};if(i.type==="block_shifts_from_and_to_lane"&&(d===t||d===l))return{allowed:!1,reason:"Cards cannot shift from or to this lane (passive rule)"}}return{allowed:!0}}function k0(a){const t=bn(a);for(const{rule:l}of t)if(l.type==="block_protocol_rearrange")return{allowed:!1,reason:"Protocols cannot be rearranged (passive rule)"};return{allowed:!0}}function R0(a,t,l){const c=bn(a),i=a.turn;for(const{rule:d,cardOwner:f,laneIndex:p,sourceCardId:u}of c)if(!(d.type!=="ignore_middle_commands"||!(d.scope==="global"||p===t))&&!(d.onlyDuringYourTurn&&i!==f)){if(l!==void 0){const y=f==="player"?"opponent":"player";if(d.target==="opponent"&&l!==y||d.target==="self"&&l!==f)continue}if(u)for(const y of["player","opponent"])for(const g of a[y].lanes){const _=g.find(x=>x.id===u);if(_)return _}return null}return null}function ka(a){return bn(a).some(({rule:l})=>l.type==="block_flips"&&l.scope==="global")}function N0(a){return bn(a).some(({rule:l})=>l.type==="block_protocol_rearrange")}function Xl(a,t){const l=bn(a);for(const{rule:c,sourceCardId:i}of l)if(c.type==="block_flip_this_card"&&i===t)return{allowed:!1,reason:"This card cannot be flipped (passive rule)"};return{allowed:!0}}function Zd(a,t){const l=bn(a);for(const{rule:c,cardOwner:i}of l)if(c.type==="block_draw_conditional"){const f=(c.conditionTarget||"self")==="self"?i:i==="player"?"opponent":"player",p=c.blockTarget||"self";let u;if(p==="self"?u=i:p==="opponent"?u=i==="player"?"opponent":"player":u="all",a[f].hand.length>0&&(u==="all"||u===t))return{allowed:!1,reason:"Cannot draw cards (passive rule)"}}return{allowed:!0}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const T0={},A0={},D0={},F0={};function ol(a,t,l,c){const{cardOwner:i,opponent:d,triggerType:f}=c,p=l[i].lanes[t];if(!p.find(S=>S.id===a.id))return{newState:l};if(!(f==="uncover"||p.length>0&&p[p.length-1].id===a.id))return{newState:l};const y=R0(l,t,i);if(y){const S=`${a.protocol}-${a.value}`,E=`${y.protocol}-${y.value}`;return{newState:ne(l,i,`${S}: Effect blocked by ${E}.`)}}if(l.skipNextMiddleCommand===a.id){const S=`${a.protocol}-${a.value}`;let E={...l};return delete E.skipNextMiddleCommand,E=ne(E,i,`${S}: Middle commands ignored.`),{newState:E}}const g=a;if(g.customEffects&&g.customEffects.middleEffects&&g.customEffects.middleEffects.length>0){let S=Ra(l);const E=`${a.protocol}-${a.value}`;S=We(S,E),S=Ke(S,"middle");let b=S;const j=b._pendingCustomEffects;if(j&&j.sourceCardId!==a.id){const A=b.lastCustomEffectTargetCardId,I={type:"execute_remaining_custom_effects",sourceCardId:j.sourceCardId,laneIndex:j.laneIndex,effects:j.effects,context:j.context,actor:j.context.cardOwner,selectedCardFromPreviousEffect:A||j.selectedCardFromPreviousEffect,savedLastCustomEffectTargetCardId:b.lastCustomEffectTargetCardId,logSource:j.logSource,logPhase:j.logPhase,logIndentLevel:j.logIndentLevel},U=b._deferredParentEffects||[];b={...b,_deferredParentEffects:[...U,I]},delete b._pendingCustomEffects}b.lastCustomEffectTargetCardId&&(b={...b,lastCustomEffectTargetCardId:null});for(let A=0;A<g.customEffects.middleEffects.length;A++){const I=g.customEffects.middleEffects[A],U=g.customEffects.middleEffects.slice(A+1),$=U.length>0;if($&&(b._pendingCustomEffects={sourceCardId:a.id,laneIndex:t,context:c,effects:U,logSource:b._currentEffectSource,logPhase:b._currentPhaseContext,logIndentLevel:b._logIndentLevel||0}),b=st(a,t,b,c,I).newState,b.actionRequired)return{newState:Ee(b)};const ee=b._pendingCustomEffects;ee&&$&&ee.sourceCardId===a.id&&delete b._pendingCustomEffects}const C=b._deferredParentEffects;if(C&&C.length>0){const A=C[C.length-1],I=C.slice(0,-1);b={...b,_deferredParentEffects:I.length>0?I:void 0,lastCustomEffectTargetCardId:A.savedLastCustomEffectTargetCardId||A.selectedCardFromPreviousEffect,_pendingCustomEffects:{sourceCardId:A.sourceCardId,laneIndex:A.laneIndex,context:A.context,effects:A.effects,selectedCardFromPreviousEffect:A.selectedCardFromPreviousEffect,logSource:A.logSource,logPhase:A.logPhase,logIndentLevel:A.logIndentLevel}}}return{newState:Ee(b)}}const _=`${a.protocol}-${a.value}`,x=T0[_];if(x){let S=Ra(l);const E=`${a.protocol}-${a.value}`;S=We(S,E),S=Ke(S,"middle");const b=x(a,t,S,c);let j=b.newState;const C=Ee(j);return{...b,newState:C}}return{newState:l}}function Kd(a,t,l,c){if(!a.isFaceUp)return{newState:l};const i=a;if(i.customEffects){const u=[...i.customEffects.topEffects||[],...i.customEffects.middleEffects||[],...i.customEffects.bottomEffects||[]].filter(h=>h.trigger==="on_cover"||h.trigger==="on_cover_or_flip");if(u.length>0){const h=`${a.protocol}-${a.value}`;let y=We(l,h);y=Ke(y,"oncover");let g=y;const _=[];for(const S of u){const E=st(a,t,g,c,S);if(g=E.newState,E.animationRequests&&_.push(...E.animationRequests),g.actionRequired)return{newState:Ee(g),animationRequests:_.length>0?_:void 0}}return{newState:Ee(g),animationRequests:_.length>0?_:void 0}}}const d=`${a.protocol}-${a.value}`,f=F0[d];if(f){const p=`${a.protocol}-${a.value}`;let u=We(l,p);u=Ke(u,"oncover");const h=f(a,t,u,c),y=Ee(h.newState);return{...h,newState:y}}return{newState:l}}function q0(a,t,l){const c=[],i=new Set,d=l==="Start"?"start":"end";return a[t].lanes.flat().forEach(f=>{var u;if(!f.isFaceUp||i.has(f.id))return;const p=f;if((u=p.customEffects)!=null&&u.topEffects){const h=p.customEffects.topEffects.filter(y=>y.trigger===d);h.length>0&&(c.push({cardId:f.id,box:"top",effectIds:h.map(y=>y.id)}),i.add(f.id))}f.top.includes(`'emphasis'>${l}:`)&&(i.has(f.id)||(c.push({cardId:f.id,box:"top",effectIds:[]}),i.add(f.id)))}),a[t].lanes.forEach(f=>{var h;if(f.length===0)return;const p=f[f.length-1];if(!p.isFaceUp||i.has(p.id))return;const u=p;if((h=u.customEffects)!=null&&h.bottomEffects){const y=u.customEffects.bottomEffects.filter(g=>g.trigger===d);y.length>0&&(c.push({cardId:p.id,box:"bottom",effectIds:y.map(g=>g.id)}),i.add(p.id))}p.bottom.includes(`'emphasis'>${l}:`)&&(i.has(p.id)||(c.push({cardId:p.id,box:"bottom",effectIds:[]}),i.add(p.id)))}),c}function $0(a,t,l){for(let c=0;c<a[t].lanes.length;c++){const i=a[t].lanes[c],d=i.find(f=>f.id===l.cardId);if(d)return!d.isFaceUp||l.box==="bottom"&&!(i.length>0&&i[i.length-1].id===d.id)?null:{card:d,laneIndex:c}}return null}function I0(a,t,l){const c=a,i=l==="Start"?"start":"end";if(c.customEffects){const p=t==="top"?c.customEffects.topEffects:c.customEffects.bottomEffects,u=(p==null?void 0:p.filter(h=>h.trigger===i))||[];if(u.length>0)return u.map(y=>{var x,S;const g=((x=y.params)==null?void 0:x.action)||"effect",_=(S=y.params)==null?void 0:S.count;return _?`${g} ${_}`:g}).join(", ")}const f=(t==="top"?a.top:a.bottom).match(new RegExp(`${l}:\\s*</span>\\s*([^<]+)`,"i"));return f?f[1].trim():l+" effect"}function wc(a,t,l){const c=a.turn;let i={...a,_logIndentLevel:0};const d=t==="Start",f=d?"_startPhaseEffectSnapshot":"_endPhaseEffectSnapshot",p=d?"_selectedStartEffectId":"_selectedEndEffectId",u=i[p];let h=i[f];h&&h.length>0&&(h.some($=>i[c].lanes.flat().some(Z=>Z.id===$.cardId))||(h=void 0,i[f]=void 0)),h||(h=q0(i,c,t),i[f]=h);const y=d?i.processedStartEffectIds||[]:i.processedEndEffectIds||[],g=[];for(const U of h){if(y.includes(U.cardId))continue;const Z=$0(i,c,U);Z&&g.push({entry:U,card:Z.card,laneIndex:Z.laneIndex})}if(g.length===0)return i[f]=void 0,i[p]=void 0,{newState:i};let _;if(u&&(_=g.find(U=>U.entry.cardId===u),_||console.warn(`[processTriggeredEffects] Selected effect ${u} not found in valid effects!`),i[p]=void 0),!_){if(g.length>1){const U=g.map(({entry:$,card:Z})=>({cardId:$.cardId,cardName:`${Z.protocol}-${Z.value}`,box:$.box,effectDescription:I0(Z,$.box,t)}));return i.actionRequired={type:"select_phase_effect",actor:c,phase:t,availableEffects:U},{newState:i}}_=g[0]}const{entry:x,card:S,laneIndex:E}=_,b=c==="player"?"opponent":"player",j={cardOwner:c,actor:c,currentTurn:a.turn,opponent:b,triggerType:t==="Start"?"start":"end"},C=S,R=t==="Start"?"start":"end";if(C.customEffects){const U=x.box==="top"?C.customEffects.topEffects:C.customEffects.bottomEffects,$=(U==null?void 0:U.filter(Z=>Z.trigger===R))||[];if($.length>0){const Z=`${S.protocol}-${S.value}`,ee=t==="Start"?"start":"end";i=We(i,Z),i=Ke(i,ee);const z={...i,_currentPhaseContext:void 0},O=ne(z,c,`${t} effect triggers.`);i={...i,log:O.log},i=Ra(i);for(let k=0;k<$.length;k++){const q=$[k],F=st(S,E,i,j,q);if(i=Ee(F.newState),i.actionRequired){const D=$.slice(k+1);return D.length>0&&(i._pendingCustomEffects={sourceCardId:S.id,laneIndex:E,context:j,effects:D,logSource:i._currentEffectSource,logPhase:i._currentPhaseContext,logIndentLevel:i._logIndentLevel||0}),d?i.processedStartEffectIds=[...i.processedStartEffectIds||[],S.id]:i.processedEndEffectIds=[...i.processedEndEffectIds||[],S.id],{newState:i}}}return d?i.processedStartEffectIds=[...i.processedStartEffectIds||[],S.id]:i.processedEndEffectIds=[...i.processedEndEffectIds||[],S.id],i=$o(i),i=We(i,void 0),i=Ke(i,void 0),wc(i,t,l)}}const A=`${S.protocol}-${S.value}`,I=l[A];if(I){const U=`${S.protocol}-${S.value}`,$=t==="Start"?"start":"end";i=We(i,U),i=Ke(i,$);const Z={...i,_currentPhaseContext:void 0},ee=ne(Z,c,`${t} effect triggers.`);i={...i,log:ee.log},i=Ra(i);const z=I(S,i,j);return i=Ee(z.newState),d?i.processedStartEffectIds=[...i.processedStartEffectIds||[],S.id]:i.processedEndEffectIds=[...i.processedEndEffectIds||[],S.id],i.actionRequired?{newState:i}:(i=$o(i),i=We(i,void 0),i=Ke(i,void 0),wc(i,t,l))}return{newState:i}}function Jd(a){return wc(a,"Start",A0)}function _m(a){return wc(a,"End",D0)}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const L0=a=>{if(!a.useControlMechanic)return a;const t=a.turn,l=t==="player"?"opponent":"player",c=a[t],i=a[l];let d=0;const f=c.laneValues[0],p=c.laneValues[1],u=c.laneValues[2],h=i.laneValues[0],y=i.laneValues[1],g=i.laneValues[2];if(f>h&&d++,p>y&&d++,u>g&&d++,d>=2&&a.controlCardHolder!==t){let _=We(a,void 0);return _=Ke(_,void 0),_={..._,_logIndentLevel:0},_=ne(_,t,`${t==="player"?"Player":"Opponent"} gains the Control Component.`),{..._,controlCardHolder:t}}return a},el=a=>{if(a.winner)return a;const t=a.turn;let l={...a};switch(l=We(l,void 0),l=Ke(l,void 0),l={...l,_logIndentLevel:0},a.phase){case"start":return l=Jd(l).newState,l.actionRequired?l:(l=We(l,void 0),l=Ke(l,void 0),l={...l,_logIndentLevel:0},l._startPhaseEffectSnapshot=void 0,{...l,phase:"control"});case"control":{const c=L0(l);let i=We(c,void 0);return i=Ke(i,void 0),i={...i,_logIndentLevel:0},{...i,phase:"compile"}}case"compile":{const c=Em(l,t);return c.length>0?{...l,compilableLanes:c}:(l=We(l,void 0),l=Ke(l,void 0),l={...l,_logIndentLevel:0},{...l,phase:"action",compilableLanes:[]})}case"action":return l=We(l,void 0),l=Ke(l,void 0),l={...l,_logIndentLevel:0},{...l,phase:"hand_limit"};case"hand_limit":{const c=l[t],i=c.lanes.some(p=>p.length>0&&p[p.length-1].isFaceUp&&p[p.length-1].protocol==="Spirit"&&p[p.length-1].value===0),f=bn(l).some(({rule:p,cardOwner:u})=>p.type==="skip_check_cache_phase"&&(p.target==="self"&&u===t||p.target==="all")&&u===t);if(i||f){let p=ne(l,t,"Skipping Check Cache phase.");return p=We(p,void 0),p=Ke(p,void 0),p={...p,_logIndentLevel:0},{...p,phase:"end"}}if(c.hand.length>5){const p=c.hand.length-5;let h=ne(l,t,`Check Cache: ${t==="player"?"Player":"Opponent"} has ${c.hand.length} cards, must discard ${p}.`);return h=Ra(h),{...h,actionRequired:{type:"discard",actor:t,count:p}}}return l=We(l,void 0),l=Ke(l,void 0),l={...l,_logIndentLevel:0},{...l,phase:"end"}}case"end":{const c={...l};l=_m(l).newState;const i=c.actionRequired,d=l.actionRequired;if(d&&d!==i||l.queuedActions&&l.queuedActions.length>0&&(l=tl(l),l.actionRequired))return l;const f=t==="player"?"opponent":"player",p={...l[t],cannotCompile:!1};return l=We(l,void 0),l=Ke(l,void 0),l={...l,_logIndentLevel:0},l=Ee(l),{...l,[t]:p,turn:f,phase:"start",processedStartEffectIds:[],processedEndEffectIds:[],processedSpeed1TriggerThisTurn:!1,processedUncoverEventIds:[],_startPhaseEffectSnapshot:void 0,_endPhaseEffectSnapshot:void 0,_interruptedTurn:void 0,_interruptedPhase:void 0}}}return a};function Ze(a){var p;const t=a._pendingCustomEffects;if(!t||t.effects.length===0)return a;const l=t.effects.map(u=>u.id).join(",");if((p=a.queuedActions)==null?void 0:p.some(u=>{var h;return u.type==="execute_remaining_custom_effects"&&u.sourceCardId===t.sourceCardId&&((h=u.effects)==null?void 0:h.map(y=>y.id).join(","))===l})){const u={...a};return delete u._pendingCustomEffects,u}const i=t.selectedCardFromPreviousEffect||a.lastCustomEffectTargetCardId,d={type:"execute_remaining_custom_effects",sourceCardId:t.sourceCardId,laneIndex:t.laneIndex,effects:t.effects,context:t.context,actor:t.context.cardOwner,selectedCardFromPreviousEffect:i,logSource:t.logSource,logPhase:t.logPhase,logIndentLevel:t.logIndentLevel},f={...a,queuedActions:[d,...a.queuedActions||[]]};return delete f._pendingCustomEffects,f}const Na=a=>{var c,i;let t=Ze(a);if(!t.queuedActions||t.queuedActions.length===0){const d=t._deferredParentEffects;if(d&&d.length>0&&!t.actionRequired){const f=d[d.length-1],p=d.slice(0,-1),u={type:"execute_remaining_custom_effects",sourceCardId:f.sourceCardId,laneIndex:f.laneIndex,effects:f.effects,context:f.context,actor:f.actor||((c=f.context)==null?void 0:c.cardOwner),selectedCardFromPreviousEffect:f.selectedCardFromPreviousEffect,savedLastCustomEffectTargetCardId:f.savedLastCustomEffectTargetCardId,logSource:f.logSource,logPhase:f.logPhase,logIndentLevel:f.logIndentLevel};return Na({...t,_deferredParentEffects:p.length>0?p:void 0,lastCustomEffectTargetCardId:f.savedLastCustomEffectTargetCardId||f.selectedCardFromPreviousEffect,queuedActions:[u]})}return t}let l=[...t.queuedActions];for(;l.length>0;){const d=l.shift();if(d.sourceCardId&&d.type!=="flip_self"){const f=Se(t,d.sourceCardId);if(!f||!f.card.isFaceUp){const p=f?`${f.card.protocol}-${f.card.value}`:"a card",u=t._logSource;t=We(t,p),t=ne(t,d.actor,"Queued effect was cancelled because the source is no longer active."),t=We(t,u);continue}}if(d.type==="flip_self"){const{sourceCardId:f,actor:p}=d,u=Se(t,f),h=qo(t,f);if(u&&u.card.isFaceUp&&h){const y=`${u.card.protocol}-${u.card.value}`;t=ne(t,p,`${y}: Flips itself.`),t=ur(new Set([f]),t),t.animationState={type:"flipCard",cardId:f}}else{const y=u?`${u.card.protocol}-${u.card.value}`:"the source card",g=u?u.card.isFaceUp?"now covered":"flipped face-down":"deleted";t=ne(t,p,`The self-flip effect from ${y} was cancelled because it is ${g}.`)}continue}if(d.type==="execute_follow_up_effect"){const{sourceCardId:f,followUpEffect:p,actor:u,logContext:h}=d,y=Se(t,f),g=qo(t,f);if(y&&y.card.isFaceUp&&g){const _=t[y.owner].lanes.find(C=>C.some(R=>R.id===f)),x=t[y.owner].lanes.indexOf(_),S={cardOwner:y.owner,actor:u,currentTurn:t.turn,opponent:y.owner==="player"?"opponent":"player"},E=(h==null?void 0:h.sourceCardName)||`${y.card.protocol}-${y.card.value}`,b=(h==null?void 0:h.phase)||(t.phase==="start"?"start":"end");if(t={...t,_logIndentLevel:(h==null?void 0:h.indentLevel)||1,_currentEffectSource:E,_currentPhaseContext:b},t=st(y.card,x,t,S,p).newState,t.actionRequired)return t={...t,queuedActions:l},t}else{const _=y?`${y.card.protocol}-${y.card.value}`:"the source card",x=y?y.card.isFaceUp?"now covered":"flipped face-down":"deleted";t=ne(t,u,`The follow-up effect from ${_} was cancelled because it is ${x}.`)}continue}if(d.type==="execute_conditional_followup"){const{sourceCardId:f,laneIndex:p,followUpEffect:u,context:h,actor:y}=d,g=[...t.player.lanes.flat(),...t.opponent.lanes.flat()].find(x=>x.id===f);if(!g){t=ne(t,y,"Conditional follow-up effect skipped: source card no longer exists.");continue}if(!g.isFaceUp){const x=`${g.protocol}-${g.value}`;t=ne(t,y,`Conditional follow-up effect from ${x} cancelled: card was flipped face-down.`);continue}const _=st(g,p,t,h,u);if(t=Ee(_.newState),t.actionRequired)return u.conditional&&u.conditional.thenEffect&&(t.actionRequired={...t.actionRequired,followUpEffect:u.conditional.thenEffect,conditionalType:u.conditional.type}),t={...t,queuedActions:l},t;if(u.conditional&&u.conditional.thenEffect){const x=st(g,p,t,h,u.conditional.thenEffect);if(t=Ee(x.newState),t.actionRequired)return t={...t,queuedActions:l},t}continue}if(d.type==="execute_remaining_custom_effects"){const{sourceCardId:f,laneIndex:p,effects:u,context:h,selectedCardFromPreviousEffect:y,logSource:g,logPhase:_,logIndentLevel:x}=d;g!==void 0&&(t={...t,_currentEffectSource:g}),_!==void 0&&(t={...t,_currentPhaseContext:_}),x!==void 0&&(t={...t,_logIndentLevel:x});const S=Se(t,f);if(!S){t=ne(t,h.cardOwner,"Remaining effects cancelled because the source card was deleted or returned.");continue}if(!S.card.isFaceUp){const C=`${S.card.protocol}-${S.card.value}`;t=ne(t,h.cardOwner,`Remaining effects from ${C} cancelled because it was flipped face-down.`);continue}if(!P0(t,f)){const C=`${S.card.protocol}-${S.card.value}`;t=ne(t,h.cardOwner,`Remaining effects from ${C} cancelled because it is now covered.`);continue}const b=d.savedLastCustomEffectTargetCardId;b&&(t.lastCustomEffectTargetCardId=b),y&&(t._selectedCardFromPreviousEffect=y,b||(t.lastCustomEffectTargetCardId=y));for(let C=0;C<u.length;C++){const R=u[C],A=st(S.card,p,t,h,R);if(t=A.newState,A.animationRequests&&A.animationRequests.length>0&&!t.actionRequired){const I=u.slice(C+1);if(I.length>0){const $={type:"execute_remaining_custom_effects",sourceCardId:f,laneIndex:p,effects:I,context:h,actor:h.cardOwner,logSource:t._currentEffectSource,logPhase:t._currentPhaseContext,logIndentLevel:t._logIndentLevel||0};t.queuedActions=[$,...l||[]]}else t.queuedActions=l;const U=A.animationRequests[0];return U.type==="draw"?t.animationState={type:"drawCard",owner:U.player,cardIds:[]}:U.type==="play"?t.animationState={type:"playCard",cardId:U.cardId,owner:U.owner}:U.type==="delete"&&(t.animationState={type:"deleteCard",cardId:U.cardId,owner:U.owner}),t}if(t.actionRequired){const I=u.slice(C+1);if(I.length>0&&(t._pendingCustomEffects={sourceCardId:f,laneIndex:p,context:h,effects:I,logSource:t._currentEffectSource,logPhase:t._currentPhaseContext,logIndentLevel:t._logIndentLevel||0}),t._interruptedTurn){const U=t._interruptedTurn,$=t._interruptedPhase||t.phase;delete t._interruptedTurn,delete t._interruptedPhase,t.turn=U,t.phase=$}return t.queuedActions=l,t}}const j=t._deferredParentEffects;if(j&&j.length>0){const C=j[j.length-1],R=j.slice(0,-1);l=[{type:"execute_remaining_custom_effects",sourceCardId:C.sourceCardId,laneIndex:C.laneIndex,effects:C.effects,context:C.context,actor:C.actor||((i=C.context)==null?void 0:i.cardOwner),selectedCardFromPreviousEffect:C.selectedCardFromPreviousEffect,savedLastCustomEffectTargetCardId:C.savedLastCustomEffectTargetCardId,logSource:C.logSource,logPhase:C.logPhase,logIndentLevel:C.logIndentLevel},...l||[]],t={...t,_deferredParentEffects:R.length>0?R:void 0,lastCustomEffectTargetCardId:C.savedLastCustomEffectTargetCardId||C.selectedCardFromPreviousEffect}}continue}if(d.type==="reveal_opponent_hand"){const f=t.turn==="player"?"opponent":"player",p={...t[f]};if(p.hand.length>0){p.hand=p.hand.map(y=>({...y,isRevealed:!0})),t[f]=p;const u=Se(t,d.sourceCardId),h=u?`${u.card.protocol}-${u.card.value}`:"A card effect";t=ne(t,t.turn,`${h}: Opponent reveals their hand.`)}else{const u=Se(t,d.sourceCardId),h=u?`${u.card.protocol}-${u.card.value}`:"A card effect";t=ne(t,t.turn,`${h}: Opponent has no cards to reveal.`)}continue}if(d.type==="pending_uncover_effect"){const{owner:f,laneIndex:p}=d;if(t=Un(t,f,p).newState,t.actionRequired)return t.queuedActions=l,t;continue}if(d.type==="discard"&&d.actor){const f=d.actor,p=t[f].hand.length,u=d.count||1;if(p===0){const h=f==="player"?"Player":"Opponent";if(d.sourceCardId){const y=Se(t,d.sourceCardId);if(y){const g=`${y.card.protocol}-${y.card.value}`;t=We(t,g),t=Ke(t,"middle");const _=d._savedIndentLevel;_!==void 0&&(t={...t,_logIndentLevel:_})}}t=ne(t,f,`${h} has no cards to discard - effect skipped.`),t=We(t,void 0),t=Ke(t,void 0),t={...t,_logIndentLevel:0};continue}else typeof u=="number"&&p<u&&(d.count=p)}return t.actionRequired=d,t.queuedActions=l,t}return{...t,queuedActions:[],actionRequired:null}},tl=a=>{var d;if(a.winner||a.actionRequired)return a;const t=a._deferredParentEffects&&a._deferredParentEffects.length>0;if(a.queuedActions&&a.queuedActions.length>0||t){const f=Na(a);if(f.actionRequired)return f;a=f}if(a._interruptedTurn){const f=a._interruptedTurn,p=a._interruptedPhase||a.phase;let u={...a};if(delete u._interruptedTurn,delete u._interruptedPhase,u.turn=f,u.phase=p,p==="start"||p==="end"){if(u.queuedActions&&u.queuedActions.length>0&&(u=Na(u)),!u.actionRequired&&p==="end"){const h=_m(u).newState;if(h.actionRequired)return h;const y=h.turn==="player"?"opponent":"player",g={...h[h.turn],cannotCompile:!1};let _=We(h,void 0);return _=Ke(_,void 0),_={..._,_logIndentLevel:0},_=Ee(_),{..._,[h.turn]:g,turn:y,phase:"start",processedStartEffectIds:[],processedEndEffectIds:[],processedSpeed1TriggerThisTurn:!1,processedUncoverEventIds:[],_startPhaseEffectSnapshot:void 0,_endPhaseEffectSnapshot:void 0,_interruptedTurn:void 0,_interruptedPhase:void 0}}if(p==="start"&&!u.actionRequired){const h=Jd(u).newState;if(h.actionRequired)return h;let y={...h,phase:"control"};return Kr(y)}return u}a=u}if(((d=a.actionRequired)==null?void 0:d.type)==="prompt_rearrange_protocols"&&a.actionRequired.originalAction){const f=a.actionRequired.originalAction;let p={...a,actionRequired:null,controlCardHolder:null};if(f.type==="compile")return Kr(p);if(f.type==="fill_hand"){const u=fr(p,p.turn,5-p[p.turn].hand.length);return Kr(u)}}if(a.queuedEffect){const{card:f,laneIndex:p}=a.queuedEffect,u={...a,queuedEffect:void 0,_committedCardId:void 0},h=Se(u,f.id);if(h){const{card:y,owner:g}=h;let _={...u,_logIndentLevel:0};const x={cardOwner:g,actor:g,currentTurn:_.turn,opponent:g==="player"?"opponent":"player",triggerType:"play"},{newState:S}=ol(y,p,_,x);if(S.actionRequired)return S;a=S}else console.warn(`Skipping queued effect for ${f.protocol}-${f.value} as it is no longer on the board.`),a=ne(a,a.turn,`Skipping queued effect for ${f.protocol}-${f.value} as it is no longer on the board.`),a=u}if(a.queuedActions&&a.queuedActions.length>0){let f={...a},p=[...f.queuedActions];for(;p.length>0;){const u=p.shift(),h=u.type==="flip_self";if(u.sourceCardId&&!h){const y=Se(f,u.sourceCardId);if(!y||!y.card.isFaceUp){const g=y?`${y.card.protocol}-${y.card.value}`:"a card",_=f._logSource;f=We(f,g),f=ne(f,u.actor,"Queued effect was cancelled because the source is no longer active."),f=We(f,_);continue}}if(h){const{sourceCardId:y,actor:g}=u,_=Se(f,y),x=qo(f,y);if(_&&_.card.isFaceUp&&x){const S=`${_.card.protocol}-${_.card.value}`;f=ne(f,g,`${S}: Flips itself.`),f=ur(new Set([y]),f),f.animationState={type:"flipCard",cardId:y}}else{const S=_?`${_.card.protocol}-${_.card.value}`:"the source card",E=_?_.card.isFaceUp?"now covered":"flipped face-down":"deleted";f=ne(f,g,`The self-flip effect from ${S} was cancelled because it is ${E}.`)}continue}if(u.type==="reveal_opponent_hand"){const y=f.turn==="player"?"opponent":"player",g={...f[y]};if(g.hand.length>0){g.hand=g.hand.map(S=>({...S,isRevealed:!0})),f[y]=g;const _=Se(f,u.sourceCardId),x=_?`${_.card.protocol}-${_.card.value}`:"A card effect";f=ne(f,f.turn,`${x}: Opponent reveals their hand.`)}else{const _=Se(f,u.sourceCardId),x=_?`${_.card.protocol}-${_.card.value}`:"A card effect";f=ne(f,f.turn,`${x}: Opponent has no cards to reveal.`)}continue}if(u.type==="discard"&&u.actor){const y=u.actor,g=f[y].hand.length,_=u.count||1;if(g===0){const x=y==="player"?"Player":"Opponent";if(u.sourceCardId){const S=Se(f,u.sourceCardId);if(S){const E=`${S.card.protocol}-${S.card.value}`;f=We(f,E),f=Ke(f,"middle");const b=u._savedIndentLevel;b!==void 0&&(f={...f,_logIndentLevel:b})}}f=ne(f,y,`${x} has no cards to discard - effect skipped.`),f=We(f,void 0),f=Ke(f,void 0),f={...f,_logIndentLevel:0};continue}else typeof _=="number"&&g<_&&(u.count=g)}return f.actionRequired=u,f.queuedActions=p,f}a={...f,queuedActions:[],actionRequired:null}}const l=a.phase==="action"?"hand_limit":a.phase;let c={...a,phase:l,compilableLanes:[],processedUncoverEventIds:[]};const i=a.turn;for(;c.turn===i&&!c.winner;){const f=c.actionRequired,p=c.phase;c=el(c);const u=c.actionRequired;if(u&&u!==f)break;if(c.phase===p&&c.turn===i){console.error("Game is stuck in a phase loop:",c.phase);break}}return c},Kr=a=>{if(a.winner)return a;let t={...a};if(t._interruptedTurn){const c=t._interruptedTurn,i=t._interruptedPhase||t.phase;delete t._interruptedTurn,delete t._interruptedPhase,t.turn=c,t.phase=i}const l=t.turn;for(;t.turn===l&&!t.actionRequired&&!t.winner;){const c=t.phase;if(c==="action")break;if(c==="compile"){const d=Em(t,l);if(d.length>0){t={...t,compilableLanes:d};break}}const i=t.phase;if(t=el(t),i===t.phase&&!t.actionRequired){console.error("Game is stuck in an automatic phase loop:",i),console.error("State:",{phase:t.phase,turn:t.turn,actionRequired:t.actionRequired,queuedActions:t.queuedActions,interruptedTurn:t._interruptedTurn});break}}return{...t,animationState:null}},wm=a=>{let t={...a,actionRequired:null};if(t._interruptedTurn)return tl(t);const l=t._deferredParentEffects&&t._deferredParentEffects.length>0;if(t.queuedActions&&t.queuedActions.length>0||l){const d=Na(t);if(d.actionRequired)return d;t=d}const c=Jd(t).newState;if(c.actionRequired)return c;let i=c;return i.phase!=="control"&&(i={...i,phase:"control"}),i=el(i),i.actionRequired||(i=el(i)),i},xm=a=>{if(a.winner)return a;let t={...a,phase:"start"};return t=Ee(t),t=el(t),t.actionRequired?t:Kr(t)},Zh=Object.freeze(Object.defineProperty({__proto__:null,advancePhase:el,continueTurnAfterStartPhaseAction:wm,continueTurnProgression:Kr,processEndOfAction:tl,processQueuedActions:Na,processStartOfTurn:xm,queuePendingCustomEffects:Ze},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function Se(a,t){if(!t)return null;for(const l of["player","opponent"])for(let c=0;c<a[l].lanes.length;c++){const d=a[l].lanes[c].find(f=>f.id===t);if(d)return{card:d,owner:l,laneIndex:c}}return null}function qo(a,t){var c;if(!t)return!1;const l=a._committedCardId;for(const i of["player","opponent"])for(const d of a[i].lanes){if(d.length===0)continue;let f=d.length-1;const p=d[d.length-1].id;if(l&&d.length>=2&&p===l&&t!==l&&(f=d.length-2),((c=d[f])==null?void 0:c.id)===t)return!0}return!1}function P0(a,t){if(!t)return!1;for(const l of["player","opponent"])for(const c of a[l].lanes)if(c.length!==0&&c[c.length-1].id===t)return!0;return!1}function Io(a,t){return t?a._committedCardId===t:!1}function Lo(a,t,l){if(t.length===0||l<0||l>=t.length)return!1;const c=a._committedCardId;let i=t.length-1;return c&&t.length>=2&&t[t.length-1].id===c&&(i=t.length-2),l===i}function U0(a,t,l,c){var u;let i={...a};const d=c||((u=a.actionRequired)==null?void 0:u.followUpEffect),f=Se(i,t),p=f?ma(f.card,i[f.owner].lanes.find(h=>h.some(y=>y.id===t))||[]):0;if(i=Ze(i),i.actionRequired=null,d&&l){const h=Se(i,l);if(h){const y={cardOwner:h.owner,opponent:h.owner==="player"?"opponent":"player",currentTurn:i.turn,actor:h.owner,referencedCard:f==null?void 0:f.card,referencedCardValue:p};let g=-1;for(let _=0;_<i[h.owner].lanes.length;_++)if(i[h.owner].lanes[_].some(x=>x.id===l)){g=_;break}if(g!==-1)return st(h.card,g,i,y,d).newState}}return i}function Cm(a,t,l,c){var x,S,E,b,j,C,R;let i={...a};const d=(x=a.actionRequired)==null?void 0:x.followUpEffect,f=(S=a.actionRequired)==null?void 0:S.conditionalType;if(d&&console.log(`[handleChainedEffectsOnDiscard] Called with followUpEffect=${(E=d==null?void 0:d.params)==null?void 0:E.action}, sourceCardId=${c}, conditionalType=${f}, actionRequired.type=${(b=a.actionRequired)==null?void 0:b.type}`),i=Ze(i),i.actionRequired=null,c&&(i=$o(i)),d&&c){const A=Se(i,c);if(A||console.warn(`[handleChainedEffectsOnDiscard] Source card ${c} not found on board - followUp skipped`),A){const I=((j=a.actionRequired)==null?void 0:j.previousHandSize)||0,U=i[t].hand.length,$=Math.max(0,I-U);if(!(f==="then"||f==="if_executed"&&$>0))return console.warn(`[handleChainedEffectsOnDiscard] Follow-up skipped: conditionalType=${f}, discardedCount=${$}, previousHandSize=${I}, currentHandSize=${U}`),i;const ee={cardOwner:A.owner,opponent:A.owner==="player"?"opponent":"player",currentTurn:i.turn,actor:t,discardedCount:$,previousHandSize:I};let z=-1;for(let O=0;O<i[A.owner].lanes.length;O++)if(i[A.owner].lanes[O].some(k=>k.id===c)){z=O;break}if(z!==-1)return st(A.card,z,i,ee,d).newState}return i}if(!l||!c)return i;const p=((C=a.actionRequired)==null?void 0:C.previousHandSize)||0,u=i[t].hand.length;if(Math.max(0,p-u)===0)return i;const y=(R=Se(i,c))==null?void 0:R.card;y&&`${y.protocol}${y.value}`;const g=i.queuedActions&&i.queuedActions.length>0;let _=null;switch(l){case"fire_1":_={type:"select_cards_to_delete",count:1,sourceCardId:c,disallowedIds:[c],actor:t};break;case"fire_2":_={type:"select_card_to_return",sourceCardId:c,actor:t};break;case"fire_3":_={type:"select_card_to_flip",sourceCardId:c,actor:t,targetFilter:{position:"uncovered",excludeSelf:!0}};break}if(_)if(g){const A=i.queuedActions||[],I=A.filter($=>$.type==="select_card_to_shift"&&$.followUpEffect),U=A.filter($=>!($.type==="select_card_to_shift"&&$.followUpEffect));i.queuedActions=[...U,_,...I]}else i.actionRequired=_;return i}function Pd(a,t,l=null){const c=Se(a,t);if(!c)return a;const{card:i,owner:d}=c;if(!i.isFaceUp){let b=-1;for(let j=0;j<a[d].lanes.length;j++)if(a[d].lanes[j].some(C=>C.id===t)){b=j;break}if(b!==-1&&!j0(a,b).allowed)return a}let p=gt(a,"on_flip",{player:d,cardId:t}).newState;if(!Se(p,t))return p;const h=p.actionRequired&&"actor"in p.actionRequired?p.actionRequired.actor:p.turn,y=h==="player"?"Player":"Opponent",g=d==="player"?"Player's":"Opponent's",_=i.isFaceUp?"face-down":"face-up",x=`${i.protocol}-${i.value}`;p=ne(p,h,`${y} flips ${g} ${x} ${_}.`);const S={...p.stats[h],cardsFlipped:p.stats[h].cardsFlipped+1},E={...p[h],stats:S};return p={...p,[h]:E,stats:{...p.stats,[h]:S}},p=ur(new Set([t]),p),p.animationState={type:"flipCard",cardId:t},p.actionRequired=l,p}function Un(a,t,l){var f;const c=a[t].lanes[l];if(c.length===0)return{newState:a};const i=c[c.length-1],d=qo(a,i.id);if(i.isFaceUp&&d){const p=`${i.id}-${l}`;if((f=a.processedUncoverEventIds)!=null&&f.includes(p))return{newState:a};const u={source:a._currentEffectSource,phase:a._currentPhaseContext,indentLevel:a._logIndentLevel||0},h=`${i.protocol}-${i.value}`;let y=We(a,h);y=Ke(y,"uncover"),y=ne(y,t,`${i.protocol}-${i.value} is uncovered and its effects are re-triggered.`),y.processedUncoverEventIds=[...y.processedUncoverEventIds||[],p];const g={cardOwner:t,actor:t,currentTurn:y.turn,opponent:t==="player"?"opponent":"player",triggerType:"uncover"},_=ol(i,l,y,g);if(_.newState.actionRequired||(_.newState={..._.newState,_currentEffectSource:u.source,_currentPhaseContext:u.phase,_logIndentLevel:u.indentLevel}),_.newState.actionRequired){const x=_.newState.actionRequired.actor;if(a._interruptedTurn&&x===a._interruptedTurn){const S=_.newState.actionRequired;return _.newState.actionRequired=null,_.newState.queuedActions=[..._.newState.queuedActions||[],S],_.newState=Ze(_.newState),_}_.newState=Ze(_.newState),x!==a.turn&&(_.newState._interruptedTurn=a.turn,_.newState._interruptedPhase=a.phase,_.newState.turn=x,_.newState.actionRequired.type==="prompt_rearrange_protocols"&&(_.newState.actionRequired={..._.newState.actionRequired,originalAction:{type:"resume_interrupted_turn",interruptedTurn:a.turn,interruptedPhase:a.phase}}))}else _.newState._interruptedTurn&&(_.newState.turn=_.newState._interruptedTurn,_.newState._interruptedTurn=void 0);return _}return{newState:a}}function O0(a,t,l){var c,i;for(const d of["player","opponent"])for(const f of a[d].lanes)for(const p of f){if(!p.isFaceUp)continue;const u=p.customEffects;if(!u)continue;const h=u.bottomEffects||[];for(const y of h){if(y.trigger!=="when_card_returned"||((c=y.params)==null?void 0:c.action)!=="redirect_return_to_deck")continue;const g=((i=y.params)==null?void 0:i.targetOwner)||"opponent",_=d;if(g==="opponent"&&t!==_||g==="own"&&t===_)return p}}return null}function Ud(a,t){const l=Se(a,t);if(!l)return{newState:a};const{card:c,owner:i}=l,d=a[i].lanes.findIndex(C=>C.some(R=>R.id===c.id));if(d===-1)return{newState:a};const f=a[i].lanes[d],p=f.length>0&&f[f.length-1].id===t;let u={...a};const h={...u[i]},y=u.actionRequired&&"actor"in u.actionRequired?u.actionRequired.actor:u.turn,g=y==="player"?"Player":"Opponent",_=i==="player"?"Player's":"Opponent's",x=`${c.protocol}-${c.value}`,S=O0(a,i);if(h.lanes=h.lanes.map(C=>C.filter(R=>R.id!==t)),S){const C={...c,isFaceUp:!1,isRevealed:!1};h.deck=[C,...h.deck],u[i]=h;const R=`${S.protocol}-${S.value}`;u=ne(u,y,`${R}: ${_} ${x} is put on top of their deck face-down instead of returning to hand.`)}else h.hand=[...h.hand,{...c,isFaceUp:!0,isRevealed:!1}],u[i]=h,u=ne(u,y,`${g} returns ${_} ${x} to their hand.`);u=Ze(u);const E={...u.stats[y],cardsReturned:u.stats[y].cardsReturned+1},b={...u[y],stats:E};u={...u,[y]:b},u.actionRequired=null;const j=Ee(u);return p&&j[i].lanes[d].length>0?Un(j,i,d):{newState:j}}function Fo(a,t,l,c,i){const d=Se(a,t);if(!d||d.owner!==l)return{newState:a};const{card:f}=d,p=a[l];let u=-1;for(let T=0;T<p.lanes.length;T++)if(p.lanes[T].some(L=>L.id===t)){u=T;break}if(u===-1)return{newState:a};if(u===c)return{newState:a};if(!Jl(a,u,c).allowed)return{newState:a};const y=a[l].lanes[u],g=y.length>0&&y[y.length-1].id===t,_=p.lanes.map((T,L)=>L===u?T.filter(B=>B.id!==t):T),x=_[c].length>0?_[c][_[c].length-1]:null;let S={...a,[l]:{...p,lanes:_}};S._committedCardId=t;const E=_.map((T,L)=>L===c?[...T,f]:T),b={...p,lanes:E};let j={...S,[l]:b};(!a._currentEffectSource||!a._currentPhaseContext)&&(j=We(j,void 0),j=Ke(j,void 0));const C=i==="player"?"Player":"Opponent",R=l==="player"?"Player's":"Opponent's",A=f.isFaceUp?`${f.protocol}-${f.value}`:"a card",I=j[l].protocols[c];j=ne(j,i,`${C} shifts ${R} ${A} to Protocol ${I}.`);const U={...j.stats[i],cardsShifted:j.stats[i].cardsShifted+1},$={...j[i],stats:U};j={...j,[i]:$,stats:{...j.stats,[i]:U}},j=Ze(j),j.actionRequired=null;let Z=Ee(j),ee={newState:Z};if(x){x.customEffects;const T={cardOwner:l,actor:i,currentTurn:Z.turn,opponent:l==="player"?"opponent":"player",triggerType:"cover"};ee=Kd(x,c,Z,T)}let z=ee.newState,O=[...ee.animationRequests||[]];if(g){const T=Un(z,l,u);z=T.newState,T.animationRequests&&O.push(...T.animationRequests)}const k=z[l].lanes[c],q=k.length>0&&k[k.length-1].id===t,F=!g;if(q&&f.isFaceUp&&F){const T=Un(z,l,c);T.animationRequests&&O.push(...T.animationRequests);let L=T.newState;return!L.actionRequired&&(!L.queuedActions||L.queuedActions.length===0)&&(L._committedCardId=void 0),{newState:L,animationRequests:O.length>0?O:void 0}}let D=z;return!D.actionRequired&&(!D.queuedActions||D.queuedActions.length===0)&&(D._committedCardId=void 0),{newState:D,animationRequests:O.length>0?O:void 0}}const M0=(a,t,l)=>{let c=0;for(const i of["player","opponent"])for(let d=0;d<a[i].lanes.length;d++){const f=a[i].lanes[d];if(f.length>0){const p=f[f.length-1];t.includes(p.id)||c++}}return c},Od=(a,t)=>{var y;const l=Se(a,t);if(!l)return{newState:a};const{card:c,owner:i}=l,d=a[i].lanes.findIndex(g=>g.some(_=>_.id===c.id));if(d===-1)return{newState:a};let f=a;const p=a._pendingCustomEffects;p&&((y=p.effects)==null?void 0:y.length)>0&&p.effects.some(_=>_.useCardFromPreviousEffect)&&(f={...a,_pendingCustomEffects:{...p,selectedCardFromPreviousEffect:t}});const u={cardOwner:i,actor:i,currentTurn:f.turn,opponent:i==="player"?"opponent":"player",triggerType:"flip"},h=ol(c,d,f,u);if(h.newState.actionRequired){h.newState=Ze(h.newState);const g=h.newState.actionRequired.actor;if(a._interruptedTurn&&g===a._interruptedTurn)return h.newState.queuedActions=[...h.newState.queuedActions||[],h.newState.actionRequired],h.newState=Ze(h.newState),h.newState.actionRequired=null,h;g!==a.turn&&(h.newState._interruptedTurn=a.turn,h.newState._interruptedPhase=a.phase,h.newState.turn=g,h.newState.actionRequired.type==="prompt_rearrange_protocols"&&(h.newState.actionRequired={...h.newState.actionRequired,originalAction:{type:"resume_interrupted_turn",interruptedTurn:a.turn,interruptedPhase:a.phase}}))}return h};function H0(a,t){const l=[];if(a[t].lanes.forEach((i,d)=>{if(i.length>0){const f=i[i.length-1],p=ma(f,i);l.push({card:f,laneIndex:d,owner:t,value:p})}}),l.length===0)return[];const c=Math.max(...l.map(i=>i.value));return l.filter(i=>i.value===c)}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Draw Effect Executor
 *
 * Handles all draw-related effects.
 * Extracted 1:1 from effectInterpreter.ts for modularity.
 */function Kh(a,t,l){const c=Math.min(l,a.length),i=a.slice(0,c).map(p=>({...p,id:ot(),isFaceUp:!0})),d=[...t,...i],f=a.slice(c);return{drawnCards:d,remainingDeck:f,newCards:i}}function z0(a,t,l,c,i){var A,I,U,$,Z,ee,z,O;const d=i._conditional,{cardOwner:f}=c,u=(i.target||"self")==="opponent"?c.opponent:f,h=Zd(l,u);if(!h.allowed)return{newState:ne(l,f,h.reason||"Cannot draw cards.")};if(i.conditional){let k=0;switch(i.conditional.type){case"non_matching_protocols":{for(let W=0;W<3;W++){const oe=l.player.protocols[W],Q=l.opponent.protocols[W],V=l.player.lanes[W].filter(Y=>Y.isFaceUp),J=l.opponent.lanes[W].filter(Y=>Y.isFaceUp);[...V,...J].some(Y=>Y.protocol!==oe&&Y.protocol!==Q)&&k++}break}case"count_face_down":{let W=0;for(const oe of["player","opponent"])for(const Q of l[oe].lanes)W+=Q.filter(V=>!V.isFaceUp).length;k=W;break}case"is_covering":{k=l[f].lanes[t].length>1?i.count||1:0;break}}let q=k;if(q<=0)return{newState:l};const{drawnCards:F,remainingDeck:D,newCards:T}=Kh(l[u].deck,l[u].hand,q);let L={...l};if(L[u]={...L[u],deck:D,hand:F},L.detailedGameStats&&T.length>0){const W=u==="player"?"playerFromEffect":"aiFromEffect";L={...L,detailedGameStats:{...L.detailedGameStats,cardsDrawn:{...L.detailedGameStats.cardsDrawn,[W]:L.detailedGameStats.cardsDrawn[W]+T.length}}}}const B=u==="player"?"Player":"Opponent";let G="";switch(i.conditional.type){case"non_matching_protocols":G=" from non-matching protocols";break;case"is_covering":G=" (this card is covering another)";break;case"count_face_down":G=" (for face-down cards)";break;default:G=""}const ae=T.length>0&&u==="player"?` (${T.map(W=>`${W.protocol}-${W.value}`).join(", ")})`:"";L=ne(L,u,`${B} draws ${q} card${q!==1?"s":""}${G}${ae}.`),q>0&&(L=gt(L,"after_draw",{player:u}).newState,L=gt(L,"after_opponent_draw",{player:u==="player"?"opponent":"player"}).newState);const M=q>0?[{type:"draw",player:u,count:q}]:void 0;return{newState:L,animationRequests:M}}let y=i.count||1;const g=i.countType||"fixed";switch(g){case"equal_to_card_value":{const k=l.lastCustomEffectTargetCardId;if(k){const q=Se(l,k);if(q){const F=q.owner,D=l[F].lanes.find(T=>T.some(L=>L.id===k))||[];y=ma(q.card,D)}else if(l.lastCustomEffectTargetValue!==void 0)y=l.lastCustomEffectTargetValue;else return y=0,{newState:ne(l,f,"Cannot draw cards - referenced card is no longer available.")}}else l.lastCustomEffectTargetValue!==void 0?y=l.lastCustomEffectTargetValue:y=c.referencedCardValue||0;break}case"equal_to_discarded":y=(c.discardedCount||0)+(i.countOffset||0);break;case"hand_size":case"previous_hand_size":y=c.previousHandSize||c.handSize||0;break;case"count_face_down":{let k=0;for(const q of["player","opponent"])for(const F of l[q].lanes)k+=F.filter(D=>!D.isFaceUp).length;y=k*(i.count||1);break}case"all_matching":{if(((A=i.valueFilter)==null?void 0:A.equals)!==void 0){const k=i.valueFilter.equals;y=l[u].deck.filter(F=>F.value===k).length}else y=0;break}case"fixed":default:y=i.count||1;break}if(y<=0)return{newState:l};if(((I=i.advancedConditional)==null?void 0:I.type)==="protocol_match"){const k=i.advancedConditional.protocol;if(l[f].protocols[t]!==k)return{newState:l}}if(((U=i.advancedConditional)==null?void 0:U.type)==="empty_hand"&&l[u].hand.length>0)return{newState:l};if((($=i.advancedConditional)==null?void 0:$.type)==="opponent_higher_value_in_lane"){const k=f==="player"?"opponent":"player",q=ta(l,f,t);if(ta(l,k,t)<=q)return{newState:l}}let _={...l};if(((Z=i.advancedConditional)==null?void 0:Z.type)==="compile_block"){const k=i.advancedConditional.turnDuration||1,q=f==="player"?"opponent":"player";_={..._,compileBlockedUntilTurn:(_.turnNumber||0)+k,compileBlockedPlayer:q},_=ne(_,f,`Opponent can't compile for ${k} turn${k!==1?"s":""}.`)}if(i.optional)return _.actionRequired={type:"prompt_optional_draw",sourceCardId:a.id,actor:f,count:y,drawingPlayer:u,followUpEffect:d==null?void 0:d.thenEffect,conditionalType:d==null?void 0:d.type,logSource:l._currentEffectSource,logPhase:l._currentPhaseContext,logIndentLevel:l._logIndentLevel||0},{newState:_};const x=i.source||"own_deck",S=x==="opponent_deck"?c.opponent:u;let E,b,j=[];if(g==="all_matching"&&((ee=i.valueFilter)==null?void 0:ee.equals)!==void 0){const k=i.valueFilter.equals,q=_[S].deck,F=q.filter(T=>T.value===k),D=q.filter(T=>T.value!==k);j=F.map(T=>({...T,id:ot(),isFaceUp:!0})),E=[..._[u].hand,...j],b=D}else if(((z=i.valueFilter)==null?void 0:z.equals)!==void 0&&i.fromRevealed){const k=i.valueFilter.equals,q=_[S].deck,F=q.filter(D=>D.value===k);if(F.length===0){const D=`${a.protocol}-${a.value}`;_=ne(_,u,`${D}: No cards with value ${k} in deck.`),E=_[u].hand,b=q,j=[]}else return _.actionRequired={type:"select_card_from_revealed_deck",sourceCardId:a.id,actor:u,count:y,valueFilter:k,revealedCards:q,selectableCardIds:F.map(D=>D.id||`deck-${q.indexOf(D)}`)},{newState:_}}else if(((O=i.valueFilter)==null?void 0:O.equals)!==void 0){const k=i.valueFilter.equals,q=[..._[S].deck],F=[];for(let L=0;L<q.length&&F.length<y;L++)q[L].value===k&&F.push(L);const D=F.map(L=>q[L]),T=q.filter((L,B)=>!F.includes(B));j=D.map(L=>({...L,id:ot(),isFaceUp:!0})),E=[..._[u].hand,...j],b=T}else{const k=Kh(_[S].deck,_[u].hand,y);E=k.drawnCards,b=k.remainingDeck,j=k.newCards}if(_[S]={..._[S],deck:b},_[u]={..._[u],hand:E},_.detailedGameStats&&j.length>0){const k=u==="player"?"playerFromEffect":"aiFromEffect";_={..._,detailedGameStats:{..._.detailedGameStats,cardsDrawn:{..._.detailedGameStats.cardsDrawn,[k]:_.detailedGameStats.cardsDrawn[k]+j.length}}}}const C=u==="player"?"Player":"Opponent",R=j.length>0&&u==="player"?` (${j.map(k=>`${k.protocol}-${k.value}`).join(", ")})`:"";if(x==="opponent_deck"){const k=S==="player"?"Player's":"Opponent's";_=ne(_,u,`${C} draws the top ${y===1?"card":`${y} cards`} of ${k} deck${R}.`)}else _=ne(_,u,`${C} draws ${y} card${y!==1?"s":""}${R}.`);if(E.length>0&&(_=gt(_,"after_draw",{player:u,count:E.length}).newState,_=gt(_,"after_opponent_draw",{player:u==="player"?"opponent":"player",count:E.length}).newState),i.revealFromDrawn&&j.length>0){const k=i.revealFromDrawn.valueSource||"stated_number",q=i.revealFromDrawn.count||1;let F=j;if(k==="stated_number"){const T=_.lastStatedNumber;T===void 0?_=ne(_,u,"No number was stated. Cannot filter drawn cards."):F=j.filter(L=>L.value===T)}const D=q==="all"?F.length:Math.min(q,F.length);return _.actionRequired={type:"select_from_drawn_to_reveal",actor:u,sourceCardId:a.id,allDrawnCardIds:j.map(T=>T.id),eligibleCardIds:F.map(T=>T.id),revealCount:D,statedNumber:k==="stated_number"?_.lastStatedNumber:void 0,thenAction:i.revealFromDrawn.thenAction},{newState:_}}return{newState:_}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Flip Effect Executor
 *
 * Handles all flip-related effects.
 * Extracted 1:1 from effectInterpreter.ts for modularity.
 */function V0(a,t,l,c,i){var j,C,R,A;const{cardOwner:d}=c,f=i._conditional;if(i.useCardFromPreviousEffect&&l.lastCustomEffectTargetCardId){const I=l.lastCustomEffectTargetCardId,U=Se(l,I);if(!U)return{newState:ne(l,d,"Target card from previous effect no longer exists. Flip skipped.")};let $={...l};const Z=U.owner,ee=$[Z].lanes.findIndex(z=>z.some(O=>O.id===I));if(ee!==-1){const O=$[Z].lanes[ee].find(k=>k.id===I);if(O){i.skipMiddleCommand&&!O.isFaceUp&&($.skipNextMiddleCommand=I),O.isFaceUp=!O.isFaceUp;const k=O.isFaceUp?"face-up":"face-down",q=i.skipMiddleCommand&&O.isFaceUp?", ignoring its middle commands":"";$=ne($,d,`Flips that card ${k}${q}.`)}}return{newState:$}}if(i.scope==="each_lane"){const I=i.targetFilter||{},U=ka(l),$=k=>{const q=l.player.lanes[k],F=l.opponent.lanes[k];let D=[];if(I.position==="covered"?D=[...q.filter((L,B)=>B<q.length-1),...F.filter((L,B)=>B<F.length-1)]:D=[...q,...F],I.owner==="own")D=D.filter(L=>q.includes(L)&&d==="player"||F.includes(L)&&d==="opponent");else if(I.owner==="opponent"){const L=d==="player"?"opponent":"player";D=D.filter(B=>q.includes(B)&&L==="player"||F.includes(B)&&L==="opponent")}return I.excludeSelf&&(D=D.filter(L=>L.id!==a.id)),(U?D.filter(L=>L.isFaceUp):D).length>0},Z=[0,1,2].filter(k=>$(k));if(Z.length===0){let k=ne(l,d,U?"No valid face-up targets to flip (Frost-1 is active).":"No valid targets to flip in any lane.");return k._effectSkippedNoTargets=!0,{newState:k}}const ee=Z[0],z=Z.slice(1);let O={...l};return O.actionRequired={type:"select_card_to_flip",sourceCardId:a.id,actor:d,currentLaneIndex:ee,remainingLanes:z,targetFilter:i.targetFilter,params:i,followUpEffect:f==null?void 0:f.thenEffect,conditionalType:f==null?void 0:f.type},{newState:O}}if(i.flipSelf){if(((j=i.advancedConditional)==null?void 0:j.type)==="protocol_match"){const Z=i.advancedConditional.protocol;if(l[d].protocols[t]!==Z)return{newState:l}}if(((C=i.advancedConditional)==null?void 0:C.type)==="opponent_higher_value_in_lane"){const Z=d==="player"?"opponent":"player",ee=ta(l,d,t);if(ta(l,Z,t)<=ee)return{newState:l}}if(((R=i.advancedConditional)==null?void 0:R.type)==="hand_size_greater_than"){const Z=i.advancedConditional.threshold??0;if(l[d].hand.length<=Z)return{newState:l}}let I={...l};const $=I[d].lanes[t].find(Z=>Z.id===a.id);if($){$.isFaceUp=!$.isFaceUp;const Z=d==="player"?"Player":"Opponent",ee=$.isFaceUp?"face-up":"face-down";I=ne(I,d,`${Z} flips this card ${ee}.`)}return{newState:I}}const p=i.count||1,u=((A=i.scope)==null?void 0:A.type)||i.scope||"anywhere",h=p==="all"||typeof p!="number",y=u==="this_lane"&&h,g=u==="anywhere"&&h;if(y||g){let I={...l};const U=d==="player"?"opponent":"player",$=i.targetFilter||{},Z=ka(l),ee=new Set,z=g?[0,1,2]:[t];for(const O of z){const k=I[d].lanes[O];for(const F of k){if($.excludeSelf&&F.id===a.id||$.faceState==="face_up"&&!F.isFaceUp||$.faceState==="face_down"&&F.isFaceUp||$.owner==="opponent")continue;const D=k.indexOf(F)===k.length-1;$.position==="uncovered"&&!D||$.position==="covered"&&D||g&&!$.position&&!D||Z&&!F.isFaceUp||ee.add(F.id)}const q=I[U].lanes[O];for(const F of q){if($.faceState==="face_up"&&!F.isFaceUp||$.faceState==="face_down"&&F.isFaceUp||$.owner==="own")continue;const D=q.indexOf(F)===q.length-1;$.position==="uncovered"&&!D||$.position==="covered"&&D||g&&!$.position&&!D||Z&&!F.isFaceUp||ee.add(F.id)}}if(ee.size>0){const O=g?"":" in this lane";I=ne(I,d,`Flipping ${ee.size} card(s)${O}.`);for(const k of ee)for(const q of["player","opponent"])for(const F of I[q].lanes){const D=F.find(T=>T.id===k);D&&(D.isFaceUp=!D.isFaceUp)}return{newState:I}}else return I=ne(I,d,`No cards to flip${g?"":" in this lane"}.`),{newState:I}}const _=i.targetFilter||{},x=_.position||"uncovered",S=ka(l),E=[];for(const I of["player","opponent"])for(let U=0;U<l[I].lanes.length;U++){const $=l[I].lanes[U];if(!(i.scope==="this_lane"&&U!==t)&&!(i.sameLaneAsFirst&&l.lastFlipLaneIndex!==void 0&&U!==l.lastFlipLaneIndex))for(let Z=0;Z<$.length;Z++){const ee=$[Z];if(Io(l,ee.id))continue;const z=Lo(l,$,Z);if(!(_.excludeSelf&&ee.id===a.id||_.owner==="own"&&I!==d||_.owner==="opponent"&&I===d||x==="uncovered"&&!z||x==="covered"&&z||_.faceState==="face_up"&&!ee.isFaceUp||_.faceState==="face_down"&&ee.isFaceUp||S&&!ee.isFaceUp||!Xl(l,ee.id).allowed)){if(_.valueMinGreaterThanHandSize){const k=l[d].hand.length;if(ee.value<=k)continue}E.push(ee.id)}}}if(E.length===0){let I=l;if(_.valueMinGreaterThanHandSize){const U=l[d].hand.length,$=U+1;I=ne(I,d,`Hand size: ${U} cards. No cards with value ${$} or higher available. Effect skipped.`)}else I=ne(I,d,"No valid cards to flip. Effect skipped.");return I._effectSkippedNoTargets=!0,{newState:I}}let b={...l};if(_.valueMinGreaterThanHandSize){const I=l[d].hand.length,U=I+1,$=p==="all"?"all cards":p===1?"1 card":`${p} cards`;b=ne(b,d,`Hand size: ${I} cards. Flip ${$} with value ${U} or higher.`)}return b.actionRequired={type:"select_card_to_flip",count:p,sourceCardId:a.id,actor:d,targetFilter:i.targetFilter,optional:i.optional||!1,scope:i.scope,laneIndex:i.scope==="this_lane"?t:void 0,sameLaneAsFirst:i.sameLaneAsFirst||!1,restrictedLaneIndex:i.sameLaneAsFirst?l.lastFlipLaneIndex:void 0,followUpEffect:f==null?void 0:f.thenEffect,conditionalType:f==null?void 0:f.type},{newState:b}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Delete Effect Executor
 *
 * Handles all delete-related effects.
 * Extracted 1:1 from effectInterpreter.ts for modularity.
 */function B0(a,t,l,c,i){var R,A,I,U,$,Z,ee,z,O,k;const{cardOwner:d}=c,f=i._conditional;let p=i.count||1;if(((R=i.advancedConditional)==null?void 0:R.type)==="empty_hand"&&l[d].hand.length>0)return{newState:l};if(((A=i.advancedConditional)==null?void 0:A.type)==="opponent_higher_value_in_lane"){const q=d==="player"?"opponent":"player",F=ta(l,d,t);if(ta(l,q,t)<=F)return{newState:l}}if(i.useCardFromPreviousEffect&&l.lastCustomEffectTargetCardId){const q=l.lastCustomEffectTargetCardId,F=Se(l,q);if(!F)return{newState:ne(l,d,"Target card from previous effect no longer exists. Delete skipped.")};let D={...l};const T=F.owner,L=D[T].lanes.findIndex(B=>B.some(G=>G.id===q));if(L!==-1){const B=[...D[T].lanes[L]],G=B.findIndex(ae=>ae.id===q);if(G!==-1){const ae=G===B.length-1;B.splice(G,1);const M=[...D[T].lanes];M[L]=B,D={...D,[T]:{...D[T],lanes:M}};const W=F.card.isFaceUp?`${F.card.protocol}-${F.card.value}`:"that card";D=ne(D,d,`Deletes ${W}.`);const oe={...D.stats[d],cardsDeleted:D.stats[d].cardsDeleted+1};D={...D,stats:{...D.stats,[d]:oe}};const Q=c.triggerType==="cover"||c.triggerType==="on_cover";return ae&&B.length>0&&!Q&&(D=Un(D,T,L).newState),{newState:D,animationRequests:[{type:"delete",cardId:q,owner:T}]}}}return{newState:D}}if((I=i.scope)!=null&&I.minCardsInLane){const q=i.scope.minCardsInLane,F=((U=l.player.lanes[t])==null?void 0:U.length)||0,D=(($=l.opponent.lanes[t])==null?void 0:$.length)||0;if(F+D<q)return{newState:l}}let u=[0,1,2];if(((Z=i.laneCondition)==null?void 0:Z.type)==="opponent_higher_value"&&(u=gw(l,d),u.length===0)){let q=ne(l,d,"No lanes where opponent has higher value. Delete effect skipped.");return q._effectSkippedNoTargets=!0,{newState:q}}const h=i.actorChooses||"effect_owner",y=((ee=i.targetFilter)==null?void 0:ee.owner)||"any";let g=d;h==="card_owner"&&y==="opponent"&&(g=c.opponent);const _=i.targetFilter||{},x=_.position||"uncovered",S=[];for(const q of["player","opponent"])for(let F=0;F<l[q].lanes.length;F++){if(((z=i.scope)==null?void 0:z.type)==="this_line"&&F!==t)continue;const D=l[q].lanes[F];for(let T=0;T<D.length;T++){const L=D[T];if(Io(l,L.id))continue;const B=Lo(l,D,T);if(!(i.excludeSelf&&L.id===a.id)&&!(_.owner==="own"&&q!==d)&&!(_.owner==="opponent"&&q===d)&&!(x==="uncovered"&&!B)&&!(x==="covered"&&B)){if(x==="covered_by_context"&&c.triggerType==="cover"){if(q!==c.cardOwner&&B)continue}else if(x==="covered_by_context"&&B)continue;if(!(_.faceState==="face_up"&&!L.isFaceUp)&&!(_.faceState==="face_down"&&L.isFaceUp)){if(_.valueRange){const{min:G,max:ae}=_.valueRange;if(L.value<G||L.value>ae)continue}if(_.valueSource==="previous_effect_card"){const G=l.lastCustomEffectTargetValue;if(G===void 0||L.value!==G)continue}if(i.protocolMatching){const G=l.player.protocols[F],ae=l.opponent.protocols[F],M=L.protocol,W=M===G||M===ae;if(i.protocolMatching==="must_match"&&!W||i.protocolMatching==="must_not_match"&&W)continue}S.push(L.id)}}}}if(S.length===0){let q=ne(l,d,"No valid cards to delete. Effect skipped.");return q._effectSkippedNoTargets=!0,{newState:q}}if(i.upTo&&(p=Math.min(p,S.length),p===0))return{newState:ne(l,d,"No valid targets available. Delete effect skipped.")};let E=S;if(_.calculation==="highest_value"||_.calculation==="lowest_value"){const q=new Map;for(const T of S){const L=Se(l,T);if(!L)continue;let B=-1;for(let ae=0;ae<l[L.owner].lanes.length;ae++)if(l[L.owner].lanes[ae].some(M=>M.id===T)){B=ae;break}let G=L.card.value;!L.card.isFaceUp&&B!==-1&&(G=l[L.owner].lanes[B].some(M=>M.isFaceUp&&M.protocol==="Darkness"&&M.value===2)?4:2),q.set(T,G)}const F=Array.from(q.values()),D=_.calculation==="highest_value"?Math.max(...F):Math.min(...F);E=S.filter(T=>q.get(T)===D)}if(i.autoExecute){const q=E.slice(0,p);let F=l;const D=[];for(const T of q){const L=Se(F,T);if(!L)continue;const{card:B,owner:G}=L;let ae=-1;for(let K=0;K<F[G].lanes.length;K++)if(F[G].lanes[K].some(X=>X.id===T)){ae=K;break}if(ae===-1)continue;const M=F[G].lanes[ae],W=M[M.length-1].id===T,oe=B.isFaceUp?`${B.protocol}-${B.value}`:"a face-down card";F=ne(F,d,`Effect triggers, deleting the lowest value covered card (${G==="player"?"Player's":"Opponent's"} ${oe}).`);const V=[...M],J=V.findIndex(K=>K.id===T);V.splice(J,1);const me=[...F[G].lanes];me[ae]=V,F={...F,[G]:{...F[G],lanes:me}};const ge={...F.stats[d],cardsDeleted:F.stats[d].cardsDeleted+1};F={...F,stats:{...F.stats,[d]:ge}},D.push({type:"delete",cardId:T,owner:G});const Y=c.triggerType==="cover"||c.triggerType==="on_cover";W&&V.length>0&&!Y&&(F=Un(F,G,ae).newState)}return{newState:F,animationRequests:D}}let b={...l};if(i.deleteSelf){const q=d,F=l[q].lanes[t];if(!F||F.length===0)return b=ne(b,d,"Card already deleted. Delete effect skipped."),{newState:b};if(F.findIndex(Q=>Q.id===a.id)===-1)return b=ne(b,d,"Card already deleted. Delete effect skipped."),{newState:b};const T=l[q].lanes[t],L=T.length>0&&T[T.length-1].id===a.id;b=ne(b,d,`Deleting ${a.protocol}-${a.value}.`);const B=[...T],G=B.findIndex(Q=>Q.id===a.id);if(G===-1)return{newState:b};B.splice(G,1);const ae=[...b[q].lanes];ae[t]=B,b={...b,[q]:{...b[q],lanes:ae}};const M={...b.stats[d],cardsDeleted:b.stats[d].cardsDeleted+1};b={...b,stats:{...b.stats,[d]:M}};const W=[{type:"delete",cardId:a.id,owner:q}],oe=c.triggerType==="cover"||c.triggerType==="on_cover";if(L&&B.length>0&&!oe){const Q=Un(b,q,t);b=Q.newState,Q.animationRequests&&W.push(...Q.animationRequests)}return{newState:b,animationRequests:W}}if(i.selectLane)return b.actionRequired={type:"select_lane_for_delete",sourceCardId:a.id,actor:g,count:i.count,targetFilter:i.targetFilter,deleteAll:i.count==="all_in_lane"||i.count==="all",validLanes:u.length<3?u:void 0,laneCondition:i.laneCondition,followUpEffect:f==null?void 0:f.thenEffect,conditionalType:f==null?void 0:f.type},{newState:b};if(((O=i.scope)==null?void 0:O.type)==="each_lane"){const q=L=>{for(const B of["player","opponent"]){const G=l[B].lanes[L];for(let ae=0;ae<G.length;ae++){const M=G[ae];if(Io(l,M.id))continue;const W=Lo(l,G,ae);if(!(i.excludeSelf&&M.id===a.id)&&!(_.owner==="own"&&B!==g)&&!(_.owner==="opponent"&&B===g)&&!(x==="uncovered"&&!W)&&!(x==="covered"&&W)&&!(_.faceState==="face_up"&&!M.isFaceUp)&&!(_.faceState==="face_down"&&M.isFaceUp))return!0}}return!1},F=[0,1,2].filter(L=>q(L));if(F.length===0)return b=ne(b,d,"No valid targets to delete in any lane."),b._effectSkippedNoTargets=!0,{newState:b};const D=F[0],T=F.slice(1);return b.actionRequired={type:"select_cards_to_delete",count:p,sourceCardId:a.id,actor:g,currentLaneIndex:D,remainingLanes:T,disallowedIds:i.excludeSelf?[a.id]:[],targetFilter:i.targetFilter,scope:i.scope,protocolMatching:i.protocolMatching,params:i,followUpEffect:f==null?void 0:f.thenEffect,conditionalType:f==null?void 0:f.type},{newState:b}}if(((k=i.scope)==null?void 0:k.type)==="each_other_line"){const D=[0,1,2].filter(T=>T!==t).filter(T=>l.player.lanes[T].length>0||l.opponent.lanes[T].length>0).length;return D===0?(b=ne(b,d,"No other lanes have cards. Effect skipped."),{newState:b}):(b.actionRequired={type:"select_card_from_other_lanes_to_delete",sourceCardId:a.id,disallowedLaneIndex:t,lanesSelected:[],count:D,actor:g,targetFilter:i.targetFilter,followUpEffect:f==null?void 0:f.thenEffect,conditionalType:f==null?void 0:f.type},{newState:b})}const j=_.valueSource==="previous_effect_card",C=E.length<S.length||j?E:void 0;return b.actionRequired={type:"select_cards_to_delete",count:p,sourceCardId:a.id,actor:g,actorChooses:h,disallowedIds:i.excludeSelf?[a.id]:[],followUpEffect:f==null?void 0:f.thenEffect,conditionalType:f==null?void 0:f.type,allowedIds:C,targetFilter:i.targetFilter,scope:i.scope,protocolMatching:i.protocolMatching},{newState:b}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Discard Effect Executor
 *
 * Handles all discard-related effects.
 * Extracted 1:1 from effectInterpreter.ts for modularity.
 */function Y0(a,t,l,c,i){const{cardOwner:d}=c,f=i._conditional;if(i.actor==="both"){let S={...l};const E=A=>{const I=S[A].hand;if(I.length===0)return{discardedCount:0,discardedCards:[]};const U=I.map(({id:$,isFaceUp:Z,...ee})=>ee);return S[A]={...S[A],hand:[],discard:[...S[A].discard,...U],stats:{...S[A].stats,cardsDiscarded:S[A].stats.cardsDiscarded+U.length}},{discardedCount:U.length,discardedCards:U}},b=E(d),j=d==="player"?"Player":"Opponent";if(b.discardedCount>0){const A=b.discardedCards.map(I=>`${I.protocol}-${I.value}`).join(", ");S=ne(S,d,`${j} discards their hand (${b.discardedCount} cards: ${A}).`)}else S=ne(S,d,`${j} has no cards to discard.`);const C=E(c.opponent),R=c.opponent==="player"?"Player":"Opponent";if(C.discardedCount>0){const A=C.discardedCards.map(I=>`${I.protocol}-${I.value}`).join(", ");S=ne(S,c.opponent,`${R} discards their hand (${C.discardedCount} cards: ${A}).`)}else S=ne(S,c.opponent,`${R} has no cards to discard.`);return S._discardContext={actor:"both",discardedCount:b.discardedCount+C.discardedCount,sourceCardId:a.id},{newState:S}}const p=i.actor==="opponent"?c.opponent:d;if(i.useCardFromPreviousEffect&&l.lastCustomEffectTargetCardId){const S=l.lastCustomEffectTargetCardId;let E={...l};const b={...E[p]},j=`${a.protocol}-${a.value}`,C=p==="player"?"Player":"Opponent",R=b.deck.findIndex(I=>I.id===S);if(R!==-1){const I=[...b.deck],U=I.splice(R,1)[0];return b.deck=I,b.discard=[...b.discard,U],E[p]=b,E=ne(E,p,`${C} discards ${U.protocol}-${U.value} from their deck.`),E._discardContext={actor:p,discardedCount:1,sourceCardId:a.id},{newState:E}}const A=b.hand.findIndex(I=>I.id===S);if(A!==-1){const I=[...b.hand],U=I.splice(A,1)[0],{id:$,isFaceUp:Z,...ee}=U;return b.hand=I,b.discard=[...b.discard,ee],E[p]=b,E=ne(E,p,`${C} discards ${U.protocol}-${U.value}.`),E._discardContext={actor:p,discardedCount:1,sourceCardId:a.id},{newState:E}}return console.warn(`[Discard Effect] useCardFromPreviousEffect: Card ${S} not found`),E=ne(E,p,`${j}: Card to discard not found - effect skipped.`),E._discardContext={discardedCount:0},{newState:E}}const u=i.source||"hand";if(u==="entire_deck"){let S={...l};const E={...S[d]},b=`${a.protocol}-${a.value}`;if(E.deck.length===0)return S=ne(S,d,`${b}: No cards in deck - effect skipped.`),S._effectSkippedNoTargets=!0,S._discardContext={discardedCount:0},{newState:S};const j=E.deck.length,C=[...E.deck];return E.discard=[...E.discard,...C],E.deck=[],S[d]=E,S=ne(S,d,`${b}: Discards entire deck (${j} card${j!==1?"s":""}).`),S._discardContext={actor:d,discardedCount:j,sourceCardId:a.id},{newState:S}}if(u==="top_deck_own"||u==="top_deck_opponent"){const S=u==="top_deck_own"?d:c.opponent;let E={...l};const b={...E[S]},j=S===d?"your":"opponent's";if(b.deck.length===0)return E=ne(E,d,`No cards in ${j} deck - effect skipped.`),E._effectSkippedNoTargets=!0,E._discardContext={discardedCount:0},{newState:E};const C=[...b.deck],R=C.shift();return b.deck=C,b.discard=[...b.discard,R],E[S]=b,E=ne(E,d,`Discard the top card of ${j} deck: ${R.protocol}-${R.value}.`),E.lastCustomEffectTargetCardId=R.id,E.lastCustomEffectTargetValue=R.value,E._discardContext={actor:S,discardedCount:1,sourceCardId:a.id,discardedCardValue:R.value,discardedCardProtocol:R.protocol},E.actionRequired={type:"confirm_deck_discard",actor:d,sourceCardId:a.id,discardedCard:R,deckOwner:u==="top_deck_own"?"own":"opponent",followUpEffect:f==null?void 0:f.thenEffect,conditionalType:f==null?void 0:f.type,laneIndex:t},{newState:E}}let h=i.count||1;if((i.countType||"fixed")==="equal_to_discarded"){const S=(c.discardedCount||0)+(i.countOffset||0);if(h=Math.min(S,l[p].hand.length),h<=0)return{newState:l}}if(l[p].hand.length===0){let E=ne(l,p,`${p==="player"?"Player":"Opponent"} has no cards to discard - effect skipped.`);return E._effectSkippedNoTargets=!0,E._discardContext={discardedCount:0},{newState:E}}i.upTo&&(h=Math.min(h,l[p].hand.length));const g=h;typeof h=="number"&&h>l[p].hand.length&&(h=l[p].hand.length);const _=!i.upTo&&typeof g=="number"&&g>h;if(i.random&&p!==d){const S=[...l[p].hand],E=Math.min(h,S.length),b=[],j=S.map((z,O)=>O);for(let z=0;z<E&&j.length>0;z++){const O=Math.floor(Math.random()*j.length);b.push(j[O]),j.splice(O,1)}b.sort((z,O)=>O-z);const C=[],R=[...S];for(const z of b){const{id:O,isFaceUp:k,...q}=R.splice(z,1)[0];C.push(q)}const A=[...l[p].discard,...C],I={...l[p].stats,cardsDiscarded:l[p].stats.cardsDiscarded+C.length},U={...l[p],hand:R,discard:A,stats:I};let $={...l,[p]:U,stats:{...l.stats,[p]:I}};const Z=p==="player"?"Player":"Opponent",ee=C.length===1?"card":"cards";if(p==="player"||C.every(z=>z.isRevealed)){const z=C.map(O=>`${O.protocol}-${O.value}`).join(", ");$=ne($,p,`${Z} randomly discards ${C.length} ${ee}: ${z}.`)}else $=ne($,p,`${Z} randomly discards ${C.length} ${ee}.`);return $._discardContext={actor:p,discardedCount:C.length,sourceCardId:a.id},{newState:$}}if(h==="all"){const S=l[p].hand,E=S.map(({id:U,isFaceUp:$,...Z})=>Z),b=[],j=[...l[p].discard,...E],C={...l[p].stats,cardsDiscarded:l[p].stats.cardsDiscarded+E.length},R={...l[p],hand:b,discard:j,stats:C};let A={...l,[p]:R,stats:{...l.stats,[p]:C}};const I=p==="player"?"Player":"Opponent";if(p==="player"||E.every(U=>U.isRevealed)){const U=E.map($=>`${$.protocol}-${$.value}`).join(", ");A=ne(A,p,`${I} discards entire hand (${E.length} cards: ${U}).`)}else A=ne(A,p,`${I} discards entire hand (${E.length} cards).`);return A._discardContext={actor:p,discardedCount:E.length,previousHandSize:S.length,sourceCardId:a.id},{newState:A}}let x={...l};return _&&(x=ne(x,p,`${p==="player"?"Player":"Opponent"} only has ${h} card${h!==1?"s":""} (${g} required) - discarding all.`)),x.actionRequired={type:"discard",actor:p,count:h,sourceCardId:a.id,variableCount:i.variableCount||!1,previousHandSize:l[p].hand.length,followUpEffect:f==null?void 0:f.thenEffect,conditionalType:f==null?void 0:f.type,_savedIndentLevel:l._logIndentLevel},{newState:x}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Shift Effect Executor
 *
 * Handles all shift-related effects.
 * Extracted 1:1 from effectInterpreter.ts for modularity.
 */function G0(a,t,l,c,i){var $,Z,ee,z;const{cardOwner:d}=c,f=i._conditional;let p={...l};if((($=i.advancedConditional)==null?void 0:$.type)==="empty_hand"&&l[d].hand.length>0)return{newState:l};if(((Z=i.advancedConditional)==null?void 0:Z.type)==="opponent_higher_value_in_lane"){const O=d==="player"?"opponent":"player",k=ta(l,d,t);if(ta(l,O,t)<=k)return{newState:l}}if(((ee=i.advancedConditional)==null?void 0:ee.type)==="this_card_is_covered"){const O=l[d].lanes;let k=!1;for(let q=0;q<O.length;q++){const F=O[q],D=F.findIndex(T=>T.id===a.id);if(D!==-1){k=D<F.length-1;break}}if(!k)return{newState:l}}if(i.useCardFromPreviousEffect&&l.lastCustomEffectTargetCardId){const O=l.lastCustomEffectTargetCardId,k=Se(l,O);if(!k)return{newState:ne(l,d,"Target card from previous effect no longer exists. Shift skipped.")};const q=i.destinationRestriction;if((q==null?void 0:q.type)==="to_this_lane"){const D=q.laneIndex==="current"?t:q.laneIndex;if(D===void 0||D<0||D>2)return console.error(`[Shift Effect] Invalid target lane index: ${D}`),{newState:l};const T=Fo(l,O,k.owner,D,d);return{newState:T.newState,animationRequests:T.animationRequests}}let F=-1;for(let D=0;D<l[k.owner].lanes.length;D++)if(l[k.owner].lanes[D].some(T=>T.id===O)){F=D;break}return F===-1?{newState:l}:(p.actionRequired={type:"select_lane_for_shift",cardToShiftId:O,cardOwner:k.owner,originalLaneIndex:F,sourceCardId:a.id,actor:d,destinationRestriction:q,followUpEffect:f==null?void 0:f.thenEffect,conditionalType:f==null?void 0:f.type},{newState:p})}const u=l._selectedCardFromPreviousEffect;if(p._selectedCardFromPreviousEffect&&delete p._selectedCardFromPreviousEffect,u&&i.useCardFromPreviousEffect){const O=i.destinationRestriction;if((O==null?void 0:O.type)==="to_this_lane"){const k=O.laneIndex==="current"?t:O.laneIndex;if(k===void 0||k<0||k>2)return console.error(`[Shift Effect] Invalid target lane index: ${k}`),{newState:p};const q=Se(p,u);if(!q)return console.error(`[Shift Effect] Selected card not found: ${u}`),{newState:p};const F=Fo(p,u,q.owner,k,d);return{newState:F.newState,animationRequests:F.animationRequests}}return p.actionRequired={type:"shift_flipped_card_optional",cardId:u,sourceCardId:a.id,optional:i.optional||!1,actor:d,followUpEffect:f==null?void 0:f.thenEffect,conditionalType:f==null?void 0:f.type},{newState:p}}if(i.shiftSelf){if(((z=i.destinationRestriction)==null?void 0:z.type)==="opponent_highest_value_lane"){const O=jm(p,d);if(O.includes(t))return p=ne(p,d,"Card is already in opponent's highest value lane. Shift skipped."),{newState:p};const k=O.filter(q=>q!==t);if(k.length===0)return p=ne(p,d,"No valid destination lane. Shift skipped."),{newState:p};if(k.length===1){if(i.optional)return p.actionRequired={type:"select_lane_for_shift",cardToShiftId:a.id,cardOwner:d,originalLaneIndex:t,sourceCardId:a.id,actor:d,validLanes:k,destinationRestriction:i.destinationRestriction,optional:!0,followUpEffect:f==null?void 0:f.thenEffect,conditionalType:f==null?void 0:f.type},{newState:p};const q=k[0],F=Fo(p,a.id,d,q,d);return{newState:F.newState,animationRequests:F.animationRequests}}return p.actionRequired={type:"select_lane_for_shift",cardToShiftId:a.id,cardOwner:d,originalLaneIndex:t,sourceCardId:a.id,actor:d,validLanes:k,destinationRestriction:i.destinationRestriction,optional:i.optional||!1,followUpEffect:f==null?void 0:f.thenEffect,conditionalType:f==null?void 0:f.type},{newState:p}}return p.actionRequired={type:"shift_flipped_card_optional",cardId:a.id,sourceCardId:a.id,optional:i.optional||!1,actor:d,allowCovered:i.allowCoveredSelf||!1,followUpEffect:f==null?void 0:f.thenEffect,conditionalType:f==null?void 0:f.type},{newState:p}}const h=i.targetFilter||{},y=h.position||"uncovered",g=h.faceState||"any",_=h.owner||"any",x=h.excludeSelf||!1,S=i.count||1;if(y==="any"&&_==="own"&&!x&&S===1)return p.actionRequired={type:"shift_flipped_card_optional",cardId:a.id,sourceCardId:a.id,optional:i.optional||!1,actor:d,followUpEffect:f==null?void 0:f.thenEffect,conditionalType:f==null?void 0:f.type},{newState:p};const b=[];for(const O of["player","opponent"])if(!(_==="own"&&O!==d)&&!(_==="opponent"&&O===d))for(let k=0;k<p[O].lanes.length;k++){if(i.scope==="this_lane"&&k!==t)continue;const q=p[O].lanes[k];for(let F=0;F<q.length;F++){const D=q[F];if(Io(p,D.id)||x&&D.id===a.id)continue;const T=Lo(p,q,F);y==="uncovered"&&!T||y==="covered"&&T||g==="face_up"&&!D.isFaceUp||g==="face_down"&&D.isFaceUp||b.push({card:D,currentLane:k,owner:O})}}if(b.length===0)return p=ne(p,d,"No valid cards to shift."),p._effectSkippedNoTargets=!0,{newState:p};if((S==="all"||typeof S!="number"&&S!==1)&&b.length>0){const O=[],k=i.destinationRestriction;for(let q=0;q<3;q++){if((k==null?void 0:k.type)==="to_another_line"){if(q===t)continue}else if((k==null?void 0:k.type)==="to_this_lane"){const F=k.laneIndex==="current"?t:k.laneIndex;if(q!==F)continue}else if(!k&&q===t)continue;O.push(q)}return O.length===0?(p=ne(p,d,"No valid destination lanes for shifting all cards."),{newState:p}):(p=ne(p,d,`Shifting ${b.length} card(s) from this lane.`),p.actionRequired={type:"select_lane_for_shift_all",sourceCardId:a.id,actor:d,cardsToShift:b.map(q=>({cardId:q.card.id,owner:q.owner})),validDestinationLanes:O,sourceLaneIndex:t,followUpEffect:f==null?void 0:f.thenEffect,conditionalType:f==null?void 0:f.type},{newState:p})}const C=i.destinationRestriction;let R=!1;const A=(C==null?void 0:C.laneIndex)==="current"?t:C==null?void 0:C.laneIndex;for(const{card:O,currentLane:k,owner:q}of b){if((C==null?void 0:C.type)==="non_matching_protocol"&&!O.isFaceUp)continue;const F=O.protocol;for(let D=0;D<3;D++){if(C){if(C.type==="non_matching_protocol"){if(D===k)continue;const L=p.player.protocols[D],B=p.opponent.protocols[D];if(F===L||F===B)continue}else if(C.type==="specific_lane"){if(D!==k)continue}else if(C.type==="to_this_lane"){if(D!==A||k===A)continue}else if(C.type==="to_another_line"){if(D===k)continue}else if(C.type==="to_or_from_this_lane"&&(!(k===A)&&!(D===A)||D===k))continue}else if(D===k)continue;if(Jl(p,k,D).allowed){R=!0;break}}if(R)break}if(!R)return p=ne(p,d,"No valid shift destinations available."),{newState:p};const I=C&&A!==void 0?{...C,laneIndex:A}:C,U=(C==null?void 0:C.type)==="to_this_lane"&&A!==void 0?A:void 0;return p.actionRequired={type:"select_card_to_shift",sourceCardId:a.id,actor:d,targetFilter:i.targetFilter,destinationRestriction:I,sourceLaneIndex:t,targetLaneIndex:U,scope:i.scope,followUpEffect:f==null?void 0:f.thenEffect,conditionalType:f==null?void 0:f.type},{newState:p}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Return Effect Executor
 *
 * Handles all return-related effects.
 * Extracted 1:1 from effectInterpreter.ts for modularity.
 */function W0(a,t,l,c,i){var x,S,E,b;const{cardOwner:d,opponent:f}=c,p=i._conditional;i.count==="all"||i.count;const u=((x=i.targetFilter)==null?void 0:x.owner)||"any",h=((S=i.targetFilter)==null?void 0:S.position)||"uncovered";if(((E=i.advancedConditional)==null?void 0:E.type)==="empty_hand"&&l[d].hand.length>0)return{newState:l};if(((b=i.advancedConditional)==null?void 0:b.type)==="opponent_higher_value_in_lane"){const j=d==="player"?"opponent":"player",C=ta(l,d,t);if(ta(l,j,t)<=C)return{newState:l}}if(i.selectLane){let j={...l};return j.actionRequired={type:"select_lane_for_return",sourceCardId:a.id,actor:d,count:i.count,targetFilter:i.targetFilter,followUpEffect:p==null?void 0:p.thenEffect,conditionalType:p==null?void 0:p.type},{newState:j}}let y=[];const g=j=>{for(const C of l[j].lanes)for(let R=0;R<C.length;R++){const A=C[R];if(Io(l,A.id))continue;const I=Lo(l,C,R);h==="uncovered"&&!I||h==="covered"&&I||y.push({card:A,isUncovered:I})}};if(u==="own"?g(d):u==="opponent"?g(f):(g("player"),g("opponent")),y.length===0)return{newState:ne(l,d,"No cards on board to return. Effect skipped.")};let _={...l};return _.actionRequired={type:"select_card_to_return",sourceCardId:a.id,actor:d,targetOwner:u,targetFilter:i.targetFilter,followUpEffect:p==null?void 0:p.thenEffect,conditionalType:p==null?void 0:p.type},{newState:_}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Play Effect Executor
 *
 * Handles all play-related effects (play cards from hand/deck to board).
 * Extracted 1:1 from effectInterpreter.ts for modularity.
 */function Q0(a,t,l,c,i){var E,b,j,C,R,A,I,U,$,Z,ee;const{cardOwner:d,opponent:f}=c,p=i._conditional,u=i.count||1,h=i.source||"hand",y=i.faceDown,g=i.actor==="opponent"?f:d;if(((E=i.advancedConditional)==null?void 0:E.type)==="empty_hand"&&l[d].hand.length>0)return{newState:l};if(((b=i.advancedConditional)==null?void 0:b.type)==="opponent_higher_value_in_lane"){const z=d==="player"?"opponent":"player",O=ta(l,d,t);if(ta(l,z,t)<=O)return{newState:l}}if(h==="deck"&&((j=i.destinationRule)==null?void 0:j.type)==="each_other_line"){const z=[0,1,2].filter(M=>M!==t);if(z.length===0)return{newState:l};const O=l[g];if(O.deck.length===0&&O.discard.length===0)return{newState:ne(l,d,`${g==="player"?"Player":"Opponent"} has no cards in deck/discard - effect skipped.`)};const{drawnCards:k,remainingDeck:q,newDiscard:F}=Pn(O.deck,O.discard,z.length);if(k.length===0)return{newState:l};const D=k.map(M=>({...M,id:ot(),isFaceUp:!1})),T=[...O.lanes];for(let M=0;M<D.length;M++){const W=z[M];T[W]=[...T[W],D[M]]}const L={...O,lanes:T,deck:q,discard:F};let B={...l,[g]:L};if(B.detailedGameStats&&k.length>0){const M=g==="player"?"playerFromEffect":"aiFromEffect",W=g==="player"?"playerFaceDown":"aiFaceDown";B={...B,detailedGameStats:{...B.detailedGameStats,cardsPlayed:{...B.detailedGameStats.cardsPlayed,[M]:B.detailedGameStats.cardsPlayed[M]+k.length,[W]:B.detailedGameStats.cardsPlayed[W]+k.length}}}}const G=Se(l,a.id),ae=G?`${G.card.protocol}-${G.card.value}`:"a card effect";return B=ne(B,d,`${ae}: Plays ${k.length} card(s) face-down in other lines.`),{newState:B}}if(h==="deck"&&((C=i.destinationRule)==null?void 0:C.type)==="each_line_with_card"){const z=i.destinationRule.ownerFilter||"any",O=i.destinationRule.cardFilter,k=z==="own"?g:z==="opponent"?g==="player"?"opponent":"player":null,q=K=>{const X=se=>se.length===0?!1:O?se.some(ie=>O.faceState==="face_down"?!ie.isFaceUp:O.faceState==="face_up"?ie.isFaceUp:!0):!0;return k?X(l[k].lanes[K]):X(l.player.lanes[K])||X(l.opponent.lanes[K])},F=[];for(let K=0;K<3;K++)q(K)&&F.push(K);if(F.length===0)return{newState:l};const D=l[g];if(D.deck.length===0&&D.discard.length===0)return{newState:ne(l,d,`${g==="player"?"Player":"Opponent"} has no cards in deck/discard - effect skipped.`)};const{drawnCards:T,remainingDeck:L,newDiscard:B}=Pn(D.deck,D.discard,F.length);if(T.length===0)return{newState:l};const G=T.map(K=>({...K,id:ot(),isFaceUp:!y}));let ae=l;const M=[];for(let K=0;K<F.length;K++){const X=F[K],se=ae[g].lanes[X];if(se.length>0){const ie=se[se.length-1],_e={...c,triggerType:"cover"},ye=Kd(ie,X,ae,_e);if(ae=ye.newState,ye.animationRequests&&M.push(...ye.animationRequests),ae.actionRequired)break}}const W=[...ae[g].lanes],oe=[];for(let K=0;K<G.length;K++){const X=F[K];W[X]=[...W[X],G[K]],oe.push({type:"play",cardId:G[K].id,owner:g})}const Q={...ae[g],lanes:W,deck:L,discard:B};let V={...ae,[g]:Q};if(V.detailedGameStats&&T.length>0){const K=g==="player"?"playerFromEffect":"aiFromEffect",X=g==="player"?"playerFaceDown":"aiFaceDown";V={...V,detailedGameStats:{...V.detailedGameStats,cardsPlayed:{...V.detailedGameStats.cardsPlayed,[K]:V.detailedGameStats.cardsPlayed[K]+T.length,[X]:V.detailedGameStats.cardsPlayed[X]+T.length}}}}const J=Se(l,a.id),me=J?`${J.card.protocol}-${J.card.value}`:"a card effect";let ge="";(O==null?void 0:O.faceState)==="face_down"?ge="with a face-down card":(O==null?void 0:O.faceState)==="face_up"?ge="with a face-up card":z==="own"?ge="where you have a card":z==="opponent"?ge="where opponent has a card":ge="with a card",V=ne(V,d,`${me}: Plays ${T.length} card(s) face-down in each line ${ge}.`);const Y=[...M,...oe];return{newState:V,animationRequests:Y.length>0?Y:void 0}}if(h==="deck"&&((R=i.destinationRule)==null?void 0:R.type)==="another_line"){if([0,1,2].filter(L=>L!==t).length===0)return{newState:l};const O=l[g];if(O.deck.length===0&&O.discard.length===0)return{newState:ne(l,d,`${g==="player"?"Player":"Opponent"} has no cards in deck/discard - effect skipped.`)};const{drawnCards:k,remainingDeck:q,newDiscard:F}=Pn(O.deck,O.discard,1);if(k.length===0)return{newState:l};const D={...k[0],id:ot(),isFaceUp:!0};let T={...l,[g]:{...O,deck:q,discard:F}};return T.actionRequired={type:"confirm_deck_play_preview",sourceCardId:a.id,actor:g,drawnCard:D,isFaceDown:i.faceDown,excludeCurrentLane:!0,currentLaneIndex:t,followUpEffect:p==null?void 0:p.thenEffect,conditionalType:p==null?void 0:p.type},{newState:T}}if(h==="deck"&&((A=i.destinationRule)==null?void 0:A.type)==="under_this_card"&&((I=i.condition)==null?void 0:I.type)==="per_x_cards_in_line"){const z=i.condition.cardCount||2,O=l[d].lanes[t].length,k=l[f].lanes[t].length,q=O+k,F=Math.floor(q/z);if(F===0)return{newState:l};const D=l[g];if(D.deck.length===0&&D.discard.length===0)return{newState:l};const{drawnCards:T,remainingDeck:L,newDiscard:B}=Pn(D.deck,D.discard,F);if(T.length===0)return{newState:l};const G=T.map(J=>({...J,id:ot(),isFaceUp:!1})),ae=[...D.lanes[t]];ae.splice(ae.length-1,0,...G);const M=[...D.lanes];M[t]=ae;const W={...D,lanes:M,deck:L,discard:B};let oe={...l,[g]:W};if(oe.detailedGameStats&&T.length>0){const J=g==="player"?"playerFromEffect":"aiFromEffect",me=g==="player"?"playerFaceDown":"aiFaceDown";oe={...oe,detailedGameStats:{...oe.detailedGameStats,cardsPlayed:{...oe.detailedGameStats.cardsPlayed,[J]:oe.detailedGameStats.cardsPlayed[J]+T.length,[me]:oe.detailedGameStats.cardsPlayed[me]+T.length}}}}const Q=Se(l,a.id),V=Q?`${Q.card.protocol}-${Q.card.value}`:"a card effect";return oe=ne(oe,d,`${V}: Plays ${T.length} card(s) face-down under itself.`),{newState:oe}}if(h==="deck"&&((U=i.destinationRule)==null?void 0:U.type)==="specific_lane"){const z=i.destinationRule.laneIndex==="current"?t:i.destinationRule.laneIndex;if(z===void 0||z<0||z>2)return console.error(`[Play Effect] Invalid lane index: ${z}`),{newState:l};const O=l[g];if(O.deck.length===0&&O.discard.length===0)return{newState:ne(l,d,`${g==="player"?"Player":"Opponent"} has no cards in deck/discard - effect skipped.`)};const{drawnCards:k,remainingDeck:q,newDiscard:F}=Pn(O.deck,O.discard,u);if(k.length===0)return{newState:l};const D=k.map(Q=>({...Q,id:ot(),isFaceUp:!y})),T=[...O.lanes];T[z]=[...T[z],...D];const L={...O,lanes:T,deck:q,discard:F};let B={...l,[g]:L};if(B.detailedGameStats&&k.length>0){const Q=g==="player"?"playerFromEffect":"aiFromEffect",V=g==="player"?y?"playerFaceDown":"playerFaceUp":y?"aiFaceDown":"aiFaceUp";B={...B,detailedGameStats:{...B.detailedGameStats,cardsPlayed:{...B.detailedGameStats.cardsPlayed,[Q]:B.detailedGameStats.cardsPlayed[Q]+k.length,[V]:B.detailedGameStats.cardsPlayed[V]+k.length}}}}const G=Se(l,a.id),ae=G?`${G.card.protocol}-${G.card.value}`:"a card effect",M=g==="player"?"Player":"Opponent",W=y?"face-down":"face-up",oe=l.player.protocols[z];return B=ne(B,d,`${ae}: ${M} plays ${k.length} card(s) ${W} in ${oe} line.`),{newState:B}}if(h==="hand"&&(($=i.destinationRule)==null?void 0:$.type)==="line_with_matching_cards"){const z=i.destinationRule.cardFilter,O=F=>{const D=T=>T.length===0?!1:z?T.some(L=>z.faceState==="face_down"?!L.isFaceUp:z.faceState==="face_up"?L.isFaceUp:!0):!0;return D(l.player.lanes[F])||D(l.opponent.lanes[F])},k=[];for(let F=0;F<3;F++)O(F)&&k.push(F);if(k.length===0){const F=Se(l,a.id),D=F?`${F.card.protocol}-${F.card.value}`:"Effect";return{newState:ne(l,d,`${D}: No valid lanes with face-down cards. Effect skipped.`)}}if(l[g].hand.length===0)return{newState:l};let q={...l};return q.actionRequired={type:"select_card_from_hand_to_play",sourceCardId:a.id,actor:g,count:i.count||1,faceDown:i.faceDown,source:"hand",validLanes:k,cardFilter:z,followUpEffect:p==null?void 0:p.thenEffect,conditionalType:p==null?void 0:p.type},{newState:q}}if(h==="hand"&&((Z=i.valueFilter)==null?void 0:Z.equals)!==void 0&&!i.destinationRule){const z=i.valueFilter.equals,O=l[g].hand.filter(q=>q.value===z);if(O.length===0){const q=Se(l,a.id),F=q?`${q.card.protocol}-${q.card.value}`:"Effect";return{newState:ne(l,d,`${F}: No cards with value ${z} in hand. Effect skipped.`)}}let k={...l};return k.actionRequired={type:"select_card_from_hand_to_play",sourceCardId:a.id,actor:g,count:i.count||1,faceDown:i.faceDown,source:"hand",valueFilter:z,selectableCardIds:O.map(q=>q.id),followUpEffect:p==null?void 0:p.thenEffect,conditionalType:p==null?void 0:p.type},{newState:k}}if(h==="trash"){if(l[g].discard.length===0){const k=Se(l,a.id),q=k?`${k.card.protocol}-${k.card.value}`:"Effect";return{newState:ne(l,d,`${q}: No cards in trash. Effect skipped.`)}}let O={...l};return O.actionRequired={type:"select_card_from_trash_to_play",sourceCardId:a.id,actor:g,count:i.count||1,faceDown:i.faceDown,destinationRule:i.destinationRule,followUpEffect:p==null?void 0:p.thenEffect,conditionalType:p==null?void 0:p.type,sourceLaneIndex:t},{newState:O}}if(h==="hand"&&l[g].hand.length===0)return{newState:l};let _={...l},x;(ee=i.destinationRule)!=null&&ee.excludeCurrentLane&&(x=t);let S;if(i.useCardFromPreviousEffect&&h==="hand"){const z=l.lastCustomEffectTargetCardId;if(z&&(S=[z],!l[g].hand.find(k=>k.id===z)))return{newState:l}}return _.actionRequired={type:"select_card_from_hand_to_play",count:u,sourceCardId:a.id,actor:g,faceDown:y,source:h,disallowedLaneIndex:x,destinationRule:i.destinationRule,condition:i.condition,selectableCardIds:S,followUpEffect:p==null?void 0:p.thenEffect,conditionalType:p==null?void 0:p.type},{newState:_}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Reveal/Give Effect Executor
 *
 * Handles reveal and give card effects.
 * Extracted 1:1 from effectInterpreter.ts for modularity.
 */function X0(a,t,l,c,i){const{cardOwner:d,opponent:f}=c,p=i._conditional,u=i.count||1,h=i.action,y=i.source||"own_hand";if(h==="reveal"&&y==="board"){const _=i.targetFilter||{owner:"any",position:"uncovered",faceState:"face_down"},x=i.followUpAction,S=i.optional!==!1,E=[],b=_.owner==="own"?[d]:_.owner==="opponent"?[f]:[d,f];for(const C of b)for(let R=0;R<l[C].lanes.length;R++){const A=l[C].lanes[R];if(A.length>0){let I=[];_.position==="uncovered"?I=[A[A.length-1]]:_.position==="covered"?I=A.slice(0,-1):I=[...A];const U=I.filter($=>_.faceState==="face_up"?$.isFaceUp:_.faceState==="face_down"?!$.isFaceUp:!0);E.push(...U)}}if(E.length===0)return{newState:ne(l,d,"No valid cards to reveal. Effect skipped.")};let j={...l};return j.actionRequired={type:"select_board_card_to_reveal_custom",sourceCardId:a.id,actor:d,targetFilter:_,followUpAction:x,optional:S,followUpEffect:p==null?void 0:p.thenEffect,conditionalType:p==null?void 0:p.type},{newState:j}}if(h==="reveal"&&y==="opponent_hand"){let _={...l};const x={..._[f]};if(x.hand.length>0){x.hand=x.hand.map(E=>({...E,isRevealed:!0})),_[f]=x;const S=`${a.protocol}-${a.value}`;_=ne(_,d,`${S}: Your opponent reveals their hand.`)}else{const S=`${a.protocol}-${a.value}`;_=ne(_,d,`${S}: Opponent has no cards to reveal.`)}return{newState:_}}if(h==="reveal"&&y==="own_deck_top"){let _={...l};const x={..._[d]},S=`${a.protocol}-${a.value}`;if(x.deck.length===0)return _=ne(_,d,`${S}: No cards in deck to reveal.`),{newState:_};const E=[...x.deck],b=E[0];_=ne(_,d,`${S}: Revealed ${b.protocol}-${b.value} from top of deck.`);const j=`deck-top-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;return E[0]={...b,id:j},x.deck=E,_[d]=x,_.lastCustomEffectTargetCardId=j,{newState:_}}if(h==="reveal"&&y==="own_trash"){let _={...l};const x={..._[d]},S=`${a.protocol}-${a.value}`;return x.discard.length===0?(_=ne(_,d,`${S}: No cards in trash to reveal.`),_._effectSkippedNoTargets=!0,{newState:_}):(_.actionRequired={type:"select_card_from_trash_to_reveal",sourceCardId:a.id,actor:d,count:u,followUpEffect:p==null?void 0:p.thenEffect,conditionalType:p==null?void 0:p.type,sourceLaneIndex:t},{newState:_})}if(h==="reveal"&&y==="own_deck"){let _={...l};const x={..._[d]},S=`${a.protocol}-${a.value}`;if(x.deck.length===0)return _=ne(_,d,`${S}: No cards in deck to reveal.`),{newState:_};x.deckRevealed=!0,_[d]=x;const E=x.deck.map(b=>`${b.protocol}-${b.value}`).join(", ");return _=ne(_,d,`${S}: Revealed deck: ${E}`),{newState:_}}if(l[d].hand.length===0)return{newState:ne(l,d,`No cards in hand to ${h}. Effect skipped.`)};let g={...l};return h==="reveal"?g.actionRequired={type:"select_card_from_hand_to_reveal",count:u,sourceCardId:a.id,actor:d,followUpEffect:p==null?void 0:p.thenEffect,conditionalType:p==null?void 0:p.type}:h==="give"&&(g.actionRequired={type:"select_card_from_hand_to_give",count:u,sourceCardId:a.id,actor:d,followUpEffect:p==null?void 0:p.thenEffect,conditionalType:p==null?void 0:p.type}),{newState:g}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Shuffle Effect Executor
 *
 * Handles shuffle_trash and shuffle_deck effects.
 * - shuffle_trash: Clarity-4 "You may shuffle your trash into your deck."
 *   (In this codebase, "trash" = "discard pile")
 * - shuffle_deck: Clarity-2/3 "Shuffle your deck."
 */function Z0(a,t,l,c,i){var h;const{cardOwner:d}=c,f=i._conditional,p=`${a.protocol}-${a.value}`,u=i.optional!==!1;if(((h=i.advancedConditional)==null?void 0:h.type)==="trash_not_empty"&&l[d].discard.length===0)return{newState:ne(l,d,`${p}: No cards in trash - effect skipped.`)};if(l[d].discard.length===0)return{newState:ne(l,d,`${p}: No cards in trash to shuffle.`)};if(u){let y={...l};return y.actionRequired={type:"prompt_optional_shuffle_trash",sourceCardId:a.id,actor:d,trashCount:l[d].discard.length,followUpEffect:f==null?void 0:f.thenEffect,conditionalType:f==null?void 0:f.type},{newState:y}}return Sm(l,d,p)}function Sm(a,t,l){let c={...a};const i={...c[t]},d=i.discard.length;return d===0?(c=ne(c,t,`${l}: No cards in trash to shuffle.`),{newState:c}):(i.deck=[...i.deck,...i.discard],i.discard=[],i.deck=In([...i.deck]),c[t]=i,c=ne(c,t,`${l}: Shuffled ${d} card${d!==1?"s":""} from trash into deck.`),c=gt(c,"after_shuffle",{player:t}).newState,{newState:c})}function K0(a,t,l,c,i){const{cardOwner:d}=c,f=`${a.protocol}-${a.value}`;let p={...l};const u={...p[d]};return u.deck.length===0?(p=ne(p,d,`${f}: No cards in deck to shuffle.`),{newState:p}):(u.deck=In([...u.deck]),u.deckRevealed=!1,p[d]=u,p=ne(p,d,`${f}: Shuffled deck.`),p=gt(p,"after_shuffle",{player:d}).newState,{newState:p})}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * State Number Effect Executor
 *
 * Handles the "state a number" effect (Luck-0).
 * Player chooses a number (0-5) which is stored in state for subsequent effects.
 */function J0(a,t,l,c,i){const{cardOwner:d}=c;let f={...l};return f.actionRequired={type:"state_number",actor:d,sourceCardId:a.id,numberSource:i.numberSource||"own_protocol_values"},{newState:f}}function ew(a,t,l){let c={...a};return c.lastStatedNumber=l,c=ne(c,t,`${t==="player"?"Player":"Opponent"} states the number ${l}.`),c.actionRequired=null,c}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * State Protocol Effect Executor
 *
 * Handles the "state a protocol" effect (Luck-3).
 * Player chooses a protocol from opponent's cards which is stored for subsequent effects.
 */function tw(a,t){const l=new Set;a[t].deck.forEach(f=>l.add(f.protocol)),a[t].hand.forEach(f=>l.add(f.protocol)),a[t].lanes.forEach(f=>{f.forEach(p=>l.add(p.protocol))}),a[t].discard.forEach(f=>l.add(f.protocol));const c=[],i=a[t].protocols;for(const f of i)l.has(f)&&!c.includes(f)&&c.push(f);const d=Array.from(l).filter(f=>!c.includes(f)).sort();return c.push(...d),c}function nw(a,t,l,c,i){const{cardOwner:d,opponent:f}=c;let p=[];if(i.protocolSource==="opponent_cards"&&(p=tw(l,f)),p.length===0){let h=ne(l,d,"No protocols available to state - effect skipped.");return h._effectSkippedNoTargets=!0,{newState:h}}let u={...l};return u.actionRequired={type:"state_protocol",actor:d,sourceCardId:a.id,protocolSource:i.protocolSource||"opponent_cards",availableProtocols:p},{newState:u}}function aw(a,t,l){let c={...a};return c.lastStatedProtocol=l,c=ne(c,t,`${t==="player"?"Player":"Opponent"} states the protocol "${l}".`),c.actionRequired=null,c}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Swap Stacks Effect Executor (Mirror-2)
 *
 * Swaps all cards between two of the player's own lanes.
 * Does NOT swap protocols - only the card stacks.
 */function ow(a,t,l,c,i){const{cardOwner:d}=c;if(!l[d].lanes.some(h=>h.length>0))return{newState:ne(l,d,"Cannot swap stacks: no cards on board.")};const p=[0,1,2];let u={...l};return u.actionRequired={type:"select_lanes_for_swap_stacks",actor:d,sourceCardId:a.id,validLanes:p,selectedFirstLane:void 0},{newState:u}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Copy Opponent Middle Effect Executor (Mirror-1)
 *
 * Allows the player to select one of the opponent's face-up uncovered cards
 * and execute its middle effects as if they were on this card.
 */function rw(a){var l,c;return((c=(l=a.customEffects)==null?void 0:l.middleEffects)==null?void 0:c.length)>0}function lw(a){var l;return((l=a.customEffects)==null?void 0:l.middleEffects)||[]}function sw(a,t,l,c,i){const{cardOwner:d}=c,f=d==="player"?"opponent":"player",p=i.optional??!1,u=[];for(let y=0;y<l[f].lanes.length;y++){const g=l[f].lanes[y];if(g.length===0)continue;const _=g[g.length-1];_.isFaceUp&&rw(_)&&u.push(_.id)}if(u.length===0)return{newState:ne(l,d,"No opponent cards with middle commands to copy.")};let h={...l};return h.actionRequired={type:"select_card_for_copy_middle",actor:d,sourceCardId:a.id,validTargetIds:u,optional:p},{newState:h}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function st(a,t,l,c,i,d){var j,C,R;const f={...i.params,_conditional:i.conditional},p=f.action,u=Se(l,a.id);if(!u)return{newState:l};if(!u.card.isFaceUp)return{newState:l};const h=i.position||"middle",g=i.trigger==="on_cover",_=f.useCardFromPreviousEffect===!0;if(h!=="top"&&!g&&!_&&!qo(l,a.id))return{newState:l};const S=p==="reveal"&&f.source==="board";if(f.optional===!0&&!S){const A=f.actor==="opponent"?c.opponent:c.cardOwner,I=A==="player"?"opponent":"player",U=f.targetFilter||{},$=O=>{for(const k of["player","opponent"])for(let q=0;q<l[k].lanes.length;q++){const F=l[k].lanes[q];for(let D=0;D<F.length;D++)if(O(F[D],k,q,D))return!0}return!1};let Z=!0,ee="";switch(p){case"discard":!f.useCardFromPreviousEffect&&l[A].hand.length===0&&(Z=!1,ee="No cards to discard");break;case"flip":{const O=(j=l.passiveEffects)==null?void 0:j.some(k=>k.type==="prevent_flip_to_face_up"&&k.isActive);Z=$((k,q,F,D)=>{if(U.excludeSelf&&k.id===a.id||U.owner==="own"&&q!==A||U.owner==="opponent"&&q===A)return!1;const T=D===l[q].lanes[F].length-1;return!(U.position==="uncovered"&&!T||U.position==="covered"&&T||U.faceState==="face_up"&&!k.isFaceUp||U.faceState==="face_down"&&k.isFaceUp||O&&!k.isFaceUp)}),Z||(ee="No valid cards to flip");break}case"delete":{Z=$((O,k,q,F)=>{if(U.excludeSelf&&O.id===a.id||U.owner==="own"&&k!==A||U.owner==="opponent"&&k===A)return!1;const D=F===l[k].lanes[q].length-1,T=U.position||"uncovered";return!(T==="uncovered"&&!D||T==="covered"&&D||U.faceState==="face_up"&&!O.isFaceUp||U.faceState==="face_down"&&O.isFaceUp)}),Z||(ee="No valid cards to delete");break}case"shift":{if(i.useCardFromPreviousEffect){const O=l.lastCustomEffectTargetCardId||l._selectedCardFromPreviousEffect;O?(Z=!!Se(l,O),Z||(ee="Target card no longer exists")):(Z=!1,ee="No target card from previous effect")}else if(f.shiftSelf&&((C=f.destinationRestriction)==null?void 0:C.type)==="opponent_highest_value_lane")jm(l,c.cardOwner).includes(t)&&(Z=!1,ee="Card is already in opponent's highest value lane");else if(((R=f.advancedConditional)==null?void 0:R.type)==="this_card_is_covered"){const O=l[c.cardOwner].lanes;let k=!1;for(let q=0;q<O.length;q++){const F=O[q],D=F.findIndex(T=>T.id===a.id);if(D!==-1){k=D<F.length-1;break}}k||(Z=!1,ee="Card is not covered")}else{const O=U.position||"uncovered";O==="any"&&U.owner==="own"&&!U.excludeSelf?Z=!0:(Z=$((q,F,D,T)=>{if(U.excludeSelf&&q.id===a.id||U.owner==="own"&&F!==A||U.owner==="opponent"&&F===A)return!1;const L=T===l[F].lanes[D].length-1;return!(O==="uncovered"&&!L||O==="covered"&&L)}),Z||(ee="No valid cards to shift"))}break}case"return":{const O=U.owner==="opponent"?I:A;Z=$((k,q,F,D)=>{if(q!==O)return!1;const T=D===l[q].lanes[F].length-1,L=U.position||"uncovered";return!(L==="uncovered"&&!T||L==="covered"&&T)}),Z||(ee="No valid cards to return");break}case"draw":l[A].deck.length===0&&l[A].discard.length===0&&(Z=!1,ee="No cards to draw");break;case"play":l[A].hand.length===0&&(Z=!1,ee="No cards to play");break}if(!Z){let O=ne(l,A,`${ee} - effect skipped.`);return O._effectSkippedNoTargets=!0,p==="discard"&&(O._discardContext={discardedCount:0}),{newState:O}}let z={...l};return z.actionRequired={type:"prompt_optional_effect",actor:c.cardOwner,sourceCardId:a.id,effectDef:i,laneIndex:t,logSource:l._currentEffectSource,logPhase:l._currentPhaseContext,logIndentLevel:l._logIndentLevel||0},{newState:z}}let E;const b={logSource:l._currentEffectSource,logPhase:l._currentPhaseContext,logIndentLevel:l._logIndentLevel||0};switch(p){case"refresh":{const I=(f.target||"self")==="opponent"?c.opponent:c.actor,U=Zd(l,I);if(!U.allowed){E={newState:ne(l,c.cardOwner,U.reason||"Cannot refresh (draw blocked).")};break}const $=l[I].hand.length,Z=Math.max(0,5-$);if(Z>0){const{drawnCards:ee,remainingDeck:z,newDiscard:O}=Pn(l[I].deck,l[I].discard,Z),k=ee.map(T=>({...T,id:ot()}));let q={...l,[I]:{...l[I],hand:[...l[I].hand,...k],deck:z,discard:O}};const F=I==="player"?` (${ee.map(T=>`${T.protocol}-${T.value}`).join(", ")})`:"";q=ne(q,I,`[Refresh] Drew ${ee.length} cards to reach hand size 5${F}.`),q=gt(q,"after_draw",{player:I,count:ee.length}).newState,E={newState:q}}else E={newState:ne(l,I,`[Refresh] Hand already at ${$} cards, no draw needed.`)};break}case"mutual_draw":{const A=c.actor,I=A==="player"?"opponent":"player",U=f.count||1;let $={...l};if($[I].deck.length>0){const{drawnCards:Z,remainingDeck:ee,newDiscard:z}=Pn($[I].deck,$[I].discard,U);if(Z.length>0){const O=Z.map(D=>({...D,id:ot(),isFaceUp:!0}));$={...$,[I]:{...$[I],deck:ee,discard:z},[A]:{...$[A],hand:[...$[A].hand,...O]}};const k=A==="player"?"Player":"Opponent",q=I==="player"?"Player":"Opponent",F=A==="player"?` (${O.map(D=>`${D.protocol}-${D.value}`).join(", ")})`:"";$=ne($,A,`${k} drew ${Z.length} card(s) from ${q}'s deck${F}.`)}}if($[A].deck.length>0){const{drawnCards:Z,remainingDeck:ee,newDiscard:z}=Pn($[A].deck,$[A].discard,U);if(Z.length>0){const O=Z.map(D=>({...D,id:ot(),isFaceUp:!0}));$={...$,[A]:{...$[A],deck:ee,discard:z},[I]:{...$[I],hand:[...$[I].hand,...O]}};const k=I==="player"?"Player":"Opponent",q=A==="player"?"Player":"Opponent",F=I==="player"?` (${O.map(D=>`${D.protocol}-${D.value}`).join(", ")})`:"";$=ne($,I,`${k} drew ${Z.length} card(s) from ${q}'s deck${F}.`)}}E={newState:$};break}case"draw":E=z0(a,t,l,c,f);break;case"flip":E=V0(a,t,l,c,{...f,useCardFromPreviousEffect:i.useCardFromPreviousEffect,_conditional:i.conditional});break;case"delete":E=B0(a,t,l,c,f);break;case"discard":E=Y0(a,t,l,c,f);break;case"shift":E=G0(a,t,l,c,{...f,useCardFromPreviousEffect:i.useCardFromPreviousEffect});break;case"return":E=W0(a,t,l,c,f);break;case"play":E=Q0(a,t,l,c,f);break;case"rearrange_protocols":case"swap_protocols":E=cw(a,t,l,c,f);break;case"reveal":case"give":E=X0(a,t,l,c,f);break;case"take":E=iw(a,t,l,c,f);break;case"choice":E=dw(a,t,l,c,f);break;case"block_compile":E=uw(a,t,l,c,f);break;case"delete_all_in_lane":E=pw(a,t,l,c,f);break;case"shuffle_trash":E=Z0(a,t,l,c,f);break;case"shuffle_deck":E=K0(a,t,l,c);break;case"state_number":E=J0(a,t,l,c,f);break;case"state_protocol":E=nw(a,t,l,c,f);break;case"swap_stacks":E=ow(a,t,l,c);break;case"copy_opponent_middle":E=sw(a,t,l,c,f);break;default:console.error(`[Custom Effect] Unknown action: ${p}`),E={newState:l};break}if(E.newState.actionRequired&&!E.newState.actionRequired.logSource&&(E={...E,newState:{...E.newState,actionRequired:{...E.newState.actionRequired,logSource:b.logSource,logPhase:b.logPhase,logIndentLevel:b.logIndentLevel}}}),i.conditional&&i.conditional.thenEffect){const{newState:A}=E;if(A.actionRequired)E={newState:{...A,actionRequired:{...A.actionRequired,followUpEffect:i.conditional.thenEffect,conditionalType:i.conditional.type,outerSourceCardId:a.id,outerLaneIndex:t}}};else{if(i.conditional.type==="if_executed"){const $=A._discardContext;if((($==null?void 0:$.discardedCount)||0)===0)return delete A._discardContext,E={newState:A},E}if(i.conditional.type==="if_protocol_matches_stated"){const $=A._discardContext,Z=$==null?void 0:$.discardedCardProtocol,ee=A.lastStatedProtocol;if(!ee||!Z||Z!==ee){let O=ne(A,c.cardOwner,`Discarded card does not match stated protocol "${ee||"none"}". Effect skipped.`);return delete O._discardContext,E={newState:O},E}let z=ne(A,c.cardOwner,`Discarded card matches stated protocol "${ee}"!`);delete z._discardContext,E={newState:z}}if(i.conditional.type==="optional"){let $={...A};return $.actionRequired={type:"prompt_optional_effect",actor:c.cardOwner,sourceCardId:a.id,effectDef:i.conditional.thenEffect,laneIndex:t,savedTargetCardId:A.lastCustomEffectTargetCardId},E={newState:$},E}let I=c;const U=A._discardContext;U&&(I={...c,discardedCount:U.discardedCount,previousHandSize:U.previousHandSize},delete A._discardContext),E=st(a,t,A,I,i.conditional.thenEffect)}}return E}function cw(a,t,l,c,i){const{cardOwner:d,opponent:f}=c,p=i.action,h=(i.target||"own")==="opponent"?f:d,y=d;if(N0(l)&&p==="rearrange_protocols")return{newState:ne(l,d,"Protocols cannot be rearranged (Frost-1 bottom effect is active).")};let _={...l},x;return i.restriction&&(x={laneIndex:i.restriction.laneIndex==="current"?t:i.restriction.laneIndex,protocol:i.restriction.disallowedProtocol}),p==="rearrange_protocols"?_.actionRequired={type:"prompt_rearrange_protocols",actor:y,target:h,sourceCardId:a.id,disallowedProtocolForLane:x}:p==="swap_protocols"&&(_.actionRequired={type:"prompt_swap_protocols",actor:y,target:h,sourceCardId:a.id,disallowedProtocolForLane:x}),{newState:_}}function iw(a,t,l,c,i){const{cardOwner:d,opponent:f}=c,p=i.count||1,u=i.random!==!1;if(l[f].hand.length===0)return{newState:ne(l,d,"Opponent has no cards in hand. Effect skipped.")};let h={...l};const y={...h[f]},g={...h[d]};if(u){const _=Math.min(p,y.hand.length),x=[];for(let j=0;j<_;j++){const C=Math.floor(Math.random()*y.hand.length),R=y.hand.splice(C,1)[0];g.hand.push(R),x.push(R)}h={...h,[d]:g,[f]:y};const S=d==="player"?"Player":"Opponent",E=`${a.protocol}-${a.value}`,b=x.map(j=>d==="player"?`${j.protocol}-${j.value}`:"a card").join(", ");return h=ne(h,d,`${E}: ${S} takes ${b} from the opponent's hand.`),{newState:h}}else{console.warn("[Take Effect] Non-random take not yet implemented, falling back to random");const _=Math.floor(Math.random()*y.hand.length),x=y.hand.splice(_,1)[0];g.hand.push(x),h={...h,[d]:g,[f]:y};const S=d==="player"?"Player":"Opponent",E=`${a.protocol}-${a.value}`,b=d==="player"?`${x.protocol}-${x.value}`:"a card";return h=ne(h,d,`${E}: ${S} takes ${b} from the opponent's hand.`),{newState:h}}}function dw(a,t,l,c,i){const{cardOwner:d}=c,f=i.options||[];if(f.length!==2)return console.error(`[Choice Effect] Expected 2 options, got ${f.length}`),{newState:l};let p={...l};return p.actionRequired={type:"custom_choice",options:f,sourceCardId:a.id,actor:d,laneIndex:t},{newState:p}}function uw(a,t,l,c,i){const{cardOwner:d,opponent:f}=c,u=(i.target||"opponent")==="opponent"?f:d,h={...l[u],cannotCompile:!0};let y={...l,[u]:h};const g=Se(l,a.id),_=g?`${g.card.protocol}-${g.card.value}`:"Effect";return y=ne(y,d,`${_}: ${u==="player"?"Player":"Opponent"} cannot compile next turn.`),{newState:y}}function pw(a,t,l,c,i){var y;const{cardOwner:d}=c,f=i.excludeCurrentLane!==!1,p=((y=i.laneCondition)==null?void 0:y.count)||8,u=[];for(let g=0;g<3;g++){if(f&&g===t)continue;l.player.lanes[g].length+l.opponent.lanes[g].length>=p&&u.push(g)}if(u.length===0){const g=`${a.protocol}-${a.value}`;return{newState:ne(l,d,`${g}: No line has ${p} or more cards. Effect skipped.`)}}let h={...l};return h.actionRequired={type:"select_lane_for_delete_all",sourceCardId:a.id,actor:d,validLanes:u,minCards:p},{newState:h}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function gt(a,t,l){var p;let c={...a};if(c._processingReactiveEffects)return{newState:c};c={...c,_processingReactiveEffects:!0};const i=c.processedClearCacheTriggerIds||[],d=[],f=u=>u.some(h=>h.trigger===t||h.trigger==="on_cover_or_flip"&&(t==="on_cover"||t==="on_flip"));for(const u of["player","opponent"])c[u].lanes.forEach((h,y)=>{h.forEach((g,_)=>{if(!g.isFaceUp)return;const x=c._committedCardId;if(x&&g.id===x)return;const S=g;if(!S.customEffects)return;const E=_===h.length-1;if(S.customEffects.topEffects&&f(S.customEffects.topEffects)){if(t==="after_clear_cache"&&i.includes(g.id))return;d.push({card:g,owner:u,laneIndex:y,box:"top"})}if(S.customEffects.middleEffects&&f(S.customEffects.middleEffects)){if(t==="after_clear_cache"&&i.includes(g.id))return;d.push({card:g,owner:u,laneIndex:y,box:"middle"})}if(E&&S.customEffects.bottomEffects){const b=S.customEffects.bottomEffects.filter(j=>j.trigger!=="on_cover");if(b.length>0&&f(b)){if(t==="after_clear_cache"&&i.includes(g.id))return;d.push({card:g,owner:u,laneIndex:y,box:"bottom"})}}})});if(d.length===0)return delete c._processingReactiveEffects,{newState:c};for(const{card:u,owner:h,laneIndex:y,box:g}of d){const _=c[h].lanes[y],x=_==null?void 0:_.findIndex(U=>U.id===u.id);if(!(x!==void 0&&x!==-1&&((p=_[x])==null?void 0:p.isFaceUp))||g==="bottom"&&!(x===_.length-1)||t==="before_compile_delete"&&(l==null?void 0:l.cardId)!==u.id||t==="on_flip"&&(l==null?void 0:l.cardId)!==u.id||(t==="on_cover"||t==="on_flip")&&l!=null&&l.cardId&&l.cardId!==u.id)continue;const E=u,C=(g==="top"?E.customEffects.topEffects:g==="middle"?E.customEffects.middleEffects:E.customEffects.bottomEffects).filter(U=>U.trigger===t||U.trigger==="on_cover_or_flip"&&(t==="on_cover"||t==="on_flip")).filter(U=>{const $=U.reactiveTriggerActor||"self";if(!(l!=null&&l.player))return!0;if(t==="after_opponent_discard"||t==="after_opponent_draw"||t==="after_opponent_refresh"||t==="after_opponent_compile")return l.player===h;if($==="self"){if(l.player!==h)return!1}else if($==="opponent"&&l.player===h)return!1;return!((U.reactiveScope||"global")==="this_lane"&&(l==null?void 0:l.laneIndex)!==void 0&&y!==l.laneIndex||U.onlyDuringOpponentTurn&&c.turn===h)});if(C.length===0)continue;const R=`${u.protocol}-${u.value}`;c=Ra(c),c=We(c,R),c=Ke(c,"after");const A=h==="player"?"opponent":"player",I={cardOwner:h,actor:h,currentTurn:c.turn,opponent:A,triggerType:t};if(t==="after_clear_cache"){const U=c.processedClearCacheTriggerIds||[];c.processedClearCacheTriggerIds=[...U,u.id]}for(const U of C){const $=st(u,y,c,I,U);if(c=Ee($.newState),c.actionRequired){const Z=c.actionRequired.actor||h;Z!==a.turn&&!c._interruptedTurn&&(c._interruptedTurn=a.turn,c._interruptedPhase=a.phase,c.turn=Z);const ee=c._pendingCustomEffects;if(ee&&ee.effects.length>0){const z={type:"execute_remaining_custom_effects",sourceCardId:ee.sourceCardId,laneIndex:ee.laneIndex,effects:ee.effects,context:ee.context,actor:ee.context.cardOwner};c.queuedActions=[z,...c.queuedActions||[]],delete c._pendingCustomEffects}return delete c._processingReactiveEffects,{newState:c}}}c=$o(c),c=We(c,void 0),c=Ke(c,void 0)}return delete c._processingReactiveEffects,{newState:c}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function Pn(a,t,l){let c=[...a],i=[...t],d=[],f=!1;for(let p=0;p<l;p++){if(c.length===0){if(i.length===0)break;c=In(i),i=[],f=!0}d.push(c.shift())}return{drawnCards:d,remainingDeck:c,newDiscard:i,reshuffled:f}}function fr(a,t,l,c="effect"){const i=a[t],{drawnCards:d,remainingDeck:f,newDiscard:p,reshuffled:u}=Pn(i.deck,i.discard,l);if(d.length===0)return a;const h=d.map(S=>({...S,id:ot(),isFaceUp:!0})),y=h.map(S=>S.id),g={...i.stats,cardsDrawn:i.stats.cardsDrawn+d.length},_={...i,deck:f,discard:p,hand:[...i.hand,...h],stats:g};let x={...a,[t]:_,stats:{...a.stats,[t]:g}};if(x.detailedGameStats&&d.length>0){const S=c==="refresh",E=t==="player"?S?"playerFromRefresh":"playerFromEffect":S?"aiFromRefresh":"aiFromEffect";x={...x,detailedGameStats:{...x.detailedGameStats,cardsDrawn:{...x.detailedGameStats.cardsDrawn,[E]:x.detailedGameStats.cardsDrawn[E]+d.length}}}}return y.length>0&&(x.animationState={type:"drawCard",owner:t,cardIds:y}),u&&(x=ne(x,t,`${t==="player"?"Player":"Opponent"}'s deck is empty. Discard pile has been reshuffled into the deck.`)),d.length>0&&(x=gt(x,"after_draw",{player:t,count:d.length}).newState,x=gt(x,"after_opponent_draw",{player:t==="player"?"opponent":"player",count:d.length}).newState),x}function fw(a,t,l){const c=t==="player"?"opponent":"player";let i={...a};const d={...i[c]},f={...i[t]},{drawnCards:p,remainingDeck:u,newDiscard:h,reshuffled:y}=Pn(d.deck,d.discard,l);if(p.length>0){const g=p.map(S=>({...S,id:ot(),isFaceUp:!0})),_=g.map(S=>S.id);f.hand=[...f.hand,...g];const x={...f.stats,cardsDrawn:f.stats.cardsDrawn+p.length};if(f.stats=x,d.deck=u,d.discard=h,i={...i,[t]:f,[c]:d,stats:{...i.stats,[t]:x}},_.length>0&&(i.animationState={type:"drawCard",owner:t,cardIds:_}),y&&(i=ne(i,t,`${c==="player"?"Player":"Opponent"}'s deck is empty. Discard pile has been reshuffled into the deck.`)),i.detailedGameStats&&p.length>0){const S=t==="player"?"playerFromEffect":"aiFromEffect";i={...i,detailedGameStats:{...i.detailedGameStats,cardsDrawn:{...i.detailedGameStats.cardsDrawn,[S]:i.detailedGameStats.cardsDrawn[S]+p.length}}}}}return i}function hw(a,t){const c=5-a[t].hand.length;if(c<=0)return a;let d=ne(a,t,`${t==="player"?"Player":"Opponent"} refreshes their hand, drawing ${c} card(s).`);d=fr(d,t,c,"refresh");const f={...d[t],stats:{...d[t].stats,handsRefreshed:d[t].stats.handsRefreshed+1}};if(d={...d,[t]:f,stats:{...d.stats,[t]:f.stats}},d.detailedGameStats){const y=t==="player"?"playerCardsDrawn":"aiCardsDrawn";d={...d,detailedGameStats:{...d.detailedGameStats,refreshes:{...d.detailedGameStats.refreshes,[y]:d.detailedGameStats.refreshes[y]+c}}}}return d=gt(d,"after_refresh",{player:t}).newState,d=gt(d,"after_opponent_refresh",{player:t==="player"?"opponent":"player"}).newState,d}function ur(a,t){const l={...t},c=i=>i.map(d=>d.map(f=>a.has(f.id)?{...f,isFaceUp:!f.isFaceUp}:f));return l.player.lanes=c(l.player.lanes),l.opponent.lanes=c(l.opponent.lanes),Ee(l)}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Jh=a=>{const t=In(Ja(a)),{drawnCards:l,remainingDeck:c}=Pn(t,[],5),i={cardsPlayed:0,cardsDiscarded:0,cardsDeleted:0,cardsFlipped:0,cardsShifted:0,cardsDrawn:l.length,cardsReturned:0,handsRefreshed:0},d=l.map(f=>({...f,id:ot(),isFaceUp:!0}));return{protocols:a,deck:c,hand:d,lanes:[[],[],[]],discard:[],compiled:[!1,!1,!1],laneValues:[0,0,0],cannotCompile:!1,stats:i}},Gl=(a,t,l,c="player")=>{const i=Jh(a),d=Jh(t),f={player:i,opponent:d,turn:c,phase:"start",controlCardHolder:null,useControlMechanic:l,winner:null,log:[],actionRequired:null,queuedActions:[],animationState:null,compilableLanes:[],processedStartEffectIds:[],processedEndEffectIds:[],lastPlayedCardId:void 0,stats:{player:i.stats,opponent:d.stats},detailedGameStats:{cardsPlayed:{playerFromHand:0,playerFromEffect:0,aiFromHand:0,aiFromEffect:0,playerFaceUp:0,playerFaceDown:0,aiFaceUp:0,aiFaceDown:0},cardsDrawn:{playerFromRefresh:0,playerFromEffect:0,aiFromRefresh:0,aiFromEffect:0},compiles:{playerFirstCompile:0,playerRecompile:0,aiFirstCompile:0,aiRecompile:0},refreshes:{playerCardsDrawn:0,aiCardsDrawn:0}}},p=c==="player"?"Player":"Opponent",u=a.join(", "),h=t.join(", ");let y=ne(f,"player","Game Started.");return y=ne(y,"player",`Player protocols: ${u}`),y=ne(y,"opponent",`Opponent protocols: ${h}`),y=ne(y,"player",`${p} goes first.`),y},ma=(a,t,l,c,i)=>{if(a.isFaceUp)return a.value;if(t.some(f=>f.isFaceUp&&f.protocol==="Darkness"&&f.value===2))return 4;if(l&&c!==void 0&&i!==void 0){const f=bm(l);for(const p of f)if(p.type==="set_to_fixed"){if(!(p.scope==="global"||p.scope==="this_lane"&&p.laneIndex===c))continue;const h=p.cardOwner;if(p.target==="own_cards"&&h!==i||p.target==="opponent_cards"&&h===i)continue;const y=p.filter;if(y&&(!y.faceState||y.faceState==="any"||y.faceState==="face_down"&&!a.isFaceUp||y.faceState==="face_up"&&a.isFaceUp))return p.value}}return 2},em=(a,t,l,c)=>{let i=0;for(const d of a)d.isFaceUp?i+=d.value:i+=ma(d,a,t,l,c);return Math.max(0,i)};function bm(a){const t=[];for(const l of["player","opponent"])a[l].lanes.forEach((c,i)=>{c.forEach(d=>{if(d.isFaceUp){const f=d;f.customEffects&&[...f.customEffects.topEffects||[],...f.customEffects.middleEffects||[],...f.customEffects.bottomEffects||[]].forEach(u=>{u.params.action==="value_modifier"&&u.trigger==="passive"&&t.push({...u.params.modifier,cardOwner:l,laneIndex:i})})}})});return t}function mw(a,t,l){const c=bm(a),i=[...t],d=[...l];for(const f of c){const{type:p,value:u,condition:h,target:y,scope:g,filter:_,cardOwner:x,laneIndex:S}=f,E=g==="global"?[0,1,2]:[S];for(const b of E)switch(p){case"add_per_condition":{if(!h)continue;let j=0;const C=a.player.lanes[b],R=a.opponent.lanes[b];h==="per_face_down_card"?j=C.filter(A=>!A.isFaceUp).length+R.filter(A=>!A.isFaceUp).length:h==="per_face_up_card"?j=C.filter(A=>A.isFaceUp).length+R.filter(A=>A.isFaceUp).length:h==="per_card"?j=C.length+R.length:h==="per_card_in_hand"?j=a[x].hand.length:h==="per_opponent_card_in_lane"&&(j=a[x==="player"?"opponent":"player"].lanes[b].length),y==="own_total"&&x==="player"?i[b]+=u*j:y==="own_total"&&x==="opponent"||y==="opponent_total"&&x==="player"?d[b]+=u*j:y==="opponent_total"&&x==="opponent"&&(i[b]+=u*j);break}case"set_to_fixed":break;case"add_to_total":{y==="own_total"&&x==="player"?i[b]+=u:y==="own_total"&&x==="opponent"||y==="opponent_total"&&x==="player"?d[b]+=u:y==="opponent_total"&&x==="opponent"&&(i[b]+=u);break}}}return{finalPlayerValues:i.map(f=>Math.max(0,f)),finalOpponentValues:d.map(f=>Math.max(0,f))}}function yw(a,t,l){let c=[...t],i=[...l];return{finalPlayerValues:c,finalOpponentValues:i}}const Ee=a=>{const t=a.player.lanes.map((f,p)=>em(f,a,p,"player")),l=a.opponent.lanes.map((f,p)=>em(f,a,p,"opponent")),c=yw(a,t,l),{finalPlayerValues:i,finalOpponentValues:d}=mw(a,c.finalPlayerValues,c.finalOpponentValues);return{...a,player:{...a.player,laneValues:i},opponent:{...a.opponent,laneValues:d}}},Em=(a,t)=>{const l=[],c=a[t],i=a[t==="player"?"opponent":"player"];if(!c.cannotCompile)for(let d=0;d<3;d++){const f=c.laneValues[d],p=i.laneValues[d];f>=10&&f>p&&l.push(d)}return l},ta=(a,t,l)=>a[t].laneValues[l],gw=(a,t)=>{const l=t==="player"?"opponent":"player",c=[];for(let i=0;i<3;i++){const d=a[t].laneValues[i];a[l].laneValues[i]>d&&c.push(i)}return c},jm=(a,t)=>{const l=t==="player"?"opponent":"player";let c=-1,i=[];for(let d=0;d<3;d++){const f=a[l].laneValues[d];f>c?(c=f,i=[d]):f===c&&i.push(d)}return i};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const vw=["select_card_to_flip","select_any_card_to_flip"];function _w(a,t,l){if(!l||!vw.includes(l.type))return null;const c=Se(a,t);if(c&&c.card.protocol==="Metal"&&c.card.value===6){const i="actor"in l?l.actor:a.turn,d=i==="player"?"Player":"Opponent",f=c.owner==="player"?"Player's":"Opponent's";let p="An effect";if("sourceCardId"in l&&l.sourceCardId){const C=Se(a,l.sourceCardId);C&&(p=`${C.card.protocol}-${C.card.value}`)}let u=ne(a,i,`${p}: ${d} flips ${f} Metal-6.`);u=ne(u,i,"Metal-6: Deletes itself when flipped.");const h={...a.stats[i],cardsDeleted:a.stats[i].cardsDeleted+1},y={...a[i],stats:h};u={...u,[i]:y,stats:{...u.stats,[i]:h}};const g=c.owner,_=a[g].lanes.findIndex(C=>C.some(R=>R.id===t)),x=a[g].lanes[_],S=x&&x.length>0&&x[x.length-1].id===t,E=x&&x.length>1,b=a._pendingCustomEffects,j=(C,R)=>{var ee,z;let A={...C};const I=b&&((ee=A.queuedActions)==null?void 0:ee.some(O=>O.type==="execute_remaining_custom_effects"&&O.sourceCardId===b.sourceCardId));b&&!I&&(A._pendingCustomEffects=b,A.lastCustomEffectTargetCardId=t);let $=gt(A,"after_delete",{player:A.turn}).newState;if(S&&E&&($=Un($,g,_).newState),l&&"count"in l&&l.count>1){const O=l.count-1;return $.actionRequired={...l,count:O},{...$,animationState:null}}if(A.actionRequired||A.queuedActions&&A.queuedActions.length>0)return{...$,actionRequired:A.actionRequired,queuedActions:A.queuedActions,animationState:null};const Z=b&&((z=$.queuedActions)==null?void 0:z.some(O=>O.type==="execute_remaining_custom_effects"&&O.sourceCardId===b.sourceCardId));if(b&&!$._pendingCustomEffects&&!Z&&($._pendingCustomEffects=b,$.lastCustomEffectTargetCardId=t),$=Ze($),$.actionRequired=null,$.queuedActions&&$.queuedActions.length>0){const O=[...$.queuedActions],k=O.shift();if((k==null?void 0:k.type)==="execute_remaining_custom_effects"){const q={...$,queuedActions:[k,...O]},F=Na(q);if(F.actionRequired)return{...F,animationState:null};if(F.queuedActions&&F.queuedActions.length>0){const D=[...F.queuedActions],T=D.shift();return{...F,actionRequired:T,queuedActions:D,animationState:null}}return R(F)}return{...$,actionRequired:k,queuedActions:O,animationState:null}}return R($)};return{nextState:{...u,actionRequired:null},requiresAnimation:{animationRequests:[{type:"delete",cardId:t,owner:c.owner}],onCompleteCallback:j},requiresTurnEnd:!1}}return null}const Md=(a,t)=>{var f,p,u,h,y,g,_,x,S,E,b,j,C,R,A;if(!a.actionRequired)return{nextState:a};let l={...a},c=!0,i=null;const d=_w(a,t,a.actionRequired);if(d)return d;switch(a.actionRequired.type){case"select_card_to_flip":{const{logSource:I,logPhase:U,logIndentLevel:$}=a.actionRequired;I!==void 0&&(l=We(l,I)),U!==void 0&&(l=Ke(l,U)),$!==void 0&&(l._logIndentLevel=$);const Z=a._committedCardId;if(Z&&t===Z)return{nextState:a};if(!Xl(a,t).allowed)return{nextState:a};const z=Se(a,t),O="draws"in a.actionRequired?a.actionRequired.draws:0;l=Pd(a,t);const k=t;l.lastCustomEffectTargetCardId=k;let q;if(z){const W=a[z.owner].lanes.findIndex(oe=>oe.some(Q=>Q.id===t));W!==-1&&(q=W,l.lastFlipLaneIndex=W)}const F=(f=a.actionRequired)==null?void 0:f.sourceCardId;if(F&&l.queuedActions&&(l.queuedActions=l.queuedActions.map(W=>{var oe;return W.type==="execute_remaining_custom_effects"&&W.sourceCardId===F&&!W.selectedCardFromPreviousEffect&&((oe=W.effects)==null?void 0:oe.some(V=>V.useCardFromPreviousEffect))?{...W,selectedCardFromPreviousEffect:t}:W})),O&&O>0){const{actor:W,sourceCardId:oe}=a.actionRequired,Q=Se(l,oe),V=Q?`${Q.card.protocol}-${Q.card.value}`:"A card effect";l=ne(l,W,`${V}: Drawing ${O} card(s).`),l=fr(l,W,O)}if(z&&!z.card.isFaceUp){const W=Od(l,t);l=W.newState,l.lastCustomEffectTargetCardId=k,q!==void 0&&(l.lastFlipLaneIndex=q),W.animationRequests&&(i={animationRequests:W.animationRequests,onCompleteCallback:(oe,Q)=>oe.actionRequired||oe.queuedActions&&oe.queuedActions.length>0?oe:Q(oe)})}const D=(p=a.actionRequired)==null?void 0:p.followUpEffect,T=(u=a.actionRequired)==null?void 0:u.sourceCardId;D&&T&&(l=U0(l,t,T,D));const L=((h=a.actionRequired)==null?void 0:h.actor)||a.turn,B=l.actionRequired;B&&(l.actionRequired=null),l=gt(l,"after_flip",{player:L,cardId:t}).newState,B&&(l.actionRequired?l.queuedActions=[{...B,type:B.type},...l.queuedActions||[]]:l.actionRequired=B);const ae=l._pendingCustomEffects;if(ae&&ae.effects.length>0){const W={type:"execute_remaining_custom_effects",sourceCardId:ae.sourceCardId,laneIndex:ae.laneIndex,effects:ae.effects,context:ae.context,actor:ae.context.cardOwner,selectedCardFromPreviousEffect:ae.effects[0].useCardFromPreviousEffect?t:void 0,logSource:ae.logSource,logPhase:ae.logPhase,logIndentLevel:ae.logIndentLevel};l.queuedActions=[W,...l.queuedActions||[]],delete l._pendingCustomEffects}const M=(y=a.actionRequired)==null?void 0:y.remainingLanes;if(M&&M.length>0&&!l.actionRequired){const W=M[0],oe=M.slice(1),Q=(g=a.actionRequired)==null?void 0:g.params,V=(_=a.actionRequired)==null?void 0:_.sourceCardId,J=(x=a.actionRequired)==null?void 0:x.actor,me=(S=a.actionRequired)==null?void 0:S.targetFilter;l.actionRequired={type:"select_card_to_flip",sourceCardId:V,actor:J,currentLaneIndex:W,remainingLanes:oe,targetFilter:me,params:Q,followUpEffect:(E=a.actionRequired)==null?void 0:E.followUpEffect,conditionalType:(b=a.actionRequired)==null?void 0:b.conditionalType}}(l.actionRequired||l.queuedActions&&l.queuedActions.length>0)&&(c=!1);break}case"select_card_to_shift":{const{logSource:I,logPhase:U,logIndentLevel:$}=a.actionRequired;I!==void 0&&(l=We(l,I)),U!==void 0&&(l=Ke(l,U)),$!==void 0&&(l._logIndentLevel=$);const{sourceCardId:Z,optional:ee}=a.actionRequired;if(ee&&Z){const O=Se(a,Z);if(!O||!O.card.isFaceUp){const k=O?`${O.card.protocol}-${O.card.value}`:"the source card",q=a._logSource;l=We(a,k),l=ne(l,a.actionRequired.actor,"Shift was cancelled because the source is no longer active."),l=We(l,q),l=Ze(l),l.actionRequired=null,c=!0;break}}const z=Se(a,t);if(z){const{owner:O}=z;let k=-1;for(let ae=0;ae<a[O].lanes.length;ae++)if(a[O].lanes[ae].some(M=>M.id===t)){k=ae;break}if(k===-1)return{nextState:a,requiresTurnEnd:!1};const F=(a.actionRequired.targetFilter||{}).position||"uncovered",D=a[O].lanes[k],L=D.findIndex(ae=>ae.id===t)===D.length-1;if(F==="uncovered"&&!L)return{nextState:a,requiresTurnEnd:!1};if(F==="covered"&&L)return{nextState:a,requiresTurnEnd:!1};const B=a.actionRequired.scope,G=a.actionRequired.sourceLaneIndex;if(B==="this_lane"&&G!==void 0&&k!==G)return{nextState:a,requiresTurnEnd:!1};if(k!==-1){const ae=a.actionRequired.targetLaneIndex;if(ae!==void 0){const W=a.actionRequired.actor;l=Fo(a,t,O,ae,W).newState,c=!l.actionRequired;break}const M={type:"select_lane_for_shift",cardToShiftId:t,cardOwner:O,originalLaneIndex:k,sourceCardId:a.actionRequired.sourceCardId,actor:a.actionRequired.actor,destinationRestriction:a.actionRequired.destinationRestriction,followUpEffect:a.actionRequired.followUpEffect,conditionalType:a.actionRequired.conditionalType};l.actionRequired=M}}c=!1;break}case"delete_self":{const{sourceCardId:I,cardToDeleteId:U,actor:$,logSource:Z,logPhase:ee,logIndentLevel:z}=a.actionRequired;Z!==void 0&&(l=We(l,Z)),ee!==void 0&&(l=Ke(l,ee)),z!==void 0&&(l._logIndentLevel=z);const O=Se(a,U);if(!O){l=ne(l,$,"Card no longer on board. Delete skipped."),l=Ze(l),l.actionRequired=null,c=!0;break}const k=`${O.card.protocol}-${O.card.value}`;l=ne(l,$,`Deleting ${k}.`);const{owner:q,laneIndex:F}=O,D=a[q].lanes[F][a[q].lanes[F].length-1].id===U,T=[...a[q].lanes[F]],L=T.findIndex(M=>M.id===U);T.splice(L,1);const B=[...a[q].lanes];B[F]=T;let G={...a,[q]:{...a[q],lanes:B}};l=Ze(G),l.actionRequired=null;const ae={...l.stats[$],cardsDeleted:l.stats[$].cardsDeleted+1};l={...l,stats:{...l.stats,[$]:ae}},D&&T.length>0&&(l=Un(l,q,F).newState),c=!0;break}case"select_cards_to_delete":case"select_face_down_card_to_delete":case"select_low_value_card_to_delete":case"select_card_from_other_lanes_to_delete":{const{sourceCardId:I,actor:U}=a.actionRequired,{logSource:$,logPhase:Z,logIndentLevel:ee}=a.actionRequired;$!==void 0&&(l=We(l,$)),Z!==void 0&&(l=Ke(l,Z)),ee!==void 0&&(l._logIndentLevel=ee);const z=Se(a,I);if(!z||!z.card.isFaceUp){const J=z?`${z.card.protocol}-${z.card.value}`:"the source card";l=ne(l,U,`Effect from ${J} was cancelled because the source is no longer active.`),l=Ze(l),l.actionRequired=null,c=!0;break}const O=Se(a,t);if(!O)return{nextState:a};const k=a.actionRequired.allowedIds;if(k&&!k.includes(t))return console.error(`Illegal delete: Card ${t} is not in allowedIds - value filter not met`),{nextState:a};if(a.actionRequired.protocolMatching){const J=a.actionRequired.protocolMatching,me=a[O.owner].lanes.findIndex(ge=>ge.some(Y=>Y.id===t));if(me!==-1){const ge=a.player.protocols[me],Y=a.opponent.protocols[me],K=O.card.protocol,X=K===ge||K===Y;if(J==="must_match"&&!X)return console.error(`Illegal delete: ${K}-${O.card.value} in lane ${me} (protocols: ${ge}/${Y}) - card must be in lane with matching protocol`),{nextState:a};if(J==="must_not_match"&&X)return console.error(`Illegal delete: ${K}-${O.card.value} in lane ${me} (protocols: ${ge}/${Y}) - card must be in lane without matching protocol`),{nextState:a}}}const q=a.actionRequired.targetFilter;if((q==null?void 0:q.calculation)==="highest_value"||(q==null?void 0:q.calculation)==="lowest_value"){const J=q.owner,me=J==="opponent"?U==="player"?"opponent":"player":J==="own"?U:O.owner,Y=H0(a,me).some(X=>X.card.id===t),K=q.calculation==="highest_value"?"highest":"lowest";if(!Y)return console.error(`Illegal delete: Card ${t} is not one of the ${K} value uncovered cards`),{nextState:a}}const F=U==="player"?"Player":"Opponent",D=O.owner==="player"?"Player's":"Opponent's",T=a[O.owner].lanes.findIndex(J=>J.some(me=>me.id===t)),L=T!==-1?a[O.owner].protocols[T]:"unknown",B=O.card.isFaceUp?`${O.card.protocol}-${O.card.value}`:`face-down card in Protocol ${L}`,G=Se(a,a.actionRequired.sourceCardId),ae=G?`${G.card.protocol}-${G.card.value}`:"a card effect";l=ne(l,U,`${ae}: ${F} deletes ${D} ${B}.`);const M={...l.stats[U],cardsDeleted:l.stats[U].cardsDeleted+1},W={...l[U],stats:M};l={...l,[U]:W,stats:{...l.stats,[U]:M}};const oe=a[O.owner].lanes.findIndex(J=>J.some(me=>me.id===t)),Q=a[O.owner].lanes[oe],V=Q&&Q.length>0&&Q[Q.length-1].id===t;l=Ze(l),l.actionRequired=null,i={animationRequests:[{type:"delete",cardId:t,owner:O.owner}],onCompleteCallback:(J,me)=>{var be,Pe,$e;const ge=a.actionRequired.actor,Y=a.actionRequired;let X=gt(J,"after_delete",{player:ge}).newState;X=Ze(X);let se=null;const ie=Se(X,Y.sourceCardId),_e=qo(X,Y.sourceCardId),ye=Y.followUpEffect;if(ie&&ie.card.isFaceUp&&_e){const Ae=Y.remainingLanes;if(Y.type==="select_cards_to_delete"&&Ae&&Ae.length>0){const Le=Ae[0],Re=Ae.slice(1);se={type:"select_cards_to_delete",count:((be=Y.params)==null?void 0:be.count)||Y.count,sourceCardId:Y.sourceCardId,actor:Y.actor,currentLaneIndex:Le,remainingLanes:Re,disallowedIds:(Pe=Y.params)!=null&&Pe.excludeSelf?[Y.sourceCardId]:[],targetFilter:Y.targetFilter,scope:Y.scope,protocolMatching:Y.protocolMatching,params:Y.params}}else if(Y.type==="select_cards_to_delete"&&Y.count>1)se={type:"select_cards_to_delete",count:Y.count-1,sourceCardId:Y.sourceCardId,disallowedIds:[...Y.disallowedIds,t],actor:Y.actor,followUpEffect:ye};else if(Y.type==="select_card_from_other_lanes_to_delete"&&Y.count>1){const Le=a[O.owner].lanes.findIndex(ct=>ct.some(Ct=>Ct.id===t)),Re=[...Y.lanesSelected,Le];[0,1,2].filter(ct=>ct!==Y.disallowedLaneIndex&&!Re.includes(ct)).some(ct=>X.player.lanes[ct].length>0||X.opponent.lanes[ct].length>0)?se={type:"select_card_from_other_lanes_to_delete",count:Y.count-1,sourceCardId:Y.sourceCardId,disallowedLaneIndex:Y.disallowedLaneIndex,lanesSelected:Re,actor:Y.actor}:X=ne(X,Y.actor,"No cards left in remaining lanes. Effect skipped.")}}else if("count"in Y&&Y.count>1){const Ae=ie?`${ie.card.protocol}-${ie.card.value}`:"the source card",Le=!ie||!ie.card.isFaceUp?"the source is no longer active":"the source was covered";X=ne(X,Y.actor,`Remaining deletes from ${Ae} were cancelled because ${Le}.`)}let ke=!1;if(V){const Ae=X,Le=Un(Ae,O.owner,oe),Re=Le.newState._interruptedTurn!==void 0;Ae._interruptedTurn&&!Le.newState._interruptedTurn&&(ke=!0);const Ne=[...Le.newState.queuedActions||[]];se&&(Re?Ne.push(se):Ne.unshift(se)),X={...Le.newState,queuedActions:Ne}}else se&&(X.queuedActions=[...X.queuedActions||[],se]);if(ye&&!se)if(X.actionRequired){const Ae=Se(X,Y.sourceCardId),Le=Y.actor==="player"?"opponent":"player";let Re=-1;Ae&&(Re=X[Ae.owner].lanes.findIndex(ct=>ct.some(Ct=>Ct.id===Y.sourceCardId)));const Ne={cardOwner:Y.actor,actor:Y.actor,currentTurn:X.turn,opponent:Le,triggerType:"start"},ht={type:"execute_remaining_custom_effects",sourceCardId:Y.sourceCardId,actor:Y.actor,laneIndex:Re,effects:[ye],context:Ne,logSource:Y.logSource,logPhase:Y.logPhase,logIndentLevel:Y.logIndentLevel??1};X.queuedActions=[...X.queuedActions||[],ht]}else{const Ae=Se(X,Y.sourceCardId),Le=Y.actor==="player"?"opponent":"player";if(Ae){const Re=X[Ae.owner].lanes.findIndex(Ct=>Ct.some(wt=>wt.id===Y.sourceCardId)),Ne={cardOwner:Y.actor,actor:Y.actor,currentTurn:X.turn,opponent:Le,triggerType:"start"},ht=`${Ae.card.protocol}-${Ae.card.value}`;X=We(X,Y.logSource||ht),X=Ke(X,Y.logPhase||"start"),X._logIndentLevel=Y.logIndentLevel??1,X=st(Ae.card,Re,X,Ne,ye).newState,X=Ze(X)}else($e=ye.params)!=null&&$e.deleteSelf&&(X=We(X,Y.logSource||"the source card"),X=Ke(X,Y.logPhase||"start"),X._logIndentLevel=Y.logIndentLevel??1,X=internalDeleteCard(X,Y.sourceCardId).newState,X=ne(X,Y.actor,"Deletes itself."))}if(X.actionRequired)return X;if(X.queuedActions&&X.queuedActions.length>0){const Ae=X.queuedActions[0];if((Ae==null?void 0:Ae.type)==="execute_remaining_custom_effects"){const Ne=Na(X);return Ne.actionRequired?Ne:me(Ne)}const Le=[...X.queuedActions],Re=Le.shift();if((Re==null?void 0:Re.type)==="shift_flipped_card_optional"||(Re==null?void 0:Re.type)==="gravity_2_shift_after_flip"){const Ne=Se(X,Re.sourceCardId),ht=qo(X,Re.sourceCardId);if(!Ne||!Ne.card.isFaceUp||!ht){const ct=Ne?`${Ne.card.protocol}-${Ne.card.value}`:"the source card";let Ct=ne(X,Re.actor,`Shift from ${ct} was cancelled because the source is no longer active.`);if(Le.length>0){const wt=Le.shift();return{...Ct,actionRequired:wt,queuedActions:Le}}else return me({...Ct,actionRequired:null,queuedActions:[]})}}return{...X,actionRequired:Re,queuedActions:Le}}if(ke){if(X.queuedActions&&X.queuedActions.length>0){const Ae=[...X.queuedActions],Le=Ae.shift();if((Le==null?void 0:Le.type)==="execute_remaining_custom_effects"){const Re={...X,queuedActions:[Le,...Ae]},Ne=Na(Re);return Ne.actionRequired?Ne:X}return{...X,actionRequired:Le,queuedActions:Ae}}return X}if(ye&&ie&&ie.card.isFaceUp&&(!((ye.position||"middle")!=="top")||_e)){const Ne=X[ie.owner].lanes.findIndex(na=>na.some(En=>En.id===Y.sourceCardId)),ht=Y.actor==="player"?"opponent":"player",ct=ye.trigger||"on_play",Ct={cardOwner:Y.actor,actor:Y.actor,currentTurn:X.turn,opponent:ht,triggerType:ct};if(X=st(ie.card,Ne,X,Ct,ye).newState,Se(X,Y.sourceCardId),X.actionRequired)return X}return me(X)}},c=!1;break}case"plague_4_opponent_delete":{const I=Se(a,t);if(!I)return{nextState:a};const U=a.actionRequired.actor;l=ne(l,U,"Plague-4: Opponent deletes one of their face-down cards.");const $={...l.stats[U],cardsDeleted:l.stats[U].cardsDeleted+1},Z={...l[U],stats:$};l={...l,[U]:Z,stats:{...l.stats,[U]:$}};const ee=a[I.owner].lanes.findIndex(k=>k.some(q=>q.id===t)),z=a[I.owner].lanes[ee],O=z&&z.length>0&&z[z.length-1].id===t;l=Ze(l),l.actionRequired=null,i={animationRequests:[{type:"delete",cardId:t,owner:I.owner}],onCompleteCallback:(k,q)=>{let D=gt(k,"after_delete",{player:U}).newState;O&&(D=Un(D,I.owner,ee).newState);const T=Se(D,a.actionRequired.sourceCardId),L=(T==null?void 0:T.owner)||a.turn,B={type:"plague_4_player_flip_optional",sourceCardId:a.actionRequired.sourceCardId,optional:!0,actor:L};return D.actionRequired?D.queuedActions=[...D.queuedActions||[],B]:D.actionRequired=B,D}},c=!1;break}case"select_card_to_return":{const{logSource:I,logPhase:U,logIndentLevel:$}=a.actionRequired;I!==void 0&&(l=We(l,I)),U!==void 0&&(l=Ke(l,U)),$!==void 0&&(l._logIndentLevel=$);const{sourceCardId:Z,actor:ee}=a.actionRequired,z=(j=a.actionRequired)==null?void 0:j.followUpEffect,O=(C=a.actionRequired)==null?void 0:C.conditionalType,k=(R=a.actionRequired)==null?void 0:R.targetFilter,q=Se(a,t);if(q){const D=a[q.owner].lanes[q.laneIndex],T=((A=D[D.length-1])==null?void 0:A.id)===t,L=(k==null?void 0:k.position)==="covered"||(k==null?void 0:k.position)==="any";if(!T&&!L)return console.error(`[cardResolver] Invalid return target: ${q.card.protocol}-${q.card.value} is covered`),{nextState:a,requiresTurnEnd:!1}}const F=Ud(a,t);if(l=F.newState,F.animationRequests)i={animationRequests:F.animationRequests,onCompleteCallback:(D,T)=>{if(D.actionRequired)return D;let L=D;if(z&&Z&&(O!=="if_executed"||t)){const G=Se(L,Z);if(G&&G.card.isFaceUp){const ae=L[G.owner].lanes.find(Q=>Q.some(V=>V.id===Z)),M=L[G.owner].lanes.indexOf(ae),W={cardOwner:G.owner,actor:ee,currentTurn:L.turn,opponent:G.owner==="player"?"opponent":"player"};if(L=st(G.card,M,L,W,z).newState,L.actionRequired)return L}}return T(L)}};else if(z&&Z&&(O!=="if_executed"||t)){const T=Se(l,Z);if(T&&T.card.isFaceUp){const L=l[T.owner].lanes.find(M=>M.some(W=>W.id===Z)),B=l[T.owner].lanes.indexOf(L),G={cardOwner:T.owner,actor:ee,currentTurn:l.turn,opponent:T.owner==="player"?"opponent":"player"};l=st(T.card,B,l,G,z).newState}}l=Ze(l),c=!l.actionRequired&&(!l.queuedActions||l.queuedActions.length===0);break}case"select_opponent_card_to_return":{const{sourceCardId:I,actor:U}=a.actionRequired,$=Ud(a,t);let Z=$.newState;if(Z.actionRequired){const ee={type:"flip_self",sourceCardId:I,actor:U};Z.queuedActions=[ee,...Z.queuedActions||[]],l=Z,c=!1}else{const ee=Se(Z,I);if(ee){const z=`${ee.card.protocol}-${ee.card.value}`;Z=ne(Z,U,`${z}: Flips itself.`),Z=ur(new Set([I]),Z),Z.animationState={type:"flipCard",cardId:I}}l=Z,c=!0}$.animationRequests&&(i={animationRequests:$.animationRequests,onCompleteCallback:(ee,z)=>ee.actionRequired?ee:z(ee)}),l=Ze(l),c||(c=!l.actionRequired&&(!l.queuedActions||l.queuedActions.length===0));break}case"select_any_card_to_flip":{const I=Se(a,t),{count:U,sourceCardId:$,actor:Z}=a.actionRequired,ee=Se(a,$);if(!ee||!ee.card.isFaceUp){const k=ee?`${ee.card.protocol}-${ee.card.value}`:"a card";l=ne(a,Z,`Effect from ${k} was cancelled because the source is no longer active.`),l=Ze(l),l.actionRequired=null,c=!0;break}let z=null;U>1&&(z={type:"select_any_card_to_flip",count:U-1,sourceCardId:$,actor:Z});let O=Pd(a,t,z);if(I&&!I.card.isFaceUp){const k=Od(O,t),q=k.newState.actionRequired;q&&q!==z&&z&&(k.newState.queuedActions=[...k.newState.queuedActions||[],z]),l=k.newState,k.animationRequests&&(i={animationRequests:k.animationRequests,onCompleteCallback:(F,D)=>F.actionRequired||F.queuedActions&&F.queuedActions.length>0?F:D(F)})}else l=O;l=Ze(l),c=!l.actionRequired&&(!l.queuedActions||l.queuedActions.length===0);break}case"select_board_card_to_reveal_custom":{const{sourceCardId:I,actor:U,followUpAction:$,optional:Z}=a.actionRequired,ee=U.charAt(0).toUpperCase()+U.slice(1),z=Se(a,t);if(!z)return{nextState:a,requiresTurnEnd:!0};const O=z.owner,k=a[O].lanes.findIndex(L=>L.some(B=>B.id===t));if(k===-1)return{nextState:a,requiresTurnEnd:!0};const q=[...a[O].lanes[k]],F=q.findIndex(L=>L.id===t);if(F===-1)return{nextState:a,requiresTurnEnd:!0};q[F]={...q[F],isFaceUp:!0};const D=[...a[O].lanes];D[k]=q,l={...a,[O]:{...a[O],lanes:D}};const T=`${q[F].protocol}-${q[F].value}`;l=ne(l,U,`${ee} reveals ${T}.`),l.actionRequired={type:"prompt_shift_or_flip_board_card_custom",sourceCardId:I,revealedCardId:t,followUpAction:$,optional:Z!==!1,actor:U},c=!1;break}case"select_phase_effect":{const I=a.actionRequired;if(!I.availableEffects.find(Z=>Z.cardId===t))return console.warn(`[cardResolver] Invalid phase effect selection: ${t} not in available effects`),{nextState:a};const $=I.phase==="Start"?"_selectedStartEffectId":"_selectedEndEffectId";l[$]=t,l.actionRequired=null,c=!1;break}case"select_card_for_copy_middle":{const I=a.actionRequired;if(!I.validTargetIds.includes(t))return console.warn(`[cardResolver] Invalid copy_middle target: ${t}`),{nextState:a};const U=Se(a,t);if(!U)return console.error(`[cardResolver] Target card not found: ${t}`),{nextState:a};const{card:$,owner:Z}=U;l[Z].lanes.findIndex(F=>F.some(D=>D.id===t));const ee=lw($);if(ee.length===0){l=ne(l,I.actor,`${$.protocol}-${$.value} has no middle commands.`),l.actionRequired=null;break}l=ne(l,I.actor,`Copies the middle command of ${$.protocol}-${$.value}.`);const z=Se(a,I.sourceCardId),O=z?l[z.owner].lanes.findIndex(F=>F.some(D=>D.id===I.sourceCardId)):0,k={cardOwner:I.actor,triggerType:"on_play"};let q=l;for(const F of ee){if(F.trigger!=="on_play")continue;const D=z==null?void 0:z.card;if(!D)continue;if(q=st(D,O,q,k,F).newState,q.actionRequired)return{nextState:q,requiresTurnEnd:!1}}q.actionRequired=null,l=q;break}default:return{nextState:a,requiresTurnEnd:!0}}if(!i&&l.actionRequired===null){if(l.queuedActions&&l.queuedActions.length>0){const I=[...l.queuedActions],U=I.shift();if((U==null?void 0:U.type)==="execute_remaining_custom_effects")return{nextState:{...Ze(l),actionRequired:null,queuedActions:[U,...I]},requiresTurnEnd:!1};if((U==null?void 0:U.type)==="shift_flipped_card_optional"||(U==null?void 0:U.type)==="gravity_2_shift_after_flip"){const $=Se(l,U.sourceCardId),Z=qo(l,U.sourceCardId);if(!$||!$.card.isFaceUp||!Z){const ee=$?`${$.card.protocol}-${$.card.value}`:"the source card",z=ne(l,U.actor,`Shift from ${ee} was cancelled because the source is no longer active.`);if(I.length>0){const O=I.shift();return(O==null?void 0:O.type)==="execute_remaining_custom_effects"?{nextState:{...z,queuedActions:[O,...I]},requiresTurnEnd:!1}:{nextState:{...z,actionRequired:O,queuedActions:I},requiresTurnEnd:!1}}else return{nextState:{...z,actionRequired:null,queuedActions:[]},requiresTurnEnd:!0}}}return(U==null?void 0:U.type)==="execute_remaining_custom_effects"?{nextState:{...l,queuedActions:[U,...I]},requiresTurnEnd:!1}:{nextState:{...l,actionRequired:U,queuedActions:I},requiresTurnEnd:!1}}}else!i&&l.actionRequired!==null&&(c=!1);return{nextState:l,requiresAnimation:i,requiresTurnEnd:c}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const _c=(a,t,l,c,i,d=i)=>{const f={...a[i]},p=f.hand.find(F=>F.id===t);if(!p)return{newState:a};if(d===i){const F=eo(a,i,l,c,p.protocol,p);if(!F.allowed)return console.error(`Illegal Move: ${i} tried to play ${p.protocol}-${p.value} - ${F.reason}`),{newState:a}}const u=i==="player"?"opponent":"player",y=a[d==="player"?"opponent":"player"].lanes[l],g=y.length>0?y[y.length-1]:null;if(g&&g.isFaceUp&&g.protocol==="Plague"&&g.value===0)return{newState:a};if(!c&&g&&g.isFaceUp&&g.protocol==="Metal"&&g.value===2)return console.error(`Illegal Move: ${i} tried to play face-down against Metal-2 in lane ${l}`),{newState:a};if(c){const F=a[d].protocols[l],D=f.protocols[l],T=a[u].protocols[l],L=a[u].lanes.flat().some(V=>V.isFaceUp&&V.protocol==="Psychic"&&V.value===1),B=[...a.player.lanes.flat(),...a.opponent.lanes.flat()].some(V=>V.isFaceUp&&V.protocol==="Anarchy"&&V.value===1),G=Ec(a),ae=a[i].lanes.flat().some(V=>V.isFaceUp&&V.protocol==="Spirit"&&V.value===1),M=a[i].lanes.some(V=>{if(V.length===0)return!1;const J=V[V.length-1];return J.isFaceUp&&J.protocol==="Chaos"&&J.value===3}),W=ts(a,i,l),oe=Kl(a,p);let Q;if(oe?Q=!L:d!==i?Q=p.protocol===F&&!L:B||G?Q=p.protocol!==D&&p.protocol!==T&&!L:Q=(p.protocol===D||p.protocol===T||ae||M||W)&&!L,!Q){const V=B||G?"Non-matching protocol required":"matching protocol required";return console.error(`Illegal Move: ${i} tried to play ${p.protocol}-${p.value} face-up in lane ${l} (${V}, protocols: player=${D}, opponent=${T})`),{newState:a}}}let _={...a,_committedCardId:t};a._currentEffectSource!==void 0||a._currentPhaseContext!==void 0||a._logIndentLevel!==void 0&&a._logIndentLevel>0?_=Ra(_):(_=We(_,void 0),_=Ke(_,void 0),_={..._,_logIndentLevel:0});const S=i==="player"?"Player":"Opponent",E=_[d].protocols[l];let b;if(i==="opponent"&&!c)b=`${S} plays a face-down card into Protocol ${E}.`;else{const F=`${p.protocol}-${p.value}`;b=`${S} plays ${F}`,c||(b+=" face-down"),d!==i?b+=` into ${d==="player"?"Player's":"Opponent's"} Protocol ${E}.`:b+=` into Protocol ${E}.`}_=ne(_,i,b),_=Ra(_);let j={newState:_};const C=_[d].lanes[l];if(C.length>0){const F=C[C.length-1];let T=gt(_,"on_cover",{player:d,cardId:F.id}).newState;if(T[d].lanes[l].some(G=>G.id===F.id)&&F.isFaceUp){const G={cardOwner:d,actor:i,currentTurn:T.turn,opponent:d==="player"?"opponent":"player",triggerType:"cover"};j=Kd(F,l,T,G)}else j={newState:T}}const R=j.newState,A={...p,isFaceUp:c,isRevealed:!1},I={...R[i]},U={...I.stats,cardsPlayed:I.stats.cardsPlayed+1},$=i==="player"?"playerFromHand":"aiFromHand",Z=i==="player"?c?"playerFaceUp":"playerFaceDown":c?"aiFaceUp":"aiFaceDown",ee=R.detailedGameStats?{...R.detailedGameStats,cardsPlayed:{...R.detailedGameStats.cardsPlayed,[$]:R.detailedGameStats.cardsPlayed[$]+1,[Z]:R.detailedGameStats.cardsPlayed[Z]+1}}:void 0;let z;if(d===i){const F={...I,hand:I.hand.filter(D=>D.id!==t),lanes:I.lanes.map((D,T)=>T===l?[...D,A]:D),stats:U};z={...R,[i]:F,stats:{...R.stats,[i]:U},detailedGameStats:ee}}else{const F={...I,hand:I.hand.filter(L=>L.id!==t),stats:U},D={...R[d]},T={...D,lanes:D.lanes.map((L,B)=>B===l?[...L,A]:L)};z={...R,[i]:F,[d]:T,stats:{...R.stats,[i]:U},detailedGameStats:ee}}const O=a.queuedActions||[],k=R.queuedActions||[];if(k===O||k.length===O.length&&k.every((F,D)=>F===O[D])?O.length>0&&(z.queuedActions=O):z.queuedActions=[...O,...k],z.lastPlayedCardId=A.id,z=Ee(z),R.actionRequired||(z={...z,_logIndentLevel:0}),z=gt(z,"after_play",{player:i,cardId:A.id,laneIndex:l}).newState,R.actionRequired)return c&&(z.queuedEffect={card:A,laneIndex:l}),{newState:z,animationRequests:j.animationRequests};{if(z={...z,_committedCardId:void 0},i==="opponent")return c&&(z.queuedEffect={card:A,laneIndex:l}),{newState:z,animationRequests:j.animationRequests};let F={newState:z};if(c&&!z.actionRequired){const T={cardOwner:d,actor:i,currentTurn:z.turn,opponent:d==="player"?"opponent":"player",triggerType:"play"};F=ol(A,l,z,T)}const D=[...j.animationRequests||[],...F.animationRequests||[]];return{newState:F.newState,animationRequests:D.length>0?D:void 0}}},es=(a,t)=>{let l=We(a,void 0);return l=Ke(l,void 0),l={...l,_logIndentLevel:0},hw(l,t)},km=(a,t)=>{if(a.useControlMechanic&&a.controlCardHolder===t){let l=ne(a,t,`${t==="player"?"Player":"Opponent"} has Control and may rearrange protocols before refreshing.`);return l=Ra(l),{...l,controlCardHolder:null,actionRequired:{type:"prompt_use_control_mechanic",sourceCardId:"CONTROL_MECHANIC",actor:t,originalAction:{type:"fill_hand"}}}}return es(a,t)};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Hd=(a,t)=>{var i,d,f,p,u,h,y,g,_,x,S,E,b,j,C,R,A,I,U,$,Z,ee,z,O;if(!a.actionRequired)return{nextState:a};let l={...a},c=null;switch(a.actionRequired.type){case"select_lane_for_shift_all":{const{cardsToShift:k,validDestinationLanes:q,sourceLaneIndex:F,actor:D,sourceCardId:T}=a.actionRequired;if(!q.includes(t))return console.error(`Illegal shift: Lane ${t} is not a valid destination`),{nextState:a};if(t===F)return console.error(`Illegal shift: Cannot shift to the same lane ${F}`),{nextState:a};let L={...a};const B=[];for(const{cardId:G,owner:ae}of k){if(!Se(L,G))continue;const W=L[ae].lanes.findIndex(V=>V.some(J=>J.id===G));if(W===-1||!Jl(L,W,t).allowed)continue;const Q=Fo(L,G,ae,t,D);L=Q.newState,Q.animationRequests&&B.push(...Q.animationRequests)}if(l=L,l=Ze(l),(!l.actionRequired||l.actionRequired.type==="select_lane_for_shift_all")&&(l.actionRequired=null),B.length>0){const G=(i=a.actionRequired)==null?void 0:i.followUpEffect,ae=(d=a.actionRequired)==null?void 0:d.conditionalType;c={animationRequests:B,onCompleteCallback:(M,W)=>{if(M.actionRequired||M.queuedActions&&M.queuedActions.length>0)return M;let oe=M;if(G&&T&&(ae!=="if_executed"||B.length>0)){const V=Se(oe,T);if(V&&V.card.isFaceUp){const J=oe[V.owner].lanes.find(K=>K.some(X=>X.id===T)),me=oe[V.owner].lanes.indexOf(J),ge={cardOwner:V.owner,actor:D,currentTurn:oe.turn,opponent:V.owner==="player"?"opponent":"player"};if(oe=st(V.card,me,oe,ge,G).newState,oe.actionRequired)return oe}}return W(oe)}}}break}case"select_lane_for_shift":{const{cardToShiftId:k,cardOwner:q,actor:F,sourceEffect:D,originalLaneIndex:T,sourceCardId:L}=a.actionRequired;if(t===T)return console.error(`Illegal shift: Cannot shift to the same lane ${T}`),{nextState:a};const B=a.actionRequired.validLanes;if(B&&!B.includes(t))return console.error(`Illegal shift: Lane ${t} not in valid lanes ${B}`),{nextState:a};const G=Se(a,L),ae=Se(a,k);if(G&&G.card.protocol==="Anarchy"&&G.card.value===1&&ae&&ae.card.isFaceUp){const Q=a.player.protocols[t],V=a.opponent.protocols[t],J=ae.card.protocol;if(J===Q||J===V)return console.error(`Illegal Anarchy-1 shift: ${J}-${ae.card.value} cannot be shifted to lane ${t} (protocols: ${Q}/${V}) - matching protocol not allowed`),{nextState:a}}if(G&&G.card.protocol==="Gravity"&&G.card.value===1){let Q=-1;for(let V=0;V<a[G.owner].lanes.length;V++)if(a[G.owner].lanes[V].some(J=>J.id===L)){Q=V;break}if(Q!==-1&&!(T===Q)&&!(t===Q))return console.error(`Illegal Gravity-1 shift: Must shift to or from Gravity lane ${Q}, but tried ${T}  ${t}`),{nextState:a}}if(a.actionRequired.destinationRestriction&&ae){const Q=a.actionRequired.destinationRestriction;if(Q.type==="non_matching_protocol"&&ae.card.isFaceUp){const V=a.player.protocols[t],J=a.opponent.protocols[t],me=ae.card.protocol;if(me===V||me===J)return console.error(`Illegal shift: ${me} cannot be shifted to lane ${t} (protocols: ${V}/${J}) - matching protocol not allowed`),{nextState:a}}if(Q.type==="to_or_from_this_lane"){const V=Q.laneIndex==="current"&&G?(()=>{for(let J=0;J<a[G.owner].lanes.length;J++)if(a[G.owner].lanes[J].some(me=>me.id===L))return J;return-1})():Q.laneIndex;if(V!==void 0&&V!==-1&&!(T===V)&&!(t===V))return console.error(`Illegal shift: Must shift to or from lane ${V}, but tried ${T}  ${t}`),{nextState:a}}}const M=Jl(a,T,t);if(!M.allowed)return console.error(`Illegal shift: Cannot shift from lane ${T} to ${t} - ${M.reason}`),{nextState:a};const W=Fo(a,k,q,t,F);l=W.newState;const oe=l.actionRequired!==null;if(W.animationRequests)c={animationRequests:W.animationRequests,onCompleteCallback:(Q,V)=>{var X,se,ie,_e;let J=Q;if(oe){if(D==="speed_3_end"){const Pe={type:"speed_3_self_flip_after_shift",sourceCardId:a.actionRequired.sourceCardId,actor:F};J.queuedActions=[...J.queuedActions||[],Pe]}const ye=(X=a.actionRequired)==null?void 0:X.followUpEffect,ke=(se=a.actionRequired)==null?void 0:se.conditionalType;if(ye&&L&&(ke!=="if_executed"||k)){const Pe=Se(J,L),$e=a._currentPhaseContext||(a.phase==="start"?"start":"end"),Ae={type:"execute_follow_up_effect",sourceCardId:L,followUpEffect:ye,actor:F,logContext:{indentLevel:1,sourceCardName:Pe?`${Pe.card.protocol}-${Pe.card.value}`:void 0,phase:$e}};J.queuedActions=[...J.queuedActions||[],Ae]}Se(J,L);const Ie=J._pendingCustomEffects;if(Ie){const be=Se(J,Ie.sourceCardId);if(be&&be.card.isFaceUp){const Pe=J[be.owner].lanes.find(Ae=>Ae.some(Le=>Le.id===Ie.sourceCardId));if(Pe&&Pe.length>0&&Pe[Pe.length-1].id===Ie.sourceCardId){const Ae={type:"execute_remaining_custom_effects",sourceCardId:Ie.sourceCardId,laneIndex:Ie.laneIndex,effects:Ie.effects,context:Ie.context,actor:F,logSource:Ie.logSource,logPhase:Ie.logPhase,logIndentLevel:Ie.logIndentLevel};J.queuedActions=[Ae,...J.queuedActions||[]]}}delete J._pendingCustomEffects}return J}if(D==="speed_3_end"){const ye=a.actionRequired.sourceCardId;J=ne(J,F,"Speed-3: Flipping itself after shifting a card."),J=ur(new Set([ye]),J),J.animationState={type:"flipCard",cardId:ye}}const me=J._pendingCustomEffects;if(me){const ye=Se(J,me.sourceCardId);if(ye&&ye.card.isFaceUp){const ke=J[ye.owner].lanes.find(be=>be.some(Pe=>Pe.id===me.sourceCardId));if(ke&&ke.length>0&&ke[ke.length-1].id===me.sourceCardId){for(const be of me.effects)J=st(ye.card,me.laneIndex,J,me.context,be).newState;delete J._pendingCustomEffects}else J=ne(J,F,"Pending effects cancelled because source card is now covered."),delete J._pendingCustomEffects}else delete J._pendingCustomEffects}L&&(J=$o(J)),J=gt(J,"after_shift",{player:F,cardId:k}).newState;const Y=(ie=a.actionRequired)==null?void 0:ie.followUpEffect,K=(_e=a.actionRequired)==null?void 0:_e.conditionalType;if(Y&&L&&(K!=="if_executed"||k)){const ke=Se(J,L);if(ke&&ke.card.isFaceUp){const Ie=J[ke.owner].lanes.find(Re=>Re.some(Ne=>Ne.id===L)),be=J[ke.owner].lanes.indexOf(Ie),Pe={cardOwner:ke.owner,actor:F,currentTurn:J.turn,opponent:ke.owner==="player"?"opponent":"player"},$e=`${ke.card.protocol}-${ke.card.value}`,Ae=a._currentPhaseContext||(a.phase==="start"?"start":"end");J={...J,_logIndentLevel:1,_currentEffectSource:$e,_currentPhaseContext:Ae},J=st(ke.card,be,J,Pe,Y).newState}}if(J=Ze(J),J.actionRequired=null,J.queuedActions&&J.queuedActions.length>0){const ye=J.queuedActions[0];ye.type==="execute_remaining_custom_effects"?(J=Na(J),J.animationState&&(J={...J,animationState:null})):(J.queuedActions=J.queuedActions.slice(1),J.actionRequired=ye)}return J._interruptedTurn?tl(J):V(J)}};else if(oe){if(D==="speed_3_end"){const me={type:"speed_3_self_flip_after_shift",sourceCardId:a.actionRequired.sourceCardId,actor:F};l.queuedActions=[...l.queuedActions||[],me]}const Q=(f=a.actionRequired)==null?void 0:f.followUpEffect,V=(p=a.actionRequired)==null?void 0:p.conditionalType;if(Q&&L&&(V!=="if_executed"||k)){const me=Se(l,L),ge=a._currentPhaseContext||(a.phase==="start"?"start":"end"),Y={type:"execute_follow_up_effect",sourceCardId:L,followUpEffect:Q,actor:F,logContext:{indentLevel:1,sourceCardName:me?`${me.card.protocol}-${me.card.value}`:void 0,phase:ge}};l.queuedActions=[...l.queuedActions||[],Y]}}else{if(D==="speed_3_end"){const ge=a.actionRequired.sourceCardId;l=ne(l,F,"Speed-3: Flipping itself after shifting a card."),l=ur(new Set([ge]),l),l.animationState={type:"flipCard",cardId:ge}}const Q=l._pendingCustomEffects;if(Q){const ge=Se(l,Q.sourceCardId);if(ge&&ge.card.isFaceUp){const Y=l[ge.owner].lanes.find(X=>X.some(se=>se.id===Q.sourceCardId));if(Y&&Y.length>0&&Y[Y.length-1].id===Q.sourceCardId){for(const X of Q.effects)l=st(ge.card,Q.laneIndex,l,Q.context,X).newState;delete l._pendingCustomEffects}else l=ne(l,F,"Pending effects cancelled because source card is now covered."),delete l._pendingCustomEffects}else delete l._pendingCustomEffects}L&&(l=$o(l)),l=gt(l,"after_shift",{player:F,cardId:k}).newState;const J=(u=a.actionRequired)==null?void 0:u.followUpEffect,me=(h=a.actionRequired)==null?void 0:h.conditionalType;if(J&&L&&(me!=="if_executed"||k)){const Y=Se(l,L);if(Y&&Y.card.isFaceUp){const K=l[Y.owner].lanes.find(ke=>ke.some(Ie=>Ie.id===L)),X=l[Y.owner].lanes.indexOf(K),se={cardOwner:Y.owner,actor:F,currentTurn:l.turn,opponent:Y.owner==="player"?"opponent":"player"},ie=`${Y.card.protocol}-${Y.card.value}`,_e=a._currentPhaseContext||(a.phase==="start"?"start":"end");l={...l,_logIndentLevel:1,_currentEffectSource:ie,_currentPhaseContext:_e},l=st(Y.card,X,l,se,J).newState}}if(l=Ze(l),l.actionRequired=null,l.queuedActions&&l.queuedActions.length>0){const ge=l.queuedActions[0];if(ge.type==="execute_remaining_custom_effects"){if(l=Na(l),l.animationState&&!l.actionRequired){const Y=l.animationState;Y.type==="draw"&&(c={animationRequests:[{type:"draw",player:Y.player,count:Y.count}],onCompleteCallback:(K,X)=>{const se={...K,animationState:null};return X(se)}},l={...l,animationState:null})}}else l.queuedActions=l.queuedActions.slice(1),l.actionRequired=ge}}break}case"shift_flipped_card_optional":{const k=a.actionRequired.cardId,q=a.actionRequired.actor;let F=null;for(const G of["player","opponent"])if(a[G].lanes.flat().some(ae=>ae.id===k)){F=G;break}if(!F){console.error("[shift_flipped_card_optional] Card not found on board:",k),l=a;break}const D=(y=a.actionRequired)==null?void 0:y.followUpEffect,T=(g=a.actionRequired)==null?void 0:g.conditionalType,L=(_=a.actionRequired)==null?void 0:_.sourceCardId,B=Fo(a,k,F,t,q);if(l=B.newState,D&&L&&(T!=="if_executed"||k)){const ae=Se(l,L),M=a._currentPhaseContext||(a.phase==="start"?"start":"end"),W={type:"execute_follow_up_effect",sourceCardId:L,followUpEffect:D,actor:q,logContext:{indentLevel:1,sourceCardName:ae?`${ae.card.protocol}-${ae.card.value}`:void 0,phase:M}};l={...l,queuedActions:[...l.queuedActions||[],W]}}B.animationRequests&&(c={animationRequests:B.animationRequests,onCompleteCallback:(G,ae)=>ae(G)});break}case"select_lane_for_play":{const{cardInHandId:k,isFaceDown:q,actor:F,source:D,disallowedLaneIndex:T,validLanes:L,preSelectedLane:B}=a.actionRequired,G=B!==void 0?B:t;if(T!==void 0&&G===T)return{nextState:a,requiresTurnEnd:!1};if(L&&!L.includes(G))return{nextState:a,requiresTurnEnd:!1};if(D==="deck"){const V=(x=a.actionRequired)==null?void 0:x.followUpEffect;(S=a.actionRequired)==null||S.conditionalType;const J=(E=a.actionRequired)==null?void 0:E.sourceCardId,me=(b=a.actionRequired)==null?void 0:b.preDrawnCard,ge={...a,actionRequired:null},Y=ge[F];let K,X=Y.deck,se=Y.discard;if(me)K={...me,isFaceUp:!q};else{const Ie=Pn(Y.deck,Y.discard,1);if(X=Ie.remainingDeck,se=Ie.newDiscard,Ie.drawnCards.length===0){console.error("No cards in deck/discard to play"),l=ge;break}K={...Ie.drawnCards[0],id:ot(),isFaceUp:!q}}const ie=[...Y.lanes];ie[G]=[...ie[G],K];const _e={...Y,lanes:ie,deck:X,discard:se};l={...ge,[F]:_e,lastCustomEffectTargetCardId:K.id};const ye=F==="player"?"Player":"Opponent",ke=q?"face-down":"face-up";l=ne(l,F,`${ye} plays ${K.protocol}-${K.value} ${ke} from deck.`),c={animationRequests:[{type:"play",cardId:K.id,owner:F,laneIndex:G,isFaceUp:K.isFaceUp}],onCompleteCallback:(Ie,be)=>{let Pe=Ie;if(V&&J){const $e=Se(Pe,J);if($e&&$e.card.isFaceUp){const Ae=Pe[$e.owner].lanes.find(ht=>ht.some(ct=>ct.id===J)),Le=Pe[$e.owner].lanes.indexOf(Ae),Re={cardOwner:$e.owner,actor:F,currentTurn:Pe.turn,opponent:$e.owner==="player"?"opponent":"player"};if(Pe=st($e.card,Le,Pe,Re,V).newState,Pe.actionRequired)return Pe}}return be(Pe)}};break}if(D==="trash"){const V=(j=a.actionRequired)==null?void 0:j.preDrawnCard,J=(C=a.actionRequired)==null?void 0:C.sourceCardId,me=(R=a.actionRequired)==null?void 0:R.followUpEffect,ge=(A=a.actionRequired)==null?void 0:A.conditionalType,Y=(I=a.actionRequired)==null?void 0:I.useNormalPlayRules;if(!V){console.error("No preDrawnCard for trash play"),l={...a,actionRequired:null};break}const K={...a,actionRequired:null},X=K[F];let se;if(typeof q=="boolean")se=!q;else if(Y){const be=F==="player"?"opponent":"player",Pe=a[F].protocols[G],$e=a[be].protocols[G],Ae=V.protocol===Pe||V.protocol===$e,Le=ts(a,F,G);se=Ae||Le}else se=!0;const ie={...V,isFaceUp:se},_e=[...X.lanes];_e[G]=[..._e[G],ie];const ye={...X,lanes:_e};l={...K,[F]:ye,lastCustomEffectTargetCardId:ie.id};const ke=F==="player"?"Player":"Opponent",Ie=se?"face-up":"face-down";l=ne(l,F,`${ke} plays ${ie.protocol}-${ie.value} ${Ie} from trash.`),l=Ee(l),c={animationRequests:[{type:"play",cardId:ie.id,owner:F,laneIndex:G,isFaceUp:ie.isFaceUp}],onCompleteCallback:(be,Pe)=>{let $e=be;if(ie.isFaceUp){const Ae=Se($e,ie.id);if(Ae){const Le={cardOwner:F,actor:F,currentTurn:$e.turn,opponent:F==="player"?"opponent":"player",triggerType:"play"};if($e=ol(Ae.card,G,$e,Le).newState,$e.actionRequired)return me&&J&&($e={...$e,queuedActions:[...$e.queuedActions||[],{type:"execute_followup_effect",sourceCardId:J,followUpEffect:me,conditionalType:ge,actor:F}]}),$e}}if(me&&J){const Ae=Se($e,J);if(Ae&&Ae.card.isFaceUp){const Le=$e[Ae.owner].lanes.find(ct=>ct.some(Ct=>Ct.id===J)),Re=$e[Ae.owner].lanes.indexOf(Le),Ne={cardOwner:Ae.owner,actor:F,currentTurn:$e.turn,opponent:Ae.owner==="player"?"opponent":"player"};if($e=st(Ae.card,Re,$e,Ne,me).newState,$e.actionRequired)return $e}}return Pe($e)}};break}const ae=a[F].hand.find(V=>V.id===k);if(!ae){console.error("Card for play not found in hand"),l={...a,actionRequired:null};break}const M={...a,actionRequired:null};let W;if(typeof q=="boolean")W=!q;else{const V=a[F].lanes.flat().some(Y=>Y.isFaceUp&&Y.protocol==="Spirit"&&Y.value===1),J=a[F].lanes.some(Y=>{if(Y.length===0)return!1;const K=Y[Y.length-1];return K.isFaceUp&&K.protocol==="Chaos"&&K.value===3}),me=F==="player"?"opponent":"player",ge=a[me].lanes.flat().some(Y=>Y.isFaceUp&&Y.protocol==="Psychic"&&Y.value===1);W=(V||J||ae.protocol===a[F].protocols[G]||ae.protocol===a[me].protocols[G])&&!ge}const{newState:oe,animationRequests:Q}=_c(M,k,G,W,F);l=oe,Q&&(c={animationRequests:Q,onCompleteCallback:(V,J)=>(V.queuedActions&&V.queuedActions.length>0,J(V))});break}case"select_lane_for_delete":{const k=a.actionRequired.actor,q=k==="player"?"Player":"Opponent",F=a.player.protocols[t],D=a.actionRequired.targetFilter||{},T=Se(a,a.actionRequired.sourceCardId),L=T?`${T.card.protocol}-${T.card.value}`:"a card effect",B=a.actionRequired.count||1,G=a.actionRequired.deleteAll===!0,ae=a.actionRequired.validLanes;if(ae&&!ae.includes(t))return console.error(`Illegal delete lane selection: Lane ${t} not in valid lanes ${ae}`),{nextState:a};l=ne(l,k,`${L}: ${q} targets Protocol ${F}.`);const M=new Map;for(const V of["player","opponent"]){const J=a[V].lanes[t];M.set(V,J.length>0?J[J.length-1].id:null)}const W=[],oe=[],Q=new Set;for(const V of["player","opponent"]){const J=a[V],me=J.lanes[t].some(Y=>Y.isFaceUp&&Y.protocol==="Darkness"&&Y.value===2)?4:2,ge=J.lanes[t];for(let Y=0;Y<ge.length;Y++){const K=ge[Y],X=Y===ge.length-1,se=K.isFaceUp?K.value:me;if(D.valueRange){const{min:ye,max:ke}=D.valueRange;if(se<ye||se>ke)continue}if(D.faceState==="face_up"&&!K.isFaceUp||D.faceState==="face_down"&&K.isFaceUp||D.owner==="own"&&V!==k||D.owner==="opponent"&&V===k||D.position==="uncovered"&&!X||D.position==="covered"&&X)continue;W.push({type:"delete",cardId:K.id,owner:V}),Q.add(K.id);const ie=V==="player"?"Player's":"Opponent's",_e=K.isFaceUp?`${K.protocol}-${K.value}`:"a face-down card";if(oe.push(`${ie} ${_e}`),!G&&W.length>=B)break}if(!G&&W.length>=B)break}if(oe.length>0){l=ne(l,k,`${L}: Deleting ${oe.join(", ")}.`);const V={...l.stats[k],cardsDeleted:l.stats[k].cardsDeleted+oe.length},J={...l[k],stats:V};l={...l,[k]:J,stats:{...l.stats,[k]:V}}}if(l=Ze(l),l.actionRequired=null,W.length>0){const V=(U=a.actionRequired)==null?void 0:U.followUpEffect,J=($=a.actionRequired)==null?void 0:$.conditionalType,me=a.actionRequired.sourceCardId;c={animationRequests:W,onCompleteCallback:(ge,Y)=>{let K=ge;K=gt(K,"after_delete",{player:k}).newState;const se=[];for(const ie of["player","opponent"]){const _e=M.get(ie),ye=K[ie].lanes[t];_e&&Q.has(_e)&&ye.length>0&&se.push(ie)}for(let ie=0;ie<se.length;ie++){const _e=se[ie];if(K=Un(K,_e,t).newState,K.actionRequired&&ie<se.length-1){const ke=se.slice(ie+1);for(const Ie of ke)K.queuedActions=[...K.queuedActions||[],{type:"pending_uncover_effect",owner:Ie,laneIndex:t}];return K}}if(V&&me&&(J!=="if_executed"||W.length>0)){const _e=Se(K,me);if(_e&&_e.card.isFaceUp){const ye=K[_e.owner].lanes.find(Pe=>Pe.some($e=>$e.id===me)),ke=K[_e.owner].lanes.indexOf(ye),Ie={cardOwner:_e.owner,actor:k,currentTurn:K.turn,opponent:_e.owner==="player"?"opponent":"player"};if(K=st(_e.card,ke,K,Ie,V).newState,K.actionRequired)return K}}return Y(K)}}}break}case"select_lane_for_return":{const k=a.actionRequired.actor,q=k==="player"?"Player":"Opponent",F=a.player.protocols[t],D=a.actionRequired.targetFilter||{},T=Se(a,a.actionRequired.sourceCardId),L=T?`${T.card.protocol}-${T.card.value}`:"a card effect";l=ne(l,k,`${L}: ${q} targets Protocol ${F}.`);const B=[],G=[];for(const ae of["player","opponent"]){const M=a[ae],W=M.lanes[t].some(oe=>oe.isFaceUp&&oe.protocol==="Darkness"&&oe.value===2)?4:2;for(const oe of M.lanes[t]){const Q=oe.isFaceUp?oe.value:W;if(D.valueEquals!==void 0&&Q!==D.valueEquals||D.faceState==="face_up"&&!oe.isFaceUp||D.faceState==="face_down"&&oe.isFaceUp||D.owner==="own"&&ae!==k||D.owner==="opponent"&&ae===k)continue;B.push({type:"return",cardId:oe.id,owner:ae});const V=ae==="player"?"Player's":"Opponent's",J=oe.isFaceUp?`${oe.protocol}-${oe.value}`:"a face-down card";G.push(`${V} ${J}`)}}if(B.length===0){l=ne(l,k,`${L}: No matching cards in Protocol ${F}.`),l=Ze(l),l.actionRequired=null;break}if(G.length>0&&(l=ne(l,k,`${L}: Returning ${G.join(", ")}.`)),l=Ze(l),l.actionRequired=null,B.length>0){const ae=(Z=a.actionRequired)==null?void 0:Z.followUpEffect,M=(ee=a.actionRequired)==null?void 0:ee.conditionalType,W=a.actionRequired.sourceCardId;c={animationRequests:B,onCompleteCallback:(oe,Q)=>{let V=oe;if(ae&&W&&(M!=="if_executed"||B.length>0)){const me=Se(V,W);if(me&&me.card.isFaceUp){const ge=V[me.owner].lanes.find(se=>se.some(ie=>ie.id===W)),Y=V[me.owner].lanes.indexOf(ge),K={cardOwner:me.owner,actor:k,currentTurn:V.turn,opponent:me.owner==="player"?"opponent":"player"};if(V=st(me.card,Y,V,K,ae).newState,V.actionRequired)return V}}return Q(V)}}}break}case"select_lane_for_delete_all":{const k=a.actionRequired.actor,q=k==="player"?"Player":"Opponent",F=a.player.protocols[t],D=a.actionRequired.minCards||8;if(!(a.actionRequired.validLanes||[0,1,2]).includes(t)){l=ne(l,k,"Cannot select this lane for deletion.");break}const L=a.player.lanes[t].length+a.opponent.lanes[t].length;if(L<D){l=ne(l,k,`Cannot delete ${F} line (only ${L} cards, need ${D}+).`),l=Ze(l),l.actionRequired=null;break}const B=Se(a,a.actionRequired.sourceCardId),G=B?`${B.card.protocol}-${B.card.value}`:"Effect";l=ne(l,k,`${G}: ${q} deletes all cards in ${F} line.`);const ae=[];for(const oe of["player","opponent"])for(const Q of a[oe].lanes[t])ae.push({type:"delete",cardId:Q.id,owner:oe});const M={...l.stats[k],cardsDeleted:l.stats[k].cardsDeleted+ae.length},W={...l[k],stats:M};if(l={...l,[k]:W,stats:{...l.stats,[k]:M}},l=Ze(l),l.actionRequired=null,ae.length>0){const oe=(z=a.actionRequired)==null?void 0:z.followUpEffect,Q=(O=a.actionRequired)==null?void 0:O.conditionalType,V=a.actionRequired.sourceCardId;c={animationRequests:ae,onCompleteCallback:(J,me)=>{let ge=J;if(ge=gt(ge,"after_delete",{player:k}).newState,oe&&V&&(Q!=="if_executed"||ae.length>0)){const X=Se(ge,V);if(X&&X.card.isFaceUp){const se=ge[X.owner].lanes.find(ke=>ke.some(Ie=>Ie.id===V)),ie=ge[X.owner].lanes.indexOf(se),_e={cardOwner:X.owner,actor:k,currentTurn:ge.turn,opponent:X.owner==="player"?"opponent":"player"};if(ge=st(X.card,ie,ge,_e,oe).newState,ge.actionRequired)return ge}}return me(ge)}}}break}case"select_lane_to_shift_revealed_board_card_custom":{const{revealedCardId:k,actor:q}=a.actionRequired,F=Se(a,k);if(F){const D=Fo(a,k,F.owner,t,q);l=D.newState,D.animationRequests&&(c={animationRequests:D.animationRequests,onCompleteCallback:(T,L)=>T.actionRequired?T:L(T)})}break}case"select_lanes_for_swap_stacks":{const{actor:k,sourceCardId:q,validLanes:F,selectedFirstLane:D}=a.actionRequired;if(!F.includes(t))return console.error(`Illegal swap_stacks: Lane ${t} is not a valid selection`),{nextState:a};if(D===void 0)l.actionRequired={type:"select_lanes_for_swap_stacks",actor:k,sourceCardId:q,validLanes:F.filter(T=>T!==t),selectedFirstLane:t},l=ne(l,k,`Selected lane ${t+1} for swap.`);else{const T=D,L=t,B=[...l[k].lanes[T]],G=[...l[k].lanes[L]];l[k].lanes[T]=G,l[k].lanes[L]=B,l=ne(l,k,`Swapped all cards between lane ${T+1} and lane ${L+1}.`),l.actionRequired=null}break}default:return{nextState:a}}return{nextState:Ee(l),requiresAnimation:c}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const tm=(a,t)=>{if(a.processedSpeed1TriggerThisTurn)return a;if(a[t].lanes.flat().some(i=>i.isFaceUp&&i.protocol==="Speed"&&i.value===1)){let i={...a};return i=We(i,"Speed-1"),i=Ke(i,void 0),i=ne(i,t,"Triggers after clearing cache: Draw 1 card."),i=fr(i,t,1),i.processedSpeed1TriggerThisTurn=!0,i=We(i,void 0),i.phase="end",i}return a},dr=(a,t,l)=>{var Z,ee,z,O;const c=a[l],i=new Set(t),d=c.hand.filter(k=>i.has(k.id));if(d.length===0)return a;const f=c.hand.filter(k=>!i.has(k.id)),p=[...c.discard,...d.map(({id:k,isFaceUp:q,...F})=>F)],u=((Z=a.animationState)==null?void 0:Z.type)==="discardCard"&&((ee=a.animationState.originalAction)==null?void 0:ee.type)==="discard"?a.animationState.originalAction:((z=a.actionRequired)==null?void 0:z.type)==="discard"?a.actionRequired:null,h={...c.stats,cardsDiscarded:c.stats.cardsDiscarded+d.length},y={...c,hand:f,discard:p,stats:h},g=u==null?void 0:u.followUpEffect,_=u==null?void 0:u.conditionalType,x=u==null?void 0:u.previousHandSize;let S={...a,[l]:y,stats:{...a.stats,[l]:h},actionRequired:g?{type:"discard_completed",followUpEffect:g,conditionalType:_,previousHandSize:x,sourceCardId:u==null?void 0:u.sourceCardId,actor:l}:null};if(u!=null&&u.sourceCardId){const k=S.player.lanes.flat().find(q=>q.id===u.sourceCardId)||S.opponent.lanes.flat().find(q=>q.id===u.sourceCardId);if(k){const q=`${k.protocol}-${k.value}`;S=We(S,q),S=Ke(S,"middle")}else S=We(S,void 0),S=Ke(S,void 0),S={...S,_logIndentLevel:0}}else S=We(S,void 0),S=Ke(S,void 0);const E=l==="player"?"Player":"Opponent";let b;if(l==="player"||d.every(k=>k.isRevealed)){const k=d.map(q=>`${q.protocol}-${q.value}`).join(", ");b=`${E} discards ${k}.`}else{const k=d.length===1?"card":"cards";b=`${E} discards ${d.length} ${k}.`}S=ne(S,l,b);const j=(k,q)=>{var M;const F=a.phase==="hand_limit"&&!(q!=null&&q.sourceCardId);let D=k;F&&(D=$o(D),D=tm(D,l),D=gt(D,"after_clear_cache",{player:l}).newState,((M=D.processedClearCacheTriggerIds)==null?void 0:M.length)>0&&(D.phase="end")),D=Cm(D,l,q==null?void 0:q.sourceEffect,q==null?void 0:q.sourceCardId);const T=D.actionRequired,L=(q==null?void 0:q._savedIndentLevel)||D._logIndentLevel||1;if(T&&(D.actionRequired=null),D=gt(D,"after_discard",{player:l}).newState,D=gt(D,"after_opponent_discard",{player:l==="player"?"opponent":"player"}).newState,T){const W=T.actor,oe=W?D[W].hand.length:0,Q=T.count||1,V=Math.min(Q,oe);V<=0||(D.actionRequired?D.queuedActions=[{...T,type:T.type,count:V,_savedIndentLevel:L},...D.queuedActions||[]]:D.actionRequired={...T,count:V})}return D};if(u&&u.actor===l){const k=u.count-t.length;return k>0?(S.actionRequired={...u,count:k},S):u.followUpEffect?{...S,actionRequired:{type:"discard_completed",followUpEffect:u.followUpEffect,conditionalType:u.conditionalType,previousHandSize:u.previousHandSize,sourceCardId:u.sourceCardId,actor:l}}:j(S,u)}const C=a.actionRequired;if(C&&C.type==="discard"&&C.actor===l){const k=C.count-t.length;return k>0?(S.actionRequired={...C,count:k},S):C.followUpEffect?{...S,actionRequired:{type:"discard_completed",followUpEffect:C.followUpEffect,conditionalType:C.conditionalType,previousHandSize:C.previousHandSize,sourceCardId:C.sourceCardId,actor:l}}:j(S,C)}const R=a.phase==="hand_limit";S=gt(S,"after_discard",{player:l}).newState;let $=gt(S,"after_opponent_discard",{player:l==="player"?"opponent":"player"}).newState;return R&&($=tm($,l),$=gt($,"after_clear_cache",{player:l}).newState,((O=$.processedClearCacheTriggerIds)==null?void 0:O.length)>0&&($.phase="end")),$},ww=(a,t)=>{var f;if(((f=a.actionRequired)==null?void 0:f.type)!=="plague_2_player_discard")return a;const l=a.actionRequired.actor,c=l==="player"?"opponent":"player";let i=dr(a,t,l);const d=t.length+1;return i[c].hand.length>0?i.actionRequired={type:"discard",actor:c,count:Math.min(d,i[c].hand.length),sourceCardId:a.actionRequired.sourceCardId}:(i=Ze(i),i.actionRequired=null),i},Dd=(a,t)=>{var f;if(((f=a.actionRequired)==null?void 0:f.type)!=="plague_2_opponent_discard")return a;const l=a.actionRequired.actor,c=l==="player"?"opponent":"player";let i=dr(a,t,l);const d=t.length+1;return i[c].hand.length>0?i.actionRequired={type:"discard",actor:c,count:Math.min(d,i[c].hand.length),sourceCardId:a.actionRequired.sourceCardId}:(i=Ze(i),i.actionRequired=null),i},Fd=(a,t)=>{var h,y,g,_;const l=((h=a.actionRequired)==null?void 0:h.type)==="discard"&&((y=a.actionRequired)==null?void 0:y.variableCount),c=((g=a.actionRequired)==null?void 0:g.type)==="discard"&&a.actionRequired.count>1,i=((_=a.actionRequired)==null?void 0:_.type)==="select_cards_from_hand_to_discard_for_fire_4";if(!l&&!c&&!i)return a;const d=a.actionRequired.actor,f=a.actionRequired.sourceCardId;let p=dr(a,t,d);if((l||c)&&f)return Cm(p,d,void 0,f);if(c&&!f)return p;const u=t.length+1;return p=ne(p,d,`Fire-4: Drawing ${u} card(s).`),p=fr(p,d,u),p},qd=(a,t)=>{var u;if(((u=a.actionRequired)==null?void 0:u.type)!=="select_cards_from_hand_to_discard_for_hate_1")return a;const{sourceCardId:l,actor:c}=a.actionRequired;let i=dr(a,t,c);const f=M0(i,[]),p=Math.min(2,f);return p>0?i.actionRequired={type:"select_cards_to_delete",count:p,sourceCardId:l,disallowedIds:[],actor:c}:(i=ne(i,c,"Hate-1: No valid targets to delete."),i=Ze(i),i.actionRequired=null),i};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Zl=(a,t,l)=>{const c=a.turn,i=c==="player"?"opponent":"player";let d={...a};if(d.compileBlockedPlayer===c&&d.compileBlockedUntilTurn>(d.turnNumber||0))return d=ne(d,c,`${c==="player"?"Player":"Opponent"} can't compile - blocked by opponent's effect.`),d;if(d.useControlMechanic&&d.controlCardHolder===c){const F=c==="player"?"Player":"Opponent";return d=We(d,void 0),d=Ke(d,void 0),d={...d,_logIndentLevel:0},d=ne(d,c,`${F} has Control and may rearrange protocols before compiling.`),d=Ra(d),d.actionRequired={type:"prompt_use_control_mechanic",sourceCardId:"CONTROL_MECHANIC",actor:c,originalAction:{type:"compile",laneIndex:t}},d.controlCardHolder=null,d}let u={...d[c]},h={...d[i]};const y=u.compiled[t],g=[];for(const F of[c,i])d[F].lanes[t].forEach(T=>{if(T.isFaceUp){const L=T;L.customEffects&&L.customEffects.topEffects&&L.customEffects.topEffects.some(G=>G.trigger==="before_compile_delete")&&g.push({card:T,owner:F})}});for(const{card:F,owner:D}of g)d=gt(d,"before_compile_delete",{player:D,cardId:F.id}).newState;u={...d[c]},h={...d[i]};const _=F=>{if(F.protocol==="Speed"&&F.value===2&&F.isFaceUp)return!0;const D=F;return D.customEffects&&D.customEffects.topEffects&&F.isFaceUp?D.customEffects.topEffects.some(T=>{var L,B;return T.trigger==="before_compile_delete"&&((L=T.params)==null?void 0:L.action)==="shift"&&((B=T.params)==null?void 0:B.shiftSelf)===!0}):!1},x=[],S=[],E=u.lanes[t].filter(F=>_(F)?(x.push(F),!1):!0),b=h.lanes[t].filter(F=>_(F)?(S.push(F),!1):!0),j={...u.stats},C={...h.stats};u.discard=[...u.discard,...E.map(({id:F,isFaceUp:D,...T})=>T)],h.discard=[...h.discard,...b.map(({id:F,isFaceUp:D,...T})=>T)];const R=[...u.lanes];R[t]=x,u.lanes=R;const A=[...h.lanes];A[t]=S,h.lanes=A;const I=[...u.compiled];if(I[t]=!0,u.compiled=I,d={...d,[c]:u,[i]:h,stats:{...d.stats,[c]:j,[i]:C}},d.detailedGameStats){const F=y,D=c==="player"?F?"playerRecompile":"playerFirstCompile":F?"aiRecompile":"aiFirstCompile";d={...d,detailedGameStats:{...d.detailedGameStats,compiles:{...d.detailedGameStats.compiles,[D]:d.detailedGameStats.compiles[D]+1}}}}d=We(d,void 0),d=Ke(d,void 0),d={...d,_logIndentLevel:0};const U=c==="player"?"Player":"Opponent",$=u.protocols[t];if(d=ne(d,c,`${U} compiles Protocol ${$}!`),y&&(d=ne(d,c,`${U} draws 1 card from the opponent's deck as a re-compile reward.`),d=fw(d,c,1)),d=Ee(d),u.compiled.every(F=>F===!0))return d.winner=c,l(c,d),d;E.length+b.length>0&&(d=gt(d,"after_delete",{player:c}).newState),d=gt(d,"after_compile",{player:c}).newState,d=gt(d,"after_opponent_compile",{player:i}).newState;const q=[...x,...S].map(F=>{const D=Se(d,F.id).owner,T=F.isFaceUp?`${F.protocol}-${F.value}`:"Card";return d=ne(d,D,`${T} survives compilation and must be shifted.`),{type:"select_lane_for_shift",cardToShiftId:F.id,cardOwner:D,originalLaneIndex:t,sourceCardId:F.id,actor:D}});if(q.length>0){const F=q.shift();d.actionRequired=F,d.queuedActions=q,F.actor!==c&&(d._interruptedTurn=c,d._interruptedPhase=d.phase,d.turn=F.actor)}else d.actionRequired=null,d.queuedActions=[];return d},Rm=(a,t)=>a,xw=(a,t)=>{var x;if(((x=a.actionRequired)==null?void 0:x.type)!=="select_card_from_hand_to_play")return a;const{disallowedLaneIndex:l,sourceCardId:c,isFaceDown:i,actor:d,destinationRule:f,condition:p,faceDown:u,targetLaneIndex:h,validLanes:y,selectableCardIds:g,valueFilter:_}=a.actionRequired;return g&&!g.includes(t)?a:h!==void 0?{...a,actionRequired:{type:"select_lane_for_play",cardInHandId:t,sourceCardId:c,isFaceDown:i||u,actor:d,source:"hand",preSelectedLane:h}}:{...a,actionRequired:{type:"select_lane_for_play",cardInHandId:t,disallowedLaneIndex:l,sourceCardId:c,isFaceDown:i||u,actor:d,destinationRule:f,condition:p,validLanes:y}}},nm=a=>{if(!a.actionRequired||!("optional"in a.actionRequired)||!a.actionRequired.optional)return a;const t="actor"in a.actionRequired?a.actionRequired.actor:a.turn,l=t==="player"?"Player":"Opponent";let c={...a,actionRequired:null};return c=ne(c,t,`${l} skips the optional action.`),c},am=a=>{var d;if(((d=a.actionRequired)==null?void 0:d.type)!=="reveal_opponent_hand")return a;const t=a.actionRequired.actor,l=t==="player"?"opponent":"player";let c={...a};const i={...c[l]};if(i.hand.length>0){i.hand=i.hand.map(u=>({...u,isRevealed:!0})),c[l]=i;const f=Se(c,a.actionRequired.sourceCardId),p=f?`${f.card.protocol}-${f.card.value}`:"A card effect";c=ne(c,t,`${p}: Opponent reveals their hand.`)}return c.actionRequired=null,c},om=(a,t)=>Pd(a,t),rm=(a,t)=>Ud(a,t).newState,Nm=(a,t)=>{var g;if(((g=a.actionRequired)==null?void 0:g.type)!=="select_card_from_revealed_deck")return a;const c=a.actionRequired.actor,i=c==="player"?"Player":"Opponent";let d={...a};const f={...d[c]},p=[...f.deck],u=p.findIndex(_=>(_.id||`deck-${p.indexOf(_)}`)===t);if(u===-1)return console.warn(`[resolveSelectRevealedDeckCard] Card ${t} not found in deck`),d.actionRequired=null,d;const h=p.splice(u,1)[0],y={...h,id:h.id||`drawn-${Date.now()}`,isFaceUp:!0};return f.deck=p,f.hand=[...f.hand,y],f.deckRevealed=!1,d[c]=f,d=ne(d,c,`${i} draws ${h.protocol}-${h.value} from the revealed deck.`),d.actionRequired=null,d=Ze(d),d},eu=(a,t)=>{var d;if(((d=a.actionRequired)==null?void 0:d.type)!=="state_number")return a;const c=a.actionRequired.actor;let i=ew(a,c,t);return i=Ze(i),i},tu=(a,t)=>{var d;if(((d=a.actionRequired)==null?void 0:d.type)!=="state_protocol")return a;const c=a.actionRequired.actor;let i=aw(a,c,t);return i=Ze(i),i},nu=(a,t)=>{var g;if(((g=a.actionRequired)==null?void 0:g.type)!=="select_from_drawn_to_reveal")return a;const l=a.actionRequired,c=l.actor,i=c==="player"?"Player":"Opponent",d=l.statedNumber,f=l.thenAction;let p={...a};const h=p[c].hand.find(_=>_.id===t);if(!h)return p.actionRequired=null,p=Ze(p),p;const y=d!==void 0?` (stated value: ${d})`:"";return p=ne(p,c,`${i} reveals ${h.protocol}-${h.value}${y}.`),p.lastCustomEffectTargetCardId=t,p.actionRequired=null,f==="may_play"&&(p.actionRequired={type:"prompt_optional_effect",actor:c,sourceCardId:l.sourceCardId,effectDef:{params:{action:"play",source:"hand",useCardFromPreviousEffect:!0}},optional:!0}),p},au=a=>{var h;if(((h=a.actionRequired)==null?void 0:h.type)!=="confirm_deck_discard")return a;const t=a.actionRequired,{sourceCardId:l,followUpEffect:c,conditionalType:i,laneIndex:d,actor:f,discardedCard:p}=t;let u={...a};if(u.actionRequired=null,c&&l){const y=Se(u,l);if(y&&y.card.isFaceUp){const g={cardOwner:y.owner,opponent:y.owner==="player"?"opponent":"player"},_=d!==void 0?d:u[y.owner].lanes.findIndex(S=>S.some(E=>E.id===l));if(i==="if_protocol_matches_stated"){const S=p==null?void 0:p.protocol,E=u.lastStatedProtocol;if(!E||!S||S!==E)return u=ne(u,y.owner,`Discarded card (${S}) does not match stated protocol "${E||"none"}". Effect skipped.`),u=Ze(u),u;u=ne(u,y.owner,`Discarded card matches stated protocol "${E}"!`)}if(u=st(y.card,_,u,g,c).newState,u.actionRequired)return u}}return u=Ze(u),u},Tm=(a,t)=>{var j;if(((j=a.actionRequired)==null?void 0:j.type)!=="select_card_from_trash_to_play")return a;const l=a.actionRequired,c=l.actor,i=c==="player"?"Player":"Opponent",{sourceCardId:d,faceDown:f,destinationRule:p,followUpEffect:u,conditionalType:h,sourceLaneIndex:y}=l;let g={...a};const _={...g[c]};if(t<0||t>=_.discard.length)return console.warn(`[resolveSelectTrashCardToPlay] Invalid index ${t}`),g.actionRequired=null,g;const x=[..._.discard],S=x.splice(t,1)[0];_.discard=x,g[c]=_;const E={...S,id:`trash-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,isFaceUp:f!==!0};g=ne(g,c,`${i} selects ${S.protocol}-${S.value} from trash.`);const b=f===void 0;if((p==null?void 0:p.type)==="other_lines"){const C=[0,1,2].filter(R=>R!==y);g.actionRequired={type:"select_lane_for_play",sourceCardId:d,actor:c,isFaceDown:f,source:"trash",preDrawnCard:E,disallowedLaneIndex:y,validLanes:C,useNormalPlayRules:b,followUpEffect:u,conditionalType:h}}else g.actionRequired={type:"select_lane_for_play",sourceCardId:d,actor:c,isFaceDown:f,source:"trash",preDrawnCard:E,useNormalPlayRules:b,followUpEffect:u,conditionalType:h};return g},Am=(a,t)=>{var S,E;if(((S=a.actionRequired)==null?void 0:S.type)!=="select_card_from_trash_to_reveal")return a;const l=a.actionRequired,c=l.actor,i=c==="player"?"Player":"Opponent",{sourceCardId:d,followUpEffect:f,conditionalType:p,sourceLaneIndex:u}=l;let h={...a};const y={...h[c]};if(t<0||t>=y.discard.length)return console.warn(`[resolveSelectTrashCardToReveal] Invalid index ${t}`),h.actionRequired=null,h;const g=[...y.discard],_=g.splice(t,1)[0];y.discard=g,h[c]=y,h=ne(h,c,`${i} reveals ${_.protocol}-${_.value} from trash.`);const x={..._,id:`trash-revealed-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,isFaceUp:!1};if(f){const b=Se(h,d);if(b&&b.card.isFaceUp){const j=(E=f.params)==null?void 0:E.destinationRule,C=(j==null?void 0:j.type)==="other_lines"?[0,1,2].filter(R=>R!==u):[0,1,2];h.actionRequired={type:"select_lane_for_play",sourceCardId:d,actor:c,isFaceDown:!0,source:"trash",preDrawnCard:x,disallowedLaneIndex:(j==null?void 0:j.type)==="other_lines"?u:void 0,validLanes:(j==null?void 0:j.type)==="other_lines"?C:void 0}}else h=ne(h,c,"Source card no longer active. Play effect skipped."),h.actionRequired=null,h=Ze(h)}else h.actionRequired=null,h=Ze(h);return h},ou=a=>{var g;if(((g=a.actionRequired)==null?void 0:g.type)!=="confirm_deck_play_preview")return a;const t=a.actionRequired,{sourceCardId:l,actor:c,drawnCard:i,isFaceDown:d,excludeCurrentLane:f,currentLaneIndex:p,followUpEffect:u,conditionalType:h}=t;let y={...a};return y.actionRequired={type:"select_lane_for_play",sourceCardId:l,actor:c,count:1,isFaceDown:d,excludeCurrentLane:f,currentLaneIndex:p,source:"deck",preDrawnCard:i,followUpEffect:u,conditionalType:h},y};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const zd=(a,t)=>{var g,_;if(((g=a.actionRequired)==null?void 0:g.type)!=="prompt_optional_draw")return a;const{sourceCardId:l,actor:c,count:i,drawingPlayer:d,logSource:f,logPhase:p,logIndentLevel:u}=a.actionRequired,h=c.charAt(0).toUpperCase()+c.slice(1);let y={...a};if(f!==void 0&&(y=We(y,f)),p!==void 0&&(y=Ke(y,p)),u!==void 0&&(y._logIndentLevel=u),t){y=ne(y,c,`${h} chooses to execute the optional draw effect.`),y=fr(y,d||c,i),y=ne(y,c,`${h} draws ${i} card${i!==1?"s":""}.`);const x=a.actionRequired.followUpEffect;if(a.actionRequired.conditionalType,x){const S=Se(y,l);if(S){const E=y[S.owner].lanes.findIndex(R=>R.some(A=>A.id===l)),b=c==="player"?"opponent":"player",j={cardOwner:c,actor:c,currentTurn:y.turn,opponent:b,triggerType:"start"};y=st(S.card,E,y,j,x).newState,y=Ze(y)}else{const E=a.actionRequired.logSource||"deleted card";y=ne(y,c,`${E}: Follow-up effect skipped (source no longer active).`),y.actionRequired=null,((_=y._pendingCustomEffects)==null?void 0:_.sourceCardId)===l&&delete y._pendingCustomEffects,y.queuedActions&&y.queuedActions.length>0&&(y.queuedActions=y.queuedActions.filter(b=>b.sourceCardId!==l))}}else y.actionRequired=null}else y=ne(y,c,`${h} skips the draw.`),y.actionRequired=null;return y},lm=(a,t,l)=>{var i;if(((i=a.actionRequired)==null?void 0:i.type)!=="plague_4_player_flip_optional")return a;let c={...a,actionRequired:null};if(c=We(c,"Plague-4"),c=Ke(c,"end"),t){const{sourceCardId:d}=a.actionRequired;c=ne(c,l,`${l==="player"?"Player":"Opponent"} chooses to flip the card.`),c=ur(new Set([d]),c),c.animationState={type:"flipCard",cardId:d}}else c=ne(c,l,`${l==="player"?"Player":"Opponent"} skips flipping the card.`);return c=We(c,void 0),c=Ke(c,void 0),c=$o(c),c},sm=(a,t)=>{var h,y,g;if(((h=a.actionRequired)==null?void 0:h.type)!=="prompt_optional_discard_custom")return a;const{actor:l,count:c,sourceCardId:i}=a.actionRequired,d=l.charAt(0).toUpperCase()+l.slice(1);let f={...a};const p=(y=a.actionRequired)==null?void 0:y.followUpEffect,u=(g=a.actionRequired)==null?void 0:g.conditionalType;return t?(f=ne(f,l,`${d} chooses to discard ${c} card(s).`),f.actionRequired={type:"discard",actor:l,count:c,sourceCardId:i,followUpEffect:p,conditionalType:u,previousHandSize:f[l].hand.length}):(f=ne(f,l,`${d} skips the discard.`),f.actionRequired=null),f},Vd=(a,t)=>{var h,y,g,_,x,S,E;if(((h=a.actionRequired)==null?void 0:h.type)!=="prompt_optional_effect")return a;const{actor:l,sourceCardId:c,effectDef:i,laneIndex:d,savedTargetCardId:f}=a.actionRequired,p=l.charAt(0).toUpperCase()+l.slice(1);let u={...a};if(f&&(u.lastCustomEffectTargetCardId=f),t){const b=i.params.action;u=ne(u,l,`${p} chooses to execute the optional ${b} effect.`),u.actionRequired=null;const j=[...u.player.lanes.flat(),...u.opponent.lanes.flat()].find(O=>O.id===c);if(!j)return console.error("[Optional Effect] Source card not found!"),u;const C={cardOwner:l,opponent:l==="player"?"opponent":"player",currentTurn:u.turn,actor:l},R={...i,params:{...i.params,optional:!1},conditional:void 0},A=st(j,d,u,C,R),I=!!A.newState.actionRequired,U=!!A.newState._effectSkippedNoTargets;if(U&&!I){const O={...A.newState};return delete O._effectSkippedNoTargets,O.actionRequired=null,O}if(U&&I&&delete A.newState._effectSkippedNoTargets,i.conditional&&i.conditional.type==="if_executed"&&i.conditional.thenEffect){if(A.newState.actionRequired){const F=A.newState.actionRequired.sourceCardId;if(F&&F!==c){const T={type:"execute_conditional_followup",sourceCardId:c,laneIndex:d,followUpEffect:i.conditional.thenEffect,context:C,actor:l,logSource:a.actionRequired.logSource,logPhase:a.actionRequired.logPhase,logIndentLevel:a.actionRequired.logIndentLevel};return{...A.newState,queuedActions:[...A.newState.queuedActions||[],T]}}return{...A.newState,actionRequired:{...A.newState.actionRequired,followUpEffect:i.conditional.thenEffect,conditionalType:"if_executed"}}}const O=[...A.newState.player.lanes.flat(),...A.newState.opponent.lanes.flat()].find(F=>F.id===c);if(!O){let F={...A.newState};const D=a.actionRequired.logSource,T=a.actionRequired.logPhase,L=a.actionRequired.logIndentLevel;return D!==void 0&&(F._currentEffectSource=D),T!==void 0&&(F._currentPhaseContext=T),L!==void 0&&(F._logIndentLevel=L),F=ne(F,l,"Follow-up effect skipped (source no longer active)."),F}const k=i.conditional.thenEffect,q=st(O,d,A.newState,C,k);return q.newState.actionRequired&&k.conditional&&k.conditional.thenEffect?{...q.newState,actionRequired:{...q.newState.actionRequired,followUpEffect:k.conditional.thenEffect,conditionalType:k.conditional.type}}:q.newState}const Z=(y=a.actionRequired)==null?void 0:y.followUpEffect,ee=(g=a.actionRequired)==null?void 0:g.outerSourceCardId,z=(_=a.actionRequired)==null?void 0:_.outerLaneIndex;if(Z&&ee){let O=A.newState;if(O.actionRequired)return{...O,actionRequired:{...O.actionRequired,followUpEffect:Z,outerSourceCardId:ee,outerLaneIndex:z}};const k=[...O.player.lanes.flat(),...O.opponent.lanes.flat()].find(q=>q.id===ee);if(k){const q=O.player.lanes.flat().some(T=>T.id===ee)?"player":"opponent",F={cardOwner:q,opponent:q==="player"?"opponent":"player",currentTurn:O.turn,actor:q};return st(k,z||0,O,F,Z).newState}}return A.newState}else{const b=i.params.action;u=ne(u,l,`${p} skips the optional ${b} effect.`),u.actionRequired=null;const j=(x=a.actionRequired)==null?void 0:x.followUpEffect,C=(S=a.actionRequired)==null?void 0:S.outerSourceCardId,R=(E=a.actionRequired)==null?void 0:E.outerLaneIndex;if(j&&C){const A=[...u.player.lanes.flat(),...u.opponent.lanes.flat()].find(I=>I.id===C);if(A){let I=R;if(I===void 0){for(const ee of["player","opponent"])for(let z=0;z<u[ee].lanes.length;z++)if(u[ee].lanes[z].some(O=>O.id===C)){I=z;break}}const U=u.player.lanes.flat().some(ee=>ee.id===C)?"player":"opponent",$={cardOwner:U,opponent:U==="player"?"opponent":"player",currentTurn:u.turn,actor:U};return st(A,I||0,u,$,j).newState}}return u}},$d=(a,t,l)=>{var R;if(((R=a.actionRequired)==null?void 0:R.type)!=="prompt_rearrange_protocols")return a;const c=k0(a);if(!c.allowed)return console.error(`Protocol rearrangement blocked: ${c.reason}`),a;const{target:i,actor:d,originalAction:f,sourceCardId:p,disallowedProtocolForLane:u}=a.actionRequired;if(u){const{laneIndex:A,protocol:I}=u;if(t[A]===I)return console.error(`Illegal rearrange: ${I} cannot be placed on lane ${A} due to Anarchy-3 restriction`),a}let h={...a};const y={...h[i]},g={};y.protocols.forEach((A,I)=>{g[A]=y.compiled[I]});const _=t.map(A=>g[A]);y.protocols=t,y.compiled=_,h[i]=y,h.actionRequired=null;const x=h._pendingCustomEffects;if(x&&x.effects.length>0){const A={type:"execute_remaining_custom_effects",sourceCardId:x.sourceCardId,laneIndex:x.laneIndex,effects:x.effects,context:x.context,actor:d,logSource:x.logSource,logPhase:x.logPhase,logIndentLevel:x.logIndentLevel};h.queuedActions=[A,...h.queuedActions||[]],delete h._pendingCustomEffects}let S="Control Action";if(p!=="CONTROL_MECHANIC"){const A=[...h.player.lanes.flat(),...h.opponent.lanes.flat()].find(I=>I.id===p);A&&(S=`${A.protocol}-${A.value}`)}const E=d.charAt(0).toUpperCase()+d.slice(1),b=i===d?"their own":"the opponent's",j=t.join(" | ");h=ne(h,d,`${S}: ${E} rearranges ${b} protocols.`),h=ne(h,d,`New protocol order for ${i}: ${j}`);let C=Ee(h);if(f){if(C={...C,_logIndentLevel:0},f.type==="compile")return Zl(C,f.laneIndex,l);if(f.type==="fill_hand")return es(C,d);f.type==="continue_turn"?f.queuedSpeed2Actions&&f.queuedSpeed2Actions.length>0?(C=ne(C,d,"Processing remaining Speed-2 effects..."),C.queuedActions=[...f.queuedSpeed2Actions,...C.queuedActions||[]]):(C=ne(C,d,"Turn ends after compile."),C.phase="hand_limit"):f.type==="resume_interrupted_turn"&&(C=ne(C,d,"Resuming interrupted turn..."),C._interruptedTurn=f.interruptedTurn,C._interruptedPhase=f.interruptedPhase,f.queuedSpeed2Actions&&f.queuedSpeed2Actions.length>0&&(C.queuedActions=[...f.queuedSpeed2Actions,...C.queuedActions||[]]))}return C},cm=(a,t,l)=>{var C;if(((C=a.actionRequired)==null?void 0:C.type)!=="prompt_swap_protocols")return a;const{actor:c,target:i,originalAction:d,sourceCardId:f}=a.actionRequired,p={...a[i]},[u,h]=t.sort((R,A)=>R-A),y=[...p.protocols],g=[...p.compiled];[y[u],y[h]]=[y[h],y[u]],[g[u],g[h]]=[g[h],g[u]],p.protocols=y,p.compiled=g;let _={...a,[i]:p,actionRequired:null};const x=_._pendingCustomEffects;if(x&&x.effects.length>0){const R={type:"execute_remaining_custom_effects",sourceCardId:x.sourceCardId,laneIndex:x.laneIndex,effects:x.effects,context:x.context,actor:c,logSource:x.logSource,logPhase:x.logPhase,logIndentLevel:x.logIndentLevel};_.queuedActions=[R,..._.queuedActions||[]],delete _._pendingCustomEffects}const S=c.charAt(0).toUpperCase()+c.slice(1),E=i.charAt(0).toUpperCase()+i.slice(1);_=ne(_,c,`${f==="CONTROL_MECHANIC"?"Control":"Spirit-4"}: ${S} swaps ${E}'s protocols ${y[h]} and ${y[u]}.`),f==="CONTROL_MECHANIC"&&(_.controlCardHolder=null);let j=Ee(_);if(d){if(d.type==="compile")return j=ne(j,c,"Resuming Compile action..."),Zl(j,d.laneIndex,l);if(d.type==="fill_hand")return j=ne(j,c,"Resuming Refresh action..."),es(j,c)}return j},Bd=(a,t)=>{var _;if(((_=a.actionRequired)==null?void 0:_.type)!=="prompt_shift_or_flip_board_card_custom")return a;const{actor:l,sourceCardId:c,revealedCardId:i,followUpAction:d,optional:f}=a.actionRequired,p=l.charAt(0).toUpperCase()+l.slice(1),u=Se(a,i);if(!u)return a;if(d&&t!=="skip"&&t!==d)return console.error(`Invalid choice: ${t}, followUpAction restricts to: ${d}`),a;const h=u.owner,y=a[h].lanes.findIndex(x=>x.some(S=>S.id===i));if(y===-1)return a;let g={...a};switch(t){case"shift":{const x=[...g[h].lanes[y]],S=x.findIndex(E=>E.id===i);if(S!==-1){x[S]={...x[S],isFaceUp:!1};const E=[...g[h].lanes];E[y]=x,g={...g,[h]:{...g[h],lanes:E}}}g=ne(g,l,`${p} chooses to shift the revealed card (face-down).`),g.actionRequired={type:"select_lane_to_shift_revealed_board_card_custom",sourceCardId:c,revealedCardId:i,actor:l};break}case"flip":{g=ne(g,l,`${p} chooses to flip the revealed card face-up permanently.`);const x={...g,actionRequired:null};g=Od(x,i).newState;break}case"skip":{const x=[...g[h].lanes[y]],S=x.findIndex(E=>E.id===i);if(S!==-1){x[S]={...x[S],isFaceUp:!1};const E=[...g[h].lanes];E[y]=x,g={...g,[h]:{...g[h],lanes:E}}}g=ne(g,l,`${p} chooses to do nothing with the revealed card.`),g.actionRequired=null;break}}return g};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Id=(a,t)=>{if(!a.actionRequired)return a;const{actionRequired:l}=a,c=l.actor,i=c==="player"?"opponent":"player";switch(l.type){case"select_card_from_hand_to_give":{const d=a[c].hand.find(x=>x.id===t);if(!d)return a;let f={...a};const p={...f[c]},u={...f[i]};p.hand=p.hand.filter(x=>x.id!==t),u.hand=[...u.hand,d],f={...f,[c]:p,[i]:u};const h=c==="player"?"Player":"Opponent",y=`${d.protocol}-${d.value}`;f=ne(f,c,`${h} gives ${y} to the opponent.`),l.sourceEffect==="love_1_end"&&(f=ne(f,c,`Love-1: ${h} draws 2 cards.`),f=fr(f,c,2));const g=l.followUpEffect,_=l.conditionalType;if(g&&_==="if_executed"){const x=Se(f,l.sourceCardId);if(x){const{card:S,laneIndex:E}=x,b={cardOwner:c,actor:c,currentTurn:f.turn,opponent:i,triggerType:"play"};f=st(S,E,f,b,g).newState}}return f.actionRequired=null,f}case"select_card_from_hand_to_reveal":{const d=a[c].hand.find(_=>_.id===t);if(!d)return a;let f={...a};const p={...f[c]},u=p.hand.map(_=>_.id===t?{..._,isRevealed:!0}:_);p.hand=u,f={...f,[c]:p};const h=c==="player"?"Player":"Opponent",y=`${d.protocol}-${d.value}`;f=ne(f,c,`${h} reveals ${y} from their hand.`);const g=f._pendingCustomEffects;if(g&&g.effects.length>0){const _=Se(f,g.sourceCardId);if(_){const{card:x}=_,S=g.effects[0],E=g.effects.slice(1),b={cardOwner:c,actor:c,currentTurn:f.turn,opponent:i,triggerType:"play"};return f=st(x,g.laneIndex,f,b,S).newState,E.length>0?f._pendingCustomEffects={...g,effects:E}:delete f._pendingCustomEffects,f}}return f.actionRequired={type:"select_any_card_to_flip",count:1,sourceCardId:l.sourceCardId,actor:c},f}default:return a}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Yd=(a,t)=>{var x;if(((x=a.actionRequired)==null?void 0:x.type)!=="custom_choice")return a;const{options:l,sourceCardId:c,actor:i,laneIndex:d}=a.actionRequired;if(t<0||t>=l.length)return console.error(`[Choice Resolver] Invalid option index: ${t}`),a;const f=l[t],p=Se(a,c);if(!p){console.error(`[Choice Resolver] Source card ${c} not found`);let S={...a};return S.actionRequired=null,S}const u=i==="player"?"opponent":"player",h={cardOwner:i,actor:i,currentTurn:a.turn,opponent:u};let y={...a,actionRequired:null};const g=st(p.card,d,y,h,f);return Ee(g.newState)};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Control Mechanic Logic for AI
 *
 * CRITICAL: When evaluating rearrangements during a compile action,
 * the lane being compiled will have its value RESET TO 0 after the compile.
 * This must be considered when determining beneficial swaps!
 */function xc(a,t){const l=[...a];return t!==null&&t>=0&&t<3&&(l[t]=0),l}function Cw(a,t=null){const l=a.player,c=[],i=[];for(let f=0;f<3;f++)l.compiled[f]?c.push(f):i.push(f);if(c.length===0||i.length===0)return!1;const d=xc(l.laneValues,t);for(const f of c)for(const p of i)if(d[p]-d[f]>0)return!0;return!1}function im(a,t=null){const l=a.opponent,c=[],i=[];for(let f=0;f<3;f++)l.compiled[f]?c.push(f):i.push(f);if(c.length===0||i.length===0)return!1;const d=xc(l.laneValues,t);for(const f of c)for(const p of i){const h=10-d[f];if(h>=0&&h<=3){const g=10-d[p];if(h<g)return!0}}return!1}function Dm(a,t){if(!t||t.type!=="prompt_rearrange_protocols")return{type:"rearrangeProtocols",newOrder:[...a.opponent.protocols]};const l=t.target,c=t.disallowedProtocolForLane;let i=null;t.originalAction&&t.originalAction.type==="compile"&&(i=t.originalAction.laneIndex);const d=x=>{if(!c)return!0;const{laneIndex:S,protocol:E}=c;return x[S]!==E},f=a.opponent,p=a.player,u=xc(f.laneValues,i),h=xc(p.laneValues,i),y=f.compiled.filter(x=>x).length;if(p.compiled.filter(x=>x).length===2&&y===2){const x=p.compiled.findIndex(j=>!j),S=f.compiled.findIndex(j=>!j),E=h[x],b=u[S];if(E>b&&l==="player"){let j=-1,C=1/0;for(let R=0;R<3;R++)p.compiled[R]&&h[R]<C&&(C=h[R],j=R);if(j!==-1&&C<=E){const R=[...p.protocols];if([R[x],R[j]]=[R[j],R[x]],d(R))return{type:"rearrangeProtocols",newOrder:R}}return sr(p.protocols,d)}if(E<=b&&l==="opponent"){let j=-1,C=-1;for(let R=0;R<3;R++)f.compiled[R]&&u[R]>C&&(C=u[R],j=R);if(j!==-1&&C>b&&C>0){const R=[...f.protocols];if([R[S],R[j]]=[R[j],R[S]],d(R))return{type:"rearrangeProtocols",newOrder:R}}return sr(f.protocols,d)}}if(l==="player"){const x=[],S=[];for(let C=0;C<3;C++)p.compiled[C]?x.push(C):S.push(C);if(x.length===0||S.length===0){if(t.sourceCardId!=="CONTROL_MECHANIC")for(let R=0;R<3;R++)for(let A=R+1;A<3;A++){const I=[...p.protocols];if([I[R],I[A]]=[I[A],I[R]],d(I))return{type:"rearrangeProtocols",newOrder:I}}return sr(p.protocols,d)}let E=null;for(const C of S)if(h[C]>=10&&h[C]>u[C]){for(const A of x){E={compiledIdx:A,uncompiledIdx:C};break}if(E)break}if(E){const C=[...p.protocols];if([C[E.compiledIdx],C[E.uncompiledIdx]]=[C[E.uncompiledIdx],C[E.compiledIdx]],d(C))return{type:"rearrangeProtocols",newOrder:C}}let b=null;for(const C of x)for(const R of S){const A=h[R]-h[C];(!b||A>b.score)&&(b={compiledIdx:C,uncompiledIdx:R,score:A})}const j=t.sourceCardId!=="CONTROL_MECHANIC";if(b&&b.score>0){const C=[...p.protocols];if([C[b.compiledIdx],C[b.uncompiledIdx]]=[C[b.uncompiledIdx],C[b.compiledIdx]],d(C))return{type:"rearrangeProtocols",newOrder:C}}if(j)for(let C=0;C<3;C++)for(let R=C+1;R<3;R++){const A=[...p.protocols];if([A[C],A[R]]=[A[R],A[C]],d(A))return{type:"rearrangeProtocols",newOrder:A}}return sr(p.protocols,d)}if(l==="opponent"){const x=[],S=[];for(let j=0;j<3;j++)f.compiled[j]?x.push(j):S.push(j);if(x.length===0||S.length===0){if(t.sourceCardId!=="CONTROL_MECHANIC")for(let C=0;C<3;C++)for(let R=C+1;R<3;R++){const A=[...f.protocols];if([A[C],A[R]]=[A[R],A[C]],d(A))return{type:"rearrangeProtocols",newOrder:A}}return sr(f.protocols,d)}let E=null;for(const j of x)for(const C of S){const R=u[j],A=u[C],I=R-A,$=R>=10&&R>h[j]?I+100:I;(!E||$>E.score)&&(E={compiledIdx:j,uncompiledIdx:C,score:$,newUncompiledValue:R})}const b=t.sourceCardId!=="CONTROL_MECHANIC";if(E&&E.score>0){const j=[...f.protocols];if([j[E.compiledIdx],j[E.uncompiledIdx]]=[j[E.uncompiledIdx],j[E.compiledIdx]],d(j))return{type:"rearrangeProtocols",newOrder:j}}if(b)for(let j=0;j<3;j++)for(let C=j+1;C<3;C++){const R=[...f.protocols];if([R[j],R[C]]=[R[C],R[j]],d(R))return{type:"rearrangeProtocols",newOrder:R}}return sr(f.protocols,d)}const _=l==="player"?[...p.protocols]:[...f.protocols];return sr(_,d)}function sr(a,t){if(t(a))return{type:"rearrangeProtocols",newOrder:[...a]};for(let l=0;l<3;l++)for(let c=l+1;c<3;c++){const i=[...a];if([i[l],i[c]]=[i[c],i[l]],t(i))return{type:"rearrangeProtocols",newOrder:i}}return console.error("[AI Rearrange] Could not find any valid arrangement - returning current order"),{type:"rearrangeProtocols",newOrder:[...a]}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function Fm(a,t){return bn(a).some(({rule:c,cardOwner:i})=>c.type!=="require_face_down_play"?!1:c.target==="all"||c.target==="opponent"&&i!==t)}function ru(a){const t=a;return t.customEffects?[...t.customEffects.topEffects||[],...t.customEffects.middleEffects||[],...t.customEffects.bottomEffects||[]].some(c=>{var f,p;const i=c.trigger;return(i==="on_cover"||i==="on_cover_or_flip")&&((f=c.params)==null?void 0:f.action)==="delete"&&((p=c.params)==null?void 0:p.deleteSelf)===!0}):!1}function Sw(a,t,l){const c=a[t].lanes[l];if(c.length===0)return null;const i=c[c.length-1];return i.isFaceUp&&ru(i)?i.value:null}function qm(a){const t=a;return t.customEffects?[...t.customEffects.topEffects||[],...t.customEffects.middleEffects||[],...t.customEffects.bottomEffects||[]].some(c=>{var i;return c.params.action==="return"&&((i=c.params.targetFilter)==null?void 0:i.owner)==="own"}):!1}function $m(a){const t=a;return t.customEffects?[...t.customEffects.topEffects||[],...t.customEffects.middleEffects||[],...t.customEffects.bottomEffects||[]].some(c=>{var i,d,f;return c.params.action==="delete"&&((i=c.params.targetFilter)==null?void 0:i.owner)==="own"&&(((d=c.params.targetFilter)==null?void 0:d.valueFilter)==="highest"||((f=c.params.targetFilter)==null?void 0:f.calculation)==="highest_value")}):!1}function bw(a){const t=a;if(!t.customEffects)return 0;const l=t.customEffects.topEffects||[];for(const c of l)if(c.trigger==="passive"&&c.params.action==="value_modifier"&&(c.params.condition==="per_face_down_card"||c.params.applyTo==="face_down_cards"))return c.params.modifier||0;return 0}function Im(a,t){let l=0;for(const c of["player","opponent"])for(const i of a[c].lanes[t])if(i.isFaceUp){const d=bw(i);d>0&&(l=Math.max(l,d))}return l}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * EASY AI - Focused on winning, but only looks at own board
 * - Always tries to compile as fast as possible
 * - Prioritizes lanes closest to 10
 * - Doesn't consider opponent's strategy
 * - Makes simple decisions for effect choices
 *
 * FULLY GENERIC: Uses only targetFilter, scope, destinationRestriction from ActionRequired
 * NO card-specific handlers - all effects handled through parameters
 */function Ka(a,t,l,c,i,d){const f=[],p=l||{},u=p.position||"uncovered";for(const h of["player","opponent"])if(!(p.owner==="own"&&h!==t)&&!(p.owner==="opponent"&&h===t))for(let y=0;y<a[h].lanes.length;y++){if((c==null?void 0:c.type)==="this_lane"&&c.laneIndex!==void 0&&y!==c.laneIndex||(c==null?void 0:c.type)==="other_lanes"&&c.laneIndex!==void 0&&y===c.laneIndex||d!==void 0&&(c==null?void 0:c.type)==="this_lane"&&y!==d)continue;const g=a[h].lanes[y];for(let _=0;_<g.length;_++){const x=g[_];if(Io(a,x.id))continue;const S=Lo(a,g,_);if(!(u==="uncovered"&&!S)&&!(u==="covered"&&S)&&!(p.faceState==="face_up"&&!x.isFaceUp)&&!(p.faceState==="face_down"&&x.isFaceUp)){if(p.valueRange){const E=x.isFaceUp?x.value:2;if(E<p.valueRange.min||E>p.valueRange.max)continue}if(!(p.valueEquals!==void 0&&(x.isFaceUp?x.value:2)!==p.valueEquals)&&!(p.excludeSelf&&i&&x.id===i)){if(p.valueMinGreaterThanHandSize){const E=a[t].hand.length;if(x.value<=E)continue}f.push(x)}}}}return p.calculation==="highest_value"&&f.length>0?(f.sort((h,y)=>{const g=h.isFaceUp?h.value:2;return(y.isFaceUp?y.value:2)-g}),[f[0]]):p.calculation==="lowest_value"&&f.length>0?(f.sort((h,y)=>{const g=h.isFaceUp?h.value:2,_=y.isFaceUp?y.value:2;return g-_}),[f[0]]):f}function cr(a,t){return a.player.lanes.some(l=>l.some(c=>c.id===t))}function To(a,t,l){return a.isFaceUp?a.value:2+0}const Ew=a=>{const{opponent:t,player:l}=a;if(t.hand.length===0)return null;const c=(b,j,C)=>eo(a,"opponent",b,j,C).allowed,i=Fm(a,"opponent"),d=ts(a,"opponent"),f=Ec(a),p=(b,j)=>i||!c(j,!0,b.protocol)?!1:f?b.protocol!==t.protocols[j]&&b.protocol!==l.protocols[j]:b.protocol===t.protocols[j]||b.protocol===l.protocols[j]||d,u=(b,j,C)=>2+Im(a,C),h=t.hand.filter(b=>qm(b)?t.lanes.flat().some(R=>R.protocol!==b.protocol):!0);if(h.length===0)return null;const y=b=>{if(ru(b)){for(let j=0;j<3;j++)if(!t.compiled[j]&&t.laneValues[j]+b.value>=10)return!1;return!0}if($m(b)){let j=0;for(let C=0;C<3;C++){const R=t.lanes[C];if(R.length>0){const A=R[R.length-1],I=A.isFaceUp?A.value:2;I>j&&(j=I)}}return b.value>=j}return!1},g=[],x=l.lanes.flat().length+t.lanes.flat().length<=3,S=l.lanes.flat().length>0,E=(b,j)=>b.keywords.flip||b.keywords.delete||b.keywords.shift||b.keywords.return?S||t.lanes.some((A,I)=>I!==j&&A.length>0)||t.lanes[j].length>0:!0;for(const b of h)for(let j=0;j<3;j++){if(t.compiled[j])continue;const C=t.laneValues[j],R=l.laneValues[j];if(p(b,j)&&!y(b)){const A=C+b.value;let I=0;A>=10&&A>R?I=1e3+A:A<10?I=100+A+b.value*5:I=50+b.value,x&&b.value<=2&&(E(b,j)?I-=50:I-=200),b.keywords.draw&&t.hand.length>=5&&(I-=30),g.push({cardId:b.id,laneIndex:j,isFaceUp:!0,score:I})}if(c(j,!1,b.protocol)){const A=u(b,!1,j),I=C+A;let U=0;I>=10&&I>R?U=900+I:I<10?U=80+I:U=30+A,g.push({cardId:b.id,laneIndex:j,isFaceUp:!1,score:U})}}if(g.length===0)return null;g.sort((b,j)=>j.score-b.score);for(const b of g){if(b.isFaceUp){const j=t.hand.find(R=>R.id===b.cardId);if(!j||!eo(a,"opponent",b.laneIndex,!0,j.protocol).allowed)continue}return{cardId:b.cardId,laneIndex:b.laneIndex,isFaceUp:b.isFaceUp}}return null},jw=(a,t)=>{var l,c,i,d,f,p;switch(t.type){case"prompt_use_control_mechanic":{const{player:u}=a,h=u.compiled.some(g=>g),y=u.compiled.filter(g=>!g).length;return h&&y>0?{type:"resolveControlMechanicPrompt",choice:"player"}:{type:"resolveControlMechanicPrompt",choice:"skip"}}case"discard":{const u=[...a.opponent.hand].sort((g,_)=>g.value-_.value),h=t.variableCount?Math.min(3,u.length):t.count;return{type:"discardCards",cardIds:u.slice(0,h).map(g=>g.id)}}case"select_cards_to_delete":{const u=t.currentLaneIndex??t.laneIndex,h=t.allowedIds;let y=Ka(a,t.actor,t.targetFilter,t.scope,t.sourceCardId,u);h&&(y=y.filter(E=>h.includes(E.id)));const g=t.disallowedIds||[],_=y.filter(E=>!g.includes(E.id));if(_.length===0)return{type:"skip"};const x=_.filter(E=>cr(a,E.id)),S=_.filter(E=>!cr(a,E.id));return x.length>0?(x.sort((E,b)=>To(b)-To(E)),{type:"deleteCard",cardId:x[0].id}):S.length>0?(S.sort((E,b)=>To(E)-To(b)),{type:"deleteCard",cardId:S[0].id}):{type:"deleteCard",cardId:_[0].id}}case"select_card_to_flip":case"select_any_card_to_flip":case"select_any_card_to_flip_optional":{const u=ka(a),h=t.restrictedLaneIndex??t.currentLaneIndex??t.laneIndex,y=Ka(a,t.actor,t.targetFilter,t.scope,t.sourceCardId,h);if(y.length===0)return t.optional?{type:"skip"}:{type:"skip"};const g=y.filter(S=>cr(a,S.id)),_=y.filter(S=>!cr(a,S.id)),x=g.filter(S=>S.isFaceUp).sort((S,E)=>E.value-S.value);if(x.length>0)return{type:"flipCard",cardId:x[0].id};if(!u){const S=g.filter(E=>!E.isFaceUp);if(S.length>0)return{type:"flipCard",cardId:S[0].id}}if(!u){const S=_.filter(E=>!E.isFaceUp);if(S.length>0)return{type:"flipCard",cardId:S[0].id}}if(!t.optional){const S=_.filter(E=>E.isFaceUp).sort((E,b)=>E.value-b.value);if(S.length>0)return{type:"flipCard",cardId:S[0].id}}return{type:"skip"}}case"select_card_to_shift":{const u=t.scope,h=u==="this_lane"?t.sourceLaneIndex??t.currentLaneIndex??t.laneIndex:void 0,y=Ka(a,t.actor,t.targetFilter,u,t.sourceCardId,h);if(y.length===0)return t.optional?{type:"skip"}:{type:"skip"};const g=y.filter(_=>cr(a,_.id));return g.length>0?{type:"shiftCard",cardId:g[0].id}:{type:"shiftCard",cardId:y[0].id}}case"select_card_to_return":{const u=t.currentLaneIndex??t.laneIndex,h=Ka(a,t.actor,t.targetFilter,t.scope,t.sourceCardId,u);if(h.length===0)return t.optional?{type:"skip"}:{type:"skip"};const y=h.filter(_=>cr(a,_.id));if(y.length>0)return y.sort((_,x)=>To(x)-To(_)),{type:"returnCard",cardId:y[0].id};const g=h.filter(_=>!cr(a,_.id));return g.length>0?(g.sort((_,x)=>To(_)-To(x)),{type:"returnCard",cardId:g[0].id}):{type:"returnCard",cardId:h[0].id}}case"select_lane_for_shift":{let u=t.validLanes||[0,1,2];if(u=u.filter(h=>h!==t.originalLaneIndex),t.destinationRestriction){const h=t.destinationRestriction,y=t.originalLaneIndex;if(h.type==="to_this_lane"&&h.laneIndex!==void 0)u=u.filter(g=>g===h.laneIndex);else if(h.type==="to_another_lane")u=u.filter(g=>g!==y);else if(h.type==="to_or_from_this_lane"&&h.laneIndex!==void 0){const g=typeof h.laneIndex=="number"?h.laneIndex:y;y!==g&&(u=[g])}else if(h.type==="non_matching_protocol"){const g=Se(a,t.cardToShiftId);g&&(u=u.filter(_=>{const x=a.player.protocols[_],S=a.opponent.protocols[_];return g.card.protocol!==x&&g.card.protocol!==S}))}}return u.length>0?{type:"selectLane",laneIndex:u[0]}:{type:"selectLane",laneIndex:0}}case"select_lane_for_shift_all":{let u=t.validLanes||[0,1,2];return u=u.filter(h=>h!==t.sourceLaneIndex),u.length>0?{type:"selectLane",laneIndex:u[0]}:{type:"selectLane",laneIndex:0}}case"select_lane_for_delete":{let u=t.validLanes||[0,1,2];u=u.filter(y=>!(t.excludeSourceLane&&y===t.laneIndex));const h=u.map(y=>{let g=0,_=0;const x=t.deleteFilter;for(const S of a.player.lanes[y])x!=null&&x.valueRange&&S.isFaceUp?S.value>=x.valueRange.min&&S.value<=x.valueRange.max&&(g+=1):x!=null&&x.valueRange||(g+=1);for(const S of a.opponent.lanes[y])x!=null&&x.valueRange&&S.isFaceUp?S.value>=x.valueRange.min&&S.value<=x.valueRange.max&&(_+=2):x!=null&&x.valueRange||(_+=2);return{laneIndex:y,score:g-_}});return h.sort((y,g)=>g.score-y.score),{type:"selectLane",laneIndex:((l=h[0])==null?void 0:l.laneIndex)??0}}case"select_lane_for_delete_all":return t.validLanes.length>0?{type:"selectLane",laneIndex:t.validLanes[0]}:{type:"selectLane",laneIndex:0};case"select_lanes_for_swap_stacks":{const u=t.validLanes;return u.length>0?{type:"selectLane",laneIndex:u[Math.floor(Math.random()*u.length)]}:{type:"skip"}}case"select_card_for_copy_middle":{const u=t.validTargetIds||[];return u.length>0?{type:"selectCard",cardId:u[Math.floor(Math.random()*u.length)]}:{type:"skip"}}case"select_lane_for_play":{let u=t.validLanes||[0,1,2];return t.disallowedLaneIndex!==void 0&&(u=u.filter(h=>h!==t.disallowedLaneIndex)),u=u.filter(h=>eo(a,"opponent",h,!t.isFaceDown,"").allowed),u.length>0?{type:"selectLane",laneIndex:((c=u.filter(y=>!a.opponent.compiled[y]).map(y=>({lane:y,value:a.opponent.laneValues[y]})).sort((y,g)=>g.value-y.value)[0])==null?void 0:c.lane)??u[0]}:{type:"skip"}}case"select_lane_for_return":{const h=[0,1,2].map(y=>{const g=t.returnFilter;let _=0,x=0;for(const S of a.player.lanes[y]){const E=S.isFaceUp?S.value:2;(g==null?void 0:g.valueEquals)!==void 0&&E!==g.valueEquals||(_+=E)}for(const S of a.opponent.lanes[y]){const E=S.isFaceUp?S.value:2;(g==null?void 0:g.valueEquals)!==void 0&&E!==g.valueEquals||(x+=E)}return{laneIndex:y,score:_-x,hasTargets:_>0||x>0}}).filter(y=>y.hasTargets);return h.sort((y,g)=>g.score-y.score),{type:"selectLane",laneIndex:((i=h[0])==null?void 0:i.laneIndex)??0}}case"prompt_optional_effect":return((f=(d=t.effectDef)==null?void 0:d.params)==null?void 0:f.action)==="give"?{type:"resolveOptionalEffectPrompt",accept:!1}:{type:"resolveOptionalEffectPrompt",accept:!0};case"prompt_optional_discard_custom":return{type:"resolveOptionalDiscardCustomPrompt",accept:!1};case"prompt_optional_shuffle_trash":return{type:"resolvePrompt",accept:(t.trashCount||0)>0};case"select_card_from_revealed_deck":{const u=t.selectableCardIds||[];return u.length>0?{type:"selectRevealedDeckCard",cardId:u[0]}:{type:"resolvePrompt",accept:!1}}case"custom_choice":return{type:"resolveCustomChoice",optionIndex:0};case"flip_self":return t.sourceCardId?{type:"flipCard",cardId:t.sourceCardId}:{type:"skip"};case"prompt_rearrange_protocols":return Dm(a,t);case"prompt_swap_protocols":return{type:"resolveSwapProtocols",indices:[0,1]};case"select_card_from_hand_to_play":{const u=t.selectableCardIds,h=u?a.opponent.hand.filter(y=>u.includes(y.id)):a.opponent.hand;if(h.length>0){const y=h[0];let g=t.validLanes||[0,1,2].filter(_=>_!==t.disallowedLaneIndex);if(g=g.filter(_=>eo(a,"opponent",_,!t.isFaceDown,y.protocol).allowed),g.length>0){const _=g.filter(x=>!a.opponent.compiled[x]).map(x=>({lane:x,value:a.opponent.laneValues[x]})).sort((x,S)=>S.value-x.value);return{type:"playCard",cardId:y.id,laneIndex:((p=_[0])==null?void 0:p.lane)??g[0],isFaceUp:!1}}}return{type:"skip"}}case"select_card_from_hand_to_give":return a.opponent.hand.length>0?{type:"giveCard",cardId:[...a.opponent.hand].sort((h,y)=>h.value-y.value)[0].id}:{type:"skip"};case"select_card_from_hand_to_reveal":return a.opponent.hand.length>0?{type:"revealCard",cardId:a.opponent.hand[0].id}:{type:"skip"};case"reveal_opponent_hand":return{type:"skip"};case"select_board_card_to_reveal":{const u=Ka(a,t.actor,t.targetFilter||{faceState:"face_down",position:"uncovered"},void 0,t.sourceCardId);return u.length>0?{type:"revealCard",cardId:u[0].id}:{type:"skip"}}case"prompt_shift_or_flip_revealed_card":{const u=Se(a,t.revealedCardId);return u?u.owner==="player"?{type:"resolvePrompt",accept:!0}:{type:"resolvePrompt",accept:!1}:{type:"resolvePrompt",accept:!1}}case"select_lane_to_shift_revealed_card":{const u=Se(a,t.revealedCardId);if(!u)return{type:"selectLane",laneIndex:0};let h=-1;for(let g=0;g<a[u.owner].lanes.length;g++)if(a[u.owner].lanes[g].some(_=>_.id===t.revealedCardId)){h=g;break}const y=[0,1,2].filter(g=>g!==h);return y.length>0?{type:"selectLane",laneIndex:y[0]}:{type:"selectLane",laneIndex:0}}case"shift_flipped_card_optional":{const u=t.cardId,h=Se(a,u);if(!h)return{type:"skip"};let y=h.laneIndex??-1;if(y===-1){for(let _=0;_<a[h.owner].lanes.length;_++)if(a[h.owner].lanes[_].some(x=>x.id===u)){y=_;break}}const g=[0,1,2].filter(_=>_!==y);return g.length===0?{type:"skip"}:{type:"selectLane",laneIndex:g[0]}}case"select_phase_effect":{const u=t;return u.availableEffects.length===0?{type:"skip"}:{type:"flipCard",cardId:u.availableEffects[0].cardId}}case"state_number":return{type:"stateNumber",number:Math.floor(Math.random()*6)};case"state_protocol":{const h=t.availableProtocols||[];if(h.length===0)return{type:"skip"};const y=Math.floor(Math.random()*h.length);return{type:"stateProtocol",protocol:h[y]}}case"select_from_drawn_to_reveal":{const h=t.eligibleCardIds||[];if(h.length===0)return{type:"skip"};const y=Math.floor(Math.random()*h.length);return{type:"selectFromDrawnToReveal",cardId:h[y]}}case"confirm_deck_discard":return{type:"confirmDeckDiscard"};case"confirm_deck_play_preview":return{type:"confirmDeckPlayPreview"};case"discard_completed":return{type:"skip"};case"prompt_optional_draw":return{type:"resolveOptionalEffectPrompt",accept:!0};case"select_board_card_to_reveal_custom":{const u=Ka(a,t.actor,t.targetFilter||{faceState:"face_down",position:"uncovered"},void 0,t.sourceCardId);return u.length>0?{type:"revealCard",cardId:u[0].id}:{type:"skip"}}case"prompt_shift_or_flip_board_card_custom":return{type:"resolvePrompt",accept:!0};case"select_lane_to_shift_revealed_board_card_custom":{const u=Se(a,t.revealedCardId);if(!u)return{type:"selectLane",laneIndex:0};let h=-1;for(let g=0;g<a[u.owner].lanes.length;g++)if(a[u.owner].lanes[g].some(_=>_.id===t.revealedCardId)){h=g;break}return{type:"selectLane",laneIndex:[0,1,2].filter(g=>g!==h)[0]??0}}case"select_card_from_other_lanes_to_delete":{const u=t.disallowedLaneIndex,h=Ka(a,t.actor,{position:"uncovered"},void 0,t.sourceCardId).filter(y=>{for(let g=0;g<a[y.owner].lanes.length;g++)if(a[y.owner].lanes[g].some(_=>_.id===y.id))return g!==u;return!0});if(h.length>0){const y=h.filter(_=>_.owner==="player");return{type:"deleteCard",cardId:(y.length>0?y[0]:h[0]).id}}return{type:"skip"}}case"select_opponent_card_to_flip":{const u=Ka(a,t.actor,{owner:"opponent",position:"uncovered"},void 0,t.sourceCardId);return u.length>0?{type:"flipCard",cardId:u[0].id}:{type:"skip"}}case"select_opponent_card_to_return":{const u=Ka(a,t.actor,{owner:"opponent",position:"uncovered"},void 0,t.sourceCardId);return u.length>0?{type:"returnCard",cardId:u.sort((y,g)=>g.value-y.value)[0].id}:{type:"skip"}}case"delete_self":return t.sourceCardId?{type:"deleteCard",cardId:t.sourceCardId}:{type:"skip"};case"select_card_from_trash_to_play":{const u=a.opponent.discard;return u.length===0?{type:"skip"}:{type:"selectTrashCard",cardIndex:[...u].map((y,g)=>({card:y,index:g})).sort((y,g)=>g.card.value-y.card.value)[0].index}}case"select_card_from_trash_to_reveal":return a.opponent.discard.length===0?{type:"skip"}:{type:"selectTrashCard",cardIndex:0}}return{type:"skip"}},kw=(a,t)=>{if(t)return jw(a,t);if(a.phase==="compile"&&a.compilableLanes.length>0)return{type:"compile",laneIndex:a.compilableLanes[0]};if(a.phase==="action"){const l=Ew(a);if(l)return{type:"playCard",...l};if(a.opponent.hand.length<=1)return{type:"fillHand"};for(const c of a.opponent.hand)for(let i=0;i<3;i++){if(a.opponent.compiled[i])continue;if(eo(a,"opponent",i,!1,c.protocol).allowed)return{type:"playCard",cardId:c.id,laneIndex:i,isFaceUp:!1}}return{type:"fillHand"}}return{type:"fillHand"}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * NORMAL AI - Plays like a human player
 * - Makes good strategic decisions
 * - No memory of revealed cards
 * - 20% chance to make suboptimal moves for realism
 * - Balanced between Easy and Hard
 */const nl=["delete","flip","shift","return","discard"],ln=a=>{let t=12-a.value;return nl.some(l=>a.keywords[l])&&(t+=6),a.keywords.draw&&(t+=3),a.keywords.play&&(t+=8),a.keywords.prevent&&(t+=4),t},Gr=(a,t,l)=>{let c;for(const d of l[t].lanes)if(d.some(f=>f.id===a.id)){c=d;break}if(!c)return 0;if(!a.isFaceUp)return c.some(f=>f.isFaceUp&&f.protocol==="Darkness"&&f.value===2)?4:2;let i=a.value*2.5;return a.top.length>0&&(i+=6),(a.bottom.includes("Start:")||a.bottom.includes("End:"))&&(i+=8),a.bottom.includes("covered:")&&(i+=5),nl.some(d=>a.keywords[d])&&(i+=4),i},Qr=()=>Math.random()<.2,dm=a=>a+(Math.random()*10-5),Wr=(a,t,l,c)=>{const i=l.position||"uncovered";return!(i==="uncovered"&&!t||i==="covered"&&t||l.faceState==="face_up"&&!a.isFaceUp||l.faceState==="face_down"&&a.isFaceUp||l.excludeSelf&&c&&a.id===c||l.valueRange&&(!a.isFaceUp||a.value<l.valueRange.min||a.value>l.valueRange.max)||l.valueEquals!==void 0&&(!a.isFaceUp||a.value!==l.valueEquals))},Rw=a=>{const t=[],l=Fm(a,"opponent"),c=a.player.lanes.flat().length+a.opponent.lanes.flat().length,i=c<=3,d=c>3&&c<=8,p=a.player.lanes.flat().length>0,u=a.player.compiled.filter(Boolean).length,h=a.controlCardHolder==="opponent";a.controlCardHolder;let y=0;for(let C=0;C<3;C++)a.opponent.laneValues[C]>a.player.laneValues[C]?y++:a.player.laneValues[C]>a.opponent.laneValues[C];const _=a.useControlMechanic===!0&&u>=1&&!h;for(let C=0;C<3&&!(!a.player.compiled[C]&&a.player.laneValues[C]>=10&&a.player.laneValues[C]>a.opponent.laneValues[C]);C++);const x=a.opponent.compiled.filter(Boolean).length;let S=-1;if(x<3&&!_){const C=[];for(let R=0;R<3;R++){if(a.opponent.compiled[R])continue;const A=a.opponent.protocols[R],I=a.player.protocols[R],U=a.opponent.laneValues[R],$=a.player.laneValues[R],Z=a.opponent.hand.filter(k=>k.protocol===A||k.protocol===I);if($>=10&&!a.player.compiled[R]){const k=Math.max(...Z.map(T=>T.value),0),F=Math.max(k,2);if(U+F<=$)continue}let ee=0,z=`Lane ${R} (${A}): value=${U}`;ee+=U*15,U>=8?(ee+=100,z+=` [ALMOST COMPILE: ${U}]`):U>=6?(ee+=60,z+=` [Near compile: ${U}]`):U>=4&&(ee+=30,z+=` [Building: ${U}]`),ee+=Z.length*10,Z.length>0&&(z+=` [${Z.length} cards]`);const O=Z.filter(k=>k.value>=4);ee+=O.length*20,$>U&&(ee-=($-U)*5),Z.length===0&&(ee-=30,z+=" [No matching cards - face-down only]"),C.push({laneIndex:R,score:ee,reason:z})}C.sort((R,A)=>A.score-R.score),C.length>0&&(S=C[0].laneIndex)}const E=(C,R)=>C.keywords.flip||C.keywords.delete||C.keywords.shift||C.keywords.return?a.player.lanes.flat().length>0||a.opponent.lanes.some((U,$)=>$!==R&&U.length>0)||a.opponent.lanes[R].length>0:!0,b=C=>C.keywords.draw?a.opponent.hand.length>=5:!1;for(const C of a.opponent.hand)for(let R=0;R<3;R++){const A=eo(a,"opponent",R,!0,C.protocol),I=eo(a,"opponent",R,!1,C.protocol);if(!A.allowed&&!I.allowed||a.opponent.compiled[R])continue;const U=a.player.laneValues[R]>=10&&a.player.laneValues[R]>a.opponent.laneValues[R]&&!a.player.compiled[R];if(U){const k=Math.max(A.allowed?C.value:0,I.allowed?ma({...C,isFaceUp:!1},a.opponent.lanes[R]):0);if(a.opponent.laneValues[R]+k<a.player.laneValues[R]&&!nl.some(F=>C.keywords[F]))continue}let $=!1;if(qm(C)){let k=0;for(let q=0;q<3;q++)if(a.opponent.lanes[q].length>0){if(q===R)continue;k++}k===0&&($=!0)}if(ru(C)){const k=a.opponent.laneValues[R],q=Math.max(0,10-C.value);if(k<q)continue;const F=k+C.value,D=a.player.laneValues[R];if(F<=D)continue}const Z=Sw(a,"opponent",R);if(Z!==null){const k=a.opponent.laneValues[R],q=k+C.value-Z,F=q>=10&&q>a.player.laneValues[R],D=k-Z>=4;if(!F&&!D)continue}const ee=U;let z=!1;if($m(C)){let k=0;for(let q=0;q<3;q++){const F=a.opponent.lanes[q];if(F.length>0&&q!==R){const D=F[F.length-1],T=D.isFaceUp?D.value:2;T>k&&(k=T)}}C.value>=k&&(z=!0)}if(A.allowed&&!l&&!z&&!$){let k=0,q=`Play ${C.protocol}-${C.value} face-up in lane ${R}`;const F=C.value,D=a.opponent.laneValues[R]+F;if(ee)D>a.player.laneValues[R]?(k=180+D*5,q+=" [Blocks compile!]"):(k=-150,q+=" [Fails to block]");else{if(k+=F*10,D>=10&&D>a.player.laneValues[R]&&!a.opponent.compiled[R])k+=200,q+=` [COMPILE: ${D}]`;else if(D>=8&&D<10&&!a.opponent.compiled[R]){const L=a.opponent.lanes[R].some(G=>G.isFaceUp&&G.protocol==="Darkness"&&G.value===2)?4:2;a.opponent.laneValues[R]+L>=10&&D<10?(k-=50,q+=` [Near ${D} but face-down could compile!]`):(k+=40,q+=` [Near compile: ${D}]`)}i&&F<=2&&(k-=50,q+=" [Low value early game penalty]"),E(C,R)||(k-=80,q+=" [No valid targets for effect]"),b(C)&&(k-=30,q+=" [Draw would cause discard]");const T=nl.some(L=>C.keywords[L]);if(T&&p?d&&a.player.laneValues[R]>=5?(k+=35,q+=" [Disruption with targets]"):a.player.laneValues[R]>=8&&(k+=50,q+=" [Disruption near compile]"):T&&!p&&(k-=40,q+=" [Disruption but no targets]"),S!==-1&&!_&&(R===S?(k+=150,q+=" [FOCUS LANE]"):(k-=100,q+=" [Not focus lane]")),_){const L=a.opponent.laneValues[R]>a.player.laneValues[R],B=D>a.player.laneValues[R],G=a.opponent.laneValues[R]===a.player.laneValues[R];if(L)k-=200,q+=" [ALREADY LEADING - DON'T WASTE!]";else if(!L&&B)y===1?(k+=500,q+=" [CONTROL CAPTURE! 1->2 leads]"):y===0?(k+=300,q+=" [First lead! 0->1 leads]"):(k+=100,q+=" [Extra lead]");else if(G&&B)y===1?(k+=450,q+=" [BREAK TIE FOR CONTROL!]"):(k+=250,q+=" [Break tie]");else if(!L&&!B&&y===1){const ae=a.player.laneValues[R]-D;ae<=3?(k+=200,q+=` [BUILD toward 2nd lead, gap=${ae}]`):ae<=6?(k+=150,q+=` [BUILD toward 2nd lead, gap=${ae}]`):(k+=100,q+=` [BUILD toward 2nd lead, gap=${ae}]`)}}}t.push({move:{type:"playCard",cardId:C.id,laneIndex:R,isFaceUp:!0},score:dm(k),reason:q})}if(I.allowed){const k=ma({...C,isFaceUp:!1},a.opponent.lanes[R]),q=a.opponent.laneValues[R]+k,F=a.opponent.laneValues[R];let D=-100,T=`Play ${C.protocol}-${C.value} face-down in lane ${R}`;if(ee?q>=a.player.laneValues[R]?(D=150,T+=` [Blocks compile: ${q} vs ${a.player.laneValues[R]}]`):(D=-200,T+=" [Fails to block]"):!a.opponent.compiled[R]&&q>=10&&q>a.player.laneValues[R]?(D=300,T+=` [COMPILE: Face-down finishes at ${F} -> ${q} beats player ${a.player.laneValues[R]}]`):!a.opponent.compiled[R]&&a.player.laneValues[R]>=10&&q>=a.player.laneValues[R]?(D=250,T+=` [BLOCK COMPILE: Face-down reaches ${q} vs player ${a.player.laneValues[R]}]`):!a.opponent.compiled[R]&&a.player.laneValues[R]>=10&&q<a.player.laneValues[R]?(D=-200,T+=` [WASTED: ${q} vs player ${a.player.laneValues[R]} - player still compiles!]`):S===R&&!a.opponent.compiled[R]&&F>=4?(D=50+F*10,T+=` [BUILD FOCUS: ${F} -> ${q}]`):!A.allowed&&C.value<=1?(D=-20,T+=" [No face-up option, low value]"):(D=-120,T+=" [Avoid: Face-up is better]"),S!==-1&&D<50&&!_&&(R===S?(D+=50,T+=" [Focus lane]"):(D-=80,T+=" [Not focus lane]")),_){const L=a.opponent.laneValues[R]>a.player.laneValues[R],B=q>a.player.laneValues[R],G=a.opponent.laneValues[R]===a.player.laneValues[R];if(L)D-=200,T+=" [FD ALREADY LEADING - DON'T WASTE!]";else if(!L&&B)y===1?(D+=400,T+=" [FD CONTROL CAPTURE! 1->2 leads]"):y===0&&(D+=250,T+=" [FD First lead!]");else if(G&&B)y===1?(D+=350,T+=" [FD BREAK TIE FOR CONTROL!]"):(D+=200,T+=" [FD Break tie]");else if(!L&&!B&&y===1){const ae=a.player.laneValues[R]-q;ae<=3?(D+=150,T+=` [FD BUILD toward 2nd lead, gap=${ae}]`):ae<=6&&(D+=100,T+=` [FD BUILD toward 2nd lead, gap=${ae}]`)}}t.push({move:{type:"playCard",cardId:C.id,laneIndex:R,isFaceUp:!1},score:dm(D),reason:T})}}if(a.opponent.hand.length===0)t.push({move:{type:"fillHand"},score:500,reason:"Must refill - no cards"});else{const C=a.player.laneValues.some((I,U)=>I>=10&&I>a.opponent.laneValues[U]&&!a.player.compiled[U]),R=a.controlCardHolder==="opponent",A=a.player.compiled.some(I=>I);C&&R&&A&&t.push({move:{type:"fillHand"},score:200,reason:"Emergency draw to block compile with control swap"})}if(t.length===0)return{type:"fillHand"};t.sort((C,R)=>R.score-C.score);const j=C=>{if(C.type==="playCard"&&C.isFaceUp){const R=a.opponent.hand.find(I=>I.id===C.cardId);if(!R)return!1;const A=eo(a,"opponent",C.laneIndex,!0,R.protocol);if(!A.allowed)return console.warn(`[AI Safety] Rejecting invalid face-up play: ${R.protocol}-${R.value} in lane ${C.laneIndex} - ${A.reason}`),!1}return!0};if(Qr()&&t.length>1&&t[1].score>0&&j(t[1].move))return t[1].move;for(const C of t)if(j(C.move))return C.move;return console.warn("[AI Safety] No valid moves found, falling back to fillHand"),{type:"fillHand"}},Nw=(a,t)=>{var l,c;switch(t.type){case"prompt_use_control_mechanic":{const i=a.player.compiled.filter(u=>u).length,d=a.compilableLanes.length>0?a.compilableLanes[0]:null;let f=-1;for(let u=0;u<3;u++)if(!a.player.compiled[u]&&a.player.laneValues[u]>=10&&a.player.laneValues[u]>a.opponent.laneValues[u]){f=u;break}const p=a.player.compiled.map((u,h)=>u?h:-1).filter(u=>u!==-1);return f!==-1&&p.length>0?{type:"resolveControlMechanicPrompt",choice:"player"}:i===0?im(a,d)&&!Qr()?{type:"resolveControlMechanicPrompt",choice:"opponent"}:{type:"resolveControlMechanicPrompt",choice:"skip"}:Cw(a,d)?{type:"resolveControlMechanicPrompt",choice:"player"}:im(a,d)&&!Qr()?{type:"resolveControlMechanicPrompt",choice:"opponent"}:{type:"resolveControlMechanicPrompt",choice:"skip"}}case"discard":return{type:"discardCards",cardIds:[...a.opponent.hand].sort((d,f)=>{const p=nl.some(h=>d.keywords[h]),u=nl.some(h=>f.keywords[h]);return p&&!u?1:!p&&u?-1:ln(d)-ln(f)}).slice(0,t.count).map(d=>d.id)};case"discard_completed":return{type:"skip"};case"select_opponent_card_to_flip":{const d=(p=>a[p].lanes.map(u=>u.length>0?u[u.length-1]:null).filter(u=>u!==null))("player");if(d.length===0)return{type:"skip"};const f=d.map(p=>({cardId:p.id,score:p.isFaceUp?p.value+5:3}));return f.sort((p,u)=>u.score-p.score),{type:"flipCard",cardId:f[0].cardId}}case"select_cards_to_delete":{const i=t.disallowedIds||[],d=t.allowedIds,f=t.targetFilter??{},p="actorChooses"in t?t.actorChooses:"effect_owner",u=t.sourceCardId;if(p==="card_owner"&&(f==null?void 0:f.owner)==="opponent"){const g=[];return a.opponent.lanes.forEach(_=>{if(_.length>0){const x=_[_.length-1];if(Wr(x,!0,f,u)){if(d&&!d.includes(x.id))return;g.push(x)}}}),g.length>0?(g.sort((_,x)=>_.value-x.value),{type:"deleteCard",cardId:g[0].id}):{type:"skip"}}const h=g=>a[g].lanes.map(_=>_.length>0?_[_.length-1]:null).filter(_=>_!==null).filter(_=>Wr(_,!0,f,u)).filter(_=>!d||d.includes(_.id)),y=f==null?void 0:f.owner;if(y==="own"){const g=h("opponent").filter(_=>!i.includes(_.id));if(g.length>0)return{type:"deleteCard",cardId:g.sort((x,S)=>x.value-S.value)[0].id}}else if(y==="opponent"){const g=h("player").filter(_=>!i.includes(_.id));if(g.length>0){const _=g.map(x=>{const S=a.player.lanes.findIndex(j=>j.some(C=>C.id===x.id)),E=a.player.laneValues[S],b=E>=10&&E>a.opponent.laneValues[S];return{cardId:x.id,score:Gr(x,"player",a)+E+(b?50:0)}});return _.sort((x,S)=>S.score-x.score),{type:"deleteCard",cardId:_[0].cardId}}}else{const g=h("player").filter(x=>!i.includes(x.id));if(g.length>0){const x=g.map(S=>{const E=a.player.lanes.findIndex(C=>C.some(R=>R.id===S.id)),b=a.player.laneValues[E],j=b>=10&&b>a.opponent.laneValues[E];return{cardId:S.id,score:Gr(S,"player",a)+b+(j?50:0)}});return x.sort((S,E)=>E.score-S.score),{type:"deleteCard",cardId:x[0].cardId}}const _=h("opponent").filter(x=>!i.includes(x.id));if(_.length>0)return{type:"deleteCard",cardId:_.sort((S,E)=>S.value-E.value)[0].id}}return{type:"skip"}}case"select_any_card_to_flip":case"select_any_other_card_to_flip":case"select_any_face_down_card_to_flip_optional":case"select_any_card_to_flip_optional":{const i=ka(a),d=t.targetFilter,f=t.sourceCardId,p=t.actor,u=t.currentLaneIndex??t.laneIndex,h=t.scope,y=[];for(const _ of["player","opponent"])if(!(d&&(d.owner==="own"&&_!==p||d.owner==="opponent"&&_===p)))for(let x=0;x<a[_].lanes.length;x++){if(u!==void 0&&x!==u||h==="this_lane"&&u!==void 0&&x!==u)continue;const S=a[_].lanes[x];if(S.length!==0)for(let E=0;E<S.length;E++){const b=S[E],j=E===S.length-1;if(d){if(!Wr(b,j,d,f))continue}else if(!j)continue;i&&!b.isFaceUp||y.push({card:b,owner:_})}}if(y.length===0)return{type:"skip"};const g=y.map(({card:_,owner:x})=>{let S=0,E=-1;for(let I=0;I<a[x].lanes.length;I++)if(a[x].lanes[I].some(U=>U.id===_.id)){E=I;break}const b=E>=0?a[x].laneValues[E]:0,j=E>=0?a[x].compiled[E]:!1,C=_.isFaceUp?_.value:2,A=(_.isFaceUp?2:_.value)-C;return x==="player"?_.isFaceUp?(S=-A*15,S+=Gr(_,"player",a)):_.value<=1?S=20:S=-30:_.isFaceUp?A>0?(S=A*20+50,!j&&b+A>=10&&(S+=200)):S=A*15-30:A>0?(S=A*20+40,!j&&b+A>=10&&(S+=200)):S=-10,{cardId:_.id,score:S}});return g.sort((_,x)=>x.score-_.score),{type:"flipCard",cardId:g[0].cardId}}case"plague_2_opponent_discard":return a.opponent.hand.length===0?{type:"skip"}:{type:"discardCards",cardIds:[[...a.opponent.hand].sort((d,f)=>ln(d)-ln(f))[0].id]};case"select_card_from_hand_to_play":{if(a.opponent.hand.length===0)return{type:"skip"};const i=t.faceDown===!0,d=t.selectableCardIds,f=d?a.opponent.hand.filter(y=>d.includes(y.id)):a.opponent.hand;if(f.length===0)return{type:"skip"};let p=t.validLanes||[0,1,2].filter(y=>y!==t.disallowedLaneIndex);if(p=p.filter(y=>{const g=a.player.lanes[y],_=g.length>0?g[g.length-1]:null;return!(_&&_.isFaceUp&&_.protocol==="Plague"&&_.value===0)}),p.length===0)return{type:"skip"};const u=[];for(const y of f)for(const g of p){if(!i){const S=a.opponent.lanes.flat().some(C=>C.isFaceUp&&C.protocol==="Spirit"&&C.value===1),E=a.opponent.lanes.some(C=>{if(C.length===0)return!1;const R=C[C.length-1];return R.isFaceUp&&R.protocol==="Chaos"&&R.value===3}),b=[...a.player.lanes.flat(),...a.opponent.lanes.flat()].some(C=>C.isFaceUp&&C.protocol==="Anarchy"&&C.value===1);let j;if(b?j=y.protocol!==a.opponent.protocols[g]&&y.protocol!==a.player.protocols[g]:j=y.protocol===a.opponent.protocols[g]||y.protocol===a.player.protocols[g]||S||E,j){const C=y.value,R=a.opponent.laneValues[g]+C;let A=ln(y)+C*2;R>=10&&R>a.player.laneValues[g]&&(A+=100);const I=a.player.laneValues[g],U=a.player.compiled[g],$=a.opponent.compiled[g],Z=a.opponent.laneValues[g];!U&&!$&&I>=10&&I>Z&&R>=I&&(A+=160),u.push({cardId:y.id,laneIndex:g,isFaceUp:!0,score:A})}}if(!a.player.lanes[g].some(S=>S.isFaceUp&&S.protocol==="Metal"&&S.value===2)){const S=ma({...y,isFaceUp:!1},a.opponent.lanes[g]),E=a.opponent.laneValues[g]+S;let b=S*2;E>=10&&E>a.player.laneValues[g]&&(b+=80);const j=a.player.laneValues[g],C=a.player.compiled[g],R=a.opponent.compiled[g],A=a.opponent.laneValues[g];!C&&!R&&j>=10&&j>A&&E>=j&&(b+=150),u.push({cardId:y.id,laneIndex:g,isFaceUp:!1,score:b})}}if(u.length===0)return{type:"skip"};u.sort((y,g)=>g.score-y.score);const h=u[0];return{type:"playCard",cardId:h.cardId,laneIndex:h.laneIndex,isFaceUp:h.isFaceUp}}case"select_card_from_hand_to_give":return a.opponent.hand.length===0?{type:"skip"}:{type:"giveCard",cardId:[...a.opponent.hand].sort((d,f)=>ln(d)-ln(f))[0].id};case"select_card_from_hand_to_reveal":return a.opponent.hand.length===0?{type:"skip"}:{type:"revealCard",cardId:[...a.opponent.hand].sort((d,f)=>ln(f)-ln(d))[0].id};case"select_card_to_return":case"select_opponent_card_to_return":{const d={position:"uncovered",...t.targetFilter||{}},f=t.targetOwner||d.owner,p=t.sourceCardId,u=t.actor,h=[];for(const _ of["player","opponent"])if(!(f==="own"&&_!==u)&&!(f==="opponent"&&_===u))for(const x of a[_].lanes)for(let S=0;S<x.length;S++){const E=x[S],b=S===x.length-1;Wr(E,b,d,p)&&h.push({card:E,owner:_})}if(h.length===0)return{type:"skip"};const y=h.filter(_=>_.owner==="player"),g=h.filter(_=>_.owner==="opponent");return y.length>0?(y.sort((_,x)=>Gr(x.card,"player",a)-Gr(_.card,"player",a)),{type:"returnCard",cardId:y[0].card.id}):g.length>0?(g.sort((_,x)=>_.card.value-x.card.value),{type:"returnCard",cardId:g[0].card.id}):{type:"returnCard",cardId:h[0].card.id}}case"select_lane_for_play":{let i=t.validLanes||[0,1,2];if(i=i.filter(p=>!("disallowedLaneIndex"in t)||p!==t.disallowedLaneIndex),i=i.filter(p=>{const u=a.player.lanes[p],h=u.length>0?u[u.length-1]:null,y=h&&h.isFaceUp&&h.protocol==="Plague"&&h.value===0,g="isFaceDown"in t&&t.isFaceDown&&u.some(_=>_.isFaceUp&&_.protocol==="Metal"&&_.value===2);return!y&&!g}),i.length===0)return{type:"skip"};const d=i.filter(p=>{const u=a.player.laneValues[p],h=a.opponent.laneValues[p],y=a.player.compiled[p],g=a.opponent.compiled[p],_=!y&&u>=10&&u>h,x=h+2>=u;return _&&x&&!g});if(d.length>0)return d.sort((p,u)=>a.player.laneValues[u]-a.player.laneValues[p]),{type:"selectLane",laneIndex:d[0]};const f=i.map(p=>{const u=a.opponent.laneValues[p]-a.player.laneValues[p];return{laneIndex:p,score:-u}});return f.sort((p,u)=>u.score-p.score),{type:"selectLane",laneIndex:f[0].laneIndex}}case"prompt_rearrange_protocols":return Dm(a,t);case"prompt_swap_protocols":{const{target:i}=t,d=a[i].protocols,f=a[i].hand,p=a[i].compiled,u=a[i].laneValues,h=[[0,1],[0,2],[1,2]];let y=[0,1],g=-1/0;for(const _ of h){const[x,S]=_,E=[...d];[E[x],E[S]]=[E[S],E[x]];let b=0;const j=p[x],C=p[S],R=u[x],A=u[S];if(i==="opponent"){j&&!C?A<R&&(b+=30):C&&!j&&R<A&&(b+=30);for(const I of f){const U=I.protocol===d[x],$=I.protocol===d[S],Z=I.protocol===E[x],ee=I.protocol===E[S],z=j?.5:1.5,O=C?.5:1.5;Z&&!U&&(b+=ln(I)*z),ee&&!$&&(b+=ln(I)*O),!Z&&U&&(b-=ln(I)*z),!ee&&$&&(b-=ln(I)*O)}}else{j&&!C?R>A&&(b+=25):C&&!j&&A>R&&(b+=25);for(const I of f){const U=I.protocol===d[x],$=I.protocol===d[S],Z=I.protocol===E[x],ee=I.protocol===E[S],z=j?.5:1.5,O=C?.5:1.5;Z&&!U&&(b-=ln(I)*z),ee&&!$&&(b-=ln(I)*O),!Z&&U&&(b+=ln(I)*z),!ee&&$&&(b+=ln(I)*O)}}b>g&&(g=b,y=_)}return{type:"resolveSwapProtocols",indices:y}}case"select_lane_for_shift":{let i=t.validLanes||[0,1,2];if(i=i.filter(d=>!("disallowedLaneIndex"in t)||d!==t.disallowedLaneIndex).filter(d=>!("originalLaneIndex"in t)||d!==t.originalLaneIndex),"sourceCardId"in t){const d=[...a.player.lanes.flat(),...a.opponent.lanes.flat()].find(f=>f.id===t.sourceCardId);if(d&&d.protocol==="Gravity"&&d.value===1){let f=null;for(let p=0;p<3;p++)if([...a.player.lanes[p],...a.opponent.lanes[p]].some(h=>h.id===t.sourceCardId)){f=p;break}f!==null&&"originalLaneIndex"in t&&(t.originalLaneIndex===f||(i=[f]))}if(d&&d.protocol==="Anarchy"&&d.value===1){const f="cardToShiftId"in t?t.cardToShiftId:null;if(f){const p=[...a.player.lanes.flat(),...a.opponent.lanes.flat()].find(u=>u.id===f);p&&(i=i.filter(u=>{const h=a.player.protocols[u],y=a.opponent.protocols[u],g=p.protocol;return g!==h&&g!==y}))}}}if(i.length>0){const d="cardToShiftId"in t?t.cardToShiftId:null;let f=null,p=0;if(d)for(const h of["player","opponent"]){for(const y of a[h].lanes){const g=y.find(_=>_.id===d);if(g){f=h,p=g.isFaceUp?g.value:2;break}}if(f)break}const u=i.map(h=>{let y=0;const g=a.player.laneValues[h],_=a.opponent.laneValues[h],x=a.player.compiled[h],S=a.opponent.compiled[h];return f==="player"?x?y+=100:_>g?y+=50:g>=6&&g<10&&!x&&(y-=50):f==="opponent"&&(!S&&_<10?_+p>=10?y+=100:_>=6?y+=60:y+=30:S&&(y-=50)),{laneIdx:h,score:y}});if(u.sort((h,y)=>y.score-h.score),Qr()&&u.length>1){const h=Math.floor(Math.random()*u.length);return{type:"selectLane",laneIndex:u[h].laneIdx}}return{type:"selectLane",laneIndex:u[0].laneIdx}}return{type:"selectLane",laneIndex:0}}case"select_lane_for_delete_all":{const i="validLanes"in t?t.validLanes:[0,1,2];return i.length>0?{type:"selectLane",laneIndex:i[Math.floor(Math.random()*i.length)]}:{type:"skip"}}case"select_lanes_for_swap_stacks":{const i=t.validLanes,d=t.selectedFirstLane;if(i.length===0)return{type:"skip"};if(d===void 0){const f=i.map(p=>{const u=a.opponent.laneValues[p];return{laneIdx:p,score:u}});return f.sort((p,u)=>p.score-u.score),{type:"selectLane",laneIndex:f[0].laneIdx}}else{const f=i.map(p=>{const u=a.opponent.laneValues[p];return{laneIdx:p,score:u}});return f.sort((p,u)=>u.score-p.score),{type:"selectLane",laneIndex:f[0].laneIdx}}}case"select_card_for_copy_middle":{const i=t.validTargetIds||[];if(i.length===0)return{type:"skip"};const d=i.map(f=>{var u,h;let p=0;for(const y of["player","opponent"])for(const g of a[y].lanes){const _=g.find(x=>x.id===f);if(_){const S=((u=_.customEffects)==null?void 0:u.middleEffects)||[];for(const E of S){const b=(h=E.params)==null?void 0:h.action;b==="draw"&&(p+=5),b==="flip"&&(p+=3),b==="delete"&&(p+=4),b==="shift"&&(p+=2),b==="discard"&&(p-=2)}}}return{cardId:f,score:p}});return d.sort((f,p)=>p.score-f.score),{type:"selectCard",cardId:d[0].cardId}}case"select_lane_for_return":{const i=t.targetFilter||{},d=t.actor,f=i.valueEquals,p=i.valueRange,u=[];for(let h=0;h<3;h++){let y=0,g=0;const _=Im(a,h);for(const E of["player","opponent"]){if(i.owner==="own"&&E!==d||i.owner==="opponent"&&E===d)continue;const b=a[E].lanes[h];for(let j=0;j<b.length;j++){const C=b[j],R=j===b.length-1;if(i.position==="uncovered"&&!R||i.position==="covered"&&R)continue;const A=C.isFaceUp?C.value:2+_;f!==void 0&&A!==f||p&&(A<p.min||A>p.max)||(E==="player"?y+=A:g+=A)}}const x=y-g,S=`Lane ${h}: Player loses ${y}, we lose ${g}, net=${x}`;u.push({laneIndex:h,score:x,reason:S})}u.sort((h,y)=>y.score-h.score);for(const h of u);return u.length>0?{type:"selectLane",laneIndex:u[0].laneIndex}:{type:"selectLane",laneIndex:0}}case"prompt_optional_effect":{const{effectDef:i}=t,d=(l=i==null?void 0:i.params)==null?void 0:l.action,f=(c=i==null?void 0:i.params)==null?void 0:c.targetFilter;if(d==="give")return{type:"resolveOptionalEffectPrompt",accept:!1};if(d==="flip"){let p=!1;const u=(f==null?void 0:f.position)||"uncovered";for(const h of["player","opponent"])if(!((f==null?void 0:f.owner)==="own"&&h!=="opponent")&&!((f==null?void 0:f.owner)==="opponent"&&h==="opponent")){for(let y=0;y<a[h].lanes.length;y++){const g=a[h].lanes[y];if(g.length!==0){for(let _=0;_<g.length;_++){const x=g[_],S=_===g.length-1,E=!S;if(u==="uncovered"&&!S||u==="covered"&&!E||(f==null?void 0:f.faceState)==="face_up"&&!x.isFaceUp||(f==null?void 0:f.faceState)==="face_down"&&x.isFaceUp)continue;const b=x.isFaceUp?x.value:2,j=x.isFaceUp?2:x.value;if(h==="player"){if(x.isFaceUp&&b>j){p=!0;break}}else{const C=a.opponent.laneValues[y],R=j-b;if(x.isFaceUp&&R>0){p=!0;break}if(!x.isFaceUp&&x.value>2){p=!0;break}if(R>0&&C+R>=10&&!a.opponent.compiled[y]){p=!0;break}}}if(p)break}}if(p)break}return{type:"resolveOptionalEffectPrompt",accept:p}}return{type:"resolveOptionalEffectPrompt",accept:!Qr()}}case"select_card_from_other_lanes_to_delete":{const{disallowedLaneIndex:i,lanesSelected:d}=t,f=[];for(let p=0;p<3;p++){if(p===i||d.includes(p))continue;const u=a.player.lanes[p];if(u.length>0){f.push(u[u.length-1]);continue}const h=a.opponent.lanes[p];h.length>0&&f.push(h[h.length-1])}return f.length>0?{type:"deleteCard",cardId:f[0].id}:{type:"skip"}}case"select_face_down_card_to_delete":{const i="disallowedIds"in t&&Array.isArray(t.disallowedIds)?t.disallowedIds:[],d=u=>a[u].lanes.map(h=>h.length>0?h[h.length-1]:null).filter(h=>h!==null),f=d("player").filter(u=>!i.includes(u.id));if(f.length>0)return{type:"deleteCard",cardId:f[0].id};const p=d("opponent").filter(u=>!i.includes(u.id));return p.length>0?{type:"deleteCard",cardId:p[0].id}:{type:"skip"}}case"select_low_value_card_to_delete":{const i=[];for(const f of["player","opponent"])for(const p of a[f].lanes)p.length>0&&i.push(p[p.length-1]);const d=i.filter(f=>f.isFaceUp&&(f.value===0||f.value===1));return d.length>0?{type:"deleteCard",cardId:d[0].id}:{type:"skip"}}case"select_opponent_face_up_card_to_flip":{const d=(f=>a[f].lanes.map(p=>p.length>0?p[p.length-1]:null).filter(p=>p!==null))("player").filter(f=>f.isFaceUp);return d.length>0?(d.sort((f,p)=>p.value-f.value),{type:"flipCard",cardId:d[0].id}):{type:"skip"}}case"select_covered_card_in_line_to_flip_optional":{const i="optional"in t&&t.optional,f=!["select_any_other_card_to_flip","select_any_other_card_to_flip_for_water_0"].includes(t.type);if(t.type==="select_covered_card_in_line_to_flip_optional"){const{laneIndex:_}=t,x=a.opponent.lanes[_],S=a.player.lanes[_],E=x.filter((U,$,Z)=>$<Z.length-1),b=S.filter((U,$,Z)=>$<Z.length-1),j=a.opponent.laneValues[_];if(!a.opponent.compiled[_]){let U=null,$=null;for(const Z of E){let ee,z;Z.isFaceUp?(ee=Z.value,z=2):(ee=ma(Z,x,a,_,"opponent"),z=Z.value);const O=z-ee,k=j+O;O>0&&k>=10&&(!U||k>U.newValue)&&(U={card:Z,newValue:k,gain:O}),O>0&&(!$||O>$.gain)&&($={card:Z,gain:O,newValue:k})}if(U)return{type:"flipCard",cardId:U.card.id};if($&&$.gain>0)return{type:"flipCard",cardId:$.card.id}}if(a.opponent.compiled[_]){let U=null;for(const $ of E){const Z=$.isFaceUp?$.value:ma($,x,a,_,"opponent"),z=($.isFaceUp?2:$.value)-Z;z>0&&(!U||z>U.gain)&&(U={card:$,gain:z})}if(U)return{type:"flipCard",cardId:U.card.id}}const R=b.filter(U=>U.isFaceUp);if(R.length>0)return R.sort((U,$)=>$.value-U.value),{type:"flipCard",cardId:R[0].id};const A=E.filter(U=>!U.isFaceUp).map(U=>({card:U,gain:U.value-ma(U,x,a,_,"opponent")})).filter(U=>U.gain>0).sort((U,$)=>$.gain-U.gain);if(A.length>0)return{type:"flipCard",cardId:A[0].card.id};const I=b.filter(U=>!U.isFaceUp);return I.length>0?{type:"flipCard",cardId:I[0].id}:{type:"skip"}}const p=_=>a[_].lanes.map(x=>x.length>0?x[x.length-1]:null).filter(x=>x!==null),u=p("player"),h=p("opponent");{const _=u.filter(x=>x.isFaceUp).sort((x,S)=>S.value-x.value);if(_.length>0)return{type:"flipCard",cardId:_[0].id}}const y=h.filter(_=>!_.isFaceUp);if(y.length>0)return{type:"flipCard",cardId:y[0].id};const g=u.filter(_=>!_.isFaceUp);if(g.length>0)return{type:"flipCard",cardId:g[0].id};{const _=h.filter(S=>!(!S.isFaceUp||!f&&S.id===t.sourceCardId)),x=_.filter(S=>{const E=a.opponent.lanes.findIndex(b=>b.length>0&&b[b.length-1].id===S.id);return E!==-1&&a.opponent.compiled[E]});if(x.length>0&&!i)return{type:"flipCard",cardId:x[0].id};if(_.length>0&&!i)return{type:"flipCard",cardId:_[0].id}}return{type:"skip"}}case"shift_flipped_card_optional":{const i=t.cardId,d=t.optional,f=Se(a,i);if(!f)return{type:"skip"};const p=f.card,u=f.owner,h=p.isFaceUp?p.value:2;let y=f.laneIndex??-1;if(y===-1){const I=a[u];for(let U=0;U<I.lanes.length;U++)if(I.lanes[U].some($=>$.id===i)){y=U;break}}if(y===-1)return{type:"skip"};const g=[0,1,2].filter(I=>I!==y);if(g.length===0)return{type:"skip"};const _=a.opponent,x=a.player,S=_.laneValues[y],E=_.compiled[y],b=x.laneValues[y],j=S-h;let C=-1,R=-1/0;const A=0;for(const I of g){const U=_.laneValues[I],$=_.compiled[I],Z=x.laneValues[I],ee=U+h;let z=0;!E&&S>=8&&S>b&&(z-=100),!$&&ee>=10&&ee>Z&&(z+=80),!$&&U<S&&(E||S<6)&&(z+=20),$&&(z-=30),!$&&U<=Z&&ee>Z&&(z+=25),!E&&S>b&&j<=b&&(z-=40),z>R&&(R=z,C=I)}return d&&R<A?{type:"skip"}:C!==-1?{type:"selectLane",laneIndex:C}:d?{type:"skip"}:{type:"selectLane",laneIndex:g[0]}}case"select_lane_to_shift_revealed_card_for_light_2":case"select_lane_to_shift_revealed_card":{const i=t.revealedCardId,d=Se(a,i);if(!d)return{type:"selectLane",laneIndex:0};let f=-1;for(let u=0;u<a[d.owner].lanes.length;u++)if(a[d.owner].lanes[u].some(h=>h.id===i)){f=u;break}const p=[0,1,2].filter(u=>u!==f);return p.length>0?(d.owner==="opponent"?p.sort((u,h)=>{const y=a.opponent.laneValues[u],g=a.opponent.laneValues[h];return!a.opponent.compiled[u]&&a.opponent.compiled[h]?-1:a.opponent.compiled[u]&&!a.opponent.compiled[h]?1:g-y}):p.sort((u,h)=>a.player.laneValues[u]-a.player.laneValues[h]),{type:"selectLane",laneIndex:p[0]}):{type:"selectLane",laneIndex:0}}case"select_opponent_face_down_card_to_shift":{const i=[];for(const d of a.player.lanes)if(d.length>0){const f=d[d.length-1];f.isFaceUp||i.push(f)}return i.length>0?{type:"deleteCard",cardId:i[Math.floor(Math.random()*i.length)].id}:{type:"skip"}}case"select_opponent_covered_card_to_shift":{const i=[];for(const d of a.player.lanes)for(let f=0;f<d.length-1;f++)i.push(d[f]);return i.length>0?{type:"deleteCard",cardId:i[Math.floor(Math.random()*i.length)].id}:{type:"skip"}}case"select_own_covered_card_to_shift":{const i=[];for(const d of a.opponent.lanes)for(let f=0;f<d.length-1;f++)i.push(d[f]);return i.length>0?{type:"deleteCard",cardId:i[Math.floor(Math.random()*i.length)].id}:{type:"skip"}}case"select_card_to_flip":{const i=t.targetFilter||{},d=t.restrictedLaneIndex??t.currentLaneIndex??t.laneIndex,f=t.scope,p=t.actor,u=t.sourceCardId,h=[];for(const g of["player","opponent"])if(!(i.owner==="own"&&g!==p)&&!(i.owner==="opponent"&&g===p))for(let _=0;_<a[g].lanes.length;_++){if(d!==void 0&&_!==d||f==="this_lane"&&d!==void 0&&_!==d)continue;const x=a[g].lanes[_];for(let S=0;S<x.length;S++){const E=x[S];if(Io(a,E.id))continue;const b=Lo(a,x,S);if(Wr(E,b,i,u)&&!(i.position==="covered_in_this_line"&&b)){if(i.valueMinGreaterThanHandSize){const j=a[p].hand.length;if(E.value<=j)continue}h.push({card:E,owner:g,laneIndex:_})}}}if(h.length===0)return{type:"skip"};const y=h.map(({card:g,owner:_,laneIndex:x})=>{let S=0;const E=a[_].laneValues[x],b=a[_].compiled[x],j=g.isFaceUp?g.value:2,R=(g.isFaceUp?2:g.value)-j;return _==="player"?g.isFaceUp?(S=-R*15,S+=Gr(g,"player",a)):g.value<=1?S=20:S=-30:g.isFaceUp?R>0?(S=R*20+50,!b&&E+R>=10&&(S+=200)):S=R*15-30:R>0?(S=R*20+40,!b&&E+R>=10&&(S+=200)):S=-10,{card:g,score:S}});if(y.sort((g,_)=>_.score-g.score),Qr()&&y.length>1){const g=Math.floor(Math.random()*y.length);return{type:"flipCard",cardId:y[g].card.id}}return{type:"flipCard",cardId:y[0].card.id}}case"select_card_to_shift":{const i=t.targetFilter||{},f=t.scope==="this_lane"?t.sourceLaneIndex??t.currentLaneIndex??t.laneIndex:void 0,p=t.actor,u=t.sourceCardId,h=[];for(const y of["player","opponent"])if(!(i.owner==="own"&&y!==p)&&!(i.owner==="opponent"&&y===p))for(let g=0;g<a[y].lanes.length;g++){if(f!==void 0&&g!==f)continue;const _=a[y].lanes[g];for(let x=0;x<_.length;x++){const S=_[x],E=x===_.length-1;Wr(S,E,i,u)&&h.push(S)}}return h.length>0?{type:"shiftCard",cardId:h[Math.floor(Math.random()*h.length)].id}:{type:"skip"}}case"select_board_card_to_reveal_custom":{const i=[];for(const d of["player","opponent"])for(const f of a[d].lanes)if(f.length>0){const p=f[f.length-1];p.isFaceUp||i.push({card:p,owner:d})}if(i.length>0){const d=i.filter(f=>f.owner==="player");return d.length>0?{type:"deleteCard",cardId:d[0].card.id}:{type:"deleteCard",cardId:i[0].card.id}}return{type:"skip"}}case"prompt_shift_or_flip_board_card_custom":{const{revealedCardId:i}=t,d=Se(a,i);return d?d.owner==="opponent"?{type:"resolveRevealBoardCardPrompt",choice:"flip"}:{type:"resolveRevealBoardCardPrompt",choice:"shift"}:{type:"resolveRevealBoardCardPrompt",choice:"skip"}}case"select_lane_to_shift_revealed_board_card_custom":{const i=[0,1,2];return i.sort((d,f)=>a.player.laneValues[d]-a.player.laneValues[f]),{type:"selectLane",laneIndex:i[0]}}case"gravity_2_shift_after_flip":{const{targetLaneIndex:i}=t;return{type:"selectLane",laneIndex:i}}case"flip_self":case"flip_self_for_water_0":case"flip_self_for_psychic_4":case"speed_3_self_flip_after_shift":return t.sourceCardId?{type:"flipCard",cardId:t.sourceCardId}:{type:"skip"};case"anarchy_0_conditional_draw":return{type:"skip"};case"select_any_opponent_card_to_shift":{const i=a.player.lanes.map(d=>d.length>0?d[d.length-1]:null).filter(d=>d!==null);return i.length>0?{type:"deleteCard",cardId:i[Math.floor(Math.random()*i.length)].id}:{type:"skip"}}case"select_own_other_card_to_shift":{const i=a.opponent.lanes.flat().find(d=>d.id!==t.sourceCardId);return i?{type:"deleteCard",cardId:i.id}:{type:"skip"}}case"select_own_face_up_covered_card_to_flip":return{type:"skip"};case"plague_4_opponent_delete":{const i=[];return a.opponent.lanes.forEach(d=>{if(d.length>0){const f=d[d.length-1];f.isFaceUp||i.push(f)}}),i.length>0?(i.sort((d,f)=>d.value-f.value),{type:"deleteCard",cardId:i[0].id}):{type:"skip"}}case"reveal_opponent_hand":case"plague_2_player_discard":case"delete_self":return{type:"skip"};case"select_card_from_trash_to_play":{const i=a.opponent.discard;return i.length===0?{type:"skip"}:{type:"selectTrashCard",cardIndex:[...i].map((f,p)=>{var h,y,g;let u=f.value*10;for(let _=0;_<3;_++){if(a.opponent.compiled[_])continue;const x=a.opponent.laneValues[_]+f.value;x>=10&&x>a.player.laneValues[_]&&(u+=100)}return(h=f.keywords)!=null&&h.flip&&(u+=5),(y=f.keywords)!=null&&y.draw&&(u+=3),(g=f.keywords)!=null&&g.delete&&(u+=5),{card:f,index:p,score:u}}).sort((f,p)=>p.score-f.score)[0].index}}case"select_card_from_trash_to_reveal":{const i=a.opponent.discard;return i.length===0?{type:"skip"}:{type:"selectTrashCard",cardIndex:[...i].map((f,p)=>({card:f,index:p,value:f.value})).sort((f,p)=>p.value-f.value)[0].index}}case"select_lane_for_delete":{const i=t.validLanes||[0,1,2],d=t.valueFilter,f=i.map(p=>{let u=0,h=0;for(const y of a.player.lanes[p]){const g=y.isFaceUp?y.value:2;d?y.isFaceUp?y.value>=d.min&&y.value<=d.max&&(u+=g+1):u+=(g+1)*.5:u+=g+1}for(const y of a.opponent.lanes[p]){const g=y.isFaceUp?y.value:2;d?y.isFaceUp?y.value>=d.min&&y.value<=d.max&&(h+=g+3):h+=(g+3)*.5:h+=g+3}return{laneIndex:p,score:u-h}});return f.sort((p,u)=>u.score-p.score),f[0].score>0?{type:"selectLane",laneIndex:f[0].laneIndex}:{type:"selectLane",laneIndex:f[0].laneIndex}}case"select_lane_for_shift_all":{const i=t.validDestinationLanes||t.validLanes||[0,1,2],d=t.sourceLaneIndex,f=i.filter(p=>p!==d);if(f.length>0){const p=f.map(u=>{let h=0;return h+=a.opponent.lanes[u].length*2,h+=a.opponent.laneValues[u],a.player.laneValues[u]>=8&&(h-=5),{laneIndex:u,score:h}});return p.sort((u,h)=>h.score-u.score),{type:"selectLane",laneIndex:p[0].laneIndex}}return i.length>0?{type:"selectLane",laneIndex:i[0]}:{type:"selectLane",laneIndex:0}}case"prompt_optional_draw":return{type:"resolveOptionalEffectPrompt",accept:!0};case"prompt_optional_discard_custom":return{type:"resolveOptionalEffectPrompt",accept:a.opponent.hand.length>4};case"prompt_optional_shuffle_trash":return{type:"resolvePrompt",accept:(t.trashCount||0)>0};case"select_card_from_revealed_deck":{const i=t.selectableCardIds||[];if(i.length>0){const d=Math.floor(Math.random()*i.length);return{type:"selectRevealedDeckCard",cardId:i[d]}}return{type:"resolvePrompt",accept:!1}}case"custom_choice":{const{options:i}=t;if(!i||i.length!==2)return{type:"resolveCustomChoice",optionIndex:0};const d=u=>{var g,_,x;let h=0;const y=((g=u.action)==null?void 0:g.toLowerCase())||"";return y.includes("draw")&&(h+=30),y.includes("discard")&&(h-=20),y.includes("delete")&&((_=u.targetFilter)==null?void 0:_.owner)==="opponent"&&(h+=40),y.includes("delete")&&((x=u.targetFilter)==null?void 0:x.owner)==="own"&&(h-=30),h},f=d(i[0]),p=d(i[1]);return{type:"resolveCustomChoice",optionIndex:f>=p?0:1}}case"select_phase_effect":{const i=t;if(i.availableEffects.length===0)return{type:"skip"};const d=i.availableEffects.map(p=>{let u=0;const h=p.effectDescription.toLowerCase();return h.includes("draw")?u+=100:h.includes("delete")?u+=80:h.includes("shift")?u+=60:h.includes("flip")?u+=40:u+=20,Math.random()<.2&&(u=Math.random()*50),{effect:p,score:u}});return d.sort((p,u)=>u.score-p.score),{type:"flipCard",cardId:d[0].effect.cardId}}case"state_number":{const i={0:0,1:0,2:0,3:0,4:0,5:0};a.opponent.hand.forEach(p=>{p.value>=0&&p.value<=5&&i[p.value]++}),i[2]+=2,i[3]+=2;let d=0,f=i[0];for(let p=1;p<=5;p++)i[p]>f&&(f=i[p],d=p);return Math.random()<.2&&(d=Math.floor(Math.random()*6)),{type:"stateNumber",number:d}}case"state_protocol":{const d=t.availableProtocols||[];if(d.length===0)return{type:"skip"};const f=a.player.protocols,p=d.map(u=>{let h=0;return f.includes(u)&&(h+=50),h+=Math.random()*20,{protocol:u,score:h}});return p.sort((u,h)=>h.score-u.score),{type:"stateProtocol",protocol:p[0].protocol}}case"select_from_drawn_to_reveal":{const d=t.eligibleCardIds||[];if(d.length===0)return{type:"skip"};const f=a.opponent.hand,p=d.map(u=>{const h=f.find(g=>g.id===u);if(!h)return{cardId:u,score:0};let y=h.value;return a.opponent.protocols.includes(h.protocol)&&(y+=10),{cardId:u,score:y}});return p.sort((u,h)=>h.score-u.score),{type:"selectFromDrawnToReveal",cardId:p[0].cardId}}case"confirm_deck_discard":return{type:"confirmDeckDiscard"};case"confirm_deck_play_preview":return{type:"confirmDeckPlayPreview"};default:{if("optional"in t&&t.optional)return{type:"skip"};const i=[...a.player.lanes.flat(),...a.opponent.lanes.flat()];return i.length>0&&(t.type.includes("select_")||t.type.includes("shift"))?{type:"deleteCard",cardId:i[0].id}:{type:"skip"}}}},um=(a,t)=>t?Nw(a,t):a.phase==="compile"&&a.compilableLanes.length>0?{type:"compile",laneIndex:a.compilableLanes.reduce((c,i)=>a.opponent.laneValues[i]>a.opponent.laneValues[c]?i:c)}:a.phase==="action"?Rw(a):{type:"fillHand"};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const nt=(a,t)=>a.phase==="start"?t.continueTurnAfterStartPhaseAction(a):t.processEndOfAction(a),Lm=(a,t,l,c,i,d,f,p)=>{const{cardId:u,laneIndex:h,isFaceUp:y}=t,{newState:g,animationRequests:_}=i.playCard({...a,actionRequired:null},u,h,y,"opponent"),x={...g,animationState:{type:"playCard",cardId:u,owner:"opponent"}};return setTimeout(()=>{l(S=>{let E={...S,animationState:null};return _&&_.length>0?(d(_,()=>l(b=>{const j={...b,animationState:null};return p&&j.actionRequired?(Sn(j,l,c,i,d,f),j):j.actionRequired&&j.actionRequired.actor==="opponent"?j:{...nt(j,f),animationState:null}})),E):p&&E.actionRequired?(Sn(E,l,c,i,d,f),E):E.actionRequired&&E.actionRequired.actor==="opponent"?E:nt(E,f)})},500),x},Cc=(a,t,l)=>{switch(l){case"normal":return um(a,t);case"hard":return console.warn("[AI] Hard AI temporarily disabled, using Normal AI"),um(a,t);default:return kw(a,t)}},Tw=(a,t,l,c,i,d,f,p,u)=>{t(h=>{const y=h.actionRequired;if(!y||!((h.turn==="player"||h._interruptedTurn==="player")&&"actor"in y&&y.actor==="opponent"))return h;if(y.type==="discard_completed"){const{followUpEffect:E,conditionalType:b,previousHandSize:j,sourceCardId:C,actor:R}=y;if(E&&C){const A=Se(h,C);if(A){const I=h[R].hand.length,U=Math.max(0,(j||0)-I);if(b==="then"||b==="if_executed"&&U>0){let Z=-1;for(let ee=0;ee<h[A.owner].lanes.length;ee++)if(h[A.owner].lanes[ee].some(z=>z.id===C)){Z=ee;break}if(Z!==-1){const ee={cardOwner:A.owner,opponent:A.owner==="player"?"opponent":"player",currentTurn:h.turn,actor:R,discardedCount:U};return st(A.card,Z,{...h,actionRequired:null},ee,E).newState}}}}return{...h,actionRequired:null}}const x=Cc(h,y,l);if(x.type==="discardCards"&&y.type==="discard"){const b=y.variableCount===!0?x.cardIds.length:y.count,j=x.cardIds.slice(0,b);j.length!==x.cardIds.length&&console.warn(`[AI Manager] Fixed discard count: AI wanted ${x.cardIds.length} but action.count=${y.count}`);const C=c.discardCards(h,j,"opponent");return C.actionRequired?C:nt(C,i)}if(x.type==="rearrangeProtocols"&&y.type==="prompt_rearrange_protocols"){u&&y.sourceCardId==="CONTROL_MECHANIC"&&y.actor&&u(y.actor);const E=c.resolveRearrangeProtocols(h,x.newOrder);return nt(E,i)}if(y.type==="reveal_opponent_hand"){const E=c.revealOpponentHand(h);return nt(E,i)}if(x.type==="resolveOptionalEffectPrompt"&&y.type==="prompt_optional_draw"){const E=zd(h,x.accept);return E.actionRequired?E:nt(E,i)}if(x.type==="resolveOptionalEffectPrompt"&&y.type==="prompt_optional_effect"){const E=Vd(h,x.accept);return E.actionRequired?E:nt(E,i)}if(x.type==="resolveCustomChoice"&&y.type==="custom_choice"){const E=Yd(h,x.optionIndex);return E.actionRequired?E:nt(E,i)}if(x.type==="selectLane"){const{nextState:E,requiresAnimation:b}=p(h,x.laneIndex);if(b){const j=h.phase==="start";return d(b.animationRequests,()=>{t(C=>{const R={...C,animationState:null},A=b.onCompleteCallback(R,U=>U);return A.actionRequired&&A.actionRequired.actor==="opponent"?{...A,animationState:null}:{...j?i.continueTurnAfterStartPhaseAction(A):i.processEndOfAction(A),animationState:null}})}),E}return nt(E,i)}if(x.type==="deleteCard"||x.type==="flipCard"||x.type==="returnCard"||x.type==="shiftCard"||x.type==="selectCard"){const{nextState:E,requiresAnimation:b}=f(h,x.cardId);if(b){const j=h.phase==="start";return d(b.animationRequests,()=>{t(C=>{const R={...C,animationState:null},A=b.onCompleteCallback(R,U=>U);return A.actionRequired&&A.actionRequired.actor==="opponent"?{...A,animationState:null}:{...j?i.continueTurnAfterStartPhaseAction(A):i.processEndOfAction(A),animationState:null}})}),E}return E.actionRequired&&E.actionRequired.actor==="opponent"?E:nt(E,i)}if(x.type==="playCard"&&y.type==="select_card_from_hand_to_play")return Lm(h,x,t,l,c,d,i,!1);if(x.type==="stateNumber"&&y.type==="state_number"){const E=eu(h,x.number);return E.actionRequired&&E.actionRequired.actor==="opponent"?E:nt(E,i)}if(x.type==="stateProtocol"&&y.type==="state_protocol"){const E=tu(h,x.protocol);return E.actionRequired&&E.actionRequired.actor==="opponent"?E:nt(E,i)}if(x.type==="selectFromDrawnToReveal"&&y.type==="select_from_drawn_to_reveal"){const E=nu(h,x.cardId);return E.actionRequired&&E.actionRequired.actor==="opponent"?E:nt(E,i)}if(x.type==="confirmDeckDiscard"&&y.type==="confirm_deck_discard"){const E=au(h);return E.actionRequired&&E.actionRequired.actor==="opponent"?E:nt(E,i)}if(x.type==="confirmDeckPlayPreview"&&y.type==="confirm_deck_play_preview"){const E=ou(h);return E.actionRequired&&E.actionRequired.actor==="opponent"?E:nt(E,i)}if(y.type==="execute_conditional_followup"){const{sourceCardId:E,laneIndex:b,followUpEffect:j,context:C,actor:R,logSource:A,logPhase:I,logIndentLevel:U}=y,$=Se(h,E);if(!$){let z={...h};return A!==void 0&&(z._currentEffectSource=A),I!==void 0&&(z._currentPhaseContext=I),U!==void 0&&(z._logIndentLevel=U),z=ne(z,R,"Follow-up effect skipped (source no longer active)."),z.actionRequired=null,nt(z,i)}let Z={...h,actionRequired:null};return Z=st($.card,b,Z,C,j).newState,Z.actionRequired?Z:nt(Z,i)}console.warn(`AI has no logic for mandatory action during player turn, clearing it: ${y.type}, aiDecision: ${JSON.stringify(x)}`);const S={...h,actionRequired:null};return nt(S,i)})},Aw=(a,t,l,c,i,d,f)=>{const p=a.actionRequired;if(p.type==="discard_completed"){const{followUpEffect:y,conditionalType:g,previousHandSize:_,sourceCardId:x,actor:S}=p;if(y&&x){const E=Se(a,x);if(E){const b=a[S].hand.length,j=Math.max(0,(_||0)-b);if(g==="then"||g==="if_executed"&&j>0){let R=-1;for(let A=0;A<a[E.owner].lanes.length;A++)if(a[E.owner].lanes[A].some(I=>I.id===x)){R=A;break}if(R!==-1){const A={cardOwner:E.owner,opponent:E.owner==="player"?"opponent":"player",currentTurn:a.turn,actor:S,discardedCount:j};return st(E.card,R,{...a,actionRequired:null},A,y).newState}}}}return{...a,actionRequired:null}}const u=Cc(a,a.actionRequired,l);if(u.type==="skip"){const y=c.skipAction(a),g=a.phase==="start"?d.continueTurnAfterStartPhaseAction(y):d.processEndOfAction(y);return!g.actionRequired&&g.turn==="opponent"&&!g.winner&&setTimeout(()=>{Sn(g,t,l,c,i,d,f)},500),g}if(u.type==="resolveControlMechanicPrompt"&&p.type==="prompt_use_control_mechanic"){const{choice:y}=u,{originalAction:g,actor:_}=p;if(y==="skip"){let x=ne(a,_,"Opponent skips rearranging protocols.");if(x.actionRequired=null,x={...x,_logIndentLevel:0},g.type==="compile"){const S=g.laneIndex;return setTimeout(()=>{t(E=>{const b=c.compileLane(E,S);return b.winner?b:{...d.processEndOfAction(b),animationState:null}})},1e3),{...x,animationState:{type:"compile",laneIndex:S},compilableLanes:[]}}else if(g.type==="fill_hand"){const S=c.fillHand(x,_);return d.processEndOfAction(S)}else return d.processEndOfAction(x)}else{const x=y;let b=ne(a,_,`Opponent chooses to rearrange ${x==="opponent"?"the player's":"their own"} protocols.`);return b.actionRequired={type:"prompt_rearrange_protocols",sourceCardId:"CONTROL_MECHANIC",target:x,actor:_,originalAction:g},b}}if(u.type==="resolveOptionalDiscardCustomPrompt"&&p.type==="prompt_optional_discard_custom"){const y=c.resolveOptionalDiscardCustomPrompt(a,u.accept);return y.actionRequired?y:nt(y,d)}if(u.type==="resolveOptionalEffectPrompt"&&p.type==="prompt_optional_draw"){const y=c.resolveOptionalDrawPrompt(a,u.accept);return y.actionRequired?y:nt(y,d)}if(u.type==="resolveOptionalEffectPrompt"){const y=c.resolveOptionalEffectPrompt(a,u.accept);return y.actionRequired?y:nt(y,d)}if(u.type==="resolvePrompt"&&p.type==="prompt_optional_shuffle_trash"){if(!u.accept){let g={...a};return g.actionRequired=null,g=ne(g,p.actor,`${p.actor==="player"?"Player":"Opponent"} skips shuffling trash into deck.`),nt(g,d)}const y=Sm(a,p.actor,"Clarity-4");return nt(y.newState,d)}if(u.type==="resolveSwapProtocols"&&p.type==="prompt_swap_protocols"){const y=c.resolveSwapProtocols(a,u.indices);return nt(y,d)}if(u.type==="resolveCustomChoice"&&p.type==="custom_choice"){const y=c.resolveCustomChoice(a,u.optionIndex);return y.actionRequired?y:nt(y,d)}if(u.type==="resolveRevealBoardCardPrompt"&&(p.type==="prompt_shift_or_flip_revealed_card"||p.type==="prompt_shift_or_flip_board_card_custom")){const y=Bd(a,u.choice);return y.actionRequired?y:nt(y,d)}if(u.type==="rearrangeProtocols"&&p.type==="prompt_rearrange_protocols"){f&&p.sourceCardId==="CONTROL_MECHANIC"&&p.actor&&f(p.actor);const y=c.resolveRearrangeProtocols(a,u.newOrder);return nt(y,d)}if(u.type==="selectLane"){const{nextState:y,requiresAnimation:g}=Hd(a,u.laneIndex);if(g){const{animationRequests:_,onCompleteCallback:x}=g;return i(_,()=>{t(S=>{const E={...S,animationState:null};return x(E,b=>{const j={...b,animationState:null},R={...a.phase==="start"?d.continueTurnAfterStartPhaseAction(j):d.processEndOfAction(j),animationState:null};return!R.actionRequired&&R.turn==="opponent"&&!R.winner?setTimeout(()=>{Sn(R,t,l,c,i,d,f)},500):R.actionRequired&&R.turn==="opponent"&&setTimeout(()=>{Sn(R,t,l,c,i,d,f)},300),R})})}),y}return nt(y,d)}if(u.type==="flipCard"||u.type==="deleteCard"||u.type==="returnCard"||u.type==="shiftCard"||u.type==="selectCard"){const{nextState:y,requiresAnimation:g,requiresTurnEnd:_}=Md(a,u.cardId);if(g){const{animationRequests:x,onCompleteCallback:S}=g;return i(x,()=>{t(E=>{const b={...E,animationState:null};return S(b,j=>{const C={...j,animationState:null};if(C.queuedActions&&C.queuedActions.length>0){const R=d.processEndOfAction(C);return R.actionRequired?(Sn(R,t,l,c,i,d),{...R,animationState:null}):{...R,animationState:null}}if(C.actionRequired)return Sn(C,t,l,c,i,d),C;if(C.phase==="start"){const A={...d.continueTurnAfterStartPhaseAction(C),animationState:null};return!A.actionRequired&&A.turn==="opponent"&&!A.winner&&setTimeout(()=>{Sn(A,t,l,c,i,d,f)},500),A}else return{...d.processEndOfAction(C),animationState:null}})})}),y}return _||y.queuedActions&&y.queuedActions.length>0?nt(y,d):y}if(u.type==="playCard"&&p.type==="select_card_from_hand_to_play")return Lm(a,u,t,l,c,i,d,!0);if(u.type==="discardCards"&&p.type==="discard"){const g=p.variableCount===!0?u.cardIds.length:p.count,_=u.cardIds.slice(0,g);_.length!==u.cardIds.length&&console.warn(`[AI Manager] Fixed discard count: AI wanted ${u.cardIds.length} but action.count=${p.count}`);const x=c.discardCards(a,_,"opponent");return x.actionRequired?x:nt(x,d)}if(u.type==="giveCard"&&p.type==="select_card_from_hand_to_give"){const y=c.resolveActionWithHandCard(a,u.cardId);return y.actionRequired?y:nt(y,d)}if(u.type==="revealCard"&&p.type==="select_card_from_hand_to_reveal")return c.resolveActionWithHandCard(a,u.cardId);if(u.type==="selectRevealedDeckCard"&&p.type==="select_card_from_revealed_deck"){const y=Nm(a,u.cardId);return nt(y,d)}if(u.type==="stateNumber"&&p.type==="state_number"){const y=eu(a,u.number);return y.actionRequired?y:nt(y,d)}if(u.type==="stateProtocol"&&p.type==="state_protocol"){const y=tu(a,u.protocol);return y.actionRequired?y:nt(y,d)}if(u.type==="selectFromDrawnToReveal"&&p.type==="select_from_drawn_to_reveal"){const y=nu(a,u.cardId);return y.actionRequired?y:nt(y,d)}if(u.type==="confirmDeckDiscard"&&p.type==="confirm_deck_discard"){const y=au(a);return y.actionRequired?y:nt(y,d)}if(u.type==="confirmDeckPlayPreview"&&p.type==="confirm_deck_play_preview"){const y=ou(a);return y.actionRequired?y:nt(y,d)}if(u.type==="selectTrashCard"&&p.type==="select_card_from_trash_to_play"){const y=Tm(a,u.cardIndex);return y.actionRequired?y:nt(y,d)}if(u.type==="selectTrashCard"&&p.type==="select_card_from_trash_to_reveal"){const y=Am(a,u.cardIndex);return y.actionRequired?y:nt(y,d)}console.warn(`AI has no logic for mandatory action, clearing it: ${p.type}`);const h={...a,actionRequired:null};return nt(h,d)},Sn=(a,t,l,c,i,d,f)=>{t(p=>{if(p.turn!=="opponent"||p.winner||p.animationState||!["start","compile","action","hand_limit","end"].includes(p.phase))return p;if(p.actionRequired){const y=p.actionRequired;let g=!1;if((y.type==="discard"&&y.actor==="player"||y.type==="plague_4_opponent_delete"&&y.actor==="opponent"||"actor"in y&&y.actor==="player")&&(g=!0),g)return p}let h={...p};if(h.actionRequired&&h.actionRequired.type==="reveal_opponent_hand"){const y=c.revealOpponentHand(h);return d.processEndOfAction(y)}if(h.phase==="start"&&(h=d.processStartOfTurn(h)),h.actionRequired){const y=Aw(h,t,l,c,i,d,f);return!y.actionRequired&&y.turn==="opponent"&&!y.winner&&y.phase!=="hand_limit"&&setTimeout(()=>{Sn(y,t,l,c,i,d,f)},300),y}if(h.phase==="compile"&&h.compilableLanes.length>0){const y=Cc(h,null,l);if(y.type==="compile"){const g=y.laneIndex,_=Rm(h);return _.actionRequired?_:(setTimeout(()=>{t(x=>{const S=c.compileLane(x,g);return S.winner?S:{...d.processEndOfAction(S),animationState:null}})},1e3),{..._,animationState:{type:"compile",laneIndex:g},compilableLanes:[]})}}if(h.phase==="action"){const y=Cc(h,null,l);if(y.type==="fillHand"){const g=km(h,"opponent");return g.actionRequired?g:d.processEndOfAction(g)}if(y.type==="playCard"){const{newState:g,animationRequests:_}=c.playCard(h,y.cardId,y.laneIndex,y.isFaceUp,"opponent"),x={...g,animationState:{type:"playCard",cardId:y.cardId,owner:"opponent"}};return setTimeout(()=>{const S=()=>{t(E=>{let b={...E},j={newState:b};if(!b.actionRequired){if(b.queuedEffect){const{card:I,laneIndex:U}=b.queuedEffect,$={cardOwner:"opponent",actor:"opponent",currentTurn:b.turn,opponent:"player",triggerType:"play"};j=ol(I,U,b,$),j.newState.queuedEffect=void 0}}const C=j.animationRequests,R=j.newState,A=()=>{t(I=>{if(I.queuedActions&&I.queuedActions.length>0){const U=d.processEndOfAction(I);return U.actionRequired&&Sn(U,t,l,c,i,d),U}return I.actionRequired?(Sn(I,t,l,c,i,d),I):d.processEndOfAction(I)})};if(C&&C.length>0)return i(C,A),R;if(R.queuedActions&&R.queuedActions.length>0){const I=d.processEndOfAction(R);return I.actionRequired&&Sn(I,t,l,c,i,d),I}return R.actionRequired?(Sn(R,t,l,c,i,d),R):d.processEndOfAction(R)})};t(E=>{const b={...E,animationState:null};return _&&_.length>0?i(_,S):S(),b})},500),x}}return h.phase==="end"||h.phase==="hand_limit"?d.continueTurnProgression(h):d.processEndOfAction(h)})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function Dw(a,t){let l=null,c=null;const i=["player","opponent"];for(const y of i){for(const g of a[y].lanes){const _=g.find(x=>x.id===t);if(_){l=y,c=_;break}}if(l)break}if(!l||!c)return console.error("Card to delete not found on board:",t),a;const d={...a},f={...d[l]};f.lanes=f.lanes.map(y=>y.filter(g=>g.id!==t));const{id:p,isFaceUp:u,...h}=c;return f.discard=[...f.discard,h],d[l]=f,d}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Fw=(a,t,l,c,i,d="player",f)=>{const[p,u]=le.useState(()=>{const Y=Gl(a,t,i,d);return Ee(Y)}),[h,y]=le.useState(null),g=le.useRef(!1),_=le.useRef(0);le.useEffect(()=>{p.turn!==d&&p.log.length<=4&&u(Y=>{const K=d==="player"?"Player":"Opponent",X=[...Y.log];return X.length>0&&(X[X.length-1]={player:"player",message:`${K} goes first.`}),{...Y,turn:d,log:X}})},[d,p.turn,p.log.length]);const x=le.useCallback(Y=>{switch(Y){case"start":return wm;case"end":return Kr;default:return tl}},[]),S=le.useCallback((Y,K)=>{const X=se=>{if(se.length===0){K();return}const[ie,..._e]=se;ie.type==="delete"?(u(ye=>({...ye,animationState:{type:"deleteCard",cardId:ie.cardId,owner:ie.owner}})),setTimeout(()=>{u(ye=>{if(!(ye.player.lanes.flat().some(be=>be.id===ie.cardId)||ye.opponent.lanes.flat().some(be=>be.id===ie.cardId)))return{...ye,animationState:null};let Ie=Dw(ye,ie.cardId);return Ie=Ee(Ie),{...Ie,animationState:null}}),setTimeout(()=>{_e.length>0?X(_e):K()},10)},500)):ie.type==="return"?(u(ye=>({...ye,animationState:{type:"returnCard",cardId:ie.cardId,owner:ie.owner}})),setTimeout(()=>{u(ye=>{const ke=ye[ie.owner].lanes.findIndex(Ae=>Ae.some(Le=>Le.id===ie.cardId)),Ie=ke!==-1&&ye[ie.owner].lanes[ke].length>0&&ye[ie.owner].lanes[ke][ye[ie.owner].lanes[ke].length-1].id===ie.cardId,be=ye[ie.owner].lanes.flat().find(Ae=>Ae.id===ie.cardId);if(!be)return{...ye,animationState:null};const Pe=ye[ie.owner].lanes.map(Ae=>Ae.filter(Le=>Le.id!==ie.cardId));let $e={...ye,[ie.owner]:{...ye[ie.owner],lanes:Pe,hand:[...ye[ie.owner].hand,be]}};return $e=Ee($e),Ie&&ke!==-1&&$e[ie.owner].lanes[ke].length>0&&($e=Un($e,ie.owner,ke).newState),{...$e,animationState:null}}),setTimeout(()=>{_e.length>0?X(_e):K()},10)},500)):ie.type==="play"?(u(ye=>({...ye,animationState:{type:"playCard",cardId:ie.cardId,owner:ie.owner}})),setTimeout(()=>{u(ye=>({...ye,animationState:null})),setTimeout(()=>{_e.length>0?X(_e):K()},10)},500)):ie.type==="draw"?(u(ye=>({...ye,animationState:{type:"draw",player:ie.player,count:ie.count}})),setTimeout(()=>{u(ye=>({...ye,animationState:null})),setTimeout(()=>{_e.length>0?X(_e):K()},10)},500)):setTimeout(()=>{_e.length>0?X(_e):K()},10)};X(Y)},[]),E=(Y,K,X="player")=>{if(!h||p.turn!=="player"||p.phase!=="action")return;const se=h;y(null),u(ie=>{const _e=x(ie.phase),{newState:ye,animationRequests:ke}=_c(ie,se,Y,K,"player",X),Ie={...ye,animationState:{type:"playCard",cardId:se,owner:"player"}};return setTimeout(()=>{u(be=>{let Pe={...be,animationState:null};return ke&&ke.length>0?(S(ke,()=>{u($e=>_e($e))}),Pe):Pe.actionRequired?Pe:_e(Pe)})},500),Ie})},b=()=>{p.turn!=="player"||p.phase!=="action"||p.actionRequired||u(Y=>{const K=x(Y.phase),X=km(Y,"player");return X.actionRequired?X:K(X)})},j=le.useCallback(Y=>{u(K=>{var X;return((X=K.actionRequired)==null?void 0:X.type)!=="discard"||K.actionRequired.actor!=="player"?K:{...K,animationState:{type:"discardCard",owner:"player",cardIds:[Y],originalAction:K.actionRequired}}})},[]),C=le.useCallback(Y=>{u(K=>{if(K.winner||K.phase!=="compile")return K;const X=x(K.phase),ie={...Rm(K),animationState:{type:"compile",laneIndex:Y},compilableLanes:[]};return setTimeout(()=>{u(_e=>{var be;const ye=Zl(_e,Y,l);if(ye.winner)return ye;if(((be=ye.actionRequired)==null?void 0:be.type)==="prompt_use_control_mechanic")return{...ye,animationState:null};const ke=ye._compileAnimations;if(ke&&ke.length>0){S(ke,()=>{u($e=>{const Ae={...$e};return delete Ae._compileAnimations,{...X(Ae),animationState:null}})});const Pe={...ye};return delete Pe._compileAnimations,Pe}return{...X(ye),animationState:null}})},1e3),ie})},[l,x]),R=Y=>{u(K=>{const X=K.turn,se=x(K.phase),{nextState:ie,requiresAnimation:_e,requiresTurnEnd:ye}=Md(K,Y);return _e?(S(_e.animationRequests,()=>{u(ke=>{const Ie=ke.turn!==X?be=>be:se;return _e.onCompleteCallback(ke,Ie)})}),ie):ie.actionRequired?ie:se(ie)})},A=Y=>{u(K=>{const X=x(K.phase),{nextState:se,requiresAnimation:ie}=Hd(K,Y);return ie?(S(ie.animationRequests,()=>{u(_e=>ie.onCompleteCallback(_e,X))}),se):se.actionRequired?se:X(se)})},I=Y=>{u(K=>{const X=x(K.phase),se=Id(K,Y);return se.actionRequired?se:X(se)})},U=Y=>{u(K=>xw(K,Y))},$=()=>{u(Y=>{var se,ie;const K=x(Y.phase);let X={...Y,animationState:null};return((se=X.actionRequired)==null?void 0:se.type)==="prompt_shift_or_flip_board_card_custom"?X=Bd(X,"skip"):X=nm(X),((ie=X.actionRequired)==null?void 0:ie.type)==="plague_4_player_flip_optional"?X:K(X)})},Z=le.useCallback(Y=>{u(K=>{var ie;if(((ie=K.actionRequired)==null?void 0:ie.type)!=="prompt_use_control_mechanic")return K;const{originalAction:X,actor:se}=K.actionRequired;if(Y==="skip"){let _e=ne(K,se,"Player skips rearranging protocols.");if(_e.actionRequired=null,_e={..._e,_logIndentLevel:0},X.type==="compile"){const ke={..._e,animationState:{type:"compile",laneIndex:X.laneIndex},compilableLanes:[]};return setTimeout(()=>{u(Ie=>{const be=Zl(Ie,X.laneIndex,l);return be.winner?be:{...x(be.phase)(be),animationState:null}})},1e3),ke}else if(X.type==="continue_turn"){let ye={..._e};return X.queuedSpeed2Actions&&X.queuedSpeed2Actions.length>0&&(ye.queuedActions=[...X.queuedSpeed2Actions,...ye.queuedActions||[]]),x(ye.phase)(ye)}else if(X.type==="resume_interrupted_turn"){let ye={..._e};return ye._interruptedTurn=X.interruptedTurn,ye._interruptedPhase=X.interruptedPhase,X.queuedSpeed2Actions&&X.queuedSpeed2Actions.length>0&&(ye.queuedActions=[...X.queuedSpeed2Actions,...ye.queuedActions||[]]),tl(ye)}else{const ye=es(_e,se);return x(ye.phase)(ye)}}else{const _e=Y;let Ie=ne(K,se,`${se==="player"?"Player":"Opponent"} chooses to rearrange ${_e==="player"?"their own":"the opponent's"} protocols.`);return Ie.actionRequired={type:"prompt_rearrange_protocols",sourceCardId:"CONTROL_MECHANIC",target:_e,actor:se,originalAction:X},Ie}})},[l,x]),ee=le.useCallback(Y=>{u(K=>{const X=x(K.phase),se=zd(K,Y);return se.actionRequired?se:X(se)})},[x]),z=le.useCallback(Y=>{u(K=>{var X;return((X=K.actionRequired)==null?void 0:X.type)!=="plague_2_player_discard"?K:{...K,animationState:{type:"discardCard",owner:"player",cardIds:Y,originalAction:K.actionRequired}}})},[]),O=le.useCallback(Y=>{u(K=>{const X=x(K.phase),se=lm(K,Y,"player");return X(se)})},[x]),k=le.useCallback(Y=>{u(K=>{const X=x(K.phase),se=sm(K,Y);return Y?se:X(se)})},[x]),q=le.useCallback(Y=>{u(K=>{const X=x(K.phase),se=Vd(K,Y);return se.actionRequired?se:X(se)})},[x]),F=le.useCallback(Y=>{u(K=>{var _e,ye,ke,Ie;const X=((_e=K.actionRequired)==null?void 0:_e.type)==="select_cards_from_hand_to_discard_for_fire_4",se=((ye=K.actionRequired)==null?void 0:ye.type)==="discard"&&((ke=K.actionRequired)==null?void 0:ke.variableCount),ie=((Ie=K.actionRequired)==null?void 0:Ie.type)==="discard"&&K.actionRequired.count>1;return!X&&!se&&!ie?K:{...K,animationState:{type:"discardCard",owner:"player",cardIds:Y,originalAction:K.actionRequired}}})},[]),D=le.useCallback(Y=>{u(K=>{var X;return((X=K.actionRequired)==null?void 0:X.type)!=="select_cards_from_hand_to_discard_for_hate_1"?K:{...K,animationState:{type:"discardCard",owner:"player",cardIds:Y,originalAction:K.actionRequired}}})},[]),T=le.useCallback(Y=>{u(K=>{const X=x(K.phase),se=Bd(K,Y);return se.actionRequired?se:X(se)})},[x]),L=le.useCallback(Y=>{u(K=>{var ie,_e;f&&((ie=K.actionRequired)==null?void 0:ie.sourceCardId)==="CONTROL_MECHANIC"&&((_e=K.actionRequired)!=null&&_e.actor)&&f(K.actionRequired.actor);const X=x(K.phase),se=$d(K,Y,l);return se.winner?se:X(se)})},[x,l,f]),B=le.useCallback(Y=>{u(K=>{const X=x(K.phase),se=Yd(K,Y);return se.actionRequired?se:X(se)})},[x]),G=le.useCallback(Y=>{u(K=>{const X=x(K.phase),se=cm(K,Y,l);return se.winner?se:X(se)})},[x,l]),ae=le.useCallback(Y=>{u(K=>{const X=x(K.phase),se=Nm(K,Y);return se.winner?se:X(se)})},[x]),M=le.useCallback(Y=>{u(K=>{const X=x(K.phase),se=eu(K,Y);return se.winner?se:X(se)})},[x]),W=le.useCallback(Y=>{u(K=>{const X=x(K.phase),se=tu(K,Y);return se.winner?se:X(se)})},[x]),oe=le.useCallback(Y=>{u(K=>{const X=x(K.phase),se=nu(K,Y);return se.winner?se:X(se)})},[x]),Q=le.useCallback(()=>{u(Y=>{const K=x(Y.phase),X=au(Y);return X.winner?X:K(X)})},[x]),V=le.useCallback(()=>{u(Y=>ou(Y))},[]),J=le.useCallback(Y=>{u(K=>Tm(K,Y))},[]),me=le.useCallback(Y=>{u(K=>Am(K,Y))},[]),ge=le.useCallback(Y=>{g.current=!1,_.current++,u(K=>{if(typeof Y=="function")return Y(K);const X=Y;if(X==="speed-0-interrupt"){const se=["Speed","Life","Water"],ie=["Metal","Death","Hate"];let _e=In(Ja(se)),ye=In(Ja(ie));const ke=(Ne,ht,ct)=>{const Ct=Ne.findIndex(wt=>wt.protocol===ht&&wt.value===ct);return Ct>-1?Ne.splice(Ct,1)[0]:Ln.find(wt=>wt.protocol===ht&&wt.value===ct)},Ie=ke(_e,"Speed",0),be=ke(ye,"Metal",0),Pe=ke(_e,"Speed",1),$e=ke(_e,"Life",1),Ae=ke(_e,"Water",1),Le=ke(_e,"Speed",3);let Re=Gl(se,ie,i,d);return Re.player.lanes=[[],[],[]],Re.player.lanes[0]=[{...Ie,id:ot(),isFaceUp:!1}],Re.player.hand=[{...Pe,id:ot(),isFaceUp:!0},{...$e,id:ot(),isFaceUp:!0},{...Ae,id:ot(),isFaceUp:!0},{...Le,id:ot(),isFaceUp:!0}],Re.player.deck=_e,Re.player.discard=[],Re.opponent.lanes=[[],[],[]],Re.opponent.hand=[{...be,id:ot(),isFaceUp:!0}],Re.opponent.deck=ye,Re.opponent.discard=[],Re.turn="opponent",Re.phase="start",Re.actionRequired=null,Re.queuedActions=[],Re=Ee(Re),Re=ne(Re,"player","DEBUG: Dynamic Speed-0 interrupt scenario set up. AI will play Metal-0."),Re}else if(X==="speed-1-trigger"){const se=["Speed","Life","Water"],ie=["Metal","Death","Hate"];let _e=In(Ja(se));const ye=In(Ja(ie)),Ie=((Ae,Le,Re)=>{const Ne=Ae.findIndex(ht=>ht.protocol===Le&&ht.value===Re);return Ne>-1?Ae.splice(Ne,1)[0]:Ln.find(ht=>ht.protocol===Le&&ht.value===Re)})(_e,"Speed",1);let be=Gl(se,ie,i,d);be.player.lanes=[[],[],[]],be.player.lanes[0]=[{...Ie,id:ot(),isFaceUp:!0}];const{drawnCards:Pe,remainingDeck:$e}=Pn(_e,[],6);return be.player.hand=Pe.map(Ae=>({...Ae,id:ot(),isFaceUp:!0})),be.player.deck=$e,be.player.discard=[],be.opponent.lanes=[[],[],[]],be.opponent.hand=[],be.opponent.deck=ye,be.opponent.discard=[],be.turn="player",be.phase="hand_limit",be.actionRequired={type:"discard",actor:"player",count:1},be.queuedActions=[],be=Ee(be),be=ne(be,"player","DEBUG: Speed-1 discard trigger scenario set up."),be}else if(X==="fire-oncover-test"){const se=["Death","Hate","Water"],ie=["Fire","Plague","Metal"],_e=In(Ja(se));let ye=In(Ja(ie));const ke=(Ne,ht,ct)=>{const Ct=Ne.findIndex(wt=>wt.protocol===ht&&wt.value===ct);return Ct>-1?Ne.splice(Ct,1)[0]:Ln.find(wt=>wt.protocol===ht&&wt.value===ct)},Ie=ke(ye,"Fire",0),be=ke(ye,"Fire",2),Pe=ke(ye,"Fire",3),$e=Ln.find(Ne=>Ne.protocol==="Death"&&Ne.value===1),Ae=Ln.find(Ne=>Ne.protocol==="Hate"&&Ne.value===2),Le=Ln.find(Ne=>Ne.protocol==="Water"&&Ne.value===3);let Re=Gl(se,ie,i,"opponent");return Re.player.lanes=[[{...$e,id:ot(),isFaceUp:!0}],[{...Ae,id:ot(),isFaceUp:!0}],[{...Le,id:ot(),isFaceUp:!0}]],Re.player.hand=[],Re.player.deck=_e,Re.player.discard=[],Re.opponent.lanes=[[{...Ie,id:ot(),isFaceUp:!0}],[],[]],Re.opponent.hand=[{...Pe,id:ot(),isFaceUp:!0},{...be,id:ot(),isFaceUp:!0}],Re.opponent.deck=ye,Re.opponent.discard=[],Re.turn="opponent",Re.phase="action",Re.actionRequired=null,Re.queuedActions=[],Re=Ee(Re),Re=ne(Re,"opponent","DEBUG: Fire On-Cover test scenario. Opponent has Fire-0 in play, Fire-3 and Fire-2 in hand. Ready to play Fire-3."),Re}else if(X==="speed-2-control-test"){const se=["Speed","Light","Water"],ie=["Fire","Plague","Metal"],_e=In(Ja(se)),ye=In(Ja(ie)),Ie=((Pe,$e,Ae)=>{const Le=Pe.findIndex(Re=>Re.protocol===$e&&Re.value===Ae);return Le>-1?Pe.splice(Le,1)[0]:Ln.find(Re=>Re.protocol===$e&&Re.value===Ae)})(_e,"Speed",2);let be=Gl(se,ie,!0,"player");return be.player.lanes=[[{...Ie,id:ot(),isFaceUp:!0}],[],[]],be.player.protocols[0]="Speed",be.player.laneValues[0]=10,be.player.hand=[],be.player.deck=_e,be.player.discard=[],be.controlCardHolder="player",be.opponent.lanes=[[],[],[]],be.opponent.hand=[],be.opponent.deck=ye,be.opponent.discard=[],be.turn="player",be.phase="compile",be.compilableLanes=[0],be.actionRequired=null,be.queuedActions=[],be=Ee(be),be=ne(be,"player","DEBUG: Speed-2 + Control test scenario. Player has Speed-2 (value 10), Control Component active. Ready to compile Protocol Speed!"),be}return K})},[i]);return le.useEffect(()=>{const Y=p.animationState;if(!Y)return;let K=0,X=!1;if(Y.type==="flipCard"?(K=600,X=!0):Y.type==="drawCard"?(K=1e3,X=!0):Y.type==="discardCard"&&(K=800,X=!0),X){const se=setTimeout(()=>{u(ie=>({...ie,animationState:null}))},K);return()=>clearTimeout(se)}},[p.animationState]),le.useEffect(()=>{const Y=p.animationState;if((Y==null?void 0:Y.type)==="discardCard"&&Y.owner==="player"){const K=setTimeout(()=>{u(X=>{const se=X.animationState;if((se==null?void 0:se.type)!=="discardCard"||!se.originalAction)return X;const{cardIds:ie,originalAction:_e}=se,ye=x(X.phase);let ke;return _e.type==="plague_2_player_discard"?ke=ww(X,ie):_e.type==="select_cards_from_hand_to_discard_for_fire_4"?ke=Fd(X,ie):_e.type==="select_cards_from_hand_to_discard_for_hate_1"?ke=qd(X,ie):_e.type==="discard"&&(_e.count>1||_e.variableCount)?ke=Fd(X,ie):ke=dr(X,ie,"player"),ke.animationState=null,ke.actionRequired?ke:ye(ke)})},500);return()=>clearTimeout(K)}},[p.animationState,x]),le.useEffect(()=>{const Y=p.actionRequired;if((Y==null?void 0:Y.type)==="discard_completed"&&Y.actor==="player"&&!p.animationState){const{followUpEffect:K,conditionalType:X,previousHandSize:se,sourceCardId:ie}=Y;u(_e=>{var Ie;if(((Ie=_e.actionRequired)==null?void 0:Ie.type)!=="discard_completed")return _e;const ye=x(_e.phase);if(K&&ie){const be=Se(_e,ie);if(be){const Pe=_e.player.hand.length,$e=Math.max(0,(se||0)-Pe);if(X==="then"||X==="if_executed"&&$e>0){let Le=-1;for(let Re=0;Re<_e[be.owner].lanes.length;Re++)if(_e[be.owner].lanes[Re].some(Ne=>Ne.id===ie)){Le=Re;break}if(Le!==-1){const Re={cardOwner:be.owner,opponent:be.owner==="player"?"opponent":"player",currentTurn:_e.turn,actor:"player",discardedCount:$e},Ne=st(be.card,Le,{..._e,actionRequired:null},Re,K);return Ne.newState.actionRequired?Ne.newState:ye(Ne.newState)}}}}const ke={..._e,actionRequired:null};return ye(ke)})}},[p.actionRequired,p.animationState,x]),le.useEffect(()=>{if(p.turn==="opponent"&&!p.winner&&!p.animationState&&!p._interruptedTurn&&!g.current){g.current=!0;const Y=_.current,K=p,X=setTimeout(()=>{_.current===Y&&Sn(K,u,c,{compileLane:(se,ie)=>Zl(se,ie,l),playCard:_c,fillHand:es,discardCards:dr,flipCard:om,deleteCard:(se,ie)=>({newState:se,animationRequests:[{type:"delete",cardId:ie,owner:"opponent"}]}),returnCard:rm,skipAction:nm,resolveOptionalDrawPrompt:zd,resolvePlague4Flip:(se,ie)=>lm(se,ie,"opponent"),resolvePlague2Discard:Dd,resolvePlague2OpponentDiscard:Dd,resolveOptionalDiscardCustomPrompt:sm,resolveOptionalEffectPrompt:Vd,resolveFire4Discard:Fd,resolveHate1Discard:qd,resolveRearrangeProtocols:(se,ie)=>$d(se,ie,l),resolveActionWithHandCard:Id,resolveSwapProtocols:(se,ie)=>cm(se,ie,l),revealOpponentHand:am,resolveCustomChoice:Yd},S,Zh,f)},1500);return()=>{clearTimeout(X),g.current=!1}}},[p.turn,p.phase,p.winner,p.animationState,p._interruptedTurn,c,l,S,p.actionRequired]),le.useEffect(()=>{const Y=p.actionRequired,K=p.turn==="player"||p._interruptedTurn==="player",X=Y&&"actor"in Y&&Y.actor==="opponent";K&&!p.animationState&&X&&!g.current&&(g.current=!0,Tw(p,u,c,{playCard:_c,discardCards:dr,flipCard:om,returnCard:rm,deleteCard:(ie,_e)=>({newState:ie,animationRequests:[{type:"delete",cardId:_e,owner:"opponent"}]}),resolveActionWithHandCard:Id,resolveHate1Discard:qd,resolvePlague2OpponentDiscard:Dd,revealOpponentHand:am,resolveRearrangeProtocols:(ie,_e)=>$d(ie,_e,l)},Zh,S,Md,Hd,f),g.current=!1)},[p.actionRequired,p.turn,p.animationState,c,S,l]),le.useEffect(()=>{u(Y=>{let K=Ee(Y);return K.turn==="player"&&K.phase==="start"&&!K.actionRequired?xm(K):K})},[p.turn,p.phase]),{gameState:p,selectedCard:h,setSelectedCard:y,playSelectedCard:E,fillHand:b,discardCardFromHand:j,compileLane:C,resolveActionWithCard:R,resolveActionWithLane:A,selectHandCardForAction:U,skipAction:$,resolvePlague2Discard:z,resolveActionWithHandCard:I,resolvePlague4Flip:O,resolveOptionalDiscardCustomPrompt:k,resolveOptionalEffectPrompt:q,resolveFire4Discard:F,resolveHate1Discard:D,resolveRevealBoardCardPrompt:T,resolveRearrangeProtocols:L,resolveOptionalDrawPrompt:ee,resolveSwapProtocols:G,resolveControlMechanicPrompt:Z,resolveCustomChoice:B,resolveSelectRevealedDeckCard:ae,resolveStateNumber:M,resolveStateProtocol:W,resolveSelectFromDrawnToReveal:oe,resolveConfirmDeckDiscard:Q,resolveConfirmDeckPlayPreview:V,resolveSelectTrashCardToPlay:J,resolveSelectTrashCardToReveal:me,setupTestScenario:ge}},pm=({cards:a,isPlayable:t,isCompilable:l,isShiftTarget:c,isEffectTarget:i,isMatching:d,onLanePointerDown:f,onPlayFaceDown:p,onCardPointerDown:u,onCardPointerEnter:h,onCardPointerLeave:y,owner:g,animationState:_,isCardTargetable:x,laneIndex:S,sourceCardId:E,gameState:b})=>{const j=["lane"];return t&&j.push("playable"),d&&j.push("matching-protocol"),l&&j.push("compilable"),c&&j.push("shift-target"),i&&j.push("effect-target"),o.jsxs("div",{className:j.join(" "),onPointerDown:f,children:[t&&d&&g==="player"&&p&&o.jsx("button",{className:"btn btn-play-facedown",onPointerDown:C=>{C.stopPropagation(),p()},children:"Play Face-Down"}),o.jsx("div",{className:"lane-stack",children:a.map((C,R)=>{var U;const A=((U=b.actionRequired)==null?void 0:U.type)==="prompt_shift_or_flip_for_light_2"&&b.actionRequired.revealedCardId===C.id,I=ma(C,a,b,S,g);return o.jsx(xt,{card:C,isFaceUp:C.isFaceUp||A,style:{"--i":R},onPointerDown:$=>{$.stopPropagation(),u(C)},onPointerEnter:()=>h(C),animationState:_,isTargetable:x(C),isSourceOfEffect:C.id===E,faceDownValue:I},C.id)})})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Ao=(a,t)=>Io(a,t),ea=(a,t)=>bn(a).some(({rule:c,laneIndex:i})=>c.type==="block_shifts_from_and_to_lane"&&i===t),Sc=(a,t)=>{const{actionRequired:l}=t;if(!l||"actor"in l&&l.actor!=="player")return!1;let c=null,i=-1,d=[];for(const u of["player","opponent"]){for(let h=0;h<t[u].lanes.length;h++)if(t[u].lanes[h].some(y=>y.id===a.id)){c=u,i=h,d=t[u].lanes[h];break}if(c)break}if(!c)return!1;const f=d.findIndex(u=>u.id===a.id),p=Lo(t,d,f);if(l.type==="select_lane_for_shift"){const u=l.cardToShiftId;return!!(u&&a.id===u)}if(l.type==="shift_flipped_card_optional"){const u=l.cardId;return!!(u&&a.id===u)}switch(l.type){case"select_opponent_face_up_card_to_flip":return c==="opponent"&&a.isFaceUp&&p;case"select_card_to_flip":{if(Ao(t,a.id))return!1;const u=l.targetFilter||{},h=d.findIndex(b=>b.id===a.id),y=l.currentLaneIndex,g=l.laneIndex,_=l.scope,x=l.restrictedLaneIndex;if(y!==void 0&&i!==y||_==="this_lane"&&g!==void 0&&i!==g||x!==void 0&&i!==x)return!1;const S=u.position||"uncovered";if(S==="uncovered"&&!p||S==="covered"&&h>=d.length-1||u.owner==="own"&&c!==l.actor||u.owner==="opponent"&&c===l.actor||u.faceState==="face_up"&&!a.isFaceUp||u.faceState==="face_down"&&a.isFaceUp||u.excludeSelf&&a.id===l.sourceCardId||!Xl(t,a.id).allowed)return!1;if(u.valueMinGreaterThanHandSize){const b=t[l.actor].hand.length;if(a.value<=b)return!1}return!0}case"select_own_face_up_covered_card_to_flip":{const u=d.findIndex(h=>h.id===a.id);return c==="player"&&a.isFaceUp&&u<d.length-1}case"select_opponent_covered_card_to_shift":{const u=d.findIndex(y=>y.id===a.id),h=t.turn==="player"?"opponent":"player";return ea(t,i)?!1:c===h&&u<d.length-1}case"select_own_covered_card_to_shift":{const u=d.findIndex(h=>h.id===a.id);return ea(t,i)?!1:c===l.actor&&u<d.length-1}case"select_covered_card_in_line_to_flip_optional":{const h=d.findIndex(g=>g.id===a.id)<d.length-1;return ka(t)&&!a.isFaceUp?!1:i===l.laneIndex&&h}case"select_covered_card_to_flip_for_chaos_0":{const h=d.findIndex(g=>g.id===a.id)<d.length-1;return ka(t)&&!a.isFaceUp?!1:i===l.laneIndex&&h}case"shift_flipped_card_optional":return ea(t,i)?!1:a.id===l.cardId;case"select_opponent_card_to_flip":return ka(t)&&!a.isFaceUp?!1:c==="opponent"&&p;case"select_face_down_card_to_shift_for_darkness_4":return ea(t,i)?!1:!a.isFaceUp&&p;case"select_cards_to_delete":{if(Ao(t,a.id)||l.disallowedIds.includes(a.id))return!1;const u=l.allowedIds;if(u&&!u.includes(a.id))return!1;const h=l.currentLaneIndex;if(h!==void 0&&i!==h)return!1;const y=l.targetFilter;if(y){const g=d.findIndex(j=>j.id===a.id),_=y.position||"uncovered";if(_==="uncovered"&&!p||_==="covered"&&g>=d.length-1||y.faceState==="face_up"&&!a.isFaceUp||y.faceState==="face_down"&&a.isFaceUp)return!1;if(y.valueRange){const{min:j,max:C}=y.valueRange;if(a.value<j||a.value>C)return!1}const x=l.actorChooses,S=l.sourceCardId;let E=null;for(const j of["player","opponent"])if(t[j].lanes.flat().some(C=>C.id===S)){E=j;break}if(x==="card_owner"&&E){if(y.owner==="own"&&c!==E||y.owner==="opponent"&&c===E)return!1}else if(y.owner==="own"&&c!==l.actor||y.owner==="opponent"&&c===l.actor)return!1;const b=l.protocolMatching;if(b){const j=t.player.protocols[i],C=t.opponent.protocols[i],R=a.protocol,A=R===j||R===C;if(b==="must_match"&&!A||b==="must_not_match"&&A)return!1}return!0}return p}case"select_face_down_card_to_delete":return!a.isFaceUp&&p;case"select_low_value_card_to_delete":return a.isFaceUp&&(a.value===0||a.value===1)&&p;case"select_card_from_other_lanes_to_delete":{if(Ao(t,a.id))return!1;const{disallowedLaneIndex:u,lanesSelected:h}=l;return i!==u&&!h.includes(i)&&p}case"plague_4_opponent_delete":return(t.turn==="player"?"opponent":"player")==="player"?c==="player"&&!a.isFaceUp&&p:!1;case"select_any_other_card_to_flip":return ka(t)&&!a.isFaceUp?!1:a.id!==l.sourceCardId&&p;case"select_card_to_return":{if(Ao(t,a.id))return!1;const u=l.targetOwner||"any",h=l.targetFilter,y=l.actor,g=(h==null?void 0:h.position)||"uncovered",x=d.findIndex(S=>S.id===a.id)<d.length-1;return g==="uncovered"&&!p||g==="covered"&&!x?!1:u==="own"?c===y:u==="opponent"?c!==y:!0}case"select_card_to_shift_for_gravity_1":return Ao(t,a.id)||ea(t,i)?!1:p;case"select_face_down_card_to_shift_for_gravity_4":return ea(t,i)?!1:!a.isFaceUp&&i!==l.targetLaneIndex&&p;case"select_any_card_to_flip":case"select_any_card_to_flip_optional":return ka(t)&&!a.isFaceUp||!Xl(t,a.id).allowed?!1:p;case"select_any_face_down_card_to_flip_optional":return Xl(t,a.id).allowed?!a.isFaceUp&&p:!1;case"select_board_card_to_reveal_custom":{const u=l.targetFilter;if(!u)return!a.isFaceUp&&p;const h=d.findIndex(g=>g.id===a.id),y=u.position||"uncovered";return!(y==="uncovered"&&!p||y==="covered"&&h>=d.length-1||u.owner==="own"&&c!==l.actor||u.owner==="opponent"&&c===l.actor||u.faceState==="face_up"&&!a.isFaceUp||u.faceState==="face_down"&&a.isFaceUp)}case"select_own_other_card_to_shift":return ea(t,i)?!1:c===l.actor&&a.id!==l.sourceCardId&&p;case"select_opponent_face_down_card_to_shift":return ea(t,i)?!1:c!==l.actor&&!a.isFaceUp&&p;case"select_any_opponent_card_to_shift":return ea(t,i)?!1:c!==l.actor&&p;case"select_opponent_card_to_return":return c==="opponent"&&p;case"select_card_to_shift_for_anarchy_1":return Ao(t,a.id)||ea(t,i)?!1:p;case"select_card_to_shift_for_anarchy_0":return Ao(t,a.id)||ea(t,i)?!1:p;case"select_card_to_shift":{if(Ao(t,a.id)||ea(t,i))return!1;const u=l.targetFilter||{},h=l.destinationRestriction,y=l.scope,g=l.sourceLaneIndex;if(y==="this_lane"&&g!==void 0&&i!==g||(h==null?void 0:h.type)==="non_matching_protocol"&&!a.isFaceUp)return!1;const _=u.position||"uncovered",S=d.findIndex(E=>E.id===a.id)<d.length-1;return!(_==="uncovered"&&!p||_==="covered"&&!S||u.owner==="own"&&c!==l.actor||u.owner==="opponent"&&c===l.actor||u.faceState==="face_up"&&!a.isFaceUp||u.faceState==="face_down"&&a.isFaceUp||u.excludeSelf&&a.id===l.sourceCardId)}case"select_phase_effect":return l.availableEffects.some(h=>h.cardId===a.id);case"select_card_for_copy_middle":return(l.validTargetIds||[]).includes(a.id);default:return!1}},qw=({gameState:a,onLanePointerDown:t,onPlayFaceDown:l,onCardPointerDown:c,onCardPointerEnter:i,onCardPointerLeave:d,onOpponentHandCardPointerEnter:f,onOpponentHandCardPointerLeave:p,selectedCardId:u,sourceCardId:h})=>{const{player:y,opponent:g,animationState:_,phase:x,turn:S,compilableLanes:E,actionRequired:b,controlCardHolder:j}=a,C=z=>{const O=x==="compile"&&S==="player"&&!b&&E.includes(z),k=S==="player",q=x==="action"&&!b&&u,F=(b==null?void 0:b.type)==="select_lane_for_play";if(!(F?(b==null?void 0:b.actor)==="player":k)||!q&&!F)return{isPlayable:!1,isMatching:!1,isCompilable:O};let T;if(q)T=y.hand.find(ge=>ge.id===u);else if(F){if(b.disallowedLaneIndex!==void 0&&z===b.disallowedLaneIndex)return{isPlayable:!1,isMatching:!1,isCompilable:O};const ge=b.validLanes;if(ge&&!ge.includes(z))return{isPlayable:!1,isMatching:!1,isCompilable:O};if(b.source==="deck")return b.excludeCurrentLane&&z===b.currentLaneIndex?{isPlayable:!1,isMatching:!1,isCompilable:O}:{isPlayable:!0,isMatching:!1,isCompilable:O};if(b.source==="trash"){const Y=b.useNormalPlayRules,K=b.preDrawnCard;if(Y&&K){const X=y.protocols[z],se=g.protocols[z];return{isPlayable:!0,isMatching:K.protocol===X||K.protocol===se,isCompilable:O}}return{isPlayable:!0,isMatching:!1,isCompilable:O}}T=y.hand.find(Y=>Y.id===b.cardInHandId)}if(!T)return{isPlayable:!1,isMatching:!1,isCompilable:O};const L=g.lanes[z];if(L.length>0&&L[L.length-1].isFaceUp&&L[L.length-1].protocol==="Plague"&&L[L.length-1].value===0)return{isPlayable:!1,isMatching:!1,isCompilable:O};const G=g.lanes.flat().some(ge=>ge.isFaceUp&&ge.protocol==="Psychic"&&ge.value===1),ae=y.lanes.flat().some(ge=>ge.isFaceUp&&ge.protocol==="Spirit"&&ge.value===1),M=y.lanes.some(ge=>{if(ge.length===0)return!1;const Y=ge[ge.length-1];return Y.isFaceUp&&Y.protocol==="Chaos"&&Y.value===3}),W=[...y.lanes.flat(),...g.lanes.flat()].some(ge=>ge.isFaceUp&&ge.protocol==="Anarchy"&&ge.value===1),oe=Ec(a),Q=ts(a,"player",z),V=Kl(a,T);let J;return V?J=!G:W||oe?J=T.protocol!==y.protocols[z]&&T.protocol!==g.protocols[z]&&!G:J=(ae||Q||M||T.protocol===y.protocols[z]||T.protocol===g.protocols[z])&&!G,L.some(ge=>ge.isFaceUp&&ge.protocol==="Metal"&&ge.value===2)&&!J?{isPlayable:!1,isMatching:!1,isCompilable:O}:F&&(b.isFaceDown||b.faceDown)?{isPlayable:!0,isMatching:!1,isCompilable:O}:{isPlayable:!0,isMatching:J,isCompilable:O}},R=z=>{if(!(S==="player")||!(x==="action"&&!b&&u))return{isPlayable:!1,isMatching:!1};const q=y.hand.find(T=>T.id===u);if(!q)return{isPlayable:!1,isMatching:!1};if(!Kl(a,q))return{isPlayable:!1,isMatching:!1};const F=y.lanes[z];return F.length>0&&F[F.length-1].isFaceUp&&F[F.length-1].protocol==="Plague"&&F[F.length-1].value===0?{isPlayable:!1,isMatching:!1}:{isPlayable:!0,isMatching:!0}},A=z=>{if(!b||b.actor!=="player")return!1;switch(b.type){case"select_lane_for_delete":{const O=b.validLanes;return!(O&&!O.includes(z))}case"select_lane_for_death_2":case"select_lane_for_water_3":case"select_lane_for_return":return!0;case"select_lane_for_metal_3_delete":return z===b.disallowedLaneIndex?!1:y.lanes[z].length+g.lanes[z].length>=8;case"select_lane_for_delete_all":return(b.validLanes||[]).includes(z);case"select_lanes_for_swap_stacks":return(b.validLanes||[]).includes(z);default:return!1}},I=(z,O)=>{if(!b||b.actor!=="player")return!1;const k=b.type==="select_lane_for_shift"?b.originalLaneIndex:(b.type==="select_card_to_shift",-1);if(k!==-1&&!Jl(a,k,z).allowed)return!1;switch(b.type){case"select_lane_for_shift":{if(O!==b.cardOwner||z===b.originalLaneIndex)return!1;const q=b.validLanes;if(q&&!q.includes(z))return!1;const F=[...a.player.lanes.flat(),...a.opponent.lanes.flat()].find(T=>T.id===b.sourceCardId),D=b.destinationRestriction;if(D&&D.type==="to_or_from_this_lane"){let T=D.laneIndex;if(D.laneIndex==="current"&&F)for(const L of["player","opponent"]){for(let B=0;B<a[L].lanes.length;B++)if(a[L].lanes[B].some(G=>G.id===b.sourceCardId)){T=B;break}if(typeof T=="number")break}if(typeof T=="number"&&!(b.originalLaneIndex===T)&&!(z===T))return!1}else if(F&&F.protocol==="Gravity"&&F.value===1){let T=-1;for(const L of["player","opponent"]){for(let B=0;B<a[L].lanes.length;B++)if(a[L].lanes[B].some(G=>G.id===b.sourceCardId)){T=B;break}if(T!==-1)break}if(T!==-1&&!(b.originalLaneIndex===T)&&!(z===T))return!1}return!0}case"shift_flipped_card_optional":{const q=b.cardId;let F=null,D=-1;for(let T=0;T<y.lanes.length;T++)if(y.lanes[T].some(L=>L.id===q)){F="player",D=T;break}if(F===null){for(let T=0;T<g.lanes.length;T++)if(g.lanes[T].some(L=>L.id===q)){F="opponent",D=T;break}}return O!==F?!1:z!==D}case"select_lane_for_life_3_play":return O==="player"&&z!==b.disallowedLaneIndex;case"select_lane_to_shift_revealed_card_for_light_2":return O==="player";case"select_lane_to_shift_revealed_board_card_custom":{const q=b.revealedCardId;if(![...a.player.lanes.flat(),...a.opponent.lanes.flat()].find(L=>L.id===q))return!1;let D=null,T=-1;for(const L of["player","opponent"]){for(let B=0;B<a[L].lanes.length;B++)if(a[L].lanes[B].some(G=>G.id===q)){D=L,T=B;break}if(D)break}return O===D&&z!==T}case"select_lane_for_shift_all":{const q=b.sourceLaneIndex;return z!==q}case"select_lane_to_shift_cards_for_light_3":return z!==b.sourceLaneIndex;default:return!1}},U=(z,O,k)=>{let q=[z];return O&&q.push("compiled"),(_==null?void 0:_.type)==="compile"&&_.laneIndex===k&&q.push("is-compiling"),q.join(" ")},$=()=>j==="player"?"player-controlled":j==="opponent"?"opponent-controlled":"neutral",Z=()=>j==="player"?"Player has control.":j==="opponent"?"Opponent has control.":"Control is neutral.",ee=()=>j==="player"?"Control Player":j==="opponent"?"Control Opponent":"Control Neutral";return o.jsxs("div",{className:"game-board",children:[o.jsx("div",{className:"opponent-hand-area",children:g.hand.map(z=>o.jsx(xt,{card:z,isFaceUp:z.isRevealed||!1,additionalClassName:"in-hand",onPointerEnter:()=>f(z)},z.id))}),o.jsx("div",{className:`player-side opponent-side ${S==="opponent"?"active-turn":""}`,children:o.jsx("div",{className:"lanes",children:g.lanes.map((z,O)=>{const{isPlayable:k,isMatching:q}=R(O);return o.jsx(pm,{cards:z,isPlayable:k,isMatching:q,isCompilable:!1,isShiftTarget:I(O,"opponent"),isEffectTarget:A(O),onLanePointerDown:()=>t(O,"opponent"),onCardPointerDown:F=>c(F,"opponent",O),onCardPointerEnter:F=>i(F,"opponent"),onCardPointerLeave:()=>d(),owner:"opponent",animationState:_,isCardTargetable:F=>Sc(F,a),laneIndex:O,sourceCardId:h,gameState:a},`opp-lane-${O}`)})})}),o.jsxs("div",{className:"protocol-bars-container",children:[a.useControlMechanic&&o.jsxs("div",{className:"control-coin-container",children:[o.jsx("div",{className:`control-coin ${$()}`,title:Z(),children:"C"}),o.jsx("div",{className:`control-coin-label ${$()}`,children:ee()})]}),o.jsx("div",{className:`protocol-bar opponent-bar ${S==="opponent"?"active-turn":""}`,children:g.protocols.map((z,O)=>o.jsxs("div",{className:U("protocol-display",g.compiled[O],O),children:[o.jsx("span",{className:"protocol-name",children:z}),o.jsx("span",{className:"protocol-value",children:g.laneValues[O]})]},`opp-proto-${z}-${O}`))}),o.jsx("div",{className:`protocol-bar player-bar ${S==="player"?"active-turn":""}`,children:y.protocols.map((z,O)=>o.jsxs("div",{className:U("protocol-display",y.compiled[O],O),children:[o.jsx("span",{className:"protocol-name",children:z}),o.jsx("span",{className:"protocol-value",children:y.laneValues[O]})]},`player-proto-${z}-${O}`))})]}),o.jsx("div",{className:`player-side ${S==="player"?"active-turn":""}`,children:o.jsx("div",{className:"lanes",children:y.lanes.map((z,O)=>{const{isPlayable:k,isMatching:q,isCompilable:F}=C(O);return o.jsx(pm,{cards:z,isPlayable:k,isMatching:q,isCompilable:F,isShiftTarget:I(O,"player"),isEffectTarget:A(O),onLanePointerDown:()=>t(O,"player"),onPlayFaceDown:()=>l(O),onCardPointerDown:D=>c(D,"player",O),onCardPointerEnter:D=>i(D,"player"),onCardPointerLeave:()=>d(),owner:"player",animationState:_,isCardTargetable:D=>Sc(D,a),laneIndex:O,sourceCardId:h,gameState:a},`player-lane-${O}`)})})})]})},$w=({gameState:a,onFillHand:t,onSkipAction:l,onResolvePlague2Discard:c,onResolvePlague4Flip:i,onResolveFire3Prompt:d,onResolveOptionalDiscardCustomPrompt:f,onResolveOptionalEffectPrompt:p,onResolveFire4Discard:u,onResolveHate1Discard:h,onResolveRevealBoardCardPrompt:y,onResolveOptionalDrawPrompt:g,onResolveDeath1Prompt:_,onResolveLove1Prompt:x,onResolvePsychic4Prompt:S,onResolveSpirit1Prompt:E,onResolveControlMechanicPrompt:b,onResolveCustomChoice:j,selectedCardId:C,multiSelectedCardIds:R,actionRequiredClass:A})=>{const{phase:I,turn:U,actionRequired:$,player:Z,compilableLanes:ee}=a,z=L=>{for(const B of["player","opponent"])for(const G of a[B].lanes){const ae=G.find(M=>M.id===L);if(ae)return ae}return null},O=$==null?void 0:$.sourceCardId,k=O?z(O):null,q=($==null?void 0:$.actor)||U,F=q.charAt(0).toUpperCase()+q.slice(1),D=()=>{var L,B,G,ae;if(U!=="player"&&(!$||$.actor!=="player"))return o.jsx("button",{className:"btn",disabled:!0,children:"Processing..."});if(($==null?void 0:$.type)==="prompt_use_control_mechanic")return o.jsxs(o.Fragment,{children:[o.jsx("button",{className:"btn",onClick:()=>b("player"),children:"Rearrange Own"}),o.jsx("button",{className:"btn",onClick:()=>b("opponent"),children:"Rearrange Opponent's"}),o.jsx("button",{className:"btn btn-back",onClick:()=>b("skip"),children:"Skip"})]});if(($==null?void 0:$.type)==="prompt_optional_draw")return o.jsxs(o.Fragment,{children:[o.jsx("button",{className:"btn",onClick:()=>g(!0),children:"Draw"}),o.jsx("button",{className:"btn btn-back",onClick:()=>g(!1),children:"Skip"})]});if(($==null?void 0:$.type)==="prompt_death_1_effect")return o.jsxs(o.Fragment,{children:[o.jsx("button",{className:"btn",onClick:()=>_(!0),children:"Draw & Delete"}),o.jsx("button",{className:"btn btn-back",onClick:()=>_(!1),children:"Skip"})]});if(($==null?void 0:$.type)==="prompt_give_card_for_love_1")return o.jsxs(o.Fragment,{children:[o.jsx("button",{className:"btn",onClick:()=>x(!0),children:"Give 1 Card"}),o.jsx("button",{className:"btn btn-back",onClick:()=>x(!1),children:"Skip"})]});if(($==null?void 0:$.type)==="prompt_fire_3_discard")return o.jsxs(o.Fragment,{children:[o.jsx("button",{className:"btn",onClick:()=>d(!0),children:"Discard 1 Card"}),o.jsx("button",{className:"btn btn-back",onClick:()=>d(!1),children:"Skip"})]});if(($==null?void 0:$.type)==="prompt_optional_discard_custom")return o.jsxs(o.Fragment,{children:[o.jsxs("button",{className:"btn",onClick:()=>f(!0),children:["Discard ",$.count," Card(s)"]}),o.jsx("button",{className:"btn btn-back",onClick:()=>f(!1),children:"Skip"})]});if(($==null?void 0:$.type)==="prompt_optional_effect"){const M=((B=(L=$.effectDef)==null?void 0:L.params)==null?void 0:B.action)||"effect",W=(ae=(G=$.effectDef)==null?void 0:G.params)==null?void 0:ae.count,oe=W?`${M} ${W}`:M;return o.jsxs(o.Fragment,{children:[o.jsxs("button",{className:"btn",onClick:()=>p(!0),children:["Execute (",oe,")"]}),o.jsx("button",{className:"btn btn-back",onClick:()=>p(!1),children:"Skip"})]})}if(($==null?void 0:$.type)==="prompt_spirit_1_start")return o.jsxs(o.Fragment,{children:[o.jsx("button",{className:"btn",onClick:()=>E("discard"),children:"Discard 1"}),o.jsx("button",{className:"btn btn-back",onClick:()=>E("flip"),children:"Flip Card"})]});if(($==null?void 0:$.type)==="custom_choice"){const M=$.options||[];if(M.length===2){const W=M[0].params,oe=M[1].params,Q=V=>V.action==="discard"?`Discard ${V.count||1}`:V.action==="flip"&&V.flipSelf?"Flip This Card":V.action==="draw"?`Draw ${V.count||1}`:V.action==="delete"&&V.deleteSelf?"Delete This Card":V.action==="delete"?`Delete ${V.count||1}`:V.action==="return"?`Return ${V.count||1}`:V.action==="shift"?"Shift":V.action||"Option";return o.jsxs(o.Fragment,{children:[o.jsx("button",{className:"btn",onClick:()=>j(0),children:Q(W)}),o.jsx("button",{className:"btn btn-back",onClick:()=>j(1),children:Q(oe)})]})}}if(($==null?void 0:$.type)==="prompt_return_for_psychic_4")return o.jsxs(o.Fragment,{children:[o.jsx("button",{className:"btn",onClick:()=>S(!0),children:"Return Card"}),o.jsx("button",{className:"btn btn-back",onClick:()=>S(!1),children:"Skip"})]});if(($==null?void 0:$.type)==="prompt_shift_or_flip_board_card_custom")return o.jsxs(o.Fragment,{children:[o.jsx("button",{className:"btn",onClick:()=>y("shift"),children:"Shift"}),o.jsx("button",{className:"btn",onClick:()=>y("flip"),children:"Flip"}),o.jsx("button",{className:"btn btn-back",onClick:()=>y("skip"),children:"Skip"})]});if(($==null?void 0:$.type)==="discard"&&$.actor==="player"){const M=$.count,W=$.variableCount;if(M>1||W){const oe=W?1:M;return o.jsxs("button",{className:"btn",onClick:()=>u(R),disabled:R.length<oe,children:["Confirm Discard (",R.length,"/",W?"?":M,")"]})}}if(($==null?void 0:$.type)==="plague_2_player_discard"||($==null?void 0:$.type)==="select_cards_from_hand_to_discard_for_fire_4"||($==null?void 0:$.type)==="select_cards_from_hand_to_discard_for_hate_1"){let M,W=0;return $.type==="plague_2_player_discard"?(M=c,W=1):$.type==="select_cards_from_hand_to_discard_for_fire_4"?(M=u,W=1):(M=h,W=$.count),o.jsxs("button",{className:"btn",onClick:()=>M(R),disabled:R.length<W,children:["Confirm Discard (",R.length,")"]})}if(($==null?void 0:$.type)==="plague_4_player_flip_optional")return o.jsxs(o.Fragment,{children:[o.jsx("button",{className:"btn",onClick:()=>i(!0),children:"Flip Plague-4"}),o.jsx("button",{className:"btn btn-back",onClick:()=>i(!1),children:"Skip"})]});if($&&"optional"in $&&$.optional)return o.jsx("button",{className:"btn btn-back",onClick:l,children:"Skip Action"});if($)return o.jsx("button",{className:"btn",disabled:!0,children:"Action Required"});if(I==="compile"&&ee.length>0)return o.jsx("button",{className:"btn",disabled:!0,children:"Select Lane to Compile"});if(I==="action"){const M=Z.hand.length<5,W=Z.hand.length===0,oe=Zd(a,"player"),Q=M&&oe.allowed;return W?o.jsx("button",{className:"btn",onClick:t,disabled:!oe.allowed,title:oe.allowed?void 0:oe.reason,children:"Refresh (Required)"}):o.jsx("button",{className:"btn",onClick:t,disabled:!Q||!!C,title:oe.allowed?void 0:oe.reason,children:"Refresh"})}return o.jsx("button",{className:"btn",disabled:!0,children:"Processing..."})},T=()=>{var L,B,G,ae;if($)switch($.type){case"discard":return $.actor==="player"?$.variableCount?"Action: Select 1 or more cards to discard":$.count>1?`Action: Select ${$.count} cards to discard, then confirm`:`Action: Discard ${$.count} card from your hand`:"Waiting for Opponent to discard...";case"prompt_use_control_mechanic":return"Control Action: Rearrange protocols?";case"select_opponent_face_up_card_to_flip":return"Action: Select an opponent's face-up card to flip";case"select_own_face_up_covered_card_to_flip":return"Action: Select one of your face-up, covered cards to flip";case"select_opponent_covered_card_to_shift":return"Action: Select one of your opponent's covered cards to shift";case"select_own_covered_card_to_shift":return"Action: Select one of your covered cards to shift";case"select_lane_for_shift":return"Action: Select a new lane for the card";case"select_lane_for_shift_all":return"Action: Select a lane to shift all cards to";case"select_opponent_card_to_flip":return"Action: Select an opponent's card to flip";case"select_card_to_flip":{const M=$.targetFilter||{},W=M.owner||"any",oe=M.faceState||"any",Q=M.position||"uncovered";let V="Action: Flip ";return W==="own"?V+="one of your ":W==="opponent"?V+="an opponent's ":V+="a ",oe==="face_down"?V+="face-down ":oe==="face_up"&&(V+="face-up "),Q==="covered"?V+="covered ":Q==="uncovered"&&(V+="uncovered "),V+="card",V}case"shift_flipped_card_optional":return"Action: You may shift the card you just flipped. Select a lane or skip.";case"select_covered_card_in_line_to_flip_optional":return"Action: You may flip one of your covered cards in this lane. Select a card or skip.";case"select_card_from_hand_to_play":{const M=$.valueFilter;return M!==void 0?`Action: Select a card with value ${M} from your hand to play`:"Action: Select a card from your hand to play"}case"select_lane_for_play":return"Action: Select another lane to play your card in";case"select_face_down_card_to_shift_for_darkness_4":return"Action: Select any face-down card to shift";case"select_cards_to_delete":return`Action: Select a card to delete (${$.count} remaining)`;case"select_face_down_card_to_delete":return"Action: Select a face-down card to delete";case"select_low_value_card_to_delete":return"Action: Select a card with value 0 or 1 to delete";case"select_card_from_other_lanes_to_delete":return`Action: Select a card to delete (${$.count} remaining)`;case"select_lane_for_death_2":return"Action: Select a lane to delete cards with value 1 or 2";case"select_lane_for_delete":return"Action: Select a lane";case"prompt_optional_draw":return"Optional: Draw card(s)?";case"prompt_death_1_effect":return"Start Phase: Use Death-1 effect?";case"select_card_to_delete_for_death_1":return"Action: Select a card to delete";case"delete_self":return"Deleting card...";case"prompt_give_card_for_love_1":return"End Phase: Give 1 card to draw 2?";case"select_card_from_hand_to_give":return"Action: Select a card from your hand to give";case"select_card_from_hand_to_reveal":return"Action: Select a card from your hand to reveal";case"plague_2_player_discard":return"Action: Select 1 or more cards to discard";case"plague_4_opponent_delete":return"Waiting for opponent to delete one of their face-down cards";case"plague_4_player_flip_optional":return"Action: You may flip Plague-4";case"select_any_other_card_to_flip":return"Action: Select any other card to flip";case"select_card_to_return":{const M=$.targetFilter||{},W=$.targetOwner||M.owner||"any",oe=M.position||"uncovered";let Q="Action: Select ";return W==="own"?Q+="one of your ":W==="opponent"?Q+="an opponent's ":Q+="a ",oe==="any"?Q+="covered or uncovered ":oe==="covered"&&(Q+="covered "),Q+="card to return",Q}case"select_covered_card_to_flip_for_chaos_0":return"Action: Select a covered card to flip in this lane";case"prompt_fire_3_discard":return"End Phase: Discard 1 card to flip 1 card?";case"prompt_optional_discard_custom":return`Optional: Discard ${$.count} card(s) to continue?`;case"prompt_optional_effect":{const M=((B=(L=$.effectDef)==null?void 0:L.params)==null?void 0:B.action)||"effect",W=(ae=(G=$.effectDef)==null?void 0:G.params)==null?void 0:ae.count;return`Do you want to ${M==="shift"?"shift a card":M==="flip"?"flip a card":M==="draw"?`draw ${W||1} card(s)`:M==="discard"?`discard ${W||1} card(s)`:M==="delete"?"delete a card":M==="return"?"return a card":`execute ${M}${W?` ${W}`:""}`}?`}case"select_card_to_flip_for_fire_3":return"Action: Select a card to flip";case"select_own_other_card_to_shift":return"Action: Select one of your cards to shift";case"select_opponent_face_down_card_to_shift":return"Action: Select an opponent's face-down card to shift";case"prompt_spirit_1_start":return"Start Phase: Discard 1 card or flip Spirit-1?";case"select_any_card_to_flip_optional":return"Action: You may flip one card. Select a card or skip.";case"prompt_swap_protocols":return"Action: Swap two protocols.";case"select_cards_from_hand_to_discard_for_fire_4":return"Action: Select 1 or more cards to discard";case"select_cards_from_hand_to_discard_for_hate_1":return`Action: Select ${$.count} card(s) to discard for Hate-1`;case"select_any_card_to_flip":return`Action: Select a card to flip (${$.count} remaining)`;case"select_any_face_down_card_to_flip_optional":return"Action: You may flip a face-down card. Select a card or skip.";case"select_lane_for_life_3_play":return"Action: Select another lane to play a card into";case"select_card_to_flip_for_light_0":return"Action: Select any card to flip";case"prompt_shift_or_flip_board_card_custom":return"Action: Choose to shift, flip, or skip";case"select_board_card_to_reveal_custom":return"Action: Select a face-down card to reveal";case"select_lane_to_shift_revealed_card_for_light_2":return"Action: Select a lane to shift the revealed card to";case"select_lane_to_shift_revealed_board_card_custom":return"Action: Select a lane to shift the revealed card to";case"select_lane_to_shift_cards_for_light_3":return"Action: Select a lane to shift all face-down cards to";case"select_lane_for_metal_3_delete":return"Action: Select a lane with 8+ cards to delete";case"select_lane_for_delete_all":return"Action: Select a lane to delete all cards";case"select_lanes_for_swap_stacks":{const M=$.selectedFirstLane;return M===void 0?"Action: Select the first lane to swap":`Action: Select the second lane to swap with lane ${M+1}`}case"select_any_other_card_to_flip_for_water_0":return"Action: Select any other card to flip";case"prompt_rearrange_protocols":return"Action: Rearrange protocols";case"select_lane_for_water_3":return"Action: Select a lane to return cards from";case"select_own_card_to_return_for_water_4":return"Action: Select one of your cards to return to your hand";case"prompt_return_for_psychic_4":return"End Phase: Return an opponent's card?";case"select_any_opponent_card_to_shift":return"Action: Select an opponent's card to shift";case"select_card_to_shift":{const M=$.targetFilter||{},W=M.owner||"any",oe=M.faceState||"any",Q=M.position||"uncovered";let V="Action: Select ";return W==="own"?V+="one of your ":W==="opponent"?V+="an opponent's ":V+="a ",oe==="face_down"?V+="face-down ":oe==="face_up"&&(V+="face-up "),Q==="covered"?V+="covered ":Q==="uncovered"&&(V+="uncovered "),V+="card to shift",V}case"select_opponent_card_to_return":return"Action: Select an opponent's card to return";case"select_own_highest_card_to_delete_for_hate_2":return"Action: Select your highest value uncovered card to delete";case"select_opponent_highest_card_to_delete_for_hate_2":return"Action: Select opponent's highest value uncovered card to delete";case"custom_choice":{const M=$.options||[];if(M.length===2){const W=M[0].params,oe=M[1].params,Q=V=>V.action==="discard"?`you discard ${V.count||1} card${V.count!==1?"s":""}`:V.action==="flip"&&V.flipSelf?"flip this card":V.action==="draw"?`draw ${V.count||1} card${V.count!==1?"s":""}`:V.action==="delete"&&V.deleteSelf?"delete this card":V.action==="delete"?`delete ${V.count||1} card${V.count!==1?"s":""}`:V.action==="return"?`return ${V.count||1} card${V.count!==1?"s":""}`:V.action==="shift"?"shift a card":V.action||"option";return`Either ${Q(W)} or ${Q(oe)}.`}return"Action: Make a choice"}case"select_card_from_revealed_deck":return`Action: Select a card with value ${$.valueFilter} from your revealed deck`;case"select_phase_effect":{const M=$,W=M.availableEffects.map(oe=>oe.cardName).join(", ");return`${M.phase} Phase: Choose which effect to resolve first (${W})`}case"select_card_from_trash_to_play":{const M=$.trashOwner||"own";return`Action: Select a card from ${M==="opponent"?"opponent's":M==="any"?"any player's":"your"} trash to play`}case"select_card_from_trash_to_reveal":{const M=$.trashOwner||"own";return`Action: Select a card from ${M==="opponent"?"opponent's":M==="any"?"any player's":"your"} trash to reveal`}default:return"Action Required"}return I==="compile"&&ee.length>0?"Phase: Compile":`Phase: ${I.replace("_"," ")}`};return o.jsxs("div",{className:`phase-controller ${A}`,children:[o.jsxs("div",{className:"effect-source-info",children:[o.jsxs("span",{children:[F,"'s Turn"]}),$&&k&&o.jsxs(o.Fragment,{children:[" | Effect from: ",o.jsxs("span",{children:[k.protocol,"-",k.value]})]}),($==null?void 0:$.sourceCardId)==="CONTROL_MECHANIC"&&o.jsxs(o.Fragment,{children:[" | Effect from: ",o.jsx("span",{children:"Control Component"})]})]}),o.jsxs("div",{className:"phase-controller-main",children:[o.jsx("div",{className:"phase-info",children:T()}),o.jsx("div",{className:"phase-actions",children:D()})]})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Iw={start:"Start",control:"Control",action:"Action",compile:"Compile",hand_limit:"Hand Limit",end:"End"},Lw=({gameState:a,turn:t,animationState:l,difficulty:c,onPlayerClick:i,onOpponentClick:d})=>{const{player:f,opponent:p}=a,u=y=>{const g=["info-section"];return g.push(y==="player"?"player-info":"opponent-info"),t===y&&g.push("active-turn"),(l==null?void 0:l.type)==="drawCard"&&l.owner===y&&g.push("is-drawing"),(l==null?void 0:l.type)==="discardCard"&&l.owner===y&&g.push("is-discarding"),g.join(" ")},h=y=>{const g=y==="player"?f:p,_=y==="player"?i:d,x=y==="player"?"Player":`Opponent${c?` (${c.charAt(0).toUpperCase()+c.slice(1)})`:""}`,S=t===y;return o.jsx("div",{className:u(y),onClick:_,children:o.jsxs("div",{className:"info-section-body",children:[o.jsx("h3",{children:x}),S&&o.jsx("span",{className:"phase-badge",children:Iw[a.phase]}),o.jsxs("div",{className:"info-line",children:[o.jsx("span",{children:"Hand:"}),o.jsx("span",{children:g.hand.length})]}),o.jsxs("div",{className:"info-line",children:[o.jsx("span",{children:"Deck:"}),o.jsx("span",{children:g.deck.length})]}),o.jsxs("div",{className:"info-line",children:[o.jsx("span",{children:"Trash:"}),o.jsx("span",{children:g.discard.length})]})]})})};return o.jsxs("div",{className:"game-info-panel",children:[h("opponent"),h("player")]})},Pw=/\b([A-Z][a-z]+(?:_custom)?)-(\d)\b/g;function mc(a,t){return{...a,id:`preview-${a.protocol}-${a.value}`,isFaceUp:t}}function Pm(a){const t=a.match(/^([A-Z][a-z]+(?:_custom)?)-(\d)$/);return t?{protocol:t[1],value:parseInt(t[2],10)}:null}function Um(a){const t=[];let l;const c=new RegExp(Pw);for(;(l=c.exec(a))!==null;)t.push({protocol:l[1],value:parseInt(l[2],10)});return t}function fm(a,t){if(a.sourceCardRef||a.targetCardRefs&&a.targetCardRefs.length>0)return!0;if(a.sourceCard){const c=Pm(a.sourceCard);if(c&&t.some(i=>i.protocol===c.protocol&&i.value===c.value))return!0}const l=Um(a.message);return!!(l.length>0&&l.some(c=>t.some(i=>i.protocol===c.protocol&&i.value===c.value)))}function Uw(a,t){const l={source:null,targets:[]};if(a.sourceCardRef){const c=t.find(i=>i.protocol===a.sourceCardRef.protocol&&i.value===a.sourceCardRef.value);c&&(l.source=mc(c,a.sourceCardRef.isFaceUp))}if(a.targetCardRefs&&a.targetCardRefs.length>0)for(const c of a.targetCardRefs){const i=t.find(d=>d.protocol===c.protocol&&d.value===c.value);i&&l.targets.push(mc(i,c.isFaceUp))}if(!l.source&&l.targets.length===0){if(a.sourceCard){const i=Pm(a.sourceCard);if(i){const d=t.find(f=>f.protocol===i.protocol&&f.value===i.value);d&&(l.source=mc(d,!0))}}const c=Um(a.message);for(const i of c){const d=t.find(f=>f.protocol===i.protocol&&f.value===i.value);if(d){const f=mc(d,!0);l.source?(l.source.protocol!==i.protocol||l.source.value!==i.value)&&l.targets.push(f):l.source=f}}}return l}function Ow({log:a,onClose:t}){const[l,c]=le.useState(null),[i,d]=le.useState(0),f=le.useMemo(()=>{const y=Po();return[...Ln,...y]},[]),p=y=>{let g="";if(y.phase){const _=y.phase.charAt(0).toUpperCase()+y.phase.slice(1);g+=`[${_}] `}return y.sourceCard&&!y.message.startsWith(y.sourceCard)&&(g+=`${y.sourceCard}: `),`${g}${y.message}`},u=le.useMemo(()=>{if(l===null)return null;const y=a[l];return y?Uw(y,f):null},[l,a,f]),h=(y,g)=>{fm(g,f)&&(l===y?u&&u.targets.length>1?d(_=>(_+1)%u.targets.length):(c(null),d(0)):(c(y),d(0)))};return o.jsx("div",{className:"modal-overlay",onClick:t,children:o.jsxs("div",{className:"modal-content log-modal-content log-modal-with-preview",onClick:y=>y.stopPropagation(),children:[o.jsx("button",{className:"btn btn-back modal-close-btn",onClick:t,children:"X"}),o.jsx("h2",{children:"Game Log"}),o.jsxs("div",{className:"log-content-wrapper",children:[o.jsx("div",{className:"log-preview-area log-preview-left",children:(u==null?void 0:u.source)&&o.jsx("div",{className:"log-preview-card",children:o.jsx(xt,{card:u.source,isFaceUp:u.source.isFaceUp})})}),o.jsx("ol",{className:"log-list",children:a.map((y,g)=>{const _=y.indentLevel!==void 0,x=_?{paddingLeft:`${y.indentLevel*20+40}px`}:{};_&&y.indentLevel===0&&(x.fontWeight="bold");const S=fm(y,f),E=l===g;return o.jsx("li",{className:`log-entry log-entry-${y.player}${S?" log-entry-clickable":""}${E?" log-entry-selected":""}`,style:x,onClick:()=>h(g,y),children:p(y)},g)})}),o.jsx("div",{className:"log-preview-area log-preview-right",children:(u==null?void 0:u.targets)&&u.targets.length>0&&o.jsxs("div",{className:"log-preview-card",children:[o.jsx(xt,{card:u.targets[i],isFaceUp:u.targets[i].isFaceUp}),u.targets.length>1&&o.jsxs("div",{className:"log-preview-counter",children:[i+1," / ",u.targets.length]})]})})]})]})})}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Mw=({message:a,player:t})=>o.jsx("div",{className:`toaster toaster-${t}`,children:a});function Hw({gameState:a,targetPlayer:t,onConfirm:l}){var L;const[c]=le.useState([...a[t].protocols]),[i,d]=le.useState([...a[t].protocols]),[f,p]=le.useState([0,1,2]),u=le.useRef(null),h=le.useRef(null),y=le.useRef(0),g=le.useRef(null),_=le.useRef(0),x=((L=a.actionRequired)==null?void 0:L.type)==="prompt_rearrange_protocols"?a.actionRequired.disallowedProtocolForLane:void 0,S=le.useMemo(()=>{if(i.length!==c.length)return!1;for(let B=0;B<i.length;B++)if(i[B]!==c[B])return!0;return!1},[i,c]),E=le.useMemo(()=>{if(!x)return console.log("[RearrangeModal] No disallowedProtocolForLane set"),!1;const{laneIndex:B,protocol:G}=x,ae=i[B],M=ae===G;return console.log("[RearrangeModal] Checking violation:",{disallowedProtocol:G,disallowedLaneIndex:B,currentProtocolAtLane:ae,protocols:i,hasViolation:M}),M},[i,x]),b=a[t],C=a[t==="player"?"opponent":"player"],R=b.laneValues,A=b.compiled,I=(B,G)=>{let ae=[B];return G&&ae.push("compiled"),ae.join(" ")},U=(B,G)=>{u.current=G,B.dataTransfer.effectAllowed="move"},$=(B,G)=>{B.preventDefault(),h.current=G},Z=()=>{if(u.current!==null&&h.current!==null&&u.current!==h.current){const B=[...i],G=[...f],ae=B[u.current];B[u.current]=B[h.current],B[h.current]=ae;const M=G[u.current];G[u.current]=G[h.current],G[h.current]=M,u.current=null,h.current=null,d(B),p(G)}},ee=B=>{B.preventDefault()},z=(B,G)=>{g.current=G,y.current=B.touches[0].clientY,_.current=B.touches[0].clientY},O=B=>{var M;if(g.current===null)return;_.current=B.touches[0].clientY;const G=B.touches[0],ae=document.elementFromPoint(G.clientX,G.clientY);if(ae){const W=ae.closest(".rearrange-item");if(W){const Q=Array.from(((M=W.parentElement)==null?void 0:M.children)||[]).indexOf(W);Q!==-1&&Q!==g.current&&(h.current=Q)}}},k=()=>{if(g.current!==null&&h.current!==null&&g.current!==h.current){const B=[...i],G=[...f],ae=B[g.current];B[g.current]=B[h.current],B[h.current]=ae;const M=G[g.current];G[g.current]=G[h.current],G[h.current]=M,d(B),p(G)}g.current=null,h.current=null,y.current=0,_.current=0},q=t==="player",F=q?"Rearrange Your Protocols":"Rearrange Opponent's Protocols",D=o.jsx("div",{className:`protocol-bar ${q?"player-bar":"opponent-bar"} rearrange-editable`,onDragOver:ee,children:i.map((B,G)=>{const ae=B!==c[G],M=x&&x.laneIndex===G&&B===x.protocol,W=f[G],oe=A[W],Q=I("protocol-display rearrange-item",oe);return o.jsxs("div",{className:`${Q} ${ae?"changed":""} ${M?"violation":""}`,draggable:!0,onDragStart:V=>U(V,G),onDragEnter:V=>$(V,G),onDragEnd:Z,onTouchStart:V=>z(V,G),onTouchMove:O,onTouchEnd:k,children:[o.jsx("span",{className:"protocol-name",children:B}),o.jsx("span",{className:"protocol-value",children:R[G]})]},`${B}-${G}`)})}),T=o.jsx("div",{className:`protocol-bar ${q?"opponent-bar":"player-bar"}`,children:C.protocols.map((B,G)=>o.jsxs("div",{className:I("protocol-display",C.compiled[G]),children:[o.jsx("span",{className:"protocol-name",children:B}),o.jsx("span",{className:"protocol-value",children:C.laneValues[G]})]},`other-proto-${B}-${G}`))});return o.jsx("div",{className:"modal-overlay",children:o.jsxs("div",{className:"modal-content rearrange-modal-content",onClick:B=>B.stopPropagation(),children:[o.jsx("h2",{children:F}),o.jsx("p",{children:"Drag and drop the protocols to reorder them. You must change the order to continue."}),x&&o.jsxs("p",{className:"warning-text",children:[" ",o.jsx("strong",{children:x.protocol})," cannot be placed on line ",o.jsx("strong",{children:x.laneIndex})," due to Anarchy-3's restriction."]}),o.jsx("div",{className:"rearrange-board-view",children:o.jsxs("div",{className:"protocol-bars-container",children:[q?T:D,q?D:T]})}),o.jsxs("div",{className:"rearrange-actions",children:[o.jsx("button",{className:"btn",onClick:()=>l(i),disabled:!S||E,children:"Confirm Rearrangement"}),E&&o.jsxs("p",{className:"error-text",children:["Cannot confirm: ",x.protocol," is on line ",x.laneIndex]})]})]})})}function zw({gameState:a,targetPlayer:t,onConfirm:l}){const[c,i]=le.useState([]),d=a[t],f=t==="player",p=f?"Swap Your Protocols":"Swap Opponent's Protocols",u=g=>{c.includes(g)?i(_=>_.filter(x=>x!==g)):c.length<2&&i(_=>[..._,g])},h=()=>{c.length===2&&l(c)},y=g=>{let _=["protocol-display","rearrange-item"];return d.compiled[g]&&_.push("compiled"),c.includes(g)&&_.push("selected"),_.join(" ")};return o.jsx("div",{className:"modal-overlay",children:o.jsxs("div",{className:"modal-content rearrange-modal-content",onClick:g=>g.stopPropagation(),children:[o.jsx("h2",{children:p}),o.jsx("p",{children:"Select two protocols to swap their positions. This action is mandatory."}),o.jsx("div",{className:"rearrange-board-view",children:o.jsx("div",{className:"protocol-bars-container",children:o.jsx("div",{className:`protocol-bar ${f?"player-bar":"opponent-bar"}`,children:d.protocols.map((g,_)=>o.jsxs("div",{className:y(_),onClick:()=>u(_),children:[o.jsx("span",{className:"protocol-name",children:g}),o.jsx("span",{className:"protocol-value",children:d.laneValues[_]})]},g))})})}),o.jsx("div",{className:"rearrange-actions",children:o.jsx("button",{className:"btn",onClick:h,disabled:c.length!==2,children:"Confirm Swap"})})]})})}function Vw({gameState:a,onConfirm:t}){const[l,c]=le.useState(null),i=p=>{c(p)},d=()=>{l!==null&&t(l)},f=p=>{let u=["number-button"];return l===p&&u.push("selected"),u.join(" ")};return o.jsx("div",{className:"modal-overlay",children:o.jsxs("div",{className:"modal-content state-number-modal",onClick:p=>p.stopPropagation(),children:[o.jsx("h2",{children:"State a Number"}),o.jsx("p",{children:"Choose a number (0-5) to state. Cards drawn with this value may be revealed and played."}),o.jsx("div",{className:"number-selection",children:[0,1,2,3,4,5].map(p=>o.jsx("button",{className:f(p),onClick:()=>i(p),children:p},p))}),o.jsx("div",{className:"modal-actions",children:o.jsx("button",{className:"btn",onClick:d,disabled:l===null,children:"Confirm"})})]})})}function Bw({gameState:a,availableProtocols:t,onConfirm:l}){const[c,i]=le.useState(null),d=u=>{i(u)},f=()=>{c!==null&&l(c)},p=u=>{let h=["protocol-button"];return c===u&&h.push("selected"),h.join(" ")};return o.jsx("div",{className:"modal-overlay",children:o.jsxs("div",{className:"modal-content state-protocol-modal",onClick:u=>u.stopPropagation(),children:[o.jsx("h2",{children:"State a Protocol"}),o.jsx("p",{children:"Choose a protocol from your opponent's cards. If the discarded card matches, you'll delete a card."}),o.jsx("div",{className:"protocol-selection",children:t.map(u=>o.jsx("button",{className:p(u),onClick:()=>d(u),children:u},u))}),o.jsx("div",{className:"modal-actions",children:o.jsx("button",{className:"btn",onClick:f,disabled:c===null,children:"Confirm"})})]})})}function Yw({gameState:a,allDrawnCardIds:t,eligibleCardIds:l,statedNumber:c,revealCount:i=1,onConfirm:d,onClose:f}){const[p,u]=le.useState(null),h=le.useRef(!1),y=a.player.hand.filter(j=>t.includes(j.id)),g=j=>l.includes(j),_=l.length>0;le.useEffect(()=>{if(!h.current&&l.length>0){const j=y.find(C=>g(C.id));j&&(u(j),h.current=!0)}},[y,l]);const x=j=>{g(j.id)&&u(j)},S=j=>{g(j.id)&&u(j)},E=()=>{p&&g(p.id)&&d(p.id)},b=()=>{f&&f()};return o.jsx("div",{className:"modal-overlay",children:o.jsxs("div",{className:"modal-content revealed-deck-modal",onClick:j=>j.stopPropagation(),children:[o.jsx("h2",{children:"Cards Drawn"}),c!==void 0?o.jsxs("p",{children:["Select a card with value ",o.jsx("strong",{children:c})," to reveal:"]}):o.jsx("p",{children:"Select a card to reveal:"}),o.jsxs("div",{className:"revealed-deck-content-wrapper",children:[o.jsx("div",{className:"revealed-deck-preview-area",children:p?o.jsxs("div",{className:"revealed-deck-preview-card",children:[o.jsx(xt,{card:p,isFaceUp:!0}),o.jsxs("button",{className:"btn preview-confirm-btn",onClick:E,children:["Reveal ",p.protocol,"-",p.value]})]}):o.jsx("div",{className:"revealed-deck-preview-card no-selection",children:o.jsx("p",{className:"no-match-message",children:_?"Select an eligible card":`No cards match value ${c}`})})}),o.jsx("div",{className:"revealed-deck-grids-area",children:o.jsx("div",{className:"revealed-deck-card-grid",children:y.length>0?y.map(j=>{const C=g(j.id),R=(p==null?void 0:p.id)===j.id;return o.jsx("div",{onClick:A=>{A.stopPropagation(),S(j)},onMouseEnter:()=>x(j),style:{cursor:C?"pointer":"default"},children:o.jsx(xt,{card:j,isFaceUp:!0,additionalClassName:`in-hand ${C?R?"highlight-selectable":"":"dimmed"}`})},j.id)}):o.jsx("p",{className:"no-cards",children:"No cards drawn."})})})]}),!_&&o.jsx("div",{className:"modal-actions",children:o.jsx("button",{className:"btn",onClick:b,children:"Continue"})})]})})}function Gw({gameState:a,onSelectCard:t}){var R;const[l,c]=le.useState(null),[i,d]=le.useState(null),f=le.useRef(!1),p=i||l,u=a.actionRequired,h=u==null?void 0:u.revealedCards,y=u==null?void 0:u.selectableCardIds,g=h||(u!=null&&u.actor?(R=a[u.actor])==null?void 0:R.deck:[])||[],_=le.useMemo(()=>g.map((A,I)=>({...A,id:A.id||`deck-${I}`,isFaceUp:!0})),[g]);if(le.useEffect(()=>{if((u==null?void 0:u.type)==="select_card_from_revealed_deck"&&(y==null?void 0:y.length)>0&&!f.current){const A=_.find(I=>y.includes(I.id));A&&(c(A),f.current=!0)}},[u==null?void 0:u.type,y,_]),le.useEffect(()=>{(!u||u.type!=="select_card_from_revealed_deck")&&(f.current=!1,c(null),d(null))},[u]),!u||u.type!=="select_card_from_revealed_deck")return null;const{valueFilter:x}=u,S=A=>y==null?void 0:y.includes(A),E=A=>{S(A.id)&&d(A)},b=()=>{d(null)},j=A=>{S(A.id)&&c(A)},C=()=>{p&&S(p.id)&&t(p.id)};return o.jsx("div",{className:"modal-overlay",children:o.jsxs("div",{className:"modal-content revealed-deck-modal",onClick:A=>A.stopPropagation(),children:[o.jsx("h2",{children:"Your Revealed Deck"}),o.jsxs("p",{children:["Select a card with value ",x," to draw:"]}),o.jsxs("div",{className:"revealed-deck-content-wrapper",children:[o.jsx("div",{className:"revealed-deck-preview-area",children:p&&o.jsxs("div",{className:"revealed-deck-preview-card",children:[o.jsx(xt,{card:p,isFaceUp:!0}),o.jsxs("button",{className:"btn preview-confirm-btn",onClick:C,children:["Draw ",p.protocol,"-",p.value]})]})}),o.jsx("div",{className:"revealed-deck-grids-area",children:o.jsx("div",{className:"revealed-deck-card-grid",children:_.length>0?_.map(A=>{const I=S(A.id),U=(l==null?void 0:l.id)===A.id,Z=(i==null?void 0:i.id)===A.id||U;return o.jsx("div",{onClick:ee=>{ee.stopPropagation(),j(A)},onMouseEnter:()=>E(A),onMouseLeave:b,style:{cursor:I?"pointer":"default"},children:o.jsx(xt,{card:A,isFaceUp:!0,additionalClassName:`in-hand ${I?Z?"highlight-selectable":"":"dimmed"} ${U?"selected-card":""}`})},A.id)}):o.jsx("p",{className:"no-cards",children:"No cards in deck."})})})]})]})})}function Ww({gameState:a,onAccept:t,onDecline:l}){var g,_;const c=a.actionRequired;if(!c||c.type!=="prompt_optional_effect")return null;const i=c.effectDef;if(!i||((g=i.params)==null?void 0:g.action)!=="discard"||!((_=i.params)!=null&&_.useCardFromPreviousEffect))return null;const d=a.lastCustomEffectTargetCardId;if(!d)return null;const f=c.actor||"player",u=a[f].deck.find(x=>x.id===d);if(!u)return null;const h={...u,id:u.id||"revealed-top",isFaceUp:!0},y=`${u.protocol}-${u.value}`;return o.jsx("div",{className:"modal-overlay",children:o.jsxs("div",{className:"modal-content revealed-deck-top-modal",onClick:x=>x.stopPropagation(),children:[o.jsx("h2",{children:"Revealed: Top Card of Your Deck"}),o.jsx("p",{children:"You may discard this card:"}),o.jsx("div",{className:"revealed-card-display",children:o.jsx(xt,{card:h,isFaceUp:!0})}),o.jsxs("div",{className:"revealed-deck-top-actions",children:[o.jsxs("button",{className:"btn",onClick:t,children:["Discard ",y]}),o.jsx("button",{className:"btn btn-back",onClick:l,children:"Keep in Deck"})]})]})})}function Qw({discardedCard:a,deckOwner:t,onConfirm:l}){const c=t==="own"?"your":"opponent's",i={...a,id:a.id||"deck-discard-preview",isFaceUp:!0};return o.jsx("div",{className:"modal-overlay",children:o.jsxs("div",{className:"modal-content deck-discard-modal",onClick:d=>d.stopPropagation(),children:[o.jsx("h2",{children:"Card Discarded"}),o.jsxs("p",{children:["From the top of ",o.jsx("strong",{children:c})," deck:"]}),o.jsx("div",{className:"deck-discard-preview-content",children:o.jsx("div",{className:"deck-discard-preview-card",children:o.jsx(xt,{card:i,isFaceUp:!0})})}),o.jsx("div",{className:"modal-actions",children:o.jsx("button",{className:"btn",onClick:l,children:"Continue"})})]})})}function Xw({card:a,isFaceDown:t,onConfirm:l}){const c=t?"face-down":"face-up";return o.jsx("div",{className:"modal-overlay",children:o.jsxs("div",{className:"modal-content deck-play-preview-modal",onClick:i=>i.stopPropagation(),children:[o.jsx("h2",{children:"Card from Deck"}),o.jsxs("p",{children:["You will play this card ",o.jsx("strong",{children:c}),":"]}),o.jsx("div",{className:"deck-play-preview-content",children:o.jsx("div",{className:"deck-play-preview-card",children:o.jsx(xt,{card:a,isFaceUp:!0})})}),o.jsx("div",{className:"modal-actions",children:o.jsx("button",{className:"btn",onClick:l,children:"Select Lane"})})]})})}function hm({gameState:a,onSelectCard:t}){var O,k,q,F;const[l,c]=le.useState(null),[i,d]=le.useState(null),[f,p]=le.useState(null),[u,h]=le.useState(null),y=le.useRef(!1),g=f||l,_=u!==null?u:i,x=a.actionRequired,S=x==null?void 0:x.actor,E=(x==null?void 0:x.trashOwner)||"own";let b=[];E==="own"?b=S?((O=a[S])==null?void 0:O.discard)||[]:[]:E==="opponent"?b=((k=a[S==="player"?"opponent":"player"])==null?void 0:k.discard)||[]:E==="any"&&(b=[...((q=a.player)==null?void 0:q.discard)||[],...((F=a.opponent)==null?void 0:F.discard)||[]]);const j=le.useMemo(()=>(b||[]).map((D,T)=>({...D,id:D.id||`trash-${T}`,isFaceUp:!0,_trashIndex:T})),[b]);le.useEffect(()=>{((x==null?void 0:x.type)==="select_card_from_trash_to_play"||(x==null?void 0:x.type)==="select_card_from_trash_to_reveal")&&j.length>0&&!y.current&&(c(j[0]),d(0),y.current=!0)},[x==null?void 0:x.type,j]),le.useEffect(()=>{const D=(x==null?void 0:x.type)==="select_card_from_trash_to_play"||(x==null?void 0:x.type)==="select_card_from_trash_to_reveal";(!x||!D)&&(y.current=!1,c(null),d(null),p(null),h(null))},[x]);const C=(x==null?void 0:x.type)==="select_card_from_trash_to_play"||(x==null?void 0:x.type)==="select_card_from_trash_to_reveal";if(!x||!C)return null;const R=x.type==="select_card_from_trash_to_play",A=R?"Select Card to Play":"Select Card to Reveal",I=E==="opponent"?"opponent's":E==="any"?"any player's":"your",U=R?`Select a card from ${I} trash to play:`:`Select a card from ${I} trash to reveal:`,$=(D,T)=>{p(D),h(T)},Z=()=>{p(null),h(null)},ee=(D,T)=>{c(D),d(T)},z=()=>{g&&_!==null&&t(_)};return o.jsx("div",{className:"modal-overlay",children:o.jsxs("div",{className:"modal-content revealed-deck-modal",onClick:D=>D.stopPropagation(),children:[o.jsx("h2",{children:A}),o.jsx("p",{children:U}),o.jsxs("div",{className:"revealed-deck-content-wrapper",children:[o.jsx("div",{className:"revealed-deck-preview-area",children:g&&o.jsxs("div",{className:"revealed-deck-preview-card",children:[o.jsx(xt,{card:g,isFaceUp:!0}),o.jsxs("button",{className:"btn preview-confirm-btn",onClick:z,children:[R?"Play":"Reveal"," ",g.protocol,"-",g.value]})]})}),o.jsx("div",{className:"revealed-deck-grids-area",children:o.jsx("div",{className:"revealed-deck-card-grid",children:j.length>0?j.map((D,T)=>{const L=i===T,G=u===T||L;return o.jsx("div",{onClick:ae=>{ae.stopPropagation(),ee(D,T)},onMouseEnter:()=>$(D,T),onMouseLeave:Z,style:{cursor:"pointer"},children:o.jsx(xt,{card:D,isFaceUp:!0,additionalClassName:`in-hand ${G?"highlight-selectable":""} ${L?"selected-card":""}`})},D.id)}):o.jsx("p",{className:"no-cards",children:"No cards in trash."})})})]})]})})}function Zw({player:a,playerState:t,onClose:l,difficulty:c}){const i=a==="player"?"Player":`Opponent${c?` (${c.charAt(0).toUpperCase()+c.slice(1)})`:""}`,[d,f]=le.useState(null),p=h=>{f(h)},u=(h,y,g)=>{const _=h.map((x,S)=>({...x,id:`${y}-${x.protocol}-${x.value}-${S}`,isFaceUp:g}));return o.jsxs(o.Fragment,{children:[o.jsxs("h3",{children:[y," (",_.length,")"]}),o.jsx("div",{className:"debug-card-grid",children:_.length>0?_.map(x=>o.jsx("div",{onClick:S=>{S.stopPropagation(),f(x)},onMouseEnter:()=>p(x),onMouseLeave:()=>p(null),style:{cursor:"pointer"},children:o.jsx(xt,{card:x,isFaceUp:g,additionalClassName:"in-hand"})},x.id)):o.jsxs("p",{className:"no-cards",children:["No cards in ",y.toLowerCase(),"."]})})]})};return o.jsx("div",{className:"modal-overlay",onClick:l,children:o.jsxs("div",{className:"modal-content debug-modal-content debug-modal-with-preview",onClick:h=>h.stopPropagation(),children:[o.jsx("button",{className:"btn btn-back modal-close-btn",onClick:l,children:"X"}),o.jsxs("h2",{children:[i,"'s Info"]}),o.jsxs("div",{className:"debug-content-wrapper",children:[o.jsx("div",{className:"debug-preview-area",children:d&&o.jsx("div",{className:"debug-preview-card",children:o.jsx(xt,{card:d,isFaceUp:d.isFaceUp})})}),o.jsxs("div",{className:"debug-grids-area",children:[u(t.deck,"Deck",!1),u(t.discard,"Discard Pile",!0)]})]})]})})}function Kw({onComplete:a}){const[t,l]=le.useState("choose"),[c,i]=le.useState(null),[d,f]=le.useState(null),[p,u]=le.useState(!1),h=g=>{i(g),l("flipping"),u(!0);const _=Math.random()<.5?"heads":"tails";setTimeout(()=>{f(_),u(!1),l("result")},2e3)},y=()=>{if(d===null||c===null)return;const g=d===c;a(g?"player":"opponent",c,g)};return o.jsx("div",{className:"coin-flip-modal-overlay",children:o.jsxs("div",{className:"modal-content coin-flip-modal-content",onClick:g=>g.stopPropagation(),children:[t==="choose"&&o.jsxs(o.Fragment,{children:[o.jsx("h2",{children:"Coin Flip"}),o.jsx("p",{children:"Choose heads or tails to determine who starts the game."}),o.jsxs("div",{className:"coin-flip-choices",children:[o.jsxs("button",{className:"btn coin-flip-choice-btn",onClick:()=>h("heads"),children:[o.jsx("div",{className:"coin-choice-icon",children:"H"}),o.jsx("div",{className:"coin-choice-label",children:"Heads"})]}),o.jsxs("button",{className:"btn coin-flip-choice-btn",onClick:()=>h("tails"),children:[o.jsx("div",{className:"coin-choice-icon",children:"T"}),o.jsx("div",{className:"coin-choice-label",children:"Tails"})]})]})]}),t==="flipping"&&o.jsxs(o.Fragment,{children:[o.jsx("h2",{children:"Flipping..."}),o.jsxs("p",{children:["You chose: ",o.jsx("span",{className:"coin-flip-highlight",children:c==="heads"?"Heads":"Tails"})]}),o.jsx("div",{className:"coin-flip-animation-container",children:o.jsxs("div",{className:`coin-3d ${p?"is-flipping":""}`,children:[o.jsx("div",{className:"coin-face coin-heads",children:"H"}),o.jsx("div",{className:"coin-face coin-tails",children:"T"})]})})]}),t==="result"&&d&&c&&o.jsxs(o.Fragment,{children:[o.jsx("h2",{children:"Result"}),o.jsxs("p",{children:["You chose: ",o.jsx("span",{className:"coin-flip-highlight",children:c==="heads"?"Heads":"Tails"})]}),o.jsx("div",{className:"coin-flip-animation-container",children:o.jsxs("div",{className:`coin-3d result-${d}`,children:[o.jsx("div",{className:"coin-face coin-heads",children:"H"}),o.jsx("div",{className:"coin-face coin-tails",children:"T"})]})}),o.jsxs("p",{className:"coin-flip-result-text",children:["The coin landed on: ",o.jsx("span",{className:"coin-flip-highlight",children:d==="heads"?"Heads":"Tails"})]}),d===c?o.jsx("p",{className:"coin-flip-winner-text",children:"You won! You will start the game."}):o.jsx("p",{className:"coin-flip-loser-text",children:"Opponent won! Opponent will start the game."}),o.jsx("button",{className:"btn",onClick:y,children:"Continue"})]})]})})}const Jw="anarchy-custom-001",ex="Anarchy",tx="Custom recreation of Anarchy protocol to validate editor capabilities",nx="System Validation",ax="2025-11-08T00:00:00.000Z",ox="#8B0000",rx="chaos",lx=[{value:0,topEffects:[],middleEffects:[{id:"anarchy-0-shift",params:{action:"shift",targetFilter:{owner:"any",position:"uncovered",faceState:"any"}},position:"middle",trigger:"on_play"},{id:"anarchy-0-draw",params:{action:"draw",count:1,target:"self",source:"own_deck",conditional:{type:"non_matching_protocols"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[{id:"anarchy-1-passive",params:{action:"passive_rule",rule:{type:"require_non_matching_protocol",target:"all",scope:"global"}},position:"top",trigger:"passive"}],middleEffects:[{id:"anarchy-1-shift",params:{action:"shift",targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!0},destinationRestriction:{type:"non_matching_protocol"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"anarchy-2-delete",params:{action:"delete",count:1,targetFilter:{position:"any",faceState:"face_up"},protocolMatching:"must_match",excludeSelf:!1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"anarchy-3-swap",params:{action:"swap_protocols",target:"opponent"},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"anarchy-3-end-rearrange",params:{action:"rearrange_protocols",target:"own",restriction:{disallowedProtocol:"Anarchy",laneIndex:"current"}},position:"bottom",trigger:"end"}]},{value:5,topEffects:[],middleEffects:[{id:"anarchy-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:6,topEffects:[{id:"anarchy-6-start-flip",params:{action:"flip",count:1,flipSelf:!0,optional:!1,targetFilter:{owner:"any",position:"any",faceState:"any",excludeSelf:!1},advancedConditional:{type:"protocol_match",protocol:"Anarchy"}},position:"top",trigger:"start"}],middleEffects:[],bottomEffects:[]}],sx="Fan-Content",Om={id:Jw,name:ex,description:tx,author:nx,createdAt:ax,color:ox,pattern:rx,cards:lx,category:sx},cx="apathy_custom",ix="Apathy",dx="Custom implementation of Apathy protocol",ux="System",px="2025-01-08T00:00:00Z",fx="#9E9E9E",hx="radial",mx=[{value:0,topEffects:[{id:"apathy-0-value-modifier",params:{action:"value_modifier",modifier:{type:"add_per_condition",value:1,condition:"per_face_down_card",target:"own_total",scope:"this_lane"}},position:"top",trigger:"passive"}],middleEffects:[],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"apathy-1-flip-all",params:{action:"flip",count:"all",optional:!1,scope:"this_lane",targetFilter:{owner:"any",position:"any",faceState:"face_up",excludeSelf:!0}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:2,topEffects:[{id:"apathy-2-passive",params:{action:"passive_rule",rule:{type:"ignore_middle_commands",target:"all",scope:"this_lane"}},position:"top",trigger:"passive"}],middleEffects:[],bottomEffects:[{id:"apathy-2-on-cover",params:{action:"flip",count:1,flipSelf:!0,optional:!1,targetFilter:{owner:"any",position:"any",faceState:"any",excludeSelf:!1}},position:"bottom",trigger:"on_cover"}]},{value:3,topEffects:[],middleEffects:[{id:"apathy-3-flip-opponent",params:{action:"flip",count:1,optional:!1,targetFilter:{owner:"opponent",position:"uncovered",faceState:"face_up",excludeSelf:!1}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"apathy-4-flip-covered",params:{action:"flip",count:1,optional:!0,targetFilter:{owner:"own",position:"covered",faceState:"face_up",excludeSelf:!1}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"apathy-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],yx="Aux 1",Mm={id:cx,name:ix,description:dx,author:ux,createdAt:px,color:fx,pattern:hx,cards:mx,category:yx},gx="chaos_custom_1",vx="Chaos",_x="Embrace the unpredictable. Custom protocol migration of original Chaos protocol.",wx="#E64DB8",xx="chaos",Cx=[{value:0,topEffects:[],middleEffects:[{id:"chaos_0_flip_covered",trigger:"on_play",params:{action:"flip",count:1,scope:"each_lane",targetFilter:{owner:"any",position:"covered",faceState:"any"}},position:"middle"}],bottomEffects:[{id:"chaos_0_start_swap_draws",trigger:"start",params:{action:"mutual_draw",count:1},position:"bottom"}]},{value:1,topEffects:[],middleEffects:[{id:"chaos_1_rearrange_own",trigger:"on_play",params:{action:"rearrange_protocols",target:"own"},position:"middle"},{id:"chaos_1_rearrange_opponent",trigger:"on_play",params:{action:"rearrange_protocols",target:"opponent"},position:"middle"}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"chaos_2_shift_covered",trigger:"on_play",params:{action:"shift",count:1,targetFilter:{owner:"own",position:"covered",faceState:"any"}},position:"middle"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[],bottomEffects:[{id:"chaos_3_allow_any_protocol",trigger:"passive",params:{action:"passive_rule",rule:{type:"allow_any_protocol_play",target:"self",scope:"global"}},position:"bottom"}]},{value:4,topEffects:[],middleEffects:[],bottomEffects:[{id:"chaos_4_end_discard_draw",trigger:"end",params:{action:"discard",count:"all",actor:"self"},conditional:{type:"then",thenEffect:{id:"chaos_4_draw_after_discard",trigger:"on_play",params:{action:"draw",count:1,countType:"equal_to_discarded",countOffset:0,target:"self",source:"own_deck"},position:"bottom"}},position:"bottom"}]},{value:5,topEffects:[],middleEffects:[{id:"chaos_5_discard",trigger:"on_play",params:{action:"discard",count:1,actor:"self"},position:"middle"}],bottomEffects:[]}],Sx="Main 2",Hm={id:gx,name:vx,description:_x,color:wx,pattern:xx,cards:Cx,category:Sx},bx="darkness_custom_v1",Ex="Darkness",jx="Custom Darkness protocol - manipulate face-down cards, flip and shift",kx="System",Rx="2025-01-08T00:00:00Z",Nx="#1a0033",Tx="grid",Ax=[{value:0,topEffects:[],middleEffects:[{id:"dark-0-draw",params:{action:"draw",count:3,target:"self",source:"own_deck"},position:"middle",trigger:"on_play"},{id:"dark-0-shift",params:{action:"shift",targetFilter:{owner:"opponent",position:"covered",faceState:"any",excludeSelf:!1},destinationRestriction:{type:"any"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"dark-1-flip",params:{action:"flip",count:1,optional:!1,targetFilter:{owner:"opponent",position:"uncovered",faceState:"any",excludeSelf:!1}},position:"middle",trigger:"on_play"},{id:"dark-1-shift",params:{action:"shift",optional:!0,targetFilter:{owner:"any",position:"any",faceState:"any",excludeSelf:!1},destinationRestriction:{type:"any"}},position:"middle",trigger:"on_play",useCardFromPreviousEffect:!0}],bottomEffects:[]},{value:2,topEffects:[{id:"dark-2-value-modifier",params:{action:"value_modifier",modifier:{type:"set_to_fixed",value:4,target:"own_cards",scope:"this_lane",filter:{faceState:"face_down",position:"any"}}},position:"top",trigger:"passive"}],middleEffects:[{id:"dark-2-flip",params:{action:"flip",count:1,optional:!0,scope:"this_lane",targetFilter:{owner:"any",position:"covered",faceState:"any",excludeSelf:!1}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"dark-3-play",params:{action:"play",source:"hand",count:1,faceDown:!0,destinationRule:{type:"other_lines",excludeCurrentLane:!0}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"dark-4-shift",params:{action:"shift",targetFilter:{owner:"any",position:"uncovered",faceState:"face_down",excludeSelf:!1},destinationRestriction:{type:"any"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"dark-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],Dx="Main 1",zm={id:bx,name:Ex,description:jx,author:kx,createdAt:Rx,color:Nx,pattern:Tx,cards:Ax,category:Dx},Fx="death_custom_v1",qx="Death",$x="Custom Death protocol - delete cards with various conditions",Ix="System",Lx="2025-01-09T00:00:00Z",Px="#8B0000",Ux="stripes",Ox=[{value:0,topEffects:[],middleEffects:[{id:"death-0-delete-from-each-lane",params:{action:"delete",count:1,scope:{type:"each_other_line"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[{id:"death-1-optional-draw",params:{action:"draw",count:1,optional:!0},position:"top",trigger:"start",conditional:{type:"if_executed",thenEffect:{id:"death-1-delete-other",params:{action:"delete",count:1,excludeSelf:!0},position:"top",trigger:"start",conditional:{type:"then",thenEffect:{id:"death-1-delete-self",params:{action:"delete",count:1,targetFilter:{position:"any",owner:"own"},deleteSelf:!0},position:"top",trigger:"start"}}}}}],middleEffects:[],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"death-2-delete-lane-values",params:{action:"delete",count:"all",selectLane:!0,targetFilter:{faceState:"any",valueRange:{min:1,max:2}}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"death-3-delete-facedown",params:{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"face_down"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"death-4-delete-low-value",params:{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"face_up",valueRange:{min:0,max:1}}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"death-5-discard",params:{action:"discard",count:1},position:"middle",trigger:"on_play"}],bottomEffects:[]}],Mx="Main 1",Vm={id:Fx,name:qx,description:$x,author:Ix,createdAt:Lx,color:Px,pattern:Ux,cards:Ox,category:Mx},Hx="fire-custom-001",zx="Fire",Vx="Fire protocol - discard cards to fuel powerful effects",Bx="System",Yx="2025-11-09T00:00:00.000Z",Gx="#F06838",Wx="radial",Qx=[{value:0,topEffects:[],middleEffects:[{id:"fire-0-flip",params:{action:"flip",count:1,targetFilter:{excludeSelf:!0}},position:"middle",trigger:"on_play"},{id:"fire-0-draw",params:{action:"draw",count:2},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"fire-0-oncover-draw",params:{action:"draw",count:1},position:"bottom",trigger:"on_cover",conditional:{type:"then",thenEffect:{id:"fire-0-oncover-flip",params:{action:"flip",count:1,targetFilter:{excludeSelf:!0}},position:"bottom",trigger:"on_cover"}}}]},{value:1,topEffects:[],middleEffects:[{id:"fire-1-discard",params:{action:"discard",count:1},position:"middle",trigger:"on_play",conditional:{type:"if_executed",thenEffect:{id:"fire-1-delete",params:{action:"delete",count:1},position:"middle",trigger:"on_play"}}}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"fire-2-discard",params:{action:"discard",count:1},position:"middle",trigger:"on_play",conditional:{type:"if_executed",thenEffect:{id:"fire-2-return",params:{action:"return",count:1,targetFilter:{position:"uncovered"}},position:"middle",trigger:"on_play"}}}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[],bottomEffects:[{id:"fire-3-discard",params:{action:"discard",count:1,optional:!0},position:"bottom",trigger:"end",conditional:{type:"if_executed",thenEffect:{id:"fire-3-flip",params:{action:"flip",count:1},position:"bottom",trigger:"end"}}}]},{value:4,topEffects:[],middleEffects:[{id:"fire-4-discard-variable",params:{action:"discard",count:1,variableCount:!0},position:"middle",trigger:"on_play",conditional:{type:"then",thenEffect:{id:"fire-4-draw-based-on-discard",params:{action:"draw",countType:"equal_to_discarded",countOffset:1},position:"middle",trigger:"on_play"}}}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"fire-5-discard",params:{action:"discard",count:1,optional:!1},position:"middle",trigger:"on_play"}],bottomEffects:[]}],Xx="Main 1",Bm={id:Hx,name:zx,description:Vx,author:Bx,createdAt:Yx,color:Gx,pattern:Wx,cards:Qx,category:Xx},Zx="frost_custom_1",Kx="Frost",Jx="Freeze the game state. Frost blocks actions and preserves face-down cards.",eC="#87CEEB",tC="frost",nC=[{value:0,topEffects:[],middleEffects:[{id:"frost_0_draw_per_face_down",trigger:"on_play",position:"middle",params:{action:"draw",count:1,source:"own_deck",target:"self",countType:"count_face_down"}}],bottomEffects:[]},{value:1,topEffects:[{id:"frost_1_block_flips",trigger:"passive",position:"top",params:{action:"passive_rule",rule:{type:"block_flips",target:"all",scope:"global"}}}],middleEffects:[],bottomEffects:[{id:"frost_1_block_rearrange",trigger:"passive",position:"bottom",params:{action:"passive_rule",rule:{type:"block_protocol_rearrange",target:"all",scope:"global"}}}]},{value:2,topEffects:[],middleEffects:[{id:"frost_2_play_face_down",trigger:"on_play",position:"middle",params:{action:"play",count:1,source:"hand",faceDown:!0}}],bottomEffects:[]},{value:3,topEffects:[{id:"frost_3_block_shifts",trigger:"passive",position:"top",params:{action:"passive_rule",rule:{type:"block_shifts_from_and_to_lane",target:"all",scope:"this_lane"}}}],middleEffects:[],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"frost_4_flip_covered",trigger:"on_play",position:"middle",params:{action:"flip",count:1,optional:!0,targetFilter:{owner:"own",faceState:"face_up",position:"covered"}}}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"frost_5_discard",trigger:"on_play",position:"middle",params:{action:"discard",count:1,target:"self"}}],bottomEffects:[]}],aC="Fan-Content",Ym={id:Zx,name:Kx,description:Jx,color:eC,pattern:tC,cards:nC,category:aC},oC="hate-custom-001",rC="Hate",lC="Focused on deletion and sacrifice. Delete cards to gain advantage.",sC="System Migration",cC="2025-11-13T00:00:00.000Z",iC="#E67A7A",dC="diagonal-lines",uC=[{value:0,topEffects:[],middleEffects:[{id:"hate-0-delete",params:{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"any"},scope:{type:"anywhere"},excludeSelf:!1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"hate-1-discard",params:{action:"discard",count:3,actor:"self",upTo:!0},position:"middle",trigger:"on_play"},{id:"hate-1-delete-1",params:{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"any"},scope:{type:"anywhere"},excludeSelf:!1,upTo:!0},position:"middle",trigger:"on_play"},{id:"hate-1-delete-2",params:{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"any"},scope:{type:"anywhere"},excludeSelf:!1,upTo:!0},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"hate-2-delete-own",params:{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"any",calculation:"highest_value",owner:"own"},scope:{type:"anywhere"},excludeSelf:!1},position:"middle",trigger:"on_play"},{id:"hate-2-delete-opponent",params:{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"any",calculation:"highest_value",owner:"opponent"},scope:{type:"anywhere"},excludeSelf:!1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[{id:"hate-3-reactive-draw",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"top",trigger:"after_delete",reactiveTriggerActor:"self"}],middleEffects:[],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[],bottomEffects:[{id:"hate-4-on-cover-delete",params:{action:"delete",count:1,targetFilter:{position:"covered_by_context",faceState:"any",calculation:"lowest_value"},scope:{type:"this_line"},excludeSelf:!1,autoExecute:!0},position:"bottom",trigger:"on_cover"}]},{value:5,topEffects:[],middleEffects:[{id:"hate-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],pC="Aux 1",Gm={id:oC,name:rC,description:lC,author:sC,createdAt:cC,color:iC,pattern:dC,cards:uC,category:pC},fC="water_custom_1",hC="Water",mC="Wash away and renew. Custom protocol migration of original Water protocol.",yC="#5DADE2",gC="multi-radial",vC=[{value:0,topEffects:[],middleEffects:[{id:"water_0_flip_other",trigger:"immediate",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!0},optional:!1},position:"middle"},{id:"water_0_flip_self",trigger:"immediate",params:{action:"flip",flipSelf:!0},position:"middle"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"water_1_play",trigger:"immediate",params:{action:"play",source:"deck",count:1,faceDown:!0,destinationRule:{type:"each_other_line"}},position:"middle"}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"water_2_draw",trigger:"immediate",params:{action:"draw",count:2},position:"middle"},{id:"water_2_rearrange",trigger:"immediate",params:{action:"rearrange_protocols",target:"own"},position:"middle"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"water_3_return",trigger:"immediate",params:{action:"return",count:"all",targetFilter:{owner:"any",position:"uncovered",valueEquals:2},selectLane:!0},position:"middle"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"water_4_return",trigger:"immediate",params:{action:"return",count:1,targetFilter:{owner:"own",position:"uncovered"}},position:"middle"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"water_5_discard",trigger:"immediate",params:{action:"discard",count:1,actor:"self"},position:"middle"}],bottomEffects:[]}],_C="Main 1",Wm={id:fC,name:hC,description:mC,color:yC,pattern:gC,cards:vC,category:_C},wC="spirit_custom_1",xC="Spirit",CC="True strength from within. Custom protocol migration of original Spirit protocol.",SC="#5DD9C1",bC="dual-radial",EC=[{value:0,topEffects:[],middleEffects:[{id:"spirit_0_refresh",trigger:"on_play",params:{action:"refresh",target:"self"},position:"middle"},{id:"spirit_0_draw",trigger:"on_play",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"middle"}],bottomEffects:[{id:"spirit_0_skip_cache",trigger:"passive",params:{action:"passive_rule",rule:{type:"skip_check_cache_phase",target:"self",scope:"global"}},position:"bottom"}]},{value:1,topEffects:[{id:"spirit_1_play_anywhere",trigger:"passive",params:{action:"passive_rule",rule:{type:"allow_any_protocol_play",target:"self",scope:"global"}},position:"top"}],middleEffects:[{id:"spirit_1_draw",trigger:"on_play",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"middle"}],bottomEffects:[{id:"spirit_1_choice",trigger:"start",params:{action:"choice",options:[{id:"spirit_1_choice_discard",trigger:"on_play",params:{action:"discard",count:1,actor:"self"},position:"bottom"},{id:"spirit_1_choice_flip",trigger:"on_play",params:{action:"flip",flipSelf:!0},position:"bottom"}]},position:"bottom"}]},{value:2,topEffects:[],middleEffects:[{id:"spirit_2_flip",trigger:"on_play",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1},optional:!0},position:"middle"}],bottomEffects:[]},{value:3,topEffects:[{id:"spirit_3_shift",trigger:"after_draw",reactiveTriggerActor:"self",params:{action:"shift",count:1,optional:!0,targetFilter:{owner:"own",position:"any",faceState:"any",excludeSelf:!1}},position:"top"}],middleEffects:[],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"spirit_4_swap",trigger:"on_play",params:{action:"swap_protocols",target:"own"},position:"middle"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"spirit_5_discard",trigger:"on_play",params:{action:"discard",count:1,actor:"self"},position:"middle"}],bottomEffects:[]}],jC="Main 1",Qm={id:wC,name:xC,description:CC,color:SC,pattern:bC,cards:EC,category:jC},kC="gravity_custom_1",RC="Gravity",NC="Pull everything together. Gravity draws cards towards this line.",TC="#7599EB",AC="grid",DC=[{value:0,topEffects:[],middleEffects:[{id:"gravity_0_play_per_2_cards",trigger:"on_play",params:{action:"play",source:"deck",count:1,faceDown:!0,destinationRule:{type:"under_this_card"},condition:{type:"per_x_cards_in_line",cardCount:2},actor:"self"},position:"middle"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"gravity_1_draw_2",trigger:"on_play",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"middle"},{id:"gravity_1_shift_to_or_from",trigger:"on_play",params:{action:"shift",targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1},destinationRestriction:{type:"to_or_from_this_lane",laneIndex:"current"}},position:"middle"}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"gravity_2_flip",trigger:"on_play",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1},optional:!1},position:"middle"},{id:"gravity_2_shift_to_this_line",trigger:"on_play",params:{action:"shift",targetFilter:{owner:"any",position:"any",faceState:"any",excludeSelf:!1},destinationRestriction:{type:"to_this_lane",laneIndex:"current"}},position:"middle",useCardFromPreviousEffect:!0}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"gravity_4_shift_face_down_to_this_line",trigger:"on_play",params:{action:"shift",targetFilter:{owner:"any",position:"uncovered",faceState:"face_down",excludeSelf:!1},destinationRestriction:{type:"to_this_lane",laneIndex:"current"}},position:"middle"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"gravity_5_discard",trigger:"on_play",params:{action:"discard",count:1,actor:"self"},position:"middle"}],bottomEffects:[]},{value:6,topEffects:[],middleEffects:[{id:"gravity_6_opponent_plays",trigger:"on_play",params:{action:"play",source:"deck",count:1,faceDown:!0,destinationRule:{type:"specific_lane",laneIndex:"current"},actor:"opponent"},position:"middle",comment:"Opponent plays top of their deck in this line"}],bottomEffects:[]}],FC="Main 1",Xm={id:kC,name:RC,description:NC,color:TC,pattern:AC,cards:DC,category:FC},qC="life_custom_1",$C="Life",IC="Life begets more life. Play cards from your deck to grow your presence.",LC="#3CE076",PC="hexagons",UC=[{value:0,topEffects:[],middleEffects:[{id:"life_0_play_each_line_with_card",trigger:"on_play",position:"middle",params:{action:"play",source:"deck",count:1,faceDown:!0,destinationRule:{type:"each_line_with_card",ownerFilter:"own"},actor:"self"}}],bottomEffects:[{id:"life_0_on_cover_delete_self",trigger:"on_cover",position:"bottom",params:{action:"delete",deleteSelf:!0}}]},{value:1,topEffects:[],middleEffects:[{id:"life_1_flip_1",trigger:"on_play",position:"middle",params:{action:"flip",count:1,optional:!1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1}}},{id:"life_1_flip_2",trigger:"on_play",position:"middle",params:{action:"flip",count:1,optional:!1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1}}}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"life_2_draw",trigger:"on_play",position:"middle",params:{action:"draw",count:1,target:"self",source:"own_deck"}},{id:"life_2_flip",trigger:"on_play",position:"middle",params:{action:"flip",count:1,optional:!0,targetFilter:{owner:"any",position:"uncovered",faceState:"face_down",excludeSelf:!1}}}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[],bottomEffects:[{id:"life_3_on_cover_play",trigger:"on_cover",position:"bottom",params:{action:"play",source:"deck",count:1,faceDown:!0,destinationRule:{type:"another_line",excludeCurrentLane:!0},actor:"self"}}]},{value:4,topEffects:[],middleEffects:[{id:"life_4_conditional_draw",trigger:"on_play",position:"middle",params:{action:"draw",count:1,target:"self",source:"own_deck",conditional:{type:"is_covering"}}}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"life_5_discard",trigger:"on_play",position:"middle",params:{action:"discard",count:1,actor:"self"}}],bottomEffects:[]}],OC="Main 1",Zm={id:qC,name:$C,description:IC,color:LC,pattern:PC,cards:UC,category:OC},MC="light_custom_1",HC="Light",zC="Burn away the dark. Light protocol reveals and manipulates through illumination.",VC="System",BC="2025-11-14T00:00:00.000Z",YC="#F4D03F",GC="radial",WC=[{value:0,topEffects:[],middleEffects:[{id:"light-0-flip",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1},optional:!1},position:"middle",trigger:"on_play"},{id:"light-0-draw",params:{action:"draw",count:1,target:"self",source:"own_deck",countType:"equal_to_card_value"},position:"middle",trigger:"on_play",useCardFromPreviousEffect:!0}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[],bottomEffects:[{id:"light-1-draw",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"bottom",trigger:"end"}]},{value:2,topEffects:[],middleEffects:[{id:"light-2-draw",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"middle",trigger:"on_play"},{id:"light-2-reveal-board-card",params:{action:"reveal",source:"board",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"face_down"},optional:!0},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"light-3-shift-all",params:{action:"shift",count:"all",targetFilter:{owner:"any",position:"any",faceState:"face_down",excludeSelf:!1},destinationRestriction:{type:"to_another_line"},scope:"this_lane"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"light-4-reveal",params:{action:"reveal",source:"opponent_hand",count:-1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"light-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],QC="Main 1",Km={id:MC,name:HC,description:zC,author:VC,createdAt:BC,color:YC,pattern:GC,cards:WC,category:QC},XC="speed_custom_1",ZC="Speed",KC="Swift and adaptive. Custom protocol migration of original Speed protocol.",JC="#33E6E6",e1="cross",t1=[{value:0,topEffects:[],middleEffects:[{id:"speed_0_play",trigger:"on_play",params:{action:"play",source:"hand",count:1},position:"middle"}],bottomEffects:[]},{value:1,topEffects:[{id:"speed_1_reactive_draw",trigger:"after_clear_cache",reactiveTriggerActor:"self",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"top"}],middleEffects:[{id:"speed_1_draw",trigger:"on_play",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"middle"}],bottomEffects:[]},{value:2,topEffects:[{id:"speed_2_before_compile",trigger:"before_compile_delete",params:{action:"shift",count:1,shiftSelf:!0,allowCoveredSelf:!0,targetFilter:{owner:"own",position:"any",faceState:"any"}},position:"top"}],middleEffects:[],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"speed_3_shift_other",trigger:"on_play",params:{action:"shift",count:1,targetFilter:{owner:"own",position:"uncovered",faceState:"any",excludeSelf:!0}},position:"middle"}],bottomEffects:[{id:"speed_3_end_shift",trigger:"end",params:{action:"shift",count:1,optional:!0,targetFilter:{owner:"own",position:"uncovered",faceState:"any"}},position:"bottom",conditional:{type:"if_executed",thenEffect:{id:"speed_3_flip_self",trigger:"on_play",params:{action:"flip",flipSelf:!0},position:"bottom"}}}]},{value:4,topEffects:[],middleEffects:[{id:"speed_4_shift_opponent",trigger:"on_play",params:{action:"shift",count:1,targetFilter:{owner:"opponent",position:"uncovered",faceState:"face_down"}},position:"middle"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"speed_5_discard",trigger:"on_play",params:{action:"discard",count:1,actor:"self"},position:"middle"}],bottomEffects:[]}],n1="Main 1",Jm={id:XC,name:ZC,description:KC,color:JC,pattern:e1,cards:t1,category:n1},a1="metal_custom_1",o1="Metal",r1="Unyielding defense. Custom protocol migration of original Metal protocol.",l1="#B0BEC5",s1="grid",c1=[{value:0,topEffects:[{id:"metal_0_reduce_opponent",trigger:"passive",params:{action:"value_modifier",modifier:{type:"add_to_total",value:-2,target:"opponent_total",scope:"this_lane"}},position:"top"}],middleEffects:[{id:"metal_0_flip",trigger:"on_play",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any"}},position:"middle"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"metal_1_draw",trigger:"on_play",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"middle"},{id:"metal_1_block_compile",trigger:"on_play",params:{action:"block_compile",target:"opponent"},position:"middle"}],bottomEffects:[]},{value:2,topEffects:[{id:"metal_2_block_face_down",trigger:"passive",params:{action:"passive_rule",rule:{type:"block_face_down_play",scope:"this_lane"}},position:"top"}],middleEffects:[],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"metal_3_draw",trigger:"on_play",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"middle"},{id:"metal_3_delete_lane",trigger:"on_play",params:{action:"delete_all_in_lane",laneCondition:{type:"min_cards",count:8},excludeCurrentLane:!0},position:"middle"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"metal_5_discard",trigger:"on_play",params:{action:"discard",count:1,actor:"self"},position:"middle"}],bottomEffects:[]},{value:6,topEffects:[{id:"metal_6_delete_on_cover_or_flip",trigger:"on_cover_or_flip",params:{action:"delete",deleteSelf:!0},position:"top"}],middleEffects:[],bottomEffects:[]}],i1="Main 1",ey={id:a1,name:o1,description:r1,color:l1,pattern:s1,cards:c1,category:i1},d1="plague-custom-001",u1="Plague",p1="Focused on forcing opponent discards and restricting their plays. Spread suffering.",f1="System Migration",h1="2025-11-26T00:00:00.000Z",m1="#8FBC3A",y1="dual-radial",g1=[{value:0,topEffects:[],middleEffects:[{id:"plague-0-opponent-discard",params:{action:"discard",count:1,actor:"opponent"},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"plague-0-block-play",params:{action:"passive_rule",rule:{type:"block_all_play",target:"opponent",scope:"this_lane"}},position:"bottom",trigger:"passive"}]},{value:1,topEffects:[{id:"plague-1-reactive-draw",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"top",trigger:"after_opponent_discard"}],middleEffects:[{id:"plague-1-opponent-discard",params:{action:"discard",count:1,actor:"opponent"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"plague-2-self-discard",params:{action:"discard",count:1,actor:"self",variableCount:!0},position:"middle",trigger:"on_play",conditional:{type:"then",thenEffect:{id:"plague-2-opponent-discard",params:{action:"discard",actor:"opponent",countType:"equal_to_discarded",countOffset:1},position:"middle",trigger:"on_play"}}}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"plague-3-flip-each-other",params:{action:"flip",count:"all",scope:{type:"anywhere"},targetFilter:{faceState:"face_up",owner:"any",position:"uncovered",excludeSelf:!0}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,text:{bottom:"<div><span class='emphasis'>End:</span> Your opponent deletes 1 of their face-down cards. You may flip this card.</div>"},topEffects:[],middleEffects:[],bottomEffects:[{id:"plague-4-opponent-delete",params:{action:"delete",count:1,targetFilter:{faceState:"face_down",owner:"opponent",position:"uncovered"},scope:{type:"anywhere"},actorChooses:"card_owner"},position:"bottom",trigger:"end"},{id:"plague-4-may-flip-self",params:{action:"flip",flipSelf:!0,optional:!0},position:"bottom",trigger:"end"}]},{value:5,topEffects:[],middleEffects:[{id:"plague-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],v1="Main 1",ty={id:d1,name:u1,description:p1,author:f1,createdAt:h1,color:m1,pattern:y1,cards:g1,category:v1},_1="love_custom_v1",w1="Love",x1="Custom Love protocol - hand manipulation, giving and taking cards",C1="System",S1="2025-01-08T00:00:00Z",b1="#f2a3d7",E1="radial",j1=[{value:1,topEffects:[],middleEffects:[{id:"love-1-draw-opponent-deck",params:{action:"draw",count:1,target:"self",source:"opponent_deck"},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"love-1-end-give",params:{action:"give",count:1,source:"own_hand",optional:!0},conditional:{type:"if_executed",thenEffect:{id:"love-1-end-draw",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"bottom",trigger:"on_play"}},position:"bottom",trigger:"end"}]},{value:2,topEffects:[],middleEffects:[{id:"love-2-opponent-draw",params:{action:"draw",count:1,target:"opponent",source:"own_deck"},position:"middle",trigger:"on_play"},{id:"love-2-refresh",params:{action:"refresh",target:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"love-3-take",params:{action:"take",count:1,random:!0},position:"middle",trigger:"on_play"},{id:"love-3-give",params:{action:"give",count:1,source:"own_hand",optional:!1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"love-4-reveal",params:{action:"reveal",count:1,source:"own_hand"},position:"middle",trigger:"on_play"},{id:"love-4-flip",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"love-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:6,topEffects:[],middleEffects:[{id:"love-6-opponent-draw",params:{action:"draw",count:2,target:"opponent",source:"own_deck"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],k1="Aux 1",ny={id:_1,name:w1,description:x1,author:C1,createdAt:S1,color:b1,pattern:E1,cards:j1,category:k1},R1="psychic_custom_v1",N1="Psychic",T1="Custom Psychic protocol - mind control, discard, reveal, and protocol manipulation",A1="System",D1="2025-01-08T00:00:00Z",F1="#c78dd9",q1="radial",$1=[{value:0,topEffects:[],middleEffects:[{id:"psychic-0-draw",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"middle",trigger:"on_play"},{id:"psychic-0-opponent-discard",params:{action:"discard",count:2,actor:"opponent"},position:"middle",trigger:"on_play"},{id:"psychic-0-reveal-hand",params:{action:"reveal",source:"opponent_hand",count:-1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[{id:"psychic-1-force-face-down",params:{action:"passive_rule",rule:{type:"require_face_down_play",target:"opponent",scope:"global"}},position:"top",trigger:"passive"}],middleEffects:[],bottomEffects:[{id:"psychic-1-start-flip-self",params:{action:"flip",count:1,targetFilter:{owner:"self",position:"any",faceState:"any",excludeSelf:!1},flipSelf:!0},position:"bottom",trigger:"start"}]},{value:2,topEffects:[],middleEffects:[{id:"psychic-2-opponent-discard",params:{action:"discard",count:2,actor:"opponent"},position:"middle",trigger:"on_play"},{id:"psychic-2-rearrange",params:{action:"rearrange_protocols",target:"opponent"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"psychic-3-opponent-discard",params:{action:"discard",count:1,actor:"opponent"},position:"middle",trigger:"on_play"},{id:"psychic-3-shift-opponent",params:{action:"shift",targetFilter:{owner:"opponent",position:"uncovered",faceState:"any",excludeSelf:!1},destinationRestriction:{type:"any"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[],bottomEffects:[{id:"psychic-4-end-return",params:{action:"return",count:1,optional:!0,targetFilter:{owner:"opponent",position:"uncovered",faceState:"any",excludeSelf:!1}},conditional:{type:"if_executed",thenEffect:{id:"psychic-4-end-flip-self",params:{action:"flip",count:1,flipSelf:!0,targetFilter:{owner:"self",position:"any",faceState:"any",excludeSelf:!1}},position:"bottom",trigger:"end"}},position:"bottom",trigger:"end"}]},{value:5,topEffects:[],middleEffects:[{id:"psychic-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],I1="Main 1",ay={id:R1,name:N1,description:T1,author:A1,createdAt:D1,color:F1,pattern:q1,cards:$1,category:I1},L1="smoke-custom-001",P1="Smoke",U1="Shroud your cards in mystery. Use face-down cards to gain value and control.",O1="System",M1="2025-12-09T00:00:00.000Z",H1="#5A5A5A",z1="radial",V1=[{value:0,topEffects:[],middleEffects:[{id:"smoke-0-play-deck-each-facedown",params:{action:"play",source:"deck",count:1,faceDown:!0,destinationRule:{type:"each_line_with_card",cardFilter:{faceState:"face_down"}}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"smoke-1-flip-own",params:{action:"flip",count:1,targetFilter:{owner:"own",position:"uncovered",faceState:"any"},optional:!1},position:"middle",trigger:"on_play"},{id:"smoke-1-shift-that-card",params:{action:"shift",optional:!0,targetFilter:{owner:"own",position:"uncovered",faceState:"any"}},position:"middle",trigger:"on_play",useCardFromPreviousEffect:!0}],bottomEffects:[]},{value:2,topEffects:[{id:"smoke-2-value-per-facedown",params:{action:"value_modifier",modifier:{type:"add_per_condition",value:1,condition:"per_face_down_card",target:"own_total",scope:"this_lane"}},position:"top",trigger:"passive"}],middleEffects:[],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"smoke-3-play-hand-facedown-lane",params:{action:"play",source:"hand",count:1,faceDown:!0,destinationRule:{type:"line_with_matching_cards",cardFilter:{faceState:"face_down"}}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"smoke-4-shift-covered-facedown",params:{action:"shift",optional:!1,targetFilter:{owner:"any",position:"covered",faceState:"face_down"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"smoke-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],B1="Main 2",oy={id:L1,name:P1,description:U1,author:O1,createdAt:M1,color:H1,pattern:z1,cards:V1,category:B1},Y1="clarity-custom-001",G1="Clarity",W1="See through the fog of war. Reveal your deck and hand to gain powerful advantages.",Q1="System",X1="2025-12-09T00:00:00.000Z",Z1="#87CEEB",K1="radial",J1=[{value:0,topEffects:[{id:"clarity-0-value-per-hand",params:{action:"value_modifier",modifier:{type:"add_per_condition",value:1,condition:"per_card_in_hand",target:"own_total",scope:"this_lane"}},position:"top",trigger:"passive"}],middleEffects:[],bottomEffects:[]},{value:1,topEffects:[{id:"clarity-1-start-reveal-deck-top",params:{action:"reveal",source:"own_deck_top",count:1},position:"top",trigger:"start",conditional:{type:"optional",thenEffect:{id:"clarity-1-discard-revealed",params:{action:"discard",count:1,actor:"self",useCardFromPreviousEffect:!0}}}}],middleEffects:[{id:"clarity-1-middle-reveal-opponent-hand",params:{action:"reveal",source:"opponent_hand",count:-1},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"clarity-1-bottom-draw-3",params:{action:"draw",count:3,target:"self",source:"own_deck"},position:"bottom",trigger:"on_cover"}]},{value:2,topEffects:[],middleEffects:[{id:"clarity-2-reveal-deck",params:{action:"reveal",source:"own_deck",count:-1},position:"middle",trigger:"on_play"},{id:"clarity-2-draw-value-1",params:{action:"draw",count:1,target:"self",source:"own_deck",valueFilter:{equals:1},fromRevealed:!0},position:"middle",trigger:"on_play"},{id:"clarity-2-shuffle-deck",params:{action:"shuffle_deck"},position:"middle",trigger:"on_play"},{id:"clarity-2-play-value-1",params:{action:"play",source:"hand",count:1,faceDown:!1,valueFilter:{equals:1}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"clarity-3-reveal-deck",params:{action:"reveal",source:"own_deck",count:-1},position:"middle",trigger:"on_play"},{id:"clarity-3-draw-value-5",params:{action:"draw",count:1,target:"self",source:"own_deck",valueFilter:{equals:5},fromRevealed:!0},position:"middle",trigger:"on_play"},{id:"clarity-3-shuffle-deck",params:{action:"shuffle_deck"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"clarity-4-shuffle-trash",params:{action:"shuffle_trash",optional:!0},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"clarity-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],eS="Main 2",ry={id:Y1,name:G1,description:W1,author:Q1,createdAt:X1,color:Z1,pattern:K1,cards:J1,category:eS},tS="corruption-custom-001",nS="Corruption",aS="Corrupt your opponents plans. Use discard synergies and manipulate the return mechanic.",oS="System",rS="2025-12-09T00:00:00.000Z",lS="#4A0080",sS="stripes",cS=[{value:0,topEffects:[{id:"corruption-0-start-flip",params:{action:"flip",count:1,scope:"this_lane",targetFilter:{owner:"own",position:"any",faceState:"face_up",excludeSelf:!0},optional:!1},position:"top",trigger:"start"}],middleEffects:[],bottomEffects:[{id:"corruption-0-play-opponent-side",params:{action:"passive_rule",rule:{type:"allow_play_on_opponent_side",target:"self",scope:"global"}},position:"bottom",trigger:"passive"}]},{value:1,topEffects:[],middleEffects:[{id:"corruption-1-return",params:{action:"return",count:1,targetFilter:{owner:"any",position:"uncovered"}},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"corruption-1-redirect-return",params:{action:"redirect_return_to_deck",faceDown:!0,targetOwner:"opponent"},position:"bottom",trigger:"when_card_returned"}]},{value:2,topEffects:[{id:"corruption-2-after-discard",params:{action:"discard",count:1,actor:"opponent"},position:"top",trigger:"after_discard",reactiveTriggerActor:"self"}],middleEffects:[{id:"corruption-2-draw",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"middle",trigger:"on_play"},{id:"corruption-2-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"corruption-3-flip-covered",params:{action:"flip",count:1,optional:!0,targetFilter:{owner:"any",position:"covered",faceState:"face_up",excludeSelf:!1}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"corruption-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:6,topEffects:[{id:"corruption-6-end-choice",params:{action:"choice",options:[{id:"corruption-6-choice-discard",params:{action:"discard",count:1,actor:"self"},position:"top",trigger:"end"},{id:"corruption-6-choice-delete-self",params:{action:"delete",deleteSelf:!0},position:"top",trigger:"end"}]},position:"top",trigger:"end"}],middleEffects:[],bottomEffects:[]}],iS="Main 2",ly={id:tS,name:nS,description:aS,author:oS,createdAt:rS,color:lS,pattern:sS,cards:cS,category:iS},dS="courage-custom-001",uS="Courage",pS="Face challenges head-on. Gain power when outnumbered.",fS="System",hS="2025-12-10T00:00:00.000Z",mS="#D4AF37",yS="radial",gS=[{value:0,topEffects:[{id:"courage-0-start-draw",params:{action:"draw",count:1,advancedConditional:{type:"empty_hand"}},position:"top",trigger:"start"}],middleEffects:[{id:"courage-0-draw",params:{action:"draw",count:1},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"courage-0-end-discard",params:{action:"discard",count:1,optional:!0},position:"bottom",trigger:"end",conditional:{type:"if_executed",thenEffect:{id:"courage-0-opponent-discard",params:{action:"discard",count:1,actor:"opponent"},position:"bottom",trigger:"end"}}}]},{value:1,topEffects:[],middleEffects:[{id:"courage-1-delete",params:{action:"delete",count:1,targetFilter:{owner:"opponent",position:"uncovered"},selectLane:!0,laneCondition:{type:"opponent_higher_value"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"courage-2-draw",params:{action:"draw",count:1},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"courage-2-end-draw",params:{action:"draw",count:1,advancedConditional:{type:"opponent_higher_value_in_lane"}},position:"bottom",trigger:"end"}]},{value:3,topEffects:[],middleEffects:[],bottomEffects:[{id:"courage-3-shift",params:{action:"shift",shiftSelf:!0,optional:!0,destinationRestriction:{type:"opponent_highest_value_lane"}},position:"bottom",trigger:"end"}]},{value:5,topEffects:[],middleEffects:[{id:"courage-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:6,topEffects:[{id:"courage-6-flip",params:{action:"flip",flipSelf:!0,advancedConditional:{type:"opponent_higher_value_in_lane"}},position:"top",trigger:"end"}],middleEffects:[],bottomEffects:[]}],vS="Main 2",sy={id:dS,name:uS,description:pS,author:fS,createdAt:hS,color:mS,pattern:yS,cards:gS,category:vS},_S="fear_custom",wS="Fear",xS="Terror and disruption protocol - Control through fear",CS="System",SS="2025-01-10T00:00:00Z",bS="#800020",ES="radial",jS="Main 2",kS=[{value:0,topEffects:[{id:"fear-0-passive",params:{action:"passive_rule",rule:{type:"ignore_middle_commands",target:"opponent",scope:"global",onlyDuringYourTurn:!0}},position:"top",trigger:"passive"}],middleEffects:[{id:"fear-0-choice",params:{action:"choice",options:[{id:"fear-0-shift",params:{action:"shift",targetFilter:{owner:"any",position:"uncovered",faceState:"any"}},position:"middle",trigger:"on_play"},{id:"fear-0-flip",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1},optional:!1},position:"middle",trigger:"on_play"}]},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"fear-1-draw",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"middle",trigger:"on_play",conditional:{type:"then",thenEffect:{id:"fear-1-opponent-discard-hand",params:{action:"discard",count:"all",actor:"opponent"},position:"middle",trigger:"on_play",conditional:{type:"then",thenEffect:{id:"fear-1-opponent-draw",params:{action:"draw",countType:"equal_to_discarded",countOffset:-1,target:"opponent",source:"own_deck"},position:"middle",trigger:"on_play"}}}}}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"fear-2-return",params:{action:"return",count:1,targetFilter:{owner:"opponent"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"fear-3-shift",params:{action:"shift",targetFilter:{owner:"opponent",position:"any",faceState:"any"},scope:"this_lane"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"fear-4-discard-random",params:{action:"discard",count:1,actor:"opponent",random:!0},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"fear-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],cy={id:_S,name:wS,description:xS,author:CS,createdAt:SS,color:bS,pattern:ES,category:jS,cards:kS},RS="ice_custom",NS="Ice",TS="Control and disruption through shifting and conditional effects",AS="System",DS="2025-12-10T00:00:00Z",FS="#B0E0E6",qS="radial",$S="Main 2",IS=[{value:1,topEffects:[],middleEffects:[{id:"ice-1-shift",params:{action:"shift",shiftSelf:!0,optional:!0},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"ice-1-reactive",params:{action:"discard",actor:"opponent",count:1},position:"bottom",trigger:"after_play",reactiveTriggerActor:"opponent",reactiveScope:"this_lane"}]},{value:2,topEffects:[],middleEffects:[{id:"ice-2-shift",params:{action:"shift",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!0}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[{id:"ice-3-end-shift",params:{action:"shift",shiftSelf:!0,optional:!0,advancedConditional:{type:"this_card_is_covered"}},position:"top",trigger:"end"}],middleEffects:[],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[],bottomEffects:[{id:"ice-4-passive",params:{action:"passive_rule",rule:{type:"block_flip_this_card",target:"this_card",scope:"this_card"}},position:"bottom",trigger:"passive"}]},{value:5,topEffects:[],middleEffects:[{id:"ice-5-discard",params:{action:"discard",actor:"self",count:1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:6,topEffects:[{id:"ice-6-passive",params:{action:"passive_rule",rule:{type:"block_draw_conditional",conditionTarget:"self",blockTarget:"self",scope:"global"}},position:"top",trigger:"passive"}],middleEffects:[],bottomEffects:[]}],iy={id:RS,name:NS,description:TS,author:AS,createdAt:DS,color:FS,pattern:qS,category:$S,cards:IS},LS="luck-custom-001",PS="Luck",US="Gamble with fate. State numbers and protocols to manipulate the top of decks.",OS="System",MS="2025-01-15T00:00:00.000Z",HS="#FFD700",zS="chaos",VS=[{value:0,topEffects:[],middleEffects:[{id:"luck-0-state-number",params:{action:"state_number",numberSource:"own_protocol_values"},position:"middle",trigger:"on_play"},{id:"luck-0-draw-and-reveal",params:{action:"draw",count:3,target:"self",source:"own_deck",revealFromDrawn:{valueSource:"stated_number",thenAction:"may_play"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"luck-1-play-deck-top",params:{action:"play",source:"deck",count:1,faceDown:!0,destinationRule:{type:"another_line"}},position:"middle",trigger:"on_play",conditional:{type:"then",thenEffect:{id:"luck-1-flip-skip-middle",params:{action:"flip",skipMiddleCommand:!0},useCardFromPreviousEffect:!0}}}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"luck-2-discard-deck-top",params:{action:"discard",source:"top_deck_own",count:1},position:"middle",trigger:"on_play",conditional:{type:"then",thenEffect:{id:"luck-2-draw-equal-value",params:{action:"draw",countType:"equal_to_card_value",target:"self",source:"own_deck"},useCardFromPreviousEffect:!0}}}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"luck-3-state-protocol",params:{action:"state_protocol",protocolSource:"opponent_cards"},position:"middle",trigger:"on_play"},{id:"luck-3-discard-opponent-deck",params:{action:"discard",source:"top_deck_opponent",count:1},position:"middle",trigger:"on_play",conditional:{type:"if_protocol_matches_stated",thenEffect:{id:"luck-3-delete",params:{action:"delete",count:1}}}}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"luck-4-discard-deck-top",params:{action:"discard",source:"top_deck_own",count:1},position:"middle",trigger:"on_play",conditional:{type:"then",thenEffect:{id:"luck-4-delete-same-value",params:{action:"delete",count:1,targetFilter:{position:"any",valueSource:"previous_effect_card"}}}}}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"luck-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],BS="Main 2",dy={id:LS,name:PS,description:US,author:OS,createdAt:MS,color:HS,pattern:zS,cards:VS,category:BS},YS="mirror-custom-001",GS="Mirror",WS="Copy, symmetry, and reflection. Mirror your opponent's actions.",QS="System",XS="2025-01-15T00:00:00.000Z",ZS="#C0C0C0",KS="radial",JS="Main 2",eb=[{value:0,topEffects:[{id:"mirror-0-value-modifier",params:{action:"value_modifier",modifier:{type:"add_per_condition",value:1,condition:"per_opponent_card_in_lane",target:"own_total",scope:"this_lane"}},position:"top",trigger:"passive"}],middleEffects:[],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[],bottomEffects:[{id:"mirror-1-copy-middle",params:{action:"copy_opponent_middle",optional:!0},position:"bottom",trigger:"end"}]},{value:2,topEffects:[],middleEffects:[{id:"mirror-2-swap-stacks",params:{action:"swap_stacks",target:"own"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"mirror-3-flip-own",params:{action:"flip",count:1,targetFilter:{owner:"own",position:"uncovered",faceState:"any",excludeSelf:!0},optional:!1},position:"middle",trigger:"on_play",conditional:{type:"then",thenEffect:{id:"mirror-3-flip-opponent-same-lane",params:{action:"flip",count:1,targetFilter:{owner:"opponent",position:"uncovered",faceState:"any"},sameLaneAsFirst:!0,optional:!1},position:"middle",trigger:"on_play"}}}],bottomEffects:[]},{value:4,topEffects:[{id:"mirror-4-after-opponent-draw",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"top",trigger:"after_opponent_draw"}],middleEffects:[],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"mirror-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],uy={id:YS,name:GS,description:WS,author:QS,createdAt:XS,color:ZS,pattern:KS,category:JS,cards:eb},tb="peace-custom-001",nb="Peace",ab="Harmony and balance. Sacrifice to achieve equilibrium.",ob="System",rb="2025-01-16T00:00:00.000Z",lb="#87CEEB",sb="radial",cb="Main 2",ib=[{value:1,topEffects:[],middleEffects:[{id:"peace-1-both-discard",params:{action:"discard",actor:"both",count:"all"},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"peace-1-end-draw",params:{action:"draw",count:1,target:"self",source:"own_deck",advancedConditional:{type:"empty_hand"}},position:"bottom",trigger:"end"}]},{value:2,topEffects:[],middleEffects:[{id:"peace-2-draw",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"middle",trigger:"on_play"},{id:"peace-2-play",params:{action:"play",source:"hand",count:1,faceDown:!0},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"peace-3-discard-flip",params:{action:"discard",actor:"self",count:1},position:"middle",trigger:"on_play",optional:!0,conditional:{type:"if_executed",thenEffect:{id:"peace-3-flip",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1,valueMinGreaterThanHandSize:!0},optional:!1},position:"middle",trigger:"on_play"}}}],bottomEffects:[]},{value:4,topEffects:[{id:"peace-4-reactive-draw",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"top",trigger:"after_discard",reactiveTriggerActor:"self",onlyDuringOpponentTurn:!0}],middleEffects:[],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"peace-5-discard",params:{action:"discard",actor:"self",count:1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:6,topEffects:[],middleEffects:[{id:"peace-6-flip-self",params:{action:"flip",count:1,flipSelf:!0,advancedConditional:{type:"hand_size_greater_than",threshold:1}},position:"middle",trigger:"on_play"}],bottomEffects:[]}],py={id:tb,name:nb,description:ab,author:ob,createdAt:rb,color:lb,pattern:sb,category:cb,cards:ib},db="time-custom-001",ub="Time",pb="Manipulate time through your trash and deck. Recycle discarded cards and control the flow of battle.",fb="System",hb="2025-12-17T00:00:00.000Z",mb="#8B4513",yb="hexagons",gb=[{value:0,topEffects:[],middleEffects:[{id:"time-0-play-from-trash",params:{action:"play",source:"trash",count:1},position:"middle",trigger:"on_play"},{id:"time-0-shuffle-trash",params:{action:"shuffle_trash",optional:!1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"time-1-flip-covered",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"covered",faceState:"any",excludeSelf:!1},optional:!1},position:"middle",trigger:"on_play"},{id:"time-1-discard-entire-deck",params:{action:"discard",count:1,actor:"self",source:"entire_deck"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:2,topEffects:[{id:"time-2-after-shuffle-draw",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"top",trigger:"after_shuffle",reactiveTriggerActor:"self",conditional:{type:"then",thenEffect:{id:"time-2-then-shift-self",params:{action:"shift",targetFilter:{owner:"own"},shiftSelf:!0,optional:!0}}}}],middleEffects:[{id:"time-2-conditional-shuffle-trash",params:{action:"shuffle_trash",optional:!0,advancedConditional:{type:"trash_not_empty"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"time-3-reveal-from-trash",params:{action:"reveal",source:"own_trash",count:1},position:"middle",trigger:"on_play",conditional:{type:"if_executed",thenEffect:{id:"time-3-play-face-down",params:{action:"play",source:"trash",count:1,faceDown:!0,destinationRule:{type:"other_lines"}},useCardFromPreviousEffect:!0}}}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"time-4-draw-2",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"middle",trigger:"on_play"},{id:"time-4-discard-2",params:{action:"discard",count:2,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"time-5-discard-1",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],vb="Main 2",fy={id:db,name:ub,description:pb,author:fb,createdAt:hb,color:mb,pattern:yb,cards:gb,category:vb},_b="war-custom-001",wb="War",xb="CONFLICT, AGGRESSION - Punishes opponent actions with reactive effects",Cb="System",Sb="2025-01-01T00:00:00.000Z",bb="#8B0000",Eb="grid",jb="Main 2",kb=[{value:0,topEffects:[{id:"war-0-top-flip-self",params:{action:"flip",flipSelf:!0,optional:!0},position:"top",trigger:"after_refresh"}],middleEffects:[],bottomEffects:[{id:"war-0-bottom-delete",params:{action:"delete",count:1,optional:!0,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1},scope:{type:"anywhere"}},position:"bottom",trigger:"after_opponent_draw"}]},{value:1,topEffects:[],middleEffects:[],bottomEffects:[{id:"war-1-discard-refresh",params:{action:"discard",actor:"self",variableCount:!0},position:"bottom",trigger:"after_opponent_refresh",conditional:{type:"then",thenEffect:{id:"war-1-refresh",params:{action:"refresh",target:"self"},position:"bottom",trigger:"after_opponent_refresh"}}}]},{value:2,topEffects:[],middleEffects:[{id:"war-2-flip",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1}},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"war-2-opponent-discard-all",params:{action:"discard",actor:"opponent",count:"all"},position:"bottom",trigger:"after_opponent_compile"}]},{value:3,topEffects:[],middleEffects:[{id:"war-3-draw",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"war-3-play-facedown",params:{action:"play",source:"hand",count:1,faceDown:!0,optional:!0,destinationRule:{type:"other_lines"}},position:"bottom",trigger:"after_opponent_discard"}]},{value:4,topEffects:[],middleEffects:[{id:"war-4-opponent-discard",params:{action:"discard",actor:"opponent",count:1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"war-5-self-discard",params:{action:"discard",actor:"self",count:1},position:"middle",trigger:"on_play"}],bottomEffects:[]}],hy={id:_b,name:wb,description:xb,author:Cb,createdAt:Sb,color:bb,pattern:Eb,category:jb,cards:kb};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Rb=[Om,Mm,Hm,zm,Vm,Bm,Ym,Gm,Wm,Qm,Xm,Zm,Km,Jm,ey,ty,ny,ay,oy,ry,ly,sy,cy,iy,dy,uy,py,fy,hy],Nb=()=>Rb.map(a=>a.name.replace(/_custom$/i,"")),Tb=()=>{try{const a=pr(),t=a.findIndex(l=>l.id==="dark_cust_v2"||l.name==="Dark_cust");t>=0&&(a.splice(t,1),Qd(a)),_t(Om),_t(Mm),_t(zm),_t(Vm),_t(Bm),_t(Wm),_t(Qm),_t(Hm),_t(Xm),_t(Ym),_t(Gm),_t(Zm),_t(Km),_t(Jm),_t(ey),_t(ty),_t(ny),_t(ay),_t(oy),_t(ry),_t(ly),_t(sy),_t(cy),_t(iy),_t(dy),_t(uy),_t(py),_t(fy),_t(hy)}catch(a){console.error("[Default Protocols] Error loading default protocols:",a)}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const lu="compile_game_statistics",my=()=>{const a=c0,t=Nb(),l=new Set([...a,...t]);return Array.from(l).sort()},yy=1;function mm(){const a=my(),t={};return a.forEach(l=>{t[l]={timesUsed:0,wins:0,losses:0}}),{version:yy,global:{totalGamesPlayed:0,totalGamesWon:0,totalGamesLost:0,totalPlaytime:0,fastestWin:null,longestGame:null,lastGameDuration:null,currentStreak:0,longestWinStreak:0,longestLoseStreak:0},protocols:t,aiDifficulty:{easy:{played:0,wins:0,losses:0},normal:{played:0,wins:0,losses:0},hard:{played:0,wins:0,losses:0}},cards:{played:{},deleted:{}},actions:{totalCardsDrawn:0,totalCardsPlayed:0,totalShifts:0,totalDeletes:0,totalDiscards:0,totalFlips:0,totalCompiles:0,totalRefreshes:0,totalReturns:0,detailedStats:{cardsPlayed:{total:0,player:0,ai:0,playerFromHand:0,playerFromEffect:0,aiFromHand:0,aiFromEffect:0,playerFaceUp:0,playerFaceDown:0,aiFaceUp:0,aiFaceDown:0},cardsDrawn:{total:0,player:0,ai:0,playerFromRefresh:0,playerFromEffect:0,aiFromRefresh:0,aiFromEffect:0},discards:{total:0,player:0,ai:0},deletes:{total:0,player:0,ai:0},flips:{total:0,player:0,ai:0},shifts:{total:0,player:0,ai:0},returns:{total:0,player:0,ai:0},compiles:{total:0,player:0,ai:0,playerFirstCompile:0,playerRecompile:0,aiFirstCompile:0,aiRecompile:0},refreshes:{total:0,player:0,ai:0,playerCardsDrawn:0,aiCardsDrawn:0}}},control:{gamesWithControl:0,gamesWithoutControl:0,playerRearranges:0,aiRearranges:0,totalRearranges:0},coinFlip:{headsChosen:0,tailsChosen:0,headsWon:0,tailsWon:0}}}function Gd(){var a,t,l,c,i,d,f,p,u,h,y,g,_,x,S,E,b,j,C,R,A,I,U,$,Z,ee,z,O,k,q,F,D,T,L,B,G,ae,M,W,oe,Q,V,J,me,ge,Y,K,X,se,ie,_e,ye,ke,Ie,be,Pe,$e,Ae,Le,Re,Ne,ht,ct,Ct,wt,na,En,aa,Ta,pn,Mt,tn,It,oa,Aa,ya,On,fn,Jt,Qt,Mn,jn,Da,ga,ra,hn,la,va,_a,wa,sa,ca,ia,xa,fe,je,qe,ze,Oe,Qe,Je,rt,Ve,lt,Pt,mn,Xt,Et,Ft,to,no,kn,Hn,Uo,Ce,Te,Ye,at,qt,Lt,Vt,dn,zn,da,Rn,Fa,rl,jt,ao,Oo,oo,ua,Mo,Ho,yn,Zt,hr,qa,mr,ns,as,zo,Vn,yr,gr,$a,Ia;try{const Vo=localStorage.getItem(lu);if(!Vo)return mm();const Ue=JSON.parse(Vo),os=my(),Ca={...Ue.protocols||{}};os.forEach(ro=>{Ca[ro]||(Ca[ro]={timesUsed:0,wins:0,losses:0})});const Bn={...Ue,version:yy,global:{...Ue.global,lastGameDuration:((a=Ue.global)==null?void 0:a.lastGameDuration)||null},protocols:Ca,control:{gamesWithControl:((t=Ue.control)==null?void 0:t.gamesWithControl)||0,gamesWithoutControl:((l=Ue.control)==null?void 0:l.gamesWithoutControl)||0,playerRearranges:((c=Ue.control)==null?void 0:c.playerRearranges)||0,aiRearranges:((i=Ue.control)==null?void 0:i.aiRearranges)||0,totalRearranges:((d=Ue.control)==null?void 0:d.totalRearranges)||0},coinFlip:Ue.coinFlip||{headsChosen:0,tailsChosen:0,headsWon:0,tailsWon:0},actions:{...Ue.actions,totalCompiles:((f=Ue.actions)==null?void 0:f.totalCompiles)||0,totalRefreshes:((p=Ue.actions)==null?void 0:p.totalRefreshes)||0,totalReturns:((u=Ue.actions)==null?void 0:u.totalReturns)||0,detailedStats:{cardsPlayed:{total:((g=(y=(h=Ue.actions)==null?void 0:h.detailedStats)==null?void 0:y.cardsPlayed)==null?void 0:g.total)||0,player:((S=(x=(_=Ue.actions)==null?void 0:_.detailedStats)==null?void 0:x.cardsPlayed)==null?void 0:S.player)||0,ai:((j=(b=(E=Ue.actions)==null?void 0:E.detailedStats)==null?void 0:b.cardsPlayed)==null?void 0:j.ai)||0,playerFromHand:((A=(R=(C=Ue.actions)==null?void 0:C.detailedStats)==null?void 0:R.cardsPlayed)==null?void 0:A.playerFromHand)||0,playerFromEffect:(($=(U=(I=Ue.actions)==null?void 0:I.detailedStats)==null?void 0:U.cardsPlayed)==null?void 0:$.playerFromEffect)||0,aiFromHand:((z=(ee=(Z=Ue.actions)==null?void 0:Z.detailedStats)==null?void 0:ee.cardsPlayed)==null?void 0:z.aiFromHand)||0,aiFromEffect:((q=(k=(O=Ue.actions)==null?void 0:O.detailedStats)==null?void 0:k.cardsPlayed)==null?void 0:q.aiFromEffect)||0,playerFaceUp:((T=(D=(F=Ue.actions)==null?void 0:F.detailedStats)==null?void 0:D.cardsPlayed)==null?void 0:T.playerFaceUp)||0,playerFaceDown:((G=(B=(L=Ue.actions)==null?void 0:L.detailedStats)==null?void 0:B.cardsPlayed)==null?void 0:G.playerFaceDown)||0,aiFaceUp:((W=(M=(ae=Ue.actions)==null?void 0:ae.detailedStats)==null?void 0:M.cardsPlayed)==null?void 0:W.aiFaceUp)||0,aiFaceDown:((V=(Q=(oe=Ue.actions)==null?void 0:oe.detailedStats)==null?void 0:Q.cardsPlayed)==null?void 0:V.aiFaceDown)||0},cardsDrawn:{total:((ge=(me=(J=Ue.actions)==null?void 0:J.detailedStats)==null?void 0:me.cardsDrawn)==null?void 0:ge.total)||0,player:((X=(K=(Y=Ue.actions)==null?void 0:Y.detailedStats)==null?void 0:K.cardsDrawn)==null?void 0:X.player)||0,ai:((_e=(ie=(se=Ue.actions)==null?void 0:se.detailedStats)==null?void 0:ie.cardsDrawn)==null?void 0:_e.ai)||0,playerFromRefresh:((Ie=(ke=(ye=Ue.actions)==null?void 0:ye.detailedStats)==null?void 0:ke.cardsDrawn)==null?void 0:Ie.playerFromRefresh)||0,playerFromEffect:(($e=(Pe=(be=Ue.actions)==null?void 0:be.detailedStats)==null?void 0:Pe.cardsDrawn)==null?void 0:$e.playerFromEffect)||0,aiFromRefresh:((Re=(Le=(Ae=Ue.actions)==null?void 0:Ae.detailedStats)==null?void 0:Le.cardsDrawn)==null?void 0:Re.aiFromRefresh)||0,aiFromEffect:((ct=(ht=(Ne=Ue.actions)==null?void 0:Ne.detailedStats)==null?void 0:ht.cardsDrawn)==null?void 0:ct.aiFromEffect)||0},discards:{total:((na=(wt=(Ct=Ue.actions)==null?void 0:Ct.detailedStats)==null?void 0:wt.discards)==null?void 0:na.total)||0,player:((Ta=(aa=(En=Ue.actions)==null?void 0:En.detailedStats)==null?void 0:aa.discards)==null?void 0:Ta.player)||0,ai:((tn=(Mt=(pn=Ue.actions)==null?void 0:pn.detailedStats)==null?void 0:Mt.discards)==null?void 0:tn.ai)||0},deletes:{total:((Aa=(oa=(It=Ue.actions)==null?void 0:It.detailedStats)==null?void 0:oa.deletes)==null?void 0:Aa.total)||0,player:((fn=(On=(ya=Ue.actions)==null?void 0:ya.detailedStats)==null?void 0:On.deletes)==null?void 0:fn.player)||0,ai:((Mn=(Qt=(Jt=Ue.actions)==null?void 0:Jt.detailedStats)==null?void 0:Qt.deletes)==null?void 0:Mn.ai)||0},flips:{total:((ga=(Da=(jn=Ue.actions)==null?void 0:jn.detailedStats)==null?void 0:Da.flips)==null?void 0:ga.total)||0,player:((la=(hn=(ra=Ue.actions)==null?void 0:ra.detailedStats)==null?void 0:hn.flips)==null?void 0:la.player)||0,ai:((wa=(_a=(va=Ue.actions)==null?void 0:va.detailedStats)==null?void 0:_a.flips)==null?void 0:wa.ai)||0},shifts:{total:((ia=(ca=(sa=Ue.actions)==null?void 0:sa.detailedStats)==null?void 0:ca.shifts)==null?void 0:ia.total)||0,player:((je=(fe=(xa=Ue.actions)==null?void 0:xa.detailedStats)==null?void 0:fe.shifts)==null?void 0:je.player)||0,ai:((Oe=(ze=(qe=Ue.actions)==null?void 0:qe.detailedStats)==null?void 0:ze.shifts)==null?void 0:Oe.ai)||0},returns:{total:((rt=(Je=(Qe=Ue.actions)==null?void 0:Qe.detailedStats)==null?void 0:Je.returns)==null?void 0:rt.total)||0,player:((Pt=(lt=(Ve=Ue.actions)==null?void 0:Ve.detailedStats)==null?void 0:lt.returns)==null?void 0:Pt.player)||0,ai:((Et=(Xt=(mn=Ue.actions)==null?void 0:mn.detailedStats)==null?void 0:Xt.returns)==null?void 0:Et.ai)||0},compiles:{total:((no=(to=(Ft=Ue.actions)==null?void 0:Ft.detailedStats)==null?void 0:to.compiles)==null?void 0:no.total)||0,player:((Uo=(Hn=(kn=Ue.actions)==null?void 0:kn.detailedStats)==null?void 0:Hn.compiles)==null?void 0:Uo.player)||0,ai:((Ye=(Te=(Ce=Ue.actions)==null?void 0:Ce.detailedStats)==null?void 0:Te.compiles)==null?void 0:Ye.ai)||0,playerFirstCompile:((Lt=(qt=(at=Ue.actions)==null?void 0:at.detailedStats)==null?void 0:qt.compiles)==null?void 0:Lt.playerFirstCompile)||0,playerRecompile:((zn=(dn=(Vt=Ue.actions)==null?void 0:Vt.detailedStats)==null?void 0:dn.compiles)==null?void 0:zn.playerRecompile)||0,aiFirstCompile:((Fa=(Rn=(da=Ue.actions)==null?void 0:da.detailedStats)==null?void 0:Rn.compiles)==null?void 0:Fa.aiFirstCompile)||0,aiRecompile:((ao=(jt=(rl=Ue.actions)==null?void 0:rl.detailedStats)==null?void 0:jt.compiles)==null?void 0:ao.aiRecompile)||0},refreshes:{total:((ua=(oo=(Oo=Ue.actions)==null?void 0:Oo.detailedStats)==null?void 0:oo.refreshes)==null?void 0:ua.total)||0,player:((yn=(Ho=(Mo=Ue.actions)==null?void 0:Mo.detailedStats)==null?void 0:Ho.refreshes)==null?void 0:yn.player)||0,ai:((qa=(hr=(Zt=Ue.actions)==null?void 0:Zt.detailedStats)==null?void 0:hr.refreshes)==null?void 0:qa.ai)||0,playerCardsDrawn:((as=(ns=(mr=Ue.actions)==null?void 0:mr.detailedStats)==null?void 0:ns.refreshes)==null?void 0:as.playerCardsDrawn)||0,aiCardsDrawn:((yr=(Vn=(zo=Ue.actions)==null?void 0:zo.detailedStats)==null?void 0:Vn.refreshes)==null?void 0:yr.aiCardsDrawn)||0}}}};return(!((gr=Ue.control)!=null&&gr.playerRearranges)||!Ue.coinFlip||!(($a=Ue.actions)!=null&&$a.totalCompiles)||!((Ia=Ue.actions)!=null&&Ia.detailedStats)||Object.keys(Ca).length!==Object.keys(Ue.protocols||{}).length)&&Xr(Bn),Bn}catch(Vo){return console.error("Failed to load statistics:",Vo),mm()}}function Xr(a){try{localStorage.setItem(lu,JSON.stringify(a))}catch(t){console.error("Failed to save statistics:",t)}}function Ab(){try{localStorage.removeItem(lu)}catch(a){console.error("Failed to reset statistics:",a)}}function Db(a,t,l,c,i,d=!1,f,p,u,h){const y=t==="player",g={...a.global},_={...a.protocols},x={easy:{...a.aiDifficulty.easy},normal:{...a.aiDifficulty.normal},hard:{...a.aiDifficulty.hard}},S={...a.control},E={...a.actions},b={...a.coinFlip},j={played:{...a.cards.played},deleted:{...a.cards.deleted}};g.totalGamesPlayed++,y?g.totalGamesWon++:g.totalGamesLost++,g.totalPlaytime+=i,y&&(g.fastestWin===null||i<g.fastestWin)&&(g.fastestWin=i),(g.longestGame===null||i>g.longestGame)&&(g.longestGame=i),g.lastGameDuration=i,y?(g.currentStreak>=0?g.currentStreak++:g.currentStreak=1,g.currentStreak>g.longestWinStreak&&(g.longestWinStreak=g.currentStreak)):(g.currentStreak<=0?g.currentStreak--:g.currentStreak=-1,Math.abs(g.currentStreak)>g.longestLoseStreak&&(g.longestLoseStreak=Math.abs(g.currentStreak))),l.forEach(R=>{_[R]?_[R]={..._[R]}:_[R]={timesUsed:0,wins:0,losses:0},_[R].timesUsed++,y?_[R].wins++:_[R].losses++}),x[c].played++,y?x[c].wins++:x[c].losses++,d?S.gamesWithControl++:S.gamesWithoutControl++;const C={cardsPlayed:{...a.actions.detailedStats.cardsPlayed},cardsDrawn:{...a.actions.detailedStats.cardsDrawn},discards:{...a.actions.detailedStats.discards},deletes:{...a.actions.detailedStats.deletes},flips:{...a.actions.detailedStats.flips},shifts:{...a.actions.detailedStats.shifts},returns:{...a.actions.detailedStats.returns},compiles:{...a.actions.detailedStats.compiles},refreshes:{...a.actions.detailedStats.refreshes}};return f&&(E.totalCardsPlayed+=f.cardsPlayed,E.totalCardsDrawn+=f.cardsDrawn,E.totalDiscards+=f.cardsDiscarded,E.totalDeletes+=f.cardsDeleted,E.totalFlips+=f.cardsFlipped,E.totalShifts+=f.cardsShifted,E.totalRefreshes+=f.handsRefreshed,E.totalReturns+=f.cardsReturned||0,C.cardsPlayed.total+=f.cardsPlayed,C.cardsPlayed.player+=f.cardsPlayed,C.cardsDrawn.total+=f.cardsDrawn,C.cardsDrawn.player+=f.cardsDrawn,C.discards.total+=f.cardsDiscarded,C.discards.player+=f.cardsDiscarded,C.deletes.total+=f.cardsDeleted,C.deletes.player+=f.cardsDeleted,C.flips.total+=f.cardsFlipped,C.flips.player+=f.cardsFlipped,C.shifts.total+=f.cardsShifted,C.shifts.player+=f.cardsShifted,C.returns.total+=f.cardsReturned||0,C.returns.player+=f.cardsReturned||0,C.refreshes.total+=f.handsRefreshed,C.refreshes.player+=f.handsRefreshed),u&&(E.totalCardsPlayed+=u.cardsPlayed,E.totalCardsDrawn+=u.cardsDrawn,E.totalDiscards+=u.cardsDiscarded,E.totalDeletes+=u.cardsDeleted,E.totalFlips+=u.cardsFlipped,E.totalShifts+=u.cardsShifted,E.totalRefreshes+=u.handsRefreshed,E.totalReturns+=u.cardsReturned||0,C.cardsPlayed.total+=u.cardsPlayed,C.cardsPlayed.ai+=u.cardsPlayed,C.cardsDrawn.total+=u.cardsDrawn,C.cardsDrawn.ai+=u.cardsDrawn,C.discards.total+=u.cardsDiscarded,C.discards.ai+=u.cardsDiscarded,C.deletes.total+=u.cardsDeleted,C.deletes.ai+=u.cardsDeleted,C.flips.total+=u.cardsFlipped,C.flips.ai+=u.cardsFlipped,C.shifts.total+=u.cardsShifted,C.shifts.ai+=u.cardsShifted,C.returns.total+=u.cardsReturned||0,C.returns.ai+=u.cardsReturned||0,C.refreshes.total+=u.handsRefreshed,C.refreshes.ai+=u.handsRefreshed),h&&(h.cardsPlayed&&(C.cardsPlayed.playerFromHand+=h.cardsPlayed.playerFromHand,C.cardsPlayed.playerFromEffect+=h.cardsPlayed.playerFromEffect,C.cardsPlayed.aiFromHand+=h.cardsPlayed.aiFromHand,C.cardsPlayed.aiFromEffect+=h.cardsPlayed.aiFromEffect,C.cardsPlayed.playerFaceUp+=h.cardsPlayed.playerFaceUp,C.cardsPlayed.playerFaceDown+=h.cardsPlayed.playerFaceDown,C.cardsPlayed.aiFaceUp+=h.cardsPlayed.aiFaceUp,C.cardsPlayed.aiFaceDown+=h.cardsPlayed.aiFaceDown),h.cardsDrawn&&(C.cardsDrawn.playerFromRefresh+=h.cardsDrawn.playerFromRefresh,C.cardsDrawn.playerFromEffect+=h.cardsDrawn.playerFromEffect,C.cardsDrawn.aiFromRefresh+=h.cardsDrawn.aiFromRefresh,C.cardsDrawn.aiFromEffect+=h.cardsDrawn.aiFromEffect),h.compiles&&(C.compiles.playerFirstCompile+=h.compiles.playerFirstCompile,C.compiles.playerRecompile+=h.compiles.playerRecompile,C.compiles.aiFirstCompile+=h.compiles.aiFirstCompile,C.compiles.aiRecompile+=h.compiles.aiRecompile,C.compiles.player+=h.compiles.playerFirstCompile+h.compiles.playerRecompile,C.compiles.ai+=h.compiles.aiFirstCompile+h.compiles.aiRecompile,C.compiles.total+=h.compiles.playerFirstCompile+h.compiles.playerRecompile+h.compiles.aiFirstCompile+h.compiles.aiRecompile),h.refreshes&&(C.refreshes.playerCardsDrawn+=h.refreshes.playerCardsDrawn,C.refreshes.aiCardsDrawn+=h.refreshes.aiCardsDrawn)),p!==void 0&&(E.totalCompiles+=p),E.detailedStats=C,{version:a.version,global:g,protocols:_,aiDifficulty:x,cards:j,actions:E,control:S,coinFlip:b}}function Fb(a,t){const l={...a,cards:{...a.cards,played:{...a.cards.played}}};return l.cards.played[t]||(l.cards.played[t]=0),l.cards.played[t]++,l}function qb(a,t){const l={...a,cards:{...a.cards,deleted:{...a.cards.deleted}}};return l.cards.deleted[t]||(l.cards.deleted[t]=0),l.cards.deleted[t]++,l}function $b(a,t){const l={...a,control:{...a.control}};return t==="player"?l.control.playerRearranges++:l.control.aiRearranges++,l.control.totalRearranges++,l}function Ib(a,t,l){const c={...a,coinFlip:{...a.coinFlip}};return t==="heads"?(c.coinFlip.headsChosen++,l&&c.coinFlip.headsWon++):(c.coinFlip.tailsChosen++,l&&c.coinFlip.tailsWon++),c}function Lb(a){return a.global.totalGamesPlayed===0?0:a.global.totalGamesWon/a.global.totalGamesPlayed*100}function Pb(a){return a.global.totalGamesPlayed===0?0:Math.floor(a.global.totalPlaytime/a.global.totalGamesPlayed)}function Ub(a){return Object.entries(a.protocols).map(([l,c])=>({protocol:l,timesUsed:c.timesUsed,winRate:c.timesUsed>0?c.wins/c.timesUsed*100:0})).sort((l,c)=>c.timesUsed-l.timesUsed).slice(0,5)}function Ob(a){return Object.entries(a.protocols).filter(([l,c])=>c.timesUsed>=3).map(([l,c])=>({protocol:l,timesUsed:c.timesUsed,winRate:c.wins/c.timesUsed*100})).sort((l,c)=>c.winRate-l.winRate).slice(0,5)}function Mb(a){return Object.entries(a.protocols).map(([l,c])=>({protocol:l,timesUsed:c.timesUsed,winRate:c.timesUsed>0?c.wins/c.timesUsed*100:0})).sort((l,c)=>l.timesUsed-c.timesUsed).slice(0,5)}function Hb(a){return Object.entries(a.cards.played).map(([l,c])=>({card:l,count:c})).sort((l,c)=>c.count-l.count).slice(0,5)}function zb(a){return Object.entries(a.cards.deleted).map(([l,c])=>({card:l,count:c})).sort((l,c)=>c.count-l.count).slice(0,5)}function Wl(a){const t=Math.floor(a/3600),l=Math.floor(a%3600/60),c=a%60;return t>0?`${t}h ${l}m`:l>0?`${l}m ${c}s`:`${c}s`}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function Vb(a,t,l){const[c,i]=le.useState(()=>Gd()),d=le.useRef(null),f=le.useCallback(()=>{d.current=Date.now()},[]),p=le.useCallback((_,x)=>{i(S=>{const E=`${_}-${x}`,b=Fb(S,E);return Xr(b),b})},[]),u=le.useCallback((_,x)=>{i(S=>{const E=`${_}-${x}`,b=qb(S,E);return Xr(b),b})},[]),h=le.useCallback((_,x)=>{i(S=>{const E=Ib(S,_,x);return Xr(E),E})},[]),y=le.useCallback(_=>{i(x=>{const S=$b(x,_);return Xr(S),S})},[]),g=le.useCallback((_,x,S,E,b)=>{if(d.current===null)return;const j=Math.floor((Date.now()-d.current)/1e3);i(C=>{const R=Db(C,_,a,t,j,l,x,S,E,b);return Xr(R),R}),d.current=null},[a,t,l]);return{statistics:c,startGame:f,endGame:g,trackPlayerCardPlayed:p,trackPlayerCardDeleted:u,trackPlayerCoinFlip:h,trackPlayerRearrange:y}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function v(a,t,l=!0){const i=Po().find(d=>d.protocol===a&&d.value===t);return i?{id:ot(),protocol:i.protocol,value:i.value,top:i.top,middle:i.middle,bottom:i.bottom,keywords:i.keywords,isFaceUp:l,isRevealed:!1,category:i.category||"Main",...i.customEffects&&{customEffects:i.customEffects}}:(console.warn(`Card not found: ${a}-${t}`),{id:ot(),protocol:a,value:t,top:"",middle:"",bottom:"",keywords:{},isFaceUp:l,isRevealed:!1,category:"Main"})}function P(a,t,l,c){const i={...a},d={...i[t]},f=[...d.lanes];return f[l]=[...f[l],c],d.lanes=f,i[t]=d,i}function al(a,t){const l=[],c=Po();for(const i of a){const d=c.filter(f=>f.protocol===i);for(const f of d)t.some(u=>u.protocol===f.protocol&&u.value===f.value)||l.push(v(f.protocol,f.value,!0))}return l}function De(a,t,l,c,i){return{...a,player:{...a.player,protocols:t,lanes:[[],[],[]],hand:[]},opponent:{...a.opponent,protocols:l,lanes:[[],[],[]],hand:[]},turn:c,phase:i,actionRequired:null,queuedActions:[],_interruptedTurn:void 0,_interruptedPhase:void 0,processedStartEffectIds:[],processedEndEffectIds:[],processedUncoverEventIds:[]}}function Fe(a){const t=[...a.player.hand,...a.player.lanes.flat()],l=[...a.opponent.hand,...a.opponent.lanes.flat()],c=al(a.player.protocols,t),i=al(a.opponent.protocols,l),d=a.turn==="player"?"Player":"Opponent",f=[{player:"player",message:`Player protocols: ${a.player.protocols.join(", ")}`},{player:"opponent",message:`Opponent protocols: ${a.opponent.protocols.join(", ")}`},{player:a.turn,message:`${d} goes first.`},{player:"player",message:"---"},{player:a.turn,message:`[Test Scenario] Phase: ${a.phase}`}];return{...a,player:{...a.player,deck:c,discard:[],compiled:[!1,!1,!1]},opponent:{...a.opponent,deck:i,discard:[],compiled:[!1,!1,!1]},log:f}}const gy={name:"Psychic-3 Uncover whrend Opponent's Turn",description:"Player lscht Opponent's face-down card  Psychic-3 uncovered  Player discardet, Opponent shiftet",setup:a=>{let t=De(a,["Hate","Fire","Water"],["Psychic","Death","Spirit"],"player","action");return t.player.hand=[v("Hate",0,!0),v("Fire",1,!0),v("Water",1,!0)],t=P(t,"opponent",1,v("Psychic",3,!0)),t=P(t,"opponent",1,v("Fire",1,!1)),t=Ee(t),Fe(t)}},vy={name:"Psychic-4 End Effect mit Uncover-Interrupt",description:"Psychic-4 returnt Fire-2  Fire-4 uncovered  Interrupt  Psychic-4 flip aus Queue",setup:a=>{let t=De(a,["Fire","Water","Spirit"],["Psychic","Death","Metal"],"opponent","end");return t=P(t,"opponent",0,v("Psychic",4,!0)),t=P(t,"player",1,v("Fire",4,!0)),t=P(t,"player",1,v("Fire",2,!0)),t.opponent.hand=[v("Water",1),v("Water",2)],t=Ee(t),Fe(t)}},_y={name:"Spirit-3 Draw whrend End Phase",description:"Spirit-3 draw in End Phase  Shift-prompt in Queue  Player kann lanes klicken",setup:a=>{let t=De(a,["Spirit","Fire","Water"],["Death","Metal","Psychic"],"player","action");t=P(t,"player",0,v("Spirit",3,!0));const l=Po(),c=l.find(f=>f.protocol==="Fire"&&f.value===1),i=l.find(f=>f.protocol==="Water"&&f.value===1),d=l.find(f=>f.protocol==="Spirit"&&f.value===1);return t.player.deck=[c,i,d],t=Ee(t),Fe(t)}},wy={name:"Plague-2 Actor Propagation",description:"Player spielt Plague-2  Player discardet  Opponent discardet (actor korrekt)",setup:a=>{let t=De(a,["Plague","Death","Hate"],["Fire","Water","Spirit"],"player","action");return t.player.hand=[v("Plague",2,!0),v("Fire",1),v("Water",1),v("Spirit",1)],t.opponent.hand=[v("Fire",2),v("Water",2),v("Spirit",2),v("Death",2)],t=Ee(t),Fe(t)}},xy={name:"Darkness-1 Flip + Shift mit Interrupt",description:"Darkness-1 flippt Fire-0  Delete-Interrupt  Player shiftet",setup:a=>{let t=De(a,["Darkness","Fire","Water"],["Spirit","Death","Metal"],"player","action");return t.player.hand=[v("Darkness",1,!0)],t=P(t,"opponent",0,v("Fire",0,!1)),t=Ee(t),Fe(t)}},Cy={name:"Plague-4 Owner vs Turn Check",description:"Plague-4 End  Player deletet  Opponent (owner) wird fr flip gefragt",setup:a=>{let t=De(a,["Fire","Water","Spirit"],["Plague","Death","Metal"],"opponent","end");return t=P(t,"opponent",0,v("Plague",4,!0)),t=P(t,"player",1,v("Water",2,!1)),t=Ee(t),Fe(t)}},Sy={name:"Water Owner vs Turn Check",description:"Plague-4 End  Player deletet  Opponent (owner) wird fr flip gefragt",setup:a=>{let t=De(a,["Fire","Water","Spirit"],["Plague","Death","Metal"],"player","action");return t=P(t,"opponent",0,v("Plague",4,!0)),t=P(t,"player",2,v("Water",4,!1)),t.player.hand=[v("Water",0,!0),v("Fire",1),v("Water",1),v("Spirit",1)],t.opponent.hand=[v("Fire",2),v("Water",2),v("Spirit",2),v("Death",2)],t=Ee(t),Fe(t)}},by={name:"Hate-1 Multi-Delete mit Uncover-Interrupt",description:"Hate-1 lscht Plague-0  Plague-5 uncovered  Interrupt  Player macht 2. Delete",setup:a=>{let t=De(a,["Fire","Hate","Water"],["Plague","Death","Metal"],"player","action");return t.player.hand=[v("Hate",1,!0),v("Psychic",2,!0),v("Psychic",4,!0),v("Hate",4,!0),v("Water",1,!0)],t=P(t,"opponent",0,v("Plague",2,!0)),t=P(t,"opponent",0,v("Plague",0,!0)),t=P(t,"player",0,v("War",3,!0)),t.opponent.hand=[v("Fire",2,!0),v("Water",2,!0),v("Spirit",2,!0),v("Death",2,!0),v("Metal",2,!0)],t=Ee(t),Fe(t)}},Ey={name:"Darkness-1  Hate-0 Flip  Multi-Effect Chain",description:" Darkness-1 flippt Hate-0  Delete-Interrupt  Draw-Interrupt  Shift aus Queue",setup:a=>{let t=De(a,["Darkness","Fire","Water"],["Hate","Death","Metal"],"player","action");t.player.hand=[v("Darkness",1,!0)],t=P(t,"opponent",0,v("Hate",0,!1)),t=P(t,"opponent",1,v("Hate",3,!0)),t=P(t,"opponent",2,v("Fire",1,!1)),t=P(t,"player",1,v("Water",2,!0)),t.opponent.hand=[v("Death",2),v("Metal",3)];const c=Po().find(i=>i.protocol==="Death"&&i.value===1);return t.opponent.deck=[c],t=Ee(t),Fe(t)}},jy={name:"Water-4 Return  Turn End",description:" Water-4 returnt Karte  Turn endet (Bug-Fix: Opponent spielt nicht zweimal)",setup:a=>{let t=De(a,["Hate","Spirit","Light"],["Fire","Water","Death"],"opponent","action");return t.opponent.hand=[v("Water",4,!0)],t=P(t,"opponent",0,v("Life",4,!0)),t=P(t,"opponent",2,v("Death",4,!1)),t=P(t,"player",1,v("Spirit",1,!0)),t=P(t,"player",2,v("Light",5,!1)),t.player.hand=[v("Fire",1),v("Spirit",2),v("Hate",4)],t=Ee(t),Fe(t)}},ky={name:"Psychic-3 Discard + Shift",description:" Psychic-3 On-Play  Player discardet  AI shiftet (Bug-Fix: AI kann shiften)",setup:a=>{let t=De(a,["Fire","Water","Spirit"],["Psychic","Death","Metal"],"opponent","action");return t.opponent.hand=[v("Psychic",3,!0)],t.player.hand=[v("Fire",1),v("Water",2),v("Spirit",1)],t=P(t,"player",0,v("Fire",2,!0)),t=P(t,"player",1,v("Water",3,!0)),t=P(t,"player",2,v("Spirit",4,!0)),t=Ee(t),Fe(t)}},Ry={name:"Death-1 Delete  Speed-3 Uncover",description:" Death-1 lscht Light-0  Speed-3 uncovered  Player shiftet (Bug-Fix Test)",setup:a=>{let t=De(a,["Speed","Light","Water"],["Death","Fire","Metal"],"opponent","start");return t=P(t,"player",0,v("Speed",3,!0)),t=P(t,"player",0,v("Light",0,!0)),t=P(t,"player",1,v("Water",1,!0)),t=P(t,"opponent",0,v("Death",1,!0)),t.player.hand=[],t.opponent.hand=[],t=Ee(t),Fe(t)}},Ny={name:"Gravity-2 Flip  Metal-5 Discard  Shift",description:" Gravity-2 flippt Metal-5  Discard Interrupt  shiften (Bug-Fix: AI stuck)",setup:a=>{let t=De(a,["Fire","Water","Light"],["Gravity","Metal","Fire"],"opponent","action");return t.opponent.hand=[v("Gravity",2,!0),v("Fire",1)],t=P(t,"opponent",1,v("Metal",5,!1)),t=P(t,"player",0,v("Fire",2,!0)),t=P(t,"player",2,v("Light",3,!0)),t.player.hand=[v("Water",1),v("Fire",3)],t=Ee(t),Fe(t)}},Ty={name:"Hate-2 Player spielt (Einfach)",description:" Player spielt Hate-2  Whlt eigene & Gegners hchste Karte",setup:a=>{let t=De(a,["Hate","Water","Light"],["Metal","Death","Gravity"],"player","action");return t.player.hand=[v("Hate",2,!0)],t=P(t,"player",0,v("Fire",4,!0)),t=P(t,"player",1,v("Water",2,!0)),t=P(t,"player",2,v("Light",5,!0)),t=P(t,"opponent",0,v("Metal",3,!0)),t=P(t,"opponent",1,v("Death",5,!0)),t=P(t,"opponent",2,v("Gravity",2,!1)),t=Ee(t),Fe(t)}},Ay={name:"Hate-2 AI spielt (Normal)",description:" AI spielt Hate-2  AI whlt eigene & Players hchste automatisch",setup:a=>{let t=De(a,["Water","Spirit","Light"],["Hate","Metal","Death"],"opponent","action");return t.opponent.hand=[v("Hate",2,!0)],t=P(t,"opponent",0,v("Fire",5,!0)),t=P(t,"opponent",1,v("Metal",3,!0)),t=P(t,"opponent",2,v("Death",2,!1)),t=P(t,"player",0,v("Water",4,!0)),t=P(t,"player",1,v("Spirit",5,!0)),t=P(t,"player",2,v("Light",2,!0)),t=Ee(t),Fe(t)}},Dy={name:"Hate-2 AI spielt (Normal) mit Auswahl",description:" AI spielt Hate-2  AI whlt eigene & Players hchste automatisch",setup:a=>{let t=De(a,["Water","Spirit","Light"],["Hate","Metal","Death"],"opponent","action");return t.opponent.hand=[v("Hate",2,!0)],t=P(t,"opponent",0,v("Fire",5,!0)),t=P(t,"opponent",1,v("Metal",3,!0)),t=P(t,"opponent",2,v("Death",2,!1)),t=P(t,"player",0,v("Water",4,!0)),t=P(t,"player",1,v("Spirit",5,!0)),t=P(t,"player",2,v("Light",5,!0)),t=Ee(t),Fe(t)}},Fy={name:"Hate-2 Selbst-Lschung",description:" Hate-2 lscht sich selbst  Zweite Klausel entfllt (Regelwerk-Check)",setup:a=>{let t=De(a,["Hate","Fire","Water"],["Metal","Death","Gravity"],"player","action");return t.player.hand=[v("Hate",2,!0)],t=P(t,"player",1,v("Fire",1,!0)),t=P(t,"player",2,v("Water",0,!0)),t=P(t,"opponent",0,v("Metal",3,!0)),t=P(t,"opponent",1,v("Death",5,!0)),t=Ee(t),Fe(t)}},qy={name:"Hate-2 Gleichstand (Auswahl)",description:" Hate-2 mit mehreren hchsten  Player muss whlen (Tied values)",setup:a=>{let t=De(a,["Hate","Water","Spirit"],["Metal","Death","Gravity"],"player","action");return t.player.hand=[v("Hate",2,!0)],t=P(t,"player",0,v("Fire",4,!0)),t=P(t,"player",1,v("Water",4,!0)),t=P(t,"player",2,v("Spirit",4,!0)),t=P(t,"opponent",0,v("Metal",5,!0)),t=P(t,"opponent",1,v("Death",5,!0)),t=P(t,"opponent",2,v("Gravity",2,!1)),t=Ee(t),Fe(t)}},$y={name:"Hate-2 Face-Down Karten",description:" Hate-2 mit face-down  Alle face-down sind value 2 (Tied mit Hate-2)",setup:a=>{let t=De(a,["Hate","Fire","Water"],["Metal","Death","Gravity"],"player","action");return t.player.hand=[v("Hate",2,!0)],t=P(t,"player",1,v("Fire",5,!1)),t=P(t,"player",2,v("Water",5,!1)),t=P(t,"opponent",0,v("Metal",5,!0)),t=P(t,"opponent",1,v("Death",4,!1)),t=P(t,"opponent",2,v("Gravity",1,!0)),t=Ee(t),Fe(t)}},Iy={name:"Hate-2 AI Play-Validation",description:" AI spielt Hate-2 NICHT face-up wenn es sich selbst lschen wrde",setup:a=>{let t=De(a,["Fire","Water","Spirit"],["Hate","Death","Metal"],"opponent","action");return t.opponent.hand=[v("Hate",2,!0)],t=P(t,"opponent",1,v("Fire",0,!0)),t=P(t,"opponent",2,v("Water",1,!0)),t=P(t,"player",0,v("Fire",5,!0)),t=P(t,"player",1,v("Water",4,!0)),t=Ee(t),Fe(t)}},Ly={name:"Hate-2 AI spielt OFFEN (Optimal)",description:" AI spielt Hate-2 offen weil nicht hchste Karte",setup:a=>{let t=De(a,["Water","Spirit","Light"],["Hate","Metal","Death"],"opponent","action");return t.opponent.hand=[v("Hate",2,!0)],t=P(t,"opponent",0,v("Fire",5,!0)),t=P(t,"opponent",1,v("Metal",4,!0)),t=P(t,"opponent",2,v("Death",3,!0)),t=P(t,"player",0,v("Water",2,!0)),t=P(t,"player",1,v("Spirit",5,!0)),t=P(t,"player",2,v("Light",1,!0)),t=Ee(t),Fe(t)}},Bb={name:"Chaos-3 Protocol-Free Playing",description:"Player with Chaos-3 can play any card face-up in any lane",setup:a=>{let t=De(a,["Chaos","Fire","Water"],["Spirit","Death","Metal"],"player","action");return t=P(t,"player",0,v("Chaos",3,!0)),t.player.hand=[v("Gravity",2,!0),v("Hate",3,!0),v("Love",1,!0)],t=Ee(t),Fe(t)}},Yb={name:"Frost-3 Blocks Shifts (Covered)",description:"Frost-3 should prevent shifts even when covered (Top-Box effect always active)",setup:a=>{let t=De(a,["Gravity","Water","Fire"],["Frost","Metal","Death"],"player","action");return t=P(t,"opponent",0,v("Frost",3,!0)),t=P(t,"opponent",0,v("Metal",2,!1)),t=P(t,"player",1,v("Water",2,!0)),t.player.hand=[v("Gravity",1,!0),v("Fire",2,!0)],t=Ee(t),Fe(t)}},Gb={name:"Water-0 Softlock Bug Fix",description:"Water-0 self-flip should be cancelled when card becomes covered before self-flip executes",setup:a=>{let t=De(a,["Water","Darkness","Light"],["Apathy","Fire","Death"],"player","action");return t=P(t,"player",1,v("Darkness",3,!1)),t.player.hand=[v("Water",0,!0),v("Darkness",2,!0),v("Fire",1,!0)],t=Ee(t),Fe(t)}},Wb={name:"Darkness-1 Flip and Shift Chain",description:"Darkness-1 should flip opponent card, then allow shifting that same card",setup:a=>{let t=De(a,["Darkness","Water","Fire"],["Metal","Fire","Death"],"player","action");return t=P(t,"opponent",0,v("Metal",2,!1)),t=P(t,"opponent",1,v("Fire",1,!0)),t=P(t,"opponent",2,v("Hate",0,!1)),t.player.hand=[v("Darkness",1,!0),v("Water",2,!0),v("Fire",3,!0)],t=Ee(t),Fe(t)}},Qb={name:"Darkness-1 Flips Speed-3 - Middle Effect Execution",description:"When Darkness-1 flips Speed-3, Speed-3's middle effect (shift) should execute before Darkness-1's shift",setup:a=>{let t=De(a,["Darkness","Water","Fire"],["Speed","Fire","Metal"],"player","action");return t=P(t,"opponent",0,v("Speed",3,!1)),t=P(t,"opponent",1,v("Fire",1,!0)),t=P(t,"opponent",2,v("Metal",2,!0)),t.player.hand=[v("Darkness",1,!0),v("Water",2,!0),v("Fire",3,!0)],t=Ee(t),Fe(t)}},Xb={name:"Darkness-1 Flips Speed-3 - Middle Effect Execution",description:"When Darkness-1 flips Speed-3, Speed-3's middle effect (shift) should execute before Darkness-1's shift",setup:a=>{let t=De(a,["Darkness","Water","Fire"],["Speed","Fire","Metal"],"player","action");return t=P(t,"opponent",0,v("Speed",3,!1)),t=P(t,"opponent",1,v("Fire",1,!0)),t=P(t,"opponent",2,v("Metal",2,!0)),t.player.hand=[v("Darkness",1,!0),v("Water",2,!0),v("Fire",3,!0)],t=Ee(t),Fe(t)}},Py={name:"Fire-1 & Fire-2 Conditional Test",description:" Fire-1 (discard -> delete) & Fire-2 (discard -> return) if_executed logic",setup:a=>{let t=De(a,["Fire","Water","Spirit"],["Metal","Death","Fire"],"player","action");return t.player.hand=[v("Fire",1,!0),v("Fire",2,!0),v("Fire",0,!0),v("Fire",3,!0),v("Fire",4,!0),v("Fire",5,!0)],t=P(t,"opponent",0,v("Metal",3,!0)),t=P(t,"opponent",1,v("Death",4,!0)),t=P(t,"opponent",2,v("Fire",2,!0)),t=P(t,"opponent",0,v("Metal",1,!0)),t=P(t,"player",2,v("Spirit",3,!0)),t=P(t,"player",1,v("Water",3,!0)),t=P(t,"player",2,v("Spirit",2,!0)),t=Ee(t),Fe(t)}},Uy={name:"Anarchy Test Playground",description:" All Anarchy cards on hand for testing",setup:a=>{let t=De(a,["Anarchy","Water","Spirit"],["Metal","Death","Fire"],"player","action");return t.player.hand=[v("Anarchy",0,!0),v("Anarchy",1,!0),v("Anarchy",2,!0),v("Anarchy",3,!0),v("Anarchy",5,!0),v("Anarchy",6,!0)],t=P(t,"opponent",0,v("Metal",3,!0)),t=P(t,"opponent",1,v("Death",4,!1)),t=P(t,"opponent",2,v("Fire",2,!0)),t=P(t,"opponent",0,v("Metal",1,!0)),t=P(t,"player",2,v("Spirit",3,!0)),t=P(t,"player",1,v("Water",3,!0)),t=P(t,"player",2,v("Spirit",2,!0)),t=Ee(t),Fe(t)}},Oy={name:"Darkness Test Playground",description:" All Darkness cards on hand for testing",setup:a=>{let t=De(a,["Darkness","Water","Spirit"],["Metal","Death","Fire"],"player","action");return t.player.hand=[v("Darkness",0,!0),v("Darkness",1,!0),v("Darkness",2,!0),v("Darkness",3,!0),v("Darkness",4,!0),v("Darkness",5,!0)],t=P(t,"opponent",0,v("Metal",3,!1)),t=P(t,"opponent",1,v("Death",4,!0)),t=P(t,"opponent",2,v("Fire",2,!1)),t=P(t,"opponent",0,v("Metal",1,!0)),t=P(t,"opponent",1,v("Death",2,!1)),t=P(t,"player",2,v("Spirit",3,!0)),t=P(t,"player",1,v("Water",3,!0)),t=P(t,"player",2,v("Spirit",2,!0)),t=Ee(t),Fe(t)}},My={name:"Apathy Test Playground",description:" All Apathy cards on hand for testing",setup:a=>{let t=De(a,["Apathy","Water","Spirit"],["Metal","Death","Fire"],"player","action");return t.player.hand=[v("Apathy",0,!0),v("Apathy",1,!0),v("Apathy",2,!0),v("Apathy",3,!0),v("Apathy",4,!0),v("Apathy",5,!0)],t=P(t,"opponent",0,v("Metal",3,!0)),t=P(t,"opponent",1,v("Death",4,!0)),t=P(t,"opponent",2,v("Fire",2,!0)),t=P(t,"opponent",0,v("Metal",1,!0)),t=P(t,"opponent",2,v("Fire",1,!1)),t=P(t,"player",2,v("Spirit",3,!0)),t=P(t,"player",1,v("Water",3,!0)),t=P(t,"player",2,v("Spirit",2,!0)),t=Ee(t),Fe(t)}},Hy={name:"Death Test Playground",description:" All Death cards on hand for testing",setup:a=>{let t=De(a,["Death_cust","Water","Spirit"],["Metal","Death","Fire"],"player","action");return t.player.hand=[v("Death_cust",0,!0),v("Death_cust",1,!0),v("Death_cust",2,!0),v("Death_cust",3,!0),v("Death_cust",4,!0),v("Death_cust",5,!0)],t=P(t,"opponent",0,v("Metal",0,!0)),t=P(t,"opponent",1,v("Death",1,!0)),t=P(t,"opponent",2,v("Fire",3,!0)),t=P(t,"opponent",0,v("Metal",2,!0)),t=P(t,"opponent",1,v("Death",4,!1)),t=P(t,"player",2,v("Spirit",3,!0)),t=P(t,"player",1,v("Water",3,!0)),t=P(t,"player",2,v("Spirit",2,!0)),t=Ee(t),Fe(t)}},zy={name:"Water Test Playground",description:" All Water cards on hand for testing - wash away and renew",setup:a=>{let t=De(a,["Water","Fire","Spirit"],["Metal","Death","Light"],"player","action");return t.player.hand=[v("Water",0,!0),v("Water",1,!0),v("Water",2,!0),v("Water",3,!0),v("Water",4,!0),v("Water",5,!0)],t=P(t,"opponent",0,v("Metal",2,!0)),t=P(t,"opponent",1,v("Death",3,!0)),t=P(t,"opponent",2,v("Light",2,!0)),t=P(t,"opponent",0,v("Metal",4,!0)),t=P(t,"opponent",1,v("Death",2,!1)),t=P(t,"opponent",2,v("Light",5,!1)),t=P(t,"player",1,v("Fire",2,!0)),t=P(t,"player",2,v("Spirit",3,!0)),t=P(t,"player",1,v("Fire",4,!0)),t=P(t,"player",2,v("Spirit",5,!1)),t=Ee(t),Fe(t)}},Vy={name:"Spirit Test Playground",description:" All Spirit cards on hand - true strength from within",setup:a=>{let t=De(a,["Spirit","Fire","Water"],["Metal","Death","Light"],"player","action");return t.player.hand=[v("Spirit",0,!0),v("Spirit",1,!0),v("Spirit",2,!0),v("Spirit",3,!0),v("Spirit",4,!0),v("Spirit",5,!0)],t=P(t,"opponent",0,v("Metal",3,!0)),t=P(t,"opponent",1,v("Death",2,!1)),t=P(t,"opponent",2,v("Light",4,!0)),t=P(t,"opponent",0,v("Metal",5,!1)),t=P(t,"opponent",2,v("Light",3,!0)),t=P(t,"player",1,v("Fire",2,!0)),t=P(t,"player",2,v("Water",4,!0)),t=P(t,"player",1,v("Fire",3,!1)),t=Ee(t),Fe(t)}},By={name:"Chaos Test Playground",description:" All Chaos cards on hand - embrace the unpredictable",setup:a=>{let t=De(a,["Chaos","Fire","Water"],["Metal","Death","Light"],"player","action");return t.player.hand=[v("Chaos",0,!0),v("Chaos",1,!0),v("Chaos",2,!0),v("Chaos",3,!0),v("Chaos",4,!0),v("Chaos",5,!0)],t=P(t,"opponent",0,v("Metal",2,!0)),t=P(t,"opponent",0,v("Metal",4,!0)),t=P(t,"opponent",1,v("Death",3,!1)),t=P(t,"opponent",1,v("Death",5,!0)),t=P(t,"opponent",2,v("Light",1,!0)),t=P(t,"opponent",2,v("Light",3,!1)),t=P(t,"player",0,v("Fire",2,!0)),t=P(t,"player",0,v("Fire",4,!0)),t=P(t,"player",1,v("Water",3,!1)),t=P(t,"player",1,v("Water",5,!0)),t=P(t,"player",2,v("Fire",1,!0)),t=Ee(t),Fe(t)}},Yy={name:"Gravity Test Playground",description:" All Gravity cards on hand - pull everything together",setup:a=>{let t=De(a,["Fire","Gravity","Water"],["Metal","Death","Light"],"player","action");return t.player.hand=[v("Gravity",0,!0),v("Gravity",1,!0),v("Gravity",2,!0),v("Gravity",4,!0),v("Gravity",5,!0),v("Gravity",6,!0)],t=P(t,"player",0,v("Fire",1,!0)),t=P(t,"player",2,v("Water",2,!1)),t=P(t,"opponent",0,v("Metal",3,!1)),t=P(t,"opponent",0,v("Metal",4,!0)),t=P(t,"opponent",1,v("Death",2,!1)),t=P(t,"opponent",1,v("Death",3,!0)),t=P(t,"opponent",2,v("Light",4,!1)),t.opponent.deck=[v("Metal",5,!0),v("Death",4,!0),v("Light",5,!0)],t=Ee(t),Fe(t)}},Gy={name:"Frost Test Playground",description:" All Frost cards on hand - pull everything together",setup:a=>{let t=De(a,["Fire","Frost","Water"],["Metal","Death","Light"],"player","action");return t.player.hand=[v("Frost",0,!0),v("Frost",1,!0),v("Frost",2,!0),v("Frost",3,!0),v("Frost",4,!0),v("Frost",5,!0)],t=P(t,"player",0,v("Fire",1,!0)),t=P(t,"player",2,v("Water",2,!1)),t=P(t,"opponent",0,v("Metal",3,!1)),t=P(t,"opponent",0,v("Metal",4,!0)),t=P(t,"opponent",1,v("Death",2,!1)),t=P(t,"opponent",1,v("Death",3,!0)),t=P(t,"opponent",2,v("Light",4,!1)),t.opponent.deck=[v("Metal",5,!0),v("Death",4,!0),v("Light",5,!0)],t=Ee(t),Fe(t)}},Wy={name:"Hate Test Playground",description:" All Hate cards on hand - test deletion mechanics",setup:a=>{let t=De(a,["Hate","Water","Spirit"],["Metal","Death","Fire"],"player","action");return t.player.hand=[v("Hate",0,!0),v("Hate",1,!0),v("Hate",2,!0),v("Hate",3,!0),v("Hate",4,!0),v("Hate",5,!0)],t=P(t,"player",1,v("Water",1,!0)),t=P(t,"player",1,v("Water",2,!0)),t=P(t,"player",1,v("Water",3,!0)),t=P(t,"player",2,v("Spirit",2,!0)),t=P(t,"player",2,v("Spirit",4,!1)),t=P(t,"opponent",0,v("Metal",5,!0)),t=P(t,"opponent",1,v("Death",2,!0)),t=P(t,"opponent",1,v("Death",4,!0)),t=P(t,"opponent",2,v("Fire",3,!1)),t.player.deck=[v("Water",0,!0),v("Water",4,!0),v("Spirit",0,!0),v("Spirit",5,!0)],t.opponent.deck=[v("Metal",3,!0),v("Death",5,!0),v("Fire",1,!0)],t=Ee(t),Fe(t)}},Qy={name:"Life Test Playground",description:" All Life cards on hand - test play and flip mechanics",setup:a=>{let t=De(a,["Life","Water","Spirit"],["Metal","Death","Fire"],"player","action");return t.player.hand=[v("Life",0,!0),v("Life",1,!0),v("Life",2,!0),v("Life",3,!0),v("Life",4,!0),v("Life",5,!0)],t=P(t,"player",1,v("Water",1,!0)),t=P(t,"player",1,v("Water",2,!0)),t=P(t,"player",1,v("Water",3,!0)),t=P(t,"player",2,v("Spirit",2,!0)),t=P(t,"player",2,v("Spirit",4,!1)),t=P(t,"opponent",0,v("Metal",3,!1)),t=P(t,"opponent",1,v("Death",2,!0)),t=P(t,"opponent",1,v("Death",4,!1)),t=P(t,"opponent",2,v("Fire",5,!1)),t.player.deck=[v("Water",0,!0),v("Water",3,!0),v("Water",4,!0),v("Spirit",0,!0),v("Spirit",1,!0),v("Spirit",2,!0),v("Spirit",3,!0),v("Spirit",4,!0)],t.opponent.deck=[v("Metal",1,!0),v("Death",3,!0),v("Fire",2,!0)],t=Ee(t),Fe(t)}},Xy={name:"Light Test Playground",description:" All Light cards on hand - burn away the dark",setup:a=>{let t=De(a,["Light","Water","Spirit"],["Metal","Death","Fire"],"player","action");return t.player.hand=[v("Light",0,!0),v("Light",1,!0),v("Light",2,!0),v("Light",3,!0),v("Light",4,!0),v("Light",5,!0)],t=P(t,"opponent",0,v("Fire",3,!1)),t=P(t,"opponent",1,v("Metal",4,!1)),t=P(t,"opponent",2,v("Death",5,!0)),t=P(t,"player",1,v("Water",2,!1)),t=P(t,"player",1,v("Water",3,!1)),t=P(t,"player",1,v("Water",4,!1)),t=P(t,"player",0,v("Spirit",1,!0)),t=P(t,"player",0,v("Spirit",2,!1)),t=P(t,"player",2,v("Spirit",5,!1)),t.player.deck=[v("Water",0,!0),v("Water",1,!0),v("Spirit",0,!0),v("Spirit",3,!0),v("Spirit",4,!0)],t.opponent.hand=[v("Metal",1,!0),v("Death",2,!0),v("Fire",3,!0),v("Metal",0,!0)],t=Ee(t),Fe(t)}},Zy={name:"Death-2 Uncover Interrupt - Turn Wechsel Test",description:"Death-2 lscht  Darkness-4 uncovered  Opponent shiftet  Turn muss zu Opponent wechseln",setup:a=>{let t=De(a,["Death","Fire","Hate"],["Water","Darkness","Spirit"],"player","action");return t.player.hand=[v("Death",2,!0),v("Fire",1,!0),v("Hate",1,!0)],t=P(t,"player",0,v("Fire",0,!1)),t=P(t,"opponent",1,v("Darkness",4,!0)),t=P(t,"opponent",1,v("Darkness",1,!0)),t=P(t,"opponent",0,v("Water",0,!1)),t.opponent.hand=[v("Water",1,!0),v("Spirit",1,!0)],t=Ee(t),Fe(t)}},Ky={name:"Apathy-5 Uncover - darf nur einmal triggern",description:"Hate-0 lscht Apathy-0  Apathy-5 uncovered  darf nur 1x triggern",setup:a=>{let t=De(a,["Hate","Fire","Death"],["Apathy","Darkness","Plague"],"player","action");return t.player.hand=[v("Hate",0,!0),v("Fire",2,!0),v("Death",2,!0)],t=P(t,"opponent",0,v("Apathy",5,!0)),t=P(t,"opponent",0,v("Apathy",4,!0)),t.opponent.hand=[v("Darkness",1,!0),v("Apathy",1,!0),v("Darkness",2,!0)],t=Ee(t),Fe(t)}},Jy={name:"Psychic-1 facedown flip darkness 2 test",description:"Psychic-1 facedown, darkness-2 flippt Karte nur noch facedown bug",setup:a=>{let t=De(a,["Frost","Gravity","Plague"],["Psychic","Darkness","Speed"],"player","action");return t.player.hand=[v("Darkness",1,!0),v("Darkness",2,!0),v("Speed",3,!0)],t=P(t,"opponent",0,v("Frost",0,!1)),t=P(t,"opponent",1,v("Gravity",6,!1)),t=P(t,"player",0,v("Psychic",4,!1)),t=P(t,"player",1,v("Psychic",1,!1)),t.opponent.hand=[v("Gravity",1,!0)],t=Ee(t),Fe(t)}},eg={name:"Speed Test Playground",description:" All Speed cards on hand - swift and adaptive",setup:a=>{let t=De(a,["Speed","Water","Spirit"],["Metal","Death","Fire"],"player","action");return t.player.hand=[v("Speed",0,!0),v("Speed",1,!0),v("Speed",2,!0),v("Speed",3,!0),v("Speed",4,!0),v("Speed",5,!0)],t=P(t,"player",0,v("Water",2,!0)),t=P(t,"player",1,v("Spirit",3,!0)),t=P(t,"opponent",0,v("Metal",3,!1)),t=P(t,"opponent",1,v("Death",4,!1)),t=P(t,"opponent",2,v("Fire",2,!0)),t=P(t,"player",2,v("Spirit",5,!0)),t=P(t,"player",2,v("Spirit",4,!0)),t=Ee(t),Fe(t)}},tg={name:"Metal Test Playground",description:" All Metal cards on hand - unyielding defense",setup:a=>{let t=De(a,["Metal","Water","Spirit"],["Metal","Death","Fire"],"player","action");return t.player.hand=[v("Metal",0,!0),v("Metal",1,!0),v("Metal",2,!0),v("Metal",3,!0),v("Metal",5,!0),v("Metal",6,!0)],t=P(t,"opponent",0,v("Metal",3,!1)),t=P(t,"opponent",1,v("Death",4,!0)),t=P(t,"player",1,v("Water",3,!0)),t=P(t,"opponent",2,v("Fire",0,!0)),t=P(t,"opponent",2,v("Fire",1,!0)),t=P(t,"opponent",2,v("Fire",2,!0)),t=P(t,"opponent",2,v("Fire",3,!0)),t=P(t,"opponent",2,v("Fire",4,!0)),t=P(t,"opponent",2,v("Fire",5,!0)),t=P(t,"player",2,v("Spirit",3,!0)),t=P(t,"player",2,v("Spirit",2,!0)),t=Ee(t),Fe(t)}},ng={name:"Plague Test Playground",description:" All Plague cards on hand - spread suffering",setup:a=>{let t=De(a,["Plague","Water","Spirit"],["Metal","Death","Fire"],"player","action");return t.player.hand=[v("Plague",0,!0),v("Plague",1,!0),v("Plague",2,!0),v("Plague",3,!0),v("Plague",4,!0),v("Plague",5,!0)],t.opponent.hand=[v("Fire",2,!0),v("Death",3,!0),v("Water",1,!0)],t.player.lanes[0]=[v("Spirit",2,!0)],t.player.lanes[1]=[],t.player.lanes[2]=[],t.opponent.lanes[0]=[v("Metal",1,!0)],t.opponent.lanes[1]=[v("Death",2,!1)],t.opponent.lanes[2]=[v("Fire",3,!0)],t=Ee(t),Fe(t)}},ag={name:"Love Test Playground",description:" All Love cards on hand - share the love",setup:a=>{let t=De(a,["Love","Water","Spirit"],["Metal","Death","Fire"],"player","action");return t.player.hand=[v("Love",1,!0),v("Love",2,!0),v("Love",3,!0),v("Love",4,!0),v("Love",5,!0),v("Love",6,!0)],t.opponent.hand=[v("Fire",2,!0),v("Death",3,!0),v("Water",1,!0),v("Metal",4,!0)],t.player.lanes[0]=[v("Spirit",2,!0)],t.player.lanes[1]=[],t.player.lanes[2]=[],t.opponent.lanes[0]=[v("Metal",1,!0)],t.opponent.lanes[1]=[v("Death",2,!1)],t.opponent.lanes[2]=[v("Fire",3,!0)],t=Ee(t),Fe(t)}},og={name:"Psychic Test Playground",description:" All Psychic cards on hand - read minds and control",setup:a=>{let t=De(a,["Psychic","Water","Spirit"],["Metal","Death","Fire"],"player","action");return t.player.hand=[v("Psychic",0,!0),v("Psychic",1,!0),v("Psychic",2,!0),v("Psychic",3,!0),v("Psychic",4,!0),v("Psychic",5,!0)],t.opponent.hand=[v("Fire",2,!0),v("Death",3,!0),v("Water",1,!0),v("Metal",4,!0)],t.player.lanes[0]=[v("Spirit",2,!0)],t.player.lanes[1]=[],t.player.lanes[2]=[],t.opponent.lanes[0]=[v("Metal",1,!0)],t.opponent.lanes[1]=[v("Death",2,!1)],t.opponent.lanes[2]=[v("Fire",3,!0)],t=Ee(t),Fe(t)}},rg={name:" Gravity-2 AI Single Card Bug",description:"AI spielt Gravity-2  Flip  Shift  Turn endet (NUR 1 Karte!)",setup:a=>{let t=De(a,["Hate","Fire","Water"],["Gravity","Death","Metal"],"opponent","action");return t.opponent.hand=[v("Gravity",2,!0),v("Death",1,!0),v("Metal",3,!0)],t=P(t,"player",1,v("Hate",5,!0)),t=P(t,"player",1,v("Hate",4,!0)),t=P(t,"player",0,v("Fire",2,!0)),t=P(t,"player",2,v("Water",3,!0)),t=Ee(t),Fe(t)}},lg={name:"Speed-3 End-Effekt Softlock Test",description:"Speed-3 als einzige uncovered Karte sollte sich selbst im End-Effekt shiften knnen",setup:a=>{let t=De(a,["Fire","Water","Death"],["Speed","Gravity","Light"],"opponent","end");return t.player.hand=[v("Fire",1,!0),v("Water",2,!0),v("Death",0,!0)],t=P(t,"player",0,v("Fire",3,!0)),t=P(t,"player",1,v("Water",1,!0)),t=P(t,"opponent",0,v("Speed",3,!0)),t.opponent.hand=[v("Gravity",1,!0),v("Light",2,!0)],t=Ee(t),Fe(t)}},sg={name:"Uncover nach Delete All in Lane Test",description:"Death-2 lscht alle 1/2er  Karte darunter wird uncovered  Effekt triggert",setup:a=>{let t=De(a,["Death","Fire","Water"],["Fire","Spirit","Light"],"player","action");return t.player.hand=[v("Death",2,!0),v("Fire",3,!0),v("Water",4,!0)],t=P(t,"opponent",0,v("Fire",5,!0)),t=P(t,"opponent",0,v("Fire",2,!0)),t=P(t,"player",0,v("Fire",4,!0)),t=P(t,"player",1,v("Water",3,!0)),t=P(t,"opponent",1,v("Spirit",2,!0)),t=Ee(t),Fe(t)}},cg={name:"Mehrfach-Uncover nach Delete All Test",description:"Death-2 lscht bei beiden Spielern  beide Karten darunter werden uncovered",setup:a=>{let t=De(a,["Death","Water","Spirit"],["Fire","Light","Gravity"],"player","action");return t.player.hand=[v("Death",2,!0),v("Spirit",3,!0)],t.opponent.hand=[v("Fire",3,!0),v("Light",5,!0)],t=P(t,"player",0,v("Water",5,!0)),t=P(t,"player",0,v("Water",1,!0)),t=P(t,"opponent",0,v("Fire",5,!0)),t=P(t,"opponent",0,v("Fire",2,!0)),t=Ee(t),Fe(t)}},ig={name:"Life-1 Uncover  Double Flip Bug",description:"Death-1 Start lscht  Life-1 uncovered  BEIDE Flips mssen ausgefhrt werden",setup:a=>{let t=De(a,["Death","Fire","Water"],["Life","Metal","Spirit"],"player","start");return t.player.hand=[v("Fire",2,!0)],t.opponent.hand=[v("Metal",3,!0),v("Spirit",2,!0)],t=P(t,"player",0,v("Death",1,!0)),t=P(t,"opponent",0,v("Life",1,!0)),t=P(t,"opponent",0,v("Metal",0,!0)),t=P(t,"player",1,v("Water",1,!0)),t=P(t,"opponent",1,v("Metal",1,!0)),t=P(t,"opponent",2,v("Spirit",0,!0)),t=Ee(t),Fe(t)}},dg={name:"Smoke Test Playground",description:" All Smoke cards on hand - shroud your cards in mystery",setup:a=>{let t=De(a,["Smoke","Water","Spirit"],["Metal","Death","Fire"],"player","action");return t.player.hand=[v("Smoke",0,!0),v("Smoke",1,!0),v("Smoke",2,!0),v("Smoke",3,!0),v("Smoke",4,!0),v("Smoke",5,!0)],t=P(t,"player",0,v("Water",2,!1)),t=P(t,"opponent",1,v("Metal",3,!1)),t=P(t,"opponent",1,v("Death",2,!0)),t=P(t,"opponent",2,v("Fire",2,!0)),t=P(t,"player",2,v("Spirit",3,!0)),t=P(t,"player",1,v("Spirit",4,!0)),t=Ee(t),Fe(t)}},ug={name:"Smoke AI Test",description:" AI spielt Smoke Karten - test all Smoke card effects with AI",setup:a=>{let t=De(a,["Water","Spirit","Light"],["Smoke","Metal","Death"],"opponent","action");return t.opponent.hand=[v("Smoke",0,!0),v("Smoke",1,!0),v("Smoke",2,!0),v("Smoke",3,!0),v("Smoke",4,!0),v("Smoke",5,!0)],t=P(t,"opponent",0,v("Metal",2,!1)),t=P(t,"player",0,v("Water",3,!0)),t=P(t,"player",1,v("Spirit",2,!1)),t=P(t,"player",1,v("Spirit",4,!0)),t=P(t,"opponent",2,v("Death",3,!0)),t=P(t,"player",2,v("Light",2,!0)),t=P(t,"opponent",1,v("Metal",4,!0)),t=Ee(t),Fe(t)}},pg={name:"Clarity Test Playground",description:"All Clarity cards on hand - see through the fog of war",setup:a=>{let t=De(a,["Clarity","Water","Spirit"],["Metal","Death","Fire"],"player","action");return t.player.hand=[v("Clarity",0,!0),v("Clarity",1,!0),v("Clarity",2,!0),v("Clarity",3,!0),v("Clarity",4,!0),v("Clarity",5,!0)],t.player.deck=[v("Clarity",1,!0),v("Water",1,!0),v("Spirit",5,!0),v("Spirit",3,!0),v("Water",2,!0),v("Fire",4,!0)],t.player.discard=[v("Water",4,!0),v("Spirit",1,!0)],t=P(t,"player",0,v("Water",2,!0)),t.opponent.hand=[v("Metal",3,!0),v("Death",2,!0),v("Fire",4,!0)],t=P(t,"opponent",1,v("Metal",3,!0)),t=P(t,"opponent",2,v("Fire",2,!0)),t=Ee(t),Fe(t)}},fg={name:"Clarity AI Test",description:"AI spielt Clarity Karten - test all Clarity card effects with AI",setup:a=>{let t=De(a,["Water","Spirit","Light"],["Clarity","Metal","Death"],"opponent","action");return t.opponent.hand=[v("Clarity",0,!0),v("Clarity",1,!0),v("Clarity",2,!0),v("Clarity",3,!0),v("Clarity",4,!0),v("Clarity",5,!0)],t.opponent.deck=[v("Clarity",1,!0),v("Metal",1,!0),v("Death",5,!0),v("Death",3,!0),v("Metal",2,!0)],t.opponent.discard=[v("Metal",4,!0),v("Death",2,!0)],t.player.hand=[v("Water",3,!0),v("Spirit",2,!0),v("Light",4,!0)],t=P(t,"player",0,v("Water",3,!0)),t=P(t,"opponent",0,v("Metal",2,!0)),t=P(t,"player",1,v("Spirit",4,!0)),t=P(t,"opponent",2,v("Death",3,!0)),t=Ee(t),Fe(t)}},hg={name:"Courage Custom Playground",description:"Test all Courage effects: empty hand draw, opponent higher value delete, conditional draw/flip, highest value shift",setup:a=>{let c=De(a,["Courage","Fire","Speed"],["Spirit","Water","Darkness"],"player","action");return c.player.hand=[v("Courage",0,!0),v("Courage",1,!0),v("Courage",2,!0),v("Courage",3,!0),v("Courage",5,!0),v("Courage",6,!0)],c=P(c,"opponent",0,v("Spirit",3,!0)),c=P(c,"opponent",0,v("Spirit",5,!0)),c=P(c,"player",0,v("Fire",3,!0)),c=P(c,"opponent",1,v("Water",6,!0)),c=P(c,"player",1,v("Speed",4,!0)),c=P(c,"opponent",2,v("Darkness",2,!0)),c=P(c,"player",2,v("Fire",5,!0)),Fe(c)}},mg={name:"Courage AI Test",description:"Test AI with Courage protocol: lane-restricted delete, self-shift to highest value lane",setup:a=>{let c=De(a,["Spirit","Water","Fire"],["Courage","Speed","Darkness"],"opponent","action");return c.opponent.hand=[v("Courage",0,!0),v("Courage",1,!0),v("Courage",2,!0),v("Courage",3,!0),v("Courage",5,!0),v("Courage",6,!0)],c=P(c,"player",0,v("Spirit",5,!0)),c=P(c,"player",0,v("Spirit",5,!0)),c=P(c,"opponent",0,v("Speed",3,!0)),c=P(c,"player",1,v("Water",6,!0)),c=P(c,"opponent",1,v("Darkness",2,!0)),c=P(c,"opponent",1,v("Darkness",2,!1)),c=P(c,"player",2,v("Fire",3,!0)),c=P(c,"opponent",2,v("Speed",5,!0)),Fe(c)}},yg={name:"Corruption Test Playground",description:" All Corruption cards on hand - corrupt your opponent's plans",setup:a=>{let t=De(a,["Corruption","Water","Spirit"],["Metal","Death","Fire"],"player","action");return t.player.hand=[v("Corruption",0,!0),v("Corruption",1,!0),v("Corruption",2,!0),v("Corruption",3,!0),v("Corruption",5,!0),v("Corruption",6,!0)],t=P(t,"player",0,v("Water",2,!0)),t=P(t,"opponent",0,v("Metal",3,!0)),t=P(t,"opponent",1,v("Death",4,!0)),t=P(t,"opponent",2,v("Fire",2,!0)),t=P(t,"player",1,v("Spirit",3,!0)),t=P(t,"player",1,v("Spirit",5,!0)),t.opponent.hand=[v("Fire",3,!0),v("Metal",4,!0),v("Death",5,!0)],t=Ee(t),Fe(t)}},gg={name:"Fear Custom Playground",description:"Test all Fear effects: passive ignore middle, choice shift/flip, chain discard, return, random discard",setup:a=>{let c=De(a,["Fear","Fire","Speed"],["Spirit","Water","Darkness"],"player","action");return c.player.hand=[v("Fear",0,!0),v("Fear",1,!0),v("Fear",2,!0),v("Fear",3,!0),v("Fear",4,!0),v("Fear",5,!0)],c=P(c,"opponent",0,v("Spirit",2,!0)),c=P(c,"opponent",0,v("Spirit",3,!0)),c=P(c,"player",0,v("Fire",3,!0)),c=P(c,"opponent",1,v("Water",4,!0)),c=P(c,"player",1,v("Speed",4,!0)),c=P(c,"opponent",2,v("Darkness",2,!1)),c=P(c,"player",2,v("Fire",5,!0)),c.opponent.hand=[v("Spirit",1,!0),v("Water",2,!0),v("Darkness",3,!0),v("Spirit",4,!0)],Fe(c)}},vg={name:"Fear AI Test",description:"Test AI with Fear protocol: random discard execution, passive rule handling",setup:a=>{let c=De(a,["Spirit","Water","Fire"],["Fear","Speed","Darkness"],"opponent","action");return c.opponent.hand=[v("Fear",0,!0),v("Fear",1,!0),v("Fear",2,!0),v("Fear",3,!0),v("Fear",4,!0),v("Fear",5,!0)],c=P(c,"player",0,v("Spirit",3,!0)),c=P(c,"player",0,v("Spirit",5,!0)),c=P(c,"opponent",0,v("Speed",3,!0)),c=P(c,"player",1,v("Water",2,!0)),c=P(c,"player",1,v("Water",4,!0)),c=P(c,"player",2,v("Fire",3,!0)),c=P(c,"opponent",2,v("Darkness",5,!0)),c.player.hand=[v("Spirit",1,!0),v("Water",3,!0),v("Fire",4,!0)],Fe(c)}},_g={name:"Ice Custom Playground",description:" Test all Ice effects: conditional shift, flip block, draw block, lane-reactive discard",setup:a=>{let c=De(a,["Ice","Fire","Speed"],["Spirit","Water","Darkness"],"player","action");return c.player.hand=[v("Ice",1,!0),v("Ice",2,!0),v("Ice",3,!0),v("Ice",4,!0),v("Ice",5,!0),v("Ice",6,!0),v("Fire",0,!0)],c=P(c,"player",0,v("Fire",3,!0)),c=P(c,"player",0,v("Fire",5,!0)),c=P(c,"opponent",1,v("Water",4,!0)),c=P(c,"player",1,v("Speed",4,!0)),c=P(c,"opponent",2,v("Darkness",2,!0)),c=P(c,"player",2,v("Fire",5,!0)),c.opponent.hand=[v("Spirit",1,!0),v("Water",2,!0),v("Darkness",3,!0)],Fe(c)}},wg={name:"Ice AI Test",description:" Test AI with Ice protocol: shift self, shift others, passive rules",setup:a=>{let c=De(a,["Spirit","Water","Fire"],["Ice","Speed","Darkness"],"opponent","action");return c.opponent.hand=[v("Ice",1,!0),v("Ice",2,!0),v("Ice",3,!0),v("Ice",4,!0),v("Ice",5,!0),v("Ice",6,!0)],c=P(c,"player",0,v("Spirit",3,!0)),c=P(c,"player",0,v("Spirit",5,!0)),c=P(c,"opponent",0,v("Speed",3,!0)),c=P(c,"opponent",1,v("Darkness",2,!0)),c=P(c,"opponent",1,v("Darkness",4,!0)),c=P(c,"player",1,v("Water",4,!0)),c=P(c,"player",2,v("Fire",3,!0)),c=P(c,"opponent",2,v("Speed",5,!0)),c.player.hand=[v("Spirit",1,!0),v("Water",3,!0),v("Fire",4,!0)],Fe(c)}},xg={name:"End Phase Test",description:"Test the game rule for the end or start phase, only 1 trigger",setup:a=>{let c=De(a,["Light","Fire","Speed"],["Spirit","Water","Darkness"],"player","action");return c.player.hand=[v("Light",5,!0),v("Fire",0,!0)],c=P(c,"player",0,v("Light",1,!0)),c=P(c,"player",0,v("Light",2,!0)),c=P(c,"player",1,v("Fire",3,!0)),c=P(c,"player",2,v("Speed",3,!0)),c.opponent.hand=[v("Spirit",1,!0),v("Water",2,!0),v("Darkness",3,!0)],Fe(c)}},Cg={name:"Start Phase Test",description:"Test the game rule for the end or start phase, only 1 trigger",setup:a=>{let c=De(a,["Spirit","Death","Psychic"],["Light","Water","Darkness"],"player","action");return c.player.hand=[v("Spirit",5,!0),v("Death",0,!0)],c=P(c,"player",0,v("Spirit",1,!0)),c=P(c,"player",0,v("Spirit",2,!0)),c=P(c,"player",1,v("Death",1,!0)),c=P(c,"player",1,v("Spirit",3,!0)),c=P(c,"player",2,v("Psychic",1,!0)),c.opponent.hand=[v("Light",1,!0),v("Water",2,!0),v("Darkness",3,!0)],Fe(c)}},Sg={name:"Committed Card Test",description:"Committed Card Test",setup:a=>{let c=De(a,["Spirit","Darkness","Psychic"],["Light","Water","Fire"],"player","action");return c.player.hand=[v("Darkness",0,!0),v("Death",0,!0)],c=P(c,"player",0,v("Spirit",0,!0)),c=P(c,"player",0,v("Spirit",3,!0)),c=P(c,"opponent",0,v("Light",1,!0)),c=P(c,"opponent",0,v("Light",2,!0)),c.opponent.hand=[v("Light",5,!0),v("Water",2,!0),v("Darkness",3,!0)],Fe(c)}},bg={name:"Fear 0 prob Test",description:"Bla bla",setup:a=>{let c=De(a,["Chaos","Fear","Psychic"],["Light","Water","Fire"],"player","action");return c.player.hand=[v("Chaos",2,!0),v("Fear",3,!0)],c=P(c,"player",1,v("Fear",2,!0)),c=P(c,"player",1,v("Fear",0,!0)),c=P(c,"opponent",1,v("Water",5,!0)),c=P(c,"opponent",2,v("Darkness",2,!1)),c.opponent.hand=[v("Light",5,!0),v("Water",2,!0),v("Darkness",3,!0)],Fe(c)}},Eg={name:"MultiChain Test",description:"Multi Chain test",setup:a=>{let c=De(a,["Chaos","Smoke","Test"],["Light","Water","Fire"],"player","action");return c.player.hand=[v("Smoke",1,!0),v("Chaos",3,!0)],c=P(c,"player",2,v("Test",1,!1)),c=P(c,"opponent",1,v("Water",5,!0)),c=P(c,"opponent",2,v("Darkness",2,!1)),c.opponent.hand=[v("Light",5,!0),v("Water",2,!0),v("Darkness",3,!0)],Fe(c)}},jg={name:"Light3-Uncover Test",description:"Light3-Uncover_actionType Test",setup:a=>{let c=De(a,["Chaos","Smoke","Test"],["Light","Water","Fire"],"player","action");return c.player.hand=[v("Smoke",1,!0),v("Chaos",3,!0)],c=P(c,"player",0,v("Chaos",3,!0)),c=P(c,"player",0,v("Chaos",2,!0)),c=P(c,"player",0,v("Test",1,!1)),c.opponent.hand=[v("Light",3,!0)],Fe(c)}},kg={name:"Luck Test Playground",description:" All Luck cards on hand - gamble with fate!",setup:a=>{let t=De(a,["Luck","Fire","Water"],["Death","Life","Gravity"],"player","action");return t.player.hand=[v("Luck",0,!0),v("Luck",1,!0),v("Luck",2,!0),v("Luck",3,!0),v("Luck",4,!0),v("Luck",5,!0)],t=P(t,"opponent",0,v("Death",3,!0)),t=P(t,"opponent",0,v("Death",2,!1)),t=P(t,"opponent",1,v("Life",2,!0)),t=P(t,"player",1,v("Fire",3,!0)),t=P(t,"opponent",2,v("Gravity",4,!0)),t=P(t,"player",2,v("Water",3,!0)),t=Ee(t),Fe(t)}},Rg={name:"Luck AI Test",description:" AI spielt Luck Karten - test all Luck card effects with AI",setup:a=>{let t=De(a,["Fire","Water","Spirit"],["Luck","Death","Life"],"opponent","action");return t.opponent.hand=[v("Luck",0,!0),v("Luck",1,!0),v("Luck",2,!0),v("Luck",3,!0),v("Luck",4,!0),v("Luck",5,!0)],t=P(t,"player",0,v("Fire",3,!0)),t=P(t,"opponent",0,v("Death",2,!0)),t=P(t,"player",1,v("Water",2,!0)),t=P(t,"player",1,v("Water",4,!1)),t=P(t,"player",2,v("Spirit",3,!0)),t=P(t,"opponent",2,v("Life",4,!0)),t=Ee(t),Fe(t)}},Ng={name:"Mirror Test Playground",description:" All Mirror cards on hand - copy, reflect, and swap",setup:a=>{let t=De(a,["Mirror","Fire","Water"],["Death","Metal","Spirit"],"player","action");return t.player.hand=[v("Mirror",0,!0),v("Mirror",1,!0),v("Mirror",2,!0),v("Mirror",3,!0),v("Mirror",4,!0),v("Mirror",5,!0)],t=P(t,"player",0,v("Fire",3,!0)),t=P(t,"player",0,v("Fire",2,!1)),t=P(t,"player",1,v("Water",4,!0)),t=P(t,"player",2,v("Water",1,!0)),t=P(t,"opponent",0,v("Death",3,!0)),t=P(t,"opponent",0,v("Death",2,!1)),t=P(t,"opponent",1,v("Metal",4,!0)),t=P(t,"opponent",2,v("Spirit",2,!0)),t.opponent.hand=[v("Metal",1,!0),v("Spirit",3,!0),v("Death",4,!0)],t=Ee(t),Fe(t)}},Tg={name:"Mirror AI Test",description:" AI spielt Mirror Karten - test all Mirror card effects with AI",setup:a=>{let t=De(a,["Fire","Water","Spirit"],["Mirror","Death","Metal"],"opponent","action");return t.opponent.hand=[v("Mirror",0,!0),v("Mirror",1,!0),v("Mirror",2,!0),v("Mirror",3,!0),v("Mirror",4,!0),v("Mirror",5,!0)],t=P(t,"opponent",0,v("Death",3,!0)),t=P(t,"opponent",0,v("Death",2,!1)),t=P(t,"opponent",1,v("Metal",4,!0)),t=P(t,"opponent",2,v("Metal",1,!0)),t=P(t,"player",0,v("Fire",3,!0)),t=P(t,"player",0,v("Fire",2,!1)),t=P(t,"player",1,v("Water",4,!0)),t=P(t,"player",2,v("Spirit",2,!0)),t.player.hand=[v("Fire",1,!0),v("Water",3,!0),v("Spirit",4,!0)],t=Ee(t),Fe(t)}},Ag={name:"Peace Test Playground",description:" All Peace cards on hand - harmony, balance, sacrifice",setup:a=>{let t=De(a,["Peace","Fire","Water"],["Death","Metal","Spirit"],"player","action");return t.player.hand=[v("Peace",1,!0),v("Peace",2,!0),v("Peace",3,!0),v("Peace",4,!0),v("Peace",5,!0),v("Peace",6,!0)],t=P(t,"player",0,v("Fire",3,!0)),t=P(t,"player",1,v("Water",4,!0)),t=P(t,"player",2,v("Water",5,!0)),t=P(t,"opponent",0,v("Death",5,!1)),t=P(t,"opponent",1,v("Metal",6,!0)),t=P(t,"opponent",2,v("Spirit",4,!0)),t.opponent.hand=[v("Metal",1,!0),v("Spirit",4,!0),v("Death",0,!0)],t=Ee(t),Fe(t)}},Dg={name:"Peace AI Test",description:" AI spielt Peace Karten - test all Peace card effects with AI",setup:a=>{let t=De(a,["Fire","Water","Spirit"],["Peace","Death","Life"],"opponent","action");return t.opponent.hand=[v("Peace",1,!0),v("Peace",2,!0),v("Peace",3,!0),v("Peace",4,!0),v("Peace",5,!0),v("Peace",6,!0)],t=P(t,"player",0,v("Fire",3,!0)),t=P(t,"player",1,v("Water",4,!0)),t=P(t,"player",2,v("Spirit",5,!0)),t=P(t,"opponent",0,v("Death",2,!0)),t=P(t,"opponent",1,v("Life",3,!0)),t.player.hand=[v("Fire",1,!0),v("Water",3,!0),v("Spirit",4,!0)],t=Ee(t),Fe(t)}},Fg={name:"Peace-4 Reactive Test",description:" Test Peace-4: AI spielt Plague  du discardest  Peace-4 triggert  du ziehst",setup:a=>{let t=De(a,["Peace","Fire","Water"],["Plague","Death","Life"],"opponent","action");return t=P(t,"player",0,v("Peace",4,!0)),t=P(t,"player",1,v("Fire",3,!0)),t=P(t,"player",2,v("Water",2,!0)),t.opponent.hand=[v("Plague",0,!0),v("Plague",1,!0)],t=P(t,"opponent",0,v("Death",5,!0)),t.player.hand=[v("Fire",1,!0),v("Water",3,!0),v("Peace",2,!0)],t=Ee(t),Fe(t)}},qg={name:"War Custom Protocol Playground",description:"Player has War protocol with cards on board for testing reactive triggers",setup:a=>{let t=De(a,["War","Fire","Water"],["Plague","Death","Spirit"],"player","action");return t.player.hand=[v("War",1,!0),v("War",2,!0),v("War",3,!0),v("War",4,!0),v("War",5,!0)],t=P(t,"player",2,v("War",0,!0)),t=P(t,"opponent",0,v("Fire",1,!0)),t=P(t,"opponent",1,v("Spirit",5,!0)),t=P(t,"opponent",1,v("Death",5,!0)),t.opponent.hand=[v("Death",1,!0),v("Spirit",2,!0),v("Plague",1,!0)],t=Ee(t),Fe(t)}},$g={name:"War AI Test",description:"AI plays with War protocol - tests reactive trigger handling",setup:a=>{let t=De(a,["Fire","Water","Death"],["War","Plague","Spirit"],"player","action");return t=P(t,"opponent",0,v("War",0,!0)),t=P(t,"opponent",1,v("War",1,!0)),t=P(t,"opponent",2,v("War",2,!0)),t=P(t,"player",0,v("Fire",1,!0)),t=P(t,"player",1,v("Water",2,!0)),t=P(t,"player",2,v("Death",1,!0)),t.player.hand=[v("Fire",2,!0),v("Water",3,!0),v("Death",2,!0)],t.opponent.hand=[v("Spirit",1,!0),v("Plague",2,!0)],t=Ee(t),Fe(t)}},Ig={name:"Time Test Playground",description:" All Time cards on hand - manipulate trash and deck",setup:a=>{const t=["Time","Clarity","Life"],l=["Fire","Water","Death"];let c=De(a,t,l,"player","action");const i=[v("Time",0),v("Time",1),v("Time",2),v("Time",3),v("Time",4),v("Time",5)],d=[v("Life",3),v("Clarity",2),v("Life",1)];c={...c,player:{...c.player,hand:i,discard:d}},c=P(c,"player",0,v("Clarity",0,!0)),c=P(c,"player",0,v("Life",0,!1)),c=P(c,"opponent",1,v("Fire",2,!1));const f=[...i,...d,...c.player.lanes.flat(),...c.opponent.lanes.flat()];return c.player.deck=al(t,f),c.opponent.deck=al(l,[]),c=Ee(c),Fe(c)}},Lg={name:"Time AI Test",description:" AI plays Time cards - test trash selection and shuffle triggers",setup:a=>{const t=["Fire","Water","Death"],l=["Time","Clarity","Life"];let c=De(a,t,l,"opponent","action");const i=[v("Fire",2),v("Water",3)],d=[v("Time",0),v("Time",1),v("Time",2),v("Time",3),v("Time",4),v("Time",5)],f=[v("Life",4),v("Clarity",3)];c={...c,player:{...c.player,hand:i},opponent:{...c.opponent,hand:d,discard:f}},c=P(c,"player",0,v("Fire",1,!0)),c=P(c,"player",0,v("Water",0,!1)),c=P(c,"opponent",1,v("Clarity",1,!0));const p=[...i,...d,...f,...c.player.lanes.flat(),...c.opponent.lanes.flat()];return c.player.deck=al(t,p),c.opponent.deck=al(l,p),c=Ee(c),Fe(c)}},Pg=[gy,vy,_y,wy,xy,Cy,Sy,by,Ey,jy,ky,Ry,Ny,Ty,Ay,Dy,Fy,qy,$y,Iy,Ly,Bb,Yb,Gb,Wb,Qb,Xb,Py,Uy,Oy,My,Hy,zy,Vy,By,Yy,Gy,Wy,Qy,Xy,Zy,Ky,Jy,eg,tg,ng,ag,og,rg,lg,sg,cg,ig,dg,ug,pg,fg,yg,hg,mg,gg,vg,_g,wg,xg,Cg,Sg,bg,Eg,jg,kg,Rg,Ng,Tg,Ag,Dg,Fg,qg,$g,Ig,Lg],Zb=Object.freeze(Object.defineProperty({__proto__:null,allScenarios:Pg,scenario10_Hate1Interrupt:by,scenario11_Darkness1HateChain:Ey,scenario12_Water4TurnEnd:jy,scenario13_Psychic3ShiftTest:ky,scenario14_Death1UncoverTest:Ry,scenario15_Gravity2ShiftInterrupt:Ny,scenario16_Hate2PlayerPlays:Ty,scenario171_Hate2AIPlays:Dy,scenario17_Hate2AIPlays:Ay,scenario18_Hate2SelfDelete:Fy,scenario19_Hate2MultipleTies:qy,scenario1_Psychic3Uncover:gy,scenario20_Hate2FaceDown:$y,scenario21_Hate2AIValidation:Iy,scenario22_Hate2AIPlaysOpen:Ly,scenario29_FireCustomConditional:Py,scenario2_Psychic4EndEffect:vy,scenario30_AnarchyCustomPlayground:Uy,scenario31_DarkCustPlayground:Oy,scenario32_ApathyCustomPlayground:My,scenario33_DeathCustomPlayground:Hy,scenario34_WaterCustomPlayground:zy,scenario35_SpiritCustomPlayground:Vy,scenario36_ChaosCustomPlayground:By,scenario37_GravityCustomPlayground:Yy,scenario38_FrostCustomPlayground:Gy,scenario39_HateCustomPlayground:Wy,scenario3_Spirit3EndPhase:_y,scenario40_LifeCustomPlayground:Qy,scenario41_LightCustomPlayground:Xy,scenario42_Death2UncoverInterruptTurn:Zy,scenario43_Apathy5DoubleUncover:Ky,scenario44_Psychic1Darkness2Test:Jy,scenario45_SpeedCustomPlayground:eg,scenario46_MetalCustomPlayground:tg,scenario47_PlagueCustomPlayground:ng,scenario48_LoveCustomPlayground:ag,scenario49_PsychicCustomPlayground:og,scenario4_Plague2Actor:wy,scenario50_Gravity2SingleCardBug:rg,scenario51_Speed3EndEffectSoftlock:lg,scenario52_UncoverAfterBulkDelete:sg,scenario53_MultiUncoverAfterBulkDelete:cg,scenario54_Life1UncoverDoubleFlip:ig,scenario55_SmokeCustomPlayground:dg,scenario56_SmokeAITest:ug,scenario57_ClarityCustomPlayground:pg,scenario58_ClarityAITest:fg,scenario59_CorruptionCustomPlayground:yg,scenario5_Darkness1Interrupt:xy,scenario60_CourageCustomPlayground:hg,scenario61_CourageAITest:mg,scenario62_FearCustomPlayground:gg,scenario63_FearAITest:vg,scenario64_IceCustomPlayground:_g,scenario65_IceAITest:wg,scenario66_endPhasePlayground:xg,scenario67_startPhasePlayground:Cg,scenario68_CommittedCardPlayground:Sg,scenario69_fear0shiftCardPlayground:bg,scenario70_multiChainCardPlayground:Eg,scenario71_Light3ProblemPlayground:jg,scenario72_LuckCustomPlayground:kg,scenario73_LuckAITest:Rg,scenario74_MirrorCustomPlayground:Ng,scenario75_MirrorAITest:Tg,scenario76_PeaceCustomPlayground:Ag,scenario77_PeaceAITest:Dg,scenario78_Peace4ReactiveTest:Fg,scenario79_WarCustomPlayground:qg,scenario80_WarAITest:$g,scenario81_TimeCustomPlayground:Ig,scenario82_TimeAITest:Lg,scenario8_Plague4Owner:Cy,scenario9_Water:Sy},Symbol.toStringTag,{value:"Module"})),Kb=({onLoadScenario:a,onSkipCoinFlip:t,onForceWin:l,onForceLose:c})=>{const[i,d]=le.useState(!1);return i?o.jsxs("div",{style:{position:"fixed",top:"20px",left:"20px",width:"400px",maxHeight:"600px",backgroundColor:"#2c2c2c",border:"2px solid #ff6b6b",borderRadius:"8px",padding:"20px",zIndex:9999,overflowY:"auto",color:"white",fontFamily:"monospace"},children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"20px"},children:[o.jsx("h3",{style:{margin:0},children:" Debug Panel"}),o.jsx("button",{onClick:()=>d(!1),style:{backgroundColor:"transparent",border:"none",color:"white",cursor:"pointer",fontSize:"20px"},children:""})]}),o.jsx("div",{style:{marginBottom:"15px",fontSize:"12px",color:"#aaa"},children:"Lade vordefinierte Test-Szenarien zum Testen der Actor/Owner-Fixes."}),o.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:Pg.map((f,p)=>o.jsxs("div",{style:{backgroundColor:"#1a1a1a",padding:"12px",borderRadius:"5px",border:"1px solid #444"},children:[o.jsx("div",{style:{fontWeight:"bold",marginBottom:"5px",color:"#4ecdc4"},children:f.name}),o.jsx("div",{style:{fontSize:"11px",color:"#bbb",marginBottom:"10px"},children:f.description}),o.jsx("button",{onClick:()=>{t&&t(),a(f.setup),d(!1)},style:{padding:"6px 12px",backgroundColor:"#4ecdc4",color:"#1a1a1a",border:"none",borderRadius:"3px",cursor:"pointer",fontWeight:"bold",fontSize:"12px"},children:"Load Scenario"})]},p))}),(l||c)&&o.jsxs("div",{style:{marginTop:"20px",paddingTop:"15px",borderTop:"1px solid #444",display:"flex",gap:"10px",justifyContent:"center"},children:[l&&o.jsx("button",{onClick:()=>{l(),d(!1)},style:{padding:"10px 20px",backgroundColor:"#4ecdc4",color:"#1a1a1a",border:"none",borderRadius:"5px",cursor:"pointer",fontWeight:"bold",fontSize:"14px"},children:" Force Win"}),c&&o.jsx("button",{onClick:()=>{c(),d(!1)},style:{padding:"10px 20px",backgroundColor:"#ff6b6b",color:"white",border:"none",borderRadius:"5px",cursor:"pointer",fontWeight:"bold",fontSize:"14px"},children:" Force Lose"})]}),o.jsx("div",{style:{marginTop:"20px",fontSize:"11px",color:"#666",textAlign:"center"},children:"Drcke ESC oder klicke  zum Schlieen"})]}):o.jsx("button",{onClick:()=>d(!0),style:{position:"fixed",top:"20px",left:"20px",padding:"10px 20px",backgroundColor:"#ff6b6b",color:"white",border:"none",borderRadius:"5px",cursor:"pointer",fontWeight:"bold",zIndex:9999,fontSize:"14px"},children:" DEBUG"})},ym=(a,t)=>{if(!t)return null;for(const l of["player","opponent"])for(const c of a[l].lanes){const i=c.find(d=>d.id===t);if(i)return{card:i,owner:l}}return null},Jb=new Set(["discard","select_card_from_hand_to_play","select_card_from_hand_to_give","select_card_from_hand_to_reveal","plague_2_player_discard","select_cards_from_hand_to_discard_for_fire_4","select_cards_from_hand_to_discard_for_hate_1"]);function eE({onBack:a,onEndGame:t,playerProtocols:l,opponentProtocols:c,difficulty:i,useControlMechanic:d,startingPlayer:f="player"}){var Qe,Je,rt,Ve,lt,Pt,mn,Xt,Et,Ft,to,no,kn,Hn,Uo;const[p,u]=le.useState(null),[h,y]=le.useState(!0),{startGame:g,endGame:_,trackPlayerCoinFlip:x,trackPlayerRearrange:S}=Vb(l,i,d),E=le.useCallback((Ce,Te,Ye)=>{u(Ce),y(!1),x(Te,Ye)},[x]),b=le.useCallback(()=>{u("player"),y(!1),g()},[g]);le.useEffect(()=>{!h&&p&&g()},[h,p,g]);const j=le.useCallback((Ce,Te)=>{const Ye=Te.player.compiled.filter(at=>at).length;_(Ce,Te.stats.player,Ye,Te.stats.opponent,Te.detailedGameStats),t(Ce,Te)},[_,t]),{gameState:C,selectedCard:R,setSelectedCard:A,playSelectedCard:I,fillHand:U,discardCardFromHand:$,compileLane:Z,resolveActionWithCard:ee,resolveActionWithLane:z,selectHandCardForAction:O,resolveActionWithHandCard:k,skipAction:q,resolveOptionalDrawPrompt:F,resolveDeath1Prompt:D,resolveLove1Prompt:T,resolvePlague2Discard:L,resolvePlague4Flip:B,resolveFire3Prompt:G,resolveOptionalDiscardCustomPrompt:ae,resolveOptionalEffectPrompt:M,resolveFire4Discard:W,resolveHate1Discard:oe,resolveLight2Prompt:Q,resolveRevealBoardCardPrompt:V,resolveRearrangeProtocols:J,resolveSpirit1Prompt:me,resolveSpirit3Prompt:ge,resolveSwapProtocols:Y,resolveSpeed3Prompt:K,resolvePsychic4Prompt:X,resolveControlMechanicPrompt:se,resolveCustomChoice:ie,resolveSelectRevealedDeckCard:_e,resolveStateNumber:ye,resolveStateProtocol:ke,resolveSelectFromDrawnToReveal:Ie,resolveConfirmDeckDiscard:be,resolveConfirmDeckPlayPreview:Pe,resolveSelectTrashCardToPlay:$e,resolveSelectTrashCardToReveal:Ae,setupTestScenario:Le}=Fw(l,c,j,i,d,p??"player",S),[Re,Ne]=le.useState(null),[ht,ct]=le.useState([]),[Ct,wt]=le.useState(!1),[na,En]=le.useState([]),aa=le.useRef(C.log.length),[Ta,pn]=le.useState(!1),[Mt,tn]=le.useState(!1),[It,oa]=le.useState(null),[Aa,ya]=le.useState(!1),[On,fn]=le.useState(0),Jt=le.useRef(null),Qt=le.useRef(C);le.useEffect(()=>{Qt.current=C},[C]);const Mn=()=>{const Ce=On+1;if(fn(Ce),Ce>=5){ya(Te=>!Te),fn(0),Jt.current&&(clearTimeout(Jt.current),Jt.current=null);return}Jt.current&&clearTimeout(Jt.current),Jt.current=setTimeout(()=>{fn(0),Jt.current=null},2e3)},jn=le.useCallback(()=>{console.log("Debug: Forcing player win via DebugPanel."),j("player",C)},[j,C]),Da=le.useCallback(()=>{console.log("Debug: Forcing player loss via DebugPanel."),j("opponent",C)},[j,C]),ga=le.useMemo(()=>{if(C.lastPlayedCardId){const Ce=ym(C,C.lastPlayedCardId);if(Ce){const Te=Ce.owner==="player"||Ce.card.isFaceUp;return{card:Ce.card,showContents:Te}}}return null},[C.lastPlayedCardId,C.player.lanes,C.opponent.lanes]),ra=le.useMemo(()=>{var Te;const Ce=(Te=C.actionRequired)==null?void 0:Te.sourceCardId;if(Ce){const Ye=ym(C,Ce);if(Ye){const at=Ye.owner==="player"||Ye.card.isFaceUp;return{card:Ye.card,showContents:at}}}return null},[(Qe=C.actionRequired)==null?void 0:Qe.sourceCardId,C.player.lanes,C.opponent.lanes]);le.useEffect(()=>{var Ce;(Ce=C.actionRequired)!=null&&Ce.sourceCardId&&Ne(null)},[(Je=C.actionRequired)==null?void 0:Je.sourceCardId]);const hn=Re||ra||ga;le.useEffect(()=>{C.log.length>aa.current&&C.log.slice(aa.current).forEach(Te=>{if(Te.message!=="Game Started."){const Ye={message:Te.message,player:Te.player,id:ot()};En(at=>[...at,Ye]),setTimeout(()=>{En(at=>at.filter(qt=>qt.id!==Ye.id))},5e3)}}),aa.current=C.log.length},[C.log]),le.useEffect(()=>{var Te,Ye,at,qt,Lt;!(((Te=C.actionRequired)==null?void 0:Te.type)==="discard"&&((Ye=C.actionRequired)==null?void 0:Ye.variableCount))&&((at=C.actionRequired)==null?void 0:at.type)!=="plague_2_player_discard"&&((qt=C.actionRequired)==null?void 0:qt.type)!=="select_cards_from_hand_to_discard_for_fire_4"&&((Lt=C.actionRequired)==null?void 0:Lt.type)!=="select_cards_from_hand_to_discard_for_hate_1"&&ct([])},[C.actionRequired]),le.useEffect(()=>{var Ce,Te;pn(((Ce=C.actionRequired)==null?void 0:Ce.type)==="prompt_rearrange_protocols"&&C.actionRequired.actor==="player"),tn(((Te=C.actionRequired)==null?void 0:Te.type)==="prompt_swap_protocols"&&C.actionRequired.actor==="player")},[C.actionRequired]),le.useEffect(()=>{const Ce=Te=>{Te.ctrlKey&&Te.shiftKey&&(Te.preventDefault(),Te.key.toLowerCase()==="d"?(console.log("Debug: Toggling debug button visibility."),ya(Ye=>!Ye)):Te.key.toLowerCase()==="w"?(console.log("Debug: Forcing player win."),t("player",C)):Te.key.toLowerCase()==="o"?(console.log("Debug: Forcing opponent win."),t("opponent",C)):Te.key.toLowerCase()==="p"?(console.log("Debug: Setting up Speed-0 interrupt scenario."),Le("speed-0-interrupt")):Te.key.toLowerCase()==="l"?(console.log("Debug: Setting up Speed-1 discard trigger scenario."),Le("speed-1-trigger")):Te.key.toLowerCase()==="f"?(console.log("Debug: Setting up Fire On-Cover test scenario."),Le("fire-oncover-test")):Te.key.toLowerCase()==="s"?(console.log("Debug: Setting up Speed-2 + Control test scenario."),Le("speed-2-control-test")):Te.key.toLowerCase()==="u"&&(console.log("Debug: Setting up Death-1 Uncover test scenario."),x0(()=>Promise.resolve().then(()=>Zb),void 0).then(Ye=>{Le(Ye.scenario14_Death1UncoverTest.setup)})))};return window.addEventListener("keydown",Ce),()=>{window.removeEventListener("keydown",Ce)}},[C,t,Le]);const la=(Ce,Te)=>{const Ye=Qt.current;if(Ye.animationState)return;const{actionRequired:at,turn:qt,phase:Lt,compilableLanes:Vt,player:dn,opponent:zn}=Ye;if(Te==="player"&&qt==="player"&&Lt==="compile"&&Vt.includes(Ce)){if(at){console.warn("Compile click blocked by pending action:",at);return}Z(Ce);return}if(at&&at.actor==="player"&&["select_lane_for_shift","select_lane_for_shift_all","shift_flipped_card_optional","select_lane_for_play","select_lane_for_delete","select_lane_for_death_2","select_lane_for_life_3_play","select_lane_to_shift_revealed_card_for_light_2","select_lane_to_shift_revealed_board_card_custom","select_lane_to_shift_cards_for_light_3","select_lane_for_water_3","select_lane_for_metal_3_delete","select_lane_for_delete_all","select_lane_for_return","select_lanes_for_swap_stacks"].includes(at.type)){z(Ce);return}const da=zn.lanes.flat().some(jt=>jt.isFaceUp&&jt.protocol==="Psychic"&&jt.value===1),Rn=zn.lanes[Ce],Fa=Rn.length>0&&Rn[Rn.length-1].isFaceUp&&Rn[Rn.length-1].protocol==="Plague"&&Rn[Rn.length-1].value===0;if(R&&Lt==="action"&&!at&&dn.hand.some(jt=>jt.id===R)&&!Fa){const jt=dn.hand.find(Zt=>Zt.id===R);if(Te==="opponent"){if(!Kl(Ye,jt)){A(null),Ne(null);return}if(da){A(null),Ne(null);return}I(Ce,!0,"opponent"),Ne(null);return}const ao=dn.lanes.flat().some(Zt=>Zt.isFaceUp&&Zt.protocol==="Spirit"&&Zt.value===1),Oo=dn.lanes.some((Zt,hr)=>{if(Zt.length===0)return!1;const qa=Zt[Zt.length-1];return qa.isFaceUp&&qa.protocol==="Chaos"&&qa.value===3}),oo=[...dn.lanes.flat(),...zn.lanes.flat()].some(Zt=>Zt.isFaceUp&&Zt.protocol==="Anarchy"&&Zt.value===1),ua=Ec(Ye),Mo=ts(Ye,"player",Ce),Ho=Kl(Ye,jt);let yn;Ho?yn=!da:oo||ua?yn=jt.protocol!==dn.protocols[Ce]&&jt.protocol!==zn.protocols[Ce]&&!da:yn=(ao||Mo||Oo||jt.protocol===dn.protocols[Ce]||jt.protocol===zn.protocols[Ce])&&!da,I(Ce,yn),Ne(null);return}R&&(A(null),Ne(null))},va=Ce=>{const Te=Qt.current;if(Te.animationState||!R)return;const{phase:Ye,actionRequired:at,player:qt}=Te;Ye!=="action"||at||!qt.hand.some(Lt=>Lt.id===R)||(I(Ce,!1),Ne(null))},_a=Ce=>{const Te=Qt.current;if(!Te.animationState){if(Te.actionRequired){if(Te.actionRequired.type==="discard"&&Te.actionRequired.actor==="player"){const Ye=Te.actionRequired.count;if(Ye>1||Te.actionRequired.variableCount){ct(at=>at.includes(Ce.id)?at.filter(qt=>qt!==Ce.id):!Te.actionRequired.variableCount&&at.length>=Ye?at:[...at,Ce.id]);return}else{$(Ce.id);return}}if(Te.actionRequired.type==="select_card_from_hand_to_play"){O(Ce.id);return}if(Te.actionRequired.type==="select_card_from_hand_to_give"||Te.actionRequired.type==="select_card_from_hand_to_reveal"){k(Ce.id);return}if(Te.actionRequired.type==="plague_2_player_discard"||Te.actionRequired.type==="select_cards_from_hand_to_discard_for_fire_4"||Te.actionRequired.type==="select_cards_from_hand_to_discard_for_hate_1"){ct(Ye=>Ye.includes(Ce.id)?Ye.filter(at=>at!==Ce.id):[...Ye,Ce.id]);return}return}Te.turn!=="player"||Te.phase!=="action"&&Te.phase!=="compile"||(Ce.id===R?(A(null),Ne(null)):(A(Ce.id),Ne({card:Ce,showContents:!0})))}},wa=(Ce,Te,Ye)=>{const at=Qt.current;if(at.animationState)return;const{actionRequired:qt,turn:Lt,phase:Vt,compilableLanes:dn}=at;if(Lt==="player"&&Vt==="compile"&&dn.includes(Ye)){la(Ye,Te);return}if(Lt==="player"&&!qt&&R&&Vt==="action"){la(Ye,Te);return}if(qt&&qt.actor==="player"&&(qt.type==="select_own_highest_card_to_delete_for_hate_2"||qt.type==="select_opponent_highest_card_to_delete_for_hate_2")&&Sc(Ce,at)){ee(Ce.id);return}if(Sc(Ce,at))ee(Ce.id);else if(R)A(null),Ne(null);else{const zn=Te==="player"||Ce.isFaceUp;Ne({card:Ce,showContents:zn})}},sa=Ce=>{R||Ne({card:Ce,showContents:!0})},ca=(Ce,Te)=>{if(!R){const Ye=Te==="player"||Ce.isFaceUp;Ne({card:Ce,showContents:Ye})}},ia=()=>{R||Ne(null)},xa=Ce=>{!R&&!C.actionRequired&&Ne({card:Ce,showContents:Ce.isRevealed||!1})},fe=()=>{if(!hn)return null;const{card:Ce,showContents:Te}=hn;return o.jsx(xt,{card:Ce,isFaceUp:Te})},je=C.turn==="player"&&!C.actionRequired&&C.phase==="compile"&&C.compilableLanes.length>0,qe=((rt=C.actionRequired)==null?void 0:rt.sourceCardId)??null,ze=le.useMemo(()=>{var Ce;return(Ce=C.actionRequired)!=null&&Ce.actor?C.actionRequired.actor==="player"?"action-required-player":"action-required-opponent":""},[C.actionRequired]),Oe=le.useMemo(()=>{const Ce=C.actionRequired;return Ce&&Ce.actor==="player"?Jb.has(Ce.type)?"":"hand-in-background":""},[C.actionRequired]);return o.jsxs("div",{className:"screen game-screen",children:[It&&o.jsx(Zw,{player:It,playerState:C[It],onClose:()=>oa(null),difficulty:i}),Ta&&((Ve=C.actionRequired)==null?void 0:Ve.type)==="prompt_rearrange_protocols"&&o.jsx(Hw,{gameState:C,targetPlayer:C.actionRequired.target,onConfirm:Ce=>{var Te,Ye;((Te=C.actionRequired)==null?void 0:Te.sourceCardId)==="CONTROL_MECHANIC"&&((Ye=C.actionRequired)!=null&&Ye.actor)&&S(C.actionRequired.actor),J(Ce),pn(!1)}}),Mt&&((lt=C.actionRequired)==null?void 0:lt.type)==="prompt_swap_protocols"&&o.jsx(zw,{gameState:C,targetPlayer:C.actionRequired.target,onConfirm:Ce=>{Y(Ce),tn(!1)}}),((Pt=C.actionRequired)==null?void 0:Pt.type)==="select_card_from_revealed_deck"&&C.actionRequired.actor==="player"&&o.jsx(Gw,{gameState:C,onSelectCard:Ce=>{_e(Ce)}}),((mn=C.actionRequired)==null?void 0:mn.type)==="select_card_from_trash_to_play"&&C.actionRequired.actor==="player"&&o.jsx(hm,{gameState:C,onSelectCard:Ce=>{$e(Ce)}}),((Xt=C.actionRequired)==null?void 0:Xt.type)==="select_card_from_trash_to_reveal"&&C.actionRequired.actor==="player"&&o.jsx(hm,{gameState:C,onSelectCard:Ce=>{Ae(Ce)}}),((Et=C.actionRequired)==null?void 0:Et.type)==="prompt_optional_effect"&&C.actionRequired.actor==="player"&&o.jsx(Ww,{gameState:C,onAccept:()=>M(!0),onDecline:()=>M(!1)}),((Ft=C.actionRequired)==null?void 0:Ft.type)==="state_number"&&C.actionRequired.actor==="player"&&o.jsx(Vw,{gameState:C,onConfirm:Ce=>ye(Ce)}),((to=C.actionRequired)==null?void 0:to.type)==="state_protocol"&&C.actionRequired.actor==="player"&&o.jsx(Bw,{gameState:C,availableProtocols:C.actionRequired.availableProtocols||[],onConfirm:Ce=>ke(Ce)}),((no=C.actionRequired)==null?void 0:no.type)==="select_from_drawn_to_reveal"&&C.actionRequired.actor==="player"&&o.jsx(Yw,{gameState:C,allDrawnCardIds:C.actionRequired.allDrawnCardIds||[],eligibleCardIds:C.actionRequired.eligibleCardIds||[],statedNumber:C.actionRequired.statedNumber,revealCount:C.actionRequired.revealCount,onConfirm:Ce=>Ie(Ce),onClose:()=>{Ie("")}}),((kn=C.actionRequired)==null?void 0:kn.type)==="confirm_deck_discard"&&C.actionRequired.actor==="player"&&o.jsx(Qw,{discardedCard:C.actionRequired.discardedCard,deckOwner:C.actionRequired.deckOwner,onConfirm:()=>be()}),((Hn=C.actionRequired)==null?void 0:Hn.type)==="confirm_deck_play_preview"&&C.actionRequired.actor==="player"&&o.jsx(Xw,{card:C.actionRequired.drawnCard,isFaceDown:C.actionRequired.isFaceDown,onConfirm:()=>Pe()}),o.jsx("div",{className:"toaster-container",children:na.map(Ce=>o.jsx(Mw,{message:Ce.message,player:Ce.player},Ce.id))}),Ct&&o.jsx(Ow,{log:C.log,onClose:()=>wt(!1)}),o.jsx("button",{className:"btn log-button",onClick:()=>wt(!0),children:"Log"}),o.jsxs("div",{className:"game-screen-layout",children:[o.jsxs("div",{className:"game-preview-container",children:[o.jsx("h2",{onClick:Mn,style:{cursor:"pointer",userSelect:"none"},title:"Click 5 times to toggle debug mode",children:"Mainframe"}),o.jsx(Lw,{gameState:C,turn:((Uo=C.actionRequired)==null?void 0:Uo.actor)||C.turn,animationState:C.animationState,difficulty:i,onPlayerClick:()=>oa("player"),onOpponentClick:()=>oa("opponent")}),o.jsx("div",{className:"preview-card-area",children:fe()}),o.jsx("button",{className:"btn btn-back",onClick:a,children:"Back"})]}),o.jsxs("div",{className:"game-main-area",children:[je&&o.jsx("div",{className:"compile-prompt-container",children:o.jsx("h3",{children:"Select a Protocol to Compile"})}),o.jsx(qw,{gameState:C,onLanePointerDown:la,onPlayFaceDown:va,selectedCardId:R,onCardPointerDown:wa,onCardPointerEnter:ca,onCardPointerLeave:ia,onOpponentHandCardPointerEnter:xa,onOpponentHandCardPointerLeave:ia,sourceCardId:qe}),o.jsxs("div",{className:"player-action-area",children:[o.jsx($w,{gameState:C,onFillHand:U,onSkipAction:q,onResolveOptionalDrawPrompt:F,onResolveDeath1Prompt:D,onResolveLove1Prompt:T,onResolvePlague2Discard:L,onResolvePlague4Flip:B,onResolveFire3Prompt:G,onResolveOptionalDiscardCustomPrompt:ae,onResolveOptionalEffectPrompt:M,onResolveSpeed3Prompt:K,onResolveFire4Discard:W,onResolveHate1Discard:oe,onResolveLight2Prompt:Q,onResolveRevealBoardCardPrompt:V,onResolvePsychic4Prompt:X,onResolveSpirit1Prompt:me,onResolveSpirit3Prompt:ge,onResolveControlMechanicPrompt:se,onResolveCustomChoice:ie,selectedCardId:R,multiSelectedCardIds:ht,actionRequiredClass:ze}),o.jsx("div",{className:`player-hand-area ${Oe}`,children:C.player.hand.filter(Ce=>{const Te=C.actionRequired;return(Te==null?void 0:Te.type)==="select_card_from_hand_to_play"&&(Te==null?void 0:Te.selectableCardIds)?Te.selectableCardIds.includes(Ce.id):!0}).map(Ce=>{var Ye;const Te=((Ye=C.actionRequired)==null?void 0:Ye.type)==="select_lane_for_play"?Ce.id===C.actionRequired.cardInHandId:Ce.id===R;return o.jsx(xt,{card:Ce,isFaceUp:!0,onPointerDown:()=>_a(Ce),onPointerEnter:()=>sa(Ce),isSelected:Te,isMultiSelected:ht.includes(Ce.id),animationState:C.animationState,additionalClassName:"in-hand"},Ce.id)})})]})]})]}),h&&o.jsx(Kw,{onComplete:E}),Aa&&o.jsx(Kb,{onLoadScenario:Le,onSkipCoinFlip:b,onForceWin:jn,onForceLose:Da})]})}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function tE({onPlayAgain:a,winner:t,finalState:l,difficulty:c}){if(!l)return o.jsxs("div",{className:"screen",children:[o.jsx("h1",{children:"Loading Results..."}),o.jsx("button",{className:"btn",onClick:a,children:"Back to Menu"})]});const i=t==="player",d=(f,p)=>{let u=[f];return p&&u.push("compiled"),u.join(" ")};return o.jsx("div",{className:`screen results-screen ${i?"victory":"defeat"}`,children:o.jsxs("div",{className:"results-screen-content",children:[o.jsxs("header",{className:"results-header",children:[o.jsx("h1",{children:i?"VICTORY":"DEFEAT"}),o.jsx("p",{children:i?"System compiled successfully.":"Critical error in the mainframe."})]}),o.jsxs("div",{className:"results-body",children:[o.jsxs("div",{className:"final-score-section",children:[o.jsx("h3",{children:"Final Score"}),o.jsxs("h4",{className:"results-label results-opponent-label",children:["Opponent (",c.charAt(0).toUpperCase()+c.slice(1),")"]}),o.jsxs("div",{className:"protocol-bars-container",children:[o.jsx("div",{className:"protocol-bar opponent-bar",children:l.opponent.protocols.map((f,p)=>o.jsxs("div",{className:d("protocol-display",l.opponent.compiled[p]),children:[o.jsx("span",{className:"protocol-name",children:f}),o.jsx("span",{className:"protocol-value",children:l.opponent.laneValues[p]})]},`opp-proto-${f}-${p}`))}),o.jsx("div",{className:"protocol-bar player-bar",children:l.player.protocols.map((f,p)=>o.jsxs("div",{className:d("protocol-display",l.player.compiled[p]),children:[o.jsx("span",{className:"protocol-name",children:f}),o.jsx("span",{className:"protocol-value",children:l.player.laneValues[p]})]},`player-proto-${f}-${p}`))})]}),o.jsx("h4",{className:"results-label results-player-label",children:"Player"})]}),o.jsxs("div",{className:"stats-section",children:[o.jsx("h3",{children:"Statistics"}),o.jsxs("div",{className:"stats-grid",children:[o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-item-label",children:"Cards Played"}),o.jsx("span",{className:"stat-item-value opponent",children:l.stats.opponent.cardsPlayed}),o.jsx("span",{className:"stat-item-value player",children:l.stats.player.cardsPlayed})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-item-label",children:"Cards Drawn"}),o.jsx("span",{className:"stat-item-value opponent",children:l.stats.opponent.cardsDrawn}),o.jsx("span",{className:"stat-item-value player",children:l.stats.player.cardsDrawn})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-item-label",children:"Cards Discarded"}),o.jsx("span",{className:"stat-item-value opponent",children:l.stats.opponent.cardsDiscarded}),o.jsx("span",{className:"stat-item-value player",children:l.stats.player.cardsDiscarded})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-item-label",children:"Cards Deleted"}),o.jsx("span",{className:"stat-item-value opponent",children:l.stats.opponent.cardsDeleted}),o.jsx("span",{className:"stat-item-value player",children:l.stats.player.cardsDeleted})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-item-label",children:"Cards Flipped"}),o.jsx("span",{className:"stat-item-value opponent",children:l.stats.opponent.cardsFlipped}),o.jsx("span",{className:"stat-item-value player",children:l.stats.player.cardsFlipped})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-item-label",children:"Cards Shifted"}),o.jsx("span",{className:"stat-item-value opponent",children:l.stats.opponent.cardsShifted}),o.jsx("span",{className:"stat-item-value player",children:l.stats.player.cardsShifted})]})]})]})]}),o.jsx("button",{className:"btn",onClick:a,children:"Play Again"})]})})}function nE({onBack:a}){const[t,l]=le.useState(0);le.useEffect(()=>{Ql(),l(b=>b+1)},[]);const c=le.useMemo(()=>{console.log("[Card Library] Loading cards, refreshKey:",t);const b=Xd(),j=Po(),C=pr(),R=new Set(C.filter(I=>Jr(I)).map(I=>I.name)),A=j.filter(I=>R.has(I.protocol)||b);return console.log("[Card Library] Total cards:",A.length,"(custom enabled:",b,")"),A},[t]),i=le.useMemo(()=>{const b=new Set(c.map(j=>j.protocol));return Array.from(b).sort()},[c]),[d,f]=le.useState(null),p=le.useMemo(()=>{const b=new Set(c.map(j=>j.category));return Array.from(b).sort()},[c]),[u,h]=le.useState(()=>new Set(p));le.useEffect(()=>{c.length>0&&!d&&f(c[0])},[c,d]);const y=b=>{h(j=>{const C=new Set(j);return C.has(b)?C.delete(b):C.add(b),C})},g=b=>{const j=c.find(C=>C.protocol===b);return(j==null?void 0:j.category)||""},_=le.useMemo(()=>i.filter(b=>{const j=g(b);return u.has(j)}),[i,u,c]),x=le.useMemo(()=>{const b={};for(const j of c)b[j.protocol]||(b[j.protocol]=[]),b[j.protocol].push(j);for(const j in b)b[j].sort((C,R)=>C.value-R.value);return b},[c]),S=b=>{f(b)},E=()=>{if(!d)return null;const b={...d,id:"preview",isFaceUp:!0};return o.jsx(xt,{card:b,isFaceUp:!0})};return o.jsxs("div",{className:"screen card-library-screen",children:[o.jsx(bc,{title:"Card Library",onBack:a}),o.jsxs("div",{className:"card-library-layout",children:[o.jsxs("div",{className:"game-preview-container",children:[o.jsx("h2",{children:"Card Preview"}),o.jsx("div",{className:"preview-card-area",children:E()})]}),o.jsxs("div",{className:"card-list-container",children:[o.jsx("div",{className:"category-filters",children:p.map(b=>o.jsxs("label",{className:"category-filter-item",children:[o.jsx("input",{type:"checkbox",checked:u.has(b),onChange:()=>y(b)}),o.jsx("span",{children:b})]},b))}),_.map(b=>o.jsxs("div",{className:"protocol-group",children:[o.jsxs("h3",{children:[b,o.jsxs("span",{className:"protocol-category-label",children:[" (",g(b),")"]})]}),o.jsx("div",{className:"protocol-card-grid",children:x[b].map(j=>{const C={...j,id:`${j.protocol}-${j.value}`,isFaceUp:!0};return o.jsx(xt,{card:C,isFaceUp:!0,additionalClassName:"in-hand",onPointerEnter:()=>S(j),onPointerDown:()=>S(j)},C.id)})})]},b))]})]})]})}function aE({onBack:a}){const[t,l]=le.useState(()=>Gd()),[c,i]=le.useState(!1),d=Lb(t),f=Pb(t),p=Ub(t),u=Ob(t),h=Mb(t),y=Hb(t),g=zb(t),[_,x]=le.useState(null),S=()=>{Ab(),l(Gd()),i(!1)},E=G=>{x(ae=>ae===G?null:G)},b=t.global.totalGamesPlayed,j=t.actions.detailedStats,C=G=>b>0?(G/b).toFixed(1):"0.0",R=(G,ae)=>ae>0?(G/ae).toFixed(1):"0.0",A=j.cardsDrawn.playerFromRefresh+j.cardsDrawn.playerFromEffect,I=j.cardsDrawn.aiFromRefresh+j.cardsDrawn.aiFromEffect,U=A+I,$=j.cardsPlayed.playerFromHand+j.cardsPlayed.playerFromEffect,Z=j.cardsPlayed.aiFromHand+j.cardsPlayed.aiFromEffect,ee=$+Z,z=j.compiles.playerFirstCompile+j.compiles.playerRecompile,O=j.compiles.aiFirstCompile+j.compiles.aiRecompile,k=z+O,q=j.discards.player+j.discards.ai,F=j.deletes.player+j.deletes.ai,D=j.flips.player+j.flips.ai,T=j.shifts.player+j.shifts.ai,L=j.returns.player+j.returns.ai,B=j.refreshes.player+j.refreshes.ai;return o.jsxs("div",{className:"screen statistics-screen",children:[o.jsx(bc,{title:"STATISTICS",onBack:a}),o.jsxs("div",{className:"stats-content",children:[o.jsxs("section",{className:"stats-section",children:[o.jsx("h2",{className:"section-title",children:"Overview"}),o.jsxs("div",{className:"stats-grid",children:[o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Games Played"}),o.jsx("span",{className:"stat-value",children:t.global.totalGamesPlayed})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Win Rate"}),o.jsxs("span",{className:"stat-value",children:[d.toFixed(1),"%"]})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Games Won"}),o.jsx("span",{className:"stat-value win",children:t.global.totalGamesWon})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Games Lost"}),o.jsx("span",{className:"stat-value loss",children:t.global.totalGamesLost})]})]})]}),o.jsxs("section",{className:"stats-section",children:[o.jsx("h2",{className:"section-title",children:"Streaks"}),o.jsxs("div",{className:"stats-grid",children:[o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Current Streak"}),o.jsx("span",{className:`stat-value ${t.global.currentStreak>0?"win":t.global.currentStreak<0?"loss":""}`,children:t.global.currentStreak>0?`+${t.global.currentStreak}`:t.global.currentStreak})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Best Win Streak"}),o.jsx("span",{className:"stat-value win",children:t.global.longestWinStreak})]})]})]}),o.jsxs("section",{className:"stats-section",children:[o.jsx("h2",{className:"section-title",children:"Playtime"}),o.jsxs("div",{className:"stats-grid",children:[o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Total Playtime"}),o.jsx("span",{className:"stat-value",children:Wl(t.global.totalPlaytime)})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Average Game"}),o.jsx("span",{className:"stat-value",children:Wl(f)})]}),t.global.fastestWin&&o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Fastest Win"}),o.jsx("span",{className:"stat-value",children:Wl(t.global.fastestWin)})]}),t.global.longestGame&&o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Longest Game"}),o.jsx("span",{className:"stat-value",children:Wl(t.global.longestGame)})]}),t.global.lastGameDuration&&o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Last Game"}),o.jsx("span",{className:"stat-value",children:Wl(t.global.lastGameDuration)})]})]})]}),o.jsxs("section",{className:"stats-section",children:[o.jsx("h2",{className:"section-title",children:"AI Performance"}),o.jsx("div",{className:"ai-stats",children:["easy","normal","hard"].map(G=>{const ae=t.aiDifficulty[G],M=ae.played>0?ae.wins/ae.played*100:0;return o.jsxs("div",{className:"ai-item",children:[o.jsx("span",{className:"ai-name",children:G}),o.jsxs("span",{className:"ai-record",children:[o.jsxs("span",{className:"win",children:[ae.wins,"W"]})," - ",o.jsxs("span",{className:"loss",children:[ae.losses,"L"]})]}),o.jsxs("span",{className:"ai-winrate",children:["(",M.toFixed(1),"%)"]})]},G)})})]}),u.length>0&&o.jsxs("section",{className:"stats-section",children:[o.jsx("h2",{className:"section-title",children:"Best Win Rate"}),o.jsx("div",{className:"protocol-list",children:u.map((G,ae)=>o.jsxs("div",{className:"protocol-item",children:[o.jsxs("span",{className:"protocol-rank",children:[ae+1,"."]}),o.jsx("span",{className:"protocol-name",children:G.protocol}),o.jsxs("span",{className:"protocol-stats win",children:[G.winRate.toFixed(0),"%  ",G.timesUsed]})]},G.protocol))})]}),p.length>0&&o.jsxs("section",{className:"stats-section",children:[o.jsx("h2",{className:"section-title",children:"Favorite Protocols"}),o.jsx("div",{className:"protocol-list",children:p.map((G,ae)=>o.jsxs("div",{className:"protocol-item",children:[o.jsxs("span",{className:"protocol-rank",children:[ae+1,"."]}),o.jsx("span",{className:"protocol-name",children:G.protocol}),o.jsxs("span",{className:"protocol-stats",children:[G.timesUsed,"  ",G.winRate.toFixed(0),"%"]})]},G.protocol))})]}),h.length>0&&o.jsxs("section",{className:"stats-section",children:[o.jsx("h2",{className:"section-title",children:"Least Used Protocols"}),o.jsx("div",{className:"protocol-list",children:h.map((G,ae)=>o.jsxs("div",{className:"protocol-item",children:[o.jsxs("span",{className:"protocol-rank",children:[ae+1,"."]}),o.jsx("span",{className:"protocol-name",children:G.protocol}),o.jsxs("span",{className:"protocol-stats",children:[G.timesUsed,"  ",G.winRate.toFixed(0),"%"]})]},G.protocol))})]}),y.length>0&&o.jsxs("section",{className:"stats-section",children:[o.jsx("h2",{className:"section-title",children:"Most Played Cards"}),o.jsx("div",{className:"card-list",children:y.map((G,ae)=>o.jsxs("div",{className:"card-item",children:[o.jsxs("span",{className:"card-rank",children:[ae+1,"."]}),o.jsx("span",{className:"card-name",children:G.card}),o.jsxs("span",{className:"card-count",children:[G.count,""]})]},G.card))})]}),g.length>0&&o.jsxs("section",{className:"stats-section",children:[o.jsx("h2",{className:"section-title",children:"Most Deleted Cards"}),o.jsx("div",{className:"card-list",children:g.map((G,ae)=>o.jsxs("div",{className:"card-item",children:[o.jsxs("span",{className:"card-rank",children:[ae+1,"."]}),o.jsx("span",{className:"card-name",children:G.card}),o.jsxs("span",{className:"card-count",children:[G.count,""]})]},G.card))})]}),o.jsxs("section",{className:"stats-section",children:[o.jsx("h2",{className:"section-title",children:"Control Mechanic"}),o.jsxs("div",{className:"stats-grid",children:[o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"With Control"}),o.jsx("span",{className:"stat-value",children:t.control.gamesWithControl})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Without Control"}),o.jsx("span",{className:"stat-value",children:t.control.gamesWithoutControl})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Your Rearranges"}),o.jsx("span",{className:"stat-value",children:t.control.playerRearranges})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"AI Rearranges"}),o.jsx("span",{className:"stat-value",children:t.control.aiRearranges})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Total Rearranges"}),o.jsx("span",{className:"stat-value",children:t.control.totalRearranges})]})]})]}),o.jsxs("section",{className:"stats-section",children:[o.jsx("h2",{className:"section-title",children:"Coin Flip"}),o.jsxs("div",{className:"stats-grid",children:[o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Heads Chosen"}),o.jsxs("span",{className:"stat-value",children:[t.coinFlip.headsChosen," (",t.coinFlip.headsChosen>0?(t.coinFlip.headsWon/t.coinFlip.headsChosen*100).toFixed(0):0,"%)"]})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Tails Chosen"}),o.jsxs("span",{className:"stat-value",children:[t.coinFlip.tailsChosen," (",t.coinFlip.tailsChosen>0?(t.coinFlip.tailsWon/t.coinFlip.tailsChosen*100).toFixed(0):0,"%)"]})]})]})]}),o.jsxs("section",{className:"stats-section full-width",children:[o.jsx("h2",{className:"section-title",children:"Actions (click for details)"}),o.jsxs("div",{className:"actions-container",children:[o.jsxs("div",{className:`stat-item clickable ${_==="played"?"expanded":""}`,onClick:()=>E("played"),children:[o.jsx("span",{className:"stat-label",children:"Cards Played"}),o.jsx("span",{className:"stat-value",children:ee})]}),o.jsxs("div",{className:`stat-item clickable ${_==="drawn"?"expanded":""}`,onClick:()=>E("drawn"),children:[o.jsx("span",{className:"stat-label",children:"Cards Drawn"}),o.jsx("span",{className:"stat-value",children:U})]}),o.jsxs("div",{className:`stat-item clickable ${_==="discards"?"expanded":""}`,onClick:()=>E("discards"),children:[o.jsx("span",{className:"stat-label",children:"Discards"}),o.jsx("span",{className:"stat-value",children:q})]}),o.jsxs("div",{className:`stat-item clickable ${_==="deletes"?"expanded":""}`,onClick:()=>E("deletes"),children:[o.jsx("span",{className:"stat-label",children:"Deletes"}),o.jsx("span",{className:"stat-value",children:F})]}),o.jsxs("div",{className:`stat-item clickable ${_==="flips"?"expanded":""}`,onClick:()=>E("flips"),children:[o.jsx("span",{className:"stat-label",children:"Flips"}),o.jsx("span",{className:"stat-value",children:D})]}),o.jsxs("div",{className:`stat-item clickable ${_==="shifts"?"expanded":""}`,onClick:()=>E("shifts"),children:[o.jsx("span",{className:"stat-label",children:"Shifts"}),o.jsx("span",{className:"stat-value",children:T})]}),o.jsxs("div",{className:`stat-item clickable ${_==="returns"?"expanded":""}`,onClick:()=>E("returns"),children:[o.jsx("span",{className:"stat-label",children:"Returns"}),o.jsx("span",{className:"stat-value",children:L})]}),o.jsxs("div",{className:`stat-item clickable ${_==="compiles"?"expanded":""}`,onClick:()=>E("compiles"),children:[o.jsx("span",{className:"stat-label",children:"Compiles"}),o.jsx("span",{className:"stat-value",children:k})]}),o.jsxs("div",{className:`stat-item clickable ${_==="refreshes"?"expanded":""}`,onClick:()=>E("refreshes"),children:[o.jsx("span",{className:"stat-label",children:"Refreshes"}),o.jsx("span",{className:"stat-value",children:B})]})]}),_==="played"&&o.jsxs("div",{className:"action-details-section",children:[o.jsx("h3",{className:"section-title",children:"Cards Played"}),o.jsxs("div",{className:"action-details-total",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:ee})]}),o.jsxs("div",{className:"action-details-columns",children:[o.jsxs("div",{className:"action-details-column player",children:[o.jsx("div",{className:"column-header",children:"Player"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:$})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"From Hand"}),o.jsx("span",{className:"detail-value",children:j.cardsPlayed.playerFromHand})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"From Effect"}),o.jsx("span",{className:"detail-value",children:j.cardsPlayed.playerFromEffect})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Face-Up"}),o.jsx("span",{className:"detail-value",children:j.cardsPlayed.playerFaceUp})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Face-Down"}),o.jsx("span",{className:"detail-value",children:j.cardsPlayed.playerFaceDown})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:C($)})]})]}),o.jsxs("div",{className:"action-details-column ai",children:[o.jsx("div",{className:"column-header",children:"AI"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:Z})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"From Hand"}),o.jsx("span",{className:"detail-value",children:j.cardsPlayed.aiFromHand})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"From Effect"}),o.jsx("span",{className:"detail-value",children:j.cardsPlayed.aiFromEffect})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Face-Up"}),o.jsx("span",{className:"detail-value",children:j.cardsPlayed.aiFaceUp})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Face-Down"}),o.jsx("span",{className:"detail-value",children:j.cardsPlayed.aiFaceDown})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:C(Z)})]})]})]})]}),_==="drawn"&&o.jsxs("div",{className:"action-details-section",children:[o.jsx("h3",{className:"section-title",children:"Cards Drawn"}),o.jsxs("div",{className:"action-details-total",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:U})]}),o.jsxs("div",{className:"action-details-columns",children:[o.jsxs("div",{className:"action-details-column player",children:[o.jsx("div",{className:"column-header",children:"Player"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:A})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"From Refresh"}),o.jsx("span",{className:"detail-value",children:j.cardsDrawn.playerFromRefresh})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"From Effect"}),o.jsx("span",{className:"detail-value",children:j.cardsDrawn.playerFromEffect})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:C(A)})]})]}),o.jsxs("div",{className:"action-details-column ai",children:[o.jsx("div",{className:"column-header",children:"AI"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:I})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"From Refresh"}),o.jsx("span",{className:"detail-value",children:j.cardsDrawn.aiFromRefresh})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"From Effect"}),o.jsx("span",{className:"detail-value",children:j.cardsDrawn.aiFromEffect})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:C(I)})]})]})]})]}),_==="discards"&&o.jsxs("div",{className:"action-details-section",children:[o.jsx("h3",{className:"section-title",children:"Discards"}),o.jsxs("div",{className:"action-details-total",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:q})]}),o.jsxs("div",{className:"action-details-columns",children:[o.jsxs("div",{className:"action-details-column player",children:[o.jsx("div",{className:"column-header",children:"Player"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:j.discards.player})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:C(j.discards.player)})]})]}),o.jsxs("div",{className:"action-details-column ai",children:[o.jsx("div",{className:"column-header",children:"AI"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:j.discards.ai})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:C(j.discards.ai)})]})]})]})]}),_==="deletes"&&o.jsxs("div",{className:"action-details-section",children:[o.jsx("h3",{className:"section-title",children:"Deletes"}),o.jsxs("div",{className:"action-details-total",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:F})]}),o.jsxs("div",{className:"action-details-columns",children:[o.jsxs("div",{className:"action-details-column player",children:[o.jsx("div",{className:"column-header",children:"Player"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:j.deletes.player})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:C(j.deletes.player)})]})]}),o.jsxs("div",{className:"action-details-column ai",children:[o.jsx("div",{className:"column-header",children:"AI"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:j.deletes.ai})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:C(j.deletes.ai)})]})]})]})]}),_==="flips"&&o.jsxs("div",{className:"action-details-section",children:[o.jsx("h3",{className:"section-title",children:"Flips"}),o.jsxs("div",{className:"action-details-total",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:D})]}),o.jsxs("div",{className:"action-details-columns",children:[o.jsxs("div",{className:"action-details-column player",children:[o.jsx("div",{className:"column-header",children:"Player"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:j.flips.player})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:C(j.flips.player)})]})]}),o.jsxs("div",{className:"action-details-column ai",children:[o.jsx("div",{className:"column-header",children:"AI"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:j.flips.ai})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:C(j.flips.ai)})]})]})]})]}),_==="shifts"&&o.jsxs("div",{className:"action-details-section",children:[o.jsx("h3",{className:"section-title",children:"Shifts"}),o.jsxs("div",{className:"action-details-total",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:T})]}),o.jsxs("div",{className:"action-details-columns",children:[o.jsxs("div",{className:"action-details-column player",children:[o.jsx("div",{className:"column-header",children:"Player"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:j.shifts.player})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:C(j.shifts.player)})]})]}),o.jsxs("div",{className:"action-details-column ai",children:[o.jsx("div",{className:"column-header",children:"AI"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:j.shifts.ai})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:C(j.shifts.ai)})]})]})]})]}),_==="returns"&&o.jsxs("div",{className:"action-details-section",children:[o.jsx("h3",{className:"section-title",children:"Returns"}),o.jsxs("div",{className:"action-details-total",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:L})]}),o.jsxs("div",{className:"action-details-columns",children:[o.jsxs("div",{className:"action-details-column player",children:[o.jsx("div",{className:"column-header",children:"Player"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:j.returns.player})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:C(j.returns.player)})]})]}),o.jsxs("div",{className:"action-details-column ai",children:[o.jsx("div",{className:"column-header",children:"AI"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:j.returns.ai})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:C(j.returns.ai)})]})]})]})]}),_==="compiles"&&o.jsxs("div",{className:"action-details-section",children:[o.jsx("h3",{className:"section-title",children:"Compiles"}),o.jsxs("div",{className:"action-details-total",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:k})]}),o.jsxs("div",{className:"action-details-columns",children:[o.jsxs("div",{className:"action-details-column player",children:[o.jsx("div",{className:"column-header",children:"Player"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:z})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"First-Compile"}),o.jsx("span",{className:"detail-value",children:j.compiles.playerFirstCompile})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Re-Compile"}),o.jsx("span",{className:"detail-value",children:j.compiles.playerRecompile})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:C(z)})]})]}),o.jsxs("div",{className:"action-details-column ai",children:[o.jsx("div",{className:"column-header",children:"AI"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:O})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"First-Compile"}),o.jsx("span",{className:"detail-value",children:j.compiles.aiFirstCompile})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Re-Compile"}),o.jsx("span",{className:"detail-value",children:j.compiles.aiRecompile})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:C(O)})]})]})]})]}),_==="refreshes"&&o.jsxs("div",{className:"action-details-section",children:[o.jsx("h3",{className:"section-title",children:"Refreshes"}),o.jsxs("div",{className:"action-details-total",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:B})]}),o.jsxs("div",{className:"action-details-columns",children:[o.jsxs("div",{className:"action-details-column player",children:[o.jsx("div",{className:"column-header",children:"Player"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:j.refreshes.player})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Cards / Refresh"}),o.jsx("span",{className:"detail-value",children:R(j.refreshes.playerCardsDrawn,j.refreshes.player)})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:C(j.refreshes.player)})]})]}),o.jsxs("div",{className:"action-details-column ai",children:[o.jsx("div",{className:"column-header",children:"AI"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:j.refreshes.ai})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Cards / Refresh"}),o.jsx("span",{className:"detail-value",children:R(j.refreshes.aiCardsDrawn,j.refreshes.ai)})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:C(j.refreshes.ai)})]})]})]})]})]}),o.jsx("section",{className:"stats-section reset-section",children:o.jsx("button",{className:"reset-stats-button",onClick:()=>i(!0),children:"Reset All Statistics"})})]}),c&&o.jsx("div",{className:"reset-modal-overlay",onClick:()=>i(!1),children:o.jsxs("div",{className:"reset-modal",onClick:G=>G.stopPropagation(),children:[o.jsx("h3",{children:"Reset Statistics?"}),o.jsx("p",{children:"This will permanently delete all your statistics. This action cannot be undone."}),o.jsxs("div",{className:"reset-modal-buttons",children:[o.jsx("button",{className:"cancel-button",onClick:()=>i(!1),children:"Cancel"}),o.jsx("button",{className:"confirm-reset-button",onClick:S,children:"Reset"})]})]})})]})}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Ug=({params:a,onChange:t})=>{var l,c,i,d,f;return o.jsxs("div",{className:"param-editor draw-effect-editor",children:[o.jsx("h4",{children:"Draw Effect Parameters"}),o.jsxs("label",{children:["Count Type",o.jsxs("select",{value:a.countType||"fixed",onChange:p=>{const u=p.target.value;t({...a,countType:u,countOffset:u==="equal_to_discarded"?0:void 0})},children:[o.jsx("option",{value:"fixed",children:"Fixed Amount"}),o.jsx("option",{value:"equal_to_card_value",children:"Equal to Card Value (from previous effect)"}),o.jsx("option",{value:"equal_to_discarded",children:"Equal to Discarded Cards"}),o.jsx("option",{value:"hand_size",children:"Equal to Hand Size"})]})]}),(!a.countType||a.countType==="fixed")&&o.jsxs("label",{children:["Card Count",o.jsx("input",{type:"number",min:1,max:6,value:a.count,onChange:p=>t({...a,count:parseInt(p.target.value)||1})})]}),a.countType==="equal_to_discarded"&&o.jsxs("label",{children:["Offset (+/-)",o.jsx("input",{type:"number",min:-5,max:5,value:a.countOffset||0,onChange:p=>t({...a,countOffset:parseInt(p.target.value)||0})}),o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:'Example: +1 for "discard count plus 1" (Fire-4)'})]}),o.jsxs("label",{children:["Target",o.jsxs("select",{value:a.target,onChange:p=>t({...a,target:p.target.value}),children:[o.jsx("option",{value:"self",children:"Self"}),o.jsx("option",{value:"opponent",children:"Opponent"})]})]}),o.jsxs("label",{children:["Source",o.jsxs("select",{value:a.source,onChange:p=>t({...a,source:p.target.value}),children:[o.jsx("option",{value:"own_deck",children:"Own Deck"}),o.jsx("option",{value:"opponent_deck",children:"Opponent's Deck"})]})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a.preAction==="refresh",onChange:p=>t({...a,preAction:p.target.checked?"refresh":void 0})}),"Refresh hand first (shuffle hand into deck, then draw)"]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a.optional||!1,onChange:p=>t({...a,optional:p.target.checked})}),'Optional ("You may draw" instead of "Draw")']}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a.revealFromDrawn!==void 0,onChange:p=>{if(p.target.checked)t({...a,revealFromDrawn:{valueSource:"stated_number"}});else{const{revealFromDrawn:u,...h}=a;t(h)}}}),"Reveal from Drawn Cards",o.jsx("small",{style:{display:"block",marginLeft:"24px",color:"#8A79E8"},children:"After drawing, reveal cards from the drawn pile (optionally filtered by value)."})]}),a.revealFromDrawn&&o.jsxs(o.Fragment,{children:[o.jsxs("label",{children:["Reveal Count",o.jsxs("select",{value:a.revealFromDrawn.count==="all"?"all":(a.revealFromDrawn.count||1).toString(),onChange:p=>{const u=p.target.value;t({...a,revealFromDrawn:{...a.revealFromDrawn,count:u==="all"?"all":parseInt(u)}})},children:[o.jsx("option",{value:"1",children:"1 card"}),o.jsx("option",{value:"2",children:"2 cards"}),o.jsx("option",{value:"3",children:"3 cards"}),o.jsx("option",{value:"all",children:"All matching cards"})]})]}),o.jsxs("label",{children:["Value Filter",o.jsxs("select",{value:a.revealFromDrawn.valueSource||"stated_number",onChange:p=>t({...a,revealFromDrawn:{...a.revealFromDrawn,valueSource:p.target.value}}),children:[o.jsx("option",{value:"stated_number",children:"Stated Number (requires state_number before)"}),o.jsx("option",{value:"any",children:"Any (no filter)"})]})]}),o.jsxs("label",{children:["After Reveal",o.jsxs("select",{value:a.revealFromDrawn.thenAction||"",onChange:p=>{if(p.target.value===""){const{thenAction:u,...h}=a.revealFromDrawn;t({...a,revealFromDrawn:h})}else t({...a,revealFromDrawn:{...a.revealFromDrawn,thenAction:p.target.value}})},children:[o.jsx("option",{value:"",children:"None"}),o.jsx("option",{value:"may_play",children:'May Play ("You may play it")'})]})]})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a.valueFilter!==void 0,onChange:p=>{if(p.target.checked)t({...a,valueFilter:{equals:1}});else{const{valueFilter:u,...h}=a;t(h)}}}),'Draw specific value only (e.g., "Draw 1 card with a value of X")']}),a.valueFilter!==void 0&&o.jsxs(o.Fragment,{children:[o.jsxs("label",{children:["Card Value to Draw",o.jsx("input",{type:"number",min:0,max:5,value:((l=a.valueFilter)==null?void 0:l.equals)??1,onChange:p=>t({...a,valueFilter:{equals:parseInt(p.target.value)||0}})}),o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"Only draws cards with this exact value from the deck"})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a.fromRevealed||!1,onChange:p=>t({...a,fromRevealed:p.target.checked})}),'From revealed deck ("revealed this way" - player selects)',o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:'Requires "Reveal your deck" effect before this. Player picks from revealed cards.'})]})]}),o.jsxs("label",{children:["Conditional",o.jsxs("select",{value:((c=a.conditional)==null?void 0:c.type)||"none",onChange:p=>{if(p.target.value==="none"){const{conditional:u,...h}=a;t(h)}else t({...a,conditional:{type:p.target.value}})},children:[o.jsx("option",{value:"none",children:"None"}),o.jsx("option",{value:"count_face_down",children:"1 per face-down card (all on board)"}),o.jsx("option",{value:"is_covering",children:"Only if this card is covering another"}),o.jsx("option",{value:"non_matching_protocols",children:"1 per line with non-matching protocol"})]})]}),o.jsxs("label",{children:["Advanced Conditional",o.jsxs("select",{value:((i=a.advancedConditional)==null?void 0:i.type)||"none",onChange:p=>{if(p.target.value==="none"){const{advancedConditional:u,...h}=a;t(h)}else p.target.value==="protocol_match"?t({...a,advancedConditional:{type:"protocol_match",protocol:""}}):p.target.value==="compile_block"?t({...a,advancedConditional:{type:"compile_block",turnDuration:1}}):p.target.value==="empty_hand"?t({...a,advancedConditional:{type:"empty_hand"}}):p.target.value==="opponent_higher_value_in_lane"&&t({...a,advancedConditional:{type:"opponent_higher_value_in_lane"}})},children:[o.jsx("option",{value:"none",children:"None"}),o.jsx("option",{value:"protocol_match",children:"Only if in line with matching protocol"}),o.jsx("option",{value:"compile_block",children:"Block opponent's compile next turn"}),o.jsx("option",{value:"empty_hand",children:"Only if hand is empty"}),o.jsx("option",{value:"opponent_higher_value_in_lane",children:"Only if opponent has higher value in this lane"})]})]}),((d=a.advancedConditional)==null?void 0:d.type)==="protocol_match"&&o.jsxs("label",{children:["Required Protocol",o.jsx("input",{type:"text",placeholder:"e.g., Fire, Water, Lightning",value:a.advancedConditional.protocol||"",onChange:p=>t({...a,advancedConditional:{...a.advancedConditional,type:"protocol_match",protocol:p.target.value}})}),o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"Only draw if this card is in a line with this protocol"})]}),((f=a.advancedConditional)==null?void 0:f.type)==="compile_block"&&o.jsxs("label",{children:["Block Duration (turns)",o.jsx("input",{type:"number",min:1,max:3,value:a.advancedConditional.turnDuration||1,onChange:p=>t({...a,advancedConditional:{...a.advancedConditional,type:"compile_block",turnDuration:parseInt(p.target.value)||1}})}),o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"Opponent can't compile for this many turns"})]})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const oE=({params:a,onChange:t})=>o.jsxs("div",{className:"param-editor refresh-effect-editor",children:[o.jsx("h4",{children:"Refresh Effect Parameters"}),o.jsx("p",{className:"effect-description",children:'Refresh fills the hand to 5 cards (Spirit-0: "Refresh.")'}),o.jsxs("label",{children:["Target",o.jsxs("select",{value:a.target||"self",onChange:l=>t({...a,target:l.target.value}),children:[o.jsx("option",{value:"self",children:"Self"}),o.jsx("option",{value:"opponent",children:"Opponent"})]})]})]});/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const rE=({params:a,onChange:t})=>o.jsxs("div",{className:"param-editor mutual-draw-effect-editor",children:[o.jsx("h4",{children:"Mutual Draw Effect Parameters"}),o.jsx("p",{className:"effect-description",children:`Both players draw from each other's decks (Chaos-0: "Draw the top card of your opponent's deck. Your opponent draws the top card of your deck.")`}),o.jsxs("label",{children:["Count",o.jsx("input",{type:"number",min:"1",max:"10",value:a.count||1,onChange:l=>t({...a,count:parseInt(l.target.value)||1})})]})]});/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Og=({params:a,onChange:t})=>{var i,d,f;const l=a.targetFilter||{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1},c=a.count??1;return o.jsxs("div",{className:"param-editor flip-effect-editor",children:[o.jsx("h4",{children:"Flip Effect Parameters"}),o.jsxs("label",{children:["Card Count/Scope",o.jsxs("select",{value:c==="all"?"all":c==="each"?"each":c.toString(),onChange:p=>{const u=p.target.value;t(u==="all"?{...a,count:"all"}:u==="each"?{...a,count:"each"}:{...a,count:parseInt(u)})},children:[o.jsx("option",{value:"1",children:"1 card"}),o.jsx("option",{value:"2",children:"2 cards"}),o.jsx("option",{value:"3",children:"3 cards"}),o.jsx("option",{value:"all",children:"All matching cards"}),o.jsx("option",{value:"each",children:"Each matching card"})]})]}),typeof a.count=="number"&&o.jsxs("label",{children:["Scope",o.jsxs("select",{value:a.scope||"any",onChange:p=>t({...a,scope:p.target.value}),children:[o.jsx("option",{value:"any",children:"Any lane"}),o.jsx("option",{value:"this_lane",children:"This lane only"}),o.jsx("option",{value:"each_lane",children:'Each lane (Chaos-0: "In each line...")'})]})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a.optional,onChange:p=>t({...a,optional:p.target.checked})}),'Optional ("May flip" instead of "Flip")']}),a.count==="each"&&o.jsxs("label",{children:["Each Line Scope",o.jsxs("select",{value:a.eachLineScope||"all_lines",onChange:p=>t({...a,eachLineScope:p.target.value}),children:[o.jsx("option",{value:"all_lines",children:"Each card on board"}),o.jsx("option",{value:"each_line",children:"1 card in each line"})]})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a.flipSelf||!1,onChange:p=>t({...a,flipSelf:p.target.checked})}),"Flip ONLY this card (no target selection)",o.jsx("small",{style:{display:"block",marginLeft:"24px",color:"#8A79E8"},children:"The card flips itself, ignoring count and target filter."})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a.selfFlipAfter||!1,onChange:p=>t({...a,selfFlipAfter:p.target.checked})}),"ALSO flip this card after flipping targets",o.jsx("small",{style:{display:"block",marginLeft:"24px",color:"#8A79E8"},children:"After flipping target(s), also flip this card as bonus."})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a.skipMiddleCommand||!1,onChange:p=>t({...a,skipMiddleCommand:p.target.checked})}),"Skip Middle Command",o.jsx("small",{style:{display:"block",marginLeft:"24px",color:"#8A79E8"},children:"Flip the card but ignore its middle commands."})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a.sameLaneAsFirst||!1,onChange:p=>t({...a,sameLaneAsFirst:p.target.checked})}),"Same Lane as First Flip",o.jsx("small",{style:{display:"block",marginLeft:"24px",color:"#8A79E8"},children:"Follow-up flip must target the same lane as the previous flip."})]}),o.jsx("h5",{children:"Advanced Conditional"}),o.jsxs("label",{children:["Conditional Type",o.jsxs("select",{value:((i=a.advancedConditional)==null?void 0:i.type)||"",onChange:p=>{if(p.target.value===""){const{advancedConditional:u,...h}=a;t(h)}else p.target.value==="protocol_match"?t({...a,advancedConditional:{type:"protocol_match",protocol:""}}):p.target.value==="hand_size_greater_than"?t({...a,advancedConditional:{type:"hand_size_greater_than",threshold:1}}):t({...a,advancedConditional:{type:p.target.value}})},children:[o.jsx("option",{value:"",children:"None"}),o.jsx("option",{value:"protocol_match",children:"Only if in specific protocol line"}),o.jsx("option",{value:"opponent_higher_value_in_lane",children:"Only if opponent has higher value in this lane"}),o.jsx("option",{value:"hand_size_greater_than",children:"Only if hand size greater than X"})]})]}),((d=a.advancedConditional)==null?void 0:d.type)==="protocol_match"&&o.jsxs("label",{children:["Required Protocol",o.jsx("input",{type:"text",value:a.advancedConditional.protocol||"",onChange:p=>t({...a,advancedConditional:{...a.advancedConditional,protocol:p.target.value}}),placeholder:"e.g., Anarchy, Fire, Death"})]}),((f=a.advancedConditional)==null?void 0:f.type)==="hand_size_greater_than"&&o.jsxs("label",{children:["Hand Size Threshold (more than X cards)",o.jsx("input",{type:"number",min:"0",max:"10",value:a.advancedConditional.threshold??1,onChange:p=>t({...a,advancedConditional:{...a.advancedConditional,threshold:parseInt(p.target.value)||0}})}),o.jsx("small",{style:{display:"block",color:"#8A79E8"},children:"Effect only triggers if you have MORE than this many cards in hand."})]}),o.jsx("h5",{children:"Target Filter"}),o.jsxs("label",{children:["Owner",o.jsxs("select",{value:l.owner,onChange:p=>t({...a,targetFilter:{...l,owner:p.target.value}}),children:[o.jsx("option",{value:"any",children:"Any"}),o.jsx("option",{value:"own",children:"Own"}),o.jsx("option",{value:"opponent",children:"Opponent"})]})]}),o.jsxs("label",{children:["Position",o.jsxs("select",{value:l.position,onChange:p=>t({...a,targetFilter:{...l,position:p.target.value}}),children:[o.jsx("option",{value:"any",children:"Any"}),o.jsx("option",{value:"uncovered",children:"Uncovered (top card)"}),o.jsx("option",{value:"covered",children:"Covered"}),o.jsx("option",{value:"covered_in_this_line",children:"Covered in this line"})]})]}),o.jsxs("label",{children:["Face State",o.jsxs("select",{value:l.faceState,onChange:p=>t({...a,targetFilter:{...l,faceState:p.target.value}}),children:[o.jsx("option",{value:"any",children:"Any"}),o.jsx("option",{value:"face_up",children:"Face-up"}),o.jsx("option",{value:"face_down",children:"Face-down"})]})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:l.excludeSelf,onChange:p=>t({...a,targetFilter:{...l,excludeSelf:p.target.checked}})}),'Exclude self ("other cards")']}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:l.valueMinGreaterThanHandSize||!1,onChange:p=>t({...a,targetFilter:{...l,valueMinGreaterThanHandSize:p.target.checked}})}),"Value Greater Than Hand Size",o.jsx("small",{style:{display:"block",marginLeft:"24px",color:"#8A79E8"},children:"Target must have value greater than the number of cards in your hand."})]})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Mg=({params:a,onChange:t})=>{var c,i,d;const l=a.targetFilter||{owner:"any",position:"uncovered",faceState:"any"};return o.jsxs("div",{className:"param-editor",children:[o.jsx("h4",{children:"Shift Effect"}),o.jsxs("label",{children:["Count/Scope",o.jsxs("select",{value:a.count==="all"?"all":"1",onChange:f=>{if(f.target.value==="all")t({...a,count:"all"});else{const{count:p,...u}=a;t(u)}},children:[o.jsx("option",{value:"1",children:"1 card"}),o.jsx("option",{value:"all",children:"All matching cards"})]})]}),o.jsxs("label",{children:["Target Owner",o.jsxs("select",{value:l.owner||"any",onChange:f=>t({...a,targetFilter:{...l,owner:f.target.value}}),children:[o.jsx("option",{value:"any",children:"Any"}),o.jsx("option",{value:"own",children:"Own"}),o.jsx("option",{value:"opponent",children:"Opponent"})]})]}),o.jsxs("label",{children:["Position",o.jsxs("select",{value:l.position||"uncovered",onChange:f=>t({...a,targetFilter:{...l,position:f.target.value}}),children:[o.jsx("option",{value:"any",children:"Any"}),o.jsx("option",{value:"uncovered",children:"Uncovered"}),o.jsx("option",{value:"covered",children:"Covered"})]})]}),o.jsxs("label",{children:["Face State",o.jsxs("select",{value:l.faceState||"any",onChange:f=>t({...a,targetFilter:{...l,faceState:f.target.value}}),children:[o.jsx("option",{value:"any",children:"Any"}),o.jsx("option",{value:"face_up",children:"Face-up"}),o.jsx("option",{value:"face_down",children:"Face-down"})]})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:l.excludeSelf||!1,onChange:f=>t({...a,targetFilter:{...l,excludeSelf:f.target.checked}})}),'Exclude self ("other card")']}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a.optional||!1,onChange:f=>t({...a,optional:f.target.checked})}),'Optional ("You may shift" instead of "Shift")']}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a.shiftSelf||!1,onChange:f=>t({...a,shiftSelf:f.target.checked})}),"Shift this card (instead of selecting target)",o.jsx("small",{style:{display:"block",marginLeft:"24px",color:"#8A79E8"},children:"The card shifts itself, ignoring target filter."})]}),o.jsx("h5",{children:"Advanced Conditional"}),o.jsxs("label",{children:["Conditional Type",o.jsxs("select",{value:((c=a.advancedConditional)==null?void 0:c.type)||"none",onChange:f=>{if(f.target.value==="none"){const{advancedConditional:p,...u}=a;t(u)}else t({...a,advancedConditional:{type:f.target.value}})},children:[o.jsx("option",{value:"none",children:"None"}),o.jsx("option",{value:"empty_hand",children:"Only if hand is empty"}),o.jsx("option",{value:"opponent_higher_value_in_lane",children:"Only if opponent has higher value in this lane"}),o.jsx("option",{value:"this_card_is_covered",children:"Only if this card is covered"})]})]}),o.jsxs("label",{children:["Destination",o.jsxs("select",{value:((i=a.destinationRestriction)==null?void 0:i.type)||"any",onChange:f=>{if(f.target.value==="any"){const{destinationRestriction:p,...u}=a;t(u)}else t({...a,destinationRestriction:{type:f.target.value}})},children:[o.jsx("option",{value:"any",children:"Any line"}),o.jsx("option",{value:"to_another_line",children:"To another line"}),o.jsx("option",{value:"non_matching_protocol",children:"Non-matching protocol"}),o.jsx("option",{value:"specific_lane",children:"This line (within)"}),o.jsx("option",{value:"to_this_lane",children:"To THIS lane only"}),o.jsx("option",{value:"to_or_from_this_lane",children:"To OR from this lane"}),o.jsx("option",{value:"opponent_highest_value_lane",children:"To opponent's highest value lane"})]}),((d=a.destinationRestriction)==null?void 0:d.type)==="opponent_highest_value_lane"&&o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"Card can only be shifted to the lane where opponent has highest total value."})]}),o.jsxs("label",{children:["Source Scope",o.jsxs("select",{value:a.scope||"any",onChange:f=>{if(f.target.value==="any"){const{scope:p,...u}=a;t(u)}else t({...a,scope:f.target.value})},children:[o.jsx("option",{value:"any",children:"Any lane (select from all lanes)"}),o.jsx("option",{value:"this_lane",children:"This line only"}),o.jsx("option",{value:"each_lane",children:"Each lane (execute per lane)"})]}),a.scope==="this_lane"&&o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"Only cards in this line can be selected as shift targets."})]})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Hg=({params:a,onChange:t})=>{var c,i,d,f,p,u,h,y;const l=a.targetFilter||{position:"uncovered",faceState:"any"};return o.jsxs("div",{className:"param-editor delete-effect-editor",children:[o.jsx("h4",{children:"Delete Effect Parameters"}),o.jsxs("label",{children:["Anzahl",o.jsxs("select",{value:typeof a.count=="number"?a.count.toString():"all",onChange:g=>t({...a,count:g.target.value==="all"?"all_in_lane":parseInt(g.target.value)}),children:[o.jsx("option",{value:"1",children:"1"}),o.jsx("option",{value:"2",children:"2"}),o.jsx("option",{value:"3",children:"3"}),o.jsx("option",{value:"all",children:"All in a lane"})]})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a.excludeSelf,onChange:g=>t({...a,excludeSelf:g.target.checked})}),"Exclude self (other cards only)"]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a.deleteSelf||!1,onChange:g=>t({...a,deleteSelf:g.target.checked})}),"Delete this card (ignores all other settings)"]}),o.jsx("h5",{children:"Target Filter"}),o.jsxs("label",{children:["Position",o.jsxs("select",{value:l.position,onChange:g=>t({...a,targetFilter:{...l,position:g.target.value}}),children:[o.jsx("option",{value:"any",children:"Any"}),o.jsx("option",{value:"uncovered",children:"Uncovered"}),o.jsx("option",{value:"covered",children:"Covered"})]})]}),o.jsxs("label",{children:["Face State",o.jsxs("select",{value:l.faceState,onChange:g=>t({...a,targetFilter:{...l,faceState:g.target.value}}),children:[o.jsx("option",{value:"any",children:"Any"}),o.jsx("option",{value:"face_up",children:"Face-up"}),o.jsx("option",{value:"face_down",children:"Face-down"})]})]}),o.jsxs("label",{children:["Owner",o.jsxs("select",{value:l.owner||"any",onChange:g=>{const _=g.target.value,x={...l};_==="any"?delete x.owner:x.owner=_,t({...a,targetFilter:x})},children:[o.jsx("option",{value:"any",children:"Any (own or opponent)"}),o.jsx("option",{value:"own",children:"Own cards only"}),o.jsx("option",{value:"opponent",children:"Opponent's cards only"})]})]}),o.jsxs("label",{children:["Calculation",o.jsxs("select",{value:l.calculation||"none",onChange:g=>{const _=g.target.value,x={...l};_==="none"?delete x.calculation:x.calculation=_,t({...a,targetFilter:x})},children:[o.jsx("option",{value:"none",children:"None"}),o.jsx("option",{value:"highest_value",children:"Highest value"}),o.jsx("option",{value:"lowest_value",children:"Lowest value"})]})]}),o.jsxs("label",{children:["Value Range (specific values to target)",o.jsxs("select",{value:l.valueRange?`${l.valueRange.min}-${l.valueRange.max}`:"none",onChange:g=>{const _=g.target.value,x={...l};_==="none"?delete x.valueRange:_==="0-1"?x.valueRange={min:0,max:1}:_==="1-2"?x.valueRange={min:1,max:2}:_==="0-0"&&(x.valueRange={min:0,max:0}),t({...a,targetFilter:x})},children:[o.jsx("option",{value:"none",children:"Any value"}),o.jsx("option",{value:"0-0",children:"Value 0 only"}),o.jsx("option",{value:"0-1",children:"Values 0 or 1"}),o.jsx("option",{value:"1-2",children:"Values 1 or 2"})]})]}),o.jsxs("label",{children:["Value Source (dynamic value from previous effect)",o.jsxs("select",{value:l.valueSource||"none",onChange:g=>{const _=g.target.value,x={...l};_==="none"?delete x.valueSource:x.valueSource=_,t({...a,targetFilter:x})},children:[o.jsx("option",{value:"none",children:"None (use value range above)"}),o.jsx("option",{value:"previous_effect_card",children:"Previous Effect Card Value"})]}),l.valueSource==="previous_effect_card"&&o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"Delete cards that share the value with the card from the previous effect."})]}),o.jsx("h5",{children:"Scope"}),o.jsxs("label",{children:["Lane Scope",o.jsxs("select",{value:((c=a.scope)==null?void 0:c.type)||"any",onChange:g=>{const _=g.target.value;if(_==="any"){const{scope:x,...S}=a;t(S)}else t({...a,scope:{type:_}})},children:[o.jsx("option",{value:"any",children:"Any lane"}),o.jsx("option",{value:"this_line",children:"This line only"}),o.jsx("option",{value:"other_lanes",children:"Other lanes"}),o.jsx("option",{value:"each_other_line",children:"Each other line (1 per line)"}),o.jsx("option",{value:"each_lane",children:"Each lane (flexible, 1 per line)"})]})]}),(((i=a.scope)==null?void 0:i.type)==="other_lanes"||((d=a.scope)==null?void 0:d.type)==="any")&&o.jsxs("label",{children:["Minimum Cards in Lane",o.jsxs("select",{value:((f=a.scope)==null?void 0:f.minCardsInLane)||0,onChange:g=>{const _=parseInt(g.target.value);if(_===0){const x={...a.scope};delete x.minCardsInLane,t({...a,scope:x})}else t({...a,scope:{...a.scope,minCardsInLane:_}})},children:[o.jsx("option",{value:0,children:"No minimum"}),o.jsx("option",{value:8,children:"8 or more cards (Metal-3)"}),o.jsx("option",{value:6,children:"6 or more cards"}),o.jsx("option",{value:4,children:"4 or more cards"})]}),((p=a.scope)==null?void 0:p.minCardsInLane)&&o.jsxs("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:["Only delete from lanes with ",a.scope.minCardsInLane,"+ cards total."]})]}),o.jsxs("label",{children:["Who Chooses Target?",o.jsxs("select",{value:a.actorChooses||"effect_owner",onChange:g=>{const _=g.target.value;if(_==="effect_owner"){const{actorChooses:x,...S}=a;t(S)}else t({...a,actorChooses:_})},children:[o.jsx("option",{value:"effect_owner",children:"Effect owner chooses (default)"}),o.jsx("option",{value:"card_owner",children:"Card owner chooses (Plague-4: opponent deletes their own)"})]}),a.actorChooses==="card_owner"&&o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"The owner of the targeted card chooses which card to delete."})]}),o.jsx("h5",{children:"Advanced Conditional"}),o.jsxs("label",{children:["Conditional Type",o.jsxs("select",{value:((u=a.advancedConditional)==null?void 0:u.type)||"none",onChange:g=>{if(g.target.value==="none"){const{advancedConditional:_,...x}=a;t(x)}else t({...a,advancedConditional:{type:g.target.value}})},children:[o.jsx("option",{value:"none",children:"None"}),o.jsx("option",{value:"empty_hand",children:"Only if hand is empty"}),o.jsx("option",{value:"opponent_higher_value_in_lane",children:"Only if opponent has higher value in this lane"})]})]}),o.jsx("h5",{children:"Lane Restriction"}),o.jsxs("label",{children:["Lane Condition",o.jsxs("select",{value:((h=a.laneCondition)==null?void 0:h.type)||"none",onChange:g=>{const _=g.target.value;if(_==="none"){const{laneCondition:x,selectLane:S,...E}=a;t(E)}else t({...a,laneCondition:{type:_},selectLane:!0})},children:[o.jsx("option",{value:"none",children:"None (any lane)"}),o.jsx("option",{value:"opponent_higher_value",children:"Only lanes where opponent has higher value"})]}),((y=a.laneCondition)==null?void 0:y.type)==="opponent_higher_value"&&o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"Can only delete cards in lanes where opponent's total value is higher than yours. Player selects lane first, then card."})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a.selectLane||!1,onChange:g=>t({...a,selectLane:g.target.checked})}),"Select lane first (player chooses lane, then card)",o.jsx("small",{style:{display:"block",marginLeft:"24px",color:"#8A79E8"},children:"Enable if player should pick a lane before selecting a card."})]})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const zg=({params:a,onChange:t})=>{const l=a.countType||"fixed",c=a.variableCount,i=l==="equal_to_discarded",d=a.source||"hand";return o.jsxs("div",{className:"param-editor",children:[o.jsx("h4",{children:"Discard Effect"}),o.jsxs("label",{children:["Source",o.jsxs("select",{value:d,onChange:f=>t({...a,source:f.target.value}),children:[o.jsx("option",{value:"hand",children:"From Hand"}),o.jsx("option",{value:"top_deck_own",children:"Top of Own Deck (automatic)"}),o.jsx("option",{value:"top_deck_opponent",children:"Top of Opponent's Deck (automatic)"}),o.jsx("option",{value:"entire_deck",children:"Entire Deck (automatic)"})]}),(d==="top_deck_own"||d==="top_deck_opponent")&&o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"Deck discard is automatic - no player choice needed. The discarded card's value is saved for follow-up effects."}),d==="entire_deck"&&o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"Discards all cards from your deck to trash automatically."})]}),d==="hand"&&o.jsxs("label",{children:["Count Type",o.jsxs("select",{value:l,onChange:f=>t({...a,countType:f.target.value}),children:[o.jsx("option",{value:"fixed",children:"Fixed Count"}),o.jsx("option",{value:"equal_to_discarded",children:"Equal to Previously Discarded (Plague-2)"})]})]}),d==="hand"&&l==="fixed"&&o.jsxs("label",{children:["Count",o.jsxs("select",{value:c?"variable":a.count.toString(),onChange:f=>{const p=f.target.value;if(p==="variable")t({...a,variableCount:!0,count:1});else if(p==="all"){const{variableCount:u,...h}=a;t({...h,count:"all"})}else{const{variableCount:u,...h}=a;t({...h,count:parseInt(p)})}},children:[o.jsx("option",{value:"1",children:"1 card"}),o.jsx("option",{value:"2",children:"2 cards"}),o.jsx("option",{value:"3",children:"3 cards"}),o.jsx("option",{value:"all",children:"All cards (entire hand)"}),o.jsx("option",{value:"variable",children:"1 or more cards (variable)"})]})]}),d==="hand"&&i&&o.jsxs("label",{children:["Offset (add to count)",o.jsx("input",{type:"number",value:a.countOffset||0,onChange:f=>t({...a,countOffset:parseInt(f.target.value)}),min:"-5",max:"5"})]}),d==="hand"&&o.jsxs("label",{children:["Actor",o.jsxs("select",{value:a.actor,onChange:f=>t({...a,actor:f.target.value}),children:[o.jsx("option",{value:"self",children:"Self"}),o.jsx("option",{value:"opponent",children:"Opponent"}),o.jsx("option",{value:"both",children:"Both Players"})]}),a.actor==="both"&&o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"Both players discard simultaneously (automatic, no selection needed)."})]}),d==="hand"&&a.actor==="opponent"&&o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a.random||!1,onChange:f=>t({...a,random:f.target.checked})}),"Random selection (opponent can't choose which card)",o.jsx("small",{style:{display:"block",marginLeft:"24px",marginTop:"4px",color:"#8A79E8"},children:"A random card is discarded instead of opponent choosing."})]})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Vg=({params:a,onChange:t})=>{var f,p,u,h;const l=((f=a.targetFilter)==null?void 0:f.owner)||"any",c=((p=a.targetFilter)==null?void 0:p.position)||"uncovered",i=(u=a.targetFilter)==null?void 0:u.valueEquals,d=a.selectLane||!1;return o.jsxs("div",{className:"param-editor",children:[o.jsx("h4",{children:"Return Effect"}),o.jsxs("label",{children:["Count",o.jsxs("select",{value:typeof a.count=="number"?a.count.toString():"all",onChange:y=>t({...a,count:y.target.value==="all"?"all":parseInt(y.target.value)}),children:[o.jsx("option",{value:"1",children:"1"}),o.jsx("option",{value:"2",children:"2"}),o.jsx("option",{value:"all",children:"All"})]})]}),o.jsxs("label",{children:["Whose cards?",o.jsxs("select",{value:l,onChange:y=>t({...a,targetFilter:{...a.targetFilter,owner:y.target.value}}),children:[o.jsx("option",{value:"any",children:"Any card (own or opponent)"}),o.jsx("option",{value:"own",children:"Only own cards"}),o.jsx("option",{value:"opponent",children:"Only opponent cards"})]})]}),o.jsxs("label",{children:["Position",o.jsxs("select",{value:c,onChange:y=>t({...a,targetFilter:{...a.targetFilter,position:y.target.value}}),children:[o.jsx("option",{value:"uncovered",children:"Uncovered (default)"}),o.jsx("option",{value:"covered",children:"Covered"}),o.jsx("option",{value:"any",children:"Any (covered or uncovered)"})]})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:d,onChange:y=>{if(y.target.checked)t({...a,selectLane:!0});else{const{selectLane:g,..._}=a;t(_)}}}),'Select lane first (Water-3: "in 1 line")']}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:i!==void 0,onChange:y=>{if(y.target.checked)t({...a,targetFilter:{...a.targetFilter,valueEquals:2}});else{const{valueEquals:g,..._}=a.targetFilter||{};t({...a,targetFilter:_})}}}),"Filter by value"]}),i!==void 0&&o.jsxs("label",{children:["Value to return",o.jsx("input",{type:"number",min:0,max:6,value:i,onChange:y=>t({...a,targetFilter:{...a.targetFilter,valueEquals:parseInt(y.target.value)||0}})})]}),o.jsx("h5",{children:"Advanced Conditional"}),o.jsxs("label",{children:["Conditional Type",o.jsxs("select",{value:((h=a.advancedConditional)==null?void 0:h.type)||"none",onChange:y=>{if(y.target.value==="none"){const{advancedConditional:g,..._}=a;t(_)}else t({...a,advancedConditional:{type:y.target.value}})},children:[o.jsx("option",{value:"none",children:"None"}),o.jsx("option",{value:"empty_hand",children:"Only if hand is empty"}),o.jsx("option",{value:"opponent_higher_value_in_lane",children:"Only if opponent has higher value in this lane"})]})]})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Bg=({params:a,onChange:t})=>{var c,i,d,f;const l=a.destinationRule||{type:"other_lines"};return o.jsxs("div",{className:"param-editor",children:[o.jsx("h4",{children:"Play Effect"}),o.jsxs("label",{children:["Actor (who plays)",o.jsxs("select",{value:a.actor||"self",onChange:p=>{if(p.target.value==="self"){const{actor:u,...h}=a;t(h)}else t({...a,actor:p.target.value})},children:[o.jsx("option",{value:"self",children:"You"}),o.jsx("option",{value:"opponent",children:"Opponent"})]})]}),o.jsxs("label",{children:["Source",o.jsxs("select",{value:a.source,onChange:p=>t({...a,source:p.target.value}),children:[o.jsx("option",{value:"hand",children:"Hand"}),o.jsx("option",{value:"deck",children:"Deck"}),o.jsx("option",{value:"trash",children:"Trash (Discard Pile)"})]})]}),o.jsxs("label",{children:["Anzahl",o.jsx("input",{type:"number",min:1,max:6,value:a.count,onChange:p=>t({...a,count:parseInt(p.target.value)||1})})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a.faceDown,onChange:p=>t({...a,faceDown:p.target.checked})}),"Face-down"]}),o.jsxs("label",{children:["Destination",o.jsxs("select",{value:l.type,onChange:p=>t({...a,destinationRule:{...l,type:p.target.value}}),children:[o.jsx("option",{value:"other_lines",children:"Other lines (choose 1)"}),o.jsx("option",{value:"each_other_line",children:"Each other line (1 per line)"}),o.jsx("option",{value:"specific_lane",children:"Specific lane (this line)"}),o.jsx("option",{value:"each_line_with_card",children:"Each line with card"}),o.jsx("option",{value:"line_with_matching_cards",children:"Line with matching cards (choose 1)"}),o.jsx("option",{value:"under_this_card",children:"Under this card"})]})]}),(l.type==="each_line_with_card"||l.type==="line_with_matching_cards")&&o.jsxs("label",{children:["Card Filter (which cards must be in line)",o.jsxs("select",{value:((c=l.cardFilter)==null?void 0:c.faceState)||"any",onChange:p=>{const u=p.target.value;if(u==="any"){const{cardFilter:h,...y}=l;t({...a,destinationRule:y})}else t({...a,destinationRule:{...l,cardFilter:{faceState:u}}})},children:[o.jsx("option",{value:"any",children:"Any card"}),o.jsx("option",{value:"face_down",children:"Face-down cards only"}),o.jsx("option",{value:"face_up",children:"Face-up cards only"})]})]}),o.jsxs("label",{children:["Condition",o.jsxs("select",{value:((i=a.condition)==null?void 0:i.type)||"none",onChange:p=>{const u=p.target.value;if(u==="none"){const{condition:h,...y}=a;t(y)}else t(u==="per_x_cards_in_line"?{...a,condition:{type:u,cardCount:2}}:{...a,condition:{type:u}})},children:[o.jsx("option",{value:"none",children:"None (always play)"}),o.jsx("option",{value:"per_x_cards_in_line",children:"For every X cards in this line"}),o.jsx("option",{value:"only_in_lines_with_cards",children:"Only in lines where you have a card"})]})]}),((d=a.condition)==null?void 0:d.type)==="per_x_cards_in_line"&&o.jsxs("label",{children:["Cards per play (X)",o.jsx("input",{type:"number",min:1,max:6,value:a.condition.cardCount||2,onChange:p=>t({...a,condition:{...a.condition,cardCount:parseInt(p.target.value)||2}})}),o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:'Example: "For every 2 cards in this line, play..."  X = 2'})]}),o.jsx("h5",{children:"Advanced Conditional"}),o.jsxs("label",{children:["Conditional Type",o.jsxs("select",{value:((f=a.advancedConditional)==null?void 0:f.type)||"none",onChange:p=>{if(p.target.value==="none"){const{advancedConditional:u,...h}=a;t(h)}else t({...a,advancedConditional:{type:p.target.value}})},children:[o.jsx("option",{value:"none",children:"None"}),o.jsx("option",{value:"empty_hand",children:"Only if hand is empty"}),o.jsx("option",{value:"opponent_higher_value_in_lane",children:"Only if opponent has higher value in this lane"})]})]})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Yg=({params:a,onChange:t})=>o.jsxs("div",{className:"param-editor",children:[o.jsx("h4",{children:"Protocol Effect"}),o.jsxs("label",{children:["Action",o.jsxs("select",{value:a.action,onChange:l=>t({...a,action:l.target.value}),children:[o.jsx("option",{value:"rearrange_protocols",children:"Rearrange"}),o.jsx("option",{value:"swap_protocols",children:"Swap"})]})]}),o.jsxs("label",{children:["Target",o.jsxs("select",{value:a.target,onChange:l=>t({...a,target:l.target.value}),children:[o.jsx("option",{value:"own",children:"Own"}),o.jsx("option",{value:"opponent",children:"Opponent"}),o.jsx("option",{value:"both_sequential",children:"Beide (nacheinander)"})]})]}),o.jsx("h5",{children:"Restriction (Anarchy-3)"}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:!!a.restriction,onChange:l=>{if(l.target.checked)t({...a,restriction:{disallowedProtocol:"",laneIndex:"current"}});else{const{restriction:c,...i}=a;t(i)}}}),"Add restriction (protocol cannot be on specific lane)"]}),a.restriction&&o.jsxs(o.Fragment,{children:[o.jsxs("label",{children:["Disallowed Protocol",o.jsx("input",{type:"text",value:a.restriction.disallowedProtocol,onChange:l=>t({...a,restriction:{...a.restriction,disallowedProtocol:l.target.value}}),placeholder:"e.g., Anarchy, Fire, Death"})]}),o.jsxs("label",{children:["Lane",o.jsxs("select",{value:a.restriction.laneIndex,onChange:l=>t({...a,restriction:{...a.restriction,laneIndex:l.target.value==="current"?"current":parseInt(l.target.value)}}),children:[o.jsx("option",{value:"current",children:"Current lane (where this card is)"}),o.jsx("option",{value:"0",children:"Lane 1 (Left)"}),o.jsx("option",{value:"1",children:"Lane 2 (Middle)"}),o.jsx("option",{value:"2",children:"Lane 3 (Right)"})]})]})]})]});/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Gg=({params:a,onChange:t})=>o.jsxs("div",{className:"param-editor",children:[o.jsx("h4",{children:"Reveal/Give Effect"}),o.jsxs("label",{children:["Action",o.jsxs("select",{value:a.action,onChange:l=>t({...a,action:l.target.value}),children:[o.jsx("option",{value:"reveal",children:"Reveal"}),o.jsx("option",{value:"give",children:"Give"})]})]}),o.jsxs("label",{children:["Source",o.jsxs("select",{value:a.source,onChange:l=>t({...a,source:l.target.value}),children:[o.jsx("option",{value:"own_hand",children:"Your hand"}),o.jsx("option",{value:"opponent_hand",children:"Opponent's hand"}),o.jsx("option",{value:"own_deck_top",children:"Top of your deck"}),o.jsx("option",{value:"own_deck",children:"Your entire deck"}),o.jsx("option",{value:"own_trash",children:"Your trash (discard pile)"}),o.jsx("option",{value:"board",children:"Board card"})]})]}),(a.source==="own_hand"||a.source==="opponent_hand"||a.source==="board"||a.source==="own_trash")&&o.jsxs("label",{children:["Anzahl",o.jsx("input",{type:"number",min:1,max:6,value:a.count,onChange:l=>t({...a,count:parseInt(l.target.value)||1})})]}),a.source==="board"&&o.jsxs("label",{children:["Follow-up action",o.jsxs("select",{value:a.followUpAction||"none",onChange:l=>{if(l.target.value==="none"){const{followUpAction:c,...i}=a;t(i)}else t({...a,followUpAction:l.target.value})},children:[o.jsx("option",{value:"none",children:"None"}),o.jsx("option",{value:"flip",children:"Then flip"}),o.jsx("option",{value:"shift",children:"Then shift"})]})]})]});/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Wg=({params:a,onChange:t})=>o.jsxs("div",{className:"param-editor take-effect-editor",children:[o.jsx("h4",{children:"Take Effect Parameters"}),o.jsxs("label",{children:["Card Count",o.jsx("input",{type:"number",min:1,max:6,value:a.count,onChange:l=>t({...a,count:parseInt(l.target.value)||1})})]}),o.jsxs("label",{children:["Source",o.jsx("select",{value:a.source,onChange:l=>t({...a,source:l.target.value}),children:o.jsx("option",{value:"opponent_hand",children:"Opponent's Hand"})})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a.random,onChange:l=>t({...a,random:l.target.checked})}),"Random (if unchecked, you choose)"]})]}),yc=a=>{switch(a){case"draw":return{action:"draw",count:1,target:"self",source:"own_deck"};case"flip":return{action:"flip",count:1,targetFilter:{owner:"any",position:"any",faceState:"any",excludeSelf:!1},optional:!1};case"shift":return{action:"shift",targetFilter:{owner:"any",position:"any",faceState:"any"},destinationRestriction:{type:"any"}};case"delete":return{action:"delete",count:1,targetFilter:{position:"any",faceState:"any"},scope:{type:"anywhere"},excludeSelf:!1};case"discard":return{action:"discard",count:1,actor:"self"};case"return":return{action:"return",count:1,targetFilter:{},scope:{type:"any_card"}};case"play":return{action:"play",source:"hand",count:1,faceDown:!1,destinationRule:{type:"other_lines"}};case"rearrange_protocols":return{action:"rearrange_protocols",target:"own"};case"swap_protocols":return{action:"swap_protocols",target:"own"};case"reveal":case"give":return{action:a,source:"own_hand",count:1};case"take":return{action:"take",source:"opponent_hand",count:1,random:!0};default:return{}}},lE=({params:a,onChange:t})=>{const[l,c]=le.useState(""),[i,d]=le.useState(""),[f,p]=le.useState(null),u=a.options||[],h=u[0],y=u[1],g=()=>{if(!l)return;const A={id:ot(),params:yc(l),position:"middle",trigger:"on_play"};t({...a,options:[A,y].filter(Boolean)}),c(""),p(1)},_=()=>{if(!i)return;const A={id:ot(),params:yc(i),position:"middle",trigger:"on_play"};t({...a,options:[h,A].filter(Boolean)}),d(""),p(2)},x=()=>{t({...a,options:[y].filter(Boolean)}),f===1&&p(null)},S=()=>{t({...a,options:[h].filter(Boolean)}),f===2&&p(null)},E=A=>{const I={...h,params:A};t({...a,options:[I,y].filter(Boolean)})},b=A=>{const I={...y,params:A};t({...a,options:[h,I].filter(Boolean)})},j=A=>{const I=yc(A),U={...h,params:I};t({...a,options:[U,y].filter(Boolean)})},C=A=>{const I=yc(A),U={...y,params:I};t({...a,options:[h,U].filter(Boolean)})},R=(A,I)=>{switch(A.params.action){case"draw":return o.jsx(Ug,{params:A.params,onChange:I});case"flip":return o.jsx(Og,{params:A.params,onChange:I});case"shift":return o.jsx(Mg,{params:A.params,onChange:I});case"delete":return o.jsx(Hg,{params:A.params,onChange:I});case"discard":return o.jsx(zg,{params:A.params,onChange:I});case"return":return o.jsx(Vg,{params:A.params,onChange:I});case"play":return o.jsx(Bg,{params:A.params,onChange:I});case"rearrange_protocols":case"swap_protocols":return o.jsx(Yg,{params:A.params,onChange:I});case"reveal":case"give":return o.jsx(Gg,{params:A.params,onChange:I});case"take":return o.jsx(Wg,{params:A.params,onChange:I});default:return o.jsx("div",{children:"Unknown effect type"})}};return o.jsxs("div",{style:{padding:"10px",backgroundColor:"#2c1d63",borderRadius:"4px",border:"1px solid rgba(97, 239, 255, 0.3)"},children:[o.jsx("h4",{style:{color:"#61EFFF",marginTop:0},children:"Either/Or Choice"}),o.jsx("p",{style:{color:"#F0F0F0",fontSize:"14px",marginBottom:"15px"},children:'Player chooses one of two options. Example: "Either discard 1 card or flip this card"'}),o.jsxs("div",{style:{marginBottom:"15px",padding:"10px",backgroundColor:"rgba(97, 239, 255, 0.05)",borderRadius:"4px"},children:[o.jsx("label",{style:{color:"#61EFFF",display:"block",marginBottom:"10px",fontWeight:"bold"},children:"Option 1:"}),h?o.jsxs(o.Fragment,{children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"10px"},children:[o.jsxs("select",{value:h.params.action,onChange:A=>j(A.target.value),style:{flex:1,padding:"8px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px"},children:[o.jsx("option",{value:"draw",children:"Draw Cards"}),o.jsx("option",{value:"flip",children:"Flip Cards"}),o.jsx("option",{value:"shift",children:"Shift Card"}),o.jsx("option",{value:"delete",children:"Delete Cards"}),o.jsx("option",{value:"discard",children:"Discard Cards"}),o.jsx("option",{value:"return",children:"Return to Hand"}),o.jsx("option",{value:"play",children:"Play from Hand/Deck"})]}),o.jsx("button",{onClick:()=>p(f===1?null:1),style:{padding:"8px 15px",backgroundColor:f===1?"#8B0000":"#61EFFF",color:f===1?"#F0F0F0":"#0A051A",border:"none",borderRadius:"4px",cursor:"pointer",fontWeight:"bold"},children:f===1?"Hide":"Edit"}),o.jsx("button",{onClick:x,style:{padding:"8px 15px",backgroundColor:"#8B0000",color:"#F0F0F0",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Remove"})]}),f===1&&o.jsx("div",{style:{marginTop:"10px"},children:R(h,E)})]}):o.jsxs("div",{style:{display:"flex",gap:"10px"},children:[o.jsxs("select",{value:l,onChange:A=>c(A.target.value),style:{flex:1,padding:"8px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px"},children:[o.jsx("option",{value:"",children:"Choose Action"}),o.jsx("option",{value:"draw",children:"Draw Cards"}),o.jsx("option",{value:"flip",children:"Flip Cards"}),o.jsx("option",{value:"shift",children:"Shift Card"}),o.jsx("option",{value:"delete",children:"Delete Cards"}),o.jsx("option",{value:"discard",children:"Discard Cards"}),o.jsx("option",{value:"return",children:"Return to Hand"}),o.jsx("option",{value:"play",children:"Play from Hand/Deck"})]}),o.jsx("button",{onClick:g,disabled:!l,style:{padding:"8px 15px",backgroundColor:l?"#61EFFF":"#444",color:"#0A051A",border:"none",borderRadius:"4px",cursor:l?"pointer":"not-allowed",fontWeight:"bold"},children:"Add"})]})]}),o.jsxs("div",{style:{padding:"10px",backgroundColor:"rgba(97, 239, 255, 0.05)",borderRadius:"4px"},children:[o.jsx("label",{style:{color:"#61EFFF",display:"block",marginBottom:"10px",fontWeight:"bold"},children:"Option 2:"}),y?o.jsxs(o.Fragment,{children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"10px"},children:[o.jsxs("select",{value:y.params.action,onChange:A=>C(A.target.value),style:{flex:1,padding:"8px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px"},children:[o.jsx("option",{value:"draw",children:"Draw Cards"}),o.jsx("option",{value:"flip",children:"Flip Cards"}),o.jsx("option",{value:"shift",children:"Shift Card"}),o.jsx("option",{value:"delete",children:"Delete Cards"}),o.jsx("option",{value:"discard",children:"Discard Cards"}),o.jsx("option",{value:"return",children:"Return to Hand"}),o.jsx("option",{value:"play",children:"Play from Hand/Deck"})]}),o.jsx("button",{onClick:()=>p(f===2?null:2),style:{padding:"8px 15px",backgroundColor:f===2?"#8B0000":"#61EFFF",color:f===2?"#F0F0F0":"#0A051A",border:"none",borderRadius:"4px",cursor:"pointer",fontWeight:"bold"},children:f===2?"Hide":"Edit"}),o.jsx("button",{onClick:S,style:{padding:"8px 15px",backgroundColor:"#8B0000",color:"#F0F0F0",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Remove"})]}),f===2&&o.jsx("div",{style:{marginTop:"10px"},children:R(y,b)})]}):o.jsxs("div",{style:{display:"flex",gap:"10px"},children:[o.jsxs("select",{value:i,onChange:A=>d(A.target.value),style:{flex:1,padding:"8px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px"},children:[o.jsx("option",{value:"",children:"Choose Action"}),o.jsx("option",{value:"draw",children:"Draw Cards"}),o.jsx("option",{value:"flip",children:"Flip Cards"}),o.jsx("option",{value:"shift",children:"Shift Card"}),o.jsx("option",{value:"delete",children:"Delete Cards"}),o.jsx("option",{value:"discard",children:"Discard Cards"}),o.jsx("option",{value:"return",children:"Return to Hand"}),o.jsx("option",{value:"play",children:"Play from Hand/Deck"})]}),o.jsx("button",{onClick:_,disabled:!i,style:{padding:"8px 15px",backgroundColor:i?"#61EFFF":"#444",color:"#0A051A",border:"none",borderRadius:"4px",cursor:i?"pointer":"not-allowed",fontWeight:"bold"},children:"Add"})]})]}),u.length===2&&o.jsx("div",{style:{marginTop:"15px",padding:"10px",backgroundColor:"rgba(97, 239, 255, 0.1)",borderRadius:"4px"},children:o.jsx("p",{style:{color:"#61EFFF",fontSize:"14px",margin:0},children:" Both options configured. Player will choose one during gameplay."})})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const sE=({params:a,onChange:t})=>{var u,h,y,g,_,x;const l=((u=a.rule)==null?void 0:u.type)||"block_all_play",c=((h=a.rule)==null?void 0:h.target)||"opponent",i=((y=a.rule)==null?void 0:y.scope)||"this_lane",d=((g=a.rule)==null?void 0:g.onlyDuringYourTurn)||!1,f=((_=a.rule)==null?void 0:_.conditionTarget)||"self",p=((x=a.rule)==null?void 0:x.blockTarget)||"self";return o.jsxs("div",{className:"param-editor passive-rule-editor",children:[o.jsx("h4",{children:"Passive Rule Parameters"}),o.jsx("p",{style:{color:"#8A79E8",fontSize:"14px",marginBottom:"15px"},children:"This rule is active while the card is face-up. It modifies game behavior."}),o.jsxs("label",{children:["Rule Type",o.jsxs("select",{value:l,onChange:S=>t({...a,rule:{...a.rule,type:S.target.value,target:c,scope:i}}),children:[o.jsxs("optgroup",{label:"Play Restrictions",children:[o.jsx("option",{value:"block_face_down_play",children:"Block Face-Down Plays (Metal-2)"}),o.jsx("option",{value:"block_face_up_play",children:"Block Face-Up Plays"}),o.jsx("option",{value:"block_all_play",children:"Block All Plays (Plague-0)"}),o.jsx("option",{value:"require_face_down_play",children:"Require Face-Down Plays (Psychic-1)"})]}),o.jsxs("optgroup",{label:"Protocol Matching",children:[o.jsx("option",{value:"allow_any_protocol_play",children:"Allow Any Protocol (Spirit-1, Chaos-3)"}),o.jsx("option",{value:"allow_play_on_opponent_side",children:"Allow Play on Opponent Side (Corruption-0)"}),o.jsx("option",{value:"require_non_matching_protocol",children:"Require Non-Matching (Anarchy-1)"})]}),o.jsxs("optgroup",{label:"Action Blocks",children:[o.jsx("option",{value:"block_flips",children:"Block Flips (Frost-1)"}),o.jsx("option",{value:"block_protocol_rearrange",children:"Block Protocol Rearrange (Frost-1)"}),o.jsx("option",{value:"block_shifts_from_lane",children:"Block Shifts From Lane (Frost-3)"}),o.jsx("option",{value:"block_shifts_to_lane",children:"Block Shifts To Lane (Frost-3)"}),o.jsx("option",{value:"block_flip_this_card",children:"This Card Cannot Be Flipped"})]}),o.jsx("optgroup",{label:"Draw Restrictions",children:o.jsx("option",{value:"block_draw_conditional",children:"Conditional Draw Block"})}),o.jsx("optgroup",{label:"Effect Modifications",children:o.jsx("option",{value:"ignore_middle_commands",children:"Ignore Middle Commands (Apathy-2)"})}),o.jsx("optgroup",{label:"Phase Modifications",children:o.jsx("option",{value:"skip_check_cache_phase",children:"Skip Check Cache Phase (Spirit-0)"})})]})]}),o.jsxs("label",{children:["Affected Player",o.jsxs("select",{value:c,onChange:S=>t({...a,rule:{...a.rule,type:l,target:S.target.value,scope:i}}),children:[o.jsx("option",{value:"self",children:"Self (You)"}),o.jsx("option",{value:"opponent",children:"Opponent"}),o.jsx("option",{value:"all",children:"All Players"})]})]}),o.jsxs("label",{children:["Scope",o.jsxs("select",{value:i,onChange:S=>t({...a,rule:{...a.rule,type:l,target:c,scope:S.target.value,onlyDuringYourTurn:d}}),children:[o.jsx("option",{value:"this_lane",children:"This Lane Only"}),o.jsx("option",{value:"global",children:"Global (All Lanes)"})]})]}),l==="ignore_middle_commands"&&o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:d,onChange:S=>t({...a,rule:{...a.rule,type:l,target:c,scope:i,onlyDuringYourTurn:S.target.checked}})}),"Only during your turn",o.jsx("small",{style:{display:"block",marginLeft:"24px",marginTop:"4px",color:"#8A79E8"},children:"Effect only applies during card owner's turn, not during opponent's turn."})]}),l==="block_draw_conditional"&&o.jsxs(o.Fragment,{children:[o.jsxs("label",{children:["Condition (who must have cards in hand)",o.jsxs("select",{value:f,onChange:S=>t({...a,rule:{...a.rule,type:l,target:"this_card",scope:"global",conditionTarget:S.target.value,blockTarget:p}}),children:[o.jsx("option",{value:"self",children:"Card owner (you)"}),o.jsx("option",{value:"opponent",children:"Opponent of card owner"})]}),o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"If this player has any cards in hand, the draw block activates."})]}),o.jsxs("label",{children:["Block target (who cannot draw)",o.jsxs("select",{value:p,onChange:S=>t({...a,rule:{...a.rule,type:l,target:"this_card",scope:"global",conditionTarget:f,blockTarget:S.target.value}}),children:[o.jsx("option",{value:"self",children:"Card owner (you)"}),o.jsx("option",{value:"opponent",children:"Opponent of card owner"}),o.jsx("option",{value:"all",children:"Both players"})]}),o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"This player cannot draw cards when the condition is met."})]})]}),l==="block_flip_this_card"&&o.jsx("small",{style:{display:"block",marginTop:"8px",color:"#8A79E8"},children:"This card cannot be flipped by any effect. Only affects this specific card."})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const cE=({params:a,onChange:t})=>{var g,_,x,S,E,b,j,C,R;const l=((g=a.modifier)==null?void 0:g.type)||"add_per_condition",c=((_=a.modifier)==null?void 0:_.value)||1,i=((x=a.modifier)==null?void 0:x.condition)||"per_face_down_card",d=((S=a.modifier)==null?void 0:S.target)||"own_total",f=((E=a.modifier)==null?void 0:E.scope)||"this_lane",p=((j=(b=a.modifier)==null?void 0:b.filter)==null?void 0:j.faceState)||"face_down",u=((R=(C=a.modifier)==null?void 0:C.filter)==null?void 0:R.position)||"any",h=l==="add_per_condition",y=l==="set_to_fixed"&&(d==="own_cards"||d==="opponent_cards"||d==="all_cards");return o.jsxs("div",{className:"param-editor value-modifier-editor",children:[o.jsx("h4",{children:"Value Modifier Parameters"}),o.jsx("p",{style:{color:"#8A79E8",fontSize:"14px",marginBottom:"15px"},children:"This modifier is active while the card is face-up. It modifies card values or lane totals."}),o.jsxs("label",{children:["Modifier Type",o.jsxs("select",{value:l,onChange:A=>t({...a,modifier:{...a.modifier,type:A.target.value,value:c,condition:h?i:void 0,target:d,scope:f,filter:y?{faceState:p,position:u}:void 0}}),children:[o.jsx("option",{value:"add_per_condition",children:"Add Per Condition (Apathy-0: +1 per face-down)"}),o.jsx("option",{value:"set_to_fixed",children:"Set Cards To Fixed Value (Darkness-2: face-down = 4)"}),o.jsx("option",{value:"add_to_total",children:"Add To Lane Total (Metal-0: opponent total -2)"})]})]}),o.jsxs("label",{children:["Value",o.jsx("input",{type:"number",value:c,onChange:A=>t({...a,modifier:{...a.modifier,type:l,value:parseInt(A.target.value)||0,condition:h?i:void 0,target:d,scope:f,filter:y?{faceState:p,position:u}:void 0}}),style:{width:"100%",padding:"8px",marginTop:"5px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px"}}),o.jsxs("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:[l==="add_per_condition"&&"Value to add per condition (e.g., +1)",l==="set_to_fixed"&&"Fixed value to set cards to (e.g., 4)",l==="add_to_total"&&"Value to add to total (use negative for subtraction, e.g., -2)"]})]}),h&&o.jsxs("label",{children:["Condition",o.jsxs("select",{value:i,onChange:A=>t({...a,modifier:{...a.modifier,type:l,value:c,condition:A.target.value,target:d,scope:f,filter:y?{faceState:p,position:u}:void 0}}),children:[o.jsx("option",{value:"per_face_down_card",children:"Per Face-Down Card"}),o.jsx("option",{value:"per_face_up_card",children:"Per Face-Up Card"}),o.jsx("option",{value:"per_card",children:"Per Card (any)"}),o.jsx("option",{value:"per_card_in_hand",children:"Per Card in Your Hand"}),o.jsx("option",{value:"per_opponent_card_in_lane",children:"Per Opponent Card in Lane"})]})]}),o.jsxs("label",{children:["Target",o.jsxs("select",{value:d,onChange:A=>t({...a,modifier:{...a.modifier,type:l,value:c,condition:h?i:void 0,target:A.target.value,scope:f,filter:y?{faceState:p,position:u}:void 0}}),children:[o.jsxs("optgroup",{label:"Card Values",children:[o.jsx("option",{value:"own_cards",children:"Own Cards"}),o.jsx("option",{value:"opponent_cards",children:"Opponent Cards"}),o.jsx("option",{value:"all_cards",children:"All Cards"})]}),o.jsxs("optgroup",{label:"Lane Totals",children:[o.jsx("option",{value:"own_total",children:"Own Total"}),o.jsx("option",{value:"opponent_total",children:"Opponent Total"})]})]})]}),y&&o.jsxs(o.Fragment,{children:[o.jsxs("label",{children:["Card Face State (Filter)",o.jsxs("select",{value:p,onChange:A=>t({...a,modifier:{...a.modifier,type:l,value:c,condition:h?i:void 0,target:d,scope:f,filter:{faceState:A.target.value,position:u}}}),children:[o.jsx("option",{value:"face_down",children:"Face-Down Only"}),o.jsx("option",{value:"face_up",children:"Face-Up Only"}),o.jsx("option",{value:"any",children:"Any"})]})]}),o.jsxs("label",{children:["Card Position (Filter)",o.jsxs("select",{value:u,onChange:A=>t({...a,modifier:{...a.modifier,type:l,value:c,condition:h?i:void 0,target:d,scope:f,filter:{faceState:p,position:A.target.value}}}),children:[o.jsx("option",{value:"any",children:"Any Position"}),o.jsx("option",{value:"covered",children:"Covered Only"}),o.jsx("option",{value:"uncovered",children:"Uncovered Only"})]})]})]}),o.jsxs("label",{children:["Scope",o.jsxs("select",{value:f,onChange:A=>t({...a,modifier:{...a.modifier,type:l,value:c,condition:h?i:void 0,target:d,scope:A.target.value,filter:y?{faceState:p,position:u}:void 0}}),children:[o.jsx("option",{value:"this_lane",children:"This Lane Only"}),o.jsx("option",{value:"global",children:"Global (All Lanes)"})]})]})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const iE=({params:a,onChange:t})=>o.jsxs("div",{className:"param-editor block-compile-effect-editor",children:[o.jsx("h4",{children:"Block Compile Effect Parameters"}),o.jsxs("label",{children:["Target",o.jsxs("select",{value:a.target||"opponent",onChange:l=>t({...a,target:l.target.value}),children:[o.jsx("option",{value:"opponent",children:"Opponent cannot compile next turn"}),o.jsx("option",{value:"self",children:"You cannot compile next turn"})]})]})]});/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const dE=({params:a,onChange:t})=>{var c;const l=((c=a.laneCondition)==null?void 0:c.count)||8;return o.jsxs("div",{className:"param-editor delete-all-in-lane-effect-editor",children:[o.jsx("h4",{children:"Delete All In Lane Effect Parameters"}),o.jsxs("label",{children:["Minimum cards in lane",o.jsxs("select",{value:l,onChange:i=>t({...a,laneCondition:{type:"min_cards",count:parseInt(i.target.value)}}),children:[o.jsx("option",{value:0,children:"No minimum (any lane)"}),o.jsx("option",{value:4,children:"4 or more cards"}),o.jsx("option",{value:6,children:"6 or more cards"}),o.jsx("option",{value:8,children:"8 or more cards (Metal-3)"}),o.jsx("option",{value:10,children:"10 or more cards"})]})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a.excludeCurrentLane!==!1,onChange:i=>t({...a,excludeCurrentLane:i.target.checked})}),"Exclude current lane (other lanes only)"]})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const uE=({params:a,onChange:t})=>{var l;return o.jsxs("div",{className:"param-editor",children:[o.jsx("h4",{children:"Shuffle Trash Effect"}),o.jsx("p",{style:{color:"#8A79E8",fontSize:"14px",marginBottom:"15px"},children:"Shuffle your trash (discarded/deleted cards) back into your deck."}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a.optional!==!1,onChange:c=>t({...a,optional:c.target.checked})}),'Optional ("You may shuffle...")']}),o.jsx("h5",{style:{marginTop:"15px"},children:"Conditional"}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:((l=a.advancedConditional)==null?void 0:l.type)==="trash_not_empty",onChange:c=>{if(c.target.checked)t({...a,advancedConditional:{type:"trash_not_empty"}});else{const{advancedConditional:i,...d}=a;t(d)}}}),'Only if trash is not empty ("If there are any cards in your trash...")']})]})},pE=({params:a})=>o.jsxs("div",{className:"param-editor",children:[o.jsx("h4",{children:"Shuffle Deck Effect"}),o.jsx("p",{style:{color:"#8A79E8",fontSize:"14px",marginBottom:"15px"},children:"Shuffle your deck. Typically used after revealing the deck."})]});/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const fE=({params:a,onChange:t})=>o.jsxs("div",{className:"param-editor state-number-effect-editor",children:[o.jsx("h4",{children:"State Number Effect"}),o.jsxs("label",{children:["Number Source",o.jsx("select",{value:a.numberSource||"own_protocol_values",onChange:l=>t({...a,numberSource:l.target.value}),children:o.jsx("option",{value:"own_protocol_values",children:"Own Protocol Values (0-5)"})}),o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"Player chooses a number from the available protocol card values. The stated number is stored for subsequent effects."})]})]});/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const hE=({params:a,onChange:t})=>o.jsxs("div",{className:"param-editor state-protocol-effect-editor",children:[o.jsx("h4",{children:"State Protocol Effect"}),o.jsxs("label",{children:["Protocol Source",o.jsx("select",{value:a.protocolSource||"opponent_cards",onChange:l=>t({...a,protocolSource:l.target.value}),children:o.jsx("option",{value:"opponent_cards",children:"Opponent's Cards (unique protocols)"})}),o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"Player chooses a protocol from the opponent's unique protocols. The stated protocol is stored for subsequent effects (e.g., matching conditionals)."})]})]}),gc=a=>{switch(a){case"draw":return{action:"draw",count:1,target:"self",source:"own_deck"};case"refresh":return{action:"refresh",target:"self"};case"mutual_draw":return{action:"mutual_draw",count:1};case"flip":return{action:"flip",count:1,targetFilter:{owner:"any",position:"any",faceState:"any",excludeSelf:!1},optional:!1};case"shift":return{action:"shift",targetFilter:{owner:"any",position:"any",faceState:"any"},destinationRestriction:{type:"any"}};case"delete":return{action:"delete",count:1,targetFilter:{position:"any",faceState:"any"},scope:{type:"anywhere"},excludeSelf:!1};case"discard":return{action:"discard",count:1,actor:"self"};case"return":return{action:"return",count:1,targetFilter:{},scope:{type:"any_card"}};case"play":return{action:"play",source:"hand",count:1,faceDown:!1,destinationRule:{type:"other_lines"}};case"rearrange_protocols":return{action:"rearrange_protocols",target:"own"};case"swap_protocols":return{action:"swap_protocols",target:"own"};case"reveal":case"give":return{action:a,source:"own_hand",count:1};case"take":return{action:"take",source:"opponent_hand",count:1,random:!0};case"choice":return{action:"choice",options:[]};case"passive_rule":return{action:"passive_rule",rule:{type:"block_all_play",target:"opponent",scope:"this_lane"}};case"value_modifier":return{action:"value_modifier",modifier:{type:"add_per_condition",value:1,condition:"per_face_down_card",target:"own_total",scope:"this_lane"}};case"block_compile":return{action:"block_compile",target:"opponent"};case"delete_all_in_lane":return{action:"delete_all_in_lane",laneCondition:{type:"min_cards",count:8},excludeCurrentLane:!0};case"shuffle_trash":return{action:"shuffle_trash",optional:!0};case"shuffle_deck":return{action:"shuffle_deck"};case"redirect_return_to_deck":return{action:"redirect_return_to_deck",faceDown:!0};case"state_number":return{action:"state_number",numberSource:"own_protocol_values"};case"state_protocol":return{action:"state_protocol",protocolSource:"opponent_cards"};case"swap_stacks":return{action:"swap_stacks",target:"own"};case"copy_opponent_middle":return{action:"copy_opponent_middle",optional:!0};default:return{}}},mE=({effect:a,onChange:t,readOnly:l=!1})=>{const c=x=>{l||t({...a,params:x})},i=x=>{if(x){const S={id:ot(),params:gc("draw"),position:a.position,trigger:a.trigger};t({...a,conditional:{type:"then",thenEffect:S}})}else{const{conditional:S,...E}=a;t(E)}},d=x=>{a.conditional&&t({...a,conditional:{...a.conditional,type:x}})},f=x=>{a.conditional&&t({...a,conditional:{...a.conditional,thenEffect:x}})},p=x=>{if(!a.conditional)return;const S=gc(x),E={...a.conditional.thenEffect,params:S};t({...a,conditional:{...a.conditional,thenEffect:E}})},u=x=>{if(a.conditional)if(x){const S={id:ot(),params:gc("delete"),position:a.position,trigger:a.trigger};t({...a,conditional:{...a.conditional,thenEffect:{...a.conditional.thenEffect,conditional:{type:"then",thenEffect:S}}}})}else{const{conditional:S,...E}=a.conditional.thenEffect;t({...a,conditional:{...a.conditional,thenEffect:E}})}},h=x=>{var S;(S=a.conditional)!=null&&S.thenEffect.conditional&&t({...a,conditional:{...a.conditional,thenEffect:{...a.conditional.thenEffect,conditional:{...a.conditional.thenEffect.conditional,type:x}}}})},y=x=>{var S;(S=a.conditional)!=null&&S.thenEffect.conditional&&t({...a,conditional:{...a.conditional,thenEffect:{...a.conditional.thenEffect,conditional:{...a.conditional.thenEffect.conditional,thenEffect:x}}}})},g=x=>{var b;if(!((b=a.conditional)!=null&&b.thenEffect.conditional))return;const S=gc(x),E={...a.conditional.thenEffect.conditional.thenEffect,params:S};t({...a,conditional:{...a.conditional,thenEffect:{...a.conditional.thenEffect,conditional:{...a.conditional.thenEffect.conditional,thenEffect:E}}}})},_=(x,S)=>{switch(x.params.action){case"draw":return o.jsx(Ug,{params:x.params,onChange:S});case"refresh":return o.jsx(oE,{params:x.params,onChange:S});case"mutual_draw":return o.jsx(rE,{params:x.params,onChange:S});case"flip":return o.jsx(Og,{params:x.params,onChange:S});case"shift":return o.jsx(Mg,{params:x.params,onChange:S});case"delete":return o.jsx(Hg,{params:x.params,onChange:S});case"discard":return o.jsx(zg,{params:x.params,onChange:S});case"return":return o.jsx(Vg,{params:x.params,onChange:S});case"play":return o.jsx(Bg,{params:x.params,onChange:S});case"rearrange_protocols":case"swap_protocols":return o.jsx(Yg,{params:x.params,onChange:S});case"reveal":case"give":return o.jsx(Gg,{params:x.params,onChange:S});case"take":return o.jsx(Wg,{params:x.params,onChange:S});case"choice":return o.jsx(lE,{params:x.params,onChange:S});case"passive_rule":return o.jsx(sE,{params:x.params,onChange:S});case"value_modifier":return o.jsx(cE,{params:x.params,onChange:S});case"block_compile":return o.jsx(iE,{params:x.params,onChange:S});case"delete_all_in_lane":return o.jsx(dE,{params:x.params,onChange:S});case"shuffle_trash":return o.jsx(uE,{params:x.params,onChange:S});case"shuffle_deck":return o.jsx(pE,{params:x.params,onChange:S});case"state_number":return o.jsx(fE,{params:x.params,onChange:S});case"state_protocol":return o.jsx(hE,{params:x.params,onChange:S});case"swap_stacks":return o.jsxs("div",{className:"param-editor swap-stacks-editor",children:[o.jsx("h4",{children:"Swap Stacks"}),o.jsx("p",{style:{color:"#8A79E8"},children:"Swap all of your cards in one of your stacks with another one of your stacks."})]});case"copy_opponent_middle":return o.jsxs("div",{className:"param-editor copy-opponent-middle-editor",children:[o.jsx("h4",{children:"Copy Opponent's Middle Command"}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:x.params.optional??!0,onChange:E=>S({...x.params,optional:E.target.checked})}),'Optional ("You may resolve..." instead of "Resolve...")']}),o.jsx("p",{style:{color:"#8A79E8",marginTop:"10px"},children:"Select one of your opponent's face-up uncovered cards and execute its middle commands as if they were on this card."})]});default:return o.jsxs("div",{children:["Unknown effect type: ",x.params.action]})}};return o.jsxs("div",{className:`effect-editor ${l?"read-only-mode":""}`,children:[o.jsx("div",{className:"trigger-info",style:{marginBottom:"15px",padding:"10px",backgroundColor:"#1A113B",borderRadius:"4px",border:"1px solid rgba(97, 239, 255, 0.3)"},children:o.jsxs("div",{style:{display:"flex",gap:"20px",alignItems:"center",flexWrap:"wrap"},children:[o.jsxs("label",{style:{flex:1,minWidth:"200px"},children:[o.jsx("strong",{children:"Trigger:"}),o.jsxs("select",{value:a.trigger,onChange:x=>!l&&t({...a,trigger:x.target.value}),disabled:l,style:{width:"100%",padding:"6px",marginTop:"4px",backgroundColor:"#2c1d63",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px"},children:[o.jsx("optgroup",{label:"Immediate",children:o.jsx("option",{value:"on_play",children:"On Play"})}),o.jsx("optgroup",{label:"Passive (Top Box)",children:o.jsx("option",{value:"passive",children:"Passive (always active)"})}),o.jsxs("optgroup",{label:"Phase Triggers (Bottom Box)",children:[o.jsx("option",{value:"start",children:"Start Phase"}),o.jsx("option",{value:"end",children:"End Phase"}),o.jsx("option",{value:"on_cover",children:"When Covered"})]}),o.jsxs("optgroup",{label:"Reactive (Top Box)",children:[o.jsx("option",{value:"on_flip",children:"When this card would be flipped"}),o.jsx("option",{value:"on_cover_or_flip",children:"When covered or flipped"}),o.jsx("option",{value:"after_delete",children:"After cards are deleted"}),o.jsx("option",{value:"after_discard",children:"After cards are discarded"}),o.jsx("option",{value:"after_draw",children:"After cards are drawn"}),o.jsx("option",{value:"after_shift",children:"After cards are shifted"}),o.jsx("option",{value:"after_flip",children:"After cards are flipped"}),o.jsx("option",{value:"after_play",children:"After a card is played"}),o.jsx("option",{value:"after_shuffle",children:"After deck is shuffled"}),o.jsx("option",{value:"after_clear_cache",children:"After cache is cleared"}),o.jsx("option",{value:"after_refresh",children:"After you refresh"}),o.jsx("option",{value:"after_opponent_refresh",children:"After opponent refreshes"}),o.jsx("option",{value:"after_compile",children:"After you compile"}),o.jsx("option",{value:"after_opponent_compile",children:"After opponent compiles"}),o.jsx("option",{value:"after_opponent_discard",children:"After opponent discards"}),o.jsx("option",{value:"after_opponent_draw",children:"After opponent draws"}),o.jsx("option",{value:"before_compile_delete",children:"Before deleted by compile"}),o.jsx("option",{value:"when_card_returned",children:"When card returned to hand"})]})]})]}),o.jsxs("div",{style:{color:"#8A79E8",fontSize:"13px"},children:[o.jsx("strong",{children:"Position:"})," ",a.position.charAt(0).toUpperCase()+a.position.slice(1)," Box"]})]})}),o.jsxs("div",{className:"main-effect",children:[o.jsx("h3",{children:"Main Effect"}),_(a,c),o.jsxs("div",{className:"effect-preview",children:[o.jsx("strong",{children:"Preview:"})," ",o.jsx("span",{dangerouslySetInnerHTML:{__html:ir([a])}})]})]}),o.jsxs("div",{style:{marginTop:"15px"},children:[o.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[o.jsx("input",{type:"checkbox",checked:!!a.useCardFromPreviousEffect,onChange:x=>t({...a,useCardFromPreviousEffect:x.target.checked})}),o.jsx("span",{children:`Use card from previous effect (for "shift THAT card", "draw equal to THAT card's value", etc.)`})]}),a.useCardFromPreviousEffect&&o.jsx("small",{style:{display:"block",marginLeft:"24px",marginTop:"4px",color:"#8A79E8"},children:"This effect will target/use the card selected by the previous effect in the chain."})]}),(a.trigger==="after_draw"||a.trigger==="after_delete"||a.trigger==="after_discard"||a.trigger==="after_shift"||a.trigger==="after_flip"||a.trigger==="after_shuffle"||a.trigger==="after_clear_cache"||a.trigger==="after_opponent_discard"||a.trigger==="after_play")&&o.jsxs("div",{style:{marginTop:"15px"},children:[o.jsxs("label",{children:["Trigger Actor (who triggers this effect?)",o.jsxs("select",{value:a.reactiveTriggerActor||"self",onChange:x=>t({...a,reactiveTriggerActor:x.target.value}),style:{width:"100%",padding:"8px",marginTop:"5px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px",cursor:"pointer"},children:[o.jsx("option",{value:"self",children:"Only when YOU perform the action (default)"}),o.jsx("option",{value:"opponent",children:"Only when OPPONENT performs the action"}),o.jsx("option",{value:"any",children:"When ANYONE performs the action"})]})]}),o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:a.reactiveTriggerActor==="self"||!a.reactiveTriggerActor?"Effect triggers only when YOU delete/draw/etc.":a.reactiveTriggerActor==="opponent"?"Effect triggers only when OPPONENT deletes/draws/etc.":"Effect triggers when ANYONE deletes/draws/etc."})]}),(a.trigger==="after_play"||a.trigger==="after_shift"||a.trigger==="after_flip"||a.trigger==="after_delete")&&o.jsxs("div",{style:{marginTop:"15px"},children:[o.jsxs("label",{children:["Reactive Scope",o.jsxs("select",{value:a.reactiveScope||"global",onChange:x=>t({...a,reactiveScope:x.target.value}),style:{width:"100%",padding:"8px",marginTop:"5px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px",cursor:"pointer"},children:[o.jsx("option",{value:"global",children:"Any lane (default)"}),o.jsx("option",{value:"this_lane",children:"This lane only"})]})]}),o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:a.reactiveScope==="this_lane"?"Effect only triggers when the action happens in the same lane as this card.":"Effect triggers when the action happens anywhere on the board."})]}),(a.trigger==="after_draw"||a.trigger==="after_delete"||a.trigger==="after_discard"||a.trigger==="after_shift"||a.trigger==="after_flip"||a.trigger==="after_shuffle")&&o.jsxs("div",{style:{marginTop:"15px"},children:[o.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",cursor:"pointer"},children:[o.jsx("input",{type:"checkbox",checked:a.onlyDuringOpponentTurn||!1,onChange:x=>t({...a,onlyDuringOpponentTurn:x.target.checked}),style:{width:"18px",height:"18px",cursor:"pointer"}}),"Only During Opponent's Turn"]}),o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:a.onlyDuringOpponentTurn?"Effect only triggers during your opponent's turn.":"Effect triggers during any turn."})]}),o.jsxs("div",{className:"conditional-section",style:{marginTop:"20px",borderTop:"1px solid #2c1d63",paddingTop:"15px"},children:[o.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"10px"},children:[o.jsx("input",{type:"checkbox",checked:!!a.conditional,onChange:x=>i(x.target.checked)}),o.jsx("strong",{children:"Add follow-up effect"})]}),a.conditional&&o.jsxs("div",{className:"follow-up-effect",style:{marginLeft:"20px",padding:"10px",backgroundColor:"#2c1d63",borderRadius:"4px",border:"1px solid rgba(97, 239, 255, 0.2)"},children:[o.jsx("h4",{style:{marginTop:0},children:"Follow-Up Effect"}),o.jsxs("label",{children:["Connection Type",o.jsxs("select",{value:a.conditional.type||"then",onChange:x=>d(x.target.value),style:{width:"100%",padding:"8px",marginTop:"5px",marginBottom:"15px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px",cursor:"pointer"},children:[o.jsx("option",{value:"then",children:"Then (always executes)"}),o.jsx("option",{value:"if_executed",children:"If you do (only if first effect succeeds)"})]})]}),o.jsxs("label",{children:["Effect Type",o.jsxs("select",{value:a.conditional.thenEffect.params.action,onChange:x=>p(x.target.value),style:{width:"100%",padding:"8px",marginTop:"5px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px",cursor:"pointer"},children:[o.jsx("option",{value:"draw",children:"Draw Cards"}),o.jsx("option",{value:"refresh",children:"Refresh Hand"}),o.jsx("option",{value:"mutual_draw",children:"Mutual Draw (Exchange)"}),o.jsx("option",{value:"flip",children:"Flip Cards"}),o.jsx("option",{value:"shift",children:"Shift Card"}),o.jsx("option",{value:"delete",children:"Delete Cards"}),o.jsx("option",{value:"delete_all_in_lane",children:"Delete All in Lane"}),o.jsx("option",{value:"discard",children:"Discard Cards"}),o.jsx("option",{value:"return",children:"Return to Hand"}),o.jsx("option",{value:"play",children:"Play from Hand/Deck"}),o.jsx("option",{value:"rearrange_protocols",children:"Rearrange Protocols"}),o.jsx("option",{value:"swap_protocols",children:"Swap Protocols"}),o.jsx("option",{value:"reveal",children:"Reveal Hand"}),o.jsx("option",{value:"give",children:"Give Cards"}),o.jsx("option",{value:"take",children:"Take from Hand"}),o.jsx("option",{value:"choice",children:"Either/Or Choice"}),o.jsx("option",{value:"block_compile",children:"Block Compile"}),o.jsx("option",{value:"shuffle_trash",children:"Shuffle Trash into Deck"}),o.jsx("option",{value:"shuffle_deck",children:"Shuffle Deck"}),o.jsx("option",{value:"state_number",children:"State a Number"}),o.jsx("option",{value:"state_protocol",children:"State a Protocol"}),o.jsx("option",{value:"swap_stacks",children:"Swap Stacks"}),o.jsx("option",{value:"copy_opponent_middle",children:"Copy Opponent's Middle"})]})]}),o.jsx("div",{style:{marginTop:"15px"},children:_(a.conditional.thenEffect,x=>f({...a.conditional.thenEffect,params:x}))}),o.jsxs("div",{className:"nested-conditional-section",style:{marginTop:"15px",borderTop:"1px solid rgba(97, 239, 255, 0.2)",paddingTop:"15px"},children:[o.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"10px"},children:[o.jsx("input",{type:"checkbox",checked:!!a.conditional.thenEffect.conditional,onChange:x=>u(x.target.checked)}),o.jsx("strong",{children:"Add 2nd follow-up effect"})]}),a.conditional.thenEffect.conditional&&o.jsxs("div",{className:"nested-follow-up-effect",style:{marginLeft:"10px",padding:"10px",backgroundColor:"#1A113B",borderRadius:"4px",border:"1px solid rgba(97, 239, 255, 0.2)"},children:[o.jsx("h5",{style:{marginTop:0,fontSize:"0.9rem"},children:"2nd Follow-Up Effect"}),o.jsxs("label",{children:["Connection Type",o.jsxs("select",{value:a.conditional.thenEffect.conditional.type||"then",onChange:x=>h(x.target.value),style:{width:"100%",padding:"6px",marginTop:"5px",marginBottom:"10px",backgroundColor:"#0D0825",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px",cursor:"pointer",fontSize:"0.9rem"},children:[o.jsx("option",{value:"then",children:"Then (always executes)"}),o.jsx("option",{value:"if_executed",children:"If you do (only if first effect succeeds)"})]})]}),o.jsxs("label",{children:["Effect Type",o.jsxs("select",{value:a.conditional.thenEffect.conditional.thenEffect.params.action,onChange:x=>g(x.target.value),style:{width:"100%",padding:"6px",marginTop:"5px",backgroundColor:"#0D0825",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px",cursor:"pointer",fontSize:"0.9rem"},children:[o.jsx("option",{value:"draw",children:"Draw Cards"}),o.jsx("option",{value:"refresh",children:"Refresh Hand"}),o.jsx("option",{value:"mutual_draw",children:"Mutual Draw (Exchange)"}),o.jsx("option",{value:"flip",children:"Flip Cards"}),o.jsx("option",{value:"shift",children:"Shift Card"}),o.jsx("option",{value:"delete",children:"Delete Cards"}),o.jsx("option",{value:"delete_all_in_lane",children:"Delete All in Lane"}),o.jsx("option",{value:"discard",children:"Discard Cards"}),o.jsx("option",{value:"return",children:"Return to Hand"}),o.jsx("option",{value:"play",children:"Play from Hand/Deck"}),o.jsx("option",{value:"rearrange_protocols",children:"Rearrange Protocols"}),o.jsx("option",{value:"swap_protocols",children:"Swap Protocols"}),o.jsx("option",{value:"reveal",children:"Reveal Hand"}),o.jsx("option",{value:"give",children:"Give Cards"}),o.jsx("option",{value:"take",children:"Take from Hand"}),o.jsx("option",{value:"choice",children:"Either/Or Choice"}),o.jsx("option",{value:"block_compile",children:"Block Compile"}),o.jsx("option",{value:"shuffle_trash",children:"Shuffle Trash into Deck"}),o.jsx("option",{value:"shuffle_deck",children:"Shuffle Deck"}),o.jsx("option",{value:"state_number",children:"State a Number"}),o.jsx("option",{value:"state_protocol",children:"State a Protocol"}),o.jsx("option",{value:"swap_stacks",children:"Swap Stacks"}),o.jsx("option",{value:"copy_opponent_middle",children:"Copy Opponent's Middle"})]})]}),o.jsx("div",{style:{marginTop:"10px"},children:_(a.conditional.thenEffect.conditional.thenEffect,x=>y({...a.conditional.thenEffect.conditional.thenEffect,params:x}))})]})]})]})]})]})},yE=({card:a,protocolName:t,protocolColor:l,protocolPattern:c,onChange:i,readOnly:d=!1})=>{const[f,p]=le.useState(null),[u,h]=le.useState(null),[y,g]=le.useState(!1);le.useEffect(()=>{p(null)},[a.value]);const _=(k,q,F)=>{const D={id:ot(),params:gE(q),position:k,trigger:F},T={...a};k==="top"?T.topEffects=[...T.topEffects,D]:k==="middle"?T.middleEffects=[...T.middleEffects,D]:T.bottomEffects=[...T.bottomEffects,D],i(T);const L=k==="top"?T.topEffects.length-1:k==="middle"?T.middleEffects.length-1:T.bottomEffects.length-1;p({box:k,effectIndex:L,effect:D})},x=(k,q)=>{h({box:k,effectIndex:q})},S=()=>{if(!u)return;const{box:k,effectIndex:q}=u,F={...a};k==="top"?F.topEffects.splice(q,1):k==="middle"?F.middleEffects.splice(q,1):F.bottomEffects.splice(q,1),i(F),f&&f.box===k&&f.effectIndex===q&&p(null),h(null)},E=k=>{if(!f)return;const{box:q,effectIndex:F}=f,D={...a};q==="top"?(D.topEffects=[...D.topEffects],D.topEffects[F]=k):q==="middle"?(D.middleEffects=[...D.middleEffects],D.middleEffects[F]=k):(D.bottomEffects=[...D.bottomEffects],D.bottomEffects[F]=k),i(D),p({box:q,effectIndex:F,effect:k})},b=(k,q)=>{const F=k==="top"?a.topEffects[q]:k==="middle"?a.middleEffects[q]:a.bottomEffects[q];p({box:k,effectIndex:q,effect:F})},j=(k,q)=>{const F=(q==null?void 0:q.reactiveTriggerActor)||"self",D=(q==null?void 0:q.reactiveScope)||"global";if(k==="after_play")return`After ${F==="opponent"?"your opponent plays":F==="any"?"a card is played":"you play"} a card${D==="this_lane"?" in this line":""}`;if(["after_delete","after_discard","after_draw","after_shift","after_flip"].includes(k)){const T={after_delete:"delete cards",after_discard:"discard cards",after_draw:"draw cards",after_shift:"shift cards",after_flip:"flip cards"},L=F==="opponent"?"your opponent":F==="any"?"anyone":"you",B=D==="this_lane"?" in this line":"";return`After ${L} ${T[k]}${B}`}switch(k){case"passive":return"";case"on_play":return"";case"start":return"Start";case"end":return"End";case"on_cover":return"On Cover";case"after_opponent_discard":return"After opponent discards";case"after_clear_cache":return"After you clear cache";case"before_compile_delete":return"Before deleted by compile";case"on_flip":return"When this card would be flipped";case"on_cover_or_flip":return"When covered or flipped";default:return k}},C=k=>{const q={...a,value:k};i(q)},R=ir(a.topEffects),A=ir(a.middleEffects),I=ir(a.bottomEffects),U=JSON.stringify({top:a.topEffects.map(k=>({id:k.id,params:k.params})),middle:a.middleEffects.map(k=>({id:k.id,params:k.params})),bottom:a.bottomEffects.map(k=>({id:k.id,params:k.params}))}),$=`${t}-${a.value}-${U}`,Z={id:$,protocol:t,value:a.value,top:R,middle:A,bottom:I,isFaceUp:!0,owner:"player",laneIndex:0,category:"Custom",keywords:{}},ee=(k,q)=>{k=k.replace("#","");const F=parseInt(k.substring(0,2),16),D=parseInt(k.substring(2,4),16),T=parseInt(k.substring(4,6),16);return`rgba(${F}, ${D}, ${T}, ${q})`},z=`card-custom-preview pattern-${c}`,O={"--custom-color":l,"--custom-color-alpha-05":ee(l,.05),"--custom-color-alpha-06":ee(l,.06),"--custom-color-alpha-08":ee(l,.08),"--custom-color-alpha-10":ee(l,.1),"--custom-color-alpha-15":ee(l,.15),"--custom-color-alpha-20":ee(l,.2),"--custom-color-alpha-25":ee(l,.25),borderColor:l};return o.jsxs("div",{className:"card-editor-container",children:[o.jsxs("div",{className:"card-editor-content",children:[o.jsxs("div",{className:"card-live-preview",children:[o.jsx("h4",{children:"Card Preview"}),o.jsxs("label",{className:"card-value-selector",children:["Card Value:",o.jsxs("select",{value:a.value,onChange:k=>C(Number(k.target.value)),children:[o.jsx("option",{value:-1,children:"-1"}),o.jsx("option",{value:0,children:"0"}),o.jsx("option",{value:1,children:"1"}),o.jsx("option",{value:2,children:"2"}),o.jsx("option",{value:3,children:"3"}),o.jsx("option",{value:4,children:"4"}),o.jsx("option",{value:5,children:"5"}),o.jsx("option",{value:6,children:"6"})]})]}),o.jsx("div",{className:"card-preview-wrapper",style:O,children:o.jsx(xt,{card:Z,isFaceUp:!0,additionalClassName:z},$)})]}),o.jsx("div",{className:"card-effects-editor",children:o.jsxs("div",{className:"card-preview",style:{borderColor:l},children:[o.jsx("div",{className:"card-header",style:{backgroundColor:l},children:o.jsxs("h3",{children:[t,"-",a.value]})}),o.jsxs("div",{className:"card-box top-box",children:[o.jsx("h4",{children:"Top Box (Passive/Reactive)"}),o.jsx("p",{className:"box-description",children:"Passive effects or reactive triggers"}),o.jsxs("div",{className:"effects-list",children:[a.topEffects.map((k,q)=>o.jsxs("div",{className:"effect-item",children:[o.jsxs("span",{onClick:()=>b("top",q),className:d?"read-only-clickable":"",children:[k.trigger!=="passive"&&o.jsxs("strong",{children:[j(k.trigger,k),":"]})," ",Zr(k)]}),!d&&o.jsx("button",{onClick:()=>x("top",q),children:""})]},k.id)),a.topEffects.length===0&&o.jsx("p",{className:"empty-box",children:"No effects"})]}),!d&&o.jsxs("div",{className:"add-effect-controls",children:[o.jsxs("select",{id:"top-trigger",defaultValue:"",children:[o.jsx("option",{value:"",children:"Choose Trigger"}),o.jsx("optgroup",{label:"Passive",children:o.jsx("option",{value:"passive",children:"Passive (always active)"})}),o.jsxs("optgroup",{label:"Phase Triggers",children:[o.jsx("option",{value:"start",children:"Start Phase"}),o.jsx("option",{value:"end",children:"End Phase"}),o.jsx("option",{value:"on_cover",children:"On Cover"})]}),o.jsxs("optgroup",{label:"Reactive Triggers",children:[o.jsx("option",{value:"after_delete",children:"After you delete cards"}),o.jsx("option",{value:"after_opponent_discard",children:"After opponent discards"}),o.jsx("option",{value:"after_draw",children:"After you draw cards"}),o.jsx("option",{value:"after_clear_cache",children:"After you clear cache"}),o.jsx("option",{value:"before_compile_delete",children:"Before deleted by compile"}),o.jsx("option",{value:"after_flip",children:"After cards are flipped"}),o.jsx("option",{value:"after_shift",children:"After cards are shifted"}),o.jsx("option",{value:"after_play",children:"After cards are played"}),o.jsx("option",{value:"on_flip",children:"When this card would be flipped"}),o.jsx("option",{value:"on_cover_or_flip",children:"When this card would be covered or flipped"})]})]}),o.jsxs("select",{id:"top-action",defaultValue:"",children:[o.jsx("option",{value:"",children:"Choose Action"}),o.jsx("option",{value:"draw",children:"Draw Cards"}),o.jsx("option",{value:"refresh",children:"Refresh Hand"}),o.jsx("option",{value:"mutual_draw",children:"Mutual Draw (Exchange)"}),o.jsx("option",{value:"flip",children:"Flip Cards"}),o.jsx("option",{value:"shift",children:"Shift Card"}),o.jsx("option",{value:"delete",children:"Delete Cards"}),o.jsx("option",{value:"discard",children:"Discard Cards"}),o.jsx("option",{value:"return",children:"Return to Hand"}),o.jsx("option",{value:"play",children:"Play from Hand/Deck"}),o.jsx("option",{value:"rearrange_protocols",children:"Rearrange Protocols"}),o.jsx("option",{value:"swap_protocols",children:"Swap Protocols"}),o.jsx("option",{value:"reveal",children:"Reveal Hand"}),o.jsx("option",{value:"give",children:"Give Cards"}),o.jsx("option",{value:"take",children:"Take from Hand"}),o.jsx("option",{value:"choice",children:"Either/Or Choice"}),o.jsx("option",{value:"passive_rule",children:"Passive Rule"}),o.jsx("option",{value:"value_modifier",children:"Value Modifier"}),o.jsx("option",{value:"block_compile",children:"Block Compile"}),o.jsx("option",{value:"delete_all_in_lane",children:"Delete All in Lane"})]}),o.jsx("button",{className:"btn btn-add-effect",onClick:()=>{const k=document.getElementById("top-trigger"),q=document.getElementById("top-action"),F=k.value,D=q.value;F&&D?(_("top",D,F),k.value="",q.value=""):g(!0)},children:"+"})]})]}),o.jsxs("div",{className:"card-box middle-box",children:[o.jsx("h4",{children:"Middle Box (On Play)"}),o.jsx("p",{className:"box-description",children:"When played or uncovered"}),o.jsxs("div",{className:"effects-list",children:[a.middleEffects.map((k,q)=>o.jsxs("div",{className:"effect-item",children:[o.jsx("span",{onClick:()=>b("middle",q),className:d?"read-only-clickable":"",children:Zr(k)}),!d&&o.jsx("button",{onClick:()=>x("middle",q),children:""})]},k.id)),a.middleEffects.length===0&&o.jsx("p",{className:"empty-box",children:"No effects"})]}),!d&&o.jsxs("select",{onChange:k=>{k.target.value&&(_("middle",k.target.value,"on_play"),k.target.value="")},children:[o.jsx("option",{value:"",children:"+ Add Effect"}),o.jsx("option",{value:"draw",children:"Draw Cards"}),o.jsx("option",{value:"refresh",children:"Refresh Hand"}),o.jsx("option",{value:"flip",children:"Flip Cards"}),o.jsx("option",{value:"shift",children:"Shift Card"}),o.jsx("option",{value:"delete",children:"Delete Cards"}),o.jsx("option",{value:"discard",children:"Discard Cards"}),o.jsx("option",{value:"return",children:"Return to Hand"}),o.jsx("option",{value:"play",children:"Play from Hand/Deck"}),o.jsx("option",{value:"rearrange_protocols",children:"Rearrange Protocols"}),o.jsx("option",{value:"swap_protocols",children:"Swap Protocols"}),o.jsx("option",{value:"reveal",children:"Reveal Hand"}),o.jsx("option",{value:"give",children:"Give Cards"}),o.jsx("option",{value:"take",children:"Take from Hand"}),o.jsx("option",{value:"choice",children:"Either/Or Choice"}),o.jsx("option",{value:"passive_rule",children:"Passive Rule"}),o.jsx("option",{value:"value_modifier",children:"Value Modifier"}),o.jsx("option",{value:"block_compile",children:"Block Compile"}),o.jsx("option",{value:"delete_all_in_lane",children:"Delete All in Lane"})]})]}),o.jsxs("div",{className:"card-box bottom-box",children:[o.jsx("h4",{children:"Bottom Box (Triggered)"}),o.jsx("p",{className:"box-description",children:"Only when uncovered AND face-up"}),o.jsxs("div",{className:"effects-list",children:[a.bottomEffects.map((k,q)=>o.jsxs("div",{className:"effect-item",children:[o.jsxs("span",{onClick:()=>b("bottom",q),className:d?"read-only-clickable":"",children:[o.jsxs("strong",{children:[j(k.trigger,k),":"]})," ",Zr(k)]}),!d&&o.jsx("button",{onClick:()=>x("bottom",q),children:""})]},k.id)),a.bottomEffects.length===0&&o.jsx("p",{className:"empty-box",children:"No effects"})]}),!d&&o.jsxs("div",{className:"bottom-effect-add",children:[o.jsxs("select",{id:"bottom-trigger",children:[o.jsx("option",{value:"",children:"1. Choose Trigger"}),o.jsx("option",{value:"start",children:"Start Phase"}),o.jsx("option",{value:"end",children:"End Phase"}),o.jsx("option",{value:"on_cover",children:"On Cover"})]}),o.jsxs("select",{id:"bottom-action",children:[o.jsx("option",{value:"",children:"2. Choose Effect"}),o.jsx("option",{value:"draw",children:"Draw Cards"}),o.jsx("option",{value:"refresh",children:"Refresh Hand"}),o.jsx("option",{value:"mutual_draw",children:"Mutual Draw (Exchange)"}),o.jsx("option",{value:"flip",children:"Flip Cards"}),o.jsx("option",{value:"shift",children:"Shift Card"}),o.jsx("option",{value:"delete",children:"Delete Cards"}),o.jsx("option",{value:"discard",children:"Discard Cards"}),o.jsx("option",{value:"return",children:"Return to Hand"}),o.jsx("option",{value:"play",children:"Play from Hand/Deck"}),o.jsx("option",{value:"rearrange_protocols",children:"Rearrange Protocols"}),o.jsx("option",{value:"swap_protocols",children:"Swap Protocols"}),o.jsx("option",{value:"reveal",children:"Reveal Hand"}),o.jsx("option",{value:"give",children:"Give Cards"}),o.jsx("option",{value:"take",children:"Take from Hand"}),o.jsx("option",{value:"choice",children:"Either/Or Choice"}),o.jsx("option",{value:"passive_rule",children:"Passive Rule"}),o.jsx("option",{value:"value_modifier",children:"Value Modifier"}),o.jsx("option",{value:"block_compile",children:"Block Compile"}),o.jsx("option",{value:"delete_all_in_lane",children:"Delete All in Lane"})]}),o.jsx("button",{className:"btn btn-add-effect",onClick:()=>{const k=document.getElementById("bottom-trigger"),q=document.getElementById("bottom-action"),F=k.value,D=q.value;F&&D?(_("bottom",D,F),k.value="",q.value=""):g(!0)},children:"+"})]})]})]})})]}),f&&o.jsxs("div",{className:"effect-parameter-editor",children:[o.jsx("h3",{children:d?"View Effect":"Configure Effect"}),d&&o.jsx("div",{className:"read-only-notice",children:"This effect is read-only"}),o.jsx(mE,{effect:f.effect,onChange:E,readOnly:d}),o.jsx("button",{onClick:()=>p(null),className:"btn",children:d?"Close":"Done"})]}),u&&o.jsx("div",{className:"custom-protocol-modal-overlay",onClick:()=>h(null),children:o.jsxs("div",{className:"custom-protocol-modal-content",onClick:k=>k.stopPropagation(),children:[o.jsx("h3",{children:"Delete Effect"}),o.jsx("p",{children:"Are you sure you want to delete this effect?"}),o.jsxs("div",{className:"custom-protocol-modal-actions",children:[o.jsx("button",{onClick:()=>h(null),className:"btn btn-back",children:"Cancel"}),o.jsx("button",{onClick:S,className:"btn btn-delete",children:"Delete"})]})]})}),y&&o.jsx("div",{className:"custom-protocol-modal-overlay",onClick:()=>g(!1),children:o.jsxs("div",{className:"custom-protocol-modal-content",onClick:k=>k.stopPropagation(),children:[o.jsx("h3",{children:"Missing Selection"}),o.jsx("p",{children:"Please select both a trigger and an effect before adding."}),o.jsx("div",{className:"custom-protocol-modal-actions",children:o.jsx("button",{onClick:()=>g(!1),className:"btn",children:"OK"})})]})})]})},gE=a=>{switch(a){case"draw":return{action:"draw",count:1,target:"self",source:"own_deck"};case"flip":return{action:"flip",count:1,targetFilter:{owner:"any",position:"any",faceState:"any",excludeSelf:!1},optional:!1};case"shift":return{action:"shift",targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1}};case"delete":return{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"any"},excludeSelf:!0};case"discard":return{action:"discard",count:1,actor:"self"};case"return":return{action:"return",count:1,targetFilter:{},scope:{type:"any_card"}};case"play":return{action:"play",source:"hand",count:1,faceDown:!0,destinationRule:{type:"other_lines"}};case"rearrange_protocols":return{action:"rearrange_protocols",target:"own"};case"swap_protocols":return{action:"swap_protocols",target:"own"};case"reveal":case"give":return{action:a,source:"own_hand",count:1};case"take":return{action:"take",source:"opponent_hand",count:1,random:!0};case"choice":return{action:"choice",options:[]};case"passive_rule":return{action:"passive_rule",rule:{type:"block_all_play",target:"opponent",scope:"this_lane"}};case"value_modifier":return{action:"value_modifier",modifier:{type:"add_per_condition",value:1,condition:"per_face_down_card",target:"own_total",scope:"this_lane"}};default:return{}}},vE=(a,t)=>{const l=(i,d)=>{i=i.replace("#","");const f=parseInt(i.substring(0,2),16),p=parseInt(i.substring(2,4),16),u=parseInt(i.substring(4,6),16);return`rgba(${f}, ${p}, ${u}, ${d})`},c={borderColor:t};switch(a){case"solid":return{...c,backgroundColor:t};case"radial":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`radial-gradient(circle at 50% 50%, ${l(t,.25)} 0%, transparent 60%)`};case"dual-radial":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 0% 0%, ${l(t,.2)}, transparent 50%),
                    radial-gradient(at 100% 100%, ${l(t,.2)}, transparent 50%)
                `};case"multi-radial":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 0%, ${l(t,.2)}, transparent 70%),
                    radial-gradient(circle at 20% 30%, ${l(t,.15)}, transparent 40%),
                    radial-gradient(circle at 80% 70%, ${l(t,.2)}, transparent 50%)
                `};case"chaos":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 10% 10%, hsla(60, 100%, 50%, 0.15), transparent 30%),
                    radial-gradient(at 90% 20%, hsla(180, 100%, 50%, 0.15), transparent 35%),
                    radial-gradient(at 30% 80%, hsla(300, 100%, 50%, 0.15), transparent 40%),
                    radial-gradient(at 70% 60%, hsla(0, 100%, 50%, 0.1), transparent 25%)
                `};case"grid":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(circle at 50% 50%, ${l(t,.2)} 0%, transparent 40%),
                    linear-gradient(hsla(0,0%,100%,0.03) 1px, transparent 1px),
                    linear-gradient(90deg, hsla(0,0%,100%,0.03) 1px, transparent 1px)
                `,backgroundSize:"100% 100%, 20px 20px, 20px 20px"};case"diagonal-lines":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 0% 100%, ${l(t,.25)}, transparent 70%),
                    repeating-linear-gradient(120deg, transparent, transparent 15px, ${l(t,.05)} 15px, ${l(t,.05)} 30px)
                `};case"cross-diagonal":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 50%, ${l(t,.25)} 0%, transparent 50%),
                    repeating-linear-gradient(45deg, transparent, transparent 8px, ${l(t,.08)} 8px, ${l(t,.08)} 16px),
                    repeating-linear-gradient(-45deg, transparent, transparent 8px, ${l(t,.06)} 8px, ${l(t,.06)} 16px)
                `};case"horizontal-lines":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 80% 80%, ${l(t,.1)}, transparent 50%),
                    repeating-linear-gradient(0deg, hsla(0,0%,100%,0.02), hsla(0,0%,100%,0.02) 1px, transparent 1px, transparent 3px)
                `};case"vertical-lines":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 10% 10%, ${l(t,.2)}, transparent 50%),
                    repeating-linear-gradient(175deg, transparent, transparent 1px, ${l(t,.05)} 1px, ${l(t,.05)} 2px)
                `};case"cross":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    linear-gradient(0deg, transparent 40%, ${l(t,.1)} 50%, transparent 60%),
                    linear-gradient(90deg, transparent 48%, ${l(t,.2)} 50%, transparent 52%)
                `};case"hexagons":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 0%, ${l(t,.2)}, transparent 70%),
                    url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='28' height='49' viewBox='0 0 28 49'%3E%3Cg fill-rule='evenodd'%3E%3Cg id='hexagons' fill='%23ffffff' fill-opacity='0.05' fill-rule='nonzero'%3E%3Cpath d='M13.99 9.25l13 7.5v15l-13 7.5L1 31.75v-15l12.99-7.5zM3 17.9v12.7l10.99 6.34 11-6.35V17.9l-11-6.34L3 17.9zM0 15l12.99-7.5L26 15v18.5l-13 7.5L0 33.5V15z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")
                `};case"stripes":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 100%, ${l(t,.25)}, transparent 60%),
                    linear-gradient(135deg, hsla(0,0%,0%,0.1) 23%, transparent 23%, transparent 25%, hsla(0,0%,0%,0.1) 25%, hsla(0,0%,0%,0.1) 27%, transparent 27%, transparent 73%, hsla(0,0%,0%,0.1) 73%, hsla(0,0%,0%,0.1) 75%, transparent 75%, transparent 77%, hsla(0,0%,0%,0.1) 77%)
                `};case"frost":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(circle at 50% 50%, ${l(t,.2)} 0%, transparent 50%),
                    repeating-linear-gradient(30deg, transparent, transparent 10px, ${l(t,.08)} 10px, ${l(t,.08)} 11px),
                    repeating-linear-gradient(-30deg, transparent, transparent 10px, ${l(t,.08)} 10px, ${l(t,.08)} 11px),
                    repeating-linear-gradient(90deg, transparent, transparent 8px, ${l(t,.05)} 8px, ${l(t,.05)} 9px)
                `};default:return c}},_E=[{name:"Anarchy",hex:"#EA5A3C"},{name:"Apathy",hex:"#989A9A"},{name:"Chaos",hex:"#E53FE5"},{name:"Darkness",hex:"#A772D4"},{name:"Death",hex:"#E25656"},{name:"Fire",hex:"#F06838"},{name:"Gravity",hex:"#7599EB"},{name:"Hate",hex:"#E03E5E"},{name:"Life",hex:"#3CE076"},{name:"Light",hex:"#FFEB7F"},{name:"Love",hex:"#F074D9"},{name:"Metal",hex:"#B3B8BD"},{name:"Plague",hex:"#A2CD3A"},{name:"Psychic",hex:"#C971EB"},{name:"Speed",hex:"#33DDDD"},{name:"Spirit",hex:"#42D4A8"},{name:"Water",hex:"#3FA4EB"}],wE=[{name:"Solid",value:"solid",description:"Solid color background"},{name:"Radial Glow",value:"radial",description:"Single radial gradient glow"},{name:"Dual Radial",value:"dual-radial",description:"Two radial gradient spots"},{name:"Multi Radial",value:"multi-radial",description:"Multiple radial gradient spots"},{name:"Chaos",value:"chaos",description:"Colorful chaotic spots"},{name:"Grid",value:"grid",description:"Grid line pattern"},{name:"Diagonal Lines",value:"diagonal-lines",description:"Repeating diagonal lines"},{name:"Cross Diagonal",value:"cross-diagonal",description:"Crossed diagonal lines"},{name:"Horizontal Lines",value:"horizontal-lines",description:"Fine horizontal lines"},{name:"Vertical Lines",value:"vertical-lines",description:"Fine vertical lines"},{name:"Cross Pattern",value:"cross",description:"Cross/plus pattern"},{name:"Hexagons",value:"hexagons",description:"Hexagon pattern"},{name:"Stripes",value:"stripes",description:"Diagonal stripe pattern"},{name:"Frost",value:"frost",description:"Icy crystalline pattern with crossing lines"}],xE=({onSave:a,onCancel:t,onDelete:l,initialProtocol:c})=>{const[i,d]=le.useState("name"),[f,p]=le.useState(0),[u,h]=le.useState(!1),[y,g]=le.useState(""),[_,x]=le.useState(!1),S=c?Jr(c):!1;console.log("ProtocolWizard render - initialProtocol:",c,"isReadOnly:",S);const[E,b]=le.useState((c==null?void 0:c.name)||""),[j,C]=le.useState((c==null?void 0:c.description)||""),[R,A]=le.useState((c==null?void 0:c.color)||"#1976D2"),[I,U]=le.useState((c==null?void 0:c.pattern)||"solid"),[$,Z]=le.useState((c==null?void 0:c.cards)||[{value:0,topEffects:[],middleEffects:[],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[],bottomEffects:[]}]);console.log("ProtocolWizard state - name:",E,"color:",R,"pattern:",I);const ee=()=>{if(i==="name"){if(!E.trim()){alert("Please enter a protocol name.");return}d("color")}else i==="color"?d("pattern"):i==="pattern"&&d("cards")},z=L=>{const B=[...$];B[f]=L,Z(B)},O=()=>{const L={id:(c==null?void 0:c.id)||ot(),name:E,description:j,author:"Player",createdAt:(c==null?void 0:c.createdAt)||new Date().toISOString(),color:R,pattern:I,cards:$};a(L)},k=()=>{c&&l&&l(c.id),x(!1)},q=()=>{const L={id:(c==null?void 0:c.id)||ot(),name:E,description:j,author:"Player",createdAt:(c==null?void 0:c.createdAt)||new Date().toISOString(),color:R,pattern:I,cards:$},B=JSON.stringify(L,null,2);g(B),h(!0)},F=()=>{navigator.clipboard.writeText(y).then(()=>{alert("Protocol JSON copied to clipboard!"),h(!1)}).catch(()=>{alert("Failed to copy to clipboard. Please try again.")})},D=L=>!(!E.trim()&&L!=="name"),T=L=>{if(!D(L)){alert("Please enter a protocol name first.");return}d(L)};return o.jsxs("div",{className:"protocol-wizard",children:[o.jsxs("div",{className:"wizard-header",children:[o.jsxs("h2",{children:[S?`View Protocol: ${E}`:c?`Edit Protocol: ${E}`:"Create New Protocol",S&&o.jsx("span",{className:"read-only-badge",children:"Read-Only"})]}),o.jsxs("div",{className:"wizard-progress",children:[o.jsx("button",{className:`step ${i==="name"?"active":"done"}`,onClick:()=>T("name"),type:"button",children:"1. Name"}),o.jsx("button",{className:`step ${i==="color"?"active":i==="pattern"||i==="cards"?"done":""}`,onClick:()=>T("color"),disabled:!D("color"),type:"button",children:"2. Color"}),o.jsx("button",{className:`step ${i==="pattern"?"active":i==="cards"?"done":""}`,onClick:()=>T("pattern"),disabled:!D("pattern"),type:"button",children:"3. Pattern"}),o.jsx("button",{className:`step ${i==="cards"?"active":""}`,onClick:()=>T("cards"),disabled:!D("cards"),type:"button",children:"4. Cards"})]})]}),o.jsxs("div",{className:"wizard-content",children:[i==="name"&&o.jsxs("div",{className:"wizard-step name-step",children:[o.jsx("h3",{children:"Step 1: Name and Description"}),o.jsxs("label",{children:["Protocol Name *",o.jsx("input",{type:"text",value:E,onChange:L=>!S&&b(L.target.value),placeholder:"e.g. Lightning, Shadow, Void",autoFocus:!0,readOnly:S,className:S?"read-only":""})]}),o.jsxs("label",{children:["Description",o.jsx("textarea",{value:j,onChange:L=>!S&&C(L.target.value),placeholder:"Describe the strategy and theme of your protocol",rows:4,readOnly:S,className:S?"read-only":""})]})]}),i==="color"&&o.jsxs("div",{className:"wizard-step color-step",children:[o.jsx("h3",{children:"Step 2: Choose Color"}),o.jsx("div",{className:"color-preview",style:{backgroundColor:R},children:o.jsx("span",{children:E||"Your Protocol"})}),o.jsx("h4",{children:"Predefined Colors"}),o.jsx("div",{className:`color-grid ${S?"read-only":""}`,children:_E.map(L=>o.jsx("button",{className:`color-option ${R===L.hex?"selected":""}`,style:{backgroundColor:L.hex},onClick:()=>!S&&A(L.hex),title:L.name,disabled:S,children:R===L.hex&&""},L.hex))}),o.jsx("h4",{children:"Custom Color"}),o.jsxs("div",{className:"custom-color",children:[o.jsx("input",{type:"color",value:R,onChange:L=>!S&&A(L.target.value),disabled:S}),o.jsx("input",{type:"text",value:R,onChange:L=>!S&&A(L.target.value),placeholder:"#1976D2",readOnly:S,className:S?"read-only":""})]})]}),i==="pattern"&&o.jsxs("div",{className:"wizard-step pattern-step",children:[o.jsx("h3",{children:"Step 3: Choose Card Pattern"}),o.jsx("div",{className:`pattern-selection-grid ${S?"read-only":""}`,children:wE.map(L=>{const B=vE(L.value,R);return o.jsxs("div",{className:`pattern-option ${I===L.value?"selected":""}`,onClick:()=>!S&&U(L.value),children:[o.jsxs("div",{className:"pattern-preview",style:B,children:[E||"Protocol","-0"]}),o.jsx("h4",{children:L.name}),o.jsx("p",{children:L.description}),I===L.value&&o.jsx("div",{className:"selected-badge",children:" Selected"})]},L.value)})})]}),i==="cards"&&o.jsxs("div",{className:"wizard-step cards-step",children:[o.jsx("h3",{children:"Step 4: Configure Cards"}),o.jsx("div",{className:"card-navigation",children:$.map((L,B)=>o.jsxs("button",{className:`card-nav-btn ${f===B?"active":""}`,onClick:()=>p(B),type:"button",children:["Card ",L.value]},B))}),o.jsx(yE,{card:$[f],protocolName:E,protocolColor:R,protocolPattern:I,onChange:z,readOnly:S})]})]}),o.jsxs("div",{className:"wizard-actions",children:[o.jsxs("div",{className:"wizard-actions-left",children:[o.jsx("button",{onClick:t,className:"btn btn-back",children:S?"Back":"Cancel"}),c&&l&&!S&&o.jsx("button",{onClick:()=>x(!0),className:"btn btn-delete",children:"Delete Protocol"})]}),o.jsxs("div",{className:"wizard-actions-right",children:[c&&o.jsxs(o.Fragment,{children:[o.jsx("button",{onClick:q,className:"btn btn-export",children:"Export JSON"}),!S&&o.jsx("button",{onClick:O,className:"btn",children:"Save"})]}),!c&&o.jsxs(o.Fragment,{children:[i!=="cards"&&o.jsx("button",{onClick:ee,className:"btn",children:"Next"}),i==="cards"&&o.jsxs(o.Fragment,{children:[o.jsx("button",{onClick:q,className:"btn btn-export",children:"Export JSON"}),o.jsx("button",{onClick:O,className:"btn",children:"Save"})]})]})]})]}),u&&o.jsx("div",{className:"custom-protocol-modal-overlay",onClick:()=>h(!1),children:o.jsxs("div",{className:"custom-protocol-modal-content custom-protocol-modal-large",onClick:L=>L.stopPropagation(),children:[o.jsx("h3",{children:"Export Protocol JSON"}),o.jsx("p",{children:"Copy the JSON below to share or backup your protocol:"}),o.jsx("textarea",{value:y,readOnly:!0,rows:15,className:"export-textarea",onClick:L=>L.target.select()}),o.jsxs("div",{className:"custom-protocol-modal-actions",children:[o.jsx("button",{onClick:()=>h(!1),className:"btn btn-back",children:"Close"}),o.jsx("button",{onClick:F,className:"btn",children:"Copy to Clipboard"})]})]})}),_&&o.jsx("div",{className:"custom-protocol-modal-overlay",onClick:()=>x(!1),children:o.jsxs("div",{className:"custom-protocol-modal-content",onClick:L=>L.stopPropagation(),children:[o.jsx("h3",{children:"Delete Protocol"}),o.jsxs("p",{children:['Are you sure you want to delete "',E,'"?']}),o.jsx("p",{style:{color:"var(--danger-color)",fontSize:"0.9rem"},children:"This action cannot be undone."}),o.jsxs("div",{className:"custom-protocol-modal-actions",children:[o.jsx("button",{onClick:()=>x(!1),className:"btn btn-back",children:"Cancel"}),o.jsx("button",{onClick:k,className:"btn btn-delete",children:"Delete"})]})]})})]})},CE=({onBack:a})=>{const[t,l]=le.useState("list"),[c,i]=le.useState([]),[d,f]=le.useState(void 0);le.useEffect(()=>{p()},[]);const p=()=>{const S=pr();i(S)},u=()=>{f(void 0),l("create")},h=S=>{console.log("handleEdit called with protocol:",S),f(S),l("edit"),console.log("View set to edit, editingProtocol:",S)},y=S=>{p0(S),Ql(),p(),l("list"),f(void 0)},g=S=>{_t(S),Ql(),p(),l("list"),f(void 0)},_=S=>{_t(S),Ql(),p()},x=()=>{l("list"),f(void 0)};return o.jsxs("div",{className:"custom-protocol-creator",children:[t==="list"&&o.jsx(m0,{protocols:c,onCreateNew:u,onEdit:h,onDelete:y,onImport:_,onBack:a}),(t==="create"||t==="edit")&&o.jsx(xE,{onSave:g,onCancel:x,onDelete:y,initialProtocol:d})]})},SE={id:"spirit-1-example",protocol:"Spirit",value:1,top:"When you play cards face-up, they may be played without matching protocols.",middle:"Draw 2 cards.",bottom:'<span class="emphasis">Start:</span> Either discard 1 card or flip this card.',isFaceUp:!0,category:"Main 1",keywords:{}},bE={id:"face-down-example",protocol:"Spirit",value:1,top:"",middle:"",bottom:"",isFaceUp:!1,category:"Main 1",keywords:{}},EE=[{id:"opp-light-4",protocol:"Light",value:4,top:"",middle:"Your opponent reveals their hand.",bottom:"",isFaceUp:!0,category:"Main 1",keywords:{reveal:!0}}],jE=[{id:"opp-spirit-3",protocol:"Spirit",value:3,top:"<div><span class='emphasis'>After you draw cards:</span> You may shift this card, even if this card is covered.</div>",middle:"",bottom:"",isFaceUp:!0,category:"Main 1",keywords:{shift:!0}},{id:"opp-spirit-2",protocol:"Spirit",value:2,top:"",middle:"You may flip 1 card.",bottom:"",isFaceUp:!0,category:"Main 1",keywords:{flip:!0}}],kE=[{id:"opp-water-3",protocol:"Water",value:3,top:"",middle:"Return all cards with a value of 2 in 1 line.",bottom:"",isFaceUp:!0,category:"Main 1",keywords:{return:!0}}],RE=[{id:"player-darkness-5",protocol:"Darkness",value:5,top:"",middle:"You discard 1 card.",bottom:"",isFaceUp:!0,category:"Main 1",keywords:{discard:!0}},{id:"player-facedown-0",protocol:"Darkness",value:2,top:"",middle:"",bottom:"",isFaceUp:!1,category:"Main 1",keywords:{}}],NE=[{id:"player-plague-1",protocol:"Plague",value:1,top:"<div><span class='emphasis'>After your opponent discards cards:</span> Draw 1 card.</div>",middle:"Your opponent discards 1 card.",bottom:"",isFaceUp:!0,category:"Main 1",keywords:{draw:!0,discard:!0}},{id:"player-plague-5",protocol:"Plague",value:5,top:"",middle:"You discard 1 card.",bottom:"",isFaceUp:!0,category:"Main 1",keywords:{discard:!0}},{id:"player-plague-4",protocol:"Plague",value:4,top:"",middle:"",bottom:"<div><span class='emphasis'>End:</span> Your opponent deletes 1 of their face-down cards. You may flip this card.</div>",isFaceUp:!0,category:"Main 1",keywords:{delete:!0,flip:!0}}],TE=[{id:"player-death-0",protocol:"Death",value:0,top:"",middle:"Delete 1 card from each other line.",bottom:"",isFaceUp:!0,category:"Main 1",keywords:{delete:!0}},{id:"player-facedown-3",protocol:"Death",value:2,top:"",middle:"",bottom:"",isFaceUp:!1,category:"Main 1",keywords:{}}],Do={opponent:["Light","Spirit","Water"],player:["Darkness","Plague","Death"],opponentCompiled:[!0,!1,!1],playerCompiled:[!1,!1,!1],opponentValues:[4,5,3],playerValues:[7,10,2]};function AE({onBack:a}){const t=[EE,jE,kE],l=[RE,NE,TE];return o.jsxs("div",{className:"screen rules-screen",children:[o.jsx(bc,{title:"GAME RULES",onBack:a}),o.jsxs("div",{className:"rules-content",children:[o.jsxs("section",{className:"rules-section",children:[o.jsx("h2",{className:"section-title",children:"Objective"}),o.jsxs("div",{className:"rules-text",children:[o.jsxs("p",{children:["You play as an artificial intelligence trying to ",o.jsx("span",{className:"emphasis",children:"compile your 3 protocols"}),". Play command cards on protocols and execute their effects. If you reach a total value of",o.jsx("span",{className:"emphasis",children:" at least 10"})," with your cards on a protocol and exceed the opponent's total value in the same line, you may compile that protocol."]}),o.jsx("p",{className:"rules-highlight",children:"The first player to compile all 3 protocols wins!"})]})]}),o.jsxs("section",{className:"rules-section field-overview-section",children:[o.jsx("h2",{className:"section-title",children:"The Field"}),o.jsx("div",{className:"field-intro",children:o.jsxs("p",{children:["The field consists of ",o.jsx("span",{className:"emphasis",children:"3 lines"}),", each passing through two opposing protocols. Both players place cards on their side of each line. The goal is to build up value in your stacks to reach the compile threshold."]})}),o.jsxs("div",{className:"demo-board-container",children:[o.jsxs("div",{className:"demo-board",children:[o.jsx("div",{className:"demo-side-label opponent-label",children:"Opponent"}),o.jsx("div",{className:"demo-player-side demo-opponent-side",children:o.jsx("div",{className:"demo-lanes",children:t.map((c,i)=>o.jsx("div",{className:`demo-lane ${Do.opponentCompiled[i]?"demo-lane-compiled":""}`,children:o.jsx("div",{className:"demo-lane-stack",children:c.map((d,f)=>o.jsx(xt,{card:d,isFaceUp:d.isFaceUp,style:{"--i":f},faceDownValue:2},d.id))})},`opp-lane-${i}`))})}),o.jsxs("div",{className:"demo-protocol-bars-container",children:[o.jsx("div",{className:"demo-protocol-bar demo-opponent-bar",children:Do.opponent.map((c,i)=>o.jsxs("div",{className:`demo-protocol-display ${Do.opponentCompiled[i]?"compiled":""}`,children:[o.jsx("span",{className:"demo-protocol-name",children:c}),o.jsx("span",{className:"demo-protocol-value",children:Do.opponentValues[i]})]},`opp-proto-${i}`))}),o.jsx("div",{className:"demo-protocol-bar demo-player-bar",children:Do.player.map((c,i)=>o.jsxs("div",{className:`demo-protocol-display ${Do.playerCompiled[i]?"compiled":""}`,children:[o.jsx("span",{className:"demo-protocol-name",children:c}),o.jsx("span",{className:"demo-protocol-value",children:Do.playerValues[i]})]},`player-proto-${i}`))})]}),o.jsx("div",{className:"demo-player-side",children:o.jsx("div",{className:"demo-lanes",children:l.map((c,i)=>o.jsx("div",{className:`demo-lane ${Do.playerCompiled[i]?"demo-lane-compiled":""} ${i===1?"demo-lane-compilable":""}`,children:o.jsx("div",{className:"demo-lane-stack",children:c.map((d,f)=>o.jsx(xt,{card:d,isFaceUp:d.isFaceUp,style:{"--i":f},faceDownValue:2},d.id))})},`player-lane-${i}`))})}),o.jsx("div",{className:"demo-side-label player-label",children:"You"})]}),o.jsxs("div",{className:"demo-board-annotations",children:[o.jsxs("div",{className:"demo-annotation compiled-annotation",children:[o.jsx("div",{className:"demo-annotation-marker compiled-marker",children:"1"}),o.jsxs("div",{className:"demo-annotation-content",children:[o.jsx("strong",{children:"Compiled Protocol"}),o.jsx("p",{children:"Light has been compiled by the opponent! The protocol bar glows cyan."})]})]}),o.jsxs("div",{className:"demo-annotation compilable-annotation",children:[o.jsx("div",{className:"demo-annotation-marker compilable-marker",children:"2"}),o.jsxs("div",{className:"demo-annotation-content",children:[o.jsx("strong",{children:"Ready to Compile!"}),o.jsx("p",{children:"Plague has value 10 (1+5+4) which is 10 and higher than opponent's Spirit at 5. This protocol can be compiled!"})]})]}),o.jsxs("div",{className:"demo-annotation inprogress-annotation",children:[o.jsx("div",{className:"demo-annotation-marker inprogress-marker",children:"3"}),o.jsxs("div",{className:"demo-annotation-content",children:[o.jsx("strong",{children:"In Progress"}),o.jsx("p",{children:"Death/Water lanes are still building up. Keep playing cards to reach the compile threshold of 10!"})]})]}),o.jsxs("div",{className:"demo-annotation topbox-annotation",children:[o.jsx("div",{className:"demo-annotation-marker topbox-marker",children:"4"}),o.jsxs("div",{className:"demo-annotation-content",children:[o.jsx("strong",{children:"Top Effect Always Visible"}),o.jsx("p",{children:"See Plague-1's top effect? It stays active even when covered! Top effects are always visible and active on face-up cards."})]})]})]})]}),o.jsxs("div",{className:"field-legend",children:[o.jsxs("div",{className:"legend-item",children:[o.jsx("div",{className:"legend-swatch legend-compiled"}),o.jsx("span",{children:"Compiled Protocol"})]}),o.jsxs("div",{className:"legend-item",children:[o.jsx("div",{className:"legend-swatch legend-compilable"}),o.jsx("span",{children:"Ready to Compile (10 value & higher than opponent)"})]}),o.jsxs("div",{className:"legend-item",children:[o.jsx("div",{className:"legend-swatch legend-facedown"}),o.jsx("span",{children:"Face-down Card (base value: 2)"})]})]})]}),o.jsxs("section",{className:"rules-section card-anatomy-section",children:[o.jsx("h2",{className:"section-title",children:"Card Anatomy"}),o.jsxs("div",{className:"card-anatomy-layout",children:[o.jsx("div",{className:"card-anatomy-display",children:o.jsxs("div",{className:"anatomy-card-wrapper",children:[o.jsx(xt,{card:SE,isFaceUp:!0}),o.jsxs("div",{className:"anatomy-annotation annotation-protocol",children:[o.jsx("div",{className:"annotation-line annotation-line-left"}),o.jsxs("div",{className:"annotation-label",children:[o.jsx("span",{className:"annotation-letter",children:"A"}),o.jsx("span",{className:"annotation-text",children:"Protocol"})]})]}),o.jsxs("div",{className:"anatomy-annotation annotation-value",children:[o.jsx("div",{className:"annotation-line annotation-line-right"}),o.jsxs("div",{className:"annotation-label",children:[o.jsx("span",{className:"annotation-letter",children:"B"}),o.jsx("span",{className:"annotation-text",children:"Value"})]})]}),o.jsxs("div",{className:"anatomy-annotation annotation-top",children:[o.jsx("div",{className:"annotation-line annotation-line-right"}),o.jsxs("div",{className:"annotation-label",children:[o.jsx("span",{className:"annotation-letter",children:"C"}),o.jsx("span",{className:"annotation-text",children:"Top Effect"})]})]}),o.jsxs("div",{className:"anatomy-annotation annotation-middle",children:[o.jsx("div",{className:"annotation-line annotation-line-right"}),o.jsxs("div",{className:"annotation-label",children:[o.jsx("span",{className:"annotation-letter",children:"D"}),o.jsx("span",{className:"annotation-text",children:"Middle Effect"})]})]}),o.jsxs("div",{className:"anatomy-annotation annotation-bottom",children:[o.jsx("div",{className:"annotation-line annotation-line-right"}),o.jsxs("div",{className:"annotation-label",children:[o.jsx("span",{className:"annotation-letter",children:"E"}),o.jsx("span",{className:"annotation-text",children:"Bottom Effect"})]})]})]})}),o.jsxs("div",{className:"card-anatomy-descriptions",children:[o.jsxs("div",{className:"anatomy-item",children:[o.jsx("span",{className:"anatomy-letter",children:"A"}),o.jsxs("div",{className:"anatomy-desc",children:[o.jsx("strong",{children:"Protocol Indicator"}),o.jsx("p",{children:"Dictates which line a card can be played face-up in. Cards must match the protocol of that line."})]})]}),o.jsxs("div",{className:"anatomy-item",children:[o.jsx("span",{className:"anatomy-letter",children:"B"}),o.jsxs("div",{className:"anatomy-desc",children:[o.jsx("strong",{children:"Value"}),o.jsx("p",{children:"The value added to the total value of a stack. Higher values help you reach the compile threshold of 10."})]})]}),o.jsxs("div",{className:"anatomy-item anatomy-item-highlight",children:[o.jsx("span",{className:"anatomy-letter",children:"C"}),o.jsxs("div",{className:"anatomy-desc",children:[o.jsx("strong",{children:"Top Command - Persistent"}),o.jsxs("p",{children:["While this card is face-up, this passive text is ",o.jsx("span",{className:"emphasis",children:"always active"}),", even when covered by other cards."]})]})]}),o.jsxs("div",{className:"anatomy-item anatomy-item-highlight",children:[o.jsx("span",{className:"anatomy-letter",children:"D"}),o.jsxs("div",{className:"anatomy-desc",children:[o.jsx("strong",{children:"Middle Command - Immediate"}),o.jsx("p",{children:"Resolve this active text immediately when the card is played, flipped face-up, or uncovered."})]})]}),o.jsxs("div",{className:"anatomy-item anatomy-item-highlight",children:[o.jsx("span",{className:"anatomy-letter",children:"E"}),o.jsxs("div",{className:"anatomy-desc",children:[o.jsx("strong",{children:"Bottom Command - Auxiliary"}),o.jsxs("p",{children:['This passive text (often triggered effects like "Start:" or "End:") is only active when the card is ',o.jsx("span",{className:"emphasis",children:"uncovered"}),"."]})]})]})]})]})]}),o.jsxs("section",{className:"rules-section face-down-section",children:[o.jsx("h2",{className:"section-title",children:"Face-Down Cards"}),o.jsxs("div",{className:"face-down-layout",children:[o.jsx("div",{className:"face-down-card-wrapper",children:o.jsx(xt,{card:bE,isFaceUp:!1,faceDownValue:2})}),o.jsxs("div",{className:"face-down-description",children:[o.jsxs("p",{children:["Cards can be played ",o.jsx("span",{className:"emphasis",children:"face-down"})," into any line, regardless of protocol matching."]}),o.jsxs("ul",{children:[o.jsxs("li",{children:["Face-down cards have a ",o.jsx("span",{className:"emphasis",children:"base value of 2"})]}),o.jsx("li",{children:"No effects are active while face-down"}),o.jsx("li",{children:"Can be flipped face-up by card effects"}),o.jsx("li",{children:"When flipped, the middle effect triggers"}),o.jsx("li",{children:"Some cards modify face-down values (e.g., Darkness-2)"})]})]})]})]}),o.jsxs("section",{className:"rules-section",children:[o.jsx("h2",{className:"section-title",children:"Turn Order"}),o.jsxs("div",{className:"turn-order-grid",children:[o.jsxs("div",{className:"turn-phase",children:[o.jsx("span",{className:"phase-number",children:"1"}),o.jsxs("div",{className:"phase-content",children:[o.jsx("strong",{children:"Start Phase"}),o.jsx("p",{children:'Resolve all visible "Start" effects of your face-up command cards.'})]})]}),o.jsxs("div",{className:"turn-phase",children:[o.jsx("span",{className:"phase-number",children:"2"}),o.jsxs("div",{className:"phase-content",children:[o.jsx("strong",{children:"Check Control"}),o.jsx("p",{children:"If your total value is higher than opponent's in at least 2 lines, take the control component."})]})]}),o.jsxs("div",{className:"turn-phase",children:[o.jsx("span",{className:"phase-number",children:"3"}),o.jsxs("div",{className:"phase-content",children:[o.jsx("strong",{children:"Check Compile"}),o.jsx("p",{children:"If you can compile (10+ value and higher than opponent), you must compile one protocol."})]})]}),o.jsxs("div",{className:"turn-phase",children:[o.jsx("span",{className:"phase-number",children:"4"}),o.jsxs("div",{className:"phase-content",children:[o.jsx("strong",{children:"Action"}),o.jsx("p",{children:"Play 1 card from hand OR refresh your hand (draw until you have 5 cards)."})]})]}),o.jsxs("div",{className:"turn-phase",children:[o.jsx("span",{className:"phase-number",children:"5"}),o.jsxs("div",{className:"phase-content",children:[o.jsx("strong",{children:"Check Cache"}),o.jsx("p",{children:"If you have more than 5 cards, discard down to 5."})]})]}),o.jsxs("div",{className:"turn-phase",children:[o.jsx("span",{className:"phase-number",children:"6"}),o.jsxs("div",{className:"phase-content",children:[o.jsx("strong",{children:"End Phase"}),o.jsx("p",{children:'Resolve all visible "End" effects of your face-up command cards.'})]})]})]})]}),o.jsxs("section",{className:"rules-section glossary-section",children:[o.jsx("h2",{className:"section-title",children:"Glossary"}),o.jsxs("div",{className:"glossary-grid",children:[o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Compile"}),o.jsx("p",{children:'Delete all cards in a line on both sides and flip your protocol to "Compiled".'})]}),o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Covered"}),o.jsx("p",{children:"A card with another card on top of it. Only top effects remain active."})]}),o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Uncovered"}),o.jsx("p",{children:"The topmost card in a stack, furthest from the protocol."})]}),o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Delete"}),o.jsx("p",{children:"Move a card from the field to the trash."})]}),o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Discard"}),o.jsx("p",{children:"Move a card from hand to the owner's trash."})]}),o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Flip"}),o.jsx("p",{children:"Change a card from face-down to face-up, or vice versa."})]}),o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Shift"}),o.jsx("p",{children:"Move a card to another line on the same side of the field."})]}),o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Return"}),o.jsx("p",{children:"Move a card from the field to its owner's hand."})]}),o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Reveal"}),o.jsx("p",{children:"Show hidden information publicly, then return it to its previous state."})]}),o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Refresh"}),o.jsx("p",{children:"Draw cards until you have 5 cards in hand."})]}),o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Line"}),o.jsx("p",{children:"The area passing through two opposing protocols. The field has 3 lines."})]}),o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Stack"}),o.jsx("p",{children:"The cards in a line on one player's side."})]})]})]})]})]})}function DE(){const[a,t]=le.useState("MainMenu"),[l,c]=le.useState([]),[i,d]=le.useState([]),[f,p]=le.useState(null),[u,h]=le.useState("easy"),[y,g]=le.useState(null),[_,x]=le.useState(!0),[S,E]=le.useState("player");le.useEffect(()=>{Tb()},[]);const b=le.useCallback(()=>{t("MainMenu"),c([]),d([]),p(null),g(null)},[]);le.useEffect(()=>{const A=I=>{I.key==="Escape"&&b()};return window.addEventListener("keydown",A),()=>{window.removeEventListener("keydown",A)}},[b]);const j=le.useCallback((A,I)=>{c(A),d(I),p(null),g(null),E("player"),t("GameScreen")},[]),C=le.useCallback((A,I)=>{p(A),g(I),t("ResultsScreen")},[]),R=()=>{switch(a){case"MainMenu":return o.jsx(Wh,{onNavigate:A=>t(A),difficulty:u,setDifficulty:h,useControl:_,onUseControlChange:x});case"ProtocolSelection":return o.jsx(v0,{onBack:b,onStartGame:j});case"GameScreen":return o.jsx(eE,{onBack:b,onEndGame:C,playerProtocols:l,opponentProtocols:i,difficulty:u,useControlMechanic:_,startingPlayer:S});case"ResultsScreen":return o.jsx(tE,{onPlayAgain:b,winner:f,finalState:y,difficulty:u});case"CardLibrary":return o.jsx(nE,{onBack:b});case"Statistics":return o.jsx(aE,{onBack:b});case"CustomProtocols":return o.jsx(CE,{onBack:b});case"Rules":return o.jsx(AE,{onBack:b});default:return o.jsx(Wh,{onNavigate:A=>t(A),difficulty:u,setDifficulty:h,useControl:_,onUseControlChange:x})}};return o.jsx(o.Fragment,{children:R()})}const FE=document.getElementById("root"),qE=l0.createRoot(FE);qE.render(o.jsx(DE,{}));
