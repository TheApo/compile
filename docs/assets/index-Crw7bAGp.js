(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))i(c);new MutationObserver(c=>{for(const d of c)if(d.type==="childList")for(const f of d.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&i(f)}).observe(document,{childList:!0,subtree:!0});function l(c){const d={};return c.integrity&&(d.integrity=c.integrity),c.referrerPolicy&&(d.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?d.credentials="include":c.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function i(c){if(c.ep)return;c.ep=!0;const d=l(c);fetch(c.href,d)}})();var bd={exports:{}},Ml={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $h;function H_(){if($h)return Ml;$h=1;var a=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function l(i,c,d){var f=null;if(d!==void 0&&(f=""+d),c.key!==void 0&&(f=""+c.key),"key"in c){d={};for(var u in c)u!=="key"&&(d[u]=c[u])}else d=c;return c=d.ref,{$$typeof:a,type:i,key:f,ref:c!==void 0?c:null,props:d}}return Ml.Fragment=t,Ml.jsx=l,Ml.jsxs=l,Ml}var Lh;function z_(){return Lh||(Lh=1,bd.exports=H_()),bd.exports}var o=z_(),Ed={exports:{}},Hl={},jd={exports:{}},kd={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ih;function V_(){return Ih||(Ih=1,(function(a){function t(q,M){var B=q.length;q.push(M);e:for(;0<B;){var W=B-1>>>1,K=q[W];if(0<c(K,M))q[W]=M,q[B]=K,B=W;else break e}}function l(q){return q.length===0?null:q[0]}function i(q){if(q.length===0)return null;var M=q[0],B=q.pop();if(B!==M){q[0]=B;e:for(var W=0,K=q.length,D=K>>>1;W<D;){var Q=2*(W+1)-1,ae=q[Q],Y=Q+1,Z=q[Y];if(0>c(ae,B))Y<K&&0>c(Z,ae)?(q[W]=Z,q[Y]=B,W=Y):(q[W]=ae,q[Q]=B,W=Q);else if(Y<K&&0>c(Z,B))q[W]=Z,q[Y]=B,W=Y;else break e}}return M}function c(q,M){var B=q.sortIndex-M.sortIndex;return B!==0?B:q.id-M.id}if(a.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var d=performance;a.unstable_now=function(){return d.now()}}else{var f=Date,u=f.now();a.unstable_now=function(){return f.now()-u}}var p=[],m=[],y=1,v=null,x=3,w=!1,S=!1,E=!1,b=!1,j=typeof setTimeout=="function"?setTimeout:null,C=typeof clearTimeout=="function"?clearTimeout:null,R=typeof setImmediate<"u"?setImmediate:null;function F(q){for(var M=l(m);M!==null;){if(M.callback===null)i(m);else if(M.startTime<=q)i(m),M.sortIndex=M.expirationTime,t(p,M);else break;M=l(m)}}function L(q){if(E=!1,F(q),!S)if(l(p)!==null)S=!0,O||(O=!0,k());else{var M=l(m);M!==null&&$(L,M.startTime-q)}}var O=!1,T=-1,G=5,V=-1;function z(){return b?!0:!(a.unstable_now()-V<G)}function U(){if(b=!1,O){var q=a.unstable_now();V=q;var M=!0;try{e:{S=!1,E&&(E=!1,C(T),T=-1),w=!0;var B=x;try{t:{for(F(q),v=l(p);v!==null&&!(v.expirationTime>q&&z());){var W=v.callback;if(typeof W=="function"){v.callback=null,x=v.priorityLevel;var K=W(v.expirationTime<=q);if(q=a.unstable_now(),typeof K=="function"){v.callback=K,F(q),M=!0;break t}v===l(p)&&i(p),F(q)}else i(p);v=l(p)}if(v!==null)M=!0;else{var D=l(m);D!==null&&$(L,D.startTime-q),M=!1}}break e}finally{v=null,x=B,w=!1}M=void 0}}finally{M?k():O=!1}}}var k;if(typeof R=="function")k=function(){R(U)};else if(typeof MessageChannel<"u"){var A=new MessageChannel,I=A.port2;A.port1.onmessage=U,k=function(){I.postMessage(null)}}else k=function(){j(U,0)};function $(q,M){T=j(function(){q(a.unstable_now())},M)}a.unstable_IdlePriority=5,a.unstable_ImmediatePriority=1,a.unstable_LowPriority=4,a.unstable_NormalPriority=3,a.unstable_Profiling=null,a.unstable_UserBlockingPriority=2,a.unstable_cancelCallback=function(q){q.callback=null},a.unstable_forceFrameRate=function(q){0>q||125<q?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):G=0<q?Math.floor(1e3/q):5},a.unstable_getCurrentPriorityLevel=function(){return x},a.unstable_next=function(q){switch(x){case 1:case 2:case 3:var M=3;break;default:M=x}var B=x;x=M;try{return q()}finally{x=B}},a.unstable_requestPaint=function(){b=!0},a.unstable_runWithPriority=function(q,M){switch(q){case 1:case 2:case 3:case 4:case 5:break;default:q=3}var B=x;x=q;try{return M()}finally{x=B}},a.unstable_scheduleCallback=function(q,M,B){var W=a.unstable_now();switch(typeof B=="object"&&B!==null?(B=B.delay,B=typeof B=="number"&&0<B?W+B:W):B=W,q){case 1:var K=-1;break;case 2:K=250;break;case 5:K=1073741823;break;case 4:K=1e4;break;default:K=5e3}return K=B+K,q={id:y++,callback:M,priorityLevel:q,startTime:B,expirationTime:K,sortIndex:-1},B>W?(q.sortIndex=B,t(m,q),l(p)===null&&q===l(m)&&(E?(C(T),T=-1):E=!0,$(L,B-W))):(q.sortIndex=K,t(p,q),S||w||(S=!0,O||(O=!0,k()))),q},a.unstable_shouldYield=z,a.unstable_wrapCallback=function(q){var M=x;return function(){var B=x;x=M;try{return q.apply(this,arguments)}finally{x=B}}}})(kd)),kd}var Uh;function B_(){return Uh||(Uh=1,jd.exports=V_()),jd.exports}var Nd={exports:{}},Ye={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ph;function Y_(){if(Ph)return Ye;Ph=1;var a=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),l=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),c=Symbol.for("react.profiler"),d=Symbol.for("react.consumer"),f=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),p=Symbol.for("react.suspense"),m=Symbol.for("react.memo"),y=Symbol.for("react.lazy"),v=Symbol.for("react.activity"),x=Symbol.iterator;function w(D){return D===null||typeof D!="object"?null:(D=x&&D[x]||D["@@iterator"],typeof D=="function"?D:null)}var S={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},E=Object.assign,b={};function j(D,Q,ae){this.props=D,this.context=Q,this.refs=b,this.updater=ae||S}j.prototype.isReactComponent={},j.prototype.setState=function(D,Q){if(typeof D!="object"&&typeof D!="function"&&D!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,D,Q,"setState")},j.prototype.forceUpdate=function(D){this.updater.enqueueForceUpdate(this,D,"forceUpdate")};function C(){}C.prototype=j.prototype;function R(D,Q,ae){this.props=D,this.context=Q,this.refs=b,this.updater=ae||S}var F=R.prototype=new C;F.constructor=R,E(F,j.prototype),F.isPureReactComponent=!0;var L=Array.isArray;function O(){}var T={H:null,A:null,T:null,S:null},G=Object.prototype.hasOwnProperty;function V(D,Q,ae){var Y=ae.ref;return{$$typeof:a,type:D,key:Q,ref:Y!==void 0?Y:null,props:ae}}function z(D,Q){return V(D.type,Q,D.props)}function U(D){return typeof D=="object"&&D!==null&&D.$$typeof===a}function k(D){var Q={"=":"=0",":":"=2"};return"$"+D.replace(/[=:]/g,function(ae){return Q[ae]})}var A=/\/+/g;function I(D,Q){return typeof D=="object"&&D!==null&&D.key!=null?k(""+D.key):Q.toString(36)}function $(D){switch(D.status){case"fulfilled":return D.value;case"rejected":throw D.reason;default:switch(typeof D.status=="string"?D.then(O,O):(D.status="pending",D.then(function(Q){D.status==="pending"&&(D.status="fulfilled",D.value=Q)},function(Q){D.status==="pending"&&(D.status="rejected",D.reason=Q)})),D.status){case"fulfilled":return D.value;case"rejected":throw D.reason}}throw D}function q(D,Q,ae,Y,Z){var ue=typeof D;(ue==="undefined"||ue==="boolean")&&(D=null);var re=!1;if(D===null)re=!0;else switch(ue){case"bigint":case"string":case"number":re=!0;break;case"object":switch(D.$$typeof){case a:case t:re=!0;break;case y:return re=D._init,q(re(D._payload),Q,ae,Y,Z)}}if(re)return Z=Z(D),re=Y===""?"."+I(D,0):Y,L(Z)?(ae="",re!=null&&(ae=re.replace(A,"$&/")+"/"),q(Z,Q,ae,"",function(le){return le})):Z!=null&&(U(Z)&&(Z=z(Z,ae+(Z.key==null||D&&D.key===Z.key?"":(""+Z.key).replace(A,"$&/")+"/")+re)),Q.push(Z)),1;re=0;var ee=Y===""?".":Y+":";if(L(D))for(var X=0;X<D.length;X++)Y=D[X],ue=ee+I(Y,X),re+=q(Y,Q,ae,ue,Z);else if(X=w(D),typeof X=="function")for(D=X.call(D),X=0;!(Y=D.next()).done;)Y=Y.value,ue=ee+I(Y,X++),re+=q(Y,Q,ae,ue,Z);else if(ue==="object"){if(typeof D.then=="function")return q($(D),Q,ae,Y,Z);throw Q=String(D),Error("Objects are not valid as a React child (found: "+(Q==="[object Object]"?"object with keys {"+Object.keys(D).join(", ")+"}":Q)+"). If you meant to render a collection of children, use an array instead.")}return re}function M(D,Q,ae){if(D==null)return D;var Y=[],Z=0;return q(D,Y,"","",function(ue){return Q.call(ae,ue,Z++)}),Y}function B(D){if(D._status===-1){var Q=D._result;Q=Q(),Q.then(function(ae){(D._status===0||D._status===-1)&&(D._status=1,D._result=ae)},function(ae){(D._status===0||D._status===-1)&&(D._status=2,D._result=ae)}),D._status===-1&&(D._status=0,D._result=Q)}if(D._status===1)return D._result.default;throw D._result}var W=typeof reportError=="function"?reportError:function(D){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Q=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof D=="object"&&D!==null&&typeof D.message=="string"?String(D.message):String(D),error:D});if(!window.dispatchEvent(Q))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",D);return}console.error(D)},K={map:M,forEach:function(D,Q,ae){M(D,function(){Q.apply(this,arguments)},ae)},count:function(D){var Q=0;return M(D,function(){Q++}),Q},toArray:function(D){return M(D,function(Q){return Q})||[]},only:function(D){if(!U(D))throw Error("React.Children.only expected to receive a single React element child.");return D}};return Ye.Activity=v,Ye.Children=K,Ye.Component=j,Ye.Fragment=l,Ye.Profiler=c,Ye.PureComponent=R,Ye.StrictMode=i,Ye.Suspense=p,Ye.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=T,Ye.__COMPILER_RUNTIME={__proto__:null,c:function(D){return T.H.useMemoCache(D)}},Ye.cache=function(D){return function(){return D.apply(null,arguments)}},Ye.cacheSignal=function(){return null},Ye.cloneElement=function(D,Q,ae){if(D==null)throw Error("The argument must be a React element, but you passed "+D+".");var Y=E({},D.props),Z=D.key;if(Q!=null)for(ue in Q.key!==void 0&&(Z=""+Q.key),Q)!G.call(Q,ue)||ue==="key"||ue==="__self"||ue==="__source"||ue==="ref"&&Q.ref===void 0||(Y[ue]=Q[ue]);var ue=arguments.length-2;if(ue===1)Y.children=ae;else if(1<ue){for(var re=Array(ue),ee=0;ee<ue;ee++)re[ee]=arguments[ee+2];Y.children=re}return V(D.type,Z,Y)},Ye.createContext=function(D){return D={$$typeof:f,_currentValue:D,_currentValue2:D,_threadCount:0,Provider:null,Consumer:null},D.Provider=D,D.Consumer={$$typeof:d,_context:D},D},Ye.createElement=function(D,Q,ae){var Y,Z={},ue=null;if(Q!=null)for(Y in Q.key!==void 0&&(ue=""+Q.key),Q)G.call(Q,Y)&&Y!=="key"&&Y!=="__self"&&Y!=="__source"&&(Z[Y]=Q[Y]);var re=arguments.length-2;if(re===1)Z.children=ae;else if(1<re){for(var ee=Array(re),X=0;X<re;X++)ee[X]=arguments[X+2];Z.children=ee}if(D&&D.defaultProps)for(Y in re=D.defaultProps,re)Z[Y]===void 0&&(Z[Y]=re[Y]);return V(D,ue,Z)},Ye.createRef=function(){return{current:null}},Ye.forwardRef=function(D){return{$$typeof:u,render:D}},Ye.isValidElement=U,Ye.lazy=function(D){return{$$typeof:y,_payload:{_status:-1,_result:D},_init:B}},Ye.memo=function(D,Q){return{$$typeof:m,type:D,compare:Q===void 0?null:Q}},Ye.startTransition=function(D){var Q=T.T,ae={};T.T=ae;try{var Y=D(),Z=T.S;Z!==null&&Z(ae,Y),typeof Y=="object"&&Y!==null&&typeof Y.then=="function"&&Y.then(O,W)}catch(ue){W(ue)}finally{Q!==null&&ae.types!==null&&(Q.types=ae.types),T.T=Q}},Ye.unstable_useCacheRefresh=function(){return T.H.useCacheRefresh()},Ye.use=function(D){return T.H.use(D)},Ye.useActionState=function(D,Q,ae){return T.H.useActionState(D,Q,ae)},Ye.useCallback=function(D,Q){return T.H.useCallback(D,Q)},Ye.useContext=function(D){return T.H.useContext(D)},Ye.useDebugValue=function(){},Ye.useDeferredValue=function(D,Q){return T.H.useDeferredValue(D,Q)},Ye.useEffect=function(D,Q){return T.H.useEffect(D,Q)},Ye.useEffectEvent=function(D){return T.H.useEffectEvent(D)},Ye.useId=function(){return T.H.useId()},Ye.useImperativeHandle=function(D,Q,ae){return T.H.useImperativeHandle(D,Q,ae)},Ye.useInsertionEffect=function(D,Q){return T.H.useInsertionEffect(D,Q)},Ye.useLayoutEffect=function(D,Q){return T.H.useLayoutEffect(D,Q)},Ye.useMemo=function(D,Q){return T.H.useMemo(D,Q)},Ye.useOptimistic=function(D,Q){return T.H.useOptimistic(D,Q)},Ye.useReducer=function(D,Q,ae){return T.H.useReducer(D,Q,ae)},Ye.useRef=function(D){return T.H.useRef(D)},Ye.useState=function(D){return T.H.useState(D)},Ye.useSyncExternalStore=function(D,Q,ae){return T.H.useSyncExternalStore(D,Q,ae)},Ye.useTransition=function(){return T.H.useTransition()},Ye.version="19.2.3",Ye}var Oh;function Bd(){return Oh||(Oh=1,Nd.exports=Y_()),Nd.exports}var Rd={exports:{}},pn={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Mh;function G_(){if(Mh)return pn;Mh=1;var a=Bd();function t(p){var m="https://react.dev/errors/"+p;if(1<arguments.length){m+="?args[]="+encodeURIComponent(arguments[1]);for(var y=2;y<arguments.length;y++)m+="&args[]="+encodeURIComponent(arguments[y])}return"Minified React error #"+p+"; visit "+m+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function l(){}var i={d:{f:l,r:function(){throw Error(t(522))},D:l,C:l,L:l,m:l,X:l,S:l,M:l},p:0,findDOMNode:null},c=Symbol.for("react.portal");function d(p,m,y){var v=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:c,key:v==null?null:""+v,children:p,containerInfo:m,implementation:y}}var f=a.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function u(p,m){if(p==="font")return"";if(typeof m=="string")return m==="use-credentials"?m:""}return pn.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=i,pn.createPortal=function(p,m){var y=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!m||m.nodeType!==1&&m.nodeType!==9&&m.nodeType!==11)throw Error(t(299));return d(p,m,null,y)},pn.flushSync=function(p){var m=f.T,y=i.p;try{if(f.T=null,i.p=2,p)return p()}finally{f.T=m,i.p=y,i.d.f()}},pn.preconnect=function(p,m){typeof p=="string"&&(m?(m=m.crossOrigin,m=typeof m=="string"?m==="use-credentials"?m:"":void 0):m=null,i.d.C(p,m))},pn.prefetchDNS=function(p){typeof p=="string"&&i.d.D(p)},pn.preinit=function(p,m){if(typeof p=="string"&&m&&typeof m.as=="string"){var y=m.as,v=u(y,m.crossOrigin),x=typeof m.integrity=="string"?m.integrity:void 0,w=typeof m.fetchPriority=="string"?m.fetchPriority:void 0;y==="style"?i.d.S(p,typeof m.precedence=="string"?m.precedence:void 0,{crossOrigin:v,integrity:x,fetchPriority:w}):y==="script"&&i.d.X(p,{crossOrigin:v,integrity:x,fetchPriority:w,nonce:typeof m.nonce=="string"?m.nonce:void 0})}},pn.preinitModule=function(p,m){if(typeof p=="string")if(typeof m=="object"&&m!==null){if(m.as==null||m.as==="script"){var y=u(m.as,m.crossOrigin);i.d.M(p,{crossOrigin:y,integrity:typeof m.integrity=="string"?m.integrity:void 0,nonce:typeof m.nonce=="string"?m.nonce:void 0})}}else m==null&&i.d.M(p)},pn.preload=function(p,m){if(typeof p=="string"&&typeof m=="object"&&m!==null&&typeof m.as=="string"){var y=m.as,v=u(y,m.crossOrigin);i.d.L(p,y,{crossOrigin:v,integrity:typeof m.integrity=="string"?m.integrity:void 0,nonce:typeof m.nonce=="string"?m.nonce:void 0,type:typeof m.type=="string"?m.type:void 0,fetchPriority:typeof m.fetchPriority=="string"?m.fetchPriority:void 0,referrerPolicy:typeof m.referrerPolicy=="string"?m.referrerPolicy:void 0,imageSrcSet:typeof m.imageSrcSet=="string"?m.imageSrcSet:void 0,imageSizes:typeof m.imageSizes=="string"?m.imageSizes:void 0,media:typeof m.media=="string"?m.media:void 0})}},pn.preloadModule=function(p,m){if(typeof p=="string")if(m){var y=u(m.as,m.crossOrigin);i.d.m(p,{as:typeof m.as=="string"&&m.as!=="script"?m.as:void 0,crossOrigin:y,integrity:typeof m.integrity=="string"?m.integrity:void 0})}else i.d.m(p)},pn.requestFormReset=function(p){i.d.r(p)},pn.unstable_batchedUpdates=function(p,m){return p(m)},pn.useFormState=function(p,m,y){return f.H.useFormState(p,m,y)},pn.useFormStatus=function(){return f.H.useHostTransitionStatus()},pn.version="19.2.3",pn}var Hh;function W_(){if(Hh)return Rd.exports;Hh=1;function a(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(a)}catch(t){console.error(t)}}return a(),Rd.exports=G_(),Rd.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var zh;function Q_(){if(zh)return Hl;zh=1;var a=B_(),t=Bd(),l=W_();function i(e){var n="https://react.dev/errors/"+e;if(1<arguments.length){n+="?args[]="+encodeURIComponent(arguments[1]);for(var r=2;r<arguments.length;r++)n+="&args[]="+encodeURIComponent(arguments[r])}return"Minified React error #"+e+"; visit "+n+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function c(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function d(e){var n=e,r=e;if(e.alternate)for(;n.return;)n=n.return;else{e=n;do n=e,(n.flags&4098)!==0&&(r=n.return),e=n.return;while(e)}return n.tag===3?r:null}function f(e){if(e.tag===13){var n=e.memoizedState;if(n===null&&(e=e.alternate,e!==null&&(n=e.memoizedState)),n!==null)return n.dehydrated}return null}function u(e){if(e.tag===31){var n=e.memoizedState;if(n===null&&(e=e.alternate,e!==null&&(n=e.memoizedState)),n!==null)return n.dehydrated}return null}function p(e){if(d(e)!==e)throw Error(i(188))}function m(e){var n=e.alternate;if(!n){if(n=d(e),n===null)throw Error(i(188));return n!==e?null:e}for(var r=e,s=n;;){var h=r.return;if(h===null)break;var g=h.alternate;if(g===null){if(s=h.return,s!==null){r=s;continue}break}if(h.child===g.child){for(g=h.child;g;){if(g===r)return p(h),e;if(g===s)return p(h),n;g=g.sibling}throw Error(i(188))}if(r.return!==s.return)r=h,s=g;else{for(var N=!1,H=h.child;H;){if(H===r){N=!0,r=h,s=g;break}if(H===s){N=!0,s=h,r=g;break}H=H.sibling}if(!N){for(H=g.child;H;){if(H===r){N=!0,r=g,s=h;break}if(H===s){N=!0,s=g,r=h;break}H=H.sibling}if(!N)throw Error(i(189))}}if(r.alternate!==s)throw Error(i(190))}if(r.tag!==3)throw Error(i(188));return r.stateNode.current===r?e:n}function y(e){var n=e.tag;if(n===5||n===26||n===27||n===6)return e;for(e=e.child;e!==null;){if(n=y(e),n!==null)return n;e=e.sibling}return null}var v=Object.assign,x=Symbol.for("react.element"),w=Symbol.for("react.transitional.element"),S=Symbol.for("react.portal"),E=Symbol.for("react.fragment"),b=Symbol.for("react.strict_mode"),j=Symbol.for("react.profiler"),C=Symbol.for("react.consumer"),R=Symbol.for("react.context"),F=Symbol.for("react.forward_ref"),L=Symbol.for("react.suspense"),O=Symbol.for("react.suspense_list"),T=Symbol.for("react.memo"),G=Symbol.for("react.lazy"),V=Symbol.for("react.activity"),z=Symbol.for("react.memo_cache_sentinel"),U=Symbol.iterator;function k(e){return e===null||typeof e!="object"?null:(e=U&&e[U]||e["@@iterator"],typeof e=="function"?e:null)}var A=Symbol.for("react.client.reference");function I(e){if(e==null)return null;if(typeof e=="function")return e.$$typeof===A?null:e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case E:return"Fragment";case j:return"Profiler";case b:return"StrictMode";case L:return"Suspense";case O:return"SuspenseList";case V:return"Activity"}if(typeof e=="object")switch(e.$$typeof){case S:return"Portal";case R:return e.displayName||"Context";case C:return(e._context.displayName||"Context")+".Consumer";case F:var n=e.render;return e=e.displayName,e||(e=n.displayName||n.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case T:return n=e.displayName||null,n!==null?n:I(e.type)||"Memo";case G:n=e._payload,e=e._init;try{return I(e(n))}catch{}}return null}var $=Array.isArray,q=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,M=l.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,B={pending:!1,data:null,method:null,action:null},W=[],K=-1;function D(e){return{current:e}}function Q(e){0>K||(e.current=W[K],W[K]=null,K--)}function ae(e,n){K++,W[K]=e.current,e.current=n}var Y=D(null),Z=D(null),ue=D(null),re=D(null);function ee(e,n){switch(ae(ue,n),ae(Z,e),ae(Y,null),n.nodeType){case 9:case 11:e=(e=n.documentElement)&&(e=e.namespaceURI)?oh(e):0;break;default:if(e=n.tagName,n=n.namespaceURI)n=oh(n),e=rh(n,e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}Q(Y),ae(Y,e)}function X(){Q(Y),Q(Z),Q(ue)}function le(e){e.memoizedState!==null&&ae(re,e);var n=Y.current,r=rh(n,e.type);n!==r&&(ae(Z,e),ae(Y,r))}function J(e){Z.current===e&&(Q(Y),Q(Z)),re.current===e&&(Q(re),Il._currentValue=B)}var me,ve;function Se(e){if(me===void 0)try{throw Error()}catch(r){var n=r.stack.trim().match(/\n( *(at )?)/);me=n&&n[1]||"",ve=-1<r.stack.indexOf(`
    at`)?" (<anonymous>)":-1<r.stack.indexOf("@")?"@unknown:0:0":""}return`
`+me+e+ve}var Le=!1;function Ee(e,n){if(!e||Le)return"";Le=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var s={DetermineComponentFrameRoot:function(){try{if(n){var _e=function(){throw Error()};if(Object.defineProperty(_e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(_e,[])}catch(he){var pe=he}Reflect.construct(e,[],_e)}else{try{_e.call()}catch(he){pe=he}e.call(_e.prototype)}}else{try{throw Error()}catch(he){pe=he}(_e=e())&&typeof _e.catch=="function"&&_e.catch(function(){})}}catch(he){if(he&&pe&&typeof he.stack=="string")return[he.stack,pe.stack]}return[null,null]}};s.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var h=Object.getOwnPropertyDescriptor(s.DetermineComponentFrameRoot,"name");h&&h.configurable&&Object.defineProperty(s.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var g=s.DetermineComponentFrameRoot(),N=g[0],H=g[1];if(N&&H){var te=N.split(`
`),de=H.split(`
`);for(h=s=0;s<te.length&&!te[s].includes("DetermineComponentFrameRoot");)s++;for(;h<de.length&&!de[h].includes("DetermineComponentFrameRoot");)h++;if(s===te.length||h===de.length)for(s=te.length-1,h=de.length-1;1<=s&&0<=h&&te[s]!==de[h];)h--;for(;1<=s&&0<=h;s--,h--)if(te[s]!==de[h]){if(s!==1||h!==1)do if(s--,h--,0>h||te[s]!==de[h]){var ye=`
`+te[s].replace(" at new "," at ");return e.displayName&&ye.includes("<anonymous>")&&(ye=ye.replace("<anonymous>",e.displayName)),ye}while(1<=s&&0<=h);break}}}finally{Le=!1,Error.prepareStackTrace=r}return(r=e?e.displayName||e.name:"")?Se(r):""}function lt(e,n){switch(e.tag){case 26:case 27:case 5:return Se(e.type);case 16:return Se("Lazy");case 13:return e.child!==n&&n!==null?Se("Suspense Fallback"):Se("Suspense");case 19:return Se("SuspenseList");case 0:case 15:return Ee(e.type,!1);case 11:return Ee(e.type.render,!1);case 1:return Ee(e.type,!0);case 31:return Se("Activity");default:return""}}function et(e){try{var n="",r=null;do n+=lt(e,r),r=e,e=e.return;while(e);return n}catch(s){return`
Error generating stack: `+s.message+`
`+s.stack}}var Je=Object.prototype.hasOwnProperty,nt=a.unstable_scheduleCallback,je=a.unstable_cancelCallback,Fe=a.unstable_shouldYield,Ve=a.unstable_requestPaint,Oe=a.unstable_now,Rt=a.unstable_getCurrentPriorityLevel,tt=a.unstable_ImmediatePriority,It=a.unstable_UserBlockingPriority,Zt=a.unstable_NormalPriority,En=a.unstable_LowPriority,On=a.unstable_IdlePriority,fa=a.log,Ea=a.unstable_setDisableYieldValue,yn=null,Ft=null;function Kt(e){if(typeof fa=="function"&&Ea(e),Ft&&typeof Ft.setStrictMode=="function")try{Ft.setStrictMode(yn,e)}catch{}}var Ut=Math.clz32?Math.clz32:aa,ha=Math.log,ja=Math.LN2;function aa(e){return e>>>=0,e===0?32:31-(ha(e)/ja|0)|0}var Jt=256,dn=262144,Mn=4194304;function fn(e){var n=e&42;if(n!==0)return n;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return e&261888;case 262144:case 524288:case 1048576:case 2097152:return e&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return e&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function Hn(e,n,r){var s=e.pendingLanes;if(s===0)return 0;var h=0,g=e.suspendedLanes,N=e.pingedLanes;e=e.warmLanes;var H=s&134217727;return H!==0?(s=H&~g,s!==0?h=fn(s):(N&=H,N!==0?h=fn(N):r||(r=H&~e,r!==0&&(h=fn(r))))):(H=s&~g,H!==0?h=fn(H):N!==0?h=fn(N):r||(r=s&~e,r!==0&&(h=fn(r)))),h===0?0:n!==0&&n!==h&&(n&g)===0&&(g=h&-h,r=n&-n,g>=r||g===32&&(r&4194048)!==0)?n:h}function jn(e,n){return(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&n)===0}function ka(e,n){switch(e){case 1:case 2:case 4:case 8:case 64:return n+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function oa(){var e=Mn;return Mn<<=1,(Mn&62914560)===0&&(Mn=4194304),e}function kn(e){for(var n=[],r=0;31>r;r++)n.push(e);return n}function Nn(e,n){e.pendingLanes|=n,n!==268435456&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function Na(e,n,r,s,h,g){var N=e.pendingLanes;e.pendingLanes=r,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=r,e.entangledLanes&=r,e.errorRecoveryDisabledLanes&=r,e.shellSuspendCounter=0;var H=e.entanglements,te=e.expirationTimes,de=e.hiddenUpdates;for(r=N&~r;0<r;){var ye=31-Ut(r),_e=1<<ye;H[ye]=0,te[ye]=-1;var pe=de[ye];if(pe!==null)for(de[ye]=null,ye=0;ye<pe.length;ye++){var he=pe[ye];he!==null&&(he.lane&=-536870913)}r&=~_e}s!==0&&ma(e,s,0),g!==0&&h===0&&e.tag!==0&&(e.suspendedLanes|=g&~(N&~n))}function ma(e,n,r){e.pendingLanes|=n,e.suspendedLanes&=~n;var s=31-Ut(n);e.entangledLanes|=n,e.entanglements[s]=e.entanglements[s]|1073741824|r&261930}function ya(e,n){var r=e.entangledLanes|=n;for(e=e.entanglements;r;){var s=31-Ut(r),h=1<<s;h&n|e[s]&n&&(e[s]|=n),r&=~h}}function ga(e,n){var r=n&-n;return r=(r&42)!==0?1:zn(r),(r&(e.suspendedLanes|n))!==0?0:r}function zn(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function ra(e){return e&=-e,2<e?8<e?(e&134217727)!==0?32:268435456:8:2}function fe(){var e=M.p;return e!==0?e:(e=window.event,e===void 0?32:Nh(e.type))}function ke(e,n){var r=M.p;try{return M.p=e,n()}finally{M.p=r}}var De=Math.random().toString(36).slice(2),Ae="__reactFiber$"+De,Te="__reactProps$"+De,He="__reactContainer$"+De,We="__reactEvents$"+De,at="__reactListeners$"+De,Me="__reactHandles$"+De,pt="__reactResources$"+De,Pt="__reactMarker$"+De;function la(e){delete e[Ae],delete e[Te],delete e[We],delete e[at],delete e[Me]}function zt(e){var n=e[Ae];if(n)return n;for(var r=e.parentNode;r;){if(n=r[He]||r[Ae]){if(r=n.alternate,n.child!==null||r!==null&&r.child!==null)for(e=ph(e);e!==null;){if(r=e[Ae])return r;e=ph(e)}return n}e=r,r=e.parentNode}return null}function xt(e){if(e=e[Ae]||e[He]){var n=e.tag;if(n===5||n===6||n===13||n===31||n===26||n===27||n===3)return e}return null}function sa(e){var n=e.tag;if(n===5||n===26||n===27||n===6)return e.stateNode;throw Error(i(33))}function Vn(e){var n=e[pt];return n||(n=e[pt]={hoistableStyles:new Map,hoistableScripts:new Map}),n}function Tt(e){e[Pt]=!0}var Ja=new Set,xe={};function be(e,n){Ue(e,n),Ue(e+"Capture",n)}function Ue(e,n){for(xe[e]=n,e=0;e<n.length;e++)Ja.add(n[e])}var ft=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Vt={},un={};function Ra(e){return Je.call(un,e)?!0:Je.call(Vt,e)?!1:ft.test(e)?un[e]=!0:(Vt[e]=!0,!1)}function tn(e,n,r){if(Ra(n))if(r===null)e.removeAttribute(n);else{switch(typeof r){case"undefined":case"function":case"symbol":e.removeAttribute(n);return;case"boolean":var s=n.toLowerCase().slice(0,5);if(s!=="data-"&&s!=="aria-"){e.removeAttribute(n);return}}e.setAttribute(n,""+r)}}function hn(e,n,r){if(r===null)e.removeAttribute(n);else{switch(typeof r){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(n);return}e.setAttribute(n,""+r)}}function nn(e,n,r,s){if(s===null)e.removeAttribute(r);else{switch(typeof s){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(r);return}e.setAttributeNS(n,r,""+s)}}function qt(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function $o(e){var n=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(n==="checkbox"||n==="radio")}function Jr(e,n,r){var s=Object.getOwnPropertyDescriptor(e.constructor.prototype,n);if(!e.hasOwnProperty(n)&&typeof s<"u"&&typeof s.get=="function"&&typeof s.set=="function"){var h=s.get,g=s.set;return Object.defineProperty(e,n,{configurable:!0,get:function(){return h.call(this)},set:function(N){r=""+N,g.call(this,N)}}),Object.defineProperty(e,n,{enumerable:s.enumerable}),{getValue:function(){return r},setValue:function(N){r=""+N},stopTracking:function(){e._valueTracker=null,delete e[n]}}}}function Qt(e){if(!e._valueTracker){var n=$o(e)?"checked":"value";e._valueTracker=Jr(e,n,""+e[n])}}function Lo(e){if(!e)return!1;var n=e._valueTracker;if(!n)return!0;var r=n.getValue(),s="";return e&&(s=$o(e)?e.checked?"true":"false":e.value),e=s,e!==r?(n.setValue(e),!0):!1}function Ta(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}var ir=/[\n"\\]/g;function an(e){return e.replace(ir,function(n){return"\\"+n.charCodeAt(0).toString(16)+" "})}function eo(e,n,r,s,h,g,N,H){e.name="",N!=null&&typeof N!="function"&&typeof N!="symbol"&&typeof N!="boolean"?e.type=N:e.removeAttribute("type"),n!=null?N==="number"?(n===0&&e.value===""||e.value!=n)&&(e.value=""+qt(n)):e.value!==""+qt(n)&&(e.value=""+qt(n)):N!=="submit"&&N!=="reset"||e.removeAttribute("value"),n!=null?ca(e,N,qt(n)):r!=null?ca(e,N,qt(r)):s!=null&&e.removeAttribute("value"),h==null&&g!=null&&(e.defaultChecked=!!g),h!=null&&(e.checked=h&&typeof h!="function"&&typeof h!="symbol"),H!=null&&typeof H!="function"&&typeof H!="symbol"&&typeof H!="boolean"?e.name=""+qt(H):e.removeAttribute("name")}function Io(e,n,r,s,h,g,N,H){if(g!=null&&typeof g!="function"&&typeof g!="symbol"&&typeof g!="boolean"&&(e.type=g),n!=null||r!=null){if(!(g!=="submit"&&g!=="reset"||n!=null)){Qt(e);return}r=r!=null?""+qt(r):"",n=n!=null?""+qt(n):r,H||n===e.value||(e.value=n),e.defaultValue=n}s=s??h,s=typeof s!="function"&&typeof s!="symbol"&&!!s,e.checked=H?e.checked:!!s,e.defaultChecked=!!s,N!=null&&typeof N!="function"&&typeof N!="symbol"&&typeof N!="boolean"&&(e.name=N),Qt(e)}function ca(e,n,r){n==="number"&&Ta(e.ownerDocument)===e||e.defaultValue===""+r||(e.defaultValue=""+r)}function At(e,n,r,s){if(e=e.options,n){n={};for(var h=0;h<r.length;h++)n["$"+r[h]]=!0;for(r=0;r<e.length;r++)h=n.hasOwnProperty("$"+e[r].value),e[r].selected!==h&&(e[r].selected=h),h&&s&&(e[r].defaultSelected=!0)}else{for(r=""+qt(r),n=null,h=0;h<e.length;h++){if(e[h].value===r){e[h].selected=!0,s&&(e[h].defaultSelected=!0);return}n!==null||e[h].disabled||(n=e[h])}n!==null&&(n.selected=!0)}}function dr(e,n,r){if(n!=null&&(n=""+qt(n),n!==e.value&&(e.value=n),r==null)){e.defaultValue!==n&&(e.defaultValue=n);return}e.defaultValue=r!=null?""+qt(r):""}function Aa(e,n,r,s){if(n==null){if(s!=null){if(r!=null)throw Error(i(92));if($(s)){if(1<s.length)throw Error(i(93));s=s[0]}r=s}r==null&&(r=""),n=r}r=qt(n),e.defaultValue=r,s=e.textContent,s===r&&s!==""&&s!==null&&(e.value=s),Qt(e)}function Da(e,n){if(n){var r=e.firstChild;if(r&&r===e.lastChild&&r.nodeType===3){r.nodeValue=n;return}}e.textContent=n}var Jl=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function el(e,n,r){var s=n.indexOf("--")===0;r==null||typeof r=="boolean"||r===""?s?e.setProperty(n,""):n==="float"?e.cssFloat="":e[n]="":s?e.setProperty(n,r):typeof r!="number"||r===0||Jl.has(n)?n==="float"?e.cssFloat=r:e[n]=(""+r).trim():e[n]=r+"px"}function tl(e,n,r){if(n!=null&&typeof n!="object")throw Error(i(62));if(e=e.style,r!=null){for(var s in r)!r.hasOwnProperty(s)||n!=null&&n.hasOwnProperty(s)||(s.indexOf("--")===0?e.setProperty(s,""):s==="float"?e.cssFloat="":e[s]="");for(var h in n)s=n[h],n.hasOwnProperty(h)&&r[h]!==s&&el(e,h,s)}else for(var g in n)n.hasOwnProperty(g)&&el(e,g,n[g])}function ur(e){if(e.indexOf("-")===-1)return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var es=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),ts=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Uo(e){return ts.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}function Bn(){}var pr=null;function fr(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var Fa=null,qa=null;function Po(e){var n=xt(e);if(n&&(e=n.stateNode)){var r=e[Te]||null;e:switch(e=n.stateNode,n.type){case"input":if(eo(e,r.value,r.defaultValue,r.defaultValue,r.checked,r.defaultChecked,r.type,r.name),n=r.name,r.type==="radio"&&n!=null){for(r=e;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll('input[name="'+an(""+n)+'"][type="radio"]'),n=0;n<r.length;n++){var s=r[n];if(s!==e&&s.form===e.form){var h=s[Te]||null;if(!h)throw Error(i(90));eo(s,h.value,h.defaultValue,h.defaultValue,h.checked,h.defaultChecked,h.type,h.name)}}for(n=0;n<r.length;n++)s=r[n],s.form===e.form&&Lo(s)}break e;case"textarea":dr(e,r.value,r.defaultValue);break e;case"select":n=r.value,n!=null&&At(e,!!r.multiple,n,!1)}}}var qe=!1;function ns(e,n,r){if(qe)return e(n,r);qe=!0;try{var s=e(n);return s}finally{if(qe=!1,(Fa!==null||qa!==null)&&(Vs(),Fa&&(n=Fa,e=qa,qa=Fa=null,Po(n),e)))for(n=0;n<e.length;n++)Po(e[n])}}function va(e,n){var r=e.stateNode;if(r===null)return null;var s=r[Te]||null;if(s===null)return null;r=s[n];e:switch(n){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(s=!s.disabled)||(e=e.type,s=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!s;break e;default:e=!1}if(e)return null;if(r&&typeof r!="function")throw Error(i(231,n,typeof r));return r}var Yn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),as=!1;if(Yn)try{var to={};Object.defineProperty(to,"passive",{get:function(){as=!0}}),window.addEventListener("test",to,to),window.removeEventListener("test",to,to)}catch{as=!1}var no=null,Ec=null,os=null;function ou(){if(os)return os;var e,n=Ec,r=n.length,s,h="value"in no?no.value:no.textContent,g=h.length;for(e=0;e<r&&n[e]===h[e];e++);var N=r-e;for(s=1;s<=N&&n[r-s]===h[g-s];s++);return os=h.slice(e,1<s?1-s:void 0)}function rs(e){var n=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&n===13&&(e=13)):e=n,e===10&&(e=13),32<=e||e===13?e:0}function ls(){return!0}function ru(){return!1}function gn(e){function n(r,s,h,g,N){this._reactName=r,this._targetInst=h,this.type=s,this.nativeEvent=g,this.target=N,this.currentTarget=null;for(var H in e)e.hasOwnProperty(H)&&(r=e[H],this[H]=r?r(g):g[H]);return this.isDefaultPrevented=(g.defaultPrevented!=null?g.defaultPrevented:g.returnValue===!1)?ls:ru,this.isPropagationStopped=ru,this}return v(n.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=ls)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=ls)},persist:function(){},isPersistent:ls}),n}var Oo={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ss=gn(Oo),nl=v({},Oo,{view:0,detail:0}),Og=gn(nl),jc,kc,al,cs=v({},nl,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Rc,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==al&&(al&&e.type==="mousemove"?(jc=e.screenX-al.screenX,kc=e.screenY-al.screenY):kc=jc=0,al=e),jc)},movementY:function(e){return"movementY"in e?e.movementY:kc}}),lu=gn(cs),Mg=v({},cs,{dataTransfer:0}),Hg=gn(Mg),zg=v({},nl,{relatedTarget:0}),Nc=gn(zg),Vg=v({},Oo,{animationName:0,elapsedTime:0,pseudoElement:0}),Bg=gn(Vg),Yg=v({},Oo,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Gg=gn(Yg),Wg=v({},Oo,{data:0}),su=gn(Wg),Qg={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Xg={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Zg={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Kg(e){var n=this.nativeEvent;return n.getModifierState?n.getModifierState(e):(e=Zg[e])?!!n[e]:!1}function Rc(){return Kg}var Jg=v({},nl,{key:function(e){if(e.key){var n=Qg[e.key]||e.key;if(n!=="Unidentified")return n}return e.type==="keypress"?(e=rs(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?Xg[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Rc,charCode:function(e){return e.type==="keypress"?rs(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?rs(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),ev=gn(Jg),tv=v({},cs,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),cu=gn(tv),nv=v({},nl,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Rc}),av=gn(nv),ov=v({},Oo,{propertyName:0,elapsedTime:0,pseudoElement:0}),rv=gn(ov),lv=v({},cs,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),sv=gn(lv),cv=v({},Oo,{newState:0,oldState:0}),iv=gn(cv),dv=[9,13,27,32],Tc=Yn&&"CompositionEvent"in window,ol=null;Yn&&"documentMode"in document&&(ol=document.documentMode);var uv=Yn&&"TextEvent"in window&&!ol,iu=Yn&&(!Tc||ol&&8<ol&&11>=ol),du=" ",uu=!1;function pu(e,n){switch(e){case"keyup":return dv.indexOf(n.keyCode)!==-1;case"keydown":return n.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function fu(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var hr=!1;function pv(e,n){switch(e){case"compositionend":return fu(n);case"keypress":return n.which!==32?null:(uu=!0,du);case"textInput":return e=n.data,e===du&&uu?null:e;default:return null}}function fv(e,n){if(hr)return e==="compositionend"||!Tc&&pu(e,n)?(e=ou(),os=Ec=no=null,hr=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(n.ctrlKey||n.altKey||n.metaKey)||n.ctrlKey&&n.altKey){if(n.char&&1<n.char.length)return n.char;if(n.which)return String.fromCharCode(n.which)}return null;case"compositionend":return iu&&n.locale!=="ko"?null:n.data;default:return null}}var hv={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function hu(e){var n=e&&e.nodeName&&e.nodeName.toLowerCase();return n==="input"?!!hv[e.type]:n==="textarea"}function mu(e,n,r,s){Fa?qa?qa.push(s):qa=[s]:Fa=s,n=Zs(n,"onChange"),0<n.length&&(r=new ss("onChange","change",null,r,s),e.push({event:r,listeners:n}))}var rl=null,ll=null;function mv(e){Kf(e,0)}function is(e){var n=sa(e);if(Lo(n))return e}function yu(e,n){if(e==="change")return n}var gu=!1;if(Yn){var Ac;if(Yn){var Dc="oninput"in document;if(!Dc){var vu=document.createElement("div");vu.setAttribute("oninput","return;"),Dc=typeof vu.oninput=="function"}Ac=Dc}else Ac=!1;gu=Ac&&(!document.documentMode||9<document.documentMode)}function _u(){rl&&(rl.detachEvent("onpropertychange",xu),ll=rl=null)}function xu(e){if(e.propertyName==="value"&&is(ll)){var n=[];mu(n,ll,e,fr(e)),ns(mv,n)}}function yv(e,n,r){e==="focusin"?(_u(),rl=n,ll=r,rl.attachEvent("onpropertychange",xu)):e==="focusout"&&_u()}function gv(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return is(ll)}function vv(e,n){if(e==="click")return is(n)}function _v(e,n){if(e==="input"||e==="change")return is(n)}function xv(e,n){return e===n&&(e!==0||1/e===1/n)||e!==e&&n!==n}var Rn=typeof Object.is=="function"?Object.is:xv;function sl(e,n){if(Rn(e,n))return!0;if(typeof e!="object"||e===null||typeof n!="object"||n===null)return!1;var r=Object.keys(e),s=Object.keys(n);if(r.length!==s.length)return!1;for(s=0;s<r.length;s++){var h=r[s];if(!Je.call(n,h)||!Rn(e[h],n[h]))return!1}return!0}function wu(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Cu(e,n){var r=wu(e);e=0;for(var s;r;){if(r.nodeType===3){if(s=e+r.textContent.length,e<=n&&s>=n)return{node:r,offset:n-e};e=s}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=wu(r)}}function Su(e,n){return e&&n?e===n?!0:e&&e.nodeType===3?!1:n&&n.nodeType===3?Su(e,n.parentNode):"contains"in e?e.contains(n):e.compareDocumentPosition?!!(e.compareDocumentPosition(n)&16):!1:!1}function bu(e){e=e!=null&&e.ownerDocument!=null&&e.ownerDocument.defaultView!=null?e.ownerDocument.defaultView:window;for(var n=Ta(e.document);n instanceof e.HTMLIFrameElement;){try{var r=typeof n.contentWindow.location.href=="string"}catch{r=!1}if(r)e=n.contentWindow;else break;n=Ta(e.document)}return n}function Fc(e){var n=e&&e.nodeName&&e.nodeName.toLowerCase();return n&&(n==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||n==="textarea"||e.contentEditable==="true")}var wv=Yn&&"documentMode"in document&&11>=document.documentMode,mr=null,qc=null,cl=null,$c=!1;function Eu(e,n,r){var s=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;$c||mr==null||mr!==Ta(s)||(s=mr,"selectionStart"in s&&Fc(s)?s={start:s.selectionStart,end:s.selectionEnd}:(s=(s.ownerDocument&&s.ownerDocument.defaultView||window).getSelection(),s={anchorNode:s.anchorNode,anchorOffset:s.anchorOffset,focusNode:s.focusNode,focusOffset:s.focusOffset}),cl&&sl(cl,s)||(cl=s,s=Zs(qc,"onSelect"),0<s.length&&(n=new ss("onSelect","select",null,n,r),e.push({event:n,listeners:s}),n.target=mr)))}function Mo(e,n){var r={};return r[e.toLowerCase()]=n.toLowerCase(),r["Webkit"+e]="webkit"+n,r["Moz"+e]="moz"+n,r}var yr={animationend:Mo("Animation","AnimationEnd"),animationiteration:Mo("Animation","AnimationIteration"),animationstart:Mo("Animation","AnimationStart"),transitionrun:Mo("Transition","TransitionRun"),transitionstart:Mo("Transition","TransitionStart"),transitioncancel:Mo("Transition","TransitionCancel"),transitionend:Mo("Transition","TransitionEnd")},Lc={},ju={};Yn&&(ju=document.createElement("div").style,"AnimationEvent"in window||(delete yr.animationend.animation,delete yr.animationiteration.animation,delete yr.animationstart.animation),"TransitionEvent"in window||delete yr.transitionend.transition);function Ho(e){if(Lc[e])return Lc[e];if(!yr[e])return e;var n=yr[e],r;for(r in n)if(n.hasOwnProperty(r)&&r in ju)return Lc[e]=n[r];return e}var ku=Ho("animationend"),Nu=Ho("animationiteration"),Ru=Ho("animationstart"),Cv=Ho("transitionrun"),Sv=Ho("transitionstart"),bv=Ho("transitioncancel"),Tu=Ho("transitionend"),Au=new Map,Ic="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Ic.push("scrollEnd");function ia(e,n){Au.set(e,n),be(n,[e])}var ds=typeof reportError=="function"?reportError:function(e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var n=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof e=="object"&&e!==null&&typeof e.message=="string"?String(e.message):String(e),error:e});if(!window.dispatchEvent(n))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",e);return}console.error(e)},Gn=[],gr=0,Uc=0;function us(){for(var e=gr,n=Uc=gr=0;n<e;){var r=Gn[n];Gn[n++]=null;var s=Gn[n];Gn[n++]=null;var h=Gn[n];Gn[n++]=null;var g=Gn[n];if(Gn[n++]=null,s!==null&&h!==null){var N=s.pending;N===null?h.next=h:(h.next=N.next,N.next=h),s.pending=h}g!==0&&Du(r,h,g)}}function ps(e,n,r,s){Gn[gr++]=e,Gn[gr++]=n,Gn[gr++]=r,Gn[gr++]=s,Uc|=s,e.lanes|=s,e=e.alternate,e!==null&&(e.lanes|=s)}function Pc(e,n,r,s){return ps(e,n,r,s),fs(e)}function zo(e,n){return ps(e,null,null,n),fs(e)}function Du(e,n,r){e.lanes|=r;var s=e.alternate;s!==null&&(s.lanes|=r);for(var h=!1,g=e.return;g!==null;)g.childLanes|=r,s=g.alternate,s!==null&&(s.childLanes|=r),g.tag===22&&(e=g.stateNode,e===null||e._visibility&1||(h=!0)),e=g,g=g.return;return e.tag===3?(g=e.stateNode,h&&n!==null&&(h=31-Ut(r),e=g.hiddenUpdates,s=e[h],s===null?e[h]=[n]:s.push(n),n.lane=r|536870912),g):null}function fs(e){if(50<Tl)throw Tl=0,Wi=null,Error(i(185));for(var n=e.return;n!==null;)e=n,n=e.return;return e.tag===3?e.stateNode:null}var vr={};function Ev(e,n,r,s){this.tag=e,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=n,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=s,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Tn(e,n,r,s){return new Ev(e,n,r,s)}function Oc(e){return e=e.prototype,!(!e||!e.isReactComponent)}function $a(e,n){var r=e.alternate;return r===null?(r=Tn(e.tag,n,e.key,e.mode),r.elementType=e.elementType,r.type=e.type,r.stateNode=e.stateNode,r.alternate=e,e.alternate=r):(r.pendingProps=n,r.type=e.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=e.flags&65011712,r.childLanes=e.childLanes,r.lanes=e.lanes,r.child=e.child,r.memoizedProps=e.memoizedProps,r.memoizedState=e.memoizedState,r.updateQueue=e.updateQueue,n=e.dependencies,r.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext},r.sibling=e.sibling,r.index=e.index,r.ref=e.ref,r.refCleanup=e.refCleanup,r}function Fu(e,n){e.flags&=65011714;var r=e.alternate;return r===null?(e.childLanes=0,e.lanes=n,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=r.childLanes,e.lanes=r.lanes,e.child=r.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=r.memoizedProps,e.memoizedState=r.memoizedState,e.updateQueue=r.updateQueue,e.type=r.type,n=r.dependencies,e.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),e}function hs(e,n,r,s,h,g){var N=0;if(s=e,typeof e=="function")Oc(e)&&(N=1);else if(typeof e=="string")N=T_(e,r,Y.current)?26:e==="html"||e==="head"||e==="body"?27:5;else e:switch(e){case V:return e=Tn(31,r,n,h),e.elementType=V,e.lanes=g,e;case E:return Vo(r.children,h,g,n);case b:N=8,h|=24;break;case j:return e=Tn(12,r,n,h|2),e.elementType=j,e.lanes=g,e;case L:return e=Tn(13,r,n,h),e.elementType=L,e.lanes=g,e;case O:return e=Tn(19,r,n,h),e.elementType=O,e.lanes=g,e;default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case R:N=10;break e;case C:N=9;break e;case F:N=11;break e;case T:N=14;break e;case G:N=16,s=null;break e}N=29,r=Error(i(130,e===null?"null":typeof e,"")),s=null}return n=Tn(N,r,n,h),n.elementType=e,n.type=s,n.lanes=g,n}function Vo(e,n,r,s){return e=Tn(7,e,s,n),e.lanes=r,e}function Mc(e,n,r){return e=Tn(6,e,null,n),e.lanes=r,e}function qu(e){var n=Tn(18,null,null,0);return n.stateNode=e,n}function Hc(e,n,r){return n=Tn(4,e.children!==null?e.children:[],e.key,n),n.lanes=r,n.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},n}var $u=new WeakMap;function Wn(e,n){if(typeof e=="object"&&e!==null){var r=$u.get(e);return r!==void 0?r:(n={value:e,source:n,stack:et(n)},$u.set(e,n),n)}return{value:e,source:n,stack:et(n)}}var _r=[],xr=0,ms=null,il=0,Qn=[],Xn=0,ao=null,_a=1,xa="";function La(e,n){_r[xr++]=il,_r[xr++]=ms,ms=e,il=n}function Lu(e,n,r){Qn[Xn++]=_a,Qn[Xn++]=xa,Qn[Xn++]=ao,ao=e;var s=_a;e=xa;var h=32-Ut(s)-1;s&=~(1<<h),r+=1;var g=32-Ut(n)+h;if(30<g){var N=h-h%5;g=(s&(1<<N)-1).toString(32),s>>=N,h-=N,_a=1<<32-Ut(n)+h|r<<h|s,xa=g+e}else _a=1<<g|r<<h|s,xa=e}function zc(e){e.return!==null&&(La(e,1),Lu(e,1,0))}function Vc(e){for(;e===ms;)ms=_r[--xr],_r[xr]=null,il=_r[--xr],_r[xr]=null;for(;e===ao;)ao=Qn[--Xn],Qn[Xn]=null,xa=Qn[--Xn],Qn[Xn]=null,_a=Qn[--Xn],Qn[Xn]=null}function Iu(e,n){Qn[Xn++]=_a,Qn[Xn++]=xa,Qn[Xn++]=ao,_a=n.id,xa=n.overflow,ao=e}var on=null,jt=null,it=!1,oo=null,Zn=!1,Bc=Error(i(519));function ro(e){var n=Error(i(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw dl(Wn(n,e)),Bc}function Uu(e){var n=e.stateNode,r=e.type,s=e.memoizedProps;switch(n[Ae]=e,n[Te]=s,r){case"dialog":rt("cancel",n),rt("close",n);break;case"iframe":case"object":case"embed":rt("load",n);break;case"video":case"audio":for(r=0;r<Dl.length;r++)rt(Dl[r],n);break;case"source":rt("error",n);break;case"img":case"image":case"link":rt("error",n),rt("load",n);break;case"details":rt("toggle",n);break;case"input":rt("invalid",n),Io(n,s.value,s.defaultValue,s.checked,s.defaultChecked,s.type,s.name,!0);break;case"select":rt("invalid",n);break;case"textarea":rt("invalid",n),Aa(n,s.value,s.defaultValue,s.children)}r=s.children,typeof r!="string"&&typeof r!="number"&&typeof r!="bigint"||n.textContent===""+r||s.suppressHydrationWarning===!0||nh(n.textContent,r)?(s.popover!=null&&(rt("beforetoggle",n),rt("toggle",n)),s.onScroll!=null&&rt("scroll",n),s.onScrollEnd!=null&&rt("scrollend",n),s.onClick!=null&&(n.onclick=Bn),n=!0):n=!1,n||ro(e,!0)}function Pu(e){for(on=e.return;on;)switch(on.tag){case 5:case 31:case 13:Zn=!1;return;case 27:case 3:Zn=!0;return;default:on=on.return}}function wr(e){if(e!==on)return!1;if(!it)return Pu(e),it=!0,!1;var n=e.tag,r;if((r=n!==3&&n!==27)&&((r=n===5)&&(r=e.type,r=!(r!=="form"&&r!=="button")||id(e.type,e.memoizedProps)),r=!r),r&&jt&&ro(e),Pu(e),n===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(i(317));jt=uh(e)}else if(n===31){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(i(317));jt=uh(e)}else n===27?(n=jt,xo(e.type)?(e=hd,hd=null,jt=e):jt=n):jt=on?Jn(e.stateNode.nextSibling):null;return!0}function Bo(){jt=on=null,it=!1}function Yc(){var e=oo;return e!==null&&(wn===null?wn=e:wn.push.apply(wn,e),oo=null),e}function dl(e){oo===null?oo=[e]:oo.push(e)}var Gc=D(null),Yo=null,Ia=null;function lo(e,n,r){ae(Gc,n._currentValue),n._currentValue=r}function Ua(e){e._currentValue=Gc.current,Q(Gc)}function Wc(e,n,r){for(;e!==null;){var s=e.alternate;if((e.childLanes&n)!==n?(e.childLanes|=n,s!==null&&(s.childLanes|=n)):s!==null&&(s.childLanes&n)!==n&&(s.childLanes|=n),e===r)break;e=e.return}}function Qc(e,n,r,s){var h=e.child;for(h!==null&&(h.return=e);h!==null;){var g=h.dependencies;if(g!==null){var N=h.child;g=g.firstContext;e:for(;g!==null;){var H=g;g=h;for(var te=0;te<n.length;te++)if(H.context===n[te]){g.lanes|=r,H=g.alternate,H!==null&&(H.lanes|=r),Wc(g.return,r,e),s||(N=null);break e}g=H.next}}else if(h.tag===18){if(N=h.return,N===null)throw Error(i(341));N.lanes|=r,g=N.alternate,g!==null&&(g.lanes|=r),Wc(N,r,e),N=null}else N=h.child;if(N!==null)N.return=h;else for(N=h;N!==null;){if(N===e){N=null;break}if(h=N.sibling,h!==null){h.return=N.return,N=h;break}N=N.return}h=N}}function Cr(e,n,r,s){e=null;for(var h=n,g=!1;h!==null;){if(!g){if((h.flags&524288)!==0)g=!0;else if((h.flags&262144)!==0)break}if(h.tag===10){var N=h.alternate;if(N===null)throw Error(i(387));if(N=N.memoizedProps,N!==null){var H=h.type;Rn(h.pendingProps.value,N.value)||(e!==null?e.push(H):e=[H])}}else if(h===re.current){if(N=h.alternate,N===null)throw Error(i(387));N.memoizedState.memoizedState!==h.memoizedState.memoizedState&&(e!==null?e.push(Il):e=[Il])}h=h.return}e!==null&&Qc(n,e,r,s),n.flags|=262144}function ys(e){for(e=e.firstContext;e!==null;){if(!Rn(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function Go(e){Yo=e,Ia=null,e=e.dependencies,e!==null&&(e.firstContext=null)}function rn(e){return Ou(Yo,e)}function gs(e,n){return Yo===null&&Go(e),Ou(e,n)}function Ou(e,n){var r=n._currentValue;if(n={context:n,memoizedValue:r,next:null},Ia===null){if(e===null)throw Error(i(308));Ia=n,e.dependencies={lanes:0,firstContext:n},e.flags|=524288}else Ia=Ia.next=n;return r}var jv=typeof AbortController<"u"?AbortController:function(){var e=[],n=this.signal={aborted:!1,addEventListener:function(r,s){e.push(s)}};this.abort=function(){n.aborted=!0,e.forEach(function(r){return r()})}},kv=a.unstable_scheduleCallback,Nv=a.unstable_NormalPriority,Bt={$$typeof:R,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Xc(){return{controller:new jv,data:new Map,refCount:0}}function ul(e){e.refCount--,e.refCount===0&&kv(Nv,function(){e.controller.abort()})}var pl=null,Zc=0,Sr=0,br=null;function Rv(e,n){if(pl===null){var r=pl=[];Zc=0,Sr=ed(),br={status:"pending",value:void 0,then:function(s){r.push(s)}}}return Zc++,n.then(Mu,Mu),n}function Mu(){if(--Zc===0&&pl!==null){br!==null&&(br.status="fulfilled");var e=pl;pl=null,Sr=0,br=null;for(var n=0;n<e.length;n++)(0,e[n])()}}function Tv(e,n){var r=[],s={status:"pending",value:null,reason:null,then:function(h){r.push(h)}};return e.then(function(){s.status="fulfilled",s.value=n;for(var h=0;h<r.length;h++)(0,r[h])(n)},function(h){for(s.status="rejected",s.reason=h,h=0;h<r.length;h++)(0,r[h])(void 0)}),s}var Hu=q.S;q.S=function(e,n){jf=Oe(),typeof n=="object"&&n!==null&&typeof n.then=="function"&&Rv(e,n),Hu!==null&&Hu(e,n)};var Wo=D(null);function Kc(){var e=Wo.current;return e!==null?e:Et.pooledCache}function vs(e,n){n===null?ae(Wo,Wo.current):ae(Wo,n.pool)}function zu(){var e=Kc();return e===null?null:{parent:Bt._currentValue,pool:e}}var Er=Error(i(460)),Jc=Error(i(474)),_s=Error(i(542)),xs={then:function(){}};function Vu(e){return e=e.status,e==="fulfilled"||e==="rejected"}function Bu(e,n,r){switch(r=e[r],r===void 0?e.push(n):r!==n&&(n.then(Bn,Bn),n=r),n.status){case"fulfilled":return n.value;case"rejected":throw e=n.reason,Gu(e),e;default:if(typeof n.status=="string")n.then(Bn,Bn);else{if(e=Et,e!==null&&100<e.shellSuspendCounter)throw Error(i(482));e=n,e.status="pending",e.then(function(s){if(n.status==="pending"){var h=n;h.status="fulfilled",h.value=s}},function(s){if(n.status==="pending"){var h=n;h.status="rejected",h.reason=s}})}switch(n.status){case"fulfilled":return n.value;case"rejected":throw e=n.reason,Gu(e),e}throw Xo=n,Er}}function Qo(e){try{var n=e._init;return n(e._payload)}catch(r){throw r!==null&&typeof r=="object"&&typeof r.then=="function"?(Xo=r,Er):r}}var Xo=null;function Yu(){if(Xo===null)throw Error(i(459));var e=Xo;return Xo=null,e}function Gu(e){if(e===Er||e===_s)throw Error(i(483))}var jr=null,fl=0;function ws(e){var n=fl;return fl+=1,jr===null&&(jr=[]),Bu(jr,e,n)}function hl(e,n){n=n.props.ref,e.ref=n!==void 0?n:null}function Cs(e,n){throw n.$$typeof===x?Error(i(525)):(e=Object.prototype.toString.call(n),Error(i(31,e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)))}function Wu(e){function n(ce,oe){if(e){var ie=ce.deletions;ie===null?(ce.deletions=[oe],ce.flags|=16):ie.push(oe)}}function r(ce,oe){if(!e)return null;for(;oe!==null;)n(ce,oe),oe=oe.sibling;return null}function s(ce){for(var oe=new Map;ce!==null;)ce.key!==null?oe.set(ce.key,ce):oe.set(ce.index,ce),ce=ce.sibling;return oe}function h(ce,oe){return ce=$a(ce,oe),ce.index=0,ce.sibling=null,ce}function g(ce,oe,ie){return ce.index=ie,e?(ie=ce.alternate,ie!==null?(ie=ie.index,ie<oe?(ce.flags|=67108866,oe):ie):(ce.flags|=67108866,oe)):(ce.flags|=1048576,oe)}function N(ce){return e&&ce.alternate===null&&(ce.flags|=67108866),ce}function H(ce,oe,ie,ge){return oe===null||oe.tag!==6?(oe=Mc(ie,ce.mode,ge),oe.return=ce,oe):(oe=h(oe,ie),oe.return=ce,oe)}function te(ce,oe,ie,ge){var Pe=ie.type;return Pe===E?ye(ce,oe,ie.props.children,ge,ie.key):oe!==null&&(oe.elementType===Pe||typeof Pe=="object"&&Pe!==null&&Pe.$$typeof===G&&Qo(Pe)===oe.type)?(oe=h(oe,ie.props),hl(oe,ie),oe.return=ce,oe):(oe=hs(ie.type,ie.key,ie.props,null,ce.mode,ge),hl(oe,ie),oe.return=ce,oe)}function de(ce,oe,ie,ge){return oe===null||oe.tag!==4||oe.stateNode.containerInfo!==ie.containerInfo||oe.stateNode.implementation!==ie.implementation?(oe=Hc(ie,ce.mode,ge),oe.return=ce,oe):(oe=h(oe,ie.children||[]),oe.return=ce,oe)}function ye(ce,oe,ie,ge,Pe){return oe===null||oe.tag!==7?(oe=Vo(ie,ce.mode,ge,Pe),oe.return=ce,oe):(oe=h(oe,ie),oe.return=ce,oe)}function _e(ce,oe,ie){if(typeof oe=="string"&&oe!==""||typeof oe=="number"||typeof oe=="bigint")return oe=Mc(""+oe,ce.mode,ie),oe.return=ce,oe;if(typeof oe=="object"&&oe!==null){switch(oe.$$typeof){case w:return ie=hs(oe.type,oe.key,oe.props,null,ce.mode,ie),hl(ie,oe),ie.return=ce,ie;case S:return oe=Hc(oe,ce.mode,ie),oe.return=ce,oe;case G:return oe=Qo(oe),_e(ce,oe,ie)}if($(oe)||k(oe))return oe=Vo(oe,ce.mode,ie,null),oe.return=ce,oe;if(typeof oe.then=="function")return _e(ce,ws(oe),ie);if(oe.$$typeof===R)return _e(ce,gs(ce,oe),ie);Cs(ce,oe)}return null}function pe(ce,oe,ie,ge){var Pe=oe!==null?oe.key:null;if(typeof ie=="string"&&ie!==""||typeof ie=="number"||typeof ie=="bigint")return Pe!==null?null:H(ce,oe,""+ie,ge);if(typeof ie=="object"&&ie!==null){switch(ie.$$typeof){case w:return ie.key===Pe?te(ce,oe,ie,ge):null;case S:return ie.key===Pe?de(ce,oe,ie,ge):null;case G:return ie=Qo(ie),pe(ce,oe,ie,ge)}if($(ie)||k(ie))return Pe!==null?null:ye(ce,oe,ie,ge,null);if(typeof ie.then=="function")return pe(ce,oe,ws(ie),ge);if(ie.$$typeof===R)return pe(ce,oe,gs(ce,ie),ge);Cs(ce,ie)}return null}function he(ce,oe,ie,ge,Pe){if(typeof ge=="string"&&ge!==""||typeof ge=="number"||typeof ge=="bigint")return ce=ce.get(ie)||null,H(oe,ce,""+ge,Pe);if(typeof ge=="object"&&ge!==null){switch(ge.$$typeof){case w:return ce=ce.get(ge.key===null?ie:ge.key)||null,te(oe,ce,ge,Pe);case S:return ce=ce.get(ge.key===null?ie:ge.key)||null,de(oe,ce,ge,Pe);case G:return ge=Qo(ge),he(ce,oe,ie,ge,Pe)}if($(ge)||k(ge))return ce=ce.get(ie)||null,ye(oe,ce,ge,Pe,null);if(typeof ge.then=="function")return he(ce,oe,ie,ws(ge),Pe);if(ge.$$typeof===R)return he(ce,oe,ie,gs(oe,ge),Pe);Cs(oe,ge)}return null}function $e(ce,oe,ie,ge){for(var Pe=null,ht=null,Ie=oe,Xe=oe=0,ct=null;Ie!==null&&Xe<ie.length;Xe++){Ie.index>Xe?(ct=Ie,Ie=null):ct=Ie.sibling;var mt=pe(ce,Ie,ie[Xe],ge);if(mt===null){Ie===null&&(Ie=ct);break}e&&Ie&&mt.alternate===null&&n(ce,Ie),oe=g(mt,oe,Xe),ht===null?Pe=mt:ht.sibling=mt,ht=mt,Ie=ct}if(Xe===ie.length)return r(ce,Ie),it&&La(ce,Xe),Pe;if(Ie===null){for(;Xe<ie.length;Xe++)Ie=_e(ce,ie[Xe],ge),Ie!==null&&(oe=g(Ie,oe,Xe),ht===null?Pe=Ie:ht.sibling=Ie,ht=Ie);return it&&La(ce,Xe),Pe}for(Ie=s(Ie);Xe<ie.length;Xe++)ct=he(Ie,ce,Xe,ie[Xe],ge),ct!==null&&(e&&ct.alternate!==null&&Ie.delete(ct.key===null?Xe:ct.key),oe=g(ct,oe,Xe),ht===null?Pe=ct:ht.sibling=ct,ht=ct);return e&&Ie.forEach(function(Eo){return n(ce,Eo)}),it&&La(ce,Xe),Pe}function ze(ce,oe,ie,ge){if(ie==null)throw Error(i(151));for(var Pe=null,ht=null,Ie=oe,Xe=oe=0,ct=null,mt=ie.next();Ie!==null&&!mt.done;Xe++,mt=ie.next()){Ie.index>Xe?(ct=Ie,Ie=null):ct=Ie.sibling;var Eo=pe(ce,Ie,mt.value,ge);if(Eo===null){Ie===null&&(Ie=ct);break}e&&Ie&&Eo.alternate===null&&n(ce,Ie),oe=g(Eo,oe,Xe),ht===null?Pe=Eo:ht.sibling=Eo,ht=Eo,Ie=ct}if(mt.done)return r(ce,Ie),it&&La(ce,Xe),Pe;if(Ie===null){for(;!mt.done;Xe++,mt=ie.next())mt=_e(ce,mt.value,ge),mt!==null&&(oe=g(mt,oe,Xe),ht===null?Pe=mt:ht.sibling=mt,ht=mt);return it&&La(ce,Xe),Pe}for(Ie=s(Ie);!mt.done;Xe++,mt=ie.next())mt=he(Ie,ce,Xe,mt.value,ge),mt!==null&&(e&&mt.alternate!==null&&Ie.delete(mt.key===null?Xe:mt.key),oe=g(mt,oe,Xe),ht===null?Pe=mt:ht.sibling=mt,ht=mt);return e&&Ie.forEach(function(M_){return n(ce,M_)}),it&&La(ce,Xe),Pe}function St(ce,oe,ie,ge){if(typeof ie=="object"&&ie!==null&&ie.type===E&&ie.key===null&&(ie=ie.props.children),typeof ie=="object"&&ie!==null){switch(ie.$$typeof){case w:e:{for(var Pe=ie.key;oe!==null;){if(oe.key===Pe){if(Pe=ie.type,Pe===E){if(oe.tag===7){r(ce,oe.sibling),ge=h(oe,ie.props.children),ge.return=ce,ce=ge;break e}}else if(oe.elementType===Pe||typeof Pe=="object"&&Pe!==null&&Pe.$$typeof===G&&Qo(Pe)===oe.type){r(ce,oe.sibling),ge=h(oe,ie.props),hl(ge,ie),ge.return=ce,ce=ge;break e}r(ce,oe);break}else n(ce,oe);oe=oe.sibling}ie.type===E?(ge=Vo(ie.props.children,ce.mode,ge,ie.key),ge.return=ce,ce=ge):(ge=hs(ie.type,ie.key,ie.props,null,ce.mode,ge),hl(ge,ie),ge.return=ce,ce=ge)}return N(ce);case S:e:{for(Pe=ie.key;oe!==null;){if(oe.key===Pe)if(oe.tag===4&&oe.stateNode.containerInfo===ie.containerInfo&&oe.stateNode.implementation===ie.implementation){r(ce,oe.sibling),ge=h(oe,ie.children||[]),ge.return=ce,ce=ge;break e}else{r(ce,oe);break}else n(ce,oe);oe=oe.sibling}ge=Hc(ie,ce.mode,ge),ge.return=ce,ce=ge}return N(ce);case G:return ie=Qo(ie),St(ce,oe,ie,ge)}if($(ie))return $e(ce,oe,ie,ge);if(k(ie)){if(Pe=k(ie),typeof Pe!="function")throw Error(i(150));return ie=Pe.call(ie),ze(ce,oe,ie,ge)}if(typeof ie.then=="function")return St(ce,oe,ws(ie),ge);if(ie.$$typeof===R)return St(ce,oe,gs(ce,ie),ge);Cs(ce,ie)}return typeof ie=="string"&&ie!==""||typeof ie=="number"||typeof ie=="bigint"?(ie=""+ie,oe!==null&&oe.tag===6?(r(ce,oe.sibling),ge=h(oe,ie),ge.return=ce,ce=ge):(r(ce,oe),ge=Mc(ie,ce.mode,ge),ge.return=ce,ce=ge),N(ce)):r(ce,oe)}return function(ce,oe,ie,ge){try{fl=0;var Pe=St(ce,oe,ie,ge);return jr=null,Pe}catch(Ie){if(Ie===Er||Ie===_s)throw Ie;var ht=Tn(29,Ie,null,ce.mode);return ht.lanes=ge,ht.return=ce,ht}finally{}}}var Zo=Wu(!0),Qu=Wu(!1),so=!1;function ei(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function ti(e,n){e=e.updateQueue,n.updateQueue===e&&(n.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function co(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function io(e,n,r){var s=e.updateQueue;if(s===null)return null;if(s=s.shared,(yt&2)!==0){var h=s.pending;return h===null?n.next=n:(n.next=h.next,h.next=n),s.pending=n,n=fs(e),Du(e,null,r),n}return ps(e,s,n,r),fs(e)}function ml(e,n,r){if(n=n.updateQueue,n!==null&&(n=n.shared,(r&4194048)!==0)){var s=n.lanes;s&=e.pendingLanes,r|=s,n.lanes=r,ya(e,r)}}function ni(e,n){var r=e.updateQueue,s=e.alternate;if(s!==null&&(s=s.updateQueue,r===s)){var h=null,g=null;if(r=r.firstBaseUpdate,r!==null){do{var N={lane:r.lane,tag:r.tag,payload:r.payload,callback:null,next:null};g===null?h=g=N:g=g.next=N,r=r.next}while(r!==null);g===null?h=g=n:g=g.next=n}else h=g=n;r={baseState:s.baseState,firstBaseUpdate:h,lastBaseUpdate:g,shared:s.shared,callbacks:s.callbacks},e.updateQueue=r;return}e=r.lastBaseUpdate,e===null?r.firstBaseUpdate=n:e.next=n,r.lastBaseUpdate=n}var ai=!1;function yl(){if(ai){var e=br;if(e!==null)throw e}}function gl(e,n,r,s){ai=!1;var h=e.updateQueue;so=!1;var g=h.firstBaseUpdate,N=h.lastBaseUpdate,H=h.shared.pending;if(H!==null){h.shared.pending=null;var te=H,de=te.next;te.next=null,N===null?g=de:N.next=de,N=te;var ye=e.alternate;ye!==null&&(ye=ye.updateQueue,H=ye.lastBaseUpdate,H!==N&&(H===null?ye.firstBaseUpdate=de:H.next=de,ye.lastBaseUpdate=te))}if(g!==null){var _e=h.baseState;N=0,ye=de=te=null,H=g;do{var pe=H.lane&-536870913,he=pe!==H.lane;if(he?(st&pe)===pe:(s&pe)===pe){pe!==0&&pe===Sr&&(ai=!0),ye!==null&&(ye=ye.next={lane:0,tag:H.tag,payload:H.payload,callback:null,next:null});e:{var $e=e,ze=H;pe=n;var St=r;switch(ze.tag){case 1:if($e=ze.payload,typeof $e=="function"){_e=$e.call(St,_e,pe);break e}_e=$e;break e;case 3:$e.flags=$e.flags&-65537|128;case 0:if($e=ze.payload,pe=typeof $e=="function"?$e.call(St,_e,pe):$e,pe==null)break e;_e=v({},_e,pe);break e;case 2:so=!0}}pe=H.callback,pe!==null&&(e.flags|=64,he&&(e.flags|=8192),he=h.callbacks,he===null?h.callbacks=[pe]:he.push(pe))}else he={lane:pe,tag:H.tag,payload:H.payload,callback:H.callback,next:null},ye===null?(de=ye=he,te=_e):ye=ye.next=he,N|=pe;if(H=H.next,H===null){if(H=h.shared.pending,H===null)break;he=H,H=he.next,he.next=null,h.lastBaseUpdate=he,h.shared.pending=null}}while(!0);ye===null&&(te=_e),h.baseState=te,h.firstBaseUpdate=de,h.lastBaseUpdate=ye,g===null&&(h.shared.lanes=0),mo|=N,e.lanes=N,e.memoizedState=_e}}function Xu(e,n){if(typeof e!="function")throw Error(i(191,e));e.call(n)}function Zu(e,n){var r=e.callbacks;if(r!==null)for(e.callbacks=null,e=0;e<r.length;e++)Xu(r[e],n)}var kr=D(null),Ss=D(0);function Ku(e,n){e=Ga,ae(Ss,e),ae(kr,n),Ga=e|n.baseLanes}function oi(){ae(Ss,Ga),ae(kr,kr.current)}function ri(){Ga=Ss.current,Q(kr),Q(Ss)}var An=D(null),Kn=null;function uo(e){var n=e.alternate;ae(Ot,Ot.current&1),ae(An,e),Kn===null&&(n===null||kr.current!==null||n.memoizedState!==null)&&(Kn=e)}function li(e){ae(Ot,Ot.current),ae(An,e),Kn===null&&(Kn=e)}function Ju(e){e.tag===22?(ae(Ot,Ot.current),ae(An,e),Kn===null&&(Kn=e)):po()}function po(){ae(Ot,Ot.current),ae(An,An.current)}function Dn(e){Q(An),Kn===e&&(Kn=null),Q(Ot)}var Ot=D(0);function bs(e){for(var n=e;n!==null;){if(n.tag===13){var r=n.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||pd(r)||fd(r)))return n}else if(n.tag===19&&(n.memoizedProps.revealOrder==="forwards"||n.memoizedProps.revealOrder==="backwards"||n.memoizedProps.revealOrder==="unstable_legacy-backwards"||n.memoizedProps.revealOrder==="together")){if((n.flags&128)!==0)return n}else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return null;n=n.return}n.sibling.return=n.return,n=n.sibling}return null}var Pa=0,Qe=null,wt=null,Yt=null,Es=!1,Nr=!1,Ko=!1,js=0,vl=0,Rr=null,Av=0;function $t(){throw Error(i(321))}function si(e,n){if(n===null)return!1;for(var r=0;r<n.length&&r<e.length;r++)if(!Rn(e[r],n[r]))return!1;return!0}function ci(e,n,r,s,h,g){return Pa=g,Qe=n,n.memoizedState=null,n.updateQueue=null,n.lanes=0,q.H=e===null||e.memoizedState===null?Lp:Si,Ko=!1,g=r(s,h),Ko=!1,Nr&&(g=tp(n,r,s,h)),ep(e),g}function ep(e){q.H=wl;var n=wt!==null&&wt.next!==null;if(Pa=0,Yt=wt=Qe=null,Es=!1,vl=0,Rr=null,n)throw Error(i(300));e===null||Gt||(e=e.dependencies,e!==null&&ys(e)&&(Gt=!0))}function tp(e,n,r,s){Qe=e;var h=0;do{if(Nr&&(Rr=null),vl=0,Nr=!1,25<=h)throw Error(i(301));if(h+=1,Yt=wt=null,e.updateQueue!=null){var g=e.updateQueue;g.lastEffect=null,g.events=null,g.stores=null,g.memoCache!=null&&(g.memoCache.index=0)}q.H=Ip,g=n(r,s)}while(Nr);return g}function Dv(){var e=q.H,n=e.useState()[0];return n=typeof n.then=="function"?_l(n):n,e=e.useState()[0],(wt!==null?wt.memoizedState:null)!==e&&(Qe.flags|=1024),n}function ii(){var e=js!==0;return js=0,e}function di(e,n,r){n.updateQueue=e.updateQueue,n.flags&=-2053,e.lanes&=~r}function ui(e){if(Es){for(e=e.memoizedState;e!==null;){var n=e.queue;n!==null&&(n.pending=null),e=e.next}Es=!1}Pa=0,Yt=wt=Qe=null,Nr=!1,vl=js=0,Rr=null}function mn(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Yt===null?Qe.memoizedState=Yt=e:Yt=Yt.next=e,Yt}function Mt(){if(wt===null){var e=Qe.alternate;e=e!==null?e.memoizedState:null}else e=wt.next;var n=Yt===null?Qe.memoizedState:Yt.next;if(n!==null)Yt=n,wt=e;else{if(e===null)throw Qe.alternate===null?Error(i(467)):Error(i(310));wt=e,e={memoizedState:wt.memoizedState,baseState:wt.baseState,baseQueue:wt.baseQueue,queue:wt.queue,next:null},Yt===null?Qe.memoizedState=Yt=e:Yt=Yt.next=e}return Yt}function ks(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function _l(e){var n=vl;return vl+=1,Rr===null&&(Rr=[]),e=Bu(Rr,e,n),n=Qe,(Yt===null?n.memoizedState:Yt.next)===null&&(n=n.alternate,q.H=n===null||n.memoizedState===null?Lp:Si),e}function Ns(e){if(e!==null&&typeof e=="object"){if(typeof e.then=="function")return _l(e);if(e.$$typeof===R)return rn(e)}throw Error(i(438,String(e)))}function pi(e){var n=null,r=Qe.updateQueue;if(r!==null&&(n=r.memoCache),n==null){var s=Qe.alternate;s!==null&&(s=s.updateQueue,s!==null&&(s=s.memoCache,s!=null&&(n={data:s.data.map(function(h){return h.slice()}),index:0})))}if(n==null&&(n={data:[],index:0}),r===null&&(r=ks(),Qe.updateQueue=r),r.memoCache=n,r=n.data[n.index],r===void 0)for(r=n.data[n.index]=Array(e),s=0;s<e;s++)r[s]=z;return n.index++,r}function Oa(e,n){return typeof n=="function"?n(e):n}function Rs(e){var n=Mt();return fi(n,wt,e)}function fi(e,n,r){var s=e.queue;if(s===null)throw Error(i(311));s.lastRenderedReducer=r;var h=e.baseQueue,g=s.pending;if(g!==null){if(h!==null){var N=h.next;h.next=g.next,g.next=N}n.baseQueue=h=g,s.pending=null}if(g=e.baseState,h===null)e.memoizedState=g;else{n=h.next;var H=N=null,te=null,de=n,ye=!1;do{var _e=de.lane&-536870913;if(_e!==de.lane?(st&_e)===_e:(Pa&_e)===_e){var pe=de.revertLane;if(pe===0)te!==null&&(te=te.next={lane:0,revertLane:0,gesture:null,action:de.action,hasEagerState:de.hasEagerState,eagerState:de.eagerState,next:null}),_e===Sr&&(ye=!0);else if((Pa&pe)===pe){de=de.next,pe===Sr&&(ye=!0);continue}else _e={lane:0,revertLane:de.revertLane,gesture:null,action:de.action,hasEagerState:de.hasEagerState,eagerState:de.eagerState,next:null},te===null?(H=te=_e,N=g):te=te.next=_e,Qe.lanes|=pe,mo|=pe;_e=de.action,Ko&&r(g,_e),g=de.hasEagerState?de.eagerState:r(g,_e)}else pe={lane:_e,revertLane:de.revertLane,gesture:de.gesture,action:de.action,hasEagerState:de.hasEagerState,eagerState:de.eagerState,next:null},te===null?(H=te=pe,N=g):te=te.next=pe,Qe.lanes|=_e,mo|=_e;de=de.next}while(de!==null&&de!==n);if(te===null?N=g:te.next=H,!Rn(g,e.memoizedState)&&(Gt=!0,ye&&(r=br,r!==null)))throw r;e.memoizedState=g,e.baseState=N,e.baseQueue=te,s.lastRenderedState=g}return h===null&&(s.lanes=0),[e.memoizedState,s.dispatch]}function hi(e){var n=Mt(),r=n.queue;if(r===null)throw Error(i(311));r.lastRenderedReducer=e;var s=r.dispatch,h=r.pending,g=n.memoizedState;if(h!==null){r.pending=null;var N=h=h.next;do g=e(g,N.action),N=N.next;while(N!==h);Rn(g,n.memoizedState)||(Gt=!0),n.memoizedState=g,n.baseQueue===null&&(n.baseState=g),r.lastRenderedState=g}return[g,s]}function np(e,n,r){var s=Qe,h=Mt(),g=it;if(g){if(r===void 0)throw Error(i(407));r=r()}else r=n();var N=!Rn((wt||h).memoizedState,r);if(N&&(h.memoizedState=r,Gt=!0),h=h.queue,gi(rp.bind(null,s,h,e),[e]),h.getSnapshot!==n||N||Yt!==null&&Yt.memoizedState.tag&1){if(s.flags|=2048,Tr(9,{destroy:void 0},op.bind(null,s,h,r,n),null),Et===null)throw Error(i(349));g||(Pa&127)!==0||ap(s,n,r)}return r}function ap(e,n,r){e.flags|=16384,e={getSnapshot:n,value:r},n=Qe.updateQueue,n===null?(n=ks(),Qe.updateQueue=n,n.stores=[e]):(r=n.stores,r===null?n.stores=[e]:r.push(e))}function op(e,n,r,s){n.value=r,n.getSnapshot=s,lp(n)&&sp(e)}function rp(e,n,r){return r(function(){lp(n)&&sp(e)})}function lp(e){var n=e.getSnapshot;e=e.value;try{var r=n();return!Rn(e,r)}catch{return!0}}function sp(e){var n=zo(e,2);n!==null&&Cn(n,e,2)}function mi(e){var n=mn();if(typeof e=="function"){var r=e;if(e=r(),Ko){Kt(!0);try{r()}finally{Kt(!1)}}}return n.memoizedState=n.baseState=e,n.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Oa,lastRenderedState:e},n}function cp(e,n,r,s){return e.baseState=r,fi(e,wt,typeof s=="function"?s:Oa)}function Fv(e,n,r,s,h){if(Ds(e))throw Error(i(485));if(e=n.action,e!==null){var g={payload:h,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(N){g.listeners.push(N)}};q.T!==null?r(!0):g.isTransition=!1,s(g),r=n.pending,r===null?(g.next=n.pending=g,ip(n,g)):(g.next=r.next,n.pending=r.next=g)}}function ip(e,n){var r=n.action,s=n.payload,h=e.state;if(n.isTransition){var g=q.T,N={};q.T=N;try{var H=r(h,s),te=q.S;te!==null&&te(N,H),dp(e,n,H)}catch(de){yi(e,n,de)}finally{g!==null&&N.types!==null&&(g.types=N.types),q.T=g}}else try{g=r(h,s),dp(e,n,g)}catch(de){yi(e,n,de)}}function dp(e,n,r){r!==null&&typeof r=="object"&&typeof r.then=="function"?r.then(function(s){up(e,n,s)},function(s){return yi(e,n,s)}):up(e,n,r)}function up(e,n,r){n.status="fulfilled",n.value=r,pp(n),e.state=r,n=e.pending,n!==null&&(r=n.next,r===n?e.pending=null:(r=r.next,n.next=r,ip(e,r)))}function yi(e,n,r){var s=e.pending;if(e.pending=null,s!==null){s=s.next;do n.status="rejected",n.reason=r,pp(n),n=n.next;while(n!==s)}e.action=null}function pp(e){e=e.listeners;for(var n=0;n<e.length;n++)(0,e[n])()}function fp(e,n){return n}function hp(e,n){if(it){var r=Et.formState;if(r!==null){e:{var s=Qe;if(it){if(jt){t:{for(var h=jt,g=Zn;h.nodeType!==8;){if(!g){h=null;break t}if(h=Jn(h.nextSibling),h===null){h=null;break t}}g=h.data,h=g==="F!"||g==="F"?h:null}if(h){jt=Jn(h.nextSibling),s=h.data==="F!";break e}}ro(s)}s=!1}s&&(n=r[0])}}return r=mn(),r.memoizedState=r.baseState=n,s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:fp,lastRenderedState:n},r.queue=s,r=Fp.bind(null,Qe,s),s.dispatch=r,s=mi(!1),g=Ci.bind(null,Qe,!1,s.queue),s=mn(),h={state:n,dispatch:null,action:e,pending:null},s.queue=h,r=Fv.bind(null,Qe,h,g,r),h.dispatch=r,s.memoizedState=e,[n,r,!1]}function mp(e){var n=Mt();return yp(n,wt,e)}function yp(e,n,r){if(n=fi(e,n,fp)[0],e=Rs(Oa)[0],typeof n=="object"&&n!==null&&typeof n.then=="function")try{var s=_l(n)}catch(N){throw N===Er?_s:N}else s=n;n=Mt();var h=n.queue,g=h.dispatch;return r!==n.memoizedState&&(Qe.flags|=2048,Tr(9,{destroy:void 0},qv.bind(null,h,r),null)),[s,g,e]}function qv(e,n){e.action=n}function gp(e){var n=Mt(),r=wt;if(r!==null)return yp(n,r,e);Mt(),n=n.memoizedState,r=Mt();var s=r.queue.dispatch;return r.memoizedState=e,[n,s,!1]}function Tr(e,n,r,s){return e={tag:e,create:r,deps:s,inst:n,next:null},n=Qe.updateQueue,n===null&&(n=ks(),Qe.updateQueue=n),r=n.lastEffect,r===null?n.lastEffect=e.next=e:(s=r.next,r.next=e,e.next=s,n.lastEffect=e),e}function vp(){return Mt().memoizedState}function Ts(e,n,r,s){var h=mn();Qe.flags|=e,h.memoizedState=Tr(1|n,{destroy:void 0},r,s===void 0?null:s)}function As(e,n,r,s){var h=Mt();s=s===void 0?null:s;var g=h.memoizedState.inst;wt!==null&&s!==null&&si(s,wt.memoizedState.deps)?h.memoizedState=Tr(n,g,r,s):(Qe.flags|=e,h.memoizedState=Tr(1|n,g,r,s))}function _p(e,n){Ts(8390656,8,e,n)}function gi(e,n){As(2048,8,e,n)}function $v(e){Qe.flags|=4;var n=Qe.updateQueue;if(n===null)n=ks(),Qe.updateQueue=n,n.events=[e];else{var r=n.events;r===null?n.events=[e]:r.push(e)}}function xp(e){var n=Mt().memoizedState;return $v({ref:n,nextImpl:e}),function(){if((yt&2)!==0)throw Error(i(440));return n.impl.apply(void 0,arguments)}}function wp(e,n){return As(4,2,e,n)}function Cp(e,n){return As(4,4,e,n)}function Sp(e,n){if(typeof n=="function"){e=e();var r=n(e);return function(){typeof r=="function"?r():n(null)}}if(n!=null)return e=e(),n.current=e,function(){n.current=null}}function bp(e,n,r){r=r!=null?r.concat([e]):null,As(4,4,Sp.bind(null,n,e),r)}function vi(){}function Ep(e,n){var r=Mt();n=n===void 0?null:n;var s=r.memoizedState;return n!==null&&si(n,s[1])?s[0]:(r.memoizedState=[e,n],e)}function jp(e,n){var r=Mt();n=n===void 0?null:n;var s=r.memoizedState;if(n!==null&&si(n,s[1]))return s[0];if(s=e(),Ko){Kt(!0);try{e()}finally{Kt(!1)}}return r.memoizedState=[s,n],s}function _i(e,n,r){return r===void 0||(Pa&1073741824)!==0&&(st&261930)===0?e.memoizedState=n:(e.memoizedState=r,e=Nf(),Qe.lanes|=e,mo|=e,r)}function kp(e,n,r,s){return Rn(r,n)?r:kr.current!==null?(e=_i(e,r,s),Rn(e,n)||(Gt=!0),e):(Pa&42)===0||(Pa&1073741824)!==0&&(st&261930)===0?(Gt=!0,e.memoizedState=r):(e=Nf(),Qe.lanes|=e,mo|=e,n)}function Np(e,n,r,s,h){var g=M.p;M.p=g!==0&&8>g?g:8;var N=q.T,H={};q.T=H,Ci(e,!1,n,r);try{var te=h(),de=q.S;if(de!==null&&de(H,te),te!==null&&typeof te=="object"&&typeof te.then=="function"){var ye=Tv(te,s);xl(e,n,ye,$n(e))}else xl(e,n,s,$n(e))}catch(_e){xl(e,n,{then:function(){},status:"rejected",reason:_e},$n())}finally{M.p=g,N!==null&&H.types!==null&&(N.types=H.types),q.T=N}}function Lv(){}function xi(e,n,r,s){if(e.tag!==5)throw Error(i(476));var h=Rp(e).queue;Np(e,h,n,B,r===null?Lv:function(){return Tp(e),r(s)})}function Rp(e){var n=e.memoizedState;if(n!==null)return n;n={memoizedState:B,baseState:B,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Oa,lastRenderedState:B},next:null};var r={};return n.next={memoizedState:r,baseState:r,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Oa,lastRenderedState:r},next:null},e.memoizedState=n,e=e.alternate,e!==null&&(e.memoizedState=n),n}function Tp(e){var n=Rp(e);n.next===null&&(n=e.alternate.memoizedState),xl(e,n.next.queue,{},$n())}function wi(){return rn(Il)}function Ap(){return Mt().memoizedState}function Dp(){return Mt().memoizedState}function Iv(e){for(var n=e.return;n!==null;){switch(n.tag){case 24:case 3:var r=$n();e=co(r);var s=io(n,e,r);s!==null&&(Cn(s,n,r),ml(s,n,r)),n={cache:Xc()},e.payload=n;return}n=n.return}}function Uv(e,n,r){var s=$n();r={lane:s,revertLane:0,gesture:null,action:r,hasEagerState:!1,eagerState:null,next:null},Ds(e)?qp(n,r):(r=Pc(e,n,r,s),r!==null&&(Cn(r,e,s),$p(r,n,s)))}function Fp(e,n,r){var s=$n();xl(e,n,r,s)}function xl(e,n,r,s){var h={lane:s,revertLane:0,gesture:null,action:r,hasEagerState:!1,eagerState:null,next:null};if(Ds(e))qp(n,h);else{var g=e.alternate;if(e.lanes===0&&(g===null||g.lanes===0)&&(g=n.lastRenderedReducer,g!==null))try{var N=n.lastRenderedState,H=g(N,r);if(h.hasEagerState=!0,h.eagerState=H,Rn(H,N))return ps(e,n,h,0),Et===null&&us(),!1}catch{}finally{}if(r=Pc(e,n,h,s),r!==null)return Cn(r,e,s),$p(r,n,s),!0}return!1}function Ci(e,n,r,s){if(s={lane:2,revertLane:ed(),gesture:null,action:s,hasEagerState:!1,eagerState:null,next:null},Ds(e)){if(n)throw Error(i(479))}else n=Pc(e,r,s,2),n!==null&&Cn(n,e,2)}function Ds(e){var n=e.alternate;return e===Qe||n!==null&&n===Qe}function qp(e,n){Nr=Es=!0;var r=e.pending;r===null?n.next=n:(n.next=r.next,r.next=n),e.pending=n}function $p(e,n,r){if((r&4194048)!==0){var s=n.lanes;s&=e.pendingLanes,r|=s,n.lanes=r,ya(e,r)}}var wl={readContext:rn,use:Ns,useCallback:$t,useContext:$t,useEffect:$t,useImperativeHandle:$t,useLayoutEffect:$t,useInsertionEffect:$t,useMemo:$t,useReducer:$t,useRef:$t,useState:$t,useDebugValue:$t,useDeferredValue:$t,useTransition:$t,useSyncExternalStore:$t,useId:$t,useHostTransitionStatus:$t,useFormState:$t,useActionState:$t,useOptimistic:$t,useMemoCache:$t,useCacheRefresh:$t};wl.useEffectEvent=$t;var Lp={readContext:rn,use:Ns,useCallback:function(e,n){return mn().memoizedState=[e,n===void 0?null:n],e},useContext:rn,useEffect:_p,useImperativeHandle:function(e,n,r){r=r!=null?r.concat([e]):null,Ts(4194308,4,Sp.bind(null,n,e),r)},useLayoutEffect:function(e,n){return Ts(4194308,4,e,n)},useInsertionEffect:function(e,n){Ts(4,2,e,n)},useMemo:function(e,n){var r=mn();n=n===void 0?null:n;var s=e();if(Ko){Kt(!0);try{e()}finally{Kt(!1)}}return r.memoizedState=[s,n],s},useReducer:function(e,n,r){var s=mn();if(r!==void 0){var h=r(n);if(Ko){Kt(!0);try{r(n)}finally{Kt(!1)}}}else h=n;return s.memoizedState=s.baseState=h,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:h},s.queue=e,e=e.dispatch=Uv.bind(null,Qe,e),[s.memoizedState,e]},useRef:function(e){var n=mn();return e={current:e},n.memoizedState=e},useState:function(e){e=mi(e);var n=e.queue,r=Fp.bind(null,Qe,n);return n.dispatch=r,[e.memoizedState,r]},useDebugValue:vi,useDeferredValue:function(e,n){var r=mn();return _i(r,e,n)},useTransition:function(){var e=mi(!1);return e=Np.bind(null,Qe,e.queue,!0,!1),mn().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,n,r){var s=Qe,h=mn();if(it){if(r===void 0)throw Error(i(407));r=r()}else{if(r=n(),Et===null)throw Error(i(349));(st&127)!==0||ap(s,n,r)}h.memoizedState=r;var g={value:r,getSnapshot:n};return h.queue=g,_p(rp.bind(null,s,g,e),[e]),s.flags|=2048,Tr(9,{destroy:void 0},op.bind(null,s,g,r,n),null),r},useId:function(){var e=mn(),n=Et.identifierPrefix;if(it){var r=xa,s=_a;r=(s&~(1<<32-Ut(s)-1)).toString(32)+r,n="_"+n+"R_"+r,r=js++,0<r&&(n+="H"+r.toString(32)),n+="_"}else r=Av++,n="_"+n+"r_"+r.toString(32)+"_";return e.memoizedState=n},useHostTransitionStatus:wi,useFormState:hp,useActionState:hp,useOptimistic:function(e){var n=mn();n.memoizedState=n.baseState=e;var r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return n.queue=r,n=Ci.bind(null,Qe,!0,r),r.dispatch=n,[e,n]},useMemoCache:pi,useCacheRefresh:function(){return mn().memoizedState=Iv.bind(null,Qe)},useEffectEvent:function(e){var n=mn(),r={impl:e};return n.memoizedState=r,function(){if((yt&2)!==0)throw Error(i(440));return r.impl.apply(void 0,arguments)}}},Si={readContext:rn,use:Ns,useCallback:Ep,useContext:rn,useEffect:gi,useImperativeHandle:bp,useInsertionEffect:wp,useLayoutEffect:Cp,useMemo:jp,useReducer:Rs,useRef:vp,useState:function(){return Rs(Oa)},useDebugValue:vi,useDeferredValue:function(e,n){var r=Mt();return kp(r,wt.memoizedState,e,n)},useTransition:function(){var e=Rs(Oa)[0],n=Mt().memoizedState;return[typeof e=="boolean"?e:_l(e),n]},useSyncExternalStore:np,useId:Ap,useHostTransitionStatus:wi,useFormState:mp,useActionState:mp,useOptimistic:function(e,n){var r=Mt();return cp(r,wt,e,n)},useMemoCache:pi,useCacheRefresh:Dp};Si.useEffectEvent=xp;var Ip={readContext:rn,use:Ns,useCallback:Ep,useContext:rn,useEffect:gi,useImperativeHandle:bp,useInsertionEffect:wp,useLayoutEffect:Cp,useMemo:jp,useReducer:hi,useRef:vp,useState:function(){return hi(Oa)},useDebugValue:vi,useDeferredValue:function(e,n){var r=Mt();return wt===null?_i(r,e,n):kp(r,wt.memoizedState,e,n)},useTransition:function(){var e=hi(Oa)[0],n=Mt().memoizedState;return[typeof e=="boolean"?e:_l(e),n]},useSyncExternalStore:np,useId:Ap,useHostTransitionStatus:wi,useFormState:gp,useActionState:gp,useOptimistic:function(e,n){var r=Mt();return wt!==null?cp(r,wt,e,n):(r.baseState=e,[e,r.queue.dispatch])},useMemoCache:pi,useCacheRefresh:Dp};Ip.useEffectEvent=xp;function bi(e,n,r,s){n=e.memoizedState,r=r(s,n),r=r==null?n:v({},n,r),e.memoizedState=r,e.lanes===0&&(e.updateQueue.baseState=r)}var Ei={enqueueSetState:function(e,n,r){e=e._reactInternals;var s=$n(),h=co(s);h.payload=n,r!=null&&(h.callback=r),n=io(e,h,s),n!==null&&(Cn(n,e,s),ml(n,e,s))},enqueueReplaceState:function(e,n,r){e=e._reactInternals;var s=$n(),h=co(s);h.tag=1,h.payload=n,r!=null&&(h.callback=r),n=io(e,h,s),n!==null&&(Cn(n,e,s),ml(n,e,s))},enqueueForceUpdate:function(e,n){e=e._reactInternals;var r=$n(),s=co(r);s.tag=2,n!=null&&(s.callback=n),n=io(e,s,r),n!==null&&(Cn(n,e,r),ml(n,e,r))}};function Up(e,n,r,s,h,g,N){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(s,g,N):n.prototype&&n.prototype.isPureReactComponent?!sl(r,s)||!sl(h,g):!0}function Pp(e,n,r,s){e=n.state,typeof n.componentWillReceiveProps=="function"&&n.componentWillReceiveProps(r,s),typeof n.UNSAFE_componentWillReceiveProps=="function"&&n.UNSAFE_componentWillReceiveProps(r,s),n.state!==e&&Ei.enqueueReplaceState(n,n.state,null)}function Jo(e,n){var r=n;if("ref"in n){r={};for(var s in n)s!=="ref"&&(r[s]=n[s])}if(e=e.defaultProps){r===n&&(r=v({},r));for(var h in e)r[h]===void 0&&(r[h]=e[h])}return r}function Op(e){ds(e)}function Mp(e){console.error(e)}function Hp(e){ds(e)}function Fs(e,n){try{var r=e.onUncaughtError;r(n.value,{componentStack:n.stack})}catch(s){setTimeout(function(){throw s})}}function zp(e,n,r){try{var s=e.onCaughtError;s(r.value,{componentStack:r.stack,errorBoundary:n.tag===1?n.stateNode:null})}catch(h){setTimeout(function(){throw h})}}function ji(e,n,r){return r=co(r),r.tag=3,r.payload={element:null},r.callback=function(){Fs(e,n)},r}function Vp(e){return e=co(e),e.tag=3,e}function Bp(e,n,r,s){var h=r.type.getDerivedStateFromError;if(typeof h=="function"){var g=s.value;e.payload=function(){return h(g)},e.callback=function(){zp(n,r,s)}}var N=r.stateNode;N!==null&&typeof N.componentDidCatch=="function"&&(e.callback=function(){zp(n,r,s),typeof h!="function"&&(yo===null?yo=new Set([this]):yo.add(this));var H=s.stack;this.componentDidCatch(s.value,{componentStack:H!==null?H:""})})}function Pv(e,n,r,s,h){if(r.flags|=32768,s!==null&&typeof s=="object"&&typeof s.then=="function"){if(n=r.alternate,n!==null&&Cr(n,r,h,!0),r=An.current,r!==null){switch(r.tag){case 31:case 13:return Kn===null?Bs():r.alternate===null&&Lt===0&&(Lt=3),r.flags&=-257,r.flags|=65536,r.lanes=h,s===xs?r.flags|=16384:(n=r.updateQueue,n===null?r.updateQueue=new Set([s]):n.add(s),Zi(e,s,h)),!1;case 22:return r.flags|=65536,s===xs?r.flags|=16384:(n=r.updateQueue,n===null?(n={transitions:null,markerInstances:null,retryQueue:new Set([s])},r.updateQueue=n):(r=n.retryQueue,r===null?n.retryQueue=new Set([s]):r.add(s)),Zi(e,s,h)),!1}throw Error(i(435,r.tag))}return Zi(e,s,h),Bs(),!1}if(it)return n=An.current,n!==null?((n.flags&65536)===0&&(n.flags|=256),n.flags|=65536,n.lanes=h,s!==Bc&&(e=Error(i(422),{cause:s}),dl(Wn(e,r)))):(s!==Bc&&(n=Error(i(423),{cause:s}),dl(Wn(n,r))),e=e.current.alternate,e.flags|=65536,h&=-h,e.lanes|=h,s=Wn(s,r),h=ji(e.stateNode,s,h),ni(e,h),Lt!==4&&(Lt=2)),!1;var g=Error(i(520),{cause:s});if(g=Wn(g,r),Rl===null?Rl=[g]:Rl.push(g),Lt!==4&&(Lt=2),n===null)return!0;s=Wn(s,r),r=n;do{switch(r.tag){case 3:return r.flags|=65536,e=h&-h,r.lanes|=e,e=ji(r.stateNode,s,e),ni(r,e),!1;case 1:if(n=r.type,g=r.stateNode,(r.flags&128)===0&&(typeof n.getDerivedStateFromError=="function"||g!==null&&typeof g.componentDidCatch=="function"&&(yo===null||!yo.has(g))))return r.flags|=65536,h&=-h,r.lanes|=h,h=Vp(h),Bp(h,e,r,s),ni(r,h),!1}r=r.return}while(r!==null);return!1}var ki=Error(i(461)),Gt=!1;function ln(e,n,r,s){n.child=e===null?Qu(n,null,r,s):Zo(n,e.child,r,s)}function Yp(e,n,r,s,h){r=r.render;var g=n.ref;if("ref"in s){var N={};for(var H in s)H!=="ref"&&(N[H]=s[H])}else N=s;return Go(n),s=ci(e,n,r,N,g,h),H=ii(),e!==null&&!Gt?(di(e,n,h),Ma(e,n,h)):(it&&H&&zc(n),n.flags|=1,ln(e,n,s,h),n.child)}function Gp(e,n,r,s,h){if(e===null){var g=r.type;return typeof g=="function"&&!Oc(g)&&g.defaultProps===void 0&&r.compare===null?(n.tag=15,n.type=g,Wp(e,n,g,s,h)):(e=hs(r.type,null,s,n,n.mode,h),e.ref=n.ref,e.return=n,n.child=e)}if(g=e.child,!$i(e,h)){var N=g.memoizedProps;if(r=r.compare,r=r!==null?r:sl,r(N,s)&&e.ref===n.ref)return Ma(e,n,h)}return n.flags|=1,e=$a(g,s),e.ref=n.ref,e.return=n,n.child=e}function Wp(e,n,r,s,h){if(e!==null){var g=e.memoizedProps;if(sl(g,s)&&e.ref===n.ref)if(Gt=!1,n.pendingProps=s=g,$i(e,h))(e.flags&131072)!==0&&(Gt=!0);else return n.lanes=e.lanes,Ma(e,n,h)}return Ni(e,n,r,s,h)}function Qp(e,n,r,s){var h=s.children,g=e!==null?e.memoizedState:null;if(e===null&&n.stateNode===null&&(n.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),s.mode==="hidden"){if((n.flags&128)!==0){if(g=g!==null?g.baseLanes|r:r,e!==null){for(s=n.child=e.child,h=0;s!==null;)h=h|s.lanes|s.childLanes,s=s.sibling;s=h&~g}else s=0,n.child=null;return Xp(e,n,g,r,s)}if((r&536870912)!==0)n.memoizedState={baseLanes:0,cachePool:null},e!==null&&vs(n,g!==null?g.cachePool:null),g!==null?Ku(n,g):oi(),Ju(n);else return s=n.lanes=536870912,Xp(e,n,g!==null?g.baseLanes|r:r,r,s)}else g!==null?(vs(n,g.cachePool),Ku(n,g),po(),n.memoizedState=null):(e!==null&&vs(n,null),oi(),po());return ln(e,n,h,r),n.child}function Cl(e,n){return e!==null&&e.tag===22||n.stateNode!==null||(n.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),n.sibling}function Xp(e,n,r,s,h){var g=Kc();return g=g===null?null:{parent:Bt._currentValue,pool:g},n.memoizedState={baseLanes:r,cachePool:g},e!==null&&vs(n,null),oi(),Ju(n),e!==null&&Cr(e,n,s,!0),n.childLanes=h,null}function qs(e,n){return n=Ls({mode:n.mode,children:n.children},e.mode),n.ref=e.ref,e.child=n,n.return=e,n}function Zp(e,n,r){return Zo(n,e.child,null,r),e=qs(n,n.pendingProps),e.flags|=2,Dn(n),n.memoizedState=null,e}function Ov(e,n,r){var s=n.pendingProps,h=(n.flags&128)!==0;if(n.flags&=-129,e===null){if(it){if(s.mode==="hidden")return e=qs(n,s),n.lanes=536870912,Cl(null,e);if(li(n),(e=jt)?(e=dh(e,Zn),e=e!==null&&e.data==="&"?e:null,e!==null&&(n.memoizedState={dehydrated:e,treeContext:ao!==null?{id:_a,overflow:xa}:null,retryLane:536870912,hydrationErrors:null},r=qu(e),r.return=n,n.child=r,on=n,jt=null)):e=null,e===null)throw ro(n);return n.lanes=536870912,null}return qs(n,s)}var g=e.memoizedState;if(g!==null){var N=g.dehydrated;if(li(n),h)if(n.flags&256)n.flags&=-257,n=Zp(e,n,r);else if(n.memoizedState!==null)n.child=e.child,n.flags|=128,n=null;else throw Error(i(558));else if(Gt||Cr(e,n,r,!1),h=(r&e.childLanes)!==0,Gt||h){if(s=Et,s!==null&&(N=ga(s,r),N!==0&&N!==g.retryLane))throw g.retryLane=N,zo(e,N),Cn(s,e,N),ki;Bs(),n=Zp(e,n,r)}else e=g.treeContext,jt=Jn(N.nextSibling),on=n,it=!0,oo=null,Zn=!1,e!==null&&Iu(n,e),n=qs(n,s),n.flags|=4096;return n}return e=$a(e.child,{mode:s.mode,children:s.children}),e.ref=n.ref,n.child=e,e.return=n,e}function $s(e,n){var r=n.ref;if(r===null)e!==null&&e.ref!==null&&(n.flags|=4194816);else{if(typeof r!="function"&&typeof r!="object")throw Error(i(284));(e===null||e.ref!==r)&&(n.flags|=4194816)}}function Ni(e,n,r,s,h){return Go(n),r=ci(e,n,r,s,void 0,h),s=ii(),e!==null&&!Gt?(di(e,n,h),Ma(e,n,h)):(it&&s&&zc(n),n.flags|=1,ln(e,n,r,h),n.child)}function Kp(e,n,r,s,h,g){return Go(n),n.updateQueue=null,r=tp(n,s,r,h),ep(e),s=ii(),e!==null&&!Gt?(di(e,n,g),Ma(e,n,g)):(it&&s&&zc(n),n.flags|=1,ln(e,n,r,g),n.child)}function Jp(e,n,r,s,h){if(Go(n),n.stateNode===null){var g=vr,N=r.contextType;typeof N=="object"&&N!==null&&(g=rn(N)),g=new r(s,g),n.memoizedState=g.state!==null&&g.state!==void 0?g.state:null,g.updater=Ei,n.stateNode=g,g._reactInternals=n,g=n.stateNode,g.props=s,g.state=n.memoizedState,g.refs={},ei(n),N=r.contextType,g.context=typeof N=="object"&&N!==null?rn(N):vr,g.state=n.memoizedState,N=r.getDerivedStateFromProps,typeof N=="function"&&(bi(n,r,N,s),g.state=n.memoizedState),typeof r.getDerivedStateFromProps=="function"||typeof g.getSnapshotBeforeUpdate=="function"||typeof g.UNSAFE_componentWillMount!="function"&&typeof g.componentWillMount!="function"||(N=g.state,typeof g.componentWillMount=="function"&&g.componentWillMount(),typeof g.UNSAFE_componentWillMount=="function"&&g.UNSAFE_componentWillMount(),N!==g.state&&Ei.enqueueReplaceState(g,g.state,null),gl(n,s,g,h),yl(),g.state=n.memoizedState),typeof g.componentDidMount=="function"&&(n.flags|=4194308),s=!0}else if(e===null){g=n.stateNode;var H=n.memoizedProps,te=Jo(r,H);g.props=te;var de=g.context,ye=r.contextType;N=vr,typeof ye=="object"&&ye!==null&&(N=rn(ye));var _e=r.getDerivedStateFromProps;ye=typeof _e=="function"||typeof g.getSnapshotBeforeUpdate=="function",H=n.pendingProps!==H,ye||typeof g.UNSAFE_componentWillReceiveProps!="function"&&typeof g.componentWillReceiveProps!="function"||(H||de!==N)&&Pp(n,g,s,N),so=!1;var pe=n.memoizedState;g.state=pe,gl(n,s,g,h),yl(),de=n.memoizedState,H||pe!==de||so?(typeof _e=="function"&&(bi(n,r,_e,s),de=n.memoizedState),(te=so||Up(n,r,te,s,pe,de,N))?(ye||typeof g.UNSAFE_componentWillMount!="function"&&typeof g.componentWillMount!="function"||(typeof g.componentWillMount=="function"&&g.componentWillMount(),typeof g.UNSAFE_componentWillMount=="function"&&g.UNSAFE_componentWillMount()),typeof g.componentDidMount=="function"&&(n.flags|=4194308)):(typeof g.componentDidMount=="function"&&(n.flags|=4194308),n.memoizedProps=s,n.memoizedState=de),g.props=s,g.state=de,g.context=N,s=te):(typeof g.componentDidMount=="function"&&(n.flags|=4194308),s=!1)}else{g=n.stateNode,ti(e,n),N=n.memoizedProps,ye=Jo(r,N),g.props=ye,_e=n.pendingProps,pe=g.context,de=r.contextType,te=vr,typeof de=="object"&&de!==null&&(te=rn(de)),H=r.getDerivedStateFromProps,(de=typeof H=="function"||typeof g.getSnapshotBeforeUpdate=="function")||typeof g.UNSAFE_componentWillReceiveProps!="function"&&typeof g.componentWillReceiveProps!="function"||(N!==_e||pe!==te)&&Pp(n,g,s,te),so=!1,pe=n.memoizedState,g.state=pe,gl(n,s,g,h),yl();var he=n.memoizedState;N!==_e||pe!==he||so||e!==null&&e.dependencies!==null&&ys(e.dependencies)?(typeof H=="function"&&(bi(n,r,H,s),he=n.memoizedState),(ye=so||Up(n,r,ye,s,pe,he,te)||e!==null&&e.dependencies!==null&&ys(e.dependencies))?(de||typeof g.UNSAFE_componentWillUpdate!="function"&&typeof g.componentWillUpdate!="function"||(typeof g.componentWillUpdate=="function"&&g.componentWillUpdate(s,he,te),typeof g.UNSAFE_componentWillUpdate=="function"&&g.UNSAFE_componentWillUpdate(s,he,te)),typeof g.componentDidUpdate=="function"&&(n.flags|=4),typeof g.getSnapshotBeforeUpdate=="function"&&(n.flags|=1024)):(typeof g.componentDidUpdate!="function"||N===e.memoizedProps&&pe===e.memoizedState||(n.flags|=4),typeof g.getSnapshotBeforeUpdate!="function"||N===e.memoizedProps&&pe===e.memoizedState||(n.flags|=1024),n.memoizedProps=s,n.memoizedState=he),g.props=s,g.state=he,g.context=te,s=ye):(typeof g.componentDidUpdate!="function"||N===e.memoizedProps&&pe===e.memoizedState||(n.flags|=4),typeof g.getSnapshotBeforeUpdate!="function"||N===e.memoizedProps&&pe===e.memoizedState||(n.flags|=1024),s=!1)}return g=s,$s(e,n),s=(n.flags&128)!==0,g||s?(g=n.stateNode,r=s&&typeof r.getDerivedStateFromError!="function"?null:g.render(),n.flags|=1,e!==null&&s?(n.child=Zo(n,e.child,null,h),n.child=Zo(n,null,r,h)):ln(e,n,r,h),n.memoizedState=g.state,e=n.child):e=Ma(e,n,h),e}function ef(e,n,r,s){return Bo(),n.flags|=256,ln(e,n,r,s),n.child}var Ri={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Ti(e){return{baseLanes:e,cachePool:zu()}}function Ai(e,n,r){return e=e!==null?e.childLanes&~r:0,n&&(e|=qn),e}function tf(e,n,r){var s=n.pendingProps,h=!1,g=(n.flags&128)!==0,N;if((N=g)||(N=e!==null&&e.memoizedState===null?!1:(Ot.current&2)!==0),N&&(h=!0,n.flags&=-129),N=(n.flags&32)!==0,n.flags&=-33,e===null){if(it){if(h?uo(n):po(),(e=jt)?(e=dh(e,Zn),e=e!==null&&e.data!=="&"?e:null,e!==null&&(n.memoizedState={dehydrated:e,treeContext:ao!==null?{id:_a,overflow:xa}:null,retryLane:536870912,hydrationErrors:null},r=qu(e),r.return=n,n.child=r,on=n,jt=null)):e=null,e===null)throw ro(n);return fd(e)?n.lanes=32:n.lanes=536870912,null}var H=s.children;return s=s.fallback,h?(po(),h=n.mode,H=Ls({mode:"hidden",children:H},h),s=Vo(s,h,r,null),H.return=n,s.return=n,H.sibling=s,n.child=H,s=n.child,s.memoizedState=Ti(r),s.childLanes=Ai(e,N,r),n.memoizedState=Ri,Cl(null,s)):(uo(n),Di(n,H))}var te=e.memoizedState;if(te!==null&&(H=te.dehydrated,H!==null)){if(g)n.flags&256?(uo(n),n.flags&=-257,n=Fi(e,n,r)):n.memoizedState!==null?(po(),n.child=e.child,n.flags|=128,n=null):(po(),H=s.fallback,h=n.mode,s=Ls({mode:"visible",children:s.children},h),H=Vo(H,h,r,null),H.flags|=2,s.return=n,H.return=n,s.sibling=H,n.child=s,Zo(n,e.child,null,r),s=n.child,s.memoizedState=Ti(r),s.childLanes=Ai(e,N,r),n.memoizedState=Ri,n=Cl(null,s));else if(uo(n),fd(H)){if(N=H.nextSibling&&H.nextSibling.dataset,N)var de=N.dgst;N=de,s=Error(i(419)),s.stack="",s.digest=N,dl({value:s,source:null,stack:null}),n=Fi(e,n,r)}else if(Gt||Cr(e,n,r,!1),N=(r&e.childLanes)!==0,Gt||N){if(N=Et,N!==null&&(s=ga(N,r),s!==0&&s!==te.retryLane))throw te.retryLane=s,zo(e,s),Cn(N,e,s),ki;pd(H)||Bs(),n=Fi(e,n,r)}else pd(H)?(n.flags|=192,n.child=e.child,n=null):(e=te.treeContext,jt=Jn(H.nextSibling),on=n,it=!0,oo=null,Zn=!1,e!==null&&Iu(n,e),n=Di(n,s.children),n.flags|=4096);return n}return h?(po(),H=s.fallback,h=n.mode,te=e.child,de=te.sibling,s=$a(te,{mode:"hidden",children:s.children}),s.subtreeFlags=te.subtreeFlags&65011712,de!==null?H=$a(de,H):(H=Vo(H,h,r,null),H.flags|=2),H.return=n,s.return=n,s.sibling=H,n.child=s,Cl(null,s),s=n.child,H=e.child.memoizedState,H===null?H=Ti(r):(h=H.cachePool,h!==null?(te=Bt._currentValue,h=h.parent!==te?{parent:te,pool:te}:h):h=zu(),H={baseLanes:H.baseLanes|r,cachePool:h}),s.memoizedState=H,s.childLanes=Ai(e,N,r),n.memoizedState=Ri,Cl(e.child,s)):(uo(n),r=e.child,e=r.sibling,r=$a(r,{mode:"visible",children:s.children}),r.return=n,r.sibling=null,e!==null&&(N=n.deletions,N===null?(n.deletions=[e],n.flags|=16):N.push(e)),n.child=r,n.memoizedState=null,r)}function Di(e,n){return n=Ls({mode:"visible",children:n},e.mode),n.return=e,e.child=n}function Ls(e,n){return e=Tn(22,e,null,n),e.lanes=0,e}function Fi(e,n,r){return Zo(n,e.child,null,r),e=Di(n,n.pendingProps.children),e.flags|=2,n.memoizedState=null,e}function nf(e,n,r){e.lanes|=n;var s=e.alternate;s!==null&&(s.lanes|=n),Wc(e.return,n,r)}function qi(e,n,r,s,h,g){var N=e.memoizedState;N===null?e.memoizedState={isBackwards:n,rendering:null,renderingStartTime:0,last:s,tail:r,tailMode:h,treeForkCount:g}:(N.isBackwards=n,N.rendering=null,N.renderingStartTime=0,N.last=s,N.tail=r,N.tailMode=h,N.treeForkCount=g)}function af(e,n,r){var s=n.pendingProps,h=s.revealOrder,g=s.tail;s=s.children;var N=Ot.current,H=(N&2)!==0;if(H?(N=N&1|2,n.flags|=128):N&=1,ae(Ot,N),ln(e,n,s,r),s=it?il:0,!H&&e!==null&&(e.flags&128)!==0)e:for(e=n.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&nf(e,r,n);else if(e.tag===19)nf(e,r,n);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break e;for(;e.sibling===null;){if(e.return===null||e.return===n)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}switch(h){case"forwards":for(r=n.child,h=null;r!==null;)e=r.alternate,e!==null&&bs(e)===null&&(h=r),r=r.sibling;r=h,r===null?(h=n.child,n.child=null):(h=r.sibling,r.sibling=null),qi(n,!1,h,r,g,s);break;case"backwards":case"unstable_legacy-backwards":for(r=null,h=n.child,n.child=null;h!==null;){if(e=h.alternate,e!==null&&bs(e)===null){n.child=h;break}e=h.sibling,h.sibling=r,r=h,h=e}qi(n,!0,r,null,g,s);break;case"together":qi(n,!1,null,null,void 0,s);break;default:n.memoizedState=null}return n.child}function Ma(e,n,r){if(e!==null&&(n.dependencies=e.dependencies),mo|=n.lanes,(r&n.childLanes)===0)if(e!==null){if(Cr(e,n,r,!1),(r&n.childLanes)===0)return null}else return null;if(e!==null&&n.child!==e.child)throw Error(i(153));if(n.child!==null){for(e=n.child,r=$a(e,e.pendingProps),n.child=r,r.return=n;e.sibling!==null;)e=e.sibling,r=r.sibling=$a(e,e.pendingProps),r.return=n;r.sibling=null}return n.child}function $i(e,n){return(e.lanes&n)!==0?!0:(e=e.dependencies,!!(e!==null&&ys(e)))}function Mv(e,n,r){switch(n.tag){case 3:ee(n,n.stateNode.containerInfo),lo(n,Bt,e.memoizedState.cache),Bo();break;case 27:case 5:le(n);break;case 4:ee(n,n.stateNode.containerInfo);break;case 10:lo(n,n.type,n.memoizedProps.value);break;case 31:if(n.memoizedState!==null)return n.flags|=128,li(n),null;break;case 13:var s=n.memoizedState;if(s!==null)return s.dehydrated!==null?(uo(n),n.flags|=128,null):(r&n.child.childLanes)!==0?tf(e,n,r):(uo(n),e=Ma(e,n,r),e!==null?e.sibling:null);uo(n);break;case 19:var h=(e.flags&128)!==0;if(s=(r&n.childLanes)!==0,s||(Cr(e,n,r,!1),s=(r&n.childLanes)!==0),h){if(s)return af(e,n,r);n.flags|=128}if(h=n.memoizedState,h!==null&&(h.rendering=null,h.tail=null,h.lastEffect=null),ae(Ot,Ot.current),s)break;return null;case 22:return n.lanes=0,Qp(e,n,r,n.pendingProps);case 24:lo(n,Bt,e.memoizedState.cache)}return Ma(e,n,r)}function of(e,n,r){if(e!==null)if(e.memoizedProps!==n.pendingProps)Gt=!0;else{if(!$i(e,r)&&(n.flags&128)===0)return Gt=!1,Mv(e,n,r);Gt=(e.flags&131072)!==0}else Gt=!1,it&&(n.flags&1048576)!==0&&Lu(n,il,n.index);switch(n.lanes=0,n.tag){case 16:e:{var s=n.pendingProps;if(e=Qo(n.elementType),n.type=e,typeof e=="function")Oc(e)?(s=Jo(e,s),n.tag=1,n=Jp(null,n,e,s,r)):(n.tag=0,n=Ni(null,n,e,s,r));else{if(e!=null){var h=e.$$typeof;if(h===F){n.tag=11,n=Yp(null,n,e,s,r);break e}else if(h===T){n.tag=14,n=Gp(null,n,e,s,r);break e}}throw n=I(e)||e,Error(i(306,n,""))}}return n;case 0:return Ni(e,n,n.type,n.pendingProps,r);case 1:return s=n.type,h=Jo(s,n.pendingProps),Jp(e,n,s,h,r);case 3:e:{if(ee(n,n.stateNode.containerInfo),e===null)throw Error(i(387));s=n.pendingProps;var g=n.memoizedState;h=g.element,ti(e,n),gl(n,s,null,r);var N=n.memoizedState;if(s=N.cache,lo(n,Bt,s),s!==g.cache&&Qc(n,[Bt],r,!0),yl(),s=N.element,g.isDehydrated)if(g={element:s,isDehydrated:!1,cache:N.cache},n.updateQueue.baseState=g,n.memoizedState=g,n.flags&256){n=ef(e,n,s,r);break e}else if(s!==h){h=Wn(Error(i(424)),n),dl(h),n=ef(e,n,s,r);break e}else{switch(e=n.stateNode.containerInfo,e.nodeType){case 9:e=e.body;break;default:e=e.nodeName==="HTML"?e.ownerDocument.body:e}for(jt=Jn(e.firstChild),on=n,it=!0,oo=null,Zn=!0,r=Qu(n,null,s,r),n.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling}else{if(Bo(),s===h){n=Ma(e,n,r);break e}ln(e,n,s,r)}n=n.child}return n;case 26:return $s(e,n),e===null?(r=yh(n.type,null,n.pendingProps,null))?n.memoizedState=r:it||(r=n.type,e=n.pendingProps,s=Ks(ue.current).createElement(r),s[Ae]=n,s[Te]=e,sn(s,r,e),Tt(s),n.stateNode=s):n.memoizedState=yh(n.type,e.memoizedProps,n.pendingProps,e.memoizedState),null;case 27:return le(n),e===null&&it&&(s=n.stateNode=fh(n.type,n.pendingProps,ue.current),on=n,Zn=!0,h=jt,xo(n.type)?(hd=h,jt=Jn(s.firstChild)):jt=h),ln(e,n,n.pendingProps.children,r),$s(e,n),e===null&&(n.flags|=4194304),n.child;case 5:return e===null&&it&&((h=s=jt)&&(s=g_(s,n.type,n.pendingProps,Zn),s!==null?(n.stateNode=s,on=n,jt=Jn(s.firstChild),Zn=!1,h=!0):h=!1),h||ro(n)),le(n),h=n.type,g=n.pendingProps,N=e!==null?e.memoizedProps:null,s=g.children,id(h,g)?s=null:N!==null&&id(h,N)&&(n.flags|=32),n.memoizedState!==null&&(h=ci(e,n,Dv,null,null,r),Il._currentValue=h),$s(e,n),ln(e,n,s,r),n.child;case 6:return e===null&&it&&((e=r=jt)&&(r=v_(r,n.pendingProps,Zn),r!==null?(n.stateNode=r,on=n,jt=null,e=!0):e=!1),e||ro(n)),null;case 13:return tf(e,n,r);case 4:return ee(n,n.stateNode.containerInfo),s=n.pendingProps,e===null?n.child=Zo(n,null,s,r):ln(e,n,s,r),n.child;case 11:return Yp(e,n,n.type,n.pendingProps,r);case 7:return ln(e,n,n.pendingProps,r),n.child;case 8:return ln(e,n,n.pendingProps.children,r),n.child;case 12:return ln(e,n,n.pendingProps.children,r),n.child;case 10:return s=n.pendingProps,lo(n,n.type,s.value),ln(e,n,s.children,r),n.child;case 9:return h=n.type._context,s=n.pendingProps.children,Go(n),h=rn(h),s=s(h),n.flags|=1,ln(e,n,s,r),n.child;case 14:return Gp(e,n,n.type,n.pendingProps,r);case 15:return Wp(e,n,n.type,n.pendingProps,r);case 19:return af(e,n,r);case 31:return Ov(e,n,r);case 22:return Qp(e,n,r,n.pendingProps);case 24:return Go(n),s=rn(Bt),e===null?(h=Kc(),h===null&&(h=Et,g=Xc(),h.pooledCache=g,g.refCount++,g!==null&&(h.pooledCacheLanes|=r),h=g),n.memoizedState={parent:s,cache:h},ei(n),lo(n,Bt,h)):((e.lanes&r)!==0&&(ti(e,n),gl(n,null,null,r),yl()),h=e.memoizedState,g=n.memoizedState,h.parent!==s?(h={parent:s,cache:s},n.memoizedState=h,n.lanes===0&&(n.memoizedState=n.updateQueue.baseState=h),lo(n,Bt,s)):(s=g.cache,lo(n,Bt,s),s!==h.cache&&Qc(n,[Bt],r,!0))),ln(e,n,n.pendingProps.children,r),n.child;case 29:throw n.pendingProps}throw Error(i(156,n.tag))}function Ha(e){e.flags|=4}function Li(e,n,r,s,h){if((n=(e.mode&32)!==0)&&(n=!1),n){if(e.flags|=16777216,(h&335544128)===h)if(e.stateNode.complete)e.flags|=8192;else if(Df())e.flags|=8192;else throw Xo=xs,Jc}else e.flags&=-16777217}function rf(e,n){if(n.type!=="stylesheet"||(n.state.loading&4)!==0)e.flags&=-16777217;else if(e.flags|=16777216,!wh(n))if(Df())e.flags|=8192;else throw Xo=xs,Jc}function Is(e,n){n!==null&&(e.flags|=4),e.flags&16384&&(n=e.tag!==22?oa():536870912,e.lanes|=n,qr|=n)}function Sl(e,n){if(!it)switch(e.tailMode){case"hidden":n=e.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e.tail=null:r.sibling=null;break;case"collapsed":r=e.tail;for(var s=null;r!==null;)r.alternate!==null&&(s=r),r=r.sibling;s===null?n||e.tail===null?e.tail=null:e.tail.sibling=null:s.sibling=null}}function kt(e){var n=e.alternate!==null&&e.alternate.child===e.child,r=0,s=0;if(n)for(var h=e.child;h!==null;)r|=h.lanes|h.childLanes,s|=h.subtreeFlags&65011712,s|=h.flags&65011712,h.return=e,h=h.sibling;else for(h=e.child;h!==null;)r|=h.lanes|h.childLanes,s|=h.subtreeFlags,s|=h.flags,h.return=e,h=h.sibling;return e.subtreeFlags|=s,e.childLanes=r,n}function Hv(e,n,r){var s=n.pendingProps;switch(Vc(n),n.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return kt(n),null;case 1:return kt(n),null;case 3:return r=n.stateNode,s=null,e!==null&&(s=e.memoizedState.cache),n.memoizedState.cache!==s&&(n.flags|=2048),Ua(Bt),X(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(e===null||e.child===null)&&(wr(n)?Ha(n):e===null||e.memoizedState.isDehydrated&&(n.flags&256)===0||(n.flags|=1024,Yc())),kt(n),null;case 26:var h=n.type,g=n.memoizedState;return e===null?(Ha(n),g!==null?(kt(n),rf(n,g)):(kt(n),Li(n,h,null,s,r))):g?g!==e.memoizedState?(Ha(n),kt(n),rf(n,g)):(kt(n),n.flags&=-16777217):(e=e.memoizedProps,e!==s&&Ha(n),kt(n),Li(n,h,e,s,r)),null;case 27:if(J(n),r=ue.current,h=n.type,e!==null&&n.stateNode!=null)e.memoizedProps!==s&&Ha(n);else{if(!s){if(n.stateNode===null)throw Error(i(166));return kt(n),null}e=Y.current,wr(n)?Uu(n):(e=fh(h,s,r),n.stateNode=e,Ha(n))}return kt(n),null;case 5:if(J(n),h=n.type,e!==null&&n.stateNode!=null)e.memoizedProps!==s&&Ha(n);else{if(!s){if(n.stateNode===null)throw Error(i(166));return kt(n),null}if(g=Y.current,wr(n))Uu(n);else{var N=Ks(ue.current);switch(g){case 1:g=N.createElementNS("http://www.w3.org/2000/svg",h);break;case 2:g=N.createElementNS("http://www.w3.org/1998/Math/MathML",h);break;default:switch(h){case"svg":g=N.createElementNS("http://www.w3.org/2000/svg",h);break;case"math":g=N.createElementNS("http://www.w3.org/1998/Math/MathML",h);break;case"script":g=N.createElement("div"),g.innerHTML="<script><\/script>",g=g.removeChild(g.firstChild);break;case"select":g=typeof s.is=="string"?N.createElement("select",{is:s.is}):N.createElement("select"),s.multiple?g.multiple=!0:s.size&&(g.size=s.size);break;default:g=typeof s.is=="string"?N.createElement(h,{is:s.is}):N.createElement(h)}}g[Ae]=n,g[Te]=s;e:for(N=n.child;N!==null;){if(N.tag===5||N.tag===6)g.appendChild(N.stateNode);else if(N.tag!==4&&N.tag!==27&&N.child!==null){N.child.return=N,N=N.child;continue}if(N===n)break e;for(;N.sibling===null;){if(N.return===null||N.return===n)break e;N=N.return}N.sibling.return=N.return,N=N.sibling}n.stateNode=g;e:switch(sn(g,h,s),h){case"button":case"input":case"select":case"textarea":s=!!s.autoFocus;break e;case"img":s=!0;break e;default:s=!1}s&&Ha(n)}}return kt(n),Li(n,n.type,e===null?null:e.memoizedProps,n.pendingProps,r),null;case 6:if(e&&n.stateNode!=null)e.memoizedProps!==s&&Ha(n);else{if(typeof s!="string"&&n.stateNode===null)throw Error(i(166));if(e=ue.current,wr(n)){if(e=n.stateNode,r=n.memoizedProps,s=null,h=on,h!==null)switch(h.tag){case 27:case 5:s=h.memoizedProps}e[Ae]=n,e=!!(e.nodeValue===r||s!==null&&s.suppressHydrationWarning===!0||nh(e.nodeValue,r)),e||ro(n,!0)}else e=Ks(e).createTextNode(s),e[Ae]=n,n.stateNode=e}return kt(n),null;case 31:if(r=n.memoizedState,e===null||e.memoizedState!==null){if(s=wr(n),r!==null){if(e===null){if(!s)throw Error(i(318));if(e=n.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(i(557));e[Ae]=n}else Bo(),(n.flags&128)===0&&(n.memoizedState=null),n.flags|=4;kt(n),e=!1}else r=Yc(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=r),e=!0;if(!e)return n.flags&256?(Dn(n),n):(Dn(n),null);if((n.flags&128)!==0)throw Error(i(558))}return kt(n),null;case 13:if(s=n.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(h=wr(n),s!==null&&s.dehydrated!==null){if(e===null){if(!h)throw Error(i(318));if(h=n.memoizedState,h=h!==null?h.dehydrated:null,!h)throw Error(i(317));h[Ae]=n}else Bo(),(n.flags&128)===0&&(n.memoizedState=null),n.flags|=4;kt(n),h=!1}else h=Yc(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=h),h=!0;if(!h)return n.flags&256?(Dn(n),n):(Dn(n),null)}return Dn(n),(n.flags&128)!==0?(n.lanes=r,n):(r=s!==null,e=e!==null&&e.memoizedState!==null,r&&(s=n.child,h=null,s.alternate!==null&&s.alternate.memoizedState!==null&&s.alternate.memoizedState.cachePool!==null&&(h=s.alternate.memoizedState.cachePool.pool),g=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(g=s.memoizedState.cachePool.pool),g!==h&&(s.flags|=2048)),r!==e&&r&&(n.child.flags|=8192),Is(n,n.updateQueue),kt(n),null);case 4:return X(),e===null&&od(n.stateNode.containerInfo),kt(n),null;case 10:return Ua(n.type),kt(n),null;case 19:if(Q(Ot),s=n.memoizedState,s===null)return kt(n),null;if(h=(n.flags&128)!==0,g=s.rendering,g===null)if(h)Sl(s,!1);else{if(Lt!==0||e!==null&&(e.flags&128)!==0)for(e=n.child;e!==null;){if(g=bs(e),g!==null){for(n.flags|=128,Sl(s,!1),e=g.updateQueue,n.updateQueue=e,Is(n,e),n.subtreeFlags=0,e=r,r=n.child;r!==null;)Fu(r,e),r=r.sibling;return ae(Ot,Ot.current&1|2),it&&La(n,s.treeForkCount),n.child}e=e.sibling}s.tail!==null&&Oe()>Hs&&(n.flags|=128,h=!0,Sl(s,!1),n.lanes=4194304)}else{if(!h)if(e=bs(g),e!==null){if(n.flags|=128,h=!0,e=e.updateQueue,n.updateQueue=e,Is(n,e),Sl(s,!0),s.tail===null&&s.tailMode==="hidden"&&!g.alternate&&!it)return kt(n),null}else 2*Oe()-s.renderingStartTime>Hs&&r!==536870912&&(n.flags|=128,h=!0,Sl(s,!1),n.lanes=4194304);s.isBackwards?(g.sibling=n.child,n.child=g):(e=s.last,e!==null?e.sibling=g:n.child=g,s.last=g)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=Oe(),e.sibling=null,r=Ot.current,ae(Ot,h?r&1|2:r&1),it&&La(n,s.treeForkCount),e):(kt(n),null);case 22:case 23:return Dn(n),ri(),s=n.memoizedState!==null,e!==null?e.memoizedState!==null!==s&&(n.flags|=8192):s&&(n.flags|=8192),s?(r&536870912)!==0&&(n.flags&128)===0&&(kt(n),n.subtreeFlags&6&&(n.flags|=8192)):kt(n),r=n.updateQueue,r!==null&&Is(n,r.retryQueue),r=null,e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(r=e.memoizedState.cachePool.pool),s=null,n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(s=n.memoizedState.cachePool.pool),s!==r&&(n.flags|=2048),e!==null&&Q(Wo),null;case 24:return r=null,e!==null&&(r=e.memoizedState.cache),n.memoizedState.cache!==r&&(n.flags|=2048),Ua(Bt),kt(n),null;case 25:return null;case 30:return null}throw Error(i(156,n.tag))}function zv(e,n){switch(Vc(n),n.tag){case 1:return e=n.flags,e&65536?(n.flags=e&-65537|128,n):null;case 3:return Ua(Bt),X(),e=n.flags,(e&65536)!==0&&(e&128)===0?(n.flags=e&-65537|128,n):null;case 26:case 27:case 5:return J(n),null;case 31:if(n.memoizedState!==null){if(Dn(n),n.alternate===null)throw Error(i(340));Bo()}return e=n.flags,e&65536?(n.flags=e&-65537|128,n):null;case 13:if(Dn(n),e=n.memoizedState,e!==null&&e.dehydrated!==null){if(n.alternate===null)throw Error(i(340));Bo()}return e=n.flags,e&65536?(n.flags=e&-65537|128,n):null;case 19:return Q(Ot),null;case 4:return X(),null;case 10:return Ua(n.type),null;case 22:case 23:return Dn(n),ri(),e!==null&&Q(Wo),e=n.flags,e&65536?(n.flags=e&-65537|128,n):null;case 24:return Ua(Bt),null;case 25:return null;default:return null}}function lf(e,n){switch(Vc(n),n.tag){case 3:Ua(Bt),X();break;case 26:case 27:case 5:J(n);break;case 4:X();break;case 31:n.memoizedState!==null&&Dn(n);break;case 13:Dn(n);break;case 19:Q(Ot);break;case 10:Ua(n.type);break;case 22:case 23:Dn(n),ri(),e!==null&&Q(Wo);break;case 24:Ua(Bt)}}function bl(e,n){try{var r=n.updateQueue,s=r!==null?r.lastEffect:null;if(s!==null){var h=s.next;r=h;do{if((r.tag&e)===e){s=void 0;var g=r.create,N=r.inst;s=g(),N.destroy=s}r=r.next}while(r!==h)}}catch(H){vt(n,n.return,H)}}function fo(e,n,r){try{var s=n.updateQueue,h=s!==null?s.lastEffect:null;if(h!==null){var g=h.next;s=g;do{if((s.tag&e)===e){var N=s.inst,H=N.destroy;if(H!==void 0){N.destroy=void 0,h=n;var te=r,de=H;try{de()}catch(ye){vt(h,te,ye)}}}s=s.next}while(s!==g)}}catch(ye){vt(n,n.return,ye)}}function sf(e){var n=e.updateQueue;if(n!==null){var r=e.stateNode;try{Zu(n,r)}catch(s){vt(e,e.return,s)}}}function cf(e,n,r){r.props=Jo(e.type,e.memoizedProps),r.state=e.memoizedState;try{r.componentWillUnmount()}catch(s){vt(e,n,s)}}function El(e,n){try{var r=e.ref;if(r!==null){switch(e.tag){case 26:case 27:case 5:var s=e.stateNode;break;case 30:s=e.stateNode;break;default:s=e.stateNode}typeof r=="function"?e.refCleanup=r(s):r.current=s}}catch(h){vt(e,n,h)}}function wa(e,n){var r=e.ref,s=e.refCleanup;if(r!==null)if(typeof s=="function")try{s()}catch(h){vt(e,n,h)}finally{e.refCleanup=null,e=e.alternate,e!=null&&(e.refCleanup=null)}else if(typeof r=="function")try{r(null)}catch(h){vt(e,n,h)}else r.current=null}function df(e){var n=e.type,r=e.memoizedProps,s=e.stateNode;try{e:switch(n){case"button":case"input":case"select":case"textarea":r.autoFocus&&s.focus();break e;case"img":r.src?s.src=r.src:r.srcSet&&(s.srcset=r.srcSet)}}catch(h){vt(e,e.return,h)}}function Ii(e,n,r){try{var s=e.stateNode;u_(s,e.type,r,n),s[Te]=n}catch(h){vt(e,e.return,h)}}function uf(e){return e.tag===5||e.tag===3||e.tag===26||e.tag===27&&xo(e.type)||e.tag===4}function Ui(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||uf(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.tag===27&&xo(e.type)||e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Pi(e,n,r){var s=e.tag;if(s===5||s===6)e=e.stateNode,n?(r.nodeType===9?r.body:r.nodeName==="HTML"?r.ownerDocument.body:r).insertBefore(e,n):(n=r.nodeType===9?r.body:r.nodeName==="HTML"?r.ownerDocument.body:r,n.appendChild(e),r=r._reactRootContainer,r!=null||n.onclick!==null||(n.onclick=Bn));else if(s!==4&&(s===27&&xo(e.type)&&(r=e.stateNode,n=null),e=e.child,e!==null))for(Pi(e,n,r),e=e.sibling;e!==null;)Pi(e,n,r),e=e.sibling}function Us(e,n,r){var s=e.tag;if(s===5||s===6)e=e.stateNode,n?r.insertBefore(e,n):r.appendChild(e);else if(s!==4&&(s===27&&xo(e.type)&&(r=e.stateNode),e=e.child,e!==null))for(Us(e,n,r),e=e.sibling;e!==null;)Us(e,n,r),e=e.sibling}function pf(e){var n=e.stateNode,r=e.memoizedProps;try{for(var s=e.type,h=n.attributes;h.length;)n.removeAttributeNode(h[0]);sn(n,s,r),n[Ae]=e,n[Te]=r}catch(g){vt(e,e.return,g)}}var za=!1,Wt=!1,Oi=!1,ff=typeof WeakSet=="function"?WeakSet:Set,en=null;function Vv(e,n){if(e=e.containerInfo,sd=rc,e=bu(e),Fc(e)){if("selectionStart"in e)var r={start:e.selectionStart,end:e.selectionEnd};else e:{r=(r=e.ownerDocument)&&r.defaultView||window;var s=r.getSelection&&r.getSelection();if(s&&s.rangeCount!==0){r=s.anchorNode;var h=s.anchorOffset,g=s.focusNode;s=s.focusOffset;try{r.nodeType,g.nodeType}catch{r=null;break e}var N=0,H=-1,te=-1,de=0,ye=0,_e=e,pe=null;t:for(;;){for(var he;_e!==r||h!==0&&_e.nodeType!==3||(H=N+h),_e!==g||s!==0&&_e.nodeType!==3||(te=N+s),_e.nodeType===3&&(N+=_e.nodeValue.length),(he=_e.firstChild)!==null;)pe=_e,_e=he;for(;;){if(_e===e)break t;if(pe===r&&++de===h&&(H=N),pe===g&&++ye===s&&(te=N),(he=_e.nextSibling)!==null)break;_e=pe,pe=_e.parentNode}_e=he}r=H===-1||te===-1?null:{start:H,end:te}}else r=null}r=r||{start:0,end:0}}else r=null;for(cd={focusedElem:e,selectionRange:r},rc=!1,en=n;en!==null;)if(n=en,e=n.child,(n.subtreeFlags&1028)!==0&&e!==null)e.return=n,en=e;else for(;en!==null;){switch(n=en,g=n.alternate,e=n.flags,n.tag){case 0:if((e&4)!==0&&(e=n.updateQueue,e=e!==null?e.events:null,e!==null))for(r=0;r<e.length;r++)h=e[r],h.ref.impl=h.nextImpl;break;case 11:case 15:break;case 1:if((e&1024)!==0&&g!==null){e=void 0,r=n,h=g.memoizedProps,g=g.memoizedState,s=r.stateNode;try{var $e=Jo(r.type,h);e=s.getSnapshotBeforeUpdate($e,g),s.__reactInternalSnapshotBeforeUpdate=e}catch(ze){vt(r,r.return,ze)}}break;case 3:if((e&1024)!==0){if(e=n.stateNode.containerInfo,r=e.nodeType,r===9)ud(e);else if(r===1)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":ud(e);break;default:e.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((e&1024)!==0)throw Error(i(163))}if(e=n.sibling,e!==null){e.return=n.return,en=e;break}en=n.return}}function hf(e,n,r){var s=r.flags;switch(r.tag){case 0:case 11:case 15:Ba(e,r),s&4&&bl(5,r);break;case 1:if(Ba(e,r),s&4)if(e=r.stateNode,n===null)try{e.componentDidMount()}catch(N){vt(r,r.return,N)}else{var h=Jo(r.type,n.memoizedProps);n=n.memoizedState;try{e.componentDidUpdate(h,n,e.__reactInternalSnapshotBeforeUpdate)}catch(N){vt(r,r.return,N)}}s&64&&sf(r),s&512&&El(r,r.return);break;case 3:if(Ba(e,r),s&64&&(e=r.updateQueue,e!==null)){if(n=null,r.child!==null)switch(r.child.tag){case 27:case 5:n=r.child.stateNode;break;case 1:n=r.child.stateNode}try{Zu(e,n)}catch(N){vt(r,r.return,N)}}break;case 27:n===null&&s&4&&pf(r);case 26:case 5:Ba(e,r),n===null&&s&4&&df(r),s&512&&El(r,r.return);break;case 12:Ba(e,r);break;case 31:Ba(e,r),s&4&&gf(e,r);break;case 13:Ba(e,r),s&4&&vf(e,r),s&64&&(e=r.memoizedState,e!==null&&(e=e.dehydrated,e!==null&&(r=Jv.bind(null,r),__(e,r))));break;case 22:if(s=r.memoizedState!==null||za,!s){n=n!==null&&n.memoizedState!==null||Wt,h=za;var g=Wt;za=s,(Wt=n)&&!g?Ya(e,r,(r.subtreeFlags&8772)!==0):Ba(e,r),za=h,Wt=g}break;case 30:break;default:Ba(e,r)}}function mf(e){var n=e.alternate;n!==null&&(e.alternate=null,mf(n)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(n=e.stateNode,n!==null&&la(n)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var Dt=null,vn=!1;function Va(e,n,r){for(r=r.child;r!==null;)yf(e,n,r),r=r.sibling}function yf(e,n,r){if(Ft&&typeof Ft.onCommitFiberUnmount=="function")try{Ft.onCommitFiberUnmount(yn,r)}catch{}switch(r.tag){case 26:Wt||wa(r,n),Va(e,n,r),r.memoizedState?r.memoizedState.count--:r.stateNode&&(r=r.stateNode,r.parentNode.removeChild(r));break;case 27:Wt||wa(r,n);var s=Dt,h=vn;xo(r.type)&&(Dt=r.stateNode,vn=!1),Va(e,n,r),ql(r.stateNode),Dt=s,vn=h;break;case 5:Wt||wa(r,n);case 6:if(s=Dt,h=vn,Dt=null,Va(e,n,r),Dt=s,vn=h,Dt!==null)if(vn)try{(Dt.nodeType===9?Dt.body:Dt.nodeName==="HTML"?Dt.ownerDocument.body:Dt).removeChild(r.stateNode)}catch(g){vt(r,n,g)}else try{Dt.removeChild(r.stateNode)}catch(g){vt(r,n,g)}break;case 18:Dt!==null&&(vn?(e=Dt,ch(e.nodeType===9?e.body:e.nodeName==="HTML"?e.ownerDocument.body:e,r.stateNode),Hr(e)):ch(Dt,r.stateNode));break;case 4:s=Dt,h=vn,Dt=r.stateNode.containerInfo,vn=!0,Va(e,n,r),Dt=s,vn=h;break;case 0:case 11:case 14:case 15:fo(2,r,n),Wt||fo(4,r,n),Va(e,n,r);break;case 1:Wt||(wa(r,n),s=r.stateNode,typeof s.componentWillUnmount=="function"&&cf(r,n,s)),Va(e,n,r);break;case 21:Va(e,n,r);break;case 22:Wt=(s=Wt)||r.memoizedState!==null,Va(e,n,r),Wt=s;break;default:Va(e,n,r)}}function gf(e,n){if(n.memoizedState===null&&(e=n.alternate,e!==null&&(e=e.memoizedState,e!==null))){e=e.dehydrated;try{Hr(e)}catch(r){vt(n,n.return,r)}}}function vf(e,n){if(n.memoizedState===null&&(e=n.alternate,e!==null&&(e=e.memoizedState,e!==null&&(e=e.dehydrated,e!==null))))try{Hr(e)}catch(r){vt(n,n.return,r)}}function Bv(e){switch(e.tag){case 31:case 13:case 19:var n=e.stateNode;return n===null&&(n=e.stateNode=new ff),n;case 22:return e=e.stateNode,n=e._retryCache,n===null&&(n=e._retryCache=new ff),n;default:throw Error(i(435,e.tag))}}function Ps(e,n){var r=Bv(e);n.forEach(function(s){if(!r.has(s)){r.add(s);var h=e_.bind(null,e,s);s.then(h,h)}})}function _n(e,n){var r=n.deletions;if(r!==null)for(var s=0;s<r.length;s++){var h=r[s],g=e,N=n,H=N;e:for(;H!==null;){switch(H.tag){case 27:if(xo(H.type)){Dt=H.stateNode,vn=!1;break e}break;case 5:Dt=H.stateNode,vn=!1;break e;case 3:case 4:Dt=H.stateNode.containerInfo,vn=!0;break e}H=H.return}if(Dt===null)throw Error(i(160));yf(g,N,h),Dt=null,vn=!1,g=h.alternate,g!==null&&(g.return=null),h.return=null}if(n.subtreeFlags&13886)for(n=n.child;n!==null;)_f(n,e),n=n.sibling}var da=null;function _f(e,n){var r=e.alternate,s=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:_n(n,e),xn(e),s&4&&(fo(3,e,e.return),bl(3,e),fo(5,e,e.return));break;case 1:_n(n,e),xn(e),s&512&&(Wt||r===null||wa(r,r.return)),s&64&&za&&(e=e.updateQueue,e!==null&&(s=e.callbacks,s!==null&&(r=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=r===null?s:r.concat(s))));break;case 26:var h=da;if(_n(n,e),xn(e),s&512&&(Wt||r===null||wa(r,r.return)),s&4){var g=r!==null?r.memoizedState:null;if(s=e.memoizedState,r===null)if(s===null)if(e.stateNode===null){e:{s=e.type,r=e.memoizedProps,h=h.ownerDocument||h;t:switch(s){case"title":g=h.getElementsByTagName("title")[0],(!g||g[Pt]||g[Ae]||g.namespaceURI==="http://www.w3.org/2000/svg"||g.hasAttribute("itemprop"))&&(g=h.createElement(s),h.head.insertBefore(g,h.querySelector("head > title"))),sn(g,s,r),g[Ae]=e,Tt(g),s=g;break e;case"link":var N=_h("link","href",h).get(s+(r.href||""));if(N){for(var H=0;H<N.length;H++)if(g=N[H],g.getAttribute("href")===(r.href==null||r.href===""?null:r.href)&&g.getAttribute("rel")===(r.rel==null?null:r.rel)&&g.getAttribute("title")===(r.title==null?null:r.title)&&g.getAttribute("crossorigin")===(r.crossOrigin==null?null:r.crossOrigin)){N.splice(H,1);break t}}g=h.createElement(s),sn(g,s,r),h.head.appendChild(g);break;case"meta":if(N=_h("meta","content",h).get(s+(r.content||""))){for(H=0;H<N.length;H++)if(g=N[H],g.getAttribute("content")===(r.content==null?null:""+r.content)&&g.getAttribute("name")===(r.name==null?null:r.name)&&g.getAttribute("property")===(r.property==null?null:r.property)&&g.getAttribute("http-equiv")===(r.httpEquiv==null?null:r.httpEquiv)&&g.getAttribute("charset")===(r.charSet==null?null:r.charSet)){N.splice(H,1);break t}}g=h.createElement(s),sn(g,s,r),h.head.appendChild(g);break;default:throw Error(i(468,s))}g[Ae]=e,Tt(g),s=g}e.stateNode=s}else xh(h,e.type,e.stateNode);else e.stateNode=vh(h,s,e.memoizedProps);else g!==s?(g===null?r.stateNode!==null&&(r=r.stateNode,r.parentNode.removeChild(r)):g.count--,s===null?xh(h,e.type,e.stateNode):vh(h,s,e.memoizedProps)):s===null&&e.stateNode!==null&&Ii(e,e.memoizedProps,r.memoizedProps)}break;case 27:_n(n,e),xn(e),s&512&&(Wt||r===null||wa(r,r.return)),r!==null&&s&4&&Ii(e,e.memoizedProps,r.memoizedProps);break;case 5:if(_n(n,e),xn(e),s&512&&(Wt||r===null||wa(r,r.return)),e.flags&32){h=e.stateNode;try{Da(h,"")}catch($e){vt(e,e.return,$e)}}s&4&&e.stateNode!=null&&(h=e.memoizedProps,Ii(e,h,r!==null?r.memoizedProps:h)),s&1024&&(Oi=!0);break;case 6:if(_n(n,e),xn(e),s&4){if(e.stateNode===null)throw Error(i(162));s=e.memoizedProps,r=e.stateNode;try{r.nodeValue=s}catch($e){vt(e,e.return,$e)}}break;case 3:if(tc=null,h=da,da=Js(n.containerInfo),_n(n,e),da=h,xn(e),s&4&&r!==null&&r.memoizedState.isDehydrated)try{Hr(n.containerInfo)}catch($e){vt(e,e.return,$e)}Oi&&(Oi=!1,xf(e));break;case 4:s=da,da=Js(e.stateNode.containerInfo),_n(n,e),xn(e),da=s;break;case 12:_n(n,e),xn(e);break;case 31:_n(n,e),xn(e),s&4&&(s=e.updateQueue,s!==null&&(e.updateQueue=null,Ps(e,s)));break;case 13:_n(n,e),xn(e),e.child.flags&8192&&e.memoizedState!==null!=(r!==null&&r.memoizedState!==null)&&(Ms=Oe()),s&4&&(s=e.updateQueue,s!==null&&(e.updateQueue=null,Ps(e,s)));break;case 22:h=e.memoizedState!==null;var te=r!==null&&r.memoizedState!==null,de=za,ye=Wt;if(za=de||h,Wt=ye||te,_n(n,e),Wt=ye,za=de,xn(e),s&8192)e:for(n=e.stateNode,n._visibility=h?n._visibility&-2:n._visibility|1,h&&(r===null||te||za||Wt||er(e)),r=null,n=e;;){if(n.tag===5||n.tag===26){if(r===null){te=r=n;try{if(g=te.stateNode,h)N=g.style,typeof N.setProperty=="function"?N.setProperty("display","none","important"):N.display="none";else{H=te.stateNode;var _e=te.memoizedProps.style,pe=_e!=null&&_e.hasOwnProperty("display")?_e.display:null;H.style.display=pe==null||typeof pe=="boolean"?"":(""+pe).trim()}}catch($e){vt(te,te.return,$e)}}}else if(n.tag===6){if(r===null){te=n;try{te.stateNode.nodeValue=h?"":te.memoizedProps}catch($e){vt(te,te.return,$e)}}}else if(n.tag===18){if(r===null){te=n;try{var he=te.stateNode;h?ih(he,!0):ih(te.stateNode,!1)}catch($e){vt(te,te.return,$e)}}}else if((n.tag!==22&&n.tag!==23||n.memoizedState===null||n===e)&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;r===n&&(r=null),n=n.return}r===n&&(r=null),n.sibling.return=n.return,n=n.sibling}s&4&&(s=e.updateQueue,s!==null&&(r=s.retryQueue,r!==null&&(s.retryQueue=null,Ps(e,r))));break;case 19:_n(n,e),xn(e),s&4&&(s=e.updateQueue,s!==null&&(e.updateQueue=null,Ps(e,s)));break;case 30:break;case 21:break;default:_n(n,e),xn(e)}}function xn(e){var n=e.flags;if(n&2){try{for(var r,s=e.return;s!==null;){if(uf(s)){r=s;break}s=s.return}if(r==null)throw Error(i(160));switch(r.tag){case 27:var h=r.stateNode,g=Ui(e);Us(e,g,h);break;case 5:var N=r.stateNode;r.flags&32&&(Da(N,""),r.flags&=-33);var H=Ui(e);Us(e,H,N);break;case 3:case 4:var te=r.stateNode.containerInfo,de=Ui(e);Pi(e,de,te);break;default:throw Error(i(161))}}catch(ye){vt(e,e.return,ye)}e.flags&=-3}n&4096&&(e.flags&=-4097)}function xf(e){if(e.subtreeFlags&1024)for(e=e.child;e!==null;){var n=e;xf(n),n.tag===5&&n.flags&1024&&n.stateNode.reset(),e=e.sibling}}function Ba(e,n){if(n.subtreeFlags&8772)for(n=n.child;n!==null;)hf(e,n.alternate,n),n=n.sibling}function er(e){for(e=e.child;e!==null;){var n=e;switch(n.tag){case 0:case 11:case 14:case 15:fo(4,n,n.return),er(n);break;case 1:wa(n,n.return);var r=n.stateNode;typeof r.componentWillUnmount=="function"&&cf(n,n.return,r),er(n);break;case 27:ql(n.stateNode);case 26:case 5:wa(n,n.return),er(n);break;case 22:n.memoizedState===null&&er(n);break;case 30:er(n);break;default:er(n)}e=e.sibling}}function Ya(e,n,r){for(r=r&&(n.subtreeFlags&8772)!==0,n=n.child;n!==null;){var s=n.alternate,h=e,g=n,N=g.flags;switch(g.tag){case 0:case 11:case 15:Ya(h,g,r),bl(4,g);break;case 1:if(Ya(h,g,r),s=g,h=s.stateNode,typeof h.componentDidMount=="function")try{h.componentDidMount()}catch(de){vt(s,s.return,de)}if(s=g,h=s.updateQueue,h!==null){var H=s.stateNode;try{var te=h.shared.hiddenCallbacks;if(te!==null)for(h.shared.hiddenCallbacks=null,h=0;h<te.length;h++)Xu(te[h],H)}catch(de){vt(s,s.return,de)}}r&&N&64&&sf(g),El(g,g.return);break;case 27:pf(g);case 26:case 5:Ya(h,g,r),r&&s===null&&N&4&&df(g),El(g,g.return);break;case 12:Ya(h,g,r);break;case 31:Ya(h,g,r),r&&N&4&&gf(h,g);break;case 13:Ya(h,g,r),r&&N&4&&vf(h,g);break;case 22:g.memoizedState===null&&Ya(h,g,r),El(g,g.return);break;case 30:break;default:Ya(h,g,r)}n=n.sibling}}function Mi(e,n){var r=null;e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(r=e.memoizedState.cachePool.pool),e=null,n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(e=n.memoizedState.cachePool.pool),e!==r&&(e!=null&&e.refCount++,r!=null&&ul(r))}function Hi(e,n){e=null,n.alternate!==null&&(e=n.alternate.memoizedState.cache),n=n.memoizedState.cache,n!==e&&(n.refCount++,e!=null&&ul(e))}function ua(e,n,r,s){if(n.subtreeFlags&10256)for(n=n.child;n!==null;)wf(e,n,r,s),n=n.sibling}function wf(e,n,r,s){var h=n.flags;switch(n.tag){case 0:case 11:case 15:ua(e,n,r,s),h&2048&&bl(9,n);break;case 1:ua(e,n,r,s);break;case 3:ua(e,n,r,s),h&2048&&(e=null,n.alternate!==null&&(e=n.alternate.memoizedState.cache),n=n.memoizedState.cache,n!==e&&(n.refCount++,e!=null&&ul(e)));break;case 12:if(h&2048){ua(e,n,r,s),e=n.stateNode;try{var g=n.memoizedProps,N=g.id,H=g.onPostCommit;typeof H=="function"&&H(N,n.alternate===null?"mount":"update",e.passiveEffectDuration,-0)}catch(te){vt(n,n.return,te)}}else ua(e,n,r,s);break;case 31:ua(e,n,r,s);break;case 13:ua(e,n,r,s);break;case 23:break;case 22:g=n.stateNode,N=n.alternate,n.memoizedState!==null?g._visibility&2?ua(e,n,r,s):jl(e,n):g._visibility&2?ua(e,n,r,s):(g._visibility|=2,Ar(e,n,r,s,(n.subtreeFlags&10256)!==0||!1)),h&2048&&Mi(N,n);break;case 24:ua(e,n,r,s),h&2048&&Hi(n.alternate,n);break;default:ua(e,n,r,s)}}function Ar(e,n,r,s,h){for(h=h&&((n.subtreeFlags&10256)!==0||!1),n=n.child;n!==null;){var g=e,N=n,H=r,te=s,de=N.flags;switch(N.tag){case 0:case 11:case 15:Ar(g,N,H,te,h),bl(8,N);break;case 23:break;case 22:var ye=N.stateNode;N.memoizedState!==null?ye._visibility&2?Ar(g,N,H,te,h):jl(g,N):(ye._visibility|=2,Ar(g,N,H,te,h)),h&&de&2048&&Mi(N.alternate,N);break;case 24:Ar(g,N,H,te,h),h&&de&2048&&Hi(N.alternate,N);break;default:Ar(g,N,H,te,h)}n=n.sibling}}function jl(e,n){if(n.subtreeFlags&10256)for(n=n.child;n!==null;){var r=e,s=n,h=s.flags;switch(s.tag){case 22:jl(r,s),h&2048&&Mi(s.alternate,s);break;case 24:jl(r,s),h&2048&&Hi(s.alternate,s);break;default:jl(r,s)}n=n.sibling}}var kl=8192;function Dr(e,n,r){if(e.subtreeFlags&kl)for(e=e.child;e!==null;)Cf(e,n,r),e=e.sibling}function Cf(e,n,r){switch(e.tag){case 26:Dr(e,n,r),e.flags&kl&&e.memoizedState!==null&&A_(r,da,e.memoizedState,e.memoizedProps);break;case 5:Dr(e,n,r);break;case 3:case 4:var s=da;da=Js(e.stateNode.containerInfo),Dr(e,n,r),da=s;break;case 22:e.memoizedState===null&&(s=e.alternate,s!==null&&s.memoizedState!==null?(s=kl,kl=16777216,Dr(e,n,r),kl=s):Dr(e,n,r));break;default:Dr(e,n,r)}}function Sf(e){var n=e.alternate;if(n!==null&&(e=n.child,e!==null)){n.child=null;do n=e.sibling,e.sibling=null,e=n;while(e!==null)}}function Nl(e){var n=e.deletions;if((e.flags&16)!==0){if(n!==null)for(var r=0;r<n.length;r++){var s=n[r];en=s,Ef(s,e)}Sf(e)}if(e.subtreeFlags&10256)for(e=e.child;e!==null;)bf(e),e=e.sibling}function bf(e){switch(e.tag){case 0:case 11:case 15:Nl(e),e.flags&2048&&fo(9,e,e.return);break;case 3:Nl(e);break;case 12:Nl(e);break;case 22:var n=e.stateNode;e.memoizedState!==null&&n._visibility&2&&(e.return===null||e.return.tag!==13)?(n._visibility&=-3,Os(e)):Nl(e);break;default:Nl(e)}}function Os(e){var n=e.deletions;if((e.flags&16)!==0){if(n!==null)for(var r=0;r<n.length;r++){var s=n[r];en=s,Ef(s,e)}Sf(e)}for(e=e.child;e!==null;){switch(n=e,n.tag){case 0:case 11:case 15:fo(8,n,n.return),Os(n);break;case 22:r=n.stateNode,r._visibility&2&&(r._visibility&=-3,Os(n));break;default:Os(n)}e=e.sibling}}function Ef(e,n){for(;en!==null;){var r=en;switch(r.tag){case 0:case 11:case 15:fo(8,r,n);break;case 23:case 22:if(r.memoizedState!==null&&r.memoizedState.cachePool!==null){var s=r.memoizedState.cachePool.pool;s!=null&&s.refCount++}break;case 24:ul(r.memoizedState.cache)}if(s=r.child,s!==null)s.return=r,en=s;else e:for(r=e;en!==null;){s=en;var h=s.sibling,g=s.return;if(mf(s),s===r){en=null;break e}if(h!==null){h.return=g,en=h;break e}en=g}}}var Yv={getCacheForType:function(e){var n=rn(Bt),r=n.data.get(e);return r===void 0&&(r=e(),n.data.set(e,r)),r},cacheSignal:function(){return rn(Bt).controller.signal}},Gv=typeof WeakMap=="function"?WeakMap:Map,yt=0,Et=null,ot=null,st=0,gt=0,Fn=null,ho=!1,Fr=!1,zi=!1,Ga=0,Lt=0,mo=0,tr=0,Vi=0,qn=0,qr=0,Rl=null,wn=null,Bi=!1,Ms=0,jf=0,Hs=1/0,zs=null,yo=null,Xt=0,go=null,$r=null,Wa=0,Yi=0,Gi=null,kf=null,Tl=0,Wi=null;function $n(){return(yt&2)!==0&&st!==0?st&-st:q.T!==null?ed():fe()}function Nf(){if(qn===0)if((st&536870912)===0||it){var e=dn;dn<<=1,(dn&3932160)===0&&(dn=262144),qn=e}else qn=536870912;return e=An.current,e!==null&&(e.flags|=32),qn}function Cn(e,n,r){(e===Et&&(gt===2||gt===9)||e.cancelPendingCommit!==null)&&(Lr(e,0),vo(e,st,qn,!1)),Nn(e,r),((yt&2)===0||e!==Et)&&(e===Et&&((yt&2)===0&&(tr|=r),Lt===4&&vo(e,st,qn,!1)),Ca(e))}function Rf(e,n,r){if((yt&6)!==0)throw Error(i(327));var s=!r&&(n&127)===0&&(n&e.expiredLanes)===0||jn(e,n),h=s?Xv(e,n):Xi(e,n,!0),g=s;do{if(h===0){Fr&&!s&&vo(e,n,0,!1);break}else{if(r=e.current.alternate,g&&!Wv(r)){h=Xi(e,n,!1),g=!1;continue}if(h===2){if(g=n,e.errorRecoveryDisabledLanes&g)var N=0;else N=e.pendingLanes&-536870913,N=N!==0?N:N&536870912?536870912:0;if(N!==0){n=N;e:{var H=e;h=Rl;var te=H.current.memoizedState.isDehydrated;if(te&&(Lr(H,N).flags|=256),N=Xi(H,N,!1),N!==2){if(zi&&!te){H.errorRecoveryDisabledLanes|=g,tr|=g,h=4;break e}g=wn,wn=h,g!==null&&(wn===null?wn=g:wn.push.apply(wn,g))}h=N}if(g=!1,h!==2)continue}}if(h===1){Lr(e,0),vo(e,n,0,!0);break}e:{switch(s=e,g=h,g){case 0:case 1:throw Error(i(345));case 4:if((n&4194048)!==n)break;case 6:vo(s,n,qn,!ho);break e;case 2:wn=null;break;case 3:case 5:break;default:throw Error(i(329))}if((n&62914560)===n&&(h=Ms+300-Oe(),10<h)){if(vo(s,n,qn,!ho),Hn(s,0,!0)!==0)break e;Wa=n,s.timeoutHandle=lh(Tf.bind(null,s,r,wn,zs,Bi,n,qn,tr,qr,ho,g,"Throttled",-0,0),h);break e}Tf(s,r,wn,zs,Bi,n,qn,tr,qr,ho,g,null,-0,0)}}break}while(!0);Ca(e)}function Tf(e,n,r,s,h,g,N,H,te,de,ye,_e,pe,he){if(e.timeoutHandle=-1,_e=n.subtreeFlags,_e&8192||(_e&16785408)===16785408){_e={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Bn},Cf(n,g,_e);var $e=(g&62914560)===g?Ms-Oe():(g&4194048)===g?jf-Oe():0;if($e=D_(_e,$e),$e!==null){Wa=g,e.cancelPendingCommit=$e(Uf.bind(null,e,n,g,r,s,h,N,H,te,ye,_e,null,pe,he)),vo(e,g,N,!de);return}}Uf(e,n,g,r,s,h,N,H,te)}function Wv(e){for(var n=e;;){var r=n.tag;if((r===0||r===11||r===15)&&n.flags&16384&&(r=n.updateQueue,r!==null&&(r=r.stores,r!==null)))for(var s=0;s<r.length;s++){var h=r[s],g=h.getSnapshot;h=h.value;try{if(!Rn(g(),h))return!1}catch{return!1}}if(r=n.child,n.subtreeFlags&16384&&r!==null)r.return=n,n=r;else{if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return!0;n=n.return}n.sibling.return=n.return,n=n.sibling}}return!0}function vo(e,n,r,s){n&=~Vi,n&=~tr,e.suspendedLanes|=n,e.pingedLanes&=~n,s&&(e.warmLanes|=n),s=e.expirationTimes;for(var h=n;0<h;){var g=31-Ut(h),N=1<<g;s[g]=-1,h&=~N}r!==0&&ma(e,r,n)}function Vs(){return(yt&6)===0?(Al(0),!1):!0}function Qi(){if(ot!==null){if(gt===0)var e=ot.return;else e=ot,Ia=Yo=null,ui(e),jr=null,fl=0,e=ot;for(;e!==null;)lf(e.alternate,e),e=e.return;ot=null}}function Lr(e,n){var r=e.timeoutHandle;r!==-1&&(e.timeoutHandle=-1,h_(r)),r=e.cancelPendingCommit,r!==null&&(e.cancelPendingCommit=null,r()),Wa=0,Qi(),Et=e,ot=r=$a(e.current,null),st=n,gt=0,Fn=null,ho=!1,Fr=jn(e,n),zi=!1,qr=qn=Vi=tr=mo=Lt=0,wn=Rl=null,Bi=!1,(n&8)!==0&&(n|=n&32);var s=e.entangledLanes;if(s!==0)for(e=e.entanglements,s&=n;0<s;){var h=31-Ut(s),g=1<<h;n|=e[h],s&=~g}return Ga=n,us(),r}function Af(e,n){Qe=null,q.H=wl,n===Er||n===_s?(n=Yu(),gt=3):n===Jc?(n=Yu(),gt=4):gt=n===ki?8:n!==null&&typeof n=="object"&&typeof n.then=="function"?6:1,Fn=n,ot===null&&(Lt=1,Fs(e,Wn(n,e.current)))}function Df(){var e=An.current;return e===null?!0:(st&4194048)===st?Kn===null:(st&62914560)===st||(st&536870912)!==0?e===Kn:!1}function Ff(){var e=q.H;return q.H=wl,e===null?wl:e}function qf(){var e=q.A;return q.A=Yv,e}function Bs(){Lt=4,ho||(st&4194048)!==st&&An.current!==null||(Fr=!0),(mo&134217727)===0&&(tr&134217727)===0||Et===null||vo(Et,st,qn,!1)}function Xi(e,n,r){var s=yt;yt|=2;var h=Ff(),g=qf();(Et!==e||st!==n)&&(zs=null,Lr(e,n)),n=!1;var N=Lt;e:do try{if(gt!==0&&ot!==null){var H=ot,te=Fn;switch(gt){case 8:Qi(),N=6;break e;case 3:case 2:case 9:case 6:An.current===null&&(n=!0);var de=gt;if(gt=0,Fn=null,Ir(e,H,te,de),r&&Fr){N=0;break e}break;default:de=gt,gt=0,Fn=null,Ir(e,H,te,de)}}Qv(),N=Lt;break}catch(ye){Af(e,ye)}while(!0);return n&&e.shellSuspendCounter++,Ia=Yo=null,yt=s,q.H=h,q.A=g,ot===null&&(Et=null,st=0,us()),N}function Qv(){for(;ot!==null;)$f(ot)}function Xv(e,n){var r=yt;yt|=2;var s=Ff(),h=qf();Et!==e||st!==n?(zs=null,Hs=Oe()+500,Lr(e,n)):Fr=jn(e,n);e:do try{if(gt!==0&&ot!==null){n=ot;var g=Fn;t:switch(gt){case 1:gt=0,Fn=null,Ir(e,n,g,1);break;case 2:case 9:if(Vu(g)){gt=0,Fn=null,Lf(n);break}n=function(){gt!==2&&gt!==9||Et!==e||(gt=7),Ca(e)},g.then(n,n);break e;case 3:gt=7;break e;case 4:gt=5;break e;case 7:Vu(g)?(gt=0,Fn=null,Lf(n)):(gt=0,Fn=null,Ir(e,n,g,7));break;case 5:var N=null;switch(ot.tag){case 26:N=ot.memoizedState;case 5:case 27:var H=ot;if(N?wh(N):H.stateNode.complete){gt=0,Fn=null;var te=H.sibling;if(te!==null)ot=te;else{var de=H.return;de!==null?(ot=de,Ys(de)):ot=null}break t}}gt=0,Fn=null,Ir(e,n,g,5);break;case 6:gt=0,Fn=null,Ir(e,n,g,6);break;case 8:Qi(),Lt=6;break e;default:throw Error(i(462))}}Zv();break}catch(ye){Af(e,ye)}while(!0);return Ia=Yo=null,q.H=s,q.A=h,yt=r,ot!==null?0:(Et=null,st=0,us(),Lt)}function Zv(){for(;ot!==null&&!Fe();)$f(ot)}function $f(e){var n=of(e.alternate,e,Ga);e.memoizedProps=e.pendingProps,n===null?Ys(e):ot=n}function Lf(e){var n=e,r=n.alternate;switch(n.tag){case 15:case 0:n=Kp(r,n,n.pendingProps,n.type,void 0,st);break;case 11:n=Kp(r,n,n.pendingProps,n.type.render,n.ref,st);break;case 5:ui(n);default:lf(r,n),n=ot=Fu(n,Ga),n=of(r,n,Ga)}e.memoizedProps=e.pendingProps,n===null?Ys(e):ot=n}function Ir(e,n,r,s){Ia=Yo=null,ui(n),jr=null,fl=0;var h=n.return;try{if(Pv(e,h,n,r,st)){Lt=1,Fs(e,Wn(r,e.current)),ot=null;return}}catch(g){if(h!==null)throw ot=h,g;Lt=1,Fs(e,Wn(r,e.current)),ot=null;return}n.flags&32768?(it||s===1?e=!0:Fr||(st&536870912)!==0?e=!1:(ho=e=!0,(s===2||s===9||s===3||s===6)&&(s=An.current,s!==null&&s.tag===13&&(s.flags|=16384))),If(n,e)):Ys(n)}function Ys(e){var n=e;do{if((n.flags&32768)!==0){If(n,ho);return}e=n.return;var r=Hv(n.alternate,n,Ga);if(r!==null){ot=r;return}if(n=n.sibling,n!==null){ot=n;return}ot=n=e}while(n!==null);Lt===0&&(Lt=5)}function If(e,n){do{var r=zv(e.alternate,e);if(r!==null){r.flags&=32767,ot=r;return}if(r=e.return,r!==null&&(r.flags|=32768,r.subtreeFlags=0,r.deletions=null),!n&&(e=e.sibling,e!==null)){ot=e;return}ot=e=r}while(e!==null);Lt=6,ot=null}function Uf(e,n,r,s,h,g,N,H,te){e.cancelPendingCommit=null;do Gs();while(Xt!==0);if((yt&6)!==0)throw Error(i(327));if(n!==null){if(n===e.current)throw Error(i(177));if(g=n.lanes|n.childLanes,g|=Uc,Na(e,r,g,N,H,te),e===Et&&(ot=Et=null,st=0),$r=n,go=e,Wa=r,Yi=g,Gi=h,kf=s,(n.subtreeFlags&10256)!==0||(n.flags&10256)!==0?(e.callbackNode=null,e.callbackPriority=0,t_(Zt,function(){return zf(),null})):(e.callbackNode=null,e.callbackPriority=0),s=(n.flags&13878)!==0,(n.subtreeFlags&13878)!==0||s){s=q.T,q.T=null,h=M.p,M.p=2,N=yt,yt|=4;try{Vv(e,n,r)}finally{yt=N,M.p=h,q.T=s}}Xt=1,Pf(),Of(),Mf()}}function Pf(){if(Xt===1){Xt=0;var e=go,n=$r,r=(n.flags&13878)!==0;if((n.subtreeFlags&13878)!==0||r){r=q.T,q.T=null;var s=M.p;M.p=2;var h=yt;yt|=4;try{_f(n,e);var g=cd,N=bu(e.containerInfo),H=g.focusedElem,te=g.selectionRange;if(N!==H&&H&&H.ownerDocument&&Su(H.ownerDocument.documentElement,H)){if(te!==null&&Fc(H)){var de=te.start,ye=te.end;if(ye===void 0&&(ye=de),"selectionStart"in H)H.selectionStart=de,H.selectionEnd=Math.min(ye,H.value.length);else{var _e=H.ownerDocument||document,pe=_e&&_e.defaultView||window;if(pe.getSelection){var he=pe.getSelection(),$e=H.textContent.length,ze=Math.min(te.start,$e),St=te.end===void 0?ze:Math.min(te.end,$e);!he.extend&&ze>St&&(N=St,St=ze,ze=N);var ce=Cu(H,ze),oe=Cu(H,St);if(ce&&oe&&(he.rangeCount!==1||he.anchorNode!==ce.node||he.anchorOffset!==ce.offset||he.focusNode!==oe.node||he.focusOffset!==oe.offset)){var ie=_e.createRange();ie.setStart(ce.node,ce.offset),he.removeAllRanges(),ze>St?(he.addRange(ie),he.extend(oe.node,oe.offset)):(ie.setEnd(oe.node,oe.offset),he.addRange(ie))}}}}for(_e=[],he=H;he=he.parentNode;)he.nodeType===1&&_e.push({element:he,left:he.scrollLeft,top:he.scrollTop});for(typeof H.focus=="function"&&H.focus(),H=0;H<_e.length;H++){var ge=_e[H];ge.element.scrollLeft=ge.left,ge.element.scrollTop=ge.top}}rc=!!sd,cd=sd=null}finally{yt=h,M.p=s,q.T=r}}e.current=n,Xt=2}}function Of(){if(Xt===2){Xt=0;var e=go,n=$r,r=(n.flags&8772)!==0;if((n.subtreeFlags&8772)!==0||r){r=q.T,q.T=null;var s=M.p;M.p=2;var h=yt;yt|=4;try{hf(e,n.alternate,n)}finally{yt=h,M.p=s,q.T=r}}Xt=3}}function Mf(){if(Xt===4||Xt===3){Xt=0,Ve();var e=go,n=$r,r=Wa,s=kf;(n.subtreeFlags&10256)!==0||(n.flags&10256)!==0?Xt=5:(Xt=0,$r=go=null,Hf(e,e.pendingLanes));var h=e.pendingLanes;if(h===0&&(yo=null),ra(r),n=n.stateNode,Ft&&typeof Ft.onCommitFiberRoot=="function")try{Ft.onCommitFiberRoot(yn,n,void 0,(n.current.flags&128)===128)}catch{}if(s!==null){n=q.T,h=M.p,M.p=2,q.T=null;try{for(var g=e.onRecoverableError,N=0;N<s.length;N++){var H=s[N];g(H.value,{componentStack:H.stack})}}finally{q.T=n,M.p=h}}(Wa&3)!==0&&Gs(),Ca(e),h=e.pendingLanes,(r&261930)!==0&&(h&42)!==0?e===Wi?Tl++:(Tl=0,Wi=e):Tl=0,Al(0)}}function Hf(e,n){(e.pooledCacheLanes&=n)===0&&(n=e.pooledCache,n!=null&&(e.pooledCache=null,ul(n)))}function Gs(){return Pf(),Of(),Mf(),zf()}function zf(){if(Xt!==5)return!1;var e=go,n=Yi;Yi=0;var r=ra(Wa),s=q.T,h=M.p;try{M.p=32>r?32:r,q.T=null,r=Gi,Gi=null;var g=go,N=Wa;if(Xt=0,$r=go=null,Wa=0,(yt&6)!==0)throw Error(i(331));var H=yt;if(yt|=4,bf(g.current),wf(g,g.current,N,r),yt=H,Al(0,!1),Ft&&typeof Ft.onPostCommitFiberRoot=="function")try{Ft.onPostCommitFiberRoot(yn,g)}catch{}return!0}finally{M.p=h,q.T=s,Hf(e,n)}}function Vf(e,n,r){n=Wn(r,n),n=ji(e.stateNode,n,2),e=io(e,n,2),e!==null&&(Nn(e,2),Ca(e))}function vt(e,n,r){if(e.tag===3)Vf(e,e,r);else for(;n!==null;){if(n.tag===3){Vf(n,e,r);break}else if(n.tag===1){var s=n.stateNode;if(typeof n.type.getDerivedStateFromError=="function"||typeof s.componentDidCatch=="function"&&(yo===null||!yo.has(s))){e=Wn(r,e),r=Vp(2),s=io(n,r,2),s!==null&&(Bp(r,s,n,e),Nn(s,2),Ca(s));break}}n=n.return}}function Zi(e,n,r){var s=e.pingCache;if(s===null){s=e.pingCache=new Gv;var h=new Set;s.set(n,h)}else h=s.get(n),h===void 0&&(h=new Set,s.set(n,h));h.has(r)||(zi=!0,h.add(r),e=Kv.bind(null,e,n,r),n.then(e,e))}function Kv(e,n,r){var s=e.pingCache;s!==null&&s.delete(n),e.pingedLanes|=e.suspendedLanes&r,e.warmLanes&=~r,Et===e&&(st&r)===r&&(Lt===4||Lt===3&&(st&62914560)===st&&300>Oe()-Ms?(yt&2)===0&&Lr(e,0):Vi|=r,qr===st&&(qr=0)),Ca(e)}function Bf(e,n){n===0&&(n=oa()),e=zo(e,n),e!==null&&(Nn(e,n),Ca(e))}function Jv(e){var n=e.memoizedState,r=0;n!==null&&(r=n.retryLane),Bf(e,r)}function e_(e,n){var r=0;switch(e.tag){case 31:case 13:var s=e.stateNode,h=e.memoizedState;h!==null&&(r=h.retryLane);break;case 19:s=e.stateNode;break;case 22:s=e.stateNode._retryCache;break;default:throw Error(i(314))}s!==null&&s.delete(n),Bf(e,r)}function t_(e,n){return nt(e,n)}var Ws=null,Ur=null,Ki=!1,Qs=!1,Ji=!1,_o=0;function Ca(e){e!==Ur&&e.next===null&&(Ur===null?Ws=Ur=e:Ur=Ur.next=e),Qs=!0,Ki||(Ki=!0,a_())}function Al(e,n){if(!Ji&&Qs){Ji=!0;do for(var r=!1,s=Ws;s!==null;){if(e!==0){var h=s.pendingLanes;if(h===0)var g=0;else{var N=s.suspendedLanes,H=s.pingedLanes;g=(1<<31-Ut(42|e)+1)-1,g&=h&~(N&~H),g=g&201326741?g&201326741|1:g?g|2:0}g!==0&&(r=!0,Qf(s,g))}else g=st,g=Hn(s,s===Et?g:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),(g&3)===0||jn(s,g)||(r=!0,Qf(s,g));s=s.next}while(r);Ji=!1}}function n_(){Yf()}function Yf(){Qs=Ki=!1;var e=0;_o!==0&&f_()&&(e=_o);for(var n=Oe(),r=null,s=Ws;s!==null;){var h=s.next,g=Gf(s,n);g===0?(s.next=null,r===null?Ws=h:r.next=h,h===null&&(Ur=r)):(r=s,(e!==0||(g&3)!==0)&&(Qs=!0)),s=h}Xt!==0&&Xt!==5||Al(e),_o!==0&&(_o=0)}function Gf(e,n){for(var r=e.suspendedLanes,s=e.pingedLanes,h=e.expirationTimes,g=e.pendingLanes&-62914561;0<g;){var N=31-Ut(g),H=1<<N,te=h[N];te===-1?((H&r)===0||(H&s)!==0)&&(h[N]=ka(H,n)):te<=n&&(e.expiredLanes|=H),g&=~H}if(n=Et,r=st,r=Hn(e,e===n?r:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),s=e.callbackNode,r===0||e===n&&(gt===2||gt===9)||e.cancelPendingCommit!==null)return s!==null&&s!==null&&je(s),e.callbackNode=null,e.callbackPriority=0;if((r&3)===0||jn(e,r)){if(n=r&-r,n===e.callbackPriority)return n;switch(s!==null&&je(s),ra(r)){case 2:case 8:r=It;break;case 32:r=Zt;break;case 268435456:r=On;break;default:r=Zt}return s=Wf.bind(null,e),r=nt(r,s),e.callbackPriority=n,e.callbackNode=r,n}return s!==null&&s!==null&&je(s),e.callbackPriority=2,e.callbackNode=null,2}function Wf(e,n){if(Xt!==0&&Xt!==5)return e.callbackNode=null,e.callbackPriority=0,null;var r=e.callbackNode;if(Gs()&&e.callbackNode!==r)return null;var s=st;return s=Hn(e,e===Et?s:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),s===0?null:(Rf(e,s,n),Gf(e,Oe()),e.callbackNode!=null&&e.callbackNode===r?Wf.bind(null,e):null)}function Qf(e,n){if(Gs())return null;Rf(e,n,!0)}function a_(){m_(function(){(yt&6)!==0?nt(tt,n_):Yf()})}function ed(){if(_o===0){var e=Sr;e===0&&(e=Jt,Jt<<=1,(Jt&261888)===0&&(Jt=256)),_o=e}return _o}function Xf(e){return e==null||typeof e=="symbol"||typeof e=="boolean"?null:typeof e=="function"?e:Uo(""+e)}function Zf(e,n){var r=n.ownerDocument.createElement("input");return r.name=n.name,r.value=n.value,e.id&&r.setAttribute("form",e.id),n.parentNode.insertBefore(r,n),e=new FormData(e),r.parentNode.removeChild(r),e}function o_(e,n,r,s,h){if(n==="submit"&&r&&r.stateNode===h){var g=Xf((h[Te]||null).action),N=s.submitter;N&&(n=(n=N[Te]||null)?Xf(n.formAction):N.getAttribute("formAction"),n!==null&&(g=n,N=null));var H=new ss("action","action",null,s,h);e.push({event:H,listeners:[{instance:null,listener:function(){if(s.defaultPrevented){if(_o!==0){var te=N?Zf(h,N):new FormData(h);xi(r,{pending:!0,data:te,method:h.method,action:g},null,te)}}else typeof g=="function"&&(H.preventDefault(),te=N?Zf(h,N):new FormData(h),xi(r,{pending:!0,data:te,method:h.method,action:g},g,te))},currentTarget:h}]})}}for(var td=0;td<Ic.length;td++){var nd=Ic[td],r_=nd.toLowerCase(),l_=nd[0].toUpperCase()+nd.slice(1);ia(r_,"on"+l_)}ia(ku,"onAnimationEnd"),ia(Nu,"onAnimationIteration"),ia(Ru,"onAnimationStart"),ia("dblclick","onDoubleClick"),ia("focusin","onFocus"),ia("focusout","onBlur"),ia(Cv,"onTransitionRun"),ia(Sv,"onTransitionStart"),ia(bv,"onTransitionCancel"),ia(Tu,"onTransitionEnd"),Ue("onMouseEnter",["mouseout","mouseover"]),Ue("onMouseLeave",["mouseout","mouseover"]),Ue("onPointerEnter",["pointerout","pointerover"]),Ue("onPointerLeave",["pointerout","pointerover"]),be("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),be("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),be("onBeforeInput",["compositionend","keypress","textInput","paste"]),be("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),be("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),be("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Dl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),s_=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Dl));function Kf(e,n){n=(n&4)!==0;for(var r=0;r<e.length;r++){var s=e[r],h=s.event;s=s.listeners;e:{var g=void 0;if(n)for(var N=s.length-1;0<=N;N--){var H=s[N],te=H.instance,de=H.currentTarget;if(H=H.listener,te!==g&&h.isPropagationStopped())break e;g=H,h.currentTarget=de;try{g(h)}catch(ye){ds(ye)}h.currentTarget=null,g=te}else for(N=0;N<s.length;N++){if(H=s[N],te=H.instance,de=H.currentTarget,H=H.listener,te!==g&&h.isPropagationStopped())break e;g=H,h.currentTarget=de;try{g(h)}catch(ye){ds(ye)}h.currentTarget=null,g=te}}}}function rt(e,n){var r=n[We];r===void 0&&(r=n[We]=new Set);var s=e+"__bubble";r.has(s)||(Jf(n,e,2,!1),r.add(s))}function ad(e,n,r){var s=0;n&&(s|=4),Jf(r,e,s,n)}var Xs="_reactListening"+Math.random().toString(36).slice(2);function od(e){if(!e[Xs]){e[Xs]=!0,Ja.forEach(function(r){r!=="selectionchange"&&(s_.has(r)||ad(r,!1,e),ad(r,!0,e))});var n=e.nodeType===9?e:e.ownerDocument;n===null||n[Xs]||(n[Xs]=!0,ad("selectionchange",!1,n))}}function Jf(e,n,r,s){switch(Nh(n)){case 2:var h=$_;break;case 8:h=L_;break;default:h=_d}r=h.bind(null,n,r,e),h=void 0,!as||n!=="touchstart"&&n!=="touchmove"&&n!=="wheel"||(h=!0),s?h!==void 0?e.addEventListener(n,r,{capture:!0,passive:h}):e.addEventListener(n,r,!0):h!==void 0?e.addEventListener(n,r,{passive:h}):e.addEventListener(n,r,!1)}function rd(e,n,r,s,h){var g=s;if((n&1)===0&&(n&2)===0&&s!==null)e:for(;;){if(s===null)return;var N=s.tag;if(N===3||N===4){var H=s.stateNode.containerInfo;if(H===h)break;if(N===4)for(N=s.return;N!==null;){var te=N.tag;if((te===3||te===4)&&N.stateNode.containerInfo===h)return;N=N.return}for(;H!==null;){if(N=zt(H),N===null)return;if(te=N.tag,te===5||te===6||te===26||te===27){s=g=N;continue e}H=H.parentNode}}s=s.return}ns(function(){var de=g,ye=fr(r),_e=[];e:{var pe=Au.get(e);if(pe!==void 0){var he=ss,$e=e;switch(e){case"keypress":if(rs(r)===0)break e;case"keydown":case"keyup":he=ev;break;case"focusin":$e="focus",he=Nc;break;case"focusout":$e="blur",he=Nc;break;case"beforeblur":case"afterblur":he=Nc;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":he=lu;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":he=Hg;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":he=av;break;case ku:case Nu:case Ru:he=Bg;break;case Tu:he=rv;break;case"scroll":case"scrollend":he=Og;break;case"wheel":he=sv;break;case"copy":case"cut":case"paste":he=Gg;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":he=cu;break;case"toggle":case"beforetoggle":he=iv}var ze=(n&4)!==0,St=!ze&&(e==="scroll"||e==="scrollend"),ce=ze?pe!==null?pe+"Capture":null:pe;ze=[];for(var oe=de,ie;oe!==null;){var ge=oe;if(ie=ge.stateNode,ge=ge.tag,ge!==5&&ge!==26&&ge!==27||ie===null||ce===null||(ge=va(oe,ce),ge!=null&&ze.push(Fl(oe,ge,ie))),St)break;oe=oe.return}0<ze.length&&(pe=new he(pe,$e,null,r,ye),_e.push({event:pe,listeners:ze}))}}if((n&7)===0){e:{if(pe=e==="mouseover"||e==="pointerover",he=e==="mouseout"||e==="pointerout",pe&&r!==pr&&($e=r.relatedTarget||r.fromElement)&&(zt($e)||$e[He]))break e;if((he||pe)&&(pe=ye.window===ye?ye:(pe=ye.ownerDocument)?pe.defaultView||pe.parentWindow:window,he?($e=r.relatedTarget||r.toElement,he=de,$e=$e?zt($e):null,$e!==null&&(St=d($e),ze=$e.tag,$e!==St||ze!==5&&ze!==27&&ze!==6)&&($e=null)):(he=null,$e=de),he!==$e)){if(ze=lu,ge="onMouseLeave",ce="onMouseEnter",oe="mouse",(e==="pointerout"||e==="pointerover")&&(ze=cu,ge="onPointerLeave",ce="onPointerEnter",oe="pointer"),St=he==null?pe:sa(he),ie=$e==null?pe:sa($e),pe=new ze(ge,oe+"leave",he,r,ye),pe.target=St,pe.relatedTarget=ie,ge=null,zt(ye)===de&&(ze=new ze(ce,oe+"enter",$e,r,ye),ze.target=ie,ze.relatedTarget=St,ge=ze),St=ge,he&&$e)t:{for(ze=c_,ce=he,oe=$e,ie=0,ge=ce;ge;ge=ze(ge))ie++;ge=0;for(var Pe=oe;Pe;Pe=ze(Pe))ge++;for(;0<ie-ge;)ce=ze(ce),ie--;for(;0<ge-ie;)oe=ze(oe),ge--;for(;ie--;){if(ce===oe||oe!==null&&ce===oe.alternate){ze=ce;break t}ce=ze(ce),oe=ze(oe)}ze=null}else ze=null;he!==null&&eh(_e,pe,he,ze,!1),$e!==null&&St!==null&&eh(_e,St,$e,ze,!0)}}e:{if(pe=de?sa(de):window,he=pe.nodeName&&pe.nodeName.toLowerCase(),he==="select"||he==="input"&&pe.type==="file")var ht=yu;else if(hu(pe))if(gu)ht=_v;else{ht=gv;var Ie=yv}else he=pe.nodeName,!he||he.toLowerCase()!=="input"||pe.type!=="checkbox"&&pe.type!=="radio"?de&&ur(de.elementType)&&(ht=yu):ht=vv;if(ht&&(ht=ht(e,de))){mu(_e,ht,r,ye);break e}Ie&&Ie(e,pe,de),e==="focusout"&&de&&pe.type==="number"&&de.memoizedProps.value!=null&&ca(pe,"number",pe.value)}switch(Ie=de?sa(de):window,e){case"focusin":(hu(Ie)||Ie.contentEditable==="true")&&(mr=Ie,qc=de,cl=null);break;case"focusout":cl=qc=mr=null;break;case"mousedown":$c=!0;break;case"contextmenu":case"mouseup":case"dragend":$c=!1,Eu(_e,r,ye);break;case"selectionchange":if(wv)break;case"keydown":case"keyup":Eu(_e,r,ye)}var Xe;if(Tc)e:{switch(e){case"compositionstart":var ct="onCompositionStart";break e;case"compositionend":ct="onCompositionEnd";break e;case"compositionupdate":ct="onCompositionUpdate";break e}ct=void 0}else hr?pu(e,r)&&(ct="onCompositionEnd"):e==="keydown"&&r.keyCode===229&&(ct="onCompositionStart");ct&&(iu&&r.locale!=="ko"&&(hr||ct!=="onCompositionStart"?ct==="onCompositionEnd"&&hr&&(Xe=ou()):(no=ye,Ec="value"in no?no.value:no.textContent,hr=!0)),Ie=Zs(de,ct),0<Ie.length&&(ct=new su(ct,e,null,r,ye),_e.push({event:ct,listeners:Ie}),Xe?ct.data=Xe:(Xe=fu(r),Xe!==null&&(ct.data=Xe)))),(Xe=uv?pv(e,r):fv(e,r))&&(ct=Zs(de,"onBeforeInput"),0<ct.length&&(Ie=new su("onBeforeInput","beforeinput",null,r,ye),_e.push({event:Ie,listeners:ct}),Ie.data=Xe)),o_(_e,e,de,r,ye)}Kf(_e,n)})}function Fl(e,n,r){return{instance:e,listener:n,currentTarget:r}}function Zs(e,n){for(var r=n+"Capture",s=[];e!==null;){var h=e,g=h.stateNode;if(h=h.tag,h!==5&&h!==26&&h!==27||g===null||(h=va(e,r),h!=null&&s.unshift(Fl(e,h,g)),h=va(e,n),h!=null&&s.push(Fl(e,h,g))),e.tag===3)return s;e=e.return}return[]}function c_(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5&&e.tag!==27);return e||null}function eh(e,n,r,s,h){for(var g=n._reactName,N=[];r!==null&&r!==s;){var H=r,te=H.alternate,de=H.stateNode;if(H=H.tag,te!==null&&te===s)break;H!==5&&H!==26&&H!==27||de===null||(te=de,h?(de=va(r,g),de!=null&&N.unshift(Fl(r,de,te))):h||(de=va(r,g),de!=null&&N.push(Fl(r,de,te)))),r=r.return}N.length!==0&&e.push({event:n,listeners:N})}var i_=/\r\n?/g,d_=/\u0000|\uFFFD/g;function th(e){return(typeof e=="string"?e:""+e).replace(i_,`
`).replace(d_,"")}function nh(e,n){return n=th(n),th(e)===n}function Ct(e,n,r,s,h,g){switch(r){case"children":typeof s=="string"?n==="body"||n==="textarea"&&s===""||Da(e,s):(typeof s=="number"||typeof s=="bigint")&&n!=="body"&&Da(e,""+s);break;case"className":hn(e,"class",s);break;case"tabIndex":hn(e,"tabindex",s);break;case"dir":case"role":case"viewBox":case"width":case"height":hn(e,r,s);break;case"style":tl(e,s,g);break;case"data":if(n!=="object"){hn(e,"data",s);break}case"src":case"href":if(s===""&&(n!=="a"||r!=="href")){e.removeAttribute(r);break}if(s==null||typeof s=="function"||typeof s=="symbol"||typeof s=="boolean"){e.removeAttribute(r);break}s=Uo(""+s),e.setAttribute(r,s);break;case"action":case"formAction":if(typeof s=="function"){e.setAttribute(r,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof g=="function"&&(r==="formAction"?(n!=="input"&&Ct(e,n,"name",h.name,h,null),Ct(e,n,"formEncType",h.formEncType,h,null),Ct(e,n,"formMethod",h.formMethod,h,null),Ct(e,n,"formTarget",h.formTarget,h,null)):(Ct(e,n,"encType",h.encType,h,null),Ct(e,n,"method",h.method,h,null),Ct(e,n,"target",h.target,h,null)));if(s==null||typeof s=="symbol"||typeof s=="boolean"){e.removeAttribute(r);break}s=Uo(""+s),e.setAttribute(r,s);break;case"onClick":s!=null&&(e.onclick=Bn);break;case"onScroll":s!=null&&rt("scroll",e);break;case"onScrollEnd":s!=null&&rt("scrollend",e);break;case"dangerouslySetInnerHTML":if(s!=null){if(typeof s!="object"||!("__html"in s))throw Error(i(61));if(r=s.__html,r!=null){if(h.children!=null)throw Error(i(60));e.innerHTML=r}}break;case"multiple":e.multiple=s&&typeof s!="function"&&typeof s!="symbol";break;case"muted":e.muted=s&&typeof s!="function"&&typeof s!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(s==null||typeof s=="function"||typeof s=="boolean"||typeof s=="symbol"){e.removeAttribute("xlink:href");break}r=Uo(""+s),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",r);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":s!=null&&typeof s!="function"&&typeof s!="symbol"?e.setAttribute(r,""+s):e.removeAttribute(r);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":s&&typeof s!="function"&&typeof s!="symbol"?e.setAttribute(r,""):e.removeAttribute(r);break;case"capture":case"download":s===!0?e.setAttribute(r,""):s!==!1&&s!=null&&typeof s!="function"&&typeof s!="symbol"?e.setAttribute(r,s):e.removeAttribute(r);break;case"cols":case"rows":case"size":case"span":s!=null&&typeof s!="function"&&typeof s!="symbol"&&!isNaN(s)&&1<=s?e.setAttribute(r,s):e.removeAttribute(r);break;case"rowSpan":case"start":s==null||typeof s=="function"||typeof s=="symbol"||isNaN(s)?e.removeAttribute(r):e.setAttribute(r,s);break;case"popover":rt("beforetoggle",e),rt("toggle",e),tn(e,"popover",s);break;case"xlinkActuate":nn(e,"http://www.w3.org/1999/xlink","xlink:actuate",s);break;case"xlinkArcrole":nn(e,"http://www.w3.org/1999/xlink","xlink:arcrole",s);break;case"xlinkRole":nn(e,"http://www.w3.org/1999/xlink","xlink:role",s);break;case"xlinkShow":nn(e,"http://www.w3.org/1999/xlink","xlink:show",s);break;case"xlinkTitle":nn(e,"http://www.w3.org/1999/xlink","xlink:title",s);break;case"xlinkType":nn(e,"http://www.w3.org/1999/xlink","xlink:type",s);break;case"xmlBase":nn(e,"http://www.w3.org/XML/1998/namespace","xml:base",s);break;case"xmlLang":nn(e,"http://www.w3.org/XML/1998/namespace","xml:lang",s);break;case"xmlSpace":nn(e,"http://www.w3.org/XML/1998/namespace","xml:space",s);break;case"is":tn(e,"is",s);break;case"innerText":case"textContent":break;default:(!(2<r.length)||r[0]!=="o"&&r[0]!=="O"||r[1]!=="n"&&r[1]!=="N")&&(r=es.get(r)||r,tn(e,r,s))}}function ld(e,n,r,s,h,g){switch(r){case"style":tl(e,s,g);break;case"dangerouslySetInnerHTML":if(s!=null){if(typeof s!="object"||!("__html"in s))throw Error(i(61));if(r=s.__html,r!=null){if(h.children!=null)throw Error(i(60));e.innerHTML=r}}break;case"children":typeof s=="string"?Da(e,s):(typeof s=="number"||typeof s=="bigint")&&Da(e,""+s);break;case"onScroll":s!=null&&rt("scroll",e);break;case"onScrollEnd":s!=null&&rt("scrollend",e);break;case"onClick":s!=null&&(e.onclick=Bn);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!xe.hasOwnProperty(r))e:{if(r[0]==="o"&&r[1]==="n"&&(h=r.endsWith("Capture"),n=r.slice(2,h?r.length-7:void 0),g=e[Te]||null,g=g!=null?g[r]:null,typeof g=="function"&&e.removeEventListener(n,g,h),typeof s=="function")){typeof g!="function"&&g!==null&&(r in e?e[r]=null:e.hasAttribute(r)&&e.removeAttribute(r)),e.addEventListener(n,s,h);break e}r in e?e[r]=s:s===!0?e.setAttribute(r,""):tn(e,r,s)}}}function sn(e,n,r){switch(n){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":rt("error",e),rt("load",e);var s=!1,h=!1,g;for(g in r)if(r.hasOwnProperty(g)){var N=r[g];if(N!=null)switch(g){case"src":s=!0;break;case"srcSet":h=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(i(137,n));default:Ct(e,n,g,N,r,null)}}h&&Ct(e,n,"srcSet",r.srcSet,r,null),s&&Ct(e,n,"src",r.src,r,null);return;case"input":rt("invalid",e);var H=g=N=h=null,te=null,de=null;for(s in r)if(r.hasOwnProperty(s)){var ye=r[s];if(ye!=null)switch(s){case"name":h=ye;break;case"type":N=ye;break;case"checked":te=ye;break;case"defaultChecked":de=ye;break;case"value":g=ye;break;case"defaultValue":H=ye;break;case"children":case"dangerouslySetInnerHTML":if(ye!=null)throw Error(i(137,n));break;default:Ct(e,n,s,ye,r,null)}}Io(e,g,H,te,de,N,h,!1);return;case"select":rt("invalid",e),s=N=g=null;for(h in r)if(r.hasOwnProperty(h)&&(H=r[h],H!=null))switch(h){case"value":g=H;break;case"defaultValue":N=H;break;case"multiple":s=H;default:Ct(e,n,h,H,r,null)}n=g,r=N,e.multiple=!!s,n!=null?At(e,!!s,n,!1):r!=null&&At(e,!!s,r,!0);return;case"textarea":rt("invalid",e),g=h=s=null;for(N in r)if(r.hasOwnProperty(N)&&(H=r[N],H!=null))switch(N){case"value":s=H;break;case"defaultValue":h=H;break;case"children":g=H;break;case"dangerouslySetInnerHTML":if(H!=null)throw Error(i(91));break;default:Ct(e,n,N,H,r,null)}Aa(e,s,h,g);return;case"option":for(te in r)if(r.hasOwnProperty(te)&&(s=r[te],s!=null))switch(te){case"selected":e.selected=s&&typeof s!="function"&&typeof s!="symbol";break;default:Ct(e,n,te,s,r,null)}return;case"dialog":rt("beforetoggle",e),rt("toggle",e),rt("cancel",e),rt("close",e);break;case"iframe":case"object":rt("load",e);break;case"video":case"audio":for(s=0;s<Dl.length;s++)rt(Dl[s],e);break;case"image":rt("error",e),rt("load",e);break;case"details":rt("toggle",e);break;case"embed":case"source":case"link":rt("error",e),rt("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(de in r)if(r.hasOwnProperty(de)&&(s=r[de],s!=null))switch(de){case"children":case"dangerouslySetInnerHTML":throw Error(i(137,n));default:Ct(e,n,de,s,r,null)}return;default:if(ur(n)){for(ye in r)r.hasOwnProperty(ye)&&(s=r[ye],s!==void 0&&ld(e,n,ye,s,r,void 0));return}}for(H in r)r.hasOwnProperty(H)&&(s=r[H],s!=null&&Ct(e,n,H,s,r,null))}function u_(e,n,r,s){switch(n){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var h=null,g=null,N=null,H=null,te=null,de=null,ye=null;for(he in r){var _e=r[he];if(r.hasOwnProperty(he)&&_e!=null)switch(he){case"checked":break;case"value":break;case"defaultValue":te=_e;default:s.hasOwnProperty(he)||Ct(e,n,he,null,s,_e)}}for(var pe in s){var he=s[pe];if(_e=r[pe],s.hasOwnProperty(pe)&&(he!=null||_e!=null))switch(pe){case"type":g=he;break;case"name":h=he;break;case"checked":de=he;break;case"defaultChecked":ye=he;break;case"value":N=he;break;case"defaultValue":H=he;break;case"children":case"dangerouslySetInnerHTML":if(he!=null)throw Error(i(137,n));break;default:he!==_e&&Ct(e,n,pe,he,s,_e)}}eo(e,N,H,te,de,ye,g,h);return;case"select":he=N=H=pe=null;for(g in r)if(te=r[g],r.hasOwnProperty(g)&&te!=null)switch(g){case"value":break;case"multiple":he=te;default:s.hasOwnProperty(g)||Ct(e,n,g,null,s,te)}for(h in s)if(g=s[h],te=r[h],s.hasOwnProperty(h)&&(g!=null||te!=null))switch(h){case"value":pe=g;break;case"defaultValue":H=g;break;case"multiple":N=g;default:g!==te&&Ct(e,n,h,g,s,te)}n=H,r=N,s=he,pe!=null?At(e,!!r,pe,!1):!!s!=!!r&&(n!=null?At(e,!!r,n,!0):At(e,!!r,r?[]:"",!1));return;case"textarea":he=pe=null;for(H in r)if(h=r[H],r.hasOwnProperty(H)&&h!=null&&!s.hasOwnProperty(H))switch(H){case"value":break;case"children":break;default:Ct(e,n,H,null,s,h)}for(N in s)if(h=s[N],g=r[N],s.hasOwnProperty(N)&&(h!=null||g!=null))switch(N){case"value":pe=h;break;case"defaultValue":he=h;break;case"children":break;case"dangerouslySetInnerHTML":if(h!=null)throw Error(i(91));break;default:h!==g&&Ct(e,n,N,h,s,g)}dr(e,pe,he);return;case"option":for(var $e in r)if(pe=r[$e],r.hasOwnProperty($e)&&pe!=null&&!s.hasOwnProperty($e))switch($e){case"selected":e.selected=!1;break;default:Ct(e,n,$e,null,s,pe)}for(te in s)if(pe=s[te],he=r[te],s.hasOwnProperty(te)&&pe!==he&&(pe!=null||he!=null))switch(te){case"selected":e.selected=pe&&typeof pe!="function"&&typeof pe!="symbol";break;default:Ct(e,n,te,pe,s,he)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var ze in r)pe=r[ze],r.hasOwnProperty(ze)&&pe!=null&&!s.hasOwnProperty(ze)&&Ct(e,n,ze,null,s,pe);for(de in s)if(pe=s[de],he=r[de],s.hasOwnProperty(de)&&pe!==he&&(pe!=null||he!=null))switch(de){case"children":case"dangerouslySetInnerHTML":if(pe!=null)throw Error(i(137,n));break;default:Ct(e,n,de,pe,s,he)}return;default:if(ur(n)){for(var St in r)pe=r[St],r.hasOwnProperty(St)&&pe!==void 0&&!s.hasOwnProperty(St)&&ld(e,n,St,void 0,s,pe);for(ye in s)pe=s[ye],he=r[ye],!s.hasOwnProperty(ye)||pe===he||pe===void 0&&he===void 0||ld(e,n,ye,pe,s,he);return}}for(var ce in r)pe=r[ce],r.hasOwnProperty(ce)&&pe!=null&&!s.hasOwnProperty(ce)&&Ct(e,n,ce,null,s,pe);for(_e in s)pe=s[_e],he=r[_e],!s.hasOwnProperty(_e)||pe===he||pe==null&&he==null||Ct(e,n,_e,pe,s,he)}function ah(e){switch(e){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function p_(){if(typeof performance.getEntriesByType=="function"){for(var e=0,n=0,r=performance.getEntriesByType("resource"),s=0;s<r.length;s++){var h=r[s],g=h.transferSize,N=h.initiatorType,H=h.duration;if(g&&H&&ah(N)){for(N=0,H=h.responseEnd,s+=1;s<r.length;s++){var te=r[s],de=te.startTime;if(de>H)break;var ye=te.transferSize,_e=te.initiatorType;ye&&ah(_e)&&(te=te.responseEnd,N+=ye*(te<H?1:(H-de)/(te-de)))}if(--s,n+=8*(g+N)/(h.duration/1e3),e++,10<e)break}}if(0<e)return n/e/1e6}return navigator.connection&&(e=navigator.connection.downlink,typeof e=="number")?e:5}var sd=null,cd=null;function Ks(e){return e.nodeType===9?e:e.ownerDocument}function oh(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function rh(e,n){if(e===0)switch(n){case"svg":return 1;case"math":return 2;default:return 0}return e===1&&n==="foreignObject"?0:e}function id(e,n){return e==="textarea"||e==="noscript"||typeof n.children=="string"||typeof n.children=="number"||typeof n.children=="bigint"||typeof n.dangerouslySetInnerHTML=="object"&&n.dangerouslySetInnerHTML!==null&&n.dangerouslySetInnerHTML.__html!=null}var dd=null;function f_(){var e=window.event;return e&&e.type==="popstate"?e===dd?!1:(dd=e,!0):(dd=null,!1)}var lh=typeof setTimeout=="function"?setTimeout:void 0,h_=typeof clearTimeout=="function"?clearTimeout:void 0,sh=typeof Promise=="function"?Promise:void 0,m_=typeof queueMicrotask=="function"?queueMicrotask:typeof sh<"u"?function(e){return sh.resolve(null).then(e).catch(y_)}:lh;function y_(e){setTimeout(function(){throw e})}function xo(e){return e==="head"}function ch(e,n){var r=n,s=0;do{var h=r.nextSibling;if(e.removeChild(r),h&&h.nodeType===8)if(r=h.data,r==="/$"||r==="/&"){if(s===0){e.removeChild(h),Hr(n);return}s--}else if(r==="$"||r==="$?"||r==="$~"||r==="$!"||r==="&")s++;else if(r==="html")ql(e.ownerDocument.documentElement);else if(r==="head"){r=e.ownerDocument.head,ql(r);for(var g=r.firstChild;g;){var N=g.nextSibling,H=g.nodeName;g[Pt]||H==="SCRIPT"||H==="STYLE"||H==="LINK"&&g.rel.toLowerCase()==="stylesheet"||r.removeChild(g),g=N}}else r==="body"&&ql(e.ownerDocument.body);r=h}while(r);Hr(n)}function ih(e,n){var r=e;e=0;do{var s=r.nextSibling;if(r.nodeType===1?n?(r._stashedDisplay=r.style.display,r.style.display="none"):(r.style.display=r._stashedDisplay||"",r.getAttribute("style")===""&&r.removeAttribute("style")):r.nodeType===3&&(n?(r._stashedText=r.nodeValue,r.nodeValue=""):r.nodeValue=r._stashedText||""),s&&s.nodeType===8)if(r=s.data,r==="/$"){if(e===0)break;e--}else r!=="$"&&r!=="$?"&&r!=="$~"&&r!=="$!"||e++;r=s}while(r)}function ud(e){var n=e.firstChild;for(n&&n.nodeType===10&&(n=n.nextSibling);n;){var r=n;switch(n=n.nextSibling,r.nodeName){case"HTML":case"HEAD":case"BODY":ud(r),la(r);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(r.rel.toLowerCase()==="stylesheet")continue}e.removeChild(r)}}function g_(e,n,r,s){for(;e.nodeType===1;){var h=r;if(e.nodeName.toLowerCase()!==n.toLowerCase()){if(!s&&(e.nodeName!=="INPUT"||e.type!=="hidden"))break}else if(s){if(!e[Pt])switch(n){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if(g=e.getAttribute("rel"),g==="stylesheet"&&e.hasAttribute("data-precedence"))break;if(g!==h.rel||e.getAttribute("href")!==(h.href==null||h.href===""?null:h.href)||e.getAttribute("crossorigin")!==(h.crossOrigin==null?null:h.crossOrigin)||e.getAttribute("title")!==(h.title==null?null:h.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(g=e.getAttribute("src"),(g!==(h.src==null?null:h.src)||e.getAttribute("type")!==(h.type==null?null:h.type)||e.getAttribute("crossorigin")!==(h.crossOrigin==null?null:h.crossOrigin))&&g&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else if(n==="input"&&e.type==="hidden"){var g=h.name==null?null:""+h.name;if(h.type==="hidden"&&e.getAttribute("name")===g)return e}else return e;if(e=Jn(e.nextSibling),e===null)break}return null}function v_(e,n,r){if(n==="")return null;for(;e.nodeType!==3;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!r||(e=Jn(e.nextSibling),e===null))return null;return e}function dh(e,n){for(;e.nodeType!==8;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!n||(e=Jn(e.nextSibling),e===null))return null;return e}function pd(e){return e.data==="$?"||e.data==="$~"}function fd(e){return e.data==="$!"||e.data==="$?"&&e.ownerDocument.readyState!=="loading"}function __(e,n){var r=e.ownerDocument;if(e.data==="$~")e._reactRetry=n;else if(e.data!=="$?"||r.readyState!=="loading")n();else{var s=function(){n(),r.removeEventListener("DOMContentLoaded",s)};r.addEventListener("DOMContentLoaded",s),e._reactRetry=s}}function Jn(e){for(;e!=null;e=e.nextSibling){var n=e.nodeType;if(n===1||n===3)break;if(n===8){if(n=e.data,n==="$"||n==="$!"||n==="$?"||n==="$~"||n==="&"||n==="F!"||n==="F")break;if(n==="/$"||n==="/&")return null}}return e}var hd=null;function uh(e){e=e.nextSibling;for(var n=0;e;){if(e.nodeType===8){var r=e.data;if(r==="/$"||r==="/&"){if(n===0)return Jn(e.nextSibling);n--}else r!=="$"&&r!=="$!"&&r!=="$?"&&r!=="$~"&&r!=="&"||n++}e=e.nextSibling}return null}function ph(e){e=e.previousSibling;for(var n=0;e;){if(e.nodeType===8){var r=e.data;if(r==="$"||r==="$!"||r==="$?"||r==="$~"||r==="&"){if(n===0)return e;n--}else r!=="/$"&&r!=="/&"||n++}e=e.previousSibling}return null}function fh(e,n,r){switch(n=Ks(r),e){case"html":if(e=n.documentElement,!e)throw Error(i(452));return e;case"head":if(e=n.head,!e)throw Error(i(453));return e;case"body":if(e=n.body,!e)throw Error(i(454));return e;default:throw Error(i(451))}}function ql(e){for(var n=e.attributes;n.length;)e.removeAttributeNode(n[0]);la(e)}var ea=new Map,hh=new Set;function Js(e){return typeof e.getRootNode=="function"?e.getRootNode():e.nodeType===9?e:e.ownerDocument}var Qa=M.d;M.d={f:x_,r:w_,D:C_,C:S_,L:b_,m:E_,X:k_,S:j_,M:N_};function x_(){var e=Qa.f(),n=Vs();return e||n}function w_(e){var n=xt(e);n!==null&&n.tag===5&&n.type==="form"?Tp(n):Qa.r(e)}var Pr=typeof document>"u"?null:document;function mh(e,n,r){var s=Pr;if(s&&typeof n=="string"&&n){var h=an(n);h='link[rel="'+e+'"][href="'+h+'"]',typeof r=="string"&&(h+='[crossorigin="'+r+'"]'),hh.has(h)||(hh.add(h),e={rel:e,crossOrigin:r,href:n},s.querySelector(h)===null&&(n=s.createElement("link"),sn(n,"link",e),Tt(n),s.head.appendChild(n)))}}function C_(e){Qa.D(e),mh("dns-prefetch",e,null)}function S_(e,n){Qa.C(e,n),mh("preconnect",e,n)}function b_(e,n,r){Qa.L(e,n,r);var s=Pr;if(s&&e&&n){var h='link[rel="preload"][as="'+an(n)+'"]';n==="image"&&r&&r.imageSrcSet?(h+='[imagesrcset="'+an(r.imageSrcSet)+'"]',typeof r.imageSizes=="string"&&(h+='[imagesizes="'+an(r.imageSizes)+'"]')):h+='[href="'+an(e)+'"]';var g=h;switch(n){case"style":g=Or(e);break;case"script":g=Mr(e)}ea.has(g)||(e=v({rel:"preload",href:n==="image"&&r&&r.imageSrcSet?void 0:e,as:n},r),ea.set(g,e),s.querySelector(h)!==null||n==="style"&&s.querySelector($l(g))||n==="script"&&s.querySelector(Ll(g))||(n=s.createElement("link"),sn(n,"link",e),Tt(n),s.head.appendChild(n)))}}function E_(e,n){Qa.m(e,n);var r=Pr;if(r&&e){var s=n&&typeof n.as=="string"?n.as:"script",h='link[rel="modulepreload"][as="'+an(s)+'"][href="'+an(e)+'"]',g=h;switch(s){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":g=Mr(e)}if(!ea.has(g)&&(e=v({rel:"modulepreload",href:e},n),ea.set(g,e),r.querySelector(h)===null)){switch(s){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(r.querySelector(Ll(g)))return}s=r.createElement("link"),sn(s,"link",e),Tt(s),r.head.appendChild(s)}}}function j_(e,n,r){Qa.S(e,n,r);var s=Pr;if(s&&e){var h=Vn(s).hoistableStyles,g=Or(e);n=n||"default";var N=h.get(g);if(!N){var H={loading:0,preload:null};if(N=s.querySelector($l(g)))H.loading=5;else{e=v({rel:"stylesheet",href:e,"data-precedence":n},r),(r=ea.get(g))&&md(e,r);var te=N=s.createElement("link");Tt(te),sn(te,"link",e),te._p=new Promise(function(de,ye){te.onload=de,te.onerror=ye}),te.addEventListener("load",function(){H.loading|=1}),te.addEventListener("error",function(){H.loading|=2}),H.loading|=4,ec(N,n,s)}N={type:"stylesheet",instance:N,count:1,state:H},h.set(g,N)}}}function k_(e,n){Qa.X(e,n);var r=Pr;if(r&&e){var s=Vn(r).hoistableScripts,h=Mr(e),g=s.get(h);g||(g=r.querySelector(Ll(h)),g||(e=v({src:e,async:!0},n),(n=ea.get(h))&&yd(e,n),g=r.createElement("script"),Tt(g),sn(g,"link",e),r.head.appendChild(g)),g={type:"script",instance:g,count:1,state:null},s.set(h,g))}}function N_(e,n){Qa.M(e,n);var r=Pr;if(r&&e){var s=Vn(r).hoistableScripts,h=Mr(e),g=s.get(h);g||(g=r.querySelector(Ll(h)),g||(e=v({src:e,async:!0,type:"module"},n),(n=ea.get(h))&&yd(e,n),g=r.createElement("script"),Tt(g),sn(g,"link",e),r.head.appendChild(g)),g={type:"script",instance:g,count:1,state:null},s.set(h,g))}}function yh(e,n,r,s){var h=(h=ue.current)?Js(h):null;if(!h)throw Error(i(446));switch(e){case"meta":case"title":return null;case"style":return typeof r.precedence=="string"&&typeof r.href=="string"?(n=Or(r.href),r=Vn(h).hoistableStyles,s=r.get(n),s||(s={type:"style",instance:null,count:0,state:null},r.set(n,s)),s):{type:"void",instance:null,count:0,state:null};case"link":if(r.rel==="stylesheet"&&typeof r.href=="string"&&typeof r.precedence=="string"){e=Or(r.href);var g=Vn(h).hoistableStyles,N=g.get(e);if(N||(h=h.ownerDocument||h,N={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},g.set(e,N),(g=h.querySelector($l(e)))&&!g._p&&(N.instance=g,N.state.loading=5),ea.has(e)||(r={rel:"preload",as:"style",href:r.href,crossOrigin:r.crossOrigin,integrity:r.integrity,media:r.media,hrefLang:r.hrefLang,referrerPolicy:r.referrerPolicy},ea.set(e,r),g||R_(h,e,r,N.state))),n&&s===null)throw Error(i(528,""));return N}if(n&&s!==null)throw Error(i(529,""));return null;case"script":return n=r.async,r=r.src,typeof r=="string"&&n&&typeof n!="function"&&typeof n!="symbol"?(n=Mr(r),r=Vn(h).hoistableScripts,s=r.get(n),s||(s={type:"script",instance:null,count:0,state:null},r.set(n,s)),s):{type:"void",instance:null,count:0,state:null};default:throw Error(i(444,e))}}function Or(e){return'href="'+an(e)+'"'}function $l(e){return'link[rel="stylesheet"]['+e+"]"}function gh(e){return v({},e,{"data-precedence":e.precedence,precedence:null})}function R_(e,n,r,s){e.querySelector('link[rel="preload"][as="style"]['+n+"]")?s.loading=1:(n=e.createElement("link"),s.preload=n,n.addEventListener("load",function(){return s.loading|=1}),n.addEventListener("error",function(){return s.loading|=2}),sn(n,"link",r),Tt(n),e.head.appendChild(n))}function Mr(e){return'[src="'+an(e)+'"]'}function Ll(e){return"script[async]"+e}function vh(e,n,r){if(n.count++,n.instance===null)switch(n.type){case"style":var s=e.querySelector('style[data-href~="'+an(r.href)+'"]');if(s)return n.instance=s,Tt(s),s;var h=v({},r,{"data-href":r.href,"data-precedence":r.precedence,href:null,precedence:null});return s=(e.ownerDocument||e).createElement("style"),Tt(s),sn(s,"style",h),ec(s,r.precedence,e),n.instance=s;case"stylesheet":h=Or(r.href);var g=e.querySelector($l(h));if(g)return n.state.loading|=4,n.instance=g,Tt(g),g;s=gh(r),(h=ea.get(h))&&md(s,h),g=(e.ownerDocument||e).createElement("link"),Tt(g);var N=g;return N._p=new Promise(function(H,te){N.onload=H,N.onerror=te}),sn(g,"link",s),n.state.loading|=4,ec(g,r.precedence,e),n.instance=g;case"script":return g=Mr(r.src),(h=e.querySelector(Ll(g)))?(n.instance=h,Tt(h),h):(s=r,(h=ea.get(g))&&(s=v({},r),yd(s,h)),e=e.ownerDocument||e,h=e.createElement("script"),Tt(h),sn(h,"link",s),e.head.appendChild(h),n.instance=h);case"void":return null;default:throw Error(i(443,n.type))}else n.type==="stylesheet"&&(n.state.loading&4)===0&&(s=n.instance,n.state.loading|=4,ec(s,r.precedence,e));return n.instance}function ec(e,n,r){for(var s=r.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),h=s.length?s[s.length-1]:null,g=h,N=0;N<s.length;N++){var H=s[N];if(H.dataset.precedence===n)g=H;else if(g!==h)break}g?g.parentNode.insertBefore(e,g.nextSibling):(n=r.nodeType===9?r.head:r,n.insertBefore(e,n.firstChild))}function md(e,n){e.crossOrigin==null&&(e.crossOrigin=n.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=n.referrerPolicy),e.title==null&&(e.title=n.title)}function yd(e,n){e.crossOrigin==null&&(e.crossOrigin=n.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=n.referrerPolicy),e.integrity==null&&(e.integrity=n.integrity)}var tc=null;function _h(e,n,r){if(tc===null){var s=new Map,h=tc=new Map;h.set(r,s)}else h=tc,s=h.get(r),s||(s=new Map,h.set(r,s));if(s.has(e))return s;for(s.set(e,null),r=r.getElementsByTagName(e),h=0;h<r.length;h++){var g=r[h];if(!(g[Pt]||g[Ae]||e==="link"&&g.getAttribute("rel")==="stylesheet")&&g.namespaceURI!=="http://www.w3.org/2000/svg"){var N=g.getAttribute(n)||"";N=e+N;var H=s.get(N);H?H.push(g):s.set(N,[g])}}return s}function xh(e,n,r){e=e.ownerDocument||e,e.head.insertBefore(r,n==="title"?e.querySelector("head > title"):null)}function T_(e,n,r){if(r===1||n.itemProp!=null)return!1;switch(e){case"meta":case"title":return!0;case"style":if(typeof n.precedence!="string"||typeof n.href!="string"||n.href==="")break;return!0;case"link":if(typeof n.rel!="string"||typeof n.href!="string"||n.href===""||n.onLoad||n.onError)break;switch(n.rel){case"stylesheet":return e=n.disabled,typeof n.precedence=="string"&&e==null;default:return!0}case"script":if(n.async&&typeof n.async!="function"&&typeof n.async!="symbol"&&!n.onLoad&&!n.onError&&n.src&&typeof n.src=="string")return!0}return!1}function wh(e){return!(e.type==="stylesheet"&&(e.state.loading&3)===0)}function A_(e,n,r,s){if(r.type==="stylesheet"&&(typeof s.media!="string"||matchMedia(s.media).matches!==!1)&&(r.state.loading&4)===0){if(r.instance===null){var h=Or(s.href),g=n.querySelector($l(h));if(g){n=g._p,n!==null&&typeof n=="object"&&typeof n.then=="function"&&(e.count++,e=nc.bind(e),n.then(e,e)),r.state.loading|=4,r.instance=g,Tt(g);return}g=n.ownerDocument||n,s=gh(s),(h=ea.get(h))&&md(s,h),g=g.createElement("link"),Tt(g);var N=g;N._p=new Promise(function(H,te){N.onload=H,N.onerror=te}),sn(g,"link",s),r.instance=g}e.stylesheets===null&&(e.stylesheets=new Map),e.stylesheets.set(r,n),(n=r.state.preload)&&(r.state.loading&3)===0&&(e.count++,r=nc.bind(e),n.addEventListener("load",r),n.addEventListener("error",r))}}var gd=0;function D_(e,n){return e.stylesheets&&e.count===0&&oc(e,e.stylesheets),0<e.count||0<e.imgCount?function(r){var s=setTimeout(function(){if(e.stylesheets&&oc(e,e.stylesheets),e.unsuspend){var g=e.unsuspend;e.unsuspend=null,g()}},6e4+n);0<e.imgBytes&&gd===0&&(gd=62500*p_());var h=setTimeout(function(){if(e.waitingForImages=!1,e.count===0&&(e.stylesheets&&oc(e,e.stylesheets),e.unsuspend)){var g=e.unsuspend;e.unsuspend=null,g()}},(e.imgBytes>gd?50:800)+n);return e.unsuspend=r,function(){e.unsuspend=null,clearTimeout(s),clearTimeout(h)}}:null}function nc(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)oc(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}}var ac=null;function oc(e,n){e.stylesheets=null,e.unsuspend!==null&&(e.count++,ac=new Map,n.forEach(F_,e),ac=null,nc.call(e))}function F_(e,n){if(!(n.state.loading&4)){var r=ac.get(e);if(r)var s=r.get(null);else{r=new Map,ac.set(e,r);for(var h=e.querySelectorAll("link[data-precedence],style[data-precedence]"),g=0;g<h.length;g++){var N=h[g];(N.nodeName==="LINK"||N.getAttribute("media")!=="not all")&&(r.set(N.dataset.precedence,N),s=N)}s&&r.set(null,s)}h=n.instance,N=h.getAttribute("data-precedence"),g=r.get(N)||s,g===s&&r.set(null,h),r.set(N,h),this.count++,s=nc.bind(this),h.addEventListener("load",s),h.addEventListener("error",s),g?g.parentNode.insertBefore(h,g.nextSibling):(e=e.nodeType===9?e.head:e,e.insertBefore(h,e.firstChild)),n.state.loading|=4}}var Il={$$typeof:R,Provider:null,Consumer:null,_currentValue:B,_currentValue2:B,_threadCount:0};function q_(e,n,r,s,h,g,N,H,te){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=kn(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=kn(0),this.hiddenUpdates=kn(null),this.identifierPrefix=s,this.onUncaughtError=h,this.onCaughtError=g,this.onRecoverableError=N,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=te,this.incompleteTransitions=new Map}function Ch(e,n,r,s,h,g,N,H,te,de,ye,_e){return e=new q_(e,n,r,N,te,de,ye,_e,H),n=1,g===!0&&(n|=24),g=Tn(3,null,null,n),e.current=g,g.stateNode=e,n=Xc(),n.refCount++,e.pooledCache=n,n.refCount++,g.memoizedState={element:s,isDehydrated:r,cache:n},ei(g),e}function Sh(e){return e?(e=vr,e):vr}function bh(e,n,r,s,h,g){h=Sh(h),s.context===null?s.context=h:s.pendingContext=h,s=co(n),s.payload={element:r},g=g===void 0?null:g,g!==null&&(s.callback=g),r=io(e,s,n),r!==null&&(Cn(r,e,n),ml(r,e,n))}function Eh(e,n){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var r=e.retryLane;e.retryLane=r!==0&&r<n?r:n}}function vd(e,n){Eh(e,n),(e=e.alternate)&&Eh(e,n)}function jh(e){if(e.tag===13||e.tag===31){var n=zo(e,67108864);n!==null&&Cn(n,e,67108864),vd(e,67108864)}}function kh(e){if(e.tag===13||e.tag===31){var n=$n();n=zn(n);var r=zo(e,n);r!==null&&Cn(r,e,n),vd(e,n)}}var rc=!0;function $_(e,n,r,s){var h=q.T;q.T=null;var g=M.p;try{M.p=2,_d(e,n,r,s)}finally{M.p=g,q.T=h}}function L_(e,n,r,s){var h=q.T;q.T=null;var g=M.p;try{M.p=8,_d(e,n,r,s)}finally{M.p=g,q.T=h}}function _d(e,n,r,s){if(rc){var h=xd(s);if(h===null)rd(e,n,s,lc,r),Rh(e,s);else if(U_(h,e,n,r,s))s.stopPropagation();else if(Rh(e,s),n&4&&-1<I_.indexOf(e)){for(;h!==null;){var g=xt(h);if(g!==null)switch(g.tag){case 3:if(g=g.stateNode,g.current.memoizedState.isDehydrated){var N=fn(g.pendingLanes);if(N!==0){var H=g;for(H.pendingLanes|=2,H.entangledLanes|=2;N;){var te=1<<31-Ut(N);H.entanglements[1]|=te,N&=~te}Ca(g),(yt&6)===0&&(Hs=Oe()+500,Al(0))}}break;case 31:case 13:H=zo(g,2),H!==null&&Cn(H,g,2),Vs(),vd(g,2)}if(g=xd(s),g===null&&rd(e,n,s,lc,r),g===h)break;h=g}h!==null&&s.stopPropagation()}else rd(e,n,s,null,r)}}function xd(e){return e=fr(e),wd(e)}var lc=null;function wd(e){if(lc=null,e=zt(e),e!==null){var n=d(e);if(n===null)e=null;else{var r=n.tag;if(r===13){if(e=f(n),e!==null)return e;e=null}else if(r===31){if(e=u(n),e!==null)return e;e=null}else if(r===3){if(n.stateNode.current.memoizedState.isDehydrated)return n.tag===3?n.stateNode.containerInfo:null;e=null}else n!==e&&(e=null)}}return lc=e,null}function Nh(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Rt()){case tt:return 2;case It:return 8;case Zt:case En:return 32;case On:return 268435456;default:return 32}default:return 32}}var Cd=!1,wo=null,Co=null,So=null,Ul=new Map,Pl=new Map,bo=[],I_="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Rh(e,n){switch(e){case"focusin":case"focusout":wo=null;break;case"dragenter":case"dragleave":Co=null;break;case"mouseover":case"mouseout":So=null;break;case"pointerover":case"pointerout":Ul.delete(n.pointerId);break;case"gotpointercapture":case"lostpointercapture":Pl.delete(n.pointerId)}}function Ol(e,n,r,s,h,g){return e===null||e.nativeEvent!==g?(e={blockedOn:n,domEventName:r,eventSystemFlags:s,nativeEvent:g,targetContainers:[h]},n!==null&&(n=xt(n),n!==null&&jh(n)),e):(e.eventSystemFlags|=s,n=e.targetContainers,h!==null&&n.indexOf(h)===-1&&n.push(h),e)}function U_(e,n,r,s,h){switch(n){case"focusin":return wo=Ol(wo,e,n,r,s,h),!0;case"dragenter":return Co=Ol(Co,e,n,r,s,h),!0;case"mouseover":return So=Ol(So,e,n,r,s,h),!0;case"pointerover":var g=h.pointerId;return Ul.set(g,Ol(Ul.get(g)||null,e,n,r,s,h)),!0;case"gotpointercapture":return g=h.pointerId,Pl.set(g,Ol(Pl.get(g)||null,e,n,r,s,h)),!0}return!1}function Th(e){var n=zt(e.target);if(n!==null){var r=d(n);if(r!==null){if(n=r.tag,n===13){if(n=f(r),n!==null){e.blockedOn=n,ke(e.priority,function(){kh(r)});return}}else if(n===31){if(n=u(r),n!==null){e.blockedOn=n,ke(e.priority,function(){kh(r)});return}}else if(n===3&&r.stateNode.current.memoizedState.isDehydrated){e.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}e.blockedOn=null}function sc(e){if(e.blockedOn!==null)return!1;for(var n=e.targetContainers;0<n.length;){var r=xd(e.nativeEvent);if(r===null){r=e.nativeEvent;var s=new r.constructor(r.type,r);pr=s,r.target.dispatchEvent(s),pr=null}else return n=xt(r),n!==null&&jh(n),e.blockedOn=r,!1;n.shift()}return!0}function Ah(e,n,r){sc(e)&&r.delete(n)}function P_(){Cd=!1,wo!==null&&sc(wo)&&(wo=null),Co!==null&&sc(Co)&&(Co=null),So!==null&&sc(So)&&(So=null),Ul.forEach(Ah),Pl.forEach(Ah)}function cc(e,n){e.blockedOn===n&&(e.blockedOn=null,Cd||(Cd=!0,a.unstable_scheduleCallback(a.unstable_NormalPriority,P_)))}var ic=null;function Dh(e){ic!==e&&(ic=e,a.unstable_scheduleCallback(a.unstable_NormalPriority,function(){ic===e&&(ic=null);for(var n=0;n<e.length;n+=3){var r=e[n],s=e[n+1],h=e[n+2];if(typeof s!="function"){if(wd(s||r)===null)continue;break}var g=xt(r);g!==null&&(e.splice(n,3),n-=3,xi(g,{pending:!0,data:h,method:r.method,action:s},s,h))}}))}function Hr(e){function n(te){return cc(te,e)}wo!==null&&cc(wo,e),Co!==null&&cc(Co,e),So!==null&&cc(So,e),Ul.forEach(n),Pl.forEach(n);for(var r=0;r<bo.length;r++){var s=bo[r];s.blockedOn===e&&(s.blockedOn=null)}for(;0<bo.length&&(r=bo[0],r.blockedOn===null);)Th(r),r.blockedOn===null&&bo.shift();if(r=(e.ownerDocument||e).$$reactFormReplay,r!=null)for(s=0;s<r.length;s+=3){var h=r[s],g=r[s+1],N=h[Te]||null;if(typeof g=="function")N||Dh(r);else if(N){var H=null;if(g&&g.hasAttribute("formAction")){if(h=g,N=g[Te]||null)H=N.formAction;else if(wd(h)!==null)continue}else H=N.action;typeof H=="function"?r[s+1]=H:(r.splice(s,3),s-=3),Dh(r)}}}function Fh(){function e(g){g.canIntercept&&g.info==="react-transition"&&g.intercept({handler:function(){return new Promise(function(N){return h=N})},focusReset:"manual",scroll:"manual"})}function n(){h!==null&&(h(),h=null),s||setTimeout(r,20)}function r(){if(!s&&!navigation.transition){var g=navigation.currentEntry;g&&g.url!=null&&navigation.navigate(g.url,{state:g.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var s=!1,h=null;return navigation.addEventListener("navigate",e),navigation.addEventListener("navigatesuccess",n),navigation.addEventListener("navigateerror",n),setTimeout(r,100),function(){s=!0,navigation.removeEventListener("navigate",e),navigation.removeEventListener("navigatesuccess",n),navigation.removeEventListener("navigateerror",n),h!==null&&(h(),h=null)}}}function Sd(e){this._internalRoot=e}dc.prototype.render=Sd.prototype.render=function(e){var n=this._internalRoot;if(n===null)throw Error(i(409));var r=n.current,s=$n();bh(r,s,e,n,null,null)},dc.prototype.unmount=Sd.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var n=e.containerInfo;bh(e.current,2,null,e,null,null),Vs(),n[He]=null}};function dc(e){this._internalRoot=e}dc.prototype.unstable_scheduleHydration=function(e){if(e){var n=fe();e={blockedOn:null,target:e,priority:n};for(var r=0;r<bo.length&&n!==0&&n<bo[r].priority;r++);bo.splice(r,0,e),r===0&&Th(e)}};var qh=t.version;if(qh!=="19.2.3")throw Error(i(527,qh,"19.2.3"));M.findDOMNode=function(e){var n=e._reactInternals;if(n===void 0)throw typeof e.render=="function"?Error(i(188)):(e=Object.keys(e).join(","),Error(i(268,e)));return e=m(n),e=e!==null?y(e):null,e=e===null?null:e.stateNode,e};var O_={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:q,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var uc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!uc.isDisabled&&uc.supportsFiber)try{yn=uc.inject(O_),Ft=uc}catch{}}return Hl.createRoot=function(e,n){if(!c(e))throw Error(i(299));var r=!1,s="",h=Op,g=Mp,N=Hp;return n!=null&&(n.unstable_strictMode===!0&&(r=!0),n.identifierPrefix!==void 0&&(s=n.identifierPrefix),n.onUncaughtError!==void 0&&(h=n.onUncaughtError),n.onCaughtError!==void 0&&(g=n.onCaughtError),n.onRecoverableError!==void 0&&(N=n.onRecoverableError)),n=Ch(e,1,!1,null,null,r,s,null,h,g,N,Fh),e[He]=n.current,od(e),new Sd(n)},Hl.hydrateRoot=function(e,n,r){if(!c(e))throw Error(i(299));var s=!1,h="",g=Op,N=Mp,H=Hp,te=null;return r!=null&&(r.unstable_strictMode===!0&&(s=!0),r.identifierPrefix!==void 0&&(h=r.identifierPrefix),r.onUncaughtError!==void 0&&(g=r.onUncaughtError),r.onCaughtError!==void 0&&(N=r.onCaughtError),r.onRecoverableError!==void 0&&(H=r.onRecoverableError),r.formState!==void 0&&(te=r.formState)),n=Ch(e,1,!0,n,r??null,s,h,te,g,N,H,Fh),n.context=Sh(null),r=n.current,s=$n(),s=zn(s),h=co(s),h.callback=null,io(r,h,s),r=s,n.current.lanes=r,Nn(n,r),Ca(n),e[He]=n.current,od(e),new dc(n)},Hl.version="19.2.3",Hl}var Vh;function X_(){if(Vh)return Ed.exports;Vh=1;function a(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(a)}catch(t){console.error(t)}}return a(),Ed.exports=Q_(),Ed.exports}var Z_=X_(),se=Bd();/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const bt=({card:a,onPointerDown:t,onPointerEnter:l,onPointerLeave:i,isFaceUp:c,faceDownValue:d=2,isSelected:f,isMultiSelected:u,isTargetable:p,isSourceOfEffect:m,style:y,additionalClassName:v,animationState:x})=>{const w=G=>G.replace(/<[^>]*>/g,"").length,S=({content:G,className:V})=>{const z=w(G),U=z>95,A=z>140?"very-long-text":U?"long-text":"";return o.jsx("div",{className:`card-rule-box ${V||""} ${A}`,dangerouslySetInnerHTML:{__html:G}})},b=(x==null?void 0:x.type)==="playCard"&&x.cardId===a.id?`is-entering-${x.owner}`:"",C=(x==null?void 0:x.type)==="deleteCard"&&x.cardId===a.id?`is-deleting-${x.owner}`:"",R=(x==null?void 0:x.type)==="drawCard"||(x==null?void 0:x.type)==="discardCard"?x.owner:void 0,F=R==="player"&&(x==null?void 0:x.type)==="drawCard"&&x.cardIds.includes(a.id),L=R==="player"&&(x==null?void 0:x.type)==="discardCard"&&x.cardIds.includes(a.id),O=["card-component"];a.protocol&&O.push(`card-protocol-${a.protocol.toLowerCase()}`),a.color&&O.push("has-custom-color"),a.pattern&&O.push(`card-pattern-${a.pattern}`),f&&O.push("selected"),u&&O.push("multi-selected"),L&&O.push("is-discarding"),p&&O.push("is-targetable"),m&&O.push("is-source-of-effect"),b&&O.push(b),C&&O.push(C),F&&O.push("is-drawing"),v&&O.push(v);const T={...y};return a.color&&(T["--card-custom-color"]=a.color),o.jsx("div",{className:O.join(" "),onPointerDown:t,onPointerEnter:l,onPointerLeave:i,role:"button",tabIndex:t?0:-1,style:T,children:o.jsxs("div",{className:`card-inner ${c?"":"is-flipped"}`,children:[o.jsxs("div",{className:"card-face card-front",children:[o.jsxs("div",{className:"card-header",children:[o.jsx("span",{className:`card-protocol ${a.protocol.length<=10?"short-protocol":""}`,children:a.protocol.slice(0,10)}),o.jsx("span",{className:"card-value",children:a.value})]}),o.jsxs("div",{className:"card-body",children:[o.jsx(S,{content:a.top,className:"card-rule-top"}),o.jsx(S,{content:a.middle,className:"card-rule-middle"}),o.jsx(S,{content:a.bottom,className:"card-rule-bottom"})]})]}),o.jsx("div",{className:"card-face card-back",children:o.jsx("div",{className:"card-back-value",children:d})})]})})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const In=[{protocol:"Apathy",value:0,top:"Your total value in this line is increased by 1 for each face-down card in this line.",middle:"",bottom:"",keywords:{},category:"Aux 1"},{protocol:"Apathy",value:1,top:"",middle:"Flip all other face-up cards in this line.",bottom:"",keywords:{flip:!0},category:"Aux 1"},{protocol:"Apathy",value:2,top:"Ignore all middle commands of cards in this line.",middle:"",bottom:"<div><span class='emphasis'>When this card would be covered:</span> First, flip this card.</div>",keywords:{flip:!0},category:"Aux 1"},{protocol:"Apathy",value:3,top:"",middle:"Flip 1 of your opponent's face-up cards.",bottom:"",keywords:{flip:!0},category:"Aux 1"},{protocol:"Apathy",value:4,top:"",middle:"You may flip 1 of your face-up covered cards.",bottom:"",keywords:{flip:!0},category:"Aux 1"},{protocol:"Apathy",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Aux 1"},{protocol:"Chaos",value:0,top:"",middle:"In each line, flip 1 covered card.",bottom:"<div><span class='emphasis'>Start:</span> Draw the top card of your opponent's deck. Your opponent draws the top card of your deck.</div>",keywords:{flip:!0,draw:!0},category:"Main 2"},{protocol:"Chaos",value:1,top:"",middle:"Rearrange your protocols. Rearrange your opponent's protocols.",bottom:"",keywords:{},category:"Main 2"},{protocol:"Chaos",value:2,top:"",middle:"Shift 1 of your covered cards.",bottom:"",keywords:{shift:!0},category:"Main 2"},{protocol:"Chaos",value:3,top:"",middle:"",bottom:"You may play cards without matching protocols.",keywords:{play:!0},category:"Main 2"},{protocol:"Chaos",value:4,top:"",middle:"",bottom:"<div><span class='emphasis'>End:</span> Discard your hand. Draw the same amount of cards.</div>",keywords:{discard:!0,draw:!0},category:"Main 2"},{protocol:"Chaos",value:5,top:"",middle:"Discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 2"},{protocol:"Darkness",value:0,top:"",middle:"Draw 3 cards. Shift 1 of your opponent's covered cards.",bottom:"",keywords:{draw:!0,shift:!0},category:"Main 1"},{protocol:"Darkness",value:1,top:"",middle:"Flip 1 of your opponent's cards. You may shift that card.",bottom:"",keywords:{flip:!0,shift:!0},category:"Main 1"},{protocol:"Darkness",value:2,top:"All face-down cards in this stack have a value of 4.",middle:"You may flip 1 covered card in this line.",bottom:"",keywords:{flip:!0},category:"Main 1"},{protocol:"Darkness",value:3,top:"",middle:"Play 1 card face-down in another line.",bottom:"",keywords:{play:!0},category:"Main 1"},{protocol:"Darkness",value:4,top:"",middle:"Shift 1 face-down card.",bottom:"",keywords:{shift:!0},category:"Main 1"},{protocol:"Darkness",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Death",value:0,top:"",middle:"Delete 1 card from each other line.",bottom:"",keywords:{delete:!0},category:"Main 1"},{protocol:"Death",value:1,top:"<div><span class='emphasis'>Start:</span> You may draw 1 card. If you do, delete 1 other card, then delete this card.</div>",middle:"",bottom:"",keywords:{draw:!0,delete:!0},category:"Main 1"},{protocol:"Death",value:2,top:"",middle:"Delete all cards in 1 line with values of 1 or 2.",bottom:"",keywords:{delete:!0},category:"Main 1"},{protocol:"Death",value:3,top:"",middle:"Delete 1 face-down card.",bottom:"",keywords:{delete:!0},category:"Main 1"},{protocol:"Death",value:4,top:"",middle:"Delete a card with a value of 0 or 1.",bottom:"",keywords:{delete:!0},category:"Main 1"},{protocol:"Death",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Fire",value:0,top:"",middle:"Flip 1 other card. Draw 2 cards.",bottom:"<div><span class='emphasis'>When this card would be covered:</span> First, draw 1 card and flip 1 other card.</div>",keywords:{draw:!0,flip:!0},category:"Main 1"},{protocol:"Fire",value:1,top:"",middle:"Discard 1 card. If you do, delete 1 card.",bottom:"",keywords:{delete:!0,discard:!0},category:"Main 1"},{protocol:"Fire",value:2,top:"",middle:"Discard 1 card. If you do, return 1 card.",bottom:"",keywords:{discard:!0,return:!0},category:"Main 1"},{protocol:"Fire",value:3,top:"",middle:"",bottom:"<div><span class='emphasis'>End:</span> You may discard 1 card. If you do, flip 1 card.</div>",keywords:{discard:!0,flip:!0},category:"Main 1"},{protocol:"Fire",value:4,top:"",middle:"Discard 1 or more cards. Draw the amount discarded plus 1.",bottom:"",keywords:{discard:!0,draw:!0},category:"Main 1"},{protocol:"Fire",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Gravity",value:0,top:"",middle:"For every 2 cards in this line, play the top card of your deck face-down under this card.",bottom:"",keywords:{play:!0},category:"Main 1"},{protocol:"Gravity",value:1,top:"",middle:"Draw 2 cards. Shift 1 card either to or from this line.",bottom:"",keywords:{draw:!0,shift:!0},category:"Main 1"},{protocol:"Gravity",value:2,top:"",middle:"Flip 1 card. Shift that card to this line.",bottom:"",keywords:{flip:!0,shift:!0},category:"Main 1"},{protocol:"Gravity",value:4,top:"",middle:"Shift 1 face-down card to this line.",bottom:"",keywords:{shift:!0},category:"Main 1"},{protocol:"Gravity",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Gravity",value:6,top:"",middle:"Your opponent plays the top card of their deck face-down in this line.",bottom:"",keywords:{play:!0},category:"Main 1"},{protocol:"Hate",value:0,top:"",middle:"Delete 1 card.",bottom:"",keywords:{delete:!0},category:"Aux 1"},{protocol:"Hate",value:1,top:"",middle:"Discard 3 cards. Delete 1 card. Delete 1 card.",bottom:"",keywords:{delete:!0,discard:!0},category:"Aux 1"},{protocol:"Hate",value:2,top:"",middle:"Delete your highest value uncovered card. Delete your opponent's highest value uncovered card.",bottom:"",keywords:{delete:!0},category:"Aux 1"},{protocol:"Hate",value:3,top:"<div><span class='emphasis'>After you delete cards:</span> Draw 1 card.</div>",middle:"",bottom:"",keywords:{draw:!0},category:"Aux 1"},{protocol:"Hate",value:4,top:"",middle:"",bottom:"<div><span class='emphasis'>When this card would be covered:</span> First, delete the lowest value covered card in this line.</div>",keywords:{delete:!0},category:"Aux 1"},{protocol:"Hate",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Aux 1"},{protocol:"Life",value:0,top:"",middle:"Play the top card of your deck face-down in each line where you have a card.",bottom:"<div><span class='emphasis'>When this card would be covered:</span> First, delete this card.</div>",keywords:{delete:!0,play:!0},category:"Main 1"},{protocol:"Life",value:1,top:"",middle:"Flip 1 card. Flip 1 card.",bottom:"",keywords:{flip:!0},category:"Main 1"},{protocol:"Life",value:2,top:"",middle:"Draw 1 card. You may flip 1 face-down card.",bottom:"",keywords:{draw:!0,flip:!0},category:"Main 1"},{protocol:"Life",value:3,top:"",middle:"",bottom:"<div><span class='emphasis'>When this card would be covered:</span> First, play the top card of your deck face-down in another line.</div>",keywords:{play:!0},category:"Main 1"},{protocol:"Life",value:4,top:"",middle:"If this card is covering a card, draw 1 card.",bottom:"",keywords:{draw:!0},category:"Main 1"},{protocol:"Life",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Light",value:0,top:"",middle:"Flip 1 card. Draw cards equal to that card's value.",bottom:"",keywords:{draw:!0,flip:!0},category:"Main 1"},{protocol:"Light",value:1,top:"",middle:"",bottom:"<div><span class='emphasis'>End:</span> Draw 1 card.</div>",keywords:{draw:!0},category:"Main 1"},{protocol:"Light",value:2,top:"",middle:"Draw 2 cards. Reveal 1 face-down card. You may shift or flip that card.",bottom:"",keywords:{draw:!0,flip:!0,reveal:!0,shift:!0},category:"Main 1"},{protocol:"Light",value:3,top:"",middle:"Shift all face-down cards in this line to another line.",bottom:"",keywords:{shift:!0},category:"Main 1"},{protocol:"Light",value:4,top:"",middle:"Your opponent reveals their hand.",bottom:"",keywords:{reveal:!0},category:"Main 1"},{protocol:"Light",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Love",value:1,top:"",middle:"Draw the top card of your opponent's deck.",bottom:"<div><span class='emphasis'>End:</span> You may give 1 card from your hand to your opponent. If you do, draw 2 cards.</div>",keywords:{draw:!0,give:!0},category:"Aux 1"},{protocol:"Love",value:2,top:"",middle:"Your opponent draws 1 card. Refresh.",bottom:"",keywords:{draw:!0,refresh:!0},category:"Aux 1"},{protocol:"Love",value:3,top:"",middle:"Take 1 random card from your opponent's hand. Give 1 card from your hand to your opponent.",bottom:"",keywords:{give:!0,take:!0},category:"Aux 1"},{protocol:"Love",value:4,top:"",middle:"Reveal 1 card from your hand. Flip 1 card.",bottom:"",keywords:{flip:!0,reveal:!0},category:"Aux 1"},{protocol:"Love",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Aux 1"},{protocol:"Love",value:6,top:"",middle:"Your opponent draws 2 cards.",bottom:"",keywords:{draw:!0},category:"Aux 1"},{protocol:"Metal",value:0,top:"Your opponent's total value in this line is reduced by 2.",middle:"Flip 1 card.",bottom:"",keywords:{flip:!0},category:"Main 1"},{protocol:"Metal",value:1,top:"",middle:"Draw 2 cards. Your opponent cannot compile next turn.",bottom:"",keywords:{draw:!0},category:"Main 1"},{protocol:"Metal",value:2,top:"Your opponent cannot play cards face-down in this line.",middle:"",bottom:"",keywords:{},category:"Main 1"},{protocol:"Metal",value:3,top:"",middle:"Draw 1 card. Delete all cards in 1 other line with 8 or more cards.",bottom:"",keywords:{delete:!0,draw:!0},category:"Main 1"},{protocol:"Metal",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Metal",value:6,top:"<div><span class='emphasis'>When this card would be covered or flipped:</span> First, delete this card.</div>",middle:"",bottom:"",keywords:{delete:!0},category:"Main 1"},{protocol:"Plague",value:0,top:"",middle:"Your opponent discards 1 card.",bottom:"Your opponent cannot play cards in this line.",keywords:{discard:!0},category:"Main 1"},{protocol:"Plague",value:1,top:"<div><span class='emphasis'>After your opponent discards cards:</span> Draw 1 card.</div>",middle:"Your opponent discards 1 card.",bottom:"",keywords:{discard:!0,draw:!0},category:"Main 1"},{protocol:"Plague",value:2,top:"",middle:"Dicard 1 or more cards. Your opponent discards the amount of cards discarded plus 1.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Plague",value:3,top:"",middle:"Flip each other face-up card.",bottom:"",keywords:{flip:!0},category:"Main 1"},{protocol:"Plague",value:4,top:"",middle:"",bottom:"<div><span class='emphasis'>End:</span> Your opponent deletes 1 of their face-down cards. You may flip this card.</div>",keywords:{delete:!0,flip:!0},category:"Main 1"},{protocol:"Plague",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Psychic",value:0,top:"",middle:"Draw 2 cards. Your opponent discards 2 cards, then reveals their hand.",bottom:"",keywords:{discard:!0,draw:!0,reveal:!0},category:"Main 1"},{protocol:"Psychic",value:1,top:"Your opponent can only play cards face-down.",middle:"",bottom:"<div><span class='emphasis'>Start:</span> Flip this card.</div>",keywords:{flip:!0},category:"Main 1"},{protocol:"Psychic",value:2,top:"",middle:"Your opponent discards 2 cards. Rearrange their protocols.",bottom:"",keywords:{discard:!0,rearrange:!0},category:"Main 1"},{protocol:"Psychic",value:3,top:"",middle:"Your opponent discards 1 card. Shift 1 of their cards.",bottom:"",keywords:{discard:!0,shift:!0},category:"Main 1"},{protocol:"Psychic",value:4,top:"",middle:"",bottom:"<div><span class='emphasis'>End:</span> You may return 1 of your opponent's cards. If you do, flip this card.</div>",keywords:{flip:!0,return:!0},category:"Main 1"},{protocol:"Psychic",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Speed",value:0,top:"",middle:"Play 1 card.",bottom:"",keywords:{play:!0},category:"Main 1"},{protocol:"Speed",value:1,top:"<div><span class='emphasis'>After you clear cache:</span> Draw 1 card.</div>",middle:"Draw 2 cards.",bottom:"",keywords:{draw:!0},category:"Main 1"},{protocol:"Speed",value:2,top:"<div><span class='emphasis'>When this card would be deleted by compiling:</span> Shift this card, even if this card is covered.</div>",middle:"",bottom:"",keywords:{shift:!0},category:"Main 1"},{protocol:"Speed",value:3,top:"",middle:"Shift 1 of your other cards.",bottom:"<div><span class='emphasis'>End:</span> You may shift 1 of your cards. If you do, flip this card.</div>",keywords:{flip:!0,shift:!0},category:"Main 1"},{protocol:"Speed",value:4,top:"",middle:"Shift 1 of your opponent's face-down cards.",bottom:"",keywords:{shift:!0},category:"Main 1"},{protocol:"Speed",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Spirit",value:0,top:"",middle:"Refresh. Draw 1 card.",bottom:"Skip your check cache phase.",keywords:{draw:!0,refresh:!0},category:"Main 1"},{protocol:"Spirit",value:1,top:"You can play cards in any line.",middle:"Draw 2 cards.",bottom:"<div><span class='emphasis'>Start:</span> Either discard 1 card or flip this card.</div>",keywords:{discard:!0,draw:!0,flip:!0},category:"Main 1"},{protocol:"Spirit",value:2,top:"",middle:"You may flip 1 card.",bottom:"",keywords:{flip:!0},category:"Main 1"},{protocol:"Spirit",value:3,top:"<div><span class='emphasis'>After you draw cards:</span> You may shift this card, even if this card is covered.</div>",middle:"",bottom:"",keywords:{shift:!0},category:"Main 1"},{protocol:"Spirit",value:4,top:"",middle:"Swap the positions of 2 of your protocols",bottom:"",keywords:{swap:!0},category:"Main 1"},{protocol:"Spirit",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Water",value:0,top:"",middle:"Flip 1 other card. Flip this card.",bottom:"",keywords:{flip:!0},category:"Main 1"},{protocol:"Water",value:1,top:"",middle:"Play the top card of your deck face-down in each other line.",bottom:"",keywords:{play:!0},category:"Main 1"},{protocol:"Water",value:2,top:"",middle:"Draw 2 cards. Rearrange your protocols.",bottom:"",keywords:{draw:!0,rearrange:!0},category:"Main 1"},{protocol:"Water",value:3,top:"",middle:"Return all cards with a value of 2 in 1 line.",bottom:"",keywords:{return:!0},category:"Main 1"},{protocol:"Water",value:4,top:"",middle:"Return 1 of your cards.",bottom:"",keywords:{return:!0},category:"Main 1"},{protocol:"Water",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Frost",value:0,top:"",middle:"Draw 1 card for each face-down card.",bottom:"",keywords:{draw:!0},category:"Fan-Content"},{protocol:"Frost",value:1,top:"Cards cannot be flipped face-up.",middle:"",bottom:"Protocols cannot be rearranged.",keywords:{flip:!0,rearrange:!0},category:"Fan-Content"},{protocol:"Frost",value:2,top:"",middle:"Play a card face-down.",bottom:"",keywords:{play:!0},category:"Fan-Content"},{protocol:"Frost",value:3,top:"Cards cannot shift from or to this line.",middle:"",bottom:"",keywords:{shift:!0},category:"Fan-Content"},{protocol:"Frost",value:4,top:"",middle:"You may flip 1 card of your face-up covered cards.",bottom:"",keywords:{flip:!0},category:"Fan-Content"},{protocol:"Frost",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Fan-Content"},{protocol:"Anarchy",value:0,top:"",middle:"Shift 1 card. For each line that contains a face-up card without matching protocol, draw 1 card.",bottom:"",keywords:{shift:!0,draw:!0},category:"Fan-Content"},{protocol:"Anarchy",value:1,top:"Cards can only be played without matching protocols.",middle:"Shift 1 other card to a line without a matching protocol.",bottom:"",keywords:{shift:!0,play:!0},category:"Fan-Content"},{protocol:"Anarchy",value:2,top:"",middle:"Delete a covered or uncovered card in a line with a matching protocol.",bottom:"",keywords:{delete:!0},category:"Fan-Content"},{protocol:"Anarchy",value:3,top:"",middle:"Swap the positions of 2 of your opponent's protocols.",bottom:"<div><span class='emphasis'>End:</span> Rearrange your protocols. Anarchy cannot be on this line.</div>",keywords:{swap:!0,rearrange:!0},category:"Fan-Content"},{protocol:"Anarchy",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Fan-Content"},{protocol:"Anarchy",value:6,top:"<div><span class='emphasis'>Start:</span> Flip this card, if this card is in the line with the Anarchy protocol.</div>",middle:"",bottom:"",keywords:{flip:!0},category:"Fan-Content"}],K_=new Set(In.map(a=>a.protocol)),J_=Array.from(K_).sort();/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Gr=a=>{var i,c,d,f,u,p,m,y,v,x,w,S,E,b,j,C,R,F,L,O,T,G,V,z,U,k,A,I,$,q,M,B,W,K,D,Q,ae,Y,Z,ue,re,ee,X,le,J,me,ve,Se,Le,Ee,lt,et,Je,nt,je,Fe,Ve,Oe,Rt,tt,It,Zt,En,On,fa,Ea,yn,Ft,Kt,Ut,ha,ja,aa,Jt,dn,Mn,fn,Hn,jn,ka,oa,kn,Nn,Na,ma,ya,ga,zn,ra;const t=a.params;let l="";switch(t.action){case"refresh":{t.target==="opponent"?l="Your opponent refreshes their hand.":l="Refresh.";break}case"mutual_draw":{const fe=t.count||1;l=`Draw the top card${fe!==1?"s":""} of your opponent's deck. Your opponent draws the top card${fe!==1?"s":""} of your deck.`;break}case"draw":{if(a.useCardFromPreviousEffect){t.target==="opponent"?l="Opponent draws cards equal to that card's value.":l="Draw cards equal to that card's value.";break}if(t.revealFromDrawn){const De=t.count||3;let Te=`Draw ${De} ${De===1?"card":"cards"}.`;const He=t.revealFromDrawn.count||1,We=He==="all"?"all cards":He===1?"1 card":`${He} cards`;(t.revealFromDrawn.valueSource||"stated_number")==="stated_number"?Te+=` Reveal ${We} drawn with the face-up value of your stated number.`:Te+=` Reveal ${We} drawn.`,t.revealFromDrawn.thenAction==="may_play"&&(Te+=" You may play it."),l=Te;break}if(t.countType==="count_face_down"){l="Draw 1 card for each face-down card.";break}if(t.conditional){switch(t.conditional.type){case"count_face_down":l="Draw 1 card for each face-down card.";break;case"is_covering":l=`Draw ${t.count} card${t.count!==1?"s":""} if this card is covering another.`;break;case"non_matching_protocols":l="Draw 1 card for each line with a non-matching protocol.";break}break}let fe="";if(t.countType==="equal_to_discarded"){const De=t.countOffset||0;De===1?fe+="Draw 1 more card than the amount discarded.":De===0?fe+="Draw the same amount of cards.":fe+=`Draw the amount discarded plus ${De}.`,l=fe;break}else if(t.countType==="equal_to_card_value"){fe+="Draw cards equal to that card's value.",l=fe;break}else if(t.countType==="hand_size"){fe+="Draw the same amount of cards.",l=fe;break}else if(t.countType==="all_matching"&&((i=t.valueFilter)==null?void 0:i.equals)!==void 0){const De=t.valueFilter.equals;fe+=`Draw all cards with a value of ${De}.`,l=fe;break}else if(((c=t.valueFilter)==null?void 0:c.equals)!==void 0&&t.count){const De=t.valueFilter.equals,Ae=t.count===1?"card":"cards",Te=t.fromRevealed?" revealed this way":"";fe+=`Draw ${t.count} ${Ae} with a value of ${De}${Te}.`,l=fe;break}if(((d=t.advancedConditional)==null?void 0:d.type)==="empty_hand"){const De=t.count||1;l=`If you have no cards in hand, draw ${De} card${De!==1?"s":""}.`;break}if(((f=t.advancedConditional)==null?void 0:f.type)==="opponent_higher_value_in_lane"){const De=t.count||1;l=`If your opponent has a higher total value than you do in this line, draw ${De} card${De!==1?"s":""}.`;break}const ke=t.optional?"You may ":"";if(t.source==="opponent_deck"){const De=t.count===1?"the top card":`the top ${t.count} cards`;fe+=`${ke}Draw ${De} of your opponent's deck.`}else if(t.target==="opponent")fe+=`Opponent draws ${t.count} card${t.count!==1?"s":""}.`;else{const De=t.optional?"draw":"Draw";fe+=`${ke}${De} ${t.count} card${t.count!==1?"s":""}.`}l=fe;break}case"flip":{if(a.useCardFromPreviousEffect){const pt=t.optional?"May flip":"Flip",Pt=t.skipMiddleCommand?", ignoring its middle commands":"";l=`${pt} that card${Pt}.`;break}if(t.flipSelf){if(((u=t.advancedConditional)==null?void 0:u.type)==="opponent_higher_value_in_lane"){l="If your opponent has a higher value in this line than you do, flip this card.";break}if(((p=t.advancedConditional)==null?void 0:p.type)==="hand_size_greater_than"){const Pt=t.advancedConditional.threshold??0;l=`If you have more than ${Pt} ${Pt===1?"card":"cards"} in your hand, flip this card.`;break}let pt=(t.optional,"Flip this card");((m=t.advancedConditional)==null?void 0:m.type)==="protocol_match"&&(pt+=`, if this card is in the line with the ${t.advancedConditional.protocol||"[Protocol]"} protocol`),l=pt+".";break}const fe=t.optional?"You may flip":"Flip",ke=((y=t.targetFilter)==null?void 0:y.owner)==="own",De=((v=t.targetFilter)==null?void 0:v.owner)==="opponent",Ae=(x=t.targetFilter)==null?void 0:x.excludeSelf;let Te="";ke&&Ae?Te+="of your other ":ke?Te+="of your ":De?Te+="of your opponent's ":Ae&&(Te+="other "),((w=t.targetFilter)==null?void 0:w.position)==="any"?Te+="covered or uncovered ":((S=t.targetFilter)==null?void 0:S.position)==="covered"&&(Te+="covered "),((E=t.targetFilter)==null?void 0:E.faceState)==="face_down"&&(Te+="face-down "),((b=t.targetFilter)==null?void 0:b.faceState)==="face_up"&&(Te+="face-up ");let He="";t.count==="all"?He="all":t.count==="each"?t.eachLineScope==="each_line"?(He="1",Te=Te+"(in each line) "):He="each":He=t.count.toString();const at=ke||De?"cards":t.count===1?"card":"cards";let Me="";if(ke&&((j=t.targetFilter)==null?void 0:j.position)==="covered"&&((C=t.targetFilter)==null?void 0:C.faceState)==="face_up"&&t.optional?Me=`${fe} ${He} of your ${t.targetFilter.faceState.replace("_","-")} ${t.targetFilter.position} cards`:Me=`${fe} ${He} ${Te}${at}`,t.scope==="this_lane"){const pt=((R=t.targetFilter)==null?void 0:R.owner)==="own";Me+=pt?" in this stack":" in this line"}else t.scope==="each_lane"&&(Me=`In each line, ${Me.charAt(0).toLowerCase()+Me.slice(1)}`);t.sameLaneAsFirst&&(Me+=" in the same line"),(F=t.targetFilter)!=null&&F.valueMinGreaterThanHandSize&&(Me+=" that has a value greater than the number of cards in your hand"),Me+=".",t.selfFlipAfter&&(Me+=" Then flip this card."),l=Me;break}case"shift":{const fe=t.optional?"You may shift":"Shift";if(((L=t.advancedConditional)==null?void 0:L.type)==="empty_hand"){l=`If you have no cards in hand, ${fe.toLowerCase()} 1 card.`;break}if(((O=t.advancedConditional)==null?void 0:O.type)==="opponent_higher_value_in_lane"){l=`If your opponent has a higher total value than you do in this line, ${fe.toLowerCase()} 1 card.`;break}if(((T=t.advancedConditional)==null?void 0:T.type)==="this_card_is_covered"){l=`If this card is covered, ${fe.toLowerCase()} it.`;break}if(t.shiftSelf){if(((G=t.destinationRestriction)==null?void 0:G.type)==="opponent_highest_value_lane"){l=`${fe} this card to the line where your opponent has their highest total value.`;break}let xt=`${fe} this card`;t.allowCoveredSelf&&(xt+=", even if this card is covered"),l=xt+".";break}if(a.useCardFromPreviousEffect){let xt=`${fe} that card`;((V=t.destinationRestriction)==null?void 0:V.type)==="to_this_lane"?xt+=" to this line":((z=t.destinationRestriction)==null?void 0:z.type)==="to_another_line"?xt+=" to another line":((U=t.destinationRestriction)==null?void 0:U.type)==="non_matching_protocol"?xt+=" to a line without a matching protocol":((k=t.destinationRestriction)==null?void 0:k.type)==="specific_lane"&&(xt+=" within this line"),l=xt+".";break}const ke=t.count||1,De=((A=t.targetFilter)==null?void 0:A.owner)==="own",Ae=((I=t.targetFilter)==null?void 0:I.position)==="covered";if(De&&Ae&&ke===1){let xt=`${fe} 1 of your covered cards`;(($=t.destinationRestriction)==null?void 0:$.type)==="non_matching_protocol"?xt+=" to a line without a matching protocol":((q=t.destinationRestriction)==null?void 0:q.type)==="specific_lane"?xt+=" within this line":((M=t.destinationRestriction)==null?void 0:M.type)==="to_another_line"&&(xt+=" to another line"),l=xt+".";break}if(((B=t.targetFilter)==null?void 0:B.owner)==="own"&&((W=t.targetFilter)==null?void 0:W.position)==="any"&&!((K=t.targetFilter)!=null&&K.excludeSelf)&&ke===1){l=`${fe} this card, even if this card is covered`+".";break}if(De&&!Ae&&!((D=t.targetFilter)!=null&&D.excludeSelf)&&ke===1){l=`${fe} 1 of your cards`+".";break}let He="";const We=((Q=t.targetFilter)==null?void 0:Q.owner)==="opponent",at=(ae=t.targetFilter)==null?void 0:ae.excludeSelf,Me=((Y=t.targetFilter)==null?void 0:Y.position)==="any";De&&at?He+="of your other ":We?He+="of your opponent's ":at&&(He+="other "),Me?He+="covered or uncovered ":((Z=t.targetFilter)==null?void 0:Z.position)==="covered"&&(He+="covered "),((ue=t.targetFilter)==null?void 0:ue.faceState)==="face_down"&&(He+="face-down "),((re=t.targetFilter)==null?void 0:re.faceState)==="face_up"&&(He+="face-up ");const pt=t.count==="all"?"all":"1";let zt=`${fe} ${pt} ${He}${De&&at||We?"cards":pt==="1"?"card":"cards"}`;t.scope==="this_lane"&&(zt+=" in this line"),((ee=t.destinationRestriction)==null?void 0:ee.type)==="non_matching_protocol"?zt+=" to a line without a matching protocol":((X=t.destinationRestriction)==null?void 0:X.type)==="specific_lane"?zt+=" within this line":((le=t.destinationRestriction)==null?void 0:le.type)==="to_another_line"?zt+=" to another line":((J=t.destinationRestriction)==null?void 0:J.type)==="to_this_lane"?zt+=" to this line":((me=t.destinationRestriction)==null?void 0:me.type)==="to_or_from_this_lane"&&(zt+=" either to or from this line"),l=zt+".";break}case"delete":{if(((ve=t.advancedConditional)==null?void 0:ve.type)==="empty_hand"){const We=t.count||1;l=`If you have no cards in hand, delete ${We} card${We!==1?"s":""}.`;break}if(((Se=t.advancedConditional)==null?void 0:Se.type)==="opponent_higher_value_in_lane"){const We=t.count||1;l=`If your opponent has a higher total value than you do in this line, delete ${We} card${We!==1?"s":""}.`;break}if(a.useCardFromPreviousEffect){l="Delete that card.";break}if(t.deleteSelf){l="Delete this card.";break}if(((Le=t.laneCondition)==null?void 0:Le.type)==="opponent_higher_value"){const We=t.count||1,at=((Ee=t.targetFilter)==null?void 0:Ee.owner)==="opponent"?"of your opponent's ":"";l=`Delete ${We} ${at}${We===1?"card":"cards"} in a line where they have a higher total value than you do.`;break}let fe="Delete ";const ke=((lt=t.targetFilter)==null?void 0:lt.position)==="any",De=((et=t.targetFilter)==null?void 0:et.calculation)==="highest_value"||((Je=t.targetFilter)==null?void 0:Je.calculation)==="lowest_value",Ae=((nt=t.targetFilter)==null?void 0:nt.owner)==="own"||((je=t.targetFilter)==null?void 0:je.owner)==="opponent",Te=t.count===1&&De&&Ae;if(t.count==="all_in_lane"?fe+="all ":Te||(fe+=ke?"a ":`${t.count} `),Te&&(((Fe=t.targetFilter)==null?void 0:Fe.owner)==="own"?fe+="your ":((Ve=t.targetFilter)==null?void 0:Ve.owner)==="opponent"&&(fe+="opponent's ")),((Oe=t.targetFilter)==null?void 0:Oe.calculation)==="highest_value"?fe+="highest value ":((Rt=t.targetFilter)==null?void 0:Rt.calculation)==="lowest_value"&&(fe+="lowest value "),(tt=t.targetFilter)!=null&&tt.valueRange){const{min:We,max:at}=t.targetFilter.valueRange,Me=[];for(let Pt=We;Pt<=at;Pt++)Me.push(Pt);const pt=Me.join(" or ");fe+=`value ${pt} `}Te||(((It=t.targetFilter)==null?void 0:It.owner)==="own"?fe+="your ":((Zt=t.targetFilter)==null?void 0:Zt.owner)==="opponent"&&(fe+="opponent's ")),t.excludeSelf&&(fe+="other "),ke?fe+="covered or uncovered ":((En=t.targetFilter)==null?void 0:En.position)==="covered"&&(fe+="covered "),((On=t.targetFilter)==null?void 0:On.faceState)==="face_down"?fe+="face-down ":((fa=t.targetFilter)==null?void 0:fa.faceState)==="face_up"&&(fe+="face-up ");const He=t.count===1?"card":"cards";fe+=He,t.selectLane&&(fe+=" in 1 line"),t.protocolMatching==="must_match"?fe+=" in a line with a matching protocol":t.protocolMatching==="must_not_match"&&(fe+=" in a line without a matching protocol"),((Ea=t.scope)==null?void 0:Ea.type)==="this_line"?fe+=" in this line":((yn=t.scope)==null?void 0:yn.type)==="other_lanes"?fe+=" in other lanes":((Ft=t.scope)==null?void 0:Ft.type)==="each_other_line"&&(fe+=" from each other line"),((Kt=t.targetFilter)==null?void 0:Kt.valueSource)==="previous_effect_card"&&(fe+=" that shares a value with the discarded card"),l=fe+".";break}case"discard":{if(t.source==="top_deck_own"){l="Discard the top card of your deck.";break}if(t.source==="top_deck_opponent"){l="Discard the top card of your opponent's deck.";break}if(t.useCardFromPreviousEffect){t.actor==="opponent"?l="Opponent discards that card.":l="discard that card.";break}if(t.countType==="equal_to_discarded"){const Ae=t.countOffset||0;t.actor==="opponent"?Ae===1?l="Your opponent discards the amount of cards discarded plus 1.":Ae===0?l="Your opponent discards the same amount of cards.":l=`Your opponent discards the amount discarded plus ${Ae}.`:Ae===1?l="Discard 1 more card than the amount discarded.":Ae===0?l="Discard the same amount of cards.":l=`Discard the amount discarded plus ${Ae}.`;break}const fe=t.variableCount;let ke="";if(fe)ke="1 or more cards";else if(t.count==="all")ke="your hand";else{const Ae=t.count===1?"card":"cards";ke=`${t.count} ${Ae}`}const De=t.optional?"You may discard":t.count==="all"||fe?"Discard":"You discard";if(t.actor==="both"){if(t.count==="all")l="Both players discard their hand.";else{const Ae=t.count===1?"card":"cards";l=`Both players discard ${t.count} ${Ae}.`}break}if(t.actor==="opponent")if(t.count==="all")l="Opponent discards their hand.";else if(t.random){const Ae=t.count===1?"card":"cards";l=`Your opponent discards ${t.count} random ${Ae}.`}else l=`Your opponent discards ${ke}.`;else l=`${De} ${ke}.`;break}case"return":{if(((Ut=t.advancedConditional)==null?void 0:Ut.type)==="empty_hand"){const Me=t.count||1;l=`If you have no cards in hand, return ${Me} card${Me!==1?"s":""}.`;break}if(((ha=t.advancedConditional)==null?void 0:ha.type)==="opponent_higher_value_in_lane"){const Me=t.count||1;l=`If your opponent has a higher total value than you do in this line, return ${Me} card${Me!==1?"s":""}.`;break}if(a.useCardFromPreviousEffect){l="Return that card to hand.";break}const ke=t.selectLane||!1?" in 1 line":"";if(((ja=t.targetFilter)==null?void 0:ja.valueEquals)!==void 0){l=`Return all cards with a value of ${t.targetFilter.valueEquals}${ke}.`;break}const De=((aa=t.targetFilter)==null?void 0:aa.owner)||"any",Ae=((Jt=t.targetFilter)==null?void 0:Jt.position)||"uncovered";let Te="";Ae==="any"?Te="covered or uncovered ":Ae==="covered"&&(Te="covered ");const He=t.count==="all"?`all ${Te}cards`:t.count===1?`1 ${Te}card`:`${t.count} ${Te}cards`;let We="";De==="own"?We=" of your":De==="opponent"&&(We=" of your opponent's"),l=`${t.optional?"You may r":"R"}eturn ${He}${We}${ke}.`;break}case"play":{if(((dn=t.advancedConditional)==null?void 0:dn.type)==="empty_hand"){const Me=t.count||1;l=`If you have no cards in hand, play ${Me} card${Me!==1?"s":""}.`;break}if(((Mn=t.advancedConditional)==null?void 0:Mn.type)==="opponent_higher_value_in_lane"){const Me=t.count||1;l=`If your opponent has a higher total value than you do in this line, play ${Me} card${Me!==1?"s":""}.`;break}if(a.useCardFromPreviousEffect){const Me=t.faceDown===!0?"face-down":t.faceDown===!1?"face-up":"";l=Me?`Play that card ${Me}.`:"Play that card.";break}const fe=t.actor,ke=t.count||1,De=t.faceDown===!0?" face-down":t.faceDown===!1?" face-up":"";let Ae="",Te="";const He=((fn=t.valueFilter)==null?void 0:fn.equals)!==void 0?` with a value of ${t.valueFilter.equals}`:"";fe==="opponent"?(Ae="Your opponent plays",t.source==="deck"?Te=ke===1?"the top card of their deck":`${ke} cards from their deck`:Te=ke===1?`a card${He} from their hand`:`${ke} cards${He} from their hand`):(Ae="Play",t.source==="deck"?Te=ke===1?"the top card of your deck":`${ke} cards from your deck`:Te=ke===1?`1 card${He}`:`${ke} cards${He}`);let We="";((Hn=t.condition)==null?void 0:Hn.type)==="per_x_cards_in_line"&&(We=`For every ${t.condition.cardCount||2} cards in this line, `,Ae=Ae.toLowerCase());let at=`${We}${Ae} ${Te}${De}`;if(((jn=t.destinationRule)==null?void 0:jn.type)==="other_lines")at+=" to other lines";else if(((ka=t.destinationRule)==null?void 0:ka.type)==="another_line")at+=" in another line";else if(((oa=t.destinationRule)==null?void 0:oa.type)==="each_other_line")at+=" in each other line";else if(((kn=t.destinationRule)==null?void 0:kn.type)==="under_this_card")at+=" under this card";else if(((Nn=t.destinationRule)==null?void 0:Nn.type)==="each_line_with_card"){const Me=t.destinationRule.ownerFilter,pt=t.destinationRule.cardFilter;(pt==null?void 0:pt.faceState)==="face_down"?at+=" in each line with a face-down card":(pt==null?void 0:pt.faceState)==="face_up"?at+=" in each line with a face-up card":Me==="own"?at+=" in each line where you have a card":Me==="opponent"?at+=" in each line where opponent has a card":at+=" to each line with a card"}else if(((Na=t.destinationRule)==null?void 0:Na.type)==="line_with_matching_cards"){const Me=t.destinationRule.cardFilter;(Me==null?void 0:Me.faceState)==="face_down"?at+=" in a line with a face-down card":(Me==null?void 0:Me.faceState)==="face_up"?at+=" in a line with a face-up card":at+=" in a line with a card"}else((ma=t.destinationRule)==null?void 0:ma.type)==="specific_lane"&&(at+=" in this line");l=at+".";break}case"rearrange_protocols":case"swap_protocols":{const fe=t.target==="opponent"?"your opponent's":t.target==="both_sequential"?"both players'":"your";let ke="";t.action==="rearrange_protocols"?ke=`Rearrange ${fe} protocols`:ke=`Swap the positions of 2 of ${fe} protocols`,t.restriction&&t.restriction.disallowedProtocol&&(ke+=`. ${t.restriction.disallowedProtocol} cannot be on this line`),l=ke+".";break}case"reveal":case"give":{if(a.useCardFromPreviousEffect){l=`${t.action==="give"?"Give":"Reveal"} that card.`;break}if(t.action,t.source==="board"){const We=((ya=t.targetFilter)==null?void 0:ya.faceState)==="face_down"?"face-down ":"",at=t.count||1;let pt=`Reveal ${at} ${We}${at===1?"card":"cards"}`;t.optional?pt+=". You may shift or flip that card":t.followUpAction==="flip"?pt+=". Then flip it":t.followUpAction==="shift"&&(pt+=". Then shift it"),l=pt+".";break}if(t.source==="own_deck_top"){let We="Reveal the top card of your deck";t.followUpAction==="may_discard"&&(We+=". You may discard it"),l=We+".";break}if(t.source==="own_deck"){l="Reveal your deck.";break}if(t.count===-1){t.source==="opponent_hand"?l=t.action==="reveal"?"Your opponent reveals their hand.":"Give your entire hand to your opponent.":l=t.action==="reveal"?"Reveal your hand.":"Give your entire hand.";break}const fe=t.count===1?"card":"cards",ke=t.source==="opponent_hand"?"opponent's hand":"your hand",De=t.optional?"You may ":"",Ae=t.action==="give"?"give":"reveal",Te=t.action==="give"?"Give":"Reveal";let He;t.optional?He=`${De}${Ae} ${t.count} ${fe} from ${ke}`:He=`${Te} ${t.count} ${fe} from ${ke}`,t.action==="give"&&t.source!=="opponent_hand"&&(He+=" to your opponent"),t.followUpAction==="flip"?He+=". Then flip it.":t.followUpAction==="shift"?He+=". Then shift it.":He+=".",l=He;break}case"take":{const fe=t.count===1?"card":"cards",ke=t.random!==!1?"random ":"";l=`Take ${t.count} ${ke}${fe} from your opponent's hand.`;break}case"choice":{const fe=t.options||[];if(fe.length===0){l="Effect";break}if(fe.length===2){const ke=fe.map(De=>{const Ae={params:De.params};let Te=Gr(Ae);return Te.endsWith(".")&&(Te=Te.slice(0,-1)),Te=Te.charAt(0).toLowerCase()+Te.slice(1),Te});l=`Either ${ke[0]} or ${ke[1]}.`}else l="Effect";break}case"passive_rule":{const fe=t.rule;switch(fe==null?void 0:fe.type){case"require_non_matching_protocol":l="Cards can only be played without matching protocols.";break;case"block_all_play":fe.target==="opponent"?l="Your opponent cannot play cards in this line.":fe.target==="self"?l="You cannot play cards in this line.":l="Cards cannot be played in this line.";break;case"ignore_middle_commands":if(fe.onlyDuringYourTurn&&fe.target==="opponent"&&fe.scope==="global")l="During your turn, your opponent's cards do not have middle commands.";else if(fe.onlyDuringYourTurn){const ke=fe.target==="opponent"?"your opponent's ":fe.target==="self"?"your ":"",De=fe.scope==="global"?"":" in this line";l=`During your turn, ignore all middle commands of ${ke}cards${De}.`}else l="Ignore all middle commands of cards in this line.";break;case"block_face_down_play":l="Opponent can't play cards face-down in this line.";break;case"require_face_down_play":l=fe.scope==="global"?"Your opponent can only play cards face-down.":"Opponent can only play cards face-down in this line.";break;case"allow_any_protocol_play":l="You may play cards without matching protocols.";break;case"allow_play_on_opponent_side":l="You may play this card in any line on either player's side.";break;case"block_flips":l=fe.scope==="global"?"Cards cannot be flipped face-up.":"Cards can't be flipped face-up in this line.";break;case"block_protocol_rearrange":l="Protocols can't be rearranged.";break;case"block_shifts_from_lane":l="Cards can't shift from this line.";break;case"block_shifts_to_lane":l="Cards can't shift to this line.";break;case"block_shifts_from_and_to_lane":l="Cards cannot shift from or to this line.";break;case"skip_check_cache_phase":l="Skip check cache phase.";break;case"block_flip_this_card":l="This card cannot be flipped.";break;case"block_draw_conditional":{const ke=fe.conditionTarget||"self",De=fe.blockTarget||"self",Ae=ke==="self"?"you have":"your opponent has";let Te;De==="self"?Te="you cannot draw":De==="opponent"?Te="your opponent cannot draw":Te="neither player can draw",l=`If ${Ae} any cards in hand, ${Te} cards.`;break}default:l="Passive rule effect."}break}case"value_modifier":{const fe=t.modifier;switch(fe==null?void 0:fe.type){case"add_per_condition":{const ke=fe.scope==="this_lane"?"in this line":"",De=fe.target==="own_total"?"Your total value":fe.target==="opponent_total"?"Your opponent's total value":"Total value";let Ae="",Te="";fe.condition==="per_face_down_card"?(Ae="for each face-down card",Te=ke):fe.condition==="per_face_up_card"?(Ae="for each face-up card",Te=ke):fe.condition==="per_card"?(Ae="for each card",Te=ke):fe.condition==="per_card_in_hand"?Ae="for each card in your hand":fe.condition==="per_opponent_card_in_lane"&&(Ae="for each of your opponent's cards",Te=ke);const He=Math.abs(fe.value),We=fe.value>=0?"increased":"reduced";l=`${De} ${ke} is ${We} by ${He} ${Ae} ${Te}.`.replace(/\s+/g," ").trim();break}case"set_to_fixed":{let ke="";fe.target==="own_cards"?ke="your":fe.target==="opponent_cards"?ke="opponent's":ke="all";let De="";((ga=fe.filter)==null?void 0:ga.faceState)==="face_down"?De=" face-down":((zn=fe.filter)==null?void 0:zn.faceState)==="face_up"&&(De=" face-up");let Ae="";fe.scope==="this_lane"&&(Ae=" in this stack"),l=`All ${ke}${De} cards${Ae} have a value of ${fe.value}.`;break}case"add_to_total":{const ke=fe.scope==="this_lane"?" in this line":"";fe.target==="opponent_total"?fe.value<0?l=`Your opponent's total value${ke} is reduced by ${Math.abs(fe.value)}.`:l=`Your opponent's total value${ke} is increased by ${fe.value}.`:fe.value<0?l=`Your total value${ke} is reduced by ${Math.abs(fe.value)}.`:l=`Your total value${ke} is increased by ${fe.value}.`;break}default:l="Value modifier effect."}break}case"block_compile":{l=`${t.target==="opponent"?"Your opponent":"You"} cannot compile next turn.`;break}case"delete_all_in_lane":{const fe=((ra=t.laneCondition)==null?void 0:ra.count)||8;l=`Delete all cards in ${t.excludeCurrentLane?"1 other line":"1 line"} with ${fe} or more cards.`;break}case"modify_value":{const fe=t.modifier||0,ke=t.target==="opponent"?"Your opponent's":"Your",De=fe<0?`reduced by ${Math.abs(fe)}`:`increased by ${fe}`;l=`${ke} total value in this line is ${De}.`;break}case"block_play_face_down":{l="Your opponent cannot play cards face-down in this line.";break}case"shuffle_trash":{l=`${t.optional!==!1?"You may shuffle":"Shuffle"} your trash into your deck.`;break}case"shuffle_deck":{l="Shuffle your deck.";break}case"redirect_return_to_deck":{l=`Put that card on top of their deck ${t.faceDown!==!1?"face-down ":""}instead.`;break}case"state_number":{l="State a number.";break}case"state_protocol":{l="State a protocol.";break}case"swap_stacks":{l="Swap all of your cards in one of your stacks with another one of your stacks.";break}case"copy_opponent_middle":{l=`${t.optional?"You may resolve":"Resolve"} the middle command of 1 of your opponent's cards as if it were on this card.`;break}default:l="Effect";break}if(a.conditional&&a.conditional.thenEffect){let fe=Gr(a.conditional.thenEffect);const ke=a.conditional.thenEffect.params;ke!=null&&ke.useCardFromPreviousEffect&&(fe=fe.replace(/\d+ cards?/i,"that card")),a.conditional.type==="then"?l=`${l.endsWith(".")?l.slice(0,-1):l}, then ${fe.toLowerCase()}`:a.conditional.type==="optional"?l=`${l.endsWith(".")?l.slice(0,-1):l}. You may ${fe.toLowerCase()}`:a.conditional.type==="if_protocol_matches_stated"?l=`${l} If the discarded card matches the stated protocol, ${fe.toLowerCase()}`:l=`${l} If you do, ${fe.toLowerCase()}`}return l},e0=a=>{const t={};for(const l of a){const c=l.params.action;c==="draw"&&(t.draw=!0),c==="flip"&&(t.flip=!0),c==="shift"&&(t.shift=!0),c==="delete"&&(t.delete=!0),c==="discard"&&(t.discard=!0),c==="return"&&(t.return=!0),c==="play"&&(t.play=!0),c==="reveal"&&(t.reveal=!0),c==="give"&&(t.give=!0),c==="take"&&(t.take=!0)}return t},or=a=>a.length===0?"":a.map(t=>{var c;const l=Gr(t),i=t.trigger;if(i==="start")return`<div><span class='emphasis'>Start:</span> ${l}</div>`;if(i==="end")return`<div><span class='emphasis'>End:</span> ${l}</div>`;if(i==="on_cover")return`<div><span class='emphasis'>When this card would be covered:</span> First, ${l.toLowerCase()}</div>`;if(i==="on_flip")return`<div><span class='emphasis'>When this card would be flipped:</span> First, ${l.toLowerCase()}</div>`;if(i==="on_cover_or_flip")return`<div><span class='emphasis'>When this card would be covered or flipped:</span> First, ${l.toLowerCase()}</div>`;if(i==="after_draw"||i==="after_delete"||i==="after_discard"||i==="after_shift"||i==="after_flip"||i==="after_clear_cache"){const d=t.reactiveTriggerActor||"self",f=d==="self"?"you":d==="opponent"?"opponent":"a card is";let u="";i==="after_draw"?u=d==="any"?"drawn":"draw cards":i==="after_delete"?u=d==="any"?"deleted":"delete cards":i==="after_discard"?u=d==="any"?"discarded":"discard cards":i==="after_shift"?u=d==="any"?"shifted":"shift cards":i==="after_flip"?u=d==="any"?"flipped":"flip cards":i==="after_clear_cache"&&(u="clear cache");const p=t.onlyDuringOpponentTurn?" during your opponent's turn":"";return`<div><span class='emphasis'>${`After ${f} ${u}${p}`}:</span> ${l}</div>`}if(i==="after_opponent_discard")return`<div><span class='emphasis'>After your opponent discards cards:</span> ${l}</div>`;if(i==="after_opponent_draw")return`<div><span class='emphasis'>After your opponent draws cards:</span> ${l}</div>`;if(i==="after_play"){const d=t.reactiveTriggerActor||"self",f=t.reactiveScope||"global";return d==="opponent"&&f==="this_lane"?`<div><span class='emphasis'>After your opponent plays a card in this line:</span> ${l}</div>`:d==="opponent"?`<div><span class='emphasis'>After your opponent plays a card:</span> ${l}</div>`:f==="this_lane"?`<div><span class='emphasis'>After you play a card in this line:</span> ${l}</div>`:`<div><span class='emphasis'>After you play a card:</span> ${l}</div>`}return i==="before_compile_delete"?`<div><span class='emphasis'>When this card would be deleted by compiling:</span> ${l}</div>`:i==="when_card_returned"?`<div><span class='emphasis'>When a card would be returned to ${(((c=t.params)==null?void 0:c.targetOwner)||"opponent")==="opponent"?"your opponent's":"your"} hand:</span> ${l}</div>`:l}).join(" "),t0=(a,t)=>{var p,m,y;const l=((p=a.text)==null?void 0:p.top)!==void 0?a.text.top:or(a.topEffects),i=((m=a.text)==null?void 0:m.middle)!==void 0?a.text.middle:or(a.middleEffects),c=((y=a.text)==null?void 0:y.bottom)!==void 0?a.text.bottom:or(a.bottomEffects),d=[...a.topEffects,...a.middleEffects,...a.bottomEffects],f=e0(d);return{protocol:t.name,value:a.value,top:l,middle:i,bottom:c,keywords:f,category:t.category||"Custom",color:t.color,pattern:t.pattern,customEffects:{topEffects:a.topEffects,middleEffects:a.middleEffects,bottomEffects:a.bottomEffects}}},n0=a=>a.cards.map(t=>t0(t,a)),qo=()=>{try{const a=localStorage.getItem("custom_protocols_v1");if(!a)return[];const l=JSON.parse(a).protocols||[],i=[];for(const c of l){const d=n0(c);i.push(...d)}return i}catch(a){return console.error("Failed to load custom protocol cards:",a),[]}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const ym="custom_protocols_v1",$d=1,sr=()=>{try{const a=localStorage.getItem(ym);if(!a)return[];const t=JSON.parse(a);return t.version!==$d&&console.warn(`Custom protocol storage version mismatch: expected ${$d}, got ${t.version}`),t.protocols||[]}catch(a){return console.error("Error loading custom protocols:",a),[]}},Yd=a=>{try{const t={protocols:a,version:$d};localStorage.setItem(ym,JSON.stringify(t))}catch(t){console.error("Error saving custom protocols:",t)}},_t=a=>{const t=sr(),l=t.findIndex(i=>i.id===a.id);l>=0?t[l]=a:t.push(a),Yd(t)},a0=a=>{const l=sr().filter(i=>i.id!==a);Yd(l)},o0=["anarchy-custom-001","apathy_custom","chaos_custom_1","clarity-custom-001","corruption-custom-001","courage-custom-001","darkness_custom_v1","death_custom_v1","fear_custom","fire-custom-001","frost_custom_1","gravity_custom_1","hate-custom-001","ice_custom","life_custom_1","light_custom_1","love_custom_v1","luck-custom-001","metal_custom_1","mirror-custom-001","peace-custom-001","plague-custom-001","psychic_custom_v1","smoke-custom-001","speed_custom_1","spirit_custom_1","water_custom_1"],Qr=a=>o0.includes(a.id),r0=(a,t)=>{const l=(c,d)=>{c=c.replace("#","");const f=parseInt(c.substring(0,2),16),u=parseInt(c.substring(2,4),16),p=parseInt(c.substring(4,6),16);return`rgba(${f}, ${u}, ${p}, ${d})`},i={borderColor:t};switch(a){case"solid":return{...i,backgroundColor:t};case"radial":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`radial-gradient(circle at 50% 50%, ${l(t,.25)} 0%, transparent 60%)`};case"dual-radial":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 0% 0%, ${l(t,.2)}, transparent 50%),
                    radial-gradient(at 100% 100%, ${l(t,.2)}, transparent 50%)
                `};case"multi-radial":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 0%, ${l(t,.2)}, transparent 70%),
                    radial-gradient(circle at 20% 30%, ${l(t,.15)}, transparent 40%),
                    radial-gradient(circle at 80% 70%, ${l(t,.2)}, transparent 50%)
                `};case"chaos":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 10% 10%, hsla(60, 100%, 50%, 0.15), transparent 30%),
                    radial-gradient(at 90% 20%, hsla(180, 100%, 50%, 0.15), transparent 35%),
                    radial-gradient(at 30% 80%, hsla(300, 100%, 50%, 0.15), transparent 40%),
                    radial-gradient(at 70% 60%, hsla(0, 100%, 50%, 0.1), transparent 25%)
                `};case"grid":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(circle at 50% 50%, ${l(t,.2)} 0%, transparent 40%),
                    linear-gradient(hsla(0,0%,100%,0.03) 1px, transparent 1px),
                    linear-gradient(90deg, hsla(0,0%,100%,0.03) 1px, transparent 1px)
                `,backgroundSize:"100% 100%, 20px 20px, 20px 20px"};case"diagonal-lines":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 0% 100%, ${l(t,.25)}, transparent 70%),
                    repeating-linear-gradient(120deg, transparent, transparent 15px, ${l(t,.05)} 15px, ${l(t,.05)} 30px)
                `};case"cross-diagonal":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 50%, ${l(t,.25)} 0%, transparent 50%),
                    repeating-linear-gradient(45deg, transparent, transparent 8px, ${l(t,.08)} 8px, ${l(t,.08)} 16px),
                    repeating-linear-gradient(-45deg, transparent, transparent 8px, ${l(t,.06)} 8px, ${l(t,.06)} 16px)
                `};case"horizontal-lines":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 80% 80%, ${l(t,.1)}, transparent 50%),
                    repeating-linear-gradient(0deg, hsla(0,0%,100%,0.02), hsla(0,0%,100%,0.02) 1px, transparent 1px, transparent 3px)
                `};case"vertical-lines":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 10% 10%, ${l(t,.2)}, transparent 50%),
                    repeating-linear-gradient(175deg, transparent, transparent 1px, ${l(t,.05)} 1px, ${l(t,.05)} 2px)
                `};case"cross":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    linear-gradient(0deg, transparent 40%, ${l(t,.1)} 50%, transparent 60%),
                    linear-gradient(90deg, transparent 48%, ${l(t,.2)} 50%, transparent 52%)
                `};case"hexagons":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 0%, ${l(t,.2)}, transparent 70%),
                    url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='28' height='49' viewBox='0 0 28 49'%3E%3Cg fill-rule='evenodd'%3E%3Cg id='hexagons' fill='${encodeURIComponent(t)}' fill-opacity='0.05' fill-rule='nonzero'%3E%3Cpath d='M13.99 9.25l13 7.5v15l-13 7.5L1 31.75v-15l12.99-7.5zM3 17.9v12.7l10.99 6.34 11-6.35V17.9l-11-6.34L3 17.9zM0 15l12.99-7.5L26 15v18.5l-13 7.5L0 33.5V15z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")
                `};case"stripes":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 100%, ${l(t,.25)}, transparent 60%),
                    linear-gradient(135deg, hsla(0,0%,0%,0.1) 23%, transparent 23%, transparent 25%, hsla(0,0%,0%,0.1) 25%, hsla(0,0%,0%,0.1) 27%, transparent 27%, transparent 73%, hsla(0,0%,0%,0.1) 73%, hsla(0,0%,0%,0.1) 75%, transparent 75%, transparent 77%, hsla(0,0%,0%,0.1) 77%)
                `};default:return{...i,backgroundColor:t}}},l0=({protocols:a,onCreateNew:t,onEdit:l,onDelete:i,onImport:c,onBack:d})=>{const[f,u]=se.useState(!1),[p,m]=se.useState(!1),[y,v]=se.useState(""),[x,w]=se.useState(""),S=f?a:a.filter(b=>!Qr(b)),E=()=>{w("");try{const b=JSON.parse(y);if(!b.name||!b.color||!b.pattern||!Array.isArray(b.cards)){w("Invalid protocol format. Missing required fields.");return}if(b.cards.length!==6){w("Invalid protocol: must have exactly 6 cards.");return}const j=a.find(C=>C.name.toLowerCase()===b.name.toLowerCase());if(j){confirm(`A protocol named "${b.name}" already exists. Overwrite it?`)&&(b.id=j.id,c(b),m(!1),v(""),alert("Protocol imported and overwritten successfully!"));return}b.id=Date.now().toString(),b.createdAt=new Date().toISOString(),c(b),m(!1),v(""),alert("Protocol imported successfully!")}catch{w("Invalid JSON format. Please check your input.")}};return o.jsxs("div",{className:"protocol-list",children:[o.jsxs("div",{className:"list-header",children:[o.jsx("h2",{children:"Custom Protocols"}),o.jsxs("div",{className:"header-actions",children:[o.jsxs("label",{className:"system-protocols-toggle",children:[o.jsx("input",{type:"checkbox",checked:f,onChange:b=>u(b.target.checked)}),"Show System Protocols"]}),o.jsx("button",{onClick:()=>m(!0),className:"btn",children:"Import Protocol"}),d&&o.jsx("button",{onClick:d,className:"btn btn-back",children:"Back"})]})]}),p&&o.jsx("div",{className:"custom-protocol-modal-overlay",onClick:()=>m(!1),children:o.jsxs("div",{className:"custom-protocol-modal-content",onClick:b=>b.stopPropagation(),children:[o.jsx("h3",{children:"Import Protocol"}),o.jsx("p",{children:"Paste the protocol JSON below:"}),o.jsx("textarea",{value:y,onChange:b=>v(b.target.value),placeholder:'{"name":"Protocol Name","color":"#1976D2",...}',rows:10,className:"import-textarea"}),x&&o.jsx("div",{className:"error-message",children:x}),o.jsxs("div",{className:"custom-protocol-modal-actions",children:[o.jsx("button",{onClick:()=>m(!1),className:"btn btn-back",children:"Cancel"}),o.jsx("button",{onClick:E,className:"btn",children:"Import"})]})]})}),o.jsxs("div",{className:"protocols-grid",children:[o.jsxs("div",{className:"protocol-card new-protocol-card",onClick:t,children:[o.jsx("div",{className:"protocol-header new-protocol-header",children:o.jsxs("div",{className:"protocol-header-content",children:[o.jsx("h3",{children:"+ New Protocol"}),o.jsx("p",{className:"header-description",children:"Create a custom protocol"})]})}),o.jsx("div",{className:"protocol-body new-protocol-body"})]}),S.map(b=>{const j=Qr(b);return o.jsx("div",{className:`protocol-card ${j?"system-protocol":""}`,style:r0(b.pattern,b.color),onClick:()=>l(b),children:o.jsxs("div",{className:"protocol-header-content",children:[o.jsx("h3",{children:b.name}),j&&o.jsx("span",{className:"system-badge",children:"System"}),b.description&&o.jsx("p",{className:"header-description",children:b.description})]})},b.id)})]})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const gm="customProtocolsEnabled";function Gd(){try{return localStorage.getItem(gm)==="true"}catch{return!1}}function s0(a){try{localStorage.setItem(gm,a?"true":"false")}catch{}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */let yc=null;function c0(){if(!yc){const a=Gd(),t=qo(),l=sr(),i=new Set(l.filter(c=>Qr(c)).map(c=>c.name));yc=t.filter(c=>i.has(c.protocol)||a)}return yc}function Yl(){yc=null}function Xa(a){const t=c0(),l=[];for(const i of a){const c=t.filter(d=>d.protocol===i);l.push(...c)}return l}function Ln(a){const t=[...a];for(let l=t.length-1;l>0;l--){const i=Math.floor(Math.random()*(l+1));[t[l],t[i]]=[t[i],t[l]]}return t}function Bh({onNavigate:a,difficulty:t,setDifficulty:l,useControl:i,onUseControlChange:c}){const[d,f]=se.useState(null),[u,p]=se.useState(null),[m,y]=se.useState(null),[v,x]=se.useState([]),[w,S]=se.useState(!0),[E,b]=se.useState(0);se.useEffect(()=>{const C=new Set;for(;C.size<2&&C.size<In.length;)C.add(Math.floor(Math.random()*In.length));const R=Array.from(C).map(F=>In[F]);R.length>0&&(y(R[0]),p(R[0])),R.length>1&&f(R[1]),x(Ln(In))},[]);const j=()=>{const C=E+1;if(b(C),C>=5){const R=!w;S(R),s0(R),b(0)}};return o.jsxs("div",{className:"screen main-menu",children:[o.jsx("h1",{children:"COMPILE: MAIN 1"}),o.jsxs("div",{className:"main-menu-attribution",children:[o.jsxs("p",{children:["based on the card game ",o.jsx("a",{href:"https://boardgamegeek.com/boardgame/406652/compile-main-1",target:"_blank",rel:"noopener noreferrer",children:"Compile: Main 1"})," designed by ",o.jsx("a",{href:"https://justgravyllc.com/",target:"_blank",rel:"noopener noreferrer",children:"Michael Yang"})]}),o.jsxs("p",{children:[o.jsx("span",{onClick:j,style:{cursor:"default",userSelect:"none"},children:"developed"})," by ",o.jsx("a",{href:"https://apo-games.de/",target:"_blank",rel:"noopener noreferrer",children:"Dirk Aporius"})]})]}),o.jsxs("div",{className:"main-menu-layout",children:[o.jsx("div",{className:"main-menu-preview decorative-card",children:u&&o.jsx(bt,{card:{...u,id:"preview",isFaceUp:!0},isFaceUp:!0})}),o.jsxs("div",{className:"main-menu-actions-container",children:[o.jsxs("div",{className:"main-menu-start-group",children:[o.jsxs("div",{className:"difficulty-selector",children:[o.jsx("h3",{className:"difficulty-title",children:"Difficulty"}),o.jsxs("div",{className:"difficulty-options",children:[o.jsx("button",{className:`btn ${t==="easy"?"active":""}`,onClick:()=>l("easy"),children:"Easy"}),o.jsx("button",{className:`btn ${t==="normal"?"active":""}`,onClick:()=>l("normal"),children:"Normal"}),o.jsx("button",{className:`btn btn-wip ${t==="hard"?"active":""}`,disabled:!0,children:"Hard"})]})]}),o.jsxs("div",{className:"control-mechanic-selector",children:[o.jsx("input",{type:"checkbox",id:"control-mechanic",checked:i,onChange:C=>c(C.target.checked)}),o.jsx("label",{htmlFor:"control-mechanic",children:"Use Control Mechanic"})]}),o.jsx("button",{className:"btn btn-start",onClick:()=>a("ProtocolSelection"),children:"Start Game"})]}),o.jsxs("div",{className:"main-menu-other-actions",children:[o.jsx("button",{className:"btn",onClick:()=>a("CardLibrary"),children:"Cards"}),o.jsx("button",{className:"btn",onClick:()=>a("Statistics"),children:"Statistics"}),w&&o.jsx("button",{className:"btn",onClick:()=>a("CustomProtocols"),children:"Custom Protocols"}),o.jsx("button",{className:"btn",onClick:()=>a("Rules"),children:"Rules"}),o.jsx("p",{className:"version-info",children:"Version 0.26"})]})]}),o.jsx("div",{className:"decorative-card decorative-card-right",children:d&&o.jsx(bt,{card:{...d,id:"deco-2",isFaceUp:!0},isFaceUp:!0})})]}),o.jsx("div",{className:"card-ticker-container",onPointerLeave:()=>p(m),children:o.jsxs("div",{className:"card-ticker-track",children:[v.map((C,R)=>o.jsx(bt,{card:{...C,id:`ticker-1-${R}`,isFaceUp:!0},isFaceUp:!0,additionalClassName:"in-hand",onPointerEnter:()=>p(C)},`ticker-1-${R}`)),v.map((C,R)=>o.jsx(bt,{card:{...C,id:`ticker-2-${R}`,isFaceUp:!0},isFaceUp:!0,additionalClassName:"in-hand",onPointerEnter:()=>p(C)},`ticker-2-${R}`))]})})]})}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function Cc({title:a,onBack:t}){return o.jsxs("header",{className:"app-header",children:[o.jsx("h2",{children:a}),t&&o.jsx("button",{className:"btn btn-back",onClick:t,children:"Back"})]})}const pc=[{player:"Player",picks:1},{player:"Opponent",picks:2},{player:"Player",picks:2},{player:"Opponent",picks:1}];function i0({onBack:a,onStartGame:t}){const[l,i]=se.useState(0),[c,d]=se.useState([]),[f,u]=se.useState([]),[p,m]=se.useState([]),[y,v]=se.useState(!1),[x,w]=se.useState(null),[S,E]=se.useState(null),[b,j]=se.useState(0);se.useEffect(()=>{Yl(),j(Y=>Y+1)},[]);const C=se.useMemo(()=>{const Y=Gd(),Z=qo(),ue=sr(),re=new Set(ue.filter(X=>Qr(X)).map(X=>X.name)),ee=Z.filter(X=>re.has(X.protocol)||Y);return console.log("[Protocol Selection] Total cards loaded:",ee.length,"(custom enabled:",Y,")"),ee},[b]),R=se.useMemo(()=>{const Y=new Set(C.map(ue=>ue.protocol)),Z=Array.from(Y).sort();return console.log("[Protocol Selection] Unique protocols:",Z),Z},[C]),F=se.useMemo(()=>{const Y=new Set(C.map(Z=>Z.category));return Array.from(Y).sort()},[C]),L=["Fan-Content","Main 2"],[O,T]=se.useState(new Set),[G,V]=se.useState(!1);se.useEffect(()=>{if(F.length>0&&!G){const Y=new Set(F);L.forEach(Z=>Y.delete(Z)),T(Y),V(!0)}},[F,G]);const z=Y=>{const Z=C.find(ue=>ue.protocol===Y);return(Z==null?void 0:Z.category)||""},U=Y=>{const ue=C.find(re=>re.protocol===Y);return ue!=null&&ue.color?{"--card-custom-color":ue.color,borderColor:ue.color}:{}},k=Y=>{const ue=C.find(re=>re.protocol===Y);return ue!=null&&ue.pattern?`pattern-${ue.pattern}`:""},A=se.useMemo(()=>R.filter(Y=>{const Z=z(Y);return O.has(Z)}),[O]),I=Y=>{T(Z=>{const ue=new Set(Z);return ue.has(Y)?ue.delete(Y):ue.add(Y),ue})},$=pc[l],q=($==null?void 0:$.player)==="Player",M=($==null?void 0:$.player)==="Opponent",B=se.useMemo(()=>new Set([...c,...f]),[c,f]),W=se.useMemo(()=>p.map(Y=>({name:Y,cards:C.filter(Z=>Z.protocol===Y).sort((Z,ue)=>Z.value-ue.value)})),[p]),K=Y=>{if(!q||y)return;const Z=C.filter(ue=>ue.protocol===Y).sort((ue,re)=>ue.value-re.value);Z.length>0&&E(Z[0]),m(ue=>{if(ue.includes(Y))return ue.filter(re=>re!==Y);if(ue.length<$.picks)return[...ue,Y];if(ue.length===$.picks){const re=ue.slice(1);return re.push(Y),re}return ue})},D=async()=>{if(!q||y||p.length!==$.picks)return;v(!0);const Y=[...p];m([]);for(const Z of Y)d(ue=>[...ue,Z]),await new Promise(ue=>setTimeout(ue,300));v(!1),i(Z=>Z+1)};se.useEffect(()=>{M&&!y&&l<pc.length&&(async()=>{v(!0),await new Promise(J=>setTimeout(J,100));const Z=[],ue=R.filter(J=>{if(B.has(J))return!1;const me=z(J);return O.has(me)}),re=R.filter(J=>!B.has(J)),ee=ue.length>=$.picks?[...ue]:[...re],X=[],le=Z.filter(J=>ee.includes(J));for(let J=0;J<$.picks;J++)if(le.length>0){const me=le.shift();X.push(me);const ve=ee.indexOf(me);ve>-1&&ee.splice(ve,1)}else if(ee.length>0){const me=Math.floor(Math.random()*ee.length);X.push(ee.splice(me,1)[0])}for(const J of X)await new Promise(me=>setTimeout(me,1e3)),w(J),await new Promise(me=>setTimeout(me,1e3)),w(null),u(me=>[...me,J]);v(!1),i(J=>J+1)})()},[l,M,y,B,$,O,R,z]),se.useEffect(()=>{l>=pc.length&&!y&&setTimeout(()=>{t(c,f)},1e3)},[l,y,t,c,f]);const Q=Y=>{const Z=["protocol-card",`card-protocol-${Y.toLowerCase()}`];return p.includes(Y)&&Z.push("selected"),B.has(Y)&&Z.push("chosen"),x===Y&&Z.push("is-scanning"),Z.join(" ")},ae=()=>y&&M?"Opponent is selecting protocols...":($==null?void 0:$.player)==="Player"?`Player, select ${$.picks} protocol(s). (${p.length}/${$.picks})`:l>=pc.length?"Finalizing selections...":"Waiting for Opponent...";return o.jsxs("div",{className:"screen protocol-selection-screen",children:[o.jsx(Cc,{title:"Protocol Selection",onBack:a}),o.jsxs("div",{className:"protocol-selection-layout",children:[o.jsxs("div",{className:"protocol-selection-sidebar",children:[o.jsxs("div",{className:"player-protocols-area",children:[o.jsx("h3",{children:"Your Protocols"}),c.map(Y=>o.jsx("div",{className:`protocol-display-card player card-protocol-${Y.toLowerCase()} ${k(Y)}`,style:U(Y),children:Y},Y))]}),o.jsx("div",{className:"protocol-preview-area",children:S?o.jsx(bt,{card:{...S,id:"preview",isFaceUp:!0},isFaceUp:!0}):o.jsx("p",{children:W.length>0?"Hover over a card below to see details.":"Select a protocol to see its cards."})})]}),o.jsxs("div",{className:"protocol-grid-container",children:[o.jsx("p",{children:ae()}),o.jsx("div",{className:"category-filters",children:F.map(Y=>o.jsxs("label",{className:"category-filter-item",children:[o.jsx("input",{type:"checkbox",checked:O.has(Y),onChange:()=>I(Y)}),o.jsx("span",{children:Y})]},Y))}),o.jsx("div",{className:"protocol-grid-scroll-wrapper",children:o.jsx("div",{className:"protocol-grid",children:A.map(Y=>{const Z=U(Y),re={fontSize:Y.length>10?"0.65em":"1em"};return o.jsxs("div",{className:`${Q(Y)} ${k(Y)}`,style:Z,onClick:()=>K(Y),role:"button","aria-disabled":B.has(Y)||!q||y,tabIndex:!B.has(Y)&&q&&!y?0:-1,onKeyPress:ee=>ee.key==="Enter"&&K(Y),children:[o.jsx("span",{className:"protocol-category-label",children:z(Y)}),o.jsx("span",{className:"protocol-name",style:re,children:Y})]},Y)})})}),q&&o.jsx("button",{className:"btn",onClick:D,disabled:y||p.length!==($==null?void 0:$.picks),children:"Confirm Selection"})]}),o.jsxs("div",{className:"opponent-protocols-area",children:[o.jsx("h3",{children:"Opponent Protocols"}),f.map(Y=>o.jsx("div",{className:`protocol-display-card opponent card-protocol-${Y.toLowerCase()} ${k(Y)}`,style:U(Y),children:Y},Y))]})]}),o.jsx("div",{className:"selected-protocol-cards-container",children:W.length>0&&[...W].reverse().map(Y=>o.jsx("div",{className:"protocol-card-row",children:Y.cards.map(Z=>o.jsx(bt,{card:{...Z,id:`selection-${Z.protocol}-${Z.value}`,isFaceUp:!0},isFaceUp:!0,additionalClassName:"in-hand",onClick:()=>E(Z),onPointerEnter:()=>E(Z)},`${Y.name}-${Z.value}`))},Y.name))})]})}const d0="modulepreload",u0=function(a){return"/"+a},Yh={},p0=function(t,l,i){let c=Promise.resolve();if(l&&l.length>0){let f=function(m){return Promise.all(m.map(y=>Promise.resolve(y).then(v=>({status:"fulfilled",value:v}),v=>({status:"rejected",reason:v}))))};document.getElementsByTagName("link");const u=document.querySelector("meta[property=csp-nonce]"),p=(u==null?void 0:u.nonce)||(u==null?void 0:u.getAttribute("nonce"));c=f(l.map(m=>{if(m=u0(m),m in Yh)return;Yh[m]=!0;const y=m.endsWith(".css"),v=y?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${m}"]${v}`))return;const x=document.createElement("link");if(x.rel=y?"stylesheet":d0,y||(x.as="script"),x.crossOrigin="",x.href=m,p&&x.setAttribute("nonce",p),document.head.appendChild(x),y)return new Promise((w,S)=>{x.addEventListener("load",w),x.addEventListener("error",()=>S(new Error(`Unable to preload CSS for ${m}`)))})}))}function d(f){const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=f,window.dispatchEvent(u),!u.defaultPrevented)throw f}return c.then(f=>{for(const u of f||[])u.status==="rejected"&&d(u.reason);return t().catch(d)})},cn=[];for(let a=0;a<256;++a)cn.push((a+256).toString(16).slice(1));function f0(a,t=0){return(cn[a[t+0]]+cn[a[t+1]]+cn[a[t+2]]+cn[a[t+3]]+"-"+cn[a[t+4]]+cn[a[t+5]]+"-"+cn[a[t+6]]+cn[a[t+7]]+"-"+cn[a[t+8]]+cn[a[t+9]]+"-"+cn[a[t+10]]+cn[a[t+11]]+cn[a[t+12]]+cn[a[t+13]]+cn[a[t+14]]+cn[a[t+15]]).toLowerCase()}let Td;const h0=new Uint8Array(16);function m0(){if(!Td){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Td=crypto.getRandomValues.bind(crypto)}return Td(h0)}const y0=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Gh={randomUUID:y0};function Ze(a,t,l){var c;if(Gh.randomUUID&&!a)return Gh.randomUUID();a=a||{};const i=a.random??((c=a.rng)==null?void 0:c.call(a))??m0();if(i.length<16)throw new Error("Random bytes length must be >= 16");return i[6]=i[6]&15|64,i[8]=i[8]&63|128,f0(i)}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const ne=(a,t,l,i)=>{let c=a._logIndentLevel||0;a._currentPhaseContext&&c===0&&(c=1);const d={player:t,message:l,indentLevel:c,sourceCard:a._currentEffectSource,phase:a._currentPhaseContext,sourceCardRef:i==null?void 0:i.sourceCardRef,targetCardRefs:i==null?void 0:i.targetCardRefs};return{...a,log:[...a.log,d]}},Ka=a=>({...a,_logIndentLevel:(a._logIndentLevel||0)+1}),Ao=a=>({...a,_logIndentLevel:Math.max(0,(a._logIndentLevel||0)-1)}),Be=(a,t)=>({...a,_currentEffectSource:t}),Ke=(a,t)=>({...a,_currentPhaseContext:t});/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function bn(a){const t=[];for(const l of["player","opponent"])a[l].lanes.forEach((i,c)=>{i.forEach((d,f)=>{if(d.isFaceUp){const u=d;if(u.customEffects){const p=f===i.length-1;(u.customEffects.topEffects||[]).forEach(v=>{v.params.action==="passive_rule"&&v.trigger==="passive"&&t.push({rule:v.params.rule,cardOwner:l,laneIndex:c,sourceCardId:d.id})}),(u.customEffects.middleEffects||[]).forEach(v=>{v.params.action==="passive_rule"&&v.trigger==="passive"&&t.push({rule:v.params.rule,cardOwner:l,laneIndex:c,sourceCardId:d.id})}),p&&(u.customEffects.bottomEffects||[]).forEach(x=>{x.params.action==="passive_rule"&&x.trigger==="passive"&&t.push({rule:x.params.rule,cardOwner:l,laneIndex:c,sourceCardId:d.id})})}d.protocol==="Frost"&&d.value===1&&(t.push({rule:{type:"block_flips",target:"all",scope:"global"},cardOwner:l,laneIndex:c}),f===i.length-1&&t.push({rule:{type:"block_protocol_rearrange",target:"all",scope:"global"},cardOwner:l,laneIndex:c})),d.protocol==="Frost"&&d.value===3&&t.push({rule:{type:"block_shifts_from_and_to_lane",target:"all",scope:"this_lane"},cardOwner:l,laneIndex:c})}})});return t}function Za(a,t,l,i,c,d){var S,E,b;const f=bn(a),u=t==="player"?"opponent":"player",p=a[t].protocols[l],m=a[u].protocols[l],y=c===p||c===m;let v=!1;if(d){const j=d;v=[...((S=j.customEffects)==null?void 0:S.topEffects)||[],...((E=j.customEffects)==null?void 0:E.middleEffects)||[],...((b=j.customEffects)==null?void 0:b.bottomEffects)||[]].some(R=>{var F,L,O;return((F=R.params)==null?void 0:F.action)==="passive_rule"&&((O=(L=R.params)==null?void 0:L.rule)==null?void 0:O.type)==="allow_play_on_opponent_side"})}for(const{rule:j,cardOwner:C,laneIndex:R}of f){const F=j.scope==="global"||R===l,L=j.target==="all"||j.target==="self"&&C===t||j.target==="opponent"&&C===u;if(!(!F||!L))switch(j.type){case"block_all_play":return{allowed:!1,reason:"Cannot play cards in this lane (passive rule)"};case"block_face_down_play":if(!i)return{allowed:!1,reason:"Cannot play cards face-down in this lane (passive rule)"};break;case"block_face_up_play":if(i)return{allowed:!1,reason:"Cannot play cards face-up in this lane (passive rule)"};break;case"require_face_down_play":if(i)return{allowed:!1,reason:"Can only play cards face-down (passive rule)"};break;case"allow_any_protocol_play":break;case"require_non_matching_protocol":if(i&&y)return{allowed:!1,reason:"Can only play cards without matching protocols (passive rule)"};break}}const x=f.some(({rule:j,cardOwner:C,laneIndex:R})=>{if(j.type!=="allow_any_protocol_play")return!1;const F=j.scope==="global"||R===l,L=j.target==="all"||j.target==="self"&&C===t||j.target==="opponent"&&C===u;return F&&L}),w=f.some(({rule:j,cardOwner:C,laneIndex:R})=>{if(j.type!=="require_non_matching_protocol")return!1;const F=j.scope==="global"||R===l,L=j.target==="all"||j.target==="self"&&C===t||j.target==="opponent"&&C===u;return F&&L});return i&&!y&&!x&&!w&&!v?{allowed:!1,reason:"Face-up play requires matching protocol"}:{allowed:!0}}function Sc(a){return bn(a).some(({rule:l})=>l.type==="require_non_matching_protocol"&&l.scope==="global")}function bc(a,t,l){const i=bn(a),c=t==="player"?"opponent":"player";return i.some(({rule:d,cardOwner:f,laneIndex:u})=>{if(d.type!=="allow_any_protocol_play")return!1;const p=d.scope==="global"||l!==void 0&&u===l,m=d.target==="all"||d.target==="self"&&f===t||d.target==="opponent"&&f===c;return p&&m})}function Ql(a,t){const l=t.customEffects;return l?(l.bottomEffects||[]).some(c=>{var d,f,u;return((d=c.params)==null?void 0:d.action)!=="passive_rule"?!1:((u=(f=c.params)==null?void 0:f.rule)==null?void 0:u.type)==="allow_play_on_opponent_side"}):!1}function g0(a,t){const l=bn(a);for(const{rule:i,laneIndex:c}of l)if(!(i.type!=="block_flips"||!(i.scope==="global"||c===t)))return{allowed:!1,reason:"Cards cannot be flipped face-up in this lane (passive rule)"};return{allowed:!0}}function Xl(a,t,l){const i=bn(a);for(const{rule:c,laneIndex:d}of i){if(c.type==="block_shifts_from_lane"&&d===t)return c.scope,{allowed:!1,reason:"Cards cannot shift from this lane (passive rule)"};if(c.type==="block_shifts_to_lane"&&d===l)return c.scope,{allowed:!1,reason:"Cards cannot shift to this lane (passive rule)"};if(c.type==="block_shifts_from_and_to_lane"&&(d===t||d===l))return{allowed:!1,reason:"Cards cannot shift from or to this lane (passive rule)"}}return{allowed:!0}}function v0(a){const t=bn(a);for(const{rule:l}of t)if(l.type==="block_protocol_rearrange")return{allowed:!1,reason:"Protocols cannot be rearranged (passive rule)"};return{allowed:!0}}function _0(a,t,l){const i=bn(a),c=a.turn;for(const{rule:d,cardOwner:f,laneIndex:u,sourceCardId:p}of i)if(!(d.type!=="ignore_middle_commands"||!(d.scope==="global"||u===t))&&!(d.onlyDuringYourTurn&&c!==f)){if(l!==void 0){const y=f==="player"?"opponent":"player";if(d.target==="opponent"&&l!==y||d.target==="self"&&l!==f)continue}if(p)for(const y of["player","opponent"])for(const v of a[y].lanes){const x=v.find(w=>w.id===p);if(x)return x}return null}return null}function Sa(a){return bn(a).some(({rule:l})=>l.type==="block_flips"&&l.scope==="global")}function x0(a){return bn(a).some(({rule:l})=>l.type==="block_protocol_rearrange")}function Gl(a,t){const l=bn(a);for(const{rule:i,sourceCardId:c}of l)if(i.type==="block_flip_this_card"&&c===t)return{allowed:!1,reason:"This card cannot be flipped (passive rule)"};return{allowed:!0}}function Wd(a,t){const l=bn(a);for(const{rule:i,cardOwner:c}of l)if(i.type==="block_draw_conditional"){const f=(i.conditionTarget||"self")==="self"?c:c==="player"?"opponent":"player",u=i.blockTarget||"self";let p;if(u==="self"?p=c:u==="opponent"?p=c==="player"?"opponent":"player":p="all",a[f].hand.length>0&&(p==="all"||p===t))return{allowed:!1,reason:"Cannot draw cards (passive rule)"}}return{allowed:!0}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const w0={},C0={},S0={},b0={};function Kl(a,t,l,i){const{cardOwner:c,opponent:d,triggerType:f}=i,u=l[c].lanes[t];if(!u.find(S=>S.id===a.id))return{newState:l};if(!(f==="uncover"||u.length>0&&u[u.length-1].id===a.id))return{newState:l};const y=_0(l,t,c);if(y){const S=`${a.protocol}-${a.value}`,E=`${y.protocol}-${y.value}`;return{newState:ne(l,c,`${S}: Effect blocked by ${E}.`)}}if(l.skipNextMiddleCommand===a.id){const S=`${a.protocol}-${a.value}`;let E={...l};return delete E.skipNextMiddleCommand,E=ne(E,c,`${S}: Middle commands ignored.`),{newState:E}}const v=a;if(v.customEffects&&v.customEffects.middleEffects&&v.customEffects.middleEffects.length>0){let S=Ka(l);const E=`${a.protocol}-${a.value}`;S=Be(S,E),S=Ke(S,"middle");let b=S;const j=b._pendingCustomEffects;if(j&&j.sourceCardId!==a.id){const F=b.lastCustomEffectTargetCardId,L={type:"execute_remaining_custom_effects",sourceCardId:j.sourceCardId,laneIndex:j.laneIndex,effects:j.effects,context:j.context,actor:j.context.cardOwner,selectedCardFromPreviousEffect:F||j.selectedCardFromPreviousEffect,savedLastCustomEffectTargetCardId:b.lastCustomEffectTargetCardId,logSource:j.logSource,logPhase:j.logPhase,logIndentLevel:j.logIndentLevel},O=b._deferredParentEffects||[];b={...b,_deferredParentEffects:[...O,L]},delete b._pendingCustomEffects}b.lastCustomEffectTargetCardId&&(b={...b,lastCustomEffectTargetCardId:null});for(let F=0;F<v.customEffects.middleEffects.length;F++){const L=v.customEffects.middleEffects[F],O=v.customEffects.middleEffects.slice(F+1),T=O.length>0;if(T&&(b._pendingCustomEffects={sourceCardId:a.id,laneIndex:t,context:i,effects:O,logSource:b._currentEffectSource,logPhase:b._currentPhaseContext,logIndentLevel:b._logIndentLevel||0}),b=ut(a,t,b,i,L).newState,b.actionRequired)return{newState:Ce(b)};const V=b._pendingCustomEffects;V&&T&&V.sourceCardId===a.id&&delete b._pendingCustomEffects}const C=b._deferredParentEffects;if(C&&C.length>0){const F=C[C.length-1],L=C.slice(0,-1);b={...b,_deferredParentEffects:L.length>0?L:void 0,lastCustomEffectTargetCardId:F.savedLastCustomEffectTargetCardId||F.selectedCardFromPreviousEffect,_pendingCustomEffects:{sourceCardId:F.sourceCardId,laneIndex:F.laneIndex,context:F.context,effects:F.effects,selectedCardFromPreviousEffect:F.selectedCardFromPreviousEffect,logSource:F.logSource,logPhase:F.logPhase,logIndentLevel:F.logIndentLevel}}}return{newState:Ce(b)}}const x=`${a.protocol}-${a.value}`,w=w0[x];if(w){let S=Ka(l);const E=`${a.protocol}-${a.value}`;S=Be(S,E),S=Ke(S,"middle");const b=w(a,t,S,i);let j=b.newState;const C=Ce(j);return{...b,newState:C}}return{newState:l}}function Qd(a,t,l,i){if(!a.isFaceUp)return{newState:l};const c=a;if(c.customEffects){const p=[...c.customEffects.topEffects||[],...c.customEffects.middleEffects||[],...c.customEffects.bottomEffects||[]].filter(m=>m.trigger==="on_cover"||m.trigger==="on_cover_or_flip");if(p.length>0){const m=`${a.protocol}-${a.value}`;let y=Be(l,m);y=Ke(y,"oncover");let v=y;const x=[];for(const S of p){const E=ut(a,t,v,i,S);if(v=E.newState,E.animationRequests&&x.push(...E.animationRequests),v.actionRequired)return{newState:Ce(v),animationRequests:x.length>0?x:void 0}}return{newState:Ce(v),animationRequests:x.length>0?x:void 0}}}const d=`${a.protocol}-${a.value}`,f=b0[d];if(f){const u=`${a.protocol}-${a.value}`;let p=Be(l,u);p=Ke(p,"oncover");const m=f(a,t,p,i),y=Ce(m.newState);return{...m,newState:y}}return{newState:l}}function E0(a,t,l){const i=[],c=new Set,d=l==="Start"?"start":"end";return a[t].lanes.flat().forEach(f=>{var p;if(!f.isFaceUp||c.has(f.id))return;const u=f;if((p=u.customEffects)!=null&&p.topEffects){const m=u.customEffects.topEffects.filter(y=>y.trigger===d);m.length>0&&(i.push({cardId:f.id,box:"top",effectIds:m.map(y=>y.id)}),c.add(f.id))}f.top.includes(`'emphasis'>${l}:`)&&(c.has(f.id)||(i.push({cardId:f.id,box:"top",effectIds:[]}),c.add(f.id)))}),a[t].lanes.forEach(f=>{var m;if(f.length===0)return;const u=f[f.length-1];if(!u.isFaceUp||c.has(u.id))return;const p=u;if((m=p.customEffects)!=null&&m.bottomEffects){const y=p.customEffects.bottomEffects.filter(v=>v.trigger===d);y.length>0&&(i.push({cardId:u.id,box:"bottom",effectIds:y.map(v=>v.id)}),c.add(u.id))}u.bottom.includes(`'emphasis'>${l}:`)&&(c.has(u.id)||(i.push({cardId:u.id,box:"bottom",effectIds:[]}),c.add(u.id)))}),i}function j0(a,t,l){for(let i=0;i<a[t].lanes.length;i++){const c=a[t].lanes[i],d=c.find(f=>f.id===l.cardId);if(d)return!d.isFaceUp||l.box==="bottom"&&!(c.length>0&&c[c.length-1].id===d.id)?null:{card:d,laneIndex:i}}return null}function k0(a,t,l){const i=a,c=l==="Start"?"start":"end";if(i.customEffects){const u=t==="top"?i.customEffects.topEffects:i.customEffects.bottomEffects,p=(u==null?void 0:u.filter(m=>m.trigger===c))||[];if(p.length>0)return p.map(y=>{var w,S;const v=((w=y.params)==null?void 0:w.action)||"effect",x=(S=y.params)==null?void 0:S.count;return x?`${v} ${x}`:v}).join(", ")}const f=(t==="top"?a.top:a.bottom).match(new RegExp(`${l}:\\s*</span>\\s*([^<]+)`,"i"));return f?f[1].trim():l+" effect"}function vc(a,t,l){const i=a.turn;let c={...a,_logIndentLevel:0};const d=t==="Start",f=d?"_startPhaseEffectSnapshot":"_endPhaseEffectSnapshot",u=d?"_selectedStartEffectId":"_selectedEndEffectId",p=c[u];let m=c[f];m&&m.length>0&&(m.some(T=>c[i].lanes.flat().some(G=>G.id===T.cardId))||(m=void 0,c[f]=void 0)),m||(m=E0(c,i,t),c[f]=m);const y=d?c.processedStartEffectIds||[]:c.processedEndEffectIds||[],v=[];for(const O of m){if(y.includes(O.cardId))continue;const G=j0(c,i,O);G&&v.push({entry:O,card:G.card,laneIndex:G.laneIndex})}if(v.length===0)return c[f]=void 0,c[u]=void 0,{newState:c};let x;if(p&&(x=v.find(O=>O.entry.cardId===p),x||console.warn(`[processTriggeredEffects] Selected effect ${p} not found in valid effects!`),c[u]=void 0),!x){if(v.length>1){const O=v.map(({entry:T,card:G})=>({cardId:T.cardId,cardName:`${G.protocol}-${G.value}`,box:T.box,effectDescription:k0(G,T.box,t)}));return c.actionRequired={type:"select_phase_effect",actor:i,phase:t,availableEffects:O},{newState:c}}x=v[0]}const{entry:w,card:S,laneIndex:E}=x,b=i==="player"?"opponent":"player",j={cardOwner:i,actor:i,currentTurn:a.turn,opponent:b,triggerType:t==="Start"?"start":"end"},C=S,R=t==="Start"?"start":"end";if(C.customEffects){const O=w.box==="top"?C.customEffects.topEffects:C.customEffects.bottomEffects,T=(O==null?void 0:O.filter(G=>G.trigger===R))||[];if(T.length>0){const G=`${S.protocol}-${S.value}`,V=t==="Start"?"start":"end";c=Be(c,G),c=Ke(c,V);const z={...c,_currentPhaseContext:void 0},U=ne(z,i,`${t} effect triggers.`);c={...c,log:U.log},c=Ka(c);for(let k=0;k<T.length;k++){const A=T[k],I=ut(S,E,c,j,A);if(c=Ce(I.newState),c.actionRequired){const $=T.slice(k+1);return $.length>0&&(c._pendingCustomEffects={sourceCardId:S.id,laneIndex:E,context:j,effects:$,logSource:c._currentEffectSource,logPhase:c._currentPhaseContext,logIndentLevel:c._logIndentLevel||0}),d?c.processedStartEffectIds=[...c.processedStartEffectIds||[],S.id]:c.processedEndEffectIds=[...c.processedEndEffectIds||[],S.id],{newState:c}}}return d?c.processedStartEffectIds=[...c.processedStartEffectIds||[],S.id]:c.processedEndEffectIds=[...c.processedEndEffectIds||[],S.id],c=Ao(c),c=Be(c,void 0),c=Ke(c,void 0),vc(c,t,l)}}const F=`${S.protocol}-${S.value}`,L=l[F];if(L){const O=`${S.protocol}-${S.value}`,T=t==="Start"?"start":"end";c=Be(c,O),c=Ke(c,T);const G={...c,_currentPhaseContext:void 0},V=ne(G,i,`${t} effect triggers.`);c={...c,log:V.log},c=Ka(c);const z=L(S,c,j);return c=Ce(z.newState),d?c.processedStartEffectIds=[...c.processedStartEffectIds||[],S.id]:c.processedEndEffectIds=[...c.processedEndEffectIds||[],S.id],c.actionRequired?{newState:c}:(c=Ao(c),c=Be(c,void 0),c=Ke(c,void 0),vc(c,t,l))}return{newState:c}}function Xd(a){return vc(a,"Start",C0)}function vm(a){return vc(a,"End",S0)}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const N0=a=>{if(!a.useControlMechanic)return a;const t=a.turn,l=t==="player"?"opponent":"player",i=a[t],c=a[l];let d=0;const f=i.laneValues[0],u=i.laneValues[1],p=i.laneValues[2],m=c.laneValues[0],y=c.laneValues[1],v=c.laneValues[2];if(f>m&&d++,u>y&&d++,p>v&&d++,d>=2&&a.controlCardHolder!==t){let x=Be(a,void 0);return x=Ke(x,void 0),x={...x,_logIndentLevel:0},x=ne(x,t,`${t==="player"?"Player":"Opponent"} gains the Control Component.`),{...x,controlCardHolder:t}}return a},Xr=a=>{if(a.winner)return a;const t=a.turn;let l={...a};switch(l=Be(l,void 0),l=Ke(l,void 0),l={...l,_logIndentLevel:0},a.phase){case"start":return l=Xd(l).newState,l.actionRequired?l:(l=Be(l,void 0),l=Ke(l,void 0),l={...l,_logIndentLevel:0},l._startPhaseEffectSnapshot=void 0,{...l,phase:"control"});case"control":{const i=N0(l);let c=Be(i,void 0);return c=Ke(c,void 0),c={...c,_logIndentLevel:0},{...c,phase:"compile"}}case"compile":{const i=bm(l,t);return i.length>0?{...l,compilableLanes:i}:(l=Be(l,void 0),l=Ke(l,void 0),l={...l,_logIndentLevel:0},{...l,phase:"action",compilableLanes:[]})}case"action":return l=Be(l,void 0),l=Ke(l,void 0),l={...l,_logIndentLevel:0},{...l,phase:"hand_limit"};case"hand_limit":{const i=l[t],c=i.lanes.some(u=>u.length>0&&u[u.length-1].isFaceUp&&u[u.length-1].protocol==="Spirit"&&u[u.length-1].value===0),f=bn(l).some(({rule:u,cardOwner:p})=>u.type==="skip_check_cache_phase"&&(u.target==="self"&&p===t||u.target==="all")&&p===t);if(c||f){let u=ne(l,t,"Skipping Check Cache phase.");return u=Be(u,void 0),u=Ke(u,void 0),u={...u,_logIndentLevel:0},{...u,phase:"end"}}if(i.hand.length>5){const u=i.hand.length-5;let m=ne(l,t,`Check Cache: ${t==="player"?"Player":"Opponent"} has ${i.hand.length} cards, must discard ${u}.`);return m=Ka(m),{...m,actionRequired:{type:"discard",actor:t,count:u}}}return l=Be(l,void 0),l=Ke(l,void 0),l={...l,_logIndentLevel:0},{...l,phase:"end"}}case"end":{const i={...l};l=vm(l).newState;const c=i.actionRequired,d=l.actionRequired;if(d&&d!==c||l.queuedActions&&l.queuedActions.length>0&&(l=Zr(l),l.actionRequired))return l;const f=t==="player"?"opponent":"player",u={...l[t],cannotCompile:!1};return l=Be(l,void 0),l=Ke(l,void 0),l={...l,_logIndentLevel:0},l=Ce(l),{...l,[t]:u,turn:f,phase:"start",processedStartEffectIds:[],processedEndEffectIds:[],processedSpeed1TriggerThisTurn:!1,processedUncoverEventIds:[],_startPhaseEffectSnapshot:void 0,_endPhaseEffectSnapshot:void 0,_interruptedTurn:void 0,_interruptedPhase:void 0}}}return a};function Ge(a){var u;const t=a._pendingCustomEffects;if(!t||t.effects.length===0)return a;const l=t.effects.map(p=>p.id).join(",");if((u=a.queuedActions)==null?void 0:u.some(p=>{var m;return p.type==="execute_remaining_custom_effects"&&p.sourceCardId===t.sourceCardId&&((m=p.effects)==null?void 0:m.map(y=>y.id).join(","))===l})){const p={...a};return delete p._pendingCustomEffects,p}const c=t.selectedCardFromPreviousEffect||a.lastCustomEffectTargetCardId,d={type:"execute_remaining_custom_effects",sourceCardId:t.sourceCardId,laneIndex:t.laneIndex,effects:t.effects,context:t.context,actor:t.context.cardOwner,selectedCardFromPreviousEffect:c,logSource:t.logSource,logPhase:t.logPhase,logIndentLevel:t.logIndentLevel},f={...a,queuedActions:[d,...a.queuedActions||[]]};return delete f._pendingCustomEffects,f}const ba=a=>{var i,c;let t=Ge(a);if(!t.queuedActions||t.queuedActions.length===0){const d=t._deferredParentEffects;if(d&&d.length>0&&!t.actionRequired){const f=d[d.length-1],u=d.slice(0,-1),p={type:"execute_remaining_custom_effects",sourceCardId:f.sourceCardId,laneIndex:f.laneIndex,effects:f.effects,context:f.context,actor:f.actor||((i=f.context)==null?void 0:i.cardOwner),selectedCardFromPreviousEffect:f.selectedCardFromPreviousEffect,savedLastCustomEffectTargetCardId:f.savedLastCustomEffectTargetCardId,logSource:f.logSource,logPhase:f.logPhase,logIndentLevel:f.logIndentLevel};return ba({...t,_deferredParentEffects:u.length>0?u:void 0,lastCustomEffectTargetCardId:f.savedLastCustomEffectTargetCardId||f.selectedCardFromPreviousEffect,queuedActions:[p]})}return t}let l=[...t.queuedActions];for(;l.length>0;){const d=l.shift();if(d.sourceCardId&&d.type!=="flip_self"){const f=we(t,d.sourceCardId);if(!f||!f.card.isFaceUp){const u=f?`${f.card.protocol}-${f.card.value}`:"a card",p=t._logSource;t=Be(t,u),t=ne(t,d.actor,"Queued effect was cancelled because the source is no longer active."),t=Be(t,p);continue}}if(d.type==="flip_self"){const{sourceCardId:f,actor:u}=d,p=we(t,f),m=To(t,f);if(p&&p.card.isFaceUp&&m){const y=`${p.card.protocol}-${p.card.value}`;t=ne(t,u,`${y}: Flips itself.`),t=lr(new Set([f]),t),t.animationState={type:"flipCard",cardId:f}}else{const y=p?`${p.card.protocol}-${p.card.value}`:"the source card",v=p?p.card.isFaceUp?"now covered":"flipped face-down":"deleted";t=ne(t,u,`The self-flip effect from ${y} was cancelled because it is ${v}.`)}continue}if(d.type==="execute_follow_up_effect"){const{sourceCardId:f,followUpEffect:u,actor:p,logContext:m}=d,y=we(t,f),v=To(t,f);if(y&&y.card.isFaceUp&&v){const x=t[y.owner].lanes.find(C=>C.some(R=>R.id===f)),w=t[y.owner].lanes.indexOf(x),S={cardOwner:y.owner,actor:p,currentTurn:t.turn,opponent:y.owner==="player"?"opponent":"player"},E=(m==null?void 0:m.sourceCardName)||`${y.card.protocol}-${y.card.value}`,b=(m==null?void 0:m.phase)||(t.phase==="start"?"start":"end");if(t={...t,_logIndentLevel:(m==null?void 0:m.indentLevel)||1,_currentEffectSource:E,_currentPhaseContext:b},t=ut(y.card,w,t,S,u).newState,t.actionRequired)return t={...t,queuedActions:l},t}else{const x=y?`${y.card.protocol}-${y.card.value}`:"the source card",w=y?y.card.isFaceUp?"now covered":"flipped face-down":"deleted";t=ne(t,p,`The follow-up effect from ${x} was cancelled because it is ${w}.`)}continue}if(d.type==="execute_conditional_followup"){const{sourceCardId:f,laneIndex:u,followUpEffect:p,context:m,actor:y}=d,v=[...t.player.lanes.flat(),...t.opponent.lanes.flat()].find(w=>w.id===f);if(!v){t=ne(t,y,"Conditional follow-up effect skipped: source card no longer exists.");continue}if(!v.isFaceUp){const w=`${v.protocol}-${v.value}`;t=ne(t,y,`Conditional follow-up effect from ${w} cancelled: card was flipped face-down.`);continue}const x=ut(v,u,t,m,p);if(t=Ce(x.newState),t.actionRequired)return p.conditional&&p.conditional.thenEffect&&(t.actionRequired={...t.actionRequired,followUpEffect:p.conditional.thenEffect,conditionalType:p.conditional.type}),t={...t,queuedActions:l},t;if(p.conditional&&p.conditional.thenEffect){const w=ut(v,u,t,m,p.conditional.thenEffect);if(t=Ce(w.newState),t.actionRequired)return t={...t,queuedActions:l},t}continue}if(d.type==="execute_remaining_custom_effects"){const{sourceCardId:f,laneIndex:u,effects:p,context:m,selectedCardFromPreviousEffect:y,logSource:v,logPhase:x,logIndentLevel:w}=d;v!==void 0&&(t={...t,_currentEffectSource:v}),x!==void 0&&(t={...t,_currentPhaseContext:x}),w!==void 0&&(t={...t,_logIndentLevel:w});const S=we(t,f);if(!S){t=ne(t,m.cardOwner,"Remaining effects cancelled because the source card was deleted or returned.");continue}if(!S.card.isFaceUp){const C=`${S.card.protocol}-${S.card.value}`;t=ne(t,m.cardOwner,`Remaining effects from ${C} cancelled because it was flipped face-down.`);continue}if(!R0(t,f)){const C=`${S.card.protocol}-${S.card.value}`;t=ne(t,m.cardOwner,`Remaining effects from ${C} cancelled because it is now covered.`);continue}const b=d.savedLastCustomEffectTargetCardId;b&&(t.lastCustomEffectTargetCardId=b),y&&(t._selectedCardFromPreviousEffect=y,b||(t.lastCustomEffectTargetCardId=y));for(let C=0;C<p.length;C++){const R=p[C],F=ut(S.card,u,t,m,R);if(t=F.newState,F.animationRequests&&F.animationRequests.length>0&&!t.actionRequired){const L=p.slice(C+1);if(L.length>0){const T={type:"execute_remaining_custom_effects",sourceCardId:f,laneIndex:u,effects:L,context:m,actor:m.cardOwner,logSource:t._currentEffectSource,logPhase:t._currentPhaseContext,logIndentLevel:t._logIndentLevel||0};t.queuedActions=[T,...l||[]]}else t.queuedActions=l;const O=F.animationRequests[0];return O.type==="draw"?t.animationState={type:"drawCard",owner:O.player,cardIds:[]}:O.type==="play"?t.animationState={type:"playCard",cardId:O.cardId,owner:O.owner}:O.type==="delete"&&(t.animationState={type:"deleteCard",cardId:O.cardId,owner:O.owner}),t}if(t.actionRequired){const L=p.slice(C+1);if(L.length>0&&(t._pendingCustomEffects={sourceCardId:f,laneIndex:u,context:m,effects:L,logSource:t._currentEffectSource,logPhase:t._currentPhaseContext,logIndentLevel:t._logIndentLevel||0}),t._interruptedTurn){const O=t._interruptedTurn,T=t._interruptedPhase||t.phase;delete t._interruptedTurn,delete t._interruptedPhase,t.turn=O,t.phase=T}return t.queuedActions=l,t}}const j=t._deferredParentEffects;if(j&&j.length>0){const C=j[j.length-1],R=j.slice(0,-1);l=[{type:"execute_remaining_custom_effects",sourceCardId:C.sourceCardId,laneIndex:C.laneIndex,effects:C.effects,context:C.context,actor:C.actor||((c=C.context)==null?void 0:c.cardOwner),selectedCardFromPreviousEffect:C.selectedCardFromPreviousEffect,savedLastCustomEffectTargetCardId:C.savedLastCustomEffectTargetCardId,logSource:C.logSource,logPhase:C.logPhase,logIndentLevel:C.logIndentLevel},...l||[]],t={...t,_deferredParentEffects:R.length>0?R:void 0,lastCustomEffectTargetCardId:C.savedLastCustomEffectTargetCardId||C.selectedCardFromPreviousEffect}}continue}if(d.type==="reveal_opponent_hand"){const f=t.turn==="player"?"opponent":"player",u={...t[f]};if(u.hand.length>0){u.hand=u.hand.map(y=>({...y,isRevealed:!0})),t[f]=u;const p=we(t,d.sourceCardId),m=p?`${p.card.protocol}-${p.card.value}`:"A card effect";t=ne(t,t.turn,`${m}: Opponent reveals their hand.`)}else{const p=we(t,d.sourceCardId),m=p?`${p.card.protocol}-${p.card.value}`:"A card effect";t=ne(t,t.turn,`${m}: Opponent has no cards to reveal.`)}continue}if(d.type==="pending_uncover_effect"){const{owner:f,laneIndex:u}=d;if(t=Pn(t,f,u).newState,t.actionRequired)return t.queuedActions=l,t;continue}return t.actionRequired=d,t.queuedActions=l,t}return{...t,queuedActions:[],actionRequired:null}},Zr=a=>{var d;if(a.winner||a.actionRequired)return a;const t=a._deferredParentEffects&&a._deferredParentEffects.length>0;if(a.queuedActions&&a.queuedActions.length>0||t){const f=ba(a);if(f.actionRequired)return f;a=f}if(a._interruptedTurn){const f=a._interruptedTurn,u=a._interruptedPhase||a.phase;let p={...a};if(delete p._interruptedTurn,delete p._interruptedPhase,p.turn=f,p.phase=u,u==="start"||u==="end"){if(p.queuedActions&&p.queuedActions.length>0&&(p=ba(p)),!p.actionRequired&&u==="end"){const m=vm(p).newState;if(m.actionRequired)return m;const y=m.turn==="player"?"opponent":"player",v={...m[m.turn],cannotCompile:!1};let x=Be(m,void 0);return x=Ke(x,void 0),x={...x,_logIndentLevel:0},x=Ce(x),{...x,[m.turn]:v,turn:y,phase:"start",processedStartEffectIds:[],processedEndEffectIds:[],processedSpeed1TriggerThisTurn:!1,processedUncoverEventIds:[],_startPhaseEffectSnapshot:void 0,_endPhaseEffectSnapshot:void 0,_interruptedTurn:void 0,_interruptedPhase:void 0}}if(u==="start"&&!p.actionRequired){const m=Xd(p).newState;if(m.actionRequired)return m;let y={...m,phase:"control"};return Wr(y)}return p}a=p}if(((d=a.actionRequired)==null?void 0:d.type)==="prompt_rearrange_protocols"&&a.actionRequired.originalAction){const f=a.actionRequired.originalAction;let u={...a,actionRequired:null,controlCardHolder:null};if(f.type==="compile")return Wr(u);if(f.type==="fill_hand"){const p=cr(u,u.turn,5-u[u.turn].hand.length);return Wr(p)}}if(a.queuedEffect){const{card:f,laneIndex:u}=a.queuedEffect,p={...a,queuedEffect:void 0,_committedCardId:void 0},m=we(p,f.id);if(m){const{card:y,owner:v}=m;let x={...p,_logIndentLevel:0};const w={cardOwner:v,actor:v,currentTurn:x.turn,opponent:v==="player"?"opponent":"player",triggerType:"play"},{newState:S}=Kl(y,u,x,w);if(S.actionRequired)return S;a=S}else console.warn(`Skipping queued effect for ${f.protocol}-${f.value} as it is no longer on the board.`),a=ne(a,a.turn,`Skipping queued effect for ${f.protocol}-${f.value} as it is no longer on the board.`),a=p}if(a.queuedActions&&a.queuedActions.length>0){let f={...a},u=[...f.queuedActions];for(;u.length>0;){const p=u.shift(),m=p.type==="flip_self";if(p.sourceCardId&&!m){const y=we(f,p.sourceCardId);if(!y||!y.card.isFaceUp){const v=y?`${y.card.protocol}-${y.card.value}`:"a card",x=f._logSource;f=Be(f,v),f=ne(f,p.actor,"Queued effect was cancelled because the source is no longer active."),f=Be(f,x);continue}}if(m){const{sourceCardId:y,actor:v}=p,x=we(f,y),w=To(f,y);if(x&&x.card.isFaceUp&&w){const S=`${x.card.protocol}-${x.card.value}`;f=ne(f,v,`${S}: Flips itself.`),f=lr(new Set([y]),f),f.animationState={type:"flipCard",cardId:y}}else{const S=x?`${x.card.protocol}-${x.card.value}`:"the source card",E=x?x.card.isFaceUp?"now covered":"flipped face-down":"deleted";f=ne(f,v,`The self-flip effect from ${S} was cancelled because it is ${E}.`)}continue}if(p.type==="reveal_opponent_hand"){const y=f.turn==="player"?"opponent":"player",v={...f[y]};if(v.hand.length>0){v.hand=v.hand.map(S=>({...S,isRevealed:!0})),f[y]=v;const x=we(f,p.sourceCardId),w=x?`${x.card.protocol}-${x.card.value}`:"A card effect";f=ne(f,f.turn,`${w}: Opponent reveals their hand.`)}else{const x=we(f,p.sourceCardId),w=x?`${x.card.protocol}-${x.card.value}`:"A card effect";f=ne(f,f.turn,`${w}: Opponent has no cards to reveal.`)}continue}return f.actionRequired=p,f.queuedActions=u,f}a={...f,queuedActions:[],actionRequired:null}}const l=a.phase==="action"?"hand_limit":a.phase;let i={...a,phase:l,compilableLanes:[],processedUncoverEventIds:[]};const c=a.turn;for(;i.turn===c&&!i.winner;){const f=i.actionRequired,u=i.phase;i=Xr(i);const p=i.actionRequired;if(p&&p!==f)break;if(i.phase===u&&i.turn===c){console.error("Game is stuck in a phase loop:",i.phase);break}}return i},Wr=a=>{if(a.winner)return a;let t={...a};if(t._interruptedTurn){const i=t._interruptedTurn,c=t._interruptedPhase||t.phase;delete t._interruptedTurn,delete t._interruptedPhase,t.turn=i,t.phase=c}const l=t.turn;for(;t.turn===l&&!t.actionRequired&&!t.winner;){const i=t.phase;if(i==="action")break;if(i==="compile"){const d=bm(t,l);if(d.length>0){t={...t,compilableLanes:d};break}}const c=t.phase;if(t=Xr(t),c===t.phase&&!t.actionRequired){console.error("Game is stuck in an automatic phase loop:",c),console.error("State:",{phase:t.phase,turn:t.turn,actionRequired:t.actionRequired,queuedActions:t.queuedActions,interruptedTurn:t._interruptedTurn});break}}return{...t,animationState:null}},_m=a=>{let t={...a,actionRequired:null};if(t._interruptedTurn)return Zr(t);const l=t._deferredParentEffects&&t._deferredParentEffects.length>0;if(t.queuedActions&&t.queuedActions.length>0||l){const d=ba(t);if(d.actionRequired)return d;t=d}const i=Xd(t).newState;if(i.actionRequired)return i;let c=i;return c.phase!=="control"&&(c={...c,phase:"control"}),c=Xr(c),c.actionRequired||(c=Xr(c)),c},xm=a=>{if(a.winner)return a;let t={...a,phase:"start"};return t=Ce(t),t=Xr(t),t.actionRequired?t:Wr(t)},Wh=Object.freeze(Object.defineProperty({__proto__:null,advancePhase:Xr,continueTurnAfterStartPhaseAction:_m,continueTurnProgression:Wr,processEndOfAction:Zr,processQueuedActions:ba,processStartOfTurn:xm,queuePendingCustomEffects:Ge},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function we(a,t){if(!t)return null;for(const l of["player","opponent"])for(let i=0;i<a[l].lanes.length;i++){const d=a[l].lanes[i].find(f=>f.id===t);if(d)return{card:d,owner:l,laneIndex:i}}return null}function To(a,t){var i;if(!t)return!1;const l=a._committedCardId;for(const c of["player","opponent"])for(const d of a[c].lanes){if(d.length===0)continue;let f=d.length-1;const u=d[d.length-1].id;if(l&&d.length>=2&&u===l&&t!==l&&(f=d.length-2),((i=d[f])==null?void 0:i.id)===t)return!0}return!1}function R0(a,t){if(!t)return!1;for(const l of["player","opponent"])for(const i of a[l].lanes)if(i.length!==0&&i[i.length-1].id===t)return!0;return!1}function Do(a,t){return t?a._committedCardId===t:!1}function Fo(a,t,l){if(t.length===0||l<0||l>=t.length)return!1;const i=a._committedCardId;let c=t.length-1;return i&&t.length>=2&&t[t.length-1].id===i&&(c=t.length-2),l===c}function T0(a,t,l,i){var p;let c={...a};const d=i||((p=a.actionRequired)==null?void 0:p.followUpEffect),f=we(c,t),u=f?pa(f.card,c[f.owner].lanes.find(m=>m.some(y=>y.id===t))||[]):0;if(c=Ge(c),c.actionRequired=null,d&&l){const m=we(c,l);if(m){const y={cardOwner:m.owner,opponent:m.owner==="player"?"opponent":"player",currentTurn:c.turn,actor:m.owner,referencedCard:f==null?void 0:f.card,referencedCardValue:u};let v=-1;for(let x=0;x<c[m.owner].lanes.length;x++)if(c[m.owner].lanes[x].some(w=>w.id===l)){v=x;break}if(v!==-1)return ut(m.card,v,c,y,d).newState}}return c}function wm(a,t,l,i){var w,S,E,b,j;let c={...a};const d=(w=a.actionRequired)==null?void 0:w.followUpEffect,f=(S=a.actionRequired)==null?void 0:S.conditionalType;if(c=Ge(c),c.actionRequired=null,i&&(c=Ao(c)),d&&i){const C=we(c,i);if(C){const R=((E=a.actionRequired)==null?void 0:E.previousHandSize)||0,F=c[t].hand.length,L=Math.max(0,R-F);if(!(f==="then"||f==="if_executed"&&L>0))return c;const T={cardOwner:C.owner,opponent:C.owner==="player"?"opponent":"player",currentTurn:c.turn,actor:t,discardedCount:L,previousHandSize:R};let G=-1;for(let V=0;V<c[C.owner].lanes.length;V++)if(c[C.owner].lanes[V].some(z=>z.id===i)){G=V;break}if(G!==-1)return ut(C.card,G,c,T,d).newState}return c}if(!l||!i)return c;const u=((b=a.actionRequired)==null?void 0:b.previousHandSize)||0,p=c[t].hand.length;if(Math.max(0,u-p)===0)return c;const y=(j=we(c,i))==null?void 0:j.card;y&&`${y.protocol}${y.value}`;const v=c.queuedActions&&c.queuedActions.length>0;let x=null;switch(l){case"fire_1":x={type:"select_cards_to_delete",count:1,sourceCardId:i,disallowedIds:[i],actor:t};break;case"fire_2":x={type:"select_card_to_return",sourceCardId:i,actor:t};break;case"fire_3":x={type:"select_card_to_flip",sourceCardId:i,actor:t,targetFilter:{position:"uncovered",excludeSelf:!0}};break}if(x)if(v){const C=c.queuedActions||[],R=C.filter(L=>L.type==="select_card_to_shift"&&L.followUpEffect),F=C.filter(L=>!(L.type==="select_card_to_shift"&&L.followUpEffect));c.queuedActions=[...F,x,...R]}else c.actionRequired=x;return c}function Ld(a,t,l=null){const i=we(a,t);if(!i)return a;const{card:c,owner:d}=i;if(!c.isFaceUp){let b=-1;for(let j=0;j<a[d].lanes.length;j++)if(a[d].lanes[j].some(C=>C.id===t)){b=j;break}if(b!==-1&&!g0(a,b).allowed)return a}let u=Nt(a,"on_flip",{player:d,cardId:t}).newState;if(!we(u,t))return u;const m=u.actionRequired&&"actor"in u.actionRequired?u.actionRequired.actor:u.turn,y=m==="player"?"Player":"Opponent",v=d==="player"?"Player's":"Opponent's",x=c.isFaceUp?"face-down":"face-up",w=`${c.protocol}-${c.value}`;u=ne(u,m,`${y} flips ${v} ${w} ${x}.`);const S={...u.stats[m],cardsFlipped:u.stats[m].cardsFlipped+1},E={...u[m],stats:S};return u={...u,[m]:E,stats:{...u.stats,[m]:S}},u=lr(new Set([t]),u),u.animationState={type:"flipCard",cardId:t},u.actionRequired=l,u}function Pn(a,t,l){var f;const i=a[t].lanes[l];if(i.length===0)return{newState:a};const c=i[i.length-1],d=To(a,c.id);if(c.isFaceUp&&d){const u=`${c.id}-${l}`;if((f=a.processedUncoverEventIds)!=null&&f.includes(u))return{newState:a};const p={source:a._currentEffectSource,phase:a._currentPhaseContext,indentLevel:a._logIndentLevel||0},m=`${c.protocol}-${c.value}`;let y=Be(a,m);y=Ke(y,"uncover"),y=ne(y,t,`${c.protocol}-${c.value} is uncovered and its effects are re-triggered.`),y.processedUncoverEventIds=[...y.processedUncoverEventIds||[],u];const v={cardOwner:t,actor:t,currentTurn:y.turn,opponent:t==="player"?"opponent":"player",triggerType:"uncover"},x=Kl(c,l,y,v);if(x.newState.actionRequired||(x.newState={...x.newState,_currentEffectSource:p.source,_currentPhaseContext:p.phase,_logIndentLevel:p.indentLevel}),x.newState.actionRequired){const w=x.newState.actionRequired.actor;if(a._interruptedTurn&&w===a._interruptedTurn){const S=x.newState.actionRequired;return x.newState.actionRequired=null,x.newState.queuedActions=[...x.newState.queuedActions||[],S],x.newState=Ge(x.newState),x}x.newState=Ge(x.newState),w!==a.turn&&(x.newState._interruptedTurn=a.turn,x.newState._interruptedPhase=a.phase,x.newState.turn=w,x.newState.actionRequired.type==="prompt_rearrange_protocols"&&(x.newState.actionRequired={...x.newState.actionRequired,originalAction:{type:"resume_interrupted_turn",interruptedTurn:a.turn,interruptedPhase:a.phase}}))}else x.newState._interruptedTurn&&(x.newState.turn=x.newState._interruptedTurn,x.newState._interruptedTurn=void 0);return x}return{newState:a}}function A0(a,t,l){var i,c;for(const d of["player","opponent"])for(const f of a[d].lanes)for(const u of f){if(!u.isFaceUp)continue;const p=u.customEffects;if(!p)continue;const m=p.bottomEffects||[];for(const y of m){if(y.trigger!=="when_card_returned"||((i=y.params)==null?void 0:i.action)!=="redirect_return_to_deck")continue;const v=((c=y.params)==null?void 0:c.targetOwner)||"opponent",x=d;if(v==="opponent"&&t!==x||v==="own"&&t===x)return u}}return null}function Id(a,t){const l=we(a,t);if(!l)return{newState:a};const{card:i,owner:c}=l,d=a[c].lanes.findIndex(C=>C.some(R=>R.id===i.id));if(d===-1)return{newState:a};const f=a[c].lanes[d],u=f.length>0&&f[f.length-1].id===t;let p={...a};const m={...p[c]},y=p.actionRequired&&"actor"in p.actionRequired?p.actionRequired.actor:p.turn,v=y==="player"?"Player":"Opponent",x=c==="player"?"Player's":"Opponent's",w=`${i.protocol}-${i.value}`,S=A0(a,c);if(m.lanes=m.lanes.map(C=>C.filter(R=>R.id!==t)),S){const C={...i,isFaceUp:!1,isRevealed:!1};m.deck=[C,...m.deck],p[c]=m;const R=`${S.protocol}-${S.value}`;p=ne(p,y,`${R}: ${x} ${w} is put on top of their deck face-down instead of returning to hand.`)}else m.hand=[...m.hand,{...i,isFaceUp:!0,isRevealed:!1}],p[c]=m,p=ne(p,y,`${v} returns ${x} ${w} to their hand.`);p=Ge(p);const E={...p.stats[y],cardsReturned:p.stats[y].cardsReturned+1},b={...p[y],stats:E};p={...p,[y]:b},p.actionRequired=null;const j=Ce(p);return u&&j[c].lanes[d].length>0?Pn(j,c,d):{newState:j}}function Ro(a,t,l,i,c){const d=we(a,t);if(!d||d.owner!==l)return{newState:a};const{card:f}=d,u=a[l];let p=-1;for(let q=0;q<u.lanes.length;q++)if(u.lanes[q].some(M=>M.id===t)){p=q;break}if(p===-1)return{newState:a};if(p===i)return{newState:a};if(!Xl(a,p,i).allowed)return{newState:a};const y=a[l].lanes[p],v=y.length>0&&y[y.length-1].id===t,x=u.lanes.map((q,M)=>M===p?q.filter(B=>B.id!==t):q),w=x[i].length>0?x[i][x[i].length-1]:null;let S={...a,[l]:{...u,lanes:x}};S._committedCardId=t;const E=x.map((q,M)=>M===i?[...q,f]:q),b={...u,lanes:E};let j={...S,[l]:b};(!a._currentEffectSource||!a._currentPhaseContext)&&(j=Be(j,void 0),j=Ke(j,void 0));const C=c==="player"?"Player":"Opponent",R=l==="player"?"Player's":"Opponent's",F=f.isFaceUp?`${f.protocol}-${f.value}`:"a card",L=j[l].protocols[i];j=ne(j,c,`${C} shifts ${R} ${F} to Protocol ${L}.`);const O={...j.stats[c],cardsShifted:j.stats[c].cardsShifted+1},T={...j[c],stats:O};j={...j,[c]:T,stats:{...j.stats,[c]:O}},j=Ge(j),j.actionRequired=null;let G=Ce(j),V={newState:G};if(w){w.customEffects;const q={cardOwner:l,actor:c,currentTurn:G.turn,opponent:l==="player"?"opponent":"player",triggerType:"cover"};V=Qd(w,i,G,q)}let z=V.newState,U=[...V.animationRequests||[]];if(v){const q=Pn(z,l,p);z=q.newState,q.animationRequests&&U.push(...q.animationRequests)}const k=z[l].lanes[i],A=k.length>0&&k[k.length-1].id===t,I=!v;if(A&&f.isFaceUp&&I){const q=Pn(z,l,i);q.animationRequests&&U.push(...q.animationRequests);let M=q.newState;return!M.actionRequired&&(!M.queuedActions||M.queuedActions.length===0)&&(M._committedCardId=void 0),{newState:M,animationRequests:U.length>0?U:void 0}}let $=z;return!$.actionRequired&&(!$.queuedActions||$.queuedActions.length===0)&&($._committedCardId=void 0),{newState:$,animationRequests:U.length>0?U:void 0}}const D0=(a,t,l)=>{let i=0;for(const c of["player","opponent"])for(let d=0;d<a[c].lanes.length;d++){const f=a[c].lanes[d];if(f.length>0){const u=f[f.length-1];t.includes(u.id)||i++}}return i},Ud=(a,t)=>{var y;const l=we(a,t);if(!l)return{newState:a};const{card:i,owner:c}=l,d=a[c].lanes.findIndex(v=>v.some(x=>x.id===i.id));if(d===-1)return{newState:a};let f=a;const u=a._pendingCustomEffects;u&&((y=u.effects)==null?void 0:y.length)>0&&u.effects.some(x=>x.useCardFromPreviousEffect)&&(f={...a,_pendingCustomEffects:{...u,selectedCardFromPreviousEffect:t}});const p={cardOwner:c,actor:c,currentTurn:f.turn,opponent:c==="player"?"opponent":"player",triggerType:"flip"},m=Kl(i,d,f,p);if(m.newState.actionRequired){m.newState=Ge(m.newState);const v=m.newState.actionRequired.actor;if(a._interruptedTurn&&v===a._interruptedTurn)return m.newState.queuedActions=[...m.newState.queuedActions||[],m.newState.actionRequired],m.newState=Ge(m.newState),m.newState.actionRequired=null,m;v!==a.turn&&(m.newState._interruptedTurn=a.turn,m.newState._interruptedPhase=a.phase,m.newState.turn=v,m.newState.actionRequired.type==="prompt_rearrange_protocols"&&(m.newState.actionRequired={...m.newState.actionRequired,originalAction:{type:"resume_interrupted_turn",interruptedTurn:a.turn,interruptedPhase:a.phase}}))}return m};function F0(a,t){const l=[];if(a[t].lanes.forEach((c,d)=>{if(c.length>0){const f=c[c.length-1],u=pa(f,c);l.push({card:f,laneIndex:d,owner:t,value:u})}}),l.length===0)return[];const i=Math.max(...l.map(c=>c.value));return l.filter(c=>c.value===i)}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Draw Effect Executor
 *
 * Handles all draw-related effects.
 * Extracted 1:1 from effectInterpreter.ts for modularity.
 */function Qh(a,t,l){const i=Math.min(l,a.length),c=a.slice(0,i).map(u=>({...u,id:Ze(),isFaceUp:!0})),d=[...t,...c],f=a.slice(i);return{drawnCards:d,remainingDeck:f,newCards:c}}function q0(a,t,l,i,c){var F,L,O,T,G,V,z,U;const d=c._conditional,{cardOwner:f}=i,p=(c.target||"self")==="opponent"?i.opponent:f,m=Wd(l,p);if(!m.allowed)return{newState:ne(l,f,m.reason||"Cannot draw cards.")};if(c.conditional){let k=0;switch(c.conditional.type){case"non_matching_protocols":{for(let Q=0;Q<3;Q++){const ae=l.player.protocols[Q],Y=l.opponent.protocols[Q],Z=l.player.lanes[Q].filter(X=>X.isFaceUp),ue=l.opponent.lanes[Q].filter(X=>X.isFaceUp);[...Z,...ue].some(X=>X.protocol!==ae&&X.protocol!==Y)&&k++}break}case"count_face_down":{let Q=0;for(const ae of["player","opponent"])for(const Y of l[ae].lanes)Q+=Y.filter(Z=>!Z.isFaceUp).length;k=Q;break}case"is_covering":{k=l[f].lanes[t].length>1?c.count||1:0;break}}let A=k;if(A<=0)return{newState:l};const{drawnCards:I,remainingDeck:$,newCards:q}=Qh(l[p].deck,l[p].hand,A);let M={...l};if(M[p]={...M[p],deck:$,hand:I},M.detailedGameStats&&q.length>0){const Q=p==="player"?"playerFromEffect":"aiFromEffect";M={...M,detailedGameStats:{...M.detailedGameStats,cardsDrawn:{...M.detailedGameStats.cardsDrawn,[Q]:M.detailedGameStats.cardsDrawn[Q]+q.length}}}}const B=p==="player"?"Player":"Opponent";let W="";switch(c.conditional.type){case"non_matching_protocols":W=" from non-matching protocols";break;case"is_covering":W=" (this card is covering another)";break;case"count_face_down":W=" (for face-down cards)";break;default:W=""}const K=q.length>0&&p==="player"?` (${q.map(Q=>`${Q.protocol}-${Q.value}`).join(", ")})`:"";M=ne(M,p,`${B} draws ${A} card${A!==1?"s":""}${W}${K}.`),A>0&&(M=Nt(M,"after_draw",{player:p}).newState,M=Nt(M,"after_opponent_draw",{player:p==="player"?"opponent":"player"}).newState);const D=A>0?[{type:"draw",player:p,count:A}]:void 0;return{newState:M,animationRequests:D}}let y=c.count||1;const v=c.countType||"fixed";switch(v){case"equal_to_card_value":{const k=l.lastCustomEffectTargetCardId;if(k){const A=we(l,k);if(A){const I=A.owner,$=l[I].lanes.find(q=>q.some(M=>M.id===k))||[];y=pa(A.card,$)}else if(l.lastCustomEffectTargetValue!==void 0)y=l.lastCustomEffectTargetValue;else return y=0,{newState:ne(l,f,"Cannot draw cards - referenced card is no longer available.")}}else l.lastCustomEffectTargetValue!==void 0?y=l.lastCustomEffectTargetValue:y=i.referencedCardValue||0;break}case"equal_to_discarded":y=(i.discardedCount||0)+(c.countOffset||0);break;case"hand_size":case"previous_hand_size":y=i.previousHandSize||i.handSize||0;break;case"count_face_down":{let k=0;for(const A of["player","opponent"])for(const I of l[A].lanes)k+=I.filter($=>!$.isFaceUp).length;y=k*(c.count||1);break}case"all_matching":{if(((F=c.valueFilter)==null?void 0:F.equals)!==void 0){const k=c.valueFilter.equals;y=l[p].deck.filter(I=>I.value===k).length}else y=0;break}case"fixed":default:y=c.count||1;break}if(y<=0)return{newState:l};if(((L=c.advancedConditional)==null?void 0:L.type)==="protocol_match"){const k=c.advancedConditional.protocol;if(l[f].protocols[t]!==k)return{newState:l}}if(((O=c.advancedConditional)==null?void 0:O.type)==="empty_hand"&&l[p].hand.length>0)return{newState:l};if(((T=c.advancedConditional)==null?void 0:T.type)==="opponent_higher_value_in_lane"){const k=f==="player"?"opponent":"player",A=na(l,f,t);if(na(l,k,t)<=A)return{newState:l}}let x={...l};if(((G=c.advancedConditional)==null?void 0:G.type)==="compile_block"){const k=c.advancedConditional.turnDuration||1,A=f==="player"?"opponent":"player";x={...x,compileBlockedUntilTurn:(x.turnNumber||0)+k,compileBlockedPlayer:A},x=ne(x,f,`Opponent can't compile for ${k} turn${k!==1?"s":""}.`)}if(c.optional)return x.actionRequired={type:"prompt_optional_draw",sourceCardId:a.id,actor:f,count:y,drawingPlayer:p,followUpEffect:d==null?void 0:d.thenEffect,conditionalType:d==null?void 0:d.type,logSource:l._currentEffectSource,logPhase:l._currentPhaseContext,logIndentLevel:l._logIndentLevel||0},{newState:x};const w=c.source||"own_deck",S=w==="opponent_deck"?i.opponent:p;let E,b,j=[];if(v==="all_matching"&&((V=c.valueFilter)==null?void 0:V.equals)!==void 0){const k=c.valueFilter.equals,A=x[S].deck,I=A.filter(q=>q.value===k),$=A.filter(q=>q.value!==k);j=I.map(q=>({...q,id:Ze(),isFaceUp:!0})),E=[...x[p].hand,...j],b=$}else if(((z=c.valueFilter)==null?void 0:z.equals)!==void 0&&c.fromRevealed){const k=c.valueFilter.equals,A=x[S].deck,I=A.filter($=>$.value===k);if(I.length===0){const $=`${a.protocol}-${a.value}`;x=ne(x,p,`${$}: No cards with value ${k} in deck.`)}else return x.actionRequired={type:"select_card_from_revealed_deck",sourceCardId:a.id,actor:p,count:y,valueFilter:k,revealedCards:A,selectableCardIds:I.map($=>$.id||`deck-${A.indexOf($)}`)},{newState:x}}else if(((U=c.valueFilter)==null?void 0:U.equals)!==void 0){const k=c.valueFilter.equals,A=[...x[S].deck],I=[];for(let M=0;M<A.length&&I.length<y;M++)A[M].value===k&&I.push(M);const $=I.map(M=>A[M]),q=A.filter((M,B)=>!I.includes(B));j=$.map(M=>({...M,id:Ze(),isFaceUp:!0})),E=[...x[p].hand,...j],b=q}else{const k=Qh(x[S].deck,x[p].hand,y);E=k.drawnCards,b=k.remainingDeck,j=k.newCards}if(x[S]={...x[S],deck:b},x[p]={...x[p],hand:E},x.detailedGameStats&&j.length>0){const k=p==="player"?"playerFromEffect":"aiFromEffect";x={...x,detailedGameStats:{...x.detailedGameStats,cardsDrawn:{...x.detailedGameStats.cardsDrawn,[k]:x.detailedGameStats.cardsDrawn[k]+j.length}}}}const C=p==="player"?"Player":"Opponent",R=j.length>0&&p==="player"?` (${j.map(k=>`${k.protocol}-${k.value}`).join(", ")})`:"";if(w==="opponent_deck"){const k=S==="player"?"Player's":"Opponent's";x=ne(x,p,`${C} draws the top ${y===1?"card":`${y} cards`} of ${k} deck${R}.`)}else x=ne(x,p,`${C} draws ${y} card${y!==1?"s":""}${R}.`);if(E.length>0&&(x=Nt(x,"after_draw",{player:p,count:E.length}).newState,x=Nt(x,"after_opponent_draw",{player:p==="player"?"opponent":"player",count:E.length}).newState),c.revealFromDrawn&&j.length>0){const k=c.revealFromDrawn.valueSource||"stated_number",A=c.revealFromDrawn.count||1;let I=j;if(k==="stated_number"){const q=x.lastStatedNumber;q===void 0?x=ne(x,p,"No number was stated. Cannot filter drawn cards."):I=j.filter(M=>M.value===q)}const $=A==="all"?I.length:Math.min(A,I.length);return x.actionRequired={type:"select_from_drawn_to_reveal",actor:p,sourceCardId:a.id,allDrawnCardIds:j.map(q=>q.id),eligibleCardIds:I.map(q=>q.id),revealCount:$,statedNumber:k==="stated_number"?x.lastStatedNumber:void 0,thenAction:c.revealFromDrawn.thenAction},{newState:x}}return{newState:x}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Flip Effect Executor
 *
 * Handles all flip-related effects.
 * Extracted 1:1 from effectInterpreter.ts for modularity.
 */function $0(a,t,l,i,c){var j,C,R,F;const{cardOwner:d}=i,f=c._conditional;if(c.useCardFromPreviousEffect&&l.lastCustomEffectTargetCardId){const L=l.lastCustomEffectTargetCardId,O=we(l,L);if(!O)return{newState:ne(l,d,"Target card from previous effect no longer exists. Flip skipped.")};let T={...l};const G=O.owner,V=T[G].lanes.findIndex(z=>z.some(U=>U.id===L));if(V!==-1){const U=T[G].lanes[V].find(k=>k.id===L);if(U){c.skipMiddleCommand&&!U.isFaceUp&&(T.skipNextMiddleCommand=L),U.isFaceUp=!U.isFaceUp;const k=U.isFaceUp?"face-up":"face-down",A=c.skipMiddleCommand&&U.isFaceUp?", ignoring its middle commands":"";T=ne(T,d,`Flips that card ${k}${A}.`)}}return{newState:T}}if(c.scope==="each_lane"){const L=c.targetFilter||{},O=Sa(l),T=k=>{const A=l.player.lanes[k],I=l.opponent.lanes[k];let $=[];if(L.position==="covered"?$=[...A.filter((M,B)=>B<A.length-1),...I.filter((M,B)=>B<I.length-1)]:$=[...A,...I],L.owner==="own")$=$.filter(M=>A.includes(M)&&d==="player"||I.includes(M)&&d==="opponent");else if(L.owner==="opponent"){const M=d==="player"?"opponent":"player";$=$.filter(B=>A.includes(B)&&M==="player"||I.includes(B)&&M==="opponent")}return L.excludeSelf&&($=$.filter(M=>M.id!==a.id)),(O?$.filter(M=>M.isFaceUp):$).length>0},G=[0,1,2].filter(k=>T(k));if(G.length===0){let k=ne(l,d,O?"No valid face-up targets to flip (Frost-1 is active).":"No valid targets to flip in any lane.");return k._effectSkippedNoTargets=!0,{newState:k}}const V=G[0],z=G.slice(1);let U={...l};return U.actionRequired={type:"select_card_to_flip",sourceCardId:a.id,actor:d,currentLaneIndex:V,remainingLanes:z,targetFilter:c.targetFilter,params:c,followUpEffect:f==null?void 0:f.thenEffect,conditionalType:f==null?void 0:f.type},{newState:U}}if(c.flipSelf){if(((j=c.advancedConditional)==null?void 0:j.type)==="protocol_match"){const G=c.advancedConditional.protocol;if(l[d].protocols[t]!==G)return{newState:l}}if(((C=c.advancedConditional)==null?void 0:C.type)==="opponent_higher_value_in_lane"){const G=d==="player"?"opponent":"player",V=na(l,d,t);if(na(l,G,t)<=V)return{newState:l}}if(((R=c.advancedConditional)==null?void 0:R.type)==="hand_size_greater_than"){const G=c.advancedConditional.threshold??0;if(l[d].hand.length<=G)return{newState:l}}let L={...l};const T=L[d].lanes[t].find(G=>G.id===a.id);if(T){T.isFaceUp=!T.isFaceUp;const G=d==="player"?"Player":"Opponent",V=T.isFaceUp?"face-up":"face-down";L=ne(L,d,`${G} flips this card ${V}.`)}return{newState:L}}const u=c.count||1,p=((F=c.scope)==null?void 0:F.type)||c.scope||"anywhere",m=u==="all"||typeof u!="number",y=p==="this_lane"&&m,v=p==="anywhere"&&m;if(y||v){let L={...l};const O=d==="player"?"opponent":"player",T=c.targetFilter||{},G=Sa(l),V=new Set,z=v?[0,1,2]:[t];for(const U of z){const k=L[d].lanes[U];for(const I of k){if(T.excludeSelf&&I.id===a.id||T.faceState==="face_up"&&!I.isFaceUp||T.faceState==="face_down"&&I.isFaceUp||T.owner==="opponent")continue;const $=k.indexOf(I)===k.length-1;T.position==="uncovered"&&!$||T.position==="covered"&&$||v&&!T.position&&!$||G&&!I.isFaceUp||V.add(I.id)}const A=L[O].lanes[U];for(const I of A){if(T.faceState==="face_up"&&!I.isFaceUp||T.faceState==="face_down"&&I.isFaceUp||T.owner==="own")continue;const $=A.indexOf(I)===A.length-1;T.position==="uncovered"&&!$||T.position==="covered"&&$||v&&!T.position&&!$||G&&!I.isFaceUp||V.add(I.id)}}if(V.size>0){const U=v?"":" in this lane";L=ne(L,d,`Flipping ${V.size} card(s)${U}.`);for(const k of V)for(const A of["player","opponent"])for(const I of L[A].lanes){const $=I.find(q=>q.id===k);$&&($.isFaceUp=!$.isFaceUp)}return{newState:L}}else return L=ne(L,d,`No cards to flip${v?"":" in this lane"}.`),{newState:L}}const x=c.targetFilter||{},w=x.position||"uncovered",S=Sa(l),E=[];for(const L of["player","opponent"])for(let O=0;O<l[L].lanes.length;O++){const T=l[L].lanes[O];if(!(c.scope==="this_lane"&&O!==t)&&!(c.sameLaneAsFirst&&l.lastFlipLaneIndex!==void 0&&O!==l.lastFlipLaneIndex))for(let G=0;G<T.length;G++){const V=T[G];if(Do(l,V.id))continue;const z=Fo(l,T,G);if(!(x.excludeSelf&&V.id===a.id||x.owner==="own"&&L!==d||x.owner==="opponent"&&L===d||w==="uncovered"&&!z||w==="covered"&&z||x.faceState==="face_up"&&!V.isFaceUp||x.faceState==="face_down"&&V.isFaceUp||S&&!V.isFaceUp||!Gl(l,V.id).allowed)){if(x.valueMinGreaterThanHandSize){const k=l[d].hand.length;if(V.value<=k)continue}E.push(V.id)}}}if(E.length===0){let L=l;if(x.valueMinGreaterThanHandSize){const O=l[d].hand.length,T=O+1;L=ne(L,d,`Hand size: ${O} cards. No cards with value ${T} or higher available. Effect skipped.`)}else L=ne(L,d,"No valid cards to flip. Effect skipped.");return L._effectSkippedNoTargets=!0,{newState:L}}let b={...l};if(x.valueMinGreaterThanHandSize){const L=l[d].hand.length,O=L+1,T=u==="all"?"all cards":u===1?"1 card":`${u} cards`;b=ne(b,d,`Hand size: ${L} cards. Flip ${T} with value ${O} or higher.`)}return b.actionRequired={type:"select_card_to_flip",count:u,sourceCardId:a.id,actor:d,targetFilter:c.targetFilter,optional:c.optional||!1,scope:c.scope,laneIndex:c.scope==="this_lane"?t:void 0,sameLaneAsFirst:c.sameLaneAsFirst||!1,restrictedLaneIndex:c.sameLaneAsFirst?l.lastFlipLaneIndex:void 0,followUpEffect:f==null?void 0:f.thenEffect,conditionalType:f==null?void 0:f.type},{newState:b}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Delete Effect Executor
 *
 * Handles all delete-related effects.
 * Extracted 1:1 from effectInterpreter.ts for modularity.
 */function L0(a,t,l,i,c){var R,F,L,O,T,G,V,z,U,k;const{cardOwner:d}=i,f=c._conditional;let u=c.count||1;if(((R=c.advancedConditional)==null?void 0:R.type)==="empty_hand"&&l[d].hand.length>0)return{newState:l};if(((F=c.advancedConditional)==null?void 0:F.type)==="opponent_higher_value_in_lane"){const A=d==="player"?"opponent":"player",I=na(l,d,t);if(na(l,A,t)<=I)return{newState:l}}if(c.useCardFromPreviousEffect&&l.lastCustomEffectTargetCardId){const A=l.lastCustomEffectTargetCardId,I=we(l,A);if(!I)return{newState:ne(l,d,"Target card from previous effect no longer exists. Delete skipped.")};let $={...l};const q=I.owner,M=$[q].lanes.findIndex(B=>B.some(W=>W.id===A));if(M!==-1){const B=[...$[q].lanes[M]],W=B.findIndex(K=>K.id===A);if(W!==-1){const K=W===B.length-1;B.splice(W,1);const D=[...$[q].lanes];D[M]=B,$={...$,[q]:{...$[q],lanes:D}};const Q=I.card.isFaceUp?`${I.card.protocol}-${I.card.value}`:"that card";$=ne($,d,`Deletes ${Q}.`);const ae={...$.stats[d],cardsDeleted:$.stats[d].cardsDeleted+1};$={...$,stats:{...$.stats,[d]:ae}};const Y=i.triggerType==="cover"||i.triggerType==="on_cover";return K&&B.length>0&&!Y&&($=Pn($,q,M).newState),{newState:$,animationRequests:[{type:"delete",cardId:A,owner:q}]}}}return{newState:$}}if((L=c.scope)!=null&&L.minCardsInLane){const A=c.scope.minCardsInLane,I=((O=l.player.lanes[t])==null?void 0:O.length)||0,$=((T=l.opponent.lanes[t])==null?void 0:T.length)||0;if(I+$<A)return{newState:l}}let p=[0,1,2];if(((G=c.laneCondition)==null?void 0:G.type)==="opponent_higher_value"&&(p=cx(l,d),p.length===0)){let A=ne(l,d,"No lanes where opponent has higher value. Delete effect skipped.");return A._effectSkippedNoTargets=!0,{newState:A}}const m=c.actorChooses||"effect_owner",y=((V=c.targetFilter)==null?void 0:V.owner)||"any";let v=d;m==="card_owner"&&y==="opponent"&&(v=i.opponent);const x=c.targetFilter||{},w=x.position||"uncovered",S=[];for(const A of["player","opponent"])for(let I=0;I<l[A].lanes.length;I++){if(((z=c.scope)==null?void 0:z.type)==="this_line"&&I!==t)continue;const $=l[A].lanes[I];for(let q=0;q<$.length;q++){const M=$[q];if(Do(l,M.id))continue;const B=Fo(l,$,q);if(!(c.excludeSelf&&M.id===a.id)&&!(x.owner==="own"&&A!==d)&&!(x.owner==="opponent"&&A===d)&&!(w==="uncovered"&&!B)&&!(w==="covered"&&B)){if(w==="covered_by_context"&&i.triggerType==="cover"){if(A!==i.cardOwner&&B)continue}else if(w==="covered_by_context"&&B)continue;if(!(x.faceState==="face_up"&&!M.isFaceUp)&&!(x.faceState==="face_down"&&M.isFaceUp)){if(x.valueRange){const{min:W,max:K}=x.valueRange;if(M.value<W||M.value>K)continue}if(x.valueSource==="previous_effect_card"){const W=l.lastCustomEffectTargetValue;if(W===void 0||M.value!==W)continue}if(c.protocolMatching){const W=l.player.protocols[I],K=l.opponent.protocols[I],D=M.protocol,Q=D===W||D===K;if(c.protocolMatching==="must_match"&&!Q||c.protocolMatching==="must_not_match"&&Q)continue}S.push(M.id)}}}}if(S.length===0){let A=ne(l,d,"No valid cards to delete. Effect skipped.");return A._effectSkippedNoTargets=!0,{newState:A}}if(c.upTo&&(u=Math.min(u,S.length),u===0))return{newState:ne(l,d,"No valid targets available. Delete effect skipped.")};let E=S;if(x.calculation==="highest_value"||x.calculation==="lowest_value"){const A=new Map;for(const q of S){const M=we(l,q);if(!M)continue;let B=-1;for(let K=0;K<l[M.owner].lanes.length;K++)if(l[M.owner].lanes[K].some(D=>D.id===q)){B=K;break}let W=M.card.value;!M.card.isFaceUp&&B!==-1&&(W=l[M.owner].lanes[B].some(D=>D.isFaceUp&&D.protocol==="Darkness"&&D.value===2)?4:2),A.set(q,W)}const I=Array.from(A.values()),$=x.calculation==="highest_value"?Math.max(...I):Math.min(...I);E=S.filter(q=>A.get(q)===$)}if(c.autoExecute){const A=E.slice(0,u);let I=l;const $=[];for(const q of A){const M=we(I,q);if(!M)continue;const{card:B,owner:W}=M;let K=-1;for(let le=0;le<I[W].lanes.length;le++)if(I[W].lanes[le].some(J=>J.id===q)){K=le;break}if(K===-1)continue;const D=I[W].lanes[K],Q=D[D.length-1].id===q,ae=B.isFaceUp?`${B.protocol}-${B.value}`:"a face-down card";I=ne(I,d,`Effect triggers, deleting the lowest value covered card (${W==="player"?"Player's":"Opponent's"} ${ae}).`);const Z=[...D],ue=Z.findIndex(le=>le.id===q);Z.splice(ue,1);const re=[...I[W].lanes];re[K]=Z,I={...I,[W]:{...I[W],lanes:re}};const ee={...I.stats[d],cardsDeleted:I.stats[d].cardsDeleted+1};I={...I,stats:{...I.stats,[d]:ee}},$.push({type:"delete",cardId:q,owner:W});const X=i.triggerType==="cover"||i.triggerType==="on_cover";Q&&Z.length>0&&!X&&(I=Pn(I,W,K).newState)}return{newState:I,animationRequests:$}}let b={...l};if(c.deleteSelf){const A=d,I=l[A].lanes[t];if(!I||I.length===0)return b=ne(b,d,"Card already deleted. Delete effect skipped."),{newState:b};if(I.findIndex(Y=>Y.id===a.id)===-1)return b=ne(b,d,"Card already deleted. Delete effect skipped."),{newState:b};const q=l[A].lanes[t],M=q.length>0&&q[q.length-1].id===a.id;b=ne(b,d,`Deleting ${a.protocol}-${a.value}.`);const B=[...q],W=B.findIndex(Y=>Y.id===a.id);if(W===-1)return{newState:b};B.splice(W,1);const K=[...b[A].lanes];K[t]=B,b={...b,[A]:{...b[A],lanes:K}};const D={...b.stats[d],cardsDeleted:b.stats[d].cardsDeleted+1};b={...b,stats:{...b.stats,[d]:D}};const Q=[{type:"delete",cardId:a.id,owner:A}],ae=i.triggerType==="cover"||i.triggerType==="on_cover";if(M&&B.length>0&&!ae){const Y=Pn(b,A,t);b=Y.newState,Y.animationRequests&&Q.push(...Y.animationRequests)}return{newState:b,animationRequests:Q}}if(c.selectLane)return b.actionRequired={type:"select_lane_for_delete",sourceCardId:a.id,actor:v,count:c.count,targetFilter:c.targetFilter,deleteAll:c.count==="all_in_lane"||c.count==="all",validLanes:p.length<3?p:void 0,laneCondition:c.laneCondition,followUpEffect:f==null?void 0:f.thenEffect,conditionalType:f==null?void 0:f.type},{newState:b};if(((U=c.scope)==null?void 0:U.type)==="each_lane"){const A=M=>{for(const B of["player","opponent"]){const W=l[B].lanes[M];for(let K=0;K<W.length;K++){const D=W[K];if(Do(l,D.id))continue;const Q=Fo(l,W,K);if(!(c.excludeSelf&&D.id===a.id)&&!(x.owner==="own"&&B!==v)&&!(x.owner==="opponent"&&B===v)&&!(w==="uncovered"&&!Q)&&!(w==="covered"&&Q)&&!(x.faceState==="face_up"&&!D.isFaceUp)&&!(x.faceState==="face_down"&&D.isFaceUp))return!0}}return!1},I=[0,1,2].filter(M=>A(M));if(I.length===0)return b=ne(b,d,"No valid targets to delete in any lane."),b._effectSkippedNoTargets=!0,{newState:b};const $=I[0],q=I.slice(1);return b.actionRequired={type:"select_cards_to_delete",count:u,sourceCardId:a.id,actor:v,currentLaneIndex:$,remainingLanes:q,disallowedIds:c.excludeSelf?[a.id]:[],targetFilter:c.targetFilter,scope:c.scope,protocolMatching:c.protocolMatching,params:c,followUpEffect:f==null?void 0:f.thenEffect,conditionalType:f==null?void 0:f.type},{newState:b}}if(((k=c.scope)==null?void 0:k.type)==="each_other_line"){const $=[0,1,2].filter(q=>q!==t).filter(q=>l.player.lanes[q].length>0||l.opponent.lanes[q].length>0).length;return $===0?(b=ne(b,d,"No other lanes have cards. Effect skipped."),{newState:b}):(b.actionRequired={type:"select_card_from_other_lanes_to_delete",sourceCardId:a.id,disallowedLaneIndex:t,lanesSelected:[],count:$,actor:v,targetFilter:c.targetFilter,followUpEffect:f==null?void 0:f.thenEffect,conditionalType:f==null?void 0:f.type},{newState:b})}const j=x.valueSource==="previous_effect_card",C=E.length<S.length||j?E:void 0;return b.actionRequired={type:"select_cards_to_delete",count:u,sourceCardId:a.id,actor:v,actorChooses:m,disallowedIds:c.excludeSelf?[a.id]:[],followUpEffect:f==null?void 0:f.thenEffect,conditionalType:f==null?void 0:f.type,allowedIds:C,targetFilter:c.targetFilter,scope:c.scope,protocolMatching:c.protocolMatching},{newState:b}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Discard Effect Executor
 *
 * Handles all discard-related effects.
 * Extracted 1:1 from effectInterpreter.ts for modularity.
 */function I0(a,t,l,i,c){const{cardOwner:d}=i,f=c._conditional;if(c.actor==="both"){let S={...l};const E=F=>{const L=S[F].hand;if(L.length===0)return{discardedCount:0,discardedCards:[]};const O=L.map(({id:T,isFaceUp:G,...V})=>V);return S[F]={...S[F],hand:[],discard:[...S[F].discard,...O],stats:{...S[F].stats,cardsDiscarded:S[F].stats.cardsDiscarded+O.length}},{discardedCount:O.length,discardedCards:O}},b=E(d),j=d==="player"?"Player":"Opponent";if(b.discardedCount>0){const F=b.discardedCards.map(L=>`${L.protocol}-${L.value}`).join(", ");S=ne(S,d,`${j} discards their hand (${b.discardedCount} cards: ${F}).`)}else S=ne(S,d,`${j} has no cards to discard.`);const C=E(i.opponent),R=i.opponent==="player"?"Player":"Opponent";if(C.discardedCount>0){const F=C.discardedCards.map(L=>`${L.protocol}-${L.value}`).join(", ");S=ne(S,i.opponent,`${R} discards their hand (${C.discardedCount} cards: ${F}).`)}else S=ne(S,i.opponent,`${R} has no cards to discard.`);return S._discardContext={actor:"both",discardedCount:b.discardedCount+C.discardedCount,sourceCardId:a.id},{newState:S}}const u=c.actor==="opponent"?i.opponent:d;if(c.useCardFromPreviousEffect&&l.lastCustomEffectTargetCardId){const S=l.lastCustomEffectTargetCardId;let E={...l};const b={...E[u]},j=`${a.protocol}-${a.value}`,C=u==="player"?"Player":"Opponent",R=b.deck.findIndex(L=>L.id===S);if(R!==-1){const L=[...b.deck],O=L.splice(R,1)[0];return b.deck=L,b.discard=[...b.discard,O],E[u]=b,E=ne(E,u,`${C} discards ${O.protocol}-${O.value} from their deck.`),E._discardContext={actor:u,discardedCount:1,sourceCardId:a.id},{newState:E}}const F=b.hand.findIndex(L=>L.id===S);if(F!==-1){const L=[...b.hand],O=L.splice(F,1)[0],{id:T,isFaceUp:G,...V}=O;return b.hand=L,b.discard=[...b.discard,V],E[u]=b,E=ne(E,u,`${C} discards ${O.protocol}-${O.value}.`),E._discardContext={actor:u,discardedCount:1,sourceCardId:a.id},{newState:E}}return console.warn(`[Discard Effect] useCardFromPreviousEffect: Card ${S} not found`),E=ne(E,u,`${j}: Card to discard not found - effect skipped.`),E._discardContext={discardedCount:0},{newState:E}}const p=c.source||"hand";if(p==="top_deck_own"||p==="top_deck_opponent"){const S=p==="top_deck_own"?d:i.opponent;let E={...l};const b={...E[S]},j=S===d?"your":"opponent's";if(b.deck.length===0)return E=ne(E,d,`No cards in ${j} deck - effect skipped.`),E._effectSkippedNoTargets=!0,E._discardContext={discardedCount:0},{newState:E};const C=[...b.deck],R=C.shift();return b.deck=C,b.discard=[...b.discard,R],E[S]=b,E=ne(E,d,`Discard the top card of ${j} deck: ${R.protocol}-${R.value}.`),E.lastCustomEffectTargetCardId=R.id,E.lastCustomEffectTargetValue=R.value,E._discardContext={actor:S,discardedCount:1,sourceCardId:a.id,discardedCardValue:R.value,discardedCardProtocol:R.protocol},E.actionRequired={type:"confirm_deck_discard",actor:d,sourceCardId:a.id,discardedCard:R,deckOwner:p==="top_deck_own"?"own":"opponent",followUpEffect:f==null?void 0:f.thenEffect,conditionalType:f==null?void 0:f.type,laneIndex:t},{newState:E}}let m=c.count||1;if((c.countType||"fixed")==="equal_to_discarded"){const S=(i.discardedCount||0)+(c.countOffset||0);if(m=Math.min(S,l[u].hand.length),m<=0)return{newState:l}}if(l[u].hand.length===0){let E=ne(l,u,`${u==="player"?"Player":"Opponent"} has no cards to discard - effect skipped.`);return E._effectSkippedNoTargets=!0,E._discardContext={discardedCount:0},{newState:E}}c.upTo&&(m=Math.min(m,l[u].hand.length));const v=m;typeof m=="number"&&m>l[u].hand.length&&(m=l[u].hand.length);const x=!c.upTo&&typeof v=="number"&&v>m;if(c.random&&u!==d){const S=[...l[u].hand],E=Math.min(m,S.length),b=[],j=S.map((z,U)=>U);for(let z=0;z<E&&j.length>0;z++){const U=Math.floor(Math.random()*j.length);b.push(j[U]),j.splice(U,1)}b.sort((z,U)=>U-z);const C=[],R=[...S];for(const z of b){const{id:U,isFaceUp:k,...A}=R.splice(z,1)[0];C.push(A)}const F=[...l[u].discard,...C],L={...l[u].stats,cardsDiscarded:l[u].stats.cardsDiscarded+C.length},O={...l[u],hand:R,discard:F,stats:L};let T={...l,[u]:O,stats:{...l.stats,[u]:L}};const G=u==="player"?"Player":"Opponent",V=C.length===1?"card":"cards";if(u==="player"||C.every(z=>z.isRevealed)){const z=C.map(U=>`${U.protocol}-${U.value}`).join(", ");T=ne(T,u,`${G} randomly discards ${C.length} ${V}: ${z}.`)}else T=ne(T,u,`${G} randomly discards ${C.length} ${V}.`);return T._discardContext={actor:u,discardedCount:C.length,sourceCardId:a.id},{newState:T}}if(m==="all"){const S=l[u].hand,E=S.map(({id:O,isFaceUp:T,...G})=>G),b=[],j=[...l[u].discard,...E],C={...l[u].stats,cardsDiscarded:l[u].stats.cardsDiscarded+E.length},R={...l[u],hand:b,discard:j,stats:C};let F={...l,[u]:R,stats:{...l.stats,[u]:C}};const L=u==="player"?"Player":"Opponent";if(u==="player"||E.every(O=>O.isRevealed)){const O=E.map(T=>`${T.protocol}-${T.value}`).join(", ");F=ne(F,u,`${L} discards entire hand (${E.length} cards: ${O}).`)}else F=ne(F,u,`${L} discards entire hand (${E.length} cards).`);return F._discardContext={actor:u,discardedCount:E.length,previousHandSize:S.length,sourceCardId:a.id},{newState:F}}let w={...l};return x&&(w=ne(w,u,`${u==="player"?"Player":"Opponent"} only has ${m} card${m!==1?"s":""} (${v} required) - discarding all.`)),w.actionRequired={type:"discard",actor:u,count:m,sourceCardId:a.id,variableCount:c.variableCount||!1,previousHandSize:l[u].hand.length,followUpEffect:f==null?void 0:f.thenEffect,conditionalType:f==null?void 0:f.type},{newState:w}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Shift Effect Executor
 *
 * Handles all shift-related effects.
 * Extracted 1:1 from effectInterpreter.ts for modularity.
 */function U0(a,t,l,i,c){var T,G,V,z;const{cardOwner:d}=i,f=c._conditional;let u={...l};if(((T=c.advancedConditional)==null?void 0:T.type)==="empty_hand"&&l[d].hand.length>0)return{newState:l};if(((G=c.advancedConditional)==null?void 0:G.type)==="opponent_higher_value_in_lane"){const U=d==="player"?"opponent":"player",k=na(l,d,t);if(na(l,U,t)<=k)return{newState:l}}if(((V=c.advancedConditional)==null?void 0:V.type)==="this_card_is_covered"){const U=l[d].lanes;let k=!1;for(let A=0;A<U.length;A++){const I=U[A],$=I.findIndex(q=>q.id===a.id);if($!==-1){k=$<I.length-1;break}}if(!k)return{newState:l}}if(c.useCardFromPreviousEffect&&l.lastCustomEffectTargetCardId){const U=l.lastCustomEffectTargetCardId,k=we(l,U);if(!k)return{newState:ne(l,d,"Target card from previous effect no longer exists. Shift skipped.")};const A=c.destinationRestriction;if((A==null?void 0:A.type)==="to_this_lane"){const $=A.laneIndex==="current"?t:A.laneIndex;if($===void 0||$<0||$>2)return console.error(`[Shift Effect] Invalid target lane index: ${$}`),{newState:l};const q=Ro(l,U,k.owner,$,d);return{newState:q.newState,animationRequests:q.animationRequests}}let I=-1;for(let $=0;$<l[k.owner].lanes.length;$++)if(l[k.owner].lanes[$].some(q=>q.id===U)){I=$;break}return I===-1?{newState:l}:(u.actionRequired={type:"select_lane_for_shift",cardToShiftId:U,cardOwner:k.owner,originalLaneIndex:I,sourceCardId:a.id,actor:d,destinationRestriction:A,followUpEffect:f==null?void 0:f.thenEffect,conditionalType:f==null?void 0:f.type},{newState:u})}const p=l._selectedCardFromPreviousEffect;if(u._selectedCardFromPreviousEffect&&delete u._selectedCardFromPreviousEffect,p&&c.useCardFromPreviousEffect){const U=c.destinationRestriction;if((U==null?void 0:U.type)==="to_this_lane"){const k=U.laneIndex==="current"?t:U.laneIndex;if(k===void 0||k<0||k>2)return console.error(`[Shift Effect] Invalid target lane index: ${k}`),{newState:u};const A=we(u,p);if(!A)return console.error(`[Shift Effect] Selected card not found: ${p}`),{newState:u};const I=Ro(u,p,A.owner,k,d);return{newState:I.newState,animationRequests:I.animationRequests}}return u.actionRequired={type:"shift_flipped_card_optional",cardId:p,sourceCardId:a.id,optional:c.optional||!1,actor:d,followUpEffect:f==null?void 0:f.thenEffect,conditionalType:f==null?void 0:f.type},{newState:u}}if(c.shiftSelf){if(((z=c.destinationRestriction)==null?void 0:z.type)==="opponent_highest_value_lane"){const U=Em(u,d);if(U.includes(t))return u=ne(u,d,"Card is already in opponent's highest value lane. Shift skipped."),{newState:u};const k=U.filter(A=>A!==t);if(k.length===0)return u=ne(u,d,"No valid destination lane. Shift skipped."),{newState:u};if(k.length===1){if(c.optional)return u.actionRequired={type:"select_lane_for_shift",cardToShiftId:a.id,cardOwner:d,originalLaneIndex:t,sourceCardId:a.id,actor:d,validLanes:k,destinationRestriction:c.destinationRestriction,optional:!0,followUpEffect:f==null?void 0:f.thenEffect,conditionalType:f==null?void 0:f.type},{newState:u};const A=k[0],I=Ro(u,a.id,d,A,d);return{newState:I.newState,animationRequests:I.animationRequests}}return u.actionRequired={type:"select_lane_for_shift",cardToShiftId:a.id,cardOwner:d,originalLaneIndex:t,sourceCardId:a.id,actor:d,validLanes:k,destinationRestriction:c.destinationRestriction,optional:c.optional||!1,followUpEffect:f==null?void 0:f.thenEffect,conditionalType:f==null?void 0:f.type},{newState:u}}return u.actionRequired={type:"shift_flipped_card_optional",cardId:a.id,sourceCardId:a.id,optional:c.optional||!1,actor:d,allowCovered:c.allowCoveredSelf||!1,followUpEffect:f==null?void 0:f.thenEffect,conditionalType:f==null?void 0:f.type},{newState:u}}const m=c.targetFilter||{},y=m.position||"uncovered",v=m.faceState||"any",x=m.owner||"any",w=m.excludeSelf||!1,S=c.count||1;if(y==="any"&&x==="own"&&!w&&S===1)return u.actionRequired={type:"shift_flipped_card_optional",cardId:a.id,sourceCardId:a.id,optional:c.optional||!1,actor:d,followUpEffect:f==null?void 0:f.thenEffect,conditionalType:f==null?void 0:f.type},{newState:u};const b=[];for(const U of["player","opponent"])if(!(x==="own"&&U!==d)&&!(x==="opponent"&&U===d))for(let k=0;k<u[U].lanes.length;k++){if(c.scope==="this_lane"&&k!==t)continue;const A=u[U].lanes[k];for(let I=0;I<A.length;I++){const $=A[I];if(Do(u,$.id)||w&&$.id===a.id)continue;const q=Fo(u,A,I);y==="uncovered"&&!q||y==="covered"&&q||v==="face_up"&&!$.isFaceUp||v==="face_down"&&$.isFaceUp||b.push({card:$,currentLane:k,owner:U})}}if(b.length===0)return u=ne(u,d,"No valid cards to shift."),u._effectSkippedNoTargets=!0,{newState:u};if((S==="all"||typeof S!="number"&&S!==1)&&b.length>0){const U=[],k=c.destinationRestriction;for(let A=0;A<3;A++){if((k==null?void 0:k.type)==="to_another_line"){if(A===t)continue}else if((k==null?void 0:k.type)==="to_this_lane"){const I=k.laneIndex==="current"?t:k.laneIndex;if(A!==I)continue}else if(!k&&A===t)continue;U.push(A)}return U.length===0?(u=ne(u,d,"No valid destination lanes for shifting all cards."),{newState:u}):(u=ne(u,d,`Shifting ${b.length} card(s) from this lane.`),u.actionRequired={type:"select_lane_for_shift_all",sourceCardId:a.id,actor:d,cardsToShift:b.map(A=>({cardId:A.card.id,owner:A.owner})),validDestinationLanes:U,sourceLaneIndex:t,followUpEffect:f==null?void 0:f.thenEffect,conditionalType:f==null?void 0:f.type},{newState:u})}const C=c.destinationRestriction;let R=!1;const F=(C==null?void 0:C.laneIndex)==="current"?t:C==null?void 0:C.laneIndex;for(const{card:U,currentLane:k,owner:A}of b){if((C==null?void 0:C.type)==="non_matching_protocol"&&!U.isFaceUp)continue;const I=U.protocol;for(let $=0;$<3;$++){if(C){if(C.type==="non_matching_protocol"){if($===k)continue;const M=u.player.protocols[$],B=u.opponent.protocols[$];if(I===M||I===B)continue}else if(C.type==="specific_lane"){if($!==k)continue}else if(C.type==="to_this_lane"){if($!==F||k===F)continue}else if(C.type==="to_another_line"){if($===k)continue}else if(C.type==="to_or_from_this_lane"&&(!(k===F)&&!($===F)||$===k))continue}else if($===k)continue;if(Xl(u,k,$).allowed){R=!0;break}}if(R)break}if(!R)return u=ne(u,d,"No valid shift destinations available."),{newState:u};const L=C&&F!==void 0?{...C,laneIndex:F}:C,O=(C==null?void 0:C.type)==="to_this_lane"&&F!==void 0?F:void 0;return u.actionRequired={type:"select_card_to_shift",sourceCardId:a.id,actor:d,targetFilter:c.targetFilter,destinationRestriction:L,sourceLaneIndex:t,targetLaneIndex:O,scope:c.scope,followUpEffect:f==null?void 0:f.thenEffect,conditionalType:f==null?void 0:f.type},{newState:u}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Return Effect Executor
 *
 * Handles all return-related effects.
 * Extracted 1:1 from effectInterpreter.ts for modularity.
 */function P0(a,t,l,i,c){var w,S,E,b;const{cardOwner:d,opponent:f}=i,u=c._conditional;c.count==="all"||c.count;const p=((w=c.targetFilter)==null?void 0:w.owner)||"any",m=((S=c.targetFilter)==null?void 0:S.position)||"uncovered";if(((E=c.advancedConditional)==null?void 0:E.type)==="empty_hand"&&l[d].hand.length>0)return{newState:l};if(((b=c.advancedConditional)==null?void 0:b.type)==="opponent_higher_value_in_lane"){const j=d==="player"?"opponent":"player",C=na(l,d,t);if(na(l,j,t)<=C)return{newState:l}}if(c.selectLane){let j={...l};return j.actionRequired={type:"select_lane_for_return",sourceCardId:a.id,actor:d,count:c.count,targetFilter:c.targetFilter,followUpEffect:u==null?void 0:u.thenEffect,conditionalType:u==null?void 0:u.type},{newState:j}}let y=[];const v=j=>{for(const C of l[j].lanes)for(let R=0;R<C.length;R++){const F=C[R];if(Do(l,F.id))continue;const L=Fo(l,C,R);m==="uncovered"&&!L||m==="covered"&&L||y.push({card:F,isUncovered:L})}};if(p==="own"?v(d):p==="opponent"?v(f):(v("player"),v("opponent")),y.length===0)return{newState:ne(l,d,"No cards on board to return. Effect skipped.")};let x={...l};return x.actionRequired={type:"select_card_to_return",sourceCardId:a.id,actor:d,targetOwner:p,targetFilter:c.targetFilter,followUpEffect:u==null?void 0:u.thenEffect,conditionalType:u==null?void 0:u.type},{newState:x}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Play Effect Executor
 *
 * Handles all play-related effects (play cards from hand/deck to board).
 * Extracted 1:1 from effectInterpreter.ts for modularity.
 */function O0(a,t,l,i,c){var E,b,j,C,R,F,L,O,T,G,V;const{cardOwner:d,opponent:f}=i,u=c._conditional,p=c.count||1,m=c.source||"hand",y=c.faceDown,v=c.actor==="opponent"?f:d;if(((E=c.advancedConditional)==null?void 0:E.type)==="empty_hand"&&l[d].hand.length>0)return{newState:l};if(((b=c.advancedConditional)==null?void 0:b.type)==="opponent_higher_value_in_lane"){const z=d==="player"?"opponent":"player",U=na(l,d,t);if(na(l,z,t)<=U)return{newState:l}}if(m==="deck"&&((j=c.destinationRule)==null?void 0:j.type)==="each_other_line"){const z=[0,1,2].filter(D=>D!==t);if(z.length===0)return{newState:l};const U=l[v];if(U.deck.length===0&&U.discard.length===0)return{newState:ne(l,d,`${v==="player"?"Player":"Opponent"} has no cards in deck/discard - effect skipped.`)};const{drawnCards:k,remainingDeck:A,newDiscard:I}=Un(U.deck,U.discard,z.length);if(k.length===0)return{newState:l};const $=k.map(D=>({...D,id:Ze(),isFaceUp:!1})),q=[...U.lanes];for(let D=0;D<$.length;D++){const Q=z[D];q[Q]=[...q[Q],$[D]]}const M={...U,lanes:q,deck:A,discard:I};let B={...l,[v]:M};if(B.detailedGameStats&&k.length>0){const D=v==="player"?"playerFromEffect":"aiFromEffect",Q=v==="player"?"playerFaceDown":"aiFaceDown";B={...B,detailedGameStats:{...B.detailedGameStats,cardsPlayed:{...B.detailedGameStats.cardsPlayed,[D]:B.detailedGameStats.cardsPlayed[D]+k.length,[Q]:B.detailedGameStats.cardsPlayed[Q]+k.length}}}}const W=we(l,a.id),K=W?`${W.card.protocol}-${W.card.value}`:"a card effect";return B=ne(B,d,`${K}: Plays ${k.length} card(s) face-down in other lines.`),{newState:B}}if(m==="deck"&&((C=c.destinationRule)==null?void 0:C.type)==="each_line_with_card"){const z=c.destinationRule.ownerFilter||"any",U=c.destinationRule.cardFilter,k=z==="own"?v:z==="opponent"?v==="player"?"opponent":"player":null,A=le=>{const J=me=>me.length===0?!1:U?me.some(ve=>U.faceState==="face_down"?!ve.isFaceUp:U.faceState==="face_up"?ve.isFaceUp:!0):!0;return k?J(l[k].lanes[le]):J(l.player.lanes[le])||J(l.opponent.lanes[le])},I=[];for(let le=0;le<3;le++)A(le)&&I.push(le);if(I.length===0)return{newState:l};const $=l[v];if($.deck.length===0&&$.discard.length===0)return{newState:ne(l,d,`${v==="player"?"Player":"Opponent"} has no cards in deck/discard - effect skipped.`)};const{drawnCards:q,remainingDeck:M,newDiscard:B}=Un($.deck,$.discard,I.length);if(q.length===0)return{newState:l};const W=q.map(le=>({...le,id:Ze(),isFaceUp:!y}));let K=l;const D=[];for(let le=0;le<I.length;le++){const J=I[le],me=K[v].lanes[J];if(me.length>0){const ve=me[me.length-1],Se={...i,triggerType:"cover"},Le=Qd(ve,J,K,Se);if(K=Le.newState,Le.animationRequests&&D.push(...Le.animationRequests),K.actionRequired)break}}const Q=[...K[v].lanes],ae=[];for(let le=0;le<W.length;le++){const J=I[le];Q[J]=[...Q[J],W[le]],ae.push({type:"play",cardId:W[le].id,owner:v})}const Y={...K[v],lanes:Q,deck:M,discard:B};let Z={...K,[v]:Y};if(Z.detailedGameStats&&q.length>0){const le=v==="player"?"playerFromEffect":"aiFromEffect",J=v==="player"?"playerFaceDown":"aiFaceDown";Z={...Z,detailedGameStats:{...Z.detailedGameStats,cardsPlayed:{...Z.detailedGameStats.cardsPlayed,[le]:Z.detailedGameStats.cardsPlayed[le]+q.length,[J]:Z.detailedGameStats.cardsPlayed[J]+q.length}}}}const ue=we(l,a.id),re=ue?`${ue.card.protocol}-${ue.card.value}`:"a card effect";let ee="";(U==null?void 0:U.faceState)==="face_down"?ee="with a face-down card":(U==null?void 0:U.faceState)==="face_up"?ee="with a face-up card":z==="own"?ee="where you have a card":z==="opponent"?ee="where opponent has a card":ee="with a card",Z=ne(Z,d,`${re}: Plays ${q.length} card(s) face-down in each line ${ee}.`);const X=[...D,...ae];return{newState:Z,animationRequests:X.length>0?X:void 0}}if(m==="deck"&&((R=c.destinationRule)==null?void 0:R.type)==="another_line"){if([0,1,2].filter(M=>M!==t).length===0)return{newState:l};const U=l[v];if(U.deck.length===0&&U.discard.length===0)return{newState:ne(l,d,`${v==="player"?"Player":"Opponent"} has no cards in deck/discard - effect skipped.`)};const{drawnCards:k,remainingDeck:A,newDiscard:I}=Un(U.deck,U.discard,1);if(k.length===0)return{newState:l};const $={...k[0],id:Ze(),isFaceUp:!0};let q={...l,[v]:{...U,deck:A,discard:I}};return q.actionRequired={type:"confirm_deck_play_preview",sourceCardId:a.id,actor:v,drawnCard:$,isFaceDown:c.faceDown,excludeCurrentLane:!0,currentLaneIndex:t,followUpEffect:u==null?void 0:u.thenEffect,conditionalType:u==null?void 0:u.type},{newState:q}}if(m==="deck"&&((F=c.destinationRule)==null?void 0:F.type)==="under_this_card"&&((L=c.condition)==null?void 0:L.type)==="per_x_cards_in_line"){const z=c.condition.cardCount||2,U=l[d].lanes[t].length,k=l[f].lanes[t].length,A=U+k,I=Math.floor(A/z);if(I===0)return{newState:l};const $=l[v];if($.deck.length===0&&$.discard.length===0)return{newState:l};const{drawnCards:q,remainingDeck:M,newDiscard:B}=Un($.deck,$.discard,I);if(q.length===0)return{newState:l};const W=q.map(ue=>({...ue,id:Ze(),isFaceUp:!1})),K=[...$.lanes[t]];K.splice(K.length-1,0,...W);const D=[...$.lanes];D[t]=K;const Q={...$,lanes:D,deck:M,discard:B};let ae={...l,[v]:Q};if(ae.detailedGameStats&&q.length>0){const ue=v==="player"?"playerFromEffect":"aiFromEffect",re=v==="player"?"playerFaceDown":"aiFaceDown";ae={...ae,detailedGameStats:{...ae.detailedGameStats,cardsPlayed:{...ae.detailedGameStats.cardsPlayed,[ue]:ae.detailedGameStats.cardsPlayed[ue]+q.length,[re]:ae.detailedGameStats.cardsPlayed[re]+q.length}}}}const Y=we(l,a.id),Z=Y?`${Y.card.protocol}-${Y.card.value}`:"a card effect";return ae=ne(ae,d,`${Z}: Plays ${q.length} card(s) face-down under itself.`),{newState:ae}}if(m==="deck"&&((O=c.destinationRule)==null?void 0:O.type)==="specific_lane"){const z=c.destinationRule.laneIndex==="current"?t:c.destinationRule.laneIndex;if(z===void 0||z<0||z>2)return console.error(`[Play Effect] Invalid lane index: ${z}`),{newState:l};const U=l[v];if(U.deck.length===0&&U.discard.length===0)return{newState:ne(l,d,`${v==="player"?"Player":"Opponent"} has no cards in deck/discard - effect skipped.`)};const{drawnCards:k,remainingDeck:A,newDiscard:I}=Un(U.deck,U.discard,p);if(k.length===0)return{newState:l};const $=k.map(Y=>({...Y,id:Ze(),isFaceUp:!y})),q=[...U.lanes];q[z]=[...q[z],...$];const M={...U,lanes:q,deck:A,discard:I};let B={...l,[v]:M};if(B.detailedGameStats&&k.length>0){const Y=v==="player"?"playerFromEffect":"aiFromEffect",Z=v==="player"?y?"playerFaceDown":"playerFaceUp":y?"aiFaceDown":"aiFaceUp";B={...B,detailedGameStats:{...B.detailedGameStats,cardsPlayed:{...B.detailedGameStats.cardsPlayed,[Y]:B.detailedGameStats.cardsPlayed[Y]+k.length,[Z]:B.detailedGameStats.cardsPlayed[Z]+k.length}}}}const W=we(l,a.id),K=W?`${W.card.protocol}-${W.card.value}`:"a card effect",D=v==="player"?"Player":"Opponent",Q=y?"face-down":"face-up",ae=l.player.protocols[z];return B=ne(B,d,`${K}: ${D} plays ${k.length} card(s) ${Q} in ${ae} line.`),{newState:B}}if(m==="hand"&&((T=c.destinationRule)==null?void 0:T.type)==="line_with_matching_cards"){const z=c.destinationRule.cardFilter,U=I=>{const $=q=>q.length===0?!1:z?q.some(M=>z.faceState==="face_down"?!M.isFaceUp:z.faceState==="face_up"?M.isFaceUp:!0):!0;return $(l.player.lanes[I])||$(l.opponent.lanes[I])},k=[];for(let I=0;I<3;I++)U(I)&&k.push(I);if(k.length===0){const I=we(l,a.id),$=I?`${I.card.protocol}-${I.card.value}`:"Effect";return{newState:ne(l,d,`${$}: No valid lanes with face-down cards. Effect skipped.`)}}if(l[v].hand.length===0)return{newState:l};let A={...l};return A.actionRequired={type:"select_card_from_hand_to_play",sourceCardId:a.id,actor:v,count:c.count||1,faceDown:c.faceDown,source:"hand",validLanes:k,cardFilter:z,followUpEffect:u==null?void 0:u.thenEffect,conditionalType:u==null?void 0:u.type},{newState:A}}if(m==="hand"&&((G=c.valueFilter)==null?void 0:G.equals)!==void 0&&!c.destinationRule){const z=c.valueFilter.equals,U=l[v].hand.filter(A=>A.value===z);if(U.length===0){const A=we(l,a.id),I=A?`${A.card.protocol}-${A.card.value}`:"Effect";return{newState:ne(l,d,`${I}: No cards with value ${z} in hand. Effect skipped.`)}}let k={...l};return k.actionRequired={type:"select_card_from_hand_to_play",sourceCardId:a.id,actor:v,count:c.count||1,faceDown:c.faceDown,source:"hand",valueFilter:z,selectableCardIds:U.map(A=>A.id),followUpEffect:u==null?void 0:u.thenEffect,conditionalType:u==null?void 0:u.type},{newState:k}}if(m==="hand"&&l[v].hand.length===0)return{newState:l};let x={...l},w;(V=c.destinationRule)!=null&&V.excludeCurrentLane&&(w=t);let S;if(c.useCardFromPreviousEffect&&m==="hand"){const z=l.lastCustomEffectTargetCardId;if(z&&(S=[z],!l[v].hand.find(k=>k.id===z)))return{newState:l}}return x.actionRequired={type:"select_card_from_hand_to_play",count:p,sourceCardId:a.id,actor:v,faceDown:y,source:m,disallowedLaneIndex:w,destinationRule:c.destinationRule,condition:c.condition,selectableCardIds:S,followUpEffect:u==null?void 0:u.thenEffect,conditionalType:u==null?void 0:u.type},{newState:x}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Reveal/Give Effect Executor
 *
 * Handles reveal and give card effects.
 * Extracted 1:1 from effectInterpreter.ts for modularity.
 */function M0(a,t,l,i,c){const{cardOwner:d,opponent:f}=i,u=c._conditional,p=c.count||1,m=c.action,y=c.source||"own_hand";if(m==="reveal"&&y==="board"){const x=c.targetFilter||{owner:"any",position:"uncovered",faceState:"face_down"},w=c.followUpAction,S=c.optional!==!1,E=[],b=x.owner==="own"?[d]:x.owner==="opponent"?[f]:[d,f];for(const C of b)for(let R=0;R<l[C].lanes.length;R++){const F=l[C].lanes[R];if(F.length>0){let L=[];x.position==="uncovered"?L=[F[F.length-1]]:x.position==="covered"?L=F.slice(0,-1):L=[...F];const O=L.filter(T=>x.faceState==="face_up"?T.isFaceUp:x.faceState==="face_down"?!T.isFaceUp:!0);E.push(...O)}}if(E.length===0)return{newState:ne(l,d,"No valid cards to reveal. Effect skipped.")};let j={...l};return j.actionRequired={type:"select_board_card_to_reveal_custom",sourceCardId:a.id,actor:d,targetFilter:x,followUpAction:w,optional:S,followUpEffect:u==null?void 0:u.thenEffect,conditionalType:u==null?void 0:u.type},{newState:j}}if(m==="reveal"&&y==="opponent_hand"){let x={...l};const w={...x[f]};if(w.hand.length>0){w.hand=w.hand.map(E=>({...E,isRevealed:!0})),x[f]=w;const S=`${a.protocol}-${a.value}`;x=ne(x,d,`${S}: Your opponent reveals their hand.`)}else{const S=`${a.protocol}-${a.value}`;x=ne(x,d,`${S}: Opponent has no cards to reveal.`)}return{newState:x}}if(m==="reveal"&&y==="own_deck_top"){let x={...l};const w={...x[d]},S=`${a.protocol}-${a.value}`;if(w.deck.length===0)return x=ne(x,d,`${S}: No cards in deck to reveal.`),{newState:x};const E=[...w.deck],b=E[0];x=ne(x,d,`${S}: Revealed ${b.protocol}-${b.value} from top of deck.`);const j=`deck-top-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;return E[0]={...b,id:j},w.deck=E,x[d]=w,x.lastCustomEffectTargetCardId=j,{newState:x}}if(m==="reveal"&&y==="own_deck"){let x={...l};const w={...x[d]},S=`${a.protocol}-${a.value}`;if(w.deck.length===0)return x=ne(x,d,`${S}: No cards in deck to reveal.`),{newState:x};w.deckRevealed=!0,x[d]=w;const E=w.deck.map(b=>`${b.protocol}-${b.value}`).join(", ");return x=ne(x,d,`${S}: Revealed deck: ${E}`),{newState:x}}if(l[d].hand.length===0)return{newState:ne(l,d,`No cards in hand to ${m}. Effect skipped.`)};let v={...l};return m==="reveal"?v.actionRequired={type:"select_card_from_hand_to_reveal",count:p,sourceCardId:a.id,actor:d,followUpEffect:u==null?void 0:u.thenEffect,conditionalType:u==null?void 0:u.type}:m==="give"&&(v.actionRequired={type:"select_card_from_hand_to_give",count:p,sourceCardId:a.id,actor:d,followUpEffect:u==null?void 0:u.thenEffect,conditionalType:u==null?void 0:u.type}),{newState:v}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Shuffle Effect Executor
 *
 * Handles shuffle_trash and shuffle_deck effects.
 * - shuffle_trash: Clarity-4 "You may shuffle your trash into your deck."
 *   (In this codebase, "trash" = "discard pile")
 * - shuffle_deck: Clarity-2/3 "Shuffle your deck."
 */function H0(a,t,l,i,c){const{cardOwner:d}=i,f=c._conditional,u=`${a.protocol}-${a.value}`,p=c.optional!==!1;if(l[d].discard.length===0)return{newState:ne(l,d,`${u}: No cards in trash to shuffle.`)};if(p){let m={...l};return m.actionRequired={type:"prompt_optional_shuffle_trash",sourceCardId:a.id,actor:d,trashCount:l[d].discard.length,followUpEffect:f==null?void 0:f.thenEffect,conditionalType:f==null?void 0:f.type},{newState:m}}return Cm(l,d,u)}function Cm(a,t,l){let i={...a};const c={...i[t]},d=c.discard.length;return d===0?(i=ne(i,t,`${l}: No cards in trash to shuffle.`),{newState:i}):(c.deck=[...c.deck,...c.discard],c.discard=[],c.deck=Ln([...c.deck]),i[t]=c,i=ne(i,t,`${l}: Shuffled ${d} card${d!==1?"s":""} from trash into deck.`),{newState:i})}function z0(a,t,l,i,c){const{cardOwner:d}=i,f=`${a.protocol}-${a.value}`;let u={...l};const p={...u[d]};return p.deck.length===0?(u=ne(u,d,`${f}: No cards in deck to shuffle.`),{newState:u}):(p.deck=Ln([...p.deck]),p.deckRevealed=!1,u[d]=p,u=ne(u,d,`${f}: Shuffled deck.`),{newState:u})}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * State Number Effect Executor
 *
 * Handles the "state a number" effect (Luck-0).
 * Player chooses a number (0-5) which is stored in state for subsequent effects.
 */function V0(a,t,l,i,c){const{cardOwner:d}=i;let f={...l};return f.actionRequired={type:"state_number",actor:d,sourceCardId:a.id,numberSource:c.numberSource||"own_protocol_values"},{newState:f}}function B0(a,t,l){let i={...a};return i.lastStatedNumber=l,i=ne(i,t,`${t==="player"?"Player":"Opponent"} states the number ${l}.`),i.actionRequired=null,i}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * State Protocol Effect Executor
 *
 * Handles the "state a protocol" effect (Luck-3).
 * Player chooses a protocol from opponent's cards which is stored for subsequent effects.
 */function Y0(a,t){const l=new Set;a[t].deck.forEach(f=>l.add(f.protocol)),a[t].hand.forEach(f=>l.add(f.protocol)),a[t].lanes.forEach(f=>{f.forEach(u=>l.add(u.protocol))}),a[t].discard.forEach(f=>l.add(f.protocol));const i=[],c=a[t].protocols;for(const f of c)l.has(f)&&!i.includes(f)&&i.push(f);const d=Array.from(l).filter(f=>!i.includes(f)).sort();return i.push(...d),i}function G0(a,t,l,i,c){const{cardOwner:d,opponent:f}=i;let u=[];if(c.protocolSource==="opponent_cards"&&(u=Y0(l,f)),u.length===0){let m=ne(l,d,"No protocols available to state - effect skipped.");return m._effectSkippedNoTargets=!0,{newState:m}}let p={...l};return p.actionRequired={type:"state_protocol",actor:d,sourceCardId:a.id,protocolSource:c.protocolSource||"opponent_cards",availableProtocols:u},{newState:p}}function W0(a,t,l){let i={...a};return i.lastStatedProtocol=l,i=ne(i,t,`${t==="player"?"Player":"Opponent"} states the protocol "${l}".`),i.actionRequired=null,i}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Swap Stacks Effect Executor (Mirror-2)
 *
 * Swaps all cards between two of the player's own lanes.
 * Does NOT swap protocols - only the card stacks.
 */function Q0(a,t,l,i,c){const{cardOwner:d}=i;if(!l[d].lanes.some(m=>m.length>0))return{newState:ne(l,d,"Cannot swap stacks: no cards on board.")};const u=[0,1,2];let p={...l};return p.actionRequired={type:"select_lanes_for_swap_stacks",actor:d,sourceCardId:a.id,validLanes:u,selectedFirstLane:void 0},{newState:p}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Copy Opponent Middle Effect Executor (Mirror-1)
 *
 * Allows the player to select one of the opponent's face-up uncovered cards
 * and execute its middle effects as if they were on this card.
 */function X0(a){var l,i;return((i=(l=a.customEffects)==null?void 0:l.middleEffects)==null?void 0:i.length)>0}function Z0(a){var l;return((l=a.customEffects)==null?void 0:l.middleEffects)||[]}function K0(a,t,l,i,c){const{cardOwner:d}=i,f=d==="player"?"opponent":"player",u=c.optional??!1,p=[];for(let y=0;y<l[f].lanes.length;y++){const v=l[f].lanes[y];if(v.length===0)continue;const x=v[v.length-1];x.isFaceUp&&X0(x)&&p.push(x.id)}if(p.length===0)return{newState:ne(l,d,"No opponent cards with middle commands to copy.")};let m={...l};return m.actionRequired={type:"select_card_for_copy_middle",actor:d,sourceCardId:a.id,validTargetIds:p,optional:u},{newState:m}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function ut(a,t,l,i,c,d){var j,C,R;const f={...c.params,_conditional:c.conditional},u=f.action,p=we(l,a.id);if(!p)return{newState:l};if(!p.card.isFaceUp)return{newState:l};const m=c.position||"middle",v=c.trigger==="on_cover",x=f.useCardFromPreviousEffect===!0;if(m!=="top"&&!v&&!x&&!To(l,a.id))return{newState:l};const S=u==="reveal"&&f.source==="board";if(f.optional===!0&&!S){const F=f.actor==="opponent"?i.opponent:i.cardOwner,L=F==="player"?"opponent":"player",O=f.targetFilter||{},T=U=>{for(const k of["player","opponent"])for(let A=0;A<l[k].lanes.length;A++){const I=l[k].lanes[A];for(let $=0;$<I.length;$++)if(U(I[$],k,A,$))return!0}return!1};let G=!0,V="";switch(u){case"discard":!f.useCardFromPreviousEffect&&l[F].hand.length===0&&(G=!1,V="No cards to discard");break;case"flip":{const U=(j=l.passiveEffects)==null?void 0:j.some(k=>k.type==="prevent_flip_to_face_up"&&k.isActive);G=T((k,A,I,$)=>{if(O.excludeSelf&&k.id===a.id||O.owner==="own"&&A!==F||O.owner==="opponent"&&A===F)return!1;const q=$===l[A].lanes[I].length-1;return!(O.position==="uncovered"&&!q||O.position==="covered"&&q||O.faceState==="face_up"&&!k.isFaceUp||O.faceState==="face_down"&&k.isFaceUp||U&&!k.isFaceUp)}),G||(V="No valid cards to flip");break}case"delete":{G=T((U,k,A,I)=>{if(O.excludeSelf&&U.id===a.id||O.owner==="own"&&k!==F||O.owner==="opponent"&&k===F)return!1;const $=I===l[k].lanes[A].length-1,q=O.position||"uncovered";return!(q==="uncovered"&&!$||q==="covered"&&$||O.faceState==="face_up"&&!U.isFaceUp||O.faceState==="face_down"&&U.isFaceUp)}),G||(V="No valid cards to delete");break}case"shift":{if(c.useCardFromPreviousEffect){const U=l.lastCustomEffectTargetCardId||l._selectedCardFromPreviousEffect;U?(G=!!we(l,U),G||(V="Target card no longer exists")):(G=!1,V="No target card from previous effect")}else if(f.shiftSelf&&((C=f.destinationRestriction)==null?void 0:C.type)==="opponent_highest_value_lane")Em(l,i.cardOwner).includes(t)&&(G=!1,V="Card is already in opponent's highest value lane");else if(((R=f.advancedConditional)==null?void 0:R.type)==="this_card_is_covered"){const U=l[i.cardOwner].lanes;let k=!1;for(let A=0;A<U.length;A++){const I=U[A],$=I.findIndex(q=>q.id===a.id);if($!==-1){k=$<I.length-1;break}}k||(G=!1,V="Card is not covered")}else{const U=O.position||"uncovered";U==="any"&&O.owner==="own"&&!O.excludeSelf?G=!0:(G=T((A,I,$,q)=>{if(O.excludeSelf&&A.id===a.id||O.owner==="own"&&I!==F||O.owner==="opponent"&&I===F)return!1;const M=q===l[I].lanes[$].length-1;return!(U==="uncovered"&&!M||U==="covered"&&M)}),G||(V="No valid cards to shift"))}break}case"return":{const U=O.owner==="opponent"?L:F;G=T((k,A,I,$)=>{if(A!==U)return!1;const q=$===l[A].lanes[I].length-1,M=O.position||"uncovered";return!(M==="uncovered"&&!q||M==="covered"&&q)}),G||(V="No valid cards to return");break}case"draw":l[F].deck.length===0&&l[F].discard.length===0&&(G=!1,V="No cards to draw");break;case"play":l[F].hand.length===0&&(G=!1,V="No cards to play");break}if(!G){let U=ne(l,F,`${V} - effect skipped.`);return U._effectSkippedNoTargets=!0,u==="discard"&&(U._discardContext={discardedCount:0}),{newState:U}}let z={...l};return z.actionRequired={type:"prompt_optional_effect",actor:i.cardOwner,sourceCardId:a.id,effectDef:c,laneIndex:t},{newState:z}}let E;const b={logSource:l._currentEffectSource,logPhase:l._currentPhaseContext,logIndentLevel:l._logIndentLevel||0};switch(u){case"refresh":{const L=(f.target||"self")==="opponent"?i.opponent:i.actor,O=Wd(l,L);if(!O.allowed){E={newState:ne(l,i.cardOwner,O.reason||"Cannot refresh (draw blocked).")};break}const T=l[L].hand.length,G=Math.max(0,5-T);if(G>0){const{drawnCards:V,remainingDeck:z,newDiscard:U}=Un(l[L].deck,l[L].discard,G),k=V.map(q=>({...q,id:Ze()}));let A={...l,[L]:{...l[L],hand:[...l[L].hand,...k],deck:z,discard:U}};const I=L==="player"?` (${V.map(q=>`${q.protocol}-${q.value}`).join(", ")})`:"";A=ne(A,L,`[Refresh] Drew ${V.length} cards to reach hand size 5${I}.`),A=Nt(A,"after_draw",{player:L,count:V.length}).newState,E={newState:A}}else E={newState:ne(l,L,`[Refresh] Hand already at ${T} cards, no draw needed.`)};break}case"mutual_draw":{const F=i.actor,L=F==="player"?"opponent":"player",O=f.count||1;let T={...l};if(T[L].deck.length>0){const{drawnCards:G,remainingDeck:V,newDiscard:z}=Un(T[L].deck,T[L].discard,O);if(G.length>0){const U=G.map($=>({...$,id:Ze(),isFaceUp:!0}));T={...T,[L]:{...T[L],deck:V,discard:z},[F]:{...T[F],hand:[...T[F].hand,...U]}};const k=F==="player"?"Player":"Opponent",A=L==="player"?"Player":"Opponent",I=F==="player"?` (${U.map($=>`${$.protocol}-${$.value}`).join(", ")})`:"";T=ne(T,F,`${k} drew ${G.length} card(s) from ${A}'s deck${I}.`)}}if(T[F].deck.length>0){const{drawnCards:G,remainingDeck:V,newDiscard:z}=Un(T[F].deck,T[F].discard,O);if(G.length>0){const U=G.map($=>({...$,id:Ze(),isFaceUp:!0}));T={...T,[F]:{...T[F],deck:V,discard:z},[L]:{...T[L],hand:[...T[L].hand,...U]}};const k=L==="player"?"Player":"Opponent",A=F==="player"?"Player":"Opponent",I=L==="player"?` (${U.map($=>`${$.protocol}-${$.value}`).join(", ")})`:"";T=ne(T,L,`${k} drew ${G.length} card(s) from ${A}'s deck${I}.`)}}E={newState:T};break}case"draw":E=q0(a,t,l,i,f);break;case"flip":E=$0(a,t,l,i,{...f,useCardFromPreviousEffect:c.useCardFromPreviousEffect,_conditional:c.conditional});break;case"delete":E=L0(a,t,l,i,f);break;case"discard":E=I0(a,t,l,i,f);break;case"shift":E=U0(a,t,l,i,{...f,useCardFromPreviousEffect:c.useCardFromPreviousEffect});break;case"return":E=P0(a,t,l,i,f);break;case"play":E=O0(a,t,l,i,f);break;case"rearrange_protocols":case"swap_protocols":E=J0(a,t,l,i,f);break;case"reveal":case"give":E=M0(a,t,l,i,f);break;case"take":E=ex(a,t,l,i,f);break;case"choice":E=tx(a,t,l,i,f);break;case"block_compile":E=nx(a,t,l,i,f);break;case"delete_all_in_lane":E=ax(a,t,l,i,f);break;case"shuffle_trash":E=H0(a,t,l,i,f);break;case"shuffle_deck":E=z0(a,t,l,i);break;case"state_number":E=V0(a,t,l,i,f);break;case"state_protocol":E=G0(a,t,l,i,f);break;case"swap_stacks":E=Q0(a,t,l,i);break;case"copy_opponent_middle":E=K0(a,t,l,i,f);break;default:console.error(`[Custom Effect] Unknown action: ${u}`),E={newState:l};break}if(E.newState.actionRequired&&!E.newState.actionRequired.logSource&&(E={...E,newState:{...E.newState,actionRequired:{...E.newState.actionRequired,logSource:b.logSource,logPhase:b.logPhase,logIndentLevel:b.logIndentLevel}}}),c.conditional&&c.conditional.thenEffect){const{newState:F}=E;if(F.actionRequired)E={newState:{...F,actionRequired:{...F.actionRequired,followUpEffect:c.conditional.thenEffect,conditionalType:c.conditional.type,outerSourceCardId:a.id,outerLaneIndex:t}}};else{if(c.conditional.type==="if_executed"){const T=F._discardContext;if(((T==null?void 0:T.discardedCount)||0)===0)return delete F._discardContext,E={newState:F},E}if(c.conditional.type==="if_protocol_matches_stated"){const T=F._discardContext,G=T==null?void 0:T.discardedCardProtocol,V=F.lastStatedProtocol;if(!V||!G||G!==V){let U=ne(F,i.cardOwner,`Discarded card does not match stated protocol "${V||"none"}". Effect skipped.`);return delete U._discardContext,E={newState:U},E}let z=ne(F,i.cardOwner,`Discarded card matches stated protocol "${V}"!`);delete z._discardContext,E={newState:z}}if(c.conditional.type==="optional"){let T={...F};return T.actionRequired={type:"prompt_optional_effect",actor:i.cardOwner,sourceCardId:a.id,effectDef:c.conditional.thenEffect,laneIndex:t,savedTargetCardId:F.lastCustomEffectTargetCardId},E={newState:T},E}let L=i;const O=F._discardContext;O&&(L={...i,discardedCount:O.discardedCount,previousHandSize:O.previousHandSize},delete F._discardContext),E=ut(a,t,F,L,c.conditional.thenEffect)}}return E}function J0(a,t,l,i,c){const{cardOwner:d,opponent:f}=i,u=c.action,m=(c.target||"own")==="opponent"?f:d,y=d;if(x0(l)&&u==="rearrange_protocols")return{newState:ne(l,d,"Protocols cannot be rearranged (Frost-1 bottom effect is active).")};let x={...l},w;return c.restriction&&(w={laneIndex:c.restriction.laneIndex==="current"?t:c.restriction.laneIndex,protocol:c.restriction.disallowedProtocol}),u==="rearrange_protocols"?x.actionRequired={type:"prompt_rearrange_protocols",actor:y,target:m,sourceCardId:a.id,disallowedProtocolForLane:w}:u==="swap_protocols"&&(x.actionRequired={type:"prompt_swap_protocols",actor:y,target:m,sourceCardId:a.id,disallowedProtocolForLane:w}),{newState:x}}function ex(a,t,l,i,c){const{cardOwner:d,opponent:f}=i,u=c.count||1,p=c.random!==!1;if(l[f].hand.length===0)return{newState:ne(l,d,"Opponent has no cards in hand. Effect skipped.")};let m={...l};const y={...m[f]},v={...m[d]};if(p){const x=Math.min(u,y.hand.length),w=[];for(let j=0;j<x;j++){const C=Math.floor(Math.random()*y.hand.length),R=y.hand.splice(C,1)[0];v.hand.push(R),w.push(R)}m={...m,[d]:v,[f]:y};const S=d==="player"?"Player":"Opponent",E=`${a.protocol}-${a.value}`,b=w.map(j=>d==="player"?`${j.protocol}-${j.value}`:"a card").join(", ");return m=ne(m,d,`${E}: ${S} takes ${b} from the opponent's hand.`),{newState:m}}else{console.warn("[Take Effect] Non-random take not yet implemented, falling back to random");const x=Math.floor(Math.random()*y.hand.length),w=y.hand.splice(x,1)[0];v.hand.push(w),m={...m,[d]:v,[f]:y};const S=d==="player"?"Player":"Opponent",E=`${a.protocol}-${a.value}`,b=d==="player"?`${w.protocol}-${w.value}`:"a card";return m=ne(m,d,`${E}: ${S} takes ${b} from the opponent's hand.`),{newState:m}}}function tx(a,t,l,i,c){const{cardOwner:d}=i,f=c.options||[];if(f.length!==2)return console.error(`[Choice Effect] Expected 2 options, got ${f.length}`),{newState:l};let u={...l};return u.actionRequired={type:"custom_choice",options:f,sourceCardId:a.id,actor:d,laneIndex:t},{newState:u}}function nx(a,t,l,i,c){const{cardOwner:d,opponent:f}=i,p=(c.target||"opponent")==="opponent"?f:d,m={...l[p],cannotCompile:!0};let y={...l,[p]:m};const v=we(l,a.id),x=v?`${v.card.protocol}-${v.card.value}`:"Effect";return y=ne(y,d,`${x}: ${p==="player"?"Player":"Opponent"} cannot compile next turn.`),{newState:y}}function ax(a,t,l,i,c){var y;const{cardOwner:d}=i,f=c.excludeCurrentLane!==!1,u=((y=c.laneCondition)==null?void 0:y.count)||8,p=[];for(let v=0;v<3;v++){if(f&&v===t)continue;l.player.lanes[v].length+l.opponent.lanes[v].length>=u&&p.push(v)}if(p.length===0){const v=`${a.protocol}-${a.value}`;return{newState:ne(l,d,`${v}: No line has ${u} or more cards. Effect skipped.`)}}let m={...l};return m.actionRequired={type:"select_lane_for_delete_all",sourceCardId:a.id,actor:d,validLanes:p,minCards:u},{newState:m}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function Nt(a,t,l){var u;let i={...a};if(i._processingReactiveEffects)return{newState:i};i={...i,_processingReactiveEffects:!0};const c=i.processedClearCacheTriggerIds||[],d=[],f=p=>p.some(m=>m.trigger===t||m.trigger==="on_cover_or_flip"&&(t==="on_cover"||t==="on_flip"));for(const p of["player","opponent"])i[p].lanes.forEach((m,y)=>{m.forEach((v,x)=>{if(!v.isFaceUp)return;const w=i._committedCardId;if(w&&v.id===w)return;const S=v;if(!S.customEffects)return;const E=x===m.length-1;if(S.customEffects.topEffects&&f(S.customEffects.topEffects)){if(t==="after_clear_cache"&&c.includes(v.id))return;d.push({card:v,owner:p,laneIndex:y,box:"top"})}if(S.customEffects.middleEffects&&f(S.customEffects.middleEffects)){if(t==="after_clear_cache"&&c.includes(v.id))return;d.push({card:v,owner:p,laneIndex:y,box:"middle"})}if(E&&S.customEffects.bottomEffects){const b=S.customEffects.bottomEffects.filter(j=>j.trigger!=="on_cover");if(b.length>0&&f(b)){if(t==="after_clear_cache"&&c.includes(v.id))return;d.push({card:v,owner:p,laneIndex:y,box:"bottom"})}}})});if(d.length===0)return delete i._processingReactiveEffects,{newState:i};for(const{card:p,owner:m,laneIndex:y,box:v}of d){const x=i[m].lanes[y],w=x==null?void 0:x.findIndex(O=>O.id===p.id);if(!(w!==void 0&&w!==-1&&((u=x[w])==null?void 0:u.isFaceUp))||v==="bottom"&&!(w===x.length-1)||t==="before_compile_delete"&&(l==null?void 0:l.cardId)!==p.id||t==="on_flip"&&(l==null?void 0:l.cardId)!==p.id||(t==="on_cover"||t==="on_flip")&&l!=null&&l.cardId&&l.cardId!==p.id)continue;const E=p,C=(v==="top"?E.customEffects.topEffects:v==="middle"?E.customEffects.middleEffects:E.customEffects.bottomEffects).filter(O=>O.trigger===t||O.trigger==="on_cover_or_flip"&&(t==="on_cover"||t==="on_flip")).filter(O=>{const T=O.reactiveTriggerActor||"self";if(!(l!=null&&l.player))return!0;if(t==="after_opponent_discard"||t==="after_opponent_draw")return l.player===m;if(T==="self"){if(l.player!==m)return!1}else if(T==="opponent"&&l.player===m)return!1;return!((O.reactiveScope||"global")==="this_lane"&&(l==null?void 0:l.laneIndex)!==void 0&&y!==l.laneIndex||O.onlyDuringOpponentTurn&&i.turn===m)});if(C.length===0)continue;const R=`${p.protocol}-${p.value}`;i=Ka(i),i=Be(i,R),i=Ke(i,void 0);const F=m==="player"?"opponent":"player",L={cardOwner:m,actor:m,currentTurn:i.turn,opponent:F,triggerType:t};if(t==="after_clear_cache"){const O=i.processedClearCacheTriggerIds||[];i.processedClearCacheTriggerIds=[...O,p.id]}for(const O of C){const T=ut(p,y,i,L,O);if(i=Ce(T.newState),i.actionRequired){const G=i._pendingCustomEffects;if(G&&G.effects.length>0){const V={type:"execute_remaining_custom_effects",sourceCardId:G.sourceCardId,laneIndex:G.laneIndex,effects:G.effects,context:G.context,actor:G.context.cardOwner};i.queuedActions=[V,...i.queuedActions||[]],delete i._pendingCustomEffects}return delete i._processingReactiveEffects,{newState:i}}}i=Ao(i),i=Be(i,void 0),i=Ke(i,void 0)}return delete i._processingReactiveEffects,{newState:i}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function Un(a,t,l){let i=[...a],c=[...t],d=[],f=!1;for(let u=0;u<l;u++){if(i.length===0){if(c.length===0)break;i=Ln(c),c=[],f=!0}d.push(i.shift())}return{drawnCards:d,remainingDeck:i,newDiscard:c,reshuffled:f}}function cr(a,t,l,i="effect"){const c=a[t],{drawnCards:d,remainingDeck:f,newDiscard:u,reshuffled:p}=Un(c.deck,c.discard,l);if(d.length===0)return a;const m=d.map(S=>({...S,id:Ze(),isFaceUp:!0})),y=m.map(S=>S.id),v={...c.stats,cardsDrawn:c.stats.cardsDrawn+d.length},x={...c,deck:f,discard:u,hand:[...c.hand,...m],stats:v};let w={...a,[t]:x,stats:{...a.stats,[t]:v}};if(w.detailedGameStats&&d.length>0){const S=i==="refresh",E=t==="player"?S?"playerFromRefresh":"playerFromEffect":S?"aiFromRefresh":"aiFromEffect";w={...w,detailedGameStats:{...w.detailedGameStats,cardsDrawn:{...w.detailedGameStats.cardsDrawn,[E]:w.detailedGameStats.cardsDrawn[E]+d.length}}}}return y.length>0&&(w.animationState={type:"drawCard",owner:t,cardIds:y}),p&&(w=ne(w,t,`${t==="player"?"Player":"Opponent"}'s deck is empty. Discard pile has been reshuffled into the deck.`)),d.length>0&&(w=Nt(w,"after_draw",{player:t,count:d.length}).newState),w}function ox(a,t,l){const i=t==="player"?"opponent":"player";let c={...a};const d={...c[i]},f={...c[t]},{drawnCards:u,remainingDeck:p,newDiscard:m,reshuffled:y}=Un(d.deck,d.discard,l);if(u.length>0){const v=u.map(S=>({...S,id:Ze(),isFaceUp:!0})),x=v.map(S=>S.id);f.hand=[...f.hand,...v];const w={...f.stats,cardsDrawn:f.stats.cardsDrawn+u.length};if(f.stats=w,d.deck=p,d.discard=m,c={...c,[t]:f,[i]:d,stats:{...c.stats,[t]:w}},x.length>0&&(c.animationState={type:"drawCard",owner:t,cardIds:x}),y&&(c=ne(c,t,`${i==="player"?"Player":"Opponent"}'s deck is empty. Discard pile has been reshuffled into the deck.`)),c.detailedGameStats&&u.length>0){const S=t==="player"?"playerFromEffect":"aiFromEffect";c={...c,detailedGameStats:{...c.detailedGameStats,cardsDrawn:{...c.detailedGameStats.cardsDrawn,[S]:c.detailedGameStats.cardsDrawn[S]+u.length}}}}}return c}function rx(a,t){const i=5-a[t].hand.length;if(i<=0)return a;let d=ne(a,t,`${t==="player"?"Player":"Opponent"} refreshes their hand, drawing ${i} card(s).`);d=cr(d,t,i,"refresh");const f={...d[t],stats:{...d[t].stats,handsRefreshed:d[t].stats.handsRefreshed+1}};if(d={...d,[t]:f,stats:{...d.stats,[t]:f.stats}},d.detailedGameStats){const u=t==="player"?"playerCardsDrawn":"aiCardsDrawn";d={...d,detailedGameStats:{...d.detailedGameStats,refreshes:{...d.detailedGameStats.refreshes,[u]:d.detailedGameStats.refreshes[u]+i}}}}return d}function lr(a,t){const l={...t},i=c=>c.map(d=>d.map(f=>a.has(f.id)?{...f,isFaceUp:!f.isFaceUp}:f));return l.player.lanes=i(l.player.lanes),l.opponent.lanes=i(l.opponent.lanes),Ce(l)}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Xh=a=>{const t=Ln(Xa(a)),{drawnCards:l,remainingDeck:i}=Un(t,[],5),c={cardsPlayed:0,cardsDiscarded:0,cardsDeleted:0,cardsFlipped:0,cardsShifted:0,cardsDrawn:l.length,cardsReturned:0,handsRefreshed:0},d=l.map(f=>({...f,id:Ze(),isFaceUp:!0}));return{protocols:a,deck:i,hand:d,lanes:[[],[],[]],discard:[],compiled:[!1,!1,!1],laneValues:[0,0,0],cannotCompile:!1,stats:c}},zl=(a,t,l,i="player")=>{const c=Xh(a),d=Xh(t),f={player:c,opponent:d,turn:i,phase:"start",controlCardHolder:null,useControlMechanic:l,winner:null,log:[],actionRequired:null,queuedActions:[],animationState:null,compilableLanes:[],processedStartEffectIds:[],processedEndEffectIds:[],lastPlayedCardId:void 0,stats:{player:c.stats,opponent:d.stats},detailedGameStats:{cardsPlayed:{playerFromHand:0,playerFromEffect:0,aiFromHand:0,aiFromEffect:0,playerFaceUp:0,playerFaceDown:0,aiFaceUp:0,aiFaceDown:0},cardsDrawn:{playerFromRefresh:0,playerFromEffect:0,aiFromRefresh:0,aiFromEffect:0},compiles:{playerFirstCompile:0,playerRecompile:0,aiFirstCompile:0,aiRecompile:0},refreshes:{playerCardsDrawn:0,aiCardsDrawn:0}}},u=i==="player"?"Player":"Opponent",p=a.join(", "),m=t.join(", ");let y=ne(f,"player","Game Started.");return y=ne(y,"player",`Player protocols: ${p}`),y=ne(y,"opponent",`Opponent protocols: ${m}`),y=ne(y,"player",`${u} goes first.`),y},pa=(a,t,l,i,c)=>{if(a.isFaceUp)return a.value;if(t.some(f=>f.isFaceUp&&f.protocol==="Darkness"&&f.value===2))return 4;if(l&&i!==void 0&&c!==void 0){const f=Sm(l);for(const u of f)if(u.type==="set_to_fixed"){if(!(u.scope==="global"||u.scope==="this_lane"&&u.laneIndex===i))continue;const m=u.cardOwner;if(u.target==="own_cards"&&m!==c||u.target==="opponent_cards"&&m===c)continue;const y=u.filter;if(y&&(!y.faceState||y.faceState==="any"||y.faceState==="face_down"&&!a.isFaceUp||y.faceState==="face_up"&&a.isFaceUp))return u.value}}return 2},Zh=(a,t,l,i)=>{let c=0;for(const d of a)d.isFaceUp?c+=d.value:c+=pa(d,a,t,l,i);return Math.max(0,c)};function Sm(a){const t=[];for(const l of["player","opponent"])a[l].lanes.forEach((i,c)=>{i.forEach(d=>{if(d.isFaceUp){const f=d;f.customEffects&&[...f.customEffects.topEffects||[],...f.customEffects.middleEffects||[],...f.customEffects.bottomEffects||[]].forEach(p=>{p.params.action==="value_modifier"&&p.trigger==="passive"&&t.push({...p.params.modifier,cardOwner:l,laneIndex:c})})}})});return t}function lx(a,t,l){const i=Sm(a),c=[...t],d=[...l];for(const f of i){const{type:u,value:p,condition:m,target:y,scope:v,filter:x,cardOwner:w,laneIndex:S}=f,E=v==="global"?[0,1,2]:[S];for(const b of E)switch(u){case"add_per_condition":{if(!m)continue;let j=0;const C=a.player.lanes[b],R=a.opponent.lanes[b];m==="per_face_down_card"?j=C.filter(F=>!F.isFaceUp).length+R.filter(F=>!F.isFaceUp).length:m==="per_face_up_card"?j=C.filter(F=>F.isFaceUp).length+R.filter(F=>F.isFaceUp).length:m==="per_card"?j=C.length+R.length:m==="per_card_in_hand"?j=a[w].hand.length:m==="per_opponent_card_in_lane"&&(j=a[w==="player"?"opponent":"player"].lanes[b].length),y==="own_total"&&w==="player"?c[b]+=p*j:y==="own_total"&&w==="opponent"||y==="opponent_total"&&w==="player"?d[b]+=p*j:y==="opponent_total"&&w==="opponent"&&(c[b]+=p*j);break}case"set_to_fixed":break;case"add_to_total":{y==="own_total"&&w==="player"?c[b]+=p:y==="own_total"&&w==="opponent"||y==="opponent_total"&&w==="player"?d[b]+=p:y==="opponent_total"&&w==="opponent"&&(c[b]+=p);break}}}return{finalPlayerValues:c.map(f=>Math.max(0,f)),finalOpponentValues:d.map(f=>Math.max(0,f))}}function sx(a,t,l){let i=[...t],c=[...l];return{finalPlayerValues:i,finalOpponentValues:c}}const Ce=a=>{const t=a.player.lanes.map((f,u)=>Zh(f,a,u,"player")),l=a.opponent.lanes.map((f,u)=>Zh(f,a,u,"opponent")),i=sx(a,t,l),{finalPlayerValues:c,finalOpponentValues:d}=lx(a,i.finalPlayerValues,i.finalOpponentValues);return{...a,player:{...a.player,laneValues:c},opponent:{...a.opponent,laneValues:d}}},bm=(a,t)=>{const l=[],i=a[t],c=a[t==="player"?"opponent":"player"];if(!i.cannotCompile)for(let d=0;d<3;d++){const f=i.laneValues[d],u=c.laneValues[d];f>=10&&f>u&&l.push(d)}return l},na=(a,t,l)=>a[t].laneValues[l],cx=(a,t)=>{const l=t==="player"?"opponent":"player",i=[];for(let c=0;c<3;c++){const d=a[t].laneValues[c];a[l].laneValues[c]>d&&i.push(c)}return i},Em=(a,t)=>{const l=t==="player"?"opponent":"player";let i=-1,c=[];for(let d=0;d<3;d++){const f=a[l].laneValues[d];f>i?(i=f,c=[d]):f===i&&c.push(d)}return c};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const ix=["select_card_to_flip","select_any_card_to_flip"];function dx(a,t,l){if(!l||!ix.includes(l.type))return null;const i=we(a,t);if(i&&i.card.protocol==="Metal"&&i.card.value===6){const c="actor"in l?l.actor:a.turn,d=c==="player"?"Player":"Opponent",f=i.owner==="player"?"Player's":"Opponent's";let u="An effect";if("sourceCardId"in l&&l.sourceCardId){const C=we(a,l.sourceCardId);C&&(u=`${C.card.protocol}-${C.card.value}`)}let p=ne(a,c,`${u}: ${d} flips ${f} Metal-6.`);p=ne(p,c,"Metal-6: Deletes itself when flipped.");const m={...a.stats[c],cardsDeleted:a.stats[c].cardsDeleted+1},y={...a[c],stats:m};p={...p,[c]:y,stats:{...p.stats,[c]:m}};const v=i.owner,x=a[v].lanes.findIndex(C=>C.some(R=>R.id===t)),w=a[v].lanes[x],S=w&&w.length>0&&w[w.length-1].id===t,E=w&&w.length>1,b=a._pendingCustomEffects,j=(C,R)=>{var V,z;let F={...C};const L=b&&((V=F.queuedActions)==null?void 0:V.some(U=>U.type==="execute_remaining_custom_effects"&&U.sourceCardId===b.sourceCardId));b&&!L&&(F._pendingCustomEffects=b,F.lastCustomEffectTargetCardId=t);let T=Nt(F,"after_delete",{player:F.turn}).newState;if(S&&E&&(T=Pn(T,v,x).newState),l&&"count"in l&&l.count>1){const U=l.count-1;return T.actionRequired={...l,count:U},{...T,animationState:null}}if(F.actionRequired||F.queuedActions&&F.queuedActions.length>0)return{...T,actionRequired:F.actionRequired,queuedActions:F.queuedActions,animationState:null};const G=b&&((z=T.queuedActions)==null?void 0:z.some(U=>U.type==="execute_remaining_custom_effects"&&U.sourceCardId===b.sourceCardId));if(b&&!T._pendingCustomEffects&&!G&&(T._pendingCustomEffects=b,T.lastCustomEffectTargetCardId=t),T=Ge(T),T.actionRequired=null,T.queuedActions&&T.queuedActions.length>0){const U=[...T.queuedActions],k=U.shift();if((k==null?void 0:k.type)==="execute_remaining_custom_effects"){const A={...T,queuedActions:[k,...U]},I=ba(A);if(I.actionRequired)return{...I,animationState:null};if(I.queuedActions&&I.queuedActions.length>0){const $=[...I.queuedActions],q=$.shift();return{...I,actionRequired:q,queuedActions:$,animationState:null}}return R(I)}return{...T,actionRequired:k,queuedActions:U,animationState:null}}return R(T)};return{nextState:{...p,actionRequired:null},requiresAnimation:{animationRequests:[{type:"delete",cardId:t,owner:i.owner}],onCompleteCallback:j},requiresTurnEnd:!1}}return null}const Pd=(a,t)=>{var f,u,p,m,y,v,x,w,S,E,b,j,C,R,F;if(!a.actionRequired)return{nextState:a};let l={...a},i=!0,c=null;const d=dx(a,t,a.actionRequired);if(d)return d;switch(a.actionRequired.type){case"select_card_to_flip":{const{logSource:L,logPhase:O,logIndentLevel:T}=a.actionRequired;L!==void 0&&(l=Be(l,L)),O!==void 0&&(l=Ke(l,O)),T!==void 0&&(l._logIndentLevel=T);const G=a._committedCardId;if(G&&t===G)return{nextState:a};if(!Gl(a,t).allowed)return{nextState:a};const z=we(a,t),U="draws"in a.actionRequired?a.actionRequired.draws:0;l=Ld(a,t);const k=t;l.lastCustomEffectTargetCardId=k;let A;if(z){const D=a[z.owner].lanes.findIndex(Q=>Q.some(ae=>ae.id===t));D!==-1&&(A=D,l.lastFlipLaneIndex=D)}const I=(f=a.actionRequired)==null?void 0:f.sourceCardId;if(I&&l.queuedActions&&(l.queuedActions=l.queuedActions.map(D=>{var Q;return D.type==="execute_remaining_custom_effects"&&D.sourceCardId===I&&!D.selectedCardFromPreviousEffect&&((Q=D.effects)==null?void 0:Q.some(Y=>Y.useCardFromPreviousEffect))?{...D,selectedCardFromPreviousEffect:t}:D})),U&&U>0){const{actor:D,sourceCardId:Q}=a.actionRequired,ae=we(l,Q),Y=ae?`${ae.card.protocol}-${ae.card.value}`:"A card effect";l=ne(l,D,`${Y}: Drawing ${U} card(s).`),l=cr(l,D,U)}if(z&&!z.card.isFaceUp){const D=Ud(l,t);l=D.newState,l.lastCustomEffectTargetCardId=k,A!==void 0&&(l.lastFlipLaneIndex=A),D.animationRequests&&(c={animationRequests:D.animationRequests,onCompleteCallback:(Q,ae)=>Q.actionRequired||Q.queuedActions&&Q.queuedActions.length>0?Q:ae(Q)})}const $=(u=a.actionRequired)==null?void 0:u.followUpEffect,q=(p=a.actionRequired)==null?void 0:p.sourceCardId;$&&q&&(l=T0(l,t,q,$));const M=((m=a.actionRequired)==null?void 0:m.actor)||a.turn;l=Nt(l,"after_flip",{player:M,cardId:t}).newState;const W=l._pendingCustomEffects;if(W&&W.effects.length>0){const D={type:"execute_remaining_custom_effects",sourceCardId:W.sourceCardId,laneIndex:W.laneIndex,effects:W.effects,context:W.context,actor:W.context.cardOwner,selectedCardFromPreviousEffect:W.effects[0].useCardFromPreviousEffect?t:void 0,logSource:W.logSource,logPhase:W.logPhase,logIndentLevel:W.logIndentLevel};l.queuedActions=[D,...l.queuedActions||[]],delete l._pendingCustomEffects}const K=(y=a.actionRequired)==null?void 0:y.remainingLanes;if(K&&K.length>0&&!l.actionRequired){const D=K[0],Q=K.slice(1),ae=(v=a.actionRequired)==null?void 0:v.params,Y=(x=a.actionRequired)==null?void 0:x.sourceCardId,Z=(w=a.actionRequired)==null?void 0:w.actor,ue=(S=a.actionRequired)==null?void 0:S.targetFilter;l.actionRequired={type:"select_card_to_flip",sourceCardId:Y,actor:Z,currentLaneIndex:D,remainingLanes:Q,targetFilter:ue,params:ae,followUpEffect:(E=a.actionRequired)==null?void 0:E.followUpEffect,conditionalType:(b=a.actionRequired)==null?void 0:b.conditionalType}}(l.actionRequired||l.queuedActions&&l.queuedActions.length>0)&&(i=!1);break}case"select_card_to_shift":{const{logSource:L,logPhase:O,logIndentLevel:T}=a.actionRequired;L!==void 0&&(l=Be(l,L)),O!==void 0&&(l=Ke(l,O)),T!==void 0&&(l._logIndentLevel=T);const{sourceCardId:G,optional:V}=a.actionRequired;if(V&&G){const U=we(a,G);if(!U||!U.card.isFaceUp){const k=U?`${U.card.protocol}-${U.card.value}`:"the source card",A=a._logSource;l=Be(a,k),l=ne(l,a.actionRequired.actor,"Shift was cancelled because the source is no longer active."),l=Be(l,A),l=Ge(l),l.actionRequired=null,i=!0;break}}const z=we(a,t);if(z){const{owner:U}=z;let k=-1;for(let K=0;K<a[U].lanes.length;K++)if(a[U].lanes[K].some(D=>D.id===t)){k=K;break}if(k===-1)return{nextState:a,requiresTurnEnd:!1};const I=(a.actionRequired.targetFilter||{}).position||"uncovered",$=a[U].lanes[k],M=$.findIndex(K=>K.id===t)===$.length-1;if(I==="uncovered"&&!M)return{nextState:a,requiresTurnEnd:!1};if(I==="covered"&&M)return{nextState:a,requiresTurnEnd:!1};const B=a.actionRequired.scope,W=a.actionRequired.sourceLaneIndex;if(B==="this_lane"&&W!==void 0&&k!==W)return{nextState:a,requiresTurnEnd:!1};if(k!==-1){const K=a.actionRequired.targetLaneIndex;if(K!==void 0){const Q=a.actionRequired.actor;l=Ro(a,t,U,K,Q).newState,i=!l.actionRequired;break}const D={type:"select_lane_for_shift",cardToShiftId:t,cardOwner:U,originalLaneIndex:k,sourceCardId:a.actionRequired.sourceCardId,actor:a.actionRequired.actor,destinationRestriction:a.actionRequired.destinationRestriction,followUpEffect:a.actionRequired.followUpEffect,conditionalType:a.actionRequired.conditionalType};l.actionRequired=D}}i=!1;break}case"delete_self":{const{sourceCardId:L,cardToDeleteId:O,actor:T,logSource:G,logPhase:V,logIndentLevel:z}=a.actionRequired;G!==void 0&&(l=Be(l,G)),V!==void 0&&(l=Ke(l,V)),z!==void 0&&(l._logIndentLevel=z);const U=we(a,O);if(!U){l=ne(l,T,"Card no longer on board. Delete skipped."),l=Ge(l),l.actionRequired=null,i=!0;break}const k=`${U.card.protocol}-${U.card.value}`;l=ne(l,T,`Deleting ${k}.`);const{owner:A,laneIndex:I}=U,$=a[A].lanes[I][a[A].lanes[I].length-1].id===O,q=[...a[A].lanes[I]],M=q.findIndex(D=>D.id===O);q.splice(M,1);const B=[...a[A].lanes];B[I]=q;let W={...a,[A]:{...a[A],lanes:B}};l=Ge(W),l.actionRequired=null;const K={...l.stats[T],cardsDeleted:l.stats[T].cardsDeleted+1};l={...l,stats:{...l.stats,[T]:K}},$&&q.length>0&&(l=Pn(l,A,I).newState),i=!0;break}case"select_cards_to_delete":case"select_face_down_card_to_delete":case"select_low_value_card_to_delete":case"select_card_from_other_lanes_to_delete":{const{sourceCardId:L,actor:O}=a.actionRequired,{logSource:T,logPhase:G,logIndentLevel:V}=a.actionRequired;T!==void 0&&(l=Be(l,T)),G!==void 0&&(l=Ke(l,G)),V!==void 0&&(l._logIndentLevel=V);const z=we(a,L);if(!z||!z.card.isFaceUp){const ue=z?`${z.card.protocol}-${z.card.value}`:"the source card";l=ne(l,O,`Effect from ${ue} was cancelled because the source is no longer active.`),l=Ge(l),l.actionRequired=null,i=!0;break}const U=we(a,t);if(!U)return{nextState:a};const k=a.actionRequired.allowedIds;if(k&&!k.includes(t))return console.error(`Illegal delete: Card ${t} is not in allowedIds - value filter not met`),{nextState:a};if(a.actionRequired.protocolMatching){const ue=a.actionRequired.protocolMatching,re=a[U.owner].lanes.findIndex(ee=>ee.some(X=>X.id===t));if(re!==-1){const ee=a.player.protocols[re],X=a.opponent.protocols[re],le=U.card.protocol,J=le===ee||le===X;if(ue==="must_match"&&!J)return console.error(`Illegal delete: ${le}-${U.card.value} in lane ${re} (protocols: ${ee}/${X}) - card must be in lane with matching protocol`),{nextState:a};if(ue==="must_not_match"&&J)return console.error(`Illegal delete: ${le}-${U.card.value} in lane ${re} (protocols: ${ee}/${X}) - card must be in lane without matching protocol`),{nextState:a}}}const A=a.actionRequired.targetFilter;if((A==null?void 0:A.calculation)==="highest_value"||(A==null?void 0:A.calculation)==="lowest_value"){const ue=A.owner,re=ue==="opponent"?O==="player"?"opponent":"player":ue==="own"?O:U.owner,X=F0(a,re).some(J=>J.card.id===t),le=A.calculation==="highest_value"?"highest":"lowest";if(!X)return console.error(`Illegal delete: Card ${t} is not one of the ${le} value uncovered cards`),{nextState:a}}const I=O==="player"?"Player":"Opponent",$=U.owner==="player"?"Player's":"Opponent's",q=a[U.owner].lanes.findIndex(ue=>ue.some(re=>re.id===t)),M=q!==-1?a[U.owner].protocols[q]:"unknown",B=U.card.isFaceUp?`${U.card.protocol}-${U.card.value}`:`face-down card in Protocol ${M}`,W=we(a,a.actionRequired.sourceCardId),K=W?`${W.card.protocol}-${W.card.value}`:"a card effect";l=ne(l,O,`${K}: ${I} deletes ${$} ${B}.`);const D={...l.stats[O],cardsDeleted:l.stats[O].cardsDeleted+1},Q={...l[O],stats:D};l={...l,[O]:Q,stats:{...l.stats,[O]:D}};const ae=a[U.owner].lanes.findIndex(ue=>ue.some(re=>re.id===t)),Y=a[U.owner].lanes[ae],Z=Y&&Y.length>0&&Y[Y.length-1].id===t;l=Ge(l),l.actionRequired=null,c={animationRequests:[{type:"delete",cardId:t,owner:U.owner}],onCompleteCallback:(ue,re)=>{var et,Je,nt;const ee=a.actionRequired.actor,X=a.actionRequired;let J=Nt(ue,"after_delete",{player:ee}).newState;J=Ge(J);let me=null;const ve=we(J,X.sourceCardId),Se=To(J,X.sourceCardId),Le=X.followUpEffect;if(ve&&ve.card.isFaceUp&&Se){const je=X.remainingLanes;if(X.type==="select_cards_to_delete"&&je&&je.length>0){const Fe=je[0],Ve=je.slice(1);me={type:"select_cards_to_delete",count:((et=X.params)==null?void 0:et.count)||X.count,sourceCardId:X.sourceCardId,actor:X.actor,currentLaneIndex:Fe,remainingLanes:Ve,disallowedIds:(Je=X.params)!=null&&Je.excludeSelf?[X.sourceCardId]:[],targetFilter:X.targetFilter,scope:X.scope,protocolMatching:X.protocolMatching,params:X.params}}else if(X.type==="select_cards_to_delete"&&X.count>1)me={type:"select_cards_to_delete",count:X.count-1,sourceCardId:X.sourceCardId,disallowedIds:[...X.disallowedIds,t],actor:X.actor,followUpEffect:Le};else if(X.type==="select_card_from_other_lanes_to_delete"&&X.count>1){const Fe=a[U.owner].lanes.findIndex(tt=>tt.some(It=>It.id===t)),Ve=[...X.lanesSelected,Fe];[0,1,2].filter(tt=>tt!==X.disallowedLaneIndex&&!Ve.includes(tt)).some(tt=>J.player.lanes[tt].length>0||J.opponent.lanes[tt].length>0)?me={type:"select_card_from_other_lanes_to_delete",count:X.count-1,sourceCardId:X.sourceCardId,disallowedLaneIndex:X.disallowedLaneIndex,lanesSelected:Ve,actor:X.actor}:J=ne(J,X.actor,"No cards left in remaining lanes. Effect skipped.")}}else if("count"in X&&X.count>1){const je=ve?`${ve.card.protocol}-${ve.card.value}`:"the source card",Fe=!ve||!ve.card.isFaceUp?"the source is no longer active":"the source was covered";J=ne(J,X.actor,`Remaining deletes from ${je} were cancelled because ${Fe}.`)}let Ee=!1;if(Z){const je=J,Fe=Pn(je,U.owner,ae),Ve=Fe.newState._interruptedTurn!==void 0;je._interruptedTurn&&!Fe.newState._interruptedTurn&&(Ee=!0);const Oe=[...Fe.newState.queuedActions||[]];me&&(Ve?Oe.push(me):Oe.unshift(me)),J={...Fe.newState,queuedActions:Oe}}else me&&(J.queuedActions=[...J.queuedActions||[],me]);if(Le&&!me)if(J.actionRequired){const je=we(J,X.sourceCardId),Fe=X.actor==="player"?"opponent":"player";let Ve=-1;je&&(Ve=J[je.owner].lanes.findIndex(tt=>tt.some(It=>It.id===X.sourceCardId)));const Oe={cardOwner:X.actor,actor:X.actor,currentTurn:J.turn,opponent:Fe,triggerType:"start"},Rt={type:"execute_remaining_custom_effects",sourceCardId:X.sourceCardId,actor:X.actor,laneIndex:Ve,effects:[Le],context:Oe,logSource:X.logSource,logPhase:X.logPhase,logIndentLevel:X.logIndentLevel??1};J.queuedActions=[...J.queuedActions||[],Rt]}else{const je=we(J,X.sourceCardId),Fe=X.actor==="player"?"opponent":"player";if(je){const Ve=J[je.owner].lanes.findIndex(It=>It.some(Zt=>Zt.id===X.sourceCardId)),Oe={cardOwner:X.actor,actor:X.actor,currentTurn:J.turn,opponent:Fe,triggerType:"start"},Rt=`${je.card.protocol}-${je.card.value}`;J=Be(J,X.logSource||Rt),J=Ke(J,X.logPhase||"start"),J._logIndentLevel=X.logIndentLevel??1,J=ut(je.card,Ve,J,Oe,Le).newState,J=Ge(J)}else(nt=Le.params)!=null&&nt.deleteSelf&&(J=Be(J,X.logSource||"the source card"),J=Ke(J,X.logPhase||"start"),J._logIndentLevel=X.logIndentLevel??1,J=internalDeleteCard(J,X.sourceCardId).newState,J=ne(J,X.actor,"Deletes itself."))}if(J.actionRequired)return J;if(J.queuedActions&&J.queuedActions.length>0){const je=J.queuedActions[0];if((je==null?void 0:je.type)==="execute_remaining_custom_effects"){const Oe=ba(J);return Oe.actionRequired?Oe:re(Oe)}const Fe=[...J.queuedActions],Ve=Fe.shift();if((Ve==null?void 0:Ve.type)==="shift_flipped_card_optional"||(Ve==null?void 0:Ve.type)==="gravity_2_shift_after_flip"){const Oe=we(J,Ve.sourceCardId),Rt=To(J,Ve.sourceCardId);if(!Oe||!Oe.card.isFaceUp||!Rt){const tt=Oe?`${Oe.card.protocol}-${Oe.card.value}`:"the source card";let It=ne(J,Ve.actor,`Shift from ${tt} was cancelled because the source is no longer active.`);if(Fe.length>0){const Zt=Fe.shift();return{...It,actionRequired:Zt,queuedActions:Fe}}else return re({...It,actionRequired:null,queuedActions:[]})}}return{...J,actionRequired:Ve,queuedActions:Fe}}if(Ee){if(J.queuedActions&&J.queuedActions.length>0){const je=[...J.queuedActions],Fe=je.shift();if((Fe==null?void 0:Fe.type)==="execute_remaining_custom_effects"){const Ve={...J,queuedActions:[Fe,...je]},Oe=ba(Ve);return Oe.actionRequired?Oe:J}return{...J,actionRequired:Fe,queuedActions:je}}return J}if(Le&&ve&&ve.card.isFaceUp&&(!((Le.position||"middle")!=="top")||Se)){const Oe=J[ve.owner].lanes.findIndex(En=>En.some(On=>On.id===X.sourceCardId)),Rt=X.actor==="player"?"opponent":"player",tt=Le.trigger||"on_play",It={cardOwner:X.actor,actor:X.actor,currentTurn:J.turn,opponent:Rt,triggerType:tt};if(J=ut(ve.card,Oe,J,It,Le).newState,we(J,X.sourceCardId),J.actionRequired)return J}return re(J)}},i=!1;break}case"plague_4_opponent_delete":{const L=we(a,t);if(!L)return{nextState:a};const O=a.actionRequired.actor;l=ne(l,O,"Plague-4: Opponent deletes one of their face-down cards.");const T={...l.stats[O],cardsDeleted:l.stats[O].cardsDeleted+1},G={...l[O],stats:T};l={...l,[O]:G,stats:{...l.stats,[O]:T}};const V=a[L.owner].lanes.findIndex(k=>k.some(A=>A.id===t)),z=a[L.owner].lanes[V],U=z&&z.length>0&&z[z.length-1].id===t;l=Ge(l),l.actionRequired=null,c={animationRequests:[{type:"delete",cardId:t,owner:L.owner}],onCompleteCallback:(k,A)=>{let $=Nt(k,"after_delete",{player:O}).newState;U&&($=Pn($,L.owner,V).newState);const q=we($,a.actionRequired.sourceCardId),M=(q==null?void 0:q.owner)||a.turn,B={type:"plague_4_player_flip_optional",sourceCardId:a.actionRequired.sourceCardId,optional:!0,actor:M};return $.actionRequired?$.queuedActions=[...$.queuedActions||[],B]:$.actionRequired=B,$}},i=!1;break}case"select_card_to_return":{const{logSource:L,logPhase:O,logIndentLevel:T}=a.actionRequired;L!==void 0&&(l=Be(l,L)),O!==void 0&&(l=Ke(l,O)),T!==void 0&&(l._logIndentLevel=T);const{sourceCardId:G,actor:V}=a.actionRequired,z=(j=a.actionRequired)==null?void 0:j.followUpEffect,U=(C=a.actionRequired)==null?void 0:C.conditionalType,k=(R=a.actionRequired)==null?void 0:R.targetFilter,A=we(a,t);if(A){const $=a[A.owner].lanes[A.laneIndex],q=((F=$[$.length-1])==null?void 0:F.id)===t,M=(k==null?void 0:k.position)==="covered"||(k==null?void 0:k.position)==="any";if(!q&&!M)return console.error(`[cardResolver] Invalid return target: ${A.card.protocol}-${A.card.value} is covered`),{nextState:a,requiresTurnEnd:!1}}const I=Id(a,t);if(l=I.newState,I.animationRequests)c={animationRequests:I.animationRequests,onCompleteCallback:($,q)=>{if($.actionRequired)return $;let M=$;if(z&&G&&(U!=="if_executed"||t)){const W=we(M,G);if(W&&W.card.isFaceUp){const K=M[W.owner].lanes.find(Y=>Y.some(Z=>Z.id===G)),D=M[W.owner].lanes.indexOf(K),Q={cardOwner:W.owner,actor:V,currentTurn:M.turn,opponent:W.owner==="player"?"opponent":"player"};if(M=ut(W.card,D,M,Q,z).newState,M.actionRequired)return M}}return q(M)}};else if(z&&G&&(U!=="if_executed"||t)){const q=we(l,G);if(q&&q.card.isFaceUp){const M=l[q.owner].lanes.find(D=>D.some(Q=>Q.id===G)),B=l[q.owner].lanes.indexOf(M),W={cardOwner:q.owner,actor:V,currentTurn:l.turn,opponent:q.owner==="player"?"opponent":"player"};l=ut(q.card,B,l,W,z).newState}}l=Ge(l),i=!l.actionRequired&&(!l.queuedActions||l.queuedActions.length===0);break}case"select_opponent_card_to_return":{const{sourceCardId:L,actor:O}=a.actionRequired,T=Id(a,t);let G=T.newState;if(G.actionRequired){const V={type:"flip_self",sourceCardId:L,actor:O};G.queuedActions=[V,...G.queuedActions||[]],l=G,i=!1}else{const V=we(G,L);if(V){const z=`${V.card.protocol}-${V.card.value}`;G=ne(G,O,`${z}: Flips itself.`),G=lr(new Set([L]),G),G.animationState={type:"flipCard",cardId:L}}l=G,i=!0}T.animationRequests&&(c={animationRequests:T.animationRequests,onCompleteCallback:(V,z)=>V.actionRequired?V:z(V)}),l=Ge(l),i||(i=!l.actionRequired&&(!l.queuedActions||l.queuedActions.length===0));break}case"select_any_card_to_flip":{const L=we(a,t),{count:O,sourceCardId:T,actor:G}=a.actionRequired,V=we(a,T);if(!V||!V.card.isFaceUp){const k=V?`${V.card.protocol}-${V.card.value}`:"a card";l=ne(a,G,`Effect from ${k} was cancelled because the source is no longer active.`),l=Ge(l),l.actionRequired=null,i=!0;break}let z=null;O>1&&(z={type:"select_any_card_to_flip",count:O-1,sourceCardId:T,actor:G});let U=Ld(a,t,z);if(L&&!L.card.isFaceUp){const k=Ud(U,t),A=k.newState.actionRequired;A&&A!==z&&z&&(k.newState.queuedActions=[...k.newState.queuedActions||[],z]),l=k.newState,k.animationRequests&&(c={animationRequests:k.animationRequests,onCompleteCallback:(I,$)=>I.actionRequired||I.queuedActions&&I.queuedActions.length>0?I:$(I)})}else l=U;l=Ge(l),i=!l.actionRequired&&(!l.queuedActions||l.queuedActions.length===0);break}case"select_board_card_to_reveal_custom":{const{sourceCardId:L,actor:O,followUpAction:T,optional:G}=a.actionRequired,V=O.charAt(0).toUpperCase()+O.slice(1),z=we(a,t);if(!z)return{nextState:a,requiresTurnEnd:!0};const U=z.owner,k=a[U].lanes.findIndex(M=>M.some(B=>B.id===t));if(k===-1)return{nextState:a,requiresTurnEnd:!0};const A=[...a[U].lanes[k]],I=A.findIndex(M=>M.id===t);if(I===-1)return{nextState:a,requiresTurnEnd:!0};A[I]={...A[I],isFaceUp:!0};const $=[...a[U].lanes];$[k]=A,l={...a,[U]:{...a[U],lanes:$}};const q=`${A[I].protocol}-${A[I].value}`;l=ne(l,O,`${V} reveals ${q}.`),l.actionRequired={type:"prompt_shift_or_flip_board_card_custom",sourceCardId:L,revealedCardId:t,followUpAction:T,optional:G!==!1,actor:O},i=!1;break}case"select_phase_effect":{const L=a.actionRequired;if(!L.availableEffects.find(G=>G.cardId===t))return console.warn(`[cardResolver] Invalid phase effect selection: ${t} not in available effects`),{nextState:a};const T=L.phase==="Start"?"_selectedStartEffectId":"_selectedEndEffectId";l[T]=t,l.actionRequired=null,i=!1;break}case"select_card_for_copy_middle":{const L=a.actionRequired;if(!L.validTargetIds.includes(t))return console.warn(`[cardResolver] Invalid copy_middle target: ${t}`),{nextState:a};const O=we(a,t);if(!O)return console.error(`[cardResolver] Target card not found: ${t}`),{nextState:a};const{card:T,owner:G}=O;l[G].lanes.findIndex(I=>I.some($=>$.id===t));const V=Z0(T);if(V.length===0){l=ne(l,L.actor,`${T.protocol}-${T.value} has no middle commands.`),l.actionRequired=null;break}l=ne(l,L.actor,`Copies the middle command of ${T.protocol}-${T.value}.`);const z=we(a,L.sourceCardId),U=z?l[z.owner].lanes.findIndex(I=>I.some($=>$.id===L.sourceCardId)):0,k={cardOwner:L.actor,triggerType:"on_play"};let A=l;for(const I of V){if(I.trigger!=="on_play")continue;const $=z==null?void 0:z.card;if(!$)continue;if(A=ut($,U,A,k,I).newState,A.actionRequired)return{nextState:A,requiresTurnEnd:!1}}A.actionRequired=null,l=A;break}default:return{nextState:a,requiresTurnEnd:!0}}if(!c&&l.actionRequired===null){if(l.queuedActions&&l.queuedActions.length>0){const L=[...l.queuedActions],O=L.shift();if((O==null?void 0:O.type)==="execute_remaining_custom_effects")return{nextState:{...Ge(l),actionRequired:null,queuedActions:[O,...L]},requiresTurnEnd:!1};if((O==null?void 0:O.type)==="shift_flipped_card_optional"||(O==null?void 0:O.type)==="gravity_2_shift_after_flip"){const T=we(l,O.sourceCardId),G=To(l,O.sourceCardId);if(!T||!T.card.isFaceUp||!G){const V=T?`${T.card.protocol}-${T.card.value}`:"the source card",z=ne(l,O.actor,`Shift from ${V} was cancelled because the source is no longer active.`);if(L.length>0){const U=L.shift();return(U==null?void 0:U.type)==="execute_remaining_custom_effects"?{nextState:{...z,queuedActions:[U,...L]},requiresTurnEnd:!1}:{nextState:{...z,actionRequired:U,queuedActions:L},requiresTurnEnd:!1}}else return{nextState:{...z,actionRequired:null,queuedActions:[]},requiresTurnEnd:!0}}}return(O==null?void 0:O.type)==="execute_remaining_custom_effects"?{nextState:{...l,queuedActions:[O,...L]},requiresTurnEnd:!1}:{nextState:{...l,actionRequired:O,queuedActions:L},requiresTurnEnd:!1}}}else!c&&l.actionRequired!==null&&(i=!1);return{nextState:l,requiresAnimation:c,requiresTurnEnd:i}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const gc=(a,t,l,i,c,d=c)=>{const f={...a[c]},u=f.hand.find(A=>A.id===t);if(!u)return{newState:a};if(d===c){const A=Za(a,c,l,i,u.protocol,u);if(!A.allowed)return console.error(`Illegal Move: ${c} tried to play ${u.protocol}-${u.value} - ${A.reason}`),{newState:a}}const p=c==="player"?"opponent":"player",y=a[d==="player"?"opponent":"player"].lanes[l],v=y.length>0?y[y.length-1]:null;if(v&&v.isFaceUp&&v.protocol==="Plague"&&v.value===0)return{newState:a};if(!i&&v&&v.isFaceUp&&v.protocol==="Metal"&&v.value===2)return console.error(`Illegal Move: ${c} tried to play face-down against Metal-2 in lane ${l}`),{newState:a};if(i){const A=a[d].protocols[l],I=f.protocols[l],$=a[p].protocols[l],q=a[p].lanes.flat().some(Y=>Y.isFaceUp&&Y.protocol==="Psychic"&&Y.value===1),M=[...a.player.lanes.flat(),...a.opponent.lanes.flat()].some(Y=>Y.isFaceUp&&Y.protocol==="Anarchy"&&Y.value===1),B=Sc(a),W=a[c].lanes.flat().some(Y=>Y.isFaceUp&&Y.protocol==="Spirit"&&Y.value===1),K=a[c].lanes.some(Y=>{if(Y.length===0)return!1;const Z=Y[Y.length-1];return Z.isFaceUp&&Z.protocol==="Chaos"&&Z.value===3}),D=bc(a,c,l),Q=Ql(a,u);let ae;if(Q?ae=!q:d!==c?ae=u.protocol===A&&!q:M||B?ae=u.protocol!==I&&u.protocol!==$&&!q:ae=(u.protocol===I||u.protocol===$||W||K||D)&&!q,!ae){const Y=M||B?"Non-matching protocol required":"matching protocol required";return console.error(`Illegal Move: ${c} tried to play ${u.protocol}-${u.value} face-up in lane ${l} (${Y}, protocols: player=${I}, opponent=${$})`),{newState:a}}}let x={...a,_committedCardId:t};x=Be(x,void 0),x=Ke(x,void 0),x={...x,_logIndentLevel:0};const w=c==="player"?"Player":"Opponent",S=x[d].protocols[l];let E;if(c==="opponent"&&!i)E=`${w} plays a face-down card into Protocol ${S}.`;else{const A=`${u.protocol}-${u.value}`;E=`${w} plays ${A}`,i||(E+=" face-down"),d!==c?E+=` into ${d==="player"?"Player's":"Opponent's"} Protocol ${S}.`:E+=` into Protocol ${S}.`}x=ne(x,c,E),x=Ka(x);let b={newState:x};const j=x[d].lanes[l];if(j.length>0){const A=j[j.length-1];let $=Nt(x,"on_cover",{player:d,cardId:A.id}).newState;if($[d].lanes[l].some(B=>B.id===A.id)&&A.isFaceUp){const B={cardOwner:d,actor:c,currentTurn:$.turn,opponent:d==="player"?"opponent":"player",triggerType:"cover"};b=Qd(A,l,$,B)}else b={newState:$}}const C=b.newState,R={...u,isFaceUp:i,isRevealed:!1},F={...C[c]},L={...F.stats,cardsPlayed:F.stats.cardsPlayed+1},O=c==="player"?"playerFromHand":"aiFromHand",T=c==="player"?i?"playerFaceUp":"playerFaceDown":i?"aiFaceUp":"aiFaceDown",G=C.detailedGameStats?{...C.detailedGameStats,cardsPlayed:{...C.detailedGameStats.cardsPlayed,[O]:C.detailedGameStats.cardsPlayed[O]+1,[T]:C.detailedGameStats.cardsPlayed[T]+1}}:void 0;let V;if(d===c){const A={...F,hand:F.hand.filter(I=>I.id!==t),lanes:F.lanes.map((I,$)=>$===l?[...I,R]:I),stats:L};V={...C,[c]:A,stats:{...C.stats,[c]:L},detailedGameStats:G}}else{const A={...F,hand:F.hand.filter(q=>q.id!==t),stats:L},I={...C[d]},$={...I,lanes:I.lanes.map((q,M)=>M===l?[...q,R]:q)};V={...C,[c]:A,[d]:$,stats:{...C.stats,[c]:L},detailedGameStats:G}}const z=a.queuedActions||[],U=C.queuedActions||[];if(U===z||U.length===z.length&&U.every((A,I)=>A===z[I])?z.length>0&&(V.queuedActions=z):V.queuedActions=[...z,...U],V.lastPlayedCardId=R.id,V=Ce(V),C.actionRequired||(V={...V,_logIndentLevel:0}),V=Nt(V,"after_play",{player:c,cardId:R.id,laneIndex:l}).newState,C.actionRequired)return i&&(V.queuedEffect={card:R,laneIndex:l}),{newState:V,animationRequests:b.animationRequests};{if(V={...V,_committedCardId:void 0},c==="opponent")return i&&(V.queuedEffect={card:R,laneIndex:l}),{newState:V,animationRequests:b.animationRequests};let A={newState:V};if(i&&!V.actionRequired){const $={cardOwner:d,actor:c,currentTurn:V.turn,opponent:d==="player"?"opponent":"player",triggerType:"play"};A=Kl(R,l,V,$)}const I=[...b.animationRequests||[],...A.animationRequests||[]];return{newState:A.newState,animationRequests:I.length>0?I:void 0}}},Zl=(a,t)=>{let l=Be(a,void 0);return l=Ke(l,void 0),l={...l,_logIndentLevel:0},rx(l,t)},jm=(a,t)=>{if(a.useControlMechanic&&a.controlCardHolder===t){let l=ne(a,t,`${t==="player"?"Player":"Opponent"} has Control and may rearrange protocols before refreshing.`);return l=Ka(l),{...l,controlCardHolder:null,actionRequired:{type:"prompt_use_control_mechanic",sourceCardId:"CONTROL_MECHANIC",actor:t,originalAction:{type:"fill_hand"}}}}return Zl(a,t)};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Od=(a,t)=>{var c,d,f,u,p,m,y,v,x,w,S,E,b,j,C,R,F,L,O;if(!a.actionRequired)return{nextState:a};let l={...a},i=null;switch(a.actionRequired.type){case"select_lane_for_shift_all":{const{cardsToShift:T,validDestinationLanes:G,sourceLaneIndex:V,actor:z,sourceCardId:U}=a.actionRequired;if(!G.includes(t))return console.error(`Illegal shift: Lane ${t} is not a valid destination`),{nextState:a};if(t===V)return console.error(`Illegal shift: Cannot shift to the same lane ${V}`),{nextState:a};let k={...a};const A=[];for(const{cardId:I,owner:$}of T){if(!we(k,I))continue;const M=k[$].lanes.findIndex(K=>K.some(D=>D.id===I));if(M===-1||!Xl(k,M,t).allowed)continue;const W=Ro(k,I,$,t,z);k=W.newState,W.animationRequests&&A.push(...W.animationRequests)}if(l=k,l=Ge(l),(!l.actionRequired||l.actionRequired.type==="select_lane_for_shift_all")&&(l.actionRequired=null),A.length>0){const I=(c=a.actionRequired)==null?void 0:c.followUpEffect,$=(d=a.actionRequired)==null?void 0:d.conditionalType;i={animationRequests:A,onCompleteCallback:(q,M)=>{if(q.actionRequired||q.queuedActions&&q.queuedActions.length>0)return q;let B=q;if(I&&U&&($!=="if_executed"||A.length>0)){const K=we(B,U);if(K&&K.card.isFaceUp){const D=B[K.owner].lanes.find(Z=>Z.some(ue=>ue.id===U)),Q=B[K.owner].lanes.indexOf(D),ae={cardOwner:K.owner,actor:z,currentTurn:B.turn,opponent:K.owner==="player"?"opponent":"player"};if(B=ut(K.card,Q,B,ae,I).newState,B.actionRequired)return B}}return M(B)}}}break}case"select_lane_for_shift":{const{cardToShiftId:T,cardOwner:G,actor:V,sourceEffect:z,originalLaneIndex:U,sourceCardId:k}=a.actionRequired;if(t===U)return console.error(`Illegal shift: Cannot shift to the same lane ${U}`),{nextState:a};const A=a.actionRequired.validLanes;if(A&&!A.includes(t))return console.error(`Illegal shift: Lane ${t} not in valid lanes ${A}`),{nextState:a};const I=we(a,k),$=we(a,T);if(I&&I.card.protocol==="Anarchy"&&I.card.value===1&&$&&$.card.isFaceUp){const W=a.player.protocols[t],K=a.opponent.protocols[t],D=$.card.protocol;if(D===W||D===K)return console.error(`Illegal Anarchy-1 shift: ${D}-${$.card.value} cannot be shifted to lane ${t} (protocols: ${W}/${K}) - matching protocol not allowed`),{nextState:a}}if(I&&I.card.protocol==="Gravity"&&I.card.value===1){let W=-1;for(let K=0;K<a[I.owner].lanes.length;K++)if(a[I.owner].lanes[K].some(D=>D.id===k)){W=K;break}if(W!==-1&&!(U===W)&&!(t===W))return console.error(`Illegal Gravity-1 shift: Must shift to or from Gravity lane ${W}, but tried ${U}  ${t}`),{nextState:a}}if(a.actionRequired.destinationRestriction&&$){const W=a.actionRequired.destinationRestriction;if(W.type==="non_matching_protocol"&&$.card.isFaceUp){const K=a.player.protocols[t],D=a.opponent.protocols[t],Q=$.card.protocol;if(Q===K||Q===D)return console.error(`Illegal shift: ${Q} cannot be shifted to lane ${t} (protocols: ${K}/${D}) - matching protocol not allowed`),{nextState:a}}if(W.type==="to_or_from_this_lane"){const K=W.laneIndex==="current"&&I?(()=>{for(let D=0;D<a[I.owner].lanes.length;D++)if(a[I.owner].lanes[D].some(Q=>Q.id===k))return D;return-1})():W.laneIndex;if(K!==void 0&&K!==-1&&!(U===K)&&!(t===K))return console.error(`Illegal shift: Must shift to or from lane ${K}, but tried ${U}  ${t}`),{nextState:a}}}const q=Xl(a,U,t);if(!q.allowed)return console.error(`Illegal shift: Cannot shift from lane ${U} to ${t} - ${q.reason}`),{nextState:a};const M=Ro(a,T,G,t,V);l=M.newState;const B=l.actionRequired!==null;if(M.animationRequests)i={animationRequests:M.animationRequests,onCompleteCallback:(W,K)=>{var ue,re,ee,X;let D=W;if(B){if(z==="speed_3_end"){const Se={type:"speed_3_self_flip_after_shift",sourceCardId:a.actionRequired.sourceCardId,actor:V};D.queuedActions=[...D.queuedActions||[],Se]}const le=(ue=a.actionRequired)==null?void 0:ue.followUpEffect,J=(re=a.actionRequired)==null?void 0:re.conditionalType;if(le&&k&&(J!=="if_executed"||T)){const Se=we(D,k),Le=a._currentPhaseContext||(a.phase==="start"?"start":"end"),Ee={type:"execute_follow_up_effect",sourceCardId:k,followUpEffect:le,actor:V,logContext:{indentLevel:1,sourceCardName:Se?`${Se.card.protocol}-${Se.card.value}`:void 0,phase:Le}};D.queuedActions=[...D.queuedActions||[],Ee]}we(D,k);const me=D._pendingCustomEffects;if(me){const ve=we(D,me.sourceCardId);if(ve&&ve.card.isFaceUp){const Se=D[ve.owner].lanes.find(Ee=>Ee.some(lt=>lt.id===me.sourceCardId));if(Se&&Se.length>0&&Se[Se.length-1].id===me.sourceCardId){const Ee={type:"execute_remaining_custom_effects",sourceCardId:me.sourceCardId,laneIndex:me.laneIndex,effects:me.effects,context:me.context,actor:V,logSource:me.logSource,logPhase:me.logPhase,logIndentLevel:me.logIndentLevel};D.queuedActions=[Ee,...D.queuedActions||[]]}}delete D._pendingCustomEffects}return D}if(z==="speed_3_end"){const le=a.actionRequired.sourceCardId;D=ne(D,V,"Speed-3: Flipping itself after shifting a card."),D=lr(new Set([le]),D),D.animationState={type:"flipCard",cardId:le}}const Q=D._pendingCustomEffects;if(Q){const le=we(D,Q.sourceCardId);if(le&&le.card.isFaceUp){const J=D[le.owner].lanes.find(ve=>ve.some(Se=>Se.id===Q.sourceCardId));if(J&&J.length>0&&J[J.length-1].id===Q.sourceCardId){for(const ve of Q.effects)D=ut(le.card,Q.laneIndex,D,Q.context,ve).newState;delete D._pendingCustomEffects}else D=ne(D,V,"Pending effects cancelled because source card is now covered."),delete D._pendingCustomEffects}else delete D._pendingCustomEffects}k&&(D=Ao(D)),D=Nt(D,"after_shift",{player:V,cardId:T}).newState;const Y=(ee=a.actionRequired)==null?void 0:ee.followUpEffect,Z=(X=a.actionRequired)==null?void 0:X.conditionalType;if(Y&&k&&(Z!=="if_executed"||T)){const J=we(D,k);if(J&&J.card.isFaceUp){const me=D[J.owner].lanes.find(et=>et.some(Je=>Je.id===k)),ve=D[J.owner].lanes.indexOf(me),Se={cardOwner:J.owner,actor:V,currentTurn:D.turn,opponent:J.owner==="player"?"opponent":"player"},Le=`${J.card.protocol}-${J.card.value}`,Ee=a._currentPhaseContext||(a.phase==="start"?"start":"end");D={...D,_logIndentLevel:1,_currentEffectSource:Le,_currentPhaseContext:Ee},D=ut(J.card,ve,D,Se,Y).newState}}if(D=Ge(D),D.actionRequired=null,D.queuedActions&&D.queuedActions.length>0){const le=D.queuedActions[0];le.type==="execute_remaining_custom_effects"?(D=ba(D),D.animationState&&(D={...D,animationState:null})):(D.queuedActions=D.queuedActions.slice(1),D.actionRequired=le)}return D._interruptedTurn?Zr(D):K(D)}};else if(B){if(z==="speed_3_end"){const Q={type:"speed_3_self_flip_after_shift",sourceCardId:a.actionRequired.sourceCardId,actor:V};l.queuedActions=[...l.queuedActions||[],Q]}const W=(f=a.actionRequired)==null?void 0:f.followUpEffect,K=(u=a.actionRequired)==null?void 0:u.conditionalType;if(W&&k&&(K!=="if_executed"||T)){const Q=we(l,k),ae=a._currentPhaseContext||(a.phase==="start"?"start":"end"),Y={type:"execute_follow_up_effect",sourceCardId:k,followUpEffect:W,actor:V,logContext:{indentLevel:1,sourceCardName:Q?`${Q.card.protocol}-${Q.card.value}`:void 0,phase:ae}};l.queuedActions=[...l.queuedActions||[],Y]}}else{if(z==="speed_3_end"){const ae=a.actionRequired.sourceCardId;l=ne(l,V,"Speed-3: Flipping itself after shifting a card."),l=lr(new Set([ae]),l),l.animationState={type:"flipCard",cardId:ae}}const W=l._pendingCustomEffects;if(W){const ae=we(l,W.sourceCardId);if(ae&&ae.card.isFaceUp){const Y=l[ae.owner].lanes.find(ue=>ue.some(re=>re.id===W.sourceCardId));if(Y&&Y.length>0&&Y[Y.length-1].id===W.sourceCardId){for(const ue of W.effects)l=ut(ae.card,W.laneIndex,l,W.context,ue).newState;delete l._pendingCustomEffects}else l=ne(l,V,"Pending effects cancelled because source card is now covered."),delete l._pendingCustomEffects}else delete l._pendingCustomEffects}k&&(l=Ao(l)),l=Nt(l,"after_shift",{player:V,cardId:T}).newState;const D=(p=a.actionRequired)==null?void 0:p.followUpEffect,Q=(m=a.actionRequired)==null?void 0:m.conditionalType;if(D&&k&&(Q!=="if_executed"||T)){const Y=we(l,k);if(Y&&Y.card.isFaceUp){const Z=l[Y.owner].lanes.find(J=>J.some(me=>me.id===k)),ue=l[Y.owner].lanes.indexOf(Z),re={cardOwner:Y.owner,actor:V,currentTurn:l.turn,opponent:Y.owner==="player"?"opponent":"player"},ee=`${Y.card.protocol}-${Y.card.value}`,X=a._currentPhaseContext||(a.phase==="start"?"start":"end");l={...l,_logIndentLevel:1,_currentEffectSource:ee,_currentPhaseContext:X},l=ut(Y.card,ue,l,re,D).newState}}if(l=Ge(l),l.actionRequired=null,l.queuedActions&&l.queuedActions.length>0){const ae=l.queuedActions[0];if(ae.type==="execute_remaining_custom_effects"){if(l=ba(l),l.animationState&&!l.actionRequired){const Y=l.animationState;Y.type==="draw"&&(i={animationRequests:[{type:"draw",player:Y.player,count:Y.count}],onCompleteCallback:(Z,ue)=>{const re={...Z,animationState:null};return ue(re)}},l={...l,animationState:null})}}else l.queuedActions=l.queuedActions.slice(1),l.actionRequired=ae}}break}case"shift_flipped_card_optional":{const T=a.actionRequired.cardId,G=a.actionRequired.actor;let V=null;for(const I of["player","opponent"])if(a[I].lanes.flat().some($=>$.id===T)){V=I;break}if(!V){console.error("[shift_flipped_card_optional] Card not found on board:",T),l=a;break}const z=(y=a.actionRequired)==null?void 0:y.followUpEffect,U=(v=a.actionRequired)==null?void 0:v.conditionalType,k=(x=a.actionRequired)==null?void 0:x.sourceCardId,A=Ro(a,T,V,t,G);if(l=A.newState,z&&k&&(U!=="if_executed"||T)){const $=we(l,k),q=a._currentPhaseContext||(a.phase==="start"?"start":"end"),M={type:"execute_follow_up_effect",sourceCardId:k,followUpEffect:z,actor:G,logContext:{indentLevel:1,sourceCardName:$?`${$.card.protocol}-${$.card.value}`:void 0,phase:q}};l={...l,queuedActions:[...l.queuedActions||[],M]}}A.animationRequests&&(i={animationRequests:A.animationRequests,onCompleteCallback:(I,$)=>$(I)});break}case"select_lane_for_play":{const{cardInHandId:T,isFaceDown:G,actor:V,source:z,disallowedLaneIndex:U,validLanes:k,preSelectedLane:A}=a.actionRequired,I=A!==void 0?A:t;if(U!==void 0&&I===U)return{nextState:a,requiresTurnEnd:!1};if(k&&!k.includes(I))return{nextState:a,requiresTurnEnd:!1};if(z==="deck"){const K=(w=a.actionRequired)==null?void 0:w.followUpEffect;(S=a.actionRequired)==null||S.conditionalType;const D=(E=a.actionRequired)==null?void 0:E.sourceCardId,Q=(b=a.actionRequired)==null?void 0:b.preDrawnCard,ae={...a,actionRequired:null},Y=ae[V];let Z,ue=Y.deck,re=Y.discard;if(Q)Z={...Q,isFaceUp:!G};else{const me=Un(Y.deck,Y.discard,1);if(ue=me.remainingDeck,re=me.newDiscard,me.drawnCards.length===0){console.error("No cards in deck/discard to play"),l=ae;break}Z={...me.drawnCards[0],id:Ze(),isFaceUp:!G}}const ee=[...Y.lanes];ee[I]=[...ee[I],Z];const X={...Y,lanes:ee,deck:ue,discard:re};l={...ae,[V]:X,lastCustomEffectTargetCardId:Z.id};const le=V==="player"?"Player":"Opponent",J=G?"face-down":"face-up";l=ne(l,V,`${le} plays ${Z.protocol}-${Z.value} ${J} from deck.`),i={animationRequests:[{type:"play",cardId:Z.id,owner:V,laneIndex:I,isFaceUp:Z.isFaceUp}],onCompleteCallback:(me,ve)=>{let Se=me;if(K&&D){const Le=we(Se,D);if(Le&&Le.card.isFaceUp){const Ee=Se[Le.owner].lanes.find(nt=>nt.some(je=>je.id===D)),lt=Se[Le.owner].lanes.indexOf(Ee),et={cardOwner:Le.owner,actor:V,currentTurn:Se.turn,opponent:Le.owner==="player"?"opponent":"player"};if(Se=ut(Le.card,lt,Se,et,K).newState,Se.actionRequired)return Se}}return ve(Se)}};break}const $=a[V].hand.find(K=>K.id===T);if(!$){console.error("Card for play not found in hand"),l={...a,actionRequired:null};break}const q={...a,actionRequired:null};let M;if(typeof G=="boolean")M=!G;else{const K=a[V].lanes.flat().some(Y=>Y.isFaceUp&&Y.protocol==="Spirit"&&Y.value===1),D=a[V].lanes.some(Y=>{if(Y.length===0)return!1;const Z=Y[Y.length-1];return Z.isFaceUp&&Z.protocol==="Chaos"&&Z.value===3}),Q=V==="player"?"opponent":"player",ae=a[Q].lanes.flat().some(Y=>Y.isFaceUp&&Y.protocol==="Psychic"&&Y.value===1);M=(K||D||$.protocol===a[V].protocols[I]||$.protocol===a[Q].protocols[I])&&!ae}const{newState:B,animationRequests:W}=gc(q,T,I,M,V);l=B,W&&(i={animationRequests:W,onCompleteCallback:(K,D)=>(K.queuedActions&&K.queuedActions.length>0,D(K))});break}case"select_lane_for_delete":{const T=a.actionRequired.actor,G=T==="player"?"Player":"Opponent",V=a.player.protocols[t],z=a.actionRequired.targetFilter||{},U=we(a,a.actionRequired.sourceCardId),k=U?`${U.card.protocol}-${U.card.value}`:"a card effect",A=a.actionRequired.count||1,I=a.actionRequired.deleteAll===!0,$=a.actionRequired.validLanes;if($&&!$.includes(t))return console.error(`Illegal delete lane selection: Lane ${t} not in valid lanes ${$}`),{nextState:a};l=ne(l,T,`${k}: ${G} targets Protocol ${V}.`);const q=new Map;for(const K of["player","opponent"]){const D=a[K].lanes[t];q.set(K,D.length>0?D[D.length-1].id:null)}const M=[],B=[],W=new Set;for(const K of["player","opponent"]){const D=a[K],Q=D.lanes[t].some(Y=>Y.isFaceUp&&Y.protocol==="Darkness"&&Y.value===2)?4:2,ae=D.lanes[t];for(let Y=0;Y<ae.length;Y++){const Z=ae[Y],ue=Y===ae.length-1,re=Z.isFaceUp?Z.value:Q;if(z.valueRange){const{min:le,max:J}=z.valueRange;if(re<le||re>J)continue}if(z.faceState==="face_up"&&!Z.isFaceUp||z.faceState==="face_down"&&Z.isFaceUp||z.owner==="own"&&K!==T||z.owner==="opponent"&&K===T||z.position==="uncovered"&&!ue||z.position==="covered"&&ue)continue;M.push({type:"delete",cardId:Z.id,owner:K}),W.add(Z.id);const ee=K==="player"?"Player's":"Opponent's",X=Z.isFaceUp?`${Z.protocol}-${Z.value}`:"a face-down card";if(B.push(`${ee} ${X}`),!I&&M.length>=A)break}if(!I&&M.length>=A)break}if(B.length>0){l=ne(l,T,`${k}: Deleting ${B.join(", ")}.`);const K={...l.stats[T],cardsDeleted:l.stats[T].cardsDeleted+B.length},D={...l[T],stats:K};l={...l,[T]:D,stats:{...l.stats,[T]:K}}}if(l=Ge(l),l.actionRequired=null,M.length>0){const K=(j=a.actionRequired)==null?void 0:j.followUpEffect,D=(C=a.actionRequired)==null?void 0:C.conditionalType,Q=a.actionRequired.sourceCardId;i={animationRequests:M,onCompleteCallback:(ae,Y)=>{let Z=ae;Z=Nt(Z,"after_delete",{player:T}).newState;const re=[];for(const ee of["player","opponent"]){const X=q.get(ee),le=Z[ee].lanes[t];X&&W.has(X)&&le.length>0&&re.push(ee)}for(let ee=0;ee<re.length;ee++){const X=re[ee];if(Z=Pn(Z,X,t).newState,Z.actionRequired&&ee<re.length-1){const J=re.slice(ee+1);for(const me of J)Z.queuedActions=[...Z.queuedActions||[],{type:"pending_uncover_effect",owner:me,laneIndex:t}];return Z}}if(K&&Q&&(D!=="if_executed"||M.length>0)){const X=we(Z,Q);if(X&&X.card.isFaceUp){const le=Z[X.owner].lanes.find(Se=>Se.some(Le=>Le.id===Q)),J=Z[X.owner].lanes.indexOf(le),me={cardOwner:X.owner,actor:T,currentTurn:Z.turn,opponent:X.owner==="player"?"opponent":"player"};if(Z=ut(X.card,J,Z,me,K).newState,Z.actionRequired)return Z}}return Y(Z)}}}break}case"select_lane_for_return":{const T=a.actionRequired.actor,G=T==="player"?"Player":"Opponent",V=a.player.protocols[t],z=a.actionRequired.targetFilter||{},U=we(a,a.actionRequired.sourceCardId),k=U?`${U.card.protocol}-${U.card.value}`:"a card effect";l=ne(l,T,`${k}: ${G} targets Protocol ${V}.`);const A=[],I=[];for(const $ of["player","opponent"]){const q=a[$],M=q.lanes[t].some(B=>B.isFaceUp&&B.protocol==="Darkness"&&B.value===2)?4:2;for(const B of q.lanes[t]){const W=B.isFaceUp?B.value:M;if(z.valueEquals!==void 0&&W!==z.valueEquals||z.faceState==="face_up"&&!B.isFaceUp||z.faceState==="face_down"&&B.isFaceUp||z.owner==="own"&&$!==T||z.owner==="opponent"&&$===T)continue;A.push({type:"return",cardId:B.id,owner:$});const K=$==="player"?"Player's":"Opponent's",D=B.isFaceUp?`${B.protocol}-${B.value}`:"a face-down card";I.push(`${K} ${D}`)}}if(A.length===0){l=ne(l,T,`${k}: No matching cards in Protocol ${V}.`),l=Ge(l),l.actionRequired=null;break}if(I.length>0&&(l=ne(l,T,`${k}: Returning ${I.join(", ")}.`)),l=Ge(l),l.actionRequired=null,A.length>0){const $=(R=a.actionRequired)==null?void 0:R.followUpEffect,q=(F=a.actionRequired)==null?void 0:F.conditionalType,M=a.actionRequired.sourceCardId;i={animationRequests:A,onCompleteCallback:(B,W)=>{let K=B;if($&&M&&(q!=="if_executed"||A.length>0)){const Q=we(K,M);if(Q&&Q.card.isFaceUp){const ae=K[Q.owner].lanes.find(re=>re.some(ee=>ee.id===M)),Y=K[Q.owner].lanes.indexOf(ae),Z={cardOwner:Q.owner,actor:T,currentTurn:K.turn,opponent:Q.owner==="player"?"opponent":"player"};if(K=ut(Q.card,Y,K,Z,$).newState,K.actionRequired)return K}}return W(K)}}}break}case"select_lane_for_delete_all":{const T=a.actionRequired.actor,G=T==="player"?"Player":"Opponent",V=a.player.protocols[t],z=a.actionRequired.minCards||8;if(!(a.actionRequired.validLanes||[0,1,2]).includes(t)){l=ne(l,T,"Cannot select this lane for deletion.");break}const k=a.player.lanes[t].length+a.opponent.lanes[t].length;if(k<z){l=ne(l,T,`Cannot delete ${V} line (only ${k} cards, need ${z}+).`),l=Ge(l),l.actionRequired=null;break}const A=we(a,a.actionRequired.sourceCardId),I=A?`${A.card.protocol}-${A.card.value}`:"Effect";l=ne(l,T,`${I}: ${G} deletes all cards in ${V} line.`);const $=[];for(const B of["player","opponent"])for(const W of a[B].lanes[t])$.push({type:"delete",cardId:W.id,owner:B});const q={...l.stats[T],cardsDeleted:l.stats[T].cardsDeleted+$.length},M={...l[T],stats:q};if(l={...l,[T]:M,stats:{...l.stats,[T]:q}},l=Ge(l),l.actionRequired=null,$.length>0){const B=(L=a.actionRequired)==null?void 0:L.followUpEffect,W=(O=a.actionRequired)==null?void 0:O.conditionalType,K=a.actionRequired.sourceCardId;i={animationRequests:$,onCompleteCallback:(D,Q)=>{let ae=D;if(ae=Nt(ae,"after_delete",{player:T}).newState,B&&K&&(W!=="if_executed"||$.length>0)){const ue=we(ae,K);if(ue&&ue.card.isFaceUp){const re=ae[ue.owner].lanes.find(J=>J.some(me=>me.id===K)),ee=ae[ue.owner].lanes.indexOf(re),X={cardOwner:ue.owner,actor:T,currentTurn:ae.turn,opponent:ue.owner==="player"?"opponent":"player"};if(ae=ut(ue.card,ee,ae,X,B).newState,ae.actionRequired)return ae}}return Q(ae)}}}break}case"select_lane_to_shift_revealed_board_card_custom":{const{revealedCardId:T,actor:G}=a.actionRequired,V=we(a,T);if(V){const z=Ro(a,T,V.owner,t,G);l=z.newState,z.animationRequests&&(i={animationRequests:z.animationRequests,onCompleteCallback:(U,k)=>U.actionRequired?U:k(U)})}break}case"select_lanes_for_swap_stacks":{const{actor:T,sourceCardId:G,validLanes:V,selectedFirstLane:z}=a.actionRequired;if(!V.includes(t))return console.error(`Illegal swap_stacks: Lane ${t} is not a valid selection`),{nextState:a};if(z===void 0)l.actionRequired={type:"select_lanes_for_swap_stacks",actor:T,sourceCardId:G,validLanes:V.filter(U=>U!==t),selectedFirstLane:t},l=ne(l,T,`Selected lane ${t+1} for swap.`);else{const U=z,k=t,A=[...l[T].lanes[U]],I=[...l[T].lanes[k]];l[T].lanes[U]=I,l[T].lanes[k]=A,l=ne(l,T,`Swapped all cards between lane ${U+1} and lane ${k+1}.`),l.actionRequired=null}break}default:return{nextState:a}}return{nextState:Ce(l),requiresAnimation:i}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Kh=(a,t)=>{if(a.processedSpeed1TriggerThisTurn)return a;if(a[t].lanes.flat().some(c=>c.isFaceUp&&c.protocol==="Speed"&&c.value===1)){let c={...a};return c=Be(c,"Speed-1"),c=Ke(c,void 0),c=ne(c,t,"Triggers after clearing cache: Draw 1 card."),c=cr(c,t,1),c.processedSpeed1TriggerThisTurn=!0,c=Be(c,void 0),c.phase="end",c}return a},rr=(a,t,l)=>{var G,V,z,U;const i=a[l],c=new Set(t),d=i.hand.filter(k=>c.has(k.id));if(d.length===0)return a;const f=i.hand.filter(k=>!c.has(k.id)),u=[...i.discard,...d.map(({id:k,isFaceUp:A,...I})=>I)],p=((G=a.animationState)==null?void 0:G.type)==="discardCard"&&((V=a.animationState.originalAction)==null?void 0:V.type)==="discard"?a.animationState.originalAction:((z=a.actionRequired)==null?void 0:z.type)==="discard"?a.actionRequired:null,m={...i.stats,cardsDiscarded:i.stats.cardsDiscarded+d.length},y={...i,hand:f,discard:u,stats:m},v=p==null?void 0:p.followUpEffect,x=p==null?void 0:p.conditionalType,w=p==null?void 0:p.previousHandSize;let S={...a,[l]:y,stats:{...a.stats,[l]:m},actionRequired:v?{type:"discard_completed",followUpEffect:v,conditionalType:x,previousHandSize:w,sourceCardId:p==null?void 0:p.sourceCardId,actor:l}:null};if(p!=null&&p.sourceCardId){const k=S.player.lanes.flat().find(A=>A.id===p.sourceCardId)||S.opponent.lanes.flat().find(A=>A.id===p.sourceCardId);if(k){const A=`${k.protocol}-${k.value}`;S=Be(S,A),S=Ke(S,"middle")}else S=Be(S,void 0),S=Ke(S,void 0),S={...S,_logIndentLevel:0}}else S=Be(S,void 0),S=Ke(S,void 0);const E=l==="player"?"Player":"Opponent";let b;if(l==="player"||d.every(k=>k.isRevealed)){const k=d.map(A=>`${A.protocol}-${A.value}`).join(", ");b=`${E} discards ${k}.`}else{const k=d.length===1?"card":"cards";b=`${E} discards ${d.length} ${k}.`}S=ne(S,l,b);const j=(k,A)=>{var W;const I=a.phase==="hand_limit"&&!(A!=null&&A.sourceCardId);let $=k;return I&&($=Ao($),$=Kh($,l),$=Nt($,"after_clear_cache",{player:l}).newState,((W=$.processedClearCacheTriggerIds)==null?void 0:W.length)>0&&($.phase="end")),$=wm($,l,A==null?void 0:A.sourceEffect,A==null?void 0:A.sourceCardId),$=Nt($,"after_discard",{player:l}).newState,$=Nt($,"after_opponent_discard",{player:l==="player"?"opponent":"player"}).newState,$};if(p&&p.actor===l){const k=p.count-t.length;return k>0?(S.actionRequired={...p,count:k},S):j(S,p)}const C=a.actionRequired;if(C&&C.type==="discard"&&C.actor===l){const k=C.count-t.length;return k>0?(S.actionRequired={...C,count:k},S):j(S,C)}const R=a.phase==="hand_limit";S=Nt(S,"after_discard",{player:l}).newState;let T=Nt(S,"after_opponent_discard",{player:l==="player"?"opponent":"player"}).newState;return R&&(T=Kh(T,l),T=Nt(T,"after_clear_cache",{player:l}).newState,((U=T.processedClearCacheTriggerIds)==null?void 0:U.length)>0&&(T.phase="end")),T},ux=(a,t)=>{var f;if(((f=a.actionRequired)==null?void 0:f.type)!=="plague_2_player_discard")return a;const l=a.actionRequired.actor,i=l==="player"?"opponent":"player";let c=rr(a,t,l);const d=t.length+1;return c[i].hand.length>0?c.actionRequired={type:"discard",actor:i,count:Math.min(d,c[i].hand.length),sourceCardId:a.actionRequired.sourceCardId}:(c=Ge(c),c.actionRequired=null),c},Ad=(a,t)=>{var f;if(((f=a.actionRequired)==null?void 0:f.type)!=="plague_2_opponent_discard")return a;const l=a.actionRequired.actor,i=l==="player"?"opponent":"player";let c=rr(a,t,l);const d=t.length+1;return c[i].hand.length>0?c.actionRequired={type:"discard",actor:i,count:Math.min(d,c[i].hand.length),sourceCardId:a.actionRequired.sourceCardId}:(c=Ge(c),c.actionRequired=null),c},Jh=(a,t)=>{var p,m,y;const l=((p=a.actionRequired)==null?void 0:p.type)==="discard"&&((m=a.actionRequired)==null?void 0:m.variableCount),i=((y=a.actionRequired)==null?void 0:y.type)==="select_cards_from_hand_to_discard_for_fire_4";if(!l&&!i)return a;const c=a.actionRequired.actor,d=a.actionRequired.sourceCardId;let f=rr(a,t,c);if(l&&d)return wm(f,c,void 0,d);const u=t.length+1;return f=ne(f,c,`Fire-4: Drawing ${u} card(s).`),f=cr(f,c,u),f},Dd=(a,t)=>{var p;if(((p=a.actionRequired)==null?void 0:p.type)!=="select_cards_from_hand_to_discard_for_hate_1")return a;const{sourceCardId:l,actor:i}=a.actionRequired;let c=rr(a,t,i);const f=D0(c,[]),u=Math.min(2,f);return u>0?c.actionRequired={type:"select_cards_to_delete",count:u,sourceCardId:l,disallowedIds:[],actor:i}:(c=ne(c,i,"Hate-1: No valid targets to delete."),c=Ge(c),c.actionRequired=null),c};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Wl=(a,t,l)=>{const i=a.turn,c=i==="player"?"opponent":"player";let d={...a};if(d.compileBlockedPlayer===i&&d.compileBlockedUntilTurn>(d.turnNumber||0))return d=ne(d,i,`${i==="player"?"Player":"Opponent"} can't compile - blocked by opponent's effect.`),d;if(d.useControlMechanic&&d.controlCardHolder===i){const k=i==="player"?"Player":"Opponent";return d=Be(d,void 0),d=Ke(d,void 0),d={...d,_logIndentLevel:0},d=ne(d,i,`${k} has Control and may rearrange protocols before compiling.`),d=Ka(d),d.actionRequired={type:"prompt_use_control_mechanic",sourceCardId:"CONTROL_MECHANIC",actor:i,originalAction:{type:"compile",laneIndex:t}},d.controlCardHolder=null,d}let p={...d[i]},m={...d[c]};const y=p.compiled[t],v=[];for(const k of[i,c])d[k].lanes[t].forEach(I=>{if(I.isFaceUp){const $=I;$.customEffects&&$.customEffects.topEffects&&$.customEffects.topEffects.some(M=>M.trigger==="before_compile_delete")&&v.push({card:I,owner:k})}});for(const{card:k,owner:A}of v)d=Nt(d,"before_compile_delete",{player:A,cardId:k.id}).newState;p={...d[i]},m={...d[c]};const x=k=>{if(k.protocol==="Speed"&&k.value===2&&k.isFaceUp)return!0;const A=k;return A.customEffects&&A.customEffects.topEffects&&k.isFaceUp?A.customEffects.topEffects.some(I=>{var $,q;return I.trigger==="before_compile_delete"&&(($=I.params)==null?void 0:$.action)==="shift"&&((q=I.params)==null?void 0:q.shiftSelf)===!0}):!1},w=[],S=[],E=p.lanes[t].filter(k=>x(k)?(w.push(k),!1):!0),b=m.lanes[t].filter(k=>x(k)?(S.push(k),!1):!0),j={...p.stats},C={...m.stats};p.discard=[...p.discard,...E.map(({id:k,isFaceUp:A,...I})=>I)],m.discard=[...m.discard,...b.map(({id:k,isFaceUp:A,...I})=>I)];const R=[...p.lanes];R[t]=w,p.lanes=R;const F=[...m.lanes];F[t]=S,m.lanes=F;const L=[...p.compiled];if(L[t]=!0,p.compiled=L,d={...d,[i]:p,[c]:m,stats:{...d.stats,[i]:j,[c]:C}},d.detailedGameStats){const k=y,A=i==="player"?k?"playerRecompile":"playerFirstCompile":k?"aiRecompile":"aiFirstCompile";d={...d,detailedGameStats:{...d.detailedGameStats,compiles:{...d.detailedGameStats.compiles,[A]:d.detailedGameStats.compiles[A]+1}}}}d=Be(d,void 0),d=Ke(d,void 0),d={...d,_logIndentLevel:0};const O=i==="player"?"Player":"Opponent",T=p.protocols[t];if(d=ne(d,i,`${O} compiles Protocol ${T}!`),y&&(d=ne(d,i,`${O} draws 1 card from the opponent's deck as a re-compile reward.`),d=ox(d,i,1)),d=Ce(d),p.compiled.every(k=>k===!0))return d.winner=i,l(i,d),d;E.length+b.length>0&&(d=Nt(d,"after_delete",{player:i}).newState);const U=[...w,...S].map(k=>{const A=we(d,k.id).owner,I=k.isFaceUp?`${k.protocol}-${k.value}`:"Card";return d=ne(d,A,`${I} survives compilation and must be shifted.`),{type:"select_lane_for_shift",cardToShiftId:k.id,cardOwner:A,originalLaneIndex:t,sourceCardId:k.id,actor:A}});if(U.length>0){const k=U.shift();d.actionRequired=k,d.queuedActions=U,k.actor!==i&&(d._interruptedTurn=i,d._interruptedPhase=d.phase,d.turn=k.actor)}else d.actionRequired=null,d.queuedActions=[];return d},km=(a,t)=>a,px=(a,t)=>{var w;if(((w=a.actionRequired)==null?void 0:w.type)!=="select_card_from_hand_to_play")return a;const{disallowedLaneIndex:l,sourceCardId:i,isFaceDown:c,actor:d,destinationRule:f,condition:u,faceDown:p,targetLaneIndex:m,validLanes:y,selectableCardIds:v,valueFilter:x}=a.actionRequired;return v&&!v.includes(t)?a:m!==void 0?{...a,actionRequired:{type:"select_lane_for_play",cardInHandId:t,sourceCardId:i,isFaceDown:c||p,actor:d,source:"hand",preSelectedLane:m}}:{...a,actionRequired:{type:"select_lane_for_play",cardInHandId:t,disallowedLaneIndex:l,sourceCardId:i,isFaceDown:c||p,actor:d,destinationRule:f,condition:u,validLanes:y}}},em=a=>{if(!a.actionRequired||!("optional"in a.actionRequired)||!a.actionRequired.optional)return a;const t="actor"in a.actionRequired?a.actionRequired.actor:a.turn,l=t==="player"?"Player":"Opponent";let i={...a,actionRequired:null};return i=ne(i,t,`${l} skips the optional action.`),i},tm=a=>{var d;if(((d=a.actionRequired)==null?void 0:d.type)!=="reveal_opponent_hand")return a;const t=a.actionRequired.actor,l=t==="player"?"opponent":"player";let i={...a};const c={...i[l]};if(c.hand.length>0){c.hand=c.hand.map(p=>({...p,isRevealed:!0})),i[l]=c;const f=we(i,a.actionRequired.sourceCardId),u=f?`${f.card.protocol}-${f.card.value}`:"A card effect";i=ne(i,t,`${u}: Opponent reveals their hand.`)}return i.actionRequired=null,i},nm=(a,t)=>Ld(a,t),am=(a,t)=>Id(a,t).newState,Nm=(a,t)=>{var v;if(((v=a.actionRequired)==null?void 0:v.type)!=="select_card_from_revealed_deck")return a;const i=a.actionRequired.actor,c=i==="player"?"Player":"Opponent";let d={...a};const f={...d[i]},u=[...f.deck],p=u.findIndex(x=>(x.id||`deck-${u.indexOf(x)}`)===t);if(p===-1)return console.warn(`[resolveSelectRevealedDeckCard] Card ${t} not found in deck`),d.actionRequired=null,d;const m=u.splice(p,1)[0],y={...m,id:m.id||`drawn-${Date.now()}`,isFaceUp:!0};return f.deck=u,f.hand=[...f.hand,y],f.deckRevealed=!1,d[i]=f,d=ne(d,i,`${c} draws ${m.protocol}-${m.value} from the revealed deck.`),d.actionRequired=null,d=Ge(d),d},Zd=(a,t)=>{var d;if(((d=a.actionRequired)==null?void 0:d.type)!=="state_number")return a;const i=a.actionRequired.actor;let c=B0(a,i,t);return c=Ge(c),c},Kd=(a,t)=>{var d;if(((d=a.actionRequired)==null?void 0:d.type)!=="state_protocol")return a;const i=a.actionRequired.actor;let c=W0(a,i,t);return c=Ge(c),c},Jd=(a,t)=>{var v;if(((v=a.actionRequired)==null?void 0:v.type)!=="select_from_drawn_to_reveal")return a;const l=a.actionRequired,i=l.actor,c=i==="player"?"Player":"Opponent",d=l.statedNumber,f=l.thenAction;let u={...a};const m=u[i].hand.find(x=>x.id===t);if(!m)return u.actionRequired=null,u=Ge(u),u;const y=d!==void 0?` (stated value: ${d})`:"";return u=ne(u,i,`${c} reveals ${m.protocol}-${m.value}${y}.`),u.lastCustomEffectTargetCardId=t,u.actionRequired=null,f==="may_play"&&(u.actionRequired={type:"prompt_optional_effect",actor:i,sourceCardId:l.sourceCardId,effectDef:{params:{action:"play",source:"hand",useCardFromPreviousEffect:!0}},optional:!0}),u},eu=a=>{var m;if(((m=a.actionRequired)==null?void 0:m.type)!=="confirm_deck_discard")return a;const t=a.actionRequired,{sourceCardId:l,followUpEffect:i,conditionalType:c,laneIndex:d,actor:f,discardedCard:u}=t;let p={...a};if(p.actionRequired=null,i&&l){const y=we(p,l);if(y&&y.card.isFaceUp){const v={cardOwner:y.owner,opponent:y.owner==="player"?"opponent":"player"},x=d!==void 0?d:p[y.owner].lanes.findIndex(S=>S.some(E=>E.id===l));if(c==="if_protocol_matches_stated"){const S=u==null?void 0:u.protocol,E=p.lastStatedProtocol;if(!E||!S||S!==E)return p=ne(p,y.owner,`Discarded card (${S}) does not match stated protocol "${E||"none"}". Effect skipped.`),p=Ge(p),p;p=ne(p,y.owner,`Discarded card matches stated protocol "${E}"!`)}if(p=ut(y.card,x,p,v,i).newState,p.actionRequired)return p}}return p=Ge(p),p},tu=a=>{var v;if(((v=a.actionRequired)==null?void 0:v.type)!=="confirm_deck_play_preview")return a;const t=a.actionRequired,{sourceCardId:l,actor:i,drawnCard:c,isFaceDown:d,excludeCurrentLane:f,currentLaneIndex:u,followUpEffect:p,conditionalType:m}=t;let y={...a};return y.actionRequired={type:"select_lane_for_play",sourceCardId:l,actor:i,count:1,isFaceDown:d,excludeCurrentLane:f,currentLaneIndex:u,source:"deck",preDrawnCard:c,followUpEffect:p,conditionalType:m},y};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const om=(a,t)=>{var v;if(((v=a.actionRequired)==null?void 0:v.type)!=="prompt_optional_draw")return a;const{sourceCardId:l,actor:i,count:c,drawingPlayer:d,logSource:f,logPhase:u,logIndentLevel:p}=a.actionRequired,m=i.charAt(0).toUpperCase()+i.slice(1);let y={...a};if(f!==void 0&&(y=Be(y,f)),u!==void 0&&(y=Ke(y,u)),p!==void 0&&(y._logIndentLevel=p),t){y=ne(y,i,`${m} chooses to execute the optional draw effect.`),y=cr(y,d||i,c),y=ne(y,i,`${m} draws ${c} card${c!==1?"s":""}.`);const x=a.actionRequired.followUpEffect;if(a.actionRequired.conditionalType,x){const w=we(y,l);if(w){const S=y[w.owner].lanes.findIndex(C=>C.some(R=>R.id===l)),E=i==="player"?"opponent":"player",b={cardOwner:i,actor:i,currentTurn:y.turn,opponent:E,triggerType:"start"};y=ut(w.card,S,y,b,x).newState,y=Ge(y)}else{const S=i==="player"?"opponent":"player";let E=0;for(let R=0;R<3;R++)if(y[i].lanes[R].length>0){E=R;break}const b={id:l,protocol:"Unknown",value:0},j={cardOwner:i,actor:i,currentTurn:y.turn,opponent:S,triggerType:"start"};y=ut(b,E,y,j,x).newState,y=Ge(y)}}else y.actionRequired=null}else y=ne(y,i,`${m} skips the draw.`),y.actionRequired=null;return y},rm=(a,t,l)=>{var c;if(((c=a.actionRequired)==null?void 0:c.type)!=="plague_4_player_flip_optional")return a;let i={...a,actionRequired:null};if(i=Be(i,"Plague-4"),i=Ke(i,"end"),t){const{sourceCardId:d}=a.actionRequired;i=ne(i,l,`${l==="player"?"Player":"Opponent"} chooses to flip the card.`),i=lr(new Set([d]),i),i.animationState={type:"flipCard",cardId:d}}else i=ne(i,l,`${l==="player"?"Player":"Opponent"} skips flipping the card.`);return i=Be(i,void 0),i=Ke(i,void 0),i=Ao(i),i},lm=(a,t)=>{var m,y,v;if(((m=a.actionRequired)==null?void 0:m.type)!=="prompt_optional_discard_custom")return a;const{actor:l,count:i,sourceCardId:c}=a.actionRequired,d=l.charAt(0).toUpperCase()+l.slice(1);let f={...a};const u=(y=a.actionRequired)==null?void 0:y.followUpEffect,p=(v=a.actionRequired)==null?void 0:v.conditionalType;return t?(f=ne(f,l,`${d} chooses to discard ${i} card(s).`),f.actionRequired={type:"discard",actor:l,count:i,sourceCardId:c,followUpEffect:u,conditionalType:p,previousHandSize:f[l].hand.length}):(f=ne(f,l,`${d} skips the discard.`),f.actionRequired=null),f},Md=(a,t)=>{var m,y,v,x,w,S,E;if(((m=a.actionRequired)==null?void 0:m.type)!=="prompt_optional_effect")return a;const{actor:l,sourceCardId:i,effectDef:c,laneIndex:d,savedTargetCardId:f}=a.actionRequired,u=l.charAt(0).toUpperCase()+l.slice(1);let p={...a};if(f&&(p.lastCustomEffectTargetCardId=f),t){const b=c.params.action;p=ne(p,l,`${u} chooses to execute the optional ${b} effect.`),p.actionRequired=null;const j=[...p.player.lanes.flat(),...p.opponent.lanes.flat()].find(U=>U.id===i);if(!j)return console.error("[Optional Effect] Source card not found!"),p;const C={cardOwner:l,opponent:l==="player"?"opponent":"player",currentTurn:p.turn,actor:l},R={...c,params:{...c.params,optional:!1},conditional:void 0},F=ut(j,d,p,C,R),L=!!F.newState.actionRequired,O=!!F.newState._effectSkippedNoTargets;if(O&&!L){const U={...F.newState};return delete U._effectSkippedNoTargets,U.actionRequired=null,U}if(O&&L&&delete F.newState._effectSkippedNoTargets,c.conditional&&c.conditional.type==="if_executed"&&c.conditional.thenEffect){if(F.newState.actionRequired){const A=F.newState.actionRequired.sourceCardId;if(A&&A!==i){const $={type:"execute_conditional_followup",sourceCardId:i,laneIndex:d,followUpEffect:c.conditional.thenEffect,context:C,actor:l};return{...F.newState,queuedActions:[...F.newState.queuedActions||[],$]}}return{...F.newState,actionRequired:{...F.newState.actionRequired,followUpEffect:c.conditional.thenEffect,conditionalType:"if_executed"}}}const U=c.conditional.thenEffect,k=ut(j,d,F.newState,C,U);return k.newState.actionRequired&&U.conditional&&U.conditional.thenEffect?{...k.newState,actionRequired:{...k.newState.actionRequired,followUpEffect:U.conditional.thenEffect,conditionalType:U.conditional.type}}:k.newState}const G=(y=a.actionRequired)==null?void 0:y.followUpEffect,V=(v=a.actionRequired)==null?void 0:v.outerSourceCardId,z=(x=a.actionRequired)==null?void 0:x.outerLaneIndex;if(G&&V){let U=F.newState;if(U.actionRequired)return{...U,actionRequired:{...U.actionRequired,followUpEffect:G,outerSourceCardId:V,outerLaneIndex:z}};const k=[...U.player.lanes.flat(),...U.opponent.lanes.flat()].find(A=>A.id===V);if(k){const A=U.player.lanes.flat().some(q=>q.id===V)?"player":"opponent",I={cardOwner:A,opponent:A==="player"?"opponent":"player",currentTurn:U.turn,actor:A};return ut(k,z||0,U,I,G).newState}}return F.newState}else{const b=c.params.action;p=ne(p,l,`${u} skips the optional ${b} effect.`),p.actionRequired=null;const j=(w=a.actionRequired)==null?void 0:w.followUpEffect,C=(S=a.actionRequired)==null?void 0:S.outerSourceCardId,R=(E=a.actionRequired)==null?void 0:E.outerLaneIndex;if(j&&C){const F=[...p.player.lanes.flat(),...p.opponent.lanes.flat()].find(L=>L.id===C);if(F){let L=R;if(L===void 0){for(const V of["player","opponent"])for(let z=0;z<p[V].lanes.length;z++)if(p[V].lanes[z].some(U=>U.id===C)){L=z;break}}const O=p.player.lanes.flat().some(V=>V.id===C)?"player":"opponent",T={cardOwner:O,opponent:O==="player"?"opponent":"player",currentTurn:p.turn,actor:O};return ut(F,L||0,p,T,j).newState}}return p}},Fd=(a,t,l)=>{var R;if(((R=a.actionRequired)==null?void 0:R.type)!=="prompt_rearrange_protocols")return a;const i=v0(a);if(!i.allowed)return console.error(`Protocol rearrangement blocked: ${i.reason}`),a;const{target:c,actor:d,originalAction:f,sourceCardId:u,disallowedProtocolForLane:p}=a.actionRequired;if(p){const{laneIndex:F,protocol:L}=p;if(t[F]===L)return console.error(`Illegal rearrange: ${L} cannot be placed on lane ${F} due to Anarchy-3 restriction`),a}let m={...a};const y={...m[c]},v={};y.protocols.forEach((F,L)=>{v[F]=y.compiled[L]});const x=t.map(F=>v[F]);y.protocols=t,y.compiled=x,m[c]=y,m.actionRequired=null;const w=m._pendingCustomEffects;if(w&&w.effects.length>0){const F={type:"execute_remaining_custom_effects",sourceCardId:w.sourceCardId,laneIndex:w.laneIndex,effects:w.effects,context:w.context,actor:d,logSource:w.logSource,logPhase:w.logPhase,logIndentLevel:w.logIndentLevel};m.queuedActions=[F,...m.queuedActions||[]],delete m._pendingCustomEffects}let S="Control Action";if(u!=="CONTROL_MECHANIC"){const F=[...m.player.lanes.flat(),...m.opponent.lanes.flat()].find(L=>L.id===u);F&&(S=`${F.protocol}-${F.value}`)}const E=d.charAt(0).toUpperCase()+d.slice(1),b=c===d?"their own":"the opponent's",j=t.join(" | ");m=ne(m,d,`${S}: ${E} rearranges ${b} protocols.`),m=ne(m,d,`New protocol order for ${c}: ${j}`);let C=Ce(m);if(f){if(C={...C,_logIndentLevel:0},f.type==="compile")return Wl(C,f.laneIndex,l);if(f.type==="fill_hand")return Zl(C,d);f.type==="continue_turn"?f.queuedSpeed2Actions&&f.queuedSpeed2Actions.length>0?(C=ne(C,d,"Processing remaining Speed-2 effects..."),C.queuedActions=[...f.queuedSpeed2Actions,...C.queuedActions||[]]):(C=ne(C,d,"Turn ends after compile."),C.phase="hand_limit"):f.type==="resume_interrupted_turn"&&(C=ne(C,d,"Resuming interrupted turn..."),C._interruptedTurn=f.interruptedTurn,C._interruptedPhase=f.interruptedPhase,f.queuedSpeed2Actions&&f.queuedSpeed2Actions.length>0&&(C.queuedActions=[...f.queuedSpeed2Actions,...C.queuedActions||[]]))}return C},sm=(a,t,l)=>{var C;if(((C=a.actionRequired)==null?void 0:C.type)!=="prompt_swap_protocols")return a;const{actor:i,target:c,originalAction:d,sourceCardId:f}=a.actionRequired,u={...a[c]},[p,m]=t.sort((R,F)=>R-F),y=[...u.protocols],v=[...u.compiled];[y[p],y[m]]=[y[m],y[p]],[v[p],v[m]]=[v[m],v[p]],u.protocols=y,u.compiled=v;let x={...a,[c]:u,actionRequired:null};const w=x._pendingCustomEffects;if(w&&w.effects.length>0){const R={type:"execute_remaining_custom_effects",sourceCardId:w.sourceCardId,laneIndex:w.laneIndex,effects:w.effects,context:w.context,actor:i,logSource:w.logSource,logPhase:w.logPhase,logIndentLevel:w.logIndentLevel};x.queuedActions=[R,...x.queuedActions||[]],delete x._pendingCustomEffects}const S=i.charAt(0).toUpperCase()+i.slice(1),E=c.charAt(0).toUpperCase()+c.slice(1);x=ne(x,i,`${f==="CONTROL_MECHANIC"?"Control":"Spirit-4"}: ${S} swaps ${E}'s protocols ${y[m]} and ${y[p]}.`),f==="CONTROL_MECHANIC"&&(x.controlCardHolder=null);let j=Ce(x);if(d){if(d.type==="compile")return j=ne(j,i,"Resuming Compile action..."),Wl(j,d.laneIndex,l);if(d.type==="fill_hand")return j=ne(j,i,"Resuming Refresh action..."),Zl(j,i)}return j},Hd=(a,t)=>{var x;if(((x=a.actionRequired)==null?void 0:x.type)!=="prompt_shift_or_flip_board_card_custom")return a;const{actor:l,sourceCardId:i,revealedCardId:c,followUpAction:d,optional:f}=a.actionRequired,u=l.charAt(0).toUpperCase()+l.slice(1),p=we(a,c);if(!p)return a;if(d&&t!=="skip"&&t!==d)return console.error(`Invalid choice: ${t}, followUpAction restricts to: ${d}`),a;const m=p.owner,y=a[m].lanes.findIndex(w=>w.some(S=>S.id===c));if(y===-1)return a;let v={...a};switch(t){case"shift":{const w=[...v[m].lanes[y]],S=w.findIndex(E=>E.id===c);if(S!==-1){w[S]={...w[S],isFaceUp:!1};const E=[...v[m].lanes];E[y]=w,v={...v,[m]:{...v[m],lanes:E}}}v=ne(v,l,`${u} chooses to shift the revealed card (face-down).`),v.actionRequired={type:"select_lane_to_shift_revealed_board_card_custom",sourceCardId:i,revealedCardId:c,actor:l};break}case"flip":{v=ne(v,l,`${u} chooses to flip the revealed card face-up permanently.`);const w={...v,actionRequired:null};v=Ud(w,c).newState;break}case"skip":{const w=[...v[m].lanes[y]],S=w.findIndex(E=>E.id===c);if(S!==-1){w[S]={...w[S],isFaceUp:!1};const E=[...v[m].lanes];E[y]=w,v={...v,[m]:{...v[m],lanes:E}}}v=ne(v,l,`${u} chooses to do nothing with the revealed card.`),v.actionRequired=null;break}}return v};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const qd=(a,t)=>{if(!a.actionRequired)return a;const{actionRequired:l}=a,i=l.actor,c=i==="player"?"opponent":"player";switch(l.type){case"select_card_from_hand_to_give":{const d=a[i].hand.find(w=>w.id===t);if(!d)return a;let f={...a};const u={...f[i]},p={...f[c]};u.hand=u.hand.filter(w=>w.id!==t),p.hand=[...p.hand,d],f={...f,[i]:u,[c]:p};const m=i==="player"?"Player":"Opponent",y=`${d.protocol}-${d.value}`;f=ne(f,i,`${m} gives ${y} to the opponent.`),l.sourceEffect==="love_1_end"&&(f=ne(f,i,`Love-1: ${m} draws 2 cards.`),f=cr(f,i,2));const v=l.followUpEffect,x=l.conditionalType;if(v&&x==="if_executed"){const w=we(f,l.sourceCardId);if(w){const{card:S,laneIndex:E}=w,b={cardOwner:i,actor:i,currentTurn:f.turn,opponent:c,triggerType:"play"};f=ut(S,E,f,b,v).newState}}return f.actionRequired=null,f}case"select_card_from_hand_to_reveal":{const d=a[i].hand.find(x=>x.id===t);if(!d)return a;let f={...a};const u={...f[i]},p=u.hand.map(x=>x.id===t?{...x,isRevealed:!0}:x);u.hand=p,f={...f,[i]:u};const m=i==="player"?"Player":"Opponent",y=`${d.protocol}-${d.value}`;f=ne(f,i,`${m} reveals ${y} from their hand.`);const v=f._pendingCustomEffects;if(v&&v.effects.length>0){const x=we(f,v.sourceCardId);if(x){const{card:w}=x,S=v.effects[0],E=v.effects.slice(1),b={cardOwner:i,actor:i,currentTurn:f.turn,opponent:c,triggerType:"play"};return f=ut(w,v.laneIndex,f,b,S).newState,E.length>0?f._pendingCustomEffects={...v,effects:E}:delete f._pendingCustomEffects,f}}return f.actionRequired={type:"select_any_card_to_flip",count:1,sourceCardId:l.sourceCardId,actor:i},f}default:return a}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const zd=(a,t)=>{var w;if(((w=a.actionRequired)==null?void 0:w.type)!=="custom_choice")return a;const{options:l,sourceCardId:i,actor:c,laneIndex:d}=a.actionRequired;if(t<0||t>=l.length)return console.error(`[Choice Resolver] Invalid option index: ${t}`),a;const f=l[t],u=we(a,i);if(!u){console.error(`[Choice Resolver] Source card ${i} not found`);let S={...a};return S.actionRequired=null,S}const p=c==="player"?"opponent":"player",m={cardOwner:c,actor:c,currentTurn:a.turn,opponent:p};let y={...a,actionRequired:null};const v=ut(u.card,d,y,m,f);return Ce(v.newState)};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Control Mechanic Logic for AI
 *
 * CRITICAL: When evaluating rearrangements during a compile action,
 * the lane being compiled will have its value RESET TO 0 after the compile.
 * This must be considered when determining beneficial swaps!
 */function _c(a,t){const l=[...a];return t!==null&&t>=0&&t<3&&(l[t]=0),l}function fx(a,t=null){const l=a.player,i=[],c=[];for(let f=0;f<3;f++)l.compiled[f]?i.push(f):c.push(f);if(i.length===0||c.length===0)return!1;const d=_c(l.laneValues,t);for(const f of i)for(const u of c)if(d[u]-d[f]>0)return!0;return!1}function cm(a,t=null){const l=a.opponent,i=[],c=[];for(let f=0;f<3;f++)l.compiled[f]?i.push(f):c.push(f);if(i.length===0||c.length===0)return!1;const d=_c(l.laneValues,t);for(const f of i)for(const u of c){const m=10-d[f];if(m>=0&&m<=3){const v=10-d[u];if(m<v)return!0}}return!1}function Rm(a,t){if(!t||t.type!=="prompt_rearrange_protocols")return{type:"rearrangeProtocols",newOrder:[...a.opponent.protocols]};const l=t.target,i=t.disallowedProtocolForLane;let c=null;t.originalAction&&t.originalAction.type==="compile"&&(c=t.originalAction.laneIndex);const d=w=>{if(!i)return!0;const{laneIndex:S,protocol:E}=i;return w[S]!==E},f=a.opponent,u=a.player,p=_c(f.laneValues,c),m=_c(u.laneValues,c),y=f.compiled.filter(w=>w).length;if(u.compiled.filter(w=>w).length===2&&y===2){const w=u.compiled.findIndex(j=>!j),S=f.compiled.findIndex(j=>!j),E=m[w],b=p[S];if(E>b&&l==="player"){let j=-1,C=1/0;for(let R=0;R<3;R++)u.compiled[R]&&m[R]<C&&(C=m[R],j=R);if(j!==-1&&C<=E){const R=[...u.protocols];if([R[w],R[j]]=[R[j],R[w]],d(R))return{type:"rearrangeProtocols",newOrder:R}}return nr(u.protocols,d)}if(E<=b&&l==="opponent"){let j=-1,C=-1;for(let R=0;R<3;R++)f.compiled[R]&&p[R]>C&&(C=p[R],j=R);if(j!==-1&&C>b&&C>0){const R=[...f.protocols];if([R[S],R[j]]=[R[j],R[S]],d(R))return{type:"rearrangeProtocols",newOrder:R}}return nr(f.protocols,d)}}if(l==="player"){const w=[],S=[];for(let C=0;C<3;C++)u.compiled[C]?w.push(C):S.push(C);if(w.length===0||S.length===0){if(t.sourceCardId!=="CONTROL_MECHANIC")for(let R=0;R<3;R++)for(let F=R+1;F<3;F++){const L=[...u.protocols];if([L[R],L[F]]=[L[F],L[R]],d(L))return{type:"rearrangeProtocols",newOrder:L}}return nr(u.protocols,d)}let E=null;for(const C of S)if(m[C]>=10&&m[C]>p[C]){for(const F of w){E={compiledIdx:F,uncompiledIdx:C};break}if(E)break}if(E){const C=[...u.protocols];if([C[E.compiledIdx],C[E.uncompiledIdx]]=[C[E.uncompiledIdx],C[E.compiledIdx]],d(C))return{type:"rearrangeProtocols",newOrder:C}}let b=null;for(const C of w)for(const R of S){const F=m[R]-m[C];(!b||F>b.score)&&(b={compiledIdx:C,uncompiledIdx:R,score:F})}const j=t.sourceCardId!=="CONTROL_MECHANIC";if(b&&b.score>0){const C=[...u.protocols];if([C[b.compiledIdx],C[b.uncompiledIdx]]=[C[b.uncompiledIdx],C[b.compiledIdx]],d(C))return{type:"rearrangeProtocols",newOrder:C}}if(j)for(let C=0;C<3;C++)for(let R=C+1;R<3;R++){const F=[...u.protocols];if([F[C],F[R]]=[F[R],F[C]],d(F))return{type:"rearrangeProtocols",newOrder:F}}return nr(u.protocols,d)}if(l==="opponent"){const w=[],S=[];for(let j=0;j<3;j++)f.compiled[j]?w.push(j):S.push(j);if(w.length===0||S.length===0){if(t.sourceCardId!=="CONTROL_MECHANIC")for(let C=0;C<3;C++)for(let R=C+1;R<3;R++){const F=[...f.protocols];if([F[C],F[R]]=[F[R],F[C]],d(F))return{type:"rearrangeProtocols",newOrder:F}}return nr(f.protocols,d)}let E=null;for(const j of w)for(const C of S){const R=p[j],F=p[C],L=R-F,T=R>=10&&R>m[j]?L+100:L;(!E||T>E.score)&&(E={compiledIdx:j,uncompiledIdx:C,score:T,newUncompiledValue:R})}const b=t.sourceCardId!=="CONTROL_MECHANIC";if(E&&E.score>0){const j=[...f.protocols];if([j[E.compiledIdx],j[E.uncompiledIdx]]=[j[E.uncompiledIdx],j[E.compiledIdx]],d(j))return{type:"rearrangeProtocols",newOrder:j}}if(b)for(let j=0;j<3;j++)for(let C=j+1;C<3;C++){const R=[...f.protocols];if([R[j],R[C]]=[R[C],R[j]],d(R))return{type:"rearrangeProtocols",newOrder:R}}return nr(f.protocols,d)}const x=l==="player"?[...u.protocols]:[...f.protocols];return nr(x,d)}function nr(a,t){if(t(a))return{type:"rearrangeProtocols",newOrder:[...a]};for(let l=0;l<3;l++)for(let i=l+1;i<3;i++){const c=[...a];if([c[l],c[i]]=[c[i],c[l]],t(c))return{type:"rearrangeProtocols",newOrder:c}}return console.error("[AI Rearrange] Could not find any valid arrangement - returning current order"),{type:"rearrangeProtocols",newOrder:[...a]}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function Tm(a,t){return bn(a).some(({rule:i,cardOwner:c})=>i.type!=="require_face_down_play"?!1:i.target==="all"||i.target==="opponent"&&c!==t)}function nu(a){const t=a;return t.customEffects?[...t.customEffects.topEffects||[],...t.customEffects.middleEffects||[],...t.customEffects.bottomEffects||[]].some(i=>{var f,u;const c=i.trigger;return(c==="on_cover"||c==="on_cover_or_flip")&&((f=i.params)==null?void 0:f.action)==="delete"&&((u=i.params)==null?void 0:u.deleteSelf)===!0}):!1}function hx(a,t,l){const i=a[t].lanes[l];if(i.length===0)return null;const c=i[i.length-1];return c.isFaceUp&&nu(c)?c.value:null}function Am(a){const t=a;return t.customEffects?[...t.customEffects.topEffects||[],...t.customEffects.middleEffects||[],...t.customEffects.bottomEffects||[]].some(i=>{var c;return i.params.action==="return"&&((c=i.params.targetFilter)==null?void 0:c.owner)==="own"}):!1}function Dm(a){const t=a;return t.customEffects?[...t.customEffects.topEffects||[],...t.customEffects.middleEffects||[],...t.customEffects.bottomEffects||[]].some(i=>{var c,d,f;return i.params.action==="delete"&&((c=i.params.targetFilter)==null?void 0:c.owner)==="own"&&(((d=i.params.targetFilter)==null?void 0:d.valueFilter)==="highest"||((f=i.params.targetFilter)==null?void 0:f.calculation)==="highest_value")}):!1}function mx(a){const t=a;if(!t.customEffects)return 0;const l=t.customEffects.topEffects||[];for(const i of l)if(i.trigger==="passive"&&i.params.action==="value_modifier"&&(i.params.condition==="per_face_down_card"||i.params.applyTo==="face_down_cards"))return i.params.modifier||0;return 0}function Fm(a,t){let l=0;for(const i of["player","opponent"])for(const c of a[i].lanes[t])if(c.isFaceUp){const d=mx(c);d>0&&(l=Math.max(l,d))}return l}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * EASY AI - Focused on winning, but only looks at own board
 * - Always tries to compile as fast as possible
 * - Prioritizes lanes closest to 10
 * - Doesn't consider opponent's strategy
 * - Makes simple decisions for effect choices
 *
 * FULLY GENERIC: Uses only targetFilter, scope, destinationRestriction from ActionRequired
 * NO card-specific handlers - all effects handled through parameters
 */function Vl(a,t,l,i,c,d){const f=[],u=l||{},p=u.position||"uncovered";for(const m of["player","opponent"])if(!(u.owner==="own"&&m!==t)&&!(u.owner==="opponent"&&m===t))for(let y=0;y<a[m].lanes.length;y++){if((i==null?void 0:i.type)==="this_lane"&&i.laneIndex!==void 0&&y!==i.laneIndex||(i==null?void 0:i.type)==="other_lanes"&&i.laneIndex!==void 0&&y===i.laneIndex||d!==void 0&&(i==null?void 0:i.type)==="this_lane"&&y!==d)continue;const v=a[m].lanes[y];for(let x=0;x<v.length;x++){const w=v[x];if(Do(a,w.id))continue;const S=Fo(a,v,x);if(!(p==="uncovered"&&!S)&&!(p==="covered"&&S)&&!(u.faceState==="face_up"&&!w.isFaceUp)&&!(u.faceState==="face_down"&&w.isFaceUp)){if(u.valueRange){const E=w.isFaceUp?w.value:2;if(E<u.valueRange.min||E>u.valueRange.max)continue}if(!(u.valueEquals!==void 0&&(w.isFaceUp?w.value:2)!==u.valueEquals)&&!(u.excludeSelf&&c&&w.id===c)){if(u.valueMinGreaterThanHandSize){const E=a[t].hand.length;if(w.value<=E)continue}f.push(w)}}}}return u.calculation==="highest_value"&&f.length>0?(f.sort((m,y)=>{const v=m.isFaceUp?m.value:2;return(y.isFaceUp?y.value:2)-v}),[f[0]]):u.calculation==="lowest_value"&&f.length>0?(f.sort((m,y)=>{const v=m.isFaceUp?m.value:2,x=y.isFaceUp?y.value:2;return v-x}),[f[0]]):f}function ar(a,t){return a.player.lanes.some(l=>l.some(i=>i.id===t))}function jo(a,t,l){return a.isFaceUp?a.value:2+0}const yx=a=>{const{opponent:t,player:l}=a;if(t.hand.length===0)return null;const i=(b,j,C)=>Za(a,"opponent",b,j,C).allowed,c=Tm(a,"opponent"),d=bc(a,"opponent"),f=Sc(a),u=(b,j)=>c||!i(j,!0,b.protocol)?!1:f?b.protocol!==t.protocols[j]&&b.protocol!==l.protocols[j]:b.protocol===t.protocols[j]||b.protocol===l.protocols[j]||d,p=(b,j,C)=>2+Fm(a,C),m=t.hand.filter(b=>Am(b)?t.lanes.flat().some(R=>R.protocol!==b.protocol):!0);if(m.length===0)return null;const y=b=>{if(nu(b)){for(let j=0;j<3;j++)if(!t.compiled[j]&&t.laneValues[j]+b.value>=10)return!1;return!0}if(Dm(b)){let j=0;for(let C=0;C<3;C++){const R=t.lanes[C];if(R.length>0){const F=R[R.length-1],L=F.isFaceUp?F.value:2;L>j&&(j=L)}}return b.value>=j}return!1},v=[],w=l.lanes.flat().length+t.lanes.flat().length<=3,S=l.lanes.flat().length>0,E=(b,j)=>b.keywords.flip||b.keywords.delete||b.keywords.shift||b.keywords.return?S||t.lanes.some((F,L)=>L!==j&&F.length>0)||t.lanes[j].length>0:!0;for(const b of m)for(let j=0;j<3;j++){if(t.compiled[j])continue;const C=t.laneValues[j],R=l.laneValues[j];if(u(b,j)&&!y(b)){const F=C+b.value;let L=0;F>=10&&F>R?L=1e3+F:F<10?L=100+F+b.value*5:L=50+b.value,w&&b.value<=2&&(E(b,j)?L-=50:L-=200),b.keywords.draw&&t.hand.length>=5&&(L-=30),v.push({cardId:b.id,laneIndex:j,isFaceUp:!0,score:L})}if(i(j,!1,b.protocol)){const F=p(b,!1,j),L=C+F;let O=0;L>=10&&L>R?O=900+L:L<10?O=80+L:O=30+F,v.push({cardId:b.id,laneIndex:j,isFaceUp:!1,score:O})}}if(v.length===0)return null;v.sort((b,j)=>j.score-b.score);for(const b of v){if(b.isFaceUp){const j=t.hand.find(R=>R.id===b.cardId);if(!j||!Za(a,"opponent",b.laneIndex,!0,j.protocol).allowed)continue}return{cardId:b.cardId,laneIndex:b.laneIndex,isFaceUp:b.isFaceUp}}return null},gx=(a,t)=>{var l,i,c,d,f,u;switch(t.type){case"prompt_use_control_mechanic":{const{player:p}=a,m=p.compiled.some(v=>v),y=p.compiled.filter(v=>!v).length;return m&&y>0?{type:"resolveControlMechanicPrompt",choice:"player"}:{type:"resolveControlMechanicPrompt",choice:"skip"}}case"discard":{const p=[...a.opponent.hand].sort((v,x)=>v.value-x.value),m=t.variableCount?Math.min(3,p.length):t.count;return{type:"discardCards",cardIds:p.slice(0,m).map(v=>v.id)}}case"select_cards_to_delete":{const p=t.currentLaneIndex??t.laneIndex,m=t.allowedIds;let y=Vl(a,t.actor,t.targetFilter,t.scope,t.sourceCardId,p);m&&(y=y.filter(E=>m.includes(E.id)));const v=t.disallowedIds||[],x=y.filter(E=>!v.includes(E.id));if(x.length===0)return{type:"skip"};const w=x.filter(E=>ar(a,E.id)),S=x.filter(E=>!ar(a,E.id));return w.length>0?(w.sort((E,b)=>jo(b)-jo(E)),{type:"deleteCard",cardId:w[0].id}):S.length>0?(S.sort((E,b)=>jo(E)-jo(b)),{type:"deleteCard",cardId:S[0].id}):{type:"deleteCard",cardId:x[0].id}}case"select_card_to_flip":case"select_any_card_to_flip":case"select_any_card_to_flip_optional":{const p=Sa(a),m=t.restrictedLaneIndex??t.currentLaneIndex??t.laneIndex,y=Vl(a,t.actor,t.targetFilter,t.scope,t.sourceCardId,m);if(y.length===0)return t.optional?{type:"skip"}:{type:"skip"};const v=y.filter(S=>ar(a,S.id)),x=y.filter(S=>!ar(a,S.id)),w=v.filter(S=>S.isFaceUp).sort((S,E)=>E.value-S.value);if(w.length>0)return{type:"flipCard",cardId:w[0].id};if(!p){const S=v.filter(E=>!E.isFaceUp);if(S.length>0)return{type:"flipCard",cardId:S[0].id}}if(!p){const S=x.filter(E=>!E.isFaceUp);if(S.length>0)return{type:"flipCard",cardId:S[0].id}}if(!t.optional){const S=x.filter(E=>E.isFaceUp).sort((E,b)=>E.value-b.value);if(S.length>0)return{type:"flipCard",cardId:S[0].id}}return{type:"skip"}}case"select_card_to_shift":{const p=t.scope,m=p==="this_lane"?t.sourceLaneIndex??t.currentLaneIndex??t.laneIndex:void 0,y=Vl(a,t.actor,t.targetFilter,p,t.sourceCardId,m);if(y.length===0)return t.optional?{type:"skip"}:{type:"skip"};const v=y.filter(x=>ar(a,x.id));return v.length>0?{type:"shiftCard",cardId:v[0].id}:{type:"shiftCard",cardId:y[0].id}}case"select_card_to_return":{const p=t.currentLaneIndex??t.laneIndex,m=Vl(a,t.actor,t.targetFilter,t.scope,t.sourceCardId,p);if(m.length===0)return t.optional?{type:"skip"}:{type:"skip"};const y=m.filter(x=>ar(a,x.id));if(y.length>0)return y.sort((x,w)=>jo(w)-jo(x)),{type:"returnCard",cardId:y[0].id};const v=m.filter(x=>!ar(a,x.id));return v.length>0?(v.sort((x,w)=>jo(x)-jo(w)),{type:"returnCard",cardId:v[0].id}):{type:"returnCard",cardId:m[0].id}}case"select_lane_for_shift":{let p=t.validLanes||[0,1,2];if(p=p.filter(m=>m!==t.originalLaneIndex),t.destinationRestriction){const m=t.destinationRestriction,y=t.originalLaneIndex;if(m.type==="to_this_lane"&&m.laneIndex!==void 0)p=p.filter(v=>v===m.laneIndex);else if(m.type==="to_another_lane")p=p.filter(v=>v!==y);else if(m.type==="to_or_from_this_lane"&&m.laneIndex!==void 0){const v=typeof m.laneIndex=="number"?m.laneIndex:y;y!==v&&(p=[v])}else if(m.type==="non_matching_protocol"){const v=we(a,t.cardToShiftId);v&&(p=p.filter(x=>{const w=a.player.protocols[x],S=a.opponent.protocols[x];return v.card.protocol!==w&&v.card.protocol!==S}))}}return p.length>0?{type:"selectLane",laneIndex:p[0]}:{type:"selectLane",laneIndex:0}}case"select_lane_for_shift_all":{let p=t.validLanes||[0,1,2];return p=p.filter(m=>m!==t.sourceLaneIndex),p.length>0?{type:"selectLane",laneIndex:p[0]}:{type:"selectLane",laneIndex:0}}case"select_lane_for_delete":{let p=t.validLanes||[0,1,2];p=p.filter(y=>!(t.excludeSourceLane&&y===t.laneIndex));const m=p.map(y=>{let v=0,x=0;const w=t.deleteFilter;for(const S of a.player.lanes[y])w!=null&&w.valueRange&&S.isFaceUp?S.value>=w.valueRange.min&&S.value<=w.valueRange.max&&(v+=1):w!=null&&w.valueRange||(v+=1);for(const S of a.opponent.lanes[y])w!=null&&w.valueRange&&S.isFaceUp?S.value>=w.valueRange.min&&S.value<=w.valueRange.max&&(x+=2):w!=null&&w.valueRange||(x+=2);return{laneIndex:y,score:v-x}});return m.sort((y,v)=>v.score-y.score),{type:"selectLane",laneIndex:((l=m[0])==null?void 0:l.laneIndex)??0}}case"select_lane_for_delete_all":return t.validLanes.length>0?{type:"selectLane",laneIndex:t.validLanes[0]}:{type:"selectLane",laneIndex:0};case"select_lanes_for_swap_stacks":{const p=t.validLanes;return p.length>0?{type:"selectLane",laneIndex:p[Math.floor(Math.random()*p.length)]}:{type:"skip"}}case"select_card_for_copy_middle":{const p=t.validTargetIds||[];return p.length>0?{type:"selectCard",cardId:p[Math.floor(Math.random()*p.length)]}:{type:"skip"}}case"select_lane_for_play":{let p=t.validLanes||[0,1,2];return t.disallowedLaneIndex!==void 0&&(p=p.filter(m=>m!==t.disallowedLaneIndex)),p=p.filter(m=>Za(a,"opponent",m,!t.isFaceDown,"").allowed),p.length>0?{type:"selectLane",laneIndex:((i=p.filter(y=>!a.opponent.compiled[y]).map(y=>({lane:y,value:a.opponent.laneValues[y]})).sort((y,v)=>v.value-y.value)[0])==null?void 0:i.lane)??p[0]}:{type:"skip"}}case"select_lane_for_return":{const m=[0,1,2].map(y=>{const v=t.returnFilter;let x=0,w=0;for(const S of a.player.lanes[y]){const E=S.isFaceUp?S.value:2;(v==null?void 0:v.valueEquals)!==void 0&&E!==v.valueEquals||(x+=E)}for(const S of a.opponent.lanes[y]){const E=S.isFaceUp?S.value:2;(v==null?void 0:v.valueEquals)!==void 0&&E!==v.valueEquals||(w+=E)}return{laneIndex:y,score:x-w,hasTargets:x>0||w>0}}).filter(y=>y.hasTargets);return m.sort((y,v)=>v.score-y.score),{type:"selectLane",laneIndex:((c=m[0])==null?void 0:c.laneIndex)??0}}case"prompt_optional_effect":return((f=(d=t.effectDef)==null?void 0:d.params)==null?void 0:f.action)==="give"?{type:"resolveOptionalEffectPrompt",accept:!1}:{type:"resolveOptionalEffectPrompt",accept:!0};case"prompt_optional_discard_custom":return{type:"resolveOptionalDiscardCustomPrompt",accept:!1};case"prompt_optional_shuffle_trash":return{type:"resolvePrompt",accept:(t.trashCount||0)>0};case"select_card_from_revealed_deck":{const p=t.selectableCardIds||[];return p.length>0?{type:"selectRevealedDeckCard",cardId:p[0]}:{type:"resolvePrompt",accept:!1}}case"custom_choice":return{type:"resolveCustomChoice",optionIndex:0};case"flip_self":return t.sourceCardId?{type:"flipCard",cardId:t.sourceCardId}:{type:"skip"};case"prompt_rearrange_protocols":return Rm(a,t);case"prompt_swap_protocols":return{type:"resolveSwapProtocols",indices:[0,1]};case"select_card_from_hand_to_play":{const p=t.selectableCardIds,m=p?a.opponent.hand.filter(y=>p.includes(y.id)):a.opponent.hand;if(m.length>0){const y=m[0];let v=t.validLanes||[0,1,2].filter(x=>x!==t.disallowedLaneIndex);if(v=v.filter(x=>Za(a,"opponent",x,!t.isFaceDown,y.protocol).allowed),v.length>0){const x=v.filter(w=>!a.opponent.compiled[w]).map(w=>({lane:w,value:a.opponent.laneValues[w]})).sort((w,S)=>S.value-w.value);return{type:"playCard",cardId:y.id,laneIndex:((u=x[0])==null?void 0:u.lane)??v[0],isFaceUp:!1}}}return{type:"skip"}}case"select_card_from_hand_to_give":return a.opponent.hand.length>0?{type:"giveCard",cardId:[...a.opponent.hand].sort((m,y)=>m.value-y.value)[0].id}:{type:"skip"};case"select_card_from_hand_to_reveal":return a.opponent.hand.length>0?{type:"revealCard",cardId:a.opponent.hand[0].id}:{type:"skip"};case"reveal_opponent_hand":return{type:"skip"};case"select_board_card_to_reveal":{const p=Vl(a,t.actor,t.targetFilter||{faceState:"face_down",position:"uncovered"},void 0,t.sourceCardId);return p.length>0?{type:"revealCard",cardId:p[0].id}:{type:"skip"}}case"prompt_shift_or_flip_revealed_card":{const p=we(a,t.revealedCardId);return p?p.owner==="player"?{type:"resolvePrompt",accept:!0}:{type:"resolvePrompt",accept:!1}:{type:"resolvePrompt",accept:!1}}case"select_lane_to_shift_revealed_card":{const p=we(a,t.revealedCardId);if(!p)return{type:"selectLane",laneIndex:0};let m=-1;for(let v=0;v<a[p.owner].lanes.length;v++)if(a[p.owner].lanes[v].some(x=>x.id===t.revealedCardId)){m=v;break}const y=[0,1,2].filter(v=>v!==m);return y.length>0?{type:"selectLane",laneIndex:y[0]}:{type:"selectLane",laneIndex:0}}case"shift_flipped_card_optional":{const p=t.cardId,m=we(a,p);if(!m)return{type:"skip"};let y=m.laneIndex??-1;if(y===-1){for(let x=0;x<a[m.owner].lanes.length;x++)if(a[m.owner].lanes[x].some(w=>w.id===p)){y=x;break}}const v=[0,1,2].filter(x=>x!==y);return v.length===0?{type:"skip"}:{type:"selectLane",laneIndex:v[0]}}case"select_phase_effect":{const p=t;return p.availableEffects.length===0?{type:"skip"}:{type:"flipCard",cardId:p.availableEffects[0].cardId}}case"state_number":return{type:"stateNumber",number:Math.floor(Math.random()*6)};case"state_protocol":{const m=t.availableProtocols||[];if(m.length===0)return{type:"skip"};const y=Math.floor(Math.random()*m.length);return{type:"stateProtocol",protocol:m[y]}}case"select_from_drawn_to_reveal":{const m=t.eligibleCardIds||[];if(m.length===0)return{type:"skip"};const y=Math.floor(Math.random()*m.length);return{type:"selectFromDrawnToReveal",cardId:m[y]}}case"confirm_deck_discard":return{type:"confirmDeckDiscard"};case"confirm_deck_play_preview":return{type:"confirmDeckPlayPreview"}}return{type:"skip"}},vx=(a,t)=>{if(t)return gx(a,t);if(a.phase==="compile"&&a.compilableLanes.length>0)return{type:"compile",laneIndex:a.compilableLanes[0]};if(a.phase==="action"){const l=yx(a);if(l)return{type:"playCard",...l};if(a.opponent.hand.length<=1)return{type:"fillHand"};for(const i of a.opponent.hand)for(let c=0;c<3;c++){if(a.opponent.compiled[c])continue;if(Za(a,"opponent",c,!1,i.protocol).allowed)return{type:"playCard",cardId:i.id,laneIndex:c,isFaceUp:!1}}return{type:"fillHand"}}return{type:"fillHand"}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * NORMAL AI - Plays like a human player
 * - Makes good strategic decisions
 * - No memory of revealed cards
 * - 20% chance to make suboptimal moves for realism
 * - Balanced between Easy and Hard
 */const Kr=["delete","flip","shift","return","discard"],Ht=a=>{let t=12-a.value;return Kr.some(l=>a.keywords[l])&&(t+=6),a.keywords.draw&&(t+=3),a.keywords.play&&(t+=8),a.keywords.prevent&&(t+=4),t},zr=(a,t,l)=>{let i;for(const d of l[t].lanes)if(d.some(f=>f.id===a.id)){i=d;break}if(!i)return 0;if(!a.isFaceUp)return i.some(f=>f.isFaceUp&&f.protocol==="Darkness"&&f.value===2)?4:2;let c=a.value*2.5;return a.top.length>0&&(c+=6),(a.bottom.includes("Start:")||a.bottom.includes("End:"))&&(c+=8),a.bottom.includes("covered:")&&(c+=5),Kr.some(d=>a.keywords[d])&&(c+=4),c},Br=()=>Math.random()<.2,im=a=>a+(Math.random()*10-5),Vr=(a,t,l,i)=>{const c=l.position||"uncovered";return!(c==="uncovered"&&!t||c==="covered"&&t||l.faceState==="face_up"&&!a.isFaceUp||l.faceState==="face_down"&&a.isFaceUp||l.excludeSelf&&i&&a.id===i||l.valueRange&&(!a.isFaceUp||a.value<l.valueRange.min||a.value>l.valueRange.max)||l.valueEquals!==void 0&&(!a.isFaceUp||a.value!==l.valueEquals))},_x=a=>{const t=[],l=Tm(a,"opponent"),i=a.player.lanes.flat().length+a.opponent.lanes.flat().length,c=i<=3,d=i>3&&i<=8,u=a.player.lanes.flat().length>0,p=a.player.compiled.filter(Boolean).length,m=a.controlCardHolder==="opponent";a.controlCardHolder;let y=0;for(let C=0;C<3;C++)a.opponent.laneValues[C]>a.player.laneValues[C]?y++:a.player.laneValues[C]>a.opponent.laneValues[C];const x=a.useControlMechanic===!0&&p>=1&&!m;for(let C=0;C<3&&!(!a.player.compiled[C]&&a.player.laneValues[C]>=10&&a.player.laneValues[C]>a.opponent.laneValues[C]);C++);const w=a.opponent.compiled.filter(Boolean).length;let S=-1;if(w<3&&!x){const C=[];for(let R=0;R<3;R++){if(a.opponent.compiled[R])continue;const F=a.opponent.protocols[R],L=a.player.protocols[R],O=a.opponent.laneValues[R],T=a.player.laneValues[R],G=a.opponent.hand.filter(k=>k.protocol===F||k.protocol===L);if(T>=10&&!a.player.compiled[R]){const k=Math.max(...G.map(q=>q.value),0),I=Math.max(k,2);if(O+I<=T)continue}let V=0,z=`Lane ${R} (${F}): value=${O}`;V+=O*15,O>=8?(V+=100,z+=` [ALMOST COMPILE: ${O}]`):O>=6?(V+=60,z+=` [Near compile: ${O}]`):O>=4&&(V+=30,z+=` [Building: ${O}]`),V+=G.length*10,G.length>0&&(z+=` [${G.length} cards]`);const U=G.filter(k=>k.value>=4);V+=U.length*20,T>O&&(V-=(T-O)*5),G.length===0&&(V-=30,z+=" [No matching cards - face-down only]"),C.push({laneIndex:R,score:V,reason:z})}C.sort((R,F)=>F.score-R.score),C.length>0&&(S=C[0].laneIndex)}const E=(C,R)=>C.keywords.flip||C.keywords.delete||C.keywords.shift||C.keywords.return?a.player.lanes.flat().length>0||a.opponent.lanes.some((O,T)=>T!==R&&O.length>0)||a.opponent.lanes[R].length>0:!0,b=C=>C.keywords.draw?a.opponent.hand.length>=5:!1;for(const C of a.opponent.hand)for(let R=0;R<3;R++){const F=Za(a,"opponent",R,!0,C.protocol),L=Za(a,"opponent",R,!1,C.protocol);if(!F.allowed&&!L.allowed||a.opponent.compiled[R])continue;const O=a.player.laneValues[R]>=10&&a.player.laneValues[R]>a.opponent.laneValues[R]&&!a.player.compiled[R];if(O){const k=Math.max(F.allowed?C.value:0,L.allowed?pa({...C,isFaceUp:!1},a.opponent.lanes[R]):0);if(a.opponent.laneValues[R]+k<a.player.laneValues[R]&&!Kr.some(I=>C.keywords[I]))continue}let T=!1;if(Am(C)){let k=0;for(let A=0;A<3;A++)if(a.opponent.lanes[A].length>0){if(A===R)continue;k++}k===0&&(T=!0)}if(nu(C)){const k=a.opponent.laneValues[R],A=Math.max(0,10-C.value);if(k<A)continue;const I=k+C.value,$=a.player.laneValues[R];if(I<=$)continue}const G=hx(a,"opponent",R);if(G!==null){const k=a.opponent.laneValues[R],A=k+C.value-G,I=A>=10&&A>a.player.laneValues[R],$=k-G>=4;if(!I&&!$)continue}const V=O;let z=!1;if(Dm(C)){let k=0;for(let A=0;A<3;A++){const I=a.opponent.lanes[A];if(I.length>0&&A!==R){const $=I[I.length-1],q=$.isFaceUp?$.value:2;q>k&&(k=q)}}C.value>=k&&(z=!0)}if(F.allowed&&!l&&!z&&!T){let k=0,A=`Play ${C.protocol}-${C.value} face-up in lane ${R}`;const I=C.value,$=a.opponent.laneValues[R]+I;if(V)$>a.player.laneValues[R]?(k=180+$*5,A+=" [Blocks compile!]"):(k=-150,A+=" [Fails to block]");else{if(k+=I*10,$>=10&&$>a.player.laneValues[R]&&!a.opponent.compiled[R])k+=200,A+=` [COMPILE: ${$}]`;else if($>=8&&$<10&&!a.opponent.compiled[R]){const M=a.opponent.lanes[R].some(W=>W.isFaceUp&&W.protocol==="Darkness"&&W.value===2)?4:2;a.opponent.laneValues[R]+M>=10&&$<10?(k-=50,A+=` [Near ${$} but face-down could compile!]`):(k+=40,A+=` [Near compile: ${$}]`)}c&&I<=2&&(k-=50,A+=" [Low value early game penalty]"),E(C,R)||(k-=80,A+=" [No valid targets for effect]"),b(C)&&(k-=30,A+=" [Draw would cause discard]");const q=Kr.some(M=>C.keywords[M]);if(q&&u?d&&a.player.laneValues[R]>=5?(k+=35,A+=" [Disruption with targets]"):a.player.laneValues[R]>=8&&(k+=50,A+=" [Disruption near compile]"):q&&!u&&(k-=40,A+=" [Disruption but no targets]"),S!==-1&&!x&&(R===S?(k+=150,A+=" [FOCUS LANE]"):(k-=100,A+=" [Not focus lane]")),x){const M=a.opponent.laneValues[R]>a.player.laneValues[R],B=$>a.player.laneValues[R],W=a.opponent.laneValues[R]===a.player.laneValues[R];if(M)k-=200,A+=" [ALREADY LEADING - DON'T WASTE!]";else if(!M&&B)y===1?(k+=500,A+=" [CONTROL CAPTURE! 1->2 leads]"):y===0?(k+=300,A+=" [First lead! 0->1 leads]"):(k+=100,A+=" [Extra lead]");else if(W&&B)y===1?(k+=450,A+=" [BREAK TIE FOR CONTROL!]"):(k+=250,A+=" [Break tie]");else if(!M&&!B&&y===1){const K=a.player.laneValues[R]-$;K<=3?(k+=200,A+=` [BUILD toward 2nd lead, gap=${K}]`):K<=6?(k+=150,A+=` [BUILD toward 2nd lead, gap=${K}]`):(k+=100,A+=` [BUILD toward 2nd lead, gap=${K}]`)}}}t.push({move:{type:"playCard",cardId:C.id,laneIndex:R,isFaceUp:!0},score:im(k),reason:A})}if(L.allowed){const k=pa({...C,isFaceUp:!1},a.opponent.lanes[R]),A=a.opponent.laneValues[R]+k,I=a.opponent.laneValues[R];let $=-100,q=`Play ${C.protocol}-${C.value} face-down in lane ${R}`;if(V?A>=a.player.laneValues[R]?($=150,q+=` [Blocks compile: ${A} vs ${a.player.laneValues[R]}]`):($=-200,q+=" [Fails to block]"):!a.opponent.compiled[R]&&A>=10&&A>a.player.laneValues[R]?($=300,q+=` [COMPILE: Face-down finishes at ${I} -> ${A} beats player ${a.player.laneValues[R]}]`):!a.opponent.compiled[R]&&a.player.laneValues[R]>=10&&A>=a.player.laneValues[R]?($=250,q+=` [BLOCK COMPILE: Face-down reaches ${A} vs player ${a.player.laneValues[R]}]`):!a.opponent.compiled[R]&&a.player.laneValues[R]>=10&&A<a.player.laneValues[R]?($=-200,q+=` [WASTED: ${A} vs player ${a.player.laneValues[R]} - player still compiles!]`):S===R&&!a.opponent.compiled[R]&&I>=4?($=50+I*10,q+=` [BUILD FOCUS: ${I} -> ${A}]`):!F.allowed&&C.value<=1?($=-20,q+=" [No face-up option, low value]"):($=-120,q+=" [Avoid: Face-up is better]"),S!==-1&&$<50&&!x&&(R===S?($+=50,q+=" [Focus lane]"):($-=80,q+=" [Not focus lane]")),x){const M=a.opponent.laneValues[R]>a.player.laneValues[R],B=A>a.player.laneValues[R],W=a.opponent.laneValues[R]===a.player.laneValues[R];if(M)$-=200,q+=" [FD ALREADY LEADING - DON'T WASTE!]";else if(!M&&B)y===1?($+=400,q+=" [FD CONTROL CAPTURE! 1->2 leads]"):y===0&&($+=250,q+=" [FD First lead!]");else if(W&&B)y===1?($+=350,q+=" [FD BREAK TIE FOR CONTROL!]"):($+=200,q+=" [FD Break tie]");else if(!M&&!B&&y===1){const K=a.player.laneValues[R]-A;K<=3?($+=150,q+=` [FD BUILD toward 2nd lead, gap=${K}]`):K<=6&&($+=100,q+=` [FD BUILD toward 2nd lead, gap=${K}]`)}}t.push({move:{type:"playCard",cardId:C.id,laneIndex:R,isFaceUp:!1},score:im($),reason:q})}}if(a.opponent.hand.length===0)t.push({move:{type:"fillHand"},score:500,reason:"Must refill - no cards"});else{const C=a.player.laneValues.some((L,O)=>L>=10&&L>a.opponent.laneValues[O]&&!a.player.compiled[O]),R=a.controlCardHolder==="opponent",F=a.player.compiled.some(L=>L);C&&R&&F&&t.push({move:{type:"fillHand"},score:200,reason:"Emergency draw to block compile with control swap"})}if(t.length===0)return{type:"fillHand"};t.sort((C,R)=>R.score-C.score);const j=C=>{if(C.type==="playCard"&&C.isFaceUp){const R=a.opponent.hand.find(L=>L.id===C.cardId);if(!R)return!1;const F=Za(a,"opponent",C.laneIndex,!0,R.protocol);if(!F.allowed)return console.warn(`[AI Safety] Rejecting invalid face-up play: ${R.protocol}-${R.value} in lane ${C.laneIndex} - ${F.reason}`),!1}return!0};if(Br()&&t.length>1&&t[1].score>0&&j(t[1].move))return t[1].move;for(const C of t)if(j(C.move))return C.move;return console.warn("[AI Safety] No valid moves found, falling back to fillHand"),{type:"fillHand"}},xx=(a,t)=>{var l,i;switch(t.type){case"prompt_use_control_mechanic":{const c=a.player.compiled.filter(p=>p).length,d=a.compilableLanes.length>0?a.compilableLanes[0]:null;let f=-1;for(let p=0;p<3;p++)if(!a.player.compiled[p]&&a.player.laneValues[p]>=10&&a.player.laneValues[p]>a.opponent.laneValues[p]){f=p;break}const u=a.player.compiled.map((p,m)=>p?m:-1).filter(p=>p!==-1);return f!==-1&&u.length>0?{type:"resolveControlMechanicPrompt",choice:"player"}:c===0?cm(a,d)&&!Br()?{type:"resolveControlMechanicPrompt",choice:"opponent"}:{type:"resolveControlMechanicPrompt",choice:"skip"}:fx(a,d)?{type:"resolveControlMechanicPrompt",choice:"player"}:cm(a,d)&&!Br()?{type:"resolveControlMechanicPrompt",choice:"opponent"}:{type:"resolveControlMechanicPrompt",choice:"skip"}}case"discard":return{type:"discardCards",cardIds:[...a.opponent.hand].sort((d,f)=>{const u=Kr.some(m=>d.keywords[m]),p=Kr.some(m=>f.keywords[m]);return u&&!p?1:!u&&p?-1:Ht(d)-Ht(f)}).slice(0,t.count).map(d=>d.id)};case"discard_completed":return{type:"skip"};case"select_opponent_card_to_flip":{const d=(u=>a[u].lanes.map(p=>p.length>0?p[p.length-1]:null).filter(p=>p!==null))("player");if(d.length===0)return{type:"skip"};const f=d.map(u=>({cardId:u.id,score:u.isFaceUp?u.value+5:3}));return f.sort((u,p)=>p.score-u.score),{type:"flipCard",cardId:f[0].cardId}}case"select_cards_to_delete":{const c=t.disallowedIds||[],d=t.allowedIds,f=t.targetFilter??{},u="actorChooses"in t?t.actorChooses:"effect_owner",p=t.sourceCardId;if(u==="card_owner"&&(f==null?void 0:f.owner)==="opponent"){const v=[];return a.opponent.lanes.forEach(x=>{if(x.length>0){const w=x[x.length-1];if(Vr(w,!0,f,p)){if(d&&!d.includes(w.id))return;v.push(w)}}}),v.length>0?(v.sort((x,w)=>x.value-w.value),{type:"deleteCard",cardId:v[0].id}):{type:"skip"}}const m=v=>a[v].lanes.map(x=>x.length>0?x[x.length-1]:null).filter(x=>x!==null).filter(x=>Vr(x,!0,f,p)).filter(x=>!d||d.includes(x.id)),y=f==null?void 0:f.owner;if(y==="own"){const v=m("opponent").filter(x=>!c.includes(x.id));if(v.length>0)return{type:"deleteCard",cardId:v.sort((w,S)=>w.value-S.value)[0].id}}else if(y==="opponent"){const v=m("player").filter(x=>!c.includes(x.id));if(v.length>0){const x=v.map(w=>{const S=a.player.lanes.findIndex(j=>j.some(C=>C.id===w.id)),E=a.player.laneValues[S],b=E>=10&&E>a.opponent.laneValues[S];return{cardId:w.id,score:zr(w,"player",a)+E+(b?50:0)}});return x.sort((w,S)=>S.score-w.score),{type:"deleteCard",cardId:x[0].cardId}}}else{const v=m("player").filter(w=>!c.includes(w.id));if(v.length>0){const w=v.map(S=>{const E=a.player.lanes.findIndex(C=>C.some(R=>R.id===S.id)),b=a.player.laneValues[E],j=b>=10&&b>a.opponent.laneValues[E];return{cardId:S.id,score:zr(S,"player",a)+b+(j?50:0)}});return w.sort((S,E)=>E.score-S.score),{type:"deleteCard",cardId:w[0].cardId}}const x=m("opponent").filter(w=>!c.includes(w.id));if(x.length>0)return{type:"deleteCard",cardId:x.sort((S,E)=>S.value-E.value)[0].id}}return{type:"skip"}}case"select_any_card_to_flip":case"select_any_other_card_to_flip":case"select_any_face_down_card_to_flip_optional":case"select_any_card_to_flip_optional":{const c=Sa(a),d=t.targetFilter,f=t.sourceCardId,u=t.actor,p=t.currentLaneIndex??t.laneIndex,m=t.scope,y=[];for(const x of["player","opponent"])if(!(d&&(d.owner==="own"&&x!==u||d.owner==="opponent"&&x===u)))for(let w=0;w<a[x].lanes.length;w++){if(p!==void 0&&w!==p||m==="this_lane"&&p!==void 0&&w!==p)continue;const S=a[x].lanes[w];if(S.length!==0)for(let E=0;E<S.length;E++){const b=S[E],j=E===S.length-1;if(d){if(!Vr(b,j,d,f))continue}else if(!j)continue;c&&!b.isFaceUp||y.push({card:b,owner:x})}}if(y.length===0)return{type:"skip"};const v=y.map(({card:x,owner:w})=>{let S=0,E=-1;for(let L=0;L<a[w].lanes.length;L++)if(a[w].lanes[L].some(O=>O.id===x.id)){E=L;break}const b=E>=0?a[w].laneValues[E]:0,j=E>=0?a[w].compiled[E]:!1,C=x.isFaceUp?x.value:2,F=(x.isFaceUp?2:x.value)-C;return w==="player"?x.isFaceUp?(S=-F*15,S+=zr(x,"player",a)):x.value<=1?S=20:S=-30:x.isFaceUp?F>0?(S=F*20+50,!j&&b+F>=10&&(S+=200)):S=F*15-30:F>0?(S=F*20+40,!j&&b+F>=10&&(S+=200)):S=-10,{cardId:x.id,score:S}});return v.sort((x,w)=>w.score-x.score),{type:"flipCard",cardId:v[0].cardId}}case"plague_2_opponent_discard":return a.opponent.hand.length===0?{type:"skip"}:{type:"discardCards",cardIds:[[...a.opponent.hand].sort((d,f)=>Ht(d)-Ht(f))[0].id]};case"select_cards_from_hand_to_discard_for_fire_4":{const c=Math.min(3,a.opponent.hand.length);return c===0?{type:"skip"}:{type:"discardCards",cardIds:[...a.opponent.hand].sort((u,p)=>Ht(u)-Ht(p)).slice(0,c).map(u=>u.id)}}case"select_cards_from_hand_to_discard_for_hate_1":{const c=Math.min(t.count||1,a.opponent.hand.length);return c===0?{type:"skip"}:{type:"discardCards",cardIds:[...a.opponent.hand].sort((u,p)=>Ht(u)-Ht(p)).slice(0,c).map(u=>u.id)}}case"select_card_from_hand_to_play":{if(a.opponent.hand.length===0)return{type:"skip"};const c=t.faceDown===!0,d=t.selectableCardIds,f=d?a.opponent.hand.filter(y=>d.includes(y.id)):a.opponent.hand;if(f.length===0)return{type:"skip"};let u=t.validLanes||[0,1,2].filter(y=>y!==t.disallowedLaneIndex);if(u=u.filter(y=>{const v=a.player.lanes[y],x=v.length>0?v[v.length-1]:null;return!(x&&x.isFaceUp&&x.protocol==="Plague"&&x.value===0)}),u.length===0)return{type:"skip"};const p=[];for(const y of f)for(const v of u){if(!c){const S=a.opponent.lanes.flat().some(C=>C.isFaceUp&&C.protocol==="Spirit"&&C.value===1),E=a.opponent.lanes.some(C=>{if(C.length===0)return!1;const R=C[C.length-1];return R.isFaceUp&&R.protocol==="Chaos"&&R.value===3}),b=[...a.player.lanes.flat(),...a.opponent.lanes.flat()].some(C=>C.isFaceUp&&C.protocol==="Anarchy"&&C.value===1);let j;if(b?j=y.protocol!==a.opponent.protocols[v]&&y.protocol!==a.player.protocols[v]:j=y.protocol===a.opponent.protocols[v]||y.protocol===a.player.protocols[v]||S||E,j){const C=y.value,R=a.opponent.laneValues[v]+C;let F=Ht(y)+C*2;R>=10&&R>a.player.laneValues[v]&&(F+=100);const L=a.player.laneValues[v],O=a.player.compiled[v],T=a.opponent.compiled[v],G=a.opponent.laneValues[v];!O&&!T&&L>=10&&L>G&&R>=L&&(F+=160),p.push({cardId:y.id,laneIndex:v,isFaceUp:!0,score:F})}}if(!a.player.lanes[v].some(S=>S.isFaceUp&&S.protocol==="Metal"&&S.value===2)){const S=pa({...y,isFaceUp:!1},a.opponent.lanes[v]),E=a.opponent.laneValues[v]+S;let b=S*2;E>=10&&E>a.player.laneValues[v]&&(b+=80);const j=a.player.laneValues[v],C=a.player.compiled[v],R=a.opponent.compiled[v],F=a.opponent.laneValues[v];!C&&!R&&j>=10&&j>F&&E>=j&&(b+=150),p.push({cardId:y.id,laneIndex:v,isFaceUp:!1,score:b})}}if(p.length===0)return{type:"skip"};p.sort((y,v)=>v.score-y.score);const m=p[0];return{type:"playCard",cardId:m.cardId,laneIndex:m.laneIndex,isFaceUp:m.isFaceUp}}case"select_card_from_hand_to_give":return a.opponent.hand.length===0?{type:"skip"}:{type:"giveCard",cardId:[...a.opponent.hand].sort((d,f)=>Ht(d)-Ht(f))[0].id};case"select_card_from_hand_to_reveal":return a.opponent.hand.length===0?{type:"skip"}:{type:"revealCard",cardId:[...a.opponent.hand].sort((d,f)=>Ht(f)-Ht(d))[0].id};case"select_card_to_return":case"select_opponent_card_to_return":{const d={position:"uncovered",...t.targetFilter||{}},f=t.targetOwner||d.owner,u=t.sourceCardId,p=t.actor,m=[];for(const x of["player","opponent"])if(!(f==="own"&&x!==p)&&!(f==="opponent"&&x===p))for(const w of a[x].lanes)for(let S=0;S<w.length;S++){const E=w[S],b=S===w.length-1;Vr(E,b,d,u)&&m.push({card:E,owner:x})}if(m.length===0)return{type:"skip"};const y=m.filter(x=>x.owner==="player"),v=m.filter(x=>x.owner==="opponent");return y.length>0?(y.sort((x,w)=>zr(w.card,"player",a)-zr(x.card,"player",a)),{type:"returnCard",cardId:y[0].card.id}):v.length>0?(v.sort((x,w)=>x.card.value-w.card.value),{type:"returnCard",cardId:v[0].card.id}):{type:"returnCard",cardId:m[0].card.id}}case"select_lane_for_play":{let c=t.validLanes||[0,1,2];if(c=c.filter(u=>!("disallowedLaneIndex"in t)||u!==t.disallowedLaneIndex),c=c.filter(u=>{const p=a.player.lanes[u],m=p.length>0?p[p.length-1]:null,y=m&&m.isFaceUp&&m.protocol==="Plague"&&m.value===0,v="isFaceDown"in t&&t.isFaceDown&&p.some(x=>x.isFaceUp&&x.protocol==="Metal"&&x.value===2);return!y&&!v}),c.length===0)return{type:"skip"};const d=c.filter(u=>{const p=a.player.laneValues[u],m=a.opponent.laneValues[u],y=a.player.compiled[u],v=a.opponent.compiled[u],x=!y&&p>=10&&p>m,w=m+2>=p;return x&&w&&!v});if(d.length>0)return d.sort((u,p)=>a.player.laneValues[p]-a.player.laneValues[u]),{type:"selectLane",laneIndex:d[0]};const f=c.map(u=>{const p=a.opponent.laneValues[u]-a.player.laneValues[u];return{laneIndex:u,score:-p}});return f.sort((u,p)=>p.score-u.score),{type:"selectLane",laneIndex:f[0].laneIndex}}case"prompt_rearrange_protocols":return Rm(a,t);case"prompt_swap_protocols":{const{target:c}=t,d=a[c].protocols,f=a[c].hand,u=a[c].compiled,p=a[c].laneValues,m=[[0,1],[0,2],[1,2]];let y=[0,1],v=-1/0;for(const x of m){const[w,S]=x,E=[...d];[E[w],E[S]]=[E[S],E[w]];let b=0;const j=u[w],C=u[S],R=p[w],F=p[S];if(c==="opponent"){j&&!C?F<R&&(b+=30):C&&!j&&R<F&&(b+=30);for(const L of f){const O=L.protocol===d[w],T=L.protocol===d[S],G=L.protocol===E[w],V=L.protocol===E[S],z=j?.5:1.5,U=C?.5:1.5;G&&!O&&(b+=Ht(L)*z),V&&!T&&(b+=Ht(L)*U),!G&&O&&(b-=Ht(L)*z),!V&&T&&(b-=Ht(L)*U)}}else{j&&!C?R>F&&(b+=25):C&&!j&&F>R&&(b+=25);for(const L of f){const O=L.protocol===d[w],T=L.protocol===d[S],G=L.protocol===E[w],V=L.protocol===E[S],z=j?.5:1.5,U=C?.5:1.5;G&&!O&&(b-=Ht(L)*z),V&&!T&&(b-=Ht(L)*U),!G&&O&&(b+=Ht(L)*z),!V&&T&&(b+=Ht(L)*U)}}b>v&&(v=b,y=x)}return{type:"resolveSwapProtocols",indices:y}}case"select_lane_for_shift":{let c=t.validLanes||[0,1,2];if(c=c.filter(d=>!("disallowedLaneIndex"in t)||d!==t.disallowedLaneIndex).filter(d=>!("originalLaneIndex"in t)||d!==t.originalLaneIndex),"sourceCardId"in t){const d=[...a.player.lanes.flat(),...a.opponent.lanes.flat()].find(f=>f.id===t.sourceCardId);if(d&&d.protocol==="Gravity"&&d.value===1){let f=null;for(let u=0;u<3;u++)if([...a.player.lanes[u],...a.opponent.lanes[u]].some(m=>m.id===t.sourceCardId)){f=u;break}f!==null&&"originalLaneIndex"in t&&(t.originalLaneIndex===f||(c=[f]))}if(d&&d.protocol==="Anarchy"&&d.value===1){const f="cardToShiftId"in t?t.cardToShiftId:null;if(f){const u=[...a.player.lanes.flat(),...a.opponent.lanes.flat()].find(p=>p.id===f);u&&(c=c.filter(p=>{const m=a.player.protocols[p],y=a.opponent.protocols[p],v=u.protocol;return v!==m&&v!==y}))}}}if(c.length>0){const d="cardToShiftId"in t?t.cardToShiftId:null;let f=null,u=0;if(d)for(const m of["player","opponent"]){for(const y of a[m].lanes){const v=y.find(x=>x.id===d);if(v){f=m,u=v.isFaceUp?v.value:2;break}}if(f)break}const p=c.map(m=>{let y=0;const v=a.player.laneValues[m],x=a.opponent.laneValues[m],w=a.player.compiled[m],S=a.opponent.compiled[m];return f==="player"?w?y+=100:x>v?y+=50:v>=6&&v<10&&!w&&(y-=50):f==="opponent"&&(!S&&x<10?x+u>=10?y+=100:x>=6?y+=60:y+=30:S&&(y-=50)),{laneIdx:m,score:y}});if(p.sort((m,y)=>y.score-m.score),Br()&&p.length>1){const m=Math.floor(Math.random()*p.length);return{type:"selectLane",laneIndex:p[m].laneIdx}}return{type:"selectLane",laneIndex:p[0].laneIdx}}return{type:"selectLane",laneIndex:0}}case"select_lane_for_delete_all":{const c="validLanes"in t?t.validLanes:[0,1,2];return c.length>0?{type:"selectLane",laneIndex:c[Math.floor(Math.random()*c.length)]}:{type:"skip"}}case"select_lanes_for_swap_stacks":{const c=t.validLanes,d=t.selectedFirstLane;if(c.length===0)return{type:"skip"};if(d===void 0){const f=c.map(u=>{const p=a.opponent.laneValues[u];return{laneIdx:u,score:p}});return f.sort((u,p)=>u.score-p.score),{type:"selectLane",laneIndex:f[0].laneIdx}}else{const f=c.map(u=>{const p=a.opponent.laneValues[u];return{laneIdx:u,score:p}});return f.sort((u,p)=>p.score-u.score),{type:"selectLane",laneIndex:f[0].laneIdx}}}case"select_card_for_copy_middle":{const c=t.validTargetIds||[];if(c.length===0)return{type:"skip"};const d=c.map(f=>{var p,m;let u=0;for(const y of["player","opponent"])for(const v of a[y].lanes){const x=v.find(w=>w.id===f);if(x){const S=((p=x.customEffects)==null?void 0:p.middleEffects)||[];for(const E of S){const b=(m=E.params)==null?void 0:m.action;b==="draw"&&(u+=5),b==="flip"&&(u+=3),b==="delete"&&(u+=4),b==="shift"&&(u+=2),b==="discard"&&(u-=2)}}}return{cardId:f,score:u}});return d.sort((f,u)=>u.score-f.score),{type:"selectCard",cardId:d[0].cardId}}case"select_lane_for_return":{const c=t.targetFilter||{},d=t.actor,f=c.valueEquals,u=c.valueRange,p=[];for(let m=0;m<3;m++){let y=0,v=0;const x=Fm(a,m);for(const E of["player","opponent"]){if(c.owner==="own"&&E!==d||c.owner==="opponent"&&E===d)continue;const b=a[E].lanes[m];for(let j=0;j<b.length;j++){const C=b[j],R=j===b.length-1;if(c.position==="uncovered"&&!R||c.position==="covered"&&R)continue;const F=C.isFaceUp?C.value:2+x;f!==void 0&&F!==f||u&&(F<u.min||F>u.max)||(E==="player"?y+=F:v+=F)}}const w=y-v,S=`Lane ${m}: Player loses ${y}, we lose ${v}, net=${w}`;p.push({laneIndex:m,score:w,reason:S})}p.sort((m,y)=>y.score-m.score);for(const m of p);return p.length>0?{type:"selectLane",laneIndex:p[0].laneIndex}:{type:"selectLane",laneIndex:0}}case"prompt_optional_effect":{const{effectDef:c}=t,d=(l=c==null?void 0:c.params)==null?void 0:l.action,f=(i=c==null?void 0:c.params)==null?void 0:i.targetFilter;if(d==="give")return{type:"resolveOptionalEffectPrompt",accept:!1};if(d==="flip"){let u=!1;const p=(f==null?void 0:f.position)||"uncovered";for(const m of["player","opponent"])if(!((f==null?void 0:f.owner)==="own"&&m!=="opponent")&&!((f==null?void 0:f.owner)==="opponent"&&m==="opponent")){for(let y=0;y<a[m].lanes.length;y++){const v=a[m].lanes[y];if(v.length!==0){for(let x=0;x<v.length;x++){const w=v[x],S=x===v.length-1,E=!S;if(p==="uncovered"&&!S||p==="covered"&&!E||(f==null?void 0:f.faceState)==="face_up"&&!w.isFaceUp||(f==null?void 0:f.faceState)==="face_down"&&w.isFaceUp)continue;const b=w.isFaceUp?w.value:2,j=w.isFaceUp?2:w.value;if(m==="player"){if(w.isFaceUp&&b>j){u=!0;break}}else{const C=a.opponent.laneValues[y],R=j-b;if(w.isFaceUp&&R>0){u=!0;break}if(!w.isFaceUp&&w.value>2){u=!0;break}if(R>0&&C+R>=10&&!a.opponent.compiled[y]){u=!0;break}}}if(u)break}}if(u)break}return{type:"resolveOptionalEffectPrompt",accept:u}}return{type:"resolveOptionalEffectPrompt",accept:!Br()}}case"select_card_from_other_lanes_to_delete":{const{disallowedLaneIndex:c,lanesSelected:d}=t,f=[];for(let u=0;u<3;u++){if(u===c||d.includes(u))continue;const p=a.player.lanes[u];if(p.length>0){f.push(p[p.length-1]);continue}const m=a.opponent.lanes[u];m.length>0&&f.push(m[m.length-1])}return f.length>0?{type:"deleteCard",cardId:f[0].id}:{type:"skip"}}case"select_face_down_card_to_delete":{const c="disallowedIds"in t&&Array.isArray(t.disallowedIds)?t.disallowedIds:[],d=p=>a[p].lanes.map(m=>m.length>0?m[m.length-1]:null).filter(m=>m!==null),f=d("player").filter(p=>!c.includes(p.id));if(f.length>0)return{type:"deleteCard",cardId:f[0].id};const u=d("opponent").filter(p=>!c.includes(p.id));return u.length>0?{type:"deleteCard",cardId:u[0].id}:{type:"skip"}}case"select_low_value_card_to_delete":{const c=[];for(const f of["player","opponent"])for(const u of a[f].lanes)u.length>0&&c.push(u[u.length-1]);const d=c.filter(f=>f.isFaceUp&&(f.value===0||f.value===1));return d.length>0?{type:"deleteCard",cardId:d[0].id}:{type:"skip"}}case"select_opponent_face_up_card_to_flip":{const d=(f=>a[f].lanes.map(u=>u.length>0?u[u.length-1]:null).filter(u=>u!==null))("player").filter(f=>f.isFaceUp);return d.length>0?(d.sort((f,u)=>u.value-f.value),{type:"flipCard",cardId:d[0].id}):{type:"skip"}}case"select_covered_card_in_line_to_flip_optional":{const c="optional"in t&&t.optional,f=!["select_any_other_card_to_flip","select_any_other_card_to_flip_for_water_0"].includes(t.type);if(t.type==="select_covered_card_in_line_to_flip_optional"){const{laneIndex:x}=t,w=a.opponent.lanes[x],S=a.player.lanes[x],E=w.filter((O,T,G)=>T<G.length-1),b=S.filter((O,T,G)=>T<G.length-1),j=a.opponent.laneValues[x];if(!a.opponent.compiled[x]){let O=null,T=null;for(const G of E){let V,z;G.isFaceUp?(V=G.value,z=2):(V=pa(G,w,a,x,"opponent"),z=G.value);const U=z-V,k=j+U;U>0&&k>=10&&(!O||k>O.newValue)&&(O={card:G,newValue:k,gain:U}),U>0&&(!T||U>T.gain)&&(T={card:G,gain:U,newValue:k})}if(O)return{type:"flipCard",cardId:O.card.id};if(T&&T.gain>0)return{type:"flipCard",cardId:T.card.id}}if(a.opponent.compiled[x]){let O=null;for(const T of E){const G=T.isFaceUp?T.value:pa(T,w,a,x,"opponent"),z=(T.isFaceUp?2:T.value)-G;z>0&&(!O||z>O.gain)&&(O={card:T,gain:z})}if(O)return{type:"flipCard",cardId:O.card.id}}const R=b.filter(O=>O.isFaceUp);if(R.length>0)return R.sort((O,T)=>T.value-O.value),{type:"flipCard",cardId:R[0].id};const F=E.filter(O=>!O.isFaceUp).map(O=>({card:O,gain:O.value-pa(O,w,a,x,"opponent")})).filter(O=>O.gain>0).sort((O,T)=>T.gain-O.gain);if(F.length>0)return{type:"flipCard",cardId:F[0].card.id};const L=b.filter(O=>!O.isFaceUp);return L.length>0?{type:"flipCard",cardId:L[0].id}:{type:"skip"}}const u=x=>a[x].lanes.map(w=>w.length>0?w[w.length-1]:null).filter(w=>w!==null),p=u("player"),m=u("opponent");{const x=p.filter(w=>w.isFaceUp).sort((w,S)=>S.value-w.value);if(x.length>0)return{type:"flipCard",cardId:x[0].id}}const y=m.filter(x=>!x.isFaceUp);if(y.length>0)return{type:"flipCard",cardId:y[0].id};const v=p.filter(x=>!x.isFaceUp);if(v.length>0)return{type:"flipCard",cardId:v[0].id};{const x=m.filter(S=>!(!S.isFaceUp||!f&&S.id===t.sourceCardId)),w=x.filter(S=>{const E=a.opponent.lanes.findIndex(b=>b.length>0&&b[b.length-1].id===S.id);return E!==-1&&a.opponent.compiled[E]});if(w.length>0&&!c)return{type:"flipCard",cardId:w[0].id};if(x.length>0&&!c)return{type:"flipCard",cardId:x[0].id}}return{type:"skip"}}case"select_card_to_shift_for_anarchy_0":{const c=[...a.player.lanes.flat(),...a.opponent.lanes.flat()];return c.length>0?{type:"shiftCard",cardId:c[Math.floor(Math.random()*c.length)].id}:{type:"skip"}}case"select_card_to_shift_for_anarchy_1":{const{sourceCardId:c}=t,d=[...a.player.lanes.flat(),...a.opponent.lanes.flat()].filter(f=>f.id!==c);return d.length>0?{type:"shiftCard",cardId:d[Math.floor(Math.random()*d.length)].id}:{type:"skip"}}case"select_card_to_shift_for_gravity_1":{const c=[...a.player.lanes.flat(),...a.opponent.lanes.flat()];return c.length>0?{type:"shiftCard",cardId:c[Math.floor(Math.random()*c.length)].id}:{type:"skip"}}case"select_face_down_card_to_shift_for_gravity_4":{const{targetLaneIndex:c}=t,d=[];for(const u of["player","opponent"])for(let p=0;p<a[u].lanes.length;p++){if(p===c)continue;const m=a[u].lanes[p];if(m.length===0)continue;const y=m[m.length-1];y.isFaceUp||d.push({card:y,owner:u,laneIndex:p})}if(d.length===0)return{type:"skip"};const f=d.map(u=>{let p=0;const m=2;if(u.owner==="opponent"){a.opponent.laneValues[u.laneIndex];const y=a.opponent.laneValues[c],v=a.opponent.compiled[c],x=a.opponent.compiled[u.laneIndex];if(!v&&y<10){const w=y+m;w>=10&&w>a.player.laneValues[c]?p+=100:w>a.player.laneValues[c]&&(p+=30)}x&&(p+=10)}else{const y=a.player.lanes[u.laneIndex],v=a.player.laneValues[u.laneIndex],x=a.player.compiled[u.laneIndex],w=a.opponent.compiled[c];y.length>1&&y[y.length-2].isFaceUp&&(p-=30);const E=v-m;!x&&v>=10&&E<10&&(p+=40),w&&(p+=10),p+=5}return{...u,score:p}});return f.sort((u,p)=>p.score-u.score),{type:"shiftCard",cardId:f[0].card.id}}case"select_face_down_card_to_shift_for_darkness_4":{const c=[];for(const d of["player","opponent"])for(const f of a[d].lanes)if(f.length>0){const u=f[f.length-1];u.isFaceUp||c.push(u)}return c.length>0?{type:"deleteCard",cardId:c[Math.floor(Math.random()*c.length)].id}:{type:"skip"}}case"shift_flipped_card_optional":{const c=t.cardId,d=t.optional,f=we(a,c);if(!f)return{type:"skip"};const u=f.card,p=f.owner,m=u.isFaceUp?u.value:2;let y=f.laneIndex??-1;if(y===-1){const L=a[p];for(let O=0;O<L.lanes.length;O++)if(L.lanes[O].some(T=>T.id===c)){y=O;break}}if(y===-1)return{type:"skip"};const v=[0,1,2].filter(L=>L!==y);if(v.length===0)return{type:"skip"};const x=a.opponent,w=a.player,S=x.laneValues[y],E=x.compiled[y],b=w.laneValues[y],j=S-m;let C=-1,R=-1/0;const F=0;for(const L of v){const O=x.laneValues[L],T=x.compiled[L],G=w.laneValues[L],V=O+m;let z=0;!E&&S>=8&&S>b&&(z-=100),!T&&V>=10&&V>G&&(z+=80),!T&&O<S&&(E||S<6)&&(z+=20),T&&(z-=30),!T&&O<=G&&V>G&&(z+=25),!E&&S>b&&j<=b&&(z-=40),z>R&&(R=z,C=L)}return d&&R<F?{type:"skip"}:C!==-1?{type:"selectLane",laneIndex:C}:d?{type:"skip"}:{type:"selectLane",laneIndex:v[0]}}case"select_opponent_face_down_card_to_shift":{const c=[];for(const d of a.player.lanes)if(d.length>0){const f=d[d.length-1];f.isFaceUp||c.push(f)}return c.length>0?{type:"deleteCard",cardId:c[Math.floor(Math.random()*c.length)].id}:{type:"skip"}}case"select_opponent_covered_card_to_shift":{const c=[];for(const d of a.player.lanes)for(let f=0;f<d.length-1;f++)c.push(d[f]);return c.length>0?{type:"deleteCard",cardId:c[Math.floor(Math.random()*c.length)].id}:{type:"skip"}}case"select_own_covered_card_to_shift":{const c=[];for(const d of a.opponent.lanes)for(let f=0;f<d.length-1;f++)c.push(d[f]);return c.length>0?{type:"deleteCard",cardId:c[Math.floor(Math.random()*c.length)].id}:{type:"skip"}}case"select_card_to_flip":{const c=t.targetFilter||{},d=t.restrictedLaneIndex??t.currentLaneIndex??t.laneIndex,f=t.scope,u=t.actor,p=t.sourceCardId,m=[];for(const v of["player","opponent"])if(!(c.owner==="own"&&v!==u)&&!(c.owner==="opponent"&&v===u))for(let x=0;x<a[v].lanes.length;x++){if(d!==void 0&&x!==d||f==="this_lane"&&d!==void 0&&x!==d)continue;const w=a[v].lanes[x];for(let S=0;S<w.length;S++){const E=w[S];if(Do(a,E.id))continue;const b=Fo(a,w,S);if(Vr(E,b,c,p)&&!(c.position==="covered_in_this_line"&&b)){if(c.valueMinGreaterThanHandSize){const j=a[u].hand.length;if(E.value<=j)continue}m.push({card:E,owner:v,laneIndex:x})}}}if(m.length===0)return{type:"skip"};const y=m.map(({card:v,owner:x,laneIndex:w})=>{let S=0;const E=a[x].laneValues[w],b=a[x].compiled[w],j=v.isFaceUp?v.value:2,R=(v.isFaceUp?2:v.value)-j;return x==="player"?v.isFaceUp?(S=-R*15,S+=zr(v,"player",a)):v.value<=1?S=20:S=-30:v.isFaceUp?R>0?(S=R*20+50,!b&&E+R>=10&&(S+=200)):S=R*15-30:R>0?(S=R*20+40,!b&&E+R>=10&&(S+=200)):S=-10,{card:v,score:S}});if(y.sort((v,x)=>x.score-v.score),Br()&&y.length>1){const v=Math.floor(Math.random()*y.length);return{type:"flipCard",cardId:y[v].card.id}}return{type:"flipCard",cardId:y[0].card.id}}case"select_card_to_shift":{const c=t.targetFilter||{},f=t.scope==="this_lane"?t.sourceLaneIndex??t.currentLaneIndex??t.laneIndex:void 0,u=t.actor,p=t.sourceCardId,m=[];for(const y of["player","opponent"])if(!(c.owner==="own"&&y!==u)&&!(c.owner==="opponent"&&y===u))for(let v=0;v<a[y].lanes.length;v++){if(f!==void 0&&v!==f)continue;const x=a[y].lanes[v];for(let w=0;w<x.length;w++){const S=x[w],E=w===x.length-1;Vr(S,E,c,p)&&m.push(S)}}return m.length>0?{type:"shiftCard",cardId:m[Math.floor(Math.random()*m.length)].id}:{type:"skip"}}case"select_board_card_to_reveal_custom":{const c=[];for(const d of["player","opponent"])for(const f of a[d].lanes)if(f.length>0){const u=f[f.length-1];u.isFaceUp||c.push({card:u,owner:d})}if(c.length>0){const d=c.filter(f=>f.owner==="player");return d.length>0?{type:"deleteCard",cardId:d[0].card.id}:{type:"deleteCard",cardId:c[0].card.id}}return{type:"skip"}}case"prompt_shift_or_flip_board_card_custom":{const{revealedCardId:c}=t,d=we(a,c);return d?d.owner==="opponent"?{type:"resolveRevealBoardCardPrompt",choice:"flip"}:{type:"resolveRevealBoardCardPrompt",choice:"shift"}:{type:"resolveRevealBoardCardPrompt",choice:"skip"}}case"select_lane_to_shift_revealed_board_card_custom":{const c=[0,1,2];return c.sort((d,f)=>a.player.laneValues[d]-a.player.laneValues[f]),{type:"selectLane",laneIndex:c[0]}}case"gravity_2_shift_after_flip":{const{targetLaneIndex:c}=t;return{type:"selectLane",laneIndex:c}}case"flip_self":case"flip_self_for_water_0":case"flip_self_for_psychic_4":case"speed_3_self_flip_after_shift":return t.sourceCardId?{type:"flipCard",cardId:t.sourceCardId}:{type:"skip"};case"anarchy_0_conditional_draw":return{type:"skip"};case"select_any_opponent_card_to_shift":{const c=a.player.lanes.map(d=>d.length>0?d[d.length-1]:null).filter(d=>d!==null);return c.length>0?{type:"deleteCard",cardId:c[Math.floor(Math.random()*c.length)].id}:{type:"skip"}}case"select_own_other_card_to_shift":{const c=a.opponent.lanes.flat().find(d=>d.id!==t.sourceCardId);return c?{type:"deleteCard",cardId:c.id}:{type:"skip"}}case"select_own_face_up_covered_card_to_flip":return{type:"skip"};case"plague_4_opponent_delete":{const c=[];return a.opponent.lanes.forEach(d=>{if(d.length>0){const f=d[d.length-1];f.isFaceUp||c.push(f)}}),c.length>0?(c.sort((d,f)=>d.value-f.value),{type:"deleteCard",cardId:c[0].id}):{type:"skip"}}case"reveal_opponent_hand":case"plague_2_player_discard":case"delete_self":return{type:"skip"};case"select_lane_for_delete":{const c=t.validLanes||[0,1,2],d=t.valueFilter,f=c.map(u=>{let p=0,m=0;for(const y of a.player.lanes[u]){const v=y.isFaceUp?y.value:2;d?y.isFaceUp?y.value>=d.min&&y.value<=d.max&&(p+=v+1):p+=(v+1)*.5:p+=v+1}for(const y of a.opponent.lanes[u]){const v=y.isFaceUp?y.value:2;d?y.isFaceUp?y.value>=d.min&&y.value<=d.max&&(m+=v+3):m+=(v+3)*.5:m+=v+3}return{laneIndex:u,score:p-m}});return f.sort((u,p)=>p.score-u.score),f[0].score>0?{type:"selectLane",laneIndex:f[0].laneIndex}:{type:"selectLane",laneIndex:f[0].laneIndex}}case"select_lane_for_shift_all":{const c=t.validDestinationLanes||t.validLanes||[0,1,2],d=t.sourceLaneIndex,f=c.filter(u=>u!==d);if(f.length>0){const u=f.map(p=>{let m=0;return m+=a.opponent.lanes[p].length*2,m+=a.opponent.laneValues[p],a.player.laneValues[p]>=8&&(m-=5),{laneIndex:p,score:m}});return u.sort((p,m)=>m.score-p.score),{type:"selectLane",laneIndex:u[0].laneIndex}}return c.length>0?{type:"selectLane",laneIndex:c[0]}:{type:"selectLane",laneIndex:0}}case"prompt_optional_draw":return{type:"resolveOptionalEffectPrompt",accept:!0};case"prompt_optional_discard_custom":return{type:"resolveOptionalEffectPrompt",accept:a.opponent.hand.length>4};case"prompt_optional_shuffle_trash":return{type:"resolvePrompt",accept:(t.trashCount||0)>0};case"select_card_from_revealed_deck":{const c=t.selectableCardIds||[];if(c.length>0){const d=Math.floor(Math.random()*c.length);return{type:"selectRevealedDeckCard",cardId:c[d]}}return{type:"resolvePrompt",accept:!1}}case"custom_choice":{const{options:c}=t;if(!c||c.length!==2)return{type:"resolveCustomChoice",optionIndex:0};const d=p=>{var v,x,w;let m=0;const y=((v=p.action)==null?void 0:v.toLowerCase())||"";return y.includes("draw")&&(m+=30),y.includes("discard")&&(m-=20),y.includes("delete")&&((x=p.targetFilter)==null?void 0:x.owner)==="opponent"&&(m+=40),y.includes("delete")&&((w=p.targetFilter)==null?void 0:w.owner)==="own"&&(m-=30),m},f=d(c[0]),u=d(c[1]);return{type:"resolveCustomChoice",optionIndex:f>=u?0:1}}case"select_phase_effect":{const c=t;if(c.availableEffects.length===0)return{type:"skip"};const d=c.availableEffects.map(u=>{let p=0;const m=u.effectDescription.toLowerCase();return m.includes("draw")?p+=100:m.includes("delete")?p+=80:m.includes("shift")?p+=60:m.includes("flip")?p+=40:p+=20,Math.random()<.2&&(p=Math.random()*50),{effect:u,score:p}});return d.sort((u,p)=>p.score-u.score),{type:"flipCard",cardId:d[0].effect.cardId}}case"state_number":{const c={0:0,1:0,2:0,3:0,4:0,5:0};a.opponent.hand.forEach(u=>{u.value>=0&&u.value<=5&&c[u.value]++}),c[2]+=2,c[3]+=2;let d=0,f=c[0];for(let u=1;u<=5;u++)c[u]>f&&(f=c[u],d=u);return Math.random()<.2&&(d=Math.floor(Math.random()*6)),{type:"stateNumber",number:d}}case"state_protocol":{const d=t.availableProtocols||[];if(d.length===0)return{type:"skip"};const f=a.player.protocols,u=d.map(p=>{let m=0;return f.includes(p)&&(m+=50),m+=Math.random()*20,{protocol:p,score:m}});return u.sort((p,m)=>m.score-p.score),{type:"stateProtocol",protocol:u[0].protocol}}case"select_from_drawn_to_reveal":{const d=t.eligibleCardIds||[];if(d.length===0)return{type:"skip"};const f=a.opponent.hand,u=d.map(p=>{const m=f.find(v=>v.id===p);if(!m)return{cardId:p,score:0};let y=m.value;return a.opponent.protocols.includes(m.protocol)&&(y+=10),{cardId:p,score:y}});return u.sort((p,m)=>m.score-p.score),{type:"selectFromDrawnToReveal",cardId:u[0].cardId}}case"confirm_deck_discard":return{type:"confirmDeckDiscard"};case"confirm_deck_play_preview":return{type:"confirmDeckPlayPreview"};default:{if("optional"in t&&t.optional)return{type:"skip"};const c=[...a.player.lanes.flat(),...a.opponent.lanes.flat()];return c.length>0&&(t.type.includes("select_")||t.type.includes("shift"))?{type:"deleteCard",cardId:c[0].id}:{type:"skip"}}}},dm=(a,t)=>t?xx(a,t):a.phase==="compile"&&a.compilableLanes.length>0?{type:"compile",laneIndex:a.compilableLanes.reduce((i,c)=>a.opponent.laneValues[c]>a.opponent.laneValues[i]?c:i)}:a.phase==="action"?_x(a):{type:"fillHand"};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const dt=(a,t)=>a.phase==="start"?t.continueTurnAfterStartPhaseAction(a):t.processEndOfAction(a),qm=(a,t,l,i,c,d,f,u)=>{const{cardId:p,laneIndex:m,isFaceUp:y}=t,{newState:v,animationRequests:x}=c.playCard({...a,actionRequired:null},p,m,y,"opponent"),w={...v,animationState:{type:"playCard",cardId:p,owner:"opponent"}};return setTimeout(()=>{l(S=>{let E={...S,animationState:null};return x&&x.length>0?(d(x,()=>l(b=>{const j={...b,animationState:null};return u&&j.actionRequired?(Sn(j,l,i,c,d,f),j):j.actionRequired&&j.actionRequired.actor==="opponent"?j:{...dt(j,f),animationState:null}})),E):u&&E.actionRequired?(Sn(E,l,i,c,d,f),E):E.actionRequired&&E.actionRequired.actor==="opponent"?E:dt(E,f)})},500),w},xc=(a,t,l)=>{switch(l){case"normal":return dm(a,t);case"hard":return console.warn("[AI] Hard AI temporarily disabled, using Normal AI"),dm(a,t);default:return vx(a,t)}},wx=(a,t,l,i,c,d,f,u,p)=>{t(m=>{const y=m.actionRequired;if(!y||!((m.turn==="player"||m._interruptedTurn==="player")&&"actor"in y&&y.actor==="opponent"))return m;if(y.type==="discard_completed"){const{followUpEffect:E,conditionalType:b,previousHandSize:j,sourceCardId:C,actor:R}=y;if(E&&C){const F=we(m,C);if(F){const L=m[R].hand.length,O=Math.max(0,(j||0)-L);if(b==="then"||b==="if_executed"&&O>0){let G=-1;for(let V=0;V<m[F.owner].lanes.length;V++)if(m[F.owner].lanes[V].some(z=>z.id===C)){G=V;break}if(G!==-1){const V={cardOwner:F.owner,opponent:F.owner==="player"?"opponent":"player",currentTurn:m.turn,actor:R,discardedCount:O},{executeCustomEffect:z}=require("../customProtocols/effectInterpreter");return z(F.card,G,{...m,actionRequired:null},V,E).newState}}}}return{...m,actionRequired:null}}const w=xc(m,y,l);if(w.type==="discardCards"&&y.type==="discard"){const b=y.variableCount===!0?w.cardIds.length:y.count,j=w.cardIds.slice(0,b);j.length!==w.cardIds.length&&console.warn(`[AI Manager] Fixed discard count: AI wanted ${w.cardIds.length} but action.count=${y.count}`);const C=i.discardCards(m,j,"opponent");return C.actionRequired?C:dt(C,c)}if(w.type==="rearrangeProtocols"&&y.type==="prompt_rearrange_protocols"){p&&y.sourceCardId==="CONTROL_MECHANIC"&&y.actor&&p(y.actor);const E=i.resolveRearrangeProtocols(m,w.newOrder);return dt(E,c)}if(y.type==="reveal_opponent_hand"){const E=i.revealOpponentHand(m);return dt(E,c)}if(w.type==="resolveOptionalEffectPrompt"&&y.type==="prompt_optional_effect"){const E=Md(m,w.accept);return E.actionRequired?E:dt(E,c)}if(w.type==="resolveCustomChoice"&&y.type==="custom_choice"){const E=zd(m,w.optionIndex);return E.actionRequired?E:dt(E,c)}if(w.type==="selectLane"){const{nextState:E,requiresAnimation:b}=u(m,w.laneIndex);if(b){const j=m.phase==="start";return d(b.animationRequests,()=>{t(C=>{const R={...C,animationState:null},F=b.onCompleteCallback(R,O=>O);return F.actionRequired&&F.actionRequired.actor==="opponent"?{...F,animationState:null}:{...j?c.continueTurnAfterStartPhaseAction(F):c.processEndOfAction(F),animationState:null}})}),E}return dt(E,c)}if(w.type==="deleteCard"||w.type==="flipCard"||w.type==="returnCard"||w.type==="shiftCard"||w.type==="selectCard"){const{nextState:E,requiresAnimation:b}=f(m,w.cardId);if(b){const j=m.phase==="start";return d(b.animationRequests,()=>{t(C=>{const R={...C,animationState:null},F=b.onCompleteCallback(R,O=>O);return F.actionRequired&&F.actionRequired.actor==="opponent"?{...F,animationState:null}:{...j?c.continueTurnAfterStartPhaseAction(F):c.processEndOfAction(F),animationState:null}})}),E}return E.actionRequired&&E.actionRequired.actor==="opponent"?E:dt(E,c)}if(w.type==="playCard"&&y.type==="select_card_from_hand_to_play")return qm(m,w,t,l,i,d,c,!1);if(w.type==="stateNumber"&&y.type==="state_number"){const E=Zd(m,w.number);return E.actionRequired&&E.actionRequired.actor==="opponent"?E:dt(E,c)}if(w.type==="stateProtocol"&&y.type==="state_protocol"){const E=Kd(m,w.protocol);return E.actionRequired&&E.actionRequired.actor==="opponent"?E:dt(E,c)}if(w.type==="selectFromDrawnToReveal"&&y.type==="select_from_drawn_to_reveal"){const E=Jd(m,w.cardId);return E.actionRequired&&E.actionRequired.actor==="opponent"?E:dt(E,c)}if(w.type==="confirmDeckDiscard"&&y.type==="confirm_deck_discard"){const E=eu(m);return E.actionRequired&&E.actionRequired.actor==="opponent"?E:dt(E,c)}if(w.type==="confirmDeckPlayPreview"&&y.type==="confirm_deck_play_preview"){const E=tu(m);return E.actionRequired&&E.actionRequired.actor==="opponent"?E:dt(E,c)}console.warn(`AI has no logic for mandatory action during player turn, clearing it: ${y.type}, aiDecision: ${JSON.stringify(w)}`);const S={...m,actionRequired:null};return dt(S,c)})},Cx=(a,t,l,i,c,d,f)=>{const u=a.actionRequired;if(u.type==="discard_completed"){const{followUpEffect:y,conditionalType:v,previousHandSize:x,sourceCardId:w,actor:S}=u;if(y&&w){const E=we(a,w);if(E){const b=a[S].hand.length,j=Math.max(0,(x||0)-b);if(v==="then"||v==="if_executed"&&j>0){let R=-1;for(let F=0;F<a[E.owner].lanes.length;F++)if(a[E.owner].lanes[F].some(L=>L.id===w)){R=F;break}if(R!==-1){const F={cardOwner:E.owner,opponent:E.owner==="player"?"opponent":"player",currentTurn:a.turn,actor:S,discardedCount:j},{executeCustomEffect:L}=require("../customProtocols/effectInterpreter");return L(E.card,R,{...a,actionRequired:null},F,y).newState}}}}return{...a,actionRequired:null}}const p=xc(a,a.actionRequired,l);if(p.type==="skip"){const y=i.skipAction(a),v=a.phase==="start"?d.continueTurnAfterStartPhaseAction(y):d.processEndOfAction(y);return!v.actionRequired&&v.turn==="opponent"&&!v.winner&&setTimeout(()=>{Sn(v,t,l,i,c,d,f)},500),v}if(p.type==="resolveControlMechanicPrompt"&&u.type==="prompt_use_control_mechanic"){const{choice:y}=p,{originalAction:v,actor:x}=u;if(y==="skip"){let w=ne(a,x,"Opponent skips rearranging protocols.");if(w.actionRequired=null,w={...w,_logIndentLevel:0},v.type==="compile"){const S=v.laneIndex;return setTimeout(()=>{t(E=>{const b=i.compileLane(E,S);return b.winner?b:{...d.processEndOfAction(b),animationState:null}})},1e3),{...w,animationState:{type:"compile",laneIndex:S},compilableLanes:[]}}else if(v.type==="fill_hand"){const S=i.fillHand(w,x);return d.processEndOfAction(S)}else return d.processEndOfAction(w)}else{const w=y;let b=ne(a,x,`Opponent chooses to rearrange ${w==="opponent"?"the player's":"their own"} protocols.`);return b.actionRequired={type:"prompt_rearrange_protocols",sourceCardId:"CONTROL_MECHANIC",target:w,actor:x,originalAction:v},b}}if(p.type==="resolveOptionalDiscardCustomPrompt"&&u.type==="prompt_optional_discard_custom"){const y=i.resolveOptionalDiscardCustomPrompt(a,p.accept);return y.actionRequired?y:dt(y,d)}if(p.type==="resolveOptionalEffectPrompt"){const y=i.resolveOptionalEffectPrompt(a,p.accept);return y.actionRequired?y:dt(y,d)}if(p.type==="resolvePrompt"&&u.type==="prompt_optional_shuffle_trash"){if(!p.accept){let v={...a};return v.actionRequired=null,v=ne(v,u.actor,`${u.actor==="player"?"Player":"Opponent"} skips shuffling trash into deck.`),dt(v,d)}const y=Cm(a,u.actor,"Clarity-4");return dt(y.newState,d)}if(p.type==="resolveSwapProtocols"&&u.type==="prompt_swap_protocols"){const y=i.resolveSwapProtocols(a,p.indices);return dt(y,d)}if(p.type==="resolveCustomChoice"&&u.type==="custom_choice"){const y=i.resolveCustomChoice(a,p.optionIndex);return y.actionRequired?y:dt(y,d)}if(p.type==="resolveRevealBoardCardPrompt"&&(u.type==="prompt_shift_or_flip_revealed_card"||u.type==="prompt_shift_or_flip_board_card_custom")){const y=Hd(a,p.choice);return y.actionRequired?y:dt(y,d)}if(p.type==="rearrangeProtocols"&&u.type==="prompt_rearrange_protocols"){f&&u.sourceCardId==="CONTROL_MECHANIC"&&u.actor&&f(u.actor);const y=i.resolveRearrangeProtocols(a,p.newOrder);return dt(y,d)}if(p.type==="selectLane"){const{nextState:y,requiresAnimation:v}=Od(a,p.laneIndex);if(v){const{animationRequests:x,onCompleteCallback:w}=v;return c(x,()=>{t(S=>{const E={...S,animationState:null};return w(E,b=>{const j={...b,animationState:null},R={...a.phase==="start"?d.continueTurnAfterStartPhaseAction(j):d.processEndOfAction(j),animationState:null};return!R.actionRequired&&R.turn==="opponent"&&!R.winner?setTimeout(()=>{Sn(R,t,l,i,c,d,f)},500):R.actionRequired&&R.turn==="opponent"&&setTimeout(()=>{Sn(R,t,l,i,c,d,f)},300),R})})}),y}return dt(y,d)}if(p.type==="flipCard"||p.type==="deleteCard"||p.type==="returnCard"||p.type==="shiftCard"||p.type==="selectCard"){const{nextState:y,requiresAnimation:v,requiresTurnEnd:x}=Pd(a,p.cardId);if(v){const{animationRequests:w,onCompleteCallback:S}=v;return c(w,()=>{t(E=>{const b={...E,animationState:null};return S(b,j=>{const C={...j,animationState:null};if(C.queuedActions&&C.queuedActions.length>0){const R=d.processEndOfAction(C);return R.actionRequired?(Sn(R,t,l,i,c,d),{...R,animationState:null}):{...R,animationState:null}}if(C.actionRequired)return Sn(C,t,l,i,c,d),C;if(C.phase==="start"){const F={...d.continueTurnAfterStartPhaseAction(C),animationState:null};return!F.actionRequired&&F.turn==="opponent"&&!F.winner&&setTimeout(()=>{Sn(F,t,l,i,c,d,f)},500),F}else return{...d.processEndOfAction(C),animationState:null}})})}),y}return x||y.queuedActions&&y.queuedActions.length>0?dt(y,d):y}if(p.type==="playCard"&&u.type==="select_card_from_hand_to_play")return qm(a,p,t,l,i,c,d,!0);if(p.type==="discardCards"&&u.type==="discard"){const v=u.variableCount===!0?p.cardIds.length:u.count,x=p.cardIds.slice(0,v);x.length!==p.cardIds.length&&console.warn(`[AI Manager] Fixed discard count: AI wanted ${p.cardIds.length} but action.count=${u.count}`);const w=i.discardCards(a,x,"opponent");return w.actionRequired?w:dt(w,d)}if(p.type==="giveCard"&&u.type==="select_card_from_hand_to_give"){const y=i.resolveActionWithHandCard(a,p.cardId);return y.actionRequired?y:dt(y,d)}if(p.type==="revealCard"&&u.type==="select_card_from_hand_to_reveal")return i.resolveActionWithHandCard(a,p.cardId);if(p.type==="selectRevealedDeckCard"&&u.type==="select_card_from_revealed_deck"){const y=Nm(a,p.cardId);return dt(y,d)}if(p.type==="stateNumber"&&u.type==="state_number"){const y=Zd(a,p.number);return y.actionRequired?y:dt(y,d)}if(p.type==="stateProtocol"&&u.type==="state_protocol"){const y=Kd(a,p.protocol);return y.actionRequired?y:dt(y,d)}if(p.type==="selectFromDrawnToReveal"&&u.type==="select_from_drawn_to_reveal"){const y=Jd(a,p.cardId);return y.actionRequired?y:dt(y,d)}if(p.type==="confirmDeckDiscard"&&u.type==="confirm_deck_discard"){const y=eu(a);return y.actionRequired?y:dt(y,d)}if(p.type==="confirmDeckPlayPreview"&&u.type==="confirm_deck_play_preview"){const y=tu(a);return y.actionRequired?y:dt(y,d)}console.warn(`AI has no logic for mandatory action, clearing it: ${u.type}`);const m={...a,actionRequired:null};return dt(m,d)},Sn=(a,t,l,i,c,d,f)=>{t(u=>{if(u.turn!=="opponent"||u.winner||u.animationState||!["start","compile","action","hand_limit","end"].includes(u.phase))return u;if(u.actionRequired){const y=u.actionRequired;let v=!1;if((y.type==="discard"&&y.actor==="player"||y.type==="plague_4_opponent_delete"&&y.actor==="opponent"||"actor"in y&&y.actor==="player")&&(v=!0),v)return u}let m={...u};if(m.actionRequired&&m.actionRequired.type==="reveal_opponent_hand"){const y=i.revealOpponentHand(m);return d.processEndOfAction(y)}if(m.phase==="start"&&(m=d.processStartOfTurn(m)),m.actionRequired){const y=Cx(m,t,l,i,c,d,f);return!y.actionRequired&&y.turn==="opponent"&&!y.winner&&y.phase!=="hand_limit"&&setTimeout(()=>{Sn(y,t,l,i,c,d,f)},300),y}if(m.phase==="compile"&&m.compilableLanes.length>0){const y=xc(m,null,l);if(y.type==="compile"){const v=y.laneIndex,x=km(m);return x.actionRequired?x:(setTimeout(()=>{t(w=>{const S=i.compileLane(w,v);return S.winner?S:{...d.processEndOfAction(S),animationState:null}})},1e3),{...x,animationState:{type:"compile",laneIndex:v},compilableLanes:[]})}}if(m.phase==="action"){const y=xc(m,null,l);if(y.type==="fillHand"){const v=jm(m,"opponent");return v.actionRequired?v:d.processEndOfAction(v)}if(y.type==="playCard"){const{newState:v,animationRequests:x}=i.playCard(m,y.cardId,y.laneIndex,y.isFaceUp,"opponent"),w={...v,animationState:{type:"playCard",cardId:y.cardId,owner:"opponent"}};return setTimeout(()=>{const S=()=>{t(E=>{let b={...E},j={newState:b};if(!b.actionRequired){if(b.queuedEffect){const{card:L,laneIndex:O}=b.queuedEffect,T={cardOwner:"opponent",actor:"opponent",currentTurn:b.turn,opponent:"player",triggerType:"play"};j=Kl(L,O,b,T),j.newState.queuedEffect=void 0}}const C=j.animationRequests,R=j.newState,F=()=>{t(L=>{if(L.queuedActions&&L.queuedActions.length>0){const O=d.processEndOfAction(L);return O.actionRequired&&Sn(O,t,l,i,c,d),O}return L.actionRequired?(Sn(L,t,l,i,c,d),L):d.processEndOfAction(L)})};if(C&&C.length>0)return c(C,F),R;if(R.queuedActions&&R.queuedActions.length>0){const L=d.processEndOfAction(R);return L.actionRequired&&Sn(L,t,l,i,c,d),L}return R.actionRequired?(Sn(R,t,l,i,c,d),R):d.processEndOfAction(R)})};t(E=>{const b={...E,animationState:null};return x&&x.length>0?c(x,S):S(),b})},500),w}}return m.phase==="end"||m.phase==="hand_limit"?d.continueTurnProgression(m):d.processEndOfAction(m)})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function Sx(a,t){let l=null,i=null;const c=["player","opponent"];for(const y of c){for(const v of a[y].lanes){const x=v.find(w=>w.id===t);if(x){l=y,i=x;break}}if(l)break}if(!l||!i)return console.error("Card to delete not found on board:",t),a;const d={...a},f={...d[l]};f.lanes=f.lanes.map(y=>y.filter(v=>v.id!==t));const{id:u,isFaceUp:p,...m}=i;return f.discard=[...f.discard,m],d[l]=f,d}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const bx=(a,t,l,i,c,d="player",f)=>{const[u,p]=se.useState(()=>{const re=zl(a,t,c,d);return Ce(re)}),[m,y]=se.useState(null),v=se.useRef(!1),x=se.useRef(0);se.useEffect(()=>{u.turn!==d&&u.log.length<=4&&p(re=>{const ee=d==="player"?"Player":"Opponent",X=[...re.log];return X.length>0&&(X[X.length-1]={player:"player",message:`${ee} goes first.`}),{...re,turn:d,log:X}})},[d,u.turn,u.log.length]);const w=se.useCallback(re=>{switch(re){case"start":return _m;case"end":return Wr;default:return Zr}},[]),S=se.useCallback((re,ee)=>{const X=le=>{if(le.length===0){ee();return}const[J,...me]=le;J.type==="delete"?(p(ve=>({...ve,animationState:{type:"deleteCard",cardId:J.cardId,owner:J.owner}})),setTimeout(()=>{p(ve=>{if(!(ve.player.lanes.flat().some(Ee=>Ee.id===J.cardId)||ve.opponent.lanes.flat().some(Ee=>Ee.id===J.cardId)))return{...ve,animationState:null};let Le=Sx(ve,J.cardId);return Le=Ce(Le),{...Le,animationState:null}}),setTimeout(()=>{me.length>0?X(me):ee()},10)},500)):J.type==="return"?(p(ve=>({...ve,animationState:{type:"returnCard",cardId:J.cardId,owner:J.owner}})),setTimeout(()=>{p(ve=>{const Se=ve[J.owner].lanes.findIndex(Je=>Je.some(nt=>nt.id===J.cardId)),Le=Se!==-1&&ve[J.owner].lanes[Se].length>0&&ve[J.owner].lanes[Se][ve[J.owner].lanes[Se].length-1].id===J.cardId,Ee=ve[J.owner].lanes.flat().find(Je=>Je.id===J.cardId);if(!Ee)return{...ve,animationState:null};const lt=ve[J.owner].lanes.map(Je=>Je.filter(nt=>nt.id!==J.cardId));let et={...ve,[J.owner]:{...ve[J.owner],lanes:lt,hand:[...ve[J.owner].hand,Ee]}};return et=Ce(et),Le&&Se!==-1&&et[J.owner].lanes[Se].length>0&&(et=Pn(et,J.owner,Se).newState),{...et,animationState:null}}),setTimeout(()=>{me.length>0?X(me):ee()},10)},500)):J.type==="play"?(p(ve=>({...ve,animationState:{type:"playCard",cardId:J.cardId,owner:J.owner}})),setTimeout(()=>{p(ve=>({...ve,animationState:null})),setTimeout(()=>{me.length>0?X(me):ee()},10)},500)):J.type==="draw"?(p(ve=>({...ve,animationState:{type:"draw",player:J.player,count:J.count}})),setTimeout(()=>{p(ve=>({...ve,animationState:null})),setTimeout(()=>{me.length>0?X(me):ee()},10)},500)):setTimeout(()=>{me.length>0?X(me):ee()},10)};X(re)},[]),E=(re,ee,X="player")=>{if(!m||u.turn!=="player"||u.phase!=="action")return;const le=m;y(null),p(J=>{const me=w(J.phase),{newState:ve,animationRequests:Se}=gc(J,le,re,ee,"player",X),Le={...ve,animationState:{type:"playCard",cardId:le,owner:"player"}};return setTimeout(()=>{p(Ee=>{let lt={...Ee,animationState:null};return Se&&Se.length>0?(S(Se,()=>{p(et=>me(et))}),lt):lt.actionRequired?lt:me(lt)})},500),Le})},b=()=>{u.turn!=="player"||u.phase!=="action"||u.actionRequired||p(re=>{const ee=w(re.phase),X=jm(re,"player");return X.actionRequired?X:ee(X)})},j=se.useCallback(re=>{p(ee=>{var X;return((X=ee.actionRequired)==null?void 0:X.type)!=="discard"||ee.actionRequired.actor!=="player"?ee:{...ee,animationState:{type:"discardCard",owner:"player",cardIds:[re],originalAction:ee.actionRequired}}})},[]),C=se.useCallback(re=>{p(ee=>{if(ee.winner||ee.phase!=="compile")return ee;const X=w(ee.phase),J={...km(ee),animationState:{type:"compile",laneIndex:re},compilableLanes:[]};return setTimeout(()=>{p(me=>{var Ee;const ve=Wl(me,re,l);if(ve.winner)return ve;if(((Ee=ve.actionRequired)==null?void 0:Ee.type)==="prompt_use_control_mechanic")return{...ve,animationState:null};const Se=ve._compileAnimations;if(Se&&Se.length>0){S(Se,()=>{p(et=>{const Je={...et};return delete Je._compileAnimations,{...X(Je),animationState:null}})});const lt={...ve};return delete lt._compileAnimations,lt}return{...X(ve),animationState:null}})},1e3),J})},[l,w]),R=re=>{p(ee=>{const X=ee.turn,le=w(ee.phase),{nextState:J,requiresAnimation:me,requiresTurnEnd:ve}=Pd(ee,re);return me?(S(me.animationRequests,()=>{p(Se=>{const Le=Se.turn!==X?Ee=>Ee:le;return me.onCompleteCallback(Se,Le)})}),J):J.actionRequired?J:le(J)})},F=re=>{p(ee=>{const X=w(ee.phase),{nextState:le,requiresAnimation:J}=Od(ee,re);return J?(S(J.animationRequests,()=>{p(me=>J.onCompleteCallback(me,X))}),le):le.actionRequired?le:X(le)})},L=re=>{p(ee=>{const X=w(ee.phase),le=qd(ee,re);return le.actionRequired?le:X(le)})},O=re=>{p(ee=>px(ee,re))},T=()=>{p(re=>{var le,J;const ee=w(re.phase);let X={...re,animationState:null};return((le=X.actionRequired)==null?void 0:le.type)==="prompt_shift_or_flip_board_card_custom"?X=Hd(X,"skip"):X=em(X),((J=X.actionRequired)==null?void 0:J.type)==="plague_4_player_flip_optional"?X:ee(X)})},G=se.useCallback(re=>{p(ee=>{var J;if(((J=ee.actionRequired)==null?void 0:J.type)!=="prompt_use_control_mechanic")return ee;const{originalAction:X,actor:le}=ee.actionRequired;if(re==="skip"){let me=ne(ee,le,"Player skips rearranging protocols.");if(me.actionRequired=null,me={...me,_logIndentLevel:0},X.type==="compile"){const Se={...me,animationState:{type:"compile",laneIndex:X.laneIndex},compilableLanes:[]};return setTimeout(()=>{p(Le=>{const Ee=Wl(Le,X.laneIndex,l);return Ee.winner?Ee:{...w(Ee.phase)(Ee),animationState:null}})},1e3),Se}else if(X.type==="continue_turn"){let ve={...me};return X.queuedSpeed2Actions&&X.queuedSpeed2Actions.length>0&&(ve.queuedActions=[...X.queuedSpeed2Actions,...ve.queuedActions||[]]),w(ve.phase)(ve)}else if(X.type==="resume_interrupted_turn"){let ve={...me};return ve._interruptedTurn=X.interruptedTurn,ve._interruptedPhase=X.interruptedPhase,X.queuedSpeed2Actions&&X.queuedSpeed2Actions.length>0&&(ve.queuedActions=[...X.queuedSpeed2Actions,...ve.queuedActions||[]]),Zr(ve)}else{const ve=Zl(me,le);return w(ve.phase)(ve)}}else{const me=re;let Le=ne(ee,le,`${le==="player"?"Player":"Opponent"} chooses to rearrange ${me==="player"?"their own":"the opponent's"} protocols.`);return Le.actionRequired={type:"prompt_rearrange_protocols",sourceCardId:"CONTROL_MECHANIC",target:me,actor:le,originalAction:X},Le}})},[l,w]),V=se.useCallback(re=>{p(ee=>{const X=w(ee.phase),le=om(ee,re);return le.actionRequired?le:X(le)})},[w]),z=se.useCallback(re=>{p(ee=>{var X;return((X=ee.actionRequired)==null?void 0:X.type)!=="plague_2_player_discard"?ee:{...ee,animationState:{type:"discardCard",owner:"player",cardIds:re,originalAction:ee.actionRequired}}})},[]),U=se.useCallback(re=>{p(ee=>{const X=w(ee.phase),le=rm(ee,re,"player");return X(le)})},[w]),k=se.useCallback(re=>{p(ee=>{const X=w(ee.phase),le=lm(ee,re);return re?le:X(le)})},[w]),A=se.useCallback(re=>{p(ee=>{const X=w(ee.phase),le=Md(ee,re);return le.actionRequired?le:X(le)})},[w]),I=se.useCallback(re=>{p(ee=>{var J,me,ve;const X=((J=ee.actionRequired)==null?void 0:J.type)==="select_cards_from_hand_to_discard_for_fire_4",le=((me=ee.actionRequired)==null?void 0:me.type)==="discard"&&((ve=ee.actionRequired)==null?void 0:ve.variableCount);return!X&&!le?ee:{...ee,animationState:{type:"discardCard",owner:"player",cardIds:re,originalAction:ee.actionRequired}}})},[]),$=se.useCallback(re=>{p(ee=>{var X;return((X=ee.actionRequired)==null?void 0:X.type)!=="select_cards_from_hand_to_discard_for_hate_1"?ee:{...ee,animationState:{type:"discardCard",owner:"player",cardIds:re,originalAction:ee.actionRequired}}})},[]),q=se.useCallback(re=>{p(ee=>{const X=w(ee.phase),le=Hd(ee,re);return le.actionRequired?le:X(le)})},[w]),M=se.useCallback(re=>{p(ee=>{var J,me;f&&((J=ee.actionRequired)==null?void 0:J.sourceCardId)==="CONTROL_MECHANIC"&&((me=ee.actionRequired)!=null&&me.actor)&&f(ee.actionRequired.actor);const X=w(ee.phase),le=Fd(ee,re,l);return le.winner?le:X(le)})},[w,l,f]),B=se.useCallback(re=>{p(ee=>{const X=w(ee.phase),le=zd(ee,re);return le.actionRequired?le:X(le)})},[w]),W=se.useCallback(re=>{p(ee=>{const X=w(ee.phase),le=sm(ee,re,l);return le.winner?le:X(le)})},[w,l]),K=se.useCallback(re=>{p(ee=>{const X=w(ee.phase),le=Nm(ee,re);return le.winner?le:X(le)})},[w]),D=se.useCallback(re=>{p(ee=>{const X=w(ee.phase),le=Zd(ee,re);return le.winner?le:X(le)})},[w]),Q=se.useCallback(re=>{p(ee=>{const X=w(ee.phase),le=Kd(ee,re);return le.winner?le:X(le)})},[w]),ae=se.useCallback(re=>{p(ee=>{const X=w(ee.phase),le=Jd(ee,re);return le.winner?le:X(le)})},[w]),Y=se.useCallback(()=>{p(re=>{const ee=w(re.phase),X=eu(re);return X.winner?X:ee(X)})},[w]),Z=se.useCallback(()=>{p(re=>tu(re))},[]),ue=se.useCallback(re=>{v.current=!1,x.current++,p(ee=>{if(typeof re=="function")return re(ee);const X=re;if(X==="speed-0-interrupt"){const le=["Speed","Life","Water"],J=["Metal","Death","Hate"];let me=Ln(Xa(le)),ve=Ln(Xa(J));const Se=(Fe,Ve,Oe)=>{const Rt=Fe.findIndex(tt=>tt.protocol===Ve&&tt.value===Oe);return Rt>-1?Fe.splice(Rt,1)[0]:In.find(tt=>tt.protocol===Ve&&tt.value===Oe)},Le=Se(me,"Speed",0),Ee=Se(ve,"Metal",0),lt=Se(me,"Speed",1),et=Se(me,"Life",1),Je=Se(me,"Water",1),nt=Se(me,"Speed",3);let je=zl(le,J,c,d);return je.player.lanes=[[],[],[]],je.player.lanes[0]=[{...Le,id:Ze(),isFaceUp:!1}],je.player.hand=[{...lt,id:Ze(),isFaceUp:!0},{...et,id:Ze(),isFaceUp:!0},{...Je,id:Ze(),isFaceUp:!0},{...nt,id:Ze(),isFaceUp:!0}],je.player.deck=me,je.player.discard=[],je.opponent.lanes=[[],[],[]],je.opponent.hand=[{...Ee,id:Ze(),isFaceUp:!0}],je.opponent.deck=ve,je.opponent.discard=[],je.turn="opponent",je.phase="start",je.actionRequired=null,je.queuedActions=[],je=Ce(je),je=ne(je,"player","DEBUG: Dynamic Speed-0 interrupt scenario set up. AI will play Metal-0."),je}else if(X==="speed-1-trigger"){const le=["Speed","Life","Water"],J=["Metal","Death","Hate"];let me=Ln(Xa(le));const ve=Ln(Xa(J)),Le=((Je,nt,je)=>{const Fe=Je.findIndex(Ve=>Ve.protocol===nt&&Ve.value===je);return Fe>-1?Je.splice(Fe,1)[0]:In.find(Ve=>Ve.protocol===nt&&Ve.value===je)})(me,"Speed",1);let Ee=zl(le,J,c,d);Ee.player.lanes=[[],[],[]],Ee.player.lanes[0]=[{...Le,id:Ze(),isFaceUp:!0}];const{drawnCards:lt,remainingDeck:et}=Un(me,[],6);return Ee.player.hand=lt.map(Je=>({...Je,id:Ze(),isFaceUp:!0})),Ee.player.deck=et,Ee.player.discard=[],Ee.opponent.lanes=[[],[],[]],Ee.opponent.hand=[],Ee.opponent.deck=ve,Ee.opponent.discard=[],Ee.turn="player",Ee.phase="hand_limit",Ee.actionRequired={type:"discard",actor:"player",count:1},Ee.queuedActions=[],Ee=Ce(Ee),Ee=ne(Ee,"player","DEBUG: Speed-1 discard trigger scenario set up."),Ee}else if(X==="fire-oncover-test"){const le=["Death","Hate","Water"],J=["Fire","Plague","Metal"],me=Ln(Xa(le));let ve=Ln(Xa(J));const Se=(Fe,Ve,Oe)=>{const Rt=Fe.findIndex(tt=>tt.protocol===Ve&&tt.value===Oe);return Rt>-1?Fe.splice(Rt,1)[0]:In.find(tt=>tt.protocol===Ve&&tt.value===Oe)},Le=Se(ve,"Fire",0),Ee=Se(ve,"Fire",2),lt=Se(ve,"Fire",3),et=In.find(Fe=>Fe.protocol==="Death"&&Fe.value===1),Je=In.find(Fe=>Fe.protocol==="Hate"&&Fe.value===2),nt=In.find(Fe=>Fe.protocol==="Water"&&Fe.value===3);let je=zl(le,J,c,"opponent");return je.player.lanes=[[{...et,id:Ze(),isFaceUp:!0}],[{...Je,id:Ze(),isFaceUp:!0}],[{...nt,id:Ze(),isFaceUp:!0}]],je.player.hand=[],je.player.deck=me,je.player.discard=[],je.opponent.lanes=[[{...Le,id:Ze(),isFaceUp:!0}],[],[]],je.opponent.hand=[{...lt,id:Ze(),isFaceUp:!0},{...Ee,id:Ze(),isFaceUp:!0}],je.opponent.deck=ve,je.opponent.discard=[],je.turn="opponent",je.phase="action",je.actionRequired=null,je.queuedActions=[],je=Ce(je),je=ne(je,"opponent","DEBUG: Fire On-Cover test scenario. Opponent has Fire-0 in play, Fire-3 and Fire-2 in hand. Ready to play Fire-3."),je}else if(X==="speed-2-control-test"){const le=["Speed","Light","Water"],J=["Fire","Plague","Metal"],me=Ln(Xa(le)),ve=Ln(Xa(J)),Le=((lt,et,Je)=>{const nt=lt.findIndex(je=>je.protocol===et&&je.value===Je);return nt>-1?lt.splice(nt,1)[0]:In.find(je=>je.protocol===et&&je.value===Je)})(me,"Speed",2);let Ee=zl(le,J,!0,"player");return Ee.player.lanes=[[{...Le,id:Ze(),isFaceUp:!0}],[],[]],Ee.player.protocols[0]="Speed",Ee.player.laneValues[0]=10,Ee.player.hand=[],Ee.player.deck=me,Ee.player.discard=[],Ee.controlCardHolder="player",Ee.opponent.lanes=[[],[],[]],Ee.opponent.hand=[],Ee.opponent.deck=ve,Ee.opponent.discard=[],Ee.turn="player",Ee.phase="compile",Ee.compilableLanes=[0],Ee.actionRequired=null,Ee.queuedActions=[],Ee=Ce(Ee),Ee=ne(Ee,"player","DEBUG: Speed-2 + Control test scenario. Player has Speed-2 (value 10), Control Component active. Ready to compile Protocol Speed!"),Ee}return ee})},[c]);return se.useEffect(()=>{const re=u.animationState;if(!re)return;let ee=0,X=!1;if(re.type==="flipCard"?(ee=600,X=!0):re.type==="drawCard"?(ee=1e3,X=!0):re.type==="discardCard"&&(ee=800,X=!0),X){const le=setTimeout(()=>{p(J=>({...J,animationState:null}))},ee);return()=>clearTimeout(le)}},[u.animationState]),se.useEffect(()=>{const re=u.animationState;if((re==null?void 0:re.type)==="discardCard"&&re.owner==="player"){const ee=setTimeout(()=>{p(X=>{const le=X.animationState;if((le==null?void 0:le.type)!=="discardCard"||!le.originalAction)return X;const{cardIds:J,originalAction:me}=le,ve=w(X.phase);let Se;return me.type==="plague_2_player_discard"?Se=ux(X,J):me.type==="select_cards_from_hand_to_discard_for_fire_4"?Se=Jh(X,J):me.type==="select_cards_from_hand_to_discard_for_hate_1"?Se=Dd(X,J):Se=rr(X,J,"player"),Se.animationState=null,Se.actionRequired?Se:ve(Se)})},500);return()=>clearTimeout(ee)}},[u.animationState,w]),se.useEffect(()=>{if(u.turn==="opponent"&&!u.winner&&!u.animationState&&!u._interruptedTurn&&!v.current){v.current=!0;const re=x.current,ee=u,X=setTimeout(()=>{x.current===re&&Sn(ee,p,i,{compileLane:(le,J)=>Wl(le,J,l),playCard:gc,fillHand:Zl,discardCards:rr,flipCard:nm,deleteCard:(le,J)=>({newState:le,animationRequests:[{type:"delete",cardId:J,owner:"opponent"}]}),returnCard:am,skipAction:em,resolveOptionalDrawPrompt:om,resolvePlague4Flip:(le,J)=>rm(le,J,"opponent"),resolvePlague2Discard:Ad,resolvePlague2OpponentDiscard:Ad,resolveOptionalDiscardCustomPrompt:lm,resolveOptionalEffectPrompt:Md,resolveFire4Discard:Jh,resolveHate1Discard:Dd,resolveRearrangeProtocols:(le,J)=>Fd(le,J,l),resolveActionWithHandCard:qd,resolveSwapProtocols:(le,J)=>sm(le,J,l),revealOpponentHand:tm,resolveCustomChoice:zd},S,Wh,f)},1500);return()=>{clearTimeout(X),v.current=!1}}},[u.turn,u.phase,u.winner,u.animationState,u._interruptedTurn,i,l,S,u.actionRequired]),se.useEffect(()=>{const re=u.actionRequired,ee=u.turn==="player"||u._interruptedTurn==="player",X=re&&"actor"in re&&re.actor==="opponent";ee&&!u.animationState&&X&&!v.current&&(v.current=!0,wx(u,p,i,{playCard:gc,discardCards:rr,flipCard:nm,returnCard:am,deleteCard:(J,me)=>({newState:J,animationRequests:[{type:"delete",cardId:me,owner:"opponent"}]}),resolveActionWithHandCard:qd,resolveHate1Discard:Dd,resolvePlague2OpponentDiscard:Ad,revealOpponentHand:tm,resolveRearrangeProtocols:(J,me)=>Fd(J,me,l)},Wh,S,Pd,Od,f),v.current=!1)},[u.actionRequired,u.turn,u.animationState,i,S,l]),se.useEffect(()=>{p(re=>{let ee=Ce(re);return ee.turn==="player"&&ee.phase==="start"&&!ee.actionRequired?xm(ee):ee})},[u.turn,u.phase]),{gameState:u,selectedCard:m,setSelectedCard:y,playSelectedCard:E,fillHand:b,discardCardFromHand:j,compileLane:C,resolveActionWithCard:R,resolveActionWithLane:F,selectHandCardForAction:O,skipAction:T,resolvePlague2Discard:z,resolveActionWithHandCard:L,resolvePlague4Flip:U,resolveOptionalDiscardCustomPrompt:k,resolveOptionalEffectPrompt:A,resolveFire4Discard:I,resolveHate1Discard:$,resolveRevealBoardCardPrompt:q,resolveRearrangeProtocols:M,resolveOptionalDrawPrompt:V,resolveSwapProtocols:W,resolveControlMechanicPrompt:G,resolveCustomChoice:B,resolveSelectRevealedDeckCard:K,resolveStateNumber:D,resolveStateProtocol:Q,resolveSelectFromDrawnToReveal:ae,resolveConfirmDeckDiscard:Y,resolveConfirmDeckPlayPreview:Z,setupTestScenario:ue}},um=({cards:a,isPlayable:t,isCompilable:l,isShiftTarget:i,isEffectTarget:c,isMatching:d,onLanePointerDown:f,onPlayFaceDown:u,onCardPointerDown:p,onCardPointerEnter:m,onCardPointerLeave:y,owner:v,animationState:x,isCardTargetable:w,laneIndex:S,sourceCardId:E,gameState:b})=>{const j=["lane"];return t&&j.push("playable"),d&&j.push("matching-protocol"),l&&j.push("compilable"),i&&j.push("shift-target"),c&&j.push("effect-target"),o.jsxs("div",{className:j.join(" "),onPointerDown:f,children:[t&&d&&v==="player"&&u&&o.jsx("button",{className:"btn btn-play-facedown",onPointerDown:C=>{C.stopPropagation(),u()},children:"Play Face-Down"}),o.jsx("div",{className:"lane-stack",children:a.map((C,R)=>{var O;const F=((O=b.actionRequired)==null?void 0:O.type)==="prompt_shift_or_flip_for_light_2"&&b.actionRequired.revealedCardId===C.id,L=pa(C,a,b,S,v);return o.jsx(bt,{card:C,isFaceUp:C.isFaceUp||F,style:{"--i":R},onPointerDown:T=>{T.stopPropagation(),p(C)},onPointerEnter:()=>m(C),animationState:x,isTargetable:w(C),isSourceOfEffect:C.id===E,faceDownValue:L},C.id)})})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const ko=(a,t)=>Do(a,t),ta=(a,t)=>bn(a).some(({rule:i,laneIndex:c})=>i.type==="block_shifts_from_and_to_lane"&&c===t),wc=(a,t)=>{const{actionRequired:l}=t;if(!l||"actor"in l&&l.actor!=="player")return!1;let i=null,c=-1,d=[];for(const p of["player","opponent"]){for(let m=0;m<t[p].lanes.length;m++)if(t[p].lanes[m].some(y=>y.id===a.id)){i=p,c=m,d=t[p].lanes[m];break}if(i)break}if(!i)return!1;const f=d.findIndex(p=>p.id===a.id),u=Fo(t,d,f);if(l.type==="select_lane_for_shift"){const p=l.cardToShiftId;return!!(p&&a.id===p)}if(l.type==="shift_flipped_card_optional"){const p=l.cardId;return!!(p&&a.id===p)}switch(l.type){case"select_opponent_face_up_card_to_flip":return i==="opponent"&&a.isFaceUp&&u;case"select_card_to_flip":{if(ko(t,a.id))return!1;const p=l.targetFilter||{},m=d.findIndex(b=>b.id===a.id),y=l.currentLaneIndex,v=l.laneIndex,x=l.scope,w=l.restrictedLaneIndex;if(y!==void 0&&c!==y||x==="this_lane"&&v!==void 0&&c!==v||w!==void 0&&c!==w)return!1;const S=p.position||"uncovered";if(S==="uncovered"&&!u||S==="covered"&&m>=d.length-1||p.owner==="own"&&i!==l.actor||p.owner==="opponent"&&i===l.actor||p.faceState==="face_up"&&!a.isFaceUp||p.faceState==="face_down"&&a.isFaceUp||p.excludeSelf&&a.id===l.sourceCardId||!Gl(t,a.id).allowed)return!1;if(p.valueMinGreaterThanHandSize){const b=t[l.actor].hand.length;if(a.value<=b)return!1}return!0}case"select_own_face_up_covered_card_to_flip":{const p=d.findIndex(m=>m.id===a.id);return i==="player"&&a.isFaceUp&&p<d.length-1}case"select_opponent_covered_card_to_shift":{const p=d.findIndex(y=>y.id===a.id),m=t.turn==="player"?"opponent":"player";return ta(t,c)?!1:i===m&&p<d.length-1}case"select_own_covered_card_to_shift":{const p=d.findIndex(m=>m.id===a.id);return ta(t,c)?!1:i===l.actor&&p<d.length-1}case"select_covered_card_in_line_to_flip_optional":{const m=d.findIndex(v=>v.id===a.id)<d.length-1;return Sa(t)&&!a.isFaceUp?!1:c===l.laneIndex&&m}case"select_covered_card_to_flip_for_chaos_0":{const m=d.findIndex(v=>v.id===a.id)<d.length-1;return Sa(t)&&!a.isFaceUp?!1:c===l.laneIndex&&m}case"shift_flipped_card_optional":return ta(t,c)?!1:a.id===l.cardId;case"select_opponent_card_to_flip":return Sa(t)&&!a.isFaceUp?!1:i==="opponent"&&u;case"select_face_down_card_to_shift_for_darkness_4":return ta(t,c)?!1:!a.isFaceUp&&u;case"select_cards_to_delete":{if(ko(t,a.id)||l.disallowedIds.includes(a.id))return!1;const p=l.allowedIds;if(p&&!p.includes(a.id))return!1;const m=l.currentLaneIndex;if(m!==void 0&&c!==m)return!1;const y=l.targetFilter;if(y){const v=d.findIndex(j=>j.id===a.id),x=y.position||"uncovered";if(x==="uncovered"&&!u||x==="covered"&&v>=d.length-1||y.faceState==="face_up"&&!a.isFaceUp||y.faceState==="face_down"&&a.isFaceUp)return!1;if(y.valueRange){const{min:j,max:C}=y.valueRange;if(a.value<j||a.value>C)return!1}const w=l.actorChooses,S=l.sourceCardId;let E=null;for(const j of["player","opponent"])if(t[j].lanes.flat().some(C=>C.id===S)){E=j;break}if(w==="card_owner"&&E){if(y.owner==="own"&&i!==E||y.owner==="opponent"&&i===E)return!1}else if(y.owner==="own"&&i!==l.actor||y.owner==="opponent"&&i===l.actor)return!1;const b=l.protocolMatching;if(b){const j=t.player.protocols[c],C=t.opponent.protocols[c],R=a.protocol,F=R===j||R===C;if(b==="must_match"&&!F||b==="must_not_match"&&F)return!1}return!0}return u}case"select_face_down_card_to_delete":return!a.isFaceUp&&u;case"select_low_value_card_to_delete":return a.isFaceUp&&(a.value===0||a.value===1)&&u;case"select_card_from_other_lanes_to_delete":{if(ko(t,a.id))return!1;const{disallowedLaneIndex:p,lanesSelected:m}=l;return c!==p&&!m.includes(c)&&u}case"plague_4_opponent_delete":return(t.turn==="player"?"opponent":"player")==="player"?i==="player"&&!a.isFaceUp&&u:!1;case"select_any_other_card_to_flip":return Sa(t)&&!a.isFaceUp?!1:a.id!==l.sourceCardId&&u;case"select_card_to_return":{if(ko(t,a.id))return!1;const p=l.targetOwner||"any",m=l.targetFilter,y=l.actor,v=(m==null?void 0:m.position)||"uncovered",w=d.findIndex(S=>S.id===a.id)<d.length-1;return v==="uncovered"&&!u||v==="covered"&&!w?!1:p==="own"?i===y:p==="opponent"?i!==y:!0}case"select_card_to_shift_for_gravity_1":return ko(t,a.id)||ta(t,c)?!1:u;case"select_face_down_card_to_shift_for_gravity_4":return ta(t,c)?!1:!a.isFaceUp&&c!==l.targetLaneIndex&&u;case"select_any_card_to_flip":case"select_any_card_to_flip_optional":return Sa(t)&&!a.isFaceUp||!Gl(t,a.id).allowed?!1:u;case"select_any_face_down_card_to_flip_optional":return Gl(t,a.id).allowed?!a.isFaceUp&&u:!1;case"select_board_card_to_reveal_custom":{const p=l.targetFilter;if(!p)return!a.isFaceUp&&u;const m=d.findIndex(v=>v.id===a.id),y=p.position||"uncovered";return!(y==="uncovered"&&!u||y==="covered"&&m>=d.length-1||p.owner==="own"&&i!==l.actor||p.owner==="opponent"&&i===l.actor||p.faceState==="face_up"&&!a.isFaceUp||p.faceState==="face_down"&&a.isFaceUp)}case"select_own_other_card_to_shift":return ta(t,c)?!1:i===l.actor&&a.id!==l.sourceCardId&&u;case"select_opponent_face_down_card_to_shift":return ta(t,c)?!1:i!==l.actor&&!a.isFaceUp&&u;case"select_any_opponent_card_to_shift":return ta(t,c)?!1:i!==l.actor&&u;case"select_opponent_card_to_return":return i==="opponent"&&u;case"select_card_to_shift_for_anarchy_1":return ko(t,a.id)||ta(t,c)?!1:u;case"select_card_to_shift_for_anarchy_0":return ko(t,a.id)||ta(t,c)?!1:u;case"select_card_to_shift":{if(ko(t,a.id)||ta(t,c))return!1;const p=l.targetFilter||{},m=l.destinationRestriction,y=l.scope,v=l.sourceLaneIndex;if(y==="this_lane"&&v!==void 0&&c!==v||(m==null?void 0:m.type)==="non_matching_protocol"&&!a.isFaceUp)return!1;const x=p.position||"uncovered",S=d.findIndex(E=>E.id===a.id)<d.length-1;return!(x==="uncovered"&&!u||x==="covered"&&!S||p.owner==="own"&&i!==l.actor||p.owner==="opponent"&&i===l.actor||p.faceState==="face_up"&&!a.isFaceUp||p.faceState==="face_down"&&a.isFaceUp||p.excludeSelf&&a.id===l.sourceCardId)}case"select_phase_effect":return l.availableEffects.some(m=>m.cardId===a.id);case"select_card_for_copy_middle":return(l.validTargetIds||[]).includes(a.id);default:return!1}},Ex=({gameState:a,onLanePointerDown:t,onPlayFaceDown:l,onCardPointerDown:i,onCardPointerEnter:c,onCardPointerLeave:d,onOpponentHandCardPointerEnter:f,onOpponentHandCardPointerLeave:u,selectedCardId:p,sourceCardId:m})=>{const{player:y,opponent:v,animationState:x,phase:w,turn:S,compilableLanes:E,actionRequired:b,controlCardHolder:j}=a,C=z=>{const U=w==="compile"&&S==="player"&&!b&&E.includes(z),k=S==="player",A=w==="action"&&!b&&p,I=(b==null?void 0:b.type)==="select_lane_for_play";if(!(I?(b==null?void 0:b.actor)==="player":k)||!A&&!I)return{isPlayable:!1,isMatching:!1,isCompilable:U};let q;if(A)q=y.hand.find(ee=>ee.id===p);else if(I){if(b.disallowedLaneIndex!==void 0&&z===b.disallowedLaneIndex)return{isPlayable:!1,isMatching:!1,isCompilable:U};const ee=b.validLanes;if(ee&&!ee.includes(z))return{isPlayable:!1,isMatching:!1,isCompilable:U};if(b.source==="deck")return b.excludeCurrentLane&&z===b.currentLaneIndex?{isPlayable:!1,isMatching:!1,isCompilable:U}:{isPlayable:!0,isMatching:!1,isCompilable:U};q=y.hand.find(X=>X.id===b.cardInHandId)}if(!q)return{isPlayable:!1,isMatching:!1,isCompilable:U};const M=v.lanes[z];if(M.length>0&&M[M.length-1].isFaceUp&&M[M.length-1].protocol==="Plague"&&M[M.length-1].value===0)return{isPlayable:!1,isMatching:!1,isCompilable:U};const W=v.lanes.flat().some(ee=>ee.isFaceUp&&ee.protocol==="Psychic"&&ee.value===1),K=y.lanes.flat().some(ee=>ee.isFaceUp&&ee.protocol==="Spirit"&&ee.value===1),D=y.lanes.some(ee=>{if(ee.length===0)return!1;const X=ee[ee.length-1];return X.isFaceUp&&X.protocol==="Chaos"&&X.value===3}),Q=[...y.lanes.flat(),...v.lanes.flat()].some(ee=>ee.isFaceUp&&ee.protocol==="Anarchy"&&ee.value===1),ae=Sc(a),Y=bc(a,"player",z),Z=Ql(a,q);let ue;return Z?ue=!W:Q||ae?ue=q.protocol!==y.protocols[z]&&q.protocol!==v.protocols[z]&&!W:ue=(K||Y||D||q.protocol===y.protocols[z]||q.protocol===v.protocols[z])&&!W,M.some(ee=>ee.isFaceUp&&ee.protocol==="Metal"&&ee.value===2)&&!ue?{isPlayable:!1,isMatching:!1,isCompilable:U}:I&&(b.isFaceDown||b.faceDown)?{isPlayable:!0,isMatching:!1,isCompilable:U}:{isPlayable:!0,isMatching:ue,isCompilable:U}},R=z=>{if(!(S==="player")||!(w==="action"&&!b&&p))return{isPlayable:!1,isMatching:!1};const A=y.hand.find(q=>q.id===p);if(!A)return{isPlayable:!1,isMatching:!1};if(!Ql(a,A))return{isPlayable:!1,isMatching:!1};const I=y.lanes[z];return I.length>0&&I[I.length-1].isFaceUp&&I[I.length-1].protocol==="Plague"&&I[I.length-1].value===0?{isPlayable:!1,isMatching:!1}:{isPlayable:!0,isMatching:!0}},F=z=>{if(!b||b.actor!=="player")return!1;switch(b.type){case"select_lane_for_delete":{const U=b.validLanes;return!(U&&!U.includes(z))}case"select_lane_for_death_2":case"select_lane_for_water_3":case"select_lane_for_return":return!0;case"select_lane_for_metal_3_delete":return z===b.disallowedLaneIndex?!1:y.lanes[z].length+v.lanes[z].length>=8;case"select_lane_for_delete_all":return(b.validLanes||[]).includes(z);case"select_lanes_for_swap_stacks":return(b.validLanes||[]).includes(z);default:return!1}},L=(z,U)=>{if(!b||b.actor!=="player")return!1;const k=b.type==="select_lane_for_shift"?b.originalLaneIndex:(b.type==="select_card_to_shift",-1);if(k!==-1&&!Xl(a,k,z).allowed)return!1;switch(b.type){case"select_lane_for_shift":{if(U!==b.cardOwner||z===b.originalLaneIndex)return!1;const A=b.validLanes;if(A&&!A.includes(z))return!1;const I=[...a.player.lanes.flat(),...a.opponent.lanes.flat()].find(q=>q.id===b.sourceCardId),$=b.destinationRestriction;if($&&$.type==="to_or_from_this_lane"){let q=$.laneIndex;if($.laneIndex==="current"&&I)for(const M of["player","opponent"]){for(let B=0;B<a[M].lanes.length;B++)if(a[M].lanes[B].some(W=>W.id===b.sourceCardId)){q=B;break}if(typeof q=="number")break}if(typeof q=="number"&&!(b.originalLaneIndex===q)&&!(z===q))return!1}else if(I&&I.protocol==="Gravity"&&I.value===1){let q=-1;for(const M of["player","opponent"]){for(let B=0;B<a[M].lanes.length;B++)if(a[M].lanes[B].some(W=>W.id===b.sourceCardId)){q=B;break}if(q!==-1)break}if(q!==-1&&!(b.originalLaneIndex===q)&&!(z===q))return!1}return!0}case"shift_flipped_card_optional":{const A=b.cardId;let I=null,$=-1;for(let q=0;q<y.lanes.length;q++)if(y.lanes[q].some(M=>M.id===A)){I="player",$=q;break}if(I===null){for(let q=0;q<v.lanes.length;q++)if(v.lanes[q].some(M=>M.id===A)){I="opponent",$=q;break}}return U!==I?!1:z!==$}case"select_lane_for_life_3_play":return U==="player"&&z!==b.disallowedLaneIndex;case"select_lane_to_shift_revealed_card_for_light_2":return U==="player";case"select_lane_to_shift_revealed_board_card_custom":{const A=b.revealedCardId;if(![...a.player.lanes.flat(),...a.opponent.lanes.flat()].find(M=>M.id===A))return!1;let $=null,q=-1;for(const M of["player","opponent"]){for(let B=0;B<a[M].lanes.length;B++)if(a[M].lanes[B].some(W=>W.id===A)){$=M,q=B;break}if($)break}return U===$&&z!==q}case"select_lane_for_shift_all":{const A=b.sourceLaneIndex;return z!==A}case"select_lane_to_shift_cards_for_light_3":return z!==b.sourceLaneIndex;default:return!1}},O=(z,U,k)=>{let A=[z];return U&&A.push("compiled"),(x==null?void 0:x.type)==="compile"&&x.laneIndex===k&&A.push("is-compiling"),A.join(" ")},T=()=>j==="player"?"player-controlled":j==="opponent"?"opponent-controlled":"neutral",G=()=>j==="player"?"Player has control.":j==="opponent"?"Opponent has control.":"Control is neutral.",V=()=>j==="player"?"Control Player":j==="opponent"?"Control Opponent":"Control Neutral";return o.jsxs("div",{className:"game-board",children:[o.jsx("div",{className:"opponent-hand-area",children:v.hand.map(z=>o.jsx(bt,{card:z,isFaceUp:z.isRevealed||!1,additionalClassName:"in-hand",onPointerEnter:()=>f(z)},z.id))}),o.jsx("div",{className:`player-side opponent-side ${S==="opponent"?"active-turn":""}`,children:o.jsx("div",{className:"lanes",children:v.lanes.map((z,U)=>{const{isPlayable:k,isMatching:A}=R(U);return o.jsx(um,{cards:z,isPlayable:k,isMatching:A,isCompilable:!1,isShiftTarget:L(U,"opponent"),isEffectTarget:F(U),onLanePointerDown:()=>t(U,"opponent"),onCardPointerDown:I=>i(I,"opponent",U),onCardPointerEnter:I=>c(I,"opponent"),onCardPointerLeave:()=>d(),owner:"opponent",animationState:x,isCardTargetable:I=>wc(I,a),laneIndex:U,sourceCardId:m,gameState:a},`opp-lane-${U}`)})})}),o.jsxs("div",{className:"protocol-bars-container",children:[a.useControlMechanic&&o.jsxs("div",{className:"control-coin-container",children:[o.jsx("div",{className:`control-coin ${T()}`,title:G(),children:"C"}),o.jsx("div",{className:`control-coin-label ${T()}`,children:V()})]}),o.jsx("div",{className:`protocol-bar opponent-bar ${S==="opponent"?"active-turn":""}`,children:v.protocols.map((z,U)=>o.jsxs("div",{className:O("protocol-display",v.compiled[U],U),children:[o.jsx("span",{className:"protocol-name",children:z}),o.jsx("span",{className:"protocol-value",children:v.laneValues[U]})]},`opp-proto-${z}-${U}`))}),o.jsx("div",{className:`protocol-bar player-bar ${S==="player"?"active-turn":""}`,children:y.protocols.map((z,U)=>o.jsxs("div",{className:O("protocol-display",y.compiled[U],U),children:[o.jsx("span",{className:"protocol-name",children:z}),o.jsx("span",{className:"protocol-value",children:y.laneValues[U]})]},`player-proto-${z}-${U}`))})]}),o.jsx("div",{className:`player-side ${S==="player"?"active-turn":""}`,children:o.jsx("div",{className:"lanes",children:y.lanes.map((z,U)=>{const{isPlayable:k,isMatching:A,isCompilable:I}=C(U);return o.jsx(um,{cards:z,isPlayable:k,isMatching:A,isCompilable:I,isShiftTarget:L(U,"player"),isEffectTarget:F(U),onLanePointerDown:()=>t(U,"player"),onPlayFaceDown:()=>l(U),onCardPointerDown:$=>i($,"player",U),onCardPointerEnter:$=>c($,"player"),onCardPointerLeave:()=>d(),owner:"player",animationState:x,isCardTargetable:$=>wc($,a),laneIndex:U,sourceCardId:m,gameState:a},`player-lane-${U}`)})})})]})},jx=({gameState:a,onFillHand:t,onSkipAction:l,onResolvePlague2Discard:i,onResolvePlague4Flip:c,onResolveFire3Prompt:d,onResolveOptionalDiscardCustomPrompt:f,onResolveOptionalEffectPrompt:u,onResolveFire4Discard:p,onResolveHate1Discard:m,onResolveRevealBoardCardPrompt:y,onResolveOptionalDrawPrompt:v,onResolveDeath1Prompt:x,onResolveLove1Prompt:w,onResolvePsychic4Prompt:S,onResolveSpirit1Prompt:E,onResolveControlMechanicPrompt:b,onResolveCustomChoice:j,selectedCardId:C,multiSelectedCardIds:R,actionRequiredClass:F})=>{const{phase:L,turn:O,actionRequired:T,player:G,compilableLanes:V}=a,z=M=>{for(const B of["player","opponent"])for(const W of a[B].lanes){const K=W.find(D=>D.id===M);if(K)return K}return null},U=T==null?void 0:T.sourceCardId,k=U?z(U):null,A=(T==null?void 0:T.actor)||O,I=A.charAt(0).toUpperCase()+A.slice(1),$=()=>{var M,B,W,K;if(O!=="player"&&(!T||T.actor!=="player"))return o.jsx("button",{className:"btn",disabled:!0,children:"Processing..."});if((T==null?void 0:T.type)==="prompt_use_control_mechanic")return o.jsxs(o.Fragment,{children:[o.jsx("button",{className:"btn",onClick:()=>b("player"),children:"Rearrange Own"}),o.jsx("button",{className:"btn",onClick:()=>b("opponent"),children:"Rearrange Opponent's"}),o.jsx("button",{className:"btn btn-back",onClick:()=>b("skip"),children:"Skip"})]});if((T==null?void 0:T.type)==="prompt_optional_draw")return o.jsxs(o.Fragment,{children:[o.jsx("button",{className:"btn",onClick:()=>v(!0),children:"Draw"}),o.jsx("button",{className:"btn btn-back",onClick:()=>v(!1),children:"Skip"})]});if((T==null?void 0:T.type)==="prompt_death_1_effect")return o.jsxs(o.Fragment,{children:[o.jsx("button",{className:"btn",onClick:()=>x(!0),children:"Draw & Delete"}),o.jsx("button",{className:"btn btn-back",onClick:()=>x(!1),children:"Skip"})]});if((T==null?void 0:T.type)==="prompt_give_card_for_love_1")return o.jsxs(o.Fragment,{children:[o.jsx("button",{className:"btn",onClick:()=>w(!0),children:"Give 1 Card"}),o.jsx("button",{className:"btn btn-back",onClick:()=>w(!1),children:"Skip"})]});if((T==null?void 0:T.type)==="prompt_fire_3_discard")return o.jsxs(o.Fragment,{children:[o.jsx("button",{className:"btn",onClick:()=>d(!0),children:"Discard 1 Card"}),o.jsx("button",{className:"btn btn-back",onClick:()=>d(!1),children:"Skip"})]});if((T==null?void 0:T.type)==="prompt_optional_discard_custom")return o.jsxs(o.Fragment,{children:[o.jsxs("button",{className:"btn",onClick:()=>f(!0),children:["Discard ",T.count," Card(s)"]}),o.jsx("button",{className:"btn btn-back",onClick:()=>f(!1),children:"Skip"})]});if((T==null?void 0:T.type)==="prompt_optional_effect"){const D=((B=(M=T.effectDef)==null?void 0:M.params)==null?void 0:B.action)||"effect",Q=(K=(W=T.effectDef)==null?void 0:W.params)==null?void 0:K.count,ae=Q?`${D} ${Q}`:D;return o.jsxs(o.Fragment,{children:[o.jsxs("button",{className:"btn",onClick:()=>u(!0),children:["Execute (",ae,")"]}),o.jsx("button",{className:"btn btn-back",onClick:()=>u(!1),children:"Skip"})]})}if((T==null?void 0:T.type)==="prompt_spirit_1_start")return o.jsxs(o.Fragment,{children:[o.jsx("button",{className:"btn",onClick:()=>E("discard"),children:"Discard 1"}),o.jsx("button",{className:"btn btn-back",onClick:()=>E("flip"),children:"Flip Card"})]});if((T==null?void 0:T.type)==="custom_choice"){const D=T.options||[];if(D.length===2){const Q=D[0].params,ae=D[1].params,Y=Z=>Z.action==="discard"?`Discard ${Z.count||1}`:Z.action==="flip"&&Z.flipSelf?"Flip This Card":Z.action==="draw"?`Draw ${Z.count||1}`:Z.action==="delete"&&Z.deleteSelf?"Delete This Card":Z.action==="delete"?`Delete ${Z.count||1}`:Z.action==="return"?`Return ${Z.count||1}`:Z.action==="shift"?"Shift":Z.action||"Option";return o.jsxs(o.Fragment,{children:[o.jsx("button",{className:"btn",onClick:()=>j(0),children:Y(Q)}),o.jsx("button",{className:"btn btn-back",onClick:()=>j(1),children:Y(ae)})]})}}if((T==null?void 0:T.type)==="prompt_return_for_psychic_4")return o.jsxs(o.Fragment,{children:[o.jsx("button",{className:"btn",onClick:()=>S(!0),children:"Return Card"}),o.jsx("button",{className:"btn btn-back",onClick:()=>S(!1),children:"Skip"})]});if((T==null?void 0:T.type)==="prompt_shift_or_flip_board_card_custom")return o.jsxs(o.Fragment,{children:[o.jsx("button",{className:"btn",onClick:()=>y("shift"),children:"Shift"}),o.jsx("button",{className:"btn",onClick:()=>y("flip"),children:"Flip"}),o.jsx("button",{className:"btn btn-back",onClick:()=>y("skip"),children:"Skip"})]});if((T==null?void 0:T.type)==="discard"&&T.variableCount&&T.actor==="player")return o.jsxs("button",{className:"btn",onClick:()=>p(R),disabled:R.length<1,children:["Confirm Discard (",R.length,")"]});if((T==null?void 0:T.type)==="plague_2_player_discard"||(T==null?void 0:T.type)==="select_cards_from_hand_to_discard_for_fire_4"||(T==null?void 0:T.type)==="select_cards_from_hand_to_discard_for_hate_1"){let D,Q=0;return T.type==="plague_2_player_discard"?(D=i,Q=1):T.type==="select_cards_from_hand_to_discard_for_fire_4"?(D=p,Q=1):(D=m,Q=T.count),o.jsxs("button",{className:"btn",onClick:()=>D(R),disabled:R.length<Q,children:["Confirm Discard (",R.length,")"]})}if((T==null?void 0:T.type)==="plague_4_player_flip_optional")return o.jsxs(o.Fragment,{children:[o.jsx("button",{className:"btn",onClick:()=>c(!0),children:"Flip Plague-4"}),o.jsx("button",{className:"btn btn-back",onClick:()=>c(!1),children:"Skip"})]});if(T&&"optional"in T&&T.optional)return o.jsx("button",{className:"btn btn-back",onClick:l,children:"Skip Action"});if(T)return o.jsx("button",{className:"btn",disabled:!0,children:"Action Required"});if(L==="compile"&&V.length>0)return o.jsx("button",{className:"btn",disabled:!0,children:"Select Lane to Compile"});if(L==="action"){const D=G.hand.length<5,Q=G.hand.length===0,ae=Wd(a,"player"),Y=D&&ae.allowed;return Q?o.jsx("button",{className:"btn",onClick:t,disabled:!ae.allowed,title:ae.allowed?void 0:ae.reason,children:"Refresh (Required)"}):o.jsx("button",{className:"btn",onClick:t,disabled:!Y||!!C,title:ae.allowed?void 0:ae.reason,children:"Refresh"})}return o.jsx("button",{className:"btn",disabled:!0,children:"Processing..."})},q=()=>{var M,B,W,K;if(T)switch(T.type){case"discard":return T.actor==="player"?T.variableCount?"Action: Select 1 or more cards to discard":`Action: Discard ${T.count} card(s) from your hand`:"Waiting for Opponent to discard...";case"prompt_use_control_mechanic":return"Control Action: Rearrange protocols?";case"select_opponent_face_up_card_to_flip":return"Action: Select an opponent's face-up card to flip";case"select_own_face_up_covered_card_to_flip":return"Action: Select one of your face-up, covered cards to flip";case"select_opponent_covered_card_to_shift":return"Action: Select one of your opponent's covered cards to shift";case"select_own_covered_card_to_shift":return"Action: Select one of your covered cards to shift";case"select_lane_for_shift":return"Action: Select a new lane for the card";case"select_lane_for_shift_all":return"Action: Select a lane to shift all cards to";case"select_opponent_card_to_flip":return"Action: Select an opponent's card to flip";case"select_card_to_flip":{const D=T.targetFilter||{},Q=D.owner||"any",ae=D.faceState||"any",Y=D.position||"uncovered";let Z="Action: Flip ";return Q==="own"?Z+="one of your ":Q==="opponent"?Z+="an opponent's ":Z+="a ",ae==="face_down"?Z+="face-down ":ae==="face_up"&&(Z+="face-up "),Y==="covered"?Z+="covered ":Y==="uncovered"&&(Z+="uncovered "),Z+="card",Z}case"shift_flipped_card_optional":return"Action: You may shift the card you just flipped. Select a lane or skip.";case"select_covered_card_in_line_to_flip_optional":return"Action: You may flip one of your covered cards in this lane. Select a card or skip.";case"select_card_from_hand_to_play":{const D=T.valueFilter;return D!==void 0?`Action: Select a card with value ${D} from your hand to play`:"Action: Select a card from your hand to play"}case"select_lane_for_play":return"Action: Select another lane to play your card in";case"select_face_down_card_to_shift_for_darkness_4":return"Action: Select any face-down card to shift";case"select_cards_to_delete":return`Action: Select a card to delete (${T.count} remaining)`;case"select_face_down_card_to_delete":return"Action: Select a face-down card to delete";case"select_low_value_card_to_delete":return"Action: Select a card with value 0 or 1 to delete";case"select_card_from_other_lanes_to_delete":return`Action: Select a card to delete (${T.count} remaining)`;case"select_lane_for_death_2":return"Action: Select a lane to delete cards with value 1 or 2";case"select_lane_for_delete":return"Action: Select a lane";case"prompt_optional_draw":return"Optional: Draw card(s)?";case"prompt_death_1_effect":return"Start Phase: Use Death-1 effect?";case"select_card_to_delete_for_death_1":return"Action: Select a card to delete";case"delete_self":return"Deleting card...";case"prompt_give_card_for_love_1":return"End Phase: Give 1 card to draw 2?";case"select_card_from_hand_to_give":return"Action: Select a card from your hand to give";case"select_card_from_hand_to_reveal":return"Action: Select a card from your hand to reveal";case"plague_2_player_discard":return"Action: Select 1 or more cards to discard";case"plague_4_opponent_delete":return"Waiting for opponent to delete one of their face-down cards";case"plague_4_player_flip_optional":return"Action: You may flip Plague-4";case"select_any_other_card_to_flip":return"Action: Select any other card to flip";case"select_card_to_return":{const D=T.targetFilter||{},Q=T.targetOwner||D.owner||"any",ae=D.position||"uncovered";let Y="Action: Select ";return Q==="own"?Y+="one of your ":Q==="opponent"?Y+="an opponent's ":Y+="a ",ae==="any"?Y+="covered or uncovered ":ae==="covered"&&(Y+="covered "),Y+="card to return",Y}case"select_covered_card_to_flip_for_chaos_0":return"Action: Select a covered card to flip in this lane";case"prompt_fire_3_discard":return"End Phase: Discard 1 card to flip 1 card?";case"prompt_optional_discard_custom":return`Optional: Discard ${T.count} card(s) to continue?`;case"prompt_optional_effect":{const D=((B=(M=T.effectDef)==null?void 0:M.params)==null?void 0:B.action)||"effect",Q=(K=(W=T.effectDef)==null?void 0:W.params)==null?void 0:K.count;return`Do you want to ${D==="shift"?"shift a card":D==="flip"?"flip a card":D==="draw"?`draw ${Q||1} card(s)`:D==="discard"?`discard ${Q||1} card(s)`:D==="delete"?"delete a card":D==="return"?"return a card":`execute ${D}${Q?` ${Q}`:""}`}?`}case"select_card_to_flip_for_fire_3":return"Action: Select a card to flip";case"select_own_other_card_to_shift":return"Action: Select one of your cards to shift";case"select_opponent_face_down_card_to_shift":return"Action: Select an opponent's face-down card to shift";case"prompt_spirit_1_start":return"Start Phase: Discard 1 card or flip Spirit-1?";case"select_any_card_to_flip_optional":return"Action: You may flip one card. Select a card or skip.";case"prompt_swap_protocols":return"Action: Swap two protocols.";case"select_cards_from_hand_to_discard_for_fire_4":return"Action: Select 1 or more cards to discard";case"select_cards_from_hand_to_discard_for_hate_1":return`Action: Select ${T.count} card(s) to discard for Hate-1`;case"select_any_card_to_flip":return`Action: Select a card to flip (${T.count} remaining)`;case"select_any_face_down_card_to_flip_optional":return"Action: You may flip a face-down card. Select a card or skip.";case"select_lane_for_life_3_play":return"Action: Select another lane to play a card into";case"select_card_to_flip_for_light_0":return"Action: Select any card to flip";case"prompt_shift_or_flip_board_card_custom":return"Action: Choose to shift, flip, or skip";case"select_board_card_to_reveal_custom":return"Action: Select a face-down card to reveal";case"select_lane_to_shift_revealed_card_for_light_2":return"Action: Select a lane to shift the revealed card to";case"select_lane_to_shift_revealed_board_card_custom":return"Action: Select a lane to shift the revealed card to";case"select_lane_to_shift_cards_for_light_3":return"Action: Select a lane to shift all face-down cards to";case"select_lane_for_metal_3_delete":return"Action: Select a lane with 8+ cards to delete";case"select_lane_for_delete_all":return"Action: Select a lane to delete all cards";case"select_lanes_for_swap_stacks":{const D=T.selectedFirstLane;return D===void 0?"Action: Select the first lane to swap":`Action: Select the second lane to swap with lane ${D+1}`}case"select_any_other_card_to_flip_for_water_0":return"Action: Select any other card to flip";case"prompt_rearrange_protocols":return"Action: Rearrange protocols";case"select_lane_for_water_3":return"Action: Select a lane to return cards from";case"select_own_card_to_return_for_water_4":return"Action: Select one of your cards to return to your hand";case"prompt_return_for_psychic_4":return"End Phase: Return an opponent's card?";case"select_any_opponent_card_to_shift":return"Action: Select an opponent's card to shift";case"select_card_to_shift":{const D=T.targetFilter||{},Q=D.owner||"any",ae=D.faceState||"any",Y=D.position||"uncovered";let Z="Action: Select ";return Q==="own"?Z+="one of your ":Q==="opponent"?Z+="an opponent's ":Z+="a ",ae==="face_down"?Z+="face-down ":ae==="face_up"&&(Z+="face-up "),Y==="covered"?Z+="covered ":Y==="uncovered"&&(Z+="uncovered "),Z+="card to shift",Z}case"select_opponent_card_to_return":return"Action: Select an opponent's card to return";case"select_own_highest_card_to_delete_for_hate_2":return"Action: Select your highest value uncovered card to delete";case"select_opponent_highest_card_to_delete_for_hate_2":return"Action: Select opponent's highest value uncovered card to delete";case"custom_choice":{const D=T.options||[];if(D.length===2){const Q=D[0].params,ae=D[1].params,Y=Z=>Z.action==="discard"?`you discard ${Z.count||1} card${Z.count!==1?"s":""}`:Z.action==="flip"&&Z.flipSelf?"flip this card":Z.action==="draw"?`draw ${Z.count||1} card${Z.count!==1?"s":""}`:Z.action==="delete"&&Z.deleteSelf?"delete this card":Z.action==="delete"?`delete ${Z.count||1} card${Z.count!==1?"s":""}`:Z.action==="return"?`return ${Z.count||1} card${Z.count!==1?"s":""}`:Z.action==="shift"?"shift a card":Z.action||"option";return`Either ${Y(Q)} or ${Y(ae)}.`}return"Action: Make a choice"}case"select_card_from_revealed_deck":return`Action: Select a card with value ${T.valueFilter} from your revealed deck`;case"select_phase_effect":{const D=T,Q=D.availableEffects.map(ae=>ae.cardName).join(", ");return`${D.phase} Phase: Choose which effect to resolve first (${Q})`}default:return"Action Required"}return L==="compile"&&V.length>0?"Phase: Compile":`Phase: ${L.replace("_"," ")}`};return o.jsxs("div",{className:`phase-controller ${F}`,children:[o.jsxs("div",{className:"effect-source-info",children:[o.jsxs("span",{children:[I,"'s Turn"]}),T&&k&&o.jsxs(o.Fragment,{children:[" | Effect from: ",o.jsxs("span",{children:[k.protocol,"-",k.value]})]}),(T==null?void 0:T.sourceCardId)==="CONTROL_MECHANIC"&&o.jsxs(o.Fragment,{children:[" | Effect from: ",o.jsx("span",{children:"Control Component"})]})]}),o.jsxs("div",{className:"phase-controller-main",children:[o.jsx("div",{className:"phase-info",children:q()}),o.jsx("div",{className:"phase-actions",children:$()})]})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const kx={start:"Start",control:"Control",action:"Action",compile:"Compile",hand_limit:"Hand Limit",end:"End"},Nx=({gameState:a,turn:t,animationState:l,difficulty:i,onPlayerClick:c,onOpponentClick:d})=>{const{player:f,opponent:u}=a,p=y=>{const v=["info-section"];return v.push(y==="player"?"player-info":"opponent-info"),t===y&&v.push("active-turn"),(l==null?void 0:l.type)==="drawCard"&&l.owner===y&&v.push("is-drawing"),(l==null?void 0:l.type)==="discardCard"&&l.owner===y&&v.push("is-discarding"),v.join(" ")},m=y=>{const v=y==="player"?f:u,x=y==="player"?c:d,w=y==="player"?"Player":`Opponent${i?` (${i.charAt(0).toUpperCase()+i.slice(1)})`:""}`,S=t===y;return o.jsx("div",{className:p(y),onClick:x,children:o.jsxs("div",{className:"info-section-body",children:[o.jsx("h3",{children:w}),S&&o.jsx("span",{className:"phase-badge",children:kx[a.phase]}),o.jsxs("div",{className:"info-line",children:[o.jsx("span",{children:"Hand:"}),o.jsx("span",{children:v.hand.length})]}),o.jsxs("div",{className:"info-line",children:[o.jsx("span",{children:"Deck:"}),o.jsx("span",{children:v.deck.length})]}),o.jsxs("div",{className:"info-line",children:[o.jsx("span",{children:"Trash:"}),o.jsx("span",{children:v.discard.length})]})]})})};return o.jsxs("div",{className:"game-info-panel",children:[m("opponent"),m("player")]})},Rx=/\b([A-Z][a-z]+(?:_custom)?)-(\d)\b/g;function fc(a,t){return{...a,id:`preview-${a.protocol}-${a.value}`,isFaceUp:t}}function $m(a){const t=a.match(/^([A-Z][a-z]+(?:_custom)?)-(\d)$/);return t?{protocol:t[1],value:parseInt(t[2],10)}:null}function Lm(a){const t=[];let l;const i=new RegExp(Rx);for(;(l=i.exec(a))!==null;)t.push({protocol:l[1],value:parseInt(l[2],10)});return t}function pm(a,t){if(a.sourceCardRef||a.targetCardRefs&&a.targetCardRefs.length>0)return!0;if(a.sourceCard){const i=$m(a.sourceCard);if(i&&t.some(c=>c.protocol===i.protocol&&c.value===i.value))return!0}const l=Lm(a.message);return!!(l.length>0&&l.some(i=>t.some(c=>c.protocol===i.protocol&&c.value===i.value)))}function Tx(a,t){const l={source:null,targets:[]};if(a.sourceCardRef){const i=t.find(c=>c.protocol===a.sourceCardRef.protocol&&c.value===a.sourceCardRef.value);i&&(l.source=fc(i,a.sourceCardRef.isFaceUp))}if(a.targetCardRefs&&a.targetCardRefs.length>0)for(const i of a.targetCardRefs){const c=t.find(d=>d.protocol===i.protocol&&d.value===i.value);c&&l.targets.push(fc(c,i.isFaceUp))}if(!l.source&&l.targets.length===0){if(a.sourceCard){const c=$m(a.sourceCard);if(c){const d=t.find(f=>f.protocol===c.protocol&&f.value===c.value);d&&(l.source=fc(d,!0))}}const i=Lm(a.message);for(const c of i){const d=t.find(f=>f.protocol===c.protocol&&f.value===c.value);if(d){const f=fc(d,!0);l.source?(l.source.protocol!==c.protocol||l.source.value!==c.value)&&l.targets.push(f):l.source=f}}}return l}function Ax({log:a,onClose:t}){const[l,i]=se.useState(null),[c,d]=se.useState(0),f=se.useMemo(()=>{const y=qo();return[...In,...y]},[]),u=y=>{let v="";if(y.phase){const x=y.phase.charAt(0).toUpperCase()+y.phase.slice(1);v+=`[${x}] `}return y.sourceCard&&!y.message.startsWith(y.sourceCard)&&(v+=`${y.sourceCard}: `),`${v}${y.message}`},p=se.useMemo(()=>{if(l===null)return null;const y=a[l];return y?Tx(y,f):null},[l,a,f]),m=(y,v)=>{pm(v,f)&&(l===y?p&&p.targets.length>1?d(x=>(x+1)%p.targets.length):(i(null),d(0)):(i(y),d(0)))};return o.jsx("div",{className:"modal-overlay",onClick:t,children:o.jsxs("div",{className:"modal-content log-modal-content log-modal-with-preview",onClick:y=>y.stopPropagation(),children:[o.jsx("button",{className:"btn btn-back modal-close-btn",onClick:t,children:"X"}),o.jsx("h2",{children:"Game Log"}),o.jsxs("div",{className:"log-content-wrapper",children:[o.jsx("div",{className:"log-preview-area log-preview-left",children:(p==null?void 0:p.source)&&o.jsx("div",{className:"log-preview-card",children:o.jsx(bt,{card:p.source,isFaceUp:p.source.isFaceUp})})}),o.jsx("ol",{className:"log-list",children:a.map((y,v)=>{const x=y.indentLevel!==void 0,w=x?{paddingLeft:`${y.indentLevel*20+40}px`}:{};x&&y.indentLevel===0&&(w.fontWeight="bold");const S=pm(y,f),E=l===v;return o.jsx("li",{className:`log-entry log-entry-${y.player}${S?" log-entry-clickable":""}${E?" log-entry-selected":""}`,style:w,onClick:()=>m(v,y),children:u(y)},v)})}),o.jsx("div",{className:"log-preview-area log-preview-right",children:(p==null?void 0:p.targets)&&p.targets.length>0&&o.jsxs("div",{className:"log-preview-card",children:[o.jsx(bt,{card:p.targets[c],isFaceUp:p.targets[c].isFaceUp}),p.targets.length>1&&o.jsxs("div",{className:"log-preview-counter",children:[c+1," / ",p.targets.length]})]})})]})]})})}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Dx=({message:a,player:t})=>o.jsx("div",{className:`toaster toaster-${t}`,children:a});function Fx({gameState:a,targetPlayer:t,onConfirm:l}){var M;const[i]=se.useState([...a[t].protocols]),[c,d]=se.useState([...a[t].protocols]),[f,u]=se.useState([0,1,2]),p=se.useRef(null),m=se.useRef(null),y=se.useRef(0),v=se.useRef(null),x=se.useRef(0),w=((M=a.actionRequired)==null?void 0:M.type)==="prompt_rearrange_protocols"?a.actionRequired.disallowedProtocolForLane:void 0,S=se.useMemo(()=>{if(c.length!==i.length)return!1;for(let B=0;B<c.length;B++)if(c[B]!==i[B])return!0;return!1},[c,i]),E=se.useMemo(()=>{if(!w)return console.log("[RearrangeModal] No disallowedProtocolForLane set"),!1;const{laneIndex:B,protocol:W}=w,K=c[B],D=K===W;return console.log("[RearrangeModal] Checking violation:",{disallowedProtocol:W,disallowedLaneIndex:B,currentProtocolAtLane:K,protocols:c,hasViolation:D}),D},[c,w]),b=a[t],C=a[t==="player"?"opponent":"player"],R=b.laneValues,F=b.compiled,L=(B,W)=>{let K=[B];return W&&K.push("compiled"),K.join(" ")},O=(B,W)=>{p.current=W,B.dataTransfer.effectAllowed="move"},T=(B,W)=>{B.preventDefault(),m.current=W},G=()=>{if(p.current!==null&&m.current!==null&&p.current!==m.current){const B=[...c],W=[...f],K=B[p.current];B[p.current]=B[m.current],B[m.current]=K;const D=W[p.current];W[p.current]=W[m.current],W[m.current]=D,p.current=null,m.current=null,d(B),u(W)}},V=B=>{B.preventDefault()},z=(B,W)=>{v.current=W,y.current=B.touches[0].clientY,x.current=B.touches[0].clientY},U=B=>{var D;if(v.current===null)return;x.current=B.touches[0].clientY;const W=B.touches[0],K=document.elementFromPoint(W.clientX,W.clientY);if(K){const Q=K.closest(".rearrange-item");if(Q){const Y=Array.from(((D=Q.parentElement)==null?void 0:D.children)||[]).indexOf(Q);Y!==-1&&Y!==v.current&&(m.current=Y)}}},k=()=>{if(v.current!==null&&m.current!==null&&v.current!==m.current){const B=[...c],W=[...f],K=B[v.current];B[v.current]=B[m.current],B[m.current]=K;const D=W[v.current];W[v.current]=W[m.current],W[m.current]=D,d(B),u(W)}v.current=null,m.current=null,y.current=0,x.current=0},A=t==="player",I=A?"Rearrange Your Protocols":"Rearrange Opponent's Protocols",$=o.jsx("div",{className:`protocol-bar ${A?"player-bar":"opponent-bar"} rearrange-editable`,onDragOver:V,children:c.map((B,W)=>{const K=B!==i[W],D=w&&w.laneIndex===W&&B===w.protocol,Q=f[W],ae=F[Q],Y=L("protocol-display rearrange-item",ae);return o.jsxs("div",{className:`${Y} ${K?"changed":""} ${D?"violation":""}`,draggable:!0,onDragStart:Z=>O(Z,W),onDragEnter:Z=>T(Z,W),onDragEnd:G,onTouchStart:Z=>z(Z,W),onTouchMove:U,onTouchEnd:k,children:[o.jsx("span",{className:"protocol-name",children:B}),o.jsx("span",{className:"protocol-value",children:R[W]})]},`${B}-${W}`)})}),q=o.jsx("div",{className:`protocol-bar ${A?"opponent-bar":"player-bar"}`,children:C.protocols.map((B,W)=>o.jsxs("div",{className:L("protocol-display",C.compiled[W]),children:[o.jsx("span",{className:"protocol-name",children:B}),o.jsx("span",{className:"protocol-value",children:C.laneValues[W]})]},`other-proto-${B}-${W}`))});return o.jsx("div",{className:"modal-overlay",children:o.jsxs("div",{className:"modal-content rearrange-modal-content",onClick:B=>B.stopPropagation(),children:[o.jsx("h2",{children:I}),o.jsx("p",{children:"Drag and drop the protocols to reorder them. You must change the order to continue."}),w&&o.jsxs("p",{className:"warning-text",children:[" ",o.jsx("strong",{children:w.protocol})," cannot be placed on line ",o.jsx("strong",{children:w.laneIndex})," due to Anarchy-3's restriction."]}),o.jsx("div",{className:"rearrange-board-view",children:o.jsxs("div",{className:"protocol-bars-container",children:[A?q:$,A?$:q]})}),o.jsxs("div",{className:"rearrange-actions",children:[o.jsx("button",{className:"btn",onClick:()=>l(c),disabled:!S||E,children:"Confirm Rearrangement"}),E&&o.jsxs("p",{className:"error-text",children:["Cannot confirm: ",w.protocol," is on line ",w.laneIndex]})]})]})})}function qx({gameState:a,targetPlayer:t,onConfirm:l}){const[i,c]=se.useState([]),d=a[t],f=t==="player",u=f?"Swap Your Protocols":"Swap Opponent's Protocols",p=v=>{i.includes(v)?c(x=>x.filter(w=>w!==v)):i.length<2&&c(x=>[...x,v])},m=()=>{i.length===2&&l(i)},y=v=>{let x=["protocol-display","rearrange-item"];return d.compiled[v]&&x.push("compiled"),i.includes(v)&&x.push("selected"),x.join(" ")};return o.jsx("div",{className:"modal-overlay",children:o.jsxs("div",{className:"modal-content rearrange-modal-content",onClick:v=>v.stopPropagation(),children:[o.jsx("h2",{children:u}),o.jsx("p",{children:"Select two protocols to swap their positions. This action is mandatory."}),o.jsx("div",{className:"rearrange-board-view",children:o.jsx("div",{className:"protocol-bars-container",children:o.jsx("div",{className:`protocol-bar ${f?"player-bar":"opponent-bar"}`,children:d.protocols.map((v,x)=>o.jsxs("div",{className:y(x),onClick:()=>p(x),children:[o.jsx("span",{className:"protocol-name",children:v}),o.jsx("span",{className:"protocol-value",children:d.laneValues[x]})]},v))})})}),o.jsx("div",{className:"rearrange-actions",children:o.jsx("button",{className:"btn",onClick:m,disabled:i.length!==2,children:"Confirm Swap"})})]})})}function $x({gameState:a,onConfirm:t}){const[l,i]=se.useState(null),c=u=>{i(u)},d=()=>{l!==null&&t(l)},f=u=>{let p=["number-button"];return l===u&&p.push("selected"),p.join(" ")};return o.jsx("div",{className:"modal-overlay",children:o.jsxs("div",{className:"modal-content state-number-modal",onClick:u=>u.stopPropagation(),children:[o.jsx("h2",{children:"State a Number"}),o.jsx("p",{children:"Choose a number (0-5) to state. Cards drawn with this value may be revealed and played."}),o.jsx("div",{className:"number-selection",children:[0,1,2,3,4,5].map(u=>o.jsx("button",{className:f(u),onClick:()=>c(u),children:u},u))}),o.jsx("div",{className:"modal-actions",children:o.jsx("button",{className:"btn",onClick:d,disabled:l===null,children:"Confirm"})})]})})}function Lx({gameState:a,availableProtocols:t,onConfirm:l}){const[i,c]=se.useState(null),d=p=>{c(p)},f=()=>{i!==null&&l(i)},u=p=>{let m=["protocol-button"];return i===p&&m.push("selected"),m.join(" ")};return o.jsx("div",{className:"modal-overlay",children:o.jsxs("div",{className:"modal-content state-protocol-modal",onClick:p=>p.stopPropagation(),children:[o.jsx("h2",{children:"State a Protocol"}),o.jsx("p",{children:"Choose a protocol from your opponent's cards. If the discarded card matches, you'll delete a card."}),o.jsx("div",{className:"protocol-selection",children:t.map(p=>o.jsx("button",{className:u(p),onClick:()=>d(p),children:p},p))}),o.jsx("div",{className:"modal-actions",children:o.jsx("button",{className:"btn",onClick:f,disabled:i===null,children:"Confirm"})})]})})}function Ix({gameState:a,allDrawnCardIds:t,eligibleCardIds:l,statedNumber:i,revealCount:c=1,onConfirm:d,onClose:f}){const[u,p]=se.useState(null),m=se.useRef(!1),y=a.player.hand.filter(j=>t.includes(j.id)),v=j=>l.includes(j),x=l.length>0;se.useEffect(()=>{if(!m.current&&l.length>0){const j=y.find(C=>v(C.id));j&&(p(j),m.current=!0)}},[y,l]);const w=j=>{v(j.id)&&p(j)},S=j=>{v(j.id)&&p(j)},E=()=>{u&&v(u.id)&&d(u.id)},b=()=>{f&&f()};return o.jsx("div",{className:"modal-overlay",children:o.jsxs("div",{className:"modal-content revealed-deck-modal",onClick:j=>j.stopPropagation(),children:[o.jsx("h2",{children:"Cards Drawn"}),i!==void 0?o.jsxs("p",{children:["Select a card with value ",o.jsx("strong",{children:i})," to reveal:"]}):o.jsx("p",{children:"Select a card to reveal:"}),o.jsxs("div",{className:"revealed-deck-content-wrapper",children:[o.jsx("div",{className:"revealed-deck-preview-area",children:u?o.jsxs("div",{className:"revealed-deck-preview-card",children:[o.jsx(bt,{card:u,isFaceUp:!0}),o.jsxs("button",{className:"btn preview-confirm-btn",onClick:E,children:["Reveal ",u.protocol,"-",u.value]})]}):o.jsx("div",{className:"revealed-deck-preview-card no-selection",children:o.jsx("p",{className:"no-match-message",children:x?"Select an eligible card":`No cards match value ${i}`})})}),o.jsx("div",{className:"revealed-deck-grids-area",children:o.jsx("div",{className:"revealed-deck-card-grid",children:y.length>0?y.map(j=>{const C=v(j.id),R=(u==null?void 0:u.id)===j.id;return o.jsx("div",{onClick:F=>{F.stopPropagation(),S(j)},onMouseEnter:()=>w(j),style:{cursor:C?"pointer":"default"},children:o.jsx(bt,{card:j,isFaceUp:!0,additionalClassName:`in-hand ${C?R?"highlight-selectable":"":"dimmed"}`})},j.id)}):o.jsx("p",{className:"no-cards",children:"No cards drawn."})})})]}),!x&&o.jsx("div",{className:"modal-actions",children:o.jsx("button",{className:"btn",onClick:b,children:"Continue"})})]})})}function Ux({gameState:a,onSelectCard:t}){var E;const[l,i]=se.useState(null),c=se.useRef(!1),d=a.actionRequired,f=d==null?void 0:d.revealedCards,u=d==null?void 0:d.selectableCardIds,p=f||(d!=null&&d.actor?(E=a[d.actor])==null?void 0:E.deck:[])||[],m=se.useMemo(()=>p.map((b,j)=>({...b,id:b.id||`deck-${j}`,isFaceUp:!0})),[p]);if(se.useEffect(()=>{if((d==null?void 0:d.type)==="select_card_from_revealed_deck"&&(u==null?void 0:u.length)>0&&!c.current){const b=m.find(j=>u.includes(j.id));b&&(i(b),c.current=!0)}},[d==null?void 0:d.type,u,m]),se.useEffect(()=>{(!d||d.type!=="select_card_from_revealed_deck")&&(c.current=!1,i(null))},[d]),!d||d.type!=="select_card_from_revealed_deck")return null;const{valueFilter:y}=d,v=b=>u==null?void 0:u.includes(b),x=b=>{v(b.id)&&i(b)},w=b=>{v(b.id)&&i(b)},S=()=>{l&&v(l.id)&&t(l.id)};return o.jsx("div",{className:"modal-overlay",children:o.jsxs("div",{className:"modal-content revealed-deck-modal",onClick:b=>b.stopPropagation(),children:[o.jsx("h2",{children:"Your Revealed Deck"}),o.jsxs("p",{children:["Select a card with value ",y," to draw:"]}),o.jsxs("div",{className:"revealed-deck-content-wrapper",children:[o.jsx("div",{className:"revealed-deck-preview-area",children:l&&o.jsxs("div",{className:"revealed-deck-preview-card",children:[o.jsx(bt,{card:l,isFaceUp:!0}),o.jsxs("button",{className:"btn preview-confirm-btn",onClick:S,children:["Draw ",l.protocol,"-",l.value]})]})}),o.jsx("div",{className:"revealed-deck-grids-area",children:o.jsx("div",{className:"revealed-deck-card-grid",children:m.length>0?m.map(b=>{const j=v(b.id),C=(l==null?void 0:l.id)===b.id;return o.jsx("div",{onClick:R=>{R.stopPropagation(),w(b)},onMouseEnter:()=>x(b),style:{cursor:j?"pointer":"default"},children:o.jsx(bt,{card:b,isFaceUp:!0,additionalClassName:`in-hand ${j?C?"highlight-selectable":"":"dimmed"}`})},b.id)}):o.jsx("p",{className:"no-cards",children:"No cards in deck."})})})]})]})})}function Px({gameState:a,onAccept:t,onDecline:l}){var v,x;const i=a.actionRequired;if(!i||i.type!=="prompt_optional_effect")return null;const c=i.effectDef;if(!c||((v=c.params)==null?void 0:v.action)!=="discard"||!((x=c.params)!=null&&x.useCardFromPreviousEffect))return null;const d=a.lastCustomEffectTargetCardId;if(!d)return null;const f=i.actor||"player",p=a[f].deck.find(w=>w.id===d);if(!p)return null;const m={...p,id:p.id||"revealed-top",isFaceUp:!0},y=`${p.protocol}-${p.value}`;return o.jsx("div",{className:"modal-overlay",children:o.jsxs("div",{className:"modal-content revealed-deck-top-modal",onClick:w=>w.stopPropagation(),children:[o.jsx("h2",{children:"Revealed: Top Card of Your Deck"}),o.jsx("p",{children:"You may discard this card:"}),o.jsx("div",{className:"revealed-card-display",children:o.jsx(bt,{card:m,isFaceUp:!0})}),o.jsxs("div",{className:"revealed-deck-top-actions",children:[o.jsxs("button",{className:"btn",onClick:t,children:["Discard ",y]}),o.jsx("button",{className:"btn btn-back",onClick:l,children:"Keep in Deck"})]})]})})}function Ox({discardedCard:a,deckOwner:t,onConfirm:l}){const i=t==="own"?"your":"opponent's",c={...a,id:a.id||"deck-discard-preview",isFaceUp:!0};return o.jsx("div",{className:"modal-overlay",children:o.jsxs("div",{className:"modal-content deck-discard-modal",onClick:d=>d.stopPropagation(),children:[o.jsx("h2",{children:"Card Discarded"}),o.jsxs("p",{children:["From the top of ",o.jsx("strong",{children:i})," deck:"]}),o.jsx("div",{className:"deck-discard-preview-content",children:o.jsx("div",{className:"deck-discard-preview-card",children:o.jsx(bt,{card:c,isFaceUp:!0})})}),o.jsx("div",{className:"modal-actions",children:o.jsx("button",{className:"btn",onClick:l,children:"Continue"})})]})})}function Mx({card:a,isFaceDown:t,onConfirm:l}){const i=t?"face-down":"face-up";return o.jsx("div",{className:"modal-overlay",children:o.jsxs("div",{className:"modal-content deck-play-preview-modal",onClick:c=>c.stopPropagation(),children:[o.jsx("h2",{children:"Card from Deck"}),o.jsxs("p",{children:["You will play this card ",o.jsx("strong",{children:i}),":"]}),o.jsx("div",{className:"deck-play-preview-content",children:o.jsx("div",{className:"deck-play-preview-card",children:o.jsx(bt,{card:a,isFaceUp:!0})})}),o.jsx("div",{className:"modal-actions",children:o.jsx("button",{className:"btn",onClick:l,children:"Select Lane"})})]})})}function Hx({player:a,playerState:t,onClose:l,difficulty:i}){const c=a==="player"?"Player":`Opponent${i?` (${i.charAt(0).toUpperCase()+i.slice(1)})`:""}`,[d,f]=se.useState(null),u=m=>{f(m)},p=(m,y,v)=>{const x=m.map((w,S)=>({...w,id:`${y}-${w.protocol}-${w.value}-${S}`,isFaceUp:v}));return o.jsxs(o.Fragment,{children:[o.jsxs("h3",{children:[y," (",x.length,")"]}),o.jsx("div",{className:"debug-card-grid",children:x.length>0?x.map(w=>o.jsx("div",{onClick:S=>{S.stopPropagation(),f(w)},onMouseEnter:()=>u(w),onMouseLeave:()=>u(null),style:{cursor:"pointer"},children:o.jsx(bt,{card:w,isFaceUp:v,additionalClassName:"in-hand"})},w.id)):o.jsxs("p",{className:"no-cards",children:["No cards in ",y.toLowerCase(),"."]})})]})};return o.jsx("div",{className:"modal-overlay",onClick:l,children:o.jsxs("div",{className:"modal-content debug-modal-content debug-modal-with-preview",onClick:m=>m.stopPropagation(),children:[o.jsx("button",{className:"btn btn-back modal-close-btn",onClick:l,children:"X"}),o.jsxs("h2",{children:[c,"'s Info"]}),o.jsxs("div",{className:"debug-content-wrapper",children:[o.jsx("div",{className:"debug-preview-area",children:d&&o.jsx("div",{className:"debug-preview-card",children:o.jsx(bt,{card:d,isFaceUp:d.isFaceUp})})}),o.jsxs("div",{className:"debug-grids-area",children:[p(t.deck,"Deck",!1),p(t.discard,"Discard Pile",!0)]})]})]})})}function zx({onComplete:a}){const[t,l]=se.useState("choose"),[i,c]=se.useState(null),[d,f]=se.useState(null),[u,p]=se.useState(!1),m=v=>{c(v),l("flipping"),p(!0);const x=Math.random()<.5?"heads":"tails";setTimeout(()=>{f(x),p(!1),l("result")},2e3)},y=()=>{if(d===null||i===null)return;const v=d===i;a(v?"player":"opponent",i,v)};return o.jsx("div",{className:"coin-flip-modal-overlay",children:o.jsxs("div",{className:"modal-content coin-flip-modal-content",onClick:v=>v.stopPropagation(),children:[t==="choose"&&o.jsxs(o.Fragment,{children:[o.jsx("h2",{children:"Coin Flip"}),o.jsx("p",{children:"Choose heads or tails to determine who starts the game."}),o.jsxs("div",{className:"coin-flip-choices",children:[o.jsxs("button",{className:"btn coin-flip-choice-btn",onClick:()=>m("heads"),children:[o.jsx("div",{className:"coin-choice-icon",children:"H"}),o.jsx("div",{className:"coin-choice-label",children:"Heads"})]}),o.jsxs("button",{className:"btn coin-flip-choice-btn",onClick:()=>m("tails"),children:[o.jsx("div",{className:"coin-choice-icon",children:"T"}),o.jsx("div",{className:"coin-choice-label",children:"Tails"})]})]})]}),t==="flipping"&&o.jsxs(o.Fragment,{children:[o.jsx("h2",{children:"Flipping..."}),o.jsxs("p",{children:["You chose: ",o.jsx("span",{className:"coin-flip-highlight",children:i==="heads"?"Heads":"Tails"})]}),o.jsx("div",{className:"coin-flip-animation-container",children:o.jsxs("div",{className:`coin-3d ${u?"is-flipping":""}`,children:[o.jsx("div",{className:"coin-face coin-heads",children:"H"}),o.jsx("div",{className:"coin-face coin-tails",children:"T"})]})})]}),t==="result"&&d&&i&&o.jsxs(o.Fragment,{children:[o.jsx("h2",{children:"Result"}),o.jsxs("p",{children:["You chose: ",o.jsx("span",{className:"coin-flip-highlight",children:i==="heads"?"Heads":"Tails"})]}),o.jsx("div",{className:"coin-flip-animation-container",children:o.jsxs("div",{className:`coin-3d result-${d}`,children:[o.jsx("div",{className:"coin-face coin-heads",children:"H"}),o.jsx("div",{className:"coin-face coin-tails",children:"T"})]})}),o.jsxs("p",{className:"coin-flip-result-text",children:["The coin landed on: ",o.jsx("span",{className:"coin-flip-highlight",children:d==="heads"?"Heads":"Tails"})]}),d===i?o.jsx("p",{className:"coin-flip-winner-text",children:"You won! You will start the game."}):o.jsx("p",{className:"coin-flip-loser-text",children:"Opponent won! Opponent will start the game."}),o.jsx("button",{className:"btn",onClick:y,children:"Continue"})]})]})})}const Vx="anarchy-custom-001",Bx="Anarchy",Yx="Custom recreation of Anarchy protocol to validate editor capabilities",Gx="System Validation",Wx="2025-11-08T00:00:00.000Z",Qx="#8B0000",Xx="chaos",Zx=[{value:0,topEffects:[],middleEffects:[{id:"anarchy-0-shift",params:{action:"shift",targetFilter:{owner:"any",position:"uncovered",faceState:"any"}},position:"middle",trigger:"on_play"},{id:"anarchy-0-draw",params:{action:"draw",count:1,target:"self",source:"own_deck",conditional:{type:"non_matching_protocols"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[{id:"anarchy-1-passive",params:{action:"passive_rule",rule:{type:"require_non_matching_protocol",target:"all",scope:"global"}},position:"top",trigger:"passive"}],middleEffects:[{id:"anarchy-1-shift",params:{action:"shift",targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!0},destinationRestriction:{type:"non_matching_protocol"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"anarchy-2-delete",params:{action:"delete",count:1,targetFilter:{position:"any",faceState:"face_up"},protocolMatching:"must_match",excludeSelf:!1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"anarchy-3-swap",params:{action:"swap_protocols",target:"opponent"},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"anarchy-3-end-rearrange",params:{action:"rearrange_protocols",target:"own",restriction:{disallowedProtocol:"Anarchy",laneIndex:"current"}},position:"bottom",trigger:"end"}]},{value:5,topEffects:[],middleEffects:[{id:"anarchy-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:6,topEffects:[{id:"anarchy-6-start-flip",params:{action:"flip",count:1,flipSelf:!0,optional:!1,targetFilter:{owner:"any",position:"any",faceState:"any",excludeSelf:!1},advancedConditional:{type:"protocol_match",protocol:"Anarchy"}},position:"top",trigger:"start"}],middleEffects:[],bottomEffects:[]}],Kx="Fan-Content",Im={id:Vx,name:Bx,description:Yx,author:Gx,createdAt:Wx,color:Qx,pattern:Xx,cards:Zx,category:Kx},Jx="apathy_custom",ew="Apathy",tw="Custom implementation of Apathy protocol",nw="System",aw="2025-01-08T00:00:00Z",ow="#9E9E9E",rw="radial",lw=[{value:0,topEffects:[{id:"apathy-0-value-modifier",params:{action:"value_modifier",modifier:{type:"add_per_condition",value:1,condition:"per_face_down_card",target:"own_total",scope:"this_lane"}},position:"top",trigger:"passive"}],middleEffects:[],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"apathy-1-flip-all",params:{action:"flip",count:"all",optional:!1,scope:"this_lane",targetFilter:{owner:"any",position:"any",faceState:"face_up",excludeSelf:!0}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:2,topEffects:[{id:"apathy-2-passive",params:{action:"passive_rule",rule:{type:"ignore_middle_commands",target:"all",scope:"this_lane"}},position:"top",trigger:"passive"}],middleEffects:[],bottomEffects:[{id:"apathy-2-on-cover",params:{action:"flip",count:1,flipSelf:!0,optional:!1,targetFilter:{owner:"any",position:"any",faceState:"any",excludeSelf:!1}},position:"bottom",trigger:"on_cover"}]},{value:3,topEffects:[],middleEffects:[{id:"apathy-3-flip-opponent",params:{action:"flip",count:1,optional:!1,targetFilter:{owner:"opponent",position:"uncovered",faceState:"face_up",excludeSelf:!1}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"apathy-4-flip-covered",params:{action:"flip",count:1,optional:!0,targetFilter:{owner:"own",position:"covered",faceState:"face_up",excludeSelf:!1}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"apathy-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],sw="Aux 1",Um={id:Jx,name:ew,description:tw,author:nw,createdAt:aw,color:ow,pattern:rw,cards:lw,category:sw},cw="chaos_custom_1",iw="Chaos",dw="Embrace the unpredictable. Custom protocol migration of original Chaos protocol.",uw="#E64DB8",pw="chaos",fw=[{value:0,topEffects:[],middleEffects:[{id:"chaos_0_flip_covered",trigger:"on_play",params:{action:"flip",count:1,scope:"each_lane",targetFilter:{owner:"any",position:"covered",faceState:"any"}},position:"middle"}],bottomEffects:[{id:"chaos_0_start_swap_draws",trigger:"start",params:{action:"mutual_draw",count:1},position:"bottom"}]},{value:1,topEffects:[],middleEffects:[{id:"chaos_1_rearrange_own",trigger:"on_play",params:{action:"rearrange_protocols",target:"own"},position:"middle"},{id:"chaos_1_rearrange_opponent",trigger:"on_play",params:{action:"rearrange_protocols",target:"opponent"},position:"middle"}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"chaos_2_shift_covered",trigger:"on_play",params:{action:"shift",count:1,targetFilter:{owner:"own",position:"covered",faceState:"any"}},position:"middle"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[],bottomEffects:[{id:"chaos_3_allow_any_protocol",trigger:"passive",params:{action:"passive_rule",rule:{type:"allow_any_protocol_play",target:"self",scope:"global"}},position:"bottom"}]},{value:4,topEffects:[],middleEffects:[],bottomEffects:[{id:"chaos_4_end_discard_draw",trigger:"end",params:{action:"discard",count:"all",actor:"self"},conditional:{type:"then",thenEffect:{id:"chaos_4_draw_after_discard",trigger:"on_play",params:{action:"draw",count:1,countType:"equal_to_discarded",countOffset:0,target:"self",source:"own_deck"},position:"bottom"}},position:"bottom"}]},{value:5,topEffects:[],middleEffects:[{id:"chaos_5_discard",trigger:"on_play",params:{action:"discard",count:1,actor:"self"},position:"middle"}],bottomEffects:[]}],hw="Main 2",Pm={id:cw,name:iw,description:dw,color:uw,pattern:pw,cards:fw,category:hw},mw="darkness_custom_v1",yw="Darkness",gw="Custom Darkness protocol - manipulate face-down cards, flip and shift",vw="System",_w="2025-01-08T00:00:00Z",xw="#1a0033",ww="grid",Cw=[{value:0,topEffects:[],middleEffects:[{id:"dark-0-draw",params:{action:"draw",count:3,target:"self",source:"own_deck"},position:"middle",trigger:"on_play"},{id:"dark-0-shift",params:{action:"shift",targetFilter:{owner:"opponent",position:"covered",faceState:"any",excludeSelf:!1},destinationRestriction:{type:"any"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"dark-1-flip",params:{action:"flip",count:1,optional:!1,targetFilter:{owner:"opponent",position:"uncovered",faceState:"any",excludeSelf:!1}},position:"middle",trigger:"on_play"},{id:"dark-1-shift",params:{action:"shift",optional:!0,targetFilter:{owner:"any",position:"any",faceState:"any",excludeSelf:!1},destinationRestriction:{type:"any"}},position:"middle",trigger:"on_play",useCardFromPreviousEffect:!0}],bottomEffects:[]},{value:2,topEffects:[{id:"dark-2-value-modifier",params:{action:"value_modifier",modifier:{type:"set_to_fixed",value:4,target:"own_cards",scope:"this_lane",filter:{faceState:"face_down",position:"any"}}},position:"top",trigger:"passive"}],middleEffects:[{id:"dark-2-flip",params:{action:"flip",count:1,optional:!0,scope:"this_lane",targetFilter:{owner:"any",position:"covered",faceState:"any",excludeSelf:!1}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"dark-3-play",params:{action:"play",source:"hand",count:1,faceDown:!0,destinationRule:{type:"other_lines",excludeCurrentLane:!0}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"dark-4-shift",params:{action:"shift",targetFilter:{owner:"any",position:"uncovered",faceState:"face_down",excludeSelf:!1},destinationRestriction:{type:"any"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"dark-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],Sw="Main 1",Om={id:mw,name:yw,description:gw,author:vw,createdAt:_w,color:xw,pattern:ww,cards:Cw,category:Sw},bw="death_custom_v1",Ew="Death",jw="Custom Death protocol - delete cards with various conditions",kw="System",Nw="2025-01-09T00:00:00Z",Rw="#8B0000",Tw="stripes",Aw=[{value:0,topEffects:[],middleEffects:[{id:"death-0-delete-from-each-lane",params:{action:"delete",count:1,scope:{type:"each_other_line"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[{id:"death-1-optional-draw",params:{action:"draw",count:1,optional:!0},position:"top",trigger:"start",conditional:{type:"if_executed",thenEffect:{id:"death-1-delete-other",params:{action:"delete",count:1,excludeSelf:!0},position:"top",trigger:"start",conditional:{type:"then",thenEffect:{id:"death-1-delete-self",params:{action:"delete",count:1,targetFilter:{position:"any",owner:"own"},deleteSelf:!0},position:"top",trigger:"start"}}}}}],middleEffects:[],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"death-2-delete-lane-values",params:{action:"delete",count:"all",selectLane:!0,targetFilter:{faceState:"any",valueRange:{min:1,max:2}}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"death-3-delete-facedown",params:{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"face_down"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"death-4-delete-low-value",params:{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"face_up",valueRange:{min:0,max:1}}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"death-5-discard",params:{action:"discard",count:1},position:"middle",trigger:"on_play"}],bottomEffects:[]}],Dw="Main 1",Mm={id:bw,name:Ew,description:jw,author:kw,createdAt:Nw,color:Rw,pattern:Tw,cards:Aw,category:Dw},Fw="fire-custom-001",qw="Fire",$w="Fire protocol - discard cards to fuel powerful effects",Lw="System",Iw="2025-11-09T00:00:00.000Z",Uw="#F06838",Pw="radial",Ow=[{value:0,topEffects:[],middleEffects:[{id:"fire-0-flip",params:{action:"flip",count:1,targetFilter:{excludeSelf:!0}},position:"middle",trigger:"on_play"},{id:"fire-0-draw",params:{action:"draw",count:2},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"fire-0-oncover-draw",params:{action:"draw",count:1},position:"bottom",trigger:"on_cover",conditional:{type:"then",thenEffect:{id:"fire-0-oncover-flip",params:{action:"flip",count:1,targetFilter:{excludeSelf:!0}},position:"bottom",trigger:"on_cover"}}}]},{value:1,topEffects:[],middleEffects:[{id:"fire-1-discard",params:{action:"discard",count:1},position:"middle",trigger:"on_play",conditional:{type:"if_executed",thenEffect:{id:"fire-1-delete",params:{action:"delete",count:1},position:"middle",trigger:"on_play"}}}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"fire-2-discard",params:{action:"discard",count:1},position:"middle",trigger:"on_play",conditional:{type:"if_executed",thenEffect:{id:"fire-2-return",params:{action:"return",count:1,targetFilter:{position:"uncovered"}},position:"middle",trigger:"on_play"}}}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[],bottomEffects:[{id:"fire-3-discard",params:{action:"discard",count:1,optional:!0},position:"bottom",trigger:"end",conditional:{type:"if_executed",thenEffect:{id:"fire-3-flip",params:{action:"flip",count:1},position:"bottom",trigger:"end"}}}]},{value:4,topEffects:[],middleEffects:[{id:"fire-4-discard-variable",params:{action:"discard",count:1,variableCount:!0},position:"middle",trigger:"on_play",conditional:{type:"then",thenEffect:{id:"fire-4-draw-based-on-discard",params:{action:"draw",countType:"equal_to_discarded",countOffset:1},position:"middle",trigger:"on_play"}}}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"fire-5-discard",params:{action:"discard",count:1,optional:!1},position:"middle",trigger:"on_play"}],bottomEffects:[]}],Mw="Main 1",Hm={id:Fw,name:qw,description:$w,author:Lw,createdAt:Iw,color:Uw,pattern:Pw,cards:Ow,category:Mw},Hw="frost_custom_1",zw="Frost",Vw="Freeze the game state. Frost blocks actions and preserves face-down cards.",Bw="#87CEEB",Yw="frost",Gw=[{value:0,topEffects:[],middleEffects:[{id:"frost_0_draw_per_face_down",trigger:"on_play",position:"middle",params:{action:"draw",count:1,source:"own_deck",target:"self",countType:"count_face_down"}}],bottomEffects:[]},{value:1,topEffects:[{id:"frost_1_block_flips",trigger:"passive",position:"top",params:{action:"passive_rule",rule:{type:"block_flips",target:"all",scope:"global"}}}],middleEffects:[],bottomEffects:[{id:"frost_1_block_rearrange",trigger:"passive",position:"bottom",params:{action:"passive_rule",rule:{type:"block_protocol_rearrange",target:"all",scope:"global"}}}]},{value:2,topEffects:[],middleEffects:[{id:"frost_2_play_face_down",trigger:"on_play",position:"middle",params:{action:"play",count:1,source:"hand",faceDown:!0}}],bottomEffects:[]},{value:3,topEffects:[{id:"frost_3_block_shifts",trigger:"passive",position:"top",params:{action:"passive_rule",rule:{type:"block_shifts_from_and_to_lane",target:"all",scope:"this_lane"}}}],middleEffects:[],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"frost_4_flip_covered",trigger:"on_play",position:"middle",params:{action:"flip",count:1,optional:!0,targetFilter:{owner:"own",faceState:"face_up",position:"covered"}}}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"frost_5_discard",trigger:"on_play",position:"middle",params:{action:"discard",count:1,target:"self"}}],bottomEffects:[]}],Ww="Fan-Content",zm={id:Hw,name:zw,description:Vw,color:Bw,pattern:Yw,cards:Gw,category:Ww},Qw="hate-custom-001",Xw="Hate",Zw="Focused on deletion and sacrifice. Delete cards to gain advantage.",Kw="System Migration",Jw="2025-11-13T00:00:00.000Z",eC="#E67A7A",tC="diagonal-lines",nC=[{value:0,topEffects:[],middleEffects:[{id:"hate-0-delete",params:{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"any"},scope:{type:"anywhere"},excludeSelf:!1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"hate-1-discard",params:{action:"discard",count:3,actor:"self",upTo:!0},position:"middle",trigger:"on_play"},{id:"hate-1-delete-1",params:{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"any"},scope:{type:"anywhere"},excludeSelf:!1,upTo:!0},position:"middle",trigger:"on_play"},{id:"hate-1-delete-2",params:{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"any"},scope:{type:"anywhere"},excludeSelf:!1,upTo:!0},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"hate-2-delete-own",params:{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"any",calculation:"highest_value",owner:"own"},scope:{type:"anywhere"},excludeSelf:!1},position:"middle",trigger:"on_play"},{id:"hate-2-delete-opponent",params:{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"any",calculation:"highest_value",owner:"opponent"},scope:{type:"anywhere"},excludeSelf:!1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[{id:"hate-3-reactive-draw",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"top",trigger:"after_delete",reactiveTriggerActor:"self"}],middleEffects:[],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[],bottomEffects:[{id:"hate-4-on-cover-delete",params:{action:"delete",count:1,targetFilter:{position:"covered_by_context",faceState:"any",calculation:"lowest_value"},scope:{type:"this_line"},excludeSelf:!1,autoExecute:!0},position:"bottom",trigger:"on_cover"}]},{value:5,topEffects:[],middleEffects:[{id:"hate-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],aC="Aux 1",Vm={id:Qw,name:Xw,description:Zw,author:Kw,createdAt:Jw,color:eC,pattern:tC,cards:nC,category:aC},oC="water_custom_1",rC="Water",lC="Wash away and renew. Custom protocol migration of original Water protocol.",sC="#5DADE2",cC="multi-radial",iC=[{value:0,topEffects:[],middleEffects:[{id:"water_0_flip_other",trigger:"immediate",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!0},optional:!1},position:"middle"},{id:"water_0_flip_self",trigger:"immediate",params:{action:"flip",flipSelf:!0},position:"middle"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"water_1_play",trigger:"immediate",params:{action:"play",source:"deck",count:1,faceDown:!0,destinationRule:{type:"each_other_line"}},position:"middle"}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"water_2_draw",trigger:"immediate",params:{action:"draw",count:2},position:"middle"},{id:"water_2_rearrange",trigger:"immediate",params:{action:"rearrange_protocols",target:"own"},position:"middle"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"water_3_return",trigger:"immediate",params:{action:"return",count:"all",targetFilter:{owner:"any",position:"uncovered",valueEquals:2},selectLane:!0},position:"middle"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"water_4_return",trigger:"immediate",params:{action:"return",count:1,targetFilter:{owner:"own",position:"uncovered"}},position:"middle"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"water_5_discard",trigger:"immediate",params:{action:"discard",count:1,actor:"self"},position:"middle"}],bottomEffects:[]}],dC="Main 1",Bm={id:oC,name:rC,description:lC,color:sC,pattern:cC,cards:iC,category:dC},uC="spirit_custom_1",pC="Spirit",fC="True strength from within. Custom protocol migration of original Spirit protocol.",hC="#5DD9C1",mC="dual-radial",yC=[{value:0,topEffects:[],middleEffects:[{id:"spirit_0_refresh",trigger:"on_play",params:{action:"refresh",target:"self"},position:"middle"},{id:"spirit_0_draw",trigger:"on_play",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"middle"}],bottomEffects:[{id:"spirit_0_skip_cache",trigger:"passive",params:{action:"passive_rule",rule:{type:"skip_check_cache_phase",target:"self",scope:"global"}},position:"bottom"}]},{value:1,topEffects:[{id:"spirit_1_play_anywhere",trigger:"passive",params:{action:"passive_rule",rule:{type:"allow_any_protocol_play",target:"self",scope:"global"}},position:"top"}],middleEffects:[{id:"spirit_1_draw",trigger:"on_play",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"middle"}],bottomEffects:[{id:"spirit_1_choice",trigger:"start",params:{action:"choice",options:[{id:"spirit_1_choice_discard",trigger:"on_play",params:{action:"discard",count:1,actor:"self"},position:"bottom"},{id:"spirit_1_choice_flip",trigger:"on_play",params:{action:"flip",flipSelf:!0},position:"bottom"}]},position:"bottom"}]},{value:2,topEffects:[],middleEffects:[{id:"spirit_2_flip",trigger:"on_play",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1},optional:!0},position:"middle"}],bottomEffects:[]},{value:3,topEffects:[{id:"spirit_3_shift",trigger:"after_draw",reactiveTriggerActor:"self",params:{action:"shift",count:1,optional:!0,targetFilter:{owner:"own",position:"any",faceState:"any",excludeSelf:!1}},position:"top"}],middleEffects:[],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"spirit_4_swap",trigger:"on_play",params:{action:"swap_protocols",target:"own"},position:"middle"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"spirit_5_discard",trigger:"on_play",params:{action:"discard",count:1,actor:"self"},position:"middle"}],bottomEffects:[]}],gC="Main 1",Ym={id:uC,name:pC,description:fC,color:hC,pattern:mC,cards:yC,category:gC},vC="gravity_custom_1",_C="Gravity",xC="Pull everything together. Gravity draws cards towards this line.",wC="#7599EB",CC="grid",SC=[{value:0,topEffects:[],middleEffects:[{id:"gravity_0_play_per_2_cards",trigger:"on_play",params:{action:"play",source:"deck",count:1,faceDown:!0,destinationRule:{type:"under_this_card"},condition:{type:"per_x_cards_in_line",cardCount:2},actor:"self"},position:"middle"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"gravity_1_draw_2",trigger:"on_play",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"middle"},{id:"gravity_1_shift_to_or_from",trigger:"on_play",params:{action:"shift",targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1},destinationRestriction:{type:"to_or_from_this_lane",laneIndex:"current"}},position:"middle"}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"gravity_2_flip",trigger:"on_play",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1},optional:!1},position:"middle"},{id:"gravity_2_shift_to_this_line",trigger:"on_play",params:{action:"shift",targetFilter:{owner:"any",position:"any",faceState:"any",excludeSelf:!1},destinationRestriction:{type:"to_this_lane",laneIndex:"current"}},position:"middle",useCardFromPreviousEffect:!0}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"gravity_4_shift_face_down_to_this_line",trigger:"on_play",params:{action:"shift",targetFilter:{owner:"any",position:"uncovered",faceState:"face_down",excludeSelf:!1},destinationRestriction:{type:"to_this_lane",laneIndex:"current"}},position:"middle"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"gravity_5_discard",trigger:"on_play",params:{action:"discard",count:1,actor:"self"},position:"middle"}],bottomEffects:[]},{value:6,topEffects:[],middleEffects:[{id:"gravity_6_opponent_plays",trigger:"on_play",params:{action:"play",source:"deck",count:1,faceDown:!0,destinationRule:{type:"specific_lane",laneIndex:"current"},actor:"opponent"},position:"middle",comment:"Opponent plays top of their deck in this line"}],bottomEffects:[]}],bC="Main 1",Gm={id:vC,name:_C,description:xC,color:wC,pattern:CC,cards:SC,category:bC},EC="life_custom_1",jC="Life",kC="Life begets more life. Play cards from your deck to grow your presence.",NC="#3CE076",RC="hexagons",TC=[{value:0,topEffects:[],middleEffects:[{id:"life_0_play_each_line_with_card",trigger:"on_play",position:"middle",params:{action:"play",source:"deck",count:1,faceDown:!0,destinationRule:{type:"each_line_with_card",ownerFilter:"own"},actor:"self"}}],bottomEffects:[{id:"life_0_on_cover_delete_self",trigger:"on_cover",position:"bottom",params:{action:"delete",deleteSelf:!0}}]},{value:1,topEffects:[],middleEffects:[{id:"life_1_flip_1",trigger:"on_play",position:"middle",params:{action:"flip",count:1,optional:!1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1}}},{id:"life_1_flip_2",trigger:"on_play",position:"middle",params:{action:"flip",count:1,optional:!1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1}}}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"life_2_draw",trigger:"on_play",position:"middle",params:{action:"draw",count:1,target:"self",source:"own_deck"}},{id:"life_2_flip",trigger:"on_play",position:"middle",params:{action:"flip",count:1,optional:!0,targetFilter:{owner:"any",position:"uncovered",faceState:"face_down",excludeSelf:!1}}}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[],bottomEffects:[{id:"life_3_on_cover_play",trigger:"on_cover",position:"bottom",params:{action:"play",source:"deck",count:1,faceDown:!0,destinationRule:{type:"another_line",excludeCurrentLane:!0},actor:"self"}}]},{value:4,topEffects:[],middleEffects:[{id:"life_4_conditional_draw",trigger:"on_play",position:"middle",params:{action:"draw",count:1,target:"self",source:"own_deck",conditional:{type:"is_covering"}}}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"life_5_discard",trigger:"on_play",position:"middle",params:{action:"discard",count:1,actor:"self"}}],bottomEffects:[]}],AC="Main 1",Wm={id:EC,name:jC,description:kC,color:NC,pattern:RC,cards:TC,category:AC},DC="light_custom_1",FC="Light",qC="Burn away the dark. Light protocol reveals and manipulates through illumination.",$C="System",LC="2025-11-14T00:00:00.000Z",IC="#F4D03F",UC="radial",PC=[{value:0,topEffects:[],middleEffects:[{id:"light-0-flip",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1},optional:!1},position:"middle",trigger:"on_play"},{id:"light-0-draw",params:{action:"draw",count:1,target:"self",source:"own_deck",countType:"equal_to_card_value"},position:"middle",trigger:"on_play",useCardFromPreviousEffect:!0}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[],bottomEffects:[{id:"light-1-draw",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"bottom",trigger:"end"}]},{value:2,topEffects:[],middleEffects:[{id:"light-2-draw",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"middle",trigger:"on_play"},{id:"light-2-reveal-board-card",params:{action:"reveal",source:"board",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"face_down"},optional:!0},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"light-3-shift-all",params:{action:"shift",count:"all",targetFilter:{owner:"any",position:"any",faceState:"face_down",excludeSelf:!1},destinationRestriction:{type:"to_another_line"},scope:"this_lane"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"light-4-reveal",params:{action:"reveal",source:"opponent_hand",count:-1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"light-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],OC="Main 1",Qm={id:DC,name:FC,description:qC,author:$C,createdAt:LC,color:IC,pattern:UC,cards:PC,category:OC},MC="speed_custom_1",HC="Speed",zC="Swift and adaptive. Custom protocol migration of original Speed protocol.",VC="#33E6E6",BC="cross",YC=[{value:0,topEffects:[],middleEffects:[{id:"speed_0_play",trigger:"on_play",params:{action:"play",source:"hand",count:1},position:"middle"}],bottomEffects:[]},{value:1,topEffects:[{id:"speed_1_reactive_draw",trigger:"after_clear_cache",reactiveTriggerActor:"self",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"top"}],middleEffects:[{id:"speed_1_draw",trigger:"on_play",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"middle"}],bottomEffects:[]},{value:2,topEffects:[{id:"speed_2_before_compile",trigger:"before_compile_delete",params:{action:"shift",count:1,shiftSelf:!0,allowCoveredSelf:!0,targetFilter:{owner:"own",position:"any",faceState:"any"}},position:"top"}],middleEffects:[],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"speed_3_shift_other",trigger:"on_play",params:{action:"shift",count:1,targetFilter:{owner:"own",position:"uncovered",faceState:"any",excludeSelf:!0}},position:"middle"}],bottomEffects:[{id:"speed_3_end_shift",trigger:"end",params:{action:"shift",count:1,optional:!0,targetFilter:{owner:"own",position:"uncovered",faceState:"any"}},position:"bottom",conditional:{type:"if_executed",thenEffect:{id:"speed_3_flip_self",trigger:"on_play",params:{action:"flip",flipSelf:!0},position:"bottom"}}}]},{value:4,topEffects:[],middleEffects:[{id:"speed_4_shift_opponent",trigger:"on_play",params:{action:"shift",count:1,targetFilter:{owner:"opponent",position:"uncovered",faceState:"face_down"}},position:"middle"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"speed_5_discard",trigger:"on_play",params:{action:"discard",count:1,actor:"self"},position:"middle"}],bottomEffects:[]}],GC="Main 1",Xm={id:MC,name:HC,description:zC,color:VC,pattern:BC,cards:YC,category:GC},WC="metal_custom_1",QC="Metal",XC="Unyielding defense. Custom protocol migration of original Metal protocol.",ZC="#B0BEC5",KC="grid",JC=[{value:0,topEffects:[{id:"metal_0_reduce_opponent",trigger:"passive",params:{action:"value_modifier",modifier:{type:"add_to_total",value:-2,target:"opponent_total",scope:"this_lane"}},position:"top"}],middleEffects:[{id:"metal_0_flip",trigger:"on_play",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any"}},position:"middle"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"metal_1_draw",trigger:"on_play",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"middle"},{id:"metal_1_block_compile",trigger:"on_play",params:{action:"block_compile",target:"opponent"},position:"middle"}],bottomEffects:[]},{value:2,topEffects:[{id:"metal_2_block_face_down",trigger:"passive",params:{action:"passive_rule",rule:{type:"block_face_down_play",scope:"this_lane"}},position:"top"}],middleEffects:[],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"metal_3_draw",trigger:"on_play",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"middle"},{id:"metal_3_delete_lane",trigger:"on_play",params:{action:"delete_all_in_lane",laneCondition:{type:"min_cards",count:8},excludeCurrentLane:!0},position:"middle"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"metal_5_discard",trigger:"on_play",params:{action:"discard",count:1,actor:"self"},position:"middle"}],bottomEffects:[]},{value:6,topEffects:[{id:"metal_6_delete_on_cover_or_flip",trigger:"on_cover_or_flip",params:{action:"delete",deleteSelf:!0},position:"top"}],middleEffects:[],bottomEffects:[]}],e1="Main 1",Zm={id:WC,name:QC,description:XC,color:ZC,pattern:KC,cards:JC,category:e1},t1="plague-custom-001",n1="Plague",a1="Focused on forcing opponent discards and restricting their plays. Spread suffering.",o1="System Migration",r1="2025-11-26T00:00:00.000Z",l1="#8FBC3A",s1="dual-radial",c1=[{value:0,topEffects:[],middleEffects:[{id:"plague-0-opponent-discard",params:{action:"discard",count:1,actor:"opponent"},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"plague-0-block-play",params:{action:"passive_rule",rule:{type:"block_all_play",target:"opponent",scope:"this_lane"}},position:"bottom",trigger:"passive"}]},{value:1,topEffects:[{id:"plague-1-reactive-draw",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"top",trigger:"after_opponent_discard"}],middleEffects:[{id:"plague-1-opponent-discard",params:{action:"discard",count:1,actor:"opponent"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"plague-2-self-discard",params:{action:"discard",count:1,actor:"self",variableCount:!0},position:"middle",trigger:"on_play",conditional:{type:"then",thenEffect:{id:"plague-2-opponent-discard",params:{action:"discard",actor:"opponent",countType:"equal_to_discarded",countOffset:1},position:"middle",trigger:"on_play"}}}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"plague-3-flip-each-other",params:{action:"flip",count:"all",scope:{type:"anywhere"},targetFilter:{faceState:"face_up",owner:"any",position:"uncovered",excludeSelf:!0}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,text:{bottom:"<div><span class='emphasis'>End:</span> Your opponent deletes 1 of their face-down cards. You may flip this card.</div>"},topEffects:[],middleEffects:[],bottomEffects:[{id:"plague-4-opponent-delete",params:{action:"delete",count:1,targetFilter:{faceState:"face_down",owner:"opponent",position:"uncovered"},scope:{type:"anywhere"},actorChooses:"card_owner"},position:"bottom",trigger:"end"},{id:"plague-4-may-flip-self",params:{action:"flip",flipSelf:!0,optional:!0},position:"bottom",trigger:"end"}]},{value:5,topEffects:[],middleEffects:[{id:"plague-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],i1="Main 1",Km={id:t1,name:n1,description:a1,author:o1,createdAt:r1,color:l1,pattern:s1,cards:c1,category:i1},d1="love_custom_v1",u1="Love",p1="Custom Love protocol - hand manipulation, giving and taking cards",f1="System",h1="2025-01-08T00:00:00Z",m1="#f2a3d7",y1="radial",g1=[{value:1,topEffects:[],middleEffects:[{id:"love-1-draw-opponent-deck",params:{action:"draw",count:1,target:"self",source:"opponent_deck"},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"love-1-end-give",params:{action:"give",count:1,source:"own_hand",optional:!0},conditional:{type:"if_executed",thenEffect:{id:"love-1-end-draw",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"bottom",trigger:"on_play"}},position:"bottom",trigger:"end"}]},{value:2,topEffects:[],middleEffects:[{id:"love-2-opponent-draw",params:{action:"draw",count:1,target:"opponent",source:"own_deck"},position:"middle",trigger:"on_play"},{id:"love-2-refresh",params:{action:"refresh",target:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"love-3-take",params:{action:"take",count:1,random:!0},position:"middle",trigger:"on_play"},{id:"love-3-give",params:{action:"give",count:1,source:"own_hand",optional:!1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"love-4-reveal",params:{action:"reveal",count:1,source:"own_hand"},position:"middle",trigger:"on_play"},{id:"love-4-flip",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"love-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:6,topEffects:[],middleEffects:[{id:"love-6-opponent-draw",params:{action:"draw",count:2,target:"opponent",source:"own_deck"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],v1="Aux 1",Jm={id:d1,name:u1,description:p1,author:f1,createdAt:h1,color:m1,pattern:y1,cards:g1,category:v1},_1="psychic_custom_v1",x1="Psychic",w1="Custom Psychic protocol - mind control, discard, reveal, and protocol manipulation",C1="System",S1="2025-01-08T00:00:00Z",b1="#c78dd9",E1="radial",j1=[{value:0,topEffects:[],middleEffects:[{id:"psychic-0-draw",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"middle",trigger:"on_play"},{id:"psychic-0-opponent-discard",params:{action:"discard",count:2,actor:"opponent"},position:"middle",trigger:"on_play"},{id:"psychic-0-reveal-hand",params:{action:"reveal",source:"opponent_hand",count:-1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[{id:"psychic-1-force-face-down",params:{action:"passive_rule",rule:{type:"require_face_down_play",target:"opponent",scope:"global"}},position:"top",trigger:"passive"}],middleEffects:[],bottomEffects:[{id:"psychic-1-start-flip-self",params:{action:"flip",count:1,targetFilter:{owner:"self",position:"any",faceState:"any",excludeSelf:!1},flipSelf:!0},position:"bottom",trigger:"start"}]},{value:2,topEffects:[],middleEffects:[{id:"psychic-2-opponent-discard",params:{action:"discard",count:2,actor:"opponent"},position:"middle",trigger:"on_play"},{id:"psychic-2-rearrange",params:{action:"rearrange_protocols",target:"opponent"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"psychic-3-opponent-discard",params:{action:"discard",count:1,actor:"opponent"},position:"middle",trigger:"on_play"},{id:"psychic-3-shift-opponent",params:{action:"shift",targetFilter:{owner:"opponent",position:"uncovered",faceState:"any",excludeSelf:!1},destinationRestriction:{type:"any"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[],bottomEffects:[{id:"psychic-4-end-return",params:{action:"return",count:1,optional:!0,targetFilter:{owner:"opponent",position:"uncovered",faceState:"any",excludeSelf:!1}},conditional:{type:"if_executed",thenEffect:{id:"psychic-4-end-flip-self",params:{action:"flip",count:1,flipSelf:!0,targetFilter:{owner:"self",position:"any",faceState:"any",excludeSelf:!1}},position:"bottom",trigger:"end"}},position:"bottom",trigger:"end"}]},{value:5,topEffects:[],middleEffects:[{id:"psychic-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],k1="Main 1",ey={id:_1,name:x1,description:w1,author:C1,createdAt:S1,color:b1,pattern:E1,cards:j1,category:k1},N1="smoke-custom-001",R1="Smoke",T1="Shroud your cards in mystery. Use face-down cards to gain value and control.",A1="System",D1="2025-12-09T00:00:00.000Z",F1="#5A5A5A",q1="radial",$1=[{value:0,topEffects:[],middleEffects:[{id:"smoke-0-play-deck-each-facedown",params:{action:"play",source:"deck",count:1,faceDown:!0,destinationRule:{type:"each_line_with_card",cardFilter:{faceState:"face_down"}}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"smoke-1-flip-own",params:{action:"flip",count:1,targetFilter:{owner:"own",position:"uncovered",faceState:"any"},optional:!1},position:"middle",trigger:"on_play"},{id:"smoke-1-shift-that-card",params:{action:"shift",optional:!0,targetFilter:{owner:"own",position:"uncovered",faceState:"any"}},position:"middle",trigger:"on_play",useCardFromPreviousEffect:!0}],bottomEffects:[]},{value:2,topEffects:[{id:"smoke-2-value-per-facedown",params:{action:"value_modifier",modifier:{type:"add_per_condition",value:1,condition:"per_face_down_card",target:"own_total",scope:"this_lane"}},position:"top",trigger:"passive"}],middleEffects:[],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"smoke-3-play-hand-facedown-lane",params:{action:"play",source:"hand",count:1,faceDown:!0,destinationRule:{type:"line_with_matching_cards",cardFilter:{faceState:"face_down"}}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"smoke-4-shift-covered-facedown",params:{action:"shift",optional:!1,targetFilter:{owner:"any",position:"covered",faceState:"face_down"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"smoke-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],L1="Main 2",ty={id:N1,name:R1,description:T1,author:A1,createdAt:D1,color:F1,pattern:q1,cards:$1,category:L1},I1="clarity-custom-001",U1="Clarity",P1="See through the fog of war. Reveal your deck and hand to gain powerful advantages.",O1="System",M1="2025-12-09T00:00:00.000Z",H1="#87CEEB",z1="radial",V1=[{value:0,topEffects:[{id:"clarity-0-value-per-hand",params:{action:"value_modifier",modifier:{type:"add_per_condition",value:1,condition:"per_card_in_hand",target:"own_total",scope:"this_lane"}},position:"top",trigger:"passive"}],middleEffects:[],bottomEffects:[]},{value:1,topEffects:[{id:"clarity-1-start-reveal-deck-top",params:{action:"reveal",source:"own_deck_top",count:1},position:"top",trigger:"start",conditional:{type:"optional",thenEffect:{id:"clarity-1-discard-revealed",params:{action:"discard",count:1,actor:"self",useCardFromPreviousEffect:!0}}}}],middleEffects:[{id:"clarity-1-middle-reveal-opponent-hand",params:{action:"reveal",source:"opponent_hand",count:-1},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"clarity-1-bottom-draw-3",params:{action:"draw",count:3,target:"self",source:"own_deck"},position:"bottom",trigger:"on_cover"}]},{value:2,topEffects:[],middleEffects:[{id:"clarity-2-reveal-deck",params:{action:"reveal",source:"own_deck",count:-1},position:"middle",trigger:"on_play"},{id:"clarity-2-draw-value-1",params:{action:"draw",count:1,target:"self",source:"own_deck",valueFilter:{equals:1},fromRevealed:!0},position:"middle",trigger:"on_play"},{id:"clarity-2-shuffle-deck",params:{action:"shuffle_deck"},position:"middle",trigger:"on_play"},{id:"clarity-2-play-value-1",params:{action:"play",source:"hand",count:1,faceDown:!1,valueFilter:{equals:1}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"clarity-3-reveal-deck",params:{action:"reveal",source:"own_deck",count:-1},position:"middle",trigger:"on_play"},{id:"clarity-3-draw-value-5",params:{action:"draw",count:1,target:"self",source:"own_deck",valueFilter:{equals:5},fromRevealed:!0},position:"middle",trigger:"on_play"},{id:"clarity-3-shuffle-deck",params:{action:"shuffle_deck"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"clarity-4-shuffle-trash",params:{action:"shuffle_trash",optional:!0},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"clarity-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],B1="Main 2",ny={id:I1,name:U1,description:P1,author:O1,createdAt:M1,color:H1,pattern:z1,cards:V1,category:B1},Y1="corruption-custom-001",G1="Corruption",W1="Corrupt your opponents plans. Use discard synergies and manipulate the return mechanic.",Q1="System",X1="2025-12-09T00:00:00.000Z",Z1="#4A0080",K1="stripes",J1=[{value:0,topEffects:[{id:"corruption-0-start-flip",params:{action:"flip",count:1,scope:"this_lane",targetFilter:{owner:"own",position:"any",faceState:"face_up",excludeSelf:!0},optional:!1},position:"top",trigger:"start"}],middleEffects:[],bottomEffects:[{id:"corruption-0-play-opponent-side",params:{action:"passive_rule",rule:{type:"allow_play_on_opponent_side",target:"self",scope:"global"}},position:"bottom",trigger:"passive"}]},{value:1,topEffects:[],middleEffects:[{id:"corruption-1-return",params:{action:"return",count:1,targetFilter:{owner:"any",position:"uncovered"}},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"corruption-1-redirect-return",params:{action:"redirect_return_to_deck",faceDown:!0,targetOwner:"opponent"},position:"bottom",trigger:"when_card_returned"}]},{value:2,topEffects:[{id:"corruption-2-after-discard",params:{action:"discard",count:1,actor:"opponent"},position:"top",trigger:"after_discard",reactiveTriggerActor:"self"}],middleEffects:[{id:"corruption-2-draw",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"middle",trigger:"on_play"},{id:"corruption-2-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"corruption-3-flip-covered",params:{action:"flip",count:1,optional:!0,targetFilter:{owner:"any",position:"covered",faceState:"face_up",excludeSelf:!1}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"corruption-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:6,topEffects:[{id:"corruption-6-end-choice",params:{action:"choice",options:[{id:"corruption-6-choice-discard",params:{action:"discard",count:1,actor:"self"},position:"top",trigger:"end"},{id:"corruption-6-choice-delete-self",params:{action:"delete",deleteSelf:!0},position:"top",trigger:"end"}]},position:"top",trigger:"end"}],middleEffects:[],bottomEffects:[]}],eS="Main 2",ay={id:Y1,name:G1,description:W1,author:Q1,createdAt:X1,color:Z1,pattern:K1,cards:J1,category:eS},tS="courage-custom-001",nS="Courage",aS="Face challenges head-on. Gain power when outnumbered.",oS="System",rS="2025-12-10T00:00:00.000Z",lS="#D4AF37",sS="radial",cS=[{value:0,topEffects:[{id:"courage-0-start-draw",params:{action:"draw",count:1,advancedConditional:{type:"empty_hand"}},position:"top",trigger:"start"}],middleEffects:[{id:"courage-0-draw",params:{action:"draw",count:1},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"courage-0-end-discard",params:{action:"discard",count:1,optional:!0},position:"bottom",trigger:"end",conditional:{type:"if_executed",thenEffect:{id:"courage-0-opponent-discard",params:{action:"discard",count:1,actor:"opponent"},position:"bottom",trigger:"end"}}}]},{value:1,topEffects:[],middleEffects:[{id:"courage-1-delete",params:{action:"delete",count:1,targetFilter:{owner:"opponent",position:"uncovered"},selectLane:!0,laneCondition:{type:"opponent_higher_value"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"courage-2-draw",params:{action:"draw",count:1},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"courage-2-end-draw",params:{action:"draw",count:1,advancedConditional:{type:"opponent_higher_value_in_lane"}},position:"bottom",trigger:"end"}]},{value:3,topEffects:[],middleEffects:[],bottomEffects:[{id:"courage-3-shift",params:{action:"shift",shiftSelf:!0,optional:!0,destinationRestriction:{type:"opponent_highest_value_lane"}},position:"bottom",trigger:"end"}]},{value:5,topEffects:[],middleEffects:[{id:"courage-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:6,topEffects:[{id:"courage-6-flip",params:{action:"flip",flipSelf:!0,advancedConditional:{type:"opponent_higher_value_in_lane"}},position:"top",trigger:"end"}],middleEffects:[],bottomEffects:[]}],iS="Main 2",oy={id:tS,name:nS,description:aS,author:oS,createdAt:rS,color:lS,pattern:sS,cards:cS,category:iS},dS="fear_custom",uS="Fear",pS="Terror and disruption protocol - Control through fear",fS="System",hS="2025-01-10T00:00:00Z",mS="#800020",yS="radial",gS="Main 2",vS=[{value:0,topEffects:[{id:"fear-0-passive",params:{action:"passive_rule",rule:{type:"ignore_middle_commands",target:"opponent",scope:"global",onlyDuringYourTurn:!0}},position:"top",trigger:"passive"}],middleEffects:[{id:"fear-0-choice",params:{action:"choice",options:[{id:"fear-0-shift",params:{action:"shift",targetFilter:{owner:"any",position:"uncovered",faceState:"any"}},position:"middle",trigger:"on_play"},{id:"fear-0-flip",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1},optional:!1},position:"middle",trigger:"on_play"}]},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"fear-1-draw",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"middle",trigger:"on_play",conditional:{type:"then",thenEffect:{id:"fear-1-opponent-discard-hand",params:{action:"discard",count:"all",actor:"opponent"},position:"middle",trigger:"on_play",conditional:{type:"then",thenEffect:{id:"fear-1-opponent-draw",params:{action:"draw",countType:"equal_to_discarded",countOffset:-1,target:"opponent",source:"own_deck"},position:"middle",trigger:"on_play"}}}}}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"fear-2-return",params:{action:"return",count:1,targetFilter:{owner:"opponent"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"fear-3-shift",params:{action:"shift",targetFilter:{owner:"opponent",position:"any",faceState:"any"},scope:"this_lane"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"fear-4-discard-random",params:{action:"discard",count:1,actor:"opponent",random:!0},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"fear-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],ry={id:dS,name:uS,description:pS,author:fS,createdAt:hS,color:mS,pattern:yS,category:gS,cards:vS},_S="ice_custom",xS="Ice",wS="Control and disruption through shifting and conditional effects",CS="System",SS="2025-12-10T00:00:00Z",bS="#B0E0E6",ES="radial",jS="Main 2",kS=[{value:1,topEffects:[],middleEffects:[{id:"ice-1-shift",params:{action:"shift",shiftSelf:!0,optional:!0},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"ice-1-reactive",params:{action:"discard",actor:"opponent",count:1},position:"bottom",trigger:"after_play",reactiveTriggerActor:"opponent",reactiveScope:"this_lane"}]},{value:2,topEffects:[],middleEffects:[{id:"ice-2-shift",params:{action:"shift",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!0}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[{id:"ice-3-end-shift",params:{action:"shift",shiftSelf:!0,optional:!0,advancedConditional:{type:"this_card_is_covered"}},position:"top",trigger:"end"}],middleEffects:[],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[],bottomEffects:[{id:"ice-4-passive",params:{action:"passive_rule",rule:{type:"block_flip_this_card",target:"this_card",scope:"this_card"}},position:"bottom",trigger:"passive"}]},{value:5,topEffects:[],middleEffects:[{id:"ice-5-discard",params:{action:"discard",actor:"self",count:1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:6,topEffects:[{id:"ice-6-passive",params:{action:"passive_rule",rule:{type:"block_draw_conditional",conditionTarget:"self",blockTarget:"self",scope:"global"}},position:"top",trigger:"passive"}],middleEffects:[],bottomEffects:[]}],ly={id:_S,name:xS,description:wS,author:CS,createdAt:SS,color:bS,pattern:ES,category:jS,cards:kS},NS="luck-custom-001",RS="Luck",TS="Gamble with fate. State numbers and protocols to manipulate the top of decks.",AS="System",DS="2025-01-15T00:00:00.000Z",FS="#FFD700",qS="chaos",$S=[{value:0,topEffects:[],middleEffects:[{id:"luck-0-state-number",params:{action:"state_number",numberSource:"own_protocol_values"},position:"middle",trigger:"on_play"},{id:"luck-0-draw-and-reveal",params:{action:"draw",count:3,target:"self",source:"own_deck",revealFromDrawn:{valueSource:"stated_number",thenAction:"may_play"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"luck-1-play-deck-top",params:{action:"play",source:"deck",count:1,faceDown:!0,destinationRule:{type:"another_line"}},position:"middle",trigger:"on_play",conditional:{type:"then",thenEffect:{id:"luck-1-flip-skip-middle",params:{action:"flip",skipMiddleCommand:!0},useCardFromPreviousEffect:!0}}}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"luck-2-discard-deck-top",params:{action:"discard",source:"top_deck_own",count:1},position:"middle",trigger:"on_play",conditional:{type:"then",thenEffect:{id:"luck-2-draw-equal-value",params:{action:"draw",countType:"equal_to_card_value",target:"self",source:"own_deck"},useCardFromPreviousEffect:!0}}}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"luck-3-state-protocol",params:{action:"state_protocol",protocolSource:"opponent_cards"},position:"middle",trigger:"on_play"},{id:"luck-3-discard-opponent-deck",params:{action:"discard",source:"top_deck_opponent",count:1},position:"middle",trigger:"on_play",conditional:{type:"if_protocol_matches_stated",thenEffect:{id:"luck-3-delete",params:{action:"delete",count:1}}}}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"luck-4-discard-deck-top",params:{action:"discard",source:"top_deck_own",count:1},position:"middle",trigger:"on_play",conditional:{type:"then",thenEffect:{id:"luck-4-delete-same-value",params:{action:"delete",count:1,targetFilter:{position:"any",valueSource:"previous_effect_card"}}}}}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"luck-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],LS="Main 2",sy={id:NS,name:RS,description:TS,author:AS,createdAt:DS,color:FS,pattern:qS,cards:$S,category:LS},IS="mirror-custom-001",US="Mirror",PS="Copy, symmetry, and reflection. Mirror your opponent's actions.",OS="System",MS="2025-01-15T00:00:00.000Z",HS="#C0C0C0",zS="radial",VS="Main 2",BS=[{value:0,topEffects:[{id:"mirror-0-value-modifier",params:{action:"value_modifier",modifier:{type:"add_per_condition",value:1,condition:"per_opponent_card_in_lane",target:"own_total",scope:"this_lane"}},position:"top",trigger:"passive"}],middleEffects:[],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[],bottomEffects:[{id:"mirror-1-copy-middle",params:{action:"copy_opponent_middle",optional:!0},position:"bottom",trigger:"end"}]},{value:2,topEffects:[],middleEffects:[{id:"mirror-2-swap-stacks",params:{action:"swap_stacks",target:"own"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"mirror-3-flip-own",params:{action:"flip",count:1,targetFilter:{owner:"own",position:"uncovered",faceState:"any",excludeSelf:!0},optional:!1},position:"middle",trigger:"on_play",conditional:{type:"then",thenEffect:{id:"mirror-3-flip-opponent-same-lane",params:{action:"flip",count:1,targetFilter:{owner:"opponent",position:"uncovered",faceState:"any"},sameLaneAsFirst:!0,optional:!1},position:"middle",trigger:"on_play"}}}],bottomEffects:[]},{value:4,topEffects:[{id:"mirror-4-after-opponent-draw",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"top",trigger:"after_opponent_draw"}],middleEffects:[],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"mirror-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],cy={id:IS,name:US,description:PS,author:OS,createdAt:MS,color:HS,pattern:zS,category:VS,cards:BS},YS="peace-custom-001",GS="Peace",WS="Harmony and balance. Sacrifice to achieve equilibrium.",QS="System",XS="2025-01-16T00:00:00.000Z",ZS="#87CEEB",KS="radial",JS="Main 2",eb=[{value:1,topEffects:[],middleEffects:[{id:"peace-1-both-discard",params:{action:"discard",actor:"both",count:"all"},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"peace-1-end-draw",params:{action:"draw",count:1,target:"self",source:"own_deck",advancedConditional:{type:"empty_hand"}},position:"bottom",trigger:"end"}]},{value:2,topEffects:[],middleEffects:[{id:"peace-2-draw",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"middle",trigger:"on_play"},{id:"peace-2-play",params:{action:"play",source:"hand",count:1,faceDown:!0},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"peace-3-discard-flip",params:{action:"discard",actor:"self",count:1},position:"middle",trigger:"on_play",optional:!0,conditional:{type:"if_executed",thenEffect:{id:"peace-3-flip",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1,valueMinGreaterThanHandSize:!0},optional:!1},position:"middle",trigger:"on_play"}}}],bottomEffects:[]},{value:4,topEffects:[{id:"peace-4-reactive-draw",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"top",trigger:"after_discard",reactiveTriggerActor:"self",onlyDuringOpponentTurn:!0}],middleEffects:[],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"peace-5-discard",params:{action:"discard",actor:"self",count:1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:6,topEffects:[],middleEffects:[{id:"peace-6-flip-self",params:{action:"flip",count:1,flipSelf:!0,advancedConditional:{type:"hand_size_greater_than",threshold:1}},position:"middle",trigger:"on_play"}],bottomEffects:[]}],iy={id:YS,name:GS,description:WS,author:QS,createdAt:XS,color:ZS,pattern:KS,category:JS,cards:eb};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const tb=[Im,Um,Pm,Om,Mm,Hm,zm,Vm,Bm,Ym,Gm,Wm,Qm,Xm,Zm,Km,Jm,ey,ty,ny,ay,oy,ry,ly,sy,cy,iy],nb=()=>tb.map(a=>a.name.replace(/_custom$/i,"")),ab=()=>{try{const a=sr(),t=a.findIndex(l=>l.id==="dark_cust_v2"||l.name==="Dark_cust");t>=0&&(a.splice(t,1),Yd(a)),_t(Im),_t(Um),_t(Om),_t(Mm),_t(Hm),_t(Bm),_t(Ym),_t(Pm),_t(Gm),_t(zm),_t(Vm),_t(Wm),_t(Qm),_t(Xm),_t(Zm),_t(Km),_t(Jm),_t(ey),_t(ty),_t(ny),_t(ay),_t(oy),_t(ry),_t(ly),_t(sy),_t(cy),_t(iy)}catch(a){console.error("[Default Protocols] Error loading default protocols:",a)}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const au="compile_game_statistics",dy=()=>{const a=J_,t=nb(),l=new Set([...a,...t]);return Array.from(l).sort()},uy=1;function fm(){const a=dy(),t={};return a.forEach(l=>{t[l]={timesUsed:0,wins:0,losses:0}}),{version:uy,global:{totalGamesPlayed:0,totalGamesWon:0,totalGamesLost:0,totalPlaytime:0,fastestWin:null,longestGame:null,lastGameDuration:null,currentStreak:0,longestWinStreak:0,longestLoseStreak:0},protocols:t,aiDifficulty:{easy:{played:0,wins:0,losses:0},normal:{played:0,wins:0,losses:0},hard:{played:0,wins:0,losses:0}},cards:{played:{},deleted:{}},actions:{totalCardsDrawn:0,totalCardsPlayed:0,totalShifts:0,totalDeletes:0,totalDiscards:0,totalFlips:0,totalCompiles:0,totalRefreshes:0,totalReturns:0,detailedStats:{cardsPlayed:{total:0,player:0,ai:0,playerFromHand:0,playerFromEffect:0,aiFromHand:0,aiFromEffect:0,playerFaceUp:0,playerFaceDown:0,aiFaceUp:0,aiFaceDown:0},cardsDrawn:{total:0,player:0,ai:0,playerFromRefresh:0,playerFromEffect:0,aiFromRefresh:0,aiFromEffect:0},discards:{total:0,player:0,ai:0},deletes:{total:0,player:0,ai:0},flips:{total:0,player:0,ai:0},shifts:{total:0,player:0,ai:0},returns:{total:0,player:0,ai:0},compiles:{total:0,player:0,ai:0,playerFirstCompile:0,playerRecompile:0,aiFirstCompile:0,aiRecompile:0},refreshes:{total:0,player:0,ai:0,playerCardsDrawn:0,aiCardsDrawn:0}}},control:{gamesWithControl:0,gamesWithoutControl:0,playerRearranges:0,aiRearranges:0,totalRearranges:0},coinFlip:{headsChosen:0,tailsChosen:0,headsWon:0,tailsWon:0}}}function Vd(){var a,t,l,i,c,d,f,u,p,m,y,v,x,w,S,E,b,j,C,R,F,L,O,T,G,V,z,U,k,A,I,$,q,M,B,W,K,D,Q,ae,Y,Z,ue,re,ee,X,le,J,me,ve,Se,Le,Ee,lt,et,Je,nt,je,Fe,Ve,Oe,Rt,tt,It,Zt,En,On,fa,Ea,yn,Ft,Kt,Ut,ha,ja,aa,Jt,dn,Mn,fn,Hn,jn,ka,oa,kn,Nn,Na,ma,ya,ga,zn,ra,fe,ke,De,Ae,Te,He,We,at,Me,pt,Pt,la,zt,xt,sa,Vn,Tt,Ja,xe,be,Ue,ft,Vt,un,Ra,tn,hn,nn,qt,$o,Jr,Qt,Lo,Ta,ir,an,eo,Io,ca,At,dr,Aa,Da,Jl,el,tl,ur,es,ts,Uo,Bn,pr,fr,Fa,qa;try{const Po=localStorage.getItem(au);if(!Po)return fm();const qe=JSON.parse(Po),ns=dy(),va={...qe.protocols||{}};ns.forEach(to=>{va[to]||(va[to]={timesUsed:0,wins:0,losses:0})});const Yn={...qe,version:uy,global:{...qe.global,lastGameDuration:((a=qe.global)==null?void 0:a.lastGameDuration)||null},protocols:va,control:{gamesWithControl:((t=qe.control)==null?void 0:t.gamesWithControl)||0,gamesWithoutControl:((l=qe.control)==null?void 0:l.gamesWithoutControl)||0,playerRearranges:((i=qe.control)==null?void 0:i.playerRearranges)||0,aiRearranges:((c=qe.control)==null?void 0:c.aiRearranges)||0,totalRearranges:((d=qe.control)==null?void 0:d.totalRearranges)||0},coinFlip:qe.coinFlip||{headsChosen:0,tailsChosen:0,headsWon:0,tailsWon:0},actions:{...qe.actions,totalCompiles:((f=qe.actions)==null?void 0:f.totalCompiles)||0,totalRefreshes:((u=qe.actions)==null?void 0:u.totalRefreshes)||0,totalReturns:((p=qe.actions)==null?void 0:p.totalReturns)||0,detailedStats:{cardsPlayed:{total:((v=(y=(m=qe.actions)==null?void 0:m.detailedStats)==null?void 0:y.cardsPlayed)==null?void 0:v.total)||0,player:((S=(w=(x=qe.actions)==null?void 0:x.detailedStats)==null?void 0:w.cardsPlayed)==null?void 0:S.player)||0,ai:((j=(b=(E=qe.actions)==null?void 0:E.detailedStats)==null?void 0:b.cardsPlayed)==null?void 0:j.ai)||0,playerFromHand:((F=(R=(C=qe.actions)==null?void 0:C.detailedStats)==null?void 0:R.cardsPlayed)==null?void 0:F.playerFromHand)||0,playerFromEffect:((T=(O=(L=qe.actions)==null?void 0:L.detailedStats)==null?void 0:O.cardsPlayed)==null?void 0:T.playerFromEffect)||0,aiFromHand:((z=(V=(G=qe.actions)==null?void 0:G.detailedStats)==null?void 0:V.cardsPlayed)==null?void 0:z.aiFromHand)||0,aiFromEffect:((A=(k=(U=qe.actions)==null?void 0:U.detailedStats)==null?void 0:k.cardsPlayed)==null?void 0:A.aiFromEffect)||0,playerFaceUp:((q=($=(I=qe.actions)==null?void 0:I.detailedStats)==null?void 0:$.cardsPlayed)==null?void 0:q.playerFaceUp)||0,playerFaceDown:((W=(B=(M=qe.actions)==null?void 0:M.detailedStats)==null?void 0:B.cardsPlayed)==null?void 0:W.playerFaceDown)||0,aiFaceUp:((Q=(D=(K=qe.actions)==null?void 0:K.detailedStats)==null?void 0:D.cardsPlayed)==null?void 0:Q.aiFaceUp)||0,aiFaceDown:((Z=(Y=(ae=qe.actions)==null?void 0:ae.detailedStats)==null?void 0:Y.cardsPlayed)==null?void 0:Z.aiFaceDown)||0},cardsDrawn:{total:((ee=(re=(ue=qe.actions)==null?void 0:ue.detailedStats)==null?void 0:re.cardsDrawn)==null?void 0:ee.total)||0,player:((J=(le=(X=qe.actions)==null?void 0:X.detailedStats)==null?void 0:le.cardsDrawn)==null?void 0:J.player)||0,ai:((Se=(ve=(me=qe.actions)==null?void 0:me.detailedStats)==null?void 0:ve.cardsDrawn)==null?void 0:Se.ai)||0,playerFromRefresh:((lt=(Ee=(Le=qe.actions)==null?void 0:Le.detailedStats)==null?void 0:Ee.cardsDrawn)==null?void 0:lt.playerFromRefresh)||0,playerFromEffect:((nt=(Je=(et=qe.actions)==null?void 0:et.detailedStats)==null?void 0:Je.cardsDrawn)==null?void 0:nt.playerFromEffect)||0,aiFromRefresh:((Ve=(Fe=(je=qe.actions)==null?void 0:je.detailedStats)==null?void 0:Fe.cardsDrawn)==null?void 0:Ve.aiFromRefresh)||0,aiFromEffect:((tt=(Rt=(Oe=qe.actions)==null?void 0:Oe.detailedStats)==null?void 0:Rt.cardsDrawn)==null?void 0:tt.aiFromEffect)||0},discards:{total:((En=(Zt=(It=qe.actions)==null?void 0:It.detailedStats)==null?void 0:Zt.discards)==null?void 0:En.total)||0,player:((Ea=(fa=(On=qe.actions)==null?void 0:On.detailedStats)==null?void 0:fa.discards)==null?void 0:Ea.player)||0,ai:((Kt=(Ft=(yn=qe.actions)==null?void 0:yn.detailedStats)==null?void 0:Ft.discards)==null?void 0:Kt.ai)||0},deletes:{total:((ja=(ha=(Ut=qe.actions)==null?void 0:Ut.detailedStats)==null?void 0:ha.deletes)==null?void 0:ja.total)||0,player:((dn=(Jt=(aa=qe.actions)==null?void 0:aa.detailedStats)==null?void 0:Jt.deletes)==null?void 0:dn.player)||0,ai:((Hn=(fn=(Mn=qe.actions)==null?void 0:Mn.detailedStats)==null?void 0:fn.deletes)==null?void 0:Hn.ai)||0},flips:{total:((oa=(ka=(jn=qe.actions)==null?void 0:jn.detailedStats)==null?void 0:ka.flips)==null?void 0:oa.total)||0,player:((Na=(Nn=(kn=qe.actions)==null?void 0:kn.detailedStats)==null?void 0:Nn.flips)==null?void 0:Na.player)||0,ai:((ga=(ya=(ma=qe.actions)==null?void 0:ma.detailedStats)==null?void 0:ya.flips)==null?void 0:ga.ai)||0},shifts:{total:((fe=(ra=(zn=qe.actions)==null?void 0:zn.detailedStats)==null?void 0:ra.shifts)==null?void 0:fe.total)||0,player:((Ae=(De=(ke=qe.actions)==null?void 0:ke.detailedStats)==null?void 0:De.shifts)==null?void 0:Ae.player)||0,ai:((We=(He=(Te=qe.actions)==null?void 0:Te.detailedStats)==null?void 0:He.shifts)==null?void 0:We.ai)||0},returns:{total:((pt=(Me=(at=qe.actions)==null?void 0:at.detailedStats)==null?void 0:Me.returns)==null?void 0:pt.total)||0,player:((zt=(la=(Pt=qe.actions)==null?void 0:Pt.detailedStats)==null?void 0:la.returns)==null?void 0:zt.player)||0,ai:((Vn=(sa=(xt=qe.actions)==null?void 0:xt.detailedStats)==null?void 0:sa.returns)==null?void 0:Vn.ai)||0},compiles:{total:((xe=(Ja=(Tt=qe.actions)==null?void 0:Tt.detailedStats)==null?void 0:Ja.compiles)==null?void 0:xe.total)||0,player:((ft=(Ue=(be=qe.actions)==null?void 0:be.detailedStats)==null?void 0:Ue.compiles)==null?void 0:ft.player)||0,ai:((Ra=(un=(Vt=qe.actions)==null?void 0:Vt.detailedStats)==null?void 0:un.compiles)==null?void 0:Ra.ai)||0,playerFirstCompile:((nn=(hn=(tn=qe.actions)==null?void 0:tn.detailedStats)==null?void 0:hn.compiles)==null?void 0:nn.playerFirstCompile)||0,playerRecompile:((Jr=($o=(qt=qe.actions)==null?void 0:qt.detailedStats)==null?void 0:$o.compiles)==null?void 0:Jr.playerRecompile)||0,aiFirstCompile:((Ta=(Lo=(Qt=qe.actions)==null?void 0:Qt.detailedStats)==null?void 0:Lo.compiles)==null?void 0:Ta.aiFirstCompile)||0,aiRecompile:((eo=(an=(ir=qe.actions)==null?void 0:ir.detailedStats)==null?void 0:an.compiles)==null?void 0:eo.aiRecompile)||0},refreshes:{total:((At=(ca=(Io=qe.actions)==null?void 0:Io.detailedStats)==null?void 0:ca.refreshes)==null?void 0:At.total)||0,player:((Da=(Aa=(dr=qe.actions)==null?void 0:dr.detailedStats)==null?void 0:Aa.refreshes)==null?void 0:Da.player)||0,ai:((tl=(el=(Jl=qe.actions)==null?void 0:Jl.detailedStats)==null?void 0:el.refreshes)==null?void 0:tl.ai)||0,playerCardsDrawn:((ts=(es=(ur=qe.actions)==null?void 0:ur.detailedStats)==null?void 0:es.refreshes)==null?void 0:ts.playerCardsDrawn)||0,aiCardsDrawn:((pr=(Bn=(Uo=qe.actions)==null?void 0:Uo.detailedStats)==null?void 0:Bn.refreshes)==null?void 0:pr.aiCardsDrawn)||0}}}};return(!((fr=qe.control)!=null&&fr.playerRearranges)||!qe.coinFlip||!((Fa=qe.actions)!=null&&Fa.totalCompiles)||!((qa=qe.actions)!=null&&qa.detailedStats)||Object.keys(va).length!==Object.keys(qe.protocols||{}).length)&&Yr(Yn),Yn}catch(Po){return console.error("Failed to load statistics:",Po),fm()}}function Yr(a){try{localStorage.setItem(au,JSON.stringify(a))}catch(t){console.error("Failed to save statistics:",t)}}function ob(){try{localStorage.removeItem(au)}catch(a){console.error("Failed to reset statistics:",a)}}function rb(a,t,l,i,c,d=!1,f,u,p,m){const y=t==="player",v={...a.global},x={...a.protocols},w={easy:{...a.aiDifficulty.easy},normal:{...a.aiDifficulty.normal},hard:{...a.aiDifficulty.hard}},S={...a.control},E={...a.actions},b={...a.coinFlip},j={played:{...a.cards.played},deleted:{...a.cards.deleted}};v.totalGamesPlayed++,y?v.totalGamesWon++:v.totalGamesLost++,v.totalPlaytime+=c,y&&(v.fastestWin===null||c<v.fastestWin)&&(v.fastestWin=c),(v.longestGame===null||c>v.longestGame)&&(v.longestGame=c),v.lastGameDuration=c,y?(v.currentStreak>=0?v.currentStreak++:v.currentStreak=1,v.currentStreak>v.longestWinStreak&&(v.longestWinStreak=v.currentStreak)):(v.currentStreak<=0?v.currentStreak--:v.currentStreak=-1,Math.abs(v.currentStreak)>v.longestLoseStreak&&(v.longestLoseStreak=Math.abs(v.currentStreak))),l.forEach(R=>{x[R]?x[R]={...x[R]}:x[R]={timesUsed:0,wins:0,losses:0},x[R].timesUsed++,y?x[R].wins++:x[R].losses++}),w[i].played++,y?w[i].wins++:w[i].losses++,d?S.gamesWithControl++:S.gamesWithoutControl++;const C={cardsPlayed:{...a.actions.detailedStats.cardsPlayed},cardsDrawn:{...a.actions.detailedStats.cardsDrawn},discards:{...a.actions.detailedStats.discards},deletes:{...a.actions.detailedStats.deletes},flips:{...a.actions.detailedStats.flips},shifts:{...a.actions.detailedStats.shifts},returns:{...a.actions.detailedStats.returns},compiles:{...a.actions.detailedStats.compiles},refreshes:{...a.actions.detailedStats.refreshes}};return f&&(E.totalCardsPlayed+=f.cardsPlayed,E.totalCardsDrawn+=f.cardsDrawn,E.totalDiscards+=f.cardsDiscarded,E.totalDeletes+=f.cardsDeleted,E.totalFlips+=f.cardsFlipped,E.totalShifts+=f.cardsShifted,E.totalRefreshes+=f.handsRefreshed,E.totalReturns+=f.cardsReturned||0,C.cardsPlayed.total+=f.cardsPlayed,C.cardsPlayed.player+=f.cardsPlayed,C.cardsDrawn.total+=f.cardsDrawn,C.cardsDrawn.player+=f.cardsDrawn,C.discards.total+=f.cardsDiscarded,C.discards.player+=f.cardsDiscarded,C.deletes.total+=f.cardsDeleted,C.deletes.player+=f.cardsDeleted,C.flips.total+=f.cardsFlipped,C.flips.player+=f.cardsFlipped,C.shifts.total+=f.cardsShifted,C.shifts.player+=f.cardsShifted,C.returns.total+=f.cardsReturned||0,C.returns.player+=f.cardsReturned||0,C.refreshes.total+=f.handsRefreshed,C.refreshes.player+=f.handsRefreshed),p&&(E.totalCardsPlayed+=p.cardsPlayed,E.totalCardsDrawn+=p.cardsDrawn,E.totalDiscards+=p.cardsDiscarded,E.totalDeletes+=p.cardsDeleted,E.totalFlips+=p.cardsFlipped,E.totalShifts+=p.cardsShifted,E.totalRefreshes+=p.handsRefreshed,E.totalReturns+=p.cardsReturned||0,C.cardsPlayed.total+=p.cardsPlayed,C.cardsPlayed.ai+=p.cardsPlayed,C.cardsDrawn.total+=p.cardsDrawn,C.cardsDrawn.ai+=p.cardsDrawn,C.discards.total+=p.cardsDiscarded,C.discards.ai+=p.cardsDiscarded,C.deletes.total+=p.cardsDeleted,C.deletes.ai+=p.cardsDeleted,C.flips.total+=p.cardsFlipped,C.flips.ai+=p.cardsFlipped,C.shifts.total+=p.cardsShifted,C.shifts.ai+=p.cardsShifted,C.returns.total+=p.cardsReturned||0,C.returns.ai+=p.cardsReturned||0,C.refreshes.total+=p.handsRefreshed,C.refreshes.ai+=p.handsRefreshed),m&&(m.cardsPlayed&&(C.cardsPlayed.playerFromHand+=m.cardsPlayed.playerFromHand,C.cardsPlayed.playerFromEffect+=m.cardsPlayed.playerFromEffect,C.cardsPlayed.aiFromHand+=m.cardsPlayed.aiFromHand,C.cardsPlayed.aiFromEffect+=m.cardsPlayed.aiFromEffect,C.cardsPlayed.playerFaceUp+=m.cardsPlayed.playerFaceUp,C.cardsPlayed.playerFaceDown+=m.cardsPlayed.playerFaceDown,C.cardsPlayed.aiFaceUp+=m.cardsPlayed.aiFaceUp,C.cardsPlayed.aiFaceDown+=m.cardsPlayed.aiFaceDown),m.cardsDrawn&&(C.cardsDrawn.playerFromRefresh+=m.cardsDrawn.playerFromRefresh,C.cardsDrawn.playerFromEffect+=m.cardsDrawn.playerFromEffect,C.cardsDrawn.aiFromRefresh+=m.cardsDrawn.aiFromRefresh,C.cardsDrawn.aiFromEffect+=m.cardsDrawn.aiFromEffect),m.compiles&&(C.compiles.playerFirstCompile+=m.compiles.playerFirstCompile,C.compiles.playerRecompile+=m.compiles.playerRecompile,C.compiles.aiFirstCompile+=m.compiles.aiFirstCompile,C.compiles.aiRecompile+=m.compiles.aiRecompile,C.compiles.player+=m.compiles.playerFirstCompile+m.compiles.playerRecompile,C.compiles.ai+=m.compiles.aiFirstCompile+m.compiles.aiRecompile,C.compiles.total+=m.compiles.playerFirstCompile+m.compiles.playerRecompile+m.compiles.aiFirstCompile+m.compiles.aiRecompile),m.refreshes&&(C.refreshes.playerCardsDrawn+=m.refreshes.playerCardsDrawn,C.refreshes.aiCardsDrawn+=m.refreshes.aiCardsDrawn)),u!==void 0&&(E.totalCompiles+=u),E.detailedStats=C,{version:a.version,global:v,protocols:x,aiDifficulty:w,cards:j,actions:E,control:S,coinFlip:b}}function lb(a,t){const l={...a,cards:{...a.cards,played:{...a.cards.played}}};return l.cards.played[t]||(l.cards.played[t]=0),l.cards.played[t]++,l}function sb(a,t){const l={...a,cards:{...a.cards,deleted:{...a.cards.deleted}}};return l.cards.deleted[t]||(l.cards.deleted[t]=0),l.cards.deleted[t]++,l}function cb(a,t){const l={...a,control:{...a.control}};return t==="player"?l.control.playerRearranges++:l.control.aiRearranges++,l.control.totalRearranges++,l}function ib(a,t,l){const i={...a,coinFlip:{...a.coinFlip}};return t==="heads"?(i.coinFlip.headsChosen++,l&&i.coinFlip.headsWon++):(i.coinFlip.tailsChosen++,l&&i.coinFlip.tailsWon++),i}function db(a){return a.global.totalGamesPlayed===0?0:a.global.totalGamesWon/a.global.totalGamesPlayed*100}function ub(a){return a.global.totalGamesPlayed===0?0:Math.floor(a.global.totalPlaytime/a.global.totalGamesPlayed)}function pb(a){return Object.entries(a.protocols).map(([l,i])=>({protocol:l,timesUsed:i.timesUsed,winRate:i.timesUsed>0?i.wins/i.timesUsed*100:0})).sort((l,i)=>i.timesUsed-l.timesUsed).slice(0,5)}function fb(a){return Object.entries(a.protocols).filter(([l,i])=>i.timesUsed>=3).map(([l,i])=>({protocol:l,timesUsed:i.timesUsed,winRate:i.wins/i.timesUsed*100})).sort((l,i)=>i.winRate-l.winRate).slice(0,5)}function hb(a){return Object.entries(a.protocols).map(([l,i])=>({protocol:l,timesUsed:i.timesUsed,winRate:i.timesUsed>0?i.wins/i.timesUsed*100:0})).sort((l,i)=>l.timesUsed-i.timesUsed).slice(0,5)}function mb(a){return Object.entries(a.cards.played).map(([l,i])=>({card:l,count:i})).sort((l,i)=>i.count-l.count).slice(0,5)}function yb(a){return Object.entries(a.cards.deleted).map(([l,i])=>({card:l,count:i})).sort((l,i)=>i.count-l.count).slice(0,5)}function Bl(a){const t=Math.floor(a/3600),l=Math.floor(a%3600/60),i=a%60;return t>0?`${t}h ${l}m`:l>0?`${l}m ${i}s`:`${i}s`}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function gb(a,t,l){const[i,c]=se.useState(()=>Vd()),d=se.useRef(null),f=se.useCallback(()=>{d.current=Date.now()},[]),u=se.useCallback((x,w)=>{c(S=>{const E=`${x}-${w}`,b=lb(S,E);return Yr(b),b})},[]),p=se.useCallback((x,w)=>{c(S=>{const E=`${x}-${w}`,b=sb(S,E);return Yr(b),b})},[]),m=se.useCallback((x,w)=>{c(S=>{const E=ib(S,x,w);return Yr(E),E})},[]),y=se.useCallback(x=>{c(w=>{const S=cb(w,x);return Yr(S),S})},[]),v=se.useCallback((x,w,S,E,b)=>{if(d.current===null)return;const j=Math.floor((Date.now()-d.current)/1e3);c(C=>{const R=rb(C,x,a,t,j,l,w,S,E,b);return Yr(R),R}),d.current=null},[a,t,l]);return{statistics:i,startGame:f,endGame:v,trackPlayerCardPlayed:u,trackPlayerCardDeleted:p,trackPlayerCoinFlip:m,trackPlayerRearrange:y}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function _(a,t,l=!0){const c=qo().find(d=>d.protocol===a&&d.value===t);return c?{id:Ze(),protocol:c.protocol,value:c.value,top:c.top,middle:c.middle,bottom:c.bottom,keywords:c.keywords,isFaceUp:l,isRevealed:!1,category:c.category||"Main",...c.customEffects&&{customEffects:c.customEffects}}:(console.warn(`Card not found: ${a}-${t}`),{id:Ze(),protocol:a,value:t,top:"",middle:"",bottom:"",keywords:{},isFaceUp:l,isRevealed:!1,category:"Main"})}function P(a,t,l,i){const c={...a},d={...c[t]},f=[...d.lanes];return f[l]=[...f[l],i],d.lanes=f,c[t]=d,c}function hm(a,t){const l=[],i=qo();for(const c of a){const d=i.filter(f=>f.protocol===c);for(const f of d)t.some(p=>p.protocol===f.protocol&&p.value===f.value)||l.push(_(f.protocol,f.value,!0))}return l}function Ne(a,t,l,i,c){return{...a,player:{...a.player,protocols:t,lanes:[[],[],[]],hand:[]},opponent:{...a.opponent,protocols:l,lanes:[[],[],[]],hand:[]},turn:i,phase:c,actionRequired:null,queuedActions:[],_interruptedTurn:void 0,_interruptedPhase:void 0,processedStartEffectIds:[],processedEndEffectIds:[],processedUncoverEventIds:[]}}function Re(a){const t=[...a.player.hand,...a.player.lanes.flat()],l=[...a.opponent.hand,...a.opponent.lanes.flat()],i=hm(a.player.protocols,t),c=hm(a.opponent.protocols,l),d=a.turn==="player"?"Player":"Opponent",f=[{player:"player",message:`Player protocols: ${a.player.protocols.join(", ")}`},{player:"opponent",message:`Opponent protocols: ${a.opponent.protocols.join(", ")}`},{player:a.turn,message:`${d} goes first.`},{player:"player",message:"---"},{player:a.turn,message:`[Test Scenario] Phase: ${a.phase}`}];return{...a,player:{...a.player,deck:i,discard:[],compiled:[!1,!1,!1]},opponent:{...a.opponent,deck:c,discard:[],compiled:[!1,!1,!1]},log:f}}const py={name:"Psychic-3 Uncover whrend Opponent's Turn",description:"Player lscht Opponent's face-down card  Psychic-3 uncovered  Player discardet, Opponent shiftet",setup:a=>{let t=Ne(a,["Hate","Fire","Water"],["Psychic","Death","Spirit"],"player","action");return t.player.hand=[_("Hate",0,!0),_("Fire",1,!0),_("Water",1,!0)],t=P(t,"opponent",1,_("Psychic",3,!0)),t=P(t,"opponent",1,_("Fire",1,!1)),t=Ce(t),Re(t)}},fy={name:"Psychic-4 End Effect mit Uncover-Interrupt",description:"Psychic-4 returnt Fire-2  Fire-4 uncovered  Interrupt  Psychic-4 flip aus Queue",setup:a=>{let t=Ne(a,["Fire","Water","Spirit"],["Psychic","Death","Metal"],"opponent","end");return t=P(t,"opponent",0,_("Psychic",4,!0)),t=P(t,"player",1,_("Fire",4,!0)),t=P(t,"player",1,_("Fire",2,!0)),t.opponent.hand=[_("Water",1),_("Water",2)],t=Ce(t),Re(t)}},hy={name:"Spirit-3 Draw whrend End Phase",description:"Spirit-3 draw in End Phase  Shift-prompt in Queue  Player kann lanes klicken",setup:a=>{let t=Ne(a,["Spirit","Fire","Water"],["Death","Metal","Psychic"],"player","action");t=P(t,"player",0,_("Spirit",3,!0));const l=qo(),i=l.find(f=>f.protocol==="Fire"&&f.value===1),c=l.find(f=>f.protocol==="Water"&&f.value===1),d=l.find(f=>f.protocol==="Spirit"&&f.value===1);return t.player.deck=[i,c,d],t=Ce(t),Re(t)}},my={name:"Plague-2 Actor Propagation",description:"Player spielt Plague-2  Player discardet  Opponent discardet (actor korrekt)",setup:a=>{let t=Ne(a,["Plague","Death","Hate"],["Fire","Water","Spirit"],"player","action");return t.player.hand=[_("Plague",2,!0),_("Fire",1),_("Water",1),_("Spirit",1)],t.opponent.hand=[_("Fire",2),_("Water",2),_("Spirit",2),_("Death",2)],t=Ce(t),Re(t)}},yy={name:"Darkness-1 Flip + Shift mit Interrupt",description:"Darkness-1 flippt Fire-0  Delete-Interrupt  Player shiftet",setup:a=>{let t=Ne(a,["Darkness","Fire","Water"],["Spirit","Death","Metal"],"player","action");return t.player.hand=[_("Darkness",1,!0)],t=P(t,"opponent",0,_("Fire",0,!1)),t=Ce(t),Re(t)}},gy={name:"Plague-4 Owner vs Turn Check",description:"Plague-4 End  Player deletet  Opponent (owner) wird fr flip gefragt",setup:a=>{let t=Ne(a,["Fire","Water","Spirit"],["Plague","Death","Metal"],"opponent","end");return t=P(t,"opponent",0,_("Plague",4,!0)),t=P(t,"player",1,_("Water",2,!1)),t=Ce(t),Re(t)}},vy={name:"Water Owner vs Turn Check",description:"Plague-4 End  Player deletet  Opponent (owner) wird fr flip gefragt",setup:a=>{let t=Ne(a,["Fire","Water","Spirit"],["Plague","Death","Metal"],"player","action");return t=P(t,"opponent",0,_("Plague",4,!0)),t=P(t,"player",2,_("Water",4,!1)),t.player.hand=[_("Water",0,!0),_("Fire",1),_("Water",1),_("Spirit",1)],t.opponent.hand=[_("Fire",2),_("Water",2),_("Spirit",2),_("Death",2)],t=Ce(t),Re(t)}},_y={name:"Hate-1 Multi-Delete mit Uncover-Interrupt",description:"Hate-1 lscht Plague-0  Plague-5 uncovered  Interrupt  Player macht 2. Delete",setup:a=>{let t=Ne(a,["Fire","Hate","Water"],["Plague","Death","Metal"],"player","action");return t.player.hand=[_("Hate",1,!0),_("Psychic",2,!0),_("Psychic",4,!0),_("Hate",4,!0),_("Water",1,!0)],t=P(t,"opponent",0,_("Plague",2,!0)),t=P(t,"opponent",0,_("Plague",0,!0)),t.opponent.hand=[_("Fire",2,!0),_("Water",2,!0),_("Spirit",2,!0),_("Death",2,!0),_("Metal",2,!0)],t=Ce(t),Re(t)}},xy={name:"Darkness-1  Hate-0 Flip  Multi-Effect Chain",description:" Darkness-1 flippt Hate-0  Delete-Interrupt  Draw-Interrupt  Shift aus Queue",setup:a=>{let t=Ne(a,["Darkness","Fire","Water"],["Hate","Death","Metal"],"player","action");t.player.hand=[_("Darkness",1,!0)],t=P(t,"opponent",0,_("Hate",0,!1)),t=P(t,"opponent",1,_("Hate",3,!0)),t=P(t,"opponent",2,_("Fire",1,!1)),t=P(t,"player",1,_("Water",2,!0)),t.opponent.hand=[_("Death",2),_("Metal",3)];const i=qo().find(c=>c.protocol==="Death"&&c.value===1);return t.opponent.deck=[i],t=Ce(t),Re(t)}},wy={name:"Water-4 Return  Turn End",description:" Water-4 returnt Karte  Turn endet (Bug-Fix: Opponent spielt nicht zweimal)",setup:a=>{let t=Ne(a,["Hate","Spirit","Light"],["Fire","Water","Death"],"opponent","action");return t.opponent.hand=[_("Water",4,!0)],t=P(t,"opponent",0,_("Life",4,!0)),t=P(t,"opponent",2,_("Death",4,!1)),t=P(t,"player",1,_("Spirit",1,!0)),t=P(t,"player",2,_("Light",5,!1)),t.player.hand=[_("Fire",1),_("Spirit",2),_("Hate",4)],t=Ce(t),Re(t)}},Cy={name:"Psychic-3 Discard + Shift",description:" Psychic-3 On-Play  Player discardet  AI shiftet (Bug-Fix: AI kann shiften)",setup:a=>{let t=Ne(a,["Fire","Water","Spirit"],["Psychic","Death","Metal"],"opponent","action");return t.opponent.hand=[_("Psychic",3,!0)],t.player.hand=[_("Fire",1),_("Water",2),_("Spirit",1)],t=P(t,"player",0,_("Fire",2,!0)),t=P(t,"player",1,_("Water",3,!0)),t=P(t,"player",2,_("Spirit",4,!0)),t=Ce(t),Re(t)}},Sy={name:"Death-1 Delete  Speed-3 Uncover",description:" Death-1 lscht Light-0  Speed-3 uncovered  Player shiftet (Bug-Fix Test)",setup:a=>{let t=Ne(a,["Speed","Light","Water"],["Death","Fire","Metal"],"opponent","start");return t=P(t,"player",0,_("Speed",3,!0)),t=P(t,"player",0,_("Light",0,!0)),t=P(t,"player",1,_("Water",1,!0)),t=P(t,"opponent",0,_("Death",1,!0)),t.player.hand=[],t.opponent.hand=[],t=Ce(t),Re(t)}},by={name:"Gravity-2 Flip  Metal-5 Discard  Shift",description:" Gravity-2 flippt Metal-5  Discard Interrupt  shiften (Bug-Fix: AI stuck)",setup:a=>{let t=Ne(a,["Fire","Water","Light"],["Gravity","Metal","Fire"],"opponent","action");return t.opponent.hand=[_("Gravity",2,!0),_("Fire",1)],t=P(t,"opponent",1,_("Metal",5,!1)),t=P(t,"player",0,_("Fire",2,!0)),t=P(t,"player",2,_("Light",3,!0)),t.player.hand=[_("Water",1),_("Fire",3)],t=Ce(t),Re(t)}},Ey={name:"Hate-2 Player spielt (Einfach)",description:" Player spielt Hate-2  Whlt eigene & Gegners hchste Karte",setup:a=>{let t=Ne(a,["Hate","Water","Light"],["Metal","Death","Gravity"],"player","action");return t.player.hand=[_("Hate",2,!0)],t=P(t,"player",0,_("Fire",4,!0)),t=P(t,"player",1,_("Water",2,!0)),t=P(t,"player",2,_("Light",5,!0)),t=P(t,"opponent",0,_("Metal",3,!0)),t=P(t,"opponent",1,_("Death",5,!0)),t=P(t,"opponent",2,_("Gravity",2,!1)),t=Ce(t),Re(t)}},jy={name:"Hate-2 AI spielt (Normal)",description:" AI spielt Hate-2  AI whlt eigene & Players hchste automatisch",setup:a=>{let t=Ne(a,["Water","Spirit","Light"],["Hate","Metal","Death"],"opponent","action");return t.opponent.hand=[_("Hate",2,!0)],t=P(t,"opponent",0,_("Fire",5,!0)),t=P(t,"opponent",1,_("Metal",3,!0)),t=P(t,"opponent",2,_("Death",2,!1)),t=P(t,"player",0,_("Water",4,!0)),t=P(t,"player",1,_("Spirit",5,!0)),t=P(t,"player",2,_("Light",2,!0)),t=Ce(t),Re(t)}},ky={name:"Hate-2 AI spielt (Normal) mit Auswahl",description:" AI spielt Hate-2  AI whlt eigene & Players hchste automatisch",setup:a=>{let t=Ne(a,["Water","Spirit","Light"],["Hate","Metal","Death"],"opponent","action");return t.opponent.hand=[_("Hate",2,!0)],t=P(t,"opponent",0,_("Fire",5,!0)),t=P(t,"opponent",1,_("Metal",3,!0)),t=P(t,"opponent",2,_("Death",2,!1)),t=P(t,"player",0,_("Water",4,!0)),t=P(t,"player",1,_("Spirit",5,!0)),t=P(t,"player",2,_("Light",5,!0)),t=Ce(t),Re(t)}},Ny={name:"Hate-2 Selbst-Lschung",description:" Hate-2 lscht sich selbst  Zweite Klausel entfllt (Regelwerk-Check)",setup:a=>{let t=Ne(a,["Hate","Fire","Water"],["Metal","Death","Gravity"],"player","action");return t.player.hand=[_("Hate",2,!0)],t=P(t,"player",1,_("Fire",1,!0)),t=P(t,"player",2,_("Water",0,!0)),t=P(t,"opponent",0,_("Metal",3,!0)),t=P(t,"opponent",1,_("Death",5,!0)),t=Ce(t),Re(t)}},Ry={name:"Hate-2 Gleichstand (Auswahl)",description:" Hate-2 mit mehreren hchsten  Player muss whlen (Tied values)",setup:a=>{let t=Ne(a,["Hate","Water","Spirit"],["Metal","Death","Gravity"],"player","action");return t.player.hand=[_("Hate",2,!0)],t=P(t,"player",0,_("Fire",4,!0)),t=P(t,"player",1,_("Water",4,!0)),t=P(t,"player",2,_("Spirit",4,!0)),t=P(t,"opponent",0,_("Metal",5,!0)),t=P(t,"opponent",1,_("Death",5,!0)),t=P(t,"opponent",2,_("Gravity",2,!1)),t=Ce(t),Re(t)}},Ty={name:"Hate-2 Face-Down Karten",description:" Hate-2 mit face-down  Alle face-down sind value 2 (Tied mit Hate-2)",setup:a=>{let t=Ne(a,["Hate","Fire","Water"],["Metal","Death","Gravity"],"player","action");return t.player.hand=[_("Hate",2,!0)],t=P(t,"player",1,_("Fire",5,!1)),t=P(t,"player",2,_("Water",5,!1)),t=P(t,"opponent",0,_("Metal",5,!0)),t=P(t,"opponent",1,_("Death",4,!1)),t=P(t,"opponent",2,_("Gravity",1,!0)),t=Ce(t),Re(t)}},Ay={name:"Hate-2 AI Play-Validation",description:" AI spielt Hate-2 NICHT face-up wenn es sich selbst lschen wrde",setup:a=>{let t=Ne(a,["Fire","Water","Spirit"],["Hate","Death","Metal"],"opponent","action");return t.opponent.hand=[_("Hate",2,!0)],t=P(t,"opponent",1,_("Fire",0,!0)),t=P(t,"opponent",2,_("Water",1,!0)),t=P(t,"player",0,_("Fire",5,!0)),t=P(t,"player",1,_("Water",4,!0)),t=Ce(t),Re(t)}},Dy={name:"Hate-2 AI spielt OFFEN (Optimal)",description:" AI spielt Hate-2 offen weil nicht hchste Karte",setup:a=>{let t=Ne(a,["Water","Spirit","Light"],["Hate","Metal","Death"],"opponent","action");return t.opponent.hand=[_("Hate",2,!0)],t=P(t,"opponent",0,_("Fire",5,!0)),t=P(t,"opponent",1,_("Metal",4,!0)),t=P(t,"opponent",2,_("Death",3,!0)),t=P(t,"player",0,_("Water",2,!0)),t=P(t,"player",1,_("Spirit",5,!0)),t=P(t,"player",2,_("Light",1,!0)),t=Ce(t),Re(t)}},vb={name:"Chaos-3 Protocol-Free Playing",description:"Player with Chaos-3 can play any card face-up in any lane",setup:a=>{let t=Ne(a,["Chaos","Fire","Water"],["Spirit","Death","Metal"],"player","action");return t=P(t,"player",0,_("Chaos",3,!0)),t.player.hand=[_("Gravity",2,!0),_("Hate",3,!0),_("Love",1,!0)],t=Ce(t),Re(t)}},_b={name:"Frost-3 Blocks Shifts (Covered)",description:"Frost-3 should prevent shifts even when covered (Top-Box effect always active)",setup:a=>{let t=Ne(a,["Gravity","Water","Fire"],["Frost","Metal","Death"],"player","action");return t=P(t,"opponent",0,_("Frost",3,!0)),t=P(t,"opponent",0,_("Metal",2,!1)),t=P(t,"player",1,_("Water",2,!0)),t.player.hand=[_("Gravity",1,!0),_("Fire",2,!0)],t=Ce(t),Re(t)}},xb={name:"Water-0 Softlock Bug Fix",description:"Water-0 self-flip should be cancelled when card becomes covered before self-flip executes",setup:a=>{let t=Ne(a,["Water","Darkness","Light"],["Apathy","Fire","Death"],"player","action");return t=P(t,"player",1,_("Darkness",3,!1)),t.player.hand=[_("Water",0,!0),_("Darkness",2,!0),_("Fire",1,!0)],t=Ce(t),Re(t)}},wb={name:"Darkness-1 Flip and Shift Chain",description:"Darkness-1 should flip opponent card, then allow shifting that same card",setup:a=>{let t=Ne(a,["Darkness","Water","Fire"],["Metal","Fire","Death"],"player","action");return t=P(t,"opponent",0,_("Metal",2,!1)),t=P(t,"opponent",1,_("Fire",1,!0)),t=P(t,"opponent",2,_("Hate",0,!1)),t.player.hand=[_("Darkness",1,!0),_("Water",2,!0),_("Fire",3,!0)],t=Ce(t),Re(t)}},Cb={name:"Darkness-1 Flips Speed-3 - Middle Effect Execution",description:"When Darkness-1 flips Speed-3, Speed-3's middle effect (shift) should execute before Darkness-1's shift",setup:a=>{let t=Ne(a,["Darkness","Water","Fire"],["Speed","Fire","Metal"],"player","action");return t=P(t,"opponent",0,_("Speed",3,!1)),t=P(t,"opponent",1,_("Fire",1,!0)),t=P(t,"opponent",2,_("Metal",2,!0)),t.player.hand=[_("Darkness",1,!0),_("Water",2,!0),_("Fire",3,!0)],t=Ce(t),Re(t)}},Sb={name:"Darkness-1 Flips Speed-3 - Middle Effect Execution",description:"When Darkness-1 flips Speed-3, Speed-3's middle effect (shift) should execute before Darkness-1's shift",setup:a=>{let t=Ne(a,["Darkness","Water","Fire"],["Speed","Fire","Metal"],"player","action");return t=P(t,"opponent",0,_("Speed",3,!1)),t=P(t,"opponent",1,_("Fire",1,!0)),t=P(t,"opponent",2,_("Metal",2,!0)),t.player.hand=[_("Darkness",1,!0),_("Water",2,!0),_("Fire",3,!0)],t=Ce(t),Re(t)}},Fy={name:"Fire-1 & Fire-2 Conditional Test",description:" Fire-1 (discard -> delete) & Fire-2 (discard -> return) if_executed logic",setup:a=>{let t=Ne(a,["Fire","Water","Spirit"],["Metal","Death","Fire"],"player","action");return t.player.hand=[_("Fire",1,!0),_("Fire",2,!0),_("Fire",0,!0),_("Fire",3,!0),_("Fire",4,!0),_("Fire",5,!0)],t=P(t,"opponent",0,_("Metal",3,!0)),t=P(t,"opponent",1,_("Death",4,!0)),t=P(t,"opponent",2,_("Fire",2,!0)),t=P(t,"opponent",0,_("Metal",1,!0)),t=P(t,"player",2,_("Spirit",3,!0)),t=P(t,"player",1,_("Water",3,!0)),t=P(t,"player",2,_("Spirit",2,!0)),t=Ce(t),Re(t)}},qy={name:"Anarchy Test Playground",description:" All Anarchy cards on hand for testing",setup:a=>{let t=Ne(a,["Anarchy","Water","Spirit"],["Metal","Death","Fire"],"player","action");return t.player.hand=[_("Anarchy",0,!0),_("Anarchy",1,!0),_("Anarchy",2,!0),_("Anarchy",3,!0),_("Anarchy",5,!0),_("Anarchy",6,!0)],t=P(t,"opponent",0,_("Metal",3,!0)),t=P(t,"opponent",1,_("Death",4,!1)),t=P(t,"opponent",2,_("Fire",2,!0)),t=P(t,"opponent",0,_("Metal",1,!0)),t=P(t,"player",2,_("Spirit",3,!0)),t=P(t,"player",1,_("Water",3,!0)),t=P(t,"player",2,_("Spirit",2,!0)),t=Ce(t),Re(t)}},$y={name:"Darkness Test Playground",description:" All Darkness cards on hand for testing",setup:a=>{let t=Ne(a,["Darkness","Water","Spirit"],["Metal","Death","Fire"],"player","action");return t.player.hand=[_("Darkness",0,!0),_("Darkness",1,!0),_("Darkness",2,!0),_("Darkness",3,!0),_("Darkness",4,!0),_("Darkness",5,!0)],t=P(t,"opponent",0,_("Metal",3,!1)),t=P(t,"opponent",1,_("Death",4,!0)),t=P(t,"opponent",2,_("Fire",2,!1)),t=P(t,"opponent",0,_("Metal",1,!0)),t=P(t,"opponent",1,_("Death",2,!1)),t=P(t,"player",2,_("Spirit",3,!0)),t=P(t,"player",1,_("Water",3,!0)),t=P(t,"player",2,_("Spirit",2,!0)),t=Ce(t),Re(t)}},Ly={name:"Apathy Test Playground",description:" All Apathy cards on hand for testing",setup:a=>{let t=Ne(a,["Apathy","Water","Spirit"],["Metal","Death","Fire"],"player","action");return t.player.hand=[_("Apathy",0,!0),_("Apathy",1,!0),_("Apathy",2,!0),_("Apathy",3,!0),_("Apathy",4,!0),_("Apathy",5,!0)],t=P(t,"opponent",0,_("Metal",3,!0)),t=P(t,"opponent",1,_("Death",4,!0)),t=P(t,"opponent",2,_("Fire",2,!0)),t=P(t,"opponent",0,_("Metal",1,!0)),t=P(t,"opponent",2,_("Fire",1,!1)),t=P(t,"player",2,_("Spirit",3,!0)),t=P(t,"player",1,_("Water",3,!0)),t=P(t,"player",2,_("Spirit",2,!0)),t=Ce(t),Re(t)}},Iy={name:"Death Test Playground",description:" All Death cards on hand for testing",setup:a=>{let t=Ne(a,["Death_cust","Water","Spirit"],["Metal","Death","Fire"],"player","action");return t.player.hand=[_("Death_cust",0,!0),_("Death_cust",1,!0),_("Death_cust",2,!0),_("Death_cust",3,!0),_("Death_cust",4,!0),_("Death_cust",5,!0)],t=P(t,"opponent",0,_("Metal",0,!0)),t=P(t,"opponent",1,_("Death",1,!0)),t=P(t,"opponent",2,_("Fire",3,!0)),t=P(t,"opponent",0,_("Metal",2,!0)),t=P(t,"opponent",1,_("Death",4,!1)),t=P(t,"player",2,_("Spirit",3,!0)),t=P(t,"player",1,_("Water",3,!0)),t=P(t,"player",2,_("Spirit",2,!0)),t=Ce(t),Re(t)}},Uy={name:"Water Test Playground",description:" All Water cards on hand for testing - wash away and renew",setup:a=>{let t=Ne(a,["Water","Fire","Spirit"],["Metal","Death","Light"],"player","action");return t.player.hand=[_("Water",0,!0),_("Water",1,!0),_("Water",2,!0),_("Water",3,!0),_("Water",4,!0),_("Water",5,!0)],t=P(t,"opponent",0,_("Metal",2,!0)),t=P(t,"opponent",1,_("Death",3,!0)),t=P(t,"opponent",2,_("Light",2,!0)),t=P(t,"opponent",0,_("Metal",4,!0)),t=P(t,"opponent",1,_("Death",2,!1)),t=P(t,"opponent",2,_("Light",5,!1)),t=P(t,"player",1,_("Fire",2,!0)),t=P(t,"player",2,_("Spirit",3,!0)),t=P(t,"player",1,_("Fire",4,!0)),t=P(t,"player",2,_("Spirit",5,!1)),t=Ce(t),Re(t)}},Py={name:"Spirit Test Playground",description:" All Spirit cards on hand - true strength from within",setup:a=>{let t=Ne(a,["Spirit","Fire","Water"],["Metal","Death","Light"],"player","action");return t.player.hand=[_("Spirit",0,!0),_("Spirit",1,!0),_("Spirit",2,!0),_("Spirit",3,!0),_("Spirit",4,!0),_("Spirit",5,!0)],t=P(t,"opponent",0,_("Metal",3,!0)),t=P(t,"opponent",1,_("Death",2,!1)),t=P(t,"opponent",2,_("Light",4,!0)),t=P(t,"opponent",0,_("Metal",5,!1)),t=P(t,"opponent",2,_("Light",3,!0)),t=P(t,"player",1,_("Fire",2,!0)),t=P(t,"player",2,_("Water",4,!0)),t=P(t,"player",1,_("Fire",3,!1)),t=Ce(t),Re(t)}},Oy={name:"Chaos Test Playground",description:" All Chaos cards on hand - embrace the unpredictable",setup:a=>{let t=Ne(a,["Chaos","Fire","Water"],["Metal","Death","Light"],"player","action");return t.player.hand=[_("Chaos",0,!0),_("Chaos",1,!0),_("Chaos",2,!0),_("Chaos",3,!0),_("Chaos",4,!0),_("Chaos",5,!0)],t=P(t,"opponent",0,_("Metal",2,!0)),t=P(t,"opponent",0,_("Metal",4,!0)),t=P(t,"opponent",1,_("Death",3,!1)),t=P(t,"opponent",1,_("Death",5,!0)),t=P(t,"opponent",2,_("Light",1,!0)),t=P(t,"opponent",2,_("Light",3,!1)),t=P(t,"player",0,_("Fire",2,!0)),t=P(t,"player",0,_("Fire",4,!0)),t=P(t,"player",1,_("Water",3,!1)),t=P(t,"player",1,_("Water",5,!0)),t=P(t,"player",2,_("Fire",1,!0)),t=Ce(t),Re(t)}},My={name:"Gravity Test Playground",description:" All Gravity cards on hand - pull everything together",setup:a=>{let t=Ne(a,["Fire","Gravity","Water"],["Metal","Death","Light"],"player","action");return t.player.hand=[_("Gravity",0,!0),_("Gravity",1,!0),_("Gravity",2,!0),_("Gravity",4,!0),_("Gravity",5,!0),_("Gravity",6,!0)],t=P(t,"player",0,_("Fire",1,!0)),t=P(t,"player",2,_("Water",2,!1)),t=P(t,"opponent",0,_("Metal",3,!1)),t=P(t,"opponent",0,_("Metal",4,!0)),t=P(t,"opponent",1,_("Death",2,!1)),t=P(t,"opponent",1,_("Death",3,!0)),t=P(t,"opponent",2,_("Light",4,!1)),t.opponent.deck=[_("Metal",5,!0),_("Death",4,!0),_("Light",5,!0)],t=Ce(t),Re(t)}},Hy={name:"Frost Test Playground",description:" All Frost cards on hand - pull everything together",setup:a=>{let t=Ne(a,["Fire","Frost","Water"],["Metal","Death","Light"],"player","action");return t.player.hand=[_("Frost",0,!0),_("Frost",1,!0),_("Frost",2,!0),_("Frost",3,!0),_("Frost",4,!0),_("Frost",5,!0)],t=P(t,"player",0,_("Fire",1,!0)),t=P(t,"player",2,_("Water",2,!1)),t=P(t,"opponent",0,_("Metal",3,!1)),t=P(t,"opponent",0,_("Metal",4,!0)),t=P(t,"opponent",1,_("Death",2,!1)),t=P(t,"opponent",1,_("Death",3,!0)),t=P(t,"opponent",2,_("Light",4,!1)),t.opponent.deck=[_("Metal",5,!0),_("Death",4,!0),_("Light",5,!0)],t=Ce(t),Re(t)}},zy={name:"Hate Test Playground",description:" All Hate cards on hand - test deletion mechanics",setup:a=>{let t=Ne(a,["Hate","Water","Spirit"],["Metal","Death","Fire"],"player","action");return t.player.hand=[_("Hate",0,!0),_("Hate",1,!0),_("Hate",2,!0),_("Hate",3,!0),_("Hate",4,!0),_("Hate",5,!0)],t=P(t,"player",1,_("Water",1,!0)),t=P(t,"player",1,_("Water",2,!0)),t=P(t,"player",1,_("Water",3,!0)),t=P(t,"player",2,_("Spirit",2,!0)),t=P(t,"player",2,_("Spirit",4,!1)),t=P(t,"opponent",0,_("Metal",5,!0)),t=P(t,"opponent",1,_("Death",2,!0)),t=P(t,"opponent",1,_("Death",4,!0)),t=P(t,"opponent",2,_("Fire",3,!1)),t.player.deck=[_("Water",0,!0),_("Water",4,!0),_("Spirit",0,!0),_("Spirit",5,!0)],t.opponent.deck=[_("Metal",3,!0),_("Death",5,!0),_("Fire",1,!0)],t=Ce(t),Re(t)}},Vy={name:"Life Test Playground",description:" All Life cards on hand - test play and flip mechanics",setup:a=>{let t=Ne(a,["Life","Water","Spirit"],["Metal","Death","Fire"],"player","action");return t.player.hand=[_("Life",0,!0),_("Life",1,!0),_("Life",2,!0),_("Life",3,!0),_("Life",4,!0),_("Life",5,!0)],t=P(t,"player",1,_("Water",1,!0)),t=P(t,"player",1,_("Water",2,!0)),t=P(t,"player",1,_("Water",3,!0)),t=P(t,"player",2,_("Spirit",2,!0)),t=P(t,"player",2,_("Spirit",4,!1)),t=P(t,"opponent",0,_("Metal",3,!1)),t=P(t,"opponent",1,_("Death",2,!0)),t=P(t,"opponent",1,_("Death",4,!1)),t=P(t,"opponent",2,_("Fire",5,!1)),t.player.deck=[_("Water",0,!0),_("Water",3,!0),_("Water",4,!0),_("Spirit",0,!0),_("Spirit",1,!0),_("Spirit",2,!0),_("Spirit",3,!0),_("Spirit",4,!0)],t.opponent.deck=[_("Metal",1,!0),_("Death",3,!0),_("Fire",2,!0)],t=Ce(t),Re(t)}},By={name:"Light Test Playground",description:" All Light cards on hand - burn away the dark",setup:a=>{let t=Ne(a,["Light","Water","Spirit"],["Metal","Death","Fire"],"player","action");return t.player.hand=[_("Light",0,!0),_("Light",1,!0),_("Light",2,!0),_("Light",3,!0),_("Light",4,!0),_("Light",5,!0)],t=P(t,"opponent",0,_("Fire",3,!1)),t=P(t,"opponent",1,_("Metal",4,!1)),t=P(t,"opponent",2,_("Death",5,!0)),t=P(t,"player",1,_("Water",2,!1)),t=P(t,"player",1,_("Water",3,!1)),t=P(t,"player",1,_("Water",4,!1)),t=P(t,"player",0,_("Spirit",1,!0)),t=P(t,"player",0,_("Spirit",2,!1)),t=P(t,"player",2,_("Spirit",5,!1)),t.player.deck=[_("Water",0,!0),_("Water",1,!0),_("Spirit",0,!0),_("Spirit",3,!0),_("Spirit",4,!0)],t.opponent.hand=[_("Metal",1,!0),_("Death",2,!0),_("Fire",3,!0),_("Metal",0,!0)],t=Ce(t),Re(t)}},Yy={name:"Death-2 Uncover Interrupt - Turn Wechsel Test",description:"Death-2 lscht  Darkness-4 uncovered  Opponent shiftet  Turn muss zu Opponent wechseln",setup:a=>{let t=Ne(a,["Death","Fire","Hate"],["Water","Darkness","Spirit"],"player","action");return t.player.hand=[_("Death",2,!0),_("Fire",1,!0),_("Hate",1,!0)],t=P(t,"player",0,_("Fire",0,!1)),t=P(t,"opponent",1,_("Darkness",4,!0)),t=P(t,"opponent",1,_("Darkness",1,!0)),t=P(t,"opponent",0,_("Water",0,!1)),t.opponent.hand=[_("Water",1,!0),_("Spirit",1,!0)],t=Ce(t),Re(t)}},Gy={name:"Apathy-5 Uncover - darf nur einmal triggern",description:"Hate-0 lscht Apathy-0  Apathy-5 uncovered  darf nur 1x triggern",setup:a=>{let t=Ne(a,["Hate","Fire","Death"],["Apathy","Darkness","Plague"],"player","action");return t.player.hand=[_("Hate",0,!0),_("Fire",2,!0),_("Death",2,!0)],t=P(t,"opponent",0,_("Apathy",5,!0)),t=P(t,"opponent",0,_("Apathy",4,!0)),t.opponent.hand=[_("Darkness",1,!0),_("Apathy",1,!0),_("Darkness",2,!0)],t=Ce(t),Re(t)}},Wy={name:"Psychic-1 facedown flip darkness 2 test",description:"Psychic-1 facedown, darkness-2 flippt Karte nur noch facedown bug",setup:a=>{let t=Ne(a,["Frost","Gravity","Plague"],["Psychic","Darkness","Speed"],"player","action");return t.player.hand=[_("Darkness",1,!0),_("Darkness",2,!0),_("Speed",3,!0)],t=P(t,"opponent",0,_("Frost",0,!1)),t=P(t,"opponent",1,_("Gravity",6,!1)),t=P(t,"player",0,_("Psychic",4,!1)),t=P(t,"player",1,_("Psychic",1,!1)),t.opponent.hand=[_("Gravity",1,!0)],t=Ce(t),Re(t)}},Qy={name:"Speed Test Playground",description:" All Speed cards on hand - swift and adaptive",setup:a=>{let t=Ne(a,["Speed","Water","Spirit"],["Metal","Death","Fire"],"player","action");return t.player.hand=[_("Speed",0,!0),_("Speed",1,!0),_("Speed",2,!0),_("Speed",3,!0),_("Speed",4,!0),_("Speed",5,!0)],t=P(t,"player",0,_("Water",2,!0)),t=P(t,"player",1,_("Spirit",3,!0)),t=P(t,"opponent",0,_("Metal",3,!1)),t=P(t,"opponent",1,_("Death",4,!1)),t=P(t,"opponent",2,_("Fire",2,!0)),t=P(t,"player",2,_("Spirit",5,!0)),t=P(t,"player",2,_("Spirit",4,!0)),t=Ce(t),Re(t)}},Xy={name:"Metal Test Playground",description:" All Metal cards on hand - unyielding defense",setup:a=>{let t=Ne(a,["Metal","Water","Spirit"],["Metal","Death","Fire"],"player","action");return t.player.hand=[_("Metal",0,!0),_("Metal",1,!0),_("Metal",2,!0),_("Metal",3,!0),_("Metal",5,!0),_("Metal",6,!0)],t=P(t,"opponent",0,_("Metal",3,!1)),t=P(t,"opponent",1,_("Death",4,!0)),t=P(t,"player",1,_("Water",3,!0)),t=P(t,"opponent",2,_("Fire",0,!0)),t=P(t,"opponent",2,_("Fire",1,!0)),t=P(t,"opponent",2,_("Fire",2,!0)),t=P(t,"opponent",2,_("Fire",3,!0)),t=P(t,"opponent",2,_("Fire",4,!0)),t=P(t,"opponent",2,_("Fire",5,!0)),t=P(t,"player",2,_("Spirit",3,!0)),t=P(t,"player",2,_("Spirit",2,!0)),t=Ce(t),Re(t)}},Zy={name:"Plague Test Playground",description:" All Plague cards on hand - spread suffering",setup:a=>{let t=Ne(a,["Plague","Water","Spirit"],["Metal","Death","Fire"],"player","action");return t.player.hand=[_("Plague",0,!0),_("Plague",1,!0),_("Plague",2,!0),_("Plague",3,!0),_("Plague",4,!0),_("Plague",5,!0)],t.opponent.hand=[_("Fire",2,!0),_("Death",3,!0),_("Water",1,!0)],t.player.lanes[0]=[_("Spirit",2,!0)],t.player.lanes[1]=[],t.player.lanes[2]=[],t.opponent.lanes[0]=[_("Metal",1,!0)],t.opponent.lanes[1]=[_("Death",2,!1)],t.opponent.lanes[2]=[_("Fire",3,!0)],t=Ce(t),Re(t)}},Ky={name:"Love Test Playground",description:" All Love cards on hand - share the love",setup:a=>{let t=Ne(a,["Love","Water","Spirit"],["Metal","Death","Fire"],"player","action");return t.player.hand=[_("Love",1,!0),_("Love",2,!0),_("Love",3,!0),_("Love",4,!0),_("Love",5,!0),_("Love",6,!0)],t.opponent.hand=[_("Fire",2,!0),_("Death",3,!0),_("Water",1,!0),_("Metal",4,!0)],t.player.lanes[0]=[_("Spirit",2,!0)],t.player.lanes[1]=[],t.player.lanes[2]=[],t.opponent.lanes[0]=[_("Metal",1,!0)],t.opponent.lanes[1]=[_("Death",2,!1)],t.opponent.lanes[2]=[_("Fire",3,!0)],t=Ce(t),Re(t)}},Jy={name:"Psychic Test Playground",description:" All Psychic cards on hand - read minds and control",setup:a=>{let t=Ne(a,["Psychic","Water","Spirit"],["Metal","Death","Fire"],"player","action");return t.player.hand=[_("Psychic",0,!0),_("Psychic",1,!0),_("Psychic",2,!0),_("Psychic",3,!0),_("Psychic",4,!0),_("Psychic",5,!0)],t.opponent.hand=[_("Fire",2,!0),_("Death",3,!0),_("Water",1,!0),_("Metal",4,!0)],t.player.lanes[0]=[_("Spirit",2,!0)],t.player.lanes[1]=[],t.player.lanes[2]=[],t.opponent.lanes[0]=[_("Metal",1,!0)],t.opponent.lanes[1]=[_("Death",2,!1)],t.opponent.lanes[2]=[_("Fire",3,!0)],t=Ce(t),Re(t)}},eg={name:" Gravity-2 AI Single Card Bug",description:"AI spielt Gravity-2  Flip  Shift  Turn endet (NUR 1 Karte!)",setup:a=>{let t=Ne(a,["Hate","Fire","Water"],["Gravity","Death","Metal"],"opponent","action");return t.opponent.hand=[_("Gravity",2,!0),_("Death",1,!0),_("Metal",3,!0)],t=P(t,"player",1,_("Hate",5,!0)),t=P(t,"player",1,_("Hate",4,!0)),t=P(t,"player",0,_("Fire",2,!0)),t=P(t,"player",2,_("Water",3,!0)),t=Ce(t),Re(t)}},tg={name:"Speed-3 End-Effekt Softlock Test",description:"Speed-3 als einzige uncovered Karte sollte sich selbst im End-Effekt shiften knnen",setup:a=>{let t=Ne(a,["Fire","Water","Death"],["Speed","Gravity","Light"],"opponent","end");return t.player.hand=[_("Fire",1,!0),_("Water",2,!0),_("Death",0,!0)],t=P(t,"player",0,_("Fire",3,!0)),t=P(t,"player",1,_("Water",1,!0)),t=P(t,"opponent",0,_("Speed",3,!0)),t.opponent.hand=[_("Gravity",1,!0),_("Light",2,!0)],t=Ce(t),Re(t)}},ng={name:"Uncover nach Delete All in Lane Test",description:"Death-2 lscht alle 1/2er  Karte darunter wird uncovered  Effekt triggert",setup:a=>{let t=Ne(a,["Death","Fire","Water"],["Fire","Spirit","Light"],"player","action");return t.player.hand=[_("Death",2,!0),_("Fire",3,!0),_("Water",4,!0)],t=P(t,"opponent",0,_("Fire",5,!0)),t=P(t,"opponent",0,_("Fire",2,!0)),t=P(t,"player",0,_("Fire",4,!0)),t=P(t,"player",1,_("Water",3,!0)),t=P(t,"opponent",1,_("Spirit",2,!0)),t=Ce(t),Re(t)}},ag={name:"Mehrfach-Uncover nach Delete All Test",description:"Death-2 lscht bei beiden Spielern  beide Karten darunter werden uncovered",setup:a=>{let t=Ne(a,["Death","Water","Spirit"],["Fire","Light","Gravity"],"player","action");return t.player.hand=[_("Death",2,!0),_("Spirit",3,!0)],t.opponent.hand=[_("Fire",3,!0),_("Light",5,!0)],t=P(t,"player",0,_("Water",5,!0)),t=P(t,"player",0,_("Water",1,!0)),t=P(t,"opponent",0,_("Fire",5,!0)),t=P(t,"opponent",0,_("Fire",2,!0)),t=Ce(t),Re(t)}},og={name:"Life-1 Uncover  Double Flip Bug",description:"Death-1 Start lscht  Life-1 uncovered  BEIDE Flips mssen ausgefhrt werden",setup:a=>{let t=Ne(a,["Death","Fire","Water"],["Life","Metal","Spirit"],"player","start");return t.player.hand=[_("Fire",2,!0)],t.opponent.hand=[_("Metal",3,!0),_("Spirit",2,!0)],t=P(t,"player",0,_("Death",1,!0)),t=P(t,"opponent",0,_("Life",1,!0)),t=P(t,"opponent",0,_("Metal",0,!0)),t=P(t,"player",1,_("Water",1,!0)),t=P(t,"opponent",1,_("Metal",1,!0)),t=P(t,"opponent",2,_("Spirit",0,!0)),t=Ce(t),Re(t)}},rg={name:"Smoke Test Playground",description:" All Smoke cards on hand - shroud your cards in mystery",setup:a=>{let t=Ne(a,["Smoke","Water","Spirit"],["Metal","Death","Fire"],"player","action");return t.player.hand=[_("Smoke",0,!0),_("Smoke",1,!0),_("Smoke",2,!0),_("Smoke",3,!0),_("Smoke",4,!0),_("Smoke",5,!0)],t=P(t,"player",0,_("Water",2,!1)),t=P(t,"opponent",1,_("Metal",3,!1)),t=P(t,"opponent",1,_("Death",2,!0)),t=P(t,"opponent",2,_("Fire",2,!0)),t=P(t,"player",2,_("Spirit",3,!0)),t=P(t,"player",1,_("Spirit",4,!0)),t=Ce(t),Re(t)}},lg={name:"Smoke AI Test",description:" AI spielt Smoke Karten - test all Smoke card effects with AI",setup:a=>{let t=Ne(a,["Water","Spirit","Light"],["Smoke","Metal","Death"],"opponent","action");return t.opponent.hand=[_("Smoke",0,!0),_("Smoke",1,!0),_("Smoke",2,!0),_("Smoke",3,!0),_("Smoke",4,!0),_("Smoke",5,!0)],t=P(t,"opponent",0,_("Metal",2,!1)),t=P(t,"player",0,_("Water",3,!0)),t=P(t,"player",1,_("Spirit",2,!1)),t=P(t,"player",1,_("Spirit",4,!0)),t=P(t,"opponent",2,_("Death",3,!0)),t=P(t,"player",2,_("Light",2,!0)),t=P(t,"opponent",1,_("Metal",4,!0)),t=Ce(t),Re(t)}},sg={name:"Clarity Test Playground",description:"All Clarity cards on hand - see through the fog of war",setup:a=>{let t=Ne(a,["Clarity","Water","Spirit"],["Metal","Death","Fire"],"player","action");return t.player.hand=[_("Clarity",0,!0),_("Clarity",1,!0),_("Clarity",2,!0),_("Clarity",3,!0),_("Clarity",4,!0),_("Clarity",5,!0)],t.player.deck=[_("Clarity",1,!0),_("Water",1,!0),_("Spirit",5,!0),_("Spirit",3,!0),_("Water",2,!0),_("Fire",4,!0)],t.player.discard=[_("Water",4,!0),_("Spirit",1,!0)],t=P(t,"player",0,_("Water",2,!0)),t.opponent.hand=[_("Metal",3,!0),_("Death",2,!0),_("Fire",4,!0)],t=P(t,"opponent",1,_("Metal",3,!0)),t=P(t,"opponent",2,_("Fire",2,!0)),t=Ce(t),Re(t)}},cg={name:"Clarity AI Test",description:"AI spielt Clarity Karten - test all Clarity card effects with AI",setup:a=>{let t=Ne(a,["Water","Spirit","Light"],["Clarity","Metal","Death"],"opponent","action");return t.opponent.hand=[_("Clarity",0,!0),_("Clarity",1,!0),_("Clarity",2,!0),_("Clarity",3,!0),_("Clarity",4,!0),_("Clarity",5,!0)],t.opponent.deck=[_("Clarity",1,!0),_("Metal",1,!0),_("Death",5,!0),_("Death",3,!0),_("Metal",2,!0)],t.opponent.discard=[_("Metal",4,!0),_("Death",2,!0)],t.player.hand=[_("Water",3,!0),_("Spirit",2,!0),_("Light",4,!0)],t=P(t,"player",0,_("Water",3,!0)),t=P(t,"opponent",0,_("Metal",2,!0)),t=P(t,"player",1,_("Spirit",4,!0)),t=P(t,"opponent",2,_("Death",3,!0)),t=Ce(t),Re(t)}},ig={name:"Courage Custom Playground",description:"Test all Courage effects: empty hand draw, opponent higher value delete, conditional draw/flip, highest value shift",setup:a=>{let i=Ne(a,["Courage","Fire","Speed"],["Spirit","Water","Darkness"],"player","action");return i.player.hand=[_("Courage",0,!0),_("Courage",1,!0),_("Courage",2,!0),_("Courage",3,!0),_("Courage",5,!0),_("Courage",6,!0)],i=P(i,"opponent",0,_("Spirit",3,!0)),i=P(i,"opponent",0,_("Spirit",5,!0)),i=P(i,"player",0,_("Fire",3,!0)),i=P(i,"opponent",1,_("Water",6,!0)),i=P(i,"player",1,_("Speed",4,!0)),i=P(i,"opponent",2,_("Darkness",2,!0)),i=P(i,"player",2,_("Fire",5,!0)),Re(i)}},dg={name:"Courage AI Test",description:"Test AI with Courage protocol: lane-restricted delete, self-shift to highest value lane",setup:a=>{let i=Ne(a,["Spirit","Water","Fire"],["Courage","Speed","Darkness"],"opponent","action");return i.opponent.hand=[_("Courage",0,!0),_("Courage",1,!0),_("Courage",2,!0),_("Courage",3,!0),_("Courage",5,!0),_("Courage",6,!0)],i=P(i,"player",0,_("Spirit",5,!0)),i=P(i,"player",0,_("Spirit",5,!0)),i=P(i,"opponent",0,_("Speed",3,!0)),i=P(i,"player",1,_("Water",6,!0)),i=P(i,"opponent",1,_("Darkness",2,!0)),i=P(i,"opponent",1,_("Darkness",2,!1)),i=P(i,"player",2,_("Fire",3,!0)),i=P(i,"opponent",2,_("Speed",5,!0)),Re(i)}},ug={name:"Corruption Test Playground",description:" All Corruption cards on hand - corrupt your opponent's plans",setup:a=>{let t=Ne(a,["Corruption","Water","Spirit"],["Metal","Death","Fire"],"player","action");return t.player.hand=[_("Corruption",0,!0),_("Corruption",1,!0),_("Corruption",2,!0),_("Corruption",3,!0),_("Corruption",5,!0),_("Corruption",6,!0)],t=P(t,"player",0,_("Water",2,!0)),t=P(t,"opponent",0,_("Metal",3,!0)),t=P(t,"opponent",1,_("Death",4,!0)),t=P(t,"opponent",2,_("Fire",2,!0)),t=P(t,"player",1,_("Spirit",3,!0)),t=P(t,"player",1,_("Spirit",5,!0)),t.opponent.hand=[_("Fire",3,!0),_("Metal",4,!0),_("Death",5,!0)],t=Ce(t),Re(t)}},pg={name:"Fear Custom Playground",description:"Test all Fear effects: passive ignore middle, choice shift/flip, chain discard, return, random discard",setup:a=>{let i=Ne(a,["Fear","Fire","Speed"],["Spirit","Water","Darkness"],"player","action");return i.player.hand=[_("Fear",0,!0),_("Fear",1,!0),_("Fear",2,!0),_("Fear",3,!0),_("Fear",4,!0),_("Fear",5,!0)],i=P(i,"opponent",0,_("Spirit",2,!0)),i=P(i,"opponent",0,_("Spirit",3,!0)),i=P(i,"player",0,_("Fire",3,!0)),i=P(i,"opponent",1,_("Water",4,!0)),i=P(i,"player",1,_("Speed",4,!0)),i=P(i,"opponent",2,_("Darkness",2,!1)),i=P(i,"player",2,_("Fire",5,!0)),i.opponent.hand=[_("Spirit",1,!0),_("Water",2,!0),_("Darkness",3,!0),_("Spirit",4,!0)],Re(i)}},fg={name:"Fear AI Test",description:"Test AI with Fear protocol: random discard execution, passive rule handling",setup:a=>{let i=Ne(a,["Spirit","Water","Fire"],["Fear","Speed","Darkness"],"opponent","action");return i.opponent.hand=[_("Fear",0,!0),_("Fear",1,!0),_("Fear",2,!0),_("Fear",3,!0),_("Fear",4,!0),_("Fear",5,!0)],i=P(i,"player",0,_("Spirit",3,!0)),i=P(i,"player",0,_("Spirit",5,!0)),i=P(i,"opponent",0,_("Speed",3,!0)),i=P(i,"player",1,_("Water",2,!0)),i=P(i,"player",1,_("Water",4,!0)),i=P(i,"player",2,_("Fire",3,!0)),i=P(i,"opponent",2,_("Darkness",5,!0)),i.player.hand=[_("Spirit",1,!0),_("Water",3,!0),_("Fire",4,!0)],Re(i)}},hg={name:"Ice Custom Playground",description:" Test all Ice effects: conditional shift, flip block, draw block, lane-reactive discard",setup:a=>{let i=Ne(a,["Ice","Fire","Speed"],["Spirit","Water","Darkness"],"player","action");return i.player.hand=[_("Ice",1,!0),_("Ice",2,!0),_("Ice",3,!0),_("Ice",4,!0),_("Ice",5,!0),_("Ice",6,!0),_("Fire",0,!0)],i=P(i,"player",0,_("Fire",3,!0)),i=P(i,"player",0,_("Fire",5,!0)),i=P(i,"opponent",1,_("Water",4,!0)),i=P(i,"player",1,_("Speed",4,!0)),i=P(i,"opponent",2,_("Darkness",2,!0)),i=P(i,"player",2,_("Fire",5,!0)),i.opponent.hand=[_("Spirit",1,!0),_("Water",2,!0),_("Darkness",3,!0)],Re(i)}},mg={name:"Ice AI Test",description:" Test AI with Ice protocol: shift self, shift others, passive rules",setup:a=>{let i=Ne(a,["Spirit","Water","Fire"],["Ice","Speed","Darkness"],"opponent","action");return i.opponent.hand=[_("Ice",1,!0),_("Ice",2,!0),_("Ice",3,!0),_("Ice",4,!0),_("Ice",5,!0),_("Ice",6,!0)],i=P(i,"player",0,_("Spirit",3,!0)),i=P(i,"player",0,_("Spirit",5,!0)),i=P(i,"opponent",0,_("Speed",3,!0)),i=P(i,"opponent",1,_("Darkness",2,!0)),i=P(i,"opponent",1,_("Darkness",4,!0)),i=P(i,"player",1,_("Water",4,!0)),i=P(i,"player",2,_("Fire",3,!0)),i=P(i,"opponent",2,_("Speed",5,!0)),i.player.hand=[_("Spirit",1,!0),_("Water",3,!0),_("Fire",4,!0)],Re(i)}},yg={name:"End Phase Test",description:"Test the game rule for the end or start phase, only 1 trigger",setup:a=>{let i=Ne(a,["Light","Fire","Speed"],["Spirit","Water","Darkness"],"player","action");return i.player.hand=[_("Light",5,!0),_("Fire",0,!0)],i=P(i,"player",0,_("Light",1,!0)),i=P(i,"player",0,_("Light",2,!0)),i=P(i,"player",1,_("Fire",3,!0)),i=P(i,"player",2,_("Speed",3,!0)),i.opponent.hand=[_("Spirit",1,!0),_("Water",2,!0),_("Darkness",3,!0)],Re(i)}},gg={name:"Start Phase Test",description:"Test the game rule for the end or start phase, only 1 trigger",setup:a=>{let i=Ne(a,["Spirit","Death","Psychic"],["Light","Water","Darkness"],"player","action");return i.player.hand=[_("Spirit",5,!0),_("Death",0,!0)],i=P(i,"player",0,_("Spirit",1,!0)),i=P(i,"player",0,_("Spirit",2,!0)),i=P(i,"player",1,_("Death",1,!0)),i=P(i,"player",1,_("Spirit",3,!0)),i=P(i,"player",2,_("Psychic",1,!0)),i.opponent.hand=[_("Light",1,!0),_("Water",2,!0),_("Darkness",3,!0)],Re(i)}},vg={name:"Committed Card Test",description:"Committed Card Test",setup:a=>{let i=Ne(a,["Spirit","Darkness","Psychic"],["Light","Water","Fire"],"player","action");return i.player.hand=[_("Darkness",0,!0),_("Death",0,!0)],i=P(i,"player",0,_("Spirit",0,!0)),i=P(i,"player",0,_("Spirit",3,!0)),i=P(i,"opponent",0,_("Light",1,!0)),i=P(i,"opponent",0,_("Light",2,!0)),i.opponent.hand=[_("Light",5,!0),_("Water",2,!0),_("Darkness",3,!0)],Re(i)}},_g={name:"Fear 0 prob Test",description:"Bla bla",setup:a=>{let i=Ne(a,["Chaos","Fear","Psychic"],["Light","Water","Fire"],"player","action");return i.player.hand=[_("Chaos",2,!0),_("Fear",3,!0)],i=P(i,"player",1,_("Fear",2,!0)),i=P(i,"player",1,_("Fear",0,!0)),i=P(i,"opponent",1,_("Water",5,!0)),i=P(i,"opponent",2,_("Darkness",2,!1)),i.opponent.hand=[_("Light",5,!0),_("Water",2,!0),_("Darkness",3,!0)],Re(i)}},xg={name:"MultiChain Test",description:"Multi Chain test",setup:a=>{let i=Ne(a,["Chaos","Smoke","Test"],["Light","Water","Fire"],"player","action");return i.player.hand=[_("Smoke",1,!0),_("Chaos",3,!0)],i=P(i,"player",2,_("Test",1,!1)),i=P(i,"opponent",1,_("Water",5,!0)),i=P(i,"opponent",2,_("Darkness",2,!1)),i.opponent.hand=[_("Light",5,!0),_("Water",2,!0),_("Darkness",3,!0)],Re(i)}},wg={name:"Light3-Uncover Test",description:"Light3-Uncover_actionType Test",setup:a=>{let i=Ne(a,["Chaos","Smoke","Test"],["Light","Water","Fire"],"player","action");return i.player.hand=[_("Smoke",1,!0),_("Chaos",3,!0)],i=P(i,"player",0,_("Chaos",3,!0)),i=P(i,"player",0,_("Chaos",2,!0)),i=P(i,"player",0,_("Test",1,!1)),i.opponent.hand=[_("Light",3,!0)],Re(i)}},Cg={name:"Luck Test Playground",description:" All Luck cards on hand - gamble with fate!",setup:a=>{let t=Ne(a,["Luck","Fire","Water"],["Death","Life","Gravity"],"player","action");return t.player.hand=[_("Luck",0,!0),_("Luck",1,!0),_("Luck",2,!0),_("Luck",3,!0),_("Luck",4,!0),_("Luck",5,!0)],t=P(t,"opponent",0,_("Death",3,!0)),t=P(t,"opponent",0,_("Death",2,!1)),t=P(t,"opponent",1,_("Life",2,!0)),t=P(t,"player",1,_("Fire",3,!0)),t=P(t,"opponent",2,_("Gravity",4,!0)),t=P(t,"player",2,_("Water",3,!0)),t=Ce(t),Re(t)}},Sg={name:"Luck AI Test",description:" AI spielt Luck Karten - test all Luck card effects with AI",setup:a=>{let t=Ne(a,["Fire","Water","Spirit"],["Luck","Death","Life"],"opponent","action");return t.opponent.hand=[_("Luck",0,!0),_("Luck",1,!0),_("Luck",2,!0),_("Luck",3,!0),_("Luck",4,!0),_("Luck",5,!0)],t=P(t,"player",0,_("Fire",3,!0)),t=P(t,"opponent",0,_("Death",2,!0)),t=P(t,"player",1,_("Water",2,!0)),t=P(t,"player",1,_("Water",4,!1)),t=P(t,"player",2,_("Spirit",3,!0)),t=P(t,"opponent",2,_("Life",4,!0)),t=Ce(t),Re(t)}},bg={name:"Mirror Test Playground",description:" All Mirror cards on hand - copy, reflect, and swap",setup:a=>{let t=Ne(a,["Mirror","Fire","Water"],["Death","Metal","Spirit"],"player","action");return t.player.hand=[_("Mirror",0,!0),_("Mirror",1,!0),_("Mirror",2,!0),_("Mirror",3,!0),_("Mirror",4,!0),_("Mirror",5,!0)],t=P(t,"player",0,_("Fire",3,!0)),t=P(t,"player",0,_("Fire",2,!1)),t=P(t,"player",1,_("Water",4,!0)),t=P(t,"player",2,_("Water",1,!0)),t=P(t,"opponent",0,_("Death",3,!0)),t=P(t,"opponent",0,_("Death",2,!1)),t=P(t,"opponent",1,_("Metal",4,!0)),t=P(t,"opponent",2,_("Spirit",2,!0)),t.opponent.hand=[_("Metal",1,!0),_("Spirit",3,!0),_("Death",4,!0)],t=Ce(t),Re(t)}},Eg={name:"Mirror AI Test",description:" AI spielt Mirror Karten - test all Mirror card effects with AI",setup:a=>{let t=Ne(a,["Fire","Water","Spirit"],["Mirror","Death","Metal"],"opponent","action");return t.opponent.hand=[_("Mirror",0,!0),_("Mirror",1,!0),_("Mirror",2,!0),_("Mirror",3,!0),_("Mirror",4,!0),_("Mirror",5,!0)],t=P(t,"opponent",0,_("Death",3,!0)),t=P(t,"opponent",0,_("Death",2,!1)),t=P(t,"opponent",1,_("Metal",4,!0)),t=P(t,"opponent",2,_("Metal",1,!0)),t=P(t,"player",0,_("Fire",3,!0)),t=P(t,"player",0,_("Fire",2,!1)),t=P(t,"player",1,_("Water",4,!0)),t=P(t,"player",2,_("Spirit",2,!0)),t.player.hand=[_("Fire",1,!0),_("Water",3,!0),_("Spirit",4,!0)],t=Ce(t),Re(t)}},jg={name:"Peace Test Playground",description:" All Peace cards on hand - harmony, balance, sacrifice",setup:a=>{let t=Ne(a,["Peace","Fire","Water"],["Death","Metal","Spirit"],"player","action");return t.player.hand=[_("Peace",1,!0),_("Peace",2,!0),_("Peace",3,!0),_("Peace",4,!0),_("Peace",5,!0),_("Peace",6,!0)],t=P(t,"player",0,_("Fire",3,!0)),t=P(t,"player",1,_("Water",4,!0)),t=P(t,"player",2,_("Water",5,!0)),t=P(t,"opponent",0,_("Death",5,!1)),t=P(t,"opponent",1,_("Metal",6,!0)),t=P(t,"opponent",2,_("Spirit",4,!0)),t.opponent.hand=[_("Metal",1,!0),_("Spirit",4,!0),_("Death",0,!0)],t=Ce(t),Re(t)}},kg={name:"Peace AI Test",description:" AI spielt Peace Karten - test all Peace card effects with AI",setup:a=>{let t=Ne(a,["Fire","Water","Spirit"],["Peace","Death","Life"],"opponent","action");return t.opponent.hand=[_("Peace",1,!0),_("Peace",2,!0),_("Peace",3,!0),_("Peace",4,!0),_("Peace",5,!0),_("Peace",6,!0)],t=P(t,"player",0,_("Fire",3,!0)),t=P(t,"player",1,_("Water",4,!0)),t=P(t,"player",2,_("Spirit",5,!0)),t=P(t,"opponent",0,_("Death",2,!0)),t=P(t,"opponent",1,_("Life",3,!0)),t.player.hand=[_("Fire",1,!0),_("Water",3,!0),_("Spirit",4,!0)],t=Ce(t),Re(t)}},Ng={name:"Peace-4 Reactive Test",description:" Test Peace-4: AI spielt Plague  du discardest  Peace-4 triggert  du ziehst",setup:a=>{let t=Ne(a,["Peace","Fire","Water"],["Plague","Death","Life"],"opponent","action");return t=P(t,"player",0,_("Peace",4,!0)),t=P(t,"player",1,_("Fire",3,!0)),t=P(t,"player",2,_("Water",2,!0)),t.opponent.hand=[_("Plague",0,!0),_("Plague",1,!0)],t=P(t,"opponent",0,_("Death",5,!0)),t.player.hand=[_("Fire",1,!0),_("Water",3,!0),_("Peace",2,!0)],t=Ce(t),Re(t)}},Rg=[py,fy,hy,my,yy,gy,vy,_y,xy,wy,Cy,Sy,by,Ey,jy,ky,Ny,Ry,Ty,Ay,Dy,vb,_b,xb,wb,Cb,Sb,Fy,qy,$y,Ly,Iy,Uy,Py,Oy,My,Hy,zy,Vy,By,Yy,Gy,Wy,Qy,Xy,Zy,Ky,Jy,eg,tg,ng,ag,og,rg,lg,sg,cg,ug,ig,dg,pg,fg,hg,mg,yg,gg,vg,_g,xg,wg,Cg,Sg,bg,Eg,jg,kg,Ng],bb=Object.freeze(Object.defineProperty({__proto__:null,allScenarios:Rg,scenario10_Hate1Interrupt:_y,scenario11_Darkness1HateChain:xy,scenario12_Water4TurnEnd:wy,scenario13_Psychic3ShiftTest:Cy,scenario14_Death1UncoverTest:Sy,scenario15_Gravity2ShiftInterrupt:by,scenario16_Hate2PlayerPlays:Ey,scenario171_Hate2AIPlays:ky,scenario17_Hate2AIPlays:jy,scenario18_Hate2SelfDelete:Ny,scenario19_Hate2MultipleTies:Ry,scenario1_Psychic3Uncover:py,scenario20_Hate2FaceDown:Ty,scenario21_Hate2AIValidation:Ay,scenario22_Hate2AIPlaysOpen:Dy,scenario29_FireCustomConditional:Fy,scenario2_Psychic4EndEffect:fy,scenario30_AnarchyCustomPlayground:qy,scenario31_DarkCustPlayground:$y,scenario32_ApathyCustomPlayground:Ly,scenario33_DeathCustomPlayground:Iy,scenario34_WaterCustomPlayground:Uy,scenario35_SpiritCustomPlayground:Py,scenario36_ChaosCustomPlayground:Oy,scenario37_GravityCustomPlayground:My,scenario38_FrostCustomPlayground:Hy,scenario39_HateCustomPlayground:zy,scenario3_Spirit3EndPhase:hy,scenario40_LifeCustomPlayground:Vy,scenario41_LightCustomPlayground:By,scenario42_Death2UncoverInterruptTurn:Yy,scenario43_Apathy5DoubleUncover:Gy,scenario44_Psychic1Darkness2Test:Wy,scenario45_SpeedCustomPlayground:Qy,scenario46_MetalCustomPlayground:Xy,scenario47_PlagueCustomPlayground:Zy,scenario48_LoveCustomPlayground:Ky,scenario49_PsychicCustomPlayground:Jy,scenario4_Plague2Actor:my,scenario50_Gravity2SingleCardBug:eg,scenario51_Speed3EndEffectSoftlock:tg,scenario52_UncoverAfterBulkDelete:ng,scenario53_MultiUncoverAfterBulkDelete:ag,scenario54_Life1UncoverDoubleFlip:og,scenario55_SmokeCustomPlayground:rg,scenario56_SmokeAITest:lg,scenario57_ClarityCustomPlayground:sg,scenario58_ClarityAITest:cg,scenario59_CorruptionCustomPlayground:ug,scenario5_Darkness1Interrupt:yy,scenario60_CourageCustomPlayground:ig,scenario61_CourageAITest:dg,scenario62_FearCustomPlayground:pg,scenario63_FearAITest:fg,scenario64_IceCustomPlayground:hg,scenario65_IceAITest:mg,scenario66_endPhasePlayground:yg,scenario67_startPhasePlayground:gg,scenario68_CommittedCardPlayground:vg,scenario69_fear0shiftCardPlayground:_g,scenario70_multiChainCardPlayground:xg,scenario71_Light3ProblemPlayground:wg,scenario72_LuckCustomPlayground:Cg,scenario73_LuckAITest:Sg,scenario74_MirrorCustomPlayground:bg,scenario75_MirrorAITest:Eg,scenario76_PeaceCustomPlayground:jg,scenario77_PeaceAITest:kg,scenario78_Peace4ReactiveTest:Ng,scenario8_Plague4Owner:gy,scenario9_Water:vy},Symbol.toStringTag,{value:"Module"})),Eb=({onLoadScenario:a,onSkipCoinFlip:t,onForceWin:l,onForceLose:i})=>{const[c,d]=se.useState(!1);return c?o.jsxs("div",{style:{position:"fixed",top:"20px",left:"20px",width:"400px",maxHeight:"600px",backgroundColor:"#2c2c2c",border:"2px solid #ff6b6b",borderRadius:"8px",padding:"20px",zIndex:9999,overflowY:"auto",color:"white",fontFamily:"monospace"},children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"20px"},children:[o.jsx("h3",{style:{margin:0},children:" Debug Panel"}),o.jsx("button",{onClick:()=>d(!1),style:{backgroundColor:"transparent",border:"none",color:"white",cursor:"pointer",fontSize:"20px"},children:""})]}),o.jsx("div",{style:{marginBottom:"15px",fontSize:"12px",color:"#aaa"},children:"Lade vordefinierte Test-Szenarien zum Testen der Actor/Owner-Fixes."}),o.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:Rg.map((f,u)=>o.jsxs("div",{style:{backgroundColor:"#1a1a1a",padding:"12px",borderRadius:"5px",border:"1px solid #444"},children:[o.jsx("div",{style:{fontWeight:"bold",marginBottom:"5px",color:"#4ecdc4"},children:f.name}),o.jsx("div",{style:{fontSize:"11px",color:"#bbb",marginBottom:"10px"},children:f.description}),o.jsx("button",{onClick:()=>{t&&t(),a(f.setup),d(!1)},style:{padding:"6px 12px",backgroundColor:"#4ecdc4",color:"#1a1a1a",border:"none",borderRadius:"3px",cursor:"pointer",fontWeight:"bold",fontSize:"12px"},children:"Load Scenario"})]},u))}),(l||i)&&o.jsxs("div",{style:{marginTop:"20px",paddingTop:"15px",borderTop:"1px solid #444",display:"flex",gap:"10px",justifyContent:"center"},children:[l&&o.jsx("button",{onClick:()=>{l(),d(!1)},style:{padding:"10px 20px",backgroundColor:"#4ecdc4",color:"#1a1a1a",border:"none",borderRadius:"5px",cursor:"pointer",fontWeight:"bold",fontSize:"14px"},children:" Force Win"}),i&&o.jsx("button",{onClick:()=>{i(),d(!1)},style:{padding:"10px 20px",backgroundColor:"#ff6b6b",color:"white",border:"none",borderRadius:"5px",cursor:"pointer",fontWeight:"bold",fontSize:"14px"},children:" Force Lose"})]}),o.jsx("div",{style:{marginTop:"20px",fontSize:"11px",color:"#666",textAlign:"center"},children:"Drcke ESC oder klicke  zum Schlieen"})]}):o.jsx("button",{onClick:()=>d(!0),style:{position:"fixed",top:"20px",left:"20px",padding:"10px 20px",backgroundColor:"#ff6b6b",color:"white",border:"none",borderRadius:"5px",cursor:"pointer",fontWeight:"bold",zIndex:9999,fontSize:"14px"},children:" DEBUG"})},mm=(a,t)=>{if(!t)return null;for(const l of["player","opponent"])for(const i of a[l].lanes){const c=i.find(d=>d.id===t);if(c)return{card:c,owner:l}}return null},jb=new Set(["discard","select_card_from_hand_to_play","select_card_from_hand_to_give","select_card_from_hand_to_reveal","plague_2_player_discard","select_cards_from_hand_to_discard_for_fire_4","select_cards_from_hand_to_discard_for_hate_1"]);function kb({onBack:a,onEndGame:t,playerProtocols:l,opponentProtocols:i,difficulty:c,useControlMechanic:d,startingPlayer:f="player"}){var He,We,at,Me,pt,Pt,la,zt,xt,sa,Vn,Tt,Ja;const[u,p]=se.useState(null),[m,y]=se.useState(!0),{startGame:v,endGame:x,trackPlayerCoinFlip:w,trackPlayerRearrange:S}=gb(l,c,d),E=se.useCallback((xe,be,Ue)=>{p(xe),y(!1),w(be,Ue)},[w]),b=se.useCallback(()=>{p("player"),y(!1),v()},[v]);se.useEffect(()=>{!m&&u&&v()},[m,u,v]);const j=se.useCallback((xe,be)=>{const Ue=be.player.compiled.filter(ft=>ft).length;x(xe,be.stats.player,Ue,be.stats.opponent,be.detailedGameStats),t(xe,be)},[x,t]),{gameState:C,selectedCard:R,setSelectedCard:F,playSelectedCard:L,fillHand:O,discardCardFromHand:T,compileLane:G,resolveActionWithCard:V,resolveActionWithLane:z,selectHandCardForAction:U,resolveActionWithHandCard:k,skipAction:A,resolveOptionalDrawPrompt:I,resolveDeath1Prompt:$,resolveLove1Prompt:q,resolvePlague2Discard:M,resolvePlague4Flip:B,resolveFire3Prompt:W,resolveOptionalDiscardCustomPrompt:K,resolveOptionalEffectPrompt:D,resolveFire4Discard:Q,resolveHate1Discard:ae,resolveLight2Prompt:Y,resolveRevealBoardCardPrompt:Z,resolveRearrangeProtocols:ue,resolveSpirit1Prompt:re,resolveSpirit3Prompt:ee,resolveSwapProtocols:X,resolveSpeed3Prompt:le,resolvePsychic4Prompt:J,resolveControlMechanicPrompt:me,resolveCustomChoice:ve,resolveSelectRevealedDeckCard:Se,resolveStateNumber:Le,resolveStateProtocol:Ee,resolveSelectFromDrawnToReveal:lt,resolveConfirmDeckDiscard:et,resolveConfirmDeckPlayPreview:Je,setupTestScenario:nt}=bx(l,i,j,c,d,u??"player",S),[je,Fe]=se.useState(null),[Ve,Oe]=se.useState([]),[Rt,tt]=se.useState(!1),[It,Zt]=se.useState([]),En=se.useRef(C.log.length),[On,fa]=se.useState(!1),[Ea,yn]=se.useState(!1),[Ft,Kt]=se.useState(null),[Ut,ha]=se.useState(!1),[ja,aa]=se.useState(0),Jt=se.useRef(null),dn=se.useRef(C);se.useEffect(()=>{dn.current=C},[C]);const Mn=()=>{const xe=ja+1;if(aa(xe),xe>=5){ha(be=>!be),aa(0),Jt.current&&(clearTimeout(Jt.current),Jt.current=null);return}Jt.current&&clearTimeout(Jt.current),Jt.current=setTimeout(()=>{aa(0),Jt.current=null},2e3)},fn=se.useCallback(()=>{console.log("Debug: Forcing player win via DebugPanel."),j("player",C)},[j,C]),Hn=se.useCallback(()=>{console.log("Debug: Forcing player loss via DebugPanel."),j("opponent",C)},[j,C]),jn=se.useMemo(()=>{if(C.lastPlayedCardId){const xe=mm(C,C.lastPlayedCardId);if(xe){const be=xe.owner==="player"||xe.card.isFaceUp;return{card:xe.card,showContents:be}}}return null},[C.lastPlayedCardId,C.player.lanes,C.opponent.lanes]),ka=se.useMemo(()=>{var be;const xe=(be=C.actionRequired)==null?void 0:be.sourceCardId;if(xe){const Ue=mm(C,xe);if(Ue){const ft=Ue.owner==="player"||Ue.card.isFaceUp;return{card:Ue.card,showContents:ft}}}return null},[(He=C.actionRequired)==null?void 0:He.sourceCardId,C.player.lanes,C.opponent.lanes]);se.useEffect(()=>{var xe;(xe=C.actionRequired)!=null&&xe.sourceCardId&&Fe(null)},[(We=C.actionRequired)==null?void 0:We.sourceCardId]);const oa=je||ka||jn;se.useEffect(()=>{C.log.length>En.current&&C.log.slice(En.current).forEach(be=>{if(be.message!=="Game Started."){const Ue={message:be.message,player:be.player,id:Ze()};Zt(ft=>[...ft,Ue]),setTimeout(()=>{Zt(ft=>ft.filter(Vt=>Vt.id!==Ue.id))},5e3)}}),En.current=C.log.length},[C.log]),se.useEffect(()=>{var be,Ue,ft,Vt,un;!(((be=C.actionRequired)==null?void 0:be.type)==="discard"&&((Ue=C.actionRequired)==null?void 0:Ue.variableCount))&&((ft=C.actionRequired)==null?void 0:ft.type)!=="plague_2_player_discard"&&((Vt=C.actionRequired)==null?void 0:Vt.type)!=="select_cards_from_hand_to_discard_for_fire_4"&&((un=C.actionRequired)==null?void 0:un.type)!=="select_cards_from_hand_to_discard_for_hate_1"&&Oe([])},[C.actionRequired]),se.useEffect(()=>{var xe,be;fa(((xe=C.actionRequired)==null?void 0:xe.type)==="prompt_rearrange_protocols"&&C.actionRequired.actor==="player"),yn(((be=C.actionRequired)==null?void 0:be.type)==="prompt_swap_protocols"&&C.actionRequired.actor==="player")},[C.actionRequired]),se.useEffect(()=>{const xe=be=>{be.ctrlKey&&be.shiftKey&&(be.preventDefault(),be.key.toLowerCase()==="d"?(console.log("Debug: Toggling debug button visibility."),ha(Ue=>!Ue)):be.key.toLowerCase()==="w"?(console.log("Debug: Forcing player win."),t("player",C)):be.key.toLowerCase()==="o"?(console.log("Debug: Forcing opponent win."),t("opponent",C)):be.key.toLowerCase()==="p"?(console.log("Debug: Setting up Speed-0 interrupt scenario."),nt("speed-0-interrupt")):be.key.toLowerCase()==="l"?(console.log("Debug: Setting up Speed-1 discard trigger scenario."),nt("speed-1-trigger")):be.key.toLowerCase()==="f"?(console.log("Debug: Setting up Fire On-Cover test scenario."),nt("fire-oncover-test")):be.key.toLowerCase()==="s"?(console.log("Debug: Setting up Speed-2 + Control test scenario."),nt("speed-2-control-test")):be.key.toLowerCase()==="u"&&(console.log("Debug: Setting up Death-1 Uncover test scenario."),p0(()=>Promise.resolve().then(()=>bb),void 0).then(Ue=>{nt(Ue.scenario14_Death1UncoverTest.setup)})))};return window.addEventListener("keydown",xe),()=>{window.removeEventListener("keydown",xe)}},[C,t,nt]);const kn=(xe,be)=>{const Ue=dn.current;if(Ue.animationState)return;const{actionRequired:ft,turn:Vt,phase:un,compilableLanes:Ra,player:tn,opponent:hn}=Ue;if(be==="player"&&Vt==="player"&&un==="compile"&&Ra.includes(xe)){if(ft){console.warn("Compile click blocked by pending action:",ft);return}G(xe);return}if(ft&&ft.actor==="player"&&["select_lane_for_shift","select_lane_for_shift_all","shift_flipped_card_optional","select_lane_for_play","select_lane_for_delete","select_lane_for_death_2","select_lane_for_life_3_play","select_lane_to_shift_revealed_card_for_light_2","select_lane_to_shift_revealed_board_card_custom","select_lane_to_shift_cards_for_light_3","select_lane_for_water_3","select_lane_for_metal_3_delete","select_lane_for_delete_all","select_lane_for_return","select_lanes_for_swap_stacks"].includes(ft.type)){z(xe);return}const nn=hn.lanes.flat().some(Qt=>Qt.isFaceUp&&Qt.protocol==="Psychic"&&Qt.value===1),qt=hn.lanes[xe],$o=qt.length>0&&qt[qt.length-1].isFaceUp&&qt[qt.length-1].protocol==="Plague"&&qt[qt.length-1].value===0;if(R&&un==="action"&&!ft&&tn.hand.some(Qt=>Qt.id===R)&&!$o){const Qt=tn.hand.find(At=>At.id===R);if(be==="opponent"){if(!Ql(Ue,Qt)){F(null),Fe(null);return}if(nn){F(null),Fe(null);return}L(xe,!0,"opponent"),Fe(null);return}const Lo=tn.lanes.flat().some(At=>At.isFaceUp&&At.protocol==="Spirit"&&At.value===1),Ta=tn.lanes.some((At,dr)=>{if(At.length===0)return!1;const Aa=At[At.length-1];return Aa.isFaceUp&&Aa.protocol==="Chaos"&&Aa.value===3}),ir=[...tn.lanes.flat(),...hn.lanes.flat()].some(At=>At.isFaceUp&&At.protocol==="Anarchy"&&At.value===1),an=Sc(Ue),eo=bc(Ue,"player",xe),Io=Ql(Ue,Qt);let ca;Io?ca=!nn:ir||an?ca=Qt.protocol!==tn.protocols[xe]&&Qt.protocol!==hn.protocols[xe]&&!nn:ca=(Lo||eo||Ta||Qt.protocol===tn.protocols[xe]||Qt.protocol===hn.protocols[xe])&&!nn,L(xe,ca),Fe(null);return}R&&(F(null),Fe(null))},Nn=xe=>{const be=dn.current;if(be.animationState||!R)return;const{phase:Ue,actionRequired:ft,player:Vt}=be;Ue!=="action"||ft||!Vt.hand.some(un=>un.id===R)||(L(xe,!1),Fe(null))},Na=xe=>{const be=dn.current;if(!be.animationState){if(be.actionRequired){if(be.actionRequired.type==="discard"&&be.actionRequired.actor==="player")if(be.actionRequired.variableCount){Oe(Ue=>Ue.includes(xe.id)?Ue.filter(ft=>ft!==xe.id):[...Ue,xe.id]);return}else{T(xe.id);return}if(be.actionRequired.type==="select_card_from_hand_to_play"){U(xe.id);return}if(be.actionRequired.type==="select_card_from_hand_to_give"||be.actionRequired.type==="select_card_from_hand_to_reveal"){k(xe.id);return}if(be.actionRequired.type==="plague_2_player_discard"||be.actionRequired.type==="select_cards_from_hand_to_discard_for_fire_4"||be.actionRequired.type==="select_cards_from_hand_to_discard_for_hate_1"){Oe(Ue=>Ue.includes(xe.id)?Ue.filter(ft=>ft!==xe.id):[...Ue,xe.id]);return}return}be.turn!=="player"||be.phase!=="action"&&be.phase!=="compile"||(xe.id===R?(F(null),Fe(null)):(F(xe.id),Fe({card:xe,showContents:!0})))}},ma=(xe,be,Ue)=>{const ft=dn.current;if(ft.animationState)return;const{actionRequired:Vt,turn:un,phase:Ra,compilableLanes:tn}=ft;if(un==="player"&&Ra==="compile"&&tn.includes(Ue)){kn(Ue,be);return}if(un==="player"&&!Vt&&R&&Ra==="action"){kn(Ue,be);return}if(Vt&&Vt.actor==="player"&&(Vt.type==="select_own_highest_card_to_delete_for_hate_2"||Vt.type==="select_opponent_highest_card_to_delete_for_hate_2")&&wc(xe,ft)){V(xe.id);return}if(wc(xe,ft))V(xe.id);else if(R)F(null),Fe(null);else{const hn=be==="player"||xe.isFaceUp;Fe({card:xe,showContents:hn})}},ya=xe=>{R||Fe({card:xe,showContents:!0})},ga=(xe,be)=>{if(!R){const Ue=be==="player"||xe.isFaceUp;Fe({card:xe,showContents:Ue})}},zn=()=>{R||Fe(null)},ra=xe=>{!R&&!C.actionRequired&&Fe({card:xe,showContents:xe.isRevealed||!1})},fe=()=>{if(!oa)return null;const{card:xe,showContents:be}=oa;return o.jsx(bt,{card:xe,isFaceUp:be})},ke=C.turn==="player"&&!C.actionRequired&&C.phase==="compile"&&C.compilableLanes.length>0,De=((at=C.actionRequired)==null?void 0:at.sourceCardId)??null,Ae=se.useMemo(()=>{var xe;return(xe=C.actionRequired)!=null&&xe.actor?C.actionRequired.actor==="player"?"action-required-player":"action-required-opponent":""},[C.actionRequired]),Te=se.useMemo(()=>{const xe=C.actionRequired;return xe&&xe.actor==="player"?jb.has(xe.type)?"":"hand-in-background":""},[C.actionRequired]);return o.jsxs("div",{className:"screen game-screen",children:[Ft&&o.jsx(Hx,{player:Ft,playerState:C[Ft],onClose:()=>Kt(null),difficulty:c}),On&&((Me=C.actionRequired)==null?void 0:Me.type)==="prompt_rearrange_protocols"&&o.jsx(Fx,{gameState:C,targetPlayer:C.actionRequired.target,onConfirm:xe=>{var be,Ue;((be=C.actionRequired)==null?void 0:be.sourceCardId)==="CONTROL_MECHANIC"&&((Ue=C.actionRequired)!=null&&Ue.actor)&&S(C.actionRequired.actor),ue(xe),fa(!1)}}),Ea&&((pt=C.actionRequired)==null?void 0:pt.type)==="prompt_swap_protocols"&&o.jsx(qx,{gameState:C,targetPlayer:C.actionRequired.target,onConfirm:xe=>{X(xe),yn(!1)}}),((Pt=C.actionRequired)==null?void 0:Pt.type)==="select_card_from_revealed_deck"&&C.actionRequired.actor==="player"&&o.jsx(Ux,{gameState:C,onSelectCard:xe=>{Se(xe)}}),((la=C.actionRequired)==null?void 0:la.type)==="prompt_optional_effect"&&C.actionRequired.actor==="player"&&o.jsx(Px,{gameState:C,onAccept:()=>D(!0),onDecline:()=>D(!1)}),((zt=C.actionRequired)==null?void 0:zt.type)==="state_number"&&C.actionRequired.actor==="player"&&o.jsx($x,{gameState:C,onConfirm:xe=>Le(xe)}),((xt=C.actionRequired)==null?void 0:xt.type)==="state_protocol"&&C.actionRequired.actor==="player"&&o.jsx(Lx,{gameState:C,availableProtocols:C.actionRequired.availableProtocols||[],onConfirm:xe=>Ee(xe)}),((sa=C.actionRequired)==null?void 0:sa.type)==="select_from_drawn_to_reveal"&&C.actionRequired.actor==="player"&&o.jsx(Ix,{gameState:C,allDrawnCardIds:C.actionRequired.allDrawnCardIds||[],eligibleCardIds:C.actionRequired.eligibleCardIds||[],statedNumber:C.actionRequired.statedNumber,revealCount:C.actionRequired.revealCount,onConfirm:xe=>lt(xe),onClose:()=>{lt("")}}),((Vn=C.actionRequired)==null?void 0:Vn.type)==="confirm_deck_discard"&&C.actionRequired.actor==="player"&&o.jsx(Ox,{discardedCard:C.actionRequired.discardedCard,deckOwner:C.actionRequired.deckOwner,onConfirm:()=>et()}),((Tt=C.actionRequired)==null?void 0:Tt.type)==="confirm_deck_play_preview"&&C.actionRequired.actor==="player"&&o.jsx(Mx,{card:C.actionRequired.drawnCard,isFaceDown:C.actionRequired.isFaceDown,onConfirm:()=>Je()}),o.jsx("div",{className:"toaster-container",children:It.map(xe=>o.jsx(Dx,{message:xe.message,player:xe.player},xe.id))}),Rt&&o.jsx(Ax,{log:C.log,onClose:()=>tt(!1)}),o.jsx("button",{className:"btn log-button",onClick:()=>tt(!0),children:"Log"}),o.jsxs("div",{className:"game-screen-layout",children:[o.jsxs("div",{className:"game-preview-container",children:[o.jsx("h2",{onClick:Mn,style:{cursor:"pointer",userSelect:"none"},title:"Click 5 times to toggle debug mode",children:"Mainframe"}),o.jsx(Nx,{gameState:C,turn:((Ja=C.actionRequired)==null?void 0:Ja.actor)||C.turn,animationState:C.animationState,difficulty:c,onPlayerClick:()=>Kt("player"),onOpponentClick:()=>Kt("opponent")}),o.jsx("div",{className:"preview-card-area",children:fe()}),o.jsx("button",{className:"btn btn-back",onClick:a,children:"Back"})]}),o.jsxs("div",{className:"game-main-area",children:[ke&&o.jsx("div",{className:"compile-prompt-container",children:o.jsx("h3",{children:"Select a Protocol to Compile"})}),o.jsx(Ex,{gameState:C,onLanePointerDown:kn,onPlayFaceDown:Nn,selectedCardId:R,onCardPointerDown:ma,onCardPointerEnter:ga,onCardPointerLeave:zn,onOpponentHandCardPointerEnter:ra,onOpponentHandCardPointerLeave:zn,sourceCardId:De}),o.jsxs("div",{className:"player-action-area",children:[o.jsx(jx,{gameState:C,onFillHand:O,onSkipAction:A,onResolveOptionalDrawPrompt:I,onResolveDeath1Prompt:$,onResolveLove1Prompt:q,onResolvePlague2Discard:M,onResolvePlague4Flip:B,onResolveFire3Prompt:W,onResolveOptionalDiscardCustomPrompt:K,onResolveOptionalEffectPrompt:D,onResolveSpeed3Prompt:le,onResolveFire4Discard:Q,onResolveHate1Discard:ae,onResolveLight2Prompt:Y,onResolveRevealBoardCardPrompt:Z,onResolvePsychic4Prompt:J,onResolveSpirit1Prompt:re,onResolveSpirit3Prompt:ee,onResolveControlMechanicPrompt:me,onResolveCustomChoice:ve,selectedCardId:R,multiSelectedCardIds:Ve,actionRequiredClass:Ae}),o.jsx("div",{className:`player-hand-area ${Te}`,children:C.player.hand.filter(xe=>{const be=C.actionRequired;return(be==null?void 0:be.type)==="select_card_from_hand_to_play"&&(be==null?void 0:be.selectableCardIds)?be.selectableCardIds.includes(xe.id):!0}).map(xe=>{var Ue;const be=((Ue=C.actionRequired)==null?void 0:Ue.type)==="select_lane_for_play"?xe.id===C.actionRequired.cardInHandId:xe.id===R;return o.jsx(bt,{card:xe,isFaceUp:!0,onPointerDown:()=>Na(xe),onPointerEnter:()=>ya(xe),isSelected:be,isMultiSelected:Ve.includes(xe.id),animationState:C.animationState,additionalClassName:"in-hand"},xe.id)})})]})]})]}),m&&o.jsx(zx,{onComplete:E}),Ut&&o.jsx(Eb,{onLoadScenario:nt,onSkipCoinFlip:b,onForceWin:fn,onForceLose:Hn})]})}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function Nb({onPlayAgain:a,winner:t,finalState:l,difficulty:i}){if(!l)return o.jsxs("div",{className:"screen",children:[o.jsx("h1",{children:"Loading Results..."}),o.jsx("button",{className:"btn",onClick:a,children:"Back to Menu"})]});const c=t==="player",d=(f,u)=>{let p=[f];return u&&p.push("compiled"),p.join(" ")};return o.jsx("div",{className:`screen results-screen ${c?"victory":"defeat"}`,children:o.jsxs("div",{className:"results-screen-content",children:[o.jsxs("header",{className:"results-header",children:[o.jsx("h1",{children:c?"VICTORY":"DEFEAT"}),o.jsx("p",{children:c?"System compiled successfully.":"Critical error in the mainframe."})]}),o.jsxs("div",{className:"results-body",children:[o.jsxs("div",{className:"final-score-section",children:[o.jsx("h3",{children:"Final Score"}),o.jsxs("h4",{className:"results-label results-opponent-label",children:["Opponent (",i.charAt(0).toUpperCase()+i.slice(1),")"]}),o.jsxs("div",{className:"protocol-bars-container",children:[o.jsx("div",{className:"protocol-bar opponent-bar",children:l.opponent.protocols.map((f,u)=>o.jsxs("div",{className:d("protocol-display",l.opponent.compiled[u]),children:[o.jsx("span",{className:"protocol-name",children:f}),o.jsx("span",{className:"protocol-value",children:l.opponent.laneValues[u]})]},`opp-proto-${f}-${u}`))}),o.jsx("div",{className:"protocol-bar player-bar",children:l.player.protocols.map((f,u)=>o.jsxs("div",{className:d("protocol-display",l.player.compiled[u]),children:[o.jsx("span",{className:"protocol-name",children:f}),o.jsx("span",{className:"protocol-value",children:l.player.laneValues[u]})]},`player-proto-${f}-${u}`))})]}),o.jsx("h4",{className:"results-label results-player-label",children:"Player"})]}),o.jsxs("div",{className:"stats-section",children:[o.jsx("h3",{children:"Statistics"}),o.jsxs("div",{className:"stats-grid",children:[o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-item-label",children:"Cards Played"}),o.jsx("span",{className:"stat-item-value opponent",children:l.stats.opponent.cardsPlayed}),o.jsx("span",{className:"stat-item-value player",children:l.stats.player.cardsPlayed})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-item-label",children:"Cards Drawn"}),o.jsx("span",{className:"stat-item-value opponent",children:l.stats.opponent.cardsDrawn}),o.jsx("span",{className:"stat-item-value player",children:l.stats.player.cardsDrawn})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-item-label",children:"Cards Discarded"}),o.jsx("span",{className:"stat-item-value opponent",children:l.stats.opponent.cardsDiscarded}),o.jsx("span",{className:"stat-item-value player",children:l.stats.player.cardsDiscarded})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-item-label",children:"Cards Deleted"}),o.jsx("span",{className:"stat-item-value opponent",children:l.stats.opponent.cardsDeleted}),o.jsx("span",{className:"stat-item-value player",children:l.stats.player.cardsDeleted})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-item-label",children:"Cards Flipped"}),o.jsx("span",{className:"stat-item-value opponent",children:l.stats.opponent.cardsFlipped}),o.jsx("span",{className:"stat-item-value player",children:l.stats.player.cardsFlipped})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-item-label",children:"Cards Shifted"}),o.jsx("span",{className:"stat-item-value opponent",children:l.stats.opponent.cardsShifted}),o.jsx("span",{className:"stat-item-value player",children:l.stats.player.cardsShifted})]})]})]})]}),o.jsx("button",{className:"btn",onClick:a,children:"Play Again"})]})})}function Rb({onBack:a}){const[t,l]=se.useState(0);se.useEffect(()=>{Yl(),l(b=>b+1)},[]);const i=se.useMemo(()=>{console.log("[Card Library] Loading cards, refreshKey:",t);const b=Gd(),j=qo(),C=sr(),R=new Set(C.filter(L=>Qr(L)).map(L=>L.name)),F=j.filter(L=>R.has(L.protocol)||b);return console.log("[Card Library] Total cards:",F.length,"(custom enabled:",b,")"),F},[t]),c=se.useMemo(()=>{const b=new Set(i.map(j=>j.protocol));return Array.from(b).sort()},[i]),[d,f]=se.useState(null),u=se.useMemo(()=>{const b=new Set(i.map(j=>j.category));return Array.from(b).sort()},[i]),[p,m]=se.useState(()=>new Set(u));se.useEffect(()=>{i.length>0&&!d&&f(i[0])},[i,d]);const y=b=>{m(j=>{const C=new Set(j);return C.has(b)?C.delete(b):C.add(b),C})},v=b=>{const j=i.find(C=>C.protocol===b);return(j==null?void 0:j.category)||""},x=se.useMemo(()=>c.filter(b=>{const j=v(b);return p.has(j)}),[c,p,i]),w=se.useMemo(()=>{const b={};for(const j of i)b[j.protocol]||(b[j.protocol]=[]),b[j.protocol].push(j);for(const j in b)b[j].sort((C,R)=>C.value-R.value);return b},[i]),S=b=>{f(b)},E=()=>{if(!d)return null;const b={...d,id:"preview",isFaceUp:!0};return o.jsx(bt,{card:b,isFaceUp:!0})};return o.jsxs("div",{className:"screen card-library-screen",children:[o.jsx(Cc,{title:"Card Library",onBack:a}),o.jsxs("div",{className:"card-library-layout",children:[o.jsxs("div",{className:"game-preview-container",children:[o.jsx("h2",{children:"Card Preview"}),o.jsx("div",{className:"preview-card-area",children:E()})]}),o.jsxs("div",{className:"card-list-container",children:[o.jsx("div",{className:"category-filters",children:u.map(b=>o.jsxs("label",{className:"category-filter-item",children:[o.jsx("input",{type:"checkbox",checked:p.has(b),onChange:()=>y(b)}),o.jsx("span",{children:b})]},b))}),x.map(b=>o.jsxs("div",{className:"protocol-group",children:[o.jsxs("h3",{children:[b,o.jsxs("span",{className:"protocol-category-label",children:[" (",v(b),")"]})]}),o.jsx("div",{className:"protocol-card-grid",children:w[b].map(j=>{const C={...j,id:`${j.protocol}-${j.value}`,isFaceUp:!0};return o.jsx(bt,{card:C,isFaceUp:!0,additionalClassName:"in-hand",onPointerEnter:()=>S(j),onPointerDown:()=>S(j)},C.id)})})]},b))]})]})]})}function Tb({onBack:a}){const[t,l]=se.useState(()=>Vd()),[i,c]=se.useState(!1),d=db(t),f=ub(t),u=pb(t),p=fb(t),m=hb(t),y=mb(t),v=yb(t),[x,w]=se.useState(null),S=()=>{ob(),l(Vd()),c(!1)},E=W=>{w(K=>K===W?null:W)},b=t.global.totalGamesPlayed,j=t.actions.detailedStats,C=W=>b>0?(W/b).toFixed(1):"0.0",R=(W,K)=>K>0?(W/K).toFixed(1):"0.0",F=j.cardsDrawn.playerFromRefresh+j.cardsDrawn.playerFromEffect,L=j.cardsDrawn.aiFromRefresh+j.cardsDrawn.aiFromEffect,O=F+L,T=j.cardsPlayed.playerFromHand+j.cardsPlayed.playerFromEffect,G=j.cardsPlayed.aiFromHand+j.cardsPlayed.aiFromEffect,V=T+G,z=j.compiles.playerFirstCompile+j.compiles.playerRecompile,U=j.compiles.aiFirstCompile+j.compiles.aiRecompile,k=z+U,A=j.discards.player+j.discards.ai,I=j.deletes.player+j.deletes.ai,$=j.flips.player+j.flips.ai,q=j.shifts.player+j.shifts.ai,M=j.returns.player+j.returns.ai,B=j.refreshes.player+j.refreshes.ai;return o.jsxs("div",{className:"screen statistics-screen",children:[o.jsx(Cc,{title:"STATISTICS",onBack:a}),o.jsxs("div",{className:"stats-content",children:[o.jsxs("section",{className:"stats-section",children:[o.jsx("h2",{className:"section-title",children:"Overview"}),o.jsxs("div",{className:"stats-grid",children:[o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Games Played"}),o.jsx("span",{className:"stat-value",children:t.global.totalGamesPlayed})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Win Rate"}),o.jsxs("span",{className:"stat-value",children:[d.toFixed(1),"%"]})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Games Won"}),o.jsx("span",{className:"stat-value win",children:t.global.totalGamesWon})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Games Lost"}),o.jsx("span",{className:"stat-value loss",children:t.global.totalGamesLost})]})]})]}),o.jsxs("section",{className:"stats-section",children:[o.jsx("h2",{className:"section-title",children:"Streaks"}),o.jsxs("div",{className:"stats-grid",children:[o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Current Streak"}),o.jsx("span",{className:`stat-value ${t.global.currentStreak>0?"win":t.global.currentStreak<0?"loss":""}`,children:t.global.currentStreak>0?`+${t.global.currentStreak}`:t.global.currentStreak})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Best Win Streak"}),o.jsx("span",{className:"stat-value win",children:t.global.longestWinStreak})]})]})]}),o.jsxs("section",{className:"stats-section",children:[o.jsx("h2",{className:"section-title",children:"Playtime"}),o.jsxs("div",{className:"stats-grid",children:[o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Total Playtime"}),o.jsx("span",{className:"stat-value",children:Bl(t.global.totalPlaytime)})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Average Game"}),o.jsx("span",{className:"stat-value",children:Bl(f)})]}),t.global.fastestWin&&o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Fastest Win"}),o.jsx("span",{className:"stat-value",children:Bl(t.global.fastestWin)})]}),t.global.longestGame&&o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Longest Game"}),o.jsx("span",{className:"stat-value",children:Bl(t.global.longestGame)})]}),t.global.lastGameDuration&&o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Last Game"}),o.jsx("span",{className:"stat-value",children:Bl(t.global.lastGameDuration)})]})]})]}),o.jsxs("section",{className:"stats-section",children:[o.jsx("h2",{className:"section-title",children:"AI Performance"}),o.jsx("div",{className:"ai-stats",children:["easy","normal","hard"].map(W=>{const K=t.aiDifficulty[W],D=K.played>0?K.wins/K.played*100:0;return o.jsxs("div",{className:"ai-item",children:[o.jsx("span",{className:"ai-name",children:W}),o.jsxs("span",{className:"ai-record",children:[o.jsxs("span",{className:"win",children:[K.wins,"W"]})," - ",o.jsxs("span",{className:"loss",children:[K.losses,"L"]})]}),o.jsxs("span",{className:"ai-winrate",children:["(",D.toFixed(1),"%)"]})]},W)})})]}),p.length>0&&o.jsxs("section",{className:"stats-section",children:[o.jsx("h2",{className:"section-title",children:"Best Win Rate"}),o.jsx("div",{className:"protocol-list",children:p.map((W,K)=>o.jsxs("div",{className:"protocol-item",children:[o.jsxs("span",{className:"protocol-rank",children:[K+1,"."]}),o.jsx("span",{className:"protocol-name",children:W.protocol}),o.jsxs("span",{className:"protocol-stats win",children:[W.winRate.toFixed(0),"%  ",W.timesUsed]})]},W.protocol))})]}),u.length>0&&o.jsxs("section",{className:"stats-section",children:[o.jsx("h2",{className:"section-title",children:"Favorite Protocols"}),o.jsx("div",{className:"protocol-list",children:u.map((W,K)=>o.jsxs("div",{className:"protocol-item",children:[o.jsxs("span",{className:"protocol-rank",children:[K+1,"."]}),o.jsx("span",{className:"protocol-name",children:W.protocol}),o.jsxs("span",{className:"protocol-stats",children:[W.timesUsed,"  ",W.winRate.toFixed(0),"%"]})]},W.protocol))})]}),m.length>0&&o.jsxs("section",{className:"stats-section",children:[o.jsx("h2",{className:"section-title",children:"Least Used Protocols"}),o.jsx("div",{className:"protocol-list",children:m.map((W,K)=>o.jsxs("div",{className:"protocol-item",children:[o.jsxs("span",{className:"protocol-rank",children:[K+1,"."]}),o.jsx("span",{className:"protocol-name",children:W.protocol}),o.jsxs("span",{className:"protocol-stats",children:[W.timesUsed,"  ",W.winRate.toFixed(0),"%"]})]},W.protocol))})]}),y.length>0&&o.jsxs("section",{className:"stats-section",children:[o.jsx("h2",{className:"section-title",children:"Most Played Cards"}),o.jsx("div",{className:"card-list",children:y.map((W,K)=>o.jsxs("div",{className:"card-item",children:[o.jsxs("span",{className:"card-rank",children:[K+1,"."]}),o.jsx("span",{className:"card-name",children:W.card}),o.jsxs("span",{className:"card-count",children:[W.count,""]})]},W.card))})]}),v.length>0&&o.jsxs("section",{className:"stats-section",children:[o.jsx("h2",{className:"section-title",children:"Most Deleted Cards"}),o.jsx("div",{className:"card-list",children:v.map((W,K)=>o.jsxs("div",{className:"card-item",children:[o.jsxs("span",{className:"card-rank",children:[K+1,"."]}),o.jsx("span",{className:"card-name",children:W.card}),o.jsxs("span",{className:"card-count",children:[W.count,""]})]},W.card))})]}),o.jsxs("section",{className:"stats-section",children:[o.jsx("h2",{className:"section-title",children:"Control Mechanic"}),o.jsxs("div",{className:"stats-grid",children:[o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"With Control"}),o.jsx("span",{className:"stat-value",children:t.control.gamesWithControl})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Without Control"}),o.jsx("span",{className:"stat-value",children:t.control.gamesWithoutControl})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Your Rearranges"}),o.jsx("span",{className:"stat-value",children:t.control.playerRearranges})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"AI Rearranges"}),o.jsx("span",{className:"stat-value",children:t.control.aiRearranges})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Total Rearranges"}),o.jsx("span",{className:"stat-value",children:t.control.totalRearranges})]})]})]}),o.jsxs("section",{className:"stats-section",children:[o.jsx("h2",{className:"section-title",children:"Coin Flip"}),o.jsxs("div",{className:"stats-grid",children:[o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Heads Chosen"}),o.jsxs("span",{className:"stat-value",children:[t.coinFlip.headsChosen," (",t.coinFlip.headsChosen>0?(t.coinFlip.headsWon/t.coinFlip.headsChosen*100).toFixed(0):0,"%)"]})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Tails Chosen"}),o.jsxs("span",{className:"stat-value",children:[t.coinFlip.tailsChosen," (",t.coinFlip.tailsChosen>0?(t.coinFlip.tailsWon/t.coinFlip.tailsChosen*100).toFixed(0):0,"%)"]})]})]})]}),o.jsxs("section",{className:"stats-section full-width",children:[o.jsx("h2",{className:"section-title",children:"Actions (click for details)"}),o.jsxs("div",{className:"actions-container",children:[o.jsxs("div",{className:`stat-item clickable ${x==="played"?"expanded":""}`,onClick:()=>E("played"),children:[o.jsx("span",{className:"stat-label",children:"Cards Played"}),o.jsx("span",{className:"stat-value",children:V})]}),o.jsxs("div",{className:`stat-item clickable ${x==="drawn"?"expanded":""}`,onClick:()=>E("drawn"),children:[o.jsx("span",{className:"stat-label",children:"Cards Drawn"}),o.jsx("span",{className:"stat-value",children:O})]}),o.jsxs("div",{className:`stat-item clickable ${x==="discards"?"expanded":""}`,onClick:()=>E("discards"),children:[o.jsx("span",{className:"stat-label",children:"Discards"}),o.jsx("span",{className:"stat-value",children:A})]}),o.jsxs("div",{className:`stat-item clickable ${x==="deletes"?"expanded":""}`,onClick:()=>E("deletes"),children:[o.jsx("span",{className:"stat-label",children:"Deletes"}),o.jsx("span",{className:"stat-value",children:I})]}),o.jsxs("div",{className:`stat-item clickable ${x==="flips"?"expanded":""}`,onClick:()=>E("flips"),children:[o.jsx("span",{className:"stat-label",children:"Flips"}),o.jsx("span",{className:"stat-value",children:$})]}),o.jsxs("div",{className:`stat-item clickable ${x==="shifts"?"expanded":""}`,onClick:()=>E("shifts"),children:[o.jsx("span",{className:"stat-label",children:"Shifts"}),o.jsx("span",{className:"stat-value",children:q})]}),o.jsxs("div",{className:`stat-item clickable ${x==="returns"?"expanded":""}`,onClick:()=>E("returns"),children:[o.jsx("span",{className:"stat-label",children:"Returns"}),o.jsx("span",{className:"stat-value",children:M})]}),o.jsxs("div",{className:`stat-item clickable ${x==="compiles"?"expanded":""}`,onClick:()=>E("compiles"),children:[o.jsx("span",{className:"stat-label",children:"Compiles"}),o.jsx("span",{className:"stat-value",children:k})]}),o.jsxs("div",{className:`stat-item clickable ${x==="refreshes"?"expanded":""}`,onClick:()=>E("refreshes"),children:[o.jsx("span",{className:"stat-label",children:"Refreshes"}),o.jsx("span",{className:"stat-value",children:B})]})]}),x==="played"&&o.jsxs("div",{className:"action-details-section",children:[o.jsx("h3",{className:"section-title",children:"Cards Played"}),o.jsxs("div",{className:"action-details-total",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:V})]}),o.jsxs("div",{className:"action-details-columns",children:[o.jsxs("div",{className:"action-details-column player",children:[o.jsx("div",{className:"column-header",children:"Player"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:T})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"From Hand"}),o.jsx("span",{className:"detail-value",children:j.cardsPlayed.playerFromHand})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"From Effect"}),o.jsx("span",{className:"detail-value",children:j.cardsPlayed.playerFromEffect})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Face-Up"}),o.jsx("span",{className:"detail-value",children:j.cardsPlayed.playerFaceUp})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Face-Down"}),o.jsx("span",{className:"detail-value",children:j.cardsPlayed.playerFaceDown})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:C(T)})]})]}),o.jsxs("div",{className:"action-details-column ai",children:[o.jsx("div",{className:"column-header",children:"AI"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:G})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"From Hand"}),o.jsx("span",{className:"detail-value",children:j.cardsPlayed.aiFromHand})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"From Effect"}),o.jsx("span",{className:"detail-value",children:j.cardsPlayed.aiFromEffect})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Face-Up"}),o.jsx("span",{className:"detail-value",children:j.cardsPlayed.aiFaceUp})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Face-Down"}),o.jsx("span",{className:"detail-value",children:j.cardsPlayed.aiFaceDown})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:C(G)})]})]})]})]}),x==="drawn"&&o.jsxs("div",{className:"action-details-section",children:[o.jsx("h3",{className:"section-title",children:"Cards Drawn"}),o.jsxs("div",{className:"action-details-total",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:O})]}),o.jsxs("div",{className:"action-details-columns",children:[o.jsxs("div",{className:"action-details-column player",children:[o.jsx("div",{className:"column-header",children:"Player"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:F})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"From Refresh"}),o.jsx("span",{className:"detail-value",children:j.cardsDrawn.playerFromRefresh})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"From Effect"}),o.jsx("span",{className:"detail-value",children:j.cardsDrawn.playerFromEffect})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:C(F)})]})]}),o.jsxs("div",{className:"action-details-column ai",children:[o.jsx("div",{className:"column-header",children:"AI"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:L})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"From Refresh"}),o.jsx("span",{className:"detail-value",children:j.cardsDrawn.aiFromRefresh})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"From Effect"}),o.jsx("span",{className:"detail-value",children:j.cardsDrawn.aiFromEffect})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:C(L)})]})]})]})]}),x==="discards"&&o.jsxs("div",{className:"action-details-section",children:[o.jsx("h3",{className:"section-title",children:"Discards"}),o.jsxs("div",{className:"action-details-total",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:A})]}),o.jsxs("div",{className:"action-details-columns",children:[o.jsxs("div",{className:"action-details-column player",children:[o.jsx("div",{className:"column-header",children:"Player"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:j.discards.player})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:C(j.discards.player)})]})]}),o.jsxs("div",{className:"action-details-column ai",children:[o.jsx("div",{className:"column-header",children:"AI"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:j.discards.ai})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:C(j.discards.ai)})]})]})]})]}),x==="deletes"&&o.jsxs("div",{className:"action-details-section",children:[o.jsx("h3",{className:"section-title",children:"Deletes"}),o.jsxs("div",{className:"action-details-total",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:I})]}),o.jsxs("div",{className:"action-details-columns",children:[o.jsxs("div",{className:"action-details-column player",children:[o.jsx("div",{className:"column-header",children:"Player"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:j.deletes.player})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:C(j.deletes.player)})]})]}),o.jsxs("div",{className:"action-details-column ai",children:[o.jsx("div",{className:"column-header",children:"AI"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:j.deletes.ai})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:C(j.deletes.ai)})]})]})]})]}),x==="flips"&&o.jsxs("div",{className:"action-details-section",children:[o.jsx("h3",{className:"section-title",children:"Flips"}),o.jsxs("div",{className:"action-details-total",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:$})]}),o.jsxs("div",{className:"action-details-columns",children:[o.jsxs("div",{className:"action-details-column player",children:[o.jsx("div",{className:"column-header",children:"Player"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:j.flips.player})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:C(j.flips.player)})]})]}),o.jsxs("div",{className:"action-details-column ai",children:[o.jsx("div",{className:"column-header",children:"AI"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:j.flips.ai})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:C(j.flips.ai)})]})]})]})]}),x==="shifts"&&o.jsxs("div",{className:"action-details-section",children:[o.jsx("h3",{className:"section-title",children:"Shifts"}),o.jsxs("div",{className:"action-details-total",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:q})]}),o.jsxs("div",{className:"action-details-columns",children:[o.jsxs("div",{className:"action-details-column player",children:[o.jsx("div",{className:"column-header",children:"Player"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:j.shifts.player})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:C(j.shifts.player)})]})]}),o.jsxs("div",{className:"action-details-column ai",children:[o.jsx("div",{className:"column-header",children:"AI"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:j.shifts.ai})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:C(j.shifts.ai)})]})]})]})]}),x==="returns"&&o.jsxs("div",{className:"action-details-section",children:[o.jsx("h3",{className:"section-title",children:"Returns"}),o.jsxs("div",{className:"action-details-total",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:M})]}),o.jsxs("div",{className:"action-details-columns",children:[o.jsxs("div",{className:"action-details-column player",children:[o.jsx("div",{className:"column-header",children:"Player"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:j.returns.player})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:C(j.returns.player)})]})]}),o.jsxs("div",{className:"action-details-column ai",children:[o.jsx("div",{className:"column-header",children:"AI"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:j.returns.ai})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:C(j.returns.ai)})]})]})]})]}),x==="compiles"&&o.jsxs("div",{className:"action-details-section",children:[o.jsx("h3",{className:"section-title",children:"Compiles"}),o.jsxs("div",{className:"action-details-total",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:k})]}),o.jsxs("div",{className:"action-details-columns",children:[o.jsxs("div",{className:"action-details-column player",children:[o.jsx("div",{className:"column-header",children:"Player"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:z})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"First-Compile"}),o.jsx("span",{className:"detail-value",children:j.compiles.playerFirstCompile})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Re-Compile"}),o.jsx("span",{className:"detail-value",children:j.compiles.playerRecompile})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:C(z)})]})]}),o.jsxs("div",{className:"action-details-column ai",children:[o.jsx("div",{className:"column-header",children:"AI"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:U})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"First-Compile"}),o.jsx("span",{className:"detail-value",children:j.compiles.aiFirstCompile})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Re-Compile"}),o.jsx("span",{className:"detail-value",children:j.compiles.aiRecompile})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:C(U)})]})]})]})]}),x==="refreshes"&&o.jsxs("div",{className:"action-details-section",children:[o.jsx("h3",{className:"section-title",children:"Refreshes"}),o.jsxs("div",{className:"action-details-total",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:B})]}),o.jsxs("div",{className:"action-details-columns",children:[o.jsxs("div",{className:"action-details-column player",children:[o.jsx("div",{className:"column-header",children:"Player"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:j.refreshes.player})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Cards / Refresh"}),o.jsx("span",{className:"detail-value",children:R(j.refreshes.playerCardsDrawn,j.refreshes.player)})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:C(j.refreshes.player)})]})]}),o.jsxs("div",{className:"action-details-column ai",children:[o.jsx("div",{className:"column-header",children:"AI"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:j.refreshes.ai})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Cards / Refresh"}),o.jsx("span",{className:"detail-value",children:R(j.refreshes.aiCardsDrawn,j.refreshes.ai)})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:C(j.refreshes.ai)})]})]})]})]})]}),o.jsx("section",{className:"stats-section reset-section",children:o.jsx("button",{className:"reset-stats-button",onClick:()=>c(!0),children:"Reset All Statistics"})})]}),i&&o.jsx("div",{className:"reset-modal-overlay",onClick:()=>c(!1),children:o.jsxs("div",{className:"reset-modal",onClick:W=>W.stopPropagation(),children:[o.jsx("h3",{children:"Reset Statistics?"}),o.jsx("p",{children:"This will permanently delete all your statistics. This action cannot be undone."}),o.jsxs("div",{className:"reset-modal-buttons",children:[o.jsx("button",{className:"cancel-button",onClick:()=>c(!1),children:"Cancel"}),o.jsx("button",{className:"confirm-reset-button",onClick:S,children:"Reset"})]})]})})]})}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Tg=({params:a,onChange:t})=>{var l,i,c,d,f;return o.jsxs("div",{className:"param-editor draw-effect-editor",children:[o.jsx("h4",{children:"Draw Effect Parameters"}),o.jsxs("label",{children:["Count Type",o.jsxs("select",{value:a.countType||"fixed",onChange:u=>{const p=u.target.value;t({...a,countType:p,countOffset:p==="equal_to_discarded"?0:void 0})},children:[o.jsx("option",{value:"fixed",children:"Fixed Amount"}),o.jsx("option",{value:"equal_to_card_value",children:"Equal to Card Value (from previous effect)"}),o.jsx("option",{value:"equal_to_discarded",children:"Equal to Discarded Cards"}),o.jsx("option",{value:"hand_size",children:"Equal to Hand Size"})]})]}),(!a.countType||a.countType==="fixed")&&o.jsxs("label",{children:["Card Count",o.jsx("input",{type:"number",min:1,max:6,value:a.count,onChange:u=>t({...a,count:parseInt(u.target.value)||1})})]}),a.countType==="equal_to_discarded"&&o.jsxs("label",{children:["Offset (+/-)",o.jsx("input",{type:"number",min:-5,max:5,value:a.countOffset||0,onChange:u=>t({...a,countOffset:parseInt(u.target.value)||0})}),o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:'Example: +1 for "discard count plus 1" (Fire-4)'})]}),o.jsxs("label",{children:["Target",o.jsxs("select",{value:a.target,onChange:u=>t({...a,target:u.target.value}),children:[o.jsx("option",{value:"self",children:"Self"}),o.jsx("option",{value:"opponent",children:"Opponent"})]})]}),o.jsxs("label",{children:["Source",o.jsxs("select",{value:a.source,onChange:u=>t({...a,source:u.target.value}),children:[o.jsx("option",{value:"own_deck",children:"Own Deck"}),o.jsx("option",{value:"opponent_deck",children:"Opponent's Deck"})]})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a.preAction==="refresh",onChange:u=>t({...a,preAction:u.target.checked?"refresh":void 0})}),"Refresh hand first (shuffle hand into deck, then draw)"]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a.optional||!1,onChange:u=>t({...a,optional:u.target.checked})}),'Optional ("You may draw" instead of "Draw")']}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a.revealFromDrawn!==void 0,onChange:u=>{if(u.target.checked)t({...a,revealFromDrawn:{valueSource:"stated_number"}});else{const{revealFromDrawn:p,...m}=a;t(m)}}}),"Reveal from Drawn Cards",o.jsx("small",{style:{display:"block",marginLeft:"24px",color:"#8A79E8"},children:"After drawing, reveal cards from the drawn pile (optionally filtered by value)."})]}),a.revealFromDrawn&&o.jsxs(o.Fragment,{children:[o.jsxs("label",{children:["Reveal Count",o.jsxs("select",{value:a.revealFromDrawn.count==="all"?"all":(a.revealFromDrawn.count||1).toString(),onChange:u=>{const p=u.target.value;t({...a,revealFromDrawn:{...a.revealFromDrawn,count:p==="all"?"all":parseInt(p)}})},children:[o.jsx("option",{value:"1",children:"1 card"}),o.jsx("option",{value:"2",children:"2 cards"}),o.jsx("option",{value:"3",children:"3 cards"}),o.jsx("option",{value:"all",children:"All matching cards"})]})]}),o.jsxs("label",{children:["Value Filter",o.jsxs("select",{value:a.revealFromDrawn.valueSource||"stated_number",onChange:u=>t({...a,revealFromDrawn:{...a.revealFromDrawn,valueSource:u.target.value}}),children:[o.jsx("option",{value:"stated_number",children:"Stated Number (requires state_number before)"}),o.jsx("option",{value:"any",children:"Any (no filter)"})]})]}),o.jsxs("label",{children:["After Reveal",o.jsxs("select",{value:a.revealFromDrawn.thenAction||"",onChange:u=>{if(u.target.value===""){const{thenAction:p,...m}=a.revealFromDrawn;t({...a,revealFromDrawn:m})}else t({...a,revealFromDrawn:{...a.revealFromDrawn,thenAction:u.target.value}})},children:[o.jsx("option",{value:"",children:"None"}),o.jsx("option",{value:"may_play",children:'May Play ("You may play it")'})]})]})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a.valueFilter!==void 0,onChange:u=>{if(u.target.checked)t({...a,valueFilter:{equals:1}});else{const{valueFilter:p,...m}=a;t(m)}}}),'Draw specific value only (e.g., "Draw 1 card with a value of X")']}),a.valueFilter!==void 0&&o.jsxs(o.Fragment,{children:[o.jsxs("label",{children:["Card Value to Draw",o.jsx("input",{type:"number",min:0,max:5,value:((l=a.valueFilter)==null?void 0:l.equals)??1,onChange:u=>t({...a,valueFilter:{equals:parseInt(u.target.value)||0}})}),o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"Only draws cards with this exact value from the deck"})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a.fromRevealed||!1,onChange:u=>t({...a,fromRevealed:u.target.checked})}),'From revealed deck ("revealed this way" - player selects)',o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:'Requires "Reveal your deck" effect before this. Player picks from revealed cards.'})]})]}),o.jsxs("label",{children:["Conditional",o.jsxs("select",{value:((i=a.conditional)==null?void 0:i.type)||"none",onChange:u=>{if(u.target.value==="none"){const{conditional:p,...m}=a;t(m)}else t({...a,conditional:{type:u.target.value}})},children:[o.jsx("option",{value:"none",children:"None"}),o.jsx("option",{value:"count_face_down",children:"1 per face-down card (all on board)"}),o.jsx("option",{value:"is_covering",children:"Only if this card is covering another"}),o.jsx("option",{value:"non_matching_protocols",children:"1 per line with non-matching protocol"})]})]}),o.jsxs("label",{children:["Advanced Conditional",o.jsxs("select",{value:((c=a.advancedConditional)==null?void 0:c.type)||"none",onChange:u=>{if(u.target.value==="none"){const{advancedConditional:p,...m}=a;t(m)}else u.target.value==="protocol_match"?t({...a,advancedConditional:{type:"protocol_match",protocol:""}}):u.target.value==="compile_block"?t({...a,advancedConditional:{type:"compile_block",turnDuration:1}}):u.target.value==="empty_hand"?t({...a,advancedConditional:{type:"empty_hand"}}):u.target.value==="opponent_higher_value_in_lane"&&t({...a,advancedConditional:{type:"opponent_higher_value_in_lane"}})},children:[o.jsx("option",{value:"none",children:"None"}),o.jsx("option",{value:"protocol_match",children:"Only if in line with matching protocol"}),o.jsx("option",{value:"compile_block",children:"Block opponent's compile next turn"}),o.jsx("option",{value:"empty_hand",children:"Only if hand is empty"}),o.jsx("option",{value:"opponent_higher_value_in_lane",children:"Only if opponent has higher value in this lane"})]})]}),((d=a.advancedConditional)==null?void 0:d.type)==="protocol_match"&&o.jsxs("label",{children:["Required Protocol",o.jsx("input",{type:"text",placeholder:"e.g., Fire, Water, Lightning",value:a.advancedConditional.protocol||"",onChange:u=>t({...a,advancedConditional:{...a.advancedConditional,type:"protocol_match",protocol:u.target.value}})}),o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"Only draw if this card is in a line with this protocol"})]}),((f=a.advancedConditional)==null?void 0:f.type)==="compile_block"&&o.jsxs("label",{children:["Block Duration (turns)",o.jsx("input",{type:"number",min:1,max:3,value:a.advancedConditional.turnDuration||1,onChange:u=>t({...a,advancedConditional:{...a.advancedConditional,type:"compile_block",turnDuration:parseInt(u.target.value)||1}})}),o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"Opponent can't compile for this many turns"})]})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Ab=({params:a,onChange:t})=>o.jsxs("div",{className:"param-editor refresh-effect-editor",children:[o.jsx("h4",{children:"Refresh Effect Parameters"}),o.jsx("p",{className:"effect-description",children:'Refresh fills the hand to 5 cards (Spirit-0: "Refresh.")'}),o.jsxs("label",{children:["Target",o.jsxs("select",{value:a.target||"self",onChange:l=>t({...a,target:l.target.value}),children:[o.jsx("option",{value:"self",children:"Self"}),o.jsx("option",{value:"opponent",children:"Opponent"})]})]})]});/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Db=({params:a,onChange:t})=>o.jsxs("div",{className:"param-editor mutual-draw-effect-editor",children:[o.jsx("h4",{children:"Mutual Draw Effect Parameters"}),o.jsx("p",{className:"effect-description",children:`Both players draw from each other's decks (Chaos-0: "Draw the top card of your opponent's deck. Your opponent draws the top card of your deck.")`}),o.jsxs("label",{children:["Count",o.jsx("input",{type:"number",min:"1",max:"10",value:a.count||1,onChange:l=>t({...a,count:parseInt(l.target.value)||1})})]})]});/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Ag=({params:a,onChange:t})=>{var c,d,f;const l=a.targetFilter||{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1},i=a.count??1;return o.jsxs("div",{className:"param-editor flip-effect-editor",children:[o.jsx("h4",{children:"Flip Effect Parameters"}),o.jsxs("label",{children:["Card Count/Scope",o.jsxs("select",{value:i==="all"?"all":i==="each"?"each":i.toString(),onChange:u=>{const p=u.target.value;t(p==="all"?{...a,count:"all"}:p==="each"?{...a,count:"each"}:{...a,count:parseInt(p)})},children:[o.jsx("option",{value:"1",children:"1 card"}),o.jsx("option",{value:"2",children:"2 cards"}),o.jsx("option",{value:"3",children:"3 cards"}),o.jsx("option",{value:"all",children:"All matching cards"}),o.jsx("option",{value:"each",children:"Each matching card"})]})]}),typeof a.count=="number"&&o.jsxs("label",{children:["Scope",o.jsxs("select",{value:a.scope||"any",onChange:u=>t({...a,scope:u.target.value}),children:[o.jsx("option",{value:"any",children:"Any lane"}),o.jsx("option",{value:"this_lane",children:"This lane only"}),o.jsx("option",{value:"each_lane",children:'Each lane (Chaos-0: "In each line...")'})]})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a.optional,onChange:u=>t({...a,optional:u.target.checked})}),'Optional ("May flip" instead of "Flip")']}),a.count==="each"&&o.jsxs("label",{children:["Each Line Scope",o.jsxs("select",{value:a.eachLineScope||"all_lines",onChange:u=>t({...a,eachLineScope:u.target.value}),children:[o.jsx("option",{value:"all_lines",children:"Each card on board"}),o.jsx("option",{value:"each_line",children:"1 card in each line"})]})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a.flipSelf||!1,onChange:u=>t({...a,flipSelf:u.target.checked})}),"Flip ONLY this card (no target selection)",o.jsx("small",{style:{display:"block",marginLeft:"24px",color:"#8A79E8"},children:"The card flips itself, ignoring count and target filter."})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a.selfFlipAfter||!1,onChange:u=>t({...a,selfFlipAfter:u.target.checked})}),"ALSO flip this card after flipping targets",o.jsx("small",{style:{display:"block",marginLeft:"24px",color:"#8A79E8"},children:"After flipping target(s), also flip this card as bonus."})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a.skipMiddleCommand||!1,onChange:u=>t({...a,skipMiddleCommand:u.target.checked})}),"Skip Middle Command",o.jsx("small",{style:{display:"block",marginLeft:"24px",color:"#8A79E8"},children:"Flip the card but ignore its middle commands."})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a.sameLaneAsFirst||!1,onChange:u=>t({...a,sameLaneAsFirst:u.target.checked})}),"Same Lane as First Flip",o.jsx("small",{style:{display:"block",marginLeft:"24px",color:"#8A79E8"},children:"Follow-up flip must target the same lane as the previous flip."})]}),o.jsx("h5",{children:"Advanced Conditional"}),o.jsxs("label",{children:["Conditional Type",o.jsxs("select",{value:((c=a.advancedConditional)==null?void 0:c.type)||"",onChange:u=>{if(u.target.value===""){const{advancedConditional:p,...m}=a;t(m)}else u.target.value==="protocol_match"?t({...a,advancedConditional:{type:"protocol_match",protocol:""}}):u.target.value==="hand_size_greater_than"?t({...a,advancedConditional:{type:"hand_size_greater_than",threshold:1}}):t({...a,advancedConditional:{type:u.target.value}})},children:[o.jsx("option",{value:"",children:"None"}),o.jsx("option",{value:"protocol_match",children:"Only if in specific protocol line"}),o.jsx("option",{value:"opponent_higher_value_in_lane",children:"Only if opponent has higher value in this lane"}),o.jsx("option",{value:"hand_size_greater_than",children:"Only if hand size greater than X"})]})]}),((d=a.advancedConditional)==null?void 0:d.type)==="protocol_match"&&o.jsxs("label",{children:["Required Protocol",o.jsx("input",{type:"text",value:a.advancedConditional.protocol||"",onChange:u=>t({...a,advancedConditional:{...a.advancedConditional,protocol:u.target.value}}),placeholder:"e.g., Anarchy, Fire, Death"})]}),((f=a.advancedConditional)==null?void 0:f.type)==="hand_size_greater_than"&&o.jsxs("label",{children:["Hand Size Threshold (more than X cards)",o.jsx("input",{type:"number",min:"0",max:"10",value:a.advancedConditional.threshold??1,onChange:u=>t({...a,advancedConditional:{...a.advancedConditional,threshold:parseInt(u.target.value)||0}})}),o.jsx("small",{style:{display:"block",color:"#8A79E8"},children:"Effect only triggers if you have MORE than this many cards in hand."})]}),o.jsx("h5",{children:"Target Filter"}),o.jsxs("label",{children:["Owner",o.jsxs("select",{value:l.owner,onChange:u=>t({...a,targetFilter:{...l,owner:u.target.value}}),children:[o.jsx("option",{value:"any",children:"Any"}),o.jsx("option",{value:"own",children:"Own"}),o.jsx("option",{value:"opponent",children:"Opponent"})]})]}),o.jsxs("label",{children:["Position",o.jsxs("select",{value:l.position,onChange:u=>t({...a,targetFilter:{...l,position:u.target.value}}),children:[o.jsx("option",{value:"any",children:"Any"}),o.jsx("option",{value:"uncovered",children:"Uncovered (top card)"}),o.jsx("option",{value:"covered",children:"Covered"}),o.jsx("option",{value:"covered_in_this_line",children:"Covered in this line"})]})]}),o.jsxs("label",{children:["Face State",o.jsxs("select",{value:l.faceState,onChange:u=>t({...a,targetFilter:{...l,faceState:u.target.value}}),children:[o.jsx("option",{value:"any",children:"Any"}),o.jsx("option",{value:"face_up",children:"Face-up"}),o.jsx("option",{value:"face_down",children:"Face-down"})]})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:l.excludeSelf,onChange:u=>t({...a,targetFilter:{...l,excludeSelf:u.target.checked}})}),'Exclude self ("other cards")']}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:l.valueMinGreaterThanHandSize||!1,onChange:u=>t({...a,targetFilter:{...l,valueMinGreaterThanHandSize:u.target.checked}})}),"Value Greater Than Hand Size",o.jsx("small",{style:{display:"block",marginLeft:"24px",color:"#8A79E8"},children:"Target must have value greater than the number of cards in your hand."})]})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Dg=({params:a,onChange:t})=>{var i,c,d;const l=a.targetFilter||{owner:"any",position:"uncovered",faceState:"any"};return o.jsxs("div",{className:"param-editor",children:[o.jsx("h4",{children:"Shift Effect"}),o.jsxs("label",{children:["Count/Scope",o.jsxs("select",{value:a.count==="all"?"all":"1",onChange:f=>{if(f.target.value==="all")t({...a,count:"all"});else{const{count:u,...p}=a;t(p)}},children:[o.jsx("option",{value:"1",children:"1 card"}),o.jsx("option",{value:"all",children:"All matching cards"})]})]}),o.jsxs("label",{children:["Target Owner",o.jsxs("select",{value:l.owner||"any",onChange:f=>t({...a,targetFilter:{...l,owner:f.target.value}}),children:[o.jsx("option",{value:"any",children:"Any"}),o.jsx("option",{value:"own",children:"Own"}),o.jsx("option",{value:"opponent",children:"Opponent"})]})]}),o.jsxs("label",{children:["Position",o.jsxs("select",{value:l.position||"uncovered",onChange:f=>t({...a,targetFilter:{...l,position:f.target.value}}),children:[o.jsx("option",{value:"any",children:"Any"}),o.jsx("option",{value:"uncovered",children:"Uncovered"}),o.jsx("option",{value:"covered",children:"Covered"})]})]}),o.jsxs("label",{children:["Face State",o.jsxs("select",{value:l.faceState||"any",onChange:f=>t({...a,targetFilter:{...l,faceState:f.target.value}}),children:[o.jsx("option",{value:"any",children:"Any"}),o.jsx("option",{value:"face_up",children:"Face-up"}),o.jsx("option",{value:"face_down",children:"Face-down"})]})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:l.excludeSelf||!1,onChange:f=>t({...a,targetFilter:{...l,excludeSelf:f.target.checked}})}),'Exclude self ("other card")']}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a.optional||!1,onChange:f=>t({...a,optional:f.target.checked})}),'Optional ("You may shift" instead of "Shift")']}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a.shiftSelf||!1,onChange:f=>t({...a,shiftSelf:f.target.checked})}),"Shift this card (instead of selecting target)",o.jsx("small",{style:{display:"block",marginLeft:"24px",color:"#8A79E8"},children:"The card shifts itself, ignoring target filter."})]}),o.jsx("h5",{children:"Advanced Conditional"}),o.jsxs("label",{children:["Conditional Type",o.jsxs("select",{value:((i=a.advancedConditional)==null?void 0:i.type)||"none",onChange:f=>{if(f.target.value==="none"){const{advancedConditional:u,...p}=a;t(p)}else t({...a,advancedConditional:{type:f.target.value}})},children:[o.jsx("option",{value:"none",children:"None"}),o.jsx("option",{value:"empty_hand",children:"Only if hand is empty"}),o.jsx("option",{value:"opponent_higher_value_in_lane",children:"Only if opponent has higher value in this lane"}),o.jsx("option",{value:"this_card_is_covered",children:"Only if this card is covered"})]})]}),o.jsxs("label",{children:["Destination",o.jsxs("select",{value:((c=a.destinationRestriction)==null?void 0:c.type)||"any",onChange:f=>{if(f.target.value==="any"){const{destinationRestriction:u,...p}=a;t(p)}else t({...a,destinationRestriction:{type:f.target.value}})},children:[o.jsx("option",{value:"any",children:"Any line"}),o.jsx("option",{value:"to_another_line",children:"To another line"}),o.jsx("option",{value:"non_matching_protocol",children:"Non-matching protocol"}),o.jsx("option",{value:"specific_lane",children:"This line (within)"}),o.jsx("option",{value:"to_this_lane",children:"To THIS lane only"}),o.jsx("option",{value:"to_or_from_this_lane",children:"To OR from this lane"}),o.jsx("option",{value:"opponent_highest_value_lane",children:"To opponent's highest value lane"})]}),((d=a.destinationRestriction)==null?void 0:d.type)==="opponent_highest_value_lane"&&o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"Card can only be shifted to the lane where opponent has highest total value."})]}),o.jsxs("label",{children:["Source Scope",o.jsxs("select",{value:a.scope||"any",onChange:f=>{if(f.target.value==="any"){const{scope:u,...p}=a;t(p)}else t({...a,scope:f.target.value})},children:[o.jsx("option",{value:"any",children:"Any lane (select from all lanes)"}),o.jsx("option",{value:"this_lane",children:"This line only"}),o.jsx("option",{value:"each_lane",children:"Each lane (execute per lane)"})]}),a.scope==="this_lane"&&o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"Only cards in this line can be selected as shift targets."})]})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Fg=({params:a,onChange:t})=>{var i,c,d,f,u,p,m,y;const l=a.targetFilter||{position:"uncovered",faceState:"any"};return o.jsxs("div",{className:"param-editor delete-effect-editor",children:[o.jsx("h4",{children:"Delete Effect Parameters"}),o.jsxs("label",{children:["Anzahl",o.jsxs("select",{value:typeof a.count=="number"?a.count.toString():"all",onChange:v=>t({...a,count:v.target.value==="all"?"all_in_lane":parseInt(v.target.value)}),children:[o.jsx("option",{value:"1",children:"1"}),o.jsx("option",{value:"2",children:"2"}),o.jsx("option",{value:"3",children:"3"}),o.jsx("option",{value:"all",children:"All in a lane"})]})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a.excludeSelf,onChange:v=>t({...a,excludeSelf:v.target.checked})}),"Exclude self (other cards only)"]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a.deleteSelf||!1,onChange:v=>t({...a,deleteSelf:v.target.checked})}),"Delete this card (ignores all other settings)"]}),o.jsx("h5",{children:"Target Filter"}),o.jsxs("label",{children:["Position",o.jsxs("select",{value:l.position,onChange:v=>t({...a,targetFilter:{...l,position:v.target.value}}),children:[o.jsx("option",{value:"any",children:"Any"}),o.jsx("option",{value:"uncovered",children:"Uncovered"}),o.jsx("option",{value:"covered",children:"Covered"})]})]}),o.jsxs("label",{children:["Face State",o.jsxs("select",{value:l.faceState,onChange:v=>t({...a,targetFilter:{...l,faceState:v.target.value}}),children:[o.jsx("option",{value:"any",children:"Any"}),o.jsx("option",{value:"face_up",children:"Face-up"}),o.jsx("option",{value:"face_down",children:"Face-down"})]})]}),o.jsxs("label",{children:["Owner",o.jsxs("select",{value:l.owner||"any",onChange:v=>{const x=v.target.value,w={...l};x==="any"?delete w.owner:w.owner=x,t({...a,targetFilter:w})},children:[o.jsx("option",{value:"any",children:"Any (own or opponent)"}),o.jsx("option",{value:"own",children:"Own cards only"}),o.jsx("option",{value:"opponent",children:"Opponent's cards only"})]})]}),o.jsxs("label",{children:["Calculation",o.jsxs("select",{value:l.calculation||"none",onChange:v=>{const x=v.target.value,w={...l};x==="none"?delete w.calculation:w.calculation=x,t({...a,targetFilter:w})},children:[o.jsx("option",{value:"none",children:"None"}),o.jsx("option",{value:"highest_value",children:"Highest value"}),o.jsx("option",{value:"lowest_value",children:"Lowest value"})]})]}),o.jsxs("label",{children:["Value Range (specific values to target)",o.jsxs("select",{value:l.valueRange?`${l.valueRange.min}-${l.valueRange.max}`:"none",onChange:v=>{const x=v.target.value,w={...l};x==="none"?delete w.valueRange:x==="0-1"?w.valueRange={min:0,max:1}:x==="1-2"?w.valueRange={min:1,max:2}:x==="0-0"&&(w.valueRange={min:0,max:0}),t({...a,targetFilter:w})},children:[o.jsx("option",{value:"none",children:"Any value"}),o.jsx("option",{value:"0-0",children:"Value 0 only"}),o.jsx("option",{value:"0-1",children:"Values 0 or 1"}),o.jsx("option",{value:"1-2",children:"Values 1 or 2"})]})]}),o.jsxs("label",{children:["Value Source (dynamic value from previous effect)",o.jsxs("select",{value:l.valueSource||"none",onChange:v=>{const x=v.target.value,w={...l};x==="none"?delete w.valueSource:w.valueSource=x,t({...a,targetFilter:w})},children:[o.jsx("option",{value:"none",children:"None (use value range above)"}),o.jsx("option",{value:"previous_effect_card",children:"Previous Effect Card Value"})]}),l.valueSource==="previous_effect_card"&&o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"Delete cards that share the value with the card from the previous effect."})]}),o.jsx("h5",{children:"Scope"}),o.jsxs("label",{children:["Lane Scope",o.jsxs("select",{value:((i=a.scope)==null?void 0:i.type)||"any",onChange:v=>{const x=v.target.value;if(x==="any"){const{scope:w,...S}=a;t(S)}else t({...a,scope:{type:x}})},children:[o.jsx("option",{value:"any",children:"Any lane"}),o.jsx("option",{value:"this_line",children:"This line only"}),o.jsx("option",{value:"other_lanes",children:"Other lanes"}),o.jsx("option",{value:"each_other_line",children:"Each other line (1 per line)"}),o.jsx("option",{value:"each_lane",children:"Each lane (flexible, 1 per line)"})]})]}),(((c=a.scope)==null?void 0:c.type)==="other_lanes"||((d=a.scope)==null?void 0:d.type)==="any")&&o.jsxs("label",{children:["Minimum Cards in Lane",o.jsxs("select",{value:((f=a.scope)==null?void 0:f.minCardsInLane)||0,onChange:v=>{const x=parseInt(v.target.value);if(x===0){const w={...a.scope};delete w.minCardsInLane,t({...a,scope:w})}else t({...a,scope:{...a.scope,minCardsInLane:x}})},children:[o.jsx("option",{value:0,children:"No minimum"}),o.jsx("option",{value:8,children:"8 or more cards (Metal-3)"}),o.jsx("option",{value:6,children:"6 or more cards"}),o.jsx("option",{value:4,children:"4 or more cards"})]}),((u=a.scope)==null?void 0:u.minCardsInLane)&&o.jsxs("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:["Only delete from lanes with ",a.scope.minCardsInLane,"+ cards total."]})]}),o.jsxs("label",{children:["Who Chooses Target?",o.jsxs("select",{value:a.actorChooses||"effect_owner",onChange:v=>{const x=v.target.value;if(x==="effect_owner"){const{actorChooses:w,...S}=a;t(S)}else t({...a,actorChooses:x})},children:[o.jsx("option",{value:"effect_owner",children:"Effect owner chooses (default)"}),o.jsx("option",{value:"card_owner",children:"Card owner chooses (Plague-4: opponent deletes their own)"})]}),a.actorChooses==="card_owner"&&o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"The owner of the targeted card chooses which card to delete."})]}),o.jsx("h5",{children:"Advanced Conditional"}),o.jsxs("label",{children:["Conditional Type",o.jsxs("select",{value:((p=a.advancedConditional)==null?void 0:p.type)||"none",onChange:v=>{if(v.target.value==="none"){const{advancedConditional:x,...w}=a;t(w)}else t({...a,advancedConditional:{type:v.target.value}})},children:[o.jsx("option",{value:"none",children:"None"}),o.jsx("option",{value:"empty_hand",children:"Only if hand is empty"}),o.jsx("option",{value:"opponent_higher_value_in_lane",children:"Only if opponent has higher value in this lane"})]})]}),o.jsx("h5",{children:"Lane Restriction"}),o.jsxs("label",{children:["Lane Condition",o.jsxs("select",{value:((m=a.laneCondition)==null?void 0:m.type)||"none",onChange:v=>{const x=v.target.value;if(x==="none"){const{laneCondition:w,selectLane:S,...E}=a;t(E)}else t({...a,laneCondition:{type:x},selectLane:!0})},children:[o.jsx("option",{value:"none",children:"None (any lane)"}),o.jsx("option",{value:"opponent_higher_value",children:"Only lanes where opponent has higher value"})]}),((y=a.laneCondition)==null?void 0:y.type)==="opponent_higher_value"&&o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"Can only delete cards in lanes where opponent's total value is higher than yours. Player selects lane first, then card."})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a.selectLane||!1,onChange:v=>t({...a,selectLane:v.target.checked})}),"Select lane first (player chooses lane, then card)",o.jsx("small",{style:{display:"block",marginLeft:"24px",color:"#8A79E8"},children:"Enable if player should pick a lane before selecting a card."})]})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const qg=({params:a,onChange:t})=>{const l=a.countType||"fixed",i=a.variableCount,c=l==="equal_to_discarded",d=a.source||"hand";return o.jsxs("div",{className:"param-editor",children:[o.jsx("h4",{children:"Discard Effect"}),o.jsxs("label",{children:["Source",o.jsxs("select",{value:d,onChange:f=>t({...a,source:f.target.value}),children:[o.jsx("option",{value:"hand",children:"From Hand"}),o.jsx("option",{value:"top_deck_own",children:"Top of Own Deck (automatic)"}),o.jsx("option",{value:"top_deck_opponent",children:"Top of Opponent's Deck (automatic)"})]}),(d==="top_deck_own"||d==="top_deck_opponent")&&o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"Deck discard is automatic - no player choice needed. The discarded card's value is saved for follow-up effects."})]}),d==="hand"&&o.jsxs("label",{children:["Count Type",o.jsxs("select",{value:l,onChange:f=>t({...a,countType:f.target.value}),children:[o.jsx("option",{value:"fixed",children:"Fixed Count"}),o.jsx("option",{value:"equal_to_discarded",children:"Equal to Previously Discarded (Plague-2)"})]})]}),d==="hand"&&l==="fixed"&&o.jsxs("label",{children:["Count",o.jsxs("select",{value:i?"variable":a.count.toString(),onChange:f=>{const u=f.target.value;if(u==="variable")t({...a,variableCount:!0,count:1});else if(u==="all"){const{variableCount:p,...m}=a;t({...m,count:"all"})}else{const{variableCount:p,...m}=a;t({...m,count:parseInt(u)})}},children:[o.jsx("option",{value:"1",children:"1 card"}),o.jsx("option",{value:"2",children:"2 cards"}),o.jsx("option",{value:"3",children:"3 cards"}),o.jsx("option",{value:"all",children:"All cards (entire hand)"}),o.jsx("option",{value:"variable",children:"1 or more cards (variable)"})]})]}),d==="hand"&&c&&o.jsxs("label",{children:["Offset (add to count)",o.jsx("input",{type:"number",value:a.countOffset||0,onChange:f=>t({...a,countOffset:parseInt(f.target.value)}),min:"-5",max:"5"})]}),d==="hand"&&o.jsxs("label",{children:["Actor",o.jsxs("select",{value:a.actor,onChange:f=>t({...a,actor:f.target.value}),children:[o.jsx("option",{value:"self",children:"Self"}),o.jsx("option",{value:"opponent",children:"Opponent"}),o.jsx("option",{value:"both",children:"Both Players"})]}),a.actor==="both"&&o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"Both players discard simultaneously (automatic, no selection needed)."})]}),d==="hand"&&a.actor==="opponent"&&o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a.random||!1,onChange:f=>t({...a,random:f.target.checked})}),"Random selection (opponent can't choose which card)",o.jsx("small",{style:{display:"block",marginLeft:"24px",marginTop:"4px",color:"#8A79E8"},children:"A random card is discarded instead of opponent choosing."})]})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const $g=({params:a,onChange:t})=>{var f,u,p,m;const l=((f=a.targetFilter)==null?void 0:f.owner)||"any",i=((u=a.targetFilter)==null?void 0:u.position)||"uncovered",c=(p=a.targetFilter)==null?void 0:p.valueEquals,d=a.selectLane||!1;return o.jsxs("div",{className:"param-editor",children:[o.jsx("h4",{children:"Return Effect"}),o.jsxs("label",{children:["Count",o.jsxs("select",{value:typeof a.count=="number"?a.count.toString():"all",onChange:y=>t({...a,count:y.target.value==="all"?"all":parseInt(y.target.value)}),children:[o.jsx("option",{value:"1",children:"1"}),o.jsx("option",{value:"2",children:"2"}),o.jsx("option",{value:"all",children:"All"})]})]}),o.jsxs("label",{children:["Whose cards?",o.jsxs("select",{value:l,onChange:y=>t({...a,targetFilter:{...a.targetFilter,owner:y.target.value}}),children:[o.jsx("option",{value:"any",children:"Any card (own or opponent)"}),o.jsx("option",{value:"own",children:"Only own cards"}),o.jsx("option",{value:"opponent",children:"Only opponent cards"})]})]}),o.jsxs("label",{children:["Position",o.jsxs("select",{value:i,onChange:y=>t({...a,targetFilter:{...a.targetFilter,position:y.target.value}}),children:[o.jsx("option",{value:"uncovered",children:"Uncovered (default)"}),o.jsx("option",{value:"covered",children:"Covered"}),o.jsx("option",{value:"any",children:"Any (covered or uncovered)"})]})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:d,onChange:y=>{if(y.target.checked)t({...a,selectLane:!0});else{const{selectLane:v,...x}=a;t(x)}}}),'Select lane first (Water-3: "in 1 line")']}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:c!==void 0,onChange:y=>{if(y.target.checked)t({...a,targetFilter:{...a.targetFilter,valueEquals:2}});else{const{valueEquals:v,...x}=a.targetFilter||{};t({...a,targetFilter:x})}}}),"Filter by value"]}),c!==void 0&&o.jsxs("label",{children:["Value to return",o.jsx("input",{type:"number",min:0,max:6,value:c,onChange:y=>t({...a,targetFilter:{...a.targetFilter,valueEquals:parseInt(y.target.value)||0}})})]}),o.jsx("h5",{children:"Advanced Conditional"}),o.jsxs("label",{children:["Conditional Type",o.jsxs("select",{value:((m=a.advancedConditional)==null?void 0:m.type)||"none",onChange:y=>{if(y.target.value==="none"){const{advancedConditional:v,...x}=a;t(x)}else t({...a,advancedConditional:{type:y.target.value}})},children:[o.jsx("option",{value:"none",children:"None"}),o.jsx("option",{value:"empty_hand",children:"Only if hand is empty"}),o.jsx("option",{value:"opponent_higher_value_in_lane",children:"Only if opponent has higher value in this lane"})]})]})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Lg=({params:a,onChange:t})=>{var i,c,d,f;const l=a.destinationRule||{type:"other_lines"};return o.jsxs("div",{className:"param-editor",children:[o.jsx("h4",{children:"Play Effect"}),o.jsxs("label",{children:["Actor (who plays)",o.jsxs("select",{value:a.actor||"self",onChange:u=>{if(u.target.value==="self"){const{actor:p,...m}=a;t(m)}else t({...a,actor:u.target.value})},children:[o.jsx("option",{value:"self",children:"You"}),o.jsx("option",{value:"opponent",children:"Opponent"})]})]}),o.jsxs("label",{children:["Source",o.jsxs("select",{value:a.source,onChange:u=>t({...a,source:u.target.value}),children:[o.jsx("option",{value:"hand",children:"Hand"}),o.jsx("option",{value:"deck",children:"Deck"})]})]}),o.jsxs("label",{children:["Anzahl",o.jsx("input",{type:"number",min:1,max:6,value:a.count,onChange:u=>t({...a,count:parseInt(u.target.value)||1})})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a.faceDown,onChange:u=>t({...a,faceDown:u.target.checked})}),"Face-down"]}),o.jsxs("label",{children:["Destination",o.jsxs("select",{value:l.type,onChange:u=>t({...a,destinationRule:{...l,type:u.target.value}}),children:[o.jsx("option",{value:"other_lines",children:"Other lines (choose 1)"}),o.jsx("option",{value:"each_other_line",children:"Each other line (1 per line)"}),o.jsx("option",{value:"specific_lane",children:"Specific lane (this line)"}),o.jsx("option",{value:"each_line_with_card",children:"Each line with card"}),o.jsx("option",{value:"line_with_matching_cards",children:"Line with matching cards (choose 1)"}),o.jsx("option",{value:"under_this_card",children:"Under this card"})]})]}),(l.type==="each_line_with_card"||l.type==="line_with_matching_cards")&&o.jsxs("label",{children:["Card Filter (which cards must be in line)",o.jsxs("select",{value:((i=l.cardFilter)==null?void 0:i.faceState)||"any",onChange:u=>{const p=u.target.value;if(p==="any"){const{cardFilter:m,...y}=l;t({...a,destinationRule:y})}else t({...a,destinationRule:{...l,cardFilter:{faceState:p}}})},children:[o.jsx("option",{value:"any",children:"Any card"}),o.jsx("option",{value:"face_down",children:"Face-down cards only"}),o.jsx("option",{value:"face_up",children:"Face-up cards only"})]})]}),o.jsxs("label",{children:["Condition",o.jsxs("select",{value:((c=a.condition)==null?void 0:c.type)||"none",onChange:u=>{const p=u.target.value;if(p==="none"){const{condition:m,...y}=a;t(y)}else t(p==="per_x_cards_in_line"?{...a,condition:{type:p,cardCount:2}}:{...a,condition:{type:p}})},children:[o.jsx("option",{value:"none",children:"None (always play)"}),o.jsx("option",{value:"per_x_cards_in_line",children:"For every X cards in this line"}),o.jsx("option",{value:"only_in_lines_with_cards",children:"Only in lines where you have a card"})]})]}),((d=a.condition)==null?void 0:d.type)==="per_x_cards_in_line"&&o.jsxs("label",{children:["Cards per play (X)",o.jsx("input",{type:"number",min:1,max:6,value:a.condition.cardCount||2,onChange:u=>t({...a,condition:{...a.condition,cardCount:parseInt(u.target.value)||2}})}),o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:'Example: "For every 2 cards in this line, play..."  X = 2'})]}),o.jsx("h5",{children:"Advanced Conditional"}),o.jsxs("label",{children:["Conditional Type",o.jsxs("select",{value:((f=a.advancedConditional)==null?void 0:f.type)||"none",onChange:u=>{if(u.target.value==="none"){const{advancedConditional:p,...m}=a;t(m)}else t({...a,advancedConditional:{type:u.target.value}})},children:[o.jsx("option",{value:"none",children:"None"}),o.jsx("option",{value:"empty_hand",children:"Only if hand is empty"}),o.jsx("option",{value:"opponent_higher_value_in_lane",children:"Only if opponent has higher value in this lane"})]})]})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Ig=({params:a,onChange:t})=>o.jsxs("div",{className:"param-editor",children:[o.jsx("h4",{children:"Protocol Effect"}),o.jsxs("label",{children:["Action",o.jsxs("select",{value:a.action,onChange:l=>t({...a,action:l.target.value}),children:[o.jsx("option",{value:"rearrange_protocols",children:"Rearrange"}),o.jsx("option",{value:"swap_protocols",children:"Swap"})]})]}),o.jsxs("label",{children:["Target",o.jsxs("select",{value:a.target,onChange:l=>t({...a,target:l.target.value}),children:[o.jsx("option",{value:"own",children:"Own"}),o.jsx("option",{value:"opponent",children:"Opponent"}),o.jsx("option",{value:"both_sequential",children:"Beide (nacheinander)"})]})]}),o.jsx("h5",{children:"Restriction (Anarchy-3)"}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:!!a.restriction,onChange:l=>{if(l.target.checked)t({...a,restriction:{disallowedProtocol:"",laneIndex:"current"}});else{const{restriction:i,...c}=a;t(c)}}}),"Add restriction (protocol cannot be on specific lane)"]}),a.restriction&&o.jsxs(o.Fragment,{children:[o.jsxs("label",{children:["Disallowed Protocol",o.jsx("input",{type:"text",value:a.restriction.disallowedProtocol,onChange:l=>t({...a,restriction:{...a.restriction,disallowedProtocol:l.target.value}}),placeholder:"e.g., Anarchy, Fire, Death"})]}),o.jsxs("label",{children:["Lane",o.jsxs("select",{value:a.restriction.laneIndex,onChange:l=>t({...a,restriction:{...a.restriction,laneIndex:l.target.value==="current"?"current":parseInt(l.target.value)}}),children:[o.jsx("option",{value:"current",children:"Current lane (where this card is)"}),o.jsx("option",{value:"0",children:"Lane 1 (Left)"}),o.jsx("option",{value:"1",children:"Lane 2 (Middle)"}),o.jsx("option",{value:"2",children:"Lane 3 (Right)"})]})]})]})]});/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Ug=({params:a,onChange:t})=>o.jsxs("div",{className:"param-editor",children:[o.jsx("h4",{children:"Reveal/Give Effect"}),o.jsxs("label",{children:["Action",o.jsxs("select",{value:a.action,onChange:l=>t({...a,action:l.target.value}),children:[o.jsx("option",{value:"reveal",children:"Reveal"}),o.jsx("option",{value:"give",children:"Give"})]})]}),o.jsxs("label",{children:["Source",o.jsxs("select",{value:a.source,onChange:l=>t({...a,source:l.target.value}),children:[o.jsx("option",{value:"own_hand",children:"Your hand"}),o.jsx("option",{value:"opponent_hand",children:"Opponent's hand"}),o.jsx("option",{value:"own_deck_top",children:"Top of your deck"}),o.jsx("option",{value:"own_deck",children:"Your entire deck"}),o.jsx("option",{value:"board",children:"Board card"})]})]}),(a.source==="own_hand"||a.source==="opponent_hand"||a.source==="board")&&o.jsxs("label",{children:["Anzahl",o.jsx("input",{type:"number",min:1,max:6,value:a.count,onChange:l=>t({...a,count:parseInt(l.target.value)||1})})]}),a.source==="board"&&o.jsxs("label",{children:["Follow-up action",o.jsxs("select",{value:a.followUpAction||"none",onChange:l=>{if(l.target.value==="none"){const{followUpAction:i,...c}=a;t(c)}else t({...a,followUpAction:l.target.value})},children:[o.jsx("option",{value:"none",children:"None"}),o.jsx("option",{value:"flip",children:"Then flip"}),o.jsx("option",{value:"shift",children:"Then shift"})]})]})]});/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Pg=({params:a,onChange:t})=>o.jsxs("div",{className:"param-editor take-effect-editor",children:[o.jsx("h4",{children:"Take Effect Parameters"}),o.jsxs("label",{children:["Card Count",o.jsx("input",{type:"number",min:1,max:6,value:a.count,onChange:l=>t({...a,count:parseInt(l.target.value)||1})})]}),o.jsxs("label",{children:["Source",o.jsx("select",{value:a.source,onChange:l=>t({...a,source:l.target.value}),children:o.jsx("option",{value:"opponent_hand",children:"Opponent's Hand"})})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a.random,onChange:l=>t({...a,random:l.target.checked})}),"Random (if unchecked, you choose)"]})]}),hc=a=>{switch(a){case"draw":return{action:"draw",count:1,target:"self",source:"own_deck"};case"flip":return{action:"flip",count:1,targetFilter:{owner:"any",position:"any",faceState:"any",excludeSelf:!1},optional:!1};case"shift":return{action:"shift",targetFilter:{owner:"any",position:"any",faceState:"any"},destinationRestriction:{type:"any"}};case"delete":return{action:"delete",count:1,targetFilter:{position:"any",faceState:"any"},scope:{type:"anywhere"},excludeSelf:!1};case"discard":return{action:"discard",count:1,actor:"self"};case"return":return{action:"return",count:1,targetFilter:{},scope:{type:"any_card"}};case"play":return{action:"play",source:"hand",count:1,faceDown:!1,destinationRule:{type:"other_lines"}};case"rearrange_protocols":return{action:"rearrange_protocols",target:"own"};case"swap_protocols":return{action:"swap_protocols",target:"own"};case"reveal":case"give":return{action:a,source:"own_hand",count:1};case"take":return{action:"take",source:"opponent_hand",count:1,random:!0};default:return{}}},Fb=({params:a,onChange:t})=>{const[l,i]=se.useState(""),[c,d]=se.useState(""),[f,u]=se.useState(null),p=a.options||[],m=p[0],y=p[1],v=()=>{if(!l)return;const F={id:Ze(),params:hc(l),position:"middle",trigger:"on_play"};t({...a,options:[F,y].filter(Boolean)}),i(""),u(1)},x=()=>{if(!c)return;const F={id:Ze(),params:hc(c),position:"middle",trigger:"on_play"};t({...a,options:[m,F].filter(Boolean)}),d(""),u(2)},w=()=>{t({...a,options:[y].filter(Boolean)}),f===1&&u(null)},S=()=>{t({...a,options:[m].filter(Boolean)}),f===2&&u(null)},E=F=>{const L={...m,params:F};t({...a,options:[L,y].filter(Boolean)})},b=F=>{const L={...y,params:F};t({...a,options:[m,L].filter(Boolean)})},j=F=>{const L=hc(F),O={...m,params:L};t({...a,options:[O,y].filter(Boolean)})},C=F=>{const L=hc(F),O={...y,params:L};t({...a,options:[m,O].filter(Boolean)})},R=(F,L)=>{switch(F.params.action){case"draw":return o.jsx(Tg,{params:F.params,onChange:L});case"flip":return o.jsx(Ag,{params:F.params,onChange:L});case"shift":return o.jsx(Dg,{params:F.params,onChange:L});case"delete":return o.jsx(Fg,{params:F.params,onChange:L});case"discard":return o.jsx(qg,{params:F.params,onChange:L});case"return":return o.jsx($g,{params:F.params,onChange:L});case"play":return o.jsx(Lg,{params:F.params,onChange:L});case"rearrange_protocols":case"swap_protocols":return o.jsx(Ig,{params:F.params,onChange:L});case"reveal":case"give":return o.jsx(Ug,{params:F.params,onChange:L});case"take":return o.jsx(Pg,{params:F.params,onChange:L});default:return o.jsx("div",{children:"Unknown effect type"})}};return o.jsxs("div",{style:{padding:"10px",backgroundColor:"#2c1d63",borderRadius:"4px",border:"1px solid rgba(97, 239, 255, 0.3)"},children:[o.jsx("h4",{style:{color:"#61EFFF",marginTop:0},children:"Either/Or Choice"}),o.jsx("p",{style:{color:"#F0F0F0",fontSize:"14px",marginBottom:"15px"},children:'Player chooses one of two options. Example: "Either discard 1 card or flip this card"'}),o.jsxs("div",{style:{marginBottom:"15px",padding:"10px",backgroundColor:"rgba(97, 239, 255, 0.05)",borderRadius:"4px"},children:[o.jsx("label",{style:{color:"#61EFFF",display:"block",marginBottom:"10px",fontWeight:"bold"},children:"Option 1:"}),m?o.jsxs(o.Fragment,{children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"10px"},children:[o.jsxs("select",{value:m.params.action,onChange:F=>j(F.target.value),style:{flex:1,padding:"8px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px"},children:[o.jsx("option",{value:"draw",children:"Draw Cards"}),o.jsx("option",{value:"flip",children:"Flip Cards"}),o.jsx("option",{value:"shift",children:"Shift Card"}),o.jsx("option",{value:"delete",children:"Delete Cards"}),o.jsx("option",{value:"discard",children:"Discard Cards"}),o.jsx("option",{value:"return",children:"Return to Hand"}),o.jsx("option",{value:"play",children:"Play from Hand/Deck"})]}),o.jsx("button",{onClick:()=>u(f===1?null:1),style:{padding:"8px 15px",backgroundColor:f===1?"#8B0000":"#61EFFF",color:f===1?"#F0F0F0":"#0A051A",border:"none",borderRadius:"4px",cursor:"pointer",fontWeight:"bold"},children:f===1?"Hide":"Edit"}),o.jsx("button",{onClick:w,style:{padding:"8px 15px",backgroundColor:"#8B0000",color:"#F0F0F0",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Remove"})]}),f===1&&o.jsx("div",{style:{marginTop:"10px"},children:R(m,E)})]}):o.jsxs("div",{style:{display:"flex",gap:"10px"},children:[o.jsxs("select",{value:l,onChange:F=>i(F.target.value),style:{flex:1,padding:"8px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px"},children:[o.jsx("option",{value:"",children:"Choose Action"}),o.jsx("option",{value:"draw",children:"Draw Cards"}),o.jsx("option",{value:"flip",children:"Flip Cards"}),o.jsx("option",{value:"shift",children:"Shift Card"}),o.jsx("option",{value:"delete",children:"Delete Cards"}),o.jsx("option",{value:"discard",children:"Discard Cards"}),o.jsx("option",{value:"return",children:"Return to Hand"}),o.jsx("option",{value:"play",children:"Play from Hand/Deck"})]}),o.jsx("button",{onClick:v,disabled:!l,style:{padding:"8px 15px",backgroundColor:l?"#61EFFF":"#444",color:"#0A051A",border:"none",borderRadius:"4px",cursor:l?"pointer":"not-allowed",fontWeight:"bold"},children:"Add"})]})]}),o.jsxs("div",{style:{padding:"10px",backgroundColor:"rgba(97, 239, 255, 0.05)",borderRadius:"4px"},children:[o.jsx("label",{style:{color:"#61EFFF",display:"block",marginBottom:"10px",fontWeight:"bold"},children:"Option 2:"}),y?o.jsxs(o.Fragment,{children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"10px"},children:[o.jsxs("select",{value:y.params.action,onChange:F=>C(F.target.value),style:{flex:1,padding:"8px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px"},children:[o.jsx("option",{value:"draw",children:"Draw Cards"}),o.jsx("option",{value:"flip",children:"Flip Cards"}),o.jsx("option",{value:"shift",children:"Shift Card"}),o.jsx("option",{value:"delete",children:"Delete Cards"}),o.jsx("option",{value:"discard",children:"Discard Cards"}),o.jsx("option",{value:"return",children:"Return to Hand"}),o.jsx("option",{value:"play",children:"Play from Hand/Deck"})]}),o.jsx("button",{onClick:()=>u(f===2?null:2),style:{padding:"8px 15px",backgroundColor:f===2?"#8B0000":"#61EFFF",color:f===2?"#F0F0F0":"#0A051A",border:"none",borderRadius:"4px",cursor:"pointer",fontWeight:"bold"},children:f===2?"Hide":"Edit"}),o.jsx("button",{onClick:S,style:{padding:"8px 15px",backgroundColor:"#8B0000",color:"#F0F0F0",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Remove"})]}),f===2&&o.jsx("div",{style:{marginTop:"10px"},children:R(y,b)})]}):o.jsxs("div",{style:{display:"flex",gap:"10px"},children:[o.jsxs("select",{value:c,onChange:F=>d(F.target.value),style:{flex:1,padding:"8px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px"},children:[o.jsx("option",{value:"",children:"Choose Action"}),o.jsx("option",{value:"draw",children:"Draw Cards"}),o.jsx("option",{value:"flip",children:"Flip Cards"}),o.jsx("option",{value:"shift",children:"Shift Card"}),o.jsx("option",{value:"delete",children:"Delete Cards"}),o.jsx("option",{value:"discard",children:"Discard Cards"}),o.jsx("option",{value:"return",children:"Return to Hand"}),o.jsx("option",{value:"play",children:"Play from Hand/Deck"})]}),o.jsx("button",{onClick:x,disabled:!c,style:{padding:"8px 15px",backgroundColor:c?"#61EFFF":"#444",color:"#0A051A",border:"none",borderRadius:"4px",cursor:c?"pointer":"not-allowed",fontWeight:"bold"},children:"Add"})]})]}),p.length===2&&o.jsx("div",{style:{marginTop:"15px",padding:"10px",backgroundColor:"rgba(97, 239, 255, 0.1)",borderRadius:"4px"},children:o.jsx("p",{style:{color:"#61EFFF",fontSize:"14px",margin:0},children:" Both options configured. Player will choose one during gameplay."})})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const qb=({params:a,onChange:t})=>{var p,m,y,v,x,w;const l=((p=a.rule)==null?void 0:p.type)||"block_all_play",i=((m=a.rule)==null?void 0:m.target)||"opponent",c=((y=a.rule)==null?void 0:y.scope)||"this_lane",d=((v=a.rule)==null?void 0:v.onlyDuringYourTurn)||!1,f=((x=a.rule)==null?void 0:x.conditionTarget)||"self",u=((w=a.rule)==null?void 0:w.blockTarget)||"self";return o.jsxs("div",{className:"param-editor passive-rule-editor",children:[o.jsx("h4",{children:"Passive Rule Parameters"}),o.jsx("p",{style:{color:"#8A79E8",fontSize:"14px",marginBottom:"15px"},children:"This rule is active while the card is face-up. It modifies game behavior."}),o.jsxs("label",{children:["Rule Type",o.jsxs("select",{value:l,onChange:S=>t({...a,rule:{...a.rule,type:S.target.value,target:i,scope:c}}),children:[o.jsxs("optgroup",{label:"Play Restrictions",children:[o.jsx("option",{value:"block_face_down_play",children:"Block Face-Down Plays (Metal-2)"}),o.jsx("option",{value:"block_face_up_play",children:"Block Face-Up Plays"}),o.jsx("option",{value:"block_all_play",children:"Block All Plays (Plague-0)"}),o.jsx("option",{value:"require_face_down_play",children:"Require Face-Down Plays (Psychic-1)"})]}),o.jsxs("optgroup",{label:"Protocol Matching",children:[o.jsx("option",{value:"allow_any_protocol_play",children:"Allow Any Protocol (Spirit-1, Chaos-3)"}),o.jsx("option",{value:"allow_play_on_opponent_side",children:"Allow Play on Opponent Side (Corruption-0)"}),o.jsx("option",{value:"require_non_matching_protocol",children:"Require Non-Matching (Anarchy-1)"})]}),o.jsxs("optgroup",{label:"Action Blocks",children:[o.jsx("option",{value:"block_flips",children:"Block Flips (Frost-1)"}),o.jsx("option",{value:"block_protocol_rearrange",children:"Block Protocol Rearrange (Frost-1)"}),o.jsx("option",{value:"block_shifts_from_lane",children:"Block Shifts From Lane (Frost-3)"}),o.jsx("option",{value:"block_shifts_to_lane",children:"Block Shifts To Lane (Frost-3)"}),o.jsx("option",{value:"block_flip_this_card",children:"This Card Cannot Be Flipped"})]}),o.jsx("optgroup",{label:"Draw Restrictions",children:o.jsx("option",{value:"block_draw_conditional",children:"Conditional Draw Block"})}),o.jsx("optgroup",{label:"Effect Modifications",children:o.jsx("option",{value:"ignore_middle_commands",children:"Ignore Middle Commands (Apathy-2)"})}),o.jsx("optgroup",{label:"Phase Modifications",children:o.jsx("option",{value:"skip_check_cache_phase",children:"Skip Check Cache Phase (Spirit-0)"})})]})]}),o.jsxs("label",{children:["Affected Player",o.jsxs("select",{value:i,onChange:S=>t({...a,rule:{...a.rule,type:l,target:S.target.value,scope:c}}),children:[o.jsx("option",{value:"self",children:"Self (You)"}),o.jsx("option",{value:"opponent",children:"Opponent"}),o.jsx("option",{value:"all",children:"All Players"})]})]}),o.jsxs("label",{children:["Scope",o.jsxs("select",{value:c,onChange:S=>t({...a,rule:{...a.rule,type:l,target:i,scope:S.target.value,onlyDuringYourTurn:d}}),children:[o.jsx("option",{value:"this_lane",children:"This Lane Only"}),o.jsx("option",{value:"global",children:"Global (All Lanes)"})]})]}),l==="ignore_middle_commands"&&o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:d,onChange:S=>t({...a,rule:{...a.rule,type:l,target:i,scope:c,onlyDuringYourTurn:S.target.checked}})}),"Only during your turn",o.jsx("small",{style:{display:"block",marginLeft:"24px",marginTop:"4px",color:"#8A79E8"},children:"Effect only applies during card owner's turn, not during opponent's turn."})]}),l==="block_draw_conditional"&&o.jsxs(o.Fragment,{children:[o.jsxs("label",{children:["Condition (who must have cards in hand)",o.jsxs("select",{value:f,onChange:S=>t({...a,rule:{...a.rule,type:l,target:"this_card",scope:"global",conditionTarget:S.target.value,blockTarget:u}}),children:[o.jsx("option",{value:"self",children:"Card owner (you)"}),o.jsx("option",{value:"opponent",children:"Opponent of card owner"})]}),o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"If this player has any cards in hand, the draw block activates."})]}),o.jsxs("label",{children:["Block target (who cannot draw)",o.jsxs("select",{value:u,onChange:S=>t({...a,rule:{...a.rule,type:l,target:"this_card",scope:"global",conditionTarget:f,blockTarget:S.target.value}}),children:[o.jsx("option",{value:"self",children:"Card owner (you)"}),o.jsx("option",{value:"opponent",children:"Opponent of card owner"}),o.jsx("option",{value:"all",children:"Both players"})]}),o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"This player cannot draw cards when the condition is met."})]})]}),l==="block_flip_this_card"&&o.jsx("small",{style:{display:"block",marginTop:"8px",color:"#8A79E8"},children:"This card cannot be flipped by any effect. Only affects this specific card."})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const $b=({params:a,onChange:t})=>{var v,x,w,S,E,b,j,C,R;const l=((v=a.modifier)==null?void 0:v.type)||"add_per_condition",i=((x=a.modifier)==null?void 0:x.value)||1,c=((w=a.modifier)==null?void 0:w.condition)||"per_face_down_card",d=((S=a.modifier)==null?void 0:S.target)||"own_total",f=((E=a.modifier)==null?void 0:E.scope)||"this_lane",u=((j=(b=a.modifier)==null?void 0:b.filter)==null?void 0:j.faceState)||"face_down",p=((R=(C=a.modifier)==null?void 0:C.filter)==null?void 0:R.position)||"any",m=l==="add_per_condition",y=l==="set_to_fixed"&&(d==="own_cards"||d==="opponent_cards"||d==="all_cards");return o.jsxs("div",{className:"param-editor value-modifier-editor",children:[o.jsx("h4",{children:"Value Modifier Parameters"}),o.jsx("p",{style:{color:"#8A79E8",fontSize:"14px",marginBottom:"15px"},children:"This modifier is active while the card is face-up. It modifies card values or lane totals."}),o.jsxs("label",{children:["Modifier Type",o.jsxs("select",{value:l,onChange:F=>t({...a,modifier:{...a.modifier,type:F.target.value,value:i,condition:m?c:void 0,target:d,scope:f,filter:y?{faceState:u,position:p}:void 0}}),children:[o.jsx("option",{value:"add_per_condition",children:"Add Per Condition (Apathy-0: +1 per face-down)"}),o.jsx("option",{value:"set_to_fixed",children:"Set Cards To Fixed Value (Darkness-2: face-down = 4)"}),o.jsx("option",{value:"add_to_total",children:"Add To Lane Total (Metal-0: opponent total -2)"})]})]}),o.jsxs("label",{children:["Value",o.jsx("input",{type:"number",value:i,onChange:F=>t({...a,modifier:{...a.modifier,type:l,value:parseInt(F.target.value)||0,condition:m?c:void 0,target:d,scope:f,filter:y?{faceState:u,position:p}:void 0}}),style:{width:"100%",padding:"8px",marginTop:"5px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px"}}),o.jsxs("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:[l==="add_per_condition"&&"Value to add per condition (e.g., +1)",l==="set_to_fixed"&&"Fixed value to set cards to (e.g., 4)",l==="add_to_total"&&"Value to add to total (use negative for subtraction, e.g., -2)"]})]}),m&&o.jsxs("label",{children:["Condition",o.jsxs("select",{value:c,onChange:F=>t({...a,modifier:{...a.modifier,type:l,value:i,condition:F.target.value,target:d,scope:f,filter:y?{faceState:u,position:p}:void 0}}),children:[o.jsx("option",{value:"per_face_down_card",children:"Per Face-Down Card"}),o.jsx("option",{value:"per_face_up_card",children:"Per Face-Up Card"}),o.jsx("option",{value:"per_card",children:"Per Card (any)"}),o.jsx("option",{value:"per_card_in_hand",children:"Per Card in Your Hand"}),o.jsx("option",{value:"per_opponent_card_in_lane",children:"Per Opponent Card in Lane"})]})]}),o.jsxs("label",{children:["Target",o.jsxs("select",{value:d,onChange:F=>t({...a,modifier:{...a.modifier,type:l,value:i,condition:m?c:void 0,target:F.target.value,scope:f,filter:y?{faceState:u,position:p}:void 0}}),children:[o.jsxs("optgroup",{label:"Card Values",children:[o.jsx("option",{value:"own_cards",children:"Own Cards"}),o.jsx("option",{value:"opponent_cards",children:"Opponent Cards"}),o.jsx("option",{value:"all_cards",children:"All Cards"})]}),o.jsxs("optgroup",{label:"Lane Totals",children:[o.jsx("option",{value:"own_total",children:"Own Total"}),o.jsx("option",{value:"opponent_total",children:"Opponent Total"})]})]})]}),y&&o.jsxs(o.Fragment,{children:[o.jsxs("label",{children:["Card Face State (Filter)",o.jsxs("select",{value:u,onChange:F=>t({...a,modifier:{...a.modifier,type:l,value:i,condition:m?c:void 0,target:d,scope:f,filter:{faceState:F.target.value,position:p}}}),children:[o.jsx("option",{value:"face_down",children:"Face-Down Only"}),o.jsx("option",{value:"face_up",children:"Face-Up Only"}),o.jsx("option",{value:"any",children:"Any"})]})]}),o.jsxs("label",{children:["Card Position (Filter)",o.jsxs("select",{value:p,onChange:F=>t({...a,modifier:{...a.modifier,type:l,value:i,condition:m?c:void 0,target:d,scope:f,filter:{faceState:u,position:F.target.value}}}),children:[o.jsx("option",{value:"any",children:"Any Position"}),o.jsx("option",{value:"covered",children:"Covered Only"}),o.jsx("option",{value:"uncovered",children:"Uncovered Only"})]})]})]}),o.jsxs("label",{children:["Scope",o.jsxs("select",{value:f,onChange:F=>t({...a,modifier:{...a.modifier,type:l,value:i,condition:m?c:void 0,target:d,scope:F.target.value,filter:y?{faceState:u,position:p}:void 0}}),children:[o.jsx("option",{value:"this_lane",children:"This Lane Only"}),o.jsx("option",{value:"global",children:"Global (All Lanes)"})]})]})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Lb=({params:a,onChange:t})=>o.jsxs("div",{className:"param-editor block-compile-effect-editor",children:[o.jsx("h4",{children:"Block Compile Effect Parameters"}),o.jsxs("label",{children:["Target",o.jsxs("select",{value:a.target||"opponent",onChange:l=>t({...a,target:l.target.value}),children:[o.jsx("option",{value:"opponent",children:"Opponent cannot compile next turn"}),o.jsx("option",{value:"self",children:"You cannot compile next turn"})]})]})]});/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Ib=({params:a,onChange:t})=>{var i;const l=((i=a.laneCondition)==null?void 0:i.count)||8;return o.jsxs("div",{className:"param-editor delete-all-in-lane-effect-editor",children:[o.jsx("h4",{children:"Delete All In Lane Effect Parameters"}),o.jsxs("label",{children:["Minimum cards in lane",o.jsxs("select",{value:l,onChange:c=>t({...a,laneCondition:{type:"min_cards",count:parseInt(c.target.value)}}),children:[o.jsx("option",{value:0,children:"No minimum (any lane)"}),o.jsx("option",{value:4,children:"4 or more cards"}),o.jsx("option",{value:6,children:"6 or more cards"}),o.jsx("option",{value:8,children:"8 or more cards (Metal-3)"}),o.jsx("option",{value:10,children:"10 or more cards"})]})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a.excludeCurrentLane!==!1,onChange:c=>t({...a,excludeCurrentLane:c.target.checked})}),"Exclude current lane (other lanes only)"]})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Ub=({params:a,onChange:t})=>o.jsxs("div",{className:"param-editor",children:[o.jsx("h4",{children:"Shuffle Trash Effect"}),o.jsx("p",{style:{color:"#8A79E8",fontSize:"14px",marginBottom:"15px"},children:"Shuffle your trash (discarded/deleted cards) back into your deck."}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a.optional!==!1,onChange:l=>t({...a,optional:l.target.checked})}),'Optional ("You may shuffle...")']})]}),Pb=({params:a})=>o.jsxs("div",{className:"param-editor",children:[o.jsx("h4",{children:"Shuffle Deck Effect"}),o.jsx("p",{style:{color:"#8A79E8",fontSize:"14px",marginBottom:"15px"},children:"Shuffle your deck. Typically used after revealing the deck."})]});/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Ob=({params:a,onChange:t})=>o.jsxs("div",{className:"param-editor state-number-effect-editor",children:[o.jsx("h4",{children:"State Number Effect"}),o.jsxs("label",{children:["Number Source",o.jsx("select",{value:a.numberSource||"own_protocol_values",onChange:l=>t({...a,numberSource:l.target.value}),children:o.jsx("option",{value:"own_protocol_values",children:"Own Protocol Values (0-5)"})}),o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"Player chooses a number from the available protocol card values. The stated number is stored for subsequent effects."})]})]});/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Mb=({params:a,onChange:t})=>o.jsxs("div",{className:"param-editor state-protocol-effect-editor",children:[o.jsx("h4",{children:"State Protocol Effect"}),o.jsxs("label",{children:["Protocol Source",o.jsx("select",{value:a.protocolSource||"opponent_cards",onChange:l=>t({...a,protocolSource:l.target.value}),children:o.jsx("option",{value:"opponent_cards",children:"Opponent's Cards (unique protocols)"})}),o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"Player chooses a protocol from the opponent's unique protocols. The stated protocol is stored for subsequent effects (e.g., matching conditionals)."})]})]}),mc=a=>{switch(a){case"draw":return{action:"draw",count:1,target:"self",source:"own_deck"};case"refresh":return{action:"refresh",target:"self"};case"mutual_draw":return{action:"mutual_draw",count:1};case"flip":return{action:"flip",count:1,targetFilter:{owner:"any",position:"any",faceState:"any",excludeSelf:!1},optional:!1};case"shift":return{action:"shift",targetFilter:{owner:"any",position:"any",faceState:"any"},destinationRestriction:{type:"any"}};case"delete":return{action:"delete",count:1,targetFilter:{position:"any",faceState:"any"},scope:{type:"anywhere"},excludeSelf:!1};case"discard":return{action:"discard",count:1,actor:"self"};case"return":return{action:"return",count:1,targetFilter:{},scope:{type:"any_card"}};case"play":return{action:"play",source:"hand",count:1,faceDown:!1,destinationRule:{type:"other_lines"}};case"rearrange_protocols":return{action:"rearrange_protocols",target:"own"};case"swap_protocols":return{action:"swap_protocols",target:"own"};case"reveal":case"give":return{action:a,source:"own_hand",count:1};case"take":return{action:"take",source:"opponent_hand",count:1,random:!0};case"choice":return{action:"choice",options:[]};case"passive_rule":return{action:"passive_rule",rule:{type:"block_all_play",target:"opponent",scope:"this_lane"}};case"value_modifier":return{action:"value_modifier",modifier:{type:"add_per_condition",value:1,condition:"per_face_down_card",target:"own_total",scope:"this_lane"}};case"block_compile":return{action:"block_compile",target:"opponent"};case"delete_all_in_lane":return{action:"delete_all_in_lane",laneCondition:{type:"min_cards",count:8},excludeCurrentLane:!0};case"shuffle_trash":return{action:"shuffle_trash",optional:!0};case"shuffle_deck":return{action:"shuffle_deck"};case"redirect_return_to_deck":return{action:"redirect_return_to_deck",faceDown:!0};case"state_number":return{action:"state_number",numberSource:"own_protocol_values"};case"state_protocol":return{action:"state_protocol",protocolSource:"opponent_cards"};case"swap_stacks":return{action:"swap_stacks",target:"own"};case"copy_opponent_middle":return{action:"copy_opponent_middle",optional:!0};default:return{}}},Hb=({effect:a,onChange:t,readOnly:l=!1})=>{const i=w=>{l||t({...a,params:w})},c=w=>{if(w){const S={id:Ze(),params:mc("draw"),position:a.position,trigger:a.trigger};t({...a,conditional:{type:"then",thenEffect:S}})}else{const{conditional:S,...E}=a;t(E)}},d=w=>{a.conditional&&t({...a,conditional:{...a.conditional,type:w}})},f=w=>{a.conditional&&t({...a,conditional:{...a.conditional,thenEffect:w}})},u=w=>{if(!a.conditional)return;const S=mc(w),E={...a.conditional.thenEffect,params:S};t({...a,conditional:{...a.conditional,thenEffect:E}})},p=w=>{if(a.conditional)if(w){const S={id:Ze(),params:mc("delete"),position:a.position,trigger:a.trigger};t({...a,conditional:{...a.conditional,thenEffect:{...a.conditional.thenEffect,conditional:{type:"then",thenEffect:S}}}})}else{const{conditional:S,...E}=a.conditional.thenEffect;t({...a,conditional:{...a.conditional,thenEffect:E}})}},m=w=>{var S;(S=a.conditional)!=null&&S.thenEffect.conditional&&t({...a,conditional:{...a.conditional,thenEffect:{...a.conditional.thenEffect,conditional:{...a.conditional.thenEffect.conditional,type:w}}}})},y=w=>{var S;(S=a.conditional)!=null&&S.thenEffect.conditional&&t({...a,conditional:{...a.conditional,thenEffect:{...a.conditional.thenEffect,conditional:{...a.conditional.thenEffect.conditional,thenEffect:w}}}})},v=w=>{var b;if(!((b=a.conditional)!=null&&b.thenEffect.conditional))return;const S=mc(w),E={...a.conditional.thenEffect.conditional.thenEffect,params:S};t({...a,conditional:{...a.conditional,thenEffect:{...a.conditional.thenEffect,conditional:{...a.conditional.thenEffect.conditional,thenEffect:E}}}})},x=(w,S)=>{switch(w.params.action){case"draw":return o.jsx(Tg,{params:w.params,onChange:S});case"refresh":return o.jsx(Ab,{params:w.params,onChange:S});case"mutual_draw":return o.jsx(Db,{params:w.params,onChange:S});case"flip":return o.jsx(Ag,{params:w.params,onChange:S});case"shift":return o.jsx(Dg,{params:w.params,onChange:S});case"delete":return o.jsx(Fg,{params:w.params,onChange:S});case"discard":return o.jsx(qg,{params:w.params,onChange:S});case"return":return o.jsx($g,{params:w.params,onChange:S});case"play":return o.jsx(Lg,{params:w.params,onChange:S});case"rearrange_protocols":case"swap_protocols":return o.jsx(Ig,{params:w.params,onChange:S});case"reveal":case"give":return o.jsx(Ug,{params:w.params,onChange:S});case"take":return o.jsx(Pg,{params:w.params,onChange:S});case"choice":return o.jsx(Fb,{params:w.params,onChange:S});case"passive_rule":return o.jsx(qb,{params:w.params,onChange:S});case"value_modifier":return o.jsx($b,{params:w.params,onChange:S});case"block_compile":return o.jsx(Lb,{params:w.params,onChange:S});case"delete_all_in_lane":return o.jsx(Ib,{params:w.params,onChange:S});case"shuffle_trash":return o.jsx(Ub,{params:w.params,onChange:S});case"shuffle_deck":return o.jsx(Pb,{params:w.params,onChange:S});case"state_number":return o.jsx(Ob,{params:w.params,onChange:S});case"state_protocol":return o.jsx(Mb,{params:w.params,onChange:S});case"swap_stacks":return o.jsxs("div",{className:"param-editor swap-stacks-editor",children:[o.jsx("h4",{children:"Swap Stacks"}),o.jsx("p",{style:{color:"#8A79E8"},children:"Swap all of your cards in one of your stacks with another one of your stacks."})]});case"copy_opponent_middle":return o.jsxs("div",{className:"param-editor copy-opponent-middle-editor",children:[o.jsx("h4",{children:"Copy Opponent's Middle Command"}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:w.params.optional??!0,onChange:E=>S({...w.params,optional:E.target.checked})}),'Optional ("You may resolve..." instead of "Resolve...")']}),o.jsx("p",{style:{color:"#8A79E8",marginTop:"10px"},children:"Select one of your opponent's face-up uncovered cards and execute its middle commands as if they were on this card."})]});default:return o.jsxs("div",{children:["Unknown effect type: ",w.params.action]})}};return o.jsxs("div",{className:`effect-editor ${l?"read-only-mode":""}`,children:[o.jsx("div",{className:"trigger-info",style:{marginBottom:"15px",padding:"10px",backgroundColor:"#1A113B",borderRadius:"4px",border:"1px solid rgba(97, 239, 255, 0.3)"},children:o.jsxs("div",{style:{display:"flex",gap:"20px",alignItems:"center",flexWrap:"wrap"},children:[o.jsxs("label",{style:{flex:1,minWidth:"200px"},children:[o.jsx("strong",{children:"Trigger:"}),o.jsxs("select",{value:a.trigger,onChange:w=>!l&&t({...a,trigger:w.target.value}),disabled:l,style:{width:"100%",padding:"6px",marginTop:"4px",backgroundColor:"#2c1d63",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px"},children:[o.jsx("optgroup",{label:"Immediate",children:o.jsx("option",{value:"on_play",children:"On Play"})}),o.jsx("optgroup",{label:"Passive (Top Box)",children:o.jsx("option",{value:"passive",children:"Passive (always active)"})}),o.jsxs("optgroup",{label:"Phase Triggers (Bottom Box)",children:[o.jsx("option",{value:"start",children:"Start Phase"}),o.jsx("option",{value:"end",children:"End Phase"}),o.jsx("option",{value:"on_cover",children:"When Covered"})]}),o.jsxs("optgroup",{label:"Reactive (Top Box)",children:[o.jsx("option",{value:"on_flip",children:"When this card would be flipped"}),o.jsx("option",{value:"on_cover_or_flip",children:"When covered or flipped"}),o.jsx("option",{value:"after_delete",children:"After cards are deleted"}),o.jsx("option",{value:"after_discard",children:"After cards are discarded"}),o.jsx("option",{value:"after_draw",children:"After cards are drawn"}),o.jsx("option",{value:"after_shift",children:"After cards are shifted"}),o.jsx("option",{value:"after_flip",children:"After cards are flipped"}),o.jsx("option",{value:"after_play",children:"After a card is played"}),o.jsx("option",{value:"after_clear_cache",children:"After cache is cleared"}),o.jsx("option",{value:"after_opponent_discard",children:"After opponent discards"}),o.jsx("option",{value:"after_opponent_draw",children:"After opponent draws"}),o.jsx("option",{value:"before_compile_delete",children:"Before deleted by compile"}),o.jsx("option",{value:"when_card_returned",children:"When card returned to hand"})]})]})]}),o.jsxs("div",{style:{color:"#8A79E8",fontSize:"13px"},children:[o.jsx("strong",{children:"Position:"})," ",a.position.charAt(0).toUpperCase()+a.position.slice(1)," Box"]})]})}),o.jsxs("div",{className:"main-effect",children:[o.jsx("h3",{children:"Main Effect"}),x(a,i),o.jsxs("div",{className:"effect-preview",children:[o.jsx("strong",{children:"Preview:"})," ",o.jsx("span",{dangerouslySetInnerHTML:{__html:or([a])}})]})]}),o.jsxs("div",{style:{marginTop:"15px"},children:[o.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[o.jsx("input",{type:"checkbox",checked:!!a.useCardFromPreviousEffect,onChange:w=>t({...a,useCardFromPreviousEffect:w.target.checked})}),o.jsx("span",{children:`Use card from previous effect (for "shift THAT card", "draw equal to THAT card's value", etc.)`})]}),a.useCardFromPreviousEffect&&o.jsx("small",{style:{display:"block",marginLeft:"24px",marginTop:"4px",color:"#8A79E8"},children:"This effect will target/use the card selected by the previous effect in the chain."})]}),(a.trigger==="after_draw"||a.trigger==="after_delete"||a.trigger==="after_discard"||a.trigger==="after_shift"||a.trigger==="after_flip"||a.trigger==="after_clear_cache"||a.trigger==="after_opponent_discard"||a.trigger==="after_play")&&o.jsxs("div",{style:{marginTop:"15px"},children:[o.jsxs("label",{children:["Trigger Actor (who triggers this effect?)",o.jsxs("select",{value:a.reactiveTriggerActor||"self",onChange:w=>t({...a,reactiveTriggerActor:w.target.value}),style:{width:"100%",padding:"8px",marginTop:"5px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px",cursor:"pointer"},children:[o.jsx("option",{value:"self",children:"Only when YOU perform the action (default)"}),o.jsx("option",{value:"opponent",children:"Only when OPPONENT performs the action"}),o.jsx("option",{value:"any",children:"When ANYONE performs the action"})]})]}),o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:a.reactiveTriggerActor==="self"||!a.reactiveTriggerActor?"Effect triggers only when YOU delete/draw/etc.":a.reactiveTriggerActor==="opponent"?"Effect triggers only when OPPONENT deletes/draws/etc.":"Effect triggers when ANYONE deletes/draws/etc."})]}),(a.trigger==="after_play"||a.trigger==="after_shift"||a.trigger==="after_flip"||a.trigger==="after_delete")&&o.jsxs("div",{style:{marginTop:"15px"},children:[o.jsxs("label",{children:["Reactive Scope",o.jsxs("select",{value:a.reactiveScope||"global",onChange:w=>t({...a,reactiveScope:w.target.value}),style:{width:"100%",padding:"8px",marginTop:"5px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px",cursor:"pointer"},children:[o.jsx("option",{value:"global",children:"Any lane (default)"}),o.jsx("option",{value:"this_lane",children:"This lane only"})]})]}),o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:a.reactiveScope==="this_lane"?"Effect only triggers when the action happens in the same lane as this card.":"Effect triggers when the action happens anywhere on the board."})]}),(a.trigger==="after_draw"||a.trigger==="after_delete"||a.trigger==="after_discard"||a.trigger==="after_shift"||a.trigger==="after_flip")&&o.jsxs("div",{style:{marginTop:"15px"},children:[o.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",cursor:"pointer"},children:[o.jsx("input",{type:"checkbox",checked:a.onlyDuringOpponentTurn||!1,onChange:w=>t({...a,onlyDuringOpponentTurn:w.target.checked}),style:{width:"18px",height:"18px",cursor:"pointer"}}),"Only During Opponent's Turn"]}),o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:a.onlyDuringOpponentTurn?"Effect only triggers during your opponent's turn.":"Effect triggers during any turn."})]}),o.jsxs("div",{className:"conditional-section",style:{marginTop:"20px",borderTop:"1px solid #2c1d63",paddingTop:"15px"},children:[o.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"10px"},children:[o.jsx("input",{type:"checkbox",checked:!!a.conditional,onChange:w=>c(w.target.checked)}),o.jsx("strong",{children:"Add follow-up effect"})]}),a.conditional&&o.jsxs("div",{className:"follow-up-effect",style:{marginLeft:"20px",padding:"10px",backgroundColor:"#2c1d63",borderRadius:"4px",border:"1px solid rgba(97, 239, 255, 0.2)"},children:[o.jsx("h4",{style:{marginTop:0},children:"Follow-Up Effect"}),o.jsxs("label",{children:["Connection Type",o.jsxs("select",{value:a.conditional.type||"then",onChange:w=>d(w.target.value),style:{width:"100%",padding:"8px",marginTop:"5px",marginBottom:"15px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px",cursor:"pointer"},children:[o.jsx("option",{value:"then",children:"Then (always executes)"}),o.jsx("option",{value:"if_executed",children:"If you do (only if first effect succeeds)"})]})]}),o.jsxs("label",{children:["Effect Type",o.jsxs("select",{value:a.conditional.thenEffect.params.action,onChange:w=>u(w.target.value),style:{width:"100%",padding:"8px",marginTop:"5px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px",cursor:"pointer"},children:[o.jsx("option",{value:"draw",children:"Draw Cards"}),o.jsx("option",{value:"refresh",children:"Refresh Hand"}),o.jsx("option",{value:"mutual_draw",children:"Mutual Draw (Exchange)"}),o.jsx("option",{value:"flip",children:"Flip Cards"}),o.jsx("option",{value:"shift",children:"Shift Card"}),o.jsx("option",{value:"delete",children:"Delete Cards"}),o.jsx("option",{value:"delete_all_in_lane",children:"Delete All in Lane"}),o.jsx("option",{value:"discard",children:"Discard Cards"}),o.jsx("option",{value:"return",children:"Return to Hand"}),o.jsx("option",{value:"play",children:"Play from Hand/Deck"}),o.jsx("option",{value:"rearrange_protocols",children:"Rearrange Protocols"}),o.jsx("option",{value:"swap_protocols",children:"Swap Protocols"}),o.jsx("option",{value:"reveal",children:"Reveal Hand"}),o.jsx("option",{value:"give",children:"Give Cards"}),o.jsx("option",{value:"take",children:"Take from Hand"}),o.jsx("option",{value:"choice",children:"Either/Or Choice"}),o.jsx("option",{value:"block_compile",children:"Block Compile"}),o.jsx("option",{value:"shuffle_trash",children:"Shuffle Trash into Deck"}),o.jsx("option",{value:"shuffle_deck",children:"Shuffle Deck"}),o.jsx("option",{value:"state_number",children:"State a Number"}),o.jsx("option",{value:"state_protocol",children:"State a Protocol"}),o.jsx("option",{value:"swap_stacks",children:"Swap Stacks"}),o.jsx("option",{value:"copy_opponent_middle",children:"Copy Opponent's Middle"})]})]}),o.jsx("div",{style:{marginTop:"15px"},children:x(a.conditional.thenEffect,w=>f({...a.conditional.thenEffect,params:w}))}),o.jsxs("div",{className:"nested-conditional-section",style:{marginTop:"15px",borderTop:"1px solid rgba(97, 239, 255, 0.2)",paddingTop:"15px"},children:[o.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"10px"},children:[o.jsx("input",{type:"checkbox",checked:!!a.conditional.thenEffect.conditional,onChange:w=>p(w.target.checked)}),o.jsx("strong",{children:"Add 2nd follow-up effect"})]}),a.conditional.thenEffect.conditional&&o.jsxs("div",{className:"nested-follow-up-effect",style:{marginLeft:"10px",padding:"10px",backgroundColor:"#1A113B",borderRadius:"4px",border:"1px solid rgba(97, 239, 255, 0.2)"},children:[o.jsx("h5",{style:{marginTop:0,fontSize:"0.9rem"},children:"2nd Follow-Up Effect"}),o.jsxs("label",{children:["Connection Type",o.jsxs("select",{value:a.conditional.thenEffect.conditional.type||"then",onChange:w=>m(w.target.value),style:{width:"100%",padding:"6px",marginTop:"5px",marginBottom:"10px",backgroundColor:"#0D0825",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px",cursor:"pointer",fontSize:"0.9rem"},children:[o.jsx("option",{value:"then",children:"Then (always executes)"}),o.jsx("option",{value:"if_executed",children:"If you do (only if first effect succeeds)"})]})]}),o.jsxs("label",{children:["Effect Type",o.jsxs("select",{value:a.conditional.thenEffect.conditional.thenEffect.params.action,onChange:w=>v(w.target.value),style:{width:"100%",padding:"6px",marginTop:"5px",backgroundColor:"#0D0825",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px",cursor:"pointer",fontSize:"0.9rem"},children:[o.jsx("option",{value:"draw",children:"Draw Cards"}),o.jsx("option",{value:"refresh",children:"Refresh Hand"}),o.jsx("option",{value:"mutual_draw",children:"Mutual Draw (Exchange)"}),o.jsx("option",{value:"flip",children:"Flip Cards"}),o.jsx("option",{value:"shift",children:"Shift Card"}),o.jsx("option",{value:"delete",children:"Delete Cards"}),o.jsx("option",{value:"delete_all_in_lane",children:"Delete All in Lane"}),o.jsx("option",{value:"discard",children:"Discard Cards"}),o.jsx("option",{value:"return",children:"Return to Hand"}),o.jsx("option",{value:"play",children:"Play from Hand/Deck"}),o.jsx("option",{value:"rearrange_protocols",children:"Rearrange Protocols"}),o.jsx("option",{value:"swap_protocols",children:"Swap Protocols"}),o.jsx("option",{value:"reveal",children:"Reveal Hand"}),o.jsx("option",{value:"give",children:"Give Cards"}),o.jsx("option",{value:"take",children:"Take from Hand"}),o.jsx("option",{value:"choice",children:"Either/Or Choice"}),o.jsx("option",{value:"block_compile",children:"Block Compile"}),o.jsx("option",{value:"shuffle_trash",children:"Shuffle Trash into Deck"}),o.jsx("option",{value:"shuffle_deck",children:"Shuffle Deck"}),o.jsx("option",{value:"state_number",children:"State a Number"}),o.jsx("option",{value:"state_protocol",children:"State a Protocol"}),o.jsx("option",{value:"swap_stacks",children:"Swap Stacks"}),o.jsx("option",{value:"copy_opponent_middle",children:"Copy Opponent's Middle"})]})]}),o.jsx("div",{style:{marginTop:"10px"},children:x(a.conditional.thenEffect.conditional.thenEffect,w=>y({...a.conditional.thenEffect.conditional.thenEffect,params:w}))})]})]})]})]})]})},zb=({card:a,protocolName:t,protocolColor:l,protocolPattern:i,onChange:c,readOnly:d=!1})=>{const[f,u]=se.useState(null),[p,m]=se.useState(null),[y,v]=se.useState(!1);se.useEffect(()=>{u(null)},[a.value]);const x=(k,A,I)=>{const $={id:Ze(),params:Vb(A),position:k,trigger:I},q={...a};k==="top"?q.topEffects=[...q.topEffects,$]:k==="middle"?q.middleEffects=[...q.middleEffects,$]:q.bottomEffects=[...q.bottomEffects,$],c(q);const M=k==="top"?q.topEffects.length-1:k==="middle"?q.middleEffects.length-1:q.bottomEffects.length-1;u({box:k,effectIndex:M,effect:$})},w=(k,A)=>{m({box:k,effectIndex:A})},S=()=>{if(!p)return;const{box:k,effectIndex:A}=p,I={...a};k==="top"?I.topEffects.splice(A,1):k==="middle"?I.middleEffects.splice(A,1):I.bottomEffects.splice(A,1),c(I),f&&f.box===k&&f.effectIndex===A&&u(null),m(null)},E=k=>{if(!f)return;const{box:A,effectIndex:I}=f,$={...a};A==="top"?($.topEffects=[...$.topEffects],$.topEffects[I]=k):A==="middle"?($.middleEffects=[...$.middleEffects],$.middleEffects[I]=k):($.bottomEffects=[...$.bottomEffects],$.bottomEffects[I]=k),c($),u({box:A,effectIndex:I,effect:k})},b=(k,A)=>{const I=k==="top"?a.topEffects[A]:k==="middle"?a.middleEffects[A]:a.bottomEffects[A];u({box:k,effectIndex:A,effect:I})},j=(k,A)=>{const I=(A==null?void 0:A.reactiveTriggerActor)||"self",$=(A==null?void 0:A.reactiveScope)||"global";if(k==="after_play")return`After ${I==="opponent"?"your opponent plays":I==="any"?"a card is played":"you play"} a card${$==="this_lane"?" in this line":""}`;if(["after_delete","after_discard","after_draw","after_shift","after_flip"].includes(k)){const q={after_delete:"delete cards",after_discard:"discard cards",after_draw:"draw cards",after_shift:"shift cards",after_flip:"flip cards"},M=I==="opponent"?"your opponent":I==="any"?"anyone":"you",B=$==="this_lane"?" in this line":"";return`After ${M} ${q[k]}${B}`}switch(k){case"passive":return"";case"on_play":return"";case"start":return"Start";case"end":return"End";case"on_cover":return"On Cover";case"after_opponent_discard":return"After opponent discards";case"after_clear_cache":return"After you clear cache";case"before_compile_delete":return"Before deleted by compile";case"on_flip":return"When this card would be flipped";case"on_cover_or_flip":return"When covered or flipped";default:return k}},C=k=>{const A={...a,value:k};c(A)},R=or(a.topEffects),F=or(a.middleEffects),L=or(a.bottomEffects),O=JSON.stringify({top:a.topEffects.map(k=>({id:k.id,params:k.params})),middle:a.middleEffects.map(k=>({id:k.id,params:k.params})),bottom:a.bottomEffects.map(k=>({id:k.id,params:k.params}))}),T=`${t}-${a.value}-${O}`,G={id:T,protocol:t,value:a.value,top:R,middle:F,bottom:L,isFaceUp:!0,owner:"player",laneIndex:0,category:"Custom",keywords:{}},V=(k,A)=>{k=k.replace("#","");const I=parseInt(k.substring(0,2),16),$=parseInt(k.substring(2,4),16),q=parseInt(k.substring(4,6),16);return`rgba(${I}, ${$}, ${q}, ${A})`},z=`card-custom-preview pattern-${i}`,U={"--custom-color":l,"--custom-color-alpha-05":V(l,.05),"--custom-color-alpha-06":V(l,.06),"--custom-color-alpha-08":V(l,.08),"--custom-color-alpha-10":V(l,.1),"--custom-color-alpha-15":V(l,.15),"--custom-color-alpha-20":V(l,.2),"--custom-color-alpha-25":V(l,.25),borderColor:l};return o.jsxs("div",{className:"card-editor-container",children:[o.jsxs("div",{className:"card-editor-content",children:[o.jsxs("div",{className:"card-live-preview",children:[o.jsx("h4",{children:"Card Preview"}),o.jsxs("label",{className:"card-value-selector",children:["Card Value:",o.jsxs("select",{value:a.value,onChange:k=>C(Number(k.target.value)),children:[o.jsx("option",{value:-1,children:"-1"}),o.jsx("option",{value:0,children:"0"}),o.jsx("option",{value:1,children:"1"}),o.jsx("option",{value:2,children:"2"}),o.jsx("option",{value:3,children:"3"}),o.jsx("option",{value:4,children:"4"}),o.jsx("option",{value:5,children:"5"}),o.jsx("option",{value:6,children:"6"})]})]}),o.jsx("div",{className:"card-preview-wrapper",style:U,children:o.jsx(bt,{card:G,isFaceUp:!0,additionalClassName:z},T)})]}),o.jsx("div",{className:"card-effects-editor",children:o.jsxs("div",{className:"card-preview",style:{borderColor:l},children:[o.jsx("div",{className:"card-header",style:{backgroundColor:l},children:o.jsxs("h3",{children:[t,"-",a.value]})}),o.jsxs("div",{className:"card-box top-box",children:[o.jsx("h4",{children:"Top Box (Passive/Reactive)"}),o.jsx("p",{className:"box-description",children:"Passive effects or reactive triggers"}),o.jsxs("div",{className:"effects-list",children:[a.topEffects.map((k,A)=>o.jsxs("div",{className:"effect-item",children:[o.jsxs("span",{onClick:()=>b("top",A),className:d?"read-only-clickable":"",children:[k.trigger!=="passive"&&o.jsxs("strong",{children:[j(k.trigger,k),":"]})," ",Gr(k)]}),!d&&o.jsx("button",{onClick:()=>w("top",A),children:""})]},k.id)),a.topEffects.length===0&&o.jsx("p",{className:"empty-box",children:"No effects"})]}),!d&&o.jsxs("div",{className:"add-effect-controls",children:[o.jsxs("select",{id:"top-trigger",defaultValue:"",children:[o.jsx("option",{value:"",children:"Choose Trigger"}),o.jsx("optgroup",{label:"Passive",children:o.jsx("option",{value:"passive",children:"Passive (always active)"})}),o.jsxs("optgroup",{label:"Phase Triggers",children:[o.jsx("option",{value:"start",children:"Start Phase"}),o.jsx("option",{value:"end",children:"End Phase"}),o.jsx("option",{value:"on_cover",children:"On Cover"})]}),o.jsxs("optgroup",{label:"Reactive Triggers",children:[o.jsx("option",{value:"after_delete",children:"After you delete cards"}),o.jsx("option",{value:"after_opponent_discard",children:"After opponent discards"}),o.jsx("option",{value:"after_draw",children:"After you draw cards"}),o.jsx("option",{value:"after_clear_cache",children:"After you clear cache"}),o.jsx("option",{value:"before_compile_delete",children:"Before deleted by compile"}),o.jsx("option",{value:"after_flip",children:"After cards are flipped"}),o.jsx("option",{value:"after_shift",children:"After cards are shifted"}),o.jsx("option",{value:"after_play",children:"After cards are played"}),o.jsx("option",{value:"on_flip",children:"When this card would be flipped"}),o.jsx("option",{value:"on_cover_or_flip",children:"When this card would be covered or flipped"})]})]}),o.jsxs("select",{id:"top-action",defaultValue:"",children:[o.jsx("option",{value:"",children:"Choose Action"}),o.jsx("option",{value:"draw",children:"Draw Cards"}),o.jsx("option",{value:"refresh",children:"Refresh Hand"}),o.jsx("option",{value:"mutual_draw",children:"Mutual Draw (Exchange)"}),o.jsx("option",{value:"flip",children:"Flip Cards"}),o.jsx("option",{value:"shift",children:"Shift Card"}),o.jsx("option",{value:"delete",children:"Delete Cards"}),o.jsx("option",{value:"discard",children:"Discard Cards"}),o.jsx("option",{value:"return",children:"Return to Hand"}),o.jsx("option",{value:"play",children:"Play from Hand/Deck"}),o.jsx("option",{value:"rearrange_protocols",children:"Rearrange Protocols"}),o.jsx("option",{value:"swap_protocols",children:"Swap Protocols"}),o.jsx("option",{value:"reveal",children:"Reveal Hand"}),o.jsx("option",{value:"give",children:"Give Cards"}),o.jsx("option",{value:"take",children:"Take from Hand"}),o.jsx("option",{value:"choice",children:"Either/Or Choice"}),o.jsx("option",{value:"passive_rule",children:"Passive Rule"}),o.jsx("option",{value:"value_modifier",children:"Value Modifier"}),o.jsx("option",{value:"block_compile",children:"Block Compile"}),o.jsx("option",{value:"delete_all_in_lane",children:"Delete All in Lane"})]}),o.jsx("button",{className:"btn btn-add-effect",onClick:()=>{const k=document.getElementById("top-trigger"),A=document.getElementById("top-action"),I=k.value,$=A.value;I&&$?(x("top",$,I),k.value="",A.value=""):v(!0)},children:"+"})]})]}),o.jsxs("div",{className:"card-box middle-box",children:[o.jsx("h4",{children:"Middle Box (On Play)"}),o.jsx("p",{className:"box-description",children:"When played or uncovered"}),o.jsxs("div",{className:"effects-list",children:[a.middleEffects.map((k,A)=>o.jsxs("div",{className:"effect-item",children:[o.jsx("span",{onClick:()=>b("middle",A),className:d?"read-only-clickable":"",children:Gr(k)}),!d&&o.jsx("button",{onClick:()=>w("middle",A),children:""})]},k.id)),a.middleEffects.length===0&&o.jsx("p",{className:"empty-box",children:"No effects"})]}),!d&&o.jsxs("select",{onChange:k=>{k.target.value&&(x("middle",k.target.value,"on_play"),k.target.value="")},children:[o.jsx("option",{value:"",children:"+ Add Effect"}),o.jsx("option",{value:"draw",children:"Draw Cards"}),o.jsx("option",{value:"refresh",children:"Refresh Hand"}),o.jsx("option",{value:"flip",children:"Flip Cards"}),o.jsx("option",{value:"shift",children:"Shift Card"}),o.jsx("option",{value:"delete",children:"Delete Cards"}),o.jsx("option",{value:"discard",children:"Discard Cards"}),o.jsx("option",{value:"return",children:"Return to Hand"}),o.jsx("option",{value:"play",children:"Play from Hand/Deck"}),o.jsx("option",{value:"rearrange_protocols",children:"Rearrange Protocols"}),o.jsx("option",{value:"swap_protocols",children:"Swap Protocols"}),o.jsx("option",{value:"reveal",children:"Reveal Hand"}),o.jsx("option",{value:"give",children:"Give Cards"}),o.jsx("option",{value:"take",children:"Take from Hand"}),o.jsx("option",{value:"choice",children:"Either/Or Choice"}),o.jsx("option",{value:"passive_rule",children:"Passive Rule"}),o.jsx("option",{value:"value_modifier",children:"Value Modifier"}),o.jsx("option",{value:"block_compile",children:"Block Compile"}),o.jsx("option",{value:"delete_all_in_lane",children:"Delete All in Lane"})]})]}),o.jsxs("div",{className:"card-box bottom-box",children:[o.jsx("h4",{children:"Bottom Box (Triggered)"}),o.jsx("p",{className:"box-description",children:"Only when uncovered AND face-up"}),o.jsxs("div",{className:"effects-list",children:[a.bottomEffects.map((k,A)=>o.jsxs("div",{className:"effect-item",children:[o.jsxs("span",{onClick:()=>b("bottom",A),className:d?"read-only-clickable":"",children:[o.jsxs("strong",{children:[j(k.trigger,k),":"]})," ",Gr(k)]}),!d&&o.jsx("button",{onClick:()=>w("bottom",A),children:""})]},k.id)),a.bottomEffects.length===0&&o.jsx("p",{className:"empty-box",children:"No effects"})]}),!d&&o.jsxs("div",{className:"bottom-effect-add",children:[o.jsxs("select",{id:"bottom-trigger",children:[o.jsx("option",{value:"",children:"1. Choose Trigger"}),o.jsx("option",{value:"start",children:"Start Phase"}),o.jsx("option",{value:"end",children:"End Phase"}),o.jsx("option",{value:"on_cover",children:"On Cover"})]}),o.jsxs("select",{id:"bottom-action",children:[o.jsx("option",{value:"",children:"2. Choose Effect"}),o.jsx("option",{value:"draw",children:"Draw Cards"}),o.jsx("option",{value:"refresh",children:"Refresh Hand"}),o.jsx("option",{value:"mutual_draw",children:"Mutual Draw (Exchange)"}),o.jsx("option",{value:"flip",children:"Flip Cards"}),o.jsx("option",{value:"shift",children:"Shift Card"}),o.jsx("option",{value:"delete",children:"Delete Cards"}),o.jsx("option",{value:"discard",children:"Discard Cards"}),o.jsx("option",{value:"return",children:"Return to Hand"}),o.jsx("option",{value:"play",children:"Play from Hand/Deck"}),o.jsx("option",{value:"rearrange_protocols",children:"Rearrange Protocols"}),o.jsx("option",{value:"swap_protocols",children:"Swap Protocols"}),o.jsx("option",{value:"reveal",children:"Reveal Hand"}),o.jsx("option",{value:"give",children:"Give Cards"}),o.jsx("option",{value:"take",children:"Take from Hand"}),o.jsx("option",{value:"choice",children:"Either/Or Choice"}),o.jsx("option",{value:"passive_rule",children:"Passive Rule"}),o.jsx("option",{value:"value_modifier",children:"Value Modifier"}),o.jsx("option",{value:"block_compile",children:"Block Compile"}),o.jsx("option",{value:"delete_all_in_lane",children:"Delete All in Lane"})]}),o.jsx("button",{className:"btn btn-add-effect",onClick:()=>{const k=document.getElementById("bottom-trigger"),A=document.getElementById("bottom-action"),I=k.value,$=A.value;I&&$?(x("bottom",$,I),k.value="",A.value=""):v(!0)},children:"+"})]})]})]})})]}),f&&o.jsxs("div",{className:"effect-parameter-editor",children:[o.jsx("h3",{children:d?"View Effect":"Configure Effect"}),d&&o.jsx("div",{className:"read-only-notice",children:"This effect is read-only"}),o.jsx(Hb,{effect:f.effect,onChange:E,readOnly:d}),o.jsx("button",{onClick:()=>u(null),className:"btn",children:d?"Close":"Done"})]}),p&&o.jsx("div",{className:"custom-protocol-modal-overlay",onClick:()=>m(null),children:o.jsxs("div",{className:"custom-protocol-modal-content",onClick:k=>k.stopPropagation(),children:[o.jsx("h3",{children:"Delete Effect"}),o.jsx("p",{children:"Are you sure you want to delete this effect?"}),o.jsxs("div",{className:"custom-protocol-modal-actions",children:[o.jsx("button",{onClick:()=>m(null),className:"btn btn-back",children:"Cancel"}),o.jsx("button",{onClick:S,className:"btn btn-delete",children:"Delete"})]})]})}),y&&o.jsx("div",{className:"custom-protocol-modal-overlay",onClick:()=>v(!1),children:o.jsxs("div",{className:"custom-protocol-modal-content",onClick:k=>k.stopPropagation(),children:[o.jsx("h3",{children:"Missing Selection"}),o.jsx("p",{children:"Please select both a trigger and an effect before adding."}),o.jsx("div",{className:"custom-protocol-modal-actions",children:o.jsx("button",{onClick:()=>v(!1),className:"btn",children:"OK"})})]})})]})},Vb=a=>{switch(a){case"draw":return{action:"draw",count:1,target:"self",source:"own_deck"};case"flip":return{action:"flip",count:1,targetFilter:{owner:"any",position:"any",faceState:"any",excludeSelf:!1},optional:!1};case"shift":return{action:"shift",targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1}};case"delete":return{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"any"},excludeSelf:!0};case"discard":return{action:"discard",count:1,actor:"self"};case"return":return{action:"return",count:1,targetFilter:{},scope:{type:"any_card"}};case"play":return{action:"play",source:"hand",count:1,faceDown:!0,destinationRule:{type:"other_lines"}};case"rearrange_protocols":return{action:"rearrange_protocols",target:"own"};case"swap_protocols":return{action:"swap_protocols",target:"own"};case"reveal":case"give":return{action:a,source:"own_hand",count:1};case"take":return{action:"take",source:"opponent_hand",count:1,random:!0};case"choice":return{action:"choice",options:[]};case"passive_rule":return{action:"passive_rule",rule:{type:"block_all_play",target:"opponent",scope:"this_lane"}};case"value_modifier":return{action:"value_modifier",modifier:{type:"add_per_condition",value:1,condition:"per_face_down_card",target:"own_total",scope:"this_lane"}};default:return{}}},Bb=(a,t)=>{const l=(c,d)=>{c=c.replace("#","");const f=parseInt(c.substring(0,2),16),u=parseInt(c.substring(2,4),16),p=parseInt(c.substring(4,6),16);return`rgba(${f}, ${u}, ${p}, ${d})`},i={borderColor:t};switch(a){case"solid":return{...i,backgroundColor:t};case"radial":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`radial-gradient(circle at 50% 50%, ${l(t,.25)} 0%, transparent 60%)`};case"dual-radial":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 0% 0%, ${l(t,.2)}, transparent 50%),
                    radial-gradient(at 100% 100%, ${l(t,.2)}, transparent 50%)
                `};case"multi-radial":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 0%, ${l(t,.2)}, transparent 70%),
                    radial-gradient(circle at 20% 30%, ${l(t,.15)}, transparent 40%),
                    radial-gradient(circle at 80% 70%, ${l(t,.2)}, transparent 50%)
                `};case"chaos":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 10% 10%, hsla(60, 100%, 50%, 0.15), transparent 30%),
                    radial-gradient(at 90% 20%, hsla(180, 100%, 50%, 0.15), transparent 35%),
                    radial-gradient(at 30% 80%, hsla(300, 100%, 50%, 0.15), transparent 40%),
                    radial-gradient(at 70% 60%, hsla(0, 100%, 50%, 0.1), transparent 25%)
                `};case"grid":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(circle at 50% 50%, ${l(t,.2)} 0%, transparent 40%),
                    linear-gradient(hsla(0,0%,100%,0.03) 1px, transparent 1px),
                    linear-gradient(90deg, hsla(0,0%,100%,0.03) 1px, transparent 1px)
                `,backgroundSize:"100% 100%, 20px 20px, 20px 20px"};case"diagonal-lines":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 0% 100%, ${l(t,.25)}, transparent 70%),
                    repeating-linear-gradient(120deg, transparent, transparent 15px, ${l(t,.05)} 15px, ${l(t,.05)} 30px)
                `};case"cross-diagonal":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 50%, ${l(t,.25)} 0%, transparent 50%),
                    repeating-linear-gradient(45deg, transparent, transparent 8px, ${l(t,.08)} 8px, ${l(t,.08)} 16px),
                    repeating-linear-gradient(-45deg, transparent, transparent 8px, ${l(t,.06)} 8px, ${l(t,.06)} 16px)
                `};case"horizontal-lines":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 80% 80%, ${l(t,.1)}, transparent 50%),
                    repeating-linear-gradient(0deg, hsla(0,0%,100%,0.02), hsla(0,0%,100%,0.02) 1px, transparent 1px, transparent 3px)
                `};case"vertical-lines":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 10% 10%, ${l(t,.2)}, transparent 50%),
                    repeating-linear-gradient(175deg, transparent, transparent 1px, ${l(t,.05)} 1px, ${l(t,.05)} 2px)
                `};case"cross":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    linear-gradient(0deg, transparent 40%, ${l(t,.1)} 50%, transparent 60%),
                    linear-gradient(90deg, transparent 48%, ${l(t,.2)} 50%, transparent 52%)
                `};case"hexagons":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 0%, ${l(t,.2)}, transparent 70%),
                    url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='28' height='49' viewBox='0 0 28 49'%3E%3Cg fill-rule='evenodd'%3E%3Cg id='hexagons' fill='%23ffffff' fill-opacity='0.05' fill-rule='nonzero'%3E%3Cpath d='M13.99 9.25l13 7.5v15l-13 7.5L1 31.75v-15l12.99-7.5zM3 17.9v12.7l10.99 6.34 11-6.35V17.9l-11-6.34L3 17.9zM0 15l12.99-7.5L26 15v18.5l-13 7.5L0 33.5V15z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")
                `};case"stripes":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 100%, ${l(t,.25)}, transparent 60%),
                    linear-gradient(135deg, hsla(0,0%,0%,0.1) 23%, transparent 23%, transparent 25%, hsla(0,0%,0%,0.1) 25%, hsla(0,0%,0%,0.1) 27%, transparent 27%, transparent 73%, hsla(0,0%,0%,0.1) 73%, hsla(0,0%,0%,0.1) 75%, transparent 75%, transparent 77%, hsla(0,0%,0%,0.1) 77%)
                `};case"frost":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(circle at 50% 50%, ${l(t,.2)} 0%, transparent 50%),
                    repeating-linear-gradient(30deg, transparent, transparent 10px, ${l(t,.08)} 10px, ${l(t,.08)} 11px),
                    repeating-linear-gradient(-30deg, transparent, transparent 10px, ${l(t,.08)} 10px, ${l(t,.08)} 11px),
                    repeating-linear-gradient(90deg, transparent, transparent 8px, ${l(t,.05)} 8px, ${l(t,.05)} 9px)
                `};default:return i}},Yb=[{name:"Anarchy",hex:"#EA5A3C"},{name:"Apathy",hex:"#989A9A"},{name:"Chaos",hex:"#E53FE5"},{name:"Darkness",hex:"#A772D4"},{name:"Death",hex:"#E25656"},{name:"Fire",hex:"#F06838"},{name:"Gravity",hex:"#7599EB"},{name:"Hate",hex:"#E03E5E"},{name:"Life",hex:"#3CE076"},{name:"Light",hex:"#FFEB7F"},{name:"Love",hex:"#F074D9"},{name:"Metal",hex:"#B3B8BD"},{name:"Plague",hex:"#A2CD3A"},{name:"Psychic",hex:"#C971EB"},{name:"Speed",hex:"#33DDDD"},{name:"Spirit",hex:"#42D4A8"},{name:"Water",hex:"#3FA4EB"}],Gb=[{name:"Solid",value:"solid",description:"Solid color background"},{name:"Radial Glow",value:"radial",description:"Single radial gradient glow"},{name:"Dual Radial",value:"dual-radial",description:"Two radial gradient spots"},{name:"Multi Radial",value:"multi-radial",description:"Multiple radial gradient spots"},{name:"Chaos",value:"chaos",description:"Colorful chaotic spots"},{name:"Grid",value:"grid",description:"Grid line pattern"},{name:"Diagonal Lines",value:"diagonal-lines",description:"Repeating diagonal lines"},{name:"Cross Diagonal",value:"cross-diagonal",description:"Crossed diagonal lines"},{name:"Horizontal Lines",value:"horizontal-lines",description:"Fine horizontal lines"},{name:"Vertical Lines",value:"vertical-lines",description:"Fine vertical lines"},{name:"Cross Pattern",value:"cross",description:"Cross/plus pattern"},{name:"Hexagons",value:"hexagons",description:"Hexagon pattern"},{name:"Stripes",value:"stripes",description:"Diagonal stripe pattern"},{name:"Frost",value:"frost",description:"Icy crystalline pattern with crossing lines"}],Wb=({onSave:a,onCancel:t,onDelete:l,initialProtocol:i})=>{const[c,d]=se.useState("name"),[f,u]=se.useState(0),[p,m]=se.useState(!1),[y,v]=se.useState(""),[x,w]=se.useState(!1),S=i?Qr(i):!1;console.log("ProtocolWizard render - initialProtocol:",i,"isReadOnly:",S);const[E,b]=se.useState((i==null?void 0:i.name)||""),[j,C]=se.useState((i==null?void 0:i.description)||""),[R,F]=se.useState((i==null?void 0:i.color)||"#1976D2"),[L,O]=se.useState((i==null?void 0:i.pattern)||"solid"),[T,G]=se.useState((i==null?void 0:i.cards)||[{value:0,topEffects:[],middleEffects:[],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[],bottomEffects:[]}]);console.log("ProtocolWizard state - name:",E,"color:",R,"pattern:",L);const V=()=>{if(c==="name"){if(!E.trim()){alert("Please enter a protocol name.");return}d("color")}else c==="color"?d("pattern"):c==="pattern"&&d("cards")},z=M=>{const B=[...T];B[f]=M,G(B)},U=()=>{const M={id:(i==null?void 0:i.id)||Ze(),name:E,description:j,author:"Player",createdAt:(i==null?void 0:i.createdAt)||new Date().toISOString(),color:R,pattern:L,cards:T};a(M)},k=()=>{i&&l&&l(i.id),w(!1)},A=()=>{const M={id:(i==null?void 0:i.id)||Ze(),name:E,description:j,author:"Player",createdAt:(i==null?void 0:i.createdAt)||new Date().toISOString(),color:R,pattern:L,cards:T},B=JSON.stringify(M,null,2);v(B),m(!0)},I=()=>{navigator.clipboard.writeText(y).then(()=>{alert("Protocol JSON copied to clipboard!"),m(!1)}).catch(()=>{alert("Failed to copy to clipboard. Please try again.")})},$=M=>!(!E.trim()&&M!=="name"),q=M=>{if(!$(M)){alert("Please enter a protocol name first.");return}d(M)};return o.jsxs("div",{className:"protocol-wizard",children:[o.jsxs("div",{className:"wizard-header",children:[o.jsxs("h2",{children:[S?`View Protocol: ${E}`:i?`Edit Protocol: ${E}`:"Create New Protocol",S&&o.jsx("span",{className:"read-only-badge",children:"Read-Only"})]}),o.jsxs("div",{className:"wizard-progress",children:[o.jsx("button",{className:`step ${c==="name"?"active":"done"}`,onClick:()=>q("name"),type:"button",children:"1. Name"}),o.jsx("button",{className:`step ${c==="color"?"active":c==="pattern"||c==="cards"?"done":""}`,onClick:()=>q("color"),disabled:!$("color"),type:"button",children:"2. Color"}),o.jsx("button",{className:`step ${c==="pattern"?"active":c==="cards"?"done":""}`,onClick:()=>q("pattern"),disabled:!$("pattern"),type:"button",children:"3. Pattern"}),o.jsx("button",{className:`step ${c==="cards"?"active":""}`,onClick:()=>q("cards"),disabled:!$("cards"),type:"button",children:"4. Cards"})]})]}),o.jsxs("div",{className:"wizard-content",children:[c==="name"&&o.jsxs("div",{className:"wizard-step name-step",children:[o.jsx("h3",{children:"Step 1: Name and Description"}),o.jsxs("label",{children:["Protocol Name *",o.jsx("input",{type:"text",value:E,onChange:M=>!S&&b(M.target.value),placeholder:"e.g. Lightning, Shadow, Void",autoFocus:!0,readOnly:S,className:S?"read-only":""})]}),o.jsxs("label",{children:["Description",o.jsx("textarea",{value:j,onChange:M=>!S&&C(M.target.value),placeholder:"Describe the strategy and theme of your protocol",rows:4,readOnly:S,className:S?"read-only":""})]})]}),c==="color"&&o.jsxs("div",{className:"wizard-step color-step",children:[o.jsx("h3",{children:"Step 2: Choose Color"}),o.jsx("div",{className:"color-preview",style:{backgroundColor:R},children:o.jsx("span",{children:E||"Your Protocol"})}),o.jsx("h4",{children:"Predefined Colors"}),o.jsx("div",{className:`color-grid ${S?"read-only":""}`,children:Yb.map(M=>o.jsx("button",{className:`color-option ${R===M.hex?"selected":""}`,style:{backgroundColor:M.hex},onClick:()=>!S&&F(M.hex),title:M.name,disabled:S,children:R===M.hex&&""},M.hex))}),o.jsx("h4",{children:"Custom Color"}),o.jsxs("div",{className:"custom-color",children:[o.jsx("input",{type:"color",value:R,onChange:M=>!S&&F(M.target.value),disabled:S}),o.jsx("input",{type:"text",value:R,onChange:M=>!S&&F(M.target.value),placeholder:"#1976D2",readOnly:S,className:S?"read-only":""})]})]}),c==="pattern"&&o.jsxs("div",{className:"wizard-step pattern-step",children:[o.jsx("h3",{children:"Step 3: Choose Card Pattern"}),o.jsx("div",{className:`pattern-selection-grid ${S?"read-only":""}`,children:Gb.map(M=>{const B=Bb(M.value,R);return o.jsxs("div",{className:`pattern-option ${L===M.value?"selected":""}`,onClick:()=>!S&&O(M.value),children:[o.jsxs("div",{className:"pattern-preview",style:B,children:[E||"Protocol","-0"]}),o.jsx("h4",{children:M.name}),o.jsx("p",{children:M.description}),L===M.value&&o.jsx("div",{className:"selected-badge",children:" Selected"})]},M.value)})})]}),c==="cards"&&o.jsxs("div",{className:"wizard-step cards-step",children:[o.jsx("h3",{children:"Step 4: Configure Cards"}),o.jsx("div",{className:"card-navigation",children:T.map((M,B)=>o.jsxs("button",{className:`card-nav-btn ${f===B?"active":""}`,onClick:()=>u(B),type:"button",children:["Card ",M.value]},B))}),o.jsx(zb,{card:T[f],protocolName:E,protocolColor:R,protocolPattern:L,onChange:z,readOnly:S})]})]}),o.jsxs("div",{className:"wizard-actions",children:[o.jsxs("div",{className:"wizard-actions-left",children:[o.jsx("button",{onClick:t,className:"btn btn-back",children:S?"Back":"Cancel"}),i&&l&&!S&&o.jsx("button",{onClick:()=>w(!0),className:"btn btn-delete",children:"Delete Protocol"})]}),o.jsxs("div",{className:"wizard-actions-right",children:[i&&o.jsxs(o.Fragment,{children:[o.jsx("button",{onClick:A,className:"btn btn-export",children:"Export JSON"}),!S&&o.jsx("button",{onClick:U,className:"btn",children:"Save"})]}),!i&&o.jsxs(o.Fragment,{children:[c!=="cards"&&o.jsx("button",{onClick:V,className:"btn",children:"Next"}),c==="cards"&&o.jsxs(o.Fragment,{children:[o.jsx("button",{onClick:A,className:"btn btn-export",children:"Export JSON"}),o.jsx("button",{onClick:U,className:"btn",children:"Save"})]})]})]})]}),p&&o.jsx("div",{className:"custom-protocol-modal-overlay",onClick:()=>m(!1),children:o.jsxs("div",{className:"custom-protocol-modal-content custom-protocol-modal-large",onClick:M=>M.stopPropagation(),children:[o.jsx("h3",{children:"Export Protocol JSON"}),o.jsx("p",{children:"Copy the JSON below to share or backup your protocol:"}),o.jsx("textarea",{value:y,readOnly:!0,rows:15,className:"export-textarea",onClick:M=>M.target.select()}),o.jsxs("div",{className:"custom-protocol-modal-actions",children:[o.jsx("button",{onClick:()=>m(!1),className:"btn btn-back",children:"Close"}),o.jsx("button",{onClick:I,className:"btn",children:"Copy to Clipboard"})]})]})}),x&&o.jsx("div",{className:"custom-protocol-modal-overlay",onClick:()=>w(!1),children:o.jsxs("div",{className:"custom-protocol-modal-content",onClick:M=>M.stopPropagation(),children:[o.jsx("h3",{children:"Delete Protocol"}),o.jsxs("p",{children:['Are you sure you want to delete "',E,'"?']}),o.jsx("p",{style:{color:"var(--danger-color)",fontSize:"0.9rem"},children:"This action cannot be undone."}),o.jsxs("div",{className:"custom-protocol-modal-actions",children:[o.jsx("button",{onClick:()=>w(!1),className:"btn btn-back",children:"Cancel"}),o.jsx("button",{onClick:k,className:"btn btn-delete",children:"Delete"})]})]})})]})},Qb=({onBack:a})=>{const[t,l]=se.useState("list"),[i,c]=se.useState([]),[d,f]=se.useState(void 0);se.useEffect(()=>{u()},[]);const u=()=>{const S=sr();c(S)},p=()=>{f(void 0),l("create")},m=S=>{console.log("handleEdit called with protocol:",S),f(S),l("edit"),console.log("View set to edit, editingProtocol:",S)},y=S=>{a0(S),Yl(),u(),l("list"),f(void 0)},v=S=>{_t(S),Yl(),u(),l("list"),f(void 0)},x=S=>{_t(S),Yl(),u()},w=()=>{l("list"),f(void 0)};return o.jsxs("div",{className:"custom-protocol-creator",children:[t==="list"&&o.jsx(l0,{protocols:i,onCreateNew:p,onEdit:m,onDelete:y,onImport:x,onBack:a}),(t==="create"||t==="edit")&&o.jsx(Wb,{onSave:v,onCancel:w,onDelete:y,initialProtocol:d})]})},Xb={id:"spirit-1-example",protocol:"Spirit",value:1,top:"When you play cards face-up, they may be played without matching protocols.",middle:"Draw 2 cards.",bottom:'<span class="emphasis">Start:</span> Either discard 1 card or flip this card.',isFaceUp:!0,category:"Main 1",keywords:{}},Zb={id:"face-down-example",protocol:"Spirit",value:1,top:"",middle:"",bottom:"",isFaceUp:!1,category:"Main 1",keywords:{}},Kb=[{id:"opp-light-4",protocol:"Light",value:4,top:"",middle:"Your opponent reveals their hand.",bottom:"",isFaceUp:!0,category:"Main 1",keywords:{reveal:!0}}],Jb=[{id:"opp-spirit-3",protocol:"Spirit",value:3,top:"<div><span class='emphasis'>After you draw cards:</span> You may shift this card, even if this card is covered.</div>",middle:"",bottom:"",isFaceUp:!0,category:"Main 1",keywords:{shift:!0}},{id:"opp-spirit-2",protocol:"Spirit",value:2,top:"",middle:"You may flip 1 card.",bottom:"",isFaceUp:!0,category:"Main 1",keywords:{flip:!0}}],eE=[{id:"opp-water-3",protocol:"Water",value:3,top:"",middle:"Return all cards with a value of 2 in 1 line.",bottom:"",isFaceUp:!0,category:"Main 1",keywords:{return:!0}}],tE=[{id:"player-darkness-5",protocol:"Darkness",value:5,top:"",middle:"You discard 1 card.",bottom:"",isFaceUp:!0,category:"Main 1",keywords:{discard:!0}},{id:"player-facedown-0",protocol:"Darkness",value:2,top:"",middle:"",bottom:"",isFaceUp:!1,category:"Main 1",keywords:{}}],nE=[{id:"player-plague-1",protocol:"Plague",value:1,top:"<div><span class='emphasis'>After your opponent discards cards:</span> Draw 1 card.</div>",middle:"Your opponent discards 1 card.",bottom:"",isFaceUp:!0,category:"Main 1",keywords:{draw:!0,discard:!0}},{id:"player-plague-5",protocol:"Plague",value:5,top:"",middle:"You discard 1 card.",bottom:"",isFaceUp:!0,category:"Main 1",keywords:{discard:!0}},{id:"player-plague-4",protocol:"Plague",value:4,top:"",middle:"",bottom:"<div><span class='emphasis'>End:</span> Your opponent deletes 1 of their face-down cards. You may flip this card.</div>",isFaceUp:!0,category:"Main 1",keywords:{delete:!0,flip:!0}}],aE=[{id:"player-death-0",protocol:"Death",value:0,top:"",middle:"Delete 1 card from each other line.",bottom:"",isFaceUp:!0,category:"Main 1",keywords:{delete:!0}},{id:"player-facedown-3",protocol:"Death",value:2,top:"",middle:"",bottom:"",isFaceUp:!1,category:"Main 1",keywords:{}}],No={opponent:["Light","Spirit","Water"],player:["Darkness","Plague","Death"],opponentCompiled:[!0,!1,!1],playerCompiled:[!1,!1,!1],opponentValues:[4,5,3],playerValues:[7,10,2]};function oE({onBack:a}){const t=[Kb,Jb,eE],l=[tE,nE,aE];return o.jsxs("div",{className:"screen rules-screen",children:[o.jsx(Cc,{title:"GAME RULES",onBack:a}),o.jsxs("div",{className:"rules-content",children:[o.jsxs("section",{className:"rules-section",children:[o.jsx("h2",{className:"section-title",children:"Objective"}),o.jsxs("div",{className:"rules-text",children:[o.jsxs("p",{children:["You play as an artificial intelligence trying to ",o.jsx("span",{className:"emphasis",children:"compile your 3 protocols"}),". Play command cards on protocols and execute their effects. If you reach a total value of",o.jsx("span",{className:"emphasis",children:" at least 10"})," with your cards on a protocol and exceed the opponent's total value in the same line, you may compile that protocol."]}),o.jsx("p",{className:"rules-highlight",children:"The first player to compile all 3 protocols wins!"})]})]}),o.jsxs("section",{className:"rules-section field-overview-section",children:[o.jsx("h2",{className:"section-title",children:"The Field"}),o.jsx("div",{className:"field-intro",children:o.jsxs("p",{children:["The field consists of ",o.jsx("span",{className:"emphasis",children:"3 lines"}),", each passing through two opposing protocols. Both players place cards on their side of each line. The goal is to build up value in your stacks to reach the compile threshold."]})}),o.jsxs("div",{className:"demo-board-container",children:[o.jsxs("div",{className:"demo-board",children:[o.jsx("div",{className:"demo-side-label opponent-label",children:"Opponent"}),o.jsx("div",{className:"demo-player-side demo-opponent-side",children:o.jsx("div",{className:"demo-lanes",children:t.map((i,c)=>o.jsx("div",{className:`demo-lane ${No.opponentCompiled[c]?"demo-lane-compiled":""}`,children:o.jsx("div",{className:"demo-lane-stack",children:i.map((d,f)=>o.jsx(bt,{card:d,isFaceUp:d.isFaceUp,style:{"--i":f},faceDownValue:2},d.id))})},`opp-lane-${c}`))})}),o.jsxs("div",{className:"demo-protocol-bars-container",children:[o.jsx("div",{className:"demo-protocol-bar demo-opponent-bar",children:No.opponent.map((i,c)=>o.jsxs("div",{className:`demo-protocol-display ${No.opponentCompiled[c]?"compiled":""}`,children:[o.jsx("span",{className:"demo-protocol-name",children:i}),o.jsx("span",{className:"demo-protocol-value",children:No.opponentValues[c]})]},`opp-proto-${c}`))}),o.jsx("div",{className:"demo-protocol-bar demo-player-bar",children:No.player.map((i,c)=>o.jsxs("div",{className:`demo-protocol-display ${No.playerCompiled[c]?"compiled":""}`,children:[o.jsx("span",{className:"demo-protocol-name",children:i}),o.jsx("span",{className:"demo-protocol-value",children:No.playerValues[c]})]},`player-proto-${c}`))})]}),o.jsx("div",{className:"demo-player-side",children:o.jsx("div",{className:"demo-lanes",children:l.map((i,c)=>o.jsx("div",{className:`demo-lane ${No.playerCompiled[c]?"demo-lane-compiled":""} ${c===1?"demo-lane-compilable":""}`,children:o.jsx("div",{className:"demo-lane-stack",children:i.map((d,f)=>o.jsx(bt,{card:d,isFaceUp:d.isFaceUp,style:{"--i":f},faceDownValue:2},d.id))})},`player-lane-${c}`))})}),o.jsx("div",{className:"demo-side-label player-label",children:"You"})]}),o.jsxs("div",{className:"demo-board-annotations",children:[o.jsxs("div",{className:"demo-annotation compiled-annotation",children:[o.jsx("div",{className:"demo-annotation-marker compiled-marker",children:"1"}),o.jsxs("div",{className:"demo-annotation-content",children:[o.jsx("strong",{children:"Compiled Protocol"}),o.jsx("p",{children:"Light has been compiled by the opponent! The protocol bar glows cyan."})]})]}),o.jsxs("div",{className:"demo-annotation compilable-annotation",children:[o.jsx("div",{className:"demo-annotation-marker compilable-marker",children:"2"}),o.jsxs("div",{className:"demo-annotation-content",children:[o.jsx("strong",{children:"Ready to Compile!"}),o.jsx("p",{children:"Plague has value 10 (1+5+4) which is 10 and higher than opponent's Spirit at 5. This protocol can be compiled!"})]})]}),o.jsxs("div",{className:"demo-annotation inprogress-annotation",children:[o.jsx("div",{className:"demo-annotation-marker inprogress-marker",children:"3"}),o.jsxs("div",{className:"demo-annotation-content",children:[o.jsx("strong",{children:"In Progress"}),o.jsx("p",{children:"Death/Water lanes are still building up. Keep playing cards to reach the compile threshold of 10!"})]})]}),o.jsxs("div",{className:"demo-annotation topbox-annotation",children:[o.jsx("div",{className:"demo-annotation-marker topbox-marker",children:"4"}),o.jsxs("div",{className:"demo-annotation-content",children:[o.jsx("strong",{children:"Top Effect Always Visible"}),o.jsx("p",{children:"See Plague-1's top effect? It stays active even when covered! Top effects are always visible and active on face-up cards."})]})]})]})]}),o.jsxs("div",{className:"field-legend",children:[o.jsxs("div",{className:"legend-item",children:[o.jsx("div",{className:"legend-swatch legend-compiled"}),o.jsx("span",{children:"Compiled Protocol"})]}),o.jsxs("div",{className:"legend-item",children:[o.jsx("div",{className:"legend-swatch legend-compilable"}),o.jsx("span",{children:"Ready to Compile (10 value & higher than opponent)"})]}),o.jsxs("div",{className:"legend-item",children:[o.jsx("div",{className:"legend-swatch legend-facedown"}),o.jsx("span",{children:"Face-down Card (base value: 2)"})]})]})]}),o.jsxs("section",{className:"rules-section card-anatomy-section",children:[o.jsx("h2",{className:"section-title",children:"Card Anatomy"}),o.jsxs("div",{className:"card-anatomy-layout",children:[o.jsx("div",{className:"card-anatomy-display",children:o.jsxs("div",{className:"anatomy-card-wrapper",children:[o.jsx(bt,{card:Xb,isFaceUp:!0}),o.jsxs("div",{className:"anatomy-annotation annotation-protocol",children:[o.jsx("div",{className:"annotation-line annotation-line-left"}),o.jsxs("div",{className:"annotation-label",children:[o.jsx("span",{className:"annotation-letter",children:"A"}),o.jsx("span",{className:"annotation-text",children:"Protocol"})]})]}),o.jsxs("div",{className:"anatomy-annotation annotation-value",children:[o.jsx("div",{className:"annotation-line annotation-line-right"}),o.jsxs("div",{className:"annotation-label",children:[o.jsx("span",{className:"annotation-letter",children:"B"}),o.jsx("span",{className:"annotation-text",children:"Value"})]})]}),o.jsxs("div",{className:"anatomy-annotation annotation-top",children:[o.jsx("div",{className:"annotation-line annotation-line-right"}),o.jsxs("div",{className:"annotation-label",children:[o.jsx("span",{className:"annotation-letter",children:"C"}),o.jsx("span",{className:"annotation-text",children:"Top Effect"})]})]}),o.jsxs("div",{className:"anatomy-annotation annotation-middle",children:[o.jsx("div",{className:"annotation-line annotation-line-right"}),o.jsxs("div",{className:"annotation-label",children:[o.jsx("span",{className:"annotation-letter",children:"D"}),o.jsx("span",{className:"annotation-text",children:"Middle Effect"})]})]}),o.jsxs("div",{className:"anatomy-annotation annotation-bottom",children:[o.jsx("div",{className:"annotation-line annotation-line-right"}),o.jsxs("div",{className:"annotation-label",children:[o.jsx("span",{className:"annotation-letter",children:"E"}),o.jsx("span",{className:"annotation-text",children:"Bottom Effect"})]})]})]})}),o.jsxs("div",{className:"card-anatomy-descriptions",children:[o.jsxs("div",{className:"anatomy-item",children:[o.jsx("span",{className:"anatomy-letter",children:"A"}),o.jsxs("div",{className:"anatomy-desc",children:[o.jsx("strong",{children:"Protocol Indicator"}),o.jsx("p",{children:"Dictates which line a card can be played face-up in. Cards must match the protocol of that line."})]})]}),o.jsxs("div",{className:"anatomy-item",children:[o.jsx("span",{className:"anatomy-letter",children:"B"}),o.jsxs("div",{className:"anatomy-desc",children:[o.jsx("strong",{children:"Value"}),o.jsx("p",{children:"The value added to the total value of a stack. Higher values help you reach the compile threshold of 10."})]})]}),o.jsxs("div",{className:"anatomy-item anatomy-item-highlight",children:[o.jsx("span",{className:"anatomy-letter",children:"C"}),o.jsxs("div",{className:"anatomy-desc",children:[o.jsx("strong",{children:"Top Command - Persistent"}),o.jsxs("p",{children:["While this card is face-up, this passive text is ",o.jsx("span",{className:"emphasis",children:"always active"}),", even when covered by other cards."]})]})]}),o.jsxs("div",{className:"anatomy-item anatomy-item-highlight",children:[o.jsx("span",{className:"anatomy-letter",children:"D"}),o.jsxs("div",{className:"anatomy-desc",children:[o.jsx("strong",{children:"Middle Command - Immediate"}),o.jsx("p",{children:"Resolve this active text immediately when the card is played, flipped face-up, or uncovered."})]})]}),o.jsxs("div",{className:"anatomy-item anatomy-item-highlight",children:[o.jsx("span",{className:"anatomy-letter",children:"E"}),o.jsxs("div",{className:"anatomy-desc",children:[o.jsx("strong",{children:"Bottom Command - Auxiliary"}),o.jsxs("p",{children:['This passive text (often triggered effects like "Start:" or "End:") is only active when the card is ',o.jsx("span",{className:"emphasis",children:"uncovered"}),"."]})]})]})]})]})]}),o.jsxs("section",{className:"rules-section face-down-section",children:[o.jsx("h2",{className:"section-title",children:"Face-Down Cards"}),o.jsxs("div",{className:"face-down-layout",children:[o.jsx("div",{className:"face-down-card-wrapper",children:o.jsx(bt,{card:Zb,isFaceUp:!1,faceDownValue:2})}),o.jsxs("div",{className:"face-down-description",children:[o.jsxs("p",{children:["Cards can be played ",o.jsx("span",{className:"emphasis",children:"face-down"})," into any line, regardless of protocol matching."]}),o.jsxs("ul",{children:[o.jsxs("li",{children:["Face-down cards have a ",o.jsx("span",{className:"emphasis",children:"base value of 2"})]}),o.jsx("li",{children:"No effects are active while face-down"}),o.jsx("li",{children:"Can be flipped face-up by card effects"}),o.jsx("li",{children:"When flipped, the middle effect triggers"}),o.jsx("li",{children:"Some cards modify face-down values (e.g., Darkness-2)"})]})]})]})]}),o.jsxs("section",{className:"rules-section",children:[o.jsx("h2",{className:"section-title",children:"Turn Order"}),o.jsxs("div",{className:"turn-order-grid",children:[o.jsxs("div",{className:"turn-phase",children:[o.jsx("span",{className:"phase-number",children:"1"}),o.jsxs("div",{className:"phase-content",children:[o.jsx("strong",{children:"Start Phase"}),o.jsx("p",{children:'Resolve all visible "Start" effects of your face-up command cards.'})]})]}),o.jsxs("div",{className:"turn-phase",children:[o.jsx("span",{className:"phase-number",children:"2"}),o.jsxs("div",{className:"phase-content",children:[o.jsx("strong",{children:"Check Control"}),o.jsx("p",{children:"If your total value is higher than opponent's in at least 2 lines, take the control component."})]})]}),o.jsxs("div",{className:"turn-phase",children:[o.jsx("span",{className:"phase-number",children:"3"}),o.jsxs("div",{className:"phase-content",children:[o.jsx("strong",{children:"Check Compile"}),o.jsx("p",{children:"If you can compile (10+ value and higher than opponent), you must compile one protocol."})]})]}),o.jsxs("div",{className:"turn-phase",children:[o.jsx("span",{className:"phase-number",children:"4"}),o.jsxs("div",{className:"phase-content",children:[o.jsx("strong",{children:"Action"}),o.jsx("p",{children:"Play 1 card from hand OR refresh your hand (draw until you have 5 cards)."})]})]}),o.jsxs("div",{className:"turn-phase",children:[o.jsx("span",{className:"phase-number",children:"5"}),o.jsxs("div",{className:"phase-content",children:[o.jsx("strong",{children:"Check Cache"}),o.jsx("p",{children:"If you have more than 5 cards, discard down to 5."})]})]}),o.jsxs("div",{className:"turn-phase",children:[o.jsx("span",{className:"phase-number",children:"6"}),o.jsxs("div",{className:"phase-content",children:[o.jsx("strong",{children:"End Phase"}),o.jsx("p",{children:'Resolve all visible "End" effects of your face-up command cards.'})]})]})]})]}),o.jsxs("section",{className:"rules-section glossary-section",children:[o.jsx("h2",{className:"section-title",children:"Glossary"}),o.jsxs("div",{className:"glossary-grid",children:[o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Compile"}),o.jsx("p",{children:'Delete all cards in a line on both sides and flip your protocol to "Compiled".'})]}),o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Covered"}),o.jsx("p",{children:"A card with another card on top of it. Only top effects remain active."})]}),o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Uncovered"}),o.jsx("p",{children:"The topmost card in a stack, furthest from the protocol."})]}),o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Delete"}),o.jsx("p",{children:"Move a card from the field to the trash."})]}),o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Discard"}),o.jsx("p",{children:"Move a card from hand to the owner's trash."})]}),o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Flip"}),o.jsx("p",{children:"Change a card from face-down to face-up, or vice versa."})]}),o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Shift"}),o.jsx("p",{children:"Move a card to another line on the same side of the field."})]}),o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Return"}),o.jsx("p",{children:"Move a card from the field to its owner's hand."})]}),o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Reveal"}),o.jsx("p",{children:"Show hidden information publicly, then return it to its previous state."})]}),o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Refresh"}),o.jsx("p",{children:"Draw cards until you have 5 cards in hand."})]}),o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Line"}),o.jsx("p",{children:"The area passing through two opposing protocols. The field has 3 lines."})]}),o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Stack"}),o.jsx("p",{children:"The cards in a line on one player's side."})]})]})]})]})]})}function rE(){const[a,t]=se.useState("MainMenu"),[l,i]=se.useState([]),[c,d]=se.useState([]),[f,u]=se.useState(null),[p,m]=se.useState("easy"),[y,v]=se.useState(null),[x,w]=se.useState(!0),[S,E]=se.useState("player");se.useEffect(()=>{ab()},[]);const b=se.useCallback(()=>{t("MainMenu"),i([]),d([]),u(null),v(null)},[]);se.useEffect(()=>{const F=L=>{L.key==="Escape"&&b()};return window.addEventListener("keydown",F),()=>{window.removeEventListener("keydown",F)}},[b]);const j=se.useCallback((F,L)=>{i(F),d(L),u(null),v(null),E("player"),t("GameScreen")},[]),C=se.useCallback((F,L)=>{u(F),v(L),t("ResultsScreen")},[]),R=()=>{switch(a){case"MainMenu":return o.jsx(Bh,{onNavigate:F=>t(F),difficulty:p,setDifficulty:m,useControl:x,onUseControlChange:w});case"ProtocolSelection":return o.jsx(i0,{onBack:b,onStartGame:j});case"GameScreen":return o.jsx(kb,{onBack:b,onEndGame:C,playerProtocols:l,opponentProtocols:c,difficulty:p,useControlMechanic:x,startingPlayer:S});case"ResultsScreen":return o.jsx(Nb,{onPlayAgain:b,winner:f,finalState:y,difficulty:p});case"CardLibrary":return o.jsx(Rb,{onBack:b});case"Statistics":return o.jsx(Tb,{onBack:b});case"CustomProtocols":return o.jsx(Qb,{onBack:b});case"Rules":return o.jsx(oE,{onBack:b});default:return o.jsx(Bh,{onNavigate:F=>t(F),difficulty:p,setDifficulty:m,useControl:x,onUseControlChange:w})}};return o.jsx(o.Fragment,{children:R()})}const lE=document.getElementById("root"),sE=Z_.createRoot(lE);sE.render(o.jsx(rE,{}));
