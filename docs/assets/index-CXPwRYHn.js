(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const d of i)if(d.type==="childList")for(const f of d.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&s(f)}).observe(document,{childList:!0,subtree:!0});function r(i){const d={};return i.integrity&&(d.integrity=i.integrity),i.referrerPolicy&&(d.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?d.credentials="include":i.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function s(i){if(i.ep)return;i.ep=!0;const d=r(i);fetch(i.href,d)}})();var Vs={exports:{}},or={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Wp;function sv(){if(Wp)return or;Wp=1;var o=Symbol.for("react.transitional.element"),n=Symbol.for("react.fragment");function r(s,i,d){var f=null;if(d!==void 0&&(f=""+d),i.key!==void 0&&(f=""+i.key),"key"in i){d={};for(var m in i)m!=="key"&&(d[m]=i[m])}else d=i;return i=d.ref,{$$typeof:o,type:s,key:f,ref:i!==void 0?i:null,props:d}}return or.Fragment=n,or.jsx=r,or.jsxs=r,or}var Qp;function dv(){return Qp||(Qp=1,Vs.exports=sv()),Vs.exports}var l=dv(),Gs={exports:{}},ar={},Ys={exports:{}},Ws={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Xp;function uv(){return Xp||(Xp=1,(function(o){function n($,W){var P=$.length;$.push(W);e:for(;0<P;){var ne=P-1>>>1,F=$[ne];if(0<i(F,W))$[ne]=W,$[P]=F,P=ne;else break e}}function r($){return $.length===0?null:$[0]}function s($){if($.length===0)return null;var W=$[0],P=$.pop();if(P!==W){$[0]=P;e:for(var ne=0,F=$.length,z=F>>>1;ne<z;){var H=2*(ne+1)-1,V=$[H],Y=H+1,B=$[Y];if(0>i(V,P))Y<F&&0>i(B,V)?($[ne]=B,$[Y]=P,ne=Y):($[ne]=V,$[H]=P,ne=H);else if(Y<F&&0>i(B,P))$[ne]=B,$[Y]=P,ne=Y;else break e}}return W}function i($,W){var P=$.sortIndex-W.sortIndex;return P!==0?P:$.id-W.id}if(o.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var d=performance;o.unstable_now=function(){return d.now()}}else{var f=Date,m=f.now();o.unstable_now=function(){return f.now()-m}}var h=[],p=[],y=1,v=null,x=3,_=!1,w=!1,U=!1,C=!1,A=typeof setTimeout=="function"?setTimeout:null,S=typeof clearTimeout=="function"?clearTimeout:null,N=typeof setImmediate<"u"?setImmediate:null;function q($){for(var W=r(p);W!==null;){if(W.callback===null)s(p);else if(W.startTime<=$)s(p),W.sortIndex=W.expirationTime,n(h,W);else break;W=r(p)}}function D($){if(U=!1,q($),!w)if(r(h)!==null)w=!0,E||(E=!0,T());else{var W=r(p);W!==null&&M(D,W.startTime-$)}}var E=!1,j=-1,I=5,k=-1;function L(){return C?!0:!(o.unstable_now()-k<I)}function G(){if(C=!1,E){var $=o.unstable_now();k=$;var W=!0;try{e:{w=!1,U&&(U=!1,S(j),j=-1),_=!0;var P=x;try{t:{for(q($),v=r(h);v!==null&&!(v.expirationTime>$&&L());){var ne=v.callback;if(typeof ne=="function"){v.callback=null,x=v.priorityLevel;var F=ne(v.expirationTime<=$);if($=o.unstable_now(),typeof F=="function"){v.callback=F,q($),W=!0;break t}v===r(h)&&s(h),q($)}else s(h);v=r(h)}if(v!==null)W=!0;else{var z=r(p);z!==null&&M(D,z.startTime-$),W=!1}}break e}finally{v=null,x=P,_=!1}W=void 0}}finally{W?T():E=!1}}}var T;if(typeof N=="function")T=function(){N(G)};else if(typeof MessageChannel<"u"){var Q=new MessageChannel,X=Q.port2;Q.port1.onmessage=G,T=function(){X.postMessage(null)}}else T=function(){A(G,0)};function M($,W){j=A(function(){$(o.unstable_now())},W)}o.unstable_IdlePriority=5,o.unstable_ImmediatePriority=1,o.unstable_LowPriority=4,o.unstable_NormalPriority=3,o.unstable_Profiling=null,o.unstable_UserBlockingPriority=2,o.unstable_cancelCallback=function($){$.callback=null},o.unstable_forceFrameRate=function($){0>$||125<$?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):I=0<$?Math.floor(1e3/$):5},o.unstable_getCurrentPriorityLevel=function(){return x},o.unstable_next=function($){switch(x){case 1:case 2:case 3:var W=3;break;default:W=x}var P=x;x=W;try{return $()}finally{x=P}},o.unstable_requestPaint=function(){C=!0},o.unstable_runWithPriority=function($,W){switch($){case 1:case 2:case 3:case 4:case 5:break;default:$=3}var P=x;x=$;try{return W()}finally{x=P}},o.unstable_scheduleCallback=function($,W,P){var ne=o.unstable_now();switch(typeof P=="object"&&P!==null?(P=P.delay,P=typeof P=="number"&&0<P?ne+P:ne):P=ne,$){case 1:var F=-1;break;case 2:F=250;break;case 5:F=1073741823;break;case 4:F=1e4;break;default:F=5e3}return F=P+F,$={id:y++,callback:W,priorityLevel:$,startTime:P,expirationTime:F,sortIndex:-1},P>ne?($.sortIndex=P,n(p,$),r(h)===null&&$===r(p)&&(U?(S(j),j=-1):U=!0,M(D,P-ne))):($.sortIndex=F,n(h,$),w||_||(w=!0,E||(E=!0,T()))),$},o.unstable_shouldYield=L,o.unstable_wrapCallback=function($){var W=x;return function(){var P=x;x=W;try{return $.apply(this,arguments)}finally{x=P}}}})(Ws)),Ws}var Zp;function fv(){return Zp||(Zp=1,Ys.exports=uv()),Ys.exports}var Qs={exports:{}},Ie={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Kp;function pv(){if(Kp)return Ie;Kp=1;var o=Symbol.for("react.transitional.element"),n=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),d=Symbol.for("react.consumer"),f=Symbol.for("react.context"),m=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),p=Symbol.for("react.memo"),y=Symbol.for("react.lazy"),v=Symbol.iterator;function x(F){return F===null||typeof F!="object"?null:(F=v&&F[v]||F["@@iterator"],typeof F=="function"?F:null)}var _={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},w=Object.assign,U={};function C(F,z,H){this.props=F,this.context=z,this.refs=U,this.updater=H||_}C.prototype.isReactComponent={},C.prototype.setState=function(F,z){if(typeof F!="object"&&typeof F!="function"&&F!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,F,z,"setState")},C.prototype.forceUpdate=function(F){this.updater.enqueueForceUpdate(this,F,"forceUpdate")};function A(){}A.prototype=C.prototype;function S(F,z,H){this.props=F,this.context=z,this.refs=U,this.updater=H||_}var N=S.prototype=new A;N.constructor=S,w(N,C.prototype),N.isPureReactComponent=!0;var q=Array.isArray,D={H:null,A:null,T:null,S:null,V:null},E=Object.prototype.hasOwnProperty;function j(F,z,H,V,Y,B){return H=B.ref,{$$typeof:o,type:F,key:z,ref:H!==void 0?H:null,props:B}}function I(F,z){return j(F.type,z,void 0,void 0,void 0,F.props)}function k(F){return typeof F=="object"&&F!==null&&F.$$typeof===o}function L(F){var z={"=":"=0",":":"=2"};return"$"+F.replace(/[=:]/g,function(H){return z[H]})}var G=/\/+/g;function T(F,z){return typeof F=="object"&&F!==null&&F.key!=null?L(""+F.key):z.toString(36)}function Q(){}function X(F){switch(F.status){case"fulfilled":return F.value;case"rejected":throw F.reason;default:switch(typeof F.status=="string"?F.then(Q,Q):(F.status="pending",F.then(function(z){F.status==="pending"&&(F.status="fulfilled",F.value=z)},function(z){F.status==="pending"&&(F.status="rejected",F.reason=z)})),F.status){case"fulfilled":return F.value;case"rejected":throw F.reason}}throw F}function M(F,z,H,V,Y){var B=typeof F;(B==="undefined"||B==="boolean")&&(F=null);var J=!1;if(F===null)J=!0;else switch(B){case"bigint":case"string":case"number":J=!0;break;case"object":switch(F.$$typeof){case o:case n:J=!0;break;case y:return J=F._init,M(J(F._payload),z,H,V,Y)}}if(J)return Y=Y(F),J=V===""?"."+T(F,0):V,q(Y)?(H="",J!=null&&(H=J.replace(G,"$&/")+"/"),M(Y,z,H,"",function(ye){return ye})):Y!=null&&(k(Y)&&(Y=I(Y,H+(Y.key==null||F&&F.key===Y.key?"":(""+Y.key).replace(G,"$&/")+"/")+J)),z.push(Y)),1;J=0;var ee=V===""?".":V+":";if(q(F))for(var he=0;he<F.length;he++)V=F[he],B=ee+T(V,he),J+=M(V,z,H,B,Y);else if(he=x(F),typeof he=="function")for(F=he.call(F),he=0;!(V=F.next()).done;)V=V.value,B=ee+T(V,he++),J+=M(V,z,H,B,Y);else if(B==="object"){if(typeof F.then=="function")return M(X(F),z,H,V,Y);throw z=String(F),Error("Objects are not valid as a React child (found: "+(z==="[object Object]"?"object with keys {"+Object.keys(F).join(", ")+"}":z)+"). If you meant to render a collection of children, use an array instead.")}return J}function $(F,z,H){if(F==null)return F;var V=[],Y=0;return M(F,V,"","",function(B){return z.call(H,B,Y++)}),V}function W(F){if(F._status===-1){var z=F._result;z=z(),z.then(function(H){(F._status===0||F._status===-1)&&(F._status=1,F._result=H)},function(H){(F._status===0||F._status===-1)&&(F._status=2,F._result=H)}),F._status===-1&&(F._status=0,F._result=z)}if(F._status===1)return F._result.default;throw F._result}var P=typeof reportError=="function"?reportError:function(F){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var z=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof F=="object"&&F!==null&&typeof F.message=="string"?String(F.message):String(F),error:F});if(!window.dispatchEvent(z))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",F);return}console.error(F)};function ne(){}return Ie.Children={map:$,forEach:function(F,z,H){$(F,function(){z.apply(this,arguments)},H)},count:function(F){var z=0;return $(F,function(){z++}),z},toArray:function(F){return $(F,function(z){return z})||[]},only:function(F){if(!k(F))throw Error("React.Children.only expected to receive a single React element child.");return F}},Ie.Component=C,Ie.Fragment=r,Ie.Profiler=i,Ie.PureComponent=S,Ie.StrictMode=s,Ie.Suspense=h,Ie.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=D,Ie.__COMPILER_RUNTIME={__proto__:null,c:function(F){return D.H.useMemoCache(F)}},Ie.cache=function(F){return function(){return F.apply(null,arguments)}},Ie.cloneElement=function(F,z,H){if(F==null)throw Error("The argument must be a React element, but you passed "+F+".");var V=w({},F.props),Y=F.key,B=void 0;if(z!=null)for(J in z.ref!==void 0&&(B=void 0),z.key!==void 0&&(Y=""+z.key),z)!E.call(z,J)||J==="key"||J==="__self"||J==="__source"||J==="ref"&&z.ref===void 0||(V[J]=z[J]);var J=arguments.length-2;if(J===1)V.children=H;else if(1<J){for(var ee=Array(J),he=0;he<J;he++)ee[he]=arguments[he+2];V.children=ee}return j(F.type,Y,void 0,void 0,B,V)},Ie.createContext=function(F){return F={$$typeof:f,_currentValue:F,_currentValue2:F,_threadCount:0,Provider:null,Consumer:null},F.Provider=F,F.Consumer={$$typeof:d,_context:F},F},Ie.createElement=function(F,z,H){var V,Y={},B=null;if(z!=null)for(V in z.key!==void 0&&(B=""+z.key),z)E.call(z,V)&&V!=="key"&&V!=="__self"&&V!=="__source"&&(Y[V]=z[V]);var J=arguments.length-2;if(J===1)Y.children=H;else if(1<J){for(var ee=Array(J),he=0;he<J;he++)ee[he]=arguments[he+2];Y.children=ee}if(F&&F.defaultProps)for(V in J=F.defaultProps,J)Y[V]===void 0&&(Y[V]=J[V]);return j(F,B,void 0,void 0,null,Y)},Ie.createRef=function(){return{current:null}},Ie.forwardRef=function(F){return{$$typeof:m,render:F}},Ie.isValidElement=k,Ie.lazy=function(F){return{$$typeof:y,_payload:{_status:-1,_result:F},_init:W}},Ie.memo=function(F,z){return{$$typeof:p,type:F,compare:z===void 0?null:z}},Ie.startTransition=function(F){var z=D.T,H={};D.T=H;try{var V=F(),Y=D.S;Y!==null&&Y(H,V),typeof V=="object"&&V!==null&&typeof V.then=="function"&&V.then(ne,P)}catch(B){P(B)}finally{D.T=z}},Ie.unstable_useCacheRefresh=function(){return D.H.useCacheRefresh()},Ie.use=function(F){return D.H.use(F)},Ie.useActionState=function(F,z,H){return D.H.useActionState(F,z,H)},Ie.useCallback=function(F,z){return D.H.useCallback(F,z)},Ie.useContext=function(F){return D.H.useContext(F)},Ie.useDebugValue=function(){},Ie.useDeferredValue=function(F,z){return D.H.useDeferredValue(F,z)},Ie.useEffect=function(F,z,H){var V=D.H;if(typeof H=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return V.useEffect(F,z)},Ie.useId=function(){return D.H.useId()},Ie.useImperativeHandle=function(F,z,H){return D.H.useImperativeHandle(F,z,H)},Ie.useInsertionEffect=function(F,z){return D.H.useInsertionEffect(F,z)},Ie.useLayoutEffect=function(F,z){return D.H.useLayoutEffect(F,z)},Ie.useMemo=function(F,z){return D.H.useMemo(F,z)},Ie.useOptimistic=function(F,z){return D.H.useOptimistic(F,z)},Ie.useReducer=function(F,z,H){return D.H.useReducer(F,z,H)},Ie.useRef=function(F){return D.H.useRef(F)},Ie.useState=function(F){return D.H.useState(F)},Ie.useSyncExternalStore=function(F,z,H){return D.H.useSyncExternalStore(F,z,H)},Ie.useTransition=function(){return D.H.useTransition()},Ie.version="19.1.1",Ie}var Jp;function sd(){return Jp||(Jp=1,Qs.exports=pv()),Qs.exports}var Xs={exports:{}},Jt={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var eh;function hv(){if(eh)return Jt;eh=1;var o=sd();function n(h){var p="https://react.dev/errors/"+h;if(1<arguments.length){p+="?args[]="+encodeURIComponent(arguments[1]);for(var y=2;y<arguments.length;y++)p+="&args[]="+encodeURIComponent(arguments[y])}return"Minified React error #"+h+"; visit "+p+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function r(){}var s={d:{f:r,r:function(){throw Error(n(522))},D:r,C:r,L:r,m:r,X:r,S:r,M:r},p:0,findDOMNode:null},i=Symbol.for("react.portal");function d(h,p,y){var v=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:i,key:v==null?null:""+v,children:h,containerInfo:p,implementation:y}}var f=o.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function m(h,p){if(h==="font")return"";if(typeof p=="string")return p==="use-credentials"?p:""}return Jt.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=s,Jt.createPortal=function(h,p){var y=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11)throw Error(n(299));return d(h,p,null,y)},Jt.flushSync=function(h){var p=f.T,y=s.p;try{if(f.T=null,s.p=2,h)return h()}finally{f.T=p,s.p=y,s.d.f()}},Jt.preconnect=function(h,p){typeof h=="string"&&(p?(p=p.crossOrigin,p=typeof p=="string"?p==="use-credentials"?p:"":void 0):p=null,s.d.C(h,p))},Jt.prefetchDNS=function(h){typeof h=="string"&&s.d.D(h)},Jt.preinit=function(h,p){if(typeof h=="string"&&p&&typeof p.as=="string"){var y=p.as,v=m(y,p.crossOrigin),x=typeof p.integrity=="string"?p.integrity:void 0,_=typeof p.fetchPriority=="string"?p.fetchPriority:void 0;y==="style"?s.d.S(h,typeof p.precedence=="string"?p.precedence:void 0,{crossOrigin:v,integrity:x,fetchPriority:_}):y==="script"&&s.d.X(h,{crossOrigin:v,integrity:x,fetchPriority:_,nonce:typeof p.nonce=="string"?p.nonce:void 0})}},Jt.preinitModule=function(h,p){if(typeof h=="string")if(typeof p=="object"&&p!==null){if(p.as==null||p.as==="script"){var y=m(p.as,p.crossOrigin);s.d.M(h,{crossOrigin:y,integrity:typeof p.integrity=="string"?p.integrity:void 0,nonce:typeof p.nonce=="string"?p.nonce:void 0})}}else p==null&&s.d.M(h)},Jt.preload=function(h,p){if(typeof h=="string"&&typeof p=="object"&&p!==null&&typeof p.as=="string"){var y=p.as,v=m(y,p.crossOrigin);s.d.L(h,y,{crossOrigin:v,integrity:typeof p.integrity=="string"?p.integrity:void 0,nonce:typeof p.nonce=="string"?p.nonce:void 0,type:typeof p.type=="string"?p.type:void 0,fetchPriority:typeof p.fetchPriority=="string"?p.fetchPriority:void 0,referrerPolicy:typeof p.referrerPolicy=="string"?p.referrerPolicy:void 0,imageSrcSet:typeof p.imageSrcSet=="string"?p.imageSrcSet:void 0,imageSizes:typeof p.imageSizes=="string"?p.imageSizes:void 0,media:typeof p.media=="string"?p.media:void 0})}},Jt.preloadModule=function(h,p){if(typeof h=="string")if(p){var y=m(p.as,p.crossOrigin);s.d.m(h,{as:typeof p.as=="string"&&p.as!=="script"?p.as:void 0,crossOrigin:y,integrity:typeof p.integrity=="string"?p.integrity:void 0})}else s.d.m(h)},Jt.requestFormReset=function(h){s.d.r(h)},Jt.unstable_batchedUpdates=function(h,p){return h(p)},Jt.useFormState=function(h,p,y){return f.H.useFormState(h,p,y)},Jt.useFormStatus=function(){return f.H.useHostTransitionStatus()},Jt.version="19.1.1",Jt}var th;function mv(){if(th)return Xs.exports;th=1;function o(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(o)}catch(n){console.error(n)}}return o(),Xs.exports=hv(),Xs.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var nh;function gv(){if(nh)return ar;nh=1;var o=fv(),n=sd(),r=mv();function s(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var a=2;a<arguments.length;a++)t+="&args[]="+encodeURIComponent(arguments[a])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function d(e){var t=e,a=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,(t.flags&4098)!==0&&(a=t.return),e=t.return;while(e)}return t.tag===3?a:null}function f(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function m(e){if(d(e)!==e)throw Error(s(188))}function h(e){var t=e.alternate;if(!t){if(t=d(e),t===null)throw Error(s(188));return t!==e?null:e}for(var a=e,c=t;;){var u=a.return;if(u===null)break;var g=u.alternate;if(g===null){if(c=u.return,c!==null){a=c;continue}break}if(u.child===g.child){for(g=u.child;g;){if(g===a)return m(u),e;if(g===c)return m(u),t;g=g.sibling}throw Error(s(188))}if(a.return!==c.return)a=u,c=g;else{for(var R=!1,O=u.child;O;){if(O===a){R=!0,a=u,c=g;break}if(O===c){R=!0,c=u,a=g;break}O=O.sibling}if(!R){for(O=g.child;O;){if(O===a){R=!0,a=g,c=u;break}if(O===c){R=!0,c=g,a=u;break}O=O.sibling}if(!R)throw Error(s(189))}}if(a.alternate!==c)throw Error(s(190))}if(a.tag!==3)throw Error(s(188));return a.stateNode.current===a?e:t}function p(e){var t=e.tag;if(t===5||t===26||t===27||t===6)return e;for(e=e.child;e!==null;){if(t=p(e),t!==null)return t;e=e.sibling}return null}var y=Object.assign,v=Symbol.for("react.element"),x=Symbol.for("react.transitional.element"),_=Symbol.for("react.portal"),w=Symbol.for("react.fragment"),U=Symbol.for("react.strict_mode"),C=Symbol.for("react.profiler"),A=Symbol.for("react.provider"),S=Symbol.for("react.consumer"),N=Symbol.for("react.context"),q=Symbol.for("react.forward_ref"),D=Symbol.for("react.suspense"),E=Symbol.for("react.suspense_list"),j=Symbol.for("react.memo"),I=Symbol.for("react.lazy"),k=Symbol.for("react.activity"),L=Symbol.for("react.memo_cache_sentinel"),G=Symbol.iterator;function T(e){return e===null||typeof e!="object"?null:(e=G&&e[G]||e["@@iterator"],typeof e=="function"?e:null)}var Q=Symbol.for("react.client.reference");function X(e){if(e==null)return null;if(typeof e=="function")return e.$$typeof===Q?null:e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case w:return"Fragment";case C:return"Profiler";case U:return"StrictMode";case D:return"Suspense";case E:return"SuspenseList";case k:return"Activity"}if(typeof e=="object")switch(e.$$typeof){case _:return"Portal";case N:return(e.displayName||"Context")+".Provider";case S:return(e._context.displayName||"Context")+".Consumer";case q:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case j:return t=e.displayName||null,t!==null?t:X(e.type)||"Memo";case I:t=e._payload,e=e._init;try{return X(e(t))}catch{}}return null}var M=Array.isArray,$=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,W=r.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,P={pending:!1,data:null,method:null,action:null},ne=[],F=-1;function z(e){return{current:e}}function H(e){0>F||(e.current=ne[F],ne[F]=null,F--)}function V(e,t){F++,ne[F]=e.current,e.current=t}var Y=z(null),B=z(null),J=z(null),ee=z(null);function he(e,t){switch(V(J,t),V(B,e),V(Y,null),t.nodeType){case 9:case 11:e=(e=t.documentElement)&&(e=e.namespaceURI)?Cp(e):0;break;default:if(e=t.tagName,t=t.namespaceURI)t=Cp(t),e=bp(t,e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}H(Y),V(Y,e)}function ye(){H(Y),H(B),H(J)}function me(e){e.memoizedState!==null&&V(ee,e);var t=Y.current,a=bp(t,e.type);t!==a&&(V(B,e),V(Y,a))}function xe(e){B.current===e&&(H(Y),H(B)),ee.current===e&&(H(ee),Kl._currentValue=P)}var Ee=Object.prototype.hasOwnProperty,Ue=o.unstable_scheduleCallback,Xe=o.unstable_cancelCallback,Se=o.unstable_shouldYield,Me=o.unstable_requestPaint,tt=o.unstable_now,Pt=o.unstable_getCurrentPriorityLevel,Qt=o.unstable_ImmediatePriority,Te=o.unstable_UserBlockingPriority,He=o.unstable_NormalPriority,Ze=o.unstable_LowPriority,Je=o.unstable_IdlePriority,en=o.log,vt=o.unstable_setDisableYieldValue,Ct=null,mt=null;function Ht(e){if(typeof en=="function"&&vt(e),mt&&typeof mt.setStrictMode=="function")try{mt.setStrictMode(Ct,e)}catch{}}var _t=Math.clz32?Math.clz32:ya,ho=Math.log,Bo=Math.LN2;function ya(e){return e>>>=0,e===0?32:31-(ho(e)/Bo|0)|0}var ue=256,we=4194304;function Fe(e){var t=e&42;if(t!==0)return t;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return e&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function De(e,t,a){var c=e.pendingLanes;if(c===0)return 0;var u=0,g=e.suspendedLanes,R=e.pingedLanes;e=e.warmLanes;var O=c&134217727;return O!==0?(c=O&~g,c!==0?u=Fe(c):(R&=O,R!==0?u=Fe(R):a||(a=O&~e,a!==0&&(u=Fe(a))))):(O=c&~g,O!==0?u=Fe(O):R!==0?u=Fe(R):a||(a=c&~e,a!==0&&(u=Fe(a)))),u===0?0:t!==0&&t!==u&&(t&g)===0&&(g=u&-u,a=t&-t,g>=a||g===32&&(a&4194048)!==0)?t:u}function Oe(e,t){return(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&t)===0}function at(e,t){switch(e){case 1:case 2:case 4:case 8:case 64:return t+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function We(){var e=ue;return ue<<=1,(ue&4194048)===0&&(ue=256),e}function ft(){var e=we;return we<<=1,(we&62914560)===0&&(we=4194304),e}function sn(e){for(var t=[],a=0;31>a;a++)t.push(e);return t}function Bt(e,t){e.pendingLanes|=t,t!==268435456&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function mo(e,t,a,c,u,g){var R=e.pendingLanes;e.pendingLanes=a,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=a,e.entangledLanes&=a,e.errorRecoveryDisabledLanes&=a,e.shellSuspendCounter=0;var O=e.entanglements,K=e.expirationTimes,le=e.hiddenUpdates;for(a=R&~a;0<a;){var de=31-_t(a),pe=1<<de;O[de]=0,K[de]=-1;var ie=le[de];if(ie!==null)for(le[de]=null,de=0;de<ie.length;de++){var se=ie[de];se!==null&&(se.lane&=-536870913)}a&=~pe}c!==0&&sl(e,c,0),g!==0&&u===0&&e.tag!==0&&(e.suspendedLanes|=g&~(R&~t))}function sl(e,t,a){e.pendingLanes|=t,e.suspendedLanes&=~t;var c=31-_t(t);e.entangledLanes|=t,e.entanglements[c]=e.entanglements[c]|1073741824|a&4194090}function Fn(e,t){var a=e.entangledLanes|=t;for(e=e.entanglements;a;){var c=31-_t(a),u=1<<c;u&t|e[c]&t&&(e[c]|=t),a&=~u}}function bt(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function va(e){return e&=-e,2<e?8<e?(e&134217727)!==0?32:268435456:8:2}function hr(){var e=W.p;return e!==0?e:(e=window.event,e===void 0?32:Hp(e.type))}function Mc(e,t){var a=W.p;try{return W.p=e,t()}finally{W.p=a}}var In=Math.random().toString(36).slice(2),Ot="__reactFiber$"+In,Xt="__reactProps$"+In,go="__reactContainer$"+In,_a="__reactEvents$"+In,mr="__reactListeners$"+In,gr="__reactHandles$"+In,dl="__reactResources$"+In,ge="__reactMarker$"+In;function Ce(e){delete e[Ot],delete e[Xt],delete e[_a],delete e[mr],delete e[gr]}function qe(e){var t=e[Ot];if(t)return t;for(var a=e.parentNode;a;){if(t=a[go]||a[Ot]){if(a=t.alternate,t.child!==null||a!==null&&a.child!==null)for(e=Ap(e);e!==null;){if(a=e[Ot])return a;e=Ap(e)}return t}e=a,a=e.parentNode}return null}function it(e){if(e=e[Ot]||e[go]){var t=e.tag;if(t===5||t===6||t===13||t===26||t===27||t===3)return e}return null}function St(e){var t=e.tag;if(t===5||t===26||t===27||t===6)return e.stateNode;throw Error(s(33))}function Zt(e){var t=e[dl];return t||(t=e[dl]={hoistableStyles:new Map,hoistableScripts:new Map}),t}function lt(e){e[ge]=!0}var Pn=new Set,zo={};function tn(e,t){yo(e,t),yo(e+"Capture",t)}function yo(e,t){for(zo[e]=t,e=0;e<t.length;e++)Pn.add(t[e])}var hd=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),dn={},yr={};function Ic(e){return Ee.call(yr,e)?!0:Ee.call(dn,e)?!1:hd.test(e)?yr[e]=!0:(dn[e]=!0,!1)}function xa(e,t,a){if(Ic(t))if(a===null)e.removeAttribute(t);else{switch(typeof a){case"undefined":case"function":case"symbol":e.removeAttribute(t);return;case"boolean":var c=t.toLowerCase().slice(0,5);if(c!=="data-"&&c!=="aria-"){e.removeAttribute(t);return}}e.setAttribute(t,""+a)}}function wa(e,t,a){if(a===null)e.removeAttribute(t);else{switch(typeof a){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(t);return}e.setAttribute(t,""+a)}}function qn(e,t,a,c){if(c===null)e.removeAttribute(a);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(a);return}e.setAttributeNS(t,a,""+c)}}var Vo,zt;function Go(e){if(Vo===void 0)try{throw Error()}catch(a){var t=a.stack.trim().match(/\n( *(at )?)/);Vo=t&&t[1]||"",zt=-1<a.stack.indexOf(`
    at`)?" (<anonymous>)":-1<a.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Vo+e+zt}var Yo=!1;function Pc(e,t){if(!e||Yo)return"";Yo=!0;var a=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var c={DetermineComponentFrameRoot:function(){try{if(t){var pe=function(){throw Error()};if(Object.defineProperty(pe.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(pe,[])}catch(se){var ie=se}Reflect.construct(e,[],pe)}else{try{pe.call()}catch(se){ie=se}e.call(pe.prototype)}}else{try{throw Error()}catch(se){ie=se}(pe=e())&&typeof pe.catch=="function"&&pe.catch(function(){})}}catch(se){if(se&&ie&&typeof se.stack=="string")return[se.stack,ie.stack]}return[null,null]}};c.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var u=Object.getOwnPropertyDescriptor(c.DetermineComponentFrameRoot,"name");u&&u.configurable&&Object.defineProperty(c.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var g=c.DetermineComponentFrameRoot(),R=g[0],O=g[1];if(R&&O){var K=R.split(`
`),le=O.split(`
`);for(u=c=0;c<K.length&&!K[c].includes("DetermineComponentFrameRoot");)c++;for(;u<le.length&&!le[u].includes("DetermineComponentFrameRoot");)u++;if(c===K.length||u===le.length)for(c=K.length-1,u=le.length-1;1<=c&&0<=u&&K[c]!==le[u];)u--;for(;1<=c&&0<=u;c--,u--)if(K[c]!==le[u]){if(c!==1||u!==1)do if(c--,u--,0>u||K[c]!==le[u]){var de=`
`+K[c].replace(" at new "," at ");return e.displayName&&de.includes("<anonymous>")&&(de=de.replace("<anonymous>",e.displayName)),de}while(1<=c&&0<=u);break}}}finally{Yo=!1,Error.prepareStackTrace=a}return(a=e?e.displayName||e.name:"")?Go(a):""}function og(e){switch(e.tag){case 26:case 27:case 5:return Go(e.type);case 16:return Go("Lazy");case 13:return Go("Suspense");case 19:return Go("SuspenseList");case 0:case 15:return Pc(e.type,!1);case 11:return Pc(e.type.render,!1);case 1:return Pc(e.type,!0);case 31:return Go("Activity");default:return""}}function md(e){try{var t="";do t+=og(e),e=e.return;while(e);return t}catch(a){return`
Error generating stack: `+a.message+`
`+a.stack}}function xn(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function gd(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function ag(e){var t=gd(e)?"checked":"value",a=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),c=""+e[t];if(!e.hasOwnProperty(t)&&typeof a<"u"&&typeof a.get=="function"&&typeof a.set=="function"){var u=a.get,g=a.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return u.call(this)},set:function(R){c=""+R,g.call(this,R)}}),Object.defineProperty(e,t,{enumerable:a.enumerable}),{getValue:function(){return c},setValue:function(R){c=""+R},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function vr(e){e._valueTracker||(e._valueTracker=ag(e))}function yd(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var a=t.getValue(),c="";return e&&(c=gd(e)?e.checked?"true":"false":e.value),e=c,e!==a?(t.setValue(e),!0):!1}function _r(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}var lg=/[\n"\\]/g;function wn(e){return e.replace(lg,function(t){return"\\"+t.charCodeAt(0).toString(16)+" "})}function Hc(e,t,a,c,u,g,R,O){e.name="",R!=null&&typeof R!="function"&&typeof R!="symbol"&&typeof R!="boolean"?e.type=R:e.removeAttribute("type"),t!=null?R==="number"?(t===0&&e.value===""||e.value!=t)&&(e.value=""+xn(t)):e.value!==""+xn(t)&&(e.value=""+xn(t)):R!=="submit"&&R!=="reset"||e.removeAttribute("value"),t!=null?Bc(e,R,xn(t)):a!=null?Bc(e,R,xn(a)):c!=null&&e.removeAttribute("value"),u==null&&g!=null&&(e.defaultChecked=!!g),u!=null&&(e.checked=u&&typeof u!="function"&&typeof u!="symbol"),O!=null&&typeof O!="function"&&typeof O!="symbol"&&typeof O!="boolean"?e.name=""+xn(O):e.removeAttribute("name")}function vd(e,t,a,c,u,g,R,O){if(g!=null&&typeof g!="function"&&typeof g!="symbol"&&typeof g!="boolean"&&(e.type=g),t!=null||a!=null){if(!(g!=="submit"&&g!=="reset"||t!=null))return;a=a!=null?""+xn(a):"",t=t!=null?""+xn(t):a,O||t===e.value||(e.value=t),e.defaultValue=t}c=c??u,c=typeof c!="function"&&typeof c!="symbol"&&!!c,e.checked=O?e.checked:!!c,e.defaultChecked=!!c,R!=null&&typeof R!="function"&&typeof R!="symbol"&&typeof R!="boolean"&&(e.name=R)}function Bc(e,t,a){t==="number"&&_r(e.ownerDocument)===e||e.defaultValue===""+a||(e.defaultValue=""+a)}function Ca(e,t,a,c){if(e=e.options,t){t={};for(var u=0;u<a.length;u++)t["$"+a[u]]=!0;for(a=0;a<e.length;a++)u=t.hasOwnProperty("$"+e[a].value),e[a].selected!==u&&(e[a].selected=u),u&&c&&(e[a].defaultSelected=!0)}else{for(a=""+xn(a),t=null,u=0;u<e.length;u++){if(e[u].value===a){e[u].selected=!0,c&&(e[u].defaultSelected=!0);return}t!==null||e[u].disabled||(t=e[u])}t!==null&&(t.selected=!0)}}function _d(e,t,a){if(t!=null&&(t=""+xn(t),t!==e.value&&(e.value=t),a==null)){e.defaultValue!==t&&(e.defaultValue=t);return}e.defaultValue=a!=null?""+xn(a):""}function xd(e,t,a,c){if(t==null){if(c!=null){if(a!=null)throw Error(s(92));if(M(c)){if(1<c.length)throw Error(s(93));c=c[0]}a=c}a==null&&(a=""),t=a}a=xn(t),e.defaultValue=a,c=e.textContent,c===a&&c!==""&&c!==null&&(e.value=c)}function ba(e,t){if(t){var a=e.firstChild;if(a&&a===e.lastChild&&a.nodeType===3){a.nodeValue=t;return}}e.textContent=t}var rg=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function wd(e,t,a){var c=t.indexOf("--")===0;a==null||typeof a=="boolean"||a===""?c?e.setProperty(t,""):t==="float"?e.cssFloat="":e[t]="":c?e.setProperty(t,a):typeof a!="number"||a===0||rg.has(t)?t==="float"?e.cssFloat=a:e[t]=(""+a).trim():e[t]=a+"px"}function Cd(e,t,a){if(t!=null&&typeof t!="object")throw Error(s(62));if(e=e.style,a!=null){for(var c in a)!a.hasOwnProperty(c)||t!=null&&t.hasOwnProperty(c)||(c.indexOf("--")===0?e.setProperty(c,""):c==="float"?e.cssFloat="":e[c]="");for(var u in t)c=t[u],t.hasOwnProperty(u)&&a[u]!==c&&wd(e,u,c)}else for(var g in t)t.hasOwnProperty(g)&&wd(e,g,t[g])}function zc(e){if(e.indexOf("-")===-1)return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var cg=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),ig=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function xr(e){return ig.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}var Vc=null;function Gc(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var Sa=null,Ea=null;function bd(e){var t=it(e);if(t&&(e=t.stateNode)){var a=e[Xt]||null;e:switch(e=t.stateNode,t.type){case"input":if(Hc(e,a.value,a.defaultValue,a.defaultValue,a.checked,a.defaultChecked,a.type,a.name),t=a.name,a.type==="radio"&&t!=null){for(a=e;a.parentNode;)a=a.parentNode;for(a=a.querySelectorAll('input[name="'+wn(""+t)+'"][type="radio"]'),t=0;t<a.length;t++){var c=a[t];if(c!==e&&c.form===e.form){var u=c[Xt]||null;if(!u)throw Error(s(90));Hc(c,u.value,u.defaultValue,u.defaultValue,u.checked,u.defaultChecked,u.type,u.name)}}for(t=0;t<a.length;t++)c=a[t],c.form===e.form&&yd(c)}break e;case"textarea":_d(e,a.value,a.defaultValue);break e;case"select":t=a.value,t!=null&&Ca(e,!!a.multiple,t,!1)}}}var Yc=!1;function Sd(e,t,a){if(Yc)return e(t,a);Yc=!0;try{var c=e(t);return c}finally{if(Yc=!1,(Sa!==null||Ea!==null)&&(lc(),Sa&&(t=Sa,e=Ea,Ea=Sa=null,bd(t),e)))for(t=0;t<e.length;t++)bd(e[t])}}function ul(e,t){var a=e.stateNode;if(a===null)return null;var c=a[Xt]||null;if(c===null)return null;a=c[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(c=!c.disabled)||(e=e.type,c=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!c;break e;default:e=!1}if(e)return null;if(a&&typeof a!="function")throw Error(s(231,t,typeof a));return a}var Wn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Wc=!1;if(Wn)try{var fl={};Object.defineProperty(fl,"passive",{get:function(){Wc=!0}}),window.addEventListener("test",fl,fl),window.removeEventListener("test",fl,fl)}catch{Wc=!1}var vo=null,Qc=null,wr=null;function Ed(){if(wr)return wr;var e,t=Qc,a=t.length,c,u="value"in vo?vo.value:vo.textContent,g=u.length;for(e=0;e<a&&t[e]===u[e];e++);var R=a-e;for(c=1;c<=R&&t[a-c]===u[g-c];c++);return wr=u.slice(e,1<c?1-c:void 0)}function Cr(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function br(){return!0}function jd(){return!1}function on(e){function t(a,c,u,g,R){this._reactName=a,this._targetInst=u,this.type=c,this.nativeEvent=g,this.target=R,this.currentTarget=null;for(var O in e)e.hasOwnProperty(O)&&(a=e[O],this[O]=a?a(g):g[O]);return this.isDefaultPrevented=(g.defaultPrevented!=null?g.defaultPrevented:g.returnValue===!1)?br:jd,this.isPropagationStopped=jd,this}return y(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():typeof a.returnValue!="unknown"&&(a.returnValue=!1),this.isDefaultPrevented=br)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():typeof a.cancelBubble!="unknown"&&(a.cancelBubble=!0),this.isPropagationStopped=br)},persist:function(){},isPersistent:br}),t}var Wo={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Sr=on(Wo),pl=y({},Wo,{view:0,detail:0}),sg=on(pl),Xc,Zc,hl,Er=y({},pl,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Jc,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==hl&&(hl&&e.type==="mousemove"?(Xc=e.screenX-hl.screenX,Zc=e.screenY-hl.screenY):Zc=Xc=0,hl=e),Xc)},movementY:function(e){return"movementY"in e?e.movementY:Zc}}),Ad=on(Er),dg=y({},Er,{dataTransfer:0}),ug=on(dg),fg=y({},pl,{relatedTarget:0}),Kc=on(fg),pg=y({},Wo,{animationName:0,elapsedTime:0,pseudoElement:0}),hg=on(pg),mg=y({},Wo,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),gg=on(mg),yg=y({},Wo,{data:0}),Rd=on(yg),vg={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},_g={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},xg={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function wg(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=xg[e])?!!t[e]:!1}function Jc(){return wg}var Cg=y({},pl,{key:function(e){if(e.key){var t=vg[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=Cr(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?_g[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Jc,charCode:function(e){return e.type==="keypress"?Cr(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?Cr(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),bg=on(Cg),Sg=y({},Er,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Dd=on(Sg),Eg=y({},pl,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Jc}),jg=on(Eg),Ag=y({},Wo,{propertyName:0,elapsedTime:0,pseudoElement:0}),Rg=on(Ag),Dg=y({},Er,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Tg=on(Dg),kg=y({},Wo,{newState:0,oldState:0}),Ng=on(kg),Fg=[9,13,27,32],ei=Wn&&"CompositionEvent"in window,ml=null;Wn&&"documentMode"in document&&(ml=document.documentMode);var qg=Wn&&"TextEvent"in window&&!ml,Td=Wn&&(!ei||ml&&8<ml&&11>=ml),kd=" ",Nd=!1;function Fd(e,t){switch(e){case"keyup":return Fg.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function qd(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var ja=!1;function Ug(e,t){switch(e){case"compositionend":return qd(t);case"keypress":return t.which!==32?null:(Nd=!0,kd);case"textInput":return e=t.data,e===kd&&Nd?null:e;default:return null}}function $g(e,t){if(ja)return e==="compositionend"||!ei&&Fd(e,t)?(e=Ed(),wr=Qc=vo=null,ja=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Td&&t.locale!=="ko"?null:t.data;default:return null}}var Og={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Ud(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!Og[e.type]:t==="textarea"}function $d(e,t,a,c){Sa?Ea?Ea.push(c):Ea=[c]:Sa=c,t=uc(t,"onChange"),0<t.length&&(a=new Sr("onChange","change",null,a,c),e.push({event:a,listeners:t}))}var gl=null,yl=null;function Lg(e){yp(e,0)}function jr(e){var t=St(e);if(yd(t))return e}function Od(e,t){if(e==="change")return t}var Ld=!1;if(Wn){var ti;if(Wn){var ni="oninput"in document;if(!ni){var Md=document.createElement("div");Md.setAttribute("oninput","return;"),ni=typeof Md.oninput=="function"}ti=ni}else ti=!1;Ld=ti&&(!document.documentMode||9<document.documentMode)}function Id(){gl&&(gl.detachEvent("onpropertychange",Pd),yl=gl=null)}function Pd(e){if(e.propertyName==="value"&&jr(yl)){var t=[];$d(t,yl,e,Gc(e)),Sd(Lg,t)}}function Mg(e,t,a){e==="focusin"?(Id(),gl=t,yl=a,gl.attachEvent("onpropertychange",Pd)):e==="focusout"&&Id()}function Ig(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return jr(yl)}function Pg(e,t){if(e==="click")return jr(t)}function Hg(e,t){if(e==="input"||e==="change")return jr(t)}function Bg(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var un=typeof Object.is=="function"?Object.is:Bg;function vl(e,t){if(un(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var a=Object.keys(e),c=Object.keys(t);if(a.length!==c.length)return!1;for(c=0;c<a.length;c++){var u=a[c];if(!Ee.call(t,u)||!un(e[u],t[u]))return!1}return!0}function Hd(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Bd(e,t){var a=Hd(e);e=0;for(var c;a;){if(a.nodeType===3){if(c=e+a.textContent.length,e<=t&&c>=t)return{node:a,offset:t-e};e=c}e:{for(;a;){if(a.nextSibling){a=a.nextSibling;break e}a=a.parentNode}a=void 0}a=Hd(a)}}function zd(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?zd(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function Vd(e){e=e!=null&&e.ownerDocument!=null&&e.ownerDocument.defaultView!=null?e.ownerDocument.defaultView:window;for(var t=_r(e.document);t instanceof e.HTMLIFrameElement;){try{var a=typeof t.contentWindow.location.href=="string"}catch{a=!1}if(a)e=t.contentWindow;else break;t=_r(e.document)}return t}function oi(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}var zg=Wn&&"documentMode"in document&&11>=document.documentMode,Aa=null,ai=null,_l=null,li=!1;function Gd(e,t,a){var c=a.window===a?a.document:a.nodeType===9?a:a.ownerDocument;li||Aa==null||Aa!==_r(c)||(c=Aa,"selectionStart"in c&&oi(c)?c={start:c.selectionStart,end:c.selectionEnd}:(c=(c.ownerDocument&&c.ownerDocument.defaultView||window).getSelection(),c={anchorNode:c.anchorNode,anchorOffset:c.anchorOffset,focusNode:c.focusNode,focusOffset:c.focusOffset}),_l&&vl(_l,c)||(_l=c,c=uc(ai,"onSelect"),0<c.length&&(t=new Sr("onSelect","select",null,t,a),e.push({event:t,listeners:c}),t.target=Aa)))}function Qo(e,t){var a={};return a[e.toLowerCase()]=t.toLowerCase(),a["Webkit"+e]="webkit"+t,a["Moz"+e]="moz"+t,a}var Ra={animationend:Qo("Animation","AnimationEnd"),animationiteration:Qo("Animation","AnimationIteration"),animationstart:Qo("Animation","AnimationStart"),transitionrun:Qo("Transition","TransitionRun"),transitionstart:Qo("Transition","TransitionStart"),transitioncancel:Qo("Transition","TransitionCancel"),transitionend:Qo("Transition","TransitionEnd")},ri={},Yd={};Wn&&(Yd=document.createElement("div").style,"AnimationEvent"in window||(delete Ra.animationend.animation,delete Ra.animationiteration.animation,delete Ra.animationstart.animation),"TransitionEvent"in window||delete Ra.transitionend.transition);function Xo(e){if(ri[e])return ri[e];if(!Ra[e])return e;var t=Ra[e],a;for(a in t)if(t.hasOwnProperty(a)&&a in Yd)return ri[e]=t[a];return e}var Wd=Xo("animationend"),Qd=Xo("animationiteration"),Xd=Xo("animationstart"),Vg=Xo("transitionrun"),Gg=Xo("transitionstart"),Yg=Xo("transitioncancel"),Zd=Xo("transitionend"),Kd=new Map,ci="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");ci.push("scrollEnd");function Un(e,t){Kd.set(e,t),tn(t,[e])}var Jd=new WeakMap;function Cn(e,t){if(typeof e=="object"&&e!==null){var a=Jd.get(e);return a!==void 0?a:(t={value:e,source:t,stack:md(t)},Jd.set(e,t),t)}return{value:e,source:t,stack:md(t)}}var bn=[],Da=0,ii=0;function Ar(){for(var e=Da,t=ii=Da=0;t<e;){var a=bn[t];bn[t++]=null;var c=bn[t];bn[t++]=null;var u=bn[t];bn[t++]=null;var g=bn[t];if(bn[t++]=null,c!==null&&u!==null){var R=c.pending;R===null?u.next=u:(u.next=R.next,R.next=u),c.pending=u}g!==0&&eu(a,u,g)}}function Rr(e,t,a,c){bn[Da++]=e,bn[Da++]=t,bn[Da++]=a,bn[Da++]=c,ii|=c,e.lanes|=c,e=e.alternate,e!==null&&(e.lanes|=c)}function si(e,t,a,c){return Rr(e,t,a,c),Dr(e)}function Ta(e,t){return Rr(e,null,null,t),Dr(e)}function eu(e,t,a){e.lanes|=a;var c=e.alternate;c!==null&&(c.lanes|=a);for(var u=!1,g=e.return;g!==null;)g.childLanes|=a,c=g.alternate,c!==null&&(c.childLanes|=a),g.tag===22&&(e=g.stateNode,e===null||e._visibility&1||(u=!0)),e=g,g=g.return;return e.tag===3?(g=e.stateNode,u&&t!==null&&(u=31-_t(a),e=g.hiddenUpdates,c=e[u],c===null?e[u]=[t]:c.push(t),t.lane=a|536870912),g):null}function Dr(e){if(50<zl)throw zl=0,ms=null,Error(s(185));for(var t=e.return;t!==null;)e=t,t=e.return;return e.tag===3?e.stateNode:null}var ka={};function Wg(e,t,a,c){this.tag=e,this.key=a,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=c,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function fn(e,t,a,c){return new Wg(e,t,a,c)}function di(e){return e=e.prototype,!(!e||!e.isReactComponent)}function Qn(e,t){var a=e.alternate;return a===null?(a=fn(e.tag,t,e.key,e.mode),a.elementType=e.elementType,a.type=e.type,a.stateNode=e.stateNode,a.alternate=e,e.alternate=a):(a.pendingProps=t,a.type=e.type,a.flags=0,a.subtreeFlags=0,a.deletions=null),a.flags=e.flags&65011712,a.childLanes=e.childLanes,a.lanes=e.lanes,a.child=e.child,a.memoizedProps=e.memoizedProps,a.memoizedState=e.memoizedState,a.updateQueue=e.updateQueue,t=e.dependencies,a.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},a.sibling=e.sibling,a.index=e.index,a.ref=e.ref,a.refCleanup=e.refCleanup,a}function tu(e,t){e.flags&=65011714;var a=e.alternate;return a===null?(e.childLanes=0,e.lanes=t,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=a.childLanes,e.lanes=a.lanes,e.child=a.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=a.memoizedProps,e.memoizedState=a.memoizedState,e.updateQueue=a.updateQueue,e.type=a.type,t=a.dependencies,e.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),e}function Tr(e,t,a,c,u,g){var R=0;if(c=e,typeof e=="function")di(e)&&(R=1);else if(typeof e=="string")R=Xy(e,a,Y.current)?26:e==="html"||e==="head"||e==="body"?27:5;else e:switch(e){case k:return e=fn(31,a,t,u),e.elementType=k,e.lanes=g,e;case w:return Zo(a.children,u,g,t);case U:R=8,u|=24;break;case C:return e=fn(12,a,t,u|2),e.elementType=C,e.lanes=g,e;case D:return e=fn(13,a,t,u),e.elementType=D,e.lanes=g,e;case E:return e=fn(19,a,t,u),e.elementType=E,e.lanes=g,e;default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case A:case N:R=10;break e;case S:R=9;break e;case q:R=11;break e;case j:R=14;break e;case I:R=16,c=null;break e}R=29,a=Error(s(130,e===null?"null":typeof e,"")),c=null}return t=fn(R,a,t,u),t.elementType=e,t.type=c,t.lanes=g,t}function Zo(e,t,a,c){return e=fn(7,e,c,t),e.lanes=a,e}function ui(e,t,a){return e=fn(6,e,null,t),e.lanes=a,e}function fi(e,t,a){return t=fn(4,e.children!==null?e.children:[],e.key,t),t.lanes=a,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}var Na=[],Fa=0,kr=null,Nr=0,Sn=[],En=0,Ko=null,Xn=1,Zn="";function Jo(e,t){Na[Fa++]=Nr,Na[Fa++]=kr,kr=e,Nr=t}function nu(e,t,a){Sn[En++]=Xn,Sn[En++]=Zn,Sn[En++]=Ko,Ko=e;var c=Xn;e=Zn;var u=32-_t(c)-1;c&=~(1<<u),a+=1;var g=32-_t(t)+u;if(30<g){var R=u-u%5;g=(c&(1<<R)-1).toString(32),c>>=R,u-=R,Xn=1<<32-_t(t)+u|a<<u|c,Zn=g+e}else Xn=1<<g|a<<u|c,Zn=e}function pi(e){e.return!==null&&(Jo(e,1),nu(e,1,0))}function hi(e){for(;e===kr;)kr=Na[--Fa],Na[Fa]=null,Nr=Na[--Fa],Na[Fa]=null;for(;e===Ko;)Ko=Sn[--En],Sn[En]=null,Zn=Sn[--En],Sn[En]=null,Xn=Sn[--En],Sn[En]=null}var nn=null,xt=null,nt=!1,ea=null,Hn=!1,mi=Error(s(519));function ta(e){var t=Error(s(418,""));throw Cl(Cn(t,e)),mi}function ou(e){var t=e.stateNode,a=e.type,c=e.memoizedProps;switch(t[Ot]=e,t[Xt]=c,a){case"dialog":Ve("cancel",t),Ve("close",t);break;case"iframe":case"object":case"embed":Ve("load",t);break;case"video":case"audio":for(a=0;a<Gl.length;a++)Ve(Gl[a],t);break;case"source":Ve("error",t);break;case"img":case"image":case"link":Ve("error",t),Ve("load",t);break;case"details":Ve("toggle",t);break;case"input":Ve("invalid",t),vd(t,c.value,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name,!0),vr(t);break;case"select":Ve("invalid",t);break;case"textarea":Ve("invalid",t),xd(t,c.value,c.defaultValue,c.children),vr(t)}a=c.children,typeof a!="string"&&typeof a!="number"&&typeof a!="bigint"||t.textContent===""+a||c.suppressHydrationWarning===!0||wp(t.textContent,a)?(c.popover!=null&&(Ve("beforetoggle",t),Ve("toggle",t)),c.onScroll!=null&&Ve("scroll",t),c.onScrollEnd!=null&&Ve("scrollend",t),c.onClick!=null&&(t.onclick=fc),t=!0):t=!1,t||ta(e)}function au(e){for(nn=e.return;nn;)switch(nn.tag){case 5:case 13:Hn=!1;return;case 27:case 3:Hn=!0;return;default:nn=nn.return}}function xl(e){if(e!==nn)return!1;if(!nt)return au(e),nt=!0,!1;var t=e.tag,a;if((a=t!==3&&t!==27)&&((a=t===5)&&(a=e.type,a=!(a!=="form"&&a!=="button")||ks(e.type,e.memoizedProps)),a=!a),a&&xt&&ta(e),au(e),t===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(s(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8)if(a=e.data,a==="/$"){if(t===0){xt=On(e.nextSibling);break e}t--}else a!=="$"&&a!=="$!"&&a!=="$?"||t++;e=e.nextSibling}xt=null}}else t===27?(t=xt,qo(e.type)?(e=Us,Us=null,xt=e):xt=t):xt=nn?On(e.stateNode.nextSibling):null;return!0}function wl(){xt=nn=null,nt=!1}function lu(){var e=ea;return e!==null&&(rn===null?rn=e:rn.push.apply(rn,e),ea=null),e}function Cl(e){ea===null?ea=[e]:ea.push(e)}var gi=z(null),na=null,Kn=null;function _o(e,t,a){V(gi,t._currentValue),t._currentValue=a}function Jn(e){e._currentValue=gi.current,H(gi)}function yi(e,t,a){for(;e!==null;){var c=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,c!==null&&(c.childLanes|=t)):c!==null&&(c.childLanes&t)!==t&&(c.childLanes|=t),e===a)break;e=e.return}}function vi(e,t,a,c){var u=e.child;for(u!==null&&(u.return=e);u!==null;){var g=u.dependencies;if(g!==null){var R=u.child;g=g.firstContext;e:for(;g!==null;){var O=g;g=u;for(var K=0;K<t.length;K++)if(O.context===t[K]){g.lanes|=a,O=g.alternate,O!==null&&(O.lanes|=a),yi(g.return,a,e),c||(R=null);break e}g=O.next}}else if(u.tag===18){if(R=u.return,R===null)throw Error(s(341));R.lanes|=a,g=R.alternate,g!==null&&(g.lanes|=a),yi(R,a,e),R=null}else R=u.child;if(R!==null)R.return=u;else for(R=u;R!==null;){if(R===e){R=null;break}if(u=R.sibling,u!==null){u.return=R.return,R=u;break}R=R.return}u=R}}function bl(e,t,a,c){e=null;for(var u=t,g=!1;u!==null;){if(!g){if((u.flags&524288)!==0)g=!0;else if((u.flags&262144)!==0)break}if(u.tag===10){var R=u.alternate;if(R===null)throw Error(s(387));if(R=R.memoizedProps,R!==null){var O=u.type;un(u.pendingProps.value,R.value)||(e!==null?e.push(O):e=[O])}}else if(u===ee.current){if(R=u.alternate,R===null)throw Error(s(387));R.memoizedState.memoizedState!==u.memoizedState.memoizedState&&(e!==null?e.push(Kl):e=[Kl])}u=u.return}e!==null&&vi(t,e,a,c),t.flags|=262144}function Fr(e){for(e=e.firstContext;e!==null;){if(!un(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function oa(e){na=e,Kn=null,e=e.dependencies,e!==null&&(e.firstContext=null)}function Kt(e){return ru(na,e)}function qr(e,t){return na===null&&oa(e),ru(e,t)}function ru(e,t){var a=t._currentValue;if(t={context:t,memoizedValue:a,next:null},Kn===null){if(e===null)throw Error(s(308));Kn=t,e.dependencies={lanes:0,firstContext:t},e.flags|=524288}else Kn=Kn.next=t;return a}var Qg=typeof AbortController<"u"?AbortController:function(){var e=[],t=this.signal={aborted:!1,addEventListener:function(a,c){e.push(c)}};this.abort=function(){t.aborted=!0,e.forEach(function(a){return a()})}},Xg=o.unstable_scheduleCallback,Zg=o.unstable_NormalPriority,Ut={$$typeof:N,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function _i(){return{controller:new Qg,data:new Map,refCount:0}}function Sl(e){e.refCount--,e.refCount===0&&Xg(Zg,function(){e.controller.abort()})}var El=null,xi=0,qa=0,Ua=null;function Kg(e,t){if(El===null){var a=El=[];xi=0,qa=Cs(),Ua={status:"pending",value:void 0,then:function(c){a.push(c)}}}return xi++,t.then(cu,cu),t}function cu(){if(--xi===0&&El!==null){Ua!==null&&(Ua.status="fulfilled");var e=El;El=null,qa=0,Ua=null;for(var t=0;t<e.length;t++)(0,e[t])()}}function Jg(e,t){var a=[],c={status:"pending",value:null,reason:null,then:function(u){a.push(u)}};return e.then(function(){c.status="fulfilled",c.value=t;for(var u=0;u<a.length;u++)(0,a[u])(t)},function(u){for(c.status="rejected",c.reason=u,u=0;u<a.length;u++)(0,a[u])(void 0)}),c}var iu=$.S;$.S=function(e,t){typeof t=="object"&&t!==null&&typeof t.then=="function"&&Kg(e,t),iu!==null&&iu(e,t)};var aa=z(null);function wi(){var e=aa.current;return e!==null?e:ht.pooledCache}function Ur(e,t){t===null?V(aa,aa.current):V(aa,t.pool)}function su(){var e=wi();return e===null?null:{parent:Ut._currentValue,pool:e}}var jl=Error(s(460)),du=Error(s(474)),$r=Error(s(542)),Ci={then:function(){}};function uu(e){return e=e.status,e==="fulfilled"||e==="rejected"}function Or(){}function fu(e,t,a){switch(a=e[a],a===void 0?e.push(t):a!==t&&(t.then(Or,Or),t=a),t.status){case"fulfilled":return t.value;case"rejected":throw e=t.reason,hu(e),e;default:if(typeof t.status=="string")t.then(Or,Or);else{if(e=ht,e!==null&&100<e.shellSuspendCounter)throw Error(s(482));e=t,e.status="pending",e.then(function(c){if(t.status==="pending"){var u=t;u.status="fulfilled",u.value=c}},function(c){if(t.status==="pending"){var u=t;u.status="rejected",u.reason=c}})}switch(t.status){case"fulfilled":return t.value;case"rejected":throw e=t.reason,hu(e),e}throw Al=t,jl}}var Al=null;function pu(){if(Al===null)throw Error(s(459));var e=Al;return Al=null,e}function hu(e){if(e===jl||e===$r)throw Error(s(483))}var xo=!1;function bi(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Si(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function wo(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function Co(e,t,a){var c=e.updateQueue;if(c===null)return null;if(c=c.shared,(rt&2)!==0){var u=c.pending;return u===null?t.next=t:(t.next=u.next,u.next=t),c.pending=t,t=Dr(e),eu(e,null,a),t}return Rr(e,c,t,a),Dr(e)}function Rl(e,t,a){if(t=t.updateQueue,t!==null&&(t=t.shared,(a&4194048)!==0)){var c=t.lanes;c&=e.pendingLanes,a|=c,t.lanes=a,Fn(e,a)}}function Ei(e,t){var a=e.updateQueue,c=e.alternate;if(c!==null&&(c=c.updateQueue,a===c)){var u=null,g=null;if(a=a.firstBaseUpdate,a!==null){do{var R={lane:a.lane,tag:a.tag,payload:a.payload,callback:null,next:null};g===null?u=g=R:g=g.next=R,a=a.next}while(a!==null);g===null?u=g=t:g=g.next=t}else u=g=t;a={baseState:c.baseState,firstBaseUpdate:u,lastBaseUpdate:g,shared:c.shared,callbacks:c.callbacks},e.updateQueue=a;return}e=a.lastBaseUpdate,e===null?a.firstBaseUpdate=t:e.next=t,a.lastBaseUpdate=t}var ji=!1;function Dl(){if(ji){var e=Ua;if(e!==null)throw e}}function Tl(e,t,a,c){ji=!1;var u=e.updateQueue;xo=!1;var g=u.firstBaseUpdate,R=u.lastBaseUpdate,O=u.shared.pending;if(O!==null){u.shared.pending=null;var K=O,le=K.next;K.next=null,R===null?g=le:R.next=le,R=K;var de=e.alternate;de!==null&&(de=de.updateQueue,O=de.lastBaseUpdate,O!==R&&(O===null?de.firstBaseUpdate=le:O.next=le,de.lastBaseUpdate=K))}if(g!==null){var pe=u.baseState;R=0,de=le=K=null,O=g;do{var ie=O.lane&-536870913,se=ie!==O.lane;if(se?(Ke&ie)===ie:(c&ie)===ie){ie!==0&&ie===qa&&(ji=!0),de!==null&&(de=de.next={lane:0,tag:O.tag,payload:O.payload,callback:null,next:null});e:{var $e=e,ke=O;ie=t;var ut=a;switch(ke.tag){case 1:if($e=ke.payload,typeof $e=="function"){pe=$e.call(ut,pe,ie);break e}pe=$e;break e;case 3:$e.flags=$e.flags&-65537|128;case 0:if($e=ke.payload,ie=typeof $e=="function"?$e.call(ut,pe,ie):$e,ie==null)break e;pe=y({},pe,ie);break e;case 2:xo=!0}}ie=O.callback,ie!==null&&(e.flags|=64,se&&(e.flags|=8192),se=u.callbacks,se===null?u.callbacks=[ie]:se.push(ie))}else se={lane:ie,tag:O.tag,payload:O.payload,callback:O.callback,next:null},de===null?(le=de=se,K=pe):de=de.next=se,R|=ie;if(O=O.next,O===null){if(O=u.shared.pending,O===null)break;se=O,O=se.next,se.next=null,u.lastBaseUpdate=se,u.shared.pending=null}}while(!0);de===null&&(K=pe),u.baseState=K,u.firstBaseUpdate=le,u.lastBaseUpdate=de,g===null&&(u.shared.lanes=0),To|=R,e.lanes=R,e.memoizedState=pe}}function mu(e,t){if(typeof e!="function")throw Error(s(191,e));e.call(t)}function gu(e,t){var a=e.callbacks;if(a!==null)for(e.callbacks=null,e=0;e<a.length;e++)mu(a[e],t)}var $a=z(null),Lr=z(0);function yu(e,t){e=ro,V(Lr,e),V($a,t),ro=e|t.baseLanes}function Ai(){V(Lr,ro),V($a,$a.current)}function Ri(){ro=Lr.current,H($a),H(Lr)}var bo=0,Pe=null,st=null,Tt=null,Mr=!1,Oa=!1,la=!1,Ir=0,kl=0,La=null,ey=0;function Et(){throw Error(s(321))}function Di(e,t){if(t===null)return!1;for(var a=0;a<t.length&&a<e.length;a++)if(!un(e[a],t[a]))return!1;return!0}function Ti(e,t,a,c,u,g){return bo=g,Pe=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,$.H=e===null||e.memoizedState===null?ef:tf,la=!1,g=a(c,u),la=!1,Oa&&(g=_u(t,a,c,u)),vu(e),g}function vu(e){$.H=Gr;var t=st!==null&&st.next!==null;if(bo=0,Tt=st=Pe=null,Mr=!1,kl=0,La=null,t)throw Error(s(300));e===null||Lt||(e=e.dependencies,e!==null&&Fr(e)&&(Lt=!0))}function _u(e,t,a,c){Pe=e;var u=0;do{if(Oa&&(La=null),kl=0,Oa=!1,25<=u)throw Error(s(301));if(u+=1,Tt=st=null,e.updateQueue!=null){var g=e.updateQueue;g.lastEffect=null,g.events=null,g.stores=null,g.memoCache!=null&&(g.memoCache.index=0)}$.H=cy,g=t(a,c)}while(Oa);return g}function ty(){var e=$.H,t=e.useState()[0];return t=typeof t.then=="function"?Nl(t):t,e=e.useState()[0],(st!==null?st.memoizedState:null)!==e&&(Pe.flags|=1024),t}function ki(){var e=Ir!==0;return Ir=0,e}function Ni(e,t,a){t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a}function Fi(e){if(Mr){for(e=e.memoizedState;e!==null;){var t=e.queue;t!==null&&(t.pending=null),e=e.next}Mr=!1}bo=0,Tt=st=Pe=null,Oa=!1,kl=Ir=0,La=null}function an(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Tt===null?Pe.memoizedState=Tt=e:Tt=Tt.next=e,Tt}function kt(){if(st===null){var e=Pe.alternate;e=e!==null?e.memoizedState:null}else e=st.next;var t=Tt===null?Pe.memoizedState:Tt.next;if(t!==null)Tt=t,st=e;else{if(e===null)throw Pe.alternate===null?Error(s(467)):Error(s(310));st=e,e={memoizedState:st.memoizedState,baseState:st.baseState,baseQueue:st.baseQueue,queue:st.queue,next:null},Tt===null?Pe.memoizedState=Tt=e:Tt=Tt.next=e}return Tt}function qi(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Nl(e){var t=kl;return kl+=1,La===null&&(La=[]),e=fu(La,e,t),t=Pe,(Tt===null?t.memoizedState:Tt.next)===null&&(t=t.alternate,$.H=t===null||t.memoizedState===null?ef:tf),e}function Pr(e){if(e!==null&&typeof e=="object"){if(typeof e.then=="function")return Nl(e);if(e.$$typeof===N)return Kt(e)}throw Error(s(438,String(e)))}function Ui(e){var t=null,a=Pe.updateQueue;if(a!==null&&(t=a.memoCache),t==null){var c=Pe.alternate;c!==null&&(c=c.updateQueue,c!==null&&(c=c.memoCache,c!=null&&(t={data:c.data.map(function(u){return u.slice()}),index:0})))}if(t==null&&(t={data:[],index:0}),a===null&&(a=qi(),Pe.updateQueue=a),a.memoCache=t,a=t.data[t.index],a===void 0)for(a=t.data[t.index]=Array(e),c=0;c<e;c++)a[c]=L;return t.index++,a}function eo(e,t){return typeof t=="function"?t(e):t}function Hr(e){var t=kt();return $i(t,st,e)}function $i(e,t,a){var c=e.queue;if(c===null)throw Error(s(311));c.lastRenderedReducer=a;var u=e.baseQueue,g=c.pending;if(g!==null){if(u!==null){var R=u.next;u.next=g.next,g.next=R}t.baseQueue=u=g,c.pending=null}if(g=e.baseState,u===null)e.memoizedState=g;else{t=u.next;var O=R=null,K=null,le=t,de=!1;do{var pe=le.lane&-536870913;if(pe!==le.lane?(Ke&pe)===pe:(bo&pe)===pe){var ie=le.revertLane;if(ie===0)K!==null&&(K=K.next={lane:0,revertLane:0,action:le.action,hasEagerState:le.hasEagerState,eagerState:le.eagerState,next:null}),pe===qa&&(de=!0);else if((bo&ie)===ie){le=le.next,ie===qa&&(de=!0);continue}else pe={lane:0,revertLane:le.revertLane,action:le.action,hasEagerState:le.hasEagerState,eagerState:le.eagerState,next:null},K===null?(O=K=pe,R=g):K=K.next=pe,Pe.lanes|=ie,To|=ie;pe=le.action,la&&a(g,pe),g=le.hasEagerState?le.eagerState:a(g,pe)}else ie={lane:pe,revertLane:le.revertLane,action:le.action,hasEagerState:le.hasEagerState,eagerState:le.eagerState,next:null},K===null?(O=K=ie,R=g):K=K.next=ie,Pe.lanes|=pe,To|=pe;le=le.next}while(le!==null&&le!==t);if(K===null?R=g:K.next=O,!un(g,e.memoizedState)&&(Lt=!0,de&&(a=Ua,a!==null)))throw a;e.memoizedState=g,e.baseState=R,e.baseQueue=K,c.lastRenderedState=g}return u===null&&(c.lanes=0),[e.memoizedState,c.dispatch]}function Oi(e){var t=kt(),a=t.queue;if(a===null)throw Error(s(311));a.lastRenderedReducer=e;var c=a.dispatch,u=a.pending,g=t.memoizedState;if(u!==null){a.pending=null;var R=u=u.next;do g=e(g,R.action),R=R.next;while(R!==u);un(g,t.memoizedState)||(Lt=!0),t.memoizedState=g,t.baseQueue===null&&(t.baseState=g),a.lastRenderedState=g}return[g,c]}function xu(e,t,a){var c=Pe,u=kt(),g=nt;if(g){if(a===void 0)throw Error(s(407));a=a()}else a=t();var R=!un((st||u).memoizedState,a);R&&(u.memoizedState=a,Lt=!0),u=u.queue;var O=bu.bind(null,c,u,e);if(Fl(2048,8,O,[e]),u.getSnapshot!==t||R||Tt!==null&&Tt.memoizedState.tag&1){if(c.flags|=2048,Ma(9,Br(),Cu.bind(null,c,u,a,t),null),ht===null)throw Error(s(349));g||(bo&124)!==0||wu(c,t,a)}return a}function wu(e,t,a){e.flags|=16384,e={getSnapshot:t,value:a},t=Pe.updateQueue,t===null?(t=qi(),Pe.updateQueue=t,t.stores=[e]):(a=t.stores,a===null?t.stores=[e]:a.push(e))}function Cu(e,t,a,c){t.value=a,t.getSnapshot=c,Su(t)&&Eu(e)}function bu(e,t,a){return a(function(){Su(t)&&Eu(e)})}function Su(e){var t=e.getSnapshot;e=e.value;try{var a=t();return!un(e,a)}catch{return!0}}function Eu(e){var t=Ta(e,2);t!==null&&yn(t,e,2)}function Li(e){var t=an();if(typeof e=="function"){var a=e;if(e=a(),la){Ht(!0);try{a()}finally{Ht(!1)}}}return t.memoizedState=t.baseState=e,t.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:eo,lastRenderedState:e},t}function ju(e,t,a,c){return e.baseState=a,$i(e,st,typeof c=="function"?c:eo)}function ny(e,t,a,c,u){if(Vr(e))throw Error(s(485));if(e=t.action,e!==null){var g={payload:u,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(R){g.listeners.push(R)}};$.T!==null?a(!0):g.isTransition=!1,c(g),a=t.pending,a===null?(g.next=t.pending=g,Au(t,g)):(g.next=a.next,t.pending=a.next=g)}}function Au(e,t){var a=t.action,c=t.payload,u=e.state;if(t.isTransition){var g=$.T,R={};$.T=R;try{var O=a(u,c),K=$.S;K!==null&&K(R,O),Ru(e,t,O)}catch(le){Mi(e,t,le)}finally{$.T=g}}else try{g=a(u,c),Ru(e,t,g)}catch(le){Mi(e,t,le)}}function Ru(e,t,a){a!==null&&typeof a=="object"&&typeof a.then=="function"?a.then(function(c){Du(e,t,c)},function(c){return Mi(e,t,c)}):Du(e,t,a)}function Du(e,t,a){t.status="fulfilled",t.value=a,Tu(t),e.state=a,t=e.pending,t!==null&&(a=t.next,a===t?e.pending=null:(a=a.next,t.next=a,Au(e,a)))}function Mi(e,t,a){var c=e.pending;if(e.pending=null,c!==null){c=c.next;do t.status="rejected",t.reason=a,Tu(t),t=t.next;while(t!==c)}e.action=null}function Tu(e){e=e.listeners;for(var t=0;t<e.length;t++)(0,e[t])()}function ku(e,t){return t}function Nu(e,t){if(nt){var a=ht.formState;if(a!==null){e:{var c=Pe;if(nt){if(xt){t:{for(var u=xt,g=Hn;u.nodeType!==8;){if(!g){u=null;break t}if(u=On(u.nextSibling),u===null){u=null;break t}}g=u.data,u=g==="F!"||g==="F"?u:null}if(u){xt=On(u.nextSibling),c=u.data==="F!";break e}}ta(c)}c=!1}c&&(t=a[0])}}return a=an(),a.memoizedState=a.baseState=t,c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ku,lastRenderedState:t},a.queue=c,a=Zu.bind(null,Pe,c),c.dispatch=a,c=Li(!1),g=zi.bind(null,Pe,!1,c.queue),c=an(),u={state:t,dispatch:null,action:e,pending:null},c.queue=u,a=ny.bind(null,Pe,u,g,a),u.dispatch=a,c.memoizedState=e,[t,a,!1]}function Fu(e){var t=kt();return qu(t,st,e)}function qu(e,t,a){if(t=$i(e,t,ku)[0],e=Hr(eo)[0],typeof t=="object"&&t!==null&&typeof t.then=="function")try{var c=Nl(t)}catch(R){throw R===jl?$r:R}else c=t;t=kt();var u=t.queue,g=u.dispatch;return a!==t.memoizedState&&(Pe.flags|=2048,Ma(9,Br(),oy.bind(null,u,a),null)),[c,g,e]}function oy(e,t){e.action=t}function Uu(e){var t=kt(),a=st;if(a!==null)return qu(t,a,e);kt(),t=t.memoizedState,a=kt();var c=a.queue.dispatch;return a.memoizedState=e,[t,c,!1]}function Ma(e,t,a,c){return e={tag:e,create:a,deps:c,inst:t,next:null},t=Pe.updateQueue,t===null&&(t=qi(),Pe.updateQueue=t),a=t.lastEffect,a===null?t.lastEffect=e.next=e:(c=a.next,a.next=e,e.next=c,t.lastEffect=e),e}function Br(){return{destroy:void 0,resource:void 0}}function $u(){return kt().memoizedState}function zr(e,t,a,c){var u=an();c=c===void 0?null:c,Pe.flags|=e,u.memoizedState=Ma(1|t,Br(),a,c)}function Fl(e,t,a,c){var u=kt();c=c===void 0?null:c;var g=u.memoizedState.inst;st!==null&&c!==null&&Di(c,st.memoizedState.deps)?u.memoizedState=Ma(t,g,a,c):(Pe.flags|=e,u.memoizedState=Ma(1|t,g,a,c))}function Ou(e,t){zr(8390656,8,e,t)}function Lu(e,t){Fl(2048,8,e,t)}function Mu(e,t){return Fl(4,2,e,t)}function Iu(e,t){return Fl(4,4,e,t)}function Pu(e,t){if(typeof t=="function"){e=e();var a=t(e);return function(){typeof a=="function"?a():t(null)}}if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function Hu(e,t,a){a=a!=null?a.concat([e]):null,Fl(4,4,Pu.bind(null,t,e),a)}function Ii(){}function Bu(e,t){var a=kt();t=t===void 0?null:t;var c=a.memoizedState;return t!==null&&Di(t,c[1])?c[0]:(a.memoizedState=[e,t],e)}function zu(e,t){var a=kt();t=t===void 0?null:t;var c=a.memoizedState;if(t!==null&&Di(t,c[1]))return c[0];if(c=e(),la){Ht(!0);try{e()}finally{Ht(!1)}}return a.memoizedState=[c,t],c}function Pi(e,t,a){return a===void 0||(bo&1073741824)!==0?e.memoizedState=t:(e.memoizedState=a,e=Wf(),Pe.lanes|=e,To|=e,a)}function Vu(e,t,a,c){return un(a,t)?a:$a.current!==null?(e=Pi(e,a,c),un(e,t)||(Lt=!0),e):(bo&42)===0?(Lt=!0,e.memoizedState=a):(e=Wf(),Pe.lanes|=e,To|=e,t)}function Gu(e,t,a,c,u){var g=W.p;W.p=g!==0&&8>g?g:8;var R=$.T,O={};$.T=O,zi(e,!1,t,a);try{var K=u(),le=$.S;if(le!==null&&le(O,K),K!==null&&typeof K=="object"&&typeof K.then=="function"){var de=Jg(K,c);ql(e,t,de,gn(e))}else ql(e,t,c,gn(e))}catch(pe){ql(e,t,{then:function(){},status:"rejected",reason:pe},gn())}finally{W.p=g,$.T=R}}function ay(){}function Hi(e,t,a,c){if(e.tag!==5)throw Error(s(476));var u=Yu(e).queue;Gu(e,u,t,P,a===null?ay:function(){return Wu(e),a(c)})}function Yu(e){var t=e.memoizedState;if(t!==null)return t;t={memoizedState:P,baseState:P,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:eo,lastRenderedState:P},next:null};var a={};return t.next={memoizedState:a,baseState:a,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:eo,lastRenderedState:a},next:null},e.memoizedState=t,e=e.alternate,e!==null&&(e.memoizedState=t),t}function Wu(e){var t=Yu(e).next.queue;ql(e,t,{},gn())}function Bi(){return Kt(Kl)}function Qu(){return kt().memoizedState}function Xu(){return kt().memoizedState}function ly(e){for(var t=e.return;t!==null;){switch(t.tag){case 24:case 3:var a=gn();e=wo(a);var c=Co(t,e,a);c!==null&&(yn(c,t,a),Rl(c,t,a)),t={cache:_i()},e.payload=t;return}t=t.return}}function ry(e,t,a){var c=gn();a={lane:c,revertLane:0,action:a,hasEagerState:!1,eagerState:null,next:null},Vr(e)?Ku(t,a):(a=si(e,t,a,c),a!==null&&(yn(a,e,c),Ju(a,t,c)))}function Zu(e,t,a){var c=gn();ql(e,t,a,c)}function ql(e,t,a,c){var u={lane:c,revertLane:0,action:a,hasEagerState:!1,eagerState:null,next:null};if(Vr(e))Ku(t,u);else{var g=e.alternate;if(e.lanes===0&&(g===null||g.lanes===0)&&(g=t.lastRenderedReducer,g!==null))try{var R=t.lastRenderedState,O=g(R,a);if(u.hasEagerState=!0,u.eagerState=O,un(O,R))return Rr(e,t,u,0),ht===null&&Ar(),!1}catch{}finally{}if(a=si(e,t,u,c),a!==null)return yn(a,e,c),Ju(a,t,c),!0}return!1}function zi(e,t,a,c){if(c={lane:2,revertLane:Cs(),action:c,hasEagerState:!1,eagerState:null,next:null},Vr(e)){if(t)throw Error(s(479))}else t=si(e,a,c,2),t!==null&&yn(t,e,2)}function Vr(e){var t=e.alternate;return e===Pe||t!==null&&t===Pe}function Ku(e,t){Oa=Mr=!0;var a=e.pending;a===null?t.next=t:(t.next=a.next,a.next=t),e.pending=t}function Ju(e,t,a){if((a&4194048)!==0){var c=t.lanes;c&=e.pendingLanes,a|=c,t.lanes=a,Fn(e,a)}}var Gr={readContext:Kt,use:Pr,useCallback:Et,useContext:Et,useEffect:Et,useImperativeHandle:Et,useLayoutEffect:Et,useInsertionEffect:Et,useMemo:Et,useReducer:Et,useRef:Et,useState:Et,useDebugValue:Et,useDeferredValue:Et,useTransition:Et,useSyncExternalStore:Et,useId:Et,useHostTransitionStatus:Et,useFormState:Et,useActionState:Et,useOptimistic:Et,useMemoCache:Et,useCacheRefresh:Et},ef={readContext:Kt,use:Pr,useCallback:function(e,t){return an().memoizedState=[e,t===void 0?null:t],e},useContext:Kt,useEffect:Ou,useImperativeHandle:function(e,t,a){a=a!=null?a.concat([e]):null,zr(4194308,4,Pu.bind(null,t,e),a)},useLayoutEffect:function(e,t){return zr(4194308,4,e,t)},useInsertionEffect:function(e,t){zr(4,2,e,t)},useMemo:function(e,t){var a=an();t=t===void 0?null:t;var c=e();if(la){Ht(!0);try{e()}finally{Ht(!1)}}return a.memoizedState=[c,t],c},useReducer:function(e,t,a){var c=an();if(a!==void 0){var u=a(t);if(la){Ht(!0);try{a(t)}finally{Ht(!1)}}}else u=t;return c.memoizedState=c.baseState=u,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:u},c.queue=e,e=e.dispatch=ry.bind(null,Pe,e),[c.memoizedState,e]},useRef:function(e){var t=an();return e={current:e},t.memoizedState=e},useState:function(e){e=Li(e);var t=e.queue,a=Zu.bind(null,Pe,t);return t.dispatch=a,[e.memoizedState,a]},useDebugValue:Ii,useDeferredValue:function(e,t){var a=an();return Pi(a,e,t)},useTransition:function(){var e=Li(!1);return e=Gu.bind(null,Pe,e.queue,!0,!1),an().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,t,a){var c=Pe,u=an();if(nt){if(a===void 0)throw Error(s(407));a=a()}else{if(a=t(),ht===null)throw Error(s(349));(Ke&124)!==0||wu(c,t,a)}u.memoizedState=a;var g={value:a,getSnapshot:t};return u.queue=g,Ou(bu.bind(null,c,g,e),[e]),c.flags|=2048,Ma(9,Br(),Cu.bind(null,c,g,a,t),null),a},useId:function(){var e=an(),t=ht.identifierPrefix;if(nt){var a=Zn,c=Xn;a=(c&~(1<<32-_t(c)-1)).toString(32)+a,t=""+t+"R"+a,a=Ir++,0<a&&(t+="H"+a.toString(32)),t+=""}else a=ey++,t=""+t+"r"+a.toString(32)+"";return e.memoizedState=t},useHostTransitionStatus:Bi,useFormState:Nu,useActionState:Nu,useOptimistic:function(e){var t=an();t.memoizedState=t.baseState=e;var a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return t.queue=a,t=zi.bind(null,Pe,!0,a),a.dispatch=t,[e,t]},useMemoCache:Ui,useCacheRefresh:function(){return an().memoizedState=ly.bind(null,Pe)}},tf={readContext:Kt,use:Pr,useCallback:Bu,useContext:Kt,useEffect:Lu,useImperativeHandle:Hu,useInsertionEffect:Mu,useLayoutEffect:Iu,useMemo:zu,useReducer:Hr,useRef:$u,useState:function(){return Hr(eo)},useDebugValue:Ii,useDeferredValue:function(e,t){var a=kt();return Vu(a,st.memoizedState,e,t)},useTransition:function(){var e=Hr(eo)[0],t=kt().memoizedState;return[typeof e=="boolean"?e:Nl(e),t]},useSyncExternalStore:xu,useId:Qu,useHostTransitionStatus:Bi,useFormState:Fu,useActionState:Fu,useOptimistic:function(e,t){var a=kt();return ju(a,st,e,t)},useMemoCache:Ui,useCacheRefresh:Xu},cy={readContext:Kt,use:Pr,useCallback:Bu,useContext:Kt,useEffect:Lu,useImperativeHandle:Hu,useInsertionEffect:Mu,useLayoutEffect:Iu,useMemo:zu,useReducer:Oi,useRef:$u,useState:function(){return Oi(eo)},useDebugValue:Ii,useDeferredValue:function(e,t){var a=kt();return st===null?Pi(a,e,t):Vu(a,st.memoizedState,e,t)},useTransition:function(){var e=Oi(eo)[0],t=kt().memoizedState;return[typeof e=="boolean"?e:Nl(e),t]},useSyncExternalStore:xu,useId:Qu,useHostTransitionStatus:Bi,useFormState:Uu,useActionState:Uu,useOptimistic:function(e,t){var a=kt();return st!==null?ju(a,st,e,t):(a.baseState=e,[e,a.queue.dispatch])},useMemoCache:Ui,useCacheRefresh:Xu},Ia=null,Ul=0;function Yr(e){var t=Ul;return Ul+=1,Ia===null&&(Ia=[]),fu(Ia,e,t)}function $l(e,t){t=t.props.ref,e.ref=t!==void 0?t:null}function Wr(e,t){throw t.$$typeof===v?Error(s(525)):(e=Object.prototype.toString.call(t),Error(s(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)))}function nf(e){var t=e._init;return t(e._payload)}function of(e){function t(oe,te){if(e){var ae=oe.deletions;ae===null?(oe.deletions=[te],oe.flags|=16):ae.push(te)}}function a(oe,te){if(!e)return null;for(;te!==null;)t(oe,te),te=te.sibling;return null}function c(oe){for(var te=new Map;oe!==null;)oe.key!==null?te.set(oe.key,oe):te.set(oe.index,oe),oe=oe.sibling;return te}function u(oe,te){return oe=Qn(oe,te),oe.index=0,oe.sibling=null,oe}function g(oe,te,ae){return oe.index=ae,e?(ae=oe.alternate,ae!==null?(ae=ae.index,ae<te?(oe.flags|=67108866,te):ae):(oe.flags|=67108866,te)):(oe.flags|=1048576,te)}function R(oe){return e&&oe.alternate===null&&(oe.flags|=67108866),oe}function O(oe,te,ae,fe){return te===null||te.tag!==6?(te=ui(ae,oe.mode,fe),te.return=oe,te):(te=u(te,ae),te.return=oe,te)}function K(oe,te,ae,fe){var be=ae.type;return be===w?de(oe,te,ae.props.children,fe,ae.key):te!==null&&(te.elementType===be||typeof be=="object"&&be!==null&&be.$$typeof===I&&nf(be)===te.type)?(te=u(te,ae.props),$l(te,ae),te.return=oe,te):(te=Tr(ae.type,ae.key,ae.props,null,oe.mode,fe),$l(te,ae),te.return=oe,te)}function le(oe,te,ae,fe){return te===null||te.tag!==4||te.stateNode.containerInfo!==ae.containerInfo||te.stateNode.implementation!==ae.implementation?(te=fi(ae,oe.mode,fe),te.return=oe,te):(te=u(te,ae.children||[]),te.return=oe,te)}function de(oe,te,ae,fe,be){return te===null||te.tag!==7?(te=Zo(ae,oe.mode,fe,be),te.return=oe,te):(te=u(te,ae),te.return=oe,te)}function pe(oe,te,ae){if(typeof te=="string"&&te!==""||typeof te=="number"||typeof te=="bigint")return te=ui(""+te,oe.mode,ae),te.return=oe,te;if(typeof te=="object"&&te!==null){switch(te.$$typeof){case x:return ae=Tr(te.type,te.key,te.props,null,oe.mode,ae),$l(ae,te),ae.return=oe,ae;case _:return te=fi(te,oe.mode,ae),te.return=oe,te;case I:var fe=te._init;return te=fe(te._payload),pe(oe,te,ae)}if(M(te)||T(te))return te=Zo(te,oe.mode,ae,null),te.return=oe,te;if(typeof te.then=="function")return pe(oe,Yr(te),ae);if(te.$$typeof===N)return pe(oe,qr(oe,te),ae);Wr(oe,te)}return null}function ie(oe,te,ae,fe){var be=te!==null?te.key:null;if(typeof ae=="string"&&ae!==""||typeof ae=="number"||typeof ae=="bigint")return be!==null?null:O(oe,te,""+ae,fe);if(typeof ae=="object"&&ae!==null){switch(ae.$$typeof){case x:return ae.key===be?K(oe,te,ae,fe):null;case _:return ae.key===be?le(oe,te,ae,fe):null;case I:return be=ae._init,ae=be(ae._payload),ie(oe,te,ae,fe)}if(M(ae)||T(ae))return be!==null?null:de(oe,te,ae,fe,null);if(typeof ae.then=="function")return ie(oe,te,Yr(ae),fe);if(ae.$$typeof===N)return ie(oe,te,qr(oe,ae),fe);Wr(oe,ae)}return null}function se(oe,te,ae,fe,be){if(typeof fe=="string"&&fe!==""||typeof fe=="number"||typeof fe=="bigint")return oe=oe.get(ae)||null,O(te,oe,""+fe,be);if(typeof fe=="object"&&fe!==null){switch(fe.$$typeof){case x:return oe=oe.get(fe.key===null?ae:fe.key)||null,K(te,oe,fe,be);case _:return oe=oe.get(fe.key===null?ae:fe.key)||null,le(te,oe,fe,be);case I:var Be=fe._init;return fe=Be(fe._payload),se(oe,te,ae,fe,be)}if(M(fe)||T(fe))return oe=oe.get(ae)||null,de(te,oe,fe,be,null);if(typeof fe.then=="function")return se(oe,te,ae,Yr(fe),be);if(fe.$$typeof===N)return se(oe,te,ae,qr(te,fe),be);Wr(te,fe)}return null}function $e(oe,te,ae,fe){for(var be=null,Be=null,je=te,Ne=te=0,It=null;je!==null&&Ne<ae.length;Ne++){je.index>Ne?(It=je,je=null):It=je.sibling;var et=ie(oe,je,ae[Ne],fe);if(et===null){je===null&&(je=It);break}e&&je&&et.alternate===null&&t(oe,je),te=g(et,te,Ne),Be===null?be=et:Be.sibling=et,Be=et,je=It}if(Ne===ae.length)return a(oe,je),nt&&Jo(oe,Ne),be;if(je===null){for(;Ne<ae.length;Ne++)je=pe(oe,ae[Ne],fe),je!==null&&(te=g(je,te,Ne),Be===null?be=je:Be.sibling=je,Be=je);return nt&&Jo(oe,Ne),be}for(je=c(je);Ne<ae.length;Ne++)It=se(je,oe,Ne,ae[Ne],fe),It!==null&&(e&&It.alternate!==null&&je.delete(It.key===null?Ne:It.key),te=g(It,te,Ne),Be===null?be=It:Be.sibling=It,Be=It);return e&&je.forEach(function(Mo){return t(oe,Mo)}),nt&&Jo(oe,Ne),be}function ke(oe,te,ae,fe){if(ae==null)throw Error(s(151));for(var be=null,Be=null,je=te,Ne=te=0,It=null,et=ae.next();je!==null&&!et.done;Ne++,et=ae.next()){je.index>Ne?(It=je,je=null):It=je.sibling;var Mo=ie(oe,je,et.value,fe);if(Mo===null){je===null&&(je=It);break}e&&je&&Mo.alternate===null&&t(oe,je),te=g(Mo,te,Ne),Be===null?be=Mo:Be.sibling=Mo,Be=Mo,je=It}if(et.done)return a(oe,je),nt&&Jo(oe,Ne),be;if(je===null){for(;!et.done;Ne++,et=ae.next())et=pe(oe,et.value,fe),et!==null&&(te=g(et,te,Ne),Be===null?be=et:Be.sibling=et,Be=et);return nt&&Jo(oe,Ne),be}for(je=c(je);!et.done;Ne++,et=ae.next())et=se(je,oe,Ne,et.value,fe),et!==null&&(e&&et.alternate!==null&&je.delete(et.key===null?Ne:et.key),te=g(et,te,Ne),Be===null?be=et:Be.sibling=et,Be=et);return e&&je.forEach(function(iv){return t(oe,iv)}),nt&&Jo(oe,Ne),be}function ut(oe,te,ae,fe){if(typeof ae=="object"&&ae!==null&&ae.type===w&&ae.key===null&&(ae=ae.props.children),typeof ae=="object"&&ae!==null){switch(ae.$$typeof){case x:e:{for(var be=ae.key;te!==null;){if(te.key===be){if(be=ae.type,be===w){if(te.tag===7){a(oe,te.sibling),fe=u(te,ae.props.children),fe.return=oe,oe=fe;break e}}else if(te.elementType===be||typeof be=="object"&&be!==null&&be.$$typeof===I&&nf(be)===te.type){a(oe,te.sibling),fe=u(te,ae.props),$l(fe,ae),fe.return=oe,oe=fe;break e}a(oe,te);break}else t(oe,te);te=te.sibling}ae.type===w?(fe=Zo(ae.props.children,oe.mode,fe,ae.key),fe.return=oe,oe=fe):(fe=Tr(ae.type,ae.key,ae.props,null,oe.mode,fe),$l(fe,ae),fe.return=oe,oe=fe)}return R(oe);case _:e:{for(be=ae.key;te!==null;){if(te.key===be)if(te.tag===4&&te.stateNode.containerInfo===ae.containerInfo&&te.stateNode.implementation===ae.implementation){a(oe,te.sibling),fe=u(te,ae.children||[]),fe.return=oe,oe=fe;break e}else{a(oe,te);break}else t(oe,te);te=te.sibling}fe=fi(ae,oe.mode,fe),fe.return=oe,oe=fe}return R(oe);case I:return be=ae._init,ae=be(ae._payload),ut(oe,te,ae,fe)}if(M(ae))return $e(oe,te,ae,fe);if(T(ae)){if(be=T(ae),typeof be!="function")throw Error(s(150));return ae=be.call(ae),ke(oe,te,ae,fe)}if(typeof ae.then=="function")return ut(oe,te,Yr(ae),fe);if(ae.$$typeof===N)return ut(oe,te,qr(oe,ae),fe);Wr(oe,ae)}return typeof ae=="string"&&ae!==""||typeof ae=="number"||typeof ae=="bigint"?(ae=""+ae,te!==null&&te.tag===6?(a(oe,te.sibling),fe=u(te,ae),fe.return=oe,oe=fe):(a(oe,te),fe=ui(ae,oe.mode,fe),fe.return=oe,oe=fe),R(oe)):a(oe,te)}return function(oe,te,ae,fe){try{Ul=0;var be=ut(oe,te,ae,fe);return Ia=null,be}catch(je){if(je===jl||je===$r)throw je;var Be=fn(29,je,null,oe.mode);return Be.lanes=fe,Be.return=oe,Be}finally{}}}var Pa=of(!0),af=of(!1),jn=z(null),Bn=null;function So(e){var t=e.alternate;V($t,$t.current&1),V(jn,e),Bn===null&&(t===null||$a.current!==null||t.memoizedState!==null)&&(Bn=e)}function lf(e){if(e.tag===22){if(V($t,$t.current),V(jn,e),Bn===null){var t=e.alternate;t!==null&&t.memoizedState!==null&&(Bn=e)}}else Eo()}function Eo(){V($t,$t.current),V(jn,jn.current)}function to(e){H(jn),Bn===e&&(Bn=null),H($t)}var $t=z(0);function Qr(e){for(var t=e;t!==null;){if(t.tag===13){var a=t.memoizedState;if(a!==null&&(a=a.dehydrated,a===null||a.data==="$?"||qs(a)))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if((t.flags&128)!==0)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}function Vi(e,t,a,c){t=e.memoizedState,a=a(c,t),a=a==null?t:y({},t,a),e.memoizedState=a,e.lanes===0&&(e.updateQueue.baseState=a)}var Gi={enqueueSetState:function(e,t,a){e=e._reactInternals;var c=gn(),u=wo(c);u.payload=t,a!=null&&(u.callback=a),t=Co(e,u,c),t!==null&&(yn(t,e,c),Rl(t,e,c))},enqueueReplaceState:function(e,t,a){e=e._reactInternals;var c=gn(),u=wo(c);u.tag=1,u.payload=t,a!=null&&(u.callback=a),t=Co(e,u,c),t!==null&&(yn(t,e,c),Rl(t,e,c))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var a=gn(),c=wo(a);c.tag=2,t!=null&&(c.callback=t),t=Co(e,c,a),t!==null&&(yn(t,e,a),Rl(t,e,a))}};function rf(e,t,a,c,u,g,R){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(c,g,R):t.prototype&&t.prototype.isPureReactComponent?!vl(a,c)||!vl(u,g):!0}function cf(e,t,a,c){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(a,c),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(a,c),t.state!==e&&Gi.enqueueReplaceState(t,t.state,null)}function ra(e,t){var a=t;if("ref"in t){a={};for(var c in t)c!=="ref"&&(a[c]=t[c])}if(e=e.defaultProps){a===t&&(a=y({},a));for(var u in e)a[u]===void 0&&(a[u]=e[u])}return a}var Xr=typeof reportError=="function"?reportError:function(e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof e=="object"&&e!==null&&typeof e.message=="string"?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",e);return}console.error(e)};function sf(e){Xr(e)}function df(e){console.error(e)}function uf(e){Xr(e)}function Zr(e,t){try{var a=e.onUncaughtError;a(t.value,{componentStack:t.stack})}catch(c){setTimeout(function(){throw c})}}function ff(e,t,a){try{var c=e.onCaughtError;c(a.value,{componentStack:a.stack,errorBoundary:t.tag===1?t.stateNode:null})}catch(u){setTimeout(function(){throw u})}}function Yi(e,t,a){return a=wo(a),a.tag=3,a.payload={element:null},a.callback=function(){Zr(e,t)},a}function pf(e){return e=wo(e),e.tag=3,e}function hf(e,t,a,c){var u=a.type.getDerivedStateFromError;if(typeof u=="function"){var g=c.value;e.payload=function(){return u(g)},e.callback=function(){ff(t,a,c)}}var R=a.stateNode;R!==null&&typeof R.componentDidCatch=="function"&&(e.callback=function(){ff(t,a,c),typeof u!="function"&&(ko===null?ko=new Set([this]):ko.add(this));var O=c.stack;this.componentDidCatch(c.value,{componentStack:O!==null?O:""})})}function iy(e,t,a,c,u){if(a.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){if(t=a.alternate,t!==null&&bl(t,a,u,!0),a=jn.current,a!==null){switch(a.tag){case 13:return Bn===null?ys():a.alternate===null&&wt===0&&(wt=3),a.flags&=-257,a.flags|=65536,a.lanes=u,c===Ci?a.flags|=16384:(t=a.updateQueue,t===null?a.updateQueue=new Set([c]):t.add(c),_s(e,c,u)),!1;case 22:return a.flags|=65536,c===Ci?a.flags|=16384:(t=a.updateQueue,t===null?(t={transitions:null,markerInstances:null,retryQueue:new Set([c])},a.updateQueue=t):(a=t.retryQueue,a===null?t.retryQueue=new Set([c]):a.add(c)),_s(e,c,u)),!1}throw Error(s(435,a.tag))}return _s(e,c,u),ys(),!1}if(nt)return t=jn.current,t!==null?((t.flags&65536)===0&&(t.flags|=256),t.flags|=65536,t.lanes=u,c!==mi&&(e=Error(s(422),{cause:c}),Cl(Cn(e,a)))):(c!==mi&&(t=Error(s(423),{cause:c}),Cl(Cn(t,a))),e=e.current.alternate,e.flags|=65536,u&=-u,e.lanes|=u,c=Cn(c,a),u=Yi(e.stateNode,c,u),Ei(e,u),wt!==4&&(wt=2)),!1;var g=Error(s(520),{cause:c});if(g=Cn(g,a),Bl===null?Bl=[g]:Bl.push(g),wt!==4&&(wt=2),t===null)return!0;c=Cn(c,a),a=t;do{switch(a.tag){case 3:return a.flags|=65536,e=u&-u,a.lanes|=e,e=Yi(a.stateNode,c,e),Ei(a,e),!1;case 1:if(t=a.type,g=a.stateNode,(a.flags&128)===0&&(typeof t.getDerivedStateFromError=="function"||g!==null&&typeof g.componentDidCatch=="function"&&(ko===null||!ko.has(g))))return a.flags|=65536,u&=-u,a.lanes|=u,u=pf(u),hf(u,e,a,c),Ei(a,u),!1}a=a.return}while(a!==null);return!1}var mf=Error(s(461)),Lt=!1;function Vt(e,t,a,c){t.child=e===null?af(t,null,a,c):Pa(t,e.child,a,c)}function gf(e,t,a,c,u){a=a.render;var g=t.ref;if("ref"in c){var R={};for(var O in c)O!=="ref"&&(R[O]=c[O])}else R=c;return oa(t),c=Ti(e,t,a,R,g,u),O=ki(),e!==null&&!Lt?(Ni(e,t,u),no(e,t,u)):(nt&&O&&pi(t),t.flags|=1,Vt(e,t,c,u),t.child)}function yf(e,t,a,c,u){if(e===null){var g=a.type;return typeof g=="function"&&!di(g)&&g.defaultProps===void 0&&a.compare===null?(t.tag=15,t.type=g,vf(e,t,g,c,u)):(e=Tr(a.type,null,c,t,t.mode,u),e.ref=t.ref,e.return=t,t.child=e)}if(g=e.child,!ts(e,u)){var R=g.memoizedProps;if(a=a.compare,a=a!==null?a:vl,a(R,c)&&e.ref===t.ref)return no(e,t,u)}return t.flags|=1,e=Qn(g,c),e.ref=t.ref,e.return=t,t.child=e}function vf(e,t,a,c,u){if(e!==null){var g=e.memoizedProps;if(vl(g,c)&&e.ref===t.ref)if(Lt=!1,t.pendingProps=c=g,ts(e,u))(e.flags&131072)!==0&&(Lt=!0);else return t.lanes=e.lanes,no(e,t,u)}return Wi(e,t,a,c,u)}function _f(e,t,a){var c=t.pendingProps,u=c.children,g=e!==null?e.memoizedState:null;if(c.mode==="hidden"){if((t.flags&128)!==0){if(c=g!==null?g.baseLanes|a:a,e!==null){for(u=t.child=e.child,g=0;u!==null;)g=g|u.lanes|u.childLanes,u=u.sibling;t.childLanes=g&~c}else t.childLanes=0,t.child=null;return xf(e,t,c,a)}if((a&536870912)!==0)t.memoizedState={baseLanes:0,cachePool:null},e!==null&&Ur(t,g!==null?g.cachePool:null),g!==null?yu(t,g):Ai(),lf(t);else return t.lanes=t.childLanes=536870912,xf(e,t,g!==null?g.baseLanes|a:a,a)}else g!==null?(Ur(t,g.cachePool),yu(t,g),Eo(),t.memoizedState=null):(e!==null&&Ur(t,null),Ai(),Eo());return Vt(e,t,u,a),t.child}function xf(e,t,a,c){var u=wi();return u=u===null?null:{parent:Ut._currentValue,pool:u},t.memoizedState={baseLanes:a,cachePool:u},e!==null&&Ur(t,null),Ai(),lf(t),e!==null&&bl(e,t,c,!0),null}function Kr(e,t){var a=t.ref;if(a===null)e!==null&&e.ref!==null&&(t.flags|=4194816);else{if(typeof a!="function"&&typeof a!="object")throw Error(s(284));(e===null||e.ref!==a)&&(t.flags|=4194816)}}function Wi(e,t,a,c,u){return oa(t),a=Ti(e,t,a,c,void 0,u),c=ki(),e!==null&&!Lt?(Ni(e,t,u),no(e,t,u)):(nt&&c&&pi(t),t.flags|=1,Vt(e,t,a,u),t.child)}function wf(e,t,a,c,u,g){return oa(t),t.updateQueue=null,a=_u(t,c,a,u),vu(e),c=ki(),e!==null&&!Lt?(Ni(e,t,g),no(e,t,g)):(nt&&c&&pi(t),t.flags|=1,Vt(e,t,a,g),t.child)}function Cf(e,t,a,c,u){if(oa(t),t.stateNode===null){var g=ka,R=a.contextType;typeof R=="object"&&R!==null&&(g=Kt(R)),g=new a(c,g),t.memoizedState=g.state!==null&&g.state!==void 0?g.state:null,g.updater=Gi,t.stateNode=g,g._reactInternals=t,g=t.stateNode,g.props=c,g.state=t.memoizedState,g.refs={},bi(t),R=a.contextType,g.context=typeof R=="object"&&R!==null?Kt(R):ka,g.state=t.memoizedState,R=a.getDerivedStateFromProps,typeof R=="function"&&(Vi(t,a,R,c),g.state=t.memoizedState),typeof a.getDerivedStateFromProps=="function"||typeof g.getSnapshotBeforeUpdate=="function"||typeof g.UNSAFE_componentWillMount!="function"&&typeof g.componentWillMount!="function"||(R=g.state,typeof g.componentWillMount=="function"&&g.componentWillMount(),typeof g.UNSAFE_componentWillMount=="function"&&g.UNSAFE_componentWillMount(),R!==g.state&&Gi.enqueueReplaceState(g,g.state,null),Tl(t,c,g,u),Dl(),g.state=t.memoizedState),typeof g.componentDidMount=="function"&&(t.flags|=4194308),c=!0}else if(e===null){g=t.stateNode;var O=t.memoizedProps,K=ra(a,O);g.props=K;var le=g.context,de=a.contextType;R=ka,typeof de=="object"&&de!==null&&(R=Kt(de));var pe=a.getDerivedStateFromProps;de=typeof pe=="function"||typeof g.getSnapshotBeforeUpdate=="function",O=t.pendingProps!==O,de||typeof g.UNSAFE_componentWillReceiveProps!="function"&&typeof g.componentWillReceiveProps!="function"||(O||le!==R)&&cf(t,g,c,R),xo=!1;var ie=t.memoizedState;g.state=ie,Tl(t,c,g,u),Dl(),le=t.memoizedState,O||ie!==le||xo?(typeof pe=="function"&&(Vi(t,a,pe,c),le=t.memoizedState),(K=xo||rf(t,a,K,c,ie,le,R))?(de||typeof g.UNSAFE_componentWillMount!="function"&&typeof g.componentWillMount!="function"||(typeof g.componentWillMount=="function"&&g.componentWillMount(),typeof g.UNSAFE_componentWillMount=="function"&&g.UNSAFE_componentWillMount()),typeof g.componentDidMount=="function"&&(t.flags|=4194308)):(typeof g.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=c,t.memoizedState=le),g.props=c,g.state=le,g.context=R,c=K):(typeof g.componentDidMount=="function"&&(t.flags|=4194308),c=!1)}else{g=t.stateNode,Si(e,t),R=t.memoizedProps,de=ra(a,R),g.props=de,pe=t.pendingProps,ie=g.context,le=a.contextType,K=ka,typeof le=="object"&&le!==null&&(K=Kt(le)),O=a.getDerivedStateFromProps,(le=typeof O=="function"||typeof g.getSnapshotBeforeUpdate=="function")||typeof g.UNSAFE_componentWillReceiveProps!="function"&&typeof g.componentWillReceiveProps!="function"||(R!==pe||ie!==K)&&cf(t,g,c,K),xo=!1,ie=t.memoizedState,g.state=ie,Tl(t,c,g,u),Dl();var se=t.memoizedState;R!==pe||ie!==se||xo||e!==null&&e.dependencies!==null&&Fr(e.dependencies)?(typeof O=="function"&&(Vi(t,a,O,c),se=t.memoizedState),(de=xo||rf(t,a,de,c,ie,se,K)||e!==null&&e.dependencies!==null&&Fr(e.dependencies))?(le||typeof g.UNSAFE_componentWillUpdate!="function"&&typeof g.componentWillUpdate!="function"||(typeof g.componentWillUpdate=="function"&&g.componentWillUpdate(c,se,K),typeof g.UNSAFE_componentWillUpdate=="function"&&g.UNSAFE_componentWillUpdate(c,se,K)),typeof g.componentDidUpdate=="function"&&(t.flags|=4),typeof g.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof g.componentDidUpdate!="function"||R===e.memoizedProps&&ie===e.memoizedState||(t.flags|=4),typeof g.getSnapshotBeforeUpdate!="function"||R===e.memoizedProps&&ie===e.memoizedState||(t.flags|=1024),t.memoizedProps=c,t.memoizedState=se),g.props=c,g.state=se,g.context=K,c=de):(typeof g.componentDidUpdate!="function"||R===e.memoizedProps&&ie===e.memoizedState||(t.flags|=4),typeof g.getSnapshotBeforeUpdate!="function"||R===e.memoizedProps&&ie===e.memoizedState||(t.flags|=1024),c=!1)}return g=c,Kr(e,t),c=(t.flags&128)!==0,g||c?(g=t.stateNode,a=c&&typeof a.getDerivedStateFromError!="function"?null:g.render(),t.flags|=1,e!==null&&c?(t.child=Pa(t,e.child,null,u),t.child=Pa(t,null,a,u)):Vt(e,t,a,u),t.memoizedState=g.state,e=t.child):e=no(e,t,u),e}function bf(e,t,a,c){return wl(),t.flags|=256,Vt(e,t,a,c),t.child}var Qi={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Xi(e){return{baseLanes:e,cachePool:su()}}function Zi(e,t,a){return e=e!==null?e.childLanes&~a:0,t&&(e|=An),e}function Sf(e,t,a){var c=t.pendingProps,u=!1,g=(t.flags&128)!==0,R;if((R=g)||(R=e!==null&&e.memoizedState===null?!1:($t.current&2)!==0),R&&(u=!0,t.flags&=-129),R=(t.flags&32)!==0,t.flags&=-33,e===null){if(nt){if(u?So(t):Eo(),nt){var O=xt,K;if(K=O){e:{for(K=O,O=Hn;K.nodeType!==8;){if(!O){O=null;break e}if(K=On(K.nextSibling),K===null){O=null;break e}}O=K}O!==null?(t.memoizedState={dehydrated:O,treeContext:Ko!==null?{id:Xn,overflow:Zn}:null,retryLane:536870912,hydrationErrors:null},K=fn(18,null,null,0),K.stateNode=O,K.return=t,t.child=K,nn=t,xt=null,K=!0):K=!1}K||ta(t)}if(O=t.memoizedState,O!==null&&(O=O.dehydrated,O!==null))return qs(O)?t.lanes=32:t.lanes=536870912,null;to(t)}return O=c.children,c=c.fallback,u?(Eo(),u=t.mode,O=Jr({mode:"hidden",children:O},u),c=Zo(c,u,a,null),O.return=t,c.return=t,O.sibling=c,t.child=O,u=t.child,u.memoizedState=Xi(a),u.childLanes=Zi(e,R,a),t.memoizedState=Qi,c):(So(t),Ki(t,O))}if(K=e.memoizedState,K!==null&&(O=K.dehydrated,O!==null)){if(g)t.flags&256?(So(t),t.flags&=-257,t=Ji(e,t,a)):t.memoizedState!==null?(Eo(),t.child=e.child,t.flags|=128,t=null):(Eo(),u=c.fallback,O=t.mode,c=Jr({mode:"visible",children:c.children},O),u=Zo(u,O,a,null),u.flags|=2,c.return=t,u.return=t,c.sibling=u,t.child=c,Pa(t,e.child,null,a),c=t.child,c.memoizedState=Xi(a),c.childLanes=Zi(e,R,a),t.memoizedState=Qi,t=u);else if(So(t),qs(O)){if(R=O.nextSibling&&O.nextSibling.dataset,R)var le=R.dgst;R=le,c=Error(s(419)),c.stack="",c.digest=R,Cl({value:c,source:null,stack:null}),t=Ji(e,t,a)}else if(Lt||bl(e,t,a,!1),R=(a&e.childLanes)!==0,Lt||R){if(R=ht,R!==null&&(c=a&-a,c=(c&42)!==0?1:bt(c),c=(c&(R.suspendedLanes|a))!==0?0:c,c!==0&&c!==K.retryLane))throw K.retryLane=c,Ta(e,c),yn(R,e,c),mf;O.data==="$?"||ys(),t=Ji(e,t,a)}else O.data==="$?"?(t.flags|=192,t.child=e.child,t=null):(e=K.treeContext,xt=On(O.nextSibling),nn=t,nt=!0,ea=null,Hn=!1,e!==null&&(Sn[En++]=Xn,Sn[En++]=Zn,Sn[En++]=Ko,Xn=e.id,Zn=e.overflow,Ko=t),t=Ki(t,c.children),t.flags|=4096);return t}return u?(Eo(),u=c.fallback,O=t.mode,K=e.child,le=K.sibling,c=Qn(K,{mode:"hidden",children:c.children}),c.subtreeFlags=K.subtreeFlags&65011712,le!==null?u=Qn(le,u):(u=Zo(u,O,a,null),u.flags|=2),u.return=t,c.return=t,c.sibling=u,t.child=c,c=u,u=t.child,O=e.child.memoizedState,O===null?O=Xi(a):(K=O.cachePool,K!==null?(le=Ut._currentValue,K=K.parent!==le?{parent:le,pool:le}:K):K=su(),O={baseLanes:O.baseLanes|a,cachePool:K}),u.memoizedState=O,u.childLanes=Zi(e,R,a),t.memoizedState=Qi,c):(So(t),a=e.child,e=a.sibling,a=Qn(a,{mode:"visible",children:c.children}),a.return=t,a.sibling=null,e!==null&&(R=t.deletions,R===null?(t.deletions=[e],t.flags|=16):R.push(e)),t.child=a,t.memoizedState=null,a)}function Ki(e,t){return t=Jr({mode:"visible",children:t},e.mode),t.return=e,e.child=t}function Jr(e,t){return e=fn(22,e,null,t),e.lanes=0,e.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},e}function Ji(e,t,a){return Pa(t,e.child,null,a),e=Ki(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function Ef(e,t,a){e.lanes|=t;var c=e.alternate;c!==null&&(c.lanes|=t),yi(e.return,t,a)}function es(e,t,a,c,u){var g=e.memoizedState;g===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:c,tail:a,tailMode:u}:(g.isBackwards=t,g.rendering=null,g.renderingStartTime=0,g.last=c,g.tail=a,g.tailMode=u)}function jf(e,t,a){var c=t.pendingProps,u=c.revealOrder,g=c.tail;if(Vt(e,t,c.children,a),c=$t.current,(c&2)!==0)c=c&1|2,t.flags|=128;else{if(e!==null&&(e.flags&128)!==0)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&Ef(e,a,t);else if(e.tag===19)Ef(e,a,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}c&=1}switch(V($t,c),u){case"forwards":for(a=t.child,u=null;a!==null;)e=a.alternate,e!==null&&Qr(e)===null&&(u=a),a=a.sibling;a=u,a===null?(u=t.child,t.child=null):(u=a.sibling,a.sibling=null),es(t,!1,u,a,g);break;case"backwards":for(a=null,u=t.child,t.child=null;u!==null;){if(e=u.alternate,e!==null&&Qr(e)===null){t.child=u;break}e=u.sibling,u.sibling=a,a=u,u=e}es(t,!0,a,null,g);break;case"together":es(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function no(e,t,a){if(e!==null&&(t.dependencies=e.dependencies),To|=t.lanes,(a&t.childLanes)===0)if(e!==null){if(bl(e,t,a,!1),(a&t.childLanes)===0)return null}else return null;if(e!==null&&t.child!==e.child)throw Error(s(153));if(t.child!==null){for(e=t.child,a=Qn(e,e.pendingProps),t.child=a,a.return=t;e.sibling!==null;)e=e.sibling,a=a.sibling=Qn(e,e.pendingProps),a.return=t;a.sibling=null}return t.child}function ts(e,t){return(e.lanes&t)!==0?!0:(e=e.dependencies,!!(e!==null&&Fr(e)))}function sy(e,t,a){switch(t.tag){case 3:he(t,t.stateNode.containerInfo),_o(t,Ut,e.memoizedState.cache),wl();break;case 27:case 5:me(t);break;case 4:he(t,t.stateNode.containerInfo);break;case 10:_o(t,t.type,t.memoizedProps.value);break;case 13:var c=t.memoizedState;if(c!==null)return c.dehydrated!==null?(So(t),t.flags|=128,null):(a&t.child.childLanes)!==0?Sf(e,t,a):(So(t),e=no(e,t,a),e!==null?e.sibling:null);So(t);break;case 19:var u=(e.flags&128)!==0;if(c=(a&t.childLanes)!==0,c||(bl(e,t,a,!1),c=(a&t.childLanes)!==0),u){if(c)return jf(e,t,a);t.flags|=128}if(u=t.memoizedState,u!==null&&(u.rendering=null,u.tail=null,u.lastEffect=null),V($t,$t.current),c)break;return null;case 22:case 23:return t.lanes=0,_f(e,t,a);case 24:_o(t,Ut,e.memoizedState.cache)}return no(e,t,a)}function Af(e,t,a){if(e!==null)if(e.memoizedProps!==t.pendingProps)Lt=!0;else{if(!ts(e,a)&&(t.flags&128)===0)return Lt=!1,sy(e,t,a);Lt=(e.flags&131072)!==0}else Lt=!1,nt&&(t.flags&1048576)!==0&&nu(t,Nr,t.index);switch(t.lanes=0,t.tag){case 16:e:{e=t.pendingProps;var c=t.elementType,u=c._init;if(c=u(c._payload),t.type=c,typeof c=="function")di(c)?(e=ra(c,e),t.tag=1,t=Cf(null,t,c,e,a)):(t.tag=0,t=Wi(null,t,c,e,a));else{if(c!=null){if(u=c.$$typeof,u===q){t.tag=11,t=gf(null,t,c,e,a);break e}else if(u===j){t.tag=14,t=yf(null,t,c,e,a);break e}}throw t=X(c)||c,Error(s(306,t,""))}}return t;case 0:return Wi(e,t,t.type,t.pendingProps,a);case 1:return c=t.type,u=ra(c,t.pendingProps),Cf(e,t,c,u,a);case 3:e:{if(he(t,t.stateNode.containerInfo),e===null)throw Error(s(387));c=t.pendingProps;var g=t.memoizedState;u=g.element,Si(e,t),Tl(t,c,null,a);var R=t.memoizedState;if(c=R.cache,_o(t,Ut,c),c!==g.cache&&vi(t,[Ut],a,!0),Dl(),c=R.element,g.isDehydrated)if(g={element:c,isDehydrated:!1,cache:R.cache},t.updateQueue.baseState=g,t.memoizedState=g,t.flags&256){t=bf(e,t,c,a);break e}else if(c!==u){u=Cn(Error(s(424)),t),Cl(u),t=bf(e,t,c,a);break e}else{switch(e=t.stateNode.containerInfo,e.nodeType){case 9:e=e.body;break;default:e=e.nodeName==="HTML"?e.ownerDocument.body:e}for(xt=On(e.firstChild),nn=t,nt=!0,ea=null,Hn=!0,a=af(t,null,c,a),t.child=a;a;)a.flags=a.flags&-3|4096,a=a.sibling}else{if(wl(),c===u){t=no(e,t,a);break e}Vt(e,t,c,a)}t=t.child}return t;case 26:return Kr(e,t),e===null?(a=kp(t.type,null,t.pendingProps,null))?t.memoizedState=a:nt||(a=t.type,e=t.pendingProps,c=pc(J.current).createElement(a),c[Ot]=t,c[Xt]=e,Yt(c,a,e),lt(c),t.stateNode=c):t.memoizedState=kp(t.type,e.memoizedProps,t.pendingProps,e.memoizedState),null;case 27:return me(t),e===null&&nt&&(c=t.stateNode=Rp(t.type,t.pendingProps,J.current),nn=t,Hn=!0,u=xt,qo(t.type)?(Us=u,xt=On(c.firstChild)):xt=u),Vt(e,t,t.pendingProps.children,a),Kr(e,t),e===null&&(t.flags|=4194304),t.child;case 5:return e===null&&nt&&((u=c=xt)&&(c=Oy(c,t.type,t.pendingProps,Hn),c!==null?(t.stateNode=c,nn=t,xt=On(c.firstChild),Hn=!1,u=!0):u=!1),u||ta(t)),me(t),u=t.type,g=t.pendingProps,R=e!==null?e.memoizedProps:null,c=g.children,ks(u,g)?c=null:R!==null&&ks(u,R)&&(t.flags|=32),t.memoizedState!==null&&(u=Ti(e,t,ty,null,null,a),Kl._currentValue=u),Kr(e,t),Vt(e,t,c,a),t.child;case 6:return e===null&&nt&&((e=a=xt)&&(a=Ly(a,t.pendingProps,Hn),a!==null?(t.stateNode=a,nn=t,xt=null,e=!0):e=!1),e||ta(t)),null;case 13:return Sf(e,t,a);case 4:return he(t,t.stateNode.containerInfo),c=t.pendingProps,e===null?t.child=Pa(t,null,c,a):Vt(e,t,c,a),t.child;case 11:return gf(e,t,t.type,t.pendingProps,a);case 7:return Vt(e,t,t.pendingProps,a),t.child;case 8:return Vt(e,t,t.pendingProps.children,a),t.child;case 12:return Vt(e,t,t.pendingProps.children,a),t.child;case 10:return c=t.pendingProps,_o(t,t.type,c.value),Vt(e,t,c.children,a),t.child;case 9:return u=t.type._context,c=t.pendingProps.children,oa(t),u=Kt(u),c=c(u),t.flags|=1,Vt(e,t,c,a),t.child;case 14:return yf(e,t,t.type,t.pendingProps,a);case 15:return vf(e,t,t.type,t.pendingProps,a);case 19:return jf(e,t,a);case 31:return c=t.pendingProps,a=t.mode,c={mode:c.mode,children:c.children},e===null?(a=Jr(c,a),a.ref=t.ref,t.child=a,a.return=t,t=a):(a=Qn(e.child,c),a.ref=t.ref,t.child=a,a.return=t,t=a),t;case 22:return _f(e,t,a);case 24:return oa(t),c=Kt(Ut),e===null?(u=wi(),u===null&&(u=ht,g=_i(),u.pooledCache=g,g.refCount++,g!==null&&(u.pooledCacheLanes|=a),u=g),t.memoizedState={parent:c,cache:u},bi(t),_o(t,Ut,u)):((e.lanes&a)!==0&&(Si(e,t),Tl(t,null,null,a),Dl()),u=e.memoizedState,g=t.memoizedState,u.parent!==c?(u={parent:c,cache:c},t.memoizedState=u,t.lanes===0&&(t.memoizedState=t.updateQueue.baseState=u),_o(t,Ut,c)):(c=g.cache,_o(t,Ut,c),c!==u.cache&&vi(t,[Ut],a,!0))),Vt(e,t,t.pendingProps.children,a),t.child;case 29:throw t.pendingProps}throw Error(s(156,t.tag))}function oo(e){e.flags|=4}function Rf(e,t){if(t.type!=="stylesheet"||(t.state.loading&4)!==0)e.flags&=-16777217;else if(e.flags|=16777216,!$p(t)){if(t=jn.current,t!==null&&((Ke&4194048)===Ke?Bn!==null:(Ke&62914560)!==Ke&&(Ke&536870912)===0||t!==Bn))throw Al=Ci,du;e.flags|=8192}}function ec(e,t){t!==null&&(e.flags|=4),e.flags&16384&&(t=e.tag!==22?ft():536870912,e.lanes|=t,Va|=t)}function Ol(e,t){if(!nt)switch(e.tailMode){case"hidden":t=e.tail;for(var a=null;t!==null;)t.alternate!==null&&(a=t),t=t.sibling;a===null?e.tail=null:a.sibling=null;break;case"collapsed":a=e.tail;for(var c=null;a!==null;)a.alternate!==null&&(c=a),a=a.sibling;c===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:c.sibling=null}}function yt(e){var t=e.alternate!==null&&e.alternate.child===e.child,a=0,c=0;if(t)for(var u=e.child;u!==null;)a|=u.lanes|u.childLanes,c|=u.subtreeFlags&65011712,c|=u.flags&65011712,u.return=e,u=u.sibling;else for(u=e.child;u!==null;)a|=u.lanes|u.childLanes,c|=u.subtreeFlags,c|=u.flags,u.return=e,u=u.sibling;return e.subtreeFlags|=c,e.childLanes=a,t}function dy(e,t,a){var c=t.pendingProps;switch(hi(t),t.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return yt(t),null;case 1:return yt(t),null;case 3:return a=t.stateNode,c=null,e!==null&&(c=e.memoizedState.cache),t.memoizedState.cache!==c&&(t.flags|=2048),Jn(Ut),ye(),a.pendingContext&&(a.context=a.pendingContext,a.pendingContext=null),(e===null||e.child===null)&&(xl(t)?oo(t):e===null||e.memoizedState.isDehydrated&&(t.flags&256)===0||(t.flags|=1024,lu())),yt(t),null;case 26:return a=t.memoizedState,e===null?(oo(t),a!==null?(yt(t),Rf(t,a)):(yt(t),t.flags&=-16777217)):a?a!==e.memoizedState?(oo(t),yt(t),Rf(t,a)):(yt(t),t.flags&=-16777217):(e.memoizedProps!==c&&oo(t),yt(t),t.flags&=-16777217),null;case 27:xe(t),a=J.current;var u=t.type;if(e!==null&&t.stateNode!=null)e.memoizedProps!==c&&oo(t);else{if(!c){if(t.stateNode===null)throw Error(s(166));return yt(t),null}e=Y.current,xl(t)?ou(t):(e=Rp(u,c,a),t.stateNode=e,oo(t))}return yt(t),null;case 5:if(xe(t),a=t.type,e!==null&&t.stateNode!=null)e.memoizedProps!==c&&oo(t);else{if(!c){if(t.stateNode===null)throw Error(s(166));return yt(t),null}if(e=Y.current,xl(t))ou(t);else{switch(u=pc(J.current),e){case 1:e=u.createElementNS("http://www.w3.org/2000/svg",a);break;case 2:e=u.createElementNS("http://www.w3.org/1998/Math/MathML",a);break;default:switch(a){case"svg":e=u.createElementNS("http://www.w3.org/2000/svg",a);break;case"math":e=u.createElementNS("http://www.w3.org/1998/Math/MathML",a);break;case"script":e=u.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild);break;case"select":e=typeof c.is=="string"?u.createElement("select",{is:c.is}):u.createElement("select"),c.multiple?e.multiple=!0:c.size&&(e.size=c.size);break;default:e=typeof c.is=="string"?u.createElement(a,{is:c.is}):u.createElement(a)}}e[Ot]=t,e[Xt]=c;e:for(u=t.child;u!==null;){if(u.tag===5||u.tag===6)e.appendChild(u.stateNode);else if(u.tag!==4&&u.tag!==27&&u.child!==null){u.child.return=u,u=u.child;continue}if(u===t)break e;for(;u.sibling===null;){if(u.return===null||u.return===t)break e;u=u.return}u.sibling.return=u.return,u=u.sibling}t.stateNode=e;e:switch(Yt(e,a,c),a){case"button":case"input":case"select":case"textarea":e=!!c.autoFocus;break e;case"img":e=!0;break e;default:e=!1}e&&oo(t)}}return yt(t),t.flags&=-16777217,null;case 6:if(e&&t.stateNode!=null)e.memoizedProps!==c&&oo(t);else{if(typeof c!="string"&&t.stateNode===null)throw Error(s(166));if(e=J.current,xl(t)){if(e=t.stateNode,a=t.memoizedProps,c=null,u=nn,u!==null)switch(u.tag){case 27:case 5:c=u.memoizedProps}e[Ot]=t,e=!!(e.nodeValue===a||c!==null&&c.suppressHydrationWarning===!0||wp(e.nodeValue,a)),e||ta(t)}else e=pc(e).createTextNode(c),e[Ot]=t,t.stateNode=e}return yt(t),null;case 13:if(c=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(u=xl(t),c!==null&&c.dehydrated!==null){if(e===null){if(!u)throw Error(s(318));if(u=t.memoizedState,u=u!==null?u.dehydrated:null,!u)throw Error(s(317));u[Ot]=t}else wl(),(t.flags&128)===0&&(t.memoizedState=null),t.flags|=4;yt(t),u=!1}else u=lu(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=u),u=!0;if(!u)return t.flags&256?(to(t),t):(to(t),null)}if(to(t),(t.flags&128)!==0)return t.lanes=a,t;if(a=c!==null,e=e!==null&&e.memoizedState!==null,a){c=t.child,u=null,c.alternate!==null&&c.alternate.memoizedState!==null&&c.alternate.memoizedState.cachePool!==null&&(u=c.alternate.memoizedState.cachePool.pool);var g=null;c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(g=c.memoizedState.cachePool.pool),g!==u&&(c.flags|=2048)}return a!==e&&a&&(t.child.flags|=8192),ec(t,t.updateQueue),yt(t),null;case 4:return ye(),e===null&&js(t.stateNode.containerInfo),yt(t),null;case 10:return Jn(t.type),yt(t),null;case 19:if(H($t),u=t.memoizedState,u===null)return yt(t),null;if(c=(t.flags&128)!==0,g=u.rendering,g===null)if(c)Ol(u,!1);else{if(wt!==0||e!==null&&(e.flags&128)!==0)for(e=t.child;e!==null;){if(g=Qr(e),g!==null){for(t.flags|=128,Ol(u,!1),e=g.updateQueue,t.updateQueue=e,ec(t,e),t.subtreeFlags=0,e=a,a=t.child;a!==null;)tu(a,e),a=a.sibling;return V($t,$t.current&1|2),t.child}e=e.sibling}u.tail!==null&&tt()>oc&&(t.flags|=128,c=!0,Ol(u,!1),t.lanes=4194304)}else{if(!c)if(e=Qr(g),e!==null){if(t.flags|=128,c=!0,e=e.updateQueue,t.updateQueue=e,ec(t,e),Ol(u,!0),u.tail===null&&u.tailMode==="hidden"&&!g.alternate&&!nt)return yt(t),null}else 2*tt()-u.renderingStartTime>oc&&a!==536870912&&(t.flags|=128,c=!0,Ol(u,!1),t.lanes=4194304);u.isBackwards?(g.sibling=t.child,t.child=g):(e=u.last,e!==null?e.sibling=g:t.child=g,u.last=g)}return u.tail!==null?(t=u.tail,u.rendering=t,u.tail=t.sibling,u.renderingStartTime=tt(),t.sibling=null,e=$t.current,V($t,c?e&1|2:e&1),t):(yt(t),null);case 22:case 23:return to(t),Ri(),c=t.memoizedState!==null,e!==null?e.memoizedState!==null!==c&&(t.flags|=8192):c&&(t.flags|=8192),c?(a&536870912)!==0&&(t.flags&128)===0&&(yt(t),t.subtreeFlags&6&&(t.flags|=8192)):yt(t),a=t.updateQueue,a!==null&&ec(t,a.retryQueue),a=null,e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(a=e.memoizedState.cachePool.pool),c=null,t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(c=t.memoizedState.cachePool.pool),c!==a&&(t.flags|=2048),e!==null&&H(aa),null;case 24:return a=null,e!==null&&(a=e.memoizedState.cache),t.memoizedState.cache!==a&&(t.flags|=2048),Jn(Ut),yt(t),null;case 25:return null;case 30:return null}throw Error(s(156,t.tag))}function uy(e,t){switch(hi(t),t.tag){case 1:return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return Jn(Ut),ye(),e=t.flags,(e&65536)!==0&&(e&128)===0?(t.flags=e&-65537|128,t):null;case 26:case 27:case 5:return xe(t),null;case 13:if(to(t),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(s(340));wl()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return H($t),null;case 4:return ye(),null;case 10:return Jn(t.type),null;case 22:case 23:return to(t),Ri(),e!==null&&H(aa),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 24:return Jn(Ut),null;case 25:return null;default:return null}}function Df(e,t){switch(hi(t),t.tag){case 3:Jn(Ut),ye();break;case 26:case 27:case 5:xe(t);break;case 4:ye();break;case 13:to(t);break;case 19:H($t);break;case 10:Jn(t.type);break;case 22:case 23:to(t),Ri(),e!==null&&H(aa);break;case 24:Jn(Ut)}}function Ll(e,t){try{var a=t.updateQueue,c=a!==null?a.lastEffect:null;if(c!==null){var u=c.next;a=u;do{if((a.tag&e)===e){c=void 0;var g=a.create,R=a.inst;c=g(),R.destroy=c}a=a.next}while(a!==u)}}catch(O){pt(t,t.return,O)}}function jo(e,t,a){try{var c=t.updateQueue,u=c!==null?c.lastEffect:null;if(u!==null){var g=u.next;c=g;do{if((c.tag&e)===e){var R=c.inst,O=R.destroy;if(O!==void 0){R.destroy=void 0,u=t;var K=a,le=O;try{le()}catch(de){pt(u,K,de)}}}c=c.next}while(c!==g)}}catch(de){pt(t,t.return,de)}}function Tf(e){var t=e.updateQueue;if(t!==null){var a=e.stateNode;try{gu(t,a)}catch(c){pt(e,e.return,c)}}}function kf(e,t,a){a.props=ra(e.type,e.memoizedProps),a.state=e.memoizedState;try{a.componentWillUnmount()}catch(c){pt(e,t,c)}}function Ml(e,t){try{var a=e.ref;if(a!==null){switch(e.tag){case 26:case 27:case 5:var c=e.stateNode;break;case 30:c=e.stateNode;break;default:c=e.stateNode}typeof a=="function"?e.refCleanup=a(c):a.current=c}}catch(u){pt(e,t,u)}}function zn(e,t){var a=e.ref,c=e.refCleanup;if(a!==null)if(typeof c=="function")try{c()}catch(u){pt(e,t,u)}finally{e.refCleanup=null,e=e.alternate,e!=null&&(e.refCleanup=null)}else if(typeof a=="function")try{a(null)}catch(u){pt(e,t,u)}else a.current=null}function Nf(e){var t=e.type,a=e.memoizedProps,c=e.stateNode;try{e:switch(t){case"button":case"input":case"select":case"textarea":a.autoFocus&&c.focus();break e;case"img":a.src?c.src=a.src:a.srcSet&&(c.srcset=a.srcSet)}}catch(u){pt(e,e.return,u)}}function ns(e,t,a){try{var c=e.stateNode;Ny(c,e.type,a,t),c[Xt]=t}catch(u){pt(e,e.return,u)}}function Ff(e){return e.tag===5||e.tag===3||e.tag===26||e.tag===27&&qo(e.type)||e.tag===4}function os(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||Ff(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.tag===27&&qo(e.type)||e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function as(e,t,a){var c=e.tag;if(c===5||c===6)e=e.stateNode,t?(a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a).insertBefore(e,t):(t=a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a,t.appendChild(e),a=a._reactRootContainer,a!=null||t.onclick!==null||(t.onclick=fc));else if(c!==4&&(c===27&&qo(e.type)&&(a=e.stateNode,t=null),e=e.child,e!==null))for(as(e,t,a),e=e.sibling;e!==null;)as(e,t,a),e=e.sibling}function tc(e,t,a){var c=e.tag;if(c===5||c===6)e=e.stateNode,t?a.insertBefore(e,t):a.appendChild(e);else if(c!==4&&(c===27&&qo(e.type)&&(a=e.stateNode),e=e.child,e!==null))for(tc(e,t,a),e=e.sibling;e!==null;)tc(e,t,a),e=e.sibling}function qf(e){var t=e.stateNode,a=e.memoizedProps;try{for(var c=e.type,u=t.attributes;u.length;)t.removeAttributeNode(u[0]);Yt(t,c,a),t[Ot]=e,t[Xt]=a}catch(g){pt(e,e.return,g)}}var ao=!1,jt=!1,ls=!1,Uf=typeof WeakSet=="function"?WeakSet:Set,Mt=null;function fy(e,t){if(e=e.containerInfo,Ds=_c,e=Vd(e),oi(e)){if("selectionStart"in e)var a={start:e.selectionStart,end:e.selectionEnd};else e:{a=(a=e.ownerDocument)&&a.defaultView||window;var c=a.getSelection&&a.getSelection();if(c&&c.rangeCount!==0){a=c.anchorNode;var u=c.anchorOffset,g=c.focusNode;c=c.focusOffset;try{a.nodeType,g.nodeType}catch{a=null;break e}var R=0,O=-1,K=-1,le=0,de=0,pe=e,ie=null;t:for(;;){for(var se;pe!==a||u!==0&&pe.nodeType!==3||(O=R+u),pe!==g||c!==0&&pe.nodeType!==3||(K=R+c),pe.nodeType===3&&(R+=pe.nodeValue.length),(se=pe.firstChild)!==null;)ie=pe,pe=se;for(;;){if(pe===e)break t;if(ie===a&&++le===u&&(O=R),ie===g&&++de===c&&(K=R),(se=pe.nextSibling)!==null)break;pe=ie,ie=pe.parentNode}pe=se}a=O===-1||K===-1?null:{start:O,end:K}}else a=null}a=a||{start:0,end:0}}else a=null;for(Ts={focusedElem:e,selectionRange:a},_c=!1,Mt=t;Mt!==null;)if(t=Mt,e=t.child,(t.subtreeFlags&1024)!==0&&e!==null)e.return=t,Mt=e;else for(;Mt!==null;){switch(t=Mt,g=t.alternate,e=t.flags,t.tag){case 0:break;case 11:case 15:break;case 1:if((e&1024)!==0&&g!==null){e=void 0,a=t,u=g.memoizedProps,g=g.memoizedState,c=a.stateNode;try{var $e=ra(a.type,u,a.elementType===a.type);e=c.getSnapshotBeforeUpdate($e,g),c.__reactInternalSnapshotBeforeUpdate=e}catch(ke){pt(a,a.return,ke)}}break;case 3:if((e&1024)!==0){if(e=t.stateNode.containerInfo,a=e.nodeType,a===9)Fs(e);else if(a===1)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":Fs(e);break;default:e.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((e&1024)!==0)throw Error(s(163))}if(e=t.sibling,e!==null){e.return=t.return,Mt=e;break}Mt=t.return}}function $f(e,t,a){var c=a.flags;switch(a.tag){case 0:case 11:case 15:Ao(e,a),c&4&&Ll(5,a);break;case 1:if(Ao(e,a),c&4)if(e=a.stateNode,t===null)try{e.componentDidMount()}catch(R){pt(a,a.return,R)}else{var u=ra(a.type,t.memoizedProps);t=t.memoizedState;try{e.componentDidUpdate(u,t,e.__reactInternalSnapshotBeforeUpdate)}catch(R){pt(a,a.return,R)}}c&64&&Tf(a),c&512&&Ml(a,a.return);break;case 3:if(Ao(e,a),c&64&&(e=a.updateQueue,e!==null)){if(t=null,a.child!==null)switch(a.child.tag){case 27:case 5:t=a.child.stateNode;break;case 1:t=a.child.stateNode}try{gu(e,t)}catch(R){pt(a,a.return,R)}}break;case 27:t===null&&c&4&&qf(a);case 26:case 5:Ao(e,a),t===null&&c&4&&Nf(a),c&512&&Ml(a,a.return);break;case 12:Ao(e,a);break;case 13:Ao(e,a),c&4&&Mf(e,a),c&64&&(e=a.memoizedState,e!==null&&(e=e.dehydrated,e!==null&&(a=wy.bind(null,a),My(e,a))));break;case 22:if(c=a.memoizedState!==null||ao,!c){t=t!==null&&t.memoizedState!==null||jt,u=ao;var g=jt;ao=c,(jt=t)&&!g?Ro(e,a,(a.subtreeFlags&8772)!==0):Ao(e,a),ao=u,jt=g}break;case 30:break;default:Ao(e,a)}}function Of(e){var t=e.alternate;t!==null&&(e.alternate=null,Of(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&Ce(t)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var gt=null,ln=!1;function lo(e,t,a){for(a=a.child;a!==null;)Lf(e,t,a),a=a.sibling}function Lf(e,t,a){if(mt&&typeof mt.onCommitFiberUnmount=="function")try{mt.onCommitFiberUnmount(Ct,a)}catch{}switch(a.tag){case 26:jt||zn(a,t),lo(e,t,a),a.memoizedState?a.memoizedState.count--:a.stateNode&&(a=a.stateNode,a.parentNode.removeChild(a));break;case 27:jt||zn(a,t);var c=gt,u=ln;qo(a.type)&&(gt=a.stateNode,ln=!1),lo(e,t,a),Wl(a.stateNode),gt=c,ln=u;break;case 5:jt||zn(a,t);case 6:if(c=gt,u=ln,gt=null,lo(e,t,a),gt=c,ln=u,gt!==null)if(ln)try{(gt.nodeType===9?gt.body:gt.nodeName==="HTML"?gt.ownerDocument.body:gt).removeChild(a.stateNode)}catch(g){pt(a,t,g)}else try{gt.removeChild(a.stateNode)}catch(g){pt(a,t,g)}break;case 18:gt!==null&&(ln?(e=gt,jp(e.nodeType===9?e.body:e.nodeName==="HTML"?e.ownerDocument.body:e,a.stateNode),nr(e)):jp(gt,a.stateNode));break;case 4:c=gt,u=ln,gt=a.stateNode.containerInfo,ln=!0,lo(e,t,a),gt=c,ln=u;break;case 0:case 11:case 14:case 15:jt||jo(2,a,t),jt||jo(4,a,t),lo(e,t,a);break;case 1:jt||(zn(a,t),c=a.stateNode,typeof c.componentWillUnmount=="function"&&kf(a,t,c)),lo(e,t,a);break;case 21:lo(e,t,a);break;case 22:jt=(c=jt)||a.memoizedState!==null,lo(e,t,a),jt=c;break;default:lo(e,t,a)}}function Mf(e,t){if(t.memoizedState===null&&(e=t.alternate,e!==null&&(e=e.memoizedState,e!==null&&(e=e.dehydrated,e!==null))))try{nr(e)}catch(a){pt(t,t.return,a)}}function py(e){switch(e.tag){case 13:case 19:var t=e.stateNode;return t===null&&(t=e.stateNode=new Uf),t;case 22:return e=e.stateNode,t=e._retryCache,t===null&&(t=e._retryCache=new Uf),t;default:throw Error(s(435,e.tag))}}function rs(e,t){var a=py(e);t.forEach(function(c){var u=Cy.bind(null,e,c);a.has(c)||(a.add(c),c.then(u,u))})}function pn(e,t){var a=t.deletions;if(a!==null)for(var c=0;c<a.length;c++){var u=a[c],g=e,R=t,O=R;e:for(;O!==null;){switch(O.tag){case 27:if(qo(O.type)){gt=O.stateNode,ln=!1;break e}break;case 5:gt=O.stateNode,ln=!1;break e;case 3:case 4:gt=O.stateNode.containerInfo,ln=!0;break e}O=O.return}if(gt===null)throw Error(s(160));Lf(g,R,u),gt=null,ln=!1,g=u.alternate,g!==null&&(g.return=null),u.return=null}if(t.subtreeFlags&13878)for(t=t.child;t!==null;)If(t,e),t=t.sibling}var $n=null;function If(e,t){var a=e.alternate,c=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:pn(t,e),hn(e),c&4&&(jo(3,e,e.return),Ll(3,e),jo(5,e,e.return));break;case 1:pn(t,e),hn(e),c&512&&(jt||a===null||zn(a,a.return)),c&64&&ao&&(e=e.updateQueue,e!==null&&(c=e.callbacks,c!==null&&(a=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=a===null?c:a.concat(c))));break;case 26:var u=$n;if(pn(t,e),hn(e),c&512&&(jt||a===null||zn(a,a.return)),c&4){var g=a!==null?a.memoizedState:null;if(c=e.memoizedState,a===null)if(c===null)if(e.stateNode===null){e:{c=e.type,a=e.memoizedProps,u=u.ownerDocument||u;t:switch(c){case"title":g=u.getElementsByTagName("title")[0],(!g||g[ge]||g[Ot]||g.namespaceURI==="http://www.w3.org/2000/svg"||g.hasAttribute("itemprop"))&&(g=u.createElement(c),u.head.insertBefore(g,u.querySelector("head > title"))),Yt(g,c,a),g[Ot]=e,lt(g),c=g;break e;case"link":var R=qp("link","href",u).get(c+(a.href||""));if(R){for(var O=0;O<R.length;O++)if(g=R[O],g.getAttribute("href")===(a.href==null||a.href===""?null:a.href)&&g.getAttribute("rel")===(a.rel==null?null:a.rel)&&g.getAttribute("title")===(a.title==null?null:a.title)&&g.getAttribute("crossorigin")===(a.crossOrigin==null?null:a.crossOrigin)){R.splice(O,1);break t}}g=u.createElement(c),Yt(g,c,a),u.head.appendChild(g);break;case"meta":if(R=qp("meta","content",u).get(c+(a.content||""))){for(O=0;O<R.length;O++)if(g=R[O],g.getAttribute("content")===(a.content==null?null:""+a.content)&&g.getAttribute("name")===(a.name==null?null:a.name)&&g.getAttribute("property")===(a.property==null?null:a.property)&&g.getAttribute("http-equiv")===(a.httpEquiv==null?null:a.httpEquiv)&&g.getAttribute("charset")===(a.charSet==null?null:a.charSet)){R.splice(O,1);break t}}g=u.createElement(c),Yt(g,c,a),u.head.appendChild(g);break;default:throw Error(s(468,c))}g[Ot]=e,lt(g),c=g}e.stateNode=c}else Up(u,e.type,e.stateNode);else e.stateNode=Fp(u,c,e.memoizedProps);else g!==c?(g===null?a.stateNode!==null&&(a=a.stateNode,a.parentNode.removeChild(a)):g.count--,c===null?Up(u,e.type,e.stateNode):Fp(u,c,e.memoizedProps)):c===null&&e.stateNode!==null&&ns(e,e.memoizedProps,a.memoizedProps)}break;case 27:pn(t,e),hn(e),c&512&&(jt||a===null||zn(a,a.return)),a!==null&&c&4&&ns(e,e.memoizedProps,a.memoizedProps);break;case 5:if(pn(t,e),hn(e),c&512&&(jt||a===null||zn(a,a.return)),e.flags&32){u=e.stateNode;try{ba(u,"")}catch(se){pt(e,e.return,se)}}c&4&&e.stateNode!=null&&(u=e.memoizedProps,ns(e,u,a!==null?a.memoizedProps:u)),c&1024&&(ls=!0);break;case 6:if(pn(t,e),hn(e),c&4){if(e.stateNode===null)throw Error(s(162));c=e.memoizedProps,a=e.stateNode;try{a.nodeValue=c}catch(se){pt(e,e.return,se)}}break;case 3:if(gc=null,u=$n,$n=hc(t.containerInfo),pn(t,e),$n=u,hn(e),c&4&&a!==null&&a.memoizedState.isDehydrated)try{nr(t.containerInfo)}catch(se){pt(e,e.return,se)}ls&&(ls=!1,Pf(e));break;case 4:c=$n,$n=hc(e.stateNode.containerInfo),pn(t,e),hn(e),$n=c;break;case 12:pn(t,e),hn(e);break;case 13:pn(t,e),hn(e),e.child.flags&8192&&e.memoizedState!==null!=(a!==null&&a.memoizedState!==null)&&(fs=tt()),c&4&&(c=e.updateQueue,c!==null&&(e.updateQueue=null,rs(e,c)));break;case 22:u=e.memoizedState!==null;var K=a!==null&&a.memoizedState!==null,le=ao,de=jt;if(ao=le||u,jt=de||K,pn(t,e),jt=de,ao=le,hn(e),c&8192)e:for(t=e.stateNode,t._visibility=u?t._visibility&-2:t._visibility|1,u&&(a===null||K||ao||jt||ca(e)),a=null,t=e;;){if(t.tag===5||t.tag===26){if(a===null){K=a=t;try{if(g=K.stateNode,u)R=g.style,typeof R.setProperty=="function"?R.setProperty("display","none","important"):R.display="none";else{O=K.stateNode;var pe=K.memoizedProps.style,ie=pe!=null&&pe.hasOwnProperty("display")?pe.display:null;O.style.display=ie==null||typeof ie=="boolean"?"":(""+ie).trim()}}catch(se){pt(K,K.return,se)}}}else if(t.tag===6){if(a===null){K=t;try{K.stateNode.nodeValue=u?"":K.memoizedProps}catch(se){pt(K,K.return,se)}}}else if((t.tag!==22&&t.tag!==23||t.memoizedState===null||t===e)&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;a===t&&(a=null),t=t.return}a===t&&(a=null),t.sibling.return=t.return,t=t.sibling}c&4&&(c=e.updateQueue,c!==null&&(a=c.retryQueue,a!==null&&(c.retryQueue=null,rs(e,a))));break;case 19:pn(t,e),hn(e),c&4&&(c=e.updateQueue,c!==null&&(e.updateQueue=null,rs(e,c)));break;case 30:break;case 21:break;default:pn(t,e),hn(e)}}function hn(e){var t=e.flags;if(t&2){try{for(var a,c=e.return;c!==null;){if(Ff(c)){a=c;break}c=c.return}if(a==null)throw Error(s(160));switch(a.tag){case 27:var u=a.stateNode,g=os(e);tc(e,g,u);break;case 5:var R=a.stateNode;a.flags&32&&(ba(R,""),a.flags&=-33);var O=os(e);tc(e,O,R);break;case 3:case 4:var K=a.stateNode.containerInfo,le=os(e);as(e,le,K);break;default:throw Error(s(161))}}catch(de){pt(e,e.return,de)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function Pf(e){if(e.subtreeFlags&1024)for(e=e.child;e!==null;){var t=e;Pf(t),t.tag===5&&t.flags&1024&&t.stateNode.reset(),e=e.sibling}}function Ao(e,t){if(t.subtreeFlags&8772)for(t=t.child;t!==null;)$f(e,t.alternate,t),t=t.sibling}function ca(e){for(e=e.child;e!==null;){var t=e;switch(t.tag){case 0:case 11:case 14:case 15:jo(4,t,t.return),ca(t);break;case 1:zn(t,t.return);var a=t.stateNode;typeof a.componentWillUnmount=="function"&&kf(t,t.return,a),ca(t);break;case 27:Wl(t.stateNode);case 26:case 5:zn(t,t.return),ca(t);break;case 22:t.memoizedState===null&&ca(t);break;case 30:ca(t);break;default:ca(t)}e=e.sibling}}function Ro(e,t,a){for(a=a&&(t.subtreeFlags&8772)!==0,t=t.child;t!==null;){var c=t.alternate,u=e,g=t,R=g.flags;switch(g.tag){case 0:case 11:case 15:Ro(u,g,a),Ll(4,g);break;case 1:if(Ro(u,g,a),c=g,u=c.stateNode,typeof u.componentDidMount=="function")try{u.componentDidMount()}catch(le){pt(c,c.return,le)}if(c=g,u=c.updateQueue,u!==null){var O=c.stateNode;try{var K=u.shared.hiddenCallbacks;if(K!==null)for(u.shared.hiddenCallbacks=null,u=0;u<K.length;u++)mu(K[u],O)}catch(le){pt(c,c.return,le)}}a&&R&64&&Tf(g),Ml(g,g.return);break;case 27:qf(g);case 26:case 5:Ro(u,g,a),a&&c===null&&R&4&&Nf(g),Ml(g,g.return);break;case 12:Ro(u,g,a);break;case 13:Ro(u,g,a),a&&R&4&&Mf(u,g);break;case 22:g.memoizedState===null&&Ro(u,g,a),Ml(g,g.return);break;case 30:break;default:Ro(u,g,a)}t=t.sibling}}function cs(e,t){var a=null;e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(a=e.memoizedState.cachePool.pool),e=null,t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(e=t.memoizedState.cachePool.pool),e!==a&&(e!=null&&e.refCount++,a!=null&&Sl(a))}function is(e,t){e=null,t.alternate!==null&&(e=t.alternate.memoizedState.cache),t=t.memoizedState.cache,t!==e&&(t.refCount++,e!=null&&Sl(e))}function Vn(e,t,a,c){if(t.subtreeFlags&10256)for(t=t.child;t!==null;)Hf(e,t,a,c),t=t.sibling}function Hf(e,t,a,c){var u=t.flags;switch(t.tag){case 0:case 11:case 15:Vn(e,t,a,c),u&2048&&Ll(9,t);break;case 1:Vn(e,t,a,c);break;case 3:Vn(e,t,a,c),u&2048&&(e=null,t.alternate!==null&&(e=t.alternate.memoizedState.cache),t=t.memoizedState.cache,t!==e&&(t.refCount++,e!=null&&Sl(e)));break;case 12:if(u&2048){Vn(e,t,a,c),e=t.stateNode;try{var g=t.memoizedProps,R=g.id,O=g.onPostCommit;typeof O=="function"&&O(R,t.alternate===null?"mount":"update",e.passiveEffectDuration,-0)}catch(K){pt(t,t.return,K)}}else Vn(e,t,a,c);break;case 13:Vn(e,t,a,c);break;case 23:break;case 22:g=t.stateNode,R=t.alternate,t.memoizedState!==null?g._visibility&2?Vn(e,t,a,c):Il(e,t):g._visibility&2?Vn(e,t,a,c):(g._visibility|=2,Ha(e,t,a,c,(t.subtreeFlags&10256)!==0)),u&2048&&cs(R,t);break;case 24:Vn(e,t,a,c),u&2048&&is(t.alternate,t);break;default:Vn(e,t,a,c)}}function Ha(e,t,a,c,u){for(u=u&&(t.subtreeFlags&10256)!==0,t=t.child;t!==null;){var g=e,R=t,O=a,K=c,le=R.flags;switch(R.tag){case 0:case 11:case 15:Ha(g,R,O,K,u),Ll(8,R);break;case 23:break;case 22:var de=R.stateNode;R.memoizedState!==null?de._visibility&2?Ha(g,R,O,K,u):Il(g,R):(de._visibility|=2,Ha(g,R,O,K,u)),u&&le&2048&&cs(R.alternate,R);break;case 24:Ha(g,R,O,K,u),u&&le&2048&&is(R.alternate,R);break;default:Ha(g,R,O,K,u)}t=t.sibling}}function Il(e,t){if(t.subtreeFlags&10256)for(t=t.child;t!==null;){var a=e,c=t,u=c.flags;switch(c.tag){case 22:Il(a,c),u&2048&&cs(c.alternate,c);break;case 24:Il(a,c),u&2048&&is(c.alternate,c);break;default:Il(a,c)}t=t.sibling}}var Pl=8192;function Ba(e){if(e.subtreeFlags&Pl)for(e=e.child;e!==null;)Bf(e),e=e.sibling}function Bf(e){switch(e.tag){case 26:Ba(e),e.flags&Pl&&e.memoizedState!==null&&Ky($n,e.memoizedState,e.memoizedProps);break;case 5:Ba(e);break;case 3:case 4:var t=$n;$n=hc(e.stateNode.containerInfo),Ba(e),$n=t;break;case 22:e.memoizedState===null&&(t=e.alternate,t!==null&&t.memoizedState!==null?(t=Pl,Pl=16777216,Ba(e),Pl=t):Ba(e));break;default:Ba(e)}}function zf(e){var t=e.alternate;if(t!==null&&(e=t.child,e!==null)){t.child=null;do t=e.sibling,e.sibling=null,e=t;while(e!==null)}}function Hl(e){var t=e.deletions;if((e.flags&16)!==0){if(t!==null)for(var a=0;a<t.length;a++){var c=t[a];Mt=c,Gf(c,e)}zf(e)}if(e.subtreeFlags&10256)for(e=e.child;e!==null;)Vf(e),e=e.sibling}function Vf(e){switch(e.tag){case 0:case 11:case 15:Hl(e),e.flags&2048&&jo(9,e,e.return);break;case 3:Hl(e);break;case 12:Hl(e);break;case 22:var t=e.stateNode;e.memoizedState!==null&&t._visibility&2&&(e.return===null||e.return.tag!==13)?(t._visibility&=-3,nc(e)):Hl(e);break;default:Hl(e)}}function nc(e){var t=e.deletions;if((e.flags&16)!==0){if(t!==null)for(var a=0;a<t.length;a++){var c=t[a];Mt=c,Gf(c,e)}zf(e)}for(e=e.child;e!==null;){switch(t=e,t.tag){case 0:case 11:case 15:jo(8,t,t.return),nc(t);break;case 22:a=t.stateNode,a._visibility&2&&(a._visibility&=-3,nc(t));break;default:nc(t)}e=e.sibling}}function Gf(e,t){for(;Mt!==null;){var a=Mt;switch(a.tag){case 0:case 11:case 15:jo(8,a,t);break;case 23:case 22:if(a.memoizedState!==null&&a.memoizedState.cachePool!==null){var c=a.memoizedState.cachePool.pool;c!=null&&c.refCount++}break;case 24:Sl(a.memoizedState.cache)}if(c=a.child,c!==null)c.return=a,Mt=c;else e:for(a=e;Mt!==null;){c=Mt;var u=c.sibling,g=c.return;if(Of(c),c===a){Mt=null;break e}if(u!==null){u.return=g,Mt=u;break e}Mt=g}}}var hy={getCacheForType:function(e){var t=Kt(Ut),a=t.data.get(e);return a===void 0&&(a=e(),t.data.set(e,a)),a}},my=typeof WeakMap=="function"?WeakMap:Map,rt=0,ht=null,ze=null,Ke=0,ct=0,mn=null,Do=!1,za=!1,ss=!1,ro=0,wt=0,To=0,ia=0,ds=0,An=0,Va=0,Bl=null,rn=null,us=!1,fs=0,oc=1/0,ac=null,ko=null,Gt=0,No=null,Ga=null,Ya=0,ps=0,hs=null,Yf=null,zl=0,ms=null;function gn(){if((rt&2)!==0&&Ke!==0)return Ke&-Ke;if($.T!==null){var e=qa;return e!==0?e:Cs()}return hr()}function Wf(){An===0&&(An=(Ke&536870912)===0||nt?We():536870912);var e=jn.current;return e!==null&&(e.flags|=32),An}function yn(e,t,a){(e===ht&&(ct===2||ct===9)||e.cancelPendingCommit!==null)&&(Wa(e,0),Fo(e,Ke,An,!1)),Bt(e,a),((rt&2)===0||e!==ht)&&(e===ht&&((rt&2)===0&&(ia|=a),wt===4&&Fo(e,Ke,An,!1)),Gn(e))}function Qf(e,t,a){if((rt&6)!==0)throw Error(s(327));var c=!a&&(t&124)===0&&(t&e.expiredLanes)===0||Oe(e,t),u=c?vy(e,t):vs(e,t,!0),g=c;do{if(u===0){za&&!c&&Fo(e,t,0,!1);break}else{if(a=e.current.alternate,g&&!gy(a)){u=vs(e,t,!1),g=!1;continue}if(u===2){if(g=t,e.errorRecoveryDisabledLanes&g)var R=0;else R=e.pendingLanes&-536870913,R=R!==0?R:R&536870912?536870912:0;if(R!==0){t=R;e:{var O=e;u=Bl;var K=O.current.memoizedState.isDehydrated;if(K&&(Wa(O,R).flags|=256),R=vs(O,R,!1),R!==2){if(ss&&!K){O.errorRecoveryDisabledLanes|=g,ia|=g,u=4;break e}g=rn,rn=u,g!==null&&(rn===null?rn=g:rn.push.apply(rn,g))}u=R}if(g=!1,u!==2)continue}}if(u===1){Wa(e,0),Fo(e,t,0,!0);break}e:{switch(c=e,g=u,g){case 0:case 1:throw Error(s(345));case 4:if((t&4194048)!==t)break;case 6:Fo(c,t,An,!Do);break e;case 2:rn=null;break;case 3:case 5:break;default:throw Error(s(329))}if((t&62914560)===t&&(u=fs+300-tt(),10<u)){if(Fo(c,t,An,!Do),De(c,0,!0)!==0)break e;c.timeoutHandle=Sp(Xf.bind(null,c,a,rn,ac,us,t,An,ia,Va,Do,g,2,-0,0),u);break e}Xf(c,a,rn,ac,us,t,An,ia,Va,Do,g,0,-0,0)}}break}while(!0);Gn(e)}function Xf(e,t,a,c,u,g,R,O,K,le,de,pe,ie,se){if(e.timeoutHandle=-1,pe=t.subtreeFlags,(pe&8192||(pe&16785408)===16785408)&&(Zl={stylesheets:null,count:0,unsuspend:Zy},Bf(t),pe=Jy(),pe!==null)){e.cancelPendingCommit=pe(op.bind(null,e,t,g,a,c,u,R,O,K,de,1,ie,se)),Fo(e,g,R,!le);return}op(e,t,g,a,c,u,R,O,K)}function gy(e){for(var t=e;;){var a=t.tag;if((a===0||a===11||a===15)&&t.flags&16384&&(a=t.updateQueue,a!==null&&(a=a.stores,a!==null)))for(var c=0;c<a.length;c++){var u=a[c],g=u.getSnapshot;u=u.value;try{if(!un(g(),u))return!1}catch{return!1}}if(a=t.child,t.subtreeFlags&16384&&a!==null)a.return=t,t=a;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Fo(e,t,a,c){t&=~ds,t&=~ia,e.suspendedLanes|=t,e.pingedLanes&=~t,c&&(e.warmLanes|=t),c=e.expirationTimes;for(var u=t;0<u;){var g=31-_t(u),R=1<<g;c[g]=-1,u&=~R}a!==0&&sl(e,a,t)}function lc(){return(rt&6)===0?(Vl(0),!1):!0}function gs(){if(ze!==null){if(ct===0)var e=ze.return;else e=ze,Kn=na=null,Fi(e),Ia=null,Ul=0,e=ze;for(;e!==null;)Df(e.alternate,e),e=e.return;ze=null}}function Wa(e,t){var a=e.timeoutHandle;a!==-1&&(e.timeoutHandle=-1,qy(a)),a=e.cancelPendingCommit,a!==null&&(e.cancelPendingCommit=null,a()),gs(),ht=e,ze=a=Qn(e.current,null),Ke=t,ct=0,mn=null,Do=!1,za=Oe(e,t),ss=!1,Va=An=ds=ia=To=wt=0,rn=Bl=null,us=!1,(t&8)!==0&&(t|=t&32);var c=e.entangledLanes;if(c!==0)for(e=e.entanglements,c&=t;0<c;){var u=31-_t(c),g=1<<u;t|=e[u],c&=~g}return ro=t,Ar(),a}function Zf(e,t){Pe=null,$.H=Gr,t===jl||t===$r?(t=pu(),ct=3):t===du?(t=pu(),ct=4):ct=t===mf?8:t!==null&&typeof t=="object"&&typeof t.then=="function"?6:1,mn=t,ze===null&&(wt=1,Zr(e,Cn(t,e.current)))}function Kf(){var e=$.H;return $.H=Gr,e===null?Gr:e}function Jf(){var e=$.A;return $.A=hy,e}function ys(){wt=4,Do||(Ke&4194048)!==Ke&&jn.current!==null||(za=!0),(To&134217727)===0&&(ia&134217727)===0||ht===null||Fo(ht,Ke,An,!1)}function vs(e,t,a){var c=rt;rt|=2;var u=Kf(),g=Jf();(ht!==e||Ke!==t)&&(ac=null,Wa(e,t)),t=!1;var R=wt;e:do try{if(ct!==0&&ze!==null){var O=ze,K=mn;switch(ct){case 8:gs(),R=6;break e;case 3:case 2:case 9:case 6:jn.current===null&&(t=!0);var le=ct;if(ct=0,mn=null,Qa(e,O,K,le),a&&za){R=0;break e}break;default:le=ct,ct=0,mn=null,Qa(e,O,K,le)}}yy(),R=wt;break}catch(de){Zf(e,de)}while(!0);return t&&e.shellSuspendCounter++,Kn=na=null,rt=c,$.H=u,$.A=g,ze===null&&(ht=null,Ke=0,Ar()),R}function yy(){for(;ze!==null;)ep(ze)}function vy(e,t){var a=rt;rt|=2;var c=Kf(),u=Jf();ht!==e||Ke!==t?(ac=null,oc=tt()+500,Wa(e,t)):za=Oe(e,t);e:do try{if(ct!==0&&ze!==null){t=ze;var g=mn;t:switch(ct){case 1:ct=0,mn=null,Qa(e,t,g,1);break;case 2:case 9:if(uu(g)){ct=0,mn=null,tp(t);break}t=function(){ct!==2&&ct!==9||ht!==e||(ct=7),Gn(e)},g.then(t,t);break e;case 3:ct=7;break e;case 4:ct=5;break e;case 7:uu(g)?(ct=0,mn=null,tp(t)):(ct=0,mn=null,Qa(e,t,g,7));break;case 5:var R=null;switch(ze.tag){case 26:R=ze.memoizedState;case 5:case 27:var O=ze;if(!R||$p(R)){ct=0,mn=null;var K=O.sibling;if(K!==null)ze=K;else{var le=O.return;le!==null?(ze=le,rc(le)):ze=null}break t}}ct=0,mn=null,Qa(e,t,g,5);break;case 6:ct=0,mn=null,Qa(e,t,g,6);break;case 8:gs(),wt=6;break e;default:throw Error(s(462))}}_y();break}catch(de){Zf(e,de)}while(!0);return Kn=na=null,$.H=c,$.A=u,rt=a,ze!==null?0:(ht=null,Ke=0,Ar(),wt)}function _y(){for(;ze!==null&&!Se();)ep(ze)}function ep(e){var t=Af(e.alternate,e,ro);e.memoizedProps=e.pendingProps,t===null?rc(e):ze=t}function tp(e){var t=e,a=t.alternate;switch(t.tag){case 15:case 0:t=wf(a,t,t.pendingProps,t.type,void 0,Ke);break;case 11:t=wf(a,t,t.pendingProps,t.type.render,t.ref,Ke);break;case 5:Fi(t);default:Df(a,t),t=ze=tu(t,ro),t=Af(a,t,ro)}e.memoizedProps=e.pendingProps,t===null?rc(e):ze=t}function Qa(e,t,a,c){Kn=na=null,Fi(t),Ia=null,Ul=0;var u=t.return;try{if(iy(e,u,t,a,Ke)){wt=1,Zr(e,Cn(a,e.current)),ze=null;return}}catch(g){if(u!==null)throw ze=u,g;wt=1,Zr(e,Cn(a,e.current)),ze=null;return}t.flags&32768?(nt||c===1?e=!0:za||(Ke&536870912)!==0?e=!1:(Do=e=!0,(c===2||c===9||c===3||c===6)&&(c=jn.current,c!==null&&c.tag===13&&(c.flags|=16384))),np(t,e)):rc(t)}function rc(e){var t=e;do{if((t.flags&32768)!==0){np(t,Do);return}e=t.return;var a=dy(t.alternate,t,ro);if(a!==null){ze=a;return}if(t=t.sibling,t!==null){ze=t;return}ze=t=e}while(t!==null);wt===0&&(wt=5)}function np(e,t){do{var a=uy(e.alternate,e);if(a!==null){a.flags&=32767,ze=a;return}if(a=e.return,a!==null&&(a.flags|=32768,a.subtreeFlags=0,a.deletions=null),!t&&(e=e.sibling,e!==null)){ze=e;return}ze=e=a}while(e!==null);wt=6,ze=null}function op(e,t,a,c,u,g,R,O,K){e.cancelPendingCommit=null;do cc();while(Gt!==0);if((rt&6)!==0)throw Error(s(327));if(t!==null){if(t===e.current)throw Error(s(177));if(g=t.lanes|t.childLanes,g|=ii,mo(e,a,g,R,O,K),e===ht&&(ze=ht=null,Ke=0),Ga=t,No=e,Ya=a,ps=g,hs=u,Yf=c,(t.subtreeFlags&10256)!==0||(t.flags&10256)!==0?(e.callbackNode=null,e.callbackPriority=0,by(He,function(){return ip(),null})):(e.callbackNode=null,e.callbackPriority=0),c=(t.flags&13878)!==0,(t.subtreeFlags&13878)!==0||c){c=$.T,$.T=null,u=W.p,W.p=2,R=rt,rt|=4;try{fy(e,t,a)}finally{rt=R,W.p=u,$.T=c}}Gt=1,ap(),lp(),rp()}}function ap(){if(Gt===1){Gt=0;var e=No,t=Ga,a=(t.flags&13878)!==0;if((t.subtreeFlags&13878)!==0||a){a=$.T,$.T=null;var c=W.p;W.p=2;var u=rt;rt|=4;try{If(t,e);var g=Ts,R=Vd(e.containerInfo),O=g.focusedElem,K=g.selectionRange;if(R!==O&&O&&O.ownerDocument&&zd(O.ownerDocument.documentElement,O)){if(K!==null&&oi(O)){var le=K.start,de=K.end;if(de===void 0&&(de=le),"selectionStart"in O)O.selectionStart=le,O.selectionEnd=Math.min(de,O.value.length);else{var pe=O.ownerDocument||document,ie=pe&&pe.defaultView||window;if(ie.getSelection){var se=ie.getSelection(),$e=O.textContent.length,ke=Math.min(K.start,$e),ut=K.end===void 0?ke:Math.min(K.end,$e);!se.extend&&ke>ut&&(R=ut,ut=ke,ke=R);var oe=Bd(O,ke),te=Bd(O,ut);if(oe&&te&&(se.rangeCount!==1||se.anchorNode!==oe.node||se.anchorOffset!==oe.offset||se.focusNode!==te.node||se.focusOffset!==te.offset)){var ae=pe.createRange();ae.setStart(oe.node,oe.offset),se.removeAllRanges(),ke>ut?(se.addRange(ae),se.extend(te.node,te.offset)):(ae.setEnd(te.node,te.offset),se.addRange(ae))}}}}for(pe=[],se=O;se=se.parentNode;)se.nodeType===1&&pe.push({element:se,left:se.scrollLeft,top:se.scrollTop});for(typeof O.focus=="function"&&O.focus(),O=0;O<pe.length;O++){var fe=pe[O];fe.element.scrollLeft=fe.left,fe.element.scrollTop=fe.top}}_c=!!Ds,Ts=Ds=null}finally{rt=u,W.p=c,$.T=a}}e.current=t,Gt=2}}function lp(){if(Gt===2){Gt=0;var e=No,t=Ga,a=(t.flags&8772)!==0;if((t.subtreeFlags&8772)!==0||a){a=$.T,$.T=null;var c=W.p;W.p=2;var u=rt;rt|=4;try{$f(e,t.alternate,t)}finally{rt=u,W.p=c,$.T=a}}Gt=3}}function rp(){if(Gt===4||Gt===3){Gt=0,Me();var e=No,t=Ga,a=Ya,c=Yf;(t.subtreeFlags&10256)!==0||(t.flags&10256)!==0?Gt=5:(Gt=0,Ga=No=null,cp(e,e.pendingLanes));var u=e.pendingLanes;if(u===0&&(ko=null),va(a),t=t.stateNode,mt&&typeof mt.onCommitFiberRoot=="function")try{mt.onCommitFiberRoot(Ct,t,void 0,(t.current.flags&128)===128)}catch{}if(c!==null){t=$.T,u=W.p,W.p=2,$.T=null;try{for(var g=e.onRecoverableError,R=0;R<c.length;R++){var O=c[R];g(O.value,{componentStack:O.stack})}}finally{$.T=t,W.p=u}}(Ya&3)!==0&&cc(),Gn(e),u=e.pendingLanes,(a&4194090)!==0&&(u&42)!==0?e===ms?zl++:(zl=0,ms=e):zl=0,Vl(0)}}function cp(e,t){(e.pooledCacheLanes&=t)===0&&(t=e.pooledCache,t!=null&&(e.pooledCache=null,Sl(t)))}function cc(e){return ap(),lp(),rp(),ip()}function ip(){if(Gt!==5)return!1;var e=No,t=ps;ps=0;var a=va(Ya),c=$.T,u=W.p;try{W.p=32>a?32:a,$.T=null,a=hs,hs=null;var g=No,R=Ya;if(Gt=0,Ga=No=null,Ya=0,(rt&6)!==0)throw Error(s(331));var O=rt;if(rt|=4,Vf(g.current),Hf(g,g.current,R,a),rt=O,Vl(0,!1),mt&&typeof mt.onPostCommitFiberRoot=="function")try{mt.onPostCommitFiberRoot(Ct,g)}catch{}return!0}finally{W.p=u,$.T=c,cp(e,t)}}function sp(e,t,a){t=Cn(a,t),t=Yi(e.stateNode,t,2),e=Co(e,t,2),e!==null&&(Bt(e,2),Gn(e))}function pt(e,t,a){if(e.tag===3)sp(e,e,a);else for(;t!==null;){if(t.tag===3){sp(t,e,a);break}else if(t.tag===1){var c=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof c.componentDidCatch=="function"&&(ko===null||!ko.has(c))){e=Cn(a,e),a=pf(2),c=Co(t,a,2),c!==null&&(hf(a,c,t,e),Bt(c,2),Gn(c));break}}t=t.return}}function _s(e,t,a){var c=e.pingCache;if(c===null){c=e.pingCache=new my;var u=new Set;c.set(t,u)}else u=c.get(t),u===void 0&&(u=new Set,c.set(t,u));u.has(a)||(ss=!0,u.add(a),e=xy.bind(null,e,t,a),t.then(e,e))}function xy(e,t,a){var c=e.pingCache;c!==null&&c.delete(t),e.pingedLanes|=e.suspendedLanes&a,e.warmLanes&=~a,ht===e&&(Ke&a)===a&&(wt===4||wt===3&&(Ke&62914560)===Ke&&300>tt()-fs?(rt&2)===0&&Wa(e,0):ds|=a,Va===Ke&&(Va=0)),Gn(e)}function dp(e,t){t===0&&(t=ft()),e=Ta(e,t),e!==null&&(Bt(e,t),Gn(e))}function wy(e){var t=e.memoizedState,a=0;t!==null&&(a=t.retryLane),dp(e,a)}function Cy(e,t){var a=0;switch(e.tag){case 13:var c=e.stateNode,u=e.memoizedState;u!==null&&(a=u.retryLane);break;case 19:c=e.stateNode;break;case 22:c=e.stateNode._retryCache;break;default:throw Error(s(314))}c!==null&&c.delete(t),dp(e,a)}function by(e,t){return Ue(e,t)}var ic=null,Xa=null,xs=!1,sc=!1,ws=!1,sa=0;function Gn(e){e!==Xa&&e.next===null&&(Xa===null?ic=Xa=e:Xa=Xa.next=e),sc=!0,xs||(xs=!0,Ey())}function Vl(e,t){if(!ws&&sc){ws=!0;do for(var a=!1,c=ic;c!==null;){if(e!==0){var u=c.pendingLanes;if(u===0)var g=0;else{var R=c.suspendedLanes,O=c.pingedLanes;g=(1<<31-_t(42|e)+1)-1,g&=u&~(R&~O),g=g&201326741?g&201326741|1:g?g|2:0}g!==0&&(a=!0,hp(c,g))}else g=Ke,g=De(c,c===ht?g:0,c.cancelPendingCommit!==null||c.timeoutHandle!==-1),(g&3)===0||Oe(c,g)||(a=!0,hp(c,g));c=c.next}while(a);ws=!1}}function Sy(){up()}function up(){sc=xs=!1;var e=0;sa!==0&&(Fy()&&(e=sa),sa=0);for(var t=tt(),a=null,c=ic;c!==null;){var u=c.next,g=fp(c,t);g===0?(c.next=null,a===null?ic=u:a.next=u,u===null&&(Xa=a)):(a=c,(e!==0||(g&3)!==0)&&(sc=!0)),c=u}Vl(e)}function fp(e,t){for(var a=e.suspendedLanes,c=e.pingedLanes,u=e.expirationTimes,g=e.pendingLanes&-62914561;0<g;){var R=31-_t(g),O=1<<R,K=u[R];K===-1?((O&a)===0||(O&c)!==0)&&(u[R]=at(O,t)):K<=t&&(e.expiredLanes|=O),g&=~O}if(t=ht,a=Ke,a=De(e,e===t?a:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),c=e.callbackNode,a===0||e===t&&(ct===2||ct===9)||e.cancelPendingCommit!==null)return c!==null&&c!==null&&Xe(c),e.callbackNode=null,e.callbackPriority=0;if((a&3)===0||Oe(e,a)){if(t=a&-a,t===e.callbackPriority)return t;switch(c!==null&&Xe(c),va(a)){case 2:case 8:a=Te;break;case 32:a=He;break;case 268435456:a=Je;break;default:a=He}return c=pp.bind(null,e),a=Ue(a,c),e.callbackPriority=t,e.callbackNode=a,t}return c!==null&&c!==null&&Xe(c),e.callbackPriority=2,e.callbackNode=null,2}function pp(e,t){if(Gt!==0&&Gt!==5)return e.callbackNode=null,e.callbackPriority=0,null;var a=e.callbackNode;if(cc()&&e.callbackNode!==a)return null;var c=Ke;return c=De(e,e===ht?c:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),c===0?null:(Qf(e,c,t),fp(e,tt()),e.callbackNode!=null&&e.callbackNode===a?pp.bind(null,e):null)}function hp(e,t){if(cc())return null;Qf(e,t,!0)}function Ey(){Uy(function(){(rt&6)!==0?Ue(Qt,Sy):up()})}function Cs(){return sa===0&&(sa=We()),sa}function mp(e){return e==null||typeof e=="symbol"||typeof e=="boolean"?null:typeof e=="function"?e:xr(""+e)}function gp(e,t){var a=t.ownerDocument.createElement("input");return a.name=t.name,a.value=t.value,e.id&&a.setAttribute("form",e.id),t.parentNode.insertBefore(a,t),e=new FormData(e),a.parentNode.removeChild(a),e}function jy(e,t,a,c,u){if(t==="submit"&&a&&a.stateNode===u){var g=mp((u[Xt]||null).action),R=c.submitter;R&&(t=(t=R[Xt]||null)?mp(t.formAction):R.getAttribute("formAction"),t!==null&&(g=t,R=null));var O=new Sr("action","action",null,c,u);e.push({event:O,listeners:[{instance:null,listener:function(){if(c.defaultPrevented){if(sa!==0){var K=R?gp(u,R):new FormData(u);Hi(a,{pending:!0,data:K,method:u.method,action:g},null,K)}}else typeof g=="function"&&(O.preventDefault(),K=R?gp(u,R):new FormData(u),Hi(a,{pending:!0,data:K,method:u.method,action:g},g,K))},currentTarget:u}]})}}for(var bs=0;bs<ci.length;bs++){var Ss=ci[bs],Ay=Ss.toLowerCase(),Ry=Ss[0].toUpperCase()+Ss.slice(1);Un(Ay,"on"+Ry)}Un(Wd,"onAnimationEnd"),Un(Qd,"onAnimationIteration"),Un(Xd,"onAnimationStart"),Un("dblclick","onDoubleClick"),Un("focusin","onFocus"),Un("focusout","onBlur"),Un(Vg,"onTransitionRun"),Un(Gg,"onTransitionStart"),Un(Yg,"onTransitionCancel"),Un(Zd,"onTransitionEnd"),yo("onMouseEnter",["mouseout","mouseover"]),yo("onMouseLeave",["mouseout","mouseover"]),yo("onPointerEnter",["pointerout","pointerover"]),yo("onPointerLeave",["pointerout","pointerover"]),tn("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),tn("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),tn("onBeforeInput",["compositionend","keypress","textInput","paste"]),tn("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),tn("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),tn("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Gl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Dy=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Gl));function yp(e,t){t=(t&4)!==0;for(var a=0;a<e.length;a++){var c=e[a],u=c.event;c=c.listeners;e:{var g=void 0;if(t)for(var R=c.length-1;0<=R;R--){var O=c[R],K=O.instance,le=O.currentTarget;if(O=O.listener,K!==g&&u.isPropagationStopped())break e;g=O,u.currentTarget=le;try{g(u)}catch(de){Xr(de)}u.currentTarget=null,g=K}else for(R=0;R<c.length;R++){if(O=c[R],K=O.instance,le=O.currentTarget,O=O.listener,K!==g&&u.isPropagationStopped())break e;g=O,u.currentTarget=le;try{g(u)}catch(de){Xr(de)}u.currentTarget=null,g=K}}}}function Ve(e,t){var a=t[_a];a===void 0&&(a=t[_a]=new Set);var c=e+"__bubble";a.has(c)||(vp(t,e,2,!1),a.add(c))}function Es(e,t,a){var c=0;t&&(c|=4),vp(a,e,c,t)}var dc="_reactListening"+Math.random().toString(36).slice(2);function js(e){if(!e[dc]){e[dc]=!0,Pn.forEach(function(a){a!=="selectionchange"&&(Dy.has(a)||Es(a,!1,e),Es(a,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[dc]||(t[dc]=!0,Es("selectionchange",!1,t))}}function vp(e,t,a,c){switch(Hp(t)){case 2:var u=nv;break;case 8:u=ov;break;default:u=Is}a=u.bind(null,t,a,e),u=void 0,!Wc||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(u=!0),c?u!==void 0?e.addEventListener(t,a,{capture:!0,passive:u}):e.addEventListener(t,a,!0):u!==void 0?e.addEventListener(t,a,{passive:u}):e.addEventListener(t,a,!1)}function As(e,t,a,c,u){var g=c;if((t&1)===0&&(t&2)===0&&c!==null)e:for(;;){if(c===null)return;var R=c.tag;if(R===3||R===4){var O=c.stateNode.containerInfo;if(O===u)break;if(R===4)for(R=c.return;R!==null;){var K=R.tag;if((K===3||K===4)&&R.stateNode.containerInfo===u)return;R=R.return}for(;O!==null;){if(R=qe(O),R===null)return;if(K=R.tag,K===5||K===6||K===26||K===27){c=g=R;continue e}O=O.parentNode}}c=c.return}Sd(function(){var le=g,de=Gc(a),pe=[];e:{var ie=Kd.get(e);if(ie!==void 0){var se=Sr,$e=e;switch(e){case"keypress":if(Cr(a)===0)break e;case"keydown":case"keyup":se=bg;break;case"focusin":$e="focus",se=Kc;break;case"focusout":$e="blur",se=Kc;break;case"beforeblur":case"afterblur":se=Kc;break;case"click":if(a.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":se=Ad;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":se=ug;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":se=jg;break;case Wd:case Qd:case Xd:se=hg;break;case Zd:se=Rg;break;case"scroll":case"scrollend":se=sg;break;case"wheel":se=Tg;break;case"copy":case"cut":case"paste":se=gg;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":se=Dd;break;case"toggle":case"beforetoggle":se=Ng}var ke=(t&4)!==0,ut=!ke&&(e==="scroll"||e==="scrollend"),oe=ke?ie!==null?ie+"Capture":null:ie;ke=[];for(var te=le,ae;te!==null;){var fe=te;if(ae=fe.stateNode,fe=fe.tag,fe!==5&&fe!==26&&fe!==27||ae===null||oe===null||(fe=ul(te,oe),fe!=null&&ke.push(Yl(te,fe,ae))),ut)break;te=te.return}0<ke.length&&(ie=new se(ie,$e,null,a,de),pe.push({event:ie,listeners:ke}))}}if((t&7)===0){e:{if(ie=e==="mouseover"||e==="pointerover",se=e==="mouseout"||e==="pointerout",ie&&a!==Vc&&($e=a.relatedTarget||a.fromElement)&&(qe($e)||$e[go]))break e;if((se||ie)&&(ie=de.window===de?de:(ie=de.ownerDocument)?ie.defaultView||ie.parentWindow:window,se?($e=a.relatedTarget||a.toElement,se=le,$e=$e?qe($e):null,$e!==null&&(ut=d($e),ke=$e.tag,$e!==ut||ke!==5&&ke!==27&&ke!==6)&&($e=null)):(se=null,$e=le),se!==$e)){if(ke=Ad,fe="onMouseLeave",oe="onMouseEnter",te="mouse",(e==="pointerout"||e==="pointerover")&&(ke=Dd,fe="onPointerLeave",oe="onPointerEnter",te="pointer"),ut=se==null?ie:St(se),ae=$e==null?ie:St($e),ie=new ke(fe,te+"leave",se,a,de),ie.target=ut,ie.relatedTarget=ae,fe=null,qe(de)===le&&(ke=new ke(oe,te+"enter",$e,a,de),ke.target=ae,ke.relatedTarget=ut,fe=ke),ut=fe,se&&$e)t:{for(ke=se,oe=$e,te=0,ae=ke;ae;ae=Za(ae))te++;for(ae=0,fe=oe;fe;fe=Za(fe))ae++;for(;0<te-ae;)ke=Za(ke),te--;for(;0<ae-te;)oe=Za(oe),ae--;for(;te--;){if(ke===oe||oe!==null&&ke===oe.alternate)break t;ke=Za(ke),oe=Za(oe)}ke=null}else ke=null;se!==null&&_p(pe,ie,se,ke,!1),$e!==null&&ut!==null&&_p(pe,ut,$e,ke,!0)}}e:{if(ie=le?St(le):window,se=ie.nodeName&&ie.nodeName.toLowerCase(),se==="select"||se==="input"&&ie.type==="file")var be=Od;else if(Ud(ie))if(Ld)be=Hg;else{be=Ig;var Be=Mg}else se=ie.nodeName,!se||se.toLowerCase()!=="input"||ie.type!=="checkbox"&&ie.type!=="radio"?le&&zc(le.elementType)&&(be=Od):be=Pg;if(be&&(be=be(e,le))){$d(pe,be,a,de);break e}Be&&Be(e,ie,le),e==="focusout"&&le&&ie.type==="number"&&le.memoizedProps.value!=null&&Bc(ie,"number",ie.value)}switch(Be=le?St(le):window,e){case"focusin":(Ud(Be)||Be.contentEditable==="true")&&(Aa=Be,ai=le,_l=null);break;case"focusout":_l=ai=Aa=null;break;case"mousedown":li=!0;break;case"contextmenu":case"mouseup":case"dragend":li=!1,Gd(pe,a,de);break;case"selectionchange":if(zg)break;case"keydown":case"keyup":Gd(pe,a,de)}var je;if(ei)e:{switch(e){case"compositionstart":var Ne="onCompositionStart";break e;case"compositionend":Ne="onCompositionEnd";break e;case"compositionupdate":Ne="onCompositionUpdate";break e}Ne=void 0}else ja?Fd(e,a)&&(Ne="onCompositionEnd"):e==="keydown"&&a.keyCode===229&&(Ne="onCompositionStart");Ne&&(Td&&a.locale!=="ko"&&(ja||Ne!=="onCompositionStart"?Ne==="onCompositionEnd"&&ja&&(je=Ed()):(vo=de,Qc="value"in vo?vo.value:vo.textContent,ja=!0)),Be=uc(le,Ne),0<Be.length&&(Ne=new Rd(Ne,e,null,a,de),pe.push({event:Ne,listeners:Be}),je?Ne.data=je:(je=qd(a),je!==null&&(Ne.data=je)))),(je=qg?Ug(e,a):$g(e,a))&&(Ne=uc(le,"onBeforeInput"),0<Ne.length&&(Be=new Rd("onBeforeInput","beforeinput",null,a,de),pe.push({event:Be,listeners:Ne}),Be.data=je)),jy(pe,e,le,a,de)}yp(pe,t)})}function Yl(e,t,a){return{instance:e,listener:t,currentTarget:a}}function uc(e,t){for(var a=t+"Capture",c=[];e!==null;){var u=e,g=u.stateNode;if(u=u.tag,u!==5&&u!==26&&u!==27||g===null||(u=ul(e,a),u!=null&&c.unshift(Yl(e,u,g)),u=ul(e,t),u!=null&&c.push(Yl(e,u,g))),e.tag===3)return c;e=e.return}return[]}function Za(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5&&e.tag!==27);return e||null}function _p(e,t,a,c,u){for(var g=t._reactName,R=[];a!==null&&a!==c;){var O=a,K=O.alternate,le=O.stateNode;if(O=O.tag,K!==null&&K===c)break;O!==5&&O!==26&&O!==27||le===null||(K=le,u?(le=ul(a,g),le!=null&&R.unshift(Yl(a,le,K))):u||(le=ul(a,g),le!=null&&R.push(Yl(a,le,K)))),a=a.return}R.length!==0&&e.push({event:t,listeners:R})}var Ty=/\r\n?/g,ky=/\u0000|\uFFFD/g;function xp(e){return(typeof e=="string"?e:""+e).replace(Ty,`
`).replace(ky,"")}function wp(e,t){return t=xp(t),xp(e)===t}function fc(){}function dt(e,t,a,c,u,g){switch(a){case"children":typeof c=="string"?t==="body"||t==="textarea"&&c===""||ba(e,c):(typeof c=="number"||typeof c=="bigint")&&t!=="body"&&ba(e,""+c);break;case"className":wa(e,"class",c);break;case"tabIndex":wa(e,"tabindex",c);break;case"dir":case"role":case"viewBox":case"width":case"height":wa(e,a,c);break;case"style":Cd(e,c,g);break;case"data":if(t!=="object"){wa(e,"data",c);break}case"src":case"href":if(c===""&&(t!=="a"||a!=="href")){e.removeAttribute(a);break}if(c==null||typeof c=="function"||typeof c=="symbol"||typeof c=="boolean"){e.removeAttribute(a);break}c=xr(""+c),e.setAttribute(a,c);break;case"action":case"formAction":if(typeof c=="function"){e.setAttribute(a,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof g=="function"&&(a==="formAction"?(t!=="input"&&dt(e,t,"name",u.name,u,null),dt(e,t,"formEncType",u.formEncType,u,null),dt(e,t,"formMethod",u.formMethod,u,null),dt(e,t,"formTarget",u.formTarget,u,null)):(dt(e,t,"encType",u.encType,u,null),dt(e,t,"method",u.method,u,null),dt(e,t,"target",u.target,u,null)));if(c==null||typeof c=="symbol"||typeof c=="boolean"){e.removeAttribute(a);break}c=xr(""+c),e.setAttribute(a,c);break;case"onClick":c!=null&&(e.onclick=fc);break;case"onScroll":c!=null&&Ve("scroll",e);break;case"onScrollEnd":c!=null&&Ve("scrollend",e);break;case"dangerouslySetInnerHTML":if(c!=null){if(typeof c!="object"||!("__html"in c))throw Error(s(61));if(a=c.__html,a!=null){if(u.children!=null)throw Error(s(60));e.innerHTML=a}}break;case"multiple":e.multiple=c&&typeof c!="function"&&typeof c!="symbol";break;case"muted":e.muted=c&&typeof c!="function"&&typeof c!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(c==null||typeof c=="function"||typeof c=="boolean"||typeof c=="symbol"){e.removeAttribute("xlink:href");break}a=xr(""+c),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",a);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":c!=null&&typeof c!="function"&&typeof c!="symbol"?e.setAttribute(a,""+c):e.removeAttribute(a);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":c&&typeof c!="function"&&typeof c!="symbol"?e.setAttribute(a,""):e.removeAttribute(a);break;case"capture":case"download":c===!0?e.setAttribute(a,""):c!==!1&&c!=null&&typeof c!="function"&&typeof c!="symbol"?e.setAttribute(a,c):e.removeAttribute(a);break;case"cols":case"rows":case"size":case"span":c!=null&&typeof c!="function"&&typeof c!="symbol"&&!isNaN(c)&&1<=c?e.setAttribute(a,c):e.removeAttribute(a);break;case"rowSpan":case"start":c==null||typeof c=="function"||typeof c=="symbol"||isNaN(c)?e.removeAttribute(a):e.setAttribute(a,c);break;case"popover":Ve("beforetoggle",e),Ve("toggle",e),xa(e,"popover",c);break;case"xlinkActuate":qn(e,"http://www.w3.org/1999/xlink","xlink:actuate",c);break;case"xlinkArcrole":qn(e,"http://www.w3.org/1999/xlink","xlink:arcrole",c);break;case"xlinkRole":qn(e,"http://www.w3.org/1999/xlink","xlink:role",c);break;case"xlinkShow":qn(e,"http://www.w3.org/1999/xlink","xlink:show",c);break;case"xlinkTitle":qn(e,"http://www.w3.org/1999/xlink","xlink:title",c);break;case"xlinkType":qn(e,"http://www.w3.org/1999/xlink","xlink:type",c);break;case"xmlBase":qn(e,"http://www.w3.org/XML/1998/namespace","xml:base",c);break;case"xmlLang":qn(e,"http://www.w3.org/XML/1998/namespace","xml:lang",c);break;case"xmlSpace":qn(e,"http://www.w3.org/XML/1998/namespace","xml:space",c);break;case"is":xa(e,"is",c);break;case"innerText":case"textContent":break;default:(!(2<a.length)||a[0]!=="o"&&a[0]!=="O"||a[1]!=="n"&&a[1]!=="N")&&(a=cg.get(a)||a,xa(e,a,c))}}function Rs(e,t,a,c,u,g){switch(a){case"style":Cd(e,c,g);break;case"dangerouslySetInnerHTML":if(c!=null){if(typeof c!="object"||!("__html"in c))throw Error(s(61));if(a=c.__html,a!=null){if(u.children!=null)throw Error(s(60));e.innerHTML=a}}break;case"children":typeof c=="string"?ba(e,c):(typeof c=="number"||typeof c=="bigint")&&ba(e,""+c);break;case"onScroll":c!=null&&Ve("scroll",e);break;case"onScrollEnd":c!=null&&Ve("scrollend",e);break;case"onClick":c!=null&&(e.onclick=fc);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!zo.hasOwnProperty(a))e:{if(a[0]==="o"&&a[1]==="n"&&(u=a.endsWith("Capture"),t=a.slice(2,u?a.length-7:void 0),g=e[Xt]||null,g=g!=null?g[a]:null,typeof g=="function"&&e.removeEventListener(t,g,u),typeof c=="function")){typeof g!="function"&&g!==null&&(a in e?e[a]=null:e.hasAttribute(a)&&e.removeAttribute(a)),e.addEventListener(t,c,u);break e}a in e?e[a]=c:c===!0?e.setAttribute(a,""):xa(e,a,c)}}}function Yt(e,t,a){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Ve("error",e),Ve("load",e);var c=!1,u=!1,g;for(g in a)if(a.hasOwnProperty(g)){var R=a[g];if(R!=null)switch(g){case"src":c=!0;break;case"srcSet":u=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(s(137,t));default:dt(e,t,g,R,a,null)}}u&&dt(e,t,"srcSet",a.srcSet,a,null),c&&dt(e,t,"src",a.src,a,null);return;case"input":Ve("invalid",e);var O=g=R=u=null,K=null,le=null;for(c in a)if(a.hasOwnProperty(c)){var de=a[c];if(de!=null)switch(c){case"name":u=de;break;case"type":R=de;break;case"checked":K=de;break;case"defaultChecked":le=de;break;case"value":g=de;break;case"defaultValue":O=de;break;case"children":case"dangerouslySetInnerHTML":if(de!=null)throw Error(s(137,t));break;default:dt(e,t,c,de,a,null)}}vd(e,g,O,K,le,R,u,!1),vr(e);return;case"select":Ve("invalid",e),c=R=g=null;for(u in a)if(a.hasOwnProperty(u)&&(O=a[u],O!=null))switch(u){case"value":g=O;break;case"defaultValue":R=O;break;case"multiple":c=O;default:dt(e,t,u,O,a,null)}t=g,a=R,e.multiple=!!c,t!=null?Ca(e,!!c,t,!1):a!=null&&Ca(e,!!c,a,!0);return;case"textarea":Ve("invalid",e),g=u=c=null;for(R in a)if(a.hasOwnProperty(R)&&(O=a[R],O!=null))switch(R){case"value":c=O;break;case"defaultValue":u=O;break;case"children":g=O;break;case"dangerouslySetInnerHTML":if(O!=null)throw Error(s(91));break;default:dt(e,t,R,O,a,null)}xd(e,c,u,g),vr(e);return;case"option":for(K in a)if(a.hasOwnProperty(K)&&(c=a[K],c!=null))switch(K){case"selected":e.selected=c&&typeof c!="function"&&typeof c!="symbol";break;default:dt(e,t,K,c,a,null)}return;case"dialog":Ve("beforetoggle",e),Ve("toggle",e),Ve("cancel",e),Ve("close",e);break;case"iframe":case"object":Ve("load",e);break;case"video":case"audio":for(c=0;c<Gl.length;c++)Ve(Gl[c],e);break;case"image":Ve("error",e),Ve("load",e);break;case"details":Ve("toggle",e);break;case"embed":case"source":case"link":Ve("error",e),Ve("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(le in a)if(a.hasOwnProperty(le)&&(c=a[le],c!=null))switch(le){case"children":case"dangerouslySetInnerHTML":throw Error(s(137,t));default:dt(e,t,le,c,a,null)}return;default:if(zc(t)){for(de in a)a.hasOwnProperty(de)&&(c=a[de],c!==void 0&&Rs(e,t,de,c,a,void 0));return}}for(O in a)a.hasOwnProperty(O)&&(c=a[O],c!=null&&dt(e,t,O,c,a,null))}function Ny(e,t,a,c){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var u=null,g=null,R=null,O=null,K=null,le=null,de=null;for(se in a){var pe=a[se];if(a.hasOwnProperty(se)&&pe!=null)switch(se){case"checked":break;case"value":break;case"defaultValue":K=pe;default:c.hasOwnProperty(se)||dt(e,t,se,null,c,pe)}}for(var ie in c){var se=c[ie];if(pe=a[ie],c.hasOwnProperty(ie)&&(se!=null||pe!=null))switch(ie){case"type":g=se;break;case"name":u=se;break;case"checked":le=se;break;case"defaultChecked":de=se;break;case"value":R=se;break;case"defaultValue":O=se;break;case"children":case"dangerouslySetInnerHTML":if(se!=null)throw Error(s(137,t));break;default:se!==pe&&dt(e,t,ie,se,c,pe)}}Hc(e,R,O,K,le,de,g,u);return;case"select":se=R=O=ie=null;for(g in a)if(K=a[g],a.hasOwnProperty(g)&&K!=null)switch(g){case"value":break;case"multiple":se=K;default:c.hasOwnProperty(g)||dt(e,t,g,null,c,K)}for(u in c)if(g=c[u],K=a[u],c.hasOwnProperty(u)&&(g!=null||K!=null))switch(u){case"value":ie=g;break;case"defaultValue":O=g;break;case"multiple":R=g;default:g!==K&&dt(e,t,u,g,c,K)}t=O,a=R,c=se,ie!=null?Ca(e,!!a,ie,!1):!!c!=!!a&&(t!=null?Ca(e,!!a,t,!0):Ca(e,!!a,a?[]:"",!1));return;case"textarea":se=ie=null;for(O in a)if(u=a[O],a.hasOwnProperty(O)&&u!=null&&!c.hasOwnProperty(O))switch(O){case"value":break;case"children":break;default:dt(e,t,O,null,c,u)}for(R in c)if(u=c[R],g=a[R],c.hasOwnProperty(R)&&(u!=null||g!=null))switch(R){case"value":ie=u;break;case"defaultValue":se=u;break;case"children":break;case"dangerouslySetInnerHTML":if(u!=null)throw Error(s(91));break;default:u!==g&&dt(e,t,R,u,c,g)}_d(e,ie,se);return;case"option":for(var $e in a)if(ie=a[$e],a.hasOwnProperty($e)&&ie!=null&&!c.hasOwnProperty($e))switch($e){case"selected":e.selected=!1;break;default:dt(e,t,$e,null,c,ie)}for(K in c)if(ie=c[K],se=a[K],c.hasOwnProperty(K)&&ie!==se&&(ie!=null||se!=null))switch(K){case"selected":e.selected=ie&&typeof ie!="function"&&typeof ie!="symbol";break;default:dt(e,t,K,ie,c,se)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var ke in a)ie=a[ke],a.hasOwnProperty(ke)&&ie!=null&&!c.hasOwnProperty(ke)&&dt(e,t,ke,null,c,ie);for(le in c)if(ie=c[le],se=a[le],c.hasOwnProperty(le)&&ie!==se&&(ie!=null||se!=null))switch(le){case"children":case"dangerouslySetInnerHTML":if(ie!=null)throw Error(s(137,t));break;default:dt(e,t,le,ie,c,se)}return;default:if(zc(t)){for(var ut in a)ie=a[ut],a.hasOwnProperty(ut)&&ie!==void 0&&!c.hasOwnProperty(ut)&&Rs(e,t,ut,void 0,c,ie);for(de in c)ie=c[de],se=a[de],!c.hasOwnProperty(de)||ie===se||ie===void 0&&se===void 0||Rs(e,t,de,ie,c,se);return}}for(var oe in a)ie=a[oe],a.hasOwnProperty(oe)&&ie!=null&&!c.hasOwnProperty(oe)&&dt(e,t,oe,null,c,ie);for(pe in c)ie=c[pe],se=a[pe],!c.hasOwnProperty(pe)||ie===se||ie==null&&se==null||dt(e,t,pe,ie,c,se)}var Ds=null,Ts=null;function pc(e){return e.nodeType===9?e:e.ownerDocument}function Cp(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function bp(e,t){if(e===0)switch(t){case"svg":return 1;case"math":return 2;default:return 0}return e===1&&t==="foreignObject"?0:e}function ks(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.children=="bigint"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var Ns=null;function Fy(){var e=window.event;return e&&e.type==="popstate"?e===Ns?!1:(Ns=e,!0):(Ns=null,!1)}var Sp=typeof setTimeout=="function"?setTimeout:void 0,qy=typeof clearTimeout=="function"?clearTimeout:void 0,Ep=typeof Promise=="function"?Promise:void 0,Uy=typeof queueMicrotask=="function"?queueMicrotask:typeof Ep<"u"?function(e){return Ep.resolve(null).then(e).catch($y)}:Sp;function $y(e){setTimeout(function(){throw e})}function qo(e){return e==="head"}function jp(e,t){var a=t,c=0,u=0;do{var g=a.nextSibling;if(e.removeChild(a),g&&g.nodeType===8)if(a=g.data,a==="/$"){if(0<c&&8>c){a=c;var R=e.ownerDocument;if(a&1&&Wl(R.documentElement),a&2&&Wl(R.body),a&4)for(a=R.head,Wl(a),R=a.firstChild;R;){var O=R.nextSibling,K=R.nodeName;R[ge]||K==="SCRIPT"||K==="STYLE"||K==="LINK"&&R.rel.toLowerCase()==="stylesheet"||a.removeChild(R),R=O}}if(u===0){e.removeChild(g),nr(t);return}u--}else a==="$"||a==="$?"||a==="$!"?u++:c=a.charCodeAt(0)-48;else c=0;a=g}while(a);nr(t)}function Fs(e){var t=e.firstChild;for(t&&t.nodeType===10&&(t=t.nextSibling);t;){var a=t;switch(t=t.nextSibling,a.nodeName){case"HTML":case"HEAD":case"BODY":Fs(a),Ce(a);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(a.rel.toLowerCase()==="stylesheet")continue}e.removeChild(a)}}function Oy(e,t,a,c){for(;e.nodeType===1;){var u=a;if(e.nodeName.toLowerCase()!==t.toLowerCase()){if(!c&&(e.nodeName!=="INPUT"||e.type!=="hidden"))break}else if(c){if(!e[ge])switch(t){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if(g=e.getAttribute("rel"),g==="stylesheet"&&e.hasAttribute("data-precedence"))break;if(g!==u.rel||e.getAttribute("href")!==(u.href==null||u.href===""?null:u.href)||e.getAttribute("crossorigin")!==(u.crossOrigin==null?null:u.crossOrigin)||e.getAttribute("title")!==(u.title==null?null:u.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(g=e.getAttribute("src"),(g!==(u.src==null?null:u.src)||e.getAttribute("type")!==(u.type==null?null:u.type)||e.getAttribute("crossorigin")!==(u.crossOrigin==null?null:u.crossOrigin))&&g&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else if(t==="input"&&e.type==="hidden"){var g=u.name==null?null:""+u.name;if(u.type==="hidden"&&e.getAttribute("name")===g)return e}else return e;if(e=On(e.nextSibling),e===null)break}return null}function Ly(e,t,a){if(t==="")return null;for(;e.nodeType!==3;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!a||(e=On(e.nextSibling),e===null))return null;return e}function qs(e){return e.data==="$!"||e.data==="$?"&&e.ownerDocument.readyState==="complete"}function My(e,t){var a=e.ownerDocument;if(e.data!=="$?"||a.readyState==="complete")t();else{var c=function(){t(),a.removeEventListener("DOMContentLoaded",c)};a.addEventListener("DOMContentLoaded",c),e._reactRetry=c}}function On(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?"||t==="F!"||t==="F")break;if(t==="/$")return null}}return e}var Us=null;function Ap(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var a=e.data;if(a==="$"||a==="$!"||a==="$?"){if(t===0)return e;t--}else a==="/$"&&t++}e=e.previousSibling}return null}function Rp(e,t,a){switch(t=pc(a),e){case"html":if(e=t.documentElement,!e)throw Error(s(452));return e;case"head":if(e=t.head,!e)throw Error(s(453));return e;case"body":if(e=t.body,!e)throw Error(s(454));return e;default:throw Error(s(451))}}function Wl(e){for(var t=e.attributes;t.length;)e.removeAttributeNode(t[0]);Ce(e)}var Rn=new Map,Dp=new Set;function hc(e){return typeof e.getRootNode=="function"?e.getRootNode():e.nodeType===9?e:e.ownerDocument}var co=W.d;W.d={f:Iy,r:Py,D:Hy,C:By,L:zy,m:Vy,X:Yy,S:Gy,M:Wy};function Iy(){var e=co.f(),t=lc();return e||t}function Py(e){var t=it(e);t!==null&&t.tag===5&&t.type==="form"?Wu(t):co.r(e)}var Ka=typeof document>"u"?null:document;function Tp(e,t,a){var c=Ka;if(c&&typeof t=="string"&&t){var u=wn(t);u='link[rel="'+e+'"][href="'+u+'"]',typeof a=="string"&&(u+='[crossorigin="'+a+'"]'),Dp.has(u)||(Dp.add(u),e={rel:e,crossOrigin:a,href:t},c.querySelector(u)===null&&(t=c.createElement("link"),Yt(t,"link",e),lt(t),c.head.appendChild(t)))}}function Hy(e){co.D(e),Tp("dns-prefetch",e,null)}function By(e,t){co.C(e,t),Tp("preconnect",e,t)}function zy(e,t,a){co.L(e,t,a);var c=Ka;if(c&&e&&t){var u='link[rel="preload"][as="'+wn(t)+'"]';t==="image"&&a&&a.imageSrcSet?(u+='[imagesrcset="'+wn(a.imageSrcSet)+'"]',typeof a.imageSizes=="string"&&(u+='[imagesizes="'+wn(a.imageSizes)+'"]')):u+='[href="'+wn(e)+'"]';var g=u;switch(t){case"style":g=Ja(e);break;case"script":g=el(e)}Rn.has(g)||(e=y({rel:"preload",href:t==="image"&&a&&a.imageSrcSet?void 0:e,as:t},a),Rn.set(g,e),c.querySelector(u)!==null||t==="style"&&c.querySelector(Ql(g))||t==="script"&&c.querySelector(Xl(g))||(t=c.createElement("link"),Yt(t,"link",e),lt(t),c.head.appendChild(t)))}}function Vy(e,t){co.m(e,t);var a=Ka;if(a&&e){var c=t&&typeof t.as=="string"?t.as:"script",u='link[rel="modulepreload"][as="'+wn(c)+'"][href="'+wn(e)+'"]',g=u;switch(c){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":g=el(e)}if(!Rn.has(g)&&(e=y({rel:"modulepreload",href:e},t),Rn.set(g,e),a.querySelector(u)===null)){switch(c){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(a.querySelector(Xl(g)))return}c=a.createElement("link"),Yt(c,"link",e),lt(c),a.head.appendChild(c)}}}function Gy(e,t,a){co.S(e,t,a);var c=Ka;if(c&&e){var u=Zt(c).hoistableStyles,g=Ja(e);t=t||"default";var R=u.get(g);if(!R){var O={loading:0,preload:null};if(R=c.querySelector(Ql(g)))O.loading=5;else{e=y({rel:"stylesheet",href:e,"data-precedence":t},a),(a=Rn.get(g))&&$s(e,a);var K=R=c.createElement("link");lt(K),Yt(K,"link",e),K._p=new Promise(function(le,de){K.onload=le,K.onerror=de}),K.addEventListener("load",function(){O.loading|=1}),K.addEventListener("error",function(){O.loading|=2}),O.loading|=4,mc(R,t,c)}R={type:"stylesheet",instance:R,count:1,state:O},u.set(g,R)}}}function Yy(e,t){co.X(e,t);var a=Ka;if(a&&e){var c=Zt(a).hoistableScripts,u=el(e),g=c.get(u);g||(g=a.querySelector(Xl(u)),g||(e=y({src:e,async:!0},t),(t=Rn.get(u))&&Os(e,t),g=a.createElement("script"),lt(g),Yt(g,"link",e),a.head.appendChild(g)),g={type:"script",instance:g,count:1,state:null},c.set(u,g))}}function Wy(e,t){co.M(e,t);var a=Ka;if(a&&e){var c=Zt(a).hoistableScripts,u=el(e),g=c.get(u);g||(g=a.querySelector(Xl(u)),g||(e=y({src:e,async:!0,type:"module"},t),(t=Rn.get(u))&&Os(e,t),g=a.createElement("script"),lt(g),Yt(g,"link",e),a.head.appendChild(g)),g={type:"script",instance:g,count:1,state:null},c.set(u,g))}}function kp(e,t,a,c){var u=(u=J.current)?hc(u):null;if(!u)throw Error(s(446));switch(e){case"meta":case"title":return null;case"style":return typeof a.precedence=="string"&&typeof a.href=="string"?(t=Ja(a.href),a=Zt(u).hoistableStyles,c=a.get(t),c||(c={type:"style",instance:null,count:0,state:null},a.set(t,c)),c):{type:"void",instance:null,count:0,state:null};case"link":if(a.rel==="stylesheet"&&typeof a.href=="string"&&typeof a.precedence=="string"){e=Ja(a.href);var g=Zt(u).hoistableStyles,R=g.get(e);if(R||(u=u.ownerDocument||u,R={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},g.set(e,R),(g=u.querySelector(Ql(e)))&&!g._p&&(R.instance=g,R.state.loading=5),Rn.has(e)||(a={rel:"preload",as:"style",href:a.href,crossOrigin:a.crossOrigin,integrity:a.integrity,media:a.media,hrefLang:a.hrefLang,referrerPolicy:a.referrerPolicy},Rn.set(e,a),g||Qy(u,e,a,R.state))),t&&c===null)throw Error(s(528,""));return R}if(t&&c!==null)throw Error(s(529,""));return null;case"script":return t=a.async,a=a.src,typeof a=="string"&&t&&typeof t!="function"&&typeof t!="symbol"?(t=el(a),a=Zt(u).hoistableScripts,c=a.get(t),c||(c={type:"script",instance:null,count:0,state:null},a.set(t,c)),c):{type:"void",instance:null,count:0,state:null};default:throw Error(s(444,e))}}function Ja(e){return'href="'+wn(e)+'"'}function Ql(e){return'link[rel="stylesheet"]['+e+"]"}function Np(e){return y({},e,{"data-precedence":e.precedence,precedence:null})}function Qy(e,t,a,c){e.querySelector('link[rel="preload"][as="style"]['+t+"]")?c.loading=1:(t=e.createElement("link"),c.preload=t,t.addEventListener("load",function(){return c.loading|=1}),t.addEventListener("error",function(){return c.loading|=2}),Yt(t,"link",a),lt(t),e.head.appendChild(t))}function el(e){return'[src="'+wn(e)+'"]'}function Xl(e){return"script[async]"+e}function Fp(e,t,a){if(t.count++,t.instance===null)switch(t.type){case"style":var c=e.querySelector('style[data-href~="'+wn(a.href)+'"]');if(c)return t.instance=c,lt(c),c;var u=y({},a,{"data-href":a.href,"data-precedence":a.precedence,href:null,precedence:null});return c=(e.ownerDocument||e).createElement("style"),lt(c),Yt(c,"style",u),mc(c,a.precedence,e),t.instance=c;case"stylesheet":u=Ja(a.href);var g=e.querySelector(Ql(u));if(g)return t.state.loading|=4,t.instance=g,lt(g),g;c=Np(a),(u=Rn.get(u))&&$s(c,u),g=(e.ownerDocument||e).createElement("link"),lt(g);var R=g;return R._p=new Promise(function(O,K){R.onload=O,R.onerror=K}),Yt(g,"link",c),t.state.loading|=4,mc(g,a.precedence,e),t.instance=g;case"script":return g=el(a.src),(u=e.querySelector(Xl(g)))?(t.instance=u,lt(u),u):(c=a,(u=Rn.get(g))&&(c=y({},a),Os(c,u)),e=e.ownerDocument||e,u=e.createElement("script"),lt(u),Yt(u,"link",c),e.head.appendChild(u),t.instance=u);case"void":return null;default:throw Error(s(443,t.type))}else t.type==="stylesheet"&&(t.state.loading&4)===0&&(c=t.instance,t.state.loading|=4,mc(c,a.precedence,e));return t.instance}function mc(e,t,a){for(var c=a.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),u=c.length?c[c.length-1]:null,g=u,R=0;R<c.length;R++){var O=c[R];if(O.dataset.precedence===t)g=O;else if(g!==u)break}g?g.parentNode.insertBefore(e,g.nextSibling):(t=a.nodeType===9?a.head:a,t.insertBefore(e,t.firstChild))}function $s(e,t){e.crossOrigin==null&&(e.crossOrigin=t.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=t.referrerPolicy),e.title==null&&(e.title=t.title)}function Os(e,t){e.crossOrigin==null&&(e.crossOrigin=t.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=t.referrerPolicy),e.integrity==null&&(e.integrity=t.integrity)}var gc=null;function qp(e,t,a){if(gc===null){var c=new Map,u=gc=new Map;u.set(a,c)}else u=gc,c=u.get(a),c||(c=new Map,u.set(a,c));if(c.has(e))return c;for(c.set(e,null),a=a.getElementsByTagName(e),u=0;u<a.length;u++){var g=a[u];if(!(g[ge]||g[Ot]||e==="link"&&g.getAttribute("rel")==="stylesheet")&&g.namespaceURI!=="http://www.w3.org/2000/svg"){var R=g.getAttribute(t)||"";R=e+R;var O=c.get(R);O?O.push(g):c.set(R,[g])}}return c}function Up(e,t,a){e=e.ownerDocument||e,e.head.insertBefore(a,t==="title"?e.querySelector("head > title"):null)}function Xy(e,t,a){if(a===1||t.itemProp!=null)return!1;switch(e){case"meta":case"title":return!0;case"style":if(typeof t.precedence!="string"||typeof t.href!="string"||t.href==="")break;return!0;case"link":if(typeof t.rel!="string"||typeof t.href!="string"||t.href===""||t.onLoad||t.onError)break;switch(t.rel){case"stylesheet":return e=t.disabled,typeof t.precedence=="string"&&e==null;default:return!0}case"script":if(t.async&&typeof t.async!="function"&&typeof t.async!="symbol"&&!t.onLoad&&!t.onError&&t.src&&typeof t.src=="string")return!0}return!1}function $p(e){return!(e.type==="stylesheet"&&(e.state.loading&3)===0)}var Zl=null;function Zy(){}function Ky(e,t,a){if(Zl===null)throw Error(s(475));var c=Zl;if(t.type==="stylesheet"&&(typeof a.media!="string"||matchMedia(a.media).matches!==!1)&&(t.state.loading&4)===0){if(t.instance===null){var u=Ja(a.href),g=e.querySelector(Ql(u));if(g){e=g._p,e!==null&&typeof e=="object"&&typeof e.then=="function"&&(c.count++,c=yc.bind(c),e.then(c,c)),t.state.loading|=4,t.instance=g,lt(g);return}g=e.ownerDocument||e,a=Np(a),(u=Rn.get(u))&&$s(a,u),g=g.createElement("link"),lt(g);var R=g;R._p=new Promise(function(O,K){R.onload=O,R.onerror=K}),Yt(g,"link",a),t.instance=g}c.stylesheets===null&&(c.stylesheets=new Map),c.stylesheets.set(t,e),(e=t.state.preload)&&(t.state.loading&3)===0&&(c.count++,t=yc.bind(c),e.addEventListener("load",t),e.addEventListener("error",t))}}function Jy(){if(Zl===null)throw Error(s(475));var e=Zl;return e.stylesheets&&e.count===0&&Ls(e,e.stylesheets),0<e.count?function(t){var a=setTimeout(function(){if(e.stylesheets&&Ls(e,e.stylesheets),e.unsuspend){var c=e.unsuspend;e.unsuspend=null,c()}},6e4);return e.unsuspend=t,function(){e.unsuspend=null,clearTimeout(a)}}:null}function yc(){if(this.count--,this.count===0){if(this.stylesheets)Ls(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}}var vc=null;function Ls(e,t){e.stylesheets=null,e.unsuspend!==null&&(e.count++,vc=new Map,t.forEach(ev,e),vc=null,yc.call(e))}function ev(e,t){if(!(t.state.loading&4)){var a=vc.get(e);if(a)var c=a.get(null);else{a=new Map,vc.set(e,a);for(var u=e.querySelectorAll("link[data-precedence],style[data-precedence]"),g=0;g<u.length;g++){var R=u[g];(R.nodeName==="LINK"||R.getAttribute("media")!=="not all")&&(a.set(R.dataset.precedence,R),c=R)}c&&a.set(null,c)}u=t.instance,R=u.getAttribute("data-precedence"),g=a.get(R)||c,g===c&&a.set(null,u),a.set(R,u),this.count++,c=yc.bind(this),u.addEventListener("load",c),u.addEventListener("error",c),g?g.parentNode.insertBefore(u,g.nextSibling):(e=e.nodeType===9?e.head:e,e.insertBefore(u,e.firstChild)),t.state.loading|=4}}var Kl={$$typeof:N,Provider:null,Consumer:null,_currentValue:P,_currentValue2:P,_threadCount:0};function tv(e,t,a,c,u,g,R,O){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=sn(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=sn(0),this.hiddenUpdates=sn(null),this.identifierPrefix=c,this.onUncaughtError=u,this.onCaughtError=g,this.onRecoverableError=R,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=O,this.incompleteTransitions=new Map}function Op(e,t,a,c,u,g,R,O,K,le,de,pe){return e=new tv(e,t,a,R,O,K,le,pe),t=1,g===!0&&(t|=24),g=fn(3,null,null,t),e.current=g,g.stateNode=e,t=_i(),t.refCount++,e.pooledCache=t,t.refCount++,g.memoizedState={element:c,isDehydrated:a,cache:t},bi(g),e}function Lp(e){return e?(e=ka,e):ka}function Mp(e,t,a,c,u,g){u=Lp(u),c.context===null?c.context=u:c.pendingContext=u,c=wo(t),c.payload={element:a},g=g===void 0?null:g,g!==null&&(c.callback=g),a=Co(e,c,t),a!==null&&(yn(a,e,t),Rl(a,e,t))}function Ip(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var a=e.retryLane;e.retryLane=a!==0&&a<t?a:t}}function Ms(e,t){Ip(e,t),(e=e.alternate)&&Ip(e,t)}function Pp(e){if(e.tag===13){var t=Ta(e,67108864);t!==null&&yn(t,e,67108864),Ms(e,67108864)}}var _c=!0;function nv(e,t,a,c){var u=$.T;$.T=null;var g=W.p;try{W.p=2,Is(e,t,a,c)}finally{W.p=g,$.T=u}}function ov(e,t,a,c){var u=$.T;$.T=null;var g=W.p;try{W.p=8,Is(e,t,a,c)}finally{W.p=g,$.T=u}}function Is(e,t,a,c){if(_c){var u=Ps(c);if(u===null)As(e,t,c,xc,a),Bp(e,c);else if(lv(u,e,t,a,c))c.stopPropagation();else if(Bp(e,c),t&4&&-1<av.indexOf(e)){for(;u!==null;){var g=it(u);if(g!==null)switch(g.tag){case 3:if(g=g.stateNode,g.current.memoizedState.isDehydrated){var R=Fe(g.pendingLanes);if(R!==0){var O=g;for(O.pendingLanes|=2,O.entangledLanes|=2;R;){var K=1<<31-_t(R);O.entanglements[1]|=K,R&=~K}Gn(g),(rt&6)===0&&(oc=tt()+500,Vl(0))}}break;case 13:O=Ta(g,2),O!==null&&yn(O,g,2),lc(),Ms(g,2)}if(g=Ps(c),g===null&&As(e,t,c,xc,a),g===u)break;u=g}u!==null&&c.stopPropagation()}else As(e,t,c,null,a)}}function Ps(e){return e=Gc(e),Hs(e)}var xc=null;function Hs(e){if(xc=null,e=qe(e),e!==null){var t=d(e);if(t===null)e=null;else{var a=t.tag;if(a===13){if(e=f(t),e!==null)return e;e=null}else if(a===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null)}}return xc=e,null}function Hp(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Pt()){case Qt:return 2;case Te:return 8;case He:case Ze:return 32;case Je:return 268435456;default:return 32}default:return 32}}var Bs=!1,Uo=null,$o=null,Oo=null,Jl=new Map,er=new Map,Lo=[],av="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Bp(e,t){switch(e){case"focusin":case"focusout":Uo=null;break;case"dragenter":case"dragleave":$o=null;break;case"mouseover":case"mouseout":Oo=null;break;case"pointerover":case"pointerout":Jl.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":er.delete(t.pointerId)}}function tr(e,t,a,c,u,g){return e===null||e.nativeEvent!==g?(e={blockedOn:t,domEventName:a,eventSystemFlags:c,nativeEvent:g,targetContainers:[u]},t!==null&&(t=it(t),t!==null&&Pp(t)),e):(e.eventSystemFlags|=c,t=e.targetContainers,u!==null&&t.indexOf(u)===-1&&t.push(u),e)}function lv(e,t,a,c,u){switch(t){case"focusin":return Uo=tr(Uo,e,t,a,c,u),!0;case"dragenter":return $o=tr($o,e,t,a,c,u),!0;case"mouseover":return Oo=tr(Oo,e,t,a,c,u),!0;case"pointerover":var g=u.pointerId;return Jl.set(g,tr(Jl.get(g)||null,e,t,a,c,u)),!0;case"gotpointercapture":return g=u.pointerId,er.set(g,tr(er.get(g)||null,e,t,a,c,u)),!0}return!1}function zp(e){var t=qe(e.target);if(t!==null){var a=d(t);if(a!==null){if(t=a.tag,t===13){if(t=f(a),t!==null){e.blockedOn=t,Mc(e.priority,function(){if(a.tag===13){var c=gn();c=bt(c);var u=Ta(a,c);u!==null&&yn(u,a,c),Ms(a,c)}});return}}else if(t===3&&a.stateNode.current.memoizedState.isDehydrated){e.blockedOn=a.tag===3?a.stateNode.containerInfo:null;return}}}e.blockedOn=null}function wc(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var a=Ps(e.nativeEvent);if(a===null){a=e.nativeEvent;var c=new a.constructor(a.type,a);Vc=c,a.target.dispatchEvent(c),Vc=null}else return t=it(a),t!==null&&Pp(t),e.blockedOn=a,!1;t.shift()}return!0}function Vp(e,t,a){wc(e)&&a.delete(t)}function rv(){Bs=!1,Uo!==null&&wc(Uo)&&(Uo=null),$o!==null&&wc($o)&&($o=null),Oo!==null&&wc(Oo)&&(Oo=null),Jl.forEach(Vp),er.forEach(Vp)}function Cc(e,t){e.blockedOn===t&&(e.blockedOn=null,Bs||(Bs=!0,o.unstable_scheduleCallback(o.unstable_NormalPriority,rv)))}var bc=null;function Gp(e){bc!==e&&(bc=e,o.unstable_scheduleCallback(o.unstable_NormalPriority,function(){bc===e&&(bc=null);for(var t=0;t<e.length;t+=3){var a=e[t],c=e[t+1],u=e[t+2];if(typeof c!="function"){if(Hs(c||a)===null)continue;break}var g=it(a);g!==null&&(e.splice(t,3),t-=3,Hi(g,{pending:!0,data:u,method:a.method,action:c},c,u))}}))}function nr(e){function t(K){return Cc(K,e)}Uo!==null&&Cc(Uo,e),$o!==null&&Cc($o,e),Oo!==null&&Cc(Oo,e),Jl.forEach(t),er.forEach(t);for(var a=0;a<Lo.length;a++){var c=Lo[a];c.blockedOn===e&&(c.blockedOn=null)}for(;0<Lo.length&&(a=Lo[0],a.blockedOn===null);)zp(a),a.blockedOn===null&&Lo.shift();if(a=(e.ownerDocument||e).$$reactFormReplay,a!=null)for(c=0;c<a.length;c+=3){var u=a[c],g=a[c+1],R=u[Xt]||null;if(typeof g=="function")R||Gp(a);else if(R){var O=null;if(g&&g.hasAttribute("formAction")){if(u=g,R=g[Xt]||null)O=R.formAction;else if(Hs(u)!==null)continue}else O=R.action;typeof O=="function"?a[c+1]=O:(a.splice(c,3),c-=3),Gp(a)}}}function zs(e){this._internalRoot=e}Sc.prototype.render=zs.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(s(409));var a=t.current,c=gn();Mp(a,c,e,t,null,null)},Sc.prototype.unmount=zs.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;Mp(e.current,2,null,e,null,null),lc(),t[go]=null}};function Sc(e){this._internalRoot=e}Sc.prototype.unstable_scheduleHydration=function(e){if(e){var t=hr();e={blockedOn:null,target:e,priority:t};for(var a=0;a<Lo.length&&t!==0&&t<Lo[a].priority;a++);Lo.splice(a,0,e),a===0&&zp(e)}};var Yp=n.version;if(Yp!=="19.1.1")throw Error(s(527,Yp,"19.1.1"));W.findDOMNode=function(e){var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(s(188)):(e=Object.keys(e).join(","),Error(s(268,e)));return e=h(t),e=e!==null?p(e):null,e=e===null?null:e.stateNode,e};var cv={bundleType:0,version:"19.1.1",rendererPackageName:"react-dom",currentDispatcherRef:$,reconcilerVersion:"19.1.1"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Ec=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Ec.isDisabled&&Ec.supportsFiber)try{Ct=Ec.inject(cv),mt=Ec}catch{}}return ar.createRoot=function(e,t){if(!i(e))throw Error(s(299));var a=!1,c="",u=sf,g=df,R=uf,O=null;return t!=null&&(t.unstable_strictMode===!0&&(a=!0),t.identifierPrefix!==void 0&&(c=t.identifierPrefix),t.onUncaughtError!==void 0&&(u=t.onUncaughtError),t.onCaughtError!==void 0&&(g=t.onCaughtError),t.onRecoverableError!==void 0&&(R=t.onRecoverableError),t.unstable_transitionCallbacks!==void 0&&(O=t.unstable_transitionCallbacks)),t=Op(e,1,!1,null,null,a,c,u,g,R,O,null),e[go]=t.current,js(e),new zs(t)},ar.hydrateRoot=function(e,t,a){if(!i(e))throw Error(s(299));var c=!1,u="",g=sf,R=df,O=uf,K=null,le=null;return a!=null&&(a.unstable_strictMode===!0&&(c=!0),a.identifierPrefix!==void 0&&(u=a.identifierPrefix),a.onUncaughtError!==void 0&&(g=a.onUncaughtError),a.onCaughtError!==void 0&&(R=a.onCaughtError),a.onRecoverableError!==void 0&&(O=a.onRecoverableError),a.unstable_transitionCallbacks!==void 0&&(K=a.unstable_transitionCallbacks),a.formState!==void 0&&(le=a.formState)),t=Op(e,1,!0,t,a??null,c,u,g,R,O,K,le),t.context=Lp(null),a=t.current,c=gn(),c=bt(c),u=wo(c),u.callback=null,Co(a,u,c),a=c,t.current.lanes=a,Bt(t,a),Gn(t),e[go]=t.current,js(e),new Sc(t)},ar.version="19.1.1",ar}var oh;function yv(){if(oh)return Gs.exports;oh=1;function o(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(o)}catch(n){console.error(n)}}return o(),Gs.exports=gv(),Gs.exports}var vv=yv(),ce=sd();/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Rt=({card:o,onPointerDown:n,onPointerEnter:r,onPointerLeave:s,isFaceUp:i,faceDownValue:d=2,isSelected:f,isMultiSelected:m,isTargetable:h,isSourceOfEffect:p,style:y,additionalClassName:v,animationState:x})=>{const _=({content:j,className:I})=>l.jsx("div",{className:`card-rule-box ${I||""}`,dangerouslySetInnerHTML:{__html:j}}),U=(x==null?void 0:x.type)==="playCard"&&x.cardId===o.id?`is-entering-${x.owner}`:"",A=(x==null?void 0:x.type)==="deleteCard"&&x.cardId===o.id?`is-deleting-${x.owner}`:"",S=(x==null?void 0:x.type)==="drawCard"||(x==null?void 0:x.type)==="discardCard"?x.owner:void 0,N=S==="player"&&(x==null?void 0:x.type)==="drawCard"&&x.cardIds.includes(o.id),q=S==="player"&&(x==null?void 0:x.type)==="discardCard"&&x.cardIds.includes(o.id),D=["card-component"];o.protocol&&D.push(`card-protocol-${o.protocol.toLowerCase()}`),o.color&&D.push("has-custom-color"),o.pattern&&D.push(`card-pattern-${o.pattern}`),f&&D.push("selected"),m&&D.push("multi-selected"),q&&D.push("is-discarding"),h&&D.push("is-targetable"),p&&D.push("is-source-of-effect"),U&&D.push(U),A&&D.push(A),N&&D.push("is-drawing"),v&&D.push(v);const E={...y};return o.color&&(E["--card-custom-color"]=o.color),l.jsx("div",{className:D.join(" "),onPointerDown:n,onPointerEnter:r,onPointerLeave:s,role:"button",tabIndex:n?0:-1,style:E,children:l.jsxs("div",{className:`card-inner ${i?"":"is-flipped"}`,children:[l.jsxs("div",{className:"card-face card-front",children:[l.jsxs("div",{className:"card-header",children:[l.jsx("span",{className:`card-protocol ${o.protocol.length<=8?"short-protocol":""}`,children:o.protocol.slice(0,8)}),l.jsx("span",{className:"card-value",children:o.value})]}),l.jsxs("div",{className:"card-body",children:[l.jsx(_,{content:o.top,className:"card-rule-top"}),l.jsx(_,{content:o.middle,className:"card-rule-middle"}),l.jsx(_,{content:o.bottom,className:"card-rule-bottom"})]})]}),l.jsx("div",{className:"card-face card-back",children:l.jsx("div",{className:"card-back-value",children:d})})]})})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const vn=[{protocol:"Apathy",value:0,top:"Your total value in this line is increased by 1 for each face-down card in this line.",middle:"",bottom:"",keywords:{},category:"Aux 1"},{protocol:"Apathy",value:1,top:"",middle:"Flip all other face-up cards in this line.",bottom:"",keywords:{flip:!0},category:"Aux 1"},{protocol:"Apathy",value:2,top:"Ignore all middle commands of cards in this line.",middle:"",bottom:"<div><span class='emphasis'>When this card would be covered:</span> First, flip this card.</div>",keywords:{flip:!0},category:"Aux 1"},{protocol:"Apathy",value:3,top:"",middle:"Flip 1 of your opponent's face-up cards.",bottom:"",keywords:{flip:!0},category:"Aux 1"},{protocol:"Apathy",value:4,top:"",middle:"You may flip 1 of your face-up covered cards.",bottom:"",keywords:{flip:!0},category:"Aux 1"},{protocol:"Apathy",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Aux 1"},{protocol:"Chaos",value:0,top:"",middle:"In each line, flip 1 covered card.",bottom:"<div><span class='emphasis'>Start:</span> Draw the top card of your opponent's deck. Your opponent draws the top card of your deck.</div>",keywords:{flip:!0,draw:!0},category:"Main 2"},{protocol:"Chaos",value:1,top:"",middle:"Rearrange your protocols. Rearrange your opponent's protocols.",bottom:"",keywords:{},category:"Main 2"},{protocol:"Chaos",value:2,top:"",middle:"Shift 1 of your covered cards.",bottom:"",keywords:{shift:!0},category:"Main 2"},{protocol:"Chaos",value:3,top:"",middle:"",bottom:"You may play cards without matching protocols.",keywords:{play:!0},category:"Main 2"},{protocol:"Chaos",value:4,top:"",middle:"",bottom:"<div><span class='emphasis'>End:</span> Discard your hand. Draw the same amount of cards.</div>",keywords:{discard:!0,draw:!0},category:"Main 2"},{protocol:"Chaos",value:5,top:"",middle:"Discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 2"},{protocol:"Darkness",value:0,top:"",middle:"Draw 3 cards. Shift 1 of your opponent's covered cards.",bottom:"",keywords:{draw:!0,shift:!0},category:"Main 1"},{protocol:"Darkness",value:1,top:"",middle:"Flip 1 of your opponent's cards. You may shift that card.",bottom:"",keywords:{flip:!0,shift:!0},category:"Main 1"},{protocol:"Darkness",value:2,top:"All face-down cards in this stack have a value of 4.",middle:"You may flip 1 covered card in this line.",bottom:"",keywords:{flip:!0},category:"Main 1"},{protocol:"Darkness",value:3,top:"",middle:"Play 1 card face-down in another line.",bottom:"",keywords:{play:!0},category:"Main 1"},{protocol:"Darkness",value:4,top:"",middle:"Shift 1 face-down card.",bottom:"",keywords:{shift:!0},category:"Main 1"},{protocol:"Darkness",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Death",value:0,top:"",middle:"Delete 1 card from each other line.",bottom:"",keywords:{delete:!0},category:"Main 1"},{protocol:"Death",value:1,top:"<div><span class='emphasis'>Start:</span> You may draw 1 card. If you do, delete 1 other card, then delete this card.</div>",middle:"",bottom:"",keywords:{draw:!0,delete:!0},category:"Main 1"},{protocol:"Death",value:2,top:"",middle:"Delete all cards in 1 line with values of 1 or 2.",bottom:"",keywords:{delete:!0},category:"Main 1"},{protocol:"Death",value:3,top:"",middle:"Delete 1 face-down card.",bottom:"",keywords:{delete:!0},category:"Main 1"},{protocol:"Death",value:4,top:"",middle:"Delete a card with a value of 0 or 1.",bottom:"",keywords:{delete:!0},category:"Main 1"},{protocol:"Death",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Fire",value:0,top:"",middle:"Flip 1 other card. Draw 2 cards.",bottom:"<div><span class='emphasis'>When this card would be covered:</span> First, draw 1 card and flip 1 other card.</div>",keywords:{draw:!0,flip:!0},category:"Main 1"},{protocol:"Fire",value:1,top:"",middle:"Discard 1 card. If you do, delete 1 card.",bottom:"",keywords:{delete:!0,discard:!0},category:"Main 1"},{protocol:"Fire",value:2,top:"",middle:"Discard 1 card. If you do, return 1 card.",bottom:"",keywords:{discard:!0,return:!0},category:"Main 1"},{protocol:"Fire",value:3,top:"",middle:"",bottom:"<div><span class='emphasis'>End:</span> You may discard 1 card. If you do, flip 1 card.</div>",keywords:{discard:!0,flip:!0},category:"Main 1"},{protocol:"Fire",value:4,top:"",middle:"Discard 1 or more cards. Draw the amount discarded plus 1.",bottom:"",keywords:{discard:!0,draw:!0},category:"Main 1"},{protocol:"Fire",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Gravity",value:0,top:"",middle:"For every 2 cards in this line, play the top card of your deck face-down under this card.",bottom:"",keywords:{play:!0},category:"Main 1"},{protocol:"Gravity",value:1,top:"",middle:"Draw 2 cards. Shift 1 card either to or from this line.",bottom:"",keywords:{draw:!0,shift:!0},category:"Main 1"},{protocol:"Gravity",value:2,top:"",middle:"Flip 1 card. Shift that card to this line.",bottom:"",keywords:{flip:!0,shift:!0},category:"Main 1"},{protocol:"Gravity",value:4,top:"",middle:"Shift 1 face-down card to this line.",bottom:"",keywords:{shift:!0},category:"Main 1"},{protocol:"Gravity",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Gravity",value:6,top:"",middle:"Your opponent plays the top card of their deck face-down in this line.",bottom:"",keywords:{play:!0},category:"Main 1"},{protocol:"Hate",value:0,top:"",middle:"Delete 1 card.",bottom:"",keywords:{delete:!0},category:"Aux 1"},{protocol:"Hate",value:1,top:"",middle:"Discard 3 cards. Delete 1 card. Delete 1 card.",bottom:"",keywords:{delete:!0,discard:!0},category:"Aux 1"},{protocol:"Hate",value:2,top:"",middle:"Delete your highest value uncovered card. Delete your opponent's highest value uncovered card.",bottom:"",keywords:{delete:!0},category:"Aux 1"},{protocol:"Hate",value:3,top:"<div><span class='emphasis'>After you delete cards:</span> Draw 1 card.</div>",middle:"",bottom:"",keywords:{draw:!0},category:"Aux 1"},{protocol:"Hate",value:4,top:"",middle:"",bottom:"<div><span class='emphasis'>When this card would be covered:</span> First, delete the lowest value covered card in this line.</div>",keywords:{delete:!0},category:"Aux 1"},{protocol:"Hate",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Aux 1"},{protocol:"Life",value:0,top:"",middle:"Play the top card of your deck face-down in each line where you have a card.",bottom:"<div><span class='emphasis'>When this card would be covered:</span> First, delete this card.</div>",keywords:{delete:!0,play:!0},category:"Main 1"},{protocol:"Life",value:1,top:"",middle:"Flip 1 card. Flip 1 card.",bottom:"",keywords:{flip:!0},category:"Main 1"},{protocol:"Life",value:2,top:"",middle:"Draw 1 card. You may flip 1 face-down card.",bottom:"",keywords:{draw:!0,flip:!0},category:"Main 1"},{protocol:"Life",value:3,top:"",middle:"",bottom:"<div><span class='emphasis'>When this card would be covered:</span> First, play the top card of your deck face-down in another line.</div>",keywords:{play:!0},category:"Main 1"},{protocol:"Life",value:4,top:"",middle:"If this card is covering a card, draw 1 card.",bottom:"",keywords:{draw:!0},category:"Main 1"},{protocol:"Life",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Light",value:0,top:"",middle:"Flip 1 card. Draw cards equal to that card's value.",bottom:"",keywords:{draw:!0,flip:!0},category:"Main 1"},{protocol:"Light",value:1,top:"",middle:"",bottom:"<div><span class='emphasis'>End:</span> Draw 1 card.</div>",keywords:{draw:!0},category:"Main 1"},{protocol:"Light",value:2,top:"",middle:"Draw 2 cards. Reveal 1 face-down card. You may shift or flip that card.",bottom:"",keywords:{draw:!0,flip:!0,reveal:!0,shift:!0},category:"Main 1"},{protocol:"Light",value:3,top:"",middle:"Shift all face-down cards in this line to another line.",bottom:"",keywords:{shift:!0},category:"Main 1"},{protocol:"Light",value:4,top:"",middle:"Your opponent reveals their hand.",bottom:"",keywords:{reveal:!0},category:"Main 1"},{protocol:"Light",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Love",value:1,top:"",middle:"Draw the top card of your opponent's deck.",bottom:"<div><span class='emphasis'>End:</span> You may give 1 card from your hand to your opponent. If you do, draw 2 cards.</div>",keywords:{draw:!0,give:!0},category:"Aux 1"},{protocol:"Love",value:2,top:"",middle:"Your opponent draws 1 card. Refresh.",bottom:"",keywords:{draw:!0,refresh:!0},category:"Aux 1"},{protocol:"Love",value:3,top:"",middle:"Take 1 random card from your opponent's hand. Give 1 card from your hand to your opponent.",bottom:"",keywords:{give:!0,take:!0},category:"Aux 1"},{protocol:"Love",value:4,top:"",middle:"Reveal 1 card from your hand. Flip 1 card.",bottom:"",keywords:{flip:!0,reveal:!0},category:"Aux 1"},{protocol:"Love",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Aux 1"},{protocol:"Love",value:6,top:"",middle:"Your opponent draws 2 cards.",bottom:"",keywords:{draw:!0},category:"Aux 1"},{protocol:"Metal",value:0,top:"Your opponent's total value in this line is reduced by 2.",middle:"Flip 1 card.",bottom:"",keywords:{flip:!0},category:"Main 1"},{protocol:"Metal",value:1,top:"",middle:"Draw 2 cards. Your opponent cannot compile next turn.",bottom:"",keywords:{draw:!0},category:"Main 1"},{protocol:"Metal",value:2,top:"Your opponent cannot play cards face-down in this line.",middle:"",bottom:"",keywords:{},category:"Main 1"},{protocol:"Metal",value:3,top:"",middle:"Draw 1 card. Delete all cards in 1 other line with 8 or more cards.",bottom:"",keywords:{delete:!0,draw:!0},category:"Main 1"},{protocol:"Metal",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Metal",value:6,top:"<div><span class='emphasis'>When this card would be covered or flipped:</span> First, delete this card.</div>",middle:"",bottom:"",keywords:{delete:!0},category:"Main 1"},{protocol:"Plague",value:0,top:"",middle:"Your opponent discards 1 card.",bottom:"Your opponent cannot play cards in this line.",keywords:{discard:!0},category:"Main 1"},{protocol:"Plague",value:1,top:"<div><span class='emphasis'>After your opponent discards cards:</span> Draw 1 card.</div>",middle:"Your opponent discards 1 card.",bottom:"",keywords:{discard:!0,draw:!0},category:"Main 1"},{protocol:"Plague",value:2,top:"",middle:"Dicard 1 or more cards. Your opponent discards the amount of cards discarded plus 1.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Plague",value:3,top:"",middle:"Flip each other face-up card.",bottom:"",keywords:{flip:!0},category:"Main 1"},{protocol:"Plague",value:4,top:"",middle:"",bottom:"<div><span class='emphasis'>End:</span> Your opponent deletes 1 of their face-down cards. You may flip this card.</div>",keywords:{delete:!0,flip:!0},category:"Main 1"},{protocol:"Plague",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Psychic",value:0,top:"",middle:"Draw 2 cards. Your opponent discards 2 cards, then reveals their hand.",bottom:"",keywords:{discard:!0,draw:!0,reveal:!0},category:"Main 1"},{protocol:"Psychic",value:1,top:"Your opponent can only play cards face-down.",middle:"",bottom:"<div><span class='emphasis'>Start:</span> Flip this card.</div>",keywords:{flip:!0},category:"Main 1"},{protocol:"Psychic",value:2,top:"",middle:"Your opponent discards 2 cards. Rearrange their protocols.",bottom:"",keywords:{discard:!0,rearrange:!0},category:"Main 1"},{protocol:"Psychic",value:3,top:"",middle:"Your opponent discards 1 card. Shift 1 of their cards.",bottom:"",keywords:{discard:!0,shift:!0},category:"Main 1"},{protocol:"Psychic",value:4,top:"",middle:"",bottom:"<div><span class='emphasis'>End:</span> You may return 1 of your opponent's cards. If you do, flip this card.</div>",keywords:{flip:!0,return:!0},category:"Main 1"},{protocol:"Psychic",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Speed",value:0,top:"",middle:"Play 1 card.",bottom:"",keywords:{play:!0},category:"Main 1"},{protocol:"Speed",value:1,top:"<div><span class='emphasis'>After you clear cache:</span> Draw 1 card.</div>",middle:"Draw 2 cards.",bottom:"",keywords:{draw:!0},category:"Main 1"},{protocol:"Speed",value:2,top:"<div><span class='emphasis'>When this card would be deleted by compiling:</span> Shift this card, even if this card is covered.</div>",middle:"",bottom:"",keywords:{shift:!0},category:"Main 1"},{protocol:"Speed",value:3,top:"",middle:"Shift 1 of your other cards.",bottom:"<div><span class='emphasis'>End:</span> You may shift 1 of your cards. If you do, flip this card.</div>",keywords:{flip:!0,shift:!0},category:"Main 1"},{protocol:"Speed",value:4,top:"",middle:"Shift 1 of your opponent's face-down cards.",bottom:"",keywords:{shift:!0},category:"Main 1"},{protocol:"Speed",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Spirit",value:0,top:"",middle:"Refresh. Draw 1 card.",bottom:"Skip your check cache phase.",keywords:{draw:!0,refresh:!0},category:"Main 1"},{protocol:"Spirit",value:1,top:"You can play cards in any line.",middle:"Draw 2 cards.",bottom:"<div><span class='emphasis'>Start:</span> Either discard 1 card or flip this card.</div>",keywords:{discard:!0,draw:!0,flip:!0},category:"Main 1"},{protocol:"Spirit",value:2,top:"",middle:"You may flip 1 card.",bottom:"",keywords:{flip:!0},category:"Main 1"},{protocol:"Spirit",value:3,top:"<div><span class='emphasis'>After you draw cards:</span> You may shift this card, even if this card is covered.</div>",middle:"",bottom:"",keywords:{shift:!0},category:"Main 1"},{protocol:"Spirit",value:4,top:"",middle:"Swap the positions of 2 of your protocols",bottom:"",keywords:{swap:!0},category:"Main 1"},{protocol:"Spirit",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Water",value:0,top:"",middle:"Flip 1 other card. Flip this card.",bottom:"",keywords:{flip:!0},category:"Main 1"},{protocol:"Water",value:1,top:"",middle:"Play the top card of your deck face-down in each other line.",bottom:"",keywords:{play:!0},category:"Main 1"},{protocol:"Water",value:2,top:"",middle:"Draw 2 cards. Rearrange your protocols.",bottom:"",keywords:{draw:!0,rearrange:!0},category:"Main 1"},{protocol:"Water",value:3,top:"",middle:"Return all cards with a value of 2 in 1 line.",bottom:"",keywords:{return:!0},category:"Main 1"},{protocol:"Water",value:4,top:"",middle:"Return 1 of your cards.",bottom:"",keywords:{return:!0},category:"Main 1"},{protocol:"Water",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Frost",value:0,top:"",middle:"Draw 1 card for each face-down card.",bottom:"",keywords:{draw:!0},category:"Fan-Content"},{protocol:"Frost",value:1,top:"Cards cannot be flipped face-up.",middle:"",bottom:"Protocols cannot be rearranged.",keywords:{flip:!0,rearrange:!0},category:"Fan-Content"},{protocol:"Frost",value:2,top:"",middle:"Play a card face-down.",bottom:"",keywords:{play:!0},category:"Fan-Content"},{protocol:"Frost",value:3,top:"Cards cannot shift from or to this line.",middle:"",bottom:"",keywords:{shift:!0},category:"Fan-Content"},{protocol:"Frost",value:4,top:"",middle:"You may flip 1 card of your face-up covered cards.",bottom:"",keywords:{flip:!0},category:"Fan-Content"},{protocol:"Frost",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Fan-Content"},{protocol:"Anarchy",value:0,top:"",middle:"Shift 1 card. For each line that contains a face-up card without matching protocol, draw 1 card.",bottom:"",keywords:{shift:!0,draw:!0},category:"Fan-Content"},{protocol:"Anarchy",value:1,top:"Cards can only be played without matching protocols.",middle:"Shift 1 other card to a line without a matching protocol.",bottom:"",keywords:{shift:!0,play:!0},category:"Fan-Content"},{protocol:"Anarchy",value:2,top:"",middle:"Delete a covered or uncovered card in a line with a matching protocol.",bottom:"",keywords:{delete:!0},category:"Fan-Content"},{protocol:"Anarchy",value:3,top:"",middle:"Swap the positions of 2 of your opponent's protocols.",bottom:"<div><span class='emphasis'>End:</span> Rearrange your protocols. Anarchy cannot be on this line.</div>",keywords:{swap:!0,rearrange:!0},category:"Fan-Content"},{protocol:"Anarchy",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Fan-Content"},{protocol:"Anarchy",value:6,top:"<div><span class='emphasis'>Start:</span> Flip this card, if this card is in the line with the Anarchy protocol.</div>",middle:"",bottom:"",keywords:{flip:!0},category:"Fan-Content"}],_v=new Set(vn.map(o=>o.protocol)),Th=Array.from(_v).sort();/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const qt=o=>{var s,i,d,f,m,h,p,y,v,x,_,w,U,C,A,S,N,q,D,E,j,I,k,L,G,T,Q,X,M,$,W,P,ne,F,z,H,V,Y,B,J,ee,he,ye,me,xe,Ee,Ue,Xe,Se,Me,tt,Pt,Qt,Te,He,Ze,Je,en,vt,Ct,mt,Ht,_t,ho,Bo,ya;const n=o.params;let r="";switch(n.action){case"refresh":{n.target==="opponent"?r="Your opponent refreshes their hand.":r="Refresh.";break}case"mutual_draw":{const ue=n.count||1;r=`Draw the top card${ue!==1?"s":""} of your opponent's deck. Your opponent draws the top card${ue!==1?"s":""} of your deck.`;break}case"draw":{if(o.useCardFromPreviousEffect){n.target==="opponent"?r="Opponent draws cards equal to that card's value.":r="Draw cards equal to that card's value.";break}if(n.countType==="count_face_down"){r="Draw 1 card for each face-down card.";break}if(n.conditional){switch(n.conditional.type){case"count_face_down":r="Draw 1 card for each face-down card.";break;case"is_covering":r=`Draw ${n.count} card${n.count!==1?"s":""} if this card is covering another.`;break;case"non_matching_protocols":r="Draw 1 card for each line with a non-matching protocol.";break}break}let ue="";if(n.countType==="equal_to_discarded"){const Fe=n.countOffset||0;Fe===1?ue+="Draw 1 more card than the amount discarded.":Fe===0?ue+="Draw the same amount of cards.":ue+=`Draw the amount discarded plus ${Fe}.`,r=ue;break}else if(n.countType==="equal_to_card_value"){ue+="Draw cards equal to that card's value.",r=ue;break}else if(n.countType==="hand_size"){ue+="Draw the same amount of cards.",r=ue;break}const we=n.optional?"You may ":"";if(n.source==="opponent_deck"){const Fe=n.count===1?"the top card":`the top ${n.count} cards`;ue+=`${we}Draw ${Fe} of your opponent's deck.`}else if(n.target==="opponent")ue+=`Opponent draws ${n.count} card${n.count!==1?"s":""}.`;else{const Fe=n.optional?"draw":"Draw";ue+=`${we}${Fe} ${n.count} card${n.count!==1?"s":""}.`}r=ue;break}case"flip":{if(o.useCardFromPreviousEffect){r=`${n.optional?"May flip":"Flip"} that card.`;break}if(n.flipSelf){let ft=(n.optional,"Flip this card");((s=n.advancedConditional)==null?void 0:s.type)==="protocol_match"&&(ft+=`, if this card is in the line with the ${n.advancedConditional.protocol||"[Protocol]"} protocol`),r=ft+".";break}const ue=n.optional?"You may flip":"Flip",we=((i=n.targetFilter)==null?void 0:i.owner)==="own",Fe=((d=n.targetFilter)==null?void 0:d.owner)==="opponent";let De="";we&&(De+="your "),Fe&&(De+="opponent's "),(f=n.targetFilter)!=null&&f.excludeSelf&&(De+="other "),((m=n.targetFilter)==null?void 0:m.position)==="any"?De+="covered or uncovered ":((h=n.targetFilter)==null?void 0:h.position)==="covered"&&(De+="covered "),((p=n.targetFilter)==null?void 0:p.faceState)==="face_down"&&(De+="face-down "),((y=n.targetFilter)==null?void 0:y.faceState)==="face_up"&&(De+="face-up ");let Oe="";n.count==="all"?Oe="all":n.count==="each"?n.eachLineScope==="each_line"?(Oe="1",De=De+"(in each line) "):Oe="each":Oe=n.count.toString();const at=n.count===1?"card":"cards";let We="";we&&((v=n.targetFilter)==null?void 0:v.position)==="covered"&&((x=n.targetFilter)==null?void 0:x.faceState)==="face_up"&&n.optional?We=`${ue} ${Oe} of your ${n.targetFilter.faceState.replace("_","-")} ${n.targetFilter.position} cards`:We=`${ue} ${Oe} ${De}${at}`,n.scope==="this_lane"?We+=" in this line":n.scope==="each_lane"&&(We=`In each line, ${We.charAt(0).toLowerCase()+We.slice(1)}`),We+=".",n.selfFlipAfter&&(We+=" Then flip this card."),r=We;break}case"shift":{const ue=n.optional?"You may shift":"Shift";if(n.shiftSelf){let bt=`${ue} this card`;n.allowCoveredSelf&&(bt+=", even if this card is covered"),r=bt+".";break}if(o.useCardFromPreviousEffect){let bt=`${ue} that card`;((_=n.destinationRestriction)==null?void 0:_.type)==="to_this_lane"?bt+=" to this line":((w=n.destinationRestriction)==null?void 0:w.type)==="to_another_line"?bt+=" to another line":((U=n.destinationRestriction)==null?void 0:U.type)==="non_matching_protocol"?bt+=" to a line without a matching protocol":((C=n.destinationRestriction)==null?void 0:C.type)==="specific_lane"&&(bt+=" within this line"),r=bt+".";break}const we=n.count||1,Fe=((A=n.targetFilter)==null?void 0:A.owner)==="own",De=((S=n.targetFilter)==null?void 0:S.position)==="covered";if(Fe&&De&&we===1){let bt=`${ue} 1 of your covered cards`;((N=n.destinationRestriction)==null?void 0:N.type)==="non_matching_protocol"?bt+=" to a line without a matching protocol":((q=n.destinationRestriction)==null?void 0:q.type)==="specific_lane"?bt+=" within this line":((D=n.destinationRestriction)==null?void 0:D.type)==="to_another_line"&&(bt+=" to another line"),r=bt+".";break}if(((E=n.targetFilter)==null?void 0:E.owner)==="own"&&((j=n.targetFilter)==null?void 0:j.position)==="any"&&!((I=n.targetFilter)!=null&&I.excludeSelf)&&we===1){r=`${ue} this card, even if this card is covered`+".";break}if(Fe&&!De&&!((k=n.targetFilter)!=null&&k.excludeSelf)&&we===1){r=`${ue} 1 of your cards`+".";break}let at="";const We=((L=n.targetFilter)==null?void 0:L.owner)==="opponent",ft=(G=n.targetFilter)==null?void 0:G.excludeSelf,sn=((T=n.targetFilter)==null?void 0:T.position)==="any";Fe&&ft?at+="of your other ":We?at+="of your opponent's ":ft&&(at+="other "),sn?at+="covered or uncovered ":((Q=n.targetFilter)==null?void 0:Q.position)==="covered"&&(at+="covered "),((X=n.targetFilter)==null?void 0:X.faceState)==="face_down"&&(at+="face-down "),((M=n.targetFilter)==null?void 0:M.faceState)==="face_up"&&(at+="face-up ");const Bt=n.count==="all"?"all":"1";let Fn=`${ue} ${Bt} ${at}${Fe&&ft||We?"cards":Bt==="1"?"card":"cards"}`;(($=n.destinationRestriction)==null?void 0:$.type)==="non_matching_protocol"?Fn+=" to a line without a matching protocol":((W=n.destinationRestriction)==null?void 0:W.type)==="specific_lane"?Fn+=" within this line":((P=n.destinationRestriction)==null?void 0:P.type)==="to_another_line"?Fn+=" to another line":((ne=n.destinationRestriction)==null?void 0:ne.type)==="to_this_lane"?Fn+=" to this line":((F=n.destinationRestriction)==null?void 0:F.type)==="to_or_from_this_lane"&&(Fn+=" either to or from this line"),r=Fn+".";break}case"delete":{if(o.useCardFromPreviousEffect){r="Delete that card.";break}if(n.deleteSelf){r="Delete this card.";break}let ue="Delete ";const we=((z=n.targetFilter)==null?void 0:z.position)==="any",Fe=((H=n.targetFilter)==null?void 0:H.calculation)==="highest_value"||((V=n.targetFilter)==null?void 0:V.calculation)==="lowest_value",De=((Y=n.targetFilter)==null?void 0:Y.owner)==="own"||((B=n.targetFilter)==null?void 0:B.owner)==="opponent",Oe=n.count===1&&Fe&&De;if(n.count==="all_in_lane"?ue+="all ":Oe||(ue+=we?"a ":`${n.count} `),Oe&&(((J=n.targetFilter)==null?void 0:J.owner)==="own"?ue+="your ":((ee=n.targetFilter)==null?void 0:ee.owner)==="opponent"&&(ue+="opponent's ")),((he=n.targetFilter)==null?void 0:he.calculation)==="highest_value"?ue+="highest value ":((ye=n.targetFilter)==null?void 0:ye.calculation)==="lowest_value"&&(ue+="lowest value "),(me=n.targetFilter)!=null&&me.valueRange){const{min:We,max:ft}=n.targetFilter.valueRange,sn=[];for(let mo=We;mo<=ft;mo++)sn.push(mo);const Bt=sn.join(" or ");ue+=`value ${Bt} `}Oe||(((xe=n.targetFilter)==null?void 0:xe.owner)==="own"?ue+="your ":((Ee=n.targetFilter)==null?void 0:Ee.owner)==="opponent"&&(ue+="opponent's ")),n.excludeSelf&&(ue+="other "),we?ue+="covered or uncovered ":((Ue=n.targetFilter)==null?void 0:Ue.position)==="covered"&&(ue+="covered "),((Xe=n.targetFilter)==null?void 0:Xe.faceState)==="face_down"?ue+="face-down ":((Se=n.targetFilter)==null?void 0:Se.faceState)==="face_up"&&(ue+="face-up ");const at=n.count===1?"card":"cards";ue+=at,n.selectLane&&(ue+=" in 1 line"),n.protocolMatching==="must_match"?ue+=" in a line with a matching protocol":n.protocolMatching==="must_not_match"&&(ue+=" in a line without a matching protocol"),((Me=n.scope)==null?void 0:Me.type)==="this_line"?ue+=" in this line":((tt=n.scope)==null?void 0:tt.type)==="other_lanes"?ue+=" in other lanes":((Pt=n.scope)==null?void 0:Pt.type)==="each_other_line"&&(ue+=" from each other line"),r=ue+".";break}case"discard":{if(o.useCardFromPreviousEffect){n.actor==="opponent"?r="Opponent discards that card.":r="Discard that card.";break}if(n.countType==="equal_to_discarded"){const De=n.countOffset||0;n.actor==="opponent"?De===1?r="Your opponent discards the amount of cards discarded plus 1.":De===0?r="Your opponent discards the same amount of cards.":r=`Your opponent discards the amount discarded plus ${De}.`:De===1?r="Discard 1 more card than the amount discarded.":De===0?r="Discard the same amount of cards.":r=`Discard the amount discarded plus ${De}.`;break}const ue=n.variableCount;let we="";if(ue)we="1 or more cards";else if(n.count==="all")we="your hand";else{const De=n.count===1?"card":"cards";we=`${n.count} ${De}`}const Fe=n.optional?"You may discard":n.count==="all"||ue?"Discard":"You discard";n.actor==="opponent"?n.count==="all"?r="Opponent discards their hand.":r=`Your opponent discards ${we}.`:r=`${Fe} ${we}.`;break}case"return":{if(o.useCardFromPreviousEffect){r="Return that card to hand.";break}const we=n.selectLane||!1?" in 1 line":"";if(((Qt=n.targetFilter)==null?void 0:Qt.valueEquals)!==void 0){r=`Return all cards with a value of ${n.targetFilter.valueEquals}${we}.`;break}const Fe=((Te=n.targetFilter)==null?void 0:Te.owner)||"any",De=((He=n.targetFilter)==null?void 0:He.position)||"uncovered";let Oe="";De==="any"?Oe="covered or uncovered ":De==="covered"&&(Oe="covered ");const at=n.count==="all"?`all ${Oe}cards`:n.count===1?`1 ${Oe}card`:`${n.count} ${Oe}cards`;let We="";Fe==="own"?We=" of your":Fe==="opponent"&&(We=" of your opponent's"),r=`${n.optional?"You may r":"R"}eturn ${at}${We}${we}.`;break}case"play":{if(o.useCardFromPreviousEffect){const ft=n.faceDown===!0?"face-down":n.faceDown===!1?"face-up":"";r=ft?`Play that card ${ft}.`:"Play that card.";break}const ue=n.actor,we=n.count||1,Fe=n.faceDown===!0?" face-down":n.faceDown===!1?" face-up":"";let De="",Oe="";ue==="opponent"?(De="Your opponent plays",n.source==="deck"?Oe=we===1?"the top card of their deck":`${we} cards from their deck`:Oe=we===1?"a card from their hand":`${we} cards from their hand`):(De="Play",n.source==="deck"?Oe=we===1?"the top card of your deck":`${we} cards from your deck`:Oe=we===1?"1 card":`${we} cards`);let at="";((Ze=n.condition)==null?void 0:Ze.type)==="per_x_cards_in_line"&&(at=`For every ${n.condition.cardCount||2} cards in this line, `,De=De.toLowerCase());let We=`${at}${De} ${Oe}${Fe}`;if(((Je=n.destinationRule)==null?void 0:Je.type)==="other_lines")We+=" to other lines";else if(((en=n.destinationRule)==null?void 0:en.type)==="another_line")We+=" in another line";else if(((vt=n.destinationRule)==null?void 0:vt.type)==="each_other_line")We+=" in each other line";else if(((Ct=n.destinationRule)==null?void 0:Ct.type)==="under_this_card")We+=" under this card";else if(((mt=n.destinationRule)==null?void 0:mt.type)==="each_line_with_card"){const ft=n.destinationRule.ownerFilter;ft==="own"?We+=" in each line where you have a card":ft==="opponent"?We+=" in each line where opponent has a card":We+=" to each line with a card"}else((Ht=n.destinationRule)==null?void 0:Ht.type)==="specific_lane"&&(We+=" in this line");r=We+".";break}case"rearrange_protocols":case"swap_protocols":{const ue=n.target==="opponent"?"your opponent's":n.target==="both_sequential"?"both players'":"your";let we="";n.action==="rearrange_protocols"?we=`Rearrange ${ue} protocols`:we=`Swap the positions of 2 of ${ue} protocols`,n.restriction&&n.restriction.disallowedProtocol&&(we+=`. ${n.restriction.disallowedProtocol} cannot be on this line`),r=we+".";break}case"reveal":case"give":{if(o.useCardFromPreviousEffect){r=`${n.action==="give"?"Give":"Reveal"} that card.`;break}if(n.action,n.source==="board"){const We=((_t=n.targetFilter)==null?void 0:_t.faceState)==="face_down"?"face-down ":"",ft=n.count||1;let Bt=`Reveal ${ft} ${We}${ft===1?"card":"cards"}`;n.optional?Bt+=". You may shift or flip that card":n.followUpAction==="flip"?Bt+=". Then flip it":n.followUpAction==="shift"&&(Bt+=". Then shift it"),r=Bt+".";break}if(n.count===-1){n.source==="opponent_hand"?r=n.action==="reveal"?"Your opponent reveals their hand.":"Give your entire hand to your opponent.":r=n.action==="reveal"?"Reveal your hand.":"Give your entire hand.";break}const ue=n.count===1?"card":"cards",we=n.source==="opponent_hand"?"opponent's hand":"your hand",Fe=n.optional?"You may ":"",De=n.action==="give"?"give":"reveal",Oe=n.action==="give"?"Give":"Reveal";let at;n.optional?at=`${Fe}${De} ${n.count} ${ue} from ${we}`:at=`${Oe} ${n.count} ${ue} from ${we}`,n.action==="give"&&n.source!=="opponent_hand"&&(at+=" to your opponent"),n.followUpAction==="flip"?at+=". Then flip it.":n.followUpAction==="shift"?at+=". Then shift it.":at+=".",r=at;break}case"take":{const ue=n.count===1?"card":"cards",we=n.random!==!1?"random ":"";r=`Take ${n.count} ${we}${ue} from your opponent's hand.`;break}case"choice":{const ue=n.options||[];if(ue.length===0){r="Effect";break}if(ue.length===2){const we=ue.map(Fe=>{const De={params:Fe.params};let Oe=qt(De);return Oe.endsWith(".")&&(Oe=Oe.slice(0,-1)),Oe=Oe.charAt(0).toLowerCase()+Oe.slice(1),Oe});r=`Either ${we[0]} or ${we[1]}.`}else r="Effect";break}case"passive_rule":{const ue=n.rule;switch(ue==null?void 0:ue.type){case"require_non_matching_protocol":r="Cards can only be played without matching protocols.";break;case"block_all_play":ue.target==="opponent"?r="Your opponent cannot play cards in this line.":ue.target==="self"?r="You cannot play cards in this line.":r="Cards cannot be played in this line.";break;case"ignore_middle_commands":r="Ignore all middle commands of cards in this line.";break;case"block_face_down_play":r="Opponent can't play cards face-down in this line.";break;case"require_face_down_play":r=ue.scope==="global"?"Your opponent can only play cards face-down.":"Opponent can only play cards face-down in this line.";break;case"allow_any_protocol_play":r="You may play cards without matching protocols.";break;case"block_flips":r=ue.scope==="global"?"Cards cannot be flipped face-up.":"Cards can't be flipped face-up in this line.";break;case"block_protocol_rearrange":r="Protocols can't be rearranged.";break;case"block_shifts_from_lane":r="Cards can't shift from this line.";break;case"block_shifts_to_lane":r="Cards can't shift to this line.";break;case"block_shifts_from_and_to_lane":r="Cards cannot shift from or to this line.";break;case"skip_check_cache_phase":r="Skip check cache phase.";break;default:r="Passive rule effect."}break}case"value_modifier":{const ue=n.modifier;switch(ue==null?void 0:ue.type){case"add_per_condition":{const we=ue.scope==="this_lane"?"in this line":"",Fe=ue.target==="own_total"?"Your total value":ue.target==="opponent_total"?"Opponent's total value":"Total value";let De="";ue.condition==="per_face_down_card"?De="for each face-down card":ue.condition==="per_face_up_card"?De="for each face-up card":ue.condition==="per_card"&&(De="for each card");const Oe=ue.value>=0?"+":"";r=`${Fe} ${we} is increased by ${Oe}${ue.value} ${De} ${we}.`.replace(/\s+/g," ");break}case"set_to_fixed":{let we="";ue.target==="own_cards"?we="your":ue.target==="opponent_cards"?we="opponent's":we="all";let Fe="";((ho=ue.filter)==null?void 0:ho.faceState)==="face_down"?Fe=" face-down":((Bo=ue.filter)==null?void 0:Bo.faceState)==="face_up"&&(Fe=" face-up");let De="";ue.scope==="this_lane"&&(De=" in this stack"),r=`All ${we}${Fe} cards${De} have a value of ${ue.value}.`;break}case"add_to_total":{const we=ue.scope==="this_lane"?" in this line":"";ue.target==="opponent_total"?ue.value<0?r=`Your opponent's total value${we} is reduced by ${Math.abs(ue.value)}.`:r=`Your opponent's total value${we} is increased by ${ue.value}.`:ue.value<0?r=`Your total value${we} is reduced by ${Math.abs(ue.value)}.`:r=`Your total value${we} is increased by ${ue.value}.`;break}default:r="Value modifier effect."}break}case"block_compile":{r=`${n.target==="opponent"?"Your opponent":"You"} cannot compile next turn.`;break}case"delete_all_in_lane":{const ue=((ya=n.laneCondition)==null?void 0:ya.count)||8;r=`Delete all cards in ${n.excludeCurrentLane?"1 other line":"1 line"} with ${ue} or more cards.`;break}case"modify_value":{const ue=n.modifier||0,we=n.target==="opponent"?"Your opponent's":"Your",Fe=ue<0?`reduced by ${Math.abs(ue)}`:`increased by ${ue}`;r=`${we} total value in this line is ${Fe}.`;break}case"block_play_face_down":{r="Your opponent cannot play cards face-down in this line.";break}default:r="Effect";break}if(o.conditional&&o.conditional.thenEffect){const ue=qt(o.conditional.thenEffect);o.conditional.type==="then"?r=`${r.endsWith(".")?r.slice(0,-1):r}, then ${ue.toLowerCase()}`:r=`${r} If you do, ${ue.toLowerCase()}`}return r},xv=o=>{const n={};for(const r of o){const i=r.params.action;i==="draw"&&(n.draw=!0),i==="flip"&&(n.flip=!0),i==="shift"&&(n.shift=!0),i==="delete"&&(n.delete=!0),i==="discard"&&(n.discard=!0),i==="return"&&(n.return=!0),i==="play"&&(n.play=!0),i==="reveal"&&(n.reveal=!0),i==="give"&&(n.give=!0),i==="take"&&(n.take=!0)}return n},ll=o=>o.length===0?"":o.map(n=>{const r=qt(n),s=n.trigger;if(s==="start")return`<div><span class='emphasis'>Start:</span> ${r}</div>`;if(s==="end")return`<div><span class='emphasis'>End:</span> ${r}</div>`;if(s==="on_cover")return`<div><span class='emphasis'>When this card would be covered:</span> First, ${r.toLowerCase()}</div>`;if(s==="on_flip")return`<div><span class='emphasis'>When this card would be flipped:</span> First, ${r.toLowerCase()}</div>`;if(s==="on_cover_or_flip")return`<div><span class='emphasis'>When this card would be covered or flipped:</span> First, ${r.toLowerCase()}</div>`;if(s==="after_draw"||s==="after_delete"||s==="after_shift"||s==="after_flip"||s==="after_clear_cache"){const i=n.reactiveTriggerActor||"self",d=i==="self"?"you":i==="opponent"?"opponent":"a card is";let f="";return s==="after_draw"?f=i==="any"?"drawn":"draw cards":s==="after_delete"?f=i==="any"?"deleted":"delete cards":s==="after_shift"?f=i==="any"?"shifted":"shift cards":s==="after_flip"?f=i==="any"?"flipped":"flip cards":s==="after_clear_cache"&&(f="clear cache"),`<div><span class='emphasis'>${i==="any"?`After ${d} ${f}`:`After ${d} ${f}`}:</span> ${r}</div>`}return s==="after_opponent_discard"?`<div><span class='emphasis'>After your opponent discards cards:</span> ${r}</div>`:s==="before_compile_delete"?`<div><span class='emphasis'>When this card would be deleted by compiling:</span> ${r}</div>`:r}).join(" "),wv=(o,n)=>{var h,p,y;const r=((h=o.text)==null?void 0:h.top)!==void 0?o.text.top:ll(o.topEffects),s=((p=o.text)==null?void 0:p.middle)!==void 0?o.text.middle:ll(o.middleEffects),i=((y=o.text)==null?void 0:y.bottom)!==void 0?o.text.bottom:ll(o.bottomEffects),d=[...o.topEffects,...o.middleEffects,...o.bottomEffects],f=xv(d);return{protocol:n.name,value:o.value,top:r,middle:s,bottom:i,keywords:f,category:n.category||"Custom",color:n.color,pattern:n.pattern,customEffects:{topEffects:o.topEffects,middleEffects:o.middleEffects,bottomEffects:o.bottomEffects}}},Cv=o=>o.cards.map(n=>wv(n,o)),Ho=()=>{try{const o=localStorage.getItem("custom_protocols_v1");if(!o)return[];const r=JSON.parse(o).protocols||[],s=[];for(const i of r){const d=Cv(i);s.push(...d)}return s}catch(o){return console.error("Failed to load custom protocol cards:",o),[]}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const kh="custom_protocols_v1",nd=1,ma=()=>{try{const o=localStorage.getItem(kh);if(!o)return[];const n=JSON.parse(o);return n.version!==nd&&console.warn(`Custom protocol storage version mismatch: expected ${nd}, got ${n.version}`),n.protocols||[]}catch(o){return console.error("Error loading custom protocols:",o),[]}},dd=o=>{try{const n={protocols:o,version:nd};localStorage.setItem(kh,JSON.stringify(n))}catch(n){console.error("Error saving custom protocols:",n)}},Nt=o=>{const n=ma(),r=n.findIndex(s=>s.id===o.id);r>=0?n[r]=o:n.push(o),dd(n)},bv=o=>{const r=ma().filter(s=>s.id!==o);dd(r)},Sv=["anarchy-custom-001","apathy_custom","chaos_custom_1","darkness_custom_v1","death_custom_v1","fire-custom-001","frost_custom_1","gravity_custom_1","hate-custom-001","life_custom_1","light_custom_1","love_custom_v1","metal_custom_1","plague-custom-001","psychic_custom_v1","speed_custom_1","spirit_custom_1","water_custom_1"],rl=o=>Sv.includes(o.id),Ev=(o,n)=>{const r=(i,d)=>{i=i.replace("#","");const f=parseInt(i.substring(0,2),16),m=parseInt(i.substring(2,4),16),h=parseInt(i.substring(4,6),16);return`rgba(${f}, ${m}, ${h}, ${d})`},s={borderColor:n};switch(o){case"solid":return{...s,backgroundColor:n};case"radial":return{...s,backgroundColor:"var(--surface-color)",backgroundImage:`radial-gradient(circle at 50% 50%, ${r(n,.25)} 0%, transparent 60%)`};case"dual-radial":return{...s,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 0% 0%, ${r(n,.2)}, transparent 50%),
                    radial-gradient(at 100% 100%, ${r(n,.2)}, transparent 50%)
                `};case"multi-radial":return{...s,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 0%, ${r(n,.2)}, transparent 70%),
                    radial-gradient(circle at 20% 30%, ${r(n,.15)}, transparent 40%),
                    radial-gradient(circle at 80% 70%, ${r(n,.2)}, transparent 50%)
                `};case"chaos":return{...s,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 10% 10%, hsla(60, 100%, 50%, 0.15), transparent 30%),
                    radial-gradient(at 90% 20%, hsla(180, 100%, 50%, 0.15), transparent 35%),
                    radial-gradient(at 30% 80%, hsla(300, 100%, 50%, 0.15), transparent 40%),
                    radial-gradient(at 70% 60%, hsla(0, 100%, 50%, 0.1), transparent 25%)
                `};case"grid":return{...s,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(circle at 50% 50%, ${r(n,.2)} 0%, transparent 40%),
                    linear-gradient(hsla(0,0%,100%,0.03) 1px, transparent 1px),
                    linear-gradient(90deg, hsla(0,0%,100%,0.03) 1px, transparent 1px)
                `,backgroundSize:"100% 100%, 20px 20px, 20px 20px"};case"diagonal-lines":return{...s,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 0% 100%, ${r(n,.25)}, transparent 70%),
                    repeating-linear-gradient(120deg, transparent, transparent 15px, ${r(n,.05)} 15px, ${r(n,.05)} 30px)
                `};case"cross-diagonal":return{...s,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 50%, ${r(n,.25)} 0%, transparent 50%),
                    repeating-linear-gradient(45deg, transparent, transparent 8px, ${r(n,.08)} 8px, ${r(n,.08)} 16px),
                    repeating-linear-gradient(-45deg, transparent, transparent 8px, ${r(n,.06)} 8px, ${r(n,.06)} 16px)
                `};case"horizontal-lines":return{...s,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 80% 80%, ${r(n,.1)}, transparent 50%),
                    repeating-linear-gradient(0deg, hsla(0,0%,100%,0.02), hsla(0,0%,100%,0.02) 1px, transparent 1px, transparent 3px)
                `};case"vertical-lines":return{...s,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 10% 10%, ${r(n,.2)}, transparent 50%),
                    repeating-linear-gradient(175deg, transparent, transparent 1px, ${r(n,.05)} 1px, ${r(n,.05)} 2px)
                `};case"cross":return{...s,backgroundColor:"var(--surface-color)",backgroundImage:`
                    linear-gradient(0deg, transparent 40%, ${r(n,.1)} 50%, transparent 60%),
                    linear-gradient(90deg, transparent 48%, ${r(n,.2)} 50%, transparent 52%)
                `};case"hexagons":return{...s,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 0%, ${r(n,.2)}, transparent 70%),
                    url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='28' height='49' viewBox='0 0 28 49'%3E%3Cg fill-rule='evenodd'%3E%3Cg id='hexagons' fill='${encodeURIComponent(n)}' fill-opacity='0.05' fill-rule='nonzero'%3E%3Cpath d='M13.99 9.25l13 7.5v15l-13 7.5L1 31.75v-15l12.99-7.5zM3 17.9v12.7l10.99 6.34 11-6.35V17.9l-11-6.34L3 17.9zM0 15l12.99-7.5L26 15v18.5l-13 7.5L0 33.5V15z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")
                `};case"stripes":return{...s,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 100%, ${r(n,.25)}, transparent 60%),
                    linear-gradient(135deg, hsla(0,0%,0%,0.1) 23%, transparent 23%, transparent 25%, hsla(0,0%,0%,0.1) 25%, hsla(0,0%,0%,0.1) 27%, transparent 27%, transparent 73%, hsla(0,0%,0%,0.1) 73%, hsla(0,0%,0%,0.1) 75%, transparent 75%, transparent 77%, hsla(0,0%,0%,0.1) 77%)
                `};default:return{...s,backgroundColor:n}}},jv=({protocols:o,onCreateNew:n,onEdit:r,onDelete:s,onImport:i,onBack:d})=>{const[f,m]=ce.useState(!1),[h,p]=ce.useState(!1),[y,v]=ce.useState(""),[x,_]=ce.useState(""),w=f?o:o.filter(C=>!rl(C)),U=()=>{_("");try{const C=JSON.parse(y);if(!C.name||!C.color||!C.pattern||!Array.isArray(C.cards)){_("Invalid protocol format. Missing required fields.");return}if(C.cards.length!==6){_("Invalid protocol: must have exactly 6 cards.");return}const A=o.find(S=>S.name.toLowerCase()===C.name.toLowerCase());if(A){confirm(`A protocol named "${C.name}" already exists. Overwrite it?`)&&(C.id=A.id,i(C),p(!1),v(""),alert("Protocol imported and overwritten successfully!"));return}C.id=Date.now().toString(),C.createdAt=new Date().toISOString(),i(C),p(!1),v(""),alert("Protocol imported successfully!")}catch{_("Invalid JSON format. Please check your input.")}};return l.jsxs("div",{className:"protocol-list",children:[l.jsxs("div",{className:"list-header",children:[l.jsx("h2",{children:"Custom Protocols"}),l.jsxs("div",{className:"header-actions",children:[l.jsxs("label",{className:"system-protocols-toggle",children:[l.jsx("input",{type:"checkbox",checked:f,onChange:C=>m(C.target.checked)}),"Show System Protocols"]}),l.jsx("button",{onClick:()=>p(!0),className:"btn",children:"Import Protocol"}),d&&l.jsx("button",{onClick:d,className:"btn btn-back",children:"Back"})]})]}),h&&l.jsx("div",{className:"custom-protocol-modal-overlay",onClick:()=>p(!1),children:l.jsxs("div",{className:"custom-protocol-modal-content",onClick:C=>C.stopPropagation(),children:[l.jsx("h3",{children:"Import Protocol"}),l.jsx("p",{children:"Paste the protocol JSON below:"}),l.jsx("textarea",{value:y,onChange:C=>v(C.target.value),placeholder:'{"name":"Protocol Name","color":"#1976D2",...}',rows:10,className:"import-textarea"}),x&&l.jsx("div",{className:"error-message",children:x}),l.jsxs("div",{className:"custom-protocol-modal-actions",children:[l.jsx("button",{onClick:()=>p(!1),className:"btn btn-back",children:"Cancel"}),l.jsx("button",{onClick:U,className:"btn",children:"Import"})]})]})}),l.jsxs("div",{className:"protocols-grid",children:[l.jsxs("div",{className:"protocol-card new-protocol-card",onClick:n,children:[l.jsx("div",{className:"protocol-header new-protocol-header",children:l.jsxs("div",{className:"protocol-header-content",children:[l.jsx("h3",{children:"+ New Protocol"}),l.jsx("p",{className:"header-description",children:"Create a custom protocol"})]})}),l.jsx("div",{className:"protocol-body new-protocol-body"})]}),w.map(C=>{const A=rl(C);return l.jsx("div",{className:`protocol-card ${A?"system-protocol":""}`,style:Ev(C.pattern,C.color),onClick:()=>r(C),children:l.jsxs("div",{className:"protocol-header-content",children:[l.jsx("h3",{children:C.name}),A&&l.jsx("span",{className:"system-badge",children:"System"}),C.description&&l.jsx("p",{className:"header-description",children:C.description})]})},C.id)})]})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Nh="customProtocolsEnabled";function ud(){try{return localStorage.getItem(Nh)==="true"}catch{return!1}}function Av(o){try{localStorage.setItem(Nh,o?"true":"false")}catch{}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */let Tc=null;function Rv(){if(!Tc){const o=ud(),n=Ho(),r=ma(),s=new Set(r.filter(i=>rl(i)).map(i=>i.name));Tc=n.filter(i=>s.has(i.protocol)||o)}return Tc}function ir(){Tc=null}function io(o){const n=Rv(),r=[];for(const s of o){const i=n.filter(d=>d.protocol===s);r.push(...i)}return r}function Ln(o){const n=[...o];for(let r=n.length-1;r>0;r--){const s=Math.floor(Math.random()*(r+1));[n[r],n[s]]=[n[s],n[r]]}return n}function ah({onNavigate:o,difficulty:n,setDifficulty:r,useControl:s,onUseControlChange:i}){const[d,f]=ce.useState(null),[m,h]=ce.useState(null),[p,y]=ce.useState(null),[v,x]=ce.useState([]),[_,w]=ce.useState(!0),[U,C]=ce.useState(0);ce.useEffect(()=>{const S=new Set;for(;S.size<2&&S.size<vn.length;)S.add(Math.floor(Math.random()*vn.length));const N=Array.from(S).map(q=>vn[q]);N.length>0&&(y(N[0]),h(N[0])),N.length>1&&f(N[1]),x(Ln(vn))},[]);const A=()=>{const S=U+1;if(C(S),S>=5){const N=!_;w(N),Av(N),C(0)}};return l.jsxs("div",{className:"screen main-menu",children:[l.jsx("h1",{children:"COMPILE: MAIN 1"}),l.jsxs("div",{className:"main-menu-attribution",children:[l.jsxs("p",{children:["based on the card game ",l.jsx("a",{href:"https://boardgamegeek.com/boardgame/406652/compile-main-1",target:"_blank",rel:"noopener noreferrer",children:"Compile: Main 1"})," designed by ",l.jsx("a",{href:"https://justgravyllc.com/",target:"_blank",rel:"noopener noreferrer",children:"Michael Yang"})]}),l.jsxs("p",{children:[l.jsx("span",{onClick:A,style:{cursor:"default",userSelect:"none"},children:"developed"})," by ",l.jsx("a",{href:"https://apo-games.de/",target:"_blank",rel:"noopener noreferrer",children:"Dirk Aporius"})]})]}),l.jsxs("div",{className:"main-menu-layout",children:[l.jsx("div",{className:"main-menu-preview decorative-card",children:m&&l.jsx(Rt,{card:{...m,id:"preview",isFaceUp:!0},isFaceUp:!0})}),l.jsxs("div",{className:"main-menu-actions-container",children:[l.jsxs("div",{className:"main-menu-start-group",children:[l.jsxs("div",{className:"difficulty-selector",children:[l.jsx("h3",{className:"difficulty-title",children:"Difficulty"}),l.jsxs("div",{className:"difficulty-options",children:[l.jsx("button",{className:`btn ${n==="easy"?"active":""}`,onClick:()=>r("easy"),children:"Easy"}),l.jsx("button",{className:`btn ${n==="normal"?"active":""}`,onClick:()=>r("normal"),children:"Normal"}),l.jsx("button",{className:`btn btn-wip ${n==="hard"?"active":""}`,disabled:!0,children:"Hard"})]})]}),l.jsxs("div",{className:"control-mechanic-selector",children:[l.jsx("input",{type:"checkbox",id:"control-mechanic",checked:s,onChange:S=>i(S.target.checked)}),l.jsx("label",{htmlFor:"control-mechanic",children:"Use Control Mechanic"})]}),l.jsx("button",{className:"btn btn-start",onClick:()=>o("ProtocolSelection"),children:"Start Game"})]}),l.jsxs("div",{className:"main-menu-other-actions",children:[l.jsx("button",{className:"btn",onClick:()=>o("CardLibrary"),children:"Cards"}),l.jsx("button",{className:"btn",onClick:()=>o("Statistics"),children:"Statistics"}),_&&l.jsx("button",{className:"btn",onClick:()=>o("CustomProtocols"),children:"Custom Protocols"}),l.jsx("button",{className:"btn",onClick:()=>o("Rules"),children:"Rules"}),l.jsx("p",{className:"version-info",children:"Version 0.26"})]})]}),l.jsx("div",{className:"decorative-card decorative-card-right",children:d&&l.jsx(Rt,{card:{...d,id:"deco-2",isFaceUp:!0},isFaceUp:!0})})]}),l.jsx("div",{className:"card-ticker-container",onPointerLeave:()=>h(p),children:l.jsxs("div",{className:"card-ticker-track",children:[v.map((S,N)=>l.jsx(Rt,{card:{...S,id:`ticker-1-${N}`,isFaceUp:!0},isFaceUp:!0,additionalClassName:"in-hand",onPointerEnter:()=>h(S)},`ticker-1-${N}`)),v.map((S,N)=>l.jsx(Rt,{card:{...S,id:`ticker-2-${N}`,isFaceUp:!0},isFaceUp:!0,additionalClassName:"in-hand",onPointerEnter:()=>h(S)},`ticker-2-${N}`))]})})]})}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function $c({title:o,onBack:n}){return l.jsxs("header",{className:"app-header",children:[l.jsx("h2",{children:o}),n&&l.jsx("button",{className:"btn btn-back",onClick:n,children:"Back"})]})}const jc=[{player:"Player",picks:1},{player:"Opponent",picks:2},{player:"Player",picks:2},{player:"Opponent",picks:1}];function Dv({onBack:o,onStartGame:n}){const[r,s]=ce.useState(0),[i,d]=ce.useState([]),[f,m]=ce.useState([]),[h,p]=ce.useState([]),[y,v]=ce.useState(!1),[x,_]=ce.useState(null),[w,U]=ce.useState(null),[C,A]=ce.useState(0);ce.useEffect(()=>{ir(),A(Y=>Y+1)},[]);const S=ce.useMemo(()=>{const Y=ud(),B=Ho(),J=ma(),ee=new Set(J.filter(ye=>rl(ye)).map(ye=>ye.name)),he=B.filter(ye=>ee.has(ye.protocol)||Y);return console.log("[Protocol Selection] Total cards loaded:",he.length,"(custom enabled:",Y,")"),he},[C]),N=ce.useMemo(()=>{const Y=new Set(S.map(J=>J.protocol)),B=Array.from(Y).sort();return console.log("[Protocol Selection] Unique protocols:",B),B},[S]),q=ce.useMemo(()=>{const Y=new Set(S.map(B=>B.category));return Array.from(Y).sort()},[S]),D=["Fan-Content","Main 2"],[E,j]=ce.useState(new Set),[I,k]=ce.useState(!1);ce.useEffect(()=>{if(q.length>0&&!I){const Y=new Set(q);D.forEach(B=>Y.delete(B)),j(Y),k(!0)}},[q,I]);const L=Y=>{const B=S.find(J=>J.protocol===Y);return(B==null?void 0:B.category)||""},G=Y=>{const J=S.find(ee=>ee.protocol===Y);return J!=null&&J.color?{"--card-custom-color":J.color,borderColor:J.color}:{}},T=Y=>{const J=S.find(ee=>ee.protocol===Y);return J!=null&&J.pattern?`pattern-${J.pattern}`:""},Q=ce.useMemo(()=>N.filter(Y=>{const B=L(Y);return E.has(B)}),[E]),X=Y=>{j(B=>{const J=new Set(B);return J.has(Y)?J.delete(Y):J.add(Y),J})},M=jc[r],$=(M==null?void 0:M.player)==="Player",W=(M==null?void 0:M.player)==="Opponent",P=ce.useMemo(()=>new Set([...i,...f]),[i,f]),ne=ce.useMemo(()=>h.map(Y=>({name:Y,cards:S.filter(B=>B.protocol===Y).sort((B,J)=>B.value-J.value)})),[h]),F=Y=>{if(!$||y)return;const B=S.filter(J=>J.protocol===Y).sort((J,ee)=>J.value-ee.value);B.length>0&&U(B[0]),p(J=>{if(J.includes(Y))return J.filter(ee=>ee!==Y);if(J.length<M.picks)return[...J,Y];if(J.length===M.picks){const ee=J.slice(1);return ee.push(Y),ee}return J})},z=async()=>{if(!$||y||h.length!==M.picks)return;v(!0);const Y=[...h];p([]);for(const B of Y)d(J=>[...J,B]),await new Promise(J=>setTimeout(J,300));v(!1),s(B=>B+1)};ce.useEffect(()=>{W&&!y&&r<jc.length&&(async()=>{v(!0),await new Promise(xe=>setTimeout(xe,100));const B=[],J=N.filter(xe=>{if(P.has(xe))return!1;const Ee=L(xe);return E.has(Ee)}),ee=N.filter(xe=>!P.has(xe)),he=J.length>=M.picks?[...J]:[...ee],ye=[],me=B.filter(xe=>he.includes(xe));for(let xe=0;xe<M.picks;xe++)if(me.length>0){const Ee=me.shift();ye.push(Ee);const Ue=he.indexOf(Ee);Ue>-1&&he.splice(Ue,1)}else if(he.length>0){const Ee=Math.floor(Math.random()*he.length);ye.push(he.splice(Ee,1)[0])}for(const xe of ye)await new Promise(Ee=>setTimeout(Ee,1e3)),_(xe),await new Promise(Ee=>setTimeout(Ee,1e3)),_(null),m(Ee=>[...Ee,xe]);v(!1),s(xe=>xe+1)})()},[r,W,y,P,M,E,N,L]),ce.useEffect(()=>{r>=jc.length&&!y&&setTimeout(()=>{n(i,f)},1e3)},[r,y,n,i,f]);const H=Y=>{const B=["protocol-card",`card-protocol-${Y.toLowerCase()}`];return h.includes(Y)&&B.push("selected"),P.has(Y)&&B.push("chosen"),x===Y&&B.push("is-scanning"),B.join(" ")},V=()=>y&&W?"Opponent is selecting protocols...":(M==null?void 0:M.player)==="Player"?`Player, select ${M.picks} protocol(s). (${h.length}/${M.picks})`:r>=jc.length?"Finalizing selections...":"Waiting for Opponent...";return l.jsxs("div",{className:"screen protocol-selection-screen",children:[l.jsx($c,{title:"Protocol Selection",onBack:o}),l.jsxs("div",{className:"protocol-selection-layout",children:[l.jsxs("div",{className:"protocol-selection-sidebar",children:[l.jsxs("div",{className:"player-protocols-area",children:[l.jsx("h3",{children:"Your Protocols"}),i.map(Y=>l.jsx("div",{className:`protocol-display-card player card-protocol-${Y.toLowerCase()} ${T(Y)}`,style:G(Y),children:Y},Y))]}),l.jsx("div",{className:"protocol-preview-area",children:w?l.jsx(Rt,{card:{...w,id:"preview",isFaceUp:!0},isFaceUp:!0}):l.jsx("p",{children:ne.length>0?"Hover over a card below to see details.":"Select a protocol to see its cards."})})]}),l.jsxs("div",{className:"protocol-grid-container",children:[l.jsx("p",{children:V()}),l.jsx("div",{className:"category-filters",children:q.map(Y=>l.jsxs("label",{className:"category-filter-item",children:[l.jsx("input",{type:"checkbox",checked:E.has(Y),onChange:()=>X(Y)}),l.jsx("span",{children:Y})]},Y))}),l.jsx("div",{className:"protocol-grid-scroll-wrapper",children:l.jsx("div",{className:"protocol-grid",children:Q.map(Y=>{const B=G(Y),ee={fontSize:Y.length>10?"0.65em":"1em"};return l.jsxs("div",{className:`${H(Y)} ${T(Y)}`,style:B,onClick:()=>F(Y),role:"button","aria-disabled":P.has(Y)||!$||y,tabIndex:!P.has(Y)&&$&&!y?0:-1,onKeyPress:he=>he.key==="Enter"&&F(Y),children:[l.jsx("span",{className:"protocol-category-label",children:L(Y)}),l.jsx("span",{className:"protocol-name",style:ee,children:Y})]},Y)})})}),$&&l.jsx("button",{className:"btn",onClick:z,disabled:y||h.length!==(M==null?void 0:M.picks),children:"Confirm Selection"})]}),l.jsxs("div",{className:"opponent-protocols-area",children:[l.jsx("h3",{children:"Opponent Protocols"}),f.map(Y=>l.jsx("div",{className:`protocol-display-card opponent card-protocol-${Y.toLowerCase()} ${T(Y)}`,style:G(Y),children:Y},Y))]})]}),l.jsx("div",{className:"selected-protocol-cards-container",children:ne.length>0&&[...ne].reverse().map(Y=>l.jsx("div",{className:"protocol-card-row",children:Y.cards.map(B=>l.jsx(Rt,{card:{...B,id:`selection-${B.protocol}-${B.value}`,isFaceUp:!0},isFaceUp:!0,additionalClassName:"in-hand",onClick:()=>U(B),onPointerEnter:()=>U(B)},`${Y.name}-${B.value}`))},Y.name))})]})}const Tv="modulepreload",kv=function(o){return"/"+o},lh={},Nv=function(n,r,s){let i=Promise.resolve();if(r&&r.length>0){let f=function(p){return Promise.all(p.map(y=>Promise.resolve(y).then(v=>({status:"fulfilled",value:v}),v=>({status:"rejected",reason:v}))))};document.getElementsByTagName("link");const m=document.querySelector("meta[property=csp-nonce]"),h=(m==null?void 0:m.nonce)||(m==null?void 0:m.getAttribute("nonce"));i=f(r.map(p=>{if(p=kv(p),p in lh)return;lh[p]=!0;const y=p.endsWith(".css"),v=y?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${p}"]${v}`))return;const x=document.createElement("link");if(x.rel=y?"stylesheet":Tv,y||(x.as="script"),x.crossOrigin="",x.href=p,h&&x.setAttribute("nonce",h),document.head.appendChild(x),y)return new Promise((_,w)=>{x.addEventListener("load",_),x.addEventListener("error",()=>w(new Error(`Unable to preload CSS for ${p}`)))})}))}function d(f){const m=new Event("vite:preloadError",{cancelable:!0});if(m.payload=f,window.dispatchEvent(m),!m.defaultPrevented)throw f}return i.then(f=>{for(const m of f||[])m.status==="rejected"&&d(m.reason);return n().catch(d)})},Wt=[];for(let o=0;o<256;++o)Wt.push((o+256).toString(16).slice(1));function Fv(o,n=0){return(Wt[o[n+0]]+Wt[o[n+1]]+Wt[o[n+2]]+Wt[o[n+3]]+"-"+Wt[o[n+4]]+Wt[o[n+5]]+"-"+Wt[o[n+6]]+Wt[o[n+7]]+"-"+Wt[o[n+8]]+Wt[o[n+9]]+"-"+Wt[o[n+10]]+Wt[o[n+11]]+Wt[o[n+12]]+Wt[o[n+13]]+Wt[o[n+14]]+Wt[o[n+15]]).toLowerCase()}let Zs;const qv=new Uint8Array(16);function Uv(){if(!Zs){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Zs=crypto.getRandomValues.bind(crypto)}return Zs(qv)}const $v=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),rh={randomUUID:$v};function Ge(o,n,r){var i;if(rh.randomUUID&&!o)return rh.randomUUID();o=o||{};const s=o.random??((i=o.rng)==null?void 0:i.call(o))??Uv();if(s.length<16)throw new Error("Random bytes length must be >= 16");return s[6]=s[6]&15|64,s[8]=s[8]&63|128,Fv(s)}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const re=(o,n,r,s)=>{let i=o._logIndentLevel||0;o._currentPhaseContext&&i===0&&(i=1);const d={player:n,message:r,indentLevel:i,sourceCard:o._currentEffectSource,phase:o._currentPhaseContext,sourceCardRef:s==null?void 0:s.sourceCardRef,targetCardRefs:s==null?void 0:s.targetCardRefs};return{...o,log:[...o.log,d]}},kn=o=>({...o,_logIndentLevel:(o._logIndentLevel||0)+1}),fo=o=>({...o,_logIndentLevel:Math.max(0,(o._logIndentLevel||0)-1)}),Le=(o,n)=>({...o,_currentEffectSource:n}),Qe=(o,n)=>({...o,_currentPhaseContext:n});/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function Nn(o){const n=[];for(const r of["player","opponent"])o[r].lanes.forEach((s,i)=>{s.forEach((d,f)=>{if(d.isFaceUp){const m=d;if(m.customEffects){const h=f===s.length-1;(m.customEffects.topEffects||[]).forEach(v=>{v.params.action==="passive_rule"&&v.trigger==="passive"&&n.push({rule:v.params.rule,cardOwner:r,laneIndex:i})}),(m.customEffects.middleEffects||[]).forEach(v=>{v.params.action==="passive_rule"&&v.trigger==="passive"&&n.push({rule:v.params.rule,cardOwner:r,laneIndex:i})}),h&&(m.customEffects.bottomEffects||[]).forEach(x=>{x.params.action==="passive_rule"&&x.trigger==="passive"&&n.push({rule:x.params.rule,cardOwner:r,laneIndex:i})})}d.protocol==="Frost"&&d.value===1&&(n.push({rule:{type:"block_flips",target:"all",scope:"global"},cardOwner:r,laneIndex:i}),f===s.length-1&&n.push({rule:{type:"block_protocol_rearrange",target:"all",scope:"global"},cardOwner:r,laneIndex:i})),d.protocol==="Frost"&&d.value===3&&n.push({rule:{type:"block_shifts_from_and_to_lane",target:"all",scope:"this_lane"},cardOwner:r,laneIndex:i})}})});return n}function so(o,n,r,s,i){const d=Nn(o),f=n==="player"?"opponent":"player",m=o[n].protocols[r],h=o[f].protocols[r],p=i===m||i===h;for(const{rule:x,cardOwner:_,laneIndex:w}of d){const U=x.scope==="global"||w===r,C=x.target==="all"||x.target==="self"&&_===n||x.target==="opponent"&&_===f;if(!(!U||!C))switch(x.type){case"block_all_play":return{allowed:!1,reason:"Cannot play cards in this lane (passive rule)"};case"block_face_down_play":if(!s)return{allowed:!1,reason:"Cannot play cards face-down in this lane (passive rule)"};break;case"block_face_up_play":if(s)return{allowed:!1,reason:"Cannot play cards face-up in this lane (passive rule)"};break;case"require_face_down_play":if(s)return{allowed:!1,reason:"Can only play cards face-down (passive rule)"};break;case"allow_any_protocol_play":break;case"require_non_matching_protocol":if(s&&p)return{allowed:!1,reason:"Can only play cards without matching protocols (passive rule)"};break}}const y=d.some(({rule:x,cardOwner:_,laneIndex:w})=>{if(x.type!=="allow_any_protocol_play")return!1;const U=x.scope==="global"||w===r,C=x.target==="all"||x.target==="self"&&_===n||x.target==="opponent"&&_===f;return U&&C}),v=d.some(({rule:x,cardOwner:_,laneIndex:w})=>{if(x.type!=="require_non_matching_protocol")return!1;const U=x.scope==="global"||w===r,C=x.target==="all"||x.target==="self"&&_===n||x.target==="opponent"&&_===f;return U&&C});return s&&!p&&!y&&!v?{allowed:!1,reason:"Face-up play requires matching protocol"}:{allowed:!0}}function Oc(o){return Nn(o).some(({rule:r})=>r.type==="require_non_matching_protocol"&&r.scope==="global")}function Lc(o,n,r){const s=Nn(o),i=n==="player"?"opponent":"player";return s.some(({rule:d,cardOwner:f,laneIndex:m})=>{if(d.type!=="allow_any_protocol_play")return!1;const h=d.scope==="global"||r!==void 0&&m===r,p=d.target==="all"||d.target==="self"&&f===n||d.target==="opponent"&&f===i;return h&&p})}function Ov(o,n){const r=Nn(o);for(const{rule:s,laneIndex:i}of r)if(!(s.type!=="block_flips"||!(s.scope==="global"||i===n)))return{allowed:!1,reason:"Cards cannot be flipped face-up in this lane (passive rule)"};return{allowed:!0}}function Nc(o,n,r){const s=Nn(o);for(const{rule:i,laneIndex:d}of s){if(i.type==="block_shifts_from_lane"&&d===n)return i.scope,{allowed:!1,reason:"Cards cannot shift from this lane (passive rule)"};if(i.type==="block_shifts_to_lane"&&d===r)return i.scope,{allowed:!1,reason:"Cards cannot shift to this lane (passive rule)"};if(i.type==="block_shifts_from_and_to_lane"&&(d===n||d===r))return{allowed:!1,reason:"Cards cannot shift from or to this lane (passive rule)"}}return{allowed:!0}}function Lv(o){const n=Nn(o);for(const{rule:r}of n)if(r.type==="block_protocol_rearrange")return{allowed:!1,reason:"Protocols cannot be rearranged (passive rule)"};return{allowed:!0}}function Mv(o,n){return Nn(o).some(({rule:s,laneIndex:i})=>s.type!=="ignore_middle_commands"?!1:s.scope==="global"||i===n)}function Yn(o){return Nn(o).some(({rule:r})=>r.type==="block_flips"&&r.scope==="global")}function Iv(o){return Nn(o).some(({rule:r})=>r.type==="block_protocol_rearrange")}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Pv={},Hv={},Bv={},zv={};function pr(o,n,r,s){var _,w,U;const{cardOwner:i,opponent:d,triggerType:f}=s,m=r[i].lanes[n];if(!m.find(C=>C.id===o.id))return{newState:r};if(!(m.length>0&&m[m.length-1].id===o.id))return{newState:r};if(Mv(r,n))return{newState:r};const y=o;if(y.customEffects&&y.customEffects.middleEffects&&y.customEffects.middleEffects.length>0){let C=r;(f==="middle"||f==="play")&&(C=kn(C));const A=`${o.protocol}-${o.value}`;C=Le(C,A),C=Qe(C,"middle");let S=C;console.log(`[DEBUG executeOnPlayEffect] Starting effects for ${A}, middleEffects count: ${y.customEffects.middleEffects.length}`),console.log("[DEBUG executeOnPlayEffect] Effects order:",y.customEffects.middleEffects.map((D,E)=>{var j;return`${E}: ${D.id} (${(j=D.params)==null?void 0:j.action})`})),console.log(`[DEBUG executeOnPlayEffect] lastCustomEffectTargetCardId: ${S.lastCustomEffectTargetCardId}`),console.log(`[DEBUG executeOnPlayEffect] _pendingCustomEffects: ${JSON.stringify((w=(_=S._pendingCustomEffects)==null?void 0:_.effects)==null?void 0:w.map(D=>D.id))}`);const N=S._pendingCustomEffects;if(N&&N.sourceCardId!==o.id){console.log(`[effectExecutor] Found pending effects from different card (${N.sourceCardId}), queueing them for later`),console.log("[effectExecutor] Effects to queue:",N.effects.map(j=>j.id));const D=S.lastCustomEffectTargetCardId,E={type:"execute_remaining_custom_effects",sourceCardId:N.sourceCardId,laneIndex:N.laneIndex,effects:N.effects,context:N.context,actor:N.context.cardOwner,selectedCardFromPreviousEffect:D||N.selectedCardFromPreviousEffect};console.log("[effectExecutor] Queued action with selectedCardFromPreviousEffect:",E.selectedCardFromPreviousEffect),S={...S,queuedActions:[...S.queuedActions||[],E]},delete S._pendingCustomEffects}S.lastCustomEffectTargetCardId&&(console.log(`[effectExecutor] Clearing stale lastCustomEffectTargetCardId (${S.lastCustomEffectTargetCardId}) for new card ${A}`),S={...S,lastCustomEffectTargetCardId:null});for(let D=0;D<y.customEffects.middleEffects.length;D++){const E=y.customEffects.middleEffects[D];console.log(`[DEBUG executeOnPlayEffect] Executing effect ${D}: ${E.id} (${(U=E.params)==null?void 0:U.action}) for ${A}`);const j=y.customEffects.middleEffects.slice(D+1);if(j.length>0&&(console.log(`[effectExecutor] Pre-storing ${j.length} pending effects for ${o.protocol}-${o.value} before effect ${D+1}`),S._pendingCustomEffects={sourceCardId:o.id,laneIndex:n,context:s,effects:j}),S=ot(o,n,S,s,E).newState,S.actionRequired)return console.log(`[effectExecutor] actionRequired after effect ${D+1}, remaining effects already stored: ${j.length}`),{newState:_e(S)};S._pendingCustomEffects&&delete S._pendingCustomEffects}return{newState:_e(S)}}const v=`${o.protocol}-${o.value}`,x=Pv[v];if(x){let C=r;(f==="middle"||f==="play")&&(C=kn(C));const A=`${o.protocol}-${o.value}`;C=Le(C,A),C=Qe(C,"middle");const S=x(o,n,C,s);let N=S.newState;const q=_e(N);return{...S,newState:q}}return{newState:r}}function fd(o,n,r,s){var m;if(!o.isFaceUp)return{newState:r};const i=o;if(i.customEffects){const p=[...i.customEffects.topEffects||[],...i.customEffects.middleEffects||[],...i.customEffects.bottomEffects||[]].filter(y=>y.trigger==="on_cover"||y.trigger==="on_cover_or_flip");if(p.length>0){console.log("[DEBUG executeOnCoverEffect] Found",p.length,"on-cover effects for",`${o.protocol}-${o.value}`);const y=`${o.protocol}-${o.value}`;let v=Le(r,y);v=Qe(v,void 0);let x=v;const _=[];for(const C of p){console.log("[DEBUG executeOnCoverEffect] Executing effect:",JSON.stringify(C.params));const A=ot(o,n,x,s,C);if(console.log("[DEBUG executeOnCoverEffect] After executeCustomEffect, actionRequired:",((m=A.newState.actionRequired)==null?void 0:m.type)||"null"),x=A.newState,A.animationRequests&&_.push(...A.animationRequests),x.actionRequired){let S=kn(x);return{newState:_e(S),animationRequests:_.length>0?_:void 0}}}let w=kn(x);return{newState:_e(w),animationRequests:_.length>0?_:void 0}}}const d=`${o.protocol}-${o.value}`,f=zv[d];if(f){const h=`${o.protocol}-${o.value}`;let p=Le(r,h);p=Qe(p,void 0);const y=f(o,n,p,s);let v=kn(y.newState);const x=_e(v);return{...y,newState:x}}return{newState:r}}function Fh(o,n,r){var h;const s=o.turn;let i={...o,_logIndentLevel:0};const d=n==="Start"?i.processedStartEffectIds||[]:i.processedEndEffectIds||[],f=[],m=new Set;i[s].lanes.flat().forEach(p=>{p.isFaceUp&&p.top.includes(`'emphasis'>${n}:`)&&!d.includes(p.id)&&!m.has(p.id)&&(f.push({card:p,box:"top"}),m.add(p.id))}),i[s].lanes.forEach(p=>{if(p.length>0){const y=p[p.length-1];y.isFaceUp&&y.bottom.includes(`'emphasis'>${n}:`)&&!d.includes(y.id)&&!m.has(y.id)&&(f.push({card:y,box:"bottom"}),m.add(y.id))}});for(const{card:p,box:y}of f){const v=i[s].lanes.find(N=>N.some(q=>q.id===p.id));if(!v||!v.some(N=>N.id===p.id&&N.isFaceUp)||y==="bottom"&&!(v[v.length-1].id===p.id))continue;const _=s==="player"?"opponent":"player",w={cardOwner:s,actor:s,currentTurn:o.turn,opponent:_,triggerType:n==="Start"?"start":"end"},U=p,C=n==="Start"?"start":"end";if(U.customEffects){const N=y==="top"?U.customEffects.topEffects:U.customEffects.bottomEffects,q=(N==null?void 0:N.filter(D=>D.trigger===C))||[];if(q.length>0){const D=`${p.protocol}-${p.value}`,E=n==="Start"?"start":"end";i=Le(i,D),i=Qe(i,E);const j={...i,_currentPhaseContext:void 0},I=re(j,s,`${n} effect triggers.`);i={...i,log:I.log},i=kn(i);const k=i[s].lanes.findIndex(G=>G.some(T=>T.id===p.id));for(let G=0;G<q.length;G++){const T=q[G];console.log("[effectExecutor] Executing custom effect:",T.id,"hasConditional:",!!T.conditional,"conditionalType:",(h=T.conditional)==null?void 0:h.type);const Q=ot(p,k,i,w,T);if(i=_e(Q.newState),i.actionRequired){const X=q.slice(G+1);X.length>0&&(i._pendingCustomEffects={sourceCardId:p.id,laneIndex:k,context:w,effects:X});const M=n==="Start"?"processedStartEffectIds":"processedEndEffectIds";return i[M]=[...i[M]||[],p.id],{newState:i}}}const L=n==="Start"?"processedStartEffectIds":"processedEndEffectIds";i[L]=[...i[L]||[],p.id],i=fo(i),i=Le(i,void 0),i=Qe(i,void 0);continue}}const A=`${p.protocol}-${p.value}`,S=r[A];if(S){const N=`${p.protocol}-${p.value}`,q=n==="Start"?"start":"end";i=Le(i,N),i=Qe(i,q);const D={...i,_currentPhaseContext:void 0},E=re(D,s,`${n} effect triggers.`);i={...i,log:E.log},i=kn(i);const j=S(p,i,w);i=_e(j.newState);const I=n==="Start"?"processedStartEffectIds":"processedEndEffectIds";if(i[I]=[...i[I]||[],p.id],i.actionRequired)return{newState:i};i=fo(i),i=Le(i,void 0),i=Qe(i,void 0)}}return{newState:i}}function qh(o){return Fh(o,"Start",Hv)}function Vv(o){return Fh(o,"End",Bv)}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Gv=o=>{if(!o.useControlMechanic)return o;const n=o.turn,r=n==="player"?"opponent":"player",s=o[n],i=o[r];let d=0;const f=s.laneValues[0],m=s.laneValues[1],h=s.laneValues[2],p=i.laneValues[0],y=i.laneValues[1],v=i.laneValues[2];if(f>p&&d++,m>y&&d++,h>v&&d++,d>=2&&o.controlCardHolder!==n){let x=Le(o,void 0);return x=Qe(x,void 0),x={...x,_logIndentLevel:0},x=re(x,n,`${n==="player"?"Player":"Opponent"} gains the Control Component.`),{...x,controlCardHolder:n}}return o},cl=o=>{if(o.winner)return o;const n=o.turn;let r={...o};switch(r=Le(r,void 0),r=Qe(r,void 0),r={...r,_logIndentLevel:0},o.phase){case"start":return r=qh(r).newState,r.actionRequired?r:(r=Le(r,void 0),r=Qe(r,void 0),r={...r,_logIndentLevel:0},{...r,phase:"control"});case"control":{const s=Gv(r);let i=Le(s,void 0);return i=Qe(i,void 0),i={...i,_logIndentLevel:0},{...i,phase:"compile"}}case"compile":{const s=Mh(r,n);return s.length>0?{...r,compilableLanes:s}:(r=Le(r,void 0),r=Qe(r,void 0),r={...r,_logIndentLevel:0},{...r,phase:"action",compilableLanes:[]})}case"action":return r=Le(r,void 0),r=Qe(r,void 0),r={...r,_logIndentLevel:0},{...r,phase:"hand_limit"};case"hand_limit":{const s=r[n],i=s.lanes.some(m=>m.length>0&&m[m.length-1].isFaceUp&&m[m.length-1].protocol==="Spirit"&&m[m.length-1].value===0),f=Nn(r).some(({rule:m,cardOwner:h})=>m.type==="skip_check_cache_phase"&&(m.target==="self"&&h===n||m.target==="all")&&h===n);if(i||f){let m=re(r,n,"Skipping Check Cache phase.");return m=Le(m,void 0),m=Qe(m,void 0),m={...m,_logIndentLevel:0},{...m,phase:"end"}}if(s.hand.length>5){const m=s.hand.length-5;let p=re(r,n,`Check Cache: ${n==="player"?"Player":"Opponent"} has ${s.hand.length} cards, must discard ${m}.`);return p=kn(p),{...p,actionRequired:{type:"discard",actor:n,count:m}}}return r=Le(r,void 0),r=Qe(r,void 0),r={...r,_logIndentLevel:0},{...r,phase:"end"}}case"end":{const s={...r};r=Vv(r).newState;const i=s.actionRequired,d=r.actionRequired;if(d&&d!==i||r.queuedActions&&r.queuedActions.length>0&&(r=dr(r),r.actionRequired))return r;const f=n==="player"?"opponent":"player",m={...r[n],cannotCompile:!1};return r=Le(r,void 0),r=Qe(r,void 0),r={...r,_logIndentLevel:0},r=_e(r),{...r,[n]:m,turn:f,phase:"start",processedStartEffectIds:[],processedEndEffectIds:[],processedSpeed1TriggerThisTurn:!1,processedUncoverEventIds:[],_interruptedTurn:void 0,_interruptedPhase:void 0}}}return o};function Ye(o){const n=o._pendingCustomEffects;if(!n||n.effects.length===0)return o;const r={type:"execute_remaining_custom_effects",sourceCardId:n.sourceCardId,laneIndex:n.laneIndex,effects:n.effects,context:n.context,actor:n.context.cardOwner,selectedCardFromPreviousEffect:n.selectedCardFromPreviousEffect},s={...o,queuedActions:[...o.queuedActions||[],r]};return delete s._pendingCustomEffects,s}const po=o=>{var s;let n=Ye(o);if(!n.queuedActions||n.queuedActions.length===0)return n;let r=[...n.queuedActions];for(;r.length>0;){const i=r.shift();if(i.sourceCardId&&i.type!=="flip_self"){const d=ve(n,i.sourceCardId);if(!d||!d.card.isFaceUp){const f=d?`${d.card.protocol}-${d.card.value}`:"a card",m=n._logSource;n=Le(n,f),n=re(n,i.actor,"Queued effect was cancelled because the source is no longer active."),n=Le(n,m);continue}}if(i.type==="flip_self"){const{sourceCardId:d,actor:f}=i,m=ve(n,d),h=uo(n,d);if(m&&m.card.isFaceUp&&h){const p=`${m.card.protocol}-${m.card.value}`;n=re(n,f,`${p}: Flips itself.`),n=ha(new Set([d]),n),n.animationState={type:"flipCard",cardId:d}}else{const p=m?`${m.card.protocol}-${m.card.value}`:"the source card",y=m?m.card.isFaceUp?"now covered":"flipped face-down":"deleted";n=re(n,f,`The self-flip effect from ${p} was cancelled because it is ${y}.`)}continue}if(i.type==="execute_follow_up_effect"){const{sourceCardId:d,followUpEffect:f,actor:m}=i,h=ve(n,d),p=uo(n,d);if(h&&h.card.isFaceUp&&p){const y=n[h.owner].lanes.find(w=>w.some(U=>U.id===d)),v=n[h.owner].lanes.indexOf(y),x={cardOwner:h.owner,actor:m,currentTurn:n.turn,opponent:h.owner==="player"?"opponent":"player"};if(console.log(`[execute_follow_up_effect] Executing queued followUpEffect: ${f.id} for ${h.card.protocol}-${h.card.value}`),n=ot(h.card,v,n,x,f).newState,n.actionRequired)return n={...n,queuedActions:r},n}else{const y=h?`${h.card.protocol}-${h.card.value}`:"the source card",v=h?h.card.isFaceUp?"now covered":"flipped face-down":"deleted";n=re(n,m,`The follow-up effect from ${y} was cancelled because it is ${v}.`)}continue}if(i.type==="execute_remaining_custom_effects"){const{sourceCardId:d,laneIndex:f,effects:m,context:h,selectedCardFromPreviousEffect:p}=i;console.log(`[DEBUG execute_remaining_custom_effects] Processing queue action with ${m==null?void 0:m.length} effects:`,m==null?void 0:m.map(x=>x.id));const y=ve(n,d);if(!y){n=re(n,h.cardOwner,"Remaining effects cancelled because the source card was deleted or returned.");continue}if(!y.card.isFaceUp){const x=`${y.card.protocol}-${y.card.value}`;n=re(n,h.cardOwner,`Remaining effects from ${x} cancelled because it was flipped face-down.`);continue}if(!uo(n,d)){const x=`${y.card.protocol}-${y.card.value}`;n=re(n,h.cardOwner,`Remaining effects from ${x} cancelled because it is now covered.`);continue}p&&(n._selectedCardFromPreviousEffect=p,n.lastCustomEffectTargetCardId=p);for(let x=0;x<m.length;x++){const _=m[x];console.log(`[DEBUG execute_remaining_custom_effects] Executing effect ${x}: ${_.id} (${(s=_.params)==null?void 0:s.action})`);const w=ot(y.card,f,n,h,_);if(n=w.newState,w.animationRequests&&w.animationRequests.length>0&&!n.actionRequired){console.log(`[execute_remaining_custom_effects] Effect ${x+1} has ${w.animationRequests.length} animations - stopping to show them`);const U=m.slice(x+1);if(U.length>0){const A={type:"execute_remaining_custom_effects",sourceCardId:d,laneIndex:f,effects:U,context:h,actor:h.cardOwner};n.queuedActions=[A,...r||[]]}else n.queuedActions=r;const C=w.animationRequests[0];return C.type==="draw"?n.animationState={type:"drawCard",owner:C.player,cardIds:[]}:C.type==="play"?n.animationState={type:"playCard",cardId:C.cardId,owner:C.owner}:C.type==="delete"&&(n.animationState={type:"deleteCard",cardId:C.cardId,owner:C.owner}),n}if(n.actionRequired){const U=m.slice(x+1);if(U.length>0&&(console.log(`[processQueuedActions] Stopping at effect ${x+1}/${m.length}, ${U.length} effects remaining`),n._pendingCustomEffects={sourceCardId:d,laneIndex:f,context:h,effects:U}),n._interruptedTurn){const C=n._interruptedTurn,A=n._interruptedPhase||n.phase;delete n._interruptedTurn,delete n._interruptedPhase,n.turn=C,n.phase=A}return n.queuedActions=r,n}}continue}if(i.type==="reveal_opponent_hand"){const d=n.turn==="player"?"opponent":"player",f={...n[d]};if(f.hand.length>0){f.hand=f.hand.map(p=>({...p,isRevealed:!0})),n[d]=f;const m=ve(n,i.sourceCardId),h=m?`${m.card.protocol}-${m.card.value}`:"A card effect";n=re(n,n.turn,`${h}: Opponent reveals their hand.`)}else{const m=ve(n,i.sourceCardId),h=m?`${m.card.protocol}-${m.card.value}`:"A card effect";n=re(n,n.turn,`${h}: Opponent has no cards to reveal.`)}continue}if(i.type==="pending_uncover_effect"){const{owner:d,laneIndex:f}=i;if(console.log(`[pending_uncover_effect] Processing uncover for ${d} in lane ${f}`),n=_n(n,d,f).newState,n.actionRequired)return n.queuedActions=r,n;continue}return n.actionRequired=i,n.queuedActions=r,n}return{...n,queuedActions:[],actionRequired:null}},dr=o=>{var i;if(o.winner||o.actionRequired)return o;if(o.queuedActions&&o.queuedActions.length>0){const d=po(o);if(d.actionRequired)return d;o=d}if(o._interruptedTurn){const d=o._interruptedTurn,f=o._interruptedPhase||o.phase;let m={...o};if(delete m._interruptedTurn,delete m._interruptedPhase,m.turn=d,m.phase=f,f==="start"||f==="end"){if(m.queuedActions&&m.queuedActions.length>0&&(m=po(m)),!m.actionRequired&&f==="end"){const h=m.turn==="player"?"opponent":"player",p={...m[m.turn],cannotCompile:!1};return m=Le(m,void 0),m=Qe(m,void 0),m={...m,_logIndentLevel:0},{...m,[m.turn]:p,turn:h,phase:"start",processedStartEffectIds:[],processedEndEffectIds:[],processedSpeed1TriggerThisTurn:!1,processedUncoverEventIds:[],_interruptedTurn:void 0,_interruptedPhase:void 0}}return m}o=m}if(((i=o.actionRequired)==null?void 0:i.type)==="prompt_rearrange_protocols"&&o.actionRequired.originalAction){console.log("[DEBUG processEndOfAction] FALLBACK HANDLER TRIGGERED - This should NOT happen if resolveRearrangeProtocols was called!"),console.log("[DEBUG processEndOfAction] originalAction:",o.actionRequired.originalAction);const d=o.actionRequired.originalAction;let f={...o,actionRequired:null,controlCardHolder:null};if(d.type==="compile")return ur(f);if(d.type==="fill_hand"){console.log("[DEBUG processEndOfAction] Using fallback drawForPlayer, hand before:",f[f.turn].hand.length);const m=ga(f,f.turn,5-f[f.turn].hand.length);return console.log("[DEBUG processEndOfAction] After fallback drawForPlayer, hand:",m[m.turn].hand.length),ur(m)}}if(o.queuedEffect){const{card:d,laneIndex:f}=o.queuedEffect,m={...o,queuedEffect:void 0},h=ve(m,d.id);if(h){const{card:p,owner:y}=h,v={cardOwner:y,actor:y,currentTurn:m.turn,opponent:y==="player"?"opponent":"player",triggerType:"play"},{newState:x}=pr(p,f,m,v);if(x.actionRequired)return x;o=x}else console.warn(`Skipping queued effect for ${d.protocol}-${d.value} as it is no longer on the board.`),o=re(o,o.turn,`Skipping queued effect for ${d.protocol}-${d.value} as it is no longer on the board.`),o=m}if(o.queuedActions&&o.queuedActions.length>0){let d={...o},f=[...d.queuedActions];for(;f.length>0;){const m=f.shift(),h=m.type==="flip_self";if(m.sourceCardId&&!h){const p=ve(d,m.sourceCardId);if(!p||!p.card.isFaceUp){const y=p?`${p.card.protocol}-${p.card.value}`:"a card",v=d._logSource;d=Le(d,y),d=re(d,m.actor,"Queued effect was cancelled because the source is no longer active."),d=Le(d,v);continue}}if(h){const{sourceCardId:p,actor:y}=m,v=ve(d,p),x=uo(d,p);if(v&&v.card.isFaceUp&&x){const _=`${v.card.protocol}-${v.card.value}`;d=re(d,y,`${_}: Flips itself.`),d=ha(new Set([p]),d),d.animationState={type:"flipCard",cardId:p}}else{const _=v?`${v.card.protocol}-${v.card.value}`:"the source card",w=v?v.card.isFaceUp?"now covered":"flipped face-down":"deleted";d=re(d,y,`The self-flip effect from ${_} was cancelled because it is ${w}.`)}continue}if(m.type==="reveal_opponent_hand"){const p=d.turn==="player"?"opponent":"player",y={...d[p]};if(y.hand.length>0){y.hand=y.hand.map(_=>({..._,isRevealed:!0})),d[p]=y;const v=ve(d,m.sourceCardId),x=v?`${v.card.protocol}-${v.card.value}`:"A card effect";d=re(d,d.turn,`${x}: Opponent reveals their hand.`)}else{const v=ve(d,m.sourceCardId),x=v?`${v.card.protocol}-${v.card.value}`:"A card effect";d=re(d,d.turn,`${x}: Opponent has no cards to reveal.`)}continue}return d.actionRequired=m,d.queuedActions=f,d}o={...d,queuedActions:[],actionRequired:null}}const n=o.phase==="action"?"hand_limit":o.phase;let r={...o,phase:n,compilableLanes:[],processedUncoverEventIds:[]};const s=o.turn;for(;r.turn===s&&!r.winner;){const d=r.actionRequired,f=r.phase;r=cl(r);const m=r.actionRequired;if(m&&m!==d)break;if(r.phase===f&&r.turn===s){console.error("Game is stuck in a phase loop:",r.phase);break}}return r},ur=o=>{if(o.winner)return o;let n={...o};if(n._interruptedTurn){const s=n._interruptedTurn,i=n._interruptedPhase||n.phase;delete n._interruptedTurn,delete n._interruptedPhase,n.turn=s,n.phase=i}const r=n.turn;for(;n.turn===r&&!n.actionRequired&&!n.winner;){const s=n.phase;if(s==="action")break;if(s==="compile"){const d=Mh(n,r);if(d.length>0){n={...n,compilableLanes:d};break}}const i=n.phase;if(n=cl(n),i===n.phase&&!n.actionRequired){console.error("Game is stuck in an automatic phase loop:",i),console.error("State:",{phase:n.phase,turn:n.turn,actionRequired:n.actionRequired,queuedActions:n.queuedActions,interruptedTurn:n._interruptedTurn});break}}return n},Uh=o=>{var i,d;console.log("[continueTurnAfterStartPhaseAction] Called with phase:",o.phase,"turn:",o.turn);let n={...o,actionRequired:null};if(n.queuedActions&&n.queuedActions.length>0){console.log("[continueTurnAfterStartPhaseAction] Processing queuedActions:",n.queuedActions.length);const f=po(n);if(f.actionRequired)return console.log("[continueTurnAfterStartPhaseAction] queuedActions created actionRequired:",f.actionRequired.type),f;n=f}const r=qh(n).newState;if(console.log("[continueTurnAfterStartPhaseAction] After executeStartPhaseEffects, actionRequired:",(i=r.actionRequired)==null?void 0:i.type),r.actionRequired)return console.log("[continueTurnAfterStartPhaseAction] Returning early due to actionRequired"),r;let s=r;return s.phase!=="control"&&(s={...s,phase:"control"}),console.log("[continueTurnAfterStartPhaseAction] Phase set to control, advancing..."),s=cl(s),console.log("[continueTurnAfterStartPhaseAction] After first advancePhase, phase:",s.phase,"actionRequired:",(d=s.actionRequired)==null?void 0:d.type),s.actionRequired||(s=cl(s),console.log("[continueTurnAfterStartPhaseAction] After second advancePhase, phase:",s.phase,"turn:",s.turn)),s},$h=o=>{if(o.winner)return o;let n={...o,phase:"start"};return n=cl(n),n.actionRequired?n:ur(n)},ch=Object.freeze(Object.defineProperty({__proto__:null,advancePhase:cl,continueTurnAfterStartPhaseAction:Uh,continueTurnProgression:ur,processEndOfAction:dr,processQueuedActions:po,processStartOfTurn:$h,queuePendingCustomEffects:Ye},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function ve(o,n){if(!n)return null;for(const r of["player","opponent"])for(let s=0;s<o[r].lanes.length;s++){const d=o[r].lanes[s].find(f=>f.id===n);if(d)return{card:d,owner:r,laneIndex:s}}return null}function uo(o,n){if(!n)return!1;for(const r of["player","opponent"])for(const s of o[r].lanes)if(s.length>0&&s[s.length-1].id===n)return!0;return!1}function Yv(o,n,r){var m;let s={...o};const i=(m=o.actionRequired)==null?void 0:m.followUpEffect,d=ve(s,n),f=d?Mn(d.card,s[d.owner].lanes.find(h=>h.some(p=>p.id===n))||[]):0;if(s=Ye(s),s.actionRequired=null,i&&r){const h=ve(s,r);if(h){console.log("[Custom Effect] Executing conditional follow-up effect after flip");const p={cardOwner:h.owner,opponent:h.owner==="player"?"opponent":"player",currentTurn:s.turn,actor:h.owner,referencedCard:d==null?void 0:d.card,referencedCardValue:f};console.log(`[Context Propagation] Flipped card ${d==null?void 0:d.card.protocol}-${d==null?void 0:d.card.value}, value: ${f}`);let y=-1;for(let v=0;v<s[h.owner].lanes.length;v++)if(s[h.owner].lanes[v].some(x=>x.id===r)){y=v;break}if(y!==-1)return ot(h.card,y,s,p,i).newState}}return s}function Oh(o,n,r,s){var _,w,U,C,A;let i={...o};const d=(_=o.actionRequired)==null?void 0:_.followUpEffect,f=(w=o.actionRequired)==null?void 0:w.conditionalType;if(i=Ye(i),i.actionRequired=null,s&&(i=fo(i)),d&&s){const S=ve(i,s);if(S){const N=((U=o.actionRequired)==null?void 0:U.previousHandSize)||0,q=i[n].hand.length,D=Math.max(0,N-q);if(!(f==="then"||f==="if_executed"&&D>0))return console.log(`[Custom Effect] Skipping follow-up effect - conditional type: ${f}, discarded: ${D}`),i;console.log(`[Custom Effect] Executing conditional follow-up effect after discard (type: ${f})`);const j={cardOwner:S.owner,opponent:S.owner==="player"?"opponent":"player",currentTurn:i.turn,actor:n,discardedCount:D,previousHandSize:N};console.log(`[Context Propagation] Discarded ${D} cards, previousHandSize: ${N}`);let I=-1;for(let k=0;k<i[S.owner].lanes.length;k++)if(i[S.owner].lanes[k].some(L=>L.id===s)){I=k;break}if(I!==-1)return ot(S.card,I,i,j,d).newState}return i}if(!r||!s)return i;const m=((C=o.actionRequired)==null?void 0:C.previousHandSize)||0,h=i[n].hand.length;if(Math.max(0,m-h)===0)return console.log(`[Fire Effect] Skipping chained effect for ${r} - no cards were discarded (previousHandSize: ${m}, currentHandSize: ${h})`),i;const y=(A=ve(i,s))==null?void 0:A.card;y&&`${y.protocol}${y.value}`;const v=i.queuedActions&&i.queuedActions.length>0;let x=null;switch(r){case"fire_1":x={type:"select_cards_to_delete",count:1,sourceCardId:s,disallowedIds:[s],actor:n};break;case"fire_2":x={type:"select_card_to_return",sourceCardId:s,actor:n};break;case"fire_3":x={type:"select_card_to_flip",sourceCardId:s,actor:n,targetFilter:{position:"uncovered",excludeSelf:!0}};break}if(x)if(v){const S=i.queuedActions||[],N=S.filter(D=>D.type==="select_card_to_shift"&&D.followUpEffect),q=S.filter(D=>!(D.type==="select_card_to_shift"&&D.followUpEffect));i.queuedActions=[...q,x,...N]}else i.actionRequired=x;return i}function od(o,n,r=null){const s=ve(o,n);if(!s)return o;const{card:i,owner:d}=s;if(!i.isFaceUp){let C=-1;for(let A=0;A<o[d].lanes.length;A++)if(o[d].lanes[A].some(S=>S.id===n)){C=A;break}if(C!==-1){const A=Ov(o,C);if(!A.allowed)return console.log(`Flip blocked: ${A.reason}`),o}}let m=Dt(o,"on_flip",{player:d,cardId:n}).newState;if(!ve(m,n))return console.log(`[on_flip] Card ${i.protocol}-${i.value} no longer exists after on_flip effect`),m;const p=m.actionRequired&&"actor"in m.actionRequired?m.actionRequired.actor:m.turn,y=p==="player"?"Player":"Opponent",v=d==="player"?"Player's":"Opponent's",x=i.isFaceUp?"face-down":"face-up",_=`${i.protocol}-${i.value}`;m=re(m,p,`${y} flips ${v} ${_} ${x}.`);const w={...m.stats[p],cardsFlipped:m.stats[p].cardsFlipped+1},U={...m[p],stats:w};return m={...m,[p]:U,stats:{...m.stats,[p]:w}},m=ha(new Set([n]),m),m.animationState={type:"flipCard",cardId:n},m.actionRequired=r,m}function _n(o,n,r){var f;const s=o[n].lanes[r];if(s.length===0)return{newState:o};const i=s[s.length-1],d=uo(o,i.id);if(i.isFaceUp&&d){const m=`${i.id}-${r}`;if(console.log("[UNCOVER] Checking eventId:",m,"processedUncoverEventIds:",o.processedUncoverEventIds),(f=o.processedUncoverEventIds)!=null&&f.includes(m))return console.log("[UNCOVER] SKIPPING - already processed"),{newState:o};console.log("[UNCOVER] PROCESSING - not yet in list");const h=`${i.protocol}-${i.value}`;let p=Le(o,h);p=Qe(p,"uncover"),p=re(p,n,`${i.protocol}-${i.value} is uncovered and its effects are re-triggered.`),p=kn(p),p.processedUncoverEventIds=[...p.processedUncoverEventIds||[],m];const y={cardOwner:n,actor:n,currentTurn:p.turn,opponent:n==="player"?"opponent":"player",triggerType:"uncover"},v=pr(i,r,p,y);if(v.newState.actionRequired||(v.newState=fo(v.newState),v.newState=Le(v.newState,void 0),v.newState=Qe(v.newState,void 0)),v.newState.actionRequired){const x=v.newState.actionRequired.actor;if(o._interruptedTurn&&x===o._interruptedTurn){const _=v.newState.actionRequired;return v.newState.actionRequired=null,v.newState.queuedActions=[...v.newState.queuedActions||[],_],v.newState=Ye(v.newState),v}v.newState=Ye(v.newState),x!==o.turn&&(v.newState._interruptedTurn=o.turn,v.newState._interruptedPhase=o.phase,v.newState.turn=x,v.newState.actionRequired.type==="prompt_rearrange_protocols"&&(v.newState.actionRequired={...v.newState.actionRequired,originalAction:{type:"resume_interrupted_turn",interruptedTurn:o.turn,interruptedPhase:o.phase}}))}else v.newState._interruptedTurn&&(v.newState.turn=v.newState._interruptedTurn,v.newState._interruptedTurn=void 0);return v}return{newState:o}}function ad(o,n){const r=ve(o,n);if(!r)return{newState:o};const{card:s,owner:i}=r,d=o[i].lanes.findIndex(U=>U.some(C=>C.id===s.id));if(d===-1)return{newState:o};const f=o[i].lanes[d],m=f.length>0&&f[f.length-1].id===n;let h={...o};const p={...h[i]};p.lanes=p.lanes.map(U=>U.filter(C=>C.id!==n)),p.hand=[...p.hand,{...s,isFaceUp:!0,isRevealed:!1}],h[i]=p;const y=h.actionRequired&&"actor"in h.actionRequired?h.actionRequired.actor:h.turn,v=y==="player"?"Player":"Opponent",x=i==="player"?"Player's":"Opponent's",_=`${s.protocol}-${s.value}`;h=re(h,y,`${v} returns ${x} ${_} to their hand.`),h=Ye(h),h.actionRequired=null;const w=_e(h);return m&&w[i].lanes[d].length>0?_n(w,i,d):{newState:w}}function fa(o,n,r,s,i){var X;console.log("[DEBUG internalShiftCard] Attempting to shift card",n,"to lane",s,"owner:",r);const d=ve(o,n);if(!d||d.owner!==r)return{newState:o};const{card:f}=d,m=o[r];let h=-1;for(let M=0;M<m.lanes.length;M++)if(m.lanes[M].some($=>$.id===n)){h=M;break}if(h===-1)return{newState:o};if(h===s)return console.log("[DEBUG internalShiftCard] Cannot shift to same lane, skipping"),{newState:o};console.log("[DEBUG internalShiftCard] Shifting from lane",h,"to lane",s);const p=Nc(o,h,s);if(!p.allowed)return console.log(`[SHIFT BLOCKED] ${p.reason}`),{newState:o};const y=o[r].lanes[h],v=y.length>0&&y[y.length-1].id===n,x=m.lanes.map((M,$)=>$===h?M.filter(W=>W.id!==n):M),_=x[s].length>0?x[s][x[s].length-1]:null;console.log("[DEBUG internalShiftCard] Card to be covered:",_?`${_.protocol}-${_.value} (faceUp: ${_.isFaceUp})`:"null"),console.log("[DEBUG internalShiftCard] Target lane has",x[s].length,"cards before shift");const w=x.map((M,$)=>$===s?[...M,f]:M),U={...m,lanes:w};let C={...o,[r]:U};(!o._currentEffectSource||!o._currentPhaseContext)&&(C=Le(C,void 0),C=Qe(C,void 0));const A=i==="player"?"Player":"Opponent",S=r==="player"?"Player's":"Opponent's",N=f.isFaceUp?`${f.protocol}-${f.value}`:"a card",q=C[r].protocols[s];C=re(C,i,`${A} shifts ${S} ${N} to Protocol ${q}.`);const D={...C.stats[i],cardsShifted:C.stats[i].cardsShifted+1},E={...C[i],stats:D};C={...C,[i]:E,stats:{...C.stats,[i]:D}},C=Ye(C),C.actionRequired=null;let j=_e(C),I={newState:j};if(_){console.log("[DEBUG internalShiftCard] Executing on-cover effect for",`${_.protocol}-${_.value}`),console.log("[DEBUG internalShiftCard] cardToBeCovered has customEffects?",!!_.customEffects),_.customEffects&&console.log("[DEBUG internalShiftCard] bottomEffects:",JSON.stringify(_.customEffects.bottomEffects));const M={cardOwner:r,actor:i,currentTurn:j.turn,opponent:r==="player"?"opponent":"player",triggerType:"cover"};I=fd(_,s,j,M),console.log("[DEBUG internalShiftCard] After executeOnCoverEffect, actionRequired:",((X=I.newState.actionRequired)==null?void 0:X.type)||"null")}let k=I.newState,L=[...I.animationRequests||[]];if(v){const M=_n(k,r,h);k=M.newState,M.animationRequests&&L.push(...M.animationRequests)}const G=k[r].lanes[s],T=G.length>0&&G[G.length-1].id===n,Q=!v;if(T&&f.isFaceUp&&Q){const M=_n(k,r,s);return M.animationRequests&&L.push(...M.animationRequests),{newState:M.newState,animationRequests:L.length>0?L:void 0}}return{newState:k,animationRequests:L.length>0?L:void 0}}const Wv=(o,n,r)=>{let s=0;for(const i of["player","opponent"])for(let d=0;d<o[i].lanes.length;d++){const f=o[i].lanes[d];if(f.length>0){const m=f[f.length-1];n.includes(m.id)||s++}}return s},ld=(o,n)=>{const r=ve(o,n);if(!r)return{newState:o};const{card:s,owner:i}=r,d=o[i].lanes.findIndex(h=>h.some(p=>p.id===s.id));if(d===-1)return{newState:o};const f={cardOwner:i,actor:i,currentTurn:o.turn,opponent:i==="player"?"opponent":"player",triggerType:"flip"},m=pr(s,d,o,f);if(m.newState.actionRequired){m.newState=Ye(m.newState);const h=m.newState.actionRequired.actor;if(o._interruptedTurn&&h===o._interruptedTurn)return m.newState.queuedActions=[...m.newState.queuedActions||[],m.newState.actionRequired],m.newState=Ye(m.newState),m.newState.actionRequired=null,m;h!==o.turn&&(m.newState._interruptedTurn=o.turn,m.newState._interruptedPhase=o.phase,m.newState.turn=h,m.newState.actionRequired.type==="prompt_rearrange_protocols"&&(m.newState.actionRequired={...m.newState.actionRequired,originalAction:{type:"resume_interrupted_turn",interruptedTurn:o.turn,interruptedPhase:o.phase}}))}return m};function Qv(o,n){const r=[];if(o[n].lanes.forEach((i,d)=>{if(i.length>0){const f=i[i.length-1],m=Mn(f,i);r.push({card:f,laneIndex:d,owner:n,value:m})}}),r.length===0)return[];const s=Math.max(...r.map(i=>i.value));return r.filter(i=>i.value===s)}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Draw Effect Executor
 *
 * Handles all draw-related effects.
 * Extracted 1:1 from effectInterpreter.ts for modularity.
 */function ih(o,n,r){const s=Math.min(r,o.length),i=o.slice(0,s).map(m=>({...m,id:Ge(),isFaceUp:!0})),d=[...n,...i],f=o.slice(s);return{drawnCards:d,remainingDeck:f,newCards:i}}function Xv(o,n,r,s,i){var S,N,q,D;const{cardOwner:d}=s,m=(i.target||"self")==="opponent"?s.opponent:d;if(i.conditional){let E=0;switch(i.conditional.type){case"non_matching_protocols":{for(let $=0;$<3;$++){const W=r.player.protocols[$],P=r.opponent.protocols[$],ne=r.player.lanes[$].filter(V=>V.isFaceUp),F=r.opponent.lanes[$].filter(V=>V.isFaceUp);[...ne,...F].some(V=>V.protocol!==W&&V.protocol!==P)&&E++}console.log(`[Draw Effect] non_matching_protocols: ${E} lanes have non-matching face-up cards`);break}case"count_face_down":{let $=0;for(const W of["player","opponent"])for(const P of r[W].lanes)$+=P.filter(ne=>!ne.isFaceUp).length;E=$,console.log(`[Draw Effect] count_face_down: ${E} face-down cards on entire board`);break}case"is_covering":{const $=r[d].lanes[n],W=$.length>1;E=W?i.count||1:0,console.log(`[Draw Effect] is_covering: ${W?"yes":"no"} (lane has ${$.length} cards)`);break}}let j=E;if(j<=0)return console.log(`[Draw Effect] Conditional count is ${j}, skipping draw`),{newState:r};const{drawnCards:I,remainingDeck:k,newCards:L}=ih(r[m].deck,r[m].hand,j);let G={...r};G[m]={...G[m],deck:k,hand:I};const T=m==="player"?"Player":"Opponent";let Q="";switch(i.conditional.type){case"non_matching_protocols":Q=" from non-matching protocols";break;case"is_covering":Q=" (this card is covering another)";break;case"count_face_down":Q=" (for face-down cards)";break;default:Q=""}const X=L.length>0&&m==="player"?` (${L.map($=>`${$.protocol}-${$.value}`).join(", ")})`:"";G=re(G,m,`${T} draws ${j} card${j!==1?"s":""}${Q}${X}.`),j>0&&(G=Dt(G,"after_draw",{player:m}).newState);const M=j>0?[{type:"draw",player:m,count:j}]:void 0;return{newState:G,animationRequests:M}}let h=i.count||1;switch(i.countType||"fixed"){case"equal_to_card_value":{const E=r.lastCustomEffectTargetCardId;if(console.log("[Draw Effect - Light-0 DEBUG] Starting equal_to_card_value check"),console.log(`[Draw Effect - Light-0 DEBUG] lastCustomEffectTargetCardId: ${E}`),console.log("[Draw Effect - Light-0 DEBUG] Full state keys:",Object.keys(r)),console.log("[Draw Effect - Light-0 DEBUG] actionRequired:",(S=r.actionRequired)==null?void 0:S.type),E){const j=ve(r,E);if(console.log("[Draw Effect - Light-0 DEBUG] findCardOnBoard result:",j?`${j.card.protocol}-${j.card.value}`:"null"),j){const I=j.owner,k=r[I].lanes.find(L=>L.some(G=>G.id===E))||[];h=Mn(j.card,k),console.log(`[Draw Effect] Using referenced card value: ${h} from card ${j.card.protocol}-${j.card.value}`)}else{h=0;let I=re(r,d,"Cannot draw cards - referenced card is no longer on board (was returned/deleted).");return console.log("[Draw Effect] Referenced card not found on board - was likely returned/deleted by its own effect. Skipping draw."),{newState:I}}}else h=s.referencedCardValue||0,console.log(`[Draw Effect - Light-0 DEBUG] No lastCustomEffectTargetCardId, using context.referencedCardValue: ${h}`);break}case"equal_to_discarded":h=(s.discardedCount||0)+(i.countOffset||0),console.log(`[Draw Effect] Using discarded count: ${s.discardedCount} + offset ${i.countOffset} = ${h}`);break;case"hand_size":case"previous_hand_size":h=s.previousHandSize||s.handSize||0,console.log(`[Draw Effect] Using previous hand size: ${h}`);break;case"count_face_down":{let E=0;for(const j of["player","opponent"])for(const I of r[j].lanes)E+=I.filter(k=>!k.isFaceUp).length;h=E*(i.count||1),console.log(`[Draw Effect] count_face_down: ${E} face-down cards on board, drawing ${h} cards`);break}case"fixed":default:h=i.count||1;break}if(h<=0)return console.log(`[Draw Effect] Count is ${h}, skipping draw`),console.log(`[Draw Effect DEBUG] Returning state - turn: ${r.turn}, phase: ${r.phase}, actionRequired: ${((N=r.actionRequired)==null?void 0:N.type)||"null"}`),{newState:r};if(((q=i.advancedConditional)==null?void 0:q.type)==="protocol_match"){const E=i.advancedConditional.protocol,j=r[d].protocols[n];if(j!==E)return console.log(`[Draw Effect] Protocol match failed: card is in ${j} lane, requires ${E}. Skipping draw.`),{newState:r};console.log(`[Draw Effect] Protocol match success: card is in ${j} lane (requires ${E}).`)}let y={...r};if(((D=i.advancedConditional)==null?void 0:D.type)==="compile_block"){const E=i.advancedConditional.turnDuration||1,j=d==="player"?"opponent":"player";y={...y,compileBlockedUntilTurn:(y.turnNumber||0)+E,compileBlockedPlayer:j},console.log(`[Draw Effect] Opponent's compile blocked for ${E} turn(s).`),y=re(y,d,`Opponent can't compile for ${E} turn${E!==1?"s":""}.`)}if(i.optional)return console.log("[Draw Effect] Creating prompt_optional_draw for optional draw, card:",o.protocol,"-",o.value),y.actionRequired={type:"prompt_optional_draw",sourceCardId:o.id,actor:d,count:h,drawingPlayer:m},{newState:y};const v=i.source||"own_deck",x=v==="opponent_deck"?s.opponent:m,{drawnCards:_,remainingDeck:w,newCards:U}=ih(y[x].deck,y[m].hand,h);y[x]={...y[x],deck:w},y[m]={...y[m],hand:_};const C=m==="player"?"Player":"Opponent",A=U.length>0&&m==="player"?` (${U.map(E=>`${E.protocol}-${E.value}`).join(", ")})`:"";if(v==="opponent_deck"){const E=x==="player"?"Player's":"Opponent's";y=re(y,m,`${C} draws the top ${h===1?"card":`${h} cards`} of ${E} deck${A}.`)}else y=re(y,m,`${C} draws ${h} card${h!==1?"s":""}${A}.`);return _.length>0&&(y=Dt(y,"after_draw",{player:m,count:_.length}).newState),{newState:y}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Flip Effect Executor
 *
 * Handles all flip-related effects.
 * Extracted 1:1 from effectInterpreter.ts for modularity.
 */function Zv(o,n,r,s,i){var C,A;const{cardOwner:d}=s;if(console.log("[DEBUG executeFlipEffect] Called with params:",JSON.stringify(i)),console.log("[DEBUG executeFlipEffect] card:",`${o.protocol}-${o.value}`,"laneIndex:",n,"cardOwner:",d),i.useCardFromPreviousEffect&&r.lastCustomEffectTargetCardId){const S=r.lastCustomEffectTargetCardId,N=ve(r,S);if(!N)return{newState:re(r,d,"Target card from previous effect no longer exists. Flip skipped.")};let q={...r};const D=N.owner,E=q[D].lanes.findIndex(j=>j.some(I=>I.id===S));if(E!==-1){const I=q[D].lanes[E].find(k=>k.id===S);if(I){I.isFaceUp=!I.isFaceUp;const k=I.isFaceUp?"face-up":"face-down";q=re(q,d,`Flips that card ${k}.`)}}return{newState:q}}if(i.scope==="each_lane"){const S=i.targetFilter||{},N=Yn(r),q=k=>{const L=r.player.lanes[k],G=r.opponent.lanes[k];let T=[];if(S.position==="covered"?T=[...L.filter((X,M)=>M<L.length-1),...G.filter((X,M)=>M<G.length-1)]:T=[...L,...G],S.owner==="own")T=T.filter(X=>L.includes(X)&&d==="player"||G.includes(X)&&d==="opponent");else if(S.owner==="opponent"){const X=d==="player"?"opponent":"player";T=T.filter(M=>L.includes(M)&&X==="player"||G.includes(M)&&X==="opponent")}return S.excludeSelf&&(T=T.filter(X=>X.id!==o.id)),(N?T.filter(X=>X.isFaceUp):T).length>0},D=[0,1,2].filter(k=>q(k));if(D.length===0){let k=re(r,d,N?"No valid face-up targets to flip (Frost-1 is active).":"No valid targets to flip in any lane.");return k._effectSkippedNoTargets=!0,{newState:k}}const E=D[0],j=D.slice(1);let I={...r};return I.actionRequired={type:"select_card_to_flip",sourceCardId:o.id,actor:d,currentLaneIndex:E,remainingLanes:j,targetFilter:i.targetFilter,params:i},{newState:I}}if(i.flipSelf){if(console.log("[DEBUG executeFlipEffect] flipSelf mode - card:",`${o.protocol}-${o.value}`,"laneIndex:",n,"cardOwner:",d),console.log("[DEBUG executeFlipEffect] Lanes:",r[d].lanes.map((D,E)=>`Lane ${E}: ${D.map(j=>j.id.substring(0,8)).join(", ")}`)),console.log("[DEBUG executeFlipEffect] Looking for card.id:",o.id),((C=i.advancedConditional)==null?void 0:C.type)==="protocol_match"){const D=i.advancedConditional.protocol,E=r[d].protocols[n];if(E!==D)return console.log(`[Flip Effect] Protocol match failed: card is in ${E} lane, requires ${D}. Skipping flip.`),{newState:r};console.log(`[Flip Effect] Protocol match success: card is in ${E} lane (requires ${D}).`)}let S={...r};const N=S[d].lanes[n],q=N.find(D=>D.id===o.id);if(console.log("[DEBUG executeFlipEffect] cardInLane found?",!!q,"lane length:",N.length),q){q.isFaceUp=!q.isFaceUp;const D=d==="player"?"Player":"Opponent",E=q.isFaceUp?"face-up":"face-down";S=re(S,d,`${D} flips this card ${E}.`),console.log("[DEBUG executeFlipEffect] Flipped card to",E)}else console.log("[DEBUG executeFlipEffect] Card NOT found in lane! Lane cards:",N.map(D=>D.id));return{newState:S}}const f=i.count||1,m=((A=i.scope)==null?void 0:A.type)||i.scope||"anywhere",h=f==="all"||typeof f!="number",p=m==="this_lane"&&h,y=m==="anywhere"&&h;if(p||y){let S={...r};const N=d==="player"?"opponent":"player",q=i.targetFilter||{},D=Yn(r),E=new Set,j=y?[0,1,2]:[n];for(const I of j){const k=S[d].lanes[I];for(const G of k){if(q.excludeSelf&&G.id===o.id||q.faceState==="face_up"&&!G.isFaceUp||q.faceState==="face_down"&&G.isFaceUp||q.owner==="opponent")continue;const T=k.indexOf(G)===k.length-1;q.position==="uncovered"&&!T||q.position==="covered"&&T||y&&!q.position&&!T||D&&!G.isFaceUp||E.add(G.id)}const L=S[N].lanes[I];for(const G of L){if(q.faceState==="face_up"&&!G.isFaceUp||q.faceState==="face_down"&&G.isFaceUp||q.owner==="own")continue;const T=L.indexOf(G)===L.length-1;q.position==="uncovered"&&!T||q.position==="covered"&&T||y&&!q.position&&!T||D&&!G.isFaceUp||E.add(G.id)}}if(E.size>0){const I=y?"":" in this lane";S=re(S,d,`Flipping ${E.size} card(s)${I}.`);for(const k of E)for(const L of["player","opponent"])for(const G of S[L].lanes){const T=G.find(Q=>Q.id===k);T&&(T.isFaceUp=!T.isFaceUp)}return{newState:S}}else return S=re(S,d,`No cards to flip${y?"":" in this lane"}.`),{newState:S}}const v=i.targetFilter||{},x=v.position||"uncovered",_=Yn(r),w=[];for(const S of["player","opponent"])for(let N=0;N<r[S].lanes.length;N++){const q=r[S].lanes[N];if(!(i.scope==="this_lane"&&N!==n))for(let D=0;D<q.length;D++){const E=q[D],j=D===q.length-1;v.excludeSelf&&E.id===o.id||v.owner==="own"&&S!==d||v.owner==="opponent"&&S===d||x==="uncovered"&&!j||x==="covered"&&j||v.faceState==="face_up"&&!E.isFaceUp||v.faceState==="face_down"&&E.isFaceUp||_&&!E.isFaceUp||w.push(E.id)}}if(w.length===0){let S=re(r,d,"No valid cards to flip. Effect skipped.");return S._effectSkippedNoTargets=!0,{newState:S}}let U={...r};return U.actionRequired={type:"select_card_to_flip",count:f,sourceCardId:o.id,actor:d,targetFilter:i.targetFilter,optional:i.optional||!1,scope:i.scope,laneIndex:i.scope==="this_lane"?n:void 0},{newState:U}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Delete Effect Executor
 *
 * Handles all delete-related effects.
 * Extracted 1:1 from effectInterpreter.ts for modularity.
 */function Kv(o,n,r,s,i){var U,C,A,S,N,q,D;const{cardOwner:d}=s;let f=i.count||1;if(i.useCardFromPreviousEffect&&r.lastCustomEffectTargetCardId){const E=r.lastCustomEffectTargetCardId,j=ve(r,E);if(!j)return{newState:re(r,d,"Target card from previous effect no longer exists. Delete skipped.")};let I={...r};const k=j.owner,L=I[k].lanes.findIndex(G=>G.some(T=>T.id===E));if(L!==-1){const G=[...I[k].lanes[L]],T=G.findIndex(Q=>Q.id===E);if(T!==-1){const Q=T===G.length-1;G.splice(T,1);const X=[...I[k].lanes];X[L]=G,I={...I,[k]:{...I[k],lanes:X}};const M=j.card.isFaceUp?`${j.card.protocol}-${j.card.value}`:"that card";I=re(I,d,`Deletes ${M}.`);const $={...I.stats[d],cardsDeleted:I.stats[d].cardsDeleted+1};I={...I,stats:{...I.stats,[d]:$}};const W=s.triggerType==="cover"||s.triggerType==="on_cover";return Q&&G.length>0&&!W&&(I=_n(I,k,L).newState),{newState:I,animationRequests:[{type:"delete",cardId:E,owner:k}]}}}return{newState:I}}if((U=i.scope)!=null&&U.minCardsInLane){const E=i.scope.minCardsInLane,j=((C=r.player.lanes[n])==null?void 0:C.length)||0,I=((A=r.opponent.lanes[n])==null?void 0:A.length)||0,k=j+I;if(k<E)return console.log(`[Delete Effect] Line filter not met: ${k} < ${E} cards in lane. Skipping delete.`),{newState:r};console.log(`[Delete Effect] Line filter met: ${k} >= ${E} cards in lane.`)}const m=i.actorChooses||"effect_owner",h=((S=i.targetFilter)==null?void 0:S.owner)||"any";let p=d;m==="card_owner"&&h==="opponent"&&(p=s.opponent);const y=i.targetFilter||{},v=y.position||"uncovered",x=[];for(const E of["player","opponent"])for(let j=0;j<r[E].lanes.length;j++){if(((N=i.scope)==null?void 0:N.type)==="this_line"&&j!==n)continue;const I=r[E].lanes[j];for(let k=0;k<I.length;k++){const L=I[k],G=k===I.length-1;if(!(i.excludeSelf&&L.id===o.id)&&!(y.owner==="own"&&E!==d)&&!(y.owner==="opponent"&&E===d)&&!(v==="uncovered"&&!G)&&!(v==="covered"&&G)){if(v==="covered_by_context"&&s.triggerType==="cover"){if(E!==s.cardOwner&&G)continue}else if(v==="covered_by_context"&&G)continue;if(!(y.faceState==="face_up"&&!L.isFaceUp)&&!(y.faceState==="face_down"&&L.isFaceUp)){if(y.valueRange){const{min:T,max:Q}=y.valueRange;if(L.value<T||L.value>Q)continue}if(i.protocolMatching){const T=r.player.protocols[j],Q=r.opponent.protocols[j],X=L.protocol,M=X===T||X===Q;if(i.protocolMatching==="must_match"&&!M||i.protocolMatching==="must_not_match"&&M)continue}x.push(L.id)}}}}if(x.length===0){let E=re(r,d,"No valid cards to delete. Effect skipped.");return E._effectSkippedNoTargets=!0,{newState:E}}if(i.upTo){const E=f;if(f=Math.min(f,x.length),console.log(`[Delete Effect] upTo mode: requesting ${E}, adjusted to ${f} (available targets: ${x.length})`),f===0)return{newState:re(r,d,"No valid targets available. Delete effect skipped.")}}let _=x;if(y.calculation==="highest_value"||y.calculation==="lowest_value"){const E=new Map;for(const k of x){const L=ve(r,k);if(!L)continue;let G=-1;for(let Q=0;Q<r[L.owner].lanes.length;Q++)if(r[L.owner].lanes[Q].some(X=>X.id===k)){G=Q;break}let T=L.card.value;!L.card.isFaceUp&&G!==-1&&(T=r[L.owner].lanes[G].some(X=>X.isFaceUp&&X.protocol==="Darkness"&&X.value===2)?4:2),E.set(k,T)}const j=Array.from(E.values()),I=y.calculation==="highest_value"?Math.max(...j):Math.min(...j);_=x.filter(k=>E.get(k)===I),console.log(`[Delete Effect] Filtered by ${y.calculation}: ${_.length} card(s) with value ${I}`)}if(i.autoExecute){console.log(`[Delete Effect] Auto-executing delete for ${_.length} card(s)`);const E=_.slice(0,f);let j=r;const I=[];for(const k of E){const L=ve(j,k);if(!L)continue;const{card:G,owner:T}=L;let Q=-1;for(let V=0;V<j[T].lanes.length;V++)if(j[T].lanes[V].some(Y=>Y.id===k)){Q=V;break}if(Q===-1)continue;const X=j[T].lanes[Q],M=X[X.length-1].id===k,$=G.isFaceUp?`${G.protocol}-${G.value}`:"a face-down card";j=re(j,d,`Effect triggers, deleting the lowest value covered card (${T==="player"?"Player's":"Opponent's"} ${$}).`);const P=[...X],ne=P.findIndex(V=>V.id===k);P.splice(ne,1);const F=[...j[T].lanes];F[Q]=P,j={...j,[T]:{...j[T],lanes:F}};const z={...j.stats[d],cardsDeleted:j.stats[d].cardsDeleted+1};j={...j,stats:{...j.stats,[d]:z}},I.push({type:"delete",cardId:k,owner:T});const H=s.triggerType==="cover"||s.triggerType==="on_cover";M&&P.length>0&&!H&&(j=_n(j,T,Q).newState)}return{newState:j,animationRequests:I}}let w={...r};if(i.deleteSelf){console.log(`[deleteSelf] Trying to delete card ${o.protocol}-${o.value} (id: ${o.id}), laneIndex from params: ${n}`);const E=d,j=r[E].lanes[n];if(console.log(`[deleteSelf] owner=${E}, laneIndex=${n}, lane.length=${j==null?void 0:j.length}`),!j||j.length===0)return console.log(`[deleteSelf] Lane is ${j?"empty":"null"}! Skipping delete.`),w=re(w,d,"Card already deleted. Delete effect skipped."),{newState:w};const I=j.findIndex(W=>W.id===o.id);if(I===-1)return console.log(`[deleteSelf] Card not found in lane ${n}!`),w=re(w,d,"Card already deleted. Delete effect skipped."),{newState:w};const k=r[E].lanes[n],L=k.length>0&&k[k.length-1].id===o.id;console.log(`[deleteSelf] Card is ${L?"TOP":"COVERED"} card in CURRENT lane (length=${k.length}), cardIndex=${I}`),w=re(w,d,`Deleting ${o.protocol}-${o.value}.`);const G=[...k],T=G.findIndex(W=>W.id===o.id);if(T===-1)return console.log("[deleteSelf] Card no longer in lane! Already deleted or moved."),{newState:w};console.log(`[deleteSelf] Removing card at index ${T} from lane`),G.splice(T,1);const Q=[...w[E].lanes];Q[n]=G,w={...w,[E]:{...w[E],lanes:Q}};const X={...w.stats[d],cardsDeleted:w.stats[d].cardsDeleted+1};w={...w,stats:{...w.stats,[d]:X}};const M=[{type:"delete",cardId:o.id,owner:E}],$=s.triggerType==="cover"||s.triggerType==="on_cover";if(L&&G.length>0&&!$){const W=_n(w,E,n);w=W.newState,W.animationRequests&&M.push(...W.animationRequests)}return{newState:w,animationRequests:M}}if(i.selectLane)return w.actionRequired={type:"select_lane_for_delete",sourceCardId:o.id,actor:p,count:i.count,targetFilter:i.targetFilter,deleteAll:i.count==="all"||i.count===void 0},{newState:w};if(((q=i.scope)==null?void 0:q.type)==="each_lane"){const E=L=>{for(const G of["player","opponent"]){const T=r[G].lanes[L];for(let Q=0;Q<T.length;Q++){const X=T[Q],M=Q===T.length-1;if(!(i.excludeSelf&&X.id===o.id)&&!(y.owner==="own"&&G!==p)&&!(y.owner==="opponent"&&G===p)&&!(v==="uncovered"&&!M)&&!(v==="covered"&&M)&&!(y.faceState==="face_up"&&!X.isFaceUp)&&!(y.faceState==="face_down"&&X.isFaceUp))return!0}}return!1},j=[0,1,2].filter(L=>E(L));if(j.length===0)return w=re(w,d,"No valid targets to delete in any lane."),w._effectSkippedNoTargets=!0,{newState:w};const I=j[0],k=j.slice(1);return w.actionRequired={type:"select_cards_to_delete",count:f,sourceCardId:o.id,actor:p,currentLaneIndex:I,remainingLanes:k,disallowedIds:i.excludeSelf?[o.id]:[],targetFilter:i.targetFilter,scope:i.scope,protocolMatching:i.protocolMatching,params:i},{newState:w}}if(((D=i.scope)==null?void 0:D.type)==="each_other_line"){const I=[0,1,2].filter(k=>k!==n).filter(k=>r.player.lanes[k].length>0||r.opponent.lanes[k].length>0).length;return I===0?(w=re(w,d,"No other lanes have cards. Effect skipped."),{newState:w}):(w.actionRequired={type:"select_card_from_other_lanes_to_delete",sourceCardId:o.id,disallowedLaneIndex:n,lanesSelected:[],count:I,actor:p,targetFilter:i.targetFilter},{newState:w})}return w.actionRequired={type:"select_cards_to_delete",count:f,sourceCardId:o.id,actor:p,actorChooses:m,disallowedIds:i.excludeSelf?[o.id]:[],allowedIds:_.length<x.length?_:void 0,targetFilter:i.targetFilter,scope:i.scope,protocolMatching:i.protocolMatching},{newState:w}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Discard Effect Executor
 *
 * Handles all discard-related effects.
 * Extracted 1:1 from effectInterpreter.ts for modularity.
 */function Jv(o,n,r,s,i){const{cardOwner:d}=s,f=i.actor==="opponent"?s.opponent:d;let m=i.count||1;if((i.countType||"fixed")==="equal_to_discarded"){const x=(s.discardedCount||0)+(i.countOffset||0);if(m=Math.min(x,r[f].hand.length),console.log(`[Discard Effect] Using dynamic count: ${s.discardedCount} + ${i.countOffset} = ${x}, limited to hand size: ${m}`),m<=0)return console.log("[Discard Effect] Dynamic count is 0 or less, skipping discard."),{newState:r}}if(r[f].hand.length===0){console.log(`[Discard Effect] ${f} has no cards to discard - skipping effect.`);let _=re(r,f,`${f==="player"?"Player":"Opponent"} has no cards to discard - effect skipped.`);return _._effectSkippedNoTargets=!0,_._discardContext={discardedCount:0},{newState:_}}if(i.upTo){const x=m;m=Math.min(m,r[f].hand.length),console.log(`[Discard Effect] upTo mode: requesting ${x}, adjusted to ${m} (hand size: ${r[f].hand.length})`)}const p=m;typeof m=="number"&&m>r[f].hand.length&&(console.log(`[Discard Effect] Count ${m} exceeds hand size ${r[f].hand.length}, limiting.`),m=r[f].hand.length);const y=!i.upTo&&typeof p=="number"&&p>m;if(m==="all"){console.log(`[Discard Effect] Auto-discarding entire hand for ${f}`);const x=r[f].hand,_=x.map(({id:q,isFaceUp:D,...E})=>E),w=[],U=[...r[f].discard,..._],C={...r[f].stats,cardsDiscarded:r[f].stats.cardsDiscarded+_.length},A={...r[f],hand:w,discard:U,stats:C};let S={...r,[f]:A,stats:{...r.stats,[f]:C}};const N=f==="player"?"Player":"Opponent";if(f==="player"||_.every(q=>q.isRevealed)){const q=_.map(D=>`${D.protocol}-${D.value}`).join(", ");S=re(S,f,`${N} discards entire hand (${_.length} cards: ${q}).`)}else S=re(S,f,`${N} discards entire hand (${_.length} cards).`);return S._discardContext={actor:f,discardedCount:_.length,previousHandSize:x.length,sourceCardId:o.id},{newState:S}}let v={...r};return y&&(v=re(v,f,`${f==="player"?"Player":"Opponent"} only has ${m} card${m!==1?"s":""} (${p} required) - discarding all.`)),v.actionRequired={type:"discard",actor:f,count:m,sourceCardId:o.id,variableCount:i.variableCount||!1,previousHandSize:r[f].hand.length},{newState:v}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Shift Effect Executor
 *
 * Handles all shift-related effects.
 * Extracted 1:1 from effectInterpreter.ts for modularity.
 */function e_(o,n,r,s,i){const{cardOwner:d}=s;let f={...r};if(console.log(`[DEBUG executeShiftEffect] Called for ${o.protocol}-${o.value}`),console.log(`[DEBUG executeShiftEffect] params.useCardFromPreviousEffect: ${i.useCardFromPreviousEffect}`),console.log(`[DEBUG executeShiftEffect] state.lastCustomEffectTargetCardId: ${r.lastCustomEffectTargetCardId}`),i.useCardFromPreviousEffect&&r.lastCustomEffectTargetCardId){console.log("[DEBUG executeShiftEffect] TAKING lastCustomEffectTargetCardId PATH!");const E=r.lastCustomEffectTargetCardId,j=ve(r,E);if(!j)return{newState:re(r,d,"Target card from previous effect no longer exists. Shift skipped.")};const I=i.destinationRestriction;if((I==null?void 0:I.type)==="to_this_lane"){const L=I.laneIndex==="current"?n:I.laneIndex;if(L===void 0||L<0||L>2)return console.error(`[Shift Effect] Invalid target lane index: ${L}`),{newState:r};console.log(`[Custom Shift with useCardFromPreviousEffect] Executing immediate shift to lane ${L}`);const G=fa(r,E,j.owner,L,d);return{newState:G.newState,animationRequests:G.animationRequests}}let k=-1;for(let L=0;L<r[j.owner].lanes.length;L++)if(r[j.owner].lanes[L].some(G=>G.id===E)){k=L;break}return k===-1?{newState:r}:(f.actionRequired={type:"select_lane_for_shift",cardToShiftId:E,cardOwner:j.owner,originalLaneIndex:k,sourceCardId:o.id,actor:d,destinationRestriction:I},{newState:f})}const m=r._selectedCardFromPreviousEffect;if(f._selectedCardFromPreviousEffect&&delete f._selectedCardFromPreviousEffect,m&&i.useCardFromPreviousEffect){const E=i.destinationRestriction;if((E==null?void 0:E.type)==="to_this_lane"){const j=E.laneIndex==="current"?n:E.laneIndex;if(j===void 0||j<0||j>2)return console.error(`[Shift Effect] Invalid target lane index: ${j}`),{newState:f};const I=ve(f,m);if(!I)return console.error(`[Shift Effect] Selected card not found: ${m}`),{newState:f};console.log(`[Custom Shift] Executing immediate shift to lane ${j}`);const k=fa(f,m,I.owner,j,d);return{newState:k.newState,animationRequests:k.animationRequests}}return f.actionRequired={type:"shift_flipped_card_optional",cardId:m,sourceCardId:o.id,optional:i.optional||!1,actor:d},{newState:f}}if(i.shiftSelf)return console.log("[DEBUG shiftExecutor] shiftSelf path - creating actionRequired"),f.actionRequired={type:"shift_flipped_card_optional",cardId:o.id,sourceCardId:o.id,optional:i.optional||!1,actor:d,allowCovered:i.allowCoveredSelf||!1},console.log("[DEBUG shiftExecutor] Created actionRequired:",JSON.stringify(f.actionRequired,null,2)),{newState:f};const h=i.targetFilter||{},p=h.position||"uncovered",y=h.faceState||"any",v=h.owner||"any",x=h.excludeSelf||!1,_=i.count||1;if(p==="any"&&v==="own"&&!x&&_===1)return f.actionRequired={type:"shift_flipped_card_optional",cardId:o.id,sourceCardId:o.id,optional:i.optional||!1,actor:d},{newState:f};const U=[];console.log(`[Shift Effect DEBUG] cardOwner: ${d}, ownerFilter: ${v}, position: ${p}, faceState: ${y}, excludeSelf: ${x}`),console.log(`[Shift Effect DEBUG] Source card: ${o.protocol}-${o.value} (id: ${o.id})`);for(const E of["player","opponent"])if(!(v==="own"&&E!==d)&&!(v==="opponent"&&E===d))for(let j=0;j<f[E].lanes.length;j++){if(i.scope==="this_lane"&&j!==n)continue;const I=f[E].lanes[j];for(let k=0;k<I.length;k++){const L=I[k];if(x&&L.id===o.id)continue;const G=k===I.length-1;p==="uncovered"&&!G||p==="covered"&&G||y==="face_up"&&!L.isFaceUp||y==="face_down"&&L.isFaceUp||(console.log(`[Shift Effect DEBUG] Found potential target: ${L.protocol}-${L.value} in lane ${j} (owner: ${E})`),U.push({card:L,currentLane:j,owner:E}))}}if(console.log(`[Shift Effect DEBUG] Total potential targets: ${U.length}`),U.length===0)return f=re(f,d,"No valid cards to shift."),f._effectSkippedNoTargets=!0,{newState:f};if((_==="all"||typeof _!="number"&&_!==1)&&U.length>0){const E=[],j=i.destinationRestriction;for(let I=0;I<3;I++){if((j==null?void 0:j.type)==="to_another_line"){if(I===n)continue}else if((j==null?void 0:j.type)==="to_this_lane"){const k=j.laneIndex==="current"?n:j.laneIndex;if(I!==k)continue}else if(!j&&I===n)continue;E.push(I)}return E.length===0?(f=re(f,d,"No valid destination lanes for shifting all cards."),{newState:f}):(f=re(f,d,`Shifting ${U.length} card(s) from this lane.`),f.actionRequired={type:"select_lane_for_shift_all",sourceCardId:o.id,actor:d,cardsToShift:U.map(I=>({cardId:I.card.id,owner:I.owner})),validDestinationLanes:E,sourceLaneIndex:n},{newState:f})}const A=i.destinationRestriction;let S=!1;const N=(A==null?void 0:A.laneIndex)==="current"?n:A==null?void 0:A.laneIndex;for(const{card:E,currentLane:j,owner:I}of U){if((A==null?void 0:A.type)==="non_matching_protocol"&&!E.isFaceUp)continue;const k=E.protocol;for(let L=0;L<3;L++){if(A){if(A.type==="non_matching_protocol"){if(L===j)continue;const G=f.player.protocols[L],T=f.opponent.protocols[L];if(k===G||k===T)continue}else if(A.type==="specific_lane"){if(L!==j)continue}else if(A.type==="to_this_lane"){if(L!==N||j===N)continue}else if(A.type==="to_another_line"&&L===j)continue}else if(L===j)continue;S=!0;break}if(S)break}if(!S)return f=re(f,d,"No valid shift destinations available."),{newState:f};const q=A&&N!==void 0?{...A,laneIndex:N}:A,D=(A==null?void 0:A.type)==="to_this_lane"&&N!==void 0?N:void 0;return f.actionRequired={type:"select_card_to_shift",sourceCardId:o.id,actor:d,targetFilter:i.targetFilter,destinationRestriction:q,sourceLaneIndex:n,targetLaneIndex:D},{newState:f}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Return Effect Executor
 *
 * Handles all return-related effects.
 * Extracted 1:1 from effectInterpreter.ts for modularity.
 */function t_(o,n,r,s,i){var x,_;const{cardOwner:d,opponent:f}=s;i.count==="all"||i.count;const m=((x=i.targetFilter)==null?void 0:x.owner)||"any",h=((_=i.targetFilter)==null?void 0:_.position)||"uncovered";if(i.selectLane){let w={...r};return w.actionRequired={type:"select_lane_for_return",sourceCardId:o.id,actor:d,count:i.count,targetFilter:i.targetFilter},{newState:w}}let p=[];const y=w=>{for(const U of r[w].lanes)for(let C=0;C<U.length;C++){const A=C===U.length-1;h==="uncovered"&&!A||h==="covered"&&A||p.push({card:U[C],isUncovered:A})}};if(m==="own"?y(d):m==="opponent"?y(f):(y("player"),y("opponent")),p.length===0)return{newState:re(r,d,"No cards on board to return. Effect skipped.")};let v={...r};return v.actionRequired={type:"select_card_to_return",sourceCardId:o.id,actor:d,targetOwner:m,targetFilter:i.targetFilter},{newState:v}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Play Effect Executor
 *
 * Handles all play-related effects (play cards from hand/deck to board).
 * Extracted 1:1 from effectInterpreter.ts for modularity.
 */function n_(o,n,r,s,i){var _,w,U,C,A,S,N;const{cardOwner:d,opponent:f}=s,m=i.count||1,h=i.source||"hand",p=i.faceDown,y=i.actor==="opponent"?f:d;if(h==="deck"&&((_=i.destinationRule)==null?void 0:_.type)==="each_other_line"){const q=[0,1,2].filter(M=>M!==n);if(q.length===0)return{newState:r};const D=r[y];if(D.deck.length===0&&D.discard.length===0)return{newState:re(r,d,`[Custom Play effect] ${y} has no cards in deck/discard - skipping.`)};const{drawnCards:E,remainingDeck:j,newDiscard:I}=Tn(D.deck,D.discard,q.length);if(E.length===0)return{newState:r};const k=E.map(M=>({...M,id:Ge(),isFaceUp:!1})),L=[...D.lanes];for(let M=0;M<k.length;M++){const $=q[M];L[$]=[...L[$],k[M]]}const G={...D,lanes:L,deck:j,discard:I};let T={...r,[y]:G};const Q=ve(r,o.id),X=Q?`${Q.card.protocol}-${Q.card.value}`:"a card effect";return T=re(T,d,`${X}: Plays ${E.length} card(s) face-down in other lines.`),{newState:T}}if(h==="deck"&&((w=i.destinationRule)==null?void 0:w.type)==="each_line_with_card"){const q=i.destinationRule.ownerFilter||"any",D=q==="own"?y:q==="opponent"?y==="player"?"opponent":"player":null,E=[];for(let H=0;H<3;H++)D?r[D].lanes[H].length>0&&E.push(H):(r.player.lanes[H].length>0||r.opponent.lanes[H].length>0)&&E.push(H);if(E.length===0)return{newState:r};const j=r[y];if(j.deck.length===0&&j.discard.length===0)return{newState:re(r,d,`[Custom Play effect] ${y} has no cards in deck/discard - skipping.`)};const{drawnCards:I,remainingDeck:k,newDiscard:L}=Tn(j.deck,j.discard,E.length);if(I.length===0)return{newState:r};const G=I.map(H=>({...H,id:Ge(),isFaceUp:!p}));let T=r;const Q=[];for(let H=0;H<E.length;H++){const V=E[H],Y=T[y].lanes[V];if(Y.length>0){const B=Y[Y.length-1],J={...s,triggerType:"cover"},ee=fd(B,V,T,J);if(T=ee.newState,ee.animationRequests&&Q.push(...ee.animationRequests),T.actionRequired)break}}const X=[...T[y].lanes],M=[];for(let H=0;H<G.length;H++){const V=E[H];X[V]=[...X[V],G[H]],M.push({type:"play",cardId:G[H].id,owner:y})}const $={...T[y],lanes:X,deck:k,discard:L};let W={...T,[y]:$};const P=ve(r,o.id),ne=P?`${P.card.protocol}-${P.card.value}`:"a card effect",F=q==="own"?"where you have a card":q==="opponent"?"where opponent has a card":"with a card";W=re(W,d,`${ne}: Plays ${I.length} card(s) face-down in each line ${F}.`);const z=[...Q,...M];return{newState:W,animationRequests:z.length>0?z:void 0}}if(h==="deck"&&((U=i.destinationRule)==null?void 0:U.type)==="another_line"){console.log(`[another_line] Life-3 triggered! laneIndex=${n}, source=${h}`);const q=[0,1,2].filter(E=>E!==n);if(console.log(`[another_line] Other lane indices: ${q}`),q.length===0)return console.log("[another_line] No other lanes available!"),{newState:r};let D=re(r,d,"[Custom Play effect - select another line to play]");return D.actionRequired={type:"select_lane_for_play",sourceCardId:o.id,actor:y,count:i.count||1,isFaceDown:i.faceDown,excludeCurrentLane:!0,currentLaneIndex:n,source:i.source},console.log("[another_line] Created prompt for user to select lane"),{newState:D}}if(h==="deck"&&((C=i.destinationRule)==null?void 0:C.type)==="under_this_card"&&((A=i.condition)==null?void 0:A.type)==="per_x_cards_in_line"){const q=i.condition.cardCount||2,D=r[d].lanes[n].length,E=r[f].lanes[n].length,j=D+E,I=Math.floor(j/q);if(I===0)return{newState:r};const k=r[y];if(k.deck.length===0&&k.discard.length===0)return{newState:r};const{drawnCards:L,remainingDeck:G,newDiscard:T}=Tn(k.deck,k.discard,I);if(L.length===0)return{newState:r};const Q=L.map(F=>({...F,id:Ge(),isFaceUp:!1})),X=[...k.lanes[n]];X.splice(X.length-1,0,...Q);const M=[...k.lanes];M[n]=X;const $={...k,lanes:M,deck:G,discard:T};let W={...r,[y]:$};const P=ve(r,o.id),ne=P?`${P.card.protocol}-${P.card.value}`:"a card effect";return W=re(W,d,`${ne}: Plays ${L.length} card(s) face-down under itself.`),{newState:W}}if(h==="deck"&&((S=i.destinationRule)==null?void 0:S.type)==="specific_lane"){const q=i.destinationRule.laneIndex==="current"?n:i.destinationRule.laneIndex;if(q===void 0||q<0||q>2)return console.error(`[Play Effect] Invalid lane index: ${q}`),{newState:r};const D=r[y];if(D.deck.length===0&&D.discard.length===0)return{newState:re(r,d,`[Custom Play effect] ${y} has no cards in deck/discard - skipping.`)};const{drawnCards:E,remainingDeck:j,newDiscard:I}=Tn(D.deck,D.discard,m);if(E.length===0)return{newState:r};const k=E.map(P=>({...P,id:Ge(),isFaceUp:!p})),L=[...D.lanes];L[q]=[...L[q],...k];const G={...D,lanes:L,deck:j,discard:I};let T={...r,[y]:G};const Q=ve(r,o.id),X=Q?`${Q.card.protocol}-${Q.card.value}`:"a card effect",M=y==="player"?"Player":"Opponent",$=p?"face-down":"face-up",W=r.player.protocols[q];return T=re(T,d,`${X}: ${M} plays ${E.length} card(s) ${$} in ${W} line.`),{newState:T}}if(h==="hand"&&r[y].hand.length===0)return console.log(`[Play Effect] ${y} has no cards in hand to play - skipping effect.`),{newState:r};let v=re(r,d,`[Custom Play effect - playing ${m} card(s) ${p?"face-down":"face-up"} from ${h}]`),x;return(N=i.destinationRule)!=null&&N.excludeCurrentLane&&(x=n),v.actionRequired={type:"select_card_from_hand_to_play",count:m,sourceCardId:o.id,actor:y,faceDown:p,source:h,disallowedLaneIndex:x,destinationRule:i.destinationRule,condition:i.condition},{newState:v}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Reveal/Give Effect Executor
 *
 * Handles reveal and give card effects.
 * Extracted 1:1 from effectInterpreter.ts for modularity.
 */function o_(o,n,r,s,i){const{cardOwner:d,opponent:f}=s,m=i.count||1,h=i.action,p=i.source||"own_hand";if(h==="reveal"&&p==="board"){const v=i.targetFilter||{owner:"any",position:"uncovered",faceState:"face_down"},x=i.followUpAction,_=i.optional!==!1,w=[],U=v.owner==="own"?[d]:v.owner==="opponent"?[f]:[d,f];for(const A of U)for(let S=0;S<r[A].lanes.length;S++){const N=r[A].lanes[S];if(N.length>0){let q=[];v.position==="uncovered"?q=[N[N.length-1]]:v.position==="covered"?q=N.slice(0,-1):q=[...N];const D=q.filter(E=>v.faceState==="face_up"?E.isFaceUp:v.faceState==="face_down"?!E.isFaceUp:!0);w.push(...D)}}if(w.length===0)return{newState:re(r,d,"No valid cards to reveal. Effect skipped.")};let C={...r};return C.actionRequired={type:"select_board_card_to_reveal_custom",sourceCardId:o.id,actor:d,targetFilter:v,followUpAction:x,optional:_},{newState:C}}if(h==="reveal"&&p==="opponent_hand"){let v={...r};const x={...v[f]};if(x.hand.length>0){x.hand=x.hand.map(w=>({...w,isRevealed:!0})),v[f]=x;const _=`${o.protocol}-${o.value}`;v=re(v,d,`${_}: Your opponent reveals their hand.`)}else{const _=`${o.protocol}-${o.value}`;v=re(v,d,`${_}: Opponent has no cards to reveal.`)}return{newState:v}}if(r[d].hand.length===0)return{newState:re(r,d,`No cards in hand to ${h}. Effect skipped.`)};let y={...r};return h==="reveal"?y.actionRequired={type:"select_card_from_hand_to_reveal",count:m,sourceCardId:o.id,actor:d}:h==="give"&&(y.actionRequired={type:"select_card_from_hand_to_give",count:m,sourceCardId:o.id,actor:d}),{newState:y}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function ot(o,n,r,s,i,d){var U,C;const f=i.params,m=f.action,h=ve(r,o.id);if(!h)return{newState:r};if(!h.card.isFaceUp)return{newState:r};const p=i.position||"middle",v=i.trigger==="on_cover";if(p!=="top"&&!v&&!uo(r,o.id))return{newState:r};const _=m==="reveal"&&f.source==="board";if(f.optional===!0&&!_){const A=f.actor==="opponent"?s.opponent:s.cardOwner,S=A==="player"?"opponent":"player",N=f.targetFilter||{},q=I=>{for(const k of["player","opponent"])for(let L=0;L<r[k].lanes.length;L++){const G=r[k].lanes[L];for(let T=0;T<G.length;T++)if(I(G[T],k,L,T))return!0}return!1};let D=!0,E="";switch(m){case"discard":r[A].hand.length===0&&(D=!1,E="No cards to discard");break;case"flip":{const I=(U=r.passiveEffects)==null?void 0:U.some(k=>k.type==="prevent_flip_to_face_up"&&k.isActive);D=q((k,L,G,T)=>{if(N.excludeSelf&&k.id===o.id||N.owner==="own"&&L!==A||N.owner==="opponent"&&L===A)return!1;const Q=T===r[L].lanes[G].length-1;return!(N.position==="uncovered"&&!Q||N.position==="covered"&&Q||N.faceState==="face_up"&&!k.isFaceUp||N.faceState==="face_down"&&k.isFaceUp||I&&!k.isFaceUp)}),D||(E="No valid cards to flip");break}case"delete":{D=q((I,k,L,G)=>{if(N.excludeSelf&&I.id===o.id||N.owner==="own"&&k!==A||N.owner==="opponent"&&k===A)return!1;const T=G===r[k].lanes[L].length-1,Q=N.position||"uncovered";return!(Q==="uncovered"&&!T||Q==="covered"&&T||N.faceState==="face_up"&&!I.isFaceUp||N.faceState==="face_down"&&I.isFaceUp)}),D||(E="No valid cards to delete");break}case"shift":{if(i.useCardFromPreviousEffect){const I=r.lastCustomEffectTargetCardId||r._selectedCardFromPreviousEffect;I?(D=!!ve(r,I),D||(E="Target card no longer exists")):(D=!1,E="No target card from previous effect")}else{const I=N.position||"uncovered";I==="any"&&N.owner==="own"&&!N.excludeSelf?D=!0:(D=q((L,G,T,Q)=>{if(N.excludeSelf&&L.id===o.id||N.owner==="own"&&G!==A||N.owner==="opponent"&&G===A)return!1;const X=Q===r[G].lanes[T].length-1;return!(I==="uncovered"&&!X||I==="covered"&&X)}),D||(E="No valid cards to shift"))}break}case"return":{const I=N.owner==="opponent"?S:A;D=q((k,L,G,T)=>{if(L!==I)return!1;const Q=T===r[L].lanes[G].length-1,X=N.position||"uncovered";return!(X==="uncovered"&&!Q||X==="covered"&&Q)}),D||(E="No valid cards to return");break}case"draw":r[A].deck.length===0&&r[A].discard.length===0&&(D=!1,E="No cards to draw");break;case"play":r[A].hand.length===0&&(D=!1,E="No cards to play");break}if(!D){console.log(`[Custom Effect] Optional ${m} skipped - ${E}`);let I=re(r,A,`${E} - effect skipped.`);return I._effectSkippedNoTargets=!0,m==="discard"&&(I._discardContext={discardedCount:0}),{newState:I}}console.log(`[Custom Effect] Optional effect detected (${m}) - creating prompt`);let j={...r};return j.actionRequired={type:"prompt_optional_effect",actor:s.cardOwner,sourceCardId:o.id,effectDef:i,laneIndex:n},{newState:j}}let w;switch(m){case"refresh":{const A=s.actor,S=r[A].hand.length,N=Math.max(0,5-S);if(N>0){const{drawnCards:q,remainingDeck:D,newDiscard:E}=Tn(r[A].deck,r[A].discard,N),j=q.map(G=>({...G,id:Ge()}));let I={...r,[A]:{...r[A],hand:[...r[A].hand,...j],deck:D,discard:E}};const k=A==="player"?` (${q.map(G=>`${G.protocol}-${G.value}`).join(", ")})`:"";I=re(I,A,`[Refresh] Drew ${q.length} cards to reach hand size 5${k}.`),I=Dt(I,"after_draw",{player:A,count:q.length}).newState,w={newState:I}}else w={newState:re(r,A,`[Refresh] Hand already at ${S} cards, no draw needed.`)};break}case"mutual_draw":{const A=s.actor,S=A==="player"?"opponent":"player",N=f.count||1;let q={...r};if(q[S].deck.length>0){const{drawnCards:D,remainingDeck:E,newDiscard:j}=Tn(q[S].deck,q[S].discard,N);if(D.length>0){const I=D.map(T=>({...T,id:Ge(),isFaceUp:!0}));q={...q,[S]:{...q[S],deck:E,discard:j},[A]:{...q[A],hand:[...q[A].hand,...I]}};const k=A==="player"?"Player":"Opponent",L=S==="player"?"Player":"Opponent",G=A==="player"?` (${I.map(T=>`${T.protocol}-${T.value}`).join(", ")})`:"";q=re(q,A,`${k} drew ${D.length} card(s) from ${L}'s deck${G}.`)}}if(q[A].deck.length>0){const{drawnCards:D,remainingDeck:E,newDiscard:j}=Tn(q[A].deck,q[A].discard,N);if(D.length>0){const I=D.map(T=>({...T,id:Ge(),isFaceUp:!0}));q={...q,[A]:{...q[A],deck:E,discard:j},[S]:{...q[S],hand:[...q[S].hand,...I]}};const k=S==="player"?"Player":"Opponent",L=A==="player"?"Player":"Opponent",G=S==="player"?` (${I.map(T=>`${T.protocol}-${T.value}`).join(", ")})`:"";q=re(q,S,`${k} drew ${D.length} card(s) from ${L}'s deck${G}.`)}}w={newState:q};break}case"draw":w=Xv(o,n,r,s,f);break;case"flip":w=Zv(o,n,r,s,f);break;case"delete":w=Kv(o,n,r,s,f);break;case"discard":w=Jv(o,n,r,s,f);break;case"shift":w=e_(o,n,r,s,{...f,useCardFromPreviousEffect:i.useCardFromPreviousEffect});break;case"return":w=t_(o,n,r,s,f);break;case"play":w=n_(o,n,r,s,f);break;case"rearrange_protocols":case"swap_protocols":w=a_(o,n,r,s,f);break;case"reveal":case"give":w=o_(o,n,r,s,f);break;case"take":w=l_(o,n,r,s,f);break;case"choice":w=r_(o,n,r,s,f);break;case"block_compile":w=c_(o,n,r,s,f);break;case"delete_all_in_lane":w=i_(o,n,r,s,f);break;default:console.error(`[Custom Effect] Unknown action: ${m}`),w={newState:r};break}if(i.conditional&&i.conditional.thenEffect){const{newState:A}=w;if(console.log("[Custom Effect] Effect has conditional follow-up:",i.id,"Conditional type:",i.conditional.type,"Action created?",!!A.actionRequired,"actionRequired.type:",(C=A.actionRequired)==null?void 0:C.type),A.actionRequired)console.log("[Custom Effect] Storing follow-up effect for later execution:",i.conditional.thenEffect.id,"to actionRequired type:",A.actionRequired.type),w={newState:{...A,actionRequired:{...A.actionRequired,followUpEffect:i.conditional.thenEffect,conditionalType:i.conditional.type,outerSourceCardId:o.id,outerLaneIndex:n}}};else{if(console.log("[Custom Effect] Effect completed immediately, conditional type:",i.conditional.type),i.conditional.type==="if_executed"){const q=A._discardContext;if(((q==null?void 0:q.discardedCount)||0)===0)return console.log("[Custom Effect] Skipping if_executed follow-up - no action was executed (no discard)"),delete A._discardContext,w={newState:A},w}console.log("[Custom Effect] Executing conditional follow-up effect immediately");let S=s;const N=A._discardContext;N&&(S={...s,discardedCount:N.discardedCount,previousHandSize:N.previousHandSize},delete A._discardContext,console.log("[Custom Effect] Propagated discard context:",S)),w=ot(o,n,A,S,i.conditional.thenEffect)}}return w}function a_(o,n,r,s,i){const{cardOwner:d,opponent:f}=s,m=i.action,p=(i.target||"own")==="opponent"?f:d,y=d;if(Iv(r)&&m==="rearrange_protocols")return{newState:re(r,d,"Protocols cannot be rearranged (Frost-1 bottom effect is active).")};let x=re(r,d,`[Custom Protocol effect - ${m} for ${p}]`),_;return i.restriction&&(_={laneIndex:i.restriction.laneIndex==="current"?n:i.restriction.laneIndex,protocol:i.restriction.disallowedProtocol}),m==="rearrange_protocols"?x.actionRequired={type:"prompt_rearrange_protocols",actor:y,target:p,sourceCardId:o.id,disallowedProtocolForLane:_}:m==="swap_protocols"&&(x.actionRequired={type:"prompt_swap_protocols",actor:y,target:p,sourceCardId:o.id,disallowedProtocolForLane:_}),{newState:x}}function l_(o,n,r,s,i){const{cardOwner:d,opponent:f}=s,m=i.count||1,h=i.random!==!1;if(r[f].hand.length===0)return{newState:re(r,d,"Opponent has no cards in hand. Effect skipped.")};let p={...r};const y={...p[f]},v={...p[d]};if(h){const x=Math.min(m,y.hand.length),_=[];for(let A=0;A<x;A++){const S=Math.floor(Math.random()*y.hand.length),N=y.hand.splice(S,1)[0];v.hand.push(N),_.push(N)}p={...p,[d]:v,[f]:y};const w=d==="player"?"Player":"Opponent",U=`${o.protocol}-${o.value}`,C=_.map(A=>d==="player"?`${A.protocol}-${A.value}`:"a card").join(", ");return p=re(p,d,`${U}: ${w} takes ${C} from the opponent's hand.`),{newState:p}}else{console.warn("[Take Effect] Non-random take not yet implemented, falling back to random");const x=Math.floor(Math.random()*y.hand.length),_=y.hand.splice(x,1)[0];v.hand.push(_),p={...p,[d]:v,[f]:y};const w=d==="player"?"Player":"Opponent",U=`${o.protocol}-${o.value}`,C=d==="player"?`${_.protocol}-${_.value}`:"a card";return p=re(p,d,`${U}: ${w} takes ${C} from the opponent's hand.`),{newState:p}}}function r_(o,n,r,s,i){const{cardOwner:d}=s,f=i.options||[];if(f.length!==2)return console.error(`[Choice Effect] Expected 2 options, got ${f.length}`),{newState:r};let m=re(r,d,"[Custom Choice effect - choose one of two options]");return m.actionRequired={type:"custom_choice",options:f,sourceCardId:o.id,actor:d,laneIndex:n},{newState:m}}function c_(o,n,r,s,i){const{cardOwner:d,opponent:f}=s,h=(i.target||"opponent")==="opponent"?f:d,p={...r[h],cannotCompile:!0};let y={...r,[h]:p};const v=ve(r,o.id),x=v?`${v.card.protocol}-${v.card.value}`:"Effect";return y=re(y,d,`${x}: ${h==="player"?"Player":"Opponent"} cannot compile next turn.`),{newState:y}}function i_(o,n,r,s,i){var y;const{cardOwner:d}=s,f=i.excludeCurrentLane!==!1,m=((y=i.laneCondition)==null?void 0:y.count)||8,h=[];for(let v=0;v<3;v++){if(f&&v===n)continue;r.player.lanes[v].length+r.opponent.lanes[v].length>=m&&h.push(v)}if(h.length===0){const v=`${o.protocol}-${o.value}`;return{newState:re(r,d,`${v}: No line has ${m} or more cards. Effect skipped.`)}}let p={...r};return p.actionRequired={type:"select_lane_for_delete_all",sourceCardId:o.id,actor:d,validLanes:h,minCards:m},{newState:p}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function Dt(o,n,r){let s={...o};if(s._processingReactiveEffects)return console.log(`[Reactive Effects] Already processing reactive effects, skipping ${n}`),{newState:s};s={...s,_processingReactiveEffects:!0};const i=s.processedClearCacheTriggerIds||[],d=[];for(const f of["player","opponent"])s[f].lanes.forEach((m,h)=>{m.forEach(p=>{if(p.isFaceUp){const y=p;if(y.customEffects&&y.customEffects.topEffects&&y.customEffects.topEffects.filter(x=>x.trigger===n||x.trigger==="on_cover_or_flip"&&(n==="on_cover"||n==="on_flip")).length>0){if(n==="after_clear_cache"&&i.includes(p.id)){console.log(`[Reactive Effects] Skipping ${p.protocol}-${p.value} after_clear_cache - already triggered this turn`);return}d.push({card:p,owner:f,laneIndex:h,box:"top"})}}})});if(d.length===0)return delete s._processingReactiveEffects,{newState:s};console.log(`[Reactive Effects] Found ${d.length} card(s) with ${n} trigger`);for(const{card:f,owner:m,laneIndex:h}of d){const p=s[m].lanes[h];if(!(p==null?void 0:p.some(A=>A.id===f.id&&A.isFaceUp))){console.log(`[Reactive Effects] Card ${f.protocol}-${f.value} no longer face-up, skipping`);continue}if(n==="before_compile_delete"&&(r==null?void 0:r.cardId)!==f.id||n==="on_flip"&&(r==null?void 0:r.cardId)!==f.id||(n==="on_cover"||n==="on_flip")&&r!=null&&r.cardId&&r.cardId!==f.id)continue;const _=f.customEffects.topEffects.filter(A=>A.trigger===n||A.trigger==="on_cover_or_flip"&&(n==="on_cover"||n==="on_flip")).filter(A=>{const S=A.reactiveTriggerActor||"self";if(!(r!=null&&r.player))return!0;if(n==="after_opponent_discard")return r.player!==m?(console.log(`[Reactive Effects] Skipping ${f.protocol}-${f.value} ${n} - card owner (${m}) is not the opponent of discarder (${r.player})`),!1):!0;if(S==="self"){if(r.player!==m)return console.log(`[Reactive Effects] Skipping ${f.protocol}-${f.value} ${n} - triggerActor=self, but triggered by ${r.player} (owner: ${m})`),!1}else if(S==="opponent"&&r.player===m)return console.log(`[Reactive Effects] Skipping ${f.protocol}-${f.value} ${n} - triggerActor=opponent, but triggered by ${r.player} (owner: ${m})`),!1;return!0});if(_.length===0)continue;const w=`${f.protocol}-${f.value}`;s=kn(s),s=Le(s,w),s=Qe(s,void 0);const U=m==="player"?"opponent":"player",C={cardOwner:m,actor:m,currentTurn:s.turn,opponent:U,triggerType:n};if(n==="after_clear_cache"){const A=s.processedClearCacheTriggerIds||[];s.processedClearCacheTriggerIds=[...A,f.id],console.log(`[Reactive Effects] Marked ${w} as processed for after_clear_cache`)}for(const A of _){const S=ot(f,h,s,C,A);if(s=_e(S.newState),s.actionRequired){console.log(`[Reactive Effects] Action required after ${w} reactive effect`);const N=s._pendingCustomEffects;if(N&&N.effects.length>0){console.log(`[Reactive Effects] Queueing ${N.effects.length} pending effects from original card`);const q={type:"execute_remaining_custom_effects",sourceCardId:N.sourceCardId,laneIndex:N.laneIndex,effects:N.effects,context:N.context,actor:N.context.cardOwner};s.queuedActions=[q,...s.queuedActions||[]],delete s._pendingCustomEffects}return delete s._processingReactiveEffects,{newState:s}}}s=fo(s),s=Le(s,void 0),s=Qe(s,void 0)}return delete s._processingReactiveEffects,{newState:s}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function Tn(o,n,r){let s=[...o],i=[...n],d=[],f=!1;for(let m=0;m<r;m++){if(s.length===0){if(i.length===0)break;s=Ln(i),i=[],f=!0}d.push(s.shift())}return{drawnCards:d,remainingDeck:s,newDiscard:i,reshuffled:f}}function ga(o,n,r){const s=o[n],{drawnCards:i,remainingDeck:d,newDiscard:f,reshuffled:m}=Tn(s.deck,s.discard,r);if(i.length===0)return o;const h=i.map(_=>({..._,id:Ge(),isFaceUp:!0})),p=h.map(_=>_.id),y={...s.stats,cardsDrawn:s.stats.cardsDrawn+i.length},v={...s,deck:d,discard:f,hand:[...s.hand,...h],stats:y};let x={...o,[n]:v,stats:{...o.stats,[n]:y}};return p.length>0&&(x.animationState={type:"drawCard",owner:n,cardIds:p}),m&&(x=re(x,n,`${n==="player"?"Player":"Opponent"}'s deck is empty. Discard pile has been reshuffled into the deck.`)),i.length>0&&(x=Dt(x,"after_draw",{player:n,count:i.length}).newState),x}function s_(o,n,r){const s=n==="player"?"opponent":"player";let i={...o};const d={...i[s]},f={...i[n]},{drawnCards:m,remainingDeck:h,newDiscard:p,reshuffled:y}=Tn(d.deck,d.discard,r);if(m.length>0){const v=m.map(w=>({...w,id:Ge(),isFaceUp:!0})),x=v.map(w=>w.id);f.hand=[...f.hand,...v];const _={...f.stats,cardsDrawn:f.stats.cardsDrawn+m.length};f.stats=_,d.deck=h,d.discard=p,i={...i,[n]:f,[s]:d,stats:{...i.stats,[n]:_}},x.length>0&&(i.animationState={type:"drawCard",owner:n,cardIds:x}),y&&(i=re(i,n,`${s==="player"?"Player":"Opponent"}'s deck is empty. Discard pile has been reshuffled into the deck.`))}return i}function d_(o,n){const s=5-o[n].hand.length;if(s<=0)return o;const i=n==="player"?"Player":"Opponent";let d=ga(o,n,s);const f={...d[n],stats:{...d[n].stats,handsRefreshed:d[n].stats.handsRefreshed+1}};return d={...d,[n]:f,stats:{...d.stats,[n]:f.stats}},re(d,n,`${i} refreshes their hand, drawing ${s} card(s).`)}function ha(o,n){const r={...n},s=i=>i.map(d=>d.map(f=>o.has(f.id)?{...f,isFaceUp:!f.isFaceUp}:f));return r.player.lanes=s(r.player.lanes),r.opponent.lanes=s(r.opponent.lanes),_e(r)}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const sh=o=>{const n=Ln(io(o)),{drawnCards:r,remainingDeck:s}=Tn(n,[],5),i={cardsPlayed:0,cardsDiscarded:0,cardsDeleted:0,cardsFlipped:0,cardsShifted:0,cardsDrawn:r.length,handsRefreshed:0},d=r.map(f=>({...f,id:Ge(),isFaceUp:!0}));return{protocols:o,deck:s,hand:d,lanes:[[],[],[]],discard:[],compiled:[!1,!1,!1],laneValues:[0,0,0],cannotCompile:!1,stats:i}},lr=(o,n,r,s="player")=>{const i=sh(o),d=sh(n),f={player:i,opponent:d,turn:s,phase:"start",controlCardHolder:null,useControlMechanic:r,winner:null,log:[],actionRequired:null,queuedActions:[],animationState:null,compilableLanes:[],processedStartEffectIds:[],processedEndEffectIds:[],lastPlayedCardId:void 0,stats:{player:i.stats,opponent:d.stats}},m=s==="player"?"Player":"Opponent",h=o.join(", "),p=n.join(", ");let y=re(f,"player","Game Started.");return y=re(y,"player",`Player protocols: ${h}`),y=re(y,"opponent",`Opponent protocols: ${p}`),y=re(y,"player",`${m} goes first.`),y},Mn=(o,n,r,s,i)=>{if(o.isFaceUp)return o.value;if(n.some(f=>f.isFaceUp&&f.protocol==="Darkness"&&f.value===2))return 4;if(r&&s!==void 0&&i!==void 0){const f=Lh(r);for(const m of f)if(m.type==="set_to_fixed"){if(!(m.scope==="global"||m.scope==="this_lane"&&m.laneIndex===s))continue;const p=m.cardOwner;if(m.target==="own_cards"&&p!==i||m.target==="opponent_cards"&&p===i)continue;const y=m.filter;if(y&&(!y.faceState||y.faceState==="any"||y.faceState==="face_down"&&!o.isFaceUp||y.faceState==="face_up"&&o.isFaceUp))return m.value}}return 2},dh=(o,n,r,s)=>{let i=0;for(const d of o)d.isFaceUp?i+=d.value:i+=Mn(d,o,n,r,s);return Math.max(0,i)};function Lh(o){const n=[];for(const r of["player","opponent"])o[r].lanes.forEach((s,i)=>{s.forEach(d=>{if(d.isFaceUp){const f=d;f.customEffects&&[...f.customEffects.topEffects||[],...f.customEffects.middleEffects||[],...f.customEffects.bottomEffects||[]].forEach(h=>{h.params.action==="value_modifier"&&h.trigger==="passive"&&n.push({...h.params.modifier,cardOwner:r,laneIndex:i})})}})});return n}function u_(o,n,r){const s=Lh(o),i=[...n],d=[...r];for(const f of s){const{type:m,value:h,condition:p,target:y,scope:v,filter:x,cardOwner:_,laneIndex:w}=f,U=v==="global"?[0,1,2]:[w];for(const C of U)switch(m){case"add_per_condition":{if(!p)continue;let A=0;const S=o.player.lanes[C],N=o.opponent.lanes[C];p==="per_face_down_card"?A=S.filter(q=>!q.isFaceUp).length+N.filter(q=>!q.isFaceUp).length:p==="per_face_up_card"?A=S.filter(q=>q.isFaceUp).length+N.filter(q=>q.isFaceUp).length:p==="per_card"&&(A=S.length+N.length),y==="own_total"&&_==="player"?i[C]+=h*A:y==="own_total"&&_==="opponent"||y==="opponent_total"&&_==="player"?d[C]+=h*A:y==="opponent_total"&&_==="opponent"&&(i[C]+=h*A);break}case"set_to_fixed":break;case"add_to_total":{y==="own_total"&&_==="player"?i[C]+=h:y==="own_total"&&_==="opponent"||y==="opponent_total"&&_==="player"?d[C]+=h:y==="opponent_total"&&_==="opponent"&&(i[C]+=h);break}}}return{finalPlayerValues:i.map(f=>Math.max(0,f)),finalOpponentValues:d.map(f=>Math.max(0,f))}}function f_(o,n,r){let s=[...n],i=[...r];return{finalPlayerValues:s,finalOpponentValues:i}}const _e=o=>{const n=o.player.lanes.map((f,m)=>dh(f,o,m,"player")),r=o.opponent.lanes.map((f,m)=>dh(f,o,m,"opponent")),s=f_(o,n,r),{finalPlayerValues:i,finalOpponentValues:d}=u_(o,s.finalPlayerValues,s.finalOpponentValues);return{...o,player:{...o.player,laneValues:i},opponent:{...o.opponent,laneValues:d}}},Mh=(o,n)=>{const r=[],s=o[n],i=o[n==="player"?"opponent":"player"];if(!s.cannotCompile)for(let d=0;d<3;d++){const f=s.laneValues[d],m=i.laneValues[d];f>=10&&f>m&&r.push(d)}return r};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const p_=["select_card_to_flip","select_any_card_to_flip"];function h_(o,n,r){if(!r||!p_.includes(r.type))return null;const s=ve(o,n);if(s&&s.card.protocol==="Metal"&&s.card.value===6){const i="actor"in r?r.actor:o.turn,d=i==="player"?"Player":"Opponent",f=s.owner==="player"?"Player's":"Opponent's";let m="An effect";if("sourceCardId"in r&&r.sourceCardId){const S=ve(o,r.sourceCardId);S&&(m=`${S.card.protocol}-${S.card.value}`)}let h=re(o,i,`${m}: ${d} flips ${f} Metal-6.`);h=re(h,i,"Metal-6: Deletes itself when flipped.");const p={...o.stats[i],cardsDeleted:o.stats[i].cardsDeleted+1},y={...o[i],stats:p};h={...h,[i]:y,stats:{...h.stats,[i]:p}};const v=s.owner,x=o[v].lanes.findIndex(S=>S.some(N=>N.id===n)),_=o[v].lanes[x],w=_&&_.length>0&&_[_.length-1].id===n,U=_&&_.length>1,C=o._pendingCustomEffects,A=(S,N)=>{let q={...S};C&&(q._pendingCustomEffects=C,q.lastCustomEffectTargetCardId=n);let E=Dt(q,"after_delete",{player:q.turn}).newState;if(w&&U&&(E=_n(E,v,x).newState),r&&"count"in r&&r.count>1){const j=r.count-1;return E.actionRequired={...r,count:j},E}if(q.actionRequired||q.queuedActions&&q.queuedActions.length>0)return{...E,actionRequired:q.actionRequired,queuedActions:q.queuedActions};if(C&&!E._pendingCustomEffects&&(E._pendingCustomEffects=C,E.lastCustomEffectTargetCardId=n),E=Ye(E),E.actionRequired=null,E.queuedActions&&E.queuedActions.length>0){const j=[...E.queuedActions],I=j.shift();if((I==null?void 0:I.type)==="execute_remaining_custom_effects"){const k={...E,queuedActions:[I,...j]},L=po(k);if(L.actionRequired)return L;if(L.queuedActions&&L.queuedActions.length>0){const G=[...L.queuedActions],T=G.shift();return{...L,actionRequired:T,queuedActions:G}}return N(L)}return{...E,actionRequired:I,queuedActions:j}}return N(E)};return{nextState:{...h,actionRequired:null},requiresAnimation:{animationRequests:[{type:"delete",cardId:n,owner:s.owner}],onCompleteCallback:A},requiresTurnEnd:!1}}return null}const rd=(o,n)=>{var f,m,h,p,y,v,x,_,w,U,C,A,S,N,q;if(!o.actionRequired)return{nextState:o};let r={...o},s=!0,i=null;const d=h_(o,n,o.actionRequired);if(d)return d;switch(o.actionRequired.type){case"select_card_to_flip":{const D=ve(o,n),E="draws"in o.actionRequired?o.actionRequired.draws:0;r=od(o,n);const j=n;if(r.lastCustomEffectTargetCardId=j,E&&E>0){const{actor:X,sourceCardId:M}=o.actionRequired,$=ve(r,M),W=$?`${$.card.protocol}-${$.card.value}`:"A card effect";r=re(r,X,`${W}: Drawing ${E} card(s).`),r=ga(r,X,E)}if(D&&!D.card.isFaceUp){const X=ld(r,n);r=X.newState,r.lastCustomEffectTargetCardId=j,X.animationRequests&&(i={animationRequests:X.animationRequests,onCompleteCallback:(M,$)=>M.actionRequired||M.queuedActions&&M.queuedActions.length>0?M:$(M)})}const I=(f=o.actionRequired)==null?void 0:f.followUpEffect,k=(m=o.actionRequired)==null?void 0:m.sourceCardId;I&&k&&(r=Yv(r,n,k));const L=((h=o.actionRequired)==null?void 0:h.actor)||o.turn;r=Dt(r,"after_flip",{player:L,cardId:n}).newState;const T=r._pendingCustomEffects;if(T&&T.effects.length>0){console.log("[SOFTLOCK DEBUG] Queueing pending effects after flip:"),console.log("  - cardOwner from context:",T.context.cardOwner),console.log("  - flipActor (prev actor):",L),console.log("  - current turn:",r.turn),console.log("  - actionRequired actor:",(p=r.actionRequired)==null?void 0:p.actor),console.log("  - remaining effects:",T.effects.length);const X={type:"execute_remaining_custom_effects",sourceCardId:T.sourceCardId,laneIndex:T.laneIndex,effects:T.effects,context:T.context,actor:T.context.cardOwner,selectedCardFromPreviousEffect:T.effects[0].useCardFromPreviousEffect?n:void 0};console.log("  - queued action actor:",X.actor),r.queuedActions=[...r.queuedActions||[],X],console.log("  - queue length after:",r.queuedActions.length),delete r._pendingCustomEffects}const Q=(y=o.actionRequired)==null?void 0:y.remainingLanes;if(Q&&Q.length>0&&!r.actionRequired){const X=Q[0],M=Q.slice(1),$=(v=o.actionRequired)==null?void 0:v.params,W=(x=o.actionRequired)==null?void 0:x.sourceCardId,P=(_=o.actionRequired)==null?void 0:_.actor,ne=(w=o.actionRequired)==null?void 0:w.targetFilter;r.actionRequired={type:"select_card_to_flip",sourceCardId:W,actor:P,currentLaneIndex:X,remainingLanes:M,targetFilter:ne,params:$,followUpEffect:(U=o.actionRequired)==null?void 0:U.followUpEffect,conditionalType:(C=o.actionRequired)==null?void 0:C.conditionalType}}(r.actionRequired||r.queuedActions&&r.queuedActions.length>0)&&(s=!1);break}case"select_card_to_shift":{const{sourceCardId:D,optional:E}=o.actionRequired;if(E&&D){const I=ve(o,D);if(!I||!I.card.isFaceUp){const k=I?`${I.card.protocol}-${I.card.value}`:"the source card",L=o._logSource;r=Le(o,k),r=re(r,o.actionRequired.actor,"Shift was cancelled because the source is no longer active."),r=Le(r,L),r=Ye(r),r.actionRequired=null,s=!0;break}}const j=ve(o,n);if(j){const{owner:I}=j;let k=-1;for(let M=0;M<o[I].lanes.length;M++)if(o[I].lanes[M].some($=>$.id===n)){k=M;break}if(k===-1)return{nextState:o,requiresTurnEnd:!1};const G=(o.actionRequired.targetFilter||{}).position||"uncovered",T=o[I].lanes[k],X=T.findIndex(M=>M.id===n)===T.length-1;if(G==="uncovered"&&!X)return console.log("[Shift Validation] Rejected: Card is covered but filter requires uncovered"),{nextState:o,requiresTurnEnd:!1};if(G==="covered"&&X)return console.log("[Shift Validation] Rejected: Card is uncovered but filter requires covered"),{nextState:o,requiresTurnEnd:!1};if(k!==-1){const M=o.actionRequired.targetLaneIndex;if(M!==void 0){const W=o.actionRequired.actor;r=fa(o,n,I,M,W).newState,s=!r.actionRequired;break}const $={type:"select_lane_for_shift",cardToShiftId:n,cardOwner:I,originalLaneIndex:k,sourceCardId:o.actionRequired.sourceCardId,actor:o.actionRequired.actor,destinationRestriction:o.actionRequired.destinationRestriction,followUpEffect:o.actionRequired.followUpEffect,conditionalType:o.actionRequired.conditionalType};r.actionRequired=$}}s=!1;break}case"delete_self":{const{sourceCardId:D,cardToDeleteId:E,actor:j}=o.actionRequired,I=ve(o,E);if(!I){r=re(o,j,"Card no longer on board. Delete skipped."),r=Ye(r),r.actionRequired=null,s=!0;break}const{owner:k,laneIndex:L}=I,G=o[k].lanes[L][o[k].lanes[L].length-1].id===E,T=[...o[k].lanes[L]],Q=T.findIndex(W=>W.id===E);T.splice(Q,1);const X=[...o[k].lanes];X[L]=T;let M={...o,[k]:{...o[k],lanes:X}};r=Ye(M),r.actionRequired=null;const $={...r.stats[j],cardsDeleted:r.stats[j].cardsDeleted+1};r={...r,stats:{...r.stats,[j]:$}},G&&T.length>0&&(r=_n(r,k,L).newState),s=!0;break}case"select_cards_to_delete":case"select_face_down_card_to_delete":case"select_low_value_card_to_delete":case"select_card_from_other_lanes_to_delete":{console.log("[CARD RESOLVER] DELETE CASE ENTERED:",o.actionRequired.type);const{sourceCardId:D,actor:E}=o.actionRequired,j=ve(o,D);if(!j||!j.card.isFaceUp){const H=j?`${j.card.protocol}-${j.card.value}`:"the source card";r=re(o,E,`Effect from ${H} was cancelled because the source is no longer active.`),r=Ye(r),r.actionRequired=null,s=!0;break}const I=ve(o,n);if(!I)return{nextState:o};if(o.actionRequired.protocolMatching){const H=o.actionRequired.protocolMatching,V=o[I.owner].lanes.findIndex(Y=>Y.some(B=>B.id===n));if(V!==-1){const Y=o.player.protocols[V],B=o.opponent.protocols[V],J=I.card.protocol,ee=J===Y||J===B;if(H==="must_match"&&!ee)return console.error(`Illegal delete: ${J}-${I.card.value} in lane ${V} (protocols: ${Y}/${B}) - card must be in lane with matching protocol`),{nextState:o};if(H==="must_not_match"&&ee)return console.error(`Illegal delete: ${J}-${I.card.value} in lane ${V} (protocols: ${Y}/${B}) - card must be in lane without matching protocol`),{nextState:o}}}const k=o.actionRequired.targetFilter;if((k==null?void 0:k.calculation)==="highest_value"||(k==null?void 0:k.calculation)==="lowest_value"){const H=k.owner,V=H==="opponent"?E==="player"?"opponent":"player":H==="own"?E:I.owner,B=Qv(o,V).some(ee=>ee.card.id===n),J=k.calculation==="highest_value"?"highest":"lowest";if(!B)return console.error(`Illegal delete: Card ${n} is not one of the ${J} value uncovered cards`),{nextState:o}}const L=E==="player"?"Player":"Opponent",G=I.owner==="player"?"Player's":"Opponent's",T=o[I.owner].lanes.findIndex(H=>H.some(V=>V.id===n)),Q=T!==-1?o[I.owner].protocols[T]:"unknown",X=I.card.isFaceUp?`${I.card.protocol}-${I.card.value}`:`face-down card in Protocol ${Q}`,M=ve(o,o.actionRequired.sourceCardId),$=M?`${M.card.protocol}-${M.card.value}`:"a card effect";r=re(r,E,`${$}: ${L} deletes ${G} ${X}.`);const W={...r.stats[E],cardsDeleted:r.stats[E].cardsDeleted+1},P={...r[E],stats:W};r={...r,[E]:P,stats:{...r.stats,[E]:W}};const ne=o[I.owner].lanes.findIndex(H=>H.some(V=>V.id===n)),F=o[I.owner].lanes[ne],z=F&&F.length>0&&F[F.length-1].id===n;r=Ye(r),r.actionRequired=null,i={animationRequests:[{type:"delete",cardId:n,owner:I.owner}],onCompleteCallback:(H,V)=>{var Xe,Se,Me,tt,Pt,Qt;const Y=o.actionRequired.actor,B=o.actionRequired;console.log("[DELETE CALLBACK] Started! followUpEffect?",!!B.followUpEffect);let ee=Dt(H,"after_delete",{player:Y}).newState;ee=Ye(ee);let he=null;const ye=ve(ee,B.sourceCardId),me=uo(ee,B.sourceCardId),xe=B.followUpEffect;if(ye&&ye.card.isFaceUp&&me){const Te=B.remainingLanes;if(B.type==="select_cards_to_delete"&&Te&&Te.length>0){const He=Te[0],Ze=Te.slice(1);he={type:"select_cards_to_delete",count:((Xe=B.params)==null?void 0:Xe.count)||B.count,sourceCardId:B.sourceCardId,actor:B.actor,currentLaneIndex:He,remainingLanes:Ze,disallowedIds:(Se=B.params)!=null&&Se.excludeSelf?[B.sourceCardId]:[],targetFilter:B.targetFilter,scope:B.scope,protocolMatching:B.protocolMatching,params:B.params}}else if(B.type==="select_cards_to_delete"&&B.count>1)he={type:"select_cards_to_delete",count:B.count-1,sourceCardId:B.sourceCardId,disallowedIds:[...B.disallowedIds,n],actor:B.actor,followUpEffect:xe};else if(B.type==="select_card_from_other_lanes_to_delete"&&B.count>1){const He=o[I.owner].lanes.findIndex(vt=>vt.some(Ct=>Ct.id===n)),Ze=[...B.lanesSelected,He];[0,1,2].filter(vt=>vt!==B.disallowedLaneIndex&&!Ze.includes(vt)).some(vt=>ee.player.lanes[vt].length>0||ee.opponent.lanes[vt].length>0)?he={type:"select_card_from_other_lanes_to_delete",count:B.count-1,sourceCardId:B.sourceCardId,disallowedLaneIndex:B.disallowedLaneIndex,lanesSelected:Ze,actor:B.actor}:ee=re(ee,B.actor,"No cards left in remaining lanes. Effect skipped.")}}else if("count"in B&&B.count>1){const Te=ye?`${ye.card.protocol}-${ye.card.value}`:"the source card",He=!ye||!ye.card.isFaceUp?"the source is no longer active":"the source was covered";ee=re(ee,B.actor,`Remaining deletes from ${Te} were cancelled because ${He}.`)}let Ee=!1;if(console.log("[DELETE CALLBACK] wasTopCard:",z,"laneIndex:",ne,"cardInfo.owner:",I.owner),console.log("[DELETE CALLBACK] Lane after delete:",(Me=ee[I.owner].lanes[ne])==null?void 0:Me.map(Te=>`${Te.protocol}-${Te.value}`)),z){const Te=ee;console.log("[DELETE CALLBACK] Calling handleUncoverEffect for lane",ne);const He=_n(Te,I.owner,ne);console.log("[DELETE CALLBACK] Uncover result actionRequired:",(tt=He.newState.actionRequired)==null?void 0:tt.type);const Ze=He.newState._interruptedTurn!==void 0;Te._interruptedTurn&&!He.newState._interruptedTurn&&(Ee=!0);const Je=[...He.newState.queuedActions||[]];he&&(Ze?Je.push(he):Je.unshift(he)),ee={...He.newState,queuedActions:Je}}else he&&(ee.queuedActions=[...ee.queuedActions||[],he]);if(xe&&!he)if(console.log("[DELETE CALLBACK] Delete complete, has followUpEffect:",xe.id),console.log("[DELETE CALLBACK] Current actionRequired:",(Pt=ee.actionRequired)==null?void 0:Pt.type),ee.actionRequired){console.log("[DELETE CALLBACK] Queueing followUpEffect because uncover created actionRequired");const Te=ve(ee,B.sourceCardId),He=B.actor==="player"?"opponent":"player";let Ze=-1;Te&&(Ze=ee[Te.owner].lanes.findIndex(vt=>vt.some(Ct=>Ct.id===B.sourceCardId)));const Je={cardOwner:B.actor,actor:B.actor,currentTurn:ee.turn,opponent:He,triggerType:"start"},en={type:"execute_remaining_custom_effects",sourceCardId:B.sourceCardId,actor:B.actor,laneIndex:Ze,effects:[xe],context:Je};ee.queuedActions=[...ee.queuedActions||[],en]}else{const Te=ve(ee,B.sourceCardId),He=B.actor==="player"?"opponent":"player";if(Te){const Ze=ee[Te.owner].lanes.findIndex(Ct=>Ct.some(mt=>mt.id===B.sourceCardId)),Je={cardOwner:B.actor,actor:B.actor,currentTurn:ee.turn,opponent:He,triggerType:"start"},en=`${Te.card.protocol}-${Te.card.value}`;ee=Le(ee,en),ee=Qe(ee,"start"),ee=ot(Te.card,Ze,ee,Je,xe).newState,ee=Ye(ee)}else console.log("[DELETE CALLBACK] Source card not found for followUpEffect, using synthetic context"),(Qt=xe.params)!=null&&Qt.deleteSelf&&(ee=Le(ee,"the source card"),ee=Qe(ee,"start"),ee=internalDeleteCard(ee,B.sourceCardId).newState,ee=re(ee,B.actor,"Deletes itself."))}if(ee.actionRequired)return ee;if(ee.queuedActions&&ee.queuedActions.length>0){const Te=ee.queuedActions[0];if((Te==null?void 0:Te.type)==="execute_remaining_custom_effects"){const Je=po(ee);return Je.actionRequired?Je:V(Je)}const He=[...ee.queuedActions],Ze=He.shift();if((Ze==null?void 0:Ze.type)==="shift_flipped_card_optional"||(Ze==null?void 0:Ze.type)==="gravity_2_shift_after_flip"){const Je=ve(ee,Ze.sourceCardId),en=uo(ee,Ze.sourceCardId);if(!Je||!Je.card.isFaceUp||!en){const vt=Je?`${Je.card.protocol}-${Je.card.value}`:"the source card";let Ct=re(ee,Ze.actor,`Shift from ${vt} was cancelled because the source is no longer active.`);if(He.length>0){const mt=He.shift();return{...Ct,actionRequired:mt,queuedActions:He}}else return V({...Ct,actionRequired:null,queuedActions:[]})}}return{...ee,actionRequired:Ze,queuedActions:He}}if(Ee){if(console.log("[DELETE CALLBACK] Interrupt resolved, checking for queued actions"),ee.queuedActions&&ee.queuedActions.length>0){console.log("[DELETE CALLBACK] Found queued actions after interrupt:",ee.queuedActions.length);const Te=[...ee.queuedActions],He=Te.shift();if((He==null?void 0:He.type)==="execute_remaining_custom_effects"){const Ze={...ee,queuedActions:[He,...Te]},Je=po(Ze);return Je.actionRequired?Je:ee}return{...ee,actionRequired:He,queuedActions:Te}}return console.log("[DELETE CALLBACK] No queued actions after interrupt, returning early"),ee}if(console.log("[DELETE CALLBACK] Reached followUpEffect check. followUpEffect?",!!xe,"sourceCardInfo?",!!ye,"isFaceUp?",ye==null?void 0:ye.card.isFaceUp),xe&&ye&&ye.card.isFaceUp)if(!((xe.position||"middle")!=="top")||me){console.log("[Death-1 Follow-up] Executing follow-up effect after delete:",xe);const Je=ee[ye.owner].lanes.findIndex(_t=>_t.some(ho=>ho.id===B.sourceCardId)),en=B.actor==="player"?"opponent":"player",vt=xe.trigger||"on_play",Ct={cardOwner:B.actor,actor:B.actor,currentTurn:ee.turn,opponent:en,triggerType:vt};ee=ot(ye.card,Je,ee,Ct,xe).newState,console.log("[Death-1 Follow-up] Result actionRequired:",ee.actionRequired);const Ht=ve(ee,B.sourceCardId);if(console.log("[Death-1 Follow-up] Card still exists after deleteSelf?",!!Ht),ee.actionRequired)return ee}else console.log("[Death-1 Follow-up] Follow-up effect requires uncovered but card is covered");else console.log("[Death-1 Follow-up] No follow-up effect or source card not valid:",{hasFollowUp:!!xe,hasSourceCard:!!ye,isFaceUp:ye==null?void 0:ye.card.isFaceUp,isUncovered:me});return V(ee)}},s=!1;break}case"plague_4_opponent_delete":{const D=ve(o,n);if(!D)return{nextState:o};const E=o.actionRequired.actor;r=re(r,E,"Plague-4: Opponent deletes one of their face-down cards.");const j={...r.stats[E],cardsDeleted:r.stats[E].cardsDeleted+1},I={...r[E],stats:j};r={...r,[E]:I,stats:{...r.stats,[E]:j}};const k=o[D.owner].lanes.findIndex(T=>T.some(Q=>Q.id===n)),L=o[D.owner].lanes[k],G=L&&L.length>0&&L[L.length-1].id===n;r=Ye(r),r.actionRequired=null,i={animationRequests:[{type:"delete",cardId:n,owner:D.owner}],onCompleteCallback:(T,Q)=>{let M=Dt(T,"after_delete",{player:E}).newState;G&&(M=_n(M,D.owner,k).newState);const $=ve(M,o.actionRequired.sourceCardId),W=($==null?void 0:$.owner)||o.turn,P={type:"plague_4_player_flip_optional",sourceCardId:o.actionRequired.sourceCardId,optional:!0,actor:W};return M.actionRequired?M.queuedActions=[...M.queuedActions||[],P]:M.actionRequired=P,M}},s=!1;break}case"select_card_to_return":{const{sourceCardId:D,actor:E}=o.actionRequired,j=(A=o.actionRequired)==null?void 0:A.followUpEffect,I=(S=o.actionRequired)==null?void 0:S.conditionalType,k=(N=o.actionRequired)==null?void 0:N.targetFilter,L=ve(o,n);if(L){const T=o[L.owner].lanes[L.laneIndex],Q=((q=T[T.length-1])==null?void 0:q.id)===n,X=(k==null?void 0:k.position)==="covered"||(k==null?void 0:k.position)==="any";if(!Q&&!X)return console.error(`[cardResolver] Invalid return target: ${L.card.protocol}-${L.card.value} is covered`),{nextState:o,requiresTurnEnd:!1}}const G=ad(o,n);if(r=G.newState,G.animationRequests)i={animationRequests:G.animationRequests,onCompleteCallback:(T,Q)=>{if(T.actionRequired)return T;let X=T;if(j&&D&&(I!=="if_executed"||n)){console.log("[cardResolver] Executing followUpEffect after return");const $=ve(X,D);if($&&$.card.isFaceUp){const W=X[$.owner].lanes.find(z=>z.some(H=>H.id===D)),P=X[$.owner].lanes.indexOf(W),ne={cardOwner:$.owner,actor:E,currentTurn:X.turn,opponent:$.owner==="player"?"opponent":"player"};if(X=ot($.card,P,X,ne,j).newState,X.actionRequired)return X}}return Q(X)}};else if(j&&D&&(I!=="if_executed"||n)){console.log("[cardResolver] Executing followUpEffect after return (no animation)");const Q=ve(r,D);if(Q&&Q.card.isFaceUp){const X=r[Q.owner].lanes.find(P=>P.some(ne=>ne.id===D)),M=r[Q.owner].lanes.indexOf(X),$={cardOwner:Q.owner,actor:E,currentTurn:r.turn,opponent:Q.owner==="player"?"opponent":"player"};r=ot(Q.card,M,r,$,j).newState}}r=Ye(r),s=!r.actionRequired&&(!r.queuedActions||r.queuedActions.length===0);break}case"select_opponent_card_to_return":{const{sourceCardId:D,actor:E}=o.actionRequired,j=ad(o,n);let I=j.newState;if(I.actionRequired){const k={type:"flip_self",sourceCardId:D,actor:E};I.queuedActions=[k,...I.queuedActions||[]],r=I,s=!1}else{const k=ve(I,D);if(k){const L=`${k.card.protocol}-${k.card.value}`;I=re(I,E,`${L}: Flips itself.`),I=ha(new Set([D]),I),I.animationState={type:"flipCard",cardId:D}}r=I,s=!0}j.animationRequests&&(i={animationRequests:j.animationRequests,onCompleteCallback:(k,L)=>k.actionRequired?k:L(k)}),r=Ye(r),s||(s=!r.actionRequired&&(!r.queuedActions||r.queuedActions.length===0));break}case"select_any_card_to_flip":{const D=ve(o,n),{count:E,sourceCardId:j,actor:I}=o.actionRequired,k=ve(o,j);if(!k||!k.card.isFaceUp){const T=k?`${k.card.protocol}-${k.card.value}`:"a card";r=re(o,I,`Effect from ${T} was cancelled because the source is no longer active.`),r=Ye(r),r.actionRequired=null,s=!0;break}let L=null;E>1&&(L={type:"select_any_card_to_flip",count:E-1,sourceCardId:j,actor:I});let G=od(o,n,L);if(D&&!D.card.isFaceUp){const T=ld(G,n),Q=T.newState.actionRequired;Q&&Q!==L&&L&&(T.newState.queuedActions=[...T.newState.queuedActions||[],L]),r=T.newState,T.animationRequests&&(i={animationRequests:T.animationRequests,onCompleteCallback:(X,M)=>X.actionRequired||X.queuedActions&&X.queuedActions.length>0?X:M(X)})}else r=G;r=Ye(r),s=!r.actionRequired&&(!r.queuedActions||r.queuedActions.length===0);break}case"select_board_card_to_reveal_custom":{const{sourceCardId:D,actor:E,followUpAction:j,optional:I}=o.actionRequired,k=E.charAt(0).toUpperCase()+E.slice(1),L=ve(o,n);if(!L)return{nextState:o,requiresTurnEnd:!0};const G=L.owner,T=o[G].lanes.findIndex(W=>W.some(P=>P.id===n));if(T===-1)return{nextState:o,requiresTurnEnd:!0};const Q=[...o[G].lanes[T]],X=Q.findIndex(W=>W.id===n);if(X===-1)return{nextState:o,requiresTurnEnd:!0};Q[X]={...Q[X],isFaceUp:!0};const M=[...o[G].lanes];M[T]=Q,r={...o,[G]:{...o[G],lanes:M}};const $=`${Q[X].protocol}-${Q[X].value}`;r=re(r,E,`${k} reveals ${$}.`),r.actionRequired={type:"prompt_shift_or_flip_board_card_custom",sourceCardId:D,revealedCardId:n,followUpAction:j,optional:I!==!1,actor:E},s=!1;break}default:return{nextState:o,requiresTurnEnd:!0}}if(!i&&r.actionRequired===null){if(r.queuedActions&&r.queuedActions.length>0){const D=[...r.queuedActions],E=D.shift();if((E==null?void 0:E.type)==="execute_remaining_custom_effects")return{nextState:{...Ye(r),actionRequired:null,queuedActions:[E,...D]},requiresTurnEnd:!1};if((E==null?void 0:E.type)==="shift_flipped_card_optional"||(E==null?void 0:E.type)==="gravity_2_shift_after_flip"){const j=ve(r,E.sourceCardId),I=uo(r,E.sourceCardId);if(!j||!j.card.isFaceUp||!I){const k=j?`${j.card.protocol}-${j.card.value}`:"the source card",L=re(r,E.actor,`Shift from ${k} was cancelled because the source is no longer active.`);if(D.length>0){const G=D.shift();return(G==null?void 0:G.type)==="execute_remaining_custom_effects"?{nextState:{...L,queuedActions:[G,...D]},requiresTurnEnd:!1}:{nextState:{...L,actionRequired:G,queuedActions:D},requiresTurnEnd:!1}}else return{nextState:{...L,actionRequired:null,queuedActions:[]},requiresTurnEnd:!0}}}return(E==null?void 0:E.type)==="execute_remaining_custom_effects"?{nextState:{...r,queuedActions:[E,...D]},requiresTurnEnd:!1}:{nextState:{...r,actionRequired:E,queuedActions:D},requiresTurnEnd:!1}}}else!i&&r.actionRequired!==null&&(s=!1);return{nextState:r,requiresAnimation:i,requiresTurnEnd:s}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const kc=(o,n,r,s,i)=>{const d={...o[i]},f=d.hand.find(k=>k.id===n);if(!f)return{newState:o};const m=so(o,i,r,s,f.protocol);if(!m.allowed)return console.error(`Illegal Move: ${i} tried to play ${f.protocol}-${f.value} - ${m.reason}`),{newState:o};const h=i==="player"?"opponent":"player",p=o[h].lanes[r],y=p.length>0?p[p.length-1]:null;if(y&&y.isFaceUp&&y.protocol==="Plague"&&y.value===0)return{newState:o};if(!s&&y&&y.isFaceUp&&y.protocol==="Metal"&&y.value===2)return console.error(`Illegal Move: ${i} tried to play face-down against Metal-2 in lane ${r}`),{newState:o};if(s){const k=d.protocols[r],L=o[h].protocols[r],G=o[h].lanes.flat().some(P=>P.isFaceUp&&P.protocol==="Psychic"&&P.value===1),T=[...o.player.lanes.flat(),...o.opponent.lanes.flat()].some(P=>P.isFaceUp&&P.protocol==="Anarchy"&&P.value===1),Q=Oc(o),X=o[i].lanes.flat().some(P=>P.isFaceUp&&P.protocol==="Spirit"&&P.value===1),M=o[i].lanes.some(P=>{if(P.length===0)return!1;const ne=P[P.length-1];return ne.isFaceUp&&ne.protocol==="Chaos"&&ne.value===3}),$=Lc(o,i,r);let W;if(T||Q?W=f.protocol!==k&&f.protocol!==L&&!G:W=(f.protocol===k||f.protocol===L||X||M||$)&&!G,!W){const P=T||Q?"Non-matching protocol required":"matching protocol required";return console.error(`Illegal Move: ${i} tried to play ${f.protocol}-${f.value} face-up in lane ${r} (${P}, protocols: player=${k}, opponent=${L})`),{newState:o}}}let v={newState:o};const x=o[i].lanes[r];if(x.length>0){const k=x[x.length-1];let G=Dt(o,"on_cover",{player:i,cardId:k.id}).newState;if(G[i].lanes[r].some(X=>X.id===k.id)&&k.isFaceUp){const X={cardOwner:i,actor:i,currentTurn:G.turn,opponent:i==="player"?"opponent":"player",triggerType:"cover"};v=fd(k,r,G,X)}else v={newState:G}}const _=v.newState,w={..._[i]},U={...f,isFaceUp:s,isRevealed:!1},C={...w.stats,cardsPlayed:w.stats.cardsPlayed+1},A={...w,hand:w.hand.filter(k=>k.id!==n),lanes:w.lanes.map((k,L)=>L===r?[...k,U]:k),stats:C};let S={..._,[i]:A,stats:{..._.stats,[i]:C}};const N=o.queuedActions||[],q=_.queuedActions||[];q===N||q.length===N.length&&q.every((k,L)=>k===N[L])?N.length>0&&(S.queuedActions=N):(console.log("[DEBUG] playCard - Merging queuedActions: oldQueue:",N.length,"coverQueue:",q.length),S.queuedActions=[...N,...q]),S.lastPlayedCardId=U.id,S=_e(S),S=Le(S,void 0),S=Qe(S,void 0);const D=i==="player"?"Player":"Opponent",E=S[i].protocols[r];let j;if(i==="opponent"&&!s)j=`${D} plays a face-down card into Protocol ${E}.`;else{const k=`${f.protocol}-${f.value}`;j=`${D} plays ${k}`,s||(j+=" face-down"),j+=` into Protocol ${E}.`}if(S=re(S,i,j),S=Dt(S,"after_play",{player:i,cardId:U.id}).newState,_.actionRequired)return s&&(S.queuedEffect={card:U,laneIndex:r}),{newState:S,animationRequests:v.animationRequests};{if(i==="opponent")return s&&(S.queuedEffect={card:U,laneIndex:r}),{newState:S,animationRequests:v.animationRequests};let k={newState:S};if(s&&!S.actionRequired){const G={cardOwner:i,actor:i,currentTurn:S.turn,opponent:i==="player"?"opponent":"player",triggerType:"play"};k=pr(U,r,S,G)}const L=[...v.animationRequests||[],...k.animationRequests||[]];return{newState:k.newState,animationRequests:L.length>0?L:void 0}}},fr=(o,n)=>{console.log("[DEBUG performFillHand] Called for player:",n,"Current hand length:",o[n].hand.length);let r=Le(o,void 0);r=Qe(r,void 0),r={...r,_logIndentLevel:0};const s=d_(r,n);return console.log("[DEBUG performFillHand] After refresh, hand length:",s[n].hand.length),s},Ih=(o,n)=>{if(o.useControlMechanic&&o.controlCardHolder===n){let r=re(o,n,`${n==="player"?"Player":"Opponent"} has Control and may rearrange protocols before refreshing.`);return r=kn(r),{...r,controlCardHolder:null,actionRequired:{type:"prompt_use_control_mechanic",sourceCardId:"CONTROL_MECHANIC",actor:n,originalAction:{type:"fill_hand"}}}}return fr(o,n)};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const cd=(o,n)=>{var i,d,f,m,h,p,y,v,x,_,w,U,C,A,S,N,q,D,E;if(!o.actionRequired)return{nextState:o};let r={...o},s=null;switch(o.actionRequired.type){case"select_lane_for_shift_all":{const{cardsToShift:j,validDestinationLanes:I,sourceLaneIndex:k,actor:L,sourceCardId:G}=o.actionRequired;if(!I.includes(n))return console.error(`Illegal shift: Lane ${n} is not a valid destination`),{nextState:o};if(n===k)return console.error(`Illegal shift: Cannot shift to the same lane ${k}`),{nextState:o};let T={...o};const Q=[];for(const{cardId:X,owner:M}of j){if(!ve(T,X))continue;const W=T[M].lanes.findIndex(F=>F.some(z=>z.id===X));if(W===-1)continue;const P=Nc(T,W,n);if(!P.allowed){console.log(`Card ${X} cannot be shifted: ${P.reason}`);continue}const ne=fa(T,X,M,n,L);T=ne.newState,ne.animationRequests&&Q.push(...ne.animationRequests)}if(r=T,r=Ye(r),r.actionRequired=null,Q.length>0){const X=(i=o.actionRequired)==null?void 0:i.followUpEffect,M=(d=o.actionRequired)==null?void 0:d.conditionalType;s={animationRequests:Q,onCompleteCallback:($,W)=>{if($.actionRequired||$.queuedActions&&$.queuedActions.length>0)return $;let P=$;if(X&&G&&(M!=="if_executed"||Q.length>0)){const F=ve(P,G);if(F&&F.card.isFaceUp){const z=P[F.owner].lanes.find(B=>B.some(J=>J.id===G)),H=P[F.owner].lanes.indexOf(z),V={cardOwner:F.owner,actor:L,currentTurn:P.turn,opponent:F.owner==="player"?"opponent":"player"};if(P=ot(F.card,H,P,V,X).newState,P.actionRequired)return P}}return W(P)}}}break}case"select_lane_for_shift":{const{cardToShiftId:j,cardOwner:I,actor:k,sourceEffect:L,originalLaneIndex:G,sourceCardId:T}=o.actionRequired;if(n===G)return console.error(`Illegal shift: Cannot shift to the same lane ${G}`),{nextState:o};const Q=ve(o,T),X=ve(o,j);if(Q&&Q.card.protocol==="Anarchy"&&Q.card.value===1&&X&&X.card.isFaceUp){const P=o.player.protocols[n],ne=o.opponent.protocols[n],F=X.card.protocol;if(F===P||F===ne)return console.error(`Illegal Anarchy-1 shift: ${F}-${X.card.value} cannot be shifted to lane ${n} (protocols: ${P}/${ne}) - matching protocol not allowed`),{nextState:o}}if(Q&&Q.card.protocol==="Gravity"&&Q.card.value===1){let P=-1;for(let ne=0;ne<o[Q.owner].lanes.length;ne++)if(o[Q.owner].lanes[ne].some(F=>F.id===T)){P=ne;break}if(P!==-1&&!(G===P)&&!(n===P))return console.error(`Illegal Gravity-1 shift: Must shift to or from Gravity lane ${P}, but tried ${G}  ${n}`),{nextState:o}}if(o.actionRequired.destinationRestriction&&X){const P=o.actionRequired.destinationRestriction;if(P.type==="non_matching_protocol"&&X.card.isFaceUp){const ne=o.player.protocols[n],F=o.opponent.protocols[n],z=X.card.protocol;if(z===ne||z===F)return console.error(`Illegal shift: ${z} cannot be shifted to lane ${n} (protocols: ${ne}/${F}) - matching protocol not allowed`),{nextState:o}}if(P.type==="to_or_from_this_lane"){const ne=P.laneIndex==="current"&&Q?(()=>{for(let F=0;F<o[Q.owner].lanes.length;F++)if(o[Q.owner].lanes[F].some(z=>z.id===T))return F;return-1})():P.laneIndex;if(ne!==void 0&&ne!==-1&&!(G===ne)&&!(n===ne))return console.error(`Illegal shift: Must shift to or from lane ${ne}, but tried ${G}  ${n}`),{nextState:o}}}const M=Nc(o,G,n);if(!M.allowed)return console.error(`Illegal shift: Cannot shift from lane ${G} to ${n} - ${M.reason}`),{nextState:o};const $=fa(o,j,I,n,k);r=$.newState;const W=r.actionRequired!==null;if($.animationRequests)s={animationRequests:$.animationRequests,onCompleteCallback:(P,ne)=>{var B,J,ee,he;let F=P;if(W){if(L==="speed_3_end"){const Ue={type:"speed_3_self_flip_after_shift",sourceCardId:o.actionRequired.sourceCardId,actor:k};F.queuedActions=[...F.queuedActions||[],Ue]}const ye=(B=o.actionRequired)==null?void 0:B.followUpEffect,me=(J=o.actionRequired)==null?void 0:J.conditionalType;if(ye&&T&&(me!=="if_executed"||j)){console.log("[laneResolver ANIM select_lane_for_shift] Queueing followUpEffect due to uncover interrupt:",ye.id);const Ue={type:"execute_follow_up_effect",sourceCardId:T,followUpEffect:ye,actor:k};F.queuedActions=[...F.queuedActions||[],Ue]}ve(F,T);const xe=F._pendingCustomEffects;if(xe){console.log(`[laneResolver] Queueing ${xe.effects.length} pending effects due to interrupt`);const Ee=ve(F,xe.sourceCardId);if(Ee&&Ee.card.isFaceUp){const Ue=F[Ee.owner].lanes.find(Se=>Se.some(Me=>Me.id===xe.sourceCardId));if(Ue&&Ue.length>0&&Ue[Ue.length-1].id===xe.sourceCardId){const Se={type:"execute_remaining_custom_effects",sourceCardId:xe.sourceCardId,laneIndex:xe.laneIndex,effects:xe.effects,context:xe.context,actor:k};F.queuedActions=[...F.queuedActions||[],Se]}}delete F._pendingCustomEffects}return F}if(L==="speed_3_end"){const ye=o.actionRequired.sourceCardId;F=re(F,k,"Speed-3: Flipping itself after shifting a card."),F=ha(new Set([ye]),F),F.animationState={type:"flipCard",cardId:ye}}const z=F._pendingCustomEffects;if(z){console.log(`[laneResolver] Executing ${z.effects.length} pending effects after shift`);const ye=ve(F,z.sourceCardId);if(ye&&ye.card.isFaceUp){const me=F[ye.owner].lanes.find(Ee=>Ee.some(Ue=>Ue.id===z.sourceCardId));if(me&&me.length>0&&me[me.length-1].id===z.sourceCardId){for(const Ee of z.effects)F=ot(ye.card,z.laneIndex,F,z.context,Ee).newState;delete F._pendingCustomEffects}else F=re(F,k,"Pending effects cancelled because source card is now covered."),delete F._pendingCustomEffects}else delete F._pendingCustomEffects}T&&(F=fo(F)),F=Dt(F,"after_shift",{player:k,cardId:j}).newState;const V=(ee=o.actionRequired)==null?void 0:ee.followUpEffect,Y=(he=o.actionRequired)==null?void 0:he.conditionalType;if(console.log("[laneResolver] After shift - followUpEffect:",V==null?void 0:V.id,"conditionalType:",Y,"sourceCardId:",T,"cardToShiftId:",j),V&&T&&(Y!=="if_executed"||j)){console.log("[laneResolver] Executing followUpEffect after shift");const me=ve(F,T);if(me&&me.card.isFaceUp){const xe=F[me.owner].lanes.find(Se=>Se.some(Me=>Me.id===T)),Ee=F[me.owner].lanes.indexOf(xe),Ue={cardOwner:me.owner,actor:k,currentTurn:F.turn,opponent:me.owner==="player"?"opponent":"player"};F=ot(me.card,Ee,F,Ue,V).newState}}if(F=Ye(F),F.actionRequired=null,F.queuedActions&&F.queuedActions.length>0){const ye=F.queuedActions[0];ye.type==="execute_remaining_custom_effects"?(F=po(F),F.animationState&&(F={...F,animationState:null})):(F.queuedActions=F.queuedActions.slice(1),F.actionRequired=ye)}return F._interruptedTurn?dr(F):ne(F)}};else if(W){if(L==="speed_3_end"){const z={type:"speed_3_self_flip_after_shift",sourceCardId:o.actionRequired.sourceCardId,actor:k};r.queuedActions=[...r.queuedActions||[],z]}const P=(f=o.actionRequired)==null?void 0:f.followUpEffect,ne=(m=o.actionRequired)==null?void 0:m.conditionalType;if(P&&T&&(ne!=="if_executed"||j)){console.log("[laneResolver select_lane_for_shift] Queueing followUpEffect due to uncover interrupt:",P.id);const z={type:"execute_follow_up_effect",sourceCardId:T,followUpEffect:P,actor:k};r.queuedActions=[...r.queuedActions||[],z]}}else{if(L==="speed_3_end"){const H=o.actionRequired.sourceCardId;r=re(r,k,"Speed-3: Flipping itself after shifting a card."),r=ha(new Set([H]),r),r.animationState={type:"flipCard",cardId:H}}const P=r._pendingCustomEffects;if(P){console.log(`[laneResolver NO ANIM] Executing ${P.effects.length} pending effects after shift`);const H=ve(r,P.sourceCardId);if(H&&H.card.isFaceUp){const V=r[H.owner].lanes.find(B=>B.some(J=>J.id===P.sourceCardId));if(V&&V.length>0&&V[V.length-1].id===P.sourceCardId){for(const B of P.effects)r=ot(H.card,P.laneIndex,r,P.context,B).newState;delete r._pendingCustomEffects}else r=re(r,k,"Pending effects cancelled because source card is now covered."),delete r._pendingCustomEffects}else delete r._pendingCustomEffects}T&&(r=fo(r)),r=Dt(r,"after_shift",{player:k,cardId:j}).newState;const F=(h=o.actionRequired)==null?void 0:h.followUpEffect,z=(p=o.actionRequired)==null?void 0:p.conditionalType;if(console.log("[laneResolver NO ANIM] After shift - followUpEffect:",F==null?void 0:F.id,"conditionalType:",z,"sourceCardId:",T,"cardToShiftId:",j),F&&T&&(z!=="if_executed"||j)){console.log("[laneResolver NO ANIM] Executing followUpEffect after shift");const V=ve(r,T);if(V&&V.card.isFaceUp){const Y=r[V.owner].lanes.find(he=>he.some(ye=>ye.id===T)),B=r[V.owner].lanes.indexOf(Y),J={cardOwner:V.owner,actor:k,currentTurn:r.turn,opponent:V.owner==="player"?"opponent":"player"};r=ot(V.card,B,r,J,F).newState}}if(r=Ye(r),r.actionRequired=null,r.queuedActions&&r.queuedActions.length>0){const H=r.queuedActions[0];if(H.type==="execute_remaining_custom_effects"){if(r=po(r),r.animationState&&!r.actionRequired){const V=r.animationState;V.type==="draw"&&(s={animationRequests:[{type:"draw",player:V.player,count:V.count}],onCompleteCallback:(Y,B)=>{const J={...Y,animationState:null};return B(J)}},r={...r,animationState:null})}}else r.queuedActions=r.queuedActions.slice(1),r.actionRequired=H}}break}case"shift_flipped_card_optional":{const j=o.actionRequired.cardId,I=o.actionRequired.actor;console.log("[DEBUG shift_flipped_card_optional] === START ==="),console.log("[DEBUG shift_flipped_card_optional] actionRequired:",JSON.stringify(o.actionRequired,null,2));let k=null;for(const X of["player","opponent"])if(o[X].lanes.flat().some(M=>M.id===j)){k=X;break}if(!k){console.error("[shift_flipped_card_optional] Card not found on board:",j),r=o;break}const L=(y=o.actionRequired)==null?void 0:y.followUpEffect,G=(v=o.actionRequired)==null?void 0:v.conditionalType,T=(x=o.actionRequired)==null?void 0:x.sourceCardId;console.log("[DEBUG shift_flipped_card_optional] followUpEffect:",L?L.id:"NONE"),console.log("[DEBUG shift_flipped_card_optional] conditionalType:",G),console.log("[DEBUG shift_flipped_card_optional] sourceCardId:",T);const Q=fa(o,j,k,n,I);if(r=Q.newState,L&&T&&(G!=="if_executed"||j)){const M={type:"execute_follow_up_effect",sourceCardId:T,followUpEffect:L,actor:I};r={...r,queuedActions:[...r.queuedActions||[],M]},console.log("[shift_flipped_card_optional] Queued followUpEffect for later execution:",L.id)}Q.animationRequests&&(s={animationRequests:Q.animationRequests,onCompleteCallback:(X,M)=>M(X)});break}case"select_lane_for_play":{const{cardInHandId:j,isFaceDown:I,actor:k,source:L,disallowedLaneIndex:G}=o.actionRequired;if(G!==void 0&&n===G)return console.log(`[Lane Validation] Rejected: Cannot play to disallowed lane ${G}`),{nextState:o,requiresTurnEnd:!1};if(L==="deck"){console.log("[select_lane_for_play] Playing from deck to lane",n);const W={...o,actionRequired:null},P=W[k],{drawnCards:ne,remainingDeck:F,newDiscard:z}=Tn(P.deck,P.discard,1);if(ne.length===0){console.error("No cards in deck/discard to play"),r=W;break}const H={...ne[0],id:Ge(),isFaceUp:!I},V=[...P.lanes];V[n]=[...V[n],H];const Y={...P,lanes:V,deck:F,discard:z};r={...W,[k]:Y},s={animationRequests:[{type:"play",cardId:H.id,owner:k,laneIndex:n,isFaceUp:H.isFaceUp}],onCompleteCallback:(B,J)=>J(B)};break}const T=o[k].hand.find(W=>W.id===j);if(!T){console.error("Card for play not found in hand"),r={...o,actionRequired:null};break}const Q={...o,actionRequired:null};let X;if(typeof I=="boolean")X=!I;else{const W=o[k].lanes.flat().some(z=>z.isFaceUp&&z.protocol==="Spirit"&&z.value===1),P=o[k].lanes.some(z=>{if(z.length===0)return!1;const H=z[z.length-1];return H.isFaceUp&&H.protocol==="Chaos"&&H.value===3}),ne=k==="player"?"opponent":"player",F=o[ne].lanes.flat().some(z=>z.isFaceUp&&z.protocol==="Psychic"&&z.value===1);X=(W||P||T.protocol===o[k].protocols[n]||T.protocol===o[ne].protocols[n])&&!F}const{newState:M,animationRequests:$}=kc(Q,j,n,X,k);r=M,console.log("[LANE RESOLVER] After playCard - actionRequired?",((_=r.actionRequired)==null?void 0:_.type)||"null","queuedActions?",((w=r.queuedActions)==null?void 0:w.length)||0,"animationRequests?",($==null?void 0:$.length)||0),$&&(s={animationRequests:$,onCompleteCallback:(W,P)=>{var ne;return console.log("[PLAY CALLBACK] Animation complete. queuedActions?",((ne=W.queuedActions)==null?void 0:ne.length)||0),W.queuedActions&&W.queuedActions.length>0&&console.log("[PLAY CALLBACK] Queue found! First action:",W.queuedActions[0].type),console.log("[PLAY CALLBACK] Calling endTurnCb"),P(W)}});break}case"select_lane_for_delete":{const j=o.actionRequired.actor,I=j==="player"?"Player":"Opponent",k=o.player.protocols[n],L=o.actionRequired.targetFilter||{},G=ve(o,o.actionRequired.sourceCardId),T=G?`${G.card.protocol}-${G.card.value}`:"a card effect";r=re(r,j,`${T}: ${I} targets Protocol ${k}.`);const Q=new Map;for(const W of["player","opponent"]){const P=o[W].lanes[n];Q.set(W,P.length>0?P[P.length-1].id:null)}const X=[],M=[],$=new Set;for(const W of["player","opponent"]){const P=o[W],ne=P.lanes[n].some(F=>F.isFaceUp&&F.protocol==="Darkness"&&F.value===2)?4:2;for(const F of P.lanes[n]){const z=F.isFaceUp?F.value:ne;if(L.valueRange){const{min:Y,max:B}=L.valueRange;if(z<Y||z>B)continue}if(L.faceState==="face_up"&&!F.isFaceUp||L.faceState==="face_down"&&F.isFaceUp||L.owner==="own"&&W!==j||L.owner==="opponent"&&W===j)continue;X.push({type:"delete",cardId:F.id,owner:W}),$.add(F.id);const H=W==="player"?"Player's":"Opponent's",V=F.isFaceUp?`${F.protocol}-${F.value}`:"a face-down card";M.push(`${H} ${V}`)}}if(M.length>0){r=re(r,j,`${T}: Deleting ${M.join(", ")}.`);const W={...r.stats[j],cardsDeleted:r.stats[j].cardsDeleted+M.length},P={...r[j],stats:W};r={...r,[j]:P,stats:{...r.stats,[j]:W}}}if(r=Ye(r),r.actionRequired=null,X.length>0){const W=(U=o.actionRequired)==null?void 0:U.followUpEffect,P=(C=o.actionRequired)==null?void 0:C.conditionalType,ne=o.actionRequired.sourceCardId;s={animationRequests:X,onCompleteCallback:(F,z)=>{let H=F;H=Dt(H,"after_delete",{player:j}).newState;const Y=[];for(const B of["player","opponent"]){const J=Q.get(B),ee=H[B].lanes[n];J&&$.has(J)&&ee.length>0&&Y.push(B)}for(let B=0;B<Y.length;B++){const J=Y[B];if(H=_n(H,J,n).newState,H.actionRequired&&B<Y.length-1){const he=Y.slice(B+1);for(const ye of he)H.queuedActions=[...H.queuedActions||[],{type:"pending_uncover_effect",owner:ye,laneIndex:n}];return H}}if(W&&ne&&(P!=="if_executed"||X.length>0)){const J=ve(H,ne);if(J&&J.card.isFaceUp){const ee=H[J.owner].lanes.find(xe=>xe.some(Ee=>Ee.id===ne)),he=H[J.owner].lanes.indexOf(ee),ye={cardOwner:J.owner,actor:j,currentTurn:H.turn,opponent:J.owner==="player"?"opponent":"player"};if(H=ot(J.card,he,H,ye,W).newState,H.actionRequired)return H}}return z(H)}}}break}case"select_lane_for_return":{const j=o.actionRequired.actor,I=j==="player"?"Player":"Opponent",k=o.player.protocols[n],L=o.actionRequired.targetFilter||{},G=ve(o,o.actionRequired.sourceCardId),T=G?`${G.card.protocol}-${G.card.value}`:"a card effect";r=re(r,j,`${T}: ${I} targets Protocol ${k}.`);const Q=[],X=[];for(const M of["player","opponent"]){const $=o[M],W=$.lanes[n].some(P=>P.isFaceUp&&P.protocol==="Darkness"&&P.value===2)?4:2;for(const P of $.lanes[n]){const ne=P.isFaceUp?P.value:W;if(L.valueEquals!==void 0&&ne!==L.valueEquals||L.faceState==="face_up"&&!P.isFaceUp||L.faceState==="face_down"&&P.isFaceUp||L.owner==="own"&&M!==j||L.owner==="opponent"&&M===j)continue;Q.push({type:"return",cardId:P.id,owner:M});const F=M==="player"?"Player's":"Opponent's",z=P.isFaceUp?`${P.protocol}-${P.value}`:"a face-down card";X.push(`${F} ${z}`)}}if(Q.length===0){r=re(r,j,`${T}: No matching cards in Protocol ${k}.`),r=Ye(r),r.actionRequired=null;break}if(X.length>0&&(r=re(r,j,`${T}: Returning ${X.join(", ")}.`)),r=Ye(r),r.actionRequired=null,Q.length>0){const M=(A=o.actionRequired)==null?void 0:A.followUpEffect,$=(S=o.actionRequired)==null?void 0:S.conditionalType,W=o.actionRequired.sourceCardId;s={animationRequests:Q,onCompleteCallback:(P,ne)=>{let F=P;if(M&&W&&($!=="if_executed"||Q.length>0)){const H=ve(F,W);if(H&&H.card.isFaceUp){const V=F[H.owner].lanes.find(ee=>ee.some(he=>he.id===W)),Y=F[H.owner].lanes.indexOf(V),B={cardOwner:H.owner,actor:j,currentTurn:F.turn,opponent:H.owner==="player"?"opponent":"player"};if(F=ot(H.card,Y,F,B,M).newState,F.actionRequired)return F}}return ne(F)}}}break}case"select_lane_for_delete_all":{const j=o.actionRequired.actor,I=j==="player"?"Player":"Opponent",k=o.player.protocols[n],L=o.actionRequired.minCards||8;if(!(o.actionRequired.validLanes||[0,1,2]).includes(n)){r=re(r,j,"Cannot select this lane for deletion.");break}const T=o.player.lanes[n].length+o.opponent.lanes[n].length;if(T<L){r=re(r,j,`Cannot delete ${k} line (only ${T} cards, need ${L}+).`),r=Ye(r),r.actionRequired=null;break}const Q=ve(o,o.actionRequired.sourceCardId),X=Q?`${Q.card.protocol}-${Q.card.value}`:"Effect";r=re(r,j,`${X}: ${I} deletes all cards in ${k} line.`);const M=[];for(const P of["player","opponent"])for(const ne of o[P].lanes[n])M.push({type:"delete",cardId:ne.id,owner:P});const $={...r.stats[j],cardsDeleted:r.stats[j].cardsDeleted+M.length},W={...r[j],stats:$};if(r={...r,[j]:W,stats:{...r.stats,[j]:$}},r=Ye(r),r.actionRequired=null,M.length>0){const P=(N=o.actionRequired)==null?void 0:N.followUpEffect,ne=(q=o.actionRequired)==null?void 0:q.conditionalType,F=o.actionRequired.sourceCardId;s={animationRequests:M,onCompleteCallback:(z,H)=>{let V=z;if(V=Dt(V,"after_delete",{player:j}).newState,P&&F&&(ne!=="if_executed"||M.length>0)){const J=ve(V,F);if(J&&J.card.isFaceUp){const ee=V[J.owner].lanes.find(xe=>xe.some(Ee=>Ee.id===F)),he=V[J.owner].lanes.indexOf(ee),ye={cardOwner:J.owner,actor:j,currentTurn:V.turn,opponent:J.owner==="player"?"opponent":"player"};if(V=ot(J.card,he,V,ye,P).newState,V.actionRequired)return V}}return H(V)}}}break}case"select_lane_to_shift_revealed_board_card_custom":{const{revealedCardId:j,actor:I}=o.actionRequired,k=ve(o,j);if(console.log("[DEBUG Light-2 Shift] Card before shift:",k==null?void 0:k.card.protocol,k==null?void 0:k.card.value,"isFaceUp:",k==null?void 0:k.card.isFaceUp),k){const L=fa(o,j,k.owner,n,I);r=L.newState,L.animationRequests&&(s={animationRequests:L.animationRequests,onCompleteCallback:(G,T)=>G.actionRequired?G:T(G)})}break}default:return{nextState:o}}return console.log("[LANE RESOLVER END] Returning - actionRequired?",((D=r.actionRequired)==null?void 0:D.type)||"null","queuedActions?",((E=r.queuedActions)==null?void 0:E.length)||0,"requiresAnimation?",s?"yes":"no"),{nextState:_e(r),requiresAnimation:s}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const uh=(o,n)=>{if(o.processedSpeed1TriggerThisTurn)return o;if(o[n].lanes.flat().some(i=>i.isFaceUp&&i.protocol==="Speed"&&i.value===1)){let i={...o};return i=Le(i,"Speed-1"),i=Qe(i,void 0),i=re(i,n,"Triggers after clearing cache: Draw 1 card."),i=ga(i,n,1),i.processedSpeed1TriggerThisTurn=!0,i=Le(i,void 0),i.phase="end",i}return o},pa=(o,n,r)=>{var j,I,k,L;const s=o[r],i=new Set(n),d=s.hand.filter(G=>i.has(G.id));if(d.length===0)return o;const f=s.hand.filter(G=>!i.has(G.id)),m=[...s.discard,...d.map(({id:G,isFaceUp:T,...Q})=>Q)],h=((j=o.animationState)==null?void 0:j.type)==="discardCard"&&((I=o.animationState.originalAction)==null?void 0:I.type)==="discard"?o.animationState.originalAction:((k=o.actionRequired)==null?void 0:k.type)==="discard"?o.actionRequired:null,p={...s.stats,cardsDiscarded:s.stats.cardsDiscarded+d.length},y={...s,hand:f,discard:m,stats:p},v=h==null?void 0:h.followUpEffect,x=h==null?void 0:h.conditionalType,_=h==null?void 0:h.previousHandSize;let w={...o,[r]:y,stats:{...o.stats,[r]:p},actionRequired:v?{type:"discard_completed",followUpEffect:v,conditionalType:x,previousHandSize:_,sourceCardId:h==null?void 0:h.sourceCardId,actor:r}:null};if(h!=null&&h.sourceCardId){const G=w.player.lanes.flat().find(T=>T.id===h.sourceCardId)||w.opponent.lanes.flat().find(T=>T.id===h.sourceCardId);if(G){const T=`${G.protocol}-${G.value}`;w=Le(w,T),w=Qe(w,"middle")}else w=Le(w,void 0),w=Qe(w,void 0),w={...w,_logIndentLevel:0}}else w=Le(w,void 0),w=Qe(w,void 0);const U=r==="player"?"Player":"Opponent";let C;if(r==="player"||d.every(G=>G.isRevealed)){const G=d.map(T=>`${T.protocol}-${T.value}`).join(", ");C=`${U} discards ${G}.`}else{const G=d.length===1?"card":"cards";C=`${U} discards ${d.length} ${G}.`}w=re(w,r,C);const A=(G,T)=>{var P;const Q=o.phase==="hand_limit"&&!(T!=null&&T.sourceCardId);let X=G;Q&&(X=fo(X),X=uh(X,r),X=Dt(X,"after_clear_cache",{player:r}).newState,((P=X.processedClearCacheTriggerIds)==null?void 0:P.length)>0&&(X.phase="end"));const W=Dt(X,"after_opponent_discard",{player:r==="player"?"opponent":"player"}).newState;return Oh(W,r,T==null?void 0:T.sourceEffect,T==null?void 0:T.sourceCardId)};if(h&&h.actor===r){const G=h.count-n.length;return G>0?(w.actionRequired={...h,count:G},w):A(w,h)}const S=o.actionRequired;if(S&&S.type==="discard"&&S.actor===r){const G=S.count-n.length;return G>0?(w.actionRequired={...S,count:G},w):A(w,S)}const N=o.phase==="hand_limit";let E=Dt(w,"after_opponent_discard",{player:r==="player"?"opponent":"player"}).newState;return N&&(E=uh(E,r),E=Dt(E,"after_clear_cache",{player:r}).newState,((L=E.processedClearCacheTriggerIds)==null?void 0:L.length)>0&&(E.phase="end")),E},m_=(o,n)=>{var f;if(((f=o.actionRequired)==null?void 0:f.type)!=="plague_2_player_discard")return o;const r=o.actionRequired.actor,s=r==="player"?"opponent":"player";let i=pa(o,n,r);const d=n.length+1;return i[s].hand.length>0?i.actionRequired={type:"discard",actor:s,count:Math.min(d,i[s].hand.length),sourceCardId:o.actionRequired.sourceCardId}:(i=Ye(i),i.actionRequired=null),i},Ks=(o,n)=>{var f;if(((f=o.actionRequired)==null?void 0:f.type)!=="plague_2_opponent_discard")return o;const r=o.actionRequired.actor,s=r==="player"?"opponent":"player";let i=pa(o,n,r);const d=n.length+1;return i[s].hand.length>0?i.actionRequired={type:"discard",actor:s,count:Math.min(d,i[s].hand.length),sourceCardId:o.actionRequired.sourceCardId}:(i=Ye(i),i.actionRequired=null),i},fh=(o,n)=>{var h,p,y;const r=((h=o.actionRequired)==null?void 0:h.type)==="discard"&&((p=o.actionRequired)==null?void 0:p.variableCount),s=((y=o.actionRequired)==null?void 0:y.type)==="select_cards_from_hand_to_discard_for_fire_4";if(!r&&!s)return o;const i=o.actionRequired.actor,d=o.actionRequired.sourceCardId;let f=pa(o,n,i);if(r&&d)return Oh(f,i,void 0,d);const m=n.length+1;return f=re(f,i,`Fire-4: Drawing ${m} card(s).`),f=ga(f,i,m),f},Js=(o,n)=>{var h;if(((h=o.actionRequired)==null?void 0:h.type)!=="select_cards_from_hand_to_discard_for_hate_1")return o;const{sourceCardId:r,actor:s}=o.actionRequired;let i=pa(o,n,s);const f=Wv(i,[]),m=Math.min(2,f);return m>0?i.actionRequired={type:"select_cards_to_delete",count:m,sourceCardId:r,disallowedIds:[],actor:s}:(i=re(i,s,"Hate-1: No valid targets to delete."),i=Ye(i),i.actionRequired=null),i};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const sr=(o,n,r)=>{const s=o.turn,i=s==="player"?"opponent":"player";let d={...o};if(d.compileBlockedPlayer===s&&d.compileBlockedUntilTurn>(d.turnNumber||0)){const T=s==="player"?"Player":"Opponent";return console.log(`[Compile Block] ${T}'s compile is blocked until turn ${d.compileBlockedUntilTurn}`),d=re(d,s,`${T} can't compile - blocked by opponent's effect.`),d}if(d.useControlMechanic&&d.controlCardHolder===s){const T=s==="player"?"Player":"Opponent";return d=Le(d,void 0),d=Qe(d,void 0),d={...d,_logIndentLevel:0},d=re(d,s,`${T} has Control and may rearrange protocols before compiling.`),d=kn(d),d.actionRequired={type:"prompt_use_control_mechanic",sourceCardId:"CONTROL_MECHANIC",actor:s,originalAction:{type:"compile",laneIndex:n}},d.controlCardHolder=null,d}let h={...d[s]},p={...d[i]};const y=h.compiled[n],v=[];for(const T of[s,i])d[T].lanes[n].forEach(X=>{if(X.isFaceUp){const M=X;M.customEffects&&M.customEffects.topEffects&&M.customEffects.topEffects.some(W=>W.trigger==="before_compile_delete")&&v.push({card:X,owner:T})}});for(const{card:T,owner:Q}of v)console.log(`[before_compile_delete] Executing effect for custom card ${T.protocol}-${T.value}`),d=Dt(d,"before_compile_delete",{player:Q,cardId:T.id}).newState;h={...d[s]},p={...d[i]};const x=T=>{if(T.protocol==="Speed"&&T.value===2&&T.isFaceUp)return!0;const Q=T;return Q.customEffects&&Q.customEffects.topEffects&&T.isFaceUp?Q.customEffects.topEffects.some(X=>{var M,$;return X.trigger==="before_compile_delete"&&((M=X.params)==null?void 0:M.action)==="shift"&&(($=X.params)==null?void 0:$.shiftSelf)===!0}):!1},_=[],w=[],U=h.lanes[n].filter(T=>x(T)?(_.push(T),!1):!0),C=p.lanes[n].filter(T=>x(T)?(w.push(T),!1):!0),A={...h.stats,cardsDeleted:h.stats.cardsDeleted+U.length},S={...p.stats,cardsDeleted:p.stats.cardsDeleted+C.length};h.stats=A,p.stats=S,h.discard=[...h.discard,...U.map(({id:T,isFaceUp:Q,...X})=>X)],p.discard=[...p.discard,...C.map(({id:T,isFaceUp:Q,...X})=>X)];const N=[...h.lanes];N[n]=_,h.lanes=N;const q=[...p.lanes];q[n]=w,p.lanes=q;const D=[...h.compiled];D[n]=!0,h.compiled=D,d={...d,[s]:h,[i]:p,stats:{...d.stats,[s]:A,[i]:S}},d=Le(d,void 0),d=Qe(d,void 0),d={...d,_logIndentLevel:0};const E=s==="player"?"Player":"Opponent",j=h.protocols[n];if(d=re(d,s,`${E} compiles Protocol ${j}!`),y&&(d=re(d,s,`${E} draws 1 card from the opponent's deck as a re-compile reward.`),d=s_(d,s,1)),d=_e(d),h.compiled.every(T=>T===!0))return d.winner=s,r(s,d),d;U.length+C.length>0&&(d=Dt(d,"after_delete",{player:s}).newState);const G=[..._,...w].map(T=>{const Q=ve(d,T.id).owner,X=T.isFaceUp?`${T.protocol}-${T.value}`:"Card";return d=re(d,Q,`${X} survives compilation and must be shifted.`),{type:"select_lane_for_shift",cardToShiftId:T.id,cardOwner:Q,originalLaneIndex:n,sourceCardId:T.id,actor:Q}});if(G.length>0){const T=G.shift();d.actionRequired=T,d.queuedActions=G,T.actor!==s&&(d._interruptedTurn=s,d._interruptedPhase=d.phase,d.turn=T.actor)}else d.actionRequired=null,d.queuedActions=[];return d},Ph=(o,n)=>o,g_=(o,n)=>{var p;if(((p=o.actionRequired)==null?void 0:p.type)!=="select_card_from_hand_to_play")return o;const{disallowedLaneIndex:r,sourceCardId:s,isFaceDown:i,actor:d,destinationRule:f,condition:m,faceDown:h}=o.actionRequired;return{...o,actionRequired:{type:"select_lane_for_play",cardInHandId:n,disallowedLaneIndex:r,sourceCardId:s,isFaceDown:i||h,actor:d,destinationRule:f,condition:m}}},ph=o=>{if(!o.actionRequired||!("optional"in o.actionRequired)||!o.actionRequired.optional)return o;const n="actor"in o.actionRequired?o.actionRequired.actor:o.turn,r=n==="player"?"Player":"Opponent";let s={...o,actionRequired:null};return s=re(s,n,`${r} skips the optional action.`),s},hh=o=>{var d;if(((d=o.actionRequired)==null?void 0:d.type)!=="reveal_opponent_hand")return o;const n=o.actionRequired.actor,r=n==="player"?"opponent":"player";let s={...o};const i={...s[r]};if(i.hand.length>0){i.hand=i.hand.map(h=>({...h,isRevealed:!0})),s[r]=i;const f=ve(s,o.actionRequired.sourceCardId),m=f?`${f.card.protocol}-${f.card.value}`:"A card effect";s=re(s,n,`${m}: Opponent reveals their hand.`)}return s.actionRequired=null,s},mh=(o,n)=>od(o,n),gh=(o,n)=>ad(o,n).newState;/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const yh=(o,n)=>{var h,p;if(console.log("[DEBUG resolveOptionalDrawPrompt] Called with accept:",n,"actionRequired type:",(h=o.actionRequired)==null?void 0:h.type),((p=o.actionRequired)==null?void 0:p.type)!=="prompt_optional_draw")return console.log("[DEBUG resolveOptionalDrawPrompt] Type mismatch! Returning prev state."),o;const{sourceCardId:r,actor:s,count:i,drawingPlayer:d}=o.actionRequired,f=s.charAt(0).toUpperCase()+s.slice(1);let m={...o};if(n){m=re(m,s,`${f} chooses to draw ${i} card${i!==1?"s":""}.`),m=ga(m,d||s,i);const y=o.actionRequired.followUpEffect,v=o.actionRequired.conditionalType;if(console.log("[DEBUG resolveOptionalDrawPrompt] followUpEffect:",y==null?void 0:y.id,"conditionalType:",v),y){const x=ve(m,r);if(console.log("[DEBUG resolveOptionalDrawPrompt] sourceCard found:",!!x,"sourceCardId:",r),x){const _=m[x.owner].lanes.findIndex(A=>A.some(S=>S.id===r)),w=s==="player"?"opponent":"player",U={cardOwner:s,actor:s,currentTurn:m.turn,opponent:w,triggerType:"start"};console.log("[DEBUG resolveOptionalDrawPrompt] Executing followUpEffect:",y.id),m=ot(x.card,_,m,U,y).newState,m=Ye(m)}else{console.log("[DEBUG resolveOptionalDrawPrompt] Source card not found! Creating synthetic card for follow-up.");const _=s==="player"?"opponent":"player";let w=0;for(let S=0;S<3;S++)if(m[s].lanes[S].length>0){w=S;break}const U={id:r,protocol:"Unknown",value:0},C={cardOwner:s,actor:s,currentTurn:m.turn,opponent:_,triggerType:"start"};console.log("[DEBUG resolveOptionalDrawPrompt] Executing followUpEffect with synthetic card:",y.id),m=ot(U,w,m,C,y).newState,m=Ye(m)}}else m.actionRequired=null}else m=re(m,s,`${f} skips the draw.`),m.actionRequired=null;return m},vh=(o,n,r)=>{var i;if(((i=o.actionRequired)==null?void 0:i.type)!=="plague_4_player_flip_optional")return o;let s={...o,actionRequired:null};if(s=Le(s,"Plague-4"),s=Qe(s,"end"),n){const{sourceCardId:d}=o.actionRequired;s=re(s,r,`${r==="player"?"Player":"Opponent"} chooses to flip the card.`),s=ha(new Set([d]),s),s.animationState={type:"flipCard",cardId:d}}else s=re(s,r,`${r==="player"?"Player":"Opponent"} skips flipping the card.`);return s=Le(s,void 0),s=Qe(s,void 0),s=fo(s),s},_h=(o,n)=>{var p,y,v;if(((p=o.actionRequired)==null?void 0:p.type)!=="prompt_optional_discard_custom")return o;const{actor:r,count:s,sourceCardId:i}=o.actionRequired,d=r.charAt(0).toUpperCase()+r.slice(1);let f={...o};const m=(y=o.actionRequired)==null?void 0:y.followUpEffect,h=(v=o.actionRequired)==null?void 0:v.conditionalType;return n?(f=re(f,r,`${d} chooses to discard ${s} card(s).`),f.actionRequired={type:"discard",actor:r,count:s,sourceCardId:i,followUpEffect:m,conditionalType:h,previousHandSize:f[r].hand.length}):(f=re(f,r,`${d} skips the discard.`),f.actionRequired=null),f},xh=(o,n)=>{var h,p,y,v,x,_,w,U,C,A,S,N;if(console.log("[DEBUG resolveOptionalEffectPrompt] Called with accept:",n,"actionRequired type:",(h=o.actionRequired)==null?void 0:h.type),((p=o.actionRequired)==null?void 0:p.type)!=="prompt_optional_effect")return o;const{actor:r,sourceCardId:s,effectDef:i,laneIndex:d}=o.actionRequired;console.log("[DEBUG resolveOptionalEffectPrompt] effectDef:",i.id,"has conditional?",!!i.conditional);const f=r.charAt(0).toUpperCase()+r.slice(1);let m={...o};if(n){const q=i.params.action;m=re(m,r,`${f} chooses to execute the optional ${q} effect.`),m.actionRequired=null;const D=[...m.player.lanes.flat(),...m.opponent.lanes.flat()].find(M=>M.id===s);if(!D)return console.error("[Optional Effect] Source card not found!"),m;const E={cardOwner:r,opponent:r==="player"?"opponent":"player",currentTurn:m.turn,actor:r},j={...i,params:{...i.params,optional:!1},conditional:void 0},I=ot(D,d,m,E,j),k=!!I.newState.actionRequired,L=!!I.newState._effectSkippedNoTargets;if(console.log("[DEBUG resolveOptionalEffectPrompt] After executeCustomEffect, actionRequired:",((y=I.newState.actionRequired)==null?void 0:y.type)||"null","_effectSkippedNoTargets:",L,"hasActionRequired:",k),L&&!k){console.log("[DEBUG resolveOptionalEffectPrompt] Effect was skipped (no valid targets), NOT executing if_executed followUp");const M={...I.newState};return delete M._effectSkippedNoTargets,M.actionRequired=null,M}if(L&&k&&(console.log("[DEBUG resolveOptionalEffectPrompt] Cleaning stale _effectSkippedNoTargets - effect has valid actionRequired"),delete I.newState._effectSkippedNoTargets),i.conditional&&i.conditional.type==="if_executed"&&i.conditional.thenEffect){if(console.log("[DEBUG resolveOptionalEffectPrompt] Has if_executed followUp:",i.conditional.thenEffect.id),I.newState.actionRequired)return console.log("[DEBUG resolveOptionalEffectPrompt] Effect has actionRequired, attaching followUp for later execution"),{...I.newState,actionRequired:{...I.newState.actionRequired,followUpEffect:i.conditional.thenEffect,conditionalType:"if_executed"}};console.log("[DEBUG resolveOptionalEffectPrompt] Executing if_executed followUp immediately:",i.conditional.thenEffect.id);const M=i.conditional.thenEffect;console.log("[DEBUG resolveOptionalEffectPrompt] followUpEffect:",M.id,"params:",JSON.stringify(M.params),"has conditional?",!!M.conditional,"actor:",r);const $=ot(D,d,I.newState,E,M);if(console.log("[DEBUG resolveOptionalEffectPrompt] After followUp executeCustomEffect, actionRequired:",((v=$.newState.actionRequired)==null?void 0:v.type)||"null"),$.newState.actionRequired&&M.conditional&&M.conditional.thenEffect){console.log("[DEBUG resolveOptionalEffectPrompt] followUp has actionRequired AND nested conditional, attaching:",M.conditional.thenEffect.id);const W={...$.newState,actionRequired:{...$.newState.actionRequired,followUpEffect:M.conditional.thenEffect,conditionalType:M.conditional.type}};return console.log("[DEBUG resolveOptionalEffectPrompt] Returning state with nested followUp, actionRequired:",(x=W.actionRequired)==null?void 0:x.type),W}return console.log("[DEBUG resolveOptionalEffectPrompt] No nested conditional, returning followUpResult.newState, actionRequired:",((_=$.newState.actionRequired)==null?void 0:_.type)||"null"),$.newState}const T=(w=o.actionRequired)==null?void 0:w.followUpEffect,Q=(U=o.actionRequired)==null?void 0:U.outerSourceCardId,X=(C=o.actionRequired)==null?void 0:C.outerLaneIndex;if(T&&Q){let M=I.newState;if(M.actionRequired)return console.log("[Optional Effect Accept] Attaching outer followUpEffect to new actionRequired"),{...M,actionRequired:{...M.actionRequired,followUpEffect:T,outerSourceCardId:Q,outerLaneIndex:X}};console.log("[Optional Effect Accept] Executing outer followUpEffect immediately:",T.id);const $=[...M.player.lanes.flat(),...M.opponent.lanes.flat()].find(W=>W.id===Q);if($){const W=M.player.lanes.flat().some(F=>F.id===Q)?"player":"opponent",P={cardOwner:W,opponent:W==="player"?"opponent":"player",currentTurn:M.turn,actor:W};return ot($,X||0,M,P,T).newState}}return I.newState}else{const q=i.params.action;m=re(m,r,`${f} skips the optional ${q} effect.`),m.actionRequired=null;const D=(A=o.actionRequired)==null?void 0:A.followUpEffect,E=(S=o.actionRequired)==null?void 0:S.outerSourceCardId,j=(N=o.actionRequired)==null?void 0:N.outerLaneIndex;if(D&&E){const I=[...m.player.lanes.flat(),...m.opponent.lanes.flat()].find(k=>k.id===E);if(I){let k=j;if(k===void 0){for(const Q of["player","opponent"])for(let X=0;X<m[Q].lanes.length;X++)if(m[Q].lanes[X].some(M=>M.id===E)){k=X;break}}const L=m.player.lanes.flat().some(Q=>Q.id===E)?"player":"opponent",G={cardOwner:L,opponent:L==="player"?"opponent":"player",currentTurn:m.turn,actor:L};return ot(I,k||0,m,G,D).newState}}return m}},ed=(o,n,r)=>{var N;if(((N=o.actionRequired)==null?void 0:N.type)!=="prompt_rearrange_protocols")return o;const s=Lv(o);if(!s.allowed)return console.error(`Protocol rearrangement blocked: ${s.reason}`),o;const{target:i,actor:d,originalAction:f,sourceCardId:m,disallowedProtocolForLane:h}=o.actionRequired;if(h){const{laneIndex:q,protocol:D}=h;if(n[q]===D)return console.error(`Illegal rearrange: ${D} cannot be placed on lane ${q} due to Anarchy-3 restriction`),o}let p={...o};const y={...p[i]},v={};y.protocols.forEach((q,D)=>{v[q]=y.compiled[D]});const x=n.map(q=>v[q]);y.protocols=n,y.compiled=x,p[i]=y,p.actionRequired=null;const _=p._pendingCustomEffects;if(_&&_.effects.length>0){console.log("[resolveRearrangeProtocols] Found pending effects:",_.effects.length);const q={type:"execute_remaining_custom_effects",sourceCardId:_.sourceCardId,laneIndex:_.laneIndex,effects:_.effects,context:_.context,actor:d};p.queuedActions=[...p.queuedActions||[],q],delete p._pendingCustomEffects,console.log("[resolveRearrangeProtocols] Queued pending effects")}let w="Control Action";if(m!=="CONTROL_MECHANIC"){const q=[...p.player.lanes.flat(),...p.opponent.lanes.flat()].find(D=>D.id===m);q&&(w=`${q.protocol}-${q.value}`)}const U=d.charAt(0).toUpperCase()+d.slice(1),C=i===d?"their own":"the opponent's",A=n.join(" | ");p=re(p,d,`${w}: ${U} rearranges ${C} protocols.`),p=re(p,d,`New protocol order for ${i}: ${A}`);let S=_e(p);if(f){if(console.log("[DEBUG resolveRearrangeProtocols] originalAction:",f),S={...S,_logIndentLevel:0},f.type==="compile")return sr(S,f.laneIndex,r);if(f.type==="fill_hand"){console.log("[DEBUG resolveRearrangeProtocols] Calling performFillHand for actor:",d,"hand before:",S[d].hand.length);const q=fr(S,d);return console.log("[DEBUG resolveRearrangeProtocols] After performFillHand, hand length:",q[d].hand.length),console.log("[DEBUG resolveRearrangeProtocols] RETURNING state with",q[d].hand.length,"cards"),q}else f.type==="continue_turn"?f.queuedSpeed2Actions&&f.queuedSpeed2Actions.length>0?(S=re(S,d,"Processing remaining Speed-2 effects..."),S.queuedActions=[...f.queuedSpeed2Actions,...S.queuedActions||[]]):(S=re(S,d,"Turn ends after compile."),S.phase="hand_limit"):f.type==="resume_interrupted_turn"&&(S=re(S,d,"Resuming interrupted turn..."),S._interruptedTurn=f.interruptedTurn,S._interruptedPhase=f.interruptedPhase,f.queuedSpeed2Actions&&f.queuedSpeed2Actions.length>0&&(S.queuedActions=[...f.queuedSpeed2Actions,...S.queuedActions||[]]))}return S},wh=(o,n,r)=>{var S;if(((S=o.actionRequired)==null?void 0:S.type)!=="prompt_swap_protocols")return o;const{actor:s,target:i,originalAction:d,sourceCardId:f}=o.actionRequired,m={...o[i]},[h,p]=n.sort((N,q)=>N-q),y=[...m.protocols],v=[...m.compiled];[y[h],y[p]]=[y[p],y[h]],[v[h],v[p]]=[v[p],v[h]],m.protocols=y,m.compiled=v;let x={...o,[i]:m,actionRequired:null};const _=x._pendingCustomEffects;if(_&&_.effects.length>0){console.log("[resolveSwapProtocols] Found pending effects:",_.effects.length);const N={type:"execute_remaining_custom_effects",sourceCardId:_.sourceCardId,laneIndex:_.laneIndex,effects:_.effects,context:_.context,actor:s};x.queuedActions=[...x.queuedActions||[],N],delete x._pendingCustomEffects,console.log("[resolveSwapProtocols] Queued pending effects")}const w=s.charAt(0).toUpperCase()+s.slice(1),U=i.charAt(0).toUpperCase()+i.slice(1);x=re(x,s,`${f==="CONTROL_MECHANIC"?"Control":"Spirit-4"}: ${w} swaps ${U}'s protocols ${y[p]} and ${y[h]}.`),f==="CONTROL_MECHANIC"&&(x.controlCardHolder=null);let A=_e(x);if(d){if(d.type==="compile")return A=re(A,s,"Resuming Compile action..."),sr(A,d.laneIndex,r);if(d.type==="fill_hand")return A=re(A,s,"Resuming Refresh action..."),fr(A,s)}return A},id=(o,n)=>{var x;if(((x=o.actionRequired)==null?void 0:x.type)!=="prompt_shift_or_flip_board_card_custom")return o;const{actor:r,sourceCardId:s,revealedCardId:i,followUpAction:d,optional:f}=o.actionRequired,m=r.charAt(0).toUpperCase()+r.slice(1),h=ve(o,i);if(!h)return o;if(d&&n!=="skip"&&n!==d)return console.error(`Invalid choice: ${n}, followUpAction restricts to: ${d}`),o;const p=h.owner,y=o[p].lanes.findIndex(_=>_.some(w=>w.id===i));if(y===-1)return o;let v={...o};switch(n){case"shift":{const _=[...v[p].lanes[y]],w=_.findIndex(U=>U.id===i);if(w!==-1){_[w]={..._[w],isFaceUp:!1};const U=[...v[p].lanes];U[y]=_,v={...v,[p]:{...v[p],lanes:U}}}v=re(v,r,`${m} chooses to shift the revealed card (face-down).`),v.actionRequired={type:"select_lane_to_shift_revealed_board_card_custom",sourceCardId:s,revealedCardId:i,actor:r};break}case"flip":{v=re(v,r,`${m} chooses to flip the revealed card face-up permanently.`);const _={...v,actionRequired:null};v=ld(_,i).newState;break}case"skip":{const _=[...v[p].lanes[y]],w=_.findIndex(U=>U.id===i);if(w!==-1){_[w]={..._[w],isFaceUp:!1};const U=[...v[p].lanes];U[y]=_,v={...v,[p]:{...v[p],lanes:U}}}v=re(v,r,`${m} chooses to do nothing with the revealed card.`),v.actionRequired=null;break}}return v};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const td=(o,n)=>{if(!o.actionRequired)return o;const{actionRequired:r}=o,s=r.actor,i=s==="player"?"opponent":"player";switch(r.type){case"select_card_from_hand_to_give":{const d=o[s].hand.find(_=>_.id===n);if(!d)return o;let f={...o};const m={...f[s]},h={...f[i]};m.hand=m.hand.filter(_=>_.id!==n),h.hand=[...h.hand,d],f={...f,[s]:m,[i]:h};const p=s==="player"?"Player":"Opponent",y=`${d.protocol}-${d.value}`;f=re(f,s,`${p} gives ${y} to the opponent.`),r.sourceEffect==="love_1_end"&&(f=re(f,s,`Love-1: ${p} draws 2 cards.`),f=ga(f,s,2));const v=r.followUpEffect,x=r.conditionalType;if(v&&x==="if_executed"){const _=ve(f,r.sourceCardId);if(_){const{card:w,laneIndex:U}=_,C={cardOwner:s,actor:s,currentTurn:f.turn,opponent:i,triggerType:"play"};f=ot(w,U,f,C,v).newState}}return f.actionRequired=null,f}case"select_card_from_hand_to_reveal":{const d=o[s].hand.find(x=>x.id===n);if(!d)return o;let f={...o};const m={...f[s]},h=m.hand.map(x=>x.id===n?{...x,isRevealed:!0}:x);m.hand=h,f={...f,[s]:m};const p=s==="player"?"Player":"Opponent",y=`${d.protocol}-${d.value}`;f=re(f,s,`${p} reveals ${y} from their hand.`);const v=f._pendingCustomEffects;if(v&&v.effects.length>0){const x=ve(f,v.sourceCardId);if(x){const{card:_}=x,w=v.effects[0],U=v.effects.slice(1),C={cardOwner:s,actor:s,currentTurn:f.turn,opponent:i,triggerType:"play"};return f=ot(_,v.laneIndex,f,C,w).newState,U.length>0?f._pendingCustomEffects={...v,effects:U}:delete f._pendingCustomEffects,f}}return f.actionRequired={type:"select_any_card_to_flip",count:1,sourceCardId:r.sourceCardId,actor:s},f}default:return o}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Ch=(o,n)=>{var _;if(((_=o.actionRequired)==null?void 0:_.type)!=="custom_choice")return o;const{options:r,sourceCardId:s,actor:i,laneIndex:d}=o.actionRequired;if(n<0||n>=r.length)return console.error(`[Choice Resolver] Invalid option index: ${n}`),o;const f=r[n],m=ve(o,s);if(!m){console.error(`[Choice Resolver] Source card ${s} not found`);let w={...o};return w.actionRequired=null,w}const h=i==="player"?"opponent":"player",p={cardOwner:i,actor:i,currentTurn:o.turn,opponent:h};let y={...o,actionRequired:null};console.log(`[Choice Resolver] Executing option ${n}`);const v=ot(m.card,d,y,p,f);return _e(v.newState)};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Control Mechanic Logic for AI
 *
 * CRITICAL: When evaluating rearrangements during a compile action,
 * the lane being compiled will have its value RESET TO 0 after the compile.
 * This must be considered when determining beneficial swaps!
 */function Fc(o,n){const r=[...o];return n!==null&&n>=0&&n<3&&(r[n]=0),r}function y_(o,n=null){const r=o.player,s=[],i=[];for(let f=0;f<3;f++)r.compiled[f]?s.push(f):i.push(f);if(s.length===0||i.length===0)return!1;const d=Fc(r.laneValues,n);for(const f of s)for(const m of i)if(d[m]-d[f]>0)return!0;return!1}function bh(o,n=null){const r=o.opponent,s=[],i=[];for(let f=0;f<3;f++)r.compiled[f]?s.push(f):i.push(f);if(s.length===0||i.length===0)return!1;const d=Fc(r.laneValues,n);for(const f of s)for(const m of i){const p=10-d[f];if(p>=0&&p<=3){const v=10-d[m];if(p<v)return!0}}return!1}function Hh(o,n){if(!n||n.type!=="prompt_rearrange_protocols")return{type:"rearrangeProtocols",newOrder:[...o.opponent.protocols]};const r=n.target,s=n.disallowedProtocolForLane;let i=null;n.originalAction&&n.originalAction.type==="compile"&&(i=n.originalAction.laneIndex);const d=_=>{if(!s)return!0;const{laneIndex:w,protocol:U}=s;return _[w]!==U},f=o.opponent,m=o.player,h=Fc(f.laneValues,i),p=Fc(m.laneValues,i),y=f.compiled.filter(_=>_).length;if(m.compiled.filter(_=>_).length===2&&y===2){const _=m.compiled.findIndex(A=>!A),w=f.compiled.findIndex(A=>!A),U=p[_],C=h[w];if(U>C&&r==="player"){let A=-1,S=1/0;for(let N=0;N<3;N++)m.compiled[N]&&p[N]<S&&(S=p[N],A=N);if(A!==-1&&S<=U){const N=[...m.protocols];if([N[_],N[A]]=[N[A],N[_]],d(N))return{type:"rearrangeProtocols",newOrder:N}}return da(m.protocols,d)}if(U<=C&&r==="opponent"){let A=-1,S=-1;for(let N=0;N<3;N++)f.compiled[N]&&h[N]>S&&(S=h[N],A=N);if(A!==-1&&S>C&&S>0){const N=[...f.protocols];if([N[w],N[A]]=[N[A],N[w]],d(N))return{type:"rearrangeProtocols",newOrder:N}}return da(f.protocols,d)}}if(r==="player"){const _=[],w=[];for(let S=0;S<3;S++)m.compiled[S]?_.push(S):w.push(S);if(_.length===0||w.length===0){if(n.sourceCardId!=="CONTROL_MECHANIC")for(let N=0;N<3;N++)for(let q=N+1;q<3;q++){const D=[...m.protocols];if([D[N],D[q]]=[D[q],D[N]],d(D))return{type:"rearrangeProtocols",newOrder:D}}return da(m.protocols,d)}let U=null;for(const S of w)if(p[S]>=10&&p[S]>h[S]){for(const q of _){U={compiledIdx:q,uncompiledIdx:S};break}if(U)break}if(U){console.log(`[AI Control Rearrange] BLOCKING WIN: Player has ${p[U.uncompiledIdx]} in uncompiled lane ${U.uncompiledIdx}, swapping with compiled lane ${U.compiledIdx}`);const S=[...m.protocols];if([S[U.compiledIdx],S[U.uncompiledIdx]]=[S[U.uncompiledIdx],S[U.compiledIdx]],d(S))return{type:"rearrangeProtocols",newOrder:S}}let C=null;for(const S of _)for(const N of w){const q=p[N]-p[S];(!C||q>C.score)&&(C={compiledIdx:S,uncompiledIdx:N,score:q})}const A=n.sourceCardId!=="CONTROL_MECHANIC";if(C&&C.score>0){const S=[...m.protocols];if([S[C.compiledIdx],S[C.uncompiledIdx]]=[S[C.uncompiledIdx],S[C.compiledIdx]],d(S))return{type:"rearrangeProtocols",newOrder:S}}if(A)for(let S=0;S<3;S++)for(let N=S+1;N<3;N++){const q=[...m.protocols];if([q[S],q[N]]=[q[N],q[S]],d(q))return{type:"rearrangeProtocols",newOrder:q}}return da(m.protocols,d)}if(r==="opponent"){const _=[],w=[];for(let A=0;A<3;A++)f.compiled[A]?_.push(A):w.push(A);if(_.length===0||w.length===0){if(n.sourceCardId!=="CONTROL_MECHANIC")for(let S=0;S<3;S++)for(let N=S+1;N<3;N++){const q=[...f.protocols];if([q[S],q[N]]=[q[N],q[S]],d(q))return{type:"rearrangeProtocols",newOrder:q}}return da(f.protocols,d)}let U=null;for(const A of _)for(const S of w){const N=h[A],q=h[S],D=N-q,j=N>=10&&N>p[A]?D+100:D;(!U||j>U.score)&&(U={compiledIdx:A,uncompiledIdx:S,score:j,newUncompiledValue:N})}const C=n.sourceCardId!=="CONTROL_MECHANIC";if(U&&U.score>0){console.log(`[AI Control Rearrange] Swapping own protocols: compiled lane ${U.compiledIdx} (value ${h[U.compiledIdx]}) <-> uncompiled lane ${U.uncompiledIdx} (value ${h[U.uncompiledIdx]}). New uncompiled value: ${U.newUncompiledValue}`);const A=[...f.protocols];if([A[U.compiledIdx],A[U.uncompiledIdx]]=[A[U.uncompiledIdx],A[U.compiledIdx]],d(A))return{type:"rearrangeProtocols",newOrder:A}}if(C)for(let A=0;A<3;A++)for(let S=A+1;S<3;S++){const N=[...f.protocols];if([N[A],N[S]]=[N[S],N[A]],d(N))return{type:"rearrangeProtocols",newOrder:N}}return da(f.protocols,d)}const x=r==="player"?[...m.protocols]:[...f.protocols];return da(x,d)}function da(o,n){if(n(o))return{type:"rearrangeProtocols",newOrder:[...o]};for(let r=0;r<3;r++)for(let s=r+1;s<3;s++){const i=[...o];if([i[r],i[s]]=[i[s],i[r]],n(i))return console.log(`[AI Rearrange] Current order invalid, swapping indices ${r} and ${s} to satisfy Anarchy-3 restriction`),{type:"rearrangeProtocols",newOrder:i}}return console.error("[AI Rearrange] Could not find any valid arrangement - returning current order"),{type:"rearrangeProtocols",newOrder:[...o]}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function Bh(o,n){return Nn(o).some(({rule:s,cardOwner:i})=>s.type!=="require_face_down_play"?!1:s.target==="all"||s.target==="opponent"&&i!==n)}function pd(o){const n=o;return n.customEffects?[...n.customEffects.topEffects||[],...n.customEffects.middleEffects||[],...n.customEffects.bottomEffects||[]].some(s=>{var f,m;const i=s.trigger;return(i==="on_cover"||i==="on_cover_or_flip")&&((f=s.params)==null?void 0:f.action)==="delete"&&((m=s.params)==null?void 0:m.deleteSelf)===!0}):!1}function v_(o,n,r){const s=o[n].lanes[r];if(s.length===0)return null;const i=s[s.length-1];return i.isFaceUp&&pd(i)?i.value:null}function zh(o){const n=o;return n.customEffects?[...n.customEffects.topEffects||[],...n.customEffects.middleEffects||[],...n.customEffects.bottomEffects||[]].some(s=>{var i;return s.params.action==="return"&&((i=s.params.targetFilter)==null?void 0:i.owner)==="own"}):!1}function Vh(o){const n=o;return n.customEffects?[...n.customEffects.topEffects||[],...n.customEffects.middleEffects||[],...n.customEffects.bottomEffects||[]].some(s=>{var i,d,f;return s.params.action==="delete"&&((i=s.params.targetFilter)==null?void 0:i.owner)==="own"&&(((d=s.params.targetFilter)==null?void 0:d.valueFilter)==="highest"||((f=s.params.targetFilter)==null?void 0:f.calculation)==="highest_value")}):!1}function __(o){const n=o;if(!n.customEffects)return 0;const r=n.customEffects.topEffects||[];for(const s of r)if(s.trigger==="passive"&&s.params.action==="value_modifier"&&(s.params.condition==="per_face_down_card"||s.params.applyTo==="face_down_cards"))return s.params.modifier||0;return 0}function Gh(o,n){let r=0;for(const s of["player","opponent"])for(const i of o[s].lanes[n])if(i.isFaceUp){const d=__(i);d>0&&(r=Math.max(r,d))}return r}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * EASY AI - Focused on winning, but only looks at own board
 * - Always tries to compile as fast as possible
 * - Prioritizes lanes closest to 10
 * - Doesn't consider opponent's strategy
 * - Makes simple decisions for effect choices
 *
 * FULLY GENERIC: Uses only targetFilter, scope, destinationRestriction from ActionRequired
 * NO card-specific handlers - all effects handled through parameters
 */function rr(o,n,r,s,i,d){const f=[],m=r||{},h=m.position||"uncovered";for(const p of["player","opponent"])if(!(m.owner==="own"&&p!==n)&&!(m.owner==="opponent"&&p===n))for(let y=0;y<o[p].lanes.length;y++){if((s==null?void 0:s.type)==="this_lane"&&s.laneIndex!==void 0&&y!==s.laneIndex||(s==null?void 0:s.type)==="other_lanes"&&s.laneIndex!==void 0&&y===s.laneIndex||d!==void 0&&(s==null?void 0:s.type)==="this_lane"&&y!==d)continue;const v=o[p].lanes[y];for(let x=0;x<v.length;x++){const _=v[x],w=x===v.length-1;if(!(h==="uncovered"&&!w)&&!(h==="covered"&&w)&&!(m.faceState==="face_up"&&!_.isFaceUp)&&!(m.faceState==="face_down"&&_.isFaceUp)){if(m.valueRange){const U=_.isFaceUp?_.value:2;if(U<m.valueRange.min||U>m.valueRange.max)continue}m.valueEquals!==void 0&&(_.isFaceUp?_.value:2)!==m.valueEquals||m.excludeSelf&&i&&_.id===i||f.push(_)}}}return m.calculation==="highest_value"&&f.length>0?(f.sort((p,y)=>{const v=p.isFaceUp?p.value:2;return(y.isFaceUp?y.value:2)-v}),[f[0]]):m.calculation==="lowest_value"&&f.length>0?(f.sort((p,y)=>{const v=p.isFaceUp?p.value:2,x=y.isFaceUp?y.value:2;return v-x}),[f[0]]):f}function ua(o,n){return o.player.lanes.some(r=>r.some(s=>s.id===n))}function Io(o,n,r){return o.isFaceUp?o.value:2+0}const x_=o=>{const{opponent:n,player:r}=o;if(n.hand.length===0)return null;const s=(C,A,S)=>so(o,"opponent",C,A,S).allowed,i=Bh(o,"opponent"),d=Lc(o,"opponent"),f=Oc(o),m=(C,A)=>i||!s(A,!0,C.protocol)?!1:f?C.protocol!==n.protocols[A]&&C.protocol!==r.protocols[A]:C.protocol===n.protocols[A]||C.protocol===r.protocols[A]||d,h=(C,A,S)=>2+Gh(o,S),p=n.hand.filter(C=>zh(C)?n.lanes.flat().some(N=>N.protocol!==C.protocol):!0);if(p.length===0)return null;const y=C=>{if(pd(C)){for(let A=0;A<3;A++)if(!n.compiled[A]&&n.laneValues[A]+C.value>=10)return!1;return!0}if(Vh(C)){let A=0;for(let S=0;S<3;S++){const N=n.lanes[S];if(N.length>0){const q=N[N.length-1],D=q.isFaceUp?q.value:2;D>A&&(A=D)}}return C.value>=A}return!1},v=[],_=r.lanes.flat().length+n.lanes.flat().length<=3,w=r.lanes.flat().length>0,U=(C,A)=>C.keywords.flip||C.keywords.delete||C.keywords.shift||C.keywords.return?w||n.lanes.some((q,D)=>D!==A&&q.length>0)||n.lanes[A].length>0:!0;for(const C of p)for(let A=0;A<3;A++){if(n.compiled[A])continue;const S=n.laneValues[A],N=r.laneValues[A];if(m(C,A)&&!y(C)){const q=S+C.value;let D=0;q>=10&&q>N?D=1e3+q:q<10?D=100+q+C.value*5:D=50+C.value,_&&C.value<=2&&(U(C,A)?D-=50:D-=200),C.keywords.draw&&n.hand.length>=5&&(D-=30),v.push({cardId:C.id,laneIndex:A,isFaceUp:!0,score:D})}if(s(A,!1,C.protocol)){const q=h(C,!1,A),D=S+q;let E=0;D>=10&&D>N?E=900+D:D<10?E=80+D:E=30+q,v.push({cardId:C.id,laneIndex:A,isFaceUp:!1,score:E})}}if(v.length===0)return null;v.sort((C,A)=>A.score-C.score);for(const C of v){if(C.isFaceUp){const A=n.hand.find(N=>N.id===C.cardId);if(!A||!so(o,"opponent",C.laneIndex,!0,A.protocol).allowed)continue}return{cardId:C.cardId,laneIndex:C.laneIndex,isFaceUp:C.isFaceUp}}return null},w_=(o,n)=>{var r,s,i,d,f,m;switch(n.type){case"prompt_use_control_mechanic":{const{player:h}=o,p=h.compiled.some(v=>v),y=h.compiled.filter(v=>!v).length;return p&&y>0?{type:"resolveControlMechanicPrompt",choice:"player"}:{type:"resolveControlMechanicPrompt",choice:"skip"}}case"discard":{const h=[...o.opponent.hand].sort((v,x)=>v.value-x.value),p=n.variableCount?Math.min(3,h.length):n.count;return{type:"discardCards",cardIds:h.slice(0,p).map(v=>v.id)}}case"select_cards_to_delete":{const h=n.currentLaneIndex??n.laneIndex,p=rr(o,n.actor,n.targetFilter,n.scope,n.sourceCardId,h),y=n.disallowedIds||[],v=p.filter(w=>!y.includes(w.id));if(v.length===0)return{type:"skip"};const x=v.filter(w=>ua(o,w.id)),_=v.filter(w=>!ua(o,w.id));return x.length>0?(x.sort((w,U)=>Io(U)-Io(w)),{type:"deleteCard",cardId:x[0].id}):_.length>0?(_.sort((w,U)=>Io(w)-Io(U)),{type:"deleteCard",cardId:_[0].id}):{type:"deleteCard",cardId:v[0].id}}case"select_card_to_flip":case"select_any_card_to_flip":case"select_any_card_to_flip_optional":{const h=Yn(o),p=n.currentLaneIndex??n.laneIndex,y=rr(o,n.actor,n.targetFilter,n.scope,n.sourceCardId,p);if(y.length===0)return n.optional?{type:"skip"}:{type:"skip"};const v=y.filter(w=>ua(o,w.id)),x=y.filter(w=>!ua(o,w.id)),_=v.filter(w=>w.isFaceUp).sort((w,U)=>U.value-w.value);if(_.length>0)return{type:"flipCard",cardId:_[0].id};if(!h){const w=v.filter(U=>!U.isFaceUp);if(w.length>0)return{type:"flipCard",cardId:w[0].id}}if(!h){const w=x.filter(U=>!U.isFaceUp);if(w.length>0)return{type:"flipCard",cardId:w[0].id}}if(!n.optional){const w=x.filter(U=>U.isFaceUp).sort((U,C)=>U.value-C.value);if(w.length>0)return{type:"flipCard",cardId:w[0].id}}return{type:"skip"}}case"select_card_to_shift":{const h=n.currentLaneIndex??n.laneIndex,p=rr(o,n.actor,n.targetFilter,n.scope,n.sourceCardId,h);if(p.length===0)return n.optional?{type:"skip"}:{type:"skip"};const y=p.filter(v=>ua(o,v.id));return y.length>0?{type:"shiftCard",cardId:y[0].id}:{type:"shiftCard",cardId:p[0].id}}case"select_card_to_return":{const h=n.currentLaneIndex??n.laneIndex,p=rr(o,n.actor,n.targetFilter,n.scope,n.sourceCardId,h);if(p.length===0)return n.optional?{type:"skip"}:{type:"skip"};const y=p.filter(x=>ua(o,x.id));if(y.length>0)return y.sort((x,_)=>Io(_)-Io(x)),{type:"returnCard",cardId:y[0].id};const v=p.filter(x=>!ua(o,x.id));return v.length>0?(v.sort((x,_)=>Io(x)-Io(_)),{type:"returnCard",cardId:v[0].id}):{type:"returnCard",cardId:p[0].id}}case"select_lane_for_shift":{let h=[0,1,2].filter(p=>p!==n.originalLaneIndex);if(n.destinationRestriction){const p=n.destinationRestriction,y=n.originalLaneIndex;if(p.type==="to_this_lane"&&p.laneIndex!==void 0)h=h.filter(v=>v===p.laneIndex);else if(p.type==="to_another_lane")h=h.filter(v=>v!==y);else if(p.type==="to_or_from_this_lane"&&p.laneIndex!==void 0){const v=typeof p.laneIndex=="number"?p.laneIndex:y;y!==v&&(h=[v])}else if(p.type==="non_matching_protocol"){const v=ve(o,n.cardToShiftId);v&&(h=h.filter(x=>{const _=o.player.protocols[x],w=o.opponent.protocols[x];return v.card.protocol!==_&&v.card.protocol!==w}))}}return h.length>0?{type:"selectLane",laneIndex:h[0]}:{type:"selectLane",laneIndex:0}}case"select_lane_for_shift_all":{let h=n.validLanes||[0,1,2];return h=h.filter(p=>p!==n.sourceLaneIndex),h.length>0?{type:"selectLane",laneIndex:h[0]}:{type:"selectLane",laneIndex:0}}case"select_lane_for_delete":{const p=[0,1,2].filter(y=>!(n.excludeSourceLane&&y===n.laneIndex)).map(y=>{let v=0,x=0;const _=n.deleteFilter;for(const w of o.player.lanes[y])_!=null&&_.valueRange&&w.isFaceUp?w.value>=_.valueRange.min&&w.value<=_.valueRange.max&&(v+=1):_!=null&&_.valueRange||(v+=1);for(const w of o.opponent.lanes[y])_!=null&&_.valueRange&&w.isFaceUp?w.value>=_.valueRange.min&&w.value<=_.valueRange.max&&(x+=2):_!=null&&_.valueRange||(x+=2);return{laneIndex:y,score:v-x}});return p.sort((y,v)=>v.score-y.score),{type:"selectLane",laneIndex:((r=p[0])==null?void 0:r.laneIndex)??0}}case"select_lane_for_delete_all":return n.validLanes.length>0?{type:"selectLane",laneIndex:n.validLanes[0]}:{type:"selectLane",laneIndex:0};case"select_lane_for_play":{let h=n.validLanes||[0,1,2];return n.disallowedLaneIndex!==void 0&&(h=h.filter(p=>p!==n.disallowedLaneIndex)),h=h.filter(p=>so(o,"opponent",p,!n.isFaceDown,"").allowed),h.length>0?{type:"selectLane",laneIndex:((s=h.filter(y=>!o.opponent.compiled[y]).map(y=>({lane:y,value:o.opponent.laneValues[y]})).sort((y,v)=>v.value-y.value)[0])==null?void 0:s.lane)??h[0]}:{type:"skip"}}case"select_lane_for_return":{const p=[0,1,2].map(y=>{const v=n.returnFilter;let x=0,_=0;for(const w of o.player.lanes[y]){const U=w.isFaceUp?w.value:2;(v==null?void 0:v.valueEquals)!==void 0&&U!==v.valueEquals||(x+=U)}for(const w of o.opponent.lanes[y]){const U=w.isFaceUp?w.value:2;(v==null?void 0:v.valueEquals)!==void 0&&U!==v.valueEquals||(_+=U)}return{laneIndex:y,score:x-_,hasTargets:x>0||_>0}}).filter(y=>y.hasTargets);return p.sort((y,v)=>v.score-y.score),{type:"selectLane",laneIndex:((i=p[0])==null?void 0:i.laneIndex)??0}}case"prompt_optional_effect":return((f=(d=n.effectDef)==null?void 0:d.params)==null?void 0:f.action)==="give"?{type:"resolveOptionalEffectPrompt",accept:!1}:{type:"resolveOptionalEffectPrompt",accept:!0};case"prompt_optional_discard_custom":return{type:"resolveOptionalDiscardCustomPrompt",accept:!1};case"custom_choice":return{type:"resolveCustomChoice",optionIndex:0};case"flip_self":return n.sourceCardId?{type:"flipCard",cardId:n.sourceCardId}:{type:"skip"};case"prompt_rearrange_protocols":return Hh(o,n);case"prompt_swap_protocols":return{type:"resolveSwapProtocols",indices:[0,1]};case"select_card_from_hand_to_play":{if(o.opponent.hand.length>0){const h=o.opponent.hand[0];let p=[0,1,2].filter(y=>y!==n.disallowedLaneIndex);if(p=p.filter(y=>so(o,"opponent",y,!n.isFaceDown,h.protocol).allowed),p.length>0){const y=p.filter(v=>!o.opponent.compiled[v]).map(v=>({lane:v,value:o.opponent.laneValues[v]})).sort((v,x)=>x.value-v.value);return{type:"playCard",cardId:h.id,laneIndex:((m=y[0])==null?void 0:m.lane)??p[0],isFaceUp:!1}}}return{type:"skip"}}case"select_card_from_hand_to_give":return o.opponent.hand.length>0?{type:"giveCard",cardId:[...o.opponent.hand].sort((p,y)=>p.value-y.value)[0].id}:{type:"skip"};case"select_card_from_hand_to_reveal":return o.opponent.hand.length>0?{type:"revealCard",cardId:o.opponent.hand[0].id}:{type:"skip"};case"reveal_opponent_hand":return{type:"skip"};case"select_board_card_to_reveal":{const h=rr(o,n.actor,n.targetFilter||{faceState:"face_down",position:"uncovered"},void 0,n.sourceCardId);return h.length>0?{type:"revealCard",cardId:h[0].id}:{type:"skip"}}case"prompt_shift_or_flip_revealed_card":{const h=ve(o,n.revealedCardId);return h?h.owner==="player"?{type:"resolvePrompt",accept:!0}:{type:"resolvePrompt",accept:!1}:{type:"resolvePrompt",accept:!1}}case"select_lane_to_shift_revealed_card":{const h=ve(o,n.revealedCardId);if(!h)return{type:"selectLane",laneIndex:0};let p=-1;for(let v=0;v<o[h.owner].lanes.length;v++)if(o[h.owner].lanes[v].some(x=>x.id===n.revealedCardId)){p=v;break}const y=[0,1,2].filter(v=>v!==p);return y.length>0?{type:"selectLane",laneIndex:y[0]}:{type:"selectLane",laneIndex:0}}case"shift_flipped_card_optional":{const h=n.cardId,p=ve(o,h);if(!p)return{type:"skip"};let y=p.laneIndex??-1;if(y===-1){for(let x=0;x<o[p.owner].lanes.length;x++)if(o[p.owner].lanes[x].some(_=>_.id===h)){y=x;break}}const v=[0,1,2].filter(x=>x!==y);return v.length===0?{type:"skip"}:{type:"selectLane",laneIndex:v[0]}}}return{type:"skip"}},C_=(o,n)=>{if(n)return w_(o,n);if(o.phase==="compile"&&o.compilableLanes.length>0)return{type:"compile",laneIndex:o.compilableLanes[0]};if(o.phase==="action"){const r=x_(o);if(r)return{type:"playCard",...r};if(o.opponent.hand.length<=1)return{type:"fillHand"};for(const s of o.opponent.hand)for(let i=0;i<3;i++){if(o.opponent.compiled[i])continue;if(so(o,"opponent",i,!1,s.protocol).allowed)return{type:"playCard",cardId:s.id,laneIndex:i,isFaceUp:!1}}return{type:"fillHand"}}return{type:"fillHand"}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * NORMAL AI - Plays like a human player
 * - Makes good strategic decisions
 * - No memory of revealed cards
 * - 20% chance to make suboptimal moves for realism
 * - Balanced between Easy and Hard
 */const il=["delete","flip","shift","return","discard"],At=o=>{let n=12-o.value;return il.some(r=>o.keywords[r])&&(n+=6),o.keywords.draw&&(n+=3),o.keywords.play&&(n+=8),o.keywords.prevent&&(n+=4),n},tl=(o,n,r)=>{let s;for(const d of r[n].lanes)if(d.some(f=>f.id===o.id)){s=d;break}if(!s)return 0;if(!o.isFaceUp)return s.some(f=>f.isFaceUp&&f.protocol==="Darkness"&&f.value===2)?4:2;let i=o.value*2.5;return o.top.length>0&&(i+=6),(o.bottom.includes("Start:")||o.bottom.includes("End:"))&&(i+=8),o.bottom.includes("covered:")&&(i+=5),il.some(d=>o.keywords[d])&&(i+=4),i},ol=()=>Math.random()<.2,Sh=o=>o+(Math.random()*10-5),nl=(o,n,r,s)=>{const i=r.position||"uncovered";return!(i==="uncovered"&&!n||i==="covered"&&n||r.faceState==="face_up"&&!o.isFaceUp||r.faceState==="face_down"&&o.isFaceUp||r.excludeSelf&&s&&o.id===s||r.valueRange&&(!o.isFaceUp||o.value<r.valueRange.min||o.value>r.valueRange.max)||r.valueEquals!==void 0&&(!o.isFaceUp||o.value!==r.valueEquals))},b_=o=>{const n=[],r=Bh(o,"opponent"),s=o.player.lanes.flat().length+o.opponent.lanes.flat().length,i=s<=3,d=s>3&&s<=8,m=o.player.lanes.flat().length>0,h=o.player.compiled.filter(Boolean).length,p=o.controlCardHolder==="opponent";o.controlCardHolder;let y=0;for(let D=0;D<3;D++)o.opponent.laneValues[D]>o.player.laneValues[D]?y++:o.player.laneValues[D]>o.opponent.laneValues[D];const x=o.useControlMechanic===!0&&h>=1&&!p,_=p&&h>=1;let w=!1,U=-1;for(let D=0;D<3;D++)if(!o.player.compiled[D]&&o.player.laneValues[D]>=10&&o.player.laneValues[D]>o.opponent.laneValues[D]){w=!0,U=D;break}x&&console.log(`[AI Normal] CONTROL HUNTING MODE: Player has ${h} compiled, we lead ${y} lanes, need 2 for control`),_&&w&&console.log(`[AI Normal] CONTROL DEFENSE MODE: We have control, player threatening win in lane ${U}`);const C=o.opponent.compiled.filter(Boolean).length;let A=-1;if(C<3&&!x){const D=[];for(let E=0;E<3;E++){if(o.opponent.compiled[E])continue;const j=o.opponent.protocols[E],I=o.player.protocols[E],k=o.opponent.laneValues[E],L=o.player.laneValues[E],G=o.opponent.hand.filter(M=>M.protocol===j||M.protocol===I);if(L>=10&&!o.player.compiled[E]){const M=Math.max(...G.map(ne=>ne.value),0),W=Math.max(M,2);if(k+W<=L)continue}let T=0,Q=`Lane ${E} (${j}): value=${k}`;T+=k*15,k>=8?(T+=100,Q+=` [ALMOST COMPILE: ${k}]`):k>=6?(T+=60,Q+=` [Near compile: ${k}]`):k>=4&&(T+=30,Q+=` [Building: ${k}]`),T+=G.length*10,G.length>0&&(Q+=` [${G.length} cards]`);const X=G.filter(M=>M.value>=4);T+=X.length*20,L>k&&(T-=(L-k)*5),G.length===0&&(T-=30,Q+=" [No matching cards - face-down only]"),D.push({laneIndex:E,score:T,reason:Q})}D.sort((E,j)=>j.score-E.score),D.length>0&&(A=D[0].laneIndex,console.log(`[AI Normal] Focus lane: ${A} (compiled: ${C}) - ${D[0].reason} [score: ${D[0].score}]`))}const S=(D,E)=>D.keywords.flip||D.keywords.delete||D.keywords.shift||D.keywords.return?o.player.lanes.flat().length>0||o.opponent.lanes.some((k,L)=>L!==E&&k.length>0)||o.opponent.lanes[E].length>0:!0,N=D=>D.keywords.draw?o.opponent.hand.length>=5:!1;for(const D of o.opponent.hand)for(let E=0;E<3;E++){const j=so(o,"opponent",E,!0,D.protocol),I=so(o,"opponent",E,!1,D.protocol);if(!j.allowed&&!I.allowed||o.opponent.compiled[E])continue;const k=o.player.laneValues[E]>=10&&o.player.laneValues[E]>o.opponent.laneValues[E]&&!o.player.compiled[E];if(k){const M=Math.max(j.allowed?D.value:0,I.allowed?Mn({...D,isFaceUp:!1},o.opponent.lanes[E]):0);if(o.opponent.laneValues[E]+M<=o.player.laneValues[E]&&!il.some(W=>D.keywords[W]))continue}let L=!1;if(zh(D)){let M=0;for(let $=0;$<3;$++)if(o.opponent.lanes[$].length>0){if($===E)continue;M++}M===0&&(L=!0)}if(pd(D)){const M=o.opponent.laneValues[E],$=Math.max(0,10-D.value);if(M<$)continue;const W=M+D.value,P=o.player.laneValues[E];if(W<=P)continue}const G=v_(o,"opponent",E);if(G!==null){const M=o.opponent.laneValues[E],$=M+D.value-G,W=$>=10&&$>o.player.laneValues[E],P=M-G>=4;if(!W&&!P)continue}const T=k;let Q=!1;if(Vh(D)){let M=0;for(let $=0;$<3;$++){const W=o.opponent.lanes[$];if(W.length>0&&$!==E){const P=W[W.length-1],ne=P.isFaceUp?P.value:2;ne>M&&(M=ne)}}D.value>=M&&(Q=!0)}if(j.allowed&&!r&&!Q&&!L){let M=0,$=`Play ${D.protocol}-${D.value} face-up in lane ${E}`;const W=D.value,P=o.opponent.laneValues[E]+W;if(T)P>o.player.laneValues[E]?(M=180+P*5,$+=" [Blocks compile!]"):(M=-150,$+=" [Fails to block]");else{if(M+=W*10,P>=10&&P>o.player.laneValues[E]&&!o.opponent.compiled[E])M+=200,$+=` [COMPILE: ${P}]`;else if(P>=8&&P<10&&!o.opponent.compiled[E]){const F=o.opponent.lanes[E].some(H=>H.isFaceUp&&H.protocol==="Darkness"&&H.value===2)?4:2;o.opponent.laneValues[E]+F>=10&&P<10?(M-=50,$+=` [Near ${P} but face-down could compile!]`):(M+=40,$+=` [Near compile: ${P}]`)}i&&W<=2&&(M-=50,$+=" [Low value early game penalty]"),S(D,E)||(M-=80,$+=" [No valid targets for effect]"),N(D)&&(M-=30,$+=" [Draw would cause discard]");const ne=il.some(F=>D.keywords[F]);if(ne&&m?d&&o.player.laneValues[E]>=5?(M+=35,$+=" [Disruption with targets]"):o.player.laneValues[E]>=8&&(M+=50,$+=" [Disruption near compile]"):ne&&!m&&(M-=40,$+=" [Disruption but no targets]"),A!==-1&&!x&&(E===A?(M+=150,$+=" [FOCUS LANE]"):(M-=100,$+=" [Not focus lane]")),x){const F=o.opponent.laneValues[E]>o.player.laneValues[E],z=P>o.player.laneValues[E],H=o.opponent.laneValues[E]===o.player.laneValues[E];if(F)M-=200,$+=" [ALREADY LEADING - DON'T WASTE!]";else if(!F&&z)y===1?(M+=500,$+=" [CONTROL CAPTURE! 1->2 leads]"):y===0?(M+=300,$+=" [First lead! 0->1 leads]"):(M+=100,$+=" [Extra lead]");else if(H&&z)y===1?(M+=450,$+=" [BREAK TIE FOR CONTROL!]"):(M+=250,$+=" [Break tie]");else if(!F&&!z&&y===1){const V=o.player.laneValues[E]-P;V<=3?(M+=200,$+=` [BUILD toward 2nd lead, gap=${V}]`):V<=6?(M+=150,$+=` [BUILD toward 2nd lead, gap=${V}]`):(M+=100,$+=` [BUILD toward 2nd lead, gap=${V}]`)}}}n.push({move:{type:"playCard",cardId:D.id,laneIndex:E,isFaceUp:!0},score:Sh(M),reason:$})}if(I.allowed){const M=Mn({...D,isFaceUp:!1},o.opponent.lanes[E]),$=o.opponent.laneValues[E]+M,W=o.opponent.laneValues[E];let P=-100,ne=`Play ${D.protocol}-${D.value} face-down in lane ${E}`;if(T?$>o.player.laneValues[E]?(P=150,ne+=" [Blocks compile]"):(P=-200,ne+=" [Fails to block]"):!o.opponent.compiled[E]&&$>=10&&$>o.player.laneValues[E]?(P=300,ne+=` [COMPILE: Face-down finishes at ${W} -> ${$} beats player ${o.player.laneValues[E]}]`):!o.opponent.compiled[E]&&o.player.laneValues[E]>=10&&$>=o.player.laneValues[E]?(P=250,ne+=` [BLOCK COMPILE: Face-down reaches ${$} vs player ${o.player.laneValues[E]}]`):!o.opponent.compiled[E]&&o.player.laneValues[E]>=10&&$<o.player.laneValues[E]?(P=-200,ne+=` [WASTED: ${$} vs player ${o.player.laneValues[E]} - player still compiles!]`):A===E&&!o.opponent.compiled[E]&&W>=4?(P=50+W*10,ne+=` [BUILD FOCUS: ${W} -> ${$}]`):!j.allowed&&D.value<=1?(P=-20,ne+=" [No face-up option, low value]"):(P=-120,ne+=" [Avoid: Face-up is better]"),A!==-1&&P<50&&!x&&(E===A?(P+=50,ne+=" [Focus lane]"):(P-=80,ne+=" [Not focus lane]")),x){const F=o.opponent.laneValues[E]>o.player.laneValues[E],z=$>o.player.laneValues[E],H=o.opponent.laneValues[E]===o.player.laneValues[E];if(F)P-=200,ne+=" [FD ALREADY LEADING - DON'T WASTE!]";else if(!F&&z)y===1?(P+=400,ne+=" [FD CONTROL CAPTURE! 1->2 leads]"):y===0&&(P+=250,ne+=" [FD First lead!]");else if(H&&z)y===1?(P+=350,ne+=" [FD BREAK TIE FOR CONTROL!]"):(P+=200,ne+=" [FD Break tie]");else if(!F&&!z&&y===1){const V=o.player.laneValues[E]-$;V<=3?(P+=150,ne+=` [FD BUILD toward 2nd lead, gap=${V}]`):V<=6&&(P+=100,ne+=` [FD BUILD toward 2nd lead, gap=${V}]`)}}n.push({move:{type:"playCard",cardId:D.id,laneIndex:E,isFaceUp:!1},score:Sh(P),reason:ne})}}if(o.opponent.hand.length===0)n.push({move:{type:"fillHand"},score:500,reason:"Must refill - no cards"});else{const D=o.player.laneValues.some((I,k)=>I>=10&&I>o.opponent.laneValues[k]&&!o.player.compiled[k]),E=o.controlCardHolder==="opponent",j=o.player.compiled.some(I=>I);D&&E&&j&&n.push({move:{type:"fillHand"},score:200,reason:"Emergency draw to block compile with control swap"})}if(n.length===0)return{type:"fillHand"};n.sort((D,E)=>E.score-D.score);const q=D=>{if(D.type==="playCard"&&D.isFaceUp){const E=o.opponent.hand.find(I=>I.id===D.cardId);if(!E)return!1;const j=so(o,"opponent",D.laneIndex,!0,E.protocol);if(!j.allowed)return console.warn(`[AI Safety] Rejecting invalid face-up play: ${E.protocol}-${E.value} in lane ${D.laneIndex} - ${j.reason}`),!1}return!0};if(ol()&&n.length>1&&n[1].score>0&&q(n[1].move))return n[1].move;for(const D of n)if(q(D.move))return D.move;return console.warn("[AI Safety] No valid moves found, falling back to fillHand"),{type:"fillHand"}},S_=(o,n)=>{var r,s;switch(n.type){case"prompt_use_control_mechanic":{const i=o.player.compiled.filter(h=>h).length,d=o.compilableLanes.length>0?o.compilableLanes[0]:null;let f=-1;for(let h=0;h<3;h++)if(!o.player.compiled[h]&&o.player.laneValues[h]>=10&&o.player.laneValues[h]>o.opponent.laneValues[h]){f=h;break}const m=o.player.compiled.map((h,p)=>h?p:-1).filter(h=>h!==-1);return f!==-1&&m.length>0?(console.log(`[AI Control] BLOCKING WIN: Player threatening in lane ${f}, swapping with compiled lane`),{type:"resolveControlMechanicPrompt",choice:"player"}):i===0?bh(o,d)&&!ol()?{type:"resolveControlMechanicPrompt",choice:"opponent"}:{type:"resolveControlMechanicPrompt",choice:"skip"}:y_(o,d)?{type:"resolveControlMechanicPrompt",choice:"player"}:bh(o,d)&&!ol()?{type:"resolveControlMechanicPrompt",choice:"opponent"}:{type:"resolveControlMechanicPrompt",choice:"skip"}}case"discard":return{type:"discardCards",cardIds:[...o.opponent.hand].sort((d,f)=>{const m=il.some(p=>d.keywords[p]),h=il.some(p=>f.keywords[p]);return m&&!h?1:!m&&h?-1:At(d)-At(f)}).slice(0,n.count).map(d=>d.id)};case"discard_completed":return{type:"skip"};case"select_opponent_card_to_flip":{const d=(m=>o[m].lanes.map(h=>h.length>0?h[h.length-1]:null).filter(h=>h!==null))("player");if(d.length===0)return{type:"skip"};const f=d.map(m=>({cardId:m.id,score:m.isFaceUp?m.value+5:3}));return f.sort((m,h)=>h.score-m.score),{type:"flipCard",cardId:f[0].cardId}}case"select_cards_to_delete":{const i=n.disallowedIds||[],d=n.targetFilter??{},f="actorChooses"in n?n.actorChooses:"effect_owner",m=n.sourceCardId;if(f==="card_owner"&&(d==null?void 0:d.owner)==="opponent"){const y=[];return o.opponent.lanes.forEach(v=>{if(v.length>0){const x=v[v.length-1];nl(x,!0,d,m)&&y.push(x)}}),y.length>0?(y.sort((v,x)=>v.value-x.value),{type:"deleteCard",cardId:y[0].id}):{type:"skip"}}const h=y=>o[y].lanes.map(v=>v.length>0?v[v.length-1]:null).filter(v=>v!==null).filter(v=>nl(v,!0,d,m)),p=d==null?void 0:d.owner;if(p==="own"){const y=h("opponent").filter(v=>!i.includes(v.id));if(y.length>0)return{type:"deleteCard",cardId:y.sort((x,_)=>x.value-_.value)[0].id}}else if(p==="opponent"){const y=h("player").filter(v=>!i.includes(v.id));if(y.length>0){const v=y.map(x=>{const _=o.player.lanes.findIndex(C=>C.some(A=>A.id===x.id)),w=o.player.laneValues[_],U=w>=10&&w>o.opponent.laneValues[_];return{cardId:x.id,score:tl(x,"player",o)+w+(U?50:0)}});return v.sort((x,_)=>_.score-x.score),{type:"deleteCard",cardId:v[0].cardId}}}else{const y=h("player").filter(x=>!i.includes(x.id));if(y.length>0){const x=y.map(_=>{const w=o.player.lanes.findIndex(A=>A.some(S=>S.id===_.id)),U=o.player.laneValues[w],C=U>=10&&U>o.opponent.laneValues[w];return{cardId:_.id,score:tl(_,"player",o)+U+(C?50:0)}});return x.sort((_,w)=>w.score-_.score),{type:"deleteCard",cardId:x[0].cardId}}const v=h("opponent").filter(x=>!i.includes(x.id));if(v.length>0)return{type:"deleteCard",cardId:v.sort((_,w)=>_.value-w.value)[0].id}}return{type:"skip"}}case"select_any_card_to_flip":case"select_any_other_card_to_flip":case"select_any_face_down_card_to_flip_optional":case"select_any_card_to_flip_optional":{const i=Yn(o),d=n.targetFilter,f=n.sourceCardId,m=n.actor,h=n.currentLaneIndex??n.laneIndex,p=n.scope,y=[];for(const x of["player","opponent"])if(!(d&&(d.owner==="own"&&x!==m||d.owner==="opponent"&&x===m)))for(let _=0;_<o[x].lanes.length;_++){if(h!==void 0&&_!==h||p==="this_lane"&&h!==void 0&&_!==h)continue;const w=o[x].lanes[_];if(w.length!==0)for(let U=0;U<w.length;U++){const C=w[U],A=U===w.length-1;if(d){if(!nl(C,A,d,f))continue}else if(!A)continue;i&&!C.isFaceUp||y.push({card:C,owner:x})}}if(y.length===0)return{type:"skip"};const v=y.map(({card:x,owner:_})=>{let w=0,U=-1;for(let D=0;D<o[_].lanes.length;D++)if(o[_].lanes[D].some(E=>E.id===x.id)){U=D;break}const C=U>=0?o[_].laneValues[U]:0,A=U>=0?o[_].compiled[U]:!1,S=x.isFaceUp?x.value:2,q=(x.isFaceUp?2:x.value)-S;return _==="player"?x.isFaceUp?(w=-q*15,w+=tl(x,"player",o)):x.value<=1?w=20:w=-30:x.isFaceUp?q>0?(w=q*20+50,!A&&C+q>=10&&(w+=200,console.log(`[AI Flip] Own ${x.protocol}-${x.value} flip enables COMPILE!`))):w=q*15-30:q>0?(w=q*20+40,!A&&C+q>=10&&(w+=200,console.log(`[AI Flip] Own ${x.protocol}-${x.value} flip enables COMPILE!`))):w=-10,{cardId:x.id,score:w}});return v.sort((x,_)=>_.score-x.score),{type:"flipCard",cardId:v[0].cardId}}case"plague_2_opponent_discard":return o.opponent.hand.length===0?{type:"skip"}:{type:"discardCards",cardIds:[[...o.opponent.hand].sort((d,f)=>At(d)-At(f))[0].id]};case"select_cards_from_hand_to_discard_for_fire_4":{const i=Math.min(3,o.opponent.hand.length);return i===0?{type:"skip"}:{type:"discardCards",cardIds:[...o.opponent.hand].sort((m,h)=>At(m)-At(h)).slice(0,i).map(m=>m.id)}}case"select_cards_from_hand_to_discard_for_hate_1":{const i=Math.min(n.count||1,o.opponent.hand.length);return i===0?{type:"skip"}:{type:"discardCards",cardIds:[...o.opponent.hand].sort((m,h)=>At(m)-At(h)).slice(0,i).map(m=>m.id)}}case"select_card_from_hand_to_play":{if(o.opponent.hand.length===0)return{type:"skip"};const i=n.faceDown===!0;console.log("[AI select_card_from_hand_to_play] faceDown:",n.faceDown,"isForcedFaceDown:",i);let d=[0,1,2].filter(h=>h!==n.disallowedLaneIndex);if(d=d.filter(h=>{const p=o.player.lanes[h],y=p.length>0?p[p.length-1]:null;return!(y&&y.isFaceUp&&y.protocol==="Plague"&&y.value===0)}),d.length===0)return{type:"skip"};const f=[];for(const h of o.opponent.hand)for(const p of d){if(!i){const x=o.opponent.lanes.flat().some(C=>C.isFaceUp&&C.protocol==="Spirit"&&C.value===1),_=o.opponent.lanes.some(C=>{if(C.length===0)return!1;const A=C[C.length-1];return A.isFaceUp&&A.protocol==="Chaos"&&A.value===3}),w=[...o.player.lanes.flat(),...o.opponent.lanes.flat()].some(C=>C.isFaceUp&&C.protocol==="Anarchy"&&C.value===1);let U;if(w?U=h.protocol!==o.opponent.protocols[p]&&h.protocol!==o.player.protocols[p]:U=h.protocol===o.opponent.protocols[p]||h.protocol===o.player.protocols[p]||x||_,U){const C=h.value,A=o.opponent.laneValues[p]+C;let S=At(h)+C*2;A>=10&&A>o.player.laneValues[p]&&(S+=100),f.push({cardId:h.id,laneIndex:p,isFaceUp:!0,score:S})}}if(!o.player.lanes[p].some(x=>x.isFaceUp&&x.protocol==="Metal"&&x.value===2)){const x=Mn({...h,isFaceUp:!1},o.opponent.lanes[p]),_=o.opponent.laneValues[p]+x;let w=x*2;_>=10&&_>o.player.laneValues[p]&&(w+=80),f.push({cardId:h.id,laneIndex:p,isFaceUp:!1,score:w})}}if(f.length===0)return{type:"skip"};f.sort((h,p)=>p.score-h.score);const m=f[0];return{type:"playCard",cardId:m.cardId,laneIndex:m.laneIndex,isFaceUp:m.isFaceUp}}case"select_card_from_hand_to_give":return o.opponent.hand.length===0?{type:"skip"}:{type:"giveCard",cardId:[...o.opponent.hand].sort((d,f)=>At(d)-At(f))[0].id};case"select_card_from_hand_to_reveal":return o.opponent.hand.length===0?{type:"skip"}:{type:"revealCard",cardId:[...o.opponent.hand].sort((d,f)=>At(f)-At(d))[0].id};case"select_card_to_return":case"select_opponent_card_to_return":{const d={position:"uncovered",...n.targetFilter||{}},f=n.targetOwner||d.owner,m=n.sourceCardId,h=n.actor,p=[];for(const x of["player","opponent"])if(!(f==="own"&&x!==h)&&!(f==="opponent"&&x===h))for(const _ of o[x].lanes)for(let w=0;w<_.length;w++){const U=_[w],C=w===_.length-1;nl(U,C,d,m)&&p.push({card:U,owner:x})}if(p.length===0)return{type:"skip"};const y=p.filter(x=>x.owner==="player"),v=p.filter(x=>x.owner==="opponent");return y.length>0?(y.sort((x,_)=>tl(_.card,"player",o)-tl(x.card,"player",o)),{type:"returnCard",cardId:y[0].card.id}):v.length>0?(v.sort((x,_)=>x.card.value-_.card.value),{type:"returnCard",cardId:v[0].card.id}):{type:"returnCard",cardId:p[0].card.id}}case"select_lane_for_play":{let i=[0,1,2].filter(f=>!("disallowedLaneIndex"in n)||f!==n.disallowedLaneIndex);if(i=i.filter(f=>{const m=o.player.lanes[f],h=m.length>0?m[m.length-1]:null,p=h&&h.isFaceUp&&h.protocol==="Plague"&&h.value===0,y="isFaceDown"in n&&n.isFaceDown&&m.some(v=>v.isFaceUp&&v.protocol==="Metal"&&v.value===2);return!p&&!y}),i.length===0)return{type:"skip"};const d=i.map(f=>{const m=o.opponent.laneValues[f]-o.player.laneValues[f];return{laneIndex:f,score:-m}});return d.sort((f,m)=>m.score-f.score),{type:"selectLane",laneIndex:d[0].laneIndex}}case"prompt_rearrange_protocols":return Hh(o,n);case"prompt_swap_protocols":{const{target:i}=n,d=o[i].protocols,f=o[i].hand,m=o[i].compiled,h=o[i].laneValues,p=[[0,1],[0,2],[1,2]];let y=[0,1],v=-1/0;for(const x of p){const[_,w]=x,U=[...d];[U[_],U[w]]=[U[w],U[_]];let C=0;const A=m[_],S=m[w],N=h[_],q=h[w];if(i==="opponent"){A&&!S?q<N&&(C+=30):S&&!A&&N<q&&(C+=30);for(const D of f){const E=D.protocol===d[_],j=D.protocol===d[w],I=D.protocol===U[_],k=D.protocol===U[w],L=A?.5:1.5,G=S?.5:1.5;I&&!E&&(C+=At(D)*L),k&&!j&&(C+=At(D)*G),!I&&E&&(C-=At(D)*L),!k&&j&&(C-=At(D)*G)}}else{A&&!S?N>q&&(C+=25):S&&!A&&q>N&&(C+=25);for(const D of f){const E=D.protocol===d[_],j=D.protocol===d[w],I=D.protocol===U[_],k=D.protocol===U[w],L=A?.5:1.5,G=S?.5:1.5;I&&!E&&(C-=At(D)*L),k&&!j&&(C-=At(D)*G),!I&&E&&(C+=At(D)*L),!k&&j&&(C+=At(D)*G)}}C>v&&(v=C,y=x)}return{type:"resolveSwapProtocols",indices:y}}case"select_lane_for_shift":{let i=[0,1,2].filter(d=>!("disallowedLaneIndex"in n)||d!==n.disallowedLaneIndex).filter(d=>!("originalLaneIndex"in n)||d!==n.originalLaneIndex);if("sourceCardId"in n){const d=[...o.player.lanes.flat(),...o.opponent.lanes.flat()].find(f=>f.id===n.sourceCardId);if(d&&d.protocol==="Gravity"&&d.value===1){let f=null;for(let m=0;m<3;m++)if([...o.player.lanes[m],...o.opponent.lanes[m]].some(p=>p.id===n.sourceCardId)){f=m;break}f!==null&&"originalLaneIndex"in n&&(n.originalLaneIndex===f||(i=[f]))}if(d&&d.protocol==="Anarchy"&&d.value===1){const f="cardToShiftId"in n?n.cardToShiftId:null;if(f){const m=[...o.player.lanes.flat(),...o.opponent.lanes.flat()].find(h=>h.id===f);m&&(i=i.filter(h=>{const p=o.player.protocols[h],y=o.opponent.protocols[h],v=m.protocol;return v!==p&&v!==y}))}}}if(i.length>0){const d="cardToShiftId"in n?n.cardToShiftId:null;let f=null,m=0;if(d)for(const p of["player","opponent"]){for(const y of o[p].lanes){const v=y.find(x=>x.id===d);if(v){f=p,m=v.isFaceUp?v.value:2;break}}if(f)break}const h=i.map(p=>{let y=0;const v=o.player.laneValues[p],x=o.opponent.laneValues[p],_=o.player.compiled[p],w=o.opponent.compiled[p];return f==="player"?_?y+=100:x>v?y+=50:v>=6&&v<10&&!_&&(y-=50):f==="opponent"&&(!w&&x<10?x+m>=10?y+=100:x>=6?y+=60:y+=30:w&&(y-=50)),{laneIdx:p,score:y}});if(h.sort((p,y)=>y.score-p.score),ol()&&h.length>1){const p=Math.floor(Math.random()*h.length);return{type:"selectLane",laneIndex:h[p].laneIdx}}return{type:"selectLane",laneIndex:h[0].laneIdx}}return{type:"selectLane",laneIndex:0}}case"select_lane_for_delete_all":{const i="validLanes"in n?n.validLanes:[0,1,2];return i.length>0?{type:"selectLane",laneIndex:i[Math.floor(Math.random()*i.length)]}:{type:"skip"}}case"select_lane_for_return":{const i=n.targetFilter||{},d=n.actor,f=i.valueEquals,m=i.valueRange,h=[];for(let p=0;p<3;p++){let y=0,v=0;const x=Gh(o,p);for(const U of["player","opponent"]){if(i.owner==="own"&&U!==d||i.owner==="opponent"&&U===d)continue;const C=o[U].lanes[p];for(let A=0;A<C.length;A++){const S=C[A],N=A===C.length-1;if(i.position==="uncovered"&&!N||i.position==="covered"&&N)continue;const q=S.isFaceUp?S.value:2+x;f!==void 0&&q!==f||m&&(q<m.min||q>m.max)||(U==="player"?y+=q:v+=q)}}const _=y-v,w=`Lane ${p}: Player loses ${y}, we lose ${v}, net=${_}`;h.push({laneIndex:p,score:_,reason:w})}h.sort((p,y)=>y.score-p.score),console.log("[AI select_lane_for_return] Scoring:");for(const p of h)console.log(`  ${p.reason}`);return h.length>0?(console.log(`[AI select_lane_for_return] Choosing lane ${h[0].laneIndex} with score ${h[0].score}`),{type:"selectLane",laneIndex:h[0].laneIndex}):{type:"selectLane",laneIndex:0}}case"prompt_optional_effect":{const{effectDef:i}=n,d=(r=i==null?void 0:i.params)==null?void 0:r.action,f=(s=i==null?void 0:i.params)==null?void 0:s.targetFilter;if(d==="give")return{type:"resolveOptionalEffectPrompt",accept:!1};if(d==="flip"){let m=!1;const h=(f==null?void 0:f.position)||"uncovered";for(const p of["player","opponent"])if(!((f==null?void 0:f.owner)==="own"&&p!=="opponent")&&!((f==null?void 0:f.owner)==="opponent"&&p==="opponent")){for(let y=0;y<o[p].lanes.length;y++){const v=o[p].lanes[y];if(v.length!==0){for(let x=0;x<v.length;x++){const _=v[x],w=x===v.length-1,U=!w;if(h==="uncovered"&&!w||h==="covered"&&!U||(f==null?void 0:f.faceState)==="face_up"&&!_.isFaceUp||(f==null?void 0:f.faceState)==="face_down"&&_.isFaceUp)continue;const C=_.isFaceUp?_.value:2,A=_.isFaceUp?2:_.value;if(p==="player"){if(_.isFaceUp&&C>A){m=!0,console.log(`[AI Flip Decision] Found beneficial target: flip player's ${_.protocol}-${_.value} (${C} -> ${A})`);break}}else{const S=o.opponent.laneValues[y],N=A-C;if(_.isFaceUp&&N>0){m=!0,console.log(`[AI Flip Decision] Found beneficial target: flip own ${_.protocol}-${_.value} face-up->down (+${N} value)`);break}if(!_.isFaceUp&&_.value>2){m=!0,console.log(`[AI Flip Decision] Found beneficial target: flip own ${_.protocol}-${_.value} face-down->up (+${N} value)`);break}if(N>0&&S+N>=10&&!o.opponent.compiled[y]){m=!0,console.log(`[AI Flip Decision] COMPILE OPPORTUNITY: flip own ${_.protocol}-${_.value} enables compile! (${S} + ${N} = ${S+N})`);break}}}if(m)break}}if(m)break}return{type:"resolveOptionalEffectPrompt",accept:m}}return{type:"resolveOptionalEffectPrompt",accept:!ol()}}case"select_card_from_other_lanes_to_delete":{const{disallowedLaneIndex:i,lanesSelected:d}=n,f=[];for(let m=0;m<3;m++){if(m===i||d.includes(m))continue;const h=o.player.lanes[m];if(h.length>0){f.push(h[h.length-1]);continue}const p=o.opponent.lanes[m];p.length>0&&f.push(p[p.length-1])}return f.length>0?{type:"deleteCard",cardId:f[0].id}:{type:"skip"}}case"select_face_down_card_to_delete":{const i="disallowedIds"in n&&Array.isArray(n.disallowedIds)?n.disallowedIds:[],d=h=>o[h].lanes.map(p=>p.length>0?p[p.length-1]:null).filter(p=>p!==null),f=d("player").filter(h=>!i.includes(h.id));if(f.length>0)return{type:"deleteCard",cardId:f[0].id};const m=d("opponent").filter(h=>!i.includes(h.id));return m.length>0?{type:"deleteCard",cardId:m[0].id}:{type:"skip"}}case"select_low_value_card_to_delete":{const i=[];for(const f of["player","opponent"])for(const m of o[f].lanes)m.length>0&&i.push(m[m.length-1]);const d=i.filter(f=>f.isFaceUp&&(f.value===0||f.value===1));return d.length>0?{type:"deleteCard",cardId:d[0].id}:{type:"skip"}}case"select_opponent_face_up_card_to_flip":{const d=(f=>o[f].lanes.map(m=>m.length>0?m[m.length-1]:null).filter(m=>m!==null))("player").filter(f=>f.isFaceUp);return d.length>0?(d.sort((f,m)=>m.value-f.value),{type:"flipCard",cardId:d[0].id}):{type:"skip"}}case"select_covered_card_in_line_to_flip_optional":{const i="optional"in n&&n.optional,f=!["select_any_other_card_to_flip","select_any_other_card_to_flip_for_water_0"].includes(n.type);if(n.type==="select_covered_card_in_line_to_flip_optional"){const{laneIndex:x}=n,_=o.opponent.lanes[x],w=o.player.lanes[x],U=_.filter((E,j,I)=>j<I.length-1),C=w.filter((E,j,I)=>j<I.length-1),A=o.opponent.laneValues[x];if(!o.opponent.compiled[x]){let E=null,j=null;for(const I of U){let k,L;I.isFaceUp?(k=I.value,L=2):(k=Mn(I,_,o,x,"opponent"),L=I.value);const G=L-k,T=A+G;G>0&&T>=10&&(!E||T>E.newValue)&&(E={card:I,newValue:T,gain:G},console.log(`[AI Covered Flip] Found compile opportunity: ${I.protocol}-${I.value} (${I.isFaceUp?"face-up":"face-down"}) gain=${G}, newValue=${T}`)),G>0&&(!j||G>j.gain)&&(j={card:I,gain:G,newValue:T})}if(E)return console.log(`[AI Covered Flip] COMPILE: Flipping ${E.card.protocol}-${E.card.value} for +${E.gain} value -> ${E.newValue}`),{type:"flipCard",cardId:E.card.id};if(j&&j.gain>0)return console.log(`[AI Covered Flip] VALUE GAIN: Flipping ${j.card.protocol}-${j.card.value} for +${j.gain} value -> ${j.newValue}`),{type:"flipCard",cardId:j.card.id}}if(o.opponent.compiled[x]){let E=null;for(const j of U){const I=j.isFaceUp?j.value:Mn(j,_,o,x,"opponent"),L=(j.isFaceUp?2:j.value)-I;L>0&&(!E||L>E.gain)&&(E={card:j,gain:L})}if(E)return{type:"flipCard",cardId:E.card.id}}const N=C.filter(E=>E.isFaceUp);if(N.length>0)return N.sort((E,j)=>j.value-E.value),{type:"flipCard",cardId:N[0].id};const q=U.filter(E=>!E.isFaceUp).map(E=>({card:E,gain:E.value-Mn(E,_,o,x,"opponent")})).filter(E=>E.gain>0).sort((E,j)=>j.gain-E.gain);if(q.length>0)return{type:"flipCard",cardId:q[0].card.id};const D=C.filter(E=>!E.isFaceUp);return D.length>0?{type:"flipCard",cardId:D[0].id}:{type:"skip"}}const m=x=>o[x].lanes.map(_=>_.length>0?_[_.length-1]:null).filter(_=>_!==null),h=m("player"),p=m("opponent");{const x=h.filter(_=>_.isFaceUp).sort((_,w)=>w.value-_.value);if(x.length>0)return{type:"flipCard",cardId:x[0].id}}const y=p.filter(x=>!x.isFaceUp);if(y.length>0)return{type:"flipCard",cardId:y[0].id};const v=h.filter(x=>!x.isFaceUp);if(v.length>0)return{type:"flipCard",cardId:v[0].id};{const x=p.filter(w=>!(!w.isFaceUp||!f&&w.id===n.sourceCardId)),_=x.filter(w=>{const U=o.opponent.lanes.findIndex(C=>C.length>0&&C[C.length-1].id===w.id);return U!==-1&&o.opponent.compiled[U]});if(_.length>0&&!i)return{type:"flipCard",cardId:_[0].id};if(x.length>0&&!i)return{type:"flipCard",cardId:x[0].id}}return{type:"skip"}}case"select_card_to_shift_for_anarchy_0":{const i=[...o.player.lanes.flat(),...o.opponent.lanes.flat()];return i.length>0?{type:"shiftCard",cardId:i[Math.floor(Math.random()*i.length)].id}:{type:"skip"}}case"select_card_to_shift_for_anarchy_1":{const{sourceCardId:i}=n,d=[...o.player.lanes.flat(),...o.opponent.lanes.flat()].filter(f=>f.id!==i);return d.length>0?{type:"shiftCard",cardId:d[Math.floor(Math.random()*d.length)].id}:{type:"skip"}}case"select_card_to_shift_for_gravity_1":{const i=[...o.player.lanes.flat(),...o.opponent.lanes.flat()];return i.length>0?{type:"shiftCard",cardId:i[Math.floor(Math.random()*i.length)].id}:{type:"skip"}}case"select_face_down_card_to_shift_for_gravity_4":{const{targetLaneIndex:i}=n,d=[];for(const f of["player","opponent"])for(let m=0;m<o[f].lanes.length;m++)if(m!==i)for(const h of o[f].lanes[m])h.isFaceUp||d.push(h);return d.length>0?{type:"deleteCard",cardId:d[Math.floor(Math.random()*d.length)].id}:{type:"skip"}}case"select_face_down_card_to_shift_for_darkness_4":{const i=[];for(const d of["player","opponent"])for(const f of o[d].lanes)if(f.length>0){const m=f[f.length-1];m.isFaceUp||i.push(m)}return i.length>0?{type:"deleteCard",cardId:i[Math.floor(Math.random()*i.length)].id}:{type:"skip"}}case"shift_flipped_card_optional":{const i=n.cardId,d=n.optional,f=ve(o,i);if(!f)return{type:"skip"};const m=f.card,h=f.owner,p=m.isFaceUp?m.value:2;let y=f.laneIndex??-1;if(y===-1){const D=o[h];for(let E=0;E<D.lanes.length;E++)if(D.lanes[E].some(j=>j.id===i)){y=E;break}}if(y===-1)return{type:"skip"};const v=[0,1,2].filter(D=>D!==y);if(v.length===0)return{type:"skip"};const x=o.opponent,_=o.player,w=x.laneValues[y],U=x.compiled[y],C=_.laneValues[y],A=w-p;let S=-1,N=-1/0;const q=0;for(const D of v){const E=x.laneValues[D],j=x.compiled[D],I=_.laneValues[D],k=E+p;let L=0;!U&&w>=8&&w>C&&(L-=100),!j&&k>=10&&k>I&&(L+=80),!j&&E<w&&(U||w<6)&&(L+=20),j&&(L-=30),!j&&E<=I&&k>I&&(L+=25),!U&&w>C&&A<=C&&(L-=40),L>N&&(N=L,S=D)}return d&&N<q?{type:"skip"}:S!==-1?{type:"selectLane",laneIndex:S}:d?{type:"skip"}:{type:"selectLane",laneIndex:v[0]}}case"select_opponent_face_down_card_to_shift":{const i=[];for(const d of o.player.lanes)if(d.length>0){const f=d[d.length-1];f.isFaceUp||i.push(f)}return i.length>0?{type:"deleteCard",cardId:i[Math.floor(Math.random()*i.length)].id}:{type:"skip"}}case"select_opponent_covered_card_to_shift":{const i=[];for(const d of o.player.lanes)for(let f=0;f<d.length-1;f++)i.push(d[f]);return i.length>0?{type:"deleteCard",cardId:i[Math.floor(Math.random()*i.length)].id}:{type:"skip"}}case"select_own_covered_card_to_shift":{const i=[];for(const d of o.opponent.lanes)for(let f=0;f<d.length-1;f++)i.push(d[f]);return i.length>0?{type:"deleteCard",cardId:i[Math.floor(Math.random()*i.length)].id}:{type:"skip"}}case"select_card_to_flip":{const i=n.targetFilter||{},d=n.currentLaneIndex??n.laneIndex,f=n.scope,m=n.actor,h=n.sourceCardId,p=[];(d!==void 0||f==="this_lane")&&console.log(`[AI select_card_to_flip] Lane restriction: ${d}, scope: ${f}`);for(const v of["player","opponent"])if(!(i.owner==="own"&&v!==m)&&!(i.owner==="opponent"&&v===m))for(let x=0;x<o[v].lanes.length;x++){if(d!==void 0&&x!==d||f==="this_lane"&&d!==void 0&&x!==d)continue;const _=o[v].lanes[x];for(let w=0;w<_.length;w++){const U=_[w],C=w===_.length-1;nl(U,C,i,h)&&(i.position==="covered_in_this_line"&&C||p.push({card:U,owner:v,laneIndex:x}))}}if(p.length===0)return{type:"skip"};const y=p.map(({card:v,owner:x,laneIndex:_})=>{let w=0;const U=o[x].laneValues[_],C=o[x].compiled[_],A=v.isFaceUp?v.value:2,N=(v.isFaceUp?2:v.value)-A;return x==="player"?v.isFaceUp?(w=-N*15,w+=tl(v,"player",o)):v.value<=1?w=20:w=-30:v.isFaceUp?N>0?(w=N*20+50,!C&&U+N>=10&&(w+=200,console.log(`[AI Flip Score] Flip own ${v.protocol}-${v.value} face-up->down ENABLES COMPILE! (${U} + ${N} = ${U+N})`))):w=N*15-30:N>0?(w=N*20+40,!C&&U+N>=10&&(w+=200,console.log(`[AI Flip Score] Flip own ${v.protocol}-${v.value} face-down->up ENABLES COMPILE! (${U} + ${N} = ${U+N})`))):w=-10,{card:v,score:w}});if(y.sort((v,x)=>x.score-v.score),ol()&&y.length>1){const v=Math.floor(Math.random()*y.length);return{type:"flipCard",cardId:y[v].card.id}}return{type:"flipCard",cardId:y[0].card.id}}case"select_card_to_shift":{const i=n.targetFilter||{},d=n.currentLaneIndex??n.laneIndex,f=n.scope,m=n.actor,h=n.sourceCardId,p=[];for(const y of["player","opponent"])if(!(i.owner==="own"&&y!==m)&&!(i.owner==="opponent"&&y===m))for(let v=0;v<o[y].lanes.length;v++){if(d!==void 0&&v!==d||f==="this_lane"&&d!==void 0&&v!==d)continue;const x=o[y].lanes[v];for(let _=0;_<x.length;_++){const w=x[_],U=_===x.length-1;nl(w,U,i,h)&&p.push(w)}}return p.length>0?{type:"deleteCard",cardId:p[Math.floor(Math.random()*p.length)].id}:{type:"skip"}}case"select_board_card_to_reveal_custom":{const i=[];for(const d of["player","opponent"])for(const f of o[d].lanes)if(f.length>0){const m=f[f.length-1];m.isFaceUp||i.push({card:m,owner:d})}if(i.length>0){const d=i.filter(f=>f.owner==="player");return d.length>0?{type:"deleteCard",cardId:d[0].card.id}:{type:"deleteCard",cardId:i[0].card.id}}return{type:"skip"}}case"prompt_shift_or_flip_board_card_custom":{const{revealedCardId:i}=n,d=ve(o,i);return d?d.owner==="opponent"?{type:"resolveRevealBoardCardPrompt",choice:"flip"}:{type:"resolveRevealBoardCardPrompt",choice:"shift"}:{type:"resolveRevealBoardCardPrompt",choice:"skip"}}case"select_lane_to_shift_revealed_board_card_custom":{const i=[0,1,2];return i.sort((d,f)=>o.player.laneValues[d]-o.player.laneValues[f]),{type:"selectLane",laneIndex:i[0]}}case"gravity_2_shift_after_flip":{const{targetLaneIndex:i}=n;return{type:"selectLane",laneIndex:i}}case"flip_self":case"flip_self_for_water_0":case"flip_self_for_psychic_4":case"speed_3_self_flip_after_shift":return n.sourceCardId?{type:"flipCard",cardId:n.sourceCardId}:{type:"skip"};case"anarchy_0_conditional_draw":return{type:"skip"};case"select_any_opponent_card_to_shift":{const i=o.player.lanes.map(d=>d.length>0?d[d.length-1]:null).filter(d=>d!==null);return i.length>0?{type:"deleteCard",cardId:i[Math.floor(Math.random()*i.length)].id}:{type:"skip"}}case"select_own_other_card_to_shift":{const i=o.opponent.lanes.flat().find(d=>d.id!==n.sourceCardId);return i?{type:"deleteCard",cardId:i.id}:{type:"skip"}}case"select_own_face_up_covered_card_to_flip":return{type:"skip"};case"plague_4_opponent_delete":{const i=[];return o.opponent.lanes.forEach(d=>{if(d.length>0){const f=d[d.length-1];f.isFaceUp||i.push(f)}}),i.length>0?(i.sort((d,f)=>d.value-f.value),{type:"deleteCard",cardId:i[0].id}):{type:"skip"}}case"reveal_opponent_hand":case"plague_2_player_discard":case"delete_self":return{type:"skip"};case"select_lane_for_delete":{const i=n.validLanes||[0,1,2],d=n.valueFilter,f=i.map(m=>{let h=0,p=0;for(const y of o.player.lanes[m]){const v=y.isFaceUp?y.value:2;d?y.isFaceUp?y.value>=d.min&&y.value<=d.max&&(h+=v+1):h+=(v+1)*.5:h+=v+1}for(const y of o.opponent.lanes[m]){const v=y.isFaceUp?y.value:2;d?y.isFaceUp?y.value>=d.min&&y.value<=d.max&&(p+=v+3):p+=(v+3)*.5:p+=v+3}return{laneIndex:m,score:h-p}});return f.sort((m,h)=>h.score-m.score),f[0].score>0?{type:"selectLane",laneIndex:f[0].laneIndex}:{type:"selectLane",laneIndex:f[0].laneIndex}}case"select_lane_for_shift_all":{const i=n.validDestinationLanes||n.validLanes||[0,1,2],d=n.sourceLaneIndex,f=i.filter(m=>m!==d);if(f.length>0){const m=f.map(h=>{let p=0;return p+=o.opponent.lanes[h].length*2,p+=o.opponent.laneValues[h],o.player.laneValues[h]>=8&&(p-=5),{laneIndex:h,score:p}});return m.sort((h,p)=>p.score-h.score),{type:"selectLane",laneIndex:m[0].laneIndex}}return i.length>0?{type:"selectLane",laneIndex:i[0]}:{type:"selectLane",laneIndex:0}}case"prompt_optional_draw":return{type:"resolveOptionalEffectPrompt",accept:!0};case"prompt_optional_discard_custom":return{type:"resolveOptionalEffectPrompt",accept:o.opponent.hand.length>4};case"custom_choice":{const{options:i}=n;if(!i||i.length!==2)return{type:"resolveCustomChoice",optionIndex:0};const d=h=>{var v,x,_;let p=0;const y=((v=h.action)==null?void 0:v.toLowerCase())||"";return y.includes("draw")&&(p+=30),y.includes("discard")&&(p-=20),y.includes("delete")&&((x=h.targetFilter)==null?void 0:x.owner)==="opponent"&&(p+=40),y.includes("delete")&&((_=h.targetFilter)==null?void 0:_.owner)==="own"&&(p-=30),p},f=d(i[0]),m=d(i[1]);return{type:"resolveCustomChoice",optionIndex:f>=m?0:1}}default:{if(console.log("[AI DEFAULT] Unhandled action type:",n.type,"optional:",n.optional),"optional"in n&&n.optional)return{type:"skip"};const i=[...o.player.lanes.flat(),...o.opponent.lanes.flat()];return i.length>0&&(n.type.includes("select_")||n.type.includes("shift"))?{type:"deleteCard",cardId:i[0].id}:{type:"skip"}}}},Eh=(o,n)=>n?S_(o,n):o.phase==="compile"&&o.compilableLanes.length>0?{type:"compile",laneIndex:o.compilableLanes.reduce((s,i)=>o.opponent.laneValues[i]>o.opponent.laneValues[s]?i:s)}:o.phase==="action"?b_(o):{type:"fillHand"};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Ft=(o,n)=>o.phase==="start"?n.continueTurnAfterStartPhaseAction(o):n.processEndOfAction(o),Yh=(o,n,r,s,i,d,f,m)=>{const{cardId:h,laneIndex:p,isFaceUp:y}=n,{newState:v,animationRequests:x}=i.playCard({...o,actionRequired:null},h,p,y,"opponent"),_={...v,animationState:{type:"playCard",cardId:h,owner:"opponent"}};return setTimeout(()=>{r(w=>{let U={...w,animationState:null};return x&&x.length>0?(d(x,()=>r(C=>m&&C.actionRequired?(cn(C,r,s,i,d,f),C):C.actionRequired&&C.actionRequired.actor==="opponent"?C:Ft(C,f))),U):m&&U.actionRequired?(cn(U,r,s,i,d,f),U):U.actionRequired&&U.actionRequired.actor==="opponent"?U:Ft(U,f)})},500),_},qc=(o,n,r)=>{switch(r){case"normal":return Eh(o,n);case"hard":return console.warn("[AI] Hard AI temporarily disabled, using Normal AI"),Eh(o,n);default:return C_(o,n)}},E_=(o,n,r,s,i,d,f,m,h)=>{n(p=>{const y=p.actionRequired;if(!y||!((p.turn==="player"||p._interruptedTurn==="player")&&"actor"in y&&y.actor==="opponent"))return p;if(y.type==="discard_completed"){const{followUpEffect:U,conditionalType:C,previousHandSize:A,sourceCardId:S,actor:N}=y;if(U&&S){const q=ve(p,S);if(q){const D=p[N].hand.length,E=Math.max(0,(A||0)-D);if(C==="then"||C==="if_executed"&&E>0){console.log(`[AI Interrupt discard_completed] Executing follow-up effect, discardedCount: ${E}`);let I=-1;for(let k=0;k<p[q.owner].lanes.length;k++)if(p[q.owner].lanes[k].some(L=>L.id===S)){I=k;break}if(I!==-1){const k={cardOwner:q.owner,opponent:q.owner==="player"?"opponent":"player",currentTurn:p.turn,actor:N,discardedCount:E},{executeCustomEffect:L}=require("../customProtocols/effectInterpreter");return L(q.card,I,{...p,actionRequired:null},k,U).newState}}}}return{...p,actionRequired:null}}const _=qc(p,y,r);if(_.type==="discardCards"&&y.type==="discard"){const C=y.variableCount===!0?_.cardIds.length:y.count,A=_.cardIds.slice(0,C);A.length!==_.cardIds.length&&console.warn(`[AI Manager] Fixed discard count: AI wanted ${_.cardIds.length} but action.count=${y.count}`);const S=s.discardCards(p,A,"opponent");return S.actionRequired?S:Ft(S,i)}if(_.type==="rearrangeProtocols"&&y.type==="prompt_rearrange_protocols"){h&&y.sourceCardId==="CONTROL_MECHANIC"&&y.actor&&h(y.actor),console.log("[DEBUG aiManager] Before resolveRearrangeProtocols, actor hand:",p[y.actor].hand.length);const U=s.resolveRearrangeProtocols(p,_.newOrder);console.log("[DEBUG aiManager] After resolveRearrangeProtocols, actor hand:",U[y.actor].hand.length);const C=Ft(U,i);return console.log("[DEBUG aiManager] After endActionForPhase, actor hand:",C[y.actor].hand.length),C}if(y.type==="reveal_opponent_hand"){const U=s.revealOpponentHand(p);return Ft(U,i)}if(_.type==="selectLane"){const{nextState:U,requiresAnimation:C}=m(p,_.laneIndex);if(C){const A=p.phase==="start";return d(C.animationRequests,()=>{n(S=>{const N=C.onCompleteCallback(S,q=>q);return N.actionRequired&&N.actionRequired.actor==="opponent"?N:A?i.continueTurnAfterStartPhaseAction(N):i.processEndOfAction(N)})}),U}return Ft(U,i)}if(_.type==="deleteCard"||_.type==="flipCard"||_.type==="returnCard"||_.type==="shiftCard"){const{nextState:U,requiresAnimation:C}=f(p,_.cardId);if(C){const A=p.phase==="start";return d(C.animationRequests,()=>{n(S=>{const N=C.onCompleteCallback(S,q=>q);return N.actionRequired&&N.actionRequired.actor==="opponent"?N:A?i.continueTurnAfterStartPhaseAction(N):i.processEndOfAction(N)})}),U}return U.actionRequired&&U.actionRequired.actor==="opponent"?U:Ft(U,i)}if(_.type==="playCard"&&y.type==="select_card_from_hand_to_play")return Yh(p,_,n,r,s,d,i,!1);console.warn(`AI has no logic for mandatory action during player turn, clearing it: ${y.type}`);const w={...p,actionRequired:null};return Ft(w,i)})},j_=(o,n,r,s,i,d,f)=>{var y;const m=o.actionRequired;if(m.type==="discard_completed"){const{followUpEffect:v,conditionalType:x,previousHandSize:_,sourceCardId:w,actor:U}=m;if(v&&w){const C=ve(o,w);if(C){const A=o[U].hand.length,S=Math.max(0,(_||0)-A);if(x==="then"||x==="if_executed"&&S>0){console.log(`[AI runOpponentTurn discard_completed] Executing follow-up effect, discardedCount: ${S}`);let q=-1;for(let D=0;D<o[C.owner].lanes.length;D++)if(o[C.owner].lanes[D].some(E=>E.id===w)){q=D;break}if(q!==-1){const D={cardOwner:C.owner,opponent:C.owner==="player"?"opponent":"player",currentTurn:o.turn,actor:U,discardedCount:S},{executeCustomEffect:E}=require("../customProtocols/effectInterpreter");return E(C.card,q,{...o,actionRequired:null},D,v).newState}}}}return{...o,actionRequired:null}}const h=qc(o,o.actionRequired,r);if(h.type==="skip"){console.log("[AI SKIP] Skipping action, phase:",o.phase,"turn:",o.turn);const v=s.skipAction(o),x=o.phase==="start"?d.continueTurnAfterStartPhaseAction(v):d.processEndOfAction(v);return console.log("[AI SKIP] After skip processing, phase:",x.phase,"turn:",x.turn,"actionRequired:",(y=x.actionRequired)==null?void 0:y.type),!x.actionRequired&&x.turn==="opponent"&&!x.winner?(console.log("[AI SKIP] Scheduling runOpponentTurn continuation in 500ms"),setTimeout(()=>{console.log("[AI SKIP] Running scheduled runOpponentTurn"),cn(x,n,r,s,i,d,f)},500)):console.log("[AI SKIP] NOT scheduling continuation - actionRequired:",!!x.actionRequired,"turn:",x.turn,"winner:",!!x.winner),x}if(h.type==="resolveControlMechanicPrompt"&&m.type==="prompt_use_control_mechanic"){const{choice:v}=h,{originalAction:x,actor:_}=m;if(v==="skip"){let w=re(o,_,"Opponent skips rearranging protocols.");if(w.actionRequired=null,w={...w,_logIndentLevel:0},x.type==="compile"){const U=x.laneIndex;return setTimeout(()=>{n(C=>{const A=s.compileLane(C,U);return A.winner?A:{...d.processEndOfAction(A),animationState:null}})},1e3),{...w,animationState:{type:"compile",laneIndex:U},compilableLanes:[]}}else if(x.type==="fill_hand"){const U=s.fillHand(w,_);return d.processEndOfAction(U)}else return d.processEndOfAction(w)}else{const w=v;let A=re(o,_,`Opponent chooses to rearrange ${w==="opponent"?"the player's":"their own"} protocols.`);return A.actionRequired={type:"prompt_rearrange_protocols",sourceCardId:"CONTROL_MECHANIC",target:w,actor:_,originalAction:x},A}}if(h.type==="resolveOptionalDiscardCustomPrompt"&&m.type==="prompt_optional_discard_custom"){const v=s.resolveOptionalDiscardCustomPrompt(o,h.accept);return v.actionRequired?v:Ft(v,d)}if(h.type==="resolveOptionalEffectPrompt"){console.log("[AI resolveOptionalEffectPrompt] accept:",h.accept,"phase:",o.phase);const v=s.resolveOptionalEffectPrompt(o,h.accept);return v.actionRequired?v:Ft(v,d)}if(h.type==="resolveSwapProtocols"&&m.type==="prompt_swap_protocols"){const v=s.resolveSwapProtocols(o,h.indices);return Ft(v,d)}if(h.type==="resolveCustomChoice"&&m.type==="custom_choice"){const v=s.resolveCustomChoice(o,h.optionIndex);return v.actionRequired?v:Ft(v,d)}if(h.type==="resolveRevealBoardCardPrompt"&&(m.type==="prompt_shift_or_flip_revealed_card"||m.type==="prompt_shift_or_flip_board_card_custom")){const v=id(o,h.choice);return v.actionRequired?v:Ft(v,d)}if(h.type==="rearrangeProtocols"&&m.type==="prompt_rearrange_protocols"){f&&m.sourceCardId==="CONTROL_MECHANIC"&&m.actor&&f(m.actor),console.log("[DEBUG aiManager 2] Before resolveRearrangeProtocols, actor hand:",o[m.actor].hand.length);const v=s.resolveRearrangeProtocols(o,h.newOrder);console.log("[DEBUG aiManager 2] After resolveRearrangeProtocols, actor hand:",v[m.actor].hand.length);const x=Ft(v,d);return console.log("[DEBUG aiManager 2] After endActionForPhase, actor hand:",x[m.actor].hand.length),x}if(h.type==="selectLane"){const{nextState:v,requiresAnimation:x}=cd(o,h.laneIndex);if(x){const{animationRequests:_,onCompleteCallback:w}=x;return i(_,()=>{n(U=>w(U,C=>{const A=o.phase==="start"?d.continueTurnAfterStartPhaseAction(C):d.processEndOfAction(C);return!A.actionRequired&&A.turn==="opponent"&&!A.winner?setTimeout(()=>{cn(A,n,r,s,i,d,f)},500):A.actionRequired&&A.turn==="opponent"&&setTimeout(()=>{cn(A,n,r,s,i,d,f)},300),A}))}),v}return Ft(v,d)}if(h.type==="flipCard"||h.type==="deleteCard"||h.type==="returnCard"||h.type==="shiftCard"){const{nextState:v,requiresAnimation:x,requiresTurnEnd:_}=rd(o,h.cardId);if(x){const{animationRequests:w,onCompleteCallback:U}=x;return i(w,()=>{n(C=>U(C,A=>{if(A.queuedActions&&A.queuedActions.length>0){const S=d.processEndOfAction(A);return S.actionRequired&&cn(S,n,r,s,i,d),S}if(A.actionRequired)return cn(A,n,r,s,i,d),A;if(A.phase==="start"){const S=d.continueTurnAfterStartPhaseAction(A);return!S.actionRequired&&S.turn==="opponent"&&!S.winner&&setTimeout(()=>{cn(S,n,r,s,i,d,f)},500),S}else return d.processEndOfAction(A)}))}),v}return _||v.queuedActions&&v.queuedActions.length>0?Ft(v,d):v}if(h.type==="playCard"&&m.type==="select_card_from_hand_to_play")return Yh(o,h,n,r,s,i,d,!0);if(h.type==="discardCards"&&m.type==="discard"){const x=m.variableCount===!0?h.cardIds.length:m.count,_=h.cardIds.slice(0,x);_.length!==h.cardIds.length&&console.warn(`[AI Manager] Fixed discard count: AI wanted ${h.cardIds.length} but action.count=${m.count}`);const w=s.discardCards(o,_,"opponent");return w.actionRequired?w:Ft(w,d)}if(h.type==="giveCard"&&m.type==="select_card_from_hand_to_give"){const v=s.resolveActionWithHandCard(o,h.cardId);return v.actionRequired?v:Ft(v,d)}if(h.type==="revealCard"&&m.type==="select_card_from_hand_to_reveal")return s.resolveActionWithHandCard(o,h.cardId);console.warn(`AI has no logic for mandatory action, clearing it: ${m.type}`);const p={...o,actionRequired:null};return Ft(p,d)},cn=(o,n,r,s,i,d,f)=>{console.log("[runOpponentTurn] Called with currentGameState phase:",o.phase,"turn:",o.turn),n(m=>{var y;if(console.log("[runOpponentTurn] Inside setGameState, currentState phase:",m.phase,"turn:",m.turn,"actionRequired:",(y=m.actionRequired)==null?void 0:y.type),m.turn!=="opponent"||m.winner||m.animationState)return console.log("[runOpponentTurn] Early return - turn:",m.turn,"winner:",!!m.winner,"animationState:",!!m.animationState),m;if(!["start","compile","action","hand_limit","end"].includes(m.phase))return m;if(m.actionRequired){const v=m.actionRequired;let x=!1;if((v.type==="discard"&&v.actor==="player"||v.type==="plague_4_opponent_delete"&&v.actor==="opponent"||"actor"in v&&v.actor==="player")&&(x=!0),x)return m}let p={...m};if(p.actionRequired&&p.actionRequired.type==="reveal_opponent_hand"){const v=s.revealOpponentHand(p);return d.processEndOfAction(v)}if(p.phase==="start"&&(p=d.processStartOfTurn(p)),p.actionRequired){const v=j_(p,n,r,s,i,d,f);return!v.actionRequired&&v.turn==="opponent"&&!v.winner&&v.phase!=="hand_limit"&&setTimeout(()=>{cn(v,n,r,s,i,d,f)},300),v}if(p.phase==="compile"&&p.compilableLanes.length>0){const v=qc(p,null,r);if(v.type==="compile"){const x=v.laneIndex,_=Ph(p);return _.actionRequired?_:(setTimeout(()=>{n(w=>{const U=s.compileLane(w,x);return U.winner?U:{...d.processEndOfAction(U),animationState:null}})},1e3),{..._,animationState:{type:"compile",laneIndex:x},compilableLanes:[]})}}if(p.phase==="action"){const v=qc(p,null,r);if(v.type==="fillHand"){const x=Ih(p,"opponent");return x.actionRequired?x:d.processEndOfAction(x)}if(v.type==="playCard"){const{newState:x,animationRequests:_}=s.playCard(p,v.cardId,v.laneIndex,v.isFaceUp,"opponent"),w={...x,animationState:{type:"playCard",cardId:v.cardId,owner:"opponent"}};return setTimeout(()=>{const U=()=>{n(C=>{let A={...C},S={newState:A};if(!A.actionRequired){if(A.queuedEffect){const{card:E,laneIndex:j}=A.queuedEffect,I={cardOwner:"opponent",actor:"opponent",currentTurn:A.turn,opponent:"player",triggerType:"play"};S=pr(E,j,A,I),S.newState.queuedEffect=void 0}}const N=S.animationRequests,q=S.newState,D=()=>{n(E=>{if(E.queuedActions&&E.queuedActions.length>0){const j=d.processEndOfAction(E);return j.actionRequired&&cn(j,n,r,s,i,d),j}return E.actionRequired?cn(E,n,r,s,i,d):n(d.processEndOfAction(E)),E})};if(N&&N.length>0)return i(N,D),q;if(q.queuedActions&&q.queuedActions.length>0){const E=d.processEndOfAction(q);return E.actionRequired&&cn(E,n,r,s,i,d),E}return q.actionRequired?cn(q,n,r,s,i,d):n(d.processEndOfAction(q)),q})};n(C=>{const A={...C,animationState:null};return _&&_.length>0?i(_,U):U(),A})},500),w}}return p.phase==="end"||p.phase==="hand_limit"?d.continueTurnProgression(p):d.processEndOfAction(p)})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function A_(o,n){let r=null,s=null;const i=["player","opponent"];for(const y of i){for(const v of o[y].lanes){const x=v.find(_=>_.id===n);if(x){r=y,s=x;break}}if(r)break}if(!r||!s)return console.error("Card to delete not found on board:",n),o;const d={...o},f={...d[r]};f.lanes=f.lanes.map(y=>y.filter(v=>v.id!==n));const{id:m,isFaceUp:h,...p}=s;return f.discard=[...f.discard,p],d[r]=f,d}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const R_=(o,n,r,s,i,d="player",f)=>{const[m,h]=ce.useState(()=>{const z=lr(o,n,i,d);return _e(z)}),[p,y]=ce.useState(null),v=ce.useRef(!1),x=ce.useRef(0);ce.useEffect(()=>{m.turn!==d&&m.log.length<=4&&h(z=>{const H=d==="player"?"Player":"Opponent",V=[...z.log];return V.length>0&&(V[V.length-1]={player:"player",message:`${H} goes first.`}),{...z,turn:d,log:V}})},[d,m.turn,m.log.length]);const _=ce.useCallback(z=>{switch(z){case"start":return Uh;case"end":return ur;default:return dr}},[]),w=ce.useCallback((z,H)=>{const V=Y=>{if(Y.length===0){H();return}const[B,...J]=Y;B.type==="delete"?(h(ee=>({...ee,animationState:{type:"deleteCard",cardId:B.cardId,owner:B.owner}})),setTimeout(()=>{h(ee=>{if(!(ee.player.lanes.flat().some(me=>me.id===B.cardId)||ee.opponent.lanes.flat().some(me=>me.id===B.cardId)))return{...ee,animationState:null};let ye=A_(ee,B.cardId);return ye=_e(ye),{...ye,animationState:null}}),setTimeout(()=>{J.length>0?V(J):H()},10)},500)):B.type==="return"?(h(ee=>({...ee,animationState:{type:"returnCard",cardId:B.cardId,owner:B.owner}})),setTimeout(()=>{h(ee=>{const he=ee[B.owner].lanes.findIndex(Ue=>Ue.some(Xe=>Xe.id===B.cardId)),ye=he!==-1&&ee[B.owner].lanes[he].length>0&&ee[B.owner].lanes[he][ee[B.owner].lanes[he].length-1].id===B.cardId,me=ee[B.owner].lanes.flat().find(Ue=>Ue.id===B.cardId);if(!me)return{...ee,animationState:null};const xe=ee[B.owner].lanes.map(Ue=>Ue.filter(Xe=>Xe.id!==B.cardId));let Ee={...ee,[B.owner]:{...ee[B.owner],lanes:xe,hand:[...ee[B.owner].hand,me]}};return Ee=_e(Ee),ye&&he!==-1&&Ee[B.owner].lanes[he].length>0&&(Ee=_n(Ee,B.owner,he).newState),{...Ee,animationState:null}}),setTimeout(()=>{J.length>0?V(J):H()},10)},500)):B.type==="play"?(h(ee=>({...ee,animationState:{type:"playCard",cardId:B.cardId,owner:B.owner}})),setTimeout(()=>{h(ee=>({...ee,animationState:null})),setTimeout(()=>{J.length>0?V(J):H()},10)},500)):B.type==="draw"?(h(ee=>({...ee,animationState:{type:"draw",player:B.player,count:B.count}})),setTimeout(()=>{h(ee=>({...ee,animationState:null})),setTimeout(()=>{J.length>0?V(J):H()},10)},500)):setTimeout(()=>{J.length>0?V(J):H()},10)};V(z)},[]),U=(z,H)=>{if(!p||m.turn!=="player"||m.phase!=="action")return;const V=p;y(null),h(Y=>{const B=_(Y.phase),{newState:J,animationRequests:ee}=kc(Y,V,z,H,"player"),he={...J,animationState:{type:"playCard",cardId:V,owner:"player"}};return setTimeout(()=>{h(ye=>{let me={...ye,animationState:null};return ee&&ee.length>0?(w(ee,()=>{h(xe=>B(xe))}),me):me.actionRequired?me:B(me)})},500),he})},C=()=>{m.turn!=="player"||m.phase!=="action"||m.actionRequired||h(z=>{const H=_(z.phase),V=Ih(z,"player");return V.actionRequired?V:H(V)})},A=ce.useCallback(z=>{h(H=>{var V;return((V=H.actionRequired)==null?void 0:V.type)!=="discard"||H.actionRequired.actor!=="player"?H:{...H,animationState:{type:"discardCard",owner:"player",cardIds:[z],originalAction:H.actionRequired}}})},[]),S=ce.useCallback(z=>{h(H=>{if(H.winner||H.phase!=="compile")return H;const V=_(H.phase),B={...Ph(H),animationState:{type:"compile",laneIndex:z},compilableLanes:[]};return setTimeout(()=>{h(J=>{var me;const ee=sr(J,z,r);if(ee.winner)return ee;if(((me=ee.actionRequired)==null?void 0:me.type)==="prompt_use_control_mechanic")return{...ee,animationState:null};const he=ee._compileAnimations;if(he&&he.length>0){w(he,()=>{h(Ee=>{const Ue={...Ee};return delete Ue._compileAnimations,{...V(Ue),animationState:null}})});const xe={...ee};return delete xe._compileAnimations,xe}return{...V(ee),animationState:null}})},1e3),B})},[r,_]),N=z=>{h(H=>{const V=H.turn,Y=_(H.phase),{nextState:B,requiresAnimation:J,requiresTurnEnd:ee}=rd(H,z);return J?(w(J.animationRequests,()=>{h(he=>{const ye=he.turn!==V?me=>me:Y;return J.onCompleteCallback(he,ye)})}),B):B.actionRequired?B:Y(B)})},q=z=>{h(H=>{const V=_(H.phase),{nextState:Y,requiresAnimation:B}=cd(H,z);return B?(w(B.animationRequests,()=>{h(J=>B.onCompleteCallback(J,V))}),Y):Y.actionRequired?Y:V(Y)})},D=z=>{h(H=>{const V=_(H.phase),Y=td(H,z);return Y.actionRequired?Y:V(Y)})},E=z=>{h(H=>g_(H,z))},j=()=>{h(z=>{var Y,B;const H=_(z.phase);let V={...z,animationState:null};return((Y=V.actionRequired)==null?void 0:Y.type)==="prompt_shift_or_flip_board_card_custom"?V=id(V,"skip"):V=ph(V),((B=V.actionRequired)==null?void 0:B.type)==="plague_4_player_flip_optional"?V:H(V)})},I=ce.useCallback(z=>{h(H=>{var B;if(((B=H.actionRequired)==null?void 0:B.type)!=="prompt_use_control_mechanic")return H;const{originalAction:V,actor:Y}=H.actionRequired;if(z==="skip"){let J=re(H,Y,"Player skips rearranging protocols.");if(J.actionRequired=null,J={...J,_logIndentLevel:0},V.type==="compile"){const he={...J,animationState:{type:"compile",laneIndex:V.laneIndex},compilableLanes:[]};return setTimeout(()=>{h(ye=>{const me=sr(ye,V.laneIndex,r);return me.winner?me:{..._(me.phase)(me),animationState:null}})},1e3),he}else if(V.type==="continue_turn"){let ee={...J};return V.queuedSpeed2Actions&&V.queuedSpeed2Actions.length>0&&(ee.queuedActions=[...V.queuedSpeed2Actions,...ee.queuedActions||[]]),_(ee.phase)(ee)}else if(V.type==="resume_interrupted_turn"){let ee={...J};return ee._interruptedTurn=V.interruptedTurn,ee._interruptedPhase=V.interruptedPhase,V.queuedSpeed2Actions&&V.queuedSpeed2Actions.length>0&&(ee.queuedActions=[...V.queuedSpeed2Actions,...ee.queuedActions||[]]),dr(ee)}else{const ee=fr(J,Y);return _(ee.phase)(ee)}}else{const J=z;let ye=re(H,Y,`${Y==="player"?"Player":"Opponent"} chooses to rearrange ${J==="player"?"their own":"the opponent's"} protocols.`);return ye.actionRequired={type:"prompt_rearrange_protocols",sourceCardId:"CONTROL_MECHANIC",target:J,actor:Y,originalAction:V},ye}})},[r,_]),k=ce.useCallback(z=>{h(H=>{const V=_(H.phase),Y=yh(H,z);return Y.actionRequired?Y:V(Y)})},[_]),L=ce.useCallback(z=>{h(H=>{var V;return((V=H.actionRequired)==null?void 0:V.type)!=="plague_2_player_discard"?H:{...H,animationState:{type:"discardCard",owner:"player",cardIds:z,originalAction:H.actionRequired}}})},[]),G=ce.useCallback(z=>{h(H=>{const V=_(H.phase),Y=vh(H,z,"player");return V(Y)})},[_]),T=ce.useCallback(z=>{h(H=>{const V=_(H.phase),Y=_h(H,z);return z?Y:V(Y)})},[_]),Q=ce.useCallback(z=>{h(H=>{const V=_(H.phase),Y=xh(H,z);return Y.actionRequired?Y:V(Y)})},[_]),X=ce.useCallback(z=>{h(H=>{var B,J,ee;const V=((B=H.actionRequired)==null?void 0:B.type)==="select_cards_from_hand_to_discard_for_fire_4",Y=((J=H.actionRequired)==null?void 0:J.type)==="discard"&&((ee=H.actionRequired)==null?void 0:ee.variableCount);return!V&&!Y?H:{...H,animationState:{type:"discardCard",owner:"player",cardIds:z,originalAction:H.actionRequired}}})},[]),M=ce.useCallback(z=>{h(H=>{var V;return((V=H.actionRequired)==null?void 0:V.type)!=="select_cards_from_hand_to_discard_for_hate_1"?H:{...H,animationState:{type:"discardCard",owner:"player",cardIds:z,originalAction:H.actionRequired}}})},[]),$=ce.useCallback(z=>{h(H=>{const V=_(H.phase),Y=id(H,z);return Y.actionRequired?Y:V(Y)})},[_]),W=ce.useCallback(z=>{h(H=>{var J,ee;f&&((J=H.actionRequired)==null?void 0:J.sourceCardId)==="CONTROL_MECHANIC"&&((ee=H.actionRequired)!=null&&ee.actor)&&f(H.actionRequired.actor);const V=_(H.phase);console.log("[DEBUG useGameState resolveRearrangeProtocols] Before resolvers.resolveRearrangeProtocols, hand:",H.opponent.hand.length);const Y=ed(H,z,r);if(console.log("[DEBUG useGameState resolveRearrangeProtocols] After resolvers.resolveRearrangeProtocols, hand:",Y.opponent.hand.length),Y.winner)return Y;const B=V(Y);return console.log("[DEBUG useGameState resolveRearrangeProtocols] After turnProgressionCb, hand:",B.opponent.hand.length),B})},[_,r,f]),P=ce.useCallback(z=>{h(H=>{const V=_(H.phase),Y=Ch(H,z);return Y.actionRequired?Y:V(Y)})},[_]),ne=ce.useCallback(z=>{h(H=>{const V=_(H.phase),Y=wh(H,z,r);return Y.winner?Y:V(Y)})},[_,r]),F=ce.useCallback(z=>{v.current=!1,x.current++,h(H=>{if(typeof z=="function")return z(H);const V=z;if(V==="speed-0-interrupt"){const Y=["Speed","Life","Water"],B=["Metal","Death","Hate"];let J=Ln(io(Y)),ee=Ln(io(B));const he=(Me,tt,Pt)=>{const Qt=Me.findIndex(Te=>Te.protocol===tt&&Te.value===Pt);return Qt>-1?Me.splice(Qt,1)[0]:vn.find(Te=>Te.protocol===tt&&Te.value===Pt)},ye=he(J,"Speed",0),me=he(ee,"Metal",0),xe=he(J,"Speed",1),Ee=he(J,"Life",1),Ue=he(J,"Water",1),Xe=he(J,"Speed",3);let Se=lr(Y,B,i,d);return Se.player.lanes=[[],[],[]],Se.player.lanes[0]=[{...ye,id:Ge(),isFaceUp:!1}],Se.player.hand=[{...xe,id:Ge(),isFaceUp:!0},{...Ee,id:Ge(),isFaceUp:!0},{...Ue,id:Ge(),isFaceUp:!0},{...Xe,id:Ge(),isFaceUp:!0}],Se.player.deck=J,Se.player.discard=[],Se.opponent.lanes=[[],[],[]],Se.opponent.hand=[{...me,id:Ge(),isFaceUp:!0}],Se.opponent.deck=ee,Se.opponent.discard=[],Se.turn="opponent",Se.phase="start",Se.actionRequired=null,Se.queuedActions=[],Se=_e(Se),Se=re(Se,"player","DEBUG: Dynamic Speed-0 interrupt scenario set up. AI will play Metal-0."),Se}else if(V==="speed-1-trigger"){const Y=["Speed","Life","Water"],B=["Metal","Death","Hate"];let J=Ln(io(Y));const ee=Ln(io(B)),ye=((Ue,Xe,Se)=>{const Me=Ue.findIndex(tt=>tt.protocol===Xe&&tt.value===Se);return Me>-1?Ue.splice(Me,1)[0]:vn.find(tt=>tt.protocol===Xe&&tt.value===Se)})(J,"Speed",1);let me=lr(Y,B,i,d);me.player.lanes=[[],[],[]],me.player.lanes[0]=[{...ye,id:Ge(),isFaceUp:!0}];const{drawnCards:xe,remainingDeck:Ee}=Tn(J,[],6);return me.player.hand=xe.map(Ue=>({...Ue,id:Ge(),isFaceUp:!0})),me.player.deck=Ee,me.player.discard=[],me.opponent.lanes=[[],[],[]],me.opponent.hand=[],me.opponent.deck=ee,me.opponent.discard=[],me.turn="player",me.phase="hand_limit",me.actionRequired={type:"discard",actor:"player",count:1},me.queuedActions=[],me=_e(me),me=re(me,"player","DEBUG: Speed-1 discard trigger scenario set up."),me}else if(V==="fire-oncover-test"){const Y=["Death","Hate","Water"],B=["Fire","Plague","Metal"],J=Ln(io(Y));let ee=Ln(io(B));const he=(Me,tt,Pt)=>{const Qt=Me.findIndex(Te=>Te.protocol===tt&&Te.value===Pt);return Qt>-1?Me.splice(Qt,1)[0]:vn.find(Te=>Te.protocol===tt&&Te.value===Pt)},ye=he(ee,"Fire",0),me=he(ee,"Fire",2),xe=he(ee,"Fire",3),Ee=vn.find(Me=>Me.protocol==="Death"&&Me.value===1),Ue=vn.find(Me=>Me.protocol==="Hate"&&Me.value===2),Xe=vn.find(Me=>Me.protocol==="Water"&&Me.value===3);let Se=lr(Y,B,i,"opponent");return Se.player.lanes=[[{...Ee,id:Ge(),isFaceUp:!0}],[{...Ue,id:Ge(),isFaceUp:!0}],[{...Xe,id:Ge(),isFaceUp:!0}]],Se.player.hand=[],Se.player.deck=J,Se.player.discard=[],Se.opponent.lanes=[[{...ye,id:Ge(),isFaceUp:!0}],[],[]],Se.opponent.hand=[{...xe,id:Ge(),isFaceUp:!0},{...me,id:Ge(),isFaceUp:!0}],Se.opponent.deck=ee,Se.opponent.discard=[],Se.turn="opponent",Se.phase="action",Se.actionRequired=null,Se.queuedActions=[],Se=_e(Se),Se=re(Se,"opponent","DEBUG: Fire On-Cover test scenario. Opponent has Fire-0 in play, Fire-3 and Fire-2 in hand. Ready to play Fire-3."),Se}else if(V==="speed-2-control-test"){const Y=["Speed","Light","Water"],B=["Fire","Plague","Metal"],J=Ln(io(Y)),ee=Ln(io(B)),ye=((xe,Ee,Ue)=>{const Xe=xe.findIndex(Se=>Se.protocol===Ee&&Se.value===Ue);return Xe>-1?xe.splice(Xe,1)[0]:vn.find(Se=>Se.protocol===Ee&&Se.value===Ue)})(J,"Speed",2);let me=lr(Y,B,!0,"player");return me.player.lanes=[[{...ye,id:Ge(),isFaceUp:!0}],[],[]],me.player.protocols[0]="Speed",me.player.laneValues[0]=10,me.player.hand=[],me.player.deck=J,me.player.discard=[],me.controlCardHolder="player",me.opponent.lanes=[[],[],[]],me.opponent.hand=[],me.opponent.deck=ee,me.opponent.discard=[],me.turn="player",me.phase="compile",me.compilableLanes=[0],me.actionRequired=null,me.queuedActions=[],me=_e(me),me=re(me,"player","DEBUG: Speed-2 + Control test scenario. Player has Speed-2 (value 10), Control Component active. Ready to compile Protocol Speed!"),me}return H})},[i]);return ce.useEffect(()=>{const z=m.animationState;if(!z)return;let H=0,V=!1;if(z.type==="flipCard"?(H=600,V=!0):z.type==="drawCard"?(H=1e3,V=!0):z.type==="discardCard"&&(H=800,V=!0),V){const Y=setTimeout(()=>{h(B=>({...B,animationState:null}))},H);return()=>clearTimeout(Y)}},[m.animationState]),ce.useEffect(()=>{const z=m.animationState;if((z==null?void 0:z.type)==="discardCard"&&z.owner==="player"){const H=setTimeout(()=>{h(V=>{const Y=V.animationState;if((Y==null?void 0:Y.type)!=="discardCard"||!Y.originalAction)return V;const{cardIds:B,originalAction:J}=Y,ee=_(V.phase);let he;return J.type==="plague_2_player_discard"?he=m_(V,B):J.type==="select_cards_from_hand_to_discard_for_fire_4"?he=fh(V,B):J.type==="select_cards_from_hand_to_discard_for_hate_1"?he=Js(V,B):he=pa(V,B,"player"),he.animationState=null,he.actionRequired?he:ee(he)})},500);return()=>clearTimeout(H)}},[m.animationState,_]),ce.useEffect(()=>{if(m.turn==="opponent"&&!m.winner&&!m.animationState&&!m._interruptedTurn&&!v.current){v.current=!0;const z=x.current,H=m,V=setTimeout(()=>{x.current===z&&cn(H,h,s,{compileLane:(Y,B)=>sr(Y,B,r),playCard:kc,fillHand:fr,discardCards:pa,flipCard:mh,deleteCard:(Y,B)=>({newState:Y,animationRequests:[{type:"delete",cardId:B,owner:"opponent"}]}),returnCard:gh,skipAction:ph,resolveOptionalDrawPrompt:yh,resolvePlague4Flip:(Y,B)=>vh(Y,B,"opponent"),resolvePlague2Discard:Ks,resolvePlague2OpponentDiscard:Ks,resolveOptionalDiscardCustomPrompt:_h,resolveOptionalEffectPrompt:xh,resolveFire4Discard:fh,resolveHate1Discard:Js,resolveRearrangeProtocols:(Y,B)=>ed(Y,B,r),resolveActionWithHandCard:td,resolveSwapProtocols:(Y,B)=>wh(Y,B,r),revealOpponentHand:hh,resolveCustomChoice:Ch},w,ch,f)},1500);return()=>{clearTimeout(V),v.current=!1}}},[m.turn,m.phase,m.winner,m.animationState,m._interruptedTurn,s,r,w,m.actionRequired]),ce.useEffect(()=>{const z=m.actionRequired,H=m.turn==="player"||m._interruptedTurn==="player",V=z&&"actor"in z&&z.actor==="opponent";H&&!m.animationState&&V&&!v.current&&(v.current=!0,E_(m,h,s,{playCard:kc,discardCards:pa,flipCard:mh,returnCard:gh,deleteCard:(B,J)=>({newState:B,animationRequests:[{type:"delete",cardId:J,owner:"opponent"}]}),resolveActionWithHandCard:td,resolveHate1Discard:Js,resolvePlague2OpponentDiscard:Ks,revealOpponentHand:hh,resolveRearrangeProtocols:(B,J)=>ed(B,J,r)},ch,w,rd,cd,f),v.current=!1)},[m.actionRequired,m.turn,m.animationState,s,w,r]),ce.useEffect(()=>{h(z=>z.turn==="player"&&z.phase==="start"&&!z.actionRequired?$h(z):z)},[m.turn,m.phase]),{gameState:m,selectedCard:p,setSelectedCard:y,playSelectedCard:U,fillHand:C,discardCardFromHand:A,compileLane:S,resolveActionWithCard:N,resolveActionWithLane:q,selectHandCardForAction:E,skipAction:j,resolvePlague2Discard:L,resolveActionWithHandCard:D,resolvePlague4Flip:G,resolveOptionalDiscardCustomPrompt:T,resolveOptionalEffectPrompt:Q,resolveFire4Discard:X,resolveHate1Discard:M,resolveRevealBoardCardPrompt:$,resolveRearrangeProtocols:W,resolveOptionalDrawPrompt:k,resolveSwapProtocols:ne,resolveControlMechanicPrompt:I,resolveCustomChoice:P,setupTestScenario:F}},jh=({cards:o,isPlayable:n,isCompilable:r,isShiftTarget:s,isEffectTarget:i,isMatching:d,onLanePointerDown:f,onPlayFaceDown:m,onCardPointerDown:h,onCardPointerEnter:p,onCardPointerLeave:y,owner:v,animationState:x,isCardTargetable:_,laneIndex:w,sourceCardId:U,gameState:C})=>{const A=["lane"];return n&&A.push("playable"),d&&A.push("matching-protocol"),r&&A.push("compilable"),s&&A.push("shift-target"),i&&A.push("effect-target"),l.jsxs("div",{className:A.join(" "),onPointerDown:f,children:[n&&d&&v==="player"&&m&&l.jsx("button",{className:"btn btn-play-facedown",onPointerDown:S=>{S.stopPropagation(),m()},children:"Play Face-Down"}),l.jsx("div",{className:"lane-stack",children:o.map((S,N)=>{var E;const q=((E=C.actionRequired)==null?void 0:E.type)==="prompt_shift_or_flip_for_light_2"&&C.actionRequired.revealedCardId===S.id,D=Mn(S,o,C,w,v);return l.jsx(Rt,{card:S,isFaceUp:S.isFaceUp||q,style:{"--i":N},onPointerDown:j=>{j.stopPropagation(),h(S)},onPointerEnter:()=>p(S),animationState:x,isTargetable:_(S),isSourceOfEffect:S.id===U,faceDownValue:D},S.id)})})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Dn=(o,n)=>Nn(o).some(({rule:s,laneIndex:i})=>s.type==="block_shifts_from_and_to_lane"&&i===n),Uc=(o,n)=>{var m;const{actionRequired:r}=n;if(!r||"actor"in r&&r.actor!=="player")return!1;let s=null,i=-1,d=[];for(const h of["player","opponent"]){for(let p=0;p<n[h].lanes.length;p++)if(n[h].lanes[p].some(y=>y.id===o.id)){s=h,i=p,d=n[h].lanes[p];break}if(s)break}if(!s)return!1;const f=o.id===((m=d[d.length-1])==null?void 0:m.id);if(r.type==="select_lane_for_shift"){const h=r.cardToShiftId;return!!(h&&o.id===h)}if(r.type==="shift_flipped_card_optional"){const h=r.cardId;return!!(h&&o.id===h)}switch(r.type){case"select_opponent_face_up_card_to_flip":return s==="opponent"&&o.isFaceUp&&f;case"select_card_to_flip":{const h=r.targetFilter||{},p=d.findIndex(w=>w.id===o.id),y=r.currentLaneIndex,v=r.laneIndex,x=r.scope;if(y!==void 0&&i!==y||x==="this_lane"&&v!==void 0&&i!==v)return!1;const _=h.position||"uncovered";return!(_==="uncovered"&&!f||_==="covered"&&p>=d.length-1||h.owner==="own"&&s!==r.actor||h.owner==="opponent"&&s===r.actor||h.faceState==="face_up"&&!o.isFaceUp||h.faceState==="face_down"&&o.isFaceUp||h.excludeSelf&&o.id===r.sourceCardId)}case"select_own_face_up_covered_card_to_flip":{const h=d.findIndex(p=>p.id===o.id);return s==="player"&&o.isFaceUp&&h<d.length-1}case"select_opponent_covered_card_to_shift":{const h=d.findIndex(y=>y.id===o.id),p=n.turn==="player"?"opponent":"player";return Dn(n,i)?!1:s===p&&h<d.length-1}case"select_own_covered_card_to_shift":{const h=d.findIndex(p=>p.id===o.id);return Dn(n,i)?!1:s===r.actor&&h<d.length-1}case"select_covered_card_in_line_to_flip_optional":{const p=d.findIndex(v=>v.id===o.id)<d.length-1;return Yn(n)&&!o.isFaceUp?!1:i===r.laneIndex&&p}case"select_covered_card_to_flip_for_chaos_0":{const p=d.findIndex(v=>v.id===o.id)<d.length-1;return Yn(n)&&!o.isFaceUp?!1:i===r.laneIndex&&p}case"shift_flipped_card_optional":return Dn(n,i)?!1:o.id===r.cardId;case"select_opponent_card_to_flip":return Yn(n)&&!o.isFaceUp?!1:s==="opponent"&&f;case"select_face_down_card_to_shift_for_darkness_4":return Dn(n,i)?!1:!o.isFaceUp&&f;case"select_cards_to_delete":{if(r.disallowedIds.includes(o.id))return!1;const h=r.allowedIds;if(h&&!h.includes(o.id))return!1;const p=r.currentLaneIndex;if(p!==void 0&&i!==p)return!1;const y=r.targetFilter;if(y){const v=d.findIndex(A=>A.id===o.id),x=y.position||"uncovered";if(x==="uncovered"&&!f||x==="covered"&&v>=d.length-1||y.faceState==="face_up"&&!o.isFaceUp||y.faceState==="face_down"&&o.isFaceUp)return!1;if(y.valueRange){const{min:A,max:S}=y.valueRange;if(o.value<A||o.value>S)return!1}const _=r.actorChooses,w=r.sourceCardId;let U=null;for(const A of["player","opponent"])if(n[A].lanes.flat().some(S=>S.id===w)){U=A;break}if(_==="card_owner"&&U){if(y.owner==="own"&&s!==U||y.owner==="opponent"&&s===U)return!1}else if(y.owner==="own"&&s!==r.actor||y.owner==="opponent"&&s===r.actor)return!1;const C=r.protocolMatching;if(C){const A=n.player.protocols[i],S=n.opponent.protocols[i],N=o.protocol,q=N===A||N===S;if(C==="must_match"&&!q||C==="must_not_match"&&q)return!1}return!0}return f}case"select_face_down_card_to_delete":return!o.isFaceUp&&f;case"select_low_value_card_to_delete":return o.isFaceUp&&(o.value===0||o.value===1)&&f;case"select_card_from_other_lanes_to_delete":{const{disallowedLaneIndex:h,lanesSelected:p}=r;return i!==h&&!p.includes(i)&&f}case"plague_4_opponent_delete":return(n.turn==="player"?"opponent":"player")==="player"?s==="player"&&!o.isFaceUp&&f:!1;case"select_any_other_card_to_flip":return Yn(n)&&!o.isFaceUp?!1:o.id!==r.sourceCardId&&f;case"select_card_to_return":{const h=r.targetOwner||"any",p=r.targetFilter,y=r.actor,v=(p==null?void 0:p.position)||"uncovered",_=d.findIndex(w=>w.id===o.id)<d.length-1;return v==="uncovered"&&!f||v==="covered"&&!_?!1:h==="own"?s===y:h==="opponent"?s!==y:!0}case"select_card_to_shift_for_gravity_1":return Dn(n,i)?!1:f;case"select_face_down_card_to_shift_for_gravity_4":return Dn(n,i)?!1:!o.isFaceUp&&i!==r.targetLaneIndex&&f;case"select_any_card_to_flip":case"select_any_card_to_flip_optional":return Yn(n)&&!o.isFaceUp?!1:f;case"select_any_face_down_card_to_flip_optional":return!o.isFaceUp&&f;case"select_board_card_to_reveal_custom":{const h=r.targetFilter;if(!h)return!o.isFaceUp&&f;const p=d.findIndex(v=>v.id===o.id),y=h.position||"uncovered";return!(y==="uncovered"&&!f||y==="covered"&&p>=d.length-1||h.owner==="own"&&s!==r.actor||h.owner==="opponent"&&s===r.actor||h.faceState==="face_up"&&!o.isFaceUp||h.faceState==="face_down"&&o.isFaceUp)}case"select_own_other_card_to_shift":return Dn(n,i)?!1:s===r.actor&&o.id!==r.sourceCardId&&f;case"select_opponent_face_down_card_to_shift":return Dn(n,i)?!1:s!==r.actor&&!o.isFaceUp&&f;case"select_any_opponent_card_to_shift":return Dn(n,i)?!1:s!==r.actor&&f;case"select_opponent_card_to_return":return s==="opponent"&&f;case"select_card_to_shift_for_anarchy_1":return Dn(n,i)?!1:f;case"select_card_to_shift_for_anarchy_0":return Dn(n,i)?!1:f;case"select_card_to_shift":{if(Dn(n,i))return!1;const h=r.targetFilter||{},p=r.destinationRestriction;if((p==null?void 0:p.type)==="non_matching_protocol"&&!o.isFaceUp)return!1;const y=h.position||"uncovered",x=d.findIndex(_=>_.id===o.id)<d.length-1;return!(y==="uncovered"&&!f||y==="covered"&&!x||h.owner==="own"&&s!==r.actor||h.owner==="opponent"&&s===r.actor||h.faceState==="face_up"&&!o.isFaceUp||h.faceState==="face_down"&&o.isFaceUp||h.excludeSelf&&o.id===r.sourceCardId)}default:return!1}},D_=({gameState:o,onLanePointerDown:n,onPlayFaceDown:r,onCardPointerDown:s,onCardPointerEnter:i,onCardPointerLeave:d,onOpponentHandCardPointerEnter:f,onOpponentHandCardPointerLeave:m,selectedCardId:h,sourceCardId:p})=>{const{player:y,opponent:v,animationState:x,phase:_,turn:w,compilableLanes:U,actionRequired:C,controlCardHolder:A}=o,S=k=>{const L=_==="compile"&&w==="player"&&!C&&U.includes(k),G=w==="player",T=_==="action"&&!C&&h,Q=(C==null?void 0:C.type)==="select_lane_for_play";if(!(Q?(C==null?void 0:C.actor)==="player":G)||!T&&!Q)return{isPlayable:!1,isMatching:!1,isCompilable:L};let M;if(T)M=y.hand.find(J=>J.id===h);else if(Q){if(C.disallowedLaneIndex!==void 0&&k===C.disallowedLaneIndex)return{isPlayable:!1,isMatching:!1,isCompilable:L};if(C.source==="deck")return C.excludeCurrentLane&&k===C.currentLaneIndex?{isPlayable:!1,isMatching:!1,isCompilable:L}:{isPlayable:!0,isMatching:!1,isCompilable:L};M=y.hand.find(J=>J.id===C.cardInHandId)}if(!M)return{isPlayable:!1,isMatching:!1,isCompilable:L};const $=v.lanes[k];if($.length>0&&$[$.length-1].isFaceUp&&$[$.length-1].protocol==="Plague"&&$[$.length-1].value===0)return{isPlayable:!1,isMatching:!1,isCompilable:L};const P=v.lanes.flat().some(J=>J.isFaceUp&&J.protocol==="Psychic"&&J.value===1),ne=y.lanes.flat().some(J=>J.isFaceUp&&J.protocol==="Spirit"&&J.value===1),F=y.lanes.some(J=>{if(J.length===0)return!1;const ee=J[J.length-1];return ee.isFaceUp&&ee.protocol==="Chaos"&&ee.value===3}),z=[...y.lanes.flat(),...v.lanes.flat()].some(J=>J.isFaceUp&&J.protocol==="Anarchy"&&J.value===1),H=Oc(o),V=Lc(o,"player",k);let Y;return z||H?Y=M.protocol!==y.protocols[k]&&M.protocol!==v.protocols[k]&&!P:Y=(ne||V||F||M.protocol===y.protocols[k]||M.protocol===v.protocols[k])&&!P,$.some(J=>J.isFaceUp&&J.protocol==="Metal"&&J.value===2)&&!Y?{isPlayable:!1,isMatching:!1,isCompilable:L}:Q&&(C.isFaceDown||C.faceDown)?{isPlayable:!0,isMatching:!1,isCompilable:L}:{isPlayable:!0,isMatching:Y,isCompilable:L}},N=k=>{if(!C||C.actor!=="player")return!1;switch(C.type){case"select_lane_for_delete":case"select_lane_for_death_2":case"select_lane_for_water_3":case"select_lane_for_return":return!0;case"select_lane_for_metal_3_delete":return k===C.disallowedLaneIndex?!1:y.lanes[k].length+v.lanes[k].length>=8;case"select_lane_for_delete_all":return(C.validLanes||[]).includes(k);default:return!1}},q=(k,L)=>{if(!C||C.actor!=="player")return!1;const G=C.type==="select_lane_for_shift"?C.originalLaneIndex:(C.type==="select_card_to_shift",-1);if(G!==-1&&!Nc(o,G,k).allowed)return!1;switch(C.type){case"select_lane_for_shift":{if(L!==C.cardOwner||k===C.originalLaneIndex)return!1;const T=[...o.player.lanes.flat(),...o.opponent.lanes.flat()].find(X=>X.id===C.sourceCardId),Q=C.destinationRestriction;if(Q&&Q.type==="to_or_from_this_lane"){let X=Q.laneIndex;if(Q.laneIndex==="current"&&T)for(const M of["player","opponent"]){for(let $=0;$<o[M].lanes.length;$++)if(o[M].lanes[$].some(W=>W.id===C.sourceCardId)){X=$;break}if(typeof X=="number")break}if(typeof X=="number"&&!(C.originalLaneIndex===X)&&!(k===X))return!1}else if(T&&T.protocol==="Gravity"&&T.value===1){let X=-1;for(const M of["player","opponent"]){for(let $=0;$<o[M].lanes.length;$++)if(o[M].lanes[$].some(W=>W.id===C.sourceCardId)){X=$;break}if(X!==-1)break}if(X!==-1&&!(C.originalLaneIndex===X)&&!(k===X))return!1}return!0}case"shift_flipped_card_optional":{const T=C.cardId;let Q=null,X=-1;for(let M=0;M<y.lanes.length;M++)if(y.lanes[M].some($=>$.id===T)){Q="player",X=M;break}if(Q===null){for(let M=0;M<v.lanes.length;M++)if(v.lanes[M].some($=>$.id===T)){Q="opponent",X=M;break}}return L!==Q?!1:k!==X}case"select_lane_for_life_3_play":return L==="player"&&k!==C.disallowedLaneIndex;case"select_lane_to_shift_revealed_card_for_light_2":return L==="player";case"select_lane_to_shift_revealed_board_card_custom":{const T=C.revealedCardId;if(![...o.player.lanes.flat(),...o.opponent.lanes.flat()].find($=>$.id===T))return!1;let X=null,M=-1;for(const $ of["player","opponent"]){for(let W=0;W<o[$].lanes.length;W++)if(o[$].lanes[W].some(P=>P.id===T)){X=$,M=W;break}if(X)break}return L===X&&k!==M}case"select_lane_for_shift_all":{const T=C.sourceLaneIndex;return k!==T}case"select_lane_to_shift_cards_for_light_3":return k!==C.sourceLaneIndex;default:return!1}},D=(k,L,G)=>{let T=[k];return L&&T.push("compiled"),(x==null?void 0:x.type)==="compile"&&x.laneIndex===G&&T.push("is-compiling"),T.join(" ")},E=()=>A==="player"?"player-controlled":A==="opponent"?"opponent-controlled":"neutral",j=()=>A==="player"?"Player has control.":A==="opponent"?"Opponent has control.":"Control is neutral.",I=()=>A==="player"?"Control Player":A==="opponent"?"Control Opponent":"Control Neutral";return l.jsxs("div",{className:"game-board",children:[l.jsx("div",{className:"opponent-hand-area",children:v.hand.map(k=>l.jsx(Rt,{card:k,isFaceUp:k.isRevealed||!1,additionalClassName:"in-hand",onPointerEnter:()=>f(k)},k.id))}),l.jsx("div",{className:`player-side opponent-side ${w==="opponent"?"active-turn":""}`,children:l.jsx("div",{className:"lanes",children:v.lanes.map((k,L)=>l.jsx(jh,{cards:k,isPlayable:!1,isCompilable:!1,isShiftTarget:q(L,"opponent"),isEffectTarget:N(L),onLanePointerDown:()=>n(L),onCardPointerDown:G=>s(G,"opponent",L),onCardPointerEnter:G=>i(G,"opponent"),onCardPointerLeave:()=>d(),owner:"opponent",animationState:x,isCardTargetable:G=>Uc(G,o),laneIndex:L,sourceCardId:p,gameState:o},`opp-lane-${L}`))})}),l.jsxs("div",{className:"protocol-bars-container",children:[o.useControlMechanic&&l.jsxs("div",{className:"control-coin-container",children:[l.jsx("div",{className:`control-coin ${E()}`,title:j(),children:"C"}),l.jsx("div",{className:`control-coin-label ${E()}`,children:I()})]}),l.jsx("div",{className:`protocol-bar opponent-bar ${w==="opponent"?"active-turn":""}`,children:v.protocols.map((k,L)=>l.jsxs("div",{className:D("protocol-display",v.compiled[L],L),children:[l.jsx("span",{className:"protocol-name",children:k}),l.jsx("span",{className:"protocol-value",children:v.laneValues[L]})]},`opp-proto-${k}-${L}`))}),l.jsx("div",{className:`protocol-bar player-bar ${w==="player"?"active-turn":""}`,children:y.protocols.map((k,L)=>l.jsxs("div",{className:D("protocol-display",y.compiled[L],L),children:[l.jsx("span",{className:"protocol-name",children:k}),l.jsx("span",{className:"protocol-value",children:y.laneValues[L]})]},`player-proto-${k}-${L}`))})]}),l.jsx("div",{className:`player-side ${w==="player"?"active-turn":""}`,children:l.jsx("div",{className:"lanes",children:y.lanes.map((k,L)=>{const{isPlayable:G,isMatching:T,isCompilable:Q}=S(L);return l.jsx(jh,{cards:k,isPlayable:G,isMatching:T,isCompilable:Q,isShiftTarget:q(L,"player"),isEffectTarget:N(L),onLanePointerDown:()=>n(L),onPlayFaceDown:()=>r(L),onCardPointerDown:X=>s(X,"player",L),onCardPointerEnter:X=>i(X,"player"),onCardPointerLeave:()=>d(),owner:"player",animationState:x,isCardTargetable:X=>Uc(X,o),laneIndex:L,sourceCardId:p,gameState:o},`player-lane-${L}`)})})})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const T_=({gameState:o,onFillHand:n,onSkipAction:r,onResolvePlague2Discard:s,onResolvePlague4Flip:i,onResolveFire3Prompt:d,onResolveOptionalDiscardCustomPrompt:f,onResolveOptionalEffectPrompt:m,onResolveFire4Discard:h,onResolveHate1Discard:p,onResolveRevealBoardCardPrompt:y,onResolveOptionalDrawPrompt:v,onResolveDeath1Prompt:x,onResolveLove1Prompt:_,onResolvePsychic4Prompt:w,onResolveSpirit1Prompt:U,onResolveControlMechanicPrompt:C,onResolveCustomChoice:A,selectedCardId:S,multiSelectedCardIds:N,actionRequiredClass:q})=>{const{phase:D,turn:E,actionRequired:j,player:I,compilableLanes:k}=o,L=W=>{for(const P of["player","opponent"])for(const ne of o[P].lanes){const F=ne.find(z=>z.id===W);if(F)return F}return null},G=j==null?void 0:j.sourceCardId,T=G?L(G):null,Q=(j==null?void 0:j.actor)||E,X=Q.charAt(0).toUpperCase()+Q.slice(1),M=()=>{var W,P,ne,F;if(E!=="player"&&(!j||j.actor!=="player"))return l.jsx("button",{className:"btn",disabled:!0,children:"Processing..."});if((j==null?void 0:j.type)==="prompt_use_control_mechanic")return l.jsxs(l.Fragment,{children:[l.jsx("button",{className:"btn",onClick:()=>C("player"),children:"Rearrange Own"}),l.jsx("button",{className:"btn",onClick:()=>C("opponent"),children:"Rearrange Opponent's"}),l.jsx("button",{className:"btn btn-back",onClick:()=>C("skip"),children:"Skip"})]});if((j==null?void 0:j.type)==="prompt_optional_draw")return l.jsxs(l.Fragment,{children:[l.jsx("button",{className:"btn",onClick:()=>v(!0),children:"Draw"}),l.jsx("button",{className:"btn btn-back",onClick:()=>v(!1),children:"Skip"})]});if((j==null?void 0:j.type)==="prompt_death_1_effect")return l.jsxs(l.Fragment,{children:[l.jsx("button",{className:"btn",onClick:()=>x(!0),children:"Draw & Delete"}),l.jsx("button",{className:"btn btn-back",onClick:()=>x(!1),children:"Skip"})]});if((j==null?void 0:j.type)==="prompt_give_card_for_love_1")return l.jsxs(l.Fragment,{children:[l.jsx("button",{className:"btn",onClick:()=>_(!0),children:"Give 1 Card"}),l.jsx("button",{className:"btn btn-back",onClick:()=>_(!1),children:"Skip"})]});if((j==null?void 0:j.type)==="prompt_fire_3_discard")return l.jsxs(l.Fragment,{children:[l.jsx("button",{className:"btn",onClick:()=>d(!0),children:"Discard 1 Card"}),l.jsx("button",{className:"btn btn-back",onClick:()=>d(!1),children:"Skip"})]});if((j==null?void 0:j.type)==="prompt_optional_discard_custom")return l.jsxs(l.Fragment,{children:[l.jsxs("button",{className:"btn",onClick:()=>f(!0),children:["Discard ",j.count," Card(s)"]}),l.jsx("button",{className:"btn btn-back",onClick:()=>f(!1),children:"Skip"})]});if((j==null?void 0:j.type)==="prompt_optional_effect"){const z=((P=(W=j.effectDef)==null?void 0:W.params)==null?void 0:P.action)||"effect",H=(F=(ne=j.effectDef)==null?void 0:ne.params)==null?void 0:F.count,V=H?`${z} ${H}`:z;return l.jsxs(l.Fragment,{children:[l.jsxs("button",{className:"btn",onClick:()=>m(!0),children:["Execute (",V,")"]}),l.jsx("button",{className:"btn btn-back",onClick:()=>m(!1),children:"Skip"})]})}if((j==null?void 0:j.type)==="prompt_spirit_1_start")return l.jsxs(l.Fragment,{children:[l.jsx("button",{className:"btn",onClick:()=>U("discard"),children:"Discard 1"}),l.jsx("button",{className:"btn btn-back",onClick:()=>U("flip"),children:"Flip Card"})]});if((j==null?void 0:j.type)==="custom_choice"){const z=j.options||[];if(z.length===2){const H=z[0].params,V=z[1].params,Y=B=>B.action==="discard"?`Discard ${B.count||1}`:B.action==="flip"&&B.flipSelf?"Flip This Card":B.action==="draw"?`Draw ${B.count||1}`:"Option";return l.jsxs(l.Fragment,{children:[l.jsx("button",{className:"btn",onClick:()=>A(0),children:Y(H)}),l.jsx("button",{className:"btn btn-back",onClick:()=>A(1),children:Y(V)})]})}}if((j==null?void 0:j.type)==="prompt_return_for_psychic_4")return l.jsxs(l.Fragment,{children:[l.jsx("button",{className:"btn",onClick:()=>w(!0),children:"Return Card"}),l.jsx("button",{className:"btn btn-back",onClick:()=>w(!1),children:"Skip"})]});if((j==null?void 0:j.type)==="prompt_shift_or_flip_board_card_custom")return l.jsxs(l.Fragment,{children:[l.jsx("button",{className:"btn",onClick:()=>y("shift"),children:"Shift"}),l.jsx("button",{className:"btn",onClick:()=>y("flip"),children:"Flip"}),l.jsx("button",{className:"btn btn-back",onClick:()=>y("skip"),children:"Skip"})]});if((j==null?void 0:j.type)==="discard"&&j.variableCount&&j.actor==="player")return l.jsxs("button",{className:"btn",onClick:()=>h(N),disabled:N.length<1,children:["Confirm Discard (",N.length,")"]});if((j==null?void 0:j.type)==="plague_2_player_discard"||(j==null?void 0:j.type)==="select_cards_from_hand_to_discard_for_fire_4"||(j==null?void 0:j.type)==="select_cards_from_hand_to_discard_for_hate_1"){let z,H=0;return j.type==="plague_2_player_discard"?(z=s,H=1):j.type==="select_cards_from_hand_to_discard_for_fire_4"?(z=h,H=1):(z=p,H=j.count),l.jsxs("button",{className:"btn",onClick:()=>z(N),disabled:N.length<H,children:["Confirm Discard (",N.length,")"]})}if((j==null?void 0:j.type)==="plague_4_player_flip_optional")return l.jsxs(l.Fragment,{children:[l.jsx("button",{className:"btn",onClick:()=>i(!0),children:"Flip Plague-4"}),l.jsx("button",{className:"btn btn-back",onClick:()=>i(!1),children:"Skip"})]});if(j&&"optional"in j&&j.optional)return l.jsx("button",{className:"btn btn-back",onClick:r,children:"Skip Action"});if(j)return l.jsx("button",{className:"btn",disabled:!0,children:"Action Required"});if(D==="compile"&&k.length>0)return l.jsx("button",{className:"btn",disabled:!0,children:"Select Lane to Compile"});if(D==="action"){const z=I.hand.length<5;return I.hand.length===0?l.jsx("button",{className:"btn",onClick:n,children:"Refresh (Required)"}):l.jsx("button",{className:"btn",onClick:n,disabled:!z||!!S,children:"Refresh"})}return l.jsx("button",{className:"btn",disabled:!0,children:"Processing..."})},$=()=>{var W,P,ne,F;if(j)switch(j.type){case"discard":return j.actor==="player"?j.variableCount?"Action: Select 1 or more cards to discard":`Action: Discard ${j.count} card(s) from your hand`:"Waiting for Opponent to discard...";case"prompt_use_control_mechanic":return"Control Action: Rearrange protocols?";case"select_opponent_face_up_card_to_flip":return"Action: Select an opponent's face-up card to flip";case"select_own_face_up_covered_card_to_flip":return"Action: Select one of your face-up, covered cards to flip";case"select_opponent_covered_card_to_shift":return"Action: Select one of your opponent's covered cards to shift";case"select_own_covered_card_to_shift":return"Action: Select one of your covered cards to shift";case"select_lane_for_shift":return"Action: Select a new lane for the card";case"select_lane_for_shift_all":return"Action: Select a lane to shift all cards to";case"select_opponent_card_to_flip":return"Action: Select an opponent's card to flip";case"select_card_to_flip":{const z=j.targetFilter||{},H=z.owner||"any",V=z.faceState||"any",Y=z.position||"uncovered";let B="Action: Flip ";return H==="own"?B+="one of your ":H==="opponent"?B+="an opponent's ":B+="a ",V==="face_down"?B+="face-down ":V==="face_up"&&(B+="face-up "),Y==="covered"?B+="covered ":Y==="uncovered"&&(B+="uncovered "),B+="card",B}case"shift_flipped_card_optional":return"Action: You may shift the card you just flipped. Select a lane or skip.";case"select_covered_card_in_line_to_flip_optional":return"Action: You may flip one of your covered cards in this lane. Select a card or skip.";case"select_card_from_hand_to_play":return"Action: Select a card from your hand to play";case"select_lane_for_play":return"Action: Select another lane to play your card in";case"select_face_down_card_to_shift_for_darkness_4":return"Action: Select any face-down card to shift";case"select_cards_to_delete":return`Action: Select a card to delete (${j.count} remaining)`;case"select_face_down_card_to_delete":return"Action: Select a face-down card to delete";case"select_low_value_card_to_delete":return"Action: Select a card with value 0 or 1 to delete";case"select_card_from_other_lanes_to_delete":return`Action: Select a card to delete (${j.count} remaining)`;case"select_lane_for_death_2":return"Action: Select a lane to delete cards with value 1 or 2";case"select_lane_for_delete":return"Action: Select a lane";case"prompt_optional_draw":return"Optional: Draw card(s)?";case"prompt_death_1_effect":return"Start Phase: Use Death-1 effect?";case"select_card_to_delete_for_death_1":return"Action: Select a card to delete";case"delete_self":return"Deleting card...";case"prompt_give_card_for_love_1":return"End Phase: Give 1 card to draw 2?";case"select_card_from_hand_to_give":return"Action: Select a card from your hand to give";case"select_card_from_hand_to_reveal":return"Action: Select a card from your hand to reveal";case"plague_2_player_discard":return"Action: Select 1 or more cards to discard";case"plague_4_opponent_delete":return"Waiting for opponent to delete one of their face-down cards";case"plague_4_player_flip_optional":return"Action: You may flip Plague-4";case"select_any_other_card_to_flip":return"Action: Select any other card to flip";case"select_card_to_return":{const z=j.targetFilter||{},H=j.targetOwner||z.owner||"any",V=z.position||"uncovered";let Y="Action: Select ";return H==="own"?Y+="one of your ":H==="opponent"?Y+="an opponent's ":Y+="a ",V==="any"?Y+="covered or uncovered ":V==="covered"&&(Y+="covered "),Y+="card to return",Y}case"select_covered_card_to_flip_for_chaos_0":return"Action: Select a covered card to flip in this lane";case"prompt_fire_3_discard":return"End Phase: Discard 1 card to flip 1 card?";case"prompt_optional_discard_custom":return`Optional: Discard ${j.count} card(s) to continue?`;case"prompt_optional_effect":{const z=((P=(W=j.effectDef)==null?void 0:W.params)==null?void 0:P.action)||"effect",H=(F=(ne=j.effectDef)==null?void 0:ne.params)==null?void 0:F.count;return`Optional: Execute ${z}${H?` ${H}`:""}?`}case"select_card_to_flip_for_fire_3":return"Action: Select a card to flip";case"select_own_other_card_to_shift":return"Action: Select one of your cards to shift";case"select_opponent_face_down_card_to_shift":return"Action: Select an opponent's face-down card to shift";case"prompt_spirit_1_start":return"Start Phase: Discard 1 card or flip Spirit-1?";case"select_any_card_to_flip_optional":return"Action: You may flip one card. Select a card or skip.";case"prompt_swap_protocols":return"Action: Swap two protocols.";case"select_cards_from_hand_to_discard_for_fire_4":return"Action: Select 1 or more cards to discard";case"select_cards_from_hand_to_discard_for_hate_1":return`Action: Select ${j.count} card(s) to discard for Hate-1`;case"select_any_card_to_flip":return`Action: Select a card to flip (${j.count} remaining)`;case"select_any_face_down_card_to_flip_optional":return"Action: You may flip a face-down card. Select a card or skip.";case"select_lane_for_life_3_play":return"Action: Select another lane to play a card into";case"select_card_to_flip_for_light_0":return"Action: Select any card to flip";case"prompt_shift_or_flip_board_card_custom":return"Action: Choose to shift, flip, or skip";case"select_board_card_to_reveal_custom":return"Action: Select a face-down card to reveal";case"select_lane_to_shift_revealed_card_for_light_2":return"Action: Select a lane to shift the revealed card to";case"select_lane_to_shift_revealed_board_card_custom":return"Action: Select a lane to shift the revealed card to";case"select_lane_to_shift_cards_for_light_3":return"Action: Select a lane to shift all face-down cards to";case"select_lane_for_metal_3_delete":return"Action: Select a lane with 8+ cards to delete";case"select_lane_for_delete_all":return"Action: Select a lane to delete all cards";case"select_any_other_card_to_flip_for_water_0":return"Action: Select any other card to flip";case"prompt_rearrange_protocols":return"Action: Rearrange protocols";case"select_lane_for_water_3":return"Action: Select a lane to return cards from";case"select_own_card_to_return_for_water_4":return"Action: Select one of your cards to return to your hand";case"prompt_return_for_psychic_4":return"End Phase: Return an opponent's card?";case"select_any_opponent_card_to_shift":return"Action: Select an opponent's card to shift";case"select_card_to_shift":{const z=j.targetFilter||{},H=z.owner||"any",V=z.faceState||"any",Y=z.position||"uncovered";let B="Action: Select ";return H==="own"?B+="one of your ":H==="opponent"?B+="an opponent's ":B+="a ",V==="face_down"?B+="face-down ":V==="face_up"&&(B+="face-up "),Y==="covered"?B+="covered ":Y==="uncovered"&&(B+="uncovered "),B+="card to shift",B}case"select_opponent_card_to_return":return"Action: Select an opponent's card to return";case"select_own_highest_card_to_delete_for_hate_2":return"Action: Select your highest value uncovered card to delete";case"select_opponent_highest_card_to_delete_for_hate_2":return"Action: Select opponent's highest value uncovered card to delete";case"custom_choice":{const z=j.options||[];if(z.length===2){const H=z[0].params,V=z[1].params,Y=B=>B.action==="discard"?`you discard ${B.count||1} card${B.count!==1?"s":""}`:B.action==="flip"&&B.flipSelf?"flip this card":B.action==="draw"?`draw ${B.count||1} card${B.count!==1?"s":""}`:"option";return`Either ${Y(H)} or ${Y(V)}.`}return"Action: Make a choice"}default:return"Action Required"}return D==="compile"&&k.length>0?"Phase: Compile":`Phase: ${D.replace("_"," ")}`};return l.jsxs("div",{className:`phase-controller ${q}`,children:[l.jsxs("div",{className:"effect-source-info",children:[l.jsxs("span",{children:[X,"'s Turn"]}),j&&T&&l.jsxs(l.Fragment,{children:[" | Effect from: ",l.jsxs("span",{children:[T.protocol,"-",T.value]})]}),(j==null?void 0:j.sourceCardId)==="CONTROL_MECHANIC"&&l.jsxs(l.Fragment,{children:[" | Effect from: ",l.jsx("span",{children:"Control Component"})]})]}),l.jsxs("div",{className:"phase-controller-main",children:[l.jsx("div",{className:"phase-info",children:$()}),l.jsx("div",{className:"phase-actions",children:M()})]})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const k_={start:"Start",control:"Control",action:"Action",compile:"Compile",hand_limit:"Hand Limit",end:"End"},N_=({gameState:o,turn:n,animationState:r,difficulty:s,onPlayerClick:i,onOpponentClick:d})=>{const{player:f,opponent:m}=o,h=y=>{const v=["info-section"];return v.push(y==="player"?"player-info":"opponent-info"),n===y&&v.push("active-turn"),(r==null?void 0:r.type)==="drawCard"&&r.owner===y&&v.push("is-drawing"),(r==null?void 0:r.type)==="discardCard"&&r.owner===y&&v.push("is-discarding"),v.join(" ")},p=y=>{const v=y==="player"?f:m,x=y==="player"?i:d,_=y==="player"?"Player":`Opponent${s?` (${s.charAt(0).toUpperCase()+s.slice(1)})`:""}`,w=n===y;return l.jsx("div",{className:h(y),onClick:x,children:l.jsxs("div",{className:"info-section-body",children:[l.jsx("h3",{children:_}),w&&l.jsx("span",{className:"phase-badge",children:k_[o.phase]}),l.jsxs("div",{className:"info-line",children:[l.jsx("span",{children:"Hand:"}),l.jsx("span",{children:v.hand.length})]}),l.jsxs("div",{className:"info-line",children:[l.jsx("span",{children:"Deck:"}),l.jsx("span",{children:v.deck.length})]}),l.jsxs("div",{className:"info-line",children:[l.jsx("span",{children:"Trash:"}),l.jsx("span",{children:v.discard.length})]})]})})};return l.jsxs("div",{className:"game-info-panel",children:[p("opponent"),p("player")]})},F_=/\b([A-Z][a-z]+(?:_custom)?)-(\d)\b/g;function Ac(o,n){return{...o,id:`preview-${o.protocol}-${o.value}`,isFaceUp:n}}function Wh(o){const n=o.match(/^([A-Z][a-z]+(?:_custom)?)-(\d)$/);return n?{protocol:n[1],value:parseInt(n[2],10)}:null}function Qh(o){const n=[];let r;const s=new RegExp(F_);for(;(r=s.exec(o))!==null;)n.push({protocol:r[1],value:parseInt(r[2],10)});return n}function Ah(o,n){if(o.sourceCardRef||o.targetCardRefs&&o.targetCardRefs.length>0)return!0;if(o.sourceCard){const s=Wh(o.sourceCard);if(s&&n.some(i=>i.protocol===s.protocol&&i.value===s.value))return!0}const r=Qh(o.message);return!!(r.length>0&&r.some(s=>n.some(i=>i.protocol===s.protocol&&i.value===s.value)))}function q_(o,n){const r={source:null,targets:[]};if(o.sourceCardRef){const s=n.find(i=>i.protocol===o.sourceCardRef.protocol&&i.value===o.sourceCardRef.value);s&&(r.source=Ac(s,o.sourceCardRef.isFaceUp))}if(o.targetCardRefs&&o.targetCardRefs.length>0)for(const s of o.targetCardRefs){const i=n.find(d=>d.protocol===s.protocol&&d.value===s.value);i&&r.targets.push(Ac(i,s.isFaceUp))}if(!r.source&&r.targets.length===0){if(o.sourceCard){const i=Wh(o.sourceCard);if(i){const d=n.find(f=>f.protocol===i.protocol&&f.value===i.value);d&&(r.source=Ac(d,!0))}}const s=Qh(o.message);for(const i of s){const d=n.find(f=>f.protocol===i.protocol&&f.value===i.value);if(d){const f=Ac(d,!0);r.source?(r.source.protocol!==i.protocol||r.source.value!==i.value)&&r.targets.push(f):r.source=f}}}return r}function U_({log:o,onClose:n}){const[r,s]=ce.useState(null),[i,d]=ce.useState(0),f=ce.useMemo(()=>{const y=Ho();return[...vn,...y]},[]),m=y=>{let v="";if(y.phase){const x=y.phase.charAt(0).toUpperCase()+y.phase.slice(1);v+=`[${x}] `}return y.sourceCard&&!y.message.startsWith(y.sourceCard)&&(v+=`${y.sourceCard}: `),`${v}${y.message}`},h=ce.useMemo(()=>{if(r===null)return null;const y=o[r];return y?q_(y,f):null},[r,o,f]),p=(y,v)=>{Ah(v,f)&&(r===y?h&&h.targets.length>1?d(x=>(x+1)%h.targets.length):(s(null),d(0)):(s(y),d(0)))};return l.jsx("div",{className:"modal-overlay",onClick:n,children:l.jsxs("div",{className:"modal-content log-modal-content log-modal-with-preview",onClick:y=>y.stopPropagation(),children:[l.jsx("button",{className:"btn btn-back modal-close-btn",onClick:n,children:"X"}),l.jsx("h2",{children:"Game Log"}),l.jsxs("div",{className:"log-content-wrapper",children:[l.jsx("div",{className:"log-preview-area log-preview-left",children:(h==null?void 0:h.source)&&l.jsx("div",{className:"log-preview-card",children:l.jsx(Rt,{card:h.source,isFaceUp:h.source.isFaceUp})})}),l.jsx("ol",{className:"log-list",children:o.map((y,v)=>{const x=y.indentLevel!==void 0,_=x?{paddingLeft:`${y.indentLevel*20+40}px`}:{};x&&y.indentLevel===0&&(_.fontWeight="bold");const w=Ah(y,f),U=r===v;return l.jsx("li",{className:`log-entry log-entry-${y.player}${w?" log-entry-clickable":""}${U?" log-entry-selected":""}`,style:_,onClick:()=>p(v,y),children:m(y)},v)})}),l.jsx("div",{className:"log-preview-area log-preview-right",children:(h==null?void 0:h.targets)&&h.targets.length>0&&l.jsxs("div",{className:"log-preview-card",children:[l.jsx(Rt,{card:h.targets[i],isFaceUp:h.targets[i].isFaceUp}),h.targets.length>1&&l.jsxs("div",{className:"log-preview-counter",children:[i+1," / ",h.targets.length]})]})})]})]})})}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const $_=({message:o,player:n})=>l.jsx("div",{className:`toaster toaster-${n}`,children:o});function O_({gameState:o,targetPlayer:n,onConfirm:r}){var W;const[s]=ce.useState([...o[n].protocols]),[i,d]=ce.useState([...o[n].protocols]),[f,m]=ce.useState([0,1,2]),h=ce.useRef(null),p=ce.useRef(null),y=ce.useRef(0),v=ce.useRef(null),x=ce.useRef(0),_=((W=o.actionRequired)==null?void 0:W.type)==="prompt_rearrange_protocols"?o.actionRequired.disallowedProtocolForLane:void 0,w=ce.useMemo(()=>{if(i.length!==s.length)return!1;for(let P=0;P<i.length;P++)if(i[P]!==s[P])return!0;return!1},[i,s]),U=ce.useMemo(()=>{if(!_)return console.log("[RearrangeModal] No disallowedProtocolForLane set"),!1;const{laneIndex:P,protocol:ne}=_,F=i[P],z=F===ne;return console.log("[RearrangeModal] Checking violation:",{disallowedProtocol:ne,disallowedLaneIndex:P,currentProtocolAtLane:F,protocols:i,hasViolation:z}),z},[i,_]),C=o[n],S=o[n==="player"?"opponent":"player"],N=C.laneValues,q=C.compiled,D=(P,ne)=>{let F=[P];return ne&&F.push("compiled"),F.join(" ")},E=(P,ne)=>{h.current=ne,P.dataTransfer.effectAllowed="move"},j=(P,ne)=>{P.preventDefault(),p.current=ne},I=()=>{if(h.current!==null&&p.current!==null&&h.current!==p.current){const P=[...i],ne=[...f],F=P[h.current];P[h.current]=P[p.current],P[p.current]=F;const z=ne[h.current];ne[h.current]=ne[p.current],ne[p.current]=z,h.current=null,p.current=null,d(P),m(ne)}},k=P=>{P.preventDefault()},L=(P,ne)=>{v.current=ne,y.current=P.touches[0].clientY,x.current=P.touches[0].clientY},G=P=>{var z;if(v.current===null)return;x.current=P.touches[0].clientY;const ne=P.touches[0],F=document.elementFromPoint(ne.clientX,ne.clientY);if(F){const H=F.closest(".rearrange-item");if(H){const Y=Array.from(((z=H.parentElement)==null?void 0:z.children)||[]).indexOf(H);Y!==-1&&Y!==v.current&&(p.current=Y)}}},T=()=>{if(v.current!==null&&p.current!==null&&v.current!==p.current){const P=[...i],ne=[...f],F=P[v.current];P[v.current]=P[p.current],P[p.current]=F;const z=ne[v.current];ne[v.current]=ne[p.current],ne[p.current]=z,d(P),m(ne)}v.current=null,p.current=null,y.current=0,x.current=0},Q=n==="player",X=Q?"Rearrange Your Protocols":"Rearrange Opponent's Protocols",M=l.jsx("div",{className:`protocol-bar ${Q?"player-bar":"opponent-bar"} rearrange-editable`,onDragOver:k,children:i.map((P,ne)=>{const F=P!==s[ne],z=_&&_.laneIndex===ne&&P===_.protocol,H=f[ne],V=q[H],Y=D("protocol-display rearrange-item",V);return l.jsxs("div",{className:`${Y} ${F?"changed":""} ${z?"violation":""}`,draggable:!0,onDragStart:B=>E(B,ne),onDragEnter:B=>j(B,ne),onDragEnd:I,onTouchStart:B=>L(B,ne),onTouchMove:G,onTouchEnd:T,children:[l.jsx("span",{className:"protocol-name",children:P}),l.jsx("span",{className:"protocol-value",children:N[ne]})]},`${P}-${ne}`)})}),$=l.jsx("div",{className:`protocol-bar ${Q?"opponent-bar":"player-bar"}`,children:S.protocols.map((P,ne)=>l.jsxs("div",{className:D("protocol-display",S.compiled[ne]),children:[l.jsx("span",{className:"protocol-name",children:P}),l.jsx("span",{className:"protocol-value",children:S.laneValues[ne]})]},`other-proto-${P}-${ne}`))});return l.jsx("div",{className:"modal-overlay",children:l.jsxs("div",{className:"modal-content rearrange-modal-content",onClick:P=>P.stopPropagation(),children:[l.jsx("h2",{children:X}),l.jsx("p",{children:"Drag and drop the protocols to reorder them. You must change the order to continue."}),_&&l.jsxs("p",{className:"warning-text",children:[" ",l.jsx("strong",{children:_.protocol})," cannot be placed on line ",l.jsx("strong",{children:_.laneIndex})," due to Anarchy-3's restriction."]}),l.jsx("div",{className:"rearrange-board-view",children:l.jsxs("div",{className:"protocol-bars-container",children:[Q?$:M,Q?M:$]})}),l.jsxs("div",{className:"rearrange-actions",children:[l.jsx("button",{className:"btn",onClick:()=>r(i),disabled:!w||U,children:"Confirm Rearrangement"}),U&&l.jsxs("p",{className:"error-text",children:["Cannot confirm: ",_.protocol," is on line ",_.laneIndex]})]})]})})}function L_({gameState:o,targetPlayer:n,onConfirm:r}){const[s,i]=ce.useState([]),d=o[n],f=n==="player",m=f?"Swap Your Protocols":"Swap Opponent's Protocols",h=v=>{s.includes(v)?i(x=>x.filter(_=>_!==v)):s.length<2&&i(x=>[...x,v])},p=()=>{s.length===2&&r(s)},y=v=>{let x=["protocol-display","rearrange-item"];return d.compiled[v]&&x.push("compiled"),s.includes(v)&&x.push("selected"),x.join(" ")};return l.jsx("div",{className:"modal-overlay",children:l.jsxs("div",{className:"modal-content rearrange-modal-content",onClick:v=>v.stopPropagation(),children:[l.jsx("h2",{children:m}),l.jsx("p",{children:"Select two protocols to swap their positions. This action is mandatory."}),l.jsx("div",{className:"rearrange-board-view",children:l.jsx("div",{className:"protocol-bars-container",children:l.jsx("div",{className:`protocol-bar ${f?"player-bar":"opponent-bar"}`,children:d.protocols.map((v,x)=>l.jsxs("div",{className:y(x),onClick:()=>h(x),children:[l.jsx("span",{className:"protocol-name",children:v}),l.jsx("span",{className:"protocol-value",children:d.laneValues[x]})]},v))})})}),l.jsx("div",{className:"rearrange-actions",children:l.jsx("button",{className:"btn",onClick:p,disabled:s.length!==2,children:"Confirm Swap"})})]})})}function M_({player:o,playerState:n,onClose:r,difficulty:s}){const i=o==="player"?"Player":`Opponent${s?` (${s.charAt(0).toUpperCase()+s.slice(1)})`:""}`,[d,f]=ce.useState(null),m=p=>{f(p)},h=(p,y,v)=>{const x=p.map((_,w)=>({..._,id:`${y}-${_.protocol}-${_.value}-${w}`,isFaceUp:v}));return l.jsxs(l.Fragment,{children:[l.jsxs("h3",{children:[y," (",x.length,")"]}),l.jsx("div",{className:"debug-card-grid",children:x.length>0?x.map(_=>l.jsx("div",{onClick:w=>{w.stopPropagation(),f(_)},onMouseEnter:()=>m(_),onMouseLeave:()=>m(null),style:{cursor:"pointer"},children:l.jsx(Rt,{card:_,isFaceUp:v,additionalClassName:"in-hand"})},_.id)):l.jsxs("p",{className:"no-cards",children:["No cards in ",y.toLowerCase(),"."]})})]})};return l.jsx("div",{className:"modal-overlay",onClick:r,children:l.jsxs("div",{className:"modal-content debug-modal-content debug-modal-with-preview",onClick:p=>p.stopPropagation(),children:[l.jsx("button",{className:"btn btn-back modal-close-btn",onClick:r,children:"X"}),l.jsxs("h2",{children:[i,"'s Info"]}),l.jsxs("div",{className:"debug-content-wrapper",children:[l.jsx("div",{className:"debug-preview-area",children:d&&l.jsx("div",{className:"debug-preview-card",children:l.jsx(Rt,{card:d,isFaceUp:d.isFaceUp})})}),l.jsxs("div",{className:"debug-grids-area",children:[h(n.deck,"Deck",!1),h(n.discard,"Discard Pile",!0)]})]})]})})}function I_({onComplete:o}){const[n,r]=ce.useState("choose"),[s,i]=ce.useState(null),[d,f]=ce.useState(null),[m,h]=ce.useState(!1),p=v=>{i(v),r("flipping"),h(!0);const x=Math.random()<.5?"heads":"tails";setTimeout(()=>{f(x),h(!1),r("result")},2e3)},y=()=>{if(d===null||s===null)return;const v=d===s;o(v?"player":"opponent",s,v)};return l.jsx("div",{className:"coin-flip-modal-overlay",children:l.jsxs("div",{className:"modal-content coin-flip-modal-content",onClick:v=>v.stopPropagation(),children:[n==="choose"&&l.jsxs(l.Fragment,{children:[l.jsx("h2",{children:"Coin Flip"}),l.jsx("p",{children:"Choose heads or tails to determine who starts the game."}),l.jsxs("div",{className:"coin-flip-choices",children:[l.jsxs("button",{className:"btn coin-flip-choice-btn",onClick:()=>p("heads"),children:[l.jsx("div",{className:"coin-choice-icon",children:"H"}),l.jsx("div",{className:"coin-choice-label",children:"Heads"})]}),l.jsxs("button",{className:"btn coin-flip-choice-btn",onClick:()=>p("tails"),children:[l.jsx("div",{className:"coin-choice-icon",children:"T"}),l.jsx("div",{className:"coin-choice-label",children:"Tails"})]})]})]}),n==="flipping"&&l.jsxs(l.Fragment,{children:[l.jsx("h2",{children:"Flipping..."}),l.jsxs("p",{children:["You chose: ",l.jsx("span",{className:"coin-flip-highlight",children:s==="heads"?"Heads":"Tails"})]}),l.jsx("div",{className:"coin-flip-animation-container",children:l.jsxs("div",{className:`coin-3d ${m?"is-flipping":""}`,children:[l.jsx("div",{className:"coin-face coin-heads",children:"H"}),l.jsx("div",{className:"coin-face coin-tails",children:"T"})]})})]}),n==="result"&&d&&s&&l.jsxs(l.Fragment,{children:[l.jsx("h2",{children:"Result"}),l.jsxs("p",{children:["You chose: ",l.jsx("span",{className:"coin-flip-highlight",children:s==="heads"?"Heads":"Tails"})]}),l.jsx("div",{className:"coin-flip-animation-container",children:l.jsxs("div",{className:`coin-3d result-${d}`,children:[l.jsx("div",{className:"coin-face coin-heads",children:"H"}),l.jsx("div",{className:"coin-face coin-tails",children:"T"})]})}),l.jsxs("p",{className:"coin-flip-result-text",children:["The coin landed on: ",l.jsx("span",{className:"coin-flip-highlight",children:d==="heads"?"Heads":"Tails"})]}),d===s?l.jsx("p",{className:"coin-flip-winner-text",children:"You won! You will start the game."}):l.jsx("p",{className:"coin-flip-loser-text",children:"Opponent won! Opponent will start the game."}),l.jsx("button",{className:"btn",onClick:y,children:"Continue"})]})]})})}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Xh="compile_game_statistics",Zh=1;function Rh(){const o=Th,n={};return o.forEach(r=>{n[r]={timesUsed:0,wins:0,losses:0}}),{version:Zh,global:{totalGamesPlayed:0,totalGamesWon:0,totalGamesLost:0,totalPlaytime:0,fastestWin:null,longestGame:null,lastGameDuration:null,currentStreak:0,longestWinStreak:0,longestLoseStreak:0},protocols:n,aiDifficulty:{easy:{played:0,wins:0,losses:0},normal:{played:0,wins:0,losses:0},hard:{played:0,wins:0,losses:0}},cards:{played:{},deleted:{}},actions:{totalCardsDrawn:0,totalCardsPlayed:0,totalShifts:0,totalDeletes:0,totalDiscards:0,totalFlips:0,totalCompiles:0,totalRefreshes:0},control:{gamesWithControl:0,gamesWithoutControl:0,playerRearranges:0,aiRearranges:0,totalRearranges:0},coinFlip:{headsChosen:0,tailsChosen:0,headsWon:0,tailsWon:0}}}function Kh(){var o,n,r,s,i,d,f,m,h,p;try{const y=localStorage.getItem(Xh);if(!y)return Rh();const v=JSON.parse(y),x=Th,_={...v.protocols||{}};x.forEach(C=>{_[C]||(_[C]={timesUsed:0,wins:0,losses:0})});const w={...v,version:Zh,global:{...v.global,lastGameDuration:((o=v.global)==null?void 0:o.lastGameDuration)||null},protocols:_,control:{gamesWithControl:((n=v.control)==null?void 0:n.gamesWithControl)||0,gamesWithoutControl:((r=v.control)==null?void 0:r.gamesWithoutControl)||0,playerRearranges:((s=v.control)==null?void 0:s.playerRearranges)||0,aiRearranges:((i=v.control)==null?void 0:i.aiRearranges)||0,totalRearranges:((d=v.control)==null?void 0:d.totalRearranges)||0},coinFlip:v.coinFlip||{headsChosen:0,tailsChosen:0,headsWon:0,tailsWon:0},actions:{...v.actions,totalCompiles:((f=v.actions)==null?void 0:f.totalCompiles)||0,totalRefreshes:((m=v.actions)==null?void 0:m.totalRefreshes)||0}};return(!((h=v.control)!=null&&h.playerRearranges)||!v.coinFlip||!((p=v.actions)!=null&&p.totalCompiles)||Object.keys(_).length!==Object.keys(v.protocols||{}).length)&&al(w),w}catch(y){return console.error("Failed to load statistics:",y),Rh()}}function al(o){try{localStorage.setItem(Xh,JSON.stringify(o))}catch(n){console.error("Failed to save statistics:",n)}}function P_(o,n,r,s,i,d=!1,f,m){const h=n==="player",p={...o.global},y={...o.protocols},v={easy:{...o.aiDifficulty.easy},normal:{...o.aiDifficulty.normal},hard:{...o.aiDifficulty.hard}},x={...o.control},_={...o.actions},w={...o.coinFlip},U={played:{...o.cards.played},deleted:{...o.cards.deleted}};return p.totalGamesPlayed++,h?p.totalGamesWon++:p.totalGamesLost++,p.totalPlaytime+=i,h&&(p.fastestWin===null||i<p.fastestWin)&&(p.fastestWin=i),(p.longestGame===null||i>p.longestGame)&&(p.longestGame=i),p.lastGameDuration=i,h?(p.currentStreak>=0?p.currentStreak++:p.currentStreak=1,p.currentStreak>p.longestWinStreak&&(p.longestWinStreak=p.currentStreak)):(p.currentStreak<=0?p.currentStreak--:p.currentStreak=-1,Math.abs(p.currentStreak)>p.longestLoseStreak&&(p.longestLoseStreak=Math.abs(p.currentStreak))),r.forEach(C=>{y[C]?y[C]={...y[C]}:y[C]={timesUsed:0,wins:0,losses:0},y[C].timesUsed++,h?y[C].wins++:y[C].losses++}),v[s].played++,h?v[s].wins++:v[s].losses++,d?x.gamesWithControl++:x.gamesWithoutControl++,f&&(_.totalCardsPlayed+=f.cardsPlayed,_.totalCardsDrawn+=f.cardsDrawn,_.totalDiscards+=f.cardsDiscarded,_.totalDeletes+=f.cardsDeleted,_.totalFlips+=f.cardsFlipped,_.totalShifts+=f.cardsShifted,_.totalRefreshes+=f.handsRefreshed),m!==void 0&&(_.totalCompiles+=m),{version:o.version,global:p,protocols:y,aiDifficulty:v,cards:U,actions:_,control:x,coinFlip:w}}function H_(o,n){const r={...o,cards:{...o.cards,played:{...o.cards.played}}};return r.cards.played[n]||(r.cards.played[n]=0),r.cards.played[n]++,r}function B_(o,n){const r={...o,cards:{...o.cards,deleted:{...o.cards.deleted}}};return r.cards.deleted[n]||(r.cards.deleted[n]=0),r.cards.deleted[n]++,r}function z_(o,n){const r={...o,control:{...o.control}};return n==="player"?r.control.playerRearranges++:r.control.aiRearranges++,r.control.totalRearranges++,r}function V_(o,n,r){const s={...o,coinFlip:{...o.coinFlip}};return n==="heads"?(s.coinFlip.headsChosen++,r&&s.coinFlip.headsWon++):(s.coinFlip.tailsChosen++,r&&s.coinFlip.tailsWon++),s}function G_(o){return o.global.totalGamesPlayed===0?0:o.global.totalGamesWon/o.global.totalGamesPlayed*100}function Y_(o){return o.global.totalGamesPlayed===0?0:Math.floor(o.global.totalPlaytime/o.global.totalGamesPlayed)}function W_(o){return Object.entries(o.protocols).map(([r,s])=>({protocol:r,timesUsed:s.timesUsed,winRate:s.timesUsed>0?s.wins/s.timesUsed*100:0})).sort((r,s)=>s.timesUsed-r.timesUsed).slice(0,5)}function Q_(o){return Object.entries(o.protocols).filter(([r,s])=>s.timesUsed>=3).map(([r,s])=>({protocol:r,timesUsed:s.timesUsed,winRate:s.wins/s.timesUsed*100})).sort((r,s)=>s.winRate-r.winRate).slice(0,5)}function X_(o){return Object.entries(o.protocols).map(([r,s])=>({protocol:r,timesUsed:s.timesUsed,winRate:s.timesUsed>0?s.wins/s.timesUsed*100:0})).sort((r,s)=>r.timesUsed-s.timesUsed).slice(0,5)}function Z_(o){return Object.entries(o.cards.played).map(([r,s])=>({card:r,count:s})).sort((r,s)=>s.count-r.count).slice(0,5)}function K_(o){return Object.entries(o.cards.deleted).map(([r,s])=>({card:r,count:s})).sort((r,s)=>s.count-r.count).slice(0,5)}function cr(o){const n=Math.floor(o/3600),r=Math.floor(o%3600/60),s=o%60;return n>0?`${n}h ${r}m`:r>0?`${r}m ${s}s`:`${s}s`}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function J_(o,n,r){const[s,i]=ce.useState(()=>Kh()),d=ce.useRef(null),f=ce.useCallback(()=>{d.current=Date.now()},[]),m=ce.useCallback((x,_)=>{i(w=>{const U=`${x}-${_}`,C=H_(w,U);return al(C),C})},[]),h=ce.useCallback((x,_)=>{i(w=>{const U=`${x}-${_}`,C=B_(w,U);return al(C),C})},[]),p=ce.useCallback((x,_)=>{i(w=>{const U=V_(w,x,_);return al(U),U})},[]),y=ce.useCallback(x=>{i(_=>{const w=z_(_,x);return al(w),w})},[]),v=ce.useCallback((x,_,w)=>{if(d.current===null)return;const U=Math.floor((Date.now()-d.current)/1e3);i(C=>{const A=P_(C,x,o,n,U,r,_,w);return al(A),A}),d.current=null},[o,n,r]);return{statistics:s,startGame:f,endGame:v,trackPlayerCardPlayed:m,trackPlayerCardDeleted:h,trackPlayerCoinFlip:p,trackPlayerRearrange:y}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function b(o,n,r=!0){const i=Ho().find(d=>d.protocol===o&&d.value===n);return i?{id:Ge(),protocol:i.protocol,value:i.value,top:i.top,middle:i.middle,bottom:i.bottom,keywords:i.keywords,isFaceUp:r,isRevealed:!1,...i.customEffects&&{customEffects:i.customEffects}}:(console.warn(`Card not found: ${o}-${n}`),{id:Ge(),protocol:o,value:n,top:"",middle:"",bottom:"",keywords:{},isFaceUp:r,isRevealed:!1})}function Z(o,n,r,s){const i={...o},d={...i[n]},f=[...d.lanes];return f[r]=[...f[r],s],d.lanes=f,i[n]=d,i}function Dh(o,n){const r=[],s=Ho();for(const i of o){const d=s.filter(f=>f.protocol===i);for(const f of d)n.some(h=>h.protocol===f.protocol&&h.value===f.value)||r.push(b(f.protocol,f.value,!0))}return r}function Ae(o,n,r,s,i){return{...o,player:{...o.player,protocols:n,lanes:[[],[],[]],hand:[]},opponent:{...o.opponent,protocols:r,lanes:[[],[],[]],hand:[]},turn:s,phase:i,actionRequired:null,queuedActions:[],_interruptedTurn:void 0,_interruptedPhase:void 0,processedStartEffectIds:[],processedEndEffectIds:[],processedUncoverEventIds:[]}}function Re(o){const n=[...o.player.hand,...o.player.lanes.flat()],r=[...o.opponent.hand,...o.opponent.lanes.flat()],s=Dh(o.player.protocols,n),i=Dh(o.opponent.protocols,r),d=o.turn==="player"?"Player":"Opponent",f=[{player:"player",message:`Player protocols: ${o.player.protocols.join(", ")}`},{player:"opponent",message:`Opponent protocols: ${o.opponent.protocols.join(", ")}`},{player:o.turn,message:`${d} goes first.`},{player:"player",message:"---"},{player:o.turn,message:`[Test Scenario] Phase: ${o.phase}`}];return{...o,player:{...o.player,deck:s,discard:[],compiled:[!1,!1,!1]},opponent:{...o.opponent,deck:i,discard:[],compiled:[!1,!1,!1]},log:f}}const Jh={name:"Psychic-3 Uncover whrend Opponent's Turn",description:"Player lscht Opponent's face-down card  Psychic-3 uncovered  Player discardet, Opponent shiftet",setup:o=>{let n=Ae(o,["Hate","Fire","Water"],["Psychic","Death","Spirit"],"player","action");return n.player.hand=[b("Hate",0,!0),b("Fire",1,!0),b("Water",1,!0)],n=Z(n,"opponent",1,b("Psychic",3,!0)),n=Z(n,"opponent",1,b("Fire",1,!1)),n=_e(n),Re(n)}},em={name:"Psychic-4 End Effect mit Uncover-Interrupt",description:"Psychic-4 returnt Fire-2  Fire-4 uncovered  Interrupt  Psychic-4 flip aus Queue",setup:o=>{let n=Ae(o,["Fire","Water","Spirit"],["Psychic","Death","Metal"],"opponent","end");return n=Z(n,"opponent",0,b("Psychic",4,!0)),n=Z(n,"player",1,b("Fire",4,!0)),n=Z(n,"player",1,b("Fire",2,!0)),n.opponent.hand=[b("Water",1),b("Water",2)],n=_e(n),Re(n)}},tm={name:"Spirit-3 Draw whrend End Phase",description:"Spirit-3 draw in End Phase  Shift-prompt in Queue  Player kann lanes klicken",setup:o=>{let n=Ae(o,["Spirit","Fire","Water"],["Death","Metal","Psychic"],"player","action");n=Z(n,"player",0,b("Spirit",3,!0));const r=Ho(),s=r.find(f=>f.protocol==="Fire"&&f.value===1),i=r.find(f=>f.protocol==="Water"&&f.value===1),d=r.find(f=>f.protocol==="Spirit"&&f.value===1);return n.player.deck=[s,i,d],n=_e(n),Re(n)}},nm={name:"Plague-2 Actor Propagation",description:"Player spielt Plague-2  Player discardet  Opponent discardet (actor korrekt)",setup:o=>{let n=Ae(o,["Plague","Death","Hate"],["Fire","Water","Spirit"],"player","action");return n.player.hand=[b("Plague",2,!0),b("Fire",1),b("Water",1),b("Spirit",1)],n.opponent.hand=[b("Fire",2),b("Water",2),b("Spirit",2),b("Death",2)],n=_e(n),Re(n)}},om={name:"Darkness-1 Flip + Shift mit Interrupt",description:"Darkness-1 flippt Fire-0  Delete-Interrupt  Player shiftet",setup:o=>{let n=Ae(o,["Darkness","Fire","Water"],["Spirit","Death","Metal"],"player","action");return n.player.hand=[b("Darkness",1,!0)],n=Z(n,"opponent",0,b("Fire",0,!1)),n=_e(n),Re(n)}},am={name:"Plague-4 Owner vs Turn Check",description:"Plague-4 End  Player deletet  Opponent (owner) wird fr flip gefragt",setup:o=>{let n=Ae(o,["Fire","Water","Spirit"],["Plague","Death","Metal"],"opponent","end");return n=Z(n,"opponent",0,b("Plague",4,!0)),n=Z(n,"player",1,b("Water",2,!1)),n=_e(n),Re(n)}},lm={name:"Water Owner vs Turn Check",description:"Plague-4 End  Player deletet  Opponent (owner) wird fr flip gefragt",setup:o=>{let n=Ae(o,["Fire","Water","Spirit"],["Plague","Death","Metal"],"player","action");return n=Z(n,"opponent",0,b("Plague",4,!0)),n=Z(n,"player",2,b("Water",4,!1)),n.player.hand=[b("Water",0,!0),b("Fire",1),b("Water",1),b("Spirit",1)],n.opponent.hand=[b("Fire",2),b("Water",2),b("Spirit",2),b("Death",2)],n=_e(n),Re(n)}},rm={name:"Hate-1 Multi-Delete mit Uncover-Interrupt",description:"Hate-1 lscht Plague-0  Plague-5 uncovered  Interrupt  Player macht 2. Delete",setup:o=>{let n=Ae(o,["Fire","Hate","Water"],["Plague","Death","Metal"],"player","action");return n.player.hand=[b("Hate",1,!0),b("Psychic",2,!0),b("Psychic",4,!0),b("Hate",4,!0),b("Water",1,!0)],n=Z(n,"opponent",0,b("Plague",2,!0)),n=Z(n,"opponent",0,b("Plague",0,!0)),n.opponent.hand=[b("Fire",2,!0),b("Water",2,!0),b("Spirit",2,!0),b("Death",2,!0),b("Metal",2,!0)],n=_e(n),Re(n)}},cm={name:"Darkness-1  Hate-0 Flip  Multi-Effect Chain",description:" Darkness-1 flippt Hate-0  Delete-Interrupt  Draw-Interrupt  Shift aus Queue",setup:o=>{let n=Ae(o,["Darkness","Fire","Water"],["Hate","Death","Metal"],"player","action");n.player.hand=[b("Darkness",1,!0)],n=Z(n,"opponent",0,b("Hate",0,!1)),n=Z(n,"opponent",1,b("Hate",3,!0)),n=Z(n,"opponent",2,b("Fire",1,!1)),n=Z(n,"player",1,b("Water",2,!0)),n.opponent.hand=[b("Death",2),b("Metal",3)];const s=Ho().find(i=>i.protocol==="Death"&&i.value===1);return n.opponent.deck=[s],n=_e(n),Re(n)}},im={name:"Water-4 Return  Turn End",description:" Water-4 returnt Karte  Turn endet (Bug-Fix: Opponent spielt nicht zweimal)",setup:o=>{let n=Ae(o,["Hate","Spirit","Light"],["Fire","Water","Death"],"opponent","action");return n.opponent.hand=[b("Water",4,!0)],n=Z(n,"opponent",0,b("Life",4,!0)),n=Z(n,"opponent",2,b("Death",4,!1)),n=Z(n,"player",1,b("Spirit",1,!0)),n=Z(n,"player",2,b("Light",5,!1)),n.player.hand=[b("Fire",1),b("Spirit",2),b("Hate",4)],n=_e(n),Re(n)}},sm={name:"Psychic-3 Discard + Shift",description:" Psychic-3 On-Play  Player discardet  AI shiftet (Bug-Fix: AI kann shiften)",setup:o=>{let n=Ae(o,["Fire","Water","Spirit"],["Psychic","Death","Metal"],"opponent","action");return n.opponent.hand=[b("Psychic",3,!0)],n.player.hand=[b("Fire",1),b("Water",2),b("Spirit",1)],n=Z(n,"player",0,b("Fire",2,!0)),n=Z(n,"player",1,b("Water",3,!0)),n=Z(n,"player",2,b("Spirit",4,!0)),n=_e(n),Re(n)}},dm={name:"Death-1 Delete  Speed-3 Uncover",description:" Death-1 lscht Light-0  Speed-3 uncovered  Player shiftet (Bug-Fix Test)",setup:o=>{let n=Ae(o,["Speed","Light","Water"],["Death","Fire","Metal"],"opponent","start");return n=Z(n,"player",0,b("Speed",3,!0)),n=Z(n,"player",0,b("Light",0,!0)),n=Z(n,"player",1,b("Water",1,!0)),n=Z(n,"opponent",0,b("Death",1,!0)),n.player.hand=[],n.opponent.hand=[],n=_e(n),Re(n)}},um={name:"Gravity-2 Flip  Metal-5 Discard  Shift",description:" Gravity-2 flippt Metal-5  Discard Interrupt  shiften (Bug-Fix: AI stuck)",setup:o=>{let n=Ae(o,["Fire","Water","Light"],["Gravity","Metal","Fire"],"opponent","action");return n.opponent.hand=[b("Gravity",2,!0),b("Fire",1)],n=Z(n,"opponent",1,b("Metal",5,!1)),n=Z(n,"player",0,b("Fire",2,!0)),n=Z(n,"player",2,b("Light",3,!0)),n.player.hand=[b("Water",1),b("Fire",3)],n=_e(n),Re(n)}},fm={name:"Hate-2 Player spielt (Einfach)",description:" Player spielt Hate-2  Whlt eigene & Gegners hchste Karte",setup:o=>{let n=Ae(o,["Hate","Water","Light"],["Metal","Death","Gravity"],"player","action");return n.player.hand=[b("Hate",2,!0)],n=Z(n,"player",0,b("Fire",4,!0)),n=Z(n,"player",1,b("Water",2,!0)),n=Z(n,"player",2,b("Light",5,!0)),n=Z(n,"opponent",0,b("Metal",3,!0)),n=Z(n,"opponent",1,b("Death",5,!0)),n=Z(n,"opponent",2,b("Gravity",2,!1)),n=_e(n),Re(n)}},pm={name:"Hate-2 AI spielt (Normal)",description:" AI spielt Hate-2  AI whlt eigene & Players hchste automatisch",setup:o=>{let n=Ae(o,["Water","Spirit","Light"],["Hate","Metal","Death"],"opponent","action");return n.opponent.hand=[b("Hate",2,!0)],n=Z(n,"opponent",0,b("Fire",5,!0)),n=Z(n,"opponent",1,b("Metal",3,!0)),n=Z(n,"opponent",2,b("Death",2,!1)),n=Z(n,"player",0,b("Water",4,!0)),n=Z(n,"player",1,b("Spirit",5,!0)),n=Z(n,"player",2,b("Light",2,!0)),n=_e(n),Re(n)}},hm={name:"Hate-2 AI spielt (Normal) mit Auswahl",description:" AI spielt Hate-2  AI whlt eigene & Players hchste automatisch",setup:o=>{let n=Ae(o,["Water","Spirit","Light"],["Hate","Metal","Death"],"opponent","action");return n.opponent.hand=[b("Hate",2,!0)],n=Z(n,"opponent",0,b("Fire",5,!0)),n=Z(n,"opponent",1,b("Metal",3,!0)),n=Z(n,"opponent",2,b("Death",2,!1)),n=Z(n,"player",0,b("Water",4,!0)),n=Z(n,"player",1,b("Spirit",5,!0)),n=Z(n,"player",2,b("Light",5,!0)),n=_e(n),Re(n)}},mm={name:"Hate-2 Selbst-Lschung",description:" Hate-2 lscht sich selbst  Zweite Klausel entfllt (Regelwerk-Check)",setup:o=>{let n=Ae(o,["Hate","Fire","Water"],["Metal","Death","Gravity"],"player","action");return n.player.hand=[b("Hate",2,!0)],n=Z(n,"player",1,b("Fire",1,!0)),n=Z(n,"player",2,b("Water",0,!0)),n=Z(n,"opponent",0,b("Metal",3,!0)),n=Z(n,"opponent",1,b("Death",5,!0)),n=_e(n),Re(n)}},gm={name:"Hate-2 Gleichstand (Auswahl)",description:" Hate-2 mit mehreren hchsten  Player muss whlen (Tied values)",setup:o=>{let n=Ae(o,["Hate","Water","Spirit"],["Metal","Death","Gravity"],"player","action");return n.player.hand=[b("Hate",2,!0)],n=Z(n,"player",0,b("Fire",4,!0)),n=Z(n,"player",1,b("Water",4,!0)),n=Z(n,"player",2,b("Spirit",4,!0)),n=Z(n,"opponent",0,b("Metal",5,!0)),n=Z(n,"opponent",1,b("Death",5,!0)),n=Z(n,"opponent",2,b("Gravity",2,!1)),n=_e(n),Re(n)}},ym={name:"Hate-2 Face-Down Karten",description:" Hate-2 mit face-down  Alle face-down sind value 2 (Tied mit Hate-2)",setup:o=>{let n=Ae(o,["Hate","Fire","Water"],["Metal","Death","Gravity"],"player","action");return n.player.hand=[b("Hate",2,!0)],n=Z(n,"player",1,b("Fire",5,!1)),n=Z(n,"player",2,b("Water",5,!1)),n=Z(n,"opponent",0,b("Metal",5,!0)),n=Z(n,"opponent",1,b("Death",4,!1)),n=Z(n,"opponent",2,b("Gravity",1,!0)),n=_e(n),Re(n)}},vm={name:"Hate-2 AI Play-Validation",description:" AI spielt Hate-2 NICHT face-up wenn es sich selbst lschen wrde",setup:o=>{let n=Ae(o,["Fire","Water","Spirit"],["Hate","Death","Metal"],"opponent","action");return n.opponent.hand=[b("Hate",2,!0)],n=Z(n,"opponent",1,b("Fire",0,!0)),n=Z(n,"opponent",2,b("Water",1,!0)),n=Z(n,"player",0,b("Fire",5,!0)),n=Z(n,"player",1,b("Water",4,!0)),n=_e(n),Re(n)}},_m={name:"Hate-2 AI spielt OFFEN (Optimal)",description:" AI spielt Hate-2 offen weil nicht hchste Karte",setup:o=>{let n=Ae(o,["Water","Spirit","Light"],["Hate","Metal","Death"],"opponent","action");return n.opponent.hand=[b("Hate",2,!0)],n=Z(n,"opponent",0,b("Fire",5,!0)),n=Z(n,"opponent",1,b("Metal",4,!0)),n=Z(n,"opponent",2,b("Death",3,!0)),n=Z(n,"player",0,b("Water",2,!0)),n=Z(n,"player",1,b("Spirit",5,!0)),n=Z(n,"player",2,b("Light",1,!0)),n=_e(n),Re(n)}},e0={name:"Chaos-3 Protocol-Free Playing",description:"Player with Chaos-3 can play any card face-up in any lane",setup:o=>{let n=Ae(o,["Chaos","Fire","Water"],["Spirit","Death","Metal"],"player","action");return n=Z(n,"player",0,b("Chaos",3,!0)),n.player.hand=[b("Gravity",2,!0),b("Hate",3,!0),b("Love",1,!0)],n=_e(n),Re(n)}},t0={name:"Frost-3 Blocks Shifts (Covered)",description:"Frost-3 should prevent shifts even when covered (Top-Box effect always active)",setup:o=>{let n=Ae(o,["Gravity","Water","Fire"],["Frost","Metal","Death"],"player","action");return n=Z(n,"opponent",0,b("Frost",3,!0)),n=Z(n,"opponent",0,b("Metal",2,!1)),n=Z(n,"player",1,b("Water",2,!0)),n.player.hand=[b("Gravity",1,!0),b("Fire",2,!0)],n=_e(n),Re(n)}},n0={name:"Water-0 Softlock Bug Fix",description:"Water-0 self-flip should be cancelled when card becomes covered before self-flip executes",setup:o=>{let n=Ae(o,["Water","Darkness","Light"],["Apathy","Fire","Death"],"player","action");return n=Z(n,"player",1,b("Darkness",3,!1)),n.player.hand=[b("Water",0,!0),b("Darkness",2,!0),b("Fire",1,!0)],n=_e(n),Re(n)}},o0={name:"Darkness-1 Flip and Shift Chain",description:"Darkness-1 should flip opponent card, then allow shifting that same card",setup:o=>{let n=Ae(o,["Darkness","Water","Fire"],["Metal","Fire","Death"],"player","action");return n=Z(n,"opponent",0,b("Metal",2,!1)),n=Z(n,"opponent",1,b("Fire",1,!0)),n=Z(n,"opponent",2,b("Hate",0,!1)),n.player.hand=[b("Darkness",1,!0),b("Water",2,!0),b("Fire",3,!0)],n=_e(n),Re(n)}},a0={name:"Darkness-1 Flips Speed-3 - Middle Effect Execution",description:"When Darkness-1 flips Speed-3, Speed-3's middle effect (shift) should execute before Darkness-1's shift",setup:o=>{let n=Ae(o,["Darkness","Water","Fire"],["Speed","Fire","Metal"],"player","action");return n=Z(n,"opponent",0,b("Speed",3,!1)),n=Z(n,"opponent",1,b("Fire",1,!0)),n=Z(n,"opponent",2,b("Metal",2,!0)),n.player.hand=[b("Darkness",1,!0),b("Water",2,!0),b("Fire",3,!0)],n=_e(n),Re(n)}},l0={name:"Darkness-1 Flips Speed-3 - Middle Effect Execution",description:"When Darkness-1 flips Speed-3, Speed-3's middle effect (shift) should execute before Darkness-1's shift",setup:o=>{let n=Ae(o,["Darkness","Water","Fire"],["Speed","Fire","Metal"],"player","action");return n=Z(n,"opponent",0,b("Speed",3,!1)),n=Z(n,"opponent",1,b("Fire",1,!0)),n=Z(n,"opponent",2,b("Metal",2,!0)),n.player.hand=[b("Darkness",1,!0),b("Water",2,!0),b("Fire",3,!0)],n=_e(n),Re(n)}},xm={name:"Fire-1 & Fire-2 Conditional Test",description:" Fire-1 (discard -> delete) & Fire-2 (discard -> return) if_executed logic",setup:o=>{let n=Ae(o,["Fire","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[b("Fire",1,!0),b("Fire",2,!0),b("Fire",0,!0),b("Fire",3,!0),b("Fire",4,!0),b("Fire",5,!0)],n=Z(n,"opponent",0,b("Metal",3,!0)),n=Z(n,"opponent",1,b("Death",4,!0)),n=Z(n,"opponent",2,b("Fire",2,!0)),n=Z(n,"opponent",0,b("Metal",1,!0)),n=Z(n,"player",2,b("Spirit",3,!0)),n=Z(n,"player",1,b("Water",3,!0)),n=Z(n,"player",2,b("Spirit",2,!0)),n=_e(n),Re(n)}},wm={name:"Anarchy Test Playground",description:" All Anarchy cards on hand for testing",setup:o=>{let n=Ae(o,["Anarchy","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[b("Anarchy",0,!0),b("Anarchy",1,!0),b("Anarchy",2,!0),b("Anarchy",3,!0),b("Anarchy",5,!0),b("Anarchy",6,!0)],n=Z(n,"opponent",0,b("Metal",3,!0)),n=Z(n,"opponent",1,b("Death",4,!1)),n=Z(n,"opponent",2,b("Fire",2,!0)),n=Z(n,"opponent",0,b("Metal",1,!0)),n=Z(n,"player",2,b("Spirit",3,!0)),n=Z(n,"player",1,b("Water",3,!0)),n=Z(n,"player",2,b("Spirit",2,!0)),n=_e(n),Re(n)}},Cm={name:"Darkness Test Playground",description:" All Darkness cards on hand for testing",setup:o=>{let n=Ae(o,["Darkness","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[b("Darkness",0,!0),b("Darkness",1,!0),b("Darkness",2,!0),b("Darkness",3,!0),b("Darkness",4,!0),b("Darkness",5,!0)],n=Z(n,"opponent",0,b("Metal",3,!1)),n=Z(n,"opponent",1,b("Death",4,!0)),n=Z(n,"opponent",2,b("Fire",2,!1)),n=Z(n,"opponent",0,b("Metal",1,!0)),n=Z(n,"opponent",1,b("Death",2,!1)),n=Z(n,"player",2,b("Spirit",3,!0)),n=Z(n,"player",1,b("Water",3,!0)),n=Z(n,"player",2,b("Spirit",2,!0)),n=_e(n),Re(n)}},bm={name:"Apathy Test Playground",description:" All Apathy cards on hand for testing",setup:o=>{let n=Ae(o,["Apathy","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[b("Apathy",0,!0),b("Apathy",1,!0),b("Apathy",2,!0),b("Apathy",3,!0),b("Apathy",4,!0),b("Apathy",5,!0)],n=Z(n,"opponent",0,b("Metal",3,!0)),n=Z(n,"opponent",1,b("Death",4,!0)),n=Z(n,"opponent",2,b("Fire",2,!0)),n=Z(n,"opponent",0,b("Metal",1,!0)),n=Z(n,"opponent",2,b("Fire",1,!1)),n=Z(n,"player",2,b("Spirit",3,!0)),n=Z(n,"player",1,b("Water",3,!0)),n=Z(n,"player",2,b("Spirit",2,!0)),n=_e(n),Re(n)}},Sm={name:"Death Test Playground",description:" All Death cards on hand for testing",setup:o=>{let n=Ae(o,["Death_cust","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[b("Death_cust",0,!0),b("Death_cust",1,!0),b("Death_cust",2,!0),b("Death_cust",3,!0),b("Death_cust",4,!0),b("Death_cust",5,!0)],n=Z(n,"opponent",0,b("Metal",0,!0)),n=Z(n,"opponent",1,b("Death",1,!0)),n=Z(n,"opponent",2,b("Fire",3,!0)),n=Z(n,"opponent",0,b("Metal",2,!0)),n=Z(n,"opponent",1,b("Death",4,!1)),n=Z(n,"player",2,b("Spirit",3,!0)),n=Z(n,"player",1,b("Water",3,!0)),n=Z(n,"player",2,b("Spirit",2,!0)),n=_e(n),Re(n)}},Em={name:"Water Test Playground",description:" All Water cards on hand for testing - wash away and renew",setup:o=>{let n=Ae(o,["Water","Fire","Spirit"],["Metal","Death","Light"],"player","action");return n.player.hand=[b("Water",0,!0),b("Water",1,!0),b("Water",2,!0),b("Water",3,!0),b("Water",4,!0),b("Water",5,!0)],n=Z(n,"opponent",0,b("Metal",2,!0)),n=Z(n,"opponent",1,b("Death",3,!0)),n=Z(n,"opponent",2,b("Light",2,!0)),n=Z(n,"opponent",0,b("Metal",4,!0)),n=Z(n,"opponent",1,b("Death",2,!1)),n=Z(n,"opponent",2,b("Light",5,!1)),n=Z(n,"player",1,b("Fire",2,!0)),n=Z(n,"player",2,b("Spirit",3,!0)),n=Z(n,"player",1,b("Fire",4,!0)),n=Z(n,"player",2,b("Spirit",5,!1)),n=_e(n),Re(n)}},jm={name:"Spirit Test Playground",description:" All Spirit cards on hand - true strength from within",setup:o=>{let n=Ae(o,["Spirit","Fire","Water"],["Metal","Death","Light"],"player","action");return n.player.hand=[b("Spirit",0,!0),b("Spirit",1,!0),b("Spirit",2,!0),b("Spirit",3,!0),b("Spirit",4,!0),b("Spirit",5,!0)],n=Z(n,"opponent",0,b("Metal",3,!0)),n=Z(n,"opponent",1,b("Death",2,!1)),n=Z(n,"opponent",2,b("Light",4,!0)),n=Z(n,"opponent",0,b("Metal",5,!1)),n=Z(n,"opponent",2,b("Light",3,!0)),n=Z(n,"player",1,b("Fire",2,!0)),n=Z(n,"player",2,b("Water",4,!0)),n=Z(n,"player",1,b("Fire",3,!1)),n=_e(n),Re(n)}},Am={name:"Chaos Test Playground",description:" All Chaos cards on hand - embrace the unpredictable",setup:o=>{let n=Ae(o,["Chaos","Fire","Water"],["Metal","Death","Light"],"player","action");return n.player.hand=[b("Chaos",0,!0),b("Chaos",1,!0),b("Chaos",2,!0),b("Chaos",3,!0),b("Chaos",4,!0),b("Chaos",5,!0)],n=Z(n,"opponent",0,b("Metal",2,!0)),n=Z(n,"opponent",0,b("Metal",4,!0)),n=Z(n,"opponent",1,b("Death",3,!1)),n=Z(n,"opponent",1,b("Death",5,!0)),n=Z(n,"opponent",2,b("Light",1,!0)),n=Z(n,"opponent",2,b("Light",3,!1)),n=Z(n,"player",0,b("Fire",2,!0)),n=Z(n,"player",0,b("Fire",4,!0)),n=Z(n,"player",1,b("Water",3,!1)),n=Z(n,"player",1,b("Water",5,!0)),n=Z(n,"player",2,b("Fire",1,!0)),n=_e(n),Re(n)}},Rm={name:"Gravity Test Playground",description:" All Gravity cards on hand - pull everything together",setup:o=>{let n=Ae(o,["Fire","Gravity","Water"],["Metal","Death","Light"],"player","action");return n.player.hand=[b("Gravity",0,!0),b("Gravity",1,!0),b("Gravity",2,!0),b("Gravity",4,!0),b("Gravity",5,!0),b("Gravity",6,!0)],n=Z(n,"player",0,b("Fire",1,!0)),n=Z(n,"player",2,b("Water",2,!1)),n=Z(n,"opponent",0,b("Metal",3,!1)),n=Z(n,"opponent",0,b("Metal",4,!0)),n=Z(n,"opponent",1,b("Death",2,!1)),n=Z(n,"opponent",1,b("Death",3,!0)),n=Z(n,"opponent",2,b("Light",4,!1)),n.opponent.deck=[b("Metal",5,!0),b("Death",4,!0),b("Light",5,!0)],n=_e(n),Re(n)}},Dm={name:"Frost Test Playground",description:" All Frost cards on hand - pull everything together",setup:o=>{let n=Ae(o,["Fire","Frost","Water"],["Metal","Death","Light"],"player","action");return n.player.hand=[b("Frost",0,!0),b("Frost",1,!0),b("Frost",2,!0),b("Frost",3,!0),b("Frost",4,!0),b("Frost",5,!0)],n=Z(n,"player",0,b("Fire",1,!0)),n=Z(n,"player",2,b("Water",2,!1)),n=Z(n,"opponent",0,b("Metal",3,!1)),n=Z(n,"opponent",0,b("Metal",4,!0)),n=Z(n,"opponent",1,b("Death",2,!1)),n=Z(n,"opponent",1,b("Death",3,!0)),n=Z(n,"opponent",2,b("Light",4,!1)),n.opponent.deck=[b("Metal",5,!0),b("Death",4,!0),b("Light",5,!0)],n=_e(n),Re(n)}},Tm={name:"Hate Test Playground",description:" All Hate cards on hand - test deletion mechanics",setup:o=>{let n=Ae(o,["Hate","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[b("Hate",0,!0),b("Hate",1,!0),b("Hate",2,!0),b("Hate",3,!0),b("Hate",4,!0),b("Hate",5,!0)],n=Z(n,"player",1,b("Water",1,!0)),n=Z(n,"player",1,b("Water",2,!0)),n=Z(n,"player",1,b("Water",3,!0)),n=Z(n,"player",2,b("Spirit",2,!0)),n=Z(n,"player",2,b("Spirit",4,!1)),n=Z(n,"opponent",0,b("Metal",5,!0)),n=Z(n,"opponent",1,b("Death",2,!0)),n=Z(n,"opponent",1,b("Death",4,!0)),n=Z(n,"opponent",2,b("Fire",3,!1)),n.player.deck=[b("Water",0,!0),b("Water",4,!0),b("Spirit",0,!0),b("Spirit",5,!0)],n.opponent.deck=[b("Metal",3,!0),b("Death",5,!0),b("Fire",1,!0)],n=_e(n),Re(n)}},km={name:"Life Test Playground",description:" All Life cards on hand - test play and flip mechanics",setup:o=>{let n=Ae(o,["Life","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[b("Life",0,!0),b("Life",1,!0),b("Life",2,!0),b("Life",3,!0),b("Life",4,!0),b("Life",5,!0)],n=Z(n,"player",1,b("Water",1,!0)),n=Z(n,"player",1,b("Water",2,!0)),n=Z(n,"player",1,b("Water",3,!0)),n=Z(n,"player",2,b("Spirit",2,!0)),n=Z(n,"player",2,b("Spirit",4,!1)),n=Z(n,"opponent",0,b("Metal",3,!1)),n=Z(n,"opponent",1,b("Death",2,!0)),n=Z(n,"opponent",1,b("Death",4,!1)),n=Z(n,"opponent",2,b("Fire",5,!1)),n.player.deck=[b("Water",0,!0),b("Water",3,!0),b("Water",4,!0),b("Spirit",0,!0),b("Spirit",1,!0),b("Spirit",2,!0),b("Spirit",3,!0),b("Spirit",4,!0)],n.opponent.deck=[b("Metal",1,!0),b("Death",3,!0),b("Fire",2,!0)],n=_e(n),Re(n)}},Nm={name:"Light Test Playground",description:" All Light cards on hand - burn away the dark",setup:o=>{let n=Ae(o,["Light","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[b("Light",0,!0),b("Light",1,!0),b("Light",2,!0),b("Light",3,!0),b("Light",4,!0),b("Light",5,!0)],n=Z(n,"opponent",0,b("Fire",3,!1)),n=Z(n,"opponent",1,b("Metal",4,!1)),n=Z(n,"opponent",2,b("Death",5,!0)),n=Z(n,"player",1,b("Water",2,!1)),n=Z(n,"player",1,b("Water",3,!1)),n=Z(n,"player",1,b("Water",4,!1)),n=Z(n,"player",0,b("Spirit",1,!0)),n=Z(n,"player",0,b("Spirit",2,!1)),n=Z(n,"player",2,b("Spirit",5,!1)),n.player.deck=[b("Water",0,!0),b("Water",1,!0),b("Spirit",0,!0),b("Spirit",3,!0),b("Spirit",4,!0)],n.opponent.hand=[b("Metal",1,!0),b("Death",2,!0),b("Fire",3,!0),b("Metal",0,!0)],n=_e(n),Re(n)}},Fm={name:"Death-2 Uncover Interrupt - Turn Wechsel Test",description:"Death-2 lscht  Darkness-4 uncovered  Opponent shiftet  Turn muss zu Opponent wechseln",setup:o=>{let n=Ae(o,["Death","Fire","Hate"],["Water","Darkness","Spirit"],"player","action");return n.player.hand=[b("Death",2,!0),b("Fire",1,!0),b("Hate",1,!0)],n=Z(n,"player",0,b("Fire",0,!1)),n=Z(n,"opponent",1,b("Darkness",4,!0)),n=Z(n,"opponent",1,b("Darkness",1,!0)),n=Z(n,"opponent",0,b("Water",0,!1)),n.opponent.hand=[b("Water",1,!0),b("Spirit",1,!0)],n=_e(n),Re(n)}},qm={name:"Apathy-5 Uncover - darf nur einmal triggern",description:"Hate-0 lscht Apathy-0  Apathy-5 uncovered  darf nur 1x triggern",setup:o=>{let n=Ae(o,["Hate","Fire","Death"],["Apathy","Darkness","Plague"],"player","action");return n.player.hand=[b("Hate",0,!0),b("Fire",2,!0),b("Death",2,!0)],n=Z(n,"opponent",0,b("Apathy",5,!0)),n=Z(n,"opponent",0,b("Apathy",4,!0)),n.opponent.hand=[b("Darkness",1,!0),b("Apathy",1,!0),b("Darkness",2,!0)],n=_e(n),Re(n)}},Um={name:"Psychic-1 facedown flip darkness 2 test",description:"Psychic-1 facedown, darkness-2 flippt Karte nur noch facedown bug",setup:o=>{let n=Ae(o,["Frost","Gravity","Plague"],["Psychic","Darkness","Speed"],"player","action");return n.player.hand=[b("Darkness",1,!0),b("Darkness",2,!0),b("Speed",3,!0)],n=Z(n,"opponent",0,b("Frost",0,!1)),n=Z(n,"opponent",1,b("Gravity",6,!1)),n=Z(n,"player",0,b("Psychic",4,!1)),n=Z(n,"player",1,b("Psychic",1,!1)),n.opponent.hand=[b("Gravity",1,!0)],n=_e(n),Re(n)}},$m={name:"Speed Test Playground",description:" All Speed cards on hand - swift and adaptive",setup:o=>{let n=Ae(o,["Speed","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[b("Speed",0,!0),b("Speed",1,!0),b("Speed",2,!0),b("Speed",3,!0),b("Speed",4,!0),b("Speed",5,!0)],n=Z(n,"player",0,b("Water",2,!0)),n=Z(n,"player",1,b("Spirit",3,!0)),n=Z(n,"opponent",0,b("Metal",3,!1)),n=Z(n,"opponent",1,b("Death",4,!1)),n=Z(n,"opponent",2,b("Fire",2,!0)),n=Z(n,"player",2,b("Spirit",5,!0)),n=Z(n,"player",2,b("Spirit",4,!0)),n=_e(n),Re(n)}},Om={name:"Metal Test Playground",description:" All Metal cards on hand - unyielding defense",setup:o=>{let n=Ae(o,["Metal","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[b("Metal",0,!0),b("Metal",1,!0),b("Metal",2,!0),b("Metal",3,!0),b("Metal",5,!0),b("Metal",6,!0)],n=Z(n,"opponent",0,b("Metal",3,!1)),n=Z(n,"opponent",1,b("Death",4,!0)),n=Z(n,"player",1,b("Water",3,!0)),n=Z(n,"opponent",2,b("Fire",0,!0)),n=Z(n,"opponent",2,b("Fire",1,!0)),n=Z(n,"opponent",2,b("Fire",2,!0)),n=Z(n,"opponent",2,b("Fire",3,!0)),n=Z(n,"opponent",2,b("Fire",4,!0)),n=Z(n,"opponent",2,b("Fire",5,!0)),n=Z(n,"player",2,b("Spirit",3,!0)),n=Z(n,"player",2,b("Spirit",2,!0)),n=_e(n),Re(n)}},Lm={name:"Plague Test Playground",description:" All Plague cards on hand - spread suffering",setup:o=>{let n=Ae(o,["Plague","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[b("Plague",0,!0),b("Plague",1,!0),b("Plague",2,!0),b("Plague",3,!0),b("Plague",4,!0),b("Plague",5,!0)],n.opponent.hand=[b("Fire",2,!0),b("Death",3,!0),b("Water",1,!0)],n.player.lanes[0]=[b("Spirit",2,!0)],n.player.lanes[1]=[],n.player.lanes[2]=[],n.opponent.lanes[0]=[b("Metal",1,!0)],n.opponent.lanes[1]=[b("Death",2,!1)],n.opponent.lanes[2]=[b("Fire",3,!0)],n=_e(n),Re(n)}},Mm={name:"Love Test Playground",description:" All Love cards on hand - share the love",setup:o=>{let n=Ae(o,["Love","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[b("Love",1,!0),b("Love",2,!0),b("Love",3,!0),b("Love",4,!0),b("Love",5,!0),b("Love",6,!0)],n.opponent.hand=[b("Fire",2,!0),b("Death",3,!0),b("Water",1,!0),b("Metal",4,!0)],n.player.lanes[0]=[b("Spirit",2,!0)],n.player.lanes[1]=[],n.player.lanes[2]=[],n.opponent.lanes[0]=[b("Metal",1,!0)],n.opponent.lanes[1]=[b("Death",2,!1)],n.opponent.lanes[2]=[b("Fire",3,!0)],n=_e(n),Re(n)}},Im={name:"Psychic Test Playground",description:" All Psychic cards on hand - read minds and control",setup:o=>{let n=Ae(o,["Psychic","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[b("Psychic",0,!0),b("Psychic",1,!0),b("Psychic",2,!0),b("Psychic",3,!0),b("Psychic",4,!0),b("Psychic",5,!0)],n.opponent.hand=[b("Fire",2,!0),b("Death",3,!0),b("Water",1,!0),b("Metal",4,!0)],n.player.lanes[0]=[b("Spirit",2,!0)],n.player.lanes[1]=[],n.player.lanes[2]=[],n.opponent.lanes[0]=[b("Metal",1,!0)],n.opponent.lanes[1]=[b("Death",2,!1)],n.opponent.lanes[2]=[b("Fire",3,!0)],n=_e(n),Re(n)}},Pm={name:" Gravity-2 AI Single Card Bug",description:"AI spielt Gravity-2  Flip  Shift  Turn endet (NUR 1 Karte!)",setup:o=>{let n=Ae(o,["Hate","Fire","Water"],["Gravity","Death","Metal"],"opponent","action");return n.opponent.hand=[b("Gravity",2,!0),b("Death",1,!0),b("Metal",3,!0)],n=Z(n,"player",1,b("Hate",5,!0)),n=Z(n,"player",1,b("Hate",4,!0)),n=Z(n,"player",0,b("Fire",2,!0)),n=Z(n,"player",2,b("Water",3,!0)),n=_e(n),Re(n)}},Hm={name:"Speed-3 End-Effekt Softlock Test",description:"Speed-3 als einzige uncovered Karte sollte sich selbst im End-Effekt shiften knnen",setup:o=>{let n=Ae(o,["Fire","Water","Death"],["Speed","Gravity","Light"],"opponent","end");return n.player.hand=[b("Fire",1,!0),b("Water",2,!0),b("Death",0,!0)],n=Z(n,"player",0,b("Fire",3,!0)),n=Z(n,"player",1,b("Water",1,!0)),n=Z(n,"opponent",0,b("Speed",3,!0)),n.opponent.hand=[b("Gravity",1,!0),b("Light",2,!0)],n=_e(n),Re(n)}},Bm={name:"Uncover nach Delete All in Lane Test",description:"Death-2 lscht alle 1/2er  Karte darunter wird uncovered  Effekt triggert",setup:o=>{let n=Ae(o,["Death","Fire","Water"],["Fire","Spirit","Light"],"player","action");return n.player.hand=[b("Death",2,!0),b("Fire",3,!0),b("Water",4,!0)],n=Z(n,"opponent",0,b("Fire",5,!0)),n=Z(n,"opponent",0,b("Fire",2,!0)),n=Z(n,"player",0,b("Fire",4,!0)),n=Z(n,"player",1,b("Water",3,!0)),n=Z(n,"opponent",1,b("Spirit",2,!0)),n=_e(n),Re(n)}},zm={name:"Mehrfach-Uncover nach Delete All Test",description:"Death-2 lscht bei beiden Spielern  beide Karten darunter werden uncovered",setup:o=>{let n=Ae(o,["Death","Water","Spirit"],["Fire","Light","Gravity"],"player","action");return n.player.hand=[b("Death",2,!0),b("Spirit",3,!0)],n.opponent.hand=[b("Fire",3,!0),b("Light",5,!0)],n=Z(n,"player",0,b("Water",5,!0)),n=Z(n,"player",0,b("Water",1,!0)),n=Z(n,"opponent",0,b("Fire",5,!0)),n=Z(n,"opponent",0,b("Fire",2,!0)),n=_e(n),Re(n)}},Vm={name:"Life-1 Uncover  Double Flip Bug",description:"Death-1 Start lscht  Life-1 uncovered  BEIDE Flips mssen ausgefhrt werden",setup:o=>{let n=Ae(o,["Death","Fire","Water"],["Life","Metal","Spirit"],"player","start");return n.player.hand=[b("Fire",2,!0)],n.opponent.hand=[b("Metal",3,!0),b("Spirit",2,!0)],n=Z(n,"player",0,b("Death",1,!0)),n=Z(n,"opponent",0,b("Life",1,!0)),n=Z(n,"opponent",0,b("Metal",0,!0)),n=Z(n,"player",1,b("Water",1,!0)),n=Z(n,"opponent",1,b("Metal",1,!0)),n=Z(n,"opponent",2,b("Spirit",0,!0)),n=_e(n),Re(n)}},Gm=[Jh,em,tm,nm,om,am,lm,rm,cm,im,sm,dm,um,fm,pm,hm,mm,gm,ym,vm,_m,e0,t0,n0,o0,a0,l0,xm,wm,Cm,bm,Sm,Em,jm,Am,Rm,Dm,Tm,km,Nm,Fm,qm,Um,$m,Om,Lm,Mm,Im,Pm,Hm,Bm,zm,Vm],r0=Object.freeze(Object.defineProperty({__proto__:null,allScenarios:Gm,scenario10_Hate1Interrupt:rm,scenario11_Darkness1HateChain:cm,scenario12_Water4TurnEnd:im,scenario13_Psychic3ShiftTest:sm,scenario14_Death1UncoverTest:dm,scenario15_Gravity2ShiftInterrupt:um,scenario16_Hate2PlayerPlays:fm,scenario171_Hate2AIPlays:hm,scenario17_Hate2AIPlays:pm,scenario18_Hate2SelfDelete:mm,scenario19_Hate2MultipleTies:gm,scenario1_Psychic3Uncover:Jh,scenario20_Hate2FaceDown:ym,scenario21_Hate2AIValidation:vm,scenario22_Hate2AIPlaysOpen:_m,scenario29_FireCustomConditional:xm,scenario2_Psychic4EndEffect:em,scenario30_AnarchyCustomPlayground:wm,scenario31_DarkCustPlayground:Cm,scenario32_ApathyCustomPlayground:bm,scenario33_DeathCustomPlayground:Sm,scenario34_WaterCustomPlayground:Em,scenario35_SpiritCustomPlayground:jm,scenario36_ChaosCustomPlayground:Am,scenario37_GravityCustomPlayground:Rm,scenario38_FrostCustomPlayground:Dm,scenario39_HateCustomPlayground:Tm,scenario3_Spirit3EndPhase:tm,scenario40_LifeCustomPlayground:km,scenario41_LightCustomPlayground:Nm,scenario42_Death2UncoverInterruptTurn:Fm,scenario43_Apathy5DoubleUncover:qm,scenario44_Psychic1Darkness2Test:Um,scenario45_SpeedCustomPlayground:$m,scenario46_MetalCustomPlayground:Om,scenario47_PlagueCustomPlayground:Lm,scenario48_LoveCustomPlayground:Mm,scenario49_PsychicCustomPlayground:Im,scenario4_Plague2Actor:nm,scenario50_Gravity2SingleCardBug:Pm,scenario51_Speed3EndEffectSoftlock:Hm,scenario52_UncoverAfterBulkDelete:Bm,scenario53_MultiUncoverAfterBulkDelete:zm,scenario54_Life1UncoverDoubleFlip:Vm,scenario5_Darkness1Interrupt:om,scenario8_Plague4Owner:am,scenario9_Water:lm},Symbol.toStringTag,{value:"Module"})),c0=({onLoadScenario:o,onSkipCoinFlip:n,onForceWin:r,onForceLose:s})=>{const[i,d]=ce.useState(!1);return i?l.jsxs("div",{style:{position:"fixed",top:"20px",left:"20px",width:"400px",maxHeight:"600px",backgroundColor:"#2c2c2c",border:"2px solid #ff6b6b",borderRadius:"8px",padding:"20px",zIndex:9999,overflowY:"auto",color:"white",fontFamily:"monospace"},children:[l.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"20px"},children:[l.jsx("h3",{style:{margin:0},children:" Debug Panel"}),l.jsx("button",{onClick:()=>d(!1),style:{backgroundColor:"transparent",border:"none",color:"white",cursor:"pointer",fontSize:"20px"},children:""})]}),l.jsx("div",{style:{marginBottom:"15px",fontSize:"12px",color:"#aaa"},children:"Lade vordefinierte Test-Szenarien zum Testen der Actor/Owner-Fixes."}),l.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:Gm.map((f,m)=>l.jsxs("div",{style:{backgroundColor:"#1a1a1a",padding:"12px",borderRadius:"5px",border:"1px solid #444"},children:[l.jsx("div",{style:{fontWeight:"bold",marginBottom:"5px",color:"#4ecdc4"},children:f.name}),l.jsx("div",{style:{fontSize:"11px",color:"#bbb",marginBottom:"10px"},children:f.description}),l.jsx("button",{onClick:()=>{n&&n(),o(f.setup),d(!1)},style:{padding:"6px 12px",backgroundColor:"#4ecdc4",color:"#1a1a1a",border:"none",borderRadius:"3px",cursor:"pointer",fontWeight:"bold",fontSize:"12px"},children:"Load Scenario"})]},m))}),(r||s)&&l.jsxs("div",{style:{marginTop:"20px",paddingTop:"15px",borderTop:"1px solid #444",display:"flex",gap:"10px",justifyContent:"center"},children:[r&&l.jsx("button",{onClick:()=>{r(),d(!1)},style:{padding:"10px 20px",backgroundColor:"#4ecdc4",color:"#1a1a1a",border:"none",borderRadius:"5px",cursor:"pointer",fontWeight:"bold",fontSize:"14px"},children:" Force Win"}),s&&l.jsx("button",{onClick:()=>{s(),d(!1)},style:{padding:"10px 20px",backgroundColor:"#ff6b6b",color:"white",border:"none",borderRadius:"5px",cursor:"pointer",fontWeight:"bold",fontSize:"14px"},children:" Force Lose"})]}),l.jsx("div",{style:{marginTop:"20px",fontSize:"11px",color:"#666",textAlign:"center"},children:"Drcke ESC oder klicke  zum Schlieen"})]}):l.jsx("button",{onClick:()=>d(!0),style:{position:"fixed",top:"20px",left:"20px",padding:"10px 20px",backgroundColor:"#ff6b6b",color:"white",border:"none",borderRadius:"5px",cursor:"pointer",fontWeight:"bold",zIndex:9999,fontSize:"14px"},children:" DEBUG"})},i0=(o,n)=>{if(!n)return null;for(const r of["player","opponent"])for(const s of o[r].lanes){const i=s.find(d=>d.id===n);if(i)return{card:i,owner:r}}return null},s0=new Set(["discard","select_card_from_hand_to_play","select_card_from_hand_to_give","select_card_from_hand_to_reveal","plague_2_player_discard","select_cards_from_hand_to_discard_for_fire_4","select_cards_from_hand_to_discard_for_hate_1"]);function d0({onBack:o,onEndGame:n,playerProtocols:r,opponentProtocols:s,difficulty:i,useControlMechanic:d,startingPlayer:f="player"}){var _a,mr,gr,dl;const[m,h]=ce.useState(null),[p,y]=ce.useState(!0),{startGame:v,endGame:x,trackPlayerCoinFlip:_,trackPlayerRearrange:w}=J_(r,i,d),U=ce.useCallback((ge,Ce,qe)=>{h(ge),y(!1),_(Ce,qe)},[_]),C=ce.useCallback(()=>{h("player"),y(!1),v()},[v]);ce.useEffect(()=>{!p&&m&&v()},[p,m,v]);const A=ce.useCallback((ge,Ce)=>{const qe=Ce.player.compiled.filter(it=>it).length;x(ge,Ce.stats.player,qe),n(ge,Ce)},[x,n]),{gameState:S,selectedCard:N,setSelectedCard:q,playSelectedCard:D,fillHand:E,discardCardFromHand:j,compileLane:I,resolveActionWithCard:k,resolveActionWithLane:L,selectHandCardForAction:G,resolveActionWithHandCard:T,skipAction:Q,resolveOptionalDrawPrompt:X,resolveDeath1Prompt:M,resolveLove1Prompt:$,resolvePlague2Discard:W,resolvePlague4Flip:P,resolveFire3Prompt:ne,resolveOptionalDiscardCustomPrompt:F,resolveOptionalEffectPrompt:z,resolveFire4Discard:H,resolveHate1Discard:V,resolveLight2Prompt:Y,resolveRevealBoardCardPrompt:B,resolveRearrangeProtocols:J,resolveSpirit1Prompt:ee,resolveSpirit3Prompt:he,resolveSwapProtocols:ye,resolveSpeed3Prompt:me,resolvePsychic4Prompt:xe,resolveControlMechanicPrompt:Ee,resolveCustomChoice:Ue,setupTestScenario:Xe}=R_(r,s,A,i,d,m??"player",w),[Se,Me]=ce.useState(null),[tt,Pt]=ce.useState([]),[Qt,Te]=ce.useState(!1),[He,Ze]=ce.useState([]),Je=ce.useRef(S.log.length),[en,vt]=ce.useState(!1),[Ct,mt]=ce.useState(!1),[Ht,_t]=ce.useState(null),[ho,Bo]=ce.useState(!1),[ya,ue]=ce.useState(0),we=ce.useRef(null),Fe=ce.useRef(S);ce.useEffect(()=>{Fe.current=S},[S]);const De=()=>{const ge=ya+1;if(ue(ge),ge>=5){Bo(Ce=>!Ce),ue(0),we.current&&(clearTimeout(we.current),we.current=null);return}we.current&&clearTimeout(we.current),we.current=setTimeout(()=>{ue(0),we.current=null},2e3)},Oe=ce.useCallback(()=>{console.log("Debug: Forcing player win via DebugPanel."),A("player",S)},[A,S]),at=ce.useCallback(()=>{console.log("Debug: Forcing player loss via DebugPanel."),A("opponent",S)},[A,S]),We=ce.useMemo(()=>{if(S.lastPlayedCardId){const ge=i0(S,S.lastPlayedCardId);if(ge){const Ce=ge.owner==="player"||ge.card.isFaceUp;return{card:ge.card,showContents:Ce}}}return null},[S.lastPlayedCardId,S.player.lanes,S.opponent.lanes]),ft=Se||We;ce.useEffect(()=>{S.log.length>Je.current&&S.log.slice(Je.current).forEach(Ce=>{if(Ce.message!=="Game Started."){const qe={message:Ce.message,player:Ce.player,id:Ge()};Ze(it=>[...it,qe]),setTimeout(()=>{Ze(it=>it.filter(St=>St.id!==qe.id))},5e3)}}),Je.current=S.log.length},[S.log]),ce.useEffect(()=>{var Ce,qe,it,St,Zt;!(((Ce=S.actionRequired)==null?void 0:Ce.type)==="discard"&&((qe=S.actionRequired)==null?void 0:qe.variableCount))&&((it=S.actionRequired)==null?void 0:it.type)!=="plague_2_player_discard"&&((St=S.actionRequired)==null?void 0:St.type)!=="select_cards_from_hand_to_discard_for_fire_4"&&((Zt=S.actionRequired)==null?void 0:Zt.type)!=="select_cards_from_hand_to_discard_for_hate_1"&&Pt([])},[S.actionRequired]),ce.useEffect(()=>{var ge,Ce;vt(((ge=S.actionRequired)==null?void 0:ge.type)==="prompt_rearrange_protocols"&&S.actionRequired.actor==="player"),mt(((Ce=S.actionRequired)==null?void 0:Ce.type)==="prompt_swap_protocols"&&S.actionRequired.actor==="player")},[S.actionRequired]),ce.useEffect(()=>{const ge=Ce=>{Ce.ctrlKey&&Ce.shiftKey&&(Ce.preventDefault(),Ce.key.toLowerCase()==="d"?(console.log("Debug: Toggling debug button visibility."),Bo(qe=>!qe)):Ce.key.toLowerCase()==="w"?(console.log("Debug: Forcing player win."),n("player",S)):Ce.key.toLowerCase()==="o"?(console.log("Debug: Forcing opponent win."),n("opponent",S)):Ce.key.toLowerCase()==="p"?(console.log("Debug: Setting up Speed-0 interrupt scenario."),Xe("speed-0-interrupt")):Ce.key.toLowerCase()==="l"?(console.log("Debug: Setting up Speed-1 discard trigger scenario."),Xe("speed-1-trigger")):Ce.key.toLowerCase()==="f"?(console.log("Debug: Setting up Fire On-Cover test scenario."),Xe("fire-oncover-test")):Ce.key.toLowerCase()==="s"?(console.log("Debug: Setting up Speed-2 + Control test scenario."),Xe("speed-2-control-test")):Ce.key.toLowerCase()==="u"&&(console.log("Debug: Setting up Death-1 Uncover test scenario."),Nv(()=>Promise.resolve().then(()=>r0),void 0).then(qe=>{Xe(qe.scenario14_Death1UncoverTest.setup)})))};return window.addEventListener("keydown",ge),()=>{window.removeEventListener("keydown",ge)}},[S,n,Xe]);const sn=ge=>{const Ce=Fe.current;if(Ce.animationState)return;const{actionRequired:qe,turn:it,phase:St,compilableLanes:Zt,player:lt,opponent:Pn}=Ce;if(it==="player"&&St==="compile"&&Zt.includes(ge)){if(qe){console.warn("Compile click blocked by pending action:",qe);return}I(ge);return}if(qe&&qe.actor==="player"&&["select_lane_for_shift","select_lane_for_shift_all","shift_flipped_card_optional","select_lane_for_play","select_lane_for_delete","select_lane_for_death_2","select_lane_for_life_3_play","select_lane_to_shift_revealed_card_for_light_2","select_lane_to_shift_revealed_board_card_custom","select_lane_to_shift_cards_for_light_3","select_lane_for_water_3","select_lane_for_metal_3_delete","select_lane_for_delete_all","select_lane_for_return"].includes(qe.type)){L(ge);return}const zo=Pn.lanes.flat().some(dn=>dn.isFaceUp&&dn.protocol==="Psychic"&&dn.value===1),tn=Pn.lanes[ge],yo=tn.length>0&&tn[tn.length-1].isFaceUp&&tn[tn.length-1].protocol==="Plague"&&tn[tn.length-1].value===0;if(N&&St==="action"&&!qe&&lt.hand.some(dn=>dn.id===N)&&!yo){const dn=lt.hand.find(zt=>zt.id===N),yr=lt.lanes.flat().some(zt=>zt.isFaceUp&&zt.protocol==="Spirit"&&zt.value===1),Ic=lt.lanes.some((zt,Go)=>{if(zt.length===0)return!1;const Yo=zt[zt.length-1];return Yo.isFaceUp&&Yo.protocol==="Chaos"&&Yo.value===3}),xa=[...lt.lanes.flat(),...Pn.lanes.flat()].some(zt=>zt.isFaceUp&&zt.protocol==="Anarchy"&&zt.value===1),wa=Oc(Ce),qn=Lc(Ce,"player",ge);let Vo;xa||wa?Vo=dn.protocol!==lt.protocols[ge]&&dn.protocol!==Pn.protocols[ge]&&!zo:Vo=(yr||qn||Ic||dn.protocol===lt.protocols[ge]||dn.protocol===Pn.protocols[ge])&&!zo,D(ge,Vo),Me(null);return}N&&(q(null),Me(null))},Bt=ge=>{const Ce=Fe.current;if(Ce.animationState||!N)return;const{phase:qe,actionRequired:it,player:St}=Ce;qe!=="action"||it||!St.hand.some(Zt=>Zt.id===N)||(D(ge,!1),Me(null))},mo=ge=>{const Ce=Fe.current;if(!Ce.animationState){if(Ce.actionRequired){if(Ce.actionRequired.type==="discard"&&Ce.actionRequired.actor==="player")if(Ce.actionRequired.variableCount){Pt(qe=>qe.includes(ge.id)?qe.filter(it=>it!==ge.id):[...qe,ge.id]);return}else{j(ge.id);return}if(Ce.actionRequired.type==="select_card_from_hand_to_play"){G(ge.id);return}if(Ce.actionRequired.type==="select_card_from_hand_to_give"||Ce.actionRequired.type==="select_card_from_hand_to_reveal"){T(ge.id);return}if(Ce.actionRequired.type==="plague_2_player_discard"||Ce.actionRequired.type==="select_cards_from_hand_to_discard_for_fire_4"||Ce.actionRequired.type==="select_cards_from_hand_to_discard_for_hate_1"){Pt(qe=>qe.includes(ge.id)?qe.filter(it=>it!==ge.id):[...qe,ge.id]);return}return}Ce.turn!=="player"||Ce.phase!=="action"&&Ce.phase!=="compile"||(ge.id===N?(q(null),Me(null)):(q(ge.id),Me({card:ge,showContents:!0})))}},sl=(ge,Ce,qe)=>{const it=Fe.current;if(it.animationState)return;const{actionRequired:St,turn:Zt,phase:lt,compilableLanes:Pn}=it;if(Zt==="player"&&lt==="compile"&&Pn.includes(qe)){sn(qe);return}if(Zt==="player"&&!St&&N&&lt==="action"){sn(qe);return}if(St&&St.actor==="player"&&(St.type==="select_own_highest_card_to_delete_for_hate_2"||St.type==="select_opponent_highest_card_to_delete_for_hate_2")&&Uc(ge,it)){k(ge.id);return}if(Uc(ge,it))k(ge.id);else if(N)q(null),Me(null);else{const zo=Ce==="player"||ge.isFaceUp;Me({card:ge,showContents:zo})}},Fn=ge=>{N||Me({card:ge,showContents:!0})},bt=(ge,Ce)=>{if(!N){const qe=Ce==="player"||ge.isFaceUp;Me({card:ge,showContents:qe})}},va=()=>{N||Me(null)},hr=ge=>{!N&&!S.actionRequired&&Me({card:ge,showContents:ge.isRevealed||!1})},Mc=()=>{if(!ft)return null;const{card:ge,showContents:Ce}=ft;return l.jsx(Rt,{card:ge,isFaceUp:Ce})},In=S.turn==="player"&&!S.actionRequired&&S.phase==="compile"&&S.compilableLanes.length>0,Ot=((_a=S.actionRequired)==null?void 0:_a.sourceCardId)??null,Xt=ce.useMemo(()=>{var ge;return(ge=S.actionRequired)!=null&&ge.actor?S.actionRequired.actor==="player"?"action-required-player":"action-required-opponent":""},[S.actionRequired]),go=ce.useMemo(()=>{const ge=S.actionRequired;return ge&&ge.actor==="player"?s0.has(ge.type)?"":"hand-in-background":""},[S.actionRequired]);return l.jsxs("div",{className:"screen game-screen",children:[Ht&&l.jsx(M_,{player:Ht,playerState:S[Ht],onClose:()=>_t(null),difficulty:i}),en&&((mr=S.actionRequired)==null?void 0:mr.type)==="prompt_rearrange_protocols"&&l.jsx(O_,{gameState:S,targetPlayer:S.actionRequired.target,onConfirm:ge=>{var Ce,qe;((Ce=S.actionRequired)==null?void 0:Ce.sourceCardId)==="CONTROL_MECHANIC"&&((qe=S.actionRequired)!=null&&qe.actor)&&w(S.actionRequired.actor),J(ge),vt(!1)}}),Ct&&((gr=S.actionRequired)==null?void 0:gr.type)==="prompt_swap_protocols"&&l.jsx(L_,{gameState:S,targetPlayer:S.actionRequired.target,onConfirm:ge=>{ye(ge),mt(!1)}}),l.jsx("div",{className:"toaster-container",children:He.map(ge=>l.jsx($_,{message:ge.message,player:ge.player},ge.id))}),Qt&&l.jsx(U_,{log:S.log,onClose:()=>Te(!1)}),l.jsx("button",{className:"btn log-button",onClick:()=>Te(!0),children:"Log"}),l.jsxs("div",{className:"game-screen-layout",children:[l.jsxs("div",{className:"game-preview-container",children:[l.jsx("h2",{onClick:De,style:{cursor:"pointer",userSelect:"none"},title:"Click 5 times to toggle debug mode",children:"Mainframe"}),l.jsx(N_,{gameState:S,turn:((dl=S.actionRequired)==null?void 0:dl.actor)||S.turn,animationState:S.animationState,difficulty:i,onPlayerClick:()=>_t("player"),onOpponentClick:()=>_t("opponent")}),l.jsx("div",{className:"preview-card-area",children:Mc()}),l.jsx("button",{className:"btn btn-back",onClick:o,children:"Back"})]}),l.jsxs("div",{className:"game-main-area",children:[In&&l.jsx("div",{className:"compile-prompt-container",children:l.jsx("h3",{children:"Select a Protocol to Compile"})}),l.jsx(D_,{gameState:S,onLanePointerDown:sn,onPlayFaceDown:Bt,selectedCardId:N,onCardPointerDown:sl,onCardPointerEnter:bt,onCardPointerLeave:va,onOpponentHandCardPointerEnter:hr,onOpponentHandCardPointerLeave:va,sourceCardId:Ot}),l.jsxs("div",{className:"player-action-area",children:[l.jsx(T_,{gameState:S,onFillHand:E,onSkipAction:Q,onResolveOptionalDrawPrompt:X,onResolveDeath1Prompt:M,onResolveLove1Prompt:$,onResolvePlague2Discard:W,onResolvePlague4Flip:P,onResolveFire3Prompt:ne,onResolveOptionalDiscardCustomPrompt:F,onResolveOptionalEffectPrompt:z,onResolveSpeed3Prompt:me,onResolveFire4Discard:H,onResolveHate1Discard:V,onResolveLight2Prompt:Y,onResolveRevealBoardCardPrompt:B,onResolvePsychic4Prompt:xe,onResolveSpirit1Prompt:ee,onResolveSpirit3Prompt:he,onResolveControlMechanicPrompt:Ee,onResolveCustomChoice:Ue,selectedCardId:N,multiSelectedCardIds:tt,actionRequiredClass:Xt}),l.jsx("div",{className:`player-hand-area ${go}`,children:S.player.hand.map(ge=>{var qe;const Ce=((qe=S.actionRequired)==null?void 0:qe.type)==="select_lane_for_play"?ge.id===S.actionRequired.cardInHandId:ge.id===N;return l.jsx(Rt,{card:ge,isFaceUp:!0,onPointerDown:()=>mo(ge),onPointerEnter:()=>Fn(ge),isSelected:Ce,isMultiSelected:tt.includes(ge.id),animationState:S.animationState,additionalClassName:"in-hand"},ge.id)})})]})]})]}),p&&l.jsx(I_,{onComplete:U}),ho&&l.jsx(c0,{onLoadScenario:Xe,onSkipCoinFlip:C,onForceWin:Oe,onForceLose:at})]})}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function u0({onPlayAgain:o,winner:n,finalState:r,difficulty:s}){if(!r)return l.jsxs("div",{className:"screen",children:[l.jsx("h1",{children:"Loading Results..."}),l.jsx("button",{className:"btn",onClick:o,children:"Back to Menu"})]});const i=n==="player",d=(f,m)=>{let h=[f];return m&&h.push("compiled"),h.join(" ")};return l.jsx("div",{className:`screen results-screen ${i?"victory":"defeat"}`,children:l.jsxs("div",{className:"results-screen-content",children:[l.jsxs("header",{className:"results-header",children:[l.jsx("h1",{children:i?"VICTORY":"DEFEAT"}),l.jsx("p",{children:i?"System compiled successfully.":"Critical error in the mainframe."})]}),l.jsxs("div",{className:"results-body",children:[l.jsxs("div",{className:"final-score-section",children:[l.jsx("h3",{children:"Final Score"}),l.jsxs("h4",{className:"results-label results-opponent-label",children:["Opponent (",s.charAt(0).toUpperCase()+s.slice(1),")"]}),l.jsxs("div",{className:"protocol-bars-container",children:[l.jsx("div",{className:"protocol-bar opponent-bar",children:r.opponent.protocols.map((f,m)=>l.jsxs("div",{className:d("protocol-display",r.opponent.compiled[m]),children:[l.jsx("span",{className:"protocol-name",children:f}),l.jsx("span",{className:"protocol-value",children:r.opponent.laneValues[m]})]},`opp-proto-${f}-${m}`))}),l.jsx("div",{className:"protocol-bar player-bar",children:r.player.protocols.map((f,m)=>l.jsxs("div",{className:d("protocol-display",r.player.compiled[m]),children:[l.jsx("span",{className:"protocol-name",children:f}),l.jsx("span",{className:"protocol-value",children:r.player.laneValues[m]})]},`player-proto-${f}-${m}`))})]}),l.jsx("h4",{className:"results-label results-player-label",children:"Player"})]}),l.jsxs("div",{className:"stats-section",children:[l.jsx("h3",{children:"Statistics"}),l.jsxs("div",{className:"stats-grid",children:[l.jsxs("div",{className:"stat-item",children:[l.jsx("span",{className:"stat-item-label",children:"Cards Played"}),l.jsx("span",{className:"stat-item-value opponent",children:r.stats.opponent.cardsPlayed}),l.jsx("span",{className:"stat-item-value player",children:r.stats.player.cardsPlayed})]}),l.jsxs("div",{className:"stat-item",children:[l.jsx("span",{className:"stat-item-label",children:"Cards Drawn"}),l.jsx("span",{className:"stat-item-value opponent",children:r.stats.opponent.cardsDrawn}),l.jsx("span",{className:"stat-item-value player",children:r.stats.player.cardsDrawn})]}),l.jsxs("div",{className:"stat-item",children:[l.jsx("span",{className:"stat-item-label",children:"Cards Discarded"}),l.jsx("span",{className:"stat-item-value opponent",children:r.stats.opponent.cardsDiscarded}),l.jsx("span",{className:"stat-item-value player",children:r.stats.player.cardsDiscarded})]}),l.jsxs("div",{className:"stat-item",children:[l.jsx("span",{className:"stat-item-label",children:"Cards Deleted"}),l.jsx("span",{className:"stat-item-value opponent",children:r.stats.opponent.cardsDeleted}),l.jsx("span",{className:"stat-item-value player",children:r.stats.player.cardsDeleted})]}),l.jsxs("div",{className:"stat-item",children:[l.jsx("span",{className:"stat-item-label",children:"Cards Flipped"}),l.jsx("span",{className:"stat-item-value opponent",children:r.stats.opponent.cardsFlipped}),l.jsx("span",{className:"stat-item-value player",children:r.stats.player.cardsFlipped})]}),l.jsxs("div",{className:"stat-item",children:[l.jsx("span",{className:"stat-item-label",children:"Cards Shifted"}),l.jsx("span",{className:"stat-item-value opponent",children:r.stats.opponent.cardsShifted}),l.jsx("span",{className:"stat-item-value player",children:r.stats.player.cardsShifted})]})]})]})]}),l.jsx("button",{className:"btn",onClick:o,children:"Play Again"})]})})}function f0({onBack:o}){const[n,r]=ce.useState(0);ce.useEffect(()=>{ir(),r(C=>C+1)},[]);const s=ce.useMemo(()=>{console.log("[Card Library] Loading cards, refreshKey:",n);const C=ud(),A=Ho(),S=ma(),N=new Set(S.filter(D=>rl(D)).map(D=>D.name)),q=A.filter(D=>N.has(D.protocol)||C);return console.log("[Card Library] Total cards:",q.length,"(custom enabled:",C,")"),q},[n]),i=ce.useMemo(()=>{const C=new Set(s.map(A=>A.protocol));return Array.from(C).sort()},[s]),[d,f]=ce.useState(null),m=ce.useMemo(()=>{const C=new Set(s.map(A=>A.category));return Array.from(C).sort()},[s]),[h,p]=ce.useState(()=>new Set(m));ce.useEffect(()=>{s.length>0&&!d&&f(s[0])},[s,d]);const y=C=>{p(A=>{const S=new Set(A);return S.has(C)?S.delete(C):S.add(C),S})},v=C=>{const A=s.find(S=>S.protocol===C);return(A==null?void 0:A.category)||""},x=ce.useMemo(()=>i.filter(C=>{const A=v(C);return h.has(A)}),[i,h,s]),_=ce.useMemo(()=>{const C={};for(const A of s)C[A.protocol]||(C[A.protocol]=[]),C[A.protocol].push(A);for(const A in C)C[A].sort((S,N)=>S.value-N.value);return C},[s]),w=C=>{f(C)},U=()=>{if(!d)return null;const C={...d,id:"preview",isFaceUp:!0};return l.jsx(Rt,{card:C,isFaceUp:!0})};return l.jsxs("div",{className:"screen card-library-screen",children:[l.jsx($c,{title:"Card Library",onBack:o}),l.jsxs("div",{className:"card-library-layout",children:[l.jsxs("div",{className:"game-preview-container",children:[l.jsx("h2",{children:"Card Preview"}),l.jsx("div",{className:"preview-card-area",children:U()})]}),l.jsxs("div",{className:"card-list-container",children:[l.jsx("div",{className:"category-filters",children:m.map(C=>l.jsxs("label",{className:"category-filter-item",children:[l.jsx("input",{type:"checkbox",checked:h.has(C),onChange:()=>y(C)}),l.jsx("span",{children:C})]},C))}),x.map(C=>l.jsxs("div",{className:"protocol-group",children:[l.jsxs("h3",{children:[C,l.jsxs("span",{className:"protocol-category-label",children:[" (",v(C),")"]})]}),l.jsx("div",{className:"protocol-card-grid",children:_[C].map(A=>{const S={...A,id:`${A.protocol}-${A.value}`,isFaceUp:!0};return l.jsx(Rt,{card:S,isFaceUp:!0,additionalClassName:"in-hand",onPointerEnter:()=>w(A),onPointerDown:()=>w(A)},S.id)})})]},C))]})]})]})}function p0({onBack:o}){const n=Kh(),r=G_(n),s=Y_(n),i=W_(n),d=Q_(n),f=X_(n),m=Z_(n),h=K_(n);return l.jsxs("div",{className:"screen statistics-screen",children:[l.jsx($c,{title:"STATISTICS",onBack:o}),l.jsxs("div",{className:"stats-content",children:[l.jsxs("section",{className:"stats-section",children:[l.jsx("h2",{className:"section-title",children:"Overview"}),l.jsxs("div",{className:"stats-grid",children:[l.jsxs("div",{className:"stat-item",children:[l.jsx("span",{className:"stat-label",children:"Games Played"}),l.jsx("span",{className:"stat-value",children:n.global.totalGamesPlayed})]}),l.jsxs("div",{className:"stat-item",children:[l.jsx("span",{className:"stat-label",children:"Win Rate"}),l.jsxs("span",{className:"stat-value",children:[r.toFixed(1),"%"]})]}),l.jsxs("div",{className:"stat-item",children:[l.jsx("span",{className:"stat-label",children:"Games Won"}),l.jsx("span",{className:"stat-value win",children:n.global.totalGamesWon})]}),l.jsxs("div",{className:"stat-item",children:[l.jsx("span",{className:"stat-label",children:"Games Lost"}),l.jsx("span",{className:"stat-value loss",children:n.global.totalGamesLost})]})]})]}),l.jsxs("section",{className:"stats-section",children:[l.jsx("h2",{className:"section-title",children:"Streaks"}),l.jsxs("div",{className:"stats-grid",children:[l.jsxs("div",{className:"stat-item",children:[l.jsx("span",{className:"stat-label",children:"Current Streak"}),l.jsx("span",{className:`stat-value ${n.global.currentStreak>0?"win":n.global.currentStreak<0?"loss":""}`,children:n.global.currentStreak>0?`+${n.global.currentStreak}`:n.global.currentStreak})]}),l.jsxs("div",{className:"stat-item",children:[l.jsx("span",{className:"stat-label",children:"Best Win Streak"}),l.jsx("span",{className:"stat-value win",children:n.global.longestWinStreak})]})]})]}),l.jsxs("section",{className:"stats-section",children:[l.jsx("h2",{className:"section-title",children:"Playtime"}),l.jsxs("div",{className:"stats-grid",children:[l.jsxs("div",{className:"stat-item",children:[l.jsx("span",{className:"stat-label",children:"Total Playtime"}),l.jsx("span",{className:"stat-value",children:cr(n.global.totalPlaytime)})]}),l.jsxs("div",{className:"stat-item",children:[l.jsx("span",{className:"stat-label",children:"Average Game"}),l.jsx("span",{className:"stat-value",children:cr(s)})]}),n.global.fastestWin&&l.jsxs("div",{className:"stat-item",children:[l.jsx("span",{className:"stat-label",children:"Fastest Win"}),l.jsx("span",{className:"stat-value",children:cr(n.global.fastestWin)})]}),n.global.longestGame&&l.jsxs("div",{className:"stat-item",children:[l.jsx("span",{className:"stat-label",children:"Longest Game"}),l.jsx("span",{className:"stat-value",children:cr(n.global.longestGame)})]}),n.global.lastGameDuration&&l.jsxs("div",{className:"stat-item",children:[l.jsx("span",{className:"stat-label",children:"Last Game"}),l.jsx("span",{className:"stat-value",children:cr(n.global.lastGameDuration)})]})]})]}),l.jsxs("section",{className:"stats-section",children:[l.jsx("h2",{className:"section-title",children:"AI Performance"}),l.jsx("div",{className:"ai-stats",children:["easy","normal","hard"].map(p=>{const y=n.aiDifficulty[p],v=y.played>0?y.wins/y.played*100:0;return l.jsxs("div",{className:"ai-item",children:[l.jsx("span",{className:"ai-name",children:p}),l.jsxs("span",{className:"ai-record",children:[l.jsxs("span",{className:"win",children:[y.wins,"W"]})," - ",l.jsxs("span",{className:"loss",children:[y.losses,"L"]})]}),l.jsxs("span",{className:"ai-winrate",children:["(",v.toFixed(1),"%)"]})]},p)})})]}),d.length>0&&l.jsxs("section",{className:"stats-section",children:[l.jsx("h2",{className:"section-title",children:"Best Win Rate"}),l.jsx("div",{className:"protocol-list",children:d.map((p,y)=>l.jsxs("div",{className:"protocol-item",children:[l.jsxs("span",{className:"protocol-rank",children:[y+1,"."]}),l.jsx("span",{className:"protocol-name",children:p.protocol}),l.jsxs("span",{className:"protocol-stats win",children:[p.winRate.toFixed(0),"%  ",p.timesUsed]})]},p.protocol))})]}),i.length>0&&l.jsxs("section",{className:"stats-section",children:[l.jsx("h2",{className:"section-title",children:"Favorite Protocols"}),l.jsx("div",{className:"protocol-list",children:i.map((p,y)=>l.jsxs("div",{className:"protocol-item",children:[l.jsxs("span",{className:"protocol-rank",children:[y+1,"."]}),l.jsx("span",{className:"protocol-name",children:p.protocol}),l.jsxs("span",{className:"protocol-stats",children:[p.timesUsed,"  ",p.winRate.toFixed(0),"%"]})]},p.protocol))})]}),f.length>0&&l.jsxs("section",{className:"stats-section",children:[l.jsx("h2",{className:"section-title",children:"Least Used Protocols"}),l.jsx("div",{className:"protocol-list",children:f.map((p,y)=>l.jsxs("div",{className:"protocol-item",children:[l.jsxs("span",{className:"protocol-rank",children:[y+1,"."]}),l.jsx("span",{className:"protocol-name",children:p.protocol}),l.jsxs("span",{className:"protocol-stats",children:[p.timesUsed,"  ",p.winRate.toFixed(0),"%"]})]},p.protocol))})]}),m.length>0&&l.jsxs("section",{className:"stats-section",children:[l.jsx("h2",{className:"section-title",children:"Most Played Cards"}),l.jsx("div",{className:"card-list",children:m.map((p,y)=>l.jsxs("div",{className:"card-item",children:[l.jsxs("span",{className:"card-rank",children:[y+1,"."]}),l.jsx("span",{className:"card-name",children:p.card}),l.jsxs("span",{className:"card-count",children:[p.count,""]})]},p.card))})]}),h.length>0&&l.jsxs("section",{className:"stats-section",children:[l.jsx("h2",{className:"section-title",children:"Most Deleted Cards"}),l.jsx("div",{className:"card-list",children:h.map((p,y)=>l.jsxs("div",{className:"card-item",children:[l.jsxs("span",{className:"card-rank",children:[y+1,"."]}),l.jsx("span",{className:"card-name",children:p.card}),l.jsxs("span",{className:"card-count",children:[p.count,""]})]},p.card))})]}),l.jsxs("section",{className:"stats-section",children:[l.jsx("h2",{className:"section-title",children:"Control Mechanic"}),l.jsxs("div",{className:"stats-grid",children:[l.jsxs("div",{className:"stat-item",children:[l.jsx("span",{className:"stat-label",children:"With Control"}),l.jsx("span",{className:"stat-value",children:n.control.gamesWithControl})]}),l.jsxs("div",{className:"stat-item",children:[l.jsx("span",{className:"stat-label",children:"Without Control"}),l.jsx("span",{className:"stat-value",children:n.control.gamesWithoutControl})]}),l.jsxs("div",{className:"stat-item",children:[l.jsx("span",{className:"stat-label",children:"Your Rearranges"}),l.jsx("span",{className:"stat-value",children:n.control.playerRearranges})]}),l.jsxs("div",{className:"stat-item",children:[l.jsx("span",{className:"stat-label",children:"AI Rearranges"}),l.jsx("span",{className:"stat-value",children:n.control.aiRearranges})]}),l.jsxs("div",{className:"stat-item",children:[l.jsx("span",{className:"stat-label",children:"Total Rearranges"}),l.jsx("span",{className:"stat-value",children:n.control.totalRearranges})]})]})]}),l.jsxs("section",{className:"stats-section",children:[l.jsx("h2",{className:"section-title",children:"Coin Flip"}),l.jsxs("div",{className:"stats-grid",children:[l.jsxs("div",{className:"stat-item",children:[l.jsx("span",{className:"stat-label",children:"Heads Chosen"}),l.jsxs("span",{className:"stat-value",children:[n.coinFlip.headsChosen," (",n.coinFlip.headsChosen>0?(n.coinFlip.headsWon/n.coinFlip.headsChosen*100).toFixed(0):0,"%)"]})]}),l.jsxs("div",{className:"stat-item",children:[l.jsx("span",{className:"stat-label",children:"Tails Chosen"}),l.jsxs("span",{className:"stat-value",children:[n.coinFlip.tailsChosen," (",n.coinFlip.tailsChosen>0?(n.coinFlip.tailsWon/n.coinFlip.tailsChosen*100).toFixed(0):0,"%)"]})]})]})]}),l.jsxs("section",{className:"stats-section full-width",children:[l.jsx("h2",{className:"section-title",children:"Actions"}),l.jsxs("div",{className:"stats-grid",style:{gridTemplateColumns:"repeat(4, 1fr)"},children:[l.jsxs("div",{className:"stat-item",children:[l.jsx("span",{className:"stat-label",children:"Cards Played"}),l.jsx("span",{className:"stat-value",children:n.actions.totalCardsPlayed})]}),l.jsxs("div",{className:"stat-item",children:[l.jsx("span",{className:"stat-label",children:"Cards Drawn"}),l.jsx("span",{className:"stat-value",children:n.actions.totalCardsDrawn})]}),l.jsxs("div",{className:"stat-item",children:[l.jsx("span",{className:"stat-label",children:"Discards"}),l.jsx("span",{className:"stat-value",children:n.actions.totalDiscards})]}),l.jsxs("div",{className:"stat-item",children:[l.jsx("span",{className:"stat-label",children:"Deletes"}),l.jsx("span",{className:"stat-value",children:n.actions.totalDeletes})]}),l.jsxs("div",{className:"stat-item",children:[l.jsx("span",{className:"stat-label",children:"Flips"}),l.jsx("span",{className:"stat-value",children:n.actions.totalFlips})]}),l.jsxs("div",{className:"stat-item",children:[l.jsx("span",{className:"stat-label",children:"Shifts"}),l.jsx("span",{className:"stat-value",children:n.actions.totalShifts})]}),l.jsxs("div",{className:"stat-item",children:[l.jsx("span",{className:"stat-label",children:"Compiles"}),l.jsx("span",{className:"stat-value",children:n.actions.totalCompiles})]}),l.jsxs("div",{className:"stat-item",children:[l.jsx("span",{className:"stat-label",children:"Refreshes"}),l.jsx("span",{className:"stat-value",children:n.actions.totalRefreshes})]})]})]})]})]})}const Ym=({params:o,onChange:n})=>{var r,s,i,d;return l.jsxs("div",{className:"param-editor draw-effect-editor",children:[l.jsx("h4",{children:"Draw Effect Parameters"}),l.jsxs("label",{children:["Count Type",l.jsxs("select",{value:o.countType||"fixed",onChange:f=>{const m=f.target.value;n({...o,countType:m,countOffset:m==="equal_to_discarded"?0:void 0})},children:[l.jsx("option",{value:"fixed",children:"Fixed Amount"}),l.jsx("option",{value:"equal_to_card_value",children:"Equal to Card Value (from previous effect)"}),l.jsx("option",{value:"equal_to_discarded",children:"Equal to Discarded Cards"}),l.jsx("option",{value:"hand_size",children:"Equal to Hand Size"})]})]}),(!o.countType||o.countType==="fixed")&&l.jsxs("label",{children:["Card Count",l.jsx("input",{type:"number",min:1,max:6,value:o.count,onChange:f=>n({...o,count:parseInt(f.target.value)||1})})]}),o.countType==="equal_to_discarded"&&l.jsxs("label",{children:["Offset (+/-)",l.jsx("input",{type:"number",min:-5,max:5,value:o.countOffset||0,onChange:f=>n({...o,countOffset:parseInt(f.target.value)||0})}),l.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:'Example: +1 for "discard count plus 1" (Fire-4)'})]}),l.jsxs("label",{children:["Target",l.jsxs("select",{value:o.target,onChange:f=>n({...o,target:f.target.value}),children:[l.jsx("option",{value:"self",children:"Self"}),l.jsx("option",{value:"opponent",children:"Opponent"})]})]}),l.jsxs("label",{children:["Source",l.jsxs("select",{value:o.source,onChange:f=>n({...o,source:f.target.value}),children:[l.jsx("option",{value:"own_deck",children:"Own Deck"}),l.jsx("option",{value:"opponent_deck",children:"Opponent's Deck"})]})]}),l.jsxs("label",{children:[l.jsx("input",{type:"checkbox",checked:o.preAction==="refresh",onChange:f=>n({...o,preAction:f.target.checked?"refresh":void 0})}),"Refresh hand first (shuffle hand into deck, then draw)"]}),l.jsxs("label",{children:[l.jsx("input",{type:"checkbox",checked:o.optional||!1,onChange:f=>n({...o,optional:f.target.checked})}),'Optional ("You may draw" instead of "Draw")']}),l.jsxs("label",{children:["Conditional",l.jsxs("select",{value:((r=o.conditional)==null?void 0:r.type)||"none",onChange:f=>{if(f.target.value==="none"){const{conditional:m,...h}=o;n(h)}else n({...o,conditional:{type:f.target.value}})},children:[l.jsx("option",{value:"none",children:"None"}),l.jsx("option",{value:"count_face_down",children:"1 per face-down card (all on board)"}),l.jsx("option",{value:"is_covering",children:"Only if this card is covering another"}),l.jsx("option",{value:"non_matching_protocols",children:"1 per line with non-matching protocol"})]})]}),l.jsxs("label",{children:["Advanced Conditional",l.jsxs("select",{value:((s=o.advancedConditional)==null?void 0:s.type)||"none",onChange:f=>{if(f.target.value==="none"){const{advancedConditional:m,...h}=o;n(h)}else f.target.value==="protocol_match"?n({...o,advancedConditional:{type:"protocol_match",protocol:""}}):f.target.value==="compile_block"&&n({...o,advancedConditional:{type:"compile_block",turnDuration:1}})},children:[l.jsx("option",{value:"none",children:"None"}),l.jsx("option",{value:"protocol_match",children:"Only if in line with matching protocol (Anarchy-6)"}),l.jsx("option",{value:"compile_block",children:"Block opponent's compile next turn (Metal-1)"})]})]}),((i=o.advancedConditional)==null?void 0:i.type)==="protocol_match"&&l.jsxs("label",{children:["Required Protocol",l.jsx("input",{type:"text",placeholder:"e.g., Fire, Water, Lightning",value:o.advancedConditional.protocol||"",onChange:f=>n({...o,advancedConditional:{...o.advancedConditional,type:"protocol_match",protocol:f.target.value}})}),l.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"Only draw if this card is in a line with this protocol"})]}),((d=o.advancedConditional)==null?void 0:d.type)==="compile_block"&&l.jsxs("label",{children:["Block Duration (turns)",l.jsx("input",{type:"number",min:1,max:3,value:o.advancedConditional.turnDuration||1,onChange:f=>n({...o,advancedConditional:{...o.advancedConditional,type:"compile_block",turnDuration:parseInt(f.target.value)||1}})}),l.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"Opponent can't compile for this many turns"})]}),l.jsxs("div",{className:"effect-preview",children:[l.jsx("strong",{children:"Preview:"})," ",qt({params:o})]})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const h0=({params:o,onChange:n})=>l.jsxs("div",{className:"param-editor refresh-effect-editor",children:[l.jsx("h4",{children:"Refresh Effect Parameters"}),l.jsx("p",{className:"effect-description",children:'Refresh fills the hand to 5 cards (Spirit-0: "Refresh.")'}),l.jsxs("label",{children:["Target",l.jsxs("select",{value:o.target||"self",onChange:r=>n({...o,target:r.target.value}),children:[l.jsx("option",{value:"self",children:"Self"}),l.jsx("option",{value:"opponent",children:"Opponent"})]})]})]});/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const m0=({params:o,onChange:n})=>l.jsxs("div",{className:"param-editor mutual-draw-effect-editor",children:[l.jsx("h4",{children:"Mutual Draw Effect Parameters"}),l.jsx("p",{className:"effect-description",children:`Both players draw from each other's decks (Chaos-0: "Draw the top card of your opponent's deck. Your opponent draws the top card of your deck.")`}),l.jsxs("label",{children:["Count",l.jsx("input",{type:"number",min:"1",max:"10",value:o.count||1,onChange:r=>n({...o,count:parseInt(r.target.value)||1})})]})]}),Wm=({params:o,onChange:n})=>{var i,d;const r=o.targetFilter||{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1},s=o.count??1;return l.jsxs("div",{className:"param-editor flip-effect-editor",children:[l.jsx("h4",{children:"Flip Effect Parameters"}),l.jsxs("label",{children:["Card Count/Scope",l.jsxs("select",{value:s==="all"?"all":s==="each"?"each":s.toString(),onChange:f=>{const m=f.target.value;n(m==="all"?{...o,count:"all"}:m==="each"?{...o,count:"each"}:{...o,count:parseInt(m)})},children:[l.jsx("option",{value:"1",children:"1 card"}),l.jsx("option",{value:"2",children:"2 cards"}),l.jsx("option",{value:"3",children:"3 cards"}),l.jsx("option",{value:"all",children:"All matching cards"}),l.jsx("option",{value:"each",children:"Each matching card"})]})]}),typeof o.count=="number"&&l.jsxs("label",{children:["Scope",l.jsxs("select",{value:o.scope||"any",onChange:f=>n({...o,scope:f.target.value}),children:[l.jsx("option",{value:"any",children:"Any lane"}),l.jsx("option",{value:"this_lane",children:"This lane only"}),l.jsx("option",{value:"each_lane",children:'Each lane (Chaos-0: "In each line...")'})]})]}),l.jsxs("label",{children:[l.jsx("input",{type:"checkbox",checked:o.optional,onChange:f=>n({...o,optional:f.target.checked})}),'Optional ("May flip" instead of "Flip")']}),o.count==="each"&&l.jsxs("label",{children:["Each Line Scope",l.jsxs("select",{value:o.eachLineScope||"all_lines",onChange:f=>n({...o,eachLineScope:f.target.value}),children:[l.jsx("option",{value:"all_lines",children:"Each card on board"}),l.jsx("option",{value:"each_line",children:"1 card in each line"})]})]}),l.jsxs("label",{children:[l.jsx("input",{type:"checkbox",checked:o.flipSelf||!1,onChange:f=>n({...o,flipSelf:f.target.checked})}),"Flip ONLY this card (no target selection)",l.jsx("small",{style:{display:"block",marginLeft:"24px",color:"#8A79E8"},children:"The card flips itself, ignoring count and target filter."})]}),l.jsxs("label",{children:[l.jsx("input",{type:"checkbox",checked:o.selfFlipAfter||!1,onChange:f=>n({...o,selfFlipAfter:f.target.checked})}),"ALSO flip this card after flipping targets",l.jsx("small",{style:{display:"block",marginLeft:"24px",color:"#8A79E8"},children:"After flipping target(s), also flip this card as bonus."})]}),l.jsx("h5",{children:"Advanced Conditional"}),l.jsxs("label",{children:["Conditional Type",l.jsxs("select",{value:((i=o.advancedConditional)==null?void 0:i.type)||"",onChange:f=>{if(f.target.value===""){const{advancedConditional:m,...h}=o;n(h)}else n({...o,advancedConditional:{type:f.target.value}})},children:[l.jsx("option",{value:"",children:"None"}),l.jsx("option",{value:"protocol_match",children:"Only if in specific protocol line"})]})]}),((d=o.advancedConditional)==null?void 0:d.type)==="protocol_match"&&l.jsxs("label",{children:["Required Protocol",l.jsx("input",{type:"text",value:o.advancedConditional.protocol||"",onChange:f=>n({...o,advancedConditional:{...o.advancedConditional,protocol:f.target.value}}),placeholder:"e.g., Anarchy, Fire, Death"})]}),l.jsx("h5",{children:"Target Filter"}),l.jsxs("label",{children:["Owner",l.jsxs("select",{value:r.owner,onChange:f=>n({...o,targetFilter:{...r,owner:f.target.value}}),children:[l.jsx("option",{value:"any",children:"Any"}),l.jsx("option",{value:"own",children:"Own"}),l.jsx("option",{value:"opponent",children:"Opponent"})]})]}),l.jsxs("label",{children:["Position",l.jsxs("select",{value:r.position,onChange:f=>n({...o,targetFilter:{...r,position:f.target.value}}),children:[l.jsx("option",{value:"any",children:"Any"}),l.jsx("option",{value:"uncovered",children:"Uncovered (top card)"}),l.jsx("option",{value:"covered",children:"Covered"}),l.jsx("option",{value:"covered_in_this_line",children:"Covered in this line"})]})]}),l.jsxs("label",{children:["Face State",l.jsxs("select",{value:r.faceState,onChange:f=>n({...o,targetFilter:{...r,faceState:f.target.value}}),children:[l.jsx("option",{value:"any",children:"Any"}),l.jsx("option",{value:"face_up",children:"Face-up"}),l.jsx("option",{value:"face_down",children:"Face-down"})]})]}),l.jsxs("label",{children:[l.jsx("input",{type:"checkbox",checked:r.excludeSelf,onChange:f=>n({...o,targetFilter:{...r,excludeSelf:f.target.checked}})}),'Exclude self ("other cards")']}),l.jsxs("div",{className:"effect-preview",children:[l.jsx("strong",{children:"Preview:"})," ",qt({params:o})]})]})},Qm=({params:o,onChange:n})=>{var r;return l.jsxs("div",{className:"param-editor",children:[l.jsx("h4",{children:"Shift Effect"}),l.jsxs("label",{children:["Count/Scope",l.jsxs("select",{value:o.count==="all"?"all":"1",onChange:s=>{if(s.target.value==="all")n({...o,count:"all"});else{const{count:i,...d}=o;n(d)}},children:[l.jsx("option",{value:"1",children:"1 card"}),l.jsx("option",{value:"all",children:"All matching cards"})]})]}),l.jsxs("label",{children:["Target Owner",l.jsxs("select",{value:o.targetFilter.owner,onChange:s=>n({...o,targetFilter:{...o.targetFilter,owner:s.target.value}}),children:[l.jsx("option",{value:"any",children:"Any"}),l.jsx("option",{value:"own",children:"Own"}),l.jsx("option",{value:"opponent",children:"Opponent"})]})]}),l.jsxs("label",{children:["Position",l.jsxs("select",{value:o.targetFilter.position,onChange:s=>n({...o,targetFilter:{...o.targetFilter,position:s.target.value}}),children:[l.jsx("option",{value:"any",children:"Any"}),l.jsx("option",{value:"uncovered",children:"Uncovered"}),l.jsx("option",{value:"covered",children:"Covered"})]})]}),l.jsxs("label",{children:["Face State",l.jsxs("select",{value:o.targetFilter.faceState,onChange:s=>n({...o,targetFilter:{...o.targetFilter,faceState:s.target.value}}),children:[l.jsx("option",{value:"any",children:"Any"}),l.jsx("option",{value:"face_up",children:"Face-up"}),l.jsx("option",{value:"face_down",children:"Face-down"})]})]}),l.jsxs("label",{children:[l.jsx("input",{type:"checkbox",checked:o.targetFilter.excludeSelf||!1,onChange:s=>n({...o,targetFilter:{...o.targetFilter,excludeSelf:s.target.checked}})}),'Exclude self ("other card")']}),l.jsxs("label",{children:[l.jsx("input",{type:"checkbox",checked:o.optional||!1,onChange:s=>n({...o,optional:s.target.checked})}),'Optional ("You may shift" instead of "Shift")']}),l.jsxs("label",{children:["Destination",l.jsxs("select",{value:((r=o.destinationRestriction)==null?void 0:r.type)||"any",onChange:s=>{if(s.target.value==="any"){const{destinationRestriction:i,...d}=o;n(d)}else n({...o,destinationRestriction:{type:s.target.value}})},children:[l.jsx("option",{value:"any",children:"Any line"}),l.jsx("option",{value:"to_another_line",children:"To another line"}),l.jsx("option",{value:"non_matching_protocol",children:"Non-matching protocol"}),l.jsx("option",{value:"specific_lane",children:"This line (within)"})]})]}),l.jsxs("div",{className:"effect-preview",children:[l.jsx("strong",{children:"Preview:"})," ",qt({params:o})]})]})},Xm=({params:o,onChange:n})=>{var s,i,d,f,m;const r=o.targetFilter||{position:"uncovered",faceState:"any"};return l.jsxs("div",{className:"param-editor delete-effect-editor",children:[l.jsx("h4",{children:"Delete Effect Parameters"}),l.jsxs("label",{children:["Anzahl",l.jsxs("select",{value:typeof o.count=="number"?o.count.toString():"all",onChange:h=>n({...o,count:h.target.value==="all"?"all_in_lane":parseInt(h.target.value)}),children:[l.jsx("option",{value:"1",children:"1"}),l.jsx("option",{value:"2",children:"2"}),l.jsx("option",{value:"3",children:"3"}),l.jsx("option",{value:"all",children:"All in a lane"})]})]}),l.jsxs("label",{children:[l.jsx("input",{type:"checkbox",checked:o.excludeSelf,onChange:h=>n({...o,excludeSelf:h.target.checked})}),"Exclude self (other cards only)"]}),l.jsxs("label",{children:[l.jsx("input",{type:"checkbox",checked:o.deleteSelf||!1,onChange:h=>n({...o,deleteSelf:h.target.checked})}),"Delete this card (ignores all other settings)"]}),l.jsx("h5",{children:"Target Filter"}),l.jsxs("label",{children:["Position",l.jsxs("select",{value:r.position,onChange:h=>n({...o,targetFilter:{...r,position:h.target.value}}),children:[l.jsx("option",{value:"any",children:"Any"}),l.jsx("option",{value:"uncovered",children:"Uncovered"}),l.jsx("option",{value:"covered",children:"Covered"})]})]}),l.jsxs("label",{children:["Face State",l.jsxs("select",{value:r.faceState,onChange:h=>n({...o,targetFilter:{...r,faceState:h.target.value}}),children:[l.jsx("option",{value:"any",children:"Any"}),l.jsx("option",{value:"face_up",children:"Face-up"}),l.jsx("option",{value:"face_down",children:"Face-down"})]})]}),l.jsxs("label",{children:["Owner",l.jsxs("select",{value:r.owner||"any",onChange:h=>{const p=h.target.value,y={...r};p==="any"?delete y.owner:y.owner=p,n({...o,targetFilter:y})},children:[l.jsx("option",{value:"any",children:"Any (own or opponent)"}),l.jsx("option",{value:"own",children:"Own cards only"}),l.jsx("option",{value:"opponent",children:"Opponent's cards only"})]})]}),l.jsxs("label",{children:["Calculation",l.jsxs("select",{value:r.calculation||"none",onChange:h=>{const p=h.target.value,y={...r};p==="none"?delete y.calculation:y.calculation=p,n({...o,targetFilter:y})},children:[l.jsx("option",{value:"none",children:"None"}),l.jsx("option",{value:"highest_value",children:"Highest value"}),l.jsx("option",{value:"lowest_value",children:"Lowest value"})]})]}),l.jsxs("label",{children:["Value Range (specific values to target)",l.jsxs("select",{value:r.valueRange?`${r.valueRange.min}-${r.valueRange.max}`:"none",onChange:h=>{const p=h.target.value,y={...r};p==="none"?delete y.valueRange:p==="0-1"?y.valueRange={min:0,max:1}:p==="1-2"?y.valueRange={min:1,max:2}:p==="0-0"&&(y.valueRange={min:0,max:0}),n({...o,targetFilter:y})},children:[l.jsx("option",{value:"none",children:"Any value"}),l.jsx("option",{value:"0-0",children:"Value 0 only"}),l.jsx("option",{value:"0-1",children:"Values 0 or 1"}),l.jsx("option",{value:"1-2",children:"Values 1 or 2"})]})]}),l.jsx("h5",{children:"Scope"}),l.jsxs("label",{children:["Lane Scope",l.jsxs("select",{value:((s=o.scope)==null?void 0:s.type)||"any",onChange:h=>{const p=h.target.value;if(p==="any"){const{scope:y,...v}=o;n(v)}else n({...o,scope:{type:p}})},children:[l.jsx("option",{value:"any",children:"Any lane"}),l.jsx("option",{value:"this_line",children:"This line only"}),l.jsx("option",{value:"other_lanes",children:"Other lanes"}),l.jsx("option",{value:"each_other_line",children:"Each other line (1 per line)"}),l.jsx("option",{value:"each_lane",children:"Each lane (flexible, 1 per line)"})]})]}),(((i=o.scope)==null?void 0:i.type)==="other_lanes"||((d=o.scope)==null?void 0:d.type)==="any")&&l.jsxs("label",{children:["Minimum Cards in Lane",l.jsxs("select",{value:((f=o.scope)==null?void 0:f.minCardsInLane)||0,onChange:h=>{const p=parseInt(h.target.value);if(p===0){const y={...o.scope};delete y.minCardsInLane,n({...o,scope:y})}else n({...o,scope:{...o.scope,minCardsInLane:p}})},children:[l.jsx("option",{value:0,children:"No minimum"}),l.jsx("option",{value:8,children:"8 or more cards (Metal-3)"}),l.jsx("option",{value:6,children:"6 or more cards"}),l.jsx("option",{value:4,children:"4 or more cards"})]}),((m=o.scope)==null?void 0:m.minCardsInLane)&&l.jsxs("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:["Only delete from lanes with ",o.scope.minCardsInLane,"+ cards total."]})]}),l.jsxs("label",{children:["Who Chooses Target?",l.jsxs("select",{value:o.actorChooses||"effect_owner",onChange:h=>{const p=h.target.value;if(p==="effect_owner"){const{actorChooses:y,...v}=o;n(v)}else n({...o,actorChooses:p})},children:[l.jsx("option",{value:"effect_owner",children:"Effect owner chooses (default)"}),l.jsx("option",{value:"card_owner",children:"Card owner chooses (Plague-4: opponent deletes their own)"})]}),o.actorChooses==="card_owner"&&l.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"The owner of the targeted card chooses which card to delete."})]}),l.jsxs("div",{className:"effect-preview",children:[l.jsx("strong",{children:"Preview:"})," ",qt({params:o})]})]})},Zm=({params:o,onChange:n})=>{const r=o.countType||"fixed",s=o.variableCount,i=r==="equal_to_discarded";return l.jsxs("div",{className:"param-editor",children:[l.jsx("h4",{children:"Discard Effect"}),l.jsxs("label",{children:["Count Type",l.jsxs("select",{value:r,onChange:d=>n({...o,countType:d.target.value}),children:[l.jsx("option",{value:"fixed",children:"Fixed Count"}),l.jsx("option",{value:"equal_to_discarded",children:"Equal to Previously Discarded (Plague-2)"})]})]}),r==="fixed"&&l.jsxs("label",{children:["Count",l.jsxs("select",{value:s?"variable":o.count.toString(),onChange:d=>{const f=d.target.value;if(f==="variable")n({...o,variableCount:!0,count:1});else if(f==="all"){const{variableCount:m,...h}=o;n({...h,count:"all"})}else{const{variableCount:m,...h}=o;n({...h,count:parseInt(f)})}},children:[l.jsx("option",{value:"1",children:"1 card"}),l.jsx("option",{value:"2",children:"2 cards"}),l.jsx("option",{value:"3",children:"3 cards"}),l.jsx("option",{value:"all",children:"All cards (entire hand)"}),l.jsx("option",{value:"variable",children:"1 or more cards (variable)"})]})]}),i&&l.jsxs("label",{children:["Offset (add to count)",l.jsx("input",{type:"number",value:o.countOffset||0,onChange:d=>n({...o,countOffset:parseInt(d.target.value)}),min:"-5",max:"5"})]}),l.jsxs("label",{children:["Actor",l.jsxs("select",{value:o.actor,onChange:d=>n({...o,actor:d.target.value}),children:[l.jsx("option",{value:"self",children:"Self"}),l.jsx("option",{value:"opponent",children:"Opponent"})]})]}),l.jsxs("div",{className:"effect-preview",children:[l.jsx("strong",{children:"Preview:"})," ",qt({params:o})]})]})},Km=({params:o,onChange:n})=>{var f,m,h;const r=((f=o.targetFilter)==null?void 0:f.owner)||"any",s=((m=o.targetFilter)==null?void 0:m.position)||"uncovered",i=(h=o.targetFilter)==null?void 0:h.valueEquals,d=o.selectLane||!1;return l.jsxs("div",{className:"param-editor",children:[l.jsx("h4",{children:"Return Effect"}),l.jsxs("label",{children:["Count",l.jsxs("select",{value:typeof o.count=="number"?o.count.toString():"all",onChange:p=>n({...o,count:p.target.value==="all"?"all":parseInt(p.target.value)}),children:[l.jsx("option",{value:"1",children:"1"}),l.jsx("option",{value:"2",children:"2"}),l.jsx("option",{value:"all",children:"All"})]})]}),l.jsxs("label",{children:["Whose cards?",l.jsxs("select",{value:r,onChange:p=>n({...o,targetFilter:{...o.targetFilter,owner:p.target.value}}),children:[l.jsx("option",{value:"any",children:"Any card (own or opponent)"}),l.jsx("option",{value:"own",children:"Only own cards"}),l.jsx("option",{value:"opponent",children:"Only opponent cards"})]})]}),l.jsxs("label",{children:["Position",l.jsxs("select",{value:s,onChange:p=>n({...o,targetFilter:{...o.targetFilter,position:p.target.value}}),children:[l.jsx("option",{value:"uncovered",children:"Uncovered (default)"}),l.jsx("option",{value:"covered",children:"Covered"}),l.jsx("option",{value:"any",children:"Any (covered or uncovered)"})]})]}),l.jsxs("label",{children:[l.jsx("input",{type:"checkbox",checked:d,onChange:p=>{if(p.target.checked)n({...o,selectLane:!0});else{const{selectLane:y,...v}=o;n(v)}}}),'Select lane first (Water-3: "in 1 line")']}),l.jsxs("label",{children:[l.jsx("input",{type:"checkbox",checked:i!==void 0,onChange:p=>{if(p.target.checked)n({...o,targetFilter:{...o.targetFilter,valueEquals:2}});else{const{valueEquals:y,...v}=o.targetFilter||{};n({...o,targetFilter:v})}}}),"Filter by value"]}),i!==void 0&&l.jsxs("label",{children:["Value to return",l.jsx("input",{type:"number",min:0,max:6,value:i,onChange:p=>n({...o,targetFilter:{...o.targetFilter,valueEquals:parseInt(p.target.value)||0}})})]}),l.jsxs("div",{className:"effect-preview",children:[l.jsx("strong",{children:"Preview:"})," ",qt({params:o})]})]})},Jm=({params:o,onChange:n})=>{var s,i;const r=o.destinationRule||{type:"other_lines"};return l.jsxs("div",{className:"param-editor",children:[l.jsx("h4",{children:"Play Effect"}),l.jsxs("label",{children:["Actor (who plays)",l.jsxs("select",{value:o.actor||"self",onChange:d=>{if(d.target.value==="self"){const{actor:f,...m}=o;n(m)}else n({...o,actor:d.target.value})},children:[l.jsx("option",{value:"self",children:"You"}),l.jsx("option",{value:"opponent",children:"Opponent"})]})]}),l.jsxs("label",{children:["Source",l.jsxs("select",{value:o.source,onChange:d=>n({...o,source:d.target.value}),children:[l.jsx("option",{value:"hand",children:"Hand"}),l.jsx("option",{value:"deck",children:"Deck"})]})]}),l.jsxs("label",{children:["Anzahl",l.jsx("input",{type:"number",min:1,max:6,value:o.count,onChange:d=>n({...o,count:parseInt(d.target.value)||1})})]}),l.jsxs("label",{children:[l.jsx("input",{type:"checkbox",checked:o.faceDown,onChange:d=>n({...o,faceDown:d.target.checked})}),"Face-down"]}),l.jsxs("label",{children:["Destination",l.jsxs("select",{value:r.type,onChange:d=>n({...o,destinationRule:{...r,type:d.target.value}}),children:[l.jsx("option",{value:"other_lines",children:"Other lines (choose 1)"}),l.jsx("option",{value:"each_other_line",children:"Each other line (1 per line)"}),l.jsx("option",{value:"specific_lane",children:"Specific lane (this line)"}),l.jsx("option",{value:"each_line_with_card",children:"Each line with card"}),l.jsx("option",{value:"under_this_card",children:"Under this card"})]})]}),l.jsxs("label",{children:["Condition",l.jsxs("select",{value:((s=o.condition)==null?void 0:s.type)||"none",onChange:d=>{const f=d.target.value;if(f==="none"){const{condition:m,...h}=o;n(h)}else n(f==="per_x_cards_in_line"?{...o,condition:{type:f,cardCount:2}}:{...o,condition:{type:f}})},children:[l.jsx("option",{value:"none",children:"None (always play)"}),l.jsx("option",{value:"per_x_cards_in_line",children:"For every X cards in this line"}),l.jsx("option",{value:"only_in_lines_with_cards",children:"Only in lines where you have a card"})]})]}),((i=o.condition)==null?void 0:i.type)==="per_x_cards_in_line"&&l.jsxs("label",{children:["Cards per play (X)",l.jsx("input",{type:"number",min:1,max:6,value:o.condition.cardCount||2,onChange:d=>n({...o,condition:{...o.condition,cardCount:parseInt(d.target.value)||2}})}),l.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:'Gravity-0: "For every 2 cards in this line, play..."  X = 2'})]}),l.jsxs("div",{className:"effect-preview",children:[l.jsx("strong",{children:"Preview:"})," ",qt({params:o})]})]})},eg=({params:o,onChange:n})=>l.jsxs("div",{className:"param-editor",children:[l.jsx("h4",{children:"Protocol Effect"}),l.jsxs("label",{children:["Action",l.jsxs("select",{value:o.action,onChange:r=>n({...o,action:r.target.value}),children:[l.jsx("option",{value:"rearrange_protocols",children:"Rearrange"}),l.jsx("option",{value:"swap_protocols",children:"Swap"})]})]}),l.jsxs("label",{children:["Target",l.jsxs("select",{value:o.target,onChange:r=>n({...o,target:r.target.value}),children:[l.jsx("option",{value:"own",children:"Own"}),l.jsx("option",{value:"opponent",children:"Opponent"}),l.jsx("option",{value:"both_sequential",children:"Beide (nacheinander)"})]})]}),l.jsx("h5",{children:"Restriction (Anarchy-3)"}),l.jsxs("label",{children:[l.jsx("input",{type:"checkbox",checked:!!o.restriction,onChange:r=>{if(r.target.checked)n({...o,restriction:{disallowedProtocol:"",laneIndex:"current"}});else{const{restriction:s,...i}=o;n(i)}}}),"Add restriction (protocol cannot be on specific lane)"]}),o.restriction&&l.jsxs(l.Fragment,{children:[l.jsxs("label",{children:["Disallowed Protocol",l.jsx("input",{type:"text",value:o.restriction.disallowedProtocol,onChange:r=>n({...o,restriction:{...o.restriction,disallowedProtocol:r.target.value}}),placeholder:"e.g., Anarchy, Fire, Death"})]}),l.jsxs("label",{children:["Lane",l.jsxs("select",{value:o.restriction.laneIndex,onChange:r=>n({...o,restriction:{...o.restriction,laneIndex:r.target.value==="current"?"current":parseInt(r.target.value)}}),children:[l.jsx("option",{value:"current",children:"Current lane (where this card is)"}),l.jsx("option",{value:"0",children:"Lane 1 (Left)"}),l.jsx("option",{value:"1",children:"Lane 2 (Middle)"}),l.jsx("option",{value:"2",children:"Lane 3 (Right)"})]})]})]}),l.jsxs("div",{className:"effect-preview",children:[l.jsx("strong",{children:"Preview:"})," ",qt({params:o})]})]}),tg=({params:o,onChange:n})=>l.jsxs("div",{className:"param-editor",children:[l.jsx("h4",{children:"Reveal/Give Effect"}),l.jsxs("label",{children:["Action",l.jsxs("select",{value:o.action,onChange:r=>n({...o,action:r.target.value}),children:[l.jsx("option",{value:"reveal",children:"Reveal"}),l.jsx("option",{value:"give",children:"Give"})]})]}),l.jsxs("label",{children:["Source",l.jsxs("select",{value:o.source,onChange:r=>n({...o,source:r.target.value}),children:[l.jsx("option",{value:"own_hand",children:"Your hand"}),l.jsx("option",{value:"opponent_hand",children:"Opponent's hand"})]})]}),l.jsxs("label",{children:["Anzahl",l.jsx("input",{type:"number",min:1,max:6,value:o.count,onChange:r=>n({...o,count:parseInt(r.target.value)||1})})]}),l.jsxs("label",{children:["Follow-up action",l.jsxs("select",{value:o.followUpAction||"none",onChange:r=>{if(r.target.value==="none"){const{followUpAction:s,...i}=o;n(i)}else n({...o,followUpAction:r.target.value})},children:[l.jsx("option",{value:"none",children:"None"}),l.jsx("option",{value:"flip",children:"Then flip"}),l.jsx("option",{value:"shift",children:"Then shift"})]})]}),l.jsxs("div",{className:"effect-preview",children:[l.jsx("strong",{children:"Preview:"})," ",qt({params:o})]})]}),ng=({params:o,onChange:n})=>l.jsxs("div",{className:"param-editor take-effect-editor",children:[l.jsx("h4",{children:"Take Effect Parameters"}),l.jsxs("label",{children:["Card Count",l.jsx("input",{type:"number",min:1,max:6,value:o.count,onChange:r=>n({...o,count:parseInt(r.target.value)||1})})]}),l.jsxs("label",{children:["Source",l.jsx("select",{value:o.source,onChange:r=>n({...o,source:r.target.value}),children:l.jsx("option",{value:"opponent_hand",children:"Opponent's Hand"})})]}),l.jsxs("label",{children:[l.jsx("input",{type:"checkbox",checked:o.random,onChange:r=>n({...o,random:r.target.checked})}),"Random (if unchecked, you choose)"]}),l.jsxs("div",{className:"effect-preview",children:[l.jsx("strong",{children:"Preview:"})," ",qt({params:o})]})]}),Rc=o=>{switch(o){case"draw":return{action:"draw",count:1,target:"self",source:"own_deck"};case"flip":return{action:"flip",count:1,targetFilter:{owner:"any",position:"any",faceState:"any",excludeSelf:!1},optional:!1};case"shift":return{action:"shift",targetFilter:{owner:"any",position:"any",faceState:"any"},destinationRestriction:{type:"any"}};case"delete":return{action:"delete",count:1,targetFilter:{position:"any",faceState:"any"},scope:{type:"anywhere"},excludeSelf:!1};case"discard":return{action:"discard",count:1,actor:"self"};case"return":return{action:"return",count:1,targetFilter:{},scope:{type:"any_card"}};case"play":return{action:"play",source:"hand",count:1,faceDown:!1,destinationRule:{type:"other_lines"}};case"rearrange_protocols":return{action:"rearrange_protocols",target:"own"};case"swap_protocols":return{action:"swap_protocols",target:"own"};case"reveal":case"give":return{action:o,source:"own_hand",count:1};case"take":return{action:"take",source:"opponent_hand",count:1,random:!0};default:return{}}},g0=({params:o,onChange:n})=>{const[r,s]=ce.useState(""),[i,d]=ce.useState(""),[f,m]=ce.useState(null),h=o.options||[],p=h[0],y=h[1],v=()=>{if(!r)return;const q={id:Ge(),params:Rc(r),position:"middle",trigger:"on_play"};n({...o,options:[q,y].filter(Boolean)}),s(""),m(1)},x=()=>{if(!i)return;const q={id:Ge(),params:Rc(i),position:"middle",trigger:"on_play"};n({...o,options:[p,q].filter(Boolean)}),d(""),m(2)},_=()=>{n({...o,options:[y].filter(Boolean)}),f===1&&m(null)},w=()=>{n({...o,options:[p].filter(Boolean)}),f===2&&m(null)},U=q=>{const D={...p,params:q};n({...o,options:[D,y].filter(Boolean)})},C=q=>{const D={...y,params:q};n({...o,options:[p,D].filter(Boolean)})},A=q=>{const D=Rc(q),E={...p,params:D};n({...o,options:[E,y].filter(Boolean)})},S=q=>{const D=Rc(q),E={...y,params:D};n({...o,options:[p,E].filter(Boolean)})},N=(q,D)=>{switch(q.params.action){case"draw":return l.jsx(Ym,{params:q.params,onChange:D});case"flip":return l.jsx(Wm,{params:q.params,onChange:D});case"shift":return l.jsx(Qm,{params:q.params,onChange:D});case"delete":return l.jsx(Xm,{params:q.params,onChange:D});case"discard":return l.jsx(Zm,{params:q.params,onChange:D});case"return":return l.jsx(Km,{params:q.params,onChange:D});case"play":return l.jsx(Jm,{params:q.params,onChange:D});case"rearrange_protocols":case"swap_protocols":return l.jsx(eg,{params:q.params,onChange:D});case"reveal":case"give":return l.jsx(tg,{params:q.params,onChange:D});case"take":return l.jsx(ng,{params:q.params,onChange:D});default:return l.jsx("div",{children:"Unknown effect type"})}};return l.jsxs("div",{style:{padding:"10px",backgroundColor:"#2c1d63",borderRadius:"4px",border:"1px solid rgba(97, 239, 255, 0.3)"},children:[l.jsx("h4",{style:{color:"#61EFFF",marginTop:0},children:"Either/Or Choice"}),l.jsx("p",{style:{color:"#F0F0F0",fontSize:"14px",marginBottom:"15px"},children:'Player chooses one of two options. Example: "Either discard 1 card or flip this card"'}),l.jsxs("div",{style:{marginBottom:"15px",padding:"10px",backgroundColor:"rgba(97, 239, 255, 0.05)",borderRadius:"4px"},children:[l.jsx("label",{style:{color:"#61EFFF",display:"block",marginBottom:"10px",fontWeight:"bold"},children:"Option 1:"}),p?l.jsxs(l.Fragment,{children:[l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"10px"},children:[l.jsxs("select",{value:p.params.action,onChange:q=>A(q.target.value),style:{flex:1,padding:"8px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px"},children:[l.jsx("option",{value:"draw",children:"Draw Cards"}),l.jsx("option",{value:"flip",children:"Flip Cards"}),l.jsx("option",{value:"shift",children:"Shift Card"}),l.jsx("option",{value:"delete",children:"Delete Cards"}),l.jsx("option",{value:"discard",children:"Discard Cards"}),l.jsx("option",{value:"return",children:"Return to Hand"}),l.jsx("option",{value:"play",children:"Play from Hand/Deck"})]}),l.jsx("button",{onClick:()=>m(f===1?null:1),style:{padding:"8px 15px",backgroundColor:f===1?"#8B0000":"#61EFFF",color:f===1?"#F0F0F0":"#0A051A",border:"none",borderRadius:"4px",cursor:"pointer",fontWeight:"bold"},children:f===1?"Hide":"Edit"}),l.jsx("button",{onClick:_,style:{padding:"8px 15px",backgroundColor:"#8B0000",color:"#F0F0F0",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Remove"})]}),f===1&&l.jsx("div",{style:{marginTop:"10px"},children:N(p,U)})]}):l.jsxs("div",{style:{display:"flex",gap:"10px"},children:[l.jsxs("select",{value:r,onChange:q=>s(q.target.value),style:{flex:1,padding:"8px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px"},children:[l.jsx("option",{value:"",children:"Choose Action"}),l.jsx("option",{value:"draw",children:"Draw Cards"}),l.jsx("option",{value:"flip",children:"Flip Cards"}),l.jsx("option",{value:"shift",children:"Shift Card"}),l.jsx("option",{value:"delete",children:"Delete Cards"}),l.jsx("option",{value:"discard",children:"Discard Cards"}),l.jsx("option",{value:"return",children:"Return to Hand"}),l.jsx("option",{value:"play",children:"Play from Hand/Deck"})]}),l.jsx("button",{onClick:v,disabled:!r,style:{padding:"8px 15px",backgroundColor:r?"#61EFFF":"#444",color:"#0A051A",border:"none",borderRadius:"4px",cursor:r?"pointer":"not-allowed",fontWeight:"bold"},children:"Add"})]})]}),l.jsxs("div",{style:{padding:"10px",backgroundColor:"rgba(97, 239, 255, 0.05)",borderRadius:"4px"},children:[l.jsx("label",{style:{color:"#61EFFF",display:"block",marginBottom:"10px",fontWeight:"bold"},children:"Option 2:"}),y?l.jsxs(l.Fragment,{children:[l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"10px"},children:[l.jsxs("select",{value:y.params.action,onChange:q=>S(q.target.value),style:{flex:1,padding:"8px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px"},children:[l.jsx("option",{value:"draw",children:"Draw Cards"}),l.jsx("option",{value:"flip",children:"Flip Cards"}),l.jsx("option",{value:"shift",children:"Shift Card"}),l.jsx("option",{value:"delete",children:"Delete Cards"}),l.jsx("option",{value:"discard",children:"Discard Cards"}),l.jsx("option",{value:"return",children:"Return to Hand"}),l.jsx("option",{value:"play",children:"Play from Hand/Deck"})]}),l.jsx("button",{onClick:()=>m(f===2?null:2),style:{padding:"8px 15px",backgroundColor:f===2?"#8B0000":"#61EFFF",color:f===2?"#F0F0F0":"#0A051A",border:"none",borderRadius:"4px",cursor:"pointer",fontWeight:"bold"},children:f===2?"Hide":"Edit"}),l.jsx("button",{onClick:w,style:{padding:"8px 15px",backgroundColor:"#8B0000",color:"#F0F0F0",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Remove"})]}),f===2&&l.jsx("div",{style:{marginTop:"10px"},children:N(y,C)})]}):l.jsxs("div",{style:{display:"flex",gap:"10px"},children:[l.jsxs("select",{value:i,onChange:q=>d(q.target.value),style:{flex:1,padding:"8px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px"},children:[l.jsx("option",{value:"",children:"Choose Action"}),l.jsx("option",{value:"draw",children:"Draw Cards"}),l.jsx("option",{value:"flip",children:"Flip Cards"}),l.jsx("option",{value:"shift",children:"Shift Card"}),l.jsx("option",{value:"delete",children:"Delete Cards"}),l.jsx("option",{value:"discard",children:"Discard Cards"}),l.jsx("option",{value:"return",children:"Return to Hand"}),l.jsx("option",{value:"play",children:"Play from Hand/Deck"})]}),l.jsx("button",{onClick:x,disabled:!i,style:{padding:"8px 15px",backgroundColor:i?"#61EFFF":"#444",color:"#0A051A",border:"none",borderRadius:"4px",cursor:i?"pointer":"not-allowed",fontWeight:"bold"},children:"Add"})]})]}),h.length===2&&l.jsx("div",{style:{marginTop:"15px",padding:"10px",backgroundColor:"rgba(97, 239, 255, 0.1)",borderRadius:"4px"},children:l.jsx("p",{style:{color:"#61EFFF",fontSize:"14px",margin:0},children:" Both options configured. Player will choose one during gameplay."})})]})},y0=({params:o,onChange:n})=>{var d,f,m;const r=((d=o.rule)==null?void 0:d.type)||"block_all_play",s=((f=o.rule)==null?void 0:f.target)||"opponent",i=((m=o.rule)==null?void 0:m.scope)||"this_lane";return l.jsxs("div",{className:"param-editor passive-rule-editor",children:[l.jsx("h4",{children:"Passive Rule Parameters"}),l.jsx("p",{style:{color:"#8A79E8",fontSize:"14px",marginBottom:"15px"},children:"This rule is active while the card is face-up. It modifies game behavior."}),l.jsxs("label",{children:["Rule Type",l.jsxs("select",{value:r,onChange:h=>n({...o,rule:{...o.rule,type:h.target.value,target:s,scope:i}}),children:[l.jsxs("optgroup",{label:"Play Restrictions",children:[l.jsx("option",{value:"block_face_down_play",children:"Block Face-Down Plays (Metal-2)"}),l.jsx("option",{value:"block_face_up_play",children:"Block Face-Up Plays"}),l.jsx("option",{value:"block_all_play",children:"Block All Plays (Plague-0)"}),l.jsx("option",{value:"require_face_down_play",children:"Require Face-Down Plays (Psychic-1)"})]}),l.jsxs("optgroup",{label:"Protocol Matching",children:[l.jsx("option",{value:"allow_any_protocol_play",children:"Allow Any Protocol (Spirit-1, Chaos-3)"}),l.jsx("option",{value:"require_non_matching_protocol",children:"Require Non-Matching (Anarchy-1)"})]}),l.jsxs("optgroup",{label:"Action Blocks",children:[l.jsx("option",{value:"block_flips",children:"Block Flips (Frost-1)"}),l.jsx("option",{value:"block_protocol_rearrange",children:"Block Protocol Rearrange (Frost-1)"}),l.jsx("option",{value:"block_shifts_from_lane",children:"Block Shifts From Lane (Frost-3)"}),l.jsx("option",{value:"block_shifts_to_lane",children:"Block Shifts To Lane (Frost-3)"})]}),l.jsx("optgroup",{label:"Effect Modifications",children:l.jsx("option",{value:"ignore_middle_commands",children:"Ignore Middle Commands (Apathy-2)"})}),l.jsx("optgroup",{label:"Phase Modifications",children:l.jsx("option",{value:"skip_check_cache_phase",children:"Skip Check Cache Phase (Spirit-0)"})})]})]}),l.jsxs("label",{children:["Affected Player",l.jsxs("select",{value:s,onChange:h=>n({...o,rule:{...o.rule,type:r,target:h.target.value,scope:i}}),children:[l.jsx("option",{value:"self",children:"Self (You)"}),l.jsx("option",{value:"opponent",children:"Opponent"}),l.jsx("option",{value:"all",children:"All Players"})]})]}),l.jsxs("label",{children:["Scope",l.jsxs("select",{value:i,onChange:h=>n({...o,rule:{...o.rule,type:r,target:s,scope:h.target.value}}),children:[l.jsx("option",{value:"this_lane",children:"This Lane Only"}),l.jsx("option",{value:"global",children:"Global (All Lanes)"})]})]}),l.jsxs("div",{className:"effect-preview",children:[l.jsx("strong",{children:"Preview:"})," ",qt({params:o})]})]})},v0=({params:o,onChange:n})=>{var v,x,_,w,U,C,A,S,N;const r=((v=o.modifier)==null?void 0:v.type)||"add_per_condition",s=((x=o.modifier)==null?void 0:x.value)||1,i=((_=o.modifier)==null?void 0:_.condition)||"per_face_down_card",d=((w=o.modifier)==null?void 0:w.target)||"own_total",f=((U=o.modifier)==null?void 0:U.scope)||"this_lane",m=((A=(C=o.modifier)==null?void 0:C.filter)==null?void 0:A.faceState)||"face_down",h=((N=(S=o.modifier)==null?void 0:S.filter)==null?void 0:N.position)||"any",p=r==="add_per_condition",y=r==="set_to_fixed"&&(d==="own_cards"||d==="opponent_cards"||d==="all_cards");return l.jsxs("div",{className:"param-editor value-modifier-editor",children:[l.jsx("h4",{children:"Value Modifier Parameters"}),l.jsx("p",{style:{color:"#8A79E8",fontSize:"14px",marginBottom:"15px"},children:"This modifier is active while the card is face-up. It modifies card values or lane totals."}),l.jsxs("label",{children:["Modifier Type",l.jsxs("select",{value:r,onChange:q=>n({...o,modifier:{...o.modifier,type:q.target.value,value:s,condition:p?i:void 0,target:d,scope:f,filter:y?{faceState:m,position:h}:void 0}}),children:[l.jsx("option",{value:"add_per_condition",children:"Add Per Condition (Apathy-0: +1 per face-down)"}),l.jsx("option",{value:"set_to_fixed",children:"Set Cards To Fixed Value (Darkness-2: face-down = 4)"}),l.jsx("option",{value:"add_to_total",children:"Add To Lane Total (Metal-0: opponent total -2)"})]})]}),l.jsxs("label",{children:["Value",l.jsx("input",{type:"number",value:s,onChange:q=>n({...o,modifier:{...o.modifier,type:r,value:parseInt(q.target.value)||0,condition:p?i:void 0,target:d,scope:f,filter:y?{faceState:m,position:h}:void 0}}),style:{width:"100%",padding:"8px",marginTop:"5px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px"}}),l.jsxs("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:[r==="add_per_condition"&&"Value to add per condition (e.g., +1)",r==="set_to_fixed"&&"Fixed value to set cards to (e.g., 4)",r==="add_to_total"&&"Value to add to total (use negative for subtraction, e.g., -2)"]})]}),p&&l.jsxs("label",{children:["Condition",l.jsxs("select",{value:i,onChange:q=>n({...o,modifier:{...o.modifier,type:r,value:s,condition:q.target.value,target:d,scope:f,filter:y?{faceState:m,position:h}:void 0}}),children:[l.jsx("option",{value:"per_face_down_card",children:"Per Face-Down Card"}),l.jsx("option",{value:"per_face_up_card",children:"Per Face-Up Card"}),l.jsx("option",{value:"per_card",children:"Per Card (any)"})]})]}),l.jsxs("label",{children:["Target",l.jsxs("select",{value:d,onChange:q=>n({...o,modifier:{...o.modifier,type:r,value:s,condition:p?i:void 0,target:q.target.value,scope:f,filter:y?{faceState:m,position:h}:void 0}}),children:[l.jsxs("optgroup",{label:"Card Values",children:[l.jsx("option",{value:"own_cards",children:"Own Cards"}),l.jsx("option",{value:"opponent_cards",children:"Opponent Cards"}),l.jsx("option",{value:"all_cards",children:"All Cards"})]}),l.jsxs("optgroup",{label:"Lane Totals",children:[l.jsx("option",{value:"own_total",children:"Own Total"}),l.jsx("option",{value:"opponent_total",children:"Opponent Total"})]})]})]}),y&&l.jsxs(l.Fragment,{children:[l.jsxs("label",{children:["Card Face State (Filter)",l.jsxs("select",{value:m,onChange:q=>n({...o,modifier:{...o.modifier,type:r,value:s,condition:p?i:void 0,target:d,scope:f,filter:{faceState:q.target.value,position:h}}}),children:[l.jsx("option",{value:"face_down",children:"Face-Down Only"}),l.jsx("option",{value:"face_up",children:"Face-Up Only"}),l.jsx("option",{value:"any",children:"Any"})]})]}),l.jsxs("label",{children:["Card Position (Filter)",l.jsxs("select",{value:h,onChange:q=>n({...o,modifier:{...o.modifier,type:r,value:s,condition:p?i:void 0,target:d,scope:f,filter:{faceState:m,position:q.target.value}}}),children:[l.jsx("option",{value:"any",children:"Any Position"}),l.jsx("option",{value:"covered",children:"Covered Only"}),l.jsx("option",{value:"uncovered",children:"Uncovered Only"})]})]})]}),l.jsxs("label",{children:["Scope",l.jsxs("select",{value:f,onChange:q=>n({...o,modifier:{...o.modifier,type:r,value:s,condition:p?i:void 0,target:d,scope:q.target.value,filter:y?{faceState:m,position:h}:void 0}}),children:[l.jsx("option",{value:"this_lane",children:"This Lane Only"}),l.jsx("option",{value:"global",children:"Global (All Lanes)"})]})]}),l.jsxs("div",{className:"effect-preview",children:[l.jsx("strong",{children:"Preview:"})," ",qt({params:o})]})]})},_0=({params:o,onChange:n})=>l.jsxs("div",{className:"param-editor block-compile-effect-editor",children:[l.jsx("h4",{children:"Block Compile Effect Parameters"}),l.jsxs("label",{children:["Target",l.jsxs("select",{value:o.target||"opponent",onChange:r=>n({...o,target:r.target.value}),children:[l.jsx("option",{value:"opponent",children:"Opponent cannot compile next turn"}),l.jsx("option",{value:"self",children:"You cannot compile next turn"})]})]}),l.jsxs("div",{className:"effect-preview",children:[l.jsx("strong",{children:"Preview:"})," ",qt({params:o})]})]}),x0=({params:o,onChange:n})=>{var s;const r=((s=o.laneCondition)==null?void 0:s.count)||8;return l.jsxs("div",{className:"param-editor delete-all-in-lane-effect-editor",children:[l.jsx("h4",{children:"Delete All In Lane Effect Parameters"}),l.jsxs("label",{children:["Minimum cards in lane",l.jsxs("select",{value:r,onChange:i=>n({...o,laneCondition:{type:"min_cards",count:parseInt(i.target.value)}}),children:[l.jsx("option",{value:0,children:"No minimum (any lane)"}),l.jsx("option",{value:4,children:"4 or more cards"}),l.jsx("option",{value:6,children:"6 or more cards"}),l.jsx("option",{value:8,children:"8 or more cards (Metal-3)"}),l.jsx("option",{value:10,children:"10 or more cards"})]})]}),l.jsxs("label",{children:[l.jsx("input",{type:"checkbox",checked:o.excludeCurrentLane!==!1,onChange:i=>n({...o,excludeCurrentLane:i.target.checked})}),"Exclude current lane (other lanes only)"]}),l.jsxs("div",{className:"effect-preview",children:[l.jsx("strong",{children:"Preview:"})," ",qt({params:o})]})]})},Dc=o=>{switch(o){case"draw":return{action:"draw",count:1,target:"self",source:"own_deck"};case"refresh":return{action:"refresh",target:"self"};case"mutual_draw":return{action:"mutual_draw",count:1};case"flip":return{action:"flip",count:1,targetFilter:{owner:"any",position:"any",faceState:"any",excludeSelf:!1},optional:!1};case"shift":return{action:"shift",targetFilter:{owner:"any",position:"any",faceState:"any"},destinationRestriction:{type:"any"}};case"delete":return{action:"delete",count:1,targetFilter:{position:"any",faceState:"any"},scope:{type:"anywhere"},excludeSelf:!1};case"discard":return{action:"discard",count:1,actor:"self"};case"return":return{action:"return",count:1,targetFilter:{},scope:{type:"any_card"}};case"play":return{action:"play",source:"hand",count:1,faceDown:!1,destinationRule:{type:"other_lines"}};case"rearrange_protocols":return{action:"rearrange_protocols",target:"own"};case"swap_protocols":return{action:"swap_protocols",target:"own"};case"reveal":case"give":return{action:o,source:"own_hand",count:1};case"take":return{action:"take",source:"opponent_hand",count:1,random:!0};case"choice":return{action:"choice",options:[]};case"passive_rule":return{action:"passive_rule",rule:{type:"block_all_play",target:"opponent",scope:"this_lane"}};case"value_modifier":return{action:"value_modifier",modifier:{type:"add_per_condition",value:1,condition:"per_face_down_card",target:"own_total",scope:"this_lane"}};case"block_compile":return{action:"block_compile",target:"opponent"};case"delete_all_in_lane":return{action:"delete_all_in_lane",laneCondition:{type:"min_cards",count:8},excludeCurrentLane:!0};default:return{}}},w0=({effect:o,onChange:n,readOnly:r=!1})=>{const s=_=>{r||n({...o,params:_})},i=_=>{if(_){const w={id:Ge(),params:Dc("draw"),position:o.position,trigger:o.trigger};n({...o,conditional:{type:"then",thenEffect:w}})}else{const{conditional:w,...U}=o;n(U)}},d=_=>{o.conditional&&n({...o,conditional:{...o.conditional,type:_}})},f=_=>{o.conditional&&n({...o,conditional:{...o.conditional,thenEffect:_}})},m=_=>{if(!o.conditional)return;const w=Dc(_),U={...o.conditional.thenEffect,params:w};n({...o,conditional:{...o.conditional,thenEffect:U}})},h=_=>{if(o.conditional)if(_){const w={id:Ge(),params:Dc("delete"),position:o.position,trigger:o.trigger};n({...o,conditional:{...o.conditional,thenEffect:{...o.conditional.thenEffect,conditional:{type:"then",thenEffect:w}}}})}else{const{conditional:w,...U}=o.conditional.thenEffect;n({...o,conditional:{...o.conditional,thenEffect:U}})}},p=_=>{var w;(w=o.conditional)!=null&&w.thenEffect.conditional&&n({...o,conditional:{...o.conditional,thenEffect:{...o.conditional.thenEffect,conditional:{...o.conditional.thenEffect.conditional,type:_}}}})},y=_=>{var w;(w=o.conditional)!=null&&w.thenEffect.conditional&&n({...o,conditional:{...o.conditional,thenEffect:{...o.conditional.thenEffect,conditional:{...o.conditional.thenEffect.conditional,thenEffect:_}}}})},v=_=>{var C;if(!((C=o.conditional)!=null&&C.thenEffect.conditional))return;const w=Dc(_),U={...o.conditional.thenEffect.conditional.thenEffect,params:w};n({...o,conditional:{...o.conditional,thenEffect:{...o.conditional.thenEffect,conditional:{...o.conditional.thenEffect.conditional,thenEffect:U}}}})},x=(_,w)=>{switch(_.params.action){case"draw":return l.jsx(Ym,{params:_.params,onChange:w});case"refresh":return l.jsx(h0,{params:_.params,onChange:w});case"mutual_draw":return l.jsx(m0,{params:_.params,onChange:w});case"flip":return l.jsx(Wm,{params:_.params,onChange:w});case"shift":return l.jsx(Qm,{params:_.params,onChange:w});case"delete":return l.jsx(Xm,{params:_.params,onChange:w});case"discard":return l.jsx(Zm,{params:_.params,onChange:w});case"return":return l.jsx(Km,{params:_.params,onChange:w});case"play":return l.jsx(Jm,{params:_.params,onChange:w});case"rearrange_protocols":case"swap_protocols":return l.jsx(eg,{params:_.params,onChange:w});case"reveal":case"give":return l.jsx(tg,{params:_.params,onChange:w});case"take":return l.jsx(ng,{params:_.params,onChange:w});case"choice":return l.jsx(g0,{params:_.params,onChange:w});case"passive_rule":return l.jsx(y0,{params:_.params,onChange:w});case"value_modifier":return l.jsx(v0,{params:_.params,onChange:w});case"block_compile":return l.jsx(_0,{params:_.params,onChange:w});case"delete_all_in_lane":return l.jsx(x0,{params:_.params,onChange:w});default:return l.jsxs("div",{children:["Unknown effect type: ",_.params.action]})}};return l.jsxs("div",{className:`effect-editor ${r?"read-only-mode":""}`,children:[l.jsx("div",{className:"trigger-info",style:{marginBottom:"15px",padding:"10px",backgroundColor:"#1A113B",borderRadius:"4px",border:"1px solid rgba(97, 239, 255, 0.3)"},children:l.jsxs("div",{style:{display:"flex",gap:"20px",alignItems:"center",flexWrap:"wrap"},children:[l.jsxs("label",{style:{flex:1,minWidth:"200px"},children:[l.jsx("strong",{children:"Trigger:"}),l.jsxs("select",{value:o.trigger,onChange:_=>!r&&n({...o,trigger:_.target.value}),disabled:r,style:{width:"100%",padding:"6px",marginTop:"4px",backgroundColor:"#2c1d63",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px"},children:[l.jsx("optgroup",{label:"Immediate",children:l.jsx("option",{value:"on_play",children:"On Play"})}),l.jsx("optgroup",{label:"Passive (Top Box)",children:l.jsx("option",{value:"passive",children:"Passive (always active)"})}),l.jsxs("optgroup",{label:"Phase Triggers (Bottom Box)",children:[l.jsx("option",{value:"start",children:"Start Phase"}),l.jsx("option",{value:"end",children:"End Phase"}),l.jsx("option",{value:"on_cover",children:"When Covered"})]}),l.jsxs("optgroup",{label:"Reactive (Top Box)",children:[l.jsx("option",{value:"on_flip",children:"When this card would be flipped"}),l.jsx("option",{value:"on_cover_or_flip",children:"When covered or flipped"}),l.jsx("option",{value:"after_delete",children:"After you delete cards"}),l.jsx("option",{value:"after_draw",children:"After you draw cards"}),l.jsx("option",{value:"after_shift",children:"After cards are shifted"}),l.jsx("option",{value:"after_flip",children:"After cards are flipped"}),l.jsx("option",{value:"after_play",children:"After cards are played"}),l.jsx("option",{value:"after_clear_cache",children:"After you clear cache"}),l.jsx("option",{value:"after_opponent_discard",children:"After opponent discards"}),l.jsx("option",{value:"before_compile_delete",children:"Before deleted by compile"})]})]})]}),l.jsxs("div",{style:{color:"#8A79E8",fontSize:"13px"},children:[l.jsx("strong",{children:"Position:"})," ",o.position.charAt(0).toUpperCase()+o.position.slice(1)," Box"]})]})}),l.jsxs("div",{className:"main-effect",children:[l.jsx("h3",{children:"Main Effect"}),x(o,s)]}),l.jsxs("div",{style:{marginTop:"15px"},children:[l.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[l.jsx("input",{type:"checkbox",checked:!!o.useCardFromPreviousEffect,onChange:_=>n({...o,useCardFromPreviousEffect:_.target.checked})}),l.jsx("span",{children:`Use card from previous effect (for "shift THAT card", "draw equal to THAT card's value", etc.)`})]}),o.useCardFromPreviousEffect&&l.jsx("small",{style:{display:"block",marginLeft:"24px",marginTop:"4px",color:"#8A79E8"},children:"This effect will target/use the card selected by the previous effect in the chain."})]}),(o.trigger==="after_draw"||o.trigger==="after_delete"||o.trigger==="after_shift"||o.trigger==="after_flip"||o.trigger==="after_clear_cache"||o.trigger==="after_opponent_discard")&&l.jsxs("div",{style:{marginTop:"15px"},children:[l.jsxs("label",{children:["Trigger Actor (who triggers this effect?)",l.jsxs("select",{value:o.reactiveTriggerActor||"self",onChange:_=>n({...o,reactiveTriggerActor:_.target.value}),style:{width:"100%",padding:"8px",marginTop:"5px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px",cursor:"pointer"},children:[l.jsx("option",{value:"self",children:"Only when YOU perform the action (default)"}),l.jsx("option",{value:"opponent",children:"Only when OPPONENT performs the action"}),l.jsx("option",{value:"any",children:"When ANYONE performs the action"})]})]}),l.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:o.reactiveTriggerActor==="self"||!o.reactiveTriggerActor?"Effect triggers only when YOU delete/draw/etc.":o.reactiveTriggerActor==="opponent"?"Effect triggers only when OPPONENT deletes/draws/etc.":"Effect triggers when ANYONE deletes/draws/etc."})]}),l.jsxs("div",{className:"conditional-section",style:{marginTop:"20px",borderTop:"1px solid #2c1d63",paddingTop:"15px"},children:[l.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"10px"},children:[l.jsx("input",{type:"checkbox",checked:!!o.conditional,onChange:_=>i(_.target.checked)}),l.jsx("strong",{children:"Add follow-up effect"})]}),o.conditional&&l.jsxs("div",{className:"follow-up-effect",style:{marginLeft:"20px",padding:"10px",backgroundColor:"#2c1d63",borderRadius:"4px",border:"1px solid rgba(97, 239, 255, 0.2)"},children:[l.jsx("h4",{style:{marginTop:0},children:"Follow-Up Effect"}),l.jsxs("label",{children:["Connection Type",l.jsxs("select",{value:o.conditional.type||"then",onChange:_=>d(_.target.value),style:{width:"100%",padding:"8px",marginTop:"5px",marginBottom:"15px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px",cursor:"pointer"},children:[l.jsx("option",{value:"then",children:"Then (always executes)"}),l.jsx("option",{value:"if_executed",children:"If you do (only if first effect succeeds)"})]})]}),l.jsxs("label",{children:["Effect Type",l.jsxs("select",{value:o.conditional.thenEffect.params.action,onChange:_=>m(_.target.value),style:{width:"100%",padding:"8px",marginTop:"5px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px",cursor:"pointer"},children:[l.jsx("option",{value:"draw",children:"Draw Cards"}),l.jsx("option",{value:"refresh",children:"Refresh Hand"}),l.jsx("option",{value:"mutual_draw",children:"Mutual Draw (Exchange)"}),l.jsx("option",{value:"flip",children:"Flip Cards"}),l.jsx("option",{value:"shift",children:"Shift Card"}),l.jsx("option",{value:"delete",children:"Delete Cards"}),l.jsx("option",{value:"delete_all_in_lane",children:"Delete All in Lane"}),l.jsx("option",{value:"discard",children:"Discard Cards"}),l.jsx("option",{value:"return",children:"Return to Hand"}),l.jsx("option",{value:"play",children:"Play from Hand/Deck"}),l.jsx("option",{value:"rearrange_protocols",children:"Rearrange Protocols"}),l.jsx("option",{value:"swap_protocols",children:"Swap Protocols"}),l.jsx("option",{value:"reveal",children:"Reveal Hand"}),l.jsx("option",{value:"give",children:"Give Cards"}),l.jsx("option",{value:"take",children:"Take from Hand"}),l.jsx("option",{value:"choice",children:"Either/Or Choice"}),l.jsx("option",{value:"block_compile",children:"Block Compile"})]})]}),l.jsx("div",{style:{marginTop:"15px"},children:x(o.conditional.thenEffect,_=>f({...o.conditional.thenEffect,params:_}))}),l.jsxs("div",{className:"nested-conditional-section",style:{marginTop:"15px",borderTop:"1px solid rgba(97, 239, 255, 0.2)",paddingTop:"15px"},children:[l.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"10px"},children:[l.jsx("input",{type:"checkbox",checked:!!o.conditional.thenEffect.conditional,onChange:_=>h(_.target.checked)}),l.jsx("strong",{children:"Add 2nd follow-up effect"})]}),o.conditional.thenEffect.conditional&&l.jsxs("div",{className:"nested-follow-up-effect",style:{marginLeft:"10px",padding:"10px",backgroundColor:"#1A113B",borderRadius:"4px",border:"1px solid rgba(97, 239, 255, 0.2)"},children:[l.jsx("h5",{style:{marginTop:0,fontSize:"0.9rem"},children:"2nd Follow-Up Effect"}),l.jsxs("label",{children:["Connection Type",l.jsxs("select",{value:o.conditional.thenEffect.conditional.type||"then",onChange:_=>p(_.target.value),style:{width:"100%",padding:"6px",marginTop:"5px",marginBottom:"10px",backgroundColor:"#0D0825",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px",cursor:"pointer",fontSize:"0.9rem"},children:[l.jsx("option",{value:"then",children:"Then (always executes)"}),l.jsx("option",{value:"if_executed",children:"If you do (only if first effect succeeds)"})]})]}),l.jsxs("label",{children:["Effect Type",l.jsxs("select",{value:o.conditional.thenEffect.conditional.thenEffect.params.action,onChange:_=>v(_.target.value),style:{width:"100%",padding:"6px",marginTop:"5px",backgroundColor:"#0D0825",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px",cursor:"pointer",fontSize:"0.9rem"},children:[l.jsx("option",{value:"draw",children:"Draw Cards"}),l.jsx("option",{value:"refresh",children:"Refresh Hand"}),l.jsx("option",{value:"mutual_draw",children:"Mutual Draw (Exchange)"}),l.jsx("option",{value:"flip",children:"Flip Cards"}),l.jsx("option",{value:"shift",children:"Shift Card"}),l.jsx("option",{value:"delete",children:"Delete Cards"}),l.jsx("option",{value:"delete_all_in_lane",children:"Delete All in Lane"}),l.jsx("option",{value:"discard",children:"Discard Cards"}),l.jsx("option",{value:"return",children:"Return to Hand"}),l.jsx("option",{value:"play",children:"Play from Hand/Deck"}),l.jsx("option",{value:"rearrange_protocols",children:"Rearrange Protocols"}),l.jsx("option",{value:"swap_protocols",children:"Swap Protocols"}),l.jsx("option",{value:"reveal",children:"Reveal Hand"}),l.jsx("option",{value:"give",children:"Give Cards"}),l.jsx("option",{value:"take",children:"Take from Hand"}),l.jsx("option",{value:"choice",children:"Either/Or Choice"}),l.jsx("option",{value:"block_compile",children:"Block Compile"})]})]}),l.jsx("div",{style:{marginTop:"10px"},children:x(o.conditional.thenEffect.conditional.thenEffect,_=>y({...o.conditional.thenEffect.conditional.thenEffect,params:_}))})]})]})]})]})]})},C0=({card:o,protocolName:n,protocolColor:r,protocolPattern:s,onChange:i,readOnly:d=!1})=>{const[f,m]=ce.useState(null),[h,p]=ce.useState(null),[y,v]=ce.useState(!1);ce.useEffect(()=>{m(null)},[o.value]);const x=(T,Q,X)=>{const M={id:Ge(),params:b0(Q),position:T,trigger:X},$={...o};T==="top"?$.topEffects=[...$.topEffects,M]:T==="middle"?$.middleEffects=[...$.middleEffects,M]:$.bottomEffects=[...$.bottomEffects,M],i($);const W=T==="top"?$.topEffects.length-1:T==="middle"?$.middleEffects.length-1:$.bottomEffects.length-1;m({box:T,effectIndex:W,effect:M})},_=(T,Q)=>{p({box:T,effectIndex:Q})},w=()=>{if(!h)return;const{box:T,effectIndex:Q}=h,X={...o};T==="top"?X.topEffects.splice(Q,1):T==="middle"?X.middleEffects.splice(Q,1):X.bottomEffects.splice(Q,1),i(X),f&&f.box===T&&f.effectIndex===Q&&m(null),p(null)},U=T=>{if(!f)return;const{box:Q,effectIndex:X}=f,M={...o};Q==="top"?(M.topEffects=[...M.topEffects],M.topEffects[X]=T):Q==="middle"?(M.middleEffects=[...M.middleEffects],M.middleEffects[X]=T):(M.bottomEffects=[...M.bottomEffects],M.bottomEffects[X]=T),i(M),m({box:Q,effectIndex:X,effect:T})},C=(T,Q)=>{const X=T==="top"?o.topEffects[Q]:T==="middle"?o.middleEffects[Q]:o.bottomEffects[Q];m({box:T,effectIndex:Q,effect:X})},A=T=>{switch(T){case"passive":return"";case"on_play":return"";case"start":return"Start";case"end":return"End";case"on_cover":return"On Cover";case"after_delete":return"After you delete cards";case"after_opponent_discard":return"After opponent discards";case"after_draw":return"After you draw cards";case"after_clear_cache":return"After you clear cache";case"before_compile_delete":return"Before deleted by compile";case"after_flip":return"After cards are flipped";case"after_shift":return"After cards are shifted";case"after_play":return"After cards are played";case"on_flip":return"When this card would be flipped";case"on_cover_or_flip":return"When covered or flipped";default:return T}},S=T=>{const Q={...o,value:T};i(Q)},N=ll(o.topEffects),q=ll(o.middleEffects),D=ll(o.bottomEffects),E=JSON.stringify({top:o.topEffects.map(T=>({id:T.id,params:T.params})),middle:o.middleEffects.map(T=>({id:T.id,params:T.params})),bottom:o.bottomEffects.map(T=>({id:T.id,params:T.params}))}),j=`${n}-${o.value}-${E}`,I={id:j,protocol:n,value:o.value,top:N,middle:q,bottom:D,isFaceUp:!0,owner:"player",laneIndex:0,category:"Custom",keywords:{}},k=(T,Q)=>{T=T.replace("#","");const X=parseInt(T.substring(0,2),16),M=parseInt(T.substring(2,4),16),$=parseInt(T.substring(4,6),16);return`rgba(${X}, ${M}, ${$}, ${Q})`},L=`card-custom-preview pattern-${s}`,G={"--custom-color":r,"--custom-color-alpha-05":k(r,.05),"--custom-color-alpha-06":k(r,.06),"--custom-color-alpha-08":k(r,.08),"--custom-color-alpha-10":k(r,.1),"--custom-color-alpha-15":k(r,.15),"--custom-color-alpha-20":k(r,.2),"--custom-color-alpha-25":k(r,.25),borderColor:r};return l.jsxs("div",{className:"card-editor-container",children:[l.jsxs("div",{className:"card-editor-content",children:[l.jsxs("div",{className:"card-live-preview",children:[l.jsx("h4",{children:"Card Preview"}),l.jsxs("label",{className:"card-value-selector",children:["Card Value:",l.jsxs("select",{value:o.value,onChange:T=>S(Number(T.target.value)),children:[l.jsx("option",{value:-1,children:"-1"}),l.jsx("option",{value:0,children:"0"}),l.jsx("option",{value:1,children:"1"}),l.jsx("option",{value:2,children:"2"}),l.jsx("option",{value:3,children:"3"}),l.jsx("option",{value:4,children:"4"}),l.jsx("option",{value:5,children:"5"}),l.jsx("option",{value:6,children:"6"})]})]}),l.jsx("div",{className:"card-preview-wrapper",style:G,children:l.jsx(Rt,{card:I,isFaceUp:!0,additionalClassName:L},j)})]}),l.jsx("div",{className:"card-effects-editor",children:l.jsxs("div",{className:"card-preview",style:{borderColor:r},children:[l.jsx("div",{className:"card-header",style:{backgroundColor:r},children:l.jsxs("h3",{children:[n,"-",o.value]})}),l.jsxs("div",{className:"card-box top-box",children:[l.jsx("h4",{children:"Top Box (Passive/Reactive)"}),l.jsx("p",{className:"box-description",children:"Passive effects or reactive triggers"}),l.jsxs("div",{className:"effects-list",children:[o.topEffects.map((T,Q)=>l.jsxs("div",{className:"effect-item",children:[l.jsxs("span",{onClick:()=>C("top",Q),className:d?"read-only-clickable":"",children:[T.trigger!=="passive"&&l.jsxs("strong",{children:[A(T.trigger),":"]})," ",qt(T)]}),!d&&l.jsx("button",{onClick:()=>_("top",Q),children:""})]},T.id)),o.topEffects.length===0&&l.jsx("p",{className:"empty-box",children:"No effects"})]}),!d&&l.jsxs("div",{className:"add-effect-controls",children:[l.jsxs("select",{id:"top-trigger",defaultValue:"",children:[l.jsx("option",{value:"",children:"Choose Trigger"}),l.jsx("optgroup",{label:"Passive",children:l.jsx("option",{value:"passive",children:"Passive (always active)"})}),l.jsxs("optgroup",{label:"Phase Triggers",children:[l.jsx("option",{value:"start",children:"Start Phase"}),l.jsx("option",{value:"end",children:"End Phase"}),l.jsx("option",{value:"on_cover",children:"On Cover"})]}),l.jsxs("optgroup",{label:"Reactive Triggers",children:[l.jsx("option",{value:"after_delete",children:"After you delete cards"}),l.jsx("option",{value:"after_opponent_discard",children:"After opponent discards"}),l.jsx("option",{value:"after_draw",children:"After you draw cards"}),l.jsx("option",{value:"after_clear_cache",children:"After you clear cache"}),l.jsx("option",{value:"before_compile_delete",children:"Before deleted by compile"}),l.jsx("option",{value:"after_flip",children:"After cards are flipped"}),l.jsx("option",{value:"after_shift",children:"After cards are shifted"}),l.jsx("option",{value:"after_play",children:"After cards are played"}),l.jsx("option",{value:"on_flip",children:"When this card would be flipped"}),l.jsx("option",{value:"on_cover_or_flip",children:"When this card would be covered or flipped"})]})]}),l.jsxs("select",{id:"top-action",defaultValue:"",children:[l.jsx("option",{value:"",children:"Choose Action"}),l.jsx("option",{value:"draw",children:"Draw Cards"}),l.jsx("option",{value:"refresh",children:"Refresh Hand"}),l.jsx("option",{value:"mutual_draw",children:"Mutual Draw (Exchange)"}),l.jsx("option",{value:"flip",children:"Flip Cards"}),l.jsx("option",{value:"shift",children:"Shift Card"}),l.jsx("option",{value:"delete",children:"Delete Cards"}),l.jsx("option",{value:"discard",children:"Discard Cards"}),l.jsx("option",{value:"return",children:"Return to Hand"}),l.jsx("option",{value:"play",children:"Play from Hand/Deck"}),l.jsx("option",{value:"rearrange_protocols",children:"Rearrange Protocols"}),l.jsx("option",{value:"swap_protocols",children:"Swap Protocols"}),l.jsx("option",{value:"reveal",children:"Reveal Hand"}),l.jsx("option",{value:"give",children:"Give Cards"}),l.jsx("option",{value:"take",children:"Take from Hand"}),l.jsx("option",{value:"choice",children:"Either/Or Choice"}),l.jsx("option",{value:"passive_rule",children:"Passive Rule"}),l.jsx("option",{value:"value_modifier",children:"Value Modifier"}),l.jsx("option",{value:"block_compile",children:"Block Compile"}),l.jsx("option",{value:"delete_all_in_lane",children:"Delete All in Lane"})]}),l.jsx("button",{className:"btn btn-add-effect",onClick:()=>{const T=document.getElementById("top-trigger"),Q=document.getElementById("top-action"),X=T.value,M=Q.value;X&&M?(x("top",M,X),T.value="",Q.value=""):v(!0)},children:"+"})]})]}),l.jsxs("div",{className:"card-box middle-box",children:[l.jsx("h4",{children:"Middle Box (On Play)"}),l.jsx("p",{className:"box-description",children:"When played or uncovered"}),l.jsxs("div",{className:"effects-list",children:[o.middleEffects.map((T,Q)=>l.jsxs("div",{className:"effect-item",children:[l.jsx("span",{onClick:()=>C("middle",Q),className:d?"read-only-clickable":"",children:qt(T)}),!d&&l.jsx("button",{onClick:()=>_("middle",Q),children:""})]},T.id)),o.middleEffects.length===0&&l.jsx("p",{className:"empty-box",children:"No effects"})]}),!d&&l.jsxs("select",{onChange:T=>{T.target.value&&(x("middle",T.target.value,"on_play"),T.target.value="")},children:[l.jsx("option",{value:"",children:"+ Add Effect"}),l.jsx("option",{value:"draw",children:"Draw Cards"}),l.jsx("option",{value:"refresh",children:"Refresh Hand"}),l.jsx("option",{value:"flip",children:"Flip Cards"}),l.jsx("option",{value:"shift",children:"Shift Card"}),l.jsx("option",{value:"delete",children:"Delete Cards"}),l.jsx("option",{value:"discard",children:"Discard Cards"}),l.jsx("option",{value:"return",children:"Return to Hand"}),l.jsx("option",{value:"play",children:"Play from Hand/Deck"}),l.jsx("option",{value:"rearrange_protocols",children:"Rearrange Protocols"}),l.jsx("option",{value:"swap_protocols",children:"Swap Protocols"}),l.jsx("option",{value:"reveal",children:"Reveal Hand"}),l.jsx("option",{value:"give",children:"Give Cards"}),l.jsx("option",{value:"take",children:"Take from Hand"}),l.jsx("option",{value:"choice",children:"Either/Or Choice"}),l.jsx("option",{value:"passive_rule",children:"Passive Rule"}),l.jsx("option",{value:"value_modifier",children:"Value Modifier"}),l.jsx("option",{value:"block_compile",children:"Block Compile"}),l.jsx("option",{value:"delete_all_in_lane",children:"Delete All in Lane"})]})]}),l.jsxs("div",{className:"card-box bottom-box",children:[l.jsx("h4",{children:"Bottom Box (Triggered)"}),l.jsx("p",{className:"box-description",children:"Only when uncovered AND face-up"}),l.jsxs("div",{className:"effects-list",children:[o.bottomEffects.map((T,Q)=>l.jsxs("div",{className:"effect-item",children:[l.jsxs("span",{onClick:()=>C("bottom",Q),className:d?"read-only-clickable":"",children:[l.jsxs("strong",{children:[A(T.trigger),":"]})," ",qt(T)]}),!d&&l.jsx("button",{onClick:()=>_("bottom",Q),children:""})]},T.id)),o.bottomEffects.length===0&&l.jsx("p",{className:"empty-box",children:"No effects"})]}),!d&&l.jsxs("div",{className:"bottom-effect-add",children:[l.jsxs("select",{id:"bottom-trigger",children:[l.jsx("option",{value:"",children:"1. Choose Trigger"}),l.jsx("option",{value:"start",children:"Start Phase"}),l.jsx("option",{value:"end",children:"End Phase"}),l.jsx("option",{value:"on_cover",children:"On Cover"})]}),l.jsxs("select",{id:"bottom-action",children:[l.jsx("option",{value:"",children:"2. Choose Effect"}),l.jsx("option",{value:"draw",children:"Draw Cards"}),l.jsx("option",{value:"refresh",children:"Refresh Hand"}),l.jsx("option",{value:"mutual_draw",children:"Mutual Draw (Exchange)"}),l.jsx("option",{value:"flip",children:"Flip Cards"}),l.jsx("option",{value:"shift",children:"Shift Card"}),l.jsx("option",{value:"delete",children:"Delete Cards"}),l.jsx("option",{value:"discard",children:"Discard Cards"}),l.jsx("option",{value:"return",children:"Return to Hand"}),l.jsx("option",{value:"play",children:"Play from Hand/Deck"}),l.jsx("option",{value:"rearrange_protocols",children:"Rearrange Protocols"}),l.jsx("option",{value:"swap_protocols",children:"Swap Protocols"}),l.jsx("option",{value:"reveal",children:"Reveal Hand"}),l.jsx("option",{value:"give",children:"Give Cards"}),l.jsx("option",{value:"take",children:"Take from Hand"}),l.jsx("option",{value:"choice",children:"Either/Or Choice"}),l.jsx("option",{value:"passive_rule",children:"Passive Rule"}),l.jsx("option",{value:"value_modifier",children:"Value Modifier"}),l.jsx("option",{value:"block_compile",children:"Block Compile"}),l.jsx("option",{value:"delete_all_in_lane",children:"Delete All in Lane"})]}),l.jsx("button",{className:"btn btn-add-effect",onClick:()=>{const T=document.getElementById("bottom-trigger"),Q=document.getElementById("bottom-action"),X=T.value,M=Q.value;X&&M?(x("bottom",M,X),T.value="",Q.value=""):v(!0)},children:"+"})]})]})]})})]}),f&&l.jsxs("div",{className:"effect-parameter-editor",children:[l.jsx("h3",{children:d?"View Effect":"Configure Effect"}),d&&l.jsx("div",{className:"read-only-notice",children:"This effect is read-only"}),l.jsx(w0,{effect:f.effect,onChange:U,readOnly:d}),l.jsx("button",{onClick:()=>m(null),className:"btn",children:d?"Close":"Done"})]}),h&&l.jsx("div",{className:"custom-protocol-modal-overlay",onClick:()=>p(null),children:l.jsxs("div",{className:"custom-protocol-modal-content",onClick:T=>T.stopPropagation(),children:[l.jsx("h3",{children:"Delete Effect"}),l.jsx("p",{children:"Are you sure you want to delete this effect?"}),l.jsxs("div",{className:"custom-protocol-modal-actions",children:[l.jsx("button",{onClick:()=>p(null),className:"btn btn-back",children:"Cancel"}),l.jsx("button",{onClick:w,className:"btn btn-delete",children:"Delete"})]})]})}),y&&l.jsx("div",{className:"custom-protocol-modal-overlay",onClick:()=>v(!1),children:l.jsxs("div",{className:"custom-protocol-modal-content",onClick:T=>T.stopPropagation(),children:[l.jsx("h3",{children:"Missing Selection"}),l.jsx("p",{children:"Please select both a trigger and an effect before adding."}),l.jsx("div",{className:"custom-protocol-modal-actions",children:l.jsx("button",{onClick:()=>v(!1),className:"btn",children:"OK"})})]})})]})},b0=o=>{switch(o){case"draw":return{action:"draw",count:1,target:"self",source:"own_deck"};case"flip":return{action:"flip",count:1,targetFilter:{owner:"any",position:"any",faceState:"any",excludeSelf:!1},optional:!1};case"shift":return{action:"shift",targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1}};case"delete":return{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"any"},excludeSelf:!0};case"discard":return{action:"discard",count:1,actor:"self"};case"return":return{action:"return",count:1,targetFilter:{},scope:{type:"any_card"}};case"play":return{action:"play",source:"hand",count:1,faceDown:!0,destinationRule:{type:"other_lines"}};case"rearrange_protocols":return{action:"rearrange_protocols",target:"own"};case"swap_protocols":return{action:"swap_protocols",target:"own"};case"reveal":case"give":return{action:o,source:"own_hand",count:1};case"take":return{action:"take",source:"opponent_hand",count:1,random:!0};case"choice":return{action:"choice",options:[]};case"passive_rule":return{action:"passive_rule",rule:{type:"block_all_play",target:"opponent",scope:"this_lane"}};case"value_modifier":return{action:"value_modifier",modifier:{type:"add_per_condition",value:1,condition:"per_face_down_card",target:"own_total",scope:"this_lane"}};default:return{}}},S0=(o,n)=>{const r=(i,d)=>{i=i.replace("#","");const f=parseInt(i.substring(0,2),16),m=parseInt(i.substring(2,4),16),h=parseInt(i.substring(4,6),16);return`rgba(${f}, ${m}, ${h}, ${d})`},s={borderColor:n};switch(o){case"solid":return{...s,backgroundColor:n};case"radial":return{...s,backgroundColor:"var(--surface-color)",backgroundImage:`radial-gradient(circle at 50% 50%, ${r(n,.25)} 0%, transparent 60%)`};case"dual-radial":return{...s,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 0% 0%, ${r(n,.2)}, transparent 50%),
                    radial-gradient(at 100% 100%, ${r(n,.2)}, transparent 50%)
                `};case"multi-radial":return{...s,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 0%, ${r(n,.2)}, transparent 70%),
                    radial-gradient(circle at 20% 30%, ${r(n,.15)}, transparent 40%),
                    radial-gradient(circle at 80% 70%, ${r(n,.2)}, transparent 50%)
                `};case"chaos":return{...s,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 10% 10%, hsla(60, 100%, 50%, 0.15), transparent 30%),
                    radial-gradient(at 90% 20%, hsla(180, 100%, 50%, 0.15), transparent 35%),
                    radial-gradient(at 30% 80%, hsla(300, 100%, 50%, 0.15), transparent 40%),
                    radial-gradient(at 70% 60%, hsla(0, 100%, 50%, 0.1), transparent 25%)
                `};case"grid":return{...s,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(circle at 50% 50%, ${r(n,.2)} 0%, transparent 40%),
                    linear-gradient(hsla(0,0%,100%,0.03) 1px, transparent 1px),
                    linear-gradient(90deg, hsla(0,0%,100%,0.03) 1px, transparent 1px)
                `,backgroundSize:"100% 100%, 20px 20px, 20px 20px"};case"diagonal-lines":return{...s,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 0% 100%, ${r(n,.25)}, transparent 70%),
                    repeating-linear-gradient(120deg, transparent, transparent 15px, ${r(n,.05)} 15px, ${r(n,.05)} 30px)
                `};case"cross-diagonal":return{...s,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 50%, ${r(n,.25)} 0%, transparent 50%),
                    repeating-linear-gradient(45deg, transparent, transparent 8px, ${r(n,.08)} 8px, ${r(n,.08)} 16px),
                    repeating-linear-gradient(-45deg, transparent, transparent 8px, ${r(n,.06)} 8px, ${r(n,.06)} 16px)
                `};case"horizontal-lines":return{...s,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 80% 80%, ${r(n,.1)}, transparent 50%),
                    repeating-linear-gradient(0deg, hsla(0,0%,100%,0.02), hsla(0,0%,100%,0.02) 1px, transparent 1px, transparent 3px)
                `};case"vertical-lines":return{...s,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 10% 10%, ${r(n,.2)}, transparent 50%),
                    repeating-linear-gradient(175deg, transparent, transparent 1px, ${r(n,.05)} 1px, ${r(n,.05)} 2px)
                `};case"cross":return{...s,backgroundColor:"var(--surface-color)",backgroundImage:`
                    linear-gradient(0deg, transparent 40%, ${r(n,.1)} 50%, transparent 60%),
                    linear-gradient(90deg, transparent 48%, ${r(n,.2)} 50%, transparent 52%)
                `};case"hexagons":return{...s,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 0%, ${r(n,.2)}, transparent 70%),
                    url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='28' height='49' viewBox='0 0 28 49'%3E%3Cg fill-rule='evenodd'%3E%3Cg id='hexagons' fill='%23ffffff' fill-opacity='0.05' fill-rule='nonzero'%3E%3Cpath d='M13.99 9.25l13 7.5v15l-13 7.5L1 31.75v-15l12.99-7.5zM3 17.9v12.7l10.99 6.34 11-6.35V17.9l-11-6.34L3 17.9zM0 15l12.99-7.5L26 15v18.5l-13 7.5L0 33.5V15z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")
                `};case"stripes":return{...s,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 100%, ${r(n,.25)}, transparent 60%),
                    linear-gradient(135deg, hsla(0,0%,0%,0.1) 23%, transparent 23%, transparent 25%, hsla(0,0%,0%,0.1) 25%, hsla(0,0%,0%,0.1) 27%, transparent 27%, transparent 73%, hsla(0,0%,0%,0.1) 73%, hsla(0,0%,0%,0.1) 75%, transparent 75%, transparent 77%, hsla(0,0%,0%,0.1) 77%)
                `};case"frost":return{...s,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(circle at 50% 50%, ${r(n,.2)} 0%, transparent 50%),
                    repeating-linear-gradient(30deg, transparent, transparent 10px, ${r(n,.08)} 10px, ${r(n,.08)} 11px),
                    repeating-linear-gradient(-30deg, transparent, transparent 10px, ${r(n,.08)} 10px, ${r(n,.08)} 11px),
                    repeating-linear-gradient(90deg, transparent, transparent 8px, ${r(n,.05)} 8px, ${r(n,.05)} 9px)
                `};default:return s}},E0=[{name:"Anarchy",hex:"#EA5A3C"},{name:"Apathy",hex:"#989A9A"},{name:"Chaos",hex:"#E53FE5"},{name:"Darkness",hex:"#A772D4"},{name:"Death",hex:"#E25656"},{name:"Fire",hex:"#F06838"},{name:"Gravity",hex:"#7599EB"},{name:"Hate",hex:"#E03E5E"},{name:"Life",hex:"#3CE076"},{name:"Light",hex:"#FFEB7F"},{name:"Love",hex:"#F074D9"},{name:"Metal",hex:"#B3B8BD"},{name:"Plague",hex:"#A2CD3A"},{name:"Psychic",hex:"#C971EB"},{name:"Speed",hex:"#33DDDD"},{name:"Spirit",hex:"#42D4A8"},{name:"Water",hex:"#3FA4EB"}],j0=[{name:"Solid",value:"solid",description:"Solid color background"},{name:"Radial Glow",value:"radial",description:"Single radial gradient glow"},{name:"Dual Radial",value:"dual-radial",description:"Two radial gradient spots"},{name:"Multi Radial",value:"multi-radial",description:"Multiple radial gradient spots"},{name:"Chaos",value:"chaos",description:"Colorful chaotic spots"},{name:"Grid",value:"grid",description:"Grid line pattern"},{name:"Diagonal Lines",value:"diagonal-lines",description:"Repeating diagonal lines"},{name:"Cross Diagonal",value:"cross-diagonal",description:"Crossed diagonal lines"},{name:"Horizontal Lines",value:"horizontal-lines",description:"Fine horizontal lines"},{name:"Vertical Lines",value:"vertical-lines",description:"Fine vertical lines"},{name:"Cross Pattern",value:"cross",description:"Cross/plus pattern"},{name:"Hexagons",value:"hexagons",description:"Hexagon pattern"},{name:"Stripes",value:"stripes",description:"Diagonal stripe pattern"},{name:"Frost",value:"frost",description:"Icy crystalline pattern with crossing lines"}],A0=({onSave:o,onCancel:n,onDelete:r,initialProtocol:s})=>{const[i,d]=ce.useState("name"),[f,m]=ce.useState(0),[h,p]=ce.useState(!1),[y,v]=ce.useState(""),[x,_]=ce.useState(!1),w=s?rl(s):!1;console.log("ProtocolWizard render - initialProtocol:",s,"isReadOnly:",w);const[U,C]=ce.useState((s==null?void 0:s.name)||""),[A,S]=ce.useState((s==null?void 0:s.description)||""),[N,q]=ce.useState((s==null?void 0:s.color)||"#1976D2"),[D,E]=ce.useState((s==null?void 0:s.pattern)||"solid"),[j,I]=ce.useState((s==null?void 0:s.cards)||[{value:0,topEffects:[],middleEffects:[],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[],bottomEffects:[]}]);console.log("ProtocolWizard state - name:",U,"color:",N,"pattern:",D);const k=()=>{if(i==="name"){if(!U.trim()){alert("Please enter a protocol name.");return}d("color")}else i==="color"?d("pattern"):i==="pattern"&&d("cards")},L=W=>{const P=[...j];P[f]=W,I(P)},G=()=>{const W={id:(s==null?void 0:s.id)||Ge(),name:U,description:A,author:"Player",createdAt:(s==null?void 0:s.createdAt)||new Date().toISOString(),color:N,pattern:D,cards:j};o(W)},T=()=>{s&&r&&r(s.id),_(!1)},Q=()=>{const W={id:(s==null?void 0:s.id)||Ge(),name:U,description:A,author:"Player",createdAt:(s==null?void 0:s.createdAt)||new Date().toISOString(),color:N,pattern:D,cards:j},P=JSON.stringify(W,null,2);v(P),p(!0)},X=()=>{navigator.clipboard.writeText(y).then(()=>{alert("Protocol JSON copied to clipboard!"),p(!1)}).catch(()=>{alert("Failed to copy to clipboard. Please try again.")})},M=W=>!(!U.trim()&&W!=="name"),$=W=>{if(!M(W)){alert("Please enter a protocol name first.");return}d(W)};return l.jsxs("div",{className:"protocol-wizard",children:[l.jsxs("div",{className:"wizard-header",children:[l.jsxs("h2",{children:[w?`View Protocol: ${U}`:s?`Edit Protocol: ${U}`:"Create New Protocol",w&&l.jsx("span",{className:"read-only-badge",children:"Read-Only"})]}),l.jsxs("div",{className:"wizard-progress",children:[l.jsx("button",{className:`step ${i==="name"?"active":"done"}`,onClick:()=>$("name"),type:"button",children:"1. Name"}),l.jsx("button",{className:`step ${i==="color"?"active":i==="pattern"||i==="cards"?"done":""}`,onClick:()=>$("color"),disabled:!M("color"),type:"button",children:"2. Color"}),l.jsx("button",{className:`step ${i==="pattern"?"active":i==="cards"?"done":""}`,onClick:()=>$("pattern"),disabled:!M("pattern"),type:"button",children:"3. Pattern"}),l.jsx("button",{className:`step ${i==="cards"?"active":""}`,onClick:()=>$("cards"),disabled:!M("cards"),type:"button",children:"4. Cards"})]})]}),l.jsxs("div",{className:"wizard-content",children:[i==="name"&&l.jsxs("div",{className:"wizard-step name-step",children:[l.jsx("h3",{children:"Step 1: Name and Description"}),l.jsxs("label",{children:["Protocol Name *",l.jsx("input",{type:"text",value:U,onChange:W=>!w&&C(W.target.value),placeholder:"e.g. Lightning, Shadow, Void",autoFocus:!0,readOnly:w,className:w?"read-only":""})]}),l.jsxs("label",{children:["Description",l.jsx("textarea",{value:A,onChange:W=>!w&&S(W.target.value),placeholder:"Describe the strategy and theme of your protocol",rows:4,readOnly:w,className:w?"read-only":""})]})]}),i==="color"&&l.jsxs("div",{className:"wizard-step color-step",children:[l.jsx("h3",{children:"Step 2: Choose Color"}),l.jsx("div",{className:"color-preview",style:{backgroundColor:N},children:l.jsx("span",{children:U||"Your Protocol"})}),l.jsx("h4",{children:"Predefined Colors"}),l.jsx("div",{className:`color-grid ${w?"read-only":""}`,children:E0.map(W=>l.jsx("button",{className:`color-option ${N===W.hex?"selected":""}`,style:{backgroundColor:W.hex},onClick:()=>!w&&q(W.hex),title:W.name,disabled:w,children:N===W.hex&&""},W.hex))}),l.jsx("h4",{children:"Custom Color"}),l.jsxs("div",{className:"custom-color",children:[l.jsx("input",{type:"color",value:N,onChange:W=>!w&&q(W.target.value),disabled:w}),l.jsx("input",{type:"text",value:N,onChange:W=>!w&&q(W.target.value),placeholder:"#1976D2",readOnly:w,className:w?"read-only":""})]})]}),i==="pattern"&&l.jsxs("div",{className:"wizard-step pattern-step",children:[l.jsx("h3",{children:"Step 3: Choose Card Pattern"}),l.jsx("div",{className:`pattern-selection-grid ${w?"read-only":""}`,children:j0.map(W=>{const P=S0(W.value,N);return l.jsxs("div",{className:`pattern-option ${D===W.value?"selected":""}`,onClick:()=>!w&&E(W.value),children:[l.jsxs("div",{className:"pattern-preview",style:P,children:[U||"Protocol","-0"]}),l.jsx("h4",{children:W.name}),l.jsx("p",{children:W.description}),D===W.value&&l.jsx("div",{className:"selected-badge",children:" Selected"})]},W.value)})})]}),i==="cards"&&l.jsxs("div",{className:"wizard-step cards-step",children:[l.jsx("h3",{children:"Step 4: Configure Cards"}),l.jsx("div",{className:"card-navigation",children:j.map((W,P)=>l.jsxs("button",{className:`card-nav-btn ${f===P?"active":""}`,onClick:()=>m(P),type:"button",children:["Card ",W.value]},P))}),l.jsx(C0,{card:j[f],protocolName:U,protocolColor:N,protocolPattern:D,onChange:L,readOnly:w})]})]}),l.jsxs("div",{className:"wizard-actions",children:[l.jsxs("div",{className:"wizard-actions-left",children:[l.jsx("button",{onClick:n,className:"btn btn-back",children:w?"Back":"Cancel"}),s&&r&&!w&&l.jsx("button",{onClick:()=>_(!0),className:"btn btn-delete",children:"Delete Protocol"})]}),l.jsxs("div",{className:"wizard-actions-right",children:[s&&l.jsxs(l.Fragment,{children:[l.jsx("button",{onClick:Q,className:"btn btn-export",children:"Export JSON"}),!w&&l.jsx("button",{onClick:G,className:"btn",children:"Save"})]}),!s&&l.jsxs(l.Fragment,{children:[i!=="cards"&&l.jsx("button",{onClick:k,className:"btn",children:"Next"}),i==="cards"&&l.jsxs(l.Fragment,{children:[l.jsx("button",{onClick:Q,className:"btn btn-export",children:"Export JSON"}),l.jsx("button",{onClick:G,className:"btn",children:"Save"})]})]})]})]}),h&&l.jsx("div",{className:"custom-protocol-modal-overlay",onClick:()=>p(!1),children:l.jsxs("div",{className:"custom-protocol-modal-content custom-protocol-modal-large",onClick:W=>W.stopPropagation(),children:[l.jsx("h3",{children:"Export Protocol JSON"}),l.jsx("p",{children:"Copy the JSON below to share or backup your protocol:"}),l.jsx("textarea",{value:y,readOnly:!0,rows:15,className:"export-textarea",onClick:W=>W.target.select()}),l.jsxs("div",{className:"custom-protocol-modal-actions",children:[l.jsx("button",{onClick:()=>p(!1),className:"btn btn-back",children:"Close"}),l.jsx("button",{onClick:X,className:"btn",children:"Copy to Clipboard"})]})]})}),x&&l.jsx("div",{className:"custom-protocol-modal-overlay",onClick:()=>_(!1),children:l.jsxs("div",{className:"custom-protocol-modal-content",onClick:W=>W.stopPropagation(),children:[l.jsx("h3",{children:"Delete Protocol"}),l.jsxs("p",{children:['Are you sure you want to delete "',U,'"?']}),l.jsx("p",{style:{color:"var(--danger-color)",fontSize:"0.9rem"},children:"This action cannot be undone."}),l.jsxs("div",{className:"custom-protocol-modal-actions",children:[l.jsx("button",{onClick:()=>_(!1),className:"btn btn-back",children:"Cancel"}),l.jsx("button",{onClick:T,className:"btn btn-delete",children:"Delete"})]})]})})]})},R0=({onBack:o})=>{const[n,r]=ce.useState("list"),[s,i]=ce.useState([]),[d,f]=ce.useState(void 0);ce.useEffect(()=>{m()},[]);const m=()=>{const w=ma();i(w)},h=()=>{f(void 0),r("create")},p=w=>{console.log("handleEdit called with protocol:",w),f(w),r("edit"),console.log("View set to edit, editingProtocol:",w)},y=w=>{bv(w),ir(),m(),r("list"),f(void 0)},v=w=>{Nt(w),ir(),m(),r("list"),f(void 0)},x=w=>{Nt(w),ir(),m()},_=()=>{r("list"),f(void 0)};return l.jsxs("div",{className:"custom-protocol-creator",children:[n==="list"&&l.jsx(jv,{protocols:s,onCreateNew:h,onEdit:p,onDelete:y,onImport:x,onBack:o}),(n==="create"||n==="edit")&&l.jsx(A0,{onSave:v,onCancel:_,onDelete:y,initialProtocol:d})]})},D0={id:"spirit-1-example",protocol:"Spirit",value:1,top:"When you play cards face-up, they may be played without matching protocols.",middle:"Draw 2 cards.",bottom:'<span class="emphasis">Start:</span> Either discard 1 card or flip this card.',isFaceUp:!0,category:"Main 1",keywords:{}},T0={id:"face-down-example",protocol:"Spirit",value:1,top:"",middle:"",bottom:"",isFaceUp:!1,category:"Main 1",keywords:{}},k0=[{id:"opp-light-4",protocol:"Light",value:4,top:"",middle:"Your opponent reveals their hand.",bottom:"",isFaceUp:!0,category:"Main 1",keywords:{reveal:!0}}],N0=[{id:"opp-spirit-3",protocol:"Spirit",value:3,top:"<div><span class='emphasis'>After you draw cards:</span> You may shift this card, even if this card is covered.</div>",middle:"",bottom:"",isFaceUp:!0,category:"Main 1",keywords:{shift:!0}},{id:"opp-spirit-2",protocol:"Spirit",value:2,top:"",middle:"You may flip 1 card.",bottom:"",isFaceUp:!0,category:"Main 1",keywords:{flip:!0}}],F0=[{id:"opp-water-3",protocol:"Water",value:3,top:"",middle:"Return all cards with a value of 2 in 1 line.",bottom:"",isFaceUp:!0,category:"Main 1",keywords:{return:!0}}],q0=[{id:"player-darkness-5",protocol:"Darkness",value:5,top:"",middle:"You discard 1 card.",bottom:"",isFaceUp:!0,category:"Main 1",keywords:{discard:!0}},{id:"player-facedown-0",protocol:"Darkness",value:2,top:"",middle:"",bottom:"",isFaceUp:!1,category:"Main 1",keywords:{}}],U0=[{id:"player-plague-1",protocol:"Plague",value:1,top:"<div><span class='emphasis'>After your opponent discards cards:</span> Draw 1 card.</div>",middle:"Your opponent discards 1 card.",bottom:"",isFaceUp:!0,category:"Main 1",keywords:{draw:!0,discard:!0}},{id:"player-plague-5",protocol:"Plague",value:5,top:"",middle:"You discard 1 card.",bottom:"",isFaceUp:!0,category:"Main 1",keywords:{discard:!0}},{id:"player-plague-4",protocol:"Plague",value:4,top:"",middle:"",bottom:"<div><span class='emphasis'>End:</span> Your opponent deletes 1 of their face-down cards. You may flip this card.</div>",isFaceUp:!0,category:"Main 1",keywords:{delete:!0,flip:!0}}],$0=[{id:"player-death-0",protocol:"Death",value:0,top:"",middle:"Delete 1 card from each other line.",bottom:"",isFaceUp:!0,category:"Main 1",keywords:{delete:!0}},{id:"player-facedown-3",protocol:"Death",value:2,top:"",middle:"",bottom:"",isFaceUp:!1,category:"Main 1",keywords:{}}],Po={opponent:["Light","Spirit","Water"],player:["Darkness","Plague","Death"],opponentCompiled:[!0,!1,!1],playerCompiled:[!1,!1,!1],opponentValues:[4,5,3],playerValues:[7,10,2]};function O0({onBack:o}){const n=[k0,N0,F0],r=[q0,U0,$0];return l.jsxs("div",{className:"screen rules-screen",children:[l.jsx($c,{title:"GAME RULES",onBack:o}),l.jsxs("div",{className:"rules-content",children:[l.jsxs("section",{className:"rules-section",children:[l.jsx("h2",{className:"section-title",children:"Objective"}),l.jsxs("div",{className:"rules-text",children:[l.jsxs("p",{children:["You play as an artificial intelligence trying to ",l.jsx("span",{className:"emphasis",children:"compile your 3 protocols"}),". Play command cards on protocols and execute their effects. If you reach a total value of",l.jsx("span",{className:"emphasis",children:" at least 10"})," with your cards on a protocol and exceed the opponent's total value in the same line, you may compile that protocol."]}),l.jsx("p",{className:"rules-highlight",children:"The first player to compile all 3 protocols wins!"})]})]}),l.jsxs("section",{className:"rules-section field-overview-section",children:[l.jsx("h2",{className:"section-title",children:"The Field"}),l.jsx("div",{className:"field-intro",children:l.jsxs("p",{children:["The field consists of ",l.jsx("span",{className:"emphasis",children:"3 lines"}),", each passing through two opposing protocols. Both players place cards on their side of each line. The goal is to build up value in your stacks to reach the compile threshold."]})}),l.jsxs("div",{className:"demo-board-container",children:[l.jsxs("div",{className:"demo-board",children:[l.jsx("div",{className:"demo-side-label opponent-label",children:"Opponent"}),l.jsx("div",{className:"demo-player-side demo-opponent-side",children:l.jsx("div",{className:"demo-lanes",children:n.map((s,i)=>l.jsx("div",{className:`demo-lane ${Po.opponentCompiled[i]?"demo-lane-compiled":""}`,children:l.jsx("div",{className:"demo-lane-stack",children:s.map((d,f)=>l.jsx(Rt,{card:d,isFaceUp:d.isFaceUp,style:{"--i":f},faceDownValue:2},d.id))})},`opp-lane-${i}`))})}),l.jsxs("div",{className:"demo-protocol-bars-container",children:[l.jsx("div",{className:"demo-protocol-bar demo-opponent-bar",children:Po.opponent.map((s,i)=>l.jsxs("div",{className:`demo-protocol-display ${Po.opponentCompiled[i]?"compiled":""}`,children:[l.jsx("span",{className:"demo-protocol-name",children:s}),l.jsx("span",{className:"demo-protocol-value",children:Po.opponentValues[i]})]},`opp-proto-${i}`))}),l.jsx("div",{className:"demo-protocol-bar demo-player-bar",children:Po.player.map((s,i)=>l.jsxs("div",{className:`demo-protocol-display ${Po.playerCompiled[i]?"compiled":""}`,children:[l.jsx("span",{className:"demo-protocol-name",children:s}),l.jsx("span",{className:"demo-protocol-value",children:Po.playerValues[i]})]},`player-proto-${i}`))})]}),l.jsx("div",{className:"demo-player-side",children:l.jsx("div",{className:"demo-lanes",children:r.map((s,i)=>l.jsx("div",{className:`demo-lane ${Po.playerCompiled[i]?"demo-lane-compiled":""} ${i===1?"demo-lane-compilable":""}`,children:l.jsx("div",{className:"demo-lane-stack",children:s.map((d,f)=>l.jsx(Rt,{card:d,isFaceUp:d.isFaceUp,style:{"--i":f},faceDownValue:2},d.id))})},`player-lane-${i}`))})}),l.jsx("div",{className:"demo-side-label player-label",children:"You"})]}),l.jsxs("div",{className:"demo-board-annotations",children:[l.jsxs("div",{className:"demo-annotation compiled-annotation",children:[l.jsx("div",{className:"demo-annotation-marker compiled-marker",children:"1"}),l.jsxs("div",{className:"demo-annotation-content",children:[l.jsx("strong",{children:"Compiled Protocol"}),l.jsx("p",{children:"Light has been compiled by the opponent! The protocol bar glows cyan."})]})]}),l.jsxs("div",{className:"demo-annotation compilable-annotation",children:[l.jsx("div",{className:"demo-annotation-marker compilable-marker",children:"2"}),l.jsxs("div",{className:"demo-annotation-content",children:[l.jsx("strong",{children:"Ready to Compile!"}),l.jsx("p",{children:"Plague has value 10 (1+5+4) which is 10 and higher than opponent's Spirit at 5. This protocol can be compiled!"})]})]}),l.jsxs("div",{className:"demo-annotation inprogress-annotation",children:[l.jsx("div",{className:"demo-annotation-marker inprogress-marker",children:"3"}),l.jsxs("div",{className:"demo-annotation-content",children:[l.jsx("strong",{children:"In Progress"}),l.jsx("p",{children:"Death/Water lanes are still building up. Keep playing cards to reach the compile threshold of 10!"})]})]}),l.jsxs("div",{className:"demo-annotation topbox-annotation",children:[l.jsx("div",{className:"demo-annotation-marker topbox-marker",children:"4"}),l.jsxs("div",{className:"demo-annotation-content",children:[l.jsx("strong",{children:"Top Effect Always Visible"}),l.jsx("p",{children:"See Plague-1's top effect? It stays active even when covered! Top effects are always visible and active on face-up cards."})]})]})]})]}),l.jsxs("div",{className:"field-legend",children:[l.jsxs("div",{className:"legend-item",children:[l.jsx("div",{className:"legend-swatch legend-compiled"}),l.jsx("span",{children:"Compiled Protocol"})]}),l.jsxs("div",{className:"legend-item",children:[l.jsx("div",{className:"legend-swatch legend-compilable"}),l.jsx("span",{children:"Ready to Compile (10 value & higher than opponent)"})]}),l.jsxs("div",{className:"legend-item",children:[l.jsx("div",{className:"legend-swatch legend-facedown"}),l.jsx("span",{children:"Face-down Card (base value: 2)"})]})]})]}),l.jsxs("section",{className:"rules-section card-anatomy-section",children:[l.jsx("h2",{className:"section-title",children:"Card Anatomy"}),l.jsxs("div",{className:"card-anatomy-layout",children:[l.jsx("div",{className:"card-anatomy-display",children:l.jsxs("div",{className:"anatomy-card-wrapper",children:[l.jsx(Rt,{card:D0,isFaceUp:!0}),l.jsxs("div",{className:"anatomy-annotation annotation-protocol",children:[l.jsx("div",{className:"annotation-line annotation-line-left"}),l.jsxs("div",{className:"annotation-label",children:[l.jsx("span",{className:"annotation-letter",children:"A"}),l.jsx("span",{className:"annotation-text",children:"Protocol"})]})]}),l.jsxs("div",{className:"anatomy-annotation annotation-value",children:[l.jsx("div",{className:"annotation-line annotation-line-right"}),l.jsxs("div",{className:"annotation-label",children:[l.jsx("span",{className:"annotation-letter",children:"B"}),l.jsx("span",{className:"annotation-text",children:"Value"})]})]}),l.jsxs("div",{className:"anatomy-annotation annotation-top",children:[l.jsx("div",{className:"annotation-line annotation-line-right"}),l.jsxs("div",{className:"annotation-label",children:[l.jsx("span",{className:"annotation-letter",children:"C"}),l.jsx("span",{className:"annotation-text",children:"Top Effect"})]})]}),l.jsxs("div",{className:"anatomy-annotation annotation-middle",children:[l.jsx("div",{className:"annotation-line annotation-line-right"}),l.jsxs("div",{className:"annotation-label",children:[l.jsx("span",{className:"annotation-letter",children:"D"}),l.jsx("span",{className:"annotation-text",children:"Middle Effect"})]})]}),l.jsxs("div",{className:"anatomy-annotation annotation-bottom",children:[l.jsx("div",{className:"annotation-line annotation-line-right"}),l.jsxs("div",{className:"annotation-label",children:[l.jsx("span",{className:"annotation-letter",children:"E"}),l.jsx("span",{className:"annotation-text",children:"Bottom Effect"})]})]})]})}),l.jsxs("div",{className:"card-anatomy-descriptions",children:[l.jsxs("div",{className:"anatomy-item",children:[l.jsx("span",{className:"anatomy-letter",children:"A"}),l.jsxs("div",{className:"anatomy-desc",children:[l.jsx("strong",{children:"Protocol Indicator"}),l.jsx("p",{children:"Dictates which line a card can be played face-up in. Cards must match the protocol of that line."})]})]}),l.jsxs("div",{className:"anatomy-item",children:[l.jsx("span",{className:"anatomy-letter",children:"B"}),l.jsxs("div",{className:"anatomy-desc",children:[l.jsx("strong",{children:"Value"}),l.jsx("p",{children:"The value added to the total value of a stack. Higher values help you reach the compile threshold of 10."})]})]}),l.jsxs("div",{className:"anatomy-item anatomy-item-highlight",children:[l.jsx("span",{className:"anatomy-letter",children:"C"}),l.jsxs("div",{className:"anatomy-desc",children:[l.jsx("strong",{children:"Top Command - Persistent"}),l.jsxs("p",{children:["While this card is face-up, this passive text is ",l.jsx("span",{className:"emphasis",children:"always active"}),", even when covered by other cards."]})]})]}),l.jsxs("div",{className:"anatomy-item anatomy-item-highlight",children:[l.jsx("span",{className:"anatomy-letter",children:"D"}),l.jsxs("div",{className:"anatomy-desc",children:[l.jsx("strong",{children:"Middle Command - Immediate"}),l.jsx("p",{children:"Resolve this active text immediately when the card is played, flipped face-up, or uncovered."})]})]}),l.jsxs("div",{className:"anatomy-item anatomy-item-highlight",children:[l.jsx("span",{className:"anatomy-letter",children:"E"}),l.jsxs("div",{className:"anatomy-desc",children:[l.jsx("strong",{children:"Bottom Command - Auxiliary"}),l.jsxs("p",{children:['This passive text (often triggered effects like "Start:" or "End:") is only active when the card is ',l.jsx("span",{className:"emphasis",children:"uncovered"}),"."]})]})]})]})]})]}),l.jsxs("section",{className:"rules-section face-down-section",children:[l.jsx("h2",{className:"section-title",children:"Face-Down Cards"}),l.jsxs("div",{className:"face-down-layout",children:[l.jsx("div",{className:"face-down-card-wrapper",children:l.jsx(Rt,{card:T0,isFaceUp:!1,faceDownValue:2})}),l.jsxs("div",{className:"face-down-description",children:[l.jsxs("p",{children:["Cards can be played ",l.jsx("span",{className:"emphasis",children:"face-down"})," into any line, regardless of protocol matching."]}),l.jsxs("ul",{children:[l.jsxs("li",{children:["Face-down cards have a ",l.jsx("span",{className:"emphasis",children:"base value of 2"})]}),l.jsx("li",{children:"No effects are active while face-down"}),l.jsx("li",{children:"Can be flipped face-up by card effects"}),l.jsx("li",{children:"When flipped, the middle effect triggers"}),l.jsx("li",{children:"Some cards modify face-down values (e.g., Darkness-2)"})]})]})]})]}),l.jsxs("section",{className:"rules-section",children:[l.jsx("h2",{className:"section-title",children:"Turn Order"}),l.jsxs("div",{className:"turn-order-grid",children:[l.jsxs("div",{className:"turn-phase",children:[l.jsx("span",{className:"phase-number",children:"1"}),l.jsxs("div",{className:"phase-content",children:[l.jsx("strong",{children:"Start Phase"}),l.jsx("p",{children:'Resolve all visible "Start" effects of your face-up command cards.'})]})]}),l.jsxs("div",{className:"turn-phase",children:[l.jsx("span",{className:"phase-number",children:"2"}),l.jsxs("div",{className:"phase-content",children:[l.jsx("strong",{children:"Check Control"}),l.jsx("p",{children:"If your total value is higher than opponent's in at least 2 lines, take the control component."})]})]}),l.jsxs("div",{className:"turn-phase",children:[l.jsx("span",{className:"phase-number",children:"3"}),l.jsxs("div",{className:"phase-content",children:[l.jsx("strong",{children:"Check Compile"}),l.jsx("p",{children:"If you can compile (10+ value and higher than opponent), you must compile one protocol."})]})]}),l.jsxs("div",{className:"turn-phase",children:[l.jsx("span",{className:"phase-number",children:"4"}),l.jsxs("div",{className:"phase-content",children:[l.jsx("strong",{children:"Action"}),l.jsx("p",{children:"Play 1 card from hand OR refresh your hand (draw until you have 5 cards)."})]})]}),l.jsxs("div",{className:"turn-phase",children:[l.jsx("span",{className:"phase-number",children:"5"}),l.jsxs("div",{className:"phase-content",children:[l.jsx("strong",{children:"Check Cache"}),l.jsx("p",{children:"If you have more than 5 cards, discard down to 5."})]})]}),l.jsxs("div",{className:"turn-phase",children:[l.jsx("span",{className:"phase-number",children:"6"}),l.jsxs("div",{className:"phase-content",children:[l.jsx("strong",{children:"End Phase"}),l.jsx("p",{children:'Resolve all visible "End" effects of your face-up command cards.'})]})]})]})]}),l.jsxs("section",{className:"rules-section glossary-section",children:[l.jsx("h2",{className:"section-title",children:"Glossary"}),l.jsxs("div",{className:"glossary-grid",children:[l.jsxs("div",{className:"glossary-item",children:[l.jsx("strong",{children:"Compile"}),l.jsx("p",{children:'Delete all cards in a line on both sides and flip your protocol to "Compiled".'})]}),l.jsxs("div",{className:"glossary-item",children:[l.jsx("strong",{children:"Covered"}),l.jsx("p",{children:"A card with another card on top of it. Only top effects remain active."})]}),l.jsxs("div",{className:"glossary-item",children:[l.jsx("strong",{children:"Uncovered"}),l.jsx("p",{children:"The topmost card in a stack, furthest from the protocol."})]}),l.jsxs("div",{className:"glossary-item",children:[l.jsx("strong",{children:"Delete"}),l.jsx("p",{children:"Move a card from the field to the trash."})]}),l.jsxs("div",{className:"glossary-item",children:[l.jsx("strong",{children:"Discard"}),l.jsx("p",{children:"Move a card from hand to the owner's trash."})]}),l.jsxs("div",{className:"glossary-item",children:[l.jsx("strong",{children:"Flip"}),l.jsx("p",{children:"Change a card from face-down to face-up, or vice versa."})]}),l.jsxs("div",{className:"glossary-item",children:[l.jsx("strong",{children:"Shift"}),l.jsx("p",{children:"Move a card to another line on the same side of the field."})]}),l.jsxs("div",{className:"glossary-item",children:[l.jsx("strong",{children:"Return"}),l.jsx("p",{children:"Move a card from the field to its owner's hand."})]}),l.jsxs("div",{className:"glossary-item",children:[l.jsx("strong",{children:"Reveal"}),l.jsx("p",{children:"Show hidden information publicly, then return it to its previous state."})]}),l.jsxs("div",{className:"glossary-item",children:[l.jsx("strong",{children:"Refresh"}),l.jsx("p",{children:"Draw cards until you have 5 cards in hand."})]}),l.jsxs("div",{className:"glossary-item",children:[l.jsx("strong",{children:"Line"}),l.jsx("p",{children:"The area passing through two opposing protocols. The field has 3 lines."})]}),l.jsxs("div",{className:"glossary-item",children:[l.jsx("strong",{children:"Stack"}),l.jsx("p",{children:"The cards in a line on one player's side."})]})]})]})]})]})}const L0="anarchy-custom-001",M0="Anarchy",I0="Custom recreation of Anarchy protocol to validate editor capabilities",P0="System Validation",H0="2025-11-08T00:00:00.000Z",B0="#8B0000",z0="chaos",V0=[{value:0,topEffects:[],middleEffects:[{id:"anarchy-0-shift",params:{action:"shift",targetFilter:{owner:"any",position:"uncovered",faceState:"any"}},position:"middle",trigger:"on_play"},{id:"anarchy-0-draw",params:{action:"draw",count:1,target:"self",source:"own_deck",conditional:{type:"non_matching_protocols"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[{id:"anarchy-1-passive",params:{action:"passive_rule",rule:{type:"require_non_matching_protocol",target:"all",scope:"global"}},position:"top",trigger:"passive"}],middleEffects:[{id:"anarchy-1-shift",params:{action:"shift",targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!0},destinationRestriction:{type:"non_matching_protocol"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"anarchy-2-delete",params:{action:"delete",count:1,targetFilter:{position:"any",faceState:"face_up"},protocolMatching:"must_match",excludeSelf:!1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"anarchy-3-swap",params:{action:"swap_protocols",target:"opponent"},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"anarchy-3-end-rearrange",params:{action:"rearrange_protocols",target:"own",restriction:{disallowedProtocol:"Anarchy",laneIndex:"current"}},position:"bottom",trigger:"end"}]},{value:5,topEffects:[],middleEffects:[{id:"anarchy-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:6,topEffects:[{id:"anarchy-6-start-flip",params:{action:"flip",count:1,flipSelf:!0,optional:!1,targetFilter:{owner:"any",position:"any",faceState:"any",excludeSelf:!1},advancedConditional:{type:"protocol_match",protocol:"Anarchy"}},position:"top",trigger:"start"}],middleEffects:[],bottomEffects:[]}],G0="Fan-Content",Y0={id:L0,name:M0,description:I0,author:P0,createdAt:H0,color:B0,pattern:z0,cards:V0,category:G0},W0="apathy_custom",Q0="Apathy",X0="Custom implementation of Apathy protocol",Z0="System",K0="2025-01-08T00:00:00Z",J0="#9E9E9E",ex="radial",tx=[{value:0,topEffects:[{id:"apathy-0-value-modifier",params:{action:"value_modifier",modifier:{type:"add_per_condition",value:1,condition:"per_face_down_card",target:"own_total",scope:"this_lane"}},position:"top",trigger:"passive"}],middleEffects:[],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"apathy-1-flip-all",params:{action:"flip",count:"all",optional:!1,scope:"this_lane",targetFilter:{owner:"any",position:"any",faceState:"face_up",excludeSelf:!0}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:2,topEffects:[{id:"apathy-2-passive",params:{action:"passive_rule",rule:{type:"ignore_middle_commands",target:"all",scope:"this_lane"}},position:"top",trigger:"passive"}],middleEffects:[],bottomEffects:[{id:"apathy-2-on-cover",params:{action:"flip",count:1,flipSelf:!0,optional:!1,targetFilter:{owner:"any",position:"any",faceState:"any",excludeSelf:!1}},position:"bottom",trigger:"on_cover"}]},{value:3,topEffects:[],middleEffects:[{id:"apathy-3-flip-opponent",params:{action:"flip",count:1,optional:!1,targetFilter:{owner:"opponent",position:"uncovered",faceState:"face_up",excludeSelf:!1}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"apathy-4-flip-covered",params:{action:"flip",count:1,optional:!0,targetFilter:{owner:"own",position:"covered",faceState:"face_up",excludeSelf:!1}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"apathy-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],nx="Aux 1",ox={id:W0,name:Q0,description:X0,author:Z0,createdAt:K0,color:J0,pattern:ex,cards:tx,category:nx},ax="chaos_custom_1",lx="Chaos",rx="Embrace the unpredictable. Custom protocol migration of original Chaos protocol.",cx="#E64DB8",ix="chaos",sx=[{value:0,topEffects:[],middleEffects:[{id:"chaos_0_flip_covered",trigger:"on_play",params:{action:"flip",count:1,scope:"each_lane",targetFilter:{owner:"any",position:"covered",faceState:"any"}},position:"middle"}],bottomEffects:[{id:"chaos_0_start_swap_draws",trigger:"start",params:{action:"mutual_draw",count:1},position:"bottom"}]},{value:1,topEffects:[],middleEffects:[{id:"chaos_1_rearrange_own",trigger:"on_play",params:{action:"rearrange_protocols",target:"own"},position:"middle"},{id:"chaos_1_rearrange_opponent",trigger:"on_play",params:{action:"rearrange_protocols",target:"opponent"},position:"middle"}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"chaos_2_shift_covered",trigger:"on_play",params:{action:"shift",count:1,targetFilter:{owner:"own",position:"covered",faceState:"any"}},position:"middle"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[],bottomEffects:[{id:"chaos_3_allow_any_protocol",trigger:"passive",params:{action:"passive_rule",rule:{type:"allow_any_protocol_play",target:"self",scope:"global"}},position:"bottom"}]},{value:4,topEffects:[],middleEffects:[],bottomEffects:[{id:"chaos_4_end_discard_draw",trigger:"end",params:{action:"discard",count:"all",actor:"self"},conditional:{type:"then",thenEffect:{id:"chaos_4_draw_after_discard",trigger:"on_play",params:{action:"draw",count:1,countType:"equal_to_discarded",countOffset:0,target:"self",source:"own_deck"},position:"bottom"}},position:"bottom"}]},{value:5,topEffects:[],middleEffects:[{id:"chaos_5_discard",trigger:"on_play",params:{action:"discard",count:1,actor:"self"},position:"middle"}],bottomEffects:[]}],dx="Main 2",ux={id:ax,name:lx,description:rx,color:cx,pattern:ix,cards:sx,category:dx},fx="darkness_custom_v1",px="Darkness",hx="Custom Darkness protocol - manipulate face-down cards, flip and shift",mx="System",gx="2025-01-08T00:00:00Z",yx="#1a0033",vx="grid",_x=[{value:0,topEffects:[],middleEffects:[{id:"dark-0-draw",params:{action:"draw",count:3,target:"self",source:"own_deck"},position:"middle",trigger:"on_play"},{id:"dark-0-shift",params:{action:"shift",targetFilter:{owner:"opponent",position:"covered",faceState:"any",excludeSelf:!1},destinationRestriction:{type:"any"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"dark-1-flip",params:{action:"flip",count:1,optional:!1,targetFilter:{owner:"opponent",position:"uncovered",faceState:"any",excludeSelf:!1}},position:"middle",trigger:"on_play"},{id:"dark-1-shift",params:{action:"shift",optional:!0,targetFilter:{owner:"any",position:"any",faceState:"any",excludeSelf:!1},destinationRestriction:{type:"any"}},position:"middle",trigger:"on_play",useCardFromPreviousEffect:!0}],bottomEffects:[]},{value:2,topEffects:[{id:"dark-2-value-modifier",params:{action:"value_modifier",modifier:{type:"set_to_fixed",value:4,target:"own_cards",scope:"this_lane",filter:{faceState:"face_down",position:"any"}}},position:"top",trigger:"passive"}],middleEffects:[{id:"dark-2-flip",params:{action:"flip",count:1,optional:!0,scope:"this_lane",targetFilter:{owner:"any",position:"covered",faceState:"any",excludeSelf:!1}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"dark-3-play",params:{action:"play",source:"hand",count:1,faceDown:!0,destinationRule:{type:"other_lines",excludeCurrentLane:!0}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"dark-4-shift",params:{action:"shift",targetFilter:{owner:"any",position:"uncovered",faceState:"face_down",excludeSelf:!1},destinationRestriction:{type:"any"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"dark-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],xx="Main 1",wx={id:fx,name:px,description:hx,author:mx,createdAt:gx,color:yx,pattern:vx,cards:_x,category:xx},Cx="death_custom_v1",bx="Death",Sx="Custom Death protocol - delete cards with various conditions",Ex="System",jx="2025-01-09T00:00:00Z",Ax="#8B0000",Rx="stripes",Dx=[{value:0,topEffects:[],middleEffects:[{id:"death-0-delete-from-each-lane",params:{action:"delete",count:1,scope:{type:"each_other_line"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[{id:"death-1-optional-draw",params:{action:"draw",count:1,optional:!0},position:"top",trigger:"start",conditional:{type:"if_executed",thenEffect:{id:"death-1-delete-other",params:{action:"delete",count:1,excludeSelf:!0},position:"top",trigger:"start",conditional:{type:"then",thenEffect:{id:"death-1-delete-self",params:{action:"delete",count:1,targetFilter:{position:"any",owner:"own"},deleteSelf:!0},position:"top",trigger:"start"}}}}}],middleEffects:[],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"death-2-delete-lane-values",params:{action:"delete",count:"all",selectLane:!0,targetFilter:{faceState:"any",valueRange:{min:1,max:2}}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"death-3-delete-facedown",params:{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"face_down"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"death-4-delete-low-value",params:{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"face_up",valueRange:{min:0,max:1}}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"death-5-discard",params:{action:"discard",count:1},position:"middle",trigger:"on_play"}],bottomEffects:[]}],Tx="Main 1",kx={id:Cx,name:bx,description:Sx,author:Ex,createdAt:jx,color:Ax,pattern:Rx,cards:Dx,category:Tx},Nx="fire-custom-001",Fx="Fire",qx="Fire protocol - discard cards to fuel powerful effects",Ux="System",$x="2025-11-09T00:00:00.000Z",Ox="#F06838",Lx="radial",Mx=[{value:0,topEffects:[],middleEffects:[{id:"fire-0-flip",params:{action:"flip",count:1,targetFilter:{excludeSelf:!0}},position:"middle",trigger:"on_play"},{id:"fire-0-draw",params:{action:"draw",count:2},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"fire-0-oncover-draw",params:{action:"draw",count:1},position:"bottom",trigger:"on_cover",conditional:{type:"then",thenEffect:{id:"fire-0-oncover-flip",params:{action:"flip",count:1,targetFilter:{excludeSelf:!0}},position:"bottom",trigger:"on_cover"}}}]},{value:1,topEffects:[],middleEffects:[{id:"fire-1-discard",params:{action:"discard",count:1},position:"middle",trigger:"on_play",conditional:{type:"if_executed",thenEffect:{id:"fire-1-delete",params:{action:"delete",count:1},position:"middle",trigger:"on_play"}}}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"fire-2-discard",params:{action:"discard",count:1},position:"middle",trigger:"on_play",conditional:{type:"if_executed",thenEffect:{id:"fire-2-return",params:{action:"return",count:1,targetFilter:{position:"uncovered"}},position:"middle",trigger:"on_play"}}}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[],bottomEffects:[{id:"fire-3-discard",params:{action:"discard",count:1,optional:!0},position:"bottom",trigger:"end",conditional:{type:"if_executed",thenEffect:{id:"fire-3-flip",params:{action:"flip",count:1},position:"bottom",trigger:"end"}}}]},{value:4,topEffects:[],middleEffects:[{id:"fire-4-discard-variable",params:{action:"discard",count:1,variableCount:!0},position:"middle",trigger:"on_play",conditional:{type:"then",thenEffect:{id:"fire-4-draw-based-on-discard",params:{action:"draw",countType:"equal_to_discarded",countOffset:1},position:"middle",trigger:"on_play"}}}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"fire-5-discard",params:{action:"discard",count:1,optional:!1},position:"middle",trigger:"on_play"}],bottomEffects:[]}],Ix="Main 1",Px={id:Nx,name:Fx,description:qx,author:Ux,createdAt:$x,color:Ox,pattern:Lx,cards:Mx,category:Ix},Hx="frost_custom_1",Bx="Frost",zx="Freeze the game state. Frost blocks actions and preserves face-down cards.",Vx="#87CEEB",Gx="frost",Yx=[{value:0,topEffects:[],middleEffects:[{id:"frost_0_draw_per_face_down",trigger:"on_play",position:"middle",params:{action:"draw",count:1,source:"own_deck",target:"self",countType:"count_face_down"}}],bottomEffects:[]},{value:1,topEffects:[{id:"frost_1_block_flips",trigger:"passive",position:"top",params:{action:"passive_rule",rule:{type:"block_flips",target:"all",scope:"global"}}}],middleEffects:[],bottomEffects:[{id:"frost_1_block_rearrange",trigger:"passive",position:"bottom",params:{action:"passive_rule",rule:{type:"block_protocol_rearrange",target:"all",scope:"global"}}}]},{value:2,topEffects:[],middleEffects:[{id:"frost_2_play_face_down",trigger:"on_play",position:"middle",params:{action:"play",count:1,source:"hand",faceDown:!0}}],bottomEffects:[]},{value:3,topEffects:[{id:"frost_3_block_shifts",trigger:"passive",position:"top",params:{action:"passive_rule",rule:{type:"block_shifts_from_and_to_lane",target:"all",scope:"this_lane"}}}],middleEffects:[],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"frost_4_flip_covered",trigger:"on_play",position:"middle",params:{action:"flip",count:1,optional:!0,targetFilter:{owner:"own",faceState:"face_up",position:"covered"}}}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"frost_5_discard",trigger:"on_play",position:"middle",params:{action:"discard",count:1,target:"self"}}],bottomEffects:[]}],Wx="Fan-Content",Qx={id:Hx,name:Bx,description:zx,color:Vx,pattern:Gx,cards:Yx,category:Wx},Xx="hate-custom-001",Zx="Hate",Kx="Focused on deletion and sacrifice. Delete cards to gain advantage.",Jx="System Migration",ew="2025-11-13T00:00:00.000Z",tw="#E67A7A",nw="diagonal-lines",ow=[{value:0,topEffects:[],middleEffects:[{id:"hate-0-delete",params:{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"any"},scope:{type:"anywhere"},excludeSelf:!1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"hate-1-discard",params:{action:"discard",count:3,actor:"self",upTo:!0},position:"middle",trigger:"on_play"},{id:"hate-1-delete-1",params:{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"any"},scope:{type:"anywhere"},excludeSelf:!1,upTo:!0},position:"middle",trigger:"on_play"},{id:"hate-1-delete-2",params:{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"any"},scope:{type:"anywhere"},excludeSelf:!1,upTo:!0},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"hate-2-delete-own",params:{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"any",calculation:"highest_value",owner:"own"},scope:{type:"anywhere"},excludeSelf:!1},position:"middle",trigger:"on_play"},{id:"hate-2-delete-opponent",params:{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"any",calculation:"highest_value",owner:"opponent"},scope:{type:"anywhere"},excludeSelf:!1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[{id:"hate-3-reactive-draw",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"top",trigger:"after_delete",reactiveTriggerActor:"self"}],middleEffects:[],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[],bottomEffects:[{id:"hate-4-on-cover-delete",params:{action:"delete",count:1,targetFilter:{position:"covered_by_context",faceState:"any",calculation:"lowest_value"},scope:{type:"this_line"},excludeSelf:!1,autoExecute:!0},position:"bottom",trigger:"on_cover"}]},{value:5,topEffects:[],middleEffects:[{id:"hate-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],aw="Aux 1",lw={id:Xx,name:Zx,description:Kx,author:Jx,createdAt:ew,color:tw,pattern:nw,cards:ow,category:aw},rw="water_custom_1",cw="Water",iw="Wash away and renew. Custom protocol migration of original Water protocol.",sw="#5DADE2",dw="multi-radial",uw=[{value:0,topEffects:[],middleEffects:[{id:"water_0_flip_other",trigger:"immediate",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!0},optional:!1},position:"middle"},{id:"water_0_flip_self",trigger:"immediate",params:{action:"flip",flipSelf:!0},position:"middle"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"water_1_play",trigger:"immediate",params:{action:"play",source:"deck",count:1,faceDown:!0,destinationRule:{type:"each_other_line"}},position:"middle"}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"water_2_draw",trigger:"immediate",params:{action:"draw",count:2},position:"middle"},{id:"water_2_rearrange",trigger:"immediate",params:{action:"rearrange_protocols",target:"own"},position:"middle"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"water_3_return",trigger:"immediate",params:{action:"return",count:"all",targetFilter:{owner:"any",position:"uncovered",valueEquals:2},selectLane:!0},position:"middle"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"water_4_return",trigger:"immediate",params:{action:"return",count:1,targetFilter:{owner:"own",position:"uncovered"}},position:"middle"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"water_5_discard",trigger:"immediate",params:{action:"discard",count:1,actor:"self"},position:"middle"}],bottomEffects:[]}],fw="Main 1",pw={id:rw,name:cw,description:iw,color:sw,pattern:dw,cards:uw,category:fw},hw="spirit_custom_1",mw="Spirit",gw="True strength from within. Custom protocol migration of original Spirit protocol.",yw="#5DD9C1",vw="dual-radial",_w=[{value:0,topEffects:[],middleEffects:[{id:"spirit_0_refresh",trigger:"on_play",params:{action:"refresh",target:"self"},position:"middle"},{id:"spirit_0_draw",trigger:"on_play",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"middle"}],bottomEffects:[{id:"spirit_0_skip_cache",trigger:"passive",params:{action:"passive_rule",rule:{type:"skip_check_cache_phase",target:"self",scope:"global"}},position:"bottom"}]},{value:1,topEffects:[{id:"spirit_1_play_anywhere",trigger:"passive",params:{action:"passive_rule",rule:{type:"allow_any_protocol_play",target:"self",scope:"global"}},position:"top"}],middleEffects:[{id:"spirit_1_draw",trigger:"on_play",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"middle"}],bottomEffects:[{id:"spirit_1_choice",trigger:"start",params:{action:"choice",options:[{id:"spirit_1_choice_discard",trigger:"on_play",params:{action:"discard",count:1,actor:"self"},position:"bottom"},{id:"spirit_1_choice_flip",trigger:"on_play",params:{action:"flip",flipSelf:!0},position:"bottom"}]},position:"bottom"}]},{value:2,topEffects:[],middleEffects:[{id:"spirit_2_flip",trigger:"on_play",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1},optional:!0},position:"middle"}],bottomEffects:[]},{value:3,topEffects:[{id:"spirit_3_shift",trigger:"after_draw",reactiveTriggerActor:"self",params:{action:"shift",count:1,optional:!0,targetFilter:{owner:"own",position:"any",faceState:"any",excludeSelf:!1}},position:"top"}],middleEffects:[],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"spirit_4_swap",trigger:"on_play",params:{action:"swap_protocols",target:"own"},position:"middle"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"spirit_5_discard",trigger:"on_play",params:{action:"discard",count:1,actor:"self"},position:"middle"}],bottomEffects:[]}],xw="Main 1",ww={id:hw,name:mw,description:gw,color:yw,pattern:vw,cards:_w,category:xw},Cw="gravity_custom_1",bw="Gravity",Sw="Pull everything together. Gravity draws cards towards this line.",Ew="#7599EB",jw="grid",Aw=[{value:0,topEffects:[],middleEffects:[{id:"gravity_0_play_per_2_cards",trigger:"on_play",params:{action:"play",source:"deck",count:1,faceDown:!0,destinationRule:{type:"under_this_card"},condition:{type:"per_x_cards_in_line",cardCount:2},actor:"self"},position:"middle"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"gravity_1_draw_2",trigger:"on_play",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"middle"},{id:"gravity_1_shift_to_or_from",trigger:"on_play",params:{action:"shift",targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1},destinationRestriction:{type:"to_or_from_this_lane",laneIndex:"current"}},position:"middle"}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"gravity_2_flip",trigger:"on_play",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1},optional:!1},position:"middle"},{id:"gravity_2_shift_to_this_line",trigger:"on_play",params:{action:"shift",targetFilter:{owner:"any",position:"any",faceState:"any",excludeSelf:!1},destinationRestriction:{type:"to_this_lane",laneIndex:"current"}},position:"middle",useCardFromPreviousEffect:!0}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"gravity_4_shift_face_down_to_this_line",trigger:"on_play",params:{action:"shift",targetFilter:{owner:"any",position:"uncovered",faceState:"face_down",excludeSelf:!1},destinationRestriction:{type:"to_this_lane",laneIndex:"current"}},position:"middle"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"gravity_5_discard",trigger:"on_play",params:{action:"discard",count:1,actor:"self"},position:"middle"}],bottomEffects:[]},{value:6,topEffects:[],middleEffects:[{id:"gravity_6_opponent_plays",trigger:"on_play",params:{action:"play",source:"deck",count:1,faceDown:!0,destinationRule:{type:"specific_lane",laneIndex:"current"},actor:"opponent"},position:"middle",comment:"Opponent plays top of their deck in this line"}],bottomEffects:[]}],Rw="Main 1",Dw={id:Cw,name:bw,description:Sw,color:Ew,pattern:jw,cards:Aw,category:Rw},Tw="life_custom_1",kw="Life",Nw="Life begets more life. Play cards from your deck to grow your presence.",Fw="#3CE076",qw="hexagons",Uw=[{value:0,topEffects:[],middleEffects:[{id:"life_0_play_each_line_with_card",trigger:"on_play",position:"middle",params:{action:"play",source:"deck",count:1,faceDown:!0,destinationRule:{type:"each_line_with_card",ownerFilter:"own"},actor:"self"}}],bottomEffects:[{id:"life_0_on_cover_delete_self",trigger:"on_cover",position:"bottom",params:{action:"delete",deleteSelf:!0}}]},{value:1,topEffects:[],middleEffects:[{id:"life_1_flip_1",trigger:"on_play",position:"middle",params:{action:"flip",count:1,optional:!1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1}}},{id:"life_1_flip_2",trigger:"on_play",position:"middle",params:{action:"flip",count:1,optional:!1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1}}}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"life_2_draw",trigger:"on_play",position:"middle",params:{action:"draw",count:1,target:"self",source:"own_deck"}},{id:"life_2_flip",trigger:"on_play",position:"middle",params:{action:"flip",count:1,optional:!0,targetFilter:{owner:"any",position:"uncovered",faceState:"face_down",excludeSelf:!1}}}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[],bottomEffects:[{id:"life_3_on_cover_play",trigger:"on_cover",position:"bottom",params:{action:"play",source:"deck",count:1,faceDown:!0,destinationRule:{type:"another_line",excludeCurrentLane:!0},actor:"self"}}]},{value:4,topEffects:[],middleEffects:[{id:"life_4_conditional_draw",trigger:"on_play",position:"middle",params:{action:"draw",count:1,target:"self",source:"own_deck",conditional:{type:"is_covering"}}}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"life_5_discard",trigger:"on_play",position:"middle",params:{action:"discard",count:1,actor:"self"}}],bottomEffects:[]}],$w="Main 1",Ow={id:Tw,name:kw,description:Nw,color:Fw,pattern:qw,cards:Uw,category:$w},Lw="light_custom_1",Mw="Light",Iw="Burn away the dark. Light protocol reveals and manipulates through illumination.",Pw="System",Hw="2025-11-14T00:00:00.000Z",Bw="#F4D03F",zw="radial",Vw=[{value:0,topEffects:[],middleEffects:[{id:"light-0-flip",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1},optional:!1},position:"middle",trigger:"on_play"},{id:"light-0-draw",params:{action:"draw",count:1,target:"self",source:"own_deck",countType:"equal_to_card_value"},position:"middle",trigger:"on_play",useCardFromPreviousEffect:!0}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[],bottomEffects:[{id:"light-1-draw",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"bottom",trigger:"end"}]},{value:2,topEffects:[],middleEffects:[{id:"light-2-draw",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"middle",trigger:"on_play"},{id:"light-2-reveal-board-card",params:{action:"reveal",source:"board",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"face_down"},optional:!0},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"light-3-shift-all",params:{action:"shift",count:"all",targetFilter:{owner:"any",position:"any",faceState:"face_down",excludeSelf:!1},destinationRestriction:{type:"to_another_line"},scope:"this_lane"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"light-4-reveal",params:{action:"reveal",source:"opponent_hand",count:-1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"light-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],Gw="Main 1",Yw={id:Lw,name:Mw,description:Iw,author:Pw,createdAt:Hw,color:Bw,pattern:zw,cards:Vw,category:Gw},Ww="speed_custom_1",Qw="Speed",Xw="Swift and adaptive. Custom protocol migration of original Speed protocol.",Zw="#33E6E6",Kw="cross",Jw=[{value:0,topEffects:[],middleEffects:[{id:"speed_0_play",trigger:"on_play",params:{action:"play",source:"hand",count:1},position:"middle"}],bottomEffects:[]},{value:1,topEffects:[{id:"speed_1_reactive_draw",trigger:"after_clear_cache",reactiveTriggerActor:"self",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"top"}],middleEffects:[{id:"speed_1_draw",trigger:"on_play",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"middle"}],bottomEffects:[]},{value:2,topEffects:[{id:"speed_2_before_compile",trigger:"before_compile_delete",params:{action:"shift",count:1,shiftSelf:!0,allowCoveredSelf:!0,targetFilter:{owner:"own",position:"any",faceState:"any"}},position:"top"}],middleEffects:[],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"speed_3_shift_other",trigger:"on_play",params:{action:"shift",count:1,targetFilter:{owner:"own",position:"uncovered",faceState:"any",excludeSelf:!0}},position:"middle"}],bottomEffects:[{id:"speed_3_end_shift",trigger:"end",params:{action:"shift",count:1,optional:!0,targetFilter:{owner:"own",position:"uncovered",faceState:"any"}},position:"bottom",conditional:{type:"if_executed",thenEffect:{id:"speed_3_flip_self",trigger:"on_play",params:{action:"flip",flipSelf:!0},position:"bottom"}}}]},{value:4,topEffects:[],middleEffects:[{id:"speed_4_shift_opponent",trigger:"on_play",params:{action:"shift",count:1,targetFilter:{owner:"opponent",position:"uncovered",faceState:"face_down"}},position:"middle"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"speed_5_discard",trigger:"on_play",params:{action:"discard",count:1,actor:"self"},position:"middle"}],bottomEffects:[]}],e1="Main 1",t1={id:Ww,name:Qw,description:Xw,color:Zw,pattern:Kw,cards:Jw,category:e1},n1="metal_custom_1",o1="Metal",a1="Unyielding defense. Custom protocol migration of original Metal protocol.",l1="#B0BEC5",r1="grid",c1=[{value:0,topEffects:[{id:"metal_0_reduce_opponent",trigger:"passive",params:{action:"value_modifier",modifier:{type:"add_to_total",value:-2,target:"opponent_total",scope:"this_lane"}},position:"top"}],middleEffects:[{id:"metal_0_flip",trigger:"on_play",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any"}},position:"middle"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"metal_1_draw",trigger:"on_play",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"middle"},{id:"metal_1_block_compile",trigger:"on_play",params:{action:"block_compile",target:"opponent"},position:"middle"}],bottomEffects:[]},{value:2,topEffects:[{id:"metal_2_block_face_down",trigger:"passive",params:{action:"passive_rule",rule:{type:"block_face_down_play",scope:"this_lane"}},position:"top"}],middleEffects:[],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"metal_3_draw",trigger:"on_play",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"middle"},{id:"metal_3_delete_lane",trigger:"on_play",params:{action:"delete_all_in_lane",laneCondition:{type:"min_cards",count:8},excludeCurrentLane:!0},position:"middle"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"metal_5_discard",trigger:"on_play",params:{action:"discard",count:1,actor:"self"},position:"middle"}],bottomEffects:[]},{value:6,topEffects:[{id:"metal_6_delete_on_cover_or_flip",trigger:"on_cover_or_flip",params:{action:"delete",deleteSelf:!0},position:"top"}],middleEffects:[],bottomEffects:[]}],i1="Main 1",s1={id:n1,name:o1,description:a1,color:l1,pattern:r1,cards:c1,category:i1},d1="plague-custom-001",u1="Plague",f1="Focused on forcing opponent discards and restricting their plays. Spread suffering.",p1="System Migration",h1="2025-11-26T00:00:00.000Z",m1="#8FBC3A",g1="dual-radial",y1=[{value:0,topEffects:[],middleEffects:[{id:"plague-0-opponent-discard",params:{action:"discard",count:1,actor:"opponent"},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"plague-0-block-play",params:{action:"passive_rule",rule:{type:"block_all_play",target:"opponent",scope:"this_lane"}},position:"bottom",trigger:"passive"}]},{value:1,topEffects:[{id:"plague-1-reactive-draw",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"top",trigger:"after_opponent_discard"}],middleEffects:[{id:"plague-1-opponent-discard",params:{action:"discard",count:1,actor:"opponent"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"plague-2-self-discard",params:{action:"discard",count:1,actor:"self",variableCount:!0},position:"middle",trigger:"on_play",conditional:{type:"then",thenEffect:{id:"plague-2-opponent-discard",params:{action:"discard",actor:"opponent",countType:"equal_to_discarded",countOffset:1},position:"middle",trigger:"on_play"}}}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"plague-3-flip-each-other",params:{action:"flip",count:"all",scope:{type:"anywhere"},targetFilter:{faceState:"face_up",owner:"any",position:"uncovered",excludeSelf:!0}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,text:{bottom:"<div><span class='emphasis'>End:</span> Your opponent deletes 1 of their face-down cards. You may flip this card.</div>"},topEffects:[],middleEffects:[],bottomEffects:[{id:"plague-4-opponent-delete",params:{action:"delete",count:1,targetFilter:{faceState:"face_down",owner:"opponent",position:"uncovered"},scope:{type:"anywhere"},actorChooses:"card_owner"},position:"bottom",trigger:"end"},{id:"plague-4-may-flip-self",params:{action:"flip",flipSelf:!0,optional:!0},position:"bottom",trigger:"end"}]},{value:5,topEffects:[],middleEffects:[{id:"plague-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],v1="Main 1",_1={id:d1,name:u1,description:f1,author:p1,createdAt:h1,color:m1,pattern:g1,cards:y1,category:v1},x1="love_custom_v1",w1="Love",C1="Custom Love protocol - hand manipulation, giving and taking cards",b1="System",S1="2025-01-08T00:00:00Z",E1="#f2a3d7",j1="radial",A1=[{value:1,topEffects:[],middleEffects:[{id:"love-1-draw-opponent-deck",params:{action:"draw",count:1,target:"self",source:"opponent_deck"},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"love-1-end-give",params:{action:"give",count:1,source:"own_hand",optional:!0},conditional:{type:"if_executed",thenEffect:{id:"love-1-end-draw",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"bottom",trigger:"on_play"}},position:"bottom",trigger:"end"}]},{value:2,topEffects:[],middleEffects:[{id:"love-2-opponent-draw",params:{action:"draw",count:1,target:"opponent",source:"own_deck"},position:"middle",trigger:"on_play"},{id:"love-2-refresh",params:{action:"refresh",target:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"love-3-take",params:{action:"take",count:1,random:!0},position:"middle",trigger:"on_play"},{id:"love-3-give",params:{action:"give",count:1,source:"own_hand",optional:!1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"love-4-reveal",params:{action:"reveal",count:1,source:"own_hand"},position:"middle",trigger:"on_play"},{id:"love-4-flip",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"love-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:6,topEffects:[],middleEffects:[{id:"love-6-opponent-draw",params:{action:"draw",count:2,target:"opponent",source:"own_deck"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],R1="Aux 1",D1={id:x1,name:w1,description:C1,author:b1,createdAt:S1,color:E1,pattern:j1,cards:A1,category:R1},T1="psychic_custom_v1",k1="Psychic",N1="Custom Psychic protocol - mind control, discard, reveal, and protocol manipulation",F1="System",q1="2025-01-08T00:00:00Z",U1="#c78dd9",$1="radial",O1=[{value:0,topEffects:[],middleEffects:[{id:"psychic-0-draw",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"middle",trigger:"on_play"},{id:"psychic-0-opponent-discard",params:{action:"discard",count:2,actor:"opponent"},position:"middle",trigger:"on_play"},{id:"psychic-0-reveal-hand",params:{action:"reveal",source:"opponent_hand",count:-1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[{id:"psychic-1-force-face-down",params:{action:"passive_rule",rule:{type:"require_face_down_play",target:"opponent",scope:"global"}},position:"top",trigger:"passive"}],middleEffects:[],bottomEffects:[{id:"psychic-1-start-flip-self",params:{action:"flip",count:1,targetFilter:{owner:"self",position:"any",faceState:"any",excludeSelf:!1},flipSelf:!0},position:"bottom",trigger:"start"}]},{value:2,topEffects:[],middleEffects:[{id:"psychic-2-opponent-discard",params:{action:"discard",count:2,actor:"opponent"},position:"middle",trigger:"on_play"},{id:"psychic-2-rearrange",params:{action:"rearrange_protocols",target:"opponent"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"psychic-3-opponent-discard",params:{action:"discard",count:1,actor:"opponent"},position:"middle",trigger:"on_play"},{id:"psychic-3-shift-opponent",params:{action:"shift",targetFilter:{owner:"opponent",position:"uncovered",faceState:"any",excludeSelf:!1},destinationRestriction:{type:"any"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[],bottomEffects:[{id:"psychic-4-end-return",params:{action:"return",count:1,optional:!0,targetFilter:{owner:"opponent",position:"uncovered",faceState:"any",excludeSelf:!1}},conditional:{type:"if_executed",thenEffect:{id:"psychic-4-end-flip-self",params:{action:"flip",count:1,flipSelf:!0,targetFilter:{owner:"self",position:"any",faceState:"any",excludeSelf:!1}},position:"bottom",trigger:"end"}},position:"bottom",trigger:"end"}]},{value:5,topEffects:[],middleEffects:[{id:"psychic-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],L1="Main 1",M1={id:T1,name:k1,description:N1,author:F1,createdAt:q1,color:U1,pattern:$1,cards:O1,category:L1};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const I1=()=>{try{const o=ma(),n=o.findIndex(r=>r.id==="dark_cust_v2"||r.name==="Dark_cust");n>=0&&(o.splice(n,1),dd(o),console.log("[Default Protocols] Removed old Dark_cust protocol")),Nt(Y0),Nt(ox),Nt(wx),Nt(kx),Nt(Px),Nt(pw),Nt(ww),Nt(ux),Nt(Dw),Nt(Qx),Nt(lw),Nt(Ow),Nt(Yw),Nt(t1),Nt(s1),Nt(_1),Nt(D1),Nt(M1)}catch(o){console.error("[Default Protocols] Error loading default protocols:",o)}};function P1(){const[o,n]=ce.useState("MainMenu"),[r,s]=ce.useState([]),[i,d]=ce.useState([]),[f,m]=ce.useState(null),[h,p]=ce.useState("easy"),[y,v]=ce.useState(null),[x,_]=ce.useState(!0),[w,U]=ce.useState("player");ce.useEffect(()=>{I1()},[]);const C=ce.useCallback(()=>{n("MainMenu"),s([]),d([]),m(null),v(null)},[]);ce.useEffect(()=>{const q=D=>{D.key==="Escape"&&C()};return window.addEventListener("keydown",q),()=>{window.removeEventListener("keydown",q)}},[C]);const A=ce.useCallback((q,D)=>{s(q),d(D),m(null),v(null),U("player"),n("GameScreen")},[]),S=ce.useCallback((q,D)=>{m(q),v(D),n("ResultsScreen")},[]),N=()=>{switch(o){case"MainMenu":return l.jsx(ah,{onNavigate:q=>n(q),difficulty:h,setDifficulty:p,useControl:x,onUseControlChange:_});case"ProtocolSelection":return l.jsx(Dv,{onBack:C,onStartGame:A});case"GameScreen":return l.jsx(d0,{onBack:C,onEndGame:S,playerProtocols:r,opponentProtocols:i,difficulty:h,useControlMechanic:x,startingPlayer:w});case"ResultsScreen":return l.jsx(u0,{onPlayAgain:C,winner:f,finalState:y,difficulty:h});case"CardLibrary":return l.jsx(f0,{onBack:C});case"Statistics":return l.jsx(p0,{onBack:C});case"CustomProtocols":return l.jsx(R0,{onBack:C});case"Rules":return l.jsx(O0,{onBack:C});default:return l.jsx(ah,{onNavigate:q=>n(q),difficulty:h,setDifficulty:p,useControl:x,onUseControlChange:_})}};return l.jsx(l.Fragment,{children:N()})}const H1=document.getElementById("root"),B1=vv.createRoot(H1);B1.render(l.jsx(P1,{}));
