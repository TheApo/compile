(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))i(c);new MutationObserver(c=>{for(const d of c)if(d.type==="childList")for(const p of d.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&i(p)}).observe(document,{childList:!0,subtree:!0});function l(c){const d={};return c.integrity&&(d.integrity=c.integrity),c.referrerPolicy&&(d.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?d.credentials="include":c.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function i(c){if(c.ep)return;c.ep=!0;const d=l(c);fetch(c.href,d)}})();var md={exports:{}},Ll={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var fh;function l_(){if(fh)return Ll;fh=1;var a=Symbol.for("react.transitional.element"),n=Symbol.for("react.fragment");function l(i,c,d){var p=null;if(d!==void 0&&(p=""+d),c.key!==void 0&&(p=""+c.key),"key"in c){d={};for(var h in c)h!=="key"&&(d[h]=c[h])}else d=c;return c=d.ref,{$$typeof:a,type:i,key:p,ref:c!==void 0?c:null,props:d}}return Ll.Fragment=n,Ll.jsx=l,Ll.jsxs=l,Ll}var hh;function s_(){return hh||(hh=1,md.exports=l_()),md.exports}var o=s_(),yd={exports:{}},Ml={},gd={exports:{}},vd={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var mh;function i_(){return mh||(mh=1,(function(a){function n(R,O){var Z=R.length;R.push(O);e:for(;0<Z;){var ee=Z-1>>>1,M=R[ee];if(0<c(M,O))R[ee]=O,R[Z]=M,Z=ee;else break e}}function l(R){return R.length===0?null:R[0]}function i(R){if(R.length===0)return null;var O=R[0],Z=R.pop();if(Z!==O){R[0]=Z;e:for(var ee=0,M=R.length,G=M>>>1;ee<G;){var K=2*(ee+1)-1,W=R[K],U=K+1,Q=R[U];if(0>c(W,Z))U<M&&0>c(Q,W)?(R[ee]=Q,R[U]=Z,ee=U):(R[ee]=W,R[K]=Z,ee=K);else if(U<M&&0>c(Q,Z))R[ee]=Q,R[U]=Z,ee=U;else break e}}return O}function c(R,O){var Z=R.sortIndex-O.sortIndex;return Z!==0?Z:R.id-O.id}if(a.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var d=performance;a.unstable_now=function(){return d.now()}}else{var p=Date,h=p.now();a.unstable_now=function(){return p.now()-h}}var f=[],m=[],g=1,y=null,w=3,_=!1,S=!1,k=!1,j=!1,E=typeof setTimeout=="function"?setTimeout:null,C=typeof clearTimeout=="function"?clearTimeout:null,b=typeof setImmediate<"u"?setImmediate:null;function T(R){for(var O=l(m);O!==null;){if(O.callback===null)i(m);else if(O.startTime<=R)i(m),O.sortIndex=O.expirationTime,n(f,O);else break;O=l(m)}}function A(R){if(k=!1,T(R),!S)if(l(f)!==null)S=!0,H||(H=!0,N());else{var O=l(m);O!==null&&L(A,O.startTime-R)}}var H=!1,$=-1,B=5,X=-1;function I(){return j?!0:!(a.unstable_now()-X<B)}function F(){if(j=!1,H){var R=a.unstable_now();X=R;var O=!0;try{e:{S=!1,k&&(k=!1,C($),$=-1),_=!0;var Z=w;try{t:{for(T(R),y=l(f);y!==null&&!(y.expirationTime>R&&I());){var ee=y.callback;if(typeof ee=="function"){y.callback=null,w=y.priorityLevel;var M=ee(y.expirationTime<=R);if(R=a.unstable_now(),typeof M=="function"){y.callback=M,T(R),O=!0;break t}y===l(f)&&i(f),T(R)}else i(f);y=l(f)}if(y!==null)O=!0;else{var G=l(m);G!==null&&L(A,G.startTime-R),O=!1}}break e}finally{y=null,w=Z,_=!1}O=void 0}}finally{O?N():H=!1}}}var N;if(typeof b=="function")N=function(){b(F)};else if(typeof MessageChannel<"u"){var D=new MessageChannel,P=D.port2;D.port1.onmessage=F,N=function(){P.postMessage(null)}}else N=function(){E(F,0)};function L(R,O){$=E(function(){R(a.unstable_now())},O)}a.unstable_IdlePriority=5,a.unstable_ImmediatePriority=1,a.unstable_LowPriority=4,a.unstable_NormalPriority=3,a.unstable_Profiling=null,a.unstable_UserBlockingPriority=2,a.unstable_cancelCallback=function(R){R.callback=null},a.unstable_forceFrameRate=function(R){0>R||125<R?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):B=0<R?Math.floor(1e3/R):5},a.unstable_getCurrentPriorityLevel=function(){return w},a.unstable_next=function(R){switch(w){case 1:case 2:case 3:var O=3;break;default:O=w}var Z=w;w=O;try{return R()}finally{w=Z}},a.unstable_requestPaint=function(){j=!0},a.unstable_runWithPriority=function(R,O){switch(R){case 1:case 2:case 3:case 4:case 5:break;default:R=3}var Z=w;w=R;try{return O()}finally{w=Z}},a.unstable_scheduleCallback=function(R,O,Z){var ee=a.unstable_now();switch(typeof Z=="object"&&Z!==null?(Z=Z.delay,Z=typeof Z=="number"&&0<Z?ee+Z:ee):Z=ee,R){case 1:var M=-1;break;case 2:M=250;break;case 5:M=1073741823;break;case 4:M=1e4;break;default:M=5e3}return M=Z+M,R={id:g++,callback:O,priorityLevel:R,startTime:Z,expirationTime:M,sortIndex:-1},Z>ee?(R.sortIndex=Z,n(m,R),l(f)===null&&R===l(m)&&(k?(C($),$=-1):k=!0,L(A,Z-ee))):(R.sortIndex=M,n(f,R),S||_||(S=!0,H||(H=!0,N()))),R},a.unstable_shouldYield=I,a.unstable_wrapCallback=function(R){var O=w;return function(){var Z=w;w=O;try{return R.apply(this,arguments)}finally{w=Z}}}})(vd)),vd}var yh;function c_(){return yh||(yh=1,gd.exports=i_()),gd.exports}var _d={exports:{}},Ve={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var gh;function d_(){if(gh)return Ve;gh=1;var a=Symbol.for("react.transitional.element"),n=Symbol.for("react.portal"),l=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),c=Symbol.for("react.profiler"),d=Symbol.for("react.consumer"),p=Symbol.for("react.context"),h=Symbol.for("react.forward_ref"),f=Symbol.for("react.suspense"),m=Symbol.for("react.memo"),g=Symbol.for("react.lazy"),y=Symbol.iterator;function w(M){return M===null||typeof M!="object"?null:(M=y&&M[y]||M["@@iterator"],typeof M=="function"?M:null)}var _={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},S=Object.assign,k={};function j(M,G,K){this.props=M,this.context=G,this.refs=k,this.updater=K||_}j.prototype.isReactComponent={},j.prototype.setState=function(M,G){if(typeof M!="object"&&typeof M!="function"&&M!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,M,G,"setState")},j.prototype.forceUpdate=function(M){this.updater.enqueueForceUpdate(this,M,"forceUpdate")};function E(){}E.prototype=j.prototype;function C(M,G,K){this.props=M,this.context=G,this.refs=k,this.updater=K||_}var b=C.prototype=new E;b.constructor=C,S(b,j.prototype),b.isPureReactComponent=!0;var T=Array.isArray,A={H:null,A:null,T:null,S:null,V:null},H=Object.prototype.hasOwnProperty;function $(M,G,K,W,U,Q){return K=Q.ref,{$$typeof:a,type:M,key:G,ref:K!==void 0?K:null,props:Q}}function B(M,G){return $(M.type,G,void 0,void 0,void 0,M.props)}function X(M){return typeof M=="object"&&M!==null&&M.$$typeof===a}function I(M){var G={"=":"=0",":":"=2"};return"$"+M.replace(/[=:]/g,function(K){return G[K]})}var F=/\/+/g;function N(M,G){return typeof M=="object"&&M!==null&&M.key!=null?I(""+M.key):G.toString(36)}function D(){}function P(M){switch(M.status){case"fulfilled":return M.value;case"rejected":throw M.reason;default:switch(typeof M.status=="string"?M.then(D,D):(M.status="pending",M.then(function(G){M.status==="pending"&&(M.status="fulfilled",M.value=G)},function(G){M.status==="pending"&&(M.status="rejected",M.reason=G)})),M.status){case"fulfilled":return M.value;case"rejected":throw M.reason}}throw M}function L(M,G,K,W,U){var Q=typeof M;(Q==="undefined"||Q==="boolean")&&(M=null);var Y=!1;if(M===null)Y=!0;else switch(Q){case"bigint":case"string":case"number":Y=!0;break;case"object":switch(M.$$typeof){case a:case n:Y=!0;break;case g:return Y=M._init,L(Y(M._payload),G,K,W,U)}}if(Y)return U=U(M),Y=W===""?"."+N(M,0):W,T(U)?(K="",Y!=null&&(K=Y.replace(F,"$&/")+"/"),L(U,G,K,"",function(ye){return ye})):U!=null&&(X(U)&&(U=B(U,K+(U.key==null||M&&M.key===U.key?"":(""+U.key).replace(F,"$&/")+"/")+Y)),G.push(U)),1;Y=0;var ce=W===""?".":W+":";if(T(M))for(var te=0;te<M.length;te++)W=M[te],Q=ce+N(W,te),Y+=L(W,G,K,Q,U);else if(te=w(M),typeof te=="function")for(M=te.call(M),te=0;!(W=M.next()).done;)W=W.value,Q=ce+N(W,te++),Y+=L(W,G,K,Q,U);else if(Q==="object"){if(typeof M.then=="function")return L(P(M),G,K,W,U);throw G=String(M),Error("Objects are not valid as a React child (found: "+(G==="[object Object]"?"object with keys {"+Object.keys(M).join(", ")+"}":G)+"). If you meant to render a collection of children, use an array instead.")}return Y}function R(M,G,K){if(M==null)return M;var W=[],U=0;return L(M,W,"","",function(Q){return G.call(K,Q,U++)}),W}function O(M){if(M._status===-1){var G=M._result;G=G(),G.then(function(K){(M._status===0||M._status===-1)&&(M._status=1,M._result=K)},function(K){(M._status===0||M._status===-1)&&(M._status=2,M._result=K)}),M._status===-1&&(M._status=0,M._result=G)}if(M._status===1)return M._result.default;throw M._result}var Z=typeof reportError=="function"?reportError:function(M){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var G=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof M=="object"&&M!==null&&typeof M.message=="string"?String(M.message):String(M),error:M});if(!window.dispatchEvent(G))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",M);return}console.error(M)};function ee(){}return Ve.Children={map:R,forEach:function(M,G,K){R(M,function(){G.apply(this,arguments)},K)},count:function(M){var G=0;return R(M,function(){G++}),G},toArray:function(M){return R(M,function(G){return G})||[]},only:function(M){if(!X(M))throw Error("React.Children.only expected to receive a single React element child.");return M}},Ve.Component=j,Ve.Fragment=l,Ve.Profiler=c,Ve.PureComponent=C,Ve.StrictMode=i,Ve.Suspense=f,Ve.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=A,Ve.__COMPILER_RUNTIME={__proto__:null,c:function(M){return A.H.useMemoCache(M)}},Ve.cache=function(M){return function(){return M.apply(null,arguments)}},Ve.cloneElement=function(M,G,K){if(M==null)throw Error("The argument must be a React element, but you passed "+M+".");var W=S({},M.props),U=M.key,Q=void 0;if(G!=null)for(Y in G.ref!==void 0&&(Q=void 0),G.key!==void 0&&(U=""+G.key),G)!H.call(G,Y)||Y==="key"||Y==="__self"||Y==="__source"||Y==="ref"&&G.ref===void 0||(W[Y]=G[Y]);var Y=arguments.length-2;if(Y===1)W.children=K;else if(1<Y){for(var ce=Array(Y),te=0;te<Y;te++)ce[te]=arguments[te+2];W.children=ce}return $(M.type,U,void 0,void 0,Q,W)},Ve.createContext=function(M){return M={$$typeof:p,_currentValue:M,_currentValue2:M,_threadCount:0,Provider:null,Consumer:null},M.Provider=M,M.Consumer={$$typeof:d,_context:M},M},Ve.createElement=function(M,G,K){var W,U={},Q=null;if(G!=null)for(W in G.key!==void 0&&(Q=""+G.key),G)H.call(G,W)&&W!=="key"&&W!=="__self"&&W!=="__source"&&(U[W]=G[W]);var Y=arguments.length-2;if(Y===1)U.children=K;else if(1<Y){for(var ce=Array(Y),te=0;te<Y;te++)ce[te]=arguments[te+2];U.children=ce}if(M&&M.defaultProps)for(W in Y=M.defaultProps,Y)U[W]===void 0&&(U[W]=Y[W]);return $(M,Q,void 0,void 0,null,U)},Ve.createRef=function(){return{current:null}},Ve.forwardRef=function(M){return{$$typeof:h,render:M}},Ve.isValidElement=X,Ve.lazy=function(M){return{$$typeof:g,_payload:{_status:-1,_result:M},_init:O}},Ve.memo=function(M,G){return{$$typeof:m,type:M,compare:G===void 0?null:G}},Ve.startTransition=function(M){var G=A.T,K={};A.T=K;try{var W=M(),U=A.S;U!==null&&U(K,W),typeof W=="object"&&W!==null&&typeof W.then=="function"&&W.then(ee,Z)}catch(Q){Z(Q)}finally{A.T=G}},Ve.unstable_useCacheRefresh=function(){return A.H.useCacheRefresh()},Ve.use=function(M){return A.H.use(M)},Ve.useActionState=function(M,G,K){return A.H.useActionState(M,G,K)},Ve.useCallback=function(M,G){return A.H.useCallback(M,G)},Ve.useContext=function(M){return A.H.useContext(M)},Ve.useDebugValue=function(){},Ve.useDeferredValue=function(M,G){return A.H.useDeferredValue(M,G)},Ve.useEffect=function(M,G,K){var W=A.H;if(typeof K=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return W.useEffect(M,G)},Ve.useId=function(){return A.H.useId()},Ve.useImperativeHandle=function(M,G,K){return A.H.useImperativeHandle(M,G,K)},Ve.useInsertionEffect=function(M,G){return A.H.useInsertionEffect(M,G)},Ve.useLayoutEffect=function(M,G){return A.H.useLayoutEffect(M,G)},Ve.useMemo=function(M,G){return A.H.useMemo(M,G)},Ve.useOptimistic=function(M,G){return A.H.useOptimistic(M,G)},Ve.useReducer=function(M,G,K){return A.H.useReducer(M,G,K)},Ve.useRef=function(M){return A.H.useRef(M)},Ve.useState=function(M){return A.H.useState(M)},Ve.useSyncExternalStore=function(M,G,K){return A.H.useSyncExternalStore(M,G,K)},Ve.useTransition=function(){return A.H.useTransition()},Ve.version="19.1.1",Ve}var vh;function Ud(){return vh||(vh=1,_d.exports=d_()),_d.exports}var xd={exports:{}},tn={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _h;function u_(){if(_h)return tn;_h=1;var a=Ud();function n(f){var m="https://react.dev/errors/"+f;if(1<arguments.length){m+="?args[]="+encodeURIComponent(arguments[1]);for(var g=2;g<arguments.length;g++)m+="&args[]="+encodeURIComponent(arguments[g])}return"Minified React error #"+f+"; visit "+m+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function l(){}var i={d:{f:l,r:function(){throw Error(n(522))},D:l,C:l,L:l,m:l,X:l,S:l,M:l},p:0,findDOMNode:null},c=Symbol.for("react.portal");function d(f,m,g){var y=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:c,key:y==null?null:""+y,children:f,containerInfo:m,implementation:g}}var p=a.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function h(f,m){if(f==="font")return"";if(typeof m=="string")return m==="use-credentials"?m:""}return tn.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=i,tn.createPortal=function(f,m){var g=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!m||m.nodeType!==1&&m.nodeType!==9&&m.nodeType!==11)throw Error(n(299));return d(f,m,null,g)},tn.flushSync=function(f){var m=p.T,g=i.p;try{if(p.T=null,i.p=2,f)return f()}finally{p.T=m,i.p=g,i.d.f()}},tn.preconnect=function(f,m){typeof f=="string"&&(m?(m=m.crossOrigin,m=typeof m=="string"?m==="use-credentials"?m:"":void 0):m=null,i.d.C(f,m))},tn.prefetchDNS=function(f){typeof f=="string"&&i.d.D(f)},tn.preinit=function(f,m){if(typeof f=="string"&&m&&typeof m.as=="string"){var g=m.as,y=h(g,m.crossOrigin),w=typeof m.integrity=="string"?m.integrity:void 0,_=typeof m.fetchPriority=="string"?m.fetchPriority:void 0;g==="style"?i.d.S(f,typeof m.precedence=="string"?m.precedence:void 0,{crossOrigin:y,integrity:w,fetchPriority:_}):g==="script"&&i.d.X(f,{crossOrigin:y,integrity:w,fetchPriority:_,nonce:typeof m.nonce=="string"?m.nonce:void 0})}},tn.preinitModule=function(f,m){if(typeof f=="string")if(typeof m=="object"&&m!==null){if(m.as==null||m.as==="script"){var g=h(m.as,m.crossOrigin);i.d.M(f,{crossOrigin:g,integrity:typeof m.integrity=="string"?m.integrity:void 0,nonce:typeof m.nonce=="string"?m.nonce:void 0})}}else m==null&&i.d.M(f)},tn.preload=function(f,m){if(typeof f=="string"&&typeof m=="object"&&m!==null&&typeof m.as=="string"){var g=m.as,y=h(g,m.crossOrigin);i.d.L(f,g,{crossOrigin:y,integrity:typeof m.integrity=="string"?m.integrity:void 0,nonce:typeof m.nonce=="string"?m.nonce:void 0,type:typeof m.type=="string"?m.type:void 0,fetchPriority:typeof m.fetchPriority=="string"?m.fetchPriority:void 0,referrerPolicy:typeof m.referrerPolicy=="string"?m.referrerPolicy:void 0,imageSrcSet:typeof m.imageSrcSet=="string"?m.imageSrcSet:void 0,imageSizes:typeof m.imageSizes=="string"?m.imageSizes:void 0,media:typeof m.media=="string"?m.media:void 0})}},tn.preloadModule=function(f,m){if(typeof f=="string")if(m){var g=h(m.as,m.crossOrigin);i.d.m(f,{as:typeof m.as=="string"&&m.as!=="script"?m.as:void 0,crossOrigin:g,integrity:typeof m.integrity=="string"?m.integrity:void 0})}else i.d.m(f)},tn.requestFormReset=function(f){i.d.r(f)},tn.unstable_batchedUpdates=function(f,m){return f(m)},tn.useFormState=function(f,m,g){return p.H.useFormState(f,m,g)},tn.useFormStatus=function(){return p.H.useHostTransitionStatus()},tn.version="19.1.1",tn}var xh;function p_(){if(xh)return xd.exports;xh=1;function a(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(a)}catch(n){console.error(n)}}return a(),xd.exports=u_(),xd.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var wh;function f_(){if(wh)return Ml;wh=1;var a=c_(),n=Ud(),l=p_();function i(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var r=2;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function c(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function d(e){var t=e,r=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,(t.flags&4098)!==0&&(r=t.return),e=t.return;while(e)}return t.tag===3?r:null}function p(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function h(e){if(d(e)!==e)throw Error(i(188))}function f(e){var t=e.alternate;if(!t){if(t=d(e),t===null)throw Error(i(188));return t!==e?null:e}for(var r=e,s=t;;){var u=r.return;if(u===null)break;var v=u.alternate;if(v===null){if(s=u.return,s!==null){r=s;continue}break}if(u.child===v.child){for(v=u.child;v;){if(v===r)return h(u),e;if(v===s)return h(u),t;v=v.sibling}throw Error(i(188))}if(r.return!==s.return)r=u,s=v;else{for(var q=!1,z=u.child;z;){if(z===r){q=!0,r=u,s=v;break}if(z===s){q=!0,s=u,r=v;break}z=z.sibling}if(!q){for(z=v.child;z;){if(z===r){q=!0,r=v,s=u;break}if(z===s){q=!0,s=v,r=u;break}z=z.sibling}if(!q)throw Error(i(189))}}if(r.alternate!==s)throw Error(i(190))}if(r.tag!==3)throw Error(i(188));return r.stateNode.current===r?e:t}function m(e){var t=e.tag;if(t===5||t===26||t===27||t===6)return e;for(e=e.child;e!==null;){if(t=m(e),t!==null)return t;e=e.sibling}return null}var g=Object.assign,y=Symbol.for("react.element"),w=Symbol.for("react.transitional.element"),_=Symbol.for("react.portal"),S=Symbol.for("react.fragment"),k=Symbol.for("react.strict_mode"),j=Symbol.for("react.profiler"),E=Symbol.for("react.provider"),C=Symbol.for("react.consumer"),b=Symbol.for("react.context"),T=Symbol.for("react.forward_ref"),A=Symbol.for("react.suspense"),H=Symbol.for("react.suspense_list"),$=Symbol.for("react.memo"),B=Symbol.for("react.lazy"),X=Symbol.for("react.activity"),I=Symbol.for("react.memo_cache_sentinel"),F=Symbol.iterator;function N(e){return e===null||typeof e!="object"?null:(e=F&&e[F]||e["@@iterator"],typeof e=="function"?e:null)}var D=Symbol.for("react.client.reference");function P(e){if(e==null)return null;if(typeof e=="function")return e.$$typeof===D?null:e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case S:return"Fragment";case j:return"Profiler";case k:return"StrictMode";case A:return"Suspense";case H:return"SuspenseList";case X:return"Activity"}if(typeof e=="object")switch(e.$$typeof){case _:return"Portal";case b:return(e.displayName||"Context")+".Provider";case C:return(e._context.displayName||"Context")+".Consumer";case T:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case $:return t=e.displayName||null,t!==null?t:P(e.type)||"Memo";case B:t=e._payload,e=e._init;try{return P(e(t))}catch{}}return null}var L=Array.isArray,R=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,O=l.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Z={pending:!1,data:null,method:null,action:null},ee=[],M=-1;function G(e){return{current:e}}function K(e){0>M||(e.current=ee[M],ee[M]=null,M--)}function W(e,t){M++,ee[M]=e.current,e.current=t}var U=G(null),Q=G(null),Y=G(null),ce=G(null);function te(e,t){switch(W(Y,t),W(Q,e),W(U,null),t.nodeType){case 9:case 11:e=(e=t.documentElement)&&(e=e.namespaceURI)?Mf(e):0;break;default:if(e=t.tagName,t=t.namespaceURI)t=Mf(t),e=Hf(t,e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}K(U),W(U,e)}function ye(){K(U),K(Q),K(Y)}function Se(e){e.memoizedState!==null&&W(ce,e);var t=U.current,r=Hf(t,e.type);t!==r&&(W(Q,e),W(U,r))}function ge(e){Q.current===e&&(K(U),K(Q)),ce.current===e&&(K(ce),$l._currentValue=Z)}var Fe=Object.prototype.hasOwnProperty,Le=a.unstable_scheduleCallback,Xe=a.unstable_cancelCallback,nt=a.unstable_shouldYield,we=a.unstable_requestPaint,Ce=a.unstable_now,Ie=a.unstable_getCurrentPriorityLevel,He=a.unstable_ImmediatePriority,gt=a.unstable_UserBlockingPriority,Ye=a.unstable_NormalPriority,qt=a.unstable_LowPriority,Zt=a.unstable_IdlePriority,vn=a.log,zn=a.unstable_setDisableYieldValue,sn=null,Rt=null;function Vt(e){if(typeof vn=="function"&&zn(e),Rt&&typeof Rt.setStrictMode=="function")try{Rt.setStrictMode(sn,e)}catch{}}var bt=Math.clz32?Math.clz32:ta,Vn=Math.log,ga=Math.LN2;function ta(e){return e>>>=0,e===0?32:31-(Vn(e)/ga|0)|0}var An=256,cn=4194304;function At(e){var t=e&42;if(t!==0)return t;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return e&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function Kt(e,t,r){var s=e.pendingLanes;if(s===0)return 0;var u=0,v=e.suspendedLanes,q=e.pingedLanes;e=e.warmLanes;var z=s&134217727;return z!==0?(s=z&~v,s!==0?u=At(s):(q&=z,q!==0?u=At(q):r||(r=z&~e,r!==0&&(u=At(r))))):(z=s&~v,z!==0?u=At(z):q!==0?u=At(q):r||(r=s&~e,r!==0&&(u=At(r)))),u===0?0:t!==0&&t!==u&&(t&v)===0&&(v=u&-u,r=t&-t,v>=r||v===32&&(r&4194048)!==0)?t:u}function _n(e,t){return(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&t)===0}function va(e,t){switch(e){case 1:case 2:case 4:case 8:case 64:return t+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function na(){var e=An;return An<<=1,(An&4194048)===0&&(An=256),e}function aa(){var e=cn;return cn<<=1,(cn&62914560)===0&&(cn=4194304),e}function Bn(e){for(var t=[],r=0;31>r;r++)t.push(e);return t}function dn(e,t){e.pendingLanes|=t,t!==268435456&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function Yn(e,t,r,s,u,v){var q=e.pendingLanes;e.pendingLanes=r,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=r,e.entangledLanes&=r,e.errorRecoveryDisabledLanes&=r,e.shellSuspendCounter=0;var z=e.entanglements,J=e.expirationTimes,se=e.hiddenUpdates;for(r=q&~r;0<r;){var pe=31-bt(r),me=1<<pe;z[pe]=0,J[pe]=-1;var ie=se[pe];if(ie!==null)for(se[pe]=null,pe=0;pe<ie.length;pe++){var de=ie[pe];de!==null&&(de.lane&=-536870913)}r&=~me}s!==0&&oa(e,s,0),v!==0&&u===0&&e.tag!==0&&(e.suspendedLanes|=v&~(q&~t))}function oa(e,t,r){e.pendingLanes|=t,e.suspendedLanes&=~t;var s=31-bt(t);e.entangledLanes|=t,e.entanglements[s]=e.entanglements[s]|1073741824|r&4194090}function ra(e,t){var r=e.entangledLanes|=t;for(e=e.entanglements;r;){var s=31-bt(r),u=1<<s;u&t|e[s]&t&&(e[s]|=t),r&=~u}}function Gn(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function Wn(e){return e&=-e,2<e?8<e?(e&134217727)!==0?32:268435456:8:2}function la(){var e=O.p;return e!==0?e:(e=window.event,e===void 0?32:sh(e.type))}function sa(e,t){var r=O.p;try{return O.p=e,t()}finally{O.p=r}}var Jt=Math.random().toString(36).slice(2),_t="__reactFiber$"+Jt,Et="__reactProps$"+Jt,ue="__reactContainer$"+Jt,be="__reactEvents$"+Jt,Ae="__reactListeners$"+Jt,$e="__reactHandles$"+Jt,Te="__reactResources$"+Jt,Me="__reactMarker$"+Jt;function Je(e){delete e[_t],delete e[Et],delete e[be],delete e[Ae],delete e[$e]}function ze(e){var t=e[_t];if(t)return t;for(var r=e.parentNode;r;){if(t=r[ue]||r[_t]){if(r=t.alternate,t.child!==null||r!==null&&r.child!==null)for(e=Yf(e);e!==null;){if(r=e[_t])return r;e=Yf(e)}return t}e=r,r=e.parentNode}return null}function qe(e){if(e=e[_t]||e[ue]){var t=e.tag;if(t===5||t===6||t===13||t===26||t===27||t===3)return e}return null}function at(e){var t=e.tag;if(t===5||t===26||t===27||t===6)return e.stateNode;throw Error(i(33))}function Bt(e){var t=e[Te];return t||(t=e[Te]={hoistableStyles:new Map,hoistableScripts:new Map}),t}function fe(e){e[Me]=!0}var _e=new Set,je={};function Ge(e,t){xt(e,t),xt(e+"Capture",t)}function xt(e,t){for(je[e]=t,e=0;e<t.length;e++)_e.add(t[e])}var nn=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),ia={},an={};function Dn(e){return Fe.call(an,e)?!0:Fe.call(ia,e)?!1:nn.test(e)?an[e]=!0:(ia[e]=!0,!1)}function Tn(e,t,r){if(Dn(t))if(r===null)e.removeAttribute(t);else{switch(typeof r){case"undefined":case"function":case"symbol":e.removeAttribute(t);return;case"boolean":var s=t.toLowerCase().slice(0,5);if(s!=="data-"&&s!=="aria-"){e.removeAttribute(t);return}}e.setAttribute(t,""+r)}}function on(e,t,r){if(r===null)e.removeAttribute(t);else{switch(typeof r){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(t);return}e.setAttribute(t,""+r)}}function un(e,t,r,s){if(s===null)e.removeAttribute(r);else{switch(typeof s){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(r);return}e.setAttributeNS(t,r,""+s)}}var bo,Lt;function Qn(e){if(bo===void 0)try{throw Error()}catch(r){var t=r.stack.trim().match(/\n( *(at )?)/);bo=t&&t[1]||"",Lt=-1<r.stack.indexOf(`
    at`)?" (<anonymous>)":-1<r.stack.indexOf("@")?"@unknown:0:0":""}return`
`+bo+e+Lt}var Ma=!1;function Ha(e,t){if(!e||Ma)return"";Ma=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var s={DetermineComponentFrameRoot:function(){try{if(t){var me=function(){throw Error()};if(Object.defineProperty(me.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(me,[])}catch(de){var ie=de}Reflect.construct(e,[],me)}else{try{me.call()}catch(de){ie=de}e.call(me.prototype)}}else{try{throw Error()}catch(de){ie=de}(me=e())&&typeof me.catch=="function"&&me.catch(function(){})}}catch(de){if(de&&ie&&typeof de.stack=="string")return[de.stack,ie.stack]}return[null,null]}};s.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var u=Object.getOwnPropertyDescriptor(s.DetermineComponentFrameRoot,"name");u&&u.configurable&&Object.defineProperty(s.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var v=s.DetermineComponentFrameRoot(),q=v[0],z=v[1];if(q&&z){var J=q.split(`
`),se=z.split(`
`);for(u=s=0;s<J.length&&!J[s].includes("DetermineComponentFrameRoot");)s++;for(;u<se.length&&!se[u].includes("DetermineComponentFrameRoot");)u++;if(s===J.length||u===se.length)for(s=J.length-1,u=se.length-1;1<=s&&0<=u&&J[s]!==se[u];)u--;for(;1<=s&&0<=u;s--,u--)if(J[s]!==se[u]){if(s!==1||u!==1)do if(s--,u--,0>u||J[s]!==se[u]){var pe=`
`+J[s].replace(" at new "," at ");return e.displayName&&pe.includes("<anonymous>")&&(pe=pe.replace("<anonymous>",e.displayName)),pe}while(1<=s&&0<=u);break}}}finally{Ma=!1,Error.prepareStackTrace=r}return(r=e?e.displayName||e.name:"")?Qn(r):""}function Zo(e){switch(e.tag){case 26:case 27:case 5:return Qn(e.type);case 16:return Qn("Lazy");case 13:return Qn("Suspense");case 19:return Qn("SuspenseList");case 0:case 15:return Ha(e.type,!1);case 11:return Ha(e.type.render,!1);case 1:return Ha(e.type,!0);case 31:return Qn("Activity");default:return""}}function So(e){try{var t="";do t+=Zo(e),e=e.return;while(e);return t}catch(r){return`
Error generating stack: `+r.message+`
`+r.stack}}function Yt(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function ca(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function Ot(e){var t=ca(e)?"checked":"value",r=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),s=""+e[t];if(!e.hasOwnProperty(t)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var u=r.get,v=r.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return u.call(this)},set:function(q){s=""+q,v.call(this,q)}}),Object.defineProperty(e,t,{enumerable:r.enumerable}),{getValue:function(){return s},setValue:function(q){s=""+q},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function za(e){e._valueTracker||(e._valueTracker=Ot(e))}function _a(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var r=t.getValue(),s="";return e&&(s=ca(e)?e.checked?"true":"false":e.value),e=s,e!==r?(t.setValue(e),!0):!1}function jo(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}var Kl=/[\n"\\]/g;function rn(e){return e.replace(Kl,function(t){return"\\"+t.charCodeAt(0).toString(16)+" "})}function Ko(e,t,r,s,u,v,q,z){e.name="",q!=null&&typeof q!="function"&&typeof q!="symbol"&&typeof q!="boolean"?e.type=q:e.removeAttribute("type"),t!=null?q==="number"?(t===0&&e.value===""||e.value!=t)&&(e.value=""+Yt(t)):e.value!==""+Yt(t)&&(e.value=""+Yt(t)):q!=="submit"&&q!=="reset"||e.removeAttribute("value"),t!=null?Jo(e,q,Yt(t)):r!=null?Jo(e,q,Yt(r)):s!=null&&e.removeAttribute("value"),u==null&&v!=null&&(e.defaultChecked=!!v),u!=null&&(e.checked=u&&typeof u!="function"&&typeof u!="symbol"),z!=null&&typeof z!="function"&&typeof z!="symbol"&&typeof z!="boolean"?e.name=""+Yt(z):e.removeAttribute("name")}function Vr(e,t,r,s,u,v,q,z){if(v!=null&&typeof v!="function"&&typeof v!="symbol"&&typeof v!="boolean"&&(e.type=v),t!=null||r!=null){if(!(v!=="submit"&&v!=="reset"||t!=null))return;r=r!=null?""+Yt(r):"",t=t!=null?""+Yt(t):r,z||t===e.value||(e.value=t),e.defaultValue=t}s=s??u,s=typeof s!="function"&&typeof s!="symbol"&&!!s,e.checked=z?e.checked:!!s,e.defaultChecked=!!s,q!=null&&typeof q!="function"&&typeof q!="symbol"&&typeof q!="boolean"&&(e.name=q)}function Jo(e,t,r){t==="number"&&jo(e.ownerDocument)===e||e.defaultValue===""+r||(e.defaultValue=""+r)}function xa(e,t,r,s){if(e=e.options,t){t={};for(var u=0;u<r.length;u++)t["$"+r[u]]=!0;for(r=0;r<e.length;r++)u=t.hasOwnProperty("$"+e[r].value),e[r].selected!==u&&(e[r].selected=u),u&&s&&(e[r].defaultSelected=!0)}else{for(r=""+Yt(r),t=null,u=0;u<e.length;u++){if(e[u].value===r){e[u].selected=!0,s&&(e[u].defaultSelected=!0);return}t!==null||e[u].disabled||(t=e[u])}t!==null&&(t.selected=!0)}}function Br(e,t,r){if(t!=null&&(t=""+Yt(t),t!==e.value&&(e.value=t),r==null)){e.defaultValue!==t&&(e.defaultValue=t);return}e.defaultValue=r!=null?""+Yt(r):""}function Yr(e,t,r,s){if(t==null){if(s!=null){if(r!=null)throw Error(i(92));if(L(s)){if(1<s.length)throw Error(i(93));s=s[0]}r=s}r==null&&(r=""),t=r}r=Yt(t),e.defaultValue=r,s=e.textContent,s===r&&s!==""&&s!==null&&(e.value=s)}function wa(e,t){if(t){var r=e.firstChild;if(r&&r===e.lastChild&&r.nodeType===3){r.nodeValue=t;return}}e.textContent=t}var Jl=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Gr(e,t,r){var s=t.indexOf("--")===0;r==null||typeof r=="boolean"||r===""?s?e.setProperty(t,""):t==="float"?e.cssFloat="":e[t]="":s?e.setProperty(t,r):typeof r!="number"||r===0||Jl.has(t)?t==="float"?e.cssFloat=r:e[t]=(""+r).trim():e[t]=r+"px"}function Wr(e,t,r){if(t!=null&&typeof t!="object")throw Error(i(62));if(e=e.style,r!=null){for(var s in r)!r.hasOwnProperty(s)||t!=null&&t.hasOwnProperty(s)||(s.indexOf("--")===0?e.setProperty(s,""):s==="float"?e.cssFloat="":e[s]="");for(var u in t)s=t[u],t.hasOwnProperty(u)&&r[u]!==s&&Gr(e,u,s)}else for(var v in t)t.hasOwnProperty(v)&&Gr(e,v,t[v])}function er(e){if(e.indexOf("-")===-1)return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var es=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),ts=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Eo(e){return ts.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}var tr=null;function nr(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var Ca=null,ba=null;function Qr(e){var t=qe(e);if(t&&(e=t.stateNode)){var r=e[Et]||null;e:switch(e=t.stateNode,t.type){case"input":if(Ko(e,r.value,r.defaultValue,r.defaultValue,r.checked,r.defaultChecked,r.type,r.name),t=r.name,r.type==="radio"&&t!=null){for(r=e;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll('input[name="'+rn(""+t)+'"][type="radio"]'),t=0;t<r.length;t++){var s=r[t];if(s!==e&&s.form===e.form){var u=s[Et]||null;if(!u)throw Error(i(90));Ko(s,u.value,u.defaultValue,u.defaultValue,u.checked,u.defaultChecked,u.type,u.name)}}for(t=0;t<r.length;t++)s=r[t],s.form===e.form&&_a(s)}break e;case"textarea":Br(e,r.value,r.defaultValue);break e;case"select":t=r.value,t!=null&&xa(e,!!r.multiple,t,!1)}}}var ar=!1;function ko(e,t,r){if(ar)return e(t,r);ar=!0;try{var s=e(t);return s}finally{if(ar=!1,(Ca!==null||ba!==null)&&(Ls(),Ca&&(t=Ca,e=ba,ba=Ca=null,Qr(t),e)))for(t=0;t<e.length;t++)Qr(e[t])}}function Ee(e,t){var r=e.stateNode;if(r===null)return null;var s=r[Et]||null;if(s===null)return null;r=s[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(s=!s.disabled)||(e=e.type,s=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!s;break e;default:e=!1}if(e)return null;if(r&&typeof r!="function")throw Error(i(231,t,typeof r));return r}var Xn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Va=!1;if(Xn)try{var Ba={};Object.defineProperty(Ba,"passive",{get:function(){Va=!0}}),window.addEventListener("test",Ba,Ba),window.removeEventListener("test",Ba,Ba)}catch{Va=!1}var Sa=null,or=null,ns=null;function Vd(){if(ns)return ns;var e,t=or,r=t.length,s,u="value"in Sa?Sa.value:Sa.textContent,v=u.length;for(e=0;e<r&&t[e]===u[e];e++);var q=r-e;for(s=1;s<=q&&t[r-s]===u[v-s];s++);return ns=u.slice(e,1<s?1-s:void 0)}function as(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function os(){return!0}function Bd(){return!1}function pn(e){function t(r,s,u,v,q){this._reactName=r,this._targetInst=u,this.type=s,this.nativeEvent=v,this.target=q,this.currentTarget=null;for(var z in e)e.hasOwnProperty(z)&&(r=e[z],this[z]=r?r(v):v[z]);return this.isDefaultPrevented=(v.defaultPrevented!=null?v.defaultPrevented:v.returnValue===!1)?os:Bd,this.isPropagationStopped=Bd,this}return g(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=os)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=os)},persist:function(){},isPersistent:os}),t}var No={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},rs=pn(No),Xr=g({},No,{view:0,detail:0}),lg=pn(Xr),xi,wi,Zr,ls=g({},Xr,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:bi,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Zr&&(Zr&&e.type==="mousemove"?(xi=e.screenX-Zr.screenX,wi=e.screenY-Zr.screenY):wi=xi=0,Zr=e),xi)},movementY:function(e){return"movementY"in e?e.movementY:wi}}),Yd=pn(ls),sg=g({},ls,{dataTransfer:0}),ig=pn(sg),cg=g({},Xr,{relatedTarget:0}),Ci=pn(cg),dg=g({},No,{animationName:0,elapsedTime:0,pseudoElement:0}),ug=pn(dg),pg=g({},No,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),fg=pn(pg),hg=g({},No,{data:0}),Gd=pn(hg),mg={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},yg={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},gg={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function vg(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=gg[e])?!!t[e]:!1}function bi(){return vg}var _g=g({},Xr,{key:function(e){if(e.key){var t=mg[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=as(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?yg[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:bi,charCode:function(e){return e.type==="keypress"?as(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?as(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),xg=pn(_g),wg=g({},ls,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Wd=pn(wg),Cg=g({},Xr,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:bi}),bg=pn(Cg),Sg=g({},No,{propertyName:0,elapsedTime:0,pseudoElement:0}),jg=pn(Sg),Eg=g({},ls,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),kg=pn(Eg),Ng=g({},No,{newState:0,oldState:0}),Rg=pn(Ng),Ag=[9,13,27,32],Si=Xn&&"CompositionEvent"in window,Kr=null;Xn&&"documentMode"in document&&(Kr=document.documentMode);var Dg=Xn&&"TextEvent"in window&&!Kr,Qd=Xn&&(!Si||Kr&&8<Kr&&11>=Kr),Xd=" ",Zd=!1;function Kd(e,t){switch(e){case"keyup":return Ag.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Jd(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var rr=!1;function Tg(e,t){switch(e){case"compositionend":return Jd(t);case"keypress":return t.which!==32?null:(Zd=!0,Xd);case"textInput":return e=t.data,e===Xd&&Zd?null:e;default:return null}}function Fg(e,t){if(rr)return e==="compositionend"||!Si&&Kd(e,t)?(e=Vd(),ns=or=Sa=null,rr=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Qd&&t.locale!=="ko"?null:t.data;default:return null}}var qg={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function eu(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!qg[e.type]:t==="textarea"}function tu(e,t,r,s){Ca?ba?ba.push(s):ba=[s]:Ca=s,t=Ys(t,"onChange"),0<t.length&&(r=new rs("onChange","change",null,r,s),e.push({event:r,listeners:t}))}var Jr=null,el=null;function $g(e){Uf(e,0)}function ss(e){var t=at(e);if(_a(t))return e}function nu(e,t){if(e==="change")return t}var au=!1;if(Xn){var ji;if(Xn){var Ei="oninput"in document;if(!Ei){var ou=document.createElement("div");ou.setAttribute("oninput","return;"),Ei=typeof ou.oninput=="function"}ji=Ei}else ji=!1;au=ji&&(!document.documentMode||9<document.documentMode)}function ru(){Jr&&(Jr.detachEvent("onpropertychange",lu),el=Jr=null)}function lu(e){if(e.propertyName==="value"&&ss(el)){var t=[];tu(t,el,e,nr(e)),ko($g,t)}}function Ug(e,t,r){e==="focusin"?(ru(),Jr=t,el=r,Jr.attachEvent("onpropertychange",lu)):e==="focusout"&&ru()}function Og(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return ss(el)}function Ig(e,t){if(e==="click")return ss(t)}function Pg(e,t){if(e==="input"||e==="change")return ss(t)}function Lg(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var xn=typeof Object.is=="function"?Object.is:Lg;function tl(e,t){if(xn(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var r=Object.keys(e),s=Object.keys(t);if(r.length!==s.length)return!1;for(s=0;s<r.length;s++){var u=r[s];if(!Fe.call(t,u)||!xn(e[u],t[u]))return!1}return!0}function su(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function iu(e,t){var r=su(e);e=0;for(var s;r;){if(r.nodeType===3){if(s=e+r.textContent.length,e<=t&&s>=t)return{node:r,offset:t-e};e=s}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=su(r)}}function cu(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?cu(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function du(e){e=e!=null&&e.ownerDocument!=null&&e.ownerDocument.defaultView!=null?e.ownerDocument.defaultView:window;for(var t=jo(e.document);t instanceof e.HTMLIFrameElement;){try{var r=typeof t.contentWindow.location.href=="string"}catch{r=!1}if(r)e=t.contentWindow;else break;t=jo(e.document)}return t}function ki(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}var Mg=Xn&&"documentMode"in document&&11>=document.documentMode,lr=null,Ni=null,nl=null,Ri=!1;function uu(e,t,r){var s=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;Ri||lr==null||lr!==jo(s)||(s=lr,"selectionStart"in s&&ki(s)?s={start:s.selectionStart,end:s.selectionEnd}:(s=(s.ownerDocument&&s.ownerDocument.defaultView||window).getSelection(),s={anchorNode:s.anchorNode,anchorOffset:s.anchorOffset,focusNode:s.focusNode,focusOffset:s.focusOffset}),nl&&tl(nl,s)||(nl=s,s=Ys(Ni,"onSelect"),0<s.length&&(t=new rs("onSelect","select",null,t,r),e.push({event:t,listeners:s}),t.target=lr)))}function Ro(e,t){var r={};return r[e.toLowerCase()]=t.toLowerCase(),r["Webkit"+e]="webkit"+t,r["Moz"+e]="moz"+t,r}var sr={animationend:Ro("Animation","AnimationEnd"),animationiteration:Ro("Animation","AnimationIteration"),animationstart:Ro("Animation","AnimationStart"),transitionrun:Ro("Transition","TransitionRun"),transitionstart:Ro("Transition","TransitionStart"),transitioncancel:Ro("Transition","TransitionCancel"),transitionend:Ro("Transition","TransitionEnd")},Ai={},pu={};Xn&&(pu=document.createElement("div").style,"AnimationEvent"in window||(delete sr.animationend.animation,delete sr.animationiteration.animation,delete sr.animationstart.animation),"TransitionEvent"in window||delete sr.transitionend.transition);function Ao(e){if(Ai[e])return Ai[e];if(!sr[e])return e;var t=sr[e],r;for(r in t)if(t.hasOwnProperty(r)&&r in pu)return Ai[e]=t[r];return e}var fu=Ao("animationend"),hu=Ao("animationiteration"),mu=Ao("animationstart"),Hg=Ao("transitionrun"),zg=Ao("transitionstart"),Vg=Ao("transitioncancel"),yu=Ao("transitionend"),gu=new Map,Di="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Di.push("scrollEnd");function Zn(e,t){gu.set(e,t),Ge(t,[e])}var vu=new WeakMap;function Fn(e,t){if(typeof e=="object"&&e!==null){var r=vu.get(e);return r!==void 0?r:(t={value:e,source:t,stack:So(t)},vu.set(e,t),t)}return{value:e,source:t,stack:So(t)}}var qn=[],ir=0,Ti=0;function is(){for(var e=ir,t=Ti=ir=0;t<e;){var r=qn[t];qn[t++]=null;var s=qn[t];qn[t++]=null;var u=qn[t];qn[t++]=null;var v=qn[t];if(qn[t++]=null,s!==null&&u!==null){var q=s.pending;q===null?u.next=u:(u.next=q.next,q.next=u),s.pending=u}v!==0&&_u(r,u,v)}}function cs(e,t,r,s){qn[ir++]=e,qn[ir++]=t,qn[ir++]=r,qn[ir++]=s,Ti|=s,e.lanes|=s,e=e.alternate,e!==null&&(e.lanes|=s)}function Fi(e,t,r,s){return cs(e,t,r,s),ds(e)}function cr(e,t){return cs(e,null,null,t),ds(e)}function _u(e,t,r){e.lanes|=r;var s=e.alternate;s!==null&&(s.lanes|=r);for(var u=!1,v=e.return;v!==null;)v.childLanes|=r,s=v.alternate,s!==null&&(s.childLanes|=r),v.tag===22&&(e=v.stateNode,e===null||e._visibility&1||(u=!0)),e=v,v=v.return;return e.tag===3?(v=e.stateNode,u&&t!==null&&(u=31-bt(r),e=v.hiddenUpdates,s=e[u],s===null?e[u]=[t]:s.push(t),t.lane=r|536870912),v):null}function ds(e){if(50<kl)throw kl=0,Pc=null,Error(i(185));for(var t=e.return;t!==null;)e=t,t=e.return;return e.tag===3?e.stateNode:null}var dr={};function Bg(e,t,r,s){this.tag=e,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=s,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function wn(e,t,r,s){return new Bg(e,t,r,s)}function qi(e){return e=e.prototype,!(!e||!e.isReactComponent)}function ja(e,t){var r=e.alternate;return r===null?(r=wn(e.tag,t,e.key,e.mode),r.elementType=e.elementType,r.type=e.type,r.stateNode=e.stateNode,r.alternate=e,e.alternate=r):(r.pendingProps=t,r.type=e.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=e.flags&65011712,r.childLanes=e.childLanes,r.lanes=e.lanes,r.child=e.child,r.memoizedProps=e.memoizedProps,r.memoizedState=e.memoizedState,r.updateQueue=e.updateQueue,t=e.dependencies,r.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},r.sibling=e.sibling,r.index=e.index,r.ref=e.ref,r.refCleanup=e.refCleanup,r}function xu(e,t){e.flags&=65011714;var r=e.alternate;return r===null?(e.childLanes=0,e.lanes=t,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=r.childLanes,e.lanes=r.lanes,e.child=r.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=r.memoizedProps,e.memoizedState=r.memoizedState,e.updateQueue=r.updateQueue,e.type=r.type,t=r.dependencies,e.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),e}function us(e,t,r,s,u,v){var q=0;if(s=e,typeof e=="function")qi(e)&&(q=1);else if(typeof e=="string")q=Gv(e,r,U.current)?26:e==="html"||e==="head"||e==="body"?27:5;else e:switch(e){case X:return e=wn(31,r,t,u),e.elementType=X,e.lanes=v,e;case S:return Do(r.children,u,v,t);case k:q=8,u|=24;break;case j:return e=wn(12,r,t,u|2),e.elementType=j,e.lanes=v,e;case A:return e=wn(13,r,t,u),e.elementType=A,e.lanes=v,e;case H:return e=wn(19,r,t,u),e.elementType=H,e.lanes=v,e;default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case E:case b:q=10;break e;case C:q=9;break e;case T:q=11;break e;case $:q=14;break e;case B:q=16,s=null;break e}q=29,r=Error(i(130,e===null?"null":typeof e,"")),s=null}return t=wn(q,r,t,u),t.elementType=e,t.type=s,t.lanes=v,t}function Do(e,t,r,s){return e=wn(7,e,s,t),e.lanes=r,e}function $i(e,t,r){return e=wn(6,e,null,t),e.lanes=r,e}function Ui(e,t,r){return t=wn(4,e.children!==null?e.children:[],e.key,t),t.lanes=r,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}var ur=[],pr=0,ps=null,fs=0,$n=[],Un=0,To=null,Ea=1,ka="";function Fo(e,t){ur[pr++]=fs,ur[pr++]=ps,ps=e,fs=t}function wu(e,t,r){$n[Un++]=Ea,$n[Un++]=ka,$n[Un++]=To,To=e;var s=Ea;e=ka;var u=32-bt(s)-1;s&=~(1<<u),r+=1;var v=32-bt(t)+u;if(30<v){var q=u-u%5;v=(s&(1<<q)-1).toString(32),s>>=q,u-=q,Ea=1<<32-bt(t)+u|r<<u|s,ka=v+e}else Ea=1<<v|r<<u|s,ka=e}function Oi(e){e.return!==null&&(Fo(e,1),wu(e,1,0))}function Ii(e){for(;e===ps;)ps=ur[--pr],ur[pr]=null,fs=ur[--pr],ur[pr]=null;for(;e===To;)To=$n[--Un],$n[Un]=null,ka=$n[--Un],$n[Un]=null,Ea=$n[--Un],$n[Un]=null}var ln=null,kt=null,it=!1,qo=null,da=!1,Pi=Error(i(519));function $o(e){var t=Error(i(418,""));throw rl(Fn(t,e)),Pi}function Cu(e){var t=e.stateNode,r=e.type,s=e.memoizedProps;switch(t[_t]=e,t[Et]=s,r){case"dialog":tt("cancel",t),tt("close",t);break;case"iframe":case"object":case"embed":tt("load",t);break;case"video":case"audio":for(r=0;r<Rl.length;r++)tt(Rl[r],t);break;case"source":tt("error",t);break;case"img":case"image":case"link":tt("error",t),tt("load",t);break;case"details":tt("toggle",t);break;case"input":tt("invalid",t),Vr(t,s.value,s.defaultValue,s.checked,s.defaultChecked,s.type,s.name,!0),za(t);break;case"select":tt("invalid",t);break;case"textarea":tt("invalid",t),Yr(t,s.value,s.defaultValue,s.children),za(t)}r=s.children,typeof r!="string"&&typeof r!="number"&&typeof r!="bigint"||t.textContent===""+r||s.suppressHydrationWarning===!0||Lf(t.textContent,r)?(s.popover!=null&&(tt("beforetoggle",t),tt("toggle",t)),s.onScroll!=null&&tt("scroll",t),s.onScrollEnd!=null&&tt("scrollend",t),s.onClick!=null&&(t.onclick=Gs),t=!0):t=!1,t||$o(e)}function bu(e){for(ln=e.return;ln;)switch(ln.tag){case 5:case 13:da=!1;return;case 27:case 3:da=!0;return;default:ln=ln.return}}function al(e){if(e!==ln)return!1;if(!it)return bu(e),it=!0,!1;var t=e.tag,r;if((r=t!==3&&t!==27)&&((r=t===5)&&(r=e.type,r=!(r!=="form"&&r!=="button")||td(e.type,e.memoizedProps)),r=!r),r&&kt&&$o(e),bu(e),t===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(i(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8)if(r=e.data,r==="/$"){if(t===0){kt=Jn(e.nextSibling);break e}t--}else r!=="$"&&r!=="$!"&&r!=="$?"||t++;e=e.nextSibling}kt=null}}else t===27?(t=kt,so(e.type)?(e=rd,rd=null,kt=e):kt=t):kt=ln?Jn(e.stateNode.nextSibling):null;return!0}function ol(){kt=ln=null,it=!1}function Su(){var e=qo;return e!==null&&(mn===null?mn=e:mn.push.apply(mn,e),qo=null),e}function rl(e){qo===null?qo=[e]:qo.push(e)}var Li=G(null),Uo=null,Na=null;function Ya(e,t,r){W(Li,t._currentValue),t._currentValue=r}function Ra(e){e._currentValue=Li.current,K(Li)}function Mi(e,t,r){for(;e!==null;){var s=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,s!==null&&(s.childLanes|=t)):s!==null&&(s.childLanes&t)!==t&&(s.childLanes|=t),e===r)break;e=e.return}}function Hi(e,t,r,s){var u=e.child;for(u!==null&&(u.return=e);u!==null;){var v=u.dependencies;if(v!==null){var q=u.child;v=v.firstContext;e:for(;v!==null;){var z=v;v=u;for(var J=0;J<t.length;J++)if(z.context===t[J]){v.lanes|=r,z=v.alternate,z!==null&&(z.lanes|=r),Mi(v.return,r,e),s||(q=null);break e}v=z.next}}else if(u.tag===18){if(q=u.return,q===null)throw Error(i(341));q.lanes|=r,v=q.alternate,v!==null&&(v.lanes|=r),Mi(q,r,e),q=null}else q=u.child;if(q!==null)q.return=u;else for(q=u;q!==null;){if(q===e){q=null;break}if(u=q.sibling,u!==null){u.return=q.return,q=u;break}q=q.return}u=q}}function ll(e,t,r,s){e=null;for(var u=t,v=!1;u!==null;){if(!v){if((u.flags&524288)!==0)v=!0;else if((u.flags&262144)!==0)break}if(u.tag===10){var q=u.alternate;if(q===null)throw Error(i(387));if(q=q.memoizedProps,q!==null){var z=u.type;xn(u.pendingProps.value,q.value)||(e!==null?e.push(z):e=[z])}}else if(u===ce.current){if(q=u.alternate,q===null)throw Error(i(387));q.memoizedState.memoizedState!==u.memoizedState.memoizedState&&(e!==null?e.push($l):e=[$l])}u=u.return}e!==null&&Hi(t,e,r,s),t.flags|=262144}function hs(e){for(e=e.firstContext;e!==null;){if(!xn(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function Oo(e){Uo=e,Na=null,e=e.dependencies,e!==null&&(e.firstContext=null)}function en(e){return ju(Uo,e)}function ms(e,t){return Uo===null&&Oo(e),ju(e,t)}function ju(e,t){var r=t._currentValue;if(t={context:t,memoizedValue:r,next:null},Na===null){if(e===null)throw Error(i(308));Na=t,e.dependencies={lanes:0,firstContext:t},e.flags|=524288}else Na=Na.next=t;return r}var Yg=typeof AbortController<"u"?AbortController:function(){var e=[],t=this.signal={aborted:!1,addEventListener:function(r,s){e.push(s)}};this.abort=function(){t.aborted=!0,e.forEach(function(r){return r()})}},Gg=a.unstable_scheduleCallback,Wg=a.unstable_NormalPriority,It={$$typeof:b,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function zi(){return{controller:new Yg,data:new Map,refCount:0}}function sl(e){e.refCount--,e.refCount===0&&Gg(Wg,function(){e.controller.abort()})}var il=null,Vi=0,fr=0,hr=null;function Qg(e,t){if(il===null){var r=il=[];Vi=0,fr=Yc(),hr={status:"pending",value:void 0,then:function(s){r.push(s)}}}return Vi++,t.then(Eu,Eu),t}function Eu(){if(--Vi===0&&il!==null){hr!==null&&(hr.status="fulfilled");var e=il;il=null,fr=0,hr=null;for(var t=0;t<e.length;t++)(0,e[t])()}}function Xg(e,t){var r=[],s={status:"pending",value:null,reason:null,then:function(u){r.push(u)}};return e.then(function(){s.status="fulfilled",s.value=t;for(var u=0;u<r.length;u++)(0,r[u])(t)},function(u){for(s.status="rejected",s.reason=u,u=0;u<r.length;u++)(0,r[u])(void 0)}),s}var ku=R.S;R.S=function(e,t){typeof t=="object"&&t!==null&&typeof t.then=="function"&&Qg(e,t),ku!==null&&ku(e,t)};var Io=G(null);function Bi(){var e=Io.current;return e!==null?e:mt.pooledCache}function ys(e,t){t===null?W(Io,Io.current):W(Io,t.pool)}function Nu(){var e=Bi();return e===null?null:{parent:It._currentValue,pool:e}}var cl=Error(i(460)),Ru=Error(i(474)),gs=Error(i(542)),Yi={then:function(){}};function Au(e){return e=e.status,e==="fulfilled"||e==="rejected"}function vs(){}function Du(e,t,r){switch(r=e[r],r===void 0?e.push(t):r!==t&&(t.then(vs,vs),t=r),t.status){case"fulfilled":return t.value;case"rejected":throw e=t.reason,Fu(e),e;default:if(typeof t.status=="string")t.then(vs,vs);else{if(e=mt,e!==null&&100<e.shellSuspendCounter)throw Error(i(482));e=t,e.status="pending",e.then(function(s){if(t.status==="pending"){var u=t;u.status="fulfilled",u.value=s}},function(s){if(t.status==="pending"){var u=t;u.status="rejected",u.reason=s}})}switch(t.status){case"fulfilled":return t.value;case"rejected":throw e=t.reason,Fu(e),e}throw dl=t,cl}}var dl=null;function Tu(){if(dl===null)throw Error(i(459));var e=dl;return dl=null,e}function Fu(e){if(e===cl||e===gs)throw Error(i(483))}var Ga=!1;function Gi(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Wi(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function Wa(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function Qa(e,t,r){var s=e.updateQueue;if(s===null)return null;if(s=s.shared,(ct&2)!==0){var u=s.pending;return u===null?t.next=t:(t.next=u.next,u.next=t),s.pending=t,t=ds(e),_u(e,null,r),t}return cs(e,s,t,r),ds(e)}function ul(e,t,r){if(t=t.updateQueue,t!==null&&(t=t.shared,(r&4194048)!==0)){var s=t.lanes;s&=e.pendingLanes,r|=s,t.lanes=r,ra(e,r)}}function Qi(e,t){var r=e.updateQueue,s=e.alternate;if(s!==null&&(s=s.updateQueue,r===s)){var u=null,v=null;if(r=r.firstBaseUpdate,r!==null){do{var q={lane:r.lane,tag:r.tag,payload:r.payload,callback:null,next:null};v===null?u=v=q:v=v.next=q,r=r.next}while(r!==null);v===null?u=v=t:v=v.next=t}else u=v=t;r={baseState:s.baseState,firstBaseUpdate:u,lastBaseUpdate:v,shared:s.shared,callbacks:s.callbacks},e.updateQueue=r;return}e=r.lastBaseUpdate,e===null?r.firstBaseUpdate=t:e.next=t,r.lastBaseUpdate=t}var Xi=!1;function pl(){if(Xi){var e=hr;if(e!==null)throw e}}function fl(e,t,r,s){Xi=!1;var u=e.updateQueue;Ga=!1;var v=u.firstBaseUpdate,q=u.lastBaseUpdate,z=u.shared.pending;if(z!==null){u.shared.pending=null;var J=z,se=J.next;J.next=null,q===null?v=se:q.next=se,q=J;var pe=e.alternate;pe!==null&&(pe=pe.updateQueue,z=pe.lastBaseUpdate,z!==q&&(z===null?pe.firstBaseUpdate=se:z.next=se,pe.lastBaseUpdate=J))}if(v!==null){var me=u.baseState;q=0,pe=se=J=null,z=v;do{var ie=z.lane&-536870913,de=ie!==z.lane;if(de?(ot&ie)===ie:(s&ie)===ie){ie!==0&&ie===fr&&(Xi=!0),pe!==null&&(pe=pe.next={lane:0,tag:z.tag,payload:z.payload,callback:null,next:null});e:{var Pe=e,Ue=z;ie=t;var ft=r;switch(Ue.tag){case 1:if(Pe=Ue.payload,typeof Pe=="function"){me=Pe.call(ft,me,ie);break e}me=Pe;break e;case 3:Pe.flags=Pe.flags&-65537|128;case 0:if(Pe=Ue.payload,ie=typeof Pe=="function"?Pe.call(ft,me,ie):Pe,ie==null)break e;me=g({},me,ie);break e;case 2:Ga=!0}}ie=z.callback,ie!==null&&(e.flags|=64,de&&(e.flags|=8192),de=u.callbacks,de===null?u.callbacks=[ie]:de.push(ie))}else de={lane:ie,tag:z.tag,payload:z.payload,callback:z.callback,next:null},pe===null?(se=pe=de,J=me):pe=pe.next=de,q|=ie;if(z=z.next,z===null){if(z=u.shared.pending,z===null)break;de=z,z=de.next,de.next=null,u.lastBaseUpdate=de,u.shared.pending=null}}while(!0);pe===null&&(J=me),u.baseState=J,u.firstBaseUpdate=se,u.lastBaseUpdate=pe,v===null&&(u.shared.lanes=0),ao|=q,e.lanes=q,e.memoizedState=me}}function qu(e,t){if(typeof e!="function")throw Error(i(191,e));e.call(t)}function $u(e,t){var r=e.callbacks;if(r!==null)for(e.callbacks=null,e=0;e<r.length;e++)qu(r[e],t)}var mr=G(null),_s=G(0);function Uu(e,t){e=Ua,W(_s,e),W(mr,t),Ua=e|t.baseLanes}function Zi(){W(_s,Ua),W(mr,mr.current)}function Ki(){Ua=_s.current,K(mr),K(_s)}var Xa=0,We=null,ut=null,$t=null,xs=!1,yr=!1,Po=!1,ws=0,hl=0,gr=null,Zg=0;function Dt(){throw Error(i(321))}function Ji(e,t){if(t===null)return!1;for(var r=0;r<t.length&&r<e.length;r++)if(!xn(e[r],t[r]))return!1;return!0}function ec(e,t,r,s,u,v){return Xa=v,We=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,R.H=e===null||e.memoizedState===null?_p:xp,Po=!1,v=r(s,u),Po=!1,yr&&(v=Iu(t,r,s,u)),Ou(e),v}function Ou(e){R.H=ks;var t=ut!==null&&ut.next!==null;if(Xa=0,$t=ut=We=null,xs=!1,hl=0,gr=null,t)throw Error(i(300));e===null||Mt||(e=e.dependencies,e!==null&&hs(e)&&(Mt=!0))}function Iu(e,t,r,s){We=e;var u=0;do{if(yr&&(gr=null),hl=0,yr=!1,25<=u)throw Error(i(301));if(u+=1,$t=ut=null,e.updateQueue!=null){var v=e.updateQueue;v.lastEffect=null,v.events=null,v.stores=null,v.memoCache!=null&&(v.memoCache.index=0)}R.H=ov,v=t(r,s)}while(yr);return v}function Kg(){var e=R.H,t=e.useState()[0];return t=typeof t.then=="function"?ml(t):t,e=e.useState()[0],(ut!==null?ut.memoizedState:null)!==e&&(We.flags|=1024),t}function tc(){var e=ws!==0;return ws=0,e}function nc(e,t,r){t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r}function ac(e){if(xs){for(e=e.memoizedState;e!==null;){var t=e.queue;t!==null&&(t.pending=null),e=e.next}xs=!1}Xa=0,$t=ut=We=null,yr=!1,hl=ws=0,gr=null}function fn(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return $t===null?We.memoizedState=$t=e:$t=$t.next=e,$t}function Ut(){if(ut===null){var e=We.alternate;e=e!==null?e.memoizedState:null}else e=ut.next;var t=$t===null?We.memoizedState:$t.next;if(t!==null)$t=t,ut=e;else{if(e===null)throw We.alternate===null?Error(i(467)):Error(i(310));ut=e,e={memoizedState:ut.memoizedState,baseState:ut.baseState,baseQueue:ut.baseQueue,queue:ut.queue,next:null},$t===null?We.memoizedState=$t=e:$t=$t.next=e}return $t}function oc(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function ml(e){var t=hl;return hl+=1,gr===null&&(gr=[]),e=Du(gr,e,t),t=We,($t===null?t.memoizedState:$t.next)===null&&(t=t.alternate,R.H=t===null||t.memoizedState===null?_p:xp),e}function Cs(e){if(e!==null&&typeof e=="object"){if(typeof e.then=="function")return ml(e);if(e.$$typeof===b)return en(e)}throw Error(i(438,String(e)))}function rc(e){var t=null,r=We.updateQueue;if(r!==null&&(t=r.memoCache),t==null){var s=We.alternate;s!==null&&(s=s.updateQueue,s!==null&&(s=s.memoCache,s!=null&&(t={data:s.data.map(function(u){return u.slice()}),index:0})))}if(t==null&&(t={data:[],index:0}),r===null&&(r=oc(),We.updateQueue=r),r.memoCache=t,r=t.data[t.index],r===void 0)for(r=t.data[t.index]=Array(e),s=0;s<e;s++)r[s]=I;return t.index++,r}function Aa(e,t){return typeof t=="function"?t(e):t}function bs(e){var t=Ut();return lc(t,ut,e)}function lc(e,t,r){var s=e.queue;if(s===null)throw Error(i(311));s.lastRenderedReducer=r;var u=e.baseQueue,v=s.pending;if(v!==null){if(u!==null){var q=u.next;u.next=v.next,v.next=q}t.baseQueue=u=v,s.pending=null}if(v=e.baseState,u===null)e.memoizedState=v;else{t=u.next;var z=q=null,J=null,se=t,pe=!1;do{var me=se.lane&-536870913;if(me!==se.lane?(ot&me)===me:(Xa&me)===me){var ie=se.revertLane;if(ie===0)J!==null&&(J=J.next={lane:0,revertLane:0,action:se.action,hasEagerState:se.hasEagerState,eagerState:se.eagerState,next:null}),me===fr&&(pe=!0);else if((Xa&ie)===ie){se=se.next,ie===fr&&(pe=!0);continue}else me={lane:0,revertLane:se.revertLane,action:se.action,hasEagerState:se.hasEagerState,eagerState:se.eagerState,next:null},J===null?(z=J=me,q=v):J=J.next=me,We.lanes|=ie,ao|=ie;me=se.action,Po&&r(v,me),v=se.hasEagerState?se.eagerState:r(v,me)}else ie={lane:me,revertLane:se.revertLane,action:se.action,hasEagerState:se.hasEagerState,eagerState:se.eagerState,next:null},J===null?(z=J=ie,q=v):J=J.next=ie,We.lanes|=me,ao|=me;se=se.next}while(se!==null&&se!==t);if(J===null?q=v:J.next=z,!xn(v,e.memoizedState)&&(Mt=!0,pe&&(r=hr,r!==null)))throw r;e.memoizedState=v,e.baseState=q,e.baseQueue=J,s.lastRenderedState=v}return u===null&&(s.lanes=0),[e.memoizedState,s.dispatch]}function sc(e){var t=Ut(),r=t.queue;if(r===null)throw Error(i(311));r.lastRenderedReducer=e;var s=r.dispatch,u=r.pending,v=t.memoizedState;if(u!==null){r.pending=null;var q=u=u.next;do v=e(v,q.action),q=q.next;while(q!==u);xn(v,t.memoizedState)||(Mt=!0),t.memoizedState=v,t.baseQueue===null&&(t.baseState=v),r.lastRenderedState=v}return[v,s]}function Pu(e,t,r){var s=We,u=Ut(),v=it;if(v){if(r===void 0)throw Error(i(407));r=r()}else r=t();var q=!xn((ut||u).memoizedState,r);q&&(u.memoizedState=r,Mt=!0),u=u.queue;var z=Hu.bind(null,s,u,e);if(yl(2048,8,z,[e]),u.getSnapshot!==t||q||$t!==null&&$t.memoizedState.tag&1){if(s.flags|=2048,vr(9,Ss(),Mu.bind(null,s,u,r,t),null),mt===null)throw Error(i(349));v||(Xa&124)!==0||Lu(s,t,r)}return r}function Lu(e,t,r){e.flags|=16384,e={getSnapshot:t,value:r},t=We.updateQueue,t===null?(t=oc(),We.updateQueue=t,t.stores=[e]):(r=t.stores,r===null?t.stores=[e]:r.push(e))}function Mu(e,t,r,s){t.value=r,t.getSnapshot=s,zu(t)&&Vu(e)}function Hu(e,t,r){return r(function(){zu(t)&&Vu(e)})}function zu(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!xn(e,r)}catch{return!0}}function Vu(e){var t=cr(e,2);t!==null&&En(t,e,2)}function ic(e){var t=fn();if(typeof e=="function"){var r=e;if(e=r(),Po){Vt(!0);try{r()}finally{Vt(!1)}}}return t.memoizedState=t.baseState=e,t.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Aa,lastRenderedState:e},t}function Bu(e,t,r,s){return e.baseState=r,lc(e,ut,typeof s=="function"?s:Aa)}function Jg(e,t,r,s,u){if(Es(e))throw Error(i(485));if(e=t.action,e!==null){var v={payload:u,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(q){v.listeners.push(q)}};R.T!==null?r(!0):v.isTransition=!1,s(v),r=t.pending,r===null?(v.next=t.pending=v,Yu(t,v)):(v.next=r.next,t.pending=r.next=v)}}function Yu(e,t){var r=t.action,s=t.payload,u=e.state;if(t.isTransition){var v=R.T,q={};R.T=q;try{var z=r(u,s),J=R.S;J!==null&&J(q,z),Gu(e,t,z)}catch(se){cc(e,t,se)}finally{R.T=v}}else try{v=r(u,s),Gu(e,t,v)}catch(se){cc(e,t,se)}}function Gu(e,t,r){r!==null&&typeof r=="object"&&typeof r.then=="function"?r.then(function(s){Wu(e,t,s)},function(s){return cc(e,t,s)}):Wu(e,t,r)}function Wu(e,t,r){t.status="fulfilled",t.value=r,Qu(t),e.state=r,t=e.pending,t!==null&&(r=t.next,r===t?e.pending=null:(r=r.next,t.next=r,Yu(e,r)))}function cc(e,t,r){var s=e.pending;if(e.pending=null,s!==null){s=s.next;do t.status="rejected",t.reason=r,Qu(t),t=t.next;while(t!==s)}e.action=null}function Qu(e){e=e.listeners;for(var t=0;t<e.length;t++)(0,e[t])()}function Xu(e,t){return t}function Zu(e,t){if(it){var r=mt.formState;if(r!==null){e:{var s=We;if(it){if(kt){t:{for(var u=kt,v=da;u.nodeType!==8;){if(!v){u=null;break t}if(u=Jn(u.nextSibling),u===null){u=null;break t}}v=u.data,u=v==="F!"||v==="F"?u:null}if(u){kt=Jn(u.nextSibling),s=u.data==="F!";break e}}$o(s)}s=!1}s&&(t=r[0])}}return r=fn(),r.memoizedState=r.baseState=t,s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Xu,lastRenderedState:t},r.queue=s,r=yp.bind(null,We,s),s.dispatch=r,s=ic(!1),v=hc.bind(null,We,!1,s.queue),s=fn(),u={state:t,dispatch:null,action:e,pending:null},s.queue=u,r=Jg.bind(null,We,u,v,r),u.dispatch=r,s.memoizedState=e,[t,r,!1]}function Ku(e){var t=Ut();return Ju(t,ut,e)}function Ju(e,t,r){if(t=lc(e,t,Xu)[0],e=bs(Aa)[0],typeof t=="object"&&t!==null&&typeof t.then=="function")try{var s=ml(t)}catch(q){throw q===cl?gs:q}else s=t;t=Ut();var u=t.queue,v=u.dispatch;return r!==t.memoizedState&&(We.flags|=2048,vr(9,Ss(),ev.bind(null,u,r),null)),[s,v,e]}function ev(e,t){e.action=t}function ep(e){var t=Ut(),r=ut;if(r!==null)return Ju(t,r,e);Ut(),t=t.memoizedState,r=Ut();var s=r.queue.dispatch;return r.memoizedState=e,[t,s,!1]}function vr(e,t,r,s){return e={tag:e,create:r,deps:s,inst:t,next:null},t=We.updateQueue,t===null&&(t=oc(),We.updateQueue=t),r=t.lastEffect,r===null?t.lastEffect=e.next=e:(s=r.next,r.next=e,e.next=s,t.lastEffect=e),e}function Ss(){return{destroy:void 0,resource:void 0}}function tp(){return Ut().memoizedState}function js(e,t,r,s){var u=fn();s=s===void 0?null:s,We.flags|=e,u.memoizedState=vr(1|t,Ss(),r,s)}function yl(e,t,r,s){var u=Ut();s=s===void 0?null:s;var v=u.memoizedState.inst;ut!==null&&s!==null&&Ji(s,ut.memoizedState.deps)?u.memoizedState=vr(t,v,r,s):(We.flags|=e,u.memoizedState=vr(1|t,v,r,s))}function np(e,t){js(8390656,8,e,t)}function ap(e,t){yl(2048,8,e,t)}function op(e,t){return yl(4,2,e,t)}function rp(e,t){return yl(4,4,e,t)}function lp(e,t){if(typeof t=="function"){e=e();var r=t(e);return function(){typeof r=="function"?r():t(null)}}if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function sp(e,t,r){r=r!=null?r.concat([e]):null,yl(4,4,lp.bind(null,t,e),r)}function dc(){}function ip(e,t){var r=Ut();t=t===void 0?null:t;var s=r.memoizedState;return t!==null&&Ji(t,s[1])?s[0]:(r.memoizedState=[e,t],e)}function cp(e,t){var r=Ut();t=t===void 0?null:t;var s=r.memoizedState;if(t!==null&&Ji(t,s[1]))return s[0];if(s=e(),Po){Vt(!0);try{e()}finally{Vt(!1)}}return r.memoizedState=[s,t],s}function uc(e,t,r){return r===void 0||(Xa&1073741824)!==0?e.memoizedState=t:(e.memoizedState=r,e=ff(),We.lanes|=e,ao|=e,r)}function dp(e,t,r,s){return xn(r,t)?r:mr.current!==null?(e=uc(e,r,s),xn(e,t)||(Mt=!0),e):(Xa&42)===0?(Mt=!0,e.memoizedState=r):(e=ff(),We.lanes|=e,ao|=e,t)}function up(e,t,r,s,u){var v=O.p;O.p=v!==0&&8>v?v:8;var q=R.T,z={};R.T=z,hc(e,!1,t,r);try{var J=u(),se=R.S;if(se!==null&&se(z,J),J!==null&&typeof J=="object"&&typeof J.then=="function"){var pe=Xg(J,s);gl(e,t,pe,jn(e))}else gl(e,t,s,jn(e))}catch(me){gl(e,t,{then:function(){},status:"rejected",reason:me},jn())}finally{O.p=v,R.T=q}}function tv(){}function pc(e,t,r,s){if(e.tag!==5)throw Error(i(476));var u=pp(e).queue;up(e,u,t,Z,r===null?tv:function(){return fp(e),r(s)})}function pp(e){var t=e.memoizedState;if(t!==null)return t;t={memoizedState:Z,baseState:Z,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Aa,lastRenderedState:Z},next:null};var r={};return t.next={memoizedState:r,baseState:r,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Aa,lastRenderedState:r},next:null},e.memoizedState=t,e=e.alternate,e!==null&&(e.memoizedState=t),t}function fp(e){var t=pp(e).next.queue;gl(e,t,{},jn())}function fc(){return en($l)}function hp(){return Ut().memoizedState}function mp(){return Ut().memoizedState}function nv(e){for(var t=e.return;t!==null;){switch(t.tag){case 24:case 3:var r=jn();e=Wa(r);var s=Qa(t,e,r);s!==null&&(En(s,t,r),ul(s,t,r)),t={cache:zi()},e.payload=t;return}t=t.return}}function av(e,t,r){var s=jn();r={lane:s,revertLane:0,action:r,hasEagerState:!1,eagerState:null,next:null},Es(e)?gp(t,r):(r=Fi(e,t,r,s),r!==null&&(En(r,e,s),vp(r,t,s)))}function yp(e,t,r){var s=jn();gl(e,t,r,s)}function gl(e,t,r,s){var u={lane:s,revertLane:0,action:r,hasEagerState:!1,eagerState:null,next:null};if(Es(e))gp(t,u);else{var v=e.alternate;if(e.lanes===0&&(v===null||v.lanes===0)&&(v=t.lastRenderedReducer,v!==null))try{var q=t.lastRenderedState,z=v(q,r);if(u.hasEagerState=!0,u.eagerState=z,xn(z,q))return cs(e,t,u,0),mt===null&&is(),!1}catch{}finally{}if(r=Fi(e,t,u,s),r!==null)return En(r,e,s),vp(r,t,s),!0}return!1}function hc(e,t,r,s){if(s={lane:2,revertLane:Yc(),action:s,hasEagerState:!1,eagerState:null,next:null},Es(e)){if(t)throw Error(i(479))}else t=Fi(e,r,s,2),t!==null&&En(t,e,2)}function Es(e){var t=e.alternate;return e===We||t!==null&&t===We}function gp(e,t){yr=xs=!0;var r=e.pending;r===null?t.next=t:(t.next=r.next,r.next=t),e.pending=t}function vp(e,t,r){if((r&4194048)!==0){var s=t.lanes;s&=e.pendingLanes,r|=s,t.lanes=r,ra(e,r)}}var ks={readContext:en,use:Cs,useCallback:Dt,useContext:Dt,useEffect:Dt,useImperativeHandle:Dt,useLayoutEffect:Dt,useInsertionEffect:Dt,useMemo:Dt,useReducer:Dt,useRef:Dt,useState:Dt,useDebugValue:Dt,useDeferredValue:Dt,useTransition:Dt,useSyncExternalStore:Dt,useId:Dt,useHostTransitionStatus:Dt,useFormState:Dt,useActionState:Dt,useOptimistic:Dt,useMemoCache:Dt,useCacheRefresh:Dt},_p={readContext:en,use:Cs,useCallback:function(e,t){return fn().memoizedState=[e,t===void 0?null:t],e},useContext:en,useEffect:np,useImperativeHandle:function(e,t,r){r=r!=null?r.concat([e]):null,js(4194308,4,lp.bind(null,t,e),r)},useLayoutEffect:function(e,t){return js(4194308,4,e,t)},useInsertionEffect:function(e,t){js(4,2,e,t)},useMemo:function(e,t){var r=fn();t=t===void 0?null:t;var s=e();if(Po){Vt(!0);try{e()}finally{Vt(!1)}}return r.memoizedState=[s,t],s},useReducer:function(e,t,r){var s=fn();if(r!==void 0){var u=r(t);if(Po){Vt(!0);try{r(t)}finally{Vt(!1)}}}else u=t;return s.memoizedState=s.baseState=u,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:u},s.queue=e,e=e.dispatch=av.bind(null,We,e),[s.memoizedState,e]},useRef:function(e){var t=fn();return e={current:e},t.memoizedState=e},useState:function(e){e=ic(e);var t=e.queue,r=yp.bind(null,We,t);return t.dispatch=r,[e.memoizedState,r]},useDebugValue:dc,useDeferredValue:function(e,t){var r=fn();return uc(r,e,t)},useTransition:function(){var e=ic(!1);return e=up.bind(null,We,e.queue,!0,!1),fn().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,t,r){var s=We,u=fn();if(it){if(r===void 0)throw Error(i(407));r=r()}else{if(r=t(),mt===null)throw Error(i(349));(ot&124)!==0||Lu(s,t,r)}u.memoizedState=r;var v={value:r,getSnapshot:t};return u.queue=v,np(Hu.bind(null,s,v,e),[e]),s.flags|=2048,vr(9,Ss(),Mu.bind(null,s,v,r,t),null),r},useId:function(){var e=fn(),t=mt.identifierPrefix;if(it){var r=ka,s=Ea;r=(s&~(1<<32-bt(s)-1)).toString(32)+r,t=""+t+"R"+r,r=ws++,0<r&&(t+="H"+r.toString(32)),t+=""}else r=Zg++,t=""+t+"r"+r.toString(32)+"";return e.memoizedState=t},useHostTransitionStatus:fc,useFormState:Zu,useActionState:Zu,useOptimistic:function(e){var t=fn();t.memoizedState=t.baseState=e;var r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return t.queue=r,t=hc.bind(null,We,!0,r),r.dispatch=t,[e,t]},useMemoCache:rc,useCacheRefresh:function(){return fn().memoizedState=nv.bind(null,We)}},xp={readContext:en,use:Cs,useCallback:ip,useContext:en,useEffect:ap,useImperativeHandle:sp,useInsertionEffect:op,useLayoutEffect:rp,useMemo:cp,useReducer:bs,useRef:tp,useState:function(){return bs(Aa)},useDebugValue:dc,useDeferredValue:function(e,t){var r=Ut();return dp(r,ut.memoizedState,e,t)},useTransition:function(){var e=bs(Aa)[0],t=Ut().memoizedState;return[typeof e=="boolean"?e:ml(e),t]},useSyncExternalStore:Pu,useId:hp,useHostTransitionStatus:fc,useFormState:Ku,useActionState:Ku,useOptimistic:function(e,t){var r=Ut();return Bu(r,ut,e,t)},useMemoCache:rc,useCacheRefresh:mp},ov={readContext:en,use:Cs,useCallback:ip,useContext:en,useEffect:ap,useImperativeHandle:sp,useInsertionEffect:op,useLayoutEffect:rp,useMemo:cp,useReducer:sc,useRef:tp,useState:function(){return sc(Aa)},useDebugValue:dc,useDeferredValue:function(e,t){var r=Ut();return ut===null?uc(r,e,t):dp(r,ut.memoizedState,e,t)},useTransition:function(){var e=sc(Aa)[0],t=Ut().memoizedState;return[typeof e=="boolean"?e:ml(e),t]},useSyncExternalStore:Pu,useId:hp,useHostTransitionStatus:fc,useFormState:ep,useActionState:ep,useOptimistic:function(e,t){var r=Ut();return ut!==null?Bu(r,ut,e,t):(r.baseState=e,[e,r.queue.dispatch])},useMemoCache:rc,useCacheRefresh:mp},_r=null,vl=0;function Ns(e){var t=vl;return vl+=1,_r===null&&(_r=[]),Du(_r,e,t)}function _l(e,t){t=t.props.ref,e.ref=t!==void 0?t:null}function Rs(e,t){throw t.$$typeof===y?Error(i(525)):(e=Object.prototype.toString.call(t),Error(i(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)))}function wp(e){var t=e._init;return t(e._payload)}function Cp(e){function t(oe,ne){if(e){var le=oe.deletions;le===null?(oe.deletions=[ne],oe.flags|=16):le.push(ne)}}function r(oe,ne){if(!e)return null;for(;ne!==null;)t(oe,ne),ne=ne.sibling;return null}function s(oe){for(var ne=new Map;oe!==null;)oe.key!==null?ne.set(oe.key,oe):ne.set(oe.index,oe),oe=oe.sibling;return ne}function u(oe,ne){return oe=ja(oe,ne),oe.index=0,oe.sibling=null,oe}function v(oe,ne,le){return oe.index=le,e?(le=oe.alternate,le!==null?(le=le.index,le<ne?(oe.flags|=67108866,ne):le):(oe.flags|=67108866,ne)):(oe.flags|=1048576,ne)}function q(oe){return e&&oe.alternate===null&&(oe.flags|=67108866),oe}function z(oe,ne,le,he){return ne===null||ne.tag!==6?(ne=$i(le,oe.mode,he),ne.return=oe,ne):(ne=u(ne,le),ne.return=oe,ne)}function J(oe,ne,le,he){var Re=le.type;return Re===S?pe(oe,ne,le.props.children,he,le.key):ne!==null&&(ne.elementType===Re||typeof Re=="object"&&Re!==null&&Re.$$typeof===B&&wp(Re)===ne.type)?(ne=u(ne,le.props),_l(ne,le),ne.return=oe,ne):(ne=us(le.type,le.key,le.props,null,oe.mode,he),_l(ne,le),ne.return=oe,ne)}function se(oe,ne,le,he){return ne===null||ne.tag!==4||ne.stateNode.containerInfo!==le.containerInfo||ne.stateNode.implementation!==le.implementation?(ne=Ui(le,oe.mode,he),ne.return=oe,ne):(ne=u(ne,le.children||[]),ne.return=oe,ne)}function pe(oe,ne,le,he,Re){return ne===null||ne.tag!==7?(ne=Do(le,oe.mode,he,Re),ne.return=oe,ne):(ne=u(ne,le),ne.return=oe,ne)}function me(oe,ne,le){if(typeof ne=="string"&&ne!==""||typeof ne=="number"||typeof ne=="bigint")return ne=$i(""+ne,oe.mode,le),ne.return=oe,ne;if(typeof ne=="object"&&ne!==null){switch(ne.$$typeof){case w:return le=us(ne.type,ne.key,ne.props,null,oe.mode,le),_l(le,ne),le.return=oe,le;case _:return ne=Ui(ne,oe.mode,le),ne.return=oe,ne;case B:var he=ne._init;return ne=he(ne._payload),me(oe,ne,le)}if(L(ne)||N(ne))return ne=Do(ne,oe.mode,le,null),ne.return=oe,ne;if(typeof ne.then=="function")return me(oe,Ns(ne),le);if(ne.$$typeof===b)return me(oe,ms(oe,ne),le);Rs(oe,ne)}return null}function ie(oe,ne,le,he){var Re=ne!==null?ne.key:null;if(typeof le=="string"&&le!==""||typeof le=="number"||typeof le=="bigint")return Re!==null?null:z(oe,ne,""+le,he);if(typeof le=="object"&&le!==null){switch(le.$$typeof){case w:return le.key===Re?J(oe,ne,le,he):null;case _:return le.key===Re?se(oe,ne,le,he):null;case B:return Re=le._init,le=Re(le._payload),ie(oe,ne,le,he)}if(L(le)||N(le))return Re!==null?null:pe(oe,ne,le,he,null);if(typeof le.then=="function")return ie(oe,ne,Ns(le),he);if(le.$$typeof===b)return ie(oe,ne,ms(oe,le),he);Rs(oe,le)}return null}function de(oe,ne,le,he,Re){if(typeof he=="string"&&he!==""||typeof he=="number"||typeof he=="bigint")return oe=oe.get(le)||null,z(ne,oe,""+he,Re);if(typeof he=="object"&&he!==null){switch(he.$$typeof){case w:return oe=oe.get(he.key===null?le:he.key)||null,J(ne,oe,he,Re);case _:return oe=oe.get(he.key===null?le:he.key)||null,se(ne,oe,he,Re);case B:var Ze=he._init;return he=Ze(he._payload),de(oe,ne,le,he,Re)}if(L(he)||N(he))return oe=oe.get(le)||null,pe(ne,oe,he,Re,null);if(typeof he.then=="function")return de(oe,ne,le,Ns(he),Re);if(he.$$typeof===b)return de(oe,ne,le,ms(ne,he),Re);Rs(ne,he)}return null}function Pe(oe,ne,le,he){for(var Re=null,Ze=null,De=ne,Oe=ne=0,zt=null;De!==null&&Oe<le.length;Oe++){De.index>Oe?(zt=De,De=null):zt=De.sibling;var lt=ie(oe,De,le[Oe],he);if(lt===null){De===null&&(De=zt);break}e&&De&&lt.alternate===null&&t(oe,De),ne=v(lt,ne,Oe),Ze===null?Re=lt:Ze.sibling=lt,Ze=lt,De=zt}if(Oe===le.length)return r(oe,De),it&&Fo(oe,Oe),Re;if(De===null){for(;Oe<le.length;Oe++)De=me(oe,le[Oe],he),De!==null&&(ne=v(De,ne,Oe),Ze===null?Re=De:Ze.sibling=De,Ze=De);return it&&Fo(oe,Oe),Re}for(De=s(De);Oe<le.length;Oe++)zt=de(De,oe,Oe,le[Oe],he),zt!==null&&(e&&zt.alternate!==null&&De.delete(zt.key===null?Oe:zt.key),ne=v(zt,ne,Oe),Ze===null?Re=zt:Ze.sibling=zt,Ze=zt);return e&&De.forEach(function(fo){return t(oe,fo)}),it&&Fo(oe,Oe),Re}function Ue(oe,ne,le,he){if(le==null)throw Error(i(151));for(var Re=null,Ze=null,De=ne,Oe=ne=0,zt=null,lt=le.next();De!==null&&!lt.done;Oe++,lt=le.next()){De.index>Oe?(zt=De,De=null):zt=De.sibling;var fo=ie(oe,De,lt.value,he);if(fo===null){De===null&&(De=zt);break}e&&De&&fo.alternate===null&&t(oe,De),ne=v(fo,ne,Oe),Ze===null?Re=fo:Ze.sibling=fo,Ze=fo,De=zt}if(lt.done)return r(oe,De),it&&Fo(oe,Oe),Re;if(De===null){for(;!lt.done;Oe++,lt=le.next())lt=me(oe,lt.value,he),lt!==null&&(ne=v(lt,ne,Oe),Ze===null?Re=lt:Ze.sibling=lt,Ze=lt);return it&&Fo(oe,Oe),Re}for(De=s(De);!lt.done;Oe++,lt=le.next())lt=de(De,oe,Oe,lt.value,he),lt!==null&&(e&&lt.alternate!==null&&De.delete(lt.key===null?Oe:lt.key),ne=v(lt,ne,Oe),Ze===null?Re=lt:Ze.sibling=lt,Ze=lt);return e&&De.forEach(function(r_){return t(oe,r_)}),it&&Fo(oe,Oe),Re}function ft(oe,ne,le,he){if(typeof le=="object"&&le!==null&&le.type===S&&le.key===null&&(le=le.props.children),typeof le=="object"&&le!==null){switch(le.$$typeof){case w:e:{for(var Re=le.key;ne!==null;){if(ne.key===Re){if(Re=le.type,Re===S){if(ne.tag===7){r(oe,ne.sibling),he=u(ne,le.props.children),he.return=oe,oe=he;break e}}else if(ne.elementType===Re||typeof Re=="object"&&Re!==null&&Re.$$typeof===B&&wp(Re)===ne.type){r(oe,ne.sibling),he=u(ne,le.props),_l(he,le),he.return=oe,oe=he;break e}r(oe,ne);break}else t(oe,ne);ne=ne.sibling}le.type===S?(he=Do(le.props.children,oe.mode,he,le.key),he.return=oe,oe=he):(he=us(le.type,le.key,le.props,null,oe.mode,he),_l(he,le),he.return=oe,oe=he)}return q(oe);case _:e:{for(Re=le.key;ne!==null;){if(ne.key===Re)if(ne.tag===4&&ne.stateNode.containerInfo===le.containerInfo&&ne.stateNode.implementation===le.implementation){r(oe,ne.sibling),he=u(ne,le.children||[]),he.return=oe,oe=he;break e}else{r(oe,ne);break}else t(oe,ne);ne=ne.sibling}he=Ui(le,oe.mode,he),he.return=oe,oe=he}return q(oe);case B:return Re=le._init,le=Re(le._payload),ft(oe,ne,le,he)}if(L(le))return Pe(oe,ne,le,he);if(N(le)){if(Re=N(le),typeof Re!="function")throw Error(i(150));return le=Re.call(le),Ue(oe,ne,le,he)}if(typeof le.then=="function")return ft(oe,ne,Ns(le),he);if(le.$$typeof===b)return ft(oe,ne,ms(oe,le),he);Rs(oe,le)}return typeof le=="string"&&le!==""||typeof le=="number"||typeof le=="bigint"?(le=""+le,ne!==null&&ne.tag===6?(r(oe,ne.sibling),he=u(ne,le),he.return=oe,oe=he):(r(oe,ne),he=$i(le,oe.mode,he),he.return=oe,oe=he),q(oe)):r(oe,ne)}return function(oe,ne,le,he){try{vl=0;var Re=ft(oe,ne,le,he);return _r=null,Re}catch(De){if(De===cl||De===gs)throw De;var Ze=wn(29,De,null,oe.mode);return Ze.lanes=he,Ze.return=oe,Ze}finally{}}}var xr=Cp(!0),bp=Cp(!1),On=G(null),ua=null;function Za(e){var t=e.alternate;W(Pt,Pt.current&1),W(On,e),ua===null&&(t===null||mr.current!==null||t.memoizedState!==null)&&(ua=e)}function Sp(e){if(e.tag===22){if(W(Pt,Pt.current),W(On,e),ua===null){var t=e.alternate;t!==null&&t.memoizedState!==null&&(ua=e)}}else Ka()}function Ka(){W(Pt,Pt.current),W(On,On.current)}function Da(e){K(On),ua===e&&(ua=null),K(Pt)}var Pt=G(0);function As(e){for(var t=e;t!==null;){if(t.tag===13){var r=t.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||od(r)))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if((t.flags&128)!==0)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}function mc(e,t,r,s){t=e.memoizedState,r=r(s,t),r=r==null?t:g({},t,r),e.memoizedState=r,e.lanes===0&&(e.updateQueue.baseState=r)}var yc={enqueueSetState:function(e,t,r){e=e._reactInternals;var s=jn(),u=Wa(s);u.payload=t,r!=null&&(u.callback=r),t=Qa(e,u,s),t!==null&&(En(t,e,s),ul(t,e,s))},enqueueReplaceState:function(e,t,r){e=e._reactInternals;var s=jn(),u=Wa(s);u.tag=1,u.payload=t,r!=null&&(u.callback=r),t=Qa(e,u,s),t!==null&&(En(t,e,s),ul(t,e,s))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var r=jn(),s=Wa(r);s.tag=2,t!=null&&(s.callback=t),t=Qa(e,s,r),t!==null&&(En(t,e,r),ul(t,e,r))}};function jp(e,t,r,s,u,v,q){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(s,v,q):t.prototype&&t.prototype.isPureReactComponent?!tl(r,s)||!tl(u,v):!0}function Ep(e,t,r,s){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(r,s),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(r,s),t.state!==e&&yc.enqueueReplaceState(t,t.state,null)}function Lo(e,t){var r=t;if("ref"in t){r={};for(var s in t)s!=="ref"&&(r[s]=t[s])}if(e=e.defaultProps){r===t&&(r=g({},r));for(var u in e)r[u]===void 0&&(r[u]=e[u])}return r}var Ds=typeof reportError=="function"?reportError:function(e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof e=="object"&&e!==null&&typeof e.message=="string"?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",e);return}console.error(e)};function kp(e){Ds(e)}function Np(e){console.error(e)}function Rp(e){Ds(e)}function Ts(e,t){try{var r=e.onUncaughtError;r(t.value,{componentStack:t.stack})}catch(s){setTimeout(function(){throw s})}}function Ap(e,t,r){try{var s=e.onCaughtError;s(r.value,{componentStack:r.stack,errorBoundary:t.tag===1?t.stateNode:null})}catch(u){setTimeout(function(){throw u})}}function gc(e,t,r){return r=Wa(r),r.tag=3,r.payload={element:null},r.callback=function(){Ts(e,t)},r}function Dp(e){return e=Wa(e),e.tag=3,e}function Tp(e,t,r,s){var u=r.type.getDerivedStateFromError;if(typeof u=="function"){var v=s.value;e.payload=function(){return u(v)},e.callback=function(){Ap(t,r,s)}}var q=r.stateNode;q!==null&&typeof q.componentDidCatch=="function"&&(e.callback=function(){Ap(t,r,s),typeof u!="function"&&(oo===null?oo=new Set([this]):oo.add(this));var z=s.stack;this.componentDidCatch(s.value,{componentStack:z!==null?z:""})})}function rv(e,t,r,s,u){if(r.flags|=32768,s!==null&&typeof s=="object"&&typeof s.then=="function"){if(t=r.alternate,t!==null&&ll(t,r,u,!0),r=On.current,r!==null){switch(r.tag){case 13:return ua===null?Mc():r.alternate===null&&Nt===0&&(Nt=3),r.flags&=-257,r.flags|=65536,r.lanes=u,s===Yi?r.flags|=16384:(t=r.updateQueue,t===null?r.updateQueue=new Set([s]):t.add(s),zc(e,s,u)),!1;case 22:return r.flags|=65536,s===Yi?r.flags|=16384:(t=r.updateQueue,t===null?(t={transitions:null,markerInstances:null,retryQueue:new Set([s])},r.updateQueue=t):(r=t.retryQueue,r===null?t.retryQueue=new Set([s]):r.add(s)),zc(e,s,u)),!1}throw Error(i(435,r.tag))}return zc(e,s,u),Mc(),!1}if(it)return t=On.current,t!==null?((t.flags&65536)===0&&(t.flags|=256),t.flags|=65536,t.lanes=u,s!==Pi&&(e=Error(i(422),{cause:s}),rl(Fn(e,r)))):(s!==Pi&&(t=Error(i(423),{cause:s}),rl(Fn(t,r))),e=e.current.alternate,e.flags|=65536,u&=-u,e.lanes|=u,s=Fn(s,r),u=gc(e.stateNode,s,u),Qi(e,u),Nt!==4&&(Nt=2)),!1;var v=Error(i(520),{cause:s});if(v=Fn(v,r),El===null?El=[v]:El.push(v),Nt!==4&&(Nt=2),t===null)return!0;s=Fn(s,r),r=t;do{switch(r.tag){case 3:return r.flags|=65536,e=u&-u,r.lanes|=e,e=gc(r.stateNode,s,e),Qi(r,e),!1;case 1:if(t=r.type,v=r.stateNode,(r.flags&128)===0&&(typeof t.getDerivedStateFromError=="function"||v!==null&&typeof v.componentDidCatch=="function"&&(oo===null||!oo.has(v))))return r.flags|=65536,u&=-u,r.lanes|=u,u=Dp(u),Tp(u,e,r,s),Qi(r,u),!1}r=r.return}while(r!==null);return!1}var Fp=Error(i(461)),Mt=!1;function Gt(e,t,r,s){t.child=e===null?bp(t,null,r,s):xr(t,e.child,r,s)}function qp(e,t,r,s,u){r=r.render;var v=t.ref;if("ref"in s){var q={};for(var z in s)z!=="ref"&&(q[z]=s[z])}else q=s;return Oo(t),s=ec(e,t,r,q,v,u),z=tc(),e!==null&&!Mt?(nc(e,t,u),Ta(e,t,u)):(it&&z&&Oi(t),t.flags|=1,Gt(e,t,s,u),t.child)}function $p(e,t,r,s,u){if(e===null){var v=r.type;return typeof v=="function"&&!qi(v)&&v.defaultProps===void 0&&r.compare===null?(t.tag=15,t.type=v,Up(e,t,v,s,u)):(e=us(r.type,null,s,t,t.mode,u),e.ref=t.ref,e.return=t,t.child=e)}if(v=e.child,!jc(e,u)){var q=v.memoizedProps;if(r=r.compare,r=r!==null?r:tl,r(q,s)&&e.ref===t.ref)return Ta(e,t,u)}return t.flags|=1,e=ja(v,s),e.ref=t.ref,e.return=t,t.child=e}function Up(e,t,r,s,u){if(e!==null){var v=e.memoizedProps;if(tl(v,s)&&e.ref===t.ref)if(Mt=!1,t.pendingProps=s=v,jc(e,u))(e.flags&131072)!==0&&(Mt=!0);else return t.lanes=e.lanes,Ta(e,t,u)}return vc(e,t,r,s,u)}function Op(e,t,r){var s=t.pendingProps,u=s.children,v=e!==null?e.memoizedState:null;if(s.mode==="hidden"){if((t.flags&128)!==0){if(s=v!==null?v.baseLanes|r:r,e!==null){for(u=t.child=e.child,v=0;u!==null;)v=v|u.lanes|u.childLanes,u=u.sibling;t.childLanes=v&~s}else t.childLanes=0,t.child=null;return Ip(e,t,s,r)}if((r&536870912)!==0)t.memoizedState={baseLanes:0,cachePool:null},e!==null&&ys(t,v!==null?v.cachePool:null),v!==null?Uu(t,v):Zi(),Sp(t);else return t.lanes=t.childLanes=536870912,Ip(e,t,v!==null?v.baseLanes|r:r,r)}else v!==null?(ys(t,v.cachePool),Uu(t,v),Ka(),t.memoizedState=null):(e!==null&&ys(t,null),Zi(),Ka());return Gt(e,t,u,r),t.child}function Ip(e,t,r,s){var u=Bi();return u=u===null?null:{parent:It._currentValue,pool:u},t.memoizedState={baseLanes:r,cachePool:u},e!==null&&ys(t,null),Zi(),Sp(t),e!==null&&ll(e,t,s,!0),null}function Fs(e,t){var r=t.ref;if(r===null)e!==null&&e.ref!==null&&(t.flags|=4194816);else{if(typeof r!="function"&&typeof r!="object")throw Error(i(284));(e===null||e.ref!==r)&&(t.flags|=4194816)}}function vc(e,t,r,s,u){return Oo(t),r=ec(e,t,r,s,void 0,u),s=tc(),e!==null&&!Mt?(nc(e,t,u),Ta(e,t,u)):(it&&s&&Oi(t),t.flags|=1,Gt(e,t,r,u),t.child)}function Pp(e,t,r,s,u,v){return Oo(t),t.updateQueue=null,r=Iu(t,s,r,u),Ou(e),s=tc(),e!==null&&!Mt?(nc(e,t,v),Ta(e,t,v)):(it&&s&&Oi(t),t.flags|=1,Gt(e,t,r,v),t.child)}function Lp(e,t,r,s,u){if(Oo(t),t.stateNode===null){var v=dr,q=r.contextType;typeof q=="object"&&q!==null&&(v=en(q)),v=new r(s,v),t.memoizedState=v.state!==null&&v.state!==void 0?v.state:null,v.updater=yc,t.stateNode=v,v._reactInternals=t,v=t.stateNode,v.props=s,v.state=t.memoizedState,v.refs={},Gi(t),q=r.contextType,v.context=typeof q=="object"&&q!==null?en(q):dr,v.state=t.memoizedState,q=r.getDerivedStateFromProps,typeof q=="function"&&(mc(t,r,q,s),v.state=t.memoizedState),typeof r.getDerivedStateFromProps=="function"||typeof v.getSnapshotBeforeUpdate=="function"||typeof v.UNSAFE_componentWillMount!="function"&&typeof v.componentWillMount!="function"||(q=v.state,typeof v.componentWillMount=="function"&&v.componentWillMount(),typeof v.UNSAFE_componentWillMount=="function"&&v.UNSAFE_componentWillMount(),q!==v.state&&yc.enqueueReplaceState(v,v.state,null),fl(t,s,v,u),pl(),v.state=t.memoizedState),typeof v.componentDidMount=="function"&&(t.flags|=4194308),s=!0}else if(e===null){v=t.stateNode;var z=t.memoizedProps,J=Lo(r,z);v.props=J;var se=v.context,pe=r.contextType;q=dr,typeof pe=="object"&&pe!==null&&(q=en(pe));var me=r.getDerivedStateFromProps;pe=typeof me=="function"||typeof v.getSnapshotBeforeUpdate=="function",z=t.pendingProps!==z,pe||typeof v.UNSAFE_componentWillReceiveProps!="function"&&typeof v.componentWillReceiveProps!="function"||(z||se!==q)&&Ep(t,v,s,q),Ga=!1;var ie=t.memoizedState;v.state=ie,fl(t,s,v,u),pl(),se=t.memoizedState,z||ie!==se||Ga?(typeof me=="function"&&(mc(t,r,me,s),se=t.memoizedState),(J=Ga||jp(t,r,J,s,ie,se,q))?(pe||typeof v.UNSAFE_componentWillMount!="function"&&typeof v.componentWillMount!="function"||(typeof v.componentWillMount=="function"&&v.componentWillMount(),typeof v.UNSAFE_componentWillMount=="function"&&v.UNSAFE_componentWillMount()),typeof v.componentDidMount=="function"&&(t.flags|=4194308)):(typeof v.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=s,t.memoizedState=se),v.props=s,v.state=se,v.context=q,s=J):(typeof v.componentDidMount=="function"&&(t.flags|=4194308),s=!1)}else{v=t.stateNode,Wi(e,t),q=t.memoizedProps,pe=Lo(r,q),v.props=pe,me=t.pendingProps,ie=v.context,se=r.contextType,J=dr,typeof se=="object"&&se!==null&&(J=en(se)),z=r.getDerivedStateFromProps,(se=typeof z=="function"||typeof v.getSnapshotBeforeUpdate=="function")||typeof v.UNSAFE_componentWillReceiveProps!="function"&&typeof v.componentWillReceiveProps!="function"||(q!==me||ie!==J)&&Ep(t,v,s,J),Ga=!1,ie=t.memoizedState,v.state=ie,fl(t,s,v,u),pl();var de=t.memoizedState;q!==me||ie!==de||Ga||e!==null&&e.dependencies!==null&&hs(e.dependencies)?(typeof z=="function"&&(mc(t,r,z,s),de=t.memoizedState),(pe=Ga||jp(t,r,pe,s,ie,de,J)||e!==null&&e.dependencies!==null&&hs(e.dependencies))?(se||typeof v.UNSAFE_componentWillUpdate!="function"&&typeof v.componentWillUpdate!="function"||(typeof v.componentWillUpdate=="function"&&v.componentWillUpdate(s,de,J),typeof v.UNSAFE_componentWillUpdate=="function"&&v.UNSAFE_componentWillUpdate(s,de,J)),typeof v.componentDidUpdate=="function"&&(t.flags|=4),typeof v.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof v.componentDidUpdate!="function"||q===e.memoizedProps&&ie===e.memoizedState||(t.flags|=4),typeof v.getSnapshotBeforeUpdate!="function"||q===e.memoizedProps&&ie===e.memoizedState||(t.flags|=1024),t.memoizedProps=s,t.memoizedState=de),v.props=s,v.state=de,v.context=J,s=pe):(typeof v.componentDidUpdate!="function"||q===e.memoizedProps&&ie===e.memoizedState||(t.flags|=4),typeof v.getSnapshotBeforeUpdate!="function"||q===e.memoizedProps&&ie===e.memoizedState||(t.flags|=1024),s=!1)}return v=s,Fs(e,t),s=(t.flags&128)!==0,v||s?(v=t.stateNode,r=s&&typeof r.getDerivedStateFromError!="function"?null:v.render(),t.flags|=1,e!==null&&s?(t.child=xr(t,e.child,null,u),t.child=xr(t,null,r,u)):Gt(e,t,r,u),t.memoizedState=v.state,e=t.child):e=Ta(e,t,u),e}function Mp(e,t,r,s){return ol(),t.flags|=256,Gt(e,t,r,s),t.child}var _c={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function xc(e){return{baseLanes:e,cachePool:Nu()}}function wc(e,t,r){return e=e!==null?e.childLanes&~r:0,t&&(e|=In),e}function Hp(e,t,r){var s=t.pendingProps,u=!1,v=(t.flags&128)!==0,q;if((q=v)||(q=e!==null&&e.memoizedState===null?!1:(Pt.current&2)!==0),q&&(u=!0,t.flags&=-129),q=(t.flags&32)!==0,t.flags&=-33,e===null){if(it){if(u?Za(t):Ka(),it){var z=kt,J;if(J=z){e:{for(J=z,z=da;J.nodeType!==8;){if(!z){z=null;break e}if(J=Jn(J.nextSibling),J===null){z=null;break e}}z=J}z!==null?(t.memoizedState={dehydrated:z,treeContext:To!==null?{id:Ea,overflow:ka}:null,retryLane:536870912,hydrationErrors:null},J=wn(18,null,null,0),J.stateNode=z,J.return=t,t.child=J,ln=t,kt=null,J=!0):J=!1}J||$o(t)}if(z=t.memoizedState,z!==null&&(z=z.dehydrated,z!==null))return od(z)?t.lanes=32:t.lanes=536870912,null;Da(t)}return z=s.children,s=s.fallback,u?(Ka(),u=t.mode,z=qs({mode:"hidden",children:z},u),s=Do(s,u,r,null),z.return=t,s.return=t,z.sibling=s,t.child=z,u=t.child,u.memoizedState=xc(r),u.childLanes=wc(e,q,r),t.memoizedState=_c,s):(Za(t),Cc(t,z))}if(J=e.memoizedState,J!==null&&(z=J.dehydrated,z!==null)){if(v)t.flags&256?(Za(t),t.flags&=-257,t=bc(e,t,r)):t.memoizedState!==null?(Ka(),t.child=e.child,t.flags|=128,t=null):(Ka(),u=s.fallback,z=t.mode,s=qs({mode:"visible",children:s.children},z),u=Do(u,z,r,null),u.flags|=2,s.return=t,u.return=t,s.sibling=u,t.child=s,xr(t,e.child,null,r),s=t.child,s.memoizedState=xc(r),s.childLanes=wc(e,q,r),t.memoizedState=_c,t=u);else if(Za(t),od(z)){if(q=z.nextSibling&&z.nextSibling.dataset,q)var se=q.dgst;q=se,s=Error(i(419)),s.stack="",s.digest=q,rl({value:s,source:null,stack:null}),t=bc(e,t,r)}else if(Mt||ll(e,t,r,!1),q=(r&e.childLanes)!==0,Mt||q){if(q=mt,q!==null&&(s=r&-r,s=(s&42)!==0?1:Gn(s),s=(s&(q.suspendedLanes|r))!==0?0:s,s!==0&&s!==J.retryLane))throw J.retryLane=s,cr(e,s),En(q,e,s),Fp;z.data==="$?"||Mc(),t=bc(e,t,r)}else z.data==="$?"?(t.flags|=192,t.child=e.child,t=null):(e=J.treeContext,kt=Jn(z.nextSibling),ln=t,it=!0,qo=null,da=!1,e!==null&&($n[Un++]=Ea,$n[Un++]=ka,$n[Un++]=To,Ea=e.id,ka=e.overflow,To=t),t=Cc(t,s.children),t.flags|=4096);return t}return u?(Ka(),u=s.fallback,z=t.mode,J=e.child,se=J.sibling,s=ja(J,{mode:"hidden",children:s.children}),s.subtreeFlags=J.subtreeFlags&65011712,se!==null?u=ja(se,u):(u=Do(u,z,r,null),u.flags|=2),u.return=t,s.return=t,s.sibling=u,t.child=s,s=u,u=t.child,z=e.child.memoizedState,z===null?z=xc(r):(J=z.cachePool,J!==null?(se=It._currentValue,J=J.parent!==se?{parent:se,pool:se}:J):J=Nu(),z={baseLanes:z.baseLanes|r,cachePool:J}),u.memoizedState=z,u.childLanes=wc(e,q,r),t.memoizedState=_c,s):(Za(t),r=e.child,e=r.sibling,r=ja(r,{mode:"visible",children:s.children}),r.return=t,r.sibling=null,e!==null&&(q=t.deletions,q===null?(t.deletions=[e],t.flags|=16):q.push(e)),t.child=r,t.memoizedState=null,r)}function Cc(e,t){return t=qs({mode:"visible",children:t},e.mode),t.return=e,e.child=t}function qs(e,t){return e=wn(22,e,null,t),e.lanes=0,e.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},e}function bc(e,t,r){return xr(t,e.child,null,r),e=Cc(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function zp(e,t,r){e.lanes|=t;var s=e.alternate;s!==null&&(s.lanes|=t),Mi(e.return,t,r)}function Sc(e,t,r,s,u){var v=e.memoizedState;v===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:s,tail:r,tailMode:u}:(v.isBackwards=t,v.rendering=null,v.renderingStartTime=0,v.last=s,v.tail=r,v.tailMode=u)}function Vp(e,t,r){var s=t.pendingProps,u=s.revealOrder,v=s.tail;if(Gt(e,t,s.children,r),s=Pt.current,(s&2)!==0)s=s&1|2,t.flags|=128;else{if(e!==null&&(e.flags&128)!==0)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&zp(e,r,t);else if(e.tag===19)zp(e,r,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}s&=1}switch(W(Pt,s),u){case"forwards":for(r=t.child,u=null;r!==null;)e=r.alternate,e!==null&&As(e)===null&&(u=r),r=r.sibling;r=u,r===null?(u=t.child,t.child=null):(u=r.sibling,r.sibling=null),Sc(t,!1,u,r,v);break;case"backwards":for(r=null,u=t.child,t.child=null;u!==null;){if(e=u.alternate,e!==null&&As(e)===null){t.child=u;break}e=u.sibling,u.sibling=r,r=u,u=e}Sc(t,!0,r,null,v);break;case"together":Sc(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Ta(e,t,r){if(e!==null&&(t.dependencies=e.dependencies),ao|=t.lanes,(r&t.childLanes)===0)if(e!==null){if(ll(e,t,r,!1),(r&t.childLanes)===0)return null}else return null;if(e!==null&&t.child!==e.child)throw Error(i(153));if(t.child!==null){for(e=t.child,r=ja(e,e.pendingProps),t.child=r,r.return=t;e.sibling!==null;)e=e.sibling,r=r.sibling=ja(e,e.pendingProps),r.return=t;r.sibling=null}return t.child}function jc(e,t){return(e.lanes&t)!==0?!0:(e=e.dependencies,!!(e!==null&&hs(e)))}function lv(e,t,r){switch(t.tag){case 3:te(t,t.stateNode.containerInfo),Ya(t,It,e.memoizedState.cache),ol();break;case 27:case 5:Se(t);break;case 4:te(t,t.stateNode.containerInfo);break;case 10:Ya(t,t.type,t.memoizedProps.value);break;case 13:var s=t.memoizedState;if(s!==null)return s.dehydrated!==null?(Za(t),t.flags|=128,null):(r&t.child.childLanes)!==0?Hp(e,t,r):(Za(t),e=Ta(e,t,r),e!==null?e.sibling:null);Za(t);break;case 19:var u=(e.flags&128)!==0;if(s=(r&t.childLanes)!==0,s||(ll(e,t,r,!1),s=(r&t.childLanes)!==0),u){if(s)return Vp(e,t,r);t.flags|=128}if(u=t.memoizedState,u!==null&&(u.rendering=null,u.tail=null,u.lastEffect=null),W(Pt,Pt.current),s)break;return null;case 22:case 23:return t.lanes=0,Op(e,t,r);case 24:Ya(t,It,e.memoizedState.cache)}return Ta(e,t,r)}function Bp(e,t,r){if(e!==null)if(e.memoizedProps!==t.pendingProps)Mt=!0;else{if(!jc(e,r)&&(t.flags&128)===0)return Mt=!1,lv(e,t,r);Mt=(e.flags&131072)!==0}else Mt=!1,it&&(t.flags&1048576)!==0&&wu(t,fs,t.index);switch(t.lanes=0,t.tag){case 16:e:{e=t.pendingProps;var s=t.elementType,u=s._init;if(s=u(s._payload),t.type=s,typeof s=="function")qi(s)?(e=Lo(s,e),t.tag=1,t=Lp(null,t,s,e,r)):(t.tag=0,t=vc(null,t,s,e,r));else{if(s!=null){if(u=s.$$typeof,u===T){t.tag=11,t=qp(null,t,s,e,r);break e}else if(u===$){t.tag=14,t=$p(null,t,s,e,r);break e}}throw t=P(s)||s,Error(i(306,t,""))}}return t;case 0:return vc(e,t,t.type,t.pendingProps,r);case 1:return s=t.type,u=Lo(s,t.pendingProps),Lp(e,t,s,u,r);case 3:e:{if(te(t,t.stateNode.containerInfo),e===null)throw Error(i(387));s=t.pendingProps;var v=t.memoizedState;u=v.element,Wi(e,t),fl(t,s,null,r);var q=t.memoizedState;if(s=q.cache,Ya(t,It,s),s!==v.cache&&Hi(t,[It],r,!0),pl(),s=q.element,v.isDehydrated)if(v={element:s,isDehydrated:!1,cache:q.cache},t.updateQueue.baseState=v,t.memoizedState=v,t.flags&256){t=Mp(e,t,s,r);break e}else if(s!==u){u=Fn(Error(i(424)),t),rl(u),t=Mp(e,t,s,r);break e}else{switch(e=t.stateNode.containerInfo,e.nodeType){case 9:e=e.body;break;default:e=e.nodeName==="HTML"?e.ownerDocument.body:e}for(kt=Jn(e.firstChild),ln=t,it=!0,qo=null,da=!0,r=bp(t,null,s,r),t.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling}else{if(ol(),s===u){t=Ta(e,t,r);break e}Gt(e,t,s,r)}t=t.child}return t;case 26:return Fs(e,t),e===null?(r=Xf(t.type,null,t.pendingProps,null))?t.memoizedState=r:it||(r=t.type,e=t.pendingProps,s=Ws(Y.current).createElement(r),s[_t]=t,s[Et]=e,Qt(s,r,e),fe(s),t.stateNode=s):t.memoizedState=Xf(t.type,e.memoizedProps,t.pendingProps,e.memoizedState),null;case 27:return Se(t),e===null&&it&&(s=t.stateNode=Gf(t.type,t.pendingProps,Y.current),ln=t,da=!0,u=kt,so(t.type)?(rd=u,kt=Jn(s.firstChild)):kt=u),Gt(e,t,t.pendingProps.children,r),Fs(e,t),e===null&&(t.flags|=4194304),t.child;case 5:return e===null&&it&&((u=s=kt)&&(s=qv(s,t.type,t.pendingProps,da),s!==null?(t.stateNode=s,ln=t,kt=Jn(s.firstChild),da=!1,u=!0):u=!1),u||$o(t)),Se(t),u=t.type,v=t.pendingProps,q=e!==null?e.memoizedProps:null,s=v.children,td(u,v)?s=null:q!==null&&td(u,q)&&(t.flags|=32),t.memoizedState!==null&&(u=ec(e,t,Kg,null,null,r),$l._currentValue=u),Fs(e,t),Gt(e,t,s,r),t.child;case 6:return e===null&&it&&((e=r=kt)&&(r=$v(r,t.pendingProps,da),r!==null?(t.stateNode=r,ln=t,kt=null,e=!0):e=!1),e||$o(t)),null;case 13:return Hp(e,t,r);case 4:return te(t,t.stateNode.containerInfo),s=t.pendingProps,e===null?t.child=xr(t,null,s,r):Gt(e,t,s,r),t.child;case 11:return qp(e,t,t.type,t.pendingProps,r);case 7:return Gt(e,t,t.pendingProps,r),t.child;case 8:return Gt(e,t,t.pendingProps.children,r),t.child;case 12:return Gt(e,t,t.pendingProps.children,r),t.child;case 10:return s=t.pendingProps,Ya(t,t.type,s.value),Gt(e,t,s.children,r),t.child;case 9:return u=t.type._context,s=t.pendingProps.children,Oo(t),u=en(u),s=s(u),t.flags|=1,Gt(e,t,s,r),t.child;case 14:return $p(e,t,t.type,t.pendingProps,r);case 15:return Up(e,t,t.type,t.pendingProps,r);case 19:return Vp(e,t,r);case 31:return s=t.pendingProps,r=t.mode,s={mode:s.mode,children:s.children},e===null?(r=qs(s,r),r.ref=t.ref,t.child=r,r.return=t,t=r):(r=ja(e.child,s),r.ref=t.ref,t.child=r,r.return=t,t=r),t;case 22:return Op(e,t,r);case 24:return Oo(t),s=en(It),e===null?(u=Bi(),u===null&&(u=mt,v=zi(),u.pooledCache=v,v.refCount++,v!==null&&(u.pooledCacheLanes|=r),u=v),t.memoizedState={parent:s,cache:u},Gi(t),Ya(t,It,u)):((e.lanes&r)!==0&&(Wi(e,t),fl(t,null,null,r),pl()),u=e.memoizedState,v=t.memoizedState,u.parent!==s?(u={parent:s,cache:s},t.memoizedState=u,t.lanes===0&&(t.memoizedState=t.updateQueue.baseState=u),Ya(t,It,s)):(s=v.cache,Ya(t,It,s),s!==u.cache&&Hi(t,[It],r,!0))),Gt(e,t,t.pendingProps.children,r),t.child;case 29:throw t.pendingProps}throw Error(i(156,t.tag))}function Fa(e){e.flags|=4}function Yp(e,t){if(t.type!=="stylesheet"||(t.state.loading&4)!==0)e.flags&=-16777217;else if(e.flags|=16777216,!th(t)){if(t=On.current,t!==null&&((ot&4194048)===ot?ua!==null:(ot&62914560)!==ot&&(ot&536870912)===0||t!==ua))throw dl=Yi,Ru;e.flags|=8192}}function $s(e,t){t!==null&&(e.flags|=4),e.flags&16384&&(t=e.tag!==22?aa():536870912,e.lanes|=t,Sr|=t)}function xl(e,t){if(!it)switch(e.tailMode){case"hidden":t=e.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e.tail=null:r.sibling=null;break;case"collapsed":r=e.tail;for(var s=null;r!==null;)r.alternate!==null&&(s=r),r=r.sibling;s===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:s.sibling=null}}function St(e){var t=e.alternate!==null&&e.alternate.child===e.child,r=0,s=0;if(t)for(var u=e.child;u!==null;)r|=u.lanes|u.childLanes,s|=u.subtreeFlags&65011712,s|=u.flags&65011712,u.return=e,u=u.sibling;else for(u=e.child;u!==null;)r|=u.lanes|u.childLanes,s|=u.subtreeFlags,s|=u.flags,u.return=e,u=u.sibling;return e.subtreeFlags|=s,e.childLanes=r,t}function sv(e,t,r){var s=t.pendingProps;switch(Ii(t),t.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return St(t),null;case 1:return St(t),null;case 3:return r=t.stateNode,s=null,e!==null&&(s=e.memoizedState.cache),t.memoizedState.cache!==s&&(t.flags|=2048),Ra(It),ye(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(e===null||e.child===null)&&(al(t)?Fa(t):e===null||e.memoizedState.isDehydrated&&(t.flags&256)===0||(t.flags|=1024,Su())),St(t),null;case 26:return r=t.memoizedState,e===null?(Fa(t),r!==null?(St(t),Yp(t,r)):(St(t),t.flags&=-16777217)):r?r!==e.memoizedState?(Fa(t),St(t),Yp(t,r)):(St(t),t.flags&=-16777217):(e.memoizedProps!==s&&Fa(t),St(t),t.flags&=-16777217),null;case 27:ge(t),r=Y.current;var u=t.type;if(e!==null&&t.stateNode!=null)e.memoizedProps!==s&&Fa(t);else{if(!s){if(t.stateNode===null)throw Error(i(166));return St(t),null}e=U.current,al(t)?Cu(t):(e=Gf(u,s,r),t.stateNode=e,Fa(t))}return St(t),null;case 5:if(ge(t),r=t.type,e!==null&&t.stateNode!=null)e.memoizedProps!==s&&Fa(t);else{if(!s){if(t.stateNode===null)throw Error(i(166));return St(t),null}if(e=U.current,al(t))Cu(t);else{switch(u=Ws(Y.current),e){case 1:e=u.createElementNS("http://www.w3.org/2000/svg",r);break;case 2:e=u.createElementNS("http://www.w3.org/1998/Math/MathML",r);break;default:switch(r){case"svg":e=u.createElementNS("http://www.w3.org/2000/svg",r);break;case"math":e=u.createElementNS("http://www.w3.org/1998/Math/MathML",r);break;case"script":e=u.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild);break;case"select":e=typeof s.is=="string"?u.createElement("select",{is:s.is}):u.createElement("select"),s.multiple?e.multiple=!0:s.size&&(e.size=s.size);break;default:e=typeof s.is=="string"?u.createElement(r,{is:s.is}):u.createElement(r)}}e[_t]=t,e[Et]=s;e:for(u=t.child;u!==null;){if(u.tag===5||u.tag===6)e.appendChild(u.stateNode);else if(u.tag!==4&&u.tag!==27&&u.child!==null){u.child.return=u,u=u.child;continue}if(u===t)break e;for(;u.sibling===null;){if(u.return===null||u.return===t)break e;u=u.return}u.sibling.return=u.return,u=u.sibling}t.stateNode=e;e:switch(Qt(e,r,s),r){case"button":case"input":case"select":case"textarea":e=!!s.autoFocus;break e;case"img":e=!0;break e;default:e=!1}e&&Fa(t)}}return St(t),t.flags&=-16777217,null;case 6:if(e&&t.stateNode!=null)e.memoizedProps!==s&&Fa(t);else{if(typeof s!="string"&&t.stateNode===null)throw Error(i(166));if(e=Y.current,al(t)){if(e=t.stateNode,r=t.memoizedProps,s=null,u=ln,u!==null)switch(u.tag){case 27:case 5:s=u.memoizedProps}e[_t]=t,e=!!(e.nodeValue===r||s!==null&&s.suppressHydrationWarning===!0||Lf(e.nodeValue,r)),e||$o(t)}else e=Ws(e).createTextNode(s),e[_t]=t,t.stateNode=e}return St(t),null;case 13:if(s=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(u=al(t),s!==null&&s.dehydrated!==null){if(e===null){if(!u)throw Error(i(318));if(u=t.memoizedState,u=u!==null?u.dehydrated:null,!u)throw Error(i(317));u[_t]=t}else ol(),(t.flags&128)===0&&(t.memoizedState=null),t.flags|=4;St(t),u=!1}else u=Su(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=u),u=!0;if(!u)return t.flags&256?(Da(t),t):(Da(t),null)}if(Da(t),(t.flags&128)!==0)return t.lanes=r,t;if(r=s!==null,e=e!==null&&e.memoizedState!==null,r){s=t.child,u=null,s.alternate!==null&&s.alternate.memoizedState!==null&&s.alternate.memoizedState.cachePool!==null&&(u=s.alternate.memoizedState.cachePool.pool);var v=null;s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(v=s.memoizedState.cachePool.pool),v!==u&&(s.flags|=2048)}return r!==e&&r&&(t.child.flags|=8192),$s(t,t.updateQueue),St(t),null;case 4:return ye(),e===null&&Xc(t.stateNode.containerInfo),St(t),null;case 10:return Ra(t.type),St(t),null;case 19:if(K(Pt),u=t.memoizedState,u===null)return St(t),null;if(s=(t.flags&128)!==0,v=u.rendering,v===null)if(s)xl(u,!1);else{if(Nt!==0||e!==null&&(e.flags&128)!==0)for(e=t.child;e!==null;){if(v=As(e),v!==null){for(t.flags|=128,xl(u,!1),e=v.updateQueue,t.updateQueue=e,$s(t,e),t.subtreeFlags=0,e=r,r=t.child;r!==null;)xu(r,e),r=r.sibling;return W(Pt,Pt.current&1|2),t.child}e=e.sibling}u.tail!==null&&Ce()>Is&&(t.flags|=128,s=!0,xl(u,!1),t.lanes=4194304)}else{if(!s)if(e=As(v),e!==null){if(t.flags|=128,s=!0,e=e.updateQueue,t.updateQueue=e,$s(t,e),xl(u,!0),u.tail===null&&u.tailMode==="hidden"&&!v.alternate&&!it)return St(t),null}else 2*Ce()-u.renderingStartTime>Is&&r!==536870912&&(t.flags|=128,s=!0,xl(u,!1),t.lanes=4194304);u.isBackwards?(v.sibling=t.child,t.child=v):(e=u.last,e!==null?e.sibling=v:t.child=v,u.last=v)}return u.tail!==null?(t=u.tail,u.rendering=t,u.tail=t.sibling,u.renderingStartTime=Ce(),t.sibling=null,e=Pt.current,W(Pt,s?e&1|2:e&1),t):(St(t),null);case 22:case 23:return Da(t),Ki(),s=t.memoizedState!==null,e!==null?e.memoizedState!==null!==s&&(t.flags|=8192):s&&(t.flags|=8192),s?(r&536870912)!==0&&(t.flags&128)===0&&(St(t),t.subtreeFlags&6&&(t.flags|=8192)):St(t),r=t.updateQueue,r!==null&&$s(t,r.retryQueue),r=null,e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(r=e.memoizedState.cachePool.pool),s=null,t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(s=t.memoizedState.cachePool.pool),s!==r&&(t.flags|=2048),e!==null&&K(Io),null;case 24:return r=null,e!==null&&(r=e.memoizedState.cache),t.memoizedState.cache!==r&&(t.flags|=2048),Ra(It),St(t),null;case 25:return null;case 30:return null}throw Error(i(156,t.tag))}function iv(e,t){switch(Ii(t),t.tag){case 1:return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return Ra(It),ye(),e=t.flags,(e&65536)!==0&&(e&128)===0?(t.flags=e&-65537|128,t):null;case 26:case 27:case 5:return ge(t),null;case 13:if(Da(t),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(i(340));ol()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return K(Pt),null;case 4:return ye(),null;case 10:return Ra(t.type),null;case 22:case 23:return Da(t),Ki(),e!==null&&K(Io),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 24:return Ra(It),null;case 25:return null;default:return null}}function Gp(e,t){switch(Ii(t),t.tag){case 3:Ra(It),ye();break;case 26:case 27:case 5:ge(t);break;case 4:ye();break;case 13:Da(t);break;case 19:K(Pt);break;case 10:Ra(t.type);break;case 22:case 23:Da(t),Ki(),e!==null&&K(Io);break;case 24:Ra(It)}}function wl(e,t){try{var r=t.updateQueue,s=r!==null?r.lastEffect:null;if(s!==null){var u=s.next;r=u;do{if((r.tag&e)===e){s=void 0;var v=r.create,q=r.inst;s=v(),q.destroy=s}r=r.next}while(r!==u)}}catch(z){ht(t,t.return,z)}}function Ja(e,t,r){try{var s=t.updateQueue,u=s!==null?s.lastEffect:null;if(u!==null){var v=u.next;s=v;do{if((s.tag&e)===e){var q=s.inst,z=q.destroy;if(z!==void 0){q.destroy=void 0,u=t;var J=r,se=z;try{se()}catch(pe){ht(u,J,pe)}}}s=s.next}while(s!==v)}}catch(pe){ht(t,t.return,pe)}}function Wp(e){var t=e.updateQueue;if(t!==null){var r=e.stateNode;try{$u(t,r)}catch(s){ht(e,e.return,s)}}}function Qp(e,t,r){r.props=Lo(e.type,e.memoizedProps),r.state=e.memoizedState;try{r.componentWillUnmount()}catch(s){ht(e,t,s)}}function Cl(e,t){try{var r=e.ref;if(r!==null){switch(e.tag){case 26:case 27:case 5:var s=e.stateNode;break;case 30:s=e.stateNode;break;default:s=e.stateNode}typeof r=="function"?e.refCleanup=r(s):r.current=s}}catch(u){ht(e,t,u)}}function pa(e,t){var r=e.ref,s=e.refCleanup;if(r!==null)if(typeof s=="function")try{s()}catch(u){ht(e,t,u)}finally{e.refCleanup=null,e=e.alternate,e!=null&&(e.refCleanup=null)}else if(typeof r=="function")try{r(null)}catch(u){ht(e,t,u)}else r.current=null}function Xp(e){var t=e.type,r=e.memoizedProps,s=e.stateNode;try{e:switch(t){case"button":case"input":case"select":case"textarea":r.autoFocus&&s.focus();break e;case"img":r.src?s.src=r.src:r.srcSet&&(s.srcset=r.srcSet)}}catch(u){ht(e,e.return,u)}}function Ec(e,t,r){try{var s=e.stateNode;Rv(s,e.type,r,t),s[Et]=t}catch(u){ht(e,e.return,u)}}function Zp(e){return e.tag===5||e.tag===3||e.tag===26||e.tag===27&&so(e.type)||e.tag===4}function kc(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||Zp(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.tag===27&&so(e.type)||e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Nc(e,t,r){var s=e.tag;if(s===5||s===6)e=e.stateNode,t?(r.nodeType===9?r.body:r.nodeName==="HTML"?r.ownerDocument.body:r).insertBefore(e,t):(t=r.nodeType===9?r.body:r.nodeName==="HTML"?r.ownerDocument.body:r,t.appendChild(e),r=r._reactRootContainer,r!=null||t.onclick!==null||(t.onclick=Gs));else if(s!==4&&(s===27&&so(e.type)&&(r=e.stateNode,t=null),e=e.child,e!==null))for(Nc(e,t,r),e=e.sibling;e!==null;)Nc(e,t,r),e=e.sibling}function Us(e,t,r){var s=e.tag;if(s===5||s===6)e=e.stateNode,t?r.insertBefore(e,t):r.appendChild(e);else if(s!==4&&(s===27&&so(e.type)&&(r=e.stateNode),e=e.child,e!==null))for(Us(e,t,r),e=e.sibling;e!==null;)Us(e,t,r),e=e.sibling}function Kp(e){var t=e.stateNode,r=e.memoizedProps;try{for(var s=e.type,u=t.attributes;u.length;)t.removeAttributeNode(u[0]);Qt(t,s,r),t[_t]=e,t[Et]=r}catch(v){ht(e,e.return,v)}}var qa=!1,Tt=!1,Rc=!1,Jp=typeof WeakSet=="function"?WeakSet:Set,Ht=null;function cv(e,t){if(e=e.containerInfo,Jc=ei,e=du(e),ki(e)){if("selectionStart"in e)var r={start:e.selectionStart,end:e.selectionEnd};else e:{r=(r=e.ownerDocument)&&r.defaultView||window;var s=r.getSelection&&r.getSelection();if(s&&s.rangeCount!==0){r=s.anchorNode;var u=s.anchorOffset,v=s.focusNode;s=s.focusOffset;try{r.nodeType,v.nodeType}catch{r=null;break e}var q=0,z=-1,J=-1,se=0,pe=0,me=e,ie=null;t:for(;;){for(var de;me!==r||u!==0&&me.nodeType!==3||(z=q+u),me!==v||s!==0&&me.nodeType!==3||(J=q+s),me.nodeType===3&&(q+=me.nodeValue.length),(de=me.firstChild)!==null;)ie=me,me=de;for(;;){if(me===e)break t;if(ie===r&&++se===u&&(z=q),ie===v&&++pe===s&&(J=q),(de=me.nextSibling)!==null)break;me=ie,ie=me.parentNode}me=de}r=z===-1||J===-1?null:{start:z,end:J}}else r=null}r=r||{start:0,end:0}}else r=null;for(ed={focusedElem:e,selectionRange:r},ei=!1,Ht=t;Ht!==null;)if(t=Ht,e=t.child,(t.subtreeFlags&1024)!==0&&e!==null)e.return=t,Ht=e;else for(;Ht!==null;){switch(t=Ht,v=t.alternate,e=t.flags,t.tag){case 0:break;case 11:case 15:break;case 1:if((e&1024)!==0&&v!==null){e=void 0,r=t,u=v.memoizedProps,v=v.memoizedState,s=r.stateNode;try{var Pe=Lo(r.type,u,r.elementType===r.type);e=s.getSnapshotBeforeUpdate(Pe,v),s.__reactInternalSnapshotBeforeUpdate=e}catch(Ue){ht(r,r.return,Ue)}}break;case 3:if((e&1024)!==0){if(e=t.stateNode.containerInfo,r=e.nodeType,r===9)ad(e);else if(r===1)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":ad(e);break;default:e.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((e&1024)!==0)throw Error(i(163))}if(e=t.sibling,e!==null){e.return=t.return,Ht=e;break}Ht=t.return}}function ef(e,t,r){var s=r.flags;switch(r.tag){case 0:case 11:case 15:eo(e,r),s&4&&wl(5,r);break;case 1:if(eo(e,r),s&4)if(e=r.stateNode,t===null)try{e.componentDidMount()}catch(q){ht(r,r.return,q)}else{var u=Lo(r.type,t.memoizedProps);t=t.memoizedState;try{e.componentDidUpdate(u,t,e.__reactInternalSnapshotBeforeUpdate)}catch(q){ht(r,r.return,q)}}s&64&&Wp(r),s&512&&Cl(r,r.return);break;case 3:if(eo(e,r),s&64&&(e=r.updateQueue,e!==null)){if(t=null,r.child!==null)switch(r.child.tag){case 27:case 5:t=r.child.stateNode;break;case 1:t=r.child.stateNode}try{$u(e,t)}catch(q){ht(r,r.return,q)}}break;case 27:t===null&&s&4&&Kp(r);case 26:case 5:eo(e,r),t===null&&s&4&&Xp(r),s&512&&Cl(r,r.return);break;case 12:eo(e,r);break;case 13:eo(e,r),s&4&&af(e,r),s&64&&(e=r.memoizedState,e!==null&&(e=e.dehydrated,e!==null&&(r=vv.bind(null,r),Uv(e,r))));break;case 22:if(s=r.memoizedState!==null||qa,!s){t=t!==null&&t.memoizedState!==null||Tt,u=qa;var v=Tt;qa=s,(Tt=t)&&!v?to(e,r,(r.subtreeFlags&8772)!==0):eo(e,r),qa=u,Tt=v}break;case 30:break;default:eo(e,r)}}function tf(e){var t=e.alternate;t!==null&&(e.alternate=null,tf(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&Je(t)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var wt=null,hn=!1;function $a(e,t,r){for(r=r.child;r!==null;)nf(e,t,r),r=r.sibling}function nf(e,t,r){if(Rt&&typeof Rt.onCommitFiberUnmount=="function")try{Rt.onCommitFiberUnmount(sn,r)}catch{}switch(r.tag){case 26:Tt||pa(r,t),$a(e,t,r),r.memoizedState?r.memoizedState.count--:r.stateNode&&(r=r.stateNode,r.parentNode.removeChild(r));break;case 27:Tt||pa(r,t);var s=wt,u=hn;so(r.type)&&(wt=r.stateNode,hn=!1),$a(e,t,r),Dl(r.stateNode),wt=s,hn=u;break;case 5:Tt||pa(r,t);case 6:if(s=wt,u=hn,wt=null,$a(e,t,r),wt=s,hn=u,wt!==null)if(hn)try{(wt.nodeType===9?wt.body:wt.nodeName==="HTML"?wt.ownerDocument.body:wt).removeChild(r.stateNode)}catch(v){ht(r,t,v)}else try{wt.removeChild(r.stateNode)}catch(v){ht(r,t,v)}break;case 18:wt!==null&&(hn?(e=wt,Bf(e.nodeType===9?e.body:e.nodeName==="HTML"?e.ownerDocument.body:e,r.stateNode),Pl(e)):Bf(wt,r.stateNode));break;case 4:s=wt,u=hn,wt=r.stateNode.containerInfo,hn=!0,$a(e,t,r),wt=s,hn=u;break;case 0:case 11:case 14:case 15:Tt||Ja(2,r,t),Tt||Ja(4,r,t),$a(e,t,r);break;case 1:Tt||(pa(r,t),s=r.stateNode,typeof s.componentWillUnmount=="function"&&Qp(r,t,s)),$a(e,t,r);break;case 21:$a(e,t,r);break;case 22:Tt=(s=Tt)||r.memoizedState!==null,$a(e,t,r),Tt=s;break;default:$a(e,t,r)}}function af(e,t){if(t.memoizedState===null&&(e=t.alternate,e!==null&&(e=e.memoizedState,e!==null&&(e=e.dehydrated,e!==null))))try{Pl(e)}catch(r){ht(t,t.return,r)}}function dv(e){switch(e.tag){case 13:case 19:var t=e.stateNode;return t===null&&(t=e.stateNode=new Jp),t;case 22:return e=e.stateNode,t=e._retryCache,t===null&&(t=e._retryCache=new Jp),t;default:throw Error(i(435,e.tag))}}function Ac(e,t){var r=dv(e);t.forEach(function(s){var u=_v.bind(null,e,s);r.has(s)||(r.add(s),s.then(u,u))})}function Cn(e,t){var r=t.deletions;if(r!==null)for(var s=0;s<r.length;s++){var u=r[s],v=e,q=t,z=q;e:for(;z!==null;){switch(z.tag){case 27:if(so(z.type)){wt=z.stateNode,hn=!1;break e}break;case 5:wt=z.stateNode,hn=!1;break e;case 3:case 4:wt=z.stateNode.containerInfo,hn=!0;break e}z=z.return}if(wt===null)throw Error(i(160));nf(v,q,u),wt=null,hn=!1,v=u.alternate,v!==null&&(v.return=null),u.return=null}if(t.subtreeFlags&13878)for(t=t.child;t!==null;)of(t,e),t=t.sibling}var Kn=null;function of(e,t){var r=e.alternate,s=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:Cn(t,e),bn(e),s&4&&(Ja(3,e,e.return),wl(3,e),Ja(5,e,e.return));break;case 1:Cn(t,e),bn(e),s&512&&(Tt||r===null||pa(r,r.return)),s&64&&qa&&(e=e.updateQueue,e!==null&&(s=e.callbacks,s!==null&&(r=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=r===null?s:r.concat(s))));break;case 26:var u=Kn;if(Cn(t,e),bn(e),s&512&&(Tt||r===null||pa(r,r.return)),s&4){var v=r!==null?r.memoizedState:null;if(s=e.memoizedState,r===null)if(s===null)if(e.stateNode===null){e:{s=e.type,r=e.memoizedProps,u=u.ownerDocument||u;t:switch(s){case"title":v=u.getElementsByTagName("title")[0],(!v||v[Me]||v[_t]||v.namespaceURI==="http://www.w3.org/2000/svg"||v.hasAttribute("itemprop"))&&(v=u.createElement(s),u.head.insertBefore(v,u.querySelector("head > title"))),Qt(v,s,r),v[_t]=e,fe(v),s=v;break e;case"link":var q=Jf("link","href",u).get(s+(r.href||""));if(q){for(var z=0;z<q.length;z++)if(v=q[z],v.getAttribute("href")===(r.href==null||r.href===""?null:r.href)&&v.getAttribute("rel")===(r.rel==null?null:r.rel)&&v.getAttribute("title")===(r.title==null?null:r.title)&&v.getAttribute("crossorigin")===(r.crossOrigin==null?null:r.crossOrigin)){q.splice(z,1);break t}}v=u.createElement(s),Qt(v,s,r),u.head.appendChild(v);break;case"meta":if(q=Jf("meta","content",u).get(s+(r.content||""))){for(z=0;z<q.length;z++)if(v=q[z],v.getAttribute("content")===(r.content==null?null:""+r.content)&&v.getAttribute("name")===(r.name==null?null:r.name)&&v.getAttribute("property")===(r.property==null?null:r.property)&&v.getAttribute("http-equiv")===(r.httpEquiv==null?null:r.httpEquiv)&&v.getAttribute("charset")===(r.charSet==null?null:r.charSet)){q.splice(z,1);break t}}v=u.createElement(s),Qt(v,s,r),u.head.appendChild(v);break;default:throw Error(i(468,s))}v[_t]=e,fe(v),s=v}e.stateNode=s}else eh(u,e.type,e.stateNode);else e.stateNode=Kf(u,s,e.memoizedProps);else v!==s?(v===null?r.stateNode!==null&&(r=r.stateNode,r.parentNode.removeChild(r)):v.count--,s===null?eh(u,e.type,e.stateNode):Kf(u,s,e.memoizedProps)):s===null&&e.stateNode!==null&&Ec(e,e.memoizedProps,r.memoizedProps)}break;case 27:Cn(t,e),bn(e),s&512&&(Tt||r===null||pa(r,r.return)),r!==null&&s&4&&Ec(e,e.memoizedProps,r.memoizedProps);break;case 5:if(Cn(t,e),bn(e),s&512&&(Tt||r===null||pa(r,r.return)),e.flags&32){u=e.stateNode;try{wa(u,"")}catch(de){ht(e,e.return,de)}}s&4&&e.stateNode!=null&&(u=e.memoizedProps,Ec(e,u,r!==null?r.memoizedProps:u)),s&1024&&(Rc=!0);break;case 6:if(Cn(t,e),bn(e),s&4){if(e.stateNode===null)throw Error(i(162));s=e.memoizedProps,r=e.stateNode;try{r.nodeValue=s}catch(de){ht(e,e.return,de)}}break;case 3:if(Zs=null,u=Kn,Kn=Qs(t.containerInfo),Cn(t,e),Kn=u,bn(e),s&4&&r!==null&&r.memoizedState.isDehydrated)try{Pl(t.containerInfo)}catch(de){ht(e,e.return,de)}Rc&&(Rc=!1,rf(e));break;case 4:s=Kn,Kn=Qs(e.stateNode.containerInfo),Cn(t,e),bn(e),Kn=s;break;case 12:Cn(t,e),bn(e);break;case 13:Cn(t,e),bn(e),e.child.flags&8192&&e.memoizedState!==null!=(r!==null&&r.memoizedState!==null)&&(Uc=Ce()),s&4&&(s=e.updateQueue,s!==null&&(e.updateQueue=null,Ac(e,s)));break;case 22:u=e.memoizedState!==null;var J=r!==null&&r.memoizedState!==null,se=qa,pe=Tt;if(qa=se||u,Tt=pe||J,Cn(t,e),Tt=pe,qa=se,bn(e),s&8192)e:for(t=e.stateNode,t._visibility=u?t._visibility&-2:t._visibility|1,u&&(r===null||J||qa||Tt||Mo(e)),r=null,t=e;;){if(t.tag===5||t.tag===26){if(r===null){J=r=t;try{if(v=J.stateNode,u)q=v.style,typeof q.setProperty=="function"?q.setProperty("display","none","important"):q.display="none";else{z=J.stateNode;var me=J.memoizedProps.style,ie=me!=null&&me.hasOwnProperty("display")?me.display:null;z.style.display=ie==null||typeof ie=="boolean"?"":(""+ie).trim()}}catch(de){ht(J,J.return,de)}}}else if(t.tag===6){if(r===null){J=t;try{J.stateNode.nodeValue=u?"":J.memoizedProps}catch(de){ht(J,J.return,de)}}}else if((t.tag!==22&&t.tag!==23||t.memoizedState===null||t===e)&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;r===t&&(r=null),t=t.return}r===t&&(r=null),t.sibling.return=t.return,t=t.sibling}s&4&&(s=e.updateQueue,s!==null&&(r=s.retryQueue,r!==null&&(s.retryQueue=null,Ac(e,r))));break;case 19:Cn(t,e),bn(e),s&4&&(s=e.updateQueue,s!==null&&(e.updateQueue=null,Ac(e,s)));break;case 30:break;case 21:break;default:Cn(t,e),bn(e)}}function bn(e){var t=e.flags;if(t&2){try{for(var r,s=e.return;s!==null;){if(Zp(s)){r=s;break}s=s.return}if(r==null)throw Error(i(160));switch(r.tag){case 27:var u=r.stateNode,v=kc(e);Us(e,v,u);break;case 5:var q=r.stateNode;r.flags&32&&(wa(q,""),r.flags&=-33);var z=kc(e);Us(e,z,q);break;case 3:case 4:var J=r.stateNode.containerInfo,se=kc(e);Nc(e,se,J);break;default:throw Error(i(161))}}catch(pe){ht(e,e.return,pe)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function rf(e){if(e.subtreeFlags&1024)for(e=e.child;e!==null;){var t=e;rf(t),t.tag===5&&t.flags&1024&&t.stateNode.reset(),e=e.sibling}}function eo(e,t){if(t.subtreeFlags&8772)for(t=t.child;t!==null;)ef(e,t.alternate,t),t=t.sibling}function Mo(e){for(e=e.child;e!==null;){var t=e;switch(t.tag){case 0:case 11:case 14:case 15:Ja(4,t,t.return),Mo(t);break;case 1:pa(t,t.return);var r=t.stateNode;typeof r.componentWillUnmount=="function"&&Qp(t,t.return,r),Mo(t);break;case 27:Dl(t.stateNode);case 26:case 5:pa(t,t.return),Mo(t);break;case 22:t.memoizedState===null&&Mo(t);break;case 30:Mo(t);break;default:Mo(t)}e=e.sibling}}function to(e,t,r){for(r=r&&(t.subtreeFlags&8772)!==0,t=t.child;t!==null;){var s=t.alternate,u=e,v=t,q=v.flags;switch(v.tag){case 0:case 11:case 15:to(u,v,r),wl(4,v);break;case 1:if(to(u,v,r),s=v,u=s.stateNode,typeof u.componentDidMount=="function")try{u.componentDidMount()}catch(se){ht(s,s.return,se)}if(s=v,u=s.updateQueue,u!==null){var z=s.stateNode;try{var J=u.shared.hiddenCallbacks;if(J!==null)for(u.shared.hiddenCallbacks=null,u=0;u<J.length;u++)qu(J[u],z)}catch(se){ht(s,s.return,se)}}r&&q&64&&Wp(v),Cl(v,v.return);break;case 27:Kp(v);case 26:case 5:to(u,v,r),r&&s===null&&q&4&&Xp(v),Cl(v,v.return);break;case 12:to(u,v,r);break;case 13:to(u,v,r),r&&q&4&&af(u,v);break;case 22:v.memoizedState===null&&to(u,v,r),Cl(v,v.return);break;case 30:break;default:to(u,v,r)}t=t.sibling}}function Dc(e,t){var r=null;e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(r=e.memoizedState.cachePool.pool),e=null,t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(e=t.memoizedState.cachePool.pool),e!==r&&(e!=null&&e.refCount++,r!=null&&sl(r))}function Tc(e,t){e=null,t.alternate!==null&&(e=t.alternate.memoizedState.cache),t=t.memoizedState.cache,t!==e&&(t.refCount++,e!=null&&sl(e))}function fa(e,t,r,s){if(t.subtreeFlags&10256)for(t=t.child;t!==null;)lf(e,t,r,s),t=t.sibling}function lf(e,t,r,s){var u=t.flags;switch(t.tag){case 0:case 11:case 15:fa(e,t,r,s),u&2048&&wl(9,t);break;case 1:fa(e,t,r,s);break;case 3:fa(e,t,r,s),u&2048&&(e=null,t.alternate!==null&&(e=t.alternate.memoizedState.cache),t=t.memoizedState.cache,t!==e&&(t.refCount++,e!=null&&sl(e)));break;case 12:if(u&2048){fa(e,t,r,s),e=t.stateNode;try{var v=t.memoizedProps,q=v.id,z=v.onPostCommit;typeof z=="function"&&z(q,t.alternate===null?"mount":"update",e.passiveEffectDuration,-0)}catch(J){ht(t,t.return,J)}}else fa(e,t,r,s);break;case 13:fa(e,t,r,s);break;case 23:break;case 22:v=t.stateNode,q=t.alternate,t.memoizedState!==null?v._visibility&2?fa(e,t,r,s):bl(e,t):v._visibility&2?fa(e,t,r,s):(v._visibility|=2,wr(e,t,r,s,(t.subtreeFlags&10256)!==0)),u&2048&&Dc(q,t);break;case 24:fa(e,t,r,s),u&2048&&Tc(t.alternate,t);break;default:fa(e,t,r,s)}}function wr(e,t,r,s,u){for(u=u&&(t.subtreeFlags&10256)!==0,t=t.child;t!==null;){var v=e,q=t,z=r,J=s,se=q.flags;switch(q.tag){case 0:case 11:case 15:wr(v,q,z,J,u),wl(8,q);break;case 23:break;case 22:var pe=q.stateNode;q.memoizedState!==null?pe._visibility&2?wr(v,q,z,J,u):bl(v,q):(pe._visibility|=2,wr(v,q,z,J,u)),u&&se&2048&&Dc(q.alternate,q);break;case 24:wr(v,q,z,J,u),u&&se&2048&&Tc(q.alternate,q);break;default:wr(v,q,z,J,u)}t=t.sibling}}function bl(e,t){if(t.subtreeFlags&10256)for(t=t.child;t!==null;){var r=e,s=t,u=s.flags;switch(s.tag){case 22:bl(r,s),u&2048&&Dc(s.alternate,s);break;case 24:bl(r,s),u&2048&&Tc(s.alternate,s);break;default:bl(r,s)}t=t.sibling}}var Sl=8192;function Cr(e){if(e.subtreeFlags&Sl)for(e=e.child;e!==null;)sf(e),e=e.sibling}function sf(e){switch(e.tag){case 26:Cr(e),e.flags&Sl&&e.memoizedState!==null&&Qv(Kn,e.memoizedState,e.memoizedProps);break;case 5:Cr(e);break;case 3:case 4:var t=Kn;Kn=Qs(e.stateNode.containerInfo),Cr(e),Kn=t;break;case 22:e.memoizedState===null&&(t=e.alternate,t!==null&&t.memoizedState!==null?(t=Sl,Sl=16777216,Cr(e),Sl=t):Cr(e));break;default:Cr(e)}}function cf(e){var t=e.alternate;if(t!==null&&(e=t.child,e!==null)){t.child=null;do t=e.sibling,e.sibling=null,e=t;while(e!==null)}}function jl(e){var t=e.deletions;if((e.flags&16)!==0){if(t!==null)for(var r=0;r<t.length;r++){var s=t[r];Ht=s,uf(s,e)}cf(e)}if(e.subtreeFlags&10256)for(e=e.child;e!==null;)df(e),e=e.sibling}function df(e){switch(e.tag){case 0:case 11:case 15:jl(e),e.flags&2048&&Ja(9,e,e.return);break;case 3:jl(e);break;case 12:jl(e);break;case 22:var t=e.stateNode;e.memoizedState!==null&&t._visibility&2&&(e.return===null||e.return.tag!==13)?(t._visibility&=-3,Os(e)):jl(e);break;default:jl(e)}}function Os(e){var t=e.deletions;if((e.flags&16)!==0){if(t!==null)for(var r=0;r<t.length;r++){var s=t[r];Ht=s,uf(s,e)}cf(e)}for(e=e.child;e!==null;){switch(t=e,t.tag){case 0:case 11:case 15:Ja(8,t,t.return),Os(t);break;case 22:r=t.stateNode,r._visibility&2&&(r._visibility&=-3,Os(t));break;default:Os(t)}e=e.sibling}}function uf(e,t){for(;Ht!==null;){var r=Ht;switch(r.tag){case 0:case 11:case 15:Ja(8,r,t);break;case 23:case 22:if(r.memoizedState!==null&&r.memoizedState.cachePool!==null){var s=r.memoizedState.cachePool.pool;s!=null&&s.refCount++}break;case 24:sl(r.memoizedState.cache)}if(s=r.child,s!==null)s.return=r,Ht=s;else e:for(r=e;Ht!==null;){s=Ht;var u=s.sibling,v=s.return;if(tf(s),s===r){Ht=null;break e}if(u!==null){u.return=v,Ht=u;break e}Ht=v}}}var uv={getCacheForType:function(e){var t=en(It),r=t.data.get(e);return r===void 0&&(r=e(),t.data.set(e,r)),r}},pv=typeof WeakMap=="function"?WeakMap:Map,ct=0,mt=null,et=null,ot=0,dt=0,Sn=null,no=!1,br=!1,Fc=!1,Ua=0,Nt=0,ao=0,Ho=0,qc=0,In=0,Sr=0,El=null,mn=null,$c=!1,Uc=0,Is=1/0,Ps=null,oo=null,Wt=0,ro=null,jr=null,Er=0,Oc=0,Ic=null,pf=null,kl=0,Pc=null;function jn(){if((ct&2)!==0&&ot!==0)return ot&-ot;if(R.T!==null){var e=fr;return e!==0?e:Yc()}return la()}function ff(){In===0&&(In=(ot&536870912)===0||it?na():536870912);var e=On.current;return e!==null&&(e.flags|=32),In}function En(e,t,r){(e===mt&&(dt===2||dt===9)||e.cancelPendingCommit!==null)&&(kr(e,0),lo(e,ot,In,!1)),dn(e,r),((ct&2)===0||e!==mt)&&(e===mt&&((ct&2)===0&&(Ho|=r),Nt===4&&lo(e,ot,In,!1)),ha(e))}function hf(e,t,r){if((ct&6)!==0)throw Error(i(327));var s=!r&&(t&124)===0&&(t&e.expiredLanes)===0||_n(e,t),u=s?mv(e,t):Hc(e,t,!0),v=s;do{if(u===0){br&&!s&&lo(e,t,0,!1);break}else{if(r=e.current.alternate,v&&!fv(r)){u=Hc(e,t,!1),v=!1;continue}if(u===2){if(v=t,e.errorRecoveryDisabledLanes&v)var q=0;else q=e.pendingLanes&-536870913,q=q!==0?q:q&536870912?536870912:0;if(q!==0){t=q;e:{var z=e;u=El;var J=z.current.memoizedState.isDehydrated;if(J&&(kr(z,q).flags|=256),q=Hc(z,q,!1),q!==2){if(Fc&&!J){z.errorRecoveryDisabledLanes|=v,Ho|=v,u=4;break e}v=mn,mn=u,v!==null&&(mn===null?mn=v:mn.push.apply(mn,v))}u=q}if(v=!1,u!==2)continue}}if(u===1){kr(e,0),lo(e,t,0,!0);break}e:{switch(s=e,v=u,v){case 0:case 1:throw Error(i(345));case 4:if((t&4194048)!==t)break;case 6:lo(s,t,In,!no);break e;case 2:mn=null;break;case 3:case 5:break;default:throw Error(i(329))}if((t&62914560)===t&&(u=Uc+300-Ce(),10<u)){if(lo(s,t,In,!no),Kt(s,0,!0)!==0)break e;s.timeoutHandle=zf(mf.bind(null,s,r,mn,Ps,$c,t,In,Ho,Sr,no,v,2,-0,0),u);break e}mf(s,r,mn,Ps,$c,t,In,Ho,Sr,no,v,0,-0,0)}}break}while(!0);ha(e)}function mf(e,t,r,s,u,v,q,z,J,se,pe,me,ie,de){if(e.timeoutHandle=-1,me=t.subtreeFlags,(me&8192||(me&16785408)===16785408)&&(ql={stylesheets:null,count:0,unsuspend:Wv},sf(t),me=Xv(),me!==null)){e.cancelPendingCommit=me(Cf.bind(null,e,t,v,r,s,u,q,z,J,pe,1,ie,de)),lo(e,v,q,!se);return}Cf(e,t,v,r,s,u,q,z,J)}function fv(e){for(var t=e;;){var r=t.tag;if((r===0||r===11||r===15)&&t.flags&16384&&(r=t.updateQueue,r!==null&&(r=r.stores,r!==null)))for(var s=0;s<r.length;s++){var u=r[s],v=u.getSnapshot;u=u.value;try{if(!xn(v(),u))return!1}catch{return!1}}if(r=t.child,t.subtreeFlags&16384&&r!==null)r.return=t,t=r;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function lo(e,t,r,s){t&=~qc,t&=~Ho,e.suspendedLanes|=t,e.pingedLanes&=~t,s&&(e.warmLanes|=t),s=e.expirationTimes;for(var u=t;0<u;){var v=31-bt(u),q=1<<v;s[v]=-1,u&=~q}r!==0&&oa(e,r,t)}function Ls(){return(ct&6)===0?(Nl(0),!1):!0}function Lc(){if(et!==null){if(dt===0)var e=et.return;else e=et,Na=Uo=null,ac(e),_r=null,vl=0,e=et;for(;e!==null;)Gp(e.alternate,e),e=e.return;et=null}}function kr(e,t){var r=e.timeoutHandle;r!==-1&&(e.timeoutHandle=-1,Dv(r)),r=e.cancelPendingCommit,r!==null&&(e.cancelPendingCommit=null,r()),Lc(),mt=e,et=r=ja(e.current,null),ot=t,dt=0,Sn=null,no=!1,br=_n(e,t),Fc=!1,Sr=In=qc=Ho=ao=Nt=0,mn=El=null,$c=!1,(t&8)!==0&&(t|=t&32);var s=e.entangledLanes;if(s!==0)for(e=e.entanglements,s&=t;0<s;){var u=31-bt(s),v=1<<u;t|=e[u],s&=~v}return Ua=t,is(),r}function yf(e,t){We=null,R.H=ks,t===cl||t===gs?(t=Tu(),dt=3):t===Ru?(t=Tu(),dt=4):dt=t===Fp?8:t!==null&&typeof t=="object"&&typeof t.then=="function"?6:1,Sn=t,et===null&&(Nt=1,Ts(e,Fn(t,e.current)))}function gf(){var e=R.H;return R.H=ks,e===null?ks:e}function vf(){var e=R.A;return R.A=uv,e}function Mc(){Nt=4,no||(ot&4194048)!==ot&&On.current!==null||(br=!0),(ao&134217727)===0&&(Ho&134217727)===0||mt===null||lo(mt,ot,In,!1)}function Hc(e,t,r){var s=ct;ct|=2;var u=gf(),v=vf();(mt!==e||ot!==t)&&(Ps=null,kr(e,t)),t=!1;var q=Nt;e:do try{if(dt!==0&&et!==null){var z=et,J=Sn;switch(dt){case 8:Lc(),q=6;break e;case 3:case 2:case 9:case 6:On.current===null&&(t=!0);var se=dt;if(dt=0,Sn=null,Nr(e,z,J,se),r&&br){q=0;break e}break;default:se=dt,dt=0,Sn=null,Nr(e,z,J,se)}}hv(),q=Nt;break}catch(pe){yf(e,pe)}while(!0);return t&&e.shellSuspendCounter++,Na=Uo=null,ct=s,R.H=u,R.A=v,et===null&&(mt=null,ot=0,is()),q}function hv(){for(;et!==null;)_f(et)}function mv(e,t){var r=ct;ct|=2;var s=gf(),u=vf();mt!==e||ot!==t?(Ps=null,Is=Ce()+500,kr(e,t)):br=_n(e,t);e:do try{if(dt!==0&&et!==null){t=et;var v=Sn;t:switch(dt){case 1:dt=0,Sn=null,Nr(e,t,v,1);break;case 2:case 9:if(Au(v)){dt=0,Sn=null,xf(t);break}t=function(){dt!==2&&dt!==9||mt!==e||(dt=7),ha(e)},v.then(t,t);break e;case 3:dt=7;break e;case 4:dt=5;break e;case 7:Au(v)?(dt=0,Sn=null,xf(t)):(dt=0,Sn=null,Nr(e,t,v,7));break;case 5:var q=null;switch(et.tag){case 26:q=et.memoizedState;case 5:case 27:var z=et;if(!q||th(q)){dt=0,Sn=null;var J=z.sibling;if(J!==null)et=J;else{var se=z.return;se!==null?(et=se,Ms(se)):et=null}break t}}dt=0,Sn=null,Nr(e,t,v,5);break;case 6:dt=0,Sn=null,Nr(e,t,v,6);break;case 8:Lc(),Nt=6;break e;default:throw Error(i(462))}}yv();break}catch(pe){yf(e,pe)}while(!0);return Na=Uo=null,R.H=s,R.A=u,ct=r,et!==null?0:(mt=null,ot=0,is(),Nt)}function yv(){for(;et!==null&&!nt();)_f(et)}function _f(e){var t=Bp(e.alternate,e,Ua);e.memoizedProps=e.pendingProps,t===null?Ms(e):et=t}function xf(e){var t=e,r=t.alternate;switch(t.tag){case 15:case 0:t=Pp(r,t,t.pendingProps,t.type,void 0,ot);break;case 11:t=Pp(r,t,t.pendingProps,t.type.render,t.ref,ot);break;case 5:ac(t);default:Gp(r,t),t=et=xu(t,Ua),t=Bp(r,t,Ua)}e.memoizedProps=e.pendingProps,t===null?Ms(e):et=t}function Nr(e,t,r,s){Na=Uo=null,ac(t),_r=null,vl=0;var u=t.return;try{if(rv(e,u,t,r,ot)){Nt=1,Ts(e,Fn(r,e.current)),et=null;return}}catch(v){if(u!==null)throw et=u,v;Nt=1,Ts(e,Fn(r,e.current)),et=null;return}t.flags&32768?(it||s===1?e=!0:br||(ot&536870912)!==0?e=!1:(no=e=!0,(s===2||s===9||s===3||s===6)&&(s=On.current,s!==null&&s.tag===13&&(s.flags|=16384))),wf(t,e)):Ms(t)}function Ms(e){var t=e;do{if((t.flags&32768)!==0){wf(t,no);return}e=t.return;var r=sv(t.alternate,t,Ua);if(r!==null){et=r;return}if(t=t.sibling,t!==null){et=t;return}et=t=e}while(t!==null);Nt===0&&(Nt=5)}function wf(e,t){do{var r=iv(e.alternate,e);if(r!==null){r.flags&=32767,et=r;return}if(r=e.return,r!==null&&(r.flags|=32768,r.subtreeFlags=0,r.deletions=null),!t&&(e=e.sibling,e!==null)){et=e;return}et=e=r}while(e!==null);Nt=6,et=null}function Cf(e,t,r,s,u,v,q,z,J){e.cancelPendingCommit=null;do Hs();while(Wt!==0);if((ct&6)!==0)throw Error(i(327));if(t!==null){if(t===e.current)throw Error(i(177));if(v=t.lanes|t.childLanes,v|=Ti,Yn(e,r,v,q,z,J),e===mt&&(et=mt=null,ot=0),jr=t,ro=e,Er=r,Oc=v,Ic=u,pf=s,(t.subtreeFlags&10256)!==0||(t.flags&10256)!==0?(e.callbackNode=null,e.callbackPriority=0,xv(Ye,function(){return kf(),null})):(e.callbackNode=null,e.callbackPriority=0),s=(t.flags&13878)!==0,(t.subtreeFlags&13878)!==0||s){s=R.T,R.T=null,u=O.p,O.p=2,q=ct,ct|=4;try{cv(e,t,r)}finally{ct=q,O.p=u,R.T=s}}Wt=1,bf(),Sf(),jf()}}function bf(){if(Wt===1){Wt=0;var e=ro,t=jr,r=(t.flags&13878)!==0;if((t.subtreeFlags&13878)!==0||r){r=R.T,R.T=null;var s=O.p;O.p=2;var u=ct;ct|=4;try{of(t,e);var v=ed,q=du(e.containerInfo),z=v.focusedElem,J=v.selectionRange;if(q!==z&&z&&z.ownerDocument&&cu(z.ownerDocument.documentElement,z)){if(J!==null&&ki(z)){var se=J.start,pe=J.end;if(pe===void 0&&(pe=se),"selectionStart"in z)z.selectionStart=se,z.selectionEnd=Math.min(pe,z.value.length);else{var me=z.ownerDocument||document,ie=me&&me.defaultView||window;if(ie.getSelection){var de=ie.getSelection(),Pe=z.textContent.length,Ue=Math.min(J.start,Pe),ft=J.end===void 0?Ue:Math.min(J.end,Pe);!de.extend&&Ue>ft&&(q=ft,ft=Ue,Ue=q);var oe=iu(z,Ue),ne=iu(z,ft);if(oe&&ne&&(de.rangeCount!==1||de.anchorNode!==oe.node||de.anchorOffset!==oe.offset||de.focusNode!==ne.node||de.focusOffset!==ne.offset)){var le=me.createRange();le.setStart(oe.node,oe.offset),de.removeAllRanges(),Ue>ft?(de.addRange(le),de.extend(ne.node,ne.offset)):(le.setEnd(ne.node,ne.offset),de.addRange(le))}}}}for(me=[],de=z;de=de.parentNode;)de.nodeType===1&&me.push({element:de,left:de.scrollLeft,top:de.scrollTop});for(typeof z.focus=="function"&&z.focus(),z=0;z<me.length;z++){var he=me[z];he.element.scrollLeft=he.left,he.element.scrollTop=he.top}}ei=!!Jc,ed=Jc=null}finally{ct=u,O.p=s,R.T=r}}e.current=t,Wt=2}}function Sf(){if(Wt===2){Wt=0;var e=ro,t=jr,r=(t.flags&8772)!==0;if((t.subtreeFlags&8772)!==0||r){r=R.T,R.T=null;var s=O.p;O.p=2;var u=ct;ct|=4;try{ef(e,t.alternate,t)}finally{ct=u,O.p=s,R.T=r}}Wt=3}}function jf(){if(Wt===4||Wt===3){Wt=0,we();var e=ro,t=jr,r=Er,s=pf;(t.subtreeFlags&10256)!==0||(t.flags&10256)!==0?Wt=5:(Wt=0,jr=ro=null,Ef(e,e.pendingLanes));var u=e.pendingLanes;if(u===0&&(oo=null),Wn(r),t=t.stateNode,Rt&&typeof Rt.onCommitFiberRoot=="function")try{Rt.onCommitFiberRoot(sn,t,void 0,(t.current.flags&128)===128)}catch{}if(s!==null){t=R.T,u=O.p,O.p=2,R.T=null;try{for(var v=e.onRecoverableError,q=0;q<s.length;q++){var z=s[q];v(z.value,{componentStack:z.stack})}}finally{R.T=t,O.p=u}}(Er&3)!==0&&Hs(),ha(e),u=e.pendingLanes,(r&4194090)!==0&&(u&42)!==0?e===Pc?kl++:(kl=0,Pc=e):kl=0,Nl(0)}}function Ef(e,t){(e.pooledCacheLanes&=t)===0&&(t=e.pooledCache,t!=null&&(e.pooledCache=null,sl(t)))}function Hs(e){return bf(),Sf(),jf(),kf()}function kf(){if(Wt!==5)return!1;var e=ro,t=Oc;Oc=0;var r=Wn(Er),s=R.T,u=O.p;try{O.p=32>r?32:r,R.T=null,r=Ic,Ic=null;var v=ro,q=Er;if(Wt=0,jr=ro=null,Er=0,(ct&6)!==0)throw Error(i(331));var z=ct;if(ct|=4,df(v.current),lf(v,v.current,q,r),ct=z,Nl(0,!1),Rt&&typeof Rt.onPostCommitFiberRoot=="function")try{Rt.onPostCommitFiberRoot(sn,v)}catch{}return!0}finally{O.p=u,R.T=s,Ef(e,t)}}function Nf(e,t,r){t=Fn(r,t),t=gc(e.stateNode,t,2),e=Qa(e,t,2),e!==null&&(dn(e,2),ha(e))}function ht(e,t,r){if(e.tag===3)Nf(e,e,r);else for(;t!==null;){if(t.tag===3){Nf(t,e,r);break}else if(t.tag===1){var s=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof s.componentDidCatch=="function"&&(oo===null||!oo.has(s))){e=Fn(r,e),r=Dp(2),s=Qa(t,r,2),s!==null&&(Tp(r,s,t,e),dn(s,2),ha(s));break}}t=t.return}}function zc(e,t,r){var s=e.pingCache;if(s===null){s=e.pingCache=new pv;var u=new Set;s.set(t,u)}else u=s.get(t),u===void 0&&(u=new Set,s.set(t,u));u.has(r)||(Fc=!0,u.add(r),e=gv.bind(null,e,t,r),t.then(e,e))}function gv(e,t,r){var s=e.pingCache;s!==null&&s.delete(t),e.pingedLanes|=e.suspendedLanes&r,e.warmLanes&=~r,mt===e&&(ot&r)===r&&(Nt===4||Nt===3&&(ot&62914560)===ot&&300>Ce()-Uc?(ct&2)===0&&kr(e,0):qc|=r,Sr===ot&&(Sr=0)),ha(e)}function Rf(e,t){t===0&&(t=aa()),e=cr(e,t),e!==null&&(dn(e,t),ha(e))}function vv(e){var t=e.memoizedState,r=0;t!==null&&(r=t.retryLane),Rf(e,r)}function _v(e,t){var r=0;switch(e.tag){case 13:var s=e.stateNode,u=e.memoizedState;u!==null&&(r=u.retryLane);break;case 19:s=e.stateNode;break;case 22:s=e.stateNode._retryCache;break;default:throw Error(i(314))}s!==null&&s.delete(t),Rf(e,r)}function xv(e,t){return Le(e,t)}var zs=null,Rr=null,Vc=!1,Vs=!1,Bc=!1,zo=0;function ha(e){e!==Rr&&e.next===null&&(Rr===null?zs=Rr=e:Rr=Rr.next=e),Vs=!0,Vc||(Vc=!0,Cv())}function Nl(e,t){if(!Bc&&Vs){Bc=!0;do for(var r=!1,s=zs;s!==null;){if(e!==0){var u=s.pendingLanes;if(u===0)var v=0;else{var q=s.suspendedLanes,z=s.pingedLanes;v=(1<<31-bt(42|e)+1)-1,v&=u&~(q&~z),v=v&201326741?v&201326741|1:v?v|2:0}v!==0&&(r=!0,Ff(s,v))}else v=ot,v=Kt(s,s===mt?v:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),(v&3)===0||_n(s,v)||(r=!0,Ff(s,v));s=s.next}while(r);Bc=!1}}function wv(){Af()}function Af(){Vs=Vc=!1;var e=0;zo!==0&&(Av()&&(e=zo),zo=0);for(var t=Ce(),r=null,s=zs;s!==null;){var u=s.next,v=Df(s,t);v===0?(s.next=null,r===null?zs=u:r.next=u,u===null&&(Rr=r)):(r=s,(e!==0||(v&3)!==0)&&(Vs=!0)),s=u}Nl(e)}function Df(e,t){for(var r=e.suspendedLanes,s=e.pingedLanes,u=e.expirationTimes,v=e.pendingLanes&-62914561;0<v;){var q=31-bt(v),z=1<<q,J=u[q];J===-1?((z&r)===0||(z&s)!==0)&&(u[q]=va(z,t)):J<=t&&(e.expiredLanes|=z),v&=~z}if(t=mt,r=ot,r=Kt(e,e===t?r:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),s=e.callbackNode,r===0||e===t&&(dt===2||dt===9)||e.cancelPendingCommit!==null)return s!==null&&s!==null&&Xe(s),e.callbackNode=null,e.callbackPriority=0;if((r&3)===0||_n(e,r)){if(t=r&-r,t===e.callbackPriority)return t;switch(s!==null&&Xe(s),Wn(r)){case 2:case 8:r=gt;break;case 32:r=Ye;break;case 268435456:r=Zt;break;default:r=Ye}return s=Tf.bind(null,e),r=Le(r,s),e.callbackPriority=t,e.callbackNode=r,t}return s!==null&&s!==null&&Xe(s),e.callbackPriority=2,e.callbackNode=null,2}function Tf(e,t){if(Wt!==0&&Wt!==5)return e.callbackNode=null,e.callbackPriority=0,null;var r=e.callbackNode;if(Hs()&&e.callbackNode!==r)return null;var s=ot;return s=Kt(e,e===mt?s:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),s===0?null:(hf(e,s,t),Df(e,Ce()),e.callbackNode!=null&&e.callbackNode===r?Tf.bind(null,e):null)}function Ff(e,t){if(Hs())return null;hf(e,t,!0)}function Cv(){Tv(function(){(ct&6)!==0?Le(He,wv):Af()})}function Yc(){return zo===0&&(zo=na()),zo}function qf(e){return e==null||typeof e=="symbol"||typeof e=="boolean"?null:typeof e=="function"?e:Eo(""+e)}function $f(e,t){var r=t.ownerDocument.createElement("input");return r.name=t.name,r.value=t.value,e.id&&r.setAttribute("form",e.id),t.parentNode.insertBefore(r,t),e=new FormData(e),r.parentNode.removeChild(r),e}function bv(e,t,r,s,u){if(t==="submit"&&r&&r.stateNode===u){var v=qf((u[Et]||null).action),q=s.submitter;q&&(t=(t=q[Et]||null)?qf(t.formAction):q.getAttribute("formAction"),t!==null&&(v=t,q=null));var z=new rs("action","action",null,s,u);e.push({event:z,listeners:[{instance:null,listener:function(){if(s.defaultPrevented){if(zo!==0){var J=q?$f(u,q):new FormData(u);pc(r,{pending:!0,data:J,method:u.method,action:v},null,J)}}else typeof v=="function"&&(z.preventDefault(),J=q?$f(u,q):new FormData(u),pc(r,{pending:!0,data:J,method:u.method,action:v},v,J))},currentTarget:u}]})}}for(var Gc=0;Gc<Di.length;Gc++){var Wc=Di[Gc],Sv=Wc.toLowerCase(),jv=Wc[0].toUpperCase()+Wc.slice(1);Zn(Sv,"on"+jv)}Zn(fu,"onAnimationEnd"),Zn(hu,"onAnimationIteration"),Zn(mu,"onAnimationStart"),Zn("dblclick","onDoubleClick"),Zn("focusin","onFocus"),Zn("focusout","onBlur"),Zn(Hg,"onTransitionRun"),Zn(zg,"onTransitionStart"),Zn(Vg,"onTransitionCancel"),Zn(yu,"onTransitionEnd"),xt("onMouseEnter",["mouseout","mouseover"]),xt("onMouseLeave",["mouseout","mouseover"]),xt("onPointerEnter",["pointerout","pointerover"]),xt("onPointerLeave",["pointerout","pointerover"]),Ge("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Ge("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Ge("onBeforeInput",["compositionend","keypress","textInput","paste"]),Ge("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Ge("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Ge("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Rl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Ev=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Rl));function Uf(e,t){t=(t&4)!==0;for(var r=0;r<e.length;r++){var s=e[r],u=s.event;s=s.listeners;e:{var v=void 0;if(t)for(var q=s.length-1;0<=q;q--){var z=s[q],J=z.instance,se=z.currentTarget;if(z=z.listener,J!==v&&u.isPropagationStopped())break e;v=z,u.currentTarget=se;try{v(u)}catch(pe){Ds(pe)}u.currentTarget=null,v=J}else for(q=0;q<s.length;q++){if(z=s[q],J=z.instance,se=z.currentTarget,z=z.listener,J!==v&&u.isPropagationStopped())break e;v=z,u.currentTarget=se;try{v(u)}catch(pe){Ds(pe)}u.currentTarget=null,v=J}}}}function tt(e,t){var r=t[be];r===void 0&&(r=t[be]=new Set);var s=e+"__bubble";r.has(s)||(Of(t,e,2,!1),r.add(s))}function Qc(e,t,r){var s=0;t&&(s|=4),Of(r,e,s,t)}var Bs="_reactListening"+Math.random().toString(36).slice(2);function Xc(e){if(!e[Bs]){e[Bs]=!0,_e.forEach(function(r){r!=="selectionchange"&&(Ev.has(r)||Qc(r,!1,e),Qc(r,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[Bs]||(t[Bs]=!0,Qc("selectionchange",!1,t))}}function Of(e,t,r,s){switch(sh(t)){case 2:var u=Jv;break;case 8:u=e_;break;default:u=dd}r=u.bind(null,t,r,e),u=void 0,!Va||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(u=!0),s?u!==void 0?e.addEventListener(t,r,{capture:!0,passive:u}):e.addEventListener(t,r,!0):u!==void 0?e.addEventListener(t,r,{passive:u}):e.addEventListener(t,r,!1)}function Zc(e,t,r,s,u){var v=s;if((t&1)===0&&(t&2)===0&&s!==null)e:for(;;){if(s===null)return;var q=s.tag;if(q===3||q===4){var z=s.stateNode.containerInfo;if(z===u)break;if(q===4)for(q=s.return;q!==null;){var J=q.tag;if((J===3||J===4)&&q.stateNode.containerInfo===u)return;q=q.return}for(;z!==null;){if(q=ze(z),q===null)return;if(J=q.tag,J===5||J===6||J===26||J===27){s=v=q;continue e}z=z.parentNode}}s=s.return}ko(function(){var se=v,pe=nr(r),me=[];e:{var ie=gu.get(e);if(ie!==void 0){var de=rs,Pe=e;switch(e){case"keypress":if(as(r)===0)break e;case"keydown":case"keyup":de=xg;break;case"focusin":Pe="focus",de=Ci;break;case"focusout":Pe="blur",de=Ci;break;case"beforeblur":case"afterblur":de=Ci;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":de=Yd;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":de=ig;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":de=bg;break;case fu:case hu:case mu:de=ug;break;case yu:de=jg;break;case"scroll":case"scrollend":de=lg;break;case"wheel":de=kg;break;case"copy":case"cut":case"paste":de=fg;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":de=Wd;break;case"toggle":case"beforetoggle":de=Rg}var Ue=(t&4)!==0,ft=!Ue&&(e==="scroll"||e==="scrollend"),oe=Ue?ie!==null?ie+"Capture":null:ie;Ue=[];for(var ne=se,le;ne!==null;){var he=ne;if(le=he.stateNode,he=he.tag,he!==5&&he!==26&&he!==27||le===null||oe===null||(he=Ee(ne,oe),he!=null&&Ue.push(Al(ne,he,le))),ft)break;ne=ne.return}0<Ue.length&&(ie=new de(ie,Pe,null,r,pe),me.push({event:ie,listeners:Ue}))}}if((t&7)===0){e:{if(ie=e==="mouseover"||e==="pointerover",de=e==="mouseout"||e==="pointerout",ie&&r!==tr&&(Pe=r.relatedTarget||r.fromElement)&&(ze(Pe)||Pe[ue]))break e;if((de||ie)&&(ie=pe.window===pe?pe:(ie=pe.ownerDocument)?ie.defaultView||ie.parentWindow:window,de?(Pe=r.relatedTarget||r.toElement,de=se,Pe=Pe?ze(Pe):null,Pe!==null&&(ft=d(Pe),Ue=Pe.tag,Pe!==ft||Ue!==5&&Ue!==27&&Ue!==6)&&(Pe=null)):(de=null,Pe=se),de!==Pe)){if(Ue=Yd,he="onMouseLeave",oe="onMouseEnter",ne="mouse",(e==="pointerout"||e==="pointerover")&&(Ue=Wd,he="onPointerLeave",oe="onPointerEnter",ne="pointer"),ft=de==null?ie:at(de),le=Pe==null?ie:at(Pe),ie=new Ue(he,ne+"leave",de,r,pe),ie.target=ft,ie.relatedTarget=le,he=null,ze(pe)===se&&(Ue=new Ue(oe,ne+"enter",Pe,r,pe),Ue.target=le,Ue.relatedTarget=ft,he=Ue),ft=he,de&&Pe)t:{for(Ue=de,oe=Pe,ne=0,le=Ue;le;le=Ar(le))ne++;for(le=0,he=oe;he;he=Ar(he))le++;for(;0<ne-le;)Ue=Ar(Ue),ne--;for(;0<le-ne;)oe=Ar(oe),le--;for(;ne--;){if(Ue===oe||oe!==null&&Ue===oe.alternate)break t;Ue=Ar(Ue),oe=Ar(oe)}Ue=null}else Ue=null;de!==null&&If(me,ie,de,Ue,!1),Pe!==null&&ft!==null&&If(me,ft,Pe,Ue,!0)}}e:{if(ie=se?at(se):window,de=ie.nodeName&&ie.nodeName.toLowerCase(),de==="select"||de==="input"&&ie.type==="file")var Re=nu;else if(eu(ie))if(au)Re=Pg;else{Re=Og;var Ze=Ug}else de=ie.nodeName,!de||de.toLowerCase()!=="input"||ie.type!=="checkbox"&&ie.type!=="radio"?se&&er(se.elementType)&&(Re=nu):Re=Ig;if(Re&&(Re=Re(e,se))){tu(me,Re,r,pe);break e}Ze&&Ze(e,ie,se),e==="focusout"&&se&&ie.type==="number"&&se.memoizedProps.value!=null&&Jo(ie,"number",ie.value)}switch(Ze=se?at(se):window,e){case"focusin":(eu(Ze)||Ze.contentEditable==="true")&&(lr=Ze,Ni=se,nl=null);break;case"focusout":nl=Ni=lr=null;break;case"mousedown":Ri=!0;break;case"contextmenu":case"mouseup":case"dragend":Ri=!1,uu(me,r,pe);break;case"selectionchange":if(Mg)break;case"keydown":case"keyup":uu(me,r,pe)}var De;if(Si)e:{switch(e){case"compositionstart":var Oe="onCompositionStart";break e;case"compositionend":Oe="onCompositionEnd";break e;case"compositionupdate":Oe="onCompositionUpdate";break e}Oe=void 0}else rr?Kd(e,r)&&(Oe="onCompositionEnd"):e==="keydown"&&r.keyCode===229&&(Oe="onCompositionStart");Oe&&(Qd&&r.locale!=="ko"&&(rr||Oe!=="onCompositionStart"?Oe==="onCompositionEnd"&&rr&&(De=Vd()):(Sa=pe,or="value"in Sa?Sa.value:Sa.textContent,rr=!0)),Ze=Ys(se,Oe),0<Ze.length&&(Oe=new Gd(Oe,e,null,r,pe),me.push({event:Oe,listeners:Ze}),De?Oe.data=De:(De=Jd(r),De!==null&&(Oe.data=De)))),(De=Dg?Tg(e,r):Fg(e,r))&&(Oe=Ys(se,"onBeforeInput"),0<Oe.length&&(Ze=new Gd("onBeforeInput","beforeinput",null,r,pe),me.push({event:Ze,listeners:Oe}),Ze.data=De)),bv(me,e,se,r,pe)}Uf(me,t)})}function Al(e,t,r){return{instance:e,listener:t,currentTarget:r}}function Ys(e,t){for(var r=t+"Capture",s=[];e!==null;){var u=e,v=u.stateNode;if(u=u.tag,u!==5&&u!==26&&u!==27||v===null||(u=Ee(e,r),u!=null&&s.unshift(Al(e,u,v)),u=Ee(e,t),u!=null&&s.push(Al(e,u,v))),e.tag===3)return s;e=e.return}return[]}function Ar(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5&&e.tag!==27);return e||null}function If(e,t,r,s,u){for(var v=t._reactName,q=[];r!==null&&r!==s;){var z=r,J=z.alternate,se=z.stateNode;if(z=z.tag,J!==null&&J===s)break;z!==5&&z!==26&&z!==27||se===null||(J=se,u?(se=Ee(r,v),se!=null&&q.unshift(Al(r,se,J))):u||(se=Ee(r,v),se!=null&&q.push(Al(r,se,J)))),r=r.return}q.length!==0&&e.push({event:t,listeners:q})}var kv=/\r\n?/g,Nv=/\u0000|\uFFFD/g;function Pf(e){return(typeof e=="string"?e:""+e).replace(kv,`
`).replace(Nv,"")}function Lf(e,t){return t=Pf(t),Pf(e)===t}function Gs(){}function pt(e,t,r,s,u,v){switch(r){case"children":typeof s=="string"?t==="body"||t==="textarea"&&s===""||wa(e,s):(typeof s=="number"||typeof s=="bigint")&&t!=="body"&&wa(e,""+s);break;case"className":on(e,"class",s);break;case"tabIndex":on(e,"tabindex",s);break;case"dir":case"role":case"viewBox":case"width":case"height":on(e,r,s);break;case"style":Wr(e,s,v);break;case"data":if(t!=="object"){on(e,"data",s);break}case"src":case"href":if(s===""&&(t!=="a"||r!=="href")){e.removeAttribute(r);break}if(s==null||typeof s=="function"||typeof s=="symbol"||typeof s=="boolean"){e.removeAttribute(r);break}s=Eo(""+s),e.setAttribute(r,s);break;case"action":case"formAction":if(typeof s=="function"){e.setAttribute(r,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof v=="function"&&(r==="formAction"?(t!=="input"&&pt(e,t,"name",u.name,u,null),pt(e,t,"formEncType",u.formEncType,u,null),pt(e,t,"formMethod",u.formMethod,u,null),pt(e,t,"formTarget",u.formTarget,u,null)):(pt(e,t,"encType",u.encType,u,null),pt(e,t,"method",u.method,u,null),pt(e,t,"target",u.target,u,null)));if(s==null||typeof s=="symbol"||typeof s=="boolean"){e.removeAttribute(r);break}s=Eo(""+s),e.setAttribute(r,s);break;case"onClick":s!=null&&(e.onclick=Gs);break;case"onScroll":s!=null&&tt("scroll",e);break;case"onScrollEnd":s!=null&&tt("scrollend",e);break;case"dangerouslySetInnerHTML":if(s!=null){if(typeof s!="object"||!("__html"in s))throw Error(i(61));if(r=s.__html,r!=null){if(u.children!=null)throw Error(i(60));e.innerHTML=r}}break;case"multiple":e.multiple=s&&typeof s!="function"&&typeof s!="symbol";break;case"muted":e.muted=s&&typeof s!="function"&&typeof s!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(s==null||typeof s=="function"||typeof s=="boolean"||typeof s=="symbol"){e.removeAttribute("xlink:href");break}r=Eo(""+s),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",r);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":s!=null&&typeof s!="function"&&typeof s!="symbol"?e.setAttribute(r,""+s):e.removeAttribute(r);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":s&&typeof s!="function"&&typeof s!="symbol"?e.setAttribute(r,""):e.removeAttribute(r);break;case"capture":case"download":s===!0?e.setAttribute(r,""):s!==!1&&s!=null&&typeof s!="function"&&typeof s!="symbol"?e.setAttribute(r,s):e.removeAttribute(r);break;case"cols":case"rows":case"size":case"span":s!=null&&typeof s!="function"&&typeof s!="symbol"&&!isNaN(s)&&1<=s?e.setAttribute(r,s):e.removeAttribute(r);break;case"rowSpan":case"start":s==null||typeof s=="function"||typeof s=="symbol"||isNaN(s)?e.removeAttribute(r):e.setAttribute(r,s);break;case"popover":tt("beforetoggle",e),tt("toggle",e),Tn(e,"popover",s);break;case"xlinkActuate":un(e,"http://www.w3.org/1999/xlink","xlink:actuate",s);break;case"xlinkArcrole":un(e,"http://www.w3.org/1999/xlink","xlink:arcrole",s);break;case"xlinkRole":un(e,"http://www.w3.org/1999/xlink","xlink:role",s);break;case"xlinkShow":un(e,"http://www.w3.org/1999/xlink","xlink:show",s);break;case"xlinkTitle":un(e,"http://www.w3.org/1999/xlink","xlink:title",s);break;case"xlinkType":un(e,"http://www.w3.org/1999/xlink","xlink:type",s);break;case"xmlBase":un(e,"http://www.w3.org/XML/1998/namespace","xml:base",s);break;case"xmlLang":un(e,"http://www.w3.org/XML/1998/namespace","xml:lang",s);break;case"xmlSpace":un(e,"http://www.w3.org/XML/1998/namespace","xml:space",s);break;case"is":Tn(e,"is",s);break;case"innerText":case"textContent":break;default:(!(2<r.length)||r[0]!=="o"&&r[0]!=="O"||r[1]!=="n"&&r[1]!=="N")&&(r=es.get(r)||r,Tn(e,r,s))}}function Kc(e,t,r,s,u,v){switch(r){case"style":Wr(e,s,v);break;case"dangerouslySetInnerHTML":if(s!=null){if(typeof s!="object"||!("__html"in s))throw Error(i(61));if(r=s.__html,r!=null){if(u.children!=null)throw Error(i(60));e.innerHTML=r}}break;case"children":typeof s=="string"?wa(e,s):(typeof s=="number"||typeof s=="bigint")&&wa(e,""+s);break;case"onScroll":s!=null&&tt("scroll",e);break;case"onScrollEnd":s!=null&&tt("scrollend",e);break;case"onClick":s!=null&&(e.onclick=Gs);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!je.hasOwnProperty(r))e:{if(r[0]==="o"&&r[1]==="n"&&(u=r.endsWith("Capture"),t=r.slice(2,u?r.length-7:void 0),v=e[Et]||null,v=v!=null?v[r]:null,typeof v=="function"&&e.removeEventListener(t,v,u),typeof s=="function")){typeof v!="function"&&v!==null&&(r in e?e[r]=null:e.hasAttribute(r)&&e.removeAttribute(r)),e.addEventListener(t,s,u);break e}r in e?e[r]=s:s===!0?e.setAttribute(r,""):Tn(e,r,s)}}}function Qt(e,t,r){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":tt("error",e),tt("load",e);var s=!1,u=!1,v;for(v in r)if(r.hasOwnProperty(v)){var q=r[v];if(q!=null)switch(v){case"src":s=!0;break;case"srcSet":u=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(i(137,t));default:pt(e,t,v,q,r,null)}}u&&pt(e,t,"srcSet",r.srcSet,r,null),s&&pt(e,t,"src",r.src,r,null);return;case"input":tt("invalid",e);var z=v=q=u=null,J=null,se=null;for(s in r)if(r.hasOwnProperty(s)){var pe=r[s];if(pe!=null)switch(s){case"name":u=pe;break;case"type":q=pe;break;case"checked":J=pe;break;case"defaultChecked":se=pe;break;case"value":v=pe;break;case"defaultValue":z=pe;break;case"children":case"dangerouslySetInnerHTML":if(pe!=null)throw Error(i(137,t));break;default:pt(e,t,s,pe,r,null)}}Vr(e,v,z,J,se,q,u,!1),za(e);return;case"select":tt("invalid",e),s=q=v=null;for(u in r)if(r.hasOwnProperty(u)&&(z=r[u],z!=null))switch(u){case"value":v=z;break;case"defaultValue":q=z;break;case"multiple":s=z;default:pt(e,t,u,z,r,null)}t=v,r=q,e.multiple=!!s,t!=null?xa(e,!!s,t,!1):r!=null&&xa(e,!!s,r,!0);return;case"textarea":tt("invalid",e),v=u=s=null;for(q in r)if(r.hasOwnProperty(q)&&(z=r[q],z!=null))switch(q){case"value":s=z;break;case"defaultValue":u=z;break;case"children":v=z;break;case"dangerouslySetInnerHTML":if(z!=null)throw Error(i(91));break;default:pt(e,t,q,z,r,null)}Yr(e,s,u,v),za(e);return;case"option":for(J in r)if(r.hasOwnProperty(J)&&(s=r[J],s!=null))switch(J){case"selected":e.selected=s&&typeof s!="function"&&typeof s!="symbol";break;default:pt(e,t,J,s,r,null)}return;case"dialog":tt("beforetoggle",e),tt("toggle",e),tt("cancel",e),tt("close",e);break;case"iframe":case"object":tt("load",e);break;case"video":case"audio":for(s=0;s<Rl.length;s++)tt(Rl[s],e);break;case"image":tt("error",e),tt("load",e);break;case"details":tt("toggle",e);break;case"embed":case"source":case"link":tt("error",e),tt("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(se in r)if(r.hasOwnProperty(se)&&(s=r[se],s!=null))switch(se){case"children":case"dangerouslySetInnerHTML":throw Error(i(137,t));default:pt(e,t,se,s,r,null)}return;default:if(er(t)){for(pe in r)r.hasOwnProperty(pe)&&(s=r[pe],s!==void 0&&Kc(e,t,pe,s,r,void 0));return}}for(z in r)r.hasOwnProperty(z)&&(s=r[z],s!=null&&pt(e,t,z,s,r,null))}function Rv(e,t,r,s){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var u=null,v=null,q=null,z=null,J=null,se=null,pe=null;for(de in r){var me=r[de];if(r.hasOwnProperty(de)&&me!=null)switch(de){case"checked":break;case"value":break;case"defaultValue":J=me;default:s.hasOwnProperty(de)||pt(e,t,de,null,s,me)}}for(var ie in s){var de=s[ie];if(me=r[ie],s.hasOwnProperty(ie)&&(de!=null||me!=null))switch(ie){case"type":v=de;break;case"name":u=de;break;case"checked":se=de;break;case"defaultChecked":pe=de;break;case"value":q=de;break;case"defaultValue":z=de;break;case"children":case"dangerouslySetInnerHTML":if(de!=null)throw Error(i(137,t));break;default:de!==me&&pt(e,t,ie,de,s,me)}}Ko(e,q,z,J,se,pe,v,u);return;case"select":de=q=z=ie=null;for(v in r)if(J=r[v],r.hasOwnProperty(v)&&J!=null)switch(v){case"value":break;case"multiple":de=J;default:s.hasOwnProperty(v)||pt(e,t,v,null,s,J)}for(u in s)if(v=s[u],J=r[u],s.hasOwnProperty(u)&&(v!=null||J!=null))switch(u){case"value":ie=v;break;case"defaultValue":z=v;break;case"multiple":q=v;default:v!==J&&pt(e,t,u,v,s,J)}t=z,r=q,s=de,ie!=null?xa(e,!!r,ie,!1):!!s!=!!r&&(t!=null?xa(e,!!r,t,!0):xa(e,!!r,r?[]:"",!1));return;case"textarea":de=ie=null;for(z in r)if(u=r[z],r.hasOwnProperty(z)&&u!=null&&!s.hasOwnProperty(z))switch(z){case"value":break;case"children":break;default:pt(e,t,z,null,s,u)}for(q in s)if(u=s[q],v=r[q],s.hasOwnProperty(q)&&(u!=null||v!=null))switch(q){case"value":ie=u;break;case"defaultValue":de=u;break;case"children":break;case"dangerouslySetInnerHTML":if(u!=null)throw Error(i(91));break;default:u!==v&&pt(e,t,q,u,s,v)}Br(e,ie,de);return;case"option":for(var Pe in r)if(ie=r[Pe],r.hasOwnProperty(Pe)&&ie!=null&&!s.hasOwnProperty(Pe))switch(Pe){case"selected":e.selected=!1;break;default:pt(e,t,Pe,null,s,ie)}for(J in s)if(ie=s[J],de=r[J],s.hasOwnProperty(J)&&ie!==de&&(ie!=null||de!=null))switch(J){case"selected":e.selected=ie&&typeof ie!="function"&&typeof ie!="symbol";break;default:pt(e,t,J,ie,s,de)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Ue in r)ie=r[Ue],r.hasOwnProperty(Ue)&&ie!=null&&!s.hasOwnProperty(Ue)&&pt(e,t,Ue,null,s,ie);for(se in s)if(ie=s[se],de=r[se],s.hasOwnProperty(se)&&ie!==de&&(ie!=null||de!=null))switch(se){case"children":case"dangerouslySetInnerHTML":if(ie!=null)throw Error(i(137,t));break;default:pt(e,t,se,ie,s,de)}return;default:if(er(t)){for(var ft in r)ie=r[ft],r.hasOwnProperty(ft)&&ie!==void 0&&!s.hasOwnProperty(ft)&&Kc(e,t,ft,void 0,s,ie);for(pe in s)ie=s[pe],de=r[pe],!s.hasOwnProperty(pe)||ie===de||ie===void 0&&de===void 0||Kc(e,t,pe,ie,s,de);return}}for(var oe in r)ie=r[oe],r.hasOwnProperty(oe)&&ie!=null&&!s.hasOwnProperty(oe)&&pt(e,t,oe,null,s,ie);for(me in s)ie=s[me],de=r[me],!s.hasOwnProperty(me)||ie===de||ie==null&&de==null||pt(e,t,me,ie,s,de)}var Jc=null,ed=null;function Ws(e){return e.nodeType===9?e:e.ownerDocument}function Mf(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Hf(e,t){if(e===0)switch(t){case"svg":return 1;case"math":return 2;default:return 0}return e===1&&t==="foreignObject"?0:e}function td(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.children=="bigint"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var nd=null;function Av(){var e=window.event;return e&&e.type==="popstate"?e===nd?!1:(nd=e,!0):(nd=null,!1)}var zf=typeof setTimeout=="function"?setTimeout:void 0,Dv=typeof clearTimeout=="function"?clearTimeout:void 0,Vf=typeof Promise=="function"?Promise:void 0,Tv=typeof queueMicrotask=="function"?queueMicrotask:typeof Vf<"u"?function(e){return Vf.resolve(null).then(e).catch(Fv)}:zf;function Fv(e){setTimeout(function(){throw e})}function so(e){return e==="head"}function Bf(e,t){var r=t,s=0,u=0;do{var v=r.nextSibling;if(e.removeChild(r),v&&v.nodeType===8)if(r=v.data,r==="/$"){if(0<s&&8>s){r=s;var q=e.ownerDocument;if(r&1&&Dl(q.documentElement),r&2&&Dl(q.body),r&4)for(r=q.head,Dl(r),q=r.firstChild;q;){var z=q.nextSibling,J=q.nodeName;q[Me]||J==="SCRIPT"||J==="STYLE"||J==="LINK"&&q.rel.toLowerCase()==="stylesheet"||r.removeChild(q),q=z}}if(u===0){e.removeChild(v),Pl(t);return}u--}else r==="$"||r==="$?"||r==="$!"?u++:s=r.charCodeAt(0)-48;else s=0;r=v}while(r);Pl(t)}function ad(e){var t=e.firstChild;for(t&&t.nodeType===10&&(t=t.nextSibling);t;){var r=t;switch(t=t.nextSibling,r.nodeName){case"HTML":case"HEAD":case"BODY":ad(r),Je(r);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(r.rel.toLowerCase()==="stylesheet")continue}e.removeChild(r)}}function qv(e,t,r,s){for(;e.nodeType===1;){var u=r;if(e.nodeName.toLowerCase()!==t.toLowerCase()){if(!s&&(e.nodeName!=="INPUT"||e.type!=="hidden"))break}else if(s){if(!e[Me])switch(t){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if(v=e.getAttribute("rel"),v==="stylesheet"&&e.hasAttribute("data-precedence"))break;if(v!==u.rel||e.getAttribute("href")!==(u.href==null||u.href===""?null:u.href)||e.getAttribute("crossorigin")!==(u.crossOrigin==null?null:u.crossOrigin)||e.getAttribute("title")!==(u.title==null?null:u.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(v=e.getAttribute("src"),(v!==(u.src==null?null:u.src)||e.getAttribute("type")!==(u.type==null?null:u.type)||e.getAttribute("crossorigin")!==(u.crossOrigin==null?null:u.crossOrigin))&&v&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else if(t==="input"&&e.type==="hidden"){var v=u.name==null?null:""+u.name;if(u.type==="hidden"&&e.getAttribute("name")===v)return e}else return e;if(e=Jn(e.nextSibling),e===null)break}return null}function $v(e,t,r){if(t==="")return null;for(;e.nodeType!==3;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!r||(e=Jn(e.nextSibling),e===null))return null;return e}function od(e){return e.data==="$!"||e.data==="$?"&&e.ownerDocument.readyState==="complete"}function Uv(e,t){var r=e.ownerDocument;if(e.data!=="$?"||r.readyState==="complete")t();else{var s=function(){t(),r.removeEventListener("DOMContentLoaded",s)};r.addEventListener("DOMContentLoaded",s),e._reactRetry=s}}function Jn(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?"||t==="F!"||t==="F")break;if(t==="/$")return null}}return e}var rd=null;function Yf(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="$"||r==="$!"||r==="$?"){if(t===0)return e;t--}else r==="/$"&&t++}e=e.previousSibling}return null}function Gf(e,t,r){switch(t=Ws(r),e){case"html":if(e=t.documentElement,!e)throw Error(i(452));return e;case"head":if(e=t.head,!e)throw Error(i(453));return e;case"body":if(e=t.body,!e)throw Error(i(454));return e;default:throw Error(i(451))}}function Dl(e){for(var t=e.attributes;t.length;)e.removeAttributeNode(t[0]);Je(e)}var Pn=new Map,Wf=new Set;function Qs(e){return typeof e.getRootNode=="function"?e.getRootNode():e.nodeType===9?e:e.ownerDocument}var Oa=O.d;O.d={f:Ov,r:Iv,D:Pv,C:Lv,L:Mv,m:Hv,X:Vv,S:zv,M:Bv};function Ov(){var e=Oa.f(),t=Ls();return e||t}function Iv(e){var t=qe(e);t!==null&&t.tag===5&&t.type==="form"?fp(t):Oa.r(e)}var Dr=typeof document>"u"?null:document;function Qf(e,t,r){var s=Dr;if(s&&typeof t=="string"&&t){var u=rn(t);u='link[rel="'+e+'"][href="'+u+'"]',typeof r=="string"&&(u+='[crossorigin="'+r+'"]'),Wf.has(u)||(Wf.add(u),e={rel:e,crossOrigin:r,href:t},s.querySelector(u)===null&&(t=s.createElement("link"),Qt(t,"link",e),fe(t),s.head.appendChild(t)))}}function Pv(e){Oa.D(e),Qf("dns-prefetch",e,null)}function Lv(e,t){Oa.C(e,t),Qf("preconnect",e,t)}function Mv(e,t,r){Oa.L(e,t,r);var s=Dr;if(s&&e&&t){var u='link[rel="preload"][as="'+rn(t)+'"]';t==="image"&&r&&r.imageSrcSet?(u+='[imagesrcset="'+rn(r.imageSrcSet)+'"]',typeof r.imageSizes=="string"&&(u+='[imagesizes="'+rn(r.imageSizes)+'"]')):u+='[href="'+rn(e)+'"]';var v=u;switch(t){case"style":v=Tr(e);break;case"script":v=Fr(e)}Pn.has(v)||(e=g({rel:"preload",href:t==="image"&&r&&r.imageSrcSet?void 0:e,as:t},r),Pn.set(v,e),s.querySelector(u)!==null||t==="style"&&s.querySelector(Tl(v))||t==="script"&&s.querySelector(Fl(v))||(t=s.createElement("link"),Qt(t,"link",e),fe(t),s.head.appendChild(t)))}}function Hv(e,t){Oa.m(e,t);var r=Dr;if(r&&e){var s=t&&typeof t.as=="string"?t.as:"script",u='link[rel="modulepreload"][as="'+rn(s)+'"][href="'+rn(e)+'"]',v=u;switch(s){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":v=Fr(e)}if(!Pn.has(v)&&(e=g({rel:"modulepreload",href:e},t),Pn.set(v,e),r.querySelector(u)===null)){switch(s){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(r.querySelector(Fl(v)))return}s=r.createElement("link"),Qt(s,"link",e),fe(s),r.head.appendChild(s)}}}function zv(e,t,r){Oa.S(e,t,r);var s=Dr;if(s&&e){var u=Bt(s).hoistableStyles,v=Tr(e);t=t||"default";var q=u.get(v);if(!q){var z={loading:0,preload:null};if(q=s.querySelector(Tl(v)))z.loading=5;else{e=g({rel:"stylesheet",href:e,"data-precedence":t},r),(r=Pn.get(v))&&ld(e,r);var J=q=s.createElement("link");fe(J),Qt(J,"link",e),J._p=new Promise(function(se,pe){J.onload=se,J.onerror=pe}),J.addEventListener("load",function(){z.loading|=1}),J.addEventListener("error",function(){z.loading|=2}),z.loading|=4,Xs(q,t,s)}q={type:"stylesheet",instance:q,count:1,state:z},u.set(v,q)}}}function Vv(e,t){Oa.X(e,t);var r=Dr;if(r&&e){var s=Bt(r).hoistableScripts,u=Fr(e),v=s.get(u);v||(v=r.querySelector(Fl(u)),v||(e=g({src:e,async:!0},t),(t=Pn.get(u))&&sd(e,t),v=r.createElement("script"),fe(v),Qt(v,"link",e),r.head.appendChild(v)),v={type:"script",instance:v,count:1,state:null},s.set(u,v))}}function Bv(e,t){Oa.M(e,t);var r=Dr;if(r&&e){var s=Bt(r).hoistableScripts,u=Fr(e),v=s.get(u);v||(v=r.querySelector(Fl(u)),v||(e=g({src:e,async:!0,type:"module"},t),(t=Pn.get(u))&&sd(e,t),v=r.createElement("script"),fe(v),Qt(v,"link",e),r.head.appendChild(v)),v={type:"script",instance:v,count:1,state:null},s.set(u,v))}}function Xf(e,t,r,s){var u=(u=Y.current)?Qs(u):null;if(!u)throw Error(i(446));switch(e){case"meta":case"title":return null;case"style":return typeof r.precedence=="string"&&typeof r.href=="string"?(t=Tr(r.href),r=Bt(u).hoistableStyles,s=r.get(t),s||(s={type:"style",instance:null,count:0,state:null},r.set(t,s)),s):{type:"void",instance:null,count:0,state:null};case"link":if(r.rel==="stylesheet"&&typeof r.href=="string"&&typeof r.precedence=="string"){e=Tr(r.href);var v=Bt(u).hoistableStyles,q=v.get(e);if(q||(u=u.ownerDocument||u,q={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},v.set(e,q),(v=u.querySelector(Tl(e)))&&!v._p&&(q.instance=v,q.state.loading=5),Pn.has(e)||(r={rel:"preload",as:"style",href:r.href,crossOrigin:r.crossOrigin,integrity:r.integrity,media:r.media,hrefLang:r.hrefLang,referrerPolicy:r.referrerPolicy},Pn.set(e,r),v||Yv(u,e,r,q.state))),t&&s===null)throw Error(i(528,""));return q}if(t&&s!==null)throw Error(i(529,""));return null;case"script":return t=r.async,r=r.src,typeof r=="string"&&t&&typeof t!="function"&&typeof t!="symbol"?(t=Fr(r),r=Bt(u).hoistableScripts,s=r.get(t),s||(s={type:"script",instance:null,count:0,state:null},r.set(t,s)),s):{type:"void",instance:null,count:0,state:null};default:throw Error(i(444,e))}}function Tr(e){return'href="'+rn(e)+'"'}function Tl(e){return'link[rel="stylesheet"]['+e+"]"}function Zf(e){return g({},e,{"data-precedence":e.precedence,precedence:null})}function Yv(e,t,r,s){e.querySelector('link[rel="preload"][as="style"]['+t+"]")?s.loading=1:(t=e.createElement("link"),s.preload=t,t.addEventListener("load",function(){return s.loading|=1}),t.addEventListener("error",function(){return s.loading|=2}),Qt(t,"link",r),fe(t),e.head.appendChild(t))}function Fr(e){return'[src="'+rn(e)+'"]'}function Fl(e){return"script[async]"+e}function Kf(e,t,r){if(t.count++,t.instance===null)switch(t.type){case"style":var s=e.querySelector('style[data-href~="'+rn(r.href)+'"]');if(s)return t.instance=s,fe(s),s;var u=g({},r,{"data-href":r.href,"data-precedence":r.precedence,href:null,precedence:null});return s=(e.ownerDocument||e).createElement("style"),fe(s),Qt(s,"style",u),Xs(s,r.precedence,e),t.instance=s;case"stylesheet":u=Tr(r.href);var v=e.querySelector(Tl(u));if(v)return t.state.loading|=4,t.instance=v,fe(v),v;s=Zf(r),(u=Pn.get(u))&&ld(s,u),v=(e.ownerDocument||e).createElement("link"),fe(v);var q=v;return q._p=new Promise(function(z,J){q.onload=z,q.onerror=J}),Qt(v,"link",s),t.state.loading|=4,Xs(v,r.precedence,e),t.instance=v;case"script":return v=Fr(r.src),(u=e.querySelector(Fl(v)))?(t.instance=u,fe(u),u):(s=r,(u=Pn.get(v))&&(s=g({},r),sd(s,u)),e=e.ownerDocument||e,u=e.createElement("script"),fe(u),Qt(u,"link",s),e.head.appendChild(u),t.instance=u);case"void":return null;default:throw Error(i(443,t.type))}else t.type==="stylesheet"&&(t.state.loading&4)===0&&(s=t.instance,t.state.loading|=4,Xs(s,r.precedence,e));return t.instance}function Xs(e,t,r){for(var s=r.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),u=s.length?s[s.length-1]:null,v=u,q=0;q<s.length;q++){var z=s[q];if(z.dataset.precedence===t)v=z;else if(v!==u)break}v?v.parentNode.insertBefore(e,v.nextSibling):(t=r.nodeType===9?r.head:r,t.insertBefore(e,t.firstChild))}function ld(e,t){e.crossOrigin==null&&(e.crossOrigin=t.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=t.referrerPolicy),e.title==null&&(e.title=t.title)}function sd(e,t){e.crossOrigin==null&&(e.crossOrigin=t.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=t.referrerPolicy),e.integrity==null&&(e.integrity=t.integrity)}var Zs=null;function Jf(e,t,r){if(Zs===null){var s=new Map,u=Zs=new Map;u.set(r,s)}else u=Zs,s=u.get(r),s||(s=new Map,u.set(r,s));if(s.has(e))return s;for(s.set(e,null),r=r.getElementsByTagName(e),u=0;u<r.length;u++){var v=r[u];if(!(v[Me]||v[_t]||e==="link"&&v.getAttribute("rel")==="stylesheet")&&v.namespaceURI!=="http://www.w3.org/2000/svg"){var q=v.getAttribute(t)||"";q=e+q;var z=s.get(q);z?z.push(v):s.set(q,[v])}}return s}function eh(e,t,r){e=e.ownerDocument||e,e.head.insertBefore(r,t==="title"?e.querySelector("head > title"):null)}function Gv(e,t,r){if(r===1||t.itemProp!=null)return!1;switch(e){case"meta":case"title":return!0;case"style":if(typeof t.precedence!="string"||typeof t.href!="string"||t.href==="")break;return!0;case"link":if(typeof t.rel!="string"||typeof t.href!="string"||t.href===""||t.onLoad||t.onError)break;switch(t.rel){case"stylesheet":return e=t.disabled,typeof t.precedence=="string"&&e==null;default:return!0}case"script":if(t.async&&typeof t.async!="function"&&typeof t.async!="symbol"&&!t.onLoad&&!t.onError&&t.src&&typeof t.src=="string")return!0}return!1}function th(e){return!(e.type==="stylesheet"&&(e.state.loading&3)===0)}var ql=null;function Wv(){}function Qv(e,t,r){if(ql===null)throw Error(i(475));var s=ql;if(t.type==="stylesheet"&&(typeof r.media!="string"||matchMedia(r.media).matches!==!1)&&(t.state.loading&4)===0){if(t.instance===null){var u=Tr(r.href),v=e.querySelector(Tl(u));if(v){e=v._p,e!==null&&typeof e=="object"&&typeof e.then=="function"&&(s.count++,s=Ks.bind(s),e.then(s,s)),t.state.loading|=4,t.instance=v,fe(v);return}v=e.ownerDocument||e,r=Zf(r),(u=Pn.get(u))&&ld(r,u),v=v.createElement("link"),fe(v);var q=v;q._p=new Promise(function(z,J){q.onload=z,q.onerror=J}),Qt(v,"link",r),t.instance=v}s.stylesheets===null&&(s.stylesheets=new Map),s.stylesheets.set(t,e),(e=t.state.preload)&&(t.state.loading&3)===0&&(s.count++,t=Ks.bind(s),e.addEventListener("load",t),e.addEventListener("error",t))}}function Xv(){if(ql===null)throw Error(i(475));var e=ql;return e.stylesheets&&e.count===0&&id(e,e.stylesheets),0<e.count?function(t){var r=setTimeout(function(){if(e.stylesheets&&id(e,e.stylesheets),e.unsuspend){var s=e.unsuspend;e.unsuspend=null,s()}},6e4);return e.unsuspend=t,function(){e.unsuspend=null,clearTimeout(r)}}:null}function Ks(){if(this.count--,this.count===0){if(this.stylesheets)id(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}}var Js=null;function id(e,t){e.stylesheets=null,e.unsuspend!==null&&(e.count++,Js=new Map,t.forEach(Zv,e),Js=null,Ks.call(e))}function Zv(e,t){if(!(t.state.loading&4)){var r=Js.get(e);if(r)var s=r.get(null);else{r=new Map,Js.set(e,r);for(var u=e.querySelectorAll("link[data-precedence],style[data-precedence]"),v=0;v<u.length;v++){var q=u[v];(q.nodeName==="LINK"||q.getAttribute("media")!=="not all")&&(r.set(q.dataset.precedence,q),s=q)}s&&r.set(null,s)}u=t.instance,q=u.getAttribute("data-precedence"),v=r.get(q)||s,v===s&&r.set(null,u),r.set(q,u),this.count++,s=Ks.bind(this),u.addEventListener("load",s),u.addEventListener("error",s),v?v.parentNode.insertBefore(u,v.nextSibling):(e=e.nodeType===9?e.head:e,e.insertBefore(u,e.firstChild)),t.state.loading|=4}}var $l={$$typeof:b,Provider:null,Consumer:null,_currentValue:Z,_currentValue2:Z,_threadCount:0};function Kv(e,t,r,s,u,v,q,z){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Bn(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Bn(0),this.hiddenUpdates=Bn(null),this.identifierPrefix=s,this.onUncaughtError=u,this.onCaughtError=v,this.onRecoverableError=q,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=z,this.incompleteTransitions=new Map}function nh(e,t,r,s,u,v,q,z,J,se,pe,me){return e=new Kv(e,t,r,q,z,J,se,me),t=1,v===!0&&(t|=24),v=wn(3,null,null,t),e.current=v,v.stateNode=e,t=zi(),t.refCount++,e.pooledCache=t,t.refCount++,v.memoizedState={element:s,isDehydrated:r,cache:t},Gi(v),e}function ah(e){return e?(e=dr,e):dr}function oh(e,t,r,s,u,v){u=ah(u),s.context===null?s.context=u:s.pendingContext=u,s=Wa(t),s.payload={element:r},v=v===void 0?null:v,v!==null&&(s.callback=v),r=Qa(e,s,t),r!==null&&(En(r,e,t),ul(r,e,t))}function rh(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var r=e.retryLane;e.retryLane=r!==0&&r<t?r:t}}function cd(e,t){rh(e,t),(e=e.alternate)&&rh(e,t)}function lh(e){if(e.tag===13){var t=cr(e,67108864);t!==null&&En(t,e,67108864),cd(e,67108864)}}var ei=!0;function Jv(e,t,r,s){var u=R.T;R.T=null;var v=O.p;try{O.p=2,dd(e,t,r,s)}finally{O.p=v,R.T=u}}function e_(e,t,r,s){var u=R.T;R.T=null;var v=O.p;try{O.p=8,dd(e,t,r,s)}finally{O.p=v,R.T=u}}function dd(e,t,r,s){if(ei){var u=ud(s);if(u===null)Zc(e,t,s,ti,r),ih(e,s);else if(n_(u,e,t,r,s))s.stopPropagation();else if(ih(e,s),t&4&&-1<t_.indexOf(e)){for(;u!==null;){var v=qe(u);if(v!==null)switch(v.tag){case 3:if(v=v.stateNode,v.current.memoizedState.isDehydrated){var q=At(v.pendingLanes);if(q!==0){var z=v;for(z.pendingLanes|=2,z.entangledLanes|=2;q;){var J=1<<31-bt(q);z.entanglements[1]|=J,q&=~J}ha(v),(ct&6)===0&&(Is=Ce()+500,Nl(0))}}break;case 13:z=cr(v,2),z!==null&&En(z,v,2),Ls(),cd(v,2)}if(v=ud(s),v===null&&Zc(e,t,s,ti,r),v===u)break;u=v}u!==null&&s.stopPropagation()}else Zc(e,t,s,null,r)}}function ud(e){return e=nr(e),pd(e)}var ti=null;function pd(e){if(ti=null,e=ze(e),e!==null){var t=d(e);if(t===null)e=null;else{var r=t.tag;if(r===13){if(e=p(t),e!==null)return e;e=null}else if(r===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null)}}return ti=e,null}function sh(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Ie()){case He:return 2;case gt:return 8;case Ye:case qt:return 32;case Zt:return 268435456;default:return 32}default:return 32}}var fd=!1,io=null,co=null,uo=null,Ul=new Map,Ol=new Map,po=[],t_="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function ih(e,t){switch(e){case"focusin":case"focusout":io=null;break;case"dragenter":case"dragleave":co=null;break;case"mouseover":case"mouseout":uo=null;break;case"pointerover":case"pointerout":Ul.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ol.delete(t.pointerId)}}function Il(e,t,r,s,u,v){return e===null||e.nativeEvent!==v?(e={blockedOn:t,domEventName:r,eventSystemFlags:s,nativeEvent:v,targetContainers:[u]},t!==null&&(t=qe(t),t!==null&&lh(t)),e):(e.eventSystemFlags|=s,t=e.targetContainers,u!==null&&t.indexOf(u)===-1&&t.push(u),e)}function n_(e,t,r,s,u){switch(t){case"focusin":return io=Il(io,e,t,r,s,u),!0;case"dragenter":return co=Il(co,e,t,r,s,u),!0;case"mouseover":return uo=Il(uo,e,t,r,s,u),!0;case"pointerover":var v=u.pointerId;return Ul.set(v,Il(Ul.get(v)||null,e,t,r,s,u)),!0;case"gotpointercapture":return v=u.pointerId,Ol.set(v,Il(Ol.get(v)||null,e,t,r,s,u)),!0}return!1}function ch(e){var t=ze(e.target);if(t!==null){var r=d(t);if(r!==null){if(t=r.tag,t===13){if(t=p(r),t!==null){e.blockedOn=t,sa(e.priority,function(){if(r.tag===13){var s=jn();s=Gn(s);var u=cr(r,s);u!==null&&En(u,r,s),cd(r,s)}});return}}else if(t===3&&r.stateNode.current.memoizedState.isDehydrated){e.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}e.blockedOn=null}function ni(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var r=ud(e.nativeEvent);if(r===null){r=e.nativeEvent;var s=new r.constructor(r.type,r);tr=s,r.target.dispatchEvent(s),tr=null}else return t=qe(r),t!==null&&lh(t),e.blockedOn=r,!1;t.shift()}return!0}function dh(e,t,r){ni(e)&&r.delete(t)}function a_(){fd=!1,io!==null&&ni(io)&&(io=null),co!==null&&ni(co)&&(co=null),uo!==null&&ni(uo)&&(uo=null),Ul.forEach(dh),Ol.forEach(dh)}function ai(e,t){e.blockedOn===t&&(e.blockedOn=null,fd||(fd=!0,a.unstable_scheduleCallback(a.unstable_NormalPriority,a_)))}var oi=null;function uh(e){oi!==e&&(oi=e,a.unstable_scheduleCallback(a.unstable_NormalPriority,function(){oi===e&&(oi=null);for(var t=0;t<e.length;t+=3){var r=e[t],s=e[t+1],u=e[t+2];if(typeof s!="function"){if(pd(s||r)===null)continue;break}var v=qe(r);v!==null&&(e.splice(t,3),t-=3,pc(v,{pending:!0,data:u,method:r.method,action:s},s,u))}}))}function Pl(e){function t(J){return ai(J,e)}io!==null&&ai(io,e),co!==null&&ai(co,e),uo!==null&&ai(uo,e),Ul.forEach(t),Ol.forEach(t);for(var r=0;r<po.length;r++){var s=po[r];s.blockedOn===e&&(s.blockedOn=null)}for(;0<po.length&&(r=po[0],r.blockedOn===null);)ch(r),r.blockedOn===null&&po.shift();if(r=(e.ownerDocument||e).$$reactFormReplay,r!=null)for(s=0;s<r.length;s+=3){var u=r[s],v=r[s+1],q=u[Et]||null;if(typeof v=="function")q||uh(r);else if(q){var z=null;if(v&&v.hasAttribute("formAction")){if(u=v,q=v[Et]||null)z=q.formAction;else if(pd(u)!==null)continue}else z=q.action;typeof z=="function"?r[s+1]=z:(r.splice(s,3),s-=3),uh(r)}}}function hd(e){this._internalRoot=e}ri.prototype.render=hd.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(i(409));var r=t.current,s=jn();oh(r,s,e,t,null,null)},ri.prototype.unmount=hd.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;oh(e.current,2,null,e,null,null),Ls(),t[ue]=null}};function ri(e){this._internalRoot=e}ri.prototype.unstable_scheduleHydration=function(e){if(e){var t=la();e={blockedOn:null,target:e,priority:t};for(var r=0;r<po.length&&t!==0&&t<po[r].priority;r++);po.splice(r,0,e),r===0&&ch(e)}};var ph=n.version;if(ph!=="19.1.1")throw Error(i(527,ph,"19.1.1"));O.findDOMNode=function(e){var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(i(188)):(e=Object.keys(e).join(","),Error(i(268,e)));return e=f(t),e=e!==null?m(e):null,e=e===null?null:e.stateNode,e};var o_={bundleType:0,version:"19.1.1",rendererPackageName:"react-dom",currentDispatcherRef:R,reconcilerVersion:"19.1.1"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var li=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!li.isDisabled&&li.supportsFiber)try{sn=li.inject(o_),Rt=li}catch{}}return Ml.createRoot=function(e,t){if(!c(e))throw Error(i(299));var r=!1,s="",u=kp,v=Np,q=Rp,z=null;return t!=null&&(t.unstable_strictMode===!0&&(r=!0),t.identifierPrefix!==void 0&&(s=t.identifierPrefix),t.onUncaughtError!==void 0&&(u=t.onUncaughtError),t.onCaughtError!==void 0&&(v=t.onCaughtError),t.onRecoverableError!==void 0&&(q=t.onRecoverableError),t.unstable_transitionCallbacks!==void 0&&(z=t.unstable_transitionCallbacks)),t=nh(e,1,!1,null,null,r,s,u,v,q,z,null),e[ue]=t.current,Xc(e),new hd(t)},Ml.hydrateRoot=function(e,t,r){if(!c(e))throw Error(i(299));var s=!1,u="",v=kp,q=Np,z=Rp,J=null,se=null;return r!=null&&(r.unstable_strictMode===!0&&(s=!0),r.identifierPrefix!==void 0&&(u=r.identifierPrefix),r.onUncaughtError!==void 0&&(v=r.onUncaughtError),r.onCaughtError!==void 0&&(q=r.onCaughtError),r.onRecoverableError!==void 0&&(z=r.onRecoverableError),r.unstable_transitionCallbacks!==void 0&&(J=r.unstable_transitionCallbacks),r.formState!==void 0&&(se=r.formState)),t=nh(e,1,!0,t,r??null,s,u,v,q,z,J,se),t.context=ah(null),r=t.current,s=jn(),s=Gn(s),u=Wa(s),u.callback=null,Qa(r,u,s),r=s,t.current.lanes=r,dn(t,r),ha(t),e[ue]=t.current,Xc(e),new ri(t)},Ml.version="19.1.1",Ml}var Ch;function h_(){if(Ch)return yd.exports;Ch=1;function a(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(a)}catch(n){console.error(n)}}return a(),yd.exports=f_(),yd.exports}var m_=h_(),re=Ud();/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Ct=({card:a,onPointerDown:n,onPointerEnter:l,onPointerLeave:i,isFaceUp:c,faceDownValue:d=2,isSelected:p,isMultiSelected:h,isTargetable:f,isSourceOfEffect:m,style:g,additionalClassName:y,animationState:w})=>{const _=({content:$,className:B})=>o.jsx("div",{className:`card-rule-box ${B||""}`,dangerouslySetInnerHTML:{__html:$}}),k=(w==null?void 0:w.type)==="playCard"&&w.cardId===a.id?`is-entering-${w.owner}`:"",E=(w==null?void 0:w.type)==="deleteCard"&&w.cardId===a.id?`is-deleting-${w.owner}`:"",C=(w==null?void 0:w.type)==="drawCard"||(w==null?void 0:w.type)==="discardCard"?w.owner:void 0,b=C==="player"&&(w==null?void 0:w.type)==="drawCard"&&w.cardIds.includes(a.id),T=C==="player"&&(w==null?void 0:w.type)==="discardCard"&&w.cardIds.includes(a.id),A=["card-component"];a.protocol&&A.push(`card-protocol-${a.protocol.toLowerCase()}`),a.color&&A.push("has-custom-color"),a.pattern&&A.push(`card-pattern-${a.pattern}`),p&&A.push("selected"),h&&A.push("multi-selected"),T&&A.push("is-discarding"),f&&A.push("is-targetable"),m&&A.push("is-source-of-effect"),k&&A.push(k),E&&A.push(E),b&&A.push("is-drawing"),y&&A.push(y);const H={...g};return a.color&&(H["--card-custom-color"]=a.color),o.jsx("div",{className:A.join(" "),onPointerDown:n,onPointerEnter:l,onPointerLeave:i,role:"button",tabIndex:n?0:-1,style:H,children:o.jsxs("div",{className:`card-inner ${c?"":"is-flipped"}`,children:[o.jsxs("div",{className:"card-face card-front",children:[o.jsxs("div",{className:"card-header",children:[o.jsx("span",{className:`card-protocol ${a.protocol.length<=10?"short-protocol":""}`,children:a.protocol.slice(0,10)}),o.jsx("span",{className:"card-value",children:a.value})]}),o.jsxs("div",{className:"card-body",children:[o.jsx(_,{content:a.top,className:"card-rule-top"}),o.jsx(_,{content:a.middle,className:"card-rule-middle"}),o.jsx(_,{content:a.bottom,className:"card-rule-bottom"})]})]}),o.jsx("div",{className:"card-face card-back",children:o.jsx("div",{className:"card-back-value",children:d})})]})})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Nn=[{protocol:"Apathy",value:0,top:"Your total value in this line is increased by 1 for each face-down card in this line.",middle:"",bottom:"",keywords:{},category:"Aux 1"},{protocol:"Apathy",value:1,top:"",middle:"Flip all other face-up cards in this line.",bottom:"",keywords:{flip:!0},category:"Aux 1"},{protocol:"Apathy",value:2,top:"Ignore all middle commands of cards in this line.",middle:"",bottom:"<div><span class='emphasis'>When this card would be covered:</span> First, flip this card.</div>",keywords:{flip:!0},category:"Aux 1"},{protocol:"Apathy",value:3,top:"",middle:"Flip 1 of your opponent's face-up cards.",bottom:"",keywords:{flip:!0},category:"Aux 1"},{protocol:"Apathy",value:4,top:"",middle:"You may flip 1 of your face-up covered cards.",bottom:"",keywords:{flip:!0},category:"Aux 1"},{protocol:"Apathy",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Aux 1"},{protocol:"Chaos",value:0,top:"",middle:"In each line, flip 1 covered card.",bottom:"<div><span class='emphasis'>Start:</span> Draw the top card of your opponent's deck. Your opponent draws the top card of your deck.</div>",keywords:{flip:!0,draw:!0},category:"Main 2"},{protocol:"Chaos",value:1,top:"",middle:"Rearrange your protocols. Rearrange your opponent's protocols.",bottom:"",keywords:{},category:"Main 2"},{protocol:"Chaos",value:2,top:"",middle:"Shift 1 of your covered cards.",bottom:"",keywords:{shift:!0},category:"Main 2"},{protocol:"Chaos",value:3,top:"",middle:"",bottom:"You may play cards without matching protocols.",keywords:{play:!0},category:"Main 2"},{protocol:"Chaos",value:4,top:"",middle:"",bottom:"<div><span class='emphasis'>End:</span> Discard your hand. Draw the same amount of cards.</div>",keywords:{discard:!0,draw:!0},category:"Main 2"},{protocol:"Chaos",value:5,top:"",middle:"Discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 2"},{protocol:"Darkness",value:0,top:"",middle:"Draw 3 cards. Shift 1 of your opponent's covered cards.",bottom:"",keywords:{draw:!0,shift:!0},category:"Main 1"},{protocol:"Darkness",value:1,top:"",middle:"Flip 1 of your opponent's cards. You may shift that card.",bottom:"",keywords:{flip:!0,shift:!0},category:"Main 1"},{protocol:"Darkness",value:2,top:"All face-down cards in this stack have a value of 4.",middle:"You may flip 1 covered card in this line.",bottom:"",keywords:{flip:!0},category:"Main 1"},{protocol:"Darkness",value:3,top:"",middle:"Play 1 card face-down in another line.",bottom:"",keywords:{play:!0},category:"Main 1"},{protocol:"Darkness",value:4,top:"",middle:"Shift 1 face-down card.",bottom:"",keywords:{shift:!0},category:"Main 1"},{protocol:"Darkness",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Death",value:0,top:"",middle:"Delete 1 card from each other line.",bottom:"",keywords:{delete:!0},category:"Main 1"},{protocol:"Death",value:1,top:"<div><span class='emphasis'>Start:</span> You may draw 1 card. If you do, delete 1 other card, then delete this card.</div>",middle:"",bottom:"",keywords:{draw:!0,delete:!0},category:"Main 1"},{protocol:"Death",value:2,top:"",middle:"Delete all cards in 1 line with values of 1 or 2.",bottom:"",keywords:{delete:!0},category:"Main 1"},{protocol:"Death",value:3,top:"",middle:"Delete 1 face-down card.",bottom:"",keywords:{delete:!0},category:"Main 1"},{protocol:"Death",value:4,top:"",middle:"Delete a card with a value of 0 or 1.",bottom:"",keywords:{delete:!0},category:"Main 1"},{protocol:"Death",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Fire",value:0,top:"",middle:"Flip 1 other card. Draw 2 cards.",bottom:"<div><span class='emphasis'>When this card would be covered:</span> First, draw 1 card and flip 1 other card.</div>",keywords:{draw:!0,flip:!0},category:"Main 1"},{protocol:"Fire",value:1,top:"",middle:"Discard 1 card. If you do, delete 1 card.",bottom:"",keywords:{delete:!0,discard:!0},category:"Main 1"},{protocol:"Fire",value:2,top:"",middle:"Discard 1 card. If you do, return 1 card.",bottom:"",keywords:{discard:!0,return:!0},category:"Main 1"},{protocol:"Fire",value:3,top:"",middle:"",bottom:"<div><span class='emphasis'>End:</span> You may discard 1 card. If you do, flip 1 card.</div>",keywords:{discard:!0,flip:!0},category:"Main 1"},{protocol:"Fire",value:4,top:"",middle:"Discard 1 or more cards. Draw the amount discarded plus 1.",bottom:"",keywords:{discard:!0,draw:!0},category:"Main 1"},{protocol:"Fire",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Gravity",value:0,top:"",middle:"For every 2 cards in this line, play the top card of your deck face-down under this card.",bottom:"",keywords:{play:!0},category:"Main 1"},{protocol:"Gravity",value:1,top:"",middle:"Draw 2 cards. Shift 1 card either to or from this line.",bottom:"",keywords:{draw:!0,shift:!0},category:"Main 1"},{protocol:"Gravity",value:2,top:"",middle:"Flip 1 card. Shift that card to this line.",bottom:"",keywords:{flip:!0,shift:!0},category:"Main 1"},{protocol:"Gravity",value:4,top:"",middle:"Shift 1 face-down card to this line.",bottom:"",keywords:{shift:!0},category:"Main 1"},{protocol:"Gravity",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Gravity",value:6,top:"",middle:"Your opponent plays the top card of their deck face-down in this line.",bottom:"",keywords:{play:!0},category:"Main 1"},{protocol:"Hate",value:0,top:"",middle:"Delete 1 card.",bottom:"",keywords:{delete:!0},category:"Aux 1"},{protocol:"Hate",value:1,top:"",middle:"Discard 3 cards. Delete 1 card. Delete 1 card.",bottom:"",keywords:{delete:!0,discard:!0},category:"Aux 1"},{protocol:"Hate",value:2,top:"",middle:"Delete your highest value uncovered card. Delete your opponent's highest value uncovered card.",bottom:"",keywords:{delete:!0},category:"Aux 1"},{protocol:"Hate",value:3,top:"<div><span class='emphasis'>After you delete cards:</span> Draw 1 card.</div>",middle:"",bottom:"",keywords:{draw:!0},category:"Aux 1"},{protocol:"Hate",value:4,top:"",middle:"",bottom:"<div><span class='emphasis'>When this card would be covered:</span> First, delete the lowest value covered card in this line.</div>",keywords:{delete:!0},category:"Aux 1"},{protocol:"Hate",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Aux 1"},{protocol:"Life",value:0,top:"",middle:"Play the top card of your deck face-down in each line where you have a card.",bottom:"<div><span class='emphasis'>When this card would be covered:</span> First, delete this card.</div>",keywords:{delete:!0,play:!0},category:"Main 1"},{protocol:"Life",value:1,top:"",middle:"Flip 1 card. Flip 1 card.",bottom:"",keywords:{flip:!0},category:"Main 1"},{protocol:"Life",value:2,top:"",middle:"Draw 1 card. You may flip 1 face-down card.",bottom:"",keywords:{draw:!0,flip:!0},category:"Main 1"},{protocol:"Life",value:3,top:"",middle:"",bottom:"<div><span class='emphasis'>When this card would be covered:</span> First, play the top card of your deck face-down in another line.</div>",keywords:{play:!0},category:"Main 1"},{protocol:"Life",value:4,top:"",middle:"If this card is covering a card, draw 1 card.",bottom:"",keywords:{draw:!0},category:"Main 1"},{protocol:"Life",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Light",value:0,top:"",middle:"Flip 1 card. Draw cards equal to that card's value.",bottom:"",keywords:{draw:!0,flip:!0},category:"Main 1"},{protocol:"Light",value:1,top:"",middle:"",bottom:"<div><span class='emphasis'>End:</span> Draw 1 card.</div>",keywords:{draw:!0},category:"Main 1"},{protocol:"Light",value:2,top:"",middle:"Draw 2 cards. Reveal 1 face-down card. You may shift or flip that card.",bottom:"",keywords:{draw:!0,flip:!0,reveal:!0,shift:!0},category:"Main 1"},{protocol:"Light",value:3,top:"",middle:"Shift all face-down cards in this line to another line.",bottom:"",keywords:{shift:!0},category:"Main 1"},{protocol:"Light",value:4,top:"",middle:"Your opponent reveals their hand.",bottom:"",keywords:{reveal:!0},category:"Main 1"},{protocol:"Light",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Love",value:1,top:"",middle:"Draw the top card of your opponent's deck.",bottom:"<div><span class='emphasis'>End:</span> You may give 1 card from your hand to your opponent. If you do, draw 2 cards.</div>",keywords:{draw:!0,give:!0},category:"Aux 1"},{protocol:"Love",value:2,top:"",middle:"Your opponent draws 1 card. Refresh.",bottom:"",keywords:{draw:!0,refresh:!0},category:"Aux 1"},{protocol:"Love",value:3,top:"",middle:"Take 1 random card from your opponent's hand. Give 1 card from your hand to your opponent.",bottom:"",keywords:{give:!0,take:!0},category:"Aux 1"},{protocol:"Love",value:4,top:"",middle:"Reveal 1 card from your hand. Flip 1 card.",bottom:"",keywords:{flip:!0,reveal:!0},category:"Aux 1"},{protocol:"Love",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Aux 1"},{protocol:"Love",value:6,top:"",middle:"Your opponent draws 2 cards.",bottom:"",keywords:{draw:!0},category:"Aux 1"},{protocol:"Metal",value:0,top:"Your opponent's total value in this line is reduced by 2.",middle:"Flip 1 card.",bottom:"",keywords:{flip:!0},category:"Main 1"},{protocol:"Metal",value:1,top:"",middle:"Draw 2 cards. Your opponent cannot compile next turn.",bottom:"",keywords:{draw:!0},category:"Main 1"},{protocol:"Metal",value:2,top:"Your opponent cannot play cards face-down in this line.",middle:"",bottom:"",keywords:{},category:"Main 1"},{protocol:"Metal",value:3,top:"",middle:"Draw 1 card. Delete all cards in 1 other line with 8 or more cards.",bottom:"",keywords:{delete:!0,draw:!0},category:"Main 1"},{protocol:"Metal",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Metal",value:6,top:"<div><span class='emphasis'>When this card would be covered or flipped:</span> First, delete this card.</div>",middle:"",bottom:"",keywords:{delete:!0},category:"Main 1"},{protocol:"Plague",value:0,top:"",middle:"Your opponent discards 1 card.",bottom:"Your opponent cannot play cards in this line.",keywords:{discard:!0},category:"Main 1"},{protocol:"Plague",value:1,top:"<div><span class='emphasis'>After your opponent discards cards:</span> Draw 1 card.</div>",middle:"Your opponent discards 1 card.",bottom:"",keywords:{discard:!0,draw:!0},category:"Main 1"},{protocol:"Plague",value:2,top:"",middle:"Dicard 1 or more cards. Your opponent discards the amount of cards discarded plus 1.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Plague",value:3,top:"",middle:"Flip each other face-up card.",bottom:"",keywords:{flip:!0},category:"Main 1"},{protocol:"Plague",value:4,top:"",middle:"",bottom:"<div><span class='emphasis'>End:</span> Your opponent deletes 1 of their face-down cards. You may flip this card.</div>",keywords:{delete:!0,flip:!0},category:"Main 1"},{protocol:"Plague",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Psychic",value:0,top:"",middle:"Draw 2 cards. Your opponent discards 2 cards, then reveals their hand.",bottom:"",keywords:{discard:!0,draw:!0,reveal:!0},category:"Main 1"},{protocol:"Psychic",value:1,top:"Your opponent can only play cards face-down.",middle:"",bottom:"<div><span class='emphasis'>Start:</span> Flip this card.</div>",keywords:{flip:!0},category:"Main 1"},{protocol:"Psychic",value:2,top:"",middle:"Your opponent discards 2 cards. Rearrange their protocols.",bottom:"",keywords:{discard:!0,rearrange:!0},category:"Main 1"},{protocol:"Psychic",value:3,top:"",middle:"Your opponent discards 1 card. Shift 1 of their cards.",bottom:"",keywords:{discard:!0,shift:!0},category:"Main 1"},{protocol:"Psychic",value:4,top:"",middle:"",bottom:"<div><span class='emphasis'>End:</span> You may return 1 of your opponent's cards. If you do, flip this card.</div>",keywords:{flip:!0,return:!0},category:"Main 1"},{protocol:"Psychic",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Speed",value:0,top:"",middle:"Play 1 card.",bottom:"",keywords:{play:!0},category:"Main 1"},{protocol:"Speed",value:1,top:"<div><span class='emphasis'>After you clear cache:</span> Draw 1 card.</div>",middle:"Draw 2 cards.",bottom:"",keywords:{draw:!0},category:"Main 1"},{protocol:"Speed",value:2,top:"<div><span class='emphasis'>When this card would be deleted by compiling:</span> Shift this card, even if this card is covered.</div>",middle:"",bottom:"",keywords:{shift:!0},category:"Main 1"},{protocol:"Speed",value:3,top:"",middle:"Shift 1 of your other cards.",bottom:"<div><span class='emphasis'>End:</span> You may shift 1 of your cards. If you do, flip this card.</div>",keywords:{flip:!0,shift:!0},category:"Main 1"},{protocol:"Speed",value:4,top:"",middle:"Shift 1 of your opponent's face-down cards.",bottom:"",keywords:{shift:!0},category:"Main 1"},{protocol:"Speed",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Spirit",value:0,top:"",middle:"Refresh. Draw 1 card.",bottom:"Skip your check cache phase.",keywords:{draw:!0,refresh:!0},category:"Main 1"},{protocol:"Spirit",value:1,top:"You can play cards in any line.",middle:"Draw 2 cards.",bottom:"<div><span class='emphasis'>Start:</span> Either discard 1 card or flip this card.</div>",keywords:{discard:!0,draw:!0,flip:!0},category:"Main 1"},{protocol:"Spirit",value:2,top:"",middle:"You may flip 1 card.",bottom:"",keywords:{flip:!0},category:"Main 1"},{protocol:"Spirit",value:3,top:"<div><span class='emphasis'>After you draw cards:</span> You may shift this card, even if this card is covered.</div>",middle:"",bottom:"",keywords:{shift:!0},category:"Main 1"},{protocol:"Spirit",value:4,top:"",middle:"Swap the positions of 2 of your protocols",bottom:"",keywords:{swap:!0},category:"Main 1"},{protocol:"Spirit",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Water",value:0,top:"",middle:"Flip 1 other card. Flip this card.",bottom:"",keywords:{flip:!0},category:"Main 1"},{protocol:"Water",value:1,top:"",middle:"Play the top card of your deck face-down in each other line.",bottom:"",keywords:{play:!0},category:"Main 1"},{protocol:"Water",value:2,top:"",middle:"Draw 2 cards. Rearrange your protocols.",bottom:"",keywords:{draw:!0,rearrange:!0},category:"Main 1"},{protocol:"Water",value:3,top:"",middle:"Return all cards with a value of 2 in 1 line.",bottom:"",keywords:{return:!0},category:"Main 1"},{protocol:"Water",value:4,top:"",middle:"Return 1 of your cards.",bottom:"",keywords:{return:!0},category:"Main 1"},{protocol:"Water",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Frost",value:0,top:"",middle:"Draw 1 card for each face-down card.",bottom:"",keywords:{draw:!0},category:"Fan-Content"},{protocol:"Frost",value:1,top:"Cards cannot be flipped face-up.",middle:"",bottom:"Protocols cannot be rearranged.",keywords:{flip:!0,rearrange:!0},category:"Fan-Content"},{protocol:"Frost",value:2,top:"",middle:"Play a card face-down.",bottom:"",keywords:{play:!0},category:"Fan-Content"},{protocol:"Frost",value:3,top:"Cards cannot shift from or to this line.",middle:"",bottom:"",keywords:{shift:!0},category:"Fan-Content"},{protocol:"Frost",value:4,top:"",middle:"You may flip 1 card of your face-up covered cards.",bottom:"",keywords:{flip:!0},category:"Fan-Content"},{protocol:"Frost",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Fan-Content"},{protocol:"Anarchy",value:0,top:"",middle:"Shift 1 card. For each line that contains a face-up card without matching protocol, draw 1 card.",bottom:"",keywords:{shift:!0,draw:!0},category:"Fan-Content"},{protocol:"Anarchy",value:1,top:"Cards can only be played without matching protocols.",middle:"Shift 1 other card to a line without a matching protocol.",bottom:"",keywords:{shift:!0,play:!0},category:"Fan-Content"},{protocol:"Anarchy",value:2,top:"",middle:"Delete a covered or uncovered card in a line with a matching protocol.",bottom:"",keywords:{delete:!0},category:"Fan-Content"},{protocol:"Anarchy",value:3,top:"",middle:"Swap the positions of 2 of your opponent's protocols.",bottom:"<div><span class='emphasis'>End:</span> Rearrange your protocols. Anarchy cannot be on this line.</div>",keywords:{swap:!0,rearrange:!0},category:"Fan-Content"},{protocol:"Anarchy",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Fan-Content"},{protocol:"Anarchy",value:6,top:"<div><span class='emphasis'>Start:</span> Flip this card, if this card is in the line with the Anarchy protocol.</div>",middle:"",bottom:"",keywords:{flip:!0},category:"Fan-Content"}],y_=new Set(Nn.map(a=>a.protocol)),g_=Array.from(y_).sort();/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Ir=a=>{var i,c,d,p,h,f,m,g,y,w,_,S,k,j,E,C,b,T,A,H,$,B,X,I,F,N,D,P,L,R,O,Z,ee,M,G,K,W,U,Q,Y,ce,te,ye,Se,ge,Fe,Le,Xe,nt,we,Ce,Ie,He,gt,Ye,qt,Zt,vn,zn,sn,Rt,Vt,bt,Vn,ga,ta,An,cn,At,Kt,_n,va,na,aa,Bn,dn,Yn,oa,ra,Gn,Wn,la,sa,Jt,_t,Et;const n=a.params;let l="";switch(n.action){case"refresh":{n.target==="opponent"?l="Your opponent refreshes their hand.":l="Refresh.";break}case"mutual_draw":{const ue=n.count||1;l=`Draw the top card${ue!==1?"s":""} of your opponent's deck. Your opponent draws the top card${ue!==1?"s":""} of your deck.`;break}case"draw":{if(a.useCardFromPreviousEffect){n.target==="opponent"?l="Opponent draws cards equal to that card's value.":l="Draw cards equal to that card's value.";break}if(n.countType==="count_face_down"){l="Draw 1 card for each face-down card.";break}if(n.conditional){switch(n.conditional.type){case"count_face_down":l="Draw 1 card for each face-down card.";break;case"is_covering":l=`Draw ${n.count} card${n.count!==1?"s":""} if this card is covering another.`;break;case"non_matching_protocols":l="Draw 1 card for each line with a non-matching protocol.";break}break}let ue="";if(n.countType==="equal_to_discarded"){const Ae=n.countOffset||0;Ae===1?ue+="Draw 1 more card than the amount discarded.":Ae===0?ue+="Draw the same amount of cards.":ue+=`Draw the amount discarded plus ${Ae}.`,l=ue;break}else if(n.countType==="equal_to_card_value"){ue+="Draw cards equal to that card's value.",l=ue;break}else if(n.countType==="hand_size"){ue+="Draw the same amount of cards.",l=ue;break}else if(n.countType==="all_matching"&&((i=n.valueFilter)==null?void 0:i.equals)!==void 0){const Ae=n.valueFilter.equals;ue+=`Draw all cards with a value of ${Ae}.`,l=ue;break}else if(((c=n.valueFilter)==null?void 0:c.equals)!==void 0&&n.count){const Ae=n.valueFilter.equals,$e=n.count===1?"card":"cards",Te=n.fromRevealed?" revealed this way":"";ue+=`Draw ${n.count} ${$e} with a value of ${Ae}${Te}.`,l=ue;break}if(((d=n.advancedConditional)==null?void 0:d.type)==="empty_hand"){const Ae=n.count||1;l=`If you have no cards in hand, draw ${Ae} card${Ae!==1?"s":""}.`;break}if(((p=n.advancedConditional)==null?void 0:p.type)==="opponent_higher_value_in_lane"){const Ae=n.count||1;l=`If your opponent has a higher total value than you do in this line, draw ${Ae} card${Ae!==1?"s":""}.`;break}const be=n.optional?"You may ":"";if(n.source==="opponent_deck"){const Ae=n.count===1?"the top card":`the top ${n.count} cards`;ue+=`${be}Draw ${Ae} of your opponent's deck.`}else if(n.target==="opponent")ue+=`Opponent draws ${n.count} card${n.count!==1?"s":""}.`;else{const Ae=n.optional?"draw":"Draw";ue+=`${be}${Ae} ${n.count} card${n.count!==1?"s":""}.`}l=ue;break}case"flip":{if(a.useCardFromPreviousEffect){l=`${n.optional?"May flip":"Flip"} that card.`;break}if(n.flipSelf){if(((h=n.advancedConditional)==null?void 0:h.type)==="opponent_higher_value_in_lane"){l="If your opponent has a higher value in this line than you do, flip this card.";break}let at=(n.optional,"Flip this card");((f=n.advancedConditional)==null?void 0:f.type)==="protocol_match"&&(at+=`, if this card is in the line with the ${n.advancedConditional.protocol||"[Protocol]"} protocol`),l=at+".";break}const ue=n.optional?"You may flip":"Flip",be=((m=n.targetFilter)==null?void 0:m.owner)==="own",Ae=((g=n.targetFilter)==null?void 0:g.owner)==="opponent",$e=(y=n.targetFilter)==null?void 0:y.excludeSelf;let Te="";be&&$e?Te+="of your other ":be?Te+="of your ":Ae?Te+="of your opponent's ":$e&&(Te+="other "),((w=n.targetFilter)==null?void 0:w.position)==="any"?Te+="covered or uncovered ":((_=n.targetFilter)==null?void 0:_.position)==="covered"&&(Te+="covered "),((S=n.targetFilter)==null?void 0:S.faceState)==="face_down"&&(Te+="face-down "),((k=n.targetFilter)==null?void 0:k.faceState)==="face_up"&&(Te+="face-up ");let Me="";n.count==="all"?Me="all":n.count==="each"?n.eachLineScope==="each_line"?(Me="1",Te=Te+"(in each line) "):Me="each":Me=n.count.toString();const ze=be||Ae?"cards":n.count===1?"card":"cards";let qe="";if(be&&((j=n.targetFilter)==null?void 0:j.position)==="covered"&&((E=n.targetFilter)==null?void 0:E.faceState)==="face_up"&&n.optional?qe=`${ue} ${Me} of your ${n.targetFilter.faceState.replace("_","-")} ${n.targetFilter.position} cards`:qe=`${ue} ${Me} ${Te}${ze}`,n.scope==="this_lane"){const at=((C=n.targetFilter)==null?void 0:C.owner)==="own";qe+=at?" in this stack":" in this line"}else n.scope==="each_lane"&&(qe=`In each line, ${qe.charAt(0).toLowerCase()+qe.slice(1)}`);qe+=".",n.selfFlipAfter&&(qe+=" Then flip this card."),l=qe;break}case"shift":{const ue=n.optional?"You may shift":"Shift";if(((b=n.advancedConditional)==null?void 0:b.type)==="empty_hand"){l=`If you have no cards in hand, ${ue.toLowerCase()} 1 card.`;break}if(((T=n.advancedConditional)==null?void 0:T.type)==="opponent_higher_value_in_lane"){l=`If your opponent has a higher total value than you do in this line, ${ue.toLowerCase()} 1 card.`;break}if(((A=n.advancedConditional)==null?void 0:A.type)==="this_card_is_covered"){l=`If this card is covered, ${ue.toLowerCase()} it.`;break}if(n.shiftSelf){if(((H=n.destinationRestriction)==null?void 0:H.type)==="opponent_highest_value_lane"){l=`${ue} this card to the line where your opponent has their highest total value.`;break}let je=`${ue} this card`;n.allowCoveredSelf&&(je+=", even if this card is covered"),l=je+".";break}if(a.useCardFromPreviousEffect){let je=`${ue} that card`;(($=n.destinationRestriction)==null?void 0:$.type)==="to_this_lane"?je+=" to this line":((B=n.destinationRestriction)==null?void 0:B.type)==="to_another_line"?je+=" to another line":((X=n.destinationRestriction)==null?void 0:X.type)==="non_matching_protocol"?je+=" to a line without a matching protocol":((I=n.destinationRestriction)==null?void 0:I.type)==="specific_lane"&&(je+=" within this line"),l=je+".";break}const be=n.count||1,Ae=((F=n.targetFilter)==null?void 0:F.owner)==="own",$e=((N=n.targetFilter)==null?void 0:N.position)==="covered";if(Ae&&$e&&be===1){let je=`${ue} 1 of your covered cards`;((D=n.destinationRestriction)==null?void 0:D.type)==="non_matching_protocol"?je+=" to a line without a matching protocol":((P=n.destinationRestriction)==null?void 0:P.type)==="specific_lane"?je+=" within this line":((L=n.destinationRestriction)==null?void 0:L.type)==="to_another_line"&&(je+=" to another line"),l=je+".";break}if(((R=n.targetFilter)==null?void 0:R.owner)==="own"&&((O=n.targetFilter)==null?void 0:O.position)==="any"&&!((Z=n.targetFilter)!=null&&Z.excludeSelf)&&be===1){l=`${ue} this card, even if this card is covered`+".";break}if(Ae&&!$e&&!((ee=n.targetFilter)!=null&&ee.excludeSelf)&&be===1){l=`${ue} 1 of your cards`+".";break}let Me="";const Je=((M=n.targetFilter)==null?void 0:M.owner)==="opponent",ze=(G=n.targetFilter)==null?void 0:G.excludeSelf,qe=((K=n.targetFilter)==null?void 0:K.position)==="any";Ae&&ze?Me+="of your other ":Je?Me+="of your opponent's ":ze&&(Me+="other "),qe?Me+="covered or uncovered ":((W=n.targetFilter)==null?void 0:W.position)==="covered"&&(Me+="covered "),((U=n.targetFilter)==null?void 0:U.faceState)==="face_down"&&(Me+="face-down "),((Q=n.targetFilter)==null?void 0:Q.faceState)==="face_up"&&(Me+="face-up ");const at=n.count==="all"?"all":"1";let _e=`${ue} ${at} ${Me}${Ae&&ze||Je?"cards":at==="1"?"card":"cards"}`;n.scope==="this_lane"&&(_e+=" in this line"),((Y=n.destinationRestriction)==null?void 0:Y.type)==="non_matching_protocol"?_e+=" to a line without a matching protocol":((ce=n.destinationRestriction)==null?void 0:ce.type)==="specific_lane"?_e+=" within this line":((te=n.destinationRestriction)==null?void 0:te.type)==="to_another_line"?_e+=" to another line":((ye=n.destinationRestriction)==null?void 0:ye.type)==="to_this_lane"?_e+=" to this line":((Se=n.destinationRestriction)==null?void 0:Se.type)==="to_or_from_this_lane"&&(_e+=" either to or from this line"),l=_e+".";break}case"delete":{if(((ge=n.advancedConditional)==null?void 0:ge.type)==="empty_hand"){const Je=n.count||1;l=`If you have no cards in hand, delete ${Je} card${Je!==1?"s":""}.`;break}if(((Fe=n.advancedConditional)==null?void 0:Fe.type)==="opponent_higher_value_in_lane"){const Je=n.count||1;l=`If your opponent has a higher total value than you do in this line, delete ${Je} card${Je!==1?"s":""}.`;break}if(a.useCardFromPreviousEffect){l="Delete that card.";break}if(n.deleteSelf){l="Delete this card.";break}if(((Le=n.laneCondition)==null?void 0:Le.type)==="opponent_higher_value"){const Je=n.count||1,ze=((Xe=n.targetFilter)==null?void 0:Xe.owner)==="opponent"?"of your opponent's ":"";l=`Delete ${Je} ${ze}${Je===1?"card":"cards"} in a line where they have a higher total value than you do.`;break}let ue="Delete ";const be=((nt=n.targetFilter)==null?void 0:nt.position)==="any",Ae=((we=n.targetFilter)==null?void 0:we.calculation)==="highest_value"||((Ce=n.targetFilter)==null?void 0:Ce.calculation)==="lowest_value",$e=((Ie=n.targetFilter)==null?void 0:Ie.owner)==="own"||((He=n.targetFilter)==null?void 0:He.owner)==="opponent",Te=n.count===1&&Ae&&$e;if(n.count==="all_in_lane"?ue+="all ":Te||(ue+=be?"a ":`${n.count} `),Te&&(((gt=n.targetFilter)==null?void 0:gt.owner)==="own"?ue+="your ":((Ye=n.targetFilter)==null?void 0:Ye.owner)==="opponent"&&(ue+="opponent's ")),((qt=n.targetFilter)==null?void 0:qt.calculation)==="highest_value"?ue+="highest value ":((Zt=n.targetFilter)==null?void 0:Zt.calculation)==="lowest_value"&&(ue+="lowest value "),(vn=n.targetFilter)!=null&&vn.valueRange){const{min:Je,max:ze}=n.targetFilter.valueRange,qe=[];for(let Bt=Je;Bt<=ze;Bt++)qe.push(Bt);const at=qe.join(" or ");ue+=`value ${at} `}Te||(((zn=n.targetFilter)==null?void 0:zn.owner)==="own"?ue+="your ":((sn=n.targetFilter)==null?void 0:sn.owner)==="opponent"&&(ue+="opponent's ")),n.excludeSelf&&(ue+="other "),be?ue+="covered or uncovered ":((Rt=n.targetFilter)==null?void 0:Rt.position)==="covered"&&(ue+="covered "),((Vt=n.targetFilter)==null?void 0:Vt.faceState)==="face_down"?ue+="face-down ":((bt=n.targetFilter)==null?void 0:bt.faceState)==="face_up"&&(ue+="face-up ");const Me=n.count===1?"card":"cards";ue+=Me,n.selectLane&&(ue+=" in 1 line"),n.protocolMatching==="must_match"?ue+=" in a line with a matching protocol":n.protocolMatching==="must_not_match"&&(ue+=" in a line without a matching protocol"),((Vn=n.scope)==null?void 0:Vn.type)==="this_line"?ue+=" in this line":((ga=n.scope)==null?void 0:ga.type)==="other_lanes"?ue+=" in other lanes":((ta=n.scope)==null?void 0:ta.type)==="each_other_line"&&(ue+=" from each other line"),l=ue+".";break}case"discard":{if(n.useCardFromPreviousEffect){n.actor==="opponent"?l="Opponent discards that card.":l="discard that card.";break}if(n.countType==="equal_to_discarded"){const $e=n.countOffset||0;n.actor==="opponent"?$e===1?l="Your opponent discards the amount of cards discarded plus 1.":$e===0?l="Your opponent discards the same amount of cards.":l=`Your opponent discards the amount discarded plus ${$e}.`:$e===1?l="Discard 1 more card than the amount discarded.":$e===0?l="Discard the same amount of cards.":l=`Discard the amount discarded plus ${$e}.`;break}const ue=n.variableCount;let be="";if(ue)be="1 or more cards";else if(n.count==="all")be="your hand";else{const $e=n.count===1?"card":"cards";be=`${n.count} ${$e}`}const Ae=n.optional?"You may discard":n.count==="all"||ue?"Discard":"You discard";if(n.actor==="opponent")if(n.count==="all")l="Opponent discards their hand.";else if(n.random){const $e=n.count===1?"card":"cards";l=`Your opponent discards ${n.count} random ${$e}.`}else l=`Your opponent discards ${be}.`;else l=`${Ae} ${be}.`;break}case"return":{if(((An=n.advancedConditional)==null?void 0:An.type)==="empty_hand"){const qe=n.count||1;l=`If you have no cards in hand, return ${qe} card${qe!==1?"s":""}.`;break}if(((cn=n.advancedConditional)==null?void 0:cn.type)==="opponent_higher_value_in_lane"){const qe=n.count||1;l=`If your opponent has a higher total value than you do in this line, return ${qe} card${qe!==1?"s":""}.`;break}if(a.useCardFromPreviousEffect){l="Return that card to hand.";break}const be=n.selectLane||!1?" in 1 line":"";if(((At=n.targetFilter)==null?void 0:At.valueEquals)!==void 0){l=`Return all cards with a value of ${n.targetFilter.valueEquals}${be}.`;break}const Ae=((Kt=n.targetFilter)==null?void 0:Kt.owner)||"any",$e=((_n=n.targetFilter)==null?void 0:_n.position)||"uncovered";let Te="";$e==="any"?Te="covered or uncovered ":$e==="covered"&&(Te="covered ");const Me=n.count==="all"?`all ${Te}cards`:n.count===1?`1 ${Te}card`:`${n.count} ${Te}cards`;let Je="";Ae==="own"?Je=" of your":Ae==="opponent"&&(Je=" of your opponent's"),l=`${n.optional?"You may r":"R"}eturn ${Me}${Je}${be}.`;break}case"play":{if(((va=n.advancedConditional)==null?void 0:va.type)==="empty_hand"){const qe=n.count||1;l=`If you have no cards in hand, play ${qe} card${qe!==1?"s":""}.`;break}if(((na=n.advancedConditional)==null?void 0:na.type)==="opponent_higher_value_in_lane"){const qe=n.count||1;l=`If your opponent has a higher total value than you do in this line, play ${qe} card${qe!==1?"s":""}.`;break}if(a.useCardFromPreviousEffect){const qe=n.faceDown===!0?"face-down":n.faceDown===!1?"face-up":"";l=qe?`Play that card ${qe}.`:"Play that card.";break}const ue=n.actor,be=n.count||1,Ae=n.faceDown===!0?" face-down":n.faceDown===!1?" face-up":"";let $e="",Te="";const Me=((aa=n.valueFilter)==null?void 0:aa.equals)!==void 0?` with a value of ${n.valueFilter.equals}`:"";ue==="opponent"?($e="Your opponent plays",n.source==="deck"?Te=be===1?"the top card of their deck":`${be} cards from their deck`:Te=be===1?`a card${Me} from their hand`:`${be} cards${Me} from their hand`):($e="Play",n.source==="deck"?Te=be===1?"the top card of your deck":`${be} cards from your deck`:Te=be===1?`1 card${Me}`:`${be} cards${Me}`);let Je="";((Bn=n.condition)==null?void 0:Bn.type)==="per_x_cards_in_line"&&(Je=`For every ${n.condition.cardCount||2} cards in this line, `,$e=$e.toLowerCase());let ze=`${Je}${$e} ${Te}${Ae}`;if(((dn=n.destinationRule)==null?void 0:dn.type)==="other_lines")ze+=" to other lines";else if(((Yn=n.destinationRule)==null?void 0:Yn.type)==="another_line")ze+=" in another line";else if(((oa=n.destinationRule)==null?void 0:oa.type)==="each_other_line")ze+=" in each other line";else if(((ra=n.destinationRule)==null?void 0:ra.type)==="under_this_card")ze+=" under this card";else if(((Gn=n.destinationRule)==null?void 0:Gn.type)==="each_line_with_card"){const qe=n.destinationRule.ownerFilter,at=n.destinationRule.cardFilter;(at==null?void 0:at.faceState)==="face_down"?ze+=" in each line with a face-down card":(at==null?void 0:at.faceState)==="face_up"?ze+=" in each line with a face-up card":qe==="own"?ze+=" in each line where you have a card":qe==="opponent"?ze+=" in each line where opponent has a card":ze+=" to each line with a card"}else if(((Wn=n.destinationRule)==null?void 0:Wn.type)==="line_with_matching_cards"){const qe=n.destinationRule.cardFilter;(qe==null?void 0:qe.faceState)==="face_down"?ze+=" in a line with a face-down card":(qe==null?void 0:qe.faceState)==="face_up"?ze+=" in a line with a face-up card":ze+=" in a line with a card"}else((la=n.destinationRule)==null?void 0:la.type)==="specific_lane"&&(ze+=" in this line");l=ze+".";break}case"rearrange_protocols":case"swap_protocols":{const ue=n.target==="opponent"?"your opponent's":n.target==="both_sequential"?"both players'":"your";let be="";n.action==="rearrange_protocols"?be=`Rearrange ${ue} protocols`:be=`Swap the positions of 2 of ${ue} protocols`,n.restriction&&n.restriction.disallowedProtocol&&(be+=`. ${n.restriction.disallowedProtocol} cannot be on this line`),l=be+".";break}case"reveal":case"give":{if(a.useCardFromPreviousEffect){l=`${n.action==="give"?"Give":"Reveal"} that card.`;break}if(n.action,n.source==="board"){const Je=((sa=n.targetFilter)==null?void 0:sa.faceState)==="face_down"?"face-down ":"",ze=n.count||1;let at=`Reveal ${ze} ${Je}${ze===1?"card":"cards"}`;n.optional?at+=". You may shift or flip that card":n.followUpAction==="flip"?at+=". Then flip it":n.followUpAction==="shift"&&(at+=". Then shift it"),l=at+".";break}if(n.source==="own_deck_top"){let Je="Reveal the top card of your deck";n.followUpAction==="may_discard"&&(Je+=". You may discard it"),l=Je+".";break}if(n.source==="own_deck"){l="Reveal your deck.";break}if(n.count===-1){n.source==="opponent_hand"?l=n.action==="reveal"?"Your opponent reveals their hand.":"Give your entire hand to your opponent.":l=n.action==="reveal"?"Reveal your hand.":"Give your entire hand.";break}const ue=n.count===1?"card":"cards",be=n.source==="opponent_hand"?"opponent's hand":"your hand",Ae=n.optional?"You may ":"",$e=n.action==="give"?"give":"reveal",Te=n.action==="give"?"Give":"Reveal";let Me;n.optional?Me=`${Ae}${$e} ${n.count} ${ue} from ${be}`:Me=`${Te} ${n.count} ${ue} from ${be}`,n.action==="give"&&n.source!=="opponent_hand"&&(Me+=" to your opponent"),n.followUpAction==="flip"?Me+=". Then flip it.":n.followUpAction==="shift"?Me+=". Then shift it.":Me+=".",l=Me;break}case"take":{const ue=n.count===1?"card":"cards",be=n.random!==!1?"random ":"";l=`Take ${n.count} ${be}${ue} from your opponent's hand.`;break}case"choice":{const ue=n.options||[];if(ue.length===0){l="Effect";break}if(ue.length===2){const be=ue.map(Ae=>{const $e={params:Ae.params};let Te=Ir($e);return Te.endsWith(".")&&(Te=Te.slice(0,-1)),Te=Te.charAt(0).toLowerCase()+Te.slice(1),Te});l=`Either ${be[0]} or ${be[1]}.`}else l="Effect";break}case"passive_rule":{const ue=n.rule;switch(ue==null?void 0:ue.type){case"require_non_matching_protocol":l="Cards can only be played without matching protocols.";break;case"block_all_play":ue.target==="opponent"?l="Your opponent cannot play cards in this line.":ue.target==="self"?l="You cannot play cards in this line.":l="Cards cannot be played in this line.";break;case"ignore_middle_commands":if(ue.onlyDuringYourTurn&&ue.target==="opponent"&&ue.scope==="global")l="During your turn, your opponent's cards do not have middle commands.";else if(ue.onlyDuringYourTurn){const be=ue.target==="opponent"?"your opponent's ":ue.target==="self"?"your ":"",Ae=ue.scope==="global"?"":" in this line";l=`During your turn, ignore all middle commands of ${be}cards${Ae}.`}else l="Ignore all middle commands of cards in this line.";break;case"block_face_down_play":l="Opponent can't play cards face-down in this line.";break;case"require_face_down_play":l=ue.scope==="global"?"Your opponent can only play cards face-down.":"Opponent can only play cards face-down in this line.";break;case"allow_any_protocol_play":l="You may play cards without matching protocols.";break;case"allow_play_on_opponent_side":l="You may play this card in any line on either player's side.";break;case"block_flips":l=ue.scope==="global"?"Cards cannot be flipped face-up.":"Cards can't be flipped face-up in this line.";break;case"block_protocol_rearrange":l="Protocols can't be rearranged.";break;case"block_shifts_from_lane":l="Cards can't shift from this line.";break;case"block_shifts_to_lane":l="Cards can't shift to this line.";break;case"block_shifts_from_and_to_lane":l="Cards cannot shift from or to this line.";break;case"skip_check_cache_phase":l="Skip check cache phase.";break;case"block_flip_this_card":l="This card cannot be flipped.";break;case"block_draw_conditional":{const be=ue.conditionTarget||"self",Ae=ue.blockTarget||"self",$e=be==="self"?"you have":"your opponent has";let Te;Ae==="self"?Te="you cannot draw":Ae==="opponent"?Te="your opponent cannot draw":Te="neither player can draw",l=`If ${$e} any cards in hand, ${Te} cards.`;break}default:l="Passive rule effect."}break}case"value_modifier":{const ue=n.modifier;switch(ue==null?void 0:ue.type){case"add_per_condition":{const be=ue.scope==="this_lane"?"in this line":"",Ae=ue.target==="own_total"?"Your total value":ue.target==="opponent_total"?"Opponent's total value":"Total value";let $e="";ue.condition==="per_face_down_card"?$e="for each face-down card":ue.condition==="per_face_up_card"?$e="for each face-up card":ue.condition==="per_card"?$e="for each card":ue.condition==="per_card_in_hand"&&($e="for each card in your hand");const Te=ue.value>=0?"+":"";l=`${Ae} ${be} is increased by ${Te}${ue.value} ${$e} ${be}.`.replace(/\s+/g," ");break}case"set_to_fixed":{let be="";ue.target==="own_cards"?be="your":ue.target==="opponent_cards"?be="opponent's":be="all";let Ae="";((Jt=ue.filter)==null?void 0:Jt.faceState)==="face_down"?Ae=" face-down":((_t=ue.filter)==null?void 0:_t.faceState)==="face_up"&&(Ae=" face-up");let $e="";ue.scope==="this_lane"&&($e=" in this stack"),l=`All ${be}${Ae} cards${$e} have a value of ${ue.value}.`;break}case"add_to_total":{const be=ue.scope==="this_lane"?" in this line":"";ue.target==="opponent_total"?ue.value<0?l=`Your opponent's total value${be} is reduced by ${Math.abs(ue.value)}.`:l=`Your opponent's total value${be} is increased by ${ue.value}.`:ue.value<0?l=`Your total value${be} is reduced by ${Math.abs(ue.value)}.`:l=`Your total value${be} is increased by ${ue.value}.`;break}default:l="Value modifier effect."}break}case"block_compile":{l=`${n.target==="opponent"?"Your opponent":"You"} cannot compile next turn.`;break}case"delete_all_in_lane":{const ue=((Et=n.laneCondition)==null?void 0:Et.count)||8;l=`Delete all cards in ${n.excludeCurrentLane?"1 other line":"1 line"} with ${ue} or more cards.`;break}case"modify_value":{const ue=n.modifier||0,be=n.target==="opponent"?"Your opponent's":"Your",Ae=ue<0?`reduced by ${Math.abs(ue)}`:`increased by ${ue}`;l=`${be} total value in this line is ${Ae}.`;break}case"block_play_face_down":{l="Your opponent cannot play cards face-down in this line.";break}case"shuffle_trash":{l=`${n.optional!==!1?"You may shuffle":"Shuffle"} your trash into your deck.`;break}case"shuffle_deck":{l="Shuffle your deck.";break}case"redirect_return_to_deck":{l=`Put that card on top of their deck ${n.faceDown!==!1?"face-down ":""}instead.`;break}default:l="Effect";break}if(a.conditional&&a.conditional.thenEffect){let ue=Ir(a.conditional.thenEffect);const be=a.conditional.thenEffect.params;be!=null&&be.useCardFromPreviousEffect&&(ue=ue.replace(/\d+ cards?/i,"that card")),a.conditional.type==="then"?l=`${l.endsWith(".")?l.slice(0,-1):l}, then ${ue.toLowerCase()}`:a.conditional.type==="optional"?l=`${l.endsWith(".")?l.slice(0,-1):l}. You may ${ue.toLowerCase()}`:l=`${l} If you do, ${ue.toLowerCase()}`}return l},v_=a=>{const n={};for(const l of a){const c=l.params.action;c==="draw"&&(n.draw=!0),c==="flip"&&(n.flip=!0),c==="shift"&&(n.shift=!0),c==="delete"&&(n.delete=!0),c==="discard"&&(n.discard=!0),c==="return"&&(n.return=!0),c==="play"&&(n.play=!0),c==="reveal"&&(n.reveal=!0),c==="give"&&(n.give=!0),c==="take"&&(n.take=!0)}return n},Yo=a=>a.length===0?"":a.map(n=>{var c;const l=Ir(n),i=n.trigger;if(i==="start")return`<div><span class='emphasis'>Start:</span> ${l}</div>`;if(i==="end")return`<div><span class='emphasis'>End:</span> ${l}</div>`;if(i==="on_cover")return`<div><span class='emphasis'>When this card would be covered:</span> First, ${l.toLowerCase()}</div>`;if(i==="on_flip")return`<div><span class='emphasis'>When this card would be flipped:</span> First, ${l.toLowerCase()}</div>`;if(i==="on_cover_or_flip")return`<div><span class='emphasis'>When this card would be covered or flipped:</span> First, ${l.toLowerCase()}</div>`;if(i==="after_draw"||i==="after_delete"||i==="after_discard"||i==="after_shift"||i==="after_flip"||i==="after_clear_cache"){const d=n.reactiveTriggerActor||"self",p=d==="self"?"you":d==="opponent"?"opponent":"a card is";let h="";return i==="after_draw"?h=d==="any"?"drawn":"draw cards":i==="after_delete"?h=d==="any"?"deleted":"delete cards":i==="after_discard"?h=d==="any"?"discarded":"discard cards":i==="after_shift"?h=d==="any"?"shifted":"shift cards":i==="after_flip"?h=d==="any"?"flipped":"flip cards":i==="after_clear_cache"&&(h="clear cache"),`<div><span class='emphasis'>${d==="any"?`After ${p} ${h}`:`After ${p} ${h}`}:</span> ${l}</div>`}if(i==="after_opponent_discard")return`<div><span class='emphasis'>After your opponent discards cards:</span> ${l}</div>`;if(i==="after_play"){const d=n.reactiveTriggerActor||"self",p=n.reactiveScope||"global";return d==="opponent"&&p==="this_lane"?`<div><span class='emphasis'>After your opponent plays a card in this line:</span> ${l}</div>`:d==="opponent"?`<div><span class='emphasis'>After your opponent plays a card:</span> ${l}</div>`:p==="this_lane"?`<div><span class='emphasis'>After you play a card in this line:</span> ${l}</div>`:`<div><span class='emphasis'>After you play a card:</span> ${l}</div>`}return i==="before_compile_delete"?`<div><span class='emphasis'>When this card would be deleted by compiling:</span> ${l}</div>`:i==="when_card_returned"?`<div><span class='emphasis'>When a card would be returned to ${(((c=n.params)==null?void 0:c.targetOwner)||"opponent")==="opponent"?"your opponent's":"your"} hand:</span> ${l}</div>`:l}).join(" "),__=(a,n)=>{var f,m,g;const l=((f=a.text)==null?void 0:f.top)!==void 0?a.text.top:Yo(a.topEffects),i=((m=a.text)==null?void 0:m.middle)!==void 0?a.text.middle:Yo(a.middleEffects),c=((g=a.text)==null?void 0:g.bottom)!==void 0?a.text.bottom:Yo(a.bottomEffects),d=[...a.topEffects,...a.middleEffects,...a.bottomEffects],p=v_(d);return{protocol:n.name,value:a.value,top:l,middle:i,bottom:c,keywords:p,category:n.category||"Custom",color:n.color,pattern:n.pattern,customEffects:{topEffects:a.topEffects,middleEffects:a.middleEffects,bottomEffects:a.bottomEffects}}},x_=a=>a.cards.map(n=>__(n,a)),Co=()=>{try{const a=localStorage.getItem("custom_protocols_v1");if(!a)return[];const l=JSON.parse(a).protocols||[],i=[];for(const c of l){const d=x_(c);i.push(...d)}return i}catch(a){return console.error("Failed to load custom protocol cards:",a),[]}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Wh="custom_protocols_v1",Ed=1,Qo=()=>{try{const a=localStorage.getItem(Wh);if(!a)return[];const n=JSON.parse(a);return n.version!==Ed&&console.warn(`Custom protocol storage version mismatch: expected ${Ed}, got ${n.version}`),n.protocols||[]}catch(a){return console.error("Error loading custom protocols:",a),[]}},Od=a=>{try{const n={protocols:a,version:Ed};localStorage.setItem(Wh,JSON.stringify(n))}catch(n){console.error("Error saving custom protocols:",n)}},yt=a=>{const n=Qo(),l=n.findIndex(i=>i.id===a.id);l>=0?n[l]=a:n.push(a),Od(n)},w_=a=>{const l=Qo().filter(i=>i.id!==a);Od(l)},C_=["anarchy-custom-001","apathy_custom","chaos_custom_1","clarity-custom-001","corruption-custom-001","courage-custom-001","darkness_custom_v1","death_custom_v1","fear_custom","fire-custom-001","frost_custom_1","gravity_custom_1","hate-custom-001","ice_custom","life_custom_1","light_custom_1","love_custom_v1","metal_custom_1","plague-custom-001","psychic_custom_v1","smoke-custom-001","speed_custom_1","spirit_custom_1","water_custom_1"],Lr=a=>C_.includes(a.id),b_=(a,n)=>{const l=(c,d)=>{c=c.replace("#","");const p=parseInt(c.substring(0,2),16),h=parseInt(c.substring(2,4),16),f=parseInt(c.substring(4,6),16);return`rgba(${p}, ${h}, ${f}, ${d})`},i={borderColor:n};switch(a){case"solid":return{...i,backgroundColor:n};case"radial":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`radial-gradient(circle at 50% 50%, ${l(n,.25)} 0%, transparent 60%)`};case"dual-radial":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 0% 0%, ${l(n,.2)}, transparent 50%),
                    radial-gradient(at 100% 100%, ${l(n,.2)}, transparent 50%)
                `};case"multi-radial":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 0%, ${l(n,.2)}, transparent 70%),
                    radial-gradient(circle at 20% 30%, ${l(n,.15)}, transparent 40%),
                    radial-gradient(circle at 80% 70%, ${l(n,.2)}, transparent 50%)
                `};case"chaos":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 10% 10%, hsla(60, 100%, 50%, 0.15), transparent 30%),
                    radial-gradient(at 90% 20%, hsla(180, 100%, 50%, 0.15), transparent 35%),
                    radial-gradient(at 30% 80%, hsla(300, 100%, 50%, 0.15), transparent 40%),
                    radial-gradient(at 70% 60%, hsla(0, 100%, 50%, 0.1), transparent 25%)
                `};case"grid":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(circle at 50% 50%, ${l(n,.2)} 0%, transparent 40%),
                    linear-gradient(hsla(0,0%,100%,0.03) 1px, transparent 1px),
                    linear-gradient(90deg, hsla(0,0%,100%,0.03) 1px, transparent 1px)
                `,backgroundSize:"100% 100%, 20px 20px, 20px 20px"};case"diagonal-lines":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 0% 100%, ${l(n,.25)}, transparent 70%),
                    repeating-linear-gradient(120deg, transparent, transparent 15px, ${l(n,.05)} 15px, ${l(n,.05)} 30px)
                `};case"cross-diagonal":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 50%, ${l(n,.25)} 0%, transparent 50%),
                    repeating-linear-gradient(45deg, transparent, transparent 8px, ${l(n,.08)} 8px, ${l(n,.08)} 16px),
                    repeating-linear-gradient(-45deg, transparent, transparent 8px, ${l(n,.06)} 8px, ${l(n,.06)} 16px)
                `};case"horizontal-lines":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 80% 80%, ${l(n,.1)}, transparent 50%),
                    repeating-linear-gradient(0deg, hsla(0,0%,100%,0.02), hsla(0,0%,100%,0.02) 1px, transparent 1px, transparent 3px)
                `};case"vertical-lines":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 10% 10%, ${l(n,.2)}, transparent 50%),
                    repeating-linear-gradient(175deg, transparent, transparent 1px, ${l(n,.05)} 1px, ${l(n,.05)} 2px)
                `};case"cross":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    linear-gradient(0deg, transparent 40%, ${l(n,.1)} 50%, transparent 60%),
                    linear-gradient(90deg, transparent 48%, ${l(n,.2)} 50%, transparent 52%)
                `};case"hexagons":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 0%, ${l(n,.2)}, transparent 70%),
                    url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='28' height='49' viewBox='0 0 28 49'%3E%3Cg fill-rule='evenodd'%3E%3Cg id='hexagons' fill='${encodeURIComponent(n)}' fill-opacity='0.05' fill-rule='nonzero'%3E%3Cpath d='M13.99 9.25l13 7.5v15l-13 7.5L1 31.75v-15l12.99-7.5zM3 17.9v12.7l10.99 6.34 11-6.35V17.9l-11-6.34L3 17.9zM0 15l12.99-7.5L26 15v18.5l-13 7.5L0 33.5V15z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")
                `};case"stripes":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 100%, ${l(n,.25)}, transparent 60%),
                    linear-gradient(135deg, hsla(0,0%,0%,0.1) 23%, transparent 23%, transparent 25%, hsla(0,0%,0%,0.1) 25%, hsla(0,0%,0%,0.1) 27%, transparent 27%, transparent 73%, hsla(0,0%,0%,0.1) 73%, hsla(0,0%,0%,0.1) 75%, transparent 75%, transparent 77%, hsla(0,0%,0%,0.1) 77%)
                `};default:return{...i,backgroundColor:n}}},S_=({protocols:a,onCreateNew:n,onEdit:l,onDelete:i,onImport:c,onBack:d})=>{const[p,h]=re.useState(!1),[f,m]=re.useState(!1),[g,y]=re.useState(""),[w,_]=re.useState(""),S=p?a:a.filter(j=>!Lr(j)),k=()=>{_("");try{const j=JSON.parse(g);if(!j.name||!j.color||!j.pattern||!Array.isArray(j.cards)){_("Invalid protocol format. Missing required fields.");return}if(j.cards.length!==6){_("Invalid protocol: must have exactly 6 cards.");return}const E=a.find(C=>C.name.toLowerCase()===j.name.toLowerCase());if(E){confirm(`A protocol named "${j.name}" already exists. Overwrite it?`)&&(j.id=E.id,c(j),m(!1),y(""),alert("Protocol imported and overwritten successfully!"));return}j.id=Date.now().toString(),j.createdAt=new Date().toISOString(),c(j),m(!1),y(""),alert("Protocol imported successfully!")}catch{_("Invalid JSON format. Please check your input.")}};return o.jsxs("div",{className:"protocol-list",children:[o.jsxs("div",{className:"list-header",children:[o.jsx("h2",{children:"Custom Protocols"}),o.jsxs("div",{className:"header-actions",children:[o.jsxs("label",{className:"system-protocols-toggle",children:[o.jsx("input",{type:"checkbox",checked:p,onChange:j=>h(j.target.checked)}),"Show System Protocols"]}),o.jsx("button",{onClick:()=>m(!0),className:"btn",children:"Import Protocol"}),d&&o.jsx("button",{onClick:d,className:"btn btn-back",children:"Back"})]})]}),f&&o.jsx("div",{className:"custom-protocol-modal-overlay",onClick:()=>m(!1),children:o.jsxs("div",{className:"custom-protocol-modal-content",onClick:j=>j.stopPropagation(),children:[o.jsx("h3",{children:"Import Protocol"}),o.jsx("p",{children:"Paste the protocol JSON below:"}),o.jsx("textarea",{value:g,onChange:j=>y(j.target.value),placeholder:'{"name":"Protocol Name","color":"#1976D2",...}',rows:10,className:"import-textarea"}),w&&o.jsx("div",{className:"error-message",children:w}),o.jsxs("div",{className:"custom-protocol-modal-actions",children:[o.jsx("button",{onClick:()=>m(!1),className:"btn btn-back",children:"Cancel"}),o.jsx("button",{onClick:k,className:"btn",children:"Import"})]})]})}),o.jsxs("div",{className:"protocols-grid",children:[o.jsxs("div",{className:"protocol-card new-protocol-card",onClick:n,children:[o.jsx("div",{className:"protocol-header new-protocol-header",children:o.jsxs("div",{className:"protocol-header-content",children:[o.jsx("h3",{children:"+ New Protocol"}),o.jsx("p",{className:"header-description",children:"Create a custom protocol"})]})}),o.jsx("div",{className:"protocol-body new-protocol-body"})]}),S.map(j=>{const E=Lr(j);return o.jsx("div",{className:`protocol-card ${E?"system-protocol":""}`,style:b_(j.pattern,j.color),onClick:()=>l(j),children:o.jsxs("div",{className:"protocol-header-content",children:[o.jsx("h3",{children:j.name}),E&&o.jsx("span",{className:"system-badge",children:"System"}),j.description&&o.jsx("p",{className:"header-description",children:j.description})]})},j.id)})]})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Qh="customProtocolsEnabled";function Id(){try{return localStorage.getItem(Qh)==="true"}catch{return!1}}function j_(a){try{localStorage.setItem(Qh,a?"true":"false")}catch{}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */let ui=null;function E_(){if(!ui){const a=Id(),n=Co(),l=Qo(),i=new Set(l.filter(c=>Lr(c)).map(c=>c.name));ui=n.filter(c=>i.has(c.protocol)||a)}return ui}function Bl(){ui=null}function Ia(a){const n=E_(),l=[];for(const i of a){const c=n.filter(d=>d.protocol===i);l.push(...c)}return l}function kn(a){const n=[...a];for(let l=n.length-1;l>0;l--){const i=Math.floor(Math.random()*(l+1));[n[l],n[i]]=[n[i],n[l]]}return n}function bh({onNavigate:a,difficulty:n,setDifficulty:l,useControl:i,onUseControlChange:c}){const[d,p]=re.useState(null),[h,f]=re.useState(null),[m,g]=re.useState(null),[y,w]=re.useState([]),[_,S]=re.useState(!0),[k,j]=re.useState(0);re.useEffect(()=>{const C=new Set;for(;C.size<2&&C.size<Nn.length;)C.add(Math.floor(Math.random()*Nn.length));const b=Array.from(C).map(T=>Nn[T]);b.length>0&&(g(b[0]),f(b[0])),b.length>1&&p(b[1]),w(kn(Nn))},[]);const E=()=>{const C=k+1;if(j(C),C>=5){const b=!_;S(b),j_(b),j(0)}};return o.jsxs("div",{className:"screen main-menu",children:[o.jsx("h1",{children:"COMPILE: MAIN 1"}),o.jsxs("div",{className:"main-menu-attribution",children:[o.jsxs("p",{children:["based on the card game ",o.jsx("a",{href:"https://boardgamegeek.com/boardgame/406652/compile-main-1",target:"_blank",rel:"noopener noreferrer",children:"Compile: Main 1"})," designed by ",o.jsx("a",{href:"https://justgravyllc.com/",target:"_blank",rel:"noopener noreferrer",children:"Michael Yang"})]}),o.jsxs("p",{children:[o.jsx("span",{onClick:E,style:{cursor:"default",userSelect:"none"},children:"developed"})," by ",o.jsx("a",{href:"https://apo-games.de/",target:"_blank",rel:"noopener noreferrer",children:"Dirk Aporius"})]})]}),o.jsxs("div",{className:"main-menu-layout",children:[o.jsx("div",{className:"main-menu-preview decorative-card",children:h&&o.jsx(Ct,{card:{...h,id:"preview",isFaceUp:!0},isFaceUp:!0})}),o.jsxs("div",{className:"main-menu-actions-container",children:[o.jsxs("div",{className:"main-menu-start-group",children:[o.jsxs("div",{className:"difficulty-selector",children:[o.jsx("h3",{className:"difficulty-title",children:"Difficulty"}),o.jsxs("div",{className:"difficulty-options",children:[o.jsx("button",{className:`btn ${n==="easy"?"active":""}`,onClick:()=>l("easy"),children:"Easy"}),o.jsx("button",{className:`btn ${n==="normal"?"active":""}`,onClick:()=>l("normal"),children:"Normal"}),o.jsx("button",{className:`btn btn-wip ${n==="hard"?"active":""}`,disabled:!0,children:"Hard"})]})]}),o.jsxs("div",{className:"control-mechanic-selector",children:[o.jsx("input",{type:"checkbox",id:"control-mechanic",checked:i,onChange:C=>c(C.target.checked)}),o.jsx("label",{htmlFor:"control-mechanic",children:"Use Control Mechanic"})]}),o.jsx("button",{className:"btn btn-start",onClick:()=>a("ProtocolSelection"),children:"Start Game"})]}),o.jsxs("div",{className:"main-menu-other-actions",children:[o.jsx("button",{className:"btn",onClick:()=>a("CardLibrary"),children:"Cards"}),o.jsx("button",{className:"btn",onClick:()=>a("Statistics"),children:"Statistics"}),_&&o.jsx("button",{className:"btn",onClick:()=>a("CustomProtocols"),children:"Custom Protocols"}),o.jsx("button",{className:"btn",onClick:()=>a("Rules"),children:"Rules"}),o.jsx("p",{className:"version-info",children:"Version 0.26"})]})]}),o.jsx("div",{className:"decorative-card decorative-card-right",children:d&&o.jsx(Ct,{card:{...d,id:"deco-2",isFaceUp:!0},isFaceUp:!0})})]}),o.jsx("div",{className:"card-ticker-container",onPointerLeave:()=>f(m),children:o.jsxs("div",{className:"card-ticker-track",children:[y.map((C,b)=>o.jsx(Ct,{card:{...C,id:`ticker-1-${b}`,isFaceUp:!0},isFaceUp:!0,additionalClassName:"in-hand",onPointerEnter:()=>f(C)},`ticker-1-${b}`)),y.map((C,b)=>o.jsx(Ct,{card:{...C,id:`ticker-2-${b}`,isFaceUp:!0},isFaceUp:!0,additionalClassName:"in-hand",onPointerEnter:()=>f(C)},`ticker-2-${b}`))]})})]})}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function gi({title:a,onBack:n}){return o.jsxs("header",{className:"app-header",children:[o.jsx("h2",{children:a}),n&&o.jsx("button",{className:"btn btn-back",onClick:n,children:"Back"})]})}const si=[{player:"Player",picks:1},{player:"Opponent",picks:2},{player:"Player",picks:2},{player:"Opponent",picks:1}];function k_({onBack:a,onStartGame:n}){const[l,i]=re.useState(0),[c,d]=re.useState([]),[p,h]=re.useState([]),[f,m]=re.useState([]),[g,y]=re.useState(!1),[w,_]=re.useState(null),[S,k]=re.useState(null),[j,E]=re.useState(0);re.useEffect(()=>{Bl(),E(U=>U+1)},[]);const C=re.useMemo(()=>{const U=Id(),Q=Co(),Y=Qo(),ce=new Set(Y.filter(ye=>Lr(ye)).map(ye=>ye.name)),te=Q.filter(ye=>ce.has(ye.protocol)||U);return console.log("[Protocol Selection] Total cards loaded:",te.length,"(custom enabled:",U,")"),te},[j]),b=re.useMemo(()=>{const U=new Set(C.map(Y=>Y.protocol)),Q=Array.from(U).sort();return console.log("[Protocol Selection] Unique protocols:",Q),Q},[C]),T=re.useMemo(()=>{const U=new Set(C.map(Q=>Q.category));return Array.from(U).sort()},[C]),A=["Fan-Content","Main 2"],[H,$]=re.useState(new Set),[B,X]=re.useState(!1);re.useEffect(()=>{if(T.length>0&&!B){const U=new Set(T);A.forEach(Q=>U.delete(Q)),$(U),X(!0)}},[T,B]);const I=U=>{const Q=C.find(Y=>Y.protocol===U);return(Q==null?void 0:Q.category)||""},F=U=>{const Y=C.find(ce=>ce.protocol===U);return Y!=null&&Y.color?{"--card-custom-color":Y.color,borderColor:Y.color}:{}},N=U=>{const Y=C.find(ce=>ce.protocol===U);return Y!=null&&Y.pattern?`pattern-${Y.pattern}`:""},D=re.useMemo(()=>b.filter(U=>{const Q=I(U);return H.has(Q)}),[H]),P=U=>{$(Q=>{const Y=new Set(Q);return Y.has(U)?Y.delete(U):Y.add(U),Y})},L=si[l],R=(L==null?void 0:L.player)==="Player",O=(L==null?void 0:L.player)==="Opponent",Z=re.useMemo(()=>new Set([...c,...p]),[c,p]),ee=re.useMemo(()=>f.map(U=>({name:U,cards:C.filter(Q=>Q.protocol===U).sort((Q,Y)=>Q.value-Y.value)})),[f]),M=U=>{if(!R||g)return;const Q=C.filter(Y=>Y.protocol===U).sort((Y,ce)=>Y.value-ce.value);Q.length>0&&k(Q[0]),m(Y=>{if(Y.includes(U))return Y.filter(ce=>ce!==U);if(Y.length<L.picks)return[...Y,U];if(Y.length===L.picks){const ce=Y.slice(1);return ce.push(U),ce}return Y})},G=async()=>{if(!R||g||f.length!==L.picks)return;y(!0);const U=[...f];m([]);for(const Q of U)d(Y=>[...Y,Q]),await new Promise(Y=>setTimeout(Y,300));y(!1),i(Q=>Q+1)};re.useEffect(()=>{O&&!g&&l<si.length&&(async()=>{y(!0),await new Promise(ge=>setTimeout(ge,100));const Q=[],Y=b.filter(ge=>{if(Z.has(ge))return!1;const Fe=I(ge);return H.has(Fe)}),ce=b.filter(ge=>!Z.has(ge)),te=Y.length>=L.picks?[...Y]:[...ce],ye=[],Se=Q.filter(ge=>te.includes(ge));for(let ge=0;ge<L.picks;ge++)if(Se.length>0){const Fe=Se.shift();ye.push(Fe);const Le=te.indexOf(Fe);Le>-1&&te.splice(Le,1)}else if(te.length>0){const Fe=Math.floor(Math.random()*te.length);ye.push(te.splice(Fe,1)[0])}for(const ge of ye)await new Promise(Fe=>setTimeout(Fe,1e3)),_(ge),await new Promise(Fe=>setTimeout(Fe,1e3)),_(null),h(Fe=>[...Fe,ge]);y(!1),i(ge=>ge+1)})()},[l,O,g,Z,L,H,b,I]),re.useEffect(()=>{l>=si.length&&!g&&setTimeout(()=>{n(c,p)},1e3)},[l,g,n,c,p]);const K=U=>{const Q=["protocol-card",`card-protocol-${U.toLowerCase()}`];return f.includes(U)&&Q.push("selected"),Z.has(U)&&Q.push("chosen"),w===U&&Q.push("is-scanning"),Q.join(" ")},W=()=>g&&O?"Opponent is selecting protocols...":(L==null?void 0:L.player)==="Player"?`Player, select ${L.picks} protocol(s). (${f.length}/${L.picks})`:l>=si.length?"Finalizing selections...":"Waiting for Opponent...";return o.jsxs("div",{className:"screen protocol-selection-screen",children:[o.jsx(gi,{title:"Protocol Selection",onBack:a}),o.jsxs("div",{className:"protocol-selection-layout",children:[o.jsxs("div",{className:"protocol-selection-sidebar",children:[o.jsxs("div",{className:"player-protocols-area",children:[o.jsx("h3",{children:"Your Protocols"}),c.map(U=>o.jsx("div",{className:`protocol-display-card player card-protocol-${U.toLowerCase()} ${N(U)}`,style:F(U),children:U},U))]}),o.jsx("div",{className:"protocol-preview-area",children:S?o.jsx(Ct,{card:{...S,id:"preview",isFaceUp:!0},isFaceUp:!0}):o.jsx("p",{children:ee.length>0?"Hover over a card below to see details.":"Select a protocol to see its cards."})})]}),o.jsxs("div",{className:"protocol-grid-container",children:[o.jsx("p",{children:W()}),o.jsx("div",{className:"category-filters",children:T.map(U=>o.jsxs("label",{className:"category-filter-item",children:[o.jsx("input",{type:"checkbox",checked:H.has(U),onChange:()=>P(U)}),o.jsx("span",{children:U})]},U))}),o.jsx("div",{className:"protocol-grid-scroll-wrapper",children:o.jsx("div",{className:"protocol-grid",children:D.map(U=>{const Q=F(U),ce={fontSize:U.length>10?"0.65em":"1em"};return o.jsxs("div",{className:`${K(U)} ${N(U)}`,style:Q,onClick:()=>M(U),role:"button","aria-disabled":Z.has(U)||!R||g,tabIndex:!Z.has(U)&&R&&!g?0:-1,onKeyPress:te=>te.key==="Enter"&&M(U),children:[o.jsx("span",{className:"protocol-category-label",children:I(U)}),o.jsx("span",{className:"protocol-name",style:ce,children:U})]},U)})})}),R&&o.jsx("button",{className:"btn",onClick:G,disabled:g||f.length!==(L==null?void 0:L.picks),children:"Confirm Selection"})]}),o.jsxs("div",{className:"opponent-protocols-area",children:[o.jsx("h3",{children:"Opponent Protocols"}),p.map(U=>o.jsx("div",{className:`protocol-display-card opponent card-protocol-${U.toLowerCase()} ${N(U)}`,style:F(U),children:U},U))]})]}),o.jsx("div",{className:"selected-protocol-cards-container",children:ee.length>0&&[...ee].reverse().map(U=>o.jsx("div",{className:"protocol-card-row",children:U.cards.map(Q=>o.jsx(Ct,{card:{...Q,id:`selection-${Q.protocol}-${Q.value}`,isFaceUp:!0},isFaceUp:!0,additionalClassName:"in-hand",onClick:()=>k(Q),onPointerEnter:()=>k(Q)},`${U.name}-${Q.value}`))},U.name))})]})}const N_="modulepreload",R_=function(a){return"/"+a},Sh={},A_=function(n,l,i){let c=Promise.resolve();if(l&&l.length>0){let p=function(m){return Promise.all(m.map(g=>Promise.resolve(g).then(y=>({status:"fulfilled",value:y}),y=>({status:"rejected",reason:y}))))};document.getElementsByTagName("link");const h=document.querySelector("meta[property=csp-nonce]"),f=(h==null?void 0:h.nonce)||(h==null?void 0:h.getAttribute("nonce"));c=p(l.map(m=>{if(m=R_(m),m in Sh)return;Sh[m]=!0;const g=m.endsWith(".css"),y=g?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${m}"]${y}`))return;const w=document.createElement("link");if(w.rel=g?"stylesheet":N_,g||(w.as="script"),w.crossOrigin="",w.href=m,f&&w.setAttribute("nonce",f),document.head.appendChild(w),g)return new Promise((_,S)=>{w.addEventListener("load",_),w.addEventListener("error",()=>S(new Error(`Unable to preload CSS for ${m}`)))})}))}function d(p){const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=p,window.dispatchEvent(h),!h.defaultPrevented)throw p}return c.then(p=>{for(const h of p||[])h.status==="rejected"&&d(h.reason);return n().catch(d)})},Xt=[];for(let a=0;a<256;++a)Xt.push((a+256).toString(16).slice(1));function D_(a,n=0){return(Xt[a[n+0]]+Xt[a[n+1]]+Xt[a[n+2]]+Xt[a[n+3]]+"-"+Xt[a[n+4]]+Xt[a[n+5]]+"-"+Xt[a[n+6]]+Xt[a[n+7]]+"-"+Xt[a[n+8]]+Xt[a[n+9]]+"-"+Xt[a[n+10]]+Xt[a[n+11]]+Xt[a[n+12]]+Xt[a[n+13]]+Xt[a[n+14]]+Xt[a[n+15]]).toLowerCase()}let wd;const T_=new Uint8Array(16);function F_(){if(!wd){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");wd=crypto.getRandomValues.bind(crypto)}return wd(T_)}const q_=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),jh={randomUUID:q_};function Qe(a,n,l){var c;if(jh.randomUUID&&!a)return jh.randomUUID();a=a||{};const i=a.random??((c=a.rng)==null?void 0:c.call(a))??F_();if(i.length<16)throw new Error("Random bytes length must be >= 16");return i[6]=i[6]&15|64,i[8]=i[8]&63|128,D_(i)}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const ae=(a,n,l,i)=>{let c=a._logIndentLevel||0;a._currentPhaseContext&&c===0&&(c=1);const d={player:n,message:l,indentLevel:c,sourceCard:a._currentEffectSource,phase:a._currentPhaseContext,sourceCardRef:i==null?void 0:i.sourceCardRef,targetCardRefs:i==null?void 0:i.targetCardRefs};return{...a,log:[...a.log,d]}},ya=a=>({...a,_logIndentLevel:(a._logIndentLevel||0)+1}),_o=a=>({...a,_logIndentLevel:Math.max(0,(a._logIndentLevel||0)-1)}),Be=(a,n)=>({...a,_currentEffectSource:n}),rt=(a,n)=>({...a,_currentPhaseContext:n});/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function gn(a){const n=[];for(const l of["player","opponent"])a[l].lanes.forEach((i,c)=>{i.forEach((d,p)=>{if(d.isFaceUp){const h=d;if(h.customEffects){const f=p===i.length-1;(h.customEffects.topEffects||[]).forEach(y=>{y.params.action==="passive_rule"&&y.trigger==="passive"&&n.push({rule:y.params.rule,cardOwner:l,laneIndex:c,sourceCardId:d.id})}),(h.customEffects.middleEffects||[]).forEach(y=>{y.params.action==="passive_rule"&&y.trigger==="passive"&&n.push({rule:y.params.rule,cardOwner:l,laneIndex:c,sourceCardId:d.id})}),f&&(h.customEffects.bottomEffects||[]).forEach(w=>{w.params.action==="passive_rule"&&w.trigger==="passive"&&n.push({rule:w.params.rule,cardOwner:l,laneIndex:c,sourceCardId:d.id})})}d.protocol==="Frost"&&d.value===1&&(n.push({rule:{type:"block_flips",target:"all",scope:"global"},cardOwner:l,laneIndex:c}),p===i.length-1&&n.push({rule:{type:"block_protocol_rearrange",target:"all",scope:"global"},cardOwner:l,laneIndex:c})),d.protocol==="Frost"&&d.value===3&&n.push({rule:{type:"block_shifts_from_and_to_lane",target:"all",scope:"this_lane"},cardOwner:l,laneIndex:c})}})});return n}function Pa(a,n,l,i,c,d){var S,k,j;const p=gn(a),h=n==="player"?"opponent":"player",f=a[n].protocols[l],m=a[h].protocols[l],g=c===f||c===m;let y=!1;if(d){const E=d;y=[...((S=E.customEffects)==null?void 0:S.topEffects)||[],...((k=E.customEffects)==null?void 0:k.middleEffects)||[],...((j=E.customEffects)==null?void 0:j.bottomEffects)||[]].some(b=>{var T,A,H;return((T=b.params)==null?void 0:T.action)==="passive_rule"&&((H=(A=b.params)==null?void 0:A.rule)==null?void 0:H.type)==="allow_play_on_opponent_side"})}for(const{rule:E,cardOwner:C,laneIndex:b}of p){const T=E.scope==="global"||b===l,A=E.target==="all"||E.target==="self"&&C===n||E.target==="opponent"&&C===h;if(!(!T||!A))switch(E.type){case"block_all_play":return{allowed:!1,reason:"Cannot play cards in this lane (passive rule)"};case"block_face_down_play":if(!i)return{allowed:!1,reason:"Cannot play cards face-down in this lane (passive rule)"};break;case"block_face_up_play":if(i)return{allowed:!1,reason:"Cannot play cards face-up in this lane (passive rule)"};break;case"require_face_down_play":if(i)return{allowed:!1,reason:"Can only play cards face-down (passive rule)"};break;case"allow_any_protocol_play":break;case"require_non_matching_protocol":if(i&&g)return{allowed:!1,reason:"Can only play cards without matching protocols (passive rule)"};break}}const w=p.some(({rule:E,cardOwner:C,laneIndex:b})=>{if(E.type!=="allow_any_protocol_play")return!1;const T=E.scope==="global"||b===l,A=E.target==="all"||E.target==="self"&&C===n||E.target==="opponent"&&C===h;return T&&A}),_=p.some(({rule:E,cardOwner:C,laneIndex:b})=>{if(E.type!=="require_non_matching_protocol")return!1;const T=E.scope==="global"||b===l,A=E.target==="all"||E.target==="self"&&C===n||E.target==="opponent"&&C===h;return T&&A});return i&&!g&&!w&&!_&&!y?{allowed:!1,reason:"Face-up play requires matching protocol"}:{allowed:!0}}function vi(a){return gn(a).some(({rule:l})=>l.type==="require_non_matching_protocol"&&l.scope==="global")}function _i(a,n,l){const i=gn(a),c=n==="player"?"opponent":"player";return i.some(({rule:d,cardOwner:p,laneIndex:h})=>{if(d.type!=="allow_any_protocol_play")return!1;const f=d.scope==="global"||l!==void 0&&h===l,m=d.target==="all"||d.target==="self"&&p===n||d.target==="opponent"&&p===c;return f&&m})}function Wl(a,n){const l=n.customEffects;return l?(l.bottomEffects||[]).some(c=>{var d,p,h;return((d=c.params)==null?void 0:d.action)!=="passive_rule"?!1:((h=(p=c.params)==null?void 0:p.rule)==null?void 0:h.type)==="allow_play_on_opponent_side"}):!1}function $_(a,n){const l=gn(a);for(const{rule:i,laneIndex:c}of l)if(!(i.type!=="block_flips"||!(i.scope==="global"||c===n)))return{allowed:!1,reason:"Cards cannot be flipped face-up in this lane (passive rule)"};return{allowed:!0}}function Ql(a,n,l){const i=gn(a);for(const{rule:c,laneIndex:d}of i){if(c.type==="block_shifts_from_lane"&&d===n)return c.scope,{allowed:!1,reason:"Cards cannot shift from this lane (passive rule)"};if(c.type==="block_shifts_to_lane"&&d===l)return c.scope,{allowed:!1,reason:"Cards cannot shift to this lane (passive rule)"};if(c.type==="block_shifts_from_and_to_lane"&&(d===n||d===l))return{allowed:!1,reason:"Cards cannot shift from or to this lane (passive rule)"}}return{allowed:!0}}function U_(a){const n=gn(a);for(const{rule:l}of n)if(l.type==="block_protocol_rearrange")return{allowed:!1,reason:"Protocols cannot be rearranged (passive rule)"};return{allowed:!0}}function O_(a,n,l){const i=gn(a),c=a.turn;for(const{rule:d,cardOwner:p,laneIndex:h,sourceCardId:f}of i)if(!(d.type!=="ignore_middle_commands"||!(d.scope==="global"||h===n))&&!(d.onlyDuringYourTurn&&c!==p)){if(l!==void 0){const g=p==="player"?"opponent":"player";if(d.target==="opponent"&&l!==g||d.target==="self"&&l!==p)continue}if(f)for(const g of["player","opponent"])for(const y of a[g].lanes){const w=y.find(_=>_.id===f);if(w)return w}return null}return null}function ma(a){return gn(a).some(({rule:l})=>l.type==="block_flips"&&l.scope==="global")}function I_(a){return gn(a).some(({rule:l})=>l.type==="block_protocol_rearrange")}function Yl(a,n){const l=gn(a);for(const{rule:i,sourceCardId:c}of l)if(i.type==="block_flip_this_card"&&c===n)return{allowed:!1,reason:"This card cannot be flipped (passive rule)"};return{allowed:!0}}function Pd(a,n){const l=gn(a);for(const{rule:i,cardOwner:c}of l)if(i.type==="block_draw_conditional"){const p=(i.conditionTarget||"self")==="self"?c:c==="player"?"opponent":"player",h=i.blockTarget||"self";let f;if(h==="self"?f=c:h==="opponent"?f=c==="player"?"opponent":"player":f="all",a[p].hand.length>0&&(f==="all"||f===n))return{allowed:!1,reason:"Cannot draw cards (passive rule)"}}return{allowed:!0}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const P_={},L_={},M_={},H_={};function Zl(a,n,l,i){const{cardOwner:c,opponent:d,triggerType:p}=i,h=l[c].lanes[n];if(!h.find(S=>S.id===a.id))return{newState:l};if(!(p==="uncover"||h.length>0&&h[h.length-1].id===a.id))return{newState:l};const g=O_(l,n,c);if(g){const S=`${a.protocol}-${a.value}`,k=`${g.protocol}-${g.value}`;return{newState:ae(l,c,`${S}: Effect blocked by ${k}.`)}}const y=a;if(y.customEffects&&y.customEffects.middleEffects&&y.customEffects.middleEffects.length>0){let S=ya(l);const k=`${a.protocol}-${a.value}`;S=Be(S,k),S=rt(S,"middle");let j=S;const E=j._pendingCustomEffects;if(E&&E.sourceCardId!==a.id){const b=j.lastCustomEffectTargetCardId,T={type:"execute_remaining_custom_effects",sourceCardId:E.sourceCardId,laneIndex:E.laneIndex,effects:E.effects,context:E.context,actor:E.context.cardOwner,selectedCardFromPreviousEffect:b||E.selectedCardFromPreviousEffect,logSource:E.logSource,logPhase:E.logPhase,logIndentLevel:E.logIndentLevel};j={...j,queuedActions:[...j.queuedActions||[],T]},delete j._pendingCustomEffects}j.lastCustomEffectTargetCardId&&(j={...j,lastCustomEffectTargetCardId:null});for(let b=0;b<y.customEffects.middleEffects.length;b++){const T=y.customEffects.middleEffects[b],A=y.customEffects.middleEffects.slice(b+1);if(A.length>0&&(j._pendingCustomEffects={sourceCardId:a.id,laneIndex:n,context:i,effects:A,logSource:j._currentEffectSource,logPhase:j._currentPhaseContext,logIndentLevel:j._logIndentLevel||0}),j=st(a,n,j,i,T).newState,j.actionRequired)return{newState:xe(j)};j._pendingCustomEffects&&delete j._pendingCustomEffects}return{newState:xe(j)}}const w=`${a.protocol}-${a.value}`,_=P_[w];if(_){let S=ya(l);const k=`${a.protocol}-${a.value}`;S=Be(S,k),S=rt(S,"middle");const j=_(a,n,S,i);let E=j.newState;const C=xe(E);return{...j,newState:C}}return{newState:l}}function Ld(a,n,l,i){if(!a.isFaceUp)return{newState:l};const c=a;if(c.customEffects){const f=[...c.customEffects.topEffects||[],...c.customEffects.middleEffects||[],...c.customEffects.bottomEffects||[]].filter(m=>m.trigger==="on_cover"||m.trigger==="on_cover_or_flip");if(f.length>0){const m=`${a.protocol}-${a.value}`;let g=Be(l,m);g=rt(g,"oncover");let y=g;const w=[];for(const S of f){const k=st(a,n,y,i,S);if(y=k.newState,k.animationRequests&&w.push(...k.animationRequests),y.actionRequired)return{newState:xe(y),animationRequests:w.length>0?w:void 0}}return{newState:xe(y),animationRequests:w.length>0?w:void 0}}}const d=`${a.protocol}-${a.value}`,p=H_[d];if(p){const h=`${a.protocol}-${a.value}`;let f=Be(l,h);f=rt(f,"oncover");const m=p(a,n,f,i),g=xe(m.newState);return{...m,newState:g}}return{newState:l}}function z_(a,n,l){const i=[],c=new Set,d=l==="Start"?"start":"end";return a[n].lanes.flat().forEach(p=>{var f;if(!p.isFaceUp||c.has(p.id))return;const h=p;if((f=h.customEffects)!=null&&f.topEffects){const m=h.customEffects.topEffects.filter(g=>g.trigger===d);m.length>0&&(i.push({cardId:p.id,box:"top",effectIds:m.map(g=>g.id)}),c.add(p.id))}p.top.includes(`'emphasis'>${l}:`)&&(c.has(p.id)||(i.push({cardId:p.id,box:"top",effectIds:[]}),c.add(p.id)))}),a[n].lanes.forEach(p=>{var m;if(p.length===0)return;const h=p[p.length-1];if(!h.isFaceUp||c.has(h.id))return;const f=h;if((m=f.customEffects)!=null&&m.bottomEffects){const g=f.customEffects.bottomEffects.filter(y=>y.trigger===d);g.length>0&&(i.push({cardId:h.id,box:"bottom",effectIds:g.map(y=>y.id)}),c.add(h.id))}h.bottom.includes(`'emphasis'>${l}:`)&&(c.has(h.id)||(i.push({cardId:h.id,box:"bottom",effectIds:[]}),c.add(h.id)))}),i}function V_(a,n,l){for(let i=0;i<a[n].lanes.length;i++){const c=a[n].lanes[i],d=c.find(p=>p.id===l.cardId);if(d)return!d.isFaceUp||l.box==="bottom"&&!(c.length>0&&c[c.length-1].id===d.id)?null:{card:d,laneIndex:i}}return null}function B_(a,n,l){const i=a,c=l==="Start"?"start":"end";if(i.customEffects){const h=n==="top"?i.customEffects.topEffects:i.customEffects.bottomEffects,f=(h==null?void 0:h.filter(m=>m.trigger===c))||[];if(f.length>0)return f.map(g=>{var _,S;const y=((_=g.params)==null?void 0:_.action)||"effect",w=(S=g.params)==null?void 0:S.count;return w?`${y} ${w}`:y}).join(", ")}const p=(n==="top"?a.top:a.bottom).match(new RegExp(`${l}:\\s*</span>\\s*([^<]+)`,"i"));return p?p[1].trim():l+" effect"}function fi(a,n,l){const i=a.turn;let c={...a,_logIndentLevel:0};const d=n==="Start",p=d?"_startPhaseEffectSnapshot":"_endPhaseEffectSnapshot",h=d?"_selectedStartEffectId":"_selectedEndEffectId",f=c[h];let m=c[p];m&&m.length>0&&(m.some($=>c[i].lanes.flat().some(B=>B.id===$.cardId))||(m=void 0,c[p]=void 0)),m||(m=z_(c,i,n),c[p]=m);const g=d?c.processedStartEffectIds||[]:c.processedEndEffectIds||[],y=[];for(const H of m){if(g.includes(H.cardId))continue;const B=V_(c,i,H);B&&y.push({entry:H,card:B.card,laneIndex:B.laneIndex})}if(y.length===0)return c[p]=void 0,c[h]=void 0,{newState:c};let w;if(f&&(w=y.find(H=>H.entry.cardId===f),w||console.warn(`[processTriggeredEffects] Selected effect ${f} not found in valid effects!`),c[h]=void 0),!w){if(y.length>1){const H=y.map(({entry:$,card:B})=>({cardId:$.cardId,cardName:`${B.protocol}-${B.value}`,box:$.box,effectDescription:B_(B,$.box,n)}));return c.actionRequired={type:"select_phase_effect",actor:i,phase:n,availableEffects:H},{newState:c}}w=y[0]}const{entry:_,card:S,laneIndex:k}=w,j=i==="player"?"opponent":"player",E={cardOwner:i,actor:i,currentTurn:a.turn,opponent:j,triggerType:n==="Start"?"start":"end"},C=S,b=n==="Start"?"start":"end";if(C.customEffects){const H=_.box==="top"?C.customEffects.topEffects:C.customEffects.bottomEffects,$=(H==null?void 0:H.filter(B=>B.trigger===b))||[];if($.length>0){const B=`${S.protocol}-${S.value}`,X=n==="Start"?"start":"end";c=Be(c,B),c=rt(c,X);const I={...c,_currentPhaseContext:void 0},F=ae(I,i,`${n} effect triggers.`);c={...c,log:F.log},c=ya(c);for(let N=0;N<$.length;N++){const D=$[N],P=st(S,k,c,E,D);if(c=xe(P.newState),c.actionRequired){const L=$.slice(N+1);return L.length>0&&(c._pendingCustomEffects={sourceCardId:S.id,laneIndex:k,context:E,effects:L,logSource:c._currentEffectSource,logPhase:c._currentPhaseContext,logIndentLevel:c._logIndentLevel||0}),d?c.processedStartEffectIds=[...c.processedStartEffectIds||[],S.id]:c.processedEndEffectIds=[...c.processedEndEffectIds||[],S.id],{newState:c}}}return d?c.processedStartEffectIds=[...c.processedStartEffectIds||[],S.id]:c.processedEndEffectIds=[...c.processedEndEffectIds||[],S.id],c=_o(c),c=Be(c,void 0),c=rt(c,void 0),fi(c,n,l)}}const T=`${S.protocol}-${S.value}`,A=l[T];if(A){const H=`${S.protocol}-${S.value}`,$=n==="Start"?"start":"end";c=Be(c,H),c=rt(c,$);const B={...c,_currentPhaseContext:void 0},X=ae(B,i,`${n} effect triggers.`);c={...c,log:X.log},c=ya(c);const I=A(S,c,E);return c=xe(I.newState),d?c.processedStartEffectIds=[...c.processedStartEffectIds||[],S.id]:c.processedEndEffectIds=[...c.processedEndEffectIds||[],S.id],c.actionRequired?{newState:c}:(c=_o(c),c=Be(c,void 0),c=rt(c,void 0),fi(c,n,l))}return{newState:c}}function Md(a){return fi(a,"Start",L_)}function Xh(a){return fi(a,"End",M_)}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Y_=a=>{if(!a.useControlMechanic)return a;const n=a.turn,l=n==="player"?"opponent":"player",i=a[n],c=a[l];let d=0;const p=i.laneValues[0],h=i.laneValues[1],f=i.laneValues[2],m=c.laneValues[0],g=c.laneValues[1],y=c.laneValues[2];if(p>m&&d++,h>g&&d++,f>y&&d++,d>=2&&a.controlCardHolder!==n){let w=Be(a,void 0);return w=rt(w,void 0),w={...w,_logIndentLevel:0},w=ae(w,n,`${n==="player"?"Player":"Opponent"} gains the Control Component.`),{...w,controlCardHolder:n}}return a},Mr=a=>{if(a.winner)return a;const n=a.turn;let l={...a};switch(l=Be(l,void 0),l=rt(l,void 0),l={...l,_logIndentLevel:0},a.phase){case"start":return l=Md(l).newState,l.actionRequired?l:(l=Be(l,void 0),l=rt(l,void 0),l={...l,_logIndentLevel:0},l._startPhaseEffectSnapshot=void 0,{...l,phase:"control"});case"control":{const i=Y_(l);let c=Be(i,void 0);return c=rt(c,void 0),c={...c,_logIndentLevel:0},{...c,phase:"compile"}}case"compile":{const i=nm(l,n);return i.length>0?{...l,compilableLanes:i}:(l=Be(l,void 0),l=rt(l,void 0),l={...l,_logIndentLevel:0},{...l,phase:"action",compilableLanes:[]})}case"action":return l=Be(l,void 0),l=rt(l,void 0),l={...l,_logIndentLevel:0},{...l,phase:"hand_limit"};case"hand_limit":{const i=l[n],c=i.lanes.some(h=>h.length>0&&h[h.length-1].isFaceUp&&h[h.length-1].protocol==="Spirit"&&h[h.length-1].value===0),p=gn(l).some(({rule:h,cardOwner:f})=>h.type==="skip_check_cache_phase"&&(h.target==="self"&&f===n||h.target==="all")&&f===n);if(c||p){let h=ae(l,n,"Skipping Check Cache phase.");return h=Be(h,void 0),h=rt(h,void 0),h={...h,_logIndentLevel:0},{...h,phase:"end"}}if(i.hand.length>5){const h=i.hand.length-5;let m=ae(l,n,`Check Cache: ${n==="player"?"Player":"Opponent"} has ${i.hand.length} cards, must discard ${h}.`);return m=ya(m),{...m,actionRequired:{type:"discard",actor:n,count:h}}}return l=Be(l,void 0),l=rt(l,void 0),l={...l,_logIndentLevel:0},{...l,phase:"end"}}case"end":{const i={...l};l=Xh(l).newState;const c=i.actionRequired,d=l.actionRequired;if(d&&d!==c||l.queuedActions&&l.queuedActions.length>0&&(l=Hr(l),l.actionRequired))return l;const p=n==="player"?"opponent":"player",h={...l[n],cannotCompile:!1};return l=Be(l,void 0),l=rt(l,void 0),l={...l,_logIndentLevel:0},l=xe(l),{...l,[n]:h,turn:p,phase:"start",processedStartEffectIds:[],processedEndEffectIds:[],processedSpeed1TriggerThisTurn:!1,processedUncoverEventIds:[],_startPhaseEffectSnapshot:void 0,_endPhaseEffectSnapshot:void 0,_interruptedTurn:void 0,_interruptedPhase:void 0}}}return a};function Ke(a){var p;const n=a._pendingCustomEffects;if(!n||n.effects.length===0)return a;const l=n.effects.map(h=>h.id).join(",");if((p=a.queuedActions)==null?void 0:p.some(h=>{var f;return h.type==="execute_remaining_custom_effects"&&h.sourceCardId===n.sourceCardId&&((f=h.effects)==null?void 0:f.map(m=>m.id).join(","))===l})){const h={...a};return delete h._pendingCustomEffects,h}const c={type:"execute_remaining_custom_effects",sourceCardId:n.sourceCardId,laneIndex:n.laneIndex,effects:n.effects,context:n.context,actor:n.context.cardOwner,selectedCardFromPreviousEffect:n.selectedCardFromPreviousEffect,logSource:n.logSource,logPhase:n.logPhase,logIndentLevel:n.logIndentLevel},d={...a,queuedActions:[...a.queuedActions||[],c]};return delete d._pendingCustomEffects,d}const La=a=>{let n=Ke(a);if(!n.queuedActions||n.queuedActions.length===0)return n;let l=[...n.queuedActions];for(;l.length>0;){const i=l.shift();if(i.sourceCardId&&i.type!=="flip_self"){const c=ve(n,i.sourceCardId);if(!c||!c.card.isFaceUp){const d=c?`${c.card.protocol}-${c.card.value}`:"a card",p=n._logSource;n=Be(n,d),n=ae(n,i.actor,"Queued effect was cancelled because the source is no longer active."),n=Be(n,p);continue}}if(i.type==="flip_self"){const{sourceCardId:c,actor:d}=i,p=ve(n,c),h=vo(n,c);if(p&&p.card.isFaceUp&&h){const f=`${p.card.protocol}-${p.card.value}`;n=ae(n,d,`${f}: Flips itself.`),n=Wo(new Set([c]),n),n.animationState={type:"flipCard",cardId:c}}else{const f=p?`${p.card.protocol}-${p.card.value}`:"the source card",m=p?p.card.isFaceUp?"now covered":"flipped face-down":"deleted";n=ae(n,d,`The self-flip effect from ${f} was cancelled because it is ${m}.`)}continue}if(i.type==="execute_follow_up_effect"){const{sourceCardId:c,followUpEffect:d,actor:p,logContext:h}=i,f=ve(n,c),m=vo(n,c);if(f&&f.card.isFaceUp&&m){const g=n[f.owner].lanes.find(j=>j.some(E=>E.id===c)),y=n[f.owner].lanes.indexOf(g),w={cardOwner:f.owner,actor:p,currentTurn:n.turn,opponent:f.owner==="player"?"opponent":"player"},_=(h==null?void 0:h.sourceCardName)||`${f.card.protocol}-${f.card.value}`,S=(h==null?void 0:h.phase)||(n.phase==="start"?"start":"end");if(n={...n,_logIndentLevel:(h==null?void 0:h.indentLevel)||1,_currentEffectSource:_,_currentPhaseContext:S},n=st(f.card,y,n,w,d).newState,n.actionRequired)return n={...n,queuedActions:l},n}else{const g=f?`${f.card.protocol}-${f.card.value}`:"the source card",y=f?f.card.isFaceUp?"now covered":"flipped face-down":"deleted";n=ae(n,p,`The follow-up effect from ${g} was cancelled because it is ${y}.`)}continue}if(i.type==="execute_conditional_followup"){const{sourceCardId:c,laneIndex:d,followUpEffect:p,context:h,actor:f}=i,m=[...n.player.lanes.flat(),...n.opponent.lanes.flat()].find(y=>y.id===c);if(!m){n=ae(n,f,"Conditional follow-up effect skipped: source card no longer exists.");continue}if(!m.isFaceUp){const y=`${m.protocol}-${m.value}`;n=ae(n,f,`Conditional follow-up effect from ${y} cancelled: card was flipped face-down.`);continue}const g=st(m,d,n,h,p);if(n=xe(g.newState),n.actionRequired)return p.conditional&&p.conditional.thenEffect&&(n.actionRequired={...n.actionRequired,followUpEffect:p.conditional.thenEffect,conditionalType:p.conditional.type}),n={...n,queuedActions:l},n;if(p.conditional&&p.conditional.thenEffect){const y=st(m,d,n,h,p.conditional.thenEffect);if(n=xe(y.newState),n.actionRequired)return n={...n,queuedActions:l},n}continue}if(i.type==="execute_remaining_custom_effects"){const{sourceCardId:c,laneIndex:d,effects:p,context:h,selectedCardFromPreviousEffect:f,logSource:m,logPhase:g,logIndentLevel:y}=i;m!==void 0&&(n={...n,_currentEffectSource:m}),g!==void 0&&(n={...n,_currentPhaseContext:g}),y!==void 0&&(n={...n,_logIndentLevel:y});const w=ve(n,c);if(!w){n=ae(n,h.cardOwner,"Remaining effects cancelled because the source card was deleted or returned.");continue}if(!w.card.isFaceUp){const S=`${w.card.protocol}-${w.card.value}`;n=ae(n,h.cardOwner,`Remaining effects from ${S} cancelled because it was flipped face-down.`);continue}if(!G_(n,c)){const S=`${w.card.protocol}-${w.card.value}`;n=ae(n,h.cardOwner,`Remaining effects from ${S} cancelled because it is now covered.`);continue}f&&(n._selectedCardFromPreviousEffect=f,n.lastCustomEffectTargetCardId=f);for(let S=0;S<p.length;S++){const k=p[S],j=st(w.card,d,n,h,k);if(n=j.newState,j.animationRequests&&j.animationRequests.length>0&&!n.actionRequired){const E=p.slice(S+1);if(E.length>0){const b={type:"execute_remaining_custom_effects",sourceCardId:c,laneIndex:d,effects:E,context:h,actor:h.cardOwner,logSource:n._currentEffectSource,logPhase:n._currentPhaseContext,logIndentLevel:n._logIndentLevel||0};n.queuedActions=[b,...l||[]]}else n.queuedActions=l;const C=j.animationRequests[0];return C.type==="draw"?n.animationState={type:"drawCard",owner:C.player,cardIds:[]}:C.type==="play"?n.animationState={type:"playCard",cardId:C.cardId,owner:C.owner}:C.type==="delete"&&(n.animationState={type:"deleteCard",cardId:C.cardId,owner:C.owner}),n}if(n.actionRequired){const E=p.slice(S+1);if(E.length>0&&(n._pendingCustomEffects={sourceCardId:c,laneIndex:d,context:h,effects:E,logSource:n._currentEffectSource,logPhase:n._currentPhaseContext,logIndentLevel:n._logIndentLevel||0}),n._interruptedTurn){const C=n._interruptedTurn,b=n._interruptedPhase||n.phase;delete n._interruptedTurn,delete n._interruptedPhase,n.turn=C,n.phase=b}return n.queuedActions=l,n}}continue}if(i.type==="reveal_opponent_hand"){const c=n.turn==="player"?"opponent":"player",d={...n[c]};if(d.hand.length>0){d.hand=d.hand.map(f=>({...f,isRevealed:!0})),n[c]=d;const p=ve(n,i.sourceCardId),h=p?`${p.card.protocol}-${p.card.value}`:"A card effect";n=ae(n,n.turn,`${h}: Opponent reveals their hand.`)}else{const p=ve(n,i.sourceCardId),h=p?`${p.card.protocol}-${p.card.value}`:"A card effect";n=ae(n,n.turn,`${h}: Opponent has no cards to reveal.`)}continue}if(i.type==="pending_uncover_effect"){const{owner:c,laneIndex:d}=i;if(n=Rn(n,c,d).newState,n.actionRequired)return n.queuedActions=l,n;continue}return n.actionRequired=i,n.queuedActions=l,n}return{...n,queuedActions:[],actionRequired:null}},Hr=a=>{var c;if(a.winner||a.actionRequired)return a;if(a.queuedActions&&a.queuedActions.length>0){const d=La(a);if(d.actionRequired)return d;a=d}if(a._interruptedTurn){const d=a._interruptedTurn,p=a._interruptedPhase||a.phase;let h={...a};if(delete h._interruptedTurn,delete h._interruptedPhase,h.turn=d,h.phase=p,p==="start"||p==="end"){if(h.queuedActions&&h.queuedActions.length>0&&(h=La(h)),!h.actionRequired&&p==="end"){const f=Xh(h).newState;if(f.actionRequired)return f;const m=f.turn==="player"?"opponent":"player",g={...f[f.turn],cannotCompile:!1};let y=Be(f,void 0);return y=rt(y,void 0),y={...y,_logIndentLevel:0},y=xe(y),{...y,[f.turn]:g,turn:m,phase:"start",processedStartEffectIds:[],processedEndEffectIds:[],processedSpeed1TriggerThisTurn:!1,processedUncoverEventIds:[],_startPhaseEffectSnapshot:void 0,_endPhaseEffectSnapshot:void 0,_interruptedTurn:void 0,_interruptedPhase:void 0}}if(p==="start"&&!h.actionRequired){const f=Md(h).newState;if(f.actionRequired)return f;let m={...f,phase:"control"};return Pr(m)}return h}a=h}if(((c=a.actionRequired)==null?void 0:c.type)==="prompt_rearrange_protocols"&&a.actionRequired.originalAction){const d=a.actionRequired.originalAction;let p={...a,actionRequired:null,controlCardHolder:null};if(d.type==="compile")return Pr(p);if(d.type==="fill_hand"){const h=Xo(p,p.turn,5-p[p.turn].hand.length);return Pr(h)}}if(a.queuedEffect){const{card:d,laneIndex:p}=a.queuedEffect,h={...a,queuedEffect:void 0,_committedCardId:void 0},f=ve(h,d.id);if(f){const{card:m,owner:g}=f;let y={...h,_logIndentLevel:0};const w={cardOwner:g,actor:g,currentTurn:y.turn,opponent:g==="player"?"opponent":"player",triggerType:"play"},{newState:_}=Zl(m,p,y,w);if(_.actionRequired)return _;a=_}else console.warn(`Skipping queued effect for ${d.protocol}-${d.value} as it is no longer on the board.`),a=ae(a,a.turn,`Skipping queued effect for ${d.protocol}-${d.value} as it is no longer on the board.`),a=h}if(a.queuedActions&&a.queuedActions.length>0){let d={...a},p=[...d.queuedActions];for(;p.length>0;){const h=p.shift(),f=h.type==="flip_self";if(h.sourceCardId&&!f){const m=ve(d,h.sourceCardId);if(!m||!m.card.isFaceUp){const g=m?`${m.card.protocol}-${m.card.value}`:"a card",y=d._logSource;d=Be(d,g),d=ae(d,h.actor,"Queued effect was cancelled because the source is no longer active."),d=Be(d,y);continue}}if(f){const{sourceCardId:m,actor:g}=h,y=ve(d,m),w=vo(d,m);if(y&&y.card.isFaceUp&&w){const _=`${y.card.protocol}-${y.card.value}`;d=ae(d,g,`${_}: Flips itself.`),d=Wo(new Set([m]),d),d.animationState={type:"flipCard",cardId:m}}else{const _=y?`${y.card.protocol}-${y.card.value}`:"the source card",S=y?y.card.isFaceUp?"now covered":"flipped face-down":"deleted";d=ae(d,g,`The self-flip effect from ${_} was cancelled because it is ${S}.`)}continue}if(h.type==="reveal_opponent_hand"){const m=d.turn==="player"?"opponent":"player",g={...d[m]};if(g.hand.length>0){g.hand=g.hand.map(_=>({..._,isRevealed:!0})),d[m]=g;const y=ve(d,h.sourceCardId),w=y?`${y.card.protocol}-${y.card.value}`:"A card effect";d=ae(d,d.turn,`${w}: Opponent reveals their hand.`)}else{const y=ve(d,h.sourceCardId),w=y?`${y.card.protocol}-${y.card.value}`:"A card effect";d=ae(d,d.turn,`${w}: Opponent has no cards to reveal.`)}continue}return d.actionRequired=h,d.queuedActions=p,d}a={...d,queuedActions:[],actionRequired:null}}const n=a.phase==="action"?"hand_limit":a.phase;let l={...a,phase:n,compilableLanes:[],processedUncoverEventIds:[]};const i=a.turn;for(;l.turn===i&&!l.winner;){const d=l.actionRequired,p=l.phase;l=Mr(l);const h=l.actionRequired;if(h&&h!==d)break;if(l.phase===p&&l.turn===i){console.error("Game is stuck in a phase loop:",l.phase);break}}return l},Pr=a=>{if(a.winner)return a;let n={...a};if(n._interruptedTurn){const i=n._interruptedTurn,c=n._interruptedPhase||n.phase;delete n._interruptedTurn,delete n._interruptedPhase,n.turn=i,n.phase=c}const l=n.turn;for(;n.turn===l&&!n.actionRequired&&!n.winner;){const i=n.phase;if(i==="action")break;if(i==="compile"){const d=nm(n,l);if(d.length>0){n={...n,compilableLanes:d};break}}const c=n.phase;if(n=Mr(n),c===n.phase&&!n.actionRequired){console.error("Game is stuck in an automatic phase loop:",c),console.error("State:",{phase:n.phase,turn:n.turn,actionRequired:n.actionRequired,queuedActions:n.queuedActions,interruptedTurn:n._interruptedTurn});break}}return{...n,animationState:null}},Zh=a=>{let n={...a,actionRequired:null};if(n._interruptedTurn)return Hr(n);if(n.queuedActions&&n.queuedActions.length>0){const c=La(n);if(c.actionRequired)return c;n=c}const l=Md(n).newState;if(l.actionRequired)return l;let i=l;return i.phase!=="control"&&(i={...i,phase:"control"}),i=Mr(i),i.actionRequired||(i=Mr(i)),i},Kh=a=>{if(a.winner)return a;let n={...a,phase:"start"};return n=xe(n),n=Mr(n),n.actionRequired?n:Pr(n)},Eh=Object.freeze(Object.defineProperty({__proto__:null,advancePhase:Mr,continueTurnAfterStartPhaseAction:Zh,continueTurnProgression:Pr,processEndOfAction:Hr,processQueuedActions:La,processStartOfTurn:Kh,queuePendingCustomEffects:Ke},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function ve(a,n){if(!n)return null;for(const l of["player","opponent"])for(let i=0;i<a[l].lanes.length;i++){const d=a[l].lanes[i].find(p=>p.id===n);if(d)return{card:d,owner:l,laneIndex:i}}return null}function vo(a,n){var i;if(!n)return!1;const l=a._committedCardId;for(const c of["player","opponent"])for(const d of a[c].lanes){if(d.length===0)continue;let p=d.length-1;const h=d[d.length-1].id;if(l&&d.length>=2&&h===l&&n!==l&&(p=d.length-2),((i=d[p])==null?void 0:i.id)===n)return!0}return!1}function G_(a,n){if(!n)return!1;for(const l of["player","opponent"])for(const i of a[l].lanes)if(i.length!==0&&i[i.length-1].id===n)return!0;return!1}function xo(a,n){return n?a._committedCardId===n:!1}function wo(a,n,l){if(n.length===0||l<0||l>=n.length)return!1;const i=a._committedCardId;let c=n.length-1;return i&&n.length>=2&&n[n.length-1].id===i&&(c=n.length-2),l===c}function W_(a,n,l){var h;let i={...a};const c=(h=a.actionRequired)==null?void 0:h.followUpEffect,d=ve(i,n),p=d?ea(d.card,i[d.owner].lanes.find(f=>f.some(m=>m.id===n))||[]):0;if(i=Ke(i),i.actionRequired=null,c&&l){const f=ve(i,l);if(f){const m={cardOwner:f.owner,opponent:f.owner==="player"?"opponent":"player",currentTurn:i.turn,actor:f.owner,referencedCard:d==null?void 0:d.card,referencedCardValue:p};let g=-1;for(let y=0;y<i[f.owner].lanes.length;y++)if(i[f.owner].lanes[y].some(w=>w.id===l)){g=y;break}if(g!==-1)return st(f.card,g,i,m,c).newState}}return i}function Jh(a,n,l,i){var _,S,k,j,E;let c={...a};const d=(_=a.actionRequired)==null?void 0:_.followUpEffect,p=(S=a.actionRequired)==null?void 0:S.conditionalType;if(c=Ke(c),c.actionRequired=null,i&&(c=_o(c)),d&&i){const C=ve(c,i);if(C){const b=((k=a.actionRequired)==null?void 0:k.previousHandSize)||0,T=c[n].hand.length,A=Math.max(0,b-T);if(!(p==="then"||p==="if_executed"&&A>0))return c;const $={cardOwner:C.owner,opponent:C.owner==="player"?"opponent":"player",currentTurn:c.turn,actor:n,discardedCount:A,previousHandSize:b};let B=-1;for(let X=0;X<c[C.owner].lanes.length;X++)if(c[C.owner].lanes[X].some(I=>I.id===i)){B=X;break}if(B!==-1)return st(C.card,B,c,$,d).newState}return c}if(!l||!i)return c;const h=((j=a.actionRequired)==null?void 0:j.previousHandSize)||0,f=c[n].hand.length;if(Math.max(0,h-f)===0)return c;const g=(E=ve(c,i))==null?void 0:E.card;g&&`${g.protocol}${g.value}`;const y=c.queuedActions&&c.queuedActions.length>0;let w=null;switch(l){case"fire_1":w={type:"select_cards_to_delete",count:1,sourceCardId:i,disallowedIds:[i],actor:n};break;case"fire_2":w={type:"select_card_to_return",sourceCardId:i,actor:n};break;case"fire_3":w={type:"select_card_to_flip",sourceCardId:i,actor:n,targetFilter:{position:"uncovered",excludeSelf:!0}};break}if(w)if(y){const C=c.queuedActions||[],b=C.filter(A=>A.type==="select_card_to_shift"&&A.followUpEffect),T=C.filter(A=>!(A.type==="select_card_to_shift"&&A.followUpEffect));c.queuedActions=[...T,w,...b]}else c.actionRequired=w;return c}function kd(a,n,l=null){const i=ve(a,n);if(!i)return a;const{card:c,owner:d}=i;if(!c.isFaceUp){let j=-1;for(let E=0;E<a[d].lanes.length;E++)if(a[d].lanes[E].some(C=>C.id===n)){j=E;break}if(j!==-1&&!$_(a,j).allowed)return a}let h=jt(a,"on_flip",{player:d,cardId:n}).newState;if(!ve(h,n))return h;const m=h.actionRequired&&"actor"in h.actionRequired?h.actionRequired.actor:h.turn,g=m==="player"?"Player":"Opponent",y=d==="player"?"Player's":"Opponent's",w=c.isFaceUp?"face-down":"face-up",_=`${c.protocol}-${c.value}`;h=ae(h,m,`${g} flips ${y} ${_} ${w}.`);const S={...h.stats[m],cardsFlipped:h.stats[m].cardsFlipped+1},k={...h[m],stats:S};return h={...h,[m]:k,stats:{...h.stats,[m]:S}},h=Wo(new Set([n]),h),h.animationState={type:"flipCard",cardId:n},h.actionRequired=l,h}function Rn(a,n,l){var p;const i=a[n].lanes[l];if(i.length===0)return{newState:a};const c=i[i.length-1],d=vo(a,c.id);if(c.isFaceUp&&d){const h=`${c.id}-${l}`;if((p=a.processedUncoverEventIds)!=null&&p.includes(h))return{newState:a};const f={source:a._currentEffectSource,phase:a._currentPhaseContext,indentLevel:a._logIndentLevel||0},m=`${c.protocol}-${c.value}`;let g=Be(a,m);g=rt(g,"uncover"),g=ae(g,n,`${c.protocol}-${c.value} is uncovered and its effects are re-triggered.`),g=ya(g),g.processedUncoverEventIds=[...g.processedUncoverEventIds||[],h];const y={cardOwner:n,actor:n,currentTurn:g.turn,opponent:n==="player"?"opponent":"player",triggerType:"uncover"},w=Zl(c,l,g,y);if(w.newState.actionRequired||(w.newState={...w.newState,_currentEffectSource:f.source,_currentPhaseContext:f.phase,_logIndentLevel:f.indentLevel}),w.newState.actionRequired){const _=w.newState.actionRequired.actor;if(a._interruptedTurn&&_===a._interruptedTurn){const S=w.newState.actionRequired;return w.newState.actionRequired=null,w.newState.queuedActions=[...w.newState.queuedActions||[],S],w.newState=Ke(w.newState),w}w.newState=Ke(w.newState),_!==a.turn&&(w.newState._interruptedTurn=a.turn,w.newState._interruptedPhase=a.phase,w.newState.turn=_,w.newState.actionRequired.type==="prompt_rearrange_protocols"&&(w.newState.actionRequired={...w.newState.actionRequired,originalAction:{type:"resume_interrupted_turn",interruptedTurn:a.turn,interruptedPhase:a.phase}}))}else w.newState._interruptedTurn&&(w.newState.turn=w.newState._interruptedTurn,w.newState._interruptedTurn=void 0);return w}return{newState:a}}function Q_(a,n,l){var i,c;for(const d of["player","opponent"])for(const p of a[d].lanes)for(const h of p){if(!h.isFaceUp)continue;const f=h.customEffects;if(!f)continue;const m=f.bottomEffects||[];for(const g of m){if(g.trigger!=="when_card_returned"||((i=g.params)==null?void 0:i.action)!=="redirect_return_to_deck")continue;const y=((c=g.params)==null?void 0:c.targetOwner)||"opponent",w=d;if(y==="opponent"&&n!==w||y==="own"&&n===w)return h}}return null}function Nd(a,n){const l=ve(a,n);if(!l)return{newState:a};const{card:i,owner:c}=l,d=a[c].lanes.findIndex(C=>C.some(b=>b.id===i.id));if(d===-1)return{newState:a};const p=a[c].lanes[d],h=p.length>0&&p[p.length-1].id===n;let f={...a};const m={...f[c]},g=f.actionRequired&&"actor"in f.actionRequired?f.actionRequired.actor:f.turn,y=g==="player"?"Player":"Opponent",w=c==="player"?"Player's":"Opponent's",_=`${i.protocol}-${i.value}`,S=Q_(a,c);if(m.lanes=m.lanes.map(C=>C.filter(b=>b.id!==n)),S){const C={...i,isFaceUp:!1,isRevealed:!1};m.deck=[C,...m.deck],f[c]=m;const b=`${S.protocol}-${S.value}`;f=ae(f,g,`${b}: ${w} ${_} is put on top of their deck face-down instead of returning to hand.`)}else m.hand=[...m.hand,{...i,isFaceUp:!0,isRevealed:!1}],f[c]=m,f=ae(f,g,`${y} returns ${w} ${_} to their hand.`);f=Ke(f);const k={...f.stats[g],cardsReturned:f.stats[g].cardsReturned+1},j={...f[g],stats:k};f={...f,[g]:j},f.actionRequired=null;const E=xe(f);return h&&E[c].lanes[d].length>0?Rn(E,c,d):{newState:E}}function go(a,n,l,i,c){const d=ve(a,n);if(!d||d.owner!==l)return{newState:a};const{card:p}=d,h=a[l];let f=-1;for(let R=0;R<h.lanes.length;R++)if(h.lanes[R].some(O=>O.id===n)){f=R;break}if(f===-1)return{newState:a};if(f===i)return{newState:a};if(!Ql(a,f,i).allowed)return{newState:a};const g=a[l].lanes[f],y=g.length>0&&g[g.length-1].id===n,w=h.lanes.map((R,O)=>O===f?R.filter(Z=>Z.id!==n):R),_=w[i].length>0?w[i][w[i].length-1]:null;let S={...a,[l]:{...h,lanes:w}};S._committedCardId=n;const k=w.map((R,O)=>O===i?[...R,p]:R),j={...h,lanes:k};let E={...S,[l]:j};(!a._currentEffectSource||!a._currentPhaseContext)&&(E=Be(E,void 0),E=rt(E,void 0));const C=c==="player"?"Player":"Opponent",b=l==="player"?"Player's":"Opponent's",T=p.isFaceUp?`${p.protocol}-${p.value}`:"a card",A=E[l].protocols[i];E=ae(E,c,`${C} shifts ${b} ${T} to Protocol ${A}.`);const H={...E.stats[c],cardsShifted:E.stats[c].cardsShifted+1},$={...E[c],stats:H};E={...E,[c]:$,stats:{...E.stats,[c]:H}},E=Ke(E),E.actionRequired=null;let B=xe(E),X={newState:B};if(_){_.customEffects;const R={cardOwner:l,actor:c,currentTurn:B.turn,opponent:l==="player"?"opponent":"player",triggerType:"cover"};X=Ld(_,i,B,R)}let I=X.newState,F=[...X.animationRequests||[]];if(y){const R=Rn(I,l,f);I=R.newState,R.animationRequests&&F.push(...R.animationRequests)}const N=I[l].lanes[i],D=N.length>0&&N[N.length-1].id===n,P=!y;if(D&&p.isFaceUp&&P){const R=Rn(I,l,i);R.animationRequests&&F.push(...R.animationRequests);let O=R.newState;return!O.actionRequired&&(!O.queuedActions||O.queuedActions.length===0)&&(O._committedCardId=void 0),{newState:O,animationRequests:F.length>0?F:void 0}}let L=I;return!L.actionRequired&&(!L.queuedActions||L.queuedActions.length===0)&&(L._committedCardId=void 0),{newState:L,animationRequests:F.length>0?F:void 0}}const X_=(a,n,l)=>{let i=0;for(const c of["player","opponent"])for(let d=0;d<a[c].lanes.length;d++){const p=a[c].lanes[d];if(p.length>0){const h=p[p.length-1];n.includes(h.id)||i++}}return i},Rd=(a,n)=>{const l=ve(a,n);if(!l)return{newState:a};const{card:i,owner:c}=l,d=a[c].lanes.findIndex(f=>f.some(m=>m.id===i.id));if(d===-1)return{newState:a};const p={cardOwner:c,actor:c,currentTurn:a.turn,opponent:c==="player"?"opponent":"player",triggerType:"flip"},h=Zl(i,d,a,p);if(h.newState.actionRequired){h.newState=Ke(h.newState);const f=h.newState.actionRequired.actor;if(a._interruptedTurn&&f===a._interruptedTurn)return h.newState.queuedActions=[...h.newState.queuedActions||[],h.newState.actionRequired],h.newState=Ke(h.newState),h.newState.actionRequired=null,h;f!==a.turn&&(h.newState._interruptedTurn=a.turn,h.newState._interruptedPhase=a.phase,h.newState.turn=f,h.newState.actionRequired.type==="prompt_rearrange_protocols"&&(h.newState.actionRequired={...h.newState.actionRequired,originalAction:{type:"resume_interrupted_turn",interruptedTurn:a.turn,interruptedPhase:a.phase}}))}return h};function Z_(a,n){const l=[];if(a[n].lanes.forEach((c,d)=>{if(c.length>0){const p=c[c.length-1],h=ea(p,c);l.push({card:p,laneIndex:d,owner:n,value:h})}}),l.length===0)return[];const i=Math.max(...l.map(c=>c.value));return l.filter(c=>c.value===i)}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Draw Effect Executor
 *
 * Handles all draw-related effects.
 * Extracted 1:1 from effectInterpreter.ts for modularity.
 */function kh(a,n,l){const i=Math.min(l,a.length),c=a.slice(0,i).map(h=>({...h,id:Qe(),isFaceUp:!0})),d=[...n,...c],p=a.slice(i);return{drawnCards:d,remainingDeck:p,newCards:c}}function K_(a,n,l,i,c){var b,T,A,H,$,B,X,I;const{cardOwner:d}=i,h=(c.target||"self")==="opponent"?i.opponent:d,f=Pd(l,h);if(!f.allowed)return{newState:ae(l,d,f.reason||"Cannot draw cards.")};if(c.conditional){let F=0;switch(c.conditional.type){case"non_matching_protocols":{for(let G=0;G<3;G++){const K=l.player.protocols[G],W=l.opponent.protocols[G],U=l.player.lanes[G].filter(te=>te.isFaceUp),Q=l.opponent.lanes[G].filter(te=>te.isFaceUp);[...U,...Q].some(te=>te.protocol!==K&&te.protocol!==W)&&F++}break}case"count_face_down":{let G=0;for(const K of["player","opponent"])for(const W of l[K].lanes)G+=W.filter(U=>!U.isFaceUp).length;F=G;break}case"is_covering":{F=l[d].lanes[n].length>1?c.count||1:0;break}}let N=F;if(N<=0)return{newState:l};const{drawnCards:D,remainingDeck:P,newCards:L}=kh(l[h].deck,l[h].hand,N);let R={...l};if(R[h]={...R[h],deck:P,hand:D},R.detailedGameStats&&L.length>0){const G=h==="player"?"playerFromEffect":"aiFromEffect";R={...R,detailedGameStats:{...R.detailedGameStats,cardsDrawn:{...R.detailedGameStats.cardsDrawn,[G]:R.detailedGameStats.cardsDrawn[G]+L.length}}}}const O=h==="player"?"Player":"Opponent";let Z="";switch(c.conditional.type){case"non_matching_protocols":Z=" from non-matching protocols";break;case"is_covering":Z=" (this card is covering another)";break;case"count_face_down":Z=" (for face-down cards)";break;default:Z=""}const ee=L.length>0&&h==="player"?` (${L.map(G=>`${G.protocol}-${G.value}`).join(", ")})`:"";R=ae(R,h,`${O} draws ${N} card${N!==1?"s":""}${Z}${ee}.`),N>0&&(R=jt(R,"after_draw",{player:h}).newState);const M=N>0?[{type:"draw",player:h,count:N}]:void 0;return{newState:R,animationRequests:M}}let m=c.count||1;const g=c.countType||"fixed";switch(g){case"equal_to_card_value":{const F=l.lastCustomEffectTargetCardId;if(F){const N=ve(l,F);if(N){const D=N.owner,P=l[D].lanes.find(L=>L.some(R=>R.id===F))||[];m=ea(N.card,P)}else return m=0,{newState:ae(l,d,"Cannot draw cards - referenced card is no longer on board (was returned/deleted).")}}else m=i.referencedCardValue||0;break}case"equal_to_discarded":m=(i.discardedCount||0)+(c.countOffset||0);break;case"hand_size":case"previous_hand_size":m=i.previousHandSize||i.handSize||0;break;case"count_face_down":{let F=0;for(const N of["player","opponent"])for(const D of l[N].lanes)F+=D.filter(P=>!P.isFaceUp).length;m=F*(c.count||1);break}case"all_matching":{if(((b=c.valueFilter)==null?void 0:b.equals)!==void 0){const F=c.valueFilter.equals;m=l[h].deck.filter(D=>D.value===F).length}else m=0;break}case"fixed":default:m=c.count||1;break}if(m<=0)return{newState:l};if(((T=c.advancedConditional)==null?void 0:T.type)==="protocol_match"){const F=c.advancedConditional.protocol;if(l[d].protocols[n]!==F)return{newState:l}}if(((A=c.advancedConditional)==null?void 0:A.type)==="empty_hand"&&l[h].hand.length>0)return{newState:l};if(((H=c.advancedConditional)==null?void 0:H.type)==="opponent_higher_value_in_lane"){const F=d==="player"?"opponent":"player",N=Hn(l,d,n);if(Hn(l,F,n)<=N)return{newState:l}}let y={...l};if((($=c.advancedConditional)==null?void 0:$.type)==="compile_block"){const F=c.advancedConditional.turnDuration||1,N=d==="player"?"opponent":"player";y={...y,compileBlockedUntilTurn:(y.turnNumber||0)+F,compileBlockedPlayer:N},y=ae(y,d,`Opponent can't compile for ${F} turn${F!==1?"s":""}.`)}if(c.optional)return y.actionRequired={type:"prompt_optional_draw",sourceCardId:a.id,actor:d,count:m,drawingPlayer:h},{newState:y};const w=c.source||"own_deck",_=w==="opponent_deck"?i.opponent:h;let S,k,j=[];if(g==="all_matching"&&((B=c.valueFilter)==null?void 0:B.equals)!==void 0){const F=c.valueFilter.equals,N=y[_].deck,D=N.filter(L=>L.value===F),P=N.filter(L=>L.value!==F);j=D.map(L=>({...L,id:Qe(),isFaceUp:!0})),S=[...y[h].hand,...j],k=P}else if(((X=c.valueFilter)==null?void 0:X.equals)!==void 0&&c.fromRevealed){const F=c.valueFilter.equals,N=y[_].deck,D=N.filter(P=>P.value===F);if(D.length===0){const P=`${a.protocol}-${a.value}`;y=ae(y,h,`${P}: No cards with value ${F} in deck.`)}else return y.actionRequired={type:"select_card_from_revealed_deck",sourceCardId:a.id,actor:h,count:m,valueFilter:F,revealedCards:N,selectableCardIds:D.map(P=>P.id||`deck-${N.indexOf(P)}`)},{newState:y}}else if(((I=c.valueFilter)==null?void 0:I.equals)!==void 0){const F=c.valueFilter.equals,N=[...y[_].deck],D=[];for(let R=0;R<N.length&&D.length<m;R++)N[R].value===F&&D.push(R);const P=D.map(R=>N[R]),L=N.filter((R,O)=>!D.includes(O));j=P.map(R=>({...R,id:Qe(),isFaceUp:!0})),S=[...y[h].hand,...j],k=L}else{const F=kh(y[_].deck,y[h].hand,m);S=F.drawnCards,k=F.remainingDeck,j=F.newCards}if(y[_]={...y[_],deck:k},y[h]={...y[h],hand:S},y.detailedGameStats&&j.length>0){const F=h==="player"?"playerFromEffect":"aiFromEffect";y={...y,detailedGameStats:{...y.detailedGameStats,cardsDrawn:{...y.detailedGameStats.cardsDrawn,[F]:y.detailedGameStats.cardsDrawn[F]+j.length}}}}const E=h==="player"?"Player":"Opponent",C=j.length>0&&h==="player"?` (${j.map(F=>`${F.protocol}-${F.value}`).join(", ")})`:"";if(w==="opponent_deck"){const F=_==="player"?"Player's":"Opponent's";y=ae(y,h,`${E} draws the top ${m===1?"card":`${m} cards`} of ${F} deck${C}.`)}else y=ae(y,h,`${E} draws ${m} card${m!==1?"s":""}${C}.`);return S.length>0&&(y=jt(y,"after_draw",{player:h,count:S.length}).newState),{newState:y}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Flip Effect Executor
 *
 * Handles all flip-related effects.
 * Extracted 1:1 from effectInterpreter.ts for modularity.
 */function J_(a,n,l,i,c){var j,E,C;const{cardOwner:d}=i;if(c.useCardFromPreviousEffect&&l.lastCustomEffectTargetCardId){const b=l.lastCustomEffectTargetCardId,T=ve(l,b);if(!T)return{newState:ae(l,d,"Target card from previous effect no longer exists. Flip skipped.")};let A={...l};const H=T.owner,$=A[H].lanes.findIndex(B=>B.some(X=>X.id===b));if($!==-1){const X=A[H].lanes[$].find(I=>I.id===b);if(X){X.isFaceUp=!X.isFaceUp;const I=X.isFaceUp?"face-up":"face-down";A=ae(A,d,`Flips that card ${I}.`)}}return{newState:A}}if(c.scope==="each_lane"){const b=c.targetFilter||{},T=ma(l),A=I=>{const F=l.player.lanes[I],N=l.opponent.lanes[I];let D=[];if(b.position==="covered"?D=[...F.filter((L,R)=>R<F.length-1),...N.filter((L,R)=>R<N.length-1)]:D=[...F,...N],b.owner==="own")D=D.filter(L=>F.includes(L)&&d==="player"||N.includes(L)&&d==="opponent");else if(b.owner==="opponent"){const L=d==="player"?"opponent":"player";D=D.filter(R=>F.includes(R)&&L==="player"||N.includes(R)&&L==="opponent")}return b.excludeSelf&&(D=D.filter(L=>L.id!==a.id)),(T?D.filter(L=>L.isFaceUp):D).length>0},H=[0,1,2].filter(I=>A(I));if(H.length===0){let I=ae(l,d,T?"No valid face-up targets to flip (Frost-1 is active).":"No valid targets to flip in any lane.");return I._effectSkippedNoTargets=!0,{newState:I}}const $=H[0],B=H.slice(1);let X={...l};return X.actionRequired={type:"select_card_to_flip",sourceCardId:a.id,actor:d,currentLaneIndex:$,remainingLanes:B,targetFilter:c.targetFilter,params:c},{newState:X}}if(c.flipSelf){if(((j=c.advancedConditional)==null?void 0:j.type)==="protocol_match"){const H=c.advancedConditional.protocol;if(l[d].protocols[n]!==H)return{newState:l}}if(((E=c.advancedConditional)==null?void 0:E.type)==="opponent_higher_value_in_lane"){const H=d==="player"?"opponent":"player",$=Hn(l,d,n);if(Hn(l,H,n)<=$)return{newState:l}}let b={...l};const A=b[d].lanes[n].find(H=>H.id===a.id);if(A){A.isFaceUp=!A.isFaceUp;const H=d==="player"?"Player":"Opponent",$=A.isFaceUp?"face-up":"face-down";b=ae(b,d,`${H} flips this card ${$}.`)}return{newState:b}}const p=c.count||1,h=((C=c.scope)==null?void 0:C.type)||c.scope||"anywhere",f=p==="all"||typeof p!="number",m=h==="this_lane"&&f,g=h==="anywhere"&&f;if(m||g){let b={...l};const T=d==="player"?"opponent":"player",A=c.targetFilter||{},H=ma(l),$=new Set,B=g?[0,1,2]:[n];for(const X of B){const I=b[d].lanes[X];for(const N of I){if(A.excludeSelf&&N.id===a.id||A.faceState==="face_up"&&!N.isFaceUp||A.faceState==="face_down"&&N.isFaceUp||A.owner==="opponent")continue;const D=I.indexOf(N)===I.length-1;A.position==="uncovered"&&!D||A.position==="covered"&&D||g&&!A.position&&!D||H&&!N.isFaceUp||$.add(N.id)}const F=b[T].lanes[X];for(const N of F){if(A.faceState==="face_up"&&!N.isFaceUp||A.faceState==="face_down"&&N.isFaceUp||A.owner==="own")continue;const D=F.indexOf(N)===F.length-1;A.position==="uncovered"&&!D||A.position==="covered"&&D||g&&!A.position&&!D||H&&!N.isFaceUp||$.add(N.id)}}if($.size>0){const X=g?"":" in this lane";b=ae(b,d,`Flipping ${$.size} card(s)${X}.`);for(const I of $)for(const F of["player","opponent"])for(const N of b[F].lanes){const D=N.find(P=>P.id===I);D&&(D.isFaceUp=!D.isFaceUp)}return{newState:b}}else return b=ae(b,d,`No cards to flip${g?"":" in this lane"}.`),{newState:b}}const y=c.targetFilter||{},w=y.position||"uncovered",_=ma(l),S=[];for(const b of["player","opponent"])for(let T=0;T<l[b].lanes.length;T++){const A=l[b].lanes[T];if(!(c.scope==="this_lane"&&T!==n))for(let H=0;H<A.length;H++){const $=A[H];if(xo(l,$.id))continue;const B=wo(l,A,H);y.excludeSelf&&$.id===a.id||y.owner==="own"&&b!==d||y.owner==="opponent"&&b===d||w==="uncovered"&&!B||w==="covered"&&B||y.faceState==="face_up"&&!$.isFaceUp||y.faceState==="face_down"&&$.isFaceUp||_&&!$.isFaceUp||!Yl(l,$.id).allowed||S.push($.id)}}if(S.length===0){let b=ae(l,d,"No valid cards to flip. Effect skipped.");return b._effectSkippedNoTargets=!0,{newState:b}}let k={...l};return k.actionRequired={type:"select_card_to_flip",count:p,sourceCardId:a.id,actor:d,targetFilter:c.targetFilter,optional:c.optional||!1,scope:c.scope,laneIndex:c.scope==="this_lane"?n:void 0},{newState:k}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Delete Effect Executor
 *
 * Handles all delete-related effects.
 * Extracted 1:1 from effectInterpreter.ts for modularity.
 */function e0(a,n,l,i,c){var j,E,C,b,T,A,H,$,B,X;const{cardOwner:d}=i;let p=c.count||1;if(((j=c.advancedConditional)==null?void 0:j.type)==="empty_hand"&&l[d].hand.length>0)return{newState:l};if(((E=c.advancedConditional)==null?void 0:E.type)==="opponent_higher_value_in_lane"){const I=d==="player"?"opponent":"player",F=Hn(l,d,n);if(Hn(l,I,n)<=F)return{newState:l}}if(c.useCardFromPreviousEffect&&l.lastCustomEffectTargetCardId){const I=l.lastCustomEffectTargetCardId,F=ve(l,I);if(!F)return{newState:ae(l,d,"Target card from previous effect no longer exists. Delete skipped.")};let N={...l};const D=F.owner,P=N[D].lanes.findIndex(L=>L.some(R=>R.id===I));if(P!==-1){const L=[...N[D].lanes[P]],R=L.findIndex(O=>O.id===I);if(R!==-1){const O=R===L.length-1;L.splice(R,1);const Z=[...N[D].lanes];Z[P]=L,N={...N,[D]:{...N[D],lanes:Z}};const ee=F.card.isFaceUp?`${F.card.protocol}-${F.card.value}`:"that card";N=ae(N,d,`Deletes ${ee}.`);const M={...N.stats[d],cardsDeleted:N.stats[d].cardsDeleted+1};N={...N,stats:{...N.stats,[d]:M}};const G=i.triggerType==="cover"||i.triggerType==="on_cover";return O&&L.length>0&&!G&&(N=Rn(N,D,P).newState),{newState:N,animationRequests:[{type:"delete",cardId:I,owner:D}]}}}return{newState:N}}if((C=c.scope)!=null&&C.minCardsInLane){const I=c.scope.minCardsInLane,F=((b=l.player.lanes[n])==null?void 0:b.length)||0,N=((T=l.opponent.lanes[n])==null?void 0:T.length)||0;if(F+N<I)return{newState:l}}let h=[0,1,2];if(((A=c.laneCondition)==null?void 0:A.type)==="opponent_higher_value"&&(h=g0(l,d),h.length===0)){let I=ae(l,d,"No lanes where opponent has higher value. Delete effect skipped.");return I._effectSkippedNoTargets=!0,{newState:I}}const f=c.actorChooses||"effect_owner",m=((H=c.targetFilter)==null?void 0:H.owner)||"any";let g=d;f==="card_owner"&&m==="opponent"&&(g=i.opponent);const y=c.targetFilter||{},w=y.position||"uncovered",_=[];for(const I of["player","opponent"])for(let F=0;F<l[I].lanes.length;F++){if((($=c.scope)==null?void 0:$.type)==="this_line"&&F!==n)continue;const N=l[I].lanes[F];for(let D=0;D<N.length;D++){const P=N[D];if(xo(l,P.id))continue;const L=wo(l,N,D);if(!(c.excludeSelf&&P.id===a.id)&&!(y.owner==="own"&&I!==d)&&!(y.owner==="opponent"&&I===d)&&!(w==="uncovered"&&!L)&&!(w==="covered"&&L)){if(w==="covered_by_context"&&i.triggerType==="cover"){if(I!==i.cardOwner&&L)continue}else if(w==="covered_by_context"&&L)continue;if(!(y.faceState==="face_up"&&!P.isFaceUp)&&!(y.faceState==="face_down"&&P.isFaceUp)){if(y.valueRange){const{min:R,max:O}=y.valueRange;if(P.value<R||P.value>O)continue}if(c.protocolMatching){const R=l.player.protocols[F],O=l.opponent.protocols[F],Z=P.protocol,ee=Z===R||Z===O;if(c.protocolMatching==="must_match"&&!ee||c.protocolMatching==="must_not_match"&&ee)continue}_.push(P.id)}}}}if(_.length===0){let I=ae(l,d,"No valid cards to delete. Effect skipped.");return I._effectSkippedNoTargets=!0,{newState:I}}if(c.upTo&&(p=Math.min(p,_.length),p===0))return{newState:ae(l,d,"No valid targets available. Delete effect skipped.")};let S=_;if(y.calculation==="highest_value"||y.calculation==="lowest_value"){const I=new Map;for(const D of _){const P=ve(l,D);if(!P)continue;let L=-1;for(let O=0;O<l[P.owner].lanes.length;O++)if(l[P.owner].lanes[O].some(Z=>Z.id===D)){L=O;break}let R=P.card.value;!P.card.isFaceUp&&L!==-1&&(R=l[P.owner].lanes[L].some(Z=>Z.isFaceUp&&Z.protocol==="Darkness"&&Z.value===2)?4:2),I.set(D,R)}const F=Array.from(I.values()),N=y.calculation==="highest_value"?Math.max(...F):Math.min(...F);S=_.filter(D=>I.get(D)===N)}if(c.autoExecute){const I=S.slice(0,p);let F=l;const N=[];for(const D of I){const P=ve(F,D);if(!P)continue;const{card:L,owner:R}=P;let O=-1;for(let ce=0;ce<F[R].lanes.length;ce++)if(F[R].lanes[ce].some(te=>te.id===D)){O=ce;break}if(O===-1)continue;const Z=F[R].lanes[O],ee=Z[Z.length-1].id===D,M=L.isFaceUp?`${L.protocol}-${L.value}`:"a face-down card";F=ae(F,d,`Effect triggers, deleting the lowest value covered card (${R==="player"?"Player's":"Opponent's"} ${M}).`);const K=[...Z],W=K.findIndex(ce=>ce.id===D);K.splice(W,1);const U=[...F[R].lanes];U[O]=K,F={...F,[R]:{...F[R],lanes:U}};const Q={...F.stats[d],cardsDeleted:F.stats[d].cardsDeleted+1};F={...F,stats:{...F.stats,[d]:Q}},N.push({type:"delete",cardId:D,owner:R});const Y=i.triggerType==="cover"||i.triggerType==="on_cover";ee&&K.length>0&&!Y&&(F=Rn(F,R,O).newState)}return{newState:F,animationRequests:N}}let k={...l};if(c.deleteSelf){const I=d,F=l[I].lanes[n];if(!F||F.length===0)return k=ae(k,d,"Card already deleted. Delete effect skipped."),{newState:k};if(F.findIndex(G=>G.id===a.id)===-1)return k=ae(k,d,"Card already deleted. Delete effect skipped."),{newState:k};const D=l[I].lanes[n],P=D.length>0&&D[D.length-1].id===a.id;k=ae(k,d,`Deleting ${a.protocol}-${a.value}.`);const L=[...D],R=L.findIndex(G=>G.id===a.id);if(R===-1)return{newState:k};L.splice(R,1);const O=[...k[I].lanes];O[n]=L,k={...k,[I]:{...k[I],lanes:O}};const Z={...k.stats[d],cardsDeleted:k.stats[d].cardsDeleted+1};k={...k,stats:{...k.stats,[d]:Z}};const ee=[{type:"delete",cardId:a.id,owner:I}],M=i.triggerType==="cover"||i.triggerType==="on_cover";if(P&&L.length>0&&!M){const G=Rn(k,I,n);k=G.newState,G.animationRequests&&ee.push(...G.animationRequests)}return{newState:k,animationRequests:ee}}if(c.selectLane)return k.actionRequired={type:"select_lane_for_delete",sourceCardId:a.id,actor:g,count:c.count,targetFilter:c.targetFilter,deleteAll:c.count==="all_in_lane"||c.count==="all",validLanes:h.length<3?h:void 0,laneCondition:c.laneCondition},{newState:k};if(((B=c.scope)==null?void 0:B.type)==="each_lane"){const I=P=>{for(const L of["player","opponent"]){const R=l[L].lanes[P];for(let O=0;O<R.length;O++){const Z=R[O];if(xo(l,Z.id))continue;const ee=wo(l,R,O);if(!(c.excludeSelf&&Z.id===a.id)&&!(y.owner==="own"&&L!==g)&&!(y.owner==="opponent"&&L===g)&&!(w==="uncovered"&&!ee)&&!(w==="covered"&&ee)&&!(y.faceState==="face_up"&&!Z.isFaceUp)&&!(y.faceState==="face_down"&&Z.isFaceUp))return!0}}return!1},F=[0,1,2].filter(P=>I(P));if(F.length===0)return k=ae(k,d,"No valid targets to delete in any lane."),k._effectSkippedNoTargets=!0,{newState:k};const N=F[0],D=F.slice(1);return k.actionRequired={type:"select_cards_to_delete",count:p,sourceCardId:a.id,actor:g,currentLaneIndex:N,remainingLanes:D,disallowedIds:c.excludeSelf?[a.id]:[],targetFilter:c.targetFilter,scope:c.scope,protocolMatching:c.protocolMatching,params:c},{newState:k}}if(((X=c.scope)==null?void 0:X.type)==="each_other_line"){const N=[0,1,2].filter(D=>D!==n).filter(D=>l.player.lanes[D].length>0||l.opponent.lanes[D].length>0).length;return N===0?(k=ae(k,d,"No other lanes have cards. Effect skipped."),{newState:k}):(k.actionRequired={type:"select_card_from_other_lanes_to_delete",sourceCardId:a.id,disallowedLaneIndex:n,lanesSelected:[],count:N,actor:g,targetFilter:c.targetFilter},{newState:k})}return k.actionRequired={type:"select_cards_to_delete",count:p,sourceCardId:a.id,actor:g,actorChooses:f,disallowedIds:c.excludeSelf?[a.id]:[],allowedIds:S.length<_.length?S:void 0,targetFilter:c.targetFilter,scope:c.scope,protocolMatching:c.protocolMatching},{newState:k}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Discard Effect Executor
 *
 * Handles all discard-related effects.
 * Extracted 1:1 from effectInterpreter.ts for modularity.
 */function t0(a,n,l,i,c){const{cardOwner:d}=i,p=c.actor==="opponent"?i.opponent:d;if(c.useCardFromPreviousEffect&&l.lastCustomEffectTargetCardId){const w=l.lastCustomEffectTargetCardId;let _={...l};const S={..._[p]},k=`${a.protocol}-${a.value}`,j=p==="player"?"Player":"Opponent",E=S.deck.findIndex(b=>b.id===w);if(E!==-1){const b=[...S.deck],T=b.splice(E,1)[0];return S.deck=b,S.discard=[...S.discard,T],_[p]=S,_=ae(_,p,`${j} discards ${T.protocol}-${T.value} from their deck.`),_._discardContext={actor:p,discardedCount:1,sourceCardId:a.id},{newState:_}}const C=S.hand.findIndex(b=>b.id===w);if(C!==-1){const b=[...S.hand],T=b.splice(C,1)[0],{id:A,isFaceUp:H,...$}=T;return S.hand=b,S.discard=[...S.discard,$],_[p]=S,_=ae(_,p,`${j} discards ${T.protocol}-${T.value}.`),_._discardContext={actor:p,discardedCount:1,sourceCardId:a.id},{newState:_}}return console.warn(`[Discard Effect] useCardFromPreviousEffect: Card ${w} not found`),_=ae(_,p,`${k}: Card to discard not found - effect skipped.`),_._discardContext={discardedCount:0},{newState:_}}let h=c.count||1;if((c.countType||"fixed")==="equal_to_discarded"){const w=(i.discardedCount||0)+(c.countOffset||0);if(h=Math.min(w,l[p].hand.length),h<=0)return{newState:l}}if(l[p].hand.length===0){let _=ae(l,p,`${p==="player"?"Player":"Opponent"} has no cards to discard - effect skipped.`);return _._effectSkippedNoTargets=!0,_._discardContext={discardedCount:0},{newState:_}}c.upTo&&(h=Math.min(h,l[p].hand.length));const m=h;typeof h=="number"&&h>l[p].hand.length&&(h=l[p].hand.length);const g=!c.upTo&&typeof m=="number"&&m>h;if(c.random&&p!==d){const w=[...l[p].hand],_=Math.min(h,w.length),S=[],k=w.map((B,X)=>X);for(let B=0;B<_&&k.length>0;B++){const X=Math.floor(Math.random()*k.length);S.push(k[X]),k.splice(X,1)}S.sort((B,X)=>X-B);const j=[],E=[...w];for(const B of S){const{id:X,isFaceUp:I,...F}=E.splice(B,1)[0];j.push(F)}const C=[...l[p].discard,...j],b={...l[p].stats,cardsDiscarded:l[p].stats.cardsDiscarded+j.length},T={...l[p],hand:E,discard:C,stats:b};let A={...l,[p]:T,stats:{...l.stats,[p]:b}};const H=p==="player"?"Player":"Opponent",$=j.length===1?"card":"cards";if(p==="player"||j.every(B=>B.isRevealed)){const B=j.map(X=>`${X.protocol}-${X.value}`).join(", ");A=ae(A,p,`${H} randomly discards ${j.length} ${$}: ${B}.`)}else A=ae(A,p,`${H} randomly discards ${j.length} ${$}.`);return A._discardContext={actor:p,discardedCount:j.length,sourceCardId:a.id},{newState:A}}if(h==="all"){const w=l[p].hand,_=w.map(({id:T,isFaceUp:A,...H})=>H),S=[],k=[...l[p].discard,..._],j={...l[p].stats,cardsDiscarded:l[p].stats.cardsDiscarded+_.length},E={...l[p],hand:S,discard:k,stats:j};let C={...l,[p]:E,stats:{...l.stats,[p]:j}};const b=p==="player"?"Player":"Opponent";if(p==="player"||_.every(T=>T.isRevealed)){const T=_.map(A=>`${A.protocol}-${A.value}`).join(", ");C=ae(C,p,`${b} discards entire hand (${_.length} cards: ${T}).`)}else C=ae(C,p,`${b} discards entire hand (${_.length} cards).`);return C._discardContext={actor:p,discardedCount:_.length,previousHandSize:w.length,sourceCardId:a.id},{newState:C}}let y={...l};return g&&(y=ae(y,p,`${p==="player"?"Player":"Opponent"} only has ${h} card${h!==1?"s":""} (${m} required) - discarding all.`)),y.actionRequired={type:"discard",actor:p,count:h,sourceCardId:a.id,variableCount:c.variableCount||!1,previousHandSize:l[p].hand.length},{newState:y}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Shift Effect Executor
 *
 * Handles all shift-related effects.
 * Extracted 1:1 from effectInterpreter.ts for modularity.
 */function n0(a,n,l,i,c){var H,$,B,X;const{cardOwner:d}=i;let p={...l};if(((H=c.advancedConditional)==null?void 0:H.type)==="empty_hand"&&l[d].hand.length>0)return{newState:l};if((($=c.advancedConditional)==null?void 0:$.type)==="opponent_higher_value_in_lane"){const I=d==="player"?"opponent":"player",F=Hn(l,d,n);if(Hn(l,I,n)<=F)return{newState:l}}if(((B=c.advancedConditional)==null?void 0:B.type)==="this_card_is_covered"){const I=l[d].lanes;let F=!1;for(let N=0;N<I.length;N++){const D=I[N],P=D.findIndex(L=>L.id===a.id);if(P!==-1){F=P<D.length-1;break}}if(!F)return{newState:l}}if(c.useCardFromPreviousEffect&&l.lastCustomEffectTargetCardId){const I=l.lastCustomEffectTargetCardId,F=ve(l,I);if(!F)return{newState:ae(l,d,"Target card from previous effect no longer exists. Shift skipped.")};const N=c.destinationRestriction;if((N==null?void 0:N.type)==="to_this_lane"){const P=N.laneIndex==="current"?n:N.laneIndex;if(P===void 0||P<0||P>2)return console.error(`[Shift Effect] Invalid target lane index: ${P}`),{newState:l};const L=go(l,I,F.owner,P,d);return{newState:L.newState,animationRequests:L.animationRequests}}let D=-1;for(let P=0;P<l[F.owner].lanes.length;P++)if(l[F.owner].lanes[P].some(L=>L.id===I)){D=P;break}return D===-1?{newState:l}:(p.actionRequired={type:"select_lane_for_shift",cardToShiftId:I,cardOwner:F.owner,originalLaneIndex:D,sourceCardId:a.id,actor:d,destinationRestriction:N},{newState:p})}const h=l._selectedCardFromPreviousEffect;if(p._selectedCardFromPreviousEffect&&delete p._selectedCardFromPreviousEffect,h&&c.useCardFromPreviousEffect){const I=c.destinationRestriction;if((I==null?void 0:I.type)==="to_this_lane"){const F=I.laneIndex==="current"?n:I.laneIndex;if(F===void 0||F<0||F>2)return console.error(`[Shift Effect] Invalid target lane index: ${F}`),{newState:p};const N=ve(p,h);if(!N)return console.error(`[Shift Effect] Selected card not found: ${h}`),{newState:p};const D=go(p,h,N.owner,F,d);return{newState:D.newState,animationRequests:D.animationRequests}}return p.actionRequired={type:"shift_flipped_card_optional",cardId:h,sourceCardId:a.id,optional:c.optional||!1,actor:d},{newState:p}}if(c.shiftSelf){if(((X=c.destinationRestriction)==null?void 0:X.type)==="opponent_highest_value_lane"){const I=am(p,d);if(I.includes(n))return p=ae(p,d,"Card is already in opponent's highest value lane. Shift skipped."),{newState:p};const F=I.filter(N=>N!==n);if(F.length===0)return p=ae(p,d,"No valid destination lane. Shift skipped."),{newState:p};if(F.length===1){if(c.optional)return p.actionRequired={type:"select_lane_for_shift",cardToShiftId:a.id,cardOwner:d,originalLaneIndex:n,sourceCardId:a.id,actor:d,validLanes:F,destinationRestriction:c.destinationRestriction,optional:!0},{newState:p};const N=F[0],D=go(p,a.id,d,N,d);return{newState:D.newState,animationRequests:D.animationRequests}}return p.actionRequired={type:"select_lane_for_shift",cardToShiftId:a.id,cardOwner:d,originalLaneIndex:n,sourceCardId:a.id,actor:d,validLanes:F,destinationRestriction:c.destinationRestriction,optional:c.optional||!1},{newState:p}}return p.actionRequired={type:"shift_flipped_card_optional",cardId:a.id,sourceCardId:a.id,optional:c.optional||!1,actor:d,allowCovered:c.allowCoveredSelf||!1},{newState:p}}const f=c.targetFilter||{},m=f.position||"uncovered",g=f.faceState||"any",y=f.owner||"any",w=f.excludeSelf||!1,_=c.count||1;if(m==="any"&&y==="own"&&!w&&_===1)return p.actionRequired={type:"shift_flipped_card_optional",cardId:a.id,sourceCardId:a.id,optional:c.optional||!1,actor:d},{newState:p};const k=[];for(const I of["player","opponent"])if(!(y==="own"&&I!==d)&&!(y==="opponent"&&I===d))for(let F=0;F<p[I].lanes.length;F++){if(c.scope==="this_lane"&&F!==n)continue;const N=p[I].lanes[F];for(let D=0;D<N.length;D++){const P=N[D];if(xo(p,P.id)||w&&P.id===a.id)continue;const L=wo(p,N,D);m==="uncovered"&&!L||m==="covered"&&L||g==="face_up"&&!P.isFaceUp||g==="face_down"&&P.isFaceUp||k.push({card:P,currentLane:F,owner:I})}}if(k.length===0)return p=ae(p,d,"No valid cards to shift."),p._effectSkippedNoTargets=!0,{newState:p};if((_==="all"||typeof _!="number"&&_!==1)&&k.length>0){const I=[],F=c.destinationRestriction;for(let N=0;N<3;N++){if((F==null?void 0:F.type)==="to_another_line"){if(N===n)continue}else if((F==null?void 0:F.type)==="to_this_lane"){const D=F.laneIndex==="current"?n:F.laneIndex;if(N!==D)continue}else if(!F&&N===n)continue;I.push(N)}return I.length===0?(p=ae(p,d,"No valid destination lanes for shifting all cards."),{newState:p}):(p=ae(p,d,`Shifting ${k.length} card(s) from this lane.`),p.actionRequired={type:"select_lane_for_shift_all",sourceCardId:a.id,actor:d,cardsToShift:k.map(N=>({cardId:N.card.id,owner:N.owner})),validDestinationLanes:I,sourceLaneIndex:n},{newState:p})}const E=c.destinationRestriction;let C=!1;const b=(E==null?void 0:E.laneIndex)==="current"?n:E==null?void 0:E.laneIndex;for(const{card:I,currentLane:F,owner:N}of k){if((E==null?void 0:E.type)==="non_matching_protocol"&&!I.isFaceUp)continue;const D=I.protocol;for(let P=0;P<3;P++){if(E){if(E.type==="non_matching_protocol"){if(P===F)continue;const R=p.player.protocols[P],O=p.opponent.protocols[P];if(D===R||D===O)continue}else if(E.type==="specific_lane"){if(P!==F)continue}else if(E.type==="to_this_lane"){if(P!==b||F===b)continue}else if(E.type==="to_another_line"){if(P===F)continue}else if(E.type==="to_or_from_this_lane"&&(!(F===b)&&!(P===b)||P===F))continue}else if(P===F)continue;if(Ql(p,F,P).allowed){C=!0;break}}if(C)break}if(!C)return p=ae(p,d,"No valid shift destinations available."),{newState:p};const T=E&&b!==void 0?{...E,laneIndex:b}:E,A=(E==null?void 0:E.type)==="to_this_lane"&&b!==void 0?b:void 0;return p.actionRequired={type:"select_card_to_shift",sourceCardId:a.id,actor:d,targetFilter:c.targetFilter,destinationRestriction:T,sourceLaneIndex:n,targetLaneIndex:A,scope:c.scope},{newState:p}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Return Effect Executor
 *
 * Handles all return-related effects.
 * Extracted 1:1 from effectInterpreter.ts for modularity.
 */function a0(a,n,l,i,c){var w,_,S,k;const{cardOwner:d,opponent:p}=i;c.count==="all"||c.count;const h=((w=c.targetFilter)==null?void 0:w.owner)||"any",f=((_=c.targetFilter)==null?void 0:_.position)||"uncovered";if(((S=c.advancedConditional)==null?void 0:S.type)==="empty_hand"&&l[d].hand.length>0)return{newState:l};if(((k=c.advancedConditional)==null?void 0:k.type)==="opponent_higher_value_in_lane"){const j=d==="player"?"opponent":"player",E=Hn(l,d,n);if(Hn(l,j,n)<=E)return{newState:l}}if(c.selectLane){let j={...l};return j.actionRequired={type:"select_lane_for_return",sourceCardId:a.id,actor:d,count:c.count,targetFilter:c.targetFilter},{newState:j}}let m=[];const g=j=>{for(const E of l[j].lanes)for(let C=0;C<E.length;C++){const b=E[C];if(xo(l,b.id))continue;const T=wo(l,E,C);f==="uncovered"&&!T||f==="covered"&&T||m.push({card:b,isUncovered:T})}};if(h==="own"?g(d):h==="opponent"?g(p):(g("player"),g("opponent")),m.length===0)return{newState:ae(l,d,"No cards on board to return. Effect skipped.")};let y={...l};return y.actionRequired={type:"select_card_to_return",sourceCardId:a.id,actor:d,targetOwner:h,targetFilter:c.targetFilter},{newState:y}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Play Effect Executor
 *
 * Handles all play-related effects (play cards from hand/deck to board).
 * Extracted 1:1 from effectInterpreter.ts for modularity.
 */function o0(a,n,l,i,c){var _,S,k,j,E,C,b,T,A,H,$;const{cardOwner:d,opponent:p}=i,h=c.count||1,f=c.source||"hand",m=c.faceDown,g=c.actor==="opponent"?p:d;if(((_=c.advancedConditional)==null?void 0:_.type)==="empty_hand"&&l[d].hand.length>0)return{newState:l};if(((S=c.advancedConditional)==null?void 0:S.type)==="opponent_higher_value_in_lane"){const B=d==="player"?"opponent":"player",X=Hn(l,d,n);if(Hn(l,B,n)<=X)return{newState:l}}if(f==="deck"&&((k=c.destinationRule)==null?void 0:k.type)==="each_other_line"){const B=[0,1,2].filter(ee=>ee!==n);if(B.length===0)return{newState:l};const X=l[g];if(X.deck.length===0&&X.discard.length===0)return{newState:ae(l,d,`${g==="player"?"Player":"Opponent"} has no cards in deck/discard - effect skipped.`)};const{drawnCards:I,remainingDeck:F,newDiscard:N}=Mn(X.deck,X.discard,B.length);if(I.length===0)return{newState:l};const D=I.map(ee=>({...ee,id:Qe(),isFaceUp:!1})),P=[...X.lanes];for(let ee=0;ee<D.length;ee++){const M=B[ee];P[M]=[...P[M],D[ee]]}const L={...X,lanes:P,deck:F,discard:N};let R={...l,[g]:L};if(R.detailedGameStats&&I.length>0){const ee=g==="player"?"playerFromEffect":"aiFromEffect",M=g==="player"?"playerFaceDown":"aiFaceDown";R={...R,detailedGameStats:{...R.detailedGameStats,cardsPlayed:{...R.detailedGameStats.cardsPlayed,[ee]:R.detailedGameStats.cardsPlayed[ee]+I.length,[M]:R.detailedGameStats.cardsPlayed[M]+I.length}}}}const O=ve(l,a.id),Z=O?`${O.card.protocol}-${O.card.value}`:"a card effect";return R=ae(R,d,`${Z}: Plays ${I.length} card(s) face-down in other lines.`),{newState:R}}if(f==="deck"&&((j=c.destinationRule)==null?void 0:j.type)==="each_line_with_card"){const B=c.destinationRule.ownerFilter||"any",X=c.destinationRule.cardFilter,I=B==="own"?g:B==="opponent"?g==="player"?"opponent":"player":null,F=te=>{const ye=Se=>Se.length===0?!1:X?Se.some(ge=>X.faceState==="face_down"?!ge.isFaceUp:X.faceState==="face_up"?ge.isFaceUp:!0):!0;return I?ye(l[I].lanes[te]):ye(l.player.lanes[te])||ye(l.opponent.lanes[te])},N=[];for(let te=0;te<3;te++)F(te)&&N.push(te);if(N.length===0)return{newState:l};const D=l[g];if(D.deck.length===0&&D.discard.length===0)return{newState:ae(l,d,`${g==="player"?"Player":"Opponent"} has no cards in deck/discard - effect skipped.`)};const{drawnCards:P,remainingDeck:L,newDiscard:R}=Mn(D.deck,D.discard,N.length);if(P.length===0)return{newState:l};const O=P.map(te=>({...te,id:Qe(),isFaceUp:!m}));let Z=l;const ee=[];for(let te=0;te<N.length;te++){const ye=N[te],Se=Z[g].lanes[ye];if(Se.length>0){const ge=Se[Se.length-1],Fe={...i,triggerType:"cover"},Le=Ld(ge,ye,Z,Fe);if(Z=Le.newState,Le.animationRequests&&ee.push(...Le.animationRequests),Z.actionRequired)break}}const M=[...Z[g].lanes],G=[];for(let te=0;te<O.length;te++){const ye=N[te];M[ye]=[...M[ye],O[te]],G.push({type:"play",cardId:O[te].id,owner:g})}const K={...Z[g],lanes:M,deck:L,discard:R};let W={...Z,[g]:K};if(W.detailedGameStats&&P.length>0){const te=g==="player"?"playerFromEffect":"aiFromEffect",ye=g==="player"?"playerFaceDown":"aiFaceDown";W={...W,detailedGameStats:{...W.detailedGameStats,cardsPlayed:{...W.detailedGameStats.cardsPlayed,[te]:W.detailedGameStats.cardsPlayed[te]+P.length,[ye]:W.detailedGameStats.cardsPlayed[ye]+P.length}}}}const U=ve(l,a.id),Q=U?`${U.card.protocol}-${U.card.value}`:"a card effect";let Y="";(X==null?void 0:X.faceState)==="face_down"?Y="with a face-down card":(X==null?void 0:X.faceState)==="face_up"?Y="with a face-up card":B==="own"?Y="where you have a card":B==="opponent"?Y="where opponent has a card":Y="with a card",W=ae(W,d,`${Q}: Plays ${P.length} card(s) face-down in each line ${Y}.`);const ce=[...ee,...G];return{newState:W,animationRequests:ce.length>0?ce:void 0}}if(f==="deck"&&((E=c.destinationRule)==null?void 0:E.type)==="another_line"){if([0,1,2].filter(I=>I!==n).length===0)return{newState:l};let X={...l};return X.actionRequired={type:"select_lane_for_play",sourceCardId:a.id,actor:g,count:c.count||1,isFaceDown:c.faceDown,excludeCurrentLane:!0,currentLaneIndex:n,source:c.source},{newState:X}}if(f==="deck"&&((C=c.destinationRule)==null?void 0:C.type)==="under_this_card"&&((b=c.condition)==null?void 0:b.type)==="per_x_cards_in_line"){const B=c.condition.cardCount||2,X=l[d].lanes[n].length,I=l[p].lanes[n].length,F=X+I,N=Math.floor(F/B);if(N===0)return{newState:l};const D=l[g];if(D.deck.length===0&&D.discard.length===0)return{newState:l};const{drawnCards:P,remainingDeck:L,newDiscard:R}=Mn(D.deck,D.discard,N);if(P.length===0)return{newState:l};const O=P.map(U=>({...U,id:Qe(),isFaceUp:!1})),Z=[...D.lanes[n]];Z.splice(Z.length-1,0,...O);const ee=[...D.lanes];ee[n]=Z;const M={...D,lanes:ee,deck:L,discard:R};let G={...l,[g]:M};if(G.detailedGameStats&&P.length>0){const U=g==="player"?"playerFromEffect":"aiFromEffect",Q=g==="player"?"playerFaceDown":"aiFaceDown";G={...G,detailedGameStats:{...G.detailedGameStats,cardsPlayed:{...G.detailedGameStats.cardsPlayed,[U]:G.detailedGameStats.cardsPlayed[U]+P.length,[Q]:G.detailedGameStats.cardsPlayed[Q]+P.length}}}}const K=ve(l,a.id),W=K?`${K.card.protocol}-${K.card.value}`:"a card effect";return G=ae(G,d,`${W}: Plays ${P.length} card(s) face-down under itself.`),{newState:G}}if(f==="deck"&&((T=c.destinationRule)==null?void 0:T.type)==="specific_lane"){const B=c.destinationRule.laneIndex==="current"?n:c.destinationRule.laneIndex;if(B===void 0||B<0||B>2)return console.error(`[Play Effect] Invalid lane index: ${B}`),{newState:l};const X=l[g];if(X.deck.length===0&&X.discard.length===0)return{newState:ae(l,d,`${g==="player"?"Player":"Opponent"} has no cards in deck/discard - effect skipped.`)};const{drawnCards:I,remainingDeck:F,newDiscard:N}=Mn(X.deck,X.discard,h);if(I.length===0)return{newState:l};const D=I.map(K=>({...K,id:Qe(),isFaceUp:!m})),P=[...X.lanes];P[B]=[...P[B],...D];const L={...X,lanes:P,deck:F,discard:N};let R={...l,[g]:L};if(R.detailedGameStats&&I.length>0){const K=g==="player"?"playerFromEffect":"aiFromEffect",W=g==="player"?m?"playerFaceDown":"playerFaceUp":m?"aiFaceDown":"aiFaceUp";R={...R,detailedGameStats:{...R.detailedGameStats,cardsPlayed:{...R.detailedGameStats.cardsPlayed,[K]:R.detailedGameStats.cardsPlayed[K]+I.length,[W]:R.detailedGameStats.cardsPlayed[W]+I.length}}}}const O=ve(l,a.id),Z=O?`${O.card.protocol}-${O.card.value}`:"a card effect",ee=g==="player"?"Player":"Opponent",M=m?"face-down":"face-up",G=l.player.protocols[B];return R=ae(R,d,`${Z}: ${ee} plays ${I.length} card(s) ${M} in ${G} line.`),{newState:R}}if(f==="hand"&&((A=c.destinationRule)==null?void 0:A.type)==="line_with_matching_cards"){const B=c.destinationRule.cardFilter,X=N=>{const D=P=>P.length===0?!1:B?P.some(L=>B.faceState==="face_down"?!L.isFaceUp:B.faceState==="face_up"?L.isFaceUp:!0):!0;return D(l.player.lanes[N])||D(l.opponent.lanes[N])},I=[];for(let N=0;N<3;N++)X(N)&&I.push(N);if(I.length===0){const N=ve(l,a.id),D=N?`${N.card.protocol}-${N.card.value}`:"Effect";return{newState:ae(l,d,`${D}: No valid lanes with face-down cards. Effect skipped.`)}}if(l[g].hand.length===0)return{newState:l};let F={...l};return F.actionRequired={type:"select_card_from_hand_to_play",sourceCardId:a.id,actor:g,count:c.count||1,faceDown:c.faceDown,source:"hand",validLanes:I,cardFilter:B},{newState:F}}if(f==="hand"&&((H=c.valueFilter)==null?void 0:H.equals)!==void 0&&!c.destinationRule){const B=c.valueFilter.equals,X=l[g].hand.filter(F=>F.value===B);if(X.length===0){const F=ve(l,a.id),N=F?`${F.card.protocol}-${F.card.value}`:"Effect";return{newState:ae(l,d,`${N}: No cards with value ${B} in hand. Effect skipped.`)}}let I={...l};return I.actionRequired={type:"select_card_from_hand_to_play",sourceCardId:a.id,actor:g,count:c.count||1,faceDown:c.faceDown,source:"hand",valueFilter:B,selectableCardIds:X.map(F=>F.id)},{newState:I}}if(f==="hand"&&l[g].hand.length===0)return{newState:l};let y={...l},w;return($=c.destinationRule)!=null&&$.excludeCurrentLane&&(w=n),y.actionRequired={type:"select_card_from_hand_to_play",count:h,sourceCardId:a.id,actor:g,faceDown:m,source:f,disallowedLaneIndex:w,destinationRule:c.destinationRule,condition:c.condition},{newState:y}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Reveal/Give Effect Executor
 *
 * Handles reveal and give card effects.
 * Extracted 1:1 from effectInterpreter.ts for modularity.
 */function r0(a,n,l,i,c){const{cardOwner:d,opponent:p}=i,h=c.count||1,f=c.action,m=c.source||"own_hand";if(f==="reveal"&&m==="board"){const y=c.targetFilter||{owner:"any",position:"uncovered",faceState:"face_down"},w=c.followUpAction,_=c.optional!==!1,S=[],k=y.owner==="own"?[d]:y.owner==="opponent"?[p]:[d,p];for(const E of k)for(let C=0;C<l[E].lanes.length;C++){const b=l[E].lanes[C];if(b.length>0){let T=[];y.position==="uncovered"?T=[b[b.length-1]]:y.position==="covered"?T=b.slice(0,-1):T=[...b];const A=T.filter(H=>y.faceState==="face_up"?H.isFaceUp:y.faceState==="face_down"?!H.isFaceUp:!0);S.push(...A)}}if(S.length===0)return{newState:ae(l,d,"No valid cards to reveal. Effect skipped.")};let j={...l};return j.actionRequired={type:"select_board_card_to_reveal_custom",sourceCardId:a.id,actor:d,targetFilter:y,followUpAction:w,optional:_},{newState:j}}if(f==="reveal"&&m==="opponent_hand"){let y={...l};const w={...y[p]};if(w.hand.length>0){w.hand=w.hand.map(S=>({...S,isRevealed:!0})),y[p]=w;const _=`${a.protocol}-${a.value}`;y=ae(y,d,`${_}: Your opponent reveals their hand.`)}else{const _=`${a.protocol}-${a.value}`;y=ae(y,d,`${_}: Opponent has no cards to reveal.`)}return{newState:y}}if(f==="reveal"&&m==="own_deck_top"){let y={...l};const w={...y[d]},_=`${a.protocol}-${a.value}`;if(w.deck.length===0)return y=ae(y,d,`${_}: No cards in deck to reveal.`),{newState:y};const S=[...w.deck],k=S[0];y=ae(y,d,`${_}: Revealed ${k.protocol}-${k.value} from top of deck.`);const j=`deck-top-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;return S[0]={...k,id:j},w.deck=S,y[d]=w,y.lastCustomEffectTargetCardId=j,{newState:y}}if(f==="reveal"&&m==="own_deck"){let y={...l};const w={...y[d]},_=`${a.protocol}-${a.value}`;if(w.deck.length===0)return y=ae(y,d,`${_}: No cards in deck to reveal.`),{newState:y};w.deckRevealed=!0,y[d]=w;const S=w.deck.map(k=>`${k.protocol}-${k.value}`).join(", ");return y=ae(y,d,`${_}: Revealed deck: ${S}`),{newState:y}}if(l[d].hand.length===0)return{newState:ae(l,d,`No cards in hand to ${f}. Effect skipped.`)};let g={...l};return f==="reveal"?g.actionRequired={type:"select_card_from_hand_to_reveal",count:h,sourceCardId:a.id,actor:d}:f==="give"&&(g.actionRequired={type:"select_card_from_hand_to_give",count:h,sourceCardId:a.id,actor:d}),{newState:g}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Shuffle Effect Executor
 *
 * Handles shuffle_trash and shuffle_deck effects.
 * - shuffle_trash: Clarity-4 "You may shuffle your trash into your deck."
 *   (In this codebase, "trash" = "discard pile")
 * - shuffle_deck: Clarity-2/3 "Shuffle your deck."
 */function l0(a,n,l,i,c){const{cardOwner:d}=i,p=`${a.protocol}-${a.value}`,h=c.optional!==!1;if(l[d].discard.length===0)return{newState:ae(l,d,`${p}: No cards in trash to shuffle.`)};if(h){let f={...l};return f.actionRequired={type:"prompt_optional_shuffle_trash",sourceCardId:a.id,actor:d,trashCount:l[d].discard.length},{newState:f}}return em(l,d,p)}function em(a,n,l){let i={...a};const c={...i[n]},d=c.discard.length;return d===0?(i=ae(i,n,`${l}: No cards in trash to shuffle.`),{newState:i}):(c.deck=[...c.deck,...c.discard],c.discard=[],c.deck=kn([...c.deck]),i[n]=c,i=ae(i,n,`${l}: Shuffled ${d} card${d!==1?"s":""} from trash into deck.`),{newState:i})}function s0(a,n,l,i,c){const{cardOwner:d}=i,p=`${a.protocol}-${a.value}`;let h={...l};const f={...h[d]};return f.deck.length===0?(h=ae(h,d,`${p}: No cards in deck to shuffle.`),{newState:h}):(f.deck=kn([...f.deck]),f.deckRevealed=!1,h[d]=f,h=ae(h,d,`${p}: Shuffled deck.`),{newState:h})}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function st(a,n,l,i,c,d){var j,E,C;const p=c.params,h=p.action,f=ve(l,a.id);if(!f)return{newState:l};if(!f.card.isFaceUp)return{newState:l};const m=c.position||"middle",y=c.trigger==="on_cover",w=p.useCardFromPreviousEffect===!0;if(m!=="top"&&!y&&!w&&!vo(l,a.id))return{newState:l};const S=h==="reveal"&&p.source==="board";if(p.optional===!0&&!S){const b=p.actor==="opponent"?i.opponent:i.cardOwner,T=b==="player"?"opponent":"player",A=p.targetFilter||{},H=I=>{for(const F of["player","opponent"])for(let N=0;N<l[F].lanes.length;N++){const D=l[F].lanes[N];for(let P=0;P<D.length;P++)if(I(D[P],F,N,P))return!0}return!1};let $=!0,B="";switch(h){case"discard":!p.useCardFromPreviousEffect&&l[b].hand.length===0&&($=!1,B="No cards to discard");break;case"flip":{const I=(j=l.passiveEffects)==null?void 0:j.some(F=>F.type==="prevent_flip_to_face_up"&&F.isActive);$=H((F,N,D,P)=>{if(A.excludeSelf&&F.id===a.id||A.owner==="own"&&N!==b||A.owner==="opponent"&&N===b)return!1;const L=P===l[N].lanes[D].length-1;return!(A.position==="uncovered"&&!L||A.position==="covered"&&L||A.faceState==="face_up"&&!F.isFaceUp||A.faceState==="face_down"&&F.isFaceUp||I&&!F.isFaceUp)}),$||(B="No valid cards to flip");break}case"delete":{$=H((I,F,N,D)=>{if(A.excludeSelf&&I.id===a.id||A.owner==="own"&&F!==b||A.owner==="opponent"&&F===b)return!1;const P=D===l[F].lanes[N].length-1,L=A.position||"uncovered";return!(L==="uncovered"&&!P||L==="covered"&&P||A.faceState==="face_up"&&!I.isFaceUp||A.faceState==="face_down"&&I.isFaceUp)}),$||(B="No valid cards to delete");break}case"shift":{if(c.useCardFromPreviousEffect){const I=l.lastCustomEffectTargetCardId||l._selectedCardFromPreviousEffect;I?($=!!ve(l,I),$||(B="Target card no longer exists")):($=!1,B="No target card from previous effect")}else if(p.shiftSelf&&((E=p.destinationRestriction)==null?void 0:E.type)==="opponent_highest_value_lane")am(l,i.cardOwner).includes(n)&&($=!1,B="Card is already in opponent's highest value lane");else if(((C=p.advancedConditional)==null?void 0:C.type)==="this_card_is_covered"){const I=l[i.cardOwner].lanes;let F=!1;for(let N=0;N<I.length;N++){const D=I[N],P=D.findIndex(L=>L.id===a.id);if(P!==-1){F=P<D.length-1;break}}F||($=!1,B="Card is not covered")}else{const I=A.position||"uncovered";I==="any"&&A.owner==="own"&&!A.excludeSelf?$=!0:($=H((N,D,P,L)=>{if(A.excludeSelf&&N.id===a.id||A.owner==="own"&&D!==b||A.owner==="opponent"&&D===b)return!1;const R=L===l[D].lanes[P].length-1;return!(I==="uncovered"&&!R||I==="covered"&&R)}),$||(B="No valid cards to shift"))}break}case"return":{const I=A.owner==="opponent"?T:b;$=H((F,N,D,P)=>{if(N!==I)return!1;const L=P===l[N].lanes[D].length-1,R=A.position||"uncovered";return!(R==="uncovered"&&!L||R==="covered"&&L)}),$||(B="No valid cards to return");break}case"draw":l[b].deck.length===0&&l[b].discard.length===0&&($=!1,B="No cards to draw");break;case"play":l[b].hand.length===0&&($=!1,B="No cards to play");break}if(!$){let I=ae(l,b,`${B} - effect skipped.`);return I._effectSkippedNoTargets=!0,h==="discard"&&(I._discardContext={discardedCount:0}),{newState:I}}let X={...l};return X.actionRequired={type:"prompt_optional_effect",actor:i.cardOwner,sourceCardId:a.id,effectDef:c,laneIndex:n},{newState:X}}let k;switch(h){case"refresh":{const b=i.actor,T=Pd(l,b);if(!T.allowed){k={newState:ae(l,i.cardOwner,T.reason||"Cannot refresh (draw blocked).")};break}const A=l[b].hand.length,H=Math.max(0,5-A);if(H>0){const{drawnCards:$,remainingDeck:B,newDiscard:X}=Mn(l[b].deck,l[b].discard,H),I=$.map(P=>({...P,id:Qe()}));let F={...l,[b]:{...l[b],hand:[...l[b].hand,...I],deck:B,discard:X}};const N=b==="player"?` (${$.map(P=>`${P.protocol}-${P.value}`).join(", ")})`:"";F=ae(F,b,`[Refresh] Drew ${$.length} cards to reach hand size 5${N}.`),F=jt(F,"after_draw",{player:b,count:$.length}).newState,k={newState:F}}else k={newState:ae(l,b,`[Refresh] Hand already at ${A} cards, no draw needed.`)};break}case"mutual_draw":{const b=i.actor,T=b==="player"?"opponent":"player",A=p.count||1;let H={...l};if(H[T].deck.length>0){const{drawnCards:$,remainingDeck:B,newDiscard:X}=Mn(H[T].deck,H[T].discard,A);if($.length>0){const I=$.map(P=>({...P,id:Qe(),isFaceUp:!0}));H={...H,[T]:{...H[T],deck:B,discard:X},[b]:{...H[b],hand:[...H[b].hand,...I]}};const F=b==="player"?"Player":"Opponent",N=T==="player"?"Player":"Opponent",D=b==="player"?` (${I.map(P=>`${P.protocol}-${P.value}`).join(", ")})`:"";H=ae(H,b,`${F} drew ${$.length} card(s) from ${N}'s deck${D}.`)}}if(H[b].deck.length>0){const{drawnCards:$,remainingDeck:B,newDiscard:X}=Mn(H[b].deck,H[b].discard,A);if($.length>0){const I=$.map(P=>({...P,id:Qe(),isFaceUp:!0}));H={...H,[b]:{...H[b],deck:B,discard:X},[T]:{...H[T],hand:[...H[T].hand,...I]}};const F=T==="player"?"Player":"Opponent",N=b==="player"?"Player":"Opponent",D=T==="player"?` (${I.map(P=>`${P.protocol}-${P.value}`).join(", ")})`:"";H=ae(H,T,`${F} drew ${$.length} card(s) from ${N}'s deck${D}.`)}}k={newState:H};break}case"draw":k=K_(a,n,l,i,p);break;case"flip":k=J_(a,n,l,i,p);break;case"delete":k=e0(a,n,l,i,p);break;case"discard":k=t0(a,n,l,i,p);break;case"shift":k=n0(a,n,l,i,{...p,useCardFromPreviousEffect:c.useCardFromPreviousEffect});break;case"return":k=a0(a,n,l,i,p);break;case"play":k=o0(a,n,l,i,p);break;case"rearrange_protocols":case"swap_protocols":k=i0(a,n,l,i,p);break;case"reveal":case"give":k=r0(a,n,l,i,p);break;case"take":k=c0(a,n,l,i,p);break;case"choice":k=d0(a,n,l,i,p);break;case"block_compile":k=u0(a,n,l,i,p);break;case"delete_all_in_lane":k=p0(a,n,l,i,p);break;case"shuffle_trash":k=l0(a,n,l,i,p);break;case"shuffle_deck":k=s0(a,n,l,i);break;default:console.error(`[Custom Effect] Unknown action: ${h}`),k={newState:l};break}if(c.conditional&&c.conditional.thenEffect){const{newState:b}=k;if(b.actionRequired)k={newState:{...b,actionRequired:{...b.actionRequired,followUpEffect:c.conditional.thenEffect,conditionalType:c.conditional.type,outerSourceCardId:a.id,outerLaneIndex:n}}};else{if(c.conditional.type==="if_executed"){const H=b._discardContext;if(((H==null?void 0:H.discardedCount)||0)===0)return delete b._discardContext,k={newState:b},k}if(c.conditional.type==="optional"){let H={...b};return H.actionRequired={type:"prompt_optional_effect",actor:i.cardOwner,sourceCardId:a.id,effectDef:c.conditional.thenEffect,laneIndex:n,savedTargetCardId:b.lastCustomEffectTargetCardId},k={newState:H},k}let T=i;const A=b._discardContext;A&&(T={...i,discardedCount:A.discardedCount,previousHandSize:A.previousHandSize},delete b._discardContext),k=st(a,n,b,T,c.conditional.thenEffect)}}return k}function i0(a,n,l,i,c){const{cardOwner:d,opponent:p}=i,h=c.action,m=(c.target||"own")==="opponent"?p:d,g=d;if(I_(l)&&h==="rearrange_protocols")return{newState:ae(l,d,"Protocols cannot be rearranged (Frost-1 bottom effect is active).")};let w={...l},_;return c.restriction&&(_={laneIndex:c.restriction.laneIndex==="current"?n:c.restriction.laneIndex,protocol:c.restriction.disallowedProtocol}),h==="rearrange_protocols"?w.actionRequired={type:"prompt_rearrange_protocols",actor:g,target:m,sourceCardId:a.id,disallowedProtocolForLane:_}:h==="swap_protocols"&&(w.actionRequired={type:"prompt_swap_protocols",actor:g,target:m,sourceCardId:a.id,disallowedProtocolForLane:_}),{newState:w}}function c0(a,n,l,i,c){const{cardOwner:d,opponent:p}=i,h=c.count||1,f=c.random!==!1;if(l[p].hand.length===0)return{newState:ae(l,d,"Opponent has no cards in hand. Effect skipped.")};let m={...l};const g={...m[p]},y={...m[d]};if(f){const w=Math.min(h,g.hand.length),_=[];for(let E=0;E<w;E++){const C=Math.floor(Math.random()*g.hand.length),b=g.hand.splice(C,1)[0];y.hand.push(b),_.push(b)}m={...m,[d]:y,[p]:g};const S=d==="player"?"Player":"Opponent",k=`${a.protocol}-${a.value}`,j=_.map(E=>d==="player"?`${E.protocol}-${E.value}`:"a card").join(", ");return m=ae(m,d,`${k}: ${S} takes ${j} from the opponent's hand.`),{newState:m}}else{console.warn("[Take Effect] Non-random take not yet implemented, falling back to random");const w=Math.floor(Math.random()*g.hand.length),_=g.hand.splice(w,1)[0];y.hand.push(_),m={...m,[d]:y,[p]:g};const S=d==="player"?"Player":"Opponent",k=`${a.protocol}-${a.value}`,j=d==="player"?`${_.protocol}-${_.value}`:"a card";return m=ae(m,d,`${k}: ${S} takes ${j} from the opponent's hand.`),{newState:m}}}function d0(a,n,l,i,c){const{cardOwner:d}=i,p=c.options||[];if(p.length!==2)return console.error(`[Choice Effect] Expected 2 options, got ${p.length}`),{newState:l};let h={...l};return h.actionRequired={type:"custom_choice",options:p,sourceCardId:a.id,actor:d,laneIndex:n},{newState:h}}function u0(a,n,l,i,c){const{cardOwner:d,opponent:p}=i,f=(c.target||"opponent")==="opponent"?p:d,m={...l[f],cannotCompile:!0};let g={...l,[f]:m};const y=ve(l,a.id),w=y?`${y.card.protocol}-${y.card.value}`:"Effect";return g=ae(g,d,`${w}: ${f==="player"?"Player":"Opponent"} cannot compile next turn.`),{newState:g}}function p0(a,n,l,i,c){var g;const{cardOwner:d}=i,p=c.excludeCurrentLane!==!1,h=((g=c.laneCondition)==null?void 0:g.count)||8,f=[];for(let y=0;y<3;y++){if(p&&y===n)continue;l.player.lanes[y].length+l.opponent.lanes[y].length>=h&&f.push(y)}if(f.length===0){const y=`${a.protocol}-${a.value}`;return{newState:ae(l,d,`${y}: No line has ${h} or more cards. Effect skipped.`)}}let m={...l};return m.actionRequired={type:"select_lane_for_delete_all",sourceCardId:a.id,actor:d,validLanes:f,minCards:h},{newState:m}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function jt(a,n,l){var h;let i={...a};if(i._processingReactiveEffects)return{newState:i};i={...i,_processingReactiveEffects:!0};const c=i.processedClearCacheTriggerIds||[],d=[],p=f=>f.some(m=>m.trigger===n||m.trigger==="on_cover_or_flip"&&(n==="on_cover"||n==="on_flip"));for(const f of["player","opponent"])i[f].lanes.forEach((m,g)=>{m.forEach((y,w)=>{if(!y.isFaceUp)return;const _=i._committedCardId;if(_&&y.id===_)return;const S=y;if(!S.customEffects)return;const k=w===m.length-1;if(S.customEffects.topEffects&&p(S.customEffects.topEffects)){if(n==="after_clear_cache"&&c.includes(y.id))return;d.push({card:y,owner:f,laneIndex:g,box:"top"})}if(S.customEffects.middleEffects&&p(S.customEffects.middleEffects)){if(n==="after_clear_cache"&&c.includes(y.id))return;d.push({card:y,owner:f,laneIndex:g,box:"middle"})}if(k&&S.customEffects.bottomEffects){const j=S.customEffects.bottomEffects.filter(E=>E.trigger!=="on_cover");if(j.length>0&&p(j)){if(n==="after_clear_cache"&&c.includes(y.id))return;d.push({card:y,owner:f,laneIndex:g,box:"bottom"})}}})});if(d.length===0)return delete i._processingReactiveEffects,{newState:i};for(const{card:f,owner:m,laneIndex:g,box:y}of d){const w=i[m].lanes[g],_=w==null?void 0:w.findIndex(H=>H.id===f.id);if(!(_!==void 0&&_!==-1&&((h=w[_])==null?void 0:h.isFaceUp))||y==="bottom"&&!(_===w.length-1)||n==="before_compile_delete"&&(l==null?void 0:l.cardId)!==f.id||n==="on_flip"&&(l==null?void 0:l.cardId)!==f.id||(n==="on_cover"||n==="on_flip")&&l!=null&&l.cardId&&l.cardId!==f.id)continue;const k=f,C=(y==="top"?k.customEffects.topEffects:y==="middle"?k.customEffects.middleEffects:k.customEffects.bottomEffects).filter(H=>H.trigger===n||H.trigger==="on_cover_or_flip"&&(n==="on_cover"||n==="on_flip")).filter(H=>{const $=H.reactiveTriggerActor||"self";if(!(l!=null&&l.player))return!0;if(n==="after_opponent_discard")return l.player===m;if($==="self"){if(l.player!==m)return!1}else if($==="opponent"&&l.player===m)return!1;return!((H.reactiveScope||"global")==="this_lane"&&(l==null?void 0:l.laneIndex)!==void 0&&g!==l.laneIndex)});if(C.length===0)continue;const b=`${f.protocol}-${f.value}`;i=ya(i),i=Be(i,b),i=rt(i,void 0);const T=m==="player"?"opponent":"player",A={cardOwner:m,actor:m,currentTurn:i.turn,opponent:T,triggerType:n};if(n==="after_clear_cache"){const H=i.processedClearCacheTriggerIds||[];i.processedClearCacheTriggerIds=[...H,f.id]}for(const H of C){const $=st(f,g,i,A,H);if(i=xe($.newState),i.actionRequired){const B=i._pendingCustomEffects;if(B&&B.effects.length>0){const X={type:"execute_remaining_custom_effects",sourceCardId:B.sourceCardId,laneIndex:B.laneIndex,effects:B.effects,context:B.context,actor:B.context.cardOwner};i.queuedActions=[X,...i.queuedActions||[]],delete i._pendingCustomEffects}return delete i._processingReactiveEffects,{newState:i}}}i=_o(i),i=Be(i,void 0),i=rt(i,void 0)}return delete i._processingReactiveEffects,{newState:i}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function Mn(a,n,l){let i=[...a],c=[...n],d=[],p=!1;for(let h=0;h<l;h++){if(i.length===0){if(c.length===0)break;i=kn(c),c=[],p=!0}d.push(i.shift())}return{drawnCards:d,remainingDeck:i,newDiscard:c,reshuffled:p}}function Xo(a,n,l,i="effect"){const c=a[n],{drawnCards:d,remainingDeck:p,newDiscard:h,reshuffled:f}=Mn(c.deck,c.discard,l);if(d.length===0)return a;const m=d.map(S=>({...S,id:Qe(),isFaceUp:!0})),g=m.map(S=>S.id),y={...c.stats,cardsDrawn:c.stats.cardsDrawn+d.length},w={...c,deck:p,discard:h,hand:[...c.hand,...m],stats:y};let _={...a,[n]:w,stats:{...a.stats,[n]:y}};if(_.detailedGameStats&&d.length>0){const S=i==="refresh",k=n==="player"?S?"playerFromRefresh":"playerFromEffect":S?"aiFromRefresh":"aiFromEffect";_={..._,detailedGameStats:{..._.detailedGameStats,cardsDrawn:{..._.detailedGameStats.cardsDrawn,[k]:_.detailedGameStats.cardsDrawn[k]+d.length}}}}return g.length>0&&(_.animationState={type:"drawCard",owner:n,cardIds:g}),f&&(_=ae(_,n,`${n==="player"?"Player":"Opponent"}'s deck is empty. Discard pile has been reshuffled into the deck.`)),d.length>0&&(_=jt(_,"after_draw",{player:n,count:d.length}).newState),_}function f0(a,n,l){const i=n==="player"?"opponent":"player";let c={...a};const d={...c[i]},p={...c[n]},{drawnCards:h,remainingDeck:f,newDiscard:m,reshuffled:g}=Mn(d.deck,d.discard,l);if(h.length>0){const y=h.map(S=>({...S,id:Qe(),isFaceUp:!0})),w=y.map(S=>S.id);p.hand=[...p.hand,...y];const _={...p.stats,cardsDrawn:p.stats.cardsDrawn+h.length};if(p.stats=_,d.deck=f,d.discard=m,c={...c,[n]:p,[i]:d,stats:{...c.stats,[n]:_}},w.length>0&&(c.animationState={type:"drawCard",owner:n,cardIds:w}),g&&(c=ae(c,n,`${i==="player"?"Player":"Opponent"}'s deck is empty. Discard pile has been reshuffled into the deck.`)),c.detailedGameStats&&h.length>0){const S=n==="player"?"playerFromEffect":"aiFromEffect";c={...c,detailedGameStats:{...c.detailedGameStats,cardsDrawn:{...c.detailedGameStats.cardsDrawn,[S]:c.detailedGameStats.cardsDrawn[S]+h.length}}}}}return c}function h0(a,n){const i=5-a[n].hand.length;if(i<=0)return a;const c=n==="player"?"Player":"Opponent";let d=Xo(a,n,i,"refresh");const p={...d[n],stats:{...d[n].stats,handsRefreshed:d[n].stats.handsRefreshed+1}};if(d={...d,[n]:p,stats:{...d.stats,[n]:p.stats}},d.detailedGameStats){const h=n==="player"?"playerCardsDrawn":"aiCardsDrawn";d={...d,detailedGameStats:{...d.detailedGameStats,refreshes:{...d.detailedGameStats.refreshes,[h]:d.detailedGameStats.refreshes[h]+i}}}}return ae(d,n,`${c} refreshes their hand, drawing ${i} card(s).`)}function Wo(a,n){const l={...n},i=c=>c.map(d=>d.map(p=>a.has(p.id)?{...p,isFaceUp:!p.isFaceUp}:p));return l.player.lanes=i(l.player.lanes),l.opponent.lanes=i(l.opponent.lanes),xe(l)}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Nh=a=>{const n=kn(Ia(a)),{drawnCards:l,remainingDeck:i}=Mn(n,[],5),c={cardsPlayed:0,cardsDiscarded:0,cardsDeleted:0,cardsFlipped:0,cardsShifted:0,cardsDrawn:l.length,cardsReturned:0,handsRefreshed:0},d=l.map(p=>({...p,id:Qe(),isFaceUp:!0}));return{protocols:a,deck:i,hand:d,lanes:[[],[],[]],discard:[],compiled:[!1,!1,!1],laneValues:[0,0,0],cannotCompile:!1,stats:c}},Hl=(a,n,l,i="player")=>{const c=Nh(a),d=Nh(n),p={player:c,opponent:d,turn:i,phase:"start",controlCardHolder:null,useControlMechanic:l,winner:null,log:[],actionRequired:null,queuedActions:[],animationState:null,compilableLanes:[],processedStartEffectIds:[],processedEndEffectIds:[],lastPlayedCardId:void 0,stats:{player:c.stats,opponent:d.stats},detailedGameStats:{cardsPlayed:{playerFromHand:0,playerFromEffect:0,aiFromHand:0,aiFromEffect:0,playerFaceUp:0,playerFaceDown:0,aiFaceUp:0,aiFaceDown:0},cardsDrawn:{playerFromRefresh:0,playerFromEffect:0,aiFromRefresh:0,aiFromEffect:0},compiles:{playerFirstCompile:0,playerRecompile:0,aiFirstCompile:0,aiRecompile:0},refreshes:{playerCardsDrawn:0,aiCardsDrawn:0}}},h=i==="player"?"Player":"Opponent",f=a.join(", "),m=n.join(", ");let g=ae(p,"player","Game Started.");return g=ae(g,"player",`Player protocols: ${f}`),g=ae(g,"opponent",`Opponent protocols: ${m}`),g=ae(g,"player",`${h} goes first.`),g},ea=(a,n,l,i,c)=>{if(a.isFaceUp)return a.value;if(n.some(p=>p.isFaceUp&&p.protocol==="Darkness"&&p.value===2))return 4;if(l&&i!==void 0&&c!==void 0){const p=tm(l);for(const h of p)if(h.type==="set_to_fixed"){if(!(h.scope==="global"||h.scope==="this_lane"&&h.laneIndex===i))continue;const m=h.cardOwner;if(h.target==="own_cards"&&m!==c||h.target==="opponent_cards"&&m===c)continue;const g=h.filter;if(g&&(!g.faceState||g.faceState==="any"||g.faceState==="face_down"&&!a.isFaceUp||g.faceState==="face_up"&&a.isFaceUp))return h.value}}return 2},Rh=(a,n,l,i)=>{let c=0;for(const d of a)d.isFaceUp?c+=d.value:c+=ea(d,a,n,l,i);return Math.max(0,c)};function tm(a){const n=[];for(const l of["player","opponent"])a[l].lanes.forEach((i,c)=>{i.forEach(d=>{if(d.isFaceUp){const p=d;p.customEffects&&[...p.customEffects.topEffects||[],...p.customEffects.middleEffects||[],...p.customEffects.bottomEffects||[]].forEach(f=>{f.params.action==="value_modifier"&&f.trigger==="passive"&&n.push({...f.params.modifier,cardOwner:l,laneIndex:c})})}})});return n}function m0(a,n,l){const i=tm(a),c=[...n],d=[...l];for(const p of i){const{type:h,value:f,condition:m,target:g,scope:y,filter:w,cardOwner:_,laneIndex:S}=p,k=y==="global"?[0,1,2]:[S];for(const j of k)switch(h){case"add_per_condition":{if(!m)continue;let E=0;const C=a.player.lanes[j],b=a.opponent.lanes[j];m==="per_face_down_card"?E=C.filter(T=>!T.isFaceUp).length+b.filter(T=>!T.isFaceUp).length:m==="per_face_up_card"?E=C.filter(T=>T.isFaceUp).length+b.filter(T=>T.isFaceUp).length:m==="per_card"?E=C.length+b.length:m==="per_card_in_hand"&&(E=a[_].hand.length),g==="own_total"&&_==="player"?c[j]+=f*E:g==="own_total"&&_==="opponent"||g==="opponent_total"&&_==="player"?d[j]+=f*E:g==="opponent_total"&&_==="opponent"&&(c[j]+=f*E);break}case"set_to_fixed":break;case"add_to_total":{g==="own_total"&&_==="player"?c[j]+=f:g==="own_total"&&_==="opponent"||g==="opponent_total"&&_==="player"?d[j]+=f:g==="opponent_total"&&_==="opponent"&&(c[j]+=f);break}}}return{finalPlayerValues:c.map(p=>Math.max(0,p)),finalOpponentValues:d.map(p=>Math.max(0,p))}}function y0(a,n,l){let i=[...n],c=[...l];return{finalPlayerValues:i,finalOpponentValues:c}}const xe=a=>{const n=a.player.lanes.map((p,h)=>Rh(p,a,h,"player")),l=a.opponent.lanes.map((p,h)=>Rh(p,a,h,"opponent")),i=y0(a,n,l),{finalPlayerValues:c,finalOpponentValues:d}=m0(a,i.finalPlayerValues,i.finalOpponentValues);return{...a,player:{...a.player,laneValues:c},opponent:{...a.opponent,laneValues:d}}},nm=(a,n)=>{const l=[],i=a[n],c=a[n==="player"?"opponent":"player"];if(!i.cannotCompile)for(let d=0;d<3;d++){const p=i.laneValues[d],h=c.laneValues[d];p>=10&&p>h&&l.push(d)}return l},Hn=(a,n,l)=>a[n].laneValues[l],g0=(a,n)=>{const l=n==="player"?"opponent":"player",i=[];for(let c=0;c<3;c++){const d=a[n].laneValues[c];a[l].laneValues[c]>d&&i.push(c)}return i},am=(a,n)=>{const l=n==="player"?"opponent":"player";let i=-1,c=[];for(let d=0;d<3;d++){const p=a[l].laneValues[d];p>i?(i=p,c=[d]):p===i&&c.push(d)}return c};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const v0=["select_card_to_flip","select_any_card_to_flip"];function _0(a,n,l){if(!l||!v0.includes(l.type))return null;const i=ve(a,n);if(i&&i.card.protocol==="Metal"&&i.card.value===6){const c="actor"in l?l.actor:a.turn,d=c==="player"?"Player":"Opponent",p=i.owner==="player"?"Player's":"Opponent's";let h="An effect";if("sourceCardId"in l&&l.sourceCardId){const C=ve(a,l.sourceCardId);C&&(h=`${C.card.protocol}-${C.card.value}`)}let f=ae(a,c,`${h}: ${d} flips ${p} Metal-6.`);f=ae(f,c,"Metal-6: Deletes itself when flipped.");const m={...a.stats[c],cardsDeleted:a.stats[c].cardsDeleted+1},g={...a[c],stats:m};f={...f,[c]:g,stats:{...f.stats,[c]:m}};const y=i.owner,w=a[y].lanes.findIndex(C=>C.some(b=>b.id===n)),_=a[y].lanes[w],S=_&&_.length>0&&_[_.length-1].id===n,k=_&&_.length>1,j=a._pendingCustomEffects,E=(C,b)=>{var X,I;let T={...C};const A=j&&((X=T.queuedActions)==null?void 0:X.some(F=>F.type==="execute_remaining_custom_effects"&&F.sourceCardId===j.sourceCardId));j&&!A&&(T._pendingCustomEffects=j,T.lastCustomEffectTargetCardId=n);let $=jt(T,"after_delete",{player:T.turn}).newState;if(S&&k&&($=Rn($,y,w).newState),l&&"count"in l&&l.count>1){const F=l.count-1;return $.actionRequired={...l,count:F},{...$,animationState:null}}if(T.actionRequired||T.queuedActions&&T.queuedActions.length>0)return{...$,actionRequired:T.actionRequired,queuedActions:T.queuedActions,animationState:null};const B=j&&((I=$.queuedActions)==null?void 0:I.some(F=>F.type==="execute_remaining_custom_effects"&&F.sourceCardId===j.sourceCardId));if(j&&!$._pendingCustomEffects&&!B&&($._pendingCustomEffects=j,$.lastCustomEffectTargetCardId=n),$=Ke($),$.actionRequired=null,$.queuedActions&&$.queuedActions.length>0){const F=[...$.queuedActions],N=F.shift();if((N==null?void 0:N.type)==="execute_remaining_custom_effects"){const D={...$,queuedActions:[N,...F]},P=La(D);if(P.actionRequired)return{...P,animationState:null};if(P.queuedActions&&P.queuedActions.length>0){const L=[...P.queuedActions],R=L.shift();return{...P,actionRequired:R,queuedActions:L,animationState:null}}return b(P)}return{...$,actionRequired:N,queuedActions:F,animationState:null}}return b($)};return{nextState:{...f,actionRequired:null},requiresAnimation:{animationRequests:[{type:"delete",cardId:n,owner:i.owner}],onCompleteCallback:E},requiresTurnEnd:!1}}return null}const Ad=(a,n)=>{var p,h,f,m,g,y,w,_,S,k,j,E,C,b;if(!a.actionRequired)return{nextState:a};let l={...a},i=!0,c=null;const d=_0(a,n,a.actionRequired);if(d)return d;switch(a.actionRequired.type){case"select_card_to_flip":{const T=a._committedCardId;if(T&&n===T)return{nextState:a};if(!Yl(a,n).allowed)return{nextState:a};const H=ve(a,n),$="draws"in a.actionRequired?a.actionRequired.draws:0;l=kd(a,n);const B=n;if(l.lastCustomEffectTargetCardId=B,$&&$>0){const{actor:L,sourceCardId:R}=a.actionRequired,O=ve(l,R),Z=O?`${O.card.protocol}-${O.card.value}`:"A card effect";l=ae(l,L,`${Z}: Drawing ${$} card(s).`),l=Xo(l,L,$)}if(H&&!H.card.isFaceUp){const L=Rd(l,n);l=L.newState,l.lastCustomEffectTargetCardId=B,L.animationRequests&&(c={animationRequests:L.animationRequests,onCompleteCallback:(R,O)=>R.actionRequired||R.queuedActions&&R.queuedActions.length>0?R:O(R)})}const X=(p=a.actionRequired)==null?void 0:p.followUpEffect,I=(h=a.actionRequired)==null?void 0:h.sourceCardId;X&&I&&(l=W_(l,n,I));const F=((f=a.actionRequired)==null?void 0:f.actor)||a.turn;l=jt(l,"after_flip",{player:F,cardId:n}).newState;const D=l._pendingCustomEffects;if(D&&D.effects.length>0){const L={type:"execute_remaining_custom_effects",sourceCardId:D.sourceCardId,laneIndex:D.laneIndex,effects:D.effects,context:D.context,actor:D.context.cardOwner,selectedCardFromPreviousEffect:D.effects[0].useCardFromPreviousEffect?n:void 0,logSource:D.logSource,logPhase:D.logPhase,logIndentLevel:D.logIndentLevel};l.queuedActions=[...l.queuedActions||[],L],delete l._pendingCustomEffects}const P=(m=a.actionRequired)==null?void 0:m.remainingLanes;if(P&&P.length>0&&!l.actionRequired){const L=P[0],R=P.slice(1),O=(g=a.actionRequired)==null?void 0:g.params,Z=(y=a.actionRequired)==null?void 0:y.sourceCardId,ee=(w=a.actionRequired)==null?void 0:w.actor,M=(_=a.actionRequired)==null?void 0:_.targetFilter;l.actionRequired={type:"select_card_to_flip",sourceCardId:Z,actor:ee,currentLaneIndex:L,remainingLanes:R,targetFilter:M,params:O,followUpEffect:(S=a.actionRequired)==null?void 0:S.followUpEffect,conditionalType:(k=a.actionRequired)==null?void 0:k.conditionalType}}(l.actionRequired||l.queuedActions&&l.queuedActions.length>0)&&(i=!1);break}case"select_card_to_shift":{const{sourceCardId:T,optional:A}=a.actionRequired;if(A&&T){const $=ve(a,T);if(!$||!$.card.isFaceUp){const B=$?`${$.card.protocol}-${$.card.value}`:"the source card",X=a._logSource;l=Be(a,B),l=ae(l,a.actionRequired.actor,"Shift was cancelled because the source is no longer active."),l=Be(l,X),l=Ke(l),l.actionRequired=null,i=!0;break}}const H=ve(a,n);if(H){const{owner:$}=H;let B=-1;for(let R=0;R<a[$].lanes.length;R++)if(a[$].lanes[R].some(O=>O.id===n)){B=R;break}if(B===-1)return{nextState:a,requiresTurnEnd:!1};const I=(a.actionRequired.targetFilter||{}).position||"uncovered",F=a[$].lanes[B],D=F.findIndex(R=>R.id===n)===F.length-1;if(I==="uncovered"&&!D)return{nextState:a,requiresTurnEnd:!1};if(I==="covered"&&D)return{nextState:a,requiresTurnEnd:!1};const P=a.actionRequired.scope,L=a.actionRequired.sourceLaneIndex;if(P==="this_lane"&&L!==void 0&&B!==L)return{nextState:a,requiresTurnEnd:!1};if(B!==-1){const R=a.actionRequired.targetLaneIndex;if(R!==void 0){const Z=a.actionRequired.actor;l=go(a,n,$,R,Z).newState,i=!l.actionRequired;break}const O={type:"select_lane_for_shift",cardToShiftId:n,cardOwner:$,originalLaneIndex:B,sourceCardId:a.actionRequired.sourceCardId,actor:a.actionRequired.actor,destinationRestriction:a.actionRequired.destinationRestriction,followUpEffect:a.actionRequired.followUpEffect,conditionalType:a.actionRequired.conditionalType};l.actionRequired=O}}i=!1;break}case"delete_self":{const{sourceCardId:T,cardToDeleteId:A,actor:H}=a.actionRequired,$=ve(a,A);if(!$){l=ae(a,H,"Card no longer on board. Delete skipped."),l=Ke(l),l.actionRequired=null,i=!0;break}const{owner:B,laneIndex:X}=$,I=a[B].lanes[X][a[B].lanes[X].length-1].id===A,F=[...a[B].lanes[X]],N=F.findIndex(R=>R.id===A);F.splice(N,1);const D=[...a[B].lanes];D[X]=F;let P={...a,[B]:{...a[B],lanes:D}};l=Ke(P),l.actionRequired=null;const L={...l.stats[H],cardsDeleted:l.stats[H].cardsDeleted+1};l={...l,stats:{...l.stats,[H]:L}},I&&F.length>0&&(l=Rn(l,B,X).newState),i=!0;break}case"select_cards_to_delete":case"select_face_down_card_to_delete":case"select_low_value_card_to_delete":case"select_card_from_other_lanes_to_delete":{const{sourceCardId:T,actor:A}=a.actionRequired,H=ve(a,T);if(!H||!H.card.isFaceUp){const G=H?`${H.card.protocol}-${H.card.value}`:"the source card";l=ae(a,A,`Effect from ${G} was cancelled because the source is no longer active.`),l=Ke(l),l.actionRequired=null,i=!0;break}const $=ve(a,n);if(!$)return{nextState:a};if(a.actionRequired.protocolMatching){const G=a.actionRequired.protocolMatching,K=a[$.owner].lanes.findIndex(W=>W.some(U=>U.id===n));if(K!==-1){const W=a.player.protocols[K],U=a.opponent.protocols[K],Q=$.card.protocol,Y=Q===W||Q===U;if(G==="must_match"&&!Y)return console.error(`Illegal delete: ${Q}-${$.card.value} in lane ${K} (protocols: ${W}/${U}) - card must be in lane with matching protocol`),{nextState:a};if(G==="must_not_match"&&Y)return console.error(`Illegal delete: ${Q}-${$.card.value} in lane ${K} (protocols: ${W}/${U}) - card must be in lane without matching protocol`),{nextState:a}}}const B=a.actionRequired.targetFilter;if((B==null?void 0:B.calculation)==="highest_value"||(B==null?void 0:B.calculation)==="lowest_value"){const G=B.owner,K=G==="opponent"?A==="player"?"opponent":"player":G==="own"?A:$.owner,U=Z_(a,K).some(Y=>Y.card.id===n),Q=B.calculation==="highest_value"?"highest":"lowest";if(!U)return console.error(`Illegal delete: Card ${n} is not one of the ${Q} value uncovered cards`),{nextState:a}}const X=A==="player"?"Player":"Opponent",I=$.owner==="player"?"Player's":"Opponent's",F=a[$.owner].lanes.findIndex(G=>G.some(K=>K.id===n)),N=F!==-1?a[$.owner].protocols[F]:"unknown",D=$.card.isFaceUp?`${$.card.protocol}-${$.card.value}`:`face-down card in Protocol ${N}`,P=ve(a,a.actionRequired.sourceCardId),L=P?`${P.card.protocol}-${P.card.value}`:"a card effect";l=ae(l,A,`${L}: ${X} deletes ${I} ${D}.`);const R={...l.stats[A],cardsDeleted:l.stats[A].cardsDeleted+1},O={...l[A],stats:R};l={...l,[A]:O,stats:{...l.stats,[A]:R}};const Z=a[$.owner].lanes.findIndex(G=>G.some(K=>K.id===n)),ee=a[$.owner].lanes[Z],M=ee&&ee.length>0&&ee[ee.length-1].id===n;l=Ke(l),l.actionRequired=null,c={animationRequests:[{type:"delete",cardId:n,owner:$.owner}],onCompleteCallback:(G,K)=>{var Le,Xe,nt;const W=a.actionRequired.actor,U=a.actionRequired;let Y=jt(G,"after_delete",{player:W}).newState;Y=Ke(Y);let ce=null;const te=ve(Y,U.sourceCardId),ye=vo(Y,U.sourceCardId),Se=U.followUpEffect;if(te&&te.card.isFaceUp&&ye){const we=U.remainingLanes;if(U.type==="select_cards_to_delete"&&we&&we.length>0){const Ce=we[0],Ie=we.slice(1);ce={type:"select_cards_to_delete",count:((Le=U.params)==null?void 0:Le.count)||U.count,sourceCardId:U.sourceCardId,actor:U.actor,currentLaneIndex:Ce,remainingLanes:Ie,disallowedIds:(Xe=U.params)!=null&&Xe.excludeSelf?[U.sourceCardId]:[],targetFilter:U.targetFilter,scope:U.scope,protocolMatching:U.protocolMatching,params:U.params}}else if(U.type==="select_cards_to_delete"&&U.count>1)ce={type:"select_cards_to_delete",count:U.count-1,sourceCardId:U.sourceCardId,disallowedIds:[...U.disallowedIds,n],actor:U.actor,followUpEffect:Se};else if(U.type==="select_card_from_other_lanes_to_delete"&&U.count>1){const Ce=a[$.owner].lanes.findIndex(Ye=>Ye.some(qt=>qt.id===n)),Ie=[...U.lanesSelected,Ce];[0,1,2].filter(Ye=>Ye!==U.disallowedLaneIndex&&!Ie.includes(Ye)).some(Ye=>Y.player.lanes[Ye].length>0||Y.opponent.lanes[Ye].length>0)?ce={type:"select_card_from_other_lanes_to_delete",count:U.count-1,sourceCardId:U.sourceCardId,disallowedLaneIndex:U.disallowedLaneIndex,lanesSelected:Ie,actor:U.actor}:Y=ae(Y,U.actor,"No cards left in remaining lanes. Effect skipped.")}}else if("count"in U&&U.count>1){const we=te?`${te.card.protocol}-${te.card.value}`:"the source card",Ce=!te||!te.card.isFaceUp?"the source is no longer active":"the source was covered";Y=ae(Y,U.actor,`Remaining deletes from ${we} were cancelled because ${Ce}.`)}let ge=!1;if(M){const we=Y,Ce=Rn(we,$.owner,Z),Ie=Ce.newState._interruptedTurn!==void 0;we._interruptedTurn&&!Ce.newState._interruptedTurn&&(ge=!0);const He=[...Ce.newState.queuedActions||[]];ce&&(Ie?He.push(ce):He.unshift(ce)),Y={...Ce.newState,queuedActions:He}}else ce&&(Y.queuedActions=[...Y.queuedActions||[],ce]);if(Se&&!ce)if(Y.actionRequired){const we=ve(Y,U.sourceCardId),Ce=U.actor==="player"?"opponent":"player";let Ie=-1;we&&(Ie=Y[we.owner].lanes.findIndex(Ye=>Ye.some(qt=>qt.id===U.sourceCardId)));const He={cardOwner:U.actor,actor:U.actor,currentTurn:Y.turn,opponent:Ce,triggerType:"start"},gt={type:"execute_remaining_custom_effects",sourceCardId:U.sourceCardId,actor:U.actor,laneIndex:Ie,effects:[Se],context:He,logSource:Y._currentEffectSource,logPhase:Y._currentPhaseContext,logIndentLevel:Y._logIndentLevel||0};Y.queuedActions=[...Y.queuedActions||[],gt]}else{const we=ve(Y,U.sourceCardId),Ce=U.actor==="player"?"opponent":"player";if(we){const Ie=Y[we.owner].lanes.findIndex(qt=>qt.some(Zt=>Zt.id===U.sourceCardId)),He={cardOwner:U.actor,actor:U.actor,currentTurn:Y.turn,opponent:Ce,triggerType:"start"},gt=`${we.card.protocol}-${we.card.value}`;Y=Be(Y,gt),Y=rt(Y,"start"),Y=st(we.card,Ie,Y,He,Se).newState,Y=Ke(Y)}else(nt=Se.params)!=null&&nt.deleteSelf&&(Y=Be(Y,"the source card"),Y=rt(Y,"start"),Y=internalDeleteCard(Y,U.sourceCardId).newState,Y=ae(Y,U.actor,"Deletes itself."))}if(Y.actionRequired)return Y;if(Y.queuedActions&&Y.queuedActions.length>0){const we=Y.queuedActions[0];if((we==null?void 0:we.type)==="execute_remaining_custom_effects"){const He=La(Y);return He.actionRequired?He:K(He)}const Ce=[...Y.queuedActions],Ie=Ce.shift();if((Ie==null?void 0:Ie.type)==="shift_flipped_card_optional"||(Ie==null?void 0:Ie.type)==="gravity_2_shift_after_flip"){const He=ve(Y,Ie.sourceCardId),gt=vo(Y,Ie.sourceCardId);if(!He||!He.card.isFaceUp||!gt){const Ye=He?`${He.card.protocol}-${He.card.value}`:"the source card";let qt=ae(Y,Ie.actor,`Shift from ${Ye} was cancelled because the source is no longer active.`);if(Ce.length>0){const Zt=Ce.shift();return{...qt,actionRequired:Zt,queuedActions:Ce}}else return K({...qt,actionRequired:null,queuedActions:[]})}}return{...Y,actionRequired:Ie,queuedActions:Ce}}if(ge){if(Y.queuedActions&&Y.queuedActions.length>0){const we=[...Y.queuedActions],Ce=we.shift();if((Ce==null?void 0:Ce.type)==="execute_remaining_custom_effects"){const Ie={...Y,queuedActions:[Ce,...we]},He=La(Ie);return He.actionRequired?He:Y}return{...Y,actionRequired:Ce,queuedActions:we}}return Y}if(Se&&te&&te.card.isFaceUp&&(!((Se.position||"middle")!=="top")||ye)){const He=Y[te.owner].lanes.findIndex(vn=>vn.some(zn=>zn.id===U.sourceCardId)),gt=U.actor==="player"?"opponent":"player",Ye=Se.trigger||"on_play",qt={cardOwner:U.actor,actor:U.actor,currentTurn:Y.turn,opponent:gt,triggerType:Ye};if(Y=st(te.card,He,Y,qt,Se).newState,ve(Y,U.sourceCardId),Y.actionRequired)return Y}return K(Y)}},i=!1;break}case"plague_4_opponent_delete":{const T=ve(a,n);if(!T)return{nextState:a};const A=a.actionRequired.actor;l=ae(l,A,"Plague-4: Opponent deletes one of their face-down cards.");const H={...l.stats[A],cardsDeleted:l.stats[A].cardsDeleted+1},$={...l[A],stats:H};l={...l,[A]:$,stats:{...l.stats,[A]:H}};const B=a[T.owner].lanes.findIndex(F=>F.some(N=>N.id===n)),X=a[T.owner].lanes[B],I=X&&X.length>0&&X[X.length-1].id===n;l=Ke(l),l.actionRequired=null,c={animationRequests:[{type:"delete",cardId:n,owner:T.owner}],onCompleteCallback:(F,N)=>{let P=jt(F,"after_delete",{player:A}).newState;I&&(P=Rn(P,T.owner,B).newState);const L=ve(P,a.actionRequired.sourceCardId),R=(L==null?void 0:L.owner)||a.turn,O={type:"plague_4_player_flip_optional",sourceCardId:a.actionRequired.sourceCardId,optional:!0,actor:R};return P.actionRequired?P.queuedActions=[...P.queuedActions||[],O]:P.actionRequired=O,P}},i=!1;break}case"select_card_to_return":{const{sourceCardId:T,actor:A}=a.actionRequired,H=(j=a.actionRequired)==null?void 0:j.followUpEffect,$=(E=a.actionRequired)==null?void 0:E.conditionalType,B=(C=a.actionRequired)==null?void 0:C.targetFilter,X=ve(a,n);if(X){const F=a[X.owner].lanes[X.laneIndex],N=((b=F[F.length-1])==null?void 0:b.id)===n,D=(B==null?void 0:B.position)==="covered"||(B==null?void 0:B.position)==="any";if(!N&&!D)return console.error(`[cardResolver] Invalid return target: ${X.card.protocol}-${X.card.value} is covered`),{nextState:a,requiresTurnEnd:!1}}const I=Nd(a,n);if(l=I.newState,I.animationRequests)c={animationRequests:I.animationRequests,onCompleteCallback:(F,N)=>{if(F.actionRequired)return F;let D=F;if(H&&T&&($!=="if_executed"||n)){const L=ve(D,T);if(L&&L.card.isFaceUp){const R=D[L.owner].lanes.find(M=>M.some(G=>G.id===T)),O=D[L.owner].lanes.indexOf(R),Z={cardOwner:L.owner,actor:A,currentTurn:D.turn,opponent:L.owner==="player"?"opponent":"player"};if(D=st(L.card,O,D,Z,H).newState,D.actionRequired)return D}}return N(D)}};else if(H&&T&&($!=="if_executed"||n)){const N=ve(l,T);if(N&&N.card.isFaceUp){const D=l[N.owner].lanes.find(O=>O.some(Z=>Z.id===T)),P=l[N.owner].lanes.indexOf(D),L={cardOwner:N.owner,actor:A,currentTurn:l.turn,opponent:N.owner==="player"?"opponent":"player"};l=st(N.card,P,l,L,H).newState}}l=Ke(l),i=!l.actionRequired&&(!l.queuedActions||l.queuedActions.length===0);break}case"select_opponent_card_to_return":{const{sourceCardId:T,actor:A}=a.actionRequired,H=Nd(a,n);let $=H.newState;if($.actionRequired){const B={type:"flip_self",sourceCardId:T,actor:A};$.queuedActions=[B,...$.queuedActions||[]],l=$,i=!1}else{const B=ve($,T);if(B){const X=`${B.card.protocol}-${B.card.value}`;$=ae($,A,`${X}: Flips itself.`),$=Wo(new Set([T]),$),$.animationState={type:"flipCard",cardId:T}}l=$,i=!0}H.animationRequests&&(c={animationRequests:H.animationRequests,onCompleteCallback:(B,X)=>B.actionRequired?B:X(B)}),l=Ke(l),i||(i=!l.actionRequired&&(!l.queuedActions||l.queuedActions.length===0));break}case"select_any_card_to_flip":{const T=ve(a,n),{count:A,sourceCardId:H,actor:$}=a.actionRequired,B=ve(a,H);if(!B||!B.card.isFaceUp){const F=B?`${B.card.protocol}-${B.card.value}`:"a card";l=ae(a,$,`Effect from ${F} was cancelled because the source is no longer active.`),l=Ke(l),l.actionRequired=null,i=!0;break}let X=null;A>1&&(X={type:"select_any_card_to_flip",count:A-1,sourceCardId:H,actor:$});let I=kd(a,n,X);if(T&&!T.card.isFaceUp){const F=Rd(I,n),N=F.newState.actionRequired;N&&N!==X&&X&&(F.newState.queuedActions=[...F.newState.queuedActions||[],X]),l=F.newState,F.animationRequests&&(c={animationRequests:F.animationRequests,onCompleteCallback:(D,P)=>D.actionRequired||D.queuedActions&&D.queuedActions.length>0?D:P(D)})}else l=I;l=Ke(l),i=!l.actionRequired&&(!l.queuedActions||l.queuedActions.length===0);break}case"select_board_card_to_reveal_custom":{const{sourceCardId:T,actor:A,followUpAction:H,optional:$}=a.actionRequired,B=A.charAt(0).toUpperCase()+A.slice(1),X=ve(a,n);if(!X)return{nextState:a,requiresTurnEnd:!0};const I=X.owner,F=a[I].lanes.findIndex(R=>R.some(O=>O.id===n));if(F===-1)return{nextState:a,requiresTurnEnd:!0};const N=[...a[I].lanes[F]],D=N.findIndex(R=>R.id===n);if(D===-1)return{nextState:a,requiresTurnEnd:!0};N[D]={...N[D],isFaceUp:!0};const P=[...a[I].lanes];P[F]=N,l={...a,[I]:{...a[I],lanes:P}};const L=`${N[D].protocol}-${N[D].value}`;l=ae(l,A,`${B} reveals ${L}.`),l.actionRequired={type:"prompt_shift_or_flip_board_card_custom",sourceCardId:T,revealedCardId:n,followUpAction:H,optional:$!==!1,actor:A},i=!1;break}case"select_phase_effect":{const T=a.actionRequired;if(!T.availableEffects.find($=>$.cardId===n))return console.warn(`[cardResolver] Invalid phase effect selection: ${n} not in available effects`),{nextState:a};const H=T.phase==="Start"?"_selectedStartEffectId":"_selectedEndEffectId";l[H]=n,l.actionRequired=null,i=!1;break}default:return{nextState:a,requiresTurnEnd:!0}}if(!c&&l.actionRequired===null){if(l.queuedActions&&l.queuedActions.length>0){const T=[...l.queuedActions],A=T.shift();if((A==null?void 0:A.type)==="execute_remaining_custom_effects")return{nextState:{...Ke(l),actionRequired:null,queuedActions:[A,...T]},requiresTurnEnd:!1};if((A==null?void 0:A.type)==="shift_flipped_card_optional"||(A==null?void 0:A.type)==="gravity_2_shift_after_flip"){const H=ve(l,A.sourceCardId),$=vo(l,A.sourceCardId);if(!H||!H.card.isFaceUp||!$){const B=H?`${H.card.protocol}-${H.card.value}`:"the source card",X=ae(l,A.actor,`Shift from ${B} was cancelled because the source is no longer active.`);if(T.length>0){const I=T.shift();return(I==null?void 0:I.type)==="execute_remaining_custom_effects"?{nextState:{...X,queuedActions:[I,...T]},requiresTurnEnd:!1}:{nextState:{...X,actionRequired:I,queuedActions:T},requiresTurnEnd:!1}}else return{nextState:{...X,actionRequired:null,queuedActions:[]},requiresTurnEnd:!0}}}return(A==null?void 0:A.type)==="execute_remaining_custom_effects"?{nextState:{...l,queuedActions:[A,...T]},requiresTurnEnd:!1}:{nextState:{...l,actionRequired:A,queuedActions:T},requiresTurnEnd:!1}}}else!c&&l.actionRequired!==null&&(i=!1);return{nextState:l,requiresAnimation:c,requiresTurnEnd:i}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const pi=(a,n,l,i,c,d=c)=>{const p={...a[c]},h=p.hand.find(D=>D.id===n);if(!h)return{newState:a};if(d===c){const D=Pa(a,c,l,i,h.protocol,h);if(!D.allowed)return console.error(`Illegal Move: ${c} tried to play ${h.protocol}-${h.value} - ${D.reason}`),{newState:a}}const f=c==="player"?"opponent":"player",g=a[d==="player"?"opponent":"player"].lanes[l],y=g.length>0?g[g.length-1]:null;if(y&&y.isFaceUp&&y.protocol==="Plague"&&y.value===0)return{newState:a};if(!i&&y&&y.isFaceUp&&y.protocol==="Metal"&&y.value===2)return console.error(`Illegal Move: ${c} tried to play face-down against Metal-2 in lane ${l}`),{newState:a};if(i){const D=a[d].protocols[l],P=p.protocols[l],L=a[f].protocols[l],R=a[f].lanes.flat().some(U=>U.isFaceUp&&U.protocol==="Psychic"&&U.value===1),O=[...a.player.lanes.flat(),...a.opponent.lanes.flat()].some(U=>U.isFaceUp&&U.protocol==="Anarchy"&&U.value===1),Z=vi(a),ee=a[c].lanes.flat().some(U=>U.isFaceUp&&U.protocol==="Spirit"&&U.value===1),M=a[c].lanes.some(U=>{if(U.length===0)return!1;const Q=U[U.length-1];return Q.isFaceUp&&Q.protocol==="Chaos"&&Q.value===3}),G=_i(a,c,l),K=Wl(a,h);let W;if(K?W=!R:d!==c?W=h.protocol===D&&!R:O||Z?W=h.protocol!==P&&h.protocol!==L&&!R:W=(h.protocol===P||h.protocol===L||ee||M||G)&&!R,!W){const U=O||Z?"Non-matching protocol required":"matching protocol required";return console.error(`Illegal Move: ${c} tried to play ${h.protocol}-${h.value} face-up in lane ${l} (${U}, protocols: player=${P}, opponent=${L})`),{newState:a}}}let w={...a,_committedCardId:n};w=Be(w,void 0),w=rt(w,void 0),w={...w,_logIndentLevel:0};const _=c==="player"?"Player":"Opponent",S=w[d].protocols[l];let k;if(c==="opponent"&&!i)k=`${_} plays a face-down card into Protocol ${S}.`;else{const D=`${h.protocol}-${h.value}`;k=`${_} plays ${D}`,i||(k+=" face-down"),d!==c?k+=` into ${d==="player"?"Player's":"Opponent's"} Protocol ${S}.`:k+=` into Protocol ${S}.`}w=ae(w,c,k),w=ya(w);let j={newState:w};const E=w[d].lanes[l];if(E.length>0){const D=E[E.length-1];let L=jt(w,"on_cover",{player:d,cardId:D.id}).newState;if(L[d].lanes[l].some(Z=>Z.id===D.id)&&D.isFaceUp){const Z={cardOwner:d,actor:c,currentTurn:L.turn,opponent:d==="player"?"opponent":"player",triggerType:"cover"};j=Ld(D,l,L,Z)}else j={newState:L}}const C=j.newState,b={...h,isFaceUp:i,isRevealed:!1},T={...C[c]},A={...T.stats,cardsPlayed:T.stats.cardsPlayed+1},H=c==="player"?"playerFromHand":"aiFromHand",$=c==="player"?i?"playerFaceUp":"playerFaceDown":i?"aiFaceUp":"aiFaceDown",B=C.detailedGameStats?{...C.detailedGameStats,cardsPlayed:{...C.detailedGameStats.cardsPlayed,[H]:C.detailedGameStats.cardsPlayed[H]+1,[$]:C.detailedGameStats.cardsPlayed[$]+1}}:void 0;let X;if(d===c){const D={...T,hand:T.hand.filter(P=>P.id!==n),lanes:T.lanes.map((P,L)=>L===l?[...P,b]:P),stats:A};X={...C,[c]:D,stats:{...C.stats,[c]:A},detailedGameStats:B}}else{const D={...T,hand:T.hand.filter(R=>R.id!==n),stats:A},P={...C[d]},L={...P,lanes:P.lanes.map((R,O)=>O===l?[...R,b]:R)};X={...C,[c]:D,[d]:L,stats:{...C.stats,[c]:A},detailedGameStats:B}}const I=a.queuedActions||[],F=C.queuedActions||[];if(F===I||F.length===I.length&&F.every((D,P)=>D===I[P])?I.length>0&&(X.queuedActions=I):X.queuedActions=[...I,...F],X.lastPlayedCardId=b.id,X=xe(X),C.actionRequired||(X={...X,_logIndentLevel:0}),X=jt(X,"after_play",{player:c,cardId:b.id,laneIndex:l}).newState,C.actionRequired)return i&&(X.queuedEffect={card:b,laneIndex:l}),{newState:X,animationRequests:j.animationRequests};{if(X={...X,_committedCardId:void 0},c==="opponent")return i&&(X.queuedEffect={card:b,laneIndex:l}),{newState:X,animationRequests:j.animationRequests};let D={newState:X};if(i&&!X.actionRequired){const L={cardOwner:d,actor:c,currentTurn:X.turn,opponent:d==="player"?"opponent":"player",triggerType:"play"};D=Zl(b,l,X,L)}const P=[...j.animationRequests||[],...D.animationRequests||[]];return{newState:D.newState,animationRequests:P.length>0?P:void 0}}},Xl=(a,n)=>{let l=Be(a,void 0);return l=rt(l,void 0),l={...l,_logIndentLevel:0},h0(l,n)},om=(a,n)=>{if(a.useControlMechanic&&a.controlCardHolder===n){let l=ae(a,n,`${n==="player"?"Player":"Opponent"} has Control and may rearrange protocols before refreshing.`);return l=ya(l),{...l,controlCardHolder:null,actionRequired:{type:"prompt_use_control_mechanic",sourceCardId:"CONTROL_MECHANIC",actor:n,originalAction:{type:"fill_hand"}}}}return Xl(a,n)};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Dd=(a,n)=>{var c,d,p,h,f,m,g,y,w,_,S,k,j,E,C;if(!a.actionRequired)return{nextState:a};let l={...a},i=null;switch(a.actionRequired.type){case"select_lane_for_shift_all":{const{cardsToShift:b,validDestinationLanes:T,sourceLaneIndex:A,actor:H,sourceCardId:$}=a.actionRequired;if(!T.includes(n))return console.error(`Illegal shift: Lane ${n} is not a valid destination`),{nextState:a};if(n===A)return console.error(`Illegal shift: Cannot shift to the same lane ${A}`),{nextState:a};let B={...a};const X=[];for(const{cardId:I,owner:F}of b){if(!ve(B,I))continue;const D=B[F].lanes.findIndex(R=>R.some(O=>O.id===I));if(D===-1||!Ql(B,D,n).allowed)continue;const L=go(B,I,F,n,H);B=L.newState,L.animationRequests&&X.push(...L.animationRequests)}if(l=B,l=Ke(l),l.actionRequired=null,X.length>0){const I=(c=a.actionRequired)==null?void 0:c.followUpEffect,F=(d=a.actionRequired)==null?void 0:d.conditionalType;i={animationRequests:X,onCompleteCallback:(N,D)=>{if(N.actionRequired||N.queuedActions&&N.queuedActions.length>0)return N;let P=N;if(I&&$&&(F!=="if_executed"||X.length>0)){const R=ve(P,$);if(R&&R.card.isFaceUp){const O=P[R.owner].lanes.find(G=>G.some(K=>K.id===$)),Z=P[R.owner].lanes.indexOf(O),ee={cardOwner:R.owner,actor:H,currentTurn:P.turn,opponent:R.owner==="player"?"opponent":"player"};if(P=st(R.card,Z,P,ee,I).newState,P.actionRequired)return P}}return D(P)}}}break}case"select_lane_for_shift":{const{cardToShiftId:b,cardOwner:T,actor:A,sourceEffect:H,originalLaneIndex:$,sourceCardId:B}=a.actionRequired;if(n===$)return console.error(`Illegal shift: Cannot shift to the same lane ${$}`),{nextState:a};const X=a.actionRequired.validLanes;if(X&&!X.includes(n))return console.error(`Illegal shift: Lane ${n} not in valid lanes ${X}`),{nextState:a};const I=ve(a,B),F=ve(a,b);if(I&&I.card.protocol==="Anarchy"&&I.card.value===1&&F&&F.card.isFaceUp){const L=a.player.protocols[n],R=a.opponent.protocols[n],O=F.card.protocol;if(O===L||O===R)return console.error(`Illegal Anarchy-1 shift: ${O}-${F.card.value} cannot be shifted to lane ${n} (protocols: ${L}/${R}) - matching protocol not allowed`),{nextState:a}}if(I&&I.card.protocol==="Gravity"&&I.card.value===1){let L=-1;for(let R=0;R<a[I.owner].lanes.length;R++)if(a[I.owner].lanes[R].some(O=>O.id===B)){L=R;break}if(L!==-1&&!($===L)&&!(n===L))return console.error(`Illegal Gravity-1 shift: Must shift to or from Gravity lane ${L}, but tried ${$}  ${n}`),{nextState:a}}if(a.actionRequired.destinationRestriction&&F){const L=a.actionRequired.destinationRestriction;if(L.type==="non_matching_protocol"&&F.card.isFaceUp){const R=a.player.protocols[n],O=a.opponent.protocols[n],Z=F.card.protocol;if(Z===R||Z===O)return console.error(`Illegal shift: ${Z} cannot be shifted to lane ${n} (protocols: ${R}/${O}) - matching protocol not allowed`),{nextState:a}}if(L.type==="to_or_from_this_lane"){const R=L.laneIndex==="current"&&I?(()=>{for(let O=0;O<a[I.owner].lanes.length;O++)if(a[I.owner].lanes[O].some(Z=>Z.id===B))return O;return-1})():L.laneIndex;if(R!==void 0&&R!==-1&&!($===R)&&!(n===R))return console.error(`Illegal shift: Must shift to or from lane ${R}, but tried ${$}  ${n}`),{nextState:a}}}const N=Ql(a,$,n);if(!N.allowed)return console.error(`Illegal shift: Cannot shift from lane ${$} to ${n} - ${N.reason}`),{nextState:a};const D=go(a,b,T,n,A);l=D.newState;const P=l.actionRequired!==null;if(D.animationRequests)i={animationRequests:D.animationRequests,onCompleteCallback:(L,R)=>{var K,W,U,Q;let O=L;if(P){if(H==="speed_3_end"){const Se={type:"speed_3_self_flip_after_shift",sourceCardId:a.actionRequired.sourceCardId,actor:A};O.queuedActions=[...O.queuedActions||[],Se]}const Y=(K=a.actionRequired)==null?void 0:K.followUpEffect,ce=(W=a.actionRequired)==null?void 0:W.conditionalType;if(Y&&B&&(ce!=="if_executed"||b)){const Se=ve(O,B),ge=a._currentPhaseContext||(a.phase==="start"?"start":"end"),Fe={type:"execute_follow_up_effect",sourceCardId:B,followUpEffect:Y,actor:A,logContext:{indentLevel:1,sourceCardName:Se?`${Se.card.protocol}-${Se.card.value}`:void 0,phase:ge}};O.queuedActions=[...O.queuedActions||[],Fe]}ve(O,B);const te=O._pendingCustomEffects;if(te){const ye=ve(O,te.sourceCardId);if(ye&&ye.card.isFaceUp){const Se=O[ye.owner].lanes.find(Fe=>Fe.some(Le=>Le.id===te.sourceCardId));if(Se&&Se.length>0&&Se[Se.length-1].id===te.sourceCardId){const Fe={type:"execute_remaining_custom_effects",sourceCardId:te.sourceCardId,laneIndex:te.laneIndex,effects:te.effects,context:te.context,actor:A,logSource:te.logSource,logPhase:te.logPhase,logIndentLevel:te.logIndentLevel};O.queuedActions=[...O.queuedActions||[],Fe]}}delete O._pendingCustomEffects}return O}if(H==="speed_3_end"){const Y=a.actionRequired.sourceCardId;O=ae(O,A,"Speed-3: Flipping itself after shifting a card."),O=Wo(new Set([Y]),O),O.animationState={type:"flipCard",cardId:Y}}const Z=O._pendingCustomEffects;if(Z){const Y=ve(O,Z.sourceCardId);if(Y&&Y.card.isFaceUp){const ce=O[Y.owner].lanes.find(ye=>ye.some(Se=>Se.id===Z.sourceCardId));if(ce&&ce.length>0&&ce[ce.length-1].id===Z.sourceCardId){for(const ye of Z.effects)O=st(Y.card,Z.laneIndex,O,Z.context,ye).newState;delete O._pendingCustomEffects}else O=ae(O,A,"Pending effects cancelled because source card is now covered."),delete O._pendingCustomEffects}else delete O._pendingCustomEffects}B&&(O=_o(O)),O=jt(O,"after_shift",{player:A,cardId:b}).newState;const M=(U=a.actionRequired)==null?void 0:U.followUpEffect,G=(Q=a.actionRequired)==null?void 0:Q.conditionalType;if(M&&B&&(G!=="if_executed"||b)){const ce=ve(O,B);if(ce&&ce.card.isFaceUp){const te=O[ce.owner].lanes.find(Xe=>Xe.some(nt=>nt.id===B)),ye=O[ce.owner].lanes.indexOf(te),Se={cardOwner:ce.owner,actor:A,currentTurn:O.turn,opponent:ce.owner==="player"?"opponent":"player"},ge=`${ce.card.protocol}-${ce.card.value}`,Fe=a._currentPhaseContext||(a.phase==="start"?"start":"end");O={...O,_logIndentLevel:1,_currentEffectSource:ge,_currentPhaseContext:Fe},O=st(ce.card,ye,O,Se,M).newState}}if(O=Ke(O),O.actionRequired=null,O.queuedActions&&O.queuedActions.length>0){const Y=O.queuedActions[0];Y.type==="execute_remaining_custom_effects"?(O=La(O),O.animationState&&(O={...O,animationState:null})):(O.queuedActions=O.queuedActions.slice(1),O.actionRequired=Y)}return O._interruptedTurn?Hr(O):R(O)}};else if(P){if(H==="speed_3_end"){const Z={type:"speed_3_self_flip_after_shift",sourceCardId:a.actionRequired.sourceCardId,actor:A};l.queuedActions=[...l.queuedActions||[],Z]}const L=(p=a.actionRequired)==null?void 0:p.followUpEffect,R=(h=a.actionRequired)==null?void 0:h.conditionalType;if(L&&B&&(R!=="if_executed"||b)){const Z=ve(l,B),ee=a._currentPhaseContext||(a.phase==="start"?"start":"end"),M={type:"execute_follow_up_effect",sourceCardId:B,followUpEffect:L,actor:A,logContext:{indentLevel:1,sourceCardName:Z?`${Z.card.protocol}-${Z.card.value}`:void 0,phase:ee}};l.queuedActions=[...l.queuedActions||[],M]}}else{if(H==="speed_3_end"){const ee=a.actionRequired.sourceCardId;l=ae(l,A,"Speed-3: Flipping itself after shifting a card."),l=Wo(new Set([ee]),l),l.animationState={type:"flipCard",cardId:ee}}const L=l._pendingCustomEffects;if(L){const ee=ve(l,L.sourceCardId);if(ee&&ee.card.isFaceUp){const M=l[ee.owner].lanes.find(K=>K.some(W=>W.id===L.sourceCardId));if(M&&M.length>0&&M[M.length-1].id===L.sourceCardId){for(const K of L.effects)l=st(ee.card,L.laneIndex,l,L.context,K).newState;delete l._pendingCustomEffects}else l=ae(l,A,"Pending effects cancelled because source card is now covered."),delete l._pendingCustomEffects}else delete l._pendingCustomEffects}B&&(l=_o(l)),l=jt(l,"after_shift",{player:A,cardId:b}).newState;const O=(f=a.actionRequired)==null?void 0:f.followUpEffect,Z=(m=a.actionRequired)==null?void 0:m.conditionalType;if(O&&B&&(Z!=="if_executed"||b)){const M=ve(l,B);if(M&&M.card.isFaceUp){const G=l[M.owner].lanes.find(ce=>ce.some(te=>te.id===B)),K=l[M.owner].lanes.indexOf(G),W={cardOwner:M.owner,actor:A,currentTurn:l.turn,opponent:M.owner==="player"?"opponent":"player"},U=`${M.card.protocol}-${M.card.value}`,Q=a._currentPhaseContext||(a.phase==="start"?"start":"end");l={...l,_logIndentLevel:1,_currentEffectSource:U,_currentPhaseContext:Q},l=st(M.card,K,l,W,O).newState}}if(l=Ke(l),l.actionRequired=null,l.queuedActions&&l.queuedActions.length>0){const ee=l.queuedActions[0];if(ee.type==="execute_remaining_custom_effects"){if(l=La(l),l.animationState&&!l.actionRequired){const M=l.animationState;M.type==="draw"&&(i={animationRequests:[{type:"draw",player:M.player,count:M.count}],onCompleteCallback:(G,K)=>{const W={...G,animationState:null};return K(W)}},l={...l,animationState:null})}}else l.queuedActions=l.queuedActions.slice(1),l.actionRequired=ee}}break}case"shift_flipped_card_optional":{const b=a.actionRequired.cardId,T=a.actionRequired.actor;let A=null;for(const I of["player","opponent"])if(a[I].lanes.flat().some(F=>F.id===b)){A=I;break}if(!A){console.error("[shift_flipped_card_optional] Card not found on board:",b),l=a;break}const H=(g=a.actionRequired)==null?void 0:g.followUpEffect,$=(y=a.actionRequired)==null?void 0:y.conditionalType,B=(w=a.actionRequired)==null?void 0:w.sourceCardId,X=go(a,b,A,n,T);if(l=X.newState,H&&B&&($!=="if_executed"||b)){const F=ve(l,B),N=a._currentPhaseContext||(a.phase==="start"?"start":"end"),D={type:"execute_follow_up_effect",sourceCardId:B,followUpEffect:H,actor:T,logContext:{indentLevel:1,sourceCardName:F?`${F.card.protocol}-${F.card.value}`:void 0,phase:N}};l={...l,queuedActions:[...l.queuedActions||[],D]}}X.animationRequests&&(i={animationRequests:X.animationRequests,onCompleteCallback:(I,F)=>F(I)});break}case"select_lane_for_play":{const{cardInHandId:b,isFaceDown:T,actor:A,source:H,disallowedLaneIndex:$,validLanes:B,preSelectedLane:X}=a.actionRequired,I=X!==void 0?X:n;if($!==void 0&&I===$)return{nextState:a,requiresTurnEnd:!1};if(B&&!B.includes(I))return{nextState:a,requiresTurnEnd:!1};if(H==="deck"){const R={...a,actionRequired:null},O=R[A],{drawnCards:Z,remainingDeck:ee,newDiscard:M}=Mn(O.deck,O.discard,1);if(Z.length===0){console.error("No cards in deck/discard to play"),l=R;break}const G={...Z[0],id:Qe(),isFaceUp:!T},K=[...O.lanes];K[I]=[...K[I],G];const W={...O,lanes:K,deck:ee,discard:M};l={...R,[A]:W},i={animationRequests:[{type:"play",cardId:G.id,owner:A,laneIndex:I,isFaceUp:G.isFaceUp}],onCompleteCallback:(U,Q)=>Q(U)};break}const F=a[A].hand.find(R=>R.id===b);if(!F){console.error("Card for play not found in hand"),l={...a,actionRequired:null};break}const N={...a,actionRequired:null};let D;if(typeof T=="boolean")D=!T;else{const R=a[A].lanes.flat().some(M=>M.isFaceUp&&M.protocol==="Spirit"&&M.value===1),O=a[A].lanes.some(M=>{if(M.length===0)return!1;const G=M[M.length-1];return G.isFaceUp&&G.protocol==="Chaos"&&G.value===3}),Z=A==="player"?"opponent":"player",ee=a[Z].lanes.flat().some(M=>M.isFaceUp&&M.protocol==="Psychic"&&M.value===1);D=(R||O||F.protocol===a[A].protocols[I]||F.protocol===a[Z].protocols[I])&&!ee}const{newState:P,animationRequests:L}=pi(N,b,I,D,A);l=P,L&&(i={animationRequests:L,onCompleteCallback:(R,O)=>(R.queuedActions&&R.queuedActions.length>0,O(R))});break}case"select_lane_for_delete":{const b=a.actionRequired.actor,T=b==="player"?"Player":"Opponent",A=a.player.protocols[n],H=a.actionRequired.targetFilter||{},$=ve(a,a.actionRequired.sourceCardId),B=$?`${$.card.protocol}-${$.card.value}`:"a card effect",X=a.actionRequired.count||1,I=a.actionRequired.deleteAll===!0,F=a.actionRequired.validLanes;if(F&&!F.includes(n))return console.error(`Illegal delete lane selection: Lane ${n} not in valid lanes ${F}`),{nextState:a};l=ae(l,b,`${B}: ${T} targets Protocol ${A}.`);const N=new Map;for(const R of["player","opponent"]){const O=a[R].lanes[n];N.set(R,O.length>0?O[O.length-1].id:null)}const D=[],P=[],L=new Set;for(const R of["player","opponent"]){const O=a[R],Z=O.lanes[n].some(M=>M.isFaceUp&&M.protocol==="Darkness"&&M.value===2)?4:2,ee=O.lanes[n];for(let M=0;M<ee.length;M++){const G=ee[M],K=M===ee.length-1,W=G.isFaceUp?G.value:Z;if(H.valueRange){const{min:Y,max:ce}=H.valueRange;if(W<Y||W>ce)continue}if(H.faceState==="face_up"&&!G.isFaceUp||H.faceState==="face_down"&&G.isFaceUp||H.owner==="own"&&R!==b||H.owner==="opponent"&&R===b||H.position==="uncovered"&&!K||H.position==="covered"&&K)continue;D.push({type:"delete",cardId:G.id,owner:R}),L.add(G.id);const U=R==="player"?"Player's":"Opponent's",Q=G.isFaceUp?`${G.protocol}-${G.value}`:"a face-down card";if(P.push(`${U} ${Q}`),!I&&D.length>=X)break}if(!I&&D.length>=X)break}if(P.length>0){l=ae(l,b,`${B}: Deleting ${P.join(", ")}.`);const R={...l.stats[b],cardsDeleted:l.stats[b].cardsDeleted+P.length},O={...l[b],stats:R};l={...l,[b]:O,stats:{...l.stats,[b]:R}}}if(l=Ke(l),l.actionRequired=null,D.length>0){const R=(_=a.actionRequired)==null?void 0:_.followUpEffect,O=(S=a.actionRequired)==null?void 0:S.conditionalType,Z=a.actionRequired.sourceCardId;i={animationRequests:D,onCompleteCallback:(ee,M)=>{let G=ee;G=jt(G,"after_delete",{player:b}).newState;const W=[];for(const U of["player","opponent"]){const Q=N.get(U),Y=G[U].lanes[n];Q&&L.has(Q)&&Y.length>0&&W.push(U)}for(let U=0;U<W.length;U++){const Q=W[U];if(G=Rn(G,Q,n).newState,G.actionRequired&&U<W.length-1){const ce=W.slice(U+1);for(const te of ce)G.queuedActions=[...G.queuedActions||[],{type:"pending_uncover_effect",owner:te,laneIndex:n}];return G}}if(R&&Z&&(O!=="if_executed"||D.length>0)){const Q=ve(G,Z);if(Q&&Q.card.isFaceUp){const Y=G[Q.owner].lanes.find(Se=>Se.some(ge=>ge.id===Z)),ce=G[Q.owner].lanes.indexOf(Y),te={cardOwner:Q.owner,actor:b,currentTurn:G.turn,opponent:Q.owner==="player"?"opponent":"player"};if(G=st(Q.card,ce,G,te,R).newState,G.actionRequired)return G}}return M(G)}}}break}case"select_lane_for_return":{const b=a.actionRequired.actor,T=b==="player"?"Player":"Opponent",A=a.player.protocols[n],H=a.actionRequired.targetFilter||{},$=ve(a,a.actionRequired.sourceCardId),B=$?`${$.card.protocol}-${$.card.value}`:"a card effect";l=ae(l,b,`${B}: ${T} targets Protocol ${A}.`);const X=[],I=[];for(const F of["player","opponent"]){const N=a[F],D=N.lanes[n].some(P=>P.isFaceUp&&P.protocol==="Darkness"&&P.value===2)?4:2;for(const P of N.lanes[n]){const L=P.isFaceUp?P.value:D;if(H.valueEquals!==void 0&&L!==H.valueEquals||H.faceState==="face_up"&&!P.isFaceUp||H.faceState==="face_down"&&P.isFaceUp||H.owner==="own"&&F!==b||H.owner==="opponent"&&F===b)continue;X.push({type:"return",cardId:P.id,owner:F});const R=F==="player"?"Player's":"Opponent's",O=P.isFaceUp?`${P.protocol}-${P.value}`:"a face-down card";I.push(`${R} ${O}`)}}if(X.length===0){l=ae(l,b,`${B}: No matching cards in Protocol ${A}.`),l=Ke(l),l.actionRequired=null;break}if(I.length>0&&(l=ae(l,b,`${B}: Returning ${I.join(", ")}.`)),l=Ke(l),l.actionRequired=null,X.length>0){const F=(k=a.actionRequired)==null?void 0:k.followUpEffect,N=(j=a.actionRequired)==null?void 0:j.conditionalType,D=a.actionRequired.sourceCardId;i={animationRequests:X,onCompleteCallback:(P,L)=>{let R=P;if(F&&D&&(N!=="if_executed"||X.length>0)){const Z=ve(R,D);if(Z&&Z.card.isFaceUp){const ee=R[Z.owner].lanes.find(W=>W.some(U=>U.id===D)),M=R[Z.owner].lanes.indexOf(ee),G={cardOwner:Z.owner,actor:b,currentTurn:R.turn,opponent:Z.owner==="player"?"opponent":"player"};if(R=st(Z.card,M,R,G,F).newState,R.actionRequired)return R}}return L(R)}}}break}case"select_lane_for_delete_all":{const b=a.actionRequired.actor,T=b==="player"?"Player":"Opponent",A=a.player.protocols[n],H=a.actionRequired.minCards||8;if(!(a.actionRequired.validLanes||[0,1,2]).includes(n)){l=ae(l,b,"Cannot select this lane for deletion.");break}const B=a.player.lanes[n].length+a.opponent.lanes[n].length;if(B<H){l=ae(l,b,`Cannot delete ${A} line (only ${B} cards, need ${H}+).`),l=Ke(l),l.actionRequired=null;break}const X=ve(a,a.actionRequired.sourceCardId),I=X?`${X.card.protocol}-${X.card.value}`:"Effect";l=ae(l,b,`${I}: ${T} deletes all cards in ${A} line.`);const F=[];for(const P of["player","opponent"])for(const L of a[P].lanes[n])F.push({type:"delete",cardId:L.id,owner:P});const N={...l.stats[b],cardsDeleted:l.stats[b].cardsDeleted+F.length},D={...l[b],stats:N};if(l={...l,[b]:D,stats:{...l.stats,[b]:N}},l=Ke(l),l.actionRequired=null,F.length>0){const P=(E=a.actionRequired)==null?void 0:E.followUpEffect,L=(C=a.actionRequired)==null?void 0:C.conditionalType,R=a.actionRequired.sourceCardId;i={animationRequests:F,onCompleteCallback:(O,Z)=>{let ee=O;if(ee=jt(ee,"after_delete",{player:b}).newState,P&&R&&(L!=="if_executed"||F.length>0)){const K=ve(ee,R);if(K&&K.card.isFaceUp){const W=ee[K.owner].lanes.find(ce=>ce.some(te=>te.id===R)),U=ee[K.owner].lanes.indexOf(W),Q={cardOwner:K.owner,actor:b,currentTurn:ee.turn,opponent:K.owner==="player"?"opponent":"player"};if(ee=st(K.card,U,ee,Q,P).newState,ee.actionRequired)return ee}}return Z(ee)}}}break}case"select_lane_to_shift_revealed_board_card_custom":{const{revealedCardId:b,actor:T}=a.actionRequired,A=ve(a,b);if(A){const H=go(a,b,A.owner,n,T);l=H.newState,H.animationRequests&&(i={animationRequests:H.animationRequests,onCompleteCallback:($,B)=>$.actionRequired?$:B($)})}break}default:return{nextState:a}}return{nextState:xe(l),requiresAnimation:i}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Ah=(a,n)=>{if(a.processedSpeed1TriggerThisTurn)return a;if(a[n].lanes.flat().some(c=>c.isFaceUp&&c.protocol==="Speed"&&c.value===1)){let c={...a};return c=Be(c,"Speed-1"),c=rt(c,void 0),c=ae(c,n,"Triggers after clearing cache: Draw 1 card."),c=Xo(c,n,1),c.processedSpeed1TriggerThisTurn=!0,c=Be(c,void 0),c.phase="end",c}return a},Go=(a,n,l)=>{var B,X,I,F;const i=a[l],c=new Set(n),d=i.hand.filter(N=>c.has(N.id));if(d.length===0)return a;const p=i.hand.filter(N=>!c.has(N.id)),h=[...i.discard,...d.map(({id:N,isFaceUp:D,...P})=>P)],f=((B=a.animationState)==null?void 0:B.type)==="discardCard"&&((X=a.animationState.originalAction)==null?void 0:X.type)==="discard"?a.animationState.originalAction:((I=a.actionRequired)==null?void 0:I.type)==="discard"?a.actionRequired:null,m={...i.stats,cardsDiscarded:i.stats.cardsDiscarded+d.length},g={...i,hand:p,discard:h,stats:m},y=f==null?void 0:f.followUpEffect,w=f==null?void 0:f.conditionalType,_=f==null?void 0:f.previousHandSize;let S={...a,[l]:g,stats:{...a.stats,[l]:m},actionRequired:y?{type:"discard_completed",followUpEffect:y,conditionalType:w,previousHandSize:_,sourceCardId:f==null?void 0:f.sourceCardId,actor:l}:null};if(f!=null&&f.sourceCardId){const N=S.player.lanes.flat().find(D=>D.id===f.sourceCardId)||S.opponent.lanes.flat().find(D=>D.id===f.sourceCardId);if(N){const D=`${N.protocol}-${N.value}`;S=Be(S,D),S=rt(S,"middle")}else S=Be(S,void 0),S=rt(S,void 0),S={...S,_logIndentLevel:0}}else S=Be(S,void 0),S=rt(S,void 0);const k=l==="player"?"Player":"Opponent";let j;if(l==="player"||d.every(N=>N.isRevealed)){const N=d.map(D=>`${D.protocol}-${D.value}`).join(", ");j=`${k} discards ${N}.`}else{const N=d.length===1?"card":"cards";j=`${k} discards ${d.length} ${N}.`}S=ae(S,l,j);const E=(N,D)=>{var ee;const P=a.phase==="hand_limit"&&!(D!=null&&D.sourceCardId);let L=N;return P&&(L=_o(L),L=Ah(L,l),L=jt(L,"after_clear_cache",{player:l}).newState,((ee=L.processedClearCacheTriggerIds)==null?void 0:ee.length)>0&&(L.phase="end")),L=Jh(L,l,D==null?void 0:D.sourceEffect,D==null?void 0:D.sourceCardId),L=jt(L,"after_discard",{player:l}).newState,L=jt(L,"after_opponent_discard",{player:l==="player"?"opponent":"player"}).newState,L};if(f&&f.actor===l){const N=f.count-n.length;return N>0?(S.actionRequired={...f,count:N},S):E(S,f)}const C=a.actionRequired;if(C&&C.type==="discard"&&C.actor===l){const N=C.count-n.length;return N>0?(S.actionRequired={...C,count:N},S):E(S,C)}const b=a.phase==="hand_limit";S=jt(S,"after_discard",{player:l}).newState;let $=jt(S,"after_opponent_discard",{player:l==="player"?"opponent":"player"}).newState;return b&&($=Ah($,l),$=jt($,"after_clear_cache",{player:l}).newState,((F=$.processedClearCacheTriggerIds)==null?void 0:F.length)>0&&($.phase="end")),$},x0=(a,n)=>{var p;if(((p=a.actionRequired)==null?void 0:p.type)!=="plague_2_player_discard")return a;const l=a.actionRequired.actor,i=l==="player"?"opponent":"player";let c=Go(a,n,l);const d=n.length+1;return c[i].hand.length>0?c.actionRequired={type:"discard",actor:i,count:Math.min(d,c[i].hand.length),sourceCardId:a.actionRequired.sourceCardId}:(c=Ke(c),c.actionRequired=null),c},Cd=(a,n)=>{var p;if(((p=a.actionRequired)==null?void 0:p.type)!=="plague_2_opponent_discard")return a;const l=a.actionRequired.actor,i=l==="player"?"opponent":"player";let c=Go(a,n,l);const d=n.length+1;return c[i].hand.length>0?c.actionRequired={type:"discard",actor:i,count:Math.min(d,c[i].hand.length),sourceCardId:a.actionRequired.sourceCardId}:(c=Ke(c),c.actionRequired=null),c},Dh=(a,n)=>{var f,m,g;const l=((f=a.actionRequired)==null?void 0:f.type)==="discard"&&((m=a.actionRequired)==null?void 0:m.variableCount),i=((g=a.actionRequired)==null?void 0:g.type)==="select_cards_from_hand_to_discard_for_fire_4";if(!l&&!i)return a;const c=a.actionRequired.actor,d=a.actionRequired.sourceCardId;let p=Go(a,n,c);if(l&&d)return Jh(p,c,void 0,d);const h=n.length+1;return p=ae(p,c,`Fire-4: Drawing ${h} card(s).`),p=Xo(p,c,h),p},bd=(a,n)=>{var f;if(((f=a.actionRequired)==null?void 0:f.type)!=="select_cards_from_hand_to_discard_for_hate_1")return a;const{sourceCardId:l,actor:i}=a.actionRequired;let c=Go(a,n,i);const p=X_(c,[]),h=Math.min(2,p);return h>0?c.actionRequired={type:"select_cards_to_delete",count:h,sourceCardId:l,disallowedIds:[],actor:i}:(c=ae(c,i,"Hate-1: No valid targets to delete."),c=Ke(c),c.actionRequired=null),c};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Gl=(a,n,l)=>{const i=a.turn,c=i==="player"?"opponent":"player";let d={...a};if(d.compileBlockedPlayer===i&&d.compileBlockedUntilTurn>(d.turnNumber||0))return d=ae(d,i,`${i==="player"?"Player":"Opponent"} can't compile - blocked by opponent's effect.`),d;if(d.useControlMechanic&&d.controlCardHolder===i){const N=i==="player"?"Player":"Opponent";return d=Be(d,void 0),d=rt(d,void 0),d={...d,_logIndentLevel:0},d=ae(d,i,`${N} has Control and may rearrange protocols before compiling.`),d=ya(d),d.actionRequired={type:"prompt_use_control_mechanic",sourceCardId:"CONTROL_MECHANIC",actor:i,originalAction:{type:"compile",laneIndex:n}},d.controlCardHolder=null,d}let f={...d[i]},m={...d[c]};const g=f.compiled[n],y=[];for(const N of[i,c])d[N].lanes[n].forEach(P=>{if(P.isFaceUp){const L=P;L.customEffects&&L.customEffects.topEffects&&L.customEffects.topEffects.some(O=>O.trigger==="before_compile_delete")&&y.push({card:P,owner:N})}});for(const{card:N,owner:D}of y)d=jt(d,"before_compile_delete",{player:D,cardId:N.id}).newState;f={...d[i]},m={...d[c]};const w=N=>{if(N.protocol==="Speed"&&N.value===2&&N.isFaceUp)return!0;const D=N;return D.customEffects&&D.customEffects.topEffects&&N.isFaceUp?D.customEffects.topEffects.some(P=>{var L,R;return P.trigger==="before_compile_delete"&&((L=P.params)==null?void 0:L.action)==="shift"&&((R=P.params)==null?void 0:R.shiftSelf)===!0}):!1},_=[],S=[],k=f.lanes[n].filter(N=>w(N)?(_.push(N),!1):!0),j=m.lanes[n].filter(N=>w(N)?(S.push(N),!1):!0),E={...f.stats,cardsDeleted:f.stats.cardsDeleted+k.length},C={...m.stats,cardsDeleted:m.stats.cardsDeleted+j.length};f.stats=E,m.stats=C,f.discard=[...f.discard,...k.map(({id:N,isFaceUp:D,...P})=>P)],m.discard=[...m.discard,...j.map(({id:N,isFaceUp:D,...P})=>P)];const b=[...f.lanes];b[n]=_,f.lanes=b;const T=[...m.lanes];T[n]=S,m.lanes=T;const A=[...f.compiled];if(A[n]=!0,f.compiled=A,d={...d,[i]:f,[c]:m,stats:{...d.stats,[i]:E,[c]:C}},d.detailedGameStats){const N=g,D=i==="player"?N?"playerRecompile":"playerFirstCompile":N?"aiRecompile":"aiFirstCompile";d={...d,detailedGameStats:{...d.detailedGameStats,compiles:{...d.detailedGameStats.compiles,[D]:d.detailedGameStats.compiles[D]+1}}}}d=Be(d,void 0),d=rt(d,void 0),d={...d,_logIndentLevel:0};const H=i==="player"?"Player":"Opponent",$=f.protocols[n];if(d=ae(d,i,`${H} compiles Protocol ${$}!`),g&&(d=ae(d,i,`${H} draws 1 card from the opponent's deck as a re-compile reward.`),d=f0(d,i,1)),d=xe(d),f.compiled.every(N=>N===!0))return d.winner=i,l(i,d),d;k.length+j.length>0&&(d=jt(d,"after_delete",{player:i}).newState);const F=[..._,...S].map(N=>{const D=ve(d,N.id).owner,P=N.isFaceUp?`${N.protocol}-${N.value}`:"Card";return d=ae(d,D,`${P} survives compilation and must be shifted.`),{type:"select_lane_for_shift",cardToShiftId:N.id,cardOwner:D,originalLaneIndex:n,sourceCardId:N.id,actor:D}});if(F.length>0){const N=F.shift();d.actionRequired=N,d.queuedActions=F,N.actor!==i&&(d._interruptedTurn=i,d._interruptedPhase=d.phase,d.turn=N.actor)}else d.actionRequired=null,d.queuedActions=[];return d},rm=(a,n)=>a,w0=(a,n)=>{var _;if(((_=a.actionRequired)==null?void 0:_.type)!=="select_card_from_hand_to_play")return a;const{disallowedLaneIndex:l,sourceCardId:i,isFaceDown:c,actor:d,destinationRule:p,condition:h,faceDown:f,targetLaneIndex:m,validLanes:g,selectableCardIds:y,valueFilter:w}=a.actionRequired;return y&&!y.includes(n)?a:m!==void 0?{...a,actionRequired:{type:"select_lane_for_play",cardInHandId:n,sourceCardId:i,isFaceDown:c||f,actor:d,source:"hand",preSelectedLane:m}}:{...a,actionRequired:{type:"select_lane_for_play",cardInHandId:n,disallowedLaneIndex:l,sourceCardId:i,isFaceDown:c||f,actor:d,destinationRule:p,condition:h,validLanes:g}}},Th=a=>{if(!a.actionRequired||!("optional"in a.actionRequired)||!a.actionRequired.optional)return a;const n="actor"in a.actionRequired?a.actionRequired.actor:a.turn,l=n==="player"?"Player":"Opponent";let i={...a,actionRequired:null};return i=ae(i,n,`${l} skips the optional action.`),i},Fh=a=>{var d;if(((d=a.actionRequired)==null?void 0:d.type)!=="reveal_opponent_hand")return a;const n=a.actionRequired.actor,l=n==="player"?"opponent":"player";let i={...a};const c={...i[l]};if(c.hand.length>0){c.hand=c.hand.map(f=>({...f,isRevealed:!0})),i[l]=c;const p=ve(i,a.actionRequired.sourceCardId),h=p?`${p.card.protocol}-${p.card.value}`:"A card effect";i=ae(i,n,`${h}: Opponent reveals their hand.`)}return i.actionRequired=null,i},qh=(a,n)=>kd(a,n),$h=(a,n)=>Nd(a,n).newState,lm=(a,n)=>{var y;if(((y=a.actionRequired)==null?void 0:y.type)!=="select_card_from_revealed_deck")return a;const i=a.actionRequired.actor,c=i==="player"?"Player":"Opponent";let d={...a};const p={...d[i]},h=[...p.deck],f=h.findIndex(w=>(w.id||`deck-${h.indexOf(w)}`)===n);if(f===-1)return console.warn(`[resolveSelectRevealedDeckCard] Card ${n} not found in deck`),d.actionRequired=null,d;const m=h.splice(f,1)[0],g={...m,id:m.id||`drawn-${Date.now()}`,isFaceUp:!0};return p.deck=h,p.hand=[...p.hand,g],p.deckRevealed=!1,d[i]=p,d=ae(d,i,`${c} draws ${m.protocol}-${m.value} from the revealed deck.`),d.actionRequired=null,d=Ke(d),d};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Uh=(a,n)=>{var f;if(((f=a.actionRequired)==null?void 0:f.type)!=="prompt_optional_draw")return a;const{sourceCardId:l,actor:i,count:c,drawingPlayer:d}=a.actionRequired,p=i.charAt(0).toUpperCase()+i.slice(1);let h={...a};if(n){h=ae(h,i,`${p} chooses to draw ${c} card${c!==1?"s":""}.`),h=Xo(h,d||i,c);const m=a.actionRequired.followUpEffect;if(a.actionRequired.conditionalType,m){const g=ve(h,l);if(g){const y=h[g.owner].lanes.findIndex(k=>k.some(j=>j.id===l)),w=i==="player"?"opponent":"player",_={cardOwner:i,actor:i,currentTurn:h.turn,opponent:w,triggerType:"start"};h=st(g.card,y,h,_,m).newState,h=Ke(h)}else{const y=i==="player"?"opponent":"player";let w=0;for(let j=0;j<3;j++)if(h[i].lanes[j].length>0){w=j;break}const _={id:l,protocol:"Unknown",value:0},S={cardOwner:i,actor:i,currentTurn:h.turn,opponent:y,triggerType:"start"};h=st(_,w,h,S,m).newState,h=Ke(h)}}else h.actionRequired=null}else h=ae(h,i,`${p} skips the draw.`),h.actionRequired=null;return h},Oh=(a,n,l)=>{var c;if(((c=a.actionRequired)==null?void 0:c.type)!=="plague_4_player_flip_optional")return a;let i={...a,actionRequired:null};if(i=Be(i,"Plague-4"),i=rt(i,"end"),n){const{sourceCardId:d}=a.actionRequired;i=ae(i,l,`${l==="player"?"Player":"Opponent"} chooses to flip the card.`),i=Wo(new Set([d]),i),i.animationState={type:"flipCard",cardId:d}}else i=ae(i,l,`${l==="player"?"Player":"Opponent"} skips flipping the card.`);return i=Be(i,void 0),i=rt(i,void 0),i=_o(i),i},Ih=(a,n)=>{var m,g,y;if(((m=a.actionRequired)==null?void 0:m.type)!=="prompt_optional_discard_custom")return a;const{actor:l,count:i,sourceCardId:c}=a.actionRequired,d=l.charAt(0).toUpperCase()+l.slice(1);let p={...a};const h=(g=a.actionRequired)==null?void 0:g.followUpEffect,f=(y=a.actionRequired)==null?void 0:y.conditionalType;return n?(p=ae(p,l,`${d} chooses to discard ${i} card(s).`),p.actionRequired={type:"discard",actor:l,count:i,sourceCardId:c,followUpEffect:h,conditionalType:f,previousHandSize:p[l].hand.length}):(p=ae(p,l,`${d} skips the discard.`),p.actionRequired=null),p},Td=(a,n)=>{var m,g,y,w,_,S,k;if(((m=a.actionRequired)==null?void 0:m.type)!=="prompt_optional_effect")return a;const{actor:l,sourceCardId:i,effectDef:c,laneIndex:d,savedTargetCardId:p}=a.actionRequired,h=l.charAt(0).toUpperCase()+l.slice(1);let f={...a};if(p&&(f.lastCustomEffectTargetCardId=p),n){const j=c.params.action;f=ae(f,l,`${h} chooses to execute the optional ${j} effect.`),f.actionRequired=null;const E=[...f.player.lanes.flat(),...f.opponent.lanes.flat()].find(F=>F.id===i);if(!E)return console.error("[Optional Effect] Source card not found!"),f;const C={cardOwner:l,opponent:l==="player"?"opponent":"player",currentTurn:f.turn,actor:l},b={...c,params:{...c.params,optional:!1},conditional:void 0},T=st(E,d,f,C,b),A=!!T.newState.actionRequired,H=!!T.newState._effectSkippedNoTargets;if(H&&!A){const F={...T.newState};return delete F._effectSkippedNoTargets,F.actionRequired=null,F}if(H&&A&&delete T.newState._effectSkippedNoTargets,c.conditional&&c.conditional.type==="if_executed"&&c.conditional.thenEffect){if(T.newState.actionRequired){const D=T.newState.actionRequired.sourceCardId;if(D&&D!==i){const L={type:"execute_conditional_followup",sourceCardId:i,laneIndex:d,followUpEffect:c.conditional.thenEffect,context:C,actor:l};return{...T.newState,queuedActions:[...T.newState.queuedActions||[],L]}}return{...T.newState,actionRequired:{...T.newState.actionRequired,followUpEffect:c.conditional.thenEffect,conditionalType:"if_executed"}}}const F=c.conditional.thenEffect,N=st(E,d,T.newState,C,F);return N.newState.actionRequired&&F.conditional&&F.conditional.thenEffect?{...N.newState,actionRequired:{...N.newState.actionRequired,followUpEffect:F.conditional.thenEffect,conditionalType:F.conditional.type}}:N.newState}const B=(g=a.actionRequired)==null?void 0:g.followUpEffect,X=(y=a.actionRequired)==null?void 0:y.outerSourceCardId,I=(w=a.actionRequired)==null?void 0:w.outerLaneIndex;if(B&&X){let F=T.newState;if(F.actionRequired)return{...F,actionRequired:{...F.actionRequired,followUpEffect:B,outerSourceCardId:X,outerLaneIndex:I}};const N=[...F.player.lanes.flat(),...F.opponent.lanes.flat()].find(D=>D.id===X);if(N){const D=F.player.lanes.flat().some(R=>R.id===X)?"player":"opponent",P={cardOwner:D,opponent:D==="player"?"opponent":"player",currentTurn:F.turn,actor:D};return st(N,I||0,F,P,B).newState}}return T.newState}else{const j=c.params.action;f=ae(f,l,`${h} skips the optional ${j} effect.`),f.actionRequired=null;const E=(_=a.actionRequired)==null?void 0:_.followUpEffect,C=(S=a.actionRequired)==null?void 0:S.outerSourceCardId,b=(k=a.actionRequired)==null?void 0:k.outerLaneIndex;if(E&&C){const T=[...f.player.lanes.flat(),...f.opponent.lanes.flat()].find(A=>A.id===C);if(T){let A=b;if(A===void 0){for(const X of["player","opponent"])for(let I=0;I<f[X].lanes.length;I++)if(f[X].lanes[I].some(F=>F.id===C)){A=I;break}}const H=f.player.lanes.flat().some(X=>X.id===C)?"player":"opponent",$={cardOwner:H,opponent:H==="player"?"opponent":"player",currentTurn:f.turn,actor:H};return st(T,A||0,f,$,E).newState}}return f}},Sd=(a,n,l)=>{var b;if(((b=a.actionRequired)==null?void 0:b.type)!=="prompt_rearrange_protocols")return a;const i=U_(a);if(!i.allowed)return console.error(`Protocol rearrangement blocked: ${i.reason}`),a;const{target:c,actor:d,originalAction:p,sourceCardId:h,disallowedProtocolForLane:f}=a.actionRequired;if(f){const{laneIndex:T,protocol:A}=f;if(n[T]===A)return console.error(`Illegal rearrange: ${A} cannot be placed on lane ${T} due to Anarchy-3 restriction`),a}let m={...a};const g={...m[c]},y={};g.protocols.forEach((T,A)=>{y[T]=g.compiled[A]});const w=n.map(T=>y[T]);g.protocols=n,g.compiled=w,m[c]=g,m.actionRequired=null;const _=m._pendingCustomEffects;if(_&&_.effects.length>0){const T={type:"execute_remaining_custom_effects",sourceCardId:_.sourceCardId,laneIndex:_.laneIndex,effects:_.effects,context:_.context,actor:d,logSource:_.logSource,logPhase:_.logPhase,logIndentLevel:_.logIndentLevel};m.queuedActions=[...m.queuedActions||[],T],delete m._pendingCustomEffects}let S="Control Action";if(h!=="CONTROL_MECHANIC"){const T=[...m.player.lanes.flat(),...m.opponent.lanes.flat()].find(A=>A.id===h);T&&(S=`${T.protocol}-${T.value}`)}const k=d.charAt(0).toUpperCase()+d.slice(1),j=c===d?"their own":"the opponent's",E=n.join(" | ");m=ae(m,d,`${S}: ${k} rearranges ${j} protocols.`),m=ae(m,d,`New protocol order for ${c}: ${E}`);let C=xe(m);if(p){if(C={...C,_logIndentLevel:0},p.type==="compile")return Gl(C,p.laneIndex,l);if(p.type==="fill_hand")return Xl(C,d);p.type==="continue_turn"?p.queuedSpeed2Actions&&p.queuedSpeed2Actions.length>0?(C=ae(C,d,"Processing remaining Speed-2 effects..."),C.queuedActions=[...p.queuedSpeed2Actions,...C.queuedActions||[]]):(C=ae(C,d,"Turn ends after compile."),C.phase="hand_limit"):p.type==="resume_interrupted_turn"&&(C=ae(C,d,"Resuming interrupted turn..."),C._interruptedTurn=p.interruptedTurn,C._interruptedPhase=p.interruptedPhase,p.queuedSpeed2Actions&&p.queuedSpeed2Actions.length>0&&(C.queuedActions=[...p.queuedSpeed2Actions,...C.queuedActions||[]]))}return C},Ph=(a,n,l)=>{var C;if(((C=a.actionRequired)==null?void 0:C.type)!=="prompt_swap_protocols")return a;const{actor:i,target:c,originalAction:d,sourceCardId:p}=a.actionRequired,h={...a[c]},[f,m]=n.sort((b,T)=>b-T),g=[...h.protocols],y=[...h.compiled];[g[f],g[m]]=[g[m],g[f]],[y[f],y[m]]=[y[m],y[f]],h.protocols=g,h.compiled=y;let w={...a,[c]:h,actionRequired:null};const _=w._pendingCustomEffects;if(_&&_.effects.length>0){const b={type:"execute_remaining_custom_effects",sourceCardId:_.sourceCardId,laneIndex:_.laneIndex,effects:_.effects,context:_.context,actor:i,logSource:_.logSource,logPhase:_.logPhase,logIndentLevel:_.logIndentLevel};w.queuedActions=[...w.queuedActions||[],b],delete w._pendingCustomEffects}const S=i.charAt(0).toUpperCase()+i.slice(1),k=c.charAt(0).toUpperCase()+c.slice(1);w=ae(w,i,`${p==="CONTROL_MECHANIC"?"Control":"Spirit-4"}: ${S} swaps ${k}'s protocols ${g[m]} and ${g[f]}.`),p==="CONTROL_MECHANIC"&&(w.controlCardHolder=null);let E=xe(w);if(d){if(d.type==="compile")return E=ae(E,i,"Resuming Compile action..."),Gl(E,d.laneIndex,l);if(d.type==="fill_hand")return E=ae(E,i,"Resuming Refresh action..."),Xl(E,i)}return E},Fd=(a,n)=>{var w;if(((w=a.actionRequired)==null?void 0:w.type)!=="prompt_shift_or_flip_board_card_custom")return a;const{actor:l,sourceCardId:i,revealedCardId:c,followUpAction:d,optional:p}=a.actionRequired,h=l.charAt(0).toUpperCase()+l.slice(1),f=ve(a,c);if(!f)return a;if(d&&n!=="skip"&&n!==d)return console.error(`Invalid choice: ${n}, followUpAction restricts to: ${d}`),a;const m=f.owner,g=a[m].lanes.findIndex(_=>_.some(S=>S.id===c));if(g===-1)return a;let y={...a};switch(n){case"shift":{const _=[...y[m].lanes[g]],S=_.findIndex(k=>k.id===c);if(S!==-1){_[S]={..._[S],isFaceUp:!1};const k=[...y[m].lanes];k[g]=_,y={...y,[m]:{...y[m],lanes:k}}}y=ae(y,l,`${h} chooses to shift the revealed card (face-down).`),y.actionRequired={type:"select_lane_to_shift_revealed_board_card_custom",sourceCardId:i,revealedCardId:c,actor:l};break}case"flip":{y=ae(y,l,`${h} chooses to flip the revealed card face-up permanently.`);const _={...y,actionRequired:null};y=Rd(_,c).newState;break}case"skip":{const _=[...y[m].lanes[g]],S=_.findIndex(k=>k.id===c);if(S!==-1){_[S]={..._[S],isFaceUp:!1};const k=[...y[m].lanes];k[g]=_,y={...y,[m]:{...y[m],lanes:k}}}y=ae(y,l,`${h} chooses to do nothing with the revealed card.`),y.actionRequired=null;break}}return y};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const jd=(a,n)=>{if(!a.actionRequired)return a;const{actionRequired:l}=a,i=l.actor,c=i==="player"?"opponent":"player";switch(l.type){case"select_card_from_hand_to_give":{const d=a[i].hand.find(_=>_.id===n);if(!d)return a;let p={...a};const h={...p[i]},f={...p[c]};h.hand=h.hand.filter(_=>_.id!==n),f.hand=[...f.hand,d],p={...p,[i]:h,[c]:f};const m=i==="player"?"Player":"Opponent",g=`${d.protocol}-${d.value}`;p=ae(p,i,`${m} gives ${g} to the opponent.`),l.sourceEffect==="love_1_end"&&(p=ae(p,i,`Love-1: ${m} draws 2 cards.`),p=Xo(p,i,2));const y=l.followUpEffect,w=l.conditionalType;if(y&&w==="if_executed"){const _=ve(p,l.sourceCardId);if(_){const{card:S,laneIndex:k}=_,j={cardOwner:i,actor:i,currentTurn:p.turn,opponent:c,triggerType:"play"};p=st(S,k,p,j,y).newState}}return p.actionRequired=null,p}case"select_card_from_hand_to_reveal":{const d=a[i].hand.find(w=>w.id===n);if(!d)return a;let p={...a};const h={...p[i]},f=h.hand.map(w=>w.id===n?{...w,isRevealed:!0}:w);h.hand=f,p={...p,[i]:h};const m=i==="player"?"Player":"Opponent",g=`${d.protocol}-${d.value}`;p=ae(p,i,`${m} reveals ${g} from their hand.`);const y=p._pendingCustomEffects;if(y&&y.effects.length>0){const w=ve(p,y.sourceCardId);if(w){const{card:_}=w,S=y.effects[0],k=y.effects.slice(1),j={cardOwner:i,actor:i,currentTurn:p.turn,opponent:c,triggerType:"play"};return p=st(_,y.laneIndex,p,j,S).newState,k.length>0?p._pendingCustomEffects={...y,effects:k}:delete p._pendingCustomEffects,p}}return p.actionRequired={type:"select_any_card_to_flip",count:1,sourceCardId:l.sourceCardId,actor:i},p}default:return a}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const qd=(a,n)=>{var _;if(((_=a.actionRequired)==null?void 0:_.type)!=="custom_choice")return a;const{options:l,sourceCardId:i,actor:c,laneIndex:d}=a.actionRequired;if(n<0||n>=l.length)return console.error(`[Choice Resolver] Invalid option index: ${n}`),a;const p=l[n],h=ve(a,i);if(!h){console.error(`[Choice Resolver] Source card ${i} not found`);let S={...a};return S.actionRequired=null,S}const f=c==="player"?"opponent":"player",m={cardOwner:c,actor:c,currentTurn:a.turn,opponent:f};let g={...a,actionRequired:null};const y=st(h.card,d,g,m,p);return xe(y.newState)};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Control Mechanic Logic for AI
 *
 * CRITICAL: When evaluating rearrangements during a compile action,
 * the lane being compiled will have its value RESET TO 0 after the compile.
 * This must be considered when determining beneficial swaps!
 */function hi(a,n){const l=[...a];return n!==null&&n>=0&&n<3&&(l[n]=0),l}function C0(a,n=null){const l=a.player,i=[],c=[];for(let p=0;p<3;p++)l.compiled[p]?i.push(p):c.push(p);if(i.length===0||c.length===0)return!1;const d=hi(l.laneValues,n);for(const p of i)for(const h of c)if(d[h]-d[p]>0)return!0;return!1}function Lh(a,n=null){const l=a.opponent,i=[],c=[];for(let p=0;p<3;p++)l.compiled[p]?i.push(p):c.push(p);if(i.length===0||c.length===0)return!1;const d=hi(l.laneValues,n);for(const p of i)for(const h of c){const m=10-d[p];if(m>=0&&m<=3){const y=10-d[h];if(m<y)return!0}}return!1}function sm(a,n){if(!n||n.type!=="prompt_rearrange_protocols")return{type:"rearrangeProtocols",newOrder:[...a.opponent.protocols]};const l=n.target,i=n.disallowedProtocolForLane;let c=null;n.originalAction&&n.originalAction.type==="compile"&&(c=n.originalAction.laneIndex);const d=_=>{if(!i)return!0;const{laneIndex:S,protocol:k}=i;return _[S]!==k},p=a.opponent,h=a.player,f=hi(p.laneValues,c),m=hi(h.laneValues,c),g=p.compiled.filter(_=>_).length;if(h.compiled.filter(_=>_).length===2&&g===2){const _=h.compiled.findIndex(E=>!E),S=p.compiled.findIndex(E=>!E),k=m[_],j=f[S];if(k>j&&l==="player"){let E=-1,C=1/0;for(let b=0;b<3;b++)h.compiled[b]&&m[b]<C&&(C=m[b],E=b);if(E!==-1&&C<=k){const b=[...h.protocols];if([b[_],b[E]]=[b[E],b[_]],d(b))return{type:"rearrangeProtocols",newOrder:b}}return Vo(h.protocols,d)}if(k<=j&&l==="opponent"){let E=-1,C=-1;for(let b=0;b<3;b++)p.compiled[b]&&f[b]>C&&(C=f[b],E=b);if(E!==-1&&C>j&&C>0){const b=[...p.protocols];if([b[S],b[E]]=[b[E],b[S]],d(b))return{type:"rearrangeProtocols",newOrder:b}}return Vo(p.protocols,d)}}if(l==="player"){const _=[],S=[];for(let C=0;C<3;C++)h.compiled[C]?_.push(C):S.push(C);if(_.length===0||S.length===0){if(n.sourceCardId!=="CONTROL_MECHANIC")for(let b=0;b<3;b++)for(let T=b+1;T<3;T++){const A=[...h.protocols];if([A[b],A[T]]=[A[T],A[b]],d(A))return{type:"rearrangeProtocols",newOrder:A}}return Vo(h.protocols,d)}let k=null;for(const C of S)if(m[C]>=10&&m[C]>f[C]){for(const T of _){k={compiledIdx:T,uncompiledIdx:C};break}if(k)break}if(k){const C=[...h.protocols];if([C[k.compiledIdx],C[k.uncompiledIdx]]=[C[k.uncompiledIdx],C[k.compiledIdx]],d(C))return{type:"rearrangeProtocols",newOrder:C}}let j=null;for(const C of _)for(const b of S){const T=m[b]-m[C];(!j||T>j.score)&&(j={compiledIdx:C,uncompiledIdx:b,score:T})}const E=n.sourceCardId!=="CONTROL_MECHANIC";if(j&&j.score>0){const C=[...h.protocols];if([C[j.compiledIdx],C[j.uncompiledIdx]]=[C[j.uncompiledIdx],C[j.compiledIdx]],d(C))return{type:"rearrangeProtocols",newOrder:C}}if(E)for(let C=0;C<3;C++)for(let b=C+1;b<3;b++){const T=[...h.protocols];if([T[C],T[b]]=[T[b],T[C]],d(T))return{type:"rearrangeProtocols",newOrder:T}}return Vo(h.protocols,d)}if(l==="opponent"){const _=[],S=[];for(let E=0;E<3;E++)p.compiled[E]?_.push(E):S.push(E);if(_.length===0||S.length===0){if(n.sourceCardId!=="CONTROL_MECHANIC")for(let C=0;C<3;C++)for(let b=C+1;b<3;b++){const T=[...p.protocols];if([T[C],T[b]]=[T[b],T[C]],d(T))return{type:"rearrangeProtocols",newOrder:T}}return Vo(p.protocols,d)}let k=null;for(const E of _)for(const C of S){const b=f[E],T=f[C],A=b-T,$=b>=10&&b>m[E]?A+100:A;(!k||$>k.score)&&(k={compiledIdx:E,uncompiledIdx:C,score:$,newUncompiledValue:b})}const j=n.sourceCardId!=="CONTROL_MECHANIC";if(k&&k.score>0){const E=[...p.protocols];if([E[k.compiledIdx],E[k.uncompiledIdx]]=[E[k.uncompiledIdx],E[k.compiledIdx]],d(E))return{type:"rearrangeProtocols",newOrder:E}}if(j)for(let E=0;E<3;E++)for(let C=E+1;C<3;C++){const b=[...p.protocols];if([b[E],b[C]]=[b[C],b[E]],d(b))return{type:"rearrangeProtocols",newOrder:b}}return Vo(p.protocols,d)}const w=l==="player"?[...h.protocols]:[...p.protocols];return Vo(w,d)}function Vo(a,n){if(n(a))return{type:"rearrangeProtocols",newOrder:[...a]};for(let l=0;l<3;l++)for(let i=l+1;i<3;i++){const c=[...a];if([c[l],c[i]]=[c[i],c[l]],n(c))return{type:"rearrangeProtocols",newOrder:c}}return console.error("[AI Rearrange] Could not find any valid arrangement - returning current order"),{type:"rearrangeProtocols",newOrder:[...a]}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function im(a,n){return gn(a).some(({rule:i,cardOwner:c})=>i.type!=="require_face_down_play"?!1:i.target==="all"||i.target==="opponent"&&c!==n)}function Hd(a){const n=a;return n.customEffects?[...n.customEffects.topEffects||[],...n.customEffects.middleEffects||[],...n.customEffects.bottomEffects||[]].some(i=>{var p,h;const c=i.trigger;return(c==="on_cover"||c==="on_cover_or_flip")&&((p=i.params)==null?void 0:p.action)==="delete"&&((h=i.params)==null?void 0:h.deleteSelf)===!0}):!1}function b0(a,n,l){const i=a[n].lanes[l];if(i.length===0)return null;const c=i[i.length-1];return c.isFaceUp&&Hd(c)?c.value:null}function cm(a){const n=a;return n.customEffects?[...n.customEffects.topEffects||[],...n.customEffects.middleEffects||[],...n.customEffects.bottomEffects||[]].some(i=>{var c;return i.params.action==="return"&&((c=i.params.targetFilter)==null?void 0:c.owner)==="own"}):!1}function dm(a){const n=a;return n.customEffects?[...n.customEffects.topEffects||[],...n.customEffects.middleEffects||[],...n.customEffects.bottomEffects||[]].some(i=>{var c,d,p;return i.params.action==="delete"&&((c=i.params.targetFilter)==null?void 0:c.owner)==="own"&&(((d=i.params.targetFilter)==null?void 0:d.valueFilter)==="highest"||((p=i.params.targetFilter)==null?void 0:p.calculation)==="highest_value")}):!1}function S0(a){const n=a;if(!n.customEffects)return 0;const l=n.customEffects.topEffects||[];for(const i of l)if(i.trigger==="passive"&&i.params.action==="value_modifier"&&(i.params.condition==="per_face_down_card"||i.params.applyTo==="face_down_cards"))return i.params.modifier||0;return 0}function um(a,n){let l=0;for(const i of["player","opponent"])for(const c of a[i].lanes[n])if(c.isFaceUp){const d=S0(c);d>0&&(l=Math.max(l,d))}return l}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * EASY AI - Focused on winning, but only looks at own board
 * - Always tries to compile as fast as possible
 * - Prioritizes lanes closest to 10
 * - Doesn't consider opponent's strategy
 * - Makes simple decisions for effect choices
 *
 * FULLY GENERIC: Uses only targetFilter, scope, destinationRestriction from ActionRequired
 * NO card-specific handlers - all effects handled through parameters
 */function zl(a,n,l,i,c,d){const p=[],h=l||{},f=h.position||"uncovered";for(const m of["player","opponent"])if(!(h.owner==="own"&&m!==n)&&!(h.owner==="opponent"&&m===n))for(let g=0;g<a[m].lanes.length;g++){if((i==null?void 0:i.type)==="this_lane"&&i.laneIndex!==void 0&&g!==i.laneIndex||(i==null?void 0:i.type)==="other_lanes"&&i.laneIndex!==void 0&&g===i.laneIndex||d!==void 0&&(i==null?void 0:i.type)==="this_lane"&&g!==d)continue;const y=a[m].lanes[g];for(let w=0;w<y.length;w++){const _=y[w];if(xo(a,_.id))continue;const S=wo(a,y,w);if(!(f==="uncovered"&&!S)&&!(f==="covered"&&S)&&!(h.faceState==="face_up"&&!_.isFaceUp)&&!(h.faceState==="face_down"&&_.isFaceUp)){if(h.valueRange){const k=_.isFaceUp?_.value:2;if(k<h.valueRange.min||k>h.valueRange.max)continue}h.valueEquals!==void 0&&(_.isFaceUp?_.value:2)!==h.valueEquals||h.excludeSelf&&c&&_.id===c||p.push(_)}}}return h.calculation==="highest_value"&&p.length>0?(p.sort((m,g)=>{const y=m.isFaceUp?m.value:2;return(g.isFaceUp?g.value:2)-y}),[p[0]]):h.calculation==="lowest_value"&&p.length>0?(p.sort((m,g)=>{const y=m.isFaceUp?m.value:2,w=g.isFaceUp?g.value:2;return y-w}),[p[0]]):p}function Bo(a,n){return a.player.lanes.some(l=>l.some(i=>i.id===n))}function ho(a,n,l){return a.isFaceUp?a.value:2+0}const j0=a=>{const{opponent:n,player:l}=a;if(n.hand.length===0)return null;const i=(j,E,C)=>Pa(a,"opponent",j,E,C).allowed,c=im(a,"opponent"),d=_i(a,"opponent"),p=vi(a),h=(j,E)=>c||!i(E,!0,j.protocol)?!1:p?j.protocol!==n.protocols[E]&&j.protocol!==l.protocols[E]:j.protocol===n.protocols[E]||j.protocol===l.protocols[E]||d,f=(j,E,C)=>2+um(a,C),m=n.hand.filter(j=>cm(j)?n.lanes.flat().some(b=>b.protocol!==j.protocol):!0);if(m.length===0)return null;const g=j=>{if(Hd(j)){for(let E=0;E<3;E++)if(!n.compiled[E]&&n.laneValues[E]+j.value>=10)return!1;return!0}if(dm(j)){let E=0;for(let C=0;C<3;C++){const b=n.lanes[C];if(b.length>0){const T=b[b.length-1],A=T.isFaceUp?T.value:2;A>E&&(E=A)}}return j.value>=E}return!1},y=[],_=l.lanes.flat().length+n.lanes.flat().length<=3,S=l.lanes.flat().length>0,k=(j,E)=>j.keywords.flip||j.keywords.delete||j.keywords.shift||j.keywords.return?S||n.lanes.some((T,A)=>A!==E&&T.length>0)||n.lanes[E].length>0:!0;for(const j of m)for(let E=0;E<3;E++){if(n.compiled[E])continue;const C=n.laneValues[E],b=l.laneValues[E];if(h(j,E)&&!g(j)){const T=C+j.value;let A=0;T>=10&&T>b?A=1e3+T:T<10?A=100+T+j.value*5:A=50+j.value,_&&j.value<=2&&(k(j,E)?A-=50:A-=200),j.keywords.draw&&n.hand.length>=5&&(A-=30),y.push({cardId:j.id,laneIndex:E,isFaceUp:!0,score:A})}if(i(E,!1,j.protocol)){const T=f(j,!1,E),A=C+T;let H=0;A>=10&&A>b?H=900+A:A<10?H=80+A:H=30+T,y.push({cardId:j.id,laneIndex:E,isFaceUp:!1,score:H})}}if(y.length===0)return null;y.sort((j,E)=>E.score-j.score);for(const j of y){if(j.isFaceUp){const E=n.hand.find(b=>b.id===j.cardId);if(!E||!Pa(a,"opponent",j.laneIndex,!0,E.protocol).allowed)continue}return{cardId:j.cardId,laneIndex:j.laneIndex,isFaceUp:j.isFaceUp}}return null},E0=(a,n)=>{var l,i,c,d,p,h;switch(n.type){case"prompt_use_control_mechanic":{const{player:f}=a,m=f.compiled.some(y=>y),g=f.compiled.filter(y=>!y).length;return m&&g>0?{type:"resolveControlMechanicPrompt",choice:"player"}:{type:"resolveControlMechanicPrompt",choice:"skip"}}case"discard":{const f=[...a.opponent.hand].sort((y,w)=>y.value-w.value),m=n.variableCount?Math.min(3,f.length):n.count;return{type:"discardCards",cardIds:f.slice(0,m).map(y=>y.id)}}case"select_cards_to_delete":{const f=n.currentLaneIndex??n.laneIndex,m=n.allowedIds;let g=zl(a,n.actor,n.targetFilter,n.scope,n.sourceCardId,f);m&&(g=g.filter(k=>m.includes(k.id)));const y=n.disallowedIds||[],w=g.filter(k=>!y.includes(k.id));if(w.length===0)return{type:"skip"};const _=w.filter(k=>Bo(a,k.id)),S=w.filter(k=>!Bo(a,k.id));return _.length>0?(_.sort((k,j)=>ho(j)-ho(k)),{type:"deleteCard",cardId:_[0].id}):S.length>0?(S.sort((k,j)=>ho(k)-ho(j)),{type:"deleteCard",cardId:S[0].id}):{type:"deleteCard",cardId:w[0].id}}case"select_card_to_flip":case"select_any_card_to_flip":case"select_any_card_to_flip_optional":{const f=ma(a),m=n.currentLaneIndex??n.laneIndex,g=zl(a,n.actor,n.targetFilter,n.scope,n.sourceCardId,m);if(g.length===0)return n.optional?{type:"skip"}:{type:"skip"};const y=g.filter(S=>Bo(a,S.id)),w=g.filter(S=>!Bo(a,S.id)),_=y.filter(S=>S.isFaceUp).sort((S,k)=>k.value-S.value);if(_.length>0)return{type:"flipCard",cardId:_[0].id};if(!f){const S=y.filter(k=>!k.isFaceUp);if(S.length>0)return{type:"flipCard",cardId:S[0].id}}if(!f){const S=w.filter(k=>!k.isFaceUp);if(S.length>0)return{type:"flipCard",cardId:S[0].id}}if(!n.optional){const S=w.filter(k=>k.isFaceUp).sort((k,j)=>k.value-j.value);if(S.length>0)return{type:"flipCard",cardId:S[0].id}}return{type:"skip"}}case"select_card_to_shift":{const f=n.scope,m=f==="this_lane"?n.sourceLaneIndex??n.currentLaneIndex??n.laneIndex:void 0,g=zl(a,n.actor,n.targetFilter,f,n.sourceCardId,m);if(g.length===0)return n.optional?{type:"skip"}:{type:"skip"};const y=g.filter(w=>Bo(a,w.id));return y.length>0?{type:"shiftCard",cardId:y[0].id}:{type:"shiftCard",cardId:g[0].id}}case"select_card_to_return":{const f=n.currentLaneIndex??n.laneIndex,m=zl(a,n.actor,n.targetFilter,n.scope,n.sourceCardId,f);if(m.length===0)return n.optional?{type:"skip"}:{type:"skip"};const g=m.filter(w=>Bo(a,w.id));if(g.length>0)return g.sort((w,_)=>ho(_)-ho(w)),{type:"returnCard",cardId:g[0].id};const y=m.filter(w=>!Bo(a,w.id));return y.length>0?(y.sort((w,_)=>ho(w)-ho(_)),{type:"returnCard",cardId:y[0].id}):{type:"returnCard",cardId:m[0].id}}case"select_lane_for_shift":{let f=n.validLanes||[0,1,2];if(f=f.filter(m=>m!==n.originalLaneIndex),n.destinationRestriction){const m=n.destinationRestriction,g=n.originalLaneIndex;if(m.type==="to_this_lane"&&m.laneIndex!==void 0)f=f.filter(y=>y===m.laneIndex);else if(m.type==="to_another_lane")f=f.filter(y=>y!==g);else if(m.type==="to_or_from_this_lane"&&m.laneIndex!==void 0){const y=typeof m.laneIndex=="number"?m.laneIndex:g;g!==y&&(f=[y])}else if(m.type==="non_matching_protocol"){const y=ve(a,n.cardToShiftId);y&&(f=f.filter(w=>{const _=a.player.protocols[w],S=a.opponent.protocols[w];return y.card.protocol!==_&&y.card.protocol!==S}))}}return f.length>0?{type:"selectLane",laneIndex:f[0]}:{type:"selectLane",laneIndex:0}}case"select_lane_for_shift_all":{let f=n.validLanes||[0,1,2];return f=f.filter(m=>m!==n.sourceLaneIndex),f.length>0?{type:"selectLane",laneIndex:f[0]}:{type:"selectLane",laneIndex:0}}case"select_lane_for_delete":{let f=n.validLanes||[0,1,2];f=f.filter(g=>!(n.excludeSourceLane&&g===n.laneIndex));const m=f.map(g=>{let y=0,w=0;const _=n.deleteFilter;for(const S of a.player.lanes[g])_!=null&&_.valueRange&&S.isFaceUp?S.value>=_.valueRange.min&&S.value<=_.valueRange.max&&(y+=1):_!=null&&_.valueRange||(y+=1);for(const S of a.opponent.lanes[g])_!=null&&_.valueRange&&S.isFaceUp?S.value>=_.valueRange.min&&S.value<=_.valueRange.max&&(w+=2):_!=null&&_.valueRange||(w+=2);return{laneIndex:g,score:y-w}});return m.sort((g,y)=>y.score-g.score),{type:"selectLane",laneIndex:((l=m[0])==null?void 0:l.laneIndex)??0}}case"select_lane_for_delete_all":return n.validLanes.length>0?{type:"selectLane",laneIndex:n.validLanes[0]}:{type:"selectLane",laneIndex:0};case"select_lane_for_play":{let f=n.validLanes||[0,1,2];return n.disallowedLaneIndex!==void 0&&(f=f.filter(m=>m!==n.disallowedLaneIndex)),f=f.filter(m=>Pa(a,"opponent",m,!n.isFaceDown,"").allowed),f.length>0?{type:"selectLane",laneIndex:((i=f.filter(g=>!a.opponent.compiled[g]).map(g=>({lane:g,value:a.opponent.laneValues[g]})).sort((g,y)=>y.value-g.value)[0])==null?void 0:i.lane)??f[0]}:{type:"skip"}}case"select_lane_for_return":{const m=[0,1,2].map(g=>{const y=n.returnFilter;let w=0,_=0;for(const S of a.player.lanes[g]){const k=S.isFaceUp?S.value:2;(y==null?void 0:y.valueEquals)!==void 0&&k!==y.valueEquals||(w+=k)}for(const S of a.opponent.lanes[g]){const k=S.isFaceUp?S.value:2;(y==null?void 0:y.valueEquals)!==void 0&&k!==y.valueEquals||(_+=k)}return{laneIndex:g,score:w-_,hasTargets:w>0||_>0}}).filter(g=>g.hasTargets);return m.sort((g,y)=>y.score-g.score),{type:"selectLane",laneIndex:((c=m[0])==null?void 0:c.laneIndex)??0}}case"prompt_optional_effect":return((p=(d=n.effectDef)==null?void 0:d.params)==null?void 0:p.action)==="give"?{type:"resolveOptionalEffectPrompt",accept:!1}:{type:"resolveOptionalEffectPrompt",accept:!0};case"prompt_optional_discard_custom":return{type:"resolveOptionalDiscardCustomPrompt",accept:!1};case"prompt_optional_shuffle_trash":return{type:"resolvePrompt",accept:(n.trashCount||0)>0};case"select_card_from_revealed_deck":{const f=n.selectableCardIds||[];return f.length>0?{type:"selectRevealedDeckCard",cardId:f[0]}:{type:"resolvePrompt",accept:!1}}case"custom_choice":return{type:"resolveCustomChoice",optionIndex:0};case"flip_self":return n.sourceCardId?{type:"flipCard",cardId:n.sourceCardId}:{type:"skip"};case"prompt_rearrange_protocols":return sm(a,n);case"prompt_swap_protocols":return{type:"resolveSwapProtocols",indices:[0,1]};case"select_card_from_hand_to_play":{const f=n.selectableCardIds,m=f?a.opponent.hand.filter(g=>f.includes(g.id)):a.opponent.hand;if(m.length>0){const g=m[0];let y=n.validLanes||[0,1,2].filter(w=>w!==n.disallowedLaneIndex);if(y=y.filter(w=>Pa(a,"opponent",w,!n.isFaceDown,g.protocol).allowed),y.length>0){const w=y.filter(_=>!a.opponent.compiled[_]).map(_=>({lane:_,value:a.opponent.laneValues[_]})).sort((_,S)=>S.value-_.value);return{type:"playCard",cardId:g.id,laneIndex:((h=w[0])==null?void 0:h.lane)??y[0],isFaceUp:!1}}}return{type:"skip"}}case"select_card_from_hand_to_give":return a.opponent.hand.length>0?{type:"giveCard",cardId:[...a.opponent.hand].sort((m,g)=>m.value-g.value)[0].id}:{type:"skip"};case"select_card_from_hand_to_reveal":return a.opponent.hand.length>0?{type:"revealCard",cardId:a.opponent.hand[0].id}:{type:"skip"};case"reveal_opponent_hand":return{type:"skip"};case"select_board_card_to_reveal":{const f=zl(a,n.actor,n.targetFilter||{faceState:"face_down",position:"uncovered"},void 0,n.sourceCardId);return f.length>0?{type:"revealCard",cardId:f[0].id}:{type:"skip"}}case"prompt_shift_or_flip_revealed_card":{const f=ve(a,n.revealedCardId);return f?f.owner==="player"?{type:"resolvePrompt",accept:!0}:{type:"resolvePrompt",accept:!1}:{type:"resolvePrompt",accept:!1}}case"select_lane_to_shift_revealed_card":{const f=ve(a,n.revealedCardId);if(!f)return{type:"selectLane",laneIndex:0};let m=-1;for(let y=0;y<a[f.owner].lanes.length;y++)if(a[f.owner].lanes[y].some(w=>w.id===n.revealedCardId)){m=y;break}const g=[0,1,2].filter(y=>y!==m);return g.length>0?{type:"selectLane",laneIndex:g[0]}:{type:"selectLane",laneIndex:0}}case"shift_flipped_card_optional":{const f=n.cardId,m=ve(a,f);if(!m)return{type:"skip"};let g=m.laneIndex??-1;if(g===-1){for(let w=0;w<a[m.owner].lanes.length;w++)if(a[m.owner].lanes[w].some(_=>_.id===f)){g=w;break}}const y=[0,1,2].filter(w=>w!==g);return y.length===0?{type:"skip"}:{type:"selectLane",laneIndex:y[0]}}case"select_phase_effect":{const f=n;return f.availableEffects.length===0?{type:"skip"}:{type:"flipCard",cardId:f.availableEffects[0].cardId}}}return{type:"skip"}},k0=(a,n)=>{if(n)return E0(a,n);if(a.phase==="compile"&&a.compilableLanes.length>0)return{type:"compile",laneIndex:a.compilableLanes[0]};if(a.phase==="action"){const l=j0(a);if(l)return{type:"playCard",...l};if(a.opponent.hand.length<=1)return{type:"fillHand"};for(const i of a.opponent.hand)for(let c=0;c<3;c++){if(a.opponent.compiled[c])continue;if(Pa(a,"opponent",c,!1,i.protocol).allowed)return{type:"playCard",cardId:i.id,laneIndex:c,isFaceUp:!1}}return{type:"fillHand"}}return{type:"fillHand"}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * NORMAL AI - Plays like a human player
 * - Makes good strategic decisions
 * - No memory of revealed cards
 * - 20% chance to make suboptimal moves for realism
 * - Balanced between Easy and Hard
 */const zr=["delete","flip","shift","return","discard"],Ft=a=>{let n=12-a.value;return zr.some(l=>a.keywords[l])&&(n+=6),a.keywords.draw&&(n+=3),a.keywords.play&&(n+=8),a.keywords.prevent&&(n+=4),n},qr=(a,n,l)=>{let i;for(const d of l[n].lanes)if(d.some(p=>p.id===a.id)){i=d;break}if(!i)return 0;if(!a.isFaceUp)return i.some(p=>p.isFaceUp&&p.protocol==="Darkness"&&p.value===2)?4:2;let c=a.value*2.5;return a.top.length>0&&(c+=6),(a.bottom.includes("Start:")||a.bottom.includes("End:"))&&(c+=8),a.bottom.includes("covered:")&&(c+=5),zr.some(d=>a.keywords[d])&&(c+=4),c},Ur=()=>Math.random()<.2,Mh=a=>a+(Math.random()*10-5),$r=(a,n,l,i)=>{const c=l.position||"uncovered";return!(c==="uncovered"&&!n||c==="covered"&&n||l.faceState==="face_up"&&!a.isFaceUp||l.faceState==="face_down"&&a.isFaceUp||l.excludeSelf&&i&&a.id===i||l.valueRange&&(!a.isFaceUp||a.value<l.valueRange.min||a.value>l.valueRange.max)||l.valueEquals!==void 0&&(!a.isFaceUp||a.value!==l.valueEquals))},N0=a=>{const n=[],l=im(a,"opponent"),i=a.player.lanes.flat().length+a.opponent.lanes.flat().length,c=i<=3,d=i>3&&i<=8,h=a.player.lanes.flat().length>0,f=a.player.compiled.filter(Boolean).length,m=a.controlCardHolder==="opponent";a.controlCardHolder;let g=0;for(let C=0;C<3;C++)a.opponent.laneValues[C]>a.player.laneValues[C]?g++:a.player.laneValues[C]>a.opponent.laneValues[C];const w=a.useControlMechanic===!0&&f>=1&&!m;for(let C=0;C<3&&!(!a.player.compiled[C]&&a.player.laneValues[C]>=10&&a.player.laneValues[C]>a.opponent.laneValues[C]);C++);const _=a.opponent.compiled.filter(Boolean).length;let S=-1;if(_<3&&!w){const C=[];for(let b=0;b<3;b++){if(a.opponent.compiled[b])continue;const T=a.opponent.protocols[b],A=a.player.protocols[b],H=a.opponent.laneValues[b],$=a.player.laneValues[b],B=a.opponent.hand.filter(N=>N.protocol===T||N.protocol===A);if($>=10&&!a.player.compiled[b]){const N=Math.max(...B.map(R=>R.value),0),P=Math.max(N,2);if(H+P<=$)continue}let X=0,I=`Lane ${b} (${T}): value=${H}`;X+=H*15,H>=8?(X+=100,I+=` [ALMOST COMPILE: ${H}]`):H>=6?(X+=60,I+=` [Near compile: ${H}]`):H>=4&&(X+=30,I+=` [Building: ${H}]`),X+=B.length*10,B.length>0&&(I+=` [${B.length} cards]`);const F=B.filter(N=>N.value>=4);X+=F.length*20,$>H&&(X-=($-H)*5),B.length===0&&(X-=30,I+=" [No matching cards - face-down only]"),C.push({laneIndex:b,score:X,reason:I})}C.sort((b,T)=>T.score-b.score),C.length>0&&(S=C[0].laneIndex)}const k=(C,b)=>C.keywords.flip||C.keywords.delete||C.keywords.shift||C.keywords.return?a.player.lanes.flat().length>0||a.opponent.lanes.some((H,$)=>$!==b&&H.length>0)||a.opponent.lanes[b].length>0:!0,j=C=>C.keywords.draw?a.opponent.hand.length>=5:!1;for(const C of a.opponent.hand)for(let b=0;b<3;b++){const T=Pa(a,"opponent",b,!0,C.protocol),A=Pa(a,"opponent",b,!1,C.protocol);if(!T.allowed&&!A.allowed||a.opponent.compiled[b])continue;const H=a.player.laneValues[b]>=10&&a.player.laneValues[b]>a.opponent.laneValues[b]&&!a.player.compiled[b];if(H){const N=Math.max(T.allowed?C.value:0,A.allowed?ea({...C,isFaceUp:!1},a.opponent.lanes[b]):0);if(a.opponent.laneValues[b]+N<=a.player.laneValues[b]&&!zr.some(P=>C.keywords[P]))continue}let $=!1;if(cm(C)){let N=0;for(let D=0;D<3;D++)if(a.opponent.lanes[D].length>0){if(D===b)continue;N++}N===0&&($=!0)}if(Hd(C)){const N=a.opponent.laneValues[b],D=Math.max(0,10-C.value);if(N<D)continue;const P=N+C.value,L=a.player.laneValues[b];if(P<=L)continue}const B=b0(a,"opponent",b);if(B!==null){const N=a.opponent.laneValues[b],D=N+C.value-B,P=D>=10&&D>a.player.laneValues[b],L=N-B>=4;if(!P&&!L)continue}const X=H;let I=!1;if(dm(C)){let N=0;for(let D=0;D<3;D++){const P=a.opponent.lanes[D];if(P.length>0&&D!==b){const L=P[P.length-1],R=L.isFaceUp?L.value:2;R>N&&(N=R)}}C.value>=N&&(I=!0)}if(T.allowed&&!l&&!I&&!$){let N=0,D=`Play ${C.protocol}-${C.value} face-up in lane ${b}`;const P=C.value,L=a.opponent.laneValues[b]+P;if(X)L>a.player.laneValues[b]?(N=180+L*5,D+=" [Blocks compile!]"):(N=-150,D+=" [Fails to block]");else{if(N+=P*10,L>=10&&L>a.player.laneValues[b]&&!a.opponent.compiled[b])N+=200,D+=` [COMPILE: ${L}]`;else if(L>=8&&L<10&&!a.opponent.compiled[b]){const O=a.opponent.lanes[b].some(ee=>ee.isFaceUp&&ee.protocol==="Darkness"&&ee.value===2)?4:2;a.opponent.laneValues[b]+O>=10&&L<10?(N-=50,D+=` [Near ${L} but face-down could compile!]`):(N+=40,D+=` [Near compile: ${L}]`)}c&&P<=2&&(N-=50,D+=" [Low value early game penalty]"),k(C,b)||(N-=80,D+=" [No valid targets for effect]"),j(C)&&(N-=30,D+=" [Draw would cause discard]");const R=zr.some(O=>C.keywords[O]);if(R&&h?d&&a.player.laneValues[b]>=5?(N+=35,D+=" [Disruption with targets]"):a.player.laneValues[b]>=8&&(N+=50,D+=" [Disruption near compile]"):R&&!h&&(N-=40,D+=" [Disruption but no targets]"),S!==-1&&!w&&(b===S?(N+=150,D+=" [FOCUS LANE]"):(N-=100,D+=" [Not focus lane]")),w){const O=a.opponent.laneValues[b]>a.player.laneValues[b],Z=L>a.player.laneValues[b],ee=a.opponent.laneValues[b]===a.player.laneValues[b];if(O)N-=200,D+=" [ALREADY LEADING - DON'T WASTE!]";else if(!O&&Z)g===1?(N+=500,D+=" [CONTROL CAPTURE! 1->2 leads]"):g===0?(N+=300,D+=" [First lead! 0->1 leads]"):(N+=100,D+=" [Extra lead]");else if(ee&&Z)g===1?(N+=450,D+=" [BREAK TIE FOR CONTROL!]"):(N+=250,D+=" [Break tie]");else if(!O&&!Z&&g===1){const M=a.player.laneValues[b]-L;M<=3?(N+=200,D+=` [BUILD toward 2nd lead, gap=${M}]`):M<=6?(N+=150,D+=` [BUILD toward 2nd lead, gap=${M}]`):(N+=100,D+=` [BUILD toward 2nd lead, gap=${M}]`)}}}n.push({move:{type:"playCard",cardId:C.id,laneIndex:b,isFaceUp:!0},score:Mh(N),reason:D})}if(A.allowed){const N=ea({...C,isFaceUp:!1},a.opponent.lanes[b]),D=a.opponent.laneValues[b]+N,P=a.opponent.laneValues[b];let L=-100,R=`Play ${C.protocol}-${C.value} face-down in lane ${b}`;if(X?D>a.player.laneValues[b]?(L=150,R+=" [Blocks compile]"):(L=-200,R+=" [Fails to block]"):!a.opponent.compiled[b]&&D>=10&&D>a.player.laneValues[b]?(L=300,R+=` [COMPILE: Face-down finishes at ${P} -> ${D} beats player ${a.player.laneValues[b]}]`):!a.opponent.compiled[b]&&a.player.laneValues[b]>=10&&D>=a.player.laneValues[b]?(L=250,R+=` [BLOCK COMPILE: Face-down reaches ${D} vs player ${a.player.laneValues[b]}]`):!a.opponent.compiled[b]&&a.player.laneValues[b]>=10&&D<a.player.laneValues[b]?(L=-200,R+=` [WASTED: ${D} vs player ${a.player.laneValues[b]} - player still compiles!]`):S===b&&!a.opponent.compiled[b]&&P>=4?(L=50+P*10,R+=` [BUILD FOCUS: ${P} -> ${D}]`):!T.allowed&&C.value<=1?(L=-20,R+=" [No face-up option, low value]"):(L=-120,R+=" [Avoid: Face-up is better]"),S!==-1&&L<50&&!w&&(b===S?(L+=50,R+=" [Focus lane]"):(L-=80,R+=" [Not focus lane]")),w){const O=a.opponent.laneValues[b]>a.player.laneValues[b],Z=D>a.player.laneValues[b],ee=a.opponent.laneValues[b]===a.player.laneValues[b];if(O)L-=200,R+=" [FD ALREADY LEADING - DON'T WASTE!]";else if(!O&&Z)g===1?(L+=400,R+=" [FD CONTROL CAPTURE! 1->2 leads]"):g===0&&(L+=250,R+=" [FD First lead!]");else if(ee&&Z)g===1?(L+=350,R+=" [FD BREAK TIE FOR CONTROL!]"):(L+=200,R+=" [FD Break tie]");else if(!O&&!Z&&g===1){const M=a.player.laneValues[b]-D;M<=3?(L+=150,R+=` [FD BUILD toward 2nd lead, gap=${M}]`):M<=6&&(L+=100,R+=` [FD BUILD toward 2nd lead, gap=${M}]`)}}n.push({move:{type:"playCard",cardId:C.id,laneIndex:b,isFaceUp:!1},score:Mh(L),reason:R})}}if(a.opponent.hand.length===0)n.push({move:{type:"fillHand"},score:500,reason:"Must refill - no cards"});else{const C=a.player.laneValues.some((A,H)=>A>=10&&A>a.opponent.laneValues[H]&&!a.player.compiled[H]),b=a.controlCardHolder==="opponent",T=a.player.compiled.some(A=>A);C&&b&&T&&n.push({move:{type:"fillHand"},score:200,reason:"Emergency draw to block compile with control swap"})}if(n.length===0)return{type:"fillHand"};n.sort((C,b)=>b.score-C.score);const E=C=>{if(C.type==="playCard"&&C.isFaceUp){const b=a.opponent.hand.find(A=>A.id===C.cardId);if(!b)return!1;const T=Pa(a,"opponent",C.laneIndex,!0,b.protocol);if(!T.allowed)return console.warn(`[AI Safety] Rejecting invalid face-up play: ${b.protocol}-${b.value} in lane ${C.laneIndex} - ${T.reason}`),!1}return!0};if(Ur()&&n.length>1&&n[1].score>0&&E(n[1].move))return n[1].move;for(const C of n)if(E(C.move))return C.move;return console.warn("[AI Safety] No valid moves found, falling back to fillHand"),{type:"fillHand"}},R0=(a,n)=>{var l,i;switch(n.type){case"prompt_use_control_mechanic":{const c=a.player.compiled.filter(f=>f).length,d=a.compilableLanes.length>0?a.compilableLanes[0]:null;let p=-1;for(let f=0;f<3;f++)if(!a.player.compiled[f]&&a.player.laneValues[f]>=10&&a.player.laneValues[f]>a.opponent.laneValues[f]){p=f;break}const h=a.player.compiled.map((f,m)=>f?m:-1).filter(f=>f!==-1);return p!==-1&&h.length>0?{type:"resolveControlMechanicPrompt",choice:"player"}:c===0?Lh(a,d)&&!Ur()?{type:"resolveControlMechanicPrompt",choice:"opponent"}:{type:"resolveControlMechanicPrompt",choice:"skip"}:C0(a,d)?{type:"resolveControlMechanicPrompt",choice:"player"}:Lh(a,d)&&!Ur()?{type:"resolveControlMechanicPrompt",choice:"opponent"}:{type:"resolveControlMechanicPrompt",choice:"skip"}}case"discard":return{type:"discardCards",cardIds:[...a.opponent.hand].sort((d,p)=>{const h=zr.some(m=>d.keywords[m]),f=zr.some(m=>p.keywords[m]);return h&&!f?1:!h&&f?-1:Ft(d)-Ft(p)}).slice(0,n.count).map(d=>d.id)};case"discard_completed":return{type:"skip"};case"select_opponent_card_to_flip":{const d=(h=>a[h].lanes.map(f=>f.length>0?f[f.length-1]:null).filter(f=>f!==null))("player");if(d.length===0)return{type:"skip"};const p=d.map(h=>({cardId:h.id,score:h.isFaceUp?h.value+5:3}));return p.sort((h,f)=>f.score-h.score),{type:"flipCard",cardId:p[0].cardId}}case"select_cards_to_delete":{const c=n.disallowedIds||[],d=n.allowedIds,p=n.targetFilter??{},h="actorChooses"in n?n.actorChooses:"effect_owner",f=n.sourceCardId;if(h==="card_owner"&&(p==null?void 0:p.owner)==="opponent"){const y=[];return a.opponent.lanes.forEach(w=>{if(w.length>0){const _=w[w.length-1];if($r(_,!0,p,f)){if(d&&!d.includes(_.id))return;y.push(_)}}}),y.length>0?(y.sort((w,_)=>w.value-_.value),{type:"deleteCard",cardId:y[0].id}):{type:"skip"}}const m=y=>a[y].lanes.map(w=>w.length>0?w[w.length-1]:null).filter(w=>w!==null).filter(w=>$r(w,!0,p,f)).filter(w=>!d||d.includes(w.id)),g=p==null?void 0:p.owner;if(g==="own"){const y=m("opponent").filter(w=>!c.includes(w.id));if(y.length>0)return{type:"deleteCard",cardId:y.sort((_,S)=>_.value-S.value)[0].id}}else if(g==="opponent"){const y=m("player").filter(w=>!c.includes(w.id));if(y.length>0){const w=y.map(_=>{const S=a.player.lanes.findIndex(E=>E.some(C=>C.id===_.id)),k=a.player.laneValues[S],j=k>=10&&k>a.opponent.laneValues[S];return{cardId:_.id,score:qr(_,"player",a)+k+(j?50:0)}});return w.sort((_,S)=>S.score-_.score),{type:"deleteCard",cardId:w[0].cardId}}}else{const y=m("player").filter(_=>!c.includes(_.id));if(y.length>0){const _=y.map(S=>{const k=a.player.lanes.findIndex(C=>C.some(b=>b.id===S.id)),j=a.player.laneValues[k],E=j>=10&&j>a.opponent.laneValues[k];return{cardId:S.id,score:qr(S,"player",a)+j+(E?50:0)}});return _.sort((S,k)=>k.score-S.score),{type:"deleteCard",cardId:_[0].cardId}}const w=m("opponent").filter(_=>!c.includes(_.id));if(w.length>0)return{type:"deleteCard",cardId:w.sort((S,k)=>S.value-k.value)[0].id}}return{type:"skip"}}case"select_any_card_to_flip":case"select_any_other_card_to_flip":case"select_any_face_down_card_to_flip_optional":case"select_any_card_to_flip_optional":{const c=ma(a),d=n.targetFilter,p=n.sourceCardId,h=n.actor,f=n.currentLaneIndex??n.laneIndex,m=n.scope,g=[];for(const w of["player","opponent"])if(!(d&&(d.owner==="own"&&w!==h||d.owner==="opponent"&&w===h)))for(let _=0;_<a[w].lanes.length;_++){if(f!==void 0&&_!==f||m==="this_lane"&&f!==void 0&&_!==f)continue;const S=a[w].lanes[_];if(S.length!==0)for(let k=0;k<S.length;k++){const j=S[k],E=k===S.length-1;if(d){if(!$r(j,E,d,p))continue}else if(!E)continue;c&&!j.isFaceUp||g.push({card:j,owner:w})}}if(g.length===0)return{type:"skip"};const y=g.map(({card:w,owner:_})=>{let S=0,k=-1;for(let A=0;A<a[_].lanes.length;A++)if(a[_].lanes[A].some(H=>H.id===w.id)){k=A;break}const j=k>=0?a[_].laneValues[k]:0,E=k>=0?a[_].compiled[k]:!1,C=w.isFaceUp?w.value:2,T=(w.isFaceUp?2:w.value)-C;return _==="player"?w.isFaceUp?(S=-T*15,S+=qr(w,"player",a)):w.value<=1?S=20:S=-30:w.isFaceUp?T>0?(S=T*20+50,!E&&j+T>=10&&(S+=200)):S=T*15-30:T>0?(S=T*20+40,!E&&j+T>=10&&(S+=200)):S=-10,{cardId:w.id,score:S}});return y.sort((w,_)=>_.score-w.score),{type:"flipCard",cardId:y[0].cardId}}case"plague_2_opponent_discard":return a.opponent.hand.length===0?{type:"skip"}:{type:"discardCards",cardIds:[[...a.opponent.hand].sort((d,p)=>Ft(d)-Ft(p))[0].id]};case"select_cards_from_hand_to_discard_for_fire_4":{const c=Math.min(3,a.opponent.hand.length);return c===0?{type:"skip"}:{type:"discardCards",cardIds:[...a.opponent.hand].sort((h,f)=>Ft(h)-Ft(f)).slice(0,c).map(h=>h.id)}}case"select_cards_from_hand_to_discard_for_hate_1":{const c=Math.min(n.count||1,a.opponent.hand.length);return c===0?{type:"skip"}:{type:"discardCards",cardIds:[...a.opponent.hand].sort((h,f)=>Ft(h)-Ft(f)).slice(0,c).map(h=>h.id)}}case"select_card_from_hand_to_play":{if(a.opponent.hand.length===0)return{type:"skip"};const c=n.faceDown===!0,d=n.selectableCardIds,p=d?a.opponent.hand.filter(g=>d.includes(g.id)):a.opponent.hand;if(p.length===0)return{type:"skip"};let h=n.validLanes||[0,1,2].filter(g=>g!==n.disallowedLaneIndex);if(h=h.filter(g=>{const y=a.player.lanes[g],w=y.length>0?y[y.length-1]:null;return!(w&&w.isFaceUp&&w.protocol==="Plague"&&w.value===0)}),h.length===0)return{type:"skip"};const f=[];for(const g of p)for(const y of h){if(!c){const S=a.opponent.lanes.flat().some(C=>C.isFaceUp&&C.protocol==="Spirit"&&C.value===1),k=a.opponent.lanes.some(C=>{if(C.length===0)return!1;const b=C[C.length-1];return b.isFaceUp&&b.protocol==="Chaos"&&b.value===3}),j=[...a.player.lanes.flat(),...a.opponent.lanes.flat()].some(C=>C.isFaceUp&&C.protocol==="Anarchy"&&C.value===1);let E;if(j?E=g.protocol!==a.opponent.protocols[y]&&g.protocol!==a.player.protocols[y]:E=g.protocol===a.opponent.protocols[y]||g.protocol===a.player.protocols[y]||S||k,E){const C=g.value,b=a.opponent.laneValues[y]+C;let T=Ft(g)+C*2;b>=10&&b>a.player.laneValues[y]&&(T+=100),f.push({cardId:g.id,laneIndex:y,isFaceUp:!0,score:T})}}if(!a.player.lanes[y].some(S=>S.isFaceUp&&S.protocol==="Metal"&&S.value===2)){const S=ea({...g,isFaceUp:!1},a.opponent.lanes[y]),k=a.opponent.laneValues[y]+S;let j=S*2;k>=10&&k>a.player.laneValues[y]&&(j+=80),f.push({cardId:g.id,laneIndex:y,isFaceUp:!1,score:j})}}if(f.length===0)return{type:"skip"};f.sort((g,y)=>y.score-g.score);const m=f[0];return{type:"playCard",cardId:m.cardId,laneIndex:m.laneIndex,isFaceUp:m.isFaceUp}}case"select_card_from_hand_to_give":return a.opponent.hand.length===0?{type:"skip"}:{type:"giveCard",cardId:[...a.opponent.hand].sort((d,p)=>Ft(d)-Ft(p))[0].id};case"select_card_from_hand_to_reveal":return a.opponent.hand.length===0?{type:"skip"}:{type:"revealCard",cardId:[...a.opponent.hand].sort((d,p)=>Ft(p)-Ft(d))[0].id};case"select_card_to_return":case"select_opponent_card_to_return":{const d={position:"uncovered",...n.targetFilter||{}},p=n.targetOwner||d.owner,h=n.sourceCardId,f=n.actor,m=[];for(const w of["player","opponent"])if(!(p==="own"&&w!==f)&&!(p==="opponent"&&w===f))for(const _ of a[w].lanes)for(let S=0;S<_.length;S++){const k=_[S],j=S===_.length-1;$r(k,j,d,h)&&m.push({card:k,owner:w})}if(m.length===0)return{type:"skip"};const g=m.filter(w=>w.owner==="player"),y=m.filter(w=>w.owner==="opponent");return g.length>0?(g.sort((w,_)=>qr(_.card,"player",a)-qr(w.card,"player",a)),{type:"returnCard",cardId:g[0].card.id}):y.length>0?(y.sort((w,_)=>w.card.value-_.card.value),{type:"returnCard",cardId:y[0].card.id}):{type:"returnCard",cardId:m[0].card.id}}case"select_lane_for_play":{let c=n.validLanes||[0,1,2];if(c=c.filter(p=>!("disallowedLaneIndex"in n)||p!==n.disallowedLaneIndex),c=c.filter(p=>{const h=a.player.lanes[p],f=h.length>0?h[h.length-1]:null,m=f&&f.isFaceUp&&f.protocol==="Plague"&&f.value===0,g="isFaceDown"in n&&n.isFaceDown&&h.some(y=>y.isFaceUp&&y.protocol==="Metal"&&y.value===2);return!m&&!g}),c.length===0)return{type:"skip"};const d=c.map(p=>{const h=a.opponent.laneValues[p]-a.player.laneValues[p];return{laneIndex:p,score:-h}});return d.sort((p,h)=>h.score-p.score),{type:"selectLane",laneIndex:d[0].laneIndex}}case"prompt_rearrange_protocols":return sm(a,n);case"prompt_swap_protocols":{const{target:c}=n,d=a[c].protocols,p=a[c].hand,h=a[c].compiled,f=a[c].laneValues,m=[[0,1],[0,2],[1,2]];let g=[0,1],y=-1/0;for(const w of m){const[_,S]=w,k=[...d];[k[_],k[S]]=[k[S],k[_]];let j=0;const E=h[_],C=h[S],b=f[_],T=f[S];if(c==="opponent"){E&&!C?T<b&&(j+=30):C&&!E&&b<T&&(j+=30);for(const A of p){const H=A.protocol===d[_],$=A.protocol===d[S],B=A.protocol===k[_],X=A.protocol===k[S],I=E?.5:1.5,F=C?.5:1.5;B&&!H&&(j+=Ft(A)*I),X&&!$&&(j+=Ft(A)*F),!B&&H&&(j-=Ft(A)*I),!X&&$&&(j-=Ft(A)*F)}}else{E&&!C?b>T&&(j+=25):C&&!E&&T>b&&(j+=25);for(const A of p){const H=A.protocol===d[_],$=A.protocol===d[S],B=A.protocol===k[_],X=A.protocol===k[S],I=E?.5:1.5,F=C?.5:1.5;B&&!H&&(j-=Ft(A)*I),X&&!$&&(j-=Ft(A)*F),!B&&H&&(j+=Ft(A)*I),!X&&$&&(j+=Ft(A)*F)}}j>y&&(y=j,g=w)}return{type:"resolveSwapProtocols",indices:g}}case"select_lane_for_shift":{let c=n.validLanes||[0,1,2];if(c=c.filter(d=>!("disallowedLaneIndex"in n)||d!==n.disallowedLaneIndex).filter(d=>!("originalLaneIndex"in n)||d!==n.originalLaneIndex),"sourceCardId"in n){const d=[...a.player.lanes.flat(),...a.opponent.lanes.flat()].find(p=>p.id===n.sourceCardId);if(d&&d.protocol==="Gravity"&&d.value===1){let p=null;for(let h=0;h<3;h++)if([...a.player.lanes[h],...a.opponent.lanes[h]].some(m=>m.id===n.sourceCardId)){p=h;break}p!==null&&"originalLaneIndex"in n&&(n.originalLaneIndex===p||(c=[p]))}if(d&&d.protocol==="Anarchy"&&d.value===1){const p="cardToShiftId"in n?n.cardToShiftId:null;if(p){const h=[...a.player.lanes.flat(),...a.opponent.lanes.flat()].find(f=>f.id===p);h&&(c=c.filter(f=>{const m=a.player.protocols[f],g=a.opponent.protocols[f],y=h.protocol;return y!==m&&y!==g}))}}}if(c.length>0){const d="cardToShiftId"in n?n.cardToShiftId:null;let p=null,h=0;if(d)for(const m of["player","opponent"]){for(const g of a[m].lanes){const y=g.find(w=>w.id===d);if(y){p=m,h=y.isFaceUp?y.value:2;break}}if(p)break}const f=c.map(m=>{let g=0;const y=a.player.laneValues[m],w=a.opponent.laneValues[m],_=a.player.compiled[m],S=a.opponent.compiled[m];return p==="player"?_?g+=100:w>y?g+=50:y>=6&&y<10&&!_&&(g-=50):p==="opponent"&&(!S&&w<10?w+h>=10?g+=100:w>=6?g+=60:g+=30:S&&(g-=50)),{laneIdx:m,score:g}});if(f.sort((m,g)=>g.score-m.score),Ur()&&f.length>1){const m=Math.floor(Math.random()*f.length);return{type:"selectLane",laneIndex:f[m].laneIdx}}return{type:"selectLane",laneIndex:f[0].laneIdx}}return{type:"selectLane",laneIndex:0}}case"select_lane_for_delete_all":{const c="validLanes"in n?n.validLanes:[0,1,2];return c.length>0?{type:"selectLane",laneIndex:c[Math.floor(Math.random()*c.length)]}:{type:"skip"}}case"select_lane_for_return":{const c=n.targetFilter||{},d=n.actor,p=c.valueEquals,h=c.valueRange,f=[];for(let m=0;m<3;m++){let g=0,y=0;const w=um(a,m);for(const k of["player","opponent"]){if(c.owner==="own"&&k!==d||c.owner==="opponent"&&k===d)continue;const j=a[k].lanes[m];for(let E=0;E<j.length;E++){const C=j[E],b=E===j.length-1;if(c.position==="uncovered"&&!b||c.position==="covered"&&b)continue;const T=C.isFaceUp?C.value:2+w;p!==void 0&&T!==p||h&&(T<h.min||T>h.max)||(k==="player"?g+=T:y+=T)}}const _=g-y,S=`Lane ${m}: Player loses ${g}, we lose ${y}, net=${_}`;f.push({laneIndex:m,score:_,reason:S})}f.sort((m,g)=>g.score-m.score);for(const m of f);return f.length>0?{type:"selectLane",laneIndex:f[0].laneIndex}:{type:"selectLane",laneIndex:0}}case"prompt_optional_effect":{const{effectDef:c}=n,d=(l=c==null?void 0:c.params)==null?void 0:l.action,p=(i=c==null?void 0:c.params)==null?void 0:i.targetFilter;if(d==="give")return{type:"resolveOptionalEffectPrompt",accept:!1};if(d==="flip"){let h=!1;const f=(p==null?void 0:p.position)||"uncovered";for(const m of["player","opponent"])if(!((p==null?void 0:p.owner)==="own"&&m!=="opponent")&&!((p==null?void 0:p.owner)==="opponent"&&m==="opponent")){for(let g=0;g<a[m].lanes.length;g++){const y=a[m].lanes[g];if(y.length!==0){for(let w=0;w<y.length;w++){const _=y[w],S=w===y.length-1,k=!S;if(f==="uncovered"&&!S||f==="covered"&&!k||(p==null?void 0:p.faceState)==="face_up"&&!_.isFaceUp||(p==null?void 0:p.faceState)==="face_down"&&_.isFaceUp)continue;const j=_.isFaceUp?_.value:2,E=_.isFaceUp?2:_.value;if(m==="player"){if(_.isFaceUp&&j>E){h=!0;break}}else{const C=a.opponent.laneValues[g],b=E-j;if(_.isFaceUp&&b>0){h=!0;break}if(!_.isFaceUp&&_.value>2){h=!0;break}if(b>0&&C+b>=10&&!a.opponent.compiled[g]){h=!0;break}}}if(h)break}}if(h)break}return{type:"resolveOptionalEffectPrompt",accept:h}}return{type:"resolveOptionalEffectPrompt",accept:!Ur()}}case"select_card_from_other_lanes_to_delete":{const{disallowedLaneIndex:c,lanesSelected:d}=n,p=[];for(let h=0;h<3;h++){if(h===c||d.includes(h))continue;const f=a.player.lanes[h];if(f.length>0){p.push(f[f.length-1]);continue}const m=a.opponent.lanes[h];m.length>0&&p.push(m[m.length-1])}return p.length>0?{type:"deleteCard",cardId:p[0].id}:{type:"skip"}}case"select_face_down_card_to_delete":{const c="disallowedIds"in n&&Array.isArray(n.disallowedIds)?n.disallowedIds:[],d=f=>a[f].lanes.map(m=>m.length>0?m[m.length-1]:null).filter(m=>m!==null),p=d("player").filter(f=>!c.includes(f.id));if(p.length>0)return{type:"deleteCard",cardId:p[0].id};const h=d("opponent").filter(f=>!c.includes(f.id));return h.length>0?{type:"deleteCard",cardId:h[0].id}:{type:"skip"}}case"select_low_value_card_to_delete":{const c=[];for(const p of["player","opponent"])for(const h of a[p].lanes)h.length>0&&c.push(h[h.length-1]);const d=c.filter(p=>p.isFaceUp&&(p.value===0||p.value===1));return d.length>0?{type:"deleteCard",cardId:d[0].id}:{type:"skip"}}case"select_opponent_face_up_card_to_flip":{const d=(p=>a[p].lanes.map(h=>h.length>0?h[h.length-1]:null).filter(h=>h!==null))("player").filter(p=>p.isFaceUp);return d.length>0?(d.sort((p,h)=>h.value-p.value),{type:"flipCard",cardId:d[0].id}):{type:"skip"}}case"select_covered_card_in_line_to_flip_optional":{const c="optional"in n&&n.optional,p=!["select_any_other_card_to_flip","select_any_other_card_to_flip_for_water_0"].includes(n.type);if(n.type==="select_covered_card_in_line_to_flip_optional"){const{laneIndex:w}=n,_=a.opponent.lanes[w],S=a.player.lanes[w],k=_.filter((H,$,B)=>$<B.length-1),j=S.filter((H,$,B)=>$<B.length-1),E=a.opponent.laneValues[w];if(!a.opponent.compiled[w]){let H=null,$=null;for(const B of k){let X,I;B.isFaceUp?(X=B.value,I=2):(X=ea(B,_,a,w,"opponent"),I=B.value);const F=I-X,N=E+F;F>0&&N>=10&&(!H||N>H.newValue)&&(H={card:B,newValue:N,gain:F}),F>0&&(!$||F>$.gain)&&($={card:B,gain:F,newValue:N})}if(H)return{type:"flipCard",cardId:H.card.id};if($&&$.gain>0)return{type:"flipCard",cardId:$.card.id}}if(a.opponent.compiled[w]){let H=null;for(const $ of k){const B=$.isFaceUp?$.value:ea($,_,a,w,"opponent"),I=($.isFaceUp?2:$.value)-B;I>0&&(!H||I>H.gain)&&(H={card:$,gain:I})}if(H)return{type:"flipCard",cardId:H.card.id}}const b=j.filter(H=>H.isFaceUp);if(b.length>0)return b.sort((H,$)=>$.value-H.value),{type:"flipCard",cardId:b[0].id};const T=k.filter(H=>!H.isFaceUp).map(H=>({card:H,gain:H.value-ea(H,_,a,w,"opponent")})).filter(H=>H.gain>0).sort((H,$)=>$.gain-H.gain);if(T.length>0)return{type:"flipCard",cardId:T[0].card.id};const A=j.filter(H=>!H.isFaceUp);return A.length>0?{type:"flipCard",cardId:A[0].id}:{type:"skip"}}const h=w=>a[w].lanes.map(_=>_.length>0?_[_.length-1]:null).filter(_=>_!==null),f=h("player"),m=h("opponent");{const w=f.filter(_=>_.isFaceUp).sort((_,S)=>S.value-_.value);if(w.length>0)return{type:"flipCard",cardId:w[0].id}}const g=m.filter(w=>!w.isFaceUp);if(g.length>0)return{type:"flipCard",cardId:g[0].id};const y=f.filter(w=>!w.isFaceUp);if(y.length>0)return{type:"flipCard",cardId:y[0].id};{const w=m.filter(S=>!(!S.isFaceUp||!p&&S.id===n.sourceCardId)),_=w.filter(S=>{const k=a.opponent.lanes.findIndex(j=>j.length>0&&j[j.length-1].id===S.id);return k!==-1&&a.opponent.compiled[k]});if(_.length>0&&!c)return{type:"flipCard",cardId:_[0].id};if(w.length>0&&!c)return{type:"flipCard",cardId:w[0].id}}return{type:"skip"}}case"select_card_to_shift_for_anarchy_0":{const c=[...a.player.lanes.flat(),...a.opponent.lanes.flat()];return c.length>0?{type:"shiftCard",cardId:c[Math.floor(Math.random()*c.length)].id}:{type:"skip"}}case"select_card_to_shift_for_anarchy_1":{const{sourceCardId:c}=n,d=[...a.player.lanes.flat(),...a.opponent.lanes.flat()].filter(p=>p.id!==c);return d.length>0?{type:"shiftCard",cardId:d[Math.floor(Math.random()*d.length)].id}:{type:"skip"}}case"select_card_to_shift_for_gravity_1":{const c=[...a.player.lanes.flat(),...a.opponent.lanes.flat()];return c.length>0?{type:"shiftCard",cardId:c[Math.floor(Math.random()*c.length)].id}:{type:"skip"}}case"select_face_down_card_to_shift_for_gravity_4":{const{targetLaneIndex:c}=n,d=[];for(const p of["player","opponent"])for(let h=0;h<a[p].lanes.length;h++)if(h!==c)for(const f of a[p].lanes[h])f.isFaceUp||d.push(f);return d.length>0?{type:"deleteCard",cardId:d[Math.floor(Math.random()*d.length)].id}:{type:"skip"}}case"select_face_down_card_to_shift_for_darkness_4":{const c=[];for(const d of["player","opponent"])for(const p of a[d].lanes)if(p.length>0){const h=p[p.length-1];h.isFaceUp||c.push(h)}return c.length>0?{type:"deleteCard",cardId:c[Math.floor(Math.random()*c.length)].id}:{type:"skip"}}case"shift_flipped_card_optional":{const c=n.cardId,d=n.optional,p=ve(a,c);if(!p)return{type:"skip"};const h=p.card,f=p.owner,m=h.isFaceUp?h.value:2;let g=p.laneIndex??-1;if(g===-1){const A=a[f];for(let H=0;H<A.lanes.length;H++)if(A.lanes[H].some($=>$.id===c)){g=H;break}}if(g===-1)return{type:"skip"};const y=[0,1,2].filter(A=>A!==g);if(y.length===0)return{type:"skip"};const w=a.opponent,_=a.player,S=w.laneValues[g],k=w.compiled[g],j=_.laneValues[g],E=S-m;let C=-1,b=-1/0;const T=0;for(const A of y){const H=w.laneValues[A],$=w.compiled[A],B=_.laneValues[A],X=H+m;let I=0;!k&&S>=8&&S>j&&(I-=100),!$&&X>=10&&X>B&&(I+=80),!$&&H<S&&(k||S<6)&&(I+=20),$&&(I-=30),!$&&H<=B&&X>B&&(I+=25),!k&&S>j&&E<=j&&(I-=40),I>b&&(b=I,C=A)}return d&&b<T?{type:"skip"}:C!==-1?{type:"selectLane",laneIndex:C}:d?{type:"skip"}:{type:"selectLane",laneIndex:y[0]}}case"select_opponent_face_down_card_to_shift":{const c=[];for(const d of a.player.lanes)if(d.length>0){const p=d[d.length-1];p.isFaceUp||c.push(p)}return c.length>0?{type:"deleteCard",cardId:c[Math.floor(Math.random()*c.length)].id}:{type:"skip"}}case"select_opponent_covered_card_to_shift":{const c=[];for(const d of a.player.lanes)for(let p=0;p<d.length-1;p++)c.push(d[p]);return c.length>0?{type:"deleteCard",cardId:c[Math.floor(Math.random()*c.length)].id}:{type:"skip"}}case"select_own_covered_card_to_shift":{const c=[];for(const d of a.opponent.lanes)for(let p=0;p<d.length-1;p++)c.push(d[p]);return c.length>0?{type:"deleteCard",cardId:c[Math.floor(Math.random()*c.length)].id}:{type:"skip"}}case"select_card_to_flip":{const c=n.targetFilter||{},d=n.currentLaneIndex??n.laneIndex,p=n.scope,h=n.actor,f=n.sourceCardId,m=[];for(const y of["player","opponent"])if(!(c.owner==="own"&&y!==h)&&!(c.owner==="opponent"&&y===h))for(let w=0;w<a[y].lanes.length;w++){if(d!==void 0&&w!==d||p==="this_lane"&&d!==void 0&&w!==d)continue;const _=a[y].lanes[w];for(let S=0;S<_.length;S++){const k=_[S];if(xo(a,k.id))continue;const j=wo(a,_,S);$r(k,j,c,f)&&(c.position==="covered_in_this_line"&&j||m.push({card:k,owner:y,laneIndex:w}))}}if(m.length===0)return{type:"skip"};const g=m.map(({card:y,owner:w,laneIndex:_})=>{let S=0;const k=a[w].laneValues[_],j=a[w].compiled[_],E=y.isFaceUp?y.value:2,b=(y.isFaceUp?2:y.value)-E;return w==="player"?y.isFaceUp?(S=-b*15,S+=qr(y,"player",a)):y.value<=1?S=20:S=-30:y.isFaceUp?b>0?(S=b*20+50,!j&&k+b>=10&&(S+=200)):S=b*15-30:b>0?(S=b*20+40,!j&&k+b>=10&&(S+=200)):S=-10,{card:y,score:S}});if(g.sort((y,w)=>w.score-y.score),Ur()&&g.length>1){const y=Math.floor(Math.random()*g.length);return{type:"flipCard",cardId:g[y].card.id}}return{type:"flipCard",cardId:g[0].card.id}}case"select_card_to_shift":{const c=n.targetFilter||{},p=n.scope==="this_lane"?n.sourceLaneIndex??n.currentLaneIndex??n.laneIndex:void 0,h=n.actor,f=n.sourceCardId,m=[];for(const g of["player","opponent"])if(!(c.owner==="own"&&g!==h)&&!(c.owner==="opponent"&&g===h))for(let y=0;y<a[g].lanes.length;y++){if(p!==void 0&&y!==p)continue;const w=a[g].lanes[y];for(let _=0;_<w.length;_++){const S=w[_],k=_===w.length-1;$r(S,k,c,f)&&m.push(S)}}return m.length>0?{type:"shiftCard",cardId:m[Math.floor(Math.random()*m.length)].id}:{type:"skip"}}case"select_board_card_to_reveal_custom":{const c=[];for(const d of["player","opponent"])for(const p of a[d].lanes)if(p.length>0){const h=p[p.length-1];h.isFaceUp||c.push({card:h,owner:d})}if(c.length>0){const d=c.filter(p=>p.owner==="player");return d.length>0?{type:"deleteCard",cardId:d[0].card.id}:{type:"deleteCard",cardId:c[0].card.id}}return{type:"skip"}}case"prompt_shift_or_flip_board_card_custom":{const{revealedCardId:c}=n,d=ve(a,c);return d?d.owner==="opponent"?{type:"resolveRevealBoardCardPrompt",choice:"flip"}:{type:"resolveRevealBoardCardPrompt",choice:"shift"}:{type:"resolveRevealBoardCardPrompt",choice:"skip"}}case"select_lane_to_shift_revealed_board_card_custom":{const c=[0,1,2];return c.sort((d,p)=>a.player.laneValues[d]-a.player.laneValues[p]),{type:"selectLane",laneIndex:c[0]}}case"gravity_2_shift_after_flip":{const{targetLaneIndex:c}=n;return{type:"selectLane",laneIndex:c}}case"flip_self":case"flip_self_for_water_0":case"flip_self_for_psychic_4":case"speed_3_self_flip_after_shift":return n.sourceCardId?{type:"flipCard",cardId:n.sourceCardId}:{type:"skip"};case"anarchy_0_conditional_draw":return{type:"skip"};case"select_any_opponent_card_to_shift":{const c=a.player.lanes.map(d=>d.length>0?d[d.length-1]:null).filter(d=>d!==null);return c.length>0?{type:"deleteCard",cardId:c[Math.floor(Math.random()*c.length)].id}:{type:"skip"}}case"select_own_other_card_to_shift":{const c=a.opponent.lanes.flat().find(d=>d.id!==n.sourceCardId);return c?{type:"deleteCard",cardId:c.id}:{type:"skip"}}case"select_own_face_up_covered_card_to_flip":return{type:"skip"};case"plague_4_opponent_delete":{const c=[];return a.opponent.lanes.forEach(d=>{if(d.length>0){const p=d[d.length-1];p.isFaceUp||c.push(p)}}),c.length>0?(c.sort((d,p)=>d.value-p.value),{type:"deleteCard",cardId:c[0].id}):{type:"skip"}}case"reveal_opponent_hand":case"plague_2_player_discard":case"delete_self":return{type:"skip"};case"select_lane_for_delete":{const c=n.validLanes||[0,1,2],d=n.valueFilter,p=c.map(h=>{let f=0,m=0;for(const g of a.player.lanes[h]){const y=g.isFaceUp?g.value:2;d?g.isFaceUp?g.value>=d.min&&g.value<=d.max&&(f+=y+1):f+=(y+1)*.5:f+=y+1}for(const g of a.opponent.lanes[h]){const y=g.isFaceUp?g.value:2;d?g.isFaceUp?g.value>=d.min&&g.value<=d.max&&(m+=y+3):m+=(y+3)*.5:m+=y+3}return{laneIndex:h,score:f-m}});return p.sort((h,f)=>f.score-h.score),p[0].score>0?{type:"selectLane",laneIndex:p[0].laneIndex}:{type:"selectLane",laneIndex:p[0].laneIndex}}case"select_lane_for_shift_all":{const c=n.validDestinationLanes||n.validLanes||[0,1,2],d=n.sourceLaneIndex,p=c.filter(h=>h!==d);if(p.length>0){const h=p.map(f=>{let m=0;return m+=a.opponent.lanes[f].length*2,m+=a.opponent.laneValues[f],a.player.laneValues[f]>=8&&(m-=5),{laneIndex:f,score:m}});return h.sort((f,m)=>m.score-f.score),{type:"selectLane",laneIndex:h[0].laneIndex}}return c.length>0?{type:"selectLane",laneIndex:c[0]}:{type:"selectLane",laneIndex:0}}case"prompt_optional_draw":return{type:"resolveOptionalEffectPrompt",accept:!0};case"prompt_optional_discard_custom":return{type:"resolveOptionalEffectPrompt",accept:a.opponent.hand.length>4};case"prompt_optional_shuffle_trash":return{type:"resolvePrompt",accept:(n.trashCount||0)>0};case"select_card_from_revealed_deck":{const c=n.selectableCardIds||[];if(c.length>0){const d=Math.floor(Math.random()*c.length);return{type:"selectRevealedDeckCard",cardId:c[d]}}return{type:"resolvePrompt",accept:!1}}case"custom_choice":{const{options:c}=n;if(!c||c.length!==2)return{type:"resolveCustomChoice",optionIndex:0};const d=f=>{var y,w,_;let m=0;const g=((y=f.action)==null?void 0:y.toLowerCase())||"";return g.includes("draw")&&(m+=30),g.includes("discard")&&(m-=20),g.includes("delete")&&((w=f.targetFilter)==null?void 0:w.owner)==="opponent"&&(m+=40),g.includes("delete")&&((_=f.targetFilter)==null?void 0:_.owner)==="own"&&(m-=30),m},p=d(c[0]),h=d(c[1]);return{type:"resolveCustomChoice",optionIndex:p>=h?0:1}}case"select_phase_effect":{const c=n;if(c.availableEffects.length===0)return{type:"skip"};const d=c.availableEffects.map(h=>{let f=0;const m=h.effectDescription.toLowerCase();return m.includes("draw")?f+=100:m.includes("delete")?f+=80:m.includes("shift")?f+=60:m.includes("flip")?f+=40:f+=20,Math.random()<.2&&(f=Math.random()*50),{effect:h,score:f}});return d.sort((h,f)=>f.score-h.score),{type:"flipCard",cardId:d[0].effect.cardId}}default:{if("optional"in n&&n.optional)return{type:"skip"};const c=[...a.player.lanes.flat(),...a.opponent.lanes.flat()];return c.length>0&&(n.type.includes("select_")||n.type.includes("shift"))?{type:"deleteCard",cardId:c[0].id}:{type:"skip"}}}},Hh=(a,n)=>n?R0(a,n):a.phase==="compile"&&a.compilableLanes.length>0?{type:"compile",laneIndex:a.compilableLanes.reduce((i,c)=>a.opponent.laneValues[c]>a.opponent.laneValues[i]?c:i)}:a.phase==="action"?N0(a):{type:"fillHand"};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const vt=(a,n)=>a.phase==="start"?n.continueTurnAfterStartPhaseAction(a):n.processEndOfAction(a),pm=(a,n,l,i,c,d,p,h)=>{const{cardId:f,laneIndex:m,isFaceUp:g}=n,{newState:y,animationRequests:w}=c.playCard({...a,actionRequired:null},f,m,g,"opponent"),_={...y,animationState:{type:"playCard",cardId:f,owner:"opponent"}};return setTimeout(()=>{l(S=>{let k={...S,animationState:null};return w&&w.length>0?(d(w,()=>l(j=>{const E={...j,animationState:null};return h&&E.actionRequired?(yn(E,l,i,c,d,p),E):E.actionRequired&&E.actionRequired.actor==="opponent"?E:{...vt(E,p),animationState:null}})),k):h&&k.actionRequired?(yn(k,l,i,c,d,p),k):k.actionRequired&&k.actionRequired.actor==="opponent"?k:vt(k,p)})},500),_},mi=(a,n,l)=>{switch(l){case"normal":return Hh(a,n);case"hard":return console.warn("[AI] Hard AI temporarily disabled, using Normal AI"),Hh(a,n);default:return k0(a,n)}},A0=(a,n,l,i,c,d,p,h,f)=>{n(m=>{const g=m.actionRequired;if(!g||!((m.turn==="player"||m._interruptedTurn==="player")&&"actor"in g&&g.actor==="opponent"))return m;if(g.type==="discard_completed"){const{followUpEffect:k,conditionalType:j,previousHandSize:E,sourceCardId:C,actor:b}=g;if(k&&C){const T=ve(m,C);if(T){const A=m[b].hand.length,H=Math.max(0,(E||0)-A);if(j==="then"||j==="if_executed"&&H>0){let B=-1;for(let X=0;X<m[T.owner].lanes.length;X++)if(m[T.owner].lanes[X].some(I=>I.id===C)){B=X;break}if(B!==-1){const X={cardOwner:T.owner,opponent:T.owner==="player"?"opponent":"player",currentTurn:m.turn,actor:b,discardedCount:H},{executeCustomEffect:I}=require("../customProtocols/effectInterpreter");return I(T.card,B,{...m,actionRequired:null},X,k).newState}}}}return{...m,actionRequired:null}}const _=mi(m,g,l);if(_.type==="discardCards"&&g.type==="discard"){const j=g.variableCount===!0?_.cardIds.length:g.count,E=_.cardIds.slice(0,j);E.length!==_.cardIds.length&&console.warn(`[AI Manager] Fixed discard count: AI wanted ${_.cardIds.length} but action.count=${g.count}`);const C=i.discardCards(m,E,"opponent");return C.actionRequired?C:vt(C,c)}if(_.type==="rearrangeProtocols"&&g.type==="prompt_rearrange_protocols"){f&&g.sourceCardId==="CONTROL_MECHANIC"&&g.actor&&f(g.actor);const k=i.resolveRearrangeProtocols(m,_.newOrder);return vt(k,c)}if(g.type==="reveal_opponent_hand"){const k=i.revealOpponentHand(m);return vt(k,c)}if(_.type==="resolveOptionalEffectPrompt"&&g.type==="prompt_optional_effect"){const k=Td(m,_.accept);return k.actionRequired?k:vt(k,c)}if(_.type==="resolveCustomChoice"&&g.type==="custom_choice"){const k=qd(m,_.optionIndex);return k.actionRequired?k:vt(k,c)}if(_.type==="selectLane"){const{nextState:k,requiresAnimation:j}=h(m,_.laneIndex);if(j){const E=m.phase==="start";return d(j.animationRequests,()=>{n(C=>{const b={...C,animationState:null},T=j.onCompleteCallback(b,H=>H);return T.actionRequired&&T.actionRequired.actor==="opponent"?{...T,animationState:null}:{...E?c.continueTurnAfterStartPhaseAction(T):c.processEndOfAction(T),animationState:null}})}),k}return vt(k,c)}if(_.type==="deleteCard"||_.type==="flipCard"||_.type==="returnCard"||_.type==="shiftCard"){const{nextState:k,requiresAnimation:j}=p(m,_.cardId);if(j){const E=m.phase==="start";return d(j.animationRequests,()=>{n(C=>{const b={...C,animationState:null},T=j.onCompleteCallback(b,H=>H);return T.actionRequired&&T.actionRequired.actor==="opponent"?{...T,animationState:null}:{...E?c.continueTurnAfterStartPhaseAction(T):c.processEndOfAction(T),animationState:null}})}),k}return k.actionRequired&&k.actionRequired.actor==="opponent"?k:vt(k,c)}if(_.type==="playCard"&&g.type==="select_card_from_hand_to_play")return pm(m,_,n,l,i,d,c,!1);console.warn(`AI has no logic for mandatory action during player turn, clearing it: ${g.type}, aiDecision: ${JSON.stringify(_)}`);const S={...m,actionRequired:null};return vt(S,c)})},D0=(a,n,l,i,c,d,p)=>{const h=a.actionRequired;if(h.type==="discard_completed"){const{followUpEffect:g,conditionalType:y,previousHandSize:w,sourceCardId:_,actor:S}=h;if(g&&_){const k=ve(a,_);if(k){const j=a[S].hand.length,E=Math.max(0,(w||0)-j);if(y==="then"||y==="if_executed"&&E>0){let b=-1;for(let T=0;T<a[k.owner].lanes.length;T++)if(a[k.owner].lanes[T].some(A=>A.id===_)){b=T;break}if(b!==-1){const T={cardOwner:k.owner,opponent:k.owner==="player"?"opponent":"player",currentTurn:a.turn,actor:S,discardedCount:E},{executeCustomEffect:A}=require("../customProtocols/effectInterpreter");return A(k.card,b,{...a,actionRequired:null},T,g).newState}}}}return{...a,actionRequired:null}}const f=mi(a,a.actionRequired,l);if(f.type==="skip"){const g=i.skipAction(a),y=a.phase==="start"?d.continueTurnAfterStartPhaseAction(g):d.processEndOfAction(g);return!y.actionRequired&&y.turn==="opponent"&&!y.winner&&setTimeout(()=>{yn(y,n,l,i,c,d,p)},500),y}if(f.type==="resolveControlMechanicPrompt"&&h.type==="prompt_use_control_mechanic"){const{choice:g}=f,{originalAction:y,actor:w}=h;if(g==="skip"){let _=ae(a,w,"Opponent skips rearranging protocols.");if(_.actionRequired=null,_={..._,_logIndentLevel:0},y.type==="compile"){const S=y.laneIndex;return setTimeout(()=>{n(k=>{const j=i.compileLane(k,S);return j.winner?j:{...d.processEndOfAction(j),animationState:null}})},1e3),{..._,animationState:{type:"compile",laneIndex:S},compilableLanes:[]}}else if(y.type==="fill_hand"){const S=i.fillHand(_,w);return d.processEndOfAction(S)}else return d.processEndOfAction(_)}else{const _=g;let j=ae(a,w,`Opponent chooses to rearrange ${_==="opponent"?"the player's":"their own"} protocols.`);return j.actionRequired={type:"prompt_rearrange_protocols",sourceCardId:"CONTROL_MECHANIC",target:_,actor:w,originalAction:y},j}}if(f.type==="resolveOptionalDiscardCustomPrompt"&&h.type==="prompt_optional_discard_custom"){const g=i.resolveOptionalDiscardCustomPrompt(a,f.accept);return g.actionRequired?g:vt(g,d)}if(f.type==="resolveOptionalEffectPrompt"){const g=i.resolveOptionalEffectPrompt(a,f.accept);return g.actionRequired?g:vt(g,d)}if(f.type==="resolvePrompt"&&h.type==="prompt_optional_shuffle_trash"){if(!f.accept){let y={...a};return y.actionRequired=null,y=ae(y,h.actor,`${h.actor==="player"?"Player":"Opponent"} skips shuffling trash into deck.`),vt(y,d)}const g=em(a,h.actor,"Clarity-4");return vt(g.newState,d)}if(f.type==="resolveSwapProtocols"&&h.type==="prompt_swap_protocols"){const g=i.resolveSwapProtocols(a,f.indices);return vt(g,d)}if(f.type==="resolveCustomChoice"&&h.type==="custom_choice"){const g=i.resolveCustomChoice(a,f.optionIndex);return g.actionRequired?g:vt(g,d)}if(f.type==="resolveRevealBoardCardPrompt"&&(h.type==="prompt_shift_or_flip_revealed_card"||h.type==="prompt_shift_or_flip_board_card_custom")){const g=Fd(a,f.choice);return g.actionRequired?g:vt(g,d)}if(f.type==="rearrangeProtocols"&&h.type==="prompt_rearrange_protocols"){p&&h.sourceCardId==="CONTROL_MECHANIC"&&h.actor&&p(h.actor);const g=i.resolveRearrangeProtocols(a,f.newOrder);return vt(g,d)}if(f.type==="selectLane"){const{nextState:g,requiresAnimation:y}=Dd(a,f.laneIndex);if(y){const{animationRequests:w,onCompleteCallback:_}=y;return c(w,()=>{n(S=>{const k={...S,animationState:null};return _(k,j=>{const E={...j,animationState:null},b={...a.phase==="start"?d.continueTurnAfterStartPhaseAction(E):d.processEndOfAction(E),animationState:null};return!b.actionRequired&&b.turn==="opponent"&&!b.winner?setTimeout(()=>{yn(b,n,l,i,c,d,p)},500):b.actionRequired&&b.turn==="opponent"&&setTimeout(()=>{yn(b,n,l,i,c,d,p)},300),b})})}),g}return vt(g,d)}if(f.type==="flipCard"||f.type==="deleteCard"||f.type==="returnCard"||f.type==="shiftCard"){const{nextState:g,requiresAnimation:y,requiresTurnEnd:w}=Ad(a,f.cardId);if(y){const{animationRequests:_,onCompleteCallback:S}=y;return c(_,()=>{n(k=>{const j={...k,animationState:null};return S(j,E=>{const C={...E,animationState:null};if(C.queuedActions&&C.queuedActions.length>0){const b=d.processEndOfAction(C);return b.actionRequired?(yn(b,n,l,i,c,d),{...b,animationState:null}):{...b,animationState:null}}if(C.actionRequired)return yn(C,n,l,i,c,d),C;if(C.phase==="start"){const T={...d.continueTurnAfterStartPhaseAction(C),animationState:null};return!T.actionRequired&&T.turn==="opponent"&&!T.winner&&setTimeout(()=>{yn(T,n,l,i,c,d,p)},500),T}else return{...d.processEndOfAction(C),animationState:null}})})}),g}return w||g.queuedActions&&g.queuedActions.length>0?vt(g,d):g}if(f.type==="playCard"&&h.type==="select_card_from_hand_to_play")return pm(a,f,n,l,i,c,d,!0);if(f.type==="discardCards"&&h.type==="discard"){const y=h.variableCount===!0?f.cardIds.length:h.count,w=f.cardIds.slice(0,y);w.length!==f.cardIds.length&&console.warn(`[AI Manager] Fixed discard count: AI wanted ${f.cardIds.length} but action.count=${h.count}`);const _=i.discardCards(a,w,"opponent");return _.actionRequired?_:vt(_,d)}if(f.type==="giveCard"&&h.type==="select_card_from_hand_to_give"){const g=i.resolveActionWithHandCard(a,f.cardId);return g.actionRequired?g:vt(g,d)}if(f.type==="revealCard"&&h.type==="select_card_from_hand_to_reveal")return i.resolveActionWithHandCard(a,f.cardId);if(f.type==="selectRevealedDeckCard"&&h.type==="select_card_from_revealed_deck"){const g=lm(a,f.cardId);return vt(g,d)}console.warn(`AI has no logic for mandatory action, clearing it: ${h.type}`);const m={...a,actionRequired:null};return vt(m,d)},yn=(a,n,l,i,c,d,p)=>{n(h=>{if(h.turn!=="opponent"||h.winner||h.animationState||!["start","compile","action","hand_limit","end"].includes(h.phase))return h;if(h.actionRequired){const g=h.actionRequired;let y=!1;if((g.type==="discard"&&g.actor==="player"||g.type==="plague_4_opponent_delete"&&g.actor==="opponent"||"actor"in g&&g.actor==="player")&&(y=!0),y)return h}let m={...h};if(m.actionRequired&&m.actionRequired.type==="reveal_opponent_hand"){const g=i.revealOpponentHand(m);return d.processEndOfAction(g)}if(m.phase==="start"&&(m=d.processStartOfTurn(m)),m.actionRequired){const g=D0(m,n,l,i,c,d,p);return!g.actionRequired&&g.turn==="opponent"&&!g.winner&&g.phase!=="hand_limit"&&setTimeout(()=>{yn(g,n,l,i,c,d,p)},300),g}if(m.phase==="compile"&&m.compilableLanes.length>0){const g=mi(m,null,l);if(g.type==="compile"){const y=g.laneIndex,w=rm(m);return w.actionRequired?w:(setTimeout(()=>{n(_=>{const S=i.compileLane(_,y);return S.winner?S:{...d.processEndOfAction(S),animationState:null}})},1e3),{...w,animationState:{type:"compile",laneIndex:y},compilableLanes:[]})}}if(m.phase==="action"){const g=mi(m,null,l);if(g.type==="fillHand"){const y=om(m,"opponent");return y.actionRequired?y:d.processEndOfAction(y)}if(g.type==="playCard"){const{newState:y,animationRequests:w}=i.playCard(m,g.cardId,g.laneIndex,g.isFaceUp,"opponent"),_={...y,animationState:{type:"playCard",cardId:g.cardId,owner:"opponent"}};return setTimeout(()=>{const S=()=>{n(k=>{let j={...k},E={newState:j};if(!j.actionRequired){if(j.queuedEffect){const{card:A,laneIndex:H}=j.queuedEffect,$={cardOwner:"opponent",actor:"opponent",currentTurn:j.turn,opponent:"player",triggerType:"play"};E=Zl(A,H,j,$),E.newState.queuedEffect=void 0}}const C=E.animationRequests,b=E.newState,T=()=>{n(A=>{if(A.queuedActions&&A.queuedActions.length>0){const H=d.processEndOfAction(A);return H.actionRequired&&yn(H,n,l,i,c,d),H}return A.actionRequired?yn(A,n,l,i,c,d):n(d.processEndOfAction(A)),A})};if(C&&C.length>0)return c(C,T),b;if(b.queuedActions&&b.queuedActions.length>0){const A=d.processEndOfAction(b);return A.actionRequired&&yn(A,n,l,i,c,d),A}return b.actionRequired?yn(b,n,l,i,c,d):n(d.processEndOfAction(b)),b})};n(k=>{const j={...k,animationState:null};return w&&w.length>0?c(w,S):S(),j})},500),_}}return m.phase==="end"||m.phase==="hand_limit"?d.continueTurnProgression(m):d.processEndOfAction(m)})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function T0(a,n){let l=null,i=null;const c=["player","opponent"];for(const g of c){for(const y of a[g].lanes){const w=y.find(_=>_.id===n);if(w){l=g,i=w;break}}if(l)break}if(!l||!i)return console.error("Card to delete not found on board:",n),a;const d={...a},p={...d[l]};p.lanes=p.lanes.map(g=>g.filter(y=>y.id!==n));const{id:h,isFaceUp:f,...m}=i;return p.discard=[...p.discard,m],d[l]=p,d}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const F0=(a,n,l,i,c,d="player",p)=>{const[h,f]=re.useState(()=>{const K=Hl(a,n,c,d);return xe(K)}),[m,g]=re.useState(null),y=re.useRef(!1),w=re.useRef(0);re.useEffect(()=>{h.turn!==d&&h.log.length<=4&&f(K=>{const W=d==="player"?"Player":"Opponent",U=[...K.log];return U.length>0&&(U[U.length-1]={player:"player",message:`${W} goes first.`}),{...K,turn:d,log:U}})},[d,h.turn,h.log.length]);const _=re.useCallback(K=>{switch(K){case"start":return Zh;case"end":return Pr;default:return Hr}},[]),S=re.useCallback((K,W)=>{const U=Q=>{if(Q.length===0){W();return}const[Y,...ce]=Q;Y.type==="delete"?(f(te=>({...te,animationState:{type:"deleteCard",cardId:Y.cardId,owner:Y.owner}})),setTimeout(()=>{f(te=>{if(!(te.player.lanes.flat().some(ge=>ge.id===Y.cardId)||te.opponent.lanes.flat().some(ge=>ge.id===Y.cardId)))return{...te,animationState:null};let Se=T0(te,Y.cardId);return Se=xe(Se),{...Se,animationState:null}}),setTimeout(()=>{ce.length>0?U(ce):W()},10)},500)):Y.type==="return"?(f(te=>({...te,animationState:{type:"returnCard",cardId:Y.cardId,owner:Y.owner}})),setTimeout(()=>{f(te=>{const ye=te[Y.owner].lanes.findIndex(Xe=>Xe.some(nt=>nt.id===Y.cardId)),Se=ye!==-1&&te[Y.owner].lanes[ye].length>0&&te[Y.owner].lanes[ye][te[Y.owner].lanes[ye].length-1].id===Y.cardId,ge=te[Y.owner].lanes.flat().find(Xe=>Xe.id===Y.cardId);if(!ge)return{...te,animationState:null};const Fe=te[Y.owner].lanes.map(Xe=>Xe.filter(nt=>nt.id!==Y.cardId));let Le={...te,[Y.owner]:{...te[Y.owner],lanes:Fe,hand:[...te[Y.owner].hand,ge]}};return Le=xe(Le),Se&&ye!==-1&&Le[Y.owner].lanes[ye].length>0&&(Le=Rn(Le,Y.owner,ye).newState),{...Le,animationState:null}}),setTimeout(()=>{ce.length>0?U(ce):W()},10)},500)):Y.type==="play"?(f(te=>({...te,animationState:{type:"playCard",cardId:Y.cardId,owner:Y.owner}})),setTimeout(()=>{f(te=>({...te,animationState:null})),setTimeout(()=>{ce.length>0?U(ce):W()},10)},500)):Y.type==="draw"?(f(te=>({...te,animationState:{type:"draw",player:Y.player,count:Y.count}})),setTimeout(()=>{f(te=>({...te,animationState:null})),setTimeout(()=>{ce.length>0?U(ce):W()},10)},500)):setTimeout(()=>{ce.length>0?U(ce):W()},10)};U(K)},[]),k=(K,W,U="player")=>{if(!m||h.turn!=="player"||h.phase!=="action")return;const Q=m;g(null),f(Y=>{const ce=_(Y.phase),{newState:te,animationRequests:ye}=pi(Y,Q,K,W,"player",U),Se={...te,animationState:{type:"playCard",cardId:Q,owner:"player"}};return setTimeout(()=>{f(ge=>{let Fe={...ge,animationState:null};return ye&&ye.length>0?(S(ye,()=>{f(Le=>ce(Le))}),Fe):Fe.actionRequired?Fe:ce(Fe)})},500),Se})},j=()=>{h.turn!=="player"||h.phase!=="action"||h.actionRequired||f(K=>{const W=_(K.phase),U=om(K,"player");return U.actionRequired?U:W(U)})},E=re.useCallback(K=>{f(W=>{var U;return((U=W.actionRequired)==null?void 0:U.type)!=="discard"||W.actionRequired.actor!=="player"?W:{...W,animationState:{type:"discardCard",owner:"player",cardIds:[K],originalAction:W.actionRequired}}})},[]),C=re.useCallback(K=>{f(W=>{if(W.winner||W.phase!=="compile")return W;const U=_(W.phase),Y={...rm(W),animationState:{type:"compile",laneIndex:K},compilableLanes:[]};return setTimeout(()=>{f(ce=>{var ge;const te=Gl(ce,K,l);if(te.winner)return te;if(((ge=te.actionRequired)==null?void 0:ge.type)==="prompt_use_control_mechanic")return{...te,animationState:null};const ye=te._compileAnimations;if(ye&&ye.length>0){S(ye,()=>{f(Le=>{const Xe={...Le};return delete Xe._compileAnimations,{...U(Xe),animationState:null}})});const Fe={...te};return delete Fe._compileAnimations,Fe}return{...U(te),animationState:null}})},1e3),Y})},[l,_]),b=K=>{f(W=>{const U=W.turn,Q=_(W.phase),{nextState:Y,requiresAnimation:ce,requiresTurnEnd:te}=Ad(W,K);return ce?(S(ce.animationRequests,()=>{f(ye=>{const Se=ye.turn!==U?ge=>ge:Q;return ce.onCompleteCallback(ye,Se)})}),Y):Y.actionRequired?Y:Q(Y)})},T=K=>{f(W=>{const U=_(W.phase),{nextState:Q,requiresAnimation:Y}=Dd(W,K);return Y?(S(Y.animationRequests,()=>{f(ce=>Y.onCompleteCallback(ce,U))}),Q):Q.actionRequired?Q:U(Q)})},A=K=>{f(W=>{const U=_(W.phase),Q=jd(W,K);return Q.actionRequired?Q:U(Q)})},H=K=>{f(W=>w0(W,K))},$=()=>{f(K=>{var Q,Y;const W=_(K.phase);let U={...K,animationState:null};return((Q=U.actionRequired)==null?void 0:Q.type)==="prompt_shift_or_flip_board_card_custom"?U=Fd(U,"skip"):U=Th(U),((Y=U.actionRequired)==null?void 0:Y.type)==="plague_4_player_flip_optional"?U:W(U)})},B=re.useCallback(K=>{f(W=>{var Y;if(((Y=W.actionRequired)==null?void 0:Y.type)!=="prompt_use_control_mechanic")return W;const{originalAction:U,actor:Q}=W.actionRequired;if(K==="skip"){let ce=ae(W,Q,"Player skips rearranging protocols.");if(ce.actionRequired=null,ce={...ce,_logIndentLevel:0},U.type==="compile"){const ye={...ce,animationState:{type:"compile",laneIndex:U.laneIndex},compilableLanes:[]};return setTimeout(()=>{f(Se=>{const ge=Gl(Se,U.laneIndex,l);return ge.winner?ge:{..._(ge.phase)(ge),animationState:null}})},1e3),ye}else if(U.type==="continue_turn"){let te={...ce};return U.queuedSpeed2Actions&&U.queuedSpeed2Actions.length>0&&(te.queuedActions=[...U.queuedSpeed2Actions,...te.queuedActions||[]]),_(te.phase)(te)}else if(U.type==="resume_interrupted_turn"){let te={...ce};return te._interruptedTurn=U.interruptedTurn,te._interruptedPhase=U.interruptedPhase,U.queuedSpeed2Actions&&U.queuedSpeed2Actions.length>0&&(te.queuedActions=[...U.queuedSpeed2Actions,...te.queuedActions||[]]),Hr(te)}else{const te=Xl(ce,Q);return _(te.phase)(te)}}else{const ce=K;let Se=ae(W,Q,`${Q==="player"?"Player":"Opponent"} chooses to rearrange ${ce==="player"?"their own":"the opponent's"} protocols.`);return Se.actionRequired={type:"prompt_rearrange_protocols",sourceCardId:"CONTROL_MECHANIC",target:ce,actor:Q,originalAction:U},Se}})},[l,_]),X=re.useCallback(K=>{f(W=>{const U=_(W.phase),Q=Uh(W,K);return Q.actionRequired?Q:U(Q)})},[_]),I=re.useCallback(K=>{f(W=>{var U;return((U=W.actionRequired)==null?void 0:U.type)!=="plague_2_player_discard"?W:{...W,animationState:{type:"discardCard",owner:"player",cardIds:K,originalAction:W.actionRequired}}})},[]),F=re.useCallback(K=>{f(W=>{const U=_(W.phase),Q=Oh(W,K,"player");return U(Q)})},[_]),N=re.useCallback(K=>{f(W=>{const U=_(W.phase),Q=Ih(W,K);return K?Q:U(Q)})},[_]),D=re.useCallback(K=>{f(W=>{const U=_(W.phase),Q=Td(W,K);return Q.actionRequired?Q:U(Q)})},[_]),P=re.useCallback(K=>{f(W=>{var Y,ce,te;const U=((Y=W.actionRequired)==null?void 0:Y.type)==="select_cards_from_hand_to_discard_for_fire_4",Q=((ce=W.actionRequired)==null?void 0:ce.type)==="discard"&&((te=W.actionRequired)==null?void 0:te.variableCount);return!U&&!Q?W:{...W,animationState:{type:"discardCard",owner:"player",cardIds:K,originalAction:W.actionRequired}}})},[]),L=re.useCallback(K=>{f(W=>{var U;return((U=W.actionRequired)==null?void 0:U.type)!=="select_cards_from_hand_to_discard_for_hate_1"?W:{...W,animationState:{type:"discardCard",owner:"player",cardIds:K,originalAction:W.actionRequired}}})},[]),R=re.useCallback(K=>{f(W=>{const U=_(W.phase),Q=Fd(W,K);return Q.actionRequired?Q:U(Q)})},[_]),O=re.useCallback(K=>{f(W=>{var Y,ce;p&&((Y=W.actionRequired)==null?void 0:Y.sourceCardId)==="CONTROL_MECHANIC"&&((ce=W.actionRequired)!=null&&ce.actor)&&p(W.actionRequired.actor);const U=_(W.phase),Q=Sd(W,K,l);return Q.winner?Q:U(Q)})},[_,l,p]),Z=re.useCallback(K=>{f(W=>{const U=_(W.phase),Q=qd(W,K);return Q.actionRequired?Q:U(Q)})},[_]),ee=re.useCallback(K=>{f(W=>{const U=_(W.phase),Q=Ph(W,K,l);return Q.winner?Q:U(Q)})},[_,l]),M=re.useCallback(K=>{f(W=>{const U=_(W.phase),Q=lm(W,K);return Q.winner?Q:U(Q)})},[_]),G=re.useCallback(K=>{y.current=!1,w.current++,f(W=>{if(typeof K=="function")return K(W);const U=K;if(U==="speed-0-interrupt"){const Q=["Speed","Life","Water"],Y=["Metal","Death","Hate"];let ce=kn(Ia(Q)),te=kn(Ia(Y));const ye=(Ce,Ie,He)=>{const gt=Ce.findIndex(Ye=>Ye.protocol===Ie&&Ye.value===He);return gt>-1?Ce.splice(gt,1)[0]:Nn.find(Ye=>Ye.protocol===Ie&&Ye.value===He)},Se=ye(ce,"Speed",0),ge=ye(te,"Metal",0),Fe=ye(ce,"Speed",1),Le=ye(ce,"Life",1),Xe=ye(ce,"Water",1),nt=ye(ce,"Speed",3);let we=Hl(Q,Y,c,d);return we.player.lanes=[[],[],[]],we.player.lanes[0]=[{...Se,id:Qe(),isFaceUp:!1}],we.player.hand=[{...Fe,id:Qe(),isFaceUp:!0},{...Le,id:Qe(),isFaceUp:!0},{...Xe,id:Qe(),isFaceUp:!0},{...nt,id:Qe(),isFaceUp:!0}],we.player.deck=ce,we.player.discard=[],we.opponent.lanes=[[],[],[]],we.opponent.hand=[{...ge,id:Qe(),isFaceUp:!0}],we.opponent.deck=te,we.opponent.discard=[],we.turn="opponent",we.phase="start",we.actionRequired=null,we.queuedActions=[],we=xe(we),we=ae(we,"player","DEBUG: Dynamic Speed-0 interrupt scenario set up. AI will play Metal-0."),we}else if(U==="speed-1-trigger"){const Q=["Speed","Life","Water"],Y=["Metal","Death","Hate"];let ce=kn(Ia(Q));const te=kn(Ia(Y)),Se=((Xe,nt,we)=>{const Ce=Xe.findIndex(Ie=>Ie.protocol===nt&&Ie.value===we);return Ce>-1?Xe.splice(Ce,1)[0]:Nn.find(Ie=>Ie.protocol===nt&&Ie.value===we)})(ce,"Speed",1);let ge=Hl(Q,Y,c,d);ge.player.lanes=[[],[],[]],ge.player.lanes[0]=[{...Se,id:Qe(),isFaceUp:!0}];const{drawnCards:Fe,remainingDeck:Le}=Mn(ce,[],6);return ge.player.hand=Fe.map(Xe=>({...Xe,id:Qe(),isFaceUp:!0})),ge.player.deck=Le,ge.player.discard=[],ge.opponent.lanes=[[],[],[]],ge.opponent.hand=[],ge.opponent.deck=te,ge.opponent.discard=[],ge.turn="player",ge.phase="hand_limit",ge.actionRequired={type:"discard",actor:"player",count:1},ge.queuedActions=[],ge=xe(ge),ge=ae(ge,"player","DEBUG: Speed-1 discard trigger scenario set up."),ge}else if(U==="fire-oncover-test"){const Q=["Death","Hate","Water"],Y=["Fire","Plague","Metal"],ce=kn(Ia(Q));let te=kn(Ia(Y));const ye=(Ce,Ie,He)=>{const gt=Ce.findIndex(Ye=>Ye.protocol===Ie&&Ye.value===He);return gt>-1?Ce.splice(gt,1)[0]:Nn.find(Ye=>Ye.protocol===Ie&&Ye.value===He)},Se=ye(te,"Fire",0),ge=ye(te,"Fire",2),Fe=ye(te,"Fire",3),Le=Nn.find(Ce=>Ce.protocol==="Death"&&Ce.value===1),Xe=Nn.find(Ce=>Ce.protocol==="Hate"&&Ce.value===2),nt=Nn.find(Ce=>Ce.protocol==="Water"&&Ce.value===3);let we=Hl(Q,Y,c,"opponent");return we.player.lanes=[[{...Le,id:Qe(),isFaceUp:!0}],[{...Xe,id:Qe(),isFaceUp:!0}],[{...nt,id:Qe(),isFaceUp:!0}]],we.player.hand=[],we.player.deck=ce,we.player.discard=[],we.opponent.lanes=[[{...Se,id:Qe(),isFaceUp:!0}],[],[]],we.opponent.hand=[{...Fe,id:Qe(),isFaceUp:!0},{...ge,id:Qe(),isFaceUp:!0}],we.opponent.deck=te,we.opponent.discard=[],we.turn="opponent",we.phase="action",we.actionRequired=null,we.queuedActions=[],we=xe(we),we=ae(we,"opponent","DEBUG: Fire On-Cover test scenario. Opponent has Fire-0 in play, Fire-3 and Fire-2 in hand. Ready to play Fire-3."),we}else if(U==="speed-2-control-test"){const Q=["Speed","Light","Water"],Y=["Fire","Plague","Metal"],ce=kn(Ia(Q)),te=kn(Ia(Y)),Se=((Fe,Le,Xe)=>{const nt=Fe.findIndex(we=>we.protocol===Le&&we.value===Xe);return nt>-1?Fe.splice(nt,1)[0]:Nn.find(we=>we.protocol===Le&&we.value===Xe)})(ce,"Speed",2);let ge=Hl(Q,Y,!0,"player");return ge.player.lanes=[[{...Se,id:Qe(),isFaceUp:!0}],[],[]],ge.player.protocols[0]="Speed",ge.player.laneValues[0]=10,ge.player.hand=[],ge.player.deck=ce,ge.player.discard=[],ge.controlCardHolder="player",ge.opponent.lanes=[[],[],[]],ge.opponent.hand=[],ge.opponent.deck=te,ge.opponent.discard=[],ge.turn="player",ge.phase="compile",ge.compilableLanes=[0],ge.actionRequired=null,ge.queuedActions=[],ge=xe(ge),ge=ae(ge,"player","DEBUG: Speed-2 + Control test scenario. Player has Speed-2 (value 10), Control Component active. Ready to compile Protocol Speed!"),ge}return W})},[c]);return re.useEffect(()=>{const K=h.animationState;if(!K)return;let W=0,U=!1;if(K.type==="flipCard"?(W=600,U=!0):K.type==="drawCard"?(W=1e3,U=!0):K.type==="discardCard"&&(W=800,U=!0),U){const Q=setTimeout(()=>{f(Y=>({...Y,animationState:null}))},W);return()=>clearTimeout(Q)}},[h.animationState]),re.useEffect(()=>{const K=h.animationState;if((K==null?void 0:K.type)==="discardCard"&&K.owner==="player"){const W=setTimeout(()=>{f(U=>{const Q=U.animationState;if((Q==null?void 0:Q.type)!=="discardCard"||!Q.originalAction)return U;const{cardIds:Y,originalAction:ce}=Q,te=_(U.phase);let ye;return ce.type==="plague_2_player_discard"?ye=x0(U,Y):ce.type==="select_cards_from_hand_to_discard_for_fire_4"?ye=Dh(U,Y):ce.type==="select_cards_from_hand_to_discard_for_hate_1"?ye=bd(U,Y):ye=Go(U,Y,"player"),ye.animationState=null,ye.actionRequired?ye:te(ye)})},500);return()=>clearTimeout(W)}},[h.animationState,_]),re.useEffect(()=>{if(h.turn==="opponent"&&!h.winner&&!h.animationState&&!h._interruptedTurn&&!y.current){y.current=!0;const K=w.current,W=h,U=setTimeout(()=>{w.current===K&&yn(W,f,i,{compileLane:(Q,Y)=>Gl(Q,Y,l),playCard:pi,fillHand:Xl,discardCards:Go,flipCard:qh,deleteCard:(Q,Y)=>({newState:Q,animationRequests:[{type:"delete",cardId:Y,owner:"opponent"}]}),returnCard:$h,skipAction:Th,resolveOptionalDrawPrompt:Uh,resolvePlague4Flip:(Q,Y)=>Oh(Q,Y,"opponent"),resolvePlague2Discard:Cd,resolvePlague2OpponentDiscard:Cd,resolveOptionalDiscardCustomPrompt:Ih,resolveOptionalEffectPrompt:Td,resolveFire4Discard:Dh,resolveHate1Discard:bd,resolveRearrangeProtocols:(Q,Y)=>Sd(Q,Y,l),resolveActionWithHandCard:jd,resolveSwapProtocols:(Q,Y)=>Ph(Q,Y,l),revealOpponentHand:Fh,resolveCustomChoice:qd},S,Eh,p)},1500);return()=>{clearTimeout(U),y.current=!1}}},[h.turn,h.phase,h.winner,h.animationState,h._interruptedTurn,i,l,S,h.actionRequired]),re.useEffect(()=>{const K=h.actionRequired,W=h.turn==="player"||h._interruptedTurn==="player",U=K&&"actor"in K&&K.actor==="opponent";W&&!h.animationState&&U&&!y.current&&(y.current=!0,A0(h,f,i,{playCard:pi,discardCards:Go,flipCard:qh,returnCard:$h,deleteCard:(Y,ce)=>({newState:Y,animationRequests:[{type:"delete",cardId:ce,owner:"opponent"}]}),resolveActionWithHandCard:jd,resolveHate1Discard:bd,resolvePlague2OpponentDiscard:Cd,revealOpponentHand:Fh,resolveRearrangeProtocols:(Y,ce)=>Sd(Y,ce,l)},Eh,S,Ad,Dd,p),y.current=!1)},[h.actionRequired,h.turn,h.animationState,i,S,l]),re.useEffect(()=>{f(K=>{let W=xe(K);return W.turn==="player"&&W.phase==="start"&&!W.actionRequired?Kh(W):W})},[h.turn,h.phase]),{gameState:h,selectedCard:m,setSelectedCard:g,playSelectedCard:k,fillHand:j,discardCardFromHand:E,compileLane:C,resolveActionWithCard:b,resolveActionWithLane:T,selectHandCardForAction:H,skipAction:$,resolvePlague2Discard:I,resolveActionWithHandCard:A,resolvePlague4Flip:F,resolveOptionalDiscardCustomPrompt:N,resolveOptionalEffectPrompt:D,resolveFire4Discard:P,resolveHate1Discard:L,resolveRevealBoardCardPrompt:R,resolveRearrangeProtocols:O,resolveOptionalDrawPrompt:X,resolveSwapProtocols:ee,resolveControlMechanicPrompt:B,resolveCustomChoice:Z,resolveSelectRevealedDeckCard:M,setupTestScenario:G}},zh=({cards:a,isPlayable:n,isCompilable:l,isShiftTarget:i,isEffectTarget:c,isMatching:d,onLanePointerDown:p,onPlayFaceDown:h,onCardPointerDown:f,onCardPointerEnter:m,onCardPointerLeave:g,owner:y,animationState:w,isCardTargetable:_,laneIndex:S,sourceCardId:k,gameState:j})=>{const E=["lane"];return n&&E.push("playable"),d&&E.push("matching-protocol"),l&&E.push("compilable"),i&&E.push("shift-target"),c&&E.push("effect-target"),o.jsxs("div",{className:E.join(" "),onPointerDown:p,children:[n&&d&&y==="player"&&h&&o.jsx("button",{className:"btn btn-play-facedown",onPointerDown:C=>{C.stopPropagation(),h()},children:"Play Face-Down"}),o.jsx("div",{className:"lane-stack",children:a.map((C,b)=>{var H;const T=((H=j.actionRequired)==null?void 0:H.type)==="prompt_shift_or_flip_for_light_2"&&j.actionRequired.revealedCardId===C.id,A=ea(C,a,j,S,y);return o.jsx(Ct,{card:C,isFaceUp:C.isFaceUp||T,style:{"--i":b},onPointerDown:$=>{$.stopPropagation(),f(C)},onPointerEnter:()=>m(C),animationState:w,isTargetable:_(C),isSourceOfEffect:C.id===k,faceDownValue:A},C.id)})})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const mo=(a,n)=>xo(a,n),Ln=(a,n)=>gn(a).some(({rule:i,laneIndex:c})=>i.type==="block_shifts_from_and_to_lane"&&c===n),yi=(a,n)=>{const{actionRequired:l}=n;if(!l||"actor"in l&&l.actor!=="player")return!1;let i=null,c=-1,d=[];for(const f of["player","opponent"]){for(let m=0;m<n[f].lanes.length;m++)if(n[f].lanes[m].some(g=>g.id===a.id)){i=f,c=m,d=n[f].lanes[m];break}if(i)break}if(!i)return!1;const p=d.findIndex(f=>f.id===a.id),h=wo(n,d,p);if(l.type==="select_lane_for_shift"){const f=l.cardToShiftId;return!!(f&&a.id===f)}if(l.type==="shift_flipped_card_optional"){const f=l.cardId;return!!(f&&a.id===f)}switch(l.type){case"select_opponent_face_up_card_to_flip":return i==="opponent"&&a.isFaceUp&&h;case"select_card_to_flip":{if(mo(n,a.id))return!1;const f=l.targetFilter||{},m=d.findIndex(k=>k.id===a.id),g=l.currentLaneIndex,y=l.laneIndex,w=l.scope;if(g!==void 0&&c!==g||w==="this_lane"&&y!==void 0&&c!==y)return!1;const _=f.position||"uncovered";return!(_==="uncovered"&&!h||_==="covered"&&m>=d.length-1||f.owner==="own"&&i!==l.actor||f.owner==="opponent"&&i===l.actor||f.faceState==="face_up"&&!a.isFaceUp||f.faceState==="face_down"&&a.isFaceUp||f.excludeSelf&&a.id===l.sourceCardId||!Yl(n,a.id).allowed)}case"select_own_face_up_covered_card_to_flip":{const f=d.findIndex(m=>m.id===a.id);return i==="player"&&a.isFaceUp&&f<d.length-1}case"select_opponent_covered_card_to_shift":{const f=d.findIndex(g=>g.id===a.id),m=n.turn==="player"?"opponent":"player";return Ln(n,c)?!1:i===m&&f<d.length-1}case"select_own_covered_card_to_shift":{const f=d.findIndex(m=>m.id===a.id);return Ln(n,c)?!1:i===l.actor&&f<d.length-1}case"select_covered_card_in_line_to_flip_optional":{const m=d.findIndex(y=>y.id===a.id)<d.length-1;return ma(n)&&!a.isFaceUp?!1:c===l.laneIndex&&m}case"select_covered_card_to_flip_for_chaos_0":{const m=d.findIndex(y=>y.id===a.id)<d.length-1;return ma(n)&&!a.isFaceUp?!1:c===l.laneIndex&&m}case"shift_flipped_card_optional":return Ln(n,c)?!1:a.id===l.cardId;case"select_opponent_card_to_flip":return ma(n)&&!a.isFaceUp?!1:i==="opponent"&&h;case"select_face_down_card_to_shift_for_darkness_4":return Ln(n,c)?!1:!a.isFaceUp&&h;case"select_cards_to_delete":{if(mo(n,a.id)||l.disallowedIds.includes(a.id))return!1;const f=l.allowedIds;if(f&&!f.includes(a.id))return!1;const m=l.currentLaneIndex;if(m!==void 0&&c!==m)return!1;const g=l.targetFilter;if(g){const y=d.findIndex(E=>E.id===a.id),w=g.position||"uncovered";if(w==="uncovered"&&!h||w==="covered"&&y>=d.length-1||g.faceState==="face_up"&&!a.isFaceUp||g.faceState==="face_down"&&a.isFaceUp)return!1;if(g.valueRange){const{min:E,max:C}=g.valueRange;if(a.value<E||a.value>C)return!1}const _=l.actorChooses,S=l.sourceCardId;let k=null;for(const E of["player","opponent"])if(n[E].lanes.flat().some(C=>C.id===S)){k=E;break}if(_==="card_owner"&&k){if(g.owner==="own"&&i!==k||g.owner==="opponent"&&i===k)return!1}else if(g.owner==="own"&&i!==l.actor||g.owner==="opponent"&&i===l.actor)return!1;const j=l.protocolMatching;if(j){const E=n.player.protocols[c],C=n.opponent.protocols[c],b=a.protocol,T=b===E||b===C;if(j==="must_match"&&!T||j==="must_not_match"&&T)return!1}return!0}return h}case"select_face_down_card_to_delete":return!a.isFaceUp&&h;case"select_low_value_card_to_delete":return a.isFaceUp&&(a.value===0||a.value===1)&&h;case"select_card_from_other_lanes_to_delete":{if(mo(n,a.id))return!1;const{disallowedLaneIndex:f,lanesSelected:m}=l;return c!==f&&!m.includes(c)&&h}case"plague_4_opponent_delete":return(n.turn==="player"?"opponent":"player")==="player"?i==="player"&&!a.isFaceUp&&h:!1;case"select_any_other_card_to_flip":return ma(n)&&!a.isFaceUp?!1:a.id!==l.sourceCardId&&h;case"select_card_to_return":{if(mo(n,a.id))return!1;const f=l.targetOwner||"any",m=l.targetFilter,g=l.actor,y=(m==null?void 0:m.position)||"uncovered",_=d.findIndex(S=>S.id===a.id)<d.length-1;return y==="uncovered"&&!h||y==="covered"&&!_?!1:f==="own"?i===g:f==="opponent"?i!==g:!0}case"select_card_to_shift_for_gravity_1":return mo(n,a.id)||Ln(n,c)?!1:h;case"select_face_down_card_to_shift_for_gravity_4":return Ln(n,c)?!1:!a.isFaceUp&&c!==l.targetLaneIndex&&h;case"select_any_card_to_flip":case"select_any_card_to_flip_optional":return ma(n)&&!a.isFaceUp||!Yl(n,a.id).allowed?!1:h;case"select_any_face_down_card_to_flip_optional":return Yl(n,a.id).allowed?!a.isFaceUp&&h:!1;case"select_board_card_to_reveal_custom":{const f=l.targetFilter;if(!f)return!a.isFaceUp&&h;const m=d.findIndex(y=>y.id===a.id),g=f.position||"uncovered";return!(g==="uncovered"&&!h||g==="covered"&&m>=d.length-1||f.owner==="own"&&i!==l.actor||f.owner==="opponent"&&i===l.actor||f.faceState==="face_up"&&!a.isFaceUp||f.faceState==="face_down"&&a.isFaceUp)}case"select_own_other_card_to_shift":return Ln(n,c)?!1:i===l.actor&&a.id!==l.sourceCardId&&h;case"select_opponent_face_down_card_to_shift":return Ln(n,c)?!1:i!==l.actor&&!a.isFaceUp&&h;case"select_any_opponent_card_to_shift":return Ln(n,c)?!1:i!==l.actor&&h;case"select_opponent_card_to_return":return i==="opponent"&&h;case"select_card_to_shift_for_anarchy_1":return mo(n,a.id)||Ln(n,c)?!1:h;case"select_card_to_shift_for_anarchy_0":return mo(n,a.id)||Ln(n,c)?!1:h;case"select_card_to_shift":{if(mo(n,a.id)||Ln(n,c))return!1;const f=l.targetFilter||{},m=l.destinationRestriction,g=l.scope,y=l.sourceLaneIndex;if(g==="this_lane"&&y!==void 0&&c!==y||(m==null?void 0:m.type)==="non_matching_protocol"&&!a.isFaceUp)return!1;const w=f.position||"uncovered",S=d.findIndex(k=>k.id===a.id)<d.length-1;return!(w==="uncovered"&&!h||w==="covered"&&!S||f.owner==="own"&&i!==l.actor||f.owner==="opponent"&&i===l.actor||f.faceState==="face_up"&&!a.isFaceUp||f.faceState==="face_down"&&a.isFaceUp||f.excludeSelf&&a.id===l.sourceCardId)}case"select_phase_effect":return l.availableEffects.some(m=>m.cardId===a.id);default:return!1}},q0=({gameState:a,onLanePointerDown:n,onPlayFaceDown:l,onCardPointerDown:i,onCardPointerEnter:c,onCardPointerLeave:d,onOpponentHandCardPointerEnter:p,onOpponentHandCardPointerLeave:h,selectedCardId:f,sourceCardId:m})=>{const{player:g,opponent:y,animationState:w,phase:_,turn:S,compilableLanes:k,actionRequired:j,controlCardHolder:E}=a,C=I=>{const F=_==="compile"&&S==="player"&&!j&&k.includes(I),N=S==="player",D=_==="action"&&!j&&f,P=(j==null?void 0:j.type)==="select_lane_for_play";if(!(P?(j==null?void 0:j.actor)==="player":N)||!D&&!P)return{isPlayable:!1,isMatching:!1,isCompilable:F};let R;if(D)R=g.hand.find(te=>te.id===f);else if(P){if(j.disallowedLaneIndex!==void 0&&I===j.disallowedLaneIndex)return{isPlayable:!1,isMatching:!1,isCompilable:F};const te=j.validLanes;if(te&&!te.includes(I))return{isPlayable:!1,isMatching:!1,isCompilable:F};if(j.source==="deck")return j.excludeCurrentLane&&I===j.currentLaneIndex?{isPlayable:!1,isMatching:!1,isCompilable:F}:{isPlayable:!0,isMatching:!1,isCompilable:F};R=g.hand.find(ye=>ye.id===j.cardInHandId)}if(!R)return{isPlayable:!1,isMatching:!1,isCompilable:F};const O=y.lanes[I];if(O.length>0&&O[O.length-1].isFaceUp&&O[O.length-1].protocol==="Plague"&&O[O.length-1].value===0)return{isPlayable:!1,isMatching:!1,isCompilable:F};const ee=y.lanes.flat().some(te=>te.isFaceUp&&te.protocol==="Psychic"&&te.value===1),M=g.lanes.flat().some(te=>te.isFaceUp&&te.protocol==="Spirit"&&te.value===1),G=g.lanes.some(te=>{if(te.length===0)return!1;const ye=te[te.length-1];return ye.isFaceUp&&ye.protocol==="Chaos"&&ye.value===3}),K=[...g.lanes.flat(),...y.lanes.flat()].some(te=>te.isFaceUp&&te.protocol==="Anarchy"&&te.value===1),W=vi(a),U=_i(a,"player",I),Q=Wl(a,R);let Y;return Q?Y=!ee:K||W?Y=R.protocol!==g.protocols[I]&&R.protocol!==y.protocols[I]&&!ee:Y=(M||U||G||R.protocol===g.protocols[I]||R.protocol===y.protocols[I])&&!ee,O.some(te=>te.isFaceUp&&te.protocol==="Metal"&&te.value===2)&&!Y?{isPlayable:!1,isMatching:!1,isCompilable:F}:P&&(j.isFaceDown||j.faceDown)?{isPlayable:!0,isMatching:!1,isCompilable:F}:{isPlayable:!0,isMatching:Y,isCompilable:F}},b=I=>{if(!(S==="player")||!(_==="action"&&!j&&f))return{isPlayable:!1,isMatching:!1};const D=g.hand.find(R=>R.id===f);if(!D)return{isPlayable:!1,isMatching:!1};if(!Wl(a,D))return{isPlayable:!1,isMatching:!1};const P=g.lanes[I];return P.length>0&&P[P.length-1].isFaceUp&&P[P.length-1].protocol==="Plague"&&P[P.length-1].value===0?{isPlayable:!1,isMatching:!1}:{isPlayable:!0,isMatching:!0}},T=I=>{if(!j||j.actor!=="player")return!1;switch(j.type){case"select_lane_for_delete":{const F=j.validLanes;return!(F&&!F.includes(I))}case"select_lane_for_death_2":case"select_lane_for_water_3":case"select_lane_for_return":return!0;case"select_lane_for_metal_3_delete":return I===j.disallowedLaneIndex?!1:g.lanes[I].length+y.lanes[I].length>=8;case"select_lane_for_delete_all":return(j.validLanes||[]).includes(I);default:return!1}},A=(I,F)=>{if(!j||j.actor!=="player")return!1;const N=j.type==="select_lane_for_shift"?j.originalLaneIndex:(j.type==="select_card_to_shift",-1);if(N!==-1&&!Ql(a,N,I).allowed)return!1;switch(j.type){case"select_lane_for_shift":{if(F!==j.cardOwner||I===j.originalLaneIndex)return!1;const D=j.validLanes;if(D&&!D.includes(I))return!1;const P=[...a.player.lanes.flat(),...a.opponent.lanes.flat()].find(R=>R.id===j.sourceCardId),L=j.destinationRestriction;if(L&&L.type==="to_or_from_this_lane"){let R=L.laneIndex;if(L.laneIndex==="current"&&P)for(const O of["player","opponent"]){for(let Z=0;Z<a[O].lanes.length;Z++)if(a[O].lanes[Z].some(ee=>ee.id===j.sourceCardId)){R=Z;break}if(typeof R=="number")break}if(typeof R=="number"&&!(j.originalLaneIndex===R)&&!(I===R))return!1}else if(P&&P.protocol==="Gravity"&&P.value===1){let R=-1;for(const O of["player","opponent"]){for(let Z=0;Z<a[O].lanes.length;Z++)if(a[O].lanes[Z].some(ee=>ee.id===j.sourceCardId)){R=Z;break}if(R!==-1)break}if(R!==-1&&!(j.originalLaneIndex===R)&&!(I===R))return!1}return!0}case"shift_flipped_card_optional":{const D=j.cardId;let P=null,L=-1;for(let R=0;R<g.lanes.length;R++)if(g.lanes[R].some(O=>O.id===D)){P="player",L=R;break}if(P===null){for(let R=0;R<y.lanes.length;R++)if(y.lanes[R].some(O=>O.id===D)){P="opponent",L=R;break}}return F!==P?!1:I!==L}case"select_lane_for_life_3_play":return F==="player"&&I!==j.disallowedLaneIndex;case"select_lane_to_shift_revealed_card_for_light_2":return F==="player";case"select_lane_to_shift_revealed_board_card_custom":{const D=j.revealedCardId;if(![...a.player.lanes.flat(),...a.opponent.lanes.flat()].find(O=>O.id===D))return!1;let L=null,R=-1;for(const O of["player","opponent"]){for(let Z=0;Z<a[O].lanes.length;Z++)if(a[O].lanes[Z].some(ee=>ee.id===D)){L=O,R=Z;break}if(L)break}return F===L&&I!==R}case"select_lane_for_shift_all":{const D=j.sourceLaneIndex;return I!==D}case"select_lane_to_shift_cards_for_light_3":return I!==j.sourceLaneIndex;default:return!1}},H=(I,F,N)=>{let D=[I];return F&&D.push("compiled"),(w==null?void 0:w.type)==="compile"&&w.laneIndex===N&&D.push("is-compiling"),D.join(" ")},$=()=>E==="player"?"player-controlled":E==="opponent"?"opponent-controlled":"neutral",B=()=>E==="player"?"Player has control.":E==="opponent"?"Opponent has control.":"Control is neutral.",X=()=>E==="player"?"Control Player":E==="opponent"?"Control Opponent":"Control Neutral";return o.jsxs("div",{className:"game-board",children:[o.jsx("div",{className:"opponent-hand-area",children:y.hand.map(I=>o.jsx(Ct,{card:I,isFaceUp:I.isRevealed||!1,additionalClassName:"in-hand",onPointerEnter:()=>p(I)},I.id))}),o.jsx("div",{className:`player-side opponent-side ${S==="opponent"?"active-turn":""}`,children:o.jsx("div",{className:"lanes",children:y.lanes.map((I,F)=>{const{isPlayable:N,isMatching:D}=b(F);return o.jsx(zh,{cards:I,isPlayable:N,isMatching:D,isCompilable:!1,isShiftTarget:A(F,"opponent"),isEffectTarget:T(F),onLanePointerDown:()=>n(F,"opponent"),onCardPointerDown:P=>i(P,"opponent",F),onCardPointerEnter:P=>c(P,"opponent"),onCardPointerLeave:()=>d(),owner:"opponent",animationState:w,isCardTargetable:P=>yi(P,a),laneIndex:F,sourceCardId:m,gameState:a},`opp-lane-${F}`)})})}),o.jsxs("div",{className:"protocol-bars-container",children:[a.useControlMechanic&&o.jsxs("div",{className:"control-coin-container",children:[o.jsx("div",{className:`control-coin ${$()}`,title:B(),children:"C"}),o.jsx("div",{className:`control-coin-label ${$()}`,children:X()})]}),o.jsx("div",{className:`protocol-bar opponent-bar ${S==="opponent"?"active-turn":""}`,children:y.protocols.map((I,F)=>o.jsxs("div",{className:H("protocol-display",y.compiled[F],F),children:[o.jsx("span",{className:"protocol-name",children:I}),o.jsx("span",{className:"protocol-value",children:y.laneValues[F]})]},`opp-proto-${I}-${F}`))}),o.jsx("div",{className:`protocol-bar player-bar ${S==="player"?"active-turn":""}`,children:g.protocols.map((I,F)=>o.jsxs("div",{className:H("protocol-display",g.compiled[F],F),children:[o.jsx("span",{className:"protocol-name",children:I}),o.jsx("span",{className:"protocol-value",children:g.laneValues[F]})]},`player-proto-${I}-${F}`))})]}),o.jsx("div",{className:`player-side ${S==="player"?"active-turn":""}`,children:o.jsx("div",{className:"lanes",children:g.lanes.map((I,F)=>{const{isPlayable:N,isMatching:D,isCompilable:P}=C(F);return o.jsx(zh,{cards:I,isPlayable:N,isMatching:D,isCompilable:P,isShiftTarget:A(F,"player"),isEffectTarget:T(F),onLanePointerDown:()=>n(F,"player"),onPlayFaceDown:()=>l(F),onCardPointerDown:L=>i(L,"player",F),onCardPointerEnter:L=>c(L,"player"),onCardPointerLeave:()=>d(),owner:"player",animationState:w,isCardTargetable:L=>yi(L,a),laneIndex:F,sourceCardId:m,gameState:a},`player-lane-${F}`)})})})]})},$0=({gameState:a,onFillHand:n,onSkipAction:l,onResolvePlague2Discard:i,onResolvePlague4Flip:c,onResolveFire3Prompt:d,onResolveOptionalDiscardCustomPrompt:p,onResolveOptionalEffectPrompt:h,onResolveFire4Discard:f,onResolveHate1Discard:m,onResolveRevealBoardCardPrompt:g,onResolveOptionalDrawPrompt:y,onResolveDeath1Prompt:w,onResolveLove1Prompt:_,onResolvePsychic4Prompt:S,onResolveSpirit1Prompt:k,onResolveControlMechanicPrompt:j,onResolveCustomChoice:E,selectedCardId:C,multiSelectedCardIds:b,actionRequiredClass:T})=>{const{phase:A,turn:H,actionRequired:$,player:B,compilableLanes:X}=a,I=O=>{for(const Z of["player","opponent"])for(const ee of a[Z].lanes){const M=ee.find(G=>G.id===O);if(M)return M}return null},F=$==null?void 0:$.sourceCardId,N=F?I(F):null,D=($==null?void 0:$.actor)||H,P=D.charAt(0).toUpperCase()+D.slice(1),L=()=>{var O,Z,ee,M;if(H!=="player"&&(!$||$.actor!=="player"))return o.jsx("button",{className:"btn",disabled:!0,children:"Processing..."});if(($==null?void 0:$.type)==="prompt_use_control_mechanic")return o.jsxs(o.Fragment,{children:[o.jsx("button",{className:"btn",onClick:()=>j("player"),children:"Rearrange Own"}),o.jsx("button",{className:"btn",onClick:()=>j("opponent"),children:"Rearrange Opponent's"}),o.jsx("button",{className:"btn btn-back",onClick:()=>j("skip"),children:"Skip"})]});if(($==null?void 0:$.type)==="prompt_optional_draw")return o.jsxs(o.Fragment,{children:[o.jsx("button",{className:"btn",onClick:()=>y(!0),children:"Draw"}),o.jsx("button",{className:"btn btn-back",onClick:()=>y(!1),children:"Skip"})]});if(($==null?void 0:$.type)==="prompt_death_1_effect")return o.jsxs(o.Fragment,{children:[o.jsx("button",{className:"btn",onClick:()=>w(!0),children:"Draw & Delete"}),o.jsx("button",{className:"btn btn-back",onClick:()=>w(!1),children:"Skip"})]});if(($==null?void 0:$.type)==="prompt_give_card_for_love_1")return o.jsxs(o.Fragment,{children:[o.jsx("button",{className:"btn",onClick:()=>_(!0),children:"Give 1 Card"}),o.jsx("button",{className:"btn btn-back",onClick:()=>_(!1),children:"Skip"})]});if(($==null?void 0:$.type)==="prompt_fire_3_discard")return o.jsxs(o.Fragment,{children:[o.jsx("button",{className:"btn",onClick:()=>d(!0),children:"Discard 1 Card"}),o.jsx("button",{className:"btn btn-back",onClick:()=>d(!1),children:"Skip"})]});if(($==null?void 0:$.type)==="prompt_optional_discard_custom")return o.jsxs(o.Fragment,{children:[o.jsxs("button",{className:"btn",onClick:()=>p(!0),children:["Discard ",$.count," Card(s)"]}),o.jsx("button",{className:"btn btn-back",onClick:()=>p(!1),children:"Skip"})]});if(($==null?void 0:$.type)==="prompt_optional_effect"){const G=((Z=(O=$.effectDef)==null?void 0:O.params)==null?void 0:Z.action)||"effect",K=(M=(ee=$.effectDef)==null?void 0:ee.params)==null?void 0:M.count,W=K?`${G} ${K}`:G;return o.jsxs(o.Fragment,{children:[o.jsxs("button",{className:"btn",onClick:()=>h(!0),children:["Execute (",W,")"]}),o.jsx("button",{className:"btn btn-back",onClick:()=>h(!1),children:"Skip"})]})}if(($==null?void 0:$.type)==="prompt_spirit_1_start")return o.jsxs(o.Fragment,{children:[o.jsx("button",{className:"btn",onClick:()=>k("discard"),children:"Discard 1"}),o.jsx("button",{className:"btn btn-back",onClick:()=>k("flip"),children:"Flip Card"})]});if(($==null?void 0:$.type)==="custom_choice"){const G=$.options||[];if(G.length===2){const K=G[0].params,W=G[1].params,U=Q=>Q.action==="discard"?`Discard ${Q.count||1}`:Q.action==="flip"&&Q.flipSelf?"Flip This Card":Q.action==="draw"?`Draw ${Q.count||1}`:Q.action==="delete"&&Q.deleteSelf?"Delete This Card":Q.action==="delete"?`Delete ${Q.count||1}`:Q.action==="return"?`Return ${Q.count||1}`:Q.action==="shift"?"Shift":Q.action||"Option";return o.jsxs(o.Fragment,{children:[o.jsx("button",{className:"btn",onClick:()=>E(0),children:U(K)}),o.jsx("button",{className:"btn btn-back",onClick:()=>E(1),children:U(W)})]})}}if(($==null?void 0:$.type)==="prompt_return_for_psychic_4")return o.jsxs(o.Fragment,{children:[o.jsx("button",{className:"btn",onClick:()=>S(!0),children:"Return Card"}),o.jsx("button",{className:"btn btn-back",onClick:()=>S(!1),children:"Skip"})]});if(($==null?void 0:$.type)==="prompt_shift_or_flip_board_card_custom")return o.jsxs(o.Fragment,{children:[o.jsx("button",{className:"btn",onClick:()=>g("shift"),children:"Shift"}),o.jsx("button",{className:"btn",onClick:()=>g("flip"),children:"Flip"}),o.jsx("button",{className:"btn btn-back",onClick:()=>g("skip"),children:"Skip"})]});if(($==null?void 0:$.type)==="discard"&&$.variableCount&&$.actor==="player")return o.jsxs("button",{className:"btn",onClick:()=>f(b),disabled:b.length<1,children:["Confirm Discard (",b.length,")"]});if(($==null?void 0:$.type)==="plague_2_player_discard"||($==null?void 0:$.type)==="select_cards_from_hand_to_discard_for_fire_4"||($==null?void 0:$.type)==="select_cards_from_hand_to_discard_for_hate_1"){let G,K=0;return $.type==="plague_2_player_discard"?(G=i,K=1):$.type==="select_cards_from_hand_to_discard_for_fire_4"?(G=f,K=1):(G=m,K=$.count),o.jsxs("button",{className:"btn",onClick:()=>G(b),disabled:b.length<K,children:["Confirm Discard (",b.length,")"]})}if(($==null?void 0:$.type)==="plague_4_player_flip_optional")return o.jsxs(o.Fragment,{children:[o.jsx("button",{className:"btn",onClick:()=>c(!0),children:"Flip Plague-4"}),o.jsx("button",{className:"btn btn-back",onClick:()=>c(!1),children:"Skip"})]});if($&&"optional"in $&&$.optional)return o.jsx("button",{className:"btn btn-back",onClick:l,children:"Skip Action"});if($)return o.jsx("button",{className:"btn",disabled:!0,children:"Action Required"});if(A==="compile"&&X.length>0)return o.jsx("button",{className:"btn",disabled:!0,children:"Select Lane to Compile"});if(A==="action"){const G=B.hand.length<5,K=B.hand.length===0,W=Pd(a,"player"),U=G&&W.allowed;return K?o.jsx("button",{className:"btn",onClick:n,disabled:!W.allowed,title:W.allowed?void 0:W.reason,children:"Refresh (Required)"}):o.jsx("button",{className:"btn",onClick:n,disabled:!U||!!C,title:W.allowed?void 0:W.reason,children:"Refresh"})}return o.jsx("button",{className:"btn",disabled:!0,children:"Processing..."})},R=()=>{var O,Z,ee,M;if($)switch($.type){case"discard":return $.actor==="player"?$.variableCount?"Action: Select 1 or more cards to discard":`Action: Discard ${$.count} card(s) from your hand`:"Waiting for Opponent to discard...";case"prompt_use_control_mechanic":return"Control Action: Rearrange protocols?";case"select_opponent_face_up_card_to_flip":return"Action: Select an opponent's face-up card to flip";case"select_own_face_up_covered_card_to_flip":return"Action: Select one of your face-up, covered cards to flip";case"select_opponent_covered_card_to_shift":return"Action: Select one of your opponent's covered cards to shift";case"select_own_covered_card_to_shift":return"Action: Select one of your covered cards to shift";case"select_lane_for_shift":return"Action: Select a new lane for the card";case"select_lane_for_shift_all":return"Action: Select a lane to shift all cards to";case"select_opponent_card_to_flip":return"Action: Select an opponent's card to flip";case"select_card_to_flip":{const G=$.targetFilter||{},K=G.owner||"any",W=G.faceState||"any",U=G.position||"uncovered";let Q="Action: Flip ";return K==="own"?Q+="one of your ":K==="opponent"?Q+="an opponent's ":Q+="a ",W==="face_down"?Q+="face-down ":W==="face_up"&&(Q+="face-up "),U==="covered"?Q+="covered ":U==="uncovered"&&(Q+="uncovered "),Q+="card",Q}case"shift_flipped_card_optional":return"Action: You may shift the card you just flipped. Select a lane or skip.";case"select_covered_card_in_line_to_flip_optional":return"Action: You may flip one of your covered cards in this lane. Select a card or skip.";case"select_card_from_hand_to_play":{const G=$.valueFilter;return G!==void 0?`Action: Select a card with value ${G} from your hand to play`:"Action: Select a card from your hand to play"}case"select_lane_for_play":return"Action: Select another lane to play your card in";case"select_face_down_card_to_shift_for_darkness_4":return"Action: Select any face-down card to shift";case"select_cards_to_delete":return`Action: Select a card to delete (${$.count} remaining)`;case"select_face_down_card_to_delete":return"Action: Select a face-down card to delete";case"select_low_value_card_to_delete":return"Action: Select a card with value 0 or 1 to delete";case"select_card_from_other_lanes_to_delete":return`Action: Select a card to delete (${$.count} remaining)`;case"select_lane_for_death_2":return"Action: Select a lane to delete cards with value 1 or 2";case"select_lane_for_delete":return"Action: Select a lane";case"prompt_optional_draw":return"Optional: Draw card(s)?";case"prompt_death_1_effect":return"Start Phase: Use Death-1 effect?";case"select_card_to_delete_for_death_1":return"Action: Select a card to delete";case"delete_self":return"Deleting card...";case"prompt_give_card_for_love_1":return"End Phase: Give 1 card to draw 2?";case"select_card_from_hand_to_give":return"Action: Select a card from your hand to give";case"select_card_from_hand_to_reveal":return"Action: Select a card from your hand to reveal";case"plague_2_player_discard":return"Action: Select 1 or more cards to discard";case"plague_4_opponent_delete":return"Waiting for opponent to delete one of their face-down cards";case"plague_4_player_flip_optional":return"Action: You may flip Plague-4";case"select_any_other_card_to_flip":return"Action: Select any other card to flip";case"select_card_to_return":{const G=$.targetFilter||{},K=$.targetOwner||G.owner||"any",W=G.position||"uncovered";let U="Action: Select ";return K==="own"?U+="one of your ":K==="opponent"?U+="an opponent's ":U+="a ",W==="any"?U+="covered or uncovered ":W==="covered"&&(U+="covered "),U+="card to return",U}case"select_covered_card_to_flip_for_chaos_0":return"Action: Select a covered card to flip in this lane";case"prompt_fire_3_discard":return"End Phase: Discard 1 card to flip 1 card?";case"prompt_optional_discard_custom":return`Optional: Discard ${$.count} card(s) to continue?`;case"prompt_optional_effect":{const G=((Z=(O=$.effectDef)==null?void 0:O.params)==null?void 0:Z.action)||"effect",K=(M=(ee=$.effectDef)==null?void 0:ee.params)==null?void 0:M.count;return`Do you want to ${G==="shift"?"shift a card":G==="flip"?"flip a card":G==="draw"?`draw ${K||1} card(s)`:G==="discard"?`discard ${K||1} card(s)`:G==="delete"?"delete a card":G==="return"?"return a card":`execute ${G}${K?` ${K}`:""}`}?`}case"select_card_to_flip_for_fire_3":return"Action: Select a card to flip";case"select_own_other_card_to_shift":return"Action: Select one of your cards to shift";case"select_opponent_face_down_card_to_shift":return"Action: Select an opponent's face-down card to shift";case"prompt_spirit_1_start":return"Start Phase: Discard 1 card or flip Spirit-1?";case"select_any_card_to_flip_optional":return"Action: You may flip one card. Select a card or skip.";case"prompt_swap_protocols":return"Action: Swap two protocols.";case"select_cards_from_hand_to_discard_for_fire_4":return"Action: Select 1 or more cards to discard";case"select_cards_from_hand_to_discard_for_hate_1":return`Action: Select ${$.count} card(s) to discard for Hate-1`;case"select_any_card_to_flip":return`Action: Select a card to flip (${$.count} remaining)`;case"select_any_face_down_card_to_flip_optional":return"Action: You may flip a face-down card. Select a card or skip.";case"select_lane_for_life_3_play":return"Action: Select another lane to play a card into";case"select_card_to_flip_for_light_0":return"Action: Select any card to flip";case"prompt_shift_or_flip_board_card_custom":return"Action: Choose to shift, flip, or skip";case"select_board_card_to_reveal_custom":return"Action: Select a face-down card to reveal";case"select_lane_to_shift_revealed_card_for_light_2":return"Action: Select a lane to shift the revealed card to";case"select_lane_to_shift_revealed_board_card_custom":return"Action: Select a lane to shift the revealed card to";case"select_lane_to_shift_cards_for_light_3":return"Action: Select a lane to shift all face-down cards to";case"select_lane_for_metal_3_delete":return"Action: Select a lane with 8+ cards to delete";case"select_lane_for_delete_all":return"Action: Select a lane to delete all cards";case"select_any_other_card_to_flip_for_water_0":return"Action: Select any other card to flip";case"prompt_rearrange_protocols":return"Action: Rearrange protocols";case"select_lane_for_water_3":return"Action: Select a lane to return cards from";case"select_own_card_to_return_for_water_4":return"Action: Select one of your cards to return to your hand";case"prompt_return_for_psychic_4":return"End Phase: Return an opponent's card?";case"select_any_opponent_card_to_shift":return"Action: Select an opponent's card to shift";case"select_card_to_shift":{const G=$.targetFilter||{},K=G.owner||"any",W=G.faceState||"any",U=G.position||"uncovered";let Q="Action: Select ";return K==="own"?Q+="one of your ":K==="opponent"?Q+="an opponent's ":Q+="a ",W==="face_down"?Q+="face-down ":W==="face_up"&&(Q+="face-up "),U==="covered"?Q+="covered ":U==="uncovered"&&(Q+="uncovered "),Q+="card to shift",Q}case"select_opponent_card_to_return":return"Action: Select an opponent's card to return";case"select_own_highest_card_to_delete_for_hate_2":return"Action: Select your highest value uncovered card to delete";case"select_opponent_highest_card_to_delete_for_hate_2":return"Action: Select opponent's highest value uncovered card to delete";case"custom_choice":{const G=$.options||[];if(G.length===2){const K=G[0].params,W=G[1].params,U=Q=>Q.action==="discard"?`you discard ${Q.count||1} card${Q.count!==1?"s":""}`:Q.action==="flip"&&Q.flipSelf?"flip this card":Q.action==="draw"?`draw ${Q.count||1} card${Q.count!==1?"s":""}`:Q.action==="delete"&&Q.deleteSelf?"delete this card":Q.action==="delete"?`delete ${Q.count||1} card${Q.count!==1?"s":""}`:Q.action==="return"?`return ${Q.count||1} card${Q.count!==1?"s":""}`:Q.action==="shift"?"shift a card":Q.action||"option";return`Either ${U(K)} or ${U(W)}.`}return"Action: Make a choice"}case"select_card_from_revealed_deck":return`Action: Select a card with value ${$.valueFilter} from your revealed deck`;case"select_phase_effect":{const G=$,K=G.availableEffects.map(W=>W.cardName).join(", ");return`${G.phase} Phase: Choose which effect to resolve first (${K})`}default:return"Action Required"}return A==="compile"&&X.length>0?"Phase: Compile":`Phase: ${A.replace("_"," ")}`};return o.jsxs("div",{className:`phase-controller ${T}`,children:[o.jsxs("div",{className:"effect-source-info",children:[o.jsxs("span",{children:[P,"'s Turn"]}),$&&N&&o.jsxs(o.Fragment,{children:[" | Effect from: ",o.jsxs("span",{children:[N.protocol,"-",N.value]})]}),($==null?void 0:$.sourceCardId)==="CONTROL_MECHANIC"&&o.jsxs(o.Fragment,{children:[" | Effect from: ",o.jsx("span",{children:"Control Component"})]})]}),o.jsxs("div",{className:"phase-controller-main",children:[o.jsx("div",{className:"phase-info",children:R()}),o.jsx("div",{className:"phase-actions",children:L()})]})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const U0={start:"Start",control:"Control",action:"Action",compile:"Compile",hand_limit:"Hand Limit",end:"End"},O0=({gameState:a,turn:n,animationState:l,difficulty:i,onPlayerClick:c,onOpponentClick:d})=>{const{player:p,opponent:h}=a,f=g=>{const y=["info-section"];return y.push(g==="player"?"player-info":"opponent-info"),n===g&&y.push("active-turn"),(l==null?void 0:l.type)==="drawCard"&&l.owner===g&&y.push("is-drawing"),(l==null?void 0:l.type)==="discardCard"&&l.owner===g&&y.push("is-discarding"),y.join(" ")},m=g=>{const y=g==="player"?p:h,w=g==="player"?c:d,_=g==="player"?"Player":`Opponent${i?` (${i.charAt(0).toUpperCase()+i.slice(1)})`:""}`,S=n===g;return o.jsx("div",{className:f(g),onClick:w,children:o.jsxs("div",{className:"info-section-body",children:[o.jsx("h3",{children:_}),S&&o.jsx("span",{className:"phase-badge",children:U0[a.phase]}),o.jsxs("div",{className:"info-line",children:[o.jsx("span",{children:"Hand:"}),o.jsx("span",{children:y.hand.length})]}),o.jsxs("div",{className:"info-line",children:[o.jsx("span",{children:"Deck:"}),o.jsx("span",{children:y.deck.length})]}),o.jsxs("div",{className:"info-line",children:[o.jsx("span",{children:"Trash:"}),o.jsx("span",{children:y.discard.length})]})]})})};return o.jsxs("div",{className:"game-info-panel",children:[m("opponent"),m("player")]})},I0=/\b([A-Z][a-z]+(?:_custom)?)-(\d)\b/g;function ii(a,n){return{...a,id:`preview-${a.protocol}-${a.value}`,isFaceUp:n}}function fm(a){const n=a.match(/^([A-Z][a-z]+(?:_custom)?)-(\d)$/);return n?{protocol:n[1],value:parseInt(n[2],10)}:null}function hm(a){const n=[];let l;const i=new RegExp(I0);for(;(l=i.exec(a))!==null;)n.push({protocol:l[1],value:parseInt(l[2],10)});return n}function Vh(a,n){if(a.sourceCardRef||a.targetCardRefs&&a.targetCardRefs.length>0)return!0;if(a.sourceCard){const i=fm(a.sourceCard);if(i&&n.some(c=>c.protocol===i.protocol&&c.value===i.value))return!0}const l=hm(a.message);return!!(l.length>0&&l.some(i=>n.some(c=>c.protocol===i.protocol&&c.value===i.value)))}function P0(a,n){const l={source:null,targets:[]};if(a.sourceCardRef){const i=n.find(c=>c.protocol===a.sourceCardRef.protocol&&c.value===a.sourceCardRef.value);i&&(l.source=ii(i,a.sourceCardRef.isFaceUp))}if(a.targetCardRefs&&a.targetCardRefs.length>0)for(const i of a.targetCardRefs){const c=n.find(d=>d.protocol===i.protocol&&d.value===i.value);c&&l.targets.push(ii(c,i.isFaceUp))}if(!l.source&&l.targets.length===0){if(a.sourceCard){const c=fm(a.sourceCard);if(c){const d=n.find(p=>p.protocol===c.protocol&&p.value===c.value);d&&(l.source=ii(d,!0))}}const i=hm(a.message);for(const c of i){const d=n.find(p=>p.protocol===c.protocol&&p.value===c.value);if(d){const p=ii(d,!0);l.source?(l.source.protocol!==c.protocol||l.source.value!==c.value)&&l.targets.push(p):l.source=p}}}return l}function L0({log:a,onClose:n}){const[l,i]=re.useState(null),[c,d]=re.useState(0),p=re.useMemo(()=>{const g=Co();return[...Nn,...g]},[]),h=g=>{let y="";if(g.phase){const w=g.phase.charAt(0).toUpperCase()+g.phase.slice(1);y+=`[${w}] `}return g.sourceCard&&!g.message.startsWith(g.sourceCard)&&(y+=`${g.sourceCard}: `),`${y}${g.message}`},f=re.useMemo(()=>{if(l===null)return null;const g=a[l];return g?P0(g,p):null},[l,a,p]),m=(g,y)=>{Vh(y,p)&&(l===g?f&&f.targets.length>1?d(w=>(w+1)%f.targets.length):(i(null),d(0)):(i(g),d(0)))};return o.jsx("div",{className:"modal-overlay",onClick:n,children:o.jsxs("div",{className:"modal-content log-modal-content log-modal-with-preview",onClick:g=>g.stopPropagation(),children:[o.jsx("button",{className:"btn btn-back modal-close-btn",onClick:n,children:"X"}),o.jsx("h2",{children:"Game Log"}),o.jsxs("div",{className:"log-content-wrapper",children:[o.jsx("div",{className:"log-preview-area log-preview-left",children:(f==null?void 0:f.source)&&o.jsx("div",{className:"log-preview-card",children:o.jsx(Ct,{card:f.source,isFaceUp:f.source.isFaceUp})})}),o.jsx("ol",{className:"log-list",children:a.map((g,y)=>{const w=g.indentLevel!==void 0,_=w?{paddingLeft:`${g.indentLevel*20+40}px`}:{};w&&g.indentLevel===0&&(_.fontWeight="bold");const S=Vh(g,p),k=l===y;return o.jsx("li",{className:`log-entry log-entry-${g.player}${S?" log-entry-clickable":""}${k?" log-entry-selected":""}`,style:_,onClick:()=>m(y,g),children:h(g)},y)})}),o.jsx("div",{className:"log-preview-area log-preview-right",children:(f==null?void 0:f.targets)&&f.targets.length>0&&o.jsxs("div",{className:"log-preview-card",children:[o.jsx(Ct,{card:f.targets[c],isFaceUp:f.targets[c].isFaceUp}),f.targets.length>1&&o.jsxs("div",{className:"log-preview-counter",children:[c+1," / ",f.targets.length]})]})})]})]})})}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const M0=({message:a,player:n})=>o.jsx("div",{className:`toaster toaster-${n}`,children:a});function H0({gameState:a,targetPlayer:n,onConfirm:l}){var O;const[i]=re.useState([...a[n].protocols]),[c,d]=re.useState([...a[n].protocols]),[p,h]=re.useState([0,1,2]),f=re.useRef(null),m=re.useRef(null),g=re.useRef(0),y=re.useRef(null),w=re.useRef(0),_=((O=a.actionRequired)==null?void 0:O.type)==="prompt_rearrange_protocols"?a.actionRequired.disallowedProtocolForLane:void 0,S=re.useMemo(()=>{if(c.length!==i.length)return!1;for(let Z=0;Z<c.length;Z++)if(c[Z]!==i[Z])return!0;return!1},[c,i]),k=re.useMemo(()=>{if(!_)return console.log("[RearrangeModal] No disallowedProtocolForLane set"),!1;const{laneIndex:Z,protocol:ee}=_,M=c[Z],G=M===ee;return console.log("[RearrangeModal] Checking violation:",{disallowedProtocol:ee,disallowedLaneIndex:Z,currentProtocolAtLane:M,protocols:c,hasViolation:G}),G},[c,_]),j=a[n],C=a[n==="player"?"opponent":"player"],b=j.laneValues,T=j.compiled,A=(Z,ee)=>{let M=[Z];return ee&&M.push("compiled"),M.join(" ")},H=(Z,ee)=>{f.current=ee,Z.dataTransfer.effectAllowed="move"},$=(Z,ee)=>{Z.preventDefault(),m.current=ee},B=()=>{if(f.current!==null&&m.current!==null&&f.current!==m.current){const Z=[...c],ee=[...p],M=Z[f.current];Z[f.current]=Z[m.current],Z[m.current]=M;const G=ee[f.current];ee[f.current]=ee[m.current],ee[m.current]=G,f.current=null,m.current=null,d(Z),h(ee)}},X=Z=>{Z.preventDefault()},I=(Z,ee)=>{y.current=ee,g.current=Z.touches[0].clientY,w.current=Z.touches[0].clientY},F=Z=>{var G;if(y.current===null)return;w.current=Z.touches[0].clientY;const ee=Z.touches[0],M=document.elementFromPoint(ee.clientX,ee.clientY);if(M){const K=M.closest(".rearrange-item");if(K){const U=Array.from(((G=K.parentElement)==null?void 0:G.children)||[]).indexOf(K);U!==-1&&U!==y.current&&(m.current=U)}}},N=()=>{if(y.current!==null&&m.current!==null&&y.current!==m.current){const Z=[...c],ee=[...p],M=Z[y.current];Z[y.current]=Z[m.current],Z[m.current]=M;const G=ee[y.current];ee[y.current]=ee[m.current],ee[m.current]=G,d(Z),h(ee)}y.current=null,m.current=null,g.current=0,w.current=0},D=n==="player",P=D?"Rearrange Your Protocols":"Rearrange Opponent's Protocols",L=o.jsx("div",{className:`protocol-bar ${D?"player-bar":"opponent-bar"} rearrange-editable`,onDragOver:X,children:c.map((Z,ee)=>{const M=Z!==i[ee],G=_&&_.laneIndex===ee&&Z===_.protocol,K=p[ee],W=T[K],U=A("protocol-display rearrange-item",W);return o.jsxs("div",{className:`${U} ${M?"changed":""} ${G?"violation":""}`,draggable:!0,onDragStart:Q=>H(Q,ee),onDragEnter:Q=>$(Q,ee),onDragEnd:B,onTouchStart:Q=>I(Q,ee),onTouchMove:F,onTouchEnd:N,children:[o.jsx("span",{className:"protocol-name",children:Z}),o.jsx("span",{className:"protocol-value",children:b[ee]})]},`${Z}-${ee}`)})}),R=o.jsx("div",{className:`protocol-bar ${D?"opponent-bar":"player-bar"}`,children:C.protocols.map((Z,ee)=>o.jsxs("div",{className:A("protocol-display",C.compiled[ee]),children:[o.jsx("span",{className:"protocol-name",children:Z}),o.jsx("span",{className:"protocol-value",children:C.laneValues[ee]})]},`other-proto-${Z}-${ee}`))});return o.jsx("div",{className:"modal-overlay",children:o.jsxs("div",{className:"modal-content rearrange-modal-content",onClick:Z=>Z.stopPropagation(),children:[o.jsx("h2",{children:P}),o.jsx("p",{children:"Drag and drop the protocols to reorder them. You must change the order to continue."}),_&&o.jsxs("p",{className:"warning-text",children:[" ",o.jsx("strong",{children:_.protocol})," cannot be placed on line ",o.jsx("strong",{children:_.laneIndex})," due to Anarchy-3's restriction."]}),o.jsx("div",{className:"rearrange-board-view",children:o.jsxs("div",{className:"protocol-bars-container",children:[D?R:L,D?L:R]})}),o.jsxs("div",{className:"rearrange-actions",children:[o.jsx("button",{className:"btn",onClick:()=>l(c),disabled:!S||k,children:"Confirm Rearrangement"}),k&&o.jsxs("p",{className:"error-text",children:["Cannot confirm: ",_.protocol," is on line ",_.laneIndex]})]})]})})}function z0({gameState:a,targetPlayer:n,onConfirm:l}){const[i,c]=re.useState([]),d=a[n],p=n==="player",h=p?"Swap Your Protocols":"Swap Opponent's Protocols",f=y=>{i.includes(y)?c(w=>w.filter(_=>_!==y)):i.length<2&&c(w=>[...w,y])},m=()=>{i.length===2&&l(i)},g=y=>{let w=["protocol-display","rearrange-item"];return d.compiled[y]&&w.push("compiled"),i.includes(y)&&w.push("selected"),w.join(" ")};return o.jsx("div",{className:"modal-overlay",children:o.jsxs("div",{className:"modal-content rearrange-modal-content",onClick:y=>y.stopPropagation(),children:[o.jsx("h2",{children:h}),o.jsx("p",{children:"Select two protocols to swap their positions. This action is mandatory."}),o.jsx("div",{className:"rearrange-board-view",children:o.jsx("div",{className:"protocol-bars-container",children:o.jsx("div",{className:`protocol-bar ${p?"player-bar":"opponent-bar"}`,children:d.protocols.map((y,w)=>o.jsxs("div",{className:g(w),onClick:()=>f(w),children:[o.jsx("span",{className:"protocol-name",children:y}),o.jsx("span",{className:"protocol-value",children:d.laneValues[w]})]},y))})})}),o.jsx("div",{className:"rearrange-actions",children:o.jsx("button",{className:"btn",onClick:m,disabled:i.length!==2,children:"Confirm Swap"})})]})})}function V0({gameState:a,onSelectCard:n}){var k;const[l,i]=re.useState(null),c=re.useRef(!1),d=a.actionRequired,p=d==null?void 0:d.revealedCards,h=d==null?void 0:d.selectableCardIds,f=p||(d!=null&&d.actor?(k=a[d.actor])==null?void 0:k.deck:[])||[],m=re.useMemo(()=>f.map((j,E)=>({...j,id:j.id||`deck-${E}`,isFaceUp:!0})),[f]);if(re.useEffect(()=>{if((d==null?void 0:d.type)==="select_card_from_revealed_deck"&&(h==null?void 0:h.length)>0&&!c.current){const j=m.find(E=>h.includes(E.id));j&&(i(j),c.current=!0)}},[d==null?void 0:d.type,h,m]),re.useEffect(()=>{(!d||d.type!=="select_card_from_revealed_deck")&&(c.current=!1,i(null))},[d]),!d||d.type!=="select_card_from_revealed_deck")return null;const{valueFilter:g}=d,y=j=>h==null?void 0:h.includes(j),w=j=>{y(j.id)&&i(j)},_=j=>{y(j.id)&&i(j)},S=()=>{l&&y(l.id)&&n(l.id)};return o.jsx("div",{className:"modal-overlay",children:o.jsxs("div",{className:"modal-content revealed-deck-modal",onClick:j=>j.stopPropagation(),children:[o.jsx("h2",{children:"Your Revealed Deck"}),o.jsxs("p",{children:["Select a card with value ",g," to draw:"]}),o.jsxs("div",{className:"revealed-deck-content-wrapper",children:[o.jsx("div",{className:"revealed-deck-preview-area",children:l&&o.jsxs("div",{className:"revealed-deck-preview-card",children:[o.jsx(Ct,{card:l,isFaceUp:!0}),o.jsxs("button",{className:"btn preview-confirm-btn",onClick:S,children:["Draw ",l.protocol,"-",l.value]})]})}),o.jsx("div",{className:"revealed-deck-grids-area",children:o.jsx("div",{className:"revealed-deck-card-grid",children:m.length>0?m.map(j=>{const E=y(j.id),C=(l==null?void 0:l.id)===j.id;return o.jsx("div",{onClick:b=>{b.stopPropagation(),_(j)},onMouseEnter:()=>w(j),style:{cursor:E?"pointer":"default"},children:o.jsx(Ct,{card:j,isFaceUp:!0,additionalClassName:`in-hand ${E?C?"highlight-selectable":"":"dimmed"}`})},j.id)}):o.jsx("p",{className:"no-cards",children:"No cards in deck."})})})]})]})})}function B0({gameState:a,onAccept:n,onDecline:l}){var y,w;const i=a.actionRequired;if(!i||i.type!=="prompt_optional_effect")return null;const c=i.effectDef;if(!c||((y=c.params)==null?void 0:y.action)!=="discard"||!((w=c.params)!=null&&w.useCardFromPreviousEffect))return null;const d=a.lastCustomEffectTargetCardId;if(!d)return null;const p=i.actor||"player",f=a[p].deck.find(_=>_.id===d);if(!f)return null;const m={...f,id:f.id||"revealed-top",isFaceUp:!0},g=`${f.protocol}-${f.value}`;return o.jsx("div",{className:"modal-overlay",children:o.jsxs("div",{className:"modal-content revealed-deck-top-modal",onClick:_=>_.stopPropagation(),children:[o.jsx("h2",{children:"Revealed: Top Card of Your Deck"}),o.jsx("p",{children:"You may discard this card:"}),o.jsx("div",{className:"revealed-card-display",children:o.jsx(Ct,{card:m,isFaceUp:!0})}),o.jsxs("div",{className:"revealed-deck-top-actions",children:[o.jsxs("button",{className:"btn",onClick:n,children:["Discard ",g]}),o.jsx("button",{className:"btn btn-back",onClick:l,children:"Keep in Deck"})]})]})})}function Y0({player:a,playerState:n,onClose:l,difficulty:i}){const c=a==="player"?"Player":`Opponent${i?` (${i.charAt(0).toUpperCase()+i.slice(1)})`:""}`,[d,p]=re.useState(null),h=m=>{p(m)},f=(m,g,y)=>{const w=m.map((_,S)=>({..._,id:`${g}-${_.protocol}-${_.value}-${S}`,isFaceUp:y}));return o.jsxs(o.Fragment,{children:[o.jsxs("h3",{children:[g," (",w.length,")"]}),o.jsx("div",{className:"debug-card-grid",children:w.length>0?w.map(_=>o.jsx("div",{onClick:S=>{S.stopPropagation(),p(_)},onMouseEnter:()=>h(_),onMouseLeave:()=>h(null),style:{cursor:"pointer"},children:o.jsx(Ct,{card:_,isFaceUp:y,additionalClassName:"in-hand"})},_.id)):o.jsxs("p",{className:"no-cards",children:["No cards in ",g.toLowerCase(),"."]})})]})};return o.jsx("div",{className:"modal-overlay",onClick:l,children:o.jsxs("div",{className:"modal-content debug-modal-content debug-modal-with-preview",onClick:m=>m.stopPropagation(),children:[o.jsx("button",{className:"btn btn-back modal-close-btn",onClick:l,children:"X"}),o.jsxs("h2",{children:[c,"'s Info"]}),o.jsxs("div",{className:"debug-content-wrapper",children:[o.jsx("div",{className:"debug-preview-area",children:d&&o.jsx("div",{className:"debug-preview-card",children:o.jsx(Ct,{card:d,isFaceUp:d.isFaceUp})})}),o.jsxs("div",{className:"debug-grids-area",children:[f(n.deck,"Deck",!1),f(n.discard,"Discard Pile",!0)]})]})]})})}function G0({onComplete:a}){const[n,l]=re.useState("choose"),[i,c]=re.useState(null),[d,p]=re.useState(null),[h,f]=re.useState(!1),m=y=>{c(y),l("flipping"),f(!0);const w=Math.random()<.5?"heads":"tails";setTimeout(()=>{p(w),f(!1),l("result")},2e3)},g=()=>{if(d===null||i===null)return;const y=d===i;a(y?"player":"opponent",i,y)};return o.jsx("div",{className:"coin-flip-modal-overlay",children:o.jsxs("div",{className:"modal-content coin-flip-modal-content",onClick:y=>y.stopPropagation(),children:[n==="choose"&&o.jsxs(o.Fragment,{children:[o.jsx("h2",{children:"Coin Flip"}),o.jsx("p",{children:"Choose heads or tails to determine who starts the game."}),o.jsxs("div",{className:"coin-flip-choices",children:[o.jsxs("button",{className:"btn coin-flip-choice-btn",onClick:()=>m("heads"),children:[o.jsx("div",{className:"coin-choice-icon",children:"H"}),o.jsx("div",{className:"coin-choice-label",children:"Heads"})]}),o.jsxs("button",{className:"btn coin-flip-choice-btn",onClick:()=>m("tails"),children:[o.jsx("div",{className:"coin-choice-icon",children:"T"}),o.jsx("div",{className:"coin-choice-label",children:"Tails"})]})]})]}),n==="flipping"&&o.jsxs(o.Fragment,{children:[o.jsx("h2",{children:"Flipping..."}),o.jsxs("p",{children:["You chose: ",o.jsx("span",{className:"coin-flip-highlight",children:i==="heads"?"Heads":"Tails"})]}),o.jsx("div",{className:"coin-flip-animation-container",children:o.jsxs("div",{className:`coin-3d ${h?"is-flipping":""}`,children:[o.jsx("div",{className:"coin-face coin-heads",children:"H"}),o.jsx("div",{className:"coin-face coin-tails",children:"T"})]})})]}),n==="result"&&d&&i&&o.jsxs(o.Fragment,{children:[o.jsx("h2",{children:"Result"}),o.jsxs("p",{children:["You chose: ",o.jsx("span",{className:"coin-flip-highlight",children:i==="heads"?"Heads":"Tails"})]}),o.jsx("div",{className:"coin-flip-animation-container",children:o.jsxs("div",{className:`coin-3d result-${d}`,children:[o.jsx("div",{className:"coin-face coin-heads",children:"H"}),o.jsx("div",{className:"coin-face coin-tails",children:"T"})]})}),o.jsxs("p",{className:"coin-flip-result-text",children:["The coin landed on: ",o.jsx("span",{className:"coin-flip-highlight",children:d==="heads"?"Heads":"Tails"})]}),d===i?o.jsx("p",{className:"coin-flip-winner-text",children:"You won! You will start the game."}):o.jsx("p",{className:"coin-flip-loser-text",children:"Opponent won! Opponent will start the game."}),o.jsx("button",{className:"btn",onClick:g,children:"Continue"})]})]})})}const W0="anarchy-custom-001",Q0="Anarchy",X0="Custom recreation of Anarchy protocol to validate editor capabilities",Z0="System Validation",K0="2025-11-08T00:00:00.000Z",J0="#8B0000",ex="chaos",tx=[{value:0,topEffects:[],middleEffects:[{id:"anarchy-0-shift",params:{action:"shift",targetFilter:{owner:"any",position:"uncovered",faceState:"any"}},position:"middle",trigger:"on_play"},{id:"anarchy-0-draw",params:{action:"draw",count:1,target:"self",source:"own_deck",conditional:{type:"non_matching_protocols"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[{id:"anarchy-1-passive",params:{action:"passive_rule",rule:{type:"require_non_matching_protocol",target:"all",scope:"global"}},position:"top",trigger:"passive"}],middleEffects:[{id:"anarchy-1-shift",params:{action:"shift",targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!0},destinationRestriction:{type:"non_matching_protocol"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"anarchy-2-delete",params:{action:"delete",count:1,targetFilter:{position:"any",faceState:"face_up"},protocolMatching:"must_match",excludeSelf:!1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"anarchy-3-swap",params:{action:"swap_protocols",target:"opponent"},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"anarchy-3-end-rearrange",params:{action:"rearrange_protocols",target:"own",restriction:{disallowedProtocol:"Anarchy",laneIndex:"current"}},position:"bottom",trigger:"end"}]},{value:5,topEffects:[],middleEffects:[{id:"anarchy-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:6,topEffects:[{id:"anarchy-6-start-flip",params:{action:"flip",count:1,flipSelf:!0,optional:!1,targetFilter:{owner:"any",position:"any",faceState:"any",excludeSelf:!1},advancedConditional:{type:"protocol_match",protocol:"Anarchy"}},position:"top",trigger:"start"}],middleEffects:[],bottomEffects:[]}],nx="Fan-Content",mm={id:W0,name:Q0,description:X0,author:Z0,createdAt:K0,color:J0,pattern:ex,cards:tx,category:nx},ax="apathy_custom",ox="Apathy",rx="Custom implementation of Apathy protocol",lx="System",sx="2025-01-08T00:00:00Z",ix="#9E9E9E",cx="radial",dx=[{value:0,topEffects:[{id:"apathy-0-value-modifier",params:{action:"value_modifier",modifier:{type:"add_per_condition",value:1,condition:"per_face_down_card",target:"own_total",scope:"this_lane"}},position:"top",trigger:"passive"}],middleEffects:[],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"apathy-1-flip-all",params:{action:"flip",count:"all",optional:!1,scope:"this_lane",targetFilter:{owner:"any",position:"any",faceState:"face_up",excludeSelf:!0}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:2,topEffects:[{id:"apathy-2-passive",params:{action:"passive_rule",rule:{type:"ignore_middle_commands",target:"all",scope:"this_lane"}},position:"top",trigger:"passive"}],middleEffects:[],bottomEffects:[{id:"apathy-2-on-cover",params:{action:"flip",count:1,flipSelf:!0,optional:!1,targetFilter:{owner:"any",position:"any",faceState:"any",excludeSelf:!1}},position:"bottom",trigger:"on_cover"}]},{value:3,topEffects:[],middleEffects:[{id:"apathy-3-flip-opponent",params:{action:"flip",count:1,optional:!1,targetFilter:{owner:"opponent",position:"uncovered",faceState:"face_up",excludeSelf:!1}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"apathy-4-flip-covered",params:{action:"flip",count:1,optional:!0,targetFilter:{owner:"own",position:"covered",faceState:"face_up",excludeSelf:!1}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"apathy-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],ux="Aux 1",ym={id:ax,name:ox,description:rx,author:lx,createdAt:sx,color:ix,pattern:cx,cards:dx,category:ux},px="chaos_custom_1",fx="Chaos",hx="Embrace the unpredictable. Custom protocol migration of original Chaos protocol.",mx="#E64DB8",yx="chaos",gx=[{value:0,topEffects:[],middleEffects:[{id:"chaos_0_flip_covered",trigger:"on_play",params:{action:"flip",count:1,scope:"each_lane",targetFilter:{owner:"any",position:"covered",faceState:"any"}},position:"middle"}],bottomEffects:[{id:"chaos_0_start_swap_draws",trigger:"start",params:{action:"mutual_draw",count:1},position:"bottom"}]},{value:1,topEffects:[],middleEffects:[{id:"chaos_1_rearrange_own",trigger:"on_play",params:{action:"rearrange_protocols",target:"own"},position:"middle"},{id:"chaos_1_rearrange_opponent",trigger:"on_play",params:{action:"rearrange_protocols",target:"opponent"},position:"middle"}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"chaos_2_shift_covered",trigger:"on_play",params:{action:"shift",count:1,targetFilter:{owner:"own",position:"covered",faceState:"any"}},position:"middle"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[],bottomEffects:[{id:"chaos_3_allow_any_protocol",trigger:"passive",params:{action:"passive_rule",rule:{type:"allow_any_protocol_play",target:"self",scope:"global"}},position:"bottom"}]},{value:4,topEffects:[],middleEffects:[],bottomEffects:[{id:"chaos_4_end_discard_draw",trigger:"end",params:{action:"discard",count:"all",actor:"self"},conditional:{type:"then",thenEffect:{id:"chaos_4_draw_after_discard",trigger:"on_play",params:{action:"draw",count:1,countType:"equal_to_discarded",countOffset:0,target:"self",source:"own_deck"},position:"bottom"}},position:"bottom"}]},{value:5,topEffects:[],middleEffects:[{id:"chaos_5_discard",trigger:"on_play",params:{action:"discard",count:1,actor:"self"},position:"middle"}],bottomEffects:[]}],vx="Main 2",gm={id:px,name:fx,description:hx,color:mx,pattern:yx,cards:gx,category:vx},_x="darkness_custom_v1",xx="Darkness",wx="Custom Darkness protocol - manipulate face-down cards, flip and shift",Cx="System",bx="2025-01-08T00:00:00Z",Sx="#1a0033",jx="grid",Ex=[{value:0,topEffects:[],middleEffects:[{id:"dark-0-draw",params:{action:"draw",count:3,target:"self",source:"own_deck"},position:"middle",trigger:"on_play"},{id:"dark-0-shift",params:{action:"shift",targetFilter:{owner:"opponent",position:"covered",faceState:"any",excludeSelf:!1},destinationRestriction:{type:"any"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"dark-1-flip",params:{action:"flip",count:1,optional:!1,targetFilter:{owner:"opponent",position:"uncovered",faceState:"any",excludeSelf:!1}},position:"middle",trigger:"on_play"},{id:"dark-1-shift",params:{action:"shift",optional:!0,targetFilter:{owner:"any",position:"any",faceState:"any",excludeSelf:!1},destinationRestriction:{type:"any"}},position:"middle",trigger:"on_play",useCardFromPreviousEffect:!0}],bottomEffects:[]},{value:2,topEffects:[{id:"dark-2-value-modifier",params:{action:"value_modifier",modifier:{type:"set_to_fixed",value:4,target:"own_cards",scope:"this_lane",filter:{faceState:"face_down",position:"any"}}},position:"top",trigger:"passive"}],middleEffects:[{id:"dark-2-flip",params:{action:"flip",count:1,optional:!0,scope:"this_lane",targetFilter:{owner:"any",position:"covered",faceState:"any",excludeSelf:!1}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"dark-3-play",params:{action:"play",source:"hand",count:1,faceDown:!0,destinationRule:{type:"other_lines",excludeCurrentLane:!0}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"dark-4-shift",params:{action:"shift",targetFilter:{owner:"any",position:"uncovered",faceState:"face_down",excludeSelf:!1},destinationRestriction:{type:"any"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"dark-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],kx="Main 1",vm={id:_x,name:xx,description:wx,author:Cx,createdAt:bx,color:Sx,pattern:jx,cards:Ex,category:kx},Nx="death_custom_v1",Rx="Death",Ax="Custom Death protocol - delete cards with various conditions",Dx="System",Tx="2025-01-09T00:00:00Z",Fx="#8B0000",qx="stripes",$x=[{value:0,topEffects:[],middleEffects:[{id:"death-0-delete-from-each-lane",params:{action:"delete",count:1,scope:{type:"each_other_line"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[{id:"death-1-optional-draw",params:{action:"draw",count:1,optional:!0},position:"top",trigger:"start",conditional:{type:"if_executed",thenEffect:{id:"death-1-delete-other",params:{action:"delete",count:1,excludeSelf:!0},position:"top",trigger:"start",conditional:{type:"then",thenEffect:{id:"death-1-delete-self",params:{action:"delete",count:1,targetFilter:{position:"any",owner:"own"},deleteSelf:!0},position:"top",trigger:"start"}}}}}],middleEffects:[],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"death-2-delete-lane-values",params:{action:"delete",count:"all",selectLane:!0,targetFilter:{faceState:"any",valueRange:{min:1,max:2}}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"death-3-delete-facedown",params:{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"face_down"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"death-4-delete-low-value",params:{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"face_up",valueRange:{min:0,max:1}}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"death-5-discard",params:{action:"discard",count:1},position:"middle",trigger:"on_play"}],bottomEffects:[]}],Ux="Main 1",_m={id:Nx,name:Rx,description:Ax,author:Dx,createdAt:Tx,color:Fx,pattern:qx,cards:$x,category:Ux},Ox="fire-custom-001",Ix="Fire",Px="Fire protocol - discard cards to fuel powerful effects",Lx="System",Mx="2025-11-09T00:00:00.000Z",Hx="#F06838",zx="radial",Vx=[{value:0,topEffects:[],middleEffects:[{id:"fire-0-flip",params:{action:"flip",count:1,targetFilter:{excludeSelf:!0}},position:"middle",trigger:"on_play"},{id:"fire-0-draw",params:{action:"draw",count:2},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"fire-0-oncover-draw",params:{action:"draw",count:1},position:"bottom",trigger:"on_cover",conditional:{type:"then",thenEffect:{id:"fire-0-oncover-flip",params:{action:"flip",count:1,targetFilter:{excludeSelf:!0}},position:"bottom",trigger:"on_cover"}}}]},{value:1,topEffects:[],middleEffects:[{id:"fire-1-discard",params:{action:"discard",count:1},position:"middle",trigger:"on_play",conditional:{type:"if_executed",thenEffect:{id:"fire-1-delete",params:{action:"delete",count:1},position:"middle",trigger:"on_play"}}}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"fire-2-discard",params:{action:"discard",count:1},position:"middle",trigger:"on_play",conditional:{type:"if_executed",thenEffect:{id:"fire-2-return",params:{action:"return",count:1,targetFilter:{position:"uncovered"}},position:"middle",trigger:"on_play"}}}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[],bottomEffects:[{id:"fire-3-discard",params:{action:"discard",count:1,optional:!0},position:"bottom",trigger:"end",conditional:{type:"if_executed",thenEffect:{id:"fire-3-flip",params:{action:"flip",count:1},position:"bottom",trigger:"end"}}}]},{value:4,topEffects:[],middleEffects:[{id:"fire-4-discard-variable",params:{action:"discard",count:1,variableCount:!0},position:"middle",trigger:"on_play",conditional:{type:"then",thenEffect:{id:"fire-4-draw-based-on-discard",params:{action:"draw",countType:"equal_to_discarded",countOffset:1},position:"middle",trigger:"on_play"}}}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"fire-5-discard",params:{action:"discard",count:1,optional:!1},position:"middle",trigger:"on_play"}],bottomEffects:[]}],Bx="Main 1",xm={id:Ox,name:Ix,description:Px,author:Lx,createdAt:Mx,color:Hx,pattern:zx,cards:Vx,category:Bx},Yx="frost_custom_1",Gx="Frost",Wx="Freeze the game state. Frost blocks actions and preserves face-down cards.",Qx="#87CEEB",Xx="frost",Zx=[{value:0,topEffects:[],middleEffects:[{id:"frost_0_draw_per_face_down",trigger:"on_play",position:"middle",params:{action:"draw",count:1,source:"own_deck",target:"self",countType:"count_face_down"}}],bottomEffects:[]},{value:1,topEffects:[{id:"frost_1_block_flips",trigger:"passive",position:"top",params:{action:"passive_rule",rule:{type:"block_flips",target:"all",scope:"global"}}}],middleEffects:[],bottomEffects:[{id:"frost_1_block_rearrange",trigger:"passive",position:"bottom",params:{action:"passive_rule",rule:{type:"block_protocol_rearrange",target:"all",scope:"global"}}}]},{value:2,topEffects:[],middleEffects:[{id:"frost_2_play_face_down",trigger:"on_play",position:"middle",params:{action:"play",count:1,source:"hand",faceDown:!0}}],bottomEffects:[]},{value:3,topEffects:[{id:"frost_3_block_shifts",trigger:"passive",position:"top",params:{action:"passive_rule",rule:{type:"block_shifts_from_and_to_lane",target:"all",scope:"this_lane"}}}],middleEffects:[],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"frost_4_flip_covered",trigger:"on_play",position:"middle",params:{action:"flip",count:1,optional:!0,targetFilter:{owner:"own",faceState:"face_up",position:"covered"}}}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"frost_5_discard",trigger:"on_play",position:"middle",params:{action:"discard",count:1,target:"self"}}],bottomEffects:[]}],Kx="Fan-Content",wm={id:Yx,name:Gx,description:Wx,color:Qx,pattern:Xx,cards:Zx,category:Kx},Jx="hate-custom-001",ew="Hate",tw="Focused on deletion and sacrifice. Delete cards to gain advantage.",nw="System Migration",aw="2025-11-13T00:00:00.000Z",ow="#E67A7A",rw="diagonal-lines",lw=[{value:0,topEffects:[],middleEffects:[{id:"hate-0-delete",params:{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"any"},scope:{type:"anywhere"},excludeSelf:!1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"hate-1-discard",params:{action:"discard",count:3,actor:"self",upTo:!0},position:"middle",trigger:"on_play"},{id:"hate-1-delete-1",params:{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"any"},scope:{type:"anywhere"},excludeSelf:!1,upTo:!0},position:"middle",trigger:"on_play"},{id:"hate-1-delete-2",params:{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"any"},scope:{type:"anywhere"},excludeSelf:!1,upTo:!0},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"hate-2-delete-own",params:{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"any",calculation:"highest_value",owner:"own"},scope:{type:"anywhere"},excludeSelf:!1},position:"middle",trigger:"on_play"},{id:"hate-2-delete-opponent",params:{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"any",calculation:"highest_value",owner:"opponent"},scope:{type:"anywhere"},excludeSelf:!1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[{id:"hate-3-reactive-draw",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"top",trigger:"after_delete",reactiveTriggerActor:"self"}],middleEffects:[],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[],bottomEffects:[{id:"hate-4-on-cover-delete",params:{action:"delete",count:1,targetFilter:{position:"covered_by_context",faceState:"any",calculation:"lowest_value"},scope:{type:"this_line"},excludeSelf:!1,autoExecute:!0},position:"bottom",trigger:"on_cover"}]},{value:5,topEffects:[],middleEffects:[{id:"hate-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],sw="Aux 1",Cm={id:Jx,name:ew,description:tw,author:nw,createdAt:aw,color:ow,pattern:rw,cards:lw,category:sw},iw="water_custom_1",cw="Water",dw="Wash away and renew. Custom protocol migration of original Water protocol.",uw="#5DADE2",pw="multi-radial",fw=[{value:0,topEffects:[],middleEffects:[{id:"water_0_flip_other",trigger:"immediate",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!0},optional:!1},position:"middle"},{id:"water_0_flip_self",trigger:"immediate",params:{action:"flip",flipSelf:!0},position:"middle"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"water_1_play",trigger:"immediate",params:{action:"play",source:"deck",count:1,faceDown:!0,destinationRule:{type:"each_other_line"}},position:"middle"}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"water_2_draw",trigger:"immediate",params:{action:"draw",count:2},position:"middle"},{id:"water_2_rearrange",trigger:"immediate",params:{action:"rearrange_protocols",target:"own"},position:"middle"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"water_3_return",trigger:"immediate",params:{action:"return",count:"all",targetFilter:{owner:"any",position:"uncovered",valueEquals:2},selectLane:!0},position:"middle"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"water_4_return",trigger:"immediate",params:{action:"return",count:1,targetFilter:{owner:"own",position:"uncovered"}},position:"middle"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"water_5_discard",trigger:"immediate",params:{action:"discard",count:1,actor:"self"},position:"middle"}],bottomEffects:[]}],hw="Main 1",bm={id:iw,name:cw,description:dw,color:uw,pattern:pw,cards:fw,category:hw},mw="spirit_custom_1",yw="Spirit",gw="True strength from within. Custom protocol migration of original Spirit protocol.",vw="#5DD9C1",_w="dual-radial",xw=[{value:0,topEffects:[],middleEffects:[{id:"spirit_0_refresh",trigger:"on_play",params:{action:"refresh",target:"self"},position:"middle"},{id:"spirit_0_draw",trigger:"on_play",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"middle"}],bottomEffects:[{id:"spirit_0_skip_cache",trigger:"passive",params:{action:"passive_rule",rule:{type:"skip_check_cache_phase",target:"self",scope:"global"}},position:"bottom"}]},{value:1,topEffects:[{id:"spirit_1_play_anywhere",trigger:"passive",params:{action:"passive_rule",rule:{type:"allow_any_protocol_play",target:"self",scope:"global"}},position:"top"}],middleEffects:[{id:"spirit_1_draw",trigger:"on_play",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"middle"}],bottomEffects:[{id:"spirit_1_choice",trigger:"start",params:{action:"choice",options:[{id:"spirit_1_choice_discard",trigger:"on_play",params:{action:"discard",count:1,actor:"self"},position:"bottom"},{id:"spirit_1_choice_flip",trigger:"on_play",params:{action:"flip",flipSelf:!0},position:"bottom"}]},position:"bottom"}]},{value:2,topEffects:[],middleEffects:[{id:"spirit_2_flip",trigger:"on_play",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1},optional:!0},position:"middle"}],bottomEffects:[]},{value:3,topEffects:[{id:"spirit_3_shift",trigger:"after_draw",reactiveTriggerActor:"self",params:{action:"shift",count:1,optional:!0,targetFilter:{owner:"own",position:"any",faceState:"any",excludeSelf:!1}},position:"top"}],middleEffects:[],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"spirit_4_swap",trigger:"on_play",params:{action:"swap_protocols",target:"own"},position:"middle"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"spirit_5_discard",trigger:"on_play",params:{action:"discard",count:1,actor:"self"},position:"middle"}],bottomEffects:[]}],ww="Main 1",Sm={id:mw,name:yw,description:gw,color:vw,pattern:_w,cards:xw,category:ww},Cw="gravity_custom_1",bw="Gravity",Sw="Pull everything together. Gravity draws cards towards this line.",jw="#7599EB",Ew="grid",kw=[{value:0,topEffects:[],middleEffects:[{id:"gravity_0_play_per_2_cards",trigger:"on_play",params:{action:"play",source:"deck",count:1,faceDown:!0,destinationRule:{type:"under_this_card"},condition:{type:"per_x_cards_in_line",cardCount:2},actor:"self"},position:"middle"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"gravity_1_draw_2",trigger:"on_play",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"middle"},{id:"gravity_1_shift_to_or_from",trigger:"on_play",params:{action:"shift",targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1},destinationRestriction:{type:"to_or_from_this_lane",laneIndex:"current"}},position:"middle"}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"gravity_2_flip",trigger:"on_play",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1},optional:!1},position:"middle"},{id:"gravity_2_shift_to_this_line",trigger:"on_play",params:{action:"shift",targetFilter:{owner:"any",position:"any",faceState:"any",excludeSelf:!1},destinationRestriction:{type:"to_this_lane",laneIndex:"current"}},position:"middle",useCardFromPreviousEffect:!0}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"gravity_4_shift_face_down_to_this_line",trigger:"on_play",params:{action:"shift",targetFilter:{owner:"any",position:"uncovered",faceState:"face_down",excludeSelf:!1},destinationRestriction:{type:"to_this_lane",laneIndex:"current"}},position:"middle"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"gravity_5_discard",trigger:"on_play",params:{action:"discard",count:1,actor:"self"},position:"middle"}],bottomEffects:[]},{value:6,topEffects:[],middleEffects:[{id:"gravity_6_opponent_plays",trigger:"on_play",params:{action:"play",source:"deck",count:1,faceDown:!0,destinationRule:{type:"specific_lane",laneIndex:"current"},actor:"opponent"},position:"middle",comment:"Opponent plays top of their deck in this line"}],bottomEffects:[]}],Nw="Main 1",jm={id:Cw,name:bw,description:Sw,color:jw,pattern:Ew,cards:kw,category:Nw},Rw="life_custom_1",Aw="Life",Dw="Life begets more life. Play cards from your deck to grow your presence.",Tw="#3CE076",Fw="hexagons",qw=[{value:0,topEffects:[],middleEffects:[{id:"life_0_play_each_line_with_card",trigger:"on_play",position:"middle",params:{action:"play",source:"deck",count:1,faceDown:!0,destinationRule:{type:"each_line_with_card",ownerFilter:"own"},actor:"self"}}],bottomEffects:[{id:"life_0_on_cover_delete_self",trigger:"on_cover",position:"bottom",params:{action:"delete",deleteSelf:!0}}]},{value:1,topEffects:[],middleEffects:[{id:"life_1_flip_1",trigger:"on_play",position:"middle",params:{action:"flip",count:1,optional:!1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1}}},{id:"life_1_flip_2",trigger:"on_play",position:"middle",params:{action:"flip",count:1,optional:!1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1}}}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"life_2_draw",trigger:"on_play",position:"middle",params:{action:"draw",count:1,target:"self",source:"own_deck"}},{id:"life_2_flip",trigger:"on_play",position:"middle",params:{action:"flip",count:1,optional:!0,targetFilter:{owner:"any",position:"uncovered",faceState:"face_down",excludeSelf:!1}}}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[],bottomEffects:[{id:"life_3_on_cover_play",trigger:"on_cover",position:"bottom",params:{action:"play",source:"deck",count:1,faceDown:!0,destinationRule:{type:"another_line",excludeCurrentLane:!0},actor:"self"}}]},{value:4,topEffects:[],middleEffects:[{id:"life_4_conditional_draw",trigger:"on_play",position:"middle",params:{action:"draw",count:1,target:"self",source:"own_deck",conditional:{type:"is_covering"}}}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"life_5_discard",trigger:"on_play",position:"middle",params:{action:"discard",count:1,actor:"self"}}],bottomEffects:[]}],$w="Main 1",Em={id:Rw,name:Aw,description:Dw,color:Tw,pattern:Fw,cards:qw,category:$w},Uw="light_custom_1",Ow="Light",Iw="Burn away the dark. Light protocol reveals and manipulates through illumination.",Pw="System",Lw="2025-11-14T00:00:00.000Z",Mw="#F4D03F",Hw="radial",zw=[{value:0,topEffects:[],middleEffects:[{id:"light-0-flip",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1},optional:!1},position:"middle",trigger:"on_play"},{id:"light-0-draw",params:{action:"draw",count:1,target:"self",source:"own_deck",countType:"equal_to_card_value"},position:"middle",trigger:"on_play",useCardFromPreviousEffect:!0}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[],bottomEffects:[{id:"light-1-draw",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"bottom",trigger:"end"}]},{value:2,topEffects:[],middleEffects:[{id:"light-2-draw",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"middle",trigger:"on_play"},{id:"light-2-reveal-board-card",params:{action:"reveal",source:"board",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"face_down"},optional:!0},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"light-3-shift-all",params:{action:"shift",count:"all",targetFilter:{owner:"any",position:"any",faceState:"face_down",excludeSelf:!1},destinationRestriction:{type:"to_another_line"},scope:"this_lane"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"light-4-reveal",params:{action:"reveal",source:"opponent_hand",count:-1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"light-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],Vw="Main 1",km={id:Uw,name:Ow,description:Iw,author:Pw,createdAt:Lw,color:Mw,pattern:Hw,cards:zw,category:Vw},Bw="speed_custom_1",Yw="Speed",Gw="Swift and adaptive. Custom protocol migration of original Speed protocol.",Ww="#33E6E6",Qw="cross",Xw=[{value:0,topEffects:[],middleEffects:[{id:"speed_0_play",trigger:"on_play",params:{action:"play",source:"hand",count:1},position:"middle"}],bottomEffects:[]},{value:1,topEffects:[{id:"speed_1_reactive_draw",trigger:"after_clear_cache",reactiveTriggerActor:"self",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"top"}],middleEffects:[{id:"speed_1_draw",trigger:"on_play",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"middle"}],bottomEffects:[]},{value:2,topEffects:[{id:"speed_2_before_compile",trigger:"before_compile_delete",params:{action:"shift",count:1,shiftSelf:!0,allowCoveredSelf:!0,targetFilter:{owner:"own",position:"any",faceState:"any"}},position:"top"}],middleEffects:[],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"speed_3_shift_other",trigger:"on_play",params:{action:"shift",count:1,targetFilter:{owner:"own",position:"uncovered",faceState:"any",excludeSelf:!0}},position:"middle"}],bottomEffects:[{id:"speed_3_end_shift",trigger:"end",params:{action:"shift",count:1,optional:!0,targetFilter:{owner:"own",position:"uncovered",faceState:"any"}},position:"bottom",conditional:{type:"if_executed",thenEffect:{id:"speed_3_flip_self",trigger:"on_play",params:{action:"flip",flipSelf:!0},position:"bottom"}}}]},{value:4,topEffects:[],middleEffects:[{id:"speed_4_shift_opponent",trigger:"on_play",params:{action:"shift",count:1,targetFilter:{owner:"opponent",position:"uncovered",faceState:"face_down"}},position:"middle"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"speed_5_discard",trigger:"on_play",params:{action:"discard",count:1,actor:"self"},position:"middle"}],bottomEffects:[]}],Zw="Main 1",Nm={id:Bw,name:Yw,description:Gw,color:Ww,pattern:Qw,cards:Xw,category:Zw},Kw="metal_custom_1",Jw="Metal",e1="Unyielding defense. Custom protocol migration of original Metal protocol.",t1="#B0BEC5",n1="grid",a1=[{value:0,topEffects:[{id:"metal_0_reduce_opponent",trigger:"passive",params:{action:"value_modifier",modifier:{type:"add_to_total",value:-2,target:"opponent_total",scope:"this_lane"}},position:"top"}],middleEffects:[{id:"metal_0_flip",trigger:"on_play",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any"}},position:"middle"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"metal_1_draw",trigger:"on_play",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"middle"},{id:"metal_1_block_compile",trigger:"on_play",params:{action:"block_compile",target:"opponent"},position:"middle"}],bottomEffects:[]},{value:2,topEffects:[{id:"metal_2_block_face_down",trigger:"passive",params:{action:"passive_rule",rule:{type:"block_face_down_play",scope:"this_lane"}},position:"top"}],middleEffects:[],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"metal_3_draw",trigger:"on_play",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"middle"},{id:"metal_3_delete_lane",trigger:"on_play",params:{action:"delete_all_in_lane",laneCondition:{type:"min_cards",count:8},excludeCurrentLane:!0},position:"middle"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"metal_5_discard",trigger:"on_play",params:{action:"discard",count:1,actor:"self"},position:"middle"}],bottomEffects:[]},{value:6,topEffects:[{id:"metal_6_delete_on_cover_or_flip",trigger:"on_cover_or_flip",params:{action:"delete",deleteSelf:!0},position:"top"}],middleEffects:[],bottomEffects:[]}],o1="Main 1",Rm={id:Kw,name:Jw,description:e1,color:t1,pattern:n1,cards:a1,category:o1},r1="plague-custom-001",l1="Plague",s1="Focused on forcing opponent discards and restricting their plays. Spread suffering.",i1="System Migration",c1="2025-11-26T00:00:00.000Z",d1="#8FBC3A",u1="dual-radial",p1=[{value:0,topEffects:[],middleEffects:[{id:"plague-0-opponent-discard",params:{action:"discard",count:1,actor:"opponent"},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"plague-0-block-play",params:{action:"passive_rule",rule:{type:"block_all_play",target:"opponent",scope:"this_lane"}},position:"bottom",trigger:"passive"}]},{value:1,topEffects:[{id:"plague-1-reactive-draw",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"top",trigger:"after_opponent_discard"}],middleEffects:[{id:"plague-1-opponent-discard",params:{action:"discard",count:1,actor:"opponent"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"plague-2-self-discard",params:{action:"discard",count:1,actor:"self",variableCount:!0},position:"middle",trigger:"on_play",conditional:{type:"then",thenEffect:{id:"plague-2-opponent-discard",params:{action:"discard",actor:"opponent",countType:"equal_to_discarded",countOffset:1},position:"middle",trigger:"on_play"}}}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"plague-3-flip-each-other",params:{action:"flip",count:"all",scope:{type:"anywhere"},targetFilter:{faceState:"face_up",owner:"any",position:"uncovered",excludeSelf:!0}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,text:{bottom:"<div><span class='emphasis'>End:</span> Your opponent deletes 1 of their face-down cards. You may flip this card.</div>"},topEffects:[],middleEffects:[],bottomEffects:[{id:"plague-4-opponent-delete",params:{action:"delete",count:1,targetFilter:{faceState:"face_down",owner:"opponent",position:"uncovered"},scope:{type:"anywhere"},actorChooses:"card_owner"},position:"bottom",trigger:"end"},{id:"plague-4-may-flip-self",params:{action:"flip",flipSelf:!0,optional:!0},position:"bottom",trigger:"end"}]},{value:5,topEffects:[],middleEffects:[{id:"plague-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],f1="Main 1",Am={id:r1,name:l1,description:s1,author:i1,createdAt:c1,color:d1,pattern:u1,cards:p1,category:f1},h1="love_custom_v1",m1="Love",y1="Custom Love protocol - hand manipulation, giving and taking cards",g1="System",v1="2025-01-08T00:00:00Z",_1="#f2a3d7",x1="radial",w1=[{value:1,topEffects:[],middleEffects:[{id:"love-1-draw-opponent-deck",params:{action:"draw",count:1,target:"self",source:"opponent_deck"},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"love-1-end-give",params:{action:"give",count:1,source:"own_hand",optional:!0},conditional:{type:"if_executed",thenEffect:{id:"love-1-end-draw",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"bottom",trigger:"on_play"}},position:"bottom",trigger:"end"}]},{value:2,topEffects:[],middleEffects:[{id:"love-2-opponent-draw",params:{action:"draw",count:1,target:"opponent",source:"own_deck"},position:"middle",trigger:"on_play"},{id:"love-2-refresh",params:{action:"refresh",target:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"love-3-take",params:{action:"take",count:1,random:!0},position:"middle",trigger:"on_play"},{id:"love-3-give",params:{action:"give",count:1,source:"own_hand",optional:!1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"love-4-reveal",params:{action:"reveal",count:1,source:"own_hand"},position:"middle",trigger:"on_play"},{id:"love-4-flip",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"love-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:6,topEffects:[],middleEffects:[{id:"love-6-opponent-draw",params:{action:"draw",count:2,target:"opponent",source:"own_deck"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],C1="Aux 1",Dm={id:h1,name:m1,description:y1,author:g1,createdAt:v1,color:_1,pattern:x1,cards:w1,category:C1},b1="psychic_custom_v1",S1="Psychic",j1="Custom Psychic protocol - mind control, discard, reveal, and protocol manipulation",E1="System",k1="2025-01-08T00:00:00Z",N1="#c78dd9",R1="radial",A1=[{value:0,topEffects:[],middleEffects:[{id:"psychic-0-draw",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"middle",trigger:"on_play"},{id:"psychic-0-opponent-discard",params:{action:"discard",count:2,actor:"opponent"},position:"middle",trigger:"on_play"},{id:"psychic-0-reveal-hand",params:{action:"reveal",source:"opponent_hand",count:-1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[{id:"psychic-1-force-face-down",params:{action:"passive_rule",rule:{type:"require_face_down_play",target:"opponent",scope:"global"}},position:"top",trigger:"passive"}],middleEffects:[],bottomEffects:[{id:"psychic-1-start-flip-self",params:{action:"flip",count:1,targetFilter:{owner:"self",position:"any",faceState:"any",excludeSelf:!1},flipSelf:!0},position:"bottom",trigger:"start"}]},{value:2,topEffects:[],middleEffects:[{id:"psychic-2-opponent-discard",params:{action:"discard",count:2,actor:"opponent"},position:"middle",trigger:"on_play"},{id:"psychic-2-rearrange",params:{action:"rearrange_protocols",target:"opponent"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"psychic-3-opponent-discard",params:{action:"discard",count:1,actor:"opponent"},position:"middle",trigger:"on_play"},{id:"psychic-3-shift-opponent",params:{action:"shift",targetFilter:{owner:"opponent",position:"uncovered",faceState:"any",excludeSelf:!1},destinationRestriction:{type:"any"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[],bottomEffects:[{id:"psychic-4-end-return",params:{action:"return",count:1,optional:!0,targetFilter:{owner:"opponent",position:"uncovered",faceState:"any",excludeSelf:!1}},conditional:{type:"if_executed",thenEffect:{id:"psychic-4-end-flip-self",params:{action:"flip",count:1,flipSelf:!0,targetFilter:{owner:"self",position:"any",faceState:"any",excludeSelf:!1}},position:"bottom",trigger:"end"}},position:"bottom",trigger:"end"}]},{value:5,topEffects:[],middleEffects:[{id:"psychic-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],D1="Main 1",Tm={id:b1,name:S1,description:j1,author:E1,createdAt:k1,color:N1,pattern:R1,cards:A1,category:D1},T1="smoke-custom-001",F1="Smoke",q1="Shroud your cards in mystery. Use face-down cards to gain value and control.",$1="System",U1="2025-12-09T00:00:00.000Z",O1="#5A5A5A",I1="radial",P1=[{value:0,topEffects:[],middleEffects:[{id:"smoke-0-play-deck-each-facedown",params:{action:"play",source:"deck",count:1,faceDown:!0,destinationRule:{type:"each_line_with_card",cardFilter:{faceState:"face_down"}}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"smoke-1-flip-own",params:{action:"flip",count:1,targetFilter:{owner:"own",position:"uncovered",faceState:"any"},optional:!1},position:"middle",trigger:"on_play"},{id:"smoke-1-shift-that-card",params:{action:"shift",optional:!0,targetFilter:{owner:"own",position:"uncovered",faceState:"any"}},position:"middle",trigger:"on_play",useCardFromPreviousEffect:!0}],bottomEffects:[]},{value:2,topEffects:[{id:"smoke-2-value-per-facedown",params:{action:"value_modifier",modifier:{type:"add_per_condition",value:1,condition:"per_face_down_card",target:"own_total",scope:"this_lane"}},position:"top",trigger:"passive"}],middleEffects:[],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"smoke-3-play-hand-facedown-lane",params:{action:"play",source:"hand",count:1,faceDown:!0,destinationRule:{type:"line_with_matching_cards",cardFilter:{faceState:"face_down"}}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"smoke-4-shift-covered-facedown",params:{action:"shift",optional:!1,targetFilter:{owner:"any",position:"covered",faceState:"face_down"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"smoke-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],L1="Main 2",Fm={id:T1,name:F1,description:q1,author:$1,createdAt:U1,color:O1,pattern:I1,cards:P1,category:L1},M1="clarity-custom-001",H1="Clarity",z1="See through the fog of war. Reveal your deck and hand to gain powerful advantages.",V1="System",B1="2025-12-09T00:00:00.000Z",Y1="#87CEEB",G1="radial",W1=[{value:0,topEffects:[{id:"clarity-0-value-per-hand",params:{action:"value_modifier",modifier:{type:"add_per_condition",value:1,condition:"per_card_in_hand",target:"own_total",scope:"this_lane"}},position:"top",trigger:"passive"}],middleEffects:[],bottomEffects:[]},{value:1,topEffects:[{id:"clarity-1-start-reveal-deck-top",params:{action:"reveal",source:"own_deck_top",count:1},position:"top",trigger:"start",conditional:{type:"optional",thenEffect:{id:"clarity-1-discard-revealed",params:{action:"discard",count:1,actor:"self",useCardFromPreviousEffect:!0}}}}],middleEffects:[{id:"clarity-1-middle-reveal-opponent-hand",params:{action:"reveal",source:"opponent_hand",count:-1},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"clarity-1-bottom-draw-3",params:{action:"draw",count:3,target:"self",source:"own_deck"},position:"bottom",trigger:"on_cover"}]},{value:2,topEffects:[],middleEffects:[{id:"clarity-2-reveal-deck",params:{action:"reveal",source:"own_deck",count:-1},position:"middle",trigger:"on_play"},{id:"clarity-2-draw-value-1",params:{action:"draw",count:1,target:"self",source:"own_deck",valueFilter:{equals:1},fromRevealed:!0},position:"middle",trigger:"on_play"},{id:"clarity-2-shuffle-deck",params:{action:"shuffle_deck"},position:"middle",trigger:"on_play"},{id:"clarity-2-play-value-1",params:{action:"play",source:"hand",count:1,faceDown:!1,valueFilter:{equals:1}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"clarity-3-reveal-deck",params:{action:"reveal",source:"own_deck",count:-1},position:"middle",trigger:"on_play"},{id:"clarity-3-draw-value-5",params:{action:"draw",count:1,target:"self",source:"own_deck",valueFilter:{equals:5},fromRevealed:!0},position:"middle",trigger:"on_play"},{id:"clarity-3-shuffle-deck",params:{action:"shuffle_deck"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"clarity-4-shuffle-trash",params:{action:"shuffle_trash",optional:!0},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"clarity-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],Q1="Main 2",qm={id:M1,name:H1,description:z1,author:V1,createdAt:B1,color:Y1,pattern:G1,cards:W1,category:Q1},X1="corruption-custom-001",Z1="Corruption",K1="Corrupt your opponents plans. Use discard synergies and manipulate the return mechanic.",J1="System",eC="2025-12-09T00:00:00.000Z",tC="#4A0080",nC="stripes",aC=[{value:0,topEffects:[{id:"corruption-0-start-flip",params:{action:"flip",count:1,scope:"this_lane",targetFilter:{owner:"own",position:"any",faceState:"face_up",excludeSelf:!0},optional:!1},position:"top",trigger:"start"}],middleEffects:[],bottomEffects:[{id:"corruption-0-play-opponent-side",params:{action:"passive_rule",rule:{type:"allow_play_on_opponent_side",target:"self",scope:"global"}},position:"bottom",trigger:"passive"}]},{value:1,topEffects:[],middleEffects:[{id:"corruption-1-return",params:{action:"return",count:1,targetFilter:{owner:"any",position:"uncovered"}},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"corruption-1-redirect-return",params:{action:"redirect_return_to_deck",faceDown:!0,targetOwner:"opponent"},position:"bottom",trigger:"when_card_returned"}]},{value:2,topEffects:[{id:"corruption-2-after-discard",params:{action:"discard",count:1,actor:"opponent"},position:"top",trigger:"after_discard",reactiveTriggerActor:"self"}],middleEffects:[{id:"corruption-2-draw",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"middle",trigger:"on_play"},{id:"corruption-2-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"corruption-3-flip-covered",params:{action:"flip",count:1,optional:!0,targetFilter:{owner:"any",position:"covered",faceState:"face_up",excludeSelf:!1}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"corruption-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:6,topEffects:[{id:"corruption-6-end-choice",params:{action:"choice",options:[{id:"corruption-6-choice-discard",params:{action:"discard",count:1,actor:"self"},position:"top",trigger:"end"},{id:"corruption-6-choice-delete-self",params:{action:"delete",deleteSelf:!0},position:"top",trigger:"end"}]},position:"top",trigger:"end"}],middleEffects:[],bottomEffects:[]}],oC="Main 2",$m={id:X1,name:Z1,description:K1,author:J1,createdAt:eC,color:tC,pattern:nC,cards:aC,category:oC},rC="courage-custom-001",lC="Courage",sC="Face challenges head-on. Gain power when outnumbered.",iC="System",cC="2025-12-10T00:00:00.000Z",dC="#D4AF37",uC="radial",pC=[{value:0,topEffects:[{id:"courage-0-start-draw",params:{action:"draw",count:1,advancedConditional:{type:"empty_hand"}},position:"top",trigger:"start"}],middleEffects:[{id:"courage-0-draw",params:{action:"draw",count:1},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"courage-0-end-discard",params:{action:"discard",count:1,optional:!0},position:"bottom",trigger:"end",conditional:{type:"if_executed",thenEffect:{id:"courage-0-opponent-discard",params:{action:"discard",count:1,actor:"opponent"},position:"bottom",trigger:"end"}}}]},{value:1,topEffects:[],middleEffects:[{id:"courage-1-delete",params:{action:"delete",count:1,targetFilter:{owner:"opponent",position:"uncovered"},selectLane:!0,laneCondition:{type:"opponent_higher_value"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"courage-2-draw",params:{action:"draw",count:1},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"courage-2-end-draw",params:{action:"draw",count:1,advancedConditional:{type:"opponent_higher_value_in_lane"}},position:"bottom",trigger:"end"}]},{value:3,topEffects:[],middleEffects:[],bottomEffects:[{id:"courage-3-shift",params:{action:"shift",shiftSelf:!0,optional:!0,destinationRestriction:{type:"opponent_highest_value_lane"}},position:"bottom",trigger:"end"}]},{value:5,topEffects:[],middleEffects:[{id:"courage-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:6,topEffects:[{id:"courage-6-flip",params:{action:"flip",flipSelf:!0,advancedConditional:{type:"opponent_higher_value_in_lane"}},position:"top",trigger:"end"}],middleEffects:[],bottomEffects:[]}],fC="Main 2",Um={id:rC,name:lC,description:sC,author:iC,createdAt:cC,color:dC,pattern:uC,cards:pC,category:fC},hC="fear_custom",mC="Fear",yC="Terror and disruption protocol - Control through fear",gC="System",vC="2025-01-10T00:00:00Z",_C="#800020",xC="radial",wC="Main 2",CC=[{value:0,topEffects:[{id:"fear-0-passive",params:{action:"passive_rule",rule:{type:"ignore_middle_commands",target:"opponent",scope:"global",onlyDuringYourTurn:!0}},position:"top",trigger:"passive"}],middleEffects:[{id:"fear-0-choice",params:{action:"choice",options:[{id:"fear-0-shift",params:{action:"shift",targetFilter:{owner:"any",position:"uncovered",faceState:"any"}},position:"middle",trigger:"on_play"},{id:"fear-0-flip",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1},optional:!1},position:"middle",trigger:"on_play"}]},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"fear-1-draw",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"middle",trigger:"on_play",conditional:{type:"then",thenEffect:{id:"fear-1-opponent-discard-hand",params:{action:"discard",count:"all",actor:"opponent"},position:"middle",trigger:"on_play",conditional:{type:"then",thenEffect:{id:"fear-1-opponent-draw",params:{action:"draw",countType:"equal_to_discarded",countOffset:-1,target:"opponent",source:"own_deck"},position:"middle",trigger:"on_play"}}}}}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"fear-2-return",params:{action:"return",count:1,targetFilter:{owner:"opponent"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"fear-3-shift",params:{action:"shift",targetFilter:{owner:"opponent",position:"any",faceState:"any"},scope:"this_lane"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"fear-4-discard-random",params:{action:"discard",count:1,actor:"opponent",random:!0},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"fear-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],Om={id:hC,name:mC,description:yC,author:gC,createdAt:vC,color:_C,pattern:xC,category:wC,cards:CC},bC="ice_custom",SC="Ice",jC="Control and disruption through shifting and conditional effects",EC="System",kC="2025-12-10T00:00:00Z",NC="#B0E0E6",RC="radial",AC="Main 2",DC=[{value:1,topEffects:[],middleEffects:[{id:"ice-1-shift",params:{action:"shift",shiftSelf:!0,optional:!0},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"ice-1-reactive",params:{action:"discard",actor:"opponent",count:1},position:"bottom",trigger:"after_play",reactiveTriggerActor:"opponent",reactiveScope:"this_lane"}]},{value:2,topEffects:[],middleEffects:[{id:"ice-2-shift",params:{action:"shift",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!0}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[{id:"ice-3-end-shift",params:{action:"shift",shiftSelf:!0,optional:!0,advancedConditional:{type:"this_card_is_covered"}},position:"top",trigger:"end"}],middleEffects:[],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[],bottomEffects:[{id:"ice-4-passive",params:{action:"passive_rule",rule:{type:"block_flip_this_card",target:"this_card",scope:"this_card"}},position:"bottom",trigger:"passive"}]},{value:5,topEffects:[],middleEffects:[{id:"ice-5-discard",params:{action:"discard",actor:"self",count:1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:6,topEffects:[{id:"ice-6-passive",params:{action:"passive_rule",rule:{type:"block_draw_conditional",conditionTarget:"self",blockTarget:"self",scope:"global"}},position:"top",trigger:"passive"}],middleEffects:[],bottomEffects:[]}],Im={id:bC,name:SC,description:jC,author:EC,createdAt:kC,color:NC,pattern:RC,category:AC,cards:DC};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const TC=[mm,ym,gm,vm,_m,xm,wm,Cm,bm,Sm,jm,Em,km,Nm,Rm,Am,Dm,Tm,Fm,qm,$m,Um,Om,Im],FC=()=>TC.map(a=>a.name.replace(/_custom$/i,"")),qC=()=>{try{const a=Qo(),n=a.findIndex(l=>l.id==="dark_cust_v2"||l.name==="Dark_cust");n>=0&&(a.splice(n,1),Od(a)),yt(mm),yt(ym),yt(vm),yt(_m),yt(xm),yt(bm),yt(Sm),yt(gm),yt(jm),yt(wm),yt(Cm),yt(Em),yt(km),yt(Nm),yt(Rm),yt(Am),yt(Dm),yt(Tm),yt(Fm),yt(qm),yt($m),yt(Um),yt(Om),yt(Im)}catch(a){console.error("[Default Protocols] Error loading default protocols:",a)}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const zd="compile_game_statistics",Pm=()=>{const a=g_,n=FC(),l=new Set([...a,...n]);return Array.from(l).sort()},Lm=1;function Bh(){const a=Pm(),n={};return a.forEach(l=>{n[l]={timesUsed:0,wins:0,losses:0}}),{version:Lm,global:{totalGamesPlayed:0,totalGamesWon:0,totalGamesLost:0,totalPlaytime:0,fastestWin:null,longestGame:null,lastGameDuration:null,currentStreak:0,longestWinStreak:0,longestLoseStreak:0},protocols:n,aiDifficulty:{easy:{played:0,wins:0,losses:0},normal:{played:0,wins:0,losses:0},hard:{played:0,wins:0,losses:0}},cards:{played:{},deleted:{}},actions:{totalCardsDrawn:0,totalCardsPlayed:0,totalShifts:0,totalDeletes:0,totalDiscards:0,totalFlips:0,totalCompiles:0,totalRefreshes:0,totalReturns:0,detailedStats:{cardsPlayed:{total:0,player:0,ai:0,playerFromHand:0,playerFromEffect:0,aiFromHand:0,aiFromEffect:0,playerFaceUp:0,playerFaceDown:0,aiFaceUp:0,aiFaceDown:0},cardsDrawn:{total:0,player:0,ai:0,playerFromRefresh:0,playerFromEffect:0,aiFromRefresh:0,aiFromEffect:0},discards:{total:0,player:0,ai:0},deletes:{total:0,player:0,ai:0},flips:{total:0,player:0,ai:0},shifts:{total:0,player:0,ai:0},returns:{total:0,player:0,ai:0},compiles:{total:0,player:0,ai:0,playerFirstCompile:0,playerRecompile:0,aiFirstCompile:0,aiRecompile:0},refreshes:{total:0,player:0,ai:0,playerCardsDrawn:0,aiCardsDrawn:0}}},control:{gamesWithControl:0,gamesWithoutControl:0,playerRearranges:0,aiRearranges:0,totalRearranges:0},coinFlip:{headsChosen:0,tailsChosen:0,headsWon:0,tailsWon:0}}}function $d(){var a,n,l,i,c,d,p,h,f,m,g,y,w,_,S,k,j,E,C,b,T,A,H,$,B,X,I,F,N,D,P,L,R,O,Z,ee,M,G,K,W,U,Q,Y,ce,te,ye,Se,ge,Fe,Le,Xe,nt,we,Ce,Ie,He,gt,Ye,qt,Zt,vn,zn,sn,Rt,Vt,bt,Vn,ga,ta,An,cn,At,Kt,_n,va,na,aa,Bn,dn,Yn,oa,ra,Gn,Wn,la,sa,Jt,_t,Et,ue,be,Ae,$e,Te,Me,Je,ze,qe,at,Bt,fe,_e,je,Ge,xt,nn,ia,an,Dn,Tn,on,un,bo,Lt,Qn,Ma,Ha,Zo,So,Yt,ca,Ot,za,_a,jo,Kl,rn,Ko,Vr,Jo,xa,Br,Yr,wa,Jl,Gr,Wr,er,es,ts,Eo,tr,nr,Ca,ba,Qr,ar;try{const ko=localStorage.getItem(zd);if(!ko)return Bh();const Ee=JSON.parse(ko),Xn=Pm(),Va={...Ee.protocols||{}};Xn.forEach(or=>{Va[or]||(Va[or]={timesUsed:0,wins:0,losses:0})});const Ba={...Ee,version:Lm,global:{...Ee.global,lastGameDuration:((a=Ee.global)==null?void 0:a.lastGameDuration)||null},protocols:Va,control:{gamesWithControl:((n=Ee.control)==null?void 0:n.gamesWithControl)||0,gamesWithoutControl:((l=Ee.control)==null?void 0:l.gamesWithoutControl)||0,playerRearranges:((i=Ee.control)==null?void 0:i.playerRearranges)||0,aiRearranges:((c=Ee.control)==null?void 0:c.aiRearranges)||0,totalRearranges:((d=Ee.control)==null?void 0:d.totalRearranges)||0},coinFlip:Ee.coinFlip||{headsChosen:0,tailsChosen:0,headsWon:0,tailsWon:0},actions:{...Ee.actions,totalCompiles:((p=Ee.actions)==null?void 0:p.totalCompiles)||0,totalRefreshes:((h=Ee.actions)==null?void 0:h.totalRefreshes)||0,totalReturns:((f=Ee.actions)==null?void 0:f.totalReturns)||0,detailedStats:{cardsPlayed:{total:((y=(g=(m=Ee.actions)==null?void 0:m.detailedStats)==null?void 0:g.cardsPlayed)==null?void 0:y.total)||0,player:((S=(_=(w=Ee.actions)==null?void 0:w.detailedStats)==null?void 0:_.cardsPlayed)==null?void 0:S.player)||0,ai:((E=(j=(k=Ee.actions)==null?void 0:k.detailedStats)==null?void 0:j.cardsPlayed)==null?void 0:E.ai)||0,playerFromHand:((T=(b=(C=Ee.actions)==null?void 0:C.detailedStats)==null?void 0:b.cardsPlayed)==null?void 0:T.playerFromHand)||0,playerFromEffect:(($=(H=(A=Ee.actions)==null?void 0:A.detailedStats)==null?void 0:H.cardsPlayed)==null?void 0:$.playerFromEffect)||0,aiFromHand:((I=(X=(B=Ee.actions)==null?void 0:B.detailedStats)==null?void 0:X.cardsPlayed)==null?void 0:I.aiFromHand)||0,aiFromEffect:((D=(N=(F=Ee.actions)==null?void 0:F.detailedStats)==null?void 0:N.cardsPlayed)==null?void 0:D.aiFromEffect)||0,playerFaceUp:((R=(L=(P=Ee.actions)==null?void 0:P.detailedStats)==null?void 0:L.cardsPlayed)==null?void 0:R.playerFaceUp)||0,playerFaceDown:((ee=(Z=(O=Ee.actions)==null?void 0:O.detailedStats)==null?void 0:Z.cardsPlayed)==null?void 0:ee.playerFaceDown)||0,aiFaceUp:((K=(G=(M=Ee.actions)==null?void 0:M.detailedStats)==null?void 0:G.cardsPlayed)==null?void 0:K.aiFaceUp)||0,aiFaceDown:((Q=(U=(W=Ee.actions)==null?void 0:W.detailedStats)==null?void 0:U.cardsPlayed)==null?void 0:Q.aiFaceDown)||0},cardsDrawn:{total:((te=(ce=(Y=Ee.actions)==null?void 0:Y.detailedStats)==null?void 0:ce.cardsDrawn)==null?void 0:te.total)||0,player:((ge=(Se=(ye=Ee.actions)==null?void 0:ye.detailedStats)==null?void 0:Se.cardsDrawn)==null?void 0:ge.player)||0,ai:((Xe=(Le=(Fe=Ee.actions)==null?void 0:Fe.detailedStats)==null?void 0:Le.cardsDrawn)==null?void 0:Xe.ai)||0,playerFromRefresh:((Ce=(we=(nt=Ee.actions)==null?void 0:nt.detailedStats)==null?void 0:we.cardsDrawn)==null?void 0:Ce.playerFromRefresh)||0,playerFromEffect:((gt=(He=(Ie=Ee.actions)==null?void 0:Ie.detailedStats)==null?void 0:He.cardsDrawn)==null?void 0:gt.playerFromEffect)||0,aiFromRefresh:((Zt=(qt=(Ye=Ee.actions)==null?void 0:Ye.detailedStats)==null?void 0:qt.cardsDrawn)==null?void 0:Zt.aiFromRefresh)||0,aiFromEffect:((sn=(zn=(vn=Ee.actions)==null?void 0:vn.detailedStats)==null?void 0:zn.cardsDrawn)==null?void 0:sn.aiFromEffect)||0},discards:{total:((bt=(Vt=(Rt=Ee.actions)==null?void 0:Rt.detailedStats)==null?void 0:Vt.discards)==null?void 0:bt.total)||0,player:((ta=(ga=(Vn=Ee.actions)==null?void 0:Vn.detailedStats)==null?void 0:ga.discards)==null?void 0:ta.player)||0,ai:((At=(cn=(An=Ee.actions)==null?void 0:An.detailedStats)==null?void 0:cn.discards)==null?void 0:At.ai)||0},deletes:{total:((va=(_n=(Kt=Ee.actions)==null?void 0:Kt.detailedStats)==null?void 0:_n.deletes)==null?void 0:va.total)||0,player:((Bn=(aa=(na=Ee.actions)==null?void 0:na.detailedStats)==null?void 0:aa.deletes)==null?void 0:Bn.player)||0,ai:((oa=(Yn=(dn=Ee.actions)==null?void 0:dn.detailedStats)==null?void 0:Yn.deletes)==null?void 0:oa.ai)||0},flips:{total:((Wn=(Gn=(ra=Ee.actions)==null?void 0:ra.detailedStats)==null?void 0:Gn.flips)==null?void 0:Wn.total)||0,player:((Jt=(sa=(la=Ee.actions)==null?void 0:la.detailedStats)==null?void 0:sa.flips)==null?void 0:Jt.player)||0,ai:((ue=(Et=(_t=Ee.actions)==null?void 0:_t.detailedStats)==null?void 0:Et.flips)==null?void 0:ue.ai)||0},shifts:{total:(($e=(Ae=(be=Ee.actions)==null?void 0:be.detailedStats)==null?void 0:Ae.shifts)==null?void 0:$e.total)||0,player:((Je=(Me=(Te=Ee.actions)==null?void 0:Te.detailedStats)==null?void 0:Me.shifts)==null?void 0:Je.player)||0,ai:((at=(qe=(ze=Ee.actions)==null?void 0:ze.detailedStats)==null?void 0:qe.shifts)==null?void 0:at.ai)||0},returns:{total:((_e=(fe=(Bt=Ee.actions)==null?void 0:Bt.detailedStats)==null?void 0:fe.returns)==null?void 0:_e.total)||0,player:((xt=(Ge=(je=Ee.actions)==null?void 0:je.detailedStats)==null?void 0:Ge.returns)==null?void 0:xt.player)||0,ai:((an=(ia=(nn=Ee.actions)==null?void 0:nn.detailedStats)==null?void 0:ia.returns)==null?void 0:an.ai)||0},compiles:{total:((on=(Tn=(Dn=Ee.actions)==null?void 0:Dn.detailedStats)==null?void 0:Tn.compiles)==null?void 0:on.total)||0,player:((Lt=(bo=(un=Ee.actions)==null?void 0:un.detailedStats)==null?void 0:bo.compiles)==null?void 0:Lt.player)||0,ai:((Ha=(Ma=(Qn=Ee.actions)==null?void 0:Qn.detailedStats)==null?void 0:Ma.compiles)==null?void 0:Ha.ai)||0,playerFirstCompile:((Yt=(So=(Zo=Ee.actions)==null?void 0:Zo.detailedStats)==null?void 0:So.compiles)==null?void 0:Yt.playerFirstCompile)||0,playerRecompile:((za=(Ot=(ca=Ee.actions)==null?void 0:ca.detailedStats)==null?void 0:Ot.compiles)==null?void 0:za.playerRecompile)||0,aiFirstCompile:((Kl=(jo=(_a=Ee.actions)==null?void 0:_a.detailedStats)==null?void 0:jo.compiles)==null?void 0:Kl.aiFirstCompile)||0,aiRecompile:((Vr=(Ko=(rn=Ee.actions)==null?void 0:rn.detailedStats)==null?void 0:Ko.compiles)==null?void 0:Vr.aiRecompile)||0},refreshes:{total:((Br=(xa=(Jo=Ee.actions)==null?void 0:Jo.detailedStats)==null?void 0:xa.refreshes)==null?void 0:Br.total)||0,player:((Jl=(wa=(Yr=Ee.actions)==null?void 0:Yr.detailedStats)==null?void 0:wa.refreshes)==null?void 0:Jl.player)||0,ai:((er=(Wr=(Gr=Ee.actions)==null?void 0:Gr.detailedStats)==null?void 0:Wr.refreshes)==null?void 0:er.ai)||0,playerCardsDrawn:((Eo=(ts=(es=Ee.actions)==null?void 0:es.detailedStats)==null?void 0:ts.refreshes)==null?void 0:Eo.playerCardsDrawn)||0,aiCardsDrawn:((Ca=(nr=(tr=Ee.actions)==null?void 0:tr.detailedStats)==null?void 0:nr.refreshes)==null?void 0:Ca.aiCardsDrawn)||0}}}};return(!((ba=Ee.control)!=null&&ba.playerRearranges)||!Ee.coinFlip||!((Qr=Ee.actions)!=null&&Qr.totalCompiles)||!((ar=Ee.actions)!=null&&ar.detailedStats)||Object.keys(Va).length!==Object.keys(Ee.protocols||{}).length)&&Or(Ba),Ba}catch(ko){return console.error("Failed to load statistics:",ko),Bh()}}function Or(a){try{localStorage.setItem(zd,JSON.stringify(a))}catch(n){console.error("Failed to save statistics:",n)}}function $C(){try{localStorage.removeItem(zd)}catch(a){console.error("Failed to reset statistics:",a)}}function UC(a,n,l,i,c,d=!1,p,h,f,m){const g=n==="player",y={...a.global},w={...a.protocols},_={easy:{...a.aiDifficulty.easy},normal:{...a.aiDifficulty.normal},hard:{...a.aiDifficulty.hard}},S={...a.control},k={...a.actions},j={...a.coinFlip},E={played:{...a.cards.played},deleted:{...a.cards.deleted}};y.totalGamesPlayed++,g?y.totalGamesWon++:y.totalGamesLost++,y.totalPlaytime+=c,g&&(y.fastestWin===null||c<y.fastestWin)&&(y.fastestWin=c),(y.longestGame===null||c>y.longestGame)&&(y.longestGame=c),y.lastGameDuration=c,g?(y.currentStreak>=0?y.currentStreak++:y.currentStreak=1,y.currentStreak>y.longestWinStreak&&(y.longestWinStreak=y.currentStreak)):(y.currentStreak<=0?y.currentStreak--:y.currentStreak=-1,Math.abs(y.currentStreak)>y.longestLoseStreak&&(y.longestLoseStreak=Math.abs(y.currentStreak))),l.forEach(b=>{w[b]?w[b]={...w[b]}:w[b]={timesUsed:0,wins:0,losses:0},w[b].timesUsed++,g?w[b].wins++:w[b].losses++}),_[i].played++,g?_[i].wins++:_[i].losses++,d?S.gamesWithControl++:S.gamesWithoutControl++;const C={cardsPlayed:{...a.actions.detailedStats.cardsPlayed},cardsDrawn:{...a.actions.detailedStats.cardsDrawn},discards:{...a.actions.detailedStats.discards},deletes:{...a.actions.detailedStats.deletes},flips:{...a.actions.detailedStats.flips},shifts:{...a.actions.detailedStats.shifts},returns:{...a.actions.detailedStats.returns},compiles:{...a.actions.detailedStats.compiles},refreshes:{...a.actions.detailedStats.refreshes}};return p&&(k.totalCardsPlayed+=p.cardsPlayed,k.totalCardsDrawn+=p.cardsDrawn,k.totalDiscards+=p.cardsDiscarded,k.totalDeletes+=p.cardsDeleted,k.totalFlips+=p.cardsFlipped,k.totalShifts+=p.cardsShifted,k.totalRefreshes+=p.handsRefreshed,k.totalReturns+=p.cardsReturned||0,C.cardsPlayed.total+=p.cardsPlayed,C.cardsPlayed.player+=p.cardsPlayed,C.cardsDrawn.total+=p.cardsDrawn,C.cardsDrawn.player+=p.cardsDrawn,C.discards.total+=p.cardsDiscarded,C.discards.player+=p.cardsDiscarded,C.deletes.total+=p.cardsDeleted,C.deletes.player+=p.cardsDeleted,C.flips.total+=p.cardsFlipped,C.flips.player+=p.cardsFlipped,C.shifts.total+=p.cardsShifted,C.shifts.player+=p.cardsShifted,C.returns.total+=p.cardsReturned||0,C.returns.player+=p.cardsReturned||0,C.refreshes.total+=p.handsRefreshed,C.refreshes.player+=p.handsRefreshed),f&&(k.totalCardsPlayed+=f.cardsPlayed,k.totalCardsDrawn+=f.cardsDrawn,k.totalDiscards+=f.cardsDiscarded,k.totalDeletes+=f.cardsDeleted,k.totalFlips+=f.cardsFlipped,k.totalShifts+=f.cardsShifted,k.totalRefreshes+=f.handsRefreshed,k.totalReturns+=f.cardsReturned||0,C.cardsPlayed.total+=f.cardsPlayed,C.cardsPlayed.ai+=f.cardsPlayed,C.cardsDrawn.total+=f.cardsDrawn,C.cardsDrawn.ai+=f.cardsDrawn,C.discards.total+=f.cardsDiscarded,C.discards.ai+=f.cardsDiscarded,C.deletes.total+=f.cardsDeleted,C.deletes.ai+=f.cardsDeleted,C.flips.total+=f.cardsFlipped,C.flips.ai+=f.cardsFlipped,C.shifts.total+=f.cardsShifted,C.shifts.ai+=f.cardsShifted,C.returns.total+=f.cardsReturned||0,C.returns.ai+=f.cardsReturned||0,C.refreshes.total+=f.handsRefreshed,C.refreshes.ai+=f.handsRefreshed),m&&(m.cardsPlayed&&(C.cardsPlayed.playerFromHand+=m.cardsPlayed.playerFromHand,C.cardsPlayed.playerFromEffect+=m.cardsPlayed.playerFromEffect,C.cardsPlayed.aiFromHand+=m.cardsPlayed.aiFromHand,C.cardsPlayed.aiFromEffect+=m.cardsPlayed.aiFromEffect,C.cardsPlayed.playerFaceUp+=m.cardsPlayed.playerFaceUp,C.cardsPlayed.playerFaceDown+=m.cardsPlayed.playerFaceDown,C.cardsPlayed.aiFaceUp+=m.cardsPlayed.aiFaceUp,C.cardsPlayed.aiFaceDown+=m.cardsPlayed.aiFaceDown),m.cardsDrawn&&(C.cardsDrawn.playerFromRefresh+=m.cardsDrawn.playerFromRefresh,C.cardsDrawn.playerFromEffect+=m.cardsDrawn.playerFromEffect,C.cardsDrawn.aiFromRefresh+=m.cardsDrawn.aiFromRefresh,C.cardsDrawn.aiFromEffect+=m.cardsDrawn.aiFromEffect),m.compiles&&(C.compiles.playerFirstCompile+=m.compiles.playerFirstCompile,C.compiles.playerRecompile+=m.compiles.playerRecompile,C.compiles.aiFirstCompile+=m.compiles.aiFirstCompile,C.compiles.aiRecompile+=m.compiles.aiRecompile,C.compiles.player+=m.compiles.playerFirstCompile+m.compiles.playerRecompile,C.compiles.ai+=m.compiles.aiFirstCompile+m.compiles.aiRecompile,C.compiles.total+=m.compiles.playerFirstCompile+m.compiles.playerRecompile+m.compiles.aiFirstCompile+m.compiles.aiRecompile),m.refreshes&&(C.refreshes.playerCardsDrawn+=m.refreshes.playerCardsDrawn,C.refreshes.aiCardsDrawn+=m.refreshes.aiCardsDrawn)),h!==void 0&&(k.totalCompiles+=h),k.detailedStats=C,{version:a.version,global:y,protocols:w,aiDifficulty:_,cards:E,actions:k,control:S,coinFlip:j}}function OC(a,n){const l={...a,cards:{...a.cards,played:{...a.cards.played}}};return l.cards.played[n]||(l.cards.played[n]=0),l.cards.played[n]++,l}function IC(a,n){const l={...a,cards:{...a.cards,deleted:{...a.cards.deleted}}};return l.cards.deleted[n]||(l.cards.deleted[n]=0),l.cards.deleted[n]++,l}function PC(a,n){const l={...a,control:{...a.control}};return n==="player"?l.control.playerRearranges++:l.control.aiRearranges++,l.control.totalRearranges++,l}function LC(a,n,l){const i={...a,coinFlip:{...a.coinFlip}};return n==="heads"?(i.coinFlip.headsChosen++,l&&i.coinFlip.headsWon++):(i.coinFlip.tailsChosen++,l&&i.coinFlip.tailsWon++),i}function MC(a){return a.global.totalGamesPlayed===0?0:a.global.totalGamesWon/a.global.totalGamesPlayed*100}function HC(a){return a.global.totalGamesPlayed===0?0:Math.floor(a.global.totalPlaytime/a.global.totalGamesPlayed)}function zC(a){return Object.entries(a.protocols).map(([l,i])=>({protocol:l,timesUsed:i.timesUsed,winRate:i.timesUsed>0?i.wins/i.timesUsed*100:0})).sort((l,i)=>i.timesUsed-l.timesUsed).slice(0,5)}function VC(a){return Object.entries(a.protocols).filter(([l,i])=>i.timesUsed>=3).map(([l,i])=>({protocol:l,timesUsed:i.timesUsed,winRate:i.wins/i.timesUsed*100})).sort((l,i)=>i.winRate-l.winRate).slice(0,5)}function BC(a){return Object.entries(a.protocols).map(([l,i])=>({protocol:l,timesUsed:i.timesUsed,winRate:i.timesUsed>0?i.wins/i.timesUsed*100:0})).sort((l,i)=>l.timesUsed-i.timesUsed).slice(0,5)}function YC(a){return Object.entries(a.cards.played).map(([l,i])=>({card:l,count:i})).sort((l,i)=>i.count-l.count).slice(0,5)}function GC(a){return Object.entries(a.cards.deleted).map(([l,i])=>({card:l,count:i})).sort((l,i)=>i.count-l.count).slice(0,5)}function Vl(a){const n=Math.floor(a/3600),l=Math.floor(a%3600/60),i=a%60;return n>0?`${n}h ${l}m`:l>0?`${l}m ${i}s`:`${i}s`}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function WC(a,n,l){const[i,c]=re.useState(()=>$d()),d=re.useRef(null),p=re.useCallback(()=>{d.current=Date.now()},[]),h=re.useCallback((w,_)=>{c(S=>{const k=`${w}-${_}`,j=OC(S,k);return Or(j),j})},[]),f=re.useCallback((w,_)=>{c(S=>{const k=`${w}-${_}`,j=IC(S,k);return Or(j),j})},[]),m=re.useCallback((w,_)=>{c(S=>{const k=LC(S,w,_);return Or(k),k})},[]),g=re.useCallback(w=>{c(_=>{const S=PC(_,w);return Or(S),S})},[]),y=re.useCallback((w,_,S,k,j)=>{if(d.current===null)return;const E=Math.floor((Date.now()-d.current)/1e3);c(C=>{const b=UC(C,w,a,n,E,l,_,S,k,j);return Or(b),b}),d.current=null},[a,n,l]);return{statistics:i,startGame:p,endGame:y,trackPlayerCardPlayed:h,trackPlayerCardDeleted:f,trackPlayerCoinFlip:m,trackPlayerRearrange:g}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function x(a,n,l=!0){const c=Co().find(d=>d.protocol===a&&d.value===n);return c?{id:Qe(),protocol:c.protocol,value:c.value,top:c.top,middle:c.middle,bottom:c.bottom,keywords:c.keywords,isFaceUp:l,isRevealed:!1,category:c.category||"Main",...c.customEffects&&{customEffects:c.customEffects}}:(console.warn(`Card not found: ${a}-${n}`),{id:Qe(),protocol:a,value:n,top:"",middle:"",bottom:"",keywords:{},isFaceUp:l,isRevealed:!1,category:"Main"})}function V(a,n,l,i){const c={...a},d={...c[n]},p=[...d.lanes];return p[l]=[...p[l],i],d.lanes=p,c[n]=d,c}function Yh(a,n){const l=[],i=Co();for(const c of a){const d=i.filter(p=>p.protocol===c);for(const p of d)n.some(f=>f.protocol===p.protocol&&f.value===p.value)||l.push(x(p.protocol,p.value,!0))}return l}function ke(a,n,l,i,c){return{...a,player:{...a.player,protocols:n,lanes:[[],[],[]],hand:[]},opponent:{...a.opponent,protocols:l,lanes:[[],[],[]],hand:[]},turn:i,phase:c,actionRequired:null,queuedActions:[],_interruptedTurn:void 0,_interruptedPhase:void 0,processedStartEffectIds:[],processedEndEffectIds:[],processedUncoverEventIds:[]}}function Ne(a){const n=[...a.player.hand,...a.player.lanes.flat()],l=[...a.opponent.hand,...a.opponent.lanes.flat()],i=Yh(a.player.protocols,n),c=Yh(a.opponent.protocols,l),d=a.turn==="player"?"Player":"Opponent",p=[{player:"player",message:`Player protocols: ${a.player.protocols.join(", ")}`},{player:"opponent",message:`Opponent protocols: ${a.opponent.protocols.join(", ")}`},{player:a.turn,message:`${d} goes first.`},{player:"player",message:"---"},{player:a.turn,message:`[Test Scenario] Phase: ${a.phase}`}];return{...a,player:{...a.player,deck:i,discard:[],compiled:[!1,!1,!1]},opponent:{...a.opponent,deck:c,discard:[],compiled:[!1,!1,!1]},log:p}}const Mm={name:"Psychic-3 Uncover whrend Opponent's Turn",description:"Player lscht Opponent's face-down card  Psychic-3 uncovered  Player discardet, Opponent shiftet",setup:a=>{let n=ke(a,["Hate","Fire","Water"],["Psychic","Death","Spirit"],"player","action");return n.player.hand=[x("Hate",0,!0),x("Fire",1,!0),x("Water",1,!0)],n=V(n,"opponent",1,x("Psychic",3,!0)),n=V(n,"opponent",1,x("Fire",1,!1)),n=xe(n),Ne(n)}},Hm={name:"Psychic-4 End Effect mit Uncover-Interrupt",description:"Psychic-4 returnt Fire-2  Fire-4 uncovered  Interrupt  Psychic-4 flip aus Queue",setup:a=>{let n=ke(a,["Fire","Water","Spirit"],["Psychic","Death","Metal"],"opponent","end");return n=V(n,"opponent",0,x("Psychic",4,!0)),n=V(n,"player",1,x("Fire",4,!0)),n=V(n,"player",1,x("Fire",2,!0)),n.opponent.hand=[x("Water",1),x("Water",2)],n=xe(n),Ne(n)}},zm={name:"Spirit-3 Draw whrend End Phase",description:"Spirit-3 draw in End Phase  Shift-prompt in Queue  Player kann lanes klicken",setup:a=>{let n=ke(a,["Spirit","Fire","Water"],["Death","Metal","Psychic"],"player","action");n=V(n,"player",0,x("Spirit",3,!0));const l=Co(),i=l.find(p=>p.protocol==="Fire"&&p.value===1),c=l.find(p=>p.protocol==="Water"&&p.value===1),d=l.find(p=>p.protocol==="Spirit"&&p.value===1);return n.player.deck=[i,c,d],n=xe(n),Ne(n)}},Vm={name:"Plague-2 Actor Propagation",description:"Player spielt Plague-2  Player discardet  Opponent discardet (actor korrekt)",setup:a=>{let n=ke(a,["Plague","Death","Hate"],["Fire","Water","Spirit"],"player","action");return n.player.hand=[x("Plague",2,!0),x("Fire",1),x("Water",1),x("Spirit",1)],n.opponent.hand=[x("Fire",2),x("Water",2),x("Spirit",2),x("Death",2)],n=xe(n),Ne(n)}},Bm={name:"Darkness-1 Flip + Shift mit Interrupt",description:"Darkness-1 flippt Fire-0  Delete-Interrupt  Player shiftet",setup:a=>{let n=ke(a,["Darkness","Fire","Water"],["Spirit","Death","Metal"],"player","action");return n.player.hand=[x("Darkness",1,!0)],n=V(n,"opponent",0,x("Fire",0,!1)),n=xe(n),Ne(n)}},Ym={name:"Plague-4 Owner vs Turn Check",description:"Plague-4 End  Player deletet  Opponent (owner) wird fr flip gefragt",setup:a=>{let n=ke(a,["Fire","Water","Spirit"],["Plague","Death","Metal"],"opponent","end");return n=V(n,"opponent",0,x("Plague",4,!0)),n=V(n,"player",1,x("Water",2,!1)),n=xe(n),Ne(n)}},Gm={name:"Water Owner vs Turn Check",description:"Plague-4 End  Player deletet  Opponent (owner) wird fr flip gefragt",setup:a=>{let n=ke(a,["Fire","Water","Spirit"],["Plague","Death","Metal"],"player","action");return n=V(n,"opponent",0,x("Plague",4,!0)),n=V(n,"player",2,x("Water",4,!1)),n.player.hand=[x("Water",0,!0),x("Fire",1),x("Water",1),x("Spirit",1)],n.opponent.hand=[x("Fire",2),x("Water",2),x("Spirit",2),x("Death",2)],n=xe(n),Ne(n)}},Wm={name:"Hate-1 Multi-Delete mit Uncover-Interrupt",description:"Hate-1 lscht Plague-0  Plague-5 uncovered  Interrupt  Player macht 2. Delete",setup:a=>{let n=ke(a,["Fire","Hate","Water"],["Plague","Death","Metal"],"player","action");return n.player.hand=[x("Hate",1,!0),x("Psychic",2,!0),x("Psychic",4,!0),x("Hate",4,!0),x("Water",1,!0)],n=V(n,"opponent",0,x("Plague",2,!0)),n=V(n,"opponent",0,x("Plague",0,!0)),n.opponent.hand=[x("Fire",2,!0),x("Water",2,!0),x("Spirit",2,!0),x("Death",2,!0),x("Metal",2,!0)],n=xe(n),Ne(n)}},Qm={name:"Darkness-1  Hate-0 Flip  Multi-Effect Chain",description:" Darkness-1 flippt Hate-0  Delete-Interrupt  Draw-Interrupt  Shift aus Queue",setup:a=>{let n=ke(a,["Darkness","Fire","Water"],["Hate","Death","Metal"],"player","action");n.player.hand=[x("Darkness",1,!0)],n=V(n,"opponent",0,x("Hate",0,!1)),n=V(n,"opponent",1,x("Hate",3,!0)),n=V(n,"opponent",2,x("Fire",1,!1)),n=V(n,"player",1,x("Water",2,!0)),n.opponent.hand=[x("Death",2),x("Metal",3)];const i=Co().find(c=>c.protocol==="Death"&&c.value===1);return n.opponent.deck=[i],n=xe(n),Ne(n)}},Xm={name:"Water-4 Return  Turn End",description:" Water-4 returnt Karte  Turn endet (Bug-Fix: Opponent spielt nicht zweimal)",setup:a=>{let n=ke(a,["Hate","Spirit","Light"],["Fire","Water","Death"],"opponent","action");return n.opponent.hand=[x("Water",4,!0)],n=V(n,"opponent",0,x("Life",4,!0)),n=V(n,"opponent",2,x("Death",4,!1)),n=V(n,"player",1,x("Spirit",1,!0)),n=V(n,"player",2,x("Light",5,!1)),n.player.hand=[x("Fire",1),x("Spirit",2),x("Hate",4)],n=xe(n),Ne(n)}},Zm={name:"Psychic-3 Discard + Shift",description:" Psychic-3 On-Play  Player discardet  AI shiftet (Bug-Fix: AI kann shiften)",setup:a=>{let n=ke(a,["Fire","Water","Spirit"],["Psychic","Death","Metal"],"opponent","action");return n.opponent.hand=[x("Psychic",3,!0)],n.player.hand=[x("Fire",1),x("Water",2),x("Spirit",1)],n=V(n,"player",0,x("Fire",2,!0)),n=V(n,"player",1,x("Water",3,!0)),n=V(n,"player",2,x("Spirit",4,!0)),n=xe(n),Ne(n)}},Km={name:"Death-1 Delete  Speed-3 Uncover",description:" Death-1 lscht Light-0  Speed-3 uncovered  Player shiftet (Bug-Fix Test)",setup:a=>{let n=ke(a,["Speed","Light","Water"],["Death","Fire","Metal"],"opponent","start");return n=V(n,"player",0,x("Speed",3,!0)),n=V(n,"player",0,x("Light",0,!0)),n=V(n,"player",1,x("Water",1,!0)),n=V(n,"opponent",0,x("Death",1,!0)),n.player.hand=[],n.opponent.hand=[],n=xe(n),Ne(n)}},Jm={name:"Gravity-2 Flip  Metal-5 Discard  Shift",description:" Gravity-2 flippt Metal-5  Discard Interrupt  shiften (Bug-Fix: AI stuck)",setup:a=>{let n=ke(a,["Fire","Water","Light"],["Gravity","Metal","Fire"],"opponent","action");return n.opponent.hand=[x("Gravity",2,!0),x("Fire",1)],n=V(n,"opponent",1,x("Metal",5,!1)),n=V(n,"player",0,x("Fire",2,!0)),n=V(n,"player",2,x("Light",3,!0)),n.player.hand=[x("Water",1),x("Fire",3)],n=xe(n),Ne(n)}},ey={name:"Hate-2 Player spielt (Einfach)",description:" Player spielt Hate-2  Whlt eigene & Gegners hchste Karte",setup:a=>{let n=ke(a,["Hate","Water","Light"],["Metal","Death","Gravity"],"player","action");return n.player.hand=[x("Hate",2,!0)],n=V(n,"player",0,x("Fire",4,!0)),n=V(n,"player",1,x("Water",2,!0)),n=V(n,"player",2,x("Light",5,!0)),n=V(n,"opponent",0,x("Metal",3,!0)),n=V(n,"opponent",1,x("Death",5,!0)),n=V(n,"opponent",2,x("Gravity",2,!1)),n=xe(n),Ne(n)}},ty={name:"Hate-2 AI spielt (Normal)",description:" AI spielt Hate-2  AI whlt eigene & Players hchste automatisch",setup:a=>{let n=ke(a,["Water","Spirit","Light"],["Hate","Metal","Death"],"opponent","action");return n.opponent.hand=[x("Hate",2,!0)],n=V(n,"opponent",0,x("Fire",5,!0)),n=V(n,"opponent",1,x("Metal",3,!0)),n=V(n,"opponent",2,x("Death",2,!1)),n=V(n,"player",0,x("Water",4,!0)),n=V(n,"player",1,x("Spirit",5,!0)),n=V(n,"player",2,x("Light",2,!0)),n=xe(n),Ne(n)}},ny={name:"Hate-2 AI spielt (Normal) mit Auswahl",description:" AI spielt Hate-2  AI whlt eigene & Players hchste automatisch",setup:a=>{let n=ke(a,["Water","Spirit","Light"],["Hate","Metal","Death"],"opponent","action");return n.opponent.hand=[x("Hate",2,!0)],n=V(n,"opponent",0,x("Fire",5,!0)),n=V(n,"opponent",1,x("Metal",3,!0)),n=V(n,"opponent",2,x("Death",2,!1)),n=V(n,"player",0,x("Water",4,!0)),n=V(n,"player",1,x("Spirit",5,!0)),n=V(n,"player",2,x("Light",5,!0)),n=xe(n),Ne(n)}},ay={name:"Hate-2 Selbst-Lschung",description:" Hate-2 lscht sich selbst  Zweite Klausel entfllt (Regelwerk-Check)",setup:a=>{let n=ke(a,["Hate","Fire","Water"],["Metal","Death","Gravity"],"player","action");return n.player.hand=[x("Hate",2,!0)],n=V(n,"player",1,x("Fire",1,!0)),n=V(n,"player",2,x("Water",0,!0)),n=V(n,"opponent",0,x("Metal",3,!0)),n=V(n,"opponent",1,x("Death",5,!0)),n=xe(n),Ne(n)}},oy={name:"Hate-2 Gleichstand (Auswahl)",description:" Hate-2 mit mehreren hchsten  Player muss whlen (Tied values)",setup:a=>{let n=ke(a,["Hate","Water","Spirit"],["Metal","Death","Gravity"],"player","action");return n.player.hand=[x("Hate",2,!0)],n=V(n,"player",0,x("Fire",4,!0)),n=V(n,"player",1,x("Water",4,!0)),n=V(n,"player",2,x("Spirit",4,!0)),n=V(n,"opponent",0,x("Metal",5,!0)),n=V(n,"opponent",1,x("Death",5,!0)),n=V(n,"opponent",2,x("Gravity",2,!1)),n=xe(n),Ne(n)}},ry={name:"Hate-2 Face-Down Karten",description:" Hate-2 mit face-down  Alle face-down sind value 2 (Tied mit Hate-2)",setup:a=>{let n=ke(a,["Hate","Fire","Water"],["Metal","Death","Gravity"],"player","action");return n.player.hand=[x("Hate",2,!0)],n=V(n,"player",1,x("Fire",5,!1)),n=V(n,"player",2,x("Water",5,!1)),n=V(n,"opponent",0,x("Metal",5,!0)),n=V(n,"opponent",1,x("Death",4,!1)),n=V(n,"opponent",2,x("Gravity",1,!0)),n=xe(n),Ne(n)}},ly={name:"Hate-2 AI Play-Validation",description:" AI spielt Hate-2 NICHT face-up wenn es sich selbst lschen wrde",setup:a=>{let n=ke(a,["Fire","Water","Spirit"],["Hate","Death","Metal"],"opponent","action");return n.opponent.hand=[x("Hate",2,!0)],n=V(n,"opponent",1,x("Fire",0,!0)),n=V(n,"opponent",2,x("Water",1,!0)),n=V(n,"player",0,x("Fire",5,!0)),n=V(n,"player",1,x("Water",4,!0)),n=xe(n),Ne(n)}},sy={name:"Hate-2 AI spielt OFFEN (Optimal)",description:" AI spielt Hate-2 offen weil nicht hchste Karte",setup:a=>{let n=ke(a,["Water","Spirit","Light"],["Hate","Metal","Death"],"opponent","action");return n.opponent.hand=[x("Hate",2,!0)],n=V(n,"opponent",0,x("Fire",5,!0)),n=V(n,"opponent",1,x("Metal",4,!0)),n=V(n,"opponent",2,x("Death",3,!0)),n=V(n,"player",0,x("Water",2,!0)),n=V(n,"player",1,x("Spirit",5,!0)),n=V(n,"player",2,x("Light",1,!0)),n=xe(n),Ne(n)}},QC={name:"Chaos-3 Protocol-Free Playing",description:"Player with Chaos-3 can play any card face-up in any lane",setup:a=>{let n=ke(a,["Chaos","Fire","Water"],["Spirit","Death","Metal"],"player","action");return n=V(n,"player",0,x("Chaos",3,!0)),n.player.hand=[x("Gravity",2,!0),x("Hate",3,!0),x("Love",1,!0)],n=xe(n),Ne(n)}},XC={name:"Frost-3 Blocks Shifts (Covered)",description:"Frost-3 should prevent shifts even when covered (Top-Box effect always active)",setup:a=>{let n=ke(a,["Gravity","Water","Fire"],["Frost","Metal","Death"],"player","action");return n=V(n,"opponent",0,x("Frost",3,!0)),n=V(n,"opponent",0,x("Metal",2,!1)),n=V(n,"player",1,x("Water",2,!0)),n.player.hand=[x("Gravity",1,!0),x("Fire",2,!0)],n=xe(n),Ne(n)}},ZC={name:"Water-0 Softlock Bug Fix",description:"Water-0 self-flip should be cancelled when card becomes covered before self-flip executes",setup:a=>{let n=ke(a,["Water","Darkness","Light"],["Apathy","Fire","Death"],"player","action");return n=V(n,"player",1,x("Darkness",3,!1)),n.player.hand=[x("Water",0,!0),x("Darkness",2,!0),x("Fire",1,!0)],n=xe(n),Ne(n)}},KC={name:"Darkness-1 Flip and Shift Chain",description:"Darkness-1 should flip opponent card, then allow shifting that same card",setup:a=>{let n=ke(a,["Darkness","Water","Fire"],["Metal","Fire","Death"],"player","action");return n=V(n,"opponent",0,x("Metal",2,!1)),n=V(n,"opponent",1,x("Fire",1,!0)),n=V(n,"opponent",2,x("Hate",0,!1)),n.player.hand=[x("Darkness",1,!0),x("Water",2,!0),x("Fire",3,!0)],n=xe(n),Ne(n)}},JC={name:"Darkness-1 Flips Speed-3 - Middle Effect Execution",description:"When Darkness-1 flips Speed-3, Speed-3's middle effect (shift) should execute before Darkness-1's shift",setup:a=>{let n=ke(a,["Darkness","Water","Fire"],["Speed","Fire","Metal"],"player","action");return n=V(n,"opponent",0,x("Speed",3,!1)),n=V(n,"opponent",1,x("Fire",1,!0)),n=V(n,"opponent",2,x("Metal",2,!0)),n.player.hand=[x("Darkness",1,!0),x("Water",2,!0),x("Fire",3,!0)],n=xe(n),Ne(n)}},eb={name:"Darkness-1 Flips Speed-3 - Middle Effect Execution",description:"When Darkness-1 flips Speed-3, Speed-3's middle effect (shift) should execute before Darkness-1's shift",setup:a=>{let n=ke(a,["Darkness","Water","Fire"],["Speed","Fire","Metal"],"player","action");return n=V(n,"opponent",0,x("Speed",3,!1)),n=V(n,"opponent",1,x("Fire",1,!0)),n=V(n,"opponent",2,x("Metal",2,!0)),n.player.hand=[x("Darkness",1,!0),x("Water",2,!0),x("Fire",3,!0)],n=xe(n),Ne(n)}},iy={name:"Fire-1 & Fire-2 Conditional Test",description:" Fire-1 (discard -> delete) & Fire-2 (discard -> return) if_executed logic",setup:a=>{let n=ke(a,["Fire","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[x("Fire",1,!0),x("Fire",2,!0),x("Fire",0,!0),x("Fire",3,!0),x("Fire",4,!0),x("Fire",5,!0)],n=V(n,"opponent",0,x("Metal",3,!0)),n=V(n,"opponent",1,x("Death",4,!0)),n=V(n,"opponent",2,x("Fire",2,!0)),n=V(n,"opponent",0,x("Metal",1,!0)),n=V(n,"player",2,x("Spirit",3,!0)),n=V(n,"player",1,x("Water",3,!0)),n=V(n,"player",2,x("Spirit",2,!0)),n=xe(n),Ne(n)}},cy={name:"Anarchy Test Playground",description:" All Anarchy cards on hand for testing",setup:a=>{let n=ke(a,["Anarchy","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[x("Anarchy",0,!0),x("Anarchy",1,!0),x("Anarchy",2,!0),x("Anarchy",3,!0),x("Anarchy",5,!0),x("Anarchy",6,!0)],n=V(n,"opponent",0,x("Metal",3,!0)),n=V(n,"opponent",1,x("Death",4,!1)),n=V(n,"opponent",2,x("Fire",2,!0)),n=V(n,"opponent",0,x("Metal",1,!0)),n=V(n,"player",2,x("Spirit",3,!0)),n=V(n,"player",1,x("Water",3,!0)),n=V(n,"player",2,x("Spirit",2,!0)),n=xe(n),Ne(n)}},dy={name:"Darkness Test Playground",description:" All Darkness cards on hand for testing",setup:a=>{let n=ke(a,["Darkness","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[x("Darkness",0,!0),x("Darkness",1,!0),x("Darkness",2,!0),x("Darkness",3,!0),x("Darkness",4,!0),x("Darkness",5,!0)],n=V(n,"opponent",0,x("Metal",3,!1)),n=V(n,"opponent",1,x("Death",4,!0)),n=V(n,"opponent",2,x("Fire",2,!1)),n=V(n,"opponent",0,x("Metal",1,!0)),n=V(n,"opponent",1,x("Death",2,!1)),n=V(n,"player",2,x("Spirit",3,!0)),n=V(n,"player",1,x("Water",3,!0)),n=V(n,"player",2,x("Spirit",2,!0)),n=xe(n),Ne(n)}},uy={name:"Apathy Test Playground",description:" All Apathy cards on hand for testing",setup:a=>{let n=ke(a,["Apathy","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[x("Apathy",0,!0),x("Apathy",1,!0),x("Apathy",2,!0),x("Apathy",3,!0),x("Apathy",4,!0),x("Apathy",5,!0)],n=V(n,"opponent",0,x("Metal",3,!0)),n=V(n,"opponent",1,x("Death",4,!0)),n=V(n,"opponent",2,x("Fire",2,!0)),n=V(n,"opponent",0,x("Metal",1,!0)),n=V(n,"opponent",2,x("Fire",1,!1)),n=V(n,"player",2,x("Spirit",3,!0)),n=V(n,"player",1,x("Water",3,!0)),n=V(n,"player",2,x("Spirit",2,!0)),n=xe(n),Ne(n)}},py={name:"Death Test Playground",description:" All Death cards on hand for testing",setup:a=>{let n=ke(a,["Death_cust","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[x("Death_cust",0,!0),x("Death_cust",1,!0),x("Death_cust",2,!0),x("Death_cust",3,!0),x("Death_cust",4,!0),x("Death_cust",5,!0)],n=V(n,"opponent",0,x("Metal",0,!0)),n=V(n,"opponent",1,x("Death",1,!0)),n=V(n,"opponent",2,x("Fire",3,!0)),n=V(n,"opponent",0,x("Metal",2,!0)),n=V(n,"opponent",1,x("Death",4,!1)),n=V(n,"player",2,x("Spirit",3,!0)),n=V(n,"player",1,x("Water",3,!0)),n=V(n,"player",2,x("Spirit",2,!0)),n=xe(n),Ne(n)}},fy={name:"Water Test Playground",description:" All Water cards on hand for testing - wash away and renew",setup:a=>{let n=ke(a,["Water","Fire","Spirit"],["Metal","Death","Light"],"player","action");return n.player.hand=[x("Water",0,!0),x("Water",1,!0),x("Water",2,!0),x("Water",3,!0),x("Water",4,!0),x("Water",5,!0)],n=V(n,"opponent",0,x("Metal",2,!0)),n=V(n,"opponent",1,x("Death",3,!0)),n=V(n,"opponent",2,x("Light",2,!0)),n=V(n,"opponent",0,x("Metal",4,!0)),n=V(n,"opponent",1,x("Death",2,!1)),n=V(n,"opponent",2,x("Light",5,!1)),n=V(n,"player",1,x("Fire",2,!0)),n=V(n,"player",2,x("Spirit",3,!0)),n=V(n,"player",1,x("Fire",4,!0)),n=V(n,"player",2,x("Spirit",5,!1)),n=xe(n),Ne(n)}},hy={name:"Spirit Test Playground",description:" All Spirit cards on hand - true strength from within",setup:a=>{let n=ke(a,["Spirit","Fire","Water"],["Metal","Death","Light"],"player","action");return n.player.hand=[x("Spirit",0,!0),x("Spirit",1,!0),x("Spirit",2,!0),x("Spirit",3,!0),x("Spirit",4,!0),x("Spirit",5,!0)],n=V(n,"opponent",0,x("Metal",3,!0)),n=V(n,"opponent",1,x("Death",2,!1)),n=V(n,"opponent",2,x("Light",4,!0)),n=V(n,"opponent",0,x("Metal",5,!1)),n=V(n,"opponent",2,x("Light",3,!0)),n=V(n,"player",1,x("Fire",2,!0)),n=V(n,"player",2,x("Water",4,!0)),n=V(n,"player",1,x("Fire",3,!1)),n=xe(n),Ne(n)}},my={name:"Chaos Test Playground",description:" All Chaos cards on hand - embrace the unpredictable",setup:a=>{let n=ke(a,["Chaos","Fire","Water"],["Metal","Death","Light"],"player","action");return n.player.hand=[x("Chaos",0,!0),x("Chaos",1,!0),x("Chaos",2,!0),x("Chaos",3,!0),x("Chaos",4,!0),x("Chaos",5,!0)],n=V(n,"opponent",0,x("Metal",2,!0)),n=V(n,"opponent",0,x("Metal",4,!0)),n=V(n,"opponent",1,x("Death",3,!1)),n=V(n,"opponent",1,x("Death",5,!0)),n=V(n,"opponent",2,x("Light",1,!0)),n=V(n,"opponent",2,x("Light",3,!1)),n=V(n,"player",0,x("Fire",2,!0)),n=V(n,"player",0,x("Fire",4,!0)),n=V(n,"player",1,x("Water",3,!1)),n=V(n,"player",1,x("Water",5,!0)),n=V(n,"player",2,x("Fire",1,!0)),n=xe(n),Ne(n)}},yy={name:"Gravity Test Playground",description:" All Gravity cards on hand - pull everything together",setup:a=>{let n=ke(a,["Fire","Gravity","Water"],["Metal","Death","Light"],"player","action");return n.player.hand=[x("Gravity",0,!0),x("Gravity",1,!0),x("Gravity",2,!0),x("Gravity",4,!0),x("Gravity",5,!0),x("Gravity",6,!0)],n=V(n,"player",0,x("Fire",1,!0)),n=V(n,"player",2,x("Water",2,!1)),n=V(n,"opponent",0,x("Metal",3,!1)),n=V(n,"opponent",0,x("Metal",4,!0)),n=V(n,"opponent",1,x("Death",2,!1)),n=V(n,"opponent",1,x("Death",3,!0)),n=V(n,"opponent",2,x("Light",4,!1)),n.opponent.deck=[x("Metal",5,!0),x("Death",4,!0),x("Light",5,!0)],n=xe(n),Ne(n)}},gy={name:"Frost Test Playground",description:" All Frost cards on hand - pull everything together",setup:a=>{let n=ke(a,["Fire","Frost","Water"],["Metal","Death","Light"],"player","action");return n.player.hand=[x("Frost",0,!0),x("Frost",1,!0),x("Frost",2,!0),x("Frost",3,!0),x("Frost",4,!0),x("Frost",5,!0)],n=V(n,"player",0,x("Fire",1,!0)),n=V(n,"player",2,x("Water",2,!1)),n=V(n,"opponent",0,x("Metal",3,!1)),n=V(n,"opponent",0,x("Metal",4,!0)),n=V(n,"opponent",1,x("Death",2,!1)),n=V(n,"opponent",1,x("Death",3,!0)),n=V(n,"opponent",2,x("Light",4,!1)),n.opponent.deck=[x("Metal",5,!0),x("Death",4,!0),x("Light",5,!0)],n=xe(n),Ne(n)}},vy={name:"Hate Test Playground",description:" All Hate cards on hand - test deletion mechanics",setup:a=>{let n=ke(a,["Hate","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[x("Hate",0,!0),x("Hate",1,!0),x("Hate",2,!0),x("Hate",3,!0),x("Hate",4,!0),x("Hate",5,!0)],n=V(n,"player",1,x("Water",1,!0)),n=V(n,"player",1,x("Water",2,!0)),n=V(n,"player",1,x("Water",3,!0)),n=V(n,"player",2,x("Spirit",2,!0)),n=V(n,"player",2,x("Spirit",4,!1)),n=V(n,"opponent",0,x("Metal",5,!0)),n=V(n,"opponent",1,x("Death",2,!0)),n=V(n,"opponent",1,x("Death",4,!0)),n=V(n,"opponent",2,x("Fire",3,!1)),n.player.deck=[x("Water",0,!0),x("Water",4,!0),x("Spirit",0,!0),x("Spirit",5,!0)],n.opponent.deck=[x("Metal",3,!0),x("Death",5,!0),x("Fire",1,!0)],n=xe(n),Ne(n)}},_y={name:"Life Test Playground",description:" All Life cards on hand - test play and flip mechanics",setup:a=>{let n=ke(a,["Life","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[x("Life",0,!0),x("Life",1,!0),x("Life",2,!0),x("Life",3,!0),x("Life",4,!0),x("Life",5,!0)],n=V(n,"player",1,x("Water",1,!0)),n=V(n,"player",1,x("Water",2,!0)),n=V(n,"player",1,x("Water",3,!0)),n=V(n,"player",2,x("Spirit",2,!0)),n=V(n,"player",2,x("Spirit",4,!1)),n=V(n,"opponent",0,x("Metal",3,!1)),n=V(n,"opponent",1,x("Death",2,!0)),n=V(n,"opponent",1,x("Death",4,!1)),n=V(n,"opponent",2,x("Fire",5,!1)),n.player.deck=[x("Water",0,!0),x("Water",3,!0),x("Water",4,!0),x("Spirit",0,!0),x("Spirit",1,!0),x("Spirit",2,!0),x("Spirit",3,!0),x("Spirit",4,!0)],n.opponent.deck=[x("Metal",1,!0),x("Death",3,!0),x("Fire",2,!0)],n=xe(n),Ne(n)}},xy={name:"Light Test Playground",description:" All Light cards on hand - burn away the dark",setup:a=>{let n=ke(a,["Light","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[x("Light",0,!0),x("Light",1,!0),x("Light",2,!0),x("Light",3,!0),x("Light",4,!0),x("Light",5,!0)],n=V(n,"opponent",0,x("Fire",3,!1)),n=V(n,"opponent",1,x("Metal",4,!1)),n=V(n,"opponent",2,x("Death",5,!0)),n=V(n,"player",1,x("Water",2,!1)),n=V(n,"player",1,x("Water",3,!1)),n=V(n,"player",1,x("Water",4,!1)),n=V(n,"player",0,x("Spirit",1,!0)),n=V(n,"player",0,x("Spirit",2,!1)),n=V(n,"player",2,x("Spirit",5,!1)),n.player.deck=[x("Water",0,!0),x("Water",1,!0),x("Spirit",0,!0),x("Spirit",3,!0),x("Spirit",4,!0)],n.opponent.hand=[x("Metal",1,!0),x("Death",2,!0),x("Fire",3,!0),x("Metal",0,!0)],n=xe(n),Ne(n)}},wy={name:"Death-2 Uncover Interrupt - Turn Wechsel Test",description:"Death-2 lscht  Darkness-4 uncovered  Opponent shiftet  Turn muss zu Opponent wechseln",setup:a=>{let n=ke(a,["Death","Fire","Hate"],["Water","Darkness","Spirit"],"player","action");return n.player.hand=[x("Death",2,!0),x("Fire",1,!0),x("Hate",1,!0)],n=V(n,"player",0,x("Fire",0,!1)),n=V(n,"opponent",1,x("Darkness",4,!0)),n=V(n,"opponent",1,x("Darkness",1,!0)),n=V(n,"opponent",0,x("Water",0,!1)),n.opponent.hand=[x("Water",1,!0),x("Spirit",1,!0)],n=xe(n),Ne(n)}},Cy={name:"Apathy-5 Uncover - darf nur einmal triggern",description:"Hate-0 lscht Apathy-0  Apathy-5 uncovered  darf nur 1x triggern",setup:a=>{let n=ke(a,["Hate","Fire","Death"],["Apathy","Darkness","Plague"],"player","action");return n.player.hand=[x("Hate",0,!0),x("Fire",2,!0),x("Death",2,!0)],n=V(n,"opponent",0,x("Apathy",5,!0)),n=V(n,"opponent",0,x("Apathy",4,!0)),n.opponent.hand=[x("Darkness",1,!0),x("Apathy",1,!0),x("Darkness",2,!0)],n=xe(n),Ne(n)}},by={name:"Psychic-1 facedown flip darkness 2 test",description:"Psychic-1 facedown, darkness-2 flippt Karte nur noch facedown bug",setup:a=>{let n=ke(a,["Frost","Gravity","Plague"],["Psychic","Darkness","Speed"],"player","action");return n.player.hand=[x("Darkness",1,!0),x("Darkness",2,!0),x("Speed",3,!0)],n=V(n,"opponent",0,x("Frost",0,!1)),n=V(n,"opponent",1,x("Gravity",6,!1)),n=V(n,"player",0,x("Psychic",4,!1)),n=V(n,"player",1,x("Psychic",1,!1)),n.opponent.hand=[x("Gravity",1,!0)],n=xe(n),Ne(n)}},Sy={name:"Speed Test Playground",description:" All Speed cards on hand - swift and adaptive",setup:a=>{let n=ke(a,["Speed","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[x("Speed",0,!0),x("Speed",1,!0),x("Speed",2,!0),x("Speed",3,!0),x("Speed",4,!0),x("Speed",5,!0)],n=V(n,"player",0,x("Water",2,!0)),n=V(n,"player",1,x("Spirit",3,!0)),n=V(n,"opponent",0,x("Metal",3,!1)),n=V(n,"opponent",1,x("Death",4,!1)),n=V(n,"opponent",2,x("Fire",2,!0)),n=V(n,"player",2,x("Spirit",5,!0)),n=V(n,"player",2,x("Spirit",4,!0)),n=xe(n),Ne(n)}},jy={name:"Metal Test Playground",description:" All Metal cards on hand - unyielding defense",setup:a=>{let n=ke(a,["Metal","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[x("Metal",0,!0),x("Metal",1,!0),x("Metal",2,!0),x("Metal",3,!0),x("Metal",5,!0),x("Metal",6,!0)],n=V(n,"opponent",0,x("Metal",3,!1)),n=V(n,"opponent",1,x("Death",4,!0)),n=V(n,"player",1,x("Water",3,!0)),n=V(n,"opponent",2,x("Fire",0,!0)),n=V(n,"opponent",2,x("Fire",1,!0)),n=V(n,"opponent",2,x("Fire",2,!0)),n=V(n,"opponent",2,x("Fire",3,!0)),n=V(n,"opponent",2,x("Fire",4,!0)),n=V(n,"opponent",2,x("Fire",5,!0)),n=V(n,"player",2,x("Spirit",3,!0)),n=V(n,"player",2,x("Spirit",2,!0)),n=xe(n),Ne(n)}},Ey={name:"Plague Test Playground",description:" All Plague cards on hand - spread suffering",setup:a=>{let n=ke(a,["Plague","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[x("Plague",0,!0),x("Plague",1,!0),x("Plague",2,!0),x("Plague",3,!0),x("Plague",4,!0),x("Plague",5,!0)],n.opponent.hand=[x("Fire",2,!0),x("Death",3,!0),x("Water",1,!0)],n.player.lanes[0]=[x("Spirit",2,!0)],n.player.lanes[1]=[],n.player.lanes[2]=[],n.opponent.lanes[0]=[x("Metal",1,!0)],n.opponent.lanes[1]=[x("Death",2,!1)],n.opponent.lanes[2]=[x("Fire",3,!0)],n=xe(n),Ne(n)}},ky={name:"Love Test Playground",description:" All Love cards on hand - share the love",setup:a=>{let n=ke(a,["Love","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[x("Love",1,!0),x("Love",2,!0),x("Love",3,!0),x("Love",4,!0),x("Love",5,!0),x("Love",6,!0)],n.opponent.hand=[x("Fire",2,!0),x("Death",3,!0),x("Water",1,!0),x("Metal",4,!0)],n.player.lanes[0]=[x("Spirit",2,!0)],n.player.lanes[1]=[],n.player.lanes[2]=[],n.opponent.lanes[0]=[x("Metal",1,!0)],n.opponent.lanes[1]=[x("Death",2,!1)],n.opponent.lanes[2]=[x("Fire",3,!0)],n=xe(n),Ne(n)}},Ny={name:"Psychic Test Playground",description:" All Psychic cards on hand - read minds and control",setup:a=>{let n=ke(a,["Psychic","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[x("Psychic",0,!0),x("Psychic",1,!0),x("Psychic",2,!0),x("Psychic",3,!0),x("Psychic",4,!0),x("Psychic",5,!0)],n.opponent.hand=[x("Fire",2,!0),x("Death",3,!0),x("Water",1,!0),x("Metal",4,!0)],n.player.lanes[0]=[x("Spirit",2,!0)],n.player.lanes[1]=[],n.player.lanes[2]=[],n.opponent.lanes[0]=[x("Metal",1,!0)],n.opponent.lanes[1]=[x("Death",2,!1)],n.opponent.lanes[2]=[x("Fire",3,!0)],n=xe(n),Ne(n)}},Ry={name:" Gravity-2 AI Single Card Bug",description:"AI spielt Gravity-2  Flip  Shift  Turn endet (NUR 1 Karte!)",setup:a=>{let n=ke(a,["Hate","Fire","Water"],["Gravity","Death","Metal"],"opponent","action");return n.opponent.hand=[x("Gravity",2,!0),x("Death",1,!0),x("Metal",3,!0)],n=V(n,"player",1,x("Hate",5,!0)),n=V(n,"player",1,x("Hate",4,!0)),n=V(n,"player",0,x("Fire",2,!0)),n=V(n,"player",2,x("Water",3,!0)),n=xe(n),Ne(n)}},Ay={name:"Speed-3 End-Effekt Softlock Test",description:"Speed-3 als einzige uncovered Karte sollte sich selbst im End-Effekt shiften knnen",setup:a=>{let n=ke(a,["Fire","Water","Death"],["Speed","Gravity","Light"],"opponent","end");return n.player.hand=[x("Fire",1,!0),x("Water",2,!0),x("Death",0,!0)],n=V(n,"player",0,x("Fire",3,!0)),n=V(n,"player",1,x("Water",1,!0)),n=V(n,"opponent",0,x("Speed",3,!0)),n.opponent.hand=[x("Gravity",1,!0),x("Light",2,!0)],n=xe(n),Ne(n)}},Dy={name:"Uncover nach Delete All in Lane Test",description:"Death-2 lscht alle 1/2er  Karte darunter wird uncovered  Effekt triggert",setup:a=>{let n=ke(a,["Death","Fire","Water"],["Fire","Spirit","Light"],"player","action");return n.player.hand=[x("Death",2,!0),x("Fire",3,!0),x("Water",4,!0)],n=V(n,"opponent",0,x("Fire",5,!0)),n=V(n,"opponent",0,x("Fire",2,!0)),n=V(n,"player",0,x("Fire",4,!0)),n=V(n,"player",1,x("Water",3,!0)),n=V(n,"opponent",1,x("Spirit",2,!0)),n=xe(n),Ne(n)}},Ty={name:"Mehrfach-Uncover nach Delete All Test",description:"Death-2 lscht bei beiden Spielern  beide Karten darunter werden uncovered",setup:a=>{let n=ke(a,["Death","Water","Spirit"],["Fire","Light","Gravity"],"player","action");return n.player.hand=[x("Death",2,!0),x("Spirit",3,!0)],n.opponent.hand=[x("Fire",3,!0),x("Light",5,!0)],n=V(n,"player",0,x("Water",5,!0)),n=V(n,"player",0,x("Water",1,!0)),n=V(n,"opponent",0,x("Fire",5,!0)),n=V(n,"opponent",0,x("Fire",2,!0)),n=xe(n),Ne(n)}},Fy={name:"Life-1 Uncover  Double Flip Bug",description:"Death-1 Start lscht  Life-1 uncovered  BEIDE Flips mssen ausgefhrt werden",setup:a=>{let n=ke(a,["Death","Fire","Water"],["Life","Metal","Spirit"],"player","start");return n.player.hand=[x("Fire",2,!0)],n.opponent.hand=[x("Metal",3,!0),x("Spirit",2,!0)],n=V(n,"player",0,x("Death",1,!0)),n=V(n,"opponent",0,x("Life",1,!0)),n=V(n,"opponent",0,x("Metal",0,!0)),n=V(n,"player",1,x("Water",1,!0)),n=V(n,"opponent",1,x("Metal",1,!0)),n=V(n,"opponent",2,x("Spirit",0,!0)),n=xe(n),Ne(n)}},qy={name:"Smoke Test Playground",description:" All Smoke cards on hand - shroud your cards in mystery",setup:a=>{let n=ke(a,["Smoke","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[x("Smoke",0,!0),x("Smoke",1,!0),x("Smoke",2,!0),x("Smoke",3,!0),x("Smoke",4,!0),x("Smoke",5,!0)],n=V(n,"player",0,x("Water",2,!1)),n=V(n,"opponent",1,x("Metal",3,!1)),n=V(n,"opponent",1,x("Death",2,!0)),n=V(n,"opponent",2,x("Fire",2,!0)),n=V(n,"player",2,x("Spirit",3,!0)),n=V(n,"player",1,x("Spirit",4,!0)),n=xe(n),Ne(n)}},$y={name:"Smoke AI Test",description:" AI spielt Smoke Karten - test all Smoke card effects with AI",setup:a=>{let n=ke(a,["Water","Spirit","Light"],["Smoke","Metal","Death"],"opponent","action");return n.opponent.hand=[x("Smoke",0,!0),x("Smoke",1,!0),x("Smoke",2,!0),x("Smoke",3,!0),x("Smoke",4,!0),x("Smoke",5,!0)],n=V(n,"opponent",0,x("Metal",2,!1)),n=V(n,"player",0,x("Water",3,!0)),n=V(n,"player",1,x("Spirit",2,!1)),n=V(n,"player",1,x("Spirit",4,!0)),n=V(n,"opponent",2,x("Death",3,!0)),n=V(n,"player",2,x("Light",2,!0)),n=V(n,"opponent",1,x("Metal",4,!0)),n=xe(n),Ne(n)}},Uy={name:"Clarity Test Playground",description:"All Clarity cards on hand - see through the fog of war",setup:a=>{let n=ke(a,["Clarity","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[x("Clarity",0,!0),x("Clarity",1,!0),x("Clarity",2,!0),x("Clarity",3,!0),x("Clarity",4,!0),x("Clarity",5,!0)],n.player.deck=[x("Clarity",1,!0),x("Water",1,!0),x("Spirit",5,!0),x("Spirit",3,!0),x("Water",2,!0),x("Fire",4,!0)],n.player.discard=[x("Water",4,!0),x("Spirit",1,!0)],n=V(n,"player",0,x("Water",2,!0)),n.opponent.hand=[x("Metal",3,!0),x("Death",2,!0),x("Fire",4,!0)],n=V(n,"opponent",1,x("Metal",3,!0)),n=V(n,"opponent",2,x("Fire",2,!0)),n=xe(n),Ne(n)}},Oy={name:"Clarity AI Test",description:"AI spielt Clarity Karten - test all Clarity card effects with AI",setup:a=>{let n=ke(a,["Water","Spirit","Light"],["Clarity","Metal","Death"],"opponent","action");return n.opponent.hand=[x("Clarity",0,!0),x("Clarity",1,!0),x("Clarity",2,!0),x("Clarity",3,!0),x("Clarity",4,!0),x("Clarity",5,!0)],n.opponent.deck=[x("Clarity",1,!0),x("Metal",1,!0),x("Death",5,!0),x("Death",3,!0),x("Metal",2,!0)],n.opponent.discard=[x("Metal",4,!0),x("Death",2,!0)],n.player.hand=[x("Water",3,!0),x("Spirit",2,!0),x("Light",4,!0)],n=V(n,"player",0,x("Water",3,!0)),n=V(n,"opponent",0,x("Metal",2,!0)),n=V(n,"player",1,x("Spirit",4,!0)),n=V(n,"opponent",2,x("Death",3,!0)),n=xe(n),Ne(n)}},Iy={name:"Courage Custom Playground",description:"Test all Courage effects: empty hand draw, opponent higher value delete, conditional draw/flip, highest value shift",setup:a=>{let i=ke(a,["Courage","Fire","Speed"],["Spirit","Water","Darkness"],"player","action");return i.player.hand=[x("Courage",0,!0),x("Courage",1,!0),x("Courage",2,!0),x("Courage",3,!0),x("Courage",5,!0),x("Courage",6,!0)],i=V(i,"opponent",0,x("Spirit",3,!0)),i=V(i,"opponent",0,x("Spirit",5,!0)),i=V(i,"player",0,x("Fire",3,!0)),i=V(i,"opponent",1,x("Water",6,!0)),i=V(i,"player",1,x("Speed",4,!0)),i=V(i,"opponent",2,x("Darkness",2,!0)),i=V(i,"player",2,x("Fire",5,!0)),Ne(i)}},Py={name:"Courage AI Test",description:"Test AI with Courage protocol: lane-restricted delete, self-shift to highest value lane",setup:a=>{let i=ke(a,["Spirit","Water","Fire"],["Courage","Speed","Darkness"],"opponent","action");return i.opponent.hand=[x("Courage",0,!0),x("Courage",1,!0),x("Courage",2,!0),x("Courage",3,!0),x("Courage",5,!0),x("Courage",6,!0)],i=V(i,"player",0,x("Spirit",5,!0)),i=V(i,"player",0,x("Spirit",5,!0)),i=V(i,"opponent",0,x("Speed",3,!0)),i=V(i,"player",1,x("Water",6,!0)),i=V(i,"opponent",1,x("Darkness",2,!0)),i=V(i,"opponent",1,x("Darkness",2,!1)),i=V(i,"player",2,x("Fire",3,!0)),i=V(i,"opponent",2,x("Speed",5,!0)),Ne(i)}},Ly={name:"Corruption Test Playground",description:" All Corruption cards on hand - corrupt your opponent's plans",setup:a=>{let n=ke(a,["Corruption","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[x("Corruption",0,!0),x("Corruption",1,!0),x("Corruption",2,!0),x("Corruption",3,!0),x("Corruption",5,!0),x("Corruption",6,!0)],n=V(n,"player",0,x("Water",2,!0)),n=V(n,"opponent",0,x("Metal",3,!0)),n=V(n,"opponent",1,x("Death",4,!0)),n=V(n,"opponent",2,x("Fire",2,!0)),n=V(n,"player",1,x("Spirit",3,!0)),n=V(n,"player",1,x("Spirit",5,!0)),n.opponent.hand=[x("Fire",3,!0),x("Metal",4,!0),x("Death",5,!0)],n=xe(n),Ne(n)}},My={name:"Fear Custom Playground",description:"Test all Fear effects: passive ignore middle, choice shift/flip, chain discard, return, random discard",setup:a=>{let i=ke(a,["Fear","Fire","Speed"],["Spirit","Water","Darkness"],"player","action");return i.player.hand=[x("Fear",0,!0),x("Fear",1,!0),x("Fear",2,!0),x("Fear",3,!0),x("Fear",4,!0),x("Fear",5,!0)],i=V(i,"opponent",0,x("Spirit",2,!0)),i=V(i,"opponent",0,x("Spirit",3,!0)),i=V(i,"player",0,x("Fire",3,!0)),i=V(i,"opponent",1,x("Water",4,!0)),i=V(i,"player",1,x("Speed",4,!0)),i=V(i,"opponent",2,x("Darkness",2,!1)),i=V(i,"player",2,x("Fire",5,!0)),i.opponent.hand=[x("Spirit",1,!0),x("Water",2,!0),x("Darkness",3,!0),x("Spirit",4,!0)],Ne(i)}},Hy={name:"Fear AI Test",description:"Test AI with Fear protocol: random discard execution, passive rule handling",setup:a=>{let i=ke(a,["Spirit","Water","Fire"],["Fear","Speed","Darkness"],"opponent","action");return i.opponent.hand=[x("Fear",0,!0),x("Fear",1,!0),x("Fear",2,!0),x("Fear",3,!0),x("Fear",4,!0),x("Fear",5,!0)],i=V(i,"player",0,x("Spirit",3,!0)),i=V(i,"player",0,x("Spirit",5,!0)),i=V(i,"opponent",0,x("Speed",3,!0)),i=V(i,"player",1,x("Water",2,!0)),i=V(i,"player",1,x("Water",4,!0)),i=V(i,"player",2,x("Fire",3,!0)),i=V(i,"opponent",2,x("Darkness",5,!0)),i.player.hand=[x("Spirit",1,!0),x("Water",3,!0),x("Fire",4,!0)],Ne(i)}},zy={name:"Ice Custom Playground",description:" Test all Ice effects: conditional shift, flip block, draw block, lane-reactive discard",setup:a=>{let i=ke(a,["Ice","Fire","Speed"],["Spirit","Water","Darkness"],"player","action");return i.player.hand=[x("Ice",1,!0),x("Ice",2,!0),x("Ice",3,!0),x("Ice",4,!0),x("Ice",5,!0),x("Ice",6,!0),x("Fire",0,!0)],i=V(i,"player",0,x("Fire",3,!0)),i=V(i,"player",0,x("Fire",5,!0)),i=V(i,"opponent",1,x("Water",4,!0)),i=V(i,"player",1,x("Speed",4,!0)),i=V(i,"opponent",2,x("Darkness",2,!0)),i=V(i,"player",2,x("Fire",5,!0)),i.opponent.hand=[x("Spirit",1,!0),x("Water",2,!0),x("Darkness",3,!0)],Ne(i)}},Vy={name:"Ice AI Test",description:" Test AI with Ice protocol: shift self, shift others, passive rules",setup:a=>{let i=ke(a,["Spirit","Water","Fire"],["Ice","Speed","Darkness"],"opponent","action");return i.opponent.hand=[x("Ice",1,!0),x("Ice",2,!0),x("Ice",3,!0),x("Ice",4,!0),x("Ice",5,!0),x("Ice",6,!0)],i=V(i,"player",0,x("Spirit",3,!0)),i=V(i,"player",0,x("Spirit",5,!0)),i=V(i,"opponent",0,x("Speed",3,!0)),i=V(i,"opponent",1,x("Darkness",2,!0)),i=V(i,"opponent",1,x("Darkness",4,!0)),i=V(i,"player",1,x("Water",4,!0)),i=V(i,"player",2,x("Fire",3,!0)),i=V(i,"opponent",2,x("Speed",5,!0)),i.player.hand=[x("Spirit",1,!0),x("Water",3,!0),x("Fire",4,!0)],Ne(i)}},By={name:"End Phase Test",description:"Test the game rule for the end or start phase, only 1 trigger",setup:a=>{let i=ke(a,["Light","Fire","Speed"],["Spirit","Water","Darkness"],"player","action");return i.player.hand=[x("Light",5,!0),x("Fire",0,!0)],i=V(i,"player",0,x("Light",1,!0)),i=V(i,"player",0,x("Light",2,!0)),i=V(i,"player",1,x("Fire",3,!0)),i=V(i,"player",2,x("Speed",3,!0)),i.opponent.hand=[x("Spirit",1,!0),x("Water",2,!0),x("Darkness",3,!0)],Ne(i)}},Yy={name:"Start Phase Test",description:"Test the game rule for the end or start phase, only 1 trigger",setup:a=>{let i=ke(a,["Spirit","Death","Psychic"],["Light","Water","Darkness"],"player","action");return i.player.hand=[x("Spirit",5,!0),x("Death",0,!0)],i=V(i,"player",0,x("Spirit",1,!0)),i=V(i,"player",0,x("Spirit",2,!0)),i=V(i,"player",1,x("Death",1,!0)),i=V(i,"player",1,x("Spirit",3,!0)),i=V(i,"player",2,x("Psychic",1,!0)),i.opponent.hand=[x("Light",1,!0),x("Water",2,!0),x("Darkness",3,!0)],Ne(i)}},Gy={name:"Committed Card Test",description:"Committed Card Test",setup:a=>{let i=ke(a,["Spirit","Darkness","Psychic"],["Light","Water","Fire"],"player","action");return i.player.hand=[x("Darkness",0,!0),x("Death",0,!0)],i=V(i,"player",0,x("Spirit",0,!0)),i=V(i,"player",0,x("Spirit",3,!0)),i=V(i,"opponent",0,x("Light",1,!0)),i=V(i,"opponent",0,x("Light",2,!0)),i.opponent.hand=[x("Light",5,!0),x("Water",2,!0),x("Darkness",3,!0)],Ne(i)}},Wy={name:"Fear 0 prob Test",description:"Bla bla",setup:a=>{let i=ke(a,["Chaos","Fear","Psychic"],["Light","Water","Fire"],"player","action");return i.player.hand=[x("Chaos",2,!0),x("Fear",3,!0)],i=V(i,"player",1,x("Fear",2,!0)),i=V(i,"player",1,x("Fear",0,!0)),i=V(i,"opponent",1,x("Water",5,!0)),i=V(i,"opponent",2,x("Darkness",2,!1)),i.opponent.hand=[x("Light",5,!0),x("Water",2,!0),x("Darkness",3,!0)],Ne(i)}},Qy=[Mm,Hm,zm,Vm,Bm,Ym,Gm,Wm,Qm,Xm,Zm,Km,Jm,ey,ty,ny,ay,oy,ry,ly,sy,QC,XC,ZC,KC,JC,eb,iy,cy,dy,uy,py,fy,hy,my,yy,gy,vy,_y,xy,wy,Cy,by,Sy,jy,Ey,ky,Ny,Ry,Ay,Dy,Ty,Fy,qy,$y,Uy,Oy,Ly,Iy,Py,My,Hy,zy,Vy,By,Yy,Gy,Wy],tb=Object.freeze(Object.defineProperty({__proto__:null,allScenarios:Qy,scenario10_Hate1Interrupt:Wm,scenario11_Darkness1HateChain:Qm,scenario12_Water4TurnEnd:Xm,scenario13_Psychic3ShiftTest:Zm,scenario14_Death1UncoverTest:Km,scenario15_Gravity2ShiftInterrupt:Jm,scenario16_Hate2PlayerPlays:ey,scenario171_Hate2AIPlays:ny,scenario17_Hate2AIPlays:ty,scenario18_Hate2SelfDelete:ay,scenario19_Hate2MultipleTies:oy,scenario1_Psychic3Uncover:Mm,scenario20_Hate2FaceDown:ry,scenario21_Hate2AIValidation:ly,scenario22_Hate2AIPlaysOpen:sy,scenario29_FireCustomConditional:iy,scenario2_Psychic4EndEffect:Hm,scenario30_AnarchyCustomPlayground:cy,scenario31_DarkCustPlayground:dy,scenario32_ApathyCustomPlayground:uy,scenario33_DeathCustomPlayground:py,scenario34_WaterCustomPlayground:fy,scenario35_SpiritCustomPlayground:hy,scenario36_ChaosCustomPlayground:my,scenario37_GravityCustomPlayground:yy,scenario38_FrostCustomPlayground:gy,scenario39_HateCustomPlayground:vy,scenario3_Spirit3EndPhase:zm,scenario40_LifeCustomPlayground:_y,scenario41_LightCustomPlayground:xy,scenario42_Death2UncoverInterruptTurn:wy,scenario43_Apathy5DoubleUncover:Cy,scenario44_Psychic1Darkness2Test:by,scenario45_SpeedCustomPlayground:Sy,scenario46_MetalCustomPlayground:jy,scenario47_PlagueCustomPlayground:Ey,scenario48_LoveCustomPlayground:ky,scenario49_PsychicCustomPlayground:Ny,scenario4_Plague2Actor:Vm,scenario50_Gravity2SingleCardBug:Ry,scenario51_Speed3EndEffectSoftlock:Ay,scenario52_UncoverAfterBulkDelete:Dy,scenario53_MultiUncoverAfterBulkDelete:Ty,scenario54_Life1UncoverDoubleFlip:Fy,scenario55_SmokeCustomPlayground:qy,scenario56_SmokeAITest:$y,scenario57_ClarityCustomPlayground:Uy,scenario58_ClarityAITest:Oy,scenario59_CorruptionCustomPlayground:Ly,scenario5_Darkness1Interrupt:Bm,scenario60_CourageCustomPlayground:Iy,scenario61_CourageAITest:Py,scenario62_FearCustomPlayground:My,scenario63_FearAITest:Hy,scenario64_IceCustomPlayground:zy,scenario65_IceAITest:Vy,scenario66_endPhasePlayground:By,scenario67_startPhasePlayground:Yy,scenario68_CommittedCardPlayground:Gy,scenario69_fear0shiftCardPlayground:Wy,scenario8_Plague4Owner:Ym,scenario9_Water:Gm},Symbol.toStringTag,{value:"Module"})),nb=({onLoadScenario:a,onSkipCoinFlip:n,onForceWin:l,onForceLose:i})=>{const[c,d]=re.useState(!1);return c?o.jsxs("div",{style:{position:"fixed",top:"20px",left:"20px",width:"400px",maxHeight:"600px",backgroundColor:"#2c2c2c",border:"2px solid #ff6b6b",borderRadius:"8px",padding:"20px",zIndex:9999,overflowY:"auto",color:"white",fontFamily:"monospace"},children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"20px"},children:[o.jsx("h3",{style:{margin:0},children:" Debug Panel"}),o.jsx("button",{onClick:()=>d(!1),style:{backgroundColor:"transparent",border:"none",color:"white",cursor:"pointer",fontSize:"20px"},children:""})]}),o.jsx("div",{style:{marginBottom:"15px",fontSize:"12px",color:"#aaa"},children:"Lade vordefinierte Test-Szenarien zum Testen der Actor/Owner-Fixes."}),o.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:Qy.map((p,h)=>o.jsxs("div",{style:{backgroundColor:"#1a1a1a",padding:"12px",borderRadius:"5px",border:"1px solid #444"},children:[o.jsx("div",{style:{fontWeight:"bold",marginBottom:"5px",color:"#4ecdc4"},children:p.name}),o.jsx("div",{style:{fontSize:"11px",color:"#bbb",marginBottom:"10px"},children:p.description}),o.jsx("button",{onClick:()=>{n&&n(),a(p.setup),d(!1)},style:{padding:"6px 12px",backgroundColor:"#4ecdc4",color:"#1a1a1a",border:"none",borderRadius:"3px",cursor:"pointer",fontWeight:"bold",fontSize:"12px"},children:"Load Scenario"})]},h))}),(l||i)&&o.jsxs("div",{style:{marginTop:"20px",paddingTop:"15px",borderTop:"1px solid #444",display:"flex",gap:"10px",justifyContent:"center"},children:[l&&o.jsx("button",{onClick:()=>{l(),d(!1)},style:{padding:"10px 20px",backgroundColor:"#4ecdc4",color:"#1a1a1a",border:"none",borderRadius:"5px",cursor:"pointer",fontWeight:"bold",fontSize:"14px"},children:" Force Win"}),i&&o.jsx("button",{onClick:()=>{i(),d(!1)},style:{padding:"10px 20px",backgroundColor:"#ff6b6b",color:"white",border:"none",borderRadius:"5px",cursor:"pointer",fontWeight:"bold",fontSize:"14px"},children:" Force Lose"})]}),o.jsx("div",{style:{marginTop:"20px",fontSize:"11px",color:"#666",textAlign:"center"},children:"Drcke ESC oder klicke  zum Schlieen"})]}):o.jsx("button",{onClick:()=>d(!0),style:{position:"fixed",top:"20px",left:"20px",padding:"10px 20px",backgroundColor:"#ff6b6b",color:"white",border:"none",borderRadius:"5px",cursor:"pointer",fontWeight:"bold",zIndex:9999,fontSize:"14px"},children:" DEBUG"})},Gh=(a,n)=>{if(!n)return null;for(const l of["player","opponent"])for(const i of a[l].lanes){const c=i.find(d=>d.id===n);if(c)return{card:c,owner:l}}return null},ab=new Set(["discard","select_card_from_hand_to_play","select_card_from_hand_to_give","select_card_from_hand_to_reveal","plague_2_player_discard","select_cards_from_hand_to_discard_for_fire_4","select_cards_from_hand_to_discard_for_hate_1"]);function ob({onBack:a,onEndGame:n,playerProtocols:l,opponentProtocols:i,difficulty:c,useControlMechanic:d,startingPlayer:p="player"}){var $e,Te,Me,Je,ze,qe,at,Bt;const[h,f]=re.useState(null),[m,g]=re.useState(!0),{startGame:y,endGame:w,trackPlayerCoinFlip:_,trackPlayerRearrange:S}=WC(l,c,d),k=re.useCallback((fe,_e,je)=>{f(fe),g(!1),_(_e,je)},[_]),j=re.useCallback(()=>{f("player"),g(!1),y()},[y]);re.useEffect(()=>{!m&&h&&y()},[m,h,y]);const E=re.useCallback((fe,_e)=>{const je=_e.player.compiled.filter(Ge=>Ge).length;w(fe,_e.stats.player,je,_e.stats.opponent,_e.detailedGameStats),n(fe,_e)},[w,n]),{gameState:C,selectedCard:b,setSelectedCard:T,playSelectedCard:A,fillHand:H,discardCardFromHand:$,compileLane:B,resolveActionWithCard:X,resolveActionWithLane:I,selectHandCardForAction:F,resolveActionWithHandCard:N,skipAction:D,resolveOptionalDrawPrompt:P,resolveDeath1Prompt:L,resolveLove1Prompt:R,resolvePlague2Discard:O,resolvePlague4Flip:Z,resolveFire3Prompt:ee,resolveOptionalDiscardCustomPrompt:M,resolveOptionalEffectPrompt:G,resolveFire4Discard:K,resolveHate1Discard:W,resolveLight2Prompt:U,resolveRevealBoardCardPrompt:Q,resolveRearrangeProtocols:Y,resolveSpirit1Prompt:ce,resolveSpirit3Prompt:te,resolveSwapProtocols:ye,resolveSpeed3Prompt:Se,resolvePsychic4Prompt:ge,resolveControlMechanicPrompt:Fe,resolveCustomChoice:Le,resolveSelectRevealedDeckCard:Xe,setupTestScenario:nt}=F0(l,i,E,c,d,h??"player",S),[we,Ce]=re.useState(null),[Ie,He]=re.useState([]),[gt,Ye]=re.useState(!1),[qt,Zt]=re.useState([]),vn=re.useRef(C.log.length),[zn,sn]=re.useState(!1),[Rt,Vt]=re.useState(!1),[bt,Vn]=re.useState(null),[ga,ta]=re.useState(!1),[An,cn]=re.useState(0),At=re.useRef(null),Kt=re.useRef(C);re.useEffect(()=>{Kt.current=C},[C]);const _n=()=>{const fe=An+1;if(cn(fe),fe>=5){ta(_e=>!_e),cn(0),At.current&&(clearTimeout(At.current),At.current=null);return}At.current&&clearTimeout(At.current),At.current=setTimeout(()=>{cn(0),At.current=null},2e3)},va=re.useCallback(()=>{console.log("Debug: Forcing player win via DebugPanel."),E("player",C)},[E,C]),na=re.useCallback(()=>{console.log("Debug: Forcing player loss via DebugPanel."),E("opponent",C)},[E,C]),aa=re.useMemo(()=>{if(C.lastPlayedCardId){const fe=Gh(C,C.lastPlayedCardId);if(fe){const _e=fe.owner==="player"||fe.card.isFaceUp;return{card:fe.card,showContents:_e}}}return null},[C.lastPlayedCardId,C.player.lanes,C.opponent.lanes]),Bn=re.useMemo(()=>{var _e;const fe=(_e=C.actionRequired)==null?void 0:_e.sourceCardId;if(fe){const je=Gh(C,fe);if(je){const Ge=je.owner==="player"||je.card.isFaceUp;return{card:je.card,showContents:Ge}}}return null},[($e=C.actionRequired)==null?void 0:$e.sourceCardId,C.player.lanes,C.opponent.lanes]);re.useEffect(()=>{var fe;(fe=C.actionRequired)!=null&&fe.sourceCardId&&Ce(null)},[(Te=C.actionRequired)==null?void 0:Te.sourceCardId]);const dn=we||Bn||aa;re.useEffect(()=>{C.log.length>vn.current&&C.log.slice(vn.current).forEach(_e=>{if(_e.message!=="Game Started."){const je={message:_e.message,player:_e.player,id:Qe()};Zt(Ge=>[...Ge,je]),setTimeout(()=>{Zt(Ge=>Ge.filter(xt=>xt.id!==je.id))},5e3)}}),vn.current=C.log.length},[C.log]),re.useEffect(()=>{var _e,je,Ge,xt,nn;!(((_e=C.actionRequired)==null?void 0:_e.type)==="discard"&&((je=C.actionRequired)==null?void 0:je.variableCount))&&((Ge=C.actionRequired)==null?void 0:Ge.type)!=="plague_2_player_discard"&&((xt=C.actionRequired)==null?void 0:xt.type)!=="select_cards_from_hand_to_discard_for_fire_4"&&((nn=C.actionRequired)==null?void 0:nn.type)!=="select_cards_from_hand_to_discard_for_hate_1"&&He([])},[C.actionRequired]),re.useEffect(()=>{var fe,_e;sn(((fe=C.actionRequired)==null?void 0:fe.type)==="prompt_rearrange_protocols"&&C.actionRequired.actor==="player"),Vt(((_e=C.actionRequired)==null?void 0:_e.type)==="prompt_swap_protocols"&&C.actionRequired.actor==="player")},[C.actionRequired]),re.useEffect(()=>{const fe=_e=>{_e.ctrlKey&&_e.shiftKey&&(_e.preventDefault(),_e.key.toLowerCase()==="d"?(console.log("Debug: Toggling debug button visibility."),ta(je=>!je)):_e.key.toLowerCase()==="w"?(console.log("Debug: Forcing player win."),n("player",C)):_e.key.toLowerCase()==="o"?(console.log("Debug: Forcing opponent win."),n("opponent",C)):_e.key.toLowerCase()==="p"?(console.log("Debug: Setting up Speed-0 interrupt scenario."),nt("speed-0-interrupt")):_e.key.toLowerCase()==="l"?(console.log("Debug: Setting up Speed-1 discard trigger scenario."),nt("speed-1-trigger")):_e.key.toLowerCase()==="f"?(console.log("Debug: Setting up Fire On-Cover test scenario."),nt("fire-oncover-test")):_e.key.toLowerCase()==="s"?(console.log("Debug: Setting up Speed-2 + Control test scenario."),nt("speed-2-control-test")):_e.key.toLowerCase()==="u"&&(console.log("Debug: Setting up Death-1 Uncover test scenario."),A_(()=>Promise.resolve().then(()=>tb),void 0).then(je=>{nt(je.scenario14_Death1UncoverTest.setup)})))};return window.addEventListener("keydown",fe),()=>{window.removeEventListener("keydown",fe)}},[C,n,nt]);const Yn=(fe,_e)=>{const je=Kt.current;if(je.animationState)return;const{actionRequired:Ge,turn:xt,phase:nn,compilableLanes:ia,player:an,opponent:Dn}=je;if(_e==="player"&&xt==="player"&&nn==="compile"&&ia.includes(fe)){if(Ge){console.warn("Compile click blocked by pending action:",Ge);return}B(fe);return}if(Ge&&Ge.actor==="player"&&["select_lane_for_shift","select_lane_for_shift_all","shift_flipped_card_optional","select_lane_for_play","select_lane_for_delete","select_lane_for_death_2","select_lane_for_life_3_play","select_lane_to_shift_revealed_card_for_light_2","select_lane_to_shift_revealed_board_card_custom","select_lane_to_shift_cards_for_light_3","select_lane_for_water_3","select_lane_for_metal_3_delete","select_lane_for_delete_all","select_lane_for_return"].includes(Ge.type)){I(fe);return}const Tn=Dn.lanes.flat().some(Lt=>Lt.isFaceUp&&Lt.protocol==="Psychic"&&Lt.value===1),on=Dn.lanes[fe],un=on.length>0&&on[on.length-1].isFaceUp&&on[on.length-1].protocol==="Plague"&&on[on.length-1].value===0;if(b&&nn==="action"&&!Ge&&an.hand.some(Lt=>Lt.id===b)&&!un){const Lt=an.hand.find(Ot=>Ot.id===b);if(_e==="opponent"){if(!Wl(je,Lt)){T(null),Ce(null);return}if(Tn){T(null),Ce(null);return}A(fe,!0,"opponent"),Ce(null);return}const Qn=an.lanes.flat().some(Ot=>Ot.isFaceUp&&Ot.protocol==="Spirit"&&Ot.value===1),Ma=an.lanes.some((Ot,za)=>{if(Ot.length===0)return!1;const _a=Ot[Ot.length-1];return _a.isFaceUp&&_a.protocol==="Chaos"&&_a.value===3}),Ha=[...an.lanes.flat(),...Dn.lanes.flat()].some(Ot=>Ot.isFaceUp&&Ot.protocol==="Anarchy"&&Ot.value===1),Zo=vi(je),So=_i(je,"player",fe),Yt=Wl(je,Lt);let ca;Yt?ca=!Tn:Ha||Zo?ca=Lt.protocol!==an.protocols[fe]&&Lt.protocol!==Dn.protocols[fe]&&!Tn:ca=(Qn||So||Ma||Lt.protocol===an.protocols[fe]||Lt.protocol===Dn.protocols[fe])&&!Tn,A(fe,ca),Ce(null);return}b&&(T(null),Ce(null))},oa=fe=>{const _e=Kt.current;if(_e.animationState||!b)return;const{phase:je,actionRequired:Ge,player:xt}=_e;je!=="action"||Ge||!xt.hand.some(nn=>nn.id===b)||(A(fe,!1),Ce(null))},ra=fe=>{const _e=Kt.current;if(!_e.animationState){if(_e.actionRequired){if(_e.actionRequired.type==="discard"&&_e.actionRequired.actor==="player")if(_e.actionRequired.variableCount){He(je=>je.includes(fe.id)?je.filter(Ge=>Ge!==fe.id):[...je,fe.id]);return}else{$(fe.id);return}if(_e.actionRequired.type==="select_card_from_hand_to_play"){F(fe.id);return}if(_e.actionRequired.type==="select_card_from_hand_to_give"||_e.actionRequired.type==="select_card_from_hand_to_reveal"){N(fe.id);return}if(_e.actionRequired.type==="plague_2_player_discard"||_e.actionRequired.type==="select_cards_from_hand_to_discard_for_fire_4"||_e.actionRequired.type==="select_cards_from_hand_to_discard_for_hate_1"){He(je=>je.includes(fe.id)?je.filter(Ge=>Ge!==fe.id):[...je,fe.id]);return}return}_e.turn!=="player"||_e.phase!=="action"&&_e.phase!=="compile"||(fe.id===b?(T(null),Ce(null)):(T(fe.id),Ce({card:fe,showContents:!0})))}},Gn=(fe,_e,je)=>{const Ge=Kt.current;if(Ge.animationState)return;const{actionRequired:xt,turn:nn,phase:ia,compilableLanes:an}=Ge;if(nn==="player"&&ia==="compile"&&an.includes(je)){Yn(je,_e);return}if(nn==="player"&&!xt&&b&&ia==="action"){Yn(je,_e);return}if(xt&&xt.actor==="player"&&(xt.type==="select_own_highest_card_to_delete_for_hate_2"||xt.type==="select_opponent_highest_card_to_delete_for_hate_2")&&yi(fe,Ge)){X(fe.id);return}if(yi(fe,Ge))X(fe.id);else if(b)T(null),Ce(null);else{const Dn=_e==="player"||fe.isFaceUp;Ce({card:fe,showContents:Dn})}},Wn=fe=>{b||Ce({card:fe,showContents:!0})},la=(fe,_e)=>{if(!b){const je=_e==="player"||fe.isFaceUp;Ce({card:fe,showContents:je})}},sa=()=>{b||Ce(null)},Jt=fe=>{!b&&!C.actionRequired&&Ce({card:fe,showContents:fe.isRevealed||!1})},_t=()=>{if(!dn)return null;const{card:fe,showContents:_e}=dn;return o.jsx(Ct,{card:fe,isFaceUp:_e})},Et=C.turn==="player"&&!C.actionRequired&&C.phase==="compile"&&C.compilableLanes.length>0,ue=((Me=C.actionRequired)==null?void 0:Me.sourceCardId)??null,be=re.useMemo(()=>{var fe;return(fe=C.actionRequired)!=null&&fe.actor?C.actionRequired.actor==="player"?"action-required-player":"action-required-opponent":""},[C.actionRequired]),Ae=re.useMemo(()=>{const fe=C.actionRequired;return fe&&fe.actor==="player"?ab.has(fe.type)?"":"hand-in-background":""},[C.actionRequired]);return o.jsxs("div",{className:"screen game-screen",children:[bt&&o.jsx(Y0,{player:bt,playerState:C[bt],onClose:()=>Vn(null),difficulty:c}),zn&&((Je=C.actionRequired)==null?void 0:Je.type)==="prompt_rearrange_protocols"&&o.jsx(H0,{gameState:C,targetPlayer:C.actionRequired.target,onConfirm:fe=>{var _e,je;((_e=C.actionRequired)==null?void 0:_e.sourceCardId)==="CONTROL_MECHANIC"&&((je=C.actionRequired)!=null&&je.actor)&&S(C.actionRequired.actor),Y(fe),sn(!1)}}),Rt&&((ze=C.actionRequired)==null?void 0:ze.type)==="prompt_swap_protocols"&&o.jsx(z0,{gameState:C,targetPlayer:C.actionRequired.target,onConfirm:fe=>{ye(fe),Vt(!1)}}),((qe=C.actionRequired)==null?void 0:qe.type)==="select_card_from_revealed_deck"&&C.actionRequired.actor==="player"&&o.jsx(V0,{gameState:C,onSelectCard:fe=>{Xe(fe)}}),((at=C.actionRequired)==null?void 0:at.type)==="prompt_optional_effect"&&C.actionRequired.actor==="player"&&o.jsx(B0,{gameState:C,onAccept:()=>G(!0),onDecline:()=>G(!1)}),o.jsx("div",{className:"toaster-container",children:qt.map(fe=>o.jsx(M0,{message:fe.message,player:fe.player},fe.id))}),gt&&o.jsx(L0,{log:C.log,onClose:()=>Ye(!1)}),o.jsx("button",{className:"btn log-button",onClick:()=>Ye(!0),children:"Log"}),o.jsxs("div",{className:"game-screen-layout",children:[o.jsxs("div",{className:"game-preview-container",children:[o.jsx("h2",{onClick:_n,style:{cursor:"pointer",userSelect:"none"},title:"Click 5 times to toggle debug mode",children:"Mainframe"}),o.jsx(O0,{gameState:C,turn:((Bt=C.actionRequired)==null?void 0:Bt.actor)||C.turn,animationState:C.animationState,difficulty:c,onPlayerClick:()=>Vn("player"),onOpponentClick:()=>Vn("opponent")}),o.jsx("div",{className:"preview-card-area",children:_t()}),o.jsx("button",{className:"btn btn-back",onClick:a,children:"Back"})]}),o.jsxs("div",{className:"game-main-area",children:[Et&&o.jsx("div",{className:"compile-prompt-container",children:o.jsx("h3",{children:"Select a Protocol to Compile"})}),o.jsx(q0,{gameState:C,onLanePointerDown:Yn,onPlayFaceDown:oa,selectedCardId:b,onCardPointerDown:Gn,onCardPointerEnter:la,onCardPointerLeave:sa,onOpponentHandCardPointerEnter:Jt,onOpponentHandCardPointerLeave:sa,sourceCardId:ue}),o.jsxs("div",{className:"player-action-area",children:[o.jsx($0,{gameState:C,onFillHand:H,onSkipAction:D,onResolveOptionalDrawPrompt:P,onResolveDeath1Prompt:L,onResolveLove1Prompt:R,onResolvePlague2Discard:O,onResolvePlague4Flip:Z,onResolveFire3Prompt:ee,onResolveOptionalDiscardCustomPrompt:M,onResolveOptionalEffectPrompt:G,onResolveSpeed3Prompt:Se,onResolveFire4Discard:K,onResolveHate1Discard:W,onResolveLight2Prompt:U,onResolveRevealBoardCardPrompt:Q,onResolvePsychic4Prompt:ge,onResolveSpirit1Prompt:ce,onResolveSpirit3Prompt:te,onResolveControlMechanicPrompt:Fe,onResolveCustomChoice:Le,selectedCardId:b,multiSelectedCardIds:Ie,actionRequiredClass:be}),o.jsx("div",{className:`player-hand-area ${Ae}`,children:C.player.hand.filter(fe=>{const _e=C.actionRequired;return(_e==null?void 0:_e.type)==="select_card_from_hand_to_play"&&(_e==null?void 0:_e.selectableCardIds)?_e.selectableCardIds.includes(fe.id):!0}).map(fe=>{var je;const _e=((je=C.actionRequired)==null?void 0:je.type)==="select_lane_for_play"?fe.id===C.actionRequired.cardInHandId:fe.id===b;return o.jsx(Ct,{card:fe,isFaceUp:!0,onPointerDown:()=>ra(fe),onPointerEnter:()=>Wn(fe),isSelected:_e,isMultiSelected:Ie.includes(fe.id),animationState:C.animationState,additionalClassName:"in-hand"},fe.id)})})]})]})]}),m&&o.jsx(G0,{onComplete:k}),ga&&o.jsx(nb,{onLoadScenario:nt,onSkipCoinFlip:j,onForceWin:va,onForceLose:na})]})}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function rb({onPlayAgain:a,winner:n,finalState:l,difficulty:i}){if(!l)return o.jsxs("div",{className:"screen",children:[o.jsx("h1",{children:"Loading Results..."}),o.jsx("button",{className:"btn",onClick:a,children:"Back to Menu"})]});const c=n==="player",d=(p,h)=>{let f=[p];return h&&f.push("compiled"),f.join(" ")};return o.jsx("div",{className:`screen results-screen ${c?"victory":"defeat"}`,children:o.jsxs("div",{className:"results-screen-content",children:[o.jsxs("header",{className:"results-header",children:[o.jsx("h1",{children:c?"VICTORY":"DEFEAT"}),o.jsx("p",{children:c?"System compiled successfully.":"Critical error in the mainframe."})]}),o.jsxs("div",{className:"results-body",children:[o.jsxs("div",{className:"final-score-section",children:[o.jsx("h3",{children:"Final Score"}),o.jsxs("h4",{className:"results-label results-opponent-label",children:["Opponent (",i.charAt(0).toUpperCase()+i.slice(1),")"]}),o.jsxs("div",{className:"protocol-bars-container",children:[o.jsx("div",{className:"protocol-bar opponent-bar",children:l.opponent.protocols.map((p,h)=>o.jsxs("div",{className:d("protocol-display",l.opponent.compiled[h]),children:[o.jsx("span",{className:"protocol-name",children:p}),o.jsx("span",{className:"protocol-value",children:l.opponent.laneValues[h]})]},`opp-proto-${p}-${h}`))}),o.jsx("div",{className:"protocol-bar player-bar",children:l.player.protocols.map((p,h)=>o.jsxs("div",{className:d("protocol-display",l.player.compiled[h]),children:[o.jsx("span",{className:"protocol-name",children:p}),o.jsx("span",{className:"protocol-value",children:l.player.laneValues[h]})]},`player-proto-${p}-${h}`))})]}),o.jsx("h4",{className:"results-label results-player-label",children:"Player"})]}),o.jsxs("div",{className:"stats-section",children:[o.jsx("h3",{children:"Statistics"}),o.jsxs("div",{className:"stats-grid",children:[o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-item-label",children:"Cards Played"}),o.jsx("span",{className:"stat-item-value opponent",children:l.stats.opponent.cardsPlayed}),o.jsx("span",{className:"stat-item-value player",children:l.stats.player.cardsPlayed})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-item-label",children:"Cards Drawn"}),o.jsx("span",{className:"stat-item-value opponent",children:l.stats.opponent.cardsDrawn}),o.jsx("span",{className:"stat-item-value player",children:l.stats.player.cardsDrawn})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-item-label",children:"Cards Discarded"}),o.jsx("span",{className:"stat-item-value opponent",children:l.stats.opponent.cardsDiscarded}),o.jsx("span",{className:"stat-item-value player",children:l.stats.player.cardsDiscarded})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-item-label",children:"Cards Deleted"}),o.jsx("span",{className:"stat-item-value opponent",children:l.stats.opponent.cardsDeleted}),o.jsx("span",{className:"stat-item-value player",children:l.stats.player.cardsDeleted})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-item-label",children:"Cards Flipped"}),o.jsx("span",{className:"stat-item-value opponent",children:l.stats.opponent.cardsFlipped}),o.jsx("span",{className:"stat-item-value player",children:l.stats.player.cardsFlipped})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-item-label",children:"Cards Shifted"}),o.jsx("span",{className:"stat-item-value opponent",children:l.stats.opponent.cardsShifted}),o.jsx("span",{className:"stat-item-value player",children:l.stats.player.cardsShifted})]})]})]})]}),o.jsx("button",{className:"btn",onClick:a,children:"Play Again"})]})})}function lb({onBack:a}){const[n,l]=re.useState(0);re.useEffect(()=>{Bl(),l(j=>j+1)},[]);const i=re.useMemo(()=>{console.log("[Card Library] Loading cards, refreshKey:",n);const j=Id(),E=Co(),C=Qo(),b=new Set(C.filter(A=>Lr(A)).map(A=>A.name)),T=E.filter(A=>b.has(A.protocol)||j);return console.log("[Card Library] Total cards:",T.length,"(custom enabled:",j,")"),T},[n]),c=re.useMemo(()=>{const j=new Set(i.map(E=>E.protocol));return Array.from(j).sort()},[i]),[d,p]=re.useState(null),h=re.useMemo(()=>{const j=new Set(i.map(E=>E.category));return Array.from(j).sort()},[i]),[f,m]=re.useState(()=>new Set(h));re.useEffect(()=>{i.length>0&&!d&&p(i[0])},[i,d]);const g=j=>{m(E=>{const C=new Set(E);return C.has(j)?C.delete(j):C.add(j),C})},y=j=>{const E=i.find(C=>C.protocol===j);return(E==null?void 0:E.category)||""},w=re.useMemo(()=>c.filter(j=>{const E=y(j);return f.has(E)}),[c,f,i]),_=re.useMemo(()=>{const j={};for(const E of i)j[E.protocol]||(j[E.protocol]=[]),j[E.protocol].push(E);for(const E in j)j[E].sort((C,b)=>C.value-b.value);return j},[i]),S=j=>{p(j)},k=()=>{if(!d)return null;const j={...d,id:"preview",isFaceUp:!0};return o.jsx(Ct,{card:j,isFaceUp:!0})};return o.jsxs("div",{className:"screen card-library-screen",children:[o.jsx(gi,{title:"Card Library",onBack:a}),o.jsxs("div",{className:"card-library-layout",children:[o.jsxs("div",{className:"game-preview-container",children:[o.jsx("h2",{children:"Card Preview"}),o.jsx("div",{className:"preview-card-area",children:k()})]}),o.jsxs("div",{className:"card-list-container",children:[o.jsx("div",{className:"category-filters",children:h.map(j=>o.jsxs("label",{className:"category-filter-item",children:[o.jsx("input",{type:"checkbox",checked:f.has(j),onChange:()=>g(j)}),o.jsx("span",{children:j})]},j))}),w.map(j=>o.jsxs("div",{className:"protocol-group",children:[o.jsxs("h3",{children:[j,o.jsxs("span",{className:"protocol-category-label",children:[" (",y(j),")"]})]}),o.jsx("div",{className:"protocol-card-grid",children:_[j].map(E=>{const C={...E,id:`${E.protocol}-${E.value}`,isFaceUp:!0};return o.jsx(Ct,{card:C,isFaceUp:!0,additionalClassName:"in-hand",onPointerEnter:()=>S(E),onPointerDown:()=>S(E)},C.id)})})]},j))]})]})]})}function sb({onBack:a}){const[n,l]=re.useState(()=>$d()),[i,c]=re.useState(!1),d=MC(n),p=HC(n),h=zC(n),f=VC(n),m=BC(n),g=YC(n),y=GC(n),[w,_]=re.useState(null),S=()=>{$C(),l($d()),c(!1)},k=ee=>{_(M=>M===ee?null:ee)},j=n.global.totalGamesPlayed,E=n.actions.detailedStats,C=ee=>j>0?(ee/j).toFixed(1):"0.0",b=(ee,M)=>M>0?(ee/M).toFixed(1):"0.0",T=E.cardsDrawn.playerFromRefresh+E.cardsDrawn.playerFromEffect,A=E.cardsDrawn.aiFromRefresh+E.cardsDrawn.aiFromEffect,H=T+A,$=E.cardsPlayed.playerFromHand+E.cardsPlayed.playerFromEffect,B=E.cardsPlayed.aiFromHand+E.cardsPlayed.aiFromEffect,X=$+B,I=E.compiles.playerFirstCompile+E.compiles.playerRecompile,F=E.compiles.aiFirstCompile+E.compiles.aiRecompile,N=I+F,D=E.discards.player+E.discards.ai,P=E.deletes.player+E.deletes.ai,L=E.flips.player+E.flips.ai,R=E.shifts.player+E.shifts.ai,O=E.returns.player+E.returns.ai,Z=E.refreshes.player+E.refreshes.ai;return o.jsxs("div",{className:"screen statistics-screen",children:[o.jsx(gi,{title:"STATISTICS",onBack:a}),o.jsxs("div",{className:"stats-content",children:[o.jsxs("section",{className:"stats-section",children:[o.jsx("h2",{className:"section-title",children:"Overview"}),o.jsxs("div",{className:"stats-grid",children:[o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Games Played"}),o.jsx("span",{className:"stat-value",children:n.global.totalGamesPlayed})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Win Rate"}),o.jsxs("span",{className:"stat-value",children:[d.toFixed(1),"%"]})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Games Won"}),o.jsx("span",{className:"stat-value win",children:n.global.totalGamesWon})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Games Lost"}),o.jsx("span",{className:"stat-value loss",children:n.global.totalGamesLost})]})]})]}),o.jsxs("section",{className:"stats-section",children:[o.jsx("h2",{className:"section-title",children:"Streaks"}),o.jsxs("div",{className:"stats-grid",children:[o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Current Streak"}),o.jsx("span",{className:`stat-value ${n.global.currentStreak>0?"win":n.global.currentStreak<0?"loss":""}`,children:n.global.currentStreak>0?`+${n.global.currentStreak}`:n.global.currentStreak})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Best Win Streak"}),o.jsx("span",{className:"stat-value win",children:n.global.longestWinStreak})]})]})]}),o.jsxs("section",{className:"stats-section",children:[o.jsx("h2",{className:"section-title",children:"Playtime"}),o.jsxs("div",{className:"stats-grid",children:[o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Total Playtime"}),o.jsx("span",{className:"stat-value",children:Vl(n.global.totalPlaytime)})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Average Game"}),o.jsx("span",{className:"stat-value",children:Vl(p)})]}),n.global.fastestWin&&o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Fastest Win"}),o.jsx("span",{className:"stat-value",children:Vl(n.global.fastestWin)})]}),n.global.longestGame&&o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Longest Game"}),o.jsx("span",{className:"stat-value",children:Vl(n.global.longestGame)})]}),n.global.lastGameDuration&&o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Last Game"}),o.jsx("span",{className:"stat-value",children:Vl(n.global.lastGameDuration)})]})]})]}),o.jsxs("section",{className:"stats-section",children:[o.jsx("h2",{className:"section-title",children:"AI Performance"}),o.jsx("div",{className:"ai-stats",children:["easy","normal","hard"].map(ee=>{const M=n.aiDifficulty[ee],G=M.played>0?M.wins/M.played*100:0;return o.jsxs("div",{className:"ai-item",children:[o.jsx("span",{className:"ai-name",children:ee}),o.jsxs("span",{className:"ai-record",children:[o.jsxs("span",{className:"win",children:[M.wins,"W"]})," - ",o.jsxs("span",{className:"loss",children:[M.losses,"L"]})]}),o.jsxs("span",{className:"ai-winrate",children:["(",G.toFixed(1),"%)"]})]},ee)})})]}),f.length>0&&o.jsxs("section",{className:"stats-section",children:[o.jsx("h2",{className:"section-title",children:"Best Win Rate"}),o.jsx("div",{className:"protocol-list",children:f.map((ee,M)=>o.jsxs("div",{className:"protocol-item",children:[o.jsxs("span",{className:"protocol-rank",children:[M+1,"."]}),o.jsx("span",{className:"protocol-name",children:ee.protocol}),o.jsxs("span",{className:"protocol-stats win",children:[ee.winRate.toFixed(0),"%  ",ee.timesUsed]})]},ee.protocol))})]}),h.length>0&&o.jsxs("section",{className:"stats-section",children:[o.jsx("h2",{className:"section-title",children:"Favorite Protocols"}),o.jsx("div",{className:"protocol-list",children:h.map((ee,M)=>o.jsxs("div",{className:"protocol-item",children:[o.jsxs("span",{className:"protocol-rank",children:[M+1,"."]}),o.jsx("span",{className:"protocol-name",children:ee.protocol}),o.jsxs("span",{className:"protocol-stats",children:[ee.timesUsed,"  ",ee.winRate.toFixed(0),"%"]})]},ee.protocol))})]}),m.length>0&&o.jsxs("section",{className:"stats-section",children:[o.jsx("h2",{className:"section-title",children:"Least Used Protocols"}),o.jsx("div",{className:"protocol-list",children:m.map((ee,M)=>o.jsxs("div",{className:"protocol-item",children:[o.jsxs("span",{className:"protocol-rank",children:[M+1,"."]}),o.jsx("span",{className:"protocol-name",children:ee.protocol}),o.jsxs("span",{className:"protocol-stats",children:[ee.timesUsed,"  ",ee.winRate.toFixed(0),"%"]})]},ee.protocol))})]}),g.length>0&&o.jsxs("section",{className:"stats-section",children:[o.jsx("h2",{className:"section-title",children:"Most Played Cards"}),o.jsx("div",{className:"card-list",children:g.map((ee,M)=>o.jsxs("div",{className:"card-item",children:[o.jsxs("span",{className:"card-rank",children:[M+1,"."]}),o.jsx("span",{className:"card-name",children:ee.card}),o.jsxs("span",{className:"card-count",children:[ee.count,""]})]},ee.card))})]}),y.length>0&&o.jsxs("section",{className:"stats-section",children:[o.jsx("h2",{className:"section-title",children:"Most Deleted Cards"}),o.jsx("div",{className:"card-list",children:y.map((ee,M)=>o.jsxs("div",{className:"card-item",children:[o.jsxs("span",{className:"card-rank",children:[M+1,"."]}),o.jsx("span",{className:"card-name",children:ee.card}),o.jsxs("span",{className:"card-count",children:[ee.count,""]})]},ee.card))})]}),o.jsxs("section",{className:"stats-section",children:[o.jsx("h2",{className:"section-title",children:"Control Mechanic"}),o.jsxs("div",{className:"stats-grid",children:[o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"With Control"}),o.jsx("span",{className:"stat-value",children:n.control.gamesWithControl})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Without Control"}),o.jsx("span",{className:"stat-value",children:n.control.gamesWithoutControl})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Your Rearranges"}),o.jsx("span",{className:"stat-value",children:n.control.playerRearranges})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"AI Rearranges"}),o.jsx("span",{className:"stat-value",children:n.control.aiRearranges})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Total Rearranges"}),o.jsx("span",{className:"stat-value",children:n.control.totalRearranges})]})]})]}),o.jsxs("section",{className:"stats-section",children:[o.jsx("h2",{className:"section-title",children:"Coin Flip"}),o.jsxs("div",{className:"stats-grid",children:[o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Heads Chosen"}),o.jsxs("span",{className:"stat-value",children:[n.coinFlip.headsChosen," (",n.coinFlip.headsChosen>0?(n.coinFlip.headsWon/n.coinFlip.headsChosen*100).toFixed(0):0,"%)"]})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Tails Chosen"}),o.jsxs("span",{className:"stat-value",children:[n.coinFlip.tailsChosen," (",n.coinFlip.tailsChosen>0?(n.coinFlip.tailsWon/n.coinFlip.tailsChosen*100).toFixed(0):0,"%)"]})]})]})]}),o.jsxs("section",{className:"stats-section full-width",children:[o.jsx("h2",{className:"section-title",children:"Actions (click for details)"}),o.jsxs("div",{className:"actions-container",children:[o.jsxs("div",{className:`stat-item clickable ${w==="played"?"expanded":""}`,onClick:()=>k("played"),children:[o.jsx("span",{className:"stat-label",children:"Cards Played"}),o.jsx("span",{className:"stat-value",children:X})]}),o.jsxs("div",{className:`stat-item clickable ${w==="drawn"?"expanded":""}`,onClick:()=>k("drawn"),children:[o.jsx("span",{className:"stat-label",children:"Cards Drawn"}),o.jsx("span",{className:"stat-value",children:H})]}),o.jsxs("div",{className:`stat-item clickable ${w==="discards"?"expanded":""}`,onClick:()=>k("discards"),children:[o.jsx("span",{className:"stat-label",children:"Discards"}),o.jsx("span",{className:"stat-value",children:D})]}),o.jsxs("div",{className:`stat-item clickable ${w==="deletes"?"expanded":""}`,onClick:()=>k("deletes"),children:[o.jsx("span",{className:"stat-label",children:"Deletes"}),o.jsx("span",{className:"stat-value",children:P})]}),o.jsxs("div",{className:`stat-item clickable ${w==="flips"?"expanded":""}`,onClick:()=>k("flips"),children:[o.jsx("span",{className:"stat-label",children:"Flips"}),o.jsx("span",{className:"stat-value",children:L})]}),o.jsxs("div",{className:`stat-item clickable ${w==="shifts"?"expanded":""}`,onClick:()=>k("shifts"),children:[o.jsx("span",{className:"stat-label",children:"Shifts"}),o.jsx("span",{className:"stat-value",children:R})]}),o.jsxs("div",{className:`stat-item clickable ${w==="returns"?"expanded":""}`,onClick:()=>k("returns"),children:[o.jsx("span",{className:"stat-label",children:"Returns"}),o.jsx("span",{className:"stat-value",children:O})]}),o.jsxs("div",{className:`stat-item clickable ${w==="compiles"?"expanded":""}`,onClick:()=>k("compiles"),children:[o.jsx("span",{className:"stat-label",children:"Compiles"}),o.jsx("span",{className:"stat-value",children:N})]}),o.jsxs("div",{className:`stat-item clickable ${w==="refreshes"?"expanded":""}`,onClick:()=>k("refreshes"),children:[o.jsx("span",{className:"stat-label",children:"Refreshes"}),o.jsx("span",{className:"stat-value",children:Z})]})]}),w==="played"&&o.jsxs("div",{className:"action-details-section",children:[o.jsx("h3",{className:"section-title",children:"Cards Played"}),o.jsxs("div",{className:"action-details-total",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:X})]}),o.jsxs("div",{className:"action-details-columns",children:[o.jsxs("div",{className:"action-details-column player",children:[o.jsx("div",{className:"column-header",children:"Player"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:$})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"From Hand"}),o.jsx("span",{className:"detail-value",children:E.cardsPlayed.playerFromHand})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"From Effect"}),o.jsx("span",{className:"detail-value",children:E.cardsPlayed.playerFromEffect})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Face-Up"}),o.jsx("span",{className:"detail-value",children:E.cardsPlayed.playerFaceUp})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Face-Down"}),o.jsx("span",{className:"detail-value",children:E.cardsPlayed.playerFaceDown})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:C($)})]})]}),o.jsxs("div",{className:"action-details-column ai",children:[o.jsx("div",{className:"column-header",children:"AI"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:B})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"From Hand"}),o.jsx("span",{className:"detail-value",children:E.cardsPlayed.aiFromHand})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"From Effect"}),o.jsx("span",{className:"detail-value",children:E.cardsPlayed.aiFromEffect})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Face-Up"}),o.jsx("span",{className:"detail-value",children:E.cardsPlayed.aiFaceUp})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Face-Down"}),o.jsx("span",{className:"detail-value",children:E.cardsPlayed.aiFaceDown})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:C(B)})]})]})]})]}),w==="drawn"&&o.jsxs("div",{className:"action-details-section",children:[o.jsx("h3",{className:"section-title",children:"Cards Drawn"}),o.jsxs("div",{className:"action-details-total",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:H})]}),o.jsxs("div",{className:"action-details-columns",children:[o.jsxs("div",{className:"action-details-column player",children:[o.jsx("div",{className:"column-header",children:"Player"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:T})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"From Refresh"}),o.jsx("span",{className:"detail-value",children:E.cardsDrawn.playerFromRefresh})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"From Effect"}),o.jsx("span",{className:"detail-value",children:E.cardsDrawn.playerFromEffect})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:C(T)})]})]}),o.jsxs("div",{className:"action-details-column ai",children:[o.jsx("div",{className:"column-header",children:"AI"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:A})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"From Refresh"}),o.jsx("span",{className:"detail-value",children:E.cardsDrawn.aiFromRefresh})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"From Effect"}),o.jsx("span",{className:"detail-value",children:E.cardsDrawn.aiFromEffect})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:C(A)})]})]})]})]}),w==="discards"&&o.jsxs("div",{className:"action-details-section",children:[o.jsx("h3",{className:"section-title",children:"Discards"}),o.jsxs("div",{className:"action-details-total",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:D})]}),o.jsxs("div",{className:"action-details-columns",children:[o.jsxs("div",{className:"action-details-column player",children:[o.jsx("div",{className:"column-header",children:"Player"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:E.discards.player})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:C(E.discards.player)})]})]}),o.jsxs("div",{className:"action-details-column ai",children:[o.jsx("div",{className:"column-header",children:"AI"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:E.discards.ai})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:C(E.discards.ai)})]})]})]})]}),w==="deletes"&&o.jsxs("div",{className:"action-details-section",children:[o.jsx("h3",{className:"section-title",children:"Deletes"}),o.jsxs("div",{className:"action-details-total",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:P})]}),o.jsxs("div",{className:"action-details-columns",children:[o.jsxs("div",{className:"action-details-column player",children:[o.jsx("div",{className:"column-header",children:"Player"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:E.deletes.player})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:C(E.deletes.player)})]})]}),o.jsxs("div",{className:"action-details-column ai",children:[o.jsx("div",{className:"column-header",children:"AI"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:E.deletes.ai})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:C(E.deletes.ai)})]})]})]})]}),w==="flips"&&o.jsxs("div",{className:"action-details-section",children:[o.jsx("h3",{className:"section-title",children:"Flips"}),o.jsxs("div",{className:"action-details-total",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:L})]}),o.jsxs("div",{className:"action-details-columns",children:[o.jsxs("div",{className:"action-details-column player",children:[o.jsx("div",{className:"column-header",children:"Player"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:E.flips.player})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:C(E.flips.player)})]})]}),o.jsxs("div",{className:"action-details-column ai",children:[o.jsx("div",{className:"column-header",children:"AI"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:E.flips.ai})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:C(E.flips.ai)})]})]})]})]}),w==="shifts"&&o.jsxs("div",{className:"action-details-section",children:[o.jsx("h3",{className:"section-title",children:"Shifts"}),o.jsxs("div",{className:"action-details-total",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:R})]}),o.jsxs("div",{className:"action-details-columns",children:[o.jsxs("div",{className:"action-details-column player",children:[o.jsx("div",{className:"column-header",children:"Player"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:E.shifts.player})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:C(E.shifts.player)})]})]}),o.jsxs("div",{className:"action-details-column ai",children:[o.jsx("div",{className:"column-header",children:"AI"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:E.shifts.ai})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:C(E.shifts.ai)})]})]})]})]}),w==="returns"&&o.jsxs("div",{className:"action-details-section",children:[o.jsx("h3",{className:"section-title",children:"Returns"}),o.jsxs("div",{className:"action-details-total",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:O})]}),o.jsxs("div",{className:"action-details-columns",children:[o.jsxs("div",{className:"action-details-column player",children:[o.jsx("div",{className:"column-header",children:"Player"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:E.returns.player})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:C(E.returns.player)})]})]}),o.jsxs("div",{className:"action-details-column ai",children:[o.jsx("div",{className:"column-header",children:"AI"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:E.returns.ai})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:C(E.returns.ai)})]})]})]})]}),w==="compiles"&&o.jsxs("div",{className:"action-details-section",children:[o.jsx("h3",{className:"section-title",children:"Compiles"}),o.jsxs("div",{className:"action-details-total",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:N})]}),o.jsxs("div",{className:"action-details-columns",children:[o.jsxs("div",{className:"action-details-column player",children:[o.jsx("div",{className:"column-header",children:"Player"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:I})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"First-Compile"}),o.jsx("span",{className:"detail-value",children:E.compiles.playerFirstCompile})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Re-Compile"}),o.jsx("span",{className:"detail-value",children:E.compiles.playerRecompile})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:C(I)})]})]}),o.jsxs("div",{className:"action-details-column ai",children:[o.jsx("div",{className:"column-header",children:"AI"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:F})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"First-Compile"}),o.jsx("span",{className:"detail-value",children:E.compiles.aiFirstCompile})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Re-Compile"}),o.jsx("span",{className:"detail-value",children:E.compiles.aiRecompile})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:C(F)})]})]})]})]}),w==="refreshes"&&o.jsxs("div",{className:"action-details-section",children:[o.jsx("h3",{className:"section-title",children:"Refreshes"}),o.jsxs("div",{className:"action-details-total",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:Z})]}),o.jsxs("div",{className:"action-details-columns",children:[o.jsxs("div",{className:"action-details-column player",children:[o.jsx("div",{className:"column-header",children:"Player"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:E.refreshes.player})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Cards / Refresh"}),o.jsx("span",{className:"detail-value",children:b(E.refreshes.playerCardsDrawn,E.refreshes.player)})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:C(E.refreshes.player)})]})]}),o.jsxs("div",{className:"action-details-column ai",children:[o.jsx("div",{className:"column-header",children:"AI"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:E.refreshes.ai})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Cards / Refresh"}),o.jsx("span",{className:"detail-value",children:b(E.refreshes.aiCardsDrawn,E.refreshes.ai)})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:C(E.refreshes.ai)})]})]})]})]})]}),o.jsx("section",{className:"stats-section reset-section",children:o.jsx("button",{className:"reset-stats-button",onClick:()=>c(!0),children:"Reset All Statistics"})})]}),i&&o.jsx("div",{className:"reset-modal-overlay",onClick:()=>c(!1),children:o.jsxs("div",{className:"reset-modal",onClick:ee=>ee.stopPropagation(),children:[o.jsx("h3",{children:"Reset Statistics?"}),o.jsx("p",{children:"This will permanently delete all your statistics. This action cannot be undone."}),o.jsxs("div",{className:"reset-modal-buttons",children:[o.jsx("button",{className:"cancel-button",onClick:()=>c(!1),children:"Cancel"}),o.jsx("button",{className:"confirm-reset-button",onClick:S,children:"Reset"})]})]})})]})}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Xy=({params:a,onChange:n})=>{var l,i,c,d,p;return o.jsxs("div",{className:"param-editor draw-effect-editor",children:[o.jsx("h4",{children:"Draw Effect Parameters"}),o.jsxs("label",{children:["Count Type",o.jsxs("select",{value:a.countType||"fixed",onChange:h=>{const f=h.target.value;n({...a,countType:f,countOffset:f==="equal_to_discarded"?0:void 0})},children:[o.jsx("option",{value:"fixed",children:"Fixed Amount"}),o.jsx("option",{value:"equal_to_card_value",children:"Equal to Card Value (from previous effect)"}),o.jsx("option",{value:"equal_to_discarded",children:"Equal to Discarded Cards"}),o.jsx("option",{value:"hand_size",children:"Equal to Hand Size"})]})]}),(!a.countType||a.countType==="fixed")&&o.jsxs("label",{children:["Card Count",o.jsx("input",{type:"number",min:1,max:6,value:a.count,onChange:h=>n({...a,count:parseInt(h.target.value)||1})})]}),a.countType==="equal_to_discarded"&&o.jsxs("label",{children:["Offset (+/-)",o.jsx("input",{type:"number",min:-5,max:5,value:a.countOffset||0,onChange:h=>n({...a,countOffset:parseInt(h.target.value)||0})}),o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:'Example: +1 for "discard count plus 1" (Fire-4)'})]}),o.jsxs("label",{children:["Target",o.jsxs("select",{value:a.target,onChange:h=>n({...a,target:h.target.value}),children:[o.jsx("option",{value:"self",children:"Self"}),o.jsx("option",{value:"opponent",children:"Opponent"})]})]}),o.jsxs("label",{children:["Source",o.jsxs("select",{value:a.source,onChange:h=>n({...a,source:h.target.value}),children:[o.jsx("option",{value:"own_deck",children:"Own Deck"}),o.jsx("option",{value:"opponent_deck",children:"Opponent's Deck"})]})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a.preAction==="refresh",onChange:h=>n({...a,preAction:h.target.checked?"refresh":void 0})}),"Refresh hand first (shuffle hand into deck, then draw)"]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a.optional||!1,onChange:h=>n({...a,optional:h.target.checked})}),'Optional ("You may draw" instead of "Draw")']}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a.valueFilter!==void 0,onChange:h=>{if(h.target.checked)n({...a,valueFilter:{equals:1}});else{const{valueFilter:f,...m}=a;n(m)}}}),'Draw specific value only (e.g., "Draw 1 card with a value of X")']}),a.valueFilter!==void 0&&o.jsxs(o.Fragment,{children:[o.jsxs("label",{children:["Card Value to Draw",o.jsx("input",{type:"number",min:0,max:5,value:((l=a.valueFilter)==null?void 0:l.equals)??1,onChange:h=>n({...a,valueFilter:{equals:parseInt(h.target.value)||0}})}),o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"Only draws cards with this exact value from the deck"})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a.fromRevealed||!1,onChange:h=>n({...a,fromRevealed:h.target.checked})}),'From revealed deck ("revealed this way" - player selects)',o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:'Requires "Reveal your deck" effect before this. Player picks from revealed cards.'})]})]}),o.jsxs("label",{children:["Conditional",o.jsxs("select",{value:((i=a.conditional)==null?void 0:i.type)||"none",onChange:h=>{if(h.target.value==="none"){const{conditional:f,...m}=a;n(m)}else n({...a,conditional:{type:h.target.value}})},children:[o.jsx("option",{value:"none",children:"None"}),o.jsx("option",{value:"count_face_down",children:"1 per face-down card (all on board)"}),o.jsx("option",{value:"is_covering",children:"Only if this card is covering another"}),o.jsx("option",{value:"non_matching_protocols",children:"1 per line with non-matching protocol"})]})]}),o.jsxs("label",{children:["Advanced Conditional",o.jsxs("select",{value:((c=a.advancedConditional)==null?void 0:c.type)||"none",onChange:h=>{if(h.target.value==="none"){const{advancedConditional:f,...m}=a;n(m)}else h.target.value==="protocol_match"?n({...a,advancedConditional:{type:"protocol_match",protocol:""}}):h.target.value==="compile_block"?n({...a,advancedConditional:{type:"compile_block",turnDuration:1}}):h.target.value==="empty_hand"?n({...a,advancedConditional:{type:"empty_hand"}}):h.target.value==="opponent_higher_value_in_lane"&&n({...a,advancedConditional:{type:"opponent_higher_value_in_lane"}})},children:[o.jsx("option",{value:"none",children:"None"}),o.jsx("option",{value:"protocol_match",children:"Only if in line with matching protocol"}),o.jsx("option",{value:"compile_block",children:"Block opponent's compile next turn"}),o.jsx("option",{value:"empty_hand",children:"Only if hand is empty"}),o.jsx("option",{value:"opponent_higher_value_in_lane",children:"Only if opponent has higher value in this lane"})]})]}),((d=a.advancedConditional)==null?void 0:d.type)==="protocol_match"&&o.jsxs("label",{children:["Required Protocol",o.jsx("input",{type:"text",placeholder:"e.g., Fire, Water, Lightning",value:a.advancedConditional.protocol||"",onChange:h=>n({...a,advancedConditional:{...a.advancedConditional,type:"protocol_match",protocol:h.target.value}})}),o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"Only draw if this card is in a line with this protocol"})]}),((p=a.advancedConditional)==null?void 0:p.type)==="compile_block"&&o.jsxs("label",{children:["Block Duration (turns)",o.jsx("input",{type:"number",min:1,max:3,value:a.advancedConditional.turnDuration||1,onChange:h=>n({...a,advancedConditional:{...a.advancedConditional,type:"compile_block",turnDuration:parseInt(h.target.value)||1}})}),o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"Opponent can't compile for this many turns"})]})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const ib=({params:a,onChange:n})=>o.jsxs("div",{className:"param-editor refresh-effect-editor",children:[o.jsx("h4",{children:"Refresh Effect Parameters"}),o.jsx("p",{className:"effect-description",children:'Refresh fills the hand to 5 cards (Spirit-0: "Refresh.")'}),o.jsxs("label",{children:["Target",o.jsxs("select",{value:a.target||"self",onChange:l=>n({...a,target:l.target.value}),children:[o.jsx("option",{value:"self",children:"Self"}),o.jsx("option",{value:"opponent",children:"Opponent"})]})]})]});/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const cb=({params:a,onChange:n})=>o.jsxs("div",{className:"param-editor mutual-draw-effect-editor",children:[o.jsx("h4",{children:"Mutual Draw Effect Parameters"}),o.jsx("p",{className:"effect-description",children:`Both players draw from each other's decks (Chaos-0: "Draw the top card of your opponent's deck. Your opponent draws the top card of your deck.")`}),o.jsxs("label",{children:["Count",o.jsx("input",{type:"number",min:"1",max:"10",value:a.count||1,onChange:l=>n({...a,count:parseInt(l.target.value)||1})})]})]});/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Zy=({params:a,onChange:n})=>{var c,d;const l=a.targetFilter||{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1},i=a.count??1;return o.jsxs("div",{className:"param-editor flip-effect-editor",children:[o.jsx("h4",{children:"Flip Effect Parameters"}),o.jsxs("label",{children:["Card Count/Scope",o.jsxs("select",{value:i==="all"?"all":i==="each"?"each":i.toString(),onChange:p=>{const h=p.target.value;n(h==="all"?{...a,count:"all"}:h==="each"?{...a,count:"each"}:{...a,count:parseInt(h)})},children:[o.jsx("option",{value:"1",children:"1 card"}),o.jsx("option",{value:"2",children:"2 cards"}),o.jsx("option",{value:"3",children:"3 cards"}),o.jsx("option",{value:"all",children:"All matching cards"}),o.jsx("option",{value:"each",children:"Each matching card"})]})]}),typeof a.count=="number"&&o.jsxs("label",{children:["Scope",o.jsxs("select",{value:a.scope||"any",onChange:p=>n({...a,scope:p.target.value}),children:[o.jsx("option",{value:"any",children:"Any lane"}),o.jsx("option",{value:"this_lane",children:"This lane only"}),o.jsx("option",{value:"each_lane",children:'Each lane (Chaos-0: "In each line...")'})]})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a.optional,onChange:p=>n({...a,optional:p.target.checked})}),'Optional ("May flip" instead of "Flip")']}),a.count==="each"&&o.jsxs("label",{children:["Each Line Scope",o.jsxs("select",{value:a.eachLineScope||"all_lines",onChange:p=>n({...a,eachLineScope:p.target.value}),children:[o.jsx("option",{value:"all_lines",children:"Each card on board"}),o.jsx("option",{value:"each_line",children:"1 card in each line"})]})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a.flipSelf||!1,onChange:p=>n({...a,flipSelf:p.target.checked})}),"Flip ONLY this card (no target selection)",o.jsx("small",{style:{display:"block",marginLeft:"24px",color:"#8A79E8"},children:"The card flips itself, ignoring count and target filter."})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a.selfFlipAfter||!1,onChange:p=>n({...a,selfFlipAfter:p.target.checked})}),"ALSO flip this card after flipping targets",o.jsx("small",{style:{display:"block",marginLeft:"24px",color:"#8A79E8"},children:"After flipping target(s), also flip this card as bonus."})]}),o.jsx("h5",{children:"Advanced Conditional"}),o.jsxs("label",{children:["Conditional Type",o.jsxs("select",{value:((c=a.advancedConditional)==null?void 0:c.type)||"",onChange:p=>{if(p.target.value===""){const{advancedConditional:h,...f}=a;n(f)}else p.target.value==="protocol_match"?n({...a,advancedConditional:{type:"protocol_match",protocol:""}}):n({...a,advancedConditional:{type:p.target.value}})},children:[o.jsx("option",{value:"",children:"None"}),o.jsx("option",{value:"protocol_match",children:"Only if in specific protocol line"}),o.jsx("option",{value:"opponent_higher_value_in_lane",children:"Only if opponent has higher value in this lane"})]})]}),((d=a.advancedConditional)==null?void 0:d.type)==="protocol_match"&&o.jsxs("label",{children:["Required Protocol",o.jsx("input",{type:"text",value:a.advancedConditional.protocol||"",onChange:p=>n({...a,advancedConditional:{...a.advancedConditional,protocol:p.target.value}}),placeholder:"e.g., Anarchy, Fire, Death"})]}),o.jsx("h5",{children:"Target Filter"}),o.jsxs("label",{children:["Owner",o.jsxs("select",{value:l.owner,onChange:p=>n({...a,targetFilter:{...l,owner:p.target.value}}),children:[o.jsx("option",{value:"any",children:"Any"}),o.jsx("option",{value:"own",children:"Own"}),o.jsx("option",{value:"opponent",children:"Opponent"})]})]}),o.jsxs("label",{children:["Position",o.jsxs("select",{value:l.position,onChange:p=>n({...a,targetFilter:{...l,position:p.target.value}}),children:[o.jsx("option",{value:"any",children:"Any"}),o.jsx("option",{value:"uncovered",children:"Uncovered (top card)"}),o.jsx("option",{value:"covered",children:"Covered"}),o.jsx("option",{value:"covered_in_this_line",children:"Covered in this line"})]})]}),o.jsxs("label",{children:["Face State",o.jsxs("select",{value:l.faceState,onChange:p=>n({...a,targetFilter:{...l,faceState:p.target.value}}),children:[o.jsx("option",{value:"any",children:"Any"}),o.jsx("option",{value:"face_up",children:"Face-up"}),o.jsx("option",{value:"face_down",children:"Face-down"})]})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:l.excludeSelf,onChange:p=>n({...a,targetFilter:{...l,excludeSelf:p.target.checked}})}),'Exclude self ("other cards")']})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Ky=({params:a,onChange:n})=>{var i,c,d;const l=a.targetFilter||{owner:"any",position:"uncovered",faceState:"any"};return o.jsxs("div",{className:"param-editor",children:[o.jsx("h4",{children:"Shift Effect"}),o.jsxs("label",{children:["Count/Scope",o.jsxs("select",{value:a.count==="all"?"all":"1",onChange:p=>{if(p.target.value==="all")n({...a,count:"all"});else{const{count:h,...f}=a;n(f)}},children:[o.jsx("option",{value:"1",children:"1 card"}),o.jsx("option",{value:"all",children:"All matching cards"})]})]}),o.jsxs("label",{children:["Target Owner",o.jsxs("select",{value:l.owner||"any",onChange:p=>n({...a,targetFilter:{...l,owner:p.target.value}}),children:[o.jsx("option",{value:"any",children:"Any"}),o.jsx("option",{value:"own",children:"Own"}),o.jsx("option",{value:"opponent",children:"Opponent"})]})]}),o.jsxs("label",{children:["Position",o.jsxs("select",{value:l.position||"uncovered",onChange:p=>n({...a,targetFilter:{...l,position:p.target.value}}),children:[o.jsx("option",{value:"any",children:"Any"}),o.jsx("option",{value:"uncovered",children:"Uncovered"}),o.jsx("option",{value:"covered",children:"Covered"})]})]}),o.jsxs("label",{children:["Face State",o.jsxs("select",{value:l.faceState||"any",onChange:p=>n({...a,targetFilter:{...l,faceState:p.target.value}}),children:[o.jsx("option",{value:"any",children:"Any"}),o.jsx("option",{value:"face_up",children:"Face-up"}),o.jsx("option",{value:"face_down",children:"Face-down"})]})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:l.excludeSelf||!1,onChange:p=>n({...a,targetFilter:{...l,excludeSelf:p.target.checked}})}),'Exclude self ("other card")']}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a.optional||!1,onChange:p=>n({...a,optional:p.target.checked})}),'Optional ("You may shift" instead of "Shift")']}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a.shiftSelf||!1,onChange:p=>n({...a,shiftSelf:p.target.checked})}),"Shift this card (instead of selecting target)",o.jsx("small",{style:{display:"block",marginLeft:"24px",color:"#8A79E8"},children:"The card shifts itself, ignoring target filter."})]}),o.jsx("h5",{children:"Advanced Conditional"}),o.jsxs("label",{children:["Conditional Type",o.jsxs("select",{value:((i=a.advancedConditional)==null?void 0:i.type)||"none",onChange:p=>{if(p.target.value==="none"){const{advancedConditional:h,...f}=a;n(f)}else n({...a,advancedConditional:{type:p.target.value}})},children:[o.jsx("option",{value:"none",children:"None"}),o.jsx("option",{value:"empty_hand",children:"Only if hand is empty"}),o.jsx("option",{value:"opponent_higher_value_in_lane",children:"Only if opponent has higher value in this lane"}),o.jsx("option",{value:"this_card_is_covered",children:"Only if this card is covered"})]})]}),o.jsxs("label",{children:["Destination",o.jsxs("select",{value:((c=a.destinationRestriction)==null?void 0:c.type)||"any",onChange:p=>{if(p.target.value==="any"){const{destinationRestriction:h,...f}=a;n(f)}else n({...a,destinationRestriction:{type:p.target.value}})},children:[o.jsx("option",{value:"any",children:"Any line"}),o.jsx("option",{value:"to_another_line",children:"To another line"}),o.jsx("option",{value:"non_matching_protocol",children:"Non-matching protocol"}),o.jsx("option",{value:"specific_lane",children:"This line (within)"}),o.jsx("option",{value:"to_this_lane",children:"To THIS lane only"}),o.jsx("option",{value:"to_or_from_this_lane",children:"To OR from this lane"}),o.jsx("option",{value:"opponent_highest_value_lane",children:"To opponent's highest value lane"})]}),((d=a.destinationRestriction)==null?void 0:d.type)==="opponent_highest_value_lane"&&o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"Card can only be shifted to the lane where opponent has highest total value."})]}),o.jsxs("label",{children:["Source Scope",o.jsxs("select",{value:a.scope||"any",onChange:p=>{if(p.target.value==="any"){const{scope:h,...f}=a;n(f)}else n({...a,scope:p.target.value})},children:[o.jsx("option",{value:"any",children:"Any lane (select from all lanes)"}),o.jsx("option",{value:"this_lane",children:"This line only"}),o.jsx("option",{value:"each_lane",children:"Each lane (execute per lane)"})]}),a.scope==="this_lane"&&o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"Only cards in this line can be selected as shift targets."})]})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Jy=({params:a,onChange:n})=>{var i,c,d,p,h,f,m,g;const l=a.targetFilter||{position:"uncovered",faceState:"any"};return o.jsxs("div",{className:"param-editor delete-effect-editor",children:[o.jsx("h4",{children:"Delete Effect Parameters"}),o.jsxs("label",{children:["Anzahl",o.jsxs("select",{value:typeof a.count=="number"?a.count.toString():"all",onChange:y=>n({...a,count:y.target.value==="all"?"all_in_lane":parseInt(y.target.value)}),children:[o.jsx("option",{value:"1",children:"1"}),o.jsx("option",{value:"2",children:"2"}),o.jsx("option",{value:"3",children:"3"}),o.jsx("option",{value:"all",children:"All in a lane"})]})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a.excludeSelf,onChange:y=>n({...a,excludeSelf:y.target.checked})}),"Exclude self (other cards only)"]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a.deleteSelf||!1,onChange:y=>n({...a,deleteSelf:y.target.checked})}),"Delete this card (ignores all other settings)"]}),o.jsx("h5",{children:"Target Filter"}),o.jsxs("label",{children:["Position",o.jsxs("select",{value:l.position,onChange:y=>n({...a,targetFilter:{...l,position:y.target.value}}),children:[o.jsx("option",{value:"any",children:"Any"}),o.jsx("option",{value:"uncovered",children:"Uncovered"}),o.jsx("option",{value:"covered",children:"Covered"})]})]}),o.jsxs("label",{children:["Face State",o.jsxs("select",{value:l.faceState,onChange:y=>n({...a,targetFilter:{...l,faceState:y.target.value}}),children:[o.jsx("option",{value:"any",children:"Any"}),o.jsx("option",{value:"face_up",children:"Face-up"}),o.jsx("option",{value:"face_down",children:"Face-down"})]})]}),o.jsxs("label",{children:["Owner",o.jsxs("select",{value:l.owner||"any",onChange:y=>{const w=y.target.value,_={...l};w==="any"?delete _.owner:_.owner=w,n({...a,targetFilter:_})},children:[o.jsx("option",{value:"any",children:"Any (own or opponent)"}),o.jsx("option",{value:"own",children:"Own cards only"}),o.jsx("option",{value:"opponent",children:"Opponent's cards only"})]})]}),o.jsxs("label",{children:["Calculation",o.jsxs("select",{value:l.calculation||"none",onChange:y=>{const w=y.target.value,_={...l};w==="none"?delete _.calculation:_.calculation=w,n({...a,targetFilter:_})},children:[o.jsx("option",{value:"none",children:"None"}),o.jsx("option",{value:"highest_value",children:"Highest value"}),o.jsx("option",{value:"lowest_value",children:"Lowest value"})]})]}),o.jsxs("label",{children:["Value Range (specific values to target)",o.jsxs("select",{value:l.valueRange?`${l.valueRange.min}-${l.valueRange.max}`:"none",onChange:y=>{const w=y.target.value,_={...l};w==="none"?delete _.valueRange:w==="0-1"?_.valueRange={min:0,max:1}:w==="1-2"?_.valueRange={min:1,max:2}:w==="0-0"&&(_.valueRange={min:0,max:0}),n({...a,targetFilter:_})},children:[o.jsx("option",{value:"none",children:"Any value"}),o.jsx("option",{value:"0-0",children:"Value 0 only"}),o.jsx("option",{value:"0-1",children:"Values 0 or 1"}),o.jsx("option",{value:"1-2",children:"Values 1 or 2"})]})]}),o.jsx("h5",{children:"Scope"}),o.jsxs("label",{children:["Lane Scope",o.jsxs("select",{value:((i=a.scope)==null?void 0:i.type)||"any",onChange:y=>{const w=y.target.value;if(w==="any"){const{scope:_,...S}=a;n(S)}else n({...a,scope:{type:w}})},children:[o.jsx("option",{value:"any",children:"Any lane"}),o.jsx("option",{value:"this_line",children:"This line only"}),o.jsx("option",{value:"other_lanes",children:"Other lanes"}),o.jsx("option",{value:"each_other_line",children:"Each other line (1 per line)"}),o.jsx("option",{value:"each_lane",children:"Each lane (flexible, 1 per line)"})]})]}),(((c=a.scope)==null?void 0:c.type)==="other_lanes"||((d=a.scope)==null?void 0:d.type)==="any")&&o.jsxs("label",{children:["Minimum Cards in Lane",o.jsxs("select",{value:((p=a.scope)==null?void 0:p.minCardsInLane)||0,onChange:y=>{const w=parseInt(y.target.value);if(w===0){const _={...a.scope};delete _.minCardsInLane,n({...a,scope:_})}else n({...a,scope:{...a.scope,minCardsInLane:w}})},children:[o.jsx("option",{value:0,children:"No minimum"}),o.jsx("option",{value:8,children:"8 or more cards (Metal-3)"}),o.jsx("option",{value:6,children:"6 or more cards"}),o.jsx("option",{value:4,children:"4 or more cards"})]}),((h=a.scope)==null?void 0:h.minCardsInLane)&&o.jsxs("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:["Only delete from lanes with ",a.scope.minCardsInLane,"+ cards total."]})]}),o.jsxs("label",{children:["Who Chooses Target?",o.jsxs("select",{value:a.actorChooses||"effect_owner",onChange:y=>{const w=y.target.value;if(w==="effect_owner"){const{actorChooses:_,...S}=a;n(S)}else n({...a,actorChooses:w})},children:[o.jsx("option",{value:"effect_owner",children:"Effect owner chooses (default)"}),o.jsx("option",{value:"card_owner",children:"Card owner chooses (Plague-4: opponent deletes their own)"})]}),a.actorChooses==="card_owner"&&o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"The owner of the targeted card chooses which card to delete."})]}),o.jsx("h5",{children:"Advanced Conditional"}),o.jsxs("label",{children:["Conditional Type",o.jsxs("select",{value:((f=a.advancedConditional)==null?void 0:f.type)||"none",onChange:y=>{if(y.target.value==="none"){const{advancedConditional:w,..._}=a;n(_)}else n({...a,advancedConditional:{type:y.target.value}})},children:[o.jsx("option",{value:"none",children:"None"}),o.jsx("option",{value:"empty_hand",children:"Only if hand is empty"}),o.jsx("option",{value:"opponent_higher_value_in_lane",children:"Only if opponent has higher value in this lane"})]})]}),o.jsx("h5",{children:"Lane Restriction"}),o.jsxs("label",{children:["Lane Condition",o.jsxs("select",{value:((m=a.laneCondition)==null?void 0:m.type)||"none",onChange:y=>{const w=y.target.value;if(w==="none"){const{laneCondition:_,selectLane:S,...k}=a;n(k)}else n({...a,laneCondition:{type:w},selectLane:!0})},children:[o.jsx("option",{value:"none",children:"None (any lane)"}),o.jsx("option",{value:"opponent_higher_value",children:"Only lanes where opponent has higher value"})]}),((g=a.laneCondition)==null?void 0:g.type)==="opponent_higher_value"&&o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"Can only delete cards in lanes where opponent's total value is higher than yours. Player selects lane first, then card."})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a.selectLane||!1,onChange:y=>n({...a,selectLane:y.target.checked})}),"Select lane first (player chooses lane, then card)",o.jsx("small",{style:{display:"block",marginLeft:"24px",color:"#8A79E8"},children:"Enable if player should pick a lane before selecting a card."})]})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const eg=({params:a,onChange:n})=>{const l=a.countType||"fixed",i=a.variableCount,c=l==="equal_to_discarded";return o.jsxs("div",{className:"param-editor",children:[o.jsx("h4",{children:"Discard Effect"}),o.jsxs("label",{children:["Count Type",o.jsxs("select",{value:l,onChange:d=>n({...a,countType:d.target.value}),children:[o.jsx("option",{value:"fixed",children:"Fixed Count"}),o.jsx("option",{value:"equal_to_discarded",children:"Equal to Previously Discarded (Plague-2)"})]})]}),l==="fixed"&&o.jsxs("label",{children:["Count",o.jsxs("select",{value:i?"variable":a.count.toString(),onChange:d=>{const p=d.target.value;if(p==="variable")n({...a,variableCount:!0,count:1});else if(p==="all"){const{variableCount:h,...f}=a;n({...f,count:"all"})}else{const{variableCount:h,...f}=a;n({...f,count:parseInt(p)})}},children:[o.jsx("option",{value:"1",children:"1 card"}),o.jsx("option",{value:"2",children:"2 cards"}),o.jsx("option",{value:"3",children:"3 cards"}),o.jsx("option",{value:"all",children:"All cards (entire hand)"}),o.jsx("option",{value:"variable",children:"1 or more cards (variable)"})]})]}),c&&o.jsxs("label",{children:["Offset (add to count)",o.jsx("input",{type:"number",value:a.countOffset||0,onChange:d=>n({...a,countOffset:parseInt(d.target.value)}),min:"-5",max:"5"})]}),o.jsxs("label",{children:["Actor",o.jsxs("select",{value:a.actor,onChange:d=>n({...a,actor:d.target.value}),children:[o.jsx("option",{value:"self",children:"Self"}),o.jsx("option",{value:"opponent",children:"Opponent"})]})]}),a.actor==="opponent"&&o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a.random||!1,onChange:d=>n({...a,random:d.target.checked})}),"Random selection (opponent can't choose which card)",o.jsx("small",{style:{display:"block",marginLeft:"24px",marginTop:"4px",color:"#8A79E8"},children:"A random card is discarded instead of opponent choosing."})]})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const tg=({params:a,onChange:n})=>{var p,h,f,m;const l=((p=a.targetFilter)==null?void 0:p.owner)||"any",i=((h=a.targetFilter)==null?void 0:h.position)||"uncovered",c=(f=a.targetFilter)==null?void 0:f.valueEquals,d=a.selectLane||!1;return o.jsxs("div",{className:"param-editor",children:[o.jsx("h4",{children:"Return Effect"}),o.jsxs("label",{children:["Count",o.jsxs("select",{value:typeof a.count=="number"?a.count.toString():"all",onChange:g=>n({...a,count:g.target.value==="all"?"all":parseInt(g.target.value)}),children:[o.jsx("option",{value:"1",children:"1"}),o.jsx("option",{value:"2",children:"2"}),o.jsx("option",{value:"all",children:"All"})]})]}),o.jsxs("label",{children:["Whose cards?",o.jsxs("select",{value:l,onChange:g=>n({...a,targetFilter:{...a.targetFilter,owner:g.target.value}}),children:[o.jsx("option",{value:"any",children:"Any card (own or opponent)"}),o.jsx("option",{value:"own",children:"Only own cards"}),o.jsx("option",{value:"opponent",children:"Only opponent cards"})]})]}),o.jsxs("label",{children:["Position",o.jsxs("select",{value:i,onChange:g=>n({...a,targetFilter:{...a.targetFilter,position:g.target.value}}),children:[o.jsx("option",{value:"uncovered",children:"Uncovered (default)"}),o.jsx("option",{value:"covered",children:"Covered"}),o.jsx("option",{value:"any",children:"Any (covered or uncovered)"})]})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:d,onChange:g=>{if(g.target.checked)n({...a,selectLane:!0});else{const{selectLane:y,...w}=a;n(w)}}}),'Select lane first (Water-3: "in 1 line")']}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:c!==void 0,onChange:g=>{if(g.target.checked)n({...a,targetFilter:{...a.targetFilter,valueEquals:2}});else{const{valueEquals:y,...w}=a.targetFilter||{};n({...a,targetFilter:w})}}}),"Filter by value"]}),c!==void 0&&o.jsxs("label",{children:["Value to return",o.jsx("input",{type:"number",min:0,max:6,value:c,onChange:g=>n({...a,targetFilter:{...a.targetFilter,valueEquals:parseInt(g.target.value)||0}})})]}),o.jsx("h5",{children:"Advanced Conditional"}),o.jsxs("label",{children:["Conditional Type",o.jsxs("select",{value:((m=a.advancedConditional)==null?void 0:m.type)||"none",onChange:g=>{if(g.target.value==="none"){const{advancedConditional:y,...w}=a;n(w)}else n({...a,advancedConditional:{type:g.target.value}})},children:[o.jsx("option",{value:"none",children:"None"}),o.jsx("option",{value:"empty_hand",children:"Only if hand is empty"}),o.jsx("option",{value:"opponent_higher_value_in_lane",children:"Only if opponent has higher value in this lane"})]})]})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const ng=({params:a,onChange:n})=>{var i,c,d,p;const l=a.destinationRule||{type:"other_lines"};return o.jsxs("div",{className:"param-editor",children:[o.jsx("h4",{children:"Play Effect"}),o.jsxs("label",{children:["Actor (who plays)",o.jsxs("select",{value:a.actor||"self",onChange:h=>{if(h.target.value==="self"){const{actor:f,...m}=a;n(m)}else n({...a,actor:h.target.value})},children:[o.jsx("option",{value:"self",children:"You"}),o.jsx("option",{value:"opponent",children:"Opponent"})]})]}),o.jsxs("label",{children:["Source",o.jsxs("select",{value:a.source,onChange:h=>n({...a,source:h.target.value}),children:[o.jsx("option",{value:"hand",children:"Hand"}),o.jsx("option",{value:"deck",children:"Deck"})]})]}),o.jsxs("label",{children:["Anzahl",o.jsx("input",{type:"number",min:1,max:6,value:a.count,onChange:h=>n({...a,count:parseInt(h.target.value)||1})})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a.faceDown,onChange:h=>n({...a,faceDown:h.target.checked})}),"Face-down"]}),o.jsxs("label",{children:["Destination",o.jsxs("select",{value:l.type,onChange:h=>n({...a,destinationRule:{...l,type:h.target.value}}),children:[o.jsx("option",{value:"other_lines",children:"Other lines (choose 1)"}),o.jsx("option",{value:"each_other_line",children:"Each other line (1 per line)"}),o.jsx("option",{value:"specific_lane",children:"Specific lane (this line)"}),o.jsx("option",{value:"each_line_with_card",children:"Each line with card"}),o.jsx("option",{value:"line_with_matching_cards",children:"Line with matching cards (choose 1)"}),o.jsx("option",{value:"under_this_card",children:"Under this card"})]})]}),(l.type==="each_line_with_card"||l.type==="line_with_matching_cards")&&o.jsxs("label",{children:["Card Filter (which cards must be in line)",o.jsxs("select",{value:((i=l.cardFilter)==null?void 0:i.faceState)||"any",onChange:h=>{const f=h.target.value;if(f==="any"){const{cardFilter:m,...g}=l;n({...a,destinationRule:g})}else n({...a,destinationRule:{...l,cardFilter:{faceState:f}}})},children:[o.jsx("option",{value:"any",children:"Any card"}),o.jsx("option",{value:"face_down",children:"Face-down cards only"}),o.jsx("option",{value:"face_up",children:"Face-up cards only"})]})]}),o.jsxs("label",{children:["Condition",o.jsxs("select",{value:((c=a.condition)==null?void 0:c.type)||"none",onChange:h=>{const f=h.target.value;if(f==="none"){const{condition:m,...g}=a;n(g)}else n(f==="per_x_cards_in_line"?{...a,condition:{type:f,cardCount:2}}:{...a,condition:{type:f}})},children:[o.jsx("option",{value:"none",children:"None (always play)"}),o.jsx("option",{value:"per_x_cards_in_line",children:"For every X cards in this line"}),o.jsx("option",{value:"only_in_lines_with_cards",children:"Only in lines where you have a card"})]})]}),((d=a.condition)==null?void 0:d.type)==="per_x_cards_in_line"&&o.jsxs("label",{children:["Cards per play (X)",o.jsx("input",{type:"number",min:1,max:6,value:a.condition.cardCount||2,onChange:h=>n({...a,condition:{...a.condition,cardCount:parseInt(h.target.value)||2}})}),o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:'Example: "For every 2 cards in this line, play..."  X = 2'})]}),o.jsx("h5",{children:"Advanced Conditional"}),o.jsxs("label",{children:["Conditional Type",o.jsxs("select",{value:((p=a.advancedConditional)==null?void 0:p.type)||"none",onChange:h=>{if(h.target.value==="none"){const{advancedConditional:f,...m}=a;n(m)}else n({...a,advancedConditional:{type:h.target.value}})},children:[o.jsx("option",{value:"none",children:"None"}),o.jsx("option",{value:"empty_hand",children:"Only if hand is empty"}),o.jsx("option",{value:"opponent_higher_value_in_lane",children:"Only if opponent has higher value in this lane"})]})]})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const ag=({params:a,onChange:n})=>o.jsxs("div",{className:"param-editor",children:[o.jsx("h4",{children:"Protocol Effect"}),o.jsxs("label",{children:["Action",o.jsxs("select",{value:a.action,onChange:l=>n({...a,action:l.target.value}),children:[o.jsx("option",{value:"rearrange_protocols",children:"Rearrange"}),o.jsx("option",{value:"swap_protocols",children:"Swap"})]})]}),o.jsxs("label",{children:["Target",o.jsxs("select",{value:a.target,onChange:l=>n({...a,target:l.target.value}),children:[o.jsx("option",{value:"own",children:"Own"}),o.jsx("option",{value:"opponent",children:"Opponent"}),o.jsx("option",{value:"both_sequential",children:"Beide (nacheinander)"})]})]}),o.jsx("h5",{children:"Restriction (Anarchy-3)"}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:!!a.restriction,onChange:l=>{if(l.target.checked)n({...a,restriction:{disallowedProtocol:"",laneIndex:"current"}});else{const{restriction:i,...c}=a;n(c)}}}),"Add restriction (protocol cannot be on specific lane)"]}),a.restriction&&o.jsxs(o.Fragment,{children:[o.jsxs("label",{children:["Disallowed Protocol",o.jsx("input",{type:"text",value:a.restriction.disallowedProtocol,onChange:l=>n({...a,restriction:{...a.restriction,disallowedProtocol:l.target.value}}),placeholder:"e.g., Anarchy, Fire, Death"})]}),o.jsxs("label",{children:["Lane",o.jsxs("select",{value:a.restriction.laneIndex,onChange:l=>n({...a,restriction:{...a.restriction,laneIndex:l.target.value==="current"?"current":parseInt(l.target.value)}}),children:[o.jsx("option",{value:"current",children:"Current lane (where this card is)"}),o.jsx("option",{value:"0",children:"Lane 1 (Left)"}),o.jsx("option",{value:"1",children:"Lane 2 (Middle)"}),o.jsx("option",{value:"2",children:"Lane 3 (Right)"})]})]})]})]});/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const og=({params:a,onChange:n})=>o.jsxs("div",{className:"param-editor",children:[o.jsx("h4",{children:"Reveal/Give Effect"}),o.jsxs("label",{children:["Action",o.jsxs("select",{value:a.action,onChange:l=>n({...a,action:l.target.value}),children:[o.jsx("option",{value:"reveal",children:"Reveal"}),o.jsx("option",{value:"give",children:"Give"})]})]}),o.jsxs("label",{children:["Source",o.jsxs("select",{value:a.source,onChange:l=>n({...a,source:l.target.value}),children:[o.jsx("option",{value:"own_hand",children:"Your hand"}),o.jsx("option",{value:"opponent_hand",children:"Opponent's hand"}),o.jsx("option",{value:"own_deck_top",children:"Top of your deck"}),o.jsx("option",{value:"own_deck",children:"Your entire deck"}),o.jsx("option",{value:"board",children:"Board card"})]})]}),(a.source==="own_hand"||a.source==="opponent_hand"||a.source==="board")&&o.jsxs("label",{children:["Anzahl",o.jsx("input",{type:"number",min:1,max:6,value:a.count,onChange:l=>n({...a,count:parseInt(l.target.value)||1})})]}),a.source==="board"&&o.jsxs("label",{children:["Follow-up action",o.jsxs("select",{value:a.followUpAction||"none",onChange:l=>{if(l.target.value==="none"){const{followUpAction:i,...c}=a;n(c)}else n({...a,followUpAction:l.target.value})},children:[o.jsx("option",{value:"none",children:"None"}),o.jsx("option",{value:"flip",children:"Then flip"}),o.jsx("option",{value:"shift",children:"Then shift"})]})]})]});/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const rg=({params:a,onChange:n})=>o.jsxs("div",{className:"param-editor take-effect-editor",children:[o.jsx("h4",{children:"Take Effect Parameters"}),o.jsxs("label",{children:["Card Count",o.jsx("input",{type:"number",min:1,max:6,value:a.count,onChange:l=>n({...a,count:parseInt(l.target.value)||1})})]}),o.jsxs("label",{children:["Source",o.jsx("select",{value:a.source,onChange:l=>n({...a,source:l.target.value}),children:o.jsx("option",{value:"opponent_hand",children:"Opponent's Hand"})})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a.random,onChange:l=>n({...a,random:l.target.checked})}),"Random (if unchecked, you choose)"]})]}),ci=a=>{switch(a){case"draw":return{action:"draw",count:1,target:"self",source:"own_deck"};case"flip":return{action:"flip",count:1,targetFilter:{owner:"any",position:"any",faceState:"any",excludeSelf:!1},optional:!1};case"shift":return{action:"shift",targetFilter:{owner:"any",position:"any",faceState:"any"},destinationRestriction:{type:"any"}};case"delete":return{action:"delete",count:1,targetFilter:{position:"any",faceState:"any"},scope:{type:"anywhere"},excludeSelf:!1};case"discard":return{action:"discard",count:1,actor:"self"};case"return":return{action:"return",count:1,targetFilter:{},scope:{type:"any_card"}};case"play":return{action:"play",source:"hand",count:1,faceDown:!1,destinationRule:{type:"other_lines"}};case"rearrange_protocols":return{action:"rearrange_protocols",target:"own"};case"swap_protocols":return{action:"swap_protocols",target:"own"};case"reveal":case"give":return{action:a,source:"own_hand",count:1};case"take":return{action:"take",source:"opponent_hand",count:1,random:!0};default:return{}}},db=({params:a,onChange:n})=>{const[l,i]=re.useState(""),[c,d]=re.useState(""),[p,h]=re.useState(null),f=a.options||[],m=f[0],g=f[1],y=()=>{if(!l)return;const T={id:Qe(),params:ci(l),position:"middle",trigger:"on_play"};n({...a,options:[T,g].filter(Boolean)}),i(""),h(1)},w=()=>{if(!c)return;const T={id:Qe(),params:ci(c),position:"middle",trigger:"on_play"};n({...a,options:[m,T].filter(Boolean)}),d(""),h(2)},_=()=>{n({...a,options:[g].filter(Boolean)}),p===1&&h(null)},S=()=>{n({...a,options:[m].filter(Boolean)}),p===2&&h(null)},k=T=>{const A={...m,params:T};n({...a,options:[A,g].filter(Boolean)})},j=T=>{const A={...g,params:T};n({...a,options:[m,A].filter(Boolean)})},E=T=>{const A=ci(T),H={...m,params:A};n({...a,options:[H,g].filter(Boolean)})},C=T=>{const A=ci(T),H={...g,params:A};n({...a,options:[m,H].filter(Boolean)})},b=(T,A)=>{switch(T.params.action){case"draw":return o.jsx(Xy,{params:T.params,onChange:A});case"flip":return o.jsx(Zy,{params:T.params,onChange:A});case"shift":return o.jsx(Ky,{params:T.params,onChange:A});case"delete":return o.jsx(Jy,{params:T.params,onChange:A});case"discard":return o.jsx(eg,{params:T.params,onChange:A});case"return":return o.jsx(tg,{params:T.params,onChange:A});case"play":return o.jsx(ng,{params:T.params,onChange:A});case"rearrange_protocols":case"swap_protocols":return o.jsx(ag,{params:T.params,onChange:A});case"reveal":case"give":return o.jsx(og,{params:T.params,onChange:A});case"take":return o.jsx(rg,{params:T.params,onChange:A});default:return o.jsx("div",{children:"Unknown effect type"})}};return o.jsxs("div",{style:{padding:"10px",backgroundColor:"#2c1d63",borderRadius:"4px",border:"1px solid rgba(97, 239, 255, 0.3)"},children:[o.jsx("h4",{style:{color:"#61EFFF",marginTop:0},children:"Either/Or Choice"}),o.jsx("p",{style:{color:"#F0F0F0",fontSize:"14px",marginBottom:"15px"},children:'Player chooses one of two options. Example: "Either discard 1 card or flip this card"'}),o.jsxs("div",{style:{marginBottom:"15px",padding:"10px",backgroundColor:"rgba(97, 239, 255, 0.05)",borderRadius:"4px"},children:[o.jsx("label",{style:{color:"#61EFFF",display:"block",marginBottom:"10px",fontWeight:"bold"},children:"Option 1:"}),m?o.jsxs(o.Fragment,{children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"10px"},children:[o.jsxs("select",{value:m.params.action,onChange:T=>E(T.target.value),style:{flex:1,padding:"8px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px"},children:[o.jsx("option",{value:"draw",children:"Draw Cards"}),o.jsx("option",{value:"flip",children:"Flip Cards"}),o.jsx("option",{value:"shift",children:"Shift Card"}),o.jsx("option",{value:"delete",children:"Delete Cards"}),o.jsx("option",{value:"discard",children:"Discard Cards"}),o.jsx("option",{value:"return",children:"Return to Hand"}),o.jsx("option",{value:"play",children:"Play from Hand/Deck"})]}),o.jsx("button",{onClick:()=>h(p===1?null:1),style:{padding:"8px 15px",backgroundColor:p===1?"#8B0000":"#61EFFF",color:p===1?"#F0F0F0":"#0A051A",border:"none",borderRadius:"4px",cursor:"pointer",fontWeight:"bold"},children:p===1?"Hide":"Edit"}),o.jsx("button",{onClick:_,style:{padding:"8px 15px",backgroundColor:"#8B0000",color:"#F0F0F0",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Remove"})]}),p===1&&o.jsx("div",{style:{marginTop:"10px"},children:b(m,k)})]}):o.jsxs("div",{style:{display:"flex",gap:"10px"},children:[o.jsxs("select",{value:l,onChange:T=>i(T.target.value),style:{flex:1,padding:"8px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px"},children:[o.jsx("option",{value:"",children:"Choose Action"}),o.jsx("option",{value:"draw",children:"Draw Cards"}),o.jsx("option",{value:"flip",children:"Flip Cards"}),o.jsx("option",{value:"shift",children:"Shift Card"}),o.jsx("option",{value:"delete",children:"Delete Cards"}),o.jsx("option",{value:"discard",children:"Discard Cards"}),o.jsx("option",{value:"return",children:"Return to Hand"}),o.jsx("option",{value:"play",children:"Play from Hand/Deck"})]}),o.jsx("button",{onClick:y,disabled:!l,style:{padding:"8px 15px",backgroundColor:l?"#61EFFF":"#444",color:"#0A051A",border:"none",borderRadius:"4px",cursor:l?"pointer":"not-allowed",fontWeight:"bold"},children:"Add"})]})]}),o.jsxs("div",{style:{padding:"10px",backgroundColor:"rgba(97, 239, 255, 0.05)",borderRadius:"4px"},children:[o.jsx("label",{style:{color:"#61EFFF",display:"block",marginBottom:"10px",fontWeight:"bold"},children:"Option 2:"}),g?o.jsxs(o.Fragment,{children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"10px"},children:[o.jsxs("select",{value:g.params.action,onChange:T=>C(T.target.value),style:{flex:1,padding:"8px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px"},children:[o.jsx("option",{value:"draw",children:"Draw Cards"}),o.jsx("option",{value:"flip",children:"Flip Cards"}),o.jsx("option",{value:"shift",children:"Shift Card"}),o.jsx("option",{value:"delete",children:"Delete Cards"}),o.jsx("option",{value:"discard",children:"Discard Cards"}),o.jsx("option",{value:"return",children:"Return to Hand"}),o.jsx("option",{value:"play",children:"Play from Hand/Deck"})]}),o.jsx("button",{onClick:()=>h(p===2?null:2),style:{padding:"8px 15px",backgroundColor:p===2?"#8B0000":"#61EFFF",color:p===2?"#F0F0F0":"#0A051A",border:"none",borderRadius:"4px",cursor:"pointer",fontWeight:"bold"},children:p===2?"Hide":"Edit"}),o.jsx("button",{onClick:S,style:{padding:"8px 15px",backgroundColor:"#8B0000",color:"#F0F0F0",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Remove"})]}),p===2&&o.jsx("div",{style:{marginTop:"10px"},children:b(g,j)})]}):o.jsxs("div",{style:{display:"flex",gap:"10px"},children:[o.jsxs("select",{value:c,onChange:T=>d(T.target.value),style:{flex:1,padding:"8px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px"},children:[o.jsx("option",{value:"",children:"Choose Action"}),o.jsx("option",{value:"draw",children:"Draw Cards"}),o.jsx("option",{value:"flip",children:"Flip Cards"}),o.jsx("option",{value:"shift",children:"Shift Card"}),o.jsx("option",{value:"delete",children:"Delete Cards"}),o.jsx("option",{value:"discard",children:"Discard Cards"}),o.jsx("option",{value:"return",children:"Return to Hand"}),o.jsx("option",{value:"play",children:"Play from Hand/Deck"})]}),o.jsx("button",{onClick:w,disabled:!c,style:{padding:"8px 15px",backgroundColor:c?"#61EFFF":"#444",color:"#0A051A",border:"none",borderRadius:"4px",cursor:c?"pointer":"not-allowed",fontWeight:"bold"},children:"Add"})]})]}),f.length===2&&o.jsx("div",{style:{marginTop:"15px",padding:"10px",backgroundColor:"rgba(97, 239, 255, 0.1)",borderRadius:"4px"},children:o.jsx("p",{style:{color:"#61EFFF",fontSize:"14px",margin:0},children:" Both options configured. Player will choose one during gameplay."})})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const ub=({params:a,onChange:n})=>{var f,m,g,y,w,_;const l=((f=a.rule)==null?void 0:f.type)||"block_all_play",i=((m=a.rule)==null?void 0:m.target)||"opponent",c=((g=a.rule)==null?void 0:g.scope)||"this_lane",d=((y=a.rule)==null?void 0:y.onlyDuringYourTurn)||!1,p=((w=a.rule)==null?void 0:w.conditionTarget)||"self",h=((_=a.rule)==null?void 0:_.blockTarget)||"self";return o.jsxs("div",{className:"param-editor passive-rule-editor",children:[o.jsx("h4",{children:"Passive Rule Parameters"}),o.jsx("p",{style:{color:"#8A79E8",fontSize:"14px",marginBottom:"15px"},children:"This rule is active while the card is face-up. It modifies game behavior."}),o.jsxs("label",{children:["Rule Type",o.jsxs("select",{value:l,onChange:S=>n({...a,rule:{...a.rule,type:S.target.value,target:i,scope:c}}),children:[o.jsxs("optgroup",{label:"Play Restrictions",children:[o.jsx("option",{value:"block_face_down_play",children:"Block Face-Down Plays (Metal-2)"}),o.jsx("option",{value:"block_face_up_play",children:"Block Face-Up Plays"}),o.jsx("option",{value:"block_all_play",children:"Block All Plays (Plague-0)"}),o.jsx("option",{value:"require_face_down_play",children:"Require Face-Down Plays (Psychic-1)"})]}),o.jsxs("optgroup",{label:"Protocol Matching",children:[o.jsx("option",{value:"allow_any_protocol_play",children:"Allow Any Protocol (Spirit-1, Chaos-3)"}),o.jsx("option",{value:"allow_play_on_opponent_side",children:"Allow Play on Opponent Side (Corruption-0)"}),o.jsx("option",{value:"require_non_matching_protocol",children:"Require Non-Matching (Anarchy-1)"})]}),o.jsxs("optgroup",{label:"Action Blocks",children:[o.jsx("option",{value:"block_flips",children:"Block Flips (Frost-1)"}),o.jsx("option",{value:"block_protocol_rearrange",children:"Block Protocol Rearrange (Frost-1)"}),o.jsx("option",{value:"block_shifts_from_lane",children:"Block Shifts From Lane (Frost-3)"}),o.jsx("option",{value:"block_shifts_to_lane",children:"Block Shifts To Lane (Frost-3)"}),o.jsx("option",{value:"block_flip_this_card",children:"This Card Cannot Be Flipped"})]}),o.jsx("optgroup",{label:"Draw Restrictions",children:o.jsx("option",{value:"block_draw_conditional",children:"Conditional Draw Block"})}),o.jsx("optgroup",{label:"Effect Modifications",children:o.jsx("option",{value:"ignore_middle_commands",children:"Ignore Middle Commands (Apathy-2)"})}),o.jsx("optgroup",{label:"Phase Modifications",children:o.jsx("option",{value:"skip_check_cache_phase",children:"Skip Check Cache Phase (Spirit-0)"})})]})]}),o.jsxs("label",{children:["Affected Player",o.jsxs("select",{value:i,onChange:S=>n({...a,rule:{...a.rule,type:l,target:S.target.value,scope:c}}),children:[o.jsx("option",{value:"self",children:"Self (You)"}),o.jsx("option",{value:"opponent",children:"Opponent"}),o.jsx("option",{value:"all",children:"All Players"})]})]}),o.jsxs("label",{children:["Scope",o.jsxs("select",{value:c,onChange:S=>n({...a,rule:{...a.rule,type:l,target:i,scope:S.target.value,onlyDuringYourTurn:d}}),children:[o.jsx("option",{value:"this_lane",children:"This Lane Only"}),o.jsx("option",{value:"global",children:"Global (All Lanes)"})]})]}),l==="ignore_middle_commands"&&o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:d,onChange:S=>n({...a,rule:{...a.rule,type:l,target:i,scope:c,onlyDuringYourTurn:S.target.checked}})}),"Only during your turn",o.jsx("small",{style:{display:"block",marginLeft:"24px",marginTop:"4px",color:"#8A79E8"},children:"Effect only applies during card owner's turn, not during opponent's turn."})]}),l==="block_draw_conditional"&&o.jsxs(o.Fragment,{children:[o.jsxs("label",{children:["Condition (who must have cards in hand)",o.jsxs("select",{value:p,onChange:S=>n({...a,rule:{...a.rule,type:l,target:"this_card",scope:"global",conditionTarget:S.target.value,blockTarget:h}}),children:[o.jsx("option",{value:"self",children:"Card owner (you)"}),o.jsx("option",{value:"opponent",children:"Opponent of card owner"})]}),o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"If this player has any cards in hand, the draw block activates."})]}),o.jsxs("label",{children:["Block target (who cannot draw)",o.jsxs("select",{value:h,onChange:S=>n({...a,rule:{...a.rule,type:l,target:"this_card",scope:"global",conditionTarget:p,blockTarget:S.target.value}}),children:[o.jsx("option",{value:"self",children:"Card owner (you)"}),o.jsx("option",{value:"opponent",children:"Opponent of card owner"}),o.jsx("option",{value:"all",children:"Both players"})]}),o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"This player cannot draw cards when the condition is met."})]})]}),l==="block_flip_this_card"&&o.jsx("small",{style:{display:"block",marginTop:"8px",color:"#8A79E8"},children:"This card cannot be flipped by any effect. Only affects this specific card."})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const pb=({params:a,onChange:n})=>{var y,w,_,S,k,j,E,C,b;const l=((y=a.modifier)==null?void 0:y.type)||"add_per_condition",i=((w=a.modifier)==null?void 0:w.value)||1,c=((_=a.modifier)==null?void 0:_.condition)||"per_face_down_card",d=((S=a.modifier)==null?void 0:S.target)||"own_total",p=((k=a.modifier)==null?void 0:k.scope)||"this_lane",h=((E=(j=a.modifier)==null?void 0:j.filter)==null?void 0:E.faceState)||"face_down",f=((b=(C=a.modifier)==null?void 0:C.filter)==null?void 0:b.position)||"any",m=l==="add_per_condition",g=l==="set_to_fixed"&&(d==="own_cards"||d==="opponent_cards"||d==="all_cards");return o.jsxs("div",{className:"param-editor value-modifier-editor",children:[o.jsx("h4",{children:"Value Modifier Parameters"}),o.jsx("p",{style:{color:"#8A79E8",fontSize:"14px",marginBottom:"15px"},children:"This modifier is active while the card is face-up. It modifies card values or lane totals."}),o.jsxs("label",{children:["Modifier Type",o.jsxs("select",{value:l,onChange:T=>n({...a,modifier:{...a.modifier,type:T.target.value,value:i,condition:m?c:void 0,target:d,scope:p,filter:g?{faceState:h,position:f}:void 0}}),children:[o.jsx("option",{value:"add_per_condition",children:"Add Per Condition (Apathy-0: +1 per face-down)"}),o.jsx("option",{value:"set_to_fixed",children:"Set Cards To Fixed Value (Darkness-2: face-down = 4)"}),o.jsx("option",{value:"add_to_total",children:"Add To Lane Total (Metal-0: opponent total -2)"})]})]}),o.jsxs("label",{children:["Value",o.jsx("input",{type:"number",value:i,onChange:T=>n({...a,modifier:{...a.modifier,type:l,value:parseInt(T.target.value)||0,condition:m?c:void 0,target:d,scope:p,filter:g?{faceState:h,position:f}:void 0}}),style:{width:"100%",padding:"8px",marginTop:"5px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px"}}),o.jsxs("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:[l==="add_per_condition"&&"Value to add per condition (e.g., +1)",l==="set_to_fixed"&&"Fixed value to set cards to (e.g., 4)",l==="add_to_total"&&"Value to add to total (use negative for subtraction, e.g., -2)"]})]}),m&&o.jsxs("label",{children:["Condition",o.jsxs("select",{value:c,onChange:T=>n({...a,modifier:{...a.modifier,type:l,value:i,condition:T.target.value,target:d,scope:p,filter:g?{faceState:h,position:f}:void 0}}),children:[o.jsx("option",{value:"per_face_down_card",children:"Per Face-Down Card"}),o.jsx("option",{value:"per_face_up_card",children:"Per Face-Up Card"}),o.jsx("option",{value:"per_card",children:"Per Card (any)"}),o.jsx("option",{value:"per_card_in_hand",children:"Per Card in Your Hand"})]})]}),o.jsxs("label",{children:["Target",o.jsxs("select",{value:d,onChange:T=>n({...a,modifier:{...a.modifier,type:l,value:i,condition:m?c:void 0,target:T.target.value,scope:p,filter:g?{faceState:h,position:f}:void 0}}),children:[o.jsxs("optgroup",{label:"Card Values",children:[o.jsx("option",{value:"own_cards",children:"Own Cards"}),o.jsx("option",{value:"opponent_cards",children:"Opponent Cards"}),o.jsx("option",{value:"all_cards",children:"All Cards"})]}),o.jsxs("optgroup",{label:"Lane Totals",children:[o.jsx("option",{value:"own_total",children:"Own Total"}),o.jsx("option",{value:"opponent_total",children:"Opponent Total"})]})]})]}),g&&o.jsxs(o.Fragment,{children:[o.jsxs("label",{children:["Card Face State (Filter)",o.jsxs("select",{value:h,onChange:T=>n({...a,modifier:{...a.modifier,type:l,value:i,condition:m?c:void 0,target:d,scope:p,filter:{faceState:T.target.value,position:f}}}),children:[o.jsx("option",{value:"face_down",children:"Face-Down Only"}),o.jsx("option",{value:"face_up",children:"Face-Up Only"}),o.jsx("option",{value:"any",children:"Any"})]})]}),o.jsxs("label",{children:["Card Position (Filter)",o.jsxs("select",{value:f,onChange:T=>n({...a,modifier:{...a.modifier,type:l,value:i,condition:m?c:void 0,target:d,scope:p,filter:{faceState:h,position:T.target.value}}}),children:[o.jsx("option",{value:"any",children:"Any Position"}),o.jsx("option",{value:"covered",children:"Covered Only"}),o.jsx("option",{value:"uncovered",children:"Uncovered Only"})]})]})]}),o.jsxs("label",{children:["Scope",o.jsxs("select",{value:p,onChange:T=>n({...a,modifier:{...a.modifier,type:l,value:i,condition:m?c:void 0,target:d,scope:T.target.value,filter:g?{faceState:h,position:f}:void 0}}),children:[o.jsx("option",{value:"this_lane",children:"This Lane Only"}),o.jsx("option",{value:"global",children:"Global (All Lanes)"})]})]})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const fb=({params:a,onChange:n})=>o.jsxs("div",{className:"param-editor block-compile-effect-editor",children:[o.jsx("h4",{children:"Block Compile Effect Parameters"}),o.jsxs("label",{children:["Target",o.jsxs("select",{value:a.target||"opponent",onChange:l=>n({...a,target:l.target.value}),children:[o.jsx("option",{value:"opponent",children:"Opponent cannot compile next turn"}),o.jsx("option",{value:"self",children:"You cannot compile next turn"})]})]})]});/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const hb=({params:a,onChange:n})=>{var i;const l=((i=a.laneCondition)==null?void 0:i.count)||8;return o.jsxs("div",{className:"param-editor delete-all-in-lane-effect-editor",children:[o.jsx("h4",{children:"Delete All In Lane Effect Parameters"}),o.jsxs("label",{children:["Minimum cards in lane",o.jsxs("select",{value:l,onChange:c=>n({...a,laneCondition:{type:"min_cards",count:parseInt(c.target.value)}}),children:[o.jsx("option",{value:0,children:"No minimum (any lane)"}),o.jsx("option",{value:4,children:"4 or more cards"}),o.jsx("option",{value:6,children:"6 or more cards"}),o.jsx("option",{value:8,children:"8 or more cards (Metal-3)"}),o.jsx("option",{value:10,children:"10 or more cards"})]})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a.excludeCurrentLane!==!1,onChange:c=>n({...a,excludeCurrentLane:c.target.checked})}),"Exclude current lane (other lanes only)"]})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const mb=({params:a,onChange:n})=>o.jsxs("div",{className:"param-editor",children:[o.jsx("h4",{children:"Shuffle Trash Effect"}),o.jsx("p",{style:{color:"#8A79E8",fontSize:"14px",marginBottom:"15px"},children:"Shuffle your trash (discarded/deleted cards) back into your deck."}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a.optional!==!1,onChange:l=>n({...a,optional:l.target.checked})}),'Optional ("You may shuffle...")']})]}),yb=({params:a})=>o.jsxs("div",{className:"param-editor",children:[o.jsx("h4",{children:"Shuffle Deck Effect"}),o.jsx("p",{style:{color:"#8A79E8",fontSize:"14px",marginBottom:"15px"},children:"Shuffle your deck. Typically used after revealing the deck."})]}),di=a=>{switch(a){case"draw":return{action:"draw",count:1,target:"self",source:"own_deck"};case"refresh":return{action:"refresh",target:"self"};case"mutual_draw":return{action:"mutual_draw",count:1};case"flip":return{action:"flip",count:1,targetFilter:{owner:"any",position:"any",faceState:"any",excludeSelf:!1},optional:!1};case"shift":return{action:"shift",targetFilter:{owner:"any",position:"any",faceState:"any"},destinationRestriction:{type:"any"}};case"delete":return{action:"delete",count:1,targetFilter:{position:"any",faceState:"any"},scope:{type:"anywhere"},excludeSelf:!1};case"discard":return{action:"discard",count:1,actor:"self"};case"return":return{action:"return",count:1,targetFilter:{},scope:{type:"any_card"}};case"play":return{action:"play",source:"hand",count:1,faceDown:!1,destinationRule:{type:"other_lines"}};case"rearrange_protocols":return{action:"rearrange_protocols",target:"own"};case"swap_protocols":return{action:"swap_protocols",target:"own"};case"reveal":case"give":return{action:a,source:"own_hand",count:1};case"take":return{action:"take",source:"opponent_hand",count:1,random:!0};case"choice":return{action:"choice",options:[]};case"passive_rule":return{action:"passive_rule",rule:{type:"block_all_play",target:"opponent",scope:"this_lane"}};case"value_modifier":return{action:"value_modifier",modifier:{type:"add_per_condition",value:1,condition:"per_face_down_card",target:"own_total",scope:"this_lane"}};case"block_compile":return{action:"block_compile",target:"opponent"};case"delete_all_in_lane":return{action:"delete_all_in_lane",laneCondition:{type:"min_cards",count:8},excludeCurrentLane:!0};case"shuffle_trash":return{action:"shuffle_trash",optional:!0};case"shuffle_deck":return{action:"shuffle_deck"};case"redirect_return_to_deck":return{action:"redirect_return_to_deck",faceDown:!0};default:return{}}},gb=({effect:a,onChange:n,readOnly:l=!1})=>{const i=_=>{l||n({...a,params:_})},c=_=>{if(_){const S={id:Qe(),params:di("draw"),position:a.position,trigger:a.trigger};n({...a,conditional:{type:"then",thenEffect:S}})}else{const{conditional:S,...k}=a;n(k)}},d=_=>{a.conditional&&n({...a,conditional:{...a.conditional,type:_}})},p=_=>{a.conditional&&n({...a,conditional:{...a.conditional,thenEffect:_}})},h=_=>{if(!a.conditional)return;const S=di(_),k={...a.conditional.thenEffect,params:S};n({...a,conditional:{...a.conditional,thenEffect:k}})},f=_=>{if(a.conditional)if(_){const S={id:Qe(),params:di("delete"),position:a.position,trigger:a.trigger};n({...a,conditional:{...a.conditional,thenEffect:{...a.conditional.thenEffect,conditional:{type:"then",thenEffect:S}}}})}else{const{conditional:S,...k}=a.conditional.thenEffect;n({...a,conditional:{...a.conditional,thenEffect:k}})}},m=_=>{var S;(S=a.conditional)!=null&&S.thenEffect.conditional&&n({...a,conditional:{...a.conditional,thenEffect:{...a.conditional.thenEffect,conditional:{...a.conditional.thenEffect.conditional,type:_}}}})},g=_=>{var S;(S=a.conditional)!=null&&S.thenEffect.conditional&&n({...a,conditional:{...a.conditional,thenEffect:{...a.conditional.thenEffect,conditional:{...a.conditional.thenEffect.conditional,thenEffect:_}}}})},y=_=>{var j;if(!((j=a.conditional)!=null&&j.thenEffect.conditional))return;const S=di(_),k={...a.conditional.thenEffect.conditional.thenEffect,params:S};n({...a,conditional:{...a.conditional,thenEffect:{...a.conditional.thenEffect,conditional:{...a.conditional.thenEffect.conditional,thenEffect:k}}}})},w=(_,S)=>{switch(_.params.action){case"draw":return o.jsx(Xy,{params:_.params,onChange:S});case"refresh":return o.jsx(ib,{params:_.params,onChange:S});case"mutual_draw":return o.jsx(cb,{params:_.params,onChange:S});case"flip":return o.jsx(Zy,{params:_.params,onChange:S});case"shift":return o.jsx(Ky,{params:_.params,onChange:S});case"delete":return o.jsx(Jy,{params:_.params,onChange:S});case"discard":return o.jsx(eg,{params:_.params,onChange:S});case"return":return o.jsx(tg,{params:_.params,onChange:S});case"play":return o.jsx(ng,{params:_.params,onChange:S});case"rearrange_protocols":case"swap_protocols":return o.jsx(ag,{params:_.params,onChange:S});case"reveal":case"give":return o.jsx(og,{params:_.params,onChange:S});case"take":return o.jsx(rg,{params:_.params,onChange:S});case"choice":return o.jsx(db,{params:_.params,onChange:S});case"passive_rule":return o.jsx(ub,{params:_.params,onChange:S});case"value_modifier":return o.jsx(pb,{params:_.params,onChange:S});case"block_compile":return o.jsx(fb,{params:_.params,onChange:S});case"delete_all_in_lane":return o.jsx(hb,{params:_.params,onChange:S});case"shuffle_trash":return o.jsx(mb,{params:_.params,onChange:S});case"shuffle_deck":return o.jsx(yb,{params:_.params,onChange:S});default:return o.jsxs("div",{children:["Unknown effect type: ",_.params.action]})}};return o.jsxs("div",{className:`effect-editor ${l?"read-only-mode":""}`,children:[o.jsx("div",{className:"trigger-info",style:{marginBottom:"15px",padding:"10px",backgroundColor:"#1A113B",borderRadius:"4px",border:"1px solid rgba(97, 239, 255, 0.3)"},children:o.jsxs("div",{style:{display:"flex",gap:"20px",alignItems:"center",flexWrap:"wrap"},children:[o.jsxs("label",{style:{flex:1,minWidth:"200px"},children:[o.jsx("strong",{children:"Trigger:"}),o.jsxs("select",{value:a.trigger,onChange:_=>!l&&n({...a,trigger:_.target.value}),disabled:l,style:{width:"100%",padding:"6px",marginTop:"4px",backgroundColor:"#2c1d63",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px"},children:[o.jsx("optgroup",{label:"Immediate",children:o.jsx("option",{value:"on_play",children:"On Play"})}),o.jsx("optgroup",{label:"Passive (Top Box)",children:o.jsx("option",{value:"passive",children:"Passive (always active)"})}),o.jsxs("optgroup",{label:"Phase Triggers (Bottom Box)",children:[o.jsx("option",{value:"start",children:"Start Phase"}),o.jsx("option",{value:"end",children:"End Phase"}),o.jsx("option",{value:"on_cover",children:"When Covered"})]}),o.jsxs("optgroup",{label:"Reactive (Top Box)",children:[o.jsx("option",{value:"on_flip",children:"When this card would be flipped"}),o.jsx("option",{value:"on_cover_or_flip",children:"When covered or flipped"}),o.jsx("option",{value:"after_delete",children:"After cards are deleted"}),o.jsx("option",{value:"after_discard",children:"After cards are discarded"}),o.jsx("option",{value:"after_draw",children:"After cards are drawn"}),o.jsx("option",{value:"after_shift",children:"After cards are shifted"}),o.jsx("option",{value:"after_flip",children:"After cards are flipped"}),o.jsx("option",{value:"after_play",children:"After a card is played"}),o.jsx("option",{value:"after_clear_cache",children:"After cache is cleared"}),o.jsx("option",{value:"after_opponent_discard",children:"After opponent discards"}),o.jsx("option",{value:"before_compile_delete",children:"Before deleted by compile"}),o.jsx("option",{value:"when_card_returned",children:"When card returned to hand"})]})]})]}),o.jsxs("div",{style:{color:"#8A79E8",fontSize:"13px"},children:[o.jsx("strong",{children:"Position:"})," ",a.position.charAt(0).toUpperCase()+a.position.slice(1)," Box"]})]})}),o.jsxs("div",{className:"main-effect",children:[o.jsx("h3",{children:"Main Effect"}),w(a,i),o.jsxs("div",{className:"effect-preview",children:[o.jsx("strong",{children:"Preview:"})," ",o.jsx("span",{dangerouslySetInnerHTML:{__html:Yo([a])}})]})]}),o.jsxs("div",{style:{marginTop:"15px"},children:[o.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[o.jsx("input",{type:"checkbox",checked:!!a.useCardFromPreviousEffect,onChange:_=>n({...a,useCardFromPreviousEffect:_.target.checked})}),o.jsx("span",{children:`Use card from previous effect (for "shift THAT card", "draw equal to THAT card's value", etc.)`})]}),a.useCardFromPreviousEffect&&o.jsx("small",{style:{display:"block",marginLeft:"24px",marginTop:"4px",color:"#8A79E8"},children:"This effect will target/use the card selected by the previous effect in the chain."})]}),(a.trigger==="after_draw"||a.trigger==="after_delete"||a.trigger==="after_discard"||a.trigger==="after_shift"||a.trigger==="after_flip"||a.trigger==="after_clear_cache"||a.trigger==="after_opponent_discard"||a.trigger==="after_play")&&o.jsxs("div",{style:{marginTop:"15px"},children:[o.jsxs("label",{children:["Trigger Actor (who triggers this effect?)",o.jsxs("select",{value:a.reactiveTriggerActor||"self",onChange:_=>n({...a,reactiveTriggerActor:_.target.value}),style:{width:"100%",padding:"8px",marginTop:"5px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px",cursor:"pointer"},children:[o.jsx("option",{value:"self",children:"Only when YOU perform the action (default)"}),o.jsx("option",{value:"opponent",children:"Only when OPPONENT performs the action"}),o.jsx("option",{value:"any",children:"When ANYONE performs the action"})]})]}),o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:a.reactiveTriggerActor==="self"||!a.reactiveTriggerActor?"Effect triggers only when YOU delete/draw/etc.":a.reactiveTriggerActor==="opponent"?"Effect triggers only when OPPONENT deletes/draws/etc.":"Effect triggers when ANYONE deletes/draws/etc."})]}),(a.trigger==="after_play"||a.trigger==="after_shift"||a.trigger==="after_flip"||a.trigger==="after_delete")&&o.jsxs("div",{style:{marginTop:"15px"},children:[o.jsxs("label",{children:["Reactive Scope",o.jsxs("select",{value:a.reactiveScope||"global",onChange:_=>n({...a,reactiveScope:_.target.value}),style:{width:"100%",padding:"8px",marginTop:"5px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px",cursor:"pointer"},children:[o.jsx("option",{value:"global",children:"Any lane (default)"}),o.jsx("option",{value:"this_lane",children:"This lane only"})]})]}),o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:a.reactiveScope==="this_lane"?"Effect only triggers when the action happens in the same lane as this card.":"Effect triggers when the action happens anywhere on the board."})]}),o.jsxs("div",{className:"conditional-section",style:{marginTop:"20px",borderTop:"1px solid #2c1d63",paddingTop:"15px"},children:[o.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"10px"},children:[o.jsx("input",{type:"checkbox",checked:!!a.conditional,onChange:_=>c(_.target.checked)}),o.jsx("strong",{children:"Add follow-up effect"})]}),a.conditional&&o.jsxs("div",{className:"follow-up-effect",style:{marginLeft:"20px",padding:"10px",backgroundColor:"#2c1d63",borderRadius:"4px",border:"1px solid rgba(97, 239, 255, 0.2)"},children:[o.jsx("h4",{style:{marginTop:0},children:"Follow-Up Effect"}),o.jsxs("label",{children:["Connection Type",o.jsxs("select",{value:a.conditional.type||"then",onChange:_=>d(_.target.value),style:{width:"100%",padding:"8px",marginTop:"5px",marginBottom:"15px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px",cursor:"pointer"},children:[o.jsx("option",{value:"then",children:"Then (always executes)"}),o.jsx("option",{value:"if_executed",children:"If you do (only if first effect succeeds)"})]})]}),o.jsxs("label",{children:["Effect Type",o.jsxs("select",{value:a.conditional.thenEffect.params.action,onChange:_=>h(_.target.value),style:{width:"100%",padding:"8px",marginTop:"5px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px",cursor:"pointer"},children:[o.jsx("option",{value:"draw",children:"Draw Cards"}),o.jsx("option",{value:"refresh",children:"Refresh Hand"}),o.jsx("option",{value:"mutual_draw",children:"Mutual Draw (Exchange)"}),o.jsx("option",{value:"flip",children:"Flip Cards"}),o.jsx("option",{value:"shift",children:"Shift Card"}),o.jsx("option",{value:"delete",children:"Delete Cards"}),o.jsx("option",{value:"delete_all_in_lane",children:"Delete All in Lane"}),o.jsx("option",{value:"discard",children:"Discard Cards"}),o.jsx("option",{value:"return",children:"Return to Hand"}),o.jsx("option",{value:"play",children:"Play from Hand/Deck"}),o.jsx("option",{value:"rearrange_protocols",children:"Rearrange Protocols"}),o.jsx("option",{value:"swap_protocols",children:"Swap Protocols"}),o.jsx("option",{value:"reveal",children:"Reveal Hand"}),o.jsx("option",{value:"give",children:"Give Cards"}),o.jsx("option",{value:"take",children:"Take from Hand"}),o.jsx("option",{value:"choice",children:"Either/Or Choice"}),o.jsx("option",{value:"block_compile",children:"Block Compile"}),o.jsx("option",{value:"shuffle_trash",children:"Shuffle Trash into Deck"}),o.jsx("option",{value:"shuffle_deck",children:"Shuffle Deck"})]})]}),o.jsx("div",{style:{marginTop:"15px"},children:w(a.conditional.thenEffect,_=>p({...a.conditional.thenEffect,params:_}))}),o.jsxs("div",{className:"nested-conditional-section",style:{marginTop:"15px",borderTop:"1px solid rgba(97, 239, 255, 0.2)",paddingTop:"15px"},children:[o.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"10px"},children:[o.jsx("input",{type:"checkbox",checked:!!a.conditional.thenEffect.conditional,onChange:_=>f(_.target.checked)}),o.jsx("strong",{children:"Add 2nd follow-up effect"})]}),a.conditional.thenEffect.conditional&&o.jsxs("div",{className:"nested-follow-up-effect",style:{marginLeft:"10px",padding:"10px",backgroundColor:"#1A113B",borderRadius:"4px",border:"1px solid rgba(97, 239, 255, 0.2)"},children:[o.jsx("h5",{style:{marginTop:0,fontSize:"0.9rem"},children:"2nd Follow-Up Effect"}),o.jsxs("label",{children:["Connection Type",o.jsxs("select",{value:a.conditional.thenEffect.conditional.type||"then",onChange:_=>m(_.target.value),style:{width:"100%",padding:"6px",marginTop:"5px",marginBottom:"10px",backgroundColor:"#0D0825",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px",cursor:"pointer",fontSize:"0.9rem"},children:[o.jsx("option",{value:"then",children:"Then (always executes)"}),o.jsx("option",{value:"if_executed",children:"If you do (only if first effect succeeds)"})]})]}),o.jsxs("label",{children:["Effect Type",o.jsxs("select",{value:a.conditional.thenEffect.conditional.thenEffect.params.action,onChange:_=>y(_.target.value),style:{width:"100%",padding:"6px",marginTop:"5px",backgroundColor:"#0D0825",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px",cursor:"pointer",fontSize:"0.9rem"},children:[o.jsx("option",{value:"draw",children:"Draw Cards"}),o.jsx("option",{value:"refresh",children:"Refresh Hand"}),o.jsx("option",{value:"mutual_draw",children:"Mutual Draw (Exchange)"}),o.jsx("option",{value:"flip",children:"Flip Cards"}),o.jsx("option",{value:"shift",children:"Shift Card"}),o.jsx("option",{value:"delete",children:"Delete Cards"}),o.jsx("option",{value:"delete_all_in_lane",children:"Delete All in Lane"}),o.jsx("option",{value:"discard",children:"Discard Cards"}),o.jsx("option",{value:"return",children:"Return to Hand"}),o.jsx("option",{value:"play",children:"Play from Hand/Deck"}),o.jsx("option",{value:"rearrange_protocols",children:"Rearrange Protocols"}),o.jsx("option",{value:"swap_protocols",children:"Swap Protocols"}),o.jsx("option",{value:"reveal",children:"Reveal Hand"}),o.jsx("option",{value:"give",children:"Give Cards"}),o.jsx("option",{value:"take",children:"Take from Hand"}),o.jsx("option",{value:"choice",children:"Either/Or Choice"}),o.jsx("option",{value:"block_compile",children:"Block Compile"}),o.jsx("option",{value:"shuffle_trash",children:"Shuffle Trash into Deck"}),o.jsx("option",{value:"shuffle_deck",children:"Shuffle Deck"})]})]}),o.jsx("div",{style:{marginTop:"10px"},children:w(a.conditional.thenEffect.conditional.thenEffect,_=>g({...a.conditional.thenEffect.conditional.thenEffect,params:_}))})]})]})]})]})]})},vb=({card:a,protocolName:n,protocolColor:l,protocolPattern:i,onChange:c,readOnly:d=!1})=>{const[p,h]=re.useState(null),[f,m]=re.useState(null),[g,y]=re.useState(!1);re.useEffect(()=>{h(null)},[a.value]);const w=(N,D,P)=>{const L={id:Qe(),params:_b(D),position:N,trigger:P},R={...a};N==="top"?R.topEffects=[...R.topEffects,L]:N==="middle"?R.middleEffects=[...R.middleEffects,L]:R.bottomEffects=[...R.bottomEffects,L],c(R);const O=N==="top"?R.topEffects.length-1:N==="middle"?R.middleEffects.length-1:R.bottomEffects.length-1;h({box:N,effectIndex:O,effect:L})},_=(N,D)=>{m({box:N,effectIndex:D})},S=()=>{if(!f)return;const{box:N,effectIndex:D}=f,P={...a};N==="top"?P.topEffects.splice(D,1):N==="middle"?P.middleEffects.splice(D,1):P.bottomEffects.splice(D,1),c(P),p&&p.box===N&&p.effectIndex===D&&h(null),m(null)},k=N=>{if(!p)return;const{box:D,effectIndex:P}=p,L={...a};D==="top"?(L.topEffects=[...L.topEffects],L.topEffects[P]=N):D==="middle"?(L.middleEffects=[...L.middleEffects],L.middleEffects[P]=N):(L.bottomEffects=[...L.bottomEffects],L.bottomEffects[P]=N),c(L),h({box:D,effectIndex:P,effect:N})},j=(N,D)=>{const P=N==="top"?a.topEffects[D]:N==="middle"?a.middleEffects[D]:a.bottomEffects[D];h({box:N,effectIndex:D,effect:P})},E=(N,D)=>{const P=(D==null?void 0:D.reactiveTriggerActor)||"self",L=(D==null?void 0:D.reactiveScope)||"global";if(N==="after_play")return`After ${P==="opponent"?"your opponent plays":P==="any"?"a card is played":"you play"} a card${L==="this_lane"?" in this line":""}`;if(["after_delete","after_discard","after_draw","after_shift","after_flip"].includes(N)){const R={after_delete:"delete cards",after_discard:"discard cards",after_draw:"draw cards",after_shift:"shift cards",after_flip:"flip cards"},O=P==="opponent"?"your opponent":P==="any"?"anyone":"you",Z=L==="this_lane"?" in this line":"";return`After ${O} ${R[N]}${Z}`}switch(N){case"passive":return"";case"on_play":return"";case"start":return"Start";case"end":return"End";case"on_cover":return"On Cover";case"after_opponent_discard":return"After opponent discards";case"after_clear_cache":return"After you clear cache";case"before_compile_delete":return"Before deleted by compile";case"on_flip":return"When this card would be flipped";case"on_cover_or_flip":return"When covered or flipped";default:return N}},C=N=>{const D={...a,value:N};c(D)},b=Yo(a.topEffects),T=Yo(a.middleEffects),A=Yo(a.bottomEffects),H=JSON.stringify({top:a.topEffects.map(N=>({id:N.id,params:N.params})),middle:a.middleEffects.map(N=>({id:N.id,params:N.params})),bottom:a.bottomEffects.map(N=>({id:N.id,params:N.params}))}),$=`${n}-${a.value}-${H}`,B={id:$,protocol:n,value:a.value,top:b,middle:T,bottom:A,isFaceUp:!0,owner:"player",laneIndex:0,category:"Custom",keywords:{}},X=(N,D)=>{N=N.replace("#","");const P=parseInt(N.substring(0,2),16),L=parseInt(N.substring(2,4),16),R=parseInt(N.substring(4,6),16);return`rgba(${P}, ${L}, ${R}, ${D})`},I=`card-custom-preview pattern-${i}`,F={"--custom-color":l,"--custom-color-alpha-05":X(l,.05),"--custom-color-alpha-06":X(l,.06),"--custom-color-alpha-08":X(l,.08),"--custom-color-alpha-10":X(l,.1),"--custom-color-alpha-15":X(l,.15),"--custom-color-alpha-20":X(l,.2),"--custom-color-alpha-25":X(l,.25),borderColor:l};return o.jsxs("div",{className:"card-editor-container",children:[o.jsxs("div",{className:"card-editor-content",children:[o.jsxs("div",{className:"card-live-preview",children:[o.jsx("h4",{children:"Card Preview"}),o.jsxs("label",{className:"card-value-selector",children:["Card Value:",o.jsxs("select",{value:a.value,onChange:N=>C(Number(N.target.value)),children:[o.jsx("option",{value:-1,children:"-1"}),o.jsx("option",{value:0,children:"0"}),o.jsx("option",{value:1,children:"1"}),o.jsx("option",{value:2,children:"2"}),o.jsx("option",{value:3,children:"3"}),o.jsx("option",{value:4,children:"4"}),o.jsx("option",{value:5,children:"5"}),o.jsx("option",{value:6,children:"6"})]})]}),o.jsx("div",{className:"card-preview-wrapper",style:F,children:o.jsx(Ct,{card:B,isFaceUp:!0,additionalClassName:I},$)})]}),o.jsx("div",{className:"card-effects-editor",children:o.jsxs("div",{className:"card-preview",style:{borderColor:l},children:[o.jsx("div",{className:"card-header",style:{backgroundColor:l},children:o.jsxs("h3",{children:[n,"-",a.value]})}),o.jsxs("div",{className:"card-box top-box",children:[o.jsx("h4",{children:"Top Box (Passive/Reactive)"}),o.jsx("p",{className:"box-description",children:"Passive effects or reactive triggers"}),o.jsxs("div",{className:"effects-list",children:[a.topEffects.map((N,D)=>o.jsxs("div",{className:"effect-item",children:[o.jsxs("span",{onClick:()=>j("top",D),className:d?"read-only-clickable":"",children:[N.trigger!=="passive"&&o.jsxs("strong",{children:[E(N.trigger,N),":"]})," ",Ir(N)]}),!d&&o.jsx("button",{onClick:()=>_("top",D),children:""})]},N.id)),a.topEffects.length===0&&o.jsx("p",{className:"empty-box",children:"No effects"})]}),!d&&o.jsxs("div",{className:"add-effect-controls",children:[o.jsxs("select",{id:"top-trigger",defaultValue:"",children:[o.jsx("option",{value:"",children:"Choose Trigger"}),o.jsx("optgroup",{label:"Passive",children:o.jsx("option",{value:"passive",children:"Passive (always active)"})}),o.jsxs("optgroup",{label:"Phase Triggers",children:[o.jsx("option",{value:"start",children:"Start Phase"}),o.jsx("option",{value:"end",children:"End Phase"}),o.jsx("option",{value:"on_cover",children:"On Cover"})]}),o.jsxs("optgroup",{label:"Reactive Triggers",children:[o.jsx("option",{value:"after_delete",children:"After you delete cards"}),o.jsx("option",{value:"after_opponent_discard",children:"After opponent discards"}),o.jsx("option",{value:"after_draw",children:"After you draw cards"}),o.jsx("option",{value:"after_clear_cache",children:"After you clear cache"}),o.jsx("option",{value:"before_compile_delete",children:"Before deleted by compile"}),o.jsx("option",{value:"after_flip",children:"After cards are flipped"}),o.jsx("option",{value:"after_shift",children:"After cards are shifted"}),o.jsx("option",{value:"after_play",children:"After cards are played"}),o.jsx("option",{value:"on_flip",children:"When this card would be flipped"}),o.jsx("option",{value:"on_cover_or_flip",children:"When this card would be covered or flipped"})]})]}),o.jsxs("select",{id:"top-action",defaultValue:"",children:[o.jsx("option",{value:"",children:"Choose Action"}),o.jsx("option",{value:"draw",children:"Draw Cards"}),o.jsx("option",{value:"refresh",children:"Refresh Hand"}),o.jsx("option",{value:"mutual_draw",children:"Mutual Draw (Exchange)"}),o.jsx("option",{value:"flip",children:"Flip Cards"}),o.jsx("option",{value:"shift",children:"Shift Card"}),o.jsx("option",{value:"delete",children:"Delete Cards"}),o.jsx("option",{value:"discard",children:"Discard Cards"}),o.jsx("option",{value:"return",children:"Return to Hand"}),o.jsx("option",{value:"play",children:"Play from Hand/Deck"}),o.jsx("option",{value:"rearrange_protocols",children:"Rearrange Protocols"}),o.jsx("option",{value:"swap_protocols",children:"Swap Protocols"}),o.jsx("option",{value:"reveal",children:"Reveal Hand"}),o.jsx("option",{value:"give",children:"Give Cards"}),o.jsx("option",{value:"take",children:"Take from Hand"}),o.jsx("option",{value:"choice",children:"Either/Or Choice"}),o.jsx("option",{value:"passive_rule",children:"Passive Rule"}),o.jsx("option",{value:"value_modifier",children:"Value Modifier"}),o.jsx("option",{value:"block_compile",children:"Block Compile"}),o.jsx("option",{value:"delete_all_in_lane",children:"Delete All in Lane"})]}),o.jsx("button",{className:"btn btn-add-effect",onClick:()=>{const N=document.getElementById("top-trigger"),D=document.getElementById("top-action"),P=N.value,L=D.value;P&&L?(w("top",L,P),N.value="",D.value=""):y(!0)},children:"+"})]})]}),o.jsxs("div",{className:"card-box middle-box",children:[o.jsx("h4",{children:"Middle Box (On Play)"}),o.jsx("p",{className:"box-description",children:"When played or uncovered"}),o.jsxs("div",{className:"effects-list",children:[a.middleEffects.map((N,D)=>o.jsxs("div",{className:"effect-item",children:[o.jsx("span",{onClick:()=>j("middle",D),className:d?"read-only-clickable":"",children:Ir(N)}),!d&&o.jsx("button",{onClick:()=>_("middle",D),children:""})]},N.id)),a.middleEffects.length===0&&o.jsx("p",{className:"empty-box",children:"No effects"})]}),!d&&o.jsxs("select",{onChange:N=>{N.target.value&&(w("middle",N.target.value,"on_play"),N.target.value="")},children:[o.jsx("option",{value:"",children:"+ Add Effect"}),o.jsx("option",{value:"draw",children:"Draw Cards"}),o.jsx("option",{value:"refresh",children:"Refresh Hand"}),o.jsx("option",{value:"flip",children:"Flip Cards"}),o.jsx("option",{value:"shift",children:"Shift Card"}),o.jsx("option",{value:"delete",children:"Delete Cards"}),o.jsx("option",{value:"discard",children:"Discard Cards"}),o.jsx("option",{value:"return",children:"Return to Hand"}),o.jsx("option",{value:"play",children:"Play from Hand/Deck"}),o.jsx("option",{value:"rearrange_protocols",children:"Rearrange Protocols"}),o.jsx("option",{value:"swap_protocols",children:"Swap Protocols"}),o.jsx("option",{value:"reveal",children:"Reveal Hand"}),o.jsx("option",{value:"give",children:"Give Cards"}),o.jsx("option",{value:"take",children:"Take from Hand"}),o.jsx("option",{value:"choice",children:"Either/Or Choice"}),o.jsx("option",{value:"passive_rule",children:"Passive Rule"}),o.jsx("option",{value:"value_modifier",children:"Value Modifier"}),o.jsx("option",{value:"block_compile",children:"Block Compile"}),o.jsx("option",{value:"delete_all_in_lane",children:"Delete All in Lane"})]})]}),o.jsxs("div",{className:"card-box bottom-box",children:[o.jsx("h4",{children:"Bottom Box (Triggered)"}),o.jsx("p",{className:"box-description",children:"Only when uncovered AND face-up"}),o.jsxs("div",{className:"effects-list",children:[a.bottomEffects.map((N,D)=>o.jsxs("div",{className:"effect-item",children:[o.jsxs("span",{onClick:()=>j("bottom",D),className:d?"read-only-clickable":"",children:[o.jsxs("strong",{children:[E(N.trigger,N),":"]})," ",Ir(N)]}),!d&&o.jsx("button",{onClick:()=>_("bottom",D),children:""})]},N.id)),a.bottomEffects.length===0&&o.jsx("p",{className:"empty-box",children:"No effects"})]}),!d&&o.jsxs("div",{className:"bottom-effect-add",children:[o.jsxs("select",{id:"bottom-trigger",children:[o.jsx("option",{value:"",children:"1. Choose Trigger"}),o.jsx("option",{value:"start",children:"Start Phase"}),o.jsx("option",{value:"end",children:"End Phase"}),o.jsx("option",{value:"on_cover",children:"On Cover"})]}),o.jsxs("select",{id:"bottom-action",children:[o.jsx("option",{value:"",children:"2. Choose Effect"}),o.jsx("option",{value:"draw",children:"Draw Cards"}),o.jsx("option",{value:"refresh",children:"Refresh Hand"}),o.jsx("option",{value:"mutual_draw",children:"Mutual Draw (Exchange)"}),o.jsx("option",{value:"flip",children:"Flip Cards"}),o.jsx("option",{value:"shift",children:"Shift Card"}),o.jsx("option",{value:"delete",children:"Delete Cards"}),o.jsx("option",{value:"discard",children:"Discard Cards"}),o.jsx("option",{value:"return",children:"Return to Hand"}),o.jsx("option",{value:"play",children:"Play from Hand/Deck"}),o.jsx("option",{value:"rearrange_protocols",children:"Rearrange Protocols"}),o.jsx("option",{value:"swap_protocols",children:"Swap Protocols"}),o.jsx("option",{value:"reveal",children:"Reveal Hand"}),o.jsx("option",{value:"give",children:"Give Cards"}),o.jsx("option",{value:"take",children:"Take from Hand"}),o.jsx("option",{value:"choice",children:"Either/Or Choice"}),o.jsx("option",{value:"passive_rule",children:"Passive Rule"}),o.jsx("option",{value:"value_modifier",children:"Value Modifier"}),o.jsx("option",{value:"block_compile",children:"Block Compile"}),o.jsx("option",{value:"delete_all_in_lane",children:"Delete All in Lane"})]}),o.jsx("button",{className:"btn btn-add-effect",onClick:()=>{const N=document.getElementById("bottom-trigger"),D=document.getElementById("bottom-action"),P=N.value,L=D.value;P&&L?(w("bottom",L,P),N.value="",D.value=""):y(!0)},children:"+"})]})]})]})})]}),p&&o.jsxs("div",{className:"effect-parameter-editor",children:[o.jsx("h3",{children:d?"View Effect":"Configure Effect"}),d&&o.jsx("div",{className:"read-only-notice",children:"This effect is read-only"}),o.jsx(gb,{effect:p.effect,onChange:k,readOnly:d}),o.jsx("button",{onClick:()=>h(null),className:"btn",children:d?"Close":"Done"})]}),f&&o.jsx("div",{className:"custom-protocol-modal-overlay",onClick:()=>m(null),children:o.jsxs("div",{className:"custom-protocol-modal-content",onClick:N=>N.stopPropagation(),children:[o.jsx("h3",{children:"Delete Effect"}),o.jsx("p",{children:"Are you sure you want to delete this effect?"}),o.jsxs("div",{className:"custom-protocol-modal-actions",children:[o.jsx("button",{onClick:()=>m(null),className:"btn btn-back",children:"Cancel"}),o.jsx("button",{onClick:S,className:"btn btn-delete",children:"Delete"})]})]})}),g&&o.jsx("div",{className:"custom-protocol-modal-overlay",onClick:()=>y(!1),children:o.jsxs("div",{className:"custom-protocol-modal-content",onClick:N=>N.stopPropagation(),children:[o.jsx("h3",{children:"Missing Selection"}),o.jsx("p",{children:"Please select both a trigger and an effect before adding."}),o.jsx("div",{className:"custom-protocol-modal-actions",children:o.jsx("button",{onClick:()=>y(!1),className:"btn",children:"OK"})})]})})]})},_b=a=>{switch(a){case"draw":return{action:"draw",count:1,target:"self",source:"own_deck"};case"flip":return{action:"flip",count:1,targetFilter:{owner:"any",position:"any",faceState:"any",excludeSelf:!1},optional:!1};case"shift":return{action:"shift",targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1}};case"delete":return{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"any"},excludeSelf:!0};case"discard":return{action:"discard",count:1,actor:"self"};case"return":return{action:"return",count:1,targetFilter:{},scope:{type:"any_card"}};case"play":return{action:"play",source:"hand",count:1,faceDown:!0,destinationRule:{type:"other_lines"}};case"rearrange_protocols":return{action:"rearrange_protocols",target:"own"};case"swap_protocols":return{action:"swap_protocols",target:"own"};case"reveal":case"give":return{action:a,source:"own_hand",count:1};case"take":return{action:"take",source:"opponent_hand",count:1,random:!0};case"choice":return{action:"choice",options:[]};case"passive_rule":return{action:"passive_rule",rule:{type:"block_all_play",target:"opponent",scope:"this_lane"}};case"value_modifier":return{action:"value_modifier",modifier:{type:"add_per_condition",value:1,condition:"per_face_down_card",target:"own_total",scope:"this_lane"}};default:return{}}},xb=(a,n)=>{const l=(c,d)=>{c=c.replace("#","");const p=parseInt(c.substring(0,2),16),h=parseInt(c.substring(2,4),16),f=parseInt(c.substring(4,6),16);return`rgba(${p}, ${h}, ${f}, ${d})`},i={borderColor:n};switch(a){case"solid":return{...i,backgroundColor:n};case"radial":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`radial-gradient(circle at 50% 50%, ${l(n,.25)} 0%, transparent 60%)`};case"dual-radial":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 0% 0%, ${l(n,.2)}, transparent 50%),
                    radial-gradient(at 100% 100%, ${l(n,.2)}, transparent 50%)
                `};case"multi-radial":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 0%, ${l(n,.2)}, transparent 70%),
                    radial-gradient(circle at 20% 30%, ${l(n,.15)}, transparent 40%),
                    radial-gradient(circle at 80% 70%, ${l(n,.2)}, transparent 50%)
                `};case"chaos":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 10% 10%, hsla(60, 100%, 50%, 0.15), transparent 30%),
                    radial-gradient(at 90% 20%, hsla(180, 100%, 50%, 0.15), transparent 35%),
                    radial-gradient(at 30% 80%, hsla(300, 100%, 50%, 0.15), transparent 40%),
                    radial-gradient(at 70% 60%, hsla(0, 100%, 50%, 0.1), transparent 25%)
                `};case"grid":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(circle at 50% 50%, ${l(n,.2)} 0%, transparent 40%),
                    linear-gradient(hsla(0,0%,100%,0.03) 1px, transparent 1px),
                    linear-gradient(90deg, hsla(0,0%,100%,0.03) 1px, transparent 1px)
                `,backgroundSize:"100% 100%, 20px 20px, 20px 20px"};case"diagonal-lines":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 0% 100%, ${l(n,.25)}, transparent 70%),
                    repeating-linear-gradient(120deg, transparent, transparent 15px, ${l(n,.05)} 15px, ${l(n,.05)} 30px)
                `};case"cross-diagonal":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 50%, ${l(n,.25)} 0%, transparent 50%),
                    repeating-linear-gradient(45deg, transparent, transparent 8px, ${l(n,.08)} 8px, ${l(n,.08)} 16px),
                    repeating-linear-gradient(-45deg, transparent, transparent 8px, ${l(n,.06)} 8px, ${l(n,.06)} 16px)
                `};case"horizontal-lines":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 80% 80%, ${l(n,.1)}, transparent 50%),
                    repeating-linear-gradient(0deg, hsla(0,0%,100%,0.02), hsla(0,0%,100%,0.02) 1px, transparent 1px, transparent 3px)
                `};case"vertical-lines":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 10% 10%, ${l(n,.2)}, transparent 50%),
                    repeating-linear-gradient(175deg, transparent, transparent 1px, ${l(n,.05)} 1px, ${l(n,.05)} 2px)
                `};case"cross":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    linear-gradient(0deg, transparent 40%, ${l(n,.1)} 50%, transparent 60%),
                    linear-gradient(90deg, transparent 48%, ${l(n,.2)} 50%, transparent 52%)
                `};case"hexagons":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 0%, ${l(n,.2)}, transparent 70%),
                    url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='28' height='49' viewBox='0 0 28 49'%3E%3Cg fill-rule='evenodd'%3E%3Cg id='hexagons' fill='%23ffffff' fill-opacity='0.05' fill-rule='nonzero'%3E%3Cpath d='M13.99 9.25l13 7.5v15l-13 7.5L1 31.75v-15l12.99-7.5zM3 17.9v12.7l10.99 6.34 11-6.35V17.9l-11-6.34L3 17.9zM0 15l12.99-7.5L26 15v18.5l-13 7.5L0 33.5V15z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")
                `};case"stripes":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 100%, ${l(n,.25)}, transparent 60%),
                    linear-gradient(135deg, hsla(0,0%,0%,0.1) 23%, transparent 23%, transparent 25%, hsla(0,0%,0%,0.1) 25%, hsla(0,0%,0%,0.1) 27%, transparent 27%, transparent 73%, hsla(0,0%,0%,0.1) 73%, hsla(0,0%,0%,0.1) 75%, transparent 75%, transparent 77%, hsla(0,0%,0%,0.1) 77%)
                `};case"frost":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(circle at 50% 50%, ${l(n,.2)} 0%, transparent 50%),
                    repeating-linear-gradient(30deg, transparent, transparent 10px, ${l(n,.08)} 10px, ${l(n,.08)} 11px),
                    repeating-linear-gradient(-30deg, transparent, transparent 10px, ${l(n,.08)} 10px, ${l(n,.08)} 11px),
                    repeating-linear-gradient(90deg, transparent, transparent 8px, ${l(n,.05)} 8px, ${l(n,.05)} 9px)
                `};default:return i}},wb=[{name:"Anarchy",hex:"#EA5A3C"},{name:"Apathy",hex:"#989A9A"},{name:"Chaos",hex:"#E53FE5"},{name:"Darkness",hex:"#A772D4"},{name:"Death",hex:"#E25656"},{name:"Fire",hex:"#F06838"},{name:"Gravity",hex:"#7599EB"},{name:"Hate",hex:"#E03E5E"},{name:"Life",hex:"#3CE076"},{name:"Light",hex:"#FFEB7F"},{name:"Love",hex:"#F074D9"},{name:"Metal",hex:"#B3B8BD"},{name:"Plague",hex:"#A2CD3A"},{name:"Psychic",hex:"#C971EB"},{name:"Speed",hex:"#33DDDD"},{name:"Spirit",hex:"#42D4A8"},{name:"Water",hex:"#3FA4EB"}],Cb=[{name:"Solid",value:"solid",description:"Solid color background"},{name:"Radial Glow",value:"radial",description:"Single radial gradient glow"},{name:"Dual Radial",value:"dual-radial",description:"Two radial gradient spots"},{name:"Multi Radial",value:"multi-radial",description:"Multiple radial gradient spots"},{name:"Chaos",value:"chaos",description:"Colorful chaotic spots"},{name:"Grid",value:"grid",description:"Grid line pattern"},{name:"Diagonal Lines",value:"diagonal-lines",description:"Repeating diagonal lines"},{name:"Cross Diagonal",value:"cross-diagonal",description:"Crossed diagonal lines"},{name:"Horizontal Lines",value:"horizontal-lines",description:"Fine horizontal lines"},{name:"Vertical Lines",value:"vertical-lines",description:"Fine vertical lines"},{name:"Cross Pattern",value:"cross",description:"Cross/plus pattern"},{name:"Hexagons",value:"hexagons",description:"Hexagon pattern"},{name:"Stripes",value:"stripes",description:"Diagonal stripe pattern"},{name:"Frost",value:"frost",description:"Icy crystalline pattern with crossing lines"}],bb=({onSave:a,onCancel:n,onDelete:l,initialProtocol:i})=>{const[c,d]=re.useState("name"),[p,h]=re.useState(0),[f,m]=re.useState(!1),[g,y]=re.useState(""),[w,_]=re.useState(!1),S=i?Lr(i):!1;console.log("ProtocolWizard render - initialProtocol:",i,"isReadOnly:",S);const[k,j]=re.useState((i==null?void 0:i.name)||""),[E,C]=re.useState((i==null?void 0:i.description)||""),[b,T]=re.useState((i==null?void 0:i.color)||"#1976D2"),[A,H]=re.useState((i==null?void 0:i.pattern)||"solid"),[$,B]=re.useState((i==null?void 0:i.cards)||[{value:0,topEffects:[],middleEffects:[],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[],bottomEffects:[]}]);console.log("ProtocolWizard state - name:",k,"color:",b,"pattern:",A);const X=()=>{if(c==="name"){if(!k.trim()){alert("Please enter a protocol name.");return}d("color")}else c==="color"?d("pattern"):c==="pattern"&&d("cards")},I=O=>{const Z=[...$];Z[p]=O,B(Z)},F=()=>{const O={id:(i==null?void 0:i.id)||Qe(),name:k,description:E,author:"Player",createdAt:(i==null?void 0:i.createdAt)||new Date().toISOString(),color:b,pattern:A,cards:$};a(O)},N=()=>{i&&l&&l(i.id),_(!1)},D=()=>{const O={id:(i==null?void 0:i.id)||Qe(),name:k,description:E,author:"Player",createdAt:(i==null?void 0:i.createdAt)||new Date().toISOString(),color:b,pattern:A,cards:$},Z=JSON.stringify(O,null,2);y(Z),m(!0)},P=()=>{navigator.clipboard.writeText(g).then(()=>{alert("Protocol JSON copied to clipboard!"),m(!1)}).catch(()=>{alert("Failed to copy to clipboard. Please try again.")})},L=O=>!(!k.trim()&&O!=="name"),R=O=>{if(!L(O)){alert("Please enter a protocol name first.");return}d(O)};return o.jsxs("div",{className:"protocol-wizard",children:[o.jsxs("div",{className:"wizard-header",children:[o.jsxs("h2",{children:[S?`View Protocol: ${k}`:i?`Edit Protocol: ${k}`:"Create New Protocol",S&&o.jsx("span",{className:"read-only-badge",children:"Read-Only"})]}),o.jsxs("div",{className:"wizard-progress",children:[o.jsx("button",{className:`step ${c==="name"?"active":"done"}`,onClick:()=>R("name"),type:"button",children:"1. Name"}),o.jsx("button",{className:`step ${c==="color"?"active":c==="pattern"||c==="cards"?"done":""}`,onClick:()=>R("color"),disabled:!L("color"),type:"button",children:"2. Color"}),o.jsx("button",{className:`step ${c==="pattern"?"active":c==="cards"?"done":""}`,onClick:()=>R("pattern"),disabled:!L("pattern"),type:"button",children:"3. Pattern"}),o.jsx("button",{className:`step ${c==="cards"?"active":""}`,onClick:()=>R("cards"),disabled:!L("cards"),type:"button",children:"4. Cards"})]})]}),o.jsxs("div",{className:"wizard-content",children:[c==="name"&&o.jsxs("div",{className:"wizard-step name-step",children:[o.jsx("h3",{children:"Step 1: Name and Description"}),o.jsxs("label",{children:["Protocol Name *",o.jsx("input",{type:"text",value:k,onChange:O=>!S&&j(O.target.value),placeholder:"e.g. Lightning, Shadow, Void",autoFocus:!0,readOnly:S,className:S?"read-only":""})]}),o.jsxs("label",{children:["Description",o.jsx("textarea",{value:E,onChange:O=>!S&&C(O.target.value),placeholder:"Describe the strategy and theme of your protocol",rows:4,readOnly:S,className:S?"read-only":""})]})]}),c==="color"&&o.jsxs("div",{className:"wizard-step color-step",children:[o.jsx("h3",{children:"Step 2: Choose Color"}),o.jsx("div",{className:"color-preview",style:{backgroundColor:b},children:o.jsx("span",{children:k||"Your Protocol"})}),o.jsx("h4",{children:"Predefined Colors"}),o.jsx("div",{className:`color-grid ${S?"read-only":""}`,children:wb.map(O=>o.jsx("button",{className:`color-option ${b===O.hex?"selected":""}`,style:{backgroundColor:O.hex},onClick:()=>!S&&T(O.hex),title:O.name,disabled:S,children:b===O.hex&&""},O.hex))}),o.jsx("h4",{children:"Custom Color"}),o.jsxs("div",{className:"custom-color",children:[o.jsx("input",{type:"color",value:b,onChange:O=>!S&&T(O.target.value),disabled:S}),o.jsx("input",{type:"text",value:b,onChange:O=>!S&&T(O.target.value),placeholder:"#1976D2",readOnly:S,className:S?"read-only":""})]})]}),c==="pattern"&&o.jsxs("div",{className:"wizard-step pattern-step",children:[o.jsx("h3",{children:"Step 3: Choose Card Pattern"}),o.jsx("div",{className:`pattern-selection-grid ${S?"read-only":""}`,children:Cb.map(O=>{const Z=xb(O.value,b);return o.jsxs("div",{className:`pattern-option ${A===O.value?"selected":""}`,onClick:()=>!S&&H(O.value),children:[o.jsxs("div",{className:"pattern-preview",style:Z,children:[k||"Protocol","-0"]}),o.jsx("h4",{children:O.name}),o.jsx("p",{children:O.description}),A===O.value&&o.jsx("div",{className:"selected-badge",children:" Selected"})]},O.value)})})]}),c==="cards"&&o.jsxs("div",{className:"wizard-step cards-step",children:[o.jsx("h3",{children:"Step 4: Configure Cards"}),o.jsx("div",{className:"card-navigation",children:$.map((O,Z)=>o.jsxs("button",{className:`card-nav-btn ${p===Z?"active":""}`,onClick:()=>h(Z),type:"button",children:["Card ",O.value]},Z))}),o.jsx(vb,{card:$[p],protocolName:k,protocolColor:b,protocolPattern:A,onChange:I,readOnly:S})]})]}),o.jsxs("div",{className:"wizard-actions",children:[o.jsxs("div",{className:"wizard-actions-left",children:[o.jsx("button",{onClick:n,className:"btn btn-back",children:S?"Back":"Cancel"}),i&&l&&!S&&o.jsx("button",{onClick:()=>_(!0),className:"btn btn-delete",children:"Delete Protocol"})]}),o.jsxs("div",{className:"wizard-actions-right",children:[i&&o.jsxs(o.Fragment,{children:[o.jsx("button",{onClick:D,className:"btn btn-export",children:"Export JSON"}),!S&&o.jsx("button",{onClick:F,className:"btn",children:"Save"})]}),!i&&o.jsxs(o.Fragment,{children:[c!=="cards"&&o.jsx("button",{onClick:X,className:"btn",children:"Next"}),c==="cards"&&o.jsxs(o.Fragment,{children:[o.jsx("button",{onClick:D,className:"btn btn-export",children:"Export JSON"}),o.jsx("button",{onClick:F,className:"btn",children:"Save"})]})]})]})]}),f&&o.jsx("div",{className:"custom-protocol-modal-overlay",onClick:()=>m(!1),children:o.jsxs("div",{className:"custom-protocol-modal-content custom-protocol-modal-large",onClick:O=>O.stopPropagation(),children:[o.jsx("h3",{children:"Export Protocol JSON"}),o.jsx("p",{children:"Copy the JSON below to share or backup your protocol:"}),o.jsx("textarea",{value:g,readOnly:!0,rows:15,className:"export-textarea",onClick:O=>O.target.select()}),o.jsxs("div",{className:"custom-protocol-modal-actions",children:[o.jsx("button",{onClick:()=>m(!1),className:"btn btn-back",children:"Close"}),o.jsx("button",{onClick:P,className:"btn",children:"Copy to Clipboard"})]})]})}),w&&o.jsx("div",{className:"custom-protocol-modal-overlay",onClick:()=>_(!1),children:o.jsxs("div",{className:"custom-protocol-modal-content",onClick:O=>O.stopPropagation(),children:[o.jsx("h3",{children:"Delete Protocol"}),o.jsxs("p",{children:['Are you sure you want to delete "',k,'"?']}),o.jsx("p",{style:{color:"var(--danger-color)",fontSize:"0.9rem"},children:"This action cannot be undone."}),o.jsxs("div",{className:"custom-protocol-modal-actions",children:[o.jsx("button",{onClick:()=>_(!1),className:"btn btn-back",children:"Cancel"}),o.jsx("button",{onClick:N,className:"btn btn-delete",children:"Delete"})]})]})})]})},Sb=({onBack:a})=>{const[n,l]=re.useState("list"),[i,c]=re.useState([]),[d,p]=re.useState(void 0);re.useEffect(()=>{h()},[]);const h=()=>{const S=Qo();c(S)},f=()=>{p(void 0),l("create")},m=S=>{console.log("handleEdit called with protocol:",S),p(S),l("edit"),console.log("View set to edit, editingProtocol:",S)},g=S=>{w_(S),Bl(),h(),l("list"),p(void 0)},y=S=>{yt(S),Bl(),h(),l("list"),p(void 0)},w=S=>{yt(S),Bl(),h()},_=()=>{l("list"),p(void 0)};return o.jsxs("div",{className:"custom-protocol-creator",children:[n==="list"&&o.jsx(S_,{protocols:i,onCreateNew:f,onEdit:m,onDelete:g,onImport:w,onBack:a}),(n==="create"||n==="edit")&&o.jsx(bb,{onSave:y,onCancel:_,onDelete:g,initialProtocol:d})]})},jb={id:"spirit-1-example",protocol:"Spirit",value:1,top:"When you play cards face-up, they may be played without matching protocols.",middle:"Draw 2 cards.",bottom:'<span class="emphasis">Start:</span> Either discard 1 card or flip this card.',isFaceUp:!0,category:"Main 1",keywords:{}},Eb={id:"face-down-example",protocol:"Spirit",value:1,top:"",middle:"",bottom:"",isFaceUp:!1,category:"Main 1",keywords:{}},kb=[{id:"opp-light-4",protocol:"Light",value:4,top:"",middle:"Your opponent reveals their hand.",bottom:"",isFaceUp:!0,category:"Main 1",keywords:{reveal:!0}}],Nb=[{id:"opp-spirit-3",protocol:"Spirit",value:3,top:"<div><span class='emphasis'>After you draw cards:</span> You may shift this card, even if this card is covered.</div>",middle:"",bottom:"",isFaceUp:!0,category:"Main 1",keywords:{shift:!0}},{id:"opp-spirit-2",protocol:"Spirit",value:2,top:"",middle:"You may flip 1 card.",bottom:"",isFaceUp:!0,category:"Main 1",keywords:{flip:!0}}],Rb=[{id:"opp-water-3",protocol:"Water",value:3,top:"",middle:"Return all cards with a value of 2 in 1 line.",bottom:"",isFaceUp:!0,category:"Main 1",keywords:{return:!0}}],Ab=[{id:"player-darkness-5",protocol:"Darkness",value:5,top:"",middle:"You discard 1 card.",bottom:"",isFaceUp:!0,category:"Main 1",keywords:{discard:!0}},{id:"player-facedown-0",protocol:"Darkness",value:2,top:"",middle:"",bottom:"",isFaceUp:!1,category:"Main 1",keywords:{}}],Db=[{id:"player-plague-1",protocol:"Plague",value:1,top:"<div><span class='emphasis'>After your opponent discards cards:</span> Draw 1 card.</div>",middle:"Your opponent discards 1 card.",bottom:"",isFaceUp:!0,category:"Main 1",keywords:{draw:!0,discard:!0}},{id:"player-plague-5",protocol:"Plague",value:5,top:"",middle:"You discard 1 card.",bottom:"",isFaceUp:!0,category:"Main 1",keywords:{discard:!0}},{id:"player-plague-4",protocol:"Plague",value:4,top:"",middle:"",bottom:"<div><span class='emphasis'>End:</span> Your opponent deletes 1 of their face-down cards. You may flip this card.</div>",isFaceUp:!0,category:"Main 1",keywords:{delete:!0,flip:!0}}],Tb=[{id:"player-death-0",protocol:"Death",value:0,top:"",middle:"Delete 1 card from each other line.",bottom:"",isFaceUp:!0,category:"Main 1",keywords:{delete:!0}},{id:"player-facedown-3",protocol:"Death",value:2,top:"",middle:"",bottom:"",isFaceUp:!1,category:"Main 1",keywords:{}}],yo={opponent:["Light","Spirit","Water"],player:["Darkness","Plague","Death"],opponentCompiled:[!0,!1,!1],playerCompiled:[!1,!1,!1],opponentValues:[4,5,3],playerValues:[7,10,2]};function Fb({onBack:a}){const n=[kb,Nb,Rb],l=[Ab,Db,Tb];return o.jsxs("div",{className:"screen rules-screen",children:[o.jsx(gi,{title:"GAME RULES",onBack:a}),o.jsxs("div",{className:"rules-content",children:[o.jsxs("section",{className:"rules-section",children:[o.jsx("h2",{className:"section-title",children:"Objective"}),o.jsxs("div",{className:"rules-text",children:[o.jsxs("p",{children:["You play as an artificial intelligence trying to ",o.jsx("span",{className:"emphasis",children:"compile your 3 protocols"}),". Play command cards on protocols and execute their effects. If you reach a total value of",o.jsx("span",{className:"emphasis",children:" at least 10"})," with your cards on a protocol and exceed the opponent's total value in the same line, you may compile that protocol."]}),o.jsx("p",{className:"rules-highlight",children:"The first player to compile all 3 protocols wins!"})]})]}),o.jsxs("section",{className:"rules-section field-overview-section",children:[o.jsx("h2",{className:"section-title",children:"The Field"}),o.jsx("div",{className:"field-intro",children:o.jsxs("p",{children:["The field consists of ",o.jsx("span",{className:"emphasis",children:"3 lines"}),", each passing through two opposing protocols. Both players place cards on their side of each line. The goal is to build up value in your stacks to reach the compile threshold."]})}),o.jsxs("div",{className:"demo-board-container",children:[o.jsxs("div",{className:"demo-board",children:[o.jsx("div",{className:"demo-side-label opponent-label",children:"Opponent"}),o.jsx("div",{className:"demo-player-side demo-opponent-side",children:o.jsx("div",{className:"demo-lanes",children:n.map((i,c)=>o.jsx("div",{className:`demo-lane ${yo.opponentCompiled[c]?"demo-lane-compiled":""}`,children:o.jsx("div",{className:"demo-lane-stack",children:i.map((d,p)=>o.jsx(Ct,{card:d,isFaceUp:d.isFaceUp,style:{"--i":p},faceDownValue:2},d.id))})},`opp-lane-${c}`))})}),o.jsxs("div",{className:"demo-protocol-bars-container",children:[o.jsx("div",{className:"demo-protocol-bar demo-opponent-bar",children:yo.opponent.map((i,c)=>o.jsxs("div",{className:`demo-protocol-display ${yo.opponentCompiled[c]?"compiled":""}`,children:[o.jsx("span",{className:"demo-protocol-name",children:i}),o.jsx("span",{className:"demo-protocol-value",children:yo.opponentValues[c]})]},`opp-proto-${c}`))}),o.jsx("div",{className:"demo-protocol-bar demo-player-bar",children:yo.player.map((i,c)=>o.jsxs("div",{className:`demo-protocol-display ${yo.playerCompiled[c]?"compiled":""}`,children:[o.jsx("span",{className:"demo-protocol-name",children:i}),o.jsx("span",{className:"demo-protocol-value",children:yo.playerValues[c]})]},`player-proto-${c}`))})]}),o.jsx("div",{className:"demo-player-side",children:o.jsx("div",{className:"demo-lanes",children:l.map((i,c)=>o.jsx("div",{className:`demo-lane ${yo.playerCompiled[c]?"demo-lane-compiled":""} ${c===1?"demo-lane-compilable":""}`,children:o.jsx("div",{className:"demo-lane-stack",children:i.map((d,p)=>o.jsx(Ct,{card:d,isFaceUp:d.isFaceUp,style:{"--i":p},faceDownValue:2},d.id))})},`player-lane-${c}`))})}),o.jsx("div",{className:"demo-side-label player-label",children:"You"})]}),o.jsxs("div",{className:"demo-board-annotations",children:[o.jsxs("div",{className:"demo-annotation compiled-annotation",children:[o.jsx("div",{className:"demo-annotation-marker compiled-marker",children:"1"}),o.jsxs("div",{className:"demo-annotation-content",children:[o.jsx("strong",{children:"Compiled Protocol"}),o.jsx("p",{children:"Light has been compiled by the opponent! The protocol bar glows cyan."})]})]}),o.jsxs("div",{className:"demo-annotation compilable-annotation",children:[o.jsx("div",{className:"demo-annotation-marker compilable-marker",children:"2"}),o.jsxs("div",{className:"demo-annotation-content",children:[o.jsx("strong",{children:"Ready to Compile!"}),o.jsx("p",{children:"Plague has value 10 (1+5+4) which is 10 and higher than opponent's Spirit at 5. This protocol can be compiled!"})]})]}),o.jsxs("div",{className:"demo-annotation inprogress-annotation",children:[o.jsx("div",{className:"demo-annotation-marker inprogress-marker",children:"3"}),o.jsxs("div",{className:"demo-annotation-content",children:[o.jsx("strong",{children:"In Progress"}),o.jsx("p",{children:"Death/Water lanes are still building up. Keep playing cards to reach the compile threshold of 10!"})]})]}),o.jsxs("div",{className:"demo-annotation topbox-annotation",children:[o.jsx("div",{className:"demo-annotation-marker topbox-marker",children:"4"}),o.jsxs("div",{className:"demo-annotation-content",children:[o.jsx("strong",{children:"Top Effect Always Visible"}),o.jsx("p",{children:"See Plague-1's top effect? It stays active even when covered! Top effects are always visible and active on face-up cards."})]})]})]})]}),o.jsxs("div",{className:"field-legend",children:[o.jsxs("div",{className:"legend-item",children:[o.jsx("div",{className:"legend-swatch legend-compiled"}),o.jsx("span",{children:"Compiled Protocol"})]}),o.jsxs("div",{className:"legend-item",children:[o.jsx("div",{className:"legend-swatch legend-compilable"}),o.jsx("span",{children:"Ready to Compile (10 value & higher than opponent)"})]}),o.jsxs("div",{className:"legend-item",children:[o.jsx("div",{className:"legend-swatch legend-facedown"}),o.jsx("span",{children:"Face-down Card (base value: 2)"})]})]})]}),o.jsxs("section",{className:"rules-section card-anatomy-section",children:[o.jsx("h2",{className:"section-title",children:"Card Anatomy"}),o.jsxs("div",{className:"card-anatomy-layout",children:[o.jsx("div",{className:"card-anatomy-display",children:o.jsxs("div",{className:"anatomy-card-wrapper",children:[o.jsx(Ct,{card:jb,isFaceUp:!0}),o.jsxs("div",{className:"anatomy-annotation annotation-protocol",children:[o.jsx("div",{className:"annotation-line annotation-line-left"}),o.jsxs("div",{className:"annotation-label",children:[o.jsx("span",{className:"annotation-letter",children:"A"}),o.jsx("span",{className:"annotation-text",children:"Protocol"})]})]}),o.jsxs("div",{className:"anatomy-annotation annotation-value",children:[o.jsx("div",{className:"annotation-line annotation-line-right"}),o.jsxs("div",{className:"annotation-label",children:[o.jsx("span",{className:"annotation-letter",children:"B"}),o.jsx("span",{className:"annotation-text",children:"Value"})]})]}),o.jsxs("div",{className:"anatomy-annotation annotation-top",children:[o.jsx("div",{className:"annotation-line annotation-line-right"}),o.jsxs("div",{className:"annotation-label",children:[o.jsx("span",{className:"annotation-letter",children:"C"}),o.jsx("span",{className:"annotation-text",children:"Top Effect"})]})]}),o.jsxs("div",{className:"anatomy-annotation annotation-middle",children:[o.jsx("div",{className:"annotation-line annotation-line-right"}),o.jsxs("div",{className:"annotation-label",children:[o.jsx("span",{className:"annotation-letter",children:"D"}),o.jsx("span",{className:"annotation-text",children:"Middle Effect"})]})]}),o.jsxs("div",{className:"anatomy-annotation annotation-bottom",children:[o.jsx("div",{className:"annotation-line annotation-line-right"}),o.jsxs("div",{className:"annotation-label",children:[o.jsx("span",{className:"annotation-letter",children:"E"}),o.jsx("span",{className:"annotation-text",children:"Bottom Effect"})]})]})]})}),o.jsxs("div",{className:"card-anatomy-descriptions",children:[o.jsxs("div",{className:"anatomy-item",children:[o.jsx("span",{className:"anatomy-letter",children:"A"}),o.jsxs("div",{className:"anatomy-desc",children:[o.jsx("strong",{children:"Protocol Indicator"}),o.jsx("p",{children:"Dictates which line a card can be played face-up in. Cards must match the protocol of that line."})]})]}),o.jsxs("div",{className:"anatomy-item",children:[o.jsx("span",{className:"anatomy-letter",children:"B"}),o.jsxs("div",{className:"anatomy-desc",children:[o.jsx("strong",{children:"Value"}),o.jsx("p",{children:"The value added to the total value of a stack. Higher values help you reach the compile threshold of 10."})]})]}),o.jsxs("div",{className:"anatomy-item anatomy-item-highlight",children:[o.jsx("span",{className:"anatomy-letter",children:"C"}),o.jsxs("div",{className:"anatomy-desc",children:[o.jsx("strong",{children:"Top Command - Persistent"}),o.jsxs("p",{children:["While this card is face-up, this passive text is ",o.jsx("span",{className:"emphasis",children:"always active"}),", even when covered by other cards."]})]})]}),o.jsxs("div",{className:"anatomy-item anatomy-item-highlight",children:[o.jsx("span",{className:"anatomy-letter",children:"D"}),o.jsxs("div",{className:"anatomy-desc",children:[o.jsx("strong",{children:"Middle Command - Immediate"}),o.jsx("p",{children:"Resolve this active text immediately when the card is played, flipped face-up, or uncovered."})]})]}),o.jsxs("div",{className:"anatomy-item anatomy-item-highlight",children:[o.jsx("span",{className:"anatomy-letter",children:"E"}),o.jsxs("div",{className:"anatomy-desc",children:[o.jsx("strong",{children:"Bottom Command - Auxiliary"}),o.jsxs("p",{children:['This passive text (often triggered effects like "Start:" or "End:") is only active when the card is ',o.jsx("span",{className:"emphasis",children:"uncovered"}),"."]})]})]})]})]})]}),o.jsxs("section",{className:"rules-section face-down-section",children:[o.jsx("h2",{className:"section-title",children:"Face-Down Cards"}),o.jsxs("div",{className:"face-down-layout",children:[o.jsx("div",{className:"face-down-card-wrapper",children:o.jsx(Ct,{card:Eb,isFaceUp:!1,faceDownValue:2})}),o.jsxs("div",{className:"face-down-description",children:[o.jsxs("p",{children:["Cards can be played ",o.jsx("span",{className:"emphasis",children:"face-down"})," into any line, regardless of protocol matching."]}),o.jsxs("ul",{children:[o.jsxs("li",{children:["Face-down cards have a ",o.jsx("span",{className:"emphasis",children:"base value of 2"})]}),o.jsx("li",{children:"No effects are active while face-down"}),o.jsx("li",{children:"Can be flipped face-up by card effects"}),o.jsx("li",{children:"When flipped, the middle effect triggers"}),o.jsx("li",{children:"Some cards modify face-down values (e.g., Darkness-2)"})]})]})]})]}),o.jsxs("section",{className:"rules-section",children:[o.jsx("h2",{className:"section-title",children:"Turn Order"}),o.jsxs("div",{className:"turn-order-grid",children:[o.jsxs("div",{className:"turn-phase",children:[o.jsx("span",{className:"phase-number",children:"1"}),o.jsxs("div",{className:"phase-content",children:[o.jsx("strong",{children:"Start Phase"}),o.jsx("p",{children:'Resolve all visible "Start" effects of your face-up command cards.'})]})]}),o.jsxs("div",{className:"turn-phase",children:[o.jsx("span",{className:"phase-number",children:"2"}),o.jsxs("div",{className:"phase-content",children:[o.jsx("strong",{children:"Check Control"}),o.jsx("p",{children:"If your total value is higher than opponent's in at least 2 lines, take the control component."})]})]}),o.jsxs("div",{className:"turn-phase",children:[o.jsx("span",{className:"phase-number",children:"3"}),o.jsxs("div",{className:"phase-content",children:[o.jsx("strong",{children:"Check Compile"}),o.jsx("p",{children:"If you can compile (10+ value and higher than opponent), you must compile one protocol."})]})]}),o.jsxs("div",{className:"turn-phase",children:[o.jsx("span",{className:"phase-number",children:"4"}),o.jsxs("div",{className:"phase-content",children:[o.jsx("strong",{children:"Action"}),o.jsx("p",{children:"Play 1 card from hand OR refresh your hand (draw until you have 5 cards)."})]})]}),o.jsxs("div",{className:"turn-phase",children:[o.jsx("span",{className:"phase-number",children:"5"}),o.jsxs("div",{className:"phase-content",children:[o.jsx("strong",{children:"Check Cache"}),o.jsx("p",{children:"If you have more than 5 cards, discard down to 5."})]})]}),o.jsxs("div",{className:"turn-phase",children:[o.jsx("span",{className:"phase-number",children:"6"}),o.jsxs("div",{className:"phase-content",children:[o.jsx("strong",{children:"End Phase"}),o.jsx("p",{children:'Resolve all visible "End" effects of your face-up command cards.'})]})]})]})]}),o.jsxs("section",{className:"rules-section glossary-section",children:[o.jsx("h2",{className:"section-title",children:"Glossary"}),o.jsxs("div",{className:"glossary-grid",children:[o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Compile"}),o.jsx("p",{children:'Delete all cards in a line on both sides and flip your protocol to "Compiled".'})]}),o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Covered"}),o.jsx("p",{children:"A card with another card on top of it. Only top effects remain active."})]}),o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Uncovered"}),o.jsx("p",{children:"The topmost card in a stack, furthest from the protocol."})]}),o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Delete"}),o.jsx("p",{children:"Move a card from the field to the trash."})]}),o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Discard"}),o.jsx("p",{children:"Move a card from hand to the owner's trash."})]}),o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Flip"}),o.jsx("p",{children:"Change a card from face-down to face-up, or vice versa."})]}),o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Shift"}),o.jsx("p",{children:"Move a card to another line on the same side of the field."})]}),o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Return"}),o.jsx("p",{children:"Move a card from the field to its owner's hand."})]}),o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Reveal"}),o.jsx("p",{children:"Show hidden information publicly, then return it to its previous state."})]}),o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Refresh"}),o.jsx("p",{children:"Draw cards until you have 5 cards in hand."})]}),o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Line"}),o.jsx("p",{children:"The area passing through two opposing protocols. The field has 3 lines."})]}),o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Stack"}),o.jsx("p",{children:"The cards in a line on one player's side."})]})]})]})]})]})}function qb(){const[a,n]=re.useState("MainMenu"),[l,i]=re.useState([]),[c,d]=re.useState([]),[p,h]=re.useState(null),[f,m]=re.useState("easy"),[g,y]=re.useState(null),[w,_]=re.useState(!0),[S,k]=re.useState("player");re.useEffect(()=>{qC()},[]);const j=re.useCallback(()=>{n("MainMenu"),i([]),d([]),h(null),y(null)},[]);re.useEffect(()=>{const T=A=>{A.key==="Escape"&&j()};return window.addEventListener("keydown",T),()=>{window.removeEventListener("keydown",T)}},[j]);const E=re.useCallback((T,A)=>{i(T),d(A),h(null),y(null),k("player"),n("GameScreen")},[]),C=re.useCallback((T,A)=>{h(T),y(A),n("ResultsScreen")},[]),b=()=>{switch(a){case"MainMenu":return o.jsx(bh,{onNavigate:T=>n(T),difficulty:f,setDifficulty:m,useControl:w,onUseControlChange:_});case"ProtocolSelection":return o.jsx(k_,{onBack:j,onStartGame:E});case"GameScreen":return o.jsx(ob,{onBack:j,onEndGame:C,playerProtocols:l,opponentProtocols:c,difficulty:f,useControlMechanic:w,startingPlayer:S});case"ResultsScreen":return o.jsx(rb,{onPlayAgain:j,winner:p,finalState:g,difficulty:f});case"CardLibrary":return o.jsx(lb,{onBack:j});case"Statistics":return o.jsx(sb,{onBack:j});case"CustomProtocols":return o.jsx(Sb,{onBack:j});case"Rules":return o.jsx(Fb,{onBack:j});default:return o.jsx(bh,{onNavigate:T=>n(T),difficulty:f,setDifficulty:m,useControl:w,onUseControlChange:_})}};return o.jsx(o.Fragment,{children:b()})}const $b=document.getElementById("root"),Ub=m_.createRoot($b);Ub.render(o.jsx(qb,{}));
