(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))c(s);new MutationObserver(s=>{for(const d of s)if(d.type==="childList")for(const u of d.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&c(u)}).observe(document,{childList:!0,subtree:!0});function r(s){const d={};return s.integrity&&(d.integrity=s.integrity),s.referrerPolicy&&(d.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?d.credentials="include":s.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function c(s){if(s.ep)return;s.ep=!0;const d=r(s);fetch(s.href,d)}})();var Pd={exports:{}},es={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var tm;function R0(){if(tm)return es;tm=1;var t=Symbol.for("react.transitional.element"),n=Symbol.for("react.fragment");function r(c,s,d){var u=null;if(d!==void 0&&(u=""+d),s.key!==void 0&&(u=""+s.key),"key"in s){d={};for(var p in s)p!=="key"&&(d[p]=s[p])}else d=s;return s=d.ref,{$$typeof:t,type:c,key:u,ref:s!==void 0?s:null,props:d}}return es.Fragment=n,es.jsx=r,es.jsxs=r,es}var nm;function D0(){return nm||(nm=1,Pd.exports=R0()),Pd.exports}var o=D0(),Ud={exports:{}},ts={},Od={exports:{}},Md={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var am;function A0(){return am||(am=1,(function(t){function n(N,R){var $=N.length;N.push(R);e:for(;0<$;){var X=$-1>>>1,G=N[X];if(0<s(G,R))N[X]=R,N[$]=G,$=X;else break e}}function r(N){return N.length===0?null:N[0]}function c(N){if(N.length===0)return null;var R=N[0],$=N.pop();if($!==R){N[0]=$;e:for(var X=0,G=N.length,q=G>>>1;X<q;){var Q=2*(X+1)-1,K=N[Q],Z=Q+1,te=N[Z];if(0>s(K,$))Z<G&&0>s(te,K)?(N[X]=te,N[Z]=$,X=Z):(N[X]=K,N[Q]=$,X=Q);else if(Z<G&&0>s(te,$))N[X]=te,N[Z]=$,X=Z;else break e}}return R}function s(N,R){var $=N.sortIndex-R.sortIndex;return $!==0?$:N.id-R.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var d=performance;t.unstable_now=function(){return d.now()}}else{var u=Date,p=u.now();t.unstable_now=function(){return u.now()-p}}var f=[],h=[],_=1,y=null,m=3,g=!1,x=!1,C=!1,b=!1,j=typeof setTimeout=="function"?setTimeout:null,k=typeof clearTimeout=="function"?clearTimeout:null,E=typeof setImmediate<"u"?setImmediate:null;function T(N){for(var R=r(h);R!==null;){if(R.callback===null)c(h);else if(R.startTime<=N)c(h),R.sortIndex=R.expirationTime,n(f,R);else break;R=r(h)}}function F(N){if(C=!1,T(N),!x)if(r(f)!==null)x=!0,U||(U=!0,B());else{var R=r(h);R!==null&&M(F,R.startTime-N)}}var U=!1,D=-1,I=5,W=-1;function z(){return b?!0:!(t.unstable_now()-W<I)}function V(){if(b=!1,U){var N=t.unstable_now();W=N;var R=!0;try{e:{x=!1,C&&(C=!1,k(D),D=-1),g=!0;var $=m;try{t:{for(T(N),y=r(f);y!==null&&!(y.expirationTime>N&&z());){var X=y.callback;if(typeof X=="function"){y.callback=null,m=y.priorityLevel;var G=X(y.expirationTime<=N);if(N=t.unstable_now(),typeof G=="function"){y.callback=G,T(N),R=!0;break t}y===r(f)&&c(f),T(N)}else c(f);y=r(f)}if(y!==null)R=!0;else{var q=r(h);q!==null&&M(F,q.startTime-N),R=!1}}break e}finally{y=null,m=$,g=!1}R=void 0}}finally{R?B():U=!1}}}var B;if(typeof E=="function")B=function(){E(V)};else if(typeof MessageChannel<"u"){var L=new MessageChannel,P=L.port2;L.port1.onmessage=V,B=function(){P.postMessage(null)}}else B=function(){j(V,0)};function M(N,R){D=j(function(){N(t.unstable_now())},R)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(N){N.callback=null},t.unstable_forceFrameRate=function(N){0>N||125<N?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):I=0<N?Math.floor(1e3/N):5},t.unstable_getCurrentPriorityLevel=function(){return m},t.unstable_next=function(N){switch(m){case 1:case 2:case 3:var R=3;break;default:R=m}var $=m;m=R;try{return N()}finally{m=$}},t.unstable_requestPaint=function(){b=!0},t.unstable_runWithPriority=function(N,R){switch(N){case 1:case 2:case 3:case 4:case 5:break;default:N=3}var $=m;m=N;try{return R()}finally{m=$}},t.unstable_scheduleCallback=function(N,R,$){var X=t.unstable_now();switch(typeof $=="object"&&$!==null?($=$.delay,$=typeof $=="number"&&0<$?X+$:X):$=X,N){case 1:var G=-1;break;case 2:G=250;break;case 5:G=1073741823;break;case 4:G=1e4;break;default:G=5e3}return G=$+G,N={id:_++,callback:R,priorityLevel:N,startTime:$,expirationTime:G,sortIndex:-1},$>X?(N.sortIndex=$,n(h,N),r(f)===null&&N===r(h)&&(C?(k(D),D=-1):C=!0,M(F,$-X))):(N.sortIndex=G,n(f,N),x||g||(x=!0,U||(U=!0,B()))),N},t.unstable_shouldYield=z,t.unstable_wrapCallback=function(N){var R=m;return function(){var $=m;m=R;try{return N.apply(this,arguments)}finally{m=$}}}})(Md)),Md}var om;function F0(){return om||(om=1,Od.exports=A0()),Od.exports}var Vd={exports:{}},at={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var rm;function $0(){if(rm)return at;rm=1;var t=Symbol.for("react.transitional.element"),n=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),c=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),d=Symbol.for("react.consumer"),u=Symbol.for("react.context"),p=Symbol.for("react.forward_ref"),f=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),_=Symbol.for("react.lazy"),y=Symbol.for("react.activity"),m=Symbol.iterator;function g(q){return q===null||typeof q!="object"?null:(q=m&&q[m]||q["@@iterator"],typeof q=="function"?q:null)}var x={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},C=Object.assign,b={};function j(q,Q,K){this.props=q,this.context=Q,this.refs=b,this.updater=K||x}j.prototype.isReactComponent={},j.prototype.setState=function(q,Q){if(typeof q!="object"&&typeof q!="function"&&q!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,q,Q,"setState")},j.prototype.forceUpdate=function(q){this.updater.enqueueForceUpdate(this,q,"forceUpdate")};function k(){}k.prototype=j.prototype;function E(q,Q,K){this.props=q,this.context=Q,this.refs=b,this.updater=K||x}var T=E.prototype=new k;T.constructor=E,C(T,j.prototype),T.isPureReactComponent=!0;var F=Array.isArray;function U(){}var D={H:null,A:null,T:null,S:null},I=Object.prototype.hasOwnProperty;function W(q,Q,K){var Z=K.ref;return{$$typeof:t,type:q,key:Q,ref:Z!==void 0?Z:null,props:K}}function z(q,Q){return W(q.type,Q,q.props)}function V(q){return typeof q=="object"&&q!==null&&q.$$typeof===t}function B(q){var Q={"=":"=0",":":"=2"};return"$"+q.replace(/[=:]/g,function(K){return Q[K]})}var L=/\/+/g;function P(q,Q){return typeof q=="object"&&q!==null&&q.key!=null?B(""+q.key):Q.toString(36)}function M(q){switch(q.status){case"fulfilled":return q.value;case"rejected":throw q.reason;default:switch(typeof q.status=="string"?q.then(U,U):(q.status="pending",q.then(function(Q){q.status==="pending"&&(q.status="fulfilled",q.value=Q)},function(Q){q.status==="pending"&&(q.status="rejected",q.reason=Q)})),q.status){case"fulfilled":return q.value;case"rejected":throw q.reason}}throw q}function N(q,Q,K,Z,te){var ee=typeof q;(ee==="undefined"||ee==="boolean")&&(q=null);var se=!1;if(q===null)se=!0;else switch(ee){case"bigint":case"string":case"number":se=!0;break;case"object":switch(q.$$typeof){case t:case n:se=!0;break;case _:return se=q._init,N(se(q._payload),Q,K,Z,te)}}if(se)return te=te(q),se=Z===""?"."+P(q,0):Z,F(te)?(K="",se!=null&&(K=se.replace(L,"$&/")+"/"),N(te,Q,K,"",function(be){return be})):te!=null&&(V(te)&&(te=z(te,K+(te.key==null||q&&q.key===te.key?"":(""+te.key).replace(L,"$&/")+"/")+se)),Q.push(te)),1;se=0;var _e=Z===""?".":Z+":";if(F(q))for(var fe=0;fe<q.length;fe++)Z=q[fe],ee=_e+P(Z,fe),se+=N(Z,Q,K,ee,te);else if(fe=g(q),typeof fe=="function")for(q=fe.call(q),fe=0;!(Z=q.next()).done;)Z=Z.value,ee=_e+P(Z,fe++),se+=N(Z,Q,K,ee,te);else if(ee==="object"){if(typeof q.then=="function")return N(M(q),Q,K,Z,te);throw Q=String(q),Error("Objects are not valid as a React child (found: "+(Q==="[object Object]"?"object with keys {"+Object.keys(q).join(", ")+"}":Q)+"). If you meant to render a collection of children, use an array instead.")}return se}function R(q,Q,K){if(q==null)return q;var Z=[],te=0;return N(q,Z,"","",function(ee){return Q.call(K,ee,te++)}),Z}function $(q){if(q._status===-1){var Q=q._result;Q=Q(),Q.then(function(K){(q._status===0||q._status===-1)&&(q._status=1,q._result=K)},function(K){(q._status===0||q._status===-1)&&(q._status=2,q._result=K)}),q._status===-1&&(q._status=0,q._result=Q)}if(q._status===1)return q._result.default;throw q._result}var X=typeof reportError=="function"?reportError:function(q){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Q=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof q=="object"&&q!==null&&typeof q.message=="string"?String(q.message):String(q),error:q});if(!window.dispatchEvent(Q))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",q);return}console.error(q)},G={map:R,forEach:function(q,Q,K){R(q,function(){Q.apply(this,arguments)},K)},count:function(q){var Q=0;return R(q,function(){Q++}),Q},toArray:function(q){return R(q,function(Q){return Q})||[]},only:function(q){if(!V(q))throw Error("React.Children.only expected to receive a single React element child.");return q}};return at.Activity=y,at.Children=G,at.Component=j,at.Fragment=r,at.Profiler=s,at.PureComponent=E,at.StrictMode=c,at.Suspense=f,at.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=D,at.__COMPILER_RUNTIME={__proto__:null,c:function(q){return D.H.useMemoCache(q)}},at.cache=function(q){return function(){return q.apply(null,arguments)}},at.cacheSignal=function(){return null},at.cloneElement=function(q,Q,K){if(q==null)throw Error("The argument must be a React element, but you passed "+q+".");var Z=C({},q.props),te=q.key;if(Q!=null)for(ee in Q.key!==void 0&&(te=""+Q.key),Q)!I.call(Q,ee)||ee==="key"||ee==="__self"||ee==="__source"||ee==="ref"&&Q.ref===void 0||(Z[ee]=Q[ee]);var ee=arguments.length-2;if(ee===1)Z.children=K;else if(1<ee){for(var se=Array(ee),_e=0;_e<ee;_e++)se[_e]=arguments[_e+2];Z.children=se}return W(q.type,te,Z)},at.createContext=function(q){return q={$$typeof:u,_currentValue:q,_currentValue2:q,_threadCount:0,Provider:null,Consumer:null},q.Provider=q,q.Consumer={$$typeof:d,_context:q},q},at.createElement=function(q,Q,K){var Z,te={},ee=null;if(Q!=null)for(Z in Q.key!==void 0&&(ee=""+Q.key),Q)I.call(Q,Z)&&Z!=="key"&&Z!=="__self"&&Z!=="__source"&&(te[Z]=Q[Z]);var se=arguments.length-2;if(se===1)te.children=K;else if(1<se){for(var _e=Array(se),fe=0;fe<se;fe++)_e[fe]=arguments[fe+2];te.children=_e}if(q&&q.defaultProps)for(Z in se=q.defaultProps,se)te[Z]===void 0&&(te[Z]=se[Z]);return W(q,ee,te)},at.createRef=function(){return{current:null}},at.forwardRef=function(q){return{$$typeof:p,render:q}},at.isValidElement=V,at.lazy=function(q){return{$$typeof:_,_payload:{_status:-1,_result:q},_init:$}},at.memo=function(q,Q){return{$$typeof:h,type:q,compare:Q===void 0?null:Q}},at.startTransition=function(q){var Q=D.T,K={};D.T=K;try{var Z=q(),te=D.S;te!==null&&te(K,Z),typeof Z=="object"&&Z!==null&&typeof Z.then=="function"&&Z.then(U,X)}catch(ee){X(ee)}finally{Q!==null&&K.types!==null&&(Q.types=K.types),D.T=Q}},at.unstable_useCacheRefresh=function(){return D.H.useCacheRefresh()},at.use=function(q){return D.H.use(q)},at.useActionState=function(q,Q,K){return D.H.useActionState(q,Q,K)},at.useCallback=function(q,Q){return D.H.useCallback(q,Q)},at.useContext=function(q){return D.H.useContext(q)},at.useDebugValue=function(){},at.useDeferredValue=function(q,Q){return D.H.useDeferredValue(q,Q)},at.useEffect=function(q,Q){return D.H.useEffect(q,Q)},at.useEffectEvent=function(q){return D.H.useEffectEvent(q)},at.useId=function(){return D.H.useId()},at.useImperativeHandle=function(q,Q,K){return D.H.useImperativeHandle(q,Q,K)},at.useInsertionEffect=function(q,Q){return D.H.useInsertionEffect(q,Q)},at.useLayoutEffect=function(q,Q){return D.H.useLayoutEffect(q,Q)},at.useMemo=function(q,Q){return D.H.useMemo(q,Q)},at.useOptimistic=function(q,Q){return D.H.useOptimistic(q,Q)},at.useReducer=function(q,Q,K){return D.H.useReducer(q,Q,K)},at.useRef=function(q){return D.H.useRef(q)},at.useState=function(q){return D.H.useState(q)},at.useSyncExternalStore=function(q,Q,K){return D.H.useSyncExternalStore(q,Q,K)},at.useTransition=function(){return D.H.useTransition()},at.version="19.2.3",at}var lm;function iu(){return lm||(lm=1,Vd.exports=$0()),Vd.exports}var Hd={exports:{}},yn={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var sm;function I0(){if(sm)return yn;sm=1;var t=iu();function n(f){var h="https://react.dev/errors/"+f;if(1<arguments.length){h+="?args[]="+encodeURIComponent(arguments[1]);for(var _=2;_<arguments.length;_++)h+="&args[]="+encodeURIComponent(arguments[_])}return"Minified React error #"+f+"; visit "+h+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function r(){}var c={d:{f:r,r:function(){throw Error(n(522))},D:r,C:r,L:r,m:r,X:r,S:r,M:r},p:0,findDOMNode:null},s=Symbol.for("react.portal");function d(f,h,_){var y=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:s,key:y==null?null:""+y,children:f,containerInfo:h,implementation:_}}var u=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function p(f,h){if(f==="font")return"";if(typeof h=="string")return h==="use-credentials"?h:""}return yn.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=c,yn.createPortal=function(f,h){var _=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11)throw Error(n(299));return d(f,h,null,_)},yn.flushSync=function(f){var h=u.T,_=c.p;try{if(u.T=null,c.p=2,f)return f()}finally{u.T=h,c.p=_,c.d.f()}},yn.preconnect=function(f,h){typeof f=="string"&&(h?(h=h.crossOrigin,h=typeof h=="string"?h==="use-credentials"?h:"":void 0):h=null,c.d.C(f,h))},yn.prefetchDNS=function(f){typeof f=="string"&&c.d.D(f)},yn.preinit=function(f,h){if(typeof f=="string"&&h&&typeof h.as=="string"){var _=h.as,y=p(_,h.crossOrigin),m=typeof h.integrity=="string"?h.integrity:void 0,g=typeof h.fetchPriority=="string"?h.fetchPriority:void 0;_==="style"?c.d.S(f,typeof h.precedence=="string"?h.precedence:void 0,{crossOrigin:y,integrity:m,fetchPriority:g}):_==="script"&&c.d.X(f,{crossOrigin:y,integrity:m,fetchPriority:g,nonce:typeof h.nonce=="string"?h.nonce:void 0})}},yn.preinitModule=function(f,h){if(typeof f=="string")if(typeof h=="object"&&h!==null){if(h.as==null||h.as==="script"){var _=p(h.as,h.crossOrigin);c.d.M(f,{crossOrigin:_,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0})}}else h==null&&c.d.M(f)},yn.preload=function(f,h){if(typeof f=="string"&&typeof h=="object"&&h!==null&&typeof h.as=="string"){var _=h.as,y=p(_,h.crossOrigin);c.d.L(f,_,{crossOrigin:y,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0,type:typeof h.type=="string"?h.type:void 0,fetchPriority:typeof h.fetchPriority=="string"?h.fetchPriority:void 0,referrerPolicy:typeof h.referrerPolicy=="string"?h.referrerPolicy:void 0,imageSrcSet:typeof h.imageSrcSet=="string"?h.imageSrcSet:void 0,imageSizes:typeof h.imageSizes=="string"?h.imageSizes:void 0,media:typeof h.media=="string"?h.media:void 0})}},yn.preloadModule=function(f,h){if(typeof f=="string")if(h){var _=p(h.as,h.crossOrigin);c.d.m(f,{as:typeof h.as=="string"&&h.as!=="script"?h.as:void 0,crossOrigin:_,integrity:typeof h.integrity=="string"?h.integrity:void 0})}else c.d.m(f)},yn.requestFormReset=function(f){c.d.r(f)},yn.unstable_batchedUpdates=function(f,h){return f(h)},yn.useFormState=function(f,h,_){return u.H.useFormState(f,h,_)},yn.useFormStatus=function(){return u.H.useHostTransitionStatus()},yn.version="19.2.3",yn}var cm;function q0(){if(cm)return Hd.exports;cm=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(n){console.error(n)}}return t(),Hd.exports=I0(),Hd.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var im;function L0(){if(im)return ts;im=1;var t=F0(),n=iu(),r=q0();function c(e){var a="https://react.dev/errors/"+e;if(1<arguments.length){a+="?args[]="+encodeURIComponent(arguments[1]);for(var l=2;l<arguments.length;l++)a+="&args[]="+encodeURIComponent(arguments[l])}return"Minified React error #"+e+"; visit "+a+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function d(e){var a=e,l=e;if(e.alternate)for(;a.return;)a=a.return;else{e=a;do a=e,(a.flags&4098)!==0&&(l=a.return),e=a.return;while(e)}return a.tag===3?l:null}function u(e){if(e.tag===13){var a=e.memoizedState;if(a===null&&(e=e.alternate,e!==null&&(a=e.memoizedState)),a!==null)return a.dehydrated}return null}function p(e){if(e.tag===31){var a=e.memoizedState;if(a===null&&(e=e.alternate,e!==null&&(a=e.memoizedState)),a!==null)return a.dehydrated}return null}function f(e){if(d(e)!==e)throw Error(c(188))}function h(e){var a=e.alternate;if(!a){if(a=d(e),a===null)throw Error(c(188));return a!==e?null:e}for(var l=e,i=a;;){var v=l.return;if(v===null)break;var S=v.alternate;if(S===null){if(i=v.return,i!==null){l=i;continue}break}if(v.child===S.child){for(S=v.child;S;){if(S===l)return f(v),e;if(S===i)return f(v),a;S=S.sibling}throw Error(c(188))}if(l.return!==i.return)l=v,i=S;else{for(var A=!1,Y=v.child;Y;){if(Y===l){A=!0,l=v,i=S;break}if(Y===i){A=!0,i=v,l=S;break}Y=Y.sibling}if(!A){for(Y=S.child;Y;){if(Y===l){A=!0,l=S,i=v;break}if(Y===i){A=!0,i=S,l=v;break}Y=Y.sibling}if(!A)throw Error(c(189))}}if(l.alternate!==i)throw Error(c(190))}if(l.tag!==3)throw Error(c(188));return l.stateNode.current===l?e:a}function _(e){var a=e.tag;if(a===5||a===26||a===27||a===6)return e;for(e=e.child;e!==null;){if(a=_(e),a!==null)return a;e=e.sibling}return null}var y=Object.assign,m=Symbol.for("react.element"),g=Symbol.for("react.transitional.element"),x=Symbol.for("react.portal"),C=Symbol.for("react.fragment"),b=Symbol.for("react.strict_mode"),j=Symbol.for("react.profiler"),k=Symbol.for("react.consumer"),E=Symbol.for("react.context"),T=Symbol.for("react.forward_ref"),F=Symbol.for("react.suspense"),U=Symbol.for("react.suspense_list"),D=Symbol.for("react.memo"),I=Symbol.for("react.lazy"),W=Symbol.for("react.activity"),z=Symbol.for("react.memo_cache_sentinel"),V=Symbol.iterator;function B(e){return e===null||typeof e!="object"?null:(e=V&&e[V]||e["@@iterator"],typeof e=="function"?e:null)}var L=Symbol.for("react.client.reference");function P(e){if(e==null)return null;if(typeof e=="function")return e.$$typeof===L?null:e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case C:return"Fragment";case j:return"Profiler";case b:return"StrictMode";case F:return"Suspense";case U:return"SuspenseList";case W:return"Activity"}if(typeof e=="object")switch(e.$$typeof){case x:return"Portal";case E:return e.displayName||"Context";case k:return(e._context.displayName||"Context")+".Consumer";case T:var a=e.render;return e=e.displayName,e||(e=a.displayName||a.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case D:return a=e.displayName||null,a!==null?a:P(e.type)||"Memo";case I:a=e._payload,e=e._init;try{return P(e(a))}catch{}}return null}var M=Array.isArray,N=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,R=r.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,$={pending:!1,data:null,method:null,action:null},X=[],G=-1;function q(e){return{current:e}}function Q(e){0>G||(e.current=X[G],X[G]=null,G--)}function K(e,a){G++,X[G]=e.current,e.current=a}var Z=q(null),te=q(null),ee=q(null),se=q(null);function _e(e,a){switch(K(ee,a),K(te,e),K(Z,null),a.nodeType){case 9:case 11:e=(e=a.documentElement)&&(e=e.namespaceURI)?bh(e):0;break;default:if(e=a.tagName,a=a.namespaceURI)a=bh(a),e=Eh(a,e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}Q(Z),K(Z,e)}function fe(){Q(Z),Q(te),Q(ee)}function be(e){e.memoizedState!==null&&K(se,e);var a=Z.current,l=Eh(a,e.type);a!==l&&(K(te,e),K(Z,l))}function oe(e){te.current===e&&(Q(Z),Q(te)),se.current===e&&(Q(se),Xl._currentValue=$)}var H,ne;function J(e){if(H===void 0)try{throw Error()}catch(l){var a=l.stack.trim().match(/\n( *(at )?)/);H=a&&a[1]||"",ne=-1<l.stack.indexOf(`
    at`)?" (<anonymous>)":-1<l.stack.indexOf("@")?"@unknown:0:0":""}return`
`+H+e+ne}var ie=!1;function de(e,a){if(!e||ie)return"";ie=!0;var l=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var i={DetermineComponentFrameRoot:function(){try{if(a){var ke=function(){throw Error()};if(Object.defineProperty(ke.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(ke,[])}catch(we){var ve=we}Reflect.construct(e,[],ke)}else{try{ke.call()}catch(we){ve=we}e.call(ke.prototype)}}else{try{throw Error()}catch(we){ve=we}(ke=e())&&typeof ke.catch=="function"&&ke.catch(function(){})}}catch(we){if(we&&ve&&typeof we.stack=="string")return[we.stack,ve.stack]}return[null,null]}};i.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var v=Object.getOwnPropertyDescriptor(i.DetermineComponentFrameRoot,"name");v&&v.configurable&&Object.defineProperty(i.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var S=i.DetermineComponentFrameRoot(),A=S[0],Y=S[1];if(A&&Y){var re=A.split(`
`),ye=Y.split(`
`);for(v=i=0;i<re.length&&!re[i].includes("DetermineComponentFrameRoot");)i++;for(;v<ye.length&&!ye[v].includes("DetermineComponentFrameRoot");)v++;if(i===re.length||v===ye.length)for(i=re.length-1,v=ye.length-1;1<=i&&0<=v&&re[i]!==ye[v];)v--;for(;1<=i&&0<=v;i--,v--)if(re[i]!==ye[v]){if(i!==1||v!==1)do if(i--,v--,0>v||re[i]!==ye[v]){var Ce=`
`+re[i].replace(" at new "," at ");return e.displayName&&Ce.includes("<anonymous>")&&(Ce=Ce.replace("<anonymous>",e.displayName)),Ce}while(1<=i&&0<=v);break}}}finally{ie=!1,Error.prepareStackTrace=l}return(l=e?e.displayName||e.name:"")?J(l):""}function pe(e,a){switch(e.tag){case 26:case 27:case 5:return J(e.type);case 16:return J("Lazy");case 13:return e.child!==a&&a!==null?J("Suspense Fallback"):J("Suspense");case 19:return J("SuspenseList");case 0:case 15:return de(e.type,!1);case 11:return de(e.type.render,!1);case 1:return de(e.type,!0);case 31:return J("Activity");default:return""}}function Se(e){try{var a="",l=null;do a+=pe(e,l),l=e,e=e.return;while(e);return a}catch(i){return`
Error generating stack: `+i.message+`
`+i.stack}}var Fe=Object.prototype.hasOwnProperty,je=t.unstable_scheduleCallback,Ve=t.unstable_cancelCallback,He=t.unstable_shouldYield,Ge=t.unstable_requestPaint,qe=t.unstable_now,Ne=t.unstable_getCurrentPriorityLevel,Oe=t.unstable_ImmediatePriority,Le=t.unstable_UserBlockingPriority,ut=t.unstable_NormalPriority,Qe=t.unstable_LowPriority,Je=t.unstable_IdlePriority,Ft=t.log,tn=t.unstable_setDisableYieldValue,Gt=null,Lt=null;function nn(e){if(typeof Ft=="function"&&tn(e),Lt&&typeof Lt.setStrictMode=="function")try{Lt.setStrictMode(Gt,e)}catch{}}var Pt=Math.clz32?Math.clz32:ma,Ha=Math.log,Na=Math.LN2;function ma(e){return e>>>=0,e===0?32:31-(Ha(e)/Na|0)|0}var bn=256,ta=262144,Pn=4194304;function gn(e){var a=e&42;if(a!==0)return a;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return e&261888;case 262144:case 524288:case 1048576:case 2097152:return e&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return e&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function En(e,a,l){var i=e.pendingLanes;if(i===0)return 0;var v=0,S=e.suspendedLanes,A=e.pingedLanes;e=e.warmLanes;var Y=i&134217727;return Y!==0?(i=Y&~S,i!==0?v=gn(i):(A&=Y,A!==0?v=gn(A):l||(l=Y&~e,l!==0&&(v=gn(l))))):(Y=i&~S,Y!==0?v=gn(Y):A!==0?v=gn(A):l||(l=i&~e,l!==0&&(v=gn(l)))),v===0?0:a!==0&&a!==v&&(a&S)===0&&(S=v&-v,l=a&-a,S>=l||S===32&&(l&4194048)!==0)?a:v}function Jt(e,a){return(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&a)===0}function Un(e,a){switch(e){case 1:case 2:case 4:case 8:case 64:return a+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ya(){var e=Pn;return Pn<<=1,(Pn&62914560)===0&&(Pn=4194304),e}function ga(e){for(var a=[],l=0;31>l;l++)a.push(e);return a}function On(e,a){e.pendingLanes|=a,a!==268435456&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function za(e,a,l,i,v,S){var A=e.pendingLanes;e.pendingLanes=l,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=l,e.entangledLanes&=l,e.errorRecoveryDisabledLanes&=l,e.shellSuspendCounter=0;var Y=e.entanglements,re=e.expirationTimes,ye=e.hiddenUpdates;for(l=A&~l;0<l;){var Ce=31-Pt(l),ke=1<<Ce;Y[Ce]=0,re[Ce]=-1;var ve=ye[Ce];if(ve!==null)for(ye[Ce]=null,Ce=0;Ce<ve.length;Ce++){var we=ve[Ce];we!==null&&(we.lane&=-536870913)}l&=~ke}i!==0&&Ta(e,i,0),S!==0&&v===0&&e.tag!==0&&(e.suspendedLanes|=S&~(A&~a))}function Ta(e,a,l){e.pendingLanes|=a,e.suspendedLanes&=~a;var i=31-Pt(a);e.entangledLanes|=a,e.entanglements[i]=e.entanglements[i]|1073741824|l&261930}function Ra(e,a){var l=e.entangledLanes|=a;for(e=e.entanglements;l;){var i=31-Pt(l),v=1<<i;v&a|e[i]&a&&(e[i]|=a),l&=~v}}function va(e,a){var l=a&-a;return l=(l&42)!==0?1:Mn(l),(l&(e.suspendedLanes|a))!==0?0:l}function Mn(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function _a(e){return e&=-e,2<e?8<e?(e&134217727)!==0?32:268435456:8:2}function Da(){var e=R.p;return e!==0?e:(e=window.event,e===void 0?32:Wh(e.type))}function Aa(e,a){var l=R.p;try{return R.p=e,a()}finally{R.p=l}}var hn=Math.random().toString(36).slice(2),$t="__reactFiber$"+hn,Mt="__reactProps$"+hn,jn="__reactContainer$"+hn,wa="__reactEvents$"+hn,Ba="__reactListeners$"+hn,Ga="__reactHandles$"+hn,Fa="__reactResources$"+hn,Vn="__reactMarker$"+hn;function na(e){delete e[$t],delete e[Mt],delete e[wa],delete e[Ba],delete e[Ga]}function vn(e){var a=e[$t];if(a)return a;for(var l=e.parentNode;l;){if(a=l[jn]||l[$t]){if(l=a.alternate,a.child!==null||l!==null&&l.child!==null)for(e=Ah(e);e!==null;){if(l=e[$t])return l;e=Ah(e)}return a}e=l,l=e.parentNode}return null}function _n(e){if(e=e[$t]||e[jn]){var a=e.tag;if(a===5||a===6||a===13||a===31||a===26||a===27||a===3)return e}return null}function kn(e){var a=e.tag;if(a===5||a===26||a===27||a===6)return e.stateNode;throw Error(c(33))}function wn(e){var a=e[Fa];return a||(a=e[Fa]={hoistableStyles:new Map,hoistableScripts:new Map}),a}function Tt(e){e[Vn]=!0}var xa=new Set,Ca={};function mn(e,a){xn(e,a),xn(e+"Capture",a)}function xn(e,a){for(Ca[e]=a,e=0;e<a.length;e++)xa.add(a[e])}var ge=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),De={},Me={};function ot(e){return Fe.call(Me,e)?!0:Fe.call(De,e)?!1:ge.test(e)?Me[e]=!0:(De[e]=!0,!1)}function ze(e,a,l){if(ot(a))if(l===null)e.removeAttribute(a);else{switch(typeof l){case"undefined":case"function":case"symbol":e.removeAttribute(a);return;case"boolean":var i=a.toLowerCase().slice(0,5);if(i!=="data-"&&i!=="aria-"){e.removeAttribute(a);return}}e.setAttribute(a,""+l)}}function Ye(e,a,l){if(l===null)e.removeAttribute(a);else{switch(typeof l){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(a);return}e.setAttribute(a,""+l)}}function me(e,a,l,i){if(i===null)e.removeAttribute(l);else{switch(typeof i){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(l);return}e.setAttributeNS(a,l,""+i)}}function xe(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function Pe(e){var a=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(a==="checkbox"||a==="radio")}function Ae(e,a,l){var i=Object.getOwnPropertyDescriptor(e.constructor.prototype,a);if(!e.hasOwnProperty(a)&&typeof i<"u"&&typeof i.get=="function"&&typeof i.set=="function"){var v=i.get,S=i.set;return Object.defineProperty(e,a,{configurable:!0,get:function(){return v.call(this)},set:function(A){l=""+A,S.call(this,A)}}),Object.defineProperty(e,a,{enumerable:i.enumerable}),{getValue:function(){return l},setValue:function(A){l=""+A},stopTracking:function(){e._valueTracker=null,delete e[a]}}}}function Xe(e){if(!e._valueTracker){var a=Pe(e)?"checked":"value";e._valueTracker=Ae(e,a,""+e[a])}}function it(e){if(!e)return!1;var a=e._valueTracker;if(!a)return!0;var l=a.getValue(),i="";return e&&(i=Pe(e)?e.checked?"true":"false":e.value),e=i,e!==l?(a.setValue(e),!0):!1}function Ut(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}var xt=/[\n"\\]/g;function Vt(e){return e.replace(xt,function(a){return"\\"+a.charCodeAt(0).toString(16)+" "})}function Sa(e,a,l,i,v,S,A,Y){e.name="",A!=null&&typeof A!="function"&&typeof A!="symbol"&&typeof A!="boolean"?e.type=A:e.removeAttribute("type"),a!=null?A==="number"?(a===0&&e.value===""||e.value!=a)&&(e.value=""+xe(a)):e.value!==""+xe(a)&&(e.value=""+xe(a)):A!=="submit"&&A!=="reset"||e.removeAttribute("value"),a!=null?po(e,A,xe(a)):l!=null?po(e,A,xe(l)):i!=null&&e.removeAttribute("value"),v==null&&S!=null&&(e.defaultChecked=!!S),v!=null&&(e.checked=v&&typeof v!="function"&&typeof v!="symbol"),Y!=null&&typeof Y!="function"&&typeof Y!="symbol"&&typeof Y!="boolean"?e.name=""+xe(Y):e.removeAttribute("name")}function Hn(e,a,l,i,v,S,A,Y){if(S!=null&&typeof S!="function"&&typeof S!="symbol"&&typeof S!="boolean"&&(e.type=S),a!=null||l!=null){if(!(S!=="submit"&&S!=="reset"||a!=null)){Xe(e);return}l=l!=null?""+xe(l):"",a=a!=null?""+xe(a):l,Y||a===e.value||(e.value=a),e.defaultValue=a}i=i??v,i=typeof i!="function"&&typeof i!="symbol"&&!!i,e.checked=Y?e.checked:!!i,e.defaultChecked=!!i,A!=null&&typeof A!="function"&&typeof A!="symbol"&&typeof A!="boolean"&&(e.name=A),Xe(e)}function po(e,a,l){a==="number"&&Ut(e.ownerDocument)===e||e.defaultValue===""+l||(e.defaultValue=""+l)}function $a(e,a,l,i){if(e=e.options,a){a={};for(var v=0;v<l.length;v++)a["$"+l[v]]=!0;for(l=0;l<e.length;l++)v=a.hasOwnProperty("$"+e[l].value),e[l].selected!==v&&(e[l].selected=v),v&&i&&(e[l].defaultSelected=!0)}else{for(l=""+xe(l),a=null,v=0;v<e.length;v++){if(e[v].value===l){e[v].selected=!0,i&&(e[v].defaultSelected=!0);return}a!==null||e[v].disabled||(a=e[v])}a!==null&&(a.selected=!0)}}function fo(e,a,l){if(a!=null&&(a=""+xe(a),a!==e.value&&(e.value=a),l==null)){e.defaultValue!==a&&(e.defaultValue=a);return}e.defaultValue=l!=null?""+xe(l):""}function ho(e,a,l,i){if(a==null){if(i!=null){if(l!=null)throw Error(c(92));if(M(i)){if(1<i.length)throw Error(c(93));i=i[0]}l=i}l==null&&(l=""),a=l}l=xe(a),e.defaultValue=l,i=e.textContent,i===l&&i!==""&&i!==null&&(e.value=i),Xe(e)}function aa(e,a){if(a){var l=e.firstChild;if(l&&l===e.lastChild&&l.nodeType===3){l.nodeValue=a;return}}e.textContent=a}var Zo=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function mo(e,a,l){var i=a.indexOf("--")===0;l==null||typeof l=="boolean"||l===""?i?e.setProperty(a,""):a==="float"?e.cssFloat="":e[a]="":i?e.setProperty(a,l):typeof l!="number"||l===0||Zo.has(a)?a==="float"?e.cssFloat=l:e[a]=(""+l).trim():e[a]=l+"px"}function yo(e,a,l){if(a!=null&&typeof a!="object")throw Error(c(62));if(e=e.style,l!=null){for(var i in l)!l.hasOwnProperty(i)||a!=null&&a.hasOwnProperty(i)||(i.indexOf("--")===0?e.setProperty(i,""):i==="float"?e.cssFloat="":e[i]="");for(var v in a)i=a[v],a.hasOwnProperty(v)&&l[v]!==i&&mo(e,v,i)}else for(var S in a)a.hasOwnProperty(S)&&mo(e,S,a[S])}function Ht(e){if(e.indexOf("-")===-1)return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Cr=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Sr=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Ya(e){return Sr.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}function Nn(){}var go=null;function vo(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var ba=null,Tn=null;function Rt(e){var a=_n(e);if(a&&(e=a.stateNode)){var l=e[Mt]||null;e:switch(e=a.stateNode,a.type){case"input":if(Sa(e,l.value,l.defaultValue,l.defaultValue,l.checked,l.defaultChecked,l.type,l.name),a=l.name,l.type==="radio"&&a!=null){for(l=e;l.parentNode;)l=l.parentNode;for(l=l.querySelectorAll('input[name="'+Vt(""+a)+'"][type="radio"]'),a=0;a<l.length;a++){var i=l[a];if(i!==e&&i.form===e.form){var v=i[Mt]||null;if(!v)throw Error(c(90));Sa(i,v.value,v.defaultValue,v.defaultValue,v.checked,v.defaultChecked,v.type,v.name)}}for(a=0;a<l.length;a++)i=l[a],i.form===e.form&&it(i)}break e;case"textarea":fo(e,l.value,l.defaultValue);break e;case"select":a=l.value,a!=null&&$a(e,!!l.multiple,a,!1)}}}var Ue=!1;function zn(e,a,l){if(Ue)return e(a,l);Ue=!0;try{var i=e(a);return i}finally{if(Ue=!1,(ba!==null||Tn!==null)&&(Ks(),ba&&(a=ba,e=Tn,Tn=ba=null,Rt(a),e)))for(a=0;a<e.length;a++)Rt(e[a])}}function Ia(e,a){var l=e.stateNode;if(l===null)return null;var i=l[Mt]||null;if(i===null)return null;l=i[a];e:switch(a){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(e=e.type,i=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!i;break e;default:e=!1}if(e)return null;if(l&&typeof l!="function")throw Error(c(231,a,typeof l));return l}var oa=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),us=!1;if(oa)try{var _o={};Object.defineProperty(_o,"passive",{get:function(){us=!0}}),window.addEventListener("test",_o,_o),window.removeEventListener("test",_o,_o)}catch{us=!1}var wo=null,Uc=null,ps=null;function bu(){if(ps)return ps;var e,a=Uc,l=a.length,i,v="value"in wo?wo.value:wo.textContent,S=v.length;for(e=0;e<l&&a[e]===v[e];e++);var A=l-e;for(i=1;i<=A&&a[l-i]===v[S-i];i++);return ps=v.slice(e,1<i?1-i:void 0)}function fs(e){var a=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&a===13&&(e=13)):e=a,e===10&&(e=13),32<=e||e===13?e:0}function hs(){return!0}function Eu(){return!1}function Rn(e){function a(l,i,v,S,A){this._reactName=l,this._targetInst=v,this.type=i,this.nativeEvent=S,this.target=A,this.currentTarget=null;for(var Y in e)e.hasOwnProperty(Y)&&(l=e[Y],this[Y]=l?l(S):S[Y]);return this.isDefaultPrevented=(S.defaultPrevented!=null?S.defaultPrevented:S.returnValue===!1)?hs:Eu,this.isPropagationStopped=Eu,this}return y(a.prototype,{preventDefault:function(){this.defaultPrevented=!0;var l=this.nativeEvent;l&&(l.preventDefault?l.preventDefault():typeof l.returnValue!="unknown"&&(l.returnValue=!1),this.isDefaultPrevented=hs)},stopPropagation:function(){var l=this.nativeEvent;l&&(l.stopPropagation?l.stopPropagation():typeof l.cancelBubble!="unknown"&&(l.cancelBubble=!0),this.isPropagationStopped=hs)},persist:function(){},isPersistent:hs}),a}var Ko={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ms=Rn(Ko),ml=y({},Ko,{view:0,detail:0}),Nv=Rn(ml),Oc,Mc,yl,ys=y({},ml,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Hc,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==yl&&(yl&&e.type==="mousemove"?(Oc=e.screenX-yl.screenX,Mc=e.screenY-yl.screenY):Mc=Oc=0,yl=e),Oc)},movementY:function(e){return"movementY"in e?e.movementY:Mc}}),ju=Rn(ys),Tv=y({},ys,{dataTransfer:0}),Rv=Rn(Tv),Dv=y({},ml,{relatedTarget:0}),Vc=Rn(Dv),Av=y({},Ko,{animationName:0,elapsedTime:0,pseudoElement:0}),Fv=Rn(Av),$v=y({},Ko,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Iv=Rn($v),qv=y({},Ko,{data:0}),ku=Rn(qv),Lv={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Pv={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Uv={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Ov(e){var a=this.nativeEvent;return a.getModifierState?a.getModifierState(e):(e=Uv[e])?!!a[e]:!1}function Hc(){return Ov}var Mv=y({},ml,{key:function(e){if(e.key){var a=Lv[e.key]||e.key;if(a!=="Unidentified")return a}return e.type==="keypress"?(e=fs(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?Pv[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Hc,charCode:function(e){return e.type==="keypress"?fs(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?fs(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),Vv=Rn(Mv),Hv=y({},ys,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Nu=Rn(Hv),zv=y({},ml,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Hc}),Bv=Rn(zv),Gv=y({},Ko,{propertyName:0,elapsedTime:0,pseudoElement:0}),Yv=Rn(Gv),Wv=y({},ys,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Qv=Rn(Wv),Xv=y({},Ko,{newState:0,oldState:0}),Zv=Rn(Xv),Kv=[9,13,27,32],zc=oa&&"CompositionEvent"in window,gl=null;oa&&"documentMode"in document&&(gl=document.documentMode);var Jv=oa&&"TextEvent"in window&&!gl,Tu=oa&&(!zc||gl&&8<gl&&11>=gl),Ru=" ",Du=!1;function Au(e,a){switch(e){case"keyup":return Kv.indexOf(a.keyCode)!==-1;case"keydown":return a.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Fu(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var br=!1;function e_(e,a){switch(e){case"compositionend":return Fu(a);case"keypress":return a.which!==32?null:(Du=!0,Ru);case"textInput":return e=a.data,e===Ru&&Du?null:e;default:return null}}function t_(e,a){if(br)return e==="compositionend"||!zc&&Au(e,a)?(e=bu(),ps=Uc=wo=null,br=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(a.ctrlKey||a.altKey||a.metaKey)||a.ctrlKey&&a.altKey){if(a.char&&1<a.char.length)return a.char;if(a.which)return String.fromCharCode(a.which)}return null;case"compositionend":return Tu&&a.locale!=="ko"?null:a.data;default:return null}}var n_={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function $u(e){var a=e&&e.nodeName&&e.nodeName.toLowerCase();return a==="input"?!!n_[e.type]:a==="textarea"}function Iu(e,a,l,i){ba?Tn?Tn.push(i):Tn=[i]:ba=i,a=rc(a,"onChange"),0<a.length&&(l=new ms("onChange","change",null,l,i),e.push({event:l,listeners:a}))}var vl=null,_l=null;function a_(e){vh(e,0)}function gs(e){var a=kn(e);if(it(a))return e}function qu(e,a){if(e==="change")return a}var Lu=!1;if(oa){var Bc;if(oa){var Gc="oninput"in document;if(!Gc){var Pu=document.createElement("div");Pu.setAttribute("oninput","return;"),Gc=typeof Pu.oninput=="function"}Bc=Gc}else Bc=!1;Lu=Bc&&(!document.documentMode||9<document.documentMode)}function Uu(){vl&&(vl.detachEvent("onpropertychange",Ou),_l=vl=null)}function Ou(e){if(e.propertyName==="value"&&gs(_l)){var a=[];Iu(a,_l,e,vo(e)),zn(a_,a)}}function o_(e,a,l){e==="focusin"?(Uu(),vl=a,_l=l,vl.attachEvent("onpropertychange",Ou)):e==="focusout"&&Uu()}function r_(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return gs(_l)}function l_(e,a){if(e==="click")return gs(a)}function s_(e,a){if(e==="input"||e==="change")return gs(a)}function c_(e,a){return e===a&&(e!==0||1/e===1/a)||e!==e&&a!==a}var Bn=typeof Object.is=="function"?Object.is:c_;function wl(e,a){if(Bn(e,a))return!0;if(typeof e!="object"||e===null||typeof a!="object"||a===null)return!1;var l=Object.keys(e),i=Object.keys(a);if(l.length!==i.length)return!1;for(i=0;i<l.length;i++){var v=l[i];if(!Fe.call(a,v)||!Bn(e[v],a[v]))return!1}return!0}function Mu(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Vu(e,a){var l=Mu(e);e=0;for(var i;l;){if(l.nodeType===3){if(i=e+l.textContent.length,e<=a&&i>=a)return{node:l,offset:a-e};e=i}e:{for(;l;){if(l.nextSibling){l=l.nextSibling;break e}l=l.parentNode}l=void 0}l=Mu(l)}}function Hu(e,a){return e&&a?e===a?!0:e&&e.nodeType===3?!1:a&&a.nodeType===3?Hu(e,a.parentNode):"contains"in e?e.contains(a):e.compareDocumentPosition?!!(e.compareDocumentPosition(a)&16):!1:!1}function zu(e){e=e!=null&&e.ownerDocument!=null&&e.ownerDocument.defaultView!=null?e.ownerDocument.defaultView:window;for(var a=Ut(e.document);a instanceof e.HTMLIFrameElement;){try{var l=typeof a.contentWindow.location.href=="string"}catch{l=!1}if(l)e=a.contentWindow;else break;a=Ut(e.document)}return a}function Yc(e){var a=e&&e.nodeName&&e.nodeName.toLowerCase();return a&&(a==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||a==="textarea"||e.contentEditable==="true")}var i_=oa&&"documentMode"in document&&11>=document.documentMode,Er=null,Wc=null,xl=null,Qc=!1;function Bu(e,a,l){var i=l.window===l?l.document:l.nodeType===9?l:l.ownerDocument;Qc||Er==null||Er!==Ut(i)||(i=Er,"selectionStart"in i&&Yc(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),xl&&wl(xl,i)||(xl=i,i=rc(Wc,"onSelect"),0<i.length&&(a=new ms("onSelect","select",null,a,l),e.push({event:a,listeners:i}),a.target=Er)))}function Jo(e,a){var l={};return l[e.toLowerCase()]=a.toLowerCase(),l["Webkit"+e]="webkit"+a,l["Moz"+e]="moz"+a,l}var jr={animationend:Jo("Animation","AnimationEnd"),animationiteration:Jo("Animation","AnimationIteration"),animationstart:Jo("Animation","AnimationStart"),transitionrun:Jo("Transition","TransitionRun"),transitionstart:Jo("Transition","TransitionStart"),transitioncancel:Jo("Transition","TransitionCancel"),transitionend:Jo("Transition","TransitionEnd")},Xc={},Gu={};oa&&(Gu=document.createElement("div").style,"AnimationEvent"in window||(delete jr.animationend.animation,delete jr.animationiteration.animation,delete jr.animationstart.animation),"TransitionEvent"in window||delete jr.transitionend.transition);function er(e){if(Xc[e])return Xc[e];if(!jr[e])return e;var a=jr[e],l;for(l in a)if(a.hasOwnProperty(l)&&l in Gu)return Xc[e]=a[l];return e}var Yu=er("animationend"),Wu=er("animationiteration"),Qu=er("animationstart"),d_=er("transitionrun"),u_=er("transitionstart"),p_=er("transitioncancel"),Xu=er("transitionend"),Zu=new Map,Zc="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Zc.push("scrollEnd");function Ea(e,a){Zu.set(e,a),mn(a,[e])}var vs=typeof reportError=="function"?reportError:function(e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var a=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof e=="object"&&e!==null&&typeof e.message=="string"?String(e.message):String(e),error:e});if(!window.dispatchEvent(a))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",e);return}console.error(e)},ra=[],kr=0,Kc=0;function _s(){for(var e=kr,a=Kc=kr=0;a<e;){var l=ra[a];ra[a++]=null;var i=ra[a];ra[a++]=null;var v=ra[a];ra[a++]=null;var S=ra[a];if(ra[a++]=null,i!==null&&v!==null){var A=i.pending;A===null?v.next=v:(v.next=A.next,A.next=v),i.pending=v}S!==0&&Ku(l,v,S)}}function ws(e,a,l,i){ra[kr++]=e,ra[kr++]=a,ra[kr++]=l,ra[kr++]=i,Kc|=i,e.lanes|=i,e=e.alternate,e!==null&&(e.lanes|=i)}function Jc(e,a,l,i){return ws(e,a,l,i),xs(e)}function tr(e,a){return ws(e,null,null,a),xs(e)}function Ku(e,a,l){e.lanes|=l;var i=e.alternate;i!==null&&(i.lanes|=l);for(var v=!1,S=e.return;S!==null;)S.childLanes|=l,i=S.alternate,i!==null&&(i.childLanes|=l),S.tag===22&&(e=S.stateNode,e===null||e._visibility&1||(v=!0)),e=S,S=S.return;return e.tag===3?(S=e.stateNode,v&&a!==null&&(v=31-Pt(l),e=S.hiddenUpdates,i=e[v],i===null?e[v]=[a]:i.push(a),a.lane=l|536870912),S):null}function xs(e){if(50<Hl)throw Hl=0,cd=null,Error(c(185));for(var a=e.return;a!==null;)e=a,a=e.return;return e.tag===3?e.stateNode:null}var Nr={};function f_(e,a,l,i){this.tag=e,this.key=l,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=a,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Gn(e,a,l,i){return new f_(e,a,l,i)}function ei(e){return e=e.prototype,!(!e||!e.isReactComponent)}function Wa(e,a){var l=e.alternate;return l===null?(l=Gn(e.tag,a,e.key,e.mode),l.elementType=e.elementType,l.type=e.type,l.stateNode=e.stateNode,l.alternate=e,e.alternate=l):(l.pendingProps=a,l.type=e.type,l.flags=0,l.subtreeFlags=0,l.deletions=null),l.flags=e.flags&65011712,l.childLanes=e.childLanes,l.lanes=e.lanes,l.child=e.child,l.memoizedProps=e.memoizedProps,l.memoizedState=e.memoizedState,l.updateQueue=e.updateQueue,a=e.dependencies,l.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext},l.sibling=e.sibling,l.index=e.index,l.ref=e.ref,l.refCleanup=e.refCleanup,l}function Ju(e,a){e.flags&=65011714;var l=e.alternate;return l===null?(e.childLanes=0,e.lanes=a,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=l.childLanes,e.lanes=l.lanes,e.child=l.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=l.memoizedProps,e.memoizedState=l.memoizedState,e.updateQueue=l.updateQueue,e.type=l.type,a=l.dependencies,e.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext}),e}function Cs(e,a,l,i,v,S){var A=0;if(i=e,typeof e=="function")ei(e)&&(A=1);else if(typeof e=="string")A=v0(e,l,Z.current)?26:e==="html"||e==="head"||e==="body"?27:5;else e:switch(e){case W:return e=Gn(31,l,a,v),e.elementType=W,e.lanes=S,e;case C:return nr(l.children,v,S,a);case b:A=8,v|=24;break;case j:return e=Gn(12,l,a,v|2),e.elementType=j,e.lanes=S,e;case F:return e=Gn(13,l,a,v),e.elementType=F,e.lanes=S,e;case U:return e=Gn(19,l,a,v),e.elementType=U,e.lanes=S,e;default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case E:A=10;break e;case k:A=9;break e;case T:A=11;break e;case D:A=14;break e;case I:A=16,i=null;break e}A=29,l=Error(c(130,e===null?"null":typeof e,"")),i=null}return a=Gn(A,l,a,v),a.elementType=e,a.type=i,a.lanes=S,a}function nr(e,a,l,i){return e=Gn(7,e,i,a),e.lanes=l,e}function ti(e,a,l){return e=Gn(6,e,null,a),e.lanes=l,e}function ep(e){var a=Gn(18,null,null,0);return a.stateNode=e,a}function ni(e,a,l){return a=Gn(4,e.children!==null?e.children:[],e.key,a),a.lanes=l,a.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},a}var tp=new WeakMap;function la(e,a){if(typeof e=="object"&&e!==null){var l=tp.get(e);return l!==void 0?l:(a={value:e,source:a,stack:Se(a)},tp.set(e,a),a)}return{value:e,source:a,stack:Se(a)}}var Tr=[],Rr=0,Ss=null,Cl=0,sa=[],ca=0,xo=null,qa=1,La="";function Qa(e,a){Tr[Rr++]=Cl,Tr[Rr++]=Ss,Ss=e,Cl=a}function np(e,a,l){sa[ca++]=qa,sa[ca++]=La,sa[ca++]=xo,xo=e;var i=qa;e=La;var v=32-Pt(i)-1;i&=~(1<<v),l+=1;var S=32-Pt(a)+v;if(30<S){var A=v-v%5;S=(i&(1<<A)-1).toString(32),i>>=A,v-=A,qa=1<<32-Pt(a)+v|l<<v|i,La=S+e}else qa=1<<S|l<<v|i,La=e}function ai(e){e.return!==null&&(Qa(e,1),np(e,1,0))}function oi(e){for(;e===Ss;)Ss=Tr[--Rr],Tr[Rr]=null,Cl=Tr[--Rr],Tr[Rr]=null;for(;e===xo;)xo=sa[--ca],sa[ca]=null,La=sa[--ca],sa[ca]=null,qa=sa[--ca],sa[ca]=null}function ap(e,a){sa[ca++]=qa,sa[ca++]=La,sa[ca++]=xo,qa=a.id,La=a.overflow,xo=e}var rn=null,It=null,gt=!1,Co=null,ia=!1,ri=Error(c(519));function So(e){var a=Error(c(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Sl(la(a,e)),ri}function op(e){var a=e.stateNode,l=e.type,i=e.memoizedProps;switch(a[$t]=e,a[Mt]=i,l){case"dialog":ht("cancel",a),ht("close",a);break;case"iframe":case"object":case"embed":ht("load",a);break;case"video":case"audio":for(l=0;l<Bl.length;l++)ht(Bl[l],a);break;case"source":ht("error",a);break;case"img":case"image":case"link":ht("error",a),ht("load",a);break;case"details":ht("toggle",a);break;case"input":ht("invalid",a),Hn(a,i.value,i.defaultValue,i.checked,i.defaultChecked,i.type,i.name,!0);break;case"select":ht("invalid",a);break;case"textarea":ht("invalid",a),ho(a,i.value,i.defaultValue,i.children)}l=i.children,typeof l!="string"&&typeof l!="number"&&typeof l!="bigint"||a.textContent===""+l||i.suppressHydrationWarning===!0||Ch(a.textContent,l)?(i.popover!=null&&(ht("beforetoggle",a),ht("toggle",a)),i.onScroll!=null&&ht("scroll",a),i.onScrollEnd!=null&&ht("scrollend",a),i.onClick!=null&&(a.onclick=Nn),a=!0):a=!1,a||So(e,!0)}function rp(e){for(rn=e.return;rn;)switch(rn.tag){case 5:case 31:case 13:ia=!1;return;case 27:case 3:ia=!0;return;default:rn=rn.return}}function Dr(e){if(e!==rn)return!1;if(!gt)return rp(e),gt=!0,!1;var a=e.tag,l;if((l=a!==3&&a!==27)&&((l=a===5)&&(l=e.type,l=!(l!=="form"&&l!=="button")||Sd(e.type,e.memoizedProps)),l=!l),l&&It&&So(e),rp(e),a===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(c(317));It=Dh(e)}else if(a===31){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(c(317));It=Dh(e)}else a===27?(a=It,Lo(e.type)?(e=Nd,Nd=null,It=e):It=a):It=rn?ua(e.stateNode.nextSibling):null;return!0}function ar(){It=rn=null,gt=!1}function li(){var e=Co;return e!==null&&($n===null?$n=e:$n.push.apply($n,e),Co=null),e}function Sl(e){Co===null?Co=[e]:Co.push(e)}var si=q(null),or=null,Xa=null;function bo(e,a,l){K(si,a._currentValue),a._currentValue=l}function Za(e){e._currentValue=si.current,Q(si)}function ci(e,a,l){for(;e!==null;){var i=e.alternate;if((e.childLanes&a)!==a?(e.childLanes|=a,i!==null&&(i.childLanes|=a)):i!==null&&(i.childLanes&a)!==a&&(i.childLanes|=a),e===l)break;e=e.return}}function ii(e,a,l,i){var v=e.child;for(v!==null&&(v.return=e);v!==null;){var S=v.dependencies;if(S!==null){var A=v.child;S=S.firstContext;e:for(;S!==null;){var Y=S;S=v;for(var re=0;re<a.length;re++)if(Y.context===a[re]){S.lanes|=l,Y=S.alternate,Y!==null&&(Y.lanes|=l),ci(S.return,l,e),i||(A=null);break e}S=Y.next}}else if(v.tag===18){if(A=v.return,A===null)throw Error(c(341));A.lanes|=l,S=A.alternate,S!==null&&(S.lanes|=l),ci(A,l,e),A=null}else A=v.child;if(A!==null)A.return=v;else for(A=v;A!==null;){if(A===e){A=null;break}if(v=A.sibling,v!==null){v.return=A.return,A=v;break}A=A.return}v=A}}function Ar(e,a,l,i){e=null;for(var v=a,S=!1;v!==null;){if(!S){if((v.flags&524288)!==0)S=!0;else if((v.flags&262144)!==0)break}if(v.tag===10){var A=v.alternate;if(A===null)throw Error(c(387));if(A=A.memoizedProps,A!==null){var Y=v.type;Bn(v.pendingProps.value,A.value)||(e!==null?e.push(Y):e=[Y])}}else if(v===se.current){if(A=v.alternate,A===null)throw Error(c(387));A.memoizedState.memoizedState!==v.memoizedState.memoizedState&&(e!==null?e.push(Xl):e=[Xl])}v=v.return}e!==null&&ii(a,e,l,i),a.flags|=262144}function bs(e){for(e=e.firstContext;e!==null;){if(!Bn(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function rr(e){or=e,Xa=null,e=e.dependencies,e!==null&&(e.firstContext=null)}function ln(e){return lp(or,e)}function Es(e,a){return or===null&&rr(e),lp(e,a)}function lp(e,a){var l=a._currentValue;if(a={context:a,memoizedValue:l,next:null},Xa===null){if(e===null)throw Error(c(308));Xa=a,e.dependencies={lanes:0,firstContext:a},e.flags|=524288}else Xa=Xa.next=a;return l}var h_=typeof AbortController<"u"?AbortController:function(){var e=[],a=this.signal={aborted:!1,addEventListener:function(l,i){e.push(i)}};this.abort=function(){a.aborted=!0,e.forEach(function(l){return l()})}},m_=t.unstable_scheduleCallback,y_=t.unstable_NormalPriority,Qt={$$typeof:E,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function di(){return{controller:new h_,data:new Map,refCount:0}}function bl(e){e.refCount--,e.refCount===0&&m_(y_,function(){e.controller.abort()})}var El=null,ui=0,Fr=0,$r=null;function g_(e,a){if(El===null){var l=El=[];ui=0,Fr=hd(),$r={status:"pending",value:void 0,then:function(i){l.push(i)}}}return ui++,a.then(sp,sp),a}function sp(){if(--ui===0&&El!==null){$r!==null&&($r.status="fulfilled");var e=El;El=null,Fr=0,$r=null;for(var a=0;a<e.length;a++)(0,e[a])()}}function v_(e,a){var l=[],i={status:"pending",value:null,reason:null,then:function(v){l.push(v)}};return e.then(function(){i.status="fulfilled",i.value=a;for(var v=0;v<l.length;v++)(0,l[v])(a)},function(v){for(i.status="rejected",i.reason=v,v=0;v<l.length;v++)(0,l[v])(void 0)}),i}var cp=N.S;N.S=function(e,a){Gf=qe(),typeof a=="object"&&a!==null&&typeof a.then=="function"&&g_(e,a),cp!==null&&cp(e,a)};var lr=q(null);function pi(){var e=lr.current;return e!==null?e:Dt.pooledCache}function js(e,a){a===null?K(lr,lr.current):K(lr,a.pool)}function ip(){var e=pi();return e===null?null:{parent:Qt._currentValue,pool:e}}var Ir=Error(c(460)),fi=Error(c(474)),ks=Error(c(542)),Ns={then:function(){}};function dp(e){return e=e.status,e==="fulfilled"||e==="rejected"}function up(e,a,l){switch(l=e[l],l===void 0?e.push(a):l!==a&&(a.then(Nn,Nn),a=l),a.status){case"fulfilled":return a.value;case"rejected":throw e=a.reason,fp(e),e;default:if(typeof a.status=="string")a.then(Nn,Nn);else{if(e=Dt,e!==null&&100<e.shellSuspendCounter)throw Error(c(482));e=a,e.status="pending",e.then(function(i){if(a.status==="pending"){var v=a;v.status="fulfilled",v.value=i}},function(i){if(a.status==="pending"){var v=a;v.status="rejected",v.reason=i}})}switch(a.status){case"fulfilled":return a.value;case"rejected":throw e=a.reason,fp(e),e}throw cr=a,Ir}}function sr(e){try{var a=e._init;return a(e._payload)}catch(l){throw l!==null&&typeof l=="object"&&typeof l.then=="function"?(cr=l,Ir):l}}var cr=null;function pp(){if(cr===null)throw Error(c(459));var e=cr;return cr=null,e}function fp(e){if(e===Ir||e===ks)throw Error(c(483))}var qr=null,jl=0;function Ts(e){var a=jl;return jl+=1,qr===null&&(qr=[]),up(qr,e,a)}function kl(e,a){a=a.props.ref,e.ref=a!==void 0?a:null}function Rs(e,a){throw a.$$typeof===m?Error(c(525)):(e=Object.prototype.toString.call(a),Error(c(31,e==="[object Object]"?"object with keys {"+Object.keys(a).join(", ")+"}":e)))}function hp(e){function a(ue,le){if(e){var he=ue.deletions;he===null?(ue.deletions=[le],ue.flags|=16):he.push(le)}}function l(ue,le){if(!e)return null;for(;le!==null;)a(ue,le),le=le.sibling;return null}function i(ue){for(var le=new Map;ue!==null;)ue.key!==null?le.set(ue.key,ue):le.set(ue.index,ue),ue=ue.sibling;return le}function v(ue,le){return ue=Wa(ue,le),ue.index=0,ue.sibling=null,ue}function S(ue,le,he){return ue.index=he,e?(he=ue.alternate,he!==null?(he=he.index,he<le?(ue.flags|=67108866,le):he):(ue.flags|=67108866,le)):(ue.flags|=1048576,le)}function A(ue){return e&&ue.alternate===null&&(ue.flags|=67108866),ue}function Y(ue,le,he,Ee){return le===null||le.tag!==6?(le=ti(he,ue.mode,Ee),le.return=ue,le):(le=v(le,he),le.return=ue,le)}function re(ue,le,he,Ee){var Ze=he.type;return Ze===C?Ce(ue,le,he.props.children,Ee,he.key):le!==null&&(le.elementType===Ze||typeof Ze=="object"&&Ze!==null&&Ze.$$typeof===I&&sr(Ze)===le.type)?(le=v(le,he.props),kl(le,he),le.return=ue,le):(le=Cs(he.type,he.key,he.props,null,ue.mode,Ee),kl(le,he),le.return=ue,le)}function ye(ue,le,he,Ee){return le===null||le.tag!==4||le.stateNode.containerInfo!==he.containerInfo||le.stateNode.implementation!==he.implementation?(le=ni(he,ue.mode,Ee),le.return=ue,le):(le=v(le,he.children||[]),le.return=ue,le)}function Ce(ue,le,he,Ee,Ze){return le===null||le.tag!==7?(le=nr(he,ue.mode,Ee,Ze),le.return=ue,le):(le=v(le,he),le.return=ue,le)}function ke(ue,le,he){if(typeof le=="string"&&le!==""||typeof le=="number"||typeof le=="bigint")return le=ti(""+le,ue.mode,he),le.return=ue,le;if(typeof le=="object"&&le!==null){switch(le.$$typeof){case g:return he=Cs(le.type,le.key,le.props,null,ue.mode,he),kl(he,le),he.return=ue,he;case x:return le=ni(le,ue.mode,he),le.return=ue,le;case I:return le=sr(le),ke(ue,le,he)}if(M(le)||B(le))return le=nr(le,ue.mode,he,null),le.return=ue,le;if(typeof le.then=="function")return ke(ue,Ts(le),he);if(le.$$typeof===E)return ke(ue,Es(ue,le),he);Rs(ue,le)}return null}function ve(ue,le,he,Ee){var Ze=le!==null?le.key:null;if(typeof he=="string"&&he!==""||typeof he=="number"||typeof he=="bigint")return Ze!==null?null:Y(ue,le,""+he,Ee);if(typeof he=="object"&&he!==null){switch(he.$$typeof){case g:return he.key===Ze?re(ue,le,he,Ee):null;case x:return he.key===Ze?ye(ue,le,he,Ee):null;case I:return he=sr(he),ve(ue,le,he,Ee)}if(M(he)||B(he))return Ze!==null?null:Ce(ue,le,he,Ee,null);if(typeof he.then=="function")return ve(ue,le,Ts(he),Ee);if(he.$$typeof===E)return ve(ue,le,Es(ue,he),Ee);Rs(ue,he)}return null}function we(ue,le,he,Ee,Ze){if(typeof Ee=="string"&&Ee!==""||typeof Ee=="number"||typeof Ee=="bigint")return ue=ue.get(he)||null,Y(le,ue,""+Ee,Ze);if(typeof Ee=="object"&&Ee!==null){switch(Ee.$$typeof){case g:return ue=ue.get(Ee.key===null?he:Ee.key)||null,re(le,ue,Ee,Ze);case x:return ue=ue.get(Ee.key===null?he:Ee.key)||null,ye(le,ue,Ee,Ze);case I:return Ee=sr(Ee),we(ue,le,he,Ee,Ze)}if(M(Ee)||B(Ee))return ue=ue.get(he)||null,Ce(le,ue,Ee,Ze,null);if(typeof Ee.then=="function")return we(ue,le,he,Ts(Ee),Ze);if(Ee.$$typeof===E)return we(ue,le,he,Es(le,Ee),Ze);Rs(le,Ee)}return null}function Be(ue,le,he,Ee){for(var Ze=null,_t=null,We=le,st=le=0,yt=null;We!==null&&st<he.length;st++){We.index>st?(yt=We,We=null):yt=We.sibling;var wt=ve(ue,We,he[st],Ee);if(wt===null){We===null&&(We=yt);break}e&&We&&wt.alternate===null&&a(ue,We),le=S(wt,le,st),_t===null?Ze=wt:_t.sibling=wt,_t=wt,We=yt}if(st===he.length)return l(ue,We),gt&&Qa(ue,st),Ze;if(We===null){for(;st<he.length;st++)We=ke(ue,he[st],Ee),We!==null&&(le=S(We,le,st),_t===null?Ze=We:_t.sibling=We,_t=We);return gt&&Qa(ue,st),Ze}for(We=i(We);st<he.length;st++)yt=we(We,ue,st,he[st],Ee),yt!==null&&(e&&yt.alternate!==null&&We.delete(yt.key===null?st:yt.key),le=S(yt,le,st),_t===null?Ze=yt:_t.sibling=yt,_t=yt);return e&&We.forEach(function(Vo){return a(ue,Vo)}),gt&&Qa(ue,st),Ze}function et(ue,le,he,Ee){if(he==null)throw Error(c(151));for(var Ze=null,_t=null,We=le,st=le=0,yt=null,wt=he.next();We!==null&&!wt.done;st++,wt=he.next()){We.index>st?(yt=We,We=null):yt=We.sibling;var Vo=ve(ue,We,wt.value,Ee);if(Vo===null){We===null&&(We=yt);break}e&&We&&Vo.alternate===null&&a(ue,We),le=S(Vo,le,st),_t===null?Ze=Vo:_t.sibling=Vo,_t=Vo,We=yt}if(wt.done)return l(ue,We),gt&&Qa(ue,st),Ze;if(We===null){for(;!wt.done;st++,wt=he.next())wt=ke(ue,wt.value,Ee),wt!==null&&(le=S(wt,le,st),_t===null?Ze=wt:_t.sibling=wt,_t=wt);return gt&&Qa(ue,st),Ze}for(We=i(We);!wt.done;st++,wt=he.next())wt=we(We,ue,st,wt.value,Ee),wt!==null&&(e&&wt.alternate!==null&&We.delete(wt.key===null?st:wt.key),le=S(wt,le,st),_t===null?Ze=wt:_t.sibling=wt,_t=wt);return e&&We.forEach(function(T0){return a(ue,T0)}),gt&&Qa(ue,st),Ze}function Nt(ue,le,he,Ee){if(typeof he=="object"&&he!==null&&he.type===C&&he.key===null&&(he=he.props.children),typeof he=="object"&&he!==null){switch(he.$$typeof){case g:e:{for(var Ze=he.key;le!==null;){if(le.key===Ze){if(Ze=he.type,Ze===C){if(le.tag===7){l(ue,le.sibling),Ee=v(le,he.props.children),Ee.return=ue,ue=Ee;break e}}else if(le.elementType===Ze||typeof Ze=="object"&&Ze!==null&&Ze.$$typeof===I&&sr(Ze)===le.type){l(ue,le.sibling),Ee=v(le,he.props),kl(Ee,he),Ee.return=ue,ue=Ee;break e}l(ue,le);break}else a(ue,le);le=le.sibling}he.type===C?(Ee=nr(he.props.children,ue.mode,Ee,he.key),Ee.return=ue,ue=Ee):(Ee=Cs(he.type,he.key,he.props,null,ue.mode,Ee),kl(Ee,he),Ee.return=ue,ue=Ee)}return A(ue);case x:e:{for(Ze=he.key;le!==null;){if(le.key===Ze)if(le.tag===4&&le.stateNode.containerInfo===he.containerInfo&&le.stateNode.implementation===he.implementation){l(ue,le.sibling),Ee=v(le,he.children||[]),Ee.return=ue,ue=Ee;break e}else{l(ue,le);break}else a(ue,le);le=le.sibling}Ee=ni(he,ue.mode,Ee),Ee.return=ue,ue=Ee}return A(ue);case I:return he=sr(he),Nt(ue,le,he,Ee)}if(M(he))return Be(ue,le,he,Ee);if(B(he)){if(Ze=B(he),typeof Ze!="function")throw Error(c(150));return he=Ze.call(he),et(ue,le,he,Ee)}if(typeof he.then=="function")return Nt(ue,le,Ts(he),Ee);if(he.$$typeof===E)return Nt(ue,le,Es(ue,he),Ee);Rs(ue,he)}return typeof he=="string"&&he!==""||typeof he=="number"||typeof he=="bigint"?(he=""+he,le!==null&&le.tag===6?(l(ue,le.sibling),Ee=v(le,he),Ee.return=ue,ue=Ee):(l(ue,le),Ee=ti(he,ue.mode,Ee),Ee.return=ue,ue=Ee),A(ue)):l(ue,le)}return function(ue,le,he,Ee){try{jl=0;var Ze=Nt(ue,le,he,Ee);return qr=null,Ze}catch(We){if(We===Ir||We===ks)throw We;var _t=Gn(29,We,null,ue.mode);return _t.lanes=Ee,_t.return=ue,_t}finally{}}}var ir=hp(!0),mp=hp(!1),Eo=!1;function hi(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function mi(e,a){e=e.updateQueue,a.updateQueue===e&&(a.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function jo(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function ko(e,a,l){var i=e.updateQueue;if(i===null)return null;if(i=i.shared,(Ct&2)!==0){var v=i.pending;return v===null?a.next=a:(a.next=v.next,v.next=a),i.pending=a,a=xs(e),Ku(e,null,l),a}return ws(e,i,a,l),xs(e)}function Nl(e,a,l){if(a=a.updateQueue,a!==null&&(a=a.shared,(l&4194048)!==0)){var i=a.lanes;i&=e.pendingLanes,l|=i,a.lanes=l,Ra(e,l)}}function yi(e,a){var l=e.updateQueue,i=e.alternate;if(i!==null&&(i=i.updateQueue,l===i)){var v=null,S=null;if(l=l.firstBaseUpdate,l!==null){do{var A={lane:l.lane,tag:l.tag,payload:l.payload,callback:null,next:null};S===null?v=S=A:S=S.next=A,l=l.next}while(l!==null);S===null?v=S=a:S=S.next=a}else v=S=a;l={baseState:i.baseState,firstBaseUpdate:v,lastBaseUpdate:S,shared:i.shared,callbacks:i.callbacks},e.updateQueue=l;return}e=l.lastBaseUpdate,e===null?l.firstBaseUpdate=a:e.next=a,l.lastBaseUpdate=a}var gi=!1;function Tl(){if(gi){var e=$r;if(e!==null)throw e}}function Rl(e,a,l,i){gi=!1;var v=e.updateQueue;Eo=!1;var S=v.firstBaseUpdate,A=v.lastBaseUpdate,Y=v.shared.pending;if(Y!==null){v.shared.pending=null;var re=Y,ye=re.next;re.next=null,A===null?S=ye:A.next=ye,A=re;var Ce=e.alternate;Ce!==null&&(Ce=Ce.updateQueue,Y=Ce.lastBaseUpdate,Y!==A&&(Y===null?Ce.firstBaseUpdate=ye:Y.next=ye,Ce.lastBaseUpdate=re))}if(S!==null){var ke=v.baseState;A=0,Ce=ye=re=null,Y=S;do{var ve=Y.lane&-536870913,we=ve!==Y.lane;if(we?(mt&ve)===ve:(i&ve)===ve){ve!==0&&ve===Fr&&(gi=!0),Ce!==null&&(Ce=Ce.next={lane:0,tag:Y.tag,payload:Y.payload,callback:null,next:null});e:{var Be=e,et=Y;ve=a;var Nt=l;switch(et.tag){case 1:if(Be=et.payload,typeof Be=="function"){ke=Be.call(Nt,ke,ve);break e}ke=Be;break e;case 3:Be.flags=Be.flags&-65537|128;case 0:if(Be=et.payload,ve=typeof Be=="function"?Be.call(Nt,ke,ve):Be,ve==null)break e;ke=y({},ke,ve);break e;case 2:Eo=!0}}ve=Y.callback,ve!==null&&(e.flags|=64,we&&(e.flags|=8192),we=v.callbacks,we===null?v.callbacks=[ve]:we.push(ve))}else we={lane:ve,tag:Y.tag,payload:Y.payload,callback:Y.callback,next:null},Ce===null?(ye=Ce=we,re=ke):Ce=Ce.next=we,A|=ve;if(Y=Y.next,Y===null){if(Y=v.shared.pending,Y===null)break;we=Y,Y=we.next,we.next=null,v.lastBaseUpdate=we,v.shared.pending=null}}while(!0);Ce===null&&(re=ke),v.baseState=re,v.firstBaseUpdate=ye,v.lastBaseUpdate=Ce,S===null&&(v.shared.lanes=0),Ao|=A,e.lanes=A,e.memoizedState=ke}}function yp(e,a){if(typeof e!="function")throw Error(c(191,e));e.call(a)}function gp(e,a){var l=e.callbacks;if(l!==null)for(e.callbacks=null,e=0;e<l.length;e++)yp(l[e],a)}var Lr=q(null),Ds=q(0);function vp(e,a){e=lo,K(Ds,e),K(Lr,a),lo=e|a.baseLanes}function vi(){K(Ds,lo),K(Lr,Lr.current)}function _i(){lo=Ds.current,Q(Lr),Q(Ds)}var Yn=q(null),da=null;function No(e){var a=e.alternate;K(Yt,Yt.current&1),K(Yn,e),da===null&&(a===null||Lr.current!==null||a.memoizedState!==null)&&(da=e)}function wi(e){K(Yt,Yt.current),K(Yn,e),da===null&&(da=e)}function _p(e){e.tag===22?(K(Yt,Yt.current),K(Yn,e),da===null&&(da=e)):To()}function To(){K(Yt,Yt.current),K(Yn,Yn.current)}function Wn(e){Q(Yn),da===e&&(da=null),Q(Yt)}var Yt=q(0);function As(e){for(var a=e;a!==null;){if(a.tag===13){var l=a.memoizedState;if(l!==null&&(l=l.dehydrated,l===null||jd(l)||kd(l)))return a}else if(a.tag===19&&(a.memoizedProps.revealOrder==="forwards"||a.memoizedProps.revealOrder==="backwards"||a.memoizedProps.revealOrder==="unstable_legacy-backwards"||a.memoizedProps.revealOrder==="together")){if((a.flags&128)!==0)return a}else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===e)break;for(;a.sibling===null;){if(a.return===null||a.return===e)return null;a=a.return}a.sibling.return=a.return,a=a.sibling}return null}var Ka=0,rt=null,jt=null,Xt=null,Fs=!1,Pr=!1,dr=!1,$s=0,Dl=0,Ur=null,__=0;function zt(){throw Error(c(321))}function xi(e,a){if(a===null)return!1;for(var l=0;l<a.length&&l<e.length;l++)if(!Bn(e[l],a[l]))return!1;return!0}function Ci(e,a,l,i,v,S){return Ka=S,rt=a,a.memoizedState=null,a.updateQueue=null,a.lanes=0,N.H=e===null||e.memoizedState===null?nf:Li,dr=!1,S=l(i,v),dr=!1,Pr&&(S=xp(a,l,i,v)),wp(e),S}function wp(e){N.H=$l;var a=jt!==null&&jt.next!==null;if(Ka=0,Xt=jt=rt=null,Fs=!1,Dl=0,Ur=null,a)throw Error(c(300));e===null||Zt||(e=e.dependencies,e!==null&&bs(e)&&(Zt=!0))}function xp(e,a,l,i){rt=e;var v=0;do{if(Pr&&(Ur=null),Dl=0,Pr=!1,25<=v)throw Error(c(301));if(v+=1,Xt=jt=null,e.updateQueue!=null){var S=e.updateQueue;S.lastEffect=null,S.events=null,S.stores=null,S.memoCache!=null&&(S.memoCache.index=0)}N.H=af,S=a(l,i)}while(Pr);return S}function w_(){var e=N.H,a=e.useState()[0];return a=typeof a.then=="function"?Al(a):a,e=e.useState()[0],(jt!==null?jt.memoizedState:null)!==e&&(rt.flags|=1024),a}function Si(){var e=$s!==0;return $s=0,e}function bi(e,a,l){a.updateQueue=e.updateQueue,a.flags&=-2053,e.lanes&=~l}function Ei(e){if(Fs){for(e=e.memoizedState;e!==null;){var a=e.queue;a!==null&&(a.pending=null),e=e.next}Fs=!1}Ka=0,Xt=jt=rt=null,Pr=!1,Dl=$s=0,Ur=null}function Cn(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Xt===null?rt.memoizedState=Xt=e:Xt=Xt.next=e,Xt}function Wt(){if(jt===null){var e=rt.alternate;e=e!==null?e.memoizedState:null}else e=jt.next;var a=Xt===null?rt.memoizedState:Xt.next;if(a!==null)Xt=a,jt=e;else{if(e===null)throw rt.alternate===null?Error(c(467)):Error(c(310));jt=e,e={memoizedState:jt.memoizedState,baseState:jt.baseState,baseQueue:jt.baseQueue,queue:jt.queue,next:null},Xt===null?rt.memoizedState=Xt=e:Xt=Xt.next=e}return Xt}function Is(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Al(e){var a=Dl;return Dl+=1,Ur===null&&(Ur=[]),e=up(Ur,e,a),a=rt,(Xt===null?a.memoizedState:Xt.next)===null&&(a=a.alternate,N.H=a===null||a.memoizedState===null?nf:Li),e}function qs(e){if(e!==null&&typeof e=="object"){if(typeof e.then=="function")return Al(e);if(e.$$typeof===E)return ln(e)}throw Error(c(438,String(e)))}function ji(e){var a=null,l=rt.updateQueue;if(l!==null&&(a=l.memoCache),a==null){var i=rt.alternate;i!==null&&(i=i.updateQueue,i!==null&&(i=i.memoCache,i!=null&&(a={data:i.data.map(function(v){return v.slice()}),index:0})))}if(a==null&&(a={data:[],index:0}),l===null&&(l=Is(),rt.updateQueue=l),l.memoCache=a,l=a.data[a.index],l===void 0)for(l=a.data[a.index]=Array(e),i=0;i<e;i++)l[i]=z;return a.index++,l}function Ja(e,a){return typeof a=="function"?a(e):a}function Ls(e){var a=Wt();return ki(a,jt,e)}function ki(e,a,l){var i=e.queue;if(i===null)throw Error(c(311));i.lastRenderedReducer=l;var v=e.baseQueue,S=i.pending;if(S!==null){if(v!==null){var A=v.next;v.next=S.next,S.next=A}a.baseQueue=v=S,i.pending=null}if(S=e.baseState,v===null)e.memoizedState=S;else{a=v.next;var Y=A=null,re=null,ye=a,Ce=!1;do{var ke=ye.lane&-536870913;if(ke!==ye.lane?(mt&ke)===ke:(Ka&ke)===ke){var ve=ye.revertLane;if(ve===0)re!==null&&(re=re.next={lane:0,revertLane:0,gesture:null,action:ye.action,hasEagerState:ye.hasEagerState,eagerState:ye.eagerState,next:null}),ke===Fr&&(Ce=!0);else if((Ka&ve)===ve){ye=ye.next,ve===Fr&&(Ce=!0);continue}else ke={lane:0,revertLane:ye.revertLane,gesture:null,action:ye.action,hasEagerState:ye.hasEagerState,eagerState:ye.eagerState,next:null},re===null?(Y=re=ke,A=S):re=re.next=ke,rt.lanes|=ve,Ao|=ve;ke=ye.action,dr&&l(S,ke),S=ye.hasEagerState?ye.eagerState:l(S,ke)}else ve={lane:ke,revertLane:ye.revertLane,gesture:ye.gesture,action:ye.action,hasEagerState:ye.hasEagerState,eagerState:ye.eagerState,next:null},re===null?(Y=re=ve,A=S):re=re.next=ve,rt.lanes|=ke,Ao|=ke;ye=ye.next}while(ye!==null&&ye!==a);if(re===null?A=S:re.next=Y,!Bn(S,e.memoizedState)&&(Zt=!0,Ce&&(l=$r,l!==null)))throw l;e.memoizedState=S,e.baseState=A,e.baseQueue=re,i.lastRenderedState=S}return v===null&&(i.lanes=0),[e.memoizedState,i.dispatch]}function Ni(e){var a=Wt(),l=a.queue;if(l===null)throw Error(c(311));l.lastRenderedReducer=e;var i=l.dispatch,v=l.pending,S=a.memoizedState;if(v!==null){l.pending=null;var A=v=v.next;do S=e(S,A.action),A=A.next;while(A!==v);Bn(S,a.memoizedState)||(Zt=!0),a.memoizedState=S,a.baseQueue===null&&(a.baseState=S),l.lastRenderedState=S}return[S,i]}function Cp(e,a,l){var i=rt,v=Wt(),S=gt;if(S){if(l===void 0)throw Error(c(407));l=l()}else l=a();var A=!Bn((jt||v).memoizedState,l);if(A&&(v.memoizedState=l,Zt=!0),v=v.queue,Di(Ep.bind(null,i,v,e),[e]),v.getSnapshot!==a||A||Xt!==null&&Xt.memoizedState.tag&1){if(i.flags|=2048,Or(9,{destroy:void 0},bp.bind(null,i,v,l,a),null),Dt===null)throw Error(c(349));S||(Ka&127)!==0||Sp(i,a,l)}return l}function Sp(e,a,l){e.flags|=16384,e={getSnapshot:a,value:l},a=rt.updateQueue,a===null?(a=Is(),rt.updateQueue=a,a.stores=[e]):(l=a.stores,l===null?a.stores=[e]:l.push(e))}function bp(e,a,l,i){a.value=l,a.getSnapshot=i,jp(a)&&kp(e)}function Ep(e,a,l){return l(function(){jp(a)&&kp(e)})}function jp(e){var a=e.getSnapshot;e=e.value;try{var l=a();return!Bn(e,l)}catch{return!0}}function kp(e){var a=tr(e,2);a!==null&&In(a,e,2)}function Ti(e){var a=Cn();if(typeof e=="function"){var l=e;if(e=l(),dr){nn(!0);try{l()}finally{nn(!1)}}}return a.memoizedState=a.baseState=e,a.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ja,lastRenderedState:e},a}function Np(e,a,l,i){return e.baseState=l,ki(e,jt,typeof i=="function"?i:Ja)}function x_(e,a,l,i,v){if(Os(e))throw Error(c(485));if(e=a.action,e!==null){var S={payload:v,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(A){S.listeners.push(A)}};N.T!==null?l(!0):S.isTransition=!1,i(S),l=a.pending,l===null?(S.next=a.pending=S,Tp(a,S)):(S.next=l.next,a.pending=l.next=S)}}function Tp(e,a){var l=a.action,i=a.payload,v=e.state;if(a.isTransition){var S=N.T,A={};N.T=A;try{var Y=l(v,i),re=N.S;re!==null&&re(A,Y),Rp(e,a,Y)}catch(ye){Ri(e,a,ye)}finally{S!==null&&A.types!==null&&(S.types=A.types),N.T=S}}else try{S=l(v,i),Rp(e,a,S)}catch(ye){Ri(e,a,ye)}}function Rp(e,a,l){l!==null&&typeof l=="object"&&typeof l.then=="function"?l.then(function(i){Dp(e,a,i)},function(i){return Ri(e,a,i)}):Dp(e,a,l)}function Dp(e,a,l){a.status="fulfilled",a.value=l,Ap(a),e.state=l,a=e.pending,a!==null&&(l=a.next,l===a?e.pending=null:(l=l.next,a.next=l,Tp(e,l)))}function Ri(e,a,l){var i=e.pending;if(e.pending=null,i!==null){i=i.next;do a.status="rejected",a.reason=l,Ap(a),a=a.next;while(a!==i)}e.action=null}function Ap(e){e=e.listeners;for(var a=0;a<e.length;a++)(0,e[a])()}function Fp(e,a){return a}function $p(e,a){if(gt){var l=Dt.formState;if(l!==null){e:{var i=rt;if(gt){if(It){t:{for(var v=It,S=ia;v.nodeType!==8;){if(!S){v=null;break t}if(v=ua(v.nextSibling),v===null){v=null;break t}}S=v.data,v=S==="F!"||S==="F"?v:null}if(v){It=ua(v.nextSibling),i=v.data==="F!";break e}}So(i)}i=!1}i&&(a=l[0])}}return l=Cn(),l.memoizedState=l.baseState=a,i={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Fp,lastRenderedState:a},l.queue=i,l=Jp.bind(null,rt,i),i.dispatch=l,i=Ti(!1),S=qi.bind(null,rt,!1,i.queue),i=Cn(),v={state:a,dispatch:null,action:e,pending:null},i.queue=v,l=x_.bind(null,rt,v,S,l),v.dispatch=l,i.memoizedState=e,[a,l,!1]}function Ip(e){var a=Wt();return qp(a,jt,e)}function qp(e,a,l){if(a=ki(e,a,Fp)[0],e=Ls(Ja)[0],typeof a=="object"&&a!==null&&typeof a.then=="function")try{var i=Al(a)}catch(A){throw A===Ir?ks:A}else i=a;a=Wt();var v=a.queue,S=v.dispatch;return l!==a.memoizedState&&(rt.flags|=2048,Or(9,{destroy:void 0},C_.bind(null,v,l),null)),[i,S,e]}function C_(e,a){e.action=a}function Lp(e){var a=Wt(),l=jt;if(l!==null)return qp(a,l,e);Wt(),a=a.memoizedState,l=Wt();var i=l.queue.dispatch;return l.memoizedState=e,[a,i,!1]}function Or(e,a,l,i){return e={tag:e,create:l,deps:i,inst:a,next:null},a=rt.updateQueue,a===null&&(a=Is(),rt.updateQueue=a),l=a.lastEffect,l===null?a.lastEffect=e.next=e:(i=l.next,l.next=e,e.next=i,a.lastEffect=e),e}function Pp(){return Wt().memoizedState}function Ps(e,a,l,i){var v=Cn();rt.flags|=e,v.memoizedState=Or(1|a,{destroy:void 0},l,i===void 0?null:i)}function Us(e,a,l,i){var v=Wt();i=i===void 0?null:i;var S=v.memoizedState.inst;jt!==null&&i!==null&&xi(i,jt.memoizedState.deps)?v.memoizedState=Or(a,S,l,i):(rt.flags|=e,v.memoizedState=Or(1|a,S,l,i))}function Up(e,a){Ps(8390656,8,e,a)}function Di(e,a){Us(2048,8,e,a)}function S_(e){rt.flags|=4;var a=rt.updateQueue;if(a===null)a=Is(),rt.updateQueue=a,a.events=[e];else{var l=a.events;l===null?a.events=[e]:l.push(e)}}function Op(e){var a=Wt().memoizedState;return S_({ref:a,nextImpl:e}),function(){if((Ct&2)!==0)throw Error(c(440));return a.impl.apply(void 0,arguments)}}function Mp(e,a){return Us(4,2,e,a)}function Vp(e,a){return Us(4,4,e,a)}function Hp(e,a){if(typeof a=="function"){e=e();var l=a(e);return function(){typeof l=="function"?l():a(null)}}if(a!=null)return e=e(),a.current=e,function(){a.current=null}}function zp(e,a,l){l=l!=null?l.concat([e]):null,Us(4,4,Hp.bind(null,a,e),l)}function Ai(){}function Bp(e,a){var l=Wt();a=a===void 0?null:a;var i=l.memoizedState;return a!==null&&xi(a,i[1])?i[0]:(l.memoizedState=[e,a],e)}function Gp(e,a){var l=Wt();a=a===void 0?null:a;var i=l.memoizedState;if(a!==null&&xi(a,i[1]))return i[0];if(i=e(),dr){nn(!0);try{e()}finally{nn(!1)}}return l.memoizedState=[i,a],i}function Fi(e,a,l){return l===void 0||(Ka&1073741824)!==0&&(mt&261930)===0?e.memoizedState=a:(e.memoizedState=l,e=Wf(),rt.lanes|=e,Ao|=e,l)}function Yp(e,a,l,i){return Bn(l,a)?l:Lr.current!==null?(e=Fi(e,l,i),Bn(e,a)||(Zt=!0),e):(Ka&42)===0||(Ka&1073741824)!==0&&(mt&261930)===0?(Zt=!0,e.memoizedState=l):(e=Wf(),rt.lanes|=e,Ao|=e,a)}function Wp(e,a,l,i,v){var S=R.p;R.p=S!==0&&8>S?S:8;var A=N.T,Y={};N.T=Y,qi(e,!1,a,l);try{var re=v(),ye=N.S;if(ye!==null&&ye(Y,re),re!==null&&typeof re=="object"&&typeof re.then=="function"){var Ce=v_(re,i);Fl(e,a,Ce,Zn(e))}else Fl(e,a,i,Zn(e))}catch(ke){Fl(e,a,{then:function(){},status:"rejected",reason:ke},Zn())}finally{R.p=S,A!==null&&Y.types!==null&&(A.types=Y.types),N.T=A}}function b_(){}function $i(e,a,l,i){if(e.tag!==5)throw Error(c(476));var v=Qp(e).queue;Wp(e,v,a,$,l===null?b_:function(){return Xp(e),l(i)})}function Qp(e){var a=e.memoizedState;if(a!==null)return a;a={memoizedState:$,baseState:$,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ja,lastRenderedState:$},next:null};var l={};return a.next={memoizedState:l,baseState:l,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ja,lastRenderedState:l},next:null},e.memoizedState=a,e=e.alternate,e!==null&&(e.memoizedState=a),a}function Xp(e){var a=Qp(e);a.next===null&&(a=e.alternate.memoizedState),Fl(e,a.next.queue,{},Zn())}function Ii(){return ln(Xl)}function Zp(){return Wt().memoizedState}function Kp(){return Wt().memoizedState}function E_(e){for(var a=e.return;a!==null;){switch(a.tag){case 24:case 3:var l=Zn();e=jo(l);var i=ko(a,e,l);i!==null&&(In(i,a,l),Nl(i,a,l)),a={cache:di()},e.payload=a;return}a=a.return}}function j_(e,a,l){var i=Zn();l={lane:i,revertLane:0,gesture:null,action:l,hasEagerState:!1,eagerState:null,next:null},Os(e)?ef(a,l):(l=Jc(e,a,l,i),l!==null&&(In(l,e,i),tf(l,a,i)))}function Jp(e,a,l){var i=Zn();Fl(e,a,l,i)}function Fl(e,a,l,i){var v={lane:i,revertLane:0,gesture:null,action:l,hasEagerState:!1,eagerState:null,next:null};if(Os(e))ef(a,v);else{var S=e.alternate;if(e.lanes===0&&(S===null||S.lanes===0)&&(S=a.lastRenderedReducer,S!==null))try{var A=a.lastRenderedState,Y=S(A,l);if(v.hasEagerState=!0,v.eagerState=Y,Bn(Y,A))return ws(e,a,v,0),Dt===null&&_s(),!1}catch{}finally{}if(l=Jc(e,a,v,i),l!==null)return In(l,e,i),tf(l,a,i),!0}return!1}function qi(e,a,l,i){if(i={lane:2,revertLane:hd(),gesture:null,action:i,hasEagerState:!1,eagerState:null,next:null},Os(e)){if(a)throw Error(c(479))}else a=Jc(e,l,i,2),a!==null&&In(a,e,2)}function Os(e){var a=e.alternate;return e===rt||a!==null&&a===rt}function ef(e,a){Pr=Fs=!0;var l=e.pending;l===null?a.next=a:(a.next=l.next,l.next=a),e.pending=a}function tf(e,a,l){if((l&4194048)!==0){var i=a.lanes;i&=e.pendingLanes,l|=i,a.lanes=l,Ra(e,l)}}var $l={readContext:ln,use:qs,useCallback:zt,useContext:zt,useEffect:zt,useImperativeHandle:zt,useLayoutEffect:zt,useInsertionEffect:zt,useMemo:zt,useReducer:zt,useRef:zt,useState:zt,useDebugValue:zt,useDeferredValue:zt,useTransition:zt,useSyncExternalStore:zt,useId:zt,useHostTransitionStatus:zt,useFormState:zt,useActionState:zt,useOptimistic:zt,useMemoCache:zt,useCacheRefresh:zt};$l.useEffectEvent=zt;var nf={readContext:ln,use:qs,useCallback:function(e,a){return Cn().memoizedState=[e,a===void 0?null:a],e},useContext:ln,useEffect:Up,useImperativeHandle:function(e,a,l){l=l!=null?l.concat([e]):null,Ps(4194308,4,Hp.bind(null,a,e),l)},useLayoutEffect:function(e,a){return Ps(4194308,4,e,a)},useInsertionEffect:function(e,a){Ps(4,2,e,a)},useMemo:function(e,a){var l=Cn();a=a===void 0?null:a;var i=e();if(dr){nn(!0);try{e()}finally{nn(!1)}}return l.memoizedState=[i,a],i},useReducer:function(e,a,l){var i=Cn();if(l!==void 0){var v=l(a);if(dr){nn(!0);try{l(a)}finally{nn(!1)}}}else v=a;return i.memoizedState=i.baseState=v,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:v},i.queue=e,e=e.dispatch=j_.bind(null,rt,e),[i.memoizedState,e]},useRef:function(e){var a=Cn();return e={current:e},a.memoizedState=e},useState:function(e){e=Ti(e);var a=e.queue,l=Jp.bind(null,rt,a);return a.dispatch=l,[e.memoizedState,l]},useDebugValue:Ai,useDeferredValue:function(e,a){var l=Cn();return Fi(l,e,a)},useTransition:function(){var e=Ti(!1);return e=Wp.bind(null,rt,e.queue,!0,!1),Cn().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,a,l){var i=rt,v=Cn();if(gt){if(l===void 0)throw Error(c(407));l=l()}else{if(l=a(),Dt===null)throw Error(c(349));(mt&127)!==0||Sp(i,a,l)}v.memoizedState=l;var S={value:l,getSnapshot:a};return v.queue=S,Up(Ep.bind(null,i,S,e),[e]),i.flags|=2048,Or(9,{destroy:void 0},bp.bind(null,i,S,l,a),null),l},useId:function(){var e=Cn(),a=Dt.identifierPrefix;if(gt){var l=La,i=qa;l=(i&~(1<<32-Pt(i)-1)).toString(32)+l,a="_"+a+"R_"+l,l=$s++,0<l&&(a+="H"+l.toString(32)),a+="_"}else l=__++,a="_"+a+"r_"+l.toString(32)+"_";return e.memoizedState=a},useHostTransitionStatus:Ii,useFormState:$p,useActionState:$p,useOptimistic:function(e){var a=Cn();a.memoizedState=a.baseState=e;var l={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return a.queue=l,a=qi.bind(null,rt,!0,l),l.dispatch=a,[e,a]},useMemoCache:ji,useCacheRefresh:function(){return Cn().memoizedState=E_.bind(null,rt)},useEffectEvent:function(e){var a=Cn(),l={impl:e};return a.memoizedState=l,function(){if((Ct&2)!==0)throw Error(c(440));return l.impl.apply(void 0,arguments)}}},Li={readContext:ln,use:qs,useCallback:Bp,useContext:ln,useEffect:Di,useImperativeHandle:zp,useInsertionEffect:Mp,useLayoutEffect:Vp,useMemo:Gp,useReducer:Ls,useRef:Pp,useState:function(){return Ls(Ja)},useDebugValue:Ai,useDeferredValue:function(e,a){var l=Wt();return Yp(l,jt.memoizedState,e,a)},useTransition:function(){var e=Ls(Ja)[0],a=Wt().memoizedState;return[typeof e=="boolean"?e:Al(e),a]},useSyncExternalStore:Cp,useId:Zp,useHostTransitionStatus:Ii,useFormState:Ip,useActionState:Ip,useOptimistic:function(e,a){var l=Wt();return Np(l,jt,e,a)},useMemoCache:ji,useCacheRefresh:Kp};Li.useEffectEvent=Op;var af={readContext:ln,use:qs,useCallback:Bp,useContext:ln,useEffect:Di,useImperativeHandle:zp,useInsertionEffect:Mp,useLayoutEffect:Vp,useMemo:Gp,useReducer:Ni,useRef:Pp,useState:function(){return Ni(Ja)},useDebugValue:Ai,useDeferredValue:function(e,a){var l=Wt();return jt===null?Fi(l,e,a):Yp(l,jt.memoizedState,e,a)},useTransition:function(){var e=Ni(Ja)[0],a=Wt().memoizedState;return[typeof e=="boolean"?e:Al(e),a]},useSyncExternalStore:Cp,useId:Zp,useHostTransitionStatus:Ii,useFormState:Lp,useActionState:Lp,useOptimistic:function(e,a){var l=Wt();return jt!==null?Np(l,jt,e,a):(l.baseState=e,[e,l.queue.dispatch])},useMemoCache:ji,useCacheRefresh:Kp};af.useEffectEvent=Op;function Pi(e,a,l,i){a=e.memoizedState,l=l(i,a),l=l==null?a:y({},a,l),e.memoizedState=l,e.lanes===0&&(e.updateQueue.baseState=l)}var Ui={enqueueSetState:function(e,a,l){e=e._reactInternals;var i=Zn(),v=jo(i);v.payload=a,l!=null&&(v.callback=l),a=ko(e,v,i),a!==null&&(In(a,e,i),Nl(a,e,i))},enqueueReplaceState:function(e,a,l){e=e._reactInternals;var i=Zn(),v=jo(i);v.tag=1,v.payload=a,l!=null&&(v.callback=l),a=ko(e,v,i),a!==null&&(In(a,e,i),Nl(a,e,i))},enqueueForceUpdate:function(e,a){e=e._reactInternals;var l=Zn(),i=jo(l);i.tag=2,a!=null&&(i.callback=a),a=ko(e,i,l),a!==null&&(In(a,e,l),Nl(a,e,l))}};function of(e,a,l,i,v,S,A){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(i,S,A):a.prototype&&a.prototype.isPureReactComponent?!wl(l,i)||!wl(v,S):!0}function rf(e,a,l,i){e=a.state,typeof a.componentWillReceiveProps=="function"&&a.componentWillReceiveProps(l,i),typeof a.UNSAFE_componentWillReceiveProps=="function"&&a.UNSAFE_componentWillReceiveProps(l,i),a.state!==e&&Ui.enqueueReplaceState(a,a.state,null)}function ur(e,a){var l=a;if("ref"in a){l={};for(var i in a)i!=="ref"&&(l[i]=a[i])}if(e=e.defaultProps){l===a&&(l=y({},l));for(var v in e)l[v]===void 0&&(l[v]=e[v])}return l}function lf(e){vs(e)}function sf(e){console.error(e)}function cf(e){vs(e)}function Ms(e,a){try{var l=e.onUncaughtError;l(a.value,{componentStack:a.stack})}catch(i){setTimeout(function(){throw i})}}function df(e,a,l){try{var i=e.onCaughtError;i(l.value,{componentStack:l.stack,errorBoundary:a.tag===1?a.stateNode:null})}catch(v){setTimeout(function(){throw v})}}function Oi(e,a,l){return l=jo(l),l.tag=3,l.payload={element:null},l.callback=function(){Ms(e,a)},l}function uf(e){return e=jo(e),e.tag=3,e}function pf(e,a,l,i){var v=l.type.getDerivedStateFromError;if(typeof v=="function"){var S=i.value;e.payload=function(){return v(S)},e.callback=function(){df(a,l,i)}}var A=l.stateNode;A!==null&&typeof A.componentDidCatch=="function"&&(e.callback=function(){df(a,l,i),typeof v!="function"&&(Fo===null?Fo=new Set([this]):Fo.add(this));var Y=i.stack;this.componentDidCatch(i.value,{componentStack:Y!==null?Y:""})})}function k_(e,a,l,i,v){if(l.flags|=32768,i!==null&&typeof i=="object"&&typeof i.then=="function"){if(a=l.alternate,a!==null&&Ar(a,l,v,!0),l=Yn.current,l!==null){switch(l.tag){case 31:case 13:return da===null?Js():l.alternate===null&&Bt===0&&(Bt=3),l.flags&=-257,l.flags|=65536,l.lanes=v,i===Ns?l.flags|=16384:(a=l.updateQueue,a===null?l.updateQueue=new Set([i]):a.add(i),ud(e,i,v)),!1;case 22:return l.flags|=65536,i===Ns?l.flags|=16384:(a=l.updateQueue,a===null?(a={transitions:null,markerInstances:null,retryQueue:new Set([i])},l.updateQueue=a):(l=a.retryQueue,l===null?a.retryQueue=new Set([i]):l.add(i)),ud(e,i,v)),!1}throw Error(c(435,l.tag))}return ud(e,i,v),Js(),!1}if(gt)return a=Yn.current,a!==null?((a.flags&65536)===0&&(a.flags|=256),a.flags|=65536,a.lanes=v,i!==ri&&(e=Error(c(422),{cause:i}),Sl(la(e,l)))):(i!==ri&&(a=Error(c(423),{cause:i}),Sl(la(a,l))),e=e.current.alternate,e.flags|=65536,v&=-v,e.lanes|=v,i=la(i,l),v=Oi(e.stateNode,i,v),yi(e,v),Bt!==4&&(Bt=2)),!1;var S=Error(c(520),{cause:i});if(S=la(S,l),Vl===null?Vl=[S]:Vl.push(S),Bt!==4&&(Bt=2),a===null)return!0;i=la(i,l),l=a;do{switch(l.tag){case 3:return l.flags|=65536,e=v&-v,l.lanes|=e,e=Oi(l.stateNode,i,e),yi(l,e),!1;case 1:if(a=l.type,S=l.stateNode,(l.flags&128)===0&&(typeof a.getDerivedStateFromError=="function"||S!==null&&typeof S.componentDidCatch=="function"&&(Fo===null||!Fo.has(S))))return l.flags|=65536,v&=-v,l.lanes|=v,v=uf(v),pf(v,e,l,i),yi(l,v),!1}l=l.return}while(l!==null);return!1}var Mi=Error(c(461)),Zt=!1;function sn(e,a,l,i){a.child=e===null?mp(a,null,l,i):ir(a,e.child,l,i)}function ff(e,a,l,i,v){l=l.render;var S=a.ref;if("ref"in i){var A={};for(var Y in i)Y!=="ref"&&(A[Y]=i[Y])}else A=i;return rr(a),i=Ci(e,a,l,A,S,v),Y=Si(),e!==null&&!Zt?(bi(e,a,v),eo(e,a,v)):(gt&&Y&&ai(a),a.flags|=1,sn(e,a,i,v),a.child)}function hf(e,a,l,i,v){if(e===null){var S=l.type;return typeof S=="function"&&!ei(S)&&S.defaultProps===void 0&&l.compare===null?(a.tag=15,a.type=S,mf(e,a,S,i,v)):(e=Cs(l.type,null,i,a,a.mode,v),e.ref=a.ref,e.return=a,a.child=e)}if(S=e.child,!Qi(e,v)){var A=S.memoizedProps;if(l=l.compare,l=l!==null?l:wl,l(A,i)&&e.ref===a.ref)return eo(e,a,v)}return a.flags|=1,e=Wa(S,i),e.ref=a.ref,e.return=a,a.child=e}function mf(e,a,l,i,v){if(e!==null){var S=e.memoizedProps;if(wl(S,i)&&e.ref===a.ref)if(Zt=!1,a.pendingProps=i=S,Qi(e,v))(e.flags&131072)!==0&&(Zt=!0);else return a.lanes=e.lanes,eo(e,a,v)}return Vi(e,a,l,i,v)}function yf(e,a,l,i){var v=i.children,S=e!==null?e.memoizedState:null;if(e===null&&a.stateNode===null&&(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),i.mode==="hidden"){if((a.flags&128)!==0){if(S=S!==null?S.baseLanes|l:l,e!==null){for(i=a.child=e.child,v=0;i!==null;)v=v|i.lanes|i.childLanes,i=i.sibling;i=v&~S}else i=0,a.child=null;return gf(e,a,S,l,i)}if((l&536870912)!==0)a.memoizedState={baseLanes:0,cachePool:null},e!==null&&js(a,S!==null?S.cachePool:null),S!==null?vp(a,S):vi(),_p(a);else return i=a.lanes=536870912,gf(e,a,S!==null?S.baseLanes|l:l,l,i)}else S!==null?(js(a,S.cachePool),vp(a,S),To(),a.memoizedState=null):(e!==null&&js(a,null),vi(),To());return sn(e,a,v,l),a.child}function Il(e,a){return e!==null&&e.tag===22||a.stateNode!==null||(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),a.sibling}function gf(e,a,l,i,v){var S=pi();return S=S===null?null:{parent:Qt._currentValue,pool:S},a.memoizedState={baseLanes:l,cachePool:S},e!==null&&js(a,null),vi(),_p(a),e!==null&&Ar(e,a,i,!0),a.childLanes=v,null}function Vs(e,a){return a=zs({mode:a.mode,children:a.children},e.mode),a.ref=e.ref,e.child=a,a.return=e,a}function vf(e,a,l){return ir(a,e.child,null,l),e=Vs(a,a.pendingProps),e.flags|=2,Wn(a),a.memoizedState=null,e}function N_(e,a,l){var i=a.pendingProps,v=(a.flags&128)!==0;if(a.flags&=-129,e===null){if(gt){if(i.mode==="hidden")return e=Vs(a,i),a.lanes=536870912,Il(null,e);if(wi(a),(e=It)?(e=Rh(e,ia),e=e!==null&&e.data==="&"?e:null,e!==null&&(a.memoizedState={dehydrated:e,treeContext:xo!==null?{id:qa,overflow:La}:null,retryLane:536870912,hydrationErrors:null},l=ep(e),l.return=a,a.child=l,rn=a,It=null)):e=null,e===null)throw So(a);return a.lanes=536870912,null}return Vs(a,i)}var S=e.memoizedState;if(S!==null){var A=S.dehydrated;if(wi(a),v)if(a.flags&256)a.flags&=-257,a=vf(e,a,l);else if(a.memoizedState!==null)a.child=e.child,a.flags|=128,a=null;else throw Error(c(558));else if(Zt||Ar(e,a,l,!1),v=(l&e.childLanes)!==0,Zt||v){if(i=Dt,i!==null&&(A=va(i,l),A!==0&&A!==S.retryLane))throw S.retryLane=A,tr(e,A),In(i,e,A),Mi;Js(),a=vf(e,a,l)}else e=S.treeContext,It=ua(A.nextSibling),rn=a,gt=!0,Co=null,ia=!1,e!==null&&ap(a,e),a=Vs(a,i),a.flags|=4096;return a}return e=Wa(e.child,{mode:i.mode,children:i.children}),e.ref=a.ref,a.child=e,e.return=a,e}function Hs(e,a){var l=a.ref;if(l===null)e!==null&&e.ref!==null&&(a.flags|=4194816);else{if(typeof l!="function"&&typeof l!="object")throw Error(c(284));(e===null||e.ref!==l)&&(a.flags|=4194816)}}function Vi(e,a,l,i,v){return rr(a),l=Ci(e,a,l,i,void 0,v),i=Si(),e!==null&&!Zt?(bi(e,a,v),eo(e,a,v)):(gt&&i&&ai(a),a.flags|=1,sn(e,a,l,v),a.child)}function _f(e,a,l,i,v,S){return rr(a),a.updateQueue=null,l=xp(a,i,l,v),wp(e),i=Si(),e!==null&&!Zt?(bi(e,a,S),eo(e,a,S)):(gt&&i&&ai(a),a.flags|=1,sn(e,a,l,S),a.child)}function wf(e,a,l,i,v){if(rr(a),a.stateNode===null){var S=Nr,A=l.contextType;typeof A=="object"&&A!==null&&(S=ln(A)),S=new l(i,S),a.memoizedState=S.state!==null&&S.state!==void 0?S.state:null,S.updater=Ui,a.stateNode=S,S._reactInternals=a,S=a.stateNode,S.props=i,S.state=a.memoizedState,S.refs={},hi(a),A=l.contextType,S.context=typeof A=="object"&&A!==null?ln(A):Nr,S.state=a.memoizedState,A=l.getDerivedStateFromProps,typeof A=="function"&&(Pi(a,l,A,i),S.state=a.memoizedState),typeof l.getDerivedStateFromProps=="function"||typeof S.getSnapshotBeforeUpdate=="function"||typeof S.UNSAFE_componentWillMount!="function"&&typeof S.componentWillMount!="function"||(A=S.state,typeof S.componentWillMount=="function"&&S.componentWillMount(),typeof S.UNSAFE_componentWillMount=="function"&&S.UNSAFE_componentWillMount(),A!==S.state&&Ui.enqueueReplaceState(S,S.state,null),Rl(a,i,S,v),Tl(),S.state=a.memoizedState),typeof S.componentDidMount=="function"&&(a.flags|=4194308),i=!0}else if(e===null){S=a.stateNode;var Y=a.memoizedProps,re=ur(l,Y);S.props=re;var ye=S.context,Ce=l.contextType;A=Nr,typeof Ce=="object"&&Ce!==null&&(A=ln(Ce));var ke=l.getDerivedStateFromProps;Ce=typeof ke=="function"||typeof S.getSnapshotBeforeUpdate=="function",Y=a.pendingProps!==Y,Ce||typeof S.UNSAFE_componentWillReceiveProps!="function"&&typeof S.componentWillReceiveProps!="function"||(Y||ye!==A)&&rf(a,S,i,A),Eo=!1;var ve=a.memoizedState;S.state=ve,Rl(a,i,S,v),Tl(),ye=a.memoizedState,Y||ve!==ye||Eo?(typeof ke=="function"&&(Pi(a,l,ke,i),ye=a.memoizedState),(re=Eo||of(a,l,re,i,ve,ye,A))?(Ce||typeof S.UNSAFE_componentWillMount!="function"&&typeof S.componentWillMount!="function"||(typeof S.componentWillMount=="function"&&S.componentWillMount(),typeof S.UNSAFE_componentWillMount=="function"&&S.UNSAFE_componentWillMount()),typeof S.componentDidMount=="function"&&(a.flags|=4194308)):(typeof S.componentDidMount=="function"&&(a.flags|=4194308),a.memoizedProps=i,a.memoizedState=ye),S.props=i,S.state=ye,S.context=A,i=re):(typeof S.componentDidMount=="function"&&(a.flags|=4194308),i=!1)}else{S=a.stateNode,mi(e,a),A=a.memoizedProps,Ce=ur(l,A),S.props=Ce,ke=a.pendingProps,ve=S.context,ye=l.contextType,re=Nr,typeof ye=="object"&&ye!==null&&(re=ln(ye)),Y=l.getDerivedStateFromProps,(ye=typeof Y=="function"||typeof S.getSnapshotBeforeUpdate=="function")||typeof S.UNSAFE_componentWillReceiveProps!="function"&&typeof S.componentWillReceiveProps!="function"||(A!==ke||ve!==re)&&rf(a,S,i,re),Eo=!1,ve=a.memoizedState,S.state=ve,Rl(a,i,S,v),Tl();var we=a.memoizedState;A!==ke||ve!==we||Eo||e!==null&&e.dependencies!==null&&bs(e.dependencies)?(typeof Y=="function"&&(Pi(a,l,Y,i),we=a.memoizedState),(Ce=Eo||of(a,l,Ce,i,ve,we,re)||e!==null&&e.dependencies!==null&&bs(e.dependencies))?(ye||typeof S.UNSAFE_componentWillUpdate!="function"&&typeof S.componentWillUpdate!="function"||(typeof S.componentWillUpdate=="function"&&S.componentWillUpdate(i,we,re),typeof S.UNSAFE_componentWillUpdate=="function"&&S.UNSAFE_componentWillUpdate(i,we,re)),typeof S.componentDidUpdate=="function"&&(a.flags|=4),typeof S.getSnapshotBeforeUpdate=="function"&&(a.flags|=1024)):(typeof S.componentDidUpdate!="function"||A===e.memoizedProps&&ve===e.memoizedState||(a.flags|=4),typeof S.getSnapshotBeforeUpdate!="function"||A===e.memoizedProps&&ve===e.memoizedState||(a.flags|=1024),a.memoizedProps=i,a.memoizedState=we),S.props=i,S.state=we,S.context=re,i=Ce):(typeof S.componentDidUpdate!="function"||A===e.memoizedProps&&ve===e.memoizedState||(a.flags|=4),typeof S.getSnapshotBeforeUpdate!="function"||A===e.memoizedProps&&ve===e.memoizedState||(a.flags|=1024),i=!1)}return S=i,Hs(e,a),i=(a.flags&128)!==0,S||i?(S=a.stateNode,l=i&&typeof l.getDerivedStateFromError!="function"?null:S.render(),a.flags|=1,e!==null&&i?(a.child=ir(a,e.child,null,v),a.child=ir(a,null,l,v)):sn(e,a,l,v),a.memoizedState=S.state,e=a.child):e=eo(e,a,v),e}function xf(e,a,l,i){return ar(),a.flags|=256,sn(e,a,l,i),a.child}var Hi={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function zi(e){return{baseLanes:e,cachePool:ip()}}function Bi(e,a,l){return e=e!==null?e.childLanes&~l:0,a&&(e|=Xn),e}function Cf(e,a,l){var i=a.pendingProps,v=!1,S=(a.flags&128)!==0,A;if((A=S)||(A=e!==null&&e.memoizedState===null?!1:(Yt.current&2)!==0),A&&(v=!0,a.flags&=-129),A=(a.flags&32)!==0,a.flags&=-33,e===null){if(gt){if(v?No(a):To(),(e=It)?(e=Rh(e,ia),e=e!==null&&e.data!=="&"?e:null,e!==null&&(a.memoizedState={dehydrated:e,treeContext:xo!==null?{id:qa,overflow:La}:null,retryLane:536870912,hydrationErrors:null},l=ep(e),l.return=a,a.child=l,rn=a,It=null)):e=null,e===null)throw So(a);return kd(e)?a.lanes=32:a.lanes=536870912,null}var Y=i.children;return i=i.fallback,v?(To(),v=a.mode,Y=zs({mode:"hidden",children:Y},v),i=nr(i,v,l,null),Y.return=a,i.return=a,Y.sibling=i,a.child=Y,i=a.child,i.memoizedState=zi(l),i.childLanes=Bi(e,A,l),a.memoizedState=Hi,Il(null,i)):(No(a),Gi(a,Y))}var re=e.memoizedState;if(re!==null&&(Y=re.dehydrated,Y!==null)){if(S)a.flags&256?(No(a),a.flags&=-257,a=Yi(e,a,l)):a.memoizedState!==null?(To(),a.child=e.child,a.flags|=128,a=null):(To(),Y=i.fallback,v=a.mode,i=zs({mode:"visible",children:i.children},v),Y=nr(Y,v,l,null),Y.flags|=2,i.return=a,Y.return=a,i.sibling=Y,a.child=i,ir(a,e.child,null,l),i=a.child,i.memoizedState=zi(l),i.childLanes=Bi(e,A,l),a.memoizedState=Hi,a=Il(null,i));else if(No(a),kd(Y)){if(A=Y.nextSibling&&Y.nextSibling.dataset,A)var ye=A.dgst;A=ye,i=Error(c(419)),i.stack="",i.digest=A,Sl({value:i,source:null,stack:null}),a=Yi(e,a,l)}else if(Zt||Ar(e,a,l,!1),A=(l&e.childLanes)!==0,Zt||A){if(A=Dt,A!==null&&(i=va(A,l),i!==0&&i!==re.retryLane))throw re.retryLane=i,tr(e,i),In(A,e,i),Mi;jd(Y)||Js(),a=Yi(e,a,l)}else jd(Y)?(a.flags|=192,a.child=e.child,a=null):(e=re.treeContext,It=ua(Y.nextSibling),rn=a,gt=!0,Co=null,ia=!1,e!==null&&ap(a,e),a=Gi(a,i.children),a.flags|=4096);return a}return v?(To(),Y=i.fallback,v=a.mode,re=e.child,ye=re.sibling,i=Wa(re,{mode:"hidden",children:i.children}),i.subtreeFlags=re.subtreeFlags&65011712,ye!==null?Y=Wa(ye,Y):(Y=nr(Y,v,l,null),Y.flags|=2),Y.return=a,i.return=a,i.sibling=Y,a.child=i,Il(null,i),i=a.child,Y=e.child.memoizedState,Y===null?Y=zi(l):(v=Y.cachePool,v!==null?(re=Qt._currentValue,v=v.parent!==re?{parent:re,pool:re}:v):v=ip(),Y={baseLanes:Y.baseLanes|l,cachePool:v}),i.memoizedState=Y,i.childLanes=Bi(e,A,l),a.memoizedState=Hi,Il(e.child,i)):(No(a),l=e.child,e=l.sibling,l=Wa(l,{mode:"visible",children:i.children}),l.return=a,l.sibling=null,e!==null&&(A=a.deletions,A===null?(a.deletions=[e],a.flags|=16):A.push(e)),a.child=l,a.memoizedState=null,l)}function Gi(e,a){return a=zs({mode:"visible",children:a},e.mode),a.return=e,e.child=a}function zs(e,a){return e=Gn(22,e,null,a),e.lanes=0,e}function Yi(e,a,l){return ir(a,e.child,null,l),e=Gi(a,a.pendingProps.children),e.flags|=2,a.memoizedState=null,e}function Sf(e,a,l){e.lanes|=a;var i=e.alternate;i!==null&&(i.lanes|=a),ci(e.return,a,l)}function Wi(e,a,l,i,v,S){var A=e.memoizedState;A===null?e.memoizedState={isBackwards:a,rendering:null,renderingStartTime:0,last:i,tail:l,tailMode:v,treeForkCount:S}:(A.isBackwards=a,A.rendering=null,A.renderingStartTime=0,A.last=i,A.tail=l,A.tailMode=v,A.treeForkCount=S)}function bf(e,a,l){var i=a.pendingProps,v=i.revealOrder,S=i.tail;i=i.children;var A=Yt.current,Y=(A&2)!==0;if(Y?(A=A&1|2,a.flags|=128):A&=1,K(Yt,A),sn(e,a,i,l),i=gt?Cl:0,!Y&&e!==null&&(e.flags&128)!==0)e:for(e=a.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&Sf(e,l,a);else if(e.tag===19)Sf(e,l,a);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===a)break e;for(;e.sibling===null;){if(e.return===null||e.return===a)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}switch(v){case"forwards":for(l=a.child,v=null;l!==null;)e=l.alternate,e!==null&&As(e)===null&&(v=l),l=l.sibling;l=v,l===null?(v=a.child,a.child=null):(v=l.sibling,l.sibling=null),Wi(a,!1,v,l,S,i);break;case"backwards":case"unstable_legacy-backwards":for(l=null,v=a.child,a.child=null;v!==null;){if(e=v.alternate,e!==null&&As(e)===null){a.child=v;break}e=v.sibling,v.sibling=l,l=v,v=e}Wi(a,!0,l,null,S,i);break;case"together":Wi(a,!1,null,null,void 0,i);break;default:a.memoizedState=null}return a.child}function eo(e,a,l){if(e!==null&&(a.dependencies=e.dependencies),Ao|=a.lanes,(l&a.childLanes)===0)if(e!==null){if(Ar(e,a,l,!1),(l&a.childLanes)===0)return null}else return null;if(e!==null&&a.child!==e.child)throw Error(c(153));if(a.child!==null){for(e=a.child,l=Wa(e,e.pendingProps),a.child=l,l.return=a;e.sibling!==null;)e=e.sibling,l=l.sibling=Wa(e,e.pendingProps),l.return=a;l.sibling=null}return a.child}function Qi(e,a){return(e.lanes&a)!==0?!0:(e=e.dependencies,!!(e!==null&&bs(e)))}function T_(e,a,l){switch(a.tag){case 3:_e(a,a.stateNode.containerInfo),bo(a,Qt,e.memoizedState.cache),ar();break;case 27:case 5:be(a);break;case 4:_e(a,a.stateNode.containerInfo);break;case 10:bo(a,a.type,a.memoizedProps.value);break;case 31:if(a.memoizedState!==null)return a.flags|=128,wi(a),null;break;case 13:var i=a.memoizedState;if(i!==null)return i.dehydrated!==null?(No(a),a.flags|=128,null):(l&a.child.childLanes)!==0?Cf(e,a,l):(No(a),e=eo(e,a,l),e!==null?e.sibling:null);No(a);break;case 19:var v=(e.flags&128)!==0;if(i=(l&a.childLanes)!==0,i||(Ar(e,a,l,!1),i=(l&a.childLanes)!==0),v){if(i)return bf(e,a,l);a.flags|=128}if(v=a.memoizedState,v!==null&&(v.rendering=null,v.tail=null,v.lastEffect=null),K(Yt,Yt.current),i)break;return null;case 22:return a.lanes=0,yf(e,a,l,a.pendingProps);case 24:bo(a,Qt,e.memoizedState.cache)}return eo(e,a,l)}function Ef(e,a,l){if(e!==null)if(e.memoizedProps!==a.pendingProps)Zt=!0;else{if(!Qi(e,l)&&(a.flags&128)===0)return Zt=!1,T_(e,a,l);Zt=(e.flags&131072)!==0}else Zt=!1,gt&&(a.flags&1048576)!==0&&np(a,Cl,a.index);switch(a.lanes=0,a.tag){case 16:e:{var i=a.pendingProps;if(e=sr(a.elementType),a.type=e,typeof e=="function")ei(e)?(i=ur(e,i),a.tag=1,a=wf(null,a,e,i,l)):(a.tag=0,a=Vi(null,a,e,i,l));else{if(e!=null){var v=e.$$typeof;if(v===T){a.tag=11,a=ff(null,a,e,i,l);break e}else if(v===D){a.tag=14,a=hf(null,a,e,i,l);break e}}throw a=P(e)||e,Error(c(306,a,""))}}return a;case 0:return Vi(e,a,a.type,a.pendingProps,l);case 1:return i=a.type,v=ur(i,a.pendingProps),wf(e,a,i,v,l);case 3:e:{if(_e(a,a.stateNode.containerInfo),e===null)throw Error(c(387));i=a.pendingProps;var S=a.memoizedState;v=S.element,mi(e,a),Rl(a,i,null,l);var A=a.memoizedState;if(i=A.cache,bo(a,Qt,i),i!==S.cache&&ii(a,[Qt],l,!0),Tl(),i=A.element,S.isDehydrated)if(S={element:i,isDehydrated:!1,cache:A.cache},a.updateQueue.baseState=S,a.memoizedState=S,a.flags&256){a=xf(e,a,i,l);break e}else if(i!==v){v=la(Error(c(424)),a),Sl(v),a=xf(e,a,i,l);break e}else{switch(e=a.stateNode.containerInfo,e.nodeType){case 9:e=e.body;break;default:e=e.nodeName==="HTML"?e.ownerDocument.body:e}for(It=ua(e.firstChild),rn=a,gt=!0,Co=null,ia=!0,l=mp(a,null,i,l),a.child=l;l;)l.flags=l.flags&-3|4096,l=l.sibling}else{if(ar(),i===v){a=eo(e,a,l);break e}sn(e,a,i,l)}a=a.child}return a;case 26:return Hs(e,a),e===null?(l=qh(a.type,null,a.pendingProps,null))?a.memoizedState=l:gt||(l=a.type,e=a.pendingProps,i=lc(ee.current).createElement(l),i[$t]=a,i[Mt]=e,cn(i,l,e),Tt(i),a.stateNode=i):a.memoizedState=qh(a.type,e.memoizedProps,a.pendingProps,e.memoizedState),null;case 27:return be(a),e===null&&gt&&(i=a.stateNode=Fh(a.type,a.pendingProps,ee.current),rn=a,ia=!0,v=It,Lo(a.type)?(Nd=v,It=ua(i.firstChild)):It=v),sn(e,a,a.pendingProps.children,l),Hs(e,a),e===null&&(a.flags|=4194304),a.child;case 5:return e===null&&gt&&((v=i=It)&&(i=r0(i,a.type,a.pendingProps,ia),i!==null?(a.stateNode=i,rn=a,It=ua(i.firstChild),ia=!1,v=!0):v=!1),v||So(a)),be(a),v=a.type,S=a.pendingProps,A=e!==null?e.memoizedProps:null,i=S.children,Sd(v,S)?i=null:A!==null&&Sd(v,A)&&(a.flags|=32),a.memoizedState!==null&&(v=Ci(e,a,w_,null,null,l),Xl._currentValue=v),Hs(e,a),sn(e,a,i,l),a.child;case 6:return e===null&&gt&&((e=l=It)&&(l=l0(l,a.pendingProps,ia),l!==null?(a.stateNode=l,rn=a,It=null,e=!0):e=!1),e||So(a)),null;case 13:return Cf(e,a,l);case 4:return _e(a,a.stateNode.containerInfo),i=a.pendingProps,e===null?a.child=ir(a,null,i,l):sn(e,a,i,l),a.child;case 11:return ff(e,a,a.type,a.pendingProps,l);case 7:return sn(e,a,a.pendingProps,l),a.child;case 8:return sn(e,a,a.pendingProps.children,l),a.child;case 12:return sn(e,a,a.pendingProps.children,l),a.child;case 10:return i=a.pendingProps,bo(a,a.type,i.value),sn(e,a,i.children,l),a.child;case 9:return v=a.type._context,i=a.pendingProps.children,rr(a),v=ln(v),i=i(v),a.flags|=1,sn(e,a,i,l),a.child;case 14:return hf(e,a,a.type,a.pendingProps,l);case 15:return mf(e,a,a.type,a.pendingProps,l);case 19:return bf(e,a,l);case 31:return N_(e,a,l);case 22:return yf(e,a,l,a.pendingProps);case 24:return rr(a),i=ln(Qt),e===null?(v=pi(),v===null&&(v=Dt,S=di(),v.pooledCache=S,S.refCount++,S!==null&&(v.pooledCacheLanes|=l),v=S),a.memoizedState={parent:i,cache:v},hi(a),bo(a,Qt,v)):((e.lanes&l)!==0&&(mi(e,a),Rl(a,null,null,l),Tl()),v=e.memoizedState,S=a.memoizedState,v.parent!==i?(v={parent:i,cache:i},a.memoizedState=v,a.lanes===0&&(a.memoizedState=a.updateQueue.baseState=v),bo(a,Qt,i)):(i=S.cache,bo(a,Qt,i),i!==v.cache&&ii(a,[Qt],l,!0))),sn(e,a,a.pendingProps.children,l),a.child;case 29:throw a.pendingProps}throw Error(c(156,a.tag))}function to(e){e.flags|=4}function Xi(e,a,l,i,v){if((a=(e.mode&32)!==0)&&(a=!1),a){if(e.flags|=16777216,(v&335544128)===v)if(e.stateNode.complete)e.flags|=8192;else if(Kf())e.flags|=8192;else throw cr=Ns,fi}else e.flags&=-16777217}function jf(e,a){if(a.type!=="stylesheet"||(a.state.loading&4)!==0)e.flags&=-16777217;else if(e.flags|=16777216,!Mh(a))if(Kf())e.flags|=8192;else throw cr=Ns,fi}function Bs(e,a){a!==null&&(e.flags|=4),e.flags&16384&&(a=e.tag!==22?ya():536870912,e.lanes|=a,zr|=a)}function ql(e,a){if(!gt)switch(e.tailMode){case"hidden":a=e.tail;for(var l=null;a!==null;)a.alternate!==null&&(l=a),a=a.sibling;l===null?e.tail=null:l.sibling=null;break;case"collapsed":l=e.tail;for(var i=null;l!==null;)l.alternate!==null&&(i=l),l=l.sibling;i===null?a||e.tail===null?e.tail=null:e.tail.sibling=null:i.sibling=null}}function qt(e){var a=e.alternate!==null&&e.alternate.child===e.child,l=0,i=0;if(a)for(var v=e.child;v!==null;)l|=v.lanes|v.childLanes,i|=v.subtreeFlags&65011712,i|=v.flags&65011712,v.return=e,v=v.sibling;else for(v=e.child;v!==null;)l|=v.lanes|v.childLanes,i|=v.subtreeFlags,i|=v.flags,v.return=e,v=v.sibling;return e.subtreeFlags|=i,e.childLanes=l,a}function R_(e,a,l){var i=a.pendingProps;switch(oi(a),a.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return qt(a),null;case 1:return qt(a),null;case 3:return l=a.stateNode,i=null,e!==null&&(i=e.memoizedState.cache),a.memoizedState.cache!==i&&(a.flags|=2048),Za(Qt),fe(),l.pendingContext&&(l.context=l.pendingContext,l.pendingContext=null),(e===null||e.child===null)&&(Dr(a)?to(a):e===null||e.memoizedState.isDehydrated&&(a.flags&256)===0||(a.flags|=1024,li())),qt(a),null;case 26:var v=a.type,S=a.memoizedState;return e===null?(to(a),S!==null?(qt(a),jf(a,S)):(qt(a),Xi(a,v,null,i,l))):S?S!==e.memoizedState?(to(a),qt(a),jf(a,S)):(qt(a),a.flags&=-16777217):(e=e.memoizedProps,e!==i&&to(a),qt(a),Xi(a,v,e,i,l)),null;case 27:if(oe(a),l=ee.current,v=a.type,e!==null&&a.stateNode!=null)e.memoizedProps!==i&&to(a);else{if(!i){if(a.stateNode===null)throw Error(c(166));return qt(a),null}e=Z.current,Dr(a)?op(a):(e=Fh(v,i,l),a.stateNode=e,to(a))}return qt(a),null;case 5:if(oe(a),v=a.type,e!==null&&a.stateNode!=null)e.memoizedProps!==i&&to(a);else{if(!i){if(a.stateNode===null)throw Error(c(166));return qt(a),null}if(S=Z.current,Dr(a))op(a);else{var A=lc(ee.current);switch(S){case 1:S=A.createElementNS("http://www.w3.org/2000/svg",v);break;case 2:S=A.createElementNS("http://www.w3.org/1998/Math/MathML",v);break;default:switch(v){case"svg":S=A.createElementNS("http://www.w3.org/2000/svg",v);break;case"math":S=A.createElementNS("http://www.w3.org/1998/Math/MathML",v);break;case"script":S=A.createElement("div"),S.innerHTML="<script><\/script>",S=S.removeChild(S.firstChild);break;case"select":S=typeof i.is=="string"?A.createElement("select",{is:i.is}):A.createElement("select"),i.multiple?S.multiple=!0:i.size&&(S.size=i.size);break;default:S=typeof i.is=="string"?A.createElement(v,{is:i.is}):A.createElement(v)}}S[$t]=a,S[Mt]=i;e:for(A=a.child;A!==null;){if(A.tag===5||A.tag===6)S.appendChild(A.stateNode);else if(A.tag!==4&&A.tag!==27&&A.child!==null){A.child.return=A,A=A.child;continue}if(A===a)break e;for(;A.sibling===null;){if(A.return===null||A.return===a)break e;A=A.return}A.sibling.return=A.return,A=A.sibling}a.stateNode=S;e:switch(cn(S,v,i),v){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}i&&to(a)}}return qt(a),Xi(a,a.type,e===null?null:e.memoizedProps,a.pendingProps,l),null;case 6:if(e&&a.stateNode!=null)e.memoizedProps!==i&&to(a);else{if(typeof i!="string"&&a.stateNode===null)throw Error(c(166));if(e=ee.current,Dr(a)){if(e=a.stateNode,l=a.memoizedProps,i=null,v=rn,v!==null)switch(v.tag){case 27:case 5:i=v.memoizedProps}e[$t]=a,e=!!(e.nodeValue===l||i!==null&&i.suppressHydrationWarning===!0||Ch(e.nodeValue,l)),e||So(a,!0)}else e=lc(e).createTextNode(i),e[$t]=a,a.stateNode=e}return qt(a),null;case 31:if(l=a.memoizedState,e===null||e.memoizedState!==null){if(i=Dr(a),l!==null){if(e===null){if(!i)throw Error(c(318));if(e=a.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(c(557));e[$t]=a}else ar(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;qt(a),e=!1}else l=li(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=l),e=!0;if(!e)return a.flags&256?(Wn(a),a):(Wn(a),null);if((a.flags&128)!==0)throw Error(c(558))}return qt(a),null;case 13:if(i=a.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(v=Dr(a),i!==null&&i.dehydrated!==null){if(e===null){if(!v)throw Error(c(318));if(v=a.memoizedState,v=v!==null?v.dehydrated:null,!v)throw Error(c(317));v[$t]=a}else ar(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;qt(a),v=!1}else v=li(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=v),v=!0;if(!v)return a.flags&256?(Wn(a),a):(Wn(a),null)}return Wn(a),(a.flags&128)!==0?(a.lanes=l,a):(l=i!==null,e=e!==null&&e.memoizedState!==null,l&&(i=a.child,v=null,i.alternate!==null&&i.alternate.memoizedState!==null&&i.alternate.memoizedState.cachePool!==null&&(v=i.alternate.memoizedState.cachePool.pool),S=null,i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(S=i.memoizedState.cachePool.pool),S!==v&&(i.flags|=2048)),l!==e&&l&&(a.child.flags|=8192),Bs(a,a.updateQueue),qt(a),null);case 4:return fe(),e===null&&vd(a.stateNode.containerInfo),qt(a),null;case 10:return Za(a.type),qt(a),null;case 19:if(Q(Yt),i=a.memoizedState,i===null)return qt(a),null;if(v=(a.flags&128)!==0,S=i.rendering,S===null)if(v)ql(i,!1);else{if(Bt!==0||e!==null&&(e.flags&128)!==0)for(e=a.child;e!==null;){if(S=As(e),S!==null){for(a.flags|=128,ql(i,!1),e=S.updateQueue,a.updateQueue=e,Bs(a,e),a.subtreeFlags=0,e=l,l=a.child;l!==null;)Ju(l,e),l=l.sibling;return K(Yt,Yt.current&1|2),gt&&Qa(a,i.treeForkCount),a.child}e=e.sibling}i.tail!==null&&qe()>Xs&&(a.flags|=128,v=!0,ql(i,!1),a.lanes=4194304)}else{if(!v)if(e=As(S),e!==null){if(a.flags|=128,v=!0,e=e.updateQueue,a.updateQueue=e,Bs(a,e),ql(i,!0),i.tail===null&&i.tailMode==="hidden"&&!S.alternate&&!gt)return qt(a),null}else 2*qe()-i.renderingStartTime>Xs&&l!==536870912&&(a.flags|=128,v=!0,ql(i,!1),a.lanes=4194304);i.isBackwards?(S.sibling=a.child,a.child=S):(e=i.last,e!==null?e.sibling=S:a.child=S,i.last=S)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=qe(),e.sibling=null,l=Yt.current,K(Yt,v?l&1|2:l&1),gt&&Qa(a,i.treeForkCount),e):(qt(a),null);case 22:case 23:return Wn(a),_i(),i=a.memoizedState!==null,e!==null?e.memoizedState!==null!==i&&(a.flags|=8192):i&&(a.flags|=8192),i?(l&536870912)!==0&&(a.flags&128)===0&&(qt(a),a.subtreeFlags&6&&(a.flags|=8192)):qt(a),l=a.updateQueue,l!==null&&Bs(a,l.retryQueue),l=null,e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(l=e.memoizedState.cachePool.pool),i=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(i=a.memoizedState.cachePool.pool),i!==l&&(a.flags|=2048),e!==null&&Q(lr),null;case 24:return l=null,e!==null&&(l=e.memoizedState.cache),a.memoizedState.cache!==l&&(a.flags|=2048),Za(Qt),qt(a),null;case 25:return null;case 30:return null}throw Error(c(156,a.tag))}function D_(e,a){switch(oi(a),a.tag){case 1:return e=a.flags,e&65536?(a.flags=e&-65537|128,a):null;case 3:return Za(Qt),fe(),e=a.flags,(e&65536)!==0&&(e&128)===0?(a.flags=e&-65537|128,a):null;case 26:case 27:case 5:return oe(a),null;case 31:if(a.memoizedState!==null){if(Wn(a),a.alternate===null)throw Error(c(340));ar()}return e=a.flags,e&65536?(a.flags=e&-65537|128,a):null;case 13:if(Wn(a),e=a.memoizedState,e!==null&&e.dehydrated!==null){if(a.alternate===null)throw Error(c(340));ar()}return e=a.flags,e&65536?(a.flags=e&-65537|128,a):null;case 19:return Q(Yt),null;case 4:return fe(),null;case 10:return Za(a.type),null;case 22:case 23:return Wn(a),_i(),e!==null&&Q(lr),e=a.flags,e&65536?(a.flags=e&-65537|128,a):null;case 24:return Za(Qt),null;case 25:return null;default:return null}}function kf(e,a){switch(oi(a),a.tag){case 3:Za(Qt),fe();break;case 26:case 27:case 5:oe(a);break;case 4:fe();break;case 31:a.memoizedState!==null&&Wn(a);break;case 13:Wn(a);break;case 19:Q(Yt);break;case 10:Za(a.type);break;case 22:case 23:Wn(a),_i(),e!==null&&Q(lr);break;case 24:Za(Qt)}}function Ll(e,a){try{var l=a.updateQueue,i=l!==null?l.lastEffect:null;if(i!==null){var v=i.next;l=v;do{if((l.tag&e)===e){i=void 0;var S=l.create,A=l.inst;i=S(),A.destroy=i}l=l.next}while(l!==v)}}catch(Y){Et(a,a.return,Y)}}function Ro(e,a,l){try{var i=a.updateQueue,v=i!==null?i.lastEffect:null;if(v!==null){var S=v.next;i=S;do{if((i.tag&e)===e){var A=i.inst,Y=A.destroy;if(Y!==void 0){A.destroy=void 0,v=a;var re=l,ye=Y;try{ye()}catch(Ce){Et(v,re,Ce)}}}i=i.next}while(i!==S)}}catch(Ce){Et(a,a.return,Ce)}}function Nf(e){var a=e.updateQueue;if(a!==null){var l=e.stateNode;try{gp(a,l)}catch(i){Et(e,e.return,i)}}}function Tf(e,a,l){l.props=ur(e.type,e.memoizedProps),l.state=e.memoizedState;try{l.componentWillUnmount()}catch(i){Et(e,a,i)}}function Pl(e,a){try{var l=e.ref;if(l!==null){switch(e.tag){case 26:case 27:case 5:var i=e.stateNode;break;case 30:i=e.stateNode;break;default:i=e.stateNode}typeof l=="function"?e.refCleanup=l(i):l.current=i}}catch(v){Et(e,a,v)}}function Pa(e,a){var l=e.ref,i=e.refCleanup;if(l!==null)if(typeof i=="function")try{i()}catch(v){Et(e,a,v)}finally{e.refCleanup=null,e=e.alternate,e!=null&&(e.refCleanup=null)}else if(typeof l=="function")try{l(null)}catch(v){Et(e,a,v)}else l.current=null}function Rf(e){var a=e.type,l=e.memoizedProps,i=e.stateNode;try{e:switch(a){case"button":case"input":case"select":case"textarea":l.autoFocus&&i.focus();break e;case"img":l.src?i.src=l.src:l.srcSet&&(i.srcset=l.srcSet)}}catch(v){Et(e,e.return,v)}}function Zi(e,a,l){try{var i=e.stateNode;J_(i,e.type,l,a),i[Mt]=a}catch(v){Et(e,e.return,v)}}function Df(e){return e.tag===5||e.tag===3||e.tag===26||e.tag===27&&Lo(e.type)||e.tag===4}function Ki(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||Df(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.tag===27&&Lo(e.type)||e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Ji(e,a,l){var i=e.tag;if(i===5||i===6)e=e.stateNode,a?(l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l).insertBefore(e,a):(a=l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l,a.appendChild(e),l=l._reactRootContainer,l!=null||a.onclick!==null||(a.onclick=Nn));else if(i!==4&&(i===27&&Lo(e.type)&&(l=e.stateNode,a=null),e=e.child,e!==null))for(Ji(e,a,l),e=e.sibling;e!==null;)Ji(e,a,l),e=e.sibling}function Gs(e,a,l){var i=e.tag;if(i===5||i===6)e=e.stateNode,a?l.insertBefore(e,a):l.appendChild(e);else if(i!==4&&(i===27&&Lo(e.type)&&(l=e.stateNode),e=e.child,e!==null))for(Gs(e,a,l),e=e.sibling;e!==null;)Gs(e,a,l),e=e.sibling}function Af(e){var a=e.stateNode,l=e.memoizedProps;try{for(var i=e.type,v=a.attributes;v.length;)a.removeAttributeNode(v[0]);cn(a,i,l),a[$t]=e,a[Mt]=l}catch(S){Et(e,e.return,S)}}var no=!1,Kt=!1,ed=!1,Ff=typeof WeakSet=="function"?WeakSet:Set,an=null;function A_(e,a){if(e=e.containerInfo,xd=fc,e=zu(e),Yc(e)){if("selectionStart"in e)var l={start:e.selectionStart,end:e.selectionEnd};else e:{l=(l=e.ownerDocument)&&l.defaultView||window;var i=l.getSelection&&l.getSelection();if(i&&i.rangeCount!==0){l=i.anchorNode;var v=i.anchorOffset,S=i.focusNode;i=i.focusOffset;try{l.nodeType,S.nodeType}catch{l=null;break e}var A=0,Y=-1,re=-1,ye=0,Ce=0,ke=e,ve=null;t:for(;;){for(var we;ke!==l||v!==0&&ke.nodeType!==3||(Y=A+v),ke!==S||i!==0&&ke.nodeType!==3||(re=A+i),ke.nodeType===3&&(A+=ke.nodeValue.length),(we=ke.firstChild)!==null;)ve=ke,ke=we;for(;;){if(ke===e)break t;if(ve===l&&++ye===v&&(Y=A),ve===S&&++Ce===i&&(re=A),(we=ke.nextSibling)!==null)break;ke=ve,ve=ke.parentNode}ke=we}l=Y===-1||re===-1?null:{start:Y,end:re}}else l=null}l=l||{start:0,end:0}}else l=null;for(Cd={focusedElem:e,selectionRange:l},fc=!1,an=a;an!==null;)if(a=an,e=a.child,(a.subtreeFlags&1028)!==0&&e!==null)e.return=a,an=e;else for(;an!==null;){switch(a=an,S=a.alternate,e=a.flags,a.tag){case 0:if((e&4)!==0&&(e=a.updateQueue,e=e!==null?e.events:null,e!==null))for(l=0;l<e.length;l++)v=e[l],v.ref.impl=v.nextImpl;break;case 11:case 15:break;case 1:if((e&1024)!==0&&S!==null){e=void 0,l=a,v=S.memoizedProps,S=S.memoizedState,i=l.stateNode;try{var Be=ur(l.type,v);e=i.getSnapshotBeforeUpdate(Be,S),i.__reactInternalSnapshotBeforeUpdate=e}catch(et){Et(l,l.return,et)}}break;case 3:if((e&1024)!==0){if(e=a.stateNode.containerInfo,l=e.nodeType,l===9)Ed(e);else if(l===1)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":Ed(e);break;default:e.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((e&1024)!==0)throw Error(c(163))}if(e=a.sibling,e!==null){e.return=a.return,an=e;break}an=a.return}}function $f(e,a,l){var i=l.flags;switch(l.tag){case 0:case 11:case 15:oo(e,l),i&4&&Ll(5,l);break;case 1:if(oo(e,l),i&4)if(e=l.stateNode,a===null)try{e.componentDidMount()}catch(A){Et(l,l.return,A)}else{var v=ur(l.type,a.memoizedProps);a=a.memoizedState;try{e.componentDidUpdate(v,a,e.__reactInternalSnapshotBeforeUpdate)}catch(A){Et(l,l.return,A)}}i&64&&Nf(l),i&512&&Pl(l,l.return);break;case 3:if(oo(e,l),i&64&&(e=l.updateQueue,e!==null)){if(a=null,l.child!==null)switch(l.child.tag){case 27:case 5:a=l.child.stateNode;break;case 1:a=l.child.stateNode}try{gp(e,a)}catch(A){Et(l,l.return,A)}}break;case 27:a===null&&i&4&&Af(l);case 26:case 5:oo(e,l),a===null&&i&4&&Rf(l),i&512&&Pl(l,l.return);break;case 12:oo(e,l);break;case 31:oo(e,l),i&4&&Lf(e,l);break;case 13:oo(e,l),i&4&&Pf(e,l),i&64&&(e=l.memoizedState,e!==null&&(e=e.dehydrated,e!==null&&(l=M_.bind(null,l),s0(e,l))));break;case 22:if(i=l.memoizedState!==null||no,!i){a=a!==null&&a.memoizedState!==null||Kt,v=no;var S=Kt;no=i,(Kt=a)&&!S?ro(e,l,(l.subtreeFlags&8772)!==0):oo(e,l),no=v,Kt=S}break;case 30:break;default:oo(e,l)}}function If(e){var a=e.alternate;a!==null&&(e.alternate=null,If(a)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(a=e.stateNode,a!==null&&na(a)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var Ot=null,Dn=!1;function ao(e,a,l){for(l=l.child;l!==null;)qf(e,a,l),l=l.sibling}function qf(e,a,l){if(Lt&&typeof Lt.onCommitFiberUnmount=="function")try{Lt.onCommitFiberUnmount(Gt,l)}catch{}switch(l.tag){case 26:Kt||Pa(l,a),ao(e,a,l),l.memoizedState?l.memoizedState.count--:l.stateNode&&(l=l.stateNode,l.parentNode.removeChild(l));break;case 27:Kt||Pa(l,a);var i=Ot,v=Dn;Lo(l.type)&&(Ot=l.stateNode,Dn=!1),ao(e,a,l),Yl(l.stateNode),Ot=i,Dn=v;break;case 5:Kt||Pa(l,a);case 6:if(i=Ot,v=Dn,Ot=null,ao(e,a,l),Ot=i,Dn=v,Ot!==null)if(Dn)try{(Ot.nodeType===9?Ot.body:Ot.nodeName==="HTML"?Ot.ownerDocument.body:Ot).removeChild(l.stateNode)}catch(S){Et(l,a,S)}else try{Ot.removeChild(l.stateNode)}catch(S){Et(l,a,S)}break;case 18:Ot!==null&&(Dn?(e=Ot,Nh(e.nodeType===9?e.body:e.nodeName==="HTML"?e.ownerDocument.body:e,l.stateNode),Kr(e)):Nh(Ot,l.stateNode));break;case 4:i=Ot,v=Dn,Ot=l.stateNode.containerInfo,Dn=!0,ao(e,a,l),Ot=i,Dn=v;break;case 0:case 11:case 14:case 15:Ro(2,l,a),Kt||Ro(4,l,a),ao(e,a,l);break;case 1:Kt||(Pa(l,a),i=l.stateNode,typeof i.componentWillUnmount=="function"&&Tf(l,a,i)),ao(e,a,l);break;case 21:ao(e,a,l);break;case 22:Kt=(i=Kt)||l.memoizedState!==null,ao(e,a,l),Kt=i;break;default:ao(e,a,l)}}function Lf(e,a){if(a.memoizedState===null&&(e=a.alternate,e!==null&&(e=e.memoizedState,e!==null))){e=e.dehydrated;try{Kr(e)}catch(l){Et(a,a.return,l)}}}function Pf(e,a){if(a.memoizedState===null&&(e=a.alternate,e!==null&&(e=e.memoizedState,e!==null&&(e=e.dehydrated,e!==null))))try{Kr(e)}catch(l){Et(a,a.return,l)}}function F_(e){switch(e.tag){case 31:case 13:case 19:var a=e.stateNode;return a===null&&(a=e.stateNode=new Ff),a;case 22:return e=e.stateNode,a=e._retryCache,a===null&&(a=e._retryCache=new Ff),a;default:throw Error(c(435,e.tag))}}function Ys(e,a){var l=F_(e);a.forEach(function(i){if(!l.has(i)){l.add(i);var v=V_.bind(null,e,i);i.then(v,v)}})}function An(e,a){var l=a.deletions;if(l!==null)for(var i=0;i<l.length;i++){var v=l[i],S=e,A=a,Y=A;e:for(;Y!==null;){switch(Y.tag){case 27:if(Lo(Y.type)){Ot=Y.stateNode,Dn=!1;break e}break;case 5:Ot=Y.stateNode,Dn=!1;break e;case 3:case 4:Ot=Y.stateNode.containerInfo,Dn=!0;break e}Y=Y.return}if(Ot===null)throw Error(c(160));qf(S,A,v),Ot=null,Dn=!1,S=v.alternate,S!==null&&(S.return=null),v.return=null}if(a.subtreeFlags&13886)for(a=a.child;a!==null;)Uf(a,e),a=a.sibling}var ja=null;function Uf(e,a){var l=e.alternate,i=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:An(a,e),Fn(e),i&4&&(Ro(3,e,e.return),Ll(3,e),Ro(5,e,e.return));break;case 1:An(a,e),Fn(e),i&512&&(Kt||l===null||Pa(l,l.return)),i&64&&no&&(e=e.updateQueue,e!==null&&(i=e.callbacks,i!==null&&(l=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=l===null?i:l.concat(i))));break;case 26:var v=ja;if(An(a,e),Fn(e),i&512&&(Kt||l===null||Pa(l,l.return)),i&4){var S=l!==null?l.memoizedState:null;if(i=e.memoizedState,l===null)if(i===null)if(e.stateNode===null){e:{i=e.type,l=e.memoizedProps,v=v.ownerDocument||v;t:switch(i){case"title":S=v.getElementsByTagName("title")[0],(!S||S[Vn]||S[$t]||S.namespaceURI==="http://www.w3.org/2000/svg"||S.hasAttribute("itemprop"))&&(S=v.createElement(i),v.head.insertBefore(S,v.querySelector("head > title"))),cn(S,i,l),S[$t]=e,Tt(S),i=S;break e;case"link":var A=Uh("link","href",v).get(i+(l.href||""));if(A){for(var Y=0;Y<A.length;Y++)if(S=A[Y],S.getAttribute("href")===(l.href==null||l.href===""?null:l.href)&&S.getAttribute("rel")===(l.rel==null?null:l.rel)&&S.getAttribute("title")===(l.title==null?null:l.title)&&S.getAttribute("crossorigin")===(l.crossOrigin==null?null:l.crossOrigin)){A.splice(Y,1);break t}}S=v.createElement(i),cn(S,i,l),v.head.appendChild(S);break;case"meta":if(A=Uh("meta","content",v).get(i+(l.content||""))){for(Y=0;Y<A.length;Y++)if(S=A[Y],S.getAttribute("content")===(l.content==null?null:""+l.content)&&S.getAttribute("name")===(l.name==null?null:l.name)&&S.getAttribute("property")===(l.property==null?null:l.property)&&S.getAttribute("http-equiv")===(l.httpEquiv==null?null:l.httpEquiv)&&S.getAttribute("charset")===(l.charSet==null?null:l.charSet)){A.splice(Y,1);break t}}S=v.createElement(i),cn(S,i,l),v.head.appendChild(S);break;default:throw Error(c(468,i))}S[$t]=e,Tt(S),i=S}e.stateNode=i}else Oh(v,e.type,e.stateNode);else e.stateNode=Ph(v,i,e.memoizedProps);else S!==i?(S===null?l.stateNode!==null&&(l=l.stateNode,l.parentNode.removeChild(l)):S.count--,i===null?Oh(v,e.type,e.stateNode):Ph(v,i,e.memoizedProps)):i===null&&e.stateNode!==null&&Zi(e,e.memoizedProps,l.memoizedProps)}break;case 27:An(a,e),Fn(e),i&512&&(Kt||l===null||Pa(l,l.return)),l!==null&&i&4&&Zi(e,e.memoizedProps,l.memoizedProps);break;case 5:if(An(a,e),Fn(e),i&512&&(Kt||l===null||Pa(l,l.return)),e.flags&32){v=e.stateNode;try{aa(v,"")}catch(Be){Et(e,e.return,Be)}}i&4&&e.stateNode!=null&&(v=e.memoizedProps,Zi(e,v,l!==null?l.memoizedProps:v)),i&1024&&(ed=!0);break;case 6:if(An(a,e),Fn(e),i&4){if(e.stateNode===null)throw Error(c(162));i=e.memoizedProps,l=e.stateNode;try{l.nodeValue=i}catch(Be){Et(e,e.return,Be)}}break;case 3:if(ic=null,v=ja,ja=sc(a.containerInfo),An(a,e),ja=v,Fn(e),i&4&&l!==null&&l.memoizedState.isDehydrated)try{Kr(a.containerInfo)}catch(Be){Et(e,e.return,Be)}ed&&(ed=!1,Of(e));break;case 4:i=ja,ja=sc(e.stateNode.containerInfo),An(a,e),Fn(e),ja=i;break;case 12:An(a,e),Fn(e);break;case 31:An(a,e),Fn(e),i&4&&(i=e.updateQueue,i!==null&&(e.updateQueue=null,Ys(e,i)));break;case 13:An(a,e),Fn(e),e.child.flags&8192&&e.memoizedState!==null!=(l!==null&&l.memoizedState!==null)&&(Qs=qe()),i&4&&(i=e.updateQueue,i!==null&&(e.updateQueue=null,Ys(e,i)));break;case 22:v=e.memoizedState!==null;var re=l!==null&&l.memoizedState!==null,ye=no,Ce=Kt;if(no=ye||v,Kt=Ce||re,An(a,e),Kt=Ce,no=ye,Fn(e),i&8192)e:for(a=e.stateNode,a._visibility=v?a._visibility&-2:a._visibility|1,v&&(l===null||re||no||Kt||pr(e)),l=null,a=e;;){if(a.tag===5||a.tag===26){if(l===null){re=l=a;try{if(S=re.stateNode,v)A=S.style,typeof A.setProperty=="function"?A.setProperty("display","none","important"):A.display="none";else{Y=re.stateNode;var ke=re.memoizedProps.style,ve=ke!=null&&ke.hasOwnProperty("display")?ke.display:null;Y.style.display=ve==null||typeof ve=="boolean"?"":(""+ve).trim()}}catch(Be){Et(re,re.return,Be)}}}else if(a.tag===6){if(l===null){re=a;try{re.stateNode.nodeValue=v?"":re.memoizedProps}catch(Be){Et(re,re.return,Be)}}}else if(a.tag===18){if(l===null){re=a;try{var we=re.stateNode;v?Th(we,!0):Th(re.stateNode,!1)}catch(Be){Et(re,re.return,Be)}}}else if((a.tag!==22&&a.tag!==23||a.memoizedState===null||a===e)&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===e)break e;for(;a.sibling===null;){if(a.return===null||a.return===e)break e;l===a&&(l=null),a=a.return}l===a&&(l=null),a.sibling.return=a.return,a=a.sibling}i&4&&(i=e.updateQueue,i!==null&&(l=i.retryQueue,l!==null&&(i.retryQueue=null,Ys(e,l))));break;case 19:An(a,e),Fn(e),i&4&&(i=e.updateQueue,i!==null&&(e.updateQueue=null,Ys(e,i)));break;case 30:break;case 21:break;default:An(a,e),Fn(e)}}function Fn(e){var a=e.flags;if(a&2){try{for(var l,i=e.return;i!==null;){if(Df(i)){l=i;break}i=i.return}if(l==null)throw Error(c(160));switch(l.tag){case 27:var v=l.stateNode,S=Ki(e);Gs(e,S,v);break;case 5:var A=l.stateNode;l.flags&32&&(aa(A,""),l.flags&=-33);var Y=Ki(e);Gs(e,Y,A);break;case 3:case 4:var re=l.stateNode.containerInfo,ye=Ki(e);Ji(e,ye,re);break;default:throw Error(c(161))}}catch(Ce){Et(e,e.return,Ce)}e.flags&=-3}a&4096&&(e.flags&=-4097)}function Of(e){if(e.subtreeFlags&1024)for(e=e.child;e!==null;){var a=e;Of(a),a.tag===5&&a.flags&1024&&a.stateNode.reset(),e=e.sibling}}function oo(e,a){if(a.subtreeFlags&8772)for(a=a.child;a!==null;)$f(e,a.alternate,a),a=a.sibling}function pr(e){for(e=e.child;e!==null;){var a=e;switch(a.tag){case 0:case 11:case 14:case 15:Ro(4,a,a.return),pr(a);break;case 1:Pa(a,a.return);var l=a.stateNode;typeof l.componentWillUnmount=="function"&&Tf(a,a.return,l),pr(a);break;case 27:Yl(a.stateNode);case 26:case 5:Pa(a,a.return),pr(a);break;case 22:a.memoizedState===null&&pr(a);break;case 30:pr(a);break;default:pr(a)}e=e.sibling}}function ro(e,a,l){for(l=l&&(a.subtreeFlags&8772)!==0,a=a.child;a!==null;){var i=a.alternate,v=e,S=a,A=S.flags;switch(S.tag){case 0:case 11:case 15:ro(v,S,l),Ll(4,S);break;case 1:if(ro(v,S,l),i=S,v=i.stateNode,typeof v.componentDidMount=="function")try{v.componentDidMount()}catch(ye){Et(i,i.return,ye)}if(i=S,v=i.updateQueue,v!==null){var Y=i.stateNode;try{var re=v.shared.hiddenCallbacks;if(re!==null)for(v.shared.hiddenCallbacks=null,v=0;v<re.length;v++)yp(re[v],Y)}catch(ye){Et(i,i.return,ye)}}l&&A&64&&Nf(S),Pl(S,S.return);break;case 27:Af(S);case 26:case 5:ro(v,S,l),l&&i===null&&A&4&&Rf(S),Pl(S,S.return);break;case 12:ro(v,S,l);break;case 31:ro(v,S,l),l&&A&4&&Lf(v,S);break;case 13:ro(v,S,l),l&&A&4&&Pf(v,S);break;case 22:S.memoizedState===null&&ro(v,S,l),Pl(S,S.return);break;case 30:break;default:ro(v,S,l)}a=a.sibling}}function td(e,a){var l=null;e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(l=e.memoizedState.cachePool.pool),e=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(e=a.memoizedState.cachePool.pool),e!==l&&(e!=null&&e.refCount++,l!=null&&bl(l))}function nd(e,a){e=null,a.alternate!==null&&(e=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==e&&(a.refCount++,e!=null&&bl(e))}function ka(e,a,l,i){if(a.subtreeFlags&10256)for(a=a.child;a!==null;)Mf(e,a,l,i),a=a.sibling}function Mf(e,a,l,i){var v=a.flags;switch(a.tag){case 0:case 11:case 15:ka(e,a,l,i),v&2048&&Ll(9,a);break;case 1:ka(e,a,l,i);break;case 3:ka(e,a,l,i),v&2048&&(e=null,a.alternate!==null&&(e=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==e&&(a.refCount++,e!=null&&bl(e)));break;case 12:if(v&2048){ka(e,a,l,i),e=a.stateNode;try{var S=a.memoizedProps,A=S.id,Y=S.onPostCommit;typeof Y=="function"&&Y(A,a.alternate===null?"mount":"update",e.passiveEffectDuration,-0)}catch(re){Et(a,a.return,re)}}else ka(e,a,l,i);break;case 31:ka(e,a,l,i);break;case 13:ka(e,a,l,i);break;case 23:break;case 22:S=a.stateNode,A=a.alternate,a.memoizedState!==null?S._visibility&2?ka(e,a,l,i):Ul(e,a):S._visibility&2?ka(e,a,l,i):(S._visibility|=2,Mr(e,a,l,i,(a.subtreeFlags&10256)!==0||!1)),v&2048&&td(A,a);break;case 24:ka(e,a,l,i),v&2048&&nd(a.alternate,a);break;default:ka(e,a,l,i)}}function Mr(e,a,l,i,v){for(v=v&&((a.subtreeFlags&10256)!==0||!1),a=a.child;a!==null;){var S=e,A=a,Y=l,re=i,ye=A.flags;switch(A.tag){case 0:case 11:case 15:Mr(S,A,Y,re,v),Ll(8,A);break;case 23:break;case 22:var Ce=A.stateNode;A.memoizedState!==null?Ce._visibility&2?Mr(S,A,Y,re,v):Ul(S,A):(Ce._visibility|=2,Mr(S,A,Y,re,v)),v&&ye&2048&&td(A.alternate,A);break;case 24:Mr(S,A,Y,re,v),v&&ye&2048&&nd(A.alternate,A);break;default:Mr(S,A,Y,re,v)}a=a.sibling}}function Ul(e,a){if(a.subtreeFlags&10256)for(a=a.child;a!==null;){var l=e,i=a,v=i.flags;switch(i.tag){case 22:Ul(l,i),v&2048&&td(i.alternate,i);break;case 24:Ul(l,i),v&2048&&nd(i.alternate,i);break;default:Ul(l,i)}a=a.sibling}}var Ol=8192;function Vr(e,a,l){if(e.subtreeFlags&Ol)for(e=e.child;e!==null;)Vf(e,a,l),e=e.sibling}function Vf(e,a,l){switch(e.tag){case 26:Vr(e,a,l),e.flags&Ol&&e.memoizedState!==null&&_0(l,ja,e.memoizedState,e.memoizedProps);break;case 5:Vr(e,a,l);break;case 3:case 4:var i=ja;ja=sc(e.stateNode.containerInfo),Vr(e,a,l),ja=i;break;case 22:e.memoizedState===null&&(i=e.alternate,i!==null&&i.memoizedState!==null?(i=Ol,Ol=16777216,Vr(e,a,l),Ol=i):Vr(e,a,l));break;default:Vr(e,a,l)}}function Hf(e){var a=e.alternate;if(a!==null&&(e=a.child,e!==null)){a.child=null;do a=e.sibling,e.sibling=null,e=a;while(e!==null)}}function Ml(e){var a=e.deletions;if((e.flags&16)!==0){if(a!==null)for(var l=0;l<a.length;l++){var i=a[l];an=i,Bf(i,e)}Hf(e)}if(e.subtreeFlags&10256)for(e=e.child;e!==null;)zf(e),e=e.sibling}function zf(e){switch(e.tag){case 0:case 11:case 15:Ml(e),e.flags&2048&&Ro(9,e,e.return);break;case 3:Ml(e);break;case 12:Ml(e);break;case 22:var a=e.stateNode;e.memoizedState!==null&&a._visibility&2&&(e.return===null||e.return.tag!==13)?(a._visibility&=-3,Ws(e)):Ml(e);break;default:Ml(e)}}function Ws(e){var a=e.deletions;if((e.flags&16)!==0){if(a!==null)for(var l=0;l<a.length;l++){var i=a[l];an=i,Bf(i,e)}Hf(e)}for(e=e.child;e!==null;){switch(a=e,a.tag){case 0:case 11:case 15:Ro(8,a,a.return),Ws(a);break;case 22:l=a.stateNode,l._visibility&2&&(l._visibility&=-3,Ws(a));break;default:Ws(a)}e=e.sibling}}function Bf(e,a){for(;an!==null;){var l=an;switch(l.tag){case 0:case 11:case 15:Ro(8,l,a);break;case 23:case 22:if(l.memoizedState!==null&&l.memoizedState.cachePool!==null){var i=l.memoizedState.cachePool.pool;i!=null&&i.refCount++}break;case 24:bl(l.memoizedState.cache)}if(i=l.child,i!==null)i.return=l,an=i;else e:for(l=e;an!==null;){i=an;var v=i.sibling,S=i.return;if(If(i),i===l){an=null;break e}if(v!==null){v.return=S,an=v;break e}an=S}}}var $_={getCacheForType:function(e){var a=ln(Qt),l=a.data.get(e);return l===void 0&&(l=e(),a.data.set(e,l)),l},cacheSignal:function(){return ln(Qt).controller.signal}},I_=typeof WeakMap=="function"?WeakMap:Map,Ct=0,Dt=null,ft=null,mt=0,bt=0,Qn=null,Do=!1,Hr=!1,ad=!1,lo=0,Bt=0,Ao=0,fr=0,od=0,Xn=0,zr=0,Vl=null,$n=null,rd=!1,Qs=0,Gf=0,Xs=1/0,Zs=null,Fo=null,en=0,$o=null,Br=null,so=0,ld=0,sd=null,Yf=null,Hl=0,cd=null;function Zn(){return(Ct&2)!==0&&mt!==0?mt&-mt:N.T!==null?hd():Da()}function Wf(){if(Xn===0)if((mt&536870912)===0||gt){var e=ta;ta<<=1,(ta&3932160)===0&&(ta=262144),Xn=e}else Xn=536870912;return e=Yn.current,e!==null&&(e.flags|=32),Xn}function In(e,a,l){(e===Dt&&(bt===2||bt===9)||e.cancelPendingCommit!==null)&&(Gr(e,0),Io(e,mt,Xn,!1)),On(e,l),((Ct&2)===0||e!==Dt)&&(e===Dt&&((Ct&2)===0&&(fr|=l),Bt===4&&Io(e,mt,Xn,!1)),Ua(e))}function Qf(e,a,l){if((Ct&6)!==0)throw Error(c(327));var i=!l&&(a&127)===0&&(a&e.expiredLanes)===0||Jt(e,a),v=i?P_(e,a):dd(e,a,!0),S=i;do{if(v===0){Hr&&!i&&Io(e,a,0,!1);break}else{if(l=e.current.alternate,S&&!q_(l)){v=dd(e,a,!1),S=!1;continue}if(v===2){if(S=a,e.errorRecoveryDisabledLanes&S)var A=0;else A=e.pendingLanes&-536870913,A=A!==0?A:A&536870912?536870912:0;if(A!==0){a=A;e:{var Y=e;v=Vl;var re=Y.current.memoizedState.isDehydrated;if(re&&(Gr(Y,A).flags|=256),A=dd(Y,A,!1),A!==2){if(ad&&!re){Y.errorRecoveryDisabledLanes|=S,fr|=S,v=4;break e}S=$n,$n=v,S!==null&&($n===null?$n=S:$n.push.apply($n,S))}v=A}if(S=!1,v!==2)continue}}if(v===1){Gr(e,0),Io(e,a,0,!0);break}e:{switch(i=e,S=v,S){case 0:case 1:throw Error(c(345));case 4:if((a&4194048)!==a)break;case 6:Io(i,a,Xn,!Do);break e;case 2:$n=null;break;case 3:case 5:break;default:throw Error(c(329))}if((a&62914560)===a&&(v=Qs+300-qe(),10<v)){if(Io(i,a,Xn,!Do),En(i,0,!0)!==0)break e;so=a,i.timeoutHandle=jh(Xf.bind(null,i,l,$n,Zs,rd,a,Xn,fr,zr,Do,S,"Throttled",-0,0),v);break e}Xf(i,l,$n,Zs,rd,a,Xn,fr,zr,Do,S,null,-0,0)}}break}while(!0);Ua(e)}function Xf(e,a,l,i,v,S,A,Y,re,ye,Ce,ke,ve,we){if(e.timeoutHandle=-1,ke=a.subtreeFlags,ke&8192||(ke&16785408)===16785408){ke={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Nn},Vf(a,S,ke);var Be=(S&62914560)===S?Qs-qe():(S&4194048)===S?Gf-qe():0;if(Be=w0(ke,Be),Be!==null){so=S,e.cancelPendingCommit=Be(oh.bind(null,e,a,S,l,i,v,A,Y,re,Ce,ke,null,ve,we)),Io(e,S,A,!ye);return}}oh(e,a,S,l,i,v,A,Y,re)}function q_(e){for(var a=e;;){var l=a.tag;if((l===0||l===11||l===15)&&a.flags&16384&&(l=a.updateQueue,l!==null&&(l=l.stores,l!==null)))for(var i=0;i<l.length;i++){var v=l[i],S=v.getSnapshot;v=v.value;try{if(!Bn(S(),v))return!1}catch{return!1}}if(l=a.child,a.subtreeFlags&16384&&l!==null)l.return=a,a=l;else{if(a===e)break;for(;a.sibling===null;){if(a.return===null||a.return===e)return!0;a=a.return}a.sibling.return=a.return,a=a.sibling}}return!0}function Io(e,a,l,i){a&=~od,a&=~fr,e.suspendedLanes|=a,e.pingedLanes&=~a,i&&(e.warmLanes|=a),i=e.expirationTimes;for(var v=a;0<v;){var S=31-Pt(v),A=1<<S;i[S]=-1,v&=~A}l!==0&&Ta(e,l,a)}function Ks(){return(Ct&6)===0?(zl(0),!1):!0}function id(){if(ft!==null){if(bt===0)var e=ft.return;else e=ft,Xa=or=null,Ei(e),qr=null,jl=0,e=ft;for(;e!==null;)kf(e.alternate,e),e=e.return;ft=null}}function Gr(e,a){var l=e.timeoutHandle;l!==-1&&(e.timeoutHandle=-1,n0(l)),l=e.cancelPendingCommit,l!==null&&(e.cancelPendingCommit=null,l()),so=0,id(),Dt=e,ft=l=Wa(e.current,null),mt=a,bt=0,Qn=null,Do=!1,Hr=Jt(e,a),ad=!1,zr=Xn=od=fr=Ao=Bt=0,$n=Vl=null,rd=!1,(a&8)!==0&&(a|=a&32);var i=e.entangledLanes;if(i!==0)for(e=e.entanglements,i&=a;0<i;){var v=31-Pt(i),S=1<<v;a|=e[v],i&=~S}return lo=a,_s(),l}function Zf(e,a){rt=null,N.H=$l,a===Ir||a===ks?(a=pp(),bt=3):a===fi?(a=pp(),bt=4):bt=a===Mi?8:a!==null&&typeof a=="object"&&typeof a.then=="function"?6:1,Qn=a,ft===null&&(Bt=1,Ms(e,la(a,e.current)))}function Kf(){var e=Yn.current;return e===null?!0:(mt&4194048)===mt?da===null:(mt&62914560)===mt||(mt&536870912)!==0?e===da:!1}function Jf(){var e=N.H;return N.H=$l,e===null?$l:e}function eh(){var e=N.A;return N.A=$_,e}function Js(){Bt=4,Do||(mt&4194048)!==mt&&Yn.current!==null||(Hr=!0),(Ao&134217727)===0&&(fr&134217727)===0||Dt===null||Io(Dt,mt,Xn,!1)}function dd(e,a,l){var i=Ct;Ct|=2;var v=Jf(),S=eh();(Dt!==e||mt!==a)&&(Zs=null,Gr(e,a)),a=!1;var A=Bt;e:do try{if(bt!==0&&ft!==null){var Y=ft,re=Qn;switch(bt){case 8:id(),A=6;break e;case 3:case 2:case 9:case 6:Yn.current===null&&(a=!0);var ye=bt;if(bt=0,Qn=null,Yr(e,Y,re,ye),l&&Hr){A=0;break e}break;default:ye=bt,bt=0,Qn=null,Yr(e,Y,re,ye)}}L_(),A=Bt;break}catch(Ce){Zf(e,Ce)}while(!0);return a&&e.shellSuspendCounter++,Xa=or=null,Ct=i,N.H=v,N.A=S,ft===null&&(Dt=null,mt=0,_s()),A}function L_(){for(;ft!==null;)th(ft)}function P_(e,a){var l=Ct;Ct|=2;var i=Jf(),v=eh();Dt!==e||mt!==a?(Zs=null,Xs=qe()+500,Gr(e,a)):Hr=Jt(e,a);e:do try{if(bt!==0&&ft!==null){a=ft;var S=Qn;t:switch(bt){case 1:bt=0,Qn=null,Yr(e,a,S,1);break;case 2:case 9:if(dp(S)){bt=0,Qn=null,nh(a);break}a=function(){bt!==2&&bt!==9||Dt!==e||(bt=7),Ua(e)},S.then(a,a);break e;case 3:bt=7;break e;case 4:bt=5;break e;case 7:dp(S)?(bt=0,Qn=null,nh(a)):(bt=0,Qn=null,Yr(e,a,S,7));break;case 5:var A=null;switch(ft.tag){case 26:A=ft.memoizedState;case 5:case 27:var Y=ft;if(A?Mh(A):Y.stateNode.complete){bt=0,Qn=null;var re=Y.sibling;if(re!==null)ft=re;else{var ye=Y.return;ye!==null?(ft=ye,ec(ye)):ft=null}break t}}bt=0,Qn=null,Yr(e,a,S,5);break;case 6:bt=0,Qn=null,Yr(e,a,S,6);break;case 8:id(),Bt=6;break e;default:throw Error(c(462))}}U_();break}catch(Ce){Zf(e,Ce)}while(!0);return Xa=or=null,N.H=i,N.A=v,Ct=l,ft!==null?0:(Dt=null,mt=0,_s(),Bt)}function U_(){for(;ft!==null&&!He();)th(ft)}function th(e){var a=Ef(e.alternate,e,lo);e.memoizedProps=e.pendingProps,a===null?ec(e):ft=a}function nh(e){var a=e,l=a.alternate;switch(a.tag){case 15:case 0:a=_f(l,a,a.pendingProps,a.type,void 0,mt);break;case 11:a=_f(l,a,a.pendingProps,a.type.render,a.ref,mt);break;case 5:Ei(a);default:kf(l,a),a=ft=Ju(a,lo),a=Ef(l,a,lo)}e.memoizedProps=e.pendingProps,a===null?ec(e):ft=a}function Yr(e,a,l,i){Xa=or=null,Ei(a),qr=null,jl=0;var v=a.return;try{if(k_(e,v,a,l,mt)){Bt=1,Ms(e,la(l,e.current)),ft=null;return}}catch(S){if(v!==null)throw ft=v,S;Bt=1,Ms(e,la(l,e.current)),ft=null;return}a.flags&32768?(gt||i===1?e=!0:Hr||(mt&536870912)!==0?e=!1:(Do=e=!0,(i===2||i===9||i===3||i===6)&&(i=Yn.current,i!==null&&i.tag===13&&(i.flags|=16384))),ah(a,e)):ec(a)}function ec(e){var a=e;do{if((a.flags&32768)!==0){ah(a,Do);return}e=a.return;var l=R_(a.alternate,a,lo);if(l!==null){ft=l;return}if(a=a.sibling,a!==null){ft=a;return}ft=a=e}while(a!==null);Bt===0&&(Bt=5)}function ah(e,a){do{var l=D_(e.alternate,e);if(l!==null){l.flags&=32767,ft=l;return}if(l=e.return,l!==null&&(l.flags|=32768,l.subtreeFlags=0,l.deletions=null),!a&&(e=e.sibling,e!==null)){ft=e;return}ft=e=l}while(e!==null);Bt=6,ft=null}function oh(e,a,l,i,v,S,A,Y,re){e.cancelPendingCommit=null;do tc();while(en!==0);if((Ct&6)!==0)throw Error(c(327));if(a!==null){if(a===e.current)throw Error(c(177));if(S=a.lanes|a.childLanes,S|=Kc,za(e,l,S,A,Y,re),e===Dt&&(ft=Dt=null,mt=0),Br=a,$o=e,so=l,ld=S,sd=v,Yf=i,(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?(e.callbackNode=null,e.callbackPriority=0,H_(ut,function(){return ih(),null})):(e.callbackNode=null,e.callbackPriority=0),i=(a.flags&13878)!==0,(a.subtreeFlags&13878)!==0||i){i=N.T,N.T=null,v=R.p,R.p=2,A=Ct,Ct|=4;try{A_(e,a,l)}finally{Ct=A,R.p=v,N.T=i}}en=1,rh(),lh(),sh()}}function rh(){if(en===1){en=0;var e=$o,a=Br,l=(a.flags&13878)!==0;if((a.subtreeFlags&13878)!==0||l){l=N.T,N.T=null;var i=R.p;R.p=2;var v=Ct;Ct|=4;try{Uf(a,e);var S=Cd,A=zu(e.containerInfo),Y=S.focusedElem,re=S.selectionRange;if(A!==Y&&Y&&Y.ownerDocument&&Hu(Y.ownerDocument.documentElement,Y)){if(re!==null&&Yc(Y)){var ye=re.start,Ce=re.end;if(Ce===void 0&&(Ce=ye),"selectionStart"in Y)Y.selectionStart=ye,Y.selectionEnd=Math.min(Ce,Y.value.length);else{var ke=Y.ownerDocument||document,ve=ke&&ke.defaultView||window;if(ve.getSelection){var we=ve.getSelection(),Be=Y.textContent.length,et=Math.min(re.start,Be),Nt=re.end===void 0?et:Math.min(re.end,Be);!we.extend&&et>Nt&&(A=Nt,Nt=et,et=A);var ue=Vu(Y,et),le=Vu(Y,Nt);if(ue&&le&&(we.rangeCount!==1||we.anchorNode!==ue.node||we.anchorOffset!==ue.offset||we.focusNode!==le.node||we.focusOffset!==le.offset)){var he=ke.createRange();he.setStart(ue.node,ue.offset),we.removeAllRanges(),et>Nt?(we.addRange(he),we.extend(le.node,le.offset)):(he.setEnd(le.node,le.offset),we.addRange(he))}}}}for(ke=[],we=Y;we=we.parentNode;)we.nodeType===1&&ke.push({element:we,left:we.scrollLeft,top:we.scrollTop});for(typeof Y.focus=="function"&&Y.focus(),Y=0;Y<ke.length;Y++){var Ee=ke[Y];Ee.element.scrollLeft=Ee.left,Ee.element.scrollTop=Ee.top}}fc=!!xd,Cd=xd=null}finally{Ct=v,R.p=i,N.T=l}}e.current=a,en=2}}function lh(){if(en===2){en=0;var e=$o,a=Br,l=(a.flags&8772)!==0;if((a.subtreeFlags&8772)!==0||l){l=N.T,N.T=null;var i=R.p;R.p=2;var v=Ct;Ct|=4;try{$f(e,a.alternate,a)}finally{Ct=v,R.p=i,N.T=l}}en=3}}function sh(){if(en===4||en===3){en=0,Ge();var e=$o,a=Br,l=so,i=Yf;(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?en=5:(en=0,Br=$o=null,ch(e,e.pendingLanes));var v=e.pendingLanes;if(v===0&&(Fo=null),_a(l),a=a.stateNode,Lt&&typeof Lt.onCommitFiberRoot=="function")try{Lt.onCommitFiberRoot(Gt,a,void 0,(a.current.flags&128)===128)}catch{}if(i!==null){a=N.T,v=R.p,R.p=2,N.T=null;try{for(var S=e.onRecoverableError,A=0;A<i.length;A++){var Y=i[A];S(Y.value,{componentStack:Y.stack})}}finally{N.T=a,R.p=v}}(so&3)!==0&&tc(),Ua(e),v=e.pendingLanes,(l&261930)!==0&&(v&42)!==0?e===cd?Hl++:(Hl=0,cd=e):Hl=0,zl(0)}}function ch(e,a){(e.pooledCacheLanes&=a)===0&&(a=e.pooledCache,a!=null&&(e.pooledCache=null,bl(a)))}function tc(){return rh(),lh(),sh(),ih()}function ih(){if(en!==5)return!1;var e=$o,a=ld;ld=0;var l=_a(so),i=N.T,v=R.p;try{R.p=32>l?32:l,N.T=null,l=sd,sd=null;var S=$o,A=so;if(en=0,Br=$o=null,so=0,(Ct&6)!==0)throw Error(c(331));var Y=Ct;if(Ct|=4,zf(S.current),Mf(S,S.current,A,l),Ct=Y,zl(0,!1),Lt&&typeof Lt.onPostCommitFiberRoot=="function")try{Lt.onPostCommitFiberRoot(Gt,S)}catch{}return!0}finally{R.p=v,N.T=i,ch(e,a)}}function dh(e,a,l){a=la(l,a),a=Oi(e.stateNode,a,2),e=ko(e,a,2),e!==null&&(On(e,2),Ua(e))}function Et(e,a,l){if(e.tag===3)dh(e,e,l);else for(;a!==null;){if(a.tag===3){dh(a,e,l);break}else if(a.tag===1){var i=a.stateNode;if(typeof a.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(Fo===null||!Fo.has(i))){e=la(l,e),l=uf(2),i=ko(a,l,2),i!==null&&(pf(l,i,a,e),On(i,2),Ua(i));break}}a=a.return}}function ud(e,a,l){var i=e.pingCache;if(i===null){i=e.pingCache=new I_;var v=new Set;i.set(a,v)}else v=i.get(a),v===void 0&&(v=new Set,i.set(a,v));v.has(l)||(ad=!0,v.add(l),e=O_.bind(null,e,a,l),a.then(e,e))}function O_(e,a,l){var i=e.pingCache;i!==null&&i.delete(a),e.pingedLanes|=e.suspendedLanes&l,e.warmLanes&=~l,Dt===e&&(mt&l)===l&&(Bt===4||Bt===3&&(mt&62914560)===mt&&300>qe()-Qs?(Ct&2)===0&&Gr(e,0):od|=l,zr===mt&&(zr=0)),Ua(e)}function uh(e,a){a===0&&(a=ya()),e=tr(e,a),e!==null&&(On(e,a),Ua(e))}function M_(e){var a=e.memoizedState,l=0;a!==null&&(l=a.retryLane),uh(e,l)}function V_(e,a){var l=0;switch(e.tag){case 31:case 13:var i=e.stateNode,v=e.memoizedState;v!==null&&(l=v.retryLane);break;case 19:i=e.stateNode;break;case 22:i=e.stateNode._retryCache;break;default:throw Error(c(314))}i!==null&&i.delete(a),uh(e,l)}function H_(e,a){return je(e,a)}var nc=null,Wr=null,pd=!1,ac=!1,fd=!1,qo=0;function Ua(e){e!==Wr&&e.next===null&&(Wr===null?nc=Wr=e:Wr=Wr.next=e),ac=!0,pd||(pd=!0,B_())}function zl(e,a){if(!fd&&ac){fd=!0;do for(var l=!1,i=nc;i!==null;){if(e!==0){var v=i.pendingLanes;if(v===0)var S=0;else{var A=i.suspendedLanes,Y=i.pingedLanes;S=(1<<31-Pt(42|e)+1)-1,S&=v&~(A&~Y),S=S&201326741?S&201326741|1:S?S|2:0}S!==0&&(l=!0,mh(i,S))}else S=mt,S=En(i,i===Dt?S:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),(S&3)===0||Jt(i,S)||(l=!0,mh(i,S));i=i.next}while(l);fd=!1}}function z_(){ph()}function ph(){ac=pd=!1;var e=0;qo!==0&&t0()&&(e=qo);for(var a=qe(),l=null,i=nc;i!==null;){var v=i.next,S=fh(i,a);S===0?(i.next=null,l===null?nc=v:l.next=v,v===null&&(Wr=l)):(l=i,(e!==0||(S&3)!==0)&&(ac=!0)),i=v}en!==0&&en!==5||zl(e),qo!==0&&(qo=0)}function fh(e,a){for(var l=e.suspendedLanes,i=e.pingedLanes,v=e.expirationTimes,S=e.pendingLanes&-62914561;0<S;){var A=31-Pt(S),Y=1<<A,re=v[A];re===-1?((Y&l)===0||(Y&i)!==0)&&(v[A]=Un(Y,a)):re<=a&&(e.expiredLanes|=Y),S&=~Y}if(a=Dt,l=mt,l=En(e,e===a?l:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),i=e.callbackNode,l===0||e===a&&(bt===2||bt===9)||e.cancelPendingCommit!==null)return i!==null&&i!==null&&Ve(i),e.callbackNode=null,e.callbackPriority=0;if((l&3)===0||Jt(e,l)){if(a=l&-l,a===e.callbackPriority)return a;switch(i!==null&&Ve(i),_a(l)){case 2:case 8:l=Le;break;case 32:l=ut;break;case 268435456:l=Je;break;default:l=ut}return i=hh.bind(null,e),l=je(l,i),e.callbackPriority=a,e.callbackNode=l,a}return i!==null&&i!==null&&Ve(i),e.callbackPriority=2,e.callbackNode=null,2}function hh(e,a){if(en!==0&&en!==5)return e.callbackNode=null,e.callbackPriority=0,null;var l=e.callbackNode;if(tc()&&e.callbackNode!==l)return null;var i=mt;return i=En(e,e===Dt?i:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),i===0?null:(Qf(e,i,a),fh(e,qe()),e.callbackNode!=null&&e.callbackNode===l?hh.bind(null,e):null)}function mh(e,a){if(tc())return null;Qf(e,a,!0)}function B_(){a0(function(){(Ct&6)!==0?je(Oe,z_):ph()})}function hd(){if(qo===0){var e=Fr;e===0&&(e=bn,bn<<=1,(bn&261888)===0&&(bn=256)),qo=e}return qo}function yh(e){return e==null||typeof e=="symbol"||typeof e=="boolean"?null:typeof e=="function"?e:Ya(""+e)}function gh(e,a){var l=a.ownerDocument.createElement("input");return l.name=a.name,l.value=a.value,e.id&&l.setAttribute("form",e.id),a.parentNode.insertBefore(l,a),e=new FormData(e),l.parentNode.removeChild(l),e}function G_(e,a,l,i,v){if(a==="submit"&&l&&l.stateNode===v){var S=yh((v[Mt]||null).action),A=i.submitter;A&&(a=(a=A[Mt]||null)?yh(a.formAction):A.getAttribute("formAction"),a!==null&&(S=a,A=null));var Y=new ms("action","action",null,i,v);e.push({event:Y,listeners:[{instance:null,listener:function(){if(i.defaultPrevented){if(qo!==0){var re=A?gh(v,A):new FormData(v);$i(l,{pending:!0,data:re,method:v.method,action:S},null,re)}}else typeof S=="function"&&(Y.preventDefault(),re=A?gh(v,A):new FormData(v),$i(l,{pending:!0,data:re,method:v.method,action:S},S,re))},currentTarget:v}]})}}for(var md=0;md<Zc.length;md++){var yd=Zc[md],Y_=yd.toLowerCase(),W_=yd[0].toUpperCase()+yd.slice(1);Ea(Y_,"on"+W_)}Ea(Yu,"onAnimationEnd"),Ea(Wu,"onAnimationIteration"),Ea(Qu,"onAnimationStart"),Ea("dblclick","onDoubleClick"),Ea("focusin","onFocus"),Ea("focusout","onBlur"),Ea(d_,"onTransitionRun"),Ea(u_,"onTransitionStart"),Ea(p_,"onTransitionCancel"),Ea(Xu,"onTransitionEnd"),xn("onMouseEnter",["mouseout","mouseover"]),xn("onMouseLeave",["mouseout","mouseover"]),xn("onPointerEnter",["pointerout","pointerover"]),xn("onPointerLeave",["pointerout","pointerover"]),mn("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),mn("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),mn("onBeforeInput",["compositionend","keypress","textInput","paste"]),mn("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),mn("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),mn("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Bl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Q_=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Bl));function vh(e,a){a=(a&4)!==0;for(var l=0;l<e.length;l++){var i=e[l],v=i.event;i=i.listeners;e:{var S=void 0;if(a)for(var A=i.length-1;0<=A;A--){var Y=i[A],re=Y.instance,ye=Y.currentTarget;if(Y=Y.listener,re!==S&&v.isPropagationStopped())break e;S=Y,v.currentTarget=ye;try{S(v)}catch(Ce){vs(Ce)}v.currentTarget=null,S=re}else for(A=0;A<i.length;A++){if(Y=i[A],re=Y.instance,ye=Y.currentTarget,Y=Y.listener,re!==S&&v.isPropagationStopped())break e;S=Y,v.currentTarget=ye;try{S(v)}catch(Ce){vs(Ce)}v.currentTarget=null,S=re}}}}function ht(e,a){var l=a[wa];l===void 0&&(l=a[wa]=new Set);var i=e+"__bubble";l.has(i)||(_h(a,e,2,!1),l.add(i))}function gd(e,a,l){var i=0;a&&(i|=4),_h(l,e,i,a)}var oc="_reactListening"+Math.random().toString(36).slice(2);function vd(e){if(!e[oc]){e[oc]=!0,xa.forEach(function(l){l!=="selectionchange"&&(Q_.has(l)||gd(l,!1,e),gd(l,!0,e))});var a=e.nodeType===9?e:e.ownerDocument;a===null||a[oc]||(a[oc]=!0,gd("selectionchange",!1,a))}}function _h(e,a,l,i){switch(Wh(a)){case 2:var v=S0;break;case 8:v=b0;break;default:v=Fd}l=v.bind(null,a,l,e),v=void 0,!us||a!=="touchstart"&&a!=="touchmove"&&a!=="wheel"||(v=!0),i?v!==void 0?e.addEventListener(a,l,{capture:!0,passive:v}):e.addEventListener(a,l,!0):v!==void 0?e.addEventListener(a,l,{passive:v}):e.addEventListener(a,l,!1)}function _d(e,a,l,i,v){var S=i;if((a&1)===0&&(a&2)===0&&i!==null)e:for(;;){if(i===null)return;var A=i.tag;if(A===3||A===4){var Y=i.stateNode.containerInfo;if(Y===v)break;if(A===4)for(A=i.return;A!==null;){var re=A.tag;if((re===3||re===4)&&A.stateNode.containerInfo===v)return;A=A.return}for(;Y!==null;){if(A=vn(Y),A===null)return;if(re=A.tag,re===5||re===6||re===26||re===27){i=S=A;continue e}Y=Y.parentNode}}i=i.return}zn(function(){var ye=S,Ce=vo(l),ke=[];e:{var ve=Zu.get(e);if(ve!==void 0){var we=ms,Be=e;switch(e){case"keypress":if(fs(l)===0)break e;case"keydown":case"keyup":we=Vv;break;case"focusin":Be="focus",we=Vc;break;case"focusout":Be="blur",we=Vc;break;case"beforeblur":case"afterblur":we=Vc;break;case"click":if(l.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":we=ju;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":we=Rv;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":we=Bv;break;case Yu:case Wu:case Qu:we=Fv;break;case Xu:we=Yv;break;case"scroll":case"scrollend":we=Nv;break;case"wheel":we=Qv;break;case"copy":case"cut":case"paste":we=Iv;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":we=Nu;break;case"toggle":case"beforetoggle":we=Zv}var et=(a&4)!==0,Nt=!et&&(e==="scroll"||e==="scrollend"),ue=et?ve!==null?ve+"Capture":null:ve;et=[];for(var le=ye,he;le!==null;){var Ee=le;if(he=Ee.stateNode,Ee=Ee.tag,Ee!==5&&Ee!==26&&Ee!==27||he===null||ue===null||(Ee=Ia(le,ue),Ee!=null&&et.push(Gl(le,Ee,he))),Nt)break;le=le.return}0<et.length&&(ve=new we(ve,Be,null,l,Ce),ke.push({event:ve,listeners:et}))}}if((a&7)===0){e:{if(ve=e==="mouseover"||e==="pointerover",we=e==="mouseout"||e==="pointerout",ve&&l!==go&&(Be=l.relatedTarget||l.fromElement)&&(vn(Be)||Be[jn]))break e;if((we||ve)&&(ve=Ce.window===Ce?Ce:(ve=Ce.ownerDocument)?ve.defaultView||ve.parentWindow:window,we?(Be=l.relatedTarget||l.toElement,we=ye,Be=Be?vn(Be):null,Be!==null&&(Nt=d(Be),et=Be.tag,Be!==Nt||et!==5&&et!==27&&et!==6)&&(Be=null)):(we=null,Be=ye),we!==Be)){if(et=ju,Ee="onMouseLeave",ue="onMouseEnter",le="mouse",(e==="pointerout"||e==="pointerover")&&(et=Nu,Ee="onPointerLeave",ue="onPointerEnter",le="pointer"),Nt=we==null?ve:kn(we),he=Be==null?ve:kn(Be),ve=new et(Ee,le+"leave",we,l,Ce),ve.target=Nt,ve.relatedTarget=he,Ee=null,vn(Ce)===ye&&(et=new et(ue,le+"enter",Be,l,Ce),et.target=he,et.relatedTarget=Nt,Ee=et),Nt=Ee,we&&Be)t:{for(et=X_,ue=we,le=Be,he=0,Ee=ue;Ee;Ee=et(Ee))he++;Ee=0;for(var Ze=le;Ze;Ze=et(Ze))Ee++;for(;0<he-Ee;)ue=et(ue),he--;for(;0<Ee-he;)le=et(le),Ee--;for(;he--;){if(ue===le||le!==null&&ue===le.alternate){et=ue;break t}ue=et(ue),le=et(le)}et=null}else et=null;we!==null&&wh(ke,ve,we,et,!1),Be!==null&&Nt!==null&&wh(ke,Nt,Be,et,!0)}}e:{if(ve=ye?kn(ye):window,we=ve.nodeName&&ve.nodeName.toLowerCase(),we==="select"||we==="input"&&ve.type==="file")var _t=qu;else if($u(ve))if(Lu)_t=s_;else{_t=r_;var We=o_}else we=ve.nodeName,!we||we.toLowerCase()!=="input"||ve.type!=="checkbox"&&ve.type!=="radio"?ye&&Ht(ye.elementType)&&(_t=qu):_t=l_;if(_t&&(_t=_t(e,ye))){Iu(ke,_t,l,Ce);break e}We&&We(e,ve,ye),e==="focusout"&&ye&&ve.type==="number"&&ye.memoizedProps.value!=null&&po(ve,"number",ve.value)}switch(We=ye?kn(ye):window,e){case"focusin":($u(We)||We.contentEditable==="true")&&(Er=We,Wc=ye,xl=null);break;case"focusout":xl=Wc=Er=null;break;case"mousedown":Qc=!0;break;case"contextmenu":case"mouseup":case"dragend":Qc=!1,Bu(ke,l,Ce);break;case"selectionchange":if(i_)break;case"keydown":case"keyup":Bu(ke,l,Ce)}var st;if(zc)e:{switch(e){case"compositionstart":var yt="onCompositionStart";break e;case"compositionend":yt="onCompositionEnd";break e;case"compositionupdate":yt="onCompositionUpdate";break e}yt=void 0}else br?Au(e,l)&&(yt="onCompositionEnd"):e==="keydown"&&l.keyCode===229&&(yt="onCompositionStart");yt&&(Tu&&l.locale!=="ko"&&(br||yt!=="onCompositionStart"?yt==="onCompositionEnd"&&br&&(st=bu()):(wo=Ce,Uc="value"in wo?wo.value:wo.textContent,br=!0)),We=rc(ye,yt),0<We.length&&(yt=new ku(yt,e,null,l,Ce),ke.push({event:yt,listeners:We}),st?yt.data=st:(st=Fu(l),st!==null&&(yt.data=st)))),(st=Jv?e_(e,l):t_(e,l))&&(yt=rc(ye,"onBeforeInput"),0<yt.length&&(We=new ku("onBeforeInput","beforeinput",null,l,Ce),ke.push({event:We,listeners:yt}),We.data=st)),G_(ke,e,ye,l,Ce)}vh(ke,a)})}function Gl(e,a,l){return{instance:e,listener:a,currentTarget:l}}function rc(e,a){for(var l=a+"Capture",i=[];e!==null;){var v=e,S=v.stateNode;if(v=v.tag,v!==5&&v!==26&&v!==27||S===null||(v=Ia(e,l),v!=null&&i.unshift(Gl(e,v,S)),v=Ia(e,a),v!=null&&i.push(Gl(e,v,S))),e.tag===3)return i;e=e.return}return[]}function X_(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5&&e.tag!==27);return e||null}function wh(e,a,l,i,v){for(var S=a._reactName,A=[];l!==null&&l!==i;){var Y=l,re=Y.alternate,ye=Y.stateNode;if(Y=Y.tag,re!==null&&re===i)break;Y!==5&&Y!==26&&Y!==27||ye===null||(re=ye,v?(ye=Ia(l,S),ye!=null&&A.unshift(Gl(l,ye,re))):v||(ye=Ia(l,S),ye!=null&&A.push(Gl(l,ye,re)))),l=l.return}A.length!==0&&e.push({event:a,listeners:A})}var Z_=/\r\n?/g,K_=/\u0000|\uFFFD/g;function xh(e){return(typeof e=="string"?e:""+e).replace(Z_,`
`).replace(K_,"")}function Ch(e,a){return a=xh(a),xh(e)===a}function kt(e,a,l,i,v,S){switch(l){case"children":typeof i=="string"?a==="body"||a==="textarea"&&i===""||aa(e,i):(typeof i=="number"||typeof i=="bigint")&&a!=="body"&&aa(e,""+i);break;case"className":Ye(e,"class",i);break;case"tabIndex":Ye(e,"tabindex",i);break;case"dir":case"role":case"viewBox":case"width":case"height":Ye(e,l,i);break;case"style":yo(e,i,S);break;case"data":if(a!=="object"){Ye(e,"data",i);break}case"src":case"href":if(i===""&&(a!=="a"||l!=="href")){e.removeAttribute(l);break}if(i==null||typeof i=="function"||typeof i=="symbol"||typeof i=="boolean"){e.removeAttribute(l);break}i=Ya(""+i),e.setAttribute(l,i);break;case"action":case"formAction":if(typeof i=="function"){e.setAttribute(l,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof S=="function"&&(l==="formAction"?(a!=="input"&&kt(e,a,"name",v.name,v,null),kt(e,a,"formEncType",v.formEncType,v,null),kt(e,a,"formMethod",v.formMethod,v,null),kt(e,a,"formTarget",v.formTarget,v,null)):(kt(e,a,"encType",v.encType,v,null),kt(e,a,"method",v.method,v,null),kt(e,a,"target",v.target,v,null)));if(i==null||typeof i=="symbol"||typeof i=="boolean"){e.removeAttribute(l);break}i=Ya(""+i),e.setAttribute(l,i);break;case"onClick":i!=null&&(e.onclick=Nn);break;case"onScroll":i!=null&&ht("scroll",e);break;case"onScrollEnd":i!=null&&ht("scrollend",e);break;case"dangerouslySetInnerHTML":if(i!=null){if(typeof i!="object"||!("__html"in i))throw Error(c(61));if(l=i.__html,l!=null){if(v.children!=null)throw Error(c(60));e.innerHTML=l}}break;case"multiple":e.multiple=i&&typeof i!="function"&&typeof i!="symbol";break;case"muted":e.muted=i&&typeof i!="function"&&typeof i!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(i==null||typeof i=="function"||typeof i=="boolean"||typeof i=="symbol"){e.removeAttribute("xlink:href");break}l=Ya(""+i),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",l);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":i!=null&&typeof i!="function"&&typeof i!="symbol"?e.setAttribute(l,""+i):e.removeAttribute(l);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":i&&typeof i!="function"&&typeof i!="symbol"?e.setAttribute(l,""):e.removeAttribute(l);break;case"capture":case"download":i===!0?e.setAttribute(l,""):i!==!1&&i!=null&&typeof i!="function"&&typeof i!="symbol"?e.setAttribute(l,i):e.removeAttribute(l);break;case"cols":case"rows":case"size":case"span":i!=null&&typeof i!="function"&&typeof i!="symbol"&&!isNaN(i)&&1<=i?e.setAttribute(l,i):e.removeAttribute(l);break;case"rowSpan":case"start":i==null||typeof i=="function"||typeof i=="symbol"||isNaN(i)?e.removeAttribute(l):e.setAttribute(l,i);break;case"popover":ht("beforetoggle",e),ht("toggle",e),ze(e,"popover",i);break;case"xlinkActuate":me(e,"http://www.w3.org/1999/xlink","xlink:actuate",i);break;case"xlinkArcrole":me(e,"http://www.w3.org/1999/xlink","xlink:arcrole",i);break;case"xlinkRole":me(e,"http://www.w3.org/1999/xlink","xlink:role",i);break;case"xlinkShow":me(e,"http://www.w3.org/1999/xlink","xlink:show",i);break;case"xlinkTitle":me(e,"http://www.w3.org/1999/xlink","xlink:title",i);break;case"xlinkType":me(e,"http://www.w3.org/1999/xlink","xlink:type",i);break;case"xmlBase":me(e,"http://www.w3.org/XML/1998/namespace","xml:base",i);break;case"xmlLang":me(e,"http://www.w3.org/XML/1998/namespace","xml:lang",i);break;case"xmlSpace":me(e,"http://www.w3.org/XML/1998/namespace","xml:space",i);break;case"is":ze(e,"is",i);break;case"innerText":case"textContent":break;default:(!(2<l.length)||l[0]!=="o"&&l[0]!=="O"||l[1]!=="n"&&l[1]!=="N")&&(l=Cr.get(l)||l,ze(e,l,i))}}function wd(e,a,l,i,v,S){switch(l){case"style":yo(e,i,S);break;case"dangerouslySetInnerHTML":if(i!=null){if(typeof i!="object"||!("__html"in i))throw Error(c(61));if(l=i.__html,l!=null){if(v.children!=null)throw Error(c(60));e.innerHTML=l}}break;case"children":typeof i=="string"?aa(e,i):(typeof i=="number"||typeof i=="bigint")&&aa(e,""+i);break;case"onScroll":i!=null&&ht("scroll",e);break;case"onScrollEnd":i!=null&&ht("scrollend",e);break;case"onClick":i!=null&&(e.onclick=Nn);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Ca.hasOwnProperty(l))e:{if(l[0]==="o"&&l[1]==="n"&&(v=l.endsWith("Capture"),a=l.slice(2,v?l.length-7:void 0),S=e[Mt]||null,S=S!=null?S[l]:null,typeof S=="function"&&e.removeEventListener(a,S,v),typeof i=="function")){typeof S!="function"&&S!==null&&(l in e?e[l]=null:e.hasAttribute(l)&&e.removeAttribute(l)),e.addEventListener(a,i,v);break e}l in e?e[l]=i:i===!0?e.setAttribute(l,""):ze(e,l,i)}}}function cn(e,a,l){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":ht("error",e),ht("load",e);var i=!1,v=!1,S;for(S in l)if(l.hasOwnProperty(S)){var A=l[S];if(A!=null)switch(S){case"src":i=!0;break;case"srcSet":v=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(c(137,a));default:kt(e,a,S,A,l,null)}}v&&kt(e,a,"srcSet",l.srcSet,l,null),i&&kt(e,a,"src",l.src,l,null);return;case"input":ht("invalid",e);var Y=S=A=v=null,re=null,ye=null;for(i in l)if(l.hasOwnProperty(i)){var Ce=l[i];if(Ce!=null)switch(i){case"name":v=Ce;break;case"type":A=Ce;break;case"checked":re=Ce;break;case"defaultChecked":ye=Ce;break;case"value":S=Ce;break;case"defaultValue":Y=Ce;break;case"children":case"dangerouslySetInnerHTML":if(Ce!=null)throw Error(c(137,a));break;default:kt(e,a,i,Ce,l,null)}}Hn(e,S,Y,re,ye,A,v,!1);return;case"select":ht("invalid",e),i=A=S=null;for(v in l)if(l.hasOwnProperty(v)&&(Y=l[v],Y!=null))switch(v){case"value":S=Y;break;case"defaultValue":A=Y;break;case"multiple":i=Y;default:kt(e,a,v,Y,l,null)}a=S,l=A,e.multiple=!!i,a!=null?$a(e,!!i,a,!1):l!=null&&$a(e,!!i,l,!0);return;case"textarea":ht("invalid",e),S=v=i=null;for(A in l)if(l.hasOwnProperty(A)&&(Y=l[A],Y!=null))switch(A){case"value":i=Y;break;case"defaultValue":v=Y;break;case"children":S=Y;break;case"dangerouslySetInnerHTML":if(Y!=null)throw Error(c(91));break;default:kt(e,a,A,Y,l,null)}ho(e,i,v,S);return;case"option":for(re in l)if(l.hasOwnProperty(re)&&(i=l[re],i!=null))switch(re){case"selected":e.selected=i&&typeof i!="function"&&typeof i!="symbol";break;default:kt(e,a,re,i,l,null)}return;case"dialog":ht("beforetoggle",e),ht("toggle",e),ht("cancel",e),ht("close",e);break;case"iframe":case"object":ht("load",e);break;case"video":case"audio":for(i=0;i<Bl.length;i++)ht(Bl[i],e);break;case"image":ht("error",e),ht("load",e);break;case"details":ht("toggle",e);break;case"embed":case"source":case"link":ht("error",e),ht("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(ye in l)if(l.hasOwnProperty(ye)&&(i=l[ye],i!=null))switch(ye){case"children":case"dangerouslySetInnerHTML":throw Error(c(137,a));default:kt(e,a,ye,i,l,null)}return;default:if(Ht(a)){for(Ce in l)l.hasOwnProperty(Ce)&&(i=l[Ce],i!==void 0&&wd(e,a,Ce,i,l,void 0));return}}for(Y in l)l.hasOwnProperty(Y)&&(i=l[Y],i!=null&&kt(e,a,Y,i,l,null))}function J_(e,a,l,i){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var v=null,S=null,A=null,Y=null,re=null,ye=null,Ce=null;for(we in l){var ke=l[we];if(l.hasOwnProperty(we)&&ke!=null)switch(we){case"checked":break;case"value":break;case"defaultValue":re=ke;default:i.hasOwnProperty(we)||kt(e,a,we,null,i,ke)}}for(var ve in i){var we=i[ve];if(ke=l[ve],i.hasOwnProperty(ve)&&(we!=null||ke!=null))switch(ve){case"type":S=we;break;case"name":v=we;break;case"checked":ye=we;break;case"defaultChecked":Ce=we;break;case"value":A=we;break;case"defaultValue":Y=we;break;case"children":case"dangerouslySetInnerHTML":if(we!=null)throw Error(c(137,a));break;default:we!==ke&&kt(e,a,ve,we,i,ke)}}Sa(e,A,Y,re,ye,Ce,S,v);return;case"select":we=A=Y=ve=null;for(S in l)if(re=l[S],l.hasOwnProperty(S)&&re!=null)switch(S){case"value":break;case"multiple":we=re;default:i.hasOwnProperty(S)||kt(e,a,S,null,i,re)}for(v in i)if(S=i[v],re=l[v],i.hasOwnProperty(v)&&(S!=null||re!=null))switch(v){case"value":ve=S;break;case"defaultValue":Y=S;break;case"multiple":A=S;default:S!==re&&kt(e,a,v,S,i,re)}a=Y,l=A,i=we,ve!=null?$a(e,!!l,ve,!1):!!i!=!!l&&(a!=null?$a(e,!!l,a,!0):$a(e,!!l,l?[]:"",!1));return;case"textarea":we=ve=null;for(Y in l)if(v=l[Y],l.hasOwnProperty(Y)&&v!=null&&!i.hasOwnProperty(Y))switch(Y){case"value":break;case"children":break;default:kt(e,a,Y,null,i,v)}for(A in i)if(v=i[A],S=l[A],i.hasOwnProperty(A)&&(v!=null||S!=null))switch(A){case"value":ve=v;break;case"defaultValue":we=v;break;case"children":break;case"dangerouslySetInnerHTML":if(v!=null)throw Error(c(91));break;default:v!==S&&kt(e,a,A,v,i,S)}fo(e,ve,we);return;case"option":for(var Be in l)if(ve=l[Be],l.hasOwnProperty(Be)&&ve!=null&&!i.hasOwnProperty(Be))switch(Be){case"selected":e.selected=!1;break;default:kt(e,a,Be,null,i,ve)}for(re in i)if(ve=i[re],we=l[re],i.hasOwnProperty(re)&&ve!==we&&(ve!=null||we!=null))switch(re){case"selected":e.selected=ve&&typeof ve!="function"&&typeof ve!="symbol";break;default:kt(e,a,re,ve,i,we)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var et in l)ve=l[et],l.hasOwnProperty(et)&&ve!=null&&!i.hasOwnProperty(et)&&kt(e,a,et,null,i,ve);for(ye in i)if(ve=i[ye],we=l[ye],i.hasOwnProperty(ye)&&ve!==we&&(ve!=null||we!=null))switch(ye){case"children":case"dangerouslySetInnerHTML":if(ve!=null)throw Error(c(137,a));break;default:kt(e,a,ye,ve,i,we)}return;default:if(Ht(a)){for(var Nt in l)ve=l[Nt],l.hasOwnProperty(Nt)&&ve!==void 0&&!i.hasOwnProperty(Nt)&&wd(e,a,Nt,void 0,i,ve);for(Ce in i)ve=i[Ce],we=l[Ce],!i.hasOwnProperty(Ce)||ve===we||ve===void 0&&we===void 0||wd(e,a,Ce,ve,i,we);return}}for(var ue in l)ve=l[ue],l.hasOwnProperty(ue)&&ve!=null&&!i.hasOwnProperty(ue)&&kt(e,a,ue,null,i,ve);for(ke in i)ve=i[ke],we=l[ke],!i.hasOwnProperty(ke)||ve===we||ve==null&&we==null||kt(e,a,ke,ve,i,we)}function Sh(e){switch(e){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function e0(){if(typeof performance.getEntriesByType=="function"){for(var e=0,a=0,l=performance.getEntriesByType("resource"),i=0;i<l.length;i++){var v=l[i],S=v.transferSize,A=v.initiatorType,Y=v.duration;if(S&&Y&&Sh(A)){for(A=0,Y=v.responseEnd,i+=1;i<l.length;i++){var re=l[i],ye=re.startTime;if(ye>Y)break;var Ce=re.transferSize,ke=re.initiatorType;Ce&&Sh(ke)&&(re=re.responseEnd,A+=Ce*(re<Y?1:(Y-ye)/(re-ye)))}if(--i,a+=8*(S+A)/(v.duration/1e3),e++,10<e)break}}if(0<e)return a/e/1e6}return navigator.connection&&(e=navigator.connection.downlink,typeof e=="number")?e:5}var xd=null,Cd=null;function lc(e){return e.nodeType===9?e:e.ownerDocument}function bh(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Eh(e,a){if(e===0)switch(a){case"svg":return 1;case"math":return 2;default:return 0}return e===1&&a==="foreignObject"?0:e}function Sd(e,a){return e==="textarea"||e==="noscript"||typeof a.children=="string"||typeof a.children=="number"||typeof a.children=="bigint"||typeof a.dangerouslySetInnerHTML=="object"&&a.dangerouslySetInnerHTML!==null&&a.dangerouslySetInnerHTML.__html!=null}var bd=null;function t0(){var e=window.event;return e&&e.type==="popstate"?e===bd?!1:(bd=e,!0):(bd=null,!1)}var jh=typeof setTimeout=="function"?setTimeout:void 0,n0=typeof clearTimeout=="function"?clearTimeout:void 0,kh=typeof Promise=="function"?Promise:void 0,a0=typeof queueMicrotask=="function"?queueMicrotask:typeof kh<"u"?function(e){return kh.resolve(null).then(e).catch(o0)}:jh;function o0(e){setTimeout(function(){throw e})}function Lo(e){return e==="head"}function Nh(e,a){var l=a,i=0;do{var v=l.nextSibling;if(e.removeChild(l),v&&v.nodeType===8)if(l=v.data,l==="/$"||l==="/&"){if(i===0){e.removeChild(v),Kr(a);return}i--}else if(l==="$"||l==="$?"||l==="$~"||l==="$!"||l==="&")i++;else if(l==="html")Yl(e.ownerDocument.documentElement);else if(l==="head"){l=e.ownerDocument.head,Yl(l);for(var S=l.firstChild;S;){var A=S.nextSibling,Y=S.nodeName;S[Vn]||Y==="SCRIPT"||Y==="STYLE"||Y==="LINK"&&S.rel.toLowerCase()==="stylesheet"||l.removeChild(S),S=A}}else l==="body"&&Yl(e.ownerDocument.body);l=v}while(l);Kr(a)}function Th(e,a){var l=e;e=0;do{var i=l.nextSibling;if(l.nodeType===1?a?(l._stashedDisplay=l.style.display,l.style.display="none"):(l.style.display=l._stashedDisplay||"",l.getAttribute("style")===""&&l.removeAttribute("style")):l.nodeType===3&&(a?(l._stashedText=l.nodeValue,l.nodeValue=""):l.nodeValue=l._stashedText||""),i&&i.nodeType===8)if(l=i.data,l==="/$"){if(e===0)break;e--}else l!=="$"&&l!=="$?"&&l!=="$~"&&l!=="$!"||e++;l=i}while(l)}function Ed(e){var a=e.firstChild;for(a&&a.nodeType===10&&(a=a.nextSibling);a;){var l=a;switch(a=a.nextSibling,l.nodeName){case"HTML":case"HEAD":case"BODY":Ed(l),na(l);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(l.rel.toLowerCase()==="stylesheet")continue}e.removeChild(l)}}function r0(e,a,l,i){for(;e.nodeType===1;){var v=l;if(e.nodeName.toLowerCase()!==a.toLowerCase()){if(!i&&(e.nodeName!=="INPUT"||e.type!=="hidden"))break}else if(i){if(!e[Vn])switch(a){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if(S=e.getAttribute("rel"),S==="stylesheet"&&e.hasAttribute("data-precedence"))break;if(S!==v.rel||e.getAttribute("href")!==(v.href==null||v.href===""?null:v.href)||e.getAttribute("crossorigin")!==(v.crossOrigin==null?null:v.crossOrigin)||e.getAttribute("title")!==(v.title==null?null:v.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(S=e.getAttribute("src"),(S!==(v.src==null?null:v.src)||e.getAttribute("type")!==(v.type==null?null:v.type)||e.getAttribute("crossorigin")!==(v.crossOrigin==null?null:v.crossOrigin))&&S&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else if(a==="input"&&e.type==="hidden"){var S=v.name==null?null:""+v.name;if(v.type==="hidden"&&e.getAttribute("name")===S)return e}else return e;if(e=ua(e.nextSibling),e===null)break}return null}function l0(e,a,l){if(a==="")return null;for(;e.nodeType!==3;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!l||(e=ua(e.nextSibling),e===null))return null;return e}function Rh(e,a){for(;e.nodeType!==8;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!a||(e=ua(e.nextSibling),e===null))return null;return e}function jd(e){return e.data==="$?"||e.data==="$~"}function kd(e){return e.data==="$!"||e.data==="$?"&&e.ownerDocument.readyState!=="loading"}function s0(e,a){var l=e.ownerDocument;if(e.data==="$~")e._reactRetry=a;else if(e.data!=="$?"||l.readyState!=="loading")a();else{var i=function(){a(),l.removeEventListener("DOMContentLoaded",i)};l.addEventListener("DOMContentLoaded",i),e._reactRetry=i}}function ua(e){for(;e!=null;e=e.nextSibling){var a=e.nodeType;if(a===1||a===3)break;if(a===8){if(a=e.data,a==="$"||a==="$!"||a==="$?"||a==="$~"||a==="&"||a==="F!"||a==="F")break;if(a==="/$"||a==="/&")return null}}return e}var Nd=null;function Dh(e){e=e.nextSibling;for(var a=0;e;){if(e.nodeType===8){var l=e.data;if(l==="/$"||l==="/&"){if(a===0)return ua(e.nextSibling);a--}else l!=="$"&&l!=="$!"&&l!=="$?"&&l!=="$~"&&l!=="&"||a++}e=e.nextSibling}return null}function Ah(e){e=e.previousSibling;for(var a=0;e;){if(e.nodeType===8){var l=e.data;if(l==="$"||l==="$!"||l==="$?"||l==="$~"||l==="&"){if(a===0)return e;a--}else l!=="/$"&&l!=="/&"||a++}e=e.previousSibling}return null}function Fh(e,a,l){switch(a=lc(l),e){case"html":if(e=a.documentElement,!e)throw Error(c(452));return e;case"head":if(e=a.head,!e)throw Error(c(453));return e;case"body":if(e=a.body,!e)throw Error(c(454));return e;default:throw Error(c(451))}}function Yl(e){for(var a=e.attributes;a.length;)e.removeAttributeNode(a[0]);na(e)}var pa=new Map,$h=new Set;function sc(e){return typeof e.getRootNode=="function"?e.getRootNode():e.nodeType===9?e:e.ownerDocument}var co=R.d;R.d={f:c0,r:i0,D:d0,C:u0,L:p0,m:f0,X:m0,S:h0,M:y0};function c0(){var e=co.f(),a=Ks();return e||a}function i0(e){var a=_n(e);a!==null&&a.tag===5&&a.type==="form"?Xp(a):co.r(e)}var Qr=typeof document>"u"?null:document;function Ih(e,a,l){var i=Qr;if(i&&typeof a=="string"&&a){var v=Vt(a);v='link[rel="'+e+'"][href="'+v+'"]',typeof l=="string"&&(v+='[crossorigin="'+l+'"]'),$h.has(v)||($h.add(v),e={rel:e,crossOrigin:l,href:a},i.querySelector(v)===null&&(a=i.createElement("link"),cn(a,"link",e),Tt(a),i.head.appendChild(a)))}}function d0(e){co.D(e),Ih("dns-prefetch",e,null)}function u0(e,a){co.C(e,a),Ih("preconnect",e,a)}function p0(e,a,l){co.L(e,a,l);var i=Qr;if(i&&e&&a){var v='link[rel="preload"][as="'+Vt(a)+'"]';a==="image"&&l&&l.imageSrcSet?(v+='[imagesrcset="'+Vt(l.imageSrcSet)+'"]',typeof l.imageSizes=="string"&&(v+='[imagesizes="'+Vt(l.imageSizes)+'"]')):v+='[href="'+Vt(e)+'"]';var S=v;switch(a){case"style":S=Xr(e);break;case"script":S=Zr(e)}pa.has(S)||(e=y({rel:"preload",href:a==="image"&&l&&l.imageSrcSet?void 0:e,as:a},l),pa.set(S,e),i.querySelector(v)!==null||a==="style"&&i.querySelector(Wl(S))||a==="script"&&i.querySelector(Ql(S))||(a=i.createElement("link"),cn(a,"link",e),Tt(a),i.head.appendChild(a)))}}function f0(e,a){co.m(e,a);var l=Qr;if(l&&e){var i=a&&typeof a.as=="string"?a.as:"script",v='link[rel="modulepreload"][as="'+Vt(i)+'"][href="'+Vt(e)+'"]',S=v;switch(i){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":S=Zr(e)}if(!pa.has(S)&&(e=y({rel:"modulepreload",href:e},a),pa.set(S,e),l.querySelector(v)===null)){switch(i){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(l.querySelector(Ql(S)))return}i=l.createElement("link"),cn(i,"link",e),Tt(i),l.head.appendChild(i)}}}function h0(e,a,l){co.S(e,a,l);var i=Qr;if(i&&e){var v=wn(i).hoistableStyles,S=Xr(e);a=a||"default";var A=v.get(S);if(!A){var Y={loading:0,preload:null};if(A=i.querySelector(Wl(S)))Y.loading=5;else{e=y({rel:"stylesheet",href:e,"data-precedence":a},l),(l=pa.get(S))&&Td(e,l);var re=A=i.createElement("link");Tt(re),cn(re,"link",e),re._p=new Promise(function(ye,Ce){re.onload=ye,re.onerror=Ce}),re.addEventListener("load",function(){Y.loading|=1}),re.addEventListener("error",function(){Y.loading|=2}),Y.loading|=4,cc(A,a,i)}A={type:"stylesheet",instance:A,count:1,state:Y},v.set(S,A)}}}function m0(e,a){co.X(e,a);var l=Qr;if(l&&e){var i=wn(l).hoistableScripts,v=Zr(e),S=i.get(v);S||(S=l.querySelector(Ql(v)),S||(e=y({src:e,async:!0},a),(a=pa.get(v))&&Rd(e,a),S=l.createElement("script"),Tt(S),cn(S,"link",e),l.head.appendChild(S)),S={type:"script",instance:S,count:1,state:null},i.set(v,S))}}function y0(e,a){co.M(e,a);var l=Qr;if(l&&e){var i=wn(l).hoistableScripts,v=Zr(e),S=i.get(v);S||(S=l.querySelector(Ql(v)),S||(e=y({src:e,async:!0,type:"module"},a),(a=pa.get(v))&&Rd(e,a),S=l.createElement("script"),Tt(S),cn(S,"link",e),l.head.appendChild(S)),S={type:"script",instance:S,count:1,state:null},i.set(v,S))}}function qh(e,a,l,i){var v=(v=ee.current)?sc(v):null;if(!v)throw Error(c(446));switch(e){case"meta":case"title":return null;case"style":return typeof l.precedence=="string"&&typeof l.href=="string"?(a=Xr(l.href),l=wn(v).hoistableStyles,i=l.get(a),i||(i={type:"style",instance:null,count:0,state:null},l.set(a,i)),i):{type:"void",instance:null,count:0,state:null};case"link":if(l.rel==="stylesheet"&&typeof l.href=="string"&&typeof l.precedence=="string"){e=Xr(l.href);var S=wn(v).hoistableStyles,A=S.get(e);if(A||(v=v.ownerDocument||v,A={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},S.set(e,A),(S=v.querySelector(Wl(e)))&&!S._p&&(A.instance=S,A.state.loading=5),pa.has(e)||(l={rel:"preload",as:"style",href:l.href,crossOrigin:l.crossOrigin,integrity:l.integrity,media:l.media,hrefLang:l.hrefLang,referrerPolicy:l.referrerPolicy},pa.set(e,l),S||g0(v,e,l,A.state))),a&&i===null)throw Error(c(528,""));return A}if(a&&i!==null)throw Error(c(529,""));return null;case"script":return a=l.async,l=l.src,typeof l=="string"&&a&&typeof a!="function"&&typeof a!="symbol"?(a=Zr(l),l=wn(v).hoistableScripts,i=l.get(a),i||(i={type:"script",instance:null,count:0,state:null},l.set(a,i)),i):{type:"void",instance:null,count:0,state:null};default:throw Error(c(444,e))}}function Xr(e){return'href="'+Vt(e)+'"'}function Wl(e){return'link[rel="stylesheet"]['+e+"]"}function Lh(e){return y({},e,{"data-precedence":e.precedence,precedence:null})}function g0(e,a,l,i){e.querySelector('link[rel="preload"][as="style"]['+a+"]")?i.loading=1:(a=e.createElement("link"),i.preload=a,a.addEventListener("load",function(){return i.loading|=1}),a.addEventListener("error",function(){return i.loading|=2}),cn(a,"link",l),Tt(a),e.head.appendChild(a))}function Zr(e){return'[src="'+Vt(e)+'"]'}function Ql(e){return"script[async]"+e}function Ph(e,a,l){if(a.count++,a.instance===null)switch(a.type){case"style":var i=e.querySelector('style[data-href~="'+Vt(l.href)+'"]');if(i)return a.instance=i,Tt(i),i;var v=y({},l,{"data-href":l.href,"data-precedence":l.precedence,href:null,precedence:null});return i=(e.ownerDocument||e).createElement("style"),Tt(i),cn(i,"style",v),cc(i,l.precedence,e),a.instance=i;case"stylesheet":v=Xr(l.href);var S=e.querySelector(Wl(v));if(S)return a.state.loading|=4,a.instance=S,Tt(S),S;i=Lh(l),(v=pa.get(v))&&Td(i,v),S=(e.ownerDocument||e).createElement("link"),Tt(S);var A=S;return A._p=new Promise(function(Y,re){A.onload=Y,A.onerror=re}),cn(S,"link",i),a.state.loading|=4,cc(S,l.precedence,e),a.instance=S;case"script":return S=Zr(l.src),(v=e.querySelector(Ql(S)))?(a.instance=v,Tt(v),v):(i=l,(v=pa.get(S))&&(i=y({},l),Rd(i,v)),e=e.ownerDocument||e,v=e.createElement("script"),Tt(v),cn(v,"link",i),e.head.appendChild(v),a.instance=v);case"void":return null;default:throw Error(c(443,a.type))}else a.type==="stylesheet"&&(a.state.loading&4)===0&&(i=a.instance,a.state.loading|=4,cc(i,l.precedence,e));return a.instance}function cc(e,a,l){for(var i=l.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),v=i.length?i[i.length-1]:null,S=v,A=0;A<i.length;A++){var Y=i[A];if(Y.dataset.precedence===a)S=Y;else if(S!==v)break}S?S.parentNode.insertBefore(e,S.nextSibling):(a=l.nodeType===9?l.head:l,a.insertBefore(e,a.firstChild))}function Td(e,a){e.crossOrigin==null&&(e.crossOrigin=a.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=a.referrerPolicy),e.title==null&&(e.title=a.title)}function Rd(e,a){e.crossOrigin==null&&(e.crossOrigin=a.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=a.referrerPolicy),e.integrity==null&&(e.integrity=a.integrity)}var ic=null;function Uh(e,a,l){if(ic===null){var i=new Map,v=ic=new Map;v.set(l,i)}else v=ic,i=v.get(l),i||(i=new Map,v.set(l,i));if(i.has(e))return i;for(i.set(e,null),l=l.getElementsByTagName(e),v=0;v<l.length;v++){var S=l[v];if(!(S[Vn]||S[$t]||e==="link"&&S.getAttribute("rel")==="stylesheet")&&S.namespaceURI!=="http://www.w3.org/2000/svg"){var A=S.getAttribute(a)||"";A=e+A;var Y=i.get(A);Y?Y.push(S):i.set(A,[S])}}return i}function Oh(e,a,l){e=e.ownerDocument||e,e.head.insertBefore(l,a==="title"?e.querySelector("head > title"):null)}function v0(e,a,l){if(l===1||a.itemProp!=null)return!1;switch(e){case"meta":case"title":return!0;case"style":if(typeof a.precedence!="string"||typeof a.href!="string"||a.href==="")break;return!0;case"link":if(typeof a.rel!="string"||typeof a.href!="string"||a.href===""||a.onLoad||a.onError)break;switch(a.rel){case"stylesheet":return e=a.disabled,typeof a.precedence=="string"&&e==null;default:return!0}case"script":if(a.async&&typeof a.async!="function"&&typeof a.async!="symbol"&&!a.onLoad&&!a.onError&&a.src&&typeof a.src=="string")return!0}return!1}function Mh(e){return!(e.type==="stylesheet"&&(e.state.loading&3)===0)}function _0(e,a,l,i){if(l.type==="stylesheet"&&(typeof i.media!="string"||matchMedia(i.media).matches!==!1)&&(l.state.loading&4)===0){if(l.instance===null){var v=Xr(i.href),S=a.querySelector(Wl(v));if(S){a=S._p,a!==null&&typeof a=="object"&&typeof a.then=="function"&&(e.count++,e=dc.bind(e),a.then(e,e)),l.state.loading|=4,l.instance=S,Tt(S);return}S=a.ownerDocument||a,i=Lh(i),(v=pa.get(v))&&Td(i,v),S=S.createElement("link"),Tt(S);var A=S;A._p=new Promise(function(Y,re){A.onload=Y,A.onerror=re}),cn(S,"link",i),l.instance=S}e.stylesheets===null&&(e.stylesheets=new Map),e.stylesheets.set(l,a),(a=l.state.preload)&&(l.state.loading&3)===0&&(e.count++,l=dc.bind(e),a.addEventListener("load",l),a.addEventListener("error",l))}}var Dd=0;function w0(e,a){return e.stylesheets&&e.count===0&&pc(e,e.stylesheets),0<e.count||0<e.imgCount?function(l){var i=setTimeout(function(){if(e.stylesheets&&pc(e,e.stylesheets),e.unsuspend){var S=e.unsuspend;e.unsuspend=null,S()}},6e4+a);0<e.imgBytes&&Dd===0&&(Dd=62500*e0());var v=setTimeout(function(){if(e.waitingForImages=!1,e.count===0&&(e.stylesheets&&pc(e,e.stylesheets),e.unsuspend)){var S=e.unsuspend;e.unsuspend=null,S()}},(e.imgBytes>Dd?50:800)+a);return e.unsuspend=l,function(){e.unsuspend=null,clearTimeout(i),clearTimeout(v)}}:null}function dc(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)pc(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}}var uc=null;function pc(e,a){e.stylesheets=null,e.unsuspend!==null&&(e.count++,uc=new Map,a.forEach(x0,e),uc=null,dc.call(e))}function x0(e,a){if(!(a.state.loading&4)){var l=uc.get(e);if(l)var i=l.get(null);else{l=new Map,uc.set(e,l);for(var v=e.querySelectorAll("link[data-precedence],style[data-precedence]"),S=0;S<v.length;S++){var A=v[S];(A.nodeName==="LINK"||A.getAttribute("media")!=="not all")&&(l.set(A.dataset.precedence,A),i=A)}i&&l.set(null,i)}v=a.instance,A=v.getAttribute("data-precedence"),S=l.get(A)||i,S===i&&l.set(null,v),l.set(A,v),this.count++,i=dc.bind(this),v.addEventListener("load",i),v.addEventListener("error",i),S?S.parentNode.insertBefore(v,S.nextSibling):(e=e.nodeType===9?e.head:e,e.insertBefore(v,e.firstChild)),a.state.loading|=4}}var Xl={$$typeof:E,Provider:null,Consumer:null,_currentValue:$,_currentValue2:$,_threadCount:0};function C0(e,a,l,i,v,S,A,Y,re){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=ga(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ga(0),this.hiddenUpdates=ga(null),this.identifierPrefix=i,this.onUncaughtError=v,this.onCaughtError=S,this.onRecoverableError=A,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=re,this.incompleteTransitions=new Map}function Vh(e,a,l,i,v,S,A,Y,re,ye,Ce,ke){return e=new C0(e,a,l,A,re,ye,Ce,ke,Y),a=1,S===!0&&(a|=24),S=Gn(3,null,null,a),e.current=S,S.stateNode=e,a=di(),a.refCount++,e.pooledCache=a,a.refCount++,S.memoizedState={element:i,isDehydrated:l,cache:a},hi(S),e}function Hh(e){return e?(e=Nr,e):Nr}function zh(e,a,l,i,v,S){v=Hh(v),i.context===null?i.context=v:i.pendingContext=v,i=jo(a),i.payload={element:l},S=S===void 0?null:S,S!==null&&(i.callback=S),l=ko(e,i,a),l!==null&&(In(l,e,a),Nl(l,e,a))}function Bh(e,a){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var l=e.retryLane;e.retryLane=l!==0&&l<a?l:a}}function Ad(e,a){Bh(e,a),(e=e.alternate)&&Bh(e,a)}function Gh(e){if(e.tag===13||e.tag===31){var a=tr(e,67108864);a!==null&&In(a,e,67108864),Ad(e,67108864)}}function Yh(e){if(e.tag===13||e.tag===31){var a=Zn();a=Mn(a);var l=tr(e,a);l!==null&&In(l,e,a),Ad(e,a)}}var fc=!0;function S0(e,a,l,i){var v=N.T;N.T=null;var S=R.p;try{R.p=2,Fd(e,a,l,i)}finally{R.p=S,N.T=v}}function b0(e,a,l,i){var v=N.T;N.T=null;var S=R.p;try{R.p=8,Fd(e,a,l,i)}finally{R.p=S,N.T=v}}function Fd(e,a,l,i){if(fc){var v=$d(i);if(v===null)_d(e,a,i,hc,l),Qh(e,i);else if(j0(v,e,a,l,i))i.stopPropagation();else if(Qh(e,i),a&4&&-1<E0.indexOf(e)){for(;v!==null;){var S=_n(v);if(S!==null)switch(S.tag){case 3:if(S=S.stateNode,S.current.memoizedState.isDehydrated){var A=gn(S.pendingLanes);if(A!==0){var Y=S;for(Y.pendingLanes|=2,Y.entangledLanes|=2;A;){var re=1<<31-Pt(A);Y.entanglements[1]|=re,A&=~re}Ua(S),(Ct&6)===0&&(Xs=qe()+500,zl(0))}}break;case 31:case 13:Y=tr(S,2),Y!==null&&In(Y,S,2),Ks(),Ad(S,2)}if(S=$d(i),S===null&&_d(e,a,i,hc,l),S===v)break;v=S}v!==null&&i.stopPropagation()}else _d(e,a,i,null,l)}}function $d(e){return e=vo(e),Id(e)}var hc=null;function Id(e){if(hc=null,e=vn(e),e!==null){var a=d(e);if(a===null)e=null;else{var l=a.tag;if(l===13){if(e=u(a),e!==null)return e;e=null}else if(l===31){if(e=p(a),e!==null)return e;e=null}else if(l===3){if(a.stateNode.current.memoizedState.isDehydrated)return a.tag===3?a.stateNode.containerInfo:null;e=null}else a!==e&&(e=null)}}return hc=e,null}function Wh(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Ne()){case Oe:return 2;case Le:return 8;case ut:case Qe:return 32;case Je:return 268435456;default:return 32}default:return 32}}var qd=!1,Po=null,Uo=null,Oo=null,Zl=new Map,Kl=new Map,Mo=[],E0="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Qh(e,a){switch(e){case"focusin":case"focusout":Po=null;break;case"dragenter":case"dragleave":Uo=null;break;case"mouseover":case"mouseout":Oo=null;break;case"pointerover":case"pointerout":Zl.delete(a.pointerId);break;case"gotpointercapture":case"lostpointercapture":Kl.delete(a.pointerId)}}function Jl(e,a,l,i,v,S){return e===null||e.nativeEvent!==S?(e={blockedOn:a,domEventName:l,eventSystemFlags:i,nativeEvent:S,targetContainers:[v]},a!==null&&(a=_n(a),a!==null&&Gh(a)),e):(e.eventSystemFlags|=i,a=e.targetContainers,v!==null&&a.indexOf(v)===-1&&a.push(v),e)}function j0(e,a,l,i,v){switch(a){case"focusin":return Po=Jl(Po,e,a,l,i,v),!0;case"dragenter":return Uo=Jl(Uo,e,a,l,i,v),!0;case"mouseover":return Oo=Jl(Oo,e,a,l,i,v),!0;case"pointerover":var S=v.pointerId;return Zl.set(S,Jl(Zl.get(S)||null,e,a,l,i,v)),!0;case"gotpointercapture":return S=v.pointerId,Kl.set(S,Jl(Kl.get(S)||null,e,a,l,i,v)),!0}return!1}function Xh(e){var a=vn(e.target);if(a!==null){var l=d(a);if(l!==null){if(a=l.tag,a===13){if(a=u(l),a!==null){e.blockedOn=a,Aa(e.priority,function(){Yh(l)});return}}else if(a===31){if(a=p(l),a!==null){e.blockedOn=a,Aa(e.priority,function(){Yh(l)});return}}else if(a===3&&l.stateNode.current.memoizedState.isDehydrated){e.blockedOn=l.tag===3?l.stateNode.containerInfo:null;return}}}e.blockedOn=null}function mc(e){if(e.blockedOn!==null)return!1;for(var a=e.targetContainers;0<a.length;){var l=$d(e.nativeEvent);if(l===null){l=e.nativeEvent;var i=new l.constructor(l.type,l);go=i,l.target.dispatchEvent(i),go=null}else return a=_n(l),a!==null&&Gh(a),e.blockedOn=l,!1;a.shift()}return!0}function Zh(e,a,l){mc(e)&&l.delete(a)}function k0(){qd=!1,Po!==null&&mc(Po)&&(Po=null),Uo!==null&&mc(Uo)&&(Uo=null),Oo!==null&&mc(Oo)&&(Oo=null),Zl.forEach(Zh),Kl.forEach(Zh)}function yc(e,a){e.blockedOn===a&&(e.blockedOn=null,qd||(qd=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,k0)))}var gc=null;function Kh(e){gc!==e&&(gc=e,t.unstable_scheduleCallback(t.unstable_NormalPriority,function(){gc===e&&(gc=null);for(var a=0;a<e.length;a+=3){var l=e[a],i=e[a+1],v=e[a+2];if(typeof i!="function"){if(Id(i||l)===null)continue;break}var S=_n(l);S!==null&&(e.splice(a,3),a-=3,$i(S,{pending:!0,data:v,method:l.method,action:i},i,v))}}))}function Kr(e){function a(re){return yc(re,e)}Po!==null&&yc(Po,e),Uo!==null&&yc(Uo,e),Oo!==null&&yc(Oo,e),Zl.forEach(a),Kl.forEach(a);for(var l=0;l<Mo.length;l++){var i=Mo[l];i.blockedOn===e&&(i.blockedOn=null)}for(;0<Mo.length&&(l=Mo[0],l.blockedOn===null);)Xh(l),l.blockedOn===null&&Mo.shift();if(l=(e.ownerDocument||e).$$reactFormReplay,l!=null)for(i=0;i<l.length;i+=3){var v=l[i],S=l[i+1],A=v[Mt]||null;if(typeof S=="function")A||Kh(l);else if(A){var Y=null;if(S&&S.hasAttribute("formAction")){if(v=S,A=S[Mt]||null)Y=A.formAction;else if(Id(v)!==null)continue}else Y=A.action;typeof Y=="function"?l[i+1]=Y:(l.splice(i,3),i-=3),Kh(l)}}}function Jh(){function e(S){S.canIntercept&&S.info==="react-transition"&&S.intercept({handler:function(){return new Promise(function(A){return v=A})},focusReset:"manual",scroll:"manual"})}function a(){v!==null&&(v(),v=null),i||setTimeout(l,20)}function l(){if(!i&&!navigation.transition){var S=navigation.currentEntry;S&&S.url!=null&&navigation.navigate(S.url,{state:S.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var i=!1,v=null;return navigation.addEventListener("navigate",e),navigation.addEventListener("navigatesuccess",a),navigation.addEventListener("navigateerror",a),setTimeout(l,100),function(){i=!0,navigation.removeEventListener("navigate",e),navigation.removeEventListener("navigatesuccess",a),navigation.removeEventListener("navigateerror",a),v!==null&&(v(),v=null)}}}function Ld(e){this._internalRoot=e}vc.prototype.render=Ld.prototype.render=function(e){var a=this._internalRoot;if(a===null)throw Error(c(409));var l=a.current,i=Zn();zh(l,i,e,a,null,null)},vc.prototype.unmount=Ld.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var a=e.containerInfo;zh(e.current,2,null,e,null,null),Ks(),a[jn]=null}};function vc(e){this._internalRoot=e}vc.prototype.unstable_scheduleHydration=function(e){if(e){var a=Da();e={blockedOn:null,target:e,priority:a};for(var l=0;l<Mo.length&&a!==0&&a<Mo[l].priority;l++);Mo.splice(l,0,e),l===0&&Xh(e)}};var em=n.version;if(em!=="19.2.3")throw Error(c(527,em,"19.2.3"));R.findDOMNode=function(e){var a=e._reactInternals;if(a===void 0)throw typeof e.render=="function"?Error(c(188)):(e=Object.keys(e).join(","),Error(c(268,e)));return e=h(a),e=e!==null?_(e):null,e=e===null?null:e.stateNode,e};var N0={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:N,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var _c=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!_c.isDisabled&&_c.supportsFiber)try{Gt=_c.inject(N0),Lt=_c}catch{}}return ts.createRoot=function(e,a){if(!s(e))throw Error(c(299));var l=!1,i="",v=lf,S=sf,A=cf;return a!=null&&(a.unstable_strictMode===!0&&(l=!0),a.identifierPrefix!==void 0&&(i=a.identifierPrefix),a.onUncaughtError!==void 0&&(v=a.onUncaughtError),a.onCaughtError!==void 0&&(S=a.onCaughtError),a.onRecoverableError!==void 0&&(A=a.onRecoverableError)),a=Vh(e,1,!1,null,null,l,i,null,v,S,A,Jh),e[jn]=a.current,vd(e),new Ld(a)},ts.hydrateRoot=function(e,a,l){if(!s(e))throw Error(c(299));var i=!1,v="",S=lf,A=sf,Y=cf,re=null;return l!=null&&(l.unstable_strictMode===!0&&(i=!0),l.identifierPrefix!==void 0&&(v=l.identifierPrefix),l.onUncaughtError!==void 0&&(S=l.onUncaughtError),l.onCaughtError!==void 0&&(A=l.onCaughtError),l.onRecoverableError!==void 0&&(Y=l.onRecoverableError),l.formState!==void 0&&(re=l.formState)),a=Vh(e,1,!0,a,l??null,i,v,re,S,A,Y,Jh),a.context=Hh(null),l=a.current,i=Zn(),i=Mn(i),v=jo(i),v.callback=null,ko(l,v,i),l=i,a.current.lanes=l,On(a,l),Ua(a),e[jn]=a.current,vd(e),new vc(a)},ts.version="19.2.3",ts}var dm;function P0(){if(dm)return Ud.exports;dm=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(n){console.error(n)}}return t(),Ud.exports=L0(),Ud.exports}var U0=P0(),ce=iu();/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const St=({card:t,onPointerDown:n,onPointerEnter:r,onPointerLeave:c,isFaceUp:s,faceDownValue:d=2,isSelected:u,isMultiSelected:p,isTargetable:f,isSourceOfEffect:h,style:_,additionalClassName:y,animationState:m})=>{const g=I=>I.replace(/<[^>]*>/g,"").length,x=({content:I,className:W})=>{const z=g(I),V=z>95,L=z>140?"very-long-text":V?"long-text":"";return o.jsx("div",{className:`card-rule-box ${W||""} ${L}`,dangerouslySetInnerHTML:{__html:I}})},b=(m==null?void 0:m.type)==="playCard"&&m.cardId===t.id?`is-entering-${m.owner}`:"",k=(m==null?void 0:m.type)==="deleteCard"&&m.cardId===t.id?`is-deleting-${m.owner}`:"",E=(m==null?void 0:m.type)==="drawCard"||(m==null?void 0:m.type)==="discardCard"?m.owner:void 0,T=E==="player"&&(m==null?void 0:m.type)==="drawCard"&&m.cardIds.includes(t.id),F=E==="player"&&(m==null?void 0:m.type)==="discardCard"&&m.cardIds.includes(t.id),U=["card-component"];t.protocol&&U.push(`card-protocol-${t.protocol.toLowerCase()}`),t.color&&U.push("has-custom-color"),t.pattern&&U.push(`card-pattern-${t.pattern}`),u&&U.push("selected"),p&&U.push("multi-selected"),F&&U.push("is-discarding"),f&&U.push("is-targetable"),h&&U.push("is-source-of-effect"),b&&U.push(b),k&&U.push(k),T&&U.push("is-drawing"),y&&U.push(y);const D={..._};return t.color&&(D["--card-custom-color"]=t.color),o.jsx("div",{className:U.join(" "),onPointerDown:n,onPointerEnter:r,onPointerLeave:c,role:"button",tabIndex:n?0:-1,style:D,children:o.jsxs("div",{className:`card-inner ${s?"":"is-flipped"}`,children:[o.jsxs("div",{className:"card-face card-front",children:[o.jsxs("div",{className:"card-header",children:[o.jsx("span",{className:`card-protocol ${t.protocol.length<=10?"short-protocol":""}`,children:t.protocol.slice(0,10)}),o.jsx("span",{className:"card-value",children:t.value})]}),o.jsxs("div",{className:"card-body",children:[o.jsx(x,{content:t.top,className:"card-rule-top"}),o.jsx(x,{content:t.middle,className:"card-rule-middle"}),o.jsx(x,{content:t.bottom,className:"card-rule-bottom"})]})]}),o.jsx("div",{className:"card-face card-back",children:o.jsx("div",{className:"card-back-value",children:d})})]})})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Kn=[{protocol:"Apathy",value:0,top:"Your total value in this line is increased by 1 for each face-down card in this line.",middle:"",bottom:"",keywords:{},category:"Aux 1"},{protocol:"Apathy",value:1,top:"",middle:"Flip all other face-up cards in this line.",bottom:"",keywords:{flip:!0},category:"Aux 1"},{protocol:"Apathy",value:2,top:"Ignore all middle commands of cards in this line.",middle:"",bottom:"<div><span class='emphasis'>When this card would be covered:</span> First, flip this card.</div>",keywords:{flip:!0},category:"Aux 1"},{protocol:"Apathy",value:3,top:"",middle:"Flip 1 of your opponent's face-up cards.",bottom:"",keywords:{flip:!0},category:"Aux 1"},{protocol:"Apathy",value:4,top:"",middle:"You may flip 1 of your face-up covered cards.",bottom:"",keywords:{flip:!0},category:"Aux 1"},{protocol:"Apathy",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Aux 1"},{protocol:"Chaos",value:0,top:"",middle:"In each line, flip 1 covered card.",bottom:"<div><span class='emphasis'>Start:</span> Draw the top card of your opponent's deck. Your opponent draws the top card of your deck.</div>",keywords:{flip:!0,draw:!0},category:"Main 2"},{protocol:"Chaos",value:1,top:"",middle:"Rearrange your protocols. Rearrange your opponent's protocols.",bottom:"",keywords:{},category:"Main 2"},{protocol:"Chaos",value:2,top:"",middle:"Shift 1 of your covered cards.",bottom:"",keywords:{shift:!0},category:"Main 2"},{protocol:"Chaos",value:3,top:"",middle:"",bottom:"You may play cards without matching protocols.",keywords:{play:!0},category:"Main 2"},{protocol:"Chaos",value:4,top:"",middle:"",bottom:"<div><span class='emphasis'>End:</span> Discard your hand. Draw the same amount of cards.</div>",keywords:{discard:!0,draw:!0},category:"Main 2"},{protocol:"Chaos",value:5,top:"",middle:"Discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 2"},{protocol:"Darkness",value:0,top:"",middle:"Draw 3 cards. Shift 1 of your opponent's covered cards.",bottom:"",keywords:{draw:!0,shift:!0},category:"Main 1"},{protocol:"Darkness",value:1,top:"",middle:"Flip 1 of your opponent's cards. You may shift that card.",bottom:"",keywords:{flip:!0,shift:!0},category:"Main 1"},{protocol:"Darkness",value:2,top:"All face-down cards in this stack have a value of 4.",middle:"You may flip 1 covered card in this line.",bottom:"",keywords:{flip:!0},category:"Main 1"},{protocol:"Darkness",value:3,top:"",middle:"Play 1 card face-down in another line.",bottom:"",keywords:{play:!0},category:"Main 1"},{protocol:"Darkness",value:4,top:"",middle:"Shift 1 face-down card.",bottom:"",keywords:{shift:!0},category:"Main 1"},{protocol:"Darkness",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Death",value:0,top:"",middle:"Delete 1 card from each other line.",bottom:"",keywords:{delete:!0},category:"Main 1"},{protocol:"Death",value:1,top:"<div><span class='emphasis'>Start:</span> You may draw 1 card. If you do, delete 1 other card, then delete this card.</div>",middle:"",bottom:"",keywords:{draw:!0,delete:!0},category:"Main 1"},{protocol:"Death",value:2,top:"",middle:"Delete all cards in 1 line with values of 1 or 2.",bottom:"",keywords:{delete:!0},category:"Main 1"},{protocol:"Death",value:3,top:"",middle:"Delete 1 face-down card.",bottom:"",keywords:{delete:!0},category:"Main 1"},{protocol:"Death",value:4,top:"",middle:"Delete a card with a value of 0 or 1.",bottom:"",keywords:{delete:!0},category:"Main 1"},{protocol:"Death",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Fire",value:0,top:"",middle:"Flip 1 other card. Draw 2 cards.",bottom:"<div><span class='emphasis'>When this card would be covered:</span> First, draw 1 card and flip 1 other card.</div>",keywords:{draw:!0,flip:!0},category:"Main 1"},{protocol:"Fire",value:1,top:"",middle:"Discard 1 card. If you do, delete 1 card.",bottom:"",keywords:{delete:!0,discard:!0},category:"Main 1"},{protocol:"Fire",value:2,top:"",middle:"Discard 1 card. If you do, return 1 card.",bottom:"",keywords:{discard:!0,return:!0},category:"Main 1"},{protocol:"Fire",value:3,top:"",middle:"",bottom:"<div><span class='emphasis'>End:</span> You may discard 1 card. If you do, flip 1 card.</div>",keywords:{discard:!0,flip:!0},category:"Main 1"},{protocol:"Fire",value:4,top:"",middle:"Discard 1 or more cards. Draw the amount discarded plus 1.",bottom:"",keywords:{discard:!0,draw:!0},category:"Main 1"},{protocol:"Fire",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Gravity",value:0,top:"",middle:"For every 2 cards in this line, play the top card of your deck face-down under this card.",bottom:"",keywords:{play:!0},category:"Main 1"},{protocol:"Gravity",value:1,top:"",middle:"Draw 2 cards. Shift 1 card either to or from this line.",bottom:"",keywords:{draw:!0,shift:!0},category:"Main 1"},{protocol:"Gravity",value:2,top:"",middle:"Flip 1 card. Shift that card to this line.",bottom:"",keywords:{flip:!0,shift:!0},category:"Main 1"},{protocol:"Gravity",value:4,top:"",middle:"Shift 1 face-down card to this line.",bottom:"",keywords:{shift:!0},category:"Main 1"},{protocol:"Gravity",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Gravity",value:6,top:"",middle:"Your opponent plays the top card of their deck face-down in this line.",bottom:"",keywords:{play:!0},category:"Main 1"},{protocol:"Hate",value:0,top:"",middle:"Delete 1 card.",bottom:"",keywords:{delete:!0},category:"Aux 1"},{protocol:"Hate",value:1,top:"",middle:"Discard 3 cards. Delete 1 card. Delete 1 card.",bottom:"",keywords:{delete:!0,discard:!0},category:"Aux 1"},{protocol:"Hate",value:2,top:"",middle:"Delete your highest value uncovered card. Delete your opponent's highest value uncovered card.",bottom:"",keywords:{delete:!0},category:"Aux 1"},{protocol:"Hate",value:3,top:"<div><span class='emphasis'>After you delete cards:</span> Draw 1 card.</div>",middle:"",bottom:"",keywords:{draw:!0},category:"Aux 1"},{protocol:"Hate",value:4,top:"",middle:"",bottom:"<div><span class='emphasis'>When this card would be covered:</span> First, delete the lowest value covered card in this line.</div>",keywords:{delete:!0},category:"Aux 1"},{protocol:"Hate",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Aux 1"},{protocol:"Life",value:0,top:"",middle:"Play the top card of your deck face-down in each line where you have a card.",bottom:"<div><span class='emphasis'>When this card would be covered:</span> First, delete this card.</div>",keywords:{delete:!0,play:!0},category:"Main 1"},{protocol:"Life",value:1,top:"",middle:"Flip 1 card. Flip 1 card.",bottom:"",keywords:{flip:!0},category:"Main 1"},{protocol:"Life",value:2,top:"",middle:"Draw 1 card. You may flip 1 face-down card.",bottom:"",keywords:{draw:!0,flip:!0},category:"Main 1"},{protocol:"Life",value:3,top:"",middle:"",bottom:"<div><span class='emphasis'>When this card would be covered:</span> First, play the top card of your deck face-down in another line.</div>",keywords:{play:!0},category:"Main 1"},{protocol:"Life",value:4,top:"",middle:"If this card is covering a card, draw 1 card.",bottom:"",keywords:{draw:!0},category:"Main 1"},{protocol:"Life",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Light",value:0,top:"",middle:"Flip 1 card. Draw cards equal to that card's value.",bottom:"",keywords:{draw:!0,flip:!0},category:"Main 1"},{protocol:"Light",value:1,top:"",middle:"",bottom:"<div><span class='emphasis'>End:</span> Draw 1 card.</div>",keywords:{draw:!0},category:"Main 1"},{protocol:"Light",value:2,top:"",middle:"Draw 2 cards. Reveal 1 face-down card. You may shift or flip that card.",bottom:"",keywords:{draw:!0,flip:!0,reveal:!0,shift:!0},category:"Main 1"},{protocol:"Light",value:3,top:"",middle:"Shift all face-down cards in this line to another line.",bottom:"",keywords:{shift:!0},category:"Main 1"},{protocol:"Light",value:4,top:"",middle:"Your opponent reveals their hand.",bottom:"",keywords:{reveal:!0},category:"Main 1"},{protocol:"Light",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Love",value:1,top:"",middle:"Draw the top card of your opponent's deck.",bottom:"<div><span class='emphasis'>End:</span> You may give 1 card from your hand to your opponent. If you do, draw 2 cards.</div>",keywords:{draw:!0,give:!0},category:"Aux 1"},{protocol:"Love",value:2,top:"",middle:"Your opponent draws 1 card. Refresh.",bottom:"",keywords:{draw:!0,refresh:!0},category:"Aux 1"},{protocol:"Love",value:3,top:"",middle:"Take 1 random card from your opponent's hand. Give 1 card from your hand to your opponent.",bottom:"",keywords:{give:!0,take:!0},category:"Aux 1"},{protocol:"Love",value:4,top:"",middle:"Reveal 1 card from your hand. Flip 1 card.",bottom:"",keywords:{flip:!0,reveal:!0},category:"Aux 1"},{protocol:"Love",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Aux 1"},{protocol:"Love",value:6,top:"",middle:"Your opponent draws 2 cards.",bottom:"",keywords:{draw:!0},category:"Aux 1"},{protocol:"Metal",value:0,top:"Your opponent's total value in this line is reduced by 2.",middle:"Flip 1 card.",bottom:"",keywords:{flip:!0},category:"Main 1"},{protocol:"Metal",value:1,top:"",middle:"Draw 2 cards. Your opponent cannot compile next turn.",bottom:"",keywords:{draw:!0},category:"Main 1"},{protocol:"Metal",value:2,top:"Your opponent cannot play cards face-down in this line.",middle:"",bottom:"",keywords:{},category:"Main 1"},{protocol:"Metal",value:3,top:"",middle:"Draw 1 card. Delete all cards in 1 other line with 8 or more cards.",bottom:"",keywords:{delete:!0,draw:!0},category:"Main 1"},{protocol:"Metal",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Metal",value:6,top:"<div><span class='emphasis'>When this card would be covered or flipped:</span> First, delete this card.</div>",middle:"",bottom:"",keywords:{delete:!0},category:"Main 1"},{protocol:"Plague",value:0,top:"",middle:"Your opponent discards 1 card.",bottom:"Your opponent cannot play cards in this line.",keywords:{discard:!0},category:"Main 1"},{protocol:"Plague",value:1,top:"<div><span class='emphasis'>After your opponent discards cards:</span> Draw 1 card.</div>",middle:"Your opponent discards 1 card.",bottom:"",keywords:{discard:!0,draw:!0},category:"Main 1"},{protocol:"Plague",value:2,top:"",middle:"Dicard 1 or more cards. Your opponent discards the amount of cards discarded plus 1.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Plague",value:3,top:"",middle:"Flip each other face-up card.",bottom:"",keywords:{flip:!0},category:"Main 1"},{protocol:"Plague",value:4,top:"",middle:"",bottom:"<div><span class='emphasis'>End:</span> Your opponent deletes 1 of their face-down cards. You may flip this card.</div>",keywords:{delete:!0,flip:!0},category:"Main 1"},{protocol:"Plague",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Psychic",value:0,top:"",middle:"Draw 2 cards. Your opponent discards 2 cards, then reveals their hand.",bottom:"",keywords:{discard:!0,draw:!0,reveal:!0},category:"Main 1"},{protocol:"Psychic",value:1,top:"Your opponent can only play cards face-down.",middle:"",bottom:"<div><span class='emphasis'>Start:</span> Flip this card.</div>",keywords:{flip:!0},category:"Main 1"},{protocol:"Psychic",value:2,top:"",middle:"Your opponent discards 2 cards. Rearrange their protocols.",bottom:"",keywords:{discard:!0,rearrange:!0},category:"Main 1"},{protocol:"Psychic",value:3,top:"",middle:"Your opponent discards 1 card. Shift 1 of their cards.",bottom:"",keywords:{discard:!0,shift:!0},category:"Main 1"},{protocol:"Psychic",value:4,top:"",middle:"",bottom:"<div><span class='emphasis'>End:</span> You may return 1 of your opponent's cards. If you do, flip this card.</div>",keywords:{flip:!0,return:!0},category:"Main 1"},{protocol:"Psychic",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Speed",value:0,top:"",middle:"Play 1 card.",bottom:"",keywords:{play:!0},category:"Main 1"},{protocol:"Speed",value:1,top:"<div><span class='emphasis'>After you clear cache:</span> Draw 1 card.</div>",middle:"Draw 2 cards.",bottom:"",keywords:{draw:!0},category:"Main 1"},{protocol:"Speed",value:2,top:"<div><span class='emphasis'>When this card would be deleted by compiling:</span> Shift this card, even if this card is covered.</div>",middle:"",bottom:"",keywords:{shift:!0},category:"Main 1"},{protocol:"Speed",value:3,top:"",middle:"Shift 1 of your other cards.",bottom:"<div><span class='emphasis'>End:</span> You may shift 1 of your cards. If you do, flip this card.</div>",keywords:{flip:!0,shift:!0},category:"Main 1"},{protocol:"Speed",value:4,top:"",middle:"Shift 1 of your opponent's face-down cards.",bottom:"",keywords:{shift:!0},category:"Main 1"},{protocol:"Speed",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Spirit",value:0,top:"",middle:"Refresh. Draw 1 card.",bottom:"Skip your check cache phase.",keywords:{draw:!0,refresh:!0},category:"Main 1"},{protocol:"Spirit",value:1,top:"You can play cards in any line.",middle:"Draw 2 cards.",bottom:"<div><span class='emphasis'>Start:</span> Either discard 1 card or flip this card.</div>",keywords:{discard:!0,draw:!0,flip:!0},category:"Main 1"},{protocol:"Spirit",value:2,top:"",middle:"You may flip 1 card.",bottom:"",keywords:{flip:!0},category:"Main 1"},{protocol:"Spirit",value:3,top:"<div><span class='emphasis'>After you draw cards:</span> You may shift this card, even if this card is covered.</div>",middle:"",bottom:"",keywords:{shift:!0},category:"Main 1"},{protocol:"Spirit",value:4,top:"",middle:"Swap the positions of 2 of your protocols",bottom:"",keywords:{swap:!0},category:"Main 1"},{protocol:"Spirit",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Water",value:0,top:"",middle:"Flip 1 other card. Flip this card.",bottom:"",keywords:{flip:!0},category:"Main 1"},{protocol:"Water",value:1,top:"",middle:"Play the top card of your deck face-down in each other line.",bottom:"",keywords:{play:!0},category:"Main 1"},{protocol:"Water",value:2,top:"",middle:"Draw 2 cards. Rearrange your protocols.",bottom:"",keywords:{draw:!0,rearrange:!0},category:"Main 1"},{protocol:"Water",value:3,top:"",middle:"Return all cards with a value of 2 in 1 line.",bottom:"",keywords:{return:!0},category:"Main 1"},{protocol:"Water",value:4,top:"",middle:"Return 1 of your cards.",bottom:"",keywords:{return:!0},category:"Main 1"},{protocol:"Water",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Frost",value:0,top:"",middle:"Draw 1 card for each face-down card.",bottom:"",keywords:{draw:!0},category:"Fan-Content"},{protocol:"Frost",value:1,top:"Cards cannot be flipped face-up.",middle:"",bottom:"Protocols cannot be rearranged.",keywords:{flip:!0,rearrange:!0},category:"Fan-Content"},{protocol:"Frost",value:2,top:"",middle:"Play a card face-down.",bottom:"",keywords:{play:!0},category:"Fan-Content"},{protocol:"Frost",value:3,top:"Cards cannot shift from or to this line.",middle:"",bottom:"",keywords:{shift:!0},category:"Fan-Content"},{protocol:"Frost",value:4,top:"",middle:"You may flip 1 card of your face-up covered cards.",bottom:"",keywords:{flip:!0},category:"Fan-Content"},{protocol:"Frost",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Fan-Content"},{protocol:"Anarchy",value:0,top:"",middle:"Shift 1 card. For each line that contains a face-up card without matching protocol, draw 1 card.",bottom:"",keywords:{shift:!0,draw:!0},category:"Fan-Content"},{protocol:"Anarchy",value:1,top:"Cards can only be played without matching protocols.",middle:"Shift 1 other card to a line without a matching protocol.",bottom:"",keywords:{shift:!0,play:!0},category:"Fan-Content"},{protocol:"Anarchy",value:2,top:"",middle:"Delete a covered or uncovered card in a line with a matching protocol.",bottom:"",keywords:{delete:!0},category:"Fan-Content"},{protocol:"Anarchy",value:3,top:"",middle:"Swap the positions of 2 of your opponent's protocols.",bottom:"<div><span class='emphasis'>End:</span> Rearrange your protocols. Anarchy cannot be on this line.</div>",keywords:{swap:!0,rearrange:!0},category:"Fan-Content"},{protocol:"Anarchy",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Fan-Content"},{protocol:"Anarchy",value:6,top:"<div><span class='emphasis'>Start:</span> Flip this card, if this card is in the line with the Anarchy protocol.</div>",middle:"",bottom:"",keywords:{flip:!0},category:"Fan-Content"}],O0=new Set(Kn.map(t=>t.protocol)),M0=Array.from(O0).sort();/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function io(t,n=1){var h,_,y;const r=t.count??n,c=((h=t.targetFilter)==null?void 0:h.owner)||"any",s=((_=t.targetFilter)==null?void 0:_.position)||"uncovered",d=(y=t.targetFilter)==null?void 0:y.faceState;let u="";s==="any"?u="covered or uncovered ":s==="covered"&&(u="covered ");let p="";d==="face_down"?p="face-down ":d==="face_up"&&(p="face-up ");const f=r===1?"card":"cards";return c==="own"?`${r} of your ${u}${p}${f}`:c==="opponent"?`${r} of your opponent's ${u}${p}${f}`:r==="all"?`all ${u}${p}cards`:`${r} ${u}${p}${f}`}const rl=(t,n)=>{var d,u,p,f,h,_,y,m,g,x,C,b,j,k,E,T,F,U,D,I,W,z,V,B,L,P,M,N,R,$,X,G,q,Q,K,Z,te,ee,se,_e,fe,be,oe,H,ne,J,ie,de,pe,Se,Fe,je,Ve,He,Ge,qe,Ne,Oe,Le,ut,Qe,Je,Ft,tn,Gt,Lt,nn,Pt,Ha,Na,ma,bn,ta,Pn,gn,En,Jt,Un,ya,ga,On,za,Ta,Ra,va,Mn,_a,Da,Aa,hn,$t,Mt,jn,wa,Ba,Ga,Fa,Vn,na,vn,_n,kn,wn,Tt,xa,Ca,mn,xn;const r=t.params,c=(n==null?void 0:n.protocolName)||"[protocol]";let s="";switch(r.action){case"refresh":{r.target==="opponent"?s="Your opponent refreshes their hand.":s="Refresh.";break}case"mutual_draw":{const ge=r.count||1;s=`Draw the top card${ge!==1?"s":""} of your opponent's deck. Your opponent draws the top card${ge!==1?"s":""} of your deck.`;break}case"draw":{if(t.useCardFromPreviousEffect){r.target==="opponent"?s="Opponent draws cards equal to that card's value.":s="Draw cards equal to that card's value.";break}if(r.revealFromDrawn){const Me=r.count||3;let ze=`Draw ${Me} ${Me===1?"card":"cards"}.`;const Ye=r.revealFromDrawn.count||1,me=Ye==="all"?"all cards":Ye===1?"1 card":`${Ye} cards`;(r.revealFromDrawn.valueSource||"stated_number")==="stated_number"?ze+=` Reveal ${me} drawn with the face-up value of your stated number.`:ze+=` Reveal ${me} drawn.`,r.revealFromDrawn.thenAction==="may_play"&&(ze+=" You may play it."),s=ze;break}if(r.countType==="count_face_down"){s="Draw 1 card for each face-down card.";break}if(r.conditional){switch(r.conditional.type){case"count_face_down":s="Draw 1 card for each face-down card.";break;case"is_covering":s=`Draw ${r.count} card${r.count!==1?"s":""} if this card is covering another.`;break;case"non_matching_protocols":s="Draw 1 card for each line with a non-matching protocol.";break}break}let ge="";if(r.countType==="equal_to_discarded"){const Me=r.countOffset||0;Me===1?ge+="Draw 1 more card than the amount discarded.":Me===0?ge+="Draw the same amount of cards.":ge+=`Draw the amount discarded plus ${Me}.`,s=ge;break}else if(r.countType==="equal_to_card_value"){ge+="Draw cards equal to that card's value.",s=ge;break}else if(r.countType==="hand_size"){ge+="Draw the same amount of cards.",s=ge;break}else if(r.countType==="all_matching"&&((d=r.valueFilter)==null?void 0:d.equals)!==void 0){const Me=r.valueFilter.equals;ge+=`Draw all cards with a value of ${Me}.`,s=ge;break}else if(r.countType==="equal_to_unique_protocols_in_lane"){ge+="Draw cards equal to the number of different protocols in this line.",s=ge;break}else if(r.countType==="count_own_protocol_cards_on_field"){ge+=`Draw cards equal to the number of face-up ${c} cards in the field.`,s=ge;break}else if(((u=r.valueFilter)==null?void 0:u.equals)!==void 0&&r.count){const Me=r.valueFilter.equals,ot=r.count===1?"card":"cards",ze=r.fromRevealed?" revealed this way":"";ge+=`Draw ${r.count} ${ot} with a value of ${Me}${ze}.`,s=ge;break}if(((p=r.protocolFilter)==null?void 0:p.type)==="same_as_source"){((f=r.advancedConditional)==null?void 0:f.type)==="empty_hand"?s=`If your hand is empty, reveal your deck, draw all ${c} cards from it, and shuffle your deck.`:s=`Reveal your deck and draw all ${c} cards.`;break}if(((h=r.advancedConditional)==null?void 0:h.type)==="empty_hand"){s=`If you have no cards in hand, draw ${io(r)}.`;break}if(((_=r.advancedConditional)==null?void 0:_.type)==="opponent_higher_value_in_lane"){s=`If your opponent has a higher total value than you do in this line, draw ${io(r)}.`;break}if(((y=r.advancedConditional)==null?void 0:y.type)==="same_protocol_on_field"){s=`If there is another face-up ${c} card in the field, draw ${io(r)}.`;break}const De=r.optional?"You may ":"";if(r.source==="opponent_deck"){const Me=r.count===1?"the top card":`the top ${r.count} cards`;ge+=`${De}Draw ${Me} of your opponent's deck.`}else if(r.target==="opponent")if(r.source==="own_deck"){const Me=r.count===1?"the top card":`the top ${r.count} cards`;ge+=`Your opponent draws ${Me} of your deck.`}else ge+=`Opponent draws ${r.count} card${r.count!==1?"s":""}.`;else{const Me=r.optional?"draw":"Draw";ge+=`${De}${Me} ${r.count} card${r.count!==1?"s":""}.`}s=ge;break}case"flip":{if(t.useCardFromPreviousEffect){const Ae=r.optional?"May flip":"Flip",Xe=r.skipMiddleCommand?", ignoring its middle commands":"";s=`${Ae} that card${Xe}.`;break}if(r.flipSelf){if(((m=r.advancedConditional)==null?void 0:m.type)==="opponent_higher_value_in_lane"){s="If your opponent has a higher value in this line than you do, flip this card.";break}if(((g=r.advancedConditional)==null?void 0:g.type)==="hand_size_greater_than"){const Xe=r.advancedConditional.threshold??0;s=`If you have more than ${Xe} ${Xe===1?"card":"cards"} in your hand, flip this card.`;break}if(((x=r.advancedConditional)==null?void 0:x.type)==="same_protocol_on_field"){s=`If there is another face-up ${c} card in the field, you may flip this card.`;break}if(((C=r.advancedConditional)==null?void 0:C.type)==="this_card_is_covered"){s=r.optional?"If this card is covered, you may flip this card.":"If this card is covered, flip this card.";break}let Ae=r.optional?"You may flip this card":"Flip this card";((b=r.advancedConditional)==null?void 0:b.type)==="protocol_match"&&(Ae+=`, if this card is in the line with the ${r.advancedConditional.protocol||"[Protocol]"} protocol`),s=Ae+".";break}if(((j=r.advancedConditional)==null?void 0:j.type)==="same_protocol_on_field"){const Ae=r.count||1,Xe=((k=r.targetFilter)==null?void 0:k.faceState)==="face_up"?"face-up ":"";s=`If there is another face-up ${c} card in the field, you may flip ${Ae} ${Xe}card${Ae!==1?"s":""}.`;break}const ge=r.optional?"You may flip":"Flip",De=((E=r.targetFilter)==null?void 0:E.owner)==="own",Me=((T=r.targetFilter)==null?void 0:T.owner)==="opponent",ot=(F=r.targetFilter)==null?void 0:F.excludeSelf;let ze="";De&&ot?ze+="of your other ":De?ze+="of your ":Me?ze+="of your opponent's ":ot&&(ze+="other "),((U=r.targetFilter)==null?void 0:U.position)==="any"?ze+="covered or uncovered ":((D=r.targetFilter)==null?void 0:D.position)==="covered"&&(ze+="covered "),((I=r.targetFilter)==null?void 0:I.faceState)==="face_down"&&(ze+="face-down "),((W=r.targetFilter)==null?void 0:W.faceState)==="face_up"&&(ze+="face-up ");let Ye="";r.count==="all"?Ye="all":r.count==="each"?r.eachLineScope==="each_line"?(Ye="1",ze=ze+"(in each line) "):Ye="each":Ye=r.count.toString();const xe=De||Me?"cards":r.count===1?"card":"cards";let Pe="";if(De&&((z=r.targetFilter)==null?void 0:z.position)==="covered"&&((V=r.targetFilter)==null?void 0:V.faceState)==="face_up"&&r.optional?Pe=`${ge} ${Ye} of your ${r.targetFilter.faceState.replace("_","-")} ${r.targetFilter.position} cards`:Pe=`${ge} ${Ye} ${ze}${xe}`,r.scope==="this_lane"){const Ae=((B=r.targetFilter)==null?void 0:B.owner)==="own";Pe+=Ae?" in this stack":" in this line"}else r.scope==="each_lane"&&(Pe=`In each line, ${Pe.charAt(0).toLowerCase()+Pe.slice(1)}`);r.sameLaneAsFirst&&(Pe+=" in the same line"),(L=r.targetFilter)!=null&&L.valueMinGreaterThanHandSize&&(Pe+=" that has a value greater than the number of cards in your hand"),(P=r.targetFilter)!=null&&P.valueLessThanUniqueProtocolsOnField&&(Pe+=" with a value less than the number of different protocols on cards in the field"),Pe+=".",r.selfFlipAfter&&(Pe+=" Then flip this card."),s=Pe;break}case"shift":{const ge=r.optional?"You may shift":"Shift";if(((M=r.advancedConditional)==null?void 0:M.type)==="empty_hand"){s=`If you have no cards in hand, ${ge.toLowerCase()} ${io(r)}.`;break}if(((N=r.advancedConditional)==null?void 0:N.type)==="opponent_higher_value_in_lane"){s=`If your opponent has a higher total value than you do in this line, ${ge.toLowerCase()} ${io(r)}.`;break}if(((R=r.advancedConditional)==null?void 0:R.type)==="this_card_is_covered"){s=`If this card is covered, ${ge.toLowerCase()} it.`;break}if(r.shiftSelf){if((($=r.destinationRestriction)==null?void 0:$.type)==="opponent_highest_value_lane"){s=`${ge} this card to the line where your opponent has their highest total value.`;break}let xt=`${ge} this card`;r.allowCoveredSelf&&(xt+=", even if this card is covered"),s=xt+".";break}if(t.useCardFromPreviousEffect){let xt=`${ge} that card`;((X=r.destinationRestriction)==null?void 0:X.type)==="to_this_lane"?xt+=" to this line":((G=r.destinationRestriction)==null?void 0:G.type)==="to_another_line"?xt+=" to another line":((q=r.destinationRestriction)==null?void 0:q.type)==="non_matching_protocol"?xt+=" to a line without a matching protocol":((Q=r.destinationRestriction)==null?void 0:Q.type)==="specific_lane"&&(xt+=" within this line"),s=xt+".";break}const De=r.count||1,Me=((K=r.targetFilter)==null?void 0:K.owner)==="own",ot=((Z=r.targetFilter)==null?void 0:Z.position)==="covered";if(Me&&ot&&De===1){let xt=`${ge} 1 of your covered cards`;((te=r.destinationRestriction)==null?void 0:te.type)==="non_matching_protocol"?xt+=" to a line without a matching protocol":((ee=r.destinationRestriction)==null?void 0:ee.type)==="specific_lane"?xt+=" within this line":((se=r.destinationRestriction)==null?void 0:se.type)==="to_another_line"&&(xt+=" to another line"),s=xt+".";break}if(((_e=r.targetFilter)==null?void 0:_e.owner)==="own"&&((fe=r.targetFilter)==null?void 0:fe.position)==="any"&&!((be=r.targetFilter)!=null&&be.excludeSelf)&&De===1){s=`${ge} this card, even if this card is covered`+".";break}if(Me&&!ot&&!((oe=r.targetFilter)!=null&&oe.excludeSelf)&&De===1){s=`${ge} 1 of your cards`+".";break}let Ye="";const me=((H=r.targetFilter)==null?void 0:H.owner)==="opponent",xe=(ne=r.targetFilter)==null?void 0:ne.excludeSelf,Pe=((J=r.targetFilter)==null?void 0:J.position)==="any";Me&&xe?Ye+="of your other ":me?Ye+="of your opponent's ":xe&&(Ye+="other "),Pe?Ye+="covered or uncovered ":((ie=r.targetFilter)==null?void 0:ie.position)==="covered"&&(Ye+="covered "),((de=r.targetFilter)==null?void 0:de.faceState)==="face_down"&&(Ye+="face-down "),((pe=r.targetFilter)==null?void 0:pe.faceState)==="face_up"&&(Ye+="face-up ");const Ae=r.count==="all"?"all":"1";let Ut=`${ge} ${Ae} ${Ye}${Me&&xe||me?"cards":Ae==="1"?"card":"cards"}`;r.scope==="this_lane"&&(Ut+=" in this line"),((Se=r.destinationRestriction)==null?void 0:Se.type)==="non_matching_protocol"?Ut+=" to a line without a matching protocol":((Fe=r.destinationRestriction)==null?void 0:Fe.type)==="specific_lane"?Ut+=" within this line":((je=r.destinationRestriction)==null?void 0:je.type)==="to_another_line"?Ut+=" to another line":((Ve=r.destinationRestriction)==null?void 0:Ve.type)==="to_this_lane"?Ut+=" to this line":((He=r.destinationRestriction)==null?void 0:He.type)==="to_or_from_this_lane"&&(Ut+=" either to or from this line"),s=Ut+".";break}case"delete":{if(((Ge=r.advancedConditional)==null?void 0:Ge.type)==="empty_hand"){const xe=r.count||1;s=`If you have no cards in hand, delete ${xe} card${xe!==1?"s":""}.`;break}if(((qe=r.advancedConditional)==null?void 0:qe.type)==="opponent_higher_value_in_lane"){const xe=r.count||1;s=`If your opponent has a higher total value than you do in this line, delete ${xe} card${xe!==1?"s":""}.`;break}if(t.useCardFromPreviousEffect){s="Delete that card.";break}if(r.deleteSelf){((Ne=r.protocolCountConditional)==null?void 0:Ne.type)==="unique_protocols_on_field_below"?s=`If there are not at least ${r.protocolCountConditional.threshold} different protocols on cards in the field, delete this card.`:((Oe=r.advancedConditional)==null?void 0:Oe.type)==="this_card_is_covered"?s="If this card is covered, delete this card.":s="Delete this card.";break}if(((Le=r.laneCondition)==null?void 0:Le.type)==="opponent_higher_value"){const xe=r.count||1,Pe=((ut=r.targetFilter)==null?void 0:ut.owner)==="opponent"?"of your opponent's ":"";s=`Delete ${xe} ${Pe}${xe===1?"card":"cards"} in a line where they have a higher total value than you do.`;break}let ge=r.optional?"You may delete ":"Delete ";const De=((Qe=r.targetFilter)==null?void 0:Qe.position)==="any",Me=((Je=r.targetFilter)==null?void 0:Je.calculation)==="highest_value"||((Ft=r.targetFilter)==null?void 0:Ft.calculation)==="lowest_value",ot=((tn=r.targetFilter)==null?void 0:tn.owner)==="own"||((Gt=r.targetFilter)==null?void 0:Gt.owner)==="opponent",ze=r.count===1&&Me&&ot,Ye=r.count===1&&Me&&!ot;if(r.count==="all_in_lane"?ge+="all ":ze||(Ye?ge+="the ":ge+=De?"a ":`${r.count} `),ze&&(((Lt=r.targetFilter)==null?void 0:Lt.owner)==="own"?ge+="your ":((nn=r.targetFilter)==null?void 0:nn.owner)==="opponent"&&(ge+="opponent's ")),((Pt=r.targetFilter)==null?void 0:Pt.calculation)==="highest_value"?ge+="highest value ":((Ha=r.targetFilter)==null?void 0:Ha.calculation)==="lowest_value"&&(ge+="lowest value "),(Na=r.targetFilter)!=null&&Na.valueRange){const{min:xe,max:Pe}=r.targetFilter.valueRange,Ae=[];for(let it=xe;it<=Pe;it++)Ae.push(it);const Xe=Ae.join(" or ");ge+=`value ${Xe} `}ze||(((ma=r.targetFilter)==null?void 0:ma.owner)==="own"?ge+="your ":((bn=r.targetFilter)==null?void 0:bn.owner)==="opponent"&&(ge+="opponent's ")),r.excludeSelf&&(ge+="other "),De?ge+="covered or uncovered ":(((ta=r.targetFilter)==null?void 0:ta.position)==="covered"||((Pn=r.targetFilter)==null?void 0:Pn.position)==="covered_by_context")&&(ge+="covered "),((gn=r.targetFilter)==null?void 0:gn.faceState)==="face_down"?ge+="face-down ":((En=r.targetFilter)==null?void 0:En.faceState)==="face_up"&&(ge+="face-up ");const me=r.count===1?"card":"cards";ge+=me,r.selectLane&&(ge+=" in 1 line"),r.protocolMatching==="must_match"?ge+=" in a line with a matching protocol":r.protocolMatching==="must_not_match"&&(ge+=" in a line without a matching protocol"),((Jt=r.scope)==null?void 0:Jt.type)==="this_line"?ge+=" in this line":((Un=r.scope)==null?void 0:Un.type)==="other_lanes"?ge+=" in other lanes":((ya=r.scope)==null?void 0:ya.type)==="each_other_line"&&(ge+=" from each other line"),((ga=r.targetFilter)==null?void 0:ga.valueSource)==="previous_effect_card"&&(ge+=" that shares a value with the discarded card"),s=ge+".";break}case"discard":{if(r.source==="top_deck_own"){s="Discard the top card of your deck.";break}if(r.source==="top_deck_opponent"){s="Discard the top card of your opponent's deck.";break}if(r.source==="entire_deck"){s="Discard your entire deck.";break}if(r.useCardFromPreviousEffect){r.actor==="opponent"?s="Opponent discards that card.":s="discard that card.";break}if(r.countType==="equal_to_discarded"){const Ye=r.countOffset||0;r.actor==="opponent"?Ye===1?s="Your opponent discards the amount of cards discarded plus 1.":Ye===0?s="Your opponent discards the same amount of cards.":s=`Your opponent discards the amount discarded plus ${Ye}.`:Ye===1?s="Discard 1 more card than the amount discarded.":Ye===0?s="Discard the same amount of cards.":s=`Discard the amount discarded plus ${Ye}.`;break}const ge=r.variableCount;let De="";if(ge)De="1 or more cards";else if(r.count==="all")De="your hand";else{const Ye=r.count===1?"card":"cards";De=`${r.count} ${Ye}`}const Me=r.optional?"You may discard":r.count==="all"||ge?"Discard":"You discard";if(r.actor==="both"){if(r.count==="all")s="Both players discard their hand.";else{const Ye=r.count===1?"card":"cards";s=`Both players discard ${r.count} ${Ye}.`}break}const ze=(r.discardTo||"own_trash")==="opponent_trash"?" into their trash":"";if(r.actor==="opponent")if(r.count==="all")s=`Opponent discards their hand${ze}.`;else if(r.random){const Ye=r.count===1?"card":"cards";s=`Your opponent discards ${r.count} random ${Ye}${ze}.`}else s=`Your opponent discards ${De}${ze}.`;else s=`${Me} ${De}${ze}.`;break}case"return":{if(((On=r.advancedConditional)==null?void 0:On.type)==="empty_hand"){s=`If you have no cards in hand, return ${io(r)}.`;break}if(((za=r.advancedConditional)==null?void 0:za.type)==="opponent_higher_value_in_lane"){s=`If your opponent has a higher total value than you do in this line, return ${io(r)}.`;break}if(r.returnSelf){((Ta=r.advancedConditional)==null?void 0:Ta.type)==="this_card_is_covered"?s=r.optional?"If this card is covered, you may return this card to hand.":"If this card is covered, return this card to hand.":s=r.optional?"You may return this card to hand.":"Return this card to hand.";break}if(t.useCardFromPreviousEffect){s="Return that card to hand.";break}const De=r.selectLane||!1?" in 1 line":"";if(((Ra=r.targetFilter)==null?void 0:Ra.valueEquals)!==void 0){s=`Return all cards with a value of ${r.targetFilter.valueEquals}${De}.`;break}const Me=((va=r.targetFilter)==null?void 0:va.owner)||"any",ot=((Mn=r.targetFilter)==null?void 0:Mn.position)||"uncovered",ze=(_a=r.targetFilter)==null?void 0:_a.faceState,Ye=r.destination||"owner_hand";let me="";ot==="any"?me="covered or uncovered ":ot==="covered"&&(me="covered ");let xe="";ze==="face_down"?xe="face-down ":ze==="face_up"&&(xe="face-up ");const Pe=r.count,Ae=Pe===1?"card":"cards";let Xe="";if(Me==="own"?Xe=`${Pe==="all"?"all":Pe} of your ${me}${xe}${Ae}`:Me==="opponent"?Xe=`${Pe==="all"?"all":Pe} of your opponent's ${me}${xe}${Ae}`:Xe=Pe==="all"?`all ${me}${xe}cards`:`${Pe} ${me}${xe}${Ae}`,Ye==="actor_hand"&&Me==="opponent"){s=`${r.optional?"You may p":"P"}ut ${Xe}${De} into your hand.`;break}s=`${r.optional?"You may r":"R"}eturn ${Xe}${De}.`;break}case"play":{if(((Da=r.advancedConditional)==null?void 0:Da.type)==="empty_hand"){s=`If you have no cards in hand, play ${io(r)}.`;break}if(((Aa=r.advancedConditional)==null?void 0:Aa.type)==="opponent_higher_value_in_lane"){s=`If your opponent has a higher total value than you do in this line, play ${io(r)}.`;break}if(t.useCardFromPreviousEffect){const Xe=r.faceDown===!0?"face-down":r.faceDown===!1?"face-up":"";let it="";((hn=r.destinationRule)==null?void 0:hn.type)==="other_lines"&&(it=" in another line"),s=Xe?`Play that card ${Xe}${it}.`:`Play that card${it}.`;break}if(r.source==="trash"){const Xe=r.count||1,it=Xe===1?"card":"cards",xt=(r.sourceOwner||"own")==="opponent"?"your opponent's trash":"your trash";s=`Play ${Xe} ${it} from ${xt}.`;break}const ge=r.actor,De=r.count||1,Me=r.faceDown===!0?" face-down":r.faceDown===!1?" face-up":"",ot=r.sourceOwner||"own",ze=r.targetBoard||"own";let Ye="",me="";const xe=(($t=r.valueFilter)==null?void 0:$t.equals)!==void 0?` with a value of ${r.valueFilter.equals}`:"";ge==="opponent"?(Ye="Your opponent plays",r.source==="deck"?ot==="opponent"?me=De===1?"the top card of your deck":`${De} cards from your deck`:me=De===1?"the top card of their deck":`${De} cards from their deck`:me=De===1?`a card${xe} from their hand`:`${De} cards${xe} from their hand`):(Ye=r.optional?"You may play":"Play",r.source==="deck"?ot==="opponent"?me=De===1?"the top card of your opponent's deck":`${De} cards from your opponent's deck`:me=De===1?"the top card of your deck":`${De} cards from your deck`:me=De===1?`1 card${xe}`:`${De} cards${xe}`);let Pe="";((Mt=r.condition)==null?void 0:Mt.type)==="per_x_cards_in_line"&&(Pe=`For every ${r.condition.cardCount||2} cards in this line, `,Ye=Ye.toLowerCase());let Ae=`${Pe}${Ye} ${me}${Me}`;if(((jn=r.destinationRule)==null?void 0:jn.type)==="other_lines")Ae+=" to other lines";else if(((wa=r.destinationRule)==null?void 0:wa.type)==="another_line")Ae+=" in another line";else if(((Ba=r.destinationRule)==null?void 0:Ba.type)==="each_other_line")Ae+=" in each other line";else if(((Ga=r.destinationRule)==null?void 0:Ga.type)==="under_this_card")Ae+=" under this card";else if(((Fa=r.destinationRule)==null?void 0:Fa.type)==="each_line_with_card"){const Xe=r.destinationRule.ownerFilter,it=r.destinationRule.cardFilter;(it==null?void 0:it.faceState)==="face_down"?Ae+=" in each line with a face-down card":(it==null?void 0:it.faceState)==="face_up"?Ae+=" in each line with a face-up card":Xe==="own"?Ae+=" in each line where you have a card":Xe==="opponent"?Ae+=" in each line where opponent has a card":Ae+=" to each line with a card"}else if(((Vn=r.destinationRule)==null?void 0:Vn.type)==="line_with_matching_cards"){const Xe=r.destinationRule.cardFilter;(Xe==null?void 0:Xe.faceState)==="face_down"?Ae+=" in a line with a face-down card":(Xe==null?void 0:Xe.faceState)==="face_up"?Ae+=" in a line with a face-up card":Ae+=" in a line with a card"}else((na=r.destinationRule)==null?void 0:na.type)==="specific_lane"&&(Ae+=" in this line");ze==="opponent"&&(Ae+=" on your opponent's side"),r.excludeSourceProtocol&&(Ae=Ae.replace(/(\d+) card/,`$1 non-${c} card`)),s=Ae+".";break}case"rearrange_protocols":case"swap_protocols":{const ge=r.target==="opponent"?"your opponent's":r.target==="both_sequential"?"both players'":"your";let De="";r.action==="rearrange_protocols"?De=`Rearrange ${ge} protocols`:De=`Swap the positions of 2 of ${ge} protocols`,r.restriction&&r.restriction.disallowedProtocol&&(De+=`. ${r.restriction.disallowedProtocol} cannot be on this line`),s=De+".";break}case"reveal":case"give":{if(t.useCardFromPreviousEffect){s=`${r.action==="give"?"Give":"Reveal"} that card.`;break}if(r.action,r.source==="board"){const me=((vn=r.targetFilter)==null?void 0:vn.faceState)==="face_down"?"face-down ":"",xe=r.count||1;let Ae=`Reveal ${xe} ${me}${xe===1?"card":"cards"}`;r.optional?Ae+=". You may shift or flip that card":r.followUpAction==="flip"?Ae+=". Then flip it":r.followUpAction==="shift"&&(Ae+=". Then shift it"),s=Ae+".";break}if(r.source==="own_deck_top"){let me="Reveal the top card of your deck";r.followUpAction==="may_discard"&&(me+=". You may discard it"),s=me+".";break}if(r.source==="own_deck"){s="Reveal your deck.";break}if(r.source==="own_trash"){const me=r.count||1;s=`Reveal ${me} ${me===1?"card":"cards"} from your trash.`;break}if(((_n=r.protocolFilter)==null?void 0:_n.type)==="same_as_source"){s=`Reveal all ${c} cards in your hand.`;break}if(r.count===-1){r.source==="opponent_hand"?s=r.action==="reveal"?"Your opponent reveals their hand.":"Give your entire hand to your opponent.":s=r.action==="reveal"?"Reveal your hand.":"Give your entire hand.";break}const ge=r.count===1?"card":"cards",De=r.source==="opponent_hand"?"opponent's hand":"your hand",Me=r.optional?"You may ":"",ot=r.action==="give"?"give":"reveal",ze=r.action==="give"?"Give":"Reveal";let Ye;r.optional?Ye=`${Me}${ot} ${r.count} ${ge} from ${De}`:Ye=`${ze} ${r.count} ${ge} from ${De}`,r.action==="give"&&r.source!=="opponent_hand"&&(Ye+=" to your opponent"),r.followUpAction==="flip"?Ye+=". Then flip it.":r.followUpAction==="shift"?Ye+=". Then shift it.":Ye+=".",s=Ye;break}case"take":{const ge=r.count===1?"card":"cards",De=r.random!==!1?"random ":"";s=`Take ${r.count} ${De}${ge} from your opponent's hand.`;break}case"choice":{const ge=r.options||[];if(ge.length===0){s="Effect";break}if(ge.length===2){const De=ge.map(Me=>{const ot={params:Me.params};let ze=rl(ot);return ze.endsWith(".")&&(ze=ze.slice(0,-1)),ze=ze.charAt(0).toLowerCase()+ze.slice(1),ze});((kn=r.advancedConditional)==null?void 0:kn.type)==="same_protocol_on_field"?s=`If there is another ${c} card in the field, either ${De[0]} or ${De[1]}.`:s=`Either ${De[0]} or ${De[1]}.`}else s="Effect";break}case"passive_rule":{const ge=r.rule;switch(ge==null?void 0:ge.type){case"require_non_matching_protocol":s="Cards can only be played without matching protocols.";break;case"block_all_play":ge.target==="opponent"?s="Your opponent cannot play cards in this line.":ge.target==="self"?s="You cannot play cards in this line.":s="Cards cannot be played in this line.";break;case"ignore_middle_commands":if(ge.onlyDuringYourTurn&&ge.target==="opponent"&&ge.scope==="global")s="During your turn, your opponent's cards do not have middle commands.";else if(ge.onlyDuringYourTurn){const De=ge.target==="opponent"?"your opponent's ":ge.target==="self"?"your ":"",Me=ge.scope==="global"?"":" in this line";s=`During your turn, ignore all middle commands of ${De}cards${Me}.`}else s="Ignore all middle commands of cards in this line.";break;case"block_face_down_play":s="Opponent can't play cards face-down in this line.";break;case"require_face_down_play":s=ge.scope==="global"?"Your opponent can only play cards face-down.":"Opponent can only play cards face-down in this line.";break;case"allow_any_protocol_play":s="You may play cards without matching protocols.";break;case"allow_play_on_opponent_side":s="You may play this card in any line on either player's side.";break;case"block_flips":s=ge.scope==="global"?"Cards cannot be flipped face-up.":"Cards can't be flipped face-up in this line.";break;case"block_protocol_rearrange":s="Protocols can't be rearranged.";break;case"block_shifts_from_lane":s="Cards can't shift from this line.";break;case"block_shifts_to_lane":s="Cards can't shift to this line.";break;case"block_shifts_from_and_to_lane":s="Cards cannot shift from or to this line.";break;case"skip_check_cache_phase":s="Skip check cache phase.";break;case"block_flip_this_card":s="This card cannot be flipped.";break;case"allow_same_protocol_face_up_play":s=`${c} cards may be played face-up in this line.`;break;case"block_draw_conditional":{const De=ge.conditionTarget||"self",Me=ge.blockTarget||"self",ot=De==="self"?"you have":"your opponent has";let ze;Me==="self"?ze="you cannot draw":Me==="opponent"?ze="your opponent cannot draw":ze="neither player can draw",s=`If ${ot} any cards in hand, ${ze} cards.`;break}default:s="Passive rule effect."}break}case"value_modifier":{const ge=r.modifier;switch(ge==null?void 0:ge.type){case"add_per_condition":{const De=ge.scope==="this_lane"?"in this line":"",Me=ge.target==="own_total"?"Your total value":ge.target==="opponent_total"?"Your opponent's total value":"Total value";let ot="",ze="";ge.condition==="per_face_down_card"?(ot="for each face-down card",ze=De):ge.condition==="per_face_up_card"?(ot="for each face-up card",ze=De):ge.condition==="per_card"?(ot="for each card",ze=De):ge.condition==="per_card_in_hand"?ot="for each card in your hand":ge.condition==="per_opponent_card_in_lane"&&(ot="for each of your opponent's cards",ze=De);const Ye=Math.abs(ge.value),me=ge.value>=0?"increased":"reduced";s=`${Me} ${De} is ${me} by ${Ye} ${ot} ${ze}.`.replace(/\s+/g," ").trim();break}case"set_to_fixed":{let De="";ge.target==="own_cards"?De="your":ge.target==="opponent_cards"?De="opponent's":De="all";let Me="";((wn=ge.filter)==null?void 0:wn.faceState)==="face_down"?Me=" face-down":((Tt=ge.filter)==null?void 0:Tt.faceState)==="face_up"&&(Me=" face-up");let ot="";ge.scope==="this_lane"&&(ot=" in this stack"),s=`All ${De}${Me} cards${ot} have a value of ${ge.value}.`;break}case"add_to_total":{const De=ge.scope==="this_lane"?" in this line":"",Me=ge.condition==="has_non_own_protocol_face_up"?` if there are any non-${c} face-up cards in this stack`:"";ge.target==="opponent_total"?ge.value<0?s=`Your opponent's total value${De} is reduced by ${Math.abs(ge.value)}${Me}.`:s=`Your opponent's total value${De} is increased by ${ge.value}${Me}.`:ge.value<0?s=`Your total value${De} is reduced by ${Math.abs(ge.value)}${Me}.`:s=`Your total value${De} is increased by ${ge.value}${Me}.`;break}default:s="Value modifier effect."}break}case"block_compile":{s=`${r.target==="opponent"?"Your opponent":"You"} cannot compile next turn.`;break}case"delete_all_in_lane":{const ge=((xa=r.laneCondition)==null?void 0:xa.count)||8;s=`Delete all cards in ${r.excludeCurrentLane?"1 other line":"1 line"} with ${ge} or more cards.`;break}case"modify_value":{const ge=r.modifier||0,De=r.target==="opponent"?"Your opponent's":"Your",Me=ge<0?`reduced by ${Math.abs(ge)}`:`increased by ${ge}`;s=`${De} total value in this line is ${Me}.`;break}case"block_play_face_down":{s="Your opponent cannot play cards face-down in this line.";break}case"shuffle_trash":{let De=`${r.optional!==!1?"You may shuffle":"Shuffle"} your trash into your deck.`;((Ca=r.advancedConditional)==null?void 0:Ca.type)==="trash_not_empty"&&(De=`If there are any cards in your trash, ${De.charAt(0).toLowerCase()+De.slice(1)}`),s=De;break}case"shuffle_deck":{s="Shuffle your deck.";break}case"redirect_return_to_deck":{s=`Put that card on top of their deck ${r.faceDown!==!1?"face-down ":""}instead.`;break}case"state_number":{s="State a number.";break}case"state_protocol":{s="State a protocol.";break}case"swap_stacks":{s="Swap all of your cards in one of your stacks with another one of your stacks.";break}case"copy_opponent_middle":{s=`${r.optional?"You may resolve":"Resolve"} the middle command of 1 of your opponent's cards as if it were on this card.`;break}case"auto_compile":{if(((mn=r.protocolCountConditional)==null?void 0:mn.type)==="unique_protocols_on_field")s=`If there are ${r.protocolCountConditional.threshold} different protocols on cards in the field, compile this protocol.`;else if(((xn=r.protocolCountConditional)==null?void 0:xn.type)==="same_protocol_count_on_field"){const ge=r.protocolCountConditional.threshold,De=r.protocolCountConditional.faceState==="face_up"?"face-up ":"",Me=r.deleteAllInLane?" and delete all cards in this line":"";s=`If there are ${ge} or more ${De}${c} cards in the field, compile this protocol${Me}.`}else s="Compile this protocol.";break}case"card_property":{r.property==="ignore_protocol_matching"?s="This card may be played without matching protocols.":s="Card property.";break}default:s="Effect";break}if(t.conditional&&t.conditional.thenEffect){let ge=rl(t.conditional.thenEffect);const De=t.conditional.thenEffect.params;De!=null&&De.useCardFromPreviousEffect&&(ge=ge.replace(/\d+ cards?/i,"that card")),t.conditional.type==="then"?s=`${s.endsWith(".")?s.slice(0,-1):s}, then ${ge.toLowerCase()}`:t.conditional.type==="optional"?s=`${s.endsWith(".")?s.slice(0,-1):s}. You may ${ge.toLowerCase()}`:t.conditional.type==="if_protocol_matches_stated"?s=`${s} If the discarded card matches the stated protocol, ${ge.toLowerCase()}`:s=`${s} If you do, ${ge.toLowerCase()}`}return s},V0=t=>{const n={};for(const r of t){const s=r.params.action;s==="draw"&&(n.draw=!0),s==="flip"&&(n.flip=!0),s==="shift"&&(n.shift=!0),s==="delete"&&(n.delete=!0),s==="discard"&&(n.discard=!0),s==="return"&&(n.return=!0),s==="play"&&(n.play=!0),s==="reveal"&&(n.reveal=!0),s==="give"&&(n.give=!0),s==="take"&&(n.take=!0)}return n},mr=(t,n)=>t.length===0?"":t.map(r=>{var d;const c=rl(r,n),s=r.trigger;if(s==="start")return`<div><span class='emphasis'>Start:</span> ${c}</div>`;if(s==="end")return`<div><span class='emphasis'>End:</span> ${c}</div>`;if(s==="on_cover")return r.onCoverProtocolRestriction==="same_protocol"?`<div><span class='emphasis'>When this card would be covered by another ${(n==null?void 0:n.protocolName)||"[protocol]"} card:</span> First, ${c.toLowerCase()}</div>`:`<div><span class='emphasis'>When this card would be covered:</span> First, ${c.toLowerCase()}</div>`;if(s==="on_flip")return`<div><span class='emphasis'>When this card would be flipped:</span> First, ${c.toLowerCase()}</div>`;if(s==="on_cover_or_flip")return`<div><span class='emphasis'>When this card would be covered or flipped:</span> First, ${c.toLowerCase()}</div>`;if(s==="after_draw"||s==="after_delete"||s==="after_discard"||s==="after_shift"||s==="after_flip"||s==="after_clear_cache"){const u=r.reactiveTriggerActor||"self",p=u==="self"?"you":u==="opponent"?"opponent":"a card is";let f="";s==="after_draw"?f=u==="any"?"drawn":"draw cards":s==="after_delete"?f=u==="any"?"deleted":"delete cards":s==="after_discard"?f=u==="any"?"discarded":"discard cards":s==="after_shift"?f=u==="any"?"shifted":"shift cards":s==="after_flip"?f=u==="any"?"flipped":"flip cards":s==="after_clear_cache"&&(f="clear cache");const h=r.onlyDuringOpponentTurn?" during your opponent's turn":"";return`<div><span class='emphasis'>${`After ${p} ${f}${h}`}:</span> ${c}</div>`}if(s==="after_opponent_discard")return`<div><span class='emphasis'>After your opponent discards cards:</span> ${c}</div>`;if(s==="after_opponent_draw")return`<div><span class='emphasis'>After your opponent draws cards:</span> ${c}</div>`;if(s==="after_refresh"){const u=r.reactiveTriggerActor||"self";let p="After you refresh:";return u==="opponent"?p="After your opponent refreshes:":u==="any"&&(p="After a player refreshes:"),`<div><span class='emphasis'>${p}</span> ${c}</div>`}if(s==="after_opponent_refresh")return`<div><span class='emphasis'>After your opponent refreshes:</span> ${c}</div>`;if(s==="after_compile")return`<div><span class='emphasis'>After you compile:</span> ${c}</div>`;if(s==="after_opponent_compile")return`<div><span class='emphasis'>After your opponent compiles:</span> ${c}</div>`;if(s==="after_shuffle"){const u=r.reactiveTriggerActor||"self";let p="After you shuffle your deck:";return u==="opponent"?p="After your opponent shuffles their deck:":u==="any"&&(p="After any player shuffles their deck:"),`<div><span class='emphasis'>${p}</span> ${c}</div>`}if(s==="after_play"){const u=r.reactiveTriggerActor||"self",p=r.reactiveScope||"global";return u==="opponent"&&p==="this_lane"?`<div><span class='emphasis'>After your opponent plays a card in this line:</span> ${c}</div>`:u==="opponent"?`<div><span class='emphasis'>After your opponent plays a card:</span> ${c}</div>`:p==="this_lane"?`<div><span class='emphasis'>After you play a card in this line:</span> ${c}</div>`:`<div><span class='emphasis'>After you play a card:</span> ${c}</div>`}return s==="before_compile_delete"?`<div><span class='emphasis'>When this card would be deleted by compiling:</span> ${c}</div>`:s==="when_card_returned"?`<div><span class='emphasis'>When a card would be returned to ${(((d=r.params)==null?void 0:d.targetOwner)||"opponent")==="opponent"?"your opponent's":"your"} hand:</span> ${c}</div>`:c}).join(" "),H0=(t,n)=>{var h,_,y;const r={protocolName:n.name},c=((h=t.text)==null?void 0:h.top)!==void 0?t.text.top:mr(t.topEffects,r),s=((_=t.text)==null?void 0:_.middle)!==void 0?t.text.middle:mr(t.middleEffects,r),d=((y=t.text)==null?void 0:y.bottom)!==void 0?t.text.bottom:mr(t.bottomEffects,r),u=[...t.topEffects,...t.middleEffects,...t.bottomEffects],p=V0(u);return{protocol:n.name,value:t.value,top:c,middle:s,bottom:d,keywords:p,category:n.category||"Custom",color:n.color,pattern:n.pattern,customEffects:{topEffects:t.topEffects,middleEffects:t.middleEffects,bottomEffects:t.bottomEffects}}},z0=t=>t.cards.map(n=>H0(n,t)),Xo=()=>{try{const t=localStorage.getItem("custom_protocols_v1");if(!t)return[];const r=JSON.parse(t).protocols||[],c=[];for(const s of r){const d=z0(s);c.push(...d)}return c}catch(t){return console.error("Failed to load custom protocol cards:",t),[]}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const qm="custom_protocols_v1",Kd=1,wr=()=>{try{const t=localStorage.getItem(qm);if(!t)return[];const n=JSON.parse(t);return n.version!==Kd&&console.warn(`Custom protocol storage version mismatch: expected ${Kd}, got ${n.version}`),n.protocols||[]}catch(t){return console.error("Error loading custom protocols:",t),[]}},du=t=>{try{const n={protocols:t,version:Kd};localStorage.setItem(qm,JSON.stringify(n))}catch(n){console.error("Error saving custom protocols:",n)}},vt=t=>{const n=wr(),r=n.findIndex(c=>c.id===t.id);r>=0?n[r]=t:n.push(t),du(n)},B0=t=>{const r=wr().filter(c=>c.id!==t);du(r)},G0=["anarchy-custom-001","apathy_custom","assimilation-custom-001","chaos_custom_1","clarity-custom-001","corruption-custom-001","courage-custom-001","darkness_custom_v1","death_custom_v1","diversity-custom-001","fear_custom","fire-custom-001","frost_custom_1","gravity_custom_1","hate-custom-001","ice_custom","life_custom_1","light_custom_1","love_custom_v1","luck-custom-001","metal_custom_1","mirror-custom-001","peace-custom-001","plague-custom-001","psychic_custom_v1","smoke-custom-001","speed_custom_1","spirit_custom_1","time-custom-001","unity-custom-001","war-custom-001","water_custom_1"],sl=t=>G0.includes(t.id),Y0=(t,n)=>{const r=(s,d)=>{s=s.replace("#","");const u=parseInt(s.substring(0,2),16),p=parseInt(s.substring(2,4),16),f=parseInt(s.substring(4,6),16);return`rgba(${u}, ${p}, ${f}, ${d})`},c={borderColor:n};switch(t){case"solid":return{...c,backgroundColor:n};case"radial":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`radial-gradient(circle at 50% 50%, ${r(n,.25)} 0%, transparent 60%)`};case"dual-radial":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 0% 0%, ${r(n,.2)}, transparent 50%),
                    radial-gradient(at 100% 100%, ${r(n,.2)}, transparent 50%)
                `};case"multi-radial":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 0%, ${r(n,.2)}, transparent 70%),
                    radial-gradient(circle at 20% 30%, ${r(n,.15)}, transparent 40%),
                    radial-gradient(circle at 80% 70%, ${r(n,.2)}, transparent 50%)
                `};case"chaos":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 10% 10%, hsla(60, 100%, 50%, 0.15), transparent 30%),
                    radial-gradient(at 90% 20%, hsla(180, 100%, 50%, 0.15), transparent 35%),
                    radial-gradient(at 30% 80%, hsla(300, 100%, 50%, 0.15), transparent 40%),
                    radial-gradient(at 70% 60%, hsla(0, 100%, 50%, 0.1), transparent 25%)
                `};case"grid":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(circle at 50% 50%, ${r(n,.2)} 0%, transparent 40%),
                    linear-gradient(hsla(0,0%,100%,0.03) 1px, transparent 1px),
                    linear-gradient(90deg, hsla(0,0%,100%,0.03) 1px, transparent 1px)
                `,backgroundSize:"100% 100%, 20px 20px, 20px 20px"};case"diagonal-lines":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 0% 100%, ${r(n,.25)}, transparent 70%),
                    repeating-linear-gradient(120deg, transparent, transparent 15px, ${r(n,.05)} 15px, ${r(n,.05)} 30px)
                `};case"cross-diagonal":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 50%, ${r(n,.25)} 0%, transparent 50%),
                    repeating-linear-gradient(45deg, transparent, transparent 8px, ${r(n,.08)} 8px, ${r(n,.08)} 16px),
                    repeating-linear-gradient(-45deg, transparent, transparent 8px, ${r(n,.06)} 8px, ${r(n,.06)} 16px)
                `};case"horizontal-lines":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 80% 80%, ${r(n,.1)}, transparent 50%),
                    repeating-linear-gradient(0deg, hsla(0,0%,100%,0.02), hsla(0,0%,100%,0.02) 1px, transparent 1px, transparent 3px)
                `};case"vertical-lines":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 10% 10%, ${r(n,.2)}, transparent 50%),
                    repeating-linear-gradient(175deg, transparent, transparent 1px, ${r(n,.05)} 1px, ${r(n,.05)} 2px)
                `};case"cross":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    linear-gradient(0deg, transparent 40%, ${r(n,.1)} 50%, transparent 60%),
                    linear-gradient(90deg, transparent 48%, ${r(n,.2)} 50%, transparent 52%)
                `};case"hexagons":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 0%, ${r(n,.2)}, transparent 70%),
                    url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='28' height='49' viewBox='0 0 28 49'%3E%3Cg fill-rule='evenodd'%3E%3Cg id='hexagons' fill='${encodeURIComponent(n)}' fill-opacity='0.05' fill-rule='nonzero'%3E%3Cpath d='M13.99 9.25l13 7.5v15l-13 7.5L1 31.75v-15l12.99-7.5zM3 17.9v12.7l10.99 6.34 11-6.35V17.9l-11-6.34L3 17.9zM0 15l12.99-7.5L26 15v18.5l-13 7.5L0 33.5V15z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")
                `};case"stripes":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 100%, ${r(n,.25)}, transparent 60%),
                    linear-gradient(135deg, hsla(0,0%,0%,0.1) 23%, transparent 23%, transparent 25%, hsla(0,0%,0%,0.1) 25%, hsla(0,0%,0%,0.1) 27%, transparent 27%, transparent 73%, hsla(0,0%,0%,0.1) 73%, hsla(0,0%,0%,0.1) 75%, transparent 75%, transparent 77%, hsla(0,0%,0%,0.1) 77%)
                `};default:return{...c,backgroundColor:n}}},W0=({protocols:t,onCreateNew:n,onEdit:r,onDelete:c,onImport:s,onBack:d})=>{const[u,p]=ce.useState(!1),[f,h]=ce.useState(!1),[_,y]=ce.useState(""),[m,g]=ce.useState(""),x=u?t:t.filter(b=>!sl(b)),C=()=>{g("");try{const b=JSON.parse(_);if(!b.name||!b.color||!b.pattern||!Array.isArray(b.cards)){g("Invalid protocol format. Missing required fields.");return}if(b.cards.length!==6){g("Invalid protocol: must have exactly 6 cards.");return}const j=t.find(k=>k.name.toLowerCase()===b.name.toLowerCase());if(j){confirm(`A protocol named "${b.name}" already exists. Overwrite it?`)&&(b.id=j.id,s(b),h(!1),y(""),alert("Protocol imported and overwritten successfully!"));return}b.id=Date.now().toString(),b.createdAt=new Date().toISOString(),s(b),h(!1),y(""),alert("Protocol imported successfully!")}catch{g("Invalid JSON format. Please check your input.")}};return o.jsxs("div",{className:"protocol-list",children:[o.jsxs("div",{className:"list-header",children:[o.jsx("h2",{children:"Custom Protocols"}),o.jsxs("div",{className:"header-actions",children:[o.jsxs("label",{className:"system-protocols-toggle",children:[o.jsx("input",{type:"checkbox",checked:u,onChange:b=>p(b.target.checked)}),"Show System Protocols"]}),o.jsx("button",{onClick:()=>h(!0),className:"btn",children:"Import Protocol"}),d&&o.jsx("button",{onClick:d,className:"btn btn-back",children:"Back"})]})]}),f&&o.jsx("div",{className:"custom-protocol-modal-overlay",onClick:()=>h(!1),children:o.jsxs("div",{className:"custom-protocol-modal-content",onClick:b=>b.stopPropagation(),children:[o.jsx("h3",{children:"Import Protocol"}),o.jsx("p",{children:"Paste the protocol JSON below:"}),o.jsx("textarea",{value:_,onChange:b=>y(b.target.value),placeholder:'{"name":"Protocol Name","color":"#1976D2",...}',rows:10,className:"import-textarea"}),m&&o.jsx("div",{className:"error-message",children:m}),o.jsxs("div",{className:"custom-protocol-modal-actions",children:[o.jsx("button",{onClick:()=>h(!1),className:"btn btn-back",children:"Cancel"}),o.jsx("button",{onClick:C,className:"btn",children:"Import"})]})]})}),o.jsxs("div",{className:"protocols-grid",children:[o.jsxs("div",{className:"protocol-card new-protocol-card",onClick:n,children:[o.jsx("div",{className:"protocol-header new-protocol-header",children:o.jsxs("div",{className:"protocol-header-content",children:[o.jsx("h3",{children:"+ New Protocol"}),o.jsx("p",{className:"header-description",children:"Create a custom protocol"})]})}),o.jsx("div",{className:"protocol-body new-protocol-body"})]}),x.map(b=>{const j=sl(b);return o.jsx("div",{className:`protocol-card ${j?"system-protocol":""}`,style:Y0(b.pattern,b.color),onClick:()=>r(b),children:o.jsxs("div",{className:"protocol-header-content",children:[o.jsx("h3",{children:b.name}),j&&o.jsx("span",{className:"system-badge",children:"System"}),b.description&&o.jsx("p",{className:"header-description",children:b.description})]})},b.id)})]})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Lm="customProtocolsEnabled";function uu(){try{return localStorage.getItem(Lm)==="true"}catch{return!1}}function Q0(t){try{localStorage.setItem(Lm,t?"true":"false")}catch{}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */let bc=null;function X0(){if(!bc){const t=uu(),n=Xo(),r=wr(),c=new Set(r.filter(s=>sl(s)).map(s=>s.name));bc=n.filter(s=>c.has(s.protocol)||t)}return bc}function os(){bc=null}function uo(t){const n=X0(),r=[];for(const c of t){const s=n.filter(d=>d.protocol===c);r.push(...s)}return r}function qn(t){const n=[...t];for(let r=n.length-1;r>0;r--){const c=Math.floor(Math.random()*(r+1));[n[r],n[c]]=[n[c],n[r]]}return n}function um({onNavigate:t,difficulty:n,setDifficulty:r,useControl:c,onUseControlChange:s}){const[d,u]=ce.useState(null),[p,f]=ce.useState(null),[h,_]=ce.useState(null),[y,m]=ce.useState([]),[g,x]=ce.useState(!0),[C,b]=ce.useState(0);ce.useEffect(()=>{const k=new Set;for(;k.size<2&&k.size<Kn.length;)k.add(Math.floor(Math.random()*Kn.length));const E=Array.from(k).map(T=>Kn[T]);E.length>0&&(_(E[0]),f(E[0])),E.length>1&&u(E[1]),m(qn(Kn))},[]);const j=()=>{const k=C+1;if(b(k),k>=5){const E=!g;x(E),Q0(E),b(0)}};return o.jsxs("div",{className:"screen main-menu",children:[o.jsx("h1",{children:"COMPILE: MAIN 1 & 2"}),o.jsxs("div",{className:"main-menu-attribution",children:[o.jsxs("p",{children:["based on the card game ",o.jsx("a",{href:"https://boardgamegeek.com/boardgame/406652/compile-main-1",target:"_blank",rel:"noopener noreferrer",children:"Compile: Main 1"})," designed by ",o.jsx("a",{href:"https://justgravyllc.com/",target:"_blank",rel:"noopener noreferrer",children:"Michael Yang"})]}),o.jsxs("p",{children:[o.jsx("span",{onClick:j,style:{cursor:"default",userSelect:"none"},children:"developed"})," by ",o.jsx("a",{href:"https://apo-games.de/",target:"_blank",rel:"noopener noreferrer",children:"Dirk Aporius"})]})]}),o.jsxs("div",{className:"main-menu-layout",children:[o.jsx("div",{className:"main-menu-preview decorative-card",children:p&&o.jsx(St,{card:{...p,id:"preview",isFaceUp:!0},isFaceUp:!0})}),o.jsxs("div",{className:"main-menu-actions-container",children:[o.jsxs("div",{className:"main-menu-start-group",children:[o.jsxs("div",{className:"difficulty-selector",children:[o.jsx("h3",{className:"difficulty-title",children:"Difficulty"}),o.jsxs("div",{className:"difficulty-options",children:[o.jsx("button",{className:`btn ${n==="easy"?"active":""}`,onClick:()=>r("easy"),children:"Easy"}),o.jsx("button",{className:`btn ${n==="normal"?"active":""}`,onClick:()=>r("normal"),children:"Normal"}),o.jsx("button",{className:`btn btn-wip ${n==="hard"?"active":""}`,disabled:!0,children:"Hard"})]})]}),o.jsxs("div",{className:"control-mechanic-selector",children:[o.jsx("input",{type:"checkbox",id:"control-mechanic",checked:c,onChange:k=>s(k.target.checked)}),o.jsx("label",{htmlFor:"control-mechanic",children:"Use Control Mechanic"})]}),o.jsx("button",{className:"btn btn-start",onClick:()=>t("ProtocolSelection"),children:"Start Game"})]}),o.jsxs("div",{className:"main-menu-other-actions",children:[o.jsx("button",{className:"btn",onClick:()=>t("CardLibrary"),children:"Cards"}),o.jsx("button",{className:"btn",onClick:()=>t("Statistics"),children:"Statistics"}),g&&o.jsx("button",{className:"btn",onClick:()=>t("CustomProtocols"),children:"Custom Protocols"}),o.jsx("button",{className:"btn",onClick:()=>t("Rules"),children:"Rules"}),o.jsx("p",{className:"version-info",children:"Version 0.30"})]})]}),o.jsx("div",{className:"decorative-card decorative-card-right",children:d&&o.jsx(St,{card:{...d,id:"deco-2",isFaceUp:!0},isFaceUp:!0})})]}),o.jsx("div",{className:"card-ticker-container",onPointerLeave:()=>f(h),children:o.jsxs("div",{className:"card-ticker-track",children:[y.map((k,E)=>o.jsx(St,{card:{...k,id:`ticker-1-${E}`,isFaceUp:!0},isFaceUp:!0,additionalClassName:"in-hand",onPointerEnter:()=>f(k)},`ticker-1-${E}`)),y.map((k,E)=>o.jsx(St,{card:{...k,id:`ticker-2-${E}`,isFaceUp:!0},isFaceUp:!0,additionalClassName:"in-hand",onPointerEnter:()=>f(k)},`ticker-2-${E}`))]})})]})}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function $c({title:t,onBack:n}){return o.jsxs("header",{className:"app-header",children:[o.jsx("h2",{children:t}),n&&o.jsx("button",{className:"btn btn-back",onClick:n,children:"Back"})]})}const wc=[{player:"Player",picks:1},{player:"Opponent",picks:2},{player:"Player",picks:2},{player:"Opponent",picks:1}];function Z0({onBack:t,onStartGame:n}){const[r,c]=ce.useState(0),[s,d]=ce.useState([]),[u,p]=ce.useState([]),[f,h]=ce.useState([]),[_,y]=ce.useState(!1),[m,g]=ce.useState(null),[x,C]=ce.useState(null),[b,j]=ce.useState(0);ce.useEffect(()=>{os(),j(Z=>Z+1)},[]);const k=ce.useMemo(()=>{const Z=uu(),te=Xo(),ee=wr(),se=new Set(ee.filter(fe=>sl(fe)).map(fe=>fe.name));return te.filter(fe=>se.has(fe.protocol)||Z)},[b]),E=ce.useMemo(()=>{const Z=new Set(k.map(te=>te.protocol));return Array.from(Z).sort()},[k]),T=ce.useMemo(()=>{const Z=new Set(k.map(te=>te.category));return Array.from(Z).sort()},[k]),F=["Fan-Content","Main 2","Aux 2"],[U,D]=ce.useState(new Set),[I,W]=ce.useState(!1);ce.useEffect(()=>{if(T.length>0&&!I){const Z=new Set(T);F.forEach(te=>Z.delete(te)),D(Z),W(!0)}},[T,I]);const z=Z=>{const te=k.find(ee=>ee.protocol===Z);return(te==null?void 0:te.category)||""},V=Z=>{const ee=k.find(se=>se.protocol===Z);return ee!=null&&ee.color?{"--card-custom-color":ee.color,borderColor:ee.color}:{}},B=Z=>{const ee=k.find(se=>se.protocol===Z);return ee!=null&&ee.pattern?`pattern-${ee.pattern}`:""},L=ce.useMemo(()=>E.filter(Z=>{const te=z(Z);return U.has(te)}),[U]),P=Z=>{D(te=>{const ee=new Set(te);return ee.has(Z)?ee.delete(Z):ee.add(Z),ee})},M=wc[r],N=(M==null?void 0:M.player)==="Player",R=(M==null?void 0:M.player)==="Opponent",$=ce.useMemo(()=>new Set([...s,...u]),[s,u]),X=ce.useMemo(()=>f.map(Z=>({name:Z,cards:k.filter(te=>te.protocol===Z).sort((te,ee)=>te.value-ee.value)})),[f]),G=Z=>{if(!N||_)return;const te=k.filter(ee=>ee.protocol===Z).sort((ee,se)=>ee.value-se.value);te.length>0&&C(te[0]),h(ee=>{if(ee.includes(Z))return ee.filter(se=>se!==Z);if(ee.length<M.picks)return[...ee,Z];if(ee.length===M.picks){const se=ee.slice(1);return se.push(Z),se}return ee})},q=async()=>{if(!N||_||f.length!==M.picks)return;y(!0);const Z=[...f];h([]);for(const te of Z)d(ee=>[...ee,te]),await new Promise(ee=>setTimeout(ee,300));y(!1),c(te=>te+1)};ce.useEffect(()=>{R&&!_&&r<wc.length&&(async()=>{y(!0),await new Promise(oe=>setTimeout(oe,100));const te=[],ee=E.filter(oe=>{if($.has(oe))return!1;const H=z(oe);return U.has(H)}),se=E.filter(oe=>!$.has(oe)),_e=ee.length>=M.picks?[...ee]:[...se],fe=[],be=te.filter(oe=>_e.includes(oe));for(let oe=0;oe<M.picks;oe++)if(be.length>0){const H=be.shift();fe.push(H);const ne=_e.indexOf(H);ne>-1&&_e.splice(ne,1)}else if(_e.length>0){const H=Math.floor(Math.random()*_e.length);fe.push(_e.splice(H,1)[0])}for(const oe of fe)await new Promise(H=>setTimeout(H,1e3)),g(oe),await new Promise(H=>setTimeout(H,1e3)),g(null),p(H=>[...H,oe]);y(!1),c(oe=>oe+1)})()},[r,R,_,$,M,U,E,z]),ce.useEffect(()=>{r>=wc.length&&!_&&setTimeout(()=>{n(s,u)},1e3)},[r,_,n,s,u]);const Q=Z=>{const te=["protocol-card",`card-protocol-${Z.toLowerCase()}`];return f.includes(Z)&&te.push("selected"),$.has(Z)&&te.push("chosen"),m===Z&&te.push("is-scanning"),te.join(" ")},K=()=>_&&R?"Opponent is selecting protocols...":(M==null?void 0:M.player)==="Player"?`Player, select ${M.picks} protocol(s). (${f.length}/${M.picks})`:r>=wc.length?"Finalizing selections...":"Waiting for Opponent...";return o.jsxs("div",{className:"screen protocol-selection-screen",children:[o.jsx($c,{title:"Protocol Selection",onBack:t}),o.jsxs("div",{className:"protocol-selection-layout",children:[o.jsxs("div",{className:"protocol-selection-sidebar",children:[o.jsxs("div",{className:"player-protocols-area",children:[o.jsx("h3",{children:"Your Protocols"}),s.map(Z=>o.jsx("div",{className:`protocol-display-card player card-protocol-${Z.toLowerCase()} ${B(Z)}`,style:V(Z),children:Z},Z))]}),o.jsx("div",{className:"protocol-preview-area",children:x?o.jsx(St,{card:{...x,id:"preview",isFaceUp:!0},isFaceUp:!0}):o.jsx("p",{children:X.length>0?"Hover over a card below to see details.":"Select a protocol to see its cards."})})]}),o.jsxs("div",{className:"protocol-grid-container",children:[o.jsx("p",{children:K()}),o.jsx("div",{className:"category-filters",children:T.map(Z=>o.jsxs("label",{className:"category-filter-item",children:[o.jsx("input",{type:"checkbox",checked:U.has(Z),onChange:()=>P(Z)}),o.jsx("span",{children:Z})]},Z))}),o.jsx("div",{className:"protocol-grid-scroll-wrapper",children:o.jsx("div",{className:"protocol-grid",children:L.map(Z=>{const te=V(Z),se={fontSize:Z.length>10?"0.65em":"1em"};return o.jsxs("div",{className:`${Q(Z)} ${B(Z)}`,style:te,onClick:()=>G(Z),role:"button","aria-disabled":$.has(Z)||!N||_,tabIndex:!$.has(Z)&&N&&!_?0:-1,onKeyPress:_e=>_e.key==="Enter"&&G(Z),children:[o.jsx("span",{className:"protocol-category-label",children:z(Z)}),o.jsx("span",{className:"protocol-name",style:se,children:Z})]},Z)})})}),N&&o.jsx("button",{className:"btn",onClick:q,disabled:_||f.length!==(M==null?void 0:M.picks),children:"Confirm Selection"})]}),o.jsxs("div",{className:"opponent-protocols-area",children:[o.jsx("h3",{children:"Opponent Protocols"}),u.map(Z=>o.jsx("div",{className:`protocol-display-card opponent card-protocol-${Z.toLowerCase()} ${B(Z)}`,style:V(Z),children:Z},Z))]})]}),o.jsx("div",{className:"selected-protocol-cards-container",children:X.length>0&&[...X].reverse().map(Z=>o.jsx("div",{className:"protocol-card-row",children:Z.cards.map(te=>o.jsx(St,{card:{...te,id:`selection-${te.protocol}-${te.value}`,isFaceUp:!0},isFaceUp:!0,additionalClassName:"in-hand",onClick:()=>C(te),onPointerEnter:()=>C(te)},`${Z.name}-${te.value}`))},Z.name))})]})}const K0="modulepreload",J0=function(t){return"/"+t},pm={},ew=function(n,r,c){let s=Promise.resolve();if(r&&r.length>0){let u=function(h){return Promise.all(h.map(_=>Promise.resolve(_).then(y=>({status:"fulfilled",value:y}),y=>({status:"rejected",reason:y}))))};document.getElementsByTagName("link");const p=document.querySelector("meta[property=csp-nonce]"),f=(p==null?void 0:p.nonce)||(p==null?void 0:p.getAttribute("nonce"));s=u(r.map(h=>{if(h=J0(h),h in pm)return;pm[h]=!0;const _=h.endsWith(".css"),y=_?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${y}`))return;const m=document.createElement("link");if(m.rel=_?"stylesheet":K0,_||(m.as="script"),m.crossOrigin="",m.href=h,f&&m.setAttribute("nonce",f),document.head.appendChild(m),_)return new Promise((g,x)=>{m.addEventListener("load",g),m.addEventListener("error",()=>x(new Error(`Unable to preload CSS for ${h}`)))})}))}function d(u){const p=new Event("vite:preloadError",{cancelable:!0});if(p.payload=u,window.dispatchEvent(p),!p.defaultPrevented)throw u}return s.then(u=>{for(const p of u||[])p.status==="rejected"&&d(p.reason);return n().catch(d)})},pn=[];for(let t=0;t<256;++t)pn.push((t+256).toString(16).slice(1));function tw(t,n=0){return(pn[t[n+0]]+pn[t[n+1]]+pn[t[n+2]]+pn[t[n+3]]+"-"+pn[t[n+4]]+pn[t[n+5]]+"-"+pn[t[n+6]]+pn[t[n+7]]+"-"+pn[t[n+8]]+pn[t[n+9]]+"-"+pn[t[n+10]]+pn[t[n+11]]+pn[t[n+12]]+pn[t[n+13]]+pn[t[n+14]]+pn[t[n+15]]).toLowerCase()}let zd;const nw=new Uint8Array(16);function aw(){if(!zd){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");zd=crypto.getRandomValues.bind(crypto)}return zd(nw)}const ow=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),fm={randomUUID:ow};function ct(t,n,r){var s;if(fm.randomUUID&&!t)return fm.randomUUID();t=t||{};const c=t.random??((s=t.rng)==null?void 0:s.call(t))??aw();if(c.length<16)throw new Error("Random bytes length must be >= 16");return c[6]=c[6]&15|64,c[8]=c[8]&63|128,tw(c)}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const ae=(t,n,r,c)=>{let s=t._logIndentLevel||0;t._currentPhaseContext&&s===0&&(s=1);const d={player:n,message:r,indentLevel:s,sourceCard:t._currentEffectSource,phase:t._currentPhaseContext,sourceCardRef:c==null?void 0:c.sourceCardRef,targetCardRefs:c==null?void 0:c.targetCardRefs};return{...t,log:[...t.log,d]}},Ma=t=>({...t,_logIndentLevel:(t._logIndentLevel||0)+1}),Yo=t=>({...t,_logIndentLevel:Math.max(0,(t._logIndentLevel||0)-1)}),Ke=(t,n)=>({...t,_currentEffectSource:n}),tt=(t,n)=>({...t,_currentPhaseContext:n});/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function Sn(t){const n=[];for(const r of["player","opponent"])t[r].lanes.forEach((c,s)=>{c.forEach((d,u)=>{if(d.isFaceUp){const p=d;if(p.customEffects){const f=u===c.length-1;(p.customEffects.topEffects||[]).forEach(y=>{y.params.action==="passive_rule"&&y.trigger==="passive"&&n.push({rule:y.params.rule,cardOwner:r,laneIndex:s,sourceCardId:d.id})}),(p.customEffects.middleEffects||[]).forEach(y=>{y.params.action==="passive_rule"&&y.trigger==="passive"&&n.push({rule:y.params.rule,cardOwner:r,laneIndex:s,sourceCardId:d.id})}),f&&(p.customEffects.bottomEffects||[]).forEach(m=>{m.params.action==="passive_rule"&&m.trigger==="passive"&&n.push({rule:m.params.rule,cardOwner:r,laneIndex:s,sourceCardId:d.id})})}d.protocol==="Frost"&&d.value===1&&(n.push({rule:{type:"block_flips",target:"all",scope:"global"},cardOwner:r,laneIndex:s}),u===c.length-1&&n.push({rule:{type:"block_protocol_rearrange",target:"all",scope:"global"},cardOwner:r,laneIndex:s})),d.protocol==="Frost"&&d.value===3&&n.push({rule:{type:"block_shifts_from_and_to_lane",target:"all",scope:"this_lane"},cardOwner:r,laneIndex:s})}})});return n}function yr(t,n,r,c,s,d,u){var j,k,E;const p=Sn(t),f=n==="player"?"opponent":"player",h=t[n].protocols[r],_=t[f].protocols[r],y=s===h||s===_;let m=!1,g=!1;if(d){const T=d,F=[...((j=T.customEffects)==null?void 0:j.topEffects)||[],...((k=T.customEffects)==null?void 0:k.middleEffects)||[],...((E=T.customEffects)==null?void 0:E.bottomEffects)||[]];m=F.some(U=>{var D,I,W;return((D=U.params)==null?void 0:D.action)==="passive_rule"&&((W=(I=U.params)==null?void 0:I.rule)==null?void 0:W.type)==="allow_play_on_opponent_side"}),g=F.some(U=>{var D,I;return((D=U.params)==null?void 0:D.action)==="card_property"&&((I=U.params)==null?void 0:I.property)==="ignore_protocol_matching"})}for(const{rule:T,cardOwner:F,laneIndex:U}of p){const D=T.scope==="global"||U===r,I=T.target==="all"||T.target==="self"&&F===n||T.target==="opponent"&&F===f;if(!(!D||!I))switch(T.type){case"block_all_play":return{allowed:!1,reason:"Cannot play cards in this lane (passive rule)"};case"block_face_down_play":if(!c)return{allowed:!1,reason:"Cannot play cards face-down in this lane (passive rule)"};break;case"block_face_up_play":if(c)return{allowed:!1,reason:"Cannot play cards face-up in this lane (passive rule)"};break;case"require_face_down_play":if(c)return{allowed:!1,reason:"Can only play cards face-down (passive rule)"};break;case"allow_any_protocol_play":break;case"require_non_matching_protocol":if(c&&y)return{allowed:!1,reason:"Can only play cards without matching protocols (passive rule)"};break}}const x=p.some(({rule:T,cardOwner:F,laneIndex:U})=>{if(T.type!=="allow_any_protocol_play")return!1;const D=T.scope==="global"||U===r,I=T.target==="all"||T.target==="self"&&F===n||T.target==="opponent"&&F===f;return D&&I}),C=p.some(({rule:T,cardOwner:F,laneIndex:U})=>{if(T.type!=="require_non_matching_protocol")return!1;const D=T.scope==="global"||U===r,I=T.target==="all"||T.target==="self"&&F===n||T.target==="opponent"&&F===f;return D&&I}),b=fl(t,n,r,s);return c&&!y&&!x&&!C&&!m&&!b&&!g&&!u?{allowed:!1,reason:"Face-up play requires matching protocol"}:{allowed:!0}}function pu(t){return Sn(t).some(({rule:r})=>r.type==="require_non_matching_protocol"&&r.scope==="global")}function Ic(t,n,r){const c=Sn(t),s=n==="player"?"opponent":"player";return c.some(({rule:d,cardOwner:u,laneIndex:p})=>{if(d.type!=="allow_any_protocol_play")return!1;const f=d.scope==="global"||r!==void 0&&p===r,h=d.target==="all"||d.target==="self"&&u===n||d.target==="opponent"&&u===s;return f&&h})}function cl(t,n){const r=n.customEffects;return r?(r.bottomEffects||[]).some(s=>{var d,u,p;return((d=s.params)==null?void 0:d.action)!=="passive_rule"?!1:((p=(u=s.params)==null?void 0:u.rule)==null?void 0:p.type)==="allow_play_on_opponent_side"}):!1}function rw(t,n){const r=Sn(t);for(const{rule:c,laneIndex:s}of r)if(!(c.type!=="block_flips"||!(c.scope==="global"||s===n)))return{allowed:!1,reason:"Cards cannot be flipped face-up in this lane (passive rule)"};return{allowed:!0}}function ss(t,n,r){const c=Sn(t);for(const{rule:s,laneIndex:d}of c){if(s.type==="block_shifts_from_lane"&&d===n)return s.scope,{allowed:!1,reason:"Cards cannot shift from this lane (passive rule)"};if(s.type==="block_shifts_to_lane"&&d===r)return s.scope,{allowed:!1,reason:"Cards cannot shift to this lane (passive rule)"};if(s.type==="block_shifts_from_and_to_lane"&&(d===n||d===r))return{allowed:!1,reason:"Cards cannot shift from or to this lane (passive rule)"}}return{allowed:!0}}function lw(t){const n=Sn(t);for(const{rule:r}of n)if(r.type==="block_protocol_rearrange")return{allowed:!1,reason:"Protocols cannot be rearranged (passive rule)"};return{allowed:!0}}function sw(t,n,r){const c=Sn(t),s=t.turn;for(const{rule:d,cardOwner:u,laneIndex:p,sourceCardId:f}of c)if(!(d.type!=="ignore_middle_commands"||!(d.scope==="global"||p===n))&&!(d.onlyDuringYourTurn&&s!==u)){if(r!==void 0){const _=u==="player"?"opponent":"player";if(d.target==="opponent"&&r!==_||d.target==="self"&&r!==u)continue}if(f)for(const _ of["player","opponent"])for(const y of t[_].lanes){const m=y.find(g=>g.id===f);if(m)return m}return null}return null}function Oa(t){return Sn(t).some(({rule:r})=>r.type==="block_flips"&&r.scope==="global")}function cw(t){return Sn(t).some(({rule:r})=>r.type==="block_protocol_rearrange")}function rs(t,n){const r=Sn(t);for(const{rule:c,sourceCardId:s}of r)if(c.type==="block_flip_this_card"&&s===n)return{allowed:!1,reason:"This card cannot be flipped (passive rule)"};return{allowed:!0}}function fu(t,n){const r=Sn(t);for(const{rule:c,cardOwner:s}of r)if(c.type==="block_draw_conditional"){const u=(c.conditionTarget||"self")==="self"?s:s==="player"?"opponent":"player",p=c.blockTarget||"self";let f;if(p==="self"?f=s:p==="opponent"?f=s==="player"?"opponent":"player":f="all",t[u].hand.length>0&&(f==="all"||f===n))return{allowed:!1,reason:"Cannot draw cards (passive rule)"}}return{allowed:!0}}function fl(t,n,r,c){const s=Sn(t);for(const{rule:d,cardOwner:u,laneIndex:p}of s)if(d.type==="allow_same_protocol_face_up_play"&&!(d.scope!=="this_lane"||p!==r)&&u===n&&d.protocolScope==="same_as_source"){const f=t[u].lanes[p];for(let h=0;h<f.length;h++){const _=f[h];if(!_.isFaceUp||!(h===f.length-1))continue;const m=_;if(!m.customEffects)continue;if([...m.customEffects.topEffects||[],...m.customEffects.middleEffects||[],...m.customEffects.bottomEffects||[]].some(C=>{var b,j,k;return((b=C.params)==null?void 0:b.action)==="passive_rule"&&((k=(j=C.params)==null?void 0:j.rule)==null?void 0:k.type)==="allow_same_protocol_face_up_play"})&&_.protocol===c)return!0}}return!1}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const iw={},dw={},uw={},pw={};function hl(t,n,r,c){const{cardOwner:s,opponent:d,triggerType:u}=c,p=r[s].lanes[n];if(!p.find(x=>x.id===t.id))return{newState:r};if(!(u==="uncover"||p.length>0&&p[p.length-1].id===t.id))return{newState:r};const _=sw(r,n,s);if(_){const x=`${t.protocol}-${t.value}`,C=`${_.protocol}-${_.value}`;return{newState:ae(r,s,`${x}: Effect blocked by ${C}.`)}}if(r.skipNextMiddleCommand===t.id){const x=`${t.protocol}-${t.value}`;let C={...r};return delete C.skipNextMiddleCommand,C=ae(C,s,`${x}: Middle commands ignored.`),{newState:C}}const y=t;if(y.customEffects&&y.customEffects.middleEffects&&y.customEffects.middleEffects.length>0){let x=Ma(r);const C=`${t.protocol}-${t.value}`;x=Ke(x,C),x=tt(x,"middle");let b=x;const j=b._pendingCustomEffects;if(j&&j.sourceCardId!==t.id){const T=b.lastCustomEffectTargetCardId,F={type:"execute_remaining_custom_effects",sourceCardId:j.sourceCardId,laneIndex:j.laneIndex,effects:j.effects,context:j.context,actor:j.context.cardOwner,selectedCardFromPreviousEffect:T||j.selectedCardFromPreviousEffect,savedLastCustomEffectTargetCardId:b.lastCustomEffectTargetCardId,logSource:j.logSource,logPhase:j.logPhase,logIndentLevel:j.logIndentLevel},U=b._deferredParentEffects||[];b={...b,_deferredParentEffects:[...U,F]},delete b._pendingCustomEffects}b.lastCustomEffectTargetCardId&&(b={...b,lastCustomEffectTargetCardId:null});for(let T=0;T<y.customEffects.middleEffects.length;T++){const F=y.customEffects.middleEffects[T],U=y.customEffects.middleEffects.slice(T+1),D=U.length>0;if(D&&(b._pendingCustomEffects={sourceCardId:t.id,laneIndex:n,context:c,effects:U,logSource:b._currentEffectSource,logPhase:b._currentPhaseContext,logIndentLevel:b._logIndentLevel||0}),b=pt(t,n,b,c,F).newState,b.actionRequired)return{newState:Re(b)};const W=b._pendingCustomEffects;W&&D&&W.sourceCardId===t.id&&delete b._pendingCustomEffects}const k=b._deferredParentEffects;if(k&&k.length>0){const T=k[k.length-1],F=k.slice(0,-1);b={...b,_deferredParentEffects:F.length>0?F:void 0,lastCustomEffectTargetCardId:T.savedLastCustomEffectTargetCardId||T.selectedCardFromPreviousEffect,_pendingCustomEffects:{sourceCardId:T.sourceCardId,laneIndex:T.laneIndex,context:T.context,effects:T.effects,selectedCardFromPreviousEffect:T.selectedCardFromPreviousEffect,logSource:T.logSource,logPhase:T.logPhase,logIndentLevel:T.logIndentLevel}}}return{newState:Re(b)}}const m=`${t.protocol}-${t.value}`,g=iw[m];if(g){let x=Ma(r);const C=`${t.protocol}-${t.value}`;x=Ke(x,C),x=tt(x,"middle");const b=g(t,n,x,c);let j=b.newState;const k=Re(j);return{...b,newState:k}}return{newState:r}}function qc(t,n,r,c){if(!t.isFaceUp)return{newState:r};const s=t;if(s.customEffects){const f=[...s.customEffects.topEffects||[],...s.customEffects.middleEffects||[],...s.customEffects.bottomEffects||[]].filter(h=>{if(!(h.trigger==="on_cover"||h.trigger==="on_cover_or_flip"))return!1;if(h.onCoverProtocolRestriction==="same_protocol"){const y=r._coveringCardProtocol;if(y&&y!==t.protocol)return!1}return!0});if(f.length>0){const h=`${t.protocol}-${t.value}`;let _=Ke(r,h);_=tt(_,"oncover");let y=_;const m=[];for(const x of f){const C=pt(t,n,y,c,x);if(y=C.newState,C.animationRequests&&m.push(...C.animationRequests),y.actionRequired)return{newState:Re(y),animationRequests:m.length>0?m:void 0}}return{newState:Re(y),animationRequests:m.length>0?m:void 0}}}const d=`${t.protocol}-${t.value}`,u=pw[d];if(u){const p=`${t.protocol}-${t.value}`;let f=Ke(r,p);f=tt(f,"oncover");const h=u(t,n,f,c),_=Re(h.newState);return{...h,newState:_}}return{newState:r}}function fw(t,n,r){const c=[],s=new Set,d=r==="Start"?"start":"end";return t[n].lanes.flat().forEach(u=>{var f;if(!u.isFaceUp||s.has(u.id))return;const p=u;if((f=p.customEffects)!=null&&f.topEffects){const h=p.customEffects.topEffects.filter(_=>_.trigger===d);h.length>0&&(c.push({cardId:u.id,box:"top",effectIds:h.map(_=>_.id)}),s.add(u.id))}u.top.includes(`'emphasis'>${r}:`)&&(s.has(u.id)||(c.push({cardId:u.id,box:"top",effectIds:[]}),s.add(u.id)))}),t[n].lanes.forEach(u=>{var h;if(u.length===0)return;const p=u[u.length-1];if(!p.isFaceUp||s.has(p.id))return;const f=p;if((h=f.customEffects)!=null&&h.bottomEffects){const _=f.customEffects.bottomEffects.filter(y=>y.trigger===d);_.length>0&&(c.push({cardId:p.id,box:"bottom",effectIds:_.map(y=>y.id)}),s.add(p.id))}p.bottom.includes(`'emphasis'>${r}:`)&&(s.has(p.id)||(c.push({cardId:p.id,box:"bottom",effectIds:[]}),s.add(p.id)))}),c}function hw(t,n,r){for(let c=0;c<t[n].lanes.length;c++){const s=t[n].lanes[c],d=s.find(u=>u.id===r.cardId);if(d)return!d.isFaceUp||r.box==="bottom"&&!(s.length>0&&s[s.length-1].id===d.id)?null:{card:d,laneIndex:c}}return null}function mw(t,n,r){const c=t,s=r==="Start"?"start":"end";if(c.customEffects){const p=n==="top"?c.customEffects.topEffects:c.customEffects.bottomEffects,f=(p==null?void 0:p.filter(h=>h.trigger===s))||[];if(f.length>0)return f.map(_=>{var g,x;const y=((g=_.params)==null?void 0:g.action)||"effect",m=(x=_.params)==null?void 0:x.count;return m?`${y} ${m}`:y}).join(", ")}const u=(n==="top"?t.top:t.bottom).match(new RegExp(`${r}:\\s*</span>\\s*([^<]+)`,"i"));return u?u[1].trim():r+" effect"}function Nc(t,n,r){const c=t.turn;let s={...t,_logIndentLevel:0};const d=n==="Start",u=d?"_startPhaseEffectSnapshot":"_endPhaseEffectSnapshot",p=d?"_selectedStartEffectId":"_selectedEndEffectId",f=s[p];let h=s[u];h&&h.length>0&&(h.some(D=>s[c].lanes.flat().some(I=>I.id===D.cardId))||(h=void 0,s[u]=void 0)),h||(h=fw(s,c,n),s[u]=h);const _=d?s.processedStartEffectIds||[]:s.processedEndEffectIds||[],y=[];for(const U of h){if(_.includes(U.cardId))continue;const I=hw(s,c,U);I&&y.push({entry:U,card:I.card,laneIndex:I.laneIndex})}if(y.length===0)return s[u]=void 0,s[p]=void 0,{newState:s};let m;if(f&&(m=y.find(U=>U.entry.cardId===f),m||console.warn(`[processTriggeredEffects] Selected effect ${f} not found in valid effects!`),s[p]=void 0),!m){if(y.length>1){const U=y.map(({entry:D,card:I})=>({cardId:D.cardId,cardName:`${I.protocol}-${I.value}`,box:D.box,effectDescription:mw(I,D.box,n)}));return s.actionRequired={type:"select_phase_effect",actor:c,phase:n,availableEffects:U},{newState:s}}m=y[0]}const{entry:g,card:x,laneIndex:C}=m,b=c==="player"?"opponent":"player",j={cardOwner:c,actor:c,currentTurn:t.turn,opponent:b,triggerType:n==="Start"?"start":"end"},k=x,E=n==="Start"?"start":"end";if(k.customEffects){const U=g.box==="top"?k.customEffects.topEffects:k.customEffects.bottomEffects,D=(U==null?void 0:U.filter(I=>I.trigger===E))||[];if(D.length>0){const I=`${x.protocol}-${x.value}`,W=n==="Start"?"start":"end";s=Ke(s,I),s=tt(s,W);const z={...s,_currentPhaseContext:void 0},V=ae(z,c,`${n} effect triggers.`);s={...s,log:V.log},s=Ma(s);for(let B=0;B<D.length;B++){const L=D[B],P=pt(x,C,s,j,L);if(s=Re(P.newState),s.actionRequired){const M=D.slice(B+1);return M.length>0&&(s._pendingCustomEffects={sourceCardId:x.id,laneIndex:C,context:j,effects:M,logSource:s._currentEffectSource,logPhase:s._currentPhaseContext,logIndentLevel:s._logIndentLevel||0}),d?s.processedStartEffectIds=[...s.processedStartEffectIds||[],x.id]:s.processedEndEffectIds=[...s.processedEndEffectIds||[],x.id],{newState:s}}}return d?s.processedStartEffectIds=[...s.processedStartEffectIds||[],x.id]:s.processedEndEffectIds=[...s.processedEndEffectIds||[],x.id],s=Yo(s),s=Ke(s,void 0),s=tt(s,void 0),Nc(s,n,r)}}const T=`${x.protocol}-${x.value}`,F=r[T];if(F){const U=`${x.protocol}-${x.value}`,D=n==="Start"?"start":"end";s=Ke(s,U),s=tt(s,D);const I={...s,_currentPhaseContext:void 0},W=ae(I,c,`${n} effect triggers.`);s={...s,log:W.log},s=Ma(s);const z=F(x,s,j);return s=Re(z.newState),d?s.processedStartEffectIds=[...s.processedStartEffectIds||[],x.id]:s.processedEndEffectIds=[...s.processedEndEffectIds||[],x.id],s.actionRequired?{newState:s}:(s=Yo(s),s=Ke(s,void 0),s=tt(s,void 0),Nc(s,n,r))}return{newState:s}}function hu(t){return Nc(t,"Start",dw)}function Pm(t){return Nc(t,"End",uw)}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const yw=t=>{if(!t.useControlMechanic)return t;const n=t.turn,r=n==="player"?"opponent":"player",c=t[n],s=t[r];let d=0;const u=c.laneValues[0],p=c.laneValues[1],f=c.laneValues[2],h=s.laneValues[0],_=s.laneValues[1],y=s.laneValues[2];if(u>h&&d++,p>_&&d++,f>y&&d++,d>=2&&t.controlCardHolder!==n){let m=Ke(t,void 0);return m=tt(m,void 0),m={...m,_logIndentLevel:0},m=ae(m,n,`${n==="player"?"Player":"Opponent"} gains the Control Component.`),{...m,controlCardHolder:n}}return t},il=t=>{if(t.winner)return t;const n=t.turn;let r={...t};switch(r=Ke(r,void 0),r=tt(r,void 0),r={...r,_logIndentLevel:0},t.phase){case"start":return r=hu(r).newState,r.actionRequired?r:(r=Ke(r,void 0),r=tt(r,void 0),r={...r,_logIndentLevel:0},r._startPhaseEffectSnapshot=void 0,{...r,phase:"control"});case"control":{const c=yw(r);let s=Ke(c,void 0);return s=tt(s,void 0),s={...s,_logIndentLevel:0},{...s,phase:"compile"}}case"compile":{const c=zm(r,n);return c.length>0?{...r,compilableLanes:c}:(r=Ke(r,void 0),r=tt(r,void 0),r={...r,_logIndentLevel:0},{...r,phase:"action",compilableLanes:[]})}case"action":return r=Ke(r,void 0),r=tt(r,void 0),r={...r,_logIndentLevel:0},{...r,phase:"hand_limit"};case"hand_limit":{const c=r[n],s=c.lanes.some(p=>p.length>0&&p[p.length-1].isFaceUp&&p[p.length-1].protocol==="Spirit"&&p[p.length-1].value===0),u=Sn(r).some(({rule:p,cardOwner:f})=>p.type==="skip_check_cache_phase"&&(p.target==="self"&&f===n||p.target==="all")&&f===n);if(s||u){let p=ae(r,n,"Skipping Check Cache phase.");return p=Ke(p,void 0),p=tt(p,void 0),p={...p,_logIndentLevel:0},{...p,phase:"end"}}if(c.hand.length>5){const p=c.hand.length-5;let h=ae(r,n,`Check Cache: ${n==="player"?"Player":"Opponent"} has ${c.hand.length} cards, must discard ${p}.`);return h=Ma(h),{...h,actionRequired:{type:"discard",actor:n,count:p}}}return r=Ke(r,void 0),r=tt(r,void 0),r={...r,_logIndentLevel:0},{...r,phase:"end"}}case"end":{const c={...r};r=Pm(r).newState;const s=c.actionRequired,d=r.actionRequired;if(d&&d!==s||r.queuedActions&&r.queuedActions.length>0&&(r=dl(r),r.actionRequired))return r;const u=n==="player"?"opponent":"player",p={...r[n],cannotCompile:!1};return r=Ke(r,void 0),r=tt(r,void 0),r={...r,_logIndentLevel:0},r=Re(r),{...r,[n]:p,turn:u,phase:"start",processedStartEffectIds:[],processedEndEffectIds:[],processedSpeed1TriggerThisTurn:!1,processedUncoverEventIds:[],_startPhaseEffectSnapshot:void 0,_endPhaseEffectSnapshot:void 0,_interruptedTurn:void 0,_interruptedPhase:void 0}}}return t};function nt(t){var p;const n=t._pendingCustomEffects;if(!n||n.effects.length===0)return t;const r=n.effects.map(f=>f.id).join(",");if((p=t.queuedActions)==null?void 0:p.some(f=>{var h;return f.type==="execute_remaining_custom_effects"&&f.sourceCardId===n.sourceCardId&&((h=f.effects)==null?void 0:h.map(_=>_.id).join(","))===r})){const f={...t};return delete f._pendingCustomEffects,f}const s=n.selectedCardFromPreviousEffect||t.lastCustomEffectTargetCardId,d={type:"execute_remaining_custom_effects",sourceCardId:n.sourceCardId,laneIndex:n.laneIndex,effects:n.effects,context:n.context,actor:n.context.cardOwner,selectedCardFromPreviousEffect:s,logSource:n.logSource,logPhase:n.logPhase,logIndentLevel:n.logIndentLevel},u={...t,queuedActions:[d,...t.queuedActions||[]]};return delete u._pendingCustomEffects,u}const Va=t=>{var s,d;let n=nt(t);const r=n._pendingFollowUpEffect;if(r&&!n.actionRequired){const{followUpEffect:u,conditionalType:p,previousHandSize:f,sourceCardId:h,actor:_,savedIndentLevel:y}=r;delete n._pendingFollowUpEffect;const m=Te(n,h);if(m){const g=_,x=n[g].hand.length,C=Math.max(0,(f||0)-x);if(p==="then"||p==="if_executed"&&C>0){const j=`${m.card.protocol}-${m.card.value}`;n=Ke(n,j),n=tt(n,"middle"),y!==void 0&&(n={...n,_logIndentLevel:y});let k=-1;for(let E=0;E<n[m.owner].lanes.length;E++)if(n[m.owner].lanes[E].some(T=>T.id===h)){k=E;break}if(k!==-1){const E={cardOwner:m.owner,opponent:m.owner==="player"?"opponent":"player",currentTurn:n.turn,actor:g,discardedCount:C};if(n=pt(m.card,k,n,E,u).newState,n.actionRequired)return n}}}}if(!n.queuedActions||n.queuedActions.length===0){const u=n._deferredParentEffects;if(u&&u.length>0&&!n.actionRequired){const p=u[u.length-1],f=u.slice(0,-1),h={type:"execute_remaining_custom_effects",sourceCardId:p.sourceCardId,laneIndex:p.laneIndex,effects:p.effects,context:p.context,actor:p.actor||((s=p.context)==null?void 0:s.cardOwner),selectedCardFromPreviousEffect:p.selectedCardFromPreviousEffect,savedLastCustomEffectTargetCardId:p.savedLastCustomEffectTargetCardId,logSource:p.logSource,logPhase:p.logPhase,logIndentLevel:p.logIndentLevel};return Va({...n,_deferredParentEffects:f.length>0?f:void 0,lastCustomEffectTargetCardId:p.savedLastCustomEffectTargetCardId||p.selectedCardFromPreviousEffect,queuedActions:[h]})}return n}let c=[...n.queuedActions];for(;c.length>0;){const u=c.shift();if(u.sourceCardId&&u.type!=="flip_self"){const p=Te(n,u.sourceCardId);if(!p||!p.card.isFaceUp){const f=p?`${p.card.protocol}-${p.card.value}`:"a card",h=n._logSource;n=Ke(n,f),n=ae(n,u.actor,"Queued effect was cancelled because the source is no longer active."),n=Ke(n,h);continue}}if(u.type==="flip_self"){const{sourceCardId:p,actor:f}=u,h=Te(n,p),_=Go(n,p);if(h&&h.card.isFaceUp&&_){const y=`${h.card.protocol}-${h.card.value}`;n=ae(n,f,`${y}: Flips itself.`),n=_r(new Set([p]),n),n.animationState={type:"flipCard",cardId:p}}else{const y=h?`${h.card.protocol}-${h.card.value}`:"the source card",m=h?h.card.isFaceUp?"now covered":"flipped face-down":"deleted";n=ae(n,f,`The self-flip effect from ${y} was cancelled because it is ${m}.`)}continue}if(u.type==="execute_follow_up_effect"){const{sourceCardId:p,followUpEffect:f,actor:h,logContext:_}=u,y=Te(n,p),m=Go(n,p);if(y&&y.card.isFaceUp&&m){const g=n[y.owner].lanes.find(E=>E.some(T=>T.id===p)),x=n[y.owner].lanes.indexOf(g),C={cardOwner:y.owner,actor:h,currentTurn:n.turn,opponent:y.owner==="player"?"opponent":"player"},b=(_==null?void 0:_.sourceCardName)||`${y.card.protocol}-${y.card.value}`,j=(_==null?void 0:_.phase)||(n.phase==="start"?"start":"end");if(n={...n,_logIndentLevel:(_==null?void 0:_.indentLevel)||1,_currentEffectSource:b,_currentPhaseContext:j},n=pt(y.card,x,n,C,f).newState,n.actionRequired)return n={...n,queuedActions:c},n}else{const g=y?`${y.card.protocol}-${y.card.value}`:"the source card",x=y?y.card.isFaceUp?"now covered":"flipped face-down":"deleted";n=ae(n,h,`The follow-up effect from ${g} was cancelled because it is ${x}.`)}continue}if(u.type==="execute_conditional_followup"){const{sourceCardId:p,laneIndex:f,followUpEffect:h,context:_,actor:y}=u,m=[...n.player.lanes.flat(),...n.opponent.lanes.flat()].find(x=>x.id===p);if(!m){n=ae(n,y,"Conditional follow-up effect skipped: source card no longer exists.");continue}if(!m.isFaceUp){const x=`${m.protocol}-${m.value}`;n=ae(n,y,`Conditional follow-up effect from ${x} cancelled: card was flipped face-down.`);continue}const g=pt(m,f,n,_,h);if(n=Re(g.newState),n.actionRequired)return h.conditional&&h.conditional.thenEffect&&(n.actionRequired={...n.actionRequired,followUpEffect:h.conditional.thenEffect,conditionalType:h.conditional.type}),n={...n,queuedActions:c},n;if(h.conditional&&h.conditional.thenEffect){const x=pt(m,f,n,_,h.conditional.thenEffect);if(n=Re(x.newState),n.actionRequired)return n={...n,queuedActions:c},n}continue}if(u.type==="execute_remaining_custom_effects"){const{sourceCardId:p,laneIndex:f,effects:h,context:_,selectedCardFromPreviousEffect:y,logSource:m,logPhase:g,logIndentLevel:x}=u;m!==void 0&&(n={...n,_currentEffectSource:m}),g!==void 0&&(n={...n,_currentPhaseContext:g}),x!==void 0&&(n={...n,_logIndentLevel:x});const C=Te(n,p);if(!C){n=ae(n,_.cardOwner,"Remaining effects cancelled because the source card was deleted or returned.");continue}if(!C.card.isFaceUp){const T=`${C.card.protocol}-${C.card.value}`;n=ae(n,_.cardOwner,`Remaining effects from ${T} cancelled because it was flipped face-down.`);continue}const b=_.triggerType==="start"||_.triggerType==="end";if(!_w(n,p)&&!b){const T=`${C.card.protocol}-${C.card.value}`;n=ae(n,_.cardOwner,`Remaining effects from ${T} cancelled because it is now covered.`);continue}const k=u.savedLastCustomEffectTargetCardId;k&&(n.lastCustomEffectTargetCardId=k),y&&(n._selectedCardFromPreviousEffect=y,k||(n.lastCustomEffectTargetCardId=y));for(let T=0;T<h.length;T++){const F=h[T],U=pt(C.card,f,n,_,F);if(n=U.newState,U.animationRequests&&U.animationRequests.length>0&&!n.actionRequired){const D=h.slice(T+1);if(D.length>0){const W={type:"execute_remaining_custom_effects",sourceCardId:p,laneIndex:f,effects:D,context:_,actor:_.cardOwner,logSource:n._currentEffectSource,logPhase:n._currentPhaseContext,logIndentLevel:n._logIndentLevel||0};n.queuedActions=[W,...c||[]]}else n.queuedActions=c;const I=U.animationRequests[0];return I.type==="draw"?n.animationState={type:"drawCard",owner:I.player,cardIds:[]}:I.type==="play"?n.animationState={type:"playCard",cardId:I.cardId,owner:I.owner}:I.type==="delete"&&(n.animationState={type:"deleteCard",cardId:I.cardId,owner:I.owner}),n}if(n.actionRequired){const D=h.slice(T+1);if(D.length>0&&(n._pendingCustomEffects={sourceCardId:p,laneIndex:f,context:_,effects:D,logSource:n._currentEffectSource,logPhase:n._currentPhaseContext,logIndentLevel:n._logIndentLevel||0}),n._interruptedTurn){const I=n._interruptedTurn,W=n._interruptedPhase||n.phase;delete n._interruptedTurn,delete n._interruptedPhase,n.turn=I,n.phase=W}return n.queuedActions=c,n}}const E=n._deferredParentEffects;if(E&&E.length>0){const T=E[E.length-1],F=E.slice(0,-1);c=[{type:"execute_remaining_custom_effects",sourceCardId:T.sourceCardId,laneIndex:T.laneIndex,effects:T.effects,context:T.context,actor:T.actor||((d=T.context)==null?void 0:d.cardOwner),selectedCardFromPreviousEffect:T.selectedCardFromPreviousEffect,savedLastCustomEffectTargetCardId:T.savedLastCustomEffectTargetCardId,logSource:T.logSource,logPhase:T.logPhase,logIndentLevel:T.logIndentLevel},...c||[]],n={...n,_deferredParentEffects:F.length>0?F:void 0,lastCustomEffectTargetCardId:T.savedLastCustomEffectTargetCardId||T.selectedCardFromPreviousEffect}}continue}if(u.type==="reveal_opponent_hand"){const p=n.turn==="player"?"opponent":"player",f={...n[p]};if(f.hand.length>0){f.hand=f.hand.map(y=>({...y,isRevealed:!0})),n[p]=f;const h=Te(n,u.sourceCardId),_=h?`${h.card.protocol}-${h.card.value}`:"A card effect";n=ae(n,n.turn,`${_}: Opponent reveals their hand.`)}else{const h=Te(n,u.sourceCardId),_=h?`${h.card.protocol}-${h.card.value}`:"A card effect";n=ae(n,n.turn,`${_}: Opponent has no cards to reveal.`)}continue}if(u.type==="pending_uncover_effect"){const{owner:p,laneIndex:f}=u;if(n=ea(n,p,f).newState,n.actionRequired)return n.queuedActions=c,n;continue}if(u.type==="discard"&&u.actor){const p=u.actor,f=n[p].hand.length,h=u.count||1;if(f===0){const _=p==="player"?"Player":"Opponent";if(u.sourceCardId){const y=Te(n,u.sourceCardId);if(y){const m=`${y.card.protocol}-${y.card.value}`;n=Ke(n,m),n=tt(n,"middle");const g=u._savedIndentLevel;g!==void 0&&(n={...n,_logIndentLevel:g})}}n=ae(n,p,`${_} has no cards to discard - effect skipped.`),n=Ke(n,void 0),n=tt(n,void 0),n={...n,_logIndentLevel:0};continue}else typeof h=="number"&&f<h&&(u.count=f)}return n.actionRequired=u,n.queuedActions=c,n}return{...n,queuedActions:[],actionRequired:null}},dl=t=>{var d;if(t.winner||t.actionRequired)return t;const n=t._deferredParentEffects&&t._deferredParentEffects.length>0;if(t.queuedActions&&t.queuedActions.length>0||n){const u=Va(t);if(u.actionRequired)return u;t=u}if(t._interruptedTurn){const u=t._interruptedTurn,p=t._interruptedPhase||t.phase;let f={...t};if(delete f._interruptedTurn,delete f._interruptedPhase,f.turn=u,f.phase=p,p==="start"||p==="end"){if(f.queuedActions&&f.queuedActions.length>0&&(f=Va(f)),!f.actionRequired&&p==="end"){const h=Pm(f).newState;if(h.actionRequired)return h;const _=h.turn==="player"?"opponent":"player",y={...h[h.turn],cannotCompile:!1};let m=Ke(h,void 0);return m=tt(m,void 0),m={...m,_logIndentLevel:0},m=Re(m),{...m,[h.turn]:y,turn:_,phase:"start",processedStartEffectIds:[],processedEndEffectIds:[],processedSpeed1TriggerThisTurn:!1,processedUncoverEventIds:[],_startPhaseEffectSnapshot:void 0,_endPhaseEffectSnapshot:void 0,_interruptedTurn:void 0,_interruptedPhase:void 0}}if(p==="start"&&!f.actionRequired){const h=hu(f).newState;if(h.actionRequired)return h;let _={...h,phase:"control"};return ll(_)}return f}t=f}if(((d=t.actionRequired)==null?void 0:d.type)==="prompt_rearrange_protocols"&&t.actionRequired.originalAction){const u=t.actionRequired.originalAction;let p={...t,actionRequired:null,controlCardHolder:null};if(u.type==="compile")return ll(p);if(u.type==="fill_hand"){const f=xr(p,p.turn,5-p[p.turn].hand.length);return ll(f)}}if(t.queuedEffect){const{card:u,laneIndex:p}=t.queuedEffect,f={...t,queuedEffect:void 0,_committedCardId:void 0},h=Te(f,u.id);if(h){const{card:_,owner:y}=h;let m={...f,_logIndentLevel:0};const g={cardOwner:y,actor:y,currentTurn:m.turn,opponent:y==="player"?"opponent":"player",triggerType:"play"},{newState:x}=hl(_,p,m,g);if(x.actionRequired)return x;t=x}else console.warn(`Skipping queued effect for ${u.protocol}-${u.value} as it is no longer on the board.`),t=ae(t,t.turn,`Skipping queued effect for ${u.protocol}-${u.value} as it is no longer on the board.`),t=f}if(t.queuedActions&&t.queuedActions.length>0){let u={...t},p=[...u.queuedActions];for(;p.length>0;){const f=p.shift(),h=f.type==="flip_self";if(f.sourceCardId&&!h){const _=Te(u,f.sourceCardId);if(!_||!_.card.isFaceUp){const y=_?`${_.card.protocol}-${_.card.value}`:"a card",m=u._logSource;u=Ke(u,y),u=ae(u,f.actor,"Queued effect was cancelled because the source is no longer active."),u=Ke(u,m);continue}}if(h){const{sourceCardId:_,actor:y}=f,m=Te(u,_),g=Go(u,_);if(m&&m.card.isFaceUp&&g){const x=`${m.card.protocol}-${m.card.value}`;u=ae(u,y,`${x}: Flips itself.`),u=_r(new Set([_]),u),u.animationState={type:"flipCard",cardId:_}}else{const x=m?`${m.card.protocol}-${m.card.value}`:"the source card",C=m?m.card.isFaceUp?"now covered":"flipped face-down":"deleted";u=ae(u,y,`The self-flip effect from ${x} was cancelled because it is ${C}.`)}continue}if(f.type==="reveal_opponent_hand"){const _=u.turn==="player"?"opponent":"player",y={...u[_]};if(y.hand.length>0){y.hand=y.hand.map(x=>({...x,isRevealed:!0})),u[_]=y;const m=Te(u,f.sourceCardId),g=m?`${m.card.protocol}-${m.card.value}`:"A card effect";u=ae(u,u.turn,`${g}: Opponent reveals their hand.`)}else{const m=Te(u,f.sourceCardId),g=m?`${m.card.protocol}-${m.card.value}`:"A card effect";u=ae(u,u.turn,`${g}: Opponent has no cards to reveal.`)}continue}if(f.type==="discard"&&f.actor){const _=f.actor,y=u[_].hand.length,m=f.count||1;if(y===0){const g=_==="player"?"Player":"Opponent";if(f.sourceCardId){const x=Te(u,f.sourceCardId);if(x){const C=`${x.card.protocol}-${x.card.value}`;u=Ke(u,C),u=tt(u,"middle");const b=f._savedIndentLevel;b!==void 0&&(u={...u,_logIndentLevel:b})}}u=ae(u,_,`${g} has no cards to discard - effect skipped.`),u=Ke(u,void 0),u=tt(u,void 0),u={...u,_logIndentLevel:0};continue}else typeof m=="number"&&y<m&&(f.count=y)}return u.actionRequired=f,u.queuedActions=p,u}t={...u,queuedActions:[],actionRequired:null}}const r=t.phase==="action"?"hand_limit":t.phase;let c={...t,phase:r,compilableLanes:[],processedUncoverEventIds:[]};const s=t.turn;for(;c.turn===s&&!c.winner;){const u=c.actionRequired,p=c.phase;c=il(c);const f=c.actionRequired;if(f&&f!==u)break;if(c.phase===p&&c.turn===s){console.error("Game is stuck in a phase loop:",c.phase);break}}return c},ll=t=>{if(t.winner)return t;let n={...t};if(n._interruptedTurn){const c=n._interruptedTurn,s=n._interruptedPhase||n.phase;delete n._interruptedTurn,delete n._interruptedPhase,n.turn=c,n.phase=s}const r=n.turn;for(;n.turn===r&&!n.actionRequired&&!n.winner;){const c=n.phase;if(c==="action")break;if(c==="compile"){const d=zm(n,r);if(d.length>0){n={...n,compilableLanes:d};break}}const s=n.phase;if(n=il(n),s===n.phase&&!n.actionRequired){console.error("Game is stuck in an automatic phase loop:",s),console.error("State:",{phase:n.phase,turn:n.turn,actionRequired:n.actionRequired,queuedActions:n.queuedActions,interruptedTurn:n._interruptedTurn});break}}return{...n,animationState:null}},Um=t=>{let n={...t,actionRequired:null};if(n._interruptedTurn)return dl(n);const r=n._deferredParentEffects&&n._deferredParentEffects.length>0;if(n.queuedActions&&n.queuedActions.length>0||r){const d=Va(n);if(d.actionRequired)return d;n=d}const c=hu(n).newState;if(c.actionRequired)return c;let s=c;return s.phase!=="control"&&(s={...s,phase:"control"}),s=il(s),s.actionRequired||(s=il(s)),s},Om=t=>{if(t.winner)return t;let n={...t,phase:"start"};return n=Re(n),n=il(n),n.actionRequired?n:ll(n)},hm=Object.freeze(Object.defineProperty({__proto__:null,advancePhase:il,continueTurnAfterStartPhaseAction:Um,continueTurnProgression:ll,processEndOfAction:dl,processQueuedActions:Va,processStartOfTurn:Om,queuePendingCustomEffects:nt},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * AI Card Memory - Tracks known values of face-down cards
 *
 * The AI can remember card values when:
 * 1. AI plays its own card face-down (AI knows what's in its hand)
 * 2. A face-up card is flipped to face-down (the value was visible)
 * 3. A card is revealed (Psychic effects, etc.)
 *
 * This allows the AI to make smarter decisions about flipping cards.
 */function Mm(t,n,r){const c=t.aiCardMemory||{};return{...t,aiCardMemory:{...c,[n]:r}}}function mm(t,n){return t.aiCardMemory?t.aiCardMemory[n]??null:null}function gw(t,n){return Mm(t,n.id,n.value)}function Ec(t,n){return n.isFaceUp?Mm(t,n.id,n.value):t}function vw(t){if(!t.aiCardMemory)return t;const n=new Set;for(const c of["player","opponent"])for(const s of t[c].lanes)for(const d of s)n.add(d.id);const r={};for(const[c,s]of Object.entries(t.aiCardMemory))n.has(c)&&(r[c]=s);return{...t,aiCardMemory:r}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function Te(t,n){if(!n)return null;for(const r of["player","opponent"])for(let c=0;c<t[r].lanes.length;c++){const d=t[r].lanes[c].find(u=>u.id===n);if(d)return{card:d,owner:r,laneIndex:c}}return null}function Go(t,n){var c;if(!n)return!1;const r=t._committedCardId;for(const s of["player","opponent"])for(const d of t[s].lanes){if(d.length===0)continue;let u=d.length-1;const p=d[d.length-1].id;if(r&&d.length>=2&&p===r&&n!==r&&(u=d.length-2),((c=d[u])==null?void 0:c.id)===n)return!0}return!1}function _w(t,n){if(!n)return!1;for(const r of["player","opponent"])for(const c of t[r].lanes)if(c.length!==0&&c[c.length-1].id===n)return!0;return!1}function Wo(t,n){return n?t._committedCardId===n:!1}function Qo(t,n,r){if(n.length===0||r<0||r>=n.length)return!1;const c=t._committedCardId;let s=n.length-1;return c&&n.length>=2&&n[n.length-1].id===c&&(s=n.length-2),r===s}function ww(t,n,r,c){var f;let s={...t};const d=c||((f=t.actionRequired)==null?void 0:f.followUpEffect),u=Te(s,n),p=u?fn(u.card,s[u.owner].lanes.find(h=>h.some(_=>_.id===n))||[]):0;if(s=nt(s),s.actionRequired=null,d&&r){const h=Te(s,r);if(h){const _={cardOwner:h.owner,opponent:h.owner==="player"?"opponent":"player",currentTurn:s.turn,actor:h.owner,referencedCard:u==null?void 0:u.card,referencedCardValue:p};let y=-1;for(let m=0;m<s[h.owner].lanes.length;m++)if(s[h.owner].lanes[m].some(g=>g.id===r)){y=m;break}if(y!==-1)return pt(h.card,y,s,_,d).newState}}return s}function xw(t,n,r,c){var g,x,C,b,j;let s={...t};const d=(g=t.actionRequired)==null?void 0:g.followUpEffect,u=(x=t.actionRequired)==null?void 0:x.conditionalType;if(s=nt(s),s.actionRequired=null,c&&(s=Yo(s)),d&&c){const k=Te(s,c);if(k){const E=((C=t.actionRequired)==null?void 0:C.previousHandSize)||0,T=s[n].hand.length,F=Math.max(0,E-T);if(!(u==="then"||u==="if_executed"&&F>0))return s;const D={cardOwner:k.owner,opponent:k.owner==="player"?"opponent":"player",currentTurn:s.turn,actor:n,discardedCount:F,previousHandSize:E};let I=-1;for(let W=0;W<s[k.owner].lanes.length;W++)if(s[k.owner].lanes[W].some(z=>z.id===c)){I=W;break}if(I!==-1)return pt(k.card,I,s,D,d).newState}return s}if(!r||!c)return s;const p=((b=t.actionRequired)==null?void 0:b.previousHandSize)||0,f=s[n].hand.length;if(Math.max(0,p-f)===0)return s;const _=(j=Te(s,c))==null?void 0:j.card;_&&`${_.protocol}${_.value}`;const y=s.queuedActions&&s.queuedActions.length>0;let m=null;switch(r){case"fire_1":m={type:"select_cards_to_delete",count:1,sourceCardId:c,disallowedIds:[c],actor:n};break;case"fire_2":m={type:"select_card_to_return",sourceCardId:c,actor:n};break;case"fire_3":m={type:"select_card_to_flip",sourceCardId:c,actor:n,targetFilter:{position:"uncovered",excludeSelf:!0}};break}if(m)if(y){const k=s.queuedActions||[],E=k.filter(F=>F.type==="select_card_to_shift"&&F.followUpEffect),T=k.filter(F=>!(F.type==="select_card_to_shift"&&F.followUpEffect));s.queuedActions=[...T,m,...E]}else s.actionRequired=m;return s}function Jd(t,n,r=null){const c=Te(t,n);if(!c)return t;const{card:s,owner:d}=c;if(!s.isFaceUp){let b=-1;for(let j=0;j<t[d].lanes.length;j++)if(t[d].lanes[j].some(k=>k.id===n)){b=j;break}if(b!==-1&&!rw(t,b).allowed)return t}let p=dt(t,"on_flip",{player:d,cardId:n}).newState;if(!Te(p,n))return p;const h=p.actionRequired&&"actor"in p.actionRequired?p.actionRequired.actor:p.turn,_=h==="player"?"Player":"Opponent",y=d==="player"?"Player's":"Opponent's",m=s.isFaceUp?"face-down":"face-up",g=`${s.protocol}-${s.value}`;p=ae(p,h,`${_} flips ${y} ${g} ${m}.`);const x={...p.stats[h],cardsFlipped:p.stats[h].cardsFlipped+1},C={...p[h],stats:x};return p={...p,[h]:C,stats:{...p.stats,[h]:x}},s.isFaceUp&&(p=Ec(p,s)),p=_r(new Set([n]),p),p.animationState={type:"flipCard",cardId:n},p.actionRequired=r,p}function ea(t,n,r){var u;const c=t[n].lanes[r];if(c.length===0)return{newState:t};const s=c[c.length-1],d=Go(t,s.id);if(s.isFaceUp&&d){const p=`${s.id}-${r}`;if((u=t.processedUncoverEventIds)!=null&&u.includes(p))return{newState:t};const f={source:t._currentEffectSource,phase:t._currentPhaseContext,indentLevel:t._logIndentLevel||0},h=`${s.protocol}-${s.value}`;let _=Ke(t,h);_=tt(_,"uncover"),_=ae(_,n,`${s.protocol}-${s.value} is uncovered and its effects are re-triggered.`),_.processedUncoverEventIds=[..._.processedUncoverEventIds||[],p];const y={cardOwner:n,actor:n,currentTurn:_.turn,opponent:n==="player"?"opponent":"player",triggerType:"uncover"},m=hl(s,r,_,y);if(m.newState.actionRequired||(m.newState={...m.newState,_currentEffectSource:f.source,_currentPhaseContext:f.phase,_logIndentLevel:f.indentLevel}),m.newState.actionRequired){const g=m.newState.actionRequired.actor;if(t._interruptedTurn&&g===t._interruptedTurn){const x=m.newState.actionRequired;return m.newState.actionRequired=null,m.newState.queuedActions=[...m.newState.queuedActions||[],x],m.newState=nt(m.newState),m}m.newState=nt(m.newState),g!==t.turn&&(m.newState._interruptedTurn=t.turn,m.newState._interruptedPhase=t.phase,m.newState.turn=g,m.newState.actionRequired.type==="prompt_rearrange_protocols"&&(m.newState.actionRequired={...m.newState.actionRequired,originalAction:{type:"resume_interrupted_turn",interruptedTurn:t.turn,interruptedPhase:t.phase}}))}else m.newState._interruptedTurn&&(m.newState.turn=m.newState._interruptedTurn,m.newState._interruptedTurn=void 0,m.newState._interruptedPhase=void 0);return m}return{newState:t}}function Cw(t,n,r){var c,s;for(const d of["player","opponent"])for(const u of t[d].lanes)for(const p of u){if(!p.isFaceUp)continue;const f=p.customEffects;if(!f)continue;const h=f.bottomEffects||[];for(const _ of h){if(_.trigger!=="when_card_returned"||((c=_.params)==null?void 0:c.action)!=="redirect_return_to_deck")continue;const y=((s=_.params)==null?void 0:s.targetOwner)||"opponent",m=d;if(y==="opponent"&&n!==m||y==="own"&&n===m)return p}}return null}function eu(t,n,r){const c=Te(t,n);if(!c)return{newState:t};const{card:s,owner:d}=c,u=t[d].lanes.findIndex(F=>F.some(U=>U.id===s.id));if(u===-1)return{newState:t};const p=t[d].lanes[u],f=p.length>0&&p[p.length-1].id===n;let h={...t};const _=h.actionRequired&&"actor"in h.actionRequired?h.actionRequired.actor:h.turn,y=_==="player"?"Player":"Opponent",m=d==="player"?"Player's":"Opponent's",g=`${s.protocol}-${s.value}`,x=r||"owner_hand",C=x==="actor_hand"?_:d,b=x==="owner_hand"?Cw(t,d):null,j={...h[d]};if(j.lanes=j.lanes.map(F=>F.filter(U=>U.id!==n)),h[d]=j,b){const F={...s,isFaceUp:!1,isRevealed:!1},U={...h[d]};U.deck=[F,...U.deck],h[d]=U;const D=`${b.protocol}-${b.value}`;h=ae(h,_,`${D}: ${m} ${g} is put on top of their deck face-down instead of returning to hand.`)}else if(x==="actor_hand"&&_!==d){const F={...h[C]};F.hand=[...F.hand,{...s,isFaceUp:!0,isRevealed:!1}],h[C]=F,h=ae(h,_,`${y} takes ${m} ${g} and puts it into their hand.`)}else{const F={...h[C]};F.hand=[...F.hand,{...s,isFaceUp:!0,isRevealed:!1}],h[C]=F,h=ae(h,_,`${y} returns ${m} ${g} to their hand.`)}h=nt(h);const k={...h.stats[_],cardsReturned:h.stats[_].cardsReturned+1},E={...h[_],stats:k};h={...h,[_]:E},h.actionRequired=null;const T=Re(h);return f&&T[d].lanes[u].length>0?ea(T,d,u):{newState:T}}function Bo(t,n,r,c,s){const d=Te(t,n);if(!d||d.owner!==r)return{newState:t};const{card:u}=d,p=t[r];let f=-1;for(let N=0;N<p.lanes.length;N++)if(p.lanes[N].some(R=>R.id===n)){f=N;break}if(f===-1)return{newState:t};if(f===c)return{newState:t};if(!ss(t,f,c).allowed)return{newState:t};const _=t[r].lanes[f],y=_.length>0&&_[_.length-1].id===n,m=p.lanes.map((N,R)=>R===f?N.filter($=>$.id!==n):N),g=m[c].length>0?m[c][m[c].length-1]:null;let x={...t,[r]:{...p,lanes:m}};x._committedCardId=n;const C=m.map((N,R)=>R===c?[...N,u]:N),b={...p,lanes:C};let j={...x,[r]:b};(!t._currentEffectSource||!t._currentPhaseContext)&&(j=Ke(j,void 0),j=tt(j,void 0));const k=s==="player"?"Player":"Opponent",E=r==="player"?"Player's":"Opponent's",T=u.isFaceUp?`${u.protocol}-${u.value}`:"a card",F=j[r].protocols[c];j=ae(j,s,`${k} shifts ${E} ${T} to Protocol ${F}.`);const U={...j.stats[s],cardsShifted:j.stats[s].cardsShifted+1},D={...j[s],stats:U};j={...j,[s]:D,stats:{...j.stats,[s]:U}},j=nt(j),j.actionRequired=null;let I=Re(j),W={newState:I};if(g){g.customEffects;const N={cardOwner:r,actor:s,currentTurn:I.turn,opponent:r==="player"?"opponent":"player",triggerType:"cover"};W=qc(g,c,I,N)}let z=W.newState,V=[...W.animationRequests||[]];if(y){const N=ea(z,r,f);z=N.newState,N.animationRequests&&V.push(...N.animationRequests)}const B=z[r].lanes[c],L=B.length>0&&B[B.length-1].id===n,P=!y;if(L&&u.isFaceUp&&P){const N=ea(z,r,c);N.animationRequests&&V.push(...N.animationRequests);let R=N.newState;return!R.actionRequired&&(!R.queuedActions||R.queuedActions.length===0)&&(R._committedCardId=void 0),{newState:R,animationRequests:V.length>0?V:void 0}}let M=z;return!M.actionRequired&&(!M.queuedActions||M.queuedActions.length===0)&&(M._committedCardId=void 0),{newState:M,animationRequests:V.length>0?V:void 0}}const Sw=(t,n,r)=>{let c=0;for(const s of["player","opponent"])for(let d=0;d<t[s].lanes.length;d++){const u=t[s].lanes[d];if(u.length>0){const p=u[u.length-1];n.includes(p.id)||c++}}return c},tu=(t,n)=>{var _;const r=Te(t,n);if(!r)return{newState:t};const{card:c,owner:s}=r,d=t[s].lanes.findIndex(y=>y.some(m=>m.id===c.id));if(d===-1)return{newState:t};let u=t;const p=t._pendingCustomEffects;p&&((_=p.effects)==null?void 0:_.length)>0&&p.effects.some(m=>m.useCardFromPreviousEffect)&&(u={...t,_pendingCustomEffects:{...p,selectedCardFromPreviousEffect:n}});const f={cardOwner:s,actor:s,currentTurn:u.turn,opponent:s==="player"?"opponent":"player",triggerType:"flip"},h=hl(c,d,u,f);if(h.newState.actionRequired){h.newState=nt(h.newState);const y=h.newState.actionRequired.actor;if(t._interruptedTurn&&y===t._interruptedTurn)return h.newState.queuedActions=[...h.newState.queuedActions||[],h.newState.actionRequired],h.newState=nt(h.newState),h.newState.actionRequired=null,h;y!==t.turn&&(h.newState._interruptedTurn=t.turn,h.newState._interruptedPhase=t.phase,h.newState.turn=y,h.newState.actionRequired.type==="prompt_rearrange_protocols"&&(h.newState.actionRequired={...h.newState.actionRequired,originalAction:{type:"resume_interrupted_turn",interruptedTurn:t.turn,interruptedPhase:t.phase}}))}return h};function bw(t,n){const r=[];if(t[n].lanes.forEach((s,d)=>{if(s.length>0){const u=s[s.length-1],p=fn(u,s);r.push({card:u,laneIndex:d,owner:n,value:p})}}),r.length===0)return[];const c=Math.max(...r.map(s=>s.value));return r.filter(s=>s.value===c)}function vr(t){const n=new Set;for(const r of["player","opponent"])for(const c of t[r].lanes)for(const s of c)s.isFaceUp&&n.add(s.protocol);return n.size}function Ew(t,n){const r=new Set;for(const c of["player","opponent"]){const s=t[c].lanes[n];if(s)for(const d of s)d.isFaceUp&&r.add(d.protocol)}return r.size}function mu(t,n,r){let c=0;for(const s of["player","opponent"])for(const d of t[s].lanes)for(const u of d)if(u.isFaceUp&&u.protocol===n){if(r&&u.id===r)continue;c++}return c}function cs(t,n){return mu(t,n.protocol,n.id)>0}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Draw Effect Executor
 *
 * Handles all draw-related effects.
 * Extracted 1:1 from effectInterpreter.ts for modularity.
 */function ym(t,n,r,c){let s=[...t],d=[...r],u=[],p=!1;for(let h=0;h<c;h++){if(s.length===0){if(d.length===0)break;s=qn(d),d=[],p=!0}const _=s.shift();u.push({..._,id:ct(),isFaceUp:!0})}return{drawnCards:[...n,...u],remainingDeck:s,newCards:u,newDiscard:d,reshuffled:p}}function jw(t,n,r,c,s){var U,D,I,W,z,V,B,L,P,M;const d=s._conditional,{cardOwner:u}=c,f=(s.target||"self")==="opponent"?c.opponent:u,h=fu(r,f);if(!h.allowed)return{newState:ae(r,u,h.reason||"Cannot draw cards.")};if(s.conditional){let N=0;switch(s.conditional.type){case"non_matching_protocols":{for(let _e=0;_e<3;_e++){const fe=r.player.protocols[_e],be=r.opponent.protocols[_e],oe=r.player.lanes[_e].filter(ie=>ie.isFaceUp),H=r.opponent.lanes[_e].filter(ie=>ie.isFaceUp);[...oe,...H].some(ie=>ie.protocol!==fe&&ie.protocol!==be)&&N++}break}case"count_face_down":{let _e=0;for(const fe of["player","opponent"])for(const be of r[fe].lanes)_e+=be.filter(oe=>!oe.isFaceUp).length;N=_e;break}case"is_covering":{N=r[u].lanes[n].length>1?s.count||1:0;break}case"same_protocol_on_field":{cs(r,t)?N=s.count||1:N=0;break}}let R=N;if(R<=0)return{newState:r};const{drawnCards:$,remainingDeck:X,newCards:G,newDiscard:q,reshuffled:Q}=ym(r[f].deck,r[f].hand,r[f].discard,R);let K={...r};if(K[f]={...K[f],deck:X,hand:$,discard:q},Q&&(K=ae(K,f,`${f==="player"?"Player":"Opponent"}'s deck is empty. Discard pile has been reshuffled into the deck.`)),K.detailedGameStats&&G.length>0){const _e=f==="player"?"playerFromEffect":"aiFromEffect";K={...K,detailedGameStats:{...K.detailedGameStats,cardsDrawn:{...K.detailedGameStats.cardsDrawn,[_e]:K.detailedGameStats.cardsDrawn[_e]+G.length}}}}const Z=f==="player"?"Player":"Opponent";let te="";switch(s.conditional.type){case"non_matching_protocols":te=" from non-matching protocols";break;case"is_covering":te=" (this card is covering another)";break;case"count_face_down":te=" (for face-down cards)";break;default:te=""}const ee=G.length>0&&f==="player"?` (${G.map(_e=>`${_e.protocol}-${_e.value}`).join(", ")})`:"";K=ae(K,f,`${Z} draws ${R} card${R!==1?"s":""}${te}${ee}.`),R>0&&(K=dt(K,"after_draw",{player:f}).newState,K=dt(K,"after_opponent_draw",{player:f==="player"?"opponent":"player"}).newState);const se=R>0?[{type:"draw",player:f,count:R}]:void 0;return{newState:K,animationRequests:se}}let _=s.count||1;const y=s.countType||"fixed";switch(y){case"equal_to_card_value":{const N=r.lastCustomEffectTargetCardId;if(N){const R=Te(r,N);if(R){const $=R.owner,X=r[$].lanes.find(G=>G.some(q=>q.id===N))||[];_=fn(R.card,X)}else if(r.lastCustomEffectTargetValue!==void 0)_=r.lastCustomEffectTargetValue;else return _=0,{newState:ae(r,u,"Cannot draw cards - referenced card is no longer available.")}}else r.lastCustomEffectTargetValue!==void 0?_=r.lastCustomEffectTargetValue:_=c.referencedCardValue||0;break}case"equal_to_discarded":_=(c.discardedCount||0)+(s.countOffset||0);break;case"hand_size":case"previous_hand_size":_=c.previousHandSize||c.handSize||0;break;case"count_face_down":{let N=0;for(const R of["player","opponent"])for(const $ of r[R].lanes)N+=$.filter(X=>!X.isFaceUp).length;_=N*(s.count||1);break}case"all_matching":{if(((U=s.valueFilter)==null?void 0:U.equals)!==void 0){const N=s.valueFilter.equals;_=r[f].deck.filter($=>$.value===N).length}else _=0;break}case"equal_to_unique_protocols_in_lane":{_=Ew(r,n);break}case"count_own_protocol_cards_on_field":{_=mu(r,t.protocol);break}case"fixed":default:_=s.count||1;break}if(_<=0)return{newState:r};if(((D=s.advancedConditional)==null?void 0:D.type)==="protocol_match"){const N=s.advancedConditional.protocol;if(r[u].protocols[n]!==N)return{newState:r}}if(((I=s.advancedConditional)==null?void 0:I.type)==="empty_hand"&&r[f].hand.length>0)return{newState:r};if(((W=s.advancedConditional)==null?void 0:W.type)==="opponent_higher_value_in_lane"){const N=u==="player"?"opponent":"player",R=ha(r,u,n);if(ha(r,N,n)<=R)return{newState:r}}if(((z=s.advancedConditional)==null?void 0:z.type)==="same_protocol_on_field"&&!cs(r,t))return{newState:r};let m={...r};if(((V=s.advancedConditional)==null?void 0:V.type)==="compile_block"){const N=s.advancedConditional.turnDuration||1,R=u==="player"?"opponent":"player";m={...m,compileBlockedUntilTurn:(m.turnNumber||0)+N,compileBlockedPlayer:R},m=ae(m,u,`Opponent can't compile for ${N} turn${N!==1?"s":""}.`)}if(s.optional)return m.actionRequired={type:"prompt_optional_draw",sourceCardId:t.id,actor:u,count:_,drawingPlayer:f,followUpEffect:d==null?void 0:d.thenEffect,conditionalType:d==null?void 0:d.type,logSource:r._currentEffectSource,logPhase:r._currentPhaseContext,logIndentLevel:r._logIndentLevel||0},{newState:m};const g=s.source;let x;g==="opponent_deck"?x=c.opponent:g==="own_deck"?x=u:x=f;let C,b,j=[],k=m[x].discard,E=!1;if(y==="all_matching"&&((B=s.valueFilter)==null?void 0:B.equals)!==void 0){const N=s.valueFilter.equals,R=m[x].deck,$=R.filter(G=>G.value===N),X=R.filter(G=>G.value!==N);j=$.map(G=>({...G,id:ct(),isFaceUp:!0})),C=[...m[f].hand,...j],b=X}else if(((L=s.valueFilter)==null?void 0:L.equals)!==void 0&&s.fromRevealed){const N=s.valueFilter.equals,R=m[x].deck,$=R.filter(X=>X.value===N);if($.length===0){const X=`${t.protocol}-${t.value}`;m=ae(m,f,`${X}: No cards with value ${N} in deck.`),C=m[f].hand,b=R,j=[]}else return m.actionRequired={type:"select_card_from_revealed_deck",sourceCardId:t.id,actor:f,count:_,valueFilter:N,revealedCards:R,selectableCardIds:$.map(X=>X.id||`deck-${R.indexOf(X)}`)},{newState:m}}else if(((P=s.valueFilter)==null?void 0:P.equals)!==void 0){const N=s.valueFilter.equals,R=[...m[x].deck],$=[];for(let q=0;q<R.length&&$.length<_;q++)R[q].value===N&&$.push(q);const X=$.map(q=>R[q]),G=R.filter((q,Q)=>!$.includes(Q));j=X.map(q=>({...q,id:ct(),isFaceUp:!0})),C=[...m[f].hand,...j],b=G}else if(((M=s.protocolFilter)==null?void 0:M.type)==="same_as_source"){const N=m[x].deck,R=t.protocol,$=[];return N.forEach((X,G)=>{X.protocol===R&&$.push(G)}),m.actionRequired={type:"reveal_deck_draw_protocol",sourceCardId:t.id,actor:f,revealedCards:N,targetProtocol:R,autoSelectedIndices:$,shuffleAfter:s.shuffleAfter||!1},{newState:m}}else{const N=ym(m[x].deck,m[f].hand,m[x].discard,_);C=N.drawnCards,b=N.remainingDeck,j=N.newCards,k=N.newDiscard,E=N.reshuffled}if(m[x]={...m[x],deck:b,discard:k},m[f]={...m[f],hand:C},E&&(m=ae(m,f,`${x==="player"?"Player":"Opponent"}'s deck is empty. Discard pile has been reshuffled into the deck.`)),m.detailedGameStats&&j.length>0){const N=f==="player"?"playerFromEffect":"aiFromEffect";m={...m,detailedGameStats:{...m.detailedGameStats,cardsDrawn:{...m.detailedGameStats.cardsDrawn,[N]:m.detailedGameStats.cardsDrawn[N]+j.length}}}}const T=f==="player"?"Player":"Opponent";if(j.length===0)return g==="opponent_deck"?m=ae(m,f,`${x==="player"?"Player's":"Opponent's"} deck and discard are empty. No cards drawn.`):g==="own_deck"&&f!==u?m=ae(m,f,`${u==="player"?"Player's":"Opponent's"} deck and discard are empty. No cards drawn.`):m=ae(m,f,"Deck and discard are empty. No cards drawn."),{newState:m};const F=j.length>0&&f==="player"?` (${j.map(N=>`${N.protocol}-${N.value}`).join(", ")})`:"";if(g==="opponent_deck"){const N=x==="player"?"Player's":"Opponent's";m=ae(m,f,`${T} draws the top ${_===1?"card":`${_} cards`} of ${N} deck${F}.`)}else if(g==="own_deck"&&f!==u){const N=u==="player"?"Player's":"Opponent's";m=ae(m,f,`${T} draws the top ${_===1?"card":`${_} cards`} of ${N} deck${F}.`)}else m=ae(m,f,`${T} draws ${_} card${_!==1?"s":""}${F}.`);if(C.length>0&&(m=dt(m,"after_draw",{player:f,count:C.length}).newState,m=dt(m,"after_opponent_draw",{player:f==="player"?"opponent":"player",count:C.length}).newState),s.revealFromDrawn&&j.length>0){const N=s.revealFromDrawn.valueSource||"stated_number",R=s.revealFromDrawn.count||1;let $=j;if(N==="stated_number"){const G=m.lastStatedNumber;G===void 0?m=ae(m,f,"No number was stated. Cannot filter drawn cards."):$=j.filter(q=>q.value===G)}const X=R==="all"?$.length:Math.min(R,$.length);return m.actionRequired={type:"select_from_drawn_to_reveal",actor:f,sourceCardId:t.id,allDrawnCardIds:j.map(G=>G.id),eligibleCardIds:$.map(G=>G.id),revealCount:X,statedNumber:N==="stated_number"?m.lastStatedNumber:void 0,thenAction:s.revealFromDrawn.thenAction},{newState:m}}return{newState:m}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Flip Effect Executor
 *
 * Handles all flip-related effects.
 * Extracted 1:1 from effectInterpreter.ts for modularity.
 */function kw(t,n,r,c,s){var j,k,E,T,F,U,D;const{cardOwner:d}=c,u=s._conditional;if(((j=s.advancedConditional)==null?void 0:j.type)==="same_protocol_on_field"&&!cs(r,t))return{newState:r};if(s.useCardFromPreviousEffect&&r.lastCustomEffectTargetCardId){const I=r.lastCustomEffectTargetCardId,W=Te(r,I);if(!W)return{newState:ae(r,d,"Target card from previous effect no longer exists. Flip skipped.")};let z={...r};const V=W.owner,B=z[V].lanes.findIndex(L=>L.some(P=>P.id===I));if(B!==-1){const P=z[V].lanes[B].find(M=>M.id===I);if(P){s.skipMiddleCommand&&!P.isFaceUp&&(z.skipNextMiddleCommand=I),P.isFaceUp&&(z=Ec(z,P)),P.isFaceUp=!P.isFaceUp;const M=P.isFaceUp?"face-up":"face-down",N=s.skipMiddleCommand&&P.isFaceUp?", ignoring its middle commands":"";z=ae(z,d,`Flips that card ${M}${N}.`)}}return{newState:z}}if(s.scope==="each_lane"){const I=s.targetFilter||{},W=Oa(r),z=M=>{const N=r.player.lanes[M],R=r.opponent.lanes[M];let $=[];if(I.position==="covered"?$=[...N.filter((G,q)=>q<N.length-1),...R.filter((G,q)=>q<R.length-1)]:$=[...N,...R],I.owner==="own")$=$.filter(G=>N.includes(G)&&d==="player"||R.includes(G)&&d==="opponent");else if(I.owner==="opponent"){const G=d==="player"?"opponent":"player";$=$.filter(q=>N.includes(q)&&G==="player"||R.includes(q)&&G==="opponent")}return I.excludeSelf&&($=$.filter(G=>G.id!==t.id)),(W?$.filter(G=>G.isFaceUp):$).length>0},V=[0,1,2].filter(M=>z(M));if(V.length===0){let M=ae(r,d,W?"No valid face-up targets to flip (Frost-1 is active).":"No valid targets to flip in any lane.");return M._effectSkippedNoTargets=!0,{newState:M}}const B=V[0],L=V.slice(1);let P={...r};return P.actionRequired={type:"select_card_to_flip",sourceCardId:t.id,actor:d,currentLaneIndex:B,remainingLanes:L,targetFilter:s.targetFilter,params:s,followUpEffect:u==null?void 0:u.thenEffect,conditionalType:u==null?void 0:u.type},{newState:P}}if(s.flipSelf){if(((k=s.advancedConditional)==null?void 0:k.type)==="protocol_match"){const V=s.advancedConditional.protocol;if(r[d].protocols[n]!==V)return{newState:r}}if(((E=s.advancedConditional)==null?void 0:E.type)==="opponent_higher_value_in_lane"){const V=d==="player"?"opponent":"player",B=ha(r,d,n);if(ha(r,V,n)<=B)return{newState:r}}if(((T=s.advancedConditional)==null?void 0:T.type)==="hand_size_greater_than"){const V=s.advancedConditional.threshold??0;if(r[d].hand.length<=V)return{newState:r}}if(((F=s.advancedConditional)==null?void 0:F.type)==="same_protocol_on_field"&&!cs(r,t))return{newState:r};if(((U=s.advancedConditional)==null?void 0:U.type)==="this_card_is_covered"){const V=r[d].lanes;let B=!1;for(let L=0;L<V.length;L++){const P=V[L],M=P.findIndex(N=>N.id===t.id);if(M!==-1&&M<P.length-1){B=!0;break}}if(!B)return{newState:r}}let I={...r};const z=I[d].lanes[n].find(V=>V.id===t.id);if(z){z.isFaceUp&&(I=Ec(I,z)),z.isFaceUp=!z.isFaceUp;const V=d==="player"?"Player":"Opponent",B=z.isFaceUp?"face-up":"face-down";I=ae(I,d,`${V} flips this card ${B}.`)}return{newState:I}}const p=s.count||1,f=((D=s.scope)==null?void 0:D.type)||s.scope||"anywhere",h=p==="all"||typeof p!="number",_=f==="this_lane"&&h,y=f==="anywhere"&&h;if(_||y){let I={...r};const W=d==="player"?"opponent":"player",z=s.targetFilter||{},V=Oa(r),B=new Set,L=y?[0,1,2]:[n];for(const P of L){const M=I[d].lanes[P];for(const R of M){if(z.excludeSelf&&R.id===t.id||z.faceState==="face_up"&&!R.isFaceUp||z.faceState==="face_down"&&R.isFaceUp||z.owner==="opponent")continue;const $=M.indexOf(R)===M.length-1;z.position==="uncovered"&&!$||z.position==="covered"&&$||y&&!z.position&&!$||V&&!R.isFaceUp||B.add(R.id)}const N=I[W].lanes[P];for(const R of N){if(z.faceState==="face_up"&&!R.isFaceUp||z.faceState==="face_down"&&R.isFaceUp||z.owner==="own")continue;const $=N.indexOf(R)===N.length-1;z.position==="uncovered"&&!$||z.position==="covered"&&$||y&&!z.position&&!$||V&&!R.isFaceUp||B.add(R.id)}}if(B.size>0){const P=y?"":" in this lane";I=ae(I,d,`Flipping ${B.size} card(s)${P}.`);for(const M of B)for(const N of["player","opponent"])for(const R of I[N].lanes){const $=R.find(X=>X.id===M);$&&($.isFaceUp&&(I=Ec(I,$)),$.isFaceUp=!$.isFaceUp)}return{newState:I}}else return I=ae(I,d,`No cards to flip${y?"":" in this lane"}.`),{newState:I}}const m=s.targetFilter||{},g=m.position||"uncovered",x=Oa(r),C=[];for(const I of["player","opponent"])for(let W=0;W<r[I].lanes.length;W++){const z=r[I].lanes[W];if(!(s.scope==="this_lane"&&W!==n)&&!(s.sameLaneAsFirst&&r.lastFlipLaneIndex!==void 0&&W!==r.lastFlipLaneIndex))for(let V=0;V<z.length;V++){const B=z[V];if(Wo(r,B.id))continue;const L=Qo(r,z,V);if(!(m.excludeSelf&&B.id===t.id||m.owner==="own"&&I!==d||m.owner==="opponent"&&I===d||g==="uncovered"&&!L||g==="covered"&&L||m.faceState==="face_up"&&!B.isFaceUp||m.faceState==="face_down"&&B.isFaceUp||x&&!B.isFaceUp||!rs(r,B.id).allowed)){if(m.valueMinGreaterThanHandSize){const M=r[d].hand.length;if(B.value<=M)continue}if(m.valueLessThanUniqueProtocolsOnField){const M=vr(r);if(B.value>=M)continue}C.push(B.id)}}}if(C.length===0){let I=r;if(m.valueMinGreaterThanHandSize){const W=r[d].hand.length,z=W+1;I=ae(I,d,`Hand size: ${W} cards. No cards with value ${z} or higher available. Effect skipped.`)}else if(m.valueLessThanUniqueProtocolsOnField){const W=vr(r);I=ae(I,d,`${W} unique protocols on field. No cards with value less than ${W} available. Effect skipped.`)}else I=ae(I,d,"No valid cards to flip. Effect skipped.");return I._effectSkippedNoTargets=!0,{newState:I}}let b={...r};if(m.valueMinGreaterThanHandSize){const I=r[d].hand.length,W=I+1,z=p==="all"?"all cards":p===1?"1 card":`${p} cards`;b=ae(b,d,`Hand size: ${I} cards. Flip ${z} with value ${W} or higher.`)}return b.actionRequired={type:"select_card_to_flip",count:p,sourceCardId:t.id,actor:d,targetFilter:s.targetFilter,optional:s.optional||!1,scope:s.scope,laneIndex:s.scope==="this_lane"?n:void 0,sameLaneAsFirst:s.sameLaneAsFirst||!1,restrictedLaneIndex:s.sameLaneAsFirst?r.lastFlipLaneIndex:void 0,followUpEffect:u==null?void 0:u.thenEffect,conditionalType:u==null?void 0:u.type},{newState:b}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Delete Effect Executor
 *
 * Handles all delete-related effects.
 * Extracted 1:1 from effectInterpreter.ts for modularity.
 */function Nw(t,n,r,c,s){var E,T,F,U,D,I,W,z,V,B,L,P;const{cardOwner:d}=c,u=s._conditional;let p=s.count||1;if(((E=s.advancedConditional)==null?void 0:E.type)==="empty_hand"&&r[d].hand.length>0)return{newState:r};if(((T=s.advancedConditional)==null?void 0:T.type)==="opponent_higher_value_in_lane"){const M=d==="player"?"opponent":"player",N=ha(r,d,n);if(ha(r,M,n)<=N)return{newState:r}}if(((F=s.advancedConditional)==null?void 0:F.type)==="this_card_is_covered"){const M=r[d].lanes;let N=!1;for(let R=0;R<M.length;R++){const $=M[R],X=$.findIndex(G=>G.id===t.id);if(X!==-1&&X<$.length-1){N=!0;break}}if(!N)return{newState:r}}if(s.useCardFromPreviousEffect&&r.lastCustomEffectTargetCardId){const M=r.lastCustomEffectTargetCardId,N=Te(r,M);if(!N)return{newState:ae(r,d,"Target card from previous effect no longer exists. Delete skipped.")};let R={...r};const $=N.owner,X=R[$].lanes.findIndex(G=>G.some(q=>q.id===M));if(X!==-1){const G=[...R[$].lanes[X]],q=G.findIndex(Q=>Q.id===M);if(q!==-1){const Q=q===G.length-1;G.splice(q,1);const K=[...R[$].lanes];K[X]=G,R={...R,[$]:{...R[$],lanes:K}};const Z=N.card.isFaceUp?`${N.card.protocol}-${N.card.value}`:"that card";R=ae(R,d,`Deletes ${Z}.`);const te={...R.stats[d],cardsDeleted:R.stats[d].cardsDeleted+1};R={...R,stats:{...R.stats,[d]:te}};const ee=c.triggerType==="cover"||c.triggerType==="on_cover";return Q&&G.length>0&&!ee&&(R=ea(R,$,X).newState),{newState:R,animationRequests:[{type:"delete",cardId:M,owner:$}]}}}return{newState:R}}if((U=s.scope)!=null&&U.minCardsInLane){const M=s.scope.minCardsInLane,N=((D=r.player.lanes[n])==null?void 0:D.length)||0,R=((I=r.opponent.lanes[n])==null?void 0:I.length)||0;if(N+R<M)return{newState:r}}let f=[0,1,2];if(((W=s.laneCondition)==null?void 0:W.type)==="opponent_higher_value"&&(f=tx(r,d),f.length===0)){let M=ae(r,d,"No lanes where opponent has higher value. Delete effect skipped.");return M._effectSkippedNoTargets=!0,{newState:M}}const h=s.actorChooses||"effect_owner",_=((z=s.targetFilter)==null?void 0:z.owner)||"any";let y=d;h==="card_owner"&&_==="opponent"&&(y=c.opponent);const m=s.targetFilter||{},g=m.position||"uncovered",x=[];for(const M of["player","opponent"])for(let N=0;N<r[M].lanes.length;N++){if(((V=s.scope)==null?void 0:V.type)==="this_line"&&N!==n)continue;const R=r[M].lanes[N];for(let $=0;$<R.length;$++){const X=R[$];if(Wo(r,X.id))continue;const G=Qo(r,R,$);if(!(s.excludeSelf&&X.id===t.id)&&!(m.owner==="own"&&M!==d)&&!(m.owner==="opponent"&&M===d)&&!(g==="uncovered"&&!G)&&!(g==="covered"&&G)){if(g==="covered_by_context"&&c.triggerType==="cover"){if(M!==c.cardOwner&&G)continue}else if(g==="covered_by_context"&&G)continue;if(!(m.faceState==="face_up"&&!X.isFaceUp)&&!(m.faceState==="face_down"&&X.isFaceUp)){if(m.valueRange){const{min:q,max:Q}=m.valueRange;if(X.value<q||X.value>Q)continue}if(m.valueSource==="previous_effect_card"){const q=r.lastCustomEffectTargetValue;if(q===void 0||X.value!==q)continue}if(s.protocolMatching){const q=r.player.protocols[N],Q=r.opponent.protocols[N],K=X.protocol,Z=K===q||K===Q;if(s.protocolMatching==="must_match"&&!Z||s.protocolMatching==="must_not_match"&&Z)continue}x.push(X.id)}}}}if(x.length===0){let M=ae(r,d,"No valid cards to delete. Effect skipped.");return M._effectSkippedNoTargets=!0,{newState:M}}if(s.upTo&&(p=Math.min(p,x.length),p===0))return{newState:ae(r,d,"No valid targets available. Delete effect skipped.")};let C=x;if(m.calculation==="highest_value"||m.calculation==="lowest_value"){const M=new Map;for(const $ of x){const X=Te(r,$);if(!X)continue;let G=-1;for(let Q=0;Q<r[X.owner].lanes.length;Q++)if(r[X.owner].lanes[Q].some(K=>K.id===$)){G=Q;break}let q=X.card.value;!X.card.isFaceUp&&G!==-1&&(q=r[X.owner].lanes[G].some(K=>K.isFaceUp&&K.protocol==="Darkness"&&K.value===2)?4:2),M.set($,q)}const N=Array.from(M.values()),R=m.calculation==="highest_value"?Math.max(...N):Math.min(...N);C=x.filter($=>M.get($)===R)}if(s.autoExecute){const M=C.slice(0,p);let N=r;const R=[];for(const $ of M){const X=Te(N,$);if(!X)continue;const{card:G,owner:q}=X;let Q=-1;for(let H=0;H<N[q].lanes.length;H++)if(N[q].lanes[H].some(ne=>ne.id===$)){Q=H;break}if(Q===-1)continue;const K=N[q].lanes[Q],Z=K[K.length-1].id===$,te=G.isFaceUp?`${G.protocol}-${G.value}`:"a face-down card";N=ae(N,d,`Effect triggers, deleting the lowest value covered card (${q==="player"?"Player's":"Opponent's"} ${te}).`);const se=[...K],_e=se.findIndex(H=>H.id===$);se.splice(_e,1);const fe=[...N[q].lanes];fe[Q]=se,N={...N,[q]:{...N[q],lanes:fe}};const be={...N.stats[d],cardsDeleted:N.stats[d].cardsDeleted+1};N={...N,stats:{...N.stats,[d]:be}},R.push({type:"delete",cardId:$,owner:q});const oe=c.triggerType==="cover"||c.triggerType==="on_cover";Z&&se.length>0&&!oe&&(N=ea(N,q,Q).newState)}return{newState:N,animationRequests:R}}let b={...r};if(s.deleteSelf){if(((B=s.protocolCountConditional)==null?void 0:B.type)==="unique_protocols_on_field_below"){const ee=s.protocolCountConditional.threshold,se=vr(r);if(se>=ee)return b=ae(b,d,`${se} different protocols on field (need less than ${ee}). Card not deleted.`),{newState:b};b=ae(b,d,`Only ${se} different protocols on field (need ${ee}). Deleting this card.`)}const M=d,N=r[M].lanes[n];if(!N||N.length===0)return b=ae(b,d,"Card already deleted. Delete effect skipped."),{newState:b};if(N.findIndex(ee=>ee.id===t.id)===-1)return b=ae(b,d,"Card already deleted. Delete effect skipped."),{newState:b};const $=r[M].lanes[n],X=$.length>0&&$[$.length-1].id===t.id;b=ae(b,d,`Deleting ${t.protocol}-${t.value}.`);const G=[...$],q=G.findIndex(ee=>ee.id===t.id);if(q===-1)return{newState:b};G.splice(q,1);const Q=[...b[M].lanes];Q[n]=G,b={...b,[M]:{...b[M],lanes:Q}};const K={...b.stats[d],cardsDeleted:b.stats[d].cardsDeleted+1};b={...b,stats:{...b.stats,[d]:K}};const Z=[{type:"delete",cardId:t.id,owner:M}],te=c.triggerType==="cover"||c.triggerType==="on_cover";if(X&&G.length>0&&!te){const ee=ea(b,M,n);b=ee.newState,ee.animationRequests&&Z.push(...ee.animationRequests)}return{newState:b,animationRequests:Z}}if(s.selectLane)return b.actionRequired={type:"select_lane_for_delete",sourceCardId:t.id,actor:y,count:s.count,targetFilter:s.targetFilter,deleteAll:s.count==="all_in_lane"||s.count==="all",validLanes:f.length<3?f:void 0,laneCondition:s.laneCondition,followUpEffect:u==null?void 0:u.thenEffect,conditionalType:u==null?void 0:u.type},{newState:b};if(((L=s.scope)==null?void 0:L.type)==="each_lane"){const M=X=>{for(const G of["player","opponent"]){const q=r[G].lanes[X];for(let Q=0;Q<q.length;Q++){const K=q[Q];if(Wo(r,K.id))continue;const Z=Qo(r,q,Q);if(!(s.excludeSelf&&K.id===t.id)&&!(m.owner==="own"&&G!==y)&&!(m.owner==="opponent"&&G===y)&&!(g==="uncovered"&&!Z)&&!(g==="covered"&&Z)&&!(m.faceState==="face_up"&&!K.isFaceUp)&&!(m.faceState==="face_down"&&K.isFaceUp))return!0}}return!1},N=[0,1,2].filter(X=>M(X));if(N.length===0)return b=ae(b,d,"No valid targets to delete in any lane."),b._effectSkippedNoTargets=!0,{newState:b};const R=N[0],$=N.slice(1);return b.actionRequired={type:"select_cards_to_delete",count:p,sourceCardId:t.id,actor:y,currentLaneIndex:R,remainingLanes:$,disallowedIds:s.excludeSelf?[t.id]:[],targetFilter:s.targetFilter,scope:s.scope,protocolMatching:s.protocolMatching,params:s,followUpEffect:u==null?void 0:u.thenEffect,conditionalType:u==null?void 0:u.type},{newState:b}}if(((P=s.scope)==null?void 0:P.type)==="each_other_line"){const R=[0,1,2].filter($=>$!==n).filter($=>r.player.lanes[$].length>0||r.opponent.lanes[$].length>0).length;return R===0?(b=ae(b,d,"No other lanes have cards. Effect skipped."),{newState:b}):(b.actionRequired={type:"select_card_from_other_lanes_to_delete",sourceCardId:t.id,disallowedLaneIndex:n,lanesSelected:[],count:R,actor:y,targetFilter:s.targetFilter,followUpEffect:u==null?void 0:u.thenEffect,conditionalType:u==null?void 0:u.type},{newState:b})}const j=m.valueSource==="previous_effect_card",k=C.length<x.length||j?C:void 0;return b.actionRequired={type:"select_cards_to_delete",count:p,sourceCardId:t.id,actor:y,actorChooses:h,disallowedIds:s.excludeSelf?[t.id]:[],followUpEffect:u==null?void 0:u.thenEffect,conditionalType:u==null?void 0:u.type,allowedIds:k,targetFilter:s.targetFilter,scope:s.scope,protocolMatching:s.protocolMatching},{newState:b}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Discard Effect Executor
 *
 * Handles all discard-related effects.
 * Extracted 1:1 from effectInterpreter.ts for modularity.
 */function Tw(t,n,r,c,s){const{cardOwner:d}=c,u=s._conditional;if(s.actor==="both"){let x={...r};const C=T=>{const F=x[T].hand;if(F.length===0)return{discardedCount:0,discardedCards:[]};const U=F.map(({id:D,isFaceUp:I,...W})=>W);return x[T]={...x[T],hand:[],discard:[...x[T].discard,...U],stats:{...x[T].stats,cardsDiscarded:x[T].stats.cardsDiscarded+U.length}},{discardedCount:U.length,discardedCards:U}},b=C(d),j=d==="player"?"Player":"Opponent";if(b.discardedCount>0){const T=b.discardedCards.map(F=>`${F.protocol}-${F.value}`).join(", ");x=ae(x,d,`${j} discards their hand (${b.discardedCount} cards: ${T}).`)}else x=ae(x,d,`${j} has no cards to discard.`);const k=C(c.opponent),E=c.opponent==="player"?"Player":"Opponent";if(k.discardedCount>0){const T=k.discardedCards.map(F=>`${F.protocol}-${F.value}`).join(", ");x=ae(x,c.opponent,`${E} discards their hand (${k.discardedCount} cards: ${T}).`)}else x=ae(x,c.opponent,`${E} has no cards to discard.`);return x._discardContext={actor:"both",discardedCount:b.discardedCount+k.discardedCount,sourceCardId:t.id},{newState:x}}const p=s.actor==="opponent"?c.opponent:d;if(s.useCardFromPreviousEffect&&r.lastCustomEffectTargetCardId){const x=r.lastCustomEffectTargetCardId;let C={...r};const b={...C[p]},j=`${t.protocol}-${t.value}`,k=p==="player"?"Player":"Opponent",E=b.deck.findIndex(F=>F.id===x);if(E!==-1){const F=[...b.deck],U=F.splice(E,1)[0];return b.deck=F,b.discard=[...b.discard,U],C[p]=b,C=ae(C,p,`${k} discards ${U.protocol}-${U.value} from their deck.`),C._discardContext={actor:p,discardedCount:1,sourceCardId:t.id},{newState:C}}const T=b.hand.findIndex(F=>F.id===x);if(T!==-1){const F=[...b.hand],U=F.splice(T,1)[0],{id:D,isFaceUp:I,...W}=U;return b.hand=F,b.discard=[...b.discard,W],C[p]=b,C=ae(C,p,`${k} discards ${U.protocol}-${U.value}.`),C._discardContext={actor:p,discardedCount:1,sourceCardId:t.id},{newState:C}}return console.warn(`[Discard Effect] useCardFromPreviousEffect: Card ${x} not found`),C=ae(C,p,`${j}: Card to discard not found - effect skipped.`),C._discardContext={discardedCount:0},{newState:C}}const f=s.source||"hand";if(f==="entire_deck"){let x={...r};const C={...x[d]},b=`${t.protocol}-${t.value}`;if(C.deck.length===0)return x=ae(x,d,`${b}: No cards in deck - effect skipped.`),x._effectSkippedNoTargets=!0,x._discardContext={discardedCount:0},{newState:x};const j=C.deck.length,k=[...C.deck];return C.discard=[...C.discard,...k],C.deck=[],x[d]=C,x=ae(x,d,`${b}: Discards entire deck (${j} card${j!==1?"s":""}).`),x._discardContext={actor:d,discardedCount:j,sourceCardId:t.id},{newState:x}}if(f==="top_deck_own"||f==="top_deck_opponent"){const x=f==="top_deck_own"?d:c.opponent;let C={...r};const b={...C[x]},j=x===d?"your":"opponent's";if(b.deck.length===0)return C=ae(C,d,`No cards in ${j} deck - effect skipped.`),C._effectSkippedNoTargets=!0,C._discardContext={discardedCount:0},{newState:C};const k=[...b.deck],E=k.shift();return b.deck=k,b.discard=[...b.discard,E],C[x]=b,C=ae(C,d,`Discard the top card of ${j} deck: ${E.protocol}-${E.value}.`),C.lastCustomEffectTargetCardId=E.id,C.lastCustomEffectTargetValue=E.value,C._discardContext={actor:x,discardedCount:1,sourceCardId:t.id,discardedCardValue:E.value,discardedCardProtocol:E.protocol},C.actionRequired={type:"confirm_deck_discard",actor:d,sourceCardId:t.id,discardedCard:E,deckOwner:f==="top_deck_own"?"own":"opponent",followUpEffect:u==null?void 0:u.thenEffect,conditionalType:u==null?void 0:u.type,laneIndex:n},{newState:C}}let h=s.count||1;if((s.countType||"fixed")==="equal_to_discarded"){const x=(c.discardedCount||0)+(s.countOffset||0);if(h=Math.min(x,r[p].hand.length),h<=0){let b=ae(r,p,`${p==="player"?"Player":"Opponent"} has no cards to discard - effect skipped.`);return b._effectSkippedNoTargets=!0,b._discardContext={discardedCount:0},{newState:b}}}if(r[p].hand.length===0){let C=ae(r,p,`${p==="player"?"Player":"Opponent"} has no cards to discard - effect skipped.`);return C._effectSkippedNoTargets=!0,C._discardContext={discardedCount:0},{newState:C}}s.upTo&&(h=Math.min(h,r[p].hand.length));const y=h;typeof h=="number"&&h>r[p].hand.length&&(h=r[p].hand.length);const m=!s.upTo&&typeof y=="number"&&y>h;if(s.random&&p!==d){const x=[...r[p].hand],C=Math.min(h,x.length),b=[],j=x.map((z,V)=>V);for(let z=0;z<C&&j.length>0;z++){const V=Math.floor(Math.random()*j.length);b.push(j[V]),j.splice(V,1)}b.sort((z,V)=>V-z);const k=[],E=[...x];for(const z of b){const{id:V,isFaceUp:B,...L}=E.splice(z,1)[0];k.push(L)}const T=[...r[p].discard,...k],F={...r[p].stats,cardsDiscarded:r[p].stats.cardsDiscarded+k.length},U={...r[p],hand:E,discard:T,stats:F};let D={...r,[p]:U,stats:{...r.stats,[p]:F}};const I=p==="player"?"Player":"Opponent",W=k.length===1?"card":"cards";if(p==="player"||k.every(z=>z.isRevealed)){const z=k.map(V=>`${V.protocol}-${V.value}`).join(", ");D=ae(D,p,`${I} randomly discards ${k.length} ${W}: ${z}.`)}else D=ae(D,p,`${I} randomly discards ${k.length} ${W}.`);return D._discardContext={actor:p,discardedCount:k.length,sourceCardId:t.id},{newState:D}}if(h==="all"){const x=r[p].hand,C=x.map(({id:U,isFaceUp:D,...I})=>I),b=[],j=[...r[p].discard,...C],k={...r[p].stats,cardsDiscarded:r[p].stats.cardsDiscarded+C.length},E={...r[p],hand:b,discard:j,stats:k};let T={...r,[p]:E,stats:{...r.stats,[p]:k}};const F=p==="player"?"Player":"Opponent";if(p==="player"||C.every(U=>U.isRevealed)){const U=C.map(D=>`${D.protocol}-${D.value}`).join(", ");T=ae(T,p,`${F} discards entire hand (${C.length} cards: ${U}).`)}else T=ae(T,p,`${F} discards entire hand (${C.length} cards).`);return T._discardContext={actor:p,discardedCount:C.length,previousHandSize:x.length,sourceCardId:t.id},{newState:T}}let g={...r};return m&&(g=ae(g,p,`${p==="player"?"Player":"Opponent"} only has ${h} card${h!==1?"s":""} (${y} required) - discarding all.`)),g.actionRequired={type:"discard",actor:p,count:h,sourceCardId:t.id,variableCount:s.variableCount||!1,previousHandSize:r[p].hand.length,followUpEffect:u==null?void 0:u.thenEffect,conditionalType:u==null?void 0:u.type,_savedIndentLevel:r._logIndentLevel,discardTo:s.discardTo||"own_trash"},{newState:g}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Shift Effect Executor
 *
 * Handles all shift-related effects.
 * Extracted 1:1 from effectInterpreter.ts for modularity.
 */function Rw(t,n,r,c,s){var D,I,W,z;const{cardOwner:d}=c,u=s._conditional;let p={...r};if(((D=s.advancedConditional)==null?void 0:D.type)==="empty_hand"&&r[d].hand.length>0)return{newState:r};if(((I=s.advancedConditional)==null?void 0:I.type)==="opponent_higher_value_in_lane"){const V=d==="player"?"opponent":"player",B=ha(r,d,n);if(ha(r,V,n)<=B)return{newState:r}}if(((W=s.advancedConditional)==null?void 0:W.type)==="this_card_is_covered"){const V=r[d].lanes;let B=!1;for(let L=0;L<V.length;L++){const P=V[L],M=P.findIndex(N=>N.id===t.id);if(M!==-1){B=M<P.length-1;break}}if(!B)return{newState:r}}if(s.useCardFromPreviousEffect&&r.lastCustomEffectTargetCardId){const V=r.lastCustomEffectTargetCardId,B=Te(r,V);if(!B)return{newState:ae(r,d,"Target card from previous effect no longer exists. Shift skipped.")};const L=s.destinationRestriction;if((L==null?void 0:L.type)==="to_this_lane"){const M=L.laneIndex==="current"?n:L.laneIndex;if(M===void 0||M<0||M>2)return console.error(`[Shift Effect] Invalid target lane index: ${M}`),{newState:r};const N=Bo(r,V,B.owner,M,d);return{newState:N.newState,animationRequests:N.animationRequests}}let P=-1;for(let M=0;M<r[B.owner].lanes.length;M++)if(r[B.owner].lanes[M].some(N=>N.id===V)){P=M;break}return P===-1?{newState:r}:(p.actionRequired={type:"select_lane_for_shift",cardToShiftId:V,cardOwner:B.owner,originalLaneIndex:P,sourceCardId:t.id,actor:d,destinationRestriction:L,followUpEffect:u==null?void 0:u.thenEffect,conditionalType:u==null?void 0:u.type},{newState:p})}const f=r._selectedCardFromPreviousEffect;if(p._selectedCardFromPreviousEffect&&delete p._selectedCardFromPreviousEffect,f&&s.useCardFromPreviousEffect){const V=s.destinationRestriction;if((V==null?void 0:V.type)==="to_this_lane"){const B=V.laneIndex==="current"?n:V.laneIndex;if(B===void 0||B<0||B>2)return console.error(`[Shift Effect] Invalid target lane index: ${B}`),{newState:p};const L=Te(p,f);if(!L)return console.error(`[Shift Effect] Selected card not found: ${f}`),{newState:p};const P=Bo(p,f,L.owner,B,d);return{newState:P.newState,animationRequests:P.animationRequests}}return p.actionRequired={type:"shift_flipped_card_optional",cardId:f,sourceCardId:t.id,optional:s.optional||!1,actor:d,followUpEffect:u==null?void 0:u.thenEffect,conditionalType:u==null?void 0:u.type},{newState:p}}if(s.shiftSelf){if(((z=s.destinationRestriction)==null?void 0:z.type)==="opponent_highest_value_lane"){const V=Bm(p,d);if(V.includes(n))return p=ae(p,d,"Card is already in opponent's highest value lane. Shift skipped."),{newState:p};const B=V.filter(L=>L!==n);if(B.length===0)return p=ae(p,d,"No valid destination lane. Shift skipped."),{newState:p};if(B.length===1){if(s.optional)return p.actionRequired={type:"select_lane_for_shift",cardToShiftId:t.id,cardOwner:d,originalLaneIndex:n,sourceCardId:t.id,actor:d,validLanes:B,destinationRestriction:s.destinationRestriction,optional:!0,followUpEffect:u==null?void 0:u.thenEffect,conditionalType:u==null?void 0:u.type},{newState:p};const L=B[0],P=Bo(p,t.id,d,L,d);return{newState:P.newState,animationRequests:P.animationRequests}}return p.actionRequired={type:"select_lane_for_shift",cardToShiftId:t.id,cardOwner:d,originalLaneIndex:n,sourceCardId:t.id,actor:d,validLanes:B,destinationRestriction:s.destinationRestriction,optional:s.optional||!1,followUpEffect:u==null?void 0:u.thenEffect,conditionalType:u==null?void 0:u.type},{newState:p}}return p.actionRequired={type:"shift_flipped_card_optional",cardId:t.id,sourceCardId:t.id,optional:s.optional||!1,actor:d,allowCovered:s.allowCoveredSelf||!1,followUpEffect:u==null?void 0:u.thenEffect,conditionalType:u==null?void 0:u.type},{newState:p}}const h=s.targetFilter||{},_=h.position||"uncovered",y=h.faceState||"any",m=h.owner||"any",g=h.excludeSelf||!1,x=s.count||1;if(_==="any"&&m==="own"&&!g&&x===1)return p.actionRequired={type:"shift_flipped_card_optional",cardId:t.id,sourceCardId:t.id,optional:s.optional||!1,actor:d,followUpEffect:u==null?void 0:u.thenEffect,conditionalType:u==null?void 0:u.type},{newState:p};const b=[];for(const V of["player","opponent"])if(!(m==="own"&&V!==d)&&!(m==="opponent"&&V===d))for(let B=0;B<p[V].lanes.length;B++){if(s.scope==="this_lane"&&B!==n)continue;const L=p[V].lanes[B];for(let P=0;P<L.length;P++){const M=L[P];if(Wo(p,M.id)||g&&M.id===t.id)continue;const N=Qo(p,L,P);_==="uncovered"&&!N||_==="covered"&&N||y==="face_up"&&!M.isFaceUp||y==="face_down"&&M.isFaceUp||b.push({card:M,currentLane:B,owner:V})}}if(b.length===0)return p=ae(p,d,"No valid cards to shift."),p._effectSkippedNoTargets=!0,{newState:p};if((x==="all"||typeof x!="number"&&x!==1)&&b.length>0){const V=[],B=s.destinationRestriction;for(let L=0;L<3;L++){if((B==null?void 0:B.type)==="to_another_line"){if(L===n)continue}else if((B==null?void 0:B.type)==="to_this_lane"){const P=B.laneIndex==="current"?n:B.laneIndex;if(L!==P)continue}else if(!B&&L===n)continue;V.push(L)}return V.length===0?(p=ae(p,d,"No valid destination lanes for shifting all cards."),{newState:p}):(p=ae(p,d,`Shifting ${b.length} card(s) from this lane.`),p.actionRequired={type:"select_lane_for_shift_all",sourceCardId:t.id,actor:d,cardsToShift:b.map(L=>({cardId:L.card.id,owner:L.owner})),validDestinationLanes:V,sourceLaneIndex:n,followUpEffect:u==null?void 0:u.thenEffect,conditionalType:u==null?void 0:u.type},{newState:p})}const k=s.destinationRestriction;let E=!1;const T=(k==null?void 0:k.laneIndex)==="current"?n:k==null?void 0:k.laneIndex;for(const{card:V,currentLane:B,owner:L}of b){if((k==null?void 0:k.type)==="non_matching_protocol"&&!V.isFaceUp)continue;const P=V.protocol;for(let M=0;M<3;M++){if(k){if(k.type==="non_matching_protocol"){if(M===B)continue;const R=p.player.protocols[M],$=p.opponent.protocols[M];if(P===R||P===$)continue}else if(k.type==="specific_lane"){if(M!==B)continue}else if(k.type==="to_this_lane"){if(M!==T||B===T)continue}else if(k.type==="to_another_line"){if(M===B)continue}else if(k.type==="to_or_from_this_lane"&&(!(B===T)&&!(M===T)||M===B))continue}else if(M===B)continue;if(ss(p,B,M).allowed){E=!0;break}}if(E)break}if(!E)return p=ae(p,d,"No valid shift destinations available."),{newState:p};const F=k&&T!==void 0?{...k,laneIndex:T}:k,U=(k==null?void 0:k.type)==="to_this_lane"&&T!==void 0?T:void 0;return p.actionRequired={type:"select_card_to_shift",sourceCardId:t.id,actor:d,targetFilter:s.targetFilter,destinationRestriction:F,sourceLaneIndex:n,targetLaneIndex:U,scope:s.scope,followUpEffect:u==null?void 0:u.thenEffect,conditionalType:u==null?void 0:u.type},{newState:p}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Return Effect Executor
 *
 * Handles all return-related effects.
 * Extracted 1:1 from effectInterpreter.ts for modularity.
 */function Dw(t,n,r,c,s){var C,b,j,k,E,T;const{cardOwner:d,opponent:u}=c,p=s._conditional;s.count==="all"||s.count;const f=((C=s.targetFilter)==null?void 0:C.owner)||"any",h=((b=s.targetFilter)==null?void 0:b.position)||"uncovered",_=(j=s.targetFilter)==null?void 0:j.faceState,y=s.destination||"owner_hand";if(((k=s.advancedConditional)==null?void 0:k.type)==="empty_hand"&&r[d].hand.length>0)return{newState:r};if(((E=s.advancedConditional)==null?void 0:E.type)==="opponent_higher_value_in_lane"){const F=d==="player"?"opponent":"player",U=ha(r,d,n);if(ha(r,F,n)<=U)return{newState:r}}if(((T=s.advancedConditional)==null?void 0:T.type)==="this_card_is_covered"){const F=r[d].lanes;let U=!1;for(let D=0;D<F.length;D++){const I=F[D],W=I.findIndex(z=>z.id===t.id);if(W!==-1&&W<I.length-1){U=!0;break}}if(!U)return{newState:r}}if(s.returnSelf){let F={...r};const U=F[d].lanes;for(let D=0;D<U.length;D++){const I=U[D],W=I.findIndex(z=>z.id===t.id);if(W!==-1){const[z]=I.splice(W,1);F[d].hand.push(z),F=ae(F,d,`${d==="player"?"Player":"Opponent"} returns this card to hand.`);break}}return{newState:F}}if(s.selectLane){let F={...r};return F.actionRequired={type:"select_lane_for_return",sourceCardId:t.id,actor:d,count:s.count,targetFilter:s.targetFilter,followUpEffect:p==null?void 0:p.thenEffect,conditionalType:p==null?void 0:p.type},{newState:F}}let m=[];const g=F=>{for(const U of r[F].lanes)for(let D=0;D<U.length;D++){const I=U[D];if(Wo(r,I.id))continue;const W=Qo(r,U,D);h==="uncovered"&&!W||h==="covered"&&W||_==="face_up"&&!I.isFaceUp||_==="face_down"&&I.isFaceUp||m.push({card:I,isUncovered:W})}};if(f==="own"?g(d):f==="opponent"?g(u):(g("player"),g("opponent")),m.length===0)return{newState:ae(r,d,"No cards on board to return. Effect skipped.")};let x={...r};return x.actionRequired={type:"select_card_to_return",sourceCardId:t.id,actor:d,targetOwner:f,targetFilter:s.targetFilter,destination:y,followUpEffect:p==null?void 0:p.thenEffect,conditionalType:p==null?void 0:p.type},{newState:x}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Play Effect Executor
 *
 * Handles all play-related effects (play cards from hand/deck to board).
 * Extracted 1:1 from effectInterpreter.ts for modularity.
 */function Aw(t,n,r,c,s){var b,j,k,E,T,F,U,D,I,W,z,V;const{cardOwner:d,opponent:u}=c,p=s._conditional,f=s.count||1,h=s.source||"hand",_=s.faceDown,y=s.actor==="opponent"?u:d;if(((b=s.advancedConditional)==null?void 0:b.type)==="empty_hand"&&r[d].hand.length>0)return{newState:r};if(((j=s.advancedConditional)==null?void 0:j.type)==="opponent_higher_value_in_lane"){const B=d==="player"?"opponent":"player",L=ha(r,d,n);if(ha(r,B,n)<=L)return{newState:r}}if(h==="deck"&&((k=s.destinationRule)==null?void 0:k.type)==="each_other_line"){const B=[0,1,2].filter(K=>K!==n);if(B.length===0)return{newState:r};const L=r[y];if(L.deck.length===0&&L.discard.length===0)return{newState:ae(r,d,`${y==="player"?"Player":"Opponent"} has no cards in deck/discard - effect skipped.`)};const{drawnCards:P,remainingDeck:M,newDiscard:N}=Jn(L.deck,L.discard,B.length);if(P.length===0)return{newState:r};const R=P.map(K=>({...K,id:ct(),isFaceUp:!1})),$=[...L.lanes];for(let K=0;K<R.length;K++){const Z=B[K];$[Z]=[...$[Z],R[K]]}const X={...L,lanes:$,deck:M,discard:N};let G={...r,[y]:X};if(G.detailedGameStats&&P.length>0){const K=y==="player"?"playerFromEffect":"aiFromEffect",Z=y==="player"?"playerFaceDown":"aiFaceDown";G={...G,detailedGameStats:{...G.detailedGameStats,cardsPlayed:{...G.detailedGameStats.cardsPlayed,[K]:G.detailedGameStats.cardsPlayed[K]+P.length,[Z]:G.detailedGameStats.cardsPlayed[Z]+P.length}}}}const q=Te(r,t.id),Q=q?`${q.card.protocol}-${q.card.value}`:"a card effect";return G=ae(G,d,`${Q}: Plays ${P.length} card(s) face-down in other lines.`),{newState:G}}if(h==="deck"&&((E=s.destinationRule)==null?void 0:E.type)==="each_line_with_card"){const B=s.destinationRule.ownerFilter||"any",L=s.destinationRule.cardFilter,P=B==="own"?y:B==="opponent"?y==="player"?"opponent":"player":null,M=H=>{const ne=J=>J.length===0?!1:L?J.some(ie=>L.faceState==="face_down"?!ie.isFaceUp:L.faceState==="face_up"?ie.isFaceUp:!0):!0;return P?ne(r[P].lanes[H]):ne(r.player.lanes[H])||ne(r.opponent.lanes[H])},N=[];for(let H=0;H<3;H++)M(H)&&N.push(H);if(N.length===0)return{newState:r};const R=r[y];if(R.deck.length===0&&R.discard.length===0)return{newState:ae(r,d,`${y==="player"?"Player":"Opponent"} has no cards in deck/discard - effect skipped.`)};const{drawnCards:$,remainingDeck:X,newDiscard:G}=Jn(R.deck,R.discard,N.length);if($.length===0)return{newState:r};const q=$.map(H=>({...H,id:ct(),isFaceUp:!_}));let Q=r;const K=[];for(let H=0;H<N.length;H++){const ne=N[H],J=Q[y].lanes[ne];if(J.length>0){const ie=J[J.length-1],de={...c,triggerType:"cover"},pe=qc(ie,ne,Q,de);if(Q=pe.newState,pe.animationRequests&&K.push(...pe.animationRequests),Q.actionRequired)break}}const Z=[...Q[y].lanes],te=[];for(let H=0;H<q.length;H++){const ne=N[H];Z[ne]=[...Z[ne],q[H]],te.push({type:"play",cardId:q[H].id,owner:y})}const ee={...Q[y],lanes:Z,deck:X,discard:G};let se={...Q,[y]:ee};if(se.detailedGameStats&&$.length>0){const H=y==="player"?"playerFromEffect":"aiFromEffect",ne=y==="player"?"playerFaceDown":"aiFaceDown";se={...se,detailedGameStats:{...se.detailedGameStats,cardsPlayed:{...se.detailedGameStats.cardsPlayed,[H]:se.detailedGameStats.cardsPlayed[H]+$.length,[ne]:se.detailedGameStats.cardsPlayed[ne]+$.length}}}}const _e=Te(r,t.id),fe=_e?`${_e.card.protocol}-${_e.card.value}`:"a card effect";let be="";(L==null?void 0:L.faceState)==="face_down"?be="with a face-down card":(L==null?void 0:L.faceState)==="face_up"?be="with a face-up card":B==="own"?be="where you have a card":B==="opponent"?be="where opponent has a card":be="with a card",se=ae(se,d,`${fe}: Plays ${$.length} card(s) face-down in each line ${be}.`);const oe=[...K,...te];return{newState:se,animationRequests:oe.length>0?oe:void 0}}if(h==="deck"&&((T=s.destinationRule)==null?void 0:T.type)==="another_line"){if([0,1,2].filter(X=>X!==n).length===0)return{newState:r};const L=r[y];if(L.deck.length===0&&L.discard.length===0)return{newState:ae(r,d,`${y==="player"?"Player":"Opponent"} has no cards in deck/discard - effect skipped.`)};const{drawnCards:P,remainingDeck:M,newDiscard:N}=Jn(L.deck,L.discard,1);if(P.length===0)return{newState:r};const R={...P[0],id:ct(),isFaceUp:!0};let $={...r,[y]:{...L,deck:M,discard:N}};return $.actionRequired={type:"confirm_deck_play_preview",sourceCardId:t.id,actor:y,drawnCard:R,isFaceDown:s.faceDown,excludeCurrentLane:!0,currentLaneIndex:n,followUpEffect:p==null?void 0:p.thenEffect,conditionalType:p==null?void 0:p.type},{newState:$}}if(h==="deck"&&((F=s.destinationRule)==null?void 0:F.type)==="under_this_card"&&((U=s.condition)==null?void 0:U.type)==="per_x_cards_in_line"){const B=s.condition.cardCount||2,L=r[d].lanes[n].length,P=r[u].lanes[n].length,M=L+P,N=Math.floor(M/B);if(N===0)return{newState:r};const R=r[y];if(R.deck.length===0&&R.discard.length===0)return{newState:r};const{drawnCards:$,remainingDeck:X,newDiscard:G}=Jn(R.deck,R.discard,N);if($.length===0)return{newState:r};const q=$.map(_e=>({..._e,id:ct(),isFaceUp:!1})),Q=[...R.lanes[n]];Q.splice(Q.length-1,0,...q);const K=[...R.lanes];K[n]=Q;const Z={...R,lanes:K,deck:X,discard:G};let te={...r,[y]:Z};if(te.detailedGameStats&&$.length>0){const _e=y==="player"?"playerFromEffect":"aiFromEffect",fe=y==="player"?"playerFaceDown":"aiFaceDown";te={...te,detailedGameStats:{...te.detailedGameStats,cardsPlayed:{...te.detailedGameStats.cardsPlayed,[_e]:te.detailedGameStats.cardsPlayed[_e]+$.length,[fe]:te.detailedGameStats.cardsPlayed[fe]+$.length}}}}const ee=Te(r,t.id),se=ee?`${ee.card.protocol}-${ee.card.value}`:"a card effect";return te=ae(te,d,`${se}: Plays ${$.length} card(s) face-down under itself.`),{newState:te}}if(h==="deck"&&((D=s.destinationRule)==null?void 0:D.type)==="specific_lane"){const B=s.destinationRule.laneIndex==="current"?n:s.destinationRule.laneIndex;if(B===void 0||B<0||B>2)return console.error(`[Play Effect] Invalid lane index: ${B}`),{newState:r};const L=s.sourceOwner||"own",P=L==="opponent"?y==="player"?"opponent":"player":y,M=r[P],N=s.targetBoard||"own",R=N==="opponent"?y==="player"?"opponent":"player":y;if(M.deck.length===0&&M.discard.length===0)return{newState:ae(r,d,`No cards in ${L==="opponent"?"opponent's":"your"} deck/discard - effect skipped.`)};const{drawnCards:$,remainingDeck:X,newDiscard:G}=Jn(M.deck,M.discard,f);if($.length===0)return{newState:r};const q=$.map(fe=>({...fe,id:ct(),isFaceUp:!_}));let Q={...r};Q[P]={...Q[P],deck:X,discard:G};const K=[...Q[R].lanes];if(K[B]=[...K[B],...q],Q[R]={...Q[R],lanes:K},Q.detailedGameStats&&$.length>0){const fe=d==="player"?"playerFromEffect":"aiFromEffect",be=d==="player"?_?"playerFaceDown":"playerFaceUp":_?"aiFaceDown":"aiFaceUp";Q={...Q,detailedGameStats:{...Q.detailedGameStats,cardsPlayed:{...Q.detailedGameStats.cardsPlayed,[fe]:Q.detailedGameStats.cardsPlayed[fe]+$.length,[be]:Q.detailedGameStats.cardsPlayed[be]+$.length}}}}const Z=Te(r,t.id),te=Z?`${Z.card.protocol}-${Z.card.value}`:"a card effect",ee=_?"face-down":"face-up",se=r.player.protocols[B];let _e=`${te}: Plays `;return L==="opponent"?_e+="the top card of opponent's deck ":_e+=`${$.length} card(s) from deck `,_e+=`${ee} `,N==="opponent"?_e+=`on opponent's ${se} line.`:_e+=`in ${se} line.`,Q=ae(Q,d,_e),{newState:Q}}if(h==="hand"&&((I=s.destinationRule)==null?void 0:I.type)==="line_with_matching_cards"){const B=s.destinationRule.cardFilter,L=N=>{const R=$=>$.length===0?!1:B?$.some(X=>B.faceState==="face_down"?!X.isFaceUp:B.faceState==="face_up"?X.isFaceUp:!0):!0;return R(r.player.lanes[N])||R(r.opponent.lanes[N])},P=[];for(let N=0;N<3;N++)L(N)&&P.push(N);if(P.length===0){const N=Te(r,t.id),R=N?`${N.card.protocol}-${N.card.value}`:"Effect";return{newState:ae(r,d,`${R}: No valid lanes with face-down cards. Effect skipped.`)}}if(r[y].hand.length===0)return{newState:r};let M={...r};return M.actionRequired={type:"select_card_from_hand_to_play",sourceCardId:t.id,actor:y,count:s.count||1,faceDown:s.faceDown,source:"hand",validLanes:P,cardFilter:B,followUpEffect:p==null?void 0:p.thenEffect,conditionalType:p==null?void 0:p.type},{newState:M}}if(h==="hand"&&((W=s.valueFilter)==null?void 0:W.equals)!==void 0&&!s.destinationRule){const B=s.valueFilter.equals,L=r[y].hand.filter(M=>M.value===B);if(L.length===0){const M=Te(r,t.id),N=M?`${M.card.protocol}-${M.card.value}`:"Effect";return{newState:ae(r,d,`${N}: No cards with value ${B} in hand. Effect skipped.`)}}let P={...r};return P.actionRequired={type:"select_card_from_hand_to_play",sourceCardId:t.id,actor:y,count:s.count||1,faceDown:s.faceDown,source:"hand",valueFilter:B,selectableCardIds:L.map(M=>M.id),followUpEffect:p==null?void 0:p.thenEffect,conditionalType:p==null?void 0:p.type},{newState:P}}if(h==="trash"){if(r[y].discard.length===0){const P=Te(r,t.id),M=P?`${P.card.protocol}-${P.card.value}`:"Effect";return{newState:ae(r,d,`${M}: No cards in trash. Effect skipped.`)}}let L={...r};return L.actionRequired={type:"select_card_from_trash_to_play",sourceCardId:t.id,actor:y,count:s.count||1,faceDown:s.faceDown,destinationRule:s.destinationRule,followUpEffect:p==null?void 0:p.thenEffect,conditionalType:p==null?void 0:p.type,sourceLaneIndex:n},{newState:L}}if(h==="hand"&&r[y].hand.length===0)return{newState:r};if(h==="hand"&&((z=s.destinationRule)==null?void 0:z.type)==="specific_lane"){const B=s.destinationRule.laneIndex==="current"?n:s.destinationRule.laneIndex;if(B===void 0||B<0||B>2)return console.error(`[Play Effect] Invalid lane index for hand play: ${B}`),{newState:r};let L;if(s.excludeSourceProtocol){const M=t.protocol,N=r[y].hand.filter(R=>R.protocol!==M);if(N.length===0){const R=Te(r,t.id),$=R?`${R.card.protocol}-${R.card.value}`:"Effect";return{newState:ae(r,d,`${$}: No non-${M} cards in hand. Effect skipped.`)}}L=N.map(R=>R.id)}let P={...r};return P.actionRequired={type:"select_card_from_hand_to_play",count:s.count||1,sourceCardId:t.id,actor:y,faceDown:_,source:h,forcedLaneIndex:B,ignoreProtocolMatching:_===void 0,selectableCardIds:L,excludeSourceProtocol:s.excludeSourceProtocol,sourceProtocol:s.excludeSourceProtocol?t.protocol:void 0,optional:s.optional,followUpEffect:p==null?void 0:p.thenEffect,conditionalType:p==null?void 0:p.type},{newState:P}}let m;if(s.excludeSourceProtocol&&h==="hand"){const B=t.protocol,L=r[y].hand.filter(P=>P.protocol!==B);if(L.length===0){const P=Te(r,t.id),M=P?`${P.card.protocol}-${P.card.value}`:"Effect";return{newState:ae(r,d,`${M}: No non-${B} cards in hand. Effect skipped.`)}}m=L.map(P=>P.id)}let g={...r},x;(V=s.destinationRule)!=null&&V.excludeCurrentLane&&(x=n);let C;if(s.useCardFromPreviousEffect&&h==="hand"){const B=r.lastCustomEffectTargetCardId;if(B&&(C=[B],!r[y].hand.find(P=>P.id===B)))return{newState:r}}return m&&(C=m),g.actionRequired={type:"select_card_from_hand_to_play",count:f,sourceCardId:t.id,actor:y,faceDown:_,source:h,disallowedLaneIndex:x,destinationRule:s.destinationRule,condition:s.condition,selectableCardIds:C,excludeSourceProtocol:s.excludeSourceProtocol,sourceProtocol:s.excludeSourceProtocol?t.protocol:void 0,optional:s.optional,followUpEffect:p==null?void 0:p.thenEffect,conditionalType:p==null?void 0:p.type},{newState:g}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Reveal/Give Effect Executor
 *
 * Handles reveal and give card effects.
 * Extracted 1:1 from effectInterpreter.ts for modularity.
 */function Fw(t,n,r,c,s){var m;const{cardOwner:d,opponent:u}=c,p=s._conditional,f=s.count||1,h=s.action,_=s.source||"own_hand";if(h==="reveal"&&_==="board"){const g=s.targetFilter||{owner:"any",position:"uncovered",faceState:"face_down"},x=s.followUpAction,C=s.optional!==!1,b=[],j=g.owner==="own"?[d]:g.owner==="opponent"?[u]:[d,u];for(const E of j)for(let T=0;T<r[E].lanes.length;T++){const F=r[E].lanes[T];if(F.length>0){let U=[];g.position==="uncovered"?U=[F[F.length-1]]:g.position==="covered"?U=F.slice(0,-1):U=[...F];const D=U.filter(I=>g.faceState==="face_up"?I.isFaceUp:g.faceState==="face_down"?!I.isFaceUp:!0);b.push(...D)}}if(b.length===0)return{newState:ae(r,d,"No valid cards to reveal. Effect skipped.")};let k={...r};return k.actionRequired={type:"select_board_card_to_reveal_custom",sourceCardId:t.id,actor:d,targetFilter:g,followUpAction:x,optional:C,followUpEffect:p==null?void 0:p.thenEffect,conditionalType:p==null?void 0:p.type},{newState:k}}if(h==="reveal"&&_==="opponent_hand"){let g={...r};const x={...g[u]};if(x.hand.length>0){x.hand=x.hand.map(b=>({...b,isRevealed:!0})),g[u]=x;const C=`${t.protocol}-${t.value}`;g=ae(g,d,`${C}: Your opponent reveals their hand.`)}else{const C=`${t.protocol}-${t.value}`;g=ae(g,d,`${C}: Opponent has no cards to reveal.`)}return{newState:g}}if(h==="reveal"&&_==="own_deck_top"){let g={...r};const x={...g[d]},C=`${t.protocol}-${t.value}`;if(x.deck.length===0)return g=ae(g,d,`${C}: No cards in deck to reveal.`),{newState:g};const b=[...x.deck],j=b[0];g=ae(g,d,`${C}: Revealed ${j.protocol}-${j.value} from top of deck.`);const k=`deck-top-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;return b[0]={...j,id:k},x.deck=b,g[d]=x,g.lastCustomEffectTargetCardId=k,{newState:g}}if(h==="reveal"&&_==="own_trash"){let g={...r};const x={...g[d]},C=`${t.protocol}-${t.value}`;return x.discard.length===0?(g=ae(g,d,`${C}: No cards in trash to reveal.`),g._effectSkippedNoTargets=!0,{newState:g}):(g.actionRequired={type:"select_card_from_trash_to_reveal",sourceCardId:t.id,actor:d,count:f,followUpEffect:p==null?void 0:p.thenEffect,conditionalType:p==null?void 0:p.type,sourceLaneIndex:n},{newState:g})}if(h==="reveal"&&_==="own_deck"){let g={...r};const x={...g[d]},C=`${t.protocol}-${t.value}`;if(x.deck.length===0)return g=ae(g,d,`${C}: No cards in deck to reveal.`),{newState:g};x.deckRevealed=!0,g[d]=x;const b=x.deck.map(j=>`${j.protocol}-${j.value}`).join(", ");return g=ae(g,d,`${C}: Revealed deck: ${b}`),{newState:g}}if(h==="reveal"&&_==="own_hand"&&((m=s.protocolFilter)==null?void 0:m.type)==="same_as_source"){let g={...r};const x={...g[d]},C=`${t.protocol}-${t.value}`,b=x.hand.filter(k=>k.protocol===t.protocol);if(b.length===0)return g=ae(g,d,`${C}: No ${t.protocol} cards in hand to reveal.`),{newState:g};x.hand=x.hand.map(k=>k.protocol===t.protocol?{...k,isRevealed:!0}:k),g[d]=x;const j=b.map(k=>`${k.protocol}-${k.value}`).join(", ");return g=ae(g,d,`${C}: Revealed ${b.length} ${t.protocol} card(s) from hand: ${j}`),{newState:g}}if(r[d].hand.length===0)return{newState:ae(r,d,`No cards in hand to ${h}. Effect skipped.`)};let y={...r};return h==="reveal"?y.actionRequired={type:"select_card_from_hand_to_reveal",count:f,sourceCardId:t.id,actor:d,followUpEffect:p==null?void 0:p.thenEffect,conditionalType:p==null?void 0:p.type}:h==="give"&&(y.actionRequired={type:"select_card_from_hand_to_give",count:f,sourceCardId:t.id,actor:d,followUpEffect:p==null?void 0:p.thenEffect,conditionalType:p==null?void 0:p.type}),{newState:y}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Shuffle Effect Executor
 *
 * Handles shuffle_trash and shuffle_deck effects.
 * - shuffle_trash: Clarity-4 "You may shuffle your trash into your deck."
 *   (In this codebase, "trash" = "discard pile")
 * - shuffle_deck: Clarity-2/3 "Shuffle your deck."
 */function $w(t,n,r,c,s){var h;const{cardOwner:d}=c,u=s._conditional,p=`${t.protocol}-${t.value}`,f=s.optional!==!1;if(((h=s.advancedConditional)==null?void 0:h.type)==="trash_not_empty"&&r[d].discard.length===0)return{newState:ae(r,d,`${p}: No cards in trash - effect skipped.`)};if(r[d].discard.length===0)return{newState:ae(r,d,`${p}: No cards in trash to shuffle.`)};if(f){let _={...r};return _.actionRequired={type:"prompt_optional_shuffle_trash",sourceCardId:t.id,actor:d,trashCount:r[d].discard.length,followUpEffect:u==null?void 0:u.thenEffect,conditionalType:u==null?void 0:u.type},{newState:_}}return Vm(r,d,p)}function Vm(t,n,r){let c={...t};const s={...c[n]},d=s.discard.length;return d===0?(c=ae(c,n,`${r}: No cards in trash to shuffle.`),{newState:c}):(s.deck=[...s.deck,...s.discard],s.discard=[],s.deck=qn([...s.deck]),c[n]=s,c=ae(c,n,`${r}: Shuffled ${d} card${d!==1?"s":""} from trash into deck.`),c=dt(c,"after_shuffle",{player:n}).newState,{newState:c})}function Iw(t,n,r,c,s){const{cardOwner:d}=c,u=`${t.protocol}-${t.value}`;let p={...r};const f={...p[d]};return f.deck.length===0?(p=ae(p,d,`${u}: No cards in deck to shuffle.`),{newState:p}):(f.deck=qn([...f.deck]),f.deckRevealed=!1,p[d]=f,p=ae(p,d,`${u}: Shuffled deck.`),p=dt(p,"after_shuffle",{player:d}).newState,{newState:p})}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * State Number Effect Executor
 *
 * Handles the "state a number" effect (Luck-0).
 * Player chooses a number (0-5) which is stored in state for subsequent effects.
 */function qw(t,n,r,c,s){const{cardOwner:d}=c;let u={...r};return u.actionRequired={type:"state_number",actor:d,sourceCardId:t.id,numberSource:s.numberSource||"own_protocol_values"},{newState:u}}function Lw(t,n,r){let c={...t};return c.lastStatedNumber=r,c=ae(c,n,`${n==="player"?"Player":"Opponent"} states the number ${r}.`),c.actionRequired=null,c}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * State Protocol Effect Executor
 *
 * Handles the "state a protocol" effect (Luck-3).
 * Player chooses a protocol from opponent's cards which is stored for subsequent effects.
 */function Pw(t,n){const r=new Set;t[n].deck.forEach(u=>r.add(u.protocol)),t[n].hand.forEach(u=>r.add(u.protocol)),t[n].lanes.forEach(u=>{u.forEach(p=>r.add(p.protocol))}),t[n].discard.forEach(u=>r.add(u.protocol));const c=[],s=t[n].protocols;for(const u of s)r.has(u)&&!c.includes(u)&&c.push(u);const d=Array.from(r).filter(u=>!c.includes(u)).sort();return c.push(...d),c}function Uw(t,n,r,c,s){const{cardOwner:d,opponent:u}=c;let p=[];if(s.protocolSource==="opponent_cards"&&(p=Pw(r,u)),p.length===0){let h=ae(r,d,"No protocols available to state - effect skipped.");return h._effectSkippedNoTargets=!0,{newState:h}}let f={...r};return f.actionRequired={type:"state_protocol",actor:d,sourceCardId:t.id,protocolSource:s.protocolSource||"opponent_cards",availableProtocols:p},{newState:f}}function Ow(t,n,r){let c={...t};return c.lastStatedProtocol=r,c=ae(c,n,`${n==="player"?"Player":"Opponent"} states the protocol "${r}".`),c.actionRequired=null,c}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Swap Stacks Effect Executor (Mirror-2)
 *
 * Swaps all cards between two of the player's own lanes.
 * Does NOT swap protocols - only the card stacks.
 */function Mw(t,n,r,c,s){const{cardOwner:d}=c;if(!r[d].lanes.some(h=>h.length>0))return{newState:ae(r,d,"Cannot swap stacks: no cards on board.")};const p=[0,1,2];let f={...r};return f.actionRequired={type:"select_lanes_for_swap_stacks",actor:d,sourceCardId:t.id,validLanes:p,selectedFirstLane:void 0},{newState:f}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Copy Opponent Middle Effect Executor (Mirror-1)
 *
 * Allows the player to select one of the opponent's face-up uncovered cards
 * and execute its middle effects as if they were on this card.
 */function Vw(t){var r,c;return((c=(r=t.customEffects)==null?void 0:r.middleEffects)==null?void 0:c.length)>0}function Hw(t){var r;return((r=t.customEffects)==null?void 0:r.middleEffects)||[]}function zw(t,n,r,c,s){const{cardOwner:d}=c,u=d==="player"?"opponent":"player",p=s.optional??!1,f=[];for(let _=0;_<r[u].lanes.length;_++){const y=r[u].lanes[_];if(y.length===0)continue;const m=y[y.length-1];m.isFaceUp&&Vw(m)&&f.push(m.id)}if(f.length===0)return{newState:ae(r,d,"No opponent cards with middle commands to copy.")};let h={...r};return h.actionRequired={type:"select_card_for_copy_middle",actor:d,sourceCardId:t.id,validTargetIds:f,optional:p},{newState:h}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function Bw(t,n,r,c,s){var p,f;const{cardOwner:d}=c;let u={...r};if(((p=s.protocolCountConditional)==null?void 0:p.type)==="unique_protocols_on_field"){const h=s.protocolCountConditional.threshold,_=vr(r);if(_<h)return u=ae(u,d,`Not enough different protocols on field (${_}/${h}). Effect skipped.`),{newState:u};u=ae(u,d,`${_} different protocols on field. Protocol compiled!`)}else if(((f=s.protocolCountConditional)==null?void 0:f.type)==="same_protocol_count_on_field"){const h=s.protocolCountConditional.threshold,_=mu(r,t.protocol);if(_<h)return u=ae(u,d,`Not enough face-up ${t.protocol} cards on field (${_}/${h}). Effect skipped.`),{newState:u};u=ae(u,d,`${_} face-up ${t.protocol} cards on field. Protocol compiled!`)}if(!u[d].compiled[n]){u[d]={...u[d],compiled:[...u[d].compiled.slice(0,n),!0,...u[d].compiled.slice(n+1)]};const h={...u.stats[d],protocolsCompiled:u.stats[d].protocolsCompiled+1};u={...u,stats:{...u.stats,[d]:h}}}if(s.deleteAllInLane){const h=d==="player"?"opponent":"player",_=[...u[d].lanes[n]],y=[...u[h].lanes[n]],m=_.map(({id:C,isFaceUp:b,...j})=>j),g=y.map(({id:C,isFaceUp:b,...j})=>j);u={...u,[d]:{...u[d],lanes:[...u[d].lanes.slice(0,n),[],...u[d].lanes.slice(n+1)],discard:[...u[d].discard,...m]},[h]:{...u[h],lanes:[...u[h].lanes.slice(0,n),[],...u[h].lanes.slice(n+1)],discard:[...u[h].discard,...g]}};const x=_.length+y.length;x>0&&(u=ae(u,d,`All ${x} cards in this line deleted.`))}return{newState:u}}function pt(t,n,r,c,s,d){var j,k,E;const u={...s.params,_conditional:s.conditional},p=u.action,f=Te(r,t.id);if(!f)return{newState:r};if(!f.card.isFaceUp)return{newState:r};const h=s.position||"middle",y=s.trigger==="on_cover",m=u.useCardFromPreviousEffect===!0;if(h!=="top"&&!y&&!m&&!Go(r,t.id))return{newState:r};const x=p==="reveal"&&u.source==="board";if(u.optional===!0&&!x){const T=u.actor==="opponent"?c.opponent:c.cardOwner,F=T==="player"?"opponent":"player",U=u.targetFilter||{},D=V=>{for(const B of["player","opponent"])for(let L=0;L<r[B].lanes.length;L++){const P=r[B].lanes[L];for(let M=0;M<P.length;M++)if(V(P[M],B,L,M))return!0}return!1};let I=!0,W="";switch(p){case"discard":!u.useCardFromPreviousEffect&&r[T].hand.length===0&&(I=!1,W="No cards to discard");break;case"flip":{const V=(j=r.passiveEffects)==null?void 0:j.some(B=>B.type==="prevent_flip_to_face_up"&&B.isActive);I=D((B,L,P,M)=>{if(U.excludeSelf&&B.id===t.id||U.owner==="own"&&L!==T||U.owner==="opponent"&&L===T)return!1;const N=M===r[L].lanes[P].length-1;return!(U.position==="uncovered"&&!N||U.position==="covered"&&N||U.faceState==="face_up"&&!B.isFaceUp||U.faceState==="face_down"&&B.isFaceUp||V&&!B.isFaceUp)}),I||(W="No valid cards to flip");break}case"delete":{I=D((V,B,L,P)=>{if(U.excludeSelf&&V.id===t.id||U.owner==="own"&&B!==T||U.owner==="opponent"&&B===T)return!1;const M=P===r[B].lanes[L].length-1,N=U.position||"uncovered";return!(N==="uncovered"&&!M||N==="covered"&&M||U.faceState==="face_up"&&!V.isFaceUp||U.faceState==="face_down"&&V.isFaceUp)}),I||(W="No valid cards to delete");break}case"shift":{if(s.useCardFromPreviousEffect){const V=r.lastCustomEffectTargetCardId||r._selectedCardFromPreviousEffect;V?(I=!!Te(r,V),I||(W="Target card no longer exists")):(I=!1,W="No target card from previous effect")}else if(u.shiftSelf&&((k=u.destinationRestriction)==null?void 0:k.type)==="opponent_highest_value_lane")Bm(r,c.cardOwner).includes(n)&&(I=!1,W="Card is already in opponent's highest value lane");else if(((E=u.advancedConditional)==null?void 0:E.type)==="this_card_is_covered"){const V=r[c.cardOwner].lanes;let B=!1;for(let L=0;L<V.length;L++){const P=V[L],M=P.findIndex(N=>N.id===t.id);if(M!==-1){B=M<P.length-1;break}}B||(I=!1,W="Card is not covered")}else{const V=U.position||"uncovered";V==="any"&&U.owner==="own"&&!U.excludeSelf?I=!0:(I=D((L,P,M,N)=>{if(U.excludeSelf&&L.id===t.id||U.owner==="own"&&P!==T||U.owner==="opponent"&&P===T)return!1;const R=N===r[P].lanes[M].length-1;return!(V==="uncovered"&&!R||V==="covered"&&R)}),I||(W="No valid cards to shift"))}break}case"return":{const V=U.owner==="opponent"?F:T;I=D((B,L,P,M)=>{if(L!==V)return!1;const N=M===r[L].lanes[P].length-1,R=U.position||"uncovered";return!(R==="uncovered"&&!N||R==="covered"&&N)}),I||(W="No valid cards to return");break}case"draw":r[T].deck.length===0&&r[T].discard.length===0&&(I=!1,W="No cards to draw");break;case"play":r[T].hand.length===0&&(I=!1,W="No cards to play");break}if(!I){let V=ae(r,T,`${W} - effect skipped.`);return V._effectSkippedNoTargets=!0,p==="discard"&&(V._discardContext={discardedCount:0}),{newState:V}}let z={...r};return z.actionRequired={type:"prompt_optional_effect",actor:c.cardOwner,sourceCardId:t.id,effectDef:s,laneIndex:n,logSource:r._currentEffectSource,logPhase:r._currentPhaseContext,logIndentLevel:r._logIndentLevel||0},{newState:z}}let C;const b={logSource:r._currentEffectSource,logPhase:r._currentPhaseContext,logIndentLevel:r._logIndentLevel||0};switch(p){case"refresh":{const F=(u.target||"self")==="opponent"?c.opponent:c.actor,U=fu(r,F);if(!U.allowed){C={newState:ae(r,c.cardOwner,U.reason||"Cannot refresh (draw blocked).")};break}const D=r[F].hand.length,I=Math.max(0,5-D);if(I>0){const{drawnCards:W,remainingDeck:z,newDiscard:V}=Jn(r[F].deck,r[F].discard,I),B=W.map(R=>({...R,id:ct()}));let L={...r,[F]:{...r[F],hand:[...r[F].hand,...B],deck:z,discard:V}};const P=F==="player"?` (${W.map(R=>`${R.protocol}-${R.value}`).join(", ")})`:"";L=ae(L,F,`[Refresh] Drew ${W.length} cards to reach hand size 5${P}.`),L=dt(L,"after_draw",{player:F,count:W.length}).newState,L=dt(L,"after_refresh",{player:F}).newState,C={newState:L}}else{let W=ae(r,F,`[Refresh] Hand already at ${D} cards, no draw needed.`);W=dt(W,"after_refresh",{player:F}).newState,C={newState:W}}break}case"mutual_draw":{const T=c.actor,F=T==="player"?"opponent":"player",U=u.count||1;let D={...r};if(D[F].deck.length>0){const{drawnCards:I,remainingDeck:W,newDiscard:z}=Jn(D[F].deck,D[F].discard,U);if(I.length>0){const V=I.map(M=>({...M,id:ct(),isFaceUp:!0}));D={...D,[F]:{...D[F],deck:W,discard:z},[T]:{...D[T],hand:[...D[T].hand,...V]}};const B=T==="player"?"Player":"Opponent",L=F==="player"?"Player":"Opponent",P=T==="player"?` (${V.map(M=>`${M.protocol}-${M.value}`).join(", ")})`:"";D=ae(D,T,`${B} drew ${I.length} card(s) from ${L}'s deck${P}.`)}}if(D[T].deck.length>0){const{drawnCards:I,remainingDeck:W,newDiscard:z}=Jn(D[T].deck,D[T].discard,U);if(I.length>0){const V=I.map(M=>({...M,id:ct(),isFaceUp:!0}));D={...D,[T]:{...D[T],deck:W,discard:z},[F]:{...D[F],hand:[...D[F].hand,...V]}};const B=F==="player"?"Player":"Opponent",L=T==="player"?"Player":"Opponent",P=F==="player"?` (${V.map(M=>`${M.protocol}-${M.value}`).join(", ")})`:"";D=ae(D,F,`${B} drew ${I.length} card(s) from ${L}'s deck${P}.`)}}C={newState:D};break}case"draw":C=jw(t,n,r,c,u);break;case"flip":C=kw(t,n,r,c,{...u,useCardFromPreviousEffect:s.useCardFromPreviousEffect,_conditional:s.conditional});break;case"delete":C=Nw(t,n,r,c,u);break;case"discard":C=Tw(t,n,r,c,{...u,_conditional:s.conditional});break;case"shift":C=Rw(t,n,r,c,{...u,useCardFromPreviousEffect:s.useCardFromPreviousEffect});break;case"return":C=Dw(t,n,r,c,u);break;case"play":C=Aw(t,n,r,c,u);break;case"rearrange_protocols":case"swap_protocols":C=Gw(t,n,r,c,u);break;case"reveal":case"give":C=Fw(t,n,r,c,u);break;case"take":C=Yw(t,n,r,c,u);break;case"choice":C=Ww(t,n,r,c,u);break;case"block_compile":C=Qw(t,n,r,c,u);break;case"delete_all_in_lane":C=Xw(t,n,r,c,u);break;case"shuffle_trash":C=$w(t,n,r,c,u);break;case"shuffle_deck":C=Iw(t,n,r,c);break;case"state_number":C=qw(t,n,r,c,u);break;case"state_protocol":C=Uw(t,n,r,c,u);break;case"swap_stacks":C=Mw(t,n,r,c);break;case"copy_opponent_middle":C=zw(t,n,r,c,u);break;case"auto_compile":C=Bw(t,n,r,c,u);break;default:console.error(`[Custom Effect] Unknown action: ${p}`),C={newState:r};break}if(C.newState.actionRequired&&!C.newState.actionRequired.logSource&&(C={...C,newState:{...C.newState,actionRequired:{...C.newState.actionRequired,logSource:b.logSource,logPhase:b.logPhase,logIndentLevel:b.logIndentLevel}}}),s.conditional&&s.conditional.thenEffect){const{newState:T}=C;if(T.actionRequired)C={newState:{...T,actionRequired:{...T.actionRequired,followUpEffect:s.conditional.thenEffect,conditionalType:s.conditional.type,outerSourceCardId:t.id,outerLaneIndex:n}}};else{if(s.conditional.type==="if_executed"){const D=T._discardContext;if(((D==null?void 0:D.discardedCount)||0)===0)return delete T._discardContext,C={newState:T},C}if(s.conditional.type==="if_protocol_matches_stated"){const D=T._discardContext,I=D==null?void 0:D.discardedCardProtocol,W=T.lastStatedProtocol;if(!W||!I||I!==W){let V=ae(T,c.cardOwner,`Discarded card does not match stated protocol "${W||"none"}". Effect skipped.`);return delete V._discardContext,C={newState:V},C}let z=ae(T,c.cardOwner,`Discarded card matches stated protocol "${W}"!`);delete z._discardContext,C={newState:z}}if(s.conditional.type==="optional"){let D={...T};return D.actionRequired={type:"prompt_optional_effect",actor:c.cardOwner,sourceCardId:t.id,effectDef:s.conditional.thenEffect,laneIndex:n,savedTargetCardId:T.lastCustomEffectTargetCardId},C={newState:D},C}let F=c;const U=T._discardContext;U&&(F={...c,discardedCount:U.discardedCount,previousHandSize:U.previousHandSize},delete T._discardContext),C=pt(t,n,T,F,s.conditional.thenEffect)}}return C}function Gw(t,n,r,c,s){const{cardOwner:d,opponent:u}=c,p=s.action,h=(s.target||"own")==="opponent"?u:d,_=d;if(cw(r)&&p==="rearrange_protocols")return{newState:ae(r,d,"Protocols cannot be rearranged (Frost-1 bottom effect is active).")};let m={...r},g;return s.restriction&&(g={laneIndex:s.restriction.laneIndex==="current"?n:s.restriction.laneIndex,protocol:s.restriction.disallowedProtocol}),p==="rearrange_protocols"?m.actionRequired={type:"prompt_rearrange_protocols",actor:_,target:h,sourceCardId:t.id,disallowedProtocolForLane:g}:p==="swap_protocols"&&(m.actionRequired={type:"prompt_swap_protocols",actor:_,target:h,sourceCardId:t.id,disallowedProtocolForLane:g}),{newState:m}}function Yw(t,n,r,c,s){const{cardOwner:d,opponent:u}=c,p=s.count||1,f=s.random!==!1;if(r[u].hand.length===0)return{newState:ae(r,d,"Opponent has no cards in hand. Effect skipped.")};let h={...r};const _={...h[u]},y={...h[d]};if(f){const m=Math.min(p,_.hand.length),g=[];for(let j=0;j<m;j++){const k=Math.floor(Math.random()*_.hand.length),E=_.hand.splice(k,1)[0];y.hand.push(E),g.push(E)}h={...h,[d]:y,[u]:_};const x=d==="player"?"Player":"Opponent",C=`${t.protocol}-${t.value}`,b=g.map(j=>d==="player"?`${j.protocol}-${j.value}`:"a card").join(", ");return h=ae(h,d,`${C}: ${x} takes ${b} from the opponent's hand.`),{newState:h}}else{console.warn("[Take Effect] Non-random take not yet implemented, falling back to random");const m=Math.floor(Math.random()*_.hand.length),g=_.hand.splice(m,1)[0];y.hand.push(g),h={...h,[d]:y,[u]:_};const x=d==="player"?"Player":"Opponent",C=`${t.protocol}-${t.value}`,b=d==="player"?`${g.protocol}-${g.value}`:"a card";return h=ae(h,d,`${C}: ${x} takes ${b} from the opponent's hand.`),{newState:h}}}function Ww(t,n,r,c,s){var f;const{cardOwner:d}=c,u=s.options||[];if(((f=s.advancedConditional)==null?void 0:f.type)==="same_protocol_on_field"&&!cs(r,t))return{newState:r};if(u.length!==2)return console.error(`[Choice Effect] Expected 2 options, got ${u.length}`),{newState:r};let p={...r};return p.actionRequired={type:"custom_choice",options:u,sourceCardId:t.id,actor:d,laneIndex:n},{newState:p}}function Qw(t,n,r,c,s){const{cardOwner:d,opponent:u}=c,f=(s.target||"opponent")==="opponent"?u:d,h={...r[f],cannotCompile:!0};let _={...r,[f]:h};const y=Te(r,t.id),m=y?`${y.card.protocol}-${y.card.value}`:"Effect";return _=ae(_,d,`${m}: ${f==="player"?"Player":"Opponent"} cannot compile next turn.`),{newState:_}}function Xw(t,n,r,c,s){var _;const{cardOwner:d}=c,u=s.excludeCurrentLane!==!1,p=((_=s.laneCondition)==null?void 0:_.count)||8,f=[];for(let y=0;y<3;y++){if(u&&y===n)continue;r.player.lanes[y].length+r.opponent.lanes[y].length>=p&&f.push(y)}if(f.length===0){const y=`${t.protocol}-${t.value}`;return{newState:ae(r,d,`${y}: No line has ${p} or more cards. Effect skipped.`)}}let h={...r};return h.actionRequired={type:"select_lane_for_delete_all",sourceCardId:t.id,actor:d,validLanes:f,minCards:p},{newState:h}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function dt(t,n,r){var p;let c={...t};if(c._processingReactiveEffects)return{newState:c};c={...c,_processingReactiveEffects:!0};const s=c.processedClearCacheTriggerIds||[],d=[],u=f=>f.some(h=>h.trigger===n||h.trigger==="on_cover_or_flip"&&(n==="on_cover"||n==="on_flip"));for(const f of["player","opponent"])c[f].lanes.forEach((h,_)=>{h.forEach((y,m)=>{if(!y.isFaceUp)return;const g=c._committedCardId;if(g&&y.id===g)return;const x=y;if(!x.customEffects)return;const C=m===h.length-1;if(x.customEffects.topEffects&&u(x.customEffects.topEffects)){if(n==="after_clear_cache"&&s.includes(y.id))return;d.push({card:y,owner:f,laneIndex:_,box:"top"})}if(x.customEffects.middleEffects&&u(x.customEffects.middleEffects)){if(n==="after_clear_cache"&&s.includes(y.id))return;d.push({card:y,owner:f,laneIndex:_,box:"middle"})}if(C&&x.customEffects.bottomEffects){const b=x.customEffects.bottomEffects.filter(j=>j.trigger!=="on_cover");if(b.length>0&&u(b)){if(n==="after_clear_cache"&&s.includes(y.id))return;d.push({card:y,owner:f,laneIndex:_,box:"bottom"})}}})});if(d.length===0)return delete c._processingReactiveEffects,{newState:c};for(const{card:f,owner:h,laneIndex:_,box:y}of d){const m=c[h].lanes[_],g=m==null?void 0:m.findIndex(U=>U.id===f.id);if(!(g!==void 0&&g!==-1&&((p=m[g])==null?void 0:p.isFaceUp))||y==="bottom"&&!(g===m.length-1)||n==="before_compile_delete"&&(r==null?void 0:r.cardId)!==f.id||n==="on_flip"&&(r==null?void 0:r.cardId)!==f.id||(n==="on_cover"||n==="on_flip")&&r!=null&&r.cardId&&r.cardId!==f.id)continue;const C=f,k=(y==="top"?C.customEffects.topEffects:y==="middle"?C.customEffects.middleEffects:C.customEffects.bottomEffects).filter(U=>U.trigger===n||U.trigger==="on_cover_or_flip"&&(n==="on_cover"||n==="on_flip")).filter(U=>{const D=U.reactiveTriggerActor||"self";if(!(r!=null&&r.player))return!0;if(n==="after_opponent_discard"||n==="after_opponent_draw"||n==="after_opponent_refresh"||n==="after_opponent_compile")return r.player===h;if(D==="self"){if(r.player!==h)return!1}else if(D==="opponent"&&r.player===h)return!1;return!((U.reactiveScope||"global")==="this_lane"&&(r==null?void 0:r.laneIndex)!==void 0&&_!==r.laneIndex||U.onlyDuringOpponentTurn&&c.turn===h)});if(k.length===0)continue;const E=`${f.protocol}-${f.value}`;c=Ma(c),c=Ke(c,E),c=tt(c,"after");const T=h==="player"?"opponent":"player",F={cardOwner:h,actor:h,currentTurn:c.turn,opponent:T,triggerType:n};if(n==="after_clear_cache"){const U=c.processedClearCacheTriggerIds||[];c.processedClearCacheTriggerIds=[...U,f.id]}for(const U of k){const D=pt(f,_,c,F,U);if(c=Re(D.newState),c.actionRequired){const I=c.actionRequired.actor||h;I!==t.turn&&!c._interruptedTurn&&(c._interruptedTurn=t.turn,c._interruptedPhase=t.phase,c.turn=I);const W=c._pendingCustomEffects;if(W&&W.effects.length>0){const z={type:"execute_remaining_custom_effects",sourceCardId:W.sourceCardId,laneIndex:W.laneIndex,effects:W.effects,context:W.context,actor:W.context.cardOwner};c.queuedActions=[z,...c.queuedActions||[]],delete c._pendingCustomEffects}return delete c._processingReactiveEffects,{newState:c}}}c=Yo(c),c=Ke(c,void 0),c=tt(c,void 0)}return delete c._processingReactiveEffects,{newState:c}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function Jn(t,n,r){let c=[...t],s=[...n],d=[],u=!1;for(let p=0;p<r;p++){if(c.length===0){if(s.length===0)break;c=qn(s),s=[],u=!0}d.push(c.shift())}return{drawnCards:d,remainingDeck:c,newDiscard:s,reshuffled:u}}function xr(t,n,r,c="effect"){const s=t[n],{drawnCards:d,remainingDeck:u,newDiscard:p,reshuffled:f}=Jn(s.deck,s.discard,r);if(d.length===0)return t;const h=d.map(x=>({...x,id:ct(),isFaceUp:!0})),_=h.map(x=>x.id),y={...s.stats,cardsDrawn:s.stats.cardsDrawn+d.length},m={...s,deck:u,discard:p,hand:[...s.hand,...h],stats:y};let g={...t,[n]:m,stats:{...t.stats,[n]:y}};if(g.detailedGameStats&&d.length>0){const x=c==="refresh",C=n==="player"?x?"playerFromRefresh":"playerFromEffect":x?"aiFromRefresh":"aiFromEffect";g={...g,detailedGameStats:{...g.detailedGameStats,cardsDrawn:{...g.detailedGameStats.cardsDrawn,[C]:g.detailedGameStats.cardsDrawn[C]+d.length}}}}return _.length>0&&(g.animationState={type:"drawCard",owner:n,cardIds:_}),f&&(g=ae(g,n,`${n==="player"?"Player":"Opponent"}'s deck is empty. Discard pile has been reshuffled into the deck.`)),d.length>0&&(g=dt(g,"after_draw",{player:n,count:d.length}).newState,g=dt(g,"after_opponent_draw",{player:n==="player"?"opponent":"player",count:d.length}).newState),g}function Zw(t,n,r){const c=n==="player"?"opponent":"player";let s={...t};const d={...s[c]},u={...s[n]},{drawnCards:p,remainingDeck:f,newDiscard:h,reshuffled:_}=Jn(d.deck,d.discard,r);if(p.length>0){const y=p.map(x=>({...x,id:ct(),isFaceUp:!0})),m=y.map(x=>x.id);u.hand=[...u.hand,...y];const g={...u.stats,cardsDrawn:u.stats.cardsDrawn+p.length};if(u.stats=g,d.deck=f,d.discard=h,s={...s,[n]:u,[c]:d,stats:{...s.stats,[n]:g}},m.length>0&&(s.animationState={type:"drawCard",owner:n,cardIds:m}),_&&(s=ae(s,n,`${c==="player"?"Player":"Opponent"}'s deck is empty. Discard pile has been reshuffled into the deck.`)),s.detailedGameStats&&p.length>0){const x=n==="player"?"playerFromEffect":"aiFromEffect";s={...s,detailedGameStats:{...s.detailedGameStats,cardsDrawn:{...s.detailedGameStats.cardsDrawn,[x]:s.detailedGameStats.cardsDrawn[x]+p.length}}}}}return s}function Kw(t,n){const c=5-t[n].hand.length;if(c<=0)return t;let d=ae(t,n,`${n==="player"?"Player":"Opponent"} refreshes their hand, drawing ${c} card(s).`);d=xr(d,n,c,"refresh");const u={...d[n],stats:{...d[n].stats,handsRefreshed:d[n].stats.handsRefreshed+1}};if(d={...d,[n]:u,stats:{...d.stats,[n]:u.stats}},d.detailedGameStats){const _=n==="player"?"playerCardsDrawn":"aiCardsDrawn";d={...d,detailedGameStats:{...d.detailedGameStats,refreshes:{...d.detailedGameStats.refreshes,[_]:d.detailedGameStats.refreshes[_]+c}}}}return d=dt(d,"after_refresh",{player:n}).newState,d=dt(d,"after_opponent_refresh",{player:n==="player"?"opponent":"player"}).newState,d}function _r(t,n){const r={...n},c=s=>s.map(d=>d.map(u=>t.has(u.id)?{...u,isFaceUp:!u.isFaceUp}:u));return r.player.lanes=c(r.player.lanes),r.opponent.lanes=c(r.opponent.lanes),Re(r)}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const gm=t=>{const n=qn(uo(t)),{drawnCards:r,remainingDeck:c}=Jn(n,[],5),s={cardsPlayed:0,cardsDiscarded:0,cardsDeleted:0,cardsFlipped:0,cardsShifted:0,cardsDrawn:r.length,cardsReturned:0,handsRefreshed:0},d=r.map(u=>({...u,id:ct(),isFaceUp:!0}));return{protocols:t,deck:c,hand:d,lanes:[[],[],[]],discard:[],compiled:[!1,!1,!1],laneValues:[0,0,0],cannotCompile:!1,stats:s}},ns=(t,n,r,c="player")=>{const s=gm(t),d=gm(n),u={player:s,opponent:d,turn:c,phase:"start",controlCardHolder:null,useControlMechanic:r,winner:null,log:[],actionRequired:null,queuedActions:[],animationState:null,compilableLanes:[],processedStartEffectIds:[],processedEndEffectIds:[],lastPlayedCardId:void 0,stats:{player:s.stats,opponent:d.stats},detailedGameStats:{cardsPlayed:{playerFromHand:0,playerFromEffect:0,aiFromHand:0,aiFromEffect:0,playerFaceUp:0,playerFaceDown:0,aiFaceUp:0,aiFaceDown:0},cardsDrawn:{playerFromRefresh:0,playerFromEffect:0,aiFromRefresh:0,aiFromEffect:0},compiles:{playerFirstCompile:0,playerRecompile:0,aiFirstCompile:0,aiRecompile:0},refreshes:{playerCardsDrawn:0,aiCardsDrawn:0}}},p=c==="player"?"Player":"Opponent",f=t.join(", "),h=n.join(", ");let _=ae(u,"player","Game Started.");return _=ae(_,"player",`Player protocols: ${f}`),_=ae(_,"opponent",`Opponent protocols: ${h}`),_=ae(_,"player",`${p} goes first.`),_},fn=(t,n,r,c,s)=>{if(t.isFaceUp)return t.value;if(n.some(u=>u.isFaceUp&&u.protocol==="Darkness"&&u.value===2))return 4;if(r&&c!==void 0&&s!==void 0){const u=Hm(r);for(const p of u)if(p.type==="set_to_fixed"){if(!(p.scope==="global"||p.scope==="this_lane"&&p.laneIndex===c))continue;const h=p.cardOwner;if(p.target==="own_cards"&&h!==s||p.target==="opponent_cards"&&h===s)continue;const _=p.filter;if(_&&(!_.faceState||_.faceState==="any"||_.faceState==="face_down"&&!t.isFaceUp||_.faceState==="face_up"&&t.isFaceUp))return p.value}}return 2},vm=(t,n,r,c)=>{let s=0;for(const d of t)d.isFaceUp?s+=d.value:s+=fn(d,t,n,r,c);return Math.max(0,s)};function Hm(t){const n=[];for(const r of["player","opponent"])t[r].lanes.forEach((c,s)=>{c.forEach(d=>{if(d.isFaceUp){const u=d;u.customEffects&&[...u.customEffects.topEffects||[],...u.customEffects.middleEffects||[],...u.customEffects.bottomEffects||[]].forEach(f=>{f.params.action==="value_modifier"&&f.trigger==="passive"&&n.push({...f.params.modifier,cardOwner:r,laneIndex:s,sourceCardProtocol:d.protocol})})}})});return n}function Jw(t,n,r){const c=Hm(t),s=[...n],d=[...r];for(const u of c){const{type:p,value:f,condition:h,target:_,scope:y,filter:m,cardOwner:g,laneIndex:x}=u,C=y==="global"?[0,1,2]:[x];for(const b of C)switch(p){case"add_per_condition":{if(!h)continue;let j=0;const k=t.player.lanes[b],E=t.opponent.lanes[b];h==="per_face_down_card"?j=k.filter(T=>!T.isFaceUp).length+E.filter(T=>!T.isFaceUp).length:h==="per_face_up_card"?j=k.filter(T=>T.isFaceUp).length+E.filter(T=>T.isFaceUp).length:h==="per_card"?j=k.length+E.length:h==="per_card_in_hand"?j=t[g].hand.length:h==="per_opponent_card_in_lane"&&(j=t[g==="player"?"opponent":"player"].lanes[b].length),_==="own_total"&&g==="player"?s[b]+=f*j:_==="own_total"&&g==="opponent"||_==="opponent_total"&&g==="player"?d[b]+=f*j:_==="opponent_total"&&g==="opponent"&&(s[b]+=f*j);break}case"set_to_fixed":break;case"add_to_total":{if(h==="has_non_own_protocol_face_up"){const j=t[g].lanes[x],k=u.sourceCardProtocol;if(!k||!j.some(T=>T.isFaceUp&&T.protocol!==k))continue}_==="own_total"&&g==="player"?s[b]+=f:_==="own_total"&&g==="opponent"||_==="opponent_total"&&g==="player"?d[b]+=f:_==="opponent_total"&&g==="opponent"&&(s[b]+=f);break}}}return{finalPlayerValues:s.map(u=>Math.max(0,u)),finalOpponentValues:d.map(u=>Math.max(0,u))}}function ex(t,n,r){let c=[...n],s=[...r];return{finalPlayerValues:c,finalOpponentValues:s}}const Re=t=>{const n=t.player.lanes.map((u,p)=>vm(u,t,p,"player")),r=t.opponent.lanes.map((u,p)=>vm(u,t,p,"opponent")),c=ex(t,n,r),{finalPlayerValues:s,finalOpponentValues:d}=Jw(t,c.finalPlayerValues,c.finalOpponentValues);return{...t,player:{...t.player,laneValues:s},opponent:{...t.opponent,laneValues:d}}},zm=(t,n)=>{const r=[],c=t[n],s=t[n==="player"?"opponent":"player"];if(!c.cannotCompile)for(let d=0;d<3;d++){const u=c.laneValues[d],p=s.laneValues[d];u>=10&&u>p&&r.push(d)}return r},ha=(t,n,r)=>t[n].laneValues[r],tx=(t,n)=>{const r=n==="player"?"opponent":"player",c=[];for(let s=0;s<3;s++){const d=t[n].laneValues[s];t[r].laneValues[s]>d&&c.push(s)}return c},Bm=(t,n)=>{const r=n==="player"?"opponent":"player";let c=-1,s=[];for(let d=0;d<3;d++){const u=t[r].laneValues[d];u>c?(c=u,s=[d]):u===c&&s.push(d)}return s};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const nx=["select_card_to_flip","select_any_card_to_flip"];function ax(t,n,r){if(!r||!nx.includes(r.type))return null;const c=Te(t,n);if(c&&c.card.protocol==="Metal"&&c.card.value===6){const s="actor"in r?r.actor:t.turn,d=s==="player"?"Player":"Opponent",u=c.owner==="player"?"Player's":"Opponent's";let p="An effect";if("sourceCardId"in r&&r.sourceCardId){const k=Te(t,r.sourceCardId);k&&(p=`${k.card.protocol}-${k.card.value}`)}let f=ae(t,s,`${p}: ${d} flips ${u} Metal-6.`);f=ae(f,s,"Metal-6: Deletes itself when flipped.");const h={...t.stats[s],cardsDeleted:t.stats[s].cardsDeleted+1},_={...t[s],stats:h};f={...f,[s]:_,stats:{...f.stats,[s]:h}};const y=c.owner,m=t[y].lanes.findIndex(k=>k.some(E=>E.id===n)),g=t[y].lanes[m],x=g&&g.length>0&&g[g.length-1].id===n,C=g&&g.length>1,b=t._pendingCustomEffects,j=(k,E)=>{var W,z;let T={...k};const F=b&&((W=T.queuedActions)==null?void 0:W.some(V=>V.type==="execute_remaining_custom_effects"&&V.sourceCardId===b.sourceCardId));b&&!F&&(T._pendingCustomEffects=b,T.lastCustomEffectTargetCardId=n);let D=dt(T,"after_delete",{player:T.turn}).newState;if(x&&C&&(D=ea(D,y,m).newState),r&&"count"in r&&r.count>1){const V=r.count-1;return D.actionRequired={...r,count:V},{...D,animationState:null}}if(T.actionRequired||T.queuedActions&&T.queuedActions.length>0)return{...D,actionRequired:T.actionRequired,queuedActions:T.queuedActions,animationState:null};const I=b&&((z=D.queuedActions)==null?void 0:z.some(V=>V.type==="execute_remaining_custom_effects"&&V.sourceCardId===b.sourceCardId));if(b&&!D._pendingCustomEffects&&!I&&(D._pendingCustomEffects=b,D.lastCustomEffectTargetCardId=n),D=nt(D),D.actionRequired=null,D.queuedActions&&D.queuedActions.length>0){const V=[...D.queuedActions],B=V.shift();if((B==null?void 0:B.type)==="execute_remaining_custom_effects"){const L={...D,queuedActions:[B,...V]},P=Va(L);if(P.actionRequired)return{...P,animationState:null};if(P.queuedActions&&P.queuedActions.length>0){const M=[...P.queuedActions],N=M.shift();return{...P,actionRequired:N,queuedActions:M,animationState:null}}return E(P)}return{...D,actionRequired:B,queuedActions:V,animationState:null}}return E(D)};return{nextState:{...f,actionRequired:null},requiresAnimation:{animationRequests:[{type:"delete",cardId:n,owner:c.owner}],onCompleteCallback:j},requiresTurnEnd:!1}}return null}const nu=(t,n)=>{var u,p,f,h,_,y,m,g,x,C,b,j,k,E,T,F,U,D;if(!t.actionRequired)return{nextState:t};let r={...t},c=!0,s=null;const d=ax(t,n,t.actionRequired);if(d)return d;switch(t.actionRequired.type){case"select_card_to_flip":{const{logSource:I,logPhase:W,logIndentLevel:z}=t.actionRequired;I!==void 0&&(r=Ke(r,I)),W!==void 0&&(r=tt(r,W)),z!==void 0&&(r._logIndentLevel=z);const V=t._committedCardId;if(V&&n===V)return{nextState:t};if(!rs(t,n).allowed)return{nextState:t};const L=Te(t,n),P="draws"in t.actionRequired?t.actionRequired.draws:0;r=Jd(t,n);const M=n;r.lastCustomEffectTargetCardId=M;let N;if(L){const ee=t[L.owner].lanes.findIndex(se=>se.some(_e=>_e.id===n));ee!==-1&&(N=ee,r.lastFlipLaneIndex=ee)}const R=(u=t.actionRequired)==null?void 0:u.sourceCardId;if(R&&r.queuedActions&&(r.queuedActions=r.queuedActions.map(ee=>{var se;return ee.type==="execute_remaining_custom_effects"&&ee.sourceCardId===R&&!ee.selectedCardFromPreviousEffect&&((se=ee.effects)==null?void 0:se.some(fe=>fe.useCardFromPreviousEffect))?{...ee,selectedCardFromPreviousEffect:n}:ee})),P&&P>0){const{actor:ee,sourceCardId:se}=t.actionRequired,_e=Te(r,se),fe=_e?`${_e.card.protocol}-${_e.card.value}`:"A card effect";r=ae(r,ee,`${fe}: Drawing ${P} card(s).`),r=xr(r,ee,P)}if(L&&!L.card.isFaceUp){const ee=tu(r,n);r=ee.newState,r.lastCustomEffectTargetCardId=M,N!==void 0&&(r.lastFlipLaneIndex=N),ee.animationRequests&&(s={animationRequests:ee.animationRequests,onCompleteCallback:(se,_e)=>se.actionRequired||se.queuedActions&&se.queuedActions.length>0?se:_e(se)})}const X=((p=t.actionRequired)==null?void 0:p._followUpAlreadyExecuted)||(f=t.actionRequired)==null?void 0:f.followUpEffect,G=(h=t.actionRequired)==null?void 0:h.sourceCardId;X&&G&&(r=ww(r,n,G,X));const q=((_=t.actionRequired)==null?void 0:_.actor)||t.turn,Q=r.actionRequired;Q&&(r.actionRequired=null),r=dt(r,"after_flip",{player:q,cardId:n}).newState,Q&&(r.actionRequired?r.queuedActions=[{...Q,type:Q.type},...r.queuedActions||[]]:r.actionRequired=Q);const Z=r._pendingCustomEffects;if(Z&&Z.effects.length>0){const ee={type:"execute_remaining_custom_effects",sourceCardId:Z.sourceCardId,laneIndex:Z.laneIndex,effects:Z.effects,context:Z.context,actor:Z.context.cardOwner,selectedCardFromPreviousEffect:Z.effects[0].useCardFromPreviousEffect?n:void 0,logSource:Z.logSource,logPhase:Z.logPhase,logIndentLevel:Z.logIndentLevel};r.queuedActions=[ee,...r.queuedActions||[]],delete r._pendingCustomEffects}const te=(y=t.actionRequired)==null?void 0:y.remainingLanes;if(te&&te.length>0&&!r.actionRequired){const ee=te[0],se=te.slice(1),_e=(m=t.actionRequired)==null?void 0:m.params,fe=(g=t.actionRequired)==null?void 0:g.sourceCardId,be=(x=t.actionRequired)==null?void 0:x.actor,oe=(C=t.actionRequired)==null?void 0:C.targetFilter;r.actionRequired={type:"select_card_to_flip",sourceCardId:fe,actor:be,currentLaneIndex:ee,remainingLanes:se,targetFilter:oe,params:_e,followUpEffect:(b=t.actionRequired)==null?void 0:b.followUpEffect,conditionalType:(j=t.actionRequired)==null?void 0:j.conditionalType}}(r.actionRequired||r.queuedActions&&r.queuedActions.length>0)&&(c=!1);break}case"select_card_to_shift":{const{logSource:I,logPhase:W,logIndentLevel:z}=t.actionRequired;I!==void 0&&(r=Ke(r,I)),W!==void 0&&(r=tt(r,W)),z!==void 0&&(r._logIndentLevel=z);const{sourceCardId:V,optional:B}=t.actionRequired;if(B&&V){const P=Te(t,V);if(!P||!P.card.isFaceUp){const M=P?`${P.card.protocol}-${P.card.value}`:"the source card",N=t._logSource;r=Ke(t,M),r=ae(r,t.actionRequired.actor,"Shift was cancelled because the source is no longer active."),r=Ke(r,N),r=nt(r),r.actionRequired=null,c=!0;break}}const L=Te(t,n);if(L){const{owner:P}=L;let M=-1;for(let K=0;K<t[P].lanes.length;K++)if(t[P].lanes[K].some(Z=>Z.id===n)){M=K;break}if(M===-1)return{nextState:t,requiresTurnEnd:!1};const R=(t.actionRequired.targetFilter||{}).position||"uncovered",$=t[P].lanes[M],G=$.findIndex(K=>K.id===n)===$.length-1;if(R==="uncovered"&&!G)return{nextState:t,requiresTurnEnd:!1};if(R==="covered"&&G)return{nextState:t,requiresTurnEnd:!1};const q=t.actionRequired.scope,Q=t.actionRequired.sourceLaneIndex;if(q==="this_lane"&&Q!==void 0&&M!==Q)return{nextState:t,requiresTurnEnd:!1};if(M!==-1){const K=t.actionRequired.targetLaneIndex;if(K!==void 0){const te=t.actionRequired.actor;r=Bo(t,n,P,K,te).newState,c=!r.actionRequired;break}const Z={type:"select_lane_for_shift",cardToShiftId:n,cardOwner:P,originalLaneIndex:M,sourceCardId:t.actionRequired.sourceCardId,actor:t.actionRequired.actor,destinationRestriction:t.actionRequired.destinationRestriction,followUpEffect:t.actionRequired.followUpEffect,conditionalType:t.actionRequired.conditionalType};r.actionRequired=Z}}c=!1;break}case"delete_self":{const{sourceCardId:I,cardToDeleteId:W,actor:z,logSource:V,logPhase:B,logIndentLevel:L}=t.actionRequired;V!==void 0&&(r=Ke(r,V)),B!==void 0&&(r=tt(r,B)),L!==void 0&&(r._logIndentLevel=L);const P=Te(t,W);if(!P){r=ae(r,z,"Card no longer on board. Delete skipped."),r=nt(r),r.actionRequired=null,c=!0;break}const M=`${P.card.protocol}-${P.card.value}`;r=ae(r,z,`Deleting ${M}.`);const{owner:N,laneIndex:R}=P,$=t[N].lanes[R][t[N].lanes[R].length-1].id===W,X=[...t[N].lanes[R]],G=X.findIndex(Z=>Z.id===W);X.splice(G,1);const q=[...t[N].lanes];q[R]=X;let Q={...t,[N]:{...t[N],lanes:q}};r=nt(Q),r.actionRequired=null;const K={...r.stats[z],cardsDeleted:r.stats[z].cardsDeleted+1};r={...r,stats:{...r.stats,[z]:K}},$&&X.length>0&&(r=ea(r,N,R).newState),c=!0;break}case"select_cards_to_delete":case"select_face_down_card_to_delete":case"select_low_value_card_to_delete":case"select_card_from_other_lanes_to_delete":{const{sourceCardId:I,actor:W}=t.actionRequired,{logSource:z,logPhase:V,logIndentLevel:B}=t.actionRequired;z!==void 0&&(r=Ke(r,z)),V!==void 0&&(r=tt(r,V)),B!==void 0&&(r._logIndentLevel=B);const L=Te(t,I);if(!L||!L.card.isFaceUp){const fe=L?`${L.card.protocol}-${L.card.value}`:"the source card";r=ae(r,W,`Effect from ${fe} was cancelled because the source is no longer active.`),r=nt(r),r.actionRequired=null,c=!0;break}const P=Te(t,n);if(!P)return{nextState:t};const M=t.actionRequired.allowedIds;if(M&&!M.includes(n))return console.error(`Illegal delete: Card ${n} is not in allowedIds - value filter not met`),{nextState:t};if(t.actionRequired.protocolMatching){const fe=t.actionRequired.protocolMatching,be=t[P.owner].lanes.findIndex(oe=>oe.some(H=>H.id===n));if(be!==-1){const oe=t.player.protocols[be],H=t.opponent.protocols[be],ne=P.card.protocol,J=ne===oe||ne===H;if(fe==="must_match"&&!J)return console.error(`Illegal delete: ${ne}-${P.card.value} in lane ${be} (protocols: ${oe}/${H}) - card must be in lane with matching protocol`),{nextState:t};if(fe==="must_not_match"&&J)return console.error(`Illegal delete: ${ne}-${P.card.value} in lane ${be} (protocols: ${oe}/${H}) - card must be in lane without matching protocol`),{nextState:t}}}const N=t.actionRequired.targetFilter;if((N==null?void 0:N.calculation)==="highest_value"||(N==null?void 0:N.calculation)==="lowest_value"){const fe=N.owner,be=fe==="opponent"?W==="player"?"opponent":"player":fe==="own"?W:P.owner,H=bw(t,be).some(J=>J.card.id===n),ne=N.calculation==="highest_value"?"highest":"lowest";if(!H)return console.error(`Illegal delete: Card ${n} is not one of the ${ne} value uncovered cards`),{nextState:t}}const R=W==="player"?"Player":"Opponent",$=P.owner==="player"?"Player's":"Opponent's",X=t[P.owner].lanes.findIndex(fe=>fe.some(be=>be.id===n)),G=X!==-1?t[P.owner].protocols[X]:"unknown",q=P.card.isFaceUp?`${P.card.protocol}-${P.card.value}`:`face-down card in Protocol ${G}`,Q=Te(t,t.actionRequired.sourceCardId),K=Q?`${Q.card.protocol}-${Q.card.value}`:"a card effect";r=ae(r,W,`${K}: ${R} deletes ${$} ${q}.`);const Z={...r.stats[W],cardsDeleted:r.stats[W].cardsDeleted+1},te={...r[W],stats:Z};r={...r,[W]:te,stats:{...r.stats,[W]:Z}};const ee=t[P.owner].lanes.findIndex(fe=>fe.some(be=>be.id===n)),se=t[P.owner].lanes[ee],_e=se&&se.length>0&&se[se.length-1].id===n;r=nt(r),r.actionRequired=null,s={animationRequests:[{type:"delete",cardId:n,owner:P.owner}],onCompleteCallback:(fe,be)=>{var Ve,He,Ge;const oe=t.actionRequired.actor,H=t.actionRequired;let J=dt(fe,"after_delete",{player:oe}).newState;J=nt(J);let ie=null;const de=Te(J,H.sourceCardId),pe=Go(J,H.sourceCardId),Se=H.followUpEffect;if(de&&de.card.isFaceUp&&pe){const qe=H.remainingLanes;if(H.type==="select_cards_to_delete"&&qe&&qe.length>0){const Ne=qe[0],Oe=qe.slice(1);ie={type:"select_cards_to_delete",count:((Ve=H.params)==null?void 0:Ve.count)||H.count,sourceCardId:H.sourceCardId,actor:H.actor,currentLaneIndex:Ne,remainingLanes:Oe,disallowedIds:(He=H.params)!=null&&He.excludeSelf?[H.sourceCardId]:[],targetFilter:H.targetFilter,scope:H.scope,protocolMatching:H.protocolMatching,params:H.params}}else if(H.type==="select_cards_to_delete"&&H.count>1)ie={type:"select_cards_to_delete",count:H.count-1,sourceCardId:H.sourceCardId,disallowedIds:[...H.disallowedIds,n],actor:H.actor,followUpEffect:Se};else if(H.type==="select_card_from_other_lanes_to_delete"&&H.count>1){const Ne=t[P.owner].lanes.findIndex(Qe=>Qe.some(Je=>Je.id===n)),Oe=[...H.lanesSelected,Ne];[0,1,2].filter(Qe=>Qe!==H.disallowedLaneIndex&&!Oe.includes(Qe)).some(Qe=>J.player.lanes[Qe].length>0||J.opponent.lanes[Qe].length>0)?ie={type:"select_card_from_other_lanes_to_delete",count:H.count-1,sourceCardId:H.sourceCardId,disallowedLaneIndex:H.disallowedLaneIndex,lanesSelected:Oe,actor:H.actor}:J=ae(J,H.actor,"No cards left in remaining lanes. Effect skipped.")}}else if("count"in H&&H.count>1){const qe=de?`${de.card.protocol}-${de.card.value}`:"the source card",Ne=!de||!de.card.isFaceUp?"the source is no longer active":"the source was covered";J=ae(J,H.actor,`Remaining deletes from ${qe} were cancelled because ${Ne}.`)}let Fe=!1;if(_e){const qe=J,Ne=ea(qe,P.owner,ee),Oe=Ne.newState._interruptedTurn!==void 0;qe._interruptedTurn&&!Ne.newState._interruptedTurn&&(Fe=!0);const Le=[...Ne.newState.queuedActions||[]];ie&&(Oe?Le.push(ie):Le.unshift(ie)),J={...Ne.newState,queuedActions:Le}}else ie&&(J.queuedActions=[...J.queuedActions||[],ie]);if(Se&&!ie)if(J.actionRequired){const qe=Te(J,H.sourceCardId),Ne=H.actor==="player"?"opponent":"player";let Oe=-1;qe&&(Oe=J[qe.owner].lanes.findIndex(Qe=>Qe.some(Je=>Je.id===H.sourceCardId)));const Le={cardOwner:H.actor,actor:H.actor,currentTurn:J.turn,opponent:Ne,triggerType:"start"},ut={type:"execute_remaining_custom_effects",sourceCardId:H.sourceCardId,actor:H.actor,laneIndex:Oe,effects:[Se],context:Le,logSource:H.logSource,logPhase:H.logPhase,logIndentLevel:H.logIndentLevel??1};J.queuedActions=[...J.queuedActions||[],ut]}else{const qe=Te(J,H.sourceCardId),Ne=H.actor==="player"?"opponent":"player";if(qe){const Oe=J[qe.owner].lanes.findIndex(Je=>Je.some(Ft=>Ft.id===H.sourceCardId)),Le={cardOwner:H.actor,actor:H.actor,currentTurn:J.turn,opponent:Ne,triggerType:"start"},ut=`${qe.card.protocol}-${qe.card.value}`;J=Ke(J,H.logSource||ut),J=tt(J,H.logPhase||"start"),J._logIndentLevel=H.logIndentLevel??1,J=pt(qe.card,Oe,J,Le,Se).newState,J=nt(J)}else(Ge=Se.params)!=null&&Ge.deleteSelf&&(J=Ke(J,H.logSource||"the source card"),J=tt(J,H.logPhase||"start"),J._logIndentLevel=H.logIndentLevel??1,J=internalDeleteCard(J,H.sourceCardId).newState,J=ae(J,H.actor,"Deletes itself."))}if(J.actionRequired)return J;if(J.queuedActions&&J.queuedActions.length>0){const qe=J.queuedActions[0];if((qe==null?void 0:qe.type)==="execute_remaining_custom_effects"){const Le=Va(J);return Le.actionRequired?Le:be(Le)}const Ne=[...J.queuedActions],Oe=Ne.shift();if((Oe==null?void 0:Oe.type)==="shift_flipped_card_optional"||(Oe==null?void 0:Oe.type)==="gravity_2_shift_after_flip"){const Le=Te(J,Oe.sourceCardId),ut=Go(J,Oe.sourceCardId);if(!Le||!Le.card.isFaceUp||!ut){const Qe=Le?`${Le.card.protocol}-${Le.card.value}`:"the source card";let Je=ae(J,Oe.actor,`Shift from ${Qe} was cancelled because the source is no longer active.`);if(Ne.length>0){const Ft=Ne.shift();return{...Je,actionRequired:Ft,queuedActions:Ne}}else return be({...Je,actionRequired:null,queuedActions:[]})}}return{...J,actionRequired:Oe,queuedActions:Ne}}if(Fe){if(J.queuedActions&&J.queuedActions.length>0){const qe=[...J.queuedActions],Ne=qe.shift();if((Ne==null?void 0:Ne.type)==="execute_remaining_custom_effects"){const Oe={...J,queuedActions:[Ne,...qe]},Le=Va(Oe);return Le.actionRequired?Le:J}return{...J,actionRequired:Ne,queuedActions:qe}}return J}if(Se&&de&&de.card.isFaceUp&&(!((Se.position||"middle")!=="top")||pe)){const Le=J[de.owner].lanes.findIndex(tn=>tn.some(Gt=>Gt.id===H.sourceCardId)),ut=H.actor==="player"?"opponent":"player",Qe=Se.trigger||"on_play",Je={cardOwner:H.actor,actor:H.actor,currentTurn:J.turn,opponent:ut,triggerType:Qe};if(J=pt(de.card,Le,J,Je,Se).newState,Te(J,H.sourceCardId),J.actionRequired)return J}return be(J)}},c=!1;break}case"plague_4_opponent_delete":{const I=Te(t,n);if(!I)return{nextState:t};const W=t.actionRequired.actor;r=ae(r,W,"Plague-4: Opponent deletes one of their face-down cards.");const z={...r.stats[W],cardsDeleted:r.stats[W].cardsDeleted+1},V={...r[W],stats:z};r={...r,[W]:V,stats:{...r.stats,[W]:z}};const B=t[I.owner].lanes.findIndex(M=>M.some(N=>N.id===n)),L=t[I.owner].lanes[B],P=L&&L.length>0&&L[L.length-1].id===n;r=nt(r),r.actionRequired=null,s={animationRequests:[{type:"delete",cardId:n,owner:I.owner}],onCompleteCallback:(M,N)=>{let $=dt(M,"after_delete",{player:W}).newState;P&&($=ea($,I.owner,B).newState);const X=Te($,t.actionRequired.sourceCardId),G=(X==null?void 0:X.owner)||t.turn,q={type:"plague_4_player_flip_optional",sourceCardId:t.actionRequired.sourceCardId,optional:!0,actor:G};return $.actionRequired?$.queuedActions=[...$.queuedActions||[],q]:$.actionRequired=q,$}},c=!1;break}case"select_card_to_return":{const{logSource:I,logPhase:W,logIndentLevel:z}=t.actionRequired;I!==void 0&&(r=Ke(r,I)),W!==void 0&&(r=tt(r,W)),z!==void 0&&(r._logIndentLevel=z);const{sourceCardId:V,actor:B}=t.actionRequired,P=((k=t.actionRequired)==null?void 0:k._followUpAlreadyExecuted)||(E=t.actionRequired)==null?void 0:E.followUpEffect,M=(T=t.actionRequired)==null?void 0:T.conditionalType,N=(F=t.actionRequired)==null?void 0:F.targetFilter,R=(U=t.actionRequired)==null?void 0:U.destination,$=Te(t,n);if($){const G=t[$.owner].lanes[$.laneIndex],q=((D=G[G.length-1])==null?void 0:D.id)===n,Q=(N==null?void 0:N.position)==="covered"||(N==null?void 0:N.position)==="any";if(!q&&!Q)return console.error(`[cardResolver] Invalid return target: ${$.card.protocol}-${$.card.value} is covered`),{nextState:t,requiresTurnEnd:!1}}const X=eu(t,n,R);if(r=X.newState,X.animationRequests)s={animationRequests:X.animationRequests,onCompleteCallback:(G,q)=>{if(G.actionRequired)return G;let Q=G;if(P&&V&&(M!=="if_executed"||n)){const Z=Te(Q,V);if(Z&&Z.card.isFaceUp){const te=Q[Z.owner].lanes.find(fe=>fe.some(be=>be.id===V)),ee=Q[Z.owner].lanes.indexOf(te),se={cardOwner:Z.owner,actor:B,currentTurn:Q.turn,opponent:Z.owner==="player"?"opponent":"player"};if(Q=pt(Z.card,ee,Q,se,P).newState,Q.actionRequired)return Q}}return q(Q)}};else if(P&&V&&(M!=="if_executed"||n)){const q=Te(r,V);if(q&&q.card.isFaceUp){const Q=r[q.owner].lanes.find(ee=>ee.some(se=>se.id===V)),K=r[q.owner].lanes.indexOf(Q),Z={cardOwner:q.owner,actor:B,currentTurn:r.turn,opponent:q.owner==="player"?"opponent":"player"};r=pt(q.card,K,r,Z,P).newState}}r=nt(r),c=!r.actionRequired&&(!r.queuedActions||r.queuedActions.length===0);break}case"select_opponent_card_to_return":{const{sourceCardId:I,actor:W}=t.actionRequired,z=eu(t,n);let V=z.newState;if(V.actionRequired){const B={type:"flip_self",sourceCardId:I,actor:W};V.queuedActions=[B,...V.queuedActions||[]],r=V,c=!1}else{const B=Te(V,I);if(B){const L=`${B.card.protocol}-${B.card.value}`;V=ae(V,W,`${L}: Flips itself.`),V=_r(new Set([I]),V),V.animationState={type:"flipCard",cardId:I}}r=V,c=!0}z.animationRequests&&(s={animationRequests:z.animationRequests,onCompleteCallback:(B,L)=>B.actionRequired?B:L(B)}),r=nt(r),c||(c=!r.actionRequired&&(!r.queuedActions||r.queuedActions.length===0));break}case"select_any_card_to_flip":{const I=Te(t,n),{count:W,sourceCardId:z,actor:V}=t.actionRequired,B=Te(t,z);if(!B||!B.card.isFaceUp){const M=B?`${B.card.protocol}-${B.card.value}`:"a card";r=ae(t,V,`Effect from ${M} was cancelled because the source is no longer active.`),r=nt(r),r.actionRequired=null,c=!0;break}let L=null;W>1&&(L={type:"select_any_card_to_flip",count:W-1,sourceCardId:z,actor:V});let P=Jd(t,n,L);if(I&&!I.card.isFaceUp){const M=tu(P,n),N=M.newState.actionRequired;N&&N!==L&&L&&(M.newState.queuedActions=[...M.newState.queuedActions||[],L]),r=M.newState,M.animationRequests&&(s={animationRequests:M.animationRequests,onCompleteCallback:(R,$)=>R.actionRequired||R.queuedActions&&R.queuedActions.length>0?R:$(R)})}else r=P;r=nt(r),c=!r.actionRequired&&(!r.queuedActions||r.queuedActions.length===0);break}case"select_board_card_to_reveal_custom":{const{sourceCardId:I,actor:W,followUpAction:z,optional:V}=t.actionRequired,B=W.charAt(0).toUpperCase()+W.slice(1),L=Te(t,n);if(!L)return{nextState:t,requiresTurnEnd:!0};const P=L.owner,M=t[P].lanes.findIndex(G=>G.some(q=>q.id===n));if(M===-1)return{nextState:t,requiresTurnEnd:!0};const N=[...t[P].lanes[M]],R=N.findIndex(G=>G.id===n);if(R===-1)return{nextState:t,requiresTurnEnd:!0};N[R]={...N[R],isFaceUp:!0};const $=[...t[P].lanes];$[M]=N,r={...t,[P]:{...t[P],lanes:$}};const X=`${N[R].protocol}-${N[R].value}`;r=ae(r,W,`${B} reveals ${X}.`),r.actionRequired={type:"prompt_shift_or_flip_board_card_custom",sourceCardId:I,revealedCardId:n,followUpAction:z,optional:V!==!1,actor:W},c=!1;break}case"select_phase_effect":{const I=t.actionRequired;if(!I.availableEffects.find(V=>V.cardId===n))return console.warn(`[cardResolver] Invalid phase effect selection: ${n} not in available effects`),{nextState:t};const z=I.phase==="Start"?"_selectedStartEffectId":"_selectedEndEffectId";r[z]=n,r.actionRequired=null,c=!1;break}case"select_card_for_copy_middle":{const I=t.actionRequired;if(!I.validTargetIds.includes(n))return console.warn(`[cardResolver] Invalid copy_middle target: ${n}`),{nextState:t};const W=Te(t,n);if(!W)return console.error(`[cardResolver] Target card not found: ${n}`),{nextState:t};const{card:z,owner:V}=W;r[V].lanes.findIndex(G=>G.some(q=>q.id===n));const B=Hw(z);if(B.length===0){r=ae(r,I.actor,`${z.protocol}-${z.value} has no middle commands.`),r.actionRequired=null;break}r=ae(r,I.actor,`Copies the middle command of ${z.protocol}-${z.value}.`);const L=Te(t,I.sourceCardId),P=L?r[L.owner].lanes.findIndex(G=>G.some(q=>q.id===I.sourceCardId)):0,M={cardOwner:I.actor,actor:I.actor,opponent:I.actor==="player"?"opponent":"player",currentTurn:r.turn,triggerType:"on_play"},N=[...r.processedEndEffectIds||[]],R=[...r.processedStartEffectIds||[]];let $=r;$.actionRequired=null;for(const G of B){if(G.trigger!=="on_play")continue;const q=L==null?void 0:L.card;if(!q)continue;if($=pt(q,P,$,M,G).newState,$.actionRequired)return{nextState:$,requiresTurnEnd:!1}}$.processedEndEffectIds=[...new Set([...$.processedEndEffectIds||[],...N])],$.processedStartEffectIds=[...new Set([...$.processedStartEffectIds||[],...R])];const X=I.sourceCardId;X&&t.phase==="end"&&($.processedEndEffectIds.includes(X)||$.processedEndEffectIds.push(X)),X&&t.phase==="start"&&($.processedStartEffectIds.includes(X)||$.processedStartEffectIds.push(X)),$.actionRequired=null,r=$;break}default:return{nextState:t,requiresTurnEnd:!0}}if(!s&&r.actionRequired===null){if(r.queuedActions&&r.queuedActions.length>0){const I=[...r.queuedActions],W=I.shift();if((W==null?void 0:W.type)==="execute_remaining_custom_effects")return{nextState:{...nt(r),actionRequired:null,queuedActions:[W,...I]},requiresTurnEnd:!1};if((W==null?void 0:W.type)==="shift_flipped_card_optional"||(W==null?void 0:W.type)==="gravity_2_shift_after_flip"){const z=Te(r,W.sourceCardId),V=Go(r,W.sourceCardId);if(!z||!z.card.isFaceUp||!V){const B=z?`${z.card.protocol}-${z.card.value}`:"the source card",L=ae(r,W.actor,`Shift from ${B} was cancelled because the source is no longer active.`);if(I.length>0){const P=I.shift();return(P==null?void 0:P.type)==="execute_remaining_custom_effects"?{nextState:{...L,queuedActions:[P,...I]},requiresTurnEnd:!1}:{nextState:{...L,actionRequired:P,queuedActions:I},requiresTurnEnd:!1}}else return{nextState:{...L,actionRequired:null,queuedActions:[]},requiresTurnEnd:!0}}}return(W==null?void 0:W.type)==="execute_remaining_custom_effects"?{nextState:{...r,queuedActions:[W,...I]},requiresTurnEnd:!1}:{nextState:{...r,actionRequired:W,queuedActions:I},requiresTurnEnd:!1}}}else!s&&r.actionRequired!==null&&(c=!1);return{nextState:r,requiresAnimation:s,requiresTurnEnd:c}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const jc=(t,n,r,c,s,d=s)=>{var P,M,N,R,$,X;const u={...t[s]},p=u.hand.find(G=>G.id===n);if(!p)return{newState:t};if(d===s){const G=t._ignoreProtocolMatching||!1,q=yr(t,s,r,c,p.protocol,p,G);if(!q.allowed)return console.error(`Illegal Move: ${s} tried to play ${p.protocol}-${p.value} - ${q.reason}`),{newState:t}}const f=s==="player"?"opponent":"player",_=t[d==="player"?"opponent":"player"].lanes[r],y=_.length>0?_[_.length-1]:null;if(y&&y.isFaceUp&&y.protocol==="Plague"&&y.value===0)return{newState:t};if(!c&&y&&y.isFaceUp&&y.protocol==="Metal"&&y.value===2)return console.error(`Illegal Move: ${s} tried to play face-down against Metal-2 in lane ${r}`),{newState:t};if(c){const G=t[d].protocols[r],q=u.protocols[r],Q=t[f].protocols[r],K=t[f].lanes.flat().some(ne=>ne.isFaceUp&&ne.protocol==="Psychic"&&ne.value===1),Z=[...t.player.lanes.flat(),...t.opponent.lanes.flat()].some(ne=>ne.isFaceUp&&ne.protocol==="Anarchy"&&ne.value===1),te=pu(t),ee=t[s].lanes.flat().some(ne=>ne.isFaceUp&&ne.protocol==="Spirit"&&ne.value===1),se=((M=(P=p.customEffects)==null?void 0:P.bottomEffects)==null?void 0:M.some(ne=>{var J,ie;return((J=ne.params)==null?void 0:J.action)==="card_property"&&((ie=ne.params)==null?void 0:ie.property)==="ignore_protocol_matching"}))||((R=(N=p.customEffects)==null?void 0:N.topEffects)==null?void 0:R.some(ne=>{var J,ie;return((J=ne.params)==null?void 0:J.action)==="card_property"&&((ie=ne.params)==null?void 0:ie.property)==="ignore_protocol_matching"}))||((X=($=p.customEffects)==null?void 0:$.middleEffects)==null?void 0:X.some(ne=>{var J,ie;return((J=ne.params)==null?void 0:J.action)==="card_property"&&((ie=ne.params)==null?void 0:ie.property)==="ignore_protocol_matching"})),_e=Ic(t,s,r),fe=cl(t,p),be=fl(t,s,r,p.protocol),oe=t._ignoreProtocolMatching||!1;let H;if(fe?H=!K:d!==s?H=p.protocol===G&&!K:Z||te?H=p.protocol!==q&&p.protocol!==Q&&!K:H=(p.protocol===q||p.protocol===Q||ee||se||_e||be||oe)&&!K,!H){const ne=Z||te?"Non-matching protocol required":"matching protocol required";return console.error(`Illegal Move: ${s} tried to play ${p.protocol}-${p.value} face-up in lane ${r} (${ne}, protocols: player=${q}, opponent=${Q})`),{newState:t}}}let m={...t,_committedCardId:n};t._currentEffectSource!==void 0||t._currentPhaseContext!==void 0||t._logIndentLevel!==void 0&&t._logIndentLevel>0?m._currentPhaseContext!=="after"&&(m=Ma(m)):(m=Ke(m,void 0),m=tt(m,void 0),m={...m,_logIndentLevel:0});const x=s==="player"?"Player":"Opponent",C=m[d].protocols[r];let b;if(s==="opponent"&&!c)b=`${x} plays a face-down card into Protocol ${C}.`;else{const G=`${p.protocol}-${p.value}`;b=`${x} plays ${G}`,c||(b+=" face-down"),d!==s?b+=` into ${d==="player"?"Player's":"Opponent's"} Protocol ${C}.`:b+=` into Protocol ${C}.`}m=ae(m,s,b),m=Ma(m);let j={newState:m};const k=m[d].lanes[r];if(k.length>0){const G=k[k.length-1];let Q=dt(m,"on_cover",{player:d,cardId:G.id}).newState;if(Q[d].lanes[r].some(te=>te.id===G.id)&&G.isFaceUp){const te={cardOwner:d,actor:s,currentTurn:Q.turn,opponent:d==="player"?"opponent":"player",triggerType:"cover"},ee={...Q,_coveringCardProtocol:p.protocol};j=qc(G,r,ee,te)}else j={newState:Q}}const E=j.newState,T={...p,isFaceUp:c,isRevealed:!1},F={...E[s]},U={...F.stats,cardsPlayed:F.stats.cardsPlayed+1},D=s==="player"?"playerFromHand":"aiFromHand",I=s==="player"?c?"playerFaceUp":"playerFaceDown":c?"aiFaceUp":"aiFaceDown",W=E.detailedGameStats?{...E.detailedGameStats,cardsPlayed:{...E.detailedGameStats.cardsPlayed,[D]:E.detailedGameStats.cardsPlayed[D]+1,[I]:E.detailedGameStats.cardsPlayed[I]+1}}:void 0;let z;if(d===s){const G={...F,hand:F.hand.filter(q=>q.id!==n),lanes:F.lanes.map((q,Q)=>Q===r?[...q,T]:q),stats:U};z={...E,[s]:G,stats:{...E.stats,[s]:U},detailedGameStats:W}}else{const G={...F,hand:F.hand.filter(K=>K.id!==n),stats:U},q={...E[d]},Q={...q,lanes:q.lanes.map((K,Z)=>Z===r?[...K,T]:K)};z={...E,[s]:G,[d]:Q,stats:{...E.stats,[s]:U},detailedGameStats:W}}const V=t.queuedActions||[],B=E.queuedActions||[];if(B===V||B.length===V.length&&B.every((G,q)=>G===V[q])?V.length>0&&(z.queuedActions=V):z.queuedActions=[...V,...B],z.lastPlayedCardId=T.id,z=Re(z),s==="opponent"&&!c&&(z=gw(z,T)),E.actionRequired||(z={...z,_logIndentLevel:0}),z=dt(z,"after_play",{player:s,cardId:T.id,laneIndex:r}).newState,E.actionRequired)return c&&(z.queuedEffect={card:T,laneIndex:r}),{newState:z,animationRequests:j.animationRequests};{if(z={...z,_committedCardId:void 0},s==="opponent")return c&&(z.queuedEffect={card:T,laneIndex:r}),{newState:z,animationRequests:j.animationRequests};let G={newState:z};if(c&&!z.actionRequired){const Q={cardOwner:d,actor:s,currentTurn:z.turn,opponent:d==="player"?"opponent":"player",triggerType:"play"};G=hl(T,r,z,Q)}const q=[...j.animationRequests||[],...G.animationRequests||[]];return{newState:G.newState,animationRequests:q.length>0?q:void 0}}},is=(t,n)=>{let r=Ke(t,void 0);return r=tt(r,void 0),r={...r,_logIndentLevel:0},Kw(r,n)},Gm=(t,n)=>{if(t.useControlMechanic&&t.controlCardHolder===n){let r=ae(t,n,`${n==="player"?"Player":"Opponent"} has Control and may rearrange protocols before refreshing.`);return r=Ma(r),{...r,controlCardHolder:null,actionRequired:{type:"prompt_use_control_mechanic",sourceCardId:"CONTROL_MECHANIC",actor:n,originalAction:{type:"fill_hand"}}}}return is(t,n)};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const kc=(t,n)=>{var s,d,u,p,f,h,_,y,m,g,x,C,b,j,k,E,T,F,U,D,I,W,z,V,B,L,P,M,N,R;if(!t.actionRequired)return{nextState:t};let r={...t},c=null;switch(t.actionRequired.type){case"select_lane_for_shift_all":{const{cardsToShift:$,validDestinationLanes:X,sourceLaneIndex:G,actor:q,sourceCardId:Q}=t.actionRequired;if(!X.includes(n))return console.error(`Illegal shift: Lane ${n} is not a valid destination`),{nextState:t};if(n===G)return console.error(`Illegal shift: Cannot shift to the same lane ${G}`),{nextState:t};let K={...t};const Z=[];for(const{cardId:te,owner:ee}of $){if(!Te(K,te))continue;const _e=K[ee].lanes.findIndex(oe=>oe.some(H=>H.id===te));if(_e===-1||!ss(K,_e,n).allowed)continue;const be=Bo(K,te,ee,n,q);K=be.newState,be.animationRequests&&Z.push(...be.animationRequests)}if(r=K,r=nt(r),(!r.actionRequired||r.actionRequired.type==="select_lane_for_shift_all")&&(r.actionRequired=null),Z.length>0){const te=(s=t.actionRequired)==null?void 0:s.followUpEffect,ee=(d=t.actionRequired)==null?void 0:d.conditionalType;c={animationRequests:Z,onCompleteCallback:(se,_e)=>{if(se.actionRequired||se.queuedActions&&se.queuedActions.length>0)return se;let fe=se;if(te&&Q&&(ee!=="if_executed"||Z.length>0)){const oe=Te(fe,Q);if(oe&&oe.card.isFaceUp){const H=fe[oe.owner].lanes.find(de=>de.some(pe=>pe.id===Q)),ne=fe[oe.owner].lanes.indexOf(H),J={cardOwner:oe.owner,actor:q,currentTurn:fe.turn,opponent:oe.owner==="player"?"opponent":"player"};if(fe=pt(oe.card,ne,fe,J,te).newState,fe.actionRequired)return fe}}return _e(fe)}}}break}case"select_lane_for_shift":{const{cardToShiftId:$,cardOwner:X,actor:G,sourceEffect:q,originalLaneIndex:Q,sourceCardId:K}=t.actionRequired;if(n===Q)return console.error(`Illegal shift: Cannot shift to the same lane ${Q}`),{nextState:t};const Z=t.actionRequired.validLanes;if(Z&&!Z.includes(n))return console.error(`Illegal shift: Lane ${n} not in valid lanes ${Z}`),{nextState:t};const te=Te(t,K),ee=Te(t,$);if(te&&te.card.protocol==="Anarchy"&&te.card.value===1&&ee&&ee.card.isFaceUp){const be=t.player.protocols[n],oe=t.opponent.protocols[n],H=ee.card.protocol;if(H===be||H===oe)return console.error(`Illegal Anarchy-1 shift: ${H}-${ee.card.value} cannot be shifted to lane ${n} (protocols: ${be}/${oe}) - matching protocol not allowed`),{nextState:t}}if(te&&te.card.protocol==="Gravity"&&te.card.value===1){let be=-1;for(let oe=0;oe<t[te.owner].lanes.length;oe++)if(t[te.owner].lanes[oe].some(H=>H.id===K)){be=oe;break}if(be!==-1&&!(Q===be)&&!(n===be))return console.error(`Illegal Gravity-1 shift: Must shift to or from Gravity lane ${be}, but tried ${Q}  ${n}`),{nextState:t}}if(t.actionRequired.destinationRestriction&&ee){const be=t.actionRequired.destinationRestriction;if(be.type==="non_matching_protocol"&&ee.card.isFaceUp){const oe=t.player.protocols[n],H=t.opponent.protocols[n],ne=ee.card.protocol;if(ne===oe||ne===H)return console.error(`Illegal shift: ${ne} cannot be shifted to lane ${n} (protocols: ${oe}/${H}) - matching protocol not allowed`),{nextState:t}}if(be.type==="to_or_from_this_lane"){const oe=be.laneIndex==="current"&&te?(()=>{for(let H=0;H<t[te.owner].lanes.length;H++)if(t[te.owner].lanes[H].some(ne=>ne.id===K))return H;return-1})():be.laneIndex;if(oe!==void 0&&oe!==-1&&!(Q===oe)&&!(n===oe))return console.error(`Illegal shift: Must shift to or from lane ${oe}, but tried ${Q}  ${n}`),{nextState:t}}}const se=ss(t,Q,n);if(!se.allowed)return console.error(`Illegal shift: Cannot shift from lane ${Q} to ${n} - ${se.reason}`),{nextState:t};const _e=Bo(t,$,X,n,G);r=_e.newState;const fe=r.actionRequired!==null;if(_e.animationRequests)c={animationRequests:_e.animationRequests,onCompleteCallback:(be,oe)=>{var pe,Se,Fe,je;let H=be;if(fe){if(q==="speed_3_end"){const Ne={type:"speed_3_self_flip_after_shift",sourceCardId:t.actionRequired.sourceCardId,actor:G};H.queuedActions=[...H.queuedActions||[],Ne]}const Ve=(pe=t.actionRequired)==null?void 0:pe.followUpEffect,He=(Se=t.actionRequired)==null?void 0:Se.conditionalType;if(Ve&&K&&(He!=="if_executed"||$)){const Ne=Te(H,K),Oe=t._currentPhaseContext||(t.phase==="start"?"start":"end"),Le={type:"execute_follow_up_effect",sourceCardId:K,followUpEffect:Ve,actor:G,logContext:{indentLevel:1,sourceCardName:Ne?`${Ne.card.protocol}-${Ne.card.value}`:void 0,phase:Oe}};H.queuedActions=[...H.queuedActions||[],Le]}Te(H,K);const Ge=H._pendingCustomEffects;if(Ge){const qe=Te(H,Ge.sourceCardId);if(qe&&qe.card.isFaceUp){const Ne=H[qe.owner].lanes.find(Le=>Le.some(ut=>ut.id===Ge.sourceCardId));if(Ne&&Ne.length>0&&Ne[Ne.length-1].id===Ge.sourceCardId){const Le={type:"execute_remaining_custom_effects",sourceCardId:Ge.sourceCardId,laneIndex:Ge.laneIndex,effects:Ge.effects,context:Ge.context,actor:G,logSource:Ge.logSource,logPhase:Ge.logPhase,logIndentLevel:Ge.logIndentLevel};H.queuedActions=[Le,...H.queuedActions||[]]}}delete H._pendingCustomEffects}return H}if(q==="speed_3_end"){const Ve=t.actionRequired.sourceCardId;H=ae(H,G,"Speed-3: Flipping itself after shifting a card."),H=_r(new Set([Ve]),H),H.animationState={type:"flipCard",cardId:Ve}}const ne=H._pendingCustomEffects;if(ne){const Ve=Te(H,ne.sourceCardId);if(Ve&&Ve.card.isFaceUp){const He=H[Ve.owner].lanes.find(qe=>qe.some(Ne=>Ne.id===ne.sourceCardId));if(He&&He.length>0&&He[He.length-1].id===ne.sourceCardId){for(const qe of ne.effects)H=pt(Ve.card,ne.laneIndex,H,ne.context,qe).newState;delete H._pendingCustomEffects}else H=ae(H,G,"Pending effects cancelled because source card is now covered."),delete H._pendingCustomEffects}else delete H._pendingCustomEffects}K&&(H=Yo(H)),H=dt(H,"after_shift",{player:G,cardId:$}).newState;const ie=(Fe=t.actionRequired)==null?void 0:Fe.followUpEffect,de=(je=t.actionRequired)==null?void 0:je.conditionalType;if(ie&&K&&(de!=="if_executed"||$)){const He=Te(H,K);if(He&&He.card.isFaceUp){const Ge=H[He.owner].lanes.find(Qe=>Qe.some(Je=>Je.id===K)),qe=H[He.owner].lanes.indexOf(Ge),Ne={cardOwner:He.owner,actor:G,currentTurn:H.turn,opponent:He.owner==="player"?"opponent":"player"},Oe=`${He.card.protocol}-${He.card.value}`,Le=t._currentPhaseContext||(t.phase==="start"?"start":"end");H={...H,_logIndentLevel:1,_currentEffectSource:Oe,_currentPhaseContext:Le},H=pt(He.card,qe,H,Ne,ie).newState}}if(H=nt(H),H.actionRequired=null,H.queuedActions&&H.queuedActions.length>0){const Ve=H.queuedActions[0];Ve.type==="execute_remaining_custom_effects"?(H=Va(H),H.animationState&&(H={...H,animationState:null})):(H.queuedActions=H.queuedActions.slice(1),H.actionRequired=Ve)}return H._interruptedTurn?dl(H):oe(H)}};else if(fe){if(q==="speed_3_end"){const ne={type:"speed_3_self_flip_after_shift",sourceCardId:t.actionRequired.sourceCardId,actor:G};r.queuedActions=[...r.queuedActions||[],ne]}const be=(u=t.actionRequired)==null?void 0:u.followUpEffect,oe=(p=t.actionRequired)==null?void 0:p.conditionalType;if(be&&K&&(oe!=="if_executed"||$)){const ne=Te(r,K),J=t._currentPhaseContext||(t.phase==="start"?"start":"end"),ie={type:"execute_follow_up_effect",sourceCardId:K,followUpEffect:be,actor:G,logContext:{indentLevel:1,sourceCardName:ne?`${ne.card.protocol}-${ne.card.value}`:void 0,phase:J}};r.queuedActions=[...r.queuedActions||[],ie]}}else{if(q==="speed_3_end"){const J=t.actionRequired.sourceCardId;r=ae(r,G,"Speed-3: Flipping itself after shifting a card."),r=_r(new Set([J]),r),r.animationState={type:"flipCard",cardId:J}}const be=r._pendingCustomEffects;if(be){const J=Te(r,be.sourceCardId);if(J&&J.card.isFaceUp){const ie=r[J.owner].lanes.find(pe=>pe.some(Se=>Se.id===be.sourceCardId));if(ie&&ie.length>0&&ie[ie.length-1].id===be.sourceCardId){for(const pe of be.effects)r=pt(J.card,be.laneIndex,r,be.context,pe).newState;delete r._pendingCustomEffects}else r=ae(r,G,"Pending effects cancelled because source card is now covered."),delete r._pendingCustomEffects}else delete r._pendingCustomEffects}K&&(r=Yo(r)),r=dt(r,"after_shift",{player:G,cardId:$}).newState;const H=(f=t.actionRequired)==null?void 0:f.followUpEffect,ne=(h=t.actionRequired)==null?void 0:h.conditionalType;if(H&&K&&(ne!=="if_executed"||$)){const ie=Te(r,K);if(ie&&ie.card.isFaceUp){const de=r[ie.owner].lanes.find(He=>He.some(Ge=>Ge.id===K)),pe=r[ie.owner].lanes.indexOf(de),Se={cardOwner:ie.owner,actor:G,currentTurn:r.turn,opponent:ie.owner==="player"?"opponent":"player"},Fe=`${ie.card.protocol}-${ie.card.value}`,je=t._currentPhaseContext||(t.phase==="start"?"start":"end");r={...r,_logIndentLevel:1,_currentEffectSource:Fe,_currentPhaseContext:je},r=pt(ie.card,pe,r,Se,H).newState}}if(r=nt(r),r.actionRequired=null,r.queuedActions&&r.queuedActions.length>0){const J=r.queuedActions[0];if(J.type==="execute_remaining_custom_effects"){if(r=Va(r),r.animationState&&!r.actionRequired){const ie=r.animationState;ie.type==="draw"&&(c={animationRequests:[{type:"draw",player:ie.player,count:ie.count}],onCompleteCallback:(de,pe)=>{const Se={...de,animationState:null};return pe(Se)}},r={...r,animationState:null})}}else r.queuedActions=r.queuedActions.slice(1),r.actionRequired=J}}break}case"shift_flipped_card_optional":{const $=t.actionRequired.cardId,X=t.actionRequired.actor;let G=null;for(const te of["player","opponent"])if(t[te].lanes.flat().some(ee=>ee.id===$)){G=te;break}if(!G){console.error("[shift_flipped_card_optional] Card not found on board:",$),r=t;break}const q=(_=t.actionRequired)==null?void 0:_.followUpEffect,Q=(y=t.actionRequired)==null?void 0:y.conditionalType,K=(m=t.actionRequired)==null?void 0:m.sourceCardId,Z=Bo(t,$,G,n,X);if(r=Z.newState,q&&K&&(Q!=="if_executed"||$)){const ee=Te(r,K),se=t._currentPhaseContext||(t.phase==="start"?"start":"end"),_e={type:"execute_follow_up_effect",sourceCardId:K,followUpEffect:q,actor:X,logContext:{indentLevel:1,sourceCardName:ee?`${ee.card.protocol}-${ee.card.value}`:void 0,phase:se}};r={...r,queuedActions:[...r.queuedActions||[],_e]}}Z.animationRequests&&(c={animationRequests:Z.animationRequests,onCompleteCallback:(te,ee)=>ee(te)});break}case"select_lane_for_play":{const{cardInHandId:$,isFaceDown:X,actor:G,source:q,disallowedLaneIndex:Q,validLanes:K,preSelectedLane:Z,ignoreProtocolMatching:te}=t.actionRequired,ee=Z!==void 0?Z:n;if(Q!==void 0&&ee===Q)return{nextState:t,requiresTurnEnd:!1};if(K&&!K.includes(ee))return{nextState:t,requiresTurnEnd:!1};if(q==="deck"){const H=(g=t.actionRequired)==null?void 0:g.followUpEffect;(x=t.actionRequired)==null||x.conditionalType;const ne=(C=t.actionRequired)==null?void 0:C.sourceCardId,J=(b=t.actionRequired)==null?void 0:b.preDrawnCard,ie={...t,actionRequired:null},de=ie[G];let pe,Se=de.deck,Fe=de.discard;if(J)pe={...J,isFaceUp:!X};else{const qe=Jn(de.deck,de.discard,1);if(Se=qe.remainingDeck,Fe=qe.newDiscard,qe.drawnCards.length===0){console.error("No cards in deck/discard to play"),r=ie;break}pe={...qe.drawnCards[0],id:ct(),isFaceUp:!X}}const je=[...de.lanes];je[ee]=[...je[ee],pe];const Ve={...de,lanes:je,deck:Se,discard:Fe};r={...ie,[G]:Ve,lastCustomEffectTargetCardId:pe.id};const He=G==="player"?"Player":"Opponent",Ge=X?"face-down":"face-up";r=ae(r,G,`${He} plays ${pe.protocol}-${pe.value} ${Ge} from deck.`),c={animationRequests:[{type:"play",cardId:pe.id,owner:G,laneIndex:ee,isFaceUp:pe.isFaceUp}],onCompleteCallback:(qe,Ne)=>{let Oe=qe;if(H&&ne){const Le=Te(Oe,ne);if(Le&&Le.card.isFaceUp){const ut=Oe[Le.owner].lanes.find(tn=>tn.some(Gt=>Gt.id===ne)),Qe=Oe[Le.owner].lanes.indexOf(ut),Je={cardOwner:Le.owner,actor:G,currentTurn:Oe.turn,opponent:Le.owner==="player"?"opponent":"player"};if(Oe=pt(Le.card,Qe,Oe,Je,H).newState,Oe.actionRequired)return Oe}}return Ne(Oe)}};break}if(q==="trash"){const H=(j=t.actionRequired)==null?void 0:j.preDrawnCard,ne=(k=t.actionRequired)==null?void 0:k.sourceCardId,J=(E=t.actionRequired)==null?void 0:E.followUpEffect,ie=(T=t.actionRequired)==null?void 0:T.conditionalType,de=(F=t.actionRequired)==null?void 0:F.useNormalPlayRules;if(!H){console.error("No preDrawnCard for trash play"),r={...t,actionRequired:null};break}const pe={...t,actionRequired:null};pe[G];let Se;if(typeof X=="boolean")Se=!X;else if(de){const Le=G==="player"?"opponent":"player",ut=t[G].protocols[ee],Qe=t[Le].protocols[ee],Je=H.protocol===ut||H.protocol===Qe,Ft=Ic(t,G,ee);Se=Je||Ft}else Se=!0;const Fe={...H,isFaceUp:Se};let je=pe;const Ve=je[G].lanes[ee];if(Ve.length>0){const Le=Ve[Ve.length-1];if(je=dt(je,"on_cover",{player:G,cardId:Le.id}).newState,je[G].lanes[ee].some(Ft=>Ft.id===Le.id)&&Le.isFaceUp){const Ft={cardOwner:G,actor:G,currentTurn:je.turn,opponent:G==="player"?"opponent":"player",triggerType:"cover"},tn={...je,_coveringCardProtocol:Fe.protocol};je=qc(Le,ee,tn,Ft).newState}}const He=je[G],Ge=[...He.lanes];Ge[ee]=[...Ge[ee],Fe];const qe={...He,lanes:Ge};r={...je,[G]:qe,lastCustomEffectTargetCardId:Fe.id};const Ne=G==="player"?"Player":"Opponent",Oe=Se?"face-up":"face-down";r=ae(r,G,`${Ne} plays ${Fe.protocol}-${Fe.value} ${Oe} from trash.`),r=Re(r),c={animationRequests:[{type:"play",cardId:Fe.id,owner:G,laneIndex:ee,isFaceUp:Fe.isFaceUp}],onCompleteCallback:(Le,ut)=>{let Qe=Le;if(Fe.isFaceUp){const Je=Te(Qe,Fe.id);if(Je){const Ft={cardOwner:G,actor:G,currentTurn:Qe.turn,opponent:G==="player"?"opponent":"player",triggerType:"play"};if(Qe=hl(Je.card,ee,Qe,Ft).newState,Qe.actionRequired)return J&&ne&&(Qe={...Qe,queuedActions:[...Qe.queuedActions||[],{type:"execute_followup_effect",sourceCardId:ne,followUpEffect:J,conditionalType:ie,actor:G}]}),Qe}}if(J&&ne){const Je=Te(Qe,ne);if(Je&&Je.card.isFaceUp){const Ft=Qe[Je.owner].lanes.find(nn=>nn.some(Pt=>Pt.id===ne)),tn=Qe[Je.owner].lanes.indexOf(Ft),Gt={cardOwner:Je.owner,actor:G,currentTurn:Qe.turn,opponent:Je.owner==="player"?"opponent":"player"};if(Qe=pt(Je.card,tn,Qe,Gt,J).newState,Qe.actionRequired)return Qe}}return ut(Qe)}};break}const se=t[G].hand.find(H=>H.id===$);if(!se){console.error("Card for play not found in hand"),r={...t,actionRequired:null};break}const _e={...t,actionRequired:null,_ignoreProtocolMatching:te||!1};let fe;if(typeof X=="boolean")fe=!X;else{const H=t[G].lanes.flat().some(pe=>pe.isFaceUp&&pe.protocol==="Spirit"&&pe.value===1),ne=((D=(U=se.customEffects)==null?void 0:U.bottomEffects)==null?void 0:D.some(pe=>{var Se,Fe;return((Se=pe.params)==null?void 0:Se.action)==="card_property"&&((Fe=pe.params)==null?void 0:Fe.property)==="ignore_protocol_matching"}))||((W=(I=se.customEffects)==null?void 0:I.topEffects)==null?void 0:W.some(pe=>{var Se,Fe;return((Se=pe.params)==null?void 0:Se.action)==="card_property"&&((Fe=pe.params)==null?void 0:Fe.property)==="ignore_protocol_matching"}))||((V=(z=se.customEffects)==null?void 0:z.middleEffects)==null?void 0:V.some(pe=>{var Se,Fe;return((Se=pe.params)==null?void 0:Se.action)==="card_property"&&((Fe=pe.params)==null?void 0:Fe.property)==="ignore_protocol_matching"})),J=G==="player"?"opponent":"player",ie=t[J].lanes.flat().some(pe=>pe.isFaceUp&&pe.protocol==="Psychic"&&pe.value===1),de=fl(t,G,ee,se.protocol);fe=(H||ne||te||de||se.protocol===t[G].protocols[ee]||se.protocol===t[J].protocols[ee])&&!ie}const{newState:be,animationRequests:oe}=jc(_e,$,ee,fe,G);r=be,oe&&(c={animationRequests:oe,onCompleteCallback:(H,ne)=>(H.queuedActions&&H.queuedActions.length>0,ne(H))});break}case"select_lane_for_delete":{const $=t.actionRequired.actor,X=$==="player"?"Player":"Opponent",G=t.player.protocols[n],q=t.actionRequired.targetFilter||{},Q=Te(t,t.actionRequired.sourceCardId),K=Q?`${Q.card.protocol}-${Q.card.value}`:"a card effect",Z=t.actionRequired.count||1,te=t.actionRequired.deleteAll===!0,ee=t.actionRequired.validLanes;if(ee&&!ee.includes(n))return console.error(`Illegal delete lane selection: Lane ${n} not in valid lanes ${ee}`),{nextState:t};r=ae(r,$,`${K}: ${X} targets Protocol ${G}.`);const se=new Map;for(const oe of["player","opponent"]){const H=t[oe].lanes[n];se.set(oe,H.length>0?H[H.length-1].id:null)}const _e=[],fe=[],be=new Set;for(const oe of["player","opponent"]){const H=t[oe],ne=H.lanes[n].some(ie=>ie.isFaceUp&&ie.protocol==="Darkness"&&ie.value===2)?4:2,J=H.lanes[n];for(let ie=0;ie<J.length;ie++){const de=J[ie],pe=ie===J.length-1,Se=de.isFaceUp?de.value:ne;if(q.valueRange){const{min:Ve,max:He}=q.valueRange;if(Se<Ve||Se>He)continue}if(q.faceState==="face_up"&&!de.isFaceUp||q.faceState==="face_down"&&de.isFaceUp||q.owner==="own"&&oe!==$||q.owner==="opponent"&&oe===$||q.position==="uncovered"&&!pe||q.position==="covered"&&pe)continue;_e.push({type:"delete",cardId:de.id,owner:oe}),be.add(de.id);const Fe=oe==="player"?"Player's":"Opponent's",je=de.isFaceUp?`${de.protocol}-${de.value}`:"a face-down card";if(fe.push(`${Fe} ${je}`),!te&&_e.length>=Z)break}if(!te&&_e.length>=Z)break}if(fe.length>0){r=ae(r,$,`${K}: Deleting ${fe.join(", ")}.`);const oe={...r.stats[$],cardsDeleted:r.stats[$].cardsDeleted+fe.length},H={...r[$],stats:oe};r={...r,[$]:H,stats:{...r.stats,[$]:oe}}}if(r=nt(r),r.actionRequired=null,_e.length>0){const oe=(B=t.actionRequired)==null?void 0:B.followUpEffect,H=(L=t.actionRequired)==null?void 0:L.conditionalType,ne=t.actionRequired.sourceCardId;c={animationRequests:_e,onCompleteCallback:(J,ie)=>{let de=J;de=dt(de,"after_delete",{player:$}).newState;const Se=[];for(const Fe of["player","opponent"]){const je=se.get(Fe),Ve=de[Fe].lanes[n];je&&be.has(je)&&Ve.length>0&&Se.push(Fe)}for(let Fe=0;Fe<Se.length;Fe++){const je=Se[Fe];if(de=ea(de,je,n).newState,de.actionRequired&&Fe<Se.length-1){const He=Se.slice(Fe+1);for(const Ge of He)de.queuedActions=[...de.queuedActions||[],{type:"pending_uncover_effect",owner:Ge,laneIndex:n}];return de}}if(oe&&ne&&(H!=="if_executed"||_e.length>0)){const je=Te(de,ne);if(je&&je.card.isFaceUp){const Ve=de[je.owner].lanes.find(Ne=>Ne.some(Oe=>Oe.id===ne)),He=de[je.owner].lanes.indexOf(Ve),Ge={cardOwner:je.owner,actor:$,currentTurn:de.turn,opponent:je.owner==="player"?"opponent":"player"};if(de=pt(je.card,He,de,Ge,oe).newState,de.actionRequired)return de}}return ie(de)}}}break}case"select_lane_for_return":{const $=t.actionRequired.actor,X=$==="player"?"Player":"Opponent",G=t.player.protocols[n],q=t.actionRequired.targetFilter||{},Q=Te(t,t.actionRequired.sourceCardId),K=Q?`${Q.card.protocol}-${Q.card.value}`:"a card effect";r=ae(r,$,`${K}: ${X} targets Protocol ${G}.`);const Z=[],te=[];for(const ee of["player","opponent"]){const se=t[ee],_e=se.lanes[n].some(fe=>fe.isFaceUp&&fe.protocol==="Darkness"&&fe.value===2)?4:2;for(const fe of se.lanes[n]){const be=fe.isFaceUp?fe.value:_e;if(q.valueEquals!==void 0&&be!==q.valueEquals||q.faceState==="face_up"&&!fe.isFaceUp||q.faceState==="face_down"&&fe.isFaceUp||q.owner==="own"&&ee!==$||q.owner==="opponent"&&ee===$)continue;Z.push({type:"return",cardId:fe.id,owner:ee});const oe=ee==="player"?"Player's":"Opponent's",H=fe.isFaceUp?`${fe.protocol}-${fe.value}`:"a face-down card";te.push(`${oe} ${H}`)}}if(Z.length===0){r=ae(r,$,`${K}: No matching cards in Protocol ${G}.`),r=nt(r),r.actionRequired=null;break}if(te.length>0&&(r=ae(r,$,`${K}: Returning ${te.join(", ")}.`)),r=nt(r),r.actionRequired=null,Z.length>0){const ee=(P=t.actionRequired)==null?void 0:P.followUpEffect,se=(M=t.actionRequired)==null?void 0:M.conditionalType,_e=t.actionRequired.sourceCardId;c={animationRequests:Z,onCompleteCallback:(fe,be)=>{let oe=fe;if(ee&&_e&&(se!=="if_executed"||Z.length>0)){const ne=Te(oe,_e);if(ne&&ne.card.isFaceUp){const J=oe[ne.owner].lanes.find(Se=>Se.some(Fe=>Fe.id===_e)),ie=oe[ne.owner].lanes.indexOf(J),de={cardOwner:ne.owner,actor:$,currentTurn:oe.turn,opponent:ne.owner==="player"?"opponent":"player"};if(oe=pt(ne.card,ie,oe,de,ee).newState,oe.actionRequired)return oe}}return be(oe)}}}break}case"select_lane_for_delete_all":{const $=t.actionRequired.actor,X=$==="player"?"Player":"Opponent",G=t.player.protocols[n],q=t.actionRequired.minCards||8;if(!(t.actionRequired.validLanes||[0,1,2]).includes(n)){r=ae(r,$,"Cannot select this lane for deletion.");break}const K=t.player.lanes[n].length+t.opponent.lanes[n].length;if(K<q){r=ae(r,$,`Cannot delete ${G} line (only ${K} cards, need ${q}+).`),r=nt(r),r.actionRequired=null;break}const Z=Te(t,t.actionRequired.sourceCardId),te=Z?`${Z.card.protocol}-${Z.card.value}`:"Effect";r=ae(r,$,`${te}: ${X} deletes all cards in ${G} line.`);const ee=[];for(const fe of["player","opponent"])for(const be of t[fe].lanes[n])ee.push({type:"delete",cardId:be.id,owner:fe});const se={...r.stats[$],cardsDeleted:r.stats[$].cardsDeleted+ee.length},_e={...r[$],stats:se};if(r={...r,[$]:_e,stats:{...r.stats,[$]:se}},r=nt(r),r.actionRequired=null,ee.length>0){const fe=(N=t.actionRequired)==null?void 0:N.followUpEffect,be=(R=t.actionRequired)==null?void 0:R.conditionalType,oe=t.actionRequired.sourceCardId;c={animationRequests:ee,onCompleteCallback:(H,ne)=>{let J=H;if(J=dt(J,"after_delete",{player:$}).newState,fe&&oe&&(be!=="if_executed"||ee.length>0)){const pe=Te(J,oe);if(pe&&pe.card.isFaceUp){const Se=J[pe.owner].lanes.find(He=>He.some(Ge=>Ge.id===oe)),Fe=J[pe.owner].lanes.indexOf(Se),je={cardOwner:pe.owner,actor:$,currentTurn:J.turn,opponent:pe.owner==="player"?"opponent":"player"};if(J=pt(pe.card,Fe,J,je,fe).newState,J.actionRequired)return J}}return ne(J)}}}break}case"select_lane_to_shift_revealed_board_card_custom":{const{revealedCardId:$,actor:X}=t.actionRequired,G=Te(t,$);if(G){const q=Bo(t,$,G.owner,n,X);r=q.newState,q.animationRequests&&(c={animationRequests:q.animationRequests,onCompleteCallback:(Q,K)=>Q.actionRequired?Q:K(Q)})}break}case"select_lanes_for_swap_stacks":{const{actor:$,sourceCardId:X,validLanes:G,selectedFirstLane:q}=t.actionRequired;if(!G.includes(n))return console.error(`Illegal swap_stacks: Lane ${n} is not a valid selection`),{nextState:t};if(q===void 0)r.actionRequired={type:"select_lanes_for_swap_stacks",actor:$,sourceCardId:X,validLanes:G.filter(Q=>Q!==n),selectedFirstLane:n},r=ae(r,$,`Selected lane ${n+1} for swap.`);else{const Q=q,K=n,Z=[...r[$].lanes[Q]],te=[...r[$].lanes[K]];r[$].lanes[Q]=te,r[$].lanes[K]=Z,r=ae(r,$,`Swapped all cards between lane ${Q+1} and lane ${K+1}.`),r.actionRequired=null}break}default:return{nextState:t}}return{nextState:Re(r),requiresAnimation:c}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const _m=(t,n)=>{if(t.processedSpeed1TriggerThisTurn)return t;if(t[n].lanes.flat().some(s=>s.isFaceUp&&s.protocol==="Speed"&&s.value===1)){let s={...t};return s=Ke(s,"Speed-1"),s=tt(s,void 0),s=ae(s,n,"Triggers after clearing cache: Draw 1 card."),s=xr(s,n,1),s.processedSpeed1TriggerThisTurn=!0,s=Ke(s,void 0),s.phase="end",s}return t},wm=(t,n,r,c,s,d,u)=>{const p=Te(t,s);if(!p)return t;const f=t[d].hand.length,h=Math.max(0,(c||0)-f);if(!(r==="then"||r==="if_executed"&&h>0))return t;const y=`${p.card.protocol}-${p.card.value}`;let m=Ke(t,y);m=tt(m,"middle"),u!==void 0&&(m={...m,_logIndentLevel:u});let g=-1;for(let b=0;b<m[p.owner].lanes.length;b++)if(m[p.owner].lanes[b].some(j=>j.id===s)){g=b;break}if(g===-1)return m;const x={cardOwner:p.owner,opponent:p.owner==="player"?"opponent":"player",currentTurn:m.turn,actor:d,discardedCount:h};return pt(p.card,g,m,x,n).newState},gr=(t,n,r)=>{var W,z,V,B;const c=t[r],s=new Set(n),d=c.hand.filter(L=>s.has(L.id));if(d.length===0)return t;const u=c.hand.filter(L=>!s.has(L.id)),p=((W=t.animationState)==null?void 0:W.type)==="discardCard"&&((z=t.animationState.originalAction)==null?void 0:z.type)==="discard"?t.animationState.originalAction:((V=t.actionRequired)==null?void 0:V.type)==="discard"?t.actionRequired:null,f=(p==null?void 0:p.discardTo)||"own_trash",h=r==="player"?"opponent":"player",_=f==="opponent_trash"?h:r,y=d.map(({id:L,isFaceUp:P,...M})=>M),m={...c.stats,cardsDiscarded:c.stats.cardsDiscarded+d.length},g={...c,hand:u,stats:m};_===r&&(g.discard=[...c.discard,...y]),p==null||p.followUpEffect,p==null||p.conditionalType,p==null||p.previousHandSize;let x;if(_===h){const L=t[h],P={...L,discard:[...L.discard,...y]};x={...t,[r]:g,[h]:P,stats:{...t.stats,[r]:m},actionRequired:null}}else x={...t,[r]:g,stats:{...t.stats,[r]:m},actionRequired:null};if(p!=null&&p.sourceCardId){const L=x.player.lanes.flat().find(P=>P.id===p.sourceCardId)||x.opponent.lanes.flat().find(P=>P.id===p.sourceCardId);if(L){const P=`${L.protocol}-${L.value}`;x=Ke(x,P),x=tt(x,"middle")}else x=Ke(x,void 0),x=tt(x,void 0),x={...x,_logIndentLevel:0}}else x=Ke(x,void 0),x=tt(x,void 0);const C=r==="player"?"Player":"Opponent",b=_!==r?" into their trash":"";let j;if(r==="player"||d.every(L=>L.isRevealed)){const L=d.map(P=>`${P.protocol}-${P.value}`).join(", ");j=`${C} discards ${L}${b}.`}else{const L=d.length===1?"card":"cards";j=`${C} discards ${d.length} ${L}${b}.`}x=ae(x,r,j);const k=(L,P)=>{var Q;const M=t.phase==="hand_limit"&&!(P!=null&&P.sourceCardId);let N=L;M&&(N=Yo(N),N=_m(N,r),N=dt(N,"after_clear_cache",{player:r}).newState,((Q=N.processedClearCacheTriggerIds)==null?void 0:Q.length)>0&&(N.phase="end")),N=xw(N,r,P==null?void 0:P.sourceEffect,P==null?void 0:P.sourceCardId);const R=N.actionRequired,$=(P==null?void 0:P._savedIndentLevel)||N._logIndentLevel||1;if(R&&(N.actionRequired=null),N=dt(N,"after_discard",{player:r}).newState,N=dt(N,"after_opponent_discard",{player:r==="player"?"opponent":"player"}).newState,R){const K=R.actor,Z=K?N[K].hand.length:0,te=R.count||1,ee=Math.min(te,Z);ee<=0||(N.actionRequired?N.queuedActions=[{...R,type:R.type,count:ee,_savedIndentLevel:$},...N.queuedActions||[]]:N.actionRequired={...R,count:ee})}return N};if(p&&p.actor===r){const L=p.count-n.length;if(L>0)return x.actionRequired={...p,count:L},x;if(p.followUpEffect){const P=x._logIndentLevel||2;let N=dt(x,"after_discard",{player:r}).newState;return N=dt(N,"after_opponent_discard",{player:r==="player"?"opponent":"player"}).newState,N.actionRequired?(N._pendingFollowUpEffect={followUpEffect:p.followUpEffect,conditionalType:p.conditionalType,previousHandSize:p.previousHandSize,sourceCardId:p.sourceCardId,actor:r,savedIndentLevel:P},N):wm(N,p.followUpEffect,p.conditionalType,p.previousHandSize,p.sourceCardId,r,P)}return k(x,p)}const E=t.actionRequired;if(E&&E.type==="discard"&&E.actor===r){const L=E.count-n.length;if(L>0)return x.actionRequired={...E,count:L},x;if(E.followUpEffect){const P=x._logIndentLevel||2;let N=dt(x,"after_discard",{player:r}).newState;return N=dt(N,"after_opponent_discard",{player:r==="player"?"opponent":"player"}).newState,N.actionRequired?(N._pendingFollowUpEffect={followUpEffect:E.followUpEffect,conditionalType:E.conditionalType,previousHandSize:E.previousHandSize,sourceCardId:E.sourceCardId,actor:r,savedIndentLevel:P},N):wm(N,E.followUpEffect,E.conditionalType,E.previousHandSize,E.sourceCardId,r,P)}return k(x,E)}const T=t.phase==="hand_limit";x=dt(x,"after_discard",{player:r}).newState;let I=dt(x,"after_opponent_discard",{player:r==="player"?"opponent":"player"}).newState;return T&&(I=_m(I,r),I=dt(I,"after_clear_cache",{player:r}).newState,((B=I.processedClearCacheTriggerIds)==null?void 0:B.length)>0&&(I.phase="end")),I},ox=(t,n)=>{var u;if(((u=t.actionRequired)==null?void 0:u.type)!=="plague_2_player_discard")return t;const r=t.actionRequired.actor,c=r==="player"?"opponent":"player";let s=gr(t,n,r);const d=n.length+1;return s[c].hand.length>0?s.actionRequired={type:"discard",actor:c,count:Math.min(d,s[c].hand.length),sourceCardId:t.actionRequired.sourceCardId}:(s=nt(s),s.actionRequired=null),s},Bd=(t,n)=>{var u;if(((u=t.actionRequired)==null?void 0:u.type)!=="plague_2_opponent_discard")return t;const r=t.actionRequired.actor,c=r==="player"?"opponent":"player";let s=gr(t,n,r);const d=n.length+1;return s[c].hand.length>0?s.actionRequired={type:"discard",actor:c,count:Math.min(d,s[c].hand.length),sourceCardId:t.actionRequired.sourceCardId}:(s=nt(s),s.actionRequired=null),s},Gd=(t,n)=>{var h,_,y,m;const r=((h=t.actionRequired)==null?void 0:h.type)==="discard"&&((_=t.actionRequired)==null?void 0:_.variableCount),c=((y=t.actionRequired)==null?void 0:y.type)==="discard"&&t.actionRequired.count>1,s=((m=t.actionRequired)==null?void 0:m.type)==="select_cards_from_hand_to_discard_for_fire_4";if(!r&&!c&&!s)return t;const d=t.actionRequired.actor,u=t.actionRequired.sourceCardId;let p=gr(t,n,d);if((r||c)&&u||c&&!u)return p;const f=n.length+1;return p=ae(p,d,`Fire-4: Drawing ${f} card(s).`),p=xr(p,d,f),p},Yd=(t,n)=>{var f;if(((f=t.actionRequired)==null?void 0:f.type)!=="select_cards_from_hand_to_discard_for_hate_1")return t;const{sourceCardId:r,actor:c}=t.actionRequired;let s=gr(t,n,c);const u=Sw(s,[]),p=Math.min(2,u);return p>0?s.actionRequired={type:"select_cards_to_delete",count:p,sourceCardId:r,disallowedIds:[],actor:c}:(s=ae(s,c,"Hate-1: No valid targets to delete."),s=nt(s),s.actionRequired=null),s};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const ls=(t,n,r)=>{const c=t.turn,s=c==="player"?"opponent":"player";let d={...t};if(d.compileBlockedPlayer===c&&d.compileBlockedUntilTurn>(d.turnNumber||0))return d=ae(d,c,`${c==="player"?"Player":"Opponent"} can't compile - blocked by opponent's effect.`),d;if(d.useControlMechanic&&d.controlCardHolder===c){const P=c==="player"?"Player":"Opponent";return d=Ke(d,void 0),d=tt(d,void 0),d={...d,_logIndentLevel:0},d=ae(d,c,`${P} has Control and may rearrange protocols before compiling.`),d=Ma(d),d.actionRequired={type:"prompt_use_control_mechanic",sourceCardId:"CONTROL_MECHANIC",actor:c,originalAction:{type:"compile",laneIndex:n}},d.controlCardHolder=null,d}let f={...d[c]},h={...d[s]};const _=f.compiled[n],y=[];for(const P of[c,s])d[P].lanes[n].forEach(N=>{if(N.isFaceUp){const R=N;R.customEffects&&R.customEffects.topEffects&&R.customEffects.topEffects.some(X=>X.trigger==="before_compile_delete")&&y.push({card:N,owner:P})}});for(const{card:P,owner:M}of y)d=dt(d,"before_compile_delete",{player:M,cardId:P.id}).newState;f={...d[c]},h={...d[s]};const m=P=>{if(P.protocol==="Speed"&&P.value===2&&P.isFaceUp)return!0;const M=P;return M.customEffects&&M.customEffects.topEffects&&P.isFaceUp?M.customEffects.topEffects.some(N=>{var R,$;return N.trigger==="before_compile_delete"&&((R=N.params)==null?void 0:R.action)==="shift"&&(($=N.params)==null?void 0:$.shiftSelf)===!0}):!1},g=[],x=[],C=f.lanes[n].filter(P=>m(P)?(g.push(P),!1):!0),b=h.lanes[n].filter(P=>m(P)?(x.push(P),!1):!0),j={...f.stats},k={...h.stats};f.discard=[...f.discard,...C.map(({id:P,isFaceUp:M,...N})=>N)],h.discard=[...h.discard,...b.map(({id:P,isFaceUp:M,...N})=>N)];const E=[...f.lanes];E[n]=g,f.lanes=E;const T=[...h.lanes];T[n]=x,h.lanes=T;const F=[...f.compiled];if(F[n]=!0,f.compiled=F,d={...d,[c]:f,[s]:h,stats:{...d.stats,[c]:j,[s]:k}},d.detailedGameStats){const P=_,M=c==="player"?P?"playerRecompile":"playerFirstCompile":P?"aiRecompile":"aiFirstCompile";d={...d,detailedGameStats:{...d.detailedGameStats,compiles:{...d.detailedGameStats.compiles,[M]:d.detailedGameStats.compiles[M]+1}}}}d=Ke(d,void 0),d=tt(d,void 0),d={...d,_logIndentLevel:0};const U=c==="player"?"Player":"Opponent",D=f.protocols[n];if(d=ae(d,c,`${U} compiles Protocol ${D}!`),_&&(d=ae(d,c,`${U} draws 1 card from the opponent's deck as a re-compile reward.`),d=Zw(d,c,1)),d=Re(d),f.compiled.every(P=>P===!0))return d.winner=c,r(c,d),d;C.length+b.length>0&&(d=dt(d,"after_delete",{player:c}).newState),d=dt(d,"after_compile",{player:c}).newState,d=dt(d,"after_opponent_compile",{player:s}).newState;const L=[...g,...x].map(P=>{const M=Te(d,P.id).owner,N=P.isFaceUp?`${P.protocol}-${P.value}`:"Card";return d=ae(d,M,`${N} survives compilation and must be shifted.`),{type:"select_lane_for_shift",cardToShiftId:P.id,cardOwner:M,originalLaneIndex:n,sourceCardId:P.id,actor:M}});if(L.length>0){const P=L.shift();d.actionRequired=P,d.queuedActions=L,P.actor!==c&&(d._interruptedTurn=c,d._interruptedPhase=d.phase,d.turn=P.actor)}else d.actionRequired=null,d.queuedActions=[];return d},Ym=(t,n)=>t,rx=(t,n)=>{var x;if(((x=t.actionRequired)==null?void 0:x.type)!=="select_card_from_hand_to_play")return t;const{disallowedLaneIndex:r,sourceCardId:c,isFaceDown:s,actor:d,destinationRule:u,condition:p,faceDown:f,targetLaneIndex:h,validLanes:_,selectableCardIds:y,valueFilter:m,forcedLaneIndex:g}=t.actionRequired;if(y&&!y.includes(n))return t;if(g!==void 0){const C=f!==void 0?f:s,{ignoreProtocolMatching:b}=t.actionRequired;return C===void 0?{...t,actionRequired:{type:"select_lane_for_play",cardInHandId:n,sourceCardId:c,isFaceDown:void 0,actor:d,source:"hand",validLanes:[g],ignoreProtocolMatching:b}}:{...t,actionRequired:{type:"select_lane_for_play",cardInHandId:n,sourceCardId:c,isFaceDown:C,actor:d,source:"hand",preSelectedLane:g}}}return h!==void 0?{...t,actionRequired:{type:"select_lane_for_play",cardInHandId:n,sourceCardId:c,isFaceDown:s||f,actor:d,source:"hand",preSelectedLane:h}}:{...t,actionRequired:{type:"select_lane_for_play",cardInHandId:n,disallowedLaneIndex:r,sourceCardId:c,isFaceDown:s||f,actor:d,destinationRule:u,condition:p,validLanes:_}}},xm=t=>{if(!t.actionRequired||!("optional"in t.actionRequired)||!t.actionRequired.optional)return t;const n="actor"in t.actionRequired?t.actionRequired.actor:t.turn,r=n==="player"?"Player":"Opponent";let c={...t,actionRequired:null};return c=ae(c,n,`${r} skips the optional action.`),c},Cm=t=>{var d;if(((d=t.actionRequired)==null?void 0:d.type)!=="reveal_opponent_hand")return t;const n=t.actionRequired.actor,r=n==="player"?"opponent":"player";let c={...t};const s={...c[r]};if(s.hand.length>0){s.hand=s.hand.map(f=>({...f,isRevealed:!0})),c[r]=s;const u=Te(c,t.actionRequired.sourceCardId),p=u?`${u.card.protocol}-${u.card.value}`:"A card effect";c=ae(c,n,`${p}: Opponent reveals their hand.`)}return c.actionRequired=null,c},Sm=(t,n)=>Jd(t,n),bm=(t,n)=>eu(t,n).newState,Wm=(t,n)=>{var y;if(((y=t.actionRequired)==null?void 0:y.type)!=="select_card_from_revealed_deck")return t;const c=t.actionRequired.actor,s=c==="player"?"Player":"Opponent";let d={...t};const u={...d[c]},p=[...u.deck],f=p.findIndex(m=>(m.id||`deck-${p.indexOf(m)}`)===n);if(f===-1)return console.warn(`[resolveSelectRevealedDeckCard] Card ${n} not found in deck`),d.actionRequired=null,d;const h=p.splice(f,1)[0],_={...h,id:h.id||`drawn-${Date.now()}`,isFaceUp:!0};return u.deck=p,u.hand=[...u.hand,_],u.deckRevealed=!1,d[c]=u,d=ae(d,c,`${s} draws ${h.protocol}-${h.value} from the revealed deck.`),d.actionRequired=null,d=nt(d),d},Qm=t=>{var m;if(((m=t.actionRequired)==null?void 0:m.type)!=="reveal_deck_draw_protocol")return t;const n=t.actionRequired,r=n.actor,c=r==="player"?"Player":"Opponent",s=n.targetProtocol,d=n.shuffleAfter;let u={...t};const p={...u[r]},f=[...p.deck],h=f.filter(g=>g.protocol===s),_=f.filter(g=>g.protocol!==s),y=h.map(g=>({...g,id:ct(),isFaceUp:!0}));if(p.deck=_,p.hand=[...p.hand,...y],p.deckRevealed=!1,u[r]=p,y.length>0){const g=y.map(x=>`${x.protocol}-${x.value}`).join(", ");u=ae(u,r,`${c} draws ${y.length} ${s} card${y.length!==1?"s":""} (${g}).`)}else u=ae(u,r,`No ${s} cards in deck.`);if(d){const g=[...u[r].deck].sort(()=>Math.random()-.5);u[r]={...u[r],deck:g},u=ae(u,r,`${c} shuffles their deck.`)}return u.actionRequired=null,u=nt(u),u},yu=(t,n)=>{var d;if(((d=t.actionRequired)==null?void 0:d.type)!=="state_number")return t;const c=t.actionRequired.actor;let s=Lw(t,c,n);return s=nt(s),s},gu=(t,n)=>{var d;if(((d=t.actionRequired)==null?void 0:d.type)!=="state_protocol")return t;const c=t.actionRequired.actor;let s=Ow(t,c,n);return s=nt(s),s},vu=(t,n)=>{var y;if(((y=t.actionRequired)==null?void 0:y.type)!=="select_from_drawn_to_reveal")return t;const r=t.actionRequired,c=r.actor,s=c==="player"?"Player":"Opponent",d=r.statedNumber,u=r.thenAction;let p={...t};const h=p[c].hand.find(m=>m.id===n);if(!h)return p.actionRequired=null,p=nt(p),p;const _=d!==void 0?` (stated value: ${d})`:"";return p=ae(p,c,`${s} reveals ${h.protocol}-${h.value}${_}.`),p.lastCustomEffectTargetCardId=n,p.actionRequired=null,u==="may_play"&&(p.actionRequired={type:"prompt_optional_effect",actor:c,sourceCardId:r.sourceCardId,effectDef:{params:{action:"play",source:"hand",useCardFromPreviousEffect:!0}},optional:!0}),p},_u=t=>{var h;if(((h=t.actionRequired)==null?void 0:h.type)!=="confirm_deck_discard")return t;const n=t.actionRequired,{sourceCardId:r,followUpEffect:c,conditionalType:s,laneIndex:d,actor:u,discardedCard:p}=n;let f={...t};if(f.actionRequired=null,c&&r){const _=Te(f,r);if(_&&_.card.isFaceUp){const y={cardOwner:_.owner,opponent:_.owner==="player"?"opponent":"player"},m=d!==void 0?d:f[_.owner].lanes.findIndex(x=>x.some(C=>C.id===r));if(s==="if_protocol_matches_stated"){const x=p==null?void 0:p.protocol,C=f.lastStatedProtocol;if(!C||!x||x!==C)return f=ae(f,_.owner,`Discarded card (${x}) does not match stated protocol "${C||"none"}". Effect skipped.`),f=nt(f),f;f=ae(f,_.owner,`Discarded card matches stated protocol "${C}"!`)}if(f=pt(_.card,m,f,y,c).newState,f.actionRequired)return f}}return f=nt(f),f},Xm=(t,n)=>{var j;if(((j=t.actionRequired)==null?void 0:j.type)!=="select_card_from_trash_to_play")return t;const r=t.actionRequired,c=r.actor,s=c==="player"?"Player":"Opponent",{sourceCardId:d,faceDown:u,destinationRule:p,followUpEffect:f,conditionalType:h,sourceLaneIndex:_}=r;let y={...t};const m={...y[c]};if(n<0||n>=m.discard.length)return console.warn(`[resolveSelectTrashCardToPlay] Invalid index ${n}`),y.actionRequired=null,y;const g=[...m.discard],x=g.splice(n,1)[0];m.discard=g,y[c]=m;const C={...x,id:`trash-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,isFaceUp:u!==!0};y=ae(y,c,`${s} selects ${x.protocol}-${x.value} from trash.`);const b=u===void 0;if((p==null?void 0:p.type)==="other_lines"){const k=[0,1,2].filter(E=>E!==_);y.actionRequired={type:"select_lane_for_play",sourceCardId:d,actor:c,isFaceDown:u,source:"trash",preDrawnCard:C,disallowedLaneIndex:_,validLanes:k,useNormalPlayRules:b,followUpEffect:f,conditionalType:h}}else y.actionRequired={type:"select_lane_for_play",sourceCardId:d,actor:c,isFaceDown:u,source:"trash",preDrawnCard:C,useNormalPlayRules:b,followUpEffect:f,conditionalType:h};return y},Zm=(t,n)=>{var x,C;if(((x=t.actionRequired)==null?void 0:x.type)!=="select_card_from_trash_to_reveal")return t;const r=t.actionRequired,c=r.actor,s=c==="player"?"Player":"Opponent",{sourceCardId:d,followUpEffect:u,conditionalType:p,sourceLaneIndex:f}=r;let h={...t};const _={...h[c]};if(n<0||n>=_.discard.length)return console.warn(`[resolveSelectTrashCardToReveal] Invalid index ${n}`),h.actionRequired=null,h;const y=[..._.discard],m=y.splice(n,1)[0];_.discard=y,h[c]=_,h=ae(h,c,`${s} reveals ${m.protocol}-${m.value} from trash.`);const g={...m,id:`trash-revealed-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,isFaceUp:!1};if(u){const b=Te(h,d);if(b&&b.card.isFaceUp){const j=(C=u.params)==null?void 0:C.destinationRule,k=(j==null?void 0:j.type)==="other_lines"?[0,1,2].filter(E=>E!==f):[0,1,2];h.actionRequired={type:"select_lane_for_play",sourceCardId:d,actor:c,isFaceDown:!0,source:"trash",preDrawnCard:g,disallowedLaneIndex:(j==null?void 0:j.type)==="other_lines"?f:void 0,validLanes:(j==null?void 0:j.type)==="other_lines"?k:void 0}}else h=ae(h,c,"Source card no longer active. Play effect skipped."),h.actionRequired=null,h=nt(h)}else h.actionRequired=null,h=nt(h);return h},wu=t=>{var y;if(((y=t.actionRequired)==null?void 0:y.type)!=="confirm_deck_play_preview")return t;const n=t.actionRequired,{sourceCardId:r,actor:c,drawnCard:s,isFaceDown:d,excludeCurrentLane:u,currentLaneIndex:p,followUpEffect:f,conditionalType:h}=n;let _={...t};return _.actionRequired={type:"select_lane_for_play",sourceCardId:r,actor:c,count:1,isFaceDown:d,excludeCurrentLane:u,currentLaneIndex:p,source:"deck",preDrawnCard:s,followUpEffect:f,conditionalType:h},_};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const au=(t,n)=>{var y,m;if(((y=t.actionRequired)==null?void 0:y.type)!=="prompt_optional_draw")return t;const{sourceCardId:r,actor:c,count:s,drawingPlayer:d,logSource:u,logPhase:p,logIndentLevel:f}=t.actionRequired,h=c.charAt(0).toUpperCase()+c.slice(1);let _={...t};if(u!==void 0&&(_=Ke(_,u)),p!==void 0&&(_=tt(_,p)),f!==void 0&&(_._logIndentLevel=f),n){_=ae(_,c,`${h} chooses to execute the optional draw effect.`),_=xr(_,d||c,s),_=ae(_,c,`${h} draws ${s} card${s!==1?"s":""}.`);const g=t.actionRequired.followUpEffect;if(t.actionRequired.conditionalType,g){const x=Te(_,r);if(x){const C=_[x.owner].lanes.findIndex(E=>E.some(T=>T.id===r)),b=c==="player"?"opponent":"player",j={cardOwner:c,actor:c,currentTurn:_.turn,opponent:b,triggerType:"start"};_=pt(x.card,C,_,j,g).newState,_=nt(_)}else{const C=t.actionRequired.logSource||"deleted card";_=ae(_,c,`${C}: Follow-up effect skipped (source no longer active).`),_.actionRequired=null,((m=_._pendingCustomEffects)==null?void 0:m.sourceCardId)===r&&delete _._pendingCustomEffects,_.queuedActions&&_.queuedActions.length>0&&(_.queuedActions=_.queuedActions.filter(b=>b.sourceCardId!==r))}}else _.actionRequired=null}else _=ae(_,c,`${h} skips the draw.`),_.actionRequired=null;return _},Em=(t,n,r)=>{var s;if(((s=t.actionRequired)==null?void 0:s.type)!=="plague_4_player_flip_optional")return t;let c={...t,actionRequired:null};if(c=Ke(c,"Plague-4"),c=tt(c,"end"),n){const{sourceCardId:d}=t.actionRequired;c=ae(c,r,`${r==="player"?"Player":"Opponent"} chooses to flip the card.`),c=_r(new Set([d]),c),c.animationState={type:"flipCard",cardId:d}}else c=ae(c,r,`${r==="player"?"Player":"Opponent"} skips flipping the card.`);return c=Ke(c,void 0),c=tt(c,void 0),c=Yo(c),c},jm=(t,n)=>{var h,_,y;if(((h=t.actionRequired)==null?void 0:h.type)!=="prompt_optional_discard_custom")return t;const{actor:r,count:c,sourceCardId:s}=t.actionRequired,d=r.charAt(0).toUpperCase()+r.slice(1);let u={...t};const p=(_=t.actionRequired)==null?void 0:_.followUpEffect,f=(y=t.actionRequired)==null?void 0:y.conditionalType;return n?(u=ae(u,r,`${d} chooses to discard ${c} card(s).`),u.actionRequired={type:"discard",actor:r,count:c,sourceCardId:s,followUpEffect:p,conditionalType:f,previousHandSize:u[r].hand.length}):(u=ae(u,r,`${d} skips the discard.`),u.actionRequired=null),u},ou=(t,n)=>{var h,_,y,m,g,x,C;if(((h=t.actionRequired)==null?void 0:h.type)!=="prompt_optional_effect")return t;const{actor:r,sourceCardId:c,effectDef:s,laneIndex:d,savedTargetCardId:u}=t.actionRequired,p=r.charAt(0).toUpperCase()+r.slice(1);let f={...t};if(u&&(f.lastCustomEffectTargetCardId=u),n){const b=s.params.action;f=ae(f,r,`${p} chooses to execute the optional ${b} effect.`),f.actionRequired=null;const j=[...f.player.lanes.flat(),...f.opponent.lanes.flat()].find(V=>V.id===c);if(!j)return console.error("[Optional Effect] Source card not found!"),f;const k={cardOwner:r,opponent:r==="player"?"opponent":"player",currentTurn:f.turn,actor:r},E={...s,params:{...s.params,optional:!1},conditional:void 0},T=pt(j,d,f,k,E),F=!!T.newState.actionRequired,U=!!T.newState._effectSkippedNoTargets;if(U&&!F){const V={...T.newState};return delete V._effectSkippedNoTargets,V.actionRequired=null,V}if(U&&F&&delete T.newState._effectSkippedNoTargets,s.conditional&&s.conditional.type==="if_executed"&&s.conditional.thenEffect){if(T.newState.actionRequired){const P=T.newState.actionRequired.sourceCardId;if(P&&P!==c){const N={type:"execute_conditional_followup",sourceCardId:c,laneIndex:d,followUpEffect:s.conditional.thenEffect,context:k,actor:r,logSource:t.actionRequired.logSource,logPhase:t.actionRequired.logPhase,logIndentLevel:t.actionRequired.logIndentLevel};return{...T.newState,queuedActions:[...T.newState.queuedActions||[],N]}}return{...T.newState,actionRequired:{...T.newState.actionRequired,followUpEffect:s.conditional.thenEffect,conditionalType:"if_executed"}}}const V=[...T.newState.player.lanes.flat(),...T.newState.opponent.lanes.flat()].find(P=>P.id===c);if(!V){let P={...T.newState};const M=t.actionRequired.logSource,N=t.actionRequired.logPhase,R=t.actionRequired.logIndentLevel;return M!==void 0&&(P._currentEffectSource=M),N!==void 0&&(P._currentPhaseContext=N),R!==void 0&&(P._logIndentLevel=R),P=ae(P,r,"Follow-up effect skipped (source no longer active)."),P}const B=s.conditional.thenEffect,L=pt(V,d,T.newState,k,B);return L.newState.actionRequired&&B.conditional&&B.conditional.thenEffect?{...L.newState,actionRequired:{...L.newState.actionRequired,followUpEffect:B.conditional.thenEffect,conditionalType:B.conditional.type}}:L.newState}const I=(_=t.actionRequired)==null?void 0:_.followUpEffect,W=(y=t.actionRequired)==null?void 0:y.outerSourceCardId,z=(m=t.actionRequired)==null?void 0:m.outerLaneIndex;if(I&&W){let V=T.newState;if(V.actionRequired)return{...V,actionRequired:{...V.actionRequired,followUpEffect:I,outerSourceCardId:W,outerLaneIndex:z}};const B=[...V.player.lanes.flat(),...V.opponent.lanes.flat()].find(L=>L.id===W);if(B){const L=V.player.lanes.flat().some(R=>R.id===W)?"player":"opponent",P={cardOwner:L,opponent:L==="player"?"opponent":"player",currentTurn:V.turn,actor:L};let N=pt(B,z||0,V,P,I).newState;return N._interruptedTurn&&!N.actionRequired&&(N={...N,turn:N._interruptedTurn,_interruptedTurn:void 0,_interruptedPhase:void 0}),N}}return T.newState}else{const b=s.params.action;f=ae(f,r,`${p} skips the optional ${b} effect.`),f.actionRequired=null;const j=(g=t.actionRequired)==null?void 0:g.followUpEffect,k=(x=t.actionRequired)==null?void 0:x.outerSourceCardId,E=(C=t.actionRequired)==null?void 0:C.outerLaneIndex;if(j&&k){const T=[...f.player.lanes.flat(),...f.opponent.lanes.flat()].find(F=>F.id===k);if(T){let F=E;if(F===void 0){for(const z of["player","opponent"])for(let V=0;V<f[z].lanes.length;V++)if(f[z].lanes[V].some(B=>B.id===k)){F=V;break}}const U=f.player.lanes.flat().some(z=>z.id===k)?"player":"opponent",D={cardOwner:U,opponent:U==="player"?"opponent":"player",currentTurn:f.turn,actor:U};let W=pt(T,F||0,f,D,j).newState;return W._interruptedTurn&&!W.actionRequired&&(W={...W,turn:W._interruptedTurn,_interruptedTurn:void 0,_interruptedPhase:void 0}),W}}return f}},Wd=(t,n,r)=>{var E;if(((E=t.actionRequired)==null?void 0:E.type)!=="prompt_rearrange_protocols")return t;const c=lw(t);if(!c.allowed)return console.error(`Protocol rearrangement blocked: ${c.reason}`),t;const{target:s,actor:d,originalAction:u,sourceCardId:p,disallowedProtocolForLane:f}=t.actionRequired;if(f){const{laneIndex:T,protocol:F}=f;if(n[T]===F)return console.error(`Illegal rearrange: ${F} cannot be placed on lane ${T} due to Anarchy-3 restriction`),t}let h={...t};const _={...h[s]},y={};_.protocols.forEach((T,F)=>{y[T]=_.compiled[F]});const m=n.map(T=>y[T]);_.protocols=n,_.compiled=m,h[s]=_,h.actionRequired=null;const g=h._pendingCustomEffects;if(g&&g.effects.length>0){const T={type:"execute_remaining_custom_effects",sourceCardId:g.sourceCardId,laneIndex:g.laneIndex,effects:g.effects,context:g.context,actor:d,logSource:g.logSource,logPhase:g.logPhase,logIndentLevel:g.logIndentLevel};h.queuedActions=[T,...h.queuedActions||[]],delete h._pendingCustomEffects}let x="Control Action";if(p!=="CONTROL_MECHANIC"){const T=[...h.player.lanes.flat(),...h.opponent.lanes.flat()].find(F=>F.id===p);T&&(x=`${T.protocol}-${T.value}`)}const C=d.charAt(0).toUpperCase()+d.slice(1),b=s===d?"their own":"the opponent's",j=n.join(" | ");h=ae(h,d,`${x}: ${C} rearranges ${b} protocols.`),h=ae(h,d,`New protocol order for ${s}: ${j}`);let k=Re(h);if(u){if(k={...k,_logIndentLevel:0},u.type==="compile")return ls(k,u.laneIndex,r);if(u.type==="fill_hand")return is(k,d);u.type==="continue_turn"?u.queuedSpeed2Actions&&u.queuedSpeed2Actions.length>0?(k=ae(k,d,"Processing remaining Speed-2 effects..."),k.queuedActions=[...u.queuedSpeed2Actions,...k.queuedActions||[]]):(k=ae(k,d,"Turn ends after compile."),k.phase="hand_limit"):u.type==="resume_interrupted_turn"&&(k=ae(k,d,"Resuming interrupted turn..."),k._interruptedTurn=u.interruptedTurn,k._interruptedPhase=u.interruptedPhase,u.queuedSpeed2Actions&&u.queuedSpeed2Actions.length>0&&(k.queuedActions=[...u.queuedSpeed2Actions,...k.queuedActions||[]]))}return k},km=(t,n,r)=>{var k;if(((k=t.actionRequired)==null?void 0:k.type)!=="prompt_swap_protocols")return t;const{actor:c,target:s,originalAction:d,sourceCardId:u}=t.actionRequired,p={...t[s]},[f,h]=n.sort((E,T)=>E-T),_=[...p.protocols],y=[...p.compiled];[_[f],_[h]]=[_[h],_[f]],[y[f],y[h]]=[y[h],y[f]],p.protocols=_,p.compiled=y;let m={...t,[s]:p,actionRequired:null};const g=m._pendingCustomEffects;if(g&&g.effects.length>0){const E={type:"execute_remaining_custom_effects",sourceCardId:g.sourceCardId,laneIndex:g.laneIndex,effects:g.effects,context:g.context,actor:c,logSource:g.logSource,logPhase:g.logPhase,logIndentLevel:g.logIndentLevel};m.queuedActions=[E,...m.queuedActions||[]],delete m._pendingCustomEffects}const x=c.charAt(0).toUpperCase()+c.slice(1),C=s.charAt(0).toUpperCase()+s.slice(1);m=ae(m,c,`${u==="CONTROL_MECHANIC"?"Control":"Spirit-4"}: ${x} swaps ${C}'s protocols ${_[h]} and ${_[f]}.`),u==="CONTROL_MECHANIC"&&(m.controlCardHolder=null);let j=Re(m);if(d){if(d.type==="compile")return j=ae(j,c,"Resuming Compile action..."),ls(j,d.laneIndex,r);if(d.type==="fill_hand")return j=ae(j,c,"Resuming Refresh action..."),is(j,c)}return j},ru=(t,n)=>{var m;if(((m=t.actionRequired)==null?void 0:m.type)!=="prompt_shift_or_flip_board_card_custom")return t;const{actor:r,sourceCardId:c,revealedCardId:s,followUpAction:d,optional:u}=t.actionRequired,p=r.charAt(0).toUpperCase()+r.slice(1),f=Te(t,s);if(!f)return t;if(d&&n!=="skip"&&n!==d)return console.error(`Invalid choice: ${n}, followUpAction restricts to: ${d}`),t;const h=f.owner,_=t[h].lanes.findIndex(g=>g.some(x=>x.id===s));if(_===-1)return t;let y={...t};switch(n){case"shift":{const g=[...y[h].lanes[_]],x=g.findIndex(C=>C.id===s);if(x!==-1){g[x]={...g[x],isFaceUp:!1};const C=[...y[h].lanes];C[_]=g,y={...y,[h]:{...y[h],lanes:C}}}y=ae(y,r,`${p} chooses to shift the revealed card (face-down).`),y.actionRequired={type:"select_lane_to_shift_revealed_board_card_custom",sourceCardId:c,revealedCardId:s,actor:r};break}case"flip":{y=ae(y,r,`${p} chooses to flip the revealed card face-up permanently.`);const g={...y,actionRequired:null};y=tu(g,s).newState;break}case"skip":{const g=[...y[h].lanes[_]],x=g.findIndex(C=>C.id===s);if(x!==-1){g[x]={...g[x],isFaceUp:!1};const C=[...y[h].lanes];C[_]=g,y={...y,[h]:{...y[h],lanes:C}}}y=ae(y,r,`${p} chooses to do nothing with the revealed card.`),y.actionRequired=null;break}}return y};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Qd=(t,n)=>{if(!t.actionRequired)return t;const{actionRequired:r}=t,c=r.actor,s=c==="player"?"opponent":"player";switch(r.type){case"select_card_from_hand_to_give":{const d=t[c].hand.find(g=>g.id===n);if(!d)return t;let u={...t};const p={...u[c]},f={...u[s]};p.hand=p.hand.filter(g=>g.id!==n),f.hand=[...f.hand,d],u={...u,[c]:p,[s]:f};const h=c==="player"?"Player":"Opponent",_=`${d.protocol}-${d.value}`;u=ae(u,c,`${h} gives ${_} to the opponent.`),r.sourceEffect==="love_1_end"&&(u=ae(u,c,`Love-1: ${h} draws 2 cards.`),u=xr(u,c,2));const y=r.followUpEffect,m=r.conditionalType;if(y&&m==="if_executed"){const g=Te(u,r.sourceCardId);if(g){const{card:x,laneIndex:C}=g,b={cardOwner:c,actor:c,currentTurn:u.turn,opponent:s,triggerType:"play"};u=pt(x,C,u,b,y).newState}}return u.actionRequired=null,u}case"select_card_from_hand_to_reveal":{const d=t[c].hand.find(m=>m.id===n);if(!d)return t;let u={...t};const p={...u[c]},f=p.hand.map(m=>m.id===n?{...m,isRevealed:!0}:m);p.hand=f,u={...u,[c]:p};const h=c==="player"?"Player":"Opponent",_=`${d.protocol}-${d.value}`;u=ae(u,c,`${h} reveals ${_} from their hand.`);const y=u._pendingCustomEffects;if(y&&y.effects.length>0){const m=Te(u,y.sourceCardId);if(m){const{card:g}=m,x=y.effects[0],C=y.effects.slice(1),b={cardOwner:c,actor:c,currentTurn:u.turn,opponent:s,triggerType:"play"};return u=pt(g,y.laneIndex,u,b,x).newState,C.length>0?u._pendingCustomEffects={...y,effects:C}:delete u._pendingCustomEffects,u}}return u.actionRequired={type:"select_any_card_to_flip",count:1,sourceCardId:r.sourceCardId,actor:c},u}default:return t}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const lu=(t,n)=>{var g;if(((g=t.actionRequired)==null?void 0:g.type)!=="custom_choice")return t;const{options:r,sourceCardId:c,actor:s,laneIndex:d}=t.actionRequired;if(n<0||n>=r.length)return console.error(`[Choice Resolver] Invalid option index: ${n}`),t;const u=r[n],p=Te(t,c);if(!p){console.error(`[Choice Resolver] Source card ${c} not found`);let x={...t};return x.actionRequired=null,x}const f=s==="player"?"opponent":"player",h={cardOwner:s,actor:s,currentTurn:t.turn,opponent:f};let _={...t,actionRequired:null};const y=pt(p.card,d,_,h,u);return Re(y.newState)};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Control Mechanic Logic for AI
 *
 * CRITICAL: When evaluating rearrangements during a compile action,
 * the lane being compiled will have its value RESET TO 0 after the compile.
 * This must be considered when determining beneficial swaps!
 */function Tc(t,n){const r=[...t];return n!==null&&n>=0&&n<3&&(r[n]=0),r}function Km(t,n=null){const r=t.player,c=[],s=[];for(let u=0;u<3;u++)r.compiled[u]?c.push(u):s.push(u);if(c.length===0||s.length===0)return!1;const d=Tc(r.laneValues,n);for(const u of c)for(const p of s)if(d[p]-d[u]>0)return!0;return!1}function Rc(t,n=null){const r=t.opponent,c=[],s=[];for(let u=0;u<3;u++)r.compiled[u]?c.push(u):s.push(u);if(c.length===0||s.length===0)return!1;const d=Tc(r.laneValues,n);for(const u of c)for(const p of s){const h=10-d[u];if(h>=0&&h<=3){const y=10-d[p];if(h<y)return!0}}return!1}function Jm(t,n){if(!n||n.type!=="prompt_rearrange_protocols")return{type:"rearrangeProtocols",newOrder:[...t.opponent.protocols]};const r=n.target,c=n.disallowedProtocolForLane;let s=null;n.originalAction&&n.originalAction.type==="compile"&&(s=n.originalAction.laneIndex);const d=g=>{if(!c)return!0;const{laneIndex:x,protocol:C}=c;return g[x]!==C},u=t.opponent,p=t.player,f=Tc(u.laneValues,s),h=Tc(p.laneValues,s),_=u.compiled.filter(g=>g).length;if(p.compiled.filter(g=>g).length===2&&_===2){const g=p.compiled.findIndex(j=>!j),x=u.compiled.findIndex(j=>!j),C=h[g],b=f[x];if(C>b&&r==="player"){let j=-1,k=1/0;for(let E=0;E<3;E++)p.compiled[E]&&h[E]<k&&(k=h[E],j=E);if(j!==-1&&k<=C){const E=[...p.protocols];if([E[g],E[j]]=[E[j],E[g]],d(E))return{type:"rearrangeProtocols",newOrder:E}}return hr(p.protocols,d)}if(C<=b&&r==="opponent"){let j=-1,k=-1;for(let E=0;E<3;E++)u.compiled[E]&&f[E]>k&&(k=f[E],j=E);if(j!==-1&&k>b&&k>0){const E=[...u.protocols];if([E[x],E[j]]=[E[j],E[x]],d(E))return{type:"rearrangeProtocols",newOrder:E}}return hr(u.protocols,d)}}if(r==="player"){const g=[],x=[];for(let k=0;k<3;k++)p.compiled[k]?g.push(k):x.push(k);if(g.length===0||x.length===0){if(n.sourceCardId!=="CONTROL_MECHANIC")for(let E=0;E<3;E++)for(let T=E+1;T<3;T++){const F=[...p.protocols];if([F[E],F[T]]=[F[T],F[E]],d(F))return{type:"rearrangeProtocols",newOrder:F}}return hr(p.protocols,d)}let C=null;for(const k of x)if(h[k]>=10&&h[k]>f[k]){for(const T of g){C={compiledIdx:T,uncompiledIdx:k};break}if(C)break}if(C){const k=[...p.protocols];if([k[C.compiledIdx],k[C.uncompiledIdx]]=[k[C.uncompiledIdx],k[C.compiledIdx]],d(k))return{type:"rearrangeProtocols",newOrder:k}}let b=null;for(const k of g)for(const E of x){const T=h[E]-h[k];(!b||T>b.score)&&(b={compiledIdx:k,uncompiledIdx:E,score:T})}const j=n.sourceCardId!=="CONTROL_MECHANIC";if(b&&b.score>0){const k=[...p.protocols];if([k[b.compiledIdx],k[b.uncompiledIdx]]=[k[b.uncompiledIdx],k[b.compiledIdx]],d(k))return{type:"rearrangeProtocols",newOrder:k}}if(j)for(let k=0;k<3;k++)for(let E=k+1;E<3;E++){const T=[...p.protocols];if([T[k],T[E]]=[T[E],T[k]],d(T))return{type:"rearrangeProtocols",newOrder:T}}return hr(p.protocols,d)}if(r==="opponent"){const g=[],x=[];for(let j=0;j<3;j++)u.compiled[j]?g.push(j):x.push(j);if(g.length===0||x.length===0){if(n.sourceCardId!=="CONTROL_MECHANIC")for(let k=0;k<3;k++)for(let E=k+1;E<3;E++){const T=[...u.protocols];if([T[k],T[E]]=[T[E],T[k]],d(T))return{type:"rearrangeProtocols",newOrder:T}}return hr(u.protocols,d)}let C=null;for(const j of g)for(const k of x){const E=f[j],T=f[k],F=E-T,D=E>=10&&E>h[j]?F+100:F;(!C||D>C.score)&&(C={compiledIdx:j,uncompiledIdx:k,score:D,newUncompiledValue:E})}const b=n.sourceCardId!=="CONTROL_MECHANIC";if(C&&C.score>0){const j=[...u.protocols];if([j[C.compiledIdx],j[C.uncompiledIdx]]=[j[C.uncompiledIdx],j[C.compiledIdx]],d(j))return{type:"rearrangeProtocols",newOrder:j}}if(b)for(let j=0;j<3;j++)for(let k=j+1;k<3;k++){const E=[...u.protocols];if([E[j],E[k]]=[E[k],E[j]],d(E))return{type:"rearrangeProtocols",newOrder:E}}return hr(u.protocols,d)}const m=r==="player"?[...p.protocols]:[...u.protocols];return hr(m,d)}function hr(t,n){if(n(t))return{type:"rearrangeProtocols",newOrder:[...t]};for(let r=0;r<3;r++)for(let c=r+1;c<3;c++){const s=[...t];if([s[r],s[c]]=[s[c],s[r]],n(s))return{type:"rearrangeProtocols",newOrder:s}}return console.error("[AI Rearrange] Could not find any valid arrangement - returning current order"),{type:"rearrangeProtocols",newOrder:[...t]}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function ey(t,n){return Sn(t).some(({rule:c,cardOwner:s})=>c.type!=="require_face_down_play"?!1:c.target==="all"||c.target==="opponent"&&s!==n)}function xu(t){const n=t;return n.customEffects?[...n.customEffects.topEffects||[],...n.customEffects.middleEffects||[],...n.customEffects.bottomEffects||[]].some(c=>{var u,p;const s=c.trigger;return(s==="on_cover"||s==="on_cover_or_flip")&&((u=c.params)==null?void 0:u.action)==="delete"&&((p=c.params)==null?void 0:p.deleteSelf)===!0}):!1}function ty(t,n,r){const c=t[n].lanes[r];if(c.length===0)return null;const s=c[c.length-1];return s.isFaceUp&&xu(s)?s.value:null}function ny(t){const n=t;return n.customEffects?[...n.customEffects.topEffects||[],...n.customEffects.middleEffects||[],...n.customEffects.bottomEffects||[]].some(c=>{var s;return c.params.action==="return"&&((s=c.params.targetFilter)==null?void 0:s.owner)==="own"}):!1}function ay(t){const n=t;return n.customEffects?[...n.customEffects.topEffects||[],...n.customEffects.middleEffects||[],...n.customEffects.bottomEffects||[]].some(c=>{var s,d,u;return c.params.action==="delete"&&((s=c.params.targetFilter)==null?void 0:s.owner)==="own"&&(((d=c.params.targetFilter)==null?void 0:d.valueFilter)==="highest"||((u=c.params.targetFilter)==null?void 0:u.calculation)==="highest_value")}):!1}function lx(t){const n=t;if(!n.customEffects)return 0;const r=n.customEffects.topEffects||[];for(const c of r)if(c.trigger==="passive"&&c.params.action==="value_modifier"&&(c.params.condition==="per_face_down_card"||c.params.applyTo==="face_down_cards"))return c.params.modifier||0;return 0}function oy(t,n){let r=0;for(const c of["player","opponent"])for(const s of t[c].lanes[n])if(s.isFaceUp){const d=lx(s);d>0&&(r=Math.max(r,d))}return r}function sx(t){const n=t;return n.customEffects?[...n.customEffects.topEffects||[],...n.customEffects.middleEffects||[],...n.customEffects.bottomEffects||[]].some(c=>{var d,u,p;if(((d=c.params)==null?void 0:d.action)!=="flip")return!1;const s=(u=c.params)==null?void 0:u.targetFilter;return(s==null?void 0:s.owner)==="own"&&((s==null?void 0:s.scope)==="this_lane"||((p=c.params)==null?void 0:p.scope)==="this_lane"||(s==null?void 0:s.position)==="in_this_stack")}):!1}function cx(t){const n=t;return n.customEffects?[...n.customEffects.topEffects||[],...n.customEffects.middleEffects||[],...n.customEffects.bottomEffects||[]].some(c=>{var d,u,p;if(((d=c.params)==null?void 0:d.action)!=="delete")return!1;const s=(u=c.params)==null?void 0:u.targetFilter;return(s==null?void 0:s.owner)==="own"&&((s==null?void 0:s.scope)==="this_lane"||((p=c.params)==null?void 0:p.scope)==="this_lane"||(s==null?void 0:s.position)==="in_this_stack")}):!1}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * EASY AI - Old Normal AI logic (before strategic modules)
 * - Makes good strategic decisions
 * - No memory of revealed cards
 * - 5% chance to make suboptimal moves for slight unpredictability
 * - Challenging but beatable
 */const ul=["delete","flip","shift","return","discard"],dn=t=>{let n=12-t.value;return ul.some(r=>t.keywords[r])&&(n+=6),t.keywords.draw&&(n+=3),t.keywords.play&&(n+=8),t.keywords.prevent&&(n+=4),n},Jr=(t,n,r)=>{let c;for(const d of r[n].lanes)if(d.some(u=>u.id===t.id)){c=d;break}if(!c)return 0;if(!t.isFaceUp)return c.some(u=>u.isFaceUp&&u.protocol==="Darkness"&&u.value===2)?4:2;let s=t.value*2.5;return t.top.length>0&&(s+=6),(t.bottom.includes("Start:")||t.bottom.includes("End:"))&&(s+=8),t.bottom.includes("covered:")&&(s+=5),ul.some(d=>t.keywords[d])&&(s+=4),s},nl=()=>Math.random()<.05,Nm=t=>t+(Math.random()*4-2),el=(t,n,r,c)=>{const s=r.position||"uncovered";return!(s==="uncovered"&&!n||s==="covered"&&n||r.faceState==="face_up"&&!t.isFaceUp||r.faceState==="face_down"&&t.isFaceUp||r.excludeSelf&&c&&t.id===c||r.valueRange&&(!t.isFaceUp||t.value<r.valueRange.min||t.value>r.valueRange.max)||r.valueEquals!==void 0&&(!t.isFaceUp||t.value!==r.valueEquals))},ix=t=>{var E,T,F,U;const n=[],r=ey(t,"opponent"),c=t.player.lanes.flat().length+t.opponent.lanes.flat().length,s=c<=3,d=c>3&&c<=8,p=t.player.lanes.flat().length>0,f=t.player.compiled.filter(Boolean).length,h=t.controlCardHolder==="opponent";t.controlCardHolder;let _=0;for(let D=0;D<3;D++)t.opponent.laneValues[D]>t.player.laneValues[D]?_++:t.player.laneValues[D]>t.opponent.laneValues[D];const m=t.useControlMechanic===!0&&f>=1&&!h;for(let D=0;D<3&&!(!t.player.compiled[D]&&t.player.laneValues[D]>=10&&t.player.laneValues[D]>t.opponent.laneValues[D]);D++);const g=t.opponent.compiled.filter(Boolean).length;let x=-1;if(g<3&&!m){const D=[];for(let I=0;I<3;I++){if(t.opponent.compiled[I])continue;const W=t.opponent.protocols[I],z=t.player.protocols[I],V=t.opponent.laneValues[I],B=t.player.laneValues[I],L=t.opponent.hand.filter(R=>R.protocol===W||R.protocol===z);if(B>=10&&!t.player.compiled[I]){const R=Math.max(...L.map(q=>q.value),0),X=Math.max(R,2);if(V+X<=B)continue}let P=0,M=`Lane ${I} (${W}): value=${V}`;P+=V*15,V>=8?(P+=100,M+=` [ALMOST COMPILE: ${V}]`):V>=6?(P+=60,M+=` [Near compile: ${V}]`):V>=4&&(P+=30,M+=` [Building: ${V}]`),P+=L.length*10,L.length>0&&(M+=` [${L.length} cards]`);const N=L.filter(R=>R.value>=4);P+=N.length*20,B>V&&(P-=(B-V)*5),L.length===0&&(P-=30,M+=" [No matching cards - face-down only]"),D.push({laneIndex:I,score:P,reason:M})}D.sort((I,W)=>W.score-I.score),D.length>0&&(x=D[0].laneIndex)}const C=(D,I)=>D.keywords.flip||D.keywords.delete||D.keywords.shift||D.keywords.return?t.player.lanes.flat().length>0||t.opponent.lanes.some((V,B)=>B!==I&&V.length>0)||t.opponent.lanes[I].length>0:!0,b=D=>D.keywords.draw?t.opponent.hand.length>=5:!1;for(const D of t.opponent.hand)for(let I=0;I<3;I++){const W=yr(t,"opponent",I,!0,D.protocol),z=yr(t,"opponent",I,!1,D.protocol);if(!W.allowed&&!z.allowed||t.opponent.compiled[I])continue;const V=t.player.laneValues[I]>=10&&t.player.laneValues[I]>t.opponent.laneValues[I]&&!t.player.compiled[I];if(V){const R=Math.max(W.allowed?D.value:0,z.allowed?fn({...D,isFaceUp:!1},t.opponent.lanes[I]):0);if(t.opponent.laneValues[I]+R<t.player.laneValues[I]&&!ul.some(X=>D.keywords[X]))continue}let B=!1;if(ny(D)){let R=0;for(let $=0;$<3;$++)if(t.opponent.lanes[$].length>0){if($===I)continue;R++}R===0&&(B=!0)}if(xu(D)){const R=t.opponent.laneValues[I],$=Math.max(0,10-D.value);if(R<$)continue;const X=R+D.value,G=t.player.laneValues[I];if(X<=G)continue}const L=ty(t,"opponent",I);if(L!==null){const R=t.opponent.laneValues[I],$=R+D.value-L,X=$>=10&&$>t.player.laneValues[I],G=R-L>=4;if(!X&&!G)continue}const P=V;let M=!1;if(ay(D)){let R=0;for(let $=0;$<3;$++){const X=t.opponent.lanes[$];if(X.length>0&&$!==I){const G=X[X.length-1],q=G.isFaceUp?G.value:2;q>R&&(R=q)}}D.value>=R&&(M=!0)}if(W.allowed&&!r&&!M&&!B){let R=0,$=`Play ${D.protocol}-${D.value} face-up in lane ${I}`;const X=D.value,G=t.opponent.laneValues[I]+X;if(P)G>t.player.laneValues[I]?(R=180+G*5,$+=" [Blocks compile!]"):G===t.player.laneValues[I]?(R=160+G*3,$+=" [Blocks compile with tie!]"):(R=-500,$+=" [WASTE: Card goes to trash when player compiles!]");else{if(R+=X*10,G>=10&&G>t.player.laneValues[I]&&!t.opponent.compiled[I])R+=200,$+=` [COMPILE: ${G}]`;else if(G>=8&&G<10&&!t.opponent.compiled[I]){const Q=t.opponent.lanes[I].some(Z=>Z.isFaceUp&&Z.protocol==="Darkness"&&Z.value===2)?4:2;t.opponent.laneValues[I]+Q>=10&&G<10?(R-=50,$+=` [Near ${G} but face-down could compile!]`):(R+=40,$+=` [Near compile: ${G}]`)}s&&X<=2&&(R-=50,$+=" [Low value early game penalty]"),C(D,I)||(R-=80,$+=" [No valid targets for effect]"),b(D)&&(R-=30,$+=" [Draw would cause discard]");const q=ul.some(Q=>D.keywords[Q]);if(q&&p?d&&t.player.laneValues[I]>=5?(R+=35,$+=" [Disruption with targets]"):t.player.laneValues[I]>=8&&(R+=50,$+=" [Disruption near compile]"):q&&!p&&(R-=40,$+=" [Disruption but no targets]"),x!==-1&&!m&&(I===x?(R+=150,$+=" [FOCUS LANE]"):(R-=100,$+=" [Not focus lane]")),m){const Q=t.opponent.laneValues[I]>t.player.laneValues[I],K=G>t.player.laneValues[I],Z=t.opponent.laneValues[I]===t.player.laneValues[I];if(Q)R-=200,$+=" [ALREADY LEADING - DON'T WASTE!]";else if(!Q&&K)_===1?(R+=500,$+=" [CONTROL CAPTURE! 1->2 leads]"):_===0?(R+=300,$+=" [First lead! 0->1 leads]"):(R+=100,$+=" [Extra lead]");else if(Z&&K)_===1?(R+=450,$+=" [BREAK TIE FOR CONTROL!]"):(R+=250,$+=" [Break tie]");else if(!Q&&!K&&_===1){const te=t.player.laneValues[I]-G;te<=3?(R+=200,$+=` [BUILD toward 2nd lead, gap=${te}]`):te<=6?(R+=150,$+=` [BUILD toward 2nd lead, gap=${te}]`):(R+=100,$+=` [BUILD toward 2nd lead, gap=${te}]`)}}}n.push({move:{type:"playCard",cardId:D.id,laneIndex:I,isFaceUp:!0},score:Nm(R),reason:$})}if(z.allowed){const R=fn({...D,isFaceUp:!1},t.opponent.lanes[I]),$=t.opponent.laneValues[I]+R,X=t.opponent.laneValues[I];let G=-100,q=`Play ${D.protocol}-${D.value} face-down in lane ${I}`;if(P?$>=t.player.laneValues[I]?(G=150,q+=` [Blocks compile: ${$} vs ${t.player.laneValues[I]}]`):(G=-500,q+=" [WASTE: Card goes to trash when player compiles!]"):!t.opponent.compiled[I]&&$>=10&&$>t.player.laneValues[I]?(G=300,q+=` [COMPILE: Face-down finishes at ${X} -> ${$} beats player ${t.player.laneValues[I]}]`):!t.opponent.compiled[I]&&t.player.laneValues[I]>=10&&$>=t.player.laneValues[I]?(G=250,q+=` [BLOCK COMPILE: Face-down reaches ${$} vs player ${t.player.laneValues[I]}]`):!t.opponent.compiled[I]&&t.player.laneValues[I]>=10&&$<t.player.laneValues[I]?(G=-500,q+=" [WASTE: Card goes to trash when player compiles!]"):x===I&&!t.opponent.compiled[I]&&X>=4?(G=50+X*10,q+=` [BUILD FOCUS: ${X} -> ${$}]`):!W.allowed&&D.value<=1?(G=-20,q+=" [No face-up option, low value]"):(G=-120,q+=" [Avoid: Face-up is better]"),x!==-1&&G<50&&!m&&(I===x?(G+=50,q+=" [Focus lane]"):(G-=80,q+=" [Not focus lane]")),m){const Q=t.opponent.laneValues[I]>t.player.laneValues[I],K=$>t.player.laneValues[I],Z=t.opponent.laneValues[I]===t.player.laneValues[I];if(Q)G-=200,q+=" [FD ALREADY LEADING - DON'T WASTE!]";else if(!Q&&K)_===1?(G+=400,q+=" [FD CONTROL CAPTURE! 1->2 leads]"):_===0&&(G+=250,q+=" [FD First lead!]");else if(Z&&K)_===1?(G+=350,q+=" [FD BREAK TIE FOR CONTROL!]"):(G+=200,q+=" [FD Break tie]");else if(!Q&&!K&&_===1){const te=t.player.laneValues[I]-$;te<=3?(G+=150,q+=` [FD BUILD toward 2nd lead, gap=${te}]`):te<=6&&(G+=100,q+=` [FD BUILD toward 2nd lead, gap=${te}]`)}}n.push({move:{type:"playCard",cardId:D.id,laneIndex:I,isFaceUp:!1},score:Nm(G),reason:q})}}if(t.opponent.hand.length===0)n.push({move:{type:"fillHand"},score:500,reason:"Must refill - no cards"});else{const D=t.player.laneValues.some((z,V)=>z>=10&&z>t.opponent.laneValues[V]&&!t.player.compiled[V]),I=t.controlCardHolder==="opponent",W=t.player.compiled.some(z=>z);D&&I&&W&&n.push({move:{type:"fillHand"},score:200,reason:"Emergency draw to block compile with control swap"})}if(n.length===0)return{type:"fillHand"};n.sort((D,I)=>I.score-D.score);const j=D=>{if(D.type==="playCard"&&D.isFaceUp){const I=t.opponent.hand.find(z=>z.id===D.cardId);if(!I)return!1;const W=yr(t,"opponent",D.laneIndex,!0,I.protocol);if(!W.allowed)return console.warn(`[AI Safety] Rejecting invalid face-up play: ${I.protocol}-${I.value} in lane ${D.laneIndex} - ${W.reason}`),!1}return!0};if(!(((T=(E=n[0])==null?void 0:E.reason)==null?void 0:T.includes("Blocks compile"))||((U=(F=n[0])==null?void 0:F.reason)==null?void 0:U.includes("BLOCK COMPILE")))&&nl()&&n.length>1&&n[1].score>0&&j(n[1].move))return n[1].move;for(const D of n)if(j(D.move))return D.move;return console.warn("[AI Safety] No valid moves found, falling back to fillHand"),{type:"fillHand"}},dx=(t,n)=>{var r,c;switch(n.type){case"prompt_use_control_mechanic":{const s=t.player.compiled.filter(f=>f).length,d=t.compilableLanes.length>0?t.compilableLanes[0]:null;let u=-1;for(let f=0;f<3;f++)if(!t.player.compiled[f]&&t.player.laneValues[f]>=10&&t.player.laneValues[f]>t.opponent.laneValues[f]){u=f;break}const p=t.player.compiled.map((f,h)=>f?h:-1).filter(f=>f!==-1);return u!==-1&&p.length>0?{type:"resolveControlMechanicPrompt",choice:"player"}:s===0?Rc(t,d)&&!nl()?{type:"resolveControlMechanicPrompt",choice:"opponent"}:{type:"resolveControlMechanicPrompt",choice:"skip"}:Km(t,d)?{type:"resolveControlMechanicPrompt",choice:"player"}:Rc(t,d)&&!nl()?{type:"resolveControlMechanicPrompt",choice:"opponent"}:{type:"resolveControlMechanicPrompt",choice:"skip"}}case"discard":return{type:"discardCards",cardIds:[...t.opponent.hand].sort((d,u)=>{const p=ul.some(h=>d.keywords[h]),f=ul.some(h=>u.keywords[h]);return p&&!f?1:!p&&f?-1:dn(d)-dn(u)}).slice(0,n.count).map(d=>d.id)};case"discard_completed":return{type:"skip"};case"select_opponent_card_to_flip":{const d=(p=>t[p].lanes.map(f=>f.length>0?f[f.length-1]:null).filter(f=>f!==null))("player");if(d.length===0)return{type:"skip"};const u=d.map(p=>({cardId:p.id,score:p.isFaceUp?p.value+5:3}));return u.sort((p,f)=>f.score-p.score),{type:"flipCard",cardId:u[0].cardId}}case"select_cards_to_delete":{const s=n.disallowedIds||[],d=n.allowedIds,u=n.targetFilter??{},p="actorChooses"in n?n.actorChooses:"effect_owner",f=n.sourceCardId;if(p==="card_owner"&&(u==null?void 0:u.owner)==="opponent"){const y=[];return t.opponent.lanes.forEach(m=>{if(m.length>0){const g=m[m.length-1];if(el(g,!0,u,f)){if(d&&!d.includes(g.id))return;y.push(g)}}}),y.length>0?(y.sort((m,g)=>m.value-g.value),{type:"deleteCard",cardId:y[0].id}):{type:"skip"}}const h=y=>t[y].lanes.map(m=>m.length>0?m[m.length-1]:null).filter(m=>m!==null).filter(m=>el(m,!0,u,f)).filter(m=>!d||d.includes(m.id)),_=u==null?void 0:u.owner;if(_==="own"){const y=h("opponent").filter(m=>!s.includes(m.id));if(y.length>0)return{type:"deleteCard",cardId:y.sort((g,x)=>g.value-x.value)[0].id}}else if(_==="opponent"){const y=h("player").filter(m=>!s.includes(m.id));if(y.length>0){const m=y.map(g=>{const x=t.player.lanes.findIndex(j=>j.some(k=>k.id===g.id)),C=t.player.laneValues[x],b=C>=10&&C>t.opponent.laneValues[x];return{cardId:g.id,score:Jr(g,"player",t)+C+(b?50:0)}});return m.sort((g,x)=>x.score-g.score),{type:"deleteCard",cardId:m[0].cardId}}}else{const y=h("player").filter(g=>!s.includes(g.id));if(y.length>0){const g=y.map(x=>{const C=t.player.lanes.findIndex(k=>k.some(E=>E.id===x.id)),b=t.player.laneValues[C],j=b>=10&&b>t.opponent.laneValues[C];return{cardId:x.id,score:Jr(x,"player",t)+b+(j?50:0)}});return g.sort((x,C)=>C.score-x.score),{type:"deleteCard",cardId:g[0].cardId}}const m=h("opponent").filter(g=>!s.includes(g.id));if(m.length>0)return{type:"deleteCard",cardId:m.sort((x,C)=>x.value-C.value)[0].id}}return{type:"skip"}}case"select_any_card_to_flip":case"select_any_other_card_to_flip":case"select_any_face_down_card_to_flip_optional":case"select_any_card_to_flip_optional":{const s=Oa(t),d=n.targetFilter,u=n.sourceCardId,p=n.actor,f=n.currentLaneIndex??n.laneIndex,h=n.scope,_=[];for(const m of["player","opponent"])if(!(d&&(d.owner==="own"&&m!==p||d.owner==="opponent"&&m===p)))for(let g=0;g<t[m].lanes.length;g++){if(f!==void 0&&g!==f||h==="this_lane"&&f!==void 0&&g!==f)continue;const x=t[m].lanes[g];if(x.length!==0)for(let C=0;C<x.length;C++){const b=x[C],j=C===x.length-1;if(d){if(!el(b,j,d,u))continue}else if(!j)continue;s&&!b.isFaceUp||_.push({card:b,owner:m})}}if(_.length===0)return{type:"skip"};const y=_.map(({card:m,owner:g})=>{let x=0,C=-1;for(let F=0;F<t[g].lanes.length;F++)if(t[g].lanes[F].some(U=>U.id===m.id)){C=F;break}const b=C>=0?t[g].laneValues[C]:0,j=C>=0?t[g].compiled[C]:!1,k=m.isFaceUp?m.value:2,T=(m.isFaceUp?2:m.value)-k;return g==="player"?m.isFaceUp?(x=-T*15,x+=Jr(m,"player",t)):m.value<=1?x=20:x=-30:m.isFaceUp?T>0?(x=T*20+50,!j&&b+T>=10&&(x+=200)):x=T*15-30:T>0?(x=T*20+40,!j&&b+T>=10&&(x+=200)):x=-10,{cardId:m.id,score:x}});return y.sort((m,g)=>g.score-m.score),{type:"flipCard",cardId:y[0].cardId}}case"plague_2_opponent_discard":return t.opponent.hand.length===0?{type:"skip"}:{type:"discardCards",cardIds:[[...t.opponent.hand].sort((d,u)=>dn(d)-dn(u))[0].id]};case"select_card_from_hand_to_play":{if(t.opponent.hand.length===0)return{type:"skip"};const s=n.faceDown===!0,d=n.selectableCardIds,u=d?t.opponent.hand.filter(y=>d.includes(y.id)):t.opponent.hand;if(u.length===0)return{type:"skip"};const p=n.forcedLaneIndex;let f;if(p!==void 0?f=[p]:f=n.validLanes||[0,1,2].filter(y=>y!==n.disallowedLaneIndex),f=f.filter(y=>{const m=t.player.lanes[y],g=m.length>0?m[m.length-1]:null;return!(g&&g.isFaceUp&&g.protocol==="Plague"&&g.value===0)}),f.length===0)return{type:"skip"};const h=[];for(const y of u)for(const m of f){if(!s){const C=t.opponent.lanes.flat().some(E=>E.isFaceUp&&E.protocol==="Spirit"&&E.value===1),b=t.opponent.lanes.some(E=>{if(E.length===0)return!1;const T=E[E.length-1];return T.isFaceUp&&T.protocol==="Chaos"&&T.value===3}),j=[...t.player.lanes.flat(),...t.opponent.lanes.flat()].some(E=>E.isFaceUp&&E.protocol==="Anarchy"&&E.value===1);let k;if(j?k=y.protocol!==t.opponent.protocols[m]&&y.protocol!==t.player.protocols[m]:k=y.protocol===t.opponent.protocols[m]||y.protocol===t.player.protocols[m]||C||b,k){const E=y.value,T=t.opponent.laneValues[m]+E;let F=dn(y)+E*2;T>=10&&T>t.player.laneValues[m]&&(F+=100);const U=t.player.laneValues[m],D=t.player.compiled[m],I=t.opponent.compiled[m],W=t.opponent.laneValues[m];!D&&!I&&U>=10&&U>W&&T>=U&&(F+=160),h.push({cardId:y.id,laneIndex:m,isFaceUp:!0,score:F})}}if(!t.player.lanes[m].some(C=>C.isFaceUp&&C.protocol==="Metal"&&C.value===2)){const C=fn({...y,isFaceUp:!1},t.opponent.lanes[m]),b=t.opponent.laneValues[m]+C;let j=C*2;b>=10&&b>t.player.laneValues[m]&&(j+=80);const k=t.player.laneValues[m],E=t.player.compiled[m],T=t.opponent.compiled[m],F=t.opponent.laneValues[m];!E&&!T&&k>=10&&k>F&&b>=k&&(j+=150),h.push({cardId:y.id,laneIndex:m,isFaceUp:!1,score:j})}}if(h.length===0)return{type:"skip"};h.sort((y,m)=>m.score-y.score);const _=h[0];return{type:"playCard",cardId:_.cardId,laneIndex:_.laneIndex,isFaceUp:_.isFaceUp}}case"select_card_from_hand_to_give":return t.opponent.hand.length===0?{type:"skip"}:{type:"giveCard",cardId:[...t.opponent.hand].sort((d,u)=>dn(d)-dn(u))[0].id};case"select_card_from_hand_to_reveal":return t.opponent.hand.length===0?{type:"skip"}:{type:"revealCard",cardId:[...t.opponent.hand].sort((d,u)=>dn(u)-dn(d))[0].id};case"select_card_to_return":case"select_opponent_card_to_return":{const d={position:"uncovered",...n.targetFilter||{}},u=n.targetOwner||d.owner,p=n.sourceCardId,f=n.actor,h=[];for(const m of["player","opponent"])if(!(u==="own"&&m!==f)&&!(u==="opponent"&&m===f))for(const g of t[m].lanes)for(let x=0;x<g.length;x++){const C=g[x],b=x===g.length-1;el(C,b,d,p)&&h.push({card:C,owner:m})}if(h.length===0)return{type:"skip"};const _=h.filter(m=>m.owner==="player"),y=h.filter(m=>m.owner==="opponent");return _.length>0?(_.sort((m,g)=>Jr(g.card,"player",t)-Jr(m.card,"player",t)),{type:"returnCard",cardId:_[0].card.id}):y.length>0?(y.sort((m,g)=>m.card.value-g.card.value),{type:"returnCard",cardId:y[0].card.id}):{type:"returnCard",cardId:h[0].card.id}}case"select_lane_for_play":{let s=n.validLanes||[0,1,2];if(s=s.filter(p=>!("disallowedLaneIndex"in n)||p!==n.disallowedLaneIndex),n.excludeCurrentLane&&n.currentLaneIndex!==void 0&&(s=s.filter(p=>p!==n.currentLaneIndex)),s=s.filter(p=>{const f=t.player.lanes[p],h=f.length>0?f[f.length-1]:null,_=h&&h.isFaceUp&&h.protocol==="Plague"&&h.value===0,y="isFaceDown"in n&&n.isFaceDown&&f.some(m=>m.isFaceUp&&m.protocol==="Metal"&&m.value===2);return!_&&!y}),s.length===0)return{type:"skip"};const d=s.filter(p=>{const f=t.player.laneValues[p],h=t.opponent.laneValues[p],_=t.player.compiled[p],y=t.opponent.compiled[p],m=!_&&f>=10&&f>h,g=h+2>=f;return m&&g&&!y});if(d.length>0)return d.sort((p,f)=>t.player.laneValues[f]-t.player.laneValues[p]),{type:"selectLane",laneIndex:d[0]};const u=s.map(p=>{const f=t.opponent.laneValues[p]-t.player.laneValues[p];return{laneIndex:p,score:-f}});return u.sort((p,f)=>f.score-p.score),{type:"selectLane",laneIndex:u[0].laneIndex}}case"prompt_rearrange_protocols":return Jm(t,n);case"prompt_swap_protocols":{const{target:s}=n,d=t[s].protocols,u=t[s].hand,p=t[s].compiled,f=t[s].laneValues,h=[[0,1],[0,2],[1,2]];let _=[0,1],y=-1/0;for(const m of h){const[g,x]=m,C=[...d];[C[g],C[x]]=[C[x],C[g]];let b=0;const j=p[g],k=p[x],E=f[g],T=f[x];if(s==="opponent"){j&&!k?T<E&&(b+=30):k&&!j&&E<T&&(b+=30);for(const F of u){const U=F.protocol===d[g],D=F.protocol===d[x],I=F.protocol===C[g],W=F.protocol===C[x],z=j?.5:1.5,V=k?.5:1.5;I&&!U&&(b+=dn(F)*z),W&&!D&&(b+=dn(F)*V),!I&&U&&(b-=dn(F)*z),!W&&D&&(b-=dn(F)*V)}}else{j&&!k?E>T&&(b+=25):k&&!j&&T>E&&(b+=25);for(const F of u){const U=F.protocol===d[g],D=F.protocol===d[x],I=F.protocol===C[g],W=F.protocol===C[x],z=j?.5:1.5,V=k?.5:1.5;I&&!U&&(b-=dn(F)*z),W&&!D&&(b-=dn(F)*V),!I&&U&&(b+=dn(F)*z),!W&&D&&(b+=dn(F)*V)}}b>y&&(y=b,_=m)}return{type:"resolveSwapProtocols",indices:_}}case"select_lane_for_shift":{let s=n.validLanes||[0,1,2];if(s=s.filter(d=>!("disallowedLaneIndex"in n)||d!==n.disallowedLaneIndex).filter(d=>!("originalLaneIndex"in n)||d!==n.originalLaneIndex),"sourceCardId"in n){const d=[...t.player.lanes.flat(),...t.opponent.lanes.flat()].find(u=>u.id===n.sourceCardId);if(d&&d.protocol==="Gravity"&&d.value===1){let u=null;for(let p=0;p<3;p++)if([...t.player.lanes[p],...t.opponent.lanes[p]].some(h=>h.id===n.sourceCardId)){u=p;break}u!==null&&"originalLaneIndex"in n&&(n.originalLaneIndex===u||(s=[u]))}if(d&&d.protocol==="Anarchy"&&d.value===1){const u="cardToShiftId"in n?n.cardToShiftId:null;if(u){const p=[...t.player.lanes.flat(),...t.opponent.lanes.flat()].find(f=>f.id===u);p&&(s=s.filter(f=>{const h=t.player.protocols[f],_=t.opponent.protocols[f],y=p.protocol;return y!==h&&y!==_}))}}}if(s.length>0){const d="cardToShiftId"in n?n.cardToShiftId:null;let u=null,p=0;if(d)for(const h of["player","opponent"]){for(const _ of t[h].lanes){const y=_.find(m=>m.id===d);if(y){u=h,p=y.isFaceUp?y.value:2;break}}if(u)break}const f=s.map(h=>{let _=0;const y=t.player.laneValues[h],m=t.opponent.laneValues[h],g=t.player.compiled[h],x=t.opponent.compiled[h];return u==="player"?g?_+=100:m>y?_+=50:y>=6&&y<10&&!g&&(_-=50):u==="opponent"&&(!x&&m<10?m+p>=10?_+=100:m>=6?_+=60:_+=30:x&&(_-=50)),{laneIdx:h,score:_}});if(f.sort((h,_)=>_.score-h.score),nl()&&f.length>1){const h=Math.floor(Math.random()*f.length);return{type:"selectLane",laneIndex:f[h].laneIdx}}return{type:"selectLane",laneIndex:f[0].laneIdx}}return{type:"selectLane",laneIndex:0}}case"select_lane_for_delete_all":{const s="validLanes"in n?n.validLanes:[0,1,2];return s.length>0?{type:"selectLane",laneIndex:s[Math.floor(Math.random()*s.length)]}:{type:"skip"}}case"select_lanes_for_swap_stacks":{const s=n.validLanes,d=n.selectedFirstLane;if(s.length===0)return{type:"skip"};if(d===void 0){const u=s.map(p=>{const f=t.opponent.laneValues[p];return{laneIdx:p,score:f}});return u.sort((p,f)=>p.score-f.score),{type:"selectLane",laneIndex:u[0].laneIdx}}else{const u=s.map(p=>{const f=t.opponent.laneValues[p];return{laneIdx:p,score:f}});return u.sort((p,f)=>f.score-p.score),{type:"selectLane",laneIndex:u[0].laneIdx}}}case"select_card_for_copy_middle":{const s=n.validTargetIds||[];if(s.length===0)return{type:"skip"};const d=s.map(u=>{var f,h;let p=0;for(const _ of["player","opponent"])for(const y of t[_].lanes){const m=y.find(g=>g.id===u);if(m){const x=((f=m.customEffects)==null?void 0:f.middleEffects)||[];for(const C of x){const b=(h=C.params)==null?void 0:h.action;b==="draw"&&(p+=5),b==="flip"&&(p+=3),b==="delete"&&(p+=4),b==="shift"&&(p+=2),b==="discard"&&(p-=2)}}}return{cardId:u,score:p}});return d.sort((u,p)=>p.score-u.score),{type:"selectCard",cardId:d[0].cardId}}case"select_lane_for_return":{const s=n.targetFilter||{},d=n.actor,u=s.valueEquals,p=s.valueRange,f=[];for(let h=0;h<3;h++){let _=0,y=0;const m=oy(t,h);for(const C of["player","opponent"]){if(s.owner==="own"&&C!==d||s.owner==="opponent"&&C===d)continue;const b=t[C].lanes[h];for(let j=0;j<b.length;j++){const k=b[j],E=j===b.length-1;if(s.position==="uncovered"&&!E||s.position==="covered"&&E)continue;const T=k.isFaceUp?k.value:2+m;u!==void 0&&T!==u||p&&(T<p.min||T>p.max)||(C==="player"?_+=T:y+=T)}}const g=_-y,x=`Lane ${h}: Player loses ${_}, we lose ${y}, net=${g}`;f.push({laneIndex:h,score:g,reason:x})}f.sort((h,_)=>_.score-h.score);for(const h of f);return f.length>0?{type:"selectLane",laneIndex:f[0].laneIndex}:{type:"selectLane",laneIndex:0}}case"prompt_optional_effect":{const{effectDef:s}=n,d=(r=s==null?void 0:s.params)==null?void 0:r.action,u=(c=s==null?void 0:s.params)==null?void 0:c.targetFilter;if(d==="give")return{type:"resolveOptionalEffectPrompt",accept:!1};if(d==="flip"){let p=!1;const f=(u==null?void 0:u.position)||"uncovered";for(const h of["player","opponent"])if(!((u==null?void 0:u.owner)==="own"&&h!=="opponent")&&!((u==null?void 0:u.owner)==="opponent"&&h==="opponent")){for(let _=0;_<t[h].lanes.length;_++){const y=t[h].lanes[_];if(y.length!==0){for(let m=0;m<y.length;m++){const g=y[m],x=m===y.length-1,C=!x;if(f==="uncovered"&&!x||f==="covered"&&!C||(u==null?void 0:u.faceState)==="face_up"&&!g.isFaceUp||(u==null?void 0:u.faceState)==="face_down"&&g.isFaceUp)continue;const b=g.isFaceUp?g.value:2,j=g.isFaceUp?2:g.value;if(h==="player"){if(g.isFaceUp&&b>j){p=!0;break}}else{const k=t.opponent.laneValues[_],E=j-b;if(g.isFaceUp&&E>0){p=!0;break}if(!g.isFaceUp&&g.value>2){p=!0;break}if(E>0&&k+E>=10&&!t.opponent.compiled[_]){p=!0;break}}}if(p)break}}if(p)break}return{type:"resolveOptionalEffectPrompt",accept:p}}return{type:"resolveOptionalEffectPrompt",accept:!nl()}}case"select_card_from_other_lanes_to_delete":{const{disallowedLaneIndex:s,lanesSelected:d}=n,u=[];for(let p=0;p<3;p++){if(p===s||d.includes(p))continue;const f=t.player.lanes[p];if(f.length>0){u.push(f[f.length-1]);continue}const h=t.opponent.lanes[p];h.length>0&&u.push(h[h.length-1])}return u.length>0?{type:"deleteCard",cardId:u[0].id}:{type:"skip"}}case"select_face_down_card_to_delete":{const s="disallowedIds"in n&&Array.isArray(n.disallowedIds)?n.disallowedIds:[],d=f=>t[f].lanes.map(h=>h.length>0?h[h.length-1]:null).filter(h=>h!==null),u=d("player").filter(f=>!s.includes(f.id));if(u.length>0)return{type:"deleteCard",cardId:u[0].id};const p=d("opponent").filter(f=>!s.includes(f.id));return p.length>0?{type:"deleteCard",cardId:p[0].id}:{type:"skip"}}case"select_low_value_card_to_delete":{const s=[];for(const u of["player","opponent"])for(const p of t[u].lanes)p.length>0&&s.push(p[p.length-1]);const d=s.filter(u=>u.isFaceUp&&(u.value===0||u.value===1));return d.length>0?{type:"deleteCard",cardId:d[0].id}:{type:"skip"}}case"select_opponent_face_up_card_to_flip":{const d=(u=>t[u].lanes.map(p=>p.length>0?p[p.length-1]:null).filter(p=>p!==null))("player").filter(u=>u.isFaceUp);return d.length>0?(d.sort((u,p)=>p.value-u.value),{type:"flipCard",cardId:d[0].id}):{type:"skip"}}case"select_covered_card_in_line_to_flip_optional":{const s="optional"in n&&n.optional,u=!["select_any_other_card_to_flip","select_any_other_card_to_flip_for_water_0"].includes(n.type);if(n.type==="select_covered_card_in_line_to_flip_optional"){const{laneIndex:m}=n,g=t.opponent.lanes[m],x=t.player.lanes[m],C=g.filter((U,D,I)=>D<I.length-1),b=x.filter((U,D,I)=>D<I.length-1),j=t.opponent.laneValues[m];if(!t.opponent.compiled[m]){let U=null,D=null;for(const I of C){let W,z;I.isFaceUp?(W=I.value,z=2):(W=fn(I,g,t,m,"opponent"),z=I.value);const V=z-W,B=j+V;V>0&&B>=10&&(!U||B>U.newValue)&&(U={card:I,newValue:B,gain:V}),V>0&&(!D||V>D.gain)&&(D={card:I,gain:V,newValue:B})}if(U)return{type:"flipCard",cardId:U.card.id};if(D&&D.gain>0)return{type:"flipCard",cardId:D.card.id}}if(t.opponent.compiled[m]){let U=null;for(const D of C){const I=D.isFaceUp?D.value:fn(D,g,t,m,"opponent"),z=(D.isFaceUp?2:D.value)-I;z>0&&(!U||z>U.gain)&&(U={card:D,gain:z})}if(U)return{type:"flipCard",cardId:U.card.id}}const E=b.filter(U=>U.isFaceUp);if(E.length>0)return E.sort((U,D)=>D.value-U.value),{type:"flipCard",cardId:E[0].id};const T=C.filter(U=>!U.isFaceUp).map(U=>({card:U,gain:U.value-fn(U,g,t,m,"opponent")})).filter(U=>U.gain>0).sort((U,D)=>D.gain-U.gain);if(T.length>0)return{type:"flipCard",cardId:T[0].card.id};const F=b.filter(U=>!U.isFaceUp);return F.length>0?{type:"flipCard",cardId:F[0].id}:{type:"skip"}}const p=m=>t[m].lanes.map(g=>g.length>0?g[g.length-1]:null).filter(g=>g!==null),f=p("player"),h=p("opponent");{const m=f.filter(g=>g.isFaceUp).sort((g,x)=>x.value-g.value);if(m.length>0)return{type:"flipCard",cardId:m[0].id}}const _=h.filter(m=>!m.isFaceUp);if(_.length>0)return{type:"flipCard",cardId:_[0].id};const y=f.filter(m=>!m.isFaceUp);if(y.length>0)return{type:"flipCard",cardId:y[0].id};{const m=h.filter(x=>!(!x.isFaceUp||!u&&x.id===n.sourceCardId)),g=m.filter(x=>{const C=t.opponent.lanes.findIndex(b=>b.length>0&&b[b.length-1].id===x.id);return C!==-1&&t.opponent.compiled[C]});if(g.length>0&&!s)return{type:"flipCard",cardId:g[0].id};if(m.length>0&&!s)return{type:"flipCard",cardId:m[0].id}}return{type:"skip"}}case"shift_flipped_card_optional":{const s=n.cardId,d=n.optional,u=Te(t,s);if(!u)return{type:"skip"};const p=u.card,f=u.owner,h=p.isFaceUp?p.value:2;let _=u.laneIndex??-1;if(_===-1){const F=t[f];for(let U=0;U<F.lanes.length;U++)if(F.lanes[U].some(D=>D.id===s)){_=U;break}}if(_===-1)return{type:"skip"};const y=[0,1,2].filter(F=>F!==_);if(y.length===0)return{type:"skip"};const m=t.opponent,g=t.player,x=m.laneValues[_],C=m.compiled[_],b=g.laneValues[_],j=x-h;let k=-1,E=-1/0;const T=0;for(const F of y){const U=m.laneValues[F],D=m.compiled[F],I=g.laneValues[F],W=U+h;let z=0;!C&&x>=8&&x>b&&(z-=100),!D&&W>=10&&W>I&&(z+=80),!D&&U<x&&(C||x<6)&&(z+=20),D&&(z-=30),!D&&U<=I&&W>I&&(z+=25),!C&&x>b&&j<=b&&(z-=40),z>E&&(E=z,k=F)}return d&&E<T?{type:"skip"}:k!==-1?{type:"selectLane",laneIndex:k}:d?{type:"skip"}:{type:"selectLane",laneIndex:y[0]}}case"select_lane_to_shift_revealed_card_for_light_2":case"select_lane_to_shift_revealed_card":{const s=n.revealedCardId,d=Te(t,s);if(!d)return{type:"selectLane",laneIndex:0};let u=-1;for(let f=0;f<t[d.owner].lanes.length;f++)if(t[d.owner].lanes[f].some(h=>h.id===s)){u=f;break}const p=[0,1,2].filter(f=>f!==u);return p.length>0?(d.owner==="opponent"?p.sort((f,h)=>{const _=t.opponent.laneValues[f],y=t.opponent.laneValues[h];return!t.opponent.compiled[f]&&t.opponent.compiled[h]?-1:t.opponent.compiled[f]&&!t.opponent.compiled[h]?1:y-_}):p.sort((f,h)=>t.player.laneValues[f]-t.player.laneValues[h]),{type:"selectLane",laneIndex:p[0]}):{type:"selectLane",laneIndex:0}}case"select_opponent_face_down_card_to_shift":{const s=[];for(const d of t.player.lanes)if(d.length>0){const u=d[d.length-1];u.isFaceUp||s.push(u)}return s.length>0?{type:"deleteCard",cardId:s[Math.floor(Math.random()*s.length)].id}:{type:"skip"}}case"select_opponent_covered_card_to_shift":{const s=[];for(const d of t.player.lanes)for(let u=0;u<d.length-1;u++)s.push(d[u]);return s.length>0?{type:"deleteCard",cardId:s[Math.floor(Math.random()*s.length)].id}:{type:"skip"}}case"select_own_covered_card_to_shift":{const s=[];for(const d of t.opponent.lanes)for(let u=0;u<d.length-1;u++)s.push(d[u]);return s.length>0?{type:"deleteCard",cardId:s[Math.floor(Math.random()*s.length)].id}:{type:"skip"}}case"select_card_to_flip":{const s=n.targetFilter||{},d=n.restrictedLaneIndex??n.currentLaneIndex??n.laneIndex,u=n.scope,p=n.actor,f=n.sourceCardId,h=[];for(const y of["player","opponent"])if(!(s.owner==="own"&&y!==p)&&!(s.owner==="opponent"&&y===p))for(let m=0;m<t[y].lanes.length;m++){if(d!==void 0&&m!==d||u==="this_lane"&&d!==void 0&&m!==d)continue;const g=t[y].lanes[m];for(let x=0;x<g.length;x++){const C=g[x];if(Wo(t,C.id))continue;const b=Qo(t,g,x);if(el(C,b,s,f)&&!(s.position==="covered_in_this_line"&&b)){if(s.valueMinGreaterThanHandSize){const j=t[p].hand.length;if(C.value<=j)continue}if(s.valueLessThanUniqueProtocolsOnField){const j=vr(t);if(C.value>=j)continue}h.push({card:C,owner:y,laneIndex:m})}}}if(h.length===0)return{type:"skip"};const _=h.map(({card:y,owner:m,laneIndex:g})=>{let x=0;const C=t[m].laneValues[g],b=t[m].compiled[g],j=y.isFaceUp?y.value:2,E=(y.isFaceUp?2:y.value)-j;return m==="player"?y.isFaceUp?(x=-E*15,x+=Jr(y,"player",t)):y.value<=1?x=20:x=-30:y.isFaceUp?E>0?(x=E*20+50,!b&&C+E>=10&&(x+=200)):x=E*15-30:E>0?(x=E*20+40,!b&&C+E>=10&&(x+=200)):x=-10,{card:y,score:x}});if(_.sort((y,m)=>m.score-y.score),nl()&&_.length>1){const y=Math.floor(Math.random()*_.length);return{type:"flipCard",cardId:_[y].card.id}}return{type:"flipCard",cardId:_[0].card.id}}case"select_card_to_shift":{const s=n.targetFilter||{},u=n.scope==="this_lane"?n.sourceLaneIndex??n.currentLaneIndex??n.laneIndex:void 0,p=n.actor,f=n.sourceCardId,h=[];for(const _ of["player","opponent"])if(!(s.owner==="own"&&_!==p)&&!(s.owner==="opponent"&&_===p))for(let y=0;y<t[_].lanes.length;y++){if(u!==void 0&&y!==u)continue;const m=t[_].lanes[y];for(let g=0;g<m.length;g++){const x=m[g],C=g===m.length-1;el(x,C,s,f)&&h.push(x)}}return h.length>0?{type:"shiftCard",cardId:h[Math.floor(Math.random()*h.length)].id}:{type:"skip"}}case"select_board_card_to_reveal_custom":{const s=[];for(const d of["player","opponent"])for(const u of t[d].lanes)if(u.length>0){const p=u[u.length-1];p.isFaceUp||s.push({card:p,owner:d})}if(s.length>0){const d=s.filter(u=>u.owner==="player");return d.length>0?{type:"deleteCard",cardId:d[0].card.id}:{type:"deleteCard",cardId:s[0].card.id}}return{type:"skip"}}case"prompt_shift_or_flip_board_card_custom":{const{revealedCardId:s}=n,d=Te(t,s);return d?d.owner==="opponent"?{type:"resolveRevealBoardCardPrompt",choice:"flip"}:{type:"resolveRevealBoardCardPrompt",choice:"shift"}:{type:"resolveRevealBoardCardPrompt",choice:"skip"}}case"select_lane_to_shift_revealed_board_card_custom":{const s=[0,1,2];return s.sort((d,u)=>t.player.laneValues[d]-t.player.laneValues[u]),{type:"selectLane",laneIndex:s[0]}}case"gravity_2_shift_after_flip":{const{targetLaneIndex:s}=n;return{type:"selectLane",laneIndex:s}}case"flip_self":case"flip_self_for_water_0":case"flip_self_for_psychic_4":case"speed_3_self_flip_after_shift":return n.sourceCardId?{type:"flipCard",cardId:n.sourceCardId}:{type:"skip"};case"anarchy_0_conditional_draw":return{type:"skip"};case"select_any_opponent_card_to_shift":{const s=t.player.lanes.map(d=>d.length>0?d[d.length-1]:null).filter(d=>d!==null);return s.length>0?{type:"deleteCard",cardId:s[Math.floor(Math.random()*s.length)].id}:{type:"skip"}}case"select_own_other_card_to_shift":{const s=t.opponent.lanes.flat().find(d=>d.id!==n.sourceCardId);return s?{type:"deleteCard",cardId:s.id}:{type:"skip"}}case"select_own_face_up_covered_card_to_flip":return{type:"skip"};case"plague_4_opponent_delete":{const s=[];return t.opponent.lanes.forEach(d=>{if(d.length>0){const u=d[d.length-1];u.isFaceUp||s.push(u)}}),s.length>0?(s.sort((d,u)=>d.value-u.value),{type:"deleteCard",cardId:s[0].id}):{type:"skip"}}case"reveal_opponent_hand":case"plague_2_player_discard":case"delete_self":return{type:"skip"};case"select_card_from_trash_to_play":{const s=t.opponent.discard;return s.length===0?{type:"skip"}:{type:"selectTrashCard",cardIndex:[...s].map((u,p)=>{var h,_,y;let f=u.value*10;for(let m=0;m<3;m++){if(t.opponent.compiled[m])continue;const g=t.opponent.laneValues[m]+u.value;g>=10&&g>t.player.laneValues[m]&&(f+=100)}return(h=u.keywords)!=null&&h.flip&&(f+=5),(_=u.keywords)!=null&&_.draw&&(f+=3),(y=u.keywords)!=null&&y.delete&&(f+=5),{card:u,index:p,score:f}}).sort((u,p)=>p.score-u.score)[0].index}}case"select_card_from_trash_to_reveal":{const s=t.opponent.discard;return s.length===0?{type:"skip"}:{type:"selectTrashCard",cardIndex:[...s].map((u,p)=>({card:u,index:p,value:u.value})).sort((u,p)=>p.value-u.value)[0].index}}case"select_lane_for_delete":{const s=n.validLanes||[0,1,2],d=n.valueFilter,u=s.map(p=>{let f=0,h=0;for(const _ of t.player.lanes[p]){const y=_.isFaceUp?_.value:2;d?_.isFaceUp?_.value>=d.min&&_.value<=d.max&&(f+=y+1):f+=(y+1)*.5:f+=y+1}for(const _ of t.opponent.lanes[p]){const y=_.isFaceUp?_.value:2;d?_.isFaceUp?_.value>=d.min&&_.value<=d.max&&(h+=y+3):h+=(y+3)*.5:h+=y+3}return{laneIndex:p,score:f-h}});return u.sort((p,f)=>f.score-p.score),u[0].score>0?{type:"selectLane",laneIndex:u[0].laneIndex}:{type:"selectLane",laneIndex:u[0].laneIndex}}case"select_lane_for_shift_all":{const s=n.validDestinationLanes||n.validLanes||[0,1,2],d=n.sourceLaneIndex,u=s.filter(p=>p!==d);if(u.length>0){const p=u.map(f=>{let h=0;return h+=t.opponent.lanes[f].length*2,h+=t.opponent.laneValues[f],t.player.laneValues[f]>=8&&(h-=5),{laneIndex:f,score:h}});return p.sort((f,h)=>h.score-f.score),{type:"selectLane",laneIndex:p[0].laneIndex}}return s.length>0?{type:"selectLane",laneIndex:s[0]}:{type:"selectLane",laneIndex:0}}case"prompt_optional_draw":return{type:"resolveOptionalEffectPrompt",accept:!0};case"prompt_optional_discard_custom":return{type:"resolveOptionalEffectPrompt",accept:t.opponent.hand.length>4};case"prompt_optional_shuffle_trash":return{type:"resolvePrompt",accept:(n.trashCount||0)>0};case"select_card_from_revealed_deck":{const s=n.selectableCardIds||[];if(s.length>0){const d=Math.floor(Math.random()*s.length);return{type:"selectRevealedDeckCard",cardId:s[d]}}return{type:"resolvePrompt",accept:!1}}case"custom_choice":{const{options:s}=n;if(!s||s.length!==2)return{type:"resolveCustomChoice",optionIndex:0};const d=f=>{var y,m,g;let h=0;const _=((y=f.action)==null?void 0:y.toLowerCase())||"";return _.includes("draw")&&(h+=30),_.includes("discard")&&(h-=20),_.includes("delete")&&((m=f.targetFilter)==null?void 0:m.owner)==="opponent"&&(h+=40),_.includes("delete")&&((g=f.targetFilter)==null?void 0:g.owner)==="own"&&(h-=30),h},u=d(s[0]),p=d(s[1]);return{type:"resolveCustomChoice",optionIndex:u>=p?0:1}}case"select_phase_effect":{const s=n;if(s.availableEffects.length===0)return{type:"skip"};const d=s.availableEffects.map(p=>{let f=0;const h=p.effectDescription.toLowerCase();return h.includes("draw")?f+=100:h.includes("delete")?f+=80:h.includes("shift")?f+=60:h.includes("flip")?f+=40:f+=20,Math.random()<.05&&(f=Math.random()*50),{effect:p,score:f}});return d.sort((p,f)=>f.score-p.score),{type:"flipCard",cardId:d[0].effect.cardId}}case"state_number":{const s={0:0,1:0,2:0,3:0,4:0,5:0};t.opponent.hand.forEach(p=>{p.value>=0&&p.value<=5&&s[p.value]++}),s[2]+=2,s[3]+=2;let d=0,u=s[0];for(let p=1;p<=5;p++)s[p]>u&&(u=s[p],d=p);return Math.random()<.05&&(d=Math.floor(Math.random()*6)),{type:"stateNumber",number:d}}case"state_protocol":{const d=n.availableProtocols||[];if(d.length===0)return{type:"skip"};const u=t.player.protocols,p=d.map(f=>{let h=0;return u.includes(f)&&(h+=50),h+=Math.random()*20,{protocol:f,score:h}});return p.sort((f,h)=>h.score-f.score),{type:"stateProtocol",protocol:p[0].protocol}}case"select_from_drawn_to_reveal":{const d=n.eligibleCardIds||[];if(d.length===0)return{type:"skip"};const u=t.opponent.hand,p=d.map(f=>{const h=u.find(y=>y.id===f);if(!h)return{cardId:f,score:0};let _=h.value;return t.opponent.protocols.includes(h.protocol)&&(_+=10),{cardId:f,score:_}});return p.sort((f,h)=>h.score-f.score),{type:"selectFromDrawnToReveal",cardId:p[0].cardId}}case"confirm_deck_discard":return{type:"confirmDeckDiscard"};case"confirm_deck_play_preview":return{type:"confirmDeckPlayPreview"};default:{if("optional"in n&&n.optional)return{type:"skip"};const s=[...t.player.lanes.flat(),...t.opponent.lanes.flat()];return s.length>0&&(n.type.includes("select_")||n.type.includes("shift"))?{type:"deleteCard",cardId:s[0].id}:{type:"skip"}}}},ux=(t,n)=>n?dx(t,n):t.phase==="compile"&&t.compilableLanes.length>0?{type:"compile",laneIndex:t.compilableLanes.reduce((c,s)=>t.opponent.laneValues[s]>t.opponent.laneValues[c]?s:c)}:t.phase==="action"?ix(t):{type:"fillHand"};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * GameStateAnalyzer - Analyzes the current game state to recommend strategies
 *
 * This module provides deep analysis of the game state to help the AI make
 * intelligent decisions based on the current situation rather than just card values.
 */function px(t){const n=t.player.lanes.flat().length,r=t.opponent.lanes.flat().length;return n+r}function Dc(t,n){return t[n].compiled.filter(r=>r).length}function fx(t){const n=px(t),r=Dc(t,"player"),c=Dc(t,"opponent"),s=r+c;return r===2||c===2?"endgame":s>=2?"late":n<=4?"early":"mid"}function hx(t,n,r,c=3.5){if(r)return-1;const s=Math.max(10-t,n-t+1);return s<=0?0:Math.ceil(s/c)}function mx(t){const n=[];for(let r=0;r<3;r++){const c=t.opponent.laneValues[r],s=t.player.laneValues[r],d=t.opponent.compiled[r],u=t.player.compiled[r];n.push({laneIndex:r,ourValue:c,playerValue:s,weAreLeading:c>s,playerIsLeading:s>c,isTied:c===s,ourDistanceToCompile:d?-1:Math.max(10-c,s-c+1),playerDistanceToCompile:u?-1:Math.max(10-s,c-s+1),ourProtocol:t.opponent.protocols[r],playerProtocol:t.player.protocols[r],isCompiled:d,playerLaneCompiled:u})}return n}function yx(t,n){const r=[],c=[];for(const d of n)d.playerLaneCompiled||(d.playerValue>=10&&d.playerValue>d.ourValue?r.push(d.laneIndex):d.playerValue>=8&&d.playerValue<10&&c.push(d.laneIndex));let s=1/0;for(const d of n){if(d.playerLaneCompiled)continue;const u=hx(d.playerValue,d.ourValue,d.playerLaneCompiled);u>=0&&u<s&&(s=u)}return{playerCanCompile:r.length>0,playerCompileLanes:r,playerNearCompileLanes:c,turnsUntilPlayerCompile:s===1/0?99:s,playerHasControl:t.controlCardHolder==="player",playerCompiledCount:Dc(t,"player")}}function gx(t,n){const r=n.map(f=>f.ourValue),c=n.filter(f=>f.weAreLeading&&!f.isCompiled).length,s=t.controlCardHolder==="opponent";let d=-1,u=1/0;for(const f of n)f.isCompiled||f.ourDistanceToCompile>=0&&f.ourDistanceToCompile<u&&(u=f.ourDistanceToCompile,d=f.laneIndex);const p=!s&&c>=1;return{ourCompileProgress:r,closestLane:d,closestLaneDistance:u===1/0?99:u,weHaveControl:s,lanesWeLeadIn:c,canGetControlThisTurn:p,ourCompiledCount:Dc(t,"opponent")}}function vx(t,n,r){let c=0;switch(t.playerCanCompile&&(c+=80),c+=t.playerNearCompileLanes.length*20,r){case"endgame":c+=30;break;case"late":c+=15;break;case"mid":c+=5;break}return t.playerCompiledCount>n.ourCompiledCount&&(c+=20),t.playerHasControl&&(c+=15,t.playerCompiledCount>=1&&(c+=30)),Math.min(100,c)}function _x(t,n,r,c){if(n.playerCanCompile){for(const s of n.playerCompileLanes){const d=c[s];if(d.playerValue-d.ourValue<=6)return"defend"}return r.closestLaneDistance<=3?"rush":"disrupt"}if(n.playerHasControl&&n.playerCompiledCount>=1)return"control";if(t==="endgame"){if(r.ourCompiledCount===2)return"rush";if(n.playerCompiledCount===2)return n.playerNearCompileLanes.length>0?"defend":"disrupt"}if(n.playerCompiledCount>=1){if(!r.weHaveControl&&r.canGetControlThisTurn)return"control";if(n.playerNearCompileLanes.length>0)return r.lanesWeLeadIn>=1?"control":"disrupt"}if(r.closestLaneDistance<=4)return"rush";if(t==="early"||t==="mid"){if(r.closestLaneDistance<=6)return"rush";if(n.turnsUntilPlayerCompile<3)return"disrupt"}return"rush"}function ry(t){const n=mx(t),r=fx(t),c=yx(t,n),s=gx(t,n),d=vx(c,s,r),u=_x(r,c,s,n);return{gamePhase:r,threats:c,position:s,lanes:n,recommendedStrategy:u,urgency:d}}function wx(t,n){const r=n.lanes[t],{recommendedStrategy:c}=n;if(r.isCompiled)return{isGood:!1,reason:"Already compiled",score:-1e3};switch(c){case"rush":{const s=100-r.ourDistanceToCompile*10;return{isGood:r.ourDistanceToCompile<=6,reason:`Distance to compile: ${r.ourDistanceToCompile}`,score:s}}case"control":{if(r.weAreLeading)return{isGood:!1,reason:"Already leading - need other lanes for control",score:-50};const s=r.playerValue-r.ourValue,d=100-s*15;return{isGood:s<=4,reason:`Gap to lead: ${s}`,score:d}}case"disrupt":{if(r.playerLaneCompiled)return{isGood:!1,reason:"Player already compiled",score:-100};const s=r.playerValue*10;return{isGood:r.playerValue>=5,reason:`Player value: ${r.playerValue}`,score:s}}case"defend":return n.threats.playerCompileLanes.includes(t)?{isGood:!0,reason:"BLOCKING COMPILE THREAT",score:200}:{isGood:!1,reason:"Not a threat lane",score:0}}}function xx(t){const n=[];for(let r=0;r<3;r++){const c=wx(r,t);c.score>-100&&n.push({laneIndex:r,score:c.score,reason:c.reason})}return n.sort((r,c)=>c.score-r.score),n}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * EffectEvaluator - Evaluates card effects in context
 *
 * This module provides intelligent evaluation of card effects based on
 * the current game state and strategy, not just raw card values.
 *
 * KEY INSIGHT: A flip effect on a 6-value card is GREAT (reduces by 4),
 * but on a 0-value card is TERRIBLE (increases by 2)!
 *
 * NEW: Uses AI Card Memory to remember face-down card values for smarter decisions.
 */function Cu(t,n){for(const r of["player","opponent"])for(let c=0;c<t[r].lanes.length;c++)if(t[r].lanes[c].some(s=>s.id===n))return c;return-1}function ds(t,n){const r=[];for(const c of t[n].lanes)c.length>0&&r.push(c[c.length-1]);return r}function ly(t){const n=t.keywords;return n.delete||n.return||n.discard||t.top.length>0||t.bottom.includes("Start:")||t.bottom.includes("End:")}function Cx(t,n,r,c){const s=[],d=r||{};for(const u of["player","opponent"]){if(d.owner==="own"&&u!=="opponent"||d.owner==="opponent"&&u!=="player")continue;const p=ds(t,u);for(const f of p){if(c&&f.id===c||d.faceState==="face_up"&&!f.isFaceUp||d.faceState==="face_down"&&f.isFaceUp)continue;const h=Cu(t,f.id);let _=0,y="";if(u==="player")if(f.isFaceUp){const m=f.value-2;_=m*25,m>0?y=`Flip ${f.protocol}-${f.value}: Enemy loses ${m} value`:m<0?y=`BAD: Flip ${f.protocol}-${f.value}: Enemy GAINS ${-m} value!`:y=`Neutral: Flip ${f.protocol}-${f.value}: No value change`;const g=n.lanes[h];g&&g.playerValue>=8&&(_+=40,y+=" [Near compile!]"),ly(f)&&(_+=30,y+=" [Has dangerous effects]")}else{const m=mm(t,f.id);if(m!==null){const g=m-2;g>0?(_=-g*20,y=`BAD: KNOWN card ${f.protocol}-${m}: Enemy gains ${g}!`):g<0?(_=-g*20,y=`GOOD: KNOWN card ${f.protocol}-${m}: Enemy loses ${-g}`):(_=10,y=`Neutral: KNOWN card ${f.protocol}-${m}: No change`)}else _=5,y="Reveal UNKNOWN enemy card (risky - might help them)"}else if(f.isFaceUp){const m=f.value-2;_=-m*30,y=`BAD: Flip own ${f.protocol}-${f.value}: We lose ${m} value`}else{const m=mm(t,f.id),g=m!==null?m:f.value,x=g-2;x>0?(_=x*25+20,y=`Flip own card: Gain ${x} value (${g} - 2)`):x<0?(_=x*20,y=`BAD: Flip own card: LOSE ${-x} value`):(_=5,y="Neutral: Flip own card: No value change");const C=n.lanes[h];if(C&&!C.isCompiled){const b=C.ourValue-2+g;b>=10&&b>C.playerValue?(_+=150,y+=" [ENABLES COMPILE!]"):C.ourDistanceToCompile<=4&&(_+=30,y+=" [Near compile]")}}s.push({targetId:f.id,targetOwner:u,laneIndex:h,score:_,reasoning:y})}}return s.sort((u,p)=>p.score-u.score),s}function Tm(t,n,r,c){const s=[],d=r||{};for(const u of["player","opponent"]){if(d.owner==="own"&&u!=="opponent"||d.owner==="opponent"&&u!=="player")continue;const p=ds(t,u);for(const f of p){if(c&&f.id===c||d.faceState==="face_up"&&!f.isFaceUp||d.faceState==="face_down"&&f.isFaceUp)continue;const h=Cu(t,f.id),_=f.isFaceUp?f.value:2;let y=0,m="";if(u==="player"){y=_*25,m=`Delete ${f.isFaceUp?f.protocol+"-"+f.value:"face-down"}: Remove ${_} value`;const g=n.lanes[h];g&&(g.playerValue>=10&&g.playerValue>g.ourValue?(y+=100,m+=" [BLOCKS COMPILE!]"):g.playerValue>=8&&(y+=50,m+=" [Near compile]")),f.isFaceUp&&ly(f)&&(y+=40,m+=" [Has dangerous effects]")}else{y=-_*30,m=`BAD: Delete own ${f.isFaceUp?f.protocol+"-"+f.value:"face-down"}: Lose ${_} value`;const g=n.lanes[h];g&&g.isCompiled&&(y+=50,m+=" [Lane already compiled]")}s.push({targetId:f.id,targetOwner:u,laneIndex:h,score:y,reasoning:m})}}return s.sort((u,p)=>p.score-u.score),s}function Sx(t,n,r,c){const s=[],d=r||{};for(const u of["player","opponent"]){if(d.owner==="own"&&u!=="opponent"||d.owner==="opponent"&&u!=="player")continue;const p=ds(t,u);for(const f of p){if(c&&f.id===c)continue;const h=Cu(t,f.id),_=f.isFaceUp?f.value:2;let y=0,m="";if(u==="player"){y=_*20,m=`Return ${f.isFaceUp?f.protocol+"-"+f.value:"face-down"}: Remove ${_} value (to hand)`;const g=n.lanes[h];g&&(g.playerValue>=10&&g.playerValue>g.ourValue?(y+=80,m+=" [BLOCKS COMPILE!]"):g.playerValue>=8&&(y+=40,m+=" [Near compile]")),y+=15,m+=" [Tempo gain]"}else y=-_*20,m=`Return own ${f.isFaceUp?f.protocol+"-"+f.value:"face-down"}: Lose ${_} value (recoverable)`;s.push({targetId:f.id,targetOwner:u,laneIndex:h,score:y,reasoning:m})}}return s.sort((u,p)=>p.score-u.score),s}function bx(t,n,r,c,s){var _,y,m,g,x,C;const d=(_=t.params)==null?void 0:_.action,u=(y=t.params)==null?void 0:y.targetFilter,p=(u==null?void 0:u.owner)||"any",f=ds(n,"player"),h=ds(n,"opponent");switch(d){case"flip":return Ex(p,f,h);case"delete":return jx(p,f,h,n);case"draw":return kx(((m=t.params)==null?void 0:m.count)||1,n);case"shift":return Nx(p,f,h,n);case"return":return Tx(p,f,h,n);case"discard":return((g=t.params)==null?void 0:g.actor)==="opponent"?(((x=t.params)==null?void 0:x.count)||1)*15:-(((C=t.params)==null?void 0:C.count)||1)*10;case"value_modifier":return 10;default:return 0}}function Ex(t,n,r,c,s){if(t==="opponent"){if(n.length===0)return 0;const d=n.filter(u=>u.isFaceUp);return d.length>0?(d.sort((f,h)=>h.value-f.value)[0].value-2)*12:5}if(t==="own")return r.length===0?0:r.filter(u=>u.isFaceUp&&u.value<=1).length>0?15:-25;if(n.length>0){const d=n.filter(u=>u.isFaceUp&&u.value>=3);return d.length>0?(Math.max(...d.map(p=>p.value))-2)*10:5}return r.length>0?r.filter(u=>u.isFaceUp&&u.value===0).length>0?10:-30:0}function jx(t,n,r,c,s){if(t==="opponent"){if(n.length===0)return 0;let d=40;for(let u=0;u<3;u++)c.player.laneValues[u]>=10&&!c.player.compiled[u]?c.player.lanes[u].filter(f=>n.some(h=>h.id===f.id)).length>0&&(d=80):c.player.laneValues[u]>=8&&(d=Math.max(d,60));return d}if(t==="own")return r.length===0?0:-Math.min(...r.map(u=>u.isFaceUp?u.value:2))*8-20;if(n.length>0){let d=35;for(let u=0;u<3;u++)c.player.laneValues[u]>=8&&(d=Math.max(d,50));return d}return r.length>0?-Math.min(...r.map(u=>u.isFaceUp?u.value:2))*10-40:0}function kx(t,n){const c=n.opponent.hand.length-1,s=c+t;if(s>5){const d=s-5;return t*10-d*8}return c<=2?t*20:t*12}function Nx(t,n,r,c,s){if(t==="opponent"){if(n.length===0)return 0;for(let d=0;d<3;d++)if(c.player.laneValues[d]>=8)return 35;return 20}if(t==="own"){if(r.length===0)return 0;for(let d=0;d<3;d++)if(!c.opponent.compiled[d]&&c.opponent.laneValues[d]>=6)return 25;return 5}return n.length>0?15:0}function Tx(t,n,r,c,s){if(t==="opponent"){if(n.length===0)return 0;for(let d=0;d<3;d++)if(c.player.laneValues[d]>=8)return 40;return 25}return t==="own"?r.length===0?0:-20:n.length>0?20:r.length>0?-25:0}function Rx(t,n,r,c){const s=t;if(!s.customEffects)return 0;let d=0;const u=[...s.customEffects.topEffects||[],...s.customEffects.middleEffects||[],...s.customEffects.bottomEffects||[]],p=["start","instant","on_play",void 0];for(const f of u){const h=f.trigger;if(h&&!p.includes(h))continue;const _=bx(f,n);d+=_}return d}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * NORMAL AI - Strategic AI that plays to win
 *
 * NEW ARCHITECTURE:
 * - Uses GameStateAnalyzer to understand the current situation
 * - Uses EffectEvaluator to score card effects contextually
 * - Uses Strategies to make decisions based on game phase
 * - 5% chance to make suboptimal moves for slight unpredictability
 */const pl=["delete","flip","shift","return","discard"],un=t=>{let n=12-t.value;return pl.some(r=>t.keywords[r])&&(n+=6),t.keywords.draw&&(n+=3),t.keywords.play&&(n+=8),t.keywords.prevent&&(n+=4),n},Xd=(t,n,r)=>{let c;for(const d of r[n].lanes)if(d.some(u=>u.id===t.id)){c=d;break}if(!c)return 0;if(!t.isFaceUp)return c.some(u=>u.isFaceUp&&u.protocol==="Darkness"&&u.value===2)?4:2;let s=t.value*2.5;return t.top.length>0&&(s+=6),(t.bottom.includes("Start:")||t.bottom.includes("End:"))&&(s+=8),t.bottom.includes("covered:")&&(s+=5),pl.some(d=>t.keywords[d])&&(s+=4),s},al=()=>Math.random()<.05,Zd=t=>t+(Math.random()*4-2),tl=(t,n,r,c)=>{const s=r.position||"uncovered";return!(s==="uncovered"&&!n||s==="covered"&&n||r.faceState==="face_up"&&!t.isFaceUp||r.faceState==="face_down"&&t.isFaceUp||r.excludeSelf&&c&&t.id===c||r.valueRange&&(!t.isFaceUp||t.value<r.valueRange.min||t.value>r.valueRange.max)||r.valueEquals!==void 0&&(!t.isFaceUp||t.value!==r.valueEquals))},Dx=t=>{var B,L,P,M;t=vw(t);const n=[],r=ry(t),{gamePhase:c,threats:s,position:d,lanes:u,recommendedStrategy:p}=r,f=ey(t,"opponent");t.player.lanes.flat().length+t.opponent.lanes.flat().length;const h=c==="early",_=c==="mid",m=t.player.lanes.flat().length>0,g=s.playerCompiledCount,x=d.weHaveControl;s.playerHasControl;const C=d.lanesWeLeadIn;3-C-u.filter(N=>N.isTied&&!N.isCompiled).length;const b=t.useControlMechanic===!0,j=p==="control"&&b;s.playerCanCompile,s.playerCompileLanes[0],d.ourCompiledCount;const k=g===2,F=j||k&&b&&!x,U=xx(r),D=U.length>0?U[0].laneIndex:-1,I=(N,R)=>N.keywords.flip||N.keywords.delete||N.keywords.shift||N.keywords.return?t.player.lanes.flat().length>0||t.opponent.lanes.some((G,q)=>q!==R&&G.length>0)||t.opponent.lanes[R].length>0:!0,W=N=>N.keywords.draw?t.opponent.hand.length>=5:!1;for(const N of t.opponent.hand)for(let R=0;R<3;R++){const $=yr(t,"opponent",R,!0,N.protocol),X=yr(t,"opponent",R,!1,N.protocol);if(!$.allowed&&!X.allowed||t.opponent.compiled[R])continue;const G=t.player.laneValues[R]>=10&&t.player.laneValues[R]>t.opponent.laneValues[R]&&!t.player.compiled[R];if(G){const ee=Math.max($.allowed?N.value:0,X.allowed?fn({...N,isFaceUp:!1},t.opponent.lanes[R]):0);if(t.opponent.laneValues[R]+ee<t.player.laneValues[R]&&!pl.some(_e=>N.keywords[_e]))continue}let q=!1;if(ny(N)){let ee=0;for(let se=0;se<3;se++)if(t.opponent.lanes[se].length>0){if(se===R)continue;ee++}ee===0&&(q=!0)}if(xu(N)){const ee=t.opponent.laneValues[R],se=Math.max(0,10-N.value);if(ee<se)continue;const _e=ee+N.value,fe=t.player.laneValues[R];if(_e<=fe)continue}const Q=ty(t,"opponent",R);if(Q!==null){const ee=t.opponent.laneValues[R],se=ee+N.value-Q,_e=se>=10&&se>t.player.laneValues[R],fe=ee-Q>=4;if(!_e&&!fe)continue}const K=G;let Z=!1;if(ay(N)){let ee=0;for(let se=0;se<3;se++){const _e=t.opponent.lanes[se];if(_e.length>0&&se!==R){const fe=_e[_e.length-1],be=fe.isFaceUp?fe.value:2;be>ee&&(ee=be)}}N.value>=ee&&(Z=!0)}let te=$.allowed&&!f&&!Z&&!q;if(te){let ee=0,se=`Play ${N.protocol}-${N.value} face-up in lane ${R}`;const _e=N.value,fe=t.opponent.laneValues[R]+_e;if(K)fe>t.player.laneValues[R]?(ee=180+fe*5,se+=" [Blocks compile!]"):fe===t.player.laneValues[R]?(ee=160+fe*3,se+=" [Blocks compile with tie!]"):(ee=-500,se+=" [WASTE: Card goes to trash when player compiles!]");else{ee+=_e*10;const oe=t.player.lanes.flat().length+t.opponent.lanes.flat().length;if(oe===0&&_e>=4?(ee+=50,se+=` [STRONG OPENING: ${_e}]`):oe<=2&&_e>=5&&(ee+=30,se+=` [Early pressure: ${_e}]`),fe>=10&&fe>t.player.laneValues[R]&&!t.opponent.compiled[R])ee+=200,se+=` [COMPILE: ${fe}]`;else if(fe>=8&&fe<10&&!t.opponent.compiled[R]){const ne=t.opponent.lanes[R].some(ie=>ie.isFaceUp&&ie.protocol==="Darkness"&&ie.value===2)?4:2;t.opponent.laneValues[R]+ne>=10&&fe<10?(ee-=50,se+=` [Near ${fe} but face-down could compile!]`):(ee+=40,se+=` [Near compile: ${fe}]`)}h&&_e<=2&&(ee-=50,se+=" [Low value early game penalty]"),I(N,R)||(ee-=80,se+=" [No valid targets for effect]"),W(N)&&(ee-=30,se+=" [Draw would cause discard]");const H=pl.some(ne=>N.keywords[ne]);if(H&&m?_&&t.player.laneValues[R]>=5?(ee+=35,se+=" [Disruption with targets]"):t.player.laneValues[R]>=8&&(ee+=50,se+=" [Disruption near compile]"):H&&!m&&(ee-=40,se+=" [Disruption but no targets]"),D!==-1&&!F&&(R===D?(ee+=150,se+=" [FOCUS LANE]"):(ee-=100,se+=" [Not focus lane]")),F){const ne=t.opponent.laneValues[R]>t.player.laneValues[R],J=fe>t.player.laneValues[R],ie=t.opponent.laneValues[R]===t.player.laneValues[R],de=k?1.5:1;if(ne)ee-=200*de,se+=k?" [CRITICAL: ALREADY LEADING - FOCUS ELSEWHERE!]":" [ALREADY LEADING - DON'T WASTE!]";else if(!ne&&J)C===1?(ee+=500*de,se+=k?" [CRITICAL: CONTROL CAPTURE WINS GAME!]":" [CONTROL CAPTURE! 1->2 leads]"):C===0?(ee+=300*de,se+=k?" [CRITICAL: First lead toward control!]":" [First lead! 0->1 leads]"):(ee+=100,se+=" [Extra lead]");else if(ie&&J)C===1?(ee+=450*de,se+=k?" [CRITICAL: BREAK TIE FOR CONTROL!]":" [BREAK TIE FOR CONTROL!]"):(ee+=250*de,se+=" [Break tie]");else if(!ne&&!J&&C===1){const pe=t.player.laneValues[R]-fe;pe<=3?(ee+=200*de,se+=k?` [CRITICAL: BUILD toward control, gap=${pe}]`:` [BUILD toward 2nd lead, gap=${pe}]`):pe<=6?(ee+=150*de,se+=` [BUILD toward 2nd lead, gap=${pe}]`):(ee+=100*de,se+=` [BUILD toward 2nd lead, gap=${pe}]`)}}}const be=Rx(N,t);be!==0&&(ee+=be,se+=` [Effect: ${be>=0?"+":""}${be}]`),n.push({move:{type:"playCard",cardId:N.id,laneIndex:R,isFaceUp:!0},score:Zd(ee),reason:se})}if(X.allowed){const ee=fn({...N,isFaceUp:!1},t.opponent.lanes[R]),se=t.opponent.laneValues[R]+ee,_e=t.opponent.laneValues[R],fe=N.value-ee;let be=-200-fe*30,oe=`Play ${N.protocol}-${N.value} face-down in lane ${R} (loses ${fe} value)`;!t.opponent.compiled[R]&&se>=10&&se>t.player.laneValues[R]?(be=300,oe=`Play ${N.protocol}-${N.value} face-down COMPILES lane ${R}: ${_e} -> ${se}`):K&&se>=t.player.laneValues[R]?(be=150,oe=`Play ${N.protocol}-${N.value} face-down BLOCKS compile in lane ${R}`):!t.opponent.compiled[R]&&_e>=8&&se>=10&&se>t.player.laneValues[R]?(be=250,oe=`Play ${N.protocol}-${N.value} face-down finishes compile: ${_e} -> ${se}`):te?K&&se<t.player.laneValues[R]&&(be=-500,oe+=" [WASTE: Goes to trash when player compiles!]"):(be=-100,oe=`Play ${N.protocol}-${N.value} face-down (no face-up option)`),n.push({move:{type:"playCard",cardId:N.id,laneIndex:R,isFaceUp:!1},score:Zd(be),reason:oe})}if(cl(t,N)&&!t.player.compiled[R]){const se=sx(N)||cx(N);let _e=0,fe=`Play ${N.protocol}-${N.value} on OPPONENT's lane ${R}`;se?(_e=N.value*8,_e+=50,fe+=" [SMART: Avoids harmful self-effect!]"):(_e=-100-N.value*10,fe+=" [Gives opponent value - usually bad]"),n.push({move:{type:"playCard",cardId:N.id,laneIndex:R,isFaceUp:!0,targetOwner:"player"},score:Zd(_e),reason:fe})}}if(t.opponent.hand.length===0)n.push({move:{type:"fillHand"},score:500,reason:"Must refill - no cards"});else{const N=t.player.laneValues.some((X,G)=>X>=10&&X>t.opponent.laneValues[G]&&!t.player.compiled[G]),R=t.controlCardHolder==="opponent",$=t.player.compiled.some(X=>X);N&&R&&$&&n.push({move:{type:"fillHand"},score:200,reason:"Emergency draw to block compile with control swap"}),k&&N&&!R&&(n.length>0?Math.max(...n.map(G=>G.score)):-1e3)<100&&n.push({move:{type:"fillHand"},score:50,reason:"CRITICAL: Refresh to find better options vs opponent win threat"})}if(n.length===0)return{type:"fillHand"};n.sort((N,R)=>R.score-N.score);const z=N=>{if(N.type==="playCard"&&N.isFaceUp){const R=t.opponent.hand.find(X=>X.id===N.cardId);if(!R)return!1;const $=yr(t,"opponent",N.laneIndex,!0,R.protocol);if(!$.allowed)return console.warn(`[AI Safety] Rejecting invalid face-up play: ${R.protocol}-${R.value} in lane ${N.laneIndex} - ${$.reason}`),!1}return!0};if(!(((L=(B=n[0])==null?void 0:B.reason)==null?void 0:L.includes("Blocks compile"))||((M=(P=n[0])==null?void 0:P.reason)==null?void 0:M.includes("BLOCK COMPILE")))&&al()&&n.length>1&&n[1].score>0&&z(n[1].move))return n[1].move;for(const N of n)if(z(N.move))return N.move;return console.warn("[AI Safety] No valid moves found, falling back to fillHand"),{type:"fillHand"}},Ax=(t,n)=>{var c,s,d,u,p,f,h,_;const r=ry(t);switch(n.type){case"prompt_use_control_mechanic":{const y=t.player.compiled.filter(C=>C).length,m=t.compilableLanes.length>0?t.compilableLanes[0]:null;let g=-1;for(let C=0;C<3;C++)if(!t.player.compiled[C]&&t.player.laneValues[C]>=10&&t.player.laneValues[C]>t.opponent.laneValues[C]){g=C;break}const x=t.player.compiled.map((C,b)=>C?b:-1).filter(C=>C!==-1);return g!==-1&&x.length>0?{type:"resolveControlMechanicPrompt",choice:"player"}:y===0?Rc(t,m)&&!al()?{type:"resolveControlMechanicPrompt",choice:"opponent"}:{type:"resolveControlMechanicPrompt",choice:"skip"}:Km(t,m)?{type:"resolveControlMechanicPrompt",choice:"player"}:Rc(t,m)&&!al()?{type:"resolveControlMechanicPrompt",choice:"opponent"}:{type:"resolveControlMechanicPrompt",choice:"skip"}}case"discard":return{type:"discardCards",cardIds:[...t.opponent.hand].sort((m,g)=>{const x=pl.some(b=>m.keywords[b]),C=pl.some(b=>g.keywords[b]);return x&&!C?1:!x&&C?-1:un(m)-un(g)}).slice(0,n.count).map(m=>m.id)};case"discard_completed":return{type:"skip"};case"select_opponent_card_to_flip":{const m=(x=>t[x].lanes.map(C=>C.length>0?C[C.length-1]:null).filter(C=>C!==null))("player");if(m.length===0)return{type:"skip"};const g=m.map(x=>({cardId:x.id,score:x.isFaceUp?x.value+5:3}));return g.sort((x,C)=>C.score-x.score),{type:"flipCard",cardId:g[0].cardId}}case"select_cards_to_delete":{const y=n.disallowedIds||[],m=n.allowedIds,g=n.targetFilter??{},x="actorChooses"in n?n.actorChooses:"effect_owner",C=n.sourceCardId,b=(g==null?void 0:g.position)||"uncovered";if(m&&m.length>0){const E=F=>{for(const U of["player","opponent"])for(const D of t[U].lanes)for(let I=0;I<D.length;I++)if(D[I].id===F)return{card:D[I],owner:U,isUncovered:I===D.length-1};return null},T=m.map(F=>({id:F,info:E(F)})).filter(({info:F})=>F!==null).filter(({info:F})=>b==="any"?!0:b==="uncovered"?F.isUncovered:b==="covered"?!F.isUncovered:!0).filter(({id:F})=>!y.includes(F));if(T.length>0){const F=T.filter(({info:D})=>D.owner==="player");if(F.length>0)return F.sort((D,I)=>I.info.card.value-D.info.card.value),{type:"deleteCard",cardId:F[0].id};const U=T.filter(({info:D})=>D.owner==="opponent");if(U.length>0)return U.sort((D,I)=>D.info.card.value-I.info.card.value),{type:"deleteCard",cardId:U[0].id}}return{type:"skip"}}if(x==="card_owner"&&(g==null?void 0:g.owner)==="opponent"){const E=[];return t.opponent.lanes.forEach(T=>{if(T.length>0){const F=T[T.length-1];if(tl(F,!0,g,C)){if(m&&!m.includes(F.id))return;E.push(F)}}}),E.length>0?(E.sort((T,F)=>T.value-F.value),{type:"deleteCard",cardId:E[0].id}):{type:"skip"}}const j=E=>t[E].lanes.map(T=>T.length>0?T[T.length-1]:null).filter(T=>T!==null).filter(T=>tl(T,!0,g,C)).filter(T=>!m||m.includes(T.id)),k=g==null?void 0:g.owner;if(k==="own"){const E=j("opponent").filter(T=>!y.includes(T.id));if(E.length>0)return{type:"deleteCard",cardId:E.sort((F,U)=>F.value-U.value)[0].id}}else if(k==="opponent"){const E=j("player").filter(T=>!y.includes(T.id));if(E.length>0){const T=Tm(t,r,{owner:"opponent"},C),F=new Set(E.map(D=>D.id)),U=T.filter(D=>F.has(D.targetId));return U.length>0?{type:"deleteCard",cardId:U[0].targetId}:{type:"deleteCard",cardId:E[0].id}}}else{const E=j("player").filter(F=>!y.includes(F.id));if(E.length>0){const F=Tm(t,r,void 0,C),U=new Set(E.map(I=>I.id)),D=F.filter(I=>U.has(I.targetId));return D.length>0?{type:"deleteCard",cardId:D[0].targetId}:{type:"deleteCard",cardId:E[0].id}}const T=j("opponent").filter(F=>!y.includes(F.id));if(T.length>0)return{type:"deleteCard",cardId:T.sort((U,D)=>U.value-D.value)[0].id}}return{type:"skip"}}case"select_any_card_to_flip":case"select_any_other_card_to_flip":case"select_any_face_down_card_to_flip_optional":case"select_any_card_to_flip_optional":{const y=Oa(t),m=n.targetFilter,g=n.sourceCardId;m!=null&&m.position;const x=n.actor,C=n.currentLaneIndex??n.laneIndex,b=n.scope,j=[];for(const F of["player","opponent"])if(!(m&&(m.owner==="own"&&F!==x||m.owner==="opponent"&&F===x)))for(let U=0;U<t[F].lanes.length;U++){if(C!==void 0&&U!==C||b==="this_lane"&&C!==void 0&&U!==C)continue;const D=t[F].lanes[U];if(D.length!==0)for(let I=0;I<D.length;I++){const W=D[I],z=I===D.length-1;if(m){if(!tl(W,z,m,g))continue}else if(!z)continue;y&&!W.isFaceUp||j.push({card:W,owner:F})}}if(j.length===0)return{type:"skip"};const k=Cx(t,r,m,g),E=new Set(j.map(F=>F.card.id)),T=k.filter(F=>E.has(F.targetId));return T.length>0?{type:"flipCard",cardId:T[0].targetId}:{type:"flipCard",cardId:j[0].card.id}}case"plague_2_opponent_discard":return t.opponent.hand.length===0?{type:"skip"}:{type:"discardCards",cardIds:[[...t.opponent.hand].sort((m,g)=>un(m)-un(g))[0].id]};case"select_card_from_hand_to_play":{if(t.opponent.hand.length===0)return{type:"skip"};const y=n.faceDown===!0,m=n.selectableCardIds,g=m?t.opponent.hand.filter(k=>m.includes(k.id)):t.opponent.hand;if(g.length===0)return{type:"skip"};const x=n.forcedLaneIndex;let C;if(x!==void 0?C=[x]:C=n.validLanes||[0,1,2].filter(k=>k!==n.disallowedLaneIndex),C=C.filter(k=>{const E=t.player.lanes[k],T=E.length>0?E[E.length-1]:null;return!(T&&T.isFaceUp&&T.protocol==="Plague"&&T.value===0)}),C.length===0)return{type:"skip"};const b=[];for(const k of g)for(const E of C){if(!y){const U=t.opponent.lanes.flat().some(V=>V.isFaceUp&&V.protocol==="Spirit"&&V.value===1),D=((s=(c=k.customEffects)==null?void 0:c.bottomEffects)==null?void 0:s.some(V=>{var B,L;return((B=V.params)==null?void 0:B.action)==="card_property"&&((L=V.params)==null?void 0:L.property)==="ignore_protocol_matching"}))||((u=(d=k.customEffects)==null?void 0:d.topEffects)==null?void 0:u.some(V=>{var B,L;return((B=V.params)==null?void 0:B.action)==="card_property"&&((L=V.params)==null?void 0:L.property)==="ignore_protocol_matching"}))||((f=(p=k.customEffects)==null?void 0:p.middleEffects)==null?void 0:f.some(V=>{var B,L;return((B=V.params)==null?void 0:B.action)==="card_property"&&((L=V.params)==null?void 0:L.property)==="ignore_protocol_matching"})),I=[...t.player.lanes.flat(),...t.opponent.lanes.flat()].some(V=>V.isFaceUp&&V.protocol==="Anarchy"&&V.value===1),W=fl(t,"opponent",E,k.protocol);let z;if(I?z=k.protocol!==t.opponent.protocols[E]&&k.protocol!==t.player.protocols[E]:z=k.protocol===t.opponent.protocols[E]||k.protocol===t.player.protocols[E]||U||D||W,z){const V=k.value,B=t.opponent.laneValues[E]+V;let L=un(k)+V*2;B>=10&&B>t.player.laneValues[E]&&(L+=100);const P=t.player.laneValues[E],M=t.player.compiled[E],N=t.opponent.compiled[E],R=t.opponent.laneValues[E];!M&&!N&&P>=10&&P>R&&B>=P&&(L+=160),b.push({cardId:k.id,laneIndex:E,isFaceUp:!0,score:L})}}if(!t.player.lanes[E].some(U=>U.isFaceUp&&U.protocol==="Metal"&&U.value===2)){const U=fn({...k,isFaceUp:!1},t.opponent.lanes[E]),D=t.opponent.laneValues[E]+U;let I=U*2;D>=10&&D>t.player.laneValues[E]&&(I+=80);const W=t.player.laneValues[E],z=t.player.compiled[E],V=t.opponent.compiled[E],B=t.opponent.laneValues[E];!z&&!V&&W>=10&&W>B&&D>=W&&(I+=150),b.push({cardId:k.id,laneIndex:E,isFaceUp:!1,score:I})}}if(b.length===0)return{type:"skip"};b.sort((k,E)=>E.score-k.score);const j=b[0];return{type:"playCard",cardId:j.cardId,laneIndex:j.laneIndex,isFaceUp:j.isFaceUp}}case"select_card_from_hand_to_give":return t.opponent.hand.length===0?{type:"skip"}:{type:"giveCard",cardId:[...t.opponent.hand].sort((m,g)=>un(m)-un(g))[0].id};case"select_card_from_hand_to_reveal":return t.opponent.hand.length===0?{type:"skip"}:{type:"revealCard",cardId:[...t.opponent.hand].sort((m,g)=>un(g)-un(m))[0].id};case"select_card_to_return":case"select_opponent_card_to_return":{const m={position:"uncovered",...n.targetFilter||{}},g=n.targetOwner||m.owner,x=n.sourceCardId;m!=null&&m.position;const C=n.actor,b=[];for(const U of["player","opponent"])if(!(g==="own"&&U!==C)&&!(g==="opponent"&&U===C))for(const D of t[U].lanes)for(let I=0;I<D.length;I++){const W=D[I],z=I===D.length-1;tl(W,z,m,x)&&b.push({card:W,owner:U})}if(b.length===0)return{type:"skip"};const j=Sx(t,r,m,x),k=new Set(b.map(U=>U.card.id)),E=j.filter(U=>k.has(U.targetId));if(E.length>0)return{type:"returnCard",cardId:E[0].targetId};const T=b.filter(U=>U.owner==="player"),F=b.filter(U=>U.owner==="opponent");return T.length>0?(T.sort((U,D)=>Xd(D.card,"player",t)-Xd(U.card,"player",t)),{type:"returnCard",cardId:T[0].card.id}):F.length>0?(F.sort((U,D)=>U.card.value-D.card.value),{type:"returnCard",cardId:F[0].card.id}):{type:"returnCard",cardId:b[0].card.id}}case"select_lane_for_play":{let y=n.validLanes||[0,1,2];y=y.filter(b=>!("disallowedLaneIndex"in n)||b!==n.disallowedLaneIndex),n.excludeCurrentLane&&n.currentLaneIndex!==void 0&&(y=y.filter(b=>b!==n.currentLaneIndex));const g=(n.actor||"opponent")==="opponent"?t.opponent:t.player;if(y=y.filter(b=>{const j=g.lanes[b],k=j.length>0?j[j.length-1]:null,E=k&&k.isFaceUp&&k.protocol==="Plague"&&k.value===0,T="isFaceDown"in n&&n.isFaceDown&&j.some(F=>F.isFaceUp&&F.protocol==="Metal"&&F.value===2);return!E&&!T}),y.length===0)return{type:"skip"};const x=y.filter(b=>{const j=t.player.laneValues[b],k=t.opponent.laneValues[b],E=t.player.compiled[b],T=t.opponent.compiled[b],F=!E&&j>=10&&j>k,U=k+2>=j;return F&&U&&!T});if(x.length>0)return x.sort((b,j)=>t.player.laneValues[j]-t.player.laneValues[b]),{type:"selectLane",laneIndex:x[0]};const C=y.map(b=>{const j=t.opponent.laneValues[b]-t.player.laneValues[b];return{laneIndex:b,score:-j}});return C.sort((b,j)=>j.score-b.score),{type:"selectLane",laneIndex:C[0].laneIndex}}case"prompt_rearrange_protocols":return Jm(t,n);case"prompt_swap_protocols":{const{target:y}=n,m=t[y].protocols,g=t[y].hand,x=t[y].compiled,C=t[y].laneValues,b=[[0,1],[0,2],[1,2]];let j=[0,1],k=-1/0;for(const E of b){const[T,F]=E,U=[...m];[U[T],U[F]]=[U[F],U[T]];let D=0;const I=x[T],W=x[F],z=C[T],V=C[F];if(y==="opponent"){I&&!W?V<z&&(D+=30):W&&!I&&z<V&&(D+=30);for(const B of g){const L=B.protocol===m[T],P=B.protocol===m[F],M=B.protocol===U[T],N=B.protocol===U[F],R=I?.5:1.5,$=W?.5:1.5;M&&!L&&(D+=un(B)*R),N&&!P&&(D+=un(B)*$),!M&&L&&(D-=un(B)*R),!N&&P&&(D-=un(B)*$)}}else{I&&!W?z>V&&(D+=25):W&&!I&&V>z&&(D+=25);for(const B of g){const L=B.protocol===m[T],P=B.protocol===m[F],M=B.protocol===U[T],N=B.protocol===U[F],R=I?.5:1.5,$=W?.5:1.5;M&&!L&&(D-=un(B)*R),N&&!P&&(D-=un(B)*$),!M&&L&&(D+=un(B)*R),!N&&P&&(D+=un(B)*$)}}D>k&&(k=D,j=E)}return{type:"resolveSwapProtocols",indices:j}}case"select_lane_for_shift":{let y=n.validLanes||[0,1,2];if(y=y.filter(m=>!("disallowedLaneIndex"in n)||m!==n.disallowedLaneIndex).filter(m=>!("originalLaneIndex"in n)||m!==n.originalLaneIndex),"sourceCardId"in n){const m=[...t.player.lanes.flat(),...t.opponent.lanes.flat()].find(g=>g.id===n.sourceCardId);if(m&&m.protocol==="Gravity"&&m.value===1){let g=null;for(let x=0;x<3;x++)if([...t.player.lanes[x],...t.opponent.lanes[x]].some(b=>b.id===n.sourceCardId)){g=x;break}g!==null&&"originalLaneIndex"in n&&(n.originalLaneIndex===g||(y=[g]))}if(m&&m.protocol==="Anarchy"&&m.value===1){const g="cardToShiftId"in n?n.cardToShiftId:null;if(g){const x=[...t.player.lanes.flat(),...t.opponent.lanes.flat()].find(C=>C.id===g);x&&(y=y.filter(C=>{const b=t.player.protocols[C],j=t.opponent.protocols[C],k=x.protocol;return k!==b&&k!==j}))}}}if(y.length>0){const m="cardToShiftId"in n?n.cardToShiftId:null;let g=null,x=0;if(m)for(const b of["player","opponent"]){for(const j of t[b].lanes){const k=j.find(E=>E.id===m);if(k){g=b,x=k.isFaceUp?k.value:2;break}}if(g)break}const C=y.map(b=>{let j=0;const k=t.player.laneValues[b],E=t.opponent.laneValues[b],T=t.player.compiled[b],F=t.opponent.compiled[b];return g==="player"?T?j+=100:E>k?j+=50:k>=6&&k<10&&!T&&(j-=50):g==="opponent"&&(!F&&E<10?E+x>=10?j+=100:E>=6?j+=60:j+=30:F&&(j-=50)),{laneIdx:b,score:j}});if(C.sort((b,j)=>j.score-b.score),al()&&C.length>1){const b=Math.floor(Math.random()*C.length);return{type:"selectLane",laneIndex:C[b].laneIdx}}return{type:"selectLane",laneIndex:C[0].laneIdx}}return{type:"selectLane",laneIndex:0}}case"select_lane_for_delete_all":{const y="validLanes"in n?n.validLanes:[0,1,2];if(y.length===0)return{type:"skip"};let m=y[0],g=-1/0;for(const x of y){const C=t.opponent.laneValues[x],j=t.player.laneValues[x]-C;j>g&&(g=j,m=x)}return{type:"selectLane",laneIndex:m}}case"select_lanes_for_swap_stacks":{const y=n.validLanes,m=n.selectedFirstLane;if(y.length===0)return{type:"skip"};if(m===void 0){const g=y.map(x=>{const C=t.opponent.laneValues[x];return{laneIdx:x,score:C}});return g.sort((x,C)=>x.score-C.score),{type:"selectLane",laneIndex:g[0].laneIdx}}else{const g=y.map(x=>{const C=t.opponent.laneValues[x];return{laneIdx:x,score:C}});return g.sort((x,C)=>C.score-x.score),{type:"selectLane",laneIndex:g[0].laneIdx}}}case"select_card_for_copy_middle":{const y=n.validTargetIds||[];if(y.length===0)return{type:"skip"};const m=y.map(g=>{var C,b;let x=0;for(const j of["player","opponent"])for(const k of t[j].lanes){const E=k.find(T=>T.id===g);if(E){const F=((C=E.customEffects)==null?void 0:C.middleEffects)||[];for(const U of F){const D=(b=U.params)==null?void 0:b.action;D==="draw"&&(x+=5),D==="flip"&&(x+=3),D==="delete"&&(x+=4),D==="shift"&&(x+=2),D==="discard"&&(x-=2)}}}return{cardId:g,score:x}});return m.sort((g,x)=>x.score-g.score),{type:"selectCard",cardId:m[0].cardId}}case"select_lane_for_return":{const y=n.targetFilter||{},m=n.actor,g=y.valueEquals,x=y.valueRange,C=[];for(let b=0;b<3;b++){let j=0,k=0;const E=oy(t,b);for(const U of["player","opponent"]){if(y.owner==="own"&&U!==m||y.owner==="opponent"&&U===m)continue;const D=t[U].lanes[b];for(let I=0;I<D.length;I++){const W=D[I],z=I===D.length-1;if(y.position==="uncovered"&&!z||y.position==="covered"&&z)continue;const V=W.isFaceUp?W.value:2+E;g!==void 0&&V!==g||x&&(V<x.min||V>x.max)||(U==="player"?j+=V:k+=V)}}const T=j-k,F=`Lane ${b}: Player loses ${j}, we lose ${k}, net=${T}`;C.push({laneIndex:b,score:T,reason:F})}C.sort((b,j)=>j.score-b.score);for(const b of C);return C.length>0?{type:"selectLane",laneIndex:C[0].laneIndex}:{type:"selectLane",laneIndex:0}}case"prompt_optional_effect":{const{effectDef:y}=n,m=(h=y==null?void 0:y.params)==null?void 0:h.action,g=(_=y==null?void 0:y.params)==null?void 0:_.targetFilter;if(m==="give")return{type:"resolveOptionalEffectPrompt",accept:!1};if(m==="flip"){let x=!1;const C=(g==null?void 0:g.position)||"uncovered";for(const b of["player","opponent"])if(!((g==null?void 0:g.owner)==="own"&&b!=="opponent")&&!((g==null?void 0:g.owner)==="opponent"&&b==="opponent")){for(let j=0;j<t[b].lanes.length;j++){const k=t[b].lanes[j];if(k.length!==0){for(let E=0;E<k.length;E++){const T=k[E],F=E===k.length-1,U=!F;if(C==="uncovered"&&!F||C==="covered"&&!U||(g==null?void 0:g.faceState)==="face_up"&&!T.isFaceUp||(g==null?void 0:g.faceState)==="face_down"&&T.isFaceUp)continue;const D=T.isFaceUp?T.value:2,I=T.isFaceUp?2:T.value;if(b==="player"){if(T.isFaceUp&&D>I){x=!0;break}}else{const W=t.opponent.laneValues[j],z=I-D;if(T.isFaceUp&&z>0){x=!0;break}if(!T.isFaceUp&&T.value>2){x=!0;break}if(z>0&&W+z>=10&&!t.opponent.compiled[j]){x=!0;break}}}if(x)break}}if(x)break}return{type:"resolveOptionalEffectPrompt",accept:x}}return{type:"resolveOptionalEffectPrompt",accept:!al()}}case"select_card_from_other_lanes_to_delete":{const{disallowedLaneIndex:y,lanesSelected:m}=n,g=[];for(let x=0;x<3;x++){if(x===y||m.includes(x))continue;const C=t.player.lanes[x];if(C.length>0){const j=C[C.length-1],k=j.isFaceUp?j.value:Math.min(j.value,2);g.push({cardId:j.id,score:k+100})}const b=t.opponent.lanes[x];if(b.length>0){const j=b[b.length-1],k=j.isFaceUp?j.value:Math.min(j.value,2);g.push({cardId:j.id,score:-k})}}return g.length>0?(g.sort((x,C)=>C.score-x.score),{type:"deleteCard",cardId:g[0].cardId}):{type:"skip"}}case"select_face_down_card_to_delete":{const y="disallowedIds"in n&&Array.isArray(n.disallowedIds)?n.disallowedIds:[],m=C=>t[C].lanes.map(b=>b.length>0?b[b.length-1]:null).filter(b=>b!==null&&!b.isFaceUp),g=m("player").filter(C=>!y.includes(C.id));if(g.length>0){const C=g.map(b=>{const j=t.player.lanes.findIndex(E=>E.some(T=>T.id===b.id)),k=t.player.laneValues[j]||0;return{cardId:b.id,score:k}});return C.sort((b,j)=>j.score-b.score),{type:"deleteCard",cardId:C[0].cardId}}const x=m("opponent").filter(C=>!y.includes(C.id));return x.length>0?(x.sort((C,b)=>C.value-b.value),{type:"deleteCard",cardId:x[0].id}):{type:"skip"}}case"select_low_value_card_to_delete":{const y=[];for(const m of["player","opponent"])for(let g=0;g<3;g++){const x=t[m].lanes[g];if(x.length>0){const C=x[x.length-1];if(C.isFaceUp&&(C.value===0||C.value===1)){const b=m==="player",j=t[m].laneValues[g],k=b?100+j:-j;y.push({cardId:C.id,score:k})}}}return y.length>0?(y.sort((m,g)=>g.score-m.score),{type:"deleteCard",cardId:y[0].cardId}):{type:"skip"}}case"select_opponent_face_up_card_to_flip":{const m=(g=>t[g].lanes.map(x=>x.length>0?x[x.length-1]:null).filter(x=>x!==null))("player").filter(g=>g.isFaceUp);return m.length>0?(m.sort((g,x)=>x.value-g.value),{type:"flipCard",cardId:m[0].id}):{type:"skip"}}case"select_covered_card_in_line_to_flip_optional":{const y="optional"in n&&n.optional,g=!["select_any_other_card_to_flip","select_any_other_card_to_flip_for_water_0"].includes(n.type);if(n.type==="select_covered_card_in_line_to_flip_optional"){const{laneIndex:E}=n,T=t.opponent.lanes[E],F=t.player.lanes[E],U=T.filter((L,P,M)=>P<M.length-1),D=F.filter((L,P,M)=>P<M.length-1),I=t.opponent.laneValues[E];if(!t.opponent.compiled[E]){let L=null,P=null;for(const M of U){let N,R;M.isFaceUp?(N=M.value,R=2):(N=fn(M,T,t,E,"opponent"),R=M.value);const $=R-N,X=I+$;$>0&&X>=10&&(!L||X>L.newValue)&&(L={card:M,newValue:X,gain:$}),$>0&&(!P||$>P.gain)&&(P={card:M,gain:$,newValue:X})}if(L)return{type:"flipCard",cardId:L.card.id};if(P&&P.gain>0)return{type:"flipCard",cardId:P.card.id}}if(t.opponent.compiled[E]){let L=null;for(const P of U){const M=P.isFaceUp?P.value:fn(P,T,t,E,"opponent"),R=(P.isFaceUp?2:P.value)-M;R>0&&(!L||R>L.gain)&&(L={card:P,gain:R})}if(L)return{type:"flipCard",cardId:L.card.id}}const z=D.filter(L=>L.isFaceUp);if(z.length>0)return z.sort((L,P)=>P.value-L.value),{type:"flipCard",cardId:z[0].id};const V=U.filter(L=>!L.isFaceUp).map(L=>({card:L,gain:L.value-fn(L,T,t,E,"opponent")})).filter(L=>L.gain>0).sort((L,P)=>P.gain-L.gain);if(V.length>0)return{type:"flipCard",cardId:V[0].card.id};const B=D.filter(L=>!L.isFaceUp);return B.length>0?{type:"flipCard",cardId:B[0].id}:{type:"skip"}}const x=E=>t[E].lanes.map(T=>T.length>0?T[T.length-1]:null).filter(T=>T!==null),C=x("player"),b=x("opponent");{const E=C.filter(T=>T.isFaceUp).sort((T,F)=>F.value-T.value);if(E.length>0)return{type:"flipCard",cardId:E[0].id}}const j=b.filter(E=>!E.isFaceUp);if(j.length>0)return{type:"flipCard",cardId:j[0].id};const k=C.filter(E=>!E.isFaceUp);if(k.length>0)return{type:"flipCard",cardId:k[0].id};{const E=b.filter(F=>!(!F.isFaceUp||!g&&F.id===n.sourceCardId)),T=E.filter(F=>{const U=t.opponent.lanes.findIndex(D=>D.length>0&&D[D.length-1].id===F.id);return U!==-1&&t.opponent.compiled[U]});if(T.length>0&&!y)return{type:"flipCard",cardId:T[0].id};if(E.length>0&&!y)return{type:"flipCard",cardId:E[0].id}}return{type:"skip"}}case"shift_flipped_card_optional":{const y=n.cardId,m=n.optional,g=Te(t,y);if(!g)return{type:"skip"};const x=g.card,C=g.owner,b=x.isFaceUp?x.value:2;let j=g.laneIndex??-1;if(j===-1){const B=t[C];for(let L=0;L<B.lanes.length;L++)if(B.lanes[L].some(P=>P.id===y)){j=L;break}}if(j===-1)return{type:"skip"};const k=[0,1,2].filter(B=>B!==j);if(k.length===0)return{type:"skip"};const E=t.opponent,T=t.player,F=E.laneValues[j],U=E.compiled[j],D=T.laneValues[j],I=F-b;let W=-1,z=-1/0;const V=0;for(const B of k){const L=E.laneValues[B],P=E.compiled[B],M=T.laneValues[B],N=L+b;let R=0;!U&&F>=8&&F>D&&(R-=100),!P&&N>=10&&N>M&&(R+=80),!P&&L<F&&(U||F<6)&&(R+=20),P&&(R-=30),!P&&L<=M&&N>M&&(R+=25),!U&&F>D&&I<=D&&(R-=40),R>z&&(z=R,W=B)}return m&&z<V?{type:"skip"}:W!==-1?{type:"selectLane",laneIndex:W}:m?{type:"skip"}:{type:"selectLane",laneIndex:k[0]}}case"select_lane_to_shift_revealed_card_for_light_2":case"select_lane_to_shift_revealed_card":{const y=n.revealedCardId,m=Te(t,y);if(!m)return{type:"selectLane",laneIndex:0};let g=-1;for(let C=0;C<t[m.owner].lanes.length;C++)if(t[m.owner].lanes[C].some(b=>b.id===y)){g=C;break}const x=[0,1,2].filter(C=>C!==g);return x.length>0?(m.owner==="opponent"?x.sort((C,b)=>{const j=t.opponent.laneValues[C],k=t.opponent.laneValues[b];return!t.opponent.compiled[C]&&t.opponent.compiled[b]?-1:t.opponent.compiled[C]&&!t.opponent.compiled[b]?1:k-j}):x.sort((C,b)=>t.player.laneValues[C]-t.player.laneValues[b]),{type:"selectLane",laneIndex:x[0]}):{type:"selectLane",laneIndex:0}}case"select_opponent_face_down_card_to_shift":{const y=[];for(let m=0;m<3;m++){const g=t.player.lanes[m];if(g.length>0){const x=g[g.length-1];if(!x.isFaceUp){const C=t.player.laneValues[m];y.push({cardId:x.id,laneValue:C})}}}return y.length>0?(y.sort((m,g)=>g.laneValue-m.laneValue),{type:"deleteCard",cardId:y[0].cardId}):{type:"skip"}}case"select_opponent_covered_card_to_shift":{const y=[];for(let m=0;m<3;m++){const g=t.player.lanes[m],x=t.player.laneValues[m];for(let C=0;C<g.length-1;C++){const b=g[C],j=b.isFaceUp?b.value:Math.min(b.value,2);y.push({cardId:b.id,score:j+x})}}return y.length>0?(y.sort((m,g)=>g.score-m.score),{type:"deleteCard",cardId:y[0].cardId}):{type:"skip"}}case"select_own_covered_card_to_shift":{const y=[];for(let m=0;m<3;m++){const g=t.opponent.lanes[m],x=t.opponent.laneValues[m];for(let C=0;C<g.length-1;C++){const b=g[C],k=(b.isFaceUp?b.value:Math.min(b.value,2))-x*.5;y.push({cardId:b.id,score:k})}}return y.length>0?(y.sort((m,g)=>g.score-m.score),{type:"deleteCard",cardId:y[0].cardId}):{type:"skip"}}case"select_card_to_flip":{const y=n.targetFilter||{},m=n.restrictedLaneIndex??n.currentLaneIndex??n.laneIndex,g=n.scope,x=n.actor,C=n.sourceCardId;y!=null&&y.position;const b=[];for(const k of["player","opponent"])if(!(y.owner==="own"&&k!==x)&&!(y.owner==="opponent"&&k===x))for(let E=0;E<t[k].lanes.length;E++){if(m!==void 0&&E!==m||g==="this_lane"&&m!==void 0&&E!==m)continue;const T=t[k].lanes[E];for(let F=0;F<T.length;F++){const U=T[F];if(Wo(t,U.id))continue;const D=Qo(t,T,F);if(tl(U,D,y,C)&&!(y.position==="covered_in_this_line"&&D)){if(y.valueMinGreaterThanHandSize){const I=t[x].hand.length;if(U.value<=I)continue}if(y.valueLessThanUniqueProtocolsOnField){const I=vr(t);if(U.value>=I)continue}b.push({card:U,owner:k,laneIndex:E})}}}if(b.length===0)return{type:"skip"};const j=b.map(({card:k,owner:E,laneIndex:T})=>{let F=0;const U=t[E].laneValues[T],D=t[E].compiled[T],I=k.isFaceUp?k.value:2,z=(k.isFaceUp?2:k.value)-I;return E==="player"?k.isFaceUp?(F=-z*15,F+=Xd(k,"player",t)):k.value<=1?F=20:F=-30:k.isFaceUp?z>0?(F=z*20+50,!D&&U+z>=10&&(F+=200)):F=z*15-30:z>0?(F=z*20+40,!D&&U+z>=10&&(F+=200)):F=-10,{card:k,score:F}});if(j.sort((k,E)=>E.score-k.score),al()&&j.length>1){const k=Math.floor(Math.random()*j.length);return{type:"flipCard",cardId:j[k].card.id}}return{type:"flipCard",cardId:j[0].card.id}}case"select_card_to_shift":{const y=n.targetFilter||{},g=n.scope==="this_lane"?n.sourceLaneIndex??n.currentLaneIndex??n.laneIndex:void 0,x=n.actor,C=n.sourceCardId;y!=null&&y.position;const b=[];for(const j of["player","opponent"])if(!(y.owner==="own"&&j!==x)&&!(y.owner==="opponent"&&j===x))for(let k=0;k<t[j].lanes.length;k++){if(g!==void 0&&k!==g)continue;const E=t[j].lanes[k],T=t[j].laneValues[k];for(let F=0;F<E.length;F++){const U=E[F],D=F===E.length-1;if(!tl(U,D,y,C))continue;const I=U.isFaceUp?U.value:Math.min(U.value,2),W=j==="player";let z;W?z=I+T:z=I-T*.5,b.push({cardId:U.id,score:z})}}return b.length>0?(b.sort((j,k)=>k.score-j.score),{type:"shiftCard",cardId:b[0].cardId}):{type:"skip"}}case"select_board_card_to_reveal_custom":{const y=[];for(const m of["player","opponent"])for(const g of t[m].lanes)if(g.length>0){const x=g[g.length-1];x.isFaceUp||y.push({card:x,owner:m})}if(y.length>0){const m=y.filter(g=>g.owner==="player");return m.length>0?{type:"deleteCard",cardId:m[0].card.id}:{type:"deleteCard",cardId:y[0].card.id}}return{type:"skip"}}case"prompt_shift_or_flip_board_card_custom":{const{revealedCardId:y}=n,m=Te(t,y);if(!m)return{type:"resolveRevealBoardCardPrompt",choice:"skip"};const g=m.card,x=m.owner==="opponent",C=g.isFaceUp?g.value:Math.min(g.value,2),j=(g.isFaceUp?Math.min(g.value,2):g.value)-C;let k=0;x?k=j*20:k=-j*20;let E=-50;const T=g.isFaceUp?g.value:Math.min(g.value,2);if(x)for(let F=0;F<3;F++){const U=t.opponent.laneValues[F],D=t.player.laneValues[F],I=U+T;I>=10&&I>D?E=Math.max(E,100):I>D&&(E=Math.max(E,20))}else for(let F=0;F<3;F++)t.player.laneValues[F]+T>=10&&(E=Math.min(E,-100));return k>=E?{type:"resolveRevealBoardCardPrompt",choice:"flip"}:{type:"resolveRevealBoardCardPrompt",choice:"shift"}}case"select_lane_to_shift_revealed_board_card_custom":{const y=n.cardToShiftId,m=Te(t,y);if(!m)return{type:"selectLane",laneIndex:0};const g=m.card,x=g.isFaceUp?g.value:Math.min(g.value,2),C=m.owner==="opponent";let b=0,j=-1e3;for(let k=0;k<3;k++){let E=0;if(C){const T=t.opponent.laneValues[k]+x,F=t.player.laneValues[k];T>=10&&T>F?E=200:E=T-F}else{const T=t.player.laneValues[k]+x,F=t.opponent.laneValues[k];T>=10&&T>F?E=-200:E=F-T}E>j&&(j=E,b=k)}return{type:"selectLane",laneIndex:b}}case"gravity_2_shift_after_flip":{const{targetLaneIndex:y}=n;return{type:"selectLane",laneIndex:y}}case"flip_self":case"flip_self_for_water_0":case"flip_self_for_psychic_4":case"speed_3_self_flip_after_shift":return n.sourceCardId?{type:"flipCard",cardId:n.sourceCardId}:{type:"skip"};case"anarchy_0_conditional_draw":return{type:"skip"};case"select_any_opponent_card_to_shift":{const y=[];for(let m=0;m<3;m++){const g=t.player.lanes[m];if(g.length>0){const x=g[g.length-1],C=x.isFaceUp?x.value:Math.min(x.value,2),b=t.player.laneValues[m];y.push({cardId:x.id,score:C+b})}}return y.length>0?(y.sort((m,g)=>g.score-m.score),{type:"deleteCard",cardId:y[0].cardId}):{type:"skip"}}case"select_own_other_card_to_shift":{const y=[];for(let m=0;m<3;m++){const g=t.opponent.lanes[m],x=t.opponent.laneValues[m];for(const C of g){if(C.id===n.sourceCardId)continue;const b=C.isFaceUp?C.value:Math.min(C.value,2);y.push({cardId:C.id,score:b-x*.5})}}return y.length>0?(y.sort((m,g)=>g.score-m.score),{type:"deleteCard",cardId:y[0].cardId}):{type:"skip"}}case"select_own_face_up_covered_card_to_flip":return{type:"skip"};case"plague_4_opponent_delete":{const y=[];return t.opponent.lanes.forEach(m=>{if(m.length>0){const g=m[m.length-1];g.isFaceUp||y.push(g)}}),y.length>0?(y.sort((m,g)=>m.value-g.value),{type:"deleteCard",cardId:y[0].id}):{type:"skip"}}case"reveal_opponent_hand":case"plague_2_player_discard":case"delete_self":return{type:"skip"};case"select_card_from_trash_to_play":{const y=t.opponent.discard;return y.length===0?{type:"skip"}:{type:"selectTrashCard",cardIndex:[...y].map((g,x)=>{var b,j,k;let C=g.value*10;for(let E=0;E<3;E++){if(t.opponent.compiled[E])continue;const T=t.opponent.laneValues[E]+g.value;T>=10&&T>t.player.laneValues[E]&&(C+=100)}return(b=g.keywords)!=null&&b.flip&&(C+=5),(j=g.keywords)!=null&&j.draw&&(C+=3),(k=g.keywords)!=null&&k.delete&&(C+=5),{card:g,index:x,score:C}}).sort((g,x)=>x.score-g.score)[0].index}}case"select_card_from_trash_to_reveal":{const y=t.opponent.discard;return y.length===0?{type:"skip"}:{type:"selectTrashCard",cardIndex:[...y].map((g,x)=>({card:g,index:x,value:g.value})).sort((g,x)=>x.value-g.value)[0].index}}case"select_lane_for_delete":{const y=n.validLanes||[0,1,2],m=n.valueFilter,g=y.map(x=>{let C=0,b=0;for(const j of t.player.lanes[x]){const k=j.isFaceUp?j.value:2;m?j.isFaceUp?j.value>=m.min&&j.value<=m.max&&(C+=k+1):C+=(k+1)*.5:C+=k+1}for(const j of t.opponent.lanes[x]){const k=j.isFaceUp?j.value:2;m?j.isFaceUp?j.value>=m.min&&j.value<=m.max&&(b+=k+3):b+=(k+3)*.5:b+=k+3}return{laneIndex:x,score:C-b}});return g.sort((x,C)=>C.score-x.score),g[0].score>0?{type:"selectLane",laneIndex:g[0].laneIndex}:{type:"selectLane",laneIndex:g[0].laneIndex}}case"select_lane_for_shift_all":{const y=n.validDestinationLanes||n.validLanes||[0,1,2],m=n.sourceLaneIndex,g=y.filter(x=>x!==m);if(g.length>0){const x=g.map(C=>{let b=0;return b+=t.opponent.lanes[C].length*2,b+=t.opponent.laneValues[C],t.player.laneValues[C]>=8&&(b-=5),{laneIndex:C,score:b}});return x.sort((C,b)=>b.score-C.score),{type:"selectLane",laneIndex:x[0].laneIndex}}return y.length>0?{type:"selectLane",laneIndex:y[0]}:{type:"selectLane",laneIndex:0}}case"prompt_optional_draw":return t.opponent.hand.length>=6?{type:"resolveOptionalEffectPrompt",accept:!1}:{type:"resolveOptionalEffectPrompt",accept:!0};case"prompt_optional_discard_custom":return{type:"resolveOptionalEffectPrompt",accept:t.opponent.hand.length>4};case"prompt_optional_shuffle_trash":return{type:"resolvePrompt",accept:(n.trashCount||0)>0};case"select_card_from_revealed_deck":{const y=n.selectableCardIds||[];if(y.length>0){const m=Math.floor(Math.random()*y.length);return{type:"selectRevealedDeckCard",cardId:y[m]}}return{type:"resolvePrompt",accept:!1}}case"reveal_deck_draw_protocol":return{type:"confirmRevealDeckDrawProtocol"};case"custom_choice":{const{options:y}=n;if(!y||y.length!==2)return{type:"resolveCustomChoice",optionIndex:0};const m=C=>{var k,E,T;let b=0;const j=((k=C.action)==null?void 0:k.toLowerCase())||"";return j.includes("draw")&&(b+=30),j.includes("discard")&&(b-=20),j.includes("delete")&&((E=C.targetFilter)==null?void 0:E.owner)==="opponent"&&(b+=40),j.includes("delete")&&((T=C.targetFilter)==null?void 0:T.owner)==="own"&&(b-=30),b},g=m(y[0]),x=m(y[1]);return{type:"resolveCustomChoice",optionIndex:g>=x?0:1}}case"select_phase_effect":{const y=n;if(y.availableEffects.length===0)return{type:"skip"};const m=y.availableEffects.map(x=>{let C=0;const b=x.effectDescription.toLowerCase();return b.includes("draw")?C+=100:b.includes("delete")?C+=80:b.includes("shift")?C+=60:b.includes("flip")?C+=40:C+=20,Math.random()<.05&&(C=Math.random()*50),{effect:x,score:C}});return m.sort((x,C)=>C.score-x.score),{type:"flipCard",cardId:m[0].effect.cardId}}case"state_number":{const y={0:0,1:0,2:0,3:0,4:0,5:0};t.opponent.hand.forEach(x=>{x.value>=0&&x.value<=5&&y[x.value]++}),y[2]+=2,y[3]+=2;let m=0,g=y[0];for(let x=1;x<=5;x++)y[x]>g&&(g=y[x],m=x);return Math.random()<.05&&(m=Math.floor(Math.random()*6)),{type:"stateNumber",number:m}}case"state_protocol":{const m=n.availableProtocols||[];if(m.length===0)return{type:"skip"};const g=t.player.protocols,x=m.map(C=>{let b=0;return g.includes(C)&&(b+=50),b+=Math.random()*20,{protocol:C,score:b}});return x.sort((C,b)=>b.score-C.score),{type:"stateProtocol",protocol:x[0].protocol}}case"select_from_drawn_to_reveal":{const m=n.eligibleCardIds||[];if(m.length===0)return{type:"skip"};const g=t.opponent.hand,x=m.map(C=>{const b=g.find(k=>k.id===C);if(!b)return{cardId:C,score:0};let j=b.value;return t.opponent.protocols.includes(b.protocol)&&(j+=10),{cardId:C,score:j}});return x.sort((C,b)=>b.score-C.score),{type:"selectFromDrawnToReveal",cardId:x[0].cardId}}case"confirm_deck_discard":return{type:"confirmDeckDiscard"};case"confirm_deck_play_preview":return{type:"confirmDeckPlayPreview"};default:{if("optional"in n&&n.optional)return{type:"skip"};const y=[...t.player.lanes.flat(),...t.opponent.lanes.flat()];return y.length>0&&(n.type.includes("select_")||n.type.includes("shift"))?{type:"deleteCard",cardId:y[0].id}:{type:"skip"}}}},Rm=(t,n)=>n?Ax(t,n):t.phase==="compile"&&t.compilableLanes.length>0?{type:"compile",laneIndex:t.compilableLanes.reduce((c,s)=>t.opponent.laneValues[s]>t.opponent.laneValues[c]?s:c)}:t.phase==="action"?Dx(t):{type:"fillHand"};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const lt=(t,n)=>t.phase==="start"?n.continueTurnAfterStartPhaseAction(t):n.processEndOfAction(t),sy=(t,n,r,c,s,d,u,p)=>{const{cardId:f,laneIndex:h,isFaceUp:_}=n,{newState:y,animationRequests:m}=s.playCard({...t,actionRequired:null},f,h,_,"opponent"),g={...y,animationState:{type:"playCard",cardId:f,owner:"opponent"}};return setTimeout(()=>{r(x=>{let C={...x,animationState:null};return m&&m.length>0?(d(m,()=>r(b=>{const j={...b,animationState:null};return p&&j.actionRequired?(Ln(j,r,c,s,d,u),j):j.actionRequired&&j.actionRequired.actor==="opponent"?j:{...lt(j,u),animationState:null}})),C):p&&C.actionRequired?(Ln(C,r,c,s,d,u),C):C.actionRequired&&C.actionRequired.actor==="opponent"?C:lt(C,u)})},500),g},Ac=(t,n,r)=>{switch(r){case"normal":return Rm(t,n);case"hard":return console.warn("[AI] Hard AI temporarily disabled, using Normal AI"),Rm(t,n);default:return ux(t,n)}},Fx=(t,n,r,c,s,d,u,p,f)=>{n(h=>{const _=h.actionRequired;if(!_||!((h.turn==="player"||h._interruptedTurn==="player")&&"actor"in _&&_.actor==="opponent"))return h;const g=Ac(h,_,r);if(g.type==="discardCards"&&_.type==="discard"){const b=_.variableCount===!0?g.cardIds.length:_.count,j=g.cardIds.slice(0,b);j.length!==g.cardIds.length&&console.warn(`[AI Manager] Fixed discard count: AI wanted ${g.cardIds.length} but action.count=${_.count}`);const k=c.discardCards(h,j,"opponent");return k.actionRequired?k:lt(k,s)}if(g.type==="rearrangeProtocols"&&_.type==="prompt_rearrange_protocols"){f&&_.sourceCardId==="CONTROL_MECHANIC"&&_.actor&&f(_.actor);const C=c.resolveRearrangeProtocols(h,g.newOrder);return lt(C,s)}if(_.type==="reveal_opponent_hand"){const C=c.revealOpponentHand(h);return lt(C,s)}if(g.type==="resolveOptionalEffectPrompt"&&_.type==="prompt_optional_draw"){const C=au(h,g.accept);return C.actionRequired?C:lt(C,s)}if(g.type==="resolveOptionalEffectPrompt"&&_.type==="prompt_optional_effect"){const C=ou(h,g.accept);return C.actionRequired?C:lt(C,s)}if(g.type==="resolveCustomChoice"&&_.type==="custom_choice"){const C=lu(h,g.optionIndex);return C.actionRequired?C:lt(C,s)}if(g.type==="selectLane"){const{nextState:C,requiresAnimation:b}=p(h,g.laneIndex);if(b){const j=h.phase==="start";return d(b.animationRequests,()=>{n(k=>{const E={...k,animationState:null},T=b.onCompleteCallback(E,U=>U);return T.actionRequired&&T.actionRequired.actor==="opponent"?{...T,animationState:null}:{...j?s.continueTurnAfterStartPhaseAction(T):s.processEndOfAction(T),animationState:null}})}),C}return lt(C,s)}if(g.type==="deleteCard"||g.type==="flipCard"||g.type==="returnCard"||g.type==="shiftCard"||g.type==="selectCard"){const{nextState:C,requiresAnimation:b}=u(h,g.cardId);if(b){const j=h.phase==="start";return d(b.animationRequests,()=>{n(k=>{const E={...k,animationState:null},T=b.onCompleteCallback(E,U=>U);return T.actionRequired&&T.actionRequired.actor==="opponent"?{...T,animationState:null}:{...j?s.continueTurnAfterStartPhaseAction(T):s.processEndOfAction(T),animationState:null}})}),C}return C.actionRequired&&C.actionRequired.actor==="opponent"?C:lt(C,s)}if(g.type==="playCard"&&_.type==="select_card_from_hand_to_play")return sy(h,g,n,r,c,d,s,!1);if(g.type==="stateNumber"&&_.type==="state_number"){const C=yu(h,g.number);return C.actionRequired&&C.actionRequired.actor==="opponent"?C:lt(C,s)}if(g.type==="stateProtocol"&&_.type==="state_protocol"){const C=gu(h,g.protocol);return C.actionRequired&&C.actionRequired.actor==="opponent"?C:lt(C,s)}if(g.type==="selectFromDrawnToReveal"&&_.type==="select_from_drawn_to_reveal"){const C=vu(h,g.cardId);return C.actionRequired&&C.actionRequired.actor==="opponent"?C:lt(C,s)}if(g.type==="confirmDeckDiscard"&&_.type==="confirm_deck_discard"){const C=_u(h);return C.actionRequired&&C.actionRequired.actor==="opponent"?C:lt(C,s)}if(g.type==="confirmDeckPlayPreview"&&_.type==="confirm_deck_play_preview"){const C=wu(h);return C.actionRequired&&C.actionRequired.actor==="opponent"?C:lt(C,s)}if(_.type==="execute_conditional_followup"){const{sourceCardId:C,laneIndex:b,followUpEffect:j,context:k,actor:E,logSource:T,logPhase:F,logIndentLevel:U}=_,D=Te(h,C);if(!D){let z={...h};return T!==void 0&&(z._currentEffectSource=T),F!==void 0&&(z._currentPhaseContext=F),U!==void 0&&(z._logIndentLevel=U),z=ae(z,E,"Follow-up effect skipped (source no longer active)."),z.actionRequired=null,lt(z,s)}let I={...h,actionRequired:null};return I=pt(D.card,b,I,k,j).newState,I.actionRequired?I:lt(I,s)}console.warn(`AI has no logic for mandatory action during player turn, clearing it: ${_.type}, aiDecision: ${JSON.stringify(g)}`);const x={...h,actionRequired:null};return lt(x,s)})},$x=(t,n,r,c,s,d,u)=>{const p=t.actionRequired,f=Ac(t,t.actionRequired,r);if(f.type==="skip"){const _=c.skipAction(t),y=t.phase==="start"?d.continueTurnAfterStartPhaseAction(_):d.processEndOfAction(_);return!y.actionRequired&&y.turn==="opponent"&&!y.winner&&setTimeout(()=>{Ln(y,n,r,c,s,d,u)},500),y}if(f.type==="resolveControlMechanicPrompt"&&p.type==="prompt_use_control_mechanic"){const{choice:_}=f,{originalAction:y,actor:m}=p;if(_==="skip"){let g=ae(t,m,"Opponent skips rearranging protocols.");if(g.actionRequired=null,g={...g,_logIndentLevel:0},y.type==="compile"){const x=y.laneIndex;return setTimeout(()=>{n(C=>{const b=c.compileLane(C,x);return b.winner?b:{...d.processEndOfAction(b),animationState:null}})},1e3),{...g,animationState:{type:"compile",laneIndex:x},compilableLanes:[]}}else if(y.type==="fill_hand"){const x=c.fillHand(g,m);return d.processEndOfAction(x)}else return d.processEndOfAction(g)}else{const g=_;let b=ae(t,m,`Opponent chooses to rearrange ${g==="opponent"?"the player's":"their own"} protocols.`);return b.actionRequired={type:"prompt_rearrange_protocols",sourceCardId:"CONTROL_MECHANIC",target:g,actor:m,originalAction:y},b}}if(f.type==="resolveOptionalDiscardCustomPrompt"&&p.type==="prompt_optional_discard_custom"){const _=c.resolveOptionalDiscardCustomPrompt(t,f.accept);return _.actionRequired?_:lt(_,d)}if(f.type==="resolveOptionalEffectPrompt"&&p.type==="prompt_optional_draw"){const _=c.resolveOptionalDrawPrompt(t,f.accept);return _.actionRequired?_:lt(_,d)}if(f.type==="resolveOptionalEffectPrompt"){const _=c.resolveOptionalEffectPrompt(t,f.accept);return _.actionRequired?_:lt(_,d)}if(f.type==="resolvePrompt"&&p.type==="prompt_optional_shuffle_trash"){if(!f.accept){let y={...t};return y.actionRequired=null,y=ae(y,p.actor,`${p.actor==="player"?"Player":"Opponent"} skips shuffling trash into deck.`),lt(y,d)}const _=Vm(t,p.actor,"Clarity-4");return lt(_.newState,d)}if(f.type==="resolveSwapProtocols"&&p.type==="prompt_swap_protocols"){const _=c.resolveSwapProtocols(t,f.indices);return lt(_,d)}if(f.type==="resolveCustomChoice"&&p.type==="custom_choice"){const _=c.resolveCustomChoice(t,f.optionIndex);return _.actionRequired?_:lt(_,d)}if(f.type==="resolveRevealBoardCardPrompt"&&(p.type==="prompt_shift_or_flip_revealed_card"||p.type==="prompt_shift_or_flip_board_card_custom")){const _=ru(t,f.choice);return _.actionRequired?_:lt(_,d)}if(f.type==="rearrangeProtocols"&&p.type==="prompt_rearrange_protocols"){u&&p.sourceCardId==="CONTROL_MECHANIC"&&p.actor&&u(p.actor);const _=c.resolveRearrangeProtocols(t,f.newOrder);return lt(_,d)}if(f.type==="selectLane"){const{nextState:_,requiresAnimation:y}=kc(t,f.laneIndex);if(y){const{animationRequests:m,onCompleteCallback:g}=y;return s(m,()=>{n(x=>{const C={...x,animationState:null};return g(C,b=>{const j={...b,animationState:null},E={...t.phase==="start"?d.continueTurnAfterStartPhaseAction(j):d.processEndOfAction(j),animationState:null};return!E.actionRequired&&E.turn==="opponent"&&!E.winner?setTimeout(()=>{Ln(E,n,r,c,s,d,u)},500):E.actionRequired&&E.turn==="opponent"&&setTimeout(()=>{Ln(E,n,r,c,s,d,u)},300),E})})}),_}return lt(_,d)}if(f.type==="flipCard"||f.type==="deleteCard"||f.type==="returnCard"||f.type==="shiftCard"||f.type==="selectCard"){const{nextState:_,requiresAnimation:y,requiresTurnEnd:m}=nu(t,f.cardId);if(y){const{animationRequests:g,onCompleteCallback:x}=y;return s(g,()=>{n(C=>{const b={...C,animationState:null};return x(b,j=>{const k={...j,animationState:null};if(k.queuedActions&&k.queuedActions.length>0){const E=d.processEndOfAction(k);return E.actionRequired?(Ln(E,n,r,c,s,d),{...E,animationState:null}):{...E,animationState:null}}if(k.actionRequired)return Ln(k,n,r,c,s,d),k;if(k.phase==="start"){const T={...d.continueTurnAfterStartPhaseAction(k),animationState:null};return!T.actionRequired&&T.turn==="opponent"&&!T.winner&&setTimeout(()=>{Ln(T,n,r,c,s,d,u)},500),T}else return{...d.processEndOfAction(k),animationState:null}})})}),_}return m||_.queuedActions&&_.queuedActions.length>0?lt(_,d):_}if(f.type==="playCard"&&p.type==="select_card_from_hand_to_play")return sy(t,f,n,r,c,s,d,!0);if(f.type==="discardCards"&&p.type==="discard"){const y=p.variableCount===!0?f.cardIds.length:p.count,m=f.cardIds.slice(0,y);m.length!==f.cardIds.length&&console.warn(`[AI Manager] Fixed discard count: AI wanted ${f.cardIds.length} but action.count=${p.count}`);const g=c.discardCards(t,m,"opponent");return g.actionRequired?g:lt(g,d)}if(f.type==="giveCard"&&p.type==="select_card_from_hand_to_give"){const _=c.resolveActionWithHandCard(t,f.cardId);return _.actionRequired?_:lt(_,d)}if(f.type==="revealCard"&&p.type==="select_card_from_hand_to_reveal")return c.resolveActionWithHandCard(t,f.cardId);if(f.type==="selectRevealedDeckCard"&&p.type==="select_card_from_revealed_deck"){const _=Wm(t,f.cardId);return lt(_,d)}if(f.type==="confirmRevealDeckDrawProtocol"&&p.type==="reveal_deck_draw_protocol"){const _=Qm(t);return lt(_,d)}if(f.type==="stateNumber"&&p.type==="state_number"){const _=yu(t,f.number);return _.actionRequired?_:lt(_,d)}if(f.type==="stateProtocol"&&p.type==="state_protocol"){const _=gu(t,f.protocol);return _.actionRequired?_:lt(_,d)}if(f.type==="selectFromDrawnToReveal"&&p.type==="select_from_drawn_to_reveal"){const _=vu(t,f.cardId);return _.actionRequired?_:lt(_,d)}if(f.type==="confirmDeckDiscard"&&p.type==="confirm_deck_discard"){const _=_u(t);return _.actionRequired?_:lt(_,d)}if(f.type==="confirmDeckPlayPreview"&&p.type==="confirm_deck_play_preview"){const _=wu(t);return _.actionRequired?_:lt(_,d)}if(f.type==="selectTrashCard"&&p.type==="select_card_from_trash_to_play"){const _=Xm(t,f.cardIndex);return _.actionRequired?_:lt(_,d)}if(f.type==="selectTrashCard"&&p.type==="select_card_from_trash_to_reveal"){const _=Zm(t,f.cardIndex);return _.actionRequired?_:lt(_,d)}console.warn(`AI has no logic for mandatory action, clearing it: ${p.type}`);const h={...t,actionRequired:null};return lt(h,d)},Ln=(t,n,r,c,s,d,u)=>{n(p=>{if(p.turn!=="opponent"||p.winner||p.animationState||!["start","compile","action","hand_limit","end"].includes(p.phase))return p;if(p.actionRequired){const _=p.actionRequired;let y=!1;if((_.type==="discard"&&_.actor==="player"||_.type==="plague_4_opponent_delete"&&_.actor==="opponent"||"actor"in _&&_.actor==="player")&&(y=!0),y)return p}let h={...p};if(h.actionRequired&&h.actionRequired.type==="reveal_opponent_hand"){const _=c.revealOpponentHand(h);return d.processEndOfAction(_)}if(h.phase==="start"&&(h=d.processStartOfTurn(h)),h.actionRequired){const _=$x(h,n,r,c,s,d,u);return!_.actionRequired&&_.turn==="opponent"&&!_.winner&&_.phase!=="hand_limit"&&setTimeout(()=>{Ln(_,n,r,c,s,d,u)},300),_}if(h.phase==="compile"&&h.compilableLanes.length>0){const _=Ac(h,null,r);if(_.type==="compile"){const y=_.laneIndex,m=Ym(h);return m.actionRequired?m:(setTimeout(()=>{n(g=>{const x=c.compileLane(g,y);return x.winner?x:{...d.processEndOfAction(x),animationState:null}})},1e3),{...m,animationState:{type:"compile",laneIndex:y},compilableLanes:[]})}}if(h.phase==="action"){const _=Ac(h,null,r);if(_.type==="fillHand"){const y=Gm(h,"opponent");return y.actionRequired?y:d.processEndOfAction(y)}if(_.type==="playCard"){const{newState:y,animationRequests:m}=c.playCard(h,_.cardId,_.laneIndex,_.isFaceUp,"opponent"),g={...y,animationState:{type:"playCard",cardId:_.cardId,owner:"opponent"}};return setTimeout(()=>{const x=()=>{n(C=>{let b={...C},j={newState:b};if(!b.actionRequired){if(b.queuedEffect){const{card:F,laneIndex:U}=b.queuedEffect,D={cardOwner:"opponent",actor:"opponent",currentTurn:b.turn,opponent:"player",triggerType:"play"};j=hl(F,U,b,D),j.newState.queuedEffect=void 0}}const k=j.animationRequests,E=j.newState,T=()=>{n(F=>{if(F.queuedActions&&F.queuedActions.length>0){const U=d.processEndOfAction(F);return U.actionRequired&&U.turn==="opponent"&&Ln(U,n,r,c,s,d),U}return F.actionRequired&&F.turn==="opponent"?(Ln(F,n,r,c,s,d),F):d.processEndOfAction(F)})};if(k&&k.length>0)return s(k,T),E;if(E.queuedActions&&E.queuedActions.length>0){const F=d.processEndOfAction(E);return F.actionRequired&&F.turn==="opponent"&&Ln(F,n,r,c,s,d),F}return E.actionRequired&&E.turn==="opponent"?(Ln(E,n,r,c,s,d),E):d.processEndOfAction(E)})};n(C=>{const b={...C,animationState:null};return m&&m.length>0?s(m,x):x(),b})},500),g}}return h.phase==="end"||h.phase==="hand_limit"?d.continueTurnProgression(h):d.processEndOfAction(h)})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function Ix(t,n){let r=null,c=null;const s=["player","opponent"];for(const _ of s){for(const y of t[_].lanes){const m=y.find(g=>g.id===n);if(m){r=_,c=m;break}}if(r)break}if(!r||!c)return console.error("Card to delete not found on board:",n),t;const d={...t},u={...d[r]};u.lanes=u.lanes.map(_=>_.filter(y=>y.id!==n));const{id:p,isFaceUp:f,...h}=c;return u.discard=[...u.discard,h],d[r]=u,d}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const qx=(t,n,r,c,s,d="player",u)=>{const[p,f]=ce.useState(()=>{const oe=ns(t,n,s,d);return Re(oe)}),[h,_]=ce.useState(null),y=ce.useRef(!1),m=ce.useRef(0);ce.useEffect(()=>{p.turn!==d&&p.log.length<=4&&f(oe=>{const H=d==="player"?"Player":"Opponent",ne=[...oe.log];return ne.length>0&&(ne[ne.length-1]={player:"player",message:`${H} goes first.`}),{...oe,turn:d,log:ne}})},[d,p.turn,p.log.length]);const g=ce.useCallback(oe=>{switch(oe){case"start":return Um;case"end":return ll;default:return dl}},[]),x=ce.useCallback((oe,H)=>{const ne=J=>{if(J.length===0){H();return}const[ie,...de]=J;ie.type==="delete"?(f(pe=>({...pe,animationState:{type:"deleteCard",cardId:ie.cardId,owner:ie.owner}})),setTimeout(()=>{f(pe=>{if(!(pe.player.lanes.flat().some(je=>je.id===ie.cardId)||pe.opponent.lanes.flat().some(je=>je.id===ie.cardId)))return{...pe,animationState:null};let Fe=Ix(pe,ie.cardId);return Fe=Re(Fe),{...Fe,animationState:null}}),setTimeout(()=>{de.length>0?ne(de):H()},10)},500)):ie.type==="return"?(f(pe=>({...pe,animationState:{type:"returnCard",cardId:ie.cardId,owner:ie.owner}})),setTimeout(()=>{f(pe=>{const Se=pe[ie.owner].lanes.findIndex(Ge=>Ge.some(qe=>qe.id===ie.cardId)),Fe=Se!==-1&&pe[ie.owner].lanes[Se].length>0&&pe[ie.owner].lanes[Se][pe[ie.owner].lanes[Se].length-1].id===ie.cardId,je=pe[ie.owner].lanes.flat().find(Ge=>Ge.id===ie.cardId);if(!je)return{...pe,animationState:null};const Ve=pe[ie.owner].lanes.map(Ge=>Ge.filter(qe=>qe.id!==ie.cardId));let He={...pe,[ie.owner]:{...pe[ie.owner],lanes:Ve,hand:[...pe[ie.owner].hand,je]}};return He=Re(He),Fe&&Se!==-1&&He[ie.owner].lanes[Se].length>0&&(He=ea(He,ie.owner,Se).newState),{...He,animationState:null}}),setTimeout(()=>{de.length>0?ne(de):H()},10)},500)):ie.type==="play"?(f(pe=>({...pe,animationState:{type:"playCard",cardId:ie.cardId,owner:ie.owner}})),setTimeout(()=>{f(pe=>({...pe,animationState:null})),setTimeout(()=>{de.length>0?ne(de):H()},10)},500)):ie.type==="draw"?(f(pe=>({...pe,animationState:{type:"draw",player:ie.player,count:ie.count}})),setTimeout(()=>{f(pe=>({...pe,animationState:null})),setTimeout(()=>{de.length>0?ne(de):H()},10)},500)):setTimeout(()=>{de.length>0?ne(de):H()},10)};ne(oe)},[]),C=(oe,H,ne="player")=>{if(!h||p.turn!=="player"||p.phase!=="action")return;const J=h;_(null),f(ie=>{const de=g(ie.phase),{newState:pe,animationRequests:Se}=jc(ie,J,oe,H,"player",ne),Fe={...pe,animationState:{type:"playCard",cardId:J,owner:"player"}};return setTimeout(()=>{f(je=>{let Ve={...je,animationState:null};return Se&&Se.length>0?(x(Se,()=>{f(He=>de(He))}),Ve):Ve.actionRequired?Ve:de(Ve)})},500),Fe})},b=()=>{p.turn!=="player"||p.phase!=="action"||p.actionRequired||f(oe=>{const H=g(oe.phase),ne=Gm(oe,"player");return ne.actionRequired?ne:H(ne)})},j=ce.useCallback(oe=>{f(H=>{var ne;return((ne=H.actionRequired)==null?void 0:ne.type)!=="discard"||H.actionRequired.actor!=="player"?H:{...H,animationState:{type:"discardCard",owner:"player",cardIds:[oe],originalAction:H.actionRequired}}})},[]),k=ce.useCallback(oe=>{f(H=>{if(H.winner||H.phase!=="compile")return H;const ne=g(H.phase),ie={...Ym(H),animationState:{type:"compile",laneIndex:oe},compilableLanes:[]};return setTimeout(()=>{f(de=>{var je;const pe=ls(de,oe,r);if(pe.winner)return pe;if(((je=pe.actionRequired)==null?void 0:je.type)==="prompt_use_control_mechanic")return{...pe,animationState:null};const Se=pe._compileAnimations;if(Se&&Se.length>0){x(Se,()=>{f(He=>{const Ge={...He};return delete Ge._compileAnimations,{...ne(Ge),animationState:null}})});const Ve={...pe};return delete Ve._compileAnimations,Ve}return{...ne(pe),animationState:null}})},1e3),ie})},[r,g]),E=oe=>{f(H=>{const ne=H.turn,J=g(H.phase),{nextState:ie,requiresAnimation:de,requiresTurnEnd:pe}=nu(H,oe);return de?(x(de.animationRequests,()=>{f(Se=>{const Fe=Se.turn!==ne?je=>je:J;return de.onCompleteCallback(Se,Fe)})}),ie):ie.actionRequired?ie:J(ie)})},T=oe=>{f(H=>{const ne=g(H.phase),{nextState:J,requiresAnimation:ie}=kc(H,oe);return ie?(x(ie.animationRequests,()=>{f(de=>ie.onCompleteCallback(de,ne))}),J):J.actionRequired?J:ne(J)})},F=oe=>{f(H=>{const ne={...H,actionRequired:H.actionRequired?{...H.actionRequired,isFaceDown:!0}:null},J=g(H.phase),{nextState:ie,requiresAnimation:de}=kc(ne,oe);return de?(x(de.animationRequests,()=>{f(pe=>de.onCompleteCallback(pe,J))}),ie):ie.actionRequired?ie:J(ie)})},U=oe=>{f(H=>{const ne=g(H.phase),J=Qd(H,oe);return J.actionRequired?J:ne(J)})},D=oe=>{f(H=>rx(H,oe))},I=()=>{f(oe=>{var J,ie;const H=g(oe.phase);let ne={...oe,animationState:null};return((J=ne.actionRequired)==null?void 0:J.type)==="prompt_shift_or_flip_board_card_custom"?ne=ru(ne,"skip"):ne=xm(ne),((ie=ne.actionRequired)==null?void 0:ie.type)==="plague_4_player_flip_optional"?ne:H(ne)})},W=ce.useCallback(oe=>{f(H=>{var ie;if(((ie=H.actionRequired)==null?void 0:ie.type)!=="prompt_use_control_mechanic")return H;const{originalAction:ne,actor:J}=H.actionRequired;if(oe==="skip"){let de=ae(H,J,"Player skips rearranging protocols.");if(de.actionRequired=null,de={...de,_logIndentLevel:0},ne.type==="compile"){const Se={...de,animationState:{type:"compile",laneIndex:ne.laneIndex},compilableLanes:[]};return setTimeout(()=>{f(Fe=>{const je=ls(Fe,ne.laneIndex,r);return je.winner?je:{...g(je.phase)(je),animationState:null}})},1e3),Se}else if(ne.type==="continue_turn"){let pe={...de};return ne.queuedSpeed2Actions&&ne.queuedSpeed2Actions.length>0&&(pe.queuedActions=[...ne.queuedSpeed2Actions,...pe.queuedActions||[]]),g(pe.phase)(pe)}else if(ne.type==="resume_interrupted_turn"){let pe={...de};return pe._interruptedTurn=ne.interruptedTurn,pe._interruptedPhase=ne.interruptedPhase,ne.queuedSpeed2Actions&&ne.queuedSpeed2Actions.length>0&&(pe.queuedActions=[...ne.queuedSpeed2Actions,...pe.queuedActions||[]]),dl(pe)}else{const pe=is(de,J);return g(pe.phase)(pe)}}else{const de=oe;let Fe=ae(H,J,`${J==="player"?"Player":"Opponent"} chooses to rearrange ${de==="player"?"their own":"the opponent's"} protocols.`);return Fe.actionRequired={type:"prompt_rearrange_protocols",sourceCardId:"CONTROL_MECHANIC",target:de,actor:J,originalAction:ne},Fe}})},[r,g]),z=ce.useCallback(oe=>{f(H=>{const ne=g(H.phase),J=au(H,oe);return J.actionRequired?J:ne(J)})},[g]),V=ce.useCallback(oe=>{f(H=>{var ne;return((ne=H.actionRequired)==null?void 0:ne.type)!=="plague_2_player_discard"?H:{...H,animationState:{type:"discardCard",owner:"player",cardIds:oe,originalAction:H.actionRequired}}})},[]),B=ce.useCallback(oe=>{f(H=>{const ne=g(H.phase),J=Em(H,oe,"player");return ne(J)})},[g]),L=ce.useCallback(oe=>{f(H=>{const ne=g(H.phase),J=jm(H,oe);return oe?J:ne(J)})},[g]),P=ce.useCallback(oe=>{f(H=>{const ne=g(H.phase),J=ou(H,oe);return J.actionRequired?J:ne(J)})},[g]),M=ce.useCallback(oe=>{f(H=>{var de,pe,Se,Fe;const ne=((de=H.actionRequired)==null?void 0:de.type)==="select_cards_from_hand_to_discard_for_fire_4",J=((pe=H.actionRequired)==null?void 0:pe.type)==="discard"&&((Se=H.actionRequired)==null?void 0:Se.variableCount),ie=((Fe=H.actionRequired)==null?void 0:Fe.type)==="discard"&&H.actionRequired.count>1;return!ne&&!J&&!ie?H:{...H,animationState:{type:"discardCard",owner:"player",cardIds:oe,originalAction:H.actionRequired}}})},[]),N=ce.useCallback(oe=>{f(H=>{var ne;return((ne=H.actionRequired)==null?void 0:ne.type)!=="select_cards_from_hand_to_discard_for_hate_1"?H:{...H,animationState:{type:"discardCard",owner:"player",cardIds:oe,originalAction:H.actionRequired}}})},[]),R=ce.useCallback(oe=>{f(H=>{const ne=g(H.phase),J=ru(H,oe);return J.actionRequired?J:ne(J)})},[g]),$=ce.useCallback(oe=>{f(H=>{var ie,de;u&&((ie=H.actionRequired)==null?void 0:ie.sourceCardId)==="CONTROL_MECHANIC"&&((de=H.actionRequired)!=null&&de.actor)&&u(H.actionRequired.actor);const ne=g(H.phase),J=Wd(H,oe,r);return J.winner?J:ne(J)})},[g,r,u]),X=ce.useCallback(oe=>{f(H=>{const ne=g(H.phase),J=lu(H,oe);return J.actionRequired?J:ne(J)})},[g]),G=ce.useCallback(oe=>{f(H=>{const ne=g(H.phase),J=km(H,oe,r);return J.winner?J:ne(J)})},[g,r]),q=ce.useCallback(oe=>{f(H=>{const ne=g(H.phase),J=Wm(H,oe);return J.winner?J:ne(J)})},[g]),Q=ce.useCallback(()=>{f(oe=>{const H=g(oe.phase),ne=Qm(oe);return ne.winner?ne:H(ne)})},[g]),K=ce.useCallback(oe=>{f(H=>{const ne=g(H.phase),J=yu(H,oe);return J.winner?J:ne(J)})},[g]),Z=ce.useCallback(oe=>{f(H=>{const ne=g(H.phase),J=gu(H,oe);return J.winner?J:ne(J)})},[g]),te=ce.useCallback(oe=>{f(H=>{const ne=g(H.phase),J=vu(H,oe);return J.winner?J:ne(J)})},[g]),ee=ce.useCallback(()=>{f(oe=>{const H=g(oe.phase),ne=_u(oe);return ne.winner?ne:H(ne)})},[g]),se=ce.useCallback(()=>{f(oe=>wu(oe))},[]),_e=ce.useCallback(oe=>{f(H=>Xm(H,oe))},[]),fe=ce.useCallback(oe=>{f(H=>Zm(H,oe))},[]),be=ce.useCallback(oe=>{y.current=!1,m.current++,f(H=>{if(typeof oe=="function")return oe(H);const ne=oe;if(ne==="speed-0-interrupt"){const J=["Speed","Life","Water"],ie=["Metal","Death","Hate"];let de=qn(uo(J)),pe=qn(uo(ie));const Se=(Oe,Le,ut)=>{const Qe=Oe.findIndex(Je=>Je.protocol===Le&&Je.value===ut);return Qe>-1?Oe.splice(Qe,1)[0]:Kn.find(Je=>Je.protocol===Le&&Je.value===ut)},Fe=Se(de,"Speed",0),je=Se(pe,"Metal",0),Ve=Se(de,"Speed",1),He=Se(de,"Life",1),Ge=Se(de,"Water",1),qe=Se(de,"Speed",3);let Ne=ns(J,ie,s,d);return Ne.player.lanes=[[],[],[]],Ne.player.lanes[0]=[{...Fe,id:ct(),isFaceUp:!1}],Ne.player.hand=[{...Ve,id:ct(),isFaceUp:!0},{...He,id:ct(),isFaceUp:!0},{...Ge,id:ct(),isFaceUp:!0},{...qe,id:ct(),isFaceUp:!0}],Ne.player.deck=de,Ne.player.discard=[],Ne.opponent.lanes=[[],[],[]],Ne.opponent.hand=[{...je,id:ct(),isFaceUp:!0}],Ne.opponent.deck=pe,Ne.opponent.discard=[],Ne.turn="opponent",Ne.phase="start",Ne.actionRequired=null,Ne.queuedActions=[],Ne=Re(Ne),Ne=ae(Ne,"player","DEBUG: Dynamic Speed-0 interrupt scenario set up. AI will play Metal-0."),Ne}else if(ne==="speed-1-trigger"){const J=["Speed","Life","Water"],ie=["Metal","Death","Hate"];let de=qn(uo(J));const pe=qn(uo(ie)),Fe=((Ge,qe,Ne)=>{const Oe=Ge.findIndex(Le=>Le.protocol===qe&&Le.value===Ne);return Oe>-1?Ge.splice(Oe,1)[0]:Kn.find(Le=>Le.protocol===qe&&Le.value===Ne)})(de,"Speed",1);let je=ns(J,ie,s,d);je.player.lanes=[[],[],[]],je.player.lanes[0]=[{...Fe,id:ct(),isFaceUp:!0}];const{drawnCards:Ve,remainingDeck:He}=Jn(de,[],6);return je.player.hand=Ve.map(Ge=>({...Ge,id:ct(),isFaceUp:!0})),je.player.deck=He,je.player.discard=[],je.opponent.lanes=[[],[],[]],je.opponent.hand=[],je.opponent.deck=pe,je.opponent.discard=[],je.turn="player",je.phase="hand_limit",je.actionRequired={type:"discard",actor:"player",count:1},je.queuedActions=[],je=Re(je),je=ae(je,"player","DEBUG: Speed-1 discard trigger scenario set up."),je}else if(ne==="fire-oncover-test"){const J=["Death","Hate","Water"],ie=["Fire","Plague","Metal"],de=qn(uo(J));let pe=qn(uo(ie));const Se=(Oe,Le,ut)=>{const Qe=Oe.findIndex(Je=>Je.protocol===Le&&Je.value===ut);return Qe>-1?Oe.splice(Qe,1)[0]:Kn.find(Je=>Je.protocol===Le&&Je.value===ut)},Fe=Se(pe,"Fire",0),je=Se(pe,"Fire",2),Ve=Se(pe,"Fire",3),He=Kn.find(Oe=>Oe.protocol==="Death"&&Oe.value===1),Ge=Kn.find(Oe=>Oe.protocol==="Hate"&&Oe.value===2),qe=Kn.find(Oe=>Oe.protocol==="Water"&&Oe.value===3);let Ne=ns(J,ie,s,"opponent");return Ne.player.lanes=[[{...He,id:ct(),isFaceUp:!0}],[{...Ge,id:ct(),isFaceUp:!0}],[{...qe,id:ct(),isFaceUp:!0}]],Ne.player.hand=[],Ne.player.deck=de,Ne.player.discard=[],Ne.opponent.lanes=[[{...Fe,id:ct(),isFaceUp:!0}],[],[]],Ne.opponent.hand=[{...Ve,id:ct(),isFaceUp:!0},{...je,id:ct(),isFaceUp:!0}],Ne.opponent.deck=pe,Ne.opponent.discard=[],Ne.turn="opponent",Ne.phase="action",Ne.actionRequired=null,Ne.queuedActions=[],Ne=Re(Ne),Ne=ae(Ne,"opponent","DEBUG: Fire On-Cover test scenario. Opponent has Fire-0 in play, Fire-3 and Fire-2 in hand. Ready to play Fire-3."),Ne}else if(ne==="speed-2-control-test"){const J=["Speed","Light","Water"],ie=["Fire","Plague","Metal"],de=qn(uo(J)),pe=qn(uo(ie)),Fe=((Ve,He,Ge)=>{const qe=Ve.findIndex(Ne=>Ne.protocol===He&&Ne.value===Ge);return qe>-1?Ve.splice(qe,1)[0]:Kn.find(Ne=>Ne.protocol===He&&Ne.value===Ge)})(de,"Speed",2);let je=ns(J,ie,!0,"player");return je.player.lanes=[[{...Fe,id:ct(),isFaceUp:!0}],[],[]],je.player.protocols[0]="Speed",je.player.laneValues[0]=10,je.player.hand=[],je.player.deck=de,je.player.discard=[],je.controlCardHolder="player",je.opponent.lanes=[[],[],[]],je.opponent.hand=[],je.opponent.deck=pe,je.opponent.discard=[],je.turn="player",je.phase="compile",je.compilableLanes=[0],je.actionRequired=null,je.queuedActions=[],je=Re(je),je=ae(je,"player","DEBUG: Speed-2 + Control test scenario. Player has Speed-2 (value 10), Control Component active. Ready to compile Protocol Speed!"),je}return H})},[s]);return ce.useEffect(()=>{const oe=p.animationState;if(!oe)return;let H=0,ne=!1;if(oe.type==="flipCard"?(H=600,ne=!0):oe.type==="drawCard"?(H=1e3,ne=!0):oe.type==="discardCard"&&(H=800,ne=!0),ne){const J=setTimeout(()=>{f(ie=>({...ie,animationState:null}))},H);return()=>clearTimeout(J)}},[p.animationState]),ce.useEffect(()=>{const oe=p.animationState;if((oe==null?void 0:oe.type)==="discardCard"&&oe.owner==="player"){const H=setTimeout(()=>{f(ne=>{const J=ne.animationState;if((J==null?void 0:J.type)!=="discardCard"||!J.originalAction)return ne;const{cardIds:ie,originalAction:de}=J,pe=g(ne.phase);let Se;return de.type==="plague_2_player_discard"?Se=ox(ne,ie):de.type==="select_cards_from_hand_to_discard_for_fire_4"?Se=Gd(ne,ie):de.type==="select_cards_from_hand_to_discard_for_hate_1"?Se=Yd(ne,ie):de.type==="discard"&&(de.count>1||de.variableCount)?Se=Gd(ne,ie):Se=gr(ne,ie,"player"),Se.animationState=null,Se.actionRequired?Se:pe(Se)})},500);return()=>clearTimeout(H)}},[p.animationState,g]),ce.useEffect(()=>{if(p.turn==="opponent"&&!p.winner&&!p.animationState&&!p._interruptedTurn&&!y.current){y.current=!0;const oe=m.current,H=p,ne=setTimeout(()=>{m.current===oe&&Ln(H,f,c,{compileLane:(J,ie)=>ls(J,ie,r),playCard:jc,fillHand:is,discardCards:gr,flipCard:Sm,deleteCard:(J,ie)=>({newState:J,animationRequests:[{type:"delete",cardId:ie,owner:"opponent"}]}),returnCard:bm,skipAction:xm,resolveOptionalDrawPrompt:au,resolvePlague4Flip:(J,ie)=>Em(J,ie,"opponent"),resolvePlague2Discard:Bd,resolvePlague2OpponentDiscard:Bd,resolveOptionalDiscardCustomPrompt:jm,resolveOptionalEffectPrompt:ou,resolveFire4Discard:Gd,resolveHate1Discard:Yd,resolveRearrangeProtocols:(J,ie)=>Wd(J,ie,r),resolveActionWithHandCard:Qd,resolveSwapProtocols:(J,ie)=>km(J,ie,r),revealOpponentHand:Cm,resolveCustomChoice:lu},x,hm,u)},1500);return()=>{clearTimeout(ne),y.current=!1}}},[p.turn,p.phase,p.winner,p.animationState,p._interruptedTurn,c,r,x,p.actionRequired]),ce.useEffect(()=>{const oe=p.actionRequired,H=p.turn==="player"||p._interruptedTurn==="player",ne=oe&&"actor"in oe&&oe.actor==="opponent";H&&!p.animationState&&ne&&!y.current&&(y.current=!0,Fx(p,f,c,{playCard:jc,discardCards:gr,flipCard:Sm,returnCard:bm,deleteCard:(ie,de)=>({newState:ie,animationRequests:[{type:"delete",cardId:de,owner:"opponent"}]}),resolveActionWithHandCard:Qd,resolveHate1Discard:Yd,resolvePlague2OpponentDiscard:Bd,revealOpponentHand:Cm,resolveRearrangeProtocols:(ie,de)=>Wd(ie,de,r)},hm,x,nu,kc,u),y.current=!1)},[p.actionRequired,p.turn,p.animationState,c,x,r]),ce.useEffect(()=>{f(oe=>{let H=Re(oe);return H.turn==="player"&&H.phase==="start"&&!H.actionRequired?Om(H):H})},[p.turn,p.phase]),{gameState:p,selectedCard:h,setSelectedCard:_,playSelectedCard:C,fillHand:b,discardCardFromHand:j,compileLane:k,resolveActionWithCard:E,resolveActionWithLane:T,resolveActionWithLaneFaceDown:F,selectHandCardForAction:D,skipAction:I,resolvePlague2Discard:V,resolveActionWithHandCard:U,resolvePlague4Flip:B,resolveOptionalDiscardCustomPrompt:L,resolveOptionalEffectPrompt:P,resolveFire4Discard:M,resolveHate1Discard:N,resolveRevealBoardCardPrompt:R,resolveRearrangeProtocols:$,resolveOptionalDrawPrompt:z,resolveSwapProtocols:G,resolveControlMechanicPrompt:W,resolveCustomChoice:X,resolveSelectRevealedDeckCard:q,resolveRevealDeckDrawProtocol:Q,resolveStateNumber:K,resolveStateProtocol:Z,resolveSelectFromDrawnToReveal:te,resolveConfirmDeckDiscard:ee,resolveConfirmDeckPlayPreview:se,resolveSelectTrashCardToPlay:_e,resolveSelectTrashCardToReveal:fe,setupTestScenario:be}},Dm=({cards:t,isPlayable:n,isCompilable:r,isShiftTarget:c,isEffectTarget:s,isMatching:d,onLanePointerDown:u,onPlayFaceDown:p,onCardPointerDown:f,onCardPointerEnter:h,onCardPointerLeave:_,owner:y,animationState:m,isCardTargetable:g,laneIndex:x,sourceCardId:C,gameState:b})=>{const j=["lane"];return n&&j.push("playable"),d&&j.push("matching-protocol"),r&&j.push("compilable"),c&&j.push("shift-target"),s&&j.push("effect-target"),o.jsxs("div",{className:j.join(" "),onPointerDown:u,children:[n&&d&&y==="player"&&p&&o.jsx("button",{className:"btn btn-play-facedown",onPointerDown:k=>{k.stopPropagation(),p()},children:"Play Face-Down"}),o.jsx("div",{className:"lane-stack",children:t.map((k,E)=>{var U;const T=((U=b.actionRequired)==null?void 0:U.type)==="prompt_shift_or_flip_for_light_2"&&b.actionRequired.revealedCardId===k.id,F=fn(k,t,b,x,y);return o.jsx(St,{card:k,isFaceUp:k.isFaceUp||T,style:{"--i":E},onPointerDown:D=>{D.stopPropagation(),f(k)},onPointerEnter:()=>h(k),animationState:m,isTargetable:g(k),isSourceOfEffect:k.id===C,faceDownValue:F},k.id)})})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Ho=(t,n)=>Wo(t,n),fa=(t,n)=>Sn(t).some(({rule:c,laneIndex:s})=>c.type==="block_shifts_from_and_to_lane"&&s===n),Fc=(t,n)=>{const{actionRequired:r}=n;if(!r||"actor"in r&&r.actor!=="player")return!1;let c=null,s=-1,d=[];for(const f of["player","opponent"]){for(let h=0;h<n[f].lanes.length;h++)if(n[f].lanes[h].some(_=>_.id===t.id)){c=f,s=h,d=n[f].lanes[h];break}if(c)break}if(!c)return!1;const u=d.findIndex(f=>f.id===t.id),p=Qo(n,d,u);if(r.type==="select_lane_for_shift"){const f=r.cardToShiftId;return!!(f&&t.id===f)}if(r.type==="shift_flipped_card_optional"){const f=r.cardId;return!!(f&&t.id===f)}switch(r.type){case"select_opponent_face_up_card_to_flip":return c==="opponent"&&t.isFaceUp&&p;case"select_card_to_flip":{if(Ho(n,t.id))return!1;const f=r.targetFilter||{},h=d.findIndex(b=>b.id===t.id),_=r.currentLaneIndex,y=r.laneIndex,m=r.scope,g=r.restrictedLaneIndex;if(_!==void 0&&s!==_||m==="this_lane"&&y!==void 0&&s!==y||g!==void 0&&s!==g)return!1;const x=f.position||"uncovered";if(x==="uncovered"&&!p||x==="covered"&&h>=d.length-1||f.owner==="own"&&c!==r.actor||f.owner==="opponent"&&c===r.actor||f.faceState==="face_up"&&!t.isFaceUp||f.faceState==="face_down"&&t.isFaceUp||f.excludeSelf&&t.id===r.sourceCardId||!rs(n,t.id).allowed)return!1;if(f.valueMinGreaterThanHandSize){const b=n[r.actor].hand.length;if(t.value<=b)return!1}if(f.valueLessThanUniqueProtocolsOnField){const b=vr(n);if(t.value>=b)return!1}return!0}case"select_own_face_up_covered_card_to_flip":{const f=d.findIndex(h=>h.id===t.id);return c==="player"&&t.isFaceUp&&f<d.length-1}case"select_opponent_covered_card_to_shift":{const f=d.findIndex(_=>_.id===t.id),h=n.turn==="player"?"opponent":"player";return fa(n,s)?!1:c===h&&f<d.length-1}case"select_own_covered_card_to_shift":{const f=d.findIndex(h=>h.id===t.id);return fa(n,s)?!1:c===r.actor&&f<d.length-1}case"select_covered_card_in_line_to_flip_optional":{const h=d.findIndex(y=>y.id===t.id)<d.length-1;return Oa(n)&&!t.isFaceUp?!1:s===r.laneIndex&&h}case"select_covered_card_to_flip_for_chaos_0":{const h=d.findIndex(y=>y.id===t.id)<d.length-1;return Oa(n)&&!t.isFaceUp?!1:s===r.laneIndex&&h}case"shift_flipped_card_optional":return fa(n,s)?!1:t.id===r.cardId;case"select_opponent_card_to_flip":return Oa(n)&&!t.isFaceUp?!1:c==="opponent"&&p;case"select_face_down_card_to_shift_for_darkness_4":return fa(n,s)?!1:!t.isFaceUp&&p;case"select_cards_to_delete":{if(Ho(n,t.id)||r.disallowedIds.includes(t.id))return!1;const f=r.allowedIds;if(f&&!f.includes(t.id))return!1;const h=r.currentLaneIndex;if(h!==void 0&&s!==h)return!1;const _=r.targetFilter;if(_){const y=d.findIndex(j=>j.id===t.id),m=_.position||"uncovered";if(m==="uncovered"&&!p||m==="covered"&&y>=d.length-1||_.faceState==="face_up"&&!t.isFaceUp||_.faceState==="face_down"&&t.isFaceUp)return!1;if(_.valueRange){const{min:j,max:k}=_.valueRange;if(t.value<j||t.value>k)return!1}const g=r.actorChooses,x=r.sourceCardId;let C=null;for(const j of["player","opponent"])if(n[j].lanes.flat().some(k=>k.id===x)){C=j;break}if(g==="card_owner"&&C){if(_.owner==="own"&&c!==C||_.owner==="opponent"&&c===C)return!1}else if(_.owner==="own"&&c!==r.actor||_.owner==="opponent"&&c===r.actor)return!1;const b=r.protocolMatching;if(b){const j=n.player.protocols[s],k=n.opponent.protocols[s],E=t.protocol,T=E===j||E===k;if(b==="must_match"&&!T||b==="must_not_match"&&T)return!1}return!0}return p}case"select_face_down_card_to_delete":return!t.isFaceUp&&p;case"select_low_value_card_to_delete":return t.isFaceUp&&(t.value===0||t.value===1)&&p;case"select_card_from_other_lanes_to_delete":{if(Ho(n,t.id))return!1;const{disallowedLaneIndex:f,lanesSelected:h}=r;return s!==f&&!h.includes(s)&&p}case"plague_4_opponent_delete":return(n.turn==="player"?"opponent":"player")==="player"?c==="player"&&!t.isFaceUp&&p:!1;case"select_any_other_card_to_flip":return Oa(n)&&!t.isFaceUp?!1:t.id!==r.sourceCardId&&p;case"select_card_to_return":{if(Ho(n,t.id))return!1;const f=r.targetOwner||"any",h=r.targetFilter,_=r.actor,y=(h==null?void 0:h.position)||"uncovered",g=d.findIndex(C=>C.id===t.id)<d.length-1;if(y==="uncovered"&&!p||y==="covered"&&!g)return!1;const x=h==null?void 0:h.faceState;return x==="face_up"&&!t.isFaceUp||x==="face_down"&&t.isFaceUp?!1:f==="own"?c===_:f==="opponent"?c!==_:!0}case"select_card_to_shift_for_gravity_1":return Ho(n,t.id)||fa(n,s)?!1:p;case"select_face_down_card_to_shift_for_gravity_4":return fa(n,s)?!1:!t.isFaceUp&&s!==r.targetLaneIndex&&p;case"select_any_card_to_flip":case"select_any_card_to_flip_optional":return Oa(n)&&!t.isFaceUp||!rs(n,t.id).allowed?!1:p;case"select_any_face_down_card_to_flip_optional":return rs(n,t.id).allowed?!t.isFaceUp&&p:!1;case"select_board_card_to_reveal_custom":{const f=r.targetFilter;if(!f)return!t.isFaceUp&&p;const h=d.findIndex(y=>y.id===t.id),_=f.position||"uncovered";return!(_==="uncovered"&&!p||_==="covered"&&h>=d.length-1||f.owner==="own"&&c!==r.actor||f.owner==="opponent"&&c===r.actor||f.faceState==="face_up"&&!t.isFaceUp||f.faceState==="face_down"&&t.isFaceUp)}case"select_own_other_card_to_shift":return fa(n,s)?!1:c===r.actor&&t.id!==r.sourceCardId&&p;case"select_opponent_face_down_card_to_shift":return fa(n,s)?!1:c!==r.actor&&!t.isFaceUp&&p;case"select_any_opponent_card_to_shift":return fa(n,s)?!1:c!==r.actor&&p;case"select_opponent_card_to_return":return c==="opponent"&&p;case"select_card_to_shift_for_anarchy_1":return Ho(n,t.id)||fa(n,s)?!1:p;case"select_card_to_shift_for_anarchy_0":return Ho(n,t.id)||fa(n,s)?!1:p;case"select_card_to_shift":{if(Ho(n,t.id)||fa(n,s))return!1;const f=r.targetFilter||{},h=r.destinationRestriction,_=r.scope,y=r.sourceLaneIndex;if(_==="this_lane"&&y!==void 0&&s!==y||(h==null?void 0:h.type)==="non_matching_protocol"&&!t.isFaceUp)return!1;const m=f.position||"uncovered",x=d.findIndex(C=>C.id===t.id)<d.length-1;return!(m==="uncovered"&&!p||m==="covered"&&!x||f.owner==="own"&&c!==r.actor||f.owner==="opponent"&&c===r.actor||f.faceState==="face_up"&&!t.isFaceUp||f.faceState==="face_down"&&t.isFaceUp||f.excludeSelf&&t.id===r.sourceCardId)}case"select_phase_effect":return r.availableEffects.some(h=>h.cardId===t.id);case"select_card_for_copy_middle":return(r.validTargetIds||[]).includes(t.id);default:return!1}},Lx=({gameState:t,onLanePointerDown:n,onPlayFaceDown:r,onCardPointerDown:c,onCardPointerEnter:s,onCardPointerLeave:d,onOpponentHandCardPointerEnter:u,onOpponentHandCardPointerLeave:p,selectedCardId:f,sourceCardId:h})=>{const{player:_,opponent:y,animationState:m,phase:g,turn:x,compilableLanes:C,actionRequired:b,controlCardHolder:j}=t,k=z=>{var be,oe,H,ne,J,ie;const V=g==="compile"&&x==="player"&&!b&&C.includes(z),B=x==="player",L=g==="action"&&!b&&f,P=(b==null?void 0:b.type)==="select_lane_for_play";if(!(P?(b==null?void 0:b.actor)==="player":B)||!L&&!P)return{isPlayable:!1,isMatching:!1,isCompilable:V};let N;if(L)N=_.hand.find(de=>de.id===f);else if(P){if(b.disallowedLaneIndex!==void 0&&z===b.disallowedLaneIndex)return{isPlayable:!1,isMatching:!1,isCompilable:V};const de=b.validLanes;if(de&&!de.includes(z))return{isPlayable:!1,isMatching:!1,isCompilable:V};if(b.source==="deck")return b.excludeCurrentLane&&z===b.currentLaneIndex?{isPlayable:!1,isMatching:!1,isCompilable:V}:{isPlayable:!0,isMatching:!1,isCompilable:V};if(b.source==="trash"){const pe=b.useNormalPlayRules,Se=b.preDrawnCard;if(pe&&Se){const Fe=_.protocols[z],je=y.protocols[z];return{isPlayable:!0,isMatching:Se.protocol===Fe||Se.protocol===je,isCompilable:V}}return{isPlayable:!0,isMatching:!1,isCompilable:V}}N=_.hand.find(pe=>pe.id===b.cardInHandId)}if(!N)return{isPlayable:!1,isMatching:!1,isCompilable:V};const R=y.lanes[z];if(R.length>0&&R[R.length-1].isFaceUp&&R[R.length-1].protocol==="Plague"&&R[R.length-1].value===0)return{isPlayable:!1,isMatching:!1,isCompilable:V};const X=y.lanes.flat().some(de=>de.isFaceUp&&de.protocol==="Psychic"&&de.value===1),G=_.lanes.flat().some(de=>de.isFaceUp&&de.protocol==="Spirit"&&de.value===1),q=((oe=(be=N.customEffects)==null?void 0:be.bottomEffects)==null?void 0:oe.some(de=>{var pe,Se;return((pe=de.params)==null?void 0:pe.action)==="card_property"&&((Se=de.params)==null?void 0:Se.property)==="ignore_protocol_matching"}))||((ne=(H=N.customEffects)==null?void 0:H.topEffects)==null?void 0:ne.some(de=>{var pe,Se;return((pe=de.params)==null?void 0:pe.action)==="card_property"&&((Se=de.params)==null?void 0:Se.property)==="ignore_protocol_matching"}))||((ie=(J=N.customEffects)==null?void 0:J.middleEffects)==null?void 0:ie.some(de=>{var pe,Se;return((pe=de.params)==null?void 0:pe.action)==="card_property"&&((Se=de.params)==null?void 0:Se.property)==="ignore_protocol_matching"})),Q=[..._.lanes.flat(),...y.lanes.flat()].some(de=>de.isFaceUp&&de.protocol==="Anarchy"&&de.value===1),K=pu(t),Z=Ic(t,"player",z),te=cl(t,N),ee=fl(t,"player",z,N.protocol),se=P&&b.ignoreProtocolMatching;let _e;return te||se?_e=!X:Q||K?_e=N.protocol!==_.protocols[z]&&N.protocol!==y.protocols[z]&&!X:_e=(G||Z||q||ee||N.protocol===_.protocols[z]||N.protocol===y.protocols[z])&&!X,R.some(de=>de.isFaceUp&&de.protocol==="Metal"&&de.value===2)&&!_e?{isPlayable:!1,isMatching:!1,isCompilable:V}:P&&(b.isFaceDown||b.faceDown)?{isPlayable:!0,isMatching:!1,isCompilable:V}:{isPlayable:!0,isMatching:_e,isCompilable:V}},E=z=>{if(!(x==="player")||!(g==="action"&&!b&&f))return{isPlayable:!1,isMatching:!1};const L=_.hand.find(N=>N.id===f);if(!L)return{isPlayable:!1,isMatching:!1};if(!cl(t,L))return{isPlayable:!1,isMatching:!1};const P=_.lanes[z];return P.length>0&&P[P.length-1].isFaceUp&&P[P.length-1].protocol==="Plague"&&P[P.length-1].value===0?{isPlayable:!1,isMatching:!1}:{isPlayable:!0,isMatching:!0}},T=z=>{if(!b||b.actor!=="player")return!1;switch(b.type){case"select_lane_for_delete":{const V=b.validLanes;return!(V&&!V.includes(z))}case"select_lane_for_death_2":case"select_lane_for_water_3":case"select_lane_for_return":return!0;case"select_lane_for_metal_3_delete":return z===b.disallowedLaneIndex?!1:_.lanes[z].length+y.lanes[z].length>=8;case"select_lane_for_delete_all":return(b.validLanes||[]).includes(z);case"select_lanes_for_swap_stacks":return(b.validLanes||[]).includes(z);default:return!1}},F=(z,V)=>{if(!b||b.actor!=="player")return!1;const B=b.type==="select_lane_for_shift"?b.originalLaneIndex:(b.type==="select_card_to_shift",-1);if(B!==-1&&!ss(t,B,z).allowed)return!1;switch(b.type){case"select_lane_for_shift":{if(V!==b.cardOwner||z===b.originalLaneIndex)return!1;const L=b.validLanes;if(L&&!L.includes(z))return!1;const P=[...t.player.lanes.flat(),...t.opponent.lanes.flat()].find(N=>N.id===b.sourceCardId),M=b.destinationRestriction;if(M&&M.type==="to_or_from_this_lane"){let N=M.laneIndex;if(M.laneIndex==="current"&&P)for(const R of["player","opponent"]){for(let $=0;$<t[R].lanes.length;$++)if(t[R].lanes[$].some(X=>X.id===b.sourceCardId)){N=$;break}if(typeof N=="number")break}if(typeof N=="number"&&!(b.originalLaneIndex===N)&&!(z===N))return!1}else if(P&&P.protocol==="Gravity"&&P.value===1){let N=-1;for(const R of["player","opponent"]){for(let $=0;$<t[R].lanes.length;$++)if(t[R].lanes[$].some(X=>X.id===b.sourceCardId)){N=$;break}if(N!==-1)break}if(N!==-1&&!(b.originalLaneIndex===N)&&!(z===N))return!1}return!0}case"shift_flipped_card_optional":{const L=b.cardId;let P=null,M=-1;for(let N=0;N<_.lanes.length;N++)if(_.lanes[N].some(R=>R.id===L)){P="player",M=N;break}if(P===null){for(let N=0;N<y.lanes.length;N++)if(y.lanes[N].some(R=>R.id===L)){P="opponent",M=N;break}}return V!==P?!1:z!==M}case"select_lane_for_life_3_play":return V==="player"&&z!==b.disallowedLaneIndex;case"select_lane_to_shift_revealed_card_for_light_2":return V==="player";case"select_lane_to_shift_revealed_board_card_custom":{const L=b.revealedCardId;if(![...t.player.lanes.flat(),...t.opponent.lanes.flat()].find(R=>R.id===L))return!1;let M=null,N=-1;for(const R of["player","opponent"]){for(let $=0;$<t[R].lanes.length;$++)if(t[R].lanes[$].some(X=>X.id===L)){M=R,N=$;break}if(M)break}return V===M&&z!==N}case"select_lane_for_shift_all":{const L=b.sourceLaneIndex;return z!==L}case"select_lane_to_shift_cards_for_light_3":return z!==b.sourceLaneIndex;default:return!1}},U=(z,V,B)=>{let L=[z];return V&&L.push("compiled"),(m==null?void 0:m.type)==="compile"&&m.laneIndex===B&&L.push("is-compiling"),L.join(" ")},D=()=>j==="player"?"player-controlled":j==="opponent"?"opponent-controlled":"neutral",I=()=>j==="player"?"Player has control.":j==="opponent"?"Opponent has control.":"Control is neutral.",W=()=>j==="player"?"Control Player":j==="opponent"?"Control Opponent":"Control Neutral";return o.jsxs("div",{className:"game-board",children:[o.jsx("div",{className:"opponent-hand-area",children:y.hand.map(z=>o.jsx(St,{card:z,isFaceUp:z.isRevealed||!1,additionalClassName:"in-hand",onPointerEnter:()=>u(z)},z.id))}),o.jsx("div",{className:`player-side opponent-side ${x==="opponent"?"active-turn":""}`,children:o.jsx("div",{className:"lanes",children:y.lanes.map((z,V)=>{const{isPlayable:B,isMatching:L}=E(V);return o.jsx(Dm,{cards:z,isPlayable:B,isMatching:L,isCompilable:!1,isShiftTarget:F(V,"opponent"),isEffectTarget:T(V),onLanePointerDown:()=>n(V,"opponent"),onCardPointerDown:P=>c(P,"opponent",V),onCardPointerEnter:P=>s(P,"opponent"),onCardPointerLeave:()=>d(),owner:"opponent",animationState:m,isCardTargetable:P=>Fc(P,t),laneIndex:V,sourceCardId:h,gameState:t},`opp-lane-${V}`)})})}),o.jsxs("div",{className:"protocol-bars-container",children:[t.useControlMechanic&&o.jsxs("div",{className:"control-coin-container",children:[o.jsx("div",{className:`control-coin ${D()}`,title:I(),children:"C"}),o.jsx("div",{className:`control-coin-label ${D()}`,children:W()})]}),o.jsx("div",{className:`protocol-bar opponent-bar ${x==="opponent"?"active-turn":""}`,children:y.protocols.map((z,V)=>o.jsxs("div",{className:U("protocol-display",y.compiled[V],V),children:[o.jsx("span",{className:"protocol-name",children:z}),o.jsx("span",{className:"protocol-value",children:y.laneValues[V]})]},`opp-proto-${z}-${V}`))}),o.jsx("div",{className:`protocol-bar player-bar ${x==="player"?"active-turn":""}`,children:_.protocols.map((z,V)=>o.jsxs("div",{className:U("protocol-display",_.compiled[V],V),children:[o.jsx("span",{className:"protocol-name",children:z}),o.jsx("span",{className:"protocol-value",children:_.laneValues[V]})]},`player-proto-${z}-${V}`))})]}),o.jsx("div",{className:`player-side ${x==="player"?"active-turn":""}`,children:o.jsx("div",{className:"lanes",children:_.lanes.map((z,V)=>{const{isPlayable:B,isMatching:L,isCompilable:P}=k(V);return o.jsx(Dm,{cards:z,isPlayable:B,isMatching:L,isCompilable:P,isShiftTarget:F(V,"player"),isEffectTarget:T(V),onLanePointerDown:()=>n(V,"player"),onPlayFaceDown:()=>r(V),onCardPointerDown:M=>c(M,"player",V),onCardPointerEnter:M=>s(M,"player"),onCardPointerLeave:()=>d(),owner:"player",animationState:m,isCardTargetable:M=>Fc(M,t),laneIndex:V,sourceCardId:h,gameState:t},`player-lane-${V}`)})})})]})},Px=({gameState:t,onFillHand:n,onSkipAction:r,onResolvePlague2Discard:c,onResolvePlague4Flip:s,onResolveFire3Prompt:d,onResolveOptionalDiscardCustomPrompt:u,onResolveOptionalEffectPrompt:p,onResolveFire4Discard:f,onResolveHate1Discard:h,onResolveRevealBoardCardPrompt:_,onResolveOptionalDrawPrompt:y,onResolveDeath1Prompt:m,onResolveLove1Prompt:g,onResolvePsychic4Prompt:x,onResolveSpirit1Prompt:C,onResolveControlMechanicPrompt:b,onResolveCustomChoice:j,selectedCardId:k,multiSelectedCardIds:E,actionRequiredClass:T})=>{const{phase:F,turn:U,actionRequired:D,player:I,compilableLanes:W}=t,z=R=>{for(const $ of["player","opponent"])for(const X of t[$].lanes){const G=X.find(q=>q.id===R);if(G)return G}return null},V=D==null?void 0:D.sourceCardId,B=V?z(V):null,L=(D==null?void 0:D.actor)||U,P=L.charAt(0).toUpperCase()+L.slice(1),M=()=>{var R,$,X,G;if(U!=="player"&&(!D||D.actor!=="player"))return o.jsx("button",{className:"btn",disabled:!0,children:"Processing..."});if((D==null?void 0:D.type)==="prompt_use_control_mechanic")return o.jsxs(o.Fragment,{children:[o.jsx("button",{className:"btn",onClick:()=>b("player"),children:"Rearrange Own"}),o.jsx("button",{className:"btn",onClick:()=>b("opponent"),children:"Rearrange Opponent's"}),o.jsx("button",{className:"btn btn-back",onClick:()=>b("skip"),children:"Skip"})]});if((D==null?void 0:D.type)==="prompt_optional_draw")return o.jsxs(o.Fragment,{children:[o.jsx("button",{className:"btn",onClick:()=>y(!0),children:"Draw"}),o.jsx("button",{className:"btn btn-back",onClick:()=>y(!1),children:"Skip"})]});if((D==null?void 0:D.type)==="prompt_death_1_effect")return o.jsxs(o.Fragment,{children:[o.jsx("button",{className:"btn",onClick:()=>m(!0),children:"Draw & Delete"}),o.jsx("button",{className:"btn btn-back",onClick:()=>m(!1),children:"Skip"})]});if((D==null?void 0:D.type)==="prompt_give_card_for_love_1")return o.jsxs(o.Fragment,{children:[o.jsx("button",{className:"btn",onClick:()=>g(!0),children:"Give 1 Card"}),o.jsx("button",{className:"btn btn-back",onClick:()=>g(!1),children:"Skip"})]});if((D==null?void 0:D.type)==="prompt_fire_3_discard")return o.jsxs(o.Fragment,{children:[o.jsx("button",{className:"btn",onClick:()=>d(!0),children:"Discard 1 Card"}),o.jsx("button",{className:"btn btn-back",onClick:()=>d(!1),children:"Skip"})]});if((D==null?void 0:D.type)==="prompt_optional_discard_custom")return o.jsxs(o.Fragment,{children:[o.jsxs("button",{className:"btn",onClick:()=>u(!0),children:["Discard ",D.count," Card(s)"]}),o.jsx("button",{className:"btn btn-back",onClick:()=>u(!1),children:"Skip"})]});if((D==null?void 0:D.type)==="prompt_optional_effect"){const q=(($=(R=D.effectDef)==null?void 0:R.params)==null?void 0:$.action)||"effect",Q=(G=(X=D.effectDef)==null?void 0:X.params)==null?void 0:G.count,K=Q?`${q} ${Q}`:q;return o.jsxs(o.Fragment,{children:[o.jsxs("button",{className:"btn",onClick:()=>p(!0),children:["Execute (",K,")"]}),o.jsx("button",{className:"btn btn-back",onClick:()=>p(!1),children:"Skip"})]})}if((D==null?void 0:D.type)==="prompt_spirit_1_start")return o.jsxs(o.Fragment,{children:[o.jsx("button",{className:"btn",onClick:()=>C("discard"),children:"Discard 1"}),o.jsx("button",{className:"btn btn-back",onClick:()=>C("flip"),children:"Flip Card"})]});if((D==null?void 0:D.type)==="custom_choice"){const q=D.options||[];if(q.length===2){const Q=q[0].params,K=q[1].params,Z=te=>te.action==="discard"?`Discard ${te.count||1}`:te.action==="flip"&&te.flipSelf?"Flip This Card":te.action==="draw"?`Draw ${te.count||1}`:te.action==="delete"&&te.deleteSelf?"Delete This Card":te.action==="delete"?`Delete ${te.count||1}`:te.action==="return"?`Return ${te.count||1}`:te.action==="shift"?"Shift":te.action||"Option";return o.jsxs(o.Fragment,{children:[o.jsx("button",{className:"btn",onClick:()=>j(0),children:Z(Q)}),o.jsx("button",{className:"btn btn-back",onClick:()=>j(1),children:Z(K)})]})}}if((D==null?void 0:D.type)==="prompt_return_for_psychic_4")return o.jsxs(o.Fragment,{children:[o.jsx("button",{className:"btn",onClick:()=>x(!0),children:"Return Card"}),o.jsx("button",{className:"btn btn-back",onClick:()=>x(!1),children:"Skip"})]});if((D==null?void 0:D.type)==="prompt_shift_or_flip_board_card_custom")return o.jsxs(o.Fragment,{children:[o.jsx("button",{className:"btn",onClick:()=>_("shift"),children:"Shift"}),o.jsx("button",{className:"btn",onClick:()=>_("flip"),children:"Flip"}),o.jsx("button",{className:"btn btn-back",onClick:()=>_("skip"),children:"Skip"})]});if((D==null?void 0:D.type)==="discard"&&D.actor==="player"){const q=D.count,Q=D.variableCount;if(q>1||Q){const K=Q?1:q;return o.jsxs("button",{className:"btn",onClick:()=>f(E),disabled:E.length<K,children:["Confirm Discard (",E.length,"/",Q?"?":q,")"]})}}if((D==null?void 0:D.type)==="plague_2_player_discard"||(D==null?void 0:D.type)==="select_cards_from_hand_to_discard_for_fire_4"||(D==null?void 0:D.type)==="select_cards_from_hand_to_discard_for_hate_1"){let q,Q=0;return D.type==="plague_2_player_discard"?(q=c,Q=1):D.type==="select_cards_from_hand_to_discard_for_fire_4"?(q=f,Q=1):(q=h,Q=D.count),o.jsxs("button",{className:"btn",onClick:()=>q(E),disabled:E.length<Q,children:["Confirm Discard (",E.length,")"]})}if((D==null?void 0:D.type)==="plague_4_player_flip_optional")return o.jsxs(o.Fragment,{children:[o.jsx("button",{className:"btn",onClick:()=>s(!0),children:"Flip Plague-4"}),o.jsx("button",{className:"btn btn-back",onClick:()=>s(!1),children:"Skip"})]});if(D&&"optional"in D&&D.optional)return o.jsx("button",{className:"btn btn-back",onClick:r,children:"Skip Action"});if(D)return o.jsx("button",{className:"btn",disabled:!0,children:"Action Required"});if(F==="compile"&&W.length>0)return o.jsx("button",{className:"btn",disabled:!0,children:"Select Lane to Compile"});if(F==="action"){const q=I.hand.length<5,Q=I.hand.length===0,K=fu(t,"player"),Z=q&&K.allowed;return Q?o.jsx("button",{className:"btn",onClick:n,disabled:!K.allowed,title:K.allowed?void 0:K.reason,children:"Refresh (Required)"}):o.jsx("button",{className:"btn",onClick:n,disabled:!Z||!!k,title:K.allowed?void 0:K.reason,children:"Refresh"})}return o.jsx("button",{className:"btn",disabled:!0,children:"Processing..."})},N=()=>{var R,$,X,G;if(D)switch(D.type){case"discard":return D.actor==="player"?D.variableCount?"Action: Select 1 or more cards to discard":D.count>1?`Action: Select ${D.count} cards to discard, then confirm`:`Action: Discard ${D.count} card from your hand`:"Waiting for Opponent to discard...";case"prompt_use_control_mechanic":return"Control Action: Rearrange protocols?";case"select_opponent_face_up_card_to_flip":return"Action: Select an opponent's face-up card to flip";case"select_own_face_up_covered_card_to_flip":return"Action: Select one of your face-up, covered cards to flip";case"select_opponent_covered_card_to_shift":return"Action: Select one of your opponent's covered cards to shift";case"select_own_covered_card_to_shift":return"Action: Select one of your covered cards to shift";case"select_lane_for_shift":return"Action: Select a new lane for the card";case"select_lane_for_shift_all":return"Action: Select a lane to shift all cards to";case"select_opponent_card_to_flip":return"Action: Select an opponent's card to flip";case"select_card_to_flip":{const q=D.targetFilter||{},Q=q.owner||"any",K=q.faceState||"any",Z=q.position||"uncovered";let te="Action: Flip ";return Q==="own"?te+="one of your ":Q==="opponent"?te+="an opponent's ":te+="a ",K==="face_down"?te+="face-down ":K==="face_up"&&(te+="face-up "),Z==="covered"?te+="covered ":Z==="uncovered"&&(te+="uncovered "),te+="card",te}case"shift_flipped_card_optional":return"Action: You may shift the card you just flipped. Select a lane or skip.";case"select_covered_card_in_line_to_flip_optional":return"Action: You may flip one of your covered cards in this lane. Select a card or skip.";case"select_card_from_hand_to_play":{const q=D.valueFilter;return q!==void 0?`Action: Select a card with value ${q} from your hand to play`:"Action: Select a card from your hand to play"}case"select_lane_for_play":return"Action: Select another lane to play your card in";case"select_face_down_card_to_shift_for_darkness_4":return"Action: Select any face-down card to shift";case"select_cards_to_delete":return`Action: Select a card to delete (${D.count} remaining)`;case"select_face_down_card_to_delete":return"Action: Select a face-down card to delete";case"select_low_value_card_to_delete":return"Action: Select a card with value 0 or 1 to delete";case"select_card_from_other_lanes_to_delete":return`Action: Select a card to delete (${D.count} remaining)`;case"select_lane_for_death_2":return"Action: Select a lane to delete cards with value 1 or 2";case"select_lane_for_delete":return"Action: Select a lane";case"prompt_optional_draw":return"Optional: Draw card(s)?";case"prompt_death_1_effect":return"Start Phase: Use Death-1 effect?";case"select_card_to_delete_for_death_1":return"Action: Select a card to delete";case"delete_self":return"Deleting card...";case"prompt_give_card_for_love_1":return"End Phase: Give 1 card to draw 2?";case"select_card_from_hand_to_give":return"Action: Select a card from your hand to give";case"select_card_from_hand_to_reveal":return"Action: Select a card from your hand to reveal";case"plague_2_player_discard":return"Action: Select 1 or more cards to discard";case"plague_4_opponent_delete":return"Waiting for opponent to delete one of their face-down cards";case"plague_4_player_flip_optional":return"Action: You may flip Plague-4";case"select_any_other_card_to_flip":return"Action: Select any other card to flip";case"select_card_to_return":{const q=D.targetFilter||{},Q=D.targetOwner||q.owner||"any",K=q.position||"uncovered";let Z="Action: Select ";return Q==="own"?Z+="one of your ":Q==="opponent"?Z+="an opponent's ":Z+="a ",K==="any"?Z+="covered or uncovered ":K==="covered"&&(Z+="covered "),Z+="card to return",Z}case"select_covered_card_to_flip_for_chaos_0":return"Action: Select a covered card to flip in this lane";case"prompt_fire_3_discard":return"End Phase: Discard 1 card to flip 1 card?";case"prompt_optional_discard_custom":return`Optional: Discard ${D.count} card(s) to continue?`;case"prompt_optional_effect":{const q=(($=(R=D.effectDef)==null?void 0:R.params)==null?void 0:$.action)||"effect",Q=(G=(X=D.effectDef)==null?void 0:X.params)==null?void 0:G.count;return`Do you want to ${q==="shift"?"shift a card":q==="flip"?"flip a card":q==="draw"?`draw ${Q||1} card(s)`:q==="discard"?`discard ${Q||1} card(s)`:q==="delete"?"delete a card":q==="return"?"return a card":`execute ${q}${Q?` ${Q}`:""}`}?`}case"select_card_to_flip_for_fire_3":return"Action: Select a card to flip";case"select_own_other_card_to_shift":return"Action: Select one of your cards to shift";case"select_opponent_face_down_card_to_shift":return"Action: Select an opponent's face-down card to shift";case"prompt_spirit_1_start":return"Start Phase: Discard 1 card or flip Spirit-1?";case"select_any_card_to_flip_optional":return"Action: You may flip one card. Select a card or skip.";case"prompt_swap_protocols":return"Action: Swap two protocols.";case"select_cards_from_hand_to_discard_for_fire_4":return"Action: Select 1 or more cards to discard";case"select_cards_from_hand_to_discard_for_hate_1":return`Action: Select ${D.count} card(s) to discard for Hate-1`;case"select_any_card_to_flip":return`Action: Select a card to flip (${D.count} remaining)`;case"select_any_face_down_card_to_flip_optional":return"Action: You may flip a face-down card. Select a card or skip.";case"select_lane_for_life_3_play":return"Action: Select another lane to play a card into";case"select_card_to_flip_for_light_0":return"Action: Select any card to flip";case"prompt_shift_or_flip_board_card_custom":return"Action: Choose to shift, flip, or skip";case"select_board_card_to_reveal_custom":return"Action: Select a face-down card to reveal";case"select_lane_to_shift_revealed_card_for_light_2":return"Action: Select a lane to shift the revealed card to";case"select_lane_to_shift_revealed_board_card_custom":return"Action: Select a lane to shift the revealed card to";case"select_lane_to_shift_cards_for_light_3":return"Action: Select a lane to shift all face-down cards to";case"select_lane_for_metal_3_delete":return"Action: Select a lane with 8+ cards to delete";case"select_lane_for_delete_all":return"Action: Select a lane to delete all cards";case"select_lanes_for_swap_stacks":{const q=D.selectedFirstLane;return q===void 0?"Action: Select the first lane to swap":`Action: Select the second lane to swap with lane ${q+1}`}case"select_any_other_card_to_flip_for_water_0":return"Action: Select any other card to flip";case"prompt_rearrange_protocols":return"Action: Rearrange protocols";case"select_lane_for_water_3":return"Action: Select a lane to return cards from";case"select_own_card_to_return_for_water_4":return"Action: Select one of your cards to return to your hand";case"prompt_return_for_psychic_4":return"End Phase: Return an opponent's card?";case"select_any_opponent_card_to_shift":return"Action: Select an opponent's card to shift";case"select_card_to_shift":{const q=D.targetFilter||{},Q=q.owner||"any",K=q.faceState||"any",Z=q.position||"uncovered";let te="Action: Select ";return Q==="own"?te+="one of your ":Q==="opponent"?te+="an opponent's ":te+="a ",K==="face_down"?te+="face-down ":K==="face_up"&&(te+="face-up "),Z==="covered"?te+="covered ":Z==="uncovered"&&(te+="uncovered "),te+="card to shift",te}case"select_opponent_card_to_return":return"Action: Select an opponent's card to return";case"select_own_highest_card_to_delete_for_hate_2":return"Action: Select your highest value uncovered card to delete";case"select_opponent_highest_card_to_delete_for_hate_2":return"Action: Select opponent's highest value uncovered card to delete";case"custom_choice":{const q=D.options||[];if(q.length===2){const Q=q[0].params,K=q[1].params,Z=te=>te.action==="discard"?`you discard ${te.count||1} card${te.count!==1?"s":""}`:te.action==="flip"&&te.flipSelf?"flip this card":te.action==="draw"?`draw ${te.count||1} card${te.count!==1?"s":""}`:te.action==="delete"&&te.deleteSelf?"delete this card":te.action==="delete"?`delete ${te.count||1} card${te.count!==1?"s":""}`:te.action==="return"?`return ${te.count||1} card${te.count!==1?"s":""}`:te.action==="shift"?"shift a card":te.action||"option";return`Either ${Z(Q)} or ${Z(K)}.`}return"Action: Make a choice"}case"select_card_from_revealed_deck":return`Action: Select a card with value ${D.valueFilter} from your revealed deck`;case"select_phase_effect":{const q=D,Q=q.availableEffects.map(K=>K.cardName).join(", ");return`${q.phase} Phase: Choose which effect to resolve first (${Q})`}case"select_card_from_trash_to_play":{const q=D.trashOwner||"own";return`Action: Select a card from ${q==="opponent"?"opponent's":q==="any"?"any player's":"your"} trash to play`}case"select_card_from_trash_to_reveal":{const q=D.trashOwner||"own";return`Action: Select a card from ${q==="opponent"?"opponent's":q==="any"?"any player's":"your"} trash to reveal`}default:return"Action Required"}return F==="compile"&&W.length>0?"Phase: Compile":`Phase: ${F.replace("_"," ")}`};return o.jsxs("div",{className:`phase-controller ${T}`,children:[o.jsxs("div",{className:"effect-source-info",children:[o.jsxs("span",{children:[P,"'s Turn"]}),D&&B&&o.jsxs(o.Fragment,{children:[" | Effect from: ",o.jsxs("span",{children:[B.protocol,"-",B.value]})]}),(D==null?void 0:D.sourceCardId)==="CONTROL_MECHANIC"&&o.jsxs(o.Fragment,{children:[" | Effect from: ",o.jsx("span",{children:"Control Component"})]})]}),o.jsxs("div",{className:"phase-controller-main",children:[o.jsx("div",{className:"phase-info",children:N()}),o.jsx("div",{className:"phase-actions",children:M()})]})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Ux={start:"Start",control:"Control",action:"Action",compile:"Compile",hand_limit:"Hand Limit",end:"End"},Ox=({gameState:t,turn:n,animationState:r,difficulty:c,onPlayerClick:s,onOpponentClick:d})=>{const{player:u,opponent:p}=t,f=_=>{const y=["info-section"];return y.push(_==="player"?"player-info":"opponent-info"),n===_&&y.push("active-turn"),(r==null?void 0:r.type)==="drawCard"&&r.owner===_&&y.push("is-drawing"),(r==null?void 0:r.type)==="discardCard"&&r.owner===_&&y.push("is-discarding"),y.join(" ")},h=_=>{const y=_==="player"?u:p,m=_==="player"?s:d,g=_==="player"?"Player":`Opponent${c?` (${c.charAt(0).toUpperCase()+c.slice(1)})`:""}`,x=n===_;return o.jsx("div",{className:f(_),onClick:m,children:o.jsxs("div",{className:"info-section-body",children:[o.jsx("h3",{children:g}),x&&o.jsx("span",{className:"phase-badge",children:Ux[t.phase]}),o.jsxs("div",{className:"info-line",children:[o.jsx("span",{children:"Hand:"}),o.jsx("span",{children:y.hand.length})]}),o.jsxs("div",{className:"info-line",children:[o.jsx("span",{children:"Deck:"}),o.jsx("span",{children:y.deck.length})]}),o.jsxs("div",{className:"info-line",children:[o.jsx("span",{children:"Trash:"}),o.jsx("span",{children:y.discard.length})]})]})})};return o.jsxs("div",{className:"game-info-panel",children:[h("opponent"),h("player")]})},Mx=/\b([A-Z][a-z]+(?:_custom)?)-(\d)\b/g;function xc(t,n){return{...t,id:`preview-${t.protocol}-${t.value}`,isFaceUp:n}}function cy(t){const n=t.match(/^([A-Z][a-z]+(?:_custom)?)-(\d)$/);return n?{protocol:n[1],value:parseInt(n[2],10)}:null}function iy(t){const n=[];let r;const c=new RegExp(Mx);for(;(r=c.exec(t))!==null;)n.push({protocol:r[1],value:parseInt(r[2],10)});return n}function Am(t,n){if(t.sourceCardRef||t.targetCardRefs&&t.targetCardRefs.length>0)return!0;if(t.sourceCard){const c=cy(t.sourceCard);if(c&&n.some(s=>s.protocol===c.protocol&&s.value===c.value))return!0}const r=iy(t.message);return!!(r.length>0&&r.some(c=>n.some(s=>s.protocol===c.protocol&&s.value===c.value)))}function Vx(t,n){const r={source:null,targets:[]};if(t.sourceCardRef){const c=n.find(s=>s.protocol===t.sourceCardRef.protocol&&s.value===t.sourceCardRef.value);c&&(r.source=xc(c,t.sourceCardRef.isFaceUp))}if(t.targetCardRefs&&t.targetCardRefs.length>0)for(const c of t.targetCardRefs){const s=n.find(d=>d.protocol===c.protocol&&d.value===c.value);s&&r.targets.push(xc(s,c.isFaceUp))}if(!r.source&&r.targets.length===0){if(t.sourceCard){const s=cy(t.sourceCard);if(s){const d=n.find(u=>u.protocol===s.protocol&&u.value===s.value);d&&(r.source=xc(d,!0))}}const c=iy(t.message);for(const s of c){const d=n.find(u=>u.protocol===s.protocol&&u.value===s.value);if(d){const u=xc(d,!0);r.source?(r.source.protocol!==s.protocol||r.source.value!==s.value)&&r.targets.push(u):r.source=u}}}return r}function Hx({log:t,onClose:n}){const[r,c]=ce.useState(null),[s,d]=ce.useState(0),u=ce.useMemo(()=>{const _=Xo();return[...Kn,..._]},[]),p=_=>{let y="";if(_.phase){const m=_.phase.charAt(0).toUpperCase()+_.phase.slice(1);y+=`[${m}] `}return _.sourceCard&&!_.message.startsWith(_.sourceCard)&&(y+=`${_.sourceCard}: `),`${y}${_.message}`},f=ce.useMemo(()=>{if(r===null)return null;const _=t[r];return _?Vx(_,u):null},[r,t,u]),h=(_,y)=>{Am(y,u)&&(r===_?f&&f.targets.length>1?d(m=>(m+1)%f.targets.length):(c(null),d(0)):(c(_),d(0)))};return o.jsx("div",{className:"modal-overlay",onClick:n,children:o.jsxs("div",{className:"modal-content log-modal-content log-modal-with-preview",onClick:_=>_.stopPropagation(),children:[o.jsx("button",{className:"btn btn-back modal-close-btn",onClick:n,children:"X"}),o.jsx("h2",{children:"Game Log"}),o.jsxs("div",{className:"log-content-wrapper",children:[o.jsx("div",{className:"log-preview-area log-preview-left",children:(f==null?void 0:f.source)&&o.jsx("div",{className:"log-preview-card",children:o.jsx(St,{card:f.source,isFaceUp:f.source.isFaceUp})})}),o.jsx("ol",{className:"log-list",children:t.map((_,y)=>{const m=_.indentLevel!==void 0,g=m?{paddingLeft:`${_.indentLevel*20+40}px`}:{};m&&_.indentLevel===0&&(g.fontWeight="bold");const x=Am(_,u),C=r===y;return o.jsx("li",{className:`log-entry log-entry-${_.player}${x?" log-entry-clickable":""}${C?" log-entry-selected":""}`,style:g,onClick:()=>h(y,_),children:p(_)},y)})}),o.jsx("div",{className:"log-preview-area log-preview-right",children:(f==null?void 0:f.targets)&&f.targets.length>0&&o.jsxs("div",{className:"log-preview-card",children:[o.jsx(St,{card:f.targets[s],isFaceUp:f.targets[s].isFaceUp}),f.targets.length>1&&o.jsxs("div",{className:"log-preview-counter",children:[s+1," / ",f.targets.length]})]})})]})]})})}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const zx=({message:t,player:n})=>o.jsx("div",{className:`toaster toaster-${n}`,children:t});function Bx({gameState:t,targetPlayer:n,onConfirm:r}){var R;const[c]=ce.useState([...t[n].protocols]),[s,d]=ce.useState([...t[n].protocols]),[u,p]=ce.useState([0,1,2]),f=ce.useRef(null),h=ce.useRef(null),_=ce.useRef(0),y=ce.useRef(null),m=ce.useRef(0),g=((R=t.actionRequired)==null?void 0:R.type)==="prompt_rearrange_protocols"?t.actionRequired.disallowedProtocolForLane:void 0,x=ce.useMemo(()=>{if(s.length!==c.length)return!1;for(let $=0;$<s.length;$++)if(s[$]!==c[$])return!0;return!1},[s,c]),C=ce.useMemo(()=>{if(!g)return console.log("[RearrangeModal] No disallowedProtocolForLane set"),!1;const{laneIndex:$,protocol:X}=g,G=s[$],q=G===X;return console.log("[RearrangeModal] Checking violation:",{disallowedProtocol:X,disallowedLaneIndex:$,currentProtocolAtLane:G,protocols:s,hasViolation:q}),q},[s,g]),b=t[n],k=t[n==="player"?"opponent":"player"],E=b.laneValues,T=b.compiled,F=($,X)=>{let G=[$];return X&&G.push("compiled"),G.join(" ")},U=($,X)=>{f.current=X,$.dataTransfer.effectAllowed="move"},D=($,X)=>{$.preventDefault(),h.current=X},I=()=>{if(f.current!==null&&h.current!==null&&f.current!==h.current){const $=[...s],X=[...u],G=$[f.current];$[f.current]=$[h.current],$[h.current]=G;const q=X[f.current];X[f.current]=X[h.current],X[h.current]=q,f.current=null,h.current=null,d($),p(X)}},W=$=>{$.preventDefault()},z=($,X)=>{y.current=X,_.current=$.touches[0].clientY,m.current=$.touches[0].clientY},V=$=>{var q;if(y.current===null)return;m.current=$.touches[0].clientY;const X=$.touches[0],G=document.elementFromPoint(X.clientX,X.clientY);if(G){const Q=G.closest(".rearrange-item");if(Q){const Z=Array.from(((q=Q.parentElement)==null?void 0:q.children)||[]).indexOf(Q);Z!==-1&&Z!==y.current&&(h.current=Z)}}},B=()=>{if(y.current!==null&&h.current!==null&&y.current!==h.current){const $=[...s],X=[...u],G=$[y.current];$[y.current]=$[h.current],$[h.current]=G;const q=X[y.current];X[y.current]=X[h.current],X[h.current]=q,d($),p(X)}y.current=null,h.current=null,_.current=0,m.current=0},L=n==="player",P=L?"Rearrange Your Protocols":"Rearrange Opponent's Protocols",M=o.jsx("div",{className:`protocol-bar ${L?"player-bar":"opponent-bar"} rearrange-editable`,onDragOver:W,children:s.map(($,X)=>{const G=$!==c[X],q=g&&g.laneIndex===X&&$===g.protocol,Q=u[X],K=T[Q],Z=F("protocol-display rearrange-item",K);return o.jsxs("div",{className:`${Z} ${G?"changed":""} ${q?"violation":""}`,draggable:!0,onDragStart:te=>U(te,X),onDragEnter:te=>D(te,X),onDragEnd:I,onTouchStart:te=>z(te,X),onTouchMove:V,onTouchEnd:B,children:[o.jsx("span",{className:"protocol-name",children:$}),o.jsx("span",{className:"protocol-value",children:E[X]})]},`${$}-${X}`)})}),N=o.jsx("div",{className:`protocol-bar ${L?"opponent-bar":"player-bar"}`,children:k.protocols.map(($,X)=>o.jsxs("div",{className:F("protocol-display",k.compiled[X]),children:[o.jsx("span",{className:"protocol-name",children:$}),o.jsx("span",{className:"protocol-value",children:k.laneValues[X]})]},`other-proto-${$}-${X}`))});return o.jsx("div",{className:"modal-overlay",children:o.jsxs("div",{className:"modal-content rearrange-modal-content",onClick:$=>$.stopPropagation(),children:[o.jsx("h2",{children:P}),o.jsx("p",{children:"Drag and drop the protocols to reorder them. You must change the order to continue."}),g&&o.jsxs("p",{className:"warning-text",children:[" ",o.jsx("strong",{children:g.protocol})," cannot be placed on line ",o.jsx("strong",{children:g.laneIndex})," due to Anarchy-3's restriction."]}),o.jsx("div",{className:"rearrange-board-view",children:o.jsxs("div",{className:"protocol-bars-container",children:[L?N:M,L?M:N]})}),o.jsxs("div",{className:"rearrange-actions",children:[o.jsx("button",{className:"btn",onClick:()=>r(s),disabled:!x||C,children:"Confirm Rearrangement"}),C&&o.jsxs("p",{className:"error-text",children:["Cannot confirm: ",g.protocol," is on line ",g.laneIndex]})]})]})})}function Gx({gameState:t,targetPlayer:n,onConfirm:r}){const[c,s]=ce.useState([]),d=t[n],u=n==="player",p=u?"Swap Your Protocols":"Swap Opponent's Protocols",f=y=>{c.includes(y)?s(m=>m.filter(g=>g!==y)):c.length<2&&s(m=>[...m,y])},h=()=>{c.length===2&&r(c)},_=y=>{let m=["protocol-display","rearrange-item"];return d.compiled[y]&&m.push("compiled"),c.includes(y)&&m.push("selected"),m.join(" ")};return o.jsx("div",{className:"modal-overlay",children:o.jsxs("div",{className:"modal-content rearrange-modal-content",onClick:y=>y.stopPropagation(),children:[o.jsx("h2",{children:p}),o.jsx("p",{children:"Select two protocols to swap their positions. This action is mandatory."}),o.jsx("div",{className:"rearrange-board-view",children:o.jsx("div",{className:"protocol-bars-container",children:o.jsx("div",{className:`protocol-bar ${u?"player-bar":"opponent-bar"}`,children:d.protocols.map((y,m)=>o.jsxs("div",{className:_(m),onClick:()=>f(m),children:[o.jsx("span",{className:"protocol-name",children:y}),o.jsx("span",{className:"protocol-value",children:d.laneValues[m]})]},y))})})}),o.jsx("div",{className:"rearrange-actions",children:o.jsx("button",{className:"btn",onClick:h,disabled:c.length!==2,children:"Confirm Swap"})})]})})}function Yx({gameState:t,onConfirm:n}){const[r,c]=ce.useState(null),s=p=>{c(p)},d=()=>{r!==null&&n(r)},u=p=>{let f=["number-button"];return r===p&&f.push("selected"),f.join(" ")};return o.jsx("div",{className:"modal-overlay",children:o.jsxs("div",{className:"modal-content state-number-modal",onClick:p=>p.stopPropagation(),children:[o.jsx("h2",{children:"State a Number"}),o.jsx("p",{children:"Choose a number (0-5) to state. Cards drawn with this value may be revealed and played."}),o.jsx("div",{className:"number-selection",children:[0,1,2,3,4,5].map(p=>o.jsx("button",{className:u(p),onClick:()=>s(p),children:p},p))}),o.jsx("div",{className:"modal-actions",children:o.jsx("button",{className:"btn",onClick:d,disabled:r===null,children:"Confirm"})})]})})}function Wx({gameState:t,availableProtocols:n,onConfirm:r}){const[c,s]=ce.useState(null),d=f=>{s(f)},u=()=>{c!==null&&r(c)},p=f=>{let h=["protocol-button"];return c===f&&h.push("selected"),h.join(" ")};return o.jsx("div",{className:"modal-overlay",children:o.jsxs("div",{className:"modal-content state-protocol-modal",onClick:f=>f.stopPropagation(),children:[o.jsx("h2",{children:"State a Protocol"}),o.jsx("p",{children:"Choose a protocol from your opponent's cards. If the discarded card matches, you'll delete a card."}),o.jsx("div",{className:"protocol-selection",children:n.map(f=>o.jsx("button",{className:p(f),onClick:()=>d(f),children:f},f))}),o.jsx("div",{className:"modal-actions",children:o.jsx("button",{className:"btn",onClick:u,disabled:c===null,children:"Confirm"})})]})})}function Qx({gameState:t,allDrawnCardIds:n,eligibleCardIds:r,statedNumber:c,revealCount:s=1,onConfirm:d,onClose:u}){const[p,f]=ce.useState(null),h=ce.useRef(!1),_=t.player.hand.filter(j=>n.includes(j.id)),y=j=>r.includes(j),m=r.length>0;ce.useEffect(()=>{if(!h.current&&r.length>0){const j=_.find(k=>y(k.id));j&&(f(j),h.current=!0)}},[_,r]);const g=j=>{y(j.id)&&f(j)},x=j=>{y(j.id)&&f(j)},C=()=>{p&&y(p.id)&&d(p.id)},b=()=>{u&&u()};return o.jsx("div",{className:"modal-overlay",children:o.jsxs("div",{className:"modal-content revealed-deck-modal",onClick:j=>j.stopPropagation(),children:[o.jsx("h2",{children:"Cards Drawn"}),c!==void 0?o.jsxs("p",{children:["Select a card with value ",o.jsx("strong",{children:c})," to reveal:"]}):o.jsx("p",{children:"Select a card to reveal:"}),o.jsxs("div",{className:"revealed-deck-content-wrapper",children:[o.jsx("div",{className:"revealed-deck-preview-area",children:p?o.jsxs("div",{className:"revealed-deck-preview-card",children:[o.jsx(St,{card:p,isFaceUp:!0}),o.jsxs("button",{className:"btn preview-confirm-btn",onClick:C,children:["Reveal ",p.protocol,"-",p.value]})]}):o.jsx("div",{className:"revealed-deck-preview-card no-selection",children:o.jsx("p",{className:"no-match-message",children:m?"Select an eligible card":`No cards match value ${c}`})})}),o.jsx("div",{className:"revealed-deck-grids-area",children:o.jsx("div",{className:"revealed-deck-card-grid",children:_.length>0?_.map(j=>{const k=y(j.id),E=(p==null?void 0:p.id)===j.id;return o.jsx("div",{onClick:T=>{T.stopPropagation(),x(j)},onMouseEnter:()=>g(j),style:{cursor:k?"pointer":"default"},children:o.jsx(St,{card:j,isFaceUp:!0,additionalClassName:`in-hand ${k?E?"highlight-selectable":"":"dimmed"}`})},j.id)}):o.jsx("p",{className:"no-cards",children:"No cards drawn."})})})]}),!m&&o.jsx("div",{className:"modal-actions",children:o.jsx("button",{className:"btn",onClick:b,children:"Continue"})})]})})}function Xx({gameState:t,onSelectCard:n,onConfirmProtocolDraw:r}){var B;const[c,s]=ce.useState(null),[d,u]=ce.useState(null),p=ce.useRef(!1),f=d||c,h=t.actionRequired,_=(h==null?void 0:h.type)==="reveal_deck_draw_protocol",y=h==null?void 0:h.revealedCards,m=h==null?void 0:h.selectableCardIds,g=(h==null?void 0:h.autoSelectedIndices)||[],x=h==null?void 0:h.targetProtocol,C=y||(h!=null&&h.actor?(B=t[h.actor])==null?void 0:B.deck:[])||[],b=ce.useMemo(()=>C.map((L,P)=>({...L,id:L.id||`deck-${P}`,deckIndex:P,isFaceUp:!0})),[C]),j=ce.useMemo(()=>_?b.filter((L,P)=>g.includes(P)):[],[_,b,g]);if(ce.useEffect(()=>{if((h==null?void 0:h.type)==="select_card_from_revealed_deck"&&(m==null?void 0:m.length)>0&&!p.current){const L=b.find(P=>m.includes(P.id));L&&(s(L),p.current=!0)}},[h==null?void 0:h.type,m,b]),ce.useEffect(()=>{(!h||h.type!=="select_card_from_revealed_deck"&&h.type!=="reveal_deck_draw_protocol")&&(p.current=!1,s(null),u(null))},[h]),!h||h.type!=="select_card_from_revealed_deck"&&h.type!=="reveal_deck_draw_protocol")return null;const{valueFilter:k}=h,E=L=>_?!1:m==null?void 0:m.includes(L),T=L=>_&&g.includes(L),F=L=>{(_||E(L.id))&&u(L)},U=()=>{u(null)},D=L=>{!_&&E(L.id)&&s(L)},I=()=>{_?r==null||r():f&&E(f.id)&&n(f.id)},W=_?"Revealed Deck":"Your Revealed Deck",z=_?`All ${x} cards will be drawn (${j.length} found):`:`Select a card with value ${k} to draw:`,V=_?j.length>0?`Draw ${j.length} ${x} card${j.length!==1?"s":""}`:"Confirm (no matching cards)":f?`Draw ${f.protocol}-${f.value}`:"Select a card";return o.jsx("div",{className:"modal-overlay",children:o.jsxs("div",{className:"modal-content revealed-deck-modal",onClick:L=>L.stopPropagation(),children:[o.jsx("h2",{children:W}),o.jsx("p",{children:z}),o.jsxs("div",{className:"revealed-deck-content-wrapper",children:[o.jsx("div",{className:"revealed-deck-preview-area",children:_?o.jsxs("div",{className:"revealed-deck-preview-card",children:[f&&o.jsx(St,{card:f,isFaceUp:!0}),o.jsx("button",{className:"btn preview-confirm-btn",onClick:I,children:V})]}):f&&o.jsxs("div",{className:"revealed-deck-preview-card",children:[o.jsx(St,{card:f,isFaceUp:!0}),o.jsx("button",{className:"btn preview-confirm-btn",onClick:I,children:V})]})}),o.jsx("div",{className:"revealed-deck-grids-area",children:o.jsx("div",{className:"revealed-deck-card-grid",children:b.length>0?b.map(L=>{const P=E(L.id),M=T(L.deckIndex),N=(c==null?void 0:c.id)===L.id,$=(d==null?void 0:d.id)===L.id||N,X=M||P&&$,G=_?!M:!P;return o.jsx("div",{onClick:q=>{q.stopPropagation(),D(L)},onMouseEnter:()=>F(L),onMouseLeave:U,style:{cursor:P?"pointer":"default"},children:o.jsx(St,{card:L,isFaceUp:!0,additionalClassName:`in-hand ${X?"highlight-selectable":""} ${G?"dimmed":""} ${N||M?"selected-card":""}`})},L.id)}):o.jsx("p",{className:"no-cards",children:"No cards in deck."})})})]})]})})}function Zx({gameState:t,onAccept:n,onDecline:r}){var y,m;const c=t.actionRequired;if(!c||c.type!=="prompt_optional_effect")return null;const s=c.effectDef;if(!s||((y=s.params)==null?void 0:y.action)!=="discard"||!((m=s.params)!=null&&m.useCardFromPreviousEffect))return null;const d=t.lastCustomEffectTargetCardId;if(!d)return null;const u=c.actor||"player",f=t[u].deck.find(g=>g.id===d);if(!f)return null;const h={...f,id:f.id||"revealed-top",isFaceUp:!0},_=`${f.protocol}-${f.value}`;return o.jsx("div",{className:"modal-overlay",children:o.jsxs("div",{className:"modal-content revealed-deck-top-modal",onClick:g=>g.stopPropagation(),children:[o.jsx("h2",{children:"Revealed: Top Card of Your Deck"}),o.jsx("p",{children:"You may discard this card:"}),o.jsx("div",{className:"revealed-card-display",children:o.jsx(St,{card:h,isFaceUp:!0})}),o.jsxs("div",{className:"revealed-deck-top-actions",children:[o.jsxs("button",{className:"btn",onClick:n,children:["Discard ",_]}),o.jsx("button",{className:"btn btn-back",onClick:r,children:"Keep in Deck"})]})]})})}function Kx({discardedCard:t,deckOwner:n,onConfirm:r}){const c=n==="own"?"your":"opponent's",s={...t,id:t.id||"deck-discard-preview",isFaceUp:!0};return o.jsx("div",{className:"modal-overlay",children:o.jsxs("div",{className:"modal-content deck-discard-modal",onClick:d=>d.stopPropagation(),children:[o.jsx("h2",{children:"Card Discarded"}),o.jsxs("p",{children:["From the top of ",o.jsx("strong",{children:c})," deck:"]}),o.jsx("div",{className:"deck-discard-preview-content",children:o.jsx("div",{className:"deck-discard-preview-card",children:o.jsx(St,{card:s,isFaceUp:!0})})}),o.jsx("div",{className:"modal-actions",children:o.jsx("button",{className:"btn",onClick:r,children:"Continue"})})]})})}function Jx({card:t,isFaceDown:n,onConfirm:r}){const c=n?"face-down":"face-up";return o.jsx("div",{className:"modal-overlay",children:o.jsxs("div",{className:"modal-content deck-play-preview-modal",onClick:s=>s.stopPropagation(),children:[o.jsx("h2",{children:"Card from Deck"}),o.jsxs("p",{children:["You will play this card ",o.jsx("strong",{children:c}),":"]}),o.jsx("div",{className:"deck-play-preview-content",children:o.jsx("div",{className:"deck-play-preview-card",children:o.jsx(St,{card:t,isFaceUp:!0})})}),o.jsx("div",{className:"modal-actions",children:o.jsx("button",{className:"btn",onClick:r,children:"Select Lane"})})]})})}function Fm({gameState:t,onSelectCard:n}){var V,B,L,P;const[r,c]=ce.useState(null),[s,d]=ce.useState(null),[u,p]=ce.useState(null),[f,h]=ce.useState(null),_=ce.useRef(!1),y=u||r,m=f!==null?f:s,g=t.actionRequired,x=g==null?void 0:g.actor,C=(g==null?void 0:g.trashOwner)||"own";let b=[];C==="own"?b=x?((V=t[x])==null?void 0:V.discard)||[]:[]:C==="opponent"?b=((B=t[x==="player"?"opponent":"player"])==null?void 0:B.discard)||[]:C==="any"&&(b=[...((L=t.player)==null?void 0:L.discard)||[],...((P=t.opponent)==null?void 0:P.discard)||[]]);const j=ce.useMemo(()=>(b||[]).map((M,N)=>({...M,id:M.id||`trash-${N}`,isFaceUp:!0,_trashIndex:N})),[b]);ce.useEffect(()=>{((g==null?void 0:g.type)==="select_card_from_trash_to_play"||(g==null?void 0:g.type)==="select_card_from_trash_to_reveal")&&j.length>0&&!_.current&&(c(j[0]),d(0),_.current=!0)},[g==null?void 0:g.type,j]),ce.useEffect(()=>{const M=(g==null?void 0:g.type)==="select_card_from_trash_to_play"||(g==null?void 0:g.type)==="select_card_from_trash_to_reveal";(!g||!M)&&(_.current=!1,c(null),d(null),p(null),h(null))},[g]);const k=(g==null?void 0:g.type)==="select_card_from_trash_to_play"||(g==null?void 0:g.type)==="select_card_from_trash_to_reveal";if(!g||!k)return null;const E=g.type==="select_card_from_trash_to_play",T=E?"Select Card to Play":"Select Card to Reveal",F=C==="opponent"?"opponent's":C==="any"?"any player's":"your",U=E?`Select a card from ${F} trash to play:`:`Select a card from ${F} trash to reveal:`,D=(M,N)=>{p(M),h(N)},I=()=>{p(null),h(null)},W=(M,N)=>{c(M),d(N)},z=()=>{y&&m!==null&&n(m)};return o.jsx("div",{className:"modal-overlay",children:o.jsxs("div",{className:"modal-content revealed-deck-modal",onClick:M=>M.stopPropagation(),children:[o.jsx("h2",{children:T}),o.jsx("p",{children:U}),o.jsxs("div",{className:"revealed-deck-content-wrapper",children:[o.jsx("div",{className:"revealed-deck-preview-area",children:y&&o.jsxs("div",{className:"revealed-deck-preview-card",children:[o.jsx(St,{card:y,isFaceUp:!0}),o.jsxs("button",{className:"btn preview-confirm-btn",onClick:z,children:[E?"Play":"Reveal"," ",y.protocol,"-",y.value]})]})}),o.jsx("div",{className:"revealed-deck-grids-area",children:o.jsx("div",{className:"revealed-deck-card-grid",children:j.length>0?j.map((M,N)=>{const R=s===N,X=f===N||R;return o.jsx("div",{onClick:G=>{G.stopPropagation(),W(M,N)},onMouseEnter:()=>D(M,N),onMouseLeave:I,style:{cursor:"pointer"},children:o.jsx(St,{card:M,isFaceUp:!0,additionalClassName:`in-hand ${X?"highlight-selectable":""} ${R?"selected-card":""}`})},M.id)}):o.jsx("p",{className:"no-cards",children:"No cards in trash."})})})]})]})})}function eC({player:t,playerState:n,onClose:r,difficulty:c}){const s=t==="player"?"Player":`Opponent${c?` (${c.charAt(0).toUpperCase()+c.slice(1)})`:""}`,[d,u]=ce.useState(null),p=h=>{u(h)},f=(h,_,y)=>{const m=h.map((g,x)=>({...g,id:`${_}-${g.protocol}-${g.value}-${x}`,isFaceUp:y}));return o.jsxs(o.Fragment,{children:[o.jsxs("h3",{children:[_," (",m.length,")"]}),o.jsx("div",{className:"debug-card-grid",children:m.length>0?m.map(g=>o.jsx("div",{onClick:x=>{x.stopPropagation(),u(g)},onMouseEnter:()=>p(g),onMouseLeave:()=>p(null),style:{cursor:"pointer"},children:o.jsx(St,{card:g,isFaceUp:y,additionalClassName:"in-hand"})},g.id)):o.jsxs("p",{className:"no-cards",children:["No cards in ",_.toLowerCase(),"."]})})]})};return o.jsx("div",{className:"modal-overlay",onClick:r,children:o.jsxs("div",{className:"modal-content debug-modal-content debug-modal-with-preview",onClick:h=>h.stopPropagation(),children:[o.jsx("button",{className:"btn btn-back modal-close-btn",onClick:r,children:"X"}),o.jsxs("h2",{children:[s,"'s Info"]}),o.jsxs("div",{className:"debug-content-wrapper",children:[o.jsx("div",{className:"debug-preview-area",children:d&&o.jsx("div",{className:"debug-preview-card",children:o.jsx(St,{card:d,isFaceUp:d.isFaceUp})})}),o.jsxs("div",{className:"debug-grids-area",children:[f(n.deck,"Deck",!1),f(n.discard,"Discard Pile",!0)]})]})]})})}function tC({onComplete:t}){const[n,r]=ce.useState("choose"),[c,s]=ce.useState(null),[d,u]=ce.useState(null),[p,f]=ce.useState(!1),h=y=>{s(y),r("flipping"),f(!0);const m=Math.random()<.5?"heads":"tails";setTimeout(()=>{u(m),f(!1),r("result")},2e3)},_=()=>{if(d===null||c===null)return;const y=d===c;t(y?"player":"opponent",c,y)};return o.jsx("div",{className:"coin-flip-modal-overlay",children:o.jsxs("div",{className:"modal-content coin-flip-modal-content",onClick:y=>y.stopPropagation(),children:[n==="choose"&&o.jsxs(o.Fragment,{children:[o.jsx("h2",{children:"Coin Flip"}),o.jsx("p",{children:"Choose heads or tails to determine who starts the game."}),o.jsxs("div",{className:"coin-flip-choices",children:[o.jsxs("button",{className:"btn coin-flip-choice-btn",onClick:()=>h("heads"),children:[o.jsx("div",{className:"coin-choice-icon",children:"H"}),o.jsx("div",{className:"coin-choice-label",children:"Heads"})]}),o.jsxs("button",{className:"btn coin-flip-choice-btn",onClick:()=>h("tails"),children:[o.jsx("div",{className:"coin-choice-icon",children:"T"}),o.jsx("div",{className:"coin-choice-label",children:"Tails"})]})]})]}),n==="flipping"&&o.jsxs(o.Fragment,{children:[o.jsx("h2",{children:"Flipping..."}),o.jsxs("p",{children:["You chose: ",o.jsx("span",{className:"coin-flip-highlight",children:c==="heads"?"Heads":"Tails"})]}),o.jsx("div",{className:"coin-flip-animation-container",children:o.jsxs("div",{className:`coin-3d ${p?"is-flipping":""}`,children:[o.jsx("div",{className:"coin-face coin-heads",children:"H"}),o.jsx("div",{className:"coin-face coin-tails",children:"T"})]})})]}),n==="result"&&d&&c&&o.jsxs(o.Fragment,{children:[o.jsx("h2",{children:"Result"}),o.jsxs("p",{children:["You chose: ",o.jsx("span",{className:"coin-flip-highlight",children:c==="heads"?"Heads":"Tails"})]}),o.jsx("div",{className:"coin-flip-animation-container",children:o.jsxs("div",{className:`coin-3d result-${d}`,children:[o.jsx("div",{className:"coin-face coin-heads",children:"H"}),o.jsx("div",{className:"coin-face coin-tails",children:"T"})]})}),o.jsxs("p",{className:"coin-flip-result-text",children:["The coin landed on: ",o.jsx("span",{className:"coin-flip-highlight",children:d==="heads"?"Heads":"Tails"})]}),d===c?o.jsx("p",{className:"coin-flip-winner-text",children:"You won! You will start the game."}):o.jsx("p",{className:"coin-flip-loser-text",children:"Opponent won! Opponent will start the game."}),o.jsx("button",{className:"btn",onClick:_,children:"Continue"})]})]})})}const nC="anarchy-custom-001",aC="Anarchy",oC="Custom recreation of Anarchy protocol to validate editor capabilities",rC="System Validation",lC="2025-11-08T00:00:00.000Z",sC="#8B0000",cC="chaos",iC=[{value:0,topEffects:[],middleEffects:[{id:"anarchy-0-shift",params:{action:"shift",targetFilter:{owner:"any",position:"uncovered",faceState:"any"}},position:"middle",trigger:"on_play"},{id:"anarchy-0-draw",params:{action:"draw",count:1,target:"self",source:"own_deck",conditional:{type:"non_matching_protocols"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[{id:"anarchy-1-passive",params:{action:"passive_rule",rule:{type:"require_non_matching_protocol",target:"all",scope:"global"}},position:"top",trigger:"passive"}],middleEffects:[{id:"anarchy-1-shift",params:{action:"shift",targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!0},destinationRestriction:{type:"non_matching_protocol"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"anarchy-2-delete",params:{action:"delete",count:1,targetFilter:{position:"any",faceState:"face_up"},protocolMatching:"must_match",excludeSelf:!1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"anarchy-3-swap",params:{action:"swap_protocols",target:"opponent"},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"anarchy-3-end-rearrange",params:{action:"rearrange_protocols",target:"own",restriction:{disallowedProtocol:"Anarchy",laneIndex:"current"}},position:"bottom",trigger:"end"}]},{value:5,topEffects:[],middleEffects:[{id:"anarchy-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:6,topEffects:[{id:"anarchy-6-start-flip",params:{action:"flip",count:1,flipSelf:!0,optional:!1,targetFilter:{owner:"any",position:"any",faceState:"any",excludeSelf:!1},advancedConditional:{type:"protocol_match",protocol:"Anarchy"}},position:"top",trigger:"start"}],middleEffects:[],bottomEffects:[]}],dC="Fan-Content",dy={id:nC,name:aC,description:oC,author:rC,createdAt:lC,color:sC,pattern:cC,cards:iC,category:dC},uC="apathy_custom",pC="Apathy",fC="Custom implementation of Apathy protocol",hC="System",mC="2025-01-08T00:00:00Z",yC="#9E9E9E",gC="radial",vC=[{value:0,topEffects:[{id:"apathy-0-value-modifier",params:{action:"value_modifier",modifier:{type:"add_per_condition",value:1,condition:"per_face_down_card",target:"own_total",scope:"this_lane"}},position:"top",trigger:"passive"}],middleEffects:[],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"apathy-1-flip-all",params:{action:"flip",count:"all",optional:!1,scope:"this_lane",targetFilter:{owner:"any",position:"any",faceState:"face_up",excludeSelf:!0}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:2,topEffects:[{id:"apathy-2-passive",params:{action:"passive_rule",rule:{type:"ignore_middle_commands",target:"all",scope:"this_lane"}},position:"top",trigger:"passive"}],middleEffects:[],bottomEffects:[{id:"apathy-2-on-cover",params:{action:"flip",count:1,flipSelf:!0,optional:!1,targetFilter:{owner:"any",position:"any",faceState:"any",excludeSelf:!1}},position:"bottom",trigger:"on_cover"}]},{value:3,topEffects:[],middleEffects:[{id:"apathy-3-flip-opponent",params:{action:"flip",count:1,optional:!1,targetFilter:{owner:"opponent",position:"uncovered",faceState:"face_up",excludeSelf:!1}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"apathy-4-flip-covered",params:{action:"flip",count:1,optional:!0,targetFilter:{owner:"own",position:"covered",faceState:"face_up",excludeSelf:!1}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"apathy-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],_C="Aux 1",uy={id:uC,name:pC,description:fC,author:hC,createdAt:mC,color:yC,pattern:gC,cards:vC,category:_C},wC="assimilation-custom-001",xC="Assimilation",CC="Absorb your opponent's resources. Draw from their deck, steal their cards, and infiltrate their board.",SC="System",bC="2025-12-18T00:00:00.000Z",EC="#8B008B",jC="radial",kC=[{value:0,topEffects:[],middleEffects:[{id:"assimilation-0-steal-facedown",params:{action:"return",count:1,targetFilter:{owner:"opponent",position:"any",faceState:"face_down"},destination:"actor_hand"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"assimilation-1-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"},{id:"assimilation-1-refresh",params:{action:"refresh",target:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"assimilation-1-reactive-draw",params:{action:"draw",count:1,target:"self",source:"opponent_deck"},position:"bottom",trigger:"after_refresh",reactiveTriggerActor:"any",conditional:{type:"then",thenEffect:{id:"assimilation-1-reactive-discard",params:{action:"discard",count:1,actor:"self",discardTo:"opponent_trash"},position:"bottom",trigger:"on_play"}}}]},{value:2,topEffects:[],middleEffects:[],bottomEffects:[{id:"assimilation-2-play-opponent-deck",params:{action:"play",source:"deck",sourceOwner:"opponent",count:1,faceDown:!0,destinationRule:{type:"specific_lane",laneIndex:"current"}},position:"bottom",trigger:"end"}]},{value:4,topEffects:[],middleEffects:[{id:"assimilation-4-draw-opponent-deck",params:{action:"draw",count:1,target:"self",source:"opponent_deck"},position:"middle",trigger:"on_play"},{id:"assimilation-4-opponent-draw-own-deck",params:{action:"draw",count:1,target:"opponent",source:"own_deck"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"assimilation-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:6,topEffects:[],middleEffects:[],bottomEffects:[{id:"assimilation-6-play-to-opponent-board",params:{action:"play",source:"deck",count:1,faceDown:!0,destinationRule:{type:"specific_lane",laneIndex:"current"},targetBoard:"opponent"},position:"bottom",trigger:"end"}]}],NC="Aux 2",py={id:wC,name:xC,description:CC,author:SC,createdAt:bC,color:EC,pattern:jC,cards:kC,category:NC},TC="chaos_custom_1",RC="Chaos",DC="Embrace the unpredictable. Custom protocol migration of original Chaos protocol.",AC="#E64DB8",FC="chaos",$C=[{value:0,topEffects:[],middleEffects:[{id:"chaos_0_flip_covered",trigger:"on_play",params:{action:"flip",count:1,scope:"each_lane",targetFilter:{owner:"any",position:"covered",faceState:"any"}},position:"middle"}],bottomEffects:[{id:"chaos_0_start_swap_draws",trigger:"start",params:{action:"mutual_draw",count:1},position:"bottom"}]},{value:1,topEffects:[],middleEffects:[{id:"chaos_1_rearrange_own",trigger:"on_play",params:{action:"rearrange_protocols",target:"own"},position:"middle"},{id:"chaos_1_rearrange_opponent",trigger:"on_play",params:{action:"rearrange_protocols",target:"opponent"},position:"middle"}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"chaos_2_shift_covered",trigger:"on_play",params:{action:"shift",count:1,targetFilter:{owner:"own",position:"covered",faceState:"any"}},position:"middle"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[],bottomEffects:[{id:"chaos_3_ignore_protocol",trigger:"passive",params:{action:"card_property",property:"ignore_protocol_matching"},position:"bottom"}]},{value:4,topEffects:[],middleEffects:[],bottomEffects:[{id:"chaos_4_end_discard_draw",trigger:"end",params:{action:"discard",count:"all",actor:"self"},conditional:{type:"then",thenEffect:{id:"chaos_4_draw_after_discard",trigger:"on_play",params:{action:"draw",count:1,countType:"equal_to_discarded",countOffset:0,target:"self",source:"own_deck"},position:"bottom"}},position:"bottom"}]},{value:5,topEffects:[],middleEffects:[{id:"chaos_5_discard",trigger:"on_play",params:{action:"discard",count:1,actor:"self"},position:"middle"}],bottomEffects:[]}],IC="Main 2",fy={id:TC,name:RC,description:DC,color:AC,pattern:FC,cards:$C,category:IC},qC="darkness_custom_v1",LC="Darkness",PC="Custom Darkness protocol - manipulate face-down cards, flip and shift",UC="System",OC="2025-01-08T00:00:00Z",MC="#1a0033",VC="grid",HC=[{value:0,topEffects:[],middleEffects:[{id:"dark-0-draw",params:{action:"draw",count:3,target:"self",source:"own_deck"},position:"middle",trigger:"on_play"},{id:"dark-0-shift",params:{action:"shift",targetFilter:{owner:"opponent",position:"covered",faceState:"any",excludeSelf:!1},destinationRestriction:{type:"any"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"dark-1-flip",params:{action:"flip",count:1,optional:!1,targetFilter:{owner:"opponent",position:"uncovered",faceState:"any",excludeSelf:!1}},position:"middle",trigger:"on_play"},{id:"dark-1-shift",params:{action:"shift",optional:!0,targetFilter:{owner:"any",position:"any",faceState:"any",excludeSelf:!1},destinationRestriction:{type:"any"}},position:"middle",trigger:"on_play",useCardFromPreviousEffect:!0}],bottomEffects:[]},{value:2,topEffects:[{id:"dark-2-value-modifier",params:{action:"value_modifier",modifier:{type:"set_to_fixed",value:4,target:"own_cards",scope:"this_lane",filter:{faceState:"face_down",position:"any"}}},position:"top",trigger:"passive"}],middleEffects:[{id:"dark-2-flip",params:{action:"flip",count:1,optional:!0,scope:"this_lane",targetFilter:{owner:"any",position:"covered",faceState:"any",excludeSelf:!1}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"dark-3-play",params:{action:"play",source:"hand",count:1,faceDown:!0,destinationRule:{type:"other_lines",excludeCurrentLane:!0}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"dark-4-shift",params:{action:"shift",targetFilter:{owner:"any",position:"uncovered",faceState:"face_down",excludeSelf:!1},destinationRestriction:{type:"any"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"dark-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],zC="Main 1",hy={id:qC,name:LC,description:PC,author:UC,createdAt:OC,color:MC,pattern:VC,cards:HC,category:zC},BC="death_custom_v1",GC="Death",YC="Custom Death protocol - delete cards with various conditions",WC="System",QC="2025-01-09T00:00:00Z",XC="#8B0000",ZC="stripes",KC=[{value:0,topEffects:[],middleEffects:[{id:"death-0-delete-from-each-lane",params:{action:"delete",count:1,scope:{type:"each_other_line"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[{id:"death-1-optional-draw",params:{action:"draw",count:1,optional:!0},position:"top",trigger:"start",conditional:{type:"if_executed",thenEffect:{id:"death-1-delete-other",params:{action:"delete",count:1,excludeSelf:!0},position:"top",trigger:"start",conditional:{type:"then",thenEffect:{id:"death-1-delete-self",params:{action:"delete",count:1,targetFilter:{position:"any",owner:"own"},deleteSelf:!0},position:"top",trigger:"start"}}}}}],middleEffects:[],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"death-2-delete-lane-values",params:{action:"delete",count:"all",selectLane:!0,targetFilter:{faceState:"any",valueRange:{min:1,max:2}}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"death-3-delete-facedown",params:{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"face_down"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"death-4-delete-low-value",params:{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"face_up",valueRange:{min:0,max:1}}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"death-5-discard",params:{action:"discard",count:1},position:"middle",trigger:"on_play"}],bottomEffects:[]}],JC="Main 1",my={id:BC,name:GC,description:YC,author:WC,createdAt:QC,color:XC,pattern:ZC,cards:KC,category:JC},e1="fire-custom-001",t1="Fire",n1="Fire protocol - discard cards to fuel powerful effects",a1="System",o1="2025-11-09T00:00:00.000Z",r1="#F06838",l1="radial",s1=[{value:0,topEffects:[],middleEffects:[{id:"fire-0-flip",params:{action:"flip",count:1,targetFilter:{excludeSelf:!0}},position:"middle",trigger:"on_play"},{id:"fire-0-draw",params:{action:"draw",count:2},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"fire-0-oncover-draw",params:{action:"draw",count:1},position:"bottom",trigger:"on_cover",conditional:{type:"then",thenEffect:{id:"fire-0-oncover-flip",params:{action:"flip",count:1,targetFilter:{excludeSelf:!0}},position:"bottom",trigger:"on_cover"}}}]},{value:1,topEffects:[],middleEffects:[{id:"fire-1-discard",params:{action:"discard",count:1},position:"middle",trigger:"on_play",conditional:{type:"if_executed",thenEffect:{id:"fire-1-delete",params:{action:"delete",count:1},position:"middle",trigger:"on_play"}}}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"fire-2-discard",params:{action:"discard",count:1},position:"middle",trigger:"on_play",conditional:{type:"if_executed",thenEffect:{id:"fire-2-return",params:{action:"return",count:1,targetFilter:{position:"uncovered"}},position:"middle",trigger:"on_play"}}}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[],bottomEffects:[{id:"fire-3-discard",params:{action:"discard",count:1,optional:!0},position:"bottom",trigger:"end",conditional:{type:"if_executed",thenEffect:{id:"fire-3-flip",params:{action:"flip",count:1},position:"bottom",trigger:"end"}}}]},{value:4,topEffects:[],middleEffects:[{id:"fire-4-discard-variable",params:{action:"discard",count:1,variableCount:!0},position:"middle",trigger:"on_play",conditional:{type:"then",thenEffect:{id:"fire-4-draw-based-on-discard",params:{action:"draw",countType:"equal_to_discarded",countOffset:1},position:"middle",trigger:"on_play"}}}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"fire-5-discard",params:{action:"discard",count:1,optional:!1},position:"middle",trigger:"on_play"}],bottomEffects:[]}],c1="Main 1",yy={id:e1,name:t1,description:n1,author:a1,createdAt:o1,color:r1,pattern:l1,cards:s1,category:c1},i1="frost_custom_1",d1="Frost",u1="Freeze the game state. Frost blocks actions and preserves face-down cards.",p1="#87CEEB",f1="frost",h1=[{value:0,topEffects:[],middleEffects:[{id:"frost_0_draw_per_face_down",trigger:"on_play",position:"middle",params:{action:"draw",count:1,source:"own_deck",target:"self",countType:"count_face_down"}}],bottomEffects:[]},{value:1,topEffects:[{id:"frost_1_block_flips",trigger:"passive",position:"top",params:{action:"passive_rule",rule:{type:"block_flips",target:"all",scope:"global"}}}],middleEffects:[],bottomEffects:[{id:"frost_1_block_rearrange",trigger:"passive",position:"bottom",params:{action:"passive_rule",rule:{type:"block_protocol_rearrange",target:"all",scope:"global"}}}]},{value:2,topEffects:[],middleEffects:[{id:"frost_2_play_face_down",trigger:"on_play",position:"middle",params:{action:"play",count:1,source:"hand",faceDown:!0}}],bottomEffects:[]},{value:3,topEffects:[{id:"frost_3_block_shifts",trigger:"passive",position:"top",params:{action:"passive_rule",rule:{type:"block_shifts_from_and_to_lane",target:"all",scope:"this_lane"}}}],middleEffects:[],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"frost_4_flip_covered",trigger:"on_play",position:"middle",params:{action:"flip",count:1,optional:!0,targetFilter:{owner:"own",faceState:"face_up",position:"covered"}}}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"frost_5_discard",trigger:"on_play",position:"middle",params:{action:"discard",count:1,target:"self"}}],bottomEffects:[]}],m1="Fan-Content",gy={id:i1,name:d1,description:u1,color:p1,pattern:f1,cards:h1,category:m1},y1="hate-custom-001",g1="Hate",v1="Focused on deletion and sacrifice. Delete cards to gain advantage.",_1="System Migration",w1="2025-11-13T00:00:00.000Z",x1="#E67A7A",C1="diagonal-lines",S1=[{value:0,topEffects:[],middleEffects:[{id:"hate-0-delete",params:{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"any"},scope:{type:"anywhere"},excludeSelf:!1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"hate-1-discard",params:{action:"discard",count:3,actor:"self",upTo:!0},position:"middle",trigger:"on_play"},{id:"hate-1-delete-1",params:{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"any"},scope:{type:"anywhere"},excludeSelf:!1,upTo:!0},position:"middle",trigger:"on_play"},{id:"hate-1-delete-2",params:{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"any"},scope:{type:"anywhere"},excludeSelf:!1,upTo:!0},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"hate-2-delete-own",params:{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"any",calculation:"highest_value",owner:"own"},scope:{type:"anywhere"},excludeSelf:!1},position:"middle",trigger:"on_play"},{id:"hate-2-delete-opponent",params:{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"any",calculation:"highest_value",owner:"opponent"},scope:{type:"anywhere"},excludeSelf:!1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[{id:"hate-3-reactive-draw",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"top",trigger:"after_delete",reactiveTriggerActor:"self"}],middleEffects:[],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[],bottomEffects:[{id:"hate-4-on-cover-delete",params:{action:"delete",count:1,targetFilter:{position:"covered_by_context",faceState:"any",calculation:"lowest_value"},scope:{type:"this_line"},excludeSelf:!1,autoExecute:!0},position:"bottom",trigger:"on_cover"}]},{value:5,topEffects:[],middleEffects:[{id:"hate-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],b1="Aux 1",vy={id:y1,name:g1,description:v1,author:_1,createdAt:w1,color:x1,pattern:C1,cards:S1,category:b1},E1="water_custom_1",j1="Water",k1="Wash away and renew. Custom protocol migration of original Water protocol.",N1="#5DADE2",T1="multi-radial",R1=[{value:0,topEffects:[],middleEffects:[{id:"water_0_flip_other",trigger:"immediate",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!0},optional:!1},position:"middle"},{id:"water_0_flip_self",trigger:"immediate",params:{action:"flip",flipSelf:!0},position:"middle"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"water_1_play",trigger:"immediate",params:{action:"play",source:"deck",count:1,faceDown:!0,destinationRule:{type:"each_other_line"}},position:"middle"}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"water_2_draw",trigger:"immediate",params:{action:"draw",count:2},position:"middle"},{id:"water_2_rearrange",trigger:"immediate",params:{action:"rearrange_protocols",target:"own"},position:"middle"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"water_3_return",trigger:"immediate",params:{action:"return",count:"all",targetFilter:{owner:"any",position:"uncovered",valueEquals:2},selectLane:!0},position:"middle"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"water_4_return",trigger:"immediate",params:{action:"return",count:1,targetFilter:{owner:"own",position:"uncovered"}},position:"middle"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"water_5_discard",trigger:"immediate",params:{action:"discard",count:1,actor:"self"},position:"middle"}],bottomEffects:[]}],D1="Main 1",_y={id:E1,name:j1,description:k1,color:N1,pattern:T1,cards:R1,category:D1},A1="spirit_custom_1",F1="Spirit",$1="True strength from within. Custom protocol migration of original Spirit protocol.",I1="#5DD9C1",q1="dual-radial",L1=[{value:0,topEffects:[],middleEffects:[{id:"spirit_0_refresh",trigger:"on_play",params:{action:"refresh",target:"self"},position:"middle"},{id:"spirit_0_draw",trigger:"on_play",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"middle"}],bottomEffects:[{id:"spirit_0_skip_cache",trigger:"passive",params:{action:"passive_rule",rule:{type:"skip_check_cache_phase",target:"self",scope:"global"}},position:"bottom"}]},{value:1,topEffects:[{id:"spirit_1_play_anywhere",trigger:"passive",params:{action:"passive_rule",rule:{type:"allow_any_protocol_play",target:"self",scope:"global"}},position:"top"}],middleEffects:[{id:"spirit_1_draw",trigger:"on_play",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"middle"}],bottomEffects:[{id:"spirit_1_choice",trigger:"start",params:{action:"choice",options:[{id:"spirit_1_choice_discard",trigger:"on_play",params:{action:"discard",count:1,actor:"self"},position:"bottom"},{id:"spirit_1_choice_flip",trigger:"on_play",params:{action:"flip",flipSelf:!0},position:"bottom"}]},position:"bottom"}]},{value:2,topEffects:[],middleEffects:[{id:"spirit_2_flip",trigger:"on_play",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1},optional:!0},position:"middle"}],bottomEffects:[]},{value:3,topEffects:[{id:"spirit_3_shift",trigger:"after_draw",reactiveTriggerActor:"self",params:{action:"shift",count:1,optional:!0,targetFilter:{owner:"own",position:"any",faceState:"any",excludeSelf:!1}},position:"top"}],middleEffects:[],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"spirit_4_swap",trigger:"on_play",params:{action:"swap_protocols",target:"own"},position:"middle"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"spirit_5_discard",trigger:"on_play",params:{action:"discard",count:1,actor:"self"},position:"middle"}],bottomEffects:[]}],P1="Main 1",wy={id:A1,name:F1,description:$1,color:I1,pattern:q1,cards:L1,category:P1},U1="gravity_custom_1",O1="Gravity",M1="Pull everything together. Gravity draws cards towards this line.",V1="#7599EB",H1="grid",z1=[{value:0,topEffects:[],middleEffects:[{id:"gravity_0_play_per_2_cards",trigger:"on_play",params:{action:"play",source:"deck",count:1,faceDown:!0,destinationRule:{type:"under_this_card"},condition:{type:"per_x_cards_in_line",cardCount:2},actor:"self"},position:"middle"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"gravity_1_draw_2",trigger:"on_play",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"middle"},{id:"gravity_1_shift_to_or_from",trigger:"on_play",params:{action:"shift",targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1},destinationRestriction:{type:"to_or_from_this_lane",laneIndex:"current"}},position:"middle"}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"gravity_2_flip",trigger:"on_play",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1},optional:!1},position:"middle"},{id:"gravity_2_shift_to_this_line",trigger:"on_play",params:{action:"shift",targetFilter:{owner:"any",position:"any",faceState:"any",excludeSelf:!1},destinationRestriction:{type:"to_this_lane",laneIndex:"current"}},position:"middle",useCardFromPreviousEffect:!0}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"gravity_4_shift_face_down_to_this_line",trigger:"on_play",params:{action:"shift",targetFilter:{owner:"any",position:"uncovered",faceState:"face_down",excludeSelf:!1},destinationRestriction:{type:"to_this_lane",laneIndex:"current"}},position:"middle"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"gravity_5_discard",trigger:"on_play",params:{action:"discard",count:1,actor:"self"},position:"middle"}],bottomEffects:[]},{value:6,topEffects:[],middleEffects:[{id:"gravity_6_opponent_plays",trigger:"on_play",params:{action:"play",source:"deck",count:1,faceDown:!0,destinationRule:{type:"specific_lane",laneIndex:"current"},actor:"opponent"},position:"middle",comment:"Opponent plays top of their deck in this line"}],bottomEffects:[]}],B1="Main 1",xy={id:U1,name:O1,description:M1,color:V1,pattern:H1,cards:z1,category:B1},G1="life_custom_1",Y1="Life",W1="Life begets more life. Play cards from your deck to grow your presence.",Q1="#3CE076",X1="hexagons",Z1=[{value:0,topEffects:[{id:"life_0_end_delete_if_covered",trigger:"end",position:"top",params:{action:"delete",deleteSelf:!0,advancedConditional:{type:"this_card_is_covered"}}}],middleEffects:[{id:"life_0_play_each_line_with_card",trigger:"on_play",position:"middle",params:{action:"play",source:"deck",count:1,faceDown:!0,destinationRule:{type:"each_line_with_card",ownerFilter:"own"},actor:"self"}}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"life_1_flip_1",trigger:"on_play",position:"middle",params:{action:"flip",count:1,optional:!1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1}}},{id:"life_1_flip_2",trigger:"on_play",position:"middle",params:{action:"flip",count:1,optional:!1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1}}}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"life_2_draw",trigger:"on_play",position:"middle",params:{action:"draw",count:1,target:"self",source:"own_deck"}},{id:"life_2_flip",trigger:"on_play",position:"middle",params:{action:"flip",count:1,optional:!0,targetFilter:{owner:"any",position:"uncovered",faceState:"face_down",excludeSelf:!1}}}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[],bottomEffects:[{id:"life_3_on_cover_play",trigger:"on_cover",position:"bottom",params:{action:"play",source:"deck",count:1,faceDown:!0,destinationRule:{type:"another_line",excludeCurrentLane:!0},actor:"self"}}]},{value:4,topEffects:[],middleEffects:[{id:"life_4_conditional_draw",trigger:"on_play",position:"middle",params:{action:"draw",count:1,target:"self",source:"own_deck",conditional:{type:"is_covering"}}}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"life_5_discard",trigger:"on_play",position:"middle",params:{action:"discard",count:1,actor:"self"}}],bottomEffects:[]}],K1="Main 1",Cy={id:G1,name:Y1,description:W1,color:Q1,pattern:X1,cards:Z1,category:K1},J1="light_custom_1",eS="Light",tS="Burn away the dark. Light protocol reveals and manipulates through illumination.",nS="System",aS="2025-11-14T00:00:00.000Z",oS="#F4D03F",rS="radial",lS=[{value:0,topEffects:[],middleEffects:[{id:"light-0-flip",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1},optional:!1},position:"middle",trigger:"on_play"},{id:"light-0-draw",params:{action:"draw",count:1,target:"self",source:"own_deck",countType:"equal_to_card_value"},position:"middle",trigger:"on_play",useCardFromPreviousEffect:!0}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[],bottomEffects:[{id:"light-1-draw",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"bottom",trigger:"end"}]},{value:2,topEffects:[],middleEffects:[{id:"light-2-draw",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"middle",trigger:"on_play"},{id:"light-2-reveal-board-card",params:{action:"reveal",source:"board",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"face_down"},optional:!0},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"light-3-shift-all",params:{action:"shift",count:"all",targetFilter:{owner:"any",position:"any",faceState:"face_down",excludeSelf:!1},destinationRestriction:{type:"to_another_line"},scope:"this_lane"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"light-4-reveal",params:{action:"reveal",source:"opponent_hand",count:-1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"light-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],sS="Main 1",Sy={id:J1,name:eS,description:tS,author:nS,createdAt:aS,color:oS,pattern:rS,cards:lS,category:sS},cS="speed_custom_1",iS="Speed",dS="Swift and adaptive. Custom protocol migration of original Speed protocol.",uS="#33E6E6",pS="cross",fS=[{value:0,topEffects:[],middleEffects:[{id:"speed_0_play",trigger:"on_play",params:{action:"play",source:"hand",count:1},position:"middle"}],bottomEffects:[]},{value:1,topEffects:[{id:"speed_1_reactive_draw",trigger:"after_clear_cache",reactiveTriggerActor:"self",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"top"}],middleEffects:[{id:"speed_1_draw",trigger:"on_play",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"middle"}],bottomEffects:[]},{value:2,topEffects:[{id:"speed_2_before_compile",trigger:"before_compile_delete",params:{action:"shift",count:1,shiftSelf:!0,allowCoveredSelf:!0,targetFilter:{owner:"own",position:"any",faceState:"any"}},position:"top"}],middleEffects:[],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"speed_3_shift_other",trigger:"on_play",params:{action:"shift",count:1,targetFilter:{owner:"own",position:"uncovered",faceState:"any",excludeSelf:!0}},position:"middle"}],bottomEffects:[{id:"speed_3_end_shift",trigger:"end",params:{action:"shift",count:1,optional:!0,targetFilter:{owner:"own",position:"uncovered",faceState:"any"}},position:"bottom",conditional:{type:"if_executed",thenEffect:{id:"speed_3_flip_self",trigger:"on_play",params:{action:"flip",flipSelf:!0},position:"bottom"}}}]},{value:4,topEffects:[],middleEffects:[{id:"speed_4_shift_opponent",trigger:"on_play",params:{action:"shift",count:1,targetFilter:{owner:"opponent",position:"uncovered",faceState:"face_down"}},position:"middle"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"speed_5_discard",trigger:"on_play",params:{action:"discard",count:1,actor:"self"},position:"middle"}],bottomEffects:[]}],hS="Main 1",by={id:cS,name:iS,description:dS,color:uS,pattern:pS,cards:fS,category:hS},mS="metal_custom_1",yS="Metal",gS="Unyielding defense. Custom protocol migration of original Metal protocol.",vS="#B0BEC5",_S="grid",wS=[{value:0,topEffects:[{id:"metal_0_reduce_opponent",trigger:"passive",params:{action:"value_modifier",modifier:{type:"add_to_total",value:-2,target:"opponent_total",scope:"this_lane"}},position:"top"}],middleEffects:[{id:"metal_0_flip",trigger:"on_play",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any"}},position:"middle"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"metal_1_draw",trigger:"on_play",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"middle"},{id:"metal_1_block_compile",trigger:"on_play",params:{action:"block_compile",target:"opponent"},position:"middle"}],bottomEffects:[]},{value:2,topEffects:[{id:"metal_2_block_face_down",trigger:"passive",params:{action:"passive_rule",rule:{type:"block_face_down_play",scope:"this_lane"}},position:"top"}],middleEffects:[],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"metal_3_draw",trigger:"on_play",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"middle"},{id:"metal_3_delete_lane",trigger:"on_play",params:{action:"delete_all_in_lane",laneCondition:{type:"min_cards",count:8},excludeCurrentLane:!0},position:"middle"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"metal_5_discard",trigger:"on_play",params:{action:"discard",count:1,actor:"self"},position:"middle"}],bottomEffects:[]},{value:6,topEffects:[{id:"metal_6_delete_on_cover_or_flip",trigger:"on_cover_or_flip",params:{action:"delete",deleteSelf:!0},position:"top"}],middleEffects:[],bottomEffects:[]}],xS="Main 1",Ey={id:mS,name:yS,description:gS,color:vS,pattern:_S,cards:wS,category:xS},CS="plague-custom-001",SS="Plague",bS="Focused on forcing opponent discards and restricting their plays. Spread suffering.",ES="System Migration",jS="2025-11-26T00:00:00.000Z",kS="#8FBC3A",NS="dual-radial",TS=[{value:0,topEffects:[],middleEffects:[{id:"plague-0-opponent-discard",params:{action:"discard",count:1,actor:"opponent"},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"plague-0-block-play",params:{action:"passive_rule",rule:{type:"block_all_play",target:"opponent",scope:"this_lane"}},position:"bottom",trigger:"passive"}]},{value:1,topEffects:[{id:"plague-1-reactive-draw",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"top",trigger:"after_opponent_discard"}],middleEffects:[{id:"plague-1-opponent-discard",params:{action:"discard",count:1,actor:"opponent"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"plague-2-self-discard",params:{action:"discard",count:1,actor:"self",variableCount:!0},position:"middle",trigger:"on_play",conditional:{type:"then",thenEffect:{id:"plague-2-opponent-discard",params:{action:"discard",actor:"opponent",countType:"equal_to_discarded",countOffset:1},position:"middle",trigger:"on_play"}}}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"plague-3-flip-each-other",params:{action:"flip",count:"all",scope:{type:"anywhere"},targetFilter:{faceState:"face_up",owner:"any",position:"uncovered",excludeSelf:!0}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,text:{bottom:"<div><span class='emphasis'>End:</span> Your opponent deletes 1 of their face-down cards. You may flip this card.</div>"},topEffects:[],middleEffects:[],bottomEffects:[{id:"plague-4-opponent-delete",params:{action:"delete",count:1,targetFilter:{faceState:"face_down",owner:"opponent",position:"uncovered"},scope:{type:"anywhere"},actorChooses:"card_owner"},position:"bottom",trigger:"end"},{id:"plague-4-may-flip-self",params:{action:"flip",flipSelf:!0,optional:!0},position:"bottom",trigger:"end"}]},{value:5,topEffects:[],middleEffects:[{id:"plague-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],RS="Main 1",jy={id:CS,name:SS,description:bS,author:ES,createdAt:jS,color:kS,pattern:NS,cards:TS,category:RS},DS="love_custom_v1",AS="Love",FS="Custom Love protocol - hand manipulation, giving and taking cards",$S="System",IS="2025-01-08T00:00:00Z",qS="#f2a3d7",LS="radial",PS=[{value:1,topEffects:[],middleEffects:[{id:"love-1-draw-opponent-deck",params:{action:"draw",count:1,target:"self",source:"opponent_deck"},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"love-1-end-give",params:{action:"give",count:1,source:"own_hand",optional:!0},conditional:{type:"if_executed",thenEffect:{id:"love-1-end-draw",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"bottom",trigger:"on_play"}},position:"bottom",trigger:"end"}]},{value:2,topEffects:[],middleEffects:[{id:"love-2-opponent-draw",params:{action:"draw",count:1,target:"opponent"},position:"middle",trigger:"on_play"},{id:"love-2-refresh",params:{action:"refresh",target:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"love-3-take",params:{action:"take",count:1,random:!0},position:"middle",trigger:"on_play"},{id:"love-3-give",params:{action:"give",count:1,source:"own_hand",optional:!1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"love-4-reveal",params:{action:"reveal",count:1,source:"own_hand"},position:"middle",trigger:"on_play"},{id:"love-4-flip",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"love-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:6,topEffects:[],middleEffects:[{id:"love-6-opponent-draw",params:{action:"draw",count:2,target:"opponent"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],US="Aux 1",ky={id:DS,name:AS,description:FS,author:$S,createdAt:IS,color:qS,pattern:LS,cards:PS,category:US},OS="psychic_custom_v1",MS="Psychic",VS="Custom Psychic protocol - mind control, discard, reveal, and protocol manipulation",HS="System",zS="2025-01-08T00:00:00Z",BS="#c78dd9",GS="radial",YS=[{value:0,topEffects:[],middleEffects:[{id:"psychic-0-draw",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"middle",trigger:"on_play"},{id:"psychic-0-opponent-discard",params:{action:"discard",count:2,actor:"opponent"},position:"middle",trigger:"on_play"},{id:"psychic-0-reveal-hand",params:{action:"reveal",source:"opponent_hand",count:-1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[{id:"psychic-1-force-face-down",params:{action:"passive_rule",rule:{type:"require_face_down_play",target:"opponent",scope:"global"}},position:"top",trigger:"passive"}],middleEffects:[],bottomEffects:[{id:"psychic-1-start-flip-self",params:{action:"flip",count:1,targetFilter:{owner:"self",position:"any",faceState:"any",excludeSelf:!1},flipSelf:!0},position:"bottom",trigger:"start"}]},{value:2,topEffects:[],middleEffects:[{id:"psychic-2-opponent-discard",params:{action:"discard",count:2,actor:"opponent"},position:"middle",trigger:"on_play"},{id:"psychic-2-rearrange",params:{action:"rearrange_protocols",target:"opponent"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"psychic-3-opponent-discard",params:{action:"discard",count:1,actor:"opponent"},position:"middle",trigger:"on_play"},{id:"psychic-3-shift-opponent",params:{action:"shift",targetFilter:{owner:"opponent",position:"uncovered",faceState:"any",excludeSelf:!1},destinationRestriction:{type:"any"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[],bottomEffects:[{id:"psychic-4-end-return",params:{action:"return",count:1,optional:!0,targetFilter:{owner:"opponent",position:"uncovered",faceState:"any",excludeSelf:!1}},conditional:{type:"if_executed",thenEffect:{id:"psychic-4-end-flip-self",params:{action:"flip",count:1,flipSelf:!0,targetFilter:{owner:"self",position:"any",faceState:"any",excludeSelf:!1}},position:"bottom",trigger:"end"}},position:"bottom",trigger:"end"}]},{value:5,topEffects:[],middleEffects:[{id:"psychic-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],WS="Main 1",Ny={id:OS,name:MS,description:VS,author:HS,createdAt:zS,color:BS,pattern:GS,cards:YS,category:WS},QS="smoke-custom-001",XS="Smoke",ZS="Shroud your cards in mystery. Use face-down cards to gain value and control.",KS="System",JS="2025-12-09T00:00:00.000Z",eb="#5A5A5A",tb="radial",nb=[{value:0,topEffects:[],middleEffects:[{id:"smoke-0-play-deck-each-facedown",params:{action:"play",source:"deck",count:1,faceDown:!0,destinationRule:{type:"each_line_with_card",cardFilter:{faceState:"face_down"}}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"smoke-1-flip-own",params:{action:"flip",count:1,targetFilter:{owner:"own",position:"uncovered",faceState:"any"},optional:!1},position:"middle",trigger:"on_play"},{id:"smoke-1-shift-that-card",params:{action:"shift",optional:!0,targetFilter:{owner:"own",position:"uncovered",faceState:"any"}},position:"middle",trigger:"on_play",useCardFromPreviousEffect:!0}],bottomEffects:[]},{value:2,topEffects:[{id:"smoke-2-value-per-facedown",params:{action:"value_modifier",modifier:{type:"add_per_condition",value:1,condition:"per_face_down_card",target:"own_total",scope:"this_lane"}},position:"top",trigger:"passive"}],middleEffects:[],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"smoke-3-play-hand-facedown-lane",params:{action:"play",source:"hand",count:1,faceDown:!0,destinationRule:{type:"line_with_matching_cards",cardFilter:{faceState:"face_down"}}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"smoke-4-shift-covered-facedown",params:{action:"shift",optional:!1,targetFilter:{owner:"any",position:"covered",faceState:"face_down"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"smoke-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],ab="Main 2",Ty={id:QS,name:XS,description:ZS,author:KS,createdAt:JS,color:eb,pattern:tb,cards:nb,category:ab},ob="clarity-custom-001",rb="Clarity",lb="See through the fog of war. Reveal your deck and hand to gain powerful advantages.",sb="System",cb="2025-12-09T00:00:00.000Z",ib="#87CEEB",db="radial",ub=[{value:0,topEffects:[{id:"clarity-0-value-per-hand",params:{action:"value_modifier",modifier:{type:"add_per_condition",value:1,condition:"per_card_in_hand",target:"own_total",scope:"this_lane"}},position:"top",trigger:"passive"}],middleEffects:[],bottomEffects:[]},{value:1,topEffects:[{id:"clarity-1-start-reveal-deck-top",params:{action:"reveal",source:"own_deck_top",count:1},position:"top",trigger:"start",conditional:{type:"optional",thenEffect:{id:"clarity-1-discard-revealed",params:{action:"discard",count:1,actor:"self",useCardFromPreviousEffect:!0}}}}],middleEffects:[{id:"clarity-1-middle-reveal-opponent-hand",params:{action:"reveal",source:"opponent_hand",count:-1},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"clarity-1-bottom-draw-3",params:{action:"draw",count:3,target:"self",source:"own_deck"},position:"bottom",trigger:"on_cover"}]},{value:2,topEffects:[],middleEffects:[{id:"clarity-2-reveal-deck",params:{action:"reveal",source:"own_deck",count:-1},position:"middle",trigger:"on_play"},{id:"clarity-2-draw-value-1",params:{action:"draw",count:1,target:"self",source:"own_deck",valueFilter:{equals:1},fromRevealed:!0},position:"middle",trigger:"on_play"},{id:"clarity-2-shuffle-deck",params:{action:"shuffle_deck"},position:"middle",trigger:"on_play"},{id:"clarity-2-play-value-1",params:{action:"play",source:"hand",count:1,valueFilter:{equals:1}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"clarity-3-reveal-deck",params:{action:"reveal",source:"own_deck",count:-1},position:"middle",trigger:"on_play"},{id:"clarity-3-draw-value-5",params:{action:"draw",count:1,target:"self",source:"own_deck",valueFilter:{equals:5},fromRevealed:!0},position:"middle",trigger:"on_play"},{id:"clarity-3-shuffle-deck",params:{action:"shuffle_deck"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"clarity-4-shuffle-trash",params:{action:"shuffle_trash",optional:!0},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"clarity-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],pb="Main 2",Ry={id:ob,name:rb,description:lb,author:sb,createdAt:cb,color:ib,pattern:db,cards:ub,category:pb},fb="corruption-custom-001",hb="Corruption",mb="Corrupt your opponents plans. Use discard synergies and manipulate the return mechanic.",yb="System",gb="2025-12-09T00:00:00.000Z",vb="#4A0080",_b="stripes",wb=[{value:0,topEffects:[{id:"corruption-0-start-flip",params:{action:"flip",count:1,scope:"this_lane",targetFilter:{owner:"own",position:"any",faceState:"face_up",excludeSelf:!0},optional:!1},position:"top",trigger:"start"}],middleEffects:[],bottomEffects:[{id:"corruption-0-play-opponent-side",params:{action:"passive_rule",rule:{type:"allow_play_on_opponent_side",target:"self",scope:"global"}},position:"bottom",trigger:"passive"}]},{value:1,topEffects:[],middleEffects:[{id:"corruption-1-return",params:{action:"return",count:1,targetFilter:{owner:"any",position:"uncovered"}},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"corruption-1-redirect-return",params:{action:"redirect_return_to_deck",faceDown:!0,targetOwner:"opponent"},position:"bottom",trigger:"when_card_returned"}]},{value:2,topEffects:[{id:"corruption-2-after-discard",params:{action:"discard",count:1,actor:"opponent"},position:"top",trigger:"after_discard",reactiveTriggerActor:"self"}],middleEffects:[{id:"corruption-2-draw",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"middle",trigger:"on_play"},{id:"corruption-2-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"corruption-3-flip-covered",params:{action:"flip",count:1,optional:!0,targetFilter:{owner:"any",position:"covered",faceState:"face_up",excludeSelf:!1}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"corruption-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:6,topEffects:[{id:"corruption-6-end-choice",params:{action:"choice",options:[{id:"corruption-6-choice-discard",params:{action:"discard",count:1,actor:"self"},position:"top",trigger:"end"},{id:"corruption-6-choice-delete-self",params:{action:"delete",deleteSelf:!0},position:"top",trigger:"end"}]},position:"top",trigger:"end"}],middleEffects:[],bottomEffects:[]}],xb="Main 2",Dy={id:fb,name:hb,description:mb,author:yb,createdAt:gb,color:vb,pattern:_b,cards:wb,category:xb},Cb="courage-custom-001",Sb="Courage",bb="Face challenges head-on. Gain power when outnumbered.",Eb="System",jb="2025-12-10T00:00:00.000Z",kb="#D4AF37",Nb="radial",Tb=[{value:0,topEffects:[{id:"courage-0-start-draw",params:{action:"draw",count:1,advancedConditional:{type:"empty_hand"}},position:"top",trigger:"start"}],middleEffects:[{id:"courage-0-draw",params:{action:"draw",count:1},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"courage-0-end-discard",params:{action:"discard",count:1,optional:!0},position:"bottom",trigger:"end",conditional:{type:"if_executed",thenEffect:{id:"courage-0-opponent-discard",params:{action:"discard",count:1,actor:"opponent"},position:"bottom",trigger:"end"}}}]},{value:1,topEffects:[],middleEffects:[{id:"courage-1-delete",params:{action:"delete",count:1,targetFilter:{owner:"opponent",position:"uncovered"},selectLane:!0,laneCondition:{type:"opponent_higher_value"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"courage-2-draw",params:{action:"draw",count:1},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"courage-2-end-draw",params:{action:"draw",count:1,advancedConditional:{type:"opponent_higher_value_in_lane"}},position:"bottom",trigger:"end"}]},{value:3,topEffects:[],middleEffects:[],bottomEffects:[{id:"courage-3-shift",params:{action:"shift",shiftSelf:!0,optional:!0,destinationRestriction:{type:"opponent_highest_value_lane"}},position:"bottom",trigger:"end"}]},{value:5,topEffects:[],middleEffects:[{id:"courage-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:6,topEffects:[{id:"courage-6-flip",params:{action:"flip",flipSelf:!0,advancedConditional:{type:"opponent_higher_value_in_lane"}},position:"top",trigger:"end"}],middleEffects:[],bottomEffects:[]}],Rb="Main 2",Ay={id:Cb,name:Sb,description:bb,author:Eb,createdAt:jb,color:kb,pattern:Nb,cards:Tb,category:Rb},Db="diversity-custom-001",Ab="Diversity",Fb="Embrace variety. The more different protocols on the field, the stronger your effects become.",$b="System",Ib="2025-12-18T00:00:00.000Z",qb="#FF6B6B",Lb="zigzag",Pb=[{value:0,topEffects:[],middleEffects:[{id:"diversity-0-auto-compile",params:{action:"auto_compile",protocolCountConditional:{type:"unique_protocols_on_field",threshold:6}},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"diversity-0-play-non-protocol",params:{action:"play",source:"hand",count:1,excludeSourceProtocol:!0,optional:!0,destinationRule:{type:"specific_lane",laneIndex:"current"}},position:"bottom",trigger:"end"}]},{value:1,topEffects:[],middleEffects:[{id:"diversity-1-shift",params:{action:"shift",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any"}},position:"middle",trigger:"on_play"},{id:"diversity-1-draw-protocols",params:{action:"draw",countType:"equal_to_unique_protocols_in_lane",target:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[{id:"diversity-3-value-modifier",params:{action:"value_modifier",modifier:{type:"add_to_total",value:2,target:"own_total",scope:"this_lane",condition:"has_non_own_protocol_face_up"}},position:"top",trigger:"passive"}],middleEffects:[],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"diversity-4-flip-dynamic",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1,valueLessThanUniqueProtocolsOnField:!0}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"diversity-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:6,topEffects:[{id:"diversity-6-conditional-delete",params:{action:"delete",deleteSelf:!0,protocolCountConditional:{type:"unique_protocols_on_field_below",threshold:3}},position:"top",trigger:"end"}],middleEffects:[],bottomEffects:[]}],Ub="Aux 2",Fy={id:Db,name:Ab,description:Fb,author:$b,createdAt:Ib,color:qb,pattern:Lb,cards:Pb,category:Ub},Ob="fear_custom",Mb="Fear",Vb="Terror and disruption protocol - Control through fear",Hb="System",zb="2025-01-10T00:00:00Z",Bb="#800020",Gb="radial",Yb="Main 2",Wb=[{value:0,topEffects:[{id:"fear-0-passive",params:{action:"passive_rule",rule:{type:"ignore_middle_commands",target:"opponent",scope:"global",onlyDuringYourTurn:!0}},position:"top",trigger:"passive"}],middleEffects:[{id:"fear-0-choice",params:{action:"choice",options:[{id:"fear-0-shift",params:{action:"shift",targetFilter:{owner:"any",position:"uncovered",faceState:"any"}},position:"middle",trigger:"on_play"},{id:"fear-0-flip",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1},optional:!1},position:"middle",trigger:"on_play"}]},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"fear-1-draw",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"middle",trigger:"on_play",conditional:{type:"then",thenEffect:{id:"fear-1-opponent-discard-hand",params:{action:"discard",count:"all",actor:"opponent"},position:"middle",trigger:"on_play",conditional:{type:"then",thenEffect:{id:"fear-1-opponent-draw",params:{action:"draw",countType:"equal_to_discarded",countOffset:-1,target:"opponent"},position:"middle",trigger:"on_play"}}}}}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"fear-2-return",params:{action:"return",count:1,targetFilter:{owner:"opponent"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"fear-3-shift",params:{action:"shift",targetFilter:{owner:"opponent",position:"any",faceState:"any"},scope:"this_lane"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"fear-4-discard-random",params:{action:"discard",count:1,actor:"opponent",random:!0},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"fear-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],$y={id:Ob,name:Mb,description:Vb,author:Hb,createdAt:zb,color:Bb,pattern:Gb,category:Yb,cards:Wb},Qb="ice_custom",Xb="Ice",Zb="Control and disruption through shifting and conditional effects",Kb="System",Jb="2025-12-10T00:00:00Z",eE="#B0E0E6",tE="radial",nE="Main 2",aE=[{value:1,topEffects:[],middleEffects:[{id:"ice-1-shift",params:{action:"shift",shiftSelf:!0,optional:!0},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"ice-1-reactive",params:{action:"discard",actor:"opponent",count:1},position:"bottom",trigger:"after_play",reactiveTriggerActor:"opponent",reactiveScope:"this_lane"}]},{value:2,topEffects:[],middleEffects:[{id:"ice-2-shift",params:{action:"shift",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!0}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[{id:"ice-3-end-shift",params:{action:"shift",shiftSelf:!0,optional:!0,advancedConditional:{type:"this_card_is_covered"}},position:"top",trigger:"end"}],middleEffects:[],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[],bottomEffects:[{id:"ice-4-passive",params:{action:"passive_rule",rule:{type:"block_flip_this_card",target:"this_card",scope:"this_card"}},position:"bottom",trigger:"passive"}]},{value:5,topEffects:[],middleEffects:[{id:"ice-5-discard",params:{action:"discard",actor:"self",count:1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:6,topEffects:[{id:"ice-6-passive",params:{action:"passive_rule",rule:{type:"block_draw_conditional",conditionTarget:"self",blockTarget:"self",scope:"global"}},position:"top",trigger:"passive"}],middleEffects:[],bottomEffects:[]}],Iy={id:Qb,name:Xb,description:Zb,author:Kb,createdAt:Jb,color:eE,pattern:tE,category:nE,cards:aE},oE="luck-custom-001",rE="Luck",lE="Gamble with fate. State numbers and protocols to manipulate the top of decks.",sE="System",cE="2025-01-15T00:00:00.000Z",iE="#FFD700",dE="chaos",uE=[{value:0,topEffects:[],middleEffects:[{id:"luck-0-state-number",params:{action:"state_number",numberSource:"own_protocol_values"},position:"middle",trigger:"on_play"},{id:"luck-0-draw-and-reveal",params:{action:"draw",count:3,target:"self",source:"own_deck",revealFromDrawn:{valueSource:"stated_number",thenAction:"may_play"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"luck-1-play-deck-top",params:{action:"play",source:"deck",count:1,faceDown:!0,destinationRule:{type:"another_line"}},position:"middle",trigger:"on_play",conditional:{type:"then",thenEffect:{id:"luck-1-flip-skip-middle",params:{action:"flip",skipMiddleCommand:!0},useCardFromPreviousEffect:!0}}}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"luck-2-discard-deck-top",params:{action:"discard",source:"top_deck_own",count:1},position:"middle",trigger:"on_play",conditional:{type:"then",thenEffect:{id:"luck-2-draw-equal-value",params:{action:"draw",countType:"equal_to_card_value",target:"self",source:"own_deck"},useCardFromPreviousEffect:!0}}}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"luck-3-state-protocol",params:{action:"state_protocol",protocolSource:"opponent_cards"},position:"middle",trigger:"on_play"},{id:"luck-3-discard-opponent-deck",params:{action:"discard",source:"top_deck_opponent",count:1},position:"middle",trigger:"on_play",conditional:{type:"if_protocol_matches_stated",thenEffect:{id:"luck-3-delete",params:{action:"delete",count:1}}}}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"luck-4-discard-deck-top",params:{action:"discard",source:"top_deck_own",count:1},position:"middle",trigger:"on_play",conditional:{type:"then",thenEffect:{id:"luck-4-delete-same-value",params:{action:"delete",count:1,targetFilter:{position:"any",valueSource:"previous_effect_card"}}}}}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"luck-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],pE="Main 2",qy={id:oE,name:rE,description:lE,author:sE,createdAt:cE,color:iE,pattern:dE,cards:uE,category:pE},fE="mirror-custom-001",hE="Mirror",mE="Copy, symmetry, and reflection. Mirror your opponent's actions.",yE="System",gE="2025-01-15T00:00:00.000Z",vE="#C0C0C0",_E="radial",wE="Main 2",xE=[{value:0,topEffects:[{id:"mirror-0-value-modifier",params:{action:"value_modifier",modifier:{type:"add_per_condition",value:1,condition:"per_opponent_card_in_lane",target:"own_total",scope:"this_lane"}},position:"top",trigger:"passive"}],middleEffects:[],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[],bottomEffects:[{id:"mirror-1-copy-middle",params:{action:"copy_opponent_middle",optional:!0},position:"bottom",trigger:"end"}]},{value:2,topEffects:[],middleEffects:[{id:"mirror-2-swap-stacks",params:{action:"swap_stacks",target:"own"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"mirror-3-flip-own",params:{action:"flip",count:1,targetFilter:{owner:"own",position:"uncovered",faceState:"any",excludeSelf:!0},optional:!1},position:"middle",trigger:"on_play",conditional:{type:"then",thenEffect:{id:"mirror-3-flip-opponent-same-lane",params:{action:"flip",count:1,targetFilter:{owner:"opponent",position:"uncovered",faceState:"any"},sameLaneAsFirst:!0,optional:!1},position:"middle",trigger:"on_play"}}}],bottomEffects:[]},{value:4,topEffects:[{id:"mirror-4-after-opponent-draw",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"top",trigger:"after_opponent_draw"}],middleEffects:[],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"mirror-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],Ly={id:fE,name:hE,description:mE,author:yE,createdAt:gE,color:vE,pattern:_E,category:wE,cards:xE},CE="peace-custom-001",SE="Peace",bE="Harmony and balance. Sacrifice to achieve equilibrium.",EE="System",jE="2025-01-16T00:00:00.000Z",kE="#87CEEB",NE="radial",TE="Main 2",RE=[{value:1,topEffects:[],middleEffects:[{id:"peace-1-both-discard",params:{action:"discard",actor:"both",count:"all"},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"peace-1-end-draw",params:{action:"draw",count:1,target:"self",source:"own_deck",advancedConditional:{type:"empty_hand"}},position:"bottom",trigger:"end"}]},{value:2,topEffects:[],middleEffects:[{id:"peace-2-draw",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"middle",trigger:"on_play"},{id:"peace-2-play",params:{action:"play",source:"hand",count:1,faceDown:!0},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"peace-3-discard-flip",params:{action:"discard",actor:"self",count:1},position:"middle",trigger:"on_play",optional:!0,conditional:{type:"if_executed",thenEffect:{id:"peace-3-flip",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1,valueMinGreaterThanHandSize:!0},optional:!1},position:"middle",trigger:"on_play"}}}],bottomEffects:[]},{value:4,topEffects:[{id:"peace-4-reactive-draw",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"top",trigger:"after_discard",reactiveTriggerActor:"self",onlyDuringOpponentTurn:!0}],middleEffects:[],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"peace-5-discard",params:{action:"discard",actor:"self",count:1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:6,topEffects:[],middleEffects:[{id:"peace-6-flip-self",params:{action:"flip",count:1,flipSelf:!0,advancedConditional:{type:"hand_size_greater_than",threshold:1}},position:"middle",trigger:"on_play"}],bottomEffects:[]}],Py={id:CE,name:SE,description:bE,author:EE,createdAt:jE,color:kE,pattern:NE,category:TE,cards:RE},DE="time-custom-001",AE="Time",FE="Manipulate time through your trash and deck. Recycle discarded cards and control the flow of battle.",$E="System",IE="2025-12-17T00:00:00.000Z",qE="#8B4513",LE="hexagons",PE=[{value:0,topEffects:[],middleEffects:[{id:"time-0-play-from-trash",params:{action:"play",source:"trash",count:1},position:"middle",trigger:"on_play"},{id:"time-0-shuffle-trash",params:{action:"shuffle_trash",optional:!1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"time-1-flip-covered",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"covered",faceState:"any",excludeSelf:!1},optional:!1},position:"middle",trigger:"on_play"},{id:"time-1-discard-entire-deck",params:{action:"discard",count:1,actor:"self",source:"entire_deck"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:2,topEffects:[{id:"time-2-after-shuffle-draw",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"top",trigger:"after_shuffle",reactiveTriggerActor:"self",conditional:{type:"then",thenEffect:{id:"time-2-then-shift-self",params:{action:"shift",targetFilter:{owner:"own"},shiftSelf:!0,optional:!0}}}}],middleEffects:[{id:"time-2-conditional-shuffle-trash",params:{action:"shuffle_trash",optional:!0,advancedConditional:{type:"trash_not_empty"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"time-3-reveal-from-trash",params:{action:"reveal",source:"own_trash",count:1},position:"middle",trigger:"on_play",conditional:{type:"if_executed",thenEffect:{id:"time-3-play-face-down",params:{action:"play",source:"trash",count:1,faceDown:!0,destinationRule:{type:"other_lines"}},useCardFromPreviousEffect:!0}}}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"time-4-draw-2",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"middle",trigger:"on_play"},{id:"time-4-discard-2",params:{action:"discard",count:2,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"time-5-discard-1",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],UE="Main 2",Uy={id:DE,name:AE,description:FE,author:$E,createdAt:IE,color:qE,pattern:LE,cards:PE,category:UE},OE="unity-custom-001",ME="Unity",VE="Strength in unity. Unity cards synergize with each other - effects become stronger with more face-up Unity cards on the field.",HE="System",zE="2025-12-18T00:00:00.000Z",BE="#4CAF50",GE="hexagons",YE=[{value:0,topEffects:[],middleEffects:[{id:"unity-0-choice",params:{action:"choice",advancedConditional:{type:"same_protocol_on_field"},options:[{id:"unity-0-choice-flip",trigger:"on_play",params:{action:"flip",count:1,optional:!0,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1}},position:"middle"},{id:"unity-0-choice-draw",trigger:"on_play",params:{action:"draw",count:1,target:"self"},position:"middle"}]},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"unity-0-on-cover-choice",params:{action:"choice",options:[{id:"unity-0-cover-choice-flip",trigger:"on_cover",params:{action:"flip",count:1,optional:!1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1}},position:"bottom"},{id:"unity-0-cover-choice-draw",trigger:"on_cover",params:{action:"draw",count:1,target:"self"},position:"bottom"}]},position:"bottom",trigger:"on_cover",onCoverProtocolRestriction:"same_protocol"}]},{value:1,topEffects:[{id:"unity-1-shift-if-covered",params:{action:"shift",shiftSelf:!0,optional:!0,advancedConditional:{type:"this_card_is_covered"}},position:"top",trigger:"start"}],middleEffects:[{id:"unity-1-auto-compile",params:{action:"auto_compile",protocolCountConditional:{type:"same_protocol_count_on_field",threshold:5,faceState:"face_up"},deleteAllInLane:!0},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"unity-1-face-up-play",params:{action:"passive_rule",rule:{type:"allow_same_protocol_face_up_play",scope:"this_lane",protocolScope:"same_as_source"}},position:"bottom",trigger:"passive"}]},{value:2,topEffects:[],middleEffects:[{id:"unity-2-draw-count",params:{action:"draw",countType:"count_own_protocol_cards_on_field",target:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"unity-3-conditional-flip",params:{action:"flip",count:1,optional:!0,advancedConditional:{type:"same_protocol_on_field"},targetFilter:{owner:"any",position:"uncovered",faceState:"face_up",excludeSelf:!1}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[{id:"unity-4-draw-all-protocol",params:{action:"draw",advancedConditional:{type:"empty_hand"},protocolFilter:{type:"same_as_source"},revealDeck:!0,shuffleAfter:!0,target:"self"},position:"top",trigger:"start"}],middleEffects:[],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"unity-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],WE="Aux 2",Oy={id:OE,name:ME,description:VE,author:HE,createdAt:zE,color:BE,pattern:GE,cards:YE,category:WE},QE="war-custom-001",XE="War",ZE="CONFLICT, AGGRESSION - Punishes opponent actions with reactive effects",KE="System",JE="2025-01-01T00:00:00.000Z",ej="#8B0000",tj="grid",nj="Main 2",aj=[{value:0,topEffects:[{id:"war-0-top-flip-self",params:{action:"flip",flipSelf:!0,optional:!0},position:"top",trigger:"after_refresh"}],middleEffects:[],bottomEffects:[{id:"war-0-bottom-delete",params:{action:"delete",count:1,optional:!0,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1},scope:{type:"anywhere"}},position:"bottom",trigger:"after_opponent_draw"}]},{value:1,topEffects:[],middleEffects:[],bottomEffects:[{id:"war-1-discard-refresh",params:{action:"discard",actor:"self",variableCount:!0},position:"bottom",trigger:"after_opponent_refresh",conditional:{type:"then",thenEffect:{id:"war-1-refresh",params:{action:"refresh",target:"self"},position:"bottom",trigger:"after_opponent_refresh"}}}]},{value:2,topEffects:[],middleEffects:[{id:"war-2-flip",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1}},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"war-2-opponent-discard-all",params:{action:"discard",actor:"opponent",count:"all"},position:"bottom",trigger:"after_opponent_compile"}]},{value:3,topEffects:[],middleEffects:[{id:"war-3-draw",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"war-3-play-facedown",params:{action:"play",source:"hand",count:1,faceDown:!0,optional:!0,destinationRule:{type:"other_lines"}},position:"bottom",trigger:"after_opponent_discard"}]},{value:4,topEffects:[],middleEffects:[{id:"war-4-opponent-discard",params:{action:"discard",actor:"opponent",count:1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"war-5-self-discard",params:{action:"discard",actor:"self",count:1},position:"middle",trigger:"on_play"}],bottomEffects:[]}],My={id:QE,name:XE,description:ZE,author:KE,createdAt:JE,color:ej,pattern:tj,category:nj,cards:aj};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const oj=[dy,uy,py,fy,hy,my,Fy,yy,gy,vy,_y,wy,xy,Cy,Sy,by,Ey,jy,ky,Ny,Ty,Ry,Dy,Ay,$y,Iy,qy,Ly,Py,Uy,Oy,My],rj=()=>oj.map(t=>t.name.replace(/_custom$/i,"")),lj=()=>{try{const t=wr(),n=t.findIndex(r=>r.id==="dark_cust_v2"||r.name==="Dark_cust");n>=0&&(t.splice(n,1),du(t)),vt(dy),vt(uy),vt(py),vt(hy),vt(my),vt(yy),vt(_y),vt(wy),vt(fy),vt(xy),vt(gy),vt(vy),vt(Cy),vt(Sy),vt(by),vt(Ey),vt(jy),vt(ky),vt(Ny),vt(Ty),vt(Ry),vt(Dy),vt(Ay),vt(Fy),vt($y),vt(Iy),vt(qy),vt(Ly),vt(Py),vt(Uy),vt(Oy),vt(My)}catch(t){console.error("[Default Protocols] Error loading default protocols:",t)}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Su="compile_game_statistics",Vy=()=>{const t=M0,n=rj(),r=new Set([...t,...n]);return Array.from(r).sort()},Hy=1;function $m(){const t=Vy(),n={};return t.forEach(r=>{n[r]={timesUsed:0,wins:0,losses:0}}),{version:Hy,global:{totalGamesPlayed:0,totalGamesWon:0,totalGamesLost:0,totalPlaytime:0,fastestWin:null,longestGame:null,lastGameDuration:null,currentStreak:0,longestWinStreak:0,longestLoseStreak:0},protocols:n,aiDifficulty:{easy:{played:0,wins:0,losses:0},normal:{played:0,wins:0,losses:0},hard:{played:0,wins:0,losses:0}},cards:{played:{},deleted:{}},actions:{totalCardsDrawn:0,totalCardsPlayed:0,totalShifts:0,totalDeletes:0,totalDiscards:0,totalFlips:0,totalCompiles:0,totalRefreshes:0,totalReturns:0,detailedStats:{cardsPlayed:{total:0,player:0,ai:0,playerFromHand:0,playerFromEffect:0,aiFromHand:0,aiFromEffect:0,playerFaceUp:0,playerFaceDown:0,aiFaceUp:0,aiFaceDown:0},cardsDrawn:{total:0,player:0,ai:0,playerFromRefresh:0,playerFromEffect:0,aiFromRefresh:0,aiFromEffect:0},discards:{total:0,player:0,ai:0},deletes:{total:0,player:0,ai:0},flips:{total:0,player:0,ai:0},shifts:{total:0,player:0,ai:0},returns:{total:0,player:0,ai:0},compiles:{total:0,player:0,ai:0,playerFirstCompile:0,playerRecompile:0,aiFirstCompile:0,aiRecompile:0},refreshes:{total:0,player:0,ai:0,playerCardsDrawn:0,aiCardsDrawn:0}}},control:{gamesWithControl:0,gamesWithoutControl:0,playerRearranges:0,aiRearranges:0,totalRearranges:0},coinFlip:{headsChosen:0,tailsChosen:0,headsWon:0,tailsWon:0}}}function su(){var t,n,r,c,s,d,u,p,f,h,_,y,m,g,x,C,b,j,k,E,T,F,U,D,I,W,z,V,B,L,P,M,N,R,$,X,G,q,Q,K,Z,te,ee,se,_e,fe,be,oe,H,ne,J,ie,de,pe,Se,Fe,je,Ve,He,Ge,qe,Ne,Oe,Le,ut,Qe,Je,Ft,tn,Gt,Lt,nn,Pt,Ha,Na,ma,bn,ta,Pn,gn,En,Jt,Un,ya,ga,On,za,Ta,Ra,va,Mn,_a,Da,Aa,hn,$t,Mt,jn,wa,Ba,Ga,Fa,Vn,na,vn,_n,kn,wn,Tt,xa,Ca,mn,xn,ge,De,Me,ot,ze,Ye,me,xe,Pe,Ae,Xe,it,Ut,xt,Vt,Sa,Hn,po,$a,fo,ho,aa,Zo,mo,yo,Ht,Cr,Sr,Ya,Nn,go,vo,ba,Tn;try{const Rt=localStorage.getItem(Su);if(!Rt)return $m();const Ue=JSON.parse(Rt),zn=Vy(),Ia={...Ue.protocols||{}};zn.forEach(_o=>{Ia[_o]||(Ia[_o]={timesUsed:0,wins:0,losses:0})});const oa={...Ue,version:Hy,global:{...Ue.global,lastGameDuration:((t=Ue.global)==null?void 0:t.lastGameDuration)||null},protocols:Ia,control:{gamesWithControl:((n=Ue.control)==null?void 0:n.gamesWithControl)||0,gamesWithoutControl:((r=Ue.control)==null?void 0:r.gamesWithoutControl)||0,playerRearranges:((c=Ue.control)==null?void 0:c.playerRearranges)||0,aiRearranges:((s=Ue.control)==null?void 0:s.aiRearranges)||0,totalRearranges:((d=Ue.control)==null?void 0:d.totalRearranges)||0},coinFlip:Ue.coinFlip||{headsChosen:0,tailsChosen:0,headsWon:0,tailsWon:0},actions:{...Ue.actions,totalCompiles:((u=Ue.actions)==null?void 0:u.totalCompiles)||0,totalRefreshes:((p=Ue.actions)==null?void 0:p.totalRefreshes)||0,totalReturns:((f=Ue.actions)==null?void 0:f.totalReturns)||0,detailedStats:{cardsPlayed:{total:((y=(_=(h=Ue.actions)==null?void 0:h.detailedStats)==null?void 0:_.cardsPlayed)==null?void 0:y.total)||0,player:((x=(g=(m=Ue.actions)==null?void 0:m.detailedStats)==null?void 0:g.cardsPlayed)==null?void 0:x.player)||0,ai:((j=(b=(C=Ue.actions)==null?void 0:C.detailedStats)==null?void 0:b.cardsPlayed)==null?void 0:j.ai)||0,playerFromHand:((T=(E=(k=Ue.actions)==null?void 0:k.detailedStats)==null?void 0:E.cardsPlayed)==null?void 0:T.playerFromHand)||0,playerFromEffect:((D=(U=(F=Ue.actions)==null?void 0:F.detailedStats)==null?void 0:U.cardsPlayed)==null?void 0:D.playerFromEffect)||0,aiFromHand:((z=(W=(I=Ue.actions)==null?void 0:I.detailedStats)==null?void 0:W.cardsPlayed)==null?void 0:z.aiFromHand)||0,aiFromEffect:((L=(B=(V=Ue.actions)==null?void 0:V.detailedStats)==null?void 0:B.cardsPlayed)==null?void 0:L.aiFromEffect)||0,playerFaceUp:((N=(M=(P=Ue.actions)==null?void 0:P.detailedStats)==null?void 0:M.cardsPlayed)==null?void 0:N.playerFaceUp)||0,playerFaceDown:((X=($=(R=Ue.actions)==null?void 0:R.detailedStats)==null?void 0:$.cardsPlayed)==null?void 0:X.playerFaceDown)||0,aiFaceUp:((Q=(q=(G=Ue.actions)==null?void 0:G.detailedStats)==null?void 0:q.cardsPlayed)==null?void 0:Q.aiFaceUp)||0,aiFaceDown:((te=(Z=(K=Ue.actions)==null?void 0:K.detailedStats)==null?void 0:Z.cardsPlayed)==null?void 0:te.aiFaceDown)||0},cardsDrawn:{total:((_e=(se=(ee=Ue.actions)==null?void 0:ee.detailedStats)==null?void 0:se.cardsDrawn)==null?void 0:_e.total)||0,player:((oe=(be=(fe=Ue.actions)==null?void 0:fe.detailedStats)==null?void 0:be.cardsDrawn)==null?void 0:oe.player)||0,ai:((J=(ne=(H=Ue.actions)==null?void 0:H.detailedStats)==null?void 0:ne.cardsDrawn)==null?void 0:J.ai)||0,playerFromRefresh:((pe=(de=(ie=Ue.actions)==null?void 0:ie.detailedStats)==null?void 0:de.cardsDrawn)==null?void 0:pe.playerFromRefresh)||0,playerFromEffect:((je=(Fe=(Se=Ue.actions)==null?void 0:Se.detailedStats)==null?void 0:Fe.cardsDrawn)==null?void 0:je.playerFromEffect)||0,aiFromRefresh:((Ge=(He=(Ve=Ue.actions)==null?void 0:Ve.detailedStats)==null?void 0:He.cardsDrawn)==null?void 0:Ge.aiFromRefresh)||0,aiFromEffect:((Oe=(Ne=(qe=Ue.actions)==null?void 0:qe.detailedStats)==null?void 0:Ne.cardsDrawn)==null?void 0:Oe.aiFromEffect)||0},discards:{total:((Qe=(ut=(Le=Ue.actions)==null?void 0:Le.detailedStats)==null?void 0:ut.discards)==null?void 0:Qe.total)||0,player:((tn=(Ft=(Je=Ue.actions)==null?void 0:Je.detailedStats)==null?void 0:Ft.discards)==null?void 0:tn.player)||0,ai:((nn=(Lt=(Gt=Ue.actions)==null?void 0:Gt.detailedStats)==null?void 0:Lt.discards)==null?void 0:nn.ai)||0},deletes:{total:((Na=(Ha=(Pt=Ue.actions)==null?void 0:Pt.detailedStats)==null?void 0:Ha.deletes)==null?void 0:Na.total)||0,player:((ta=(bn=(ma=Ue.actions)==null?void 0:ma.detailedStats)==null?void 0:bn.deletes)==null?void 0:ta.player)||0,ai:((En=(gn=(Pn=Ue.actions)==null?void 0:Pn.detailedStats)==null?void 0:gn.deletes)==null?void 0:En.ai)||0},flips:{total:((ya=(Un=(Jt=Ue.actions)==null?void 0:Jt.detailedStats)==null?void 0:Un.flips)==null?void 0:ya.total)||0,player:((za=(On=(ga=Ue.actions)==null?void 0:ga.detailedStats)==null?void 0:On.flips)==null?void 0:za.player)||0,ai:((va=(Ra=(Ta=Ue.actions)==null?void 0:Ta.detailedStats)==null?void 0:Ra.flips)==null?void 0:va.ai)||0},shifts:{total:((Da=(_a=(Mn=Ue.actions)==null?void 0:Mn.detailedStats)==null?void 0:_a.shifts)==null?void 0:Da.total)||0,player:(($t=(hn=(Aa=Ue.actions)==null?void 0:Aa.detailedStats)==null?void 0:hn.shifts)==null?void 0:$t.player)||0,ai:((wa=(jn=(Mt=Ue.actions)==null?void 0:Mt.detailedStats)==null?void 0:jn.shifts)==null?void 0:wa.ai)||0},returns:{total:((Fa=(Ga=(Ba=Ue.actions)==null?void 0:Ba.detailedStats)==null?void 0:Ga.returns)==null?void 0:Fa.total)||0,player:((vn=(na=(Vn=Ue.actions)==null?void 0:Vn.detailedStats)==null?void 0:na.returns)==null?void 0:vn.player)||0,ai:((wn=(kn=(_n=Ue.actions)==null?void 0:_n.detailedStats)==null?void 0:kn.returns)==null?void 0:wn.ai)||0},compiles:{total:((Ca=(xa=(Tt=Ue.actions)==null?void 0:Tt.detailedStats)==null?void 0:xa.compiles)==null?void 0:Ca.total)||0,player:((ge=(xn=(mn=Ue.actions)==null?void 0:mn.detailedStats)==null?void 0:xn.compiles)==null?void 0:ge.player)||0,ai:((ot=(Me=(De=Ue.actions)==null?void 0:De.detailedStats)==null?void 0:Me.compiles)==null?void 0:ot.ai)||0,playerFirstCompile:((me=(Ye=(ze=Ue.actions)==null?void 0:ze.detailedStats)==null?void 0:Ye.compiles)==null?void 0:me.playerFirstCompile)||0,playerRecompile:((Ae=(Pe=(xe=Ue.actions)==null?void 0:xe.detailedStats)==null?void 0:Pe.compiles)==null?void 0:Ae.playerRecompile)||0,aiFirstCompile:((Ut=(it=(Xe=Ue.actions)==null?void 0:Xe.detailedStats)==null?void 0:it.compiles)==null?void 0:Ut.aiFirstCompile)||0,aiRecompile:((Sa=(Vt=(xt=Ue.actions)==null?void 0:xt.detailedStats)==null?void 0:Vt.compiles)==null?void 0:Sa.aiRecompile)||0},refreshes:{total:(($a=(po=(Hn=Ue.actions)==null?void 0:Hn.detailedStats)==null?void 0:po.refreshes)==null?void 0:$a.total)||0,player:((aa=(ho=(fo=Ue.actions)==null?void 0:fo.detailedStats)==null?void 0:ho.refreshes)==null?void 0:aa.player)||0,ai:((yo=(mo=(Zo=Ue.actions)==null?void 0:Zo.detailedStats)==null?void 0:mo.refreshes)==null?void 0:yo.ai)||0,playerCardsDrawn:((Sr=(Cr=(Ht=Ue.actions)==null?void 0:Ht.detailedStats)==null?void 0:Cr.refreshes)==null?void 0:Sr.playerCardsDrawn)||0,aiCardsDrawn:((go=(Nn=(Ya=Ue.actions)==null?void 0:Ya.detailedStats)==null?void 0:Nn.refreshes)==null?void 0:go.aiCardsDrawn)||0}}}};return(!((vo=Ue.control)!=null&&vo.playerRearranges)||!Ue.coinFlip||!((ba=Ue.actions)!=null&&ba.totalCompiles)||!((Tn=Ue.actions)!=null&&Tn.detailedStats)||Object.keys(Ia).length!==Object.keys(Ue.protocols||{}).length)&&ol(oa),oa}catch(Rt){return console.error("Failed to load statistics:",Rt),$m()}}function ol(t){try{localStorage.setItem(Su,JSON.stringify(t))}catch(n){console.error("Failed to save statistics:",n)}}function sj(){try{localStorage.removeItem(Su)}catch(t){console.error("Failed to reset statistics:",t)}}function cj(t,n,r,c,s,d=!1,u,p,f,h){const _=n==="player",y={...t.global},m={...t.protocols},g={easy:{...t.aiDifficulty.easy},normal:{...t.aiDifficulty.normal},hard:{...t.aiDifficulty.hard}},x={...t.control},C={...t.actions},b={...t.coinFlip},j={played:{...t.cards.played},deleted:{...t.cards.deleted}};y.totalGamesPlayed++,_?y.totalGamesWon++:y.totalGamesLost++,y.totalPlaytime+=s,_&&(y.fastestWin===null||s<y.fastestWin)&&(y.fastestWin=s),(y.longestGame===null||s>y.longestGame)&&(y.longestGame=s),y.lastGameDuration=s,_?(y.currentStreak>=0?y.currentStreak++:y.currentStreak=1,y.currentStreak>y.longestWinStreak&&(y.longestWinStreak=y.currentStreak)):(y.currentStreak<=0?y.currentStreak--:y.currentStreak=-1,Math.abs(y.currentStreak)>y.longestLoseStreak&&(y.longestLoseStreak=Math.abs(y.currentStreak))),r.forEach(E=>{m[E]?m[E]={...m[E]}:m[E]={timesUsed:0,wins:0,losses:0},m[E].timesUsed++,_?m[E].wins++:m[E].losses++}),g[c].played++,_?g[c].wins++:g[c].losses++,d?x.gamesWithControl++:x.gamesWithoutControl++;const k={cardsPlayed:{...t.actions.detailedStats.cardsPlayed},cardsDrawn:{...t.actions.detailedStats.cardsDrawn},discards:{...t.actions.detailedStats.discards},deletes:{...t.actions.detailedStats.deletes},flips:{...t.actions.detailedStats.flips},shifts:{...t.actions.detailedStats.shifts},returns:{...t.actions.detailedStats.returns},compiles:{...t.actions.detailedStats.compiles},refreshes:{...t.actions.detailedStats.refreshes}};return u&&(C.totalCardsPlayed+=u.cardsPlayed,C.totalCardsDrawn+=u.cardsDrawn,C.totalDiscards+=u.cardsDiscarded,C.totalDeletes+=u.cardsDeleted,C.totalFlips+=u.cardsFlipped,C.totalShifts+=u.cardsShifted,C.totalRefreshes+=u.handsRefreshed,C.totalReturns+=u.cardsReturned||0,k.cardsPlayed.total+=u.cardsPlayed,k.cardsPlayed.player+=u.cardsPlayed,k.cardsDrawn.total+=u.cardsDrawn,k.cardsDrawn.player+=u.cardsDrawn,k.discards.total+=u.cardsDiscarded,k.discards.player+=u.cardsDiscarded,k.deletes.total+=u.cardsDeleted,k.deletes.player+=u.cardsDeleted,k.flips.total+=u.cardsFlipped,k.flips.player+=u.cardsFlipped,k.shifts.total+=u.cardsShifted,k.shifts.player+=u.cardsShifted,k.returns.total+=u.cardsReturned||0,k.returns.player+=u.cardsReturned||0,k.refreshes.total+=u.handsRefreshed,k.refreshes.player+=u.handsRefreshed),f&&(C.totalCardsPlayed+=f.cardsPlayed,C.totalCardsDrawn+=f.cardsDrawn,C.totalDiscards+=f.cardsDiscarded,C.totalDeletes+=f.cardsDeleted,C.totalFlips+=f.cardsFlipped,C.totalShifts+=f.cardsShifted,C.totalRefreshes+=f.handsRefreshed,C.totalReturns+=f.cardsReturned||0,k.cardsPlayed.total+=f.cardsPlayed,k.cardsPlayed.ai+=f.cardsPlayed,k.cardsDrawn.total+=f.cardsDrawn,k.cardsDrawn.ai+=f.cardsDrawn,k.discards.total+=f.cardsDiscarded,k.discards.ai+=f.cardsDiscarded,k.deletes.total+=f.cardsDeleted,k.deletes.ai+=f.cardsDeleted,k.flips.total+=f.cardsFlipped,k.flips.ai+=f.cardsFlipped,k.shifts.total+=f.cardsShifted,k.shifts.ai+=f.cardsShifted,k.returns.total+=f.cardsReturned||0,k.returns.ai+=f.cardsReturned||0,k.refreshes.total+=f.handsRefreshed,k.refreshes.ai+=f.handsRefreshed),h&&(h.cardsPlayed&&(k.cardsPlayed.playerFromHand+=h.cardsPlayed.playerFromHand,k.cardsPlayed.playerFromEffect+=h.cardsPlayed.playerFromEffect,k.cardsPlayed.aiFromHand+=h.cardsPlayed.aiFromHand,k.cardsPlayed.aiFromEffect+=h.cardsPlayed.aiFromEffect,k.cardsPlayed.playerFaceUp+=h.cardsPlayed.playerFaceUp,k.cardsPlayed.playerFaceDown+=h.cardsPlayed.playerFaceDown,k.cardsPlayed.aiFaceUp+=h.cardsPlayed.aiFaceUp,k.cardsPlayed.aiFaceDown+=h.cardsPlayed.aiFaceDown),h.cardsDrawn&&(k.cardsDrawn.playerFromRefresh+=h.cardsDrawn.playerFromRefresh,k.cardsDrawn.playerFromEffect+=h.cardsDrawn.playerFromEffect,k.cardsDrawn.aiFromRefresh+=h.cardsDrawn.aiFromRefresh,k.cardsDrawn.aiFromEffect+=h.cardsDrawn.aiFromEffect),h.compiles&&(k.compiles.playerFirstCompile+=h.compiles.playerFirstCompile,k.compiles.playerRecompile+=h.compiles.playerRecompile,k.compiles.aiFirstCompile+=h.compiles.aiFirstCompile,k.compiles.aiRecompile+=h.compiles.aiRecompile,k.compiles.player+=h.compiles.playerFirstCompile+h.compiles.playerRecompile,k.compiles.ai+=h.compiles.aiFirstCompile+h.compiles.aiRecompile,k.compiles.total+=h.compiles.playerFirstCompile+h.compiles.playerRecompile+h.compiles.aiFirstCompile+h.compiles.aiRecompile),h.refreshes&&(k.refreshes.playerCardsDrawn+=h.refreshes.playerCardsDrawn,k.refreshes.aiCardsDrawn+=h.refreshes.aiCardsDrawn)),p!==void 0&&(C.totalCompiles+=p),C.detailedStats=k,{version:t.version,global:y,protocols:m,aiDifficulty:g,cards:j,actions:C,control:x,coinFlip:b}}function ij(t,n){const r={...t,cards:{...t.cards,played:{...t.cards.played}}};return r.cards.played[n]||(r.cards.played[n]=0),r.cards.played[n]++,r}function dj(t,n){const r={...t,cards:{...t.cards,deleted:{...t.cards.deleted}}};return r.cards.deleted[n]||(r.cards.deleted[n]=0),r.cards.deleted[n]++,r}function uj(t,n){const r={...t,control:{...t.control}};return n==="player"?r.control.playerRearranges++:r.control.aiRearranges++,r.control.totalRearranges++,r}function pj(t,n,r){const c={...t,coinFlip:{...t.coinFlip}};return n==="heads"?(c.coinFlip.headsChosen++,r&&c.coinFlip.headsWon++):(c.coinFlip.tailsChosen++,r&&c.coinFlip.tailsWon++),c}function fj(t){return t.global.totalGamesPlayed===0?0:t.global.totalGamesWon/t.global.totalGamesPlayed*100}function hj(t){return t.global.totalGamesPlayed===0?0:Math.floor(t.global.totalPlaytime/t.global.totalGamesPlayed)}function mj(t){return Object.entries(t.protocols).map(([r,c])=>({protocol:r,timesUsed:c.timesUsed,winRate:c.timesUsed>0?c.wins/c.timesUsed*100:0})).sort((r,c)=>c.timesUsed-r.timesUsed).slice(0,5)}function yj(t){return Object.entries(t.protocols).filter(([r,c])=>c.timesUsed>=3).map(([r,c])=>({protocol:r,timesUsed:c.timesUsed,winRate:c.wins/c.timesUsed*100})).sort((r,c)=>c.winRate-r.winRate).slice(0,5)}function gj(t){return Object.entries(t.protocols).map(([r,c])=>({protocol:r,timesUsed:c.timesUsed,winRate:c.timesUsed>0?c.wins/c.timesUsed*100:0})).sort((r,c)=>r.timesUsed-c.timesUsed).slice(0,5)}function vj(t){return Object.entries(t.cards.played).map(([r,c])=>({card:r,count:c})).sort((r,c)=>c.count-r.count).slice(0,5)}function _j(t){return Object.entries(t.cards.deleted).map(([r,c])=>({card:r,count:c})).sort((r,c)=>c.count-r.count).slice(0,5)}function as(t){const n=Math.floor(t/3600),r=Math.floor(t%3600/60),c=t%60;return n>0?`${n}h ${r}m`:r>0?`${r}m ${c}s`:`${c}s`}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function wj(t,n,r){const[c,s]=ce.useState(()=>su()),d=ce.useRef(null),u=ce.useCallback(()=>{d.current=Date.now()},[]),p=ce.useCallback((m,g)=>{s(x=>{const C=`${m}-${g}`,b=ij(x,C);return ol(b),b})},[]),f=ce.useCallback((m,g)=>{s(x=>{const C=`${m}-${g}`,b=dj(x,C);return ol(b),b})},[]),h=ce.useCallback((m,g)=>{s(x=>{const C=pj(x,m,g);return ol(C),C})},[]),_=ce.useCallback(m=>{s(g=>{const x=uj(g,m);return ol(x),x})},[]),y=ce.useCallback((m,g,x,C,b)=>{if(d.current===null)return;const j=Math.floor((Date.now()-d.current)/1e3);s(k=>{const E=cj(k,m,t,n,j,r,g,x,C,b);return ol(E),E}),d.current=null},[t,n,r]);return{statistics:c,startGame:u,endGame:y,trackPlayerCardPlayed:p,trackPlayerCardDeleted:f,trackPlayerCoinFlip:h,trackPlayerRearrange:_}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function w(t,n,r=!0){const s=Xo().find(d=>d.protocol===t&&d.value===n);return s?{id:ct(),protocol:s.protocol,value:s.value,top:s.top,middle:s.middle,bottom:s.bottom,keywords:s.keywords,isFaceUp:r,isRevealed:!1,category:s.category||"Main",...s.customEffects&&{customEffects:s.customEffects}}:(console.warn(`Card not found: ${t}-${n}`),{id:ct(),protocol:t,value:n,top:"",middle:"",bottom:"",keywords:{},isFaceUp:r,isRevealed:!1,category:"Main"})}function O(t,n,r,c){const s={...t},d={...s[n]},u=[...d.lanes];return u[r]=[...u[r],c],d.lanes=u,s[n]=d,s}function on(t,n){const r=[],c=Xo();for(const s of t){const d=c.filter(u=>u.protocol===s);for(const u of d)n.some(f=>f.protocol===u.protocol&&f.value===u.value)||r.push(w(u.protocol,u.value,!0))}return r}function $e(t,n,r,c,s){return{...t,player:{...t.player,protocols:n,lanes:[[],[],[]],hand:[]},opponent:{...t.opponent,protocols:r,lanes:[[],[],[]],hand:[]},turn:c,phase:s,actionRequired:null,queuedActions:[],_interruptedTurn:void 0,_interruptedPhase:void 0,processedStartEffectIds:[],processedEndEffectIds:[],processedUncoverEventIds:[]}}function Ie(t){const n=[...t.player.hand,...t.player.lanes.flat()],r=[...t.opponent.hand,...t.opponent.lanes.flat()],c=on(t.player.protocols,n),s=on(t.opponent.protocols,r),d=t.turn==="player"?"Player":"Opponent",u=[{player:"player",message:`Player protocols: ${t.player.protocols.join(", ")}`},{player:"opponent",message:`Opponent protocols: ${t.opponent.protocols.join(", ")}`},{player:t.turn,message:`${d} goes first.`},{player:"player",message:"---"},{player:t.turn,message:`[Test Scenario] Phase: ${t.phase}`}];return{...t,player:{...t.player,deck:c,discard:[],compiled:[!1,!1,!1]},opponent:{...t.opponent,deck:s,discard:[],compiled:[!1,!1,!1]},log:u}}const zy={name:"Psychic-3 Uncover whrend Opponent's Turn",description:"Player lscht Opponent's face-down card  Psychic-3 uncovered  Player discardet, Opponent shiftet",setup:t=>{let n=$e(t,["Hate","Fire","Water"],["Psychic","Death","Spirit"],"player","action");return n.player.hand=[w("Hate",0,!0),w("Fire",1,!0),w("Water",1,!0)],n=O(n,"opponent",1,w("Psychic",3,!0)),n=O(n,"opponent",1,w("Fire",1,!1)),n=Re(n),Ie(n)}},By={name:"Psychic-4 End Effect mit Uncover-Interrupt",description:"Psychic-4 returnt Fire-2  Fire-4 uncovered  Interrupt  Psychic-4 flip aus Queue",setup:t=>{let n=$e(t,["Fire","Water","Spirit"],["Psychic","Death","Metal"],"opponent","end");return n=O(n,"opponent",0,w("Psychic",4,!0)),n=O(n,"player",1,w("Fire",4,!0)),n=O(n,"player",1,w("Fire",2,!0)),n.opponent.hand=[w("Water",1),w("Water",2)],n=Re(n),Ie(n)}},Gy={name:"Spirit-3 Draw whrend End Phase",description:"Spirit-3 draw in End Phase  Shift-prompt in Queue  Player kann lanes klicken",setup:t=>{let n=$e(t,["Spirit","Fire","Water"],["Death","Metal","Psychic"],"player","action");n=O(n,"player",0,w("Spirit",3,!0));const r=Xo(),c=r.find(u=>u.protocol==="Fire"&&u.value===1),s=r.find(u=>u.protocol==="Water"&&u.value===1),d=r.find(u=>u.protocol==="Spirit"&&u.value===1);return n.player.deck=[c,s,d],n=Re(n),Ie(n)}},Yy={name:"Plague-2 Actor Propagation",description:"Player spielt Plague-2  Player discardet  Opponent discardet (actor korrekt)",setup:t=>{let n=$e(t,["Plague","Death","Hate"],["Fire","Water","Spirit"],"player","action");return n.player.hand=[w("Plague",2,!0),w("Fire",1),w("Water",1),w("Spirit",1)],n.opponent.hand=[w("Fire",2),w("Water",2),w("Spirit",2),w("Death",2)],n=Re(n),Ie(n)}},Wy={name:"Darkness-1 Flip + Shift mit Interrupt",description:"Darkness-1 flippt Fire-0  Delete-Interrupt  Player shiftet",setup:t=>{let n=$e(t,["Darkness","Fire","Water"],["Spirit","Death","Metal"],"player","action");return n.player.hand=[w("Darkness",1,!0)],n=O(n,"opponent",0,w("Fire",0,!1)),n=Re(n),Ie(n)}},Qy={name:"Plague-4 Owner vs Turn Check",description:"Plague-4 End  Player deletet  Opponent (owner) wird fr flip gefragt",setup:t=>{let n=$e(t,["Fire","Water","Spirit"],["Plague","Death","Metal"],"opponent","end");return n=O(n,"opponent",0,w("Plague",4,!0)),n=O(n,"player",1,w("Water",2,!1)),n=Re(n),Ie(n)}},Xy={name:"Water Owner vs Turn Check",description:"Plague-4 End  Player deletet  Opponent (owner) wird fr flip gefragt",setup:t=>{let n=$e(t,["Fire","Water","Spirit"],["Plague","Death","Metal"],"player","action");return n=O(n,"opponent",0,w("Plague",4,!0)),n=O(n,"player",2,w("Water",4,!1)),n.player.hand=[w("Water",0,!0),w("Fire",1),w("Water",1),w("Spirit",1)],n.opponent.hand=[w("Fire",2),w("Water",2),w("Spirit",2),w("Death",2)],n=Re(n),Ie(n)}},Zy={name:"Hate-1 Multi-Delete mit Uncover-Interrupt",description:"Hate-1 lscht Plague-0  Plague-5 uncovered  Interrupt  Player macht 2. Delete",setup:t=>{let n=$e(t,["Fire","Hate","Water"],["Plague","Death","Metal"],"player","action");return n.player.hand=[w("Hate",1,!0),w("Psychic",2,!0),w("Psychic",4,!0),w("Hate",4,!0),w("Water",1,!0)],n=O(n,"opponent",0,w("Plague",2,!0)),n=O(n,"opponent",0,w("Plague",0,!0)),n=O(n,"player",0,w("War",3,!0)),n.opponent.hand=[w("Fire",2,!0),w("Water",2,!0),w("Spirit",2,!0),w("Death",2,!0),w("Metal",2,!0)],n=Re(n),Ie(n)}},Ky={name:"Darkness-1  Hate-0 Flip  Multi-Effect Chain",description:" Darkness-1 flippt Hate-0  Delete-Interrupt  Draw-Interrupt  Shift aus Queue",setup:t=>{let n=$e(t,["Darkness","Fire","Water"],["Hate","Death","Metal"],"player","action");n.player.hand=[w("Darkness",1,!0)],n=O(n,"opponent",0,w("Hate",0,!1)),n=O(n,"opponent",1,w("Hate",3,!0)),n=O(n,"opponent",2,w("Fire",1,!1)),n=O(n,"player",1,w("Water",2,!0)),n.opponent.hand=[w("Death",2),w("Metal",3)];const c=Xo().find(s=>s.protocol==="Death"&&s.value===1);return n.opponent.deck=[c],n=Re(n),Ie(n)}},Jy={name:"Water-4 Return  Turn End",description:" Water-4 returnt Karte  Turn endet (Bug-Fix: Opponent spielt nicht zweimal)",setup:t=>{let n=$e(t,["Hate","Spirit","Light"],["Fire","Water","Death"],"opponent","action");return n.opponent.hand=[w("Water",4,!0)],n=O(n,"opponent",0,w("Life",4,!0)),n=O(n,"opponent",2,w("Death",4,!1)),n=O(n,"player",1,w("Spirit",1,!0)),n=O(n,"player",2,w("Light",5,!1)),n.player.hand=[w("Fire",1),w("Spirit",2),w("Hate",4)],n=Re(n),Ie(n)}},eg={name:"Psychic-3 Discard + Shift",description:" Psychic-3 On-Play  Player discardet  AI shiftet (Bug-Fix: AI kann shiften)",setup:t=>{let n=$e(t,["Fire","Water","Spirit"],["Psychic","Death","Metal"],"opponent","action");return n.opponent.hand=[w("Psychic",3,!0)],n.player.hand=[w("Fire",1),w("Water",2),w("Spirit",1)],n=O(n,"player",0,w("Fire",2,!0)),n=O(n,"player",1,w("Water",3,!0)),n=O(n,"player",2,w("Spirit",4,!0)),n=Re(n),Ie(n)}},tg={name:"Death-1 Delete  Speed-3 Uncover",description:" Death-1 lscht Light-0  Speed-3 uncovered  Player shiftet (Bug-Fix Test)",setup:t=>{let n=$e(t,["Speed","Light","Water"],["Death","Fire","Metal"],"opponent","start");return n=O(n,"player",0,w("Speed",3,!0)),n=O(n,"player",0,w("Light",0,!0)),n=O(n,"player",1,w("Water",1,!0)),n=O(n,"opponent",0,w("Death",1,!0)),n.player.hand=[],n.opponent.hand=[],n=Re(n),Ie(n)}},ng={name:"Gravity-2 Flip  Metal-5 Discard  Shift",description:" Gravity-2 flippt Metal-5  Discard Interrupt  shiften (Bug-Fix: AI stuck)",setup:t=>{let n=$e(t,["Fire","Water","Light"],["Gravity","Metal","Fire"],"opponent","action");return n.opponent.hand=[w("Gravity",2,!0),w("Fire",1)],n=O(n,"opponent",1,w("Metal",5,!1)),n=O(n,"player",0,w("Fire",2,!0)),n=O(n,"player",2,w("Light",3,!0)),n.player.hand=[w("Water",1),w("Fire",3)],n=Re(n),Ie(n)}},ag={name:"Hate-2 Player spielt (Einfach)",description:" Player spielt Hate-2  Whlt eigene & Gegners hchste Karte",setup:t=>{let n=$e(t,["Hate","Water","Light"],["Metal","Death","Gravity"],"player","action");return n.player.hand=[w("Hate",2,!0)],n=O(n,"player",0,w("Fire",4,!0)),n=O(n,"player",1,w("Water",2,!0)),n=O(n,"player",2,w("Light",5,!0)),n=O(n,"opponent",0,w("Metal",3,!0)),n=O(n,"opponent",1,w("Death",5,!0)),n=O(n,"opponent",2,w("Gravity",2,!1)),n=Re(n),Ie(n)}},og={name:"Hate-2 AI spielt (Normal)",description:" AI spielt Hate-2  AI whlt eigene & Players hchste automatisch",setup:t=>{let n=$e(t,["Water","Spirit","Light"],["Hate","Metal","Death"],"opponent","action");return n.opponent.hand=[w("Hate",2,!0)],n=O(n,"opponent",0,w("Fire",5,!0)),n=O(n,"opponent",1,w("Metal",3,!0)),n=O(n,"opponent",2,w("Death",2,!1)),n=O(n,"player",0,w("Water",4,!0)),n=O(n,"player",1,w("Spirit",5,!0)),n=O(n,"player",2,w("Light",2,!0)),n=Re(n),Ie(n)}},rg={name:"Hate-2 AI spielt (Normal) mit Auswahl",description:" AI spielt Hate-2  AI whlt eigene & Players hchste automatisch",setup:t=>{let n=$e(t,["Water","Spirit","Light"],["Hate","Metal","Death"],"opponent","action");return n.opponent.hand=[w("Hate",2,!0)],n=O(n,"opponent",0,w("Fire",5,!0)),n=O(n,"opponent",1,w("Metal",3,!0)),n=O(n,"opponent",2,w("Death",2,!1)),n=O(n,"player",0,w("Water",4,!0)),n=O(n,"player",1,w("Spirit",5,!0)),n=O(n,"player",2,w("Light",5,!0)),n=Re(n),Ie(n)}},lg={name:"Hate-2 Selbst-Lschung",description:" Hate-2 lscht sich selbst  Zweite Klausel entfllt (Regelwerk-Check)",setup:t=>{let n=$e(t,["Hate","Fire","Water"],["Metal","Death","Gravity"],"player","action");return n.player.hand=[w("Hate",2,!0)],n=O(n,"player",1,w("Fire",1,!0)),n=O(n,"player",2,w("Water",0,!0)),n=O(n,"opponent",0,w("Metal",3,!0)),n=O(n,"opponent",1,w("Death",5,!0)),n=Re(n),Ie(n)}},sg={name:"Hate-2 Gleichstand (Auswahl)",description:" Hate-2 mit mehreren hchsten  Player muss whlen (Tied values)",setup:t=>{let n=$e(t,["Hate","Water","Spirit"],["Metal","Death","Gravity"],"player","action");return n.player.hand=[w("Hate",2,!0)],n=O(n,"player",0,w("Fire",4,!0)),n=O(n,"player",1,w("Water",4,!0)),n=O(n,"player",2,w("Spirit",4,!0)),n=O(n,"opponent",0,w("Metal",5,!0)),n=O(n,"opponent",1,w("Death",5,!0)),n=O(n,"opponent",2,w("Gravity",2,!1)),n=Re(n),Ie(n)}},cg={name:"Hate-2 Face-Down Karten",description:" Hate-2 mit face-down  Alle face-down sind value 2 (Tied mit Hate-2)",setup:t=>{let n=$e(t,["Hate","Fire","Water"],["Metal","Death","Gravity"],"player","action");return n.player.hand=[w("Hate",2,!0)],n=O(n,"player",1,w("Fire",5,!1)),n=O(n,"player",2,w("Water",5,!1)),n=O(n,"opponent",0,w("Metal",5,!0)),n=O(n,"opponent",1,w("Death",4,!1)),n=O(n,"opponent",2,w("Gravity",1,!0)),n=Re(n),Ie(n)}},ig={name:"Hate-2 AI Play-Validation",description:" AI spielt Hate-2 NICHT face-up wenn es sich selbst lschen wrde",setup:t=>{let n=$e(t,["Fire","Water","Spirit"],["Hate","Death","Metal"],"opponent","action");return n.opponent.hand=[w("Hate",2,!0)],n=O(n,"opponent",1,w("Fire",0,!0)),n=O(n,"opponent",2,w("Water",1,!0)),n=O(n,"player",0,w("Fire",5,!0)),n=O(n,"player",1,w("Water",4,!0)),n=Re(n),Ie(n)}},dg={name:"Hate-2 AI spielt OFFEN (Optimal)",description:" AI spielt Hate-2 offen weil nicht hchste Karte",setup:t=>{let n=$e(t,["Water","Spirit","Light"],["Hate","Metal","Death"],"opponent","action");return n.opponent.hand=[w("Hate",2,!0)],n=O(n,"opponent",0,w("Fire",5,!0)),n=O(n,"opponent",1,w("Metal",4,!0)),n=O(n,"opponent",2,w("Death",3,!0)),n=O(n,"player",0,w("Water",2,!0)),n=O(n,"player",1,w("Spirit",5,!0)),n=O(n,"player",2,w("Light",1,!0)),n=Re(n),Ie(n)}},xj={name:"Chaos-3 Protocol-Free Playing",description:"Player with Chaos-3 can play any card face-up in any lane",setup:t=>{let n=$e(t,["Chaos","Fire","Water"],["Spirit","Death","Metal"],"player","action");return n=O(n,"player",0,w("Chaos",3,!0)),n.player.hand=[w("Gravity",2,!0),w("Hate",3,!0),w("Love",1,!0)],n=Re(n),Ie(n)}},Cj={name:"Frost-3 Blocks Shifts (Covered)",description:"Frost-3 should prevent shifts even when covered (Top-Box effect always active)",setup:t=>{let n=$e(t,["Gravity","Water","Fire"],["Frost","Metal","Death"],"player","action");return n=O(n,"opponent",0,w("Frost",3,!0)),n=O(n,"opponent",0,w("Metal",2,!1)),n=O(n,"player",1,w("Water",2,!0)),n.player.hand=[w("Gravity",1,!0),w("Fire",2,!0)],n=Re(n),Ie(n)}},Sj={name:"Water-0 Softlock Bug Fix",description:"Water-0 self-flip should be cancelled when card becomes covered before self-flip executes",setup:t=>{let n=$e(t,["Water","Darkness","Light"],["Apathy","Fire","Death"],"player","action");return n=O(n,"player",1,w("Darkness",3,!1)),n.player.hand=[w("Water",0,!0),w("Darkness",2,!0),w("Fire",1,!0)],n=Re(n),Ie(n)}},bj={name:"Darkness-1 Flip and Shift Chain",description:"Darkness-1 should flip opponent card, then allow shifting that same card",setup:t=>{let n=$e(t,["Darkness","Water","Fire"],["Metal","Fire","Death"],"player","action");return n=O(n,"opponent",0,w("Metal",2,!1)),n=O(n,"opponent",1,w("Fire",1,!0)),n=O(n,"opponent",2,w("Hate",0,!1)),n.player.hand=[w("Darkness",1,!0),w("Water",2,!0),w("Fire",3,!0)],n=Re(n),Ie(n)}},Ej={name:"Darkness-1 Flips Speed-3 - Middle Effect Execution",description:"When Darkness-1 flips Speed-3, Speed-3's middle effect (shift) should execute before Darkness-1's shift",setup:t=>{let n=$e(t,["Darkness","Water","Fire"],["Speed","Fire","Metal"],"player","action");return n=O(n,"opponent",0,w("Speed",3,!1)),n=O(n,"opponent",1,w("Fire",1,!0)),n=O(n,"opponent",2,w("Metal",2,!0)),n.player.hand=[w("Darkness",1,!0),w("Water",2,!0),w("Fire",3,!0)],n=Re(n),Ie(n)}},jj={name:"Darkness-1 Flips Speed-3 - Middle Effect Execution",description:"When Darkness-1 flips Speed-3, Speed-3's middle effect (shift) should execute before Darkness-1's shift",setup:t=>{let n=$e(t,["Darkness","Water","Fire"],["Speed","Fire","Metal"],"player","action");return n=O(n,"opponent",0,w("Speed",3,!1)),n=O(n,"opponent",1,w("Fire",1,!0)),n=O(n,"opponent",2,w("Metal",2,!0)),n.player.hand=[w("Darkness",1,!0),w("Water",2,!0),w("Fire",3,!0)],n=Re(n),Ie(n)}},ug={name:"Fire-1 & Fire-2 Conditional Test",description:" Fire-1 (discard -> delete) & Fire-2 (discard -> return) if_executed logic",setup:t=>{let n=$e(t,["Fire","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[w("Fire",1,!0),w("Fire",2,!0),w("Fire",0,!0),w("Fire",3,!0),w("Fire",4,!0),w("Fire",5,!0)],n=O(n,"opponent",0,w("Metal",3,!0)),n=O(n,"opponent",1,w("Death",4,!0)),n=O(n,"opponent",2,w("Fire",2,!0)),n=O(n,"opponent",0,w("Metal",1,!0)),n=O(n,"player",2,w("Spirit",3,!0)),n=O(n,"player",1,w("Water",3,!0)),n=O(n,"player",2,w("Spirit",2,!0)),n=Re(n),Ie(n)}},pg={name:"Anarchy Test Playground",description:" All Anarchy cards on hand for testing",setup:t=>{let n=$e(t,["Anarchy","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[w("Anarchy",0,!0),w("Anarchy",1,!0),w("Anarchy",2,!0),w("Anarchy",3,!0),w("Anarchy",5,!0),w("Anarchy",6,!0)],n=O(n,"opponent",0,w("Metal",3,!0)),n=O(n,"opponent",1,w("Death",4,!1)),n=O(n,"opponent",2,w("Fire",2,!0)),n=O(n,"opponent",0,w("Metal",1,!0)),n=O(n,"player",2,w("Spirit",3,!0)),n=O(n,"player",1,w("Water",3,!0)),n=O(n,"player",2,w("Spirit",2,!0)),n=Re(n),Ie(n)}},fg={name:"Darkness Test Playground",description:" All Darkness cards on hand for testing",setup:t=>{let n=$e(t,["Darkness","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[w("Darkness",0,!0),w("Darkness",1,!0),w("Darkness",2,!0),w("Darkness",3,!0),w("Darkness",4,!0),w("Darkness",5,!0)],n=O(n,"opponent",0,w("Metal",3,!1)),n=O(n,"opponent",1,w("Death",4,!0)),n=O(n,"opponent",2,w("Fire",2,!1)),n=O(n,"opponent",0,w("Metal",1,!0)),n=O(n,"opponent",1,w("Death",2,!1)),n=O(n,"player",2,w("Spirit",3,!0)),n=O(n,"player",1,w("Water",3,!0)),n=O(n,"player",2,w("Spirit",2,!0)),n=Re(n),Ie(n)}},hg={name:"Apathy Test Playground",description:" All Apathy cards on hand for testing",setup:t=>{let n=$e(t,["Apathy","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[w("Apathy",0,!0),w("Apathy",1,!0),w("Apathy",2,!0),w("Apathy",3,!0),w("Apathy",4,!0),w("Apathy",5,!0)],n=O(n,"opponent",0,w("Metal",3,!0)),n=O(n,"opponent",1,w("Death",4,!0)),n=O(n,"opponent",2,w("Fire",2,!0)),n=O(n,"opponent",0,w("Metal",1,!0)),n=O(n,"opponent",2,w("Fire",1,!1)),n=O(n,"player",2,w("Spirit",3,!0)),n=O(n,"player",1,w("Water",3,!0)),n=O(n,"player",2,w("Spirit",2,!0)),n=Re(n),Ie(n)}},mg={name:"Death Test Playground",description:" All Death cards on hand for testing",setup:t=>{let n=$e(t,["Death","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[w("Death",0,!0),w("Death",1,!0),w("Death",2,!0),w("Death",3,!0),w("Death",4,!0),w("Death",5,!0)],n=O(n,"opponent",0,w("Metal",0,!0)),n=O(n,"opponent",1,w("Death",1,!0)),n=O(n,"opponent",2,w("Fire",3,!0)),n=O(n,"opponent",0,w("Metal",2,!0)),n=O(n,"opponent",1,w("Death",4,!1)),n=O(n,"player",2,w("Spirit",3,!0)),n=O(n,"player",1,w("Water",3,!0)),n=O(n,"player",2,w("Spirit",2,!0)),n=Re(n),Ie(n)}},yg={name:"Water Test Playground",description:" All Water cards on hand for testing - wash away and renew",setup:t=>{let n=$e(t,["Water","Fire","Spirit"],["Metal","Death","Light"],"player","action");return n.player.hand=[w("Water",0,!0),w("Water",1,!0),w("Water",2,!0),w("Water",3,!0),w("Water",4,!0),w("Water",5,!0)],n=O(n,"opponent",0,w("Metal",2,!0)),n=O(n,"opponent",1,w("Death",3,!0)),n=O(n,"opponent",2,w("Light",2,!0)),n=O(n,"opponent",0,w("Metal",4,!0)),n=O(n,"opponent",1,w("Death",2,!1)),n=O(n,"opponent",2,w("Light",5,!1)),n=O(n,"player",1,w("Fire",2,!0)),n=O(n,"player",2,w("Spirit",3,!0)),n=O(n,"player",1,w("Fire",4,!0)),n=O(n,"player",2,w("Spirit",5,!1)),n=Re(n),Ie(n)}},gg={name:"Spirit Test Playground",description:" All Spirit cards on hand - true strength from within",setup:t=>{let n=$e(t,["Spirit","Fire","Water"],["Metal","Death","Light"],"player","action");return n.player.hand=[w("Spirit",0,!0),w("Spirit",1,!0),w("Spirit",2,!0),w("Spirit",3,!0),w("Spirit",4,!0),w("Spirit",5,!0)],n=O(n,"opponent",0,w("Metal",3,!0)),n=O(n,"opponent",1,w("Death",2,!1)),n=O(n,"opponent",2,w("Light",4,!0)),n=O(n,"opponent",0,w("Metal",5,!1)),n=O(n,"opponent",2,w("Light",3,!0)),n=O(n,"player",1,w("Fire",2,!0)),n=O(n,"player",2,w("Water",4,!0)),n=O(n,"player",1,w("Fire",3,!1)),n=Re(n),Ie(n)}},vg={name:"Chaos Test Playground",description:" All Chaos cards on hand - embrace the unpredictable",setup:t=>{let n=$e(t,["Chaos","Fire","Water"],["Metal","Death","Light"],"player","action");return n.player.hand=[w("Chaos",0,!0),w("Chaos",1,!0),w("Chaos",2,!0),w("Chaos",3,!0),w("Chaos",4,!0),w("Chaos",5,!0)],n=O(n,"opponent",0,w("Metal",2,!0)),n=O(n,"opponent",0,w("Metal",4,!0)),n=O(n,"opponent",1,w("Death",3,!1)),n=O(n,"opponent",1,w("Death",5,!0)),n=O(n,"opponent",2,w("Light",1,!0)),n=O(n,"opponent",2,w("Light",3,!1)),n=O(n,"player",0,w("Fire",2,!0)),n=O(n,"player",0,w("Fire",4,!0)),n=O(n,"player",1,w("Water",3,!1)),n=O(n,"player",1,w("Water",5,!0)),n=O(n,"player",2,w("Fire",1,!0)),n=Re(n),Ie(n)}},_g={name:"Gravity Test Playground",description:" All Gravity cards on hand - pull everything together",setup:t=>{let n=$e(t,["Fire","Gravity","Water"],["Metal","Death","Light"],"player","action");return n.player.hand=[w("Gravity",0,!0),w("Gravity",1,!0),w("Gravity",2,!0),w("Gravity",4,!0),w("Gravity",5,!0),w("Gravity",6,!0)],n=O(n,"player",0,w("Fire",1,!0)),n=O(n,"player",2,w("Water",2,!1)),n=O(n,"opponent",0,w("Metal",3,!1)),n=O(n,"opponent",0,w("Metal",4,!0)),n=O(n,"opponent",1,w("Death",2,!1)),n=O(n,"opponent",1,w("Death",3,!0)),n=O(n,"opponent",2,w("Light",4,!1)),n.opponent.deck=[w("Metal",5,!0),w("Death",4,!0),w("Light",5,!0)],n=Re(n),Ie(n)}},wg={name:"Frost Test Playground",description:" All Frost cards on hand - pull everything together",setup:t=>{let n=$e(t,["Fire","Frost","Water"],["Metal","Death","Light"],"player","action");return n.player.hand=[w("Frost",0,!0),w("Frost",1,!0),w("Frost",2,!0),w("Frost",3,!0),w("Frost",4,!0),w("Frost",5,!0)],n=O(n,"player",0,w("Fire",1,!0)),n=O(n,"player",2,w("Water",2,!1)),n=O(n,"opponent",0,w("Metal",3,!1)),n=O(n,"opponent",0,w("Metal",4,!0)),n=O(n,"opponent",1,w("Death",2,!1)),n=O(n,"opponent",1,w("Death",3,!0)),n=O(n,"opponent",2,w("Light",4,!1)),n.opponent.deck=[w("Metal",5,!0),w("Death",4,!0),w("Light",5,!0)],n=Re(n),Ie(n)}},xg={name:"Hate Test Playground",description:" All Hate cards on hand - test deletion mechanics",setup:t=>{let n=$e(t,["Hate","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[w("Hate",0,!0),w("Hate",1,!0),w("Hate",2,!0),w("Hate",3,!0),w("Hate",4,!0),w("Hate",5,!0)],n=O(n,"player",1,w("Water",1,!0)),n=O(n,"player",1,w("Water",2,!0)),n=O(n,"player",1,w("Water",3,!0)),n=O(n,"player",2,w("Spirit",2,!0)),n=O(n,"player",2,w("Spirit",4,!1)),n=O(n,"opponent",0,w("Metal",5,!0)),n=O(n,"opponent",1,w("Death",2,!0)),n=O(n,"opponent",1,w("Death",4,!0)),n=O(n,"opponent",2,w("Fire",3,!1)),n.player.deck=[w("Water",0,!0),w("Water",4,!0),w("Spirit",0,!0),w("Spirit",5,!0)],n.opponent.deck=[w("Metal",3,!0),w("Death",5,!0),w("Fire",1,!0)],n=Re(n),Ie(n)}},Cg={name:"Life Test Playground",description:" All Life cards on hand - test play and flip mechanics",setup:t=>{let n=$e(t,["Life","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[w("Life",0,!0),w("Life",1,!0),w("Life",2,!0),w("Life",3,!0),w("Life",4,!0),w("Life",5,!0)],n=O(n,"player",1,w("Water",1,!0)),n=O(n,"player",1,w("Water",2,!0)),n=O(n,"player",1,w("Water",3,!0)),n=O(n,"player",2,w("Spirit",2,!0)),n=O(n,"player",2,w("Spirit",4,!1)),n=O(n,"opponent",0,w("Metal",3,!1)),n=O(n,"opponent",1,w("Death",2,!0)),n=O(n,"opponent",1,w("Death",4,!1)),n=O(n,"opponent",2,w("Fire",5,!1)),n.player.deck=[w("Water",0,!0),w("Water",3,!0),w("Water",4,!0),w("Spirit",0,!0),w("Spirit",1,!0),w("Spirit",2,!0),w("Spirit",3,!0),w("Spirit",4,!0)],n.opponent.deck=[w("Metal",1,!0),w("Death",3,!0),w("Fire",2,!0)],n=Re(n),Ie(n)}},Sg={name:"Light Test Playground",description:" All Light cards on hand - burn away the dark",setup:t=>{let n=$e(t,["Light","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[w("Light",0,!0),w("Light",1,!0),w("Light",2,!0),w("Light",3,!0),w("Light",4,!0),w("Light",5,!0)],n=O(n,"opponent",0,w("Fire",3,!1)),n=O(n,"opponent",1,w("Metal",4,!1)),n=O(n,"opponent",2,w("Death",5,!0)),n=O(n,"player",1,w("Water",2,!1)),n=O(n,"player",1,w("Water",3,!1)),n=O(n,"player",1,w("Water",4,!1)),n=O(n,"player",0,w("Spirit",1,!0)),n=O(n,"player",0,w("Spirit",2,!1)),n=O(n,"player",2,w("Spirit",5,!1)),n.player.deck=[w("Water",0,!0),w("Water",1,!0),w("Spirit",0,!0),w("Spirit",3,!0),w("Spirit",4,!0)],n.opponent.hand=[w("Metal",1,!0),w("Death",2,!0),w("Fire",3,!0),w("Metal",0,!0)],n=Re(n),Ie(n)}},bg={name:"Death-2 Uncover Interrupt - Turn Wechsel Test",description:"Death-2 lscht  Darkness-4 uncovered  Opponent shiftet  Turn muss zu Opponent wechseln",setup:t=>{let n=$e(t,["Death","Fire","Hate"],["Water","Darkness","Spirit"],"player","action");return n.player.hand=[w("Death",2,!0),w("Fire",1,!0),w("Hate",1,!0)],n=O(n,"player",0,w("Fire",0,!1)),n=O(n,"opponent",1,w("Darkness",4,!0)),n=O(n,"opponent",1,w("Darkness",1,!0)),n=O(n,"opponent",0,w("Water",0,!1)),n.opponent.hand=[w("Water",1,!0),w("Spirit",1,!0)],n=Re(n),Ie(n)}},Eg={name:"Apathy-5 Uncover - darf nur einmal triggern",description:"Hate-0 lscht Apathy-0  Apathy-5 uncovered  darf nur 1x triggern",setup:t=>{let n=$e(t,["Hate","Fire","Death"],["Apathy","Darkness","Plague"],"player","action");return n.player.hand=[w("Hate",0,!0),w("Fire",2,!0),w("Death",2,!0)],n=O(n,"opponent",0,w("Apathy",5,!0)),n=O(n,"opponent",0,w("Apathy",4,!0)),n.opponent.hand=[w("Darkness",1,!0),w("Apathy",1,!0),w("Darkness",2,!0)],n=Re(n),Ie(n)}},jg={name:"Psychic-1 facedown flip darkness 2 test",description:"Psychic-1 facedown, darkness-2 flippt Karte nur noch facedown bug",setup:t=>{let n=$e(t,["Frost","Gravity","Plague"],["Psychic","Darkness","Speed"],"player","action");return n.player.hand=[w("Darkness",1,!0),w("Darkness",2,!0),w("Speed",3,!0)],n=O(n,"opponent",0,w("Frost",0,!1)),n=O(n,"opponent",1,w("Gravity",6,!1)),n=O(n,"player",0,w("Psychic",4,!1)),n=O(n,"player",1,w("Psychic",1,!1)),n.opponent.hand=[w("Gravity",1,!0)],n=Re(n),Ie(n)}},kg={name:"Speed Test Playground",description:" All Speed cards on hand - swift and adaptive",setup:t=>{let n=$e(t,["Speed","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[w("Speed",0,!0),w("Speed",1,!0),w("Speed",2,!0),w("Speed",3,!0),w("Speed",4,!0),w("Speed",5,!0)],n=O(n,"player",0,w("Water",2,!0)),n=O(n,"player",1,w("Spirit",3,!0)),n=O(n,"opponent",0,w("Metal",3,!1)),n=O(n,"opponent",1,w("Death",4,!1)),n=O(n,"opponent",2,w("Fire",2,!0)),n=O(n,"player",2,w("Spirit",5,!0)),n=O(n,"player",2,w("Spirit",4,!0)),n=Re(n),Ie(n)}},Ng={name:"Metal Test Playground",description:" All Metal cards on hand - unyielding defense",setup:t=>{let n=$e(t,["Metal","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[w("Metal",0,!0),w("Metal",1,!0),w("Metal",2,!0),w("Metal",3,!0),w("Metal",5,!0),w("Metal",6,!0)],n=O(n,"opponent",0,w("Metal",3,!1)),n=O(n,"opponent",1,w("Death",4,!0)),n=O(n,"player",1,w("Water",3,!0)),n=O(n,"opponent",2,w("Fire",0,!0)),n=O(n,"opponent",2,w("Fire",1,!0)),n=O(n,"opponent",2,w("Fire",2,!0)),n=O(n,"opponent",2,w("Fire",3,!0)),n=O(n,"opponent",2,w("Fire",4,!0)),n=O(n,"opponent",2,w("Fire",5,!0)),n=O(n,"player",2,w("Spirit",3,!0)),n=O(n,"player",2,w("Spirit",2,!0)),n=Re(n),Ie(n)}},Tg={name:"Plague Test Playground",description:" All Plague cards on hand - spread suffering",setup:t=>{let n=$e(t,["Plague","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[w("Plague",0,!0),w("Plague",1,!0),w("Plague",2,!0),w("Plague",3,!0),w("Plague",4,!0),w("Plague",5,!0)],n.opponent.hand=[w("Fire",2,!0),w("Death",3,!0),w("Water",1,!0)],n.player.lanes[0]=[w("Spirit",2,!0)],n.player.lanes[1]=[],n.player.lanes[2]=[],n.opponent.lanes[0]=[w("Metal",1,!0)],n.opponent.lanes[1]=[w("Death",2,!1)],n.opponent.lanes[2]=[w("Fire",3,!0)],n=Re(n),Ie(n)}},Rg={name:"Love Test Playground",description:" All Love cards on hand - share the love",setup:t=>{let n=$e(t,["Love","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[w("Love",1,!0),w("Love",2,!0),w("Love",3,!0),w("Love",4,!0),w("Love",5,!0),w("Love",6,!0)],n.opponent.hand=[w("Fire",2,!0),w("Death",3,!0),w("Water",1,!0),w("Metal",4,!0)],n.player.lanes[0]=[w("Spirit",2,!0)],n.player.lanes[1]=[],n.player.lanes[2]=[],n.opponent.lanes[0]=[w("Metal",1,!0)],n.opponent.lanes[1]=[w("Death",2,!1)],n.opponent.lanes[2]=[w("Fire",3,!0)],n=Re(n),Ie(n)}},Dg={name:"Psychic Test Playground",description:" All Psychic cards on hand - read minds and control",setup:t=>{let n=$e(t,["Psychic","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[w("Psychic",0,!0),w("Psychic",1,!0),w("Psychic",2,!0),w("Psychic",3,!0),w("Psychic",4,!0),w("Psychic",5,!0)],n.opponent.hand=[w("Fire",2,!0),w("Death",3,!0),w("Water",1,!0),w("Metal",4,!0)],n.player.lanes[0]=[w("Spirit",2,!0)],n.player.lanes[1]=[],n.player.lanes[2]=[],n.opponent.lanes[0]=[w("Metal",1,!0)],n.opponent.lanes[1]=[w("Death",2,!1)],n.opponent.lanes[2]=[w("Fire",3,!0)],n=Re(n),Ie(n)}},Ag={name:" Gravity-2 AI Single Card Bug",description:"AI spielt Gravity-2  Flip  Shift  Turn endet (NUR 1 Karte!)",setup:t=>{let n=$e(t,["Hate","Fire","Water"],["Gravity","Death","Metal"],"opponent","action");return n.opponent.hand=[w("Gravity",2,!0),w("Death",1,!0),w("Metal",3,!0)],n=O(n,"player",1,w("Hate",5,!0)),n=O(n,"player",1,w("Hate",4,!0)),n=O(n,"player",0,w("Fire",2,!0)),n=O(n,"player",2,w("Water",3,!0)),n=Re(n),Ie(n)}},Fg={name:"Speed-3 End-Effekt Softlock Test",description:"Speed-3 als einzige uncovered Karte sollte sich selbst im End-Effekt shiften knnen",setup:t=>{let n=$e(t,["Fire","Water","Death"],["Speed","Gravity","Light"],"opponent","end");return n.player.hand=[w("Fire",1,!0),w("Water",2,!0),w("Death",0,!0)],n=O(n,"player",0,w("Fire",3,!0)),n=O(n,"player",1,w("Water",1,!0)),n=O(n,"opponent",0,w("Speed",3,!0)),n.opponent.hand=[w("Gravity",1,!0),w("Light",2,!0)],n=Re(n),Ie(n)}},$g={name:"Uncover nach Delete All in Lane Test",description:"Death-2 lscht alle 1/2er  Karte darunter wird uncovered  Effekt triggert",setup:t=>{let n=$e(t,["Death","Fire","Water"],["Fire","Spirit","Light"],"player","action");return n.player.hand=[w("Death",2,!0),w("Fire",3,!0),w("Water",4,!0)],n=O(n,"opponent",0,w("Fire",5,!0)),n=O(n,"opponent",0,w("Fire",2,!0)),n=O(n,"player",0,w("Fire",4,!0)),n=O(n,"player",1,w("Water",3,!0)),n=O(n,"opponent",1,w("Spirit",2,!0)),n=Re(n),Ie(n)}},Ig={name:"Mehrfach-Uncover nach Delete All Test",description:"Death-2 lscht bei beiden Spielern  beide Karten darunter werden uncovered",setup:t=>{let n=$e(t,["Death","Water","Spirit"],["Fire","Light","Gravity"],"player","action");return n.player.hand=[w("Death",2,!0),w("Spirit",3,!0)],n.opponent.hand=[w("Fire",3,!0),w("Light",5,!0)],n=O(n,"player",0,w("Water",5,!0)),n=O(n,"player",0,w("Water",1,!0)),n=O(n,"opponent",0,w("Fire",5,!0)),n=O(n,"opponent",0,w("Fire",2,!0)),n=Re(n),Ie(n)}},qg={name:"Life-1 Uncover  Double Flip Bug",description:"Death-1 Start lscht  Life-1 uncovered  BEIDE Flips mssen ausgefhrt werden",setup:t=>{let n=$e(t,["Death","Fire","Water"],["Life","Metal","Spirit"],"player","start");return n.player.hand=[w("Fire",2,!0)],n.opponent.hand=[w("Metal",3,!0),w("Spirit",2,!0)],n=O(n,"player",0,w("Death",1,!0)),n=O(n,"opponent",0,w("Life",1,!0)),n=O(n,"opponent",0,w("Metal",0,!0)),n=O(n,"player",1,w("Water",1,!0)),n=O(n,"opponent",1,w("Metal",1,!0)),n=O(n,"opponent",2,w("Spirit",0,!0)),n=Re(n),Ie(n)}},Lg={name:"Smoke Test Playground",description:" All Smoke cards on hand - shroud your cards in mystery",setup:t=>{let n=$e(t,["Smoke","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[w("Smoke",0,!0),w("Smoke",1,!0),w("Smoke",2,!0),w("Smoke",3,!0),w("Smoke",4,!0),w("Smoke",5,!0)],n=O(n,"player",0,w("Water",2,!1)),n=O(n,"opponent",1,w("Metal",3,!1)),n=O(n,"opponent",1,w("Death",2,!0)),n=O(n,"opponent",2,w("Fire",2,!0)),n=O(n,"player",2,w("Spirit",3,!0)),n=O(n,"player",1,w("Spirit",4,!0)),n=Re(n),Ie(n)}},Pg={name:"Smoke AI Test",description:" AI spielt Smoke Karten - test all Smoke card effects with AI",setup:t=>{let n=$e(t,["Water","Spirit","Light"],["Smoke","Metal","Death"],"opponent","action");return n.opponent.hand=[w("Smoke",0,!0),w("Smoke",1,!0),w("Smoke",2,!0),w("Smoke",3,!0),w("Smoke",4,!0),w("Smoke",5,!0)],n=O(n,"opponent",0,w("Metal",2,!1)),n=O(n,"player",0,w("Water",3,!0)),n=O(n,"player",1,w("Spirit",2,!1)),n=O(n,"player",1,w("Spirit",4,!0)),n=O(n,"opponent",2,w("Death",3,!0)),n=O(n,"player",2,w("Light",2,!0)),n=O(n,"opponent",1,w("Metal",4,!0)),n=Re(n),Ie(n)}},Ug={name:"Clarity Test Playground",description:"All Clarity cards on hand - see through the fog of war",setup:t=>{let n=$e(t,["Clarity","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[w("Clarity",0,!0),w("Clarity",1,!0),w("Clarity",2,!0),w("Clarity",3,!0),w("Clarity",4,!0),w("Clarity",5,!0)],n.player.deck=[w("Clarity",1,!0),w("Water",1,!0),w("Spirit",5,!0),w("Spirit",3,!0),w("Water",2,!0),w("Fire",4,!0)],n.player.discard=[w("Water",4,!0),w("Spirit",1,!0)],n=O(n,"player",0,w("Water",2,!0)),n.opponent.hand=[w("Metal",3,!0),w("Death",2,!0),w("Fire",4,!0)],n=O(n,"opponent",1,w("Metal",3,!0)),n=O(n,"opponent",2,w("Fire",2,!0)),n=Re(n),Ie(n)}},Og={name:"Clarity AI Test",description:"AI spielt Clarity Karten - test all Clarity card effects with AI",setup:t=>{let n=$e(t,["Water","Spirit","Light"],["Clarity","Metal","Death"],"opponent","action");return n.opponent.hand=[w("Clarity",0,!0),w("Clarity",1,!0),w("Clarity",2,!0),w("Clarity",3,!0),w("Clarity",4,!0),w("Clarity",5,!0)],n.opponent.deck=[w("Clarity",1,!0),w("Metal",1,!0),w("Death",5,!0),w("Death",3,!0),w("Metal",2,!0)],n.opponent.discard=[w("Metal",4,!0),w("Death",2,!0)],n.player.hand=[w("Water",3,!0),w("Spirit",2,!0),w("Light",4,!0)],n=O(n,"player",0,w("Water",3,!0)),n=O(n,"opponent",0,w("Metal",2,!0)),n=O(n,"player",1,w("Spirit",4,!0)),n=O(n,"opponent",2,w("Death",3,!0)),n=Re(n),Ie(n)}},Mg={name:"Courage Custom Playground",description:"Test all Courage effects: empty hand draw, opponent higher value delete, conditional draw/flip, highest value shift",setup:t=>{let c=$e(t,["Courage","Fire","Speed"],["Spirit","Water","Darkness"],"player","action");return c.player.hand=[w("Courage",0,!0),w("Courage",1,!0),w("Courage",2,!0),w("Courage",3,!0),w("Courage",5,!0),w("Courage",6,!0)],c=O(c,"opponent",0,w("Spirit",3,!0)),c=O(c,"opponent",0,w("Spirit",5,!0)),c=O(c,"player",0,w("Fire",3,!0)),c=O(c,"opponent",1,w("Water",6,!0)),c=O(c,"player",1,w("Speed",4,!0)),c=O(c,"opponent",2,w("Darkness",2,!0)),c=O(c,"player",2,w("Fire",5,!0)),Ie(c)}},Vg={name:"Courage AI Test",description:"Test AI with Courage protocol: lane-restricted delete, self-shift to highest value lane",setup:t=>{let c=$e(t,["Spirit","Water","Fire"],["Courage","Speed","Darkness"],"opponent","action");return c.opponent.hand=[w("Courage",0,!0),w("Courage",1,!0),w("Courage",2,!0),w("Courage",3,!0),w("Courage",5,!0),w("Courage",6,!0)],c=O(c,"player",0,w("Spirit",5,!0)),c=O(c,"player",0,w("Spirit",5,!0)),c=O(c,"opponent",0,w("Speed",3,!0)),c=O(c,"player",1,w("Water",6,!0)),c=O(c,"opponent",1,w("Darkness",2,!0)),c=O(c,"opponent",1,w("Darkness",2,!1)),c=O(c,"player",2,w("Fire",3,!0)),c=O(c,"opponent",2,w("Speed",5,!0)),Ie(c)}},Hg={name:"Corruption Test Playground",description:" All Corruption cards on hand - corrupt your opponent's plans",setup:t=>{let n=$e(t,["Corruption","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[w("Corruption",0,!0),w("Corruption",1,!0),w("Corruption",2,!0),w("Corruption",3,!0),w("Corruption",5,!0),w("Corruption",6,!0)],n=O(n,"player",0,w("Water",2,!0)),n=O(n,"opponent",0,w("Metal",3,!0)),n=O(n,"opponent",1,w("Death",4,!0)),n=O(n,"opponent",2,w("Fire",2,!0)),n=O(n,"player",1,w("Spirit",3,!0)),n=O(n,"player",1,w("Spirit",5,!0)),n.opponent.hand=[w("Fire",3,!0),w("Metal",4,!0),w("Death",5,!0)],n=Re(n),Ie(n)}},zg={name:"Fear Custom Playground",description:"Test all Fear effects: passive ignore middle, choice shift/flip, chain discard, return, random discard",setup:t=>{let c=$e(t,["Fear","Fire","Speed"],["Spirit","Water","Darkness"],"player","action");return c.player.hand=[w("Fear",0,!0),w("Fear",1,!0),w("Fear",2,!0),w("Fear",3,!0),w("Fear",4,!0),w("Fear",5,!0)],c=O(c,"opponent",0,w("Spirit",2,!0)),c=O(c,"opponent",0,w("Spirit",3,!0)),c=O(c,"player",0,w("Fire",3,!0)),c=O(c,"opponent",1,w("Water",4,!0)),c=O(c,"player",1,w("Speed",4,!0)),c=O(c,"opponent",2,w("Darkness",2,!1)),c=O(c,"player",2,w("Fire",5,!0)),c.opponent.hand=[w("Spirit",1,!0),w("Water",2,!0),w("Darkness",3,!0),w("Spirit",4,!0)],Ie(c)}},Bg={name:"Fear AI Test",description:"Test AI with Fear protocol: random discard execution, passive rule handling",setup:t=>{let c=$e(t,["Spirit","Water","Fire"],["Fear","Speed","Darkness"],"opponent","action");return c.opponent.hand=[w("Fear",0,!0),w("Fear",1,!0),w("Fear",2,!0),w("Fear",3,!0),w("Fear",4,!0),w("Fear",5,!0)],c=O(c,"player",0,w("Spirit",3,!0)),c=O(c,"player",0,w("Spirit",5,!0)),c=O(c,"opponent",0,w("Speed",3,!0)),c=O(c,"player",1,w("Water",2,!0)),c=O(c,"player",1,w("Water",4,!0)),c=O(c,"player",2,w("Fire",3,!0)),c=O(c,"opponent",2,w("Darkness",5,!0)),c.player.hand=[w("Spirit",1,!0),w("Water",3,!0),w("Fire",4,!0)],Ie(c)}},Gg={name:"Ice Custom Playground",description:" Test all Ice effects: conditional shift, flip block, draw block, lane-reactive discard",setup:t=>{let c=$e(t,["Ice","Fire","Speed"],["Spirit","Water","Darkness"],"player","action");return c.player.hand=[w("Ice",1,!0),w("Ice",2,!0),w("Ice",3,!0),w("Ice",4,!0),w("Ice",5,!0),w("Ice",6,!0),w("Fire",0,!0)],c=O(c,"player",0,w("Fire",3,!0)),c=O(c,"player",0,w("Fire",5,!0)),c=O(c,"opponent",1,w("Water",4,!0)),c=O(c,"player",1,w("Speed",4,!0)),c=O(c,"opponent",2,w("Darkness",2,!0)),c=O(c,"player",2,w("Fire",5,!0)),c.opponent.hand=[w("Spirit",1,!0),w("Water",2,!0),w("Darkness",3,!0)],Ie(c)}},Yg={name:"Ice AI Test",description:" Test AI with Ice protocol: shift self, shift others, passive rules",setup:t=>{let c=$e(t,["Spirit","Water","Fire"],["Ice","Speed","Darkness"],"opponent","action");return c.opponent.hand=[w("Ice",1,!0),w("Ice",2,!0),w("Ice",3,!0),w("Ice",4,!0),w("Ice",5,!0),w("Ice",6,!0)],c=O(c,"player",0,w("Spirit",3,!0)),c=O(c,"player",0,w("Spirit",5,!0)),c=O(c,"opponent",0,w("Speed",3,!0)),c=O(c,"opponent",1,w("Darkness",2,!0)),c=O(c,"opponent",1,w("Darkness",4,!0)),c=O(c,"player",1,w("Water",4,!0)),c=O(c,"player",2,w("Fire",3,!0)),c=O(c,"opponent",2,w("Speed",5,!0)),c.player.hand=[w("Spirit",1,!0),w("Water",3,!0),w("Fire",4,!0)],Ie(c)}},Wg={name:"End Phase Test",description:"Test the game rule for the end or start phase, only 1 trigger",setup:t=>{let c=$e(t,["Light","Fire","Speed"],["Spirit","Water","Darkness"],"player","action");return c.player.hand=[w("Light",5,!0),w("Fire",0,!0)],c=O(c,"player",0,w("Light",1,!0)),c=O(c,"player",0,w("Light",2,!0)),c=O(c,"player",1,w("Fire",3,!0)),c=O(c,"player",2,w("Speed",3,!0)),c.opponent.hand=[w("Spirit",1,!0),w("Water",2,!0),w("Darkness",3,!0)],Ie(c)}},Qg={name:"Start Phase Test",description:"Test the game rule for the end or start phase, only 1 trigger",setup:t=>{let c=$e(t,["Spirit","Death","Psychic"],["Light","Water","Darkness"],"player","action");return c.player.hand=[w("Spirit",5,!0),w("Death",0,!0)],c=O(c,"player",0,w("Spirit",1,!0)),c=O(c,"player",0,w("Spirit",2,!0)),c=O(c,"player",1,w("Death",1,!0)),c=O(c,"player",1,w("Spirit",3,!0)),c=O(c,"player",2,w("Psychic",1,!0)),c.opponent.hand=[w("Light",1,!0),w("Water",2,!0),w("Darkness",3,!0)],Ie(c)}},Xg={name:"Committed Card Test",description:"Committed Card Test",setup:t=>{let c=$e(t,["Spirit","Darkness","Psychic"],["Light","Water","Fire"],"player","action");return c.player.hand=[w("Darkness",0,!0),w("Death",0,!0)],c=O(c,"player",0,w("Spirit",0,!0)),c=O(c,"player",0,w("Spirit",3,!0)),c=O(c,"opponent",0,w("Light",1,!0)),c=O(c,"opponent",0,w("Light",2,!0)),c.opponent.hand=[w("Light",5,!0),w("Water",2,!0),w("Darkness",3,!0)],Ie(c)}},Zg={name:"Fear 0 prob Test",description:"Bla bla",setup:t=>{let c=$e(t,["Chaos","Fear","Psychic"],["Light","Water","Fire"],"player","action");return c.player.hand=[w("Chaos",2,!0),w("Fear",3,!0)],c=O(c,"player",1,w("Fear",2,!0)),c=O(c,"player",1,w("Fear",0,!0)),c=O(c,"opponent",1,w("Water",5,!0)),c=O(c,"opponent",2,w("Darkness",2,!1)),c.opponent.hand=[w("Light",5,!0),w("Water",2,!0),w("Darkness",3,!0)],Ie(c)}},Kg={name:"MultiChain Test",description:"Multi Chain test",setup:t=>{let c=$e(t,["Chaos","Smoke","Test"],["Light","Water","Fire"],"player","action");return c.player.hand=[w("Smoke",1,!0),w("Chaos",3,!0)],c=O(c,"player",2,w("Test",1,!1)),c=O(c,"opponent",1,w("Water",5,!0)),c=O(c,"opponent",2,w("Darkness",2,!1)),c.opponent.hand=[w("Light",5,!0),w("Water",2,!0),w("Darkness",3,!0)],Ie(c)}},Jg={name:"Light3-Uncover Test",description:"Light3-Uncover_actionType Test",setup:t=>{let c=$e(t,["Chaos","Smoke","Test"],["Light","Water","Fire"],"player","action");return c.player.hand=[w("Smoke",1,!0),w("Chaos",3,!0)],c=O(c,"player",0,w("Chaos",3,!0)),c=O(c,"player",0,w("Chaos",2,!0)),c=O(c,"player",0,w("Test",1,!1)),c.opponent.hand=[w("Light",3,!0)],Ie(c)}},ev={name:"Luck Test Playground",description:" All Luck cards on hand - gamble with fate!",setup:t=>{let n=$e(t,["Luck","Fire","Water"],["Death","Life","Gravity"],"player","action");return n.player.hand=[w("Luck",0,!0),w("Luck",1,!0),w("Luck",2,!0),w("Luck",3,!0),w("Luck",4,!0),w("Luck",5,!0)],n=O(n,"opponent",0,w("Death",3,!0)),n=O(n,"opponent",0,w("Death",2,!1)),n=O(n,"opponent",1,w("Life",2,!0)),n=O(n,"player",1,w("Fire",3,!0)),n=O(n,"opponent",2,w("Gravity",4,!0)),n=O(n,"player",2,w("Water",3,!0)),n=Re(n),Ie(n)}},tv={name:"Luck AI Test",description:" AI spielt Luck Karten - test all Luck card effects with AI",setup:t=>{let n=$e(t,["Fire","Water","Spirit"],["Luck","Death","Life"],"opponent","action");return n.opponent.hand=[w("Luck",0,!0),w("Luck",1,!0),w("Luck",2,!0),w("Luck",3,!0),w("Luck",4,!0),w("Luck",5,!0)],n=O(n,"player",0,w("Fire",3,!0)),n=O(n,"opponent",0,w("Death",2,!0)),n=O(n,"player",1,w("Water",2,!0)),n=O(n,"player",1,w("Water",4,!1)),n=O(n,"player",2,w("Spirit",3,!0)),n=O(n,"opponent",2,w("Life",4,!0)),n=Re(n),Ie(n)}},nv={name:"Mirror Test Playground",description:" All Mirror cards on hand - copy, reflect, and swap",setup:t=>{let n=$e(t,["Mirror","Fire","Water"],["Death","Metal","Spirit"],"player","action");return n.player.hand=[w("Mirror",0,!0),w("Mirror",1,!0),w("Mirror",2,!0),w("Mirror",3,!0),w("Mirror",4,!0),w("Mirror",5,!0)],n=O(n,"player",0,w("Fire",3,!0)),n=O(n,"player",0,w("Fire",2,!1)),n=O(n,"player",1,w("Water",4,!0)),n=O(n,"player",2,w("Water",1,!0)),n=O(n,"opponent",0,w("Death",3,!0)),n=O(n,"opponent",0,w("Death",2,!1)),n=O(n,"opponent",1,w("Courage",2,!0)),n=O(n,"opponent",2,w("Spirit",2,!0)),n.opponent.hand=[w("Metal",1,!0),w("Spirit",3,!0),w("Death",4,!0)],n=Re(n),Ie(n)}},av={name:"Mirror AI Test",description:" AI spielt Mirror Karten - test all Mirror card effects with AI",setup:t=>{let n=$e(t,["Fire","Water","Spirit"],["Mirror","Death","Metal"],"opponent","action");return n.opponent.hand=[w("Mirror",0,!0),w("Mirror",1,!0),w("Mirror",2,!0),w("Mirror",3,!0),w("Mirror",4,!0),w("Mirror",5,!0)],n=O(n,"opponent",0,w("Death",3,!0)),n=O(n,"opponent",0,w("Death",2,!1)),n=O(n,"opponent",1,w("Metal",4,!0)),n=O(n,"opponent",2,w("Metal",1,!0)),n=O(n,"player",0,w("Fire",3,!0)),n=O(n,"player",0,w("Fire",2,!1)),n=O(n,"player",1,w("Water",4,!0)),n=O(n,"player",2,w("Spirit",2,!0)),n.player.hand=[w("Fire",1,!0),w("Water",3,!0),w("Spirit",4,!0)],n=Re(n),Ie(n)}},ov={name:"Peace Test Playground",description:" All Peace cards on hand - harmony, balance, sacrifice",setup:t=>{let n=$e(t,["Peace","Fire","Water"],["Death","Metal","Spirit"],"player","action");return n.player.hand=[w("Peace",1,!0),w("Peace",2,!0),w("Peace",3,!0),w("Peace",4,!0),w("Peace",5,!0),w("Peace",6,!0)],n=O(n,"player",0,w("Fire",3,!0)),n=O(n,"player",1,w("Water",4,!0)),n=O(n,"player",2,w("Water",5,!0)),n=O(n,"opponent",0,w("Death",5,!1)),n=O(n,"opponent",1,w("Metal",6,!0)),n=O(n,"opponent",2,w("Spirit",4,!0)),n.opponent.hand=[w("Metal",1,!0),w("Spirit",4,!0),w("Death",0,!0)],n=Re(n),Ie(n)}},rv={name:"Peace AI Test",description:" AI spielt Peace Karten - test all Peace card effects with AI",setup:t=>{let n=$e(t,["Fire","Water","Spirit"],["Peace","Death","Life"],"opponent","action");return n.opponent.hand=[w("Peace",1,!0),w("Peace",2,!0),w("Peace",3,!0),w("Peace",4,!0),w("Peace",5,!0),w("Peace",6,!0)],n=O(n,"player",0,w("Fire",3,!0)),n=O(n,"player",1,w("Water",4,!0)),n=O(n,"player",2,w("Spirit",5,!0)),n=O(n,"opponent",0,w("Death",2,!0)),n=O(n,"opponent",1,w("Life",3,!0)),n.player.hand=[w("Fire",1,!0),w("Water",3,!0),w("Spirit",4,!0)],n=Re(n),Ie(n)}},lv={name:"Peace-4 Reactive Test",description:" Test Peace-4: AI spielt Plague  du discardest  Peace-4 triggert  du ziehst",setup:t=>{let n=$e(t,["Peace","Fire","Water"],["Plague","Death","Life"],"opponent","action");return n=O(n,"player",0,w("Peace",4,!0)),n=O(n,"player",1,w("Fire",3,!0)),n=O(n,"player",2,w("Water",2,!0)),n.opponent.hand=[w("Plague",0,!0),w("Plague",1,!0)],n=O(n,"opponent",0,w("Death",5,!0)),n.player.hand=[w("Fire",1,!0),w("Water",3,!0),w("Peace",2,!0)],n=Re(n),Ie(n)}},sv={name:"War Custom Protocol Playground",description:"Player has War protocol with cards on board for testing reactive triggers",setup:t=>{let n=$e(t,["War","Fire","Water"],["Plague","Death","Spirit"],"player","action");return n.player.hand=[w("War",1,!0),w("War",2,!0),w("War",3,!0),w("War",4,!0),w("War",5,!0)],n=O(n,"player",2,w("War",0,!0)),n=O(n,"opponent",0,w("Fire",1,!0)),n=O(n,"opponent",1,w("Spirit",5,!0)),n=O(n,"opponent",1,w("Death",5,!0)),n.opponent.hand=[w("Death",1,!0),w("Spirit",2,!0),w("Plague",1,!0)],n=Re(n),Ie(n)}},cv={name:"War AI Test",description:"AI plays with War protocol - tests reactive trigger handling",setup:t=>{let n=$e(t,["Fire","Water","Death"],["War","Plague","Spirit"],"player","action");return n=O(n,"opponent",0,w("War",0,!0)),n=O(n,"opponent",1,w("War",1,!0)),n=O(n,"opponent",2,w("War",2,!0)),n=O(n,"player",0,w("Fire",1,!0)),n=O(n,"player",1,w("Water",2,!0)),n=O(n,"player",2,w("Death",1,!0)),n.player.hand=[w("Fire",2,!0),w("Water",3,!0),w("Death",2,!0)],n.opponent.hand=[w("Spirit",1,!0),w("Plague",2,!0)],n=Re(n),Ie(n)}},iv={name:"Time Test Playground",description:" All Time cards on hand - manipulate trash and deck",setup:t=>{const n=["Time","Clarity","Life"],r=["Fire","Water","Death"];let c=$e(t,n,r,"player","action");const s=[w("Time",0),w("Time",1),w("Time",2),w("Time",3),w("Time",4),w("Time",5)],d=[w("Life",3),w("Clarity",2),w("Life",1)];c={...c,player:{...c.player,hand:s,discard:d}},c=O(c,"player",0,w("Clarity",0,!0)),c=O(c,"player",0,w("Life",0,!1)),c=O(c,"opponent",1,w("Fire",2,!1));const u=[...s,...d,...c.player.lanes.flat(),...c.opponent.lanes.flat()];return c.player.deck=on(n,u),c.opponent.deck=on(r,[]),c=Re(c),Ie(c)}},dv={name:"Time AI Test",description:" AI plays Time cards - test trash selection and shuffle triggers",setup:t=>{const n=["Fire","Water","Death"],r=["Time","Clarity","Life"];let c=$e(t,n,r,"opponent","action");const s=[w("Fire",2),w("Water",3)],d=[w("Time",0),w("Time",1),w("Time",2),w("Time",3),w("Time",4),w("Time",5)],u=[w("Life",4),w("Clarity",3)];c={...c,player:{...c.player,hand:s},opponent:{...c.opponent,hand:d,discard:u}},c=O(c,"player",0,w("Fire",1,!0)),c=O(c,"player",0,w("Water",0,!1)),c=O(c,"opponent",1,w("Clarity",1,!0));const p=[...s,...d,...u,...c.player.lanes.flat(),...c.opponent.lanes.flat()];return c.player.deck=on(n,p),c.opponent.deck=on(r,p),c=Re(c),Ie(c)}},uv={name:"Assimilation Test Playground",description:"All Assimilation cards on hand - steal, draw from opponent, play to opponent's board",setup:t=>{const n=["Assimilation","Clarity","Life"],r=["Fire","Water","Death"];let c=$e(t,n,r,"player","action");const s=[w("Assimilation",0),w("Assimilation",1),w("Assimilation",2),w("Assimilation",4),w("Assimilation",5),w("Assimilation",6)];c={...c,player:{...c.player,hand:s}},c=O(c,"opponent",0,w("Fire",3,!1)),c=O(c,"opponent",0,w("Fire",2,!1)),c=O(c,"opponent",1,w("Water",4,!0)),c=O(c,"opponent",2,w("Death",1,!1)),c=O(c,"player",0,w("Clarity",0,!0)),c=O(c,"player",1,w("Life",1,!0));const d=[...s,...c.player.lanes.flat(),...c.opponent.lanes.flat()];return c.player.deck=on(n,d),c.opponent.deck=on(r,[]),c=Re(c),Ie(c)}},pv={name:"Assimilation AI Test",description:"AI plays Assimilation cards - test steal and play to opponent's board",setup:t=>{const n=["Fire","Water","Death"],r=["Assimilation","Clarity","Life"];let c=$e(t,n,r,"opponent","action");const s=[w("Fire",2),w("Water",3)],d=[w("Assimilation",0),w("Assimilation",1),w("Assimilation",2),w("Assimilation",4),w("Assimilation",5),w("Assimilation",6)];c={...c,player:{...c.player,hand:s},opponent:{...c.opponent,hand:d}},c=O(c,"player",0,w("Fire",5,!1)),c=O(c,"player",1,w("Water",4,!0)),c=O(c,"player",2,w("Death",2,!1)),c=O(c,"opponent",0,w("Clarity",1,!0));const u=[...s,...d,...c.player.lanes.flat(),...c.opponent.lanes.flat()];return c.player.deck=on(n,u),c.opponent.deck=on(r,[]),c=Re(c),Ie(c)}},fv={name:"Diversity Test Playground",description:"All Diversity cards on hand - test auto-compile, value modifiers, and protocol-count effects",setup:t=>{const n=["Diversity","Fire","Water"],r=["Death","Life","Light"];let c=$e(t,n,r,"player","action");const s=[w("Diversity",0),w("Diversity",1),w("Diversity",3),w("Diversity",4),w("Diversity",5),w("Diversity",6)];c={...c,player:{...c.player,hand:s}},c=O(c,"player",0,w("Fire",2,!0)),c=O(c,"player",1,w("Water",3,!0)),c=O(c,"opponent",0,w("Death",4,!0)),c=O(c,"opponent",1,w("Life",2,!0)),c=O(c,"opponent",2,w("Light",1,!0));const d=[...s,...c.player.lanes.flat(),...c.opponent.lanes.flat()];return c.player.deck=on(n,d),c.opponent.deck=on(r,[]),c=Re(c),Ie(c)}},hv={name:"Diversity AI Test",description:"AI plays Diversity cards - test auto-compile and conditional effects",setup:t=>{const n=["Fire","Water","Death"],r=["Diversity","Life","Light"];let c=$e(t,n,r,"opponent","action");const s=[w("Fire",2),w("Water",3)],d=[w("Diversity",0),w("Diversity",1),w("Diversity",3),w("Diversity",4),w("Diversity",5),w("Diversity",6)];c={...c,player:{...c.player,hand:s},opponent:{...c.opponent,hand:d}},c=O(c,"player",0,w("Fire",4,!0)),c=O(c,"player",1,w("Water",2,!0)),c=O(c,"player",2,w("Death",1,!0)),c=O(c,"opponent",0,w("Life",3,!0)),c=O(c,"opponent",1,w("Light",2,!0));const u=[...s,...d,...c.player.lanes.flat(),...c.opponent.lanes.flat()];return c.player.deck=on(n,u),c.opponent.deck=on(r,[]),c=Re(c),Ie(c)}},mv={name:"Unity Custom Playground (Player)",description:"Test Unity synergy effects - cards become stronger with more face-up Unity on field",setup:t=>{const n=["Unity","Fire","Water"],r=["Death","Spirit","Light"];let c=$e(t,n,r,"player","action");const s=[w("Unity",0,!0),w("Unity",1,!0),w("Unity",2,!0),w("Unity",3,!0),w("Unity",4,!0),w("Unity",5,!0)];c.player.hand=s;const d=[w("Death",1,!0),w("Spirit",2,!0),w("Light",3,!0)];c.opponent.hand=d,c=O(c,"player",0,w("Fire",2,!0)),c=O(c,"opponent",0,w("Death",3,!0));const u=[...s,...d,...c.player.lanes.flat(),...c.opponent.lanes.flat()];return c.player.deck=on(n,u),c.opponent.deck=on(r,[]),c=Re(c),Ie(c)}},yv={name:"Unity AI Test (Opponent)",description:"Test AI handling of Unity synergy effects",setup:t=>{const n=["Fire","Water","Spirit"],r=["Unity","Death","Light"];let c=$e(t,n,r,"opponent","action");const s=[w("Fire",1,!0),w("Water",2,!0),w("Spirit",3,!0)];c.player.hand=s;const d=[w("Unity",0,!0),w("Unity",2,!0),w("Unity",3,!0),w("Unity",5,!0)];c.opponent.hand=d,c=O(c,"opponent",0,w("Unity",1,!0)),c=O(c,"player",1,w("Fire",4,!0));const u=[...s,...d,...c.player.lanes.flat(),...c.opponent.lanes.flat()];return c.player.deck=on(n,u),c.opponent.deck=on(r,[]),c=Re(c),Ie(c)}},gv=[zy,By,Gy,Yy,Wy,Qy,Xy,Zy,Ky,Jy,eg,tg,ng,ag,og,rg,lg,sg,cg,ig,dg,xj,Cj,Sj,bj,Ej,jj,ug,pg,fg,hg,mg,yg,gg,vg,_g,wg,xg,Cg,Sg,bg,Eg,jg,kg,Ng,Tg,Rg,Dg,Ag,Fg,$g,Ig,qg,Lg,Pg,Ug,Og,Hg,Mg,Vg,zg,Bg,Gg,Yg,Wg,Qg,Xg,Zg,Kg,Jg,ev,tv,nv,av,ov,rv,lv,sv,cv,iv,dv,uv,pv,fv,hv,mv,yv],cu=Object.freeze(Object.defineProperty({__proto__:null,allScenarios:gv,scenario10_Hate1Interrupt:Zy,scenario11_Darkness1HateChain:Ky,scenario12_Water4TurnEnd:Jy,scenario13_Psychic3ShiftTest:eg,scenario14_Death1UncoverTest:tg,scenario15_Gravity2ShiftInterrupt:ng,scenario16_Hate2PlayerPlays:ag,scenario171_Hate2AIPlays:rg,scenario17_Hate2AIPlays:og,scenario18_Hate2SelfDelete:lg,scenario19_Hate2MultipleTies:sg,scenario1_Psychic3Uncover:zy,scenario20_Hate2FaceDown:cg,scenario21_Hate2AIValidation:ig,scenario22_Hate2AIPlaysOpen:dg,scenario29_FireCustomConditional:ug,scenario2_Psychic4EndEffect:By,scenario30_AnarchyCustomPlayground:pg,scenario31_DarkCustPlayground:fg,scenario32_ApathyCustomPlayground:hg,scenario33_DeathCustomPlayground:mg,scenario34_WaterCustomPlayground:yg,scenario35_SpiritCustomPlayground:gg,scenario36_ChaosCustomPlayground:vg,scenario37_GravityCustomPlayground:_g,scenario38_FrostCustomPlayground:wg,scenario39_HateCustomPlayground:xg,scenario3_Spirit3EndPhase:Gy,scenario40_LifeCustomPlayground:Cg,scenario41_LightCustomPlayground:Sg,scenario42_Death2UncoverInterruptTurn:bg,scenario43_Apathy5DoubleUncover:Eg,scenario44_Psychic1Darkness2Test:jg,scenario45_SpeedCustomPlayground:kg,scenario46_MetalCustomPlayground:Ng,scenario47_PlagueCustomPlayground:Tg,scenario48_LoveCustomPlayground:Rg,scenario49_PsychicCustomPlayground:Dg,scenario4_Plague2Actor:Yy,scenario50_Gravity2SingleCardBug:Ag,scenario51_Speed3EndEffectSoftlock:Fg,scenario52_UncoverAfterBulkDelete:$g,scenario53_MultiUncoverAfterBulkDelete:Ig,scenario54_Life1UncoverDoubleFlip:qg,scenario55_SmokeCustomPlayground:Lg,scenario56_SmokeAITest:Pg,scenario57_ClarityCustomPlayground:Ug,scenario58_ClarityAITest:Og,scenario59_CorruptionCustomPlayground:Hg,scenario5_Darkness1Interrupt:Wy,scenario60_CourageCustomPlayground:Mg,scenario61_CourageAITest:Vg,scenario62_FearCustomPlayground:zg,scenario63_FearAITest:Bg,scenario64_IceCustomPlayground:Gg,scenario65_IceAITest:Yg,scenario66_endPhasePlayground:Wg,scenario67_startPhasePlayground:Qg,scenario68_CommittedCardPlayground:Xg,scenario69_fear0shiftCardPlayground:Zg,scenario70_multiChainCardPlayground:Kg,scenario71_Light3ProblemPlayground:Jg,scenario72_LuckCustomPlayground:ev,scenario73_LuckAITest:tv,scenario74_MirrorCustomPlayground:nv,scenario75_MirrorAITest:av,scenario76_PeaceCustomPlayground:ov,scenario77_PeaceAITest:rv,scenario78_Peace4ReactiveTest:lv,scenario79_WarCustomPlayground:sv,scenario80_WarAITest:cv,scenario81_TimeCustomPlayground:iv,scenario82_TimeAITest:dv,scenario83_AssimilationCustomPlayground:uv,scenario84_AssimilationAITest:pv,scenario85_DiversityCustomPlayground:fv,scenario86_DiversityAITest:hv,scenario87_UnityCustomPlayground:mv,scenario88_UnityAITest:yv,scenario8_Plague4Owner:Qy,scenario9_Water:Xy},Symbol.toStringTag,{value:"Module"})),kj=({onLoadScenario:t,onSkipCoinFlip:n,onForceWin:r,onForceLose:c})=>{const[s,d]=ce.useState(!1);return s?o.jsxs("div",{style:{position:"fixed",top:"20px",left:"20px",width:"400px",maxHeight:"600px",backgroundColor:"#2c2c2c",border:"2px solid #ff6b6b",borderRadius:"8px",padding:"20px",zIndex:9999,overflowY:"auto",color:"white",fontFamily:"monospace"},children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"20px"},children:[o.jsx("h3",{style:{margin:0},children:" Debug Panel"}),o.jsx("button",{onClick:()=>d(!1),style:{backgroundColor:"transparent",border:"none",color:"white",cursor:"pointer",fontSize:"20px"},children:""})]}),o.jsx("div",{style:{marginBottom:"15px",fontSize:"12px",color:"#aaa"},children:"Lade vordefinierte Test-Szenarien zum Testen der Actor/Owner-Fixes."}),o.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:gv.map((u,p)=>o.jsxs("div",{style:{backgroundColor:"#1a1a1a",padding:"12px",borderRadius:"5px",border:"1px solid #444"},children:[o.jsx("div",{style:{fontWeight:"bold",marginBottom:"5px",color:"#4ecdc4"},children:u.name}),o.jsx("div",{style:{fontSize:"11px",color:"#bbb",marginBottom:"10px"},children:u.description}),o.jsx("button",{onClick:()=>{n&&n(),t(u.setup),d(!1)},style:{padding:"6px 12px",backgroundColor:"#4ecdc4",color:"#1a1a1a",border:"none",borderRadius:"3px",cursor:"pointer",fontWeight:"bold",fontSize:"12px"},children:"Load Scenario"})]},p))}),(r||c)&&o.jsxs("div",{style:{marginTop:"20px",paddingTop:"15px",borderTop:"1px solid #444",display:"flex",gap:"10px",justifyContent:"center"},children:[r&&o.jsx("button",{onClick:()=>{r(),d(!1)},style:{padding:"10px 20px",backgroundColor:"#4ecdc4",color:"#1a1a1a",border:"none",borderRadius:"5px",cursor:"pointer",fontWeight:"bold",fontSize:"14px"},children:" Force Win"}),c&&o.jsx("button",{onClick:()=>{c(),d(!1)},style:{padding:"10px 20px",backgroundColor:"#ff6b6b",color:"white",border:"none",borderRadius:"5px",cursor:"pointer",fontWeight:"bold",fontSize:"14px"},children:" Force Lose"})]}),o.jsx("div",{style:{marginTop:"20px",fontSize:"11px",color:"#666",textAlign:"center"},children:"Drcke ESC oder klicke  zum Schlieen"})]}):o.jsx("button",{onClick:()=>d(!0),style:{position:"fixed",top:"20px",left:"20px",padding:"10px 20px",backgroundColor:"#ff6b6b",color:"white",border:"none",borderRadius:"5px",cursor:"pointer",fontWeight:"bold",zIndex:9999,fontSize:"14px"},children:" DEBUG"})},Im=(t,n)=>{if(!n)return null;for(const r of["player","opponent"])for(const c of t[r].lanes){const s=c.find(d=>d.id===n);if(s)return{card:s,owner:r}}return null},Nj=new Set(["discard","select_card_from_hand_to_play","select_card_from_hand_to_give","select_card_from_hand_to_reveal","plague_2_player_discard","select_cards_from_hand_to_discard_for_fire_4","select_cards_from_hand_to_discard_for_hate_1"]);function Tj({onBack:t,onEndGame:n,playerProtocols:r,opponentProtocols:c,difficulty:s,useControlMechanic:d,startingPlayer:u="player",initialScenarioSetup:p}){var na,vn,_n,kn,wn,Tt,xa,Ca,mn,xn,ge,De,Me,ot,ze,Ye;const[f,h]=ce.useState(null),[_,y]=ce.useState(!0),{startGame:m,endGame:g,trackPlayerCoinFlip:x,trackPlayerRearrange:C}=wj(r,s,d),b=ce.useCallback((me,xe,Pe)=>{h(me),y(!1),x(xe,Pe)},[x]),j=ce.useCallback(()=>{h("player"),y(!1),m()},[m]);ce.useEffect(()=>{p&&_&&(console.log("[E2E] Auto-skipping coin flip for scenario"),h("player"),y(!1))},[p,_]),ce.useEffect(()=>{!_&&f&&m()},[_,f,m]);const k=ce.useCallback((me,xe)=>{const Pe=xe.player.compiled.filter(Ae=>Ae).length;g(me,xe.stats.player,Pe,xe.stats.opponent,xe.detailedGameStats),n(me,xe)},[g,n]),{gameState:E,selectedCard:T,setSelectedCard:F,playSelectedCard:U,fillHand:D,discardCardFromHand:I,compileLane:W,resolveActionWithCard:z,resolveActionWithLane:V,resolveActionWithLaneFaceDown:B,selectHandCardForAction:L,resolveActionWithHandCard:P,skipAction:M,resolveOptionalDrawPrompt:N,resolveDeath1Prompt:R,resolveLove1Prompt:$,resolvePlague2Discard:X,resolvePlague4Flip:G,resolveFire3Prompt:q,resolveOptionalDiscardCustomPrompt:Q,resolveOptionalEffectPrompt:K,resolveFire4Discard:Z,resolveHate1Discard:te,resolveLight2Prompt:ee,resolveRevealBoardCardPrompt:se,resolveRearrangeProtocols:_e,resolveSpirit1Prompt:fe,resolveSpirit3Prompt:be,resolveSwapProtocols:oe,resolveSpeed3Prompt:H,resolvePsychic4Prompt:ne,resolveControlMechanicPrompt:J,resolveCustomChoice:ie,resolveSelectRevealedDeckCard:de,resolveRevealDeckDrawProtocol:pe,resolveStateNumber:Se,resolveStateProtocol:Fe,resolveSelectFromDrawnToReveal:je,resolveConfirmDeckDiscard:Ve,resolveConfirmDeckPlayPreview:He,resolveSelectTrashCardToPlay:Ge,resolveSelectTrashCardToReveal:qe,setupTestScenario:Ne}=qx(r,c,k,s,d,f??"player",C),[Oe,Le]=ce.useState(null),[ut,Qe]=ce.useState([]),[Je,Ft]=ce.useState(!1),[tn,Gt]=ce.useState([]),Lt=ce.useRef(E.log.length),[nn,Pt]=ce.useState(!1),[Ha,Na]=ce.useState(!1),[ma,bn]=ce.useState(null),[ta,Pn]=ce.useState(!1),[gn,En]=ce.useState(0),Jt=ce.useRef(null),Un=ce.useRef(E);ce.useEffect(()=>{Un.current=E},[E]);const ya=ce.useRef(!1);ce.useEffect(()=>{p&&!ya.current&&(console.log("[E2E] Applying initial scenario setup..."),ya.current=!0,setTimeout(()=>{Ne(p),console.log("[E2E] Scenario setup complete")},100))},[p,Ne]);const ga=()=>{const me=gn+1;if(En(me),me>=5){Pn(xe=>!xe),En(0),Jt.current&&(clearTimeout(Jt.current),Jt.current=null);return}Jt.current&&clearTimeout(Jt.current),Jt.current=setTimeout(()=>{En(0),Jt.current=null},2e3)},On=ce.useCallback(()=>{console.log("Debug: Forcing player win via DebugPanel."),k("player",E)},[k,E]),za=ce.useCallback(()=>{console.log("Debug: Forcing player loss via DebugPanel."),k("opponent",E)},[k,E]),Ta=ce.useMemo(()=>{if(E.lastPlayedCardId){const me=Im(E,E.lastPlayedCardId);if(me){const xe=me.owner==="player"||me.card.isFaceUp;return{card:me.card,showContents:xe}}}return null},[E.lastPlayedCardId,E.player.lanes,E.opponent.lanes]),Ra=ce.useMemo(()=>{var xe;const me=(xe=E.actionRequired)==null?void 0:xe.sourceCardId;if(me){const Pe=Im(E,me);if(Pe){const Ae=Pe.owner==="player"||Pe.card.isFaceUp;return{card:Pe.card,showContents:Ae}}}return null},[(na=E.actionRequired)==null?void 0:na.sourceCardId,E.player.lanes,E.opponent.lanes]);ce.useEffect(()=>{var me;(me=E.actionRequired)!=null&&me.sourceCardId&&Le(null)},[(vn=E.actionRequired)==null?void 0:vn.sourceCardId]);const va=Oe||Ra||Ta;ce.useEffect(()=>{E.log.length>Lt.current&&E.log.slice(Lt.current).forEach(xe=>{if(xe.message!=="Game Started."){const Pe={message:xe.message,player:xe.player,id:ct()};Gt(Ae=>[...Ae,Pe]),setTimeout(()=>{Gt(Ae=>Ae.filter(Xe=>Xe.id!==Pe.id))},5e3)}}),Lt.current=E.log.length},[E.log]),ce.useEffect(()=>{var xe,Pe,Ae,Xe,it;!(((xe=E.actionRequired)==null?void 0:xe.type)==="discard"&&((Pe=E.actionRequired)==null?void 0:Pe.variableCount))&&((Ae=E.actionRequired)==null?void 0:Ae.type)!=="plague_2_player_discard"&&((Xe=E.actionRequired)==null?void 0:Xe.type)!=="select_cards_from_hand_to_discard_for_fire_4"&&((it=E.actionRequired)==null?void 0:it.type)!=="select_cards_from_hand_to_discard_for_hate_1"&&Qe([])},[E.actionRequired]),ce.useEffect(()=>{var me,xe;Pt(((me=E.actionRequired)==null?void 0:me.type)==="prompt_rearrange_protocols"&&E.actionRequired.actor==="player"),Na(((xe=E.actionRequired)==null?void 0:xe.type)==="prompt_swap_protocols"&&E.actionRequired.actor==="player")},[E.actionRequired]),ce.useEffect(()=>{const me=xe=>{xe.ctrlKey&&xe.shiftKey&&(xe.preventDefault(),xe.key.toLowerCase()==="d"?(console.log("Debug: Toggling debug button visibility."),Pn(Pe=>!Pe)):xe.key.toLowerCase()==="w"?(console.log("Debug: Forcing player win."),n("player",E)):xe.key.toLowerCase()==="o"?(console.log("Debug: Forcing opponent win."),n("opponent",E)):xe.key.toLowerCase()==="p"?(console.log("Debug: Setting up Speed-0 interrupt scenario."),Ne("speed-0-interrupt")):xe.key.toLowerCase()==="l"?(console.log("Debug: Setting up Speed-1 discard trigger scenario."),Ne("speed-1-trigger")):xe.key.toLowerCase()==="f"?(console.log("Debug: Setting up Fire On-Cover test scenario."),Ne("fire-oncover-test")):xe.key.toLowerCase()==="s"?(console.log("Debug: Setting up Speed-2 + Control test scenario."),Ne("speed-2-control-test")):xe.key.toLowerCase()==="u"&&(console.log("Debug: Setting up Death-1 Uncover test scenario."),ew(()=>Promise.resolve().then(()=>cu),void 0).then(Pe=>{Ne(Pe.scenario14_Death1UncoverTest.setup)})))};return window.addEventListener("keydown",me),()=>{window.removeEventListener("keydown",me)}},[E,n,Ne]);const Mn=(me,xe)=>{var fo,ho,aa,Zo,mo,yo;const Pe=Un.current;if(Pe.animationState)return;const{actionRequired:Ae,turn:Xe,phase:it,compilableLanes:Ut,player:xt,opponent:Vt}=Pe;if(xe==="player"&&Xe==="player"&&it==="compile"&&Ut.includes(me)){if(Ae){console.warn("Compile click blocked by pending action:",Ae);return}W(me);return}if(Ae&&Ae.actor==="player"&&["select_lane_for_shift","select_lane_for_shift_all","shift_flipped_card_optional","select_lane_for_play","select_lane_for_delete","select_lane_for_death_2","select_lane_for_life_3_play","select_lane_to_shift_revealed_card_for_light_2","select_lane_to_shift_revealed_board_card_custom","select_lane_to_shift_cards_for_light_3","select_lane_for_water_3","select_lane_for_metal_3_delete","select_lane_for_delete_all","select_lane_for_return","select_lanes_for_swap_stacks"].includes(Ae.type)){V(me);return}const Sa=Vt.lanes.flat().some(Ht=>Ht.isFaceUp&&Ht.protocol==="Psychic"&&Ht.value===1),Hn=Vt.lanes[me],po=Hn.length>0&&Hn[Hn.length-1].isFaceUp&&Hn[Hn.length-1].protocol==="Plague"&&Hn[Hn.length-1].value===0;if(T&&it==="action"&&!Ae&&xt.hand.some(Ht=>Ht.id===T)&&!po){const Ht=xt.hand.find(Rt=>Rt.id===T);if(xe==="opponent"){if(!cl(Pe,Ht)){F(null),Le(null);return}if(Sa){F(null),Le(null);return}U(me,!0,"opponent"),Le(null);return}const Cr=xt.lanes.flat().some(Rt=>Rt.isFaceUp&&Rt.protocol==="Spirit"&&Rt.value===1),Sr=((ho=(fo=Ht.customEffects)==null?void 0:fo.bottomEffects)==null?void 0:ho.some(Rt=>{var Ue,zn;return((Ue=Rt.params)==null?void 0:Ue.action)==="card_property"&&((zn=Rt.params)==null?void 0:zn.property)==="ignore_protocol_matching"}))||((Zo=(aa=Ht.customEffects)==null?void 0:aa.topEffects)==null?void 0:Zo.some(Rt=>{var Ue,zn;return((Ue=Rt.params)==null?void 0:Ue.action)==="card_property"&&((zn=Rt.params)==null?void 0:zn.property)==="ignore_protocol_matching"}))||((yo=(mo=Ht.customEffects)==null?void 0:mo.middleEffects)==null?void 0:yo.some(Rt=>{var Ue,zn;return((Ue=Rt.params)==null?void 0:Ue.action)==="card_property"&&((zn=Rt.params)==null?void 0:zn.property)==="ignore_protocol_matching"})),Ya=[...xt.lanes.flat(),...Vt.lanes.flat()].some(Rt=>Rt.isFaceUp&&Rt.protocol==="Anarchy"&&Rt.value===1),Nn=pu(Pe),go=Ic(Pe,"player",me),vo=cl(Pe,Ht),ba=fl(Pe,"player",me,Ht.protocol);let Tn;vo?Tn=!Sa:Ya||Nn?Tn=Ht.protocol!==xt.protocols[me]&&Ht.protocol!==Vt.protocols[me]&&!Sa:Tn=(Cr||go||Sr||ba||Ht.protocol===xt.protocols[me]||Ht.protocol===Vt.protocols[me])&&!Sa,U(me,Tn),Le(null);return}T&&(F(null),Le(null))},_a=me=>{const xe=Un.current;if(xe.animationState)return;const{phase:Pe,actionRequired:Ae,player:Xe}=xe;if((Ae==null?void 0:Ae.type)==="select_lane_for_play"&&Ae.ignoreProtocolMatching&&Ae.isFaceDown===void 0){const it=Ae.validLanes;if(it&&!it.includes(me))return;B(me);return}T&&(Pe!=="action"||Ae||!Xe.hand.some(it=>it.id===T)||(U(me,!1),Le(null)))},Da=me=>{const xe=Un.current;if(!xe.animationState){if(xe.actionRequired){if(xe.actionRequired.type==="discard"&&xe.actionRequired.actor==="player"){const Pe=xe.actionRequired.count;if(Pe>1||xe.actionRequired.variableCount){Qe(Ae=>Ae.includes(me.id)?Ae.filter(Xe=>Xe!==me.id):!xe.actionRequired.variableCount&&Ae.length>=Pe?Ae:[...Ae,me.id]);return}else{I(me.id);return}}if(xe.actionRequired.type==="select_card_from_hand_to_play"){L(me.id);return}if(xe.actionRequired.type==="select_card_from_hand_to_give"||xe.actionRequired.type==="select_card_from_hand_to_reveal"){P(me.id);return}if(xe.actionRequired.type==="plague_2_player_discard"||xe.actionRequired.type==="select_cards_from_hand_to_discard_for_fire_4"||xe.actionRequired.type==="select_cards_from_hand_to_discard_for_hate_1"){Qe(Pe=>Pe.includes(me.id)?Pe.filter(Ae=>Ae!==me.id):[...Pe,me.id]);return}return}xe.turn!=="player"||xe.phase!=="action"&&xe.phase!=="compile"||(me.id===T?(F(null),Le(null)):(F(me.id),Le({card:me,showContents:!0})))}},Aa=(me,xe,Pe)=>{const Ae=Un.current;if(Ae.animationState)return;const{actionRequired:Xe,turn:it,phase:Ut,compilableLanes:xt}=Ae;if(it==="player"&&Ut==="compile"&&xt.includes(Pe)){Mn(Pe,xe);return}if(it==="player"&&!Xe&&T&&Ut==="action"){Mn(Pe,xe);return}if(Xe&&Xe.actor==="player"&&(Xe.type==="select_own_highest_card_to_delete_for_hate_2"||Xe.type==="select_opponent_highest_card_to_delete_for_hate_2")&&Fc(me,Ae)){z(me.id);return}if(Fc(me,Ae))z(me.id);else if(T)F(null),Le(null);else{const Vt=xe==="player"||me.isFaceUp;Le({card:me,showContents:Vt})}},hn=me=>{T||Le({card:me,showContents:!0})},$t=(me,xe)=>{if(!T){const Pe=xe==="player"||me.isFaceUp;Le({card:me,showContents:Pe})}},Mt=()=>{T||Le(null)},jn=me=>{!T&&!E.actionRequired&&Le({card:me,showContents:me.isRevealed||!1})},wa=()=>{if(!va)return null;const{card:me,showContents:xe}=va;return o.jsx(St,{card:me,isFaceUp:xe})},Ba=E.turn==="player"&&!E.actionRequired&&E.phase==="compile"&&E.compilableLanes.length>0,Ga=((_n=E.actionRequired)==null?void 0:_n.sourceCardId)??null,Fa=ce.useMemo(()=>{var me;return(me=E.actionRequired)!=null&&me.actor?E.actionRequired.actor==="player"?"action-required-player":"action-required-opponent":""},[E.actionRequired]),Vn=ce.useMemo(()=>{const me=E.actionRequired;return me&&me.actor==="player"?Nj.has(me.type)?"":"hand-in-background":""},[E.actionRequired]);return o.jsxs("div",{className:"screen game-screen",children:[ma&&o.jsx(eC,{player:ma,playerState:E[ma],onClose:()=>bn(null),difficulty:s}),nn&&((kn=E.actionRequired)==null?void 0:kn.type)==="prompt_rearrange_protocols"&&o.jsx(Bx,{gameState:E,targetPlayer:E.actionRequired.target,onConfirm:me=>{var xe,Pe;((xe=E.actionRequired)==null?void 0:xe.sourceCardId)==="CONTROL_MECHANIC"&&((Pe=E.actionRequired)!=null&&Pe.actor)&&C(E.actionRequired.actor),_e(me),Pt(!1)}}),Ha&&((wn=E.actionRequired)==null?void 0:wn.type)==="prompt_swap_protocols"&&o.jsx(Gx,{gameState:E,targetPlayer:E.actionRequired.target,onConfirm:me=>{oe(me),Na(!1)}}),(((Tt=E.actionRequired)==null?void 0:Tt.type)==="select_card_from_revealed_deck"||((xa=E.actionRequired)==null?void 0:xa.type)==="reveal_deck_draw_protocol")&&E.actionRequired.actor==="player"&&o.jsx(Xx,{gameState:E,onSelectCard:me=>{de(me)},onConfirmProtocolDraw:()=>{pe()}}),((Ca=E.actionRequired)==null?void 0:Ca.type)==="select_card_from_trash_to_play"&&E.actionRequired.actor==="player"&&o.jsx(Fm,{gameState:E,onSelectCard:me=>{Ge(me)}}),((mn=E.actionRequired)==null?void 0:mn.type)==="select_card_from_trash_to_reveal"&&E.actionRequired.actor==="player"&&o.jsx(Fm,{gameState:E,onSelectCard:me=>{qe(me)}}),((xn=E.actionRequired)==null?void 0:xn.type)==="prompt_optional_effect"&&E.actionRequired.actor==="player"&&o.jsx(Zx,{gameState:E,onAccept:()=>K(!0),onDecline:()=>K(!1)}),((ge=E.actionRequired)==null?void 0:ge.type)==="state_number"&&E.actionRequired.actor==="player"&&o.jsx(Yx,{gameState:E,onConfirm:me=>Se(me)}),((De=E.actionRequired)==null?void 0:De.type)==="state_protocol"&&E.actionRequired.actor==="player"&&o.jsx(Wx,{gameState:E,availableProtocols:E.actionRequired.availableProtocols||[],onConfirm:me=>Fe(me)}),((Me=E.actionRequired)==null?void 0:Me.type)==="select_from_drawn_to_reveal"&&E.actionRequired.actor==="player"&&o.jsx(Qx,{gameState:E,allDrawnCardIds:E.actionRequired.allDrawnCardIds||[],eligibleCardIds:E.actionRequired.eligibleCardIds||[],statedNumber:E.actionRequired.statedNumber,revealCount:E.actionRequired.revealCount,onConfirm:me=>je(me),onClose:()=>{je("")}}),((ot=E.actionRequired)==null?void 0:ot.type)==="confirm_deck_discard"&&E.actionRequired.actor==="player"&&o.jsx(Kx,{discardedCard:E.actionRequired.discardedCard,deckOwner:E.actionRequired.deckOwner,onConfirm:()=>Ve()}),((ze=E.actionRequired)==null?void 0:ze.type)==="confirm_deck_play_preview"&&E.actionRequired.actor==="player"&&o.jsx(Jx,{card:E.actionRequired.drawnCard,isFaceDown:E.actionRequired.isFaceDown,onConfirm:()=>He()}),o.jsx("div",{className:"toaster-container",children:tn.map(me=>o.jsx(zx,{message:me.message,player:me.player},me.id))}),Je&&o.jsx(Hx,{log:E.log,onClose:()=>Ft(!1)}),o.jsx("button",{className:"btn log-button",onClick:()=>Ft(!0),children:"Log"}),o.jsxs("div",{className:"game-screen-layout",children:[o.jsxs("div",{className:"game-preview-container",children:[o.jsx("h2",{onClick:ga,style:{cursor:"pointer",userSelect:"none"},title:"Click 5 times to toggle debug mode",children:"Mainframe"}),o.jsx(Ox,{gameState:E,turn:((Ye=E.actionRequired)==null?void 0:Ye.actor)||E.turn,animationState:E.animationState,difficulty:s,onPlayerClick:()=>bn("player"),onOpponentClick:()=>bn("opponent")}),o.jsx("div",{className:"preview-card-area",children:wa()}),o.jsx("button",{className:"btn btn-back",onClick:t,children:"Back"})]}),o.jsxs("div",{className:"game-main-area",children:[Ba&&o.jsx("div",{className:"compile-prompt-container",children:o.jsx("h3",{children:"Select a Protocol to Compile"})}),o.jsx(Lx,{gameState:E,onLanePointerDown:Mn,onPlayFaceDown:_a,selectedCardId:T,onCardPointerDown:Aa,onCardPointerEnter:$t,onCardPointerLeave:Mt,onOpponentHandCardPointerEnter:jn,onOpponentHandCardPointerLeave:Mt,sourceCardId:Ga}),o.jsxs("div",{className:"player-action-area",children:[o.jsx(Px,{gameState:E,onFillHand:D,onSkipAction:M,onResolveOptionalDrawPrompt:N,onResolveDeath1Prompt:R,onResolveLove1Prompt:$,onResolvePlague2Discard:X,onResolvePlague4Flip:G,onResolveFire3Prompt:q,onResolveOptionalDiscardCustomPrompt:Q,onResolveOptionalEffectPrompt:K,onResolveSpeed3Prompt:H,onResolveFire4Discard:Z,onResolveHate1Discard:te,onResolveLight2Prompt:ee,onResolveRevealBoardCardPrompt:se,onResolvePsychic4Prompt:ne,onResolveSpirit1Prompt:fe,onResolveSpirit3Prompt:be,onResolveControlMechanicPrompt:J,onResolveCustomChoice:ie,selectedCardId:T,multiSelectedCardIds:ut,actionRequiredClass:Fa}),o.jsx("div",{className:`player-hand-area ${Vn}`,children:E.player.hand.filter(me=>{const xe=E.actionRequired;return(xe==null?void 0:xe.type)==="select_card_from_hand_to_play"&&(xe==null?void 0:xe.selectableCardIds)?xe.selectableCardIds.includes(me.id):!0}).map(me=>{var Pe;const xe=((Pe=E.actionRequired)==null?void 0:Pe.type)==="select_lane_for_play"?me.id===E.actionRequired.cardInHandId:me.id===T;return o.jsx(St,{card:me,isFaceUp:!0,onPointerDown:()=>Da(me),onPointerEnter:()=>hn(me),isSelected:xe,isMultiSelected:ut.includes(me.id),animationState:E.animationState,additionalClassName:"in-hand"},me.id)})})]})]})]}),_&&o.jsx(tC,{onComplete:b}),ta&&o.jsx(kj,{onLoadScenario:Ne,onSkipCoinFlip:j,onForceWin:On,onForceLose:za})]})}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function Rj({onPlayAgain:t,winner:n,finalState:r,difficulty:c}){if(!r)return o.jsxs("div",{className:"screen",children:[o.jsx("h1",{children:"Loading Results..."}),o.jsx("button",{className:"btn",onClick:t,children:"Back to Menu"})]});const s=n==="player",d=(u,p)=>{let f=[u];return p&&f.push("compiled"),f.join(" ")};return o.jsx("div",{className:`screen results-screen ${s?"victory":"defeat"}`,children:o.jsxs("div",{className:"results-screen-content",children:[o.jsxs("header",{className:"results-header",children:[o.jsx("h1",{children:s?"VICTORY":"DEFEAT"}),o.jsx("p",{children:s?"System compiled successfully.":"Critical error in the mainframe."})]}),o.jsxs("div",{className:"results-body",children:[o.jsxs("div",{className:"final-score-section",children:[o.jsx("h3",{children:"Final Score"}),o.jsxs("h4",{className:"results-label results-opponent-label",children:["Opponent (",c.charAt(0).toUpperCase()+c.slice(1),")"]}),o.jsxs("div",{className:"protocol-bars-container",children:[o.jsx("div",{className:"protocol-bar opponent-bar",children:r.opponent.protocols.map((u,p)=>o.jsxs("div",{className:d("protocol-display",r.opponent.compiled[p]),children:[o.jsx("span",{className:"protocol-name",children:u}),o.jsx("span",{className:"protocol-value",children:r.opponent.laneValues[p]})]},`opp-proto-${u}-${p}`))}),o.jsx("div",{className:"protocol-bar player-bar",children:r.player.protocols.map((u,p)=>o.jsxs("div",{className:d("protocol-display",r.player.compiled[p]),children:[o.jsx("span",{className:"protocol-name",children:u}),o.jsx("span",{className:"protocol-value",children:r.player.laneValues[p]})]},`player-proto-${u}-${p}`))})]}),o.jsx("h4",{className:"results-label results-player-label",children:"Player"})]}),o.jsxs("div",{className:"stats-section",children:[o.jsx("h3",{children:"Statistics"}),o.jsxs("div",{className:"stats-grid",children:[o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-item-label",children:"Cards Played"}),o.jsx("span",{className:"stat-item-value opponent",children:r.stats.opponent.cardsPlayed}),o.jsx("span",{className:"stat-item-value player",children:r.stats.player.cardsPlayed})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-item-label",children:"Cards Drawn"}),o.jsx("span",{className:"stat-item-value opponent",children:r.stats.opponent.cardsDrawn}),o.jsx("span",{className:"stat-item-value player",children:r.stats.player.cardsDrawn})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-item-label",children:"Cards Discarded"}),o.jsx("span",{className:"stat-item-value opponent",children:r.stats.opponent.cardsDiscarded}),o.jsx("span",{className:"stat-item-value player",children:r.stats.player.cardsDiscarded})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-item-label",children:"Cards Deleted"}),o.jsx("span",{className:"stat-item-value opponent",children:r.stats.opponent.cardsDeleted}),o.jsx("span",{className:"stat-item-value player",children:r.stats.player.cardsDeleted})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-item-label",children:"Cards Flipped"}),o.jsx("span",{className:"stat-item-value opponent",children:r.stats.opponent.cardsFlipped}),o.jsx("span",{className:"stat-item-value player",children:r.stats.player.cardsFlipped})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-item-label",children:"Cards Shifted"}),o.jsx("span",{className:"stat-item-value opponent",children:r.stats.opponent.cardsShifted}),o.jsx("span",{className:"stat-item-value player",children:r.stats.player.cardsShifted})]})]})]})]}),o.jsx("button",{className:"btn",onClick:t,children:"Play Again"})]})})}function Dj({onBack:t}){const[n,r]=ce.useState(0);ce.useEffect(()=>{os(),r(b=>b+1)},[]);const c=ce.useMemo(()=>{const b=uu(),j=Xo(),k=wr(),E=new Set(k.filter(F=>sl(F)).map(F=>F.name));return j.filter(F=>E.has(F.protocol)||b)},[n]),s=ce.useMemo(()=>{const b=new Set(c.map(j=>j.protocol));return Array.from(b).sort()},[c]),[d,u]=ce.useState(null),p=ce.useMemo(()=>{const b=new Set(c.map(j=>j.category));return Array.from(b).sort()},[c]),[f,h]=ce.useState(()=>new Set(p));ce.useEffect(()=>{c.length>0&&!d&&u(c[0])},[c,d]);const _=b=>{h(j=>{const k=new Set(j);return k.has(b)?k.delete(b):k.add(b),k})},y=b=>{const j=c.find(k=>k.protocol===b);return(j==null?void 0:j.category)||""},m=ce.useMemo(()=>s.filter(b=>{const j=y(b);return f.has(j)}),[s,f,c]),g=ce.useMemo(()=>{const b={};for(const j of c)b[j.protocol]||(b[j.protocol]=[]),b[j.protocol].push(j);for(const j in b)b[j].sort((k,E)=>k.value-E.value);return b},[c]),x=b=>{u(b)},C=()=>{if(!d)return null;const b={...d,id:"preview",isFaceUp:!0};return o.jsx(St,{card:b,isFaceUp:!0})};return o.jsxs("div",{className:"screen card-library-screen",children:[o.jsx($c,{title:"Card Library",onBack:t}),o.jsxs("div",{className:"card-library-layout",children:[o.jsxs("div",{className:"game-preview-container",children:[o.jsx("h2",{children:"Card Preview"}),o.jsx("div",{className:"preview-card-area",children:C()})]}),o.jsxs("div",{className:"card-list-container",children:[o.jsx("div",{className:"category-filters",children:p.map(b=>o.jsxs("label",{className:"category-filter-item",children:[o.jsx("input",{type:"checkbox",checked:f.has(b),onChange:()=>_(b)}),o.jsx("span",{children:b})]},b))}),m.map(b=>o.jsxs("div",{className:"protocol-group",children:[o.jsxs("h3",{children:[b,o.jsxs("span",{className:"protocol-category-label",children:[" (",y(b),")"]})]}),o.jsx("div",{className:"protocol-card-grid",children:g[b].map(j=>{const k={...j,id:`${j.protocol}-${j.value}`,isFaceUp:!0};return o.jsx(St,{card:k,isFaceUp:!0,additionalClassName:"in-hand",onPointerEnter:()=>x(j),onPointerDown:()=>x(j)},k.id)})})]},b))]})]})]})}function Aj({onBack:t}){const[n,r]=ce.useState(()=>su()),[c,s]=ce.useState(!1),d=fj(n),u=hj(n),p=mj(n),f=yj(n),h=gj(n),_=vj(n),y=_j(n),[m,g]=ce.useState(null),x=()=>{sj(),r(su()),s(!1)},C=X=>{g(G=>G===X?null:X)},b=n.global.totalGamesPlayed,j=n.actions.detailedStats,k=X=>b>0?(X/b).toFixed(1):"0.0",E=(X,G)=>G>0?(X/G).toFixed(1):"0.0",T=j.cardsDrawn.playerFromRefresh+j.cardsDrawn.playerFromEffect,F=j.cardsDrawn.aiFromRefresh+j.cardsDrawn.aiFromEffect,U=T+F,D=j.cardsPlayed.playerFromHand+j.cardsPlayed.playerFromEffect,I=j.cardsPlayed.aiFromHand+j.cardsPlayed.aiFromEffect,W=D+I,z=j.compiles.playerFirstCompile+j.compiles.playerRecompile,V=j.compiles.aiFirstCompile+j.compiles.aiRecompile,B=z+V,L=j.discards.player+j.discards.ai,P=j.deletes.player+j.deletes.ai,M=j.flips.player+j.flips.ai,N=j.shifts.player+j.shifts.ai,R=j.returns.player+j.returns.ai,$=j.refreshes.player+j.refreshes.ai;return o.jsxs("div",{className:"screen statistics-screen",children:[o.jsx($c,{title:"STATISTICS",onBack:t}),o.jsxs("div",{className:"stats-content",children:[o.jsxs("section",{className:"stats-section",children:[o.jsx("h2",{className:"section-title",children:"Overview"}),o.jsxs("div",{className:"stats-grid",children:[o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Games Played"}),o.jsx("span",{className:"stat-value",children:n.global.totalGamesPlayed})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Win Rate"}),o.jsxs("span",{className:"stat-value",children:[d.toFixed(1),"%"]})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Games Won"}),o.jsx("span",{className:"stat-value win",children:n.global.totalGamesWon})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Games Lost"}),o.jsx("span",{className:"stat-value loss",children:n.global.totalGamesLost})]})]})]}),o.jsxs("section",{className:"stats-section",children:[o.jsx("h2",{className:"section-title",children:"Streaks"}),o.jsxs("div",{className:"stats-grid",children:[o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Current Streak"}),o.jsx("span",{className:`stat-value ${n.global.currentStreak>0?"win":n.global.currentStreak<0?"loss":""}`,children:n.global.currentStreak>0?`+${n.global.currentStreak}`:n.global.currentStreak})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Best Win Streak"}),o.jsx("span",{className:"stat-value win",children:n.global.longestWinStreak})]})]})]}),o.jsxs("section",{className:"stats-section",children:[o.jsx("h2",{className:"section-title",children:"Playtime"}),o.jsxs("div",{className:"stats-grid",children:[o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Total Playtime"}),o.jsx("span",{className:"stat-value",children:as(n.global.totalPlaytime)})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Average Game"}),o.jsx("span",{className:"stat-value",children:as(u)})]}),n.global.fastestWin&&o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Fastest Win"}),o.jsx("span",{className:"stat-value",children:as(n.global.fastestWin)})]}),n.global.longestGame&&o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Longest Game"}),o.jsx("span",{className:"stat-value",children:as(n.global.longestGame)})]}),n.global.lastGameDuration&&o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Last Game"}),o.jsx("span",{className:"stat-value",children:as(n.global.lastGameDuration)})]})]})]}),o.jsxs("section",{className:"stats-section",children:[o.jsx("h2",{className:"section-title",children:"AI Performance"}),o.jsx("div",{className:"ai-stats",children:["easy","normal","hard"].map(X=>{const G=n.aiDifficulty[X],q=G.played>0?G.wins/G.played*100:0;return o.jsxs("div",{className:"ai-item",children:[o.jsx("span",{className:"ai-name",children:X}),o.jsxs("span",{className:"ai-record",children:[o.jsxs("span",{className:"win",children:[G.wins,"W"]})," - ",o.jsxs("span",{className:"loss",children:[G.losses,"L"]})]}),o.jsxs("span",{className:"ai-winrate",children:["(",q.toFixed(1),"%)"]})]},X)})})]}),f.length>0&&o.jsxs("section",{className:"stats-section",children:[o.jsx("h2",{className:"section-title",children:"Best Win Rate"}),o.jsx("div",{className:"protocol-list",children:f.map((X,G)=>o.jsxs("div",{className:"protocol-item",children:[o.jsxs("span",{className:"protocol-rank",children:[G+1,"."]}),o.jsx("span",{className:"protocol-name",children:X.protocol}),o.jsxs("span",{className:"protocol-stats win",children:[X.winRate.toFixed(0),"%  ",X.timesUsed]})]},X.protocol))})]}),p.length>0&&o.jsxs("section",{className:"stats-section",children:[o.jsx("h2",{className:"section-title",children:"Favorite Protocols"}),o.jsx("div",{className:"protocol-list",children:p.map((X,G)=>o.jsxs("div",{className:"protocol-item",children:[o.jsxs("span",{className:"protocol-rank",children:[G+1,"."]}),o.jsx("span",{className:"protocol-name",children:X.protocol}),o.jsxs("span",{className:"protocol-stats",children:[X.timesUsed,"  ",X.winRate.toFixed(0),"%"]})]},X.protocol))})]}),h.length>0&&o.jsxs("section",{className:"stats-section",children:[o.jsx("h2",{className:"section-title",children:"Least Used Protocols"}),o.jsx("div",{className:"protocol-list",children:h.map((X,G)=>o.jsxs("div",{className:"protocol-item",children:[o.jsxs("span",{className:"protocol-rank",children:[G+1,"."]}),o.jsx("span",{className:"protocol-name",children:X.protocol}),o.jsxs("span",{className:"protocol-stats",children:[X.timesUsed,"  ",X.winRate.toFixed(0),"%"]})]},X.protocol))})]}),_.length>0&&o.jsxs("section",{className:"stats-section",children:[o.jsx("h2",{className:"section-title",children:"Most Played Cards"}),o.jsx("div",{className:"card-list",children:_.map((X,G)=>o.jsxs("div",{className:"card-item",children:[o.jsxs("span",{className:"card-rank",children:[G+1,"."]}),o.jsx("span",{className:"card-name",children:X.card}),o.jsxs("span",{className:"card-count",children:[X.count,""]})]},X.card))})]}),y.length>0&&o.jsxs("section",{className:"stats-section",children:[o.jsx("h2",{className:"section-title",children:"Most Deleted Cards"}),o.jsx("div",{className:"card-list",children:y.map((X,G)=>o.jsxs("div",{className:"card-item",children:[o.jsxs("span",{className:"card-rank",children:[G+1,"."]}),o.jsx("span",{className:"card-name",children:X.card}),o.jsxs("span",{className:"card-count",children:[X.count,""]})]},X.card))})]}),o.jsxs("section",{className:"stats-section",children:[o.jsx("h2",{className:"section-title",children:"Control Mechanic"}),o.jsxs("div",{className:"stats-grid",children:[o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"With Control"}),o.jsx("span",{className:"stat-value",children:n.control.gamesWithControl})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Without Control"}),o.jsx("span",{className:"stat-value",children:n.control.gamesWithoutControl})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Your Rearranges"}),o.jsx("span",{className:"stat-value",children:n.control.playerRearranges})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"AI Rearranges"}),o.jsx("span",{className:"stat-value",children:n.control.aiRearranges})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Total Rearranges"}),o.jsx("span",{className:"stat-value",children:n.control.totalRearranges})]})]})]}),o.jsxs("section",{className:"stats-section",children:[o.jsx("h2",{className:"section-title",children:"Coin Flip"}),o.jsxs("div",{className:"stats-grid",children:[o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Heads Chosen"}),o.jsxs("span",{className:"stat-value",children:[n.coinFlip.headsChosen," (",n.coinFlip.headsChosen>0?(n.coinFlip.headsWon/n.coinFlip.headsChosen*100).toFixed(0):0,"%)"]})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Tails Chosen"}),o.jsxs("span",{className:"stat-value",children:[n.coinFlip.tailsChosen," (",n.coinFlip.tailsChosen>0?(n.coinFlip.tailsWon/n.coinFlip.tailsChosen*100).toFixed(0):0,"%)"]})]})]})]}),o.jsxs("section",{className:"stats-section full-width",children:[o.jsx("h2",{className:"section-title",children:"Actions (click for details)"}),o.jsxs("div",{className:"actions-container",children:[o.jsxs("div",{className:`stat-item clickable ${m==="played"?"expanded":""}`,onClick:()=>C("played"),children:[o.jsx("span",{className:"stat-label",children:"Cards Played"}),o.jsx("span",{className:"stat-value",children:W})]}),o.jsxs("div",{className:`stat-item clickable ${m==="drawn"?"expanded":""}`,onClick:()=>C("drawn"),children:[o.jsx("span",{className:"stat-label",children:"Cards Drawn"}),o.jsx("span",{className:"stat-value",children:U})]}),o.jsxs("div",{className:`stat-item clickable ${m==="discards"?"expanded":""}`,onClick:()=>C("discards"),children:[o.jsx("span",{className:"stat-label",children:"Discards"}),o.jsx("span",{className:"stat-value",children:L})]}),o.jsxs("div",{className:`stat-item clickable ${m==="deletes"?"expanded":""}`,onClick:()=>C("deletes"),children:[o.jsx("span",{className:"stat-label",children:"Deletes"}),o.jsx("span",{className:"stat-value",children:P})]}),o.jsxs("div",{className:`stat-item clickable ${m==="flips"?"expanded":""}`,onClick:()=>C("flips"),children:[o.jsx("span",{className:"stat-label",children:"Flips"}),o.jsx("span",{className:"stat-value",children:M})]}),o.jsxs("div",{className:`stat-item clickable ${m==="shifts"?"expanded":""}`,onClick:()=>C("shifts"),children:[o.jsx("span",{className:"stat-label",children:"Shifts"}),o.jsx("span",{className:"stat-value",children:N})]}),o.jsxs("div",{className:`stat-item clickable ${m==="returns"?"expanded":""}`,onClick:()=>C("returns"),children:[o.jsx("span",{className:"stat-label",children:"Returns"}),o.jsx("span",{className:"stat-value",children:R})]}),o.jsxs("div",{className:`stat-item clickable ${m==="compiles"?"expanded":""}`,onClick:()=>C("compiles"),children:[o.jsx("span",{className:"stat-label",children:"Compiles"}),o.jsx("span",{className:"stat-value",children:B})]}),o.jsxs("div",{className:`stat-item clickable ${m==="refreshes"?"expanded":""}`,onClick:()=>C("refreshes"),children:[o.jsx("span",{className:"stat-label",children:"Refreshes"}),o.jsx("span",{className:"stat-value",children:$})]})]}),m==="played"&&o.jsxs("div",{className:"action-details-section",children:[o.jsx("h3",{className:"section-title",children:"Cards Played"}),o.jsxs("div",{className:"action-details-total",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:W})]}),o.jsxs("div",{className:"action-details-columns",children:[o.jsxs("div",{className:"action-details-column player",children:[o.jsx("div",{className:"column-header",children:"Player"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:D})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"From Hand"}),o.jsx("span",{className:"detail-value",children:j.cardsPlayed.playerFromHand})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"From Effect"}),o.jsx("span",{className:"detail-value",children:j.cardsPlayed.playerFromEffect})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Face-Up"}),o.jsx("span",{className:"detail-value",children:j.cardsPlayed.playerFaceUp})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Face-Down"}),o.jsx("span",{className:"detail-value",children:j.cardsPlayed.playerFaceDown})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:k(D)})]})]}),o.jsxs("div",{className:"action-details-column ai",children:[o.jsx("div",{className:"column-header",children:"AI"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:I})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"From Hand"}),o.jsx("span",{className:"detail-value",children:j.cardsPlayed.aiFromHand})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"From Effect"}),o.jsx("span",{className:"detail-value",children:j.cardsPlayed.aiFromEffect})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Face-Up"}),o.jsx("span",{className:"detail-value",children:j.cardsPlayed.aiFaceUp})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Face-Down"}),o.jsx("span",{className:"detail-value",children:j.cardsPlayed.aiFaceDown})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:k(I)})]})]})]})]}),m==="drawn"&&o.jsxs("div",{className:"action-details-section",children:[o.jsx("h3",{className:"section-title",children:"Cards Drawn"}),o.jsxs("div",{className:"action-details-total",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:U})]}),o.jsxs("div",{className:"action-details-columns",children:[o.jsxs("div",{className:"action-details-column player",children:[o.jsx("div",{className:"column-header",children:"Player"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:T})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"From Refresh"}),o.jsx("span",{className:"detail-value",children:j.cardsDrawn.playerFromRefresh})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"From Effect"}),o.jsx("span",{className:"detail-value",children:j.cardsDrawn.playerFromEffect})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:k(T)})]})]}),o.jsxs("div",{className:"action-details-column ai",children:[o.jsx("div",{className:"column-header",children:"AI"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:F})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"From Refresh"}),o.jsx("span",{className:"detail-value",children:j.cardsDrawn.aiFromRefresh})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"From Effect"}),o.jsx("span",{className:"detail-value",children:j.cardsDrawn.aiFromEffect})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:k(F)})]})]})]})]}),m==="discards"&&o.jsxs("div",{className:"action-details-section",children:[o.jsx("h3",{className:"section-title",children:"Discards"}),o.jsxs("div",{className:"action-details-total",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:L})]}),o.jsxs("div",{className:"action-details-columns",children:[o.jsxs("div",{className:"action-details-column player",children:[o.jsx("div",{className:"column-header",children:"Player"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:j.discards.player})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:k(j.discards.player)})]})]}),o.jsxs("div",{className:"action-details-column ai",children:[o.jsx("div",{className:"column-header",children:"AI"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:j.discards.ai})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:k(j.discards.ai)})]})]})]})]}),m==="deletes"&&o.jsxs("div",{className:"action-details-section",children:[o.jsx("h3",{className:"section-title",children:"Deletes"}),o.jsxs("div",{className:"action-details-total",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:P})]}),o.jsxs("div",{className:"action-details-columns",children:[o.jsxs("div",{className:"action-details-column player",children:[o.jsx("div",{className:"column-header",children:"Player"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:j.deletes.player})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:k(j.deletes.player)})]})]}),o.jsxs("div",{className:"action-details-column ai",children:[o.jsx("div",{className:"column-header",children:"AI"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:j.deletes.ai})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:k(j.deletes.ai)})]})]})]})]}),m==="flips"&&o.jsxs("div",{className:"action-details-section",children:[o.jsx("h3",{className:"section-title",children:"Flips"}),o.jsxs("div",{className:"action-details-total",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:M})]}),o.jsxs("div",{className:"action-details-columns",children:[o.jsxs("div",{className:"action-details-column player",children:[o.jsx("div",{className:"column-header",children:"Player"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:j.flips.player})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:k(j.flips.player)})]})]}),o.jsxs("div",{className:"action-details-column ai",children:[o.jsx("div",{className:"column-header",children:"AI"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:j.flips.ai})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:k(j.flips.ai)})]})]})]})]}),m==="shifts"&&o.jsxs("div",{className:"action-details-section",children:[o.jsx("h3",{className:"section-title",children:"Shifts"}),o.jsxs("div",{className:"action-details-total",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:N})]}),o.jsxs("div",{className:"action-details-columns",children:[o.jsxs("div",{className:"action-details-column player",children:[o.jsx("div",{className:"column-header",children:"Player"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:j.shifts.player})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:k(j.shifts.player)})]})]}),o.jsxs("div",{className:"action-details-column ai",children:[o.jsx("div",{className:"column-header",children:"AI"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:j.shifts.ai})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:k(j.shifts.ai)})]})]})]})]}),m==="returns"&&o.jsxs("div",{className:"action-details-section",children:[o.jsx("h3",{className:"section-title",children:"Returns"}),o.jsxs("div",{className:"action-details-total",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:R})]}),o.jsxs("div",{className:"action-details-columns",children:[o.jsxs("div",{className:"action-details-column player",children:[o.jsx("div",{className:"column-header",children:"Player"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:j.returns.player})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:k(j.returns.player)})]})]}),o.jsxs("div",{className:"action-details-column ai",children:[o.jsx("div",{className:"column-header",children:"AI"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:j.returns.ai})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:k(j.returns.ai)})]})]})]})]}),m==="compiles"&&o.jsxs("div",{className:"action-details-section",children:[o.jsx("h3",{className:"section-title",children:"Compiles"}),o.jsxs("div",{className:"action-details-total",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:B})]}),o.jsxs("div",{className:"action-details-columns",children:[o.jsxs("div",{className:"action-details-column player",children:[o.jsx("div",{className:"column-header",children:"Player"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:z})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"First-Compile"}),o.jsx("span",{className:"detail-value",children:j.compiles.playerFirstCompile})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Re-Compile"}),o.jsx("span",{className:"detail-value",children:j.compiles.playerRecompile})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:k(z)})]})]}),o.jsxs("div",{className:"action-details-column ai",children:[o.jsx("div",{className:"column-header",children:"AI"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:V})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"First-Compile"}),o.jsx("span",{className:"detail-value",children:j.compiles.aiFirstCompile})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Re-Compile"}),o.jsx("span",{className:"detail-value",children:j.compiles.aiRecompile})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:k(V)})]})]})]})]}),m==="refreshes"&&o.jsxs("div",{className:"action-details-section",children:[o.jsx("h3",{className:"section-title",children:"Refreshes"}),o.jsxs("div",{className:"action-details-total",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:$})]}),o.jsxs("div",{className:"action-details-columns",children:[o.jsxs("div",{className:"action-details-column player",children:[o.jsx("div",{className:"column-header",children:"Player"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:j.refreshes.player})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Cards / Refresh"}),o.jsx("span",{className:"detail-value",children:E(j.refreshes.playerCardsDrawn,j.refreshes.player)})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:k(j.refreshes.player)})]})]}),o.jsxs("div",{className:"action-details-column ai",children:[o.jsx("div",{className:"column-header",children:"AI"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:j.refreshes.ai})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Cards / Refresh"}),o.jsx("span",{className:"detail-value",children:E(j.refreshes.aiCardsDrawn,j.refreshes.ai)})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:k(j.refreshes.ai)})]})]})]})]})]}),o.jsx("section",{className:"stats-section reset-section",children:o.jsx("button",{className:"reset-stats-button",onClick:()=>s(!0),children:"Reset All Statistics"})})]}),c&&o.jsx("div",{className:"reset-modal-overlay",onClick:()=>s(!1),children:o.jsxs("div",{className:"reset-modal",onClick:X=>X.stopPropagation(),children:[o.jsx("h3",{children:"Reset Statistics?"}),o.jsx("p",{children:"This will permanently delete all your statistics. This action cannot be undone."}),o.jsxs("div",{className:"reset-modal-buttons",children:[o.jsx("button",{className:"cancel-button",onClick:()=>s(!1),children:"Cancel"}),o.jsx("button",{className:"confirm-reset-button",onClick:x,children:"Reset"})]})]})})]})}const At=({title:t,defaultOpen:n=!1,forceOpen:r=!1,children:c})=>{const[s,d]=ce.useState(n||r),u=r||s;return o.jsxs("div",{className:"collapsible-section",children:[o.jsxs("button",{type:"button",className:`collapsible-header ${u?"open":""}`,onClick:()=>d(!s),children:[o.jsx("span",{className:"collapsible-arrow",children:u?"":""}),t]}),u&&o.jsx("div",{className:"collapsible-content",children:c})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Lc=({filter:t,onChange:n,showOwner:r=!0,showPosition:c=!0,showFaceState:s=!0,showExcludeSelf:d=!1,positionOptions:u})=>{const f=u||[{value:"any",label:"Any"},{value:"uncovered",label:"Uncovered"},{value:"covered",label:"Covered"}];return o.jsxs(o.Fragment,{children:[r&&o.jsxs("label",{children:["Owner",o.jsxs("select",{value:t.owner||"any",onChange:h=>{const _=h.target.value,y={...t};_==="any"?delete y.owner:y.owner=_,n(y)},children:[o.jsx("option",{value:"any",children:"Any"}),o.jsx("option",{value:"own",children:"Own"}),o.jsx("option",{value:"opponent",children:"Opponent"})]})]}),c&&o.jsxs("label",{children:["Position",o.jsx("select",{value:t.position||"uncovered",onChange:h=>n({...t,position:h.target.value}),children:f.map(h=>o.jsx("option",{value:h.value,children:h.label},h.value))})]}),s&&o.jsxs("label",{children:["Face State",o.jsxs("select",{value:t.faceState||"any",onChange:h=>n({...t,faceState:h.target.value}),children:[o.jsx("option",{value:"any",children:"Any"}),o.jsx("option",{value:"face_up",children:"Face-up"}),o.jsx("option",{value:"face_down",children:"Face-down"})]})]}),d&&o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:t.excludeSelf||!1,onChange:h=>n({...t,excludeSelf:h.target.checked})}),"Exclude self"]})]})},Fj=["none","empty_hand","opponent_higher_value_in_lane","this_card_is_covered"],$j={none:"None",empty_hand:"Only if hand is empty",opponent_higher_value_in_lane:"Only if opponent has higher value in lane",this_card_is_covered:"Only if this card is covered",protocol_match:"Only in lane with specific protocol",hand_size_greater_than:"Only if hand size greater than...",same_protocol_on_field:"Only if same protocol card on field (Unity)",compile_block:"Block opponent compile next turn",trash_not_empty:"Only if trash is not empty"},Pc=({conditional:t,onChange:n,availableTypes:r=Fj,showProtocolInput:c=!1,showThresholdInput:s=!1,showTurnDuration:d=!1})=>{const u=(t==null?void 0:t.type)||"none",p=u!=="none",f=h=>{n(h==="none"?void 0:{...t,type:h})};return o.jsxs(At,{title:"Conditionals",forceOpen:p,children:[o.jsxs("div",{className:"filter-row",children:[o.jsxs("label",{children:["Condition",o.jsx("select",{value:u,onChange:h=>f(h.target.value),children:r.map(h=>o.jsx("option",{value:h,children:$j[h||"none"]},h))})]}),u==="protocol_match"&&c&&o.jsxs("label",{children:["Protocol",o.jsx("input",{type:"text",value:(t==null?void 0:t.protocol)||"",onChange:h=>n({...t,type:"protocol_match",protocol:h.target.value}),placeholder:"e.g., Fire, Water..."})]}),u==="hand_size_greater_than"&&s&&o.jsxs("label",{children:["Threshold",o.jsx("input",{type:"number",min:0,max:10,value:(t==null?void 0:t.threshold)||0,onChange:h=>n({...t,type:"hand_size_greater_than",threshold:parseInt(h.target.value)})})]}),u==="compile_block"&&d&&o.jsxs("label",{children:["Turns",o.jsxs("select",{value:(t==null?void 0:t.turnDuration)||1,onChange:h=>n({...t,type:"compile_block",turnDuration:parseInt(h.target.value)}),children:[o.jsx("option",{value:1,children:"1 turn"}),o.jsx("option",{value:2,children:"2 turns"}),o.jsx("option",{value:3,children:"3 turns"})]})]})]}),u!=="none"&&o.jsx("small",{className:"hint-text",children:"Effect only triggers when condition is met"})]})},vv=({params:t,onChange:n})=>{var p,f,h,_,y,m,g,x,C,b,j,k;const r=t.countType||"fixed",c=t.revealFromDrawn!==void 0,s=t.valueFilter!==void 0,d=((p=t.conditional)==null?void 0:p.type)||((f=t.advancedConditional)==null?void 0:f.type),u=((h=t.protocolFilter)==null?void 0:h.type)==="same_as_source";return o.jsxs("div",{className:"param-editor draw-effect-editor",children:[o.jsx("h4",{children:"Draw Effect"}),o.jsxs("div",{className:"effect-editor-basic",children:[o.jsxs("label",{children:["Count Type",o.jsxs("select",{value:r,onChange:E=>{const T=E.target.value;n({...t,countType:T,countOffset:T==="equal_to_discarded"?0:void 0})},children:[o.jsx("option",{value:"fixed",children:"Fixed"}),o.jsx("option",{value:"equal_to_card_value",children:"Card Value"}),o.jsx("option",{value:"equal_to_discarded",children:"Discarded Count"}),o.jsx("option",{value:"hand_size",children:"Hand Size"}),o.jsx("option",{value:"count_own_protocol_cards_on_field",children:"Same Protocol (Unity)"})]})]}),r==="fixed"&&o.jsxs("label",{children:["Count",o.jsx("select",{value:t.count,onChange:E=>n({...t,count:parseInt(E.target.value)||1}),children:[1,2,3,4,5,6].map(E=>o.jsx("option",{value:E,children:E},E))})]}),r==="equal_to_discarded"&&o.jsxs("label",{children:["Offset",o.jsx("input",{type:"number",min:-5,max:5,value:t.countOffset||0,onChange:E=>n({...t,countOffset:parseInt(E.target.value)||0})})]}),o.jsxs("label",{children:["Target",o.jsxs("select",{value:t.target,onChange:E=>n({...t,target:E.target.value}),children:[o.jsx("option",{value:"self",children:"Self"}),o.jsx("option",{value:"opponent",children:"Opponent"})]})]}),o.jsxs("label",{children:["Source",o.jsxs("select",{value:t.source,onChange:E=>n({...t,source:E.target.value}),children:[o.jsx("option",{value:"own_deck",children:"Own Deck"}),o.jsx("option",{value:"opponent_deck",children:"Opponent's Deck"})]})]})]}),o.jsxs("div",{className:"effect-editor-basic",children:[o.jsxs("label",{className:"checkbox-label",children:[o.jsx("input",{type:"checkbox",checked:t.preAction==="refresh",onChange:E=>n({...t,preAction:E.target.checked?"refresh":void 0})}),"Refresh first"]}),o.jsxs("label",{className:"checkbox-label",children:[o.jsx("input",{type:"checkbox",checked:t.optional||!1,onChange:E=>n({...t,optional:E.target.checked})}),"Optional"]})]}),o.jsxs(At,{title:"Reveal from Drawn",forceOpen:c,children:[o.jsxs("label",{className:"checkbox-label",children:[o.jsx("input",{type:"checkbox",checked:c,onChange:E=>{if(E.target.checked)n({...t,revealFromDrawn:{valueSource:"stated_number"}});else{const{revealFromDrawn:T,...F}=t;n(F)}}}),"Enable reveal from drawn cards"]}),c&&o.jsxs("div",{className:"filter-row",children:[o.jsxs("label",{children:["Reveal Count",o.jsxs("select",{value:((_=t.revealFromDrawn)==null?void 0:_.count)==="all"?"all":(((y=t.revealFromDrawn)==null?void 0:y.count)||1).toString(),onChange:E=>{const T=E.target.value;n({...t,revealFromDrawn:{...t.revealFromDrawn,count:T==="all"?"all":parseInt(T)}})},children:[o.jsx("option",{value:"1",children:"1"}),o.jsx("option",{value:"2",children:"2"}),o.jsx("option",{value:"3",children:"3"}),o.jsx("option",{value:"all",children:"All"})]})]}),o.jsxs("label",{children:["Value Filter",o.jsxs("select",{value:((m=t.revealFromDrawn)==null?void 0:m.valueSource)||"stated_number",onChange:E=>n({...t,revealFromDrawn:{...t.revealFromDrawn,valueSource:E.target.value}}),children:[o.jsx("option",{value:"stated_number",children:"Stated Number"}),o.jsx("option",{value:"any",children:"Any"})]})]}),o.jsxs("label",{children:["After Reveal",o.jsxs("select",{value:((g=t.revealFromDrawn)==null?void 0:g.thenAction)||"",onChange:E=>{if(E.target.value===""){const{thenAction:T,...F}=t.revealFromDrawn;n({...t,revealFromDrawn:F})}else n({...t,revealFromDrawn:{...t.revealFromDrawn,thenAction:E.target.value}})},children:[o.jsx("option",{value:"",children:"None"}),o.jsx("option",{value:"may_play",children:"May Play"})]})]})]})]}),o.jsxs(At,{title:"Draw Specific Value",forceOpen:s,children:[o.jsxs("label",{className:"checkbox-label",children:[o.jsx("input",{type:"checkbox",checked:s,onChange:E=>{if(E.target.checked)n({...t,valueFilter:{equals:1}});else{const{valueFilter:T,...F}=t;n(F)}}}),"Draw specific value only"]}),s&&o.jsxs("div",{className:"filter-row",children:[o.jsxs("label",{children:["Card Value",o.jsx("select",{value:((x=t.valueFilter)==null?void 0:x.equals)??1,onChange:E=>n({...t,valueFilter:{equals:parseInt(E.target.value)||0}}),children:[0,1,2,3,4,5].map(E=>o.jsx("option",{value:E,children:E},E))})]}),o.jsxs("label",{className:"checkbox-label",children:[o.jsx("input",{type:"checkbox",checked:t.fromRevealed||!1,onChange:E=>n({...t,fromRevealed:E.target.checked})}),"From revealed"]})]})]}),o.jsxs(At,{title:"Conditionals",forceOpen:d,children:[o.jsxs("div",{className:"filter-row",children:[o.jsxs("label",{children:["Basic Conditional",o.jsxs("select",{value:((C=t.conditional)==null?void 0:C.type)||"none",onChange:E=>{if(E.target.value==="none"){const{conditional:T,...F}=t;n(F)}else n({...t,conditional:{type:E.target.value}})},children:[o.jsx("option",{value:"none",children:"None"}),o.jsx("option",{value:"count_face_down",children:"1 per face-down"}),o.jsx("option",{value:"is_covering",children:"If covering"}),o.jsx("option",{value:"non_matching_protocols",children:"1 per non-matching"})]})]}),o.jsxs("label",{children:["Advanced",o.jsxs("select",{value:((b=t.advancedConditional)==null?void 0:b.type)||"none",onChange:E=>{if(E.target.value==="none"){const{advancedConditional:T,...F}=t;n(F)}else E.target.value==="protocol_match"?n({...t,advancedConditional:{type:"protocol_match",protocol:""}}):E.target.value==="compile_block"?n({...t,advancedConditional:{type:"compile_block",turnDuration:1}}):n({...t,advancedConditional:{type:E.target.value}})},children:[o.jsx("option",{value:"none",children:"None"}),o.jsx("option",{value:"protocol_match",children:"Protocol match"}),o.jsx("option",{value:"compile_block",children:"Block compile"}),o.jsx("option",{value:"empty_hand",children:"Empty hand"}),o.jsx("option",{value:"opponent_higher_value_in_lane",children:"Opponent higher"}),o.jsx("option",{value:"same_protocol_on_field",children:"Same protocol (Unity)"})]})]})]}),((j=t.advancedConditional)==null?void 0:j.type)==="protocol_match"&&o.jsxs("label",{children:["Protocol",o.jsx("input",{type:"text",placeholder:"e.g., Fire",value:t.advancedConditional.protocol||"",onChange:E=>n({...t,advancedConditional:{...t.advancedConditional,type:"protocol_match",protocol:E.target.value}})})]}),((k=t.advancedConditional)==null?void 0:k.type)==="compile_block"&&o.jsxs("label",{children:["Block Duration",o.jsxs("select",{value:t.advancedConditional.turnDuration||1,onChange:E=>n({...t,advancedConditional:{...t.advancedConditional,type:"compile_block",turnDuration:parseInt(E.target.value)||1}}),children:[o.jsx("option",{value:1,children:"1 turn"}),o.jsx("option",{value:2,children:"2 turns"}),o.jsx("option",{value:3,children:"3 turns"})]})]})]}),o.jsx(At,{title:"Special Options",forceOpen:u,children:o.jsxs("label",{className:"checkbox-label",children:[o.jsx("input",{type:"checkbox",checked:u,onChange:E=>{if(E.target.checked)n({...t,protocolFilter:{type:"same_as_source"}});else{const{protocolFilter:T,...F}=t;n(F)}}}),"Draw all same-protocol cards (Unity-4)"]})})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Ij=({params:t,onChange:n})=>o.jsxs("div",{className:"param-editor refresh-effect-editor",children:[o.jsx("h4",{children:"Refresh Effect"}),o.jsx("small",{className:"hint-text",children:'Refresh fills the hand to 5 cards (Spirit-0: "Refresh.")'}),o.jsx("div",{className:"effect-editor-basic",children:o.jsxs("label",{children:["Target",o.jsxs("select",{value:t.target||"self",onChange:r=>n({...t,target:r.target.value}),children:[o.jsx("option",{value:"self",children:"Self"}),o.jsx("option",{value:"opponent",children:"Opponent"})]})]})})]});/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const qj=({params:t,onChange:n})=>o.jsxs("div",{className:"param-editor mutual-draw-effect-editor",children:[o.jsx("h4",{children:"Mutual Draw Effect"}),o.jsx("small",{className:"hint-text",children:`Both players draw from each other's decks (Chaos-0: "Draw the top card of your opponent's deck. Your opponent draws the top card of your deck.")`}),o.jsx("div",{className:"effect-editor-basic",children:o.jsxs("label",{children:["Count",o.jsx("input",{type:"number",min:"1",max:"10",value:t.count||1,onChange:r=>n({...t,count:parseInt(r.target.value)||1})})]})})]}),_v=({params:t,onChange:n})=>{var p,f,h,_;const r=t.targetFilter||{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1},c=t.count??1,s=r.owner!=="any"||r.position!=="uncovered"||r.faceState!=="any"||r.excludeSelf||r.valueMinGreaterThanHandSize||r.valueLessThanUniqueProtocolsOnField,d=t.flipSelf||t.selfFlipAfter||t.skipMiddleCommand||t.sameLaneAsFirst,u=!!((p=t.advancedConditional)!=null&&p.type);return typeof c=="number"&&t.scope&&t.scope!=="any"||c==="each"&&t.eachLineScope,o.jsxs("div",{className:"param-editor flip-effect-editor",children:[o.jsx("h4",{children:"Flip Effect"}),o.jsxs("div",{className:"effect-editor-basic",children:[o.jsxs("label",{children:["Count",o.jsxs("select",{value:c==="all"?"all":c==="each"?"each":c.toString(),onChange:y=>{const m=y.target.value;n(m==="all"?{...t,count:"all"}:m==="each"?{...t,count:"each"}:{...t,count:parseInt(m)})},children:[o.jsx("option",{value:"1",children:"1"}),o.jsx("option",{value:"2",children:"2"}),o.jsx("option",{value:"3",children:"3"}),o.jsx("option",{value:"all",children:"All"}),o.jsx("option",{value:"each",children:"Each"})]})]}),typeof c=="number"&&o.jsxs("label",{children:["Scope",o.jsxs("select",{value:t.scope||"any",onChange:y=>n({...t,scope:y.target.value}),children:[o.jsx("option",{value:"any",children:"Any lane"}),o.jsx("option",{value:"this_lane",children:"This lane only"}),o.jsx("option",{value:"each_lane",children:"Each lane"})]})]}),c==="each"&&o.jsxs("label",{children:["Each Scope",o.jsxs("select",{value:t.eachLineScope||"all_lines",onChange:y=>n({...t,eachLineScope:y.target.value}),children:[o.jsx("option",{value:"all_lines",children:"Each on board"}),o.jsx("option",{value:"each_line",children:"1 per lane"})]})]}),o.jsxs("label",{className:"checkbox-label",children:[o.jsx("input",{type:"checkbox",checked:t.optional,onChange:y=>n({...t,optional:y.target.checked})}),"Optional"]})]}),o.jsxs(At,{title:"Target Filter",forceOpen:s,children:[o.jsx(Lc,{filter:r,onChange:y=>n({...t,targetFilter:{...r,...y}}),showOwner:!0,showPosition:!0,showFaceState:!0,showExcludeSelf:!0,positionOptions:[{value:"any",label:"Any"},{value:"uncovered",label:"Uncovered"},{value:"covered",label:"Covered"},{value:"covered_in_this_line",label:"Covered in this line"}]}),o.jsxs("div",{className:"filter-row",children:[o.jsxs("label",{className:"checkbox-label",children:[o.jsx("input",{type:"checkbox",checked:r.valueMinGreaterThanHandSize||!1,onChange:y=>n({...t,targetFilter:{...r,valueMinGreaterThanHandSize:y.target.checked}})}),"Value > hand size"]}),o.jsxs("label",{className:"checkbox-label",children:[o.jsx("input",{type:"checkbox",checked:r.valueLessThanUniqueProtocolsOnField||!1,onChange:y=>n({...t,targetFilter:{...r,valueLessThanUniqueProtocolsOnField:y.target.checked}})}),"Value < protocol count"]})]})]}),o.jsxs(At,{title:"Advanced Options",forceOpen:d,children:[o.jsxs("div",{className:"filter-row",children:[o.jsxs("label",{className:"checkbox-label",children:[o.jsx("input",{type:"checkbox",checked:t.flipSelf||!1,onChange:y=>n({...t,flipSelf:y.target.checked})}),"Flip ONLY this card"]}),o.jsxs("label",{className:"checkbox-label",children:[o.jsx("input",{type:"checkbox",checked:t.selfFlipAfter||!1,onChange:y=>n({...t,selfFlipAfter:y.target.checked})}),"Also flip this card after"]})]}),o.jsxs("div",{className:"filter-row",children:[o.jsxs("label",{className:"checkbox-label",children:[o.jsx("input",{type:"checkbox",checked:t.skipMiddleCommand||!1,onChange:y=>n({...t,skipMiddleCommand:y.target.checked})}),"Skip middle command"]}),o.jsxs("label",{className:"checkbox-label",children:[o.jsx("input",{type:"checkbox",checked:t.sameLaneAsFirst||!1,onChange:y=>n({...t,sameLaneAsFirst:y.target.checked})}),"Same lane as first flip"]})]})]}),o.jsx(At,{title:"Conditionals",forceOpen:u,children:o.jsxs("div",{className:"filter-row",children:[o.jsxs("label",{children:["Condition",o.jsxs("select",{value:((f=t.advancedConditional)==null?void 0:f.type)||"",onChange:y=>{if(y.target.value===""){const{advancedConditional:m,...g}=t;n(g)}else y.target.value==="protocol_match"?n({...t,advancedConditional:{type:"protocol_match",protocol:""}}):y.target.value==="hand_size_greater_than"?n({...t,advancedConditional:{type:"hand_size_greater_than",threshold:1}}):n({...t,advancedConditional:{type:y.target.value}})},children:[o.jsx("option",{value:"",children:"None"}),o.jsx("option",{value:"protocol_match",children:"In specific protocol lane"}),o.jsx("option",{value:"opponent_higher_value_in_lane",children:"Opponent higher value"}),o.jsx("option",{value:"hand_size_greater_than",children:"Hand size greater than"}),o.jsx("option",{value:"same_protocol_on_field",children:"Same protocol on field (Unity)"}),o.jsx("option",{value:"this_card_is_covered",children:"This card is covered"})]})]}),((h=t.advancedConditional)==null?void 0:h.type)==="protocol_match"&&o.jsxs("label",{children:["Protocol",o.jsx("input",{type:"text",value:t.advancedConditional.protocol||"",onChange:y=>n({...t,advancedConditional:{...t.advancedConditional,protocol:y.target.value}}),placeholder:"e.g., Fire"})]}),((_=t.advancedConditional)==null?void 0:_.type)==="hand_size_greater_than"&&o.jsxs("label",{children:["Threshold",o.jsx("input",{type:"number",min:"0",max:"10",value:t.advancedConditional.threshold??1,onChange:y=>n({...t,advancedConditional:{...t.advancedConditional,threshold:parseInt(y.target.value)||0}})})]})]})})]})},wv=({params:t,onChange:n})=>{var d,u,p;const r=t.targetFilter||{owner:"any",position:"uncovered",faceState:"any"},c=r.owner!=="any"||r.position!=="uncovered"||r.faceState!=="any"||r.excludeSelf,s=((d=t.destinationRestriction)==null?void 0:d.type)!=="any"&&((u=t.destinationRestriction)==null?void 0:u.type)||t.scope&&t.scope!=="any";return o.jsxs("div",{className:"param-editor shift-effect-editor",children:[o.jsx("h4",{children:"Shift Effect"}),o.jsxs("div",{className:"effect-editor-basic",children:[o.jsxs("label",{children:["Count",o.jsxs("select",{value:t.count==="all"?"all":"1",onChange:f=>{if(f.target.value==="all")n({...t,count:"all"});else{const{count:h,..._}=t;n(_)}},children:[o.jsx("option",{value:"1",children:"1 card"}),o.jsx("option",{value:"all",children:"All matching"})]})]}),o.jsxs("label",{className:"checkbox-label",children:[o.jsx("input",{type:"checkbox",checked:t.optional||!1,onChange:f=>n({...t,optional:f.target.checked})}),"Optional"]}),o.jsxs("label",{className:"checkbox-label",children:[o.jsx("input",{type:"checkbox",checked:t.shiftSelf||!1,onChange:f=>n({...t,shiftSelf:f.target.checked})}),"Shift this card"]})]}),o.jsx(At,{title:"Target Filter",forceOpen:c,children:o.jsx(Lc,{filter:r,onChange:f=>n({...t,targetFilter:{...r,...f}}),showOwner:!0,showPosition:!0,showFaceState:!0,showExcludeSelf:!0})}),o.jsx(At,{title:"Scope & Destination",forceOpen:s,children:o.jsxs("div",{className:"filter-row",children:[o.jsxs("label",{children:["Source Scope",o.jsxs("select",{value:t.scope||"any",onChange:f=>{if(f.target.value==="any"){const{scope:h,..._}=t;n(_)}else n({...t,scope:f.target.value})},children:[o.jsx("option",{value:"any",children:"Any lane"}),o.jsx("option",{value:"this_lane",children:"This lane only"}),o.jsx("option",{value:"each_lane",children:"Each lane"})]})]}),o.jsxs("label",{children:["Destination",o.jsxs("select",{value:((p=t.destinationRestriction)==null?void 0:p.type)||"any",onChange:f=>{if(f.target.value==="any"){const{destinationRestriction:h,..._}=t;n(_)}else n({...t,destinationRestriction:{type:f.target.value}})},children:[o.jsx("option",{value:"any",children:"Any lane"}),o.jsx("option",{value:"to_another_line",children:"To another lane"}),o.jsx("option",{value:"non_matching_protocol",children:"Non-matching protocol"}),o.jsx("option",{value:"specific_lane",children:"This lane (within)"}),o.jsx("option",{value:"to_this_lane",children:"To THIS lane only"}),o.jsx("option",{value:"to_or_from_this_lane",children:"To OR from this lane"}),o.jsx("option",{value:"opponent_highest_value_lane",children:"Opponent's highest value lane"})]})]})]})}),o.jsx(Pc,{conditional:t.advancedConditional,onChange:f=>{if(f)n({...t,advancedConditional:f});else{const{advancedConditional:h,..._}=t;n(_)}},availableTypes:["none","empty_hand","opponent_higher_value_in_lane","this_card_is_covered"]})]})},xv=({params:t,onChange:n})=>{var p,f,h,_,y,m,g,x;const r=t.targetFilter||{position:"uncovered",faceState:"any"},c=r.position!=="uncovered"||r.faceState!=="any"||r.owner||r.calculation||r.valueRange||r.valueSource,s=((p=t.scope)==null?void 0:p.type)&&t.scope.type!=="any",d=((f=t.laneCondition)==null?void 0:f.type)||t.selectLane,u=t.deleteSelf;return o.jsxs("div",{className:"param-editor delete-effect-editor",children:[o.jsx("h4",{children:"Delete Effect"}),o.jsxs("div",{className:"effect-editor-basic",children:[o.jsxs("label",{children:["Count",o.jsxs("select",{value:typeof t.count=="number"?t.count.toString():"all",onChange:C=>n({...t,count:C.target.value==="all"?"all_in_lane":parseInt(C.target.value)}),children:[o.jsx("option",{value:"1",children:"1"}),o.jsx("option",{value:"2",children:"2"}),o.jsx("option",{value:"3",children:"3"}),o.jsx("option",{value:"all",children:"All in lane"})]})]}),o.jsxs("label",{className:"checkbox-label",children:[o.jsx("input",{type:"checkbox",checked:t.excludeSelf,onChange:C=>n({...t,excludeSelf:C.target.checked})}),"Exclude self"]}),o.jsxs("label",{className:"checkbox-label",children:[o.jsx("input",{type:"checkbox",checked:t.deleteSelf||!1,onChange:C=>n({...t,deleteSelf:C.target.checked})}),"Delete this card"]})]}),u&&o.jsx(At,{title:"Delete Self Condition",forceOpen:!!t.protocolCountConditional,children:o.jsxs("label",{children:["Protocol Count",o.jsxs("select",{value:((h=t.protocolCountConditional)==null?void 0:h.threshold)||"none",onChange:C=>{const b=C.target.value;if(b==="none"){const{protocolCountConditional:j,...k}=t;n(k)}else n({...t,protocolCountConditional:{type:"unique_protocols_on_field_below",threshold:parseInt(b)}})},children:[o.jsx("option",{value:"none",children:"Always delete"}),o.jsx("option",{value:"2",children:"If < 2 protocols"}),o.jsx("option",{value:"3",children:"If < 3 protocols"}),o.jsx("option",{value:"4",children:"If < 4 protocols"}),o.jsx("option",{value:"5",children:"If < 5 protocols"}),o.jsx("option",{value:"6",children:"If < 6 protocols"})]})]})}),o.jsxs(At,{title:"Target Filter",forceOpen:c,children:[o.jsx(Lc,{filter:r,onChange:C=>n({...t,targetFilter:{...r,...C}}),showOwner:!0,showPosition:!0,showFaceState:!0}),o.jsxs("div",{className:"filter-row",children:[o.jsxs("label",{children:["Calculation",o.jsxs("select",{value:r.calculation||"none",onChange:C=>{const b=C.target.value,j={...r};b==="none"?delete j.calculation:j.calculation=b,n({...t,targetFilter:j})},children:[o.jsx("option",{value:"none",children:"None"}),o.jsx("option",{value:"highest_value",children:"Highest value"}),o.jsx("option",{value:"lowest_value",children:"Lowest value"})]})]}),o.jsxs("label",{children:["Value Range",o.jsxs("select",{value:r.valueRange?`${r.valueRange.min}-${r.valueRange.max}`:"none",onChange:C=>{const b=C.target.value,j={...r};b==="none"?delete j.valueRange:b==="0-1"?j.valueRange={min:0,max:1}:b==="1-2"?j.valueRange={min:1,max:2}:b==="0-0"&&(j.valueRange={min:0,max:0}),n({...t,targetFilter:j})},children:[o.jsx("option",{value:"none",children:"Any value"}),o.jsx("option",{value:"0-0",children:"Value 0 only"}),o.jsx("option",{value:"0-1",children:"Values 0-1"}),o.jsx("option",{value:"1-2",children:"Values 1-2"})]})]}),o.jsxs("label",{children:["Value Source",o.jsxs("select",{value:r.valueSource||"none",onChange:C=>{const b=C.target.value,j={...r};b==="none"?delete j.valueSource:j.valueSource=b,n({...t,targetFilter:j})},children:[o.jsx("option",{value:"none",children:"None"}),o.jsx("option",{value:"previous_effect_card",children:"Previous effect card"})]})]})]})]}),o.jsx(At,{title:"Scope",forceOpen:s,children:o.jsxs("div",{className:"filter-row",children:[o.jsxs("label",{children:["Lane Scope",o.jsxs("select",{value:((_=t.scope)==null?void 0:_.type)||"any",onChange:C=>{const b=C.target.value;if(b==="any"){const{scope:j,...k}=t;n(k)}else n({...t,scope:{type:b}})},children:[o.jsx("option",{value:"any",children:"Any lane"}),o.jsx("option",{value:"this_line",children:"This lane only"}),o.jsx("option",{value:"other_lanes",children:"Other lanes"}),o.jsx("option",{value:"each_other_line",children:"Each other lane"}),o.jsx("option",{value:"each_lane",children:"Each lane"})]})]}),(((y=t.scope)==null?void 0:y.type)==="other_lanes"||((m=t.scope)==null?void 0:m.type)==="any")&&o.jsxs("label",{children:["Min Cards",o.jsxs("select",{value:((g=t.scope)==null?void 0:g.minCardsInLane)||0,onChange:C=>{const b=parseInt(C.target.value);if(b===0){const j={...t.scope};delete j.minCardsInLane,n({...t,scope:j})}else n({...t,scope:{...t.scope,minCardsInLane:b}})},children:[o.jsx("option",{value:0,children:"No minimum"}),o.jsx("option",{value:4,children:"4+ cards"}),o.jsx("option",{value:6,children:"6+ cards"}),o.jsx("option",{value:8,children:"8+ cards"})]})]}),o.jsxs("label",{children:["Who Chooses",o.jsxs("select",{value:t.actorChooses||"effect_owner",onChange:C=>{const b=C.target.value;if(b==="effect_owner"){const{actorChooses:j,...k}=t;n(k)}else n({...t,actorChooses:b})},children:[o.jsx("option",{value:"effect_owner",children:"Effect owner"}),o.jsx("option",{value:"card_owner",children:"Card owner (Plague-4)"})]})]})]})}),o.jsx(At,{title:"Lane Restriction",forceOpen:d,children:o.jsxs("div",{className:"filter-row",children:[o.jsxs("label",{children:["Lane Condition",o.jsxs("select",{value:((x=t.laneCondition)==null?void 0:x.type)||"none",onChange:C=>{const b=C.target.value;if(b==="none"){const{laneCondition:j,selectLane:k,...E}=t;n(E)}else n({...t,laneCondition:{type:b},selectLane:!0})},children:[o.jsx("option",{value:"none",children:"None"}),o.jsx("option",{value:"opponent_higher_value",children:"Opponent higher value"})]})]}),o.jsxs("label",{className:"checkbox-label",children:[o.jsx("input",{type:"checkbox",checked:t.selectLane||!1,onChange:C=>n({...t,selectLane:C.target.checked})}),"Select lane first"]})]})}),o.jsx(Pc,{conditional:t.advancedConditional,onChange:C=>{if(C)n({...t,advancedConditional:C});else{const{advancedConditional:b,...j}=t;n(j)}},availableTypes:["none","empty_hand","opponent_higher_value_in_lane","this_card_is_covered"]})]})},Cv=({params:t,onChange:n})=>{const r=t.source||"hand",c=t.countType||"fixed",s=t.variableCount,d=r==="hand",u=t.random||t.discardTo==="opponent_trash"||c!=="fixed";return o.jsxs("div",{className:"param-editor discard-effect-editor",children:[o.jsx("h4",{children:"Discard Effect"}),o.jsxs("div",{className:"effect-editor-basic",children:[o.jsxs("label",{children:["Source",o.jsxs("select",{value:r,onChange:p=>n({...t,source:p.target.value}),children:[o.jsx("option",{value:"hand",children:"From Hand"}),o.jsx("option",{value:"top_deck_own",children:"Top of Own Deck"}),o.jsx("option",{value:"top_deck_opponent",children:"Top of Opponent's Deck"}),o.jsx("option",{value:"entire_deck",children:"Entire Deck"})]})]}),d&&o.jsxs(o.Fragment,{children:[o.jsxs("label",{children:["Actor",o.jsxs("select",{value:t.actor,onChange:p=>n({...t,actor:p.target.value}),children:[o.jsx("option",{value:"self",children:"Self"}),o.jsx("option",{value:"opponent",children:"Opponent"}),o.jsx("option",{value:"both",children:"Both"})]})]}),o.jsxs("label",{children:["Count",o.jsxs("select",{value:s?"variable":t.count==="all"?"all":t.count.toString(),onChange:p=>{const f=p.target.value;if(f==="variable")n({...t,variableCount:!0,count:1});else if(f==="all"){const{variableCount:h,..._}=t;n({..._,count:"all"})}else{const{variableCount:h,..._}=t;n({..._,count:parseInt(f)})}},children:[o.jsx("option",{value:"1",children:"1"}),o.jsx("option",{value:"2",children:"2"}),o.jsx("option",{value:"3",children:"3"}),o.jsx("option",{value:"all",children:"All (entire hand)"}),o.jsx("option",{value:"variable",children:"1 or more (variable)"})]})]})]})]}),!d&&o.jsx("small",{className:"hint-text",children:r==="entire_deck"?"Discards all cards from deck to trash automatically.":"Deck discard is automatic - no player choice needed. The discarded card's value is saved for follow-up effects."}),d&&o.jsxs(At,{title:"Advanced Options",forceOpen:u,children:[o.jsxs("div",{className:"filter-row",children:[o.jsxs("label",{children:["Count Type",o.jsxs("select",{value:c,onChange:p=>n({...t,countType:p.target.value}),children:[o.jsx("option",{value:"fixed",children:"Fixed Count"}),o.jsx("option",{value:"equal_to_discarded",children:"Equal to Previously Discarded (Plague-2)"})]})]}),c==="equal_to_discarded"&&o.jsxs("label",{children:["Offset",o.jsx("input",{type:"number",value:t.countOffset||0,onChange:p=>n({...t,countOffset:parseInt(p.target.value)}),min:"-5",max:"5"})]})]}),o.jsxs("div",{className:"filter-row",children:[t.actor==="opponent"&&o.jsxs("label",{className:"checkbox-label",children:[o.jsx("input",{type:"checkbox",checked:t.random||!1,onChange:p=>n({...t,random:p.target.checked})}),"Random selection",o.jsx("small",{className:"hint-text",children:"Opponent can't choose which card"})]}),o.jsxs("label",{children:["Discard to",o.jsxs("select",{value:t.discardTo||"own_trash",onChange:p=>n({...t,discardTo:p.target.value}),children:[o.jsx("option",{value:"own_trash",children:"Own trash"}),o.jsx("option",{value:"opponent_trash",children:"Opponent's trash"})]})]})]})]})]})},Sv=({params:t,onChange:n})=>{var y,m,g,x;const r=((y=t.targetFilter)==null?void 0:y.owner)||"any",c=((m=t.targetFilter)==null?void 0:m.position)||"uncovered",s=((g=t.targetFilter)==null?void 0:g.faceState)||"any",d=(x=t.targetFilter)==null?void 0:x.valueEquals,u=t.selectLane||!1,p=t.destination||"owner_hand",f=r!=="any"||c!=="uncovered"||s!=="any"||d!==void 0,h=t.returnSelf||u,_=C=>{n({...t,targetFilter:{...t.targetFilter,...C}})};return o.jsxs("div",{className:"param-editor return-effect-editor",children:[o.jsx("h4",{children:"Return Effect"}),o.jsxs("div",{className:"effect-editor-basic",children:[o.jsxs("label",{children:["Count",o.jsxs("select",{value:typeof t.count=="number"?t.count.toString():"all",onChange:C=>n({...t,count:C.target.value==="all"?"all":parseInt(C.target.value)}),children:[o.jsx("option",{value:"1",children:"1"}),o.jsx("option",{value:"2",children:"2"}),o.jsx("option",{value:"all",children:"All"})]})]}),r==="opponent"&&o.jsxs("label",{children:["Destination",o.jsxs("select",{value:p,onChange:C=>n({...t,destination:C.target.value}),children:[o.jsx("option",{value:"owner_hand",children:"Owner's hand"}),o.jsx("option",{value:"actor_hand",children:"Your hand (steal)"})]})]})]}),o.jsxs(At,{title:"Target Filter",forceOpen:f,children:[o.jsx("div",{className:"filter-row",children:o.jsx(Lc,{filter:t.targetFilter||{},onChange:_,showOwner:!0,showPosition:!0,showFaceState:!0})}),o.jsxs("div",{className:"filter-row",children:[o.jsxs("label",{className:"checkbox-label",children:[o.jsx("input",{type:"checkbox",checked:d!==void 0,onChange:C=>{if(C.target.checked)n({...t,targetFilter:{...t.targetFilter,valueEquals:2}});else{const{valueEquals:b,...j}=t.targetFilter||{};n({...t,targetFilter:j})}}}),"Filter by value"]}),d!==void 0&&o.jsxs("label",{children:["Value",o.jsx("select",{value:d,onChange:C=>n({...t,targetFilter:{...t.targetFilter,valueEquals:parseInt(C.target.value)}}),children:[0,1,2,3,4,5,6].map(C=>o.jsx("option",{value:C,children:C},C))})]})]})]}),o.jsx(At,{title:"Advanced Options",forceOpen:h,children:o.jsxs("div",{className:"filter-row",children:[o.jsxs("label",{className:"checkbox-label",children:[o.jsx("input",{type:"checkbox",checked:u,onChange:C=>{if(C.target.checked)n({...t,selectLane:!0});else{const{selectLane:b,...j}=t;n(j)}}}),"Select lane first",o.jsx("small",{className:"hint-text",children:'Water-3: "in 1 line"'})]}),o.jsxs("label",{className:"checkbox-label",children:[o.jsx("input",{type:"checkbox",checked:t.returnSelf||!1,onChange:C=>{if(C.target.checked)n({...t,returnSelf:!0});else{const{returnSelf:b,optional:j,...k}=t;n(k)}}}),"Return this card"]}),t.returnSelf&&o.jsxs("label",{className:"checkbox-label",children:[o.jsx("input",{type:"checkbox",checked:t.optional||!1,onChange:C=>n({...t,optional:C.target.checked})}),"Optional"]})]})}),o.jsx(Pc,{conditional:t.advancedConditional,onChange:C=>{if(C)n({...t,advancedConditional:C});else{const{advancedConditional:b,...j}=t;n(j)}},availableTypes:["none","empty_hand","opponent_higher_value_in_lane","this_card_is_covered"]})]})},bv=({params:t,onChange:n})=>{var u,p,f,h;const r=t.destinationRule||{type:"other_lines"},c=r.type!=="other_lines"||r.cardFilter,s=((u=t.condition)==null?void 0:u.type)&&t.condition.type!=="none",d=t.sourceOwner==="opponent"||t.targetBoard==="opponent";return o.jsxs("div",{className:"param-editor play-effect-editor",children:[o.jsx("h4",{children:"Play Effect"}),o.jsxs("div",{className:"effect-editor-basic",children:[o.jsxs("label",{children:["Actor",o.jsxs("select",{value:t.actor||"self",onChange:_=>{if(_.target.value==="self"){const{actor:y,...m}=t;n(m)}else n({...t,actor:_.target.value})},children:[o.jsx("option",{value:"self",children:"You"}),o.jsx("option",{value:"opponent",children:"Opponent"})]})]}),o.jsxs("label",{children:["Source",o.jsxs("select",{value:t.source,onChange:_=>n({...t,source:_.target.value}),children:[o.jsx("option",{value:"hand",children:"Hand"}),o.jsx("option",{value:"deck",children:"Deck"}),o.jsx("option",{value:"trash",children:"Trash"})]})]}),o.jsxs("label",{children:["Count",o.jsx("select",{value:t.count,onChange:_=>n({...t,count:parseInt(_.target.value)||1}),children:[1,2,3,4,5,6].map(_=>o.jsx("option",{value:_,children:_},_))})]}),o.jsxs("label",{children:["Orientation",o.jsxs("select",{value:t.faceDown===void 0?"choice":t.faceDown?"down":"up",onChange:_=>{const y=_.target.value;if(y==="choice"){const{faceDown:m,...g}=t;n(g)}else n({...t,faceDown:y==="down"})},children:[o.jsx("option",{value:"up",children:"Face-up"}),o.jsx("option",{value:"down",children:"Face-down"}),o.jsx("option",{value:"choice",children:"Player Chooses"})]})]})]}),o.jsx(At,{title:"Destination",forceOpen:c,children:o.jsxs("div",{className:"filter-row",children:[o.jsxs("label",{children:["Destination Rule",o.jsxs("select",{value:r.type,onChange:_=>n({...t,destinationRule:{...r,type:_.target.value}}),children:[o.jsx("option",{value:"other_lines",children:"Other lines"}),o.jsx("option",{value:"each_other_line",children:"Each other line"}),o.jsx("option",{value:"specific_lane",children:"This lane"}),o.jsx("option",{value:"each_line_with_card",children:"Each line with card"}),o.jsx("option",{value:"line_with_matching_cards",children:"Line with matching cards"}),o.jsx("option",{value:"under_this_card",children:"Under this card"})]})]}),(r.type==="each_line_with_card"||r.type==="line_with_matching_cards")&&o.jsxs("label",{children:["Card Filter",o.jsxs("select",{value:((p=r.cardFilter)==null?void 0:p.faceState)||"any",onChange:_=>{const y=_.target.value;if(y==="any"){const{cardFilter:m,...g}=r;n({...t,destinationRule:g})}else n({...t,destinationRule:{...r,cardFilter:{faceState:y}}})},children:[o.jsx("option",{value:"any",children:"Any card"}),o.jsx("option",{value:"face_down",children:"Face-down only"}),o.jsx("option",{value:"face_up",children:"Face-up only"})]})]})]})}),o.jsx(At,{title:"Advanced Options",forceOpen:d,children:o.jsxs("div",{className:"filter-row",children:[(t.source==="deck"||t.source==="trash")&&o.jsxs("label",{children:["Source Owner",o.jsxs("select",{value:t.sourceOwner||"own",onChange:_=>n({...t,sourceOwner:_.target.value}),children:[o.jsxs("option",{value:"own",children:["Own ",t.source]}),o.jsxs("option",{value:"opponent",children:["Opponent's ",t.source]})]})]}),o.jsxs("label",{children:["Target Board",o.jsxs("select",{value:t.targetBoard||"own",onChange:_=>n({...t,targetBoard:_.target.value}),children:[o.jsx("option",{value:"own",children:"Own board"}),o.jsx("option",{value:"opponent",children:"Opponent's board"})]})]})]})}),o.jsx(At,{title:"Condition",forceOpen:s,children:o.jsxs("div",{className:"filter-row",children:[o.jsxs("label",{children:["Play Condition",o.jsxs("select",{value:((f=t.condition)==null?void 0:f.type)||"none",onChange:_=>{const y=_.target.value;if(y==="none"){const{condition:m,...g}=t;n(g)}else n(y==="per_x_cards_in_line"?{...t,condition:{type:y,cardCount:2}}:{...t,condition:{type:y}})},children:[o.jsx("option",{value:"none",children:"None"}),o.jsx("option",{value:"per_x_cards_in_line",children:"For every X cards"}),o.jsx("option",{value:"only_in_lines_with_cards",children:"Only in lines with cards"})]})]}),((h=t.condition)==null?void 0:h.type)==="per_x_cards_in_line"&&o.jsxs("label",{children:["Cards per Play",o.jsx("select",{value:t.condition.cardCount||2,onChange:_=>n({...t,condition:{...t.condition,cardCount:parseInt(_.target.value)||2}}),children:[1,2,3,4,5,6].map(_=>o.jsx("option",{value:_,children:_},_))})]})]})}),o.jsx(Pc,{conditional:t.advancedConditional,onChange:_=>{if(_)n({...t,advancedConditional:_});else{const{advancedConditional:y,...m}=t;n(m)}},availableTypes:["none","empty_hand","opponent_higher_value_in_lane"]})]})},Ev=({params:t,onChange:n})=>{const r=!!t.restriction;return o.jsxs("div",{className:"param-editor protocol-effect-editor",children:[o.jsx("h4",{children:"Protocol Effect"}),o.jsxs("div",{className:"effect-editor-basic",children:[o.jsxs("label",{children:["Action",o.jsxs("select",{value:t.action,onChange:c=>n({...t,action:c.target.value}),children:[o.jsx("option",{value:"rearrange_protocols",children:"Rearrange"}),o.jsx("option",{value:"swap_protocols",children:"Swap"})]})]}),o.jsxs("label",{children:["Target",o.jsxs("select",{value:t.target,onChange:c=>n({...t,target:c.target.value}),children:[o.jsx("option",{value:"own",children:"Own"}),o.jsx("option",{value:"opponent",children:"Opponent"}),o.jsx("option",{value:"both_sequential",children:"Both (sequential)"})]})]})]}),o.jsxs(At,{title:"Restriction (Anarchy-3)",forceOpen:r,children:[o.jsxs("label",{className:"checkbox-label",children:[o.jsx("input",{type:"checkbox",checked:r,onChange:c=>{if(c.target.checked)n({...t,restriction:{disallowedProtocol:"",laneIndex:"current"}});else{const{restriction:s,...d}=t;n(d)}}}),"Protocol cannot be on specific lane"]}),r&&o.jsxs("div",{className:"filter-row",children:[o.jsxs("label",{children:["Disallowed Protocol",o.jsx("input",{type:"text",value:t.restriction.disallowedProtocol,onChange:c=>n({...t,restriction:{...t.restriction,disallowedProtocol:c.target.value}}),placeholder:"e.g., Anarchy, Fire"})]}),o.jsxs("label",{children:["Lane",o.jsxs("select",{value:t.restriction.laneIndex,onChange:c=>n({...t,restriction:{...t.restriction,laneIndex:c.target.value==="current"?"current":parseInt(c.target.value)}}),children:[o.jsx("option",{value:"current",children:"Current lane"}),o.jsx("option",{value:"0",children:"Lane 1 (Left)"}),o.jsx("option",{value:"1",children:"Lane 2 (Middle)"}),o.jsx("option",{value:"2",children:"Lane 3 (Right)"})]})]})]})]})]})},jv=({params:t,onChange:n})=>{var u;const r=t.source==="own_hand"||t.source==="opponent_hand"||t.source==="board"||t.source==="own_trash",c=t.source==="board",s=t.source==="own_hand"&&t.action==="reveal",d=((u=t.protocolFilter)==null?void 0:u.type)==="same_as_source";return o.jsxs("div",{className:"param-editor reveal-effect-editor",children:[o.jsx("h4",{children:"Reveal/Give Effect"}),o.jsxs("div",{className:"effect-editor-basic",children:[o.jsxs("label",{children:["Action",o.jsxs("select",{value:t.action,onChange:p=>n({...t,action:p.target.value}),children:[o.jsx("option",{value:"reveal",children:"Reveal"}),o.jsx("option",{value:"give",children:"Give"})]})]}),o.jsxs("label",{children:["Source",o.jsxs("select",{value:t.source,onChange:p=>n({...t,source:p.target.value}),children:[o.jsx("option",{value:"own_hand",children:"Your hand"}),o.jsx("option",{value:"opponent_hand",children:"Opponent's hand"}),o.jsx("option",{value:"own_deck_top",children:"Top of your deck"}),o.jsx("option",{value:"own_deck",children:"Your entire deck"}),o.jsx("option",{value:"own_trash",children:"Your trash"}),o.jsx("option",{value:"board",children:"Board card"})]})]}),r&&o.jsxs("label",{children:["Count",o.jsx("select",{value:t.count||1,onChange:p=>n({...t,count:parseInt(p.target.value)}),children:[1,2,3,4,5,6].map(p=>o.jsx("option",{value:p,children:p},p))})]}),c&&o.jsxs("label",{children:["Follow-up",o.jsxs("select",{value:t.followUpAction||"none",onChange:p=>{if(p.target.value==="none"){const{followUpAction:f,...h}=t;n(h)}else n({...t,followUpAction:p.target.value})},children:[o.jsx("option",{value:"none",children:"None"}),o.jsx("option",{value:"flip",children:"Then flip"}),o.jsx("option",{value:"shift",children:"Then shift"})]})]})]}),s&&o.jsxs(At,{title:"Special Options",forceOpen:d,children:[o.jsxs("label",{className:"checkbox-label",children:[o.jsx("input",{type:"checkbox",checked:d,onChange:p=>{if(p.target.checked)n({...t,protocolFilter:{type:"same_as_source"}});else{const{protocolFilter:f,...h}=t;n(h)}}}),"Reveal all same-protocol cards (Unity-0)"]}),o.jsx("small",{className:"hint-text",children:"Reveals all cards in hand that match this card's protocol."})]})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const kv=({params:t,onChange:n})=>o.jsxs("div",{className:"param-editor take-effect-editor",children:[o.jsx("h4",{children:"Take Effect"}),o.jsxs("div",{className:"effect-editor-basic",children:[o.jsxs("label",{children:["Count",o.jsx("select",{value:t.count||1,onChange:r=>n({...t,count:parseInt(r.target.value)}),children:[1,2,3,4,5,6].map(r=>o.jsx("option",{value:r,children:r},r))})]}),o.jsxs("label",{children:["Source",o.jsx("select",{value:t.source,onChange:r=>n({...t,source:r.target.value}),children:o.jsx("option",{value:"opponent_hand",children:"Opponent's Hand"})})]}),o.jsxs("label",{className:"checkbox-label",children:[o.jsx("input",{type:"checkbox",checked:t.random,onChange:r=>n({...t,random:r.target.checked})}),"Random",o.jsx("small",{className:"hint-text",children:"If unchecked, you choose"})]})]})]}),Cc=t=>{switch(t){case"draw":return{action:"draw",count:1,target:"self",source:"own_deck"};case"flip":return{action:"flip",count:1,targetFilter:{owner:"any",position:"any",faceState:"any",excludeSelf:!1},optional:!1};case"shift":return{action:"shift",targetFilter:{owner:"any",position:"any",faceState:"any"},destinationRestriction:{type:"any"}};case"delete":return{action:"delete",count:1,targetFilter:{position:"any",faceState:"any"},scope:{type:"anywhere"},excludeSelf:!1};case"discard":return{action:"discard",count:1,actor:"self"};case"return":return{action:"return",count:1,targetFilter:{},scope:{type:"any_card"}};case"play":return{action:"play",source:"hand",count:1,faceDown:!1,destinationRule:{type:"other_lines"}};case"rearrange_protocols":return{action:"rearrange_protocols",target:"own"};case"swap_protocols":return{action:"swap_protocols",target:"own"};case"reveal":case"give":return{action:t,source:"own_hand",count:1};case"take":return{action:"take",source:"opponent_hand",count:1,random:!0};default:return{}}},Lj=({params:t,onChange:n})=>{const[r,c]=ce.useState(""),[s,d]=ce.useState(""),[u,p]=ce.useState(null),f=t.options||[],h=f[0],_=f[1],y=()=>{if(!r)return;const T={id:ct(),params:Cc(r),position:"middle",trigger:"on_play"};n({...t,options:[T,_].filter(Boolean)}),c(""),p(1)},m=()=>{if(!s)return;const T={id:ct(),params:Cc(s),position:"middle",trigger:"on_play"};n({...t,options:[h,T].filter(Boolean)}),d(""),p(2)},g=()=>{n({...t,options:[_].filter(Boolean)}),u===1&&p(null)},x=()=>{n({...t,options:[h].filter(Boolean)}),u===2&&p(null)},C=T=>{const F={...h,params:T};n({...t,options:[F,_].filter(Boolean)})},b=T=>{const F={..._,params:T};n({...t,options:[h,F].filter(Boolean)})},j=T=>{const F=Cc(T),U={...h,params:F};n({...t,options:[U,_].filter(Boolean)})},k=T=>{const F=Cc(T),U={..._,params:F};n({...t,options:[h,U].filter(Boolean)})},E=(T,F)=>{switch(T.params.action){case"draw":return o.jsx(vv,{params:T.params,onChange:F});case"flip":return o.jsx(_v,{params:T.params,onChange:F});case"shift":return o.jsx(wv,{params:T.params,onChange:F});case"delete":return o.jsx(xv,{params:T.params,onChange:F});case"discard":return o.jsx(Cv,{params:T.params,onChange:F});case"return":return o.jsx(Sv,{params:T.params,onChange:F});case"play":return o.jsx(bv,{params:T.params,onChange:F});case"rearrange_protocols":case"swap_protocols":return o.jsx(Ev,{params:T.params,onChange:F});case"reveal":case"give":return o.jsx(jv,{params:T.params,onChange:F});case"take":return o.jsx(kv,{params:T.params,onChange:F});default:return o.jsx("div",{children:"Unknown effect type"})}};return o.jsxs("div",{className:"param-editor choice-effect-editor",children:[o.jsx("h4",{children:"Either/Or Choice"}),o.jsx("small",{className:"hint-text",children:"Player chooses one of two options during gameplay."}),o.jsxs("div",{className:"choice-option-container",children:[o.jsx("label",{className:"choice-option-header",children:"Option 1:"}),h?o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"choice-option-row",children:[o.jsxs("select",{className:"choice-action-select",value:h.params.action,onChange:T=>j(T.target.value),children:[o.jsx("option",{value:"draw",children:"Draw Cards"}),o.jsx("option",{value:"flip",children:"Flip Cards"}),o.jsx("option",{value:"shift",children:"Shift Card"}),o.jsx("option",{value:"delete",children:"Delete Cards"}),o.jsx("option",{value:"discard",children:"Discard Cards"}),o.jsx("option",{value:"return",children:"Return to Hand"}),o.jsx("option",{value:"play",children:"Play from Hand/Deck"})]}),o.jsx("button",{className:`choice-btn ${u===1?"choice-btn-active":"choice-btn-edit"}`,onClick:()=>p(u===1?null:1),children:u===1?"Hide":"Edit"}),o.jsx("button",{className:"choice-btn choice-btn-remove",onClick:g,children:"Remove"})]}),u===1&&o.jsx("div",{className:"choice-option-editor",children:E(h,C)})]}):o.jsxs("div",{className:"choice-option-row",children:[o.jsxs("select",{className:"choice-action-select",value:r,onChange:T=>c(T.target.value),children:[o.jsx("option",{value:"",children:"Choose Action"}),o.jsx("option",{value:"draw",children:"Draw Cards"}),o.jsx("option",{value:"flip",children:"Flip Cards"}),o.jsx("option",{value:"shift",children:"Shift Card"}),o.jsx("option",{value:"delete",children:"Delete Cards"}),o.jsx("option",{value:"discard",children:"Discard Cards"}),o.jsx("option",{value:"return",children:"Return to Hand"}),o.jsx("option",{value:"play",children:"Play from Hand/Deck"})]}),o.jsx("button",{className:`choice-btn ${r?"choice-btn-add":"choice-btn-disabled"}`,onClick:y,disabled:!r,children:"Add"})]})]}),o.jsxs("div",{className:"choice-option-container",children:[o.jsx("label",{className:"choice-option-header",children:"Option 2:"}),_?o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"choice-option-row",children:[o.jsxs("select",{className:"choice-action-select",value:_.params.action,onChange:T=>k(T.target.value),children:[o.jsx("option",{value:"draw",children:"Draw Cards"}),o.jsx("option",{value:"flip",children:"Flip Cards"}),o.jsx("option",{value:"shift",children:"Shift Card"}),o.jsx("option",{value:"delete",children:"Delete Cards"}),o.jsx("option",{value:"discard",children:"Discard Cards"}),o.jsx("option",{value:"return",children:"Return to Hand"}),o.jsx("option",{value:"play",children:"Play from Hand/Deck"})]}),o.jsx("button",{className:`choice-btn ${u===2?"choice-btn-active":"choice-btn-edit"}`,onClick:()=>p(u===2?null:2),children:u===2?"Hide":"Edit"}),o.jsx("button",{className:"choice-btn choice-btn-remove",onClick:x,children:"Remove"})]}),u===2&&o.jsx("div",{className:"choice-option-editor",children:E(_,b)})]}):o.jsxs("div",{className:"choice-option-row",children:[o.jsxs("select",{className:"choice-action-select",value:s,onChange:T=>d(T.target.value),children:[o.jsx("option",{value:"",children:"Choose Action"}),o.jsx("option",{value:"draw",children:"Draw Cards"}),o.jsx("option",{value:"flip",children:"Flip Cards"}),o.jsx("option",{value:"shift",children:"Shift Card"}),o.jsx("option",{value:"delete",children:"Delete Cards"}),o.jsx("option",{value:"discard",children:"Discard Cards"}),o.jsx("option",{value:"return",children:"Return to Hand"}),o.jsx("option",{value:"play",children:"Play from Hand/Deck"})]}),o.jsx("button",{className:`choice-btn ${s?"choice-btn-add":"choice-btn-disabled"}`,onClick:m,disabled:!s,children:"Add"})]})]}),f.length===2&&o.jsx("div",{className:"choice-complete-notice",children:"Both options configured. Player will choose one during gameplay."})]})},Pj=({params:t,onChange:n})=>{var _,y,m,g,x,C;const r=((_=t.rule)==null?void 0:_.type)||"block_all_play",c=((y=t.rule)==null?void 0:y.target)||"opponent",s=((m=t.rule)==null?void 0:m.scope)||"this_lane",d=((g=t.rule)==null?void 0:g.onlyDuringYourTurn)||!1,u=((x=t.rule)==null?void 0:x.conditionTarget)||"self",p=((C=t.rule)==null?void 0:C.blockTarget)||"self",f=r==="block_draw_conditional",h=r==="ignore_middle_commands"&&d;return o.jsxs("div",{className:"param-editor passive-rule-editor",children:[o.jsx("h4",{children:"Passive Rule"}),o.jsx("small",{className:"hint-text",children:"Active while card is face-up. Modifies game behavior."}),o.jsxs("div",{className:"effect-editor-basic",children:[o.jsxs("label",{children:["Rule Type",o.jsxs("select",{value:r,onChange:b=>n({...t,rule:{...t.rule,type:b.target.value,target:c,scope:s}}),children:[o.jsxs("optgroup",{label:"Play Restrictions",children:[o.jsx("option",{value:"block_face_down_play",children:"Block Face-Down"}),o.jsx("option",{value:"block_face_up_play",children:"Block Face-Up"}),o.jsx("option",{value:"block_all_play",children:"Block All"}),o.jsx("option",{value:"require_face_down_play",children:"Require Face-Down"})]}),o.jsxs("optgroup",{label:"Protocol Matching",children:[o.jsx("option",{value:"allow_any_protocol_play",children:"Allow Any Protocol"}),o.jsx("option",{value:"allow_play_on_opponent_side",children:"Allow Opponent Side"}),o.jsx("option",{value:"allow_same_protocol_face_up_play",children:"Same Protocol Face-Up"}),o.jsx("option",{value:"require_non_matching_protocol",children:"Non-Matching Only"})]}),o.jsxs("optgroup",{label:"Action Blocks",children:[o.jsx("option",{value:"block_flips",children:"Block Flips"}),o.jsx("option",{value:"block_protocol_rearrange",children:"Block Rearrange"}),o.jsx("option",{value:"block_shifts_from_lane",children:"Block Shift From"}),o.jsx("option",{value:"block_shifts_to_lane",children:"Block Shift To"}),o.jsx("option",{value:"block_flip_this_card",children:"Can't Flip This Card"})]}),o.jsxs("optgroup",{label:"Other",children:[o.jsx("option",{value:"block_draw_conditional",children:"Conditional Draw Block"}),o.jsx("option",{value:"ignore_middle_commands",children:"Ignore Middle Commands"}),o.jsx("option",{value:"skip_check_cache_phase",children:"Skip Check Cache"})]})]})]}),o.jsxs("label",{children:["Target",o.jsxs("select",{value:c,onChange:b=>n({...t,rule:{...t.rule,type:r,target:b.target.value,scope:s}}),children:[o.jsx("option",{value:"self",children:"Self"}),o.jsx("option",{value:"opponent",children:"Opponent"}),o.jsx("option",{value:"all",children:"All"})]})]}),o.jsxs("label",{children:["Scope",o.jsxs("select",{value:s,onChange:b=>n({...t,rule:{...t.rule,type:r,target:c,scope:b.target.value,onlyDuringYourTurn:d}}),children:[o.jsx("option",{value:"this_lane",children:"This Lane"}),o.jsx("option",{value:"global",children:"Global"})]})]})]}),r==="block_draw_conditional"&&o.jsx(At,{title:"Draw Block Settings",forceOpen:f,children:o.jsxs("div",{className:"filter-row",children:[o.jsxs("label",{children:["Condition (who must have cards)",o.jsxs("select",{value:u,onChange:b=>n({...t,rule:{...t.rule,type:r,target:"this_card",scope:"global",conditionTarget:b.target.value,blockTarget:p}}),children:[o.jsx("option",{value:"self",children:"Card owner"}),o.jsx("option",{value:"opponent",children:"Opponent"})]})]}),o.jsxs("label",{children:["Block Target (who can't draw)",o.jsxs("select",{value:p,onChange:b=>n({...t,rule:{...t.rule,type:r,target:"this_card",scope:"global",conditionTarget:u,blockTarget:b.target.value}}),children:[o.jsx("option",{value:"self",children:"Card owner"}),o.jsx("option",{value:"opponent",children:"Opponent"}),o.jsx("option",{value:"all",children:"Both"})]})]})]})}),r==="ignore_middle_commands"&&o.jsx(At,{title:"Timing",forceOpen:h,children:o.jsxs("label",{className:"checkbox-label",children:[o.jsx("input",{type:"checkbox",checked:d,onChange:b=>n({...t,rule:{...t.rule,type:r,target:c,scope:s,onlyDuringYourTurn:b.target.checked}})}),"Only during your turn"]})})]})},Uj=({params:t,onChange:n})=>{var g,x,C,b,j,k,E,T,F;const r=((g=t.modifier)==null?void 0:g.type)||"add_per_condition",c=((x=t.modifier)==null?void 0:x.value)||1,s=((C=t.modifier)==null?void 0:C.condition)||"per_face_down_card",d=((b=t.modifier)==null?void 0:b.target)||"own_total",u=((j=t.modifier)==null?void 0:j.scope)||"this_lane",p=((E=(k=t.modifier)==null?void 0:k.filter)==null?void 0:E.faceState)||"face_down",f=((F=(T=t.modifier)==null?void 0:T.filter)==null?void 0:F.position)||"any",h=r==="add_per_condition",_=r==="set_to_fixed"&&(d==="own_cards"||d==="opponent_cards"||d==="all_cards"),y=_&&(p!=="face_down"||f!=="any"),m=U=>{n({...t,modifier:{...t.modifier,type:r,value:c,condition:h?s:void 0,target:d,scope:u,filter:_?{faceState:p,position:f}:void 0,...U}})};return o.jsxs("div",{className:"param-editor value-modifier-editor",children:[o.jsx("h4",{children:"Value Modifier"}),o.jsx("small",{className:"hint-text",children:"Active while card is face-up. Modifies card values or lane totals."}),o.jsxs("div",{className:"effect-editor-basic",children:[o.jsxs("label",{children:["Type",o.jsxs("select",{value:r,onChange:U=>m({type:U.target.value}),children:[o.jsx("option",{value:"add_per_condition",children:"Add Per Condition"}),o.jsx("option",{value:"set_to_fixed",children:"Set To Fixed Value"}),o.jsx("option",{value:"add_to_total",children:"Add To Total"})]})]}),o.jsxs("label",{children:["Value",o.jsx("input",{type:"number",value:c,onChange:U=>m({value:parseInt(U.target.value)||0})})]}),h&&o.jsxs("label",{children:["Condition",o.jsxs("select",{value:s,onChange:U=>m({condition:U.target.value}),children:[o.jsx("option",{value:"per_face_down_card",children:"Per Face-Down"}),o.jsx("option",{value:"per_face_up_card",children:"Per Face-Up"}),o.jsx("option",{value:"per_card",children:"Per Card (any)"}),o.jsx("option",{value:"per_card_in_hand",children:"Per Hand Card"}),o.jsx("option",{value:"per_opponent_card_in_lane",children:"Per Opp. Card"})]})]})]}),o.jsx(At,{title:"Target & Scope",forceOpen:d!=="own_total"||u!=="this_lane",children:o.jsxs("div",{className:"filter-row",children:[o.jsxs("label",{children:["Target",o.jsxs("select",{value:d,onChange:U=>m({target:U.target.value}),children:[o.jsxs("optgroup",{label:"Card Values",children:[o.jsx("option",{value:"own_cards",children:"Own Cards"}),o.jsx("option",{value:"opponent_cards",children:"Opponent Cards"}),o.jsx("option",{value:"all_cards",children:"All Cards"})]}),o.jsxs("optgroup",{label:"Lane Totals",children:[o.jsx("option",{value:"own_total",children:"Own Total"}),o.jsx("option",{value:"opponent_total",children:"Opponent Total"})]})]})]}),o.jsxs("label",{children:["Scope",o.jsxs("select",{value:u,onChange:U=>m({scope:U.target.value}),children:[o.jsx("option",{value:"this_lane",children:"This Lane"}),o.jsx("option",{value:"global",children:"Global"})]})]})]})}),_&&o.jsx(At,{title:"Card Filter",forceOpen:y,children:o.jsxs("div",{className:"filter-row",children:[o.jsxs("label",{children:["Face State",o.jsxs("select",{value:p,onChange:U=>m({filter:{faceState:U.target.value,position:f}}),children:[o.jsx("option",{value:"face_down",children:"Face-Down"}),o.jsx("option",{value:"face_up",children:"Face-Up"}),o.jsx("option",{value:"any",children:"Any"})]})]}),o.jsxs("label",{children:["Position",o.jsxs("select",{value:f,onChange:U=>m({filter:{faceState:p,position:U.target.value}}),children:[o.jsx("option",{value:"any",children:"Any"}),o.jsx("option",{value:"covered",children:"Covered"}),o.jsx("option",{value:"uncovered",children:"Uncovered"})]})]})]})})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Oj=({params:t,onChange:n})=>o.jsxs("div",{className:"param-editor block-compile-effect-editor",children:[o.jsx("h4",{children:"Block Compile Effect"}),o.jsx("div",{className:"effect-editor-basic",children:o.jsxs("label",{children:["Target",o.jsxs("select",{value:t.target||"opponent",onChange:r=>n({...t,target:r.target.value}),children:[o.jsx("option",{value:"opponent",children:"Opponent cannot compile next turn"}),o.jsx("option",{value:"self",children:"You cannot compile next turn"})]})]})})]});/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Mj=({params:t,onChange:n})=>{var c;const r=((c=t.laneCondition)==null?void 0:c.count)||8;return o.jsxs("div",{className:"param-editor delete-all-in-lane-effect-editor",children:[o.jsx("h4",{children:"Delete All In Lane Effect"}),o.jsxs("div",{className:"effect-editor-basic",children:[o.jsxs("label",{children:["Minimum cards in lane",o.jsxs("select",{value:r,onChange:s=>n({...t,laneCondition:{type:"min_cards",count:parseInt(s.target.value)}}),children:[o.jsx("option",{value:0,children:"No minimum (any lane)"}),o.jsx("option",{value:4,children:"4 or more cards"}),o.jsx("option",{value:6,children:"6 or more cards"}),o.jsx("option",{value:8,children:"8 or more cards (Metal-3)"}),o.jsx("option",{value:10,children:"10 or more cards"})]})]}),o.jsxs("label",{className:"checkbox-label",children:[o.jsx("input",{type:"checkbox",checked:t.excludeCurrentLane!==!1,onChange:s=>n({...t,excludeCurrentLane:s.target.checked})}),"Exclude current lane",o.jsx("small",{className:"hint-text",children:"Other lanes only"})]})]})]})},Vj=({params:t,onChange:n})=>{var c;const r=((c=t.advancedConditional)==null?void 0:c.type)==="trash_not_empty";return o.jsxs("div",{className:"param-editor shuffle-trash-effect-editor",children:[o.jsx("h4",{children:"Shuffle Trash Effect"}),o.jsx("small",{className:"hint-text",children:"Shuffle your trash (discarded/deleted cards) back into your deck."}),o.jsx("div",{className:"effect-editor-basic",children:o.jsxs("label",{className:"checkbox-label",children:[o.jsx("input",{type:"checkbox",checked:t.optional!==!1,onChange:s=>n({...t,optional:s.target.checked})}),'Optional ("You may shuffle...")']})}),o.jsxs(At,{title:"Conditionals",forceOpen:r,children:[o.jsxs("label",{className:"checkbox-label",children:[o.jsx("input",{type:"checkbox",checked:r,onChange:s=>{if(s.target.checked)n({...t,advancedConditional:{type:"trash_not_empty"}});else{const{advancedConditional:d,...u}=t;n(u)}}}),"Only if trash is not empty"]}),o.jsx("small",{className:"hint-text",children:'"If there are any cards in your trash..."'})]})]})},Hj=()=>o.jsxs("div",{className:"param-editor shuffle-deck-effect-editor",children:[o.jsx("h4",{children:"Shuffle Deck Effect"}),o.jsx("small",{className:"hint-text",children:"Shuffle your deck. Typically used after revealing the deck."}),o.jsx("p",{className:"hint-text",children:"No additional parameters required."})]});/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const zj=({params:t,onChange:n})=>o.jsxs("div",{className:"param-editor state-number-effect-editor",children:[o.jsx("h4",{children:"State Number Effect"}),o.jsx("small",{className:"hint-text",children:"Player chooses a number from the available protocol card values. The stated number is stored for subsequent effects."}),o.jsx("div",{className:"effect-editor-basic",children:o.jsxs("label",{children:["Number Source",o.jsx("select",{value:t.numberSource||"own_protocol_values",onChange:r=>n({...t,numberSource:r.target.value}),children:o.jsx("option",{value:"own_protocol_values",children:"Own Protocol Values (0-5)"})})]})})]});/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Bj=({params:t,onChange:n})=>o.jsxs("div",{className:"param-editor state-protocol-effect-editor",children:[o.jsx("h4",{children:"State Protocol Effect"}),o.jsx("small",{className:"hint-text",children:"Player chooses a protocol from the opponent's unique protocols. The stated protocol is stored for subsequent effects (e.g., matching conditionals)."}),o.jsx("div",{className:"effect-editor-basic",children:o.jsxs("label",{children:["Protocol Source",o.jsx("select",{value:t.protocolSource||"opponent_cards",onChange:r=>n({...t,protocolSource:r.target.value}),children:o.jsx("option",{value:"opponent_cards",children:"Opponent's Cards (unique protocols)"})})]})})]}),Sc=t=>{switch(t){case"draw":return{action:"draw",count:1,target:"self",source:"own_deck"};case"refresh":return{action:"refresh",target:"self"};case"mutual_draw":return{action:"mutual_draw",count:1};case"flip":return{action:"flip",count:1,targetFilter:{owner:"any",position:"any",faceState:"any",excludeSelf:!1},optional:!1};case"shift":return{action:"shift",targetFilter:{owner:"any",position:"any",faceState:"any"},destinationRestriction:{type:"any"}};case"delete":return{action:"delete",count:1,targetFilter:{position:"any",faceState:"any"},scope:{type:"anywhere"},excludeSelf:!1};case"discard":return{action:"discard",count:1,actor:"self"};case"return":return{action:"return",count:1,targetFilter:{},scope:{type:"any_card"}};case"play":return{action:"play",source:"hand",count:1,faceDown:!1,destinationRule:{type:"other_lines"}};case"rearrange_protocols":return{action:"rearrange_protocols",target:"own"};case"swap_protocols":return{action:"swap_protocols",target:"own"};case"reveal":case"give":return{action:t,source:"own_hand",count:1};case"take":return{action:"take",source:"opponent_hand",count:1,random:!0};case"choice":return{action:"choice",options:[]};case"passive_rule":return{action:"passive_rule",rule:{type:"block_all_play",target:"opponent",scope:"this_lane"}};case"value_modifier":return{action:"value_modifier",modifier:{type:"add_per_condition",value:1,condition:"per_face_down_card",target:"own_total",scope:"this_lane"}};case"block_compile":return{action:"block_compile",target:"opponent"};case"delete_all_in_lane":return{action:"delete_all_in_lane",laneCondition:{type:"min_cards",count:8},excludeCurrentLane:!0};case"shuffle_trash":return{action:"shuffle_trash",optional:!0};case"shuffle_deck":return{action:"shuffle_deck"};case"redirect_return_to_deck":return{action:"redirect_return_to_deck",faceDown:!0};case"state_number":return{action:"state_number",numberSource:"own_protocol_values"};case"state_protocol":return{action:"state_protocol",protocolSource:"opponent_cards"};case"swap_stacks":return{action:"swap_stacks",target:"own"};case"copy_opponent_middle":return{action:"copy_opponent_middle",optional:!0};case"auto_compile":return{action:"auto_compile",protocolCountConditional:{type:"unique_protocols_on_field",threshold:6}};case"card_property":return{action:"card_property",property:"ignore_protocol_matching"};default:return{}}},Gj=({effect:t,onChange:n,readOnly:r=!1})=>{const c=g=>{r||n({...t,params:g})},s=g=>{if(g){const x={id:ct(),params:Sc("draw"),position:t.position,trigger:t.trigger};n({...t,conditional:{type:"then",thenEffect:x}})}else{const{conditional:x,...C}=t;n(C)}},d=g=>{t.conditional&&n({...t,conditional:{...t.conditional,type:g}})},u=g=>{t.conditional&&n({...t,conditional:{...t.conditional,thenEffect:g}})},p=g=>{if(!t.conditional)return;const x=Sc(g),C={...t.conditional.thenEffect,params:x};n({...t,conditional:{...t.conditional,thenEffect:C}})},f=g=>{if(t.conditional)if(g){const x={id:ct(),params:Sc("delete"),position:t.position,trigger:t.trigger};n({...t,conditional:{...t.conditional,thenEffect:{...t.conditional.thenEffect,conditional:{type:"then",thenEffect:x}}}})}else{const{conditional:x,...C}=t.conditional.thenEffect;n({...t,conditional:{...t.conditional,thenEffect:C}})}},h=g=>{var x;(x=t.conditional)!=null&&x.thenEffect.conditional&&n({...t,conditional:{...t.conditional,thenEffect:{...t.conditional.thenEffect,conditional:{...t.conditional.thenEffect.conditional,type:g}}}})},_=g=>{var x;(x=t.conditional)!=null&&x.thenEffect.conditional&&n({...t,conditional:{...t.conditional,thenEffect:{...t.conditional.thenEffect,conditional:{...t.conditional.thenEffect.conditional,thenEffect:g}}}})},y=g=>{var b;if(!((b=t.conditional)!=null&&b.thenEffect.conditional))return;const x=Sc(g),C={...t.conditional.thenEffect.conditional.thenEffect,params:x};n({...t,conditional:{...t.conditional,thenEffect:{...t.conditional.thenEffect,conditional:{...t.conditional.thenEffect.conditional,thenEffect:C}}}})},m=(g,x)=>{var C,b,j,k;switch(g.params.action){case"draw":return o.jsx(vv,{params:g.params,onChange:x});case"refresh":return o.jsx(Ij,{params:g.params,onChange:x});case"mutual_draw":return o.jsx(qj,{params:g.params,onChange:x});case"flip":return o.jsx(_v,{params:g.params,onChange:x});case"shift":return o.jsx(wv,{params:g.params,onChange:x});case"delete":return o.jsx(xv,{params:g.params,onChange:x});case"discard":return o.jsx(Cv,{params:g.params,onChange:x});case"return":return o.jsx(Sv,{params:g.params,onChange:x});case"play":return o.jsx(bv,{params:g.params,onChange:x});case"rearrange_protocols":case"swap_protocols":return o.jsx(Ev,{params:g.params,onChange:x});case"reveal":case"give":return o.jsx(jv,{params:g.params,onChange:x});case"take":return o.jsx(kv,{params:g.params,onChange:x});case"choice":return o.jsx(Lj,{params:g.params,onChange:x});case"passive_rule":return o.jsx(Pj,{params:g.params,onChange:x});case"value_modifier":return o.jsx(Uj,{params:g.params,onChange:x});case"block_compile":return o.jsx(Oj,{params:g.params,onChange:x});case"auto_compile":return o.jsxs("div",{className:"param-editor auto-compile-effect-editor",children:[o.jsx("h4",{children:"Auto Compile Effect Parameters"}),o.jsxs("label",{children:["Conditional Type",o.jsxs("select",{value:((C=g.params.protocolCountConditional)==null?void 0:C.type)||"unique_protocols_on_field",onChange:E=>{var F;const T=E.target.value;x(T==="same_protocol_count_on_field"?{...g.params,protocolCountConditional:{type:"same_protocol_count_on_field",threshold:5,faceState:"face_up"}}:{...g.params,protocolCountConditional:{type:"unique_protocols_on_field",threshold:((F=g.params.protocolCountConditional)==null?void 0:F.threshold)||6}})},children:[o.jsx("option",{value:"unique_protocols_on_field",children:"Unique Protocols on Field (Diversity)"}),o.jsx("option",{value:"same_protocol_count_on_field",children:"Same Protocol Count on Field (Unity)"})]})]}),o.jsxs("label",{children:["Required Count",o.jsxs("select",{value:((b=g.params.protocolCountConditional)==null?void 0:b.threshold)||6,onChange:E=>x({...g.params,protocolCountConditional:{...g.params.protocolCountConditional,threshold:parseInt(E.target.value)}}),children:[o.jsx("option",{value:"2",children:"2"}),o.jsx("option",{value:"3",children:"3"}),o.jsx("option",{value:"4",children:"4"}),o.jsx("option",{value:"5",children:"5"}),o.jsx("option",{value:"6",children:"6"}),o.jsx("option",{value:"7",children:"7"}),o.jsx("option",{value:"8",children:"8"})]})]}),((j=g.params.protocolCountConditional)==null?void 0:j.type)==="same_protocol_count_on_field"&&o.jsxs(o.Fragment,{children:[o.jsxs("label",{style:{marginTop:"10px"},children:[o.jsx("input",{type:"checkbox",checked:g.params.deleteAllInLane||!1,onChange:E=>x({...g.params,deleteAllInLane:E.target.checked})}),"Also delete all cards in this lane (Unity-1)"]}),o.jsx("p",{className:"param-hint",style:{marginTop:"10px"},children:'"If there are X or more face-up [Protocol] cards in the field, compile this protocol."'})]}),((k=g.params.protocolCountConditional)==null?void 0:k.type)!=="same_protocol_count_on_field"&&o.jsx("p",{className:"param-hint",children:'"If there are X different protocols on cards in the field, compile this protocol."'})]});case"delete_all_in_lane":return o.jsx(Mj,{params:g.params,onChange:x});case"shuffle_trash":return o.jsx(Vj,{params:g.params,onChange:x});case"shuffle_deck":return o.jsx(Hj,{params:g.params,onChange:x});case"state_number":return o.jsx(zj,{params:g.params,onChange:x});case"state_protocol":return o.jsx(Bj,{params:g.params,onChange:x});case"swap_stacks":return o.jsxs("div",{className:"param-editor swap-stacks-editor",children:[o.jsx("h4",{children:"Swap Stacks"}),o.jsx("p",{style:{color:"#8A79E8"},children:"Swap all of your cards in one of your stacks with another one of your stacks."})]});case"copy_opponent_middle":return o.jsxs("div",{className:"param-editor copy-opponent-middle-editor",children:[o.jsx("h4",{children:"Copy Opponent's Middle Command"}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:g.params.optional??!0,onChange:E=>x({...g.params,optional:E.target.checked})}),'Optional ("You may resolve..." instead of "Resolve...")']}),o.jsx("p",{style:{color:"#8A79E8",marginTop:"10px"},children:"Select one of your opponent's face-up uncovered cards and execute its middle commands as if they were on this card."})]});case"card_property":return o.jsxs("div",{className:"param-editor card-property-editor",children:[o.jsx("h4",{children:"Card Property"}),o.jsxs("label",{children:["Property",o.jsx("select",{value:g.params.property||"ignore_protocol_matching",onChange:E=>x({...g.params,property:E.target.value}),children:o.jsx("option",{value:"ignore_protocol_matching",children:"Ignore Protocol Matching (Chaos-3)"})})]}),o.jsx("p",{style:{color:"#8A79E8",marginTop:"10px"},children:"This card may be played face-up in any lane, regardless of protocol matching rules."})]});default:return o.jsxs("div",{children:["Unknown effect type: ",g.params.action]})}};return o.jsxs("div",{className:`effect-editor ${r?"read-only-mode":""}`,children:[o.jsx("div",{className:"trigger-info",style:{marginBottom:"15px",padding:"10px",backgroundColor:"#1A113B",borderRadius:"4px",border:"1px solid rgba(97, 239, 255, 0.3)"},children:o.jsxs("div",{style:{display:"flex",gap:"20px",alignItems:"center",flexWrap:"wrap"},children:[o.jsxs("label",{style:{flex:1,minWidth:"200px"},children:[o.jsx("strong",{children:"Trigger:"}),o.jsxs("select",{value:t.trigger,onChange:g=>!r&&n({...t,trigger:g.target.value}),disabled:r,style:{width:"100%",padding:"6px",marginTop:"4px",backgroundColor:"#2c1d63",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px"},children:[o.jsx("optgroup",{label:"Immediate",children:o.jsx("option",{value:"on_play",children:"On Play"})}),o.jsx("optgroup",{label:"Passive (Top Box)",children:o.jsx("option",{value:"passive",children:"Passive (always active)"})}),o.jsxs("optgroup",{label:"Phase Triggers (Bottom Box)",children:[o.jsx("option",{value:"start",children:"Start Phase"}),o.jsx("option",{value:"end",children:"End Phase"}),o.jsx("option",{value:"on_cover",children:"When Covered"})]}),o.jsxs("optgroup",{label:"Reactive (Top Box)",children:[o.jsx("option",{value:"on_flip",children:"When this card would be flipped"}),o.jsx("option",{value:"on_cover_or_flip",children:"When covered or flipped"}),o.jsx("option",{value:"after_delete",children:"After cards are deleted"}),o.jsx("option",{value:"after_discard",children:"After cards are discarded"}),o.jsx("option",{value:"after_draw",children:"After cards are drawn"}),o.jsx("option",{value:"after_shift",children:"After cards are shifted"}),o.jsx("option",{value:"after_flip",children:"After cards are flipped"}),o.jsx("option",{value:"after_play",children:"After a card is played"}),o.jsx("option",{value:"after_shuffle",children:"After deck is shuffled"}),o.jsx("option",{value:"after_clear_cache",children:"After cache is cleared"}),o.jsx("option",{value:"after_refresh",children:"After you refresh"}),o.jsx("option",{value:"after_opponent_refresh",children:"After opponent refreshes"}),o.jsx("option",{value:"after_compile",children:"After you compile"}),o.jsx("option",{value:"after_opponent_compile",children:"After opponent compiles"}),o.jsx("option",{value:"after_opponent_discard",children:"After opponent discards"}),o.jsx("option",{value:"after_opponent_draw",children:"After opponent draws"}),o.jsx("option",{value:"before_compile_delete",children:"Before deleted by compile"}),o.jsx("option",{value:"when_card_returned",children:"When card returned to hand"})]})]})]}),o.jsxs("div",{style:{color:"#8A79E8",fontSize:"13px"},children:[o.jsx("strong",{children:"Position:"})," ",t.position.charAt(0).toUpperCase()+t.position.slice(1)," Box"]})]})}),o.jsxs("div",{className:"main-effect",children:[o.jsx("h3",{children:"Main Effect"}),m(t,c),o.jsxs("div",{className:"effect-preview",children:[o.jsx("strong",{children:"Preview:"})," ",o.jsx("span",{dangerouslySetInnerHTML:{__html:mr([t])}})]})]}),o.jsxs("div",{style:{marginTop:"15px"},children:[o.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[o.jsx("input",{type:"checkbox",checked:!!t.useCardFromPreviousEffect,onChange:g=>n({...t,useCardFromPreviousEffect:g.target.checked})}),o.jsx("span",{children:`Use card from previous effect (for "shift THAT card", "draw equal to THAT card's value", etc.)`})]}),t.useCardFromPreviousEffect&&o.jsx("small",{style:{display:"block",marginLeft:"24px",marginTop:"4px",color:"#8A79E8"},children:"This effect will target/use the card selected by the previous effect in the chain."})]}),(t.trigger==="after_draw"||t.trigger==="after_delete"||t.trigger==="after_discard"||t.trigger==="after_shift"||t.trigger==="after_flip"||t.trigger==="after_shuffle"||t.trigger==="after_clear_cache"||t.trigger==="after_opponent_discard"||t.trigger==="after_play")&&o.jsxs("div",{style:{marginTop:"15px"},children:[o.jsxs("label",{children:["Trigger Actor (who triggers this effect?)",o.jsxs("select",{value:t.reactiveTriggerActor||"self",onChange:g=>n({...t,reactiveTriggerActor:g.target.value}),style:{width:"100%",padding:"8px",marginTop:"5px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px",cursor:"pointer"},children:[o.jsx("option",{value:"self",children:"Only when YOU perform the action (default)"}),o.jsx("option",{value:"opponent",children:"Only when OPPONENT performs the action"}),o.jsx("option",{value:"any",children:"When ANYONE performs the action"})]})]}),o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:t.reactiveTriggerActor==="self"||!t.reactiveTriggerActor?"Effect triggers only when YOU delete/draw/etc.":t.reactiveTriggerActor==="opponent"?"Effect triggers only when OPPONENT deletes/draws/etc.":"Effect triggers when ANYONE deletes/draws/etc."})]}),(t.trigger==="after_play"||t.trigger==="after_shift"||t.trigger==="after_flip"||t.trigger==="after_delete")&&o.jsxs("div",{style:{marginTop:"15px"},children:[o.jsxs("label",{children:["Reactive Scope",o.jsxs("select",{value:t.reactiveScope||"global",onChange:g=>n({...t,reactiveScope:g.target.value}),style:{width:"100%",padding:"8px",marginTop:"5px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px",cursor:"pointer"},children:[o.jsx("option",{value:"global",children:"Any lane (default)"}),o.jsx("option",{value:"this_lane",children:"This lane only"})]})]}),o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:t.reactiveScope==="this_lane"?"Effect only triggers when the action happens in the same lane as this card.":"Effect triggers when the action happens anywhere on the board."})]}),t.trigger==="on_cover"&&o.jsxs("div",{style:{marginTop:"15px"},children:[o.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",cursor:"pointer"},children:[o.jsx("input",{type:"checkbox",checked:t.onCoverProtocolRestriction==="same_protocol",onChange:g=>{if(g.target.checked)n({...t,onCoverProtocolRestriction:"same_protocol"});else{const{onCoverProtocolRestriction:x,...C}=t;n(C)}},style:{width:"18px",height:"18px",cursor:"pointer"}}),"Only trigger when covered by same protocol (Unity)"]}),o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:t.onCoverProtocolRestriction==="same_protocol"?"Effect only triggers when covered by another card of the same protocol.":"Effect triggers when covered by any card."})]}),(t.trigger==="after_draw"||t.trigger==="after_delete"||t.trigger==="after_discard"||t.trigger==="after_shift"||t.trigger==="after_flip"||t.trigger==="after_shuffle")&&o.jsxs("div",{style:{marginTop:"15px"},children:[o.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",cursor:"pointer"},children:[o.jsx("input",{type:"checkbox",checked:t.onlyDuringOpponentTurn||!1,onChange:g=>n({...t,onlyDuringOpponentTurn:g.target.checked}),style:{width:"18px",height:"18px",cursor:"pointer"}}),"Only During Opponent's Turn"]}),o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:t.onlyDuringOpponentTurn?"Effect only triggers during your opponent's turn.":"Effect triggers during any turn."})]}),o.jsxs("div",{className:"conditional-section",style:{marginTop:"20px",borderTop:"1px solid #2c1d63",paddingTop:"15px"},children:[o.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"10px"},children:[o.jsx("input",{type:"checkbox",checked:!!t.conditional,onChange:g=>s(g.target.checked)}),o.jsx("strong",{children:"Add follow-up effect"})]}),t.conditional&&o.jsxs("div",{className:"follow-up-effect",style:{marginLeft:"20px",padding:"10px",backgroundColor:"#2c1d63",borderRadius:"4px",border:"1px solid rgba(97, 239, 255, 0.2)"},children:[o.jsx("h4",{style:{marginTop:0},children:"Follow-Up Effect"}),o.jsxs("label",{children:["Connection Type",o.jsxs("select",{value:t.conditional.type||"then",onChange:g=>d(g.target.value),style:{width:"100%",padding:"8px",marginTop:"5px",marginBottom:"15px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px",cursor:"pointer"},children:[o.jsx("option",{value:"then",children:"Then (always executes)"}),o.jsx("option",{value:"if_executed",children:"If you do (only if first effect succeeds)"})]})]}),o.jsxs("label",{children:["Effect Type",o.jsxs("select",{value:t.conditional.thenEffect.params.action,onChange:g=>p(g.target.value),style:{width:"100%",padding:"8px",marginTop:"5px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px",cursor:"pointer"},children:[o.jsx("option",{value:"draw",children:"Draw Cards"}),o.jsx("option",{value:"refresh",children:"Refresh Hand"}),o.jsx("option",{value:"mutual_draw",children:"Mutual Draw (Exchange)"}),o.jsx("option",{value:"flip",children:"Flip Cards"}),o.jsx("option",{value:"shift",children:"Shift Card"}),o.jsx("option",{value:"delete",children:"Delete Cards"}),o.jsx("option",{value:"delete_all_in_lane",children:"Delete All in Lane"}),o.jsx("option",{value:"discard",children:"Discard Cards"}),o.jsx("option",{value:"return",children:"Return to Hand"}),o.jsx("option",{value:"play",children:"Play from Hand/Deck"}),o.jsx("option",{value:"rearrange_protocols",children:"Rearrange Protocols"}),o.jsx("option",{value:"swap_protocols",children:"Swap Protocols"}),o.jsx("option",{value:"reveal",children:"Reveal Hand"}),o.jsx("option",{value:"give",children:"Give Cards"}),o.jsx("option",{value:"take",children:"Take from Hand"}),o.jsx("option",{value:"choice",children:"Either/Or Choice"}),o.jsx("option",{value:"block_compile",children:"Block Compile"}),o.jsx("option",{value:"auto_compile",children:"Auto Compile (Diversity)"}),o.jsx("option",{value:"shuffle_trash",children:"Shuffle Trash into Deck"}),o.jsx("option",{value:"shuffle_deck",children:"Shuffle Deck"}),o.jsx("option",{value:"state_number",children:"State a Number"}),o.jsx("option",{value:"state_protocol",children:"State a Protocol"}),o.jsx("option",{value:"swap_stacks",children:"Swap Stacks"}),o.jsx("option",{value:"copy_opponent_middle",children:"Copy Opponent's Middle"}),o.jsx("option",{value:"card_property",children:"Card Property (Chaos-3)"})]})]}),o.jsx("div",{style:{marginTop:"15px"},children:m(t.conditional.thenEffect,g=>u({...t.conditional.thenEffect,params:g}))}),o.jsxs("div",{className:"nested-conditional-section",style:{marginTop:"15px",borderTop:"1px solid rgba(97, 239, 255, 0.2)",paddingTop:"15px"},children:[o.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"10px"},children:[o.jsx("input",{type:"checkbox",checked:!!t.conditional.thenEffect.conditional,onChange:g=>f(g.target.checked)}),o.jsx("strong",{children:"Add 2nd follow-up effect"})]}),t.conditional.thenEffect.conditional&&o.jsxs("div",{className:"nested-follow-up-effect",style:{marginLeft:"10px",padding:"10px",backgroundColor:"#1A113B",borderRadius:"4px",border:"1px solid rgba(97, 239, 255, 0.2)"},children:[o.jsx("h5",{style:{marginTop:0,fontSize:"0.9rem"},children:"2nd Follow-Up Effect"}),o.jsxs("label",{children:["Connection Type",o.jsxs("select",{value:t.conditional.thenEffect.conditional.type||"then",onChange:g=>h(g.target.value),style:{width:"100%",padding:"6px",marginTop:"5px",marginBottom:"10px",backgroundColor:"#0D0825",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px",cursor:"pointer",fontSize:"0.9rem"},children:[o.jsx("option",{value:"then",children:"Then (always executes)"}),o.jsx("option",{value:"if_executed",children:"If you do (only if first effect succeeds)"})]})]}),o.jsxs("label",{children:["Effect Type",o.jsxs("select",{value:t.conditional.thenEffect.conditional.thenEffect.params.action,onChange:g=>y(g.target.value),style:{width:"100%",padding:"6px",marginTop:"5px",backgroundColor:"#0D0825",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px",cursor:"pointer",fontSize:"0.9rem"},children:[o.jsx("option",{value:"draw",children:"Draw Cards"}),o.jsx("option",{value:"refresh",children:"Refresh Hand"}),o.jsx("option",{value:"mutual_draw",children:"Mutual Draw (Exchange)"}),o.jsx("option",{value:"flip",children:"Flip Cards"}),o.jsx("option",{value:"shift",children:"Shift Card"}),o.jsx("option",{value:"delete",children:"Delete Cards"}),o.jsx("option",{value:"delete_all_in_lane",children:"Delete All in Lane"}),o.jsx("option",{value:"discard",children:"Discard Cards"}),o.jsx("option",{value:"return",children:"Return to Hand"}),o.jsx("option",{value:"play",children:"Play from Hand/Deck"}),o.jsx("option",{value:"rearrange_protocols",children:"Rearrange Protocols"}),o.jsx("option",{value:"swap_protocols",children:"Swap Protocols"}),o.jsx("option",{value:"reveal",children:"Reveal Hand"}),o.jsx("option",{value:"give",children:"Give Cards"}),o.jsx("option",{value:"take",children:"Take from Hand"}),o.jsx("option",{value:"choice",children:"Either/Or Choice"}),o.jsx("option",{value:"block_compile",children:"Block Compile"}),o.jsx("option",{value:"auto_compile",children:"Auto Compile (Diversity)"}),o.jsx("option",{value:"shuffle_trash",children:"Shuffle Trash into Deck"}),o.jsx("option",{value:"shuffle_deck",children:"Shuffle Deck"}),o.jsx("option",{value:"state_number",children:"State a Number"}),o.jsx("option",{value:"state_protocol",children:"State a Protocol"}),o.jsx("option",{value:"swap_stacks",children:"Swap Stacks"}),o.jsx("option",{value:"copy_opponent_middle",children:"Copy Opponent's Middle"}),o.jsx("option",{value:"card_property",children:"Card Property (Chaos-3)"})]})]}),o.jsx("div",{style:{marginTop:"10px"},children:m(t.conditional.thenEffect.conditional.thenEffect,g=>_({...t.conditional.thenEffect.conditional.thenEffect,params:g}))})]})]})]})]})]})},Yj=({card:t,protocolName:n,protocolColor:r,protocolPattern:c,onChange:s,readOnly:d=!1})=>{const[u,p]=ce.useState(null),[f,h]=ce.useState(null),[_,y]=ce.useState(!1);ce.useEffect(()=>{p(null)},[t.value]);const m=(L,P,M)=>{const N={id:ct(),params:Wj(P),position:L,trigger:M},R={...t};L==="top"?R.topEffects=[...R.topEffects,N]:L==="middle"?R.middleEffects=[...R.middleEffects,N]:R.bottomEffects=[...R.bottomEffects,N],s(R);const $=L==="top"?R.topEffects.length-1:L==="middle"?R.middleEffects.length-1:R.bottomEffects.length-1;p({box:L,effectIndex:$,effect:N})},g=(L,P)=>{h({box:L,effectIndex:P})},x=()=>{if(!f)return;const{box:L,effectIndex:P}=f,M={...t};L==="top"?M.topEffects.splice(P,1):L==="middle"?M.middleEffects.splice(P,1):M.bottomEffects.splice(P,1),s(M),u&&u.box===L&&u.effectIndex===P&&p(null),h(null)},C=L=>{if(!u)return;const{box:P,effectIndex:M}=u,N={...t};P==="top"?(N.topEffects=[...N.topEffects],N.topEffects[M]=L):P==="middle"?(N.middleEffects=[...N.middleEffects],N.middleEffects[M]=L):(N.bottomEffects=[...N.bottomEffects],N.bottomEffects[M]=L),s(N),p({box:P,effectIndex:M,effect:L})},b=(L,P)=>{const M=L==="top"?t.topEffects[P]:L==="middle"?t.middleEffects[P]:t.bottomEffects[P];p({box:L,effectIndex:P,effect:M})},j=(L,P)=>{const M=(P==null?void 0:P.reactiveTriggerActor)||"self",N=(P==null?void 0:P.reactiveScope)||"global";if(L==="after_play")return`After ${M==="opponent"?"your opponent plays":M==="any"?"a card is played":"you play"} a card${N==="this_lane"?" in this line":""}`;if(["after_delete","after_discard","after_draw","after_shift","after_flip"].includes(L)){const R={after_delete:"delete cards",after_discard:"discard cards",after_draw:"draw cards",after_shift:"shift cards",after_flip:"flip cards"},$=M==="opponent"?"your opponent":M==="any"?"anyone":"you",X=N==="this_lane"?" in this line":"";return`After ${$} ${R[L]}${X}`}switch(L){case"passive":return"";case"on_play":return"";case"start":return"Start";case"end":return"End";case"on_cover":return"On Cover";case"after_opponent_discard":return"After opponent discards";case"after_clear_cache":return"After you clear cache";case"before_compile_delete":return"Before deleted by compile";case"on_flip":return"When this card would be flipped";case"on_cover_or_flip":return"When covered or flipped";default:return L}},k=L=>{const P={...t,value:L};s(P)},E={protocolName:n},T=mr(t.topEffects,E),F=mr(t.middleEffects,E),U=mr(t.bottomEffects,E),D=JSON.stringify({top:t.topEffects.map(L=>({id:L.id,params:L.params})),middle:t.middleEffects.map(L=>({id:L.id,params:L.params})),bottom:t.bottomEffects.map(L=>({id:L.id,params:L.params}))}),I=`${n}-${t.value}-${D}`,W={id:I,protocol:n,value:t.value,top:T,middle:F,bottom:U,isFaceUp:!0,owner:"player",laneIndex:0,category:"Custom",keywords:{}},z=(L,P)=>{L=L.replace("#","");const M=parseInt(L.substring(0,2),16),N=parseInt(L.substring(2,4),16),R=parseInt(L.substring(4,6),16);return`rgba(${M}, ${N}, ${R}, ${P})`},V=`card-custom-preview pattern-${c}`,B={"--custom-color":r,"--custom-color-alpha-05":z(r,.05),"--custom-color-alpha-06":z(r,.06),"--custom-color-alpha-08":z(r,.08),"--custom-color-alpha-10":z(r,.1),"--custom-color-alpha-15":z(r,.15),"--custom-color-alpha-20":z(r,.2),"--custom-color-alpha-25":z(r,.25),borderColor:r};return o.jsxs("div",{className:"card-editor-container",children:[o.jsxs("div",{className:"card-editor-content",children:[o.jsxs("div",{className:"card-live-preview",children:[o.jsx("h4",{children:"Card Preview"}),o.jsxs("label",{className:"card-value-selector",children:["Card Value:",o.jsxs("select",{value:t.value,onChange:L=>k(Number(L.target.value)),children:[o.jsx("option",{value:-1,children:"-1"}),o.jsx("option",{value:0,children:"0"}),o.jsx("option",{value:1,children:"1"}),o.jsx("option",{value:2,children:"2"}),o.jsx("option",{value:3,children:"3"}),o.jsx("option",{value:4,children:"4"}),o.jsx("option",{value:5,children:"5"}),o.jsx("option",{value:6,children:"6"})]})]}),o.jsx("div",{className:"card-preview-wrapper",style:B,children:o.jsx(St,{card:W,isFaceUp:!0,additionalClassName:V},I)})]}),o.jsx("div",{className:"card-effects-editor",children:o.jsxs("div",{className:"card-preview",style:{borderColor:r},children:[o.jsx("div",{className:"card-header",style:{backgroundColor:r},children:o.jsxs("h3",{children:[n,"-",t.value]})}),o.jsxs("div",{className:"card-box top-box",children:[o.jsx("h4",{children:"Top Box (Passive/Reactive)"}),o.jsx("p",{className:"box-description",children:"Passive effects or reactive triggers"}),o.jsxs("div",{className:"effects-list",children:[t.topEffects.map((L,P)=>o.jsxs("div",{className:"effect-item",children:[o.jsxs("span",{onClick:()=>b("top",P),className:d?"read-only-clickable":"",children:[L.trigger!=="passive"&&o.jsxs("strong",{children:[j(L.trigger,L),":"]})," ",rl(L)]}),!d&&o.jsx("button",{onClick:()=>g("top",P),children:""})]},L.id)),t.topEffects.length===0&&o.jsx("p",{className:"empty-box",children:"No effects"})]}),!d&&o.jsxs("div",{className:"add-effect-controls",children:[o.jsxs("select",{id:"top-trigger",defaultValue:"",children:[o.jsx("option",{value:"",children:"Choose Trigger"}),o.jsx("optgroup",{label:"Passive",children:o.jsx("option",{value:"passive",children:"Passive (always active)"})}),o.jsxs("optgroup",{label:"Phase Triggers",children:[o.jsx("option",{value:"start",children:"Start Phase"}),o.jsx("option",{value:"end",children:"End Phase"}),o.jsx("option",{value:"on_cover",children:"On Cover"})]}),o.jsxs("optgroup",{label:"Reactive Triggers",children:[o.jsx("option",{value:"after_delete",children:"After you delete cards"}),o.jsx("option",{value:"after_opponent_discard",children:"After opponent discards"}),o.jsx("option",{value:"after_draw",children:"After you draw cards"}),o.jsx("option",{value:"after_clear_cache",children:"After you clear cache"}),o.jsx("option",{value:"before_compile_delete",children:"Before deleted by compile"}),o.jsx("option",{value:"after_flip",children:"After cards are flipped"}),o.jsx("option",{value:"after_shift",children:"After cards are shifted"}),o.jsx("option",{value:"after_play",children:"After cards are played"}),o.jsx("option",{value:"on_flip",children:"When this card would be flipped"}),o.jsx("option",{value:"on_cover_or_flip",children:"When this card would be covered or flipped"})]})]}),o.jsxs("select",{id:"top-action",defaultValue:"",children:[o.jsx("option",{value:"",children:"Choose Action"}),o.jsx("option",{value:"draw",children:"Draw Cards"}),o.jsx("option",{value:"refresh",children:"Refresh Hand"}),o.jsx("option",{value:"mutual_draw",children:"Mutual Draw (Exchange)"}),o.jsx("option",{value:"flip",children:"Flip Cards"}),o.jsx("option",{value:"shift",children:"Shift Card"}),o.jsx("option",{value:"delete",children:"Delete Cards"}),o.jsx("option",{value:"discard",children:"Discard Cards"}),o.jsx("option",{value:"return",children:"Return to Hand"}),o.jsx("option",{value:"play",children:"Play from Hand/Deck"}),o.jsx("option",{value:"rearrange_protocols",children:"Rearrange Protocols"}),o.jsx("option",{value:"swap_protocols",children:"Swap Protocols"}),o.jsx("option",{value:"reveal",children:"Reveal Hand"}),o.jsx("option",{value:"give",children:"Give Cards"}),o.jsx("option",{value:"take",children:"Take from Hand"}),o.jsx("option",{value:"choice",children:"Either/Or Choice"}),o.jsx("option",{value:"passive_rule",children:"Passive Rule"}),o.jsx("option",{value:"value_modifier",children:"Value Modifier"}),o.jsx("option",{value:"block_compile",children:"Block Compile"}),o.jsx("option",{value:"delete_all_in_lane",children:"Delete All in Lane"})]}),o.jsx("button",{className:"btn btn-add-effect",onClick:()=>{const L=document.getElementById("top-trigger"),P=document.getElementById("top-action"),M=L.value,N=P.value;M&&N?(m("top",N,M),L.value="",P.value=""):y(!0)},children:"+"})]})]}),o.jsxs("div",{className:"card-box middle-box",children:[o.jsx("h4",{children:"Middle Box (On Play)"}),o.jsx("p",{className:"box-description",children:"When played or uncovered"}),o.jsxs("div",{className:"effects-list",children:[t.middleEffects.map((L,P)=>o.jsxs("div",{className:"effect-item",children:[o.jsx("span",{onClick:()=>b("middle",P),className:d?"read-only-clickable":"",children:rl(L)}),!d&&o.jsx("button",{onClick:()=>g("middle",P),children:""})]},L.id)),t.middleEffects.length===0&&o.jsx("p",{className:"empty-box",children:"No effects"})]}),!d&&o.jsxs("select",{onChange:L=>{L.target.value&&(m("middle",L.target.value,"on_play"),L.target.value="")},children:[o.jsx("option",{value:"",children:"+ Add Effect"}),o.jsx("option",{value:"draw",children:"Draw Cards"}),o.jsx("option",{value:"refresh",children:"Refresh Hand"}),o.jsx("option",{value:"flip",children:"Flip Cards"}),o.jsx("option",{value:"shift",children:"Shift Card"}),o.jsx("option",{value:"delete",children:"Delete Cards"}),o.jsx("option",{value:"discard",children:"Discard Cards"}),o.jsx("option",{value:"return",children:"Return to Hand"}),o.jsx("option",{value:"play",children:"Play from Hand/Deck"}),o.jsx("option",{value:"rearrange_protocols",children:"Rearrange Protocols"}),o.jsx("option",{value:"swap_protocols",children:"Swap Protocols"}),o.jsx("option",{value:"reveal",children:"Reveal Hand"}),o.jsx("option",{value:"give",children:"Give Cards"}),o.jsx("option",{value:"take",children:"Take from Hand"}),o.jsx("option",{value:"choice",children:"Either/Or Choice"}),o.jsx("option",{value:"passive_rule",children:"Passive Rule"}),o.jsx("option",{value:"value_modifier",children:"Value Modifier"}),o.jsx("option",{value:"block_compile",children:"Block Compile"}),o.jsx("option",{value:"delete_all_in_lane",children:"Delete All in Lane"})]})]}),o.jsxs("div",{className:"card-box bottom-box",children:[o.jsx("h4",{children:"Bottom Box (Triggered)"}),o.jsx("p",{className:"box-description",children:"Only when uncovered AND face-up"}),o.jsxs("div",{className:"effects-list",children:[t.bottomEffects.map((L,P)=>o.jsxs("div",{className:"effect-item",children:[o.jsxs("span",{onClick:()=>b("bottom",P),className:d?"read-only-clickable":"",children:[o.jsxs("strong",{children:[j(L.trigger,L),":"]})," ",rl(L)]}),!d&&o.jsx("button",{onClick:()=>g("bottom",P),children:""})]},L.id)),t.bottomEffects.length===0&&o.jsx("p",{className:"empty-box",children:"No effects"})]}),!d&&o.jsxs("div",{className:"bottom-effect-add",children:[o.jsxs("select",{id:"bottom-trigger",children:[o.jsx("option",{value:"",children:"1. Choose Trigger"}),o.jsx("option",{value:"start",children:"Start Phase"}),o.jsx("option",{value:"end",children:"End Phase"}),o.jsx("option",{value:"on_cover",children:"On Cover"})]}),o.jsxs("select",{id:"bottom-action",children:[o.jsx("option",{value:"",children:"2. Choose Effect"}),o.jsx("option",{value:"draw",children:"Draw Cards"}),o.jsx("option",{value:"refresh",children:"Refresh Hand"}),o.jsx("option",{value:"mutual_draw",children:"Mutual Draw (Exchange)"}),o.jsx("option",{value:"flip",children:"Flip Cards"}),o.jsx("option",{value:"shift",children:"Shift Card"}),o.jsx("option",{value:"delete",children:"Delete Cards"}),o.jsx("option",{value:"discard",children:"Discard Cards"}),o.jsx("option",{value:"return",children:"Return to Hand"}),o.jsx("option",{value:"play",children:"Play from Hand/Deck"}),o.jsx("option",{value:"rearrange_protocols",children:"Rearrange Protocols"}),o.jsx("option",{value:"swap_protocols",children:"Swap Protocols"}),o.jsx("option",{value:"reveal",children:"Reveal Hand"}),o.jsx("option",{value:"give",children:"Give Cards"}),o.jsx("option",{value:"take",children:"Take from Hand"}),o.jsx("option",{value:"choice",children:"Either/Or Choice"}),o.jsx("option",{value:"passive_rule",children:"Passive Rule"}),o.jsx("option",{value:"value_modifier",children:"Value Modifier"}),o.jsx("option",{value:"block_compile",children:"Block Compile"}),o.jsx("option",{value:"delete_all_in_lane",children:"Delete All in Lane"})]}),o.jsx("button",{className:"btn btn-add-effect",onClick:()=>{const L=document.getElementById("bottom-trigger"),P=document.getElementById("bottom-action"),M=L.value,N=P.value;M&&N?(m("bottom",N,M),L.value="",P.value=""):y(!0)},children:"+"})]})]})]})})]}),u&&o.jsxs("div",{className:"effect-parameter-editor",children:[o.jsx("h3",{children:d?"View Effect":"Configure Effect"}),d&&o.jsx("div",{className:"read-only-notice",children:"This effect is read-only"}),o.jsx(Gj,{effect:u.effect,onChange:C,readOnly:d}),o.jsx("button",{onClick:()=>p(null),className:"btn",children:d?"Close":"Done"})]}),f&&o.jsx("div",{className:"custom-protocol-modal-overlay",onClick:()=>h(null),children:o.jsxs("div",{className:"custom-protocol-modal-content",onClick:L=>L.stopPropagation(),children:[o.jsx("h3",{children:"Delete Effect"}),o.jsx("p",{children:"Are you sure you want to delete this effect?"}),o.jsxs("div",{className:"custom-protocol-modal-actions",children:[o.jsx("button",{onClick:()=>h(null),className:"btn btn-back",children:"Cancel"}),o.jsx("button",{onClick:x,className:"btn btn-delete",children:"Delete"})]})]})}),_&&o.jsx("div",{className:"custom-protocol-modal-overlay",onClick:()=>y(!1),children:o.jsxs("div",{className:"custom-protocol-modal-content",onClick:L=>L.stopPropagation(),children:[o.jsx("h3",{children:"Missing Selection"}),o.jsx("p",{children:"Please select both a trigger and an effect before adding."}),o.jsx("div",{className:"custom-protocol-modal-actions",children:o.jsx("button",{onClick:()=>y(!1),className:"btn",children:"OK"})})]})})]})},Wj=t=>{switch(t){case"draw":return{action:"draw",count:1,target:"self",source:"own_deck"};case"flip":return{action:"flip",count:1,targetFilter:{owner:"any",position:"any",faceState:"any",excludeSelf:!1},optional:!1};case"shift":return{action:"shift",targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1}};case"delete":return{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"any"},excludeSelf:!0};case"discard":return{action:"discard",count:1,actor:"self"};case"return":return{action:"return",count:1,targetFilter:{},scope:{type:"any_card"}};case"play":return{action:"play",source:"hand",count:1,faceDown:!0,destinationRule:{type:"other_lines"}};case"rearrange_protocols":return{action:"rearrange_protocols",target:"own"};case"swap_protocols":return{action:"swap_protocols",target:"own"};case"reveal":case"give":return{action:t,source:"own_hand",count:1};case"take":return{action:"take",source:"opponent_hand",count:1,random:!0};case"choice":return{action:"choice",options:[]};case"passive_rule":return{action:"passive_rule",rule:{type:"block_all_play",target:"opponent",scope:"this_lane"}};case"value_modifier":return{action:"value_modifier",modifier:{type:"add_per_condition",value:1,condition:"per_face_down_card",target:"own_total",scope:"this_lane"}};default:return{}}},Qj=(t,n)=>{const r=(s,d)=>{s=s.replace("#","");const u=parseInt(s.substring(0,2),16),p=parseInt(s.substring(2,4),16),f=parseInt(s.substring(4,6),16);return`rgba(${u}, ${p}, ${f}, ${d})`},c={borderColor:n};switch(t){case"solid":return{...c,backgroundColor:n};case"radial":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`radial-gradient(circle at 50% 50%, ${r(n,.25)} 0%, transparent 60%)`};case"dual-radial":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 0% 0%, ${r(n,.2)}, transparent 50%),
                    radial-gradient(at 100% 100%, ${r(n,.2)}, transparent 50%)
                `};case"multi-radial":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 0%, ${r(n,.2)}, transparent 70%),
                    radial-gradient(circle at 20% 30%, ${r(n,.15)}, transparent 40%),
                    radial-gradient(circle at 80% 70%, ${r(n,.2)}, transparent 50%)
                `};case"chaos":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 10% 10%, hsla(60, 100%, 50%, 0.15), transparent 30%),
                    radial-gradient(at 90% 20%, hsla(180, 100%, 50%, 0.15), transparent 35%),
                    radial-gradient(at 30% 80%, hsla(300, 100%, 50%, 0.15), transparent 40%),
                    radial-gradient(at 70% 60%, hsla(0, 100%, 50%, 0.1), transparent 25%)
                `};case"grid":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(circle at 50% 50%, ${r(n,.2)} 0%, transparent 40%),
                    linear-gradient(hsla(0,0%,100%,0.03) 1px, transparent 1px),
                    linear-gradient(90deg, hsla(0,0%,100%,0.03) 1px, transparent 1px)
                `,backgroundSize:"100% 100%, 20px 20px, 20px 20px"};case"diagonal-lines":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 0% 100%, ${r(n,.25)}, transparent 70%),
                    repeating-linear-gradient(120deg, transparent, transparent 15px, ${r(n,.05)} 15px, ${r(n,.05)} 30px)
                `};case"cross-diagonal":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 50%, ${r(n,.25)} 0%, transparent 50%),
                    repeating-linear-gradient(45deg, transparent, transparent 8px, ${r(n,.08)} 8px, ${r(n,.08)} 16px),
                    repeating-linear-gradient(-45deg, transparent, transparent 8px, ${r(n,.06)} 8px, ${r(n,.06)} 16px)
                `};case"horizontal-lines":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 80% 80%, ${r(n,.1)}, transparent 50%),
                    repeating-linear-gradient(0deg, hsla(0,0%,100%,0.02), hsla(0,0%,100%,0.02) 1px, transparent 1px, transparent 3px)
                `};case"vertical-lines":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 10% 10%, ${r(n,.2)}, transparent 50%),
                    repeating-linear-gradient(175deg, transparent, transparent 1px, ${r(n,.05)} 1px, ${r(n,.05)} 2px)
                `};case"cross":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    linear-gradient(0deg, transparent 40%, ${r(n,.1)} 50%, transparent 60%),
                    linear-gradient(90deg, transparent 48%, ${r(n,.2)} 50%, transparent 52%)
                `};case"hexagons":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 0%, ${r(n,.2)}, transparent 70%),
                    url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='28' height='49' viewBox='0 0 28 49'%3E%3Cg fill-rule='evenodd'%3E%3Cg id='hexagons' fill='%23ffffff' fill-opacity='0.05' fill-rule='nonzero'%3E%3Cpath d='M13.99 9.25l13 7.5v15l-13 7.5L1 31.75v-15l12.99-7.5zM3 17.9v12.7l10.99 6.34 11-6.35V17.9l-11-6.34L3 17.9zM0 15l12.99-7.5L26 15v18.5l-13 7.5L0 33.5V15z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")
                `};case"stripes":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 100%, ${r(n,.25)}, transparent 60%),
                    linear-gradient(135deg, hsla(0,0%,0%,0.1) 23%, transparent 23%, transparent 25%, hsla(0,0%,0%,0.1) 25%, hsla(0,0%,0%,0.1) 27%, transparent 27%, transparent 73%, hsla(0,0%,0%,0.1) 73%, hsla(0,0%,0%,0.1) 75%, transparent 75%, transparent 77%, hsla(0,0%,0%,0.1) 77%)
                `};case"frost":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(circle at 50% 50%, ${r(n,.2)} 0%, transparent 50%),
                    repeating-linear-gradient(30deg, transparent, transparent 10px, ${r(n,.08)} 10px, ${r(n,.08)} 11px),
                    repeating-linear-gradient(-30deg, transparent, transparent 10px, ${r(n,.08)} 10px, ${r(n,.08)} 11px),
                    repeating-linear-gradient(90deg, transparent, transparent 8px, ${r(n,.05)} 8px, ${r(n,.05)} 9px)
                `};default:return c}},Xj=[{name:"Anarchy",hex:"#EA5A3C"},{name:"Apathy",hex:"#989A9A"},{name:"Chaos",hex:"#E53FE5"},{name:"Darkness",hex:"#A772D4"},{name:"Death",hex:"#E25656"},{name:"Fire",hex:"#F06838"},{name:"Gravity",hex:"#7599EB"},{name:"Hate",hex:"#E03E5E"},{name:"Life",hex:"#3CE076"},{name:"Light",hex:"#FFEB7F"},{name:"Love",hex:"#F074D9"},{name:"Metal",hex:"#B3B8BD"},{name:"Plague",hex:"#A2CD3A"},{name:"Psychic",hex:"#C971EB"},{name:"Speed",hex:"#33DDDD"},{name:"Spirit",hex:"#42D4A8"},{name:"Water",hex:"#3FA4EB"}],Zj=[{name:"Solid",value:"solid",description:"Solid color background"},{name:"Radial Glow",value:"radial",description:"Single radial gradient glow"},{name:"Dual Radial",value:"dual-radial",description:"Two radial gradient spots"},{name:"Multi Radial",value:"multi-radial",description:"Multiple radial gradient spots"},{name:"Chaos",value:"chaos",description:"Colorful chaotic spots"},{name:"Grid",value:"grid",description:"Grid line pattern"},{name:"Diagonal Lines",value:"diagonal-lines",description:"Repeating diagonal lines"},{name:"Cross Diagonal",value:"cross-diagonal",description:"Crossed diagonal lines"},{name:"Horizontal Lines",value:"horizontal-lines",description:"Fine horizontal lines"},{name:"Vertical Lines",value:"vertical-lines",description:"Fine vertical lines"},{name:"Cross Pattern",value:"cross",description:"Cross/plus pattern"},{name:"Hexagons",value:"hexagons",description:"Hexagon pattern"},{name:"Stripes",value:"stripes",description:"Diagonal stripe pattern"},{name:"Frost",value:"frost",description:"Icy crystalline pattern with crossing lines"}],Kj=({onSave:t,onCancel:n,onDelete:r,initialProtocol:c})=>{const[s,d]=ce.useState("name"),[u,p]=ce.useState(0),[f,h]=ce.useState(!1),[_,y]=ce.useState(""),[m,g]=ce.useState(!1),x=c?sl(c):!1;console.log("ProtocolWizard render - initialProtocol:",c,"isReadOnly:",x);const[C,b]=ce.useState((c==null?void 0:c.name)||""),[j,k]=ce.useState((c==null?void 0:c.description)||""),[E,T]=ce.useState((c==null?void 0:c.color)||"#1976D2"),[F,U]=ce.useState((c==null?void 0:c.pattern)||"solid"),[D,I]=ce.useState((c==null?void 0:c.cards)||[{value:0,topEffects:[],middleEffects:[],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[],bottomEffects:[]}]);console.log("ProtocolWizard state - name:",C,"color:",E,"pattern:",F);const W=()=>{if(s==="name"){if(!C.trim()){alert("Please enter a protocol name.");return}d("color")}else s==="color"?d("pattern"):s==="pattern"&&d("cards")},z=R=>{const $=[...D];$[u]=R,I($)},V=()=>{const R={id:(c==null?void 0:c.id)||ct(),name:C,description:j,author:"Player",createdAt:(c==null?void 0:c.createdAt)||new Date().toISOString(),color:E,pattern:F,cards:D};t(R)},B=()=>{c&&r&&r(c.id),g(!1)},L=()=>{const R={id:(c==null?void 0:c.id)||ct(),name:C,description:j,author:"Player",createdAt:(c==null?void 0:c.createdAt)||new Date().toISOString(),color:E,pattern:F,cards:D},$=JSON.stringify(R,null,2);y($),h(!0)},P=()=>{navigator.clipboard.writeText(_).then(()=>{alert("Protocol JSON copied to clipboard!"),h(!1)}).catch(()=>{alert("Failed to copy to clipboard. Please try again.")})},M=R=>!(!C.trim()&&R!=="name"),N=R=>{if(!M(R)){alert("Please enter a protocol name first.");return}d(R)};return o.jsxs("div",{className:"protocol-wizard",children:[o.jsxs("div",{className:"wizard-header",children:[o.jsxs("h2",{children:[x?`View Protocol: ${C}`:c?`Edit Protocol: ${C}`:"Create New Protocol",x&&o.jsx("span",{className:"read-only-badge",children:"Read-Only"})]}),o.jsxs("div",{className:"wizard-progress",children:[o.jsx("button",{className:`step ${s==="name"?"active":"done"}`,onClick:()=>N("name"),type:"button",children:"1. Name"}),o.jsx("button",{className:`step ${s==="color"?"active":s==="pattern"||s==="cards"?"done":""}`,onClick:()=>N("color"),disabled:!M("color"),type:"button",children:"2. Color"}),o.jsx("button",{className:`step ${s==="pattern"?"active":s==="cards"?"done":""}`,onClick:()=>N("pattern"),disabled:!M("pattern"),type:"button",children:"3. Pattern"}),o.jsx("button",{className:`step ${s==="cards"?"active":""}`,onClick:()=>N("cards"),disabled:!M("cards"),type:"button",children:"4. Cards"})]})]}),o.jsxs("div",{className:"wizard-content",children:[s==="name"&&o.jsxs("div",{className:"wizard-step name-step",children:[o.jsx("h3",{children:"Step 1: Name and Description"}),o.jsxs("label",{children:["Protocol Name *",o.jsx("input",{type:"text",value:C,onChange:R=>!x&&b(R.target.value),placeholder:"e.g. Lightning, Shadow, Void",autoFocus:!0,readOnly:x,className:x?"read-only":""})]}),o.jsxs("label",{children:["Description",o.jsx("textarea",{value:j,onChange:R=>!x&&k(R.target.value),placeholder:"Describe the strategy and theme of your protocol",rows:4,readOnly:x,className:x?"read-only":""})]})]}),s==="color"&&o.jsxs("div",{className:"wizard-step color-step",children:[o.jsx("h3",{children:"Step 2: Choose Color"}),o.jsx("div",{className:"color-preview",style:{backgroundColor:E},children:o.jsx("span",{children:C||"Your Protocol"})}),o.jsx("h4",{children:"Predefined Colors"}),o.jsx("div",{className:`color-grid ${x?"read-only":""}`,children:Xj.map(R=>o.jsx("button",{className:`color-option ${E===R.hex?"selected":""}`,style:{backgroundColor:R.hex},onClick:()=>!x&&T(R.hex),title:R.name,disabled:x,children:E===R.hex&&""},R.hex))}),o.jsx("h4",{children:"Custom Color"}),o.jsxs("div",{className:"custom-color",children:[o.jsx("input",{type:"color",value:E,onChange:R=>!x&&T(R.target.value),disabled:x}),o.jsx("input",{type:"text",value:E,onChange:R=>!x&&T(R.target.value),placeholder:"#1976D2",readOnly:x,className:x?"read-only":""})]})]}),s==="pattern"&&o.jsxs("div",{className:"wizard-step pattern-step",children:[o.jsx("h3",{children:"Step 3: Choose Card Pattern"}),o.jsx("div",{className:`pattern-selection-grid ${x?"read-only":""}`,children:Zj.map(R=>{const $=Qj(R.value,E);return o.jsxs("div",{className:`pattern-option ${F===R.value?"selected":""}`,onClick:()=>!x&&U(R.value),children:[o.jsxs("div",{className:"pattern-preview",style:$,children:[C||"Protocol","-0"]}),o.jsx("h4",{children:R.name}),o.jsx("p",{children:R.description}),F===R.value&&o.jsx("div",{className:"selected-badge",children:" Selected"})]},R.value)})})]}),s==="cards"&&o.jsxs("div",{className:"wizard-step cards-step",children:[o.jsx("h3",{children:"Step 4: Configure Cards"}),o.jsx("div",{className:"card-navigation",children:D.map((R,$)=>o.jsxs("button",{className:`card-nav-btn ${u===$?"active":""}`,onClick:()=>p($),type:"button",children:["Card ",R.value]},$))}),o.jsx(Yj,{card:D[u],protocolName:C,protocolColor:E,protocolPattern:F,onChange:z,readOnly:x})]})]}),o.jsxs("div",{className:"wizard-actions",children:[o.jsxs("div",{className:"wizard-actions-left",children:[o.jsx("button",{onClick:n,className:"btn btn-back",children:x?"Back":"Cancel"}),c&&r&&!x&&o.jsx("button",{onClick:()=>g(!0),className:"btn btn-delete",children:"Delete Protocol"})]}),o.jsxs("div",{className:"wizard-actions-right",children:[c&&o.jsxs(o.Fragment,{children:[o.jsx("button",{onClick:L,className:"btn btn-export",children:"Export JSON"}),!x&&o.jsx("button",{onClick:V,className:"btn",children:"Save"})]}),!c&&o.jsxs(o.Fragment,{children:[s!=="cards"&&o.jsx("button",{onClick:W,className:"btn",children:"Next"}),s==="cards"&&o.jsxs(o.Fragment,{children:[o.jsx("button",{onClick:L,className:"btn btn-export",children:"Export JSON"}),o.jsx("button",{onClick:V,className:"btn",children:"Save"})]})]})]})]}),f&&o.jsx("div",{className:"custom-protocol-modal-overlay",onClick:()=>h(!1),children:o.jsxs("div",{className:"custom-protocol-modal-content custom-protocol-modal-large",onClick:R=>R.stopPropagation(),children:[o.jsx("h3",{children:"Export Protocol JSON"}),o.jsx("p",{children:"Copy the JSON below to share or backup your protocol:"}),o.jsx("textarea",{value:_,readOnly:!0,rows:15,className:"export-textarea",onClick:R=>R.target.select()}),o.jsxs("div",{className:"custom-protocol-modal-actions",children:[o.jsx("button",{onClick:()=>h(!1),className:"btn btn-back",children:"Close"}),o.jsx("button",{onClick:P,className:"btn",children:"Copy to Clipboard"})]})]})}),m&&o.jsx("div",{className:"custom-protocol-modal-overlay",onClick:()=>g(!1),children:o.jsxs("div",{className:"custom-protocol-modal-content",onClick:R=>R.stopPropagation(),children:[o.jsx("h3",{children:"Delete Protocol"}),o.jsxs("p",{children:['Are you sure you want to delete "',C,'"?']}),o.jsx("p",{style:{color:"var(--danger-color)",fontSize:"0.9rem"},children:"This action cannot be undone."}),o.jsxs("div",{className:"custom-protocol-modal-actions",children:[o.jsx("button",{onClick:()=>g(!1),className:"btn btn-back",children:"Cancel"}),o.jsx("button",{onClick:B,className:"btn btn-delete",children:"Delete"})]})]})})]})},Jj=({onBack:t})=>{const[n,r]=ce.useState("list"),[c,s]=ce.useState([]),[d,u]=ce.useState(void 0);ce.useEffect(()=>{p()},[]);const p=()=>{const x=wr();s(x)},f=()=>{u(void 0),r("create")},h=x=>{console.log("handleEdit called with protocol:",x),u(x),r("edit"),console.log("View set to edit, editingProtocol:",x)},_=x=>{B0(x),os(),p(),r("list"),u(void 0)},y=x=>{vt(x),os(),p(),r("list"),u(void 0)},m=x=>{vt(x),os(),p()},g=()=>{r("list"),u(void 0)};return o.jsxs("div",{className:"custom-protocol-creator",children:[n==="list"&&o.jsx(W0,{protocols:c,onCreateNew:f,onEdit:h,onDelete:_,onImport:m,onBack:t}),(n==="create"||n==="edit")&&o.jsx(Kj,{onSave:y,onCancel:g,onDelete:_,initialProtocol:d})]})},ek={id:"spirit-1-example",protocol:"Spirit",value:1,top:"When you play cards face-up, they may be played without matching protocols.",middle:"Draw 2 cards.",bottom:'<span class="emphasis">Start:</span> Either discard 1 card or flip this card.',isFaceUp:!0,category:"Main 1",keywords:{}},tk={id:"face-down-example",protocol:"Spirit",value:1,top:"",middle:"",bottom:"",isFaceUp:!1,category:"Main 1",keywords:{}},nk=[{id:"opp-light-4",protocol:"Light",value:4,top:"",middle:"Your opponent reveals their hand.",bottom:"",isFaceUp:!0,category:"Main 1",keywords:{reveal:!0}}],ak=[{id:"opp-spirit-3",protocol:"Spirit",value:3,top:"<div><span class='emphasis'>After you draw cards:</span> You may shift this card, even if this card is covered.</div>",middle:"",bottom:"",isFaceUp:!0,category:"Main 1",keywords:{shift:!0}},{id:"opp-spirit-2",protocol:"Spirit",value:2,top:"",middle:"You may flip 1 card.",bottom:"",isFaceUp:!0,category:"Main 1",keywords:{flip:!0}}],ok=[{id:"opp-water-3",protocol:"Water",value:3,top:"",middle:"Return all cards with a value of 2 in 1 line.",bottom:"",isFaceUp:!0,category:"Main 1",keywords:{return:!0}}],rk=[{id:"player-darkness-5",protocol:"Darkness",value:5,top:"",middle:"You discard 1 card.",bottom:"",isFaceUp:!0,category:"Main 1",keywords:{discard:!0}},{id:"player-facedown-0",protocol:"Darkness",value:2,top:"",middle:"",bottom:"",isFaceUp:!1,category:"Main 1",keywords:{}}],lk=[{id:"player-plague-1",protocol:"Plague",value:1,top:"<div><span class='emphasis'>After your opponent discards cards:</span> Draw 1 card.</div>",middle:"Your opponent discards 1 card.",bottom:"",isFaceUp:!0,category:"Main 1",keywords:{draw:!0,discard:!0}},{id:"player-plague-5",protocol:"Plague",value:5,top:"",middle:"You discard 1 card.",bottom:"",isFaceUp:!0,category:"Main 1",keywords:{discard:!0}},{id:"player-plague-4",protocol:"Plague",value:4,top:"",middle:"",bottom:"<div><span class='emphasis'>End:</span> Your opponent deletes 1 of their face-down cards. You may flip this card.</div>",isFaceUp:!0,category:"Main 1",keywords:{delete:!0,flip:!0}}],sk=[{id:"player-death-0",protocol:"Death",value:0,top:"",middle:"Delete 1 card from each other line.",bottom:"",isFaceUp:!0,category:"Main 1",keywords:{delete:!0}},{id:"player-facedown-3",protocol:"Death",value:2,top:"",middle:"",bottom:"",isFaceUp:!1,category:"Main 1",keywords:{}}],zo={opponent:["Light","Spirit","Water"],player:["Darkness","Plague","Death"],opponentCompiled:[!0,!1,!1],playerCompiled:[!1,!1,!1],opponentValues:[4,5,3],playerValues:[7,10,2]};function ck({onBack:t}){const n=[nk,ak,ok],r=[rk,lk,sk];return o.jsxs("div",{className:"screen rules-screen",children:[o.jsx($c,{title:"GAME RULES",onBack:t}),o.jsxs("div",{className:"rules-content",children:[o.jsxs("section",{className:"rules-section",children:[o.jsx("h2",{className:"section-title",children:"Objective"}),o.jsxs("div",{className:"rules-text",children:[o.jsxs("p",{children:["You play as an artificial intelligence trying to ",o.jsx("span",{className:"emphasis",children:"compile your 3 protocols"}),". Play command cards on protocols and execute their effects. If you reach a total value of",o.jsx("span",{className:"emphasis",children:" at least 10"})," with your cards on a protocol and exceed the opponent's total value in the same line, you may compile that protocol."]}),o.jsx("p",{className:"rules-highlight",children:"The first player to compile all 3 protocols wins!"})]})]}),o.jsxs("section",{className:"rules-section field-overview-section",children:[o.jsx("h2",{className:"section-title",children:"The Field"}),o.jsx("div",{className:"field-intro",children:o.jsxs("p",{children:["The field consists of ",o.jsx("span",{className:"emphasis",children:"3 lines"}),", each passing through two opposing protocols. Both players place cards on their side of each line. The goal is to build up value in your stacks to reach the compile threshold."]})}),o.jsxs("div",{className:"demo-board-container",children:[o.jsxs("div",{className:"demo-board",children:[o.jsx("div",{className:"demo-side-label opponent-label",children:"Opponent"}),o.jsx("div",{className:"demo-player-side demo-opponent-side",children:o.jsx("div",{className:"demo-lanes",children:n.map((c,s)=>o.jsx("div",{className:`demo-lane ${zo.opponentCompiled[s]?"demo-lane-compiled":""}`,children:o.jsx("div",{className:"demo-lane-stack",children:c.map((d,u)=>o.jsx(St,{card:d,isFaceUp:d.isFaceUp,style:{"--i":u},faceDownValue:2},d.id))})},`opp-lane-${s}`))})}),o.jsxs("div",{className:"demo-protocol-bars-container",children:[o.jsx("div",{className:"demo-protocol-bar demo-opponent-bar",children:zo.opponent.map((c,s)=>o.jsxs("div",{className:`demo-protocol-display ${zo.opponentCompiled[s]?"compiled":""}`,children:[o.jsx("span",{className:"demo-protocol-name",children:c}),o.jsx("span",{className:"demo-protocol-value",children:zo.opponentValues[s]})]},`opp-proto-${s}`))}),o.jsx("div",{className:"demo-protocol-bar demo-player-bar",children:zo.player.map((c,s)=>o.jsxs("div",{className:`demo-protocol-display ${zo.playerCompiled[s]?"compiled":""}`,children:[o.jsx("span",{className:"demo-protocol-name",children:c}),o.jsx("span",{className:"demo-protocol-value",children:zo.playerValues[s]})]},`player-proto-${s}`))})]}),o.jsx("div",{className:"demo-player-side",children:o.jsx("div",{className:"demo-lanes",children:r.map((c,s)=>o.jsx("div",{className:`demo-lane ${zo.playerCompiled[s]?"demo-lane-compiled":""} ${s===1?"demo-lane-compilable":""}`,children:o.jsx("div",{className:"demo-lane-stack",children:c.map((d,u)=>o.jsx(St,{card:d,isFaceUp:d.isFaceUp,style:{"--i":u},faceDownValue:2},d.id))})},`player-lane-${s}`))})}),o.jsx("div",{className:"demo-side-label player-label",children:"You"})]}),o.jsxs("div",{className:"demo-board-annotations",children:[o.jsxs("div",{className:"demo-annotation compiled-annotation",children:[o.jsx("div",{className:"demo-annotation-marker compiled-marker",children:"1"}),o.jsxs("div",{className:"demo-annotation-content",children:[o.jsx("strong",{children:"Compiled Protocol"}),o.jsx("p",{children:"Light has been compiled by the opponent! The protocol bar glows cyan."})]})]}),o.jsxs("div",{className:"demo-annotation compilable-annotation",children:[o.jsx("div",{className:"demo-annotation-marker compilable-marker",children:"2"}),o.jsxs("div",{className:"demo-annotation-content",children:[o.jsx("strong",{children:"Ready to Compile!"}),o.jsx("p",{children:"Plague has value 10 (1+5+4) which is 10 and higher than opponent's Spirit at 5. This protocol can be compiled!"})]})]}),o.jsxs("div",{className:"demo-annotation inprogress-annotation",children:[o.jsx("div",{className:"demo-annotation-marker inprogress-marker",children:"3"}),o.jsxs("div",{className:"demo-annotation-content",children:[o.jsx("strong",{children:"In Progress"}),o.jsx("p",{children:"Death/Water lanes are still building up. Keep playing cards to reach the compile threshold of 10!"})]})]}),o.jsxs("div",{className:"demo-annotation topbox-annotation",children:[o.jsx("div",{className:"demo-annotation-marker topbox-marker",children:"4"}),o.jsxs("div",{className:"demo-annotation-content",children:[o.jsx("strong",{children:"Top Effect Always Visible"}),o.jsx("p",{children:"See Plague-1's top effect? It stays active even when covered! Top effects are always visible and active on face-up cards."})]})]})]})]}),o.jsxs("div",{className:"field-legend",children:[o.jsxs("div",{className:"legend-item",children:[o.jsx("div",{className:"legend-swatch legend-compiled"}),o.jsx("span",{children:"Compiled Protocol"})]}),o.jsxs("div",{className:"legend-item",children:[o.jsx("div",{className:"legend-swatch legend-compilable"}),o.jsx("span",{children:"Ready to Compile (10 value & higher than opponent)"})]}),o.jsxs("div",{className:"legend-item",children:[o.jsx("div",{className:"legend-swatch legend-facedown"}),o.jsx("span",{children:"Face-down Card (base value: 2)"})]})]})]}),o.jsxs("section",{className:"rules-section card-anatomy-section",children:[o.jsx("h2",{className:"section-title",children:"Card Anatomy"}),o.jsxs("div",{className:"card-anatomy-layout",children:[o.jsx("div",{className:"card-anatomy-display",children:o.jsxs("div",{className:"anatomy-card-wrapper",children:[o.jsx(St,{card:ek,isFaceUp:!0}),o.jsxs("div",{className:"anatomy-annotation annotation-protocol",children:[o.jsx("div",{className:"annotation-line annotation-line-left"}),o.jsxs("div",{className:"annotation-label",children:[o.jsx("span",{className:"annotation-letter",children:"A"}),o.jsx("span",{className:"annotation-text",children:"Protocol"})]})]}),o.jsxs("div",{className:"anatomy-annotation annotation-value",children:[o.jsx("div",{className:"annotation-line annotation-line-right"}),o.jsxs("div",{className:"annotation-label",children:[o.jsx("span",{className:"annotation-letter",children:"B"}),o.jsx("span",{className:"annotation-text",children:"Value"})]})]}),o.jsxs("div",{className:"anatomy-annotation annotation-top",children:[o.jsx("div",{className:"annotation-line annotation-line-right"}),o.jsxs("div",{className:"annotation-label",children:[o.jsx("span",{className:"annotation-letter",children:"C"}),o.jsx("span",{className:"annotation-text",children:"Top Effect"})]})]}),o.jsxs("div",{className:"anatomy-annotation annotation-middle",children:[o.jsx("div",{className:"annotation-line annotation-line-right"}),o.jsxs("div",{className:"annotation-label",children:[o.jsx("span",{className:"annotation-letter",children:"D"}),o.jsx("span",{className:"annotation-text",children:"Middle Effect"})]})]}),o.jsxs("div",{className:"anatomy-annotation annotation-bottom",children:[o.jsx("div",{className:"annotation-line annotation-line-right"}),o.jsxs("div",{className:"annotation-label",children:[o.jsx("span",{className:"annotation-letter",children:"E"}),o.jsx("span",{className:"annotation-text",children:"Bottom Effect"})]})]})]})}),o.jsxs("div",{className:"card-anatomy-descriptions",children:[o.jsxs("div",{className:"anatomy-item",children:[o.jsx("span",{className:"anatomy-letter",children:"A"}),o.jsxs("div",{className:"anatomy-desc",children:[o.jsx("strong",{children:"Protocol Indicator"}),o.jsx("p",{children:"Dictates which line a card can be played face-up in. Cards must match the protocol of that line."})]})]}),o.jsxs("div",{className:"anatomy-item",children:[o.jsx("span",{className:"anatomy-letter",children:"B"}),o.jsxs("div",{className:"anatomy-desc",children:[o.jsx("strong",{children:"Value"}),o.jsx("p",{children:"The value added to the total value of a stack. Higher values help you reach the compile threshold of 10."})]})]}),o.jsxs("div",{className:"anatomy-item anatomy-item-highlight",children:[o.jsx("span",{className:"anatomy-letter",children:"C"}),o.jsxs("div",{className:"anatomy-desc",children:[o.jsx("strong",{children:"Top Command - Persistent"}),o.jsxs("p",{children:["While this card is face-up, this passive text is ",o.jsx("span",{className:"emphasis",children:"always active"}),", even when covered by other cards."]})]})]}),o.jsxs("div",{className:"anatomy-item anatomy-item-highlight",children:[o.jsx("span",{className:"anatomy-letter",children:"D"}),o.jsxs("div",{className:"anatomy-desc",children:[o.jsx("strong",{children:"Middle Command - Immediate"}),o.jsx("p",{children:"Resolve this active text immediately when the card is played, flipped face-up, or uncovered."})]})]}),o.jsxs("div",{className:"anatomy-item anatomy-item-highlight",children:[o.jsx("span",{className:"anatomy-letter",children:"E"}),o.jsxs("div",{className:"anatomy-desc",children:[o.jsx("strong",{children:"Bottom Command - Auxiliary"}),o.jsxs("p",{children:['This passive text (often triggered effects like "Start:" or "End:") is only active when the card is ',o.jsx("span",{className:"emphasis",children:"uncovered"}),"."]})]})]})]})]})]}),o.jsxs("section",{className:"rules-section face-down-section",children:[o.jsx("h2",{className:"section-title",children:"Face-Down Cards"}),o.jsxs("div",{className:"face-down-layout",children:[o.jsx("div",{className:"face-down-card-wrapper",children:o.jsx(St,{card:tk,isFaceUp:!1,faceDownValue:2})}),o.jsxs("div",{className:"face-down-description",children:[o.jsxs("p",{children:["Cards can be played ",o.jsx("span",{className:"emphasis",children:"face-down"})," into any line, regardless of protocol matching."]}),o.jsxs("ul",{children:[o.jsxs("li",{children:["Face-down cards have a ",o.jsx("span",{className:"emphasis",children:"base value of 2"})]}),o.jsx("li",{children:"No effects are active while face-down"}),o.jsx("li",{children:"Can be flipped face-up by card effects"}),o.jsx("li",{children:"When flipped, the middle effect triggers"}),o.jsx("li",{children:"Some cards modify face-down values (e.g., Darkness-2)"})]})]})]})]}),o.jsxs("section",{className:"rules-section",children:[o.jsx("h2",{className:"section-title",children:"Turn Order"}),o.jsxs("div",{className:"turn-order-grid",children:[o.jsxs("div",{className:"turn-phase",children:[o.jsx("span",{className:"phase-number",children:"1"}),o.jsxs("div",{className:"phase-content",children:[o.jsx("strong",{children:"Start Phase"}),o.jsx("p",{children:'Resolve all visible "Start" effects of your face-up command cards.'})]})]}),o.jsxs("div",{className:"turn-phase",children:[o.jsx("span",{className:"phase-number",children:"2"}),o.jsxs("div",{className:"phase-content",children:[o.jsx("strong",{children:"Check Control"}),o.jsx("p",{children:"If your total value is higher than opponent's in at least 2 lines, take the control component."})]})]}),o.jsxs("div",{className:"turn-phase",children:[o.jsx("span",{className:"phase-number",children:"3"}),o.jsxs("div",{className:"phase-content",children:[o.jsx("strong",{children:"Check Compile"}),o.jsx("p",{children:"If you can compile (10+ value and higher than opponent), you must compile one protocol."})]})]}),o.jsxs("div",{className:"turn-phase",children:[o.jsx("span",{className:"phase-number",children:"4"}),o.jsxs("div",{className:"phase-content",children:[o.jsx("strong",{children:"Action"}),o.jsx("p",{children:"Play 1 card from hand OR refresh your hand (draw until you have 5 cards)."})]})]}),o.jsxs("div",{className:"turn-phase",children:[o.jsx("span",{className:"phase-number",children:"5"}),o.jsxs("div",{className:"phase-content",children:[o.jsx("strong",{children:"Check Cache"}),o.jsx("p",{children:"If you have more than 5 cards, discard down to 5."})]})]}),o.jsxs("div",{className:"turn-phase",children:[o.jsx("span",{className:"phase-number",children:"6"}),o.jsxs("div",{className:"phase-content",children:[o.jsx("strong",{children:"End Phase"}),o.jsx("p",{children:'Resolve all visible "End" effects of your face-up command cards.'})]})]})]})]}),o.jsxs("section",{className:"rules-section glossary-section",children:[o.jsx("h2",{className:"section-title",children:"Glossary"}),o.jsxs("div",{className:"glossary-grid",children:[o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Compile"}),o.jsx("p",{children:'Delete all cards in a line on both sides and flip your protocol to "Compiled".'})]}),o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Covered"}),o.jsx("p",{children:"A card with another card on top of it. Only top effects remain active."})]}),o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Uncovered"}),o.jsx("p",{children:"The topmost card in a stack, furthest from the protocol."})]}),o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Delete"}),o.jsx("p",{children:"Move a card from the field to the trash."})]}),o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Discard"}),o.jsx("p",{children:"Move a card from hand to the owner's trash."})]}),o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Flip"}),o.jsx("p",{children:"Change a card from face-down to face-up, or vice versa."})]}),o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Shift"}),o.jsx("p",{children:"Move a card to another line on the same side of the field."})]}),o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Return"}),o.jsx("p",{children:"Move a card from the field to its owner's hand."})]}),o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Reveal"}),o.jsx("p",{children:"Show hidden information publicly, then return it to its previous state."})]}),o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Refresh"}),o.jsx("p",{children:"Draw cards until you have 5 cards in hand."})]}),o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Line"}),o.jsx("p",{children:"The area passing through two opposing protocols. The field has 3 lines."})]}),o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Stack"}),o.jsx("p",{children:"The cards in a line on one player's side."})]})]})]})]})]})}function ik(){const[t,n]=ce.useState("MainMenu"),[r,c]=ce.useState([]),[s,d]=ce.useState([]),[u,p]=ce.useState(null),[f,h]=ce.useState("easy"),[_,y]=ce.useState(null),[m,g]=ce.useState(!0),[x,C]=ce.useState("player"),[b,j]=ce.useState(null);ce.useEffect(()=>{lj()},[]),ce.useEffect(()=>{const U=new URLSearchParams(window.location.search),D=U.get("testScenario"),I=U.get("scenario");if(D&&(console.log(`[E2E] Loading JSON test scenario: ${D}`),fetch(`/e2e/scenarios/${D}.json`).then(W=>{if(!W.ok)throw new Error(`Scenario not found: ${D}`);return W.json()}).then(W=>{console.log("[E2E] Scenario loaded:",W),h(W.difficulty),g(W.useControlMechanic),c(W.playerProtocols),d(W.opponentProtocols),C(W.startingPlayer),n("GameScreen")}).catch(W=>{console.error("[E2E] Failed to load scenario:",W)})),I){console.log(`[E2E] Loading complex scenario: ${I}`);const W=cu[I];W?(console.log("[E2E] Complex scenario found:",W.name),j(()=>W.setup),c(["Fire","Water","Speed"]),d(["Death","Life","Light"]),h("easy"),g(!1),n("GameScreen")):(console.error(`[E2E] Scenario not found: ${I}`),console.log("[E2E] Available scenarios:",Object.keys(cu).filter(z=>z.startsWith("scenario"))))}},[]);const k=ce.useCallback(()=>{n("MainMenu"),c([]),d([]),p(null),y(null)},[]);ce.useEffect(()=>{const U=D=>{D.key==="Escape"&&k()};return window.addEventListener("keydown",U),()=>{window.removeEventListener("keydown",U)}},[k]);const E=ce.useCallback((U,D)=>{c(U),d(D),p(null),y(null),C("player"),n("GameScreen")},[]),T=ce.useCallback((U,D)=>{p(U),y(D),n("ResultsScreen")},[]),F=()=>{switch(t){case"MainMenu":return o.jsx(um,{onNavigate:U=>n(U),difficulty:f,setDifficulty:h,useControl:m,onUseControlChange:g});case"ProtocolSelection":return o.jsx(Z0,{onBack:k,onStartGame:E});case"GameScreen":return o.jsx(Tj,{onBack:k,onEndGame:T,playerProtocols:r,opponentProtocols:s,difficulty:f,useControlMechanic:m,startingPlayer:x,initialScenarioSetup:b});case"ResultsScreen":return o.jsx(Rj,{onPlayAgain:k,winner:u,finalState:_,difficulty:f});case"CardLibrary":return o.jsx(Dj,{onBack:k});case"Statistics":return o.jsx(Aj,{onBack:k});case"CustomProtocols":return o.jsx(Jj,{onBack:k});case"Rules":return o.jsx(ck,{onBack:k});default:return o.jsx(um,{onNavigate:U=>n(U),difficulty:f,setDifficulty:h,useControl:m,onUseControlChange:g})}};return o.jsx(o.Fragment,{children:F()})}const dk=document.getElementById("root"),uk=U0.createRoot(dk);uk.render(o.jsx(ik,{}));
