(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))s(c);new MutationObserver(c=>{for(const d of c)if(d.type==="childList")for(const u of d.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&s(u)}).observe(document,{childList:!0,subtree:!0});function r(c){const d={};return c.integrity&&(d.integrity=c.integrity),c.referrerPolicy&&(d.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?d.credentials="include":c.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function s(c){if(c.ep)return;c.ep=!0;const d=r(c);fetch(c.href,d)}})();var Xd={exports:{}},ds={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Cm;function vw(){if(Cm)return ds;Cm=1;var t=Symbol.for("react.transitional.element"),n=Symbol.for("react.fragment");function r(s,c,d){var u=null;if(d!==void 0&&(u=""+d),c.key!==void 0&&(u=""+c.key),"key"in c){d={};for(var p in c)p!=="key"&&(d[p]=c[p])}else d=c;return c=d.ref,{$$typeof:t,type:s,key:u,ref:c!==void 0?c:null,props:d}}return ds.Fragment=n,ds.jsx=r,ds.jsxs=r,ds}var Sm;function _w(){return Sm||(Sm=1,Xd.exports=vw()),Xd.exports}var o=_w(),Zd={exports:{}},us={},Kd={exports:{}},Jd={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var bm;function ww(){return bm||(bm=1,(function(t){function n(A,N){var T=A.length;A.push(N);e:for(;0<T;){var q=T-1>>>1,O=A[q];if(0<c(O,N))A[q]=N,A[T]=O,T=q;else break e}}function r(A){return A.length===0?null:A[0]}function s(A){if(A.length===0)return null;var N=A[0],T=A.pop();if(T!==N){A[0]=T;e:for(var q=0,O=A.length,M=O>>>1;q<M;){var Y=2*(q+1)-1,X=A[Y],K=Y+1,ne=A[K];if(0>c(X,T))K<O&&0>c(ne,X)?(A[q]=ne,A[K]=T,q=K):(A[q]=X,A[Y]=T,q=Y);else if(K<O&&0>c(ne,T))A[q]=ne,A[K]=T,q=K;else break e}}return N}function c(A,N){var T=A.sortIndex-N.sortIndex;return T!==0?T:A.id-N.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var d=performance;t.unstable_now=function(){return d.now()}}else{var u=Date,p=u.now();t.unstable_now=function(){return u.now()-p}}var f=[],h=[],y=1,m=null,g=3,v=!1,C=!1,b=!1,x=!1,j=typeof setTimeout=="function"?setTimeout:null,E=typeof clearTimeout=="function"?clearTimeout:null,k=typeof setImmediate<"u"?setImmediate:null;function R(A){for(var N=r(h);N!==null;){if(N.callback===null)s(h);else if(N.startTime<=A)s(h),N.sortIndex=N.expirationTime,n(f,N);else break;N=r(h)}}function D(A){if(b=!1,R(A),!C)if(r(f)!==null)C=!0,L||(L=!0,W());else{var N=r(h);N!==null&&H(D,N.startTime-A)}}var L=!1,I=-1,F=5,U=-1;function B(){return x?!0:!(t.unstable_now()-U<F)}function G(){if(x=!1,L){var A=t.unstable_now();U=A;var N=!0;try{e:{C=!1,b&&(b=!1,E(I),I=-1),v=!0;var T=g;try{t:{for(R(A),m=r(f);m!==null&&!(m.expirationTime>A&&B());){var q=m.callback;if(typeof q=="function"){m.callback=null,g=m.priorityLevel;var O=q(m.expirationTime<=A);if(A=t.unstable_now(),typeof O=="function"){m.callback=O,R(A),N=!0;break t}m===r(f)&&s(f),R(A)}else s(f);m=r(f)}if(m!==null)N=!0;else{var M=r(h);M!==null&&H(D,M.startTime-A),N=!1}}break e}finally{m=null,g=T,v=!1}N=void 0}}finally{N?W():L=!1}}}var W;if(typeof k=="function")W=function(){k(G)};else if(typeof MessageChannel<"u"){var P=new MessageChannel,z=P.port2;P.port1.onmessage=G,W=function(){z.postMessage(null)}}else W=function(){j(G,0)};function H(A,N){I=j(function(){A(t.unstable_now())},N)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(A){A.callback=null},t.unstable_forceFrameRate=function(A){0>A||125<A?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):F=0<A?Math.floor(1e3/A):5},t.unstable_getCurrentPriorityLevel=function(){return g},t.unstable_next=function(A){switch(g){case 1:case 2:case 3:var N=3;break;default:N=g}var T=g;g=N;try{return A()}finally{g=T}},t.unstable_requestPaint=function(){x=!0},t.unstable_runWithPriority=function(A,N){switch(A){case 1:case 2:case 3:case 4:case 5:break;default:A=3}var T=g;g=A;try{return N()}finally{g=T}},t.unstable_scheduleCallback=function(A,N,T){var q=t.unstable_now();switch(typeof T=="object"&&T!==null?(T=T.delay,T=typeof T=="number"&&0<T?q+T:q):T=q,A){case 1:var O=-1;break;case 2:O=250;break;case 5:O=1073741823;break;case 4:O=1e4;break;default:O=5e3}return O=T+O,A={id:y++,callback:N,priorityLevel:A,startTime:T,expirationTime:O,sortIndex:-1},T>q?(A.sortIndex=T,n(h,A),r(f)===null&&A===r(h)&&(b?(E(I),I=-1):b=!0,H(D,T-q))):(A.sortIndex=O,n(f,A),C||v||(C=!0,L||(L=!0,W()))),A},t.unstable_shouldYield=B,t.unstable_wrapCallback=function(A){var N=g;return function(){var T=g;g=N;try{return A.apply(this,arguments)}finally{g=T}}}})(Jd)),Jd}var Em;function xw(){return Em||(Em=1,Kd.exports=ww()),Kd.exports}var eu={exports:{}},ut={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var jm;function Cw(){if(jm)return ut;jm=1;var t=Symbol.for("react.transitional.element"),n=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),c=Symbol.for("react.profiler"),d=Symbol.for("react.consumer"),u=Symbol.for("react.context"),p=Symbol.for("react.forward_ref"),f=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),y=Symbol.for("react.lazy"),m=Symbol.for("react.activity"),g=Symbol.iterator;function v(M){return M===null||typeof M!="object"?null:(M=g&&M[g]||M["@@iterator"],typeof M=="function"?M:null)}var C={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},b=Object.assign,x={};function j(M,Y,X){this.props=M,this.context=Y,this.refs=x,this.updater=X||C}j.prototype.isReactComponent={},j.prototype.setState=function(M,Y){if(typeof M!="object"&&typeof M!="function"&&M!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,M,Y,"setState")},j.prototype.forceUpdate=function(M){this.updater.enqueueForceUpdate(this,M,"forceUpdate")};function E(){}E.prototype=j.prototype;function k(M,Y,X){this.props=M,this.context=Y,this.refs=x,this.updater=X||C}var R=k.prototype=new E;R.constructor=k,b(R,j.prototype),R.isPureReactComponent=!0;var D=Array.isArray;function L(){}var I={H:null,A:null,T:null,S:null},F=Object.prototype.hasOwnProperty;function U(M,Y,X){var K=X.ref;return{$$typeof:t,type:M,key:Y,ref:K!==void 0?K:null,props:X}}function B(M,Y){return U(M.type,Y,M.props)}function G(M){return typeof M=="object"&&M!==null&&M.$$typeof===t}function W(M){var Y={"=":"=0",":":"=2"};return"$"+M.replace(/[=:]/g,function(X){return Y[X]})}var P=/\/+/g;function z(M,Y){return typeof M=="object"&&M!==null&&M.key!=null?W(""+M.key):Y.toString(36)}function H(M){switch(M.status){case"fulfilled":return M.value;case"rejected":throw M.reason;default:switch(typeof M.status=="string"?M.then(L,L):(M.status="pending",M.then(function(Y){M.status==="pending"&&(M.status="fulfilled",M.value=Y)},function(Y){M.status==="pending"&&(M.status="rejected",M.reason=Y)})),M.status){case"fulfilled":return M.value;case"rejected":throw M.reason}}throw M}function A(M,Y,X,K,ne){var Z=typeof M;(Z==="undefined"||Z==="boolean")&&(M=null);var oe=!1;if(M===null)oe=!0;else switch(Z){case"bigint":case"string":case"number":oe=!0;break;case"object":switch(M.$$typeof){case t:case n:oe=!0;break;case y:return oe=M._init,A(oe(M._payload),Y,X,K,ne)}}if(oe)return ne=ne(M),oe=K===""?"."+z(M,0):K,D(ne)?(X="",oe!=null&&(X=oe.replace(P,"$&/")+"/"),A(ne,Y,X,"",function(Ce){return Ce})):ne!=null&&(G(ne)&&(ne=B(ne,X+(ne.key==null||M&&M.key===ne.key?"":(""+ne.key).replace(P,"$&/")+"/")+oe)),Y.push(ne)),1;oe=0;var xe=K===""?".":K+":";if(D(M))for(var ye=0;ye<M.length;ye++)K=M[ye],Z=xe+z(K,ye),oe+=A(K,Y,X,Z,ne);else if(ye=v(M),typeof ye=="function")for(M=ye.call(M),ye=0;!(K=M.next()).done;)K=K.value,Z=xe+z(K,ye++),oe+=A(K,Y,X,Z,ne);else if(Z==="object"){if(typeof M.then=="function")return A(H(M),Y,X,K,ne);throw Y=String(M),Error("Objects are not valid as a React child (found: "+(Y==="[object Object]"?"object with keys {"+Object.keys(M).join(", ")+"}":Y)+"). If you meant to render a collection of children, use an array instead.")}return oe}function N(M,Y,X){if(M==null)return M;var K=[],ne=0;return A(M,K,"","",function(Z){return Y.call(X,Z,ne++)}),K}function T(M){if(M._status===-1){var Y=M._result;Y=Y(),Y.then(function(X){(M._status===0||M._status===-1)&&(M._status=1,M._result=X)},function(X){(M._status===0||M._status===-1)&&(M._status=2,M._result=X)}),M._status===-1&&(M._status=0,M._result=Y)}if(M._status===1)return M._result.default;throw M._result}var q=typeof reportError=="function"?reportError:function(M){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Y=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof M=="object"&&M!==null&&typeof M.message=="string"?String(M.message):String(M),error:M});if(!window.dispatchEvent(Y))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",M);return}console.error(M)},O={map:N,forEach:function(M,Y,X){N(M,function(){Y.apply(this,arguments)},X)},count:function(M){var Y=0;return N(M,function(){Y++}),Y},toArray:function(M){return N(M,function(Y){return Y})||[]},only:function(M){if(!G(M))throw Error("React.Children.only expected to receive a single React element child.");return M}};return ut.Activity=m,ut.Children=O,ut.Component=j,ut.Fragment=r,ut.Profiler=c,ut.PureComponent=k,ut.StrictMode=s,ut.Suspense=f,ut.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=I,ut.__COMPILER_RUNTIME={__proto__:null,c:function(M){return I.H.useMemoCache(M)}},ut.cache=function(M){return function(){return M.apply(null,arguments)}},ut.cacheSignal=function(){return null},ut.cloneElement=function(M,Y,X){if(M==null)throw Error("The argument must be a React element, but you passed "+M+".");var K=b({},M.props),ne=M.key;if(Y!=null)for(Z in Y.key!==void 0&&(ne=""+Y.key),Y)!F.call(Y,Z)||Z==="key"||Z==="__self"||Z==="__source"||Z==="ref"&&Y.ref===void 0||(K[Z]=Y[Z]);var Z=arguments.length-2;if(Z===1)K.children=X;else if(1<Z){for(var oe=Array(Z),xe=0;xe<Z;xe++)oe[xe]=arguments[xe+2];K.children=oe}return U(M.type,ne,K)},ut.createContext=function(M){return M={$$typeof:u,_currentValue:M,_currentValue2:M,_threadCount:0,Provider:null,Consumer:null},M.Provider=M,M.Consumer={$$typeof:d,_context:M},M},ut.createElement=function(M,Y,X){var K,ne={},Z=null;if(Y!=null)for(K in Y.key!==void 0&&(Z=""+Y.key),Y)F.call(Y,K)&&K!=="key"&&K!=="__self"&&K!=="__source"&&(ne[K]=Y[K]);var oe=arguments.length-2;if(oe===1)ne.children=X;else if(1<oe){for(var xe=Array(oe),ye=0;ye<oe;ye++)xe[ye]=arguments[ye+2];ne.children=xe}if(M&&M.defaultProps)for(K in oe=M.defaultProps,oe)ne[K]===void 0&&(ne[K]=oe[K]);return U(M,Z,ne)},ut.createRef=function(){return{current:null}},ut.forwardRef=function(M){return{$$typeof:p,render:M}},ut.isValidElement=G,ut.lazy=function(M){return{$$typeof:y,_payload:{_status:-1,_result:M},_init:T}},ut.memo=function(M,Y){return{$$typeof:h,type:M,compare:Y===void 0?null:Y}},ut.startTransition=function(M){var Y=I.T,X={};I.T=X;try{var K=M(),ne=I.S;ne!==null&&ne(X,K),typeof K=="object"&&K!==null&&typeof K.then=="function"&&K.then(L,q)}catch(Z){q(Z)}finally{Y!==null&&X.types!==null&&(Y.types=X.types),I.T=Y}},ut.unstable_useCacheRefresh=function(){return I.H.useCacheRefresh()},ut.use=function(M){return I.H.use(M)},ut.useActionState=function(M,Y,X){return I.H.useActionState(M,Y,X)},ut.useCallback=function(M,Y){return I.H.useCallback(M,Y)},ut.useContext=function(M){return I.H.useContext(M)},ut.useDebugValue=function(){},ut.useDeferredValue=function(M,Y){return I.H.useDeferredValue(M,Y)},ut.useEffect=function(M,Y){return I.H.useEffect(M,Y)},ut.useEffectEvent=function(M){return I.H.useEffectEvent(M)},ut.useId=function(){return I.H.useId()},ut.useImperativeHandle=function(M,Y,X){return I.H.useImperativeHandle(M,Y,X)},ut.useInsertionEffect=function(M,Y){return I.H.useInsertionEffect(M,Y)},ut.useLayoutEffect=function(M,Y){return I.H.useLayoutEffect(M,Y)},ut.useMemo=function(M,Y){return I.H.useMemo(M,Y)},ut.useOptimistic=function(M,Y){return I.H.useOptimistic(M,Y)},ut.useReducer=function(M,Y,X){return I.H.useReducer(M,Y,X)},ut.useRef=function(M){return I.H.useRef(M)},ut.useState=function(M){return I.H.useState(M)},ut.useSyncExternalStore=function(M,Y,X){return I.H.useSyncExternalStore(M,Y,X)},ut.useTransition=function(){return I.H.useTransition()},ut.version="19.2.3",ut}var km;function Nu(){return km||(km=1,eu.exports=Cw()),eu.exports}var tu={exports:{}},bn={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Rm;function Sw(){if(Rm)return bn;Rm=1;var t=Nu();function n(f){var h="https://react.dev/errors/"+f;if(1<arguments.length){h+="?args[]="+encodeURIComponent(arguments[1]);for(var y=2;y<arguments.length;y++)h+="&args[]="+encodeURIComponent(arguments[y])}return"Minified React error #"+f+"; visit "+h+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function r(){}var s={d:{f:r,r:function(){throw Error(n(522))},D:r,C:r,L:r,m:r,X:r,S:r,M:r},p:0,findDOMNode:null},c=Symbol.for("react.portal");function d(f,h,y){var m=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:c,key:m==null?null:""+m,children:f,containerInfo:h,implementation:y}}var u=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function p(f,h){if(f==="font")return"";if(typeof h=="string")return h==="use-credentials"?h:""}return bn.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=s,bn.createPortal=function(f,h){var y=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11)throw Error(n(299));return d(f,h,null,y)},bn.flushSync=function(f){var h=u.T,y=s.p;try{if(u.T=null,s.p=2,f)return f()}finally{u.T=h,s.p=y,s.d.f()}},bn.preconnect=function(f,h){typeof f=="string"&&(h?(h=h.crossOrigin,h=typeof h=="string"?h==="use-credentials"?h:"":void 0):h=null,s.d.C(f,h))},bn.prefetchDNS=function(f){typeof f=="string"&&s.d.D(f)},bn.preinit=function(f,h){if(typeof f=="string"&&h&&typeof h.as=="string"){var y=h.as,m=p(y,h.crossOrigin),g=typeof h.integrity=="string"?h.integrity:void 0,v=typeof h.fetchPriority=="string"?h.fetchPriority:void 0;y==="style"?s.d.S(f,typeof h.precedence=="string"?h.precedence:void 0,{crossOrigin:m,integrity:g,fetchPriority:v}):y==="script"&&s.d.X(f,{crossOrigin:m,integrity:g,fetchPriority:v,nonce:typeof h.nonce=="string"?h.nonce:void 0})}},bn.preinitModule=function(f,h){if(typeof f=="string")if(typeof h=="object"&&h!==null){if(h.as==null||h.as==="script"){var y=p(h.as,h.crossOrigin);s.d.M(f,{crossOrigin:y,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0})}}else h==null&&s.d.M(f)},bn.preload=function(f,h){if(typeof f=="string"&&typeof h=="object"&&h!==null&&typeof h.as=="string"){var y=h.as,m=p(y,h.crossOrigin);s.d.L(f,y,{crossOrigin:m,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0,type:typeof h.type=="string"?h.type:void 0,fetchPriority:typeof h.fetchPriority=="string"?h.fetchPriority:void 0,referrerPolicy:typeof h.referrerPolicy=="string"?h.referrerPolicy:void 0,imageSrcSet:typeof h.imageSrcSet=="string"?h.imageSrcSet:void 0,imageSizes:typeof h.imageSizes=="string"?h.imageSizes:void 0,media:typeof h.media=="string"?h.media:void 0})}},bn.preloadModule=function(f,h){if(typeof f=="string")if(h){var y=p(h.as,h.crossOrigin);s.d.m(f,{as:typeof h.as=="string"&&h.as!=="script"?h.as:void 0,crossOrigin:y,integrity:typeof h.integrity=="string"?h.integrity:void 0})}else s.d.m(f)},bn.requestFormReset=function(f){s.d.r(f)},bn.unstable_batchedUpdates=function(f,h){return f(h)},bn.useFormState=function(f,h,y){return u.H.useFormState(f,h,y)},bn.useFormStatus=function(){return u.H.useHostTransitionStatus()},bn.version="19.2.3",bn}var Nm;function bw(){if(Nm)return tu.exports;Nm=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(n){console.error(n)}}return t(),tu.exports=Sw(),tu.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Tm;function Ew(){if(Tm)return us;Tm=1;var t=xw(),n=Nu(),r=bw();function s(e){var a="https://react.dev/errors/"+e;if(1<arguments.length){a+="?args[]="+encodeURIComponent(arguments[1]);for(var l=2;l<arguments.length;l++)a+="&args[]="+encodeURIComponent(arguments[l])}return"Minified React error #"+e+"; visit "+a+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function c(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function d(e){var a=e,l=e;if(e.alternate)for(;a.return;)a=a.return;else{e=a;do a=e,(a.flags&4098)!==0&&(l=a.return),e=a.return;while(e)}return a.tag===3?l:null}function u(e){if(e.tag===13){var a=e.memoizedState;if(a===null&&(e=e.alternate,e!==null&&(a=e.memoizedState)),a!==null)return a.dehydrated}return null}function p(e){if(e.tag===31){var a=e.memoizedState;if(a===null&&(e=e.alternate,e!==null&&(a=e.memoizedState)),a!==null)return a.dehydrated}return null}function f(e){if(d(e)!==e)throw Error(s(188))}function h(e){var a=e.alternate;if(!a){if(a=d(e),a===null)throw Error(s(188));return a!==e?null:e}for(var l=e,i=a;;){var _=l.return;if(_===null)break;var S=_.alternate;if(S===null){if(i=_.return,i!==null){l=i;continue}break}if(_.child===S.child){for(S=_.child;S;){if(S===l)return f(_),e;if(S===i)return f(_),a;S=S.sibling}throw Error(s(188))}if(l.return!==i.return)l=_,i=S;else{for(var $=!1,Q=_.child;Q;){if(Q===l){$=!0,l=_,i=S;break}if(Q===i){$=!0,i=_,l=S;break}Q=Q.sibling}if(!$){for(Q=S.child;Q;){if(Q===l){$=!0,l=S,i=_;break}if(Q===i){$=!0,i=S,l=_;break}Q=Q.sibling}if(!$)throw Error(s(189))}}if(l.alternate!==i)throw Error(s(190))}if(l.tag!==3)throw Error(s(188));return l.stateNode.current===l?e:a}function y(e){var a=e.tag;if(a===5||a===26||a===27||a===6)return e;for(e=e.child;e!==null;){if(a=y(e),a!==null)return a;e=e.sibling}return null}var m=Object.assign,g=Symbol.for("react.element"),v=Symbol.for("react.transitional.element"),C=Symbol.for("react.portal"),b=Symbol.for("react.fragment"),x=Symbol.for("react.strict_mode"),j=Symbol.for("react.profiler"),E=Symbol.for("react.consumer"),k=Symbol.for("react.context"),R=Symbol.for("react.forward_ref"),D=Symbol.for("react.suspense"),L=Symbol.for("react.suspense_list"),I=Symbol.for("react.memo"),F=Symbol.for("react.lazy"),U=Symbol.for("react.activity"),B=Symbol.for("react.memo_cache_sentinel"),G=Symbol.iterator;function W(e){return e===null||typeof e!="object"?null:(e=G&&e[G]||e["@@iterator"],typeof e=="function"?e:null)}var P=Symbol.for("react.client.reference");function z(e){if(e==null)return null;if(typeof e=="function")return e.$$typeof===P?null:e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case b:return"Fragment";case j:return"Profiler";case x:return"StrictMode";case D:return"Suspense";case L:return"SuspenseList";case U:return"Activity"}if(typeof e=="object")switch(e.$$typeof){case C:return"Portal";case k:return e.displayName||"Context";case E:return(e._context.displayName||"Context")+".Consumer";case R:var a=e.render;return e=e.displayName,e||(e=a.displayName||a.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case I:return a=e.displayName||null,a!==null?a:z(e.type)||"Memo";case F:a=e._payload,e=e._init;try{return z(e(a))}catch{}}return null}var H=Array.isArray,A=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,N=r.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,T={pending:!1,data:null,method:null,action:null},q=[],O=-1;function M(e){return{current:e}}function Y(e){0>O||(e.current=q[O],q[O]=null,O--)}function X(e,a){O++,q[O]=e.current,e.current=a}var K=M(null),ne=M(null),Z=M(null),oe=M(null);function xe(e,a){switch(X(Z,a),X(ne,e),X(K,null),a.nodeType){case 9:case 11:e=(e=a.documentElement)&&(e=e.namespaceURI)?Bh(e):0;break;default:if(e=a.tagName,a=a.namespaceURI)a=Bh(a),e=Gh(a,e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}Y(K),X(K,e)}function ye(){Y(K),Y(ne),Y(Z)}function Ce(e){e.memoizedState!==null&&X(oe,e);var a=K.current,l=Gh(a,e.type);a!==l&&(X(ne,e),X(K,l))}function pe(e){ne.current===e&&(Y(K),Y(ne)),oe.current===e&&(Y(oe),ls._currentValue=T)}var _e,ee;function je(e){if(_e===void 0)try{throw Error()}catch(l){var a=l.stack.trim().match(/\n( *(at )?)/);_e=a&&a[1]||"",ee=-1<l.stack.indexOf(`
    at`)?" (<anonymous>)":-1<l.stack.indexOf("@")?"@unknown:0:0":""}return`
`+_e+e+ee}var de=!1;function Pe(e,a){if(!e||de)return"";de=!0;var l=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var i={DetermineComponentFrameRoot:function(){try{if(a){var $e=function(){throw Error()};if(Object.defineProperty($e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct($e,[])}catch(Ee){var ve=Ee}Reflect.construct(e,[],$e)}else{try{$e.call()}catch(Ee){ve=Ee}e.call($e.prototype)}}else{try{throw Error()}catch(Ee){ve=Ee}($e=e())&&typeof $e.catch=="function"&&$e.catch(function(){})}}catch(Ee){if(Ee&&ve&&typeof Ee.stack=="string")return[Ee.stack,ve.stack]}return[null,null]}};i.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var _=Object.getOwnPropertyDescriptor(i.DetermineComponentFrameRoot,"name");_&&_.configurable&&Object.defineProperty(i.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var S=i.DetermineComponentFrameRoot(),$=S[0],Q=S[1];if($&&Q){var ae=$.split(`
`),me=Q.split(`
`);for(_=i=0;i<ae.length&&!ae[i].includes("DetermineComponentFrameRoot");)i++;for(;_<me.length&&!me[_].includes("DetermineComponentFrameRoot");)_++;if(i===ae.length||_===me.length)for(i=ae.length-1,_=me.length-1;1<=i&&0<=_&&ae[i]!==me[_];)_--;for(;1<=i&&0<=_;i--,_--)if(ae[i]!==me[_]){if(i!==1||_!==1)do if(i--,_--,0>_||ae[i]!==me[_]){var Te=`
`+ae[i].replace(" at new "," at ");return e.displayName&&Te.includes("<anonymous>")&&(Te=Te.replace("<anonymous>",e.displayName)),Te}while(1<=i&&0<=_);break}}}finally{de=!1,Error.prepareStackTrace=l}return(l=e?e.displayName||e.name:"")?je(l):""}function Ue(e,a){switch(e.tag){case 26:case 27:case 5:return je(e.type);case 16:return je("Lazy");case 13:return e.child!==a&&a!==null?je("Suspense Fallback"):je("Suspense");case 19:return je("SuspenseList");case 0:case 15:return Pe(e.type,!1);case 11:return Pe(e.type.render,!1);case 1:return Pe(e.type,!0);case 31:return je("Activity");default:return""}}function se(e){try{var a="",l=null;do a+=Ue(e,l),l=e,e=e.return;while(e);return a}catch(i){return`
Error generating stack: `+i.message+`
`+i.stack}}var re=Object.prototype.hasOwnProperty,ce=t.unstable_scheduleCallback,he=t.unstable_cancelCallback,we=t.unstable_shouldYield,Se=t.unstable_requestPaint,ke=t.unstable_now,Xe=t.unstable_getCurrentPriorityLevel,Le=t.unstable_ImmediatePriority,be=t.unstable_UserBlockingPriority,Me=t.unstable_NormalPriority,Ne=t.unstable_LowPriority,Be=t.unstable_IdlePriority,Ye=t.log,De=t.unstable_setDisableYieldValue,Ge=null,et=null;function tt(e){if(typeof Ye=="function"&&De(e),et&&typeof et.setStrictMode=="function")try{et.setStrictMode(Ge,e)}catch{}}var rt=Math.clz32?Math.clz32:Ft,ht=Math.log,Rt=Math.LN2;function Ft(e){return e>>>=0,e===0?32:31-(ht(e)/Rt|0)|0}var En=256,fn=262144,Zt=4194304;function nn(e){var a=e&42;if(a!==0)return a;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return e&261888;case 262144:case 524288:case 1048576:case 2097152:return e&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return e&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function un(e,a,l){var i=e.pendingLanes;if(i===0)return 0;var _=0,S=e.suspendedLanes,$=e.pingedLanes;e=e.warmLanes;var Q=i&134217727;return Q!==0?(i=Q&~S,i!==0?_=nn(i):($&=Q,$!==0?_=nn($):l||(l=Q&~e,l!==0&&(_=nn(l))))):(Q=i&~S,Q!==0?_=nn(Q):$!==0?_=nn($):l||(l=i&~e,l!==0&&(_=nn(l)))),_===0?0:a!==0&&a!==_&&(a&S)===0&&(S=_&-_,l=a&-a,S>=l||S===32&&(l&4194048)!==0)?a:_}function jn(e,a){return(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&a)===0}function Xn(e,a){switch(e){case 1:case 2:case 4:case 8:case 64:return a+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function xn(){var e=Zt;return Zt<<=1,(Zt&62914560)===0&&(Zt=4194304),e}function kn(e){for(var a=[],l=0;31>l;l++)a.push(e);return a}function qn(e,a){e.pendingLanes|=a,a!==268435456&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function Ya(e,a,l,i,_,S){var $=e.pendingLanes;e.pendingLanes=l,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=l,e.entangledLanes&=l,e.errorRecoveryDisabledLanes&=l,e.shellSuspendCounter=0;var Q=e.entanglements,ae=e.expirationTimes,me=e.hiddenUpdates;for(l=$&~l;0<l;){var Te=31-rt(l),$e=1<<Te;Q[Te]=0,ae[Te]=-1;var ve=me[Te];if(ve!==null)for(me[Te]=null,Te=0;Te<ve.length;Te++){var Ee=ve[Te];Ee!==null&&(Ee.lane&=-536870913)}l&=~$e}i!==0&&$a(e,i,0),S!==0&&_===0&&e.tag!==0&&(e.suspendedLanes|=S&~($&~a))}function $a(e,a,l){e.pendingLanes|=a,e.suspendedLanes&=~a;var i=31-rt(a);e.entangledLanes|=a,e.entanglements[i]=e.entanglements[i]|1073741824|l&261930}function Pa(e,a){var l=e.entangledLanes|=a;for(e=e.entanglements;l;){var i=31-rt(l),_=1<<i;_&a|e[i]&a&&(e[i]|=a),l&=~_}}function qa(e,a){var l=a&-a;return l=(l&42)!==0?1:Ea(l),(l&(e.suspendedLanes|a))!==0?0:l}function Ea(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function da(e){return e&=-e,2<e?8<e?(e&134217727)!==0?32:268435456:8:2}function ua(){var e=N.p;return e!==0?e:(e=window.event,e===void 0?32:mm(e.type))}function La(e,a){var l=N.p;try{return N.p=e,a()}finally{N.p=l}}var Cn=Math.random().toString(36).slice(2),Vt="__reactFiber$"+Cn,Yt="__reactProps$"+Cn,Ln="__reactContainer$"+Cn,pa="__reactEvents$"+Cn,Qa="__reactListeners$"+Cn,Xa="__reactHandles$"+Cn,Ua="__reactResources$"+Cn,Zn="__reactMarker$"+Cn;function ja(e){delete e[Vt],delete e[Yt],delete e[pa],delete e[Qa],delete e[Xa]}function Un(e){var a=e[Vt];if(a)return a;for(var l=e.parentNode;l;){if(a=l[Ln]||l[Vt]){if(l=a.alternate,a.child!==null||l!==null&&l.child!==null)for(e=Jh(e);e!==null;){if(l=e[Vt])return l;e=Jh(e)}return a}e=l,l=e.parentNode}return null}function Rn(e){if(e=e[Vt]||e[Ln]){var a=e.tag;if(a===5||a===6||a===13||a===31||a===26||a===27||a===3)return e}return null}function On(e){var a=e.tag;if(a===5||a===26||a===27||a===6)return e.stateNode;throw Error(s(33))}function Nn(e){var a=e[Ua];return a||(a=e[Ua]={hoistableStyles:new Map,hoistableScripts:new Map}),a}function Ot(e){e[Zn]=!0}var ka=new Set,Ra={};function Sn(e,a){Tn(e,a),Tn(e+"Capture",a)}function Tn(e,a){for(Ra[e]=a,e=0;e<a.length;e++)ka.add(a[e])}var ge=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Oe={},Qe={};function mt(e){return re.call(Qe,e)?!0:re.call(Oe,e)?!1:ge.test(e)?Qe[e]=!0:(Oe[e]=!0,!1)}function Ze(e,a,l){if(mt(a))if(l===null)e.removeAttribute(a);else{switch(typeof l){case"undefined":case"function":case"symbol":e.removeAttribute(a);return;case"boolean":var i=a.toLowerCase().slice(0,5);if(i!=="data-"&&i!=="aria-"){e.removeAttribute(a);return}}e.setAttribute(a,""+l)}}function Je(e,a,l){if(l===null)e.removeAttribute(a);else{switch(typeof l){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(a);return}e.setAttribute(a,""+l)}}function ct(e,a,l,i){if(i===null)e.removeAttribute(l);else{switch(typeof i){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(l);return}e.setAttributeNS(a,l,""+i)}}function ot(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function ue(e){var a=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(a==="checkbox"||a==="radio")}function Re(e,a,l){var i=Object.getOwnPropertyDescriptor(e.constructor.prototype,a);if(!e.hasOwnProperty(a)&&typeof i<"u"&&typeof i.get=="function"&&typeof i.set=="function"){var _=i.get,S=i.set;return Object.defineProperty(e,a,{configurable:!0,get:function(){return _.call(this)},set:function($){l=""+$,S.call(this,$)}}),Object.defineProperty(e,a,{enumerable:i.enumerable}),{getValue:function(){return l},setValue:function($){l=""+$},stopTracking:function(){e._valueTracker=null,delete e[a]}}}}function Fe(e){if(!e._valueTracker){var a=ue(e)?"checked":"value";e._valueTracker=Re(e,a,""+e[a])}}function ze(e){if(!e)return!1;var a=e._valueTracker;if(!a)return!0;var l=a.getValue(),i="";return e&&(i=ue(e)?e.checked?"true":"false":e.value),e=i,e!==l?(a.setValue(e),!0):!1}function dt(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}var it=/[\n"\\]/g;function Dt(e){return e.replace(it,function(a){return"\\"+a.charCodeAt(0).toString(16)+" "})}function Dn(e,a,l,i,_,S,$,Q){e.name="",$!=null&&typeof $!="function"&&typeof $!="symbol"&&typeof $!="boolean"?e.type=$:e.removeAttribute("type"),a!=null?$==="number"?(a===0&&e.value===""||e.value!=a)&&(e.value=""+ot(a)):e.value!==""+ot(a)&&(e.value=""+ot(a)):$!=="submit"&&$!=="reset"||e.removeAttribute("value"),a!=null?Na(e,$,ot(a)):l!=null?Na(e,$,ot(l)):i!=null&&e.removeAttribute("value"),_==null&&S!=null&&(e.defaultChecked=!!S),_!=null&&(e.checked=_&&typeof _!="function"&&typeof _!="symbol"),Q!=null&&typeof Q!="function"&&typeof Q!="symbol"&&typeof Q!="boolean"?e.name=""+ot(Q):e.removeAttribute("name")}function Kn(e,a,l,i,_,S,$,Q){if(S!=null&&typeof S!="function"&&typeof S!="symbol"&&typeof S!="boolean"&&(e.type=S),a!=null||l!=null){if(!(S!=="submit"&&S!=="reset"||a!=null)){Fe(e);return}l=l!=null?""+ot(l):"",a=a!=null?""+ot(a):l,Q||a===e.value||(e.value=a),e.defaultValue=a}i=i??_,i=typeof i!="function"&&typeof i!="symbol"&&!!i,e.checked=Q?e.checked:!!i,e.defaultChecked=!!i,$!=null&&typeof $!="function"&&typeof $!="symbol"&&typeof $!="boolean"&&(e.name=$),Fe(e)}function Na(e,a,l){a==="number"&&dt(e.ownerDocument)===e||e.defaultValue===""+l||(e.defaultValue=""+l)}function hn(e,a,l,i){if(e=e.options,a){a={};for(var _=0;_<l.length;_++)a["$"+l[_]]=!0;for(l=0;l<e.length;l++)_=a.hasOwnProperty("$"+e[l].value),e[l].selected!==_&&(e[l].selected=_),_&&i&&(e[l].defaultSelected=!0)}else{for(l=""+ot(l),a=null,_=0;_<e.length;_++){if(e[_].value===l){e[_].selected=!0,i&&(e[_].defaultSelected=!0);return}a!==null||e[_].disabled||(a=e[_])}a!==null&&(a.selected=!0)}}function tr(e,a,l){if(a!=null&&(a=""+ot(a),a!==e.value&&(e.value=a),l==null)){e.defaultValue!==a&&(e.defaultValue=a);return}e.defaultValue=l!=null?""+ot(l):""}function kr(e,a,l,i){if(a==null){if(i!=null){if(l!=null)throw Error(s(92));if(H(i)){if(1<i.length)throw Error(s(93));i=i[0]}l=i}l==null&&(l=""),a=l}l=ot(a),e.defaultValue=l,i=e.textContent,i===l&&i!==""&&i!==null&&(e.value=i),Fe(e)}function fa(e,a){if(a){var l=e.firstChild;if(l&&l===e.lastChild&&l.nodeType===3){l.nodeValue=a;return}}e.textContent=a}var nr=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function _o(e,a,l){var i=a.indexOf("--")===0;l==null||typeof l=="boolean"||l===""?i?e.setProperty(a,""):a==="float"?e.cssFloat="":e[a]="":i?e.setProperty(a,l):typeof l!="number"||l===0||nr.has(a)?a==="float"?e.cssFloat=l:e[a]=(""+l).trim():e[a]=l+"px"}function wo(e,a,l){if(a!=null&&typeof a!="object")throw Error(s(62));if(e=e.style,l!=null){for(var i in l)!l.hasOwnProperty(i)||a!=null&&a.hasOwnProperty(i)||(i.indexOf("--")===0?e.setProperty(i,""):i==="float"?e.cssFloat="":e[i]="");for(var _ in a)i=a[_],a.hasOwnProperty(_)&&l[_]!==i&&_o(e,_,i)}else for(var S in a)a.hasOwnProperty(S)&&_o(e,S,a[S])}function Za(e){if(e.indexOf("-")===-1)return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ar=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Kt=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Ka(e){return Kt.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}function Mn(){}var xo=null;function Co(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var Ta=null,Da=null;function Ja(e){var a=Rn(e);if(a&&(e=a.stateNode)){var l=e[Yt]||null;e:switch(e=a.stateNode,a.type){case"input":if(Dn(e,l.value,l.defaultValue,l.defaultValue,l.checked,l.defaultChecked,l.type,l.name),a=l.name,l.type==="radio"&&a!=null){for(l=e;l.parentNode;)l=l.parentNode;for(l=l.querySelectorAll('input[name="'+Dt(""+a)+'"][type="radio"]'),a=0;a<l.length;a++){var i=l[a];if(i!==e&&i.form===e.form){var _=i[Yt]||null;if(!_)throw Error(s(90));Dn(i,_.value,_.defaultValue,_.defaultValue,_.checked,_.defaultChecked,_.type,_.name)}}for(a=0;a<l.length;a++)i=l[a],i.form===e.form&&ze(i)}break e;case"textarea":tr(e,l.value,l.defaultValue);break e;case"select":a=l.value,a!=null&&hn(e,!!l.multiple,a,!1)}}}var We=!1;function Gt(e,a,l){if(We)return e(a,l);We=!0;try{var i=e(a);return i}finally{if(We=!1,(Ta!==null||Da!==null)&&(ic(),Ta&&(a=Ta,e=Da,Da=Ta=null,Ja(a),e)))for(a=0;a<e.length;a++)Ja(e[a])}}function cn(e,a){var l=e.stateNode;if(l===null)return null;var i=l[Yt]||null;if(i===null)return null;l=i[a];e:switch(a){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(e=e.type,i=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!i;break e;default:e=!1}if(e)return null;if(l&&typeof l!="function")throw Error(s(231,a,typeof l));return l}var Jt=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Cs=!1;if(Jt)try{var So={};Object.defineProperty(So,"passive",{get:function(){Cs=!0}}),window.addEventListener("test",So,So),window.removeEventListener("test",So,So)}catch{Cs=!1}var bo=null,Zc=null,Ss=null;function Bu(){if(Ss)return Ss;var e,a=Zc,l=a.length,i,_="value"in bo?bo.value:bo.textContent,S=_.length;for(e=0;e<l&&a[e]===_[e];e++);var $=l-e;for(i=1;i<=$&&a[l-i]===_[S-i];i++);return Ss=_.slice(e,1<i?1-i:void 0)}function bs(e){var a=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&a===13&&(e=13)):e=a,e===10&&(e=13),32<=e||e===13?e:0}function Es(){return!0}function Gu(){return!1}function Hn(e){function a(l,i,_,S,$){this._reactName=l,this._targetInst=_,this.type=i,this.nativeEvent=S,this.target=$,this.currentTarget=null;for(var Q in e)e.hasOwnProperty(Q)&&(l=e[Q],this[Q]=l?l(S):S[Q]);return this.isDefaultPrevented=(S.defaultPrevented!=null?S.defaultPrevented:S.returnValue===!1)?Es:Gu,this.isPropagationStopped=Gu,this}return m(a.prototype,{preventDefault:function(){this.defaultPrevented=!0;var l=this.nativeEvent;l&&(l.preventDefault?l.preventDefault():typeof l.returnValue!="unknown"&&(l.returnValue=!1),this.isDefaultPrevented=Es)},stopPropagation:function(){var l=this.nativeEvent;l&&(l.stopPropagation?l.stopPropagation():typeof l.cancelBubble!="unknown"&&(l.cancelBubble=!0),this.isPropagationStopped=Es)},persist:function(){},isPersistent:Es}),a}var or={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},js=Hn(or),El=m({},or,{view:0,detail:0}),y_=Hn(El),Kc,Jc,jl,ks=m({},El,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ti,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==jl&&(jl&&e.type==="mousemove"?(Kc=e.screenX-jl.screenX,Jc=e.screenY-jl.screenY):Jc=Kc=0,jl=e),Kc)},movementY:function(e){return"movementY"in e?e.movementY:Jc}}),Wu=Hn(ks),g_=m({},ks,{dataTransfer:0}),v_=Hn(g_),__=m({},El,{relatedTarget:0}),ei=Hn(__),w_=m({},or,{animationName:0,elapsedTime:0,pseudoElement:0}),x_=Hn(w_),C_=m({},or,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),S_=Hn(C_),b_=m({},or,{data:0}),Yu=Hn(b_),E_={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},j_={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},k_={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function R_(e){var a=this.nativeEvent;return a.getModifierState?a.getModifierState(e):(e=k_[e])?!!a[e]:!1}function ti(){return R_}var N_=m({},El,{key:function(e){if(e.key){var a=E_[e.key]||e.key;if(a!=="Unidentified")return a}return e.type==="keypress"?(e=bs(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?j_[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ti,charCode:function(e){return e.type==="keypress"?bs(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?bs(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),T_=Hn(N_),D_=m({},ks,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Qu=Hn(D_),A_=m({},El,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ti}),F_=Hn(A_),I_=m({},or,{propertyName:0,elapsedTime:0,pseudoElement:0}),$_=Hn(I_),P_=m({},ks,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),q_=Hn(P_),L_=m({},or,{newState:0,oldState:0}),U_=Hn(L_),O_=[9,13,27,32],ni=Jt&&"CompositionEvent"in window,kl=null;Jt&&"documentMode"in document&&(kl=document.documentMode);var M_=Jt&&"TextEvent"in window&&!kl,Xu=Jt&&(!ni||kl&&8<kl&&11>=kl),Zu=" ",Ku=!1;function Ju(e,a){switch(e){case"keyup":return O_.indexOf(a.keyCode)!==-1;case"keydown":return a.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function ep(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Rr=!1;function H_(e,a){switch(e){case"compositionend":return ep(a);case"keypress":return a.which!==32?null:(Ku=!0,Zu);case"textInput":return e=a.data,e===Zu&&Ku?null:e;default:return null}}function V_(e,a){if(Rr)return e==="compositionend"||!ni&&Ju(e,a)?(e=Bu(),Ss=Zc=bo=null,Rr=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(a.ctrlKey||a.altKey||a.metaKey)||a.ctrlKey&&a.altKey){if(a.char&&1<a.char.length)return a.char;if(a.which)return String.fromCharCode(a.which)}return null;case"compositionend":return Xu&&a.locale!=="ko"?null:a.data;default:return null}}var z_={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function tp(e){var a=e&&e.nodeName&&e.nodeName.toLowerCase();return a==="input"?!!z_[e.type]:a==="textarea"}function np(e,a,l,i){Ta?Da?Da.push(i):Da=[i]:Ta=i,a=yc(a,"onChange"),0<a.length&&(l=new js("onChange","change",null,l,i),e.push({event:l,listeners:a}))}var Rl=null,Nl=null;function B_(e){Uh(e,0)}function Rs(e){var a=On(e);if(ze(a))return e}function ap(e,a){if(e==="change")return a}var op=!1;if(Jt){var ai;if(Jt){var oi="oninput"in document;if(!oi){var rp=document.createElement("div");rp.setAttribute("oninput","return;"),oi=typeof rp.oninput=="function"}ai=oi}else ai=!1;op=ai&&(!document.documentMode||9<document.documentMode)}function lp(){Rl&&(Rl.detachEvent("onpropertychange",sp),Nl=Rl=null)}function sp(e){if(e.propertyName==="value"&&Rs(Nl)){var a=[];np(a,Nl,e,Co(e)),Gt(B_,a)}}function G_(e,a,l){e==="focusin"?(lp(),Rl=a,Nl=l,Rl.attachEvent("onpropertychange",sp)):e==="focusout"&&lp()}function W_(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return Rs(Nl)}function Y_(e,a){if(e==="click")return Rs(a)}function Q_(e,a){if(e==="input"||e==="change")return Rs(a)}function X_(e,a){return e===a&&(e!==0||1/e===1/a)||e!==e&&a!==a}var Jn=typeof Object.is=="function"?Object.is:X_;function Tl(e,a){if(Jn(e,a))return!0;if(typeof e!="object"||e===null||typeof a!="object"||a===null)return!1;var l=Object.keys(e),i=Object.keys(a);if(l.length!==i.length)return!1;for(i=0;i<l.length;i++){var _=l[i];if(!re.call(a,_)||!Jn(e[_],a[_]))return!1}return!0}function cp(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function ip(e,a){var l=cp(e);e=0;for(var i;l;){if(l.nodeType===3){if(i=e+l.textContent.length,e<=a&&i>=a)return{node:l,offset:a-e};e=i}e:{for(;l;){if(l.nextSibling){l=l.nextSibling;break e}l=l.parentNode}l=void 0}l=cp(l)}}function dp(e,a){return e&&a?e===a?!0:e&&e.nodeType===3?!1:a&&a.nodeType===3?dp(e,a.parentNode):"contains"in e?e.contains(a):e.compareDocumentPosition?!!(e.compareDocumentPosition(a)&16):!1:!1}function up(e){e=e!=null&&e.ownerDocument!=null&&e.ownerDocument.defaultView!=null?e.ownerDocument.defaultView:window;for(var a=dt(e.document);a instanceof e.HTMLIFrameElement;){try{var l=typeof a.contentWindow.location.href=="string"}catch{l=!1}if(l)e=a.contentWindow;else break;a=dt(e.document)}return a}function ri(e){var a=e&&e.nodeName&&e.nodeName.toLowerCase();return a&&(a==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||a==="textarea"||e.contentEditable==="true")}var Z_=Jt&&"documentMode"in document&&11>=document.documentMode,Nr=null,li=null,Dl=null,si=!1;function pp(e,a,l){var i=l.window===l?l.document:l.nodeType===9?l:l.ownerDocument;si||Nr==null||Nr!==dt(i)||(i=Nr,"selectionStart"in i&&ri(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),Dl&&Tl(Dl,i)||(Dl=i,i=yc(li,"onSelect"),0<i.length&&(a=new js("onSelect","select",null,a,l),e.push({event:a,listeners:i}),a.target=Nr)))}function rr(e,a){var l={};return l[e.toLowerCase()]=a.toLowerCase(),l["Webkit"+e]="webkit"+a,l["Moz"+e]="moz"+a,l}var Tr={animationend:rr("Animation","AnimationEnd"),animationiteration:rr("Animation","AnimationIteration"),animationstart:rr("Animation","AnimationStart"),transitionrun:rr("Transition","TransitionRun"),transitionstart:rr("Transition","TransitionStart"),transitioncancel:rr("Transition","TransitionCancel"),transitionend:rr("Transition","TransitionEnd")},ci={},fp={};Jt&&(fp=document.createElement("div").style,"AnimationEvent"in window||(delete Tr.animationend.animation,delete Tr.animationiteration.animation,delete Tr.animationstart.animation),"TransitionEvent"in window||delete Tr.transitionend.transition);function lr(e){if(ci[e])return ci[e];if(!Tr[e])return e;var a=Tr[e],l;for(l in a)if(a.hasOwnProperty(l)&&l in fp)return ci[e]=a[l];return e}var hp=lr("animationend"),mp=lr("animationiteration"),yp=lr("animationstart"),K_=lr("transitionrun"),J_=lr("transitionstart"),e0=lr("transitioncancel"),gp=lr("transitionend"),vp=new Map,ii="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");ii.push("scrollEnd");function Aa(e,a){vp.set(e,a),Sn(a,[e])}var Ns=typeof reportError=="function"?reportError:function(e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var a=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof e=="object"&&e!==null&&typeof e.message=="string"?String(e.message):String(e),error:e});if(!window.dispatchEvent(a))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",e);return}console.error(e)},ha=[],Dr=0,di=0;function Ts(){for(var e=Dr,a=di=Dr=0;a<e;){var l=ha[a];ha[a++]=null;var i=ha[a];ha[a++]=null;var _=ha[a];ha[a++]=null;var S=ha[a];if(ha[a++]=null,i!==null&&_!==null){var $=i.pending;$===null?_.next=_:(_.next=$.next,$.next=_),i.pending=_}S!==0&&_p(l,_,S)}}function Ds(e,a,l,i){ha[Dr++]=e,ha[Dr++]=a,ha[Dr++]=l,ha[Dr++]=i,di|=i,e.lanes|=i,e=e.alternate,e!==null&&(e.lanes|=i)}function ui(e,a,l,i){return Ds(e,a,l,i),As(e)}function sr(e,a){return Ds(e,null,null,a),As(e)}function _p(e,a,l){e.lanes|=l;var i=e.alternate;i!==null&&(i.lanes|=l);for(var _=!1,S=e.return;S!==null;)S.childLanes|=l,i=S.alternate,i!==null&&(i.childLanes|=l),S.tag===22&&(e=S.stateNode,e===null||e._visibility&1||(_=!0)),e=S,S=S.return;return e.tag===3?(S=e.stateNode,_&&a!==null&&(_=31-rt(l),e=S.hiddenUpdates,i=e[_],i===null?e[_]=[a]:i.push(a),a.lane=l|536870912),S):null}function As(e){if(50<Jl)throw Jl=0,wd=null,Error(s(185));for(var a=e.return;a!==null;)e=a,a=e.return;return e.tag===3?e.stateNode:null}var Ar={};function t0(e,a,l,i){this.tag=e,this.key=l,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=a,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ea(e,a,l,i){return new t0(e,a,l,i)}function pi(e){return e=e.prototype,!(!e||!e.isReactComponent)}function eo(e,a){var l=e.alternate;return l===null?(l=ea(e.tag,a,e.key,e.mode),l.elementType=e.elementType,l.type=e.type,l.stateNode=e.stateNode,l.alternate=e,e.alternate=l):(l.pendingProps=a,l.type=e.type,l.flags=0,l.subtreeFlags=0,l.deletions=null),l.flags=e.flags&65011712,l.childLanes=e.childLanes,l.lanes=e.lanes,l.child=e.child,l.memoizedProps=e.memoizedProps,l.memoizedState=e.memoizedState,l.updateQueue=e.updateQueue,a=e.dependencies,l.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext},l.sibling=e.sibling,l.index=e.index,l.ref=e.ref,l.refCleanup=e.refCleanup,l}function wp(e,a){e.flags&=65011714;var l=e.alternate;return l===null?(e.childLanes=0,e.lanes=a,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=l.childLanes,e.lanes=l.lanes,e.child=l.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=l.memoizedProps,e.memoizedState=l.memoizedState,e.updateQueue=l.updateQueue,e.type=l.type,a=l.dependencies,e.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext}),e}function Fs(e,a,l,i,_,S){var $=0;if(i=e,typeof e=="function")pi(e)&&($=1);else if(typeof e=="string")$=lw(e,l,K.current)?26:e==="html"||e==="head"||e==="body"?27:5;else e:switch(e){case U:return e=ea(31,l,a,_),e.elementType=U,e.lanes=S,e;case b:return cr(l.children,_,S,a);case x:$=8,_|=24;break;case j:return e=ea(12,l,a,_|2),e.elementType=j,e.lanes=S,e;case D:return e=ea(13,l,a,_),e.elementType=D,e.lanes=S,e;case L:return e=ea(19,l,a,_),e.elementType=L,e.lanes=S,e;default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case k:$=10;break e;case E:$=9;break e;case R:$=11;break e;case I:$=14;break e;case F:$=16,i=null;break e}$=29,l=Error(s(130,e===null?"null":typeof e,"")),i=null}return a=ea($,l,a,_),a.elementType=e,a.type=i,a.lanes=S,a}function cr(e,a,l,i){return e=ea(7,e,i,a),e.lanes=l,e}function fi(e,a,l){return e=ea(6,e,null,a),e.lanes=l,e}function xp(e){var a=ea(18,null,null,0);return a.stateNode=e,a}function hi(e,a,l){return a=ea(4,e.children!==null?e.children:[],e.key,a),a.lanes=l,a.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},a}var Cp=new WeakMap;function ma(e,a){if(typeof e=="object"&&e!==null){var l=Cp.get(e);return l!==void 0?l:(a={value:e,source:a,stack:se(a)},Cp.set(e,a),a)}return{value:e,source:a,stack:se(a)}}var Fr=[],Ir=0,Is=null,Al=0,ya=[],ga=0,Eo=null,Oa=1,Ma="";function to(e,a){Fr[Ir++]=Al,Fr[Ir++]=Is,Is=e,Al=a}function Sp(e,a,l){ya[ga++]=Oa,ya[ga++]=Ma,ya[ga++]=Eo,Eo=e;var i=Oa;e=Ma;var _=32-rt(i)-1;i&=~(1<<_),l+=1;var S=32-rt(a)+_;if(30<S){var $=_-_%5;S=(i&(1<<$)-1).toString(32),i>>=$,_-=$,Oa=1<<32-rt(a)+_|l<<_|i,Ma=S+e}else Oa=1<<S|l<<_|i,Ma=e}function mi(e){e.return!==null&&(to(e,1),Sp(e,1,0))}function yi(e){for(;e===Is;)Is=Fr[--Ir],Fr[Ir]=null,Al=Fr[--Ir],Fr[Ir]=null;for(;e===Eo;)Eo=ya[--ga],ya[ga]=null,Ma=ya[--ga],ya[ga]=null,Oa=ya[--ga],ya[ga]=null}function bp(e,a){ya[ga++]=Oa,ya[ga++]=Ma,ya[ga++]=Eo,Oa=a.id,Ma=a.overflow,Eo=e}var mn=null,zt=null,jt=!1,jo=null,va=!1,gi=Error(s(519));function ko(e){var a=Error(s(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Fl(ma(a,e)),gi}function Ep(e){var a=e.stateNode,l=e.type,i=e.memoizedProps;switch(a[Vt]=e,a[Yt]=i,l){case"dialog":Ct("cancel",a),Ct("close",a);break;case"iframe":case"object":case"embed":Ct("load",a);break;case"video":case"audio":for(l=0;l<ts.length;l++)Ct(ts[l],a);break;case"source":Ct("error",a);break;case"img":case"image":case"link":Ct("error",a),Ct("load",a);break;case"details":Ct("toggle",a);break;case"input":Ct("invalid",a),Kn(a,i.value,i.defaultValue,i.checked,i.defaultChecked,i.type,i.name,!0);break;case"select":Ct("invalid",a);break;case"textarea":Ct("invalid",a),kr(a,i.value,i.defaultValue,i.children)}l=i.children,typeof l!="string"&&typeof l!="number"&&typeof l!="bigint"||a.textContent===""+l||i.suppressHydrationWarning===!0||Vh(a.textContent,l)?(i.popover!=null&&(Ct("beforetoggle",a),Ct("toggle",a)),i.onScroll!=null&&Ct("scroll",a),i.onScrollEnd!=null&&Ct("scrollend",a),i.onClick!=null&&(a.onclick=Mn),a=!0):a=!1,a||ko(e,!0)}function jp(e){for(mn=e.return;mn;)switch(mn.tag){case 5:case 31:case 13:va=!1;return;case 27:case 3:va=!0;return;default:mn=mn.return}}function $r(e){if(e!==mn)return!1;if(!jt)return jp(e),jt=!0,!1;var a=e.tag,l;if((l=a!==3&&a!==27)&&((l=a===5)&&(l=e.type,l=!(l!=="form"&&l!=="button")||$d(e.type,e.memoizedProps)),l=!l),l&&zt&&ko(e),jp(e),a===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(s(317));zt=Kh(e)}else if(a===31){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(s(317));zt=Kh(e)}else a===27?(a=zt,Mo(e.type)?(e=Od,Od=null,zt=e):zt=a):zt=mn?wa(e.stateNode.nextSibling):null;return!0}function ir(){zt=mn=null,jt=!1}function vi(){var e=jo;return e!==null&&(Gn===null?Gn=e:Gn.push.apply(Gn,e),jo=null),e}function Fl(e){jo===null?jo=[e]:jo.push(e)}var _i=M(null),dr=null,no=null;function Ro(e,a,l){X(_i,a._currentValue),a._currentValue=l}function ao(e){e._currentValue=_i.current,Y(_i)}function wi(e,a,l){for(;e!==null;){var i=e.alternate;if((e.childLanes&a)!==a?(e.childLanes|=a,i!==null&&(i.childLanes|=a)):i!==null&&(i.childLanes&a)!==a&&(i.childLanes|=a),e===l)break;e=e.return}}function xi(e,a,l,i){var _=e.child;for(_!==null&&(_.return=e);_!==null;){var S=_.dependencies;if(S!==null){var $=_.child;S=S.firstContext;e:for(;S!==null;){var Q=S;S=_;for(var ae=0;ae<a.length;ae++)if(Q.context===a[ae]){S.lanes|=l,Q=S.alternate,Q!==null&&(Q.lanes|=l),wi(S.return,l,e),i||($=null);break e}S=Q.next}}else if(_.tag===18){if($=_.return,$===null)throw Error(s(341));$.lanes|=l,S=$.alternate,S!==null&&(S.lanes|=l),wi($,l,e),$=null}else $=_.child;if($!==null)$.return=_;else for($=_;$!==null;){if($===e){$=null;break}if(_=$.sibling,_!==null){_.return=$.return,$=_;break}$=$.return}_=$}}function Pr(e,a,l,i){e=null;for(var _=a,S=!1;_!==null;){if(!S){if((_.flags&524288)!==0)S=!0;else if((_.flags&262144)!==0)break}if(_.tag===10){var $=_.alternate;if($===null)throw Error(s(387));if($=$.memoizedProps,$!==null){var Q=_.type;Jn(_.pendingProps.value,$.value)||(e!==null?e.push(Q):e=[Q])}}else if(_===oe.current){if($=_.alternate,$===null)throw Error(s(387));$.memoizedState.memoizedState!==_.memoizedState.memoizedState&&(e!==null?e.push(ls):e=[ls])}_=_.return}e!==null&&xi(a,e,l,i),a.flags|=262144}function $s(e){for(e=e.firstContext;e!==null;){if(!Jn(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function ur(e){dr=e,no=null,e=e.dependencies,e!==null&&(e.firstContext=null)}function yn(e){return kp(dr,e)}function Ps(e,a){return dr===null&&ur(e),kp(e,a)}function kp(e,a){var l=a._currentValue;if(a={context:a,memoizedValue:l,next:null},no===null){if(e===null)throw Error(s(308));no=a,e.dependencies={lanes:0,firstContext:a},e.flags|=524288}else no=no.next=a;return l}var n0=typeof AbortController<"u"?AbortController:function(){var e=[],a=this.signal={aborted:!1,addEventListener:function(l,i){e.push(i)}};this.abort=function(){a.aborted=!0,e.forEach(function(l){return l()})}},a0=t.unstable_scheduleCallback,o0=t.unstable_NormalPriority,an={$$typeof:k,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Ci(){return{controller:new n0,data:new Map,refCount:0}}function Il(e){e.refCount--,e.refCount===0&&a0(o0,function(){e.controller.abort()})}var $l=null,Si=0,qr=0,Lr=null;function r0(e,a){if($l===null){var l=$l=[];Si=0,qr=jd(),Lr={status:"pending",value:void 0,then:function(i){l.push(i)}}}return Si++,a.then(Rp,Rp),a}function Rp(){if(--Si===0&&$l!==null){Lr!==null&&(Lr.status="fulfilled");var e=$l;$l=null,qr=0,Lr=null;for(var a=0;a<e.length;a++)(0,e[a])()}}function l0(e,a){var l=[],i={status:"pending",value:null,reason:null,then:function(_){l.push(_)}};return e.then(function(){i.status="fulfilled",i.value=a;for(var _=0;_<l.length;_++)(0,l[_])(a)},function(_){for(i.status="rejected",i.reason=_,_=0;_<l.length;_++)(0,l[_])(void 0)}),i}var Np=A.S;A.S=function(e,a){fh=ke(),typeof a=="object"&&a!==null&&typeof a.then=="function"&&r0(e,a),Np!==null&&Np(e,a)};var pr=M(null);function bi(){var e=pr.current;return e!==null?e:Mt.pooledCache}function qs(e,a){a===null?X(pr,pr.current):X(pr,a.pool)}function Tp(){var e=bi();return e===null?null:{parent:an._currentValue,pool:e}}var Ur=Error(s(460)),Ei=Error(s(474)),Ls=Error(s(542)),Us={then:function(){}};function Dp(e){return e=e.status,e==="fulfilled"||e==="rejected"}function Ap(e,a,l){switch(l=e[l],l===void 0?e.push(a):l!==a&&(a.then(Mn,Mn),a=l),a.status){case"fulfilled":return a.value;case"rejected":throw e=a.reason,Ip(e),e;default:if(typeof a.status=="string")a.then(Mn,Mn);else{if(e=Mt,e!==null&&100<e.shellSuspendCounter)throw Error(s(482));e=a,e.status="pending",e.then(function(i){if(a.status==="pending"){var _=a;_.status="fulfilled",_.value=i}},function(i){if(a.status==="pending"){var _=a;_.status="rejected",_.reason=i}})}switch(a.status){case"fulfilled":return a.value;case"rejected":throw e=a.reason,Ip(e),e}throw hr=a,Ur}}function fr(e){try{var a=e._init;return a(e._payload)}catch(l){throw l!==null&&typeof l=="object"&&typeof l.then=="function"?(hr=l,Ur):l}}var hr=null;function Fp(){if(hr===null)throw Error(s(459));var e=hr;return hr=null,e}function Ip(e){if(e===Ur||e===Ls)throw Error(s(483))}var Or=null,Pl=0;function Os(e){var a=Pl;return Pl+=1,Or===null&&(Or=[]),Ap(Or,e,a)}function ql(e,a){a=a.props.ref,e.ref=a!==void 0?a:null}function Ms(e,a){throw a.$$typeof===g?Error(s(525)):(e=Object.prototype.toString.call(a),Error(s(31,e==="[object Object]"?"object with keys {"+Object.keys(a).join(", ")+"}":e)))}function $p(e){function a(ie,le){if(e){var fe=ie.deletions;fe===null?(ie.deletions=[le],ie.flags|=16):fe.push(le)}}function l(ie,le){if(!e)return null;for(;le!==null;)a(ie,le),le=le.sibling;return null}function i(ie){for(var le=new Map;ie!==null;)ie.key!==null?le.set(ie.key,ie):le.set(ie.index,ie),ie=ie.sibling;return le}function _(ie,le){return ie=eo(ie,le),ie.index=0,ie.sibling=null,ie}function S(ie,le,fe){return ie.index=fe,e?(fe=ie.alternate,fe!==null?(fe=fe.index,fe<le?(ie.flags|=67108866,le):fe):(ie.flags|=67108866,le)):(ie.flags|=1048576,le)}function $(ie){return e&&ie.alternate===null&&(ie.flags|=67108866),ie}function Q(ie,le,fe,Ae){return le===null||le.tag!==6?(le=fi(fe,ie.mode,Ae),le.return=ie,le):(le=_(le,fe),le.return=ie,le)}function ae(ie,le,fe,Ae){var at=fe.type;return at===b?Te(ie,le,fe.props.children,Ae,fe.key):le!==null&&(le.elementType===at||typeof at=="object"&&at!==null&&at.$$typeof===F&&fr(at)===le.type)?(le=_(le,fe.props),ql(le,fe),le.return=ie,le):(le=Fs(fe.type,fe.key,fe.props,null,ie.mode,Ae),ql(le,fe),le.return=ie,le)}function me(ie,le,fe,Ae){return le===null||le.tag!==4||le.stateNode.containerInfo!==fe.containerInfo||le.stateNode.implementation!==fe.implementation?(le=hi(fe,ie.mode,Ae),le.return=ie,le):(le=_(le,fe.children||[]),le.return=ie,le)}function Te(ie,le,fe,Ae,at){return le===null||le.tag!==7?(le=cr(fe,ie.mode,Ae,at),le.return=ie,le):(le=_(le,fe),le.return=ie,le)}function $e(ie,le,fe){if(typeof le=="string"&&le!==""||typeof le=="number"||typeof le=="bigint")return le=fi(""+le,ie.mode,fe),le.return=ie,le;if(typeof le=="object"&&le!==null){switch(le.$$typeof){case v:return fe=Fs(le.type,le.key,le.props,null,ie.mode,fe),ql(fe,le),fe.return=ie,fe;case C:return le=hi(le,ie.mode,fe),le.return=ie,le;case F:return le=fr(le),$e(ie,le,fe)}if(H(le)||W(le))return le=cr(le,ie.mode,fe,null),le.return=ie,le;if(typeof le.then=="function")return $e(ie,Os(le),fe);if(le.$$typeof===k)return $e(ie,Ps(ie,le),fe);Ms(ie,le)}return null}function ve(ie,le,fe,Ae){var at=le!==null?le.key:null;if(typeof fe=="string"&&fe!==""||typeof fe=="number"||typeof fe=="bigint")return at!==null?null:Q(ie,le,""+fe,Ae);if(typeof fe=="object"&&fe!==null){switch(fe.$$typeof){case v:return fe.key===at?ae(ie,le,fe,Ae):null;case C:return fe.key===at?me(ie,le,fe,Ae):null;case F:return fe=fr(fe),ve(ie,le,fe,Ae)}if(H(fe)||W(fe))return at!==null?null:Te(ie,le,fe,Ae,null);if(typeof fe.then=="function")return ve(ie,le,Os(fe),Ae);if(fe.$$typeof===k)return ve(ie,le,Ps(ie,fe),Ae);Ms(ie,fe)}return null}function Ee(ie,le,fe,Ae,at){if(typeof Ae=="string"&&Ae!==""||typeof Ae=="number"||typeof Ae=="bigint")return ie=ie.get(fe)||null,Q(le,ie,""+Ae,at);if(typeof Ae=="object"&&Ae!==null){switch(Ae.$$typeof){case v:return ie=ie.get(Ae.key===null?fe:Ae.key)||null,ae(le,ie,Ae,at);case C:return ie=ie.get(Ae.key===null?fe:Ae.key)||null,me(le,ie,Ae,at);case F:return Ae=fr(Ae),Ee(ie,le,fe,Ae,at)}if(H(Ae)||W(Ae))return ie=ie.get(fe)||null,Te(le,ie,Ae,at,null);if(typeof Ae.then=="function")return Ee(ie,le,fe,Os(Ae),at);if(Ae.$$typeof===k)return Ee(ie,le,fe,Ps(le,Ae),at);Ms(le,Ae)}return null}function Ke(ie,le,fe,Ae){for(var at=null,Nt=null,nt=le,vt=le=0,Et=null;nt!==null&&vt<fe.length;vt++){nt.index>vt?(Et=nt,nt=null):Et=nt.sibling;var Tt=ve(ie,nt,fe[vt],Ae);if(Tt===null){nt===null&&(nt=Et);break}e&&nt&&Tt.alternate===null&&a(ie,nt),le=S(Tt,le,vt),Nt===null?at=Tt:Nt.sibling=Tt,Nt=Tt,nt=Et}if(vt===fe.length)return l(ie,nt),jt&&to(ie,vt),at;if(nt===null){for(;vt<fe.length;vt++)nt=$e(ie,fe[vt],Ae),nt!==null&&(le=S(nt,le,vt),Nt===null?at=nt:Nt.sibling=nt,Nt=nt);return jt&&to(ie,vt),at}for(nt=i(nt);vt<fe.length;vt++)Et=Ee(nt,ie,vt,fe[vt],Ae),Et!==null&&(e&&Et.alternate!==null&&nt.delete(Et.key===null?vt:Et.key),le=S(Et,le,vt),Nt===null?at=Et:Nt.sibling=Et,Nt=Et);return e&&nt.forEach(function(Go){return a(ie,Go)}),jt&&to(ie,vt),at}function lt(ie,le,fe,Ae){if(fe==null)throw Error(s(151));for(var at=null,Nt=null,nt=le,vt=le=0,Et=null,Tt=fe.next();nt!==null&&!Tt.done;vt++,Tt=fe.next()){nt.index>vt?(Et=nt,nt=null):Et=nt.sibling;var Go=ve(ie,nt,Tt.value,Ae);if(Go===null){nt===null&&(nt=Et);break}e&&nt&&Go.alternate===null&&a(ie,nt),le=S(Go,le,vt),Nt===null?at=Go:Nt.sibling=Go,Nt=Go,nt=Et}if(Tt.done)return l(ie,nt),jt&&to(ie,vt),at;if(nt===null){for(;!Tt.done;vt++,Tt=fe.next())Tt=$e(ie,Tt.value,Ae),Tt!==null&&(le=S(Tt,le,vt),Nt===null?at=Tt:Nt.sibling=Tt,Nt=Tt);return jt&&to(ie,vt),at}for(nt=i(nt);!Tt.done;vt++,Tt=fe.next())Tt=Ee(nt,ie,vt,Tt.value,Ae),Tt!==null&&(e&&Tt.alternate!==null&&nt.delete(Tt.key===null?vt:Tt.key),le=S(Tt,le,vt),Nt===null?at=Tt:Nt.sibling=Tt,Nt=Tt);return e&&nt.forEach(function(gw){return a(ie,gw)}),jt&&to(ie,vt),at}function Lt(ie,le,fe,Ae){if(typeof fe=="object"&&fe!==null&&fe.type===b&&fe.key===null&&(fe=fe.props.children),typeof fe=="object"&&fe!==null){switch(fe.$$typeof){case v:e:{for(var at=fe.key;le!==null;){if(le.key===at){if(at=fe.type,at===b){if(le.tag===7){l(ie,le.sibling),Ae=_(le,fe.props.children),Ae.return=ie,ie=Ae;break e}}else if(le.elementType===at||typeof at=="object"&&at!==null&&at.$$typeof===F&&fr(at)===le.type){l(ie,le.sibling),Ae=_(le,fe.props),ql(Ae,fe),Ae.return=ie,ie=Ae;break e}l(ie,le);break}else a(ie,le);le=le.sibling}fe.type===b?(Ae=cr(fe.props.children,ie.mode,Ae,fe.key),Ae.return=ie,ie=Ae):(Ae=Fs(fe.type,fe.key,fe.props,null,ie.mode,Ae),ql(Ae,fe),Ae.return=ie,ie=Ae)}return $(ie);case C:e:{for(at=fe.key;le!==null;){if(le.key===at)if(le.tag===4&&le.stateNode.containerInfo===fe.containerInfo&&le.stateNode.implementation===fe.implementation){l(ie,le.sibling),Ae=_(le,fe.children||[]),Ae.return=ie,ie=Ae;break e}else{l(ie,le);break}else a(ie,le);le=le.sibling}Ae=hi(fe,ie.mode,Ae),Ae.return=ie,ie=Ae}return $(ie);case F:return fe=fr(fe),Lt(ie,le,fe,Ae)}if(H(fe))return Ke(ie,le,fe,Ae);if(W(fe)){if(at=W(fe),typeof at!="function")throw Error(s(150));return fe=at.call(fe),lt(ie,le,fe,Ae)}if(typeof fe.then=="function")return Lt(ie,le,Os(fe),Ae);if(fe.$$typeof===k)return Lt(ie,le,Ps(ie,fe),Ae);Ms(ie,fe)}return typeof fe=="string"&&fe!==""||typeof fe=="number"||typeof fe=="bigint"?(fe=""+fe,le!==null&&le.tag===6?(l(ie,le.sibling),Ae=_(le,fe),Ae.return=ie,ie=Ae):(l(ie,le),Ae=fi(fe,ie.mode,Ae),Ae.return=ie,ie=Ae),$(ie)):l(ie,le)}return function(ie,le,fe,Ae){try{Pl=0;var at=Lt(ie,le,fe,Ae);return Or=null,at}catch(nt){if(nt===Ur||nt===Ls)throw nt;var Nt=ea(29,nt,null,ie.mode);return Nt.lanes=Ae,Nt.return=ie,Nt}finally{}}}var mr=$p(!0),Pp=$p(!1),No=!1;function ji(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function ki(e,a){e=e.updateQueue,a.updateQueue===e&&(a.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function To(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function Do(e,a,l){var i=e.updateQueue;if(i===null)return null;if(i=i.shared,(At&2)!==0){var _=i.pending;return _===null?a.next=a:(a.next=_.next,_.next=a),i.pending=a,a=As(e),_p(e,null,l),a}return Ds(e,i,a,l),As(e)}function Ll(e,a,l){if(a=a.updateQueue,a!==null&&(a=a.shared,(l&4194048)!==0)){var i=a.lanes;i&=e.pendingLanes,l|=i,a.lanes=l,Pa(e,l)}}function Ri(e,a){var l=e.updateQueue,i=e.alternate;if(i!==null&&(i=i.updateQueue,l===i)){var _=null,S=null;if(l=l.firstBaseUpdate,l!==null){do{var $={lane:l.lane,tag:l.tag,payload:l.payload,callback:null,next:null};S===null?_=S=$:S=S.next=$,l=l.next}while(l!==null);S===null?_=S=a:S=S.next=a}else _=S=a;l={baseState:i.baseState,firstBaseUpdate:_,lastBaseUpdate:S,shared:i.shared,callbacks:i.callbacks},e.updateQueue=l;return}e=l.lastBaseUpdate,e===null?l.firstBaseUpdate=a:e.next=a,l.lastBaseUpdate=a}var Ni=!1;function Ul(){if(Ni){var e=Lr;if(e!==null)throw e}}function Ol(e,a,l,i){Ni=!1;var _=e.updateQueue;No=!1;var S=_.firstBaseUpdate,$=_.lastBaseUpdate,Q=_.shared.pending;if(Q!==null){_.shared.pending=null;var ae=Q,me=ae.next;ae.next=null,$===null?S=me:$.next=me,$=ae;var Te=e.alternate;Te!==null&&(Te=Te.updateQueue,Q=Te.lastBaseUpdate,Q!==$&&(Q===null?Te.firstBaseUpdate=me:Q.next=me,Te.lastBaseUpdate=ae))}if(S!==null){var $e=_.baseState;$=0,Te=me=ae=null,Q=S;do{var ve=Q.lane&-536870913,Ee=ve!==Q.lane;if(Ee?(bt&ve)===ve:(i&ve)===ve){ve!==0&&ve===qr&&(Ni=!0),Te!==null&&(Te=Te.next={lane:0,tag:Q.tag,payload:Q.payload,callback:null,next:null});e:{var Ke=e,lt=Q;ve=a;var Lt=l;switch(lt.tag){case 1:if(Ke=lt.payload,typeof Ke=="function"){$e=Ke.call(Lt,$e,ve);break e}$e=Ke;break e;case 3:Ke.flags=Ke.flags&-65537|128;case 0:if(Ke=lt.payload,ve=typeof Ke=="function"?Ke.call(Lt,$e,ve):Ke,ve==null)break e;$e=m({},$e,ve);break e;case 2:No=!0}}ve=Q.callback,ve!==null&&(e.flags|=64,Ee&&(e.flags|=8192),Ee=_.callbacks,Ee===null?_.callbacks=[ve]:Ee.push(ve))}else Ee={lane:ve,tag:Q.tag,payload:Q.payload,callback:Q.callback,next:null},Te===null?(me=Te=Ee,ae=$e):Te=Te.next=Ee,$|=ve;if(Q=Q.next,Q===null){if(Q=_.shared.pending,Q===null)break;Ee=Q,Q=Ee.next,Ee.next=null,_.lastBaseUpdate=Ee,_.shared.pending=null}}while(!0);Te===null&&(ae=$e),_.baseState=ae,_.firstBaseUpdate=me,_.lastBaseUpdate=Te,S===null&&(_.shared.lanes=0),Po|=$,e.lanes=$,e.memoizedState=$e}}function qp(e,a){if(typeof e!="function")throw Error(s(191,e));e.call(a)}function Lp(e,a){var l=e.callbacks;if(l!==null)for(e.callbacks=null,e=0;e<l.length;e++)qp(l[e],a)}var Mr=M(null),Hs=M(0);function Up(e,a){e=fo,X(Hs,e),X(Mr,a),fo=e|a.baseLanes}function Ti(){X(Hs,fo),X(Mr,Mr.current)}function Di(){fo=Hs.current,Y(Mr),Y(Hs)}var ta=M(null),_a=null;function Ao(e){var a=e.alternate;X(en,en.current&1),X(ta,e),_a===null&&(a===null||Mr.current!==null||a.memoizedState!==null)&&(_a=e)}function Ai(e){X(en,en.current),X(ta,e),_a===null&&(_a=e)}function Op(e){e.tag===22?(X(en,en.current),X(ta,e),_a===null&&(_a=e)):Fo()}function Fo(){X(en,en.current),X(ta,ta.current)}function na(e){Y(ta),_a===e&&(_a=null),Y(en)}var en=M(0);function Vs(e){for(var a=e;a!==null;){if(a.tag===13){var l=a.memoizedState;if(l!==null&&(l=l.dehydrated,l===null||Ld(l)||Ud(l)))return a}else if(a.tag===19&&(a.memoizedProps.revealOrder==="forwards"||a.memoizedProps.revealOrder==="backwards"||a.memoizedProps.revealOrder==="unstable_legacy-backwards"||a.memoizedProps.revealOrder==="together")){if((a.flags&128)!==0)return a}else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===e)break;for(;a.sibling===null;){if(a.return===null||a.return===e)return null;a=a.return}a.sibling.return=a.return,a=a.sibling}return null}var oo=0,yt=null,Pt=null,on=null,zs=!1,Hr=!1,yr=!1,Bs=0,Ml=0,Vr=null,s0=0;function Qt(){throw Error(s(321))}function Fi(e,a){if(a===null)return!1;for(var l=0;l<a.length&&l<e.length;l++)if(!Jn(e[l],a[l]))return!1;return!0}function Ii(e,a,l,i,_,S){return oo=S,yt=a,a.memoizedState=null,a.updateQueue=null,a.lanes=0,A.H=e===null||e.memoizedState===null?bf:Qi,yr=!1,S=l(i,_),yr=!1,Hr&&(S=Hp(a,l,i,_)),Mp(e),S}function Mp(e){A.H=zl;var a=Pt!==null&&Pt.next!==null;if(oo=0,on=Pt=yt=null,zs=!1,Ml=0,Vr=null,a)throw Error(s(300));e===null||rn||(e=e.dependencies,e!==null&&$s(e)&&(rn=!0))}function Hp(e,a,l,i){yt=e;var _=0;do{if(Hr&&(Vr=null),Ml=0,Hr=!1,25<=_)throw Error(s(301));if(_+=1,on=Pt=null,e.updateQueue!=null){var S=e.updateQueue;S.lastEffect=null,S.events=null,S.stores=null,S.memoCache!=null&&(S.memoCache.index=0)}A.H=Ef,S=a(l,i)}while(Hr);return S}function c0(){var e=A.H,a=e.useState()[0];return a=typeof a.then=="function"?Hl(a):a,e=e.useState()[0],(Pt!==null?Pt.memoizedState:null)!==e&&(yt.flags|=1024),a}function $i(){var e=Bs!==0;return Bs=0,e}function Pi(e,a,l){a.updateQueue=e.updateQueue,a.flags&=-2053,e.lanes&=~l}function qi(e){if(zs){for(e=e.memoizedState;e!==null;){var a=e.queue;a!==null&&(a.pending=null),e=e.next}zs=!1}oo=0,on=Pt=yt=null,Hr=!1,Ml=Bs=0,Vr=null}function An(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return on===null?yt.memoizedState=on=e:on=on.next=e,on}function tn(){if(Pt===null){var e=yt.alternate;e=e!==null?e.memoizedState:null}else e=Pt.next;var a=on===null?yt.memoizedState:on.next;if(a!==null)on=a,Pt=e;else{if(e===null)throw yt.alternate===null?Error(s(467)):Error(s(310));Pt=e,e={memoizedState:Pt.memoizedState,baseState:Pt.baseState,baseQueue:Pt.baseQueue,queue:Pt.queue,next:null},on===null?yt.memoizedState=on=e:on=on.next=e}return on}function Gs(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Hl(e){var a=Ml;return Ml+=1,Vr===null&&(Vr=[]),e=Ap(Vr,e,a),a=yt,(on===null?a.memoizedState:on.next)===null&&(a=a.alternate,A.H=a===null||a.memoizedState===null?bf:Qi),e}function Ws(e){if(e!==null&&typeof e=="object"){if(typeof e.then=="function")return Hl(e);if(e.$$typeof===k)return yn(e)}throw Error(s(438,String(e)))}function Li(e){var a=null,l=yt.updateQueue;if(l!==null&&(a=l.memoCache),a==null){var i=yt.alternate;i!==null&&(i=i.updateQueue,i!==null&&(i=i.memoCache,i!=null&&(a={data:i.data.map(function(_){return _.slice()}),index:0})))}if(a==null&&(a={data:[],index:0}),l===null&&(l=Gs(),yt.updateQueue=l),l.memoCache=a,l=a.data[a.index],l===void 0)for(l=a.data[a.index]=Array(e),i=0;i<e;i++)l[i]=B;return a.index++,l}function ro(e,a){return typeof a=="function"?a(e):a}function Ys(e){var a=tn();return Ui(a,Pt,e)}function Ui(e,a,l){var i=e.queue;if(i===null)throw Error(s(311));i.lastRenderedReducer=l;var _=e.baseQueue,S=i.pending;if(S!==null){if(_!==null){var $=_.next;_.next=S.next,S.next=$}a.baseQueue=_=S,i.pending=null}if(S=e.baseState,_===null)e.memoizedState=S;else{a=_.next;var Q=$=null,ae=null,me=a,Te=!1;do{var $e=me.lane&-536870913;if($e!==me.lane?(bt&$e)===$e:(oo&$e)===$e){var ve=me.revertLane;if(ve===0)ae!==null&&(ae=ae.next={lane:0,revertLane:0,gesture:null,action:me.action,hasEagerState:me.hasEagerState,eagerState:me.eagerState,next:null}),$e===qr&&(Te=!0);else if((oo&ve)===ve){me=me.next,ve===qr&&(Te=!0);continue}else $e={lane:0,revertLane:me.revertLane,gesture:null,action:me.action,hasEagerState:me.hasEagerState,eagerState:me.eagerState,next:null},ae===null?(Q=ae=$e,$=S):ae=ae.next=$e,yt.lanes|=ve,Po|=ve;$e=me.action,yr&&l(S,$e),S=me.hasEagerState?me.eagerState:l(S,$e)}else ve={lane:$e,revertLane:me.revertLane,gesture:me.gesture,action:me.action,hasEagerState:me.hasEagerState,eagerState:me.eagerState,next:null},ae===null?(Q=ae=ve,$=S):ae=ae.next=ve,yt.lanes|=$e,Po|=$e;me=me.next}while(me!==null&&me!==a);if(ae===null?$=S:ae.next=Q,!Jn(S,e.memoizedState)&&(rn=!0,Te&&(l=Lr,l!==null)))throw l;e.memoizedState=S,e.baseState=$,e.baseQueue=ae,i.lastRenderedState=S}return _===null&&(i.lanes=0),[e.memoizedState,i.dispatch]}function Oi(e){var a=tn(),l=a.queue;if(l===null)throw Error(s(311));l.lastRenderedReducer=e;var i=l.dispatch,_=l.pending,S=a.memoizedState;if(_!==null){l.pending=null;var $=_=_.next;do S=e(S,$.action),$=$.next;while($!==_);Jn(S,a.memoizedState)||(rn=!0),a.memoizedState=S,a.baseQueue===null&&(a.baseState=S),l.lastRenderedState=S}return[S,i]}function Vp(e,a,l){var i=yt,_=tn(),S=jt;if(S){if(l===void 0)throw Error(s(407));l=l()}else l=a();var $=!Jn((Pt||_).memoizedState,l);if($&&(_.memoizedState=l,rn=!0),_=_.queue,Vi(Gp.bind(null,i,_,e),[e]),_.getSnapshot!==a||$||on!==null&&on.memoizedState.tag&1){if(i.flags|=2048,zr(9,{destroy:void 0},Bp.bind(null,i,_,l,a),null),Mt===null)throw Error(s(349));S||(oo&127)!==0||zp(i,a,l)}return l}function zp(e,a,l){e.flags|=16384,e={getSnapshot:a,value:l},a=yt.updateQueue,a===null?(a=Gs(),yt.updateQueue=a,a.stores=[e]):(l=a.stores,l===null?a.stores=[e]:l.push(e))}function Bp(e,a,l,i){a.value=l,a.getSnapshot=i,Wp(a)&&Yp(e)}function Gp(e,a,l){return l(function(){Wp(a)&&Yp(e)})}function Wp(e){var a=e.getSnapshot;e=e.value;try{var l=a();return!Jn(e,l)}catch{return!0}}function Yp(e){var a=sr(e,2);a!==null&&Wn(a,e,2)}function Mi(e){var a=An();if(typeof e=="function"){var l=e;if(e=l(),yr){tt(!0);try{l()}finally{tt(!1)}}}return a.memoizedState=a.baseState=e,a.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ro,lastRenderedState:e},a}function Qp(e,a,l,i){return e.baseState=l,Ui(e,Pt,typeof i=="function"?i:ro)}function i0(e,a,l,i,_){if(Zs(e))throw Error(s(485));if(e=a.action,e!==null){var S={payload:_,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function($){S.listeners.push($)}};A.T!==null?l(!0):S.isTransition=!1,i(S),l=a.pending,l===null?(S.next=a.pending=S,Xp(a,S)):(S.next=l.next,a.pending=l.next=S)}}function Xp(e,a){var l=a.action,i=a.payload,_=e.state;if(a.isTransition){var S=A.T,$={};A.T=$;try{var Q=l(_,i),ae=A.S;ae!==null&&ae($,Q),Zp(e,a,Q)}catch(me){Hi(e,a,me)}finally{S!==null&&$.types!==null&&(S.types=$.types),A.T=S}}else try{S=l(_,i),Zp(e,a,S)}catch(me){Hi(e,a,me)}}function Zp(e,a,l){l!==null&&typeof l=="object"&&typeof l.then=="function"?l.then(function(i){Kp(e,a,i)},function(i){return Hi(e,a,i)}):Kp(e,a,l)}function Kp(e,a,l){a.status="fulfilled",a.value=l,Jp(a),e.state=l,a=e.pending,a!==null&&(l=a.next,l===a?e.pending=null:(l=l.next,a.next=l,Xp(e,l)))}function Hi(e,a,l){var i=e.pending;if(e.pending=null,i!==null){i=i.next;do a.status="rejected",a.reason=l,Jp(a),a=a.next;while(a!==i)}e.action=null}function Jp(e){e=e.listeners;for(var a=0;a<e.length;a++)(0,e[a])()}function ef(e,a){return a}function tf(e,a){if(jt){var l=Mt.formState;if(l!==null){e:{var i=yt;if(jt){if(zt){t:{for(var _=zt,S=va;_.nodeType!==8;){if(!S){_=null;break t}if(_=wa(_.nextSibling),_===null){_=null;break t}}S=_.data,_=S==="F!"||S==="F"?_:null}if(_){zt=wa(_.nextSibling),i=_.data==="F!";break e}}ko(i)}i=!1}i&&(a=l[0])}}return l=An(),l.memoizedState=l.baseState=a,i={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ef,lastRenderedState:a},l.queue=i,l=xf.bind(null,yt,i),i.dispatch=l,i=Mi(!1),S=Yi.bind(null,yt,!1,i.queue),i=An(),_={state:a,dispatch:null,action:e,pending:null},i.queue=_,l=i0.bind(null,yt,_,S,l),_.dispatch=l,i.memoizedState=e,[a,l,!1]}function nf(e){var a=tn();return af(a,Pt,e)}function af(e,a,l){if(a=Ui(e,a,ef)[0],e=Ys(ro)[0],typeof a=="object"&&a!==null&&typeof a.then=="function")try{var i=Hl(a)}catch($){throw $===Ur?Ls:$}else i=a;a=tn();var _=a.queue,S=_.dispatch;return l!==a.memoizedState&&(yt.flags|=2048,zr(9,{destroy:void 0},d0.bind(null,_,l),null)),[i,S,e]}function d0(e,a){e.action=a}function of(e){var a=tn(),l=Pt;if(l!==null)return af(a,l,e);tn(),a=a.memoizedState,l=tn();var i=l.queue.dispatch;return l.memoizedState=e,[a,i,!1]}function zr(e,a,l,i){return e={tag:e,create:l,deps:i,inst:a,next:null},a=yt.updateQueue,a===null&&(a=Gs(),yt.updateQueue=a),l=a.lastEffect,l===null?a.lastEffect=e.next=e:(i=l.next,l.next=e,e.next=i,a.lastEffect=e),e}function rf(){return tn().memoizedState}function Qs(e,a,l,i){var _=An();yt.flags|=e,_.memoizedState=zr(1|a,{destroy:void 0},l,i===void 0?null:i)}function Xs(e,a,l,i){var _=tn();i=i===void 0?null:i;var S=_.memoizedState.inst;Pt!==null&&i!==null&&Fi(i,Pt.memoizedState.deps)?_.memoizedState=zr(a,S,l,i):(yt.flags|=e,_.memoizedState=zr(1|a,S,l,i))}function lf(e,a){Qs(8390656,8,e,a)}function Vi(e,a){Xs(2048,8,e,a)}function u0(e){yt.flags|=4;var a=yt.updateQueue;if(a===null)a=Gs(),yt.updateQueue=a,a.events=[e];else{var l=a.events;l===null?a.events=[e]:l.push(e)}}function sf(e){var a=tn().memoizedState;return u0({ref:a,nextImpl:e}),function(){if((At&2)!==0)throw Error(s(440));return a.impl.apply(void 0,arguments)}}function cf(e,a){return Xs(4,2,e,a)}function df(e,a){return Xs(4,4,e,a)}function uf(e,a){if(typeof a=="function"){e=e();var l=a(e);return function(){typeof l=="function"?l():a(null)}}if(a!=null)return e=e(),a.current=e,function(){a.current=null}}function pf(e,a,l){l=l!=null?l.concat([e]):null,Xs(4,4,uf.bind(null,a,e),l)}function zi(){}function ff(e,a){var l=tn();a=a===void 0?null:a;var i=l.memoizedState;return a!==null&&Fi(a,i[1])?i[0]:(l.memoizedState=[e,a],e)}function hf(e,a){var l=tn();a=a===void 0?null:a;var i=l.memoizedState;if(a!==null&&Fi(a,i[1]))return i[0];if(i=e(),yr){tt(!0);try{e()}finally{tt(!1)}}return l.memoizedState=[i,a],i}function Bi(e,a,l){return l===void 0||(oo&1073741824)!==0&&(bt&261930)===0?e.memoizedState=a:(e.memoizedState=l,e=mh(),yt.lanes|=e,Po|=e,l)}function mf(e,a,l,i){return Jn(l,a)?l:Mr.current!==null?(e=Bi(e,l,i),Jn(e,a)||(rn=!0),e):(oo&42)===0||(oo&1073741824)!==0&&(bt&261930)===0?(rn=!0,e.memoizedState=l):(e=mh(),yt.lanes|=e,Po|=e,a)}function yf(e,a,l,i,_){var S=N.p;N.p=S!==0&&8>S?S:8;var $=A.T,Q={};A.T=Q,Yi(e,!1,a,l);try{var ae=_(),me=A.S;if(me!==null&&me(Q,ae),ae!==null&&typeof ae=="object"&&typeof ae.then=="function"){var Te=l0(ae,i);Vl(e,a,Te,ra(e))}else Vl(e,a,i,ra(e))}catch($e){Vl(e,a,{then:function(){},status:"rejected",reason:$e},ra())}finally{N.p=S,$!==null&&Q.types!==null&&($.types=Q.types),A.T=$}}function p0(){}function Gi(e,a,l,i){if(e.tag!==5)throw Error(s(476));var _=gf(e).queue;yf(e,_,a,T,l===null?p0:function(){return vf(e),l(i)})}function gf(e){var a=e.memoizedState;if(a!==null)return a;a={memoizedState:T,baseState:T,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ro,lastRenderedState:T},next:null};var l={};return a.next={memoizedState:l,baseState:l,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ro,lastRenderedState:l},next:null},e.memoizedState=a,e=e.alternate,e!==null&&(e.memoizedState=a),a}function vf(e){var a=gf(e);a.next===null&&(a=e.alternate.memoizedState),Vl(e,a.next.queue,{},ra())}function Wi(){return yn(ls)}function _f(){return tn().memoizedState}function wf(){return tn().memoizedState}function f0(e){for(var a=e.return;a!==null;){switch(a.tag){case 24:case 3:var l=ra();e=To(l);var i=Do(a,e,l);i!==null&&(Wn(i,a,l),Ll(i,a,l)),a={cache:Ci()},e.payload=a;return}a=a.return}}function h0(e,a,l){var i=ra();l={lane:i,revertLane:0,gesture:null,action:l,hasEagerState:!1,eagerState:null,next:null},Zs(e)?Cf(a,l):(l=ui(e,a,l,i),l!==null&&(Wn(l,e,i),Sf(l,a,i)))}function xf(e,a,l){var i=ra();Vl(e,a,l,i)}function Vl(e,a,l,i){var _={lane:i,revertLane:0,gesture:null,action:l,hasEagerState:!1,eagerState:null,next:null};if(Zs(e))Cf(a,_);else{var S=e.alternate;if(e.lanes===0&&(S===null||S.lanes===0)&&(S=a.lastRenderedReducer,S!==null))try{var $=a.lastRenderedState,Q=S($,l);if(_.hasEagerState=!0,_.eagerState=Q,Jn(Q,$))return Ds(e,a,_,0),Mt===null&&Ts(),!1}catch{}finally{}if(l=ui(e,a,_,i),l!==null)return Wn(l,e,i),Sf(l,a,i),!0}return!1}function Yi(e,a,l,i){if(i={lane:2,revertLane:jd(),gesture:null,action:i,hasEagerState:!1,eagerState:null,next:null},Zs(e)){if(a)throw Error(s(479))}else a=ui(e,l,i,2),a!==null&&Wn(a,e,2)}function Zs(e){var a=e.alternate;return e===yt||a!==null&&a===yt}function Cf(e,a){Hr=zs=!0;var l=e.pending;l===null?a.next=a:(a.next=l.next,l.next=a),e.pending=a}function Sf(e,a,l){if((l&4194048)!==0){var i=a.lanes;i&=e.pendingLanes,l|=i,a.lanes=l,Pa(e,l)}}var zl={readContext:yn,use:Ws,useCallback:Qt,useContext:Qt,useEffect:Qt,useImperativeHandle:Qt,useLayoutEffect:Qt,useInsertionEffect:Qt,useMemo:Qt,useReducer:Qt,useRef:Qt,useState:Qt,useDebugValue:Qt,useDeferredValue:Qt,useTransition:Qt,useSyncExternalStore:Qt,useId:Qt,useHostTransitionStatus:Qt,useFormState:Qt,useActionState:Qt,useOptimistic:Qt,useMemoCache:Qt,useCacheRefresh:Qt};zl.useEffectEvent=Qt;var bf={readContext:yn,use:Ws,useCallback:function(e,a){return An().memoizedState=[e,a===void 0?null:a],e},useContext:yn,useEffect:lf,useImperativeHandle:function(e,a,l){l=l!=null?l.concat([e]):null,Qs(4194308,4,uf.bind(null,a,e),l)},useLayoutEffect:function(e,a){return Qs(4194308,4,e,a)},useInsertionEffect:function(e,a){Qs(4,2,e,a)},useMemo:function(e,a){var l=An();a=a===void 0?null:a;var i=e();if(yr){tt(!0);try{e()}finally{tt(!1)}}return l.memoizedState=[i,a],i},useReducer:function(e,a,l){var i=An();if(l!==void 0){var _=l(a);if(yr){tt(!0);try{l(a)}finally{tt(!1)}}}else _=a;return i.memoizedState=i.baseState=_,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:_},i.queue=e,e=e.dispatch=h0.bind(null,yt,e),[i.memoizedState,e]},useRef:function(e){var a=An();return e={current:e},a.memoizedState=e},useState:function(e){e=Mi(e);var a=e.queue,l=xf.bind(null,yt,a);return a.dispatch=l,[e.memoizedState,l]},useDebugValue:zi,useDeferredValue:function(e,a){var l=An();return Bi(l,e,a)},useTransition:function(){var e=Mi(!1);return e=yf.bind(null,yt,e.queue,!0,!1),An().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,a,l){var i=yt,_=An();if(jt){if(l===void 0)throw Error(s(407));l=l()}else{if(l=a(),Mt===null)throw Error(s(349));(bt&127)!==0||zp(i,a,l)}_.memoizedState=l;var S={value:l,getSnapshot:a};return _.queue=S,lf(Gp.bind(null,i,S,e),[e]),i.flags|=2048,zr(9,{destroy:void 0},Bp.bind(null,i,S,l,a),null),l},useId:function(){var e=An(),a=Mt.identifierPrefix;if(jt){var l=Ma,i=Oa;l=(i&~(1<<32-rt(i)-1)).toString(32)+l,a="_"+a+"R_"+l,l=Bs++,0<l&&(a+="H"+l.toString(32)),a+="_"}else l=s0++,a="_"+a+"r_"+l.toString(32)+"_";return e.memoizedState=a},useHostTransitionStatus:Wi,useFormState:tf,useActionState:tf,useOptimistic:function(e){var a=An();a.memoizedState=a.baseState=e;var l={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return a.queue=l,a=Yi.bind(null,yt,!0,l),l.dispatch=a,[e,a]},useMemoCache:Li,useCacheRefresh:function(){return An().memoizedState=f0.bind(null,yt)},useEffectEvent:function(e){var a=An(),l={impl:e};return a.memoizedState=l,function(){if((At&2)!==0)throw Error(s(440));return l.impl.apply(void 0,arguments)}}},Qi={readContext:yn,use:Ws,useCallback:ff,useContext:yn,useEffect:Vi,useImperativeHandle:pf,useInsertionEffect:cf,useLayoutEffect:df,useMemo:hf,useReducer:Ys,useRef:rf,useState:function(){return Ys(ro)},useDebugValue:zi,useDeferredValue:function(e,a){var l=tn();return mf(l,Pt.memoizedState,e,a)},useTransition:function(){var e=Ys(ro)[0],a=tn().memoizedState;return[typeof e=="boolean"?e:Hl(e),a]},useSyncExternalStore:Vp,useId:_f,useHostTransitionStatus:Wi,useFormState:nf,useActionState:nf,useOptimistic:function(e,a){var l=tn();return Qp(l,Pt,e,a)},useMemoCache:Li,useCacheRefresh:wf};Qi.useEffectEvent=sf;var Ef={readContext:yn,use:Ws,useCallback:ff,useContext:yn,useEffect:Vi,useImperativeHandle:pf,useInsertionEffect:cf,useLayoutEffect:df,useMemo:hf,useReducer:Oi,useRef:rf,useState:function(){return Oi(ro)},useDebugValue:zi,useDeferredValue:function(e,a){var l=tn();return Pt===null?Bi(l,e,a):mf(l,Pt.memoizedState,e,a)},useTransition:function(){var e=Oi(ro)[0],a=tn().memoizedState;return[typeof e=="boolean"?e:Hl(e),a]},useSyncExternalStore:Vp,useId:_f,useHostTransitionStatus:Wi,useFormState:of,useActionState:of,useOptimistic:function(e,a){var l=tn();return Pt!==null?Qp(l,Pt,e,a):(l.baseState=e,[e,l.queue.dispatch])},useMemoCache:Li,useCacheRefresh:wf};Ef.useEffectEvent=sf;function Xi(e,a,l,i){a=e.memoizedState,l=l(i,a),l=l==null?a:m({},a,l),e.memoizedState=l,e.lanes===0&&(e.updateQueue.baseState=l)}var Zi={enqueueSetState:function(e,a,l){e=e._reactInternals;var i=ra(),_=To(i);_.payload=a,l!=null&&(_.callback=l),a=Do(e,_,i),a!==null&&(Wn(a,e,i),Ll(a,e,i))},enqueueReplaceState:function(e,a,l){e=e._reactInternals;var i=ra(),_=To(i);_.tag=1,_.payload=a,l!=null&&(_.callback=l),a=Do(e,_,i),a!==null&&(Wn(a,e,i),Ll(a,e,i))},enqueueForceUpdate:function(e,a){e=e._reactInternals;var l=ra(),i=To(l);i.tag=2,a!=null&&(i.callback=a),a=Do(e,i,l),a!==null&&(Wn(a,e,l),Ll(a,e,l))}};function jf(e,a,l,i,_,S,$){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(i,S,$):a.prototype&&a.prototype.isPureReactComponent?!Tl(l,i)||!Tl(_,S):!0}function kf(e,a,l,i){e=a.state,typeof a.componentWillReceiveProps=="function"&&a.componentWillReceiveProps(l,i),typeof a.UNSAFE_componentWillReceiveProps=="function"&&a.UNSAFE_componentWillReceiveProps(l,i),a.state!==e&&Zi.enqueueReplaceState(a,a.state,null)}function gr(e,a){var l=a;if("ref"in a){l={};for(var i in a)i!=="ref"&&(l[i]=a[i])}if(e=e.defaultProps){l===a&&(l=m({},l));for(var _ in e)l[_]===void 0&&(l[_]=e[_])}return l}function Rf(e){Ns(e)}function Nf(e){console.error(e)}function Tf(e){Ns(e)}function Ks(e,a){try{var l=e.onUncaughtError;l(a.value,{componentStack:a.stack})}catch(i){setTimeout(function(){throw i})}}function Df(e,a,l){try{var i=e.onCaughtError;i(l.value,{componentStack:l.stack,errorBoundary:a.tag===1?a.stateNode:null})}catch(_){setTimeout(function(){throw _})}}function Ki(e,a,l){return l=To(l),l.tag=3,l.payload={element:null},l.callback=function(){Ks(e,a)},l}function Af(e){return e=To(e),e.tag=3,e}function Ff(e,a,l,i){var _=l.type.getDerivedStateFromError;if(typeof _=="function"){var S=i.value;e.payload=function(){return _(S)},e.callback=function(){Df(a,l,i)}}var $=l.stateNode;$!==null&&typeof $.componentDidCatch=="function"&&(e.callback=function(){Df(a,l,i),typeof _!="function"&&(qo===null?qo=new Set([this]):qo.add(this));var Q=i.stack;this.componentDidCatch(i.value,{componentStack:Q!==null?Q:""})})}function m0(e,a,l,i,_){if(l.flags|=32768,i!==null&&typeof i=="object"&&typeof i.then=="function"){if(a=l.alternate,a!==null&&Pr(a,l,_,!0),l=ta.current,l!==null){switch(l.tag){case 31:case 13:return _a===null?dc():l.alternate===null&&Xt===0&&(Xt=3),l.flags&=-257,l.flags|=65536,l.lanes=_,i===Us?l.flags|=16384:(a=l.updateQueue,a===null?l.updateQueue=new Set([i]):a.add(i),Sd(e,i,_)),!1;case 22:return l.flags|=65536,i===Us?l.flags|=16384:(a=l.updateQueue,a===null?(a={transitions:null,markerInstances:null,retryQueue:new Set([i])},l.updateQueue=a):(l=a.retryQueue,l===null?a.retryQueue=new Set([i]):l.add(i)),Sd(e,i,_)),!1}throw Error(s(435,l.tag))}return Sd(e,i,_),dc(),!1}if(jt)return a=ta.current,a!==null?((a.flags&65536)===0&&(a.flags|=256),a.flags|=65536,a.lanes=_,i!==gi&&(e=Error(s(422),{cause:i}),Fl(ma(e,l)))):(i!==gi&&(a=Error(s(423),{cause:i}),Fl(ma(a,l))),e=e.current.alternate,e.flags|=65536,_&=-_,e.lanes|=_,i=ma(i,l),_=Ki(e.stateNode,i,_),Ri(e,_),Xt!==4&&(Xt=2)),!1;var S=Error(s(520),{cause:i});if(S=ma(S,l),Kl===null?Kl=[S]:Kl.push(S),Xt!==4&&(Xt=2),a===null)return!0;i=ma(i,l),l=a;do{switch(l.tag){case 3:return l.flags|=65536,e=_&-_,l.lanes|=e,e=Ki(l.stateNode,i,e),Ri(l,e),!1;case 1:if(a=l.type,S=l.stateNode,(l.flags&128)===0&&(typeof a.getDerivedStateFromError=="function"||S!==null&&typeof S.componentDidCatch=="function"&&(qo===null||!qo.has(S))))return l.flags|=65536,_&=-_,l.lanes|=_,_=Af(_),Ff(_,e,l,i),Ri(l,_),!1}l=l.return}while(l!==null);return!1}var Ji=Error(s(461)),rn=!1;function gn(e,a,l,i){a.child=e===null?Pp(a,null,l,i):mr(a,e.child,l,i)}function If(e,a,l,i,_){l=l.render;var S=a.ref;if("ref"in i){var $={};for(var Q in i)Q!=="ref"&&($[Q]=i[Q])}else $=i;return ur(a),i=Ii(e,a,l,$,S,_),Q=$i(),e!==null&&!rn?(Pi(e,a,_),lo(e,a,_)):(jt&&Q&&mi(a),a.flags|=1,gn(e,a,i,_),a.child)}function $f(e,a,l,i,_){if(e===null){var S=l.type;return typeof S=="function"&&!pi(S)&&S.defaultProps===void 0&&l.compare===null?(a.tag=15,a.type=S,Pf(e,a,S,i,_)):(e=Fs(l.type,null,i,a,a.mode,_),e.ref=a.ref,e.return=a,a.child=e)}if(S=e.child,!sd(e,_)){var $=S.memoizedProps;if(l=l.compare,l=l!==null?l:Tl,l($,i)&&e.ref===a.ref)return lo(e,a,_)}return a.flags|=1,e=eo(S,i),e.ref=a.ref,e.return=a,a.child=e}function Pf(e,a,l,i,_){if(e!==null){var S=e.memoizedProps;if(Tl(S,i)&&e.ref===a.ref)if(rn=!1,a.pendingProps=i=S,sd(e,_))(e.flags&131072)!==0&&(rn=!0);else return a.lanes=e.lanes,lo(e,a,_)}return ed(e,a,l,i,_)}function qf(e,a,l,i){var _=i.children,S=e!==null?e.memoizedState:null;if(e===null&&a.stateNode===null&&(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),i.mode==="hidden"){if((a.flags&128)!==0){if(S=S!==null?S.baseLanes|l:l,e!==null){for(i=a.child=e.child,_=0;i!==null;)_=_|i.lanes|i.childLanes,i=i.sibling;i=_&~S}else i=0,a.child=null;return Lf(e,a,S,l,i)}if((l&536870912)!==0)a.memoizedState={baseLanes:0,cachePool:null},e!==null&&qs(a,S!==null?S.cachePool:null),S!==null?Up(a,S):Ti(),Op(a);else return i=a.lanes=536870912,Lf(e,a,S!==null?S.baseLanes|l:l,l,i)}else S!==null?(qs(a,S.cachePool),Up(a,S),Fo(),a.memoizedState=null):(e!==null&&qs(a,null),Ti(),Fo());return gn(e,a,_,l),a.child}function Bl(e,a){return e!==null&&e.tag===22||a.stateNode!==null||(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),a.sibling}function Lf(e,a,l,i,_){var S=bi();return S=S===null?null:{parent:an._currentValue,pool:S},a.memoizedState={baseLanes:l,cachePool:S},e!==null&&qs(a,null),Ti(),Op(a),e!==null&&Pr(e,a,i,!0),a.childLanes=_,null}function Js(e,a){return a=tc({mode:a.mode,children:a.children},e.mode),a.ref=e.ref,e.child=a,a.return=e,a}function Uf(e,a,l){return mr(a,e.child,null,l),e=Js(a,a.pendingProps),e.flags|=2,na(a),a.memoizedState=null,e}function y0(e,a,l){var i=a.pendingProps,_=(a.flags&128)!==0;if(a.flags&=-129,e===null){if(jt){if(i.mode==="hidden")return e=Js(a,i),a.lanes=536870912,Bl(null,e);if(Ai(a),(e=zt)?(e=Zh(e,va),e=e!==null&&e.data==="&"?e:null,e!==null&&(a.memoizedState={dehydrated:e,treeContext:Eo!==null?{id:Oa,overflow:Ma}:null,retryLane:536870912,hydrationErrors:null},l=xp(e),l.return=a,a.child=l,mn=a,zt=null)):e=null,e===null)throw ko(a);return a.lanes=536870912,null}return Js(a,i)}var S=e.memoizedState;if(S!==null){var $=S.dehydrated;if(Ai(a),_)if(a.flags&256)a.flags&=-257,a=Uf(e,a,l);else if(a.memoizedState!==null)a.child=e.child,a.flags|=128,a=null;else throw Error(s(558));else if(rn||Pr(e,a,l,!1),_=(l&e.childLanes)!==0,rn||_){if(i=Mt,i!==null&&($=qa(i,l),$!==0&&$!==S.retryLane))throw S.retryLane=$,sr(e,$),Wn(i,e,$),Ji;dc(),a=Uf(e,a,l)}else e=S.treeContext,zt=wa($.nextSibling),mn=a,jt=!0,jo=null,va=!1,e!==null&&bp(a,e),a=Js(a,i),a.flags|=4096;return a}return e=eo(e.child,{mode:i.mode,children:i.children}),e.ref=a.ref,a.child=e,e.return=a,e}function ec(e,a){var l=a.ref;if(l===null)e!==null&&e.ref!==null&&(a.flags|=4194816);else{if(typeof l!="function"&&typeof l!="object")throw Error(s(284));(e===null||e.ref!==l)&&(a.flags|=4194816)}}function ed(e,a,l,i,_){return ur(a),l=Ii(e,a,l,i,void 0,_),i=$i(),e!==null&&!rn?(Pi(e,a,_),lo(e,a,_)):(jt&&i&&mi(a),a.flags|=1,gn(e,a,l,_),a.child)}function Of(e,a,l,i,_,S){return ur(a),a.updateQueue=null,l=Hp(a,i,l,_),Mp(e),i=$i(),e!==null&&!rn?(Pi(e,a,S),lo(e,a,S)):(jt&&i&&mi(a),a.flags|=1,gn(e,a,l,S),a.child)}function Mf(e,a,l,i,_){if(ur(a),a.stateNode===null){var S=Ar,$=l.contextType;typeof $=="object"&&$!==null&&(S=yn($)),S=new l(i,S),a.memoizedState=S.state!==null&&S.state!==void 0?S.state:null,S.updater=Zi,a.stateNode=S,S._reactInternals=a,S=a.stateNode,S.props=i,S.state=a.memoizedState,S.refs={},ji(a),$=l.contextType,S.context=typeof $=="object"&&$!==null?yn($):Ar,S.state=a.memoizedState,$=l.getDerivedStateFromProps,typeof $=="function"&&(Xi(a,l,$,i),S.state=a.memoizedState),typeof l.getDerivedStateFromProps=="function"||typeof S.getSnapshotBeforeUpdate=="function"||typeof S.UNSAFE_componentWillMount!="function"&&typeof S.componentWillMount!="function"||($=S.state,typeof S.componentWillMount=="function"&&S.componentWillMount(),typeof S.UNSAFE_componentWillMount=="function"&&S.UNSAFE_componentWillMount(),$!==S.state&&Zi.enqueueReplaceState(S,S.state,null),Ol(a,i,S,_),Ul(),S.state=a.memoizedState),typeof S.componentDidMount=="function"&&(a.flags|=4194308),i=!0}else if(e===null){S=a.stateNode;var Q=a.memoizedProps,ae=gr(l,Q);S.props=ae;var me=S.context,Te=l.contextType;$=Ar,typeof Te=="object"&&Te!==null&&($=yn(Te));var $e=l.getDerivedStateFromProps;Te=typeof $e=="function"||typeof S.getSnapshotBeforeUpdate=="function",Q=a.pendingProps!==Q,Te||typeof S.UNSAFE_componentWillReceiveProps!="function"&&typeof S.componentWillReceiveProps!="function"||(Q||me!==$)&&kf(a,S,i,$),No=!1;var ve=a.memoizedState;S.state=ve,Ol(a,i,S,_),Ul(),me=a.memoizedState,Q||ve!==me||No?(typeof $e=="function"&&(Xi(a,l,$e,i),me=a.memoizedState),(ae=No||jf(a,l,ae,i,ve,me,$))?(Te||typeof S.UNSAFE_componentWillMount!="function"&&typeof S.componentWillMount!="function"||(typeof S.componentWillMount=="function"&&S.componentWillMount(),typeof S.UNSAFE_componentWillMount=="function"&&S.UNSAFE_componentWillMount()),typeof S.componentDidMount=="function"&&(a.flags|=4194308)):(typeof S.componentDidMount=="function"&&(a.flags|=4194308),a.memoizedProps=i,a.memoizedState=me),S.props=i,S.state=me,S.context=$,i=ae):(typeof S.componentDidMount=="function"&&(a.flags|=4194308),i=!1)}else{S=a.stateNode,ki(e,a),$=a.memoizedProps,Te=gr(l,$),S.props=Te,$e=a.pendingProps,ve=S.context,me=l.contextType,ae=Ar,typeof me=="object"&&me!==null&&(ae=yn(me)),Q=l.getDerivedStateFromProps,(me=typeof Q=="function"||typeof S.getSnapshotBeforeUpdate=="function")||typeof S.UNSAFE_componentWillReceiveProps!="function"&&typeof S.componentWillReceiveProps!="function"||($!==$e||ve!==ae)&&kf(a,S,i,ae),No=!1,ve=a.memoizedState,S.state=ve,Ol(a,i,S,_),Ul();var Ee=a.memoizedState;$!==$e||ve!==Ee||No||e!==null&&e.dependencies!==null&&$s(e.dependencies)?(typeof Q=="function"&&(Xi(a,l,Q,i),Ee=a.memoizedState),(Te=No||jf(a,l,Te,i,ve,Ee,ae)||e!==null&&e.dependencies!==null&&$s(e.dependencies))?(me||typeof S.UNSAFE_componentWillUpdate!="function"&&typeof S.componentWillUpdate!="function"||(typeof S.componentWillUpdate=="function"&&S.componentWillUpdate(i,Ee,ae),typeof S.UNSAFE_componentWillUpdate=="function"&&S.UNSAFE_componentWillUpdate(i,Ee,ae)),typeof S.componentDidUpdate=="function"&&(a.flags|=4),typeof S.getSnapshotBeforeUpdate=="function"&&(a.flags|=1024)):(typeof S.componentDidUpdate!="function"||$===e.memoizedProps&&ve===e.memoizedState||(a.flags|=4),typeof S.getSnapshotBeforeUpdate!="function"||$===e.memoizedProps&&ve===e.memoizedState||(a.flags|=1024),a.memoizedProps=i,a.memoizedState=Ee),S.props=i,S.state=Ee,S.context=ae,i=Te):(typeof S.componentDidUpdate!="function"||$===e.memoizedProps&&ve===e.memoizedState||(a.flags|=4),typeof S.getSnapshotBeforeUpdate!="function"||$===e.memoizedProps&&ve===e.memoizedState||(a.flags|=1024),i=!1)}return S=i,ec(e,a),i=(a.flags&128)!==0,S||i?(S=a.stateNode,l=i&&typeof l.getDerivedStateFromError!="function"?null:S.render(),a.flags|=1,e!==null&&i?(a.child=mr(a,e.child,null,_),a.child=mr(a,null,l,_)):gn(e,a,l,_),a.memoizedState=S.state,e=a.child):e=lo(e,a,_),e}function Hf(e,a,l,i){return ir(),a.flags|=256,gn(e,a,l,i),a.child}var td={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function nd(e){return{baseLanes:e,cachePool:Tp()}}function ad(e,a,l){return e=e!==null?e.childLanes&~l:0,a&&(e|=oa),e}function Vf(e,a,l){var i=a.pendingProps,_=!1,S=(a.flags&128)!==0,$;if(($=S)||($=e!==null&&e.memoizedState===null?!1:(en.current&2)!==0),$&&(_=!0,a.flags&=-129),$=(a.flags&32)!==0,a.flags&=-33,e===null){if(jt){if(_?Ao(a):Fo(),(e=zt)?(e=Zh(e,va),e=e!==null&&e.data!=="&"?e:null,e!==null&&(a.memoizedState={dehydrated:e,treeContext:Eo!==null?{id:Oa,overflow:Ma}:null,retryLane:536870912,hydrationErrors:null},l=xp(e),l.return=a,a.child=l,mn=a,zt=null)):e=null,e===null)throw ko(a);return Ud(e)?a.lanes=32:a.lanes=536870912,null}var Q=i.children;return i=i.fallback,_?(Fo(),_=a.mode,Q=tc({mode:"hidden",children:Q},_),i=cr(i,_,l,null),Q.return=a,i.return=a,Q.sibling=i,a.child=Q,i=a.child,i.memoizedState=nd(l),i.childLanes=ad(e,$,l),a.memoizedState=td,Bl(null,i)):(Ao(a),od(a,Q))}var ae=e.memoizedState;if(ae!==null&&(Q=ae.dehydrated,Q!==null)){if(S)a.flags&256?(Ao(a),a.flags&=-257,a=rd(e,a,l)):a.memoizedState!==null?(Fo(),a.child=e.child,a.flags|=128,a=null):(Fo(),Q=i.fallback,_=a.mode,i=tc({mode:"visible",children:i.children},_),Q=cr(Q,_,l,null),Q.flags|=2,i.return=a,Q.return=a,i.sibling=Q,a.child=i,mr(a,e.child,null,l),i=a.child,i.memoizedState=nd(l),i.childLanes=ad(e,$,l),a.memoizedState=td,a=Bl(null,i));else if(Ao(a),Ud(Q)){if($=Q.nextSibling&&Q.nextSibling.dataset,$)var me=$.dgst;$=me,i=Error(s(419)),i.stack="",i.digest=$,Fl({value:i,source:null,stack:null}),a=rd(e,a,l)}else if(rn||Pr(e,a,l,!1),$=(l&e.childLanes)!==0,rn||$){if($=Mt,$!==null&&(i=qa($,l),i!==0&&i!==ae.retryLane))throw ae.retryLane=i,sr(e,i),Wn($,e,i),Ji;Ld(Q)||dc(),a=rd(e,a,l)}else Ld(Q)?(a.flags|=192,a.child=e.child,a=null):(e=ae.treeContext,zt=wa(Q.nextSibling),mn=a,jt=!0,jo=null,va=!1,e!==null&&bp(a,e),a=od(a,i.children),a.flags|=4096);return a}return _?(Fo(),Q=i.fallback,_=a.mode,ae=e.child,me=ae.sibling,i=eo(ae,{mode:"hidden",children:i.children}),i.subtreeFlags=ae.subtreeFlags&65011712,me!==null?Q=eo(me,Q):(Q=cr(Q,_,l,null),Q.flags|=2),Q.return=a,i.return=a,i.sibling=Q,a.child=i,Bl(null,i),i=a.child,Q=e.child.memoizedState,Q===null?Q=nd(l):(_=Q.cachePool,_!==null?(ae=an._currentValue,_=_.parent!==ae?{parent:ae,pool:ae}:_):_=Tp(),Q={baseLanes:Q.baseLanes|l,cachePool:_}),i.memoizedState=Q,i.childLanes=ad(e,$,l),a.memoizedState=td,Bl(e.child,i)):(Ao(a),l=e.child,e=l.sibling,l=eo(l,{mode:"visible",children:i.children}),l.return=a,l.sibling=null,e!==null&&($=a.deletions,$===null?(a.deletions=[e],a.flags|=16):$.push(e)),a.child=l,a.memoizedState=null,l)}function od(e,a){return a=tc({mode:"visible",children:a},e.mode),a.return=e,e.child=a}function tc(e,a){return e=ea(22,e,null,a),e.lanes=0,e}function rd(e,a,l){return mr(a,e.child,null,l),e=od(a,a.pendingProps.children),e.flags|=2,a.memoizedState=null,e}function zf(e,a,l){e.lanes|=a;var i=e.alternate;i!==null&&(i.lanes|=a),wi(e.return,a,l)}function ld(e,a,l,i,_,S){var $=e.memoizedState;$===null?e.memoizedState={isBackwards:a,rendering:null,renderingStartTime:0,last:i,tail:l,tailMode:_,treeForkCount:S}:($.isBackwards=a,$.rendering=null,$.renderingStartTime=0,$.last=i,$.tail=l,$.tailMode=_,$.treeForkCount=S)}function Bf(e,a,l){var i=a.pendingProps,_=i.revealOrder,S=i.tail;i=i.children;var $=en.current,Q=($&2)!==0;if(Q?($=$&1|2,a.flags|=128):$&=1,X(en,$),gn(e,a,i,l),i=jt?Al:0,!Q&&e!==null&&(e.flags&128)!==0)e:for(e=a.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&zf(e,l,a);else if(e.tag===19)zf(e,l,a);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===a)break e;for(;e.sibling===null;){if(e.return===null||e.return===a)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}switch(_){case"forwards":for(l=a.child,_=null;l!==null;)e=l.alternate,e!==null&&Vs(e)===null&&(_=l),l=l.sibling;l=_,l===null?(_=a.child,a.child=null):(_=l.sibling,l.sibling=null),ld(a,!1,_,l,S,i);break;case"backwards":case"unstable_legacy-backwards":for(l=null,_=a.child,a.child=null;_!==null;){if(e=_.alternate,e!==null&&Vs(e)===null){a.child=_;break}e=_.sibling,_.sibling=l,l=_,_=e}ld(a,!0,l,null,S,i);break;case"together":ld(a,!1,null,null,void 0,i);break;default:a.memoizedState=null}return a.child}function lo(e,a,l){if(e!==null&&(a.dependencies=e.dependencies),Po|=a.lanes,(l&a.childLanes)===0)if(e!==null){if(Pr(e,a,l,!1),(l&a.childLanes)===0)return null}else return null;if(e!==null&&a.child!==e.child)throw Error(s(153));if(a.child!==null){for(e=a.child,l=eo(e,e.pendingProps),a.child=l,l.return=a;e.sibling!==null;)e=e.sibling,l=l.sibling=eo(e,e.pendingProps),l.return=a;l.sibling=null}return a.child}function sd(e,a){return(e.lanes&a)!==0?!0:(e=e.dependencies,!!(e!==null&&$s(e)))}function g0(e,a,l){switch(a.tag){case 3:xe(a,a.stateNode.containerInfo),Ro(a,an,e.memoizedState.cache),ir();break;case 27:case 5:Ce(a);break;case 4:xe(a,a.stateNode.containerInfo);break;case 10:Ro(a,a.type,a.memoizedProps.value);break;case 31:if(a.memoizedState!==null)return a.flags|=128,Ai(a),null;break;case 13:var i=a.memoizedState;if(i!==null)return i.dehydrated!==null?(Ao(a),a.flags|=128,null):(l&a.child.childLanes)!==0?Vf(e,a,l):(Ao(a),e=lo(e,a,l),e!==null?e.sibling:null);Ao(a);break;case 19:var _=(e.flags&128)!==0;if(i=(l&a.childLanes)!==0,i||(Pr(e,a,l,!1),i=(l&a.childLanes)!==0),_){if(i)return Bf(e,a,l);a.flags|=128}if(_=a.memoizedState,_!==null&&(_.rendering=null,_.tail=null,_.lastEffect=null),X(en,en.current),i)break;return null;case 22:return a.lanes=0,qf(e,a,l,a.pendingProps);case 24:Ro(a,an,e.memoizedState.cache)}return lo(e,a,l)}function Gf(e,a,l){if(e!==null)if(e.memoizedProps!==a.pendingProps)rn=!0;else{if(!sd(e,l)&&(a.flags&128)===0)return rn=!1,g0(e,a,l);rn=(e.flags&131072)!==0}else rn=!1,jt&&(a.flags&1048576)!==0&&Sp(a,Al,a.index);switch(a.lanes=0,a.tag){case 16:e:{var i=a.pendingProps;if(e=fr(a.elementType),a.type=e,typeof e=="function")pi(e)?(i=gr(e,i),a.tag=1,a=Mf(null,a,e,i,l)):(a.tag=0,a=ed(null,a,e,i,l));else{if(e!=null){var _=e.$$typeof;if(_===R){a.tag=11,a=If(null,a,e,i,l);break e}else if(_===I){a.tag=14,a=$f(null,a,e,i,l);break e}}throw a=z(e)||e,Error(s(306,a,""))}}return a;case 0:return ed(e,a,a.type,a.pendingProps,l);case 1:return i=a.type,_=gr(i,a.pendingProps),Mf(e,a,i,_,l);case 3:e:{if(xe(a,a.stateNode.containerInfo),e===null)throw Error(s(387));i=a.pendingProps;var S=a.memoizedState;_=S.element,ki(e,a),Ol(a,i,null,l);var $=a.memoizedState;if(i=$.cache,Ro(a,an,i),i!==S.cache&&xi(a,[an],l,!0),Ul(),i=$.element,S.isDehydrated)if(S={element:i,isDehydrated:!1,cache:$.cache},a.updateQueue.baseState=S,a.memoizedState=S,a.flags&256){a=Hf(e,a,i,l);break e}else if(i!==_){_=ma(Error(s(424)),a),Fl(_),a=Hf(e,a,i,l);break e}else{switch(e=a.stateNode.containerInfo,e.nodeType){case 9:e=e.body;break;default:e=e.nodeName==="HTML"?e.ownerDocument.body:e}for(zt=wa(e.firstChild),mn=a,jt=!0,jo=null,va=!0,l=Pp(a,null,i,l),a.child=l;l;)l.flags=l.flags&-3|4096,l=l.sibling}else{if(ir(),i===_){a=lo(e,a,l);break e}gn(e,a,i,l)}a=a.child}return a;case 26:return ec(e,a),e===null?(l=am(a.type,null,a.pendingProps,null))?a.memoizedState=l:jt||(l=a.type,e=a.pendingProps,i=gc(Z.current).createElement(l),i[Vt]=a,i[Yt]=e,vn(i,l,e),Ot(i),a.stateNode=i):a.memoizedState=am(a.type,e.memoizedProps,a.pendingProps,e.memoizedState),null;case 27:return Ce(a),e===null&&jt&&(i=a.stateNode=em(a.type,a.pendingProps,Z.current),mn=a,va=!0,_=zt,Mo(a.type)?(Od=_,zt=wa(i.firstChild)):zt=_),gn(e,a,a.pendingProps.children,l),ec(e,a),e===null&&(a.flags|=4194304),a.child;case 5:return e===null&&jt&&((_=i=zt)&&(i=W0(i,a.type,a.pendingProps,va),i!==null?(a.stateNode=i,mn=a,zt=wa(i.firstChild),va=!1,_=!0):_=!1),_||ko(a)),Ce(a),_=a.type,S=a.pendingProps,$=e!==null?e.memoizedProps:null,i=S.children,$d(_,S)?i=null:$!==null&&$d(_,$)&&(a.flags|=32),a.memoizedState!==null&&(_=Ii(e,a,c0,null,null,l),ls._currentValue=_),ec(e,a),gn(e,a,i,l),a.child;case 6:return e===null&&jt&&((e=l=zt)&&(l=Y0(l,a.pendingProps,va),l!==null?(a.stateNode=l,mn=a,zt=null,e=!0):e=!1),e||ko(a)),null;case 13:return Vf(e,a,l);case 4:return xe(a,a.stateNode.containerInfo),i=a.pendingProps,e===null?a.child=mr(a,null,i,l):gn(e,a,i,l),a.child;case 11:return If(e,a,a.type,a.pendingProps,l);case 7:return gn(e,a,a.pendingProps,l),a.child;case 8:return gn(e,a,a.pendingProps.children,l),a.child;case 12:return gn(e,a,a.pendingProps.children,l),a.child;case 10:return i=a.pendingProps,Ro(a,a.type,i.value),gn(e,a,i.children,l),a.child;case 9:return _=a.type._context,i=a.pendingProps.children,ur(a),_=yn(_),i=i(_),a.flags|=1,gn(e,a,i,l),a.child;case 14:return $f(e,a,a.type,a.pendingProps,l);case 15:return Pf(e,a,a.type,a.pendingProps,l);case 19:return Bf(e,a,l);case 31:return y0(e,a,l);case 22:return qf(e,a,l,a.pendingProps);case 24:return ur(a),i=yn(an),e===null?(_=bi(),_===null&&(_=Mt,S=Ci(),_.pooledCache=S,S.refCount++,S!==null&&(_.pooledCacheLanes|=l),_=S),a.memoizedState={parent:i,cache:_},ji(a),Ro(a,an,_)):((e.lanes&l)!==0&&(ki(e,a),Ol(a,null,null,l),Ul()),_=e.memoizedState,S=a.memoizedState,_.parent!==i?(_={parent:i,cache:i},a.memoizedState=_,a.lanes===0&&(a.memoizedState=a.updateQueue.baseState=_),Ro(a,an,i)):(i=S.cache,Ro(a,an,i),i!==_.cache&&xi(a,[an],l,!0))),gn(e,a,a.pendingProps.children,l),a.child;case 29:throw a.pendingProps}throw Error(s(156,a.tag))}function so(e){e.flags|=4}function cd(e,a,l,i,_){if((a=(e.mode&32)!==0)&&(a=!1),a){if(e.flags|=16777216,(_&335544128)===_)if(e.stateNode.complete)e.flags|=8192;else if(_h())e.flags|=8192;else throw hr=Us,Ei}else e.flags&=-16777217}function Wf(e,a){if(a.type!=="stylesheet"||(a.state.loading&4)!==0)e.flags&=-16777217;else if(e.flags|=16777216,!cm(a))if(_h())e.flags|=8192;else throw hr=Us,Ei}function nc(e,a){a!==null&&(e.flags|=4),e.flags&16384&&(a=e.tag!==22?xn():536870912,e.lanes|=a,Yr|=a)}function Gl(e,a){if(!jt)switch(e.tailMode){case"hidden":a=e.tail;for(var l=null;a!==null;)a.alternate!==null&&(l=a),a=a.sibling;l===null?e.tail=null:l.sibling=null;break;case"collapsed":l=e.tail;for(var i=null;l!==null;)l.alternate!==null&&(i=l),l=l.sibling;i===null?a||e.tail===null?e.tail=null:e.tail.sibling=null:i.sibling=null}}function Bt(e){var a=e.alternate!==null&&e.alternate.child===e.child,l=0,i=0;if(a)for(var _=e.child;_!==null;)l|=_.lanes|_.childLanes,i|=_.subtreeFlags&65011712,i|=_.flags&65011712,_.return=e,_=_.sibling;else for(_=e.child;_!==null;)l|=_.lanes|_.childLanes,i|=_.subtreeFlags,i|=_.flags,_.return=e,_=_.sibling;return e.subtreeFlags|=i,e.childLanes=l,a}function v0(e,a,l){var i=a.pendingProps;switch(yi(a),a.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Bt(a),null;case 1:return Bt(a),null;case 3:return l=a.stateNode,i=null,e!==null&&(i=e.memoizedState.cache),a.memoizedState.cache!==i&&(a.flags|=2048),ao(an),ye(),l.pendingContext&&(l.context=l.pendingContext,l.pendingContext=null),(e===null||e.child===null)&&($r(a)?so(a):e===null||e.memoizedState.isDehydrated&&(a.flags&256)===0||(a.flags|=1024,vi())),Bt(a),null;case 26:var _=a.type,S=a.memoizedState;return e===null?(so(a),S!==null?(Bt(a),Wf(a,S)):(Bt(a),cd(a,_,null,i,l))):S?S!==e.memoizedState?(so(a),Bt(a),Wf(a,S)):(Bt(a),a.flags&=-16777217):(e=e.memoizedProps,e!==i&&so(a),Bt(a),cd(a,_,e,i,l)),null;case 27:if(pe(a),l=Z.current,_=a.type,e!==null&&a.stateNode!=null)e.memoizedProps!==i&&so(a);else{if(!i){if(a.stateNode===null)throw Error(s(166));return Bt(a),null}e=K.current,$r(a)?Ep(a):(e=em(_,i,l),a.stateNode=e,so(a))}return Bt(a),null;case 5:if(pe(a),_=a.type,e!==null&&a.stateNode!=null)e.memoizedProps!==i&&so(a);else{if(!i){if(a.stateNode===null)throw Error(s(166));return Bt(a),null}if(S=K.current,$r(a))Ep(a);else{var $=gc(Z.current);switch(S){case 1:S=$.createElementNS("http://www.w3.org/2000/svg",_);break;case 2:S=$.createElementNS("http://www.w3.org/1998/Math/MathML",_);break;default:switch(_){case"svg":S=$.createElementNS("http://www.w3.org/2000/svg",_);break;case"math":S=$.createElementNS("http://www.w3.org/1998/Math/MathML",_);break;case"script":S=$.createElement("div"),S.innerHTML="<script><\/script>",S=S.removeChild(S.firstChild);break;case"select":S=typeof i.is=="string"?$.createElement("select",{is:i.is}):$.createElement("select"),i.multiple?S.multiple=!0:i.size&&(S.size=i.size);break;default:S=typeof i.is=="string"?$.createElement(_,{is:i.is}):$.createElement(_)}}S[Vt]=a,S[Yt]=i;e:for($=a.child;$!==null;){if($.tag===5||$.tag===6)S.appendChild($.stateNode);else if($.tag!==4&&$.tag!==27&&$.child!==null){$.child.return=$,$=$.child;continue}if($===a)break e;for(;$.sibling===null;){if($.return===null||$.return===a)break e;$=$.return}$.sibling.return=$.return,$=$.sibling}a.stateNode=S;e:switch(vn(S,_,i),_){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}i&&so(a)}}return Bt(a),cd(a,a.type,e===null?null:e.memoizedProps,a.pendingProps,l),null;case 6:if(e&&a.stateNode!=null)e.memoizedProps!==i&&so(a);else{if(typeof i!="string"&&a.stateNode===null)throw Error(s(166));if(e=Z.current,$r(a)){if(e=a.stateNode,l=a.memoizedProps,i=null,_=mn,_!==null)switch(_.tag){case 27:case 5:i=_.memoizedProps}e[Vt]=a,e=!!(e.nodeValue===l||i!==null&&i.suppressHydrationWarning===!0||Vh(e.nodeValue,l)),e||ko(a,!0)}else e=gc(e).createTextNode(i),e[Vt]=a,a.stateNode=e}return Bt(a),null;case 31:if(l=a.memoizedState,e===null||e.memoizedState!==null){if(i=$r(a),l!==null){if(e===null){if(!i)throw Error(s(318));if(e=a.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(s(557));e[Vt]=a}else ir(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;Bt(a),e=!1}else l=vi(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=l),e=!0;if(!e)return a.flags&256?(na(a),a):(na(a),null);if((a.flags&128)!==0)throw Error(s(558))}return Bt(a),null;case 13:if(i=a.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(_=$r(a),i!==null&&i.dehydrated!==null){if(e===null){if(!_)throw Error(s(318));if(_=a.memoizedState,_=_!==null?_.dehydrated:null,!_)throw Error(s(317));_[Vt]=a}else ir(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;Bt(a),_=!1}else _=vi(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=_),_=!0;if(!_)return a.flags&256?(na(a),a):(na(a),null)}return na(a),(a.flags&128)!==0?(a.lanes=l,a):(l=i!==null,e=e!==null&&e.memoizedState!==null,l&&(i=a.child,_=null,i.alternate!==null&&i.alternate.memoizedState!==null&&i.alternate.memoizedState.cachePool!==null&&(_=i.alternate.memoizedState.cachePool.pool),S=null,i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(S=i.memoizedState.cachePool.pool),S!==_&&(i.flags|=2048)),l!==e&&l&&(a.child.flags|=8192),nc(a,a.updateQueue),Bt(a),null);case 4:return ye(),e===null&&Td(a.stateNode.containerInfo),Bt(a),null;case 10:return ao(a.type),Bt(a),null;case 19:if(Y(en),i=a.memoizedState,i===null)return Bt(a),null;if(_=(a.flags&128)!==0,S=i.rendering,S===null)if(_)Gl(i,!1);else{if(Xt!==0||e!==null&&(e.flags&128)!==0)for(e=a.child;e!==null;){if(S=Vs(e),S!==null){for(a.flags|=128,Gl(i,!1),e=S.updateQueue,a.updateQueue=e,nc(a,e),a.subtreeFlags=0,e=l,l=a.child;l!==null;)wp(l,e),l=l.sibling;return X(en,en.current&1|2),jt&&to(a,i.treeForkCount),a.child}e=e.sibling}i.tail!==null&&ke()>sc&&(a.flags|=128,_=!0,Gl(i,!1),a.lanes=4194304)}else{if(!_)if(e=Vs(S),e!==null){if(a.flags|=128,_=!0,e=e.updateQueue,a.updateQueue=e,nc(a,e),Gl(i,!0),i.tail===null&&i.tailMode==="hidden"&&!S.alternate&&!jt)return Bt(a),null}else 2*ke()-i.renderingStartTime>sc&&l!==536870912&&(a.flags|=128,_=!0,Gl(i,!1),a.lanes=4194304);i.isBackwards?(S.sibling=a.child,a.child=S):(e=i.last,e!==null?e.sibling=S:a.child=S,i.last=S)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=ke(),e.sibling=null,l=en.current,X(en,_?l&1|2:l&1),jt&&to(a,i.treeForkCount),e):(Bt(a),null);case 22:case 23:return na(a),Di(),i=a.memoizedState!==null,e!==null?e.memoizedState!==null!==i&&(a.flags|=8192):i&&(a.flags|=8192),i?(l&536870912)!==0&&(a.flags&128)===0&&(Bt(a),a.subtreeFlags&6&&(a.flags|=8192)):Bt(a),l=a.updateQueue,l!==null&&nc(a,l.retryQueue),l=null,e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(l=e.memoizedState.cachePool.pool),i=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(i=a.memoizedState.cachePool.pool),i!==l&&(a.flags|=2048),e!==null&&Y(pr),null;case 24:return l=null,e!==null&&(l=e.memoizedState.cache),a.memoizedState.cache!==l&&(a.flags|=2048),ao(an),Bt(a),null;case 25:return null;case 30:return null}throw Error(s(156,a.tag))}function _0(e,a){switch(yi(a),a.tag){case 1:return e=a.flags,e&65536?(a.flags=e&-65537|128,a):null;case 3:return ao(an),ye(),e=a.flags,(e&65536)!==0&&(e&128)===0?(a.flags=e&-65537|128,a):null;case 26:case 27:case 5:return pe(a),null;case 31:if(a.memoizedState!==null){if(na(a),a.alternate===null)throw Error(s(340));ir()}return e=a.flags,e&65536?(a.flags=e&-65537|128,a):null;case 13:if(na(a),e=a.memoizedState,e!==null&&e.dehydrated!==null){if(a.alternate===null)throw Error(s(340));ir()}return e=a.flags,e&65536?(a.flags=e&-65537|128,a):null;case 19:return Y(en),null;case 4:return ye(),null;case 10:return ao(a.type),null;case 22:case 23:return na(a),Di(),e!==null&&Y(pr),e=a.flags,e&65536?(a.flags=e&-65537|128,a):null;case 24:return ao(an),null;case 25:return null;default:return null}}function Yf(e,a){switch(yi(a),a.tag){case 3:ao(an),ye();break;case 26:case 27:case 5:pe(a);break;case 4:ye();break;case 31:a.memoizedState!==null&&na(a);break;case 13:na(a);break;case 19:Y(en);break;case 10:ao(a.type);break;case 22:case 23:na(a),Di(),e!==null&&Y(pr);break;case 24:ao(an)}}function Wl(e,a){try{var l=a.updateQueue,i=l!==null?l.lastEffect:null;if(i!==null){var _=i.next;l=_;do{if((l.tag&e)===e){i=void 0;var S=l.create,$=l.inst;i=S(),$.destroy=i}l=l.next}while(l!==_)}}catch(Q){$t(a,a.return,Q)}}function Io(e,a,l){try{var i=a.updateQueue,_=i!==null?i.lastEffect:null;if(_!==null){var S=_.next;i=S;do{if((i.tag&e)===e){var $=i.inst,Q=$.destroy;if(Q!==void 0){$.destroy=void 0,_=a;var ae=l,me=Q;try{me()}catch(Te){$t(_,ae,Te)}}}i=i.next}while(i!==S)}}catch(Te){$t(a,a.return,Te)}}function Qf(e){var a=e.updateQueue;if(a!==null){var l=e.stateNode;try{Lp(a,l)}catch(i){$t(e,e.return,i)}}}function Xf(e,a,l){l.props=gr(e.type,e.memoizedProps),l.state=e.memoizedState;try{l.componentWillUnmount()}catch(i){$t(e,a,i)}}function Yl(e,a){try{var l=e.ref;if(l!==null){switch(e.tag){case 26:case 27:case 5:var i=e.stateNode;break;case 30:i=e.stateNode;break;default:i=e.stateNode}typeof l=="function"?e.refCleanup=l(i):l.current=i}}catch(_){$t(e,a,_)}}function Ha(e,a){var l=e.ref,i=e.refCleanup;if(l!==null)if(typeof i=="function")try{i()}catch(_){$t(e,a,_)}finally{e.refCleanup=null,e=e.alternate,e!=null&&(e.refCleanup=null)}else if(typeof l=="function")try{l(null)}catch(_){$t(e,a,_)}else l.current=null}function Zf(e){var a=e.type,l=e.memoizedProps,i=e.stateNode;try{e:switch(a){case"button":case"input":case"select":case"textarea":l.autoFocus&&i.focus();break e;case"img":l.src?i.src=l.src:l.srcSet&&(i.srcset=l.srcSet)}}catch(_){$t(e,e.return,_)}}function id(e,a,l){try{var i=e.stateNode;M0(i,e.type,l,a),i[Yt]=a}catch(_){$t(e,e.return,_)}}function Kf(e){return e.tag===5||e.tag===3||e.tag===26||e.tag===27&&Mo(e.type)||e.tag===4}function dd(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||Kf(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.tag===27&&Mo(e.type)||e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function ud(e,a,l){var i=e.tag;if(i===5||i===6)e=e.stateNode,a?(l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l).insertBefore(e,a):(a=l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l,a.appendChild(e),l=l._reactRootContainer,l!=null||a.onclick!==null||(a.onclick=Mn));else if(i!==4&&(i===27&&Mo(e.type)&&(l=e.stateNode,a=null),e=e.child,e!==null))for(ud(e,a,l),e=e.sibling;e!==null;)ud(e,a,l),e=e.sibling}function ac(e,a,l){var i=e.tag;if(i===5||i===6)e=e.stateNode,a?l.insertBefore(e,a):l.appendChild(e);else if(i!==4&&(i===27&&Mo(e.type)&&(l=e.stateNode),e=e.child,e!==null))for(ac(e,a,l),e=e.sibling;e!==null;)ac(e,a,l),e=e.sibling}function Jf(e){var a=e.stateNode,l=e.memoizedProps;try{for(var i=e.type,_=a.attributes;_.length;)a.removeAttributeNode(_[0]);vn(a,i,l),a[Vt]=e,a[Yt]=l}catch(S){$t(e,e.return,S)}}var co=!1,ln=!1,pd=!1,eh=typeof WeakSet=="function"?WeakSet:Set,pn=null;function w0(e,a){if(e=e.containerInfo,Fd=bc,e=up(e),ri(e)){if("selectionStart"in e)var l={start:e.selectionStart,end:e.selectionEnd};else e:{l=(l=e.ownerDocument)&&l.defaultView||window;var i=l.getSelection&&l.getSelection();if(i&&i.rangeCount!==0){l=i.anchorNode;var _=i.anchorOffset,S=i.focusNode;i=i.focusOffset;try{l.nodeType,S.nodeType}catch{l=null;break e}var $=0,Q=-1,ae=-1,me=0,Te=0,$e=e,ve=null;t:for(;;){for(var Ee;$e!==l||_!==0&&$e.nodeType!==3||(Q=$+_),$e!==S||i!==0&&$e.nodeType!==3||(ae=$+i),$e.nodeType===3&&($+=$e.nodeValue.length),(Ee=$e.firstChild)!==null;)ve=$e,$e=Ee;for(;;){if($e===e)break t;if(ve===l&&++me===_&&(Q=$),ve===S&&++Te===i&&(ae=$),(Ee=$e.nextSibling)!==null)break;$e=ve,ve=$e.parentNode}$e=Ee}l=Q===-1||ae===-1?null:{start:Q,end:ae}}else l=null}l=l||{start:0,end:0}}else l=null;for(Id={focusedElem:e,selectionRange:l},bc=!1,pn=a;pn!==null;)if(a=pn,e=a.child,(a.subtreeFlags&1028)!==0&&e!==null)e.return=a,pn=e;else for(;pn!==null;){switch(a=pn,S=a.alternate,e=a.flags,a.tag){case 0:if((e&4)!==0&&(e=a.updateQueue,e=e!==null?e.events:null,e!==null))for(l=0;l<e.length;l++)_=e[l],_.ref.impl=_.nextImpl;break;case 11:case 15:break;case 1:if((e&1024)!==0&&S!==null){e=void 0,l=a,_=S.memoizedProps,S=S.memoizedState,i=l.stateNode;try{var Ke=gr(l.type,_);e=i.getSnapshotBeforeUpdate(Ke,S),i.__reactInternalSnapshotBeforeUpdate=e}catch(lt){$t(l,l.return,lt)}}break;case 3:if((e&1024)!==0){if(e=a.stateNode.containerInfo,l=e.nodeType,l===9)qd(e);else if(l===1)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":qd(e);break;default:e.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((e&1024)!==0)throw Error(s(163))}if(e=a.sibling,e!==null){e.return=a.return,pn=e;break}pn=a.return}}function th(e,a,l){var i=l.flags;switch(l.tag){case 0:case 11:case 15:uo(e,l),i&4&&Wl(5,l);break;case 1:if(uo(e,l),i&4)if(e=l.stateNode,a===null)try{e.componentDidMount()}catch($){$t(l,l.return,$)}else{var _=gr(l.type,a.memoizedProps);a=a.memoizedState;try{e.componentDidUpdate(_,a,e.__reactInternalSnapshotBeforeUpdate)}catch($){$t(l,l.return,$)}}i&64&&Qf(l),i&512&&Yl(l,l.return);break;case 3:if(uo(e,l),i&64&&(e=l.updateQueue,e!==null)){if(a=null,l.child!==null)switch(l.child.tag){case 27:case 5:a=l.child.stateNode;break;case 1:a=l.child.stateNode}try{Lp(e,a)}catch($){$t(l,l.return,$)}}break;case 27:a===null&&i&4&&Jf(l);case 26:case 5:uo(e,l),a===null&&i&4&&Zf(l),i&512&&Yl(l,l.return);break;case 12:uo(e,l);break;case 31:uo(e,l),i&4&&oh(e,l);break;case 13:uo(e,l),i&4&&rh(e,l),i&64&&(e=l.memoizedState,e!==null&&(e=e.dehydrated,e!==null&&(l=N0.bind(null,l),Q0(e,l))));break;case 22:if(i=l.memoizedState!==null||co,!i){a=a!==null&&a.memoizedState!==null||ln,_=co;var S=ln;co=i,(ln=a)&&!S?po(e,l,(l.subtreeFlags&8772)!==0):uo(e,l),co=_,ln=S}break;case 30:break;default:uo(e,l)}}function nh(e){var a=e.alternate;a!==null&&(e.alternate=null,nh(a)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(a=e.stateNode,a!==null&&ja(a)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var Wt=null,Vn=!1;function io(e,a,l){for(l=l.child;l!==null;)ah(e,a,l),l=l.sibling}function ah(e,a,l){if(et&&typeof et.onCommitFiberUnmount=="function")try{et.onCommitFiberUnmount(Ge,l)}catch{}switch(l.tag){case 26:ln||Ha(l,a),io(e,a,l),l.memoizedState?l.memoizedState.count--:l.stateNode&&(l=l.stateNode,l.parentNode.removeChild(l));break;case 27:ln||Ha(l,a);var i=Wt,_=Vn;Mo(l.type)&&(Wt=l.stateNode,Vn=!1),io(e,a,l),as(l.stateNode),Wt=i,Vn=_;break;case 5:ln||Ha(l,a);case 6:if(i=Wt,_=Vn,Wt=null,io(e,a,l),Wt=i,Vn=_,Wt!==null)if(Vn)try{(Wt.nodeType===9?Wt.body:Wt.nodeName==="HTML"?Wt.ownerDocument.body:Wt).removeChild(l.stateNode)}catch(S){$t(l,a,S)}else try{Wt.removeChild(l.stateNode)}catch(S){$t(l,a,S)}break;case 18:Wt!==null&&(Vn?(e=Wt,Qh(e.nodeType===9?e.body:e.nodeName==="HTML"?e.ownerDocument.body:e,l.stateNode),nl(e)):Qh(Wt,l.stateNode));break;case 4:i=Wt,_=Vn,Wt=l.stateNode.containerInfo,Vn=!0,io(e,a,l),Wt=i,Vn=_;break;case 0:case 11:case 14:case 15:Io(2,l,a),ln||Io(4,l,a),io(e,a,l);break;case 1:ln||(Ha(l,a),i=l.stateNode,typeof i.componentWillUnmount=="function"&&Xf(l,a,i)),io(e,a,l);break;case 21:io(e,a,l);break;case 22:ln=(i=ln)||l.memoizedState!==null,io(e,a,l),ln=i;break;default:io(e,a,l)}}function oh(e,a){if(a.memoizedState===null&&(e=a.alternate,e!==null&&(e=e.memoizedState,e!==null))){e=e.dehydrated;try{nl(e)}catch(l){$t(a,a.return,l)}}}function rh(e,a){if(a.memoizedState===null&&(e=a.alternate,e!==null&&(e=e.memoizedState,e!==null&&(e=e.dehydrated,e!==null))))try{nl(e)}catch(l){$t(a,a.return,l)}}function x0(e){switch(e.tag){case 31:case 13:case 19:var a=e.stateNode;return a===null&&(a=e.stateNode=new eh),a;case 22:return e=e.stateNode,a=e._retryCache,a===null&&(a=e._retryCache=new eh),a;default:throw Error(s(435,e.tag))}}function oc(e,a){var l=x0(e);a.forEach(function(i){if(!l.has(i)){l.add(i);var _=T0.bind(null,e,i);i.then(_,_)}})}function zn(e,a){var l=a.deletions;if(l!==null)for(var i=0;i<l.length;i++){var _=l[i],S=e,$=a,Q=$;e:for(;Q!==null;){switch(Q.tag){case 27:if(Mo(Q.type)){Wt=Q.stateNode,Vn=!1;break e}break;case 5:Wt=Q.stateNode,Vn=!1;break e;case 3:case 4:Wt=Q.stateNode.containerInfo,Vn=!0;break e}Q=Q.return}if(Wt===null)throw Error(s(160));ah(S,$,_),Wt=null,Vn=!1,S=_.alternate,S!==null&&(S.return=null),_.return=null}if(a.subtreeFlags&13886)for(a=a.child;a!==null;)lh(a,e),a=a.sibling}var Fa=null;function lh(e,a){var l=e.alternate,i=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:zn(a,e),Bn(e),i&4&&(Io(3,e,e.return),Wl(3,e),Io(5,e,e.return));break;case 1:zn(a,e),Bn(e),i&512&&(ln||l===null||Ha(l,l.return)),i&64&&co&&(e=e.updateQueue,e!==null&&(i=e.callbacks,i!==null&&(l=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=l===null?i:l.concat(i))));break;case 26:var _=Fa;if(zn(a,e),Bn(e),i&512&&(ln||l===null||Ha(l,l.return)),i&4){var S=l!==null?l.memoizedState:null;if(i=e.memoizedState,l===null)if(i===null)if(e.stateNode===null){e:{i=e.type,l=e.memoizedProps,_=_.ownerDocument||_;t:switch(i){case"title":S=_.getElementsByTagName("title")[0],(!S||S[Zn]||S[Vt]||S.namespaceURI==="http://www.w3.org/2000/svg"||S.hasAttribute("itemprop"))&&(S=_.createElement(i),_.head.insertBefore(S,_.querySelector("head > title"))),vn(S,i,l),S[Vt]=e,Ot(S),i=S;break e;case"link":var $=lm("link","href",_).get(i+(l.href||""));if($){for(var Q=0;Q<$.length;Q++)if(S=$[Q],S.getAttribute("href")===(l.href==null||l.href===""?null:l.href)&&S.getAttribute("rel")===(l.rel==null?null:l.rel)&&S.getAttribute("title")===(l.title==null?null:l.title)&&S.getAttribute("crossorigin")===(l.crossOrigin==null?null:l.crossOrigin)){$.splice(Q,1);break t}}S=_.createElement(i),vn(S,i,l),_.head.appendChild(S);break;case"meta":if($=lm("meta","content",_).get(i+(l.content||""))){for(Q=0;Q<$.length;Q++)if(S=$[Q],S.getAttribute("content")===(l.content==null?null:""+l.content)&&S.getAttribute("name")===(l.name==null?null:l.name)&&S.getAttribute("property")===(l.property==null?null:l.property)&&S.getAttribute("http-equiv")===(l.httpEquiv==null?null:l.httpEquiv)&&S.getAttribute("charset")===(l.charSet==null?null:l.charSet)){$.splice(Q,1);break t}}S=_.createElement(i),vn(S,i,l),_.head.appendChild(S);break;default:throw Error(s(468,i))}S[Vt]=e,Ot(S),i=S}e.stateNode=i}else sm(_,e.type,e.stateNode);else e.stateNode=rm(_,i,e.memoizedProps);else S!==i?(S===null?l.stateNode!==null&&(l=l.stateNode,l.parentNode.removeChild(l)):S.count--,i===null?sm(_,e.type,e.stateNode):rm(_,i,e.memoizedProps)):i===null&&e.stateNode!==null&&id(e,e.memoizedProps,l.memoizedProps)}break;case 27:zn(a,e),Bn(e),i&512&&(ln||l===null||Ha(l,l.return)),l!==null&&i&4&&id(e,e.memoizedProps,l.memoizedProps);break;case 5:if(zn(a,e),Bn(e),i&512&&(ln||l===null||Ha(l,l.return)),e.flags&32){_=e.stateNode;try{fa(_,"")}catch(Ke){$t(e,e.return,Ke)}}i&4&&e.stateNode!=null&&(_=e.memoizedProps,id(e,_,l!==null?l.memoizedProps:_)),i&1024&&(pd=!0);break;case 6:if(zn(a,e),Bn(e),i&4){if(e.stateNode===null)throw Error(s(162));i=e.memoizedProps,l=e.stateNode;try{l.nodeValue=i}catch(Ke){$t(e,e.return,Ke)}}break;case 3:if(wc=null,_=Fa,Fa=vc(a.containerInfo),zn(a,e),Fa=_,Bn(e),i&4&&l!==null&&l.memoizedState.isDehydrated)try{nl(a.containerInfo)}catch(Ke){$t(e,e.return,Ke)}pd&&(pd=!1,sh(e));break;case 4:i=Fa,Fa=vc(e.stateNode.containerInfo),zn(a,e),Bn(e),Fa=i;break;case 12:zn(a,e),Bn(e);break;case 31:zn(a,e),Bn(e),i&4&&(i=e.updateQueue,i!==null&&(e.updateQueue=null,oc(e,i)));break;case 13:zn(a,e),Bn(e),e.child.flags&8192&&e.memoizedState!==null!=(l!==null&&l.memoizedState!==null)&&(lc=ke()),i&4&&(i=e.updateQueue,i!==null&&(e.updateQueue=null,oc(e,i)));break;case 22:_=e.memoizedState!==null;var ae=l!==null&&l.memoizedState!==null,me=co,Te=ln;if(co=me||_,ln=Te||ae,zn(a,e),ln=Te,co=me,Bn(e),i&8192)e:for(a=e.stateNode,a._visibility=_?a._visibility&-2:a._visibility|1,_&&(l===null||ae||co||ln||vr(e)),l=null,a=e;;){if(a.tag===5||a.tag===26){if(l===null){ae=l=a;try{if(S=ae.stateNode,_)$=S.style,typeof $.setProperty=="function"?$.setProperty("display","none","important"):$.display="none";else{Q=ae.stateNode;var $e=ae.memoizedProps.style,ve=$e!=null&&$e.hasOwnProperty("display")?$e.display:null;Q.style.display=ve==null||typeof ve=="boolean"?"":(""+ve).trim()}}catch(Ke){$t(ae,ae.return,Ke)}}}else if(a.tag===6){if(l===null){ae=a;try{ae.stateNode.nodeValue=_?"":ae.memoizedProps}catch(Ke){$t(ae,ae.return,Ke)}}}else if(a.tag===18){if(l===null){ae=a;try{var Ee=ae.stateNode;_?Xh(Ee,!0):Xh(ae.stateNode,!1)}catch(Ke){$t(ae,ae.return,Ke)}}}else if((a.tag!==22&&a.tag!==23||a.memoizedState===null||a===e)&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===e)break e;for(;a.sibling===null;){if(a.return===null||a.return===e)break e;l===a&&(l=null),a=a.return}l===a&&(l=null),a.sibling.return=a.return,a=a.sibling}i&4&&(i=e.updateQueue,i!==null&&(l=i.retryQueue,l!==null&&(i.retryQueue=null,oc(e,l))));break;case 19:zn(a,e),Bn(e),i&4&&(i=e.updateQueue,i!==null&&(e.updateQueue=null,oc(e,i)));break;case 30:break;case 21:break;default:zn(a,e),Bn(e)}}function Bn(e){var a=e.flags;if(a&2){try{for(var l,i=e.return;i!==null;){if(Kf(i)){l=i;break}i=i.return}if(l==null)throw Error(s(160));switch(l.tag){case 27:var _=l.stateNode,S=dd(e);ac(e,S,_);break;case 5:var $=l.stateNode;l.flags&32&&(fa($,""),l.flags&=-33);var Q=dd(e);ac(e,Q,$);break;case 3:case 4:var ae=l.stateNode.containerInfo,me=dd(e);ud(e,me,ae);break;default:throw Error(s(161))}}catch(Te){$t(e,e.return,Te)}e.flags&=-3}a&4096&&(e.flags&=-4097)}function sh(e){if(e.subtreeFlags&1024)for(e=e.child;e!==null;){var a=e;sh(a),a.tag===5&&a.flags&1024&&a.stateNode.reset(),e=e.sibling}}function uo(e,a){if(a.subtreeFlags&8772)for(a=a.child;a!==null;)th(e,a.alternate,a),a=a.sibling}function vr(e){for(e=e.child;e!==null;){var a=e;switch(a.tag){case 0:case 11:case 14:case 15:Io(4,a,a.return),vr(a);break;case 1:Ha(a,a.return);var l=a.stateNode;typeof l.componentWillUnmount=="function"&&Xf(a,a.return,l),vr(a);break;case 27:as(a.stateNode);case 26:case 5:Ha(a,a.return),vr(a);break;case 22:a.memoizedState===null&&vr(a);break;case 30:vr(a);break;default:vr(a)}e=e.sibling}}function po(e,a,l){for(l=l&&(a.subtreeFlags&8772)!==0,a=a.child;a!==null;){var i=a.alternate,_=e,S=a,$=S.flags;switch(S.tag){case 0:case 11:case 15:po(_,S,l),Wl(4,S);break;case 1:if(po(_,S,l),i=S,_=i.stateNode,typeof _.componentDidMount=="function")try{_.componentDidMount()}catch(me){$t(i,i.return,me)}if(i=S,_=i.updateQueue,_!==null){var Q=i.stateNode;try{var ae=_.shared.hiddenCallbacks;if(ae!==null)for(_.shared.hiddenCallbacks=null,_=0;_<ae.length;_++)qp(ae[_],Q)}catch(me){$t(i,i.return,me)}}l&&$&64&&Qf(S),Yl(S,S.return);break;case 27:Jf(S);case 26:case 5:po(_,S,l),l&&i===null&&$&4&&Zf(S),Yl(S,S.return);break;case 12:po(_,S,l);break;case 31:po(_,S,l),l&&$&4&&oh(_,S);break;case 13:po(_,S,l),l&&$&4&&rh(_,S);break;case 22:S.memoizedState===null&&po(_,S,l),Yl(S,S.return);break;case 30:break;default:po(_,S,l)}a=a.sibling}}function fd(e,a){var l=null;e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(l=e.memoizedState.cachePool.pool),e=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(e=a.memoizedState.cachePool.pool),e!==l&&(e!=null&&e.refCount++,l!=null&&Il(l))}function hd(e,a){e=null,a.alternate!==null&&(e=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==e&&(a.refCount++,e!=null&&Il(e))}function Ia(e,a,l,i){if(a.subtreeFlags&10256)for(a=a.child;a!==null;)ch(e,a,l,i),a=a.sibling}function ch(e,a,l,i){var _=a.flags;switch(a.tag){case 0:case 11:case 15:Ia(e,a,l,i),_&2048&&Wl(9,a);break;case 1:Ia(e,a,l,i);break;case 3:Ia(e,a,l,i),_&2048&&(e=null,a.alternate!==null&&(e=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==e&&(a.refCount++,e!=null&&Il(e)));break;case 12:if(_&2048){Ia(e,a,l,i),e=a.stateNode;try{var S=a.memoizedProps,$=S.id,Q=S.onPostCommit;typeof Q=="function"&&Q($,a.alternate===null?"mount":"update",e.passiveEffectDuration,-0)}catch(ae){$t(a,a.return,ae)}}else Ia(e,a,l,i);break;case 31:Ia(e,a,l,i);break;case 13:Ia(e,a,l,i);break;case 23:break;case 22:S=a.stateNode,$=a.alternate,a.memoizedState!==null?S._visibility&2?Ia(e,a,l,i):Ql(e,a):S._visibility&2?Ia(e,a,l,i):(S._visibility|=2,Br(e,a,l,i,(a.subtreeFlags&10256)!==0||!1)),_&2048&&fd($,a);break;case 24:Ia(e,a,l,i),_&2048&&hd(a.alternate,a);break;default:Ia(e,a,l,i)}}function Br(e,a,l,i,_){for(_=_&&((a.subtreeFlags&10256)!==0||!1),a=a.child;a!==null;){var S=e,$=a,Q=l,ae=i,me=$.flags;switch($.tag){case 0:case 11:case 15:Br(S,$,Q,ae,_),Wl(8,$);break;case 23:break;case 22:var Te=$.stateNode;$.memoizedState!==null?Te._visibility&2?Br(S,$,Q,ae,_):Ql(S,$):(Te._visibility|=2,Br(S,$,Q,ae,_)),_&&me&2048&&fd($.alternate,$);break;case 24:Br(S,$,Q,ae,_),_&&me&2048&&hd($.alternate,$);break;default:Br(S,$,Q,ae,_)}a=a.sibling}}function Ql(e,a){if(a.subtreeFlags&10256)for(a=a.child;a!==null;){var l=e,i=a,_=i.flags;switch(i.tag){case 22:Ql(l,i),_&2048&&fd(i.alternate,i);break;case 24:Ql(l,i),_&2048&&hd(i.alternate,i);break;default:Ql(l,i)}a=a.sibling}}var Xl=8192;function Gr(e,a,l){if(e.subtreeFlags&Xl)for(e=e.child;e!==null;)ih(e,a,l),e=e.sibling}function ih(e,a,l){switch(e.tag){case 26:Gr(e,a,l),e.flags&Xl&&e.memoizedState!==null&&sw(l,Fa,e.memoizedState,e.memoizedProps);break;case 5:Gr(e,a,l);break;case 3:case 4:var i=Fa;Fa=vc(e.stateNode.containerInfo),Gr(e,a,l),Fa=i;break;case 22:e.memoizedState===null&&(i=e.alternate,i!==null&&i.memoizedState!==null?(i=Xl,Xl=16777216,Gr(e,a,l),Xl=i):Gr(e,a,l));break;default:Gr(e,a,l)}}function dh(e){var a=e.alternate;if(a!==null&&(e=a.child,e!==null)){a.child=null;do a=e.sibling,e.sibling=null,e=a;while(e!==null)}}function Zl(e){var a=e.deletions;if((e.flags&16)!==0){if(a!==null)for(var l=0;l<a.length;l++){var i=a[l];pn=i,ph(i,e)}dh(e)}if(e.subtreeFlags&10256)for(e=e.child;e!==null;)uh(e),e=e.sibling}function uh(e){switch(e.tag){case 0:case 11:case 15:Zl(e),e.flags&2048&&Io(9,e,e.return);break;case 3:Zl(e);break;case 12:Zl(e);break;case 22:var a=e.stateNode;e.memoizedState!==null&&a._visibility&2&&(e.return===null||e.return.tag!==13)?(a._visibility&=-3,rc(e)):Zl(e);break;default:Zl(e)}}function rc(e){var a=e.deletions;if((e.flags&16)!==0){if(a!==null)for(var l=0;l<a.length;l++){var i=a[l];pn=i,ph(i,e)}dh(e)}for(e=e.child;e!==null;){switch(a=e,a.tag){case 0:case 11:case 15:Io(8,a,a.return),rc(a);break;case 22:l=a.stateNode,l._visibility&2&&(l._visibility&=-3,rc(a));break;default:rc(a)}e=e.sibling}}function ph(e,a){for(;pn!==null;){var l=pn;switch(l.tag){case 0:case 11:case 15:Io(8,l,a);break;case 23:case 22:if(l.memoizedState!==null&&l.memoizedState.cachePool!==null){var i=l.memoizedState.cachePool.pool;i!=null&&i.refCount++}break;case 24:Il(l.memoizedState.cache)}if(i=l.child,i!==null)i.return=l,pn=i;else e:for(l=e;pn!==null;){i=pn;var _=i.sibling,S=i.return;if(nh(i),i===l){pn=null;break e}if(_!==null){_.return=S,pn=_;break e}pn=S}}}var C0={getCacheForType:function(e){var a=yn(an),l=a.data.get(e);return l===void 0&&(l=e(),a.data.set(e,l)),l},cacheSignal:function(){return yn(an).controller.signal}},S0=typeof WeakMap=="function"?WeakMap:Map,At=0,Mt=null,xt=null,bt=0,It=0,aa=null,$o=!1,Wr=!1,md=!1,fo=0,Xt=0,Po=0,_r=0,yd=0,oa=0,Yr=0,Kl=null,Gn=null,gd=!1,lc=0,fh=0,sc=1/0,cc=null,qo=null,dn=0,Lo=null,Qr=null,ho=0,vd=0,_d=null,hh=null,Jl=0,wd=null;function ra(){return(At&2)!==0&&bt!==0?bt&-bt:A.T!==null?jd():ua()}function mh(){if(oa===0)if((bt&536870912)===0||jt){var e=fn;fn<<=1,(fn&3932160)===0&&(fn=262144),oa=e}else oa=536870912;return e=ta.current,e!==null&&(e.flags|=32),oa}function Wn(e,a,l){(e===Mt&&(It===2||It===9)||e.cancelPendingCommit!==null)&&(Xr(e,0),Uo(e,bt,oa,!1)),qn(e,l),((At&2)===0||e!==Mt)&&(e===Mt&&((At&2)===0&&(_r|=l),Xt===4&&Uo(e,bt,oa,!1)),Va(e))}function yh(e,a,l){if((At&6)!==0)throw Error(s(327));var i=!l&&(a&127)===0&&(a&e.expiredLanes)===0||jn(e,a),_=i?j0(e,a):Cd(e,a,!0),S=i;do{if(_===0){Wr&&!i&&Uo(e,a,0,!1);break}else{if(l=e.current.alternate,S&&!b0(l)){_=Cd(e,a,!1),S=!1;continue}if(_===2){if(S=a,e.errorRecoveryDisabledLanes&S)var $=0;else $=e.pendingLanes&-536870913,$=$!==0?$:$&536870912?536870912:0;if($!==0){a=$;e:{var Q=e;_=Kl;var ae=Q.current.memoizedState.isDehydrated;if(ae&&(Xr(Q,$).flags|=256),$=Cd(Q,$,!1),$!==2){if(md&&!ae){Q.errorRecoveryDisabledLanes|=S,_r|=S,_=4;break e}S=Gn,Gn=_,S!==null&&(Gn===null?Gn=S:Gn.push.apply(Gn,S))}_=$}if(S=!1,_!==2)continue}}if(_===1){Xr(e,0),Uo(e,a,0,!0);break}e:{switch(i=e,S=_,S){case 0:case 1:throw Error(s(345));case 4:if((a&4194048)!==a)break;case 6:Uo(i,a,oa,!$o);break e;case 2:Gn=null;break;case 3:case 5:break;default:throw Error(s(329))}if((a&62914560)===a&&(_=lc+300-ke(),10<_)){if(Uo(i,a,oa,!$o),un(i,0,!0)!==0)break e;ho=a,i.timeoutHandle=Wh(gh.bind(null,i,l,Gn,cc,gd,a,oa,_r,Yr,$o,S,"Throttled",-0,0),_);break e}gh(i,l,Gn,cc,gd,a,oa,_r,Yr,$o,S,null,-0,0)}}break}while(!0);Va(e)}function gh(e,a,l,i,_,S,$,Q,ae,me,Te,$e,ve,Ee){if(e.timeoutHandle=-1,$e=a.subtreeFlags,$e&8192||($e&16785408)===16785408){$e={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Mn},ih(a,S,$e);var Ke=(S&62914560)===S?lc-ke():(S&4194048)===S?fh-ke():0;if(Ke=cw($e,Ke),Ke!==null){ho=S,e.cancelPendingCommit=Ke(Eh.bind(null,e,a,S,l,i,_,$,Q,ae,Te,$e,null,ve,Ee)),Uo(e,S,$,!me);return}}Eh(e,a,S,l,i,_,$,Q,ae)}function b0(e){for(var a=e;;){var l=a.tag;if((l===0||l===11||l===15)&&a.flags&16384&&(l=a.updateQueue,l!==null&&(l=l.stores,l!==null)))for(var i=0;i<l.length;i++){var _=l[i],S=_.getSnapshot;_=_.value;try{if(!Jn(S(),_))return!1}catch{return!1}}if(l=a.child,a.subtreeFlags&16384&&l!==null)l.return=a,a=l;else{if(a===e)break;for(;a.sibling===null;){if(a.return===null||a.return===e)return!0;a=a.return}a.sibling.return=a.return,a=a.sibling}}return!0}function Uo(e,a,l,i){a&=~yd,a&=~_r,e.suspendedLanes|=a,e.pingedLanes&=~a,i&&(e.warmLanes|=a),i=e.expirationTimes;for(var _=a;0<_;){var S=31-rt(_),$=1<<S;i[S]=-1,_&=~$}l!==0&&$a(e,l,a)}function ic(){return(At&6)===0?(es(0),!1):!0}function xd(){if(xt!==null){if(It===0)var e=xt.return;else e=xt,no=dr=null,qi(e),Or=null,Pl=0,e=xt;for(;e!==null;)Yf(e.alternate,e),e=e.return;xt=null}}function Xr(e,a){var l=e.timeoutHandle;l!==-1&&(e.timeoutHandle=-1,z0(l)),l=e.cancelPendingCommit,l!==null&&(e.cancelPendingCommit=null,l()),ho=0,xd(),Mt=e,xt=l=eo(e.current,null),bt=a,It=0,aa=null,$o=!1,Wr=jn(e,a),md=!1,Yr=oa=yd=_r=Po=Xt=0,Gn=Kl=null,gd=!1,(a&8)!==0&&(a|=a&32);var i=e.entangledLanes;if(i!==0)for(e=e.entanglements,i&=a;0<i;){var _=31-rt(i),S=1<<_;a|=e[_],i&=~S}return fo=a,Ts(),l}function vh(e,a){yt=null,A.H=zl,a===Ur||a===Ls?(a=Fp(),It=3):a===Ei?(a=Fp(),It=4):It=a===Ji?8:a!==null&&typeof a=="object"&&typeof a.then=="function"?6:1,aa=a,xt===null&&(Xt=1,Ks(e,ma(a,e.current)))}function _h(){var e=ta.current;return e===null?!0:(bt&4194048)===bt?_a===null:(bt&62914560)===bt||(bt&536870912)!==0?e===_a:!1}function wh(){var e=A.H;return A.H=zl,e===null?zl:e}function xh(){var e=A.A;return A.A=C0,e}function dc(){Xt=4,$o||(bt&4194048)!==bt&&ta.current!==null||(Wr=!0),(Po&134217727)===0&&(_r&134217727)===0||Mt===null||Uo(Mt,bt,oa,!1)}function Cd(e,a,l){var i=At;At|=2;var _=wh(),S=xh();(Mt!==e||bt!==a)&&(cc=null,Xr(e,a)),a=!1;var $=Xt;e:do try{if(It!==0&&xt!==null){var Q=xt,ae=aa;switch(It){case 8:xd(),$=6;break e;case 3:case 2:case 9:case 6:ta.current===null&&(a=!0);var me=It;if(It=0,aa=null,Zr(e,Q,ae,me),l&&Wr){$=0;break e}break;default:me=It,It=0,aa=null,Zr(e,Q,ae,me)}}E0(),$=Xt;break}catch(Te){vh(e,Te)}while(!0);return a&&e.shellSuspendCounter++,no=dr=null,At=i,A.H=_,A.A=S,xt===null&&(Mt=null,bt=0,Ts()),$}function E0(){for(;xt!==null;)Ch(xt)}function j0(e,a){var l=At;At|=2;var i=wh(),_=xh();Mt!==e||bt!==a?(cc=null,sc=ke()+500,Xr(e,a)):Wr=jn(e,a);e:do try{if(It!==0&&xt!==null){a=xt;var S=aa;t:switch(It){case 1:It=0,aa=null,Zr(e,a,S,1);break;case 2:case 9:if(Dp(S)){It=0,aa=null,Sh(a);break}a=function(){It!==2&&It!==9||Mt!==e||(It=7),Va(e)},S.then(a,a);break e;case 3:It=7;break e;case 4:It=5;break e;case 7:Dp(S)?(It=0,aa=null,Sh(a)):(It=0,aa=null,Zr(e,a,S,7));break;case 5:var $=null;switch(xt.tag){case 26:$=xt.memoizedState;case 5:case 27:var Q=xt;if($?cm($):Q.stateNode.complete){It=0,aa=null;var ae=Q.sibling;if(ae!==null)xt=ae;else{var me=Q.return;me!==null?(xt=me,uc(me)):xt=null}break t}}It=0,aa=null,Zr(e,a,S,5);break;case 6:It=0,aa=null,Zr(e,a,S,6);break;case 8:xd(),Xt=6;break e;default:throw Error(s(462))}}k0();break}catch(Te){vh(e,Te)}while(!0);return no=dr=null,A.H=i,A.A=_,At=l,xt!==null?0:(Mt=null,bt=0,Ts(),Xt)}function k0(){for(;xt!==null&&!we();)Ch(xt)}function Ch(e){var a=Gf(e.alternate,e,fo);e.memoizedProps=e.pendingProps,a===null?uc(e):xt=a}function Sh(e){var a=e,l=a.alternate;switch(a.tag){case 15:case 0:a=Of(l,a,a.pendingProps,a.type,void 0,bt);break;case 11:a=Of(l,a,a.pendingProps,a.type.render,a.ref,bt);break;case 5:qi(a);default:Yf(l,a),a=xt=wp(a,fo),a=Gf(l,a,fo)}e.memoizedProps=e.pendingProps,a===null?uc(e):xt=a}function Zr(e,a,l,i){no=dr=null,qi(a),Or=null,Pl=0;var _=a.return;try{if(m0(e,_,a,l,bt)){Xt=1,Ks(e,ma(l,e.current)),xt=null;return}}catch(S){if(_!==null)throw xt=_,S;Xt=1,Ks(e,ma(l,e.current)),xt=null;return}a.flags&32768?(jt||i===1?e=!0:Wr||(bt&536870912)!==0?e=!1:($o=e=!0,(i===2||i===9||i===3||i===6)&&(i=ta.current,i!==null&&i.tag===13&&(i.flags|=16384))),bh(a,e)):uc(a)}function uc(e){var a=e;do{if((a.flags&32768)!==0){bh(a,$o);return}e=a.return;var l=v0(a.alternate,a,fo);if(l!==null){xt=l;return}if(a=a.sibling,a!==null){xt=a;return}xt=a=e}while(a!==null);Xt===0&&(Xt=5)}function bh(e,a){do{var l=_0(e.alternate,e);if(l!==null){l.flags&=32767,xt=l;return}if(l=e.return,l!==null&&(l.flags|=32768,l.subtreeFlags=0,l.deletions=null),!a&&(e=e.sibling,e!==null)){xt=e;return}xt=e=l}while(e!==null);Xt=6,xt=null}function Eh(e,a,l,i,_,S,$,Q,ae){e.cancelPendingCommit=null;do pc();while(dn!==0);if((At&6)!==0)throw Error(s(327));if(a!==null){if(a===e.current)throw Error(s(177));if(S=a.lanes|a.childLanes,S|=di,Ya(e,l,S,$,Q,ae),e===Mt&&(xt=Mt=null,bt=0),Qr=a,Lo=e,ho=l,vd=S,_d=_,hh=i,(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?(e.callbackNode=null,e.callbackPriority=0,D0(Me,function(){return Th(),null})):(e.callbackNode=null,e.callbackPriority=0),i=(a.flags&13878)!==0,(a.subtreeFlags&13878)!==0||i){i=A.T,A.T=null,_=N.p,N.p=2,$=At,At|=4;try{w0(e,a,l)}finally{At=$,N.p=_,A.T=i}}dn=1,jh(),kh(),Rh()}}function jh(){if(dn===1){dn=0;var e=Lo,a=Qr,l=(a.flags&13878)!==0;if((a.subtreeFlags&13878)!==0||l){l=A.T,A.T=null;var i=N.p;N.p=2;var _=At;At|=4;try{lh(a,e);var S=Id,$=up(e.containerInfo),Q=S.focusedElem,ae=S.selectionRange;if($!==Q&&Q&&Q.ownerDocument&&dp(Q.ownerDocument.documentElement,Q)){if(ae!==null&&ri(Q)){var me=ae.start,Te=ae.end;if(Te===void 0&&(Te=me),"selectionStart"in Q)Q.selectionStart=me,Q.selectionEnd=Math.min(Te,Q.value.length);else{var $e=Q.ownerDocument||document,ve=$e&&$e.defaultView||window;if(ve.getSelection){var Ee=ve.getSelection(),Ke=Q.textContent.length,lt=Math.min(ae.start,Ke),Lt=ae.end===void 0?lt:Math.min(ae.end,Ke);!Ee.extend&&lt>Lt&&($=Lt,Lt=lt,lt=$);var ie=ip(Q,lt),le=ip(Q,Lt);if(ie&&le&&(Ee.rangeCount!==1||Ee.anchorNode!==ie.node||Ee.anchorOffset!==ie.offset||Ee.focusNode!==le.node||Ee.focusOffset!==le.offset)){var fe=$e.createRange();fe.setStart(ie.node,ie.offset),Ee.removeAllRanges(),lt>Lt?(Ee.addRange(fe),Ee.extend(le.node,le.offset)):(fe.setEnd(le.node,le.offset),Ee.addRange(fe))}}}}for($e=[],Ee=Q;Ee=Ee.parentNode;)Ee.nodeType===1&&$e.push({element:Ee,left:Ee.scrollLeft,top:Ee.scrollTop});for(typeof Q.focus=="function"&&Q.focus(),Q=0;Q<$e.length;Q++){var Ae=$e[Q];Ae.element.scrollLeft=Ae.left,Ae.element.scrollTop=Ae.top}}bc=!!Fd,Id=Fd=null}finally{At=_,N.p=i,A.T=l}}e.current=a,dn=2}}function kh(){if(dn===2){dn=0;var e=Lo,a=Qr,l=(a.flags&8772)!==0;if((a.subtreeFlags&8772)!==0||l){l=A.T,A.T=null;var i=N.p;N.p=2;var _=At;At|=4;try{th(e,a.alternate,a)}finally{At=_,N.p=i,A.T=l}}dn=3}}function Rh(){if(dn===4||dn===3){dn=0,Se();var e=Lo,a=Qr,l=ho,i=hh;(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?dn=5:(dn=0,Qr=Lo=null,Nh(e,e.pendingLanes));var _=e.pendingLanes;if(_===0&&(qo=null),da(l),a=a.stateNode,et&&typeof et.onCommitFiberRoot=="function")try{et.onCommitFiberRoot(Ge,a,void 0,(a.current.flags&128)===128)}catch{}if(i!==null){a=A.T,_=N.p,N.p=2,A.T=null;try{for(var S=e.onRecoverableError,$=0;$<i.length;$++){var Q=i[$];S(Q.value,{componentStack:Q.stack})}}finally{A.T=a,N.p=_}}(ho&3)!==0&&pc(),Va(e),_=e.pendingLanes,(l&261930)!==0&&(_&42)!==0?e===wd?Jl++:(Jl=0,wd=e):Jl=0,es(0)}}function Nh(e,a){(e.pooledCacheLanes&=a)===0&&(a=e.pooledCache,a!=null&&(e.pooledCache=null,Il(a)))}function pc(){return jh(),kh(),Rh(),Th()}function Th(){if(dn!==5)return!1;var e=Lo,a=vd;vd=0;var l=da(ho),i=A.T,_=N.p;try{N.p=32>l?32:l,A.T=null,l=_d,_d=null;var S=Lo,$=ho;if(dn=0,Qr=Lo=null,ho=0,(At&6)!==0)throw Error(s(331));var Q=At;if(At|=4,uh(S.current),ch(S,S.current,$,l),At=Q,es(0,!1),et&&typeof et.onPostCommitFiberRoot=="function")try{et.onPostCommitFiberRoot(Ge,S)}catch{}return!0}finally{N.p=_,A.T=i,Nh(e,a)}}function Dh(e,a,l){a=ma(l,a),a=Ki(e.stateNode,a,2),e=Do(e,a,2),e!==null&&(qn(e,2),Va(e))}function $t(e,a,l){if(e.tag===3)Dh(e,e,l);else for(;a!==null;){if(a.tag===3){Dh(a,e,l);break}else if(a.tag===1){var i=a.stateNode;if(typeof a.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(qo===null||!qo.has(i))){e=ma(l,e),l=Af(2),i=Do(a,l,2),i!==null&&(Ff(l,i,a,e),qn(i,2),Va(i));break}}a=a.return}}function Sd(e,a,l){var i=e.pingCache;if(i===null){i=e.pingCache=new S0;var _=new Set;i.set(a,_)}else _=i.get(a),_===void 0&&(_=new Set,i.set(a,_));_.has(l)||(md=!0,_.add(l),e=R0.bind(null,e,a,l),a.then(e,e))}function R0(e,a,l){var i=e.pingCache;i!==null&&i.delete(a),e.pingedLanes|=e.suspendedLanes&l,e.warmLanes&=~l,Mt===e&&(bt&l)===l&&(Xt===4||Xt===3&&(bt&62914560)===bt&&300>ke()-lc?(At&2)===0&&Xr(e,0):yd|=l,Yr===bt&&(Yr=0)),Va(e)}function Ah(e,a){a===0&&(a=xn()),e=sr(e,a),e!==null&&(qn(e,a),Va(e))}function N0(e){var a=e.memoizedState,l=0;a!==null&&(l=a.retryLane),Ah(e,l)}function T0(e,a){var l=0;switch(e.tag){case 31:case 13:var i=e.stateNode,_=e.memoizedState;_!==null&&(l=_.retryLane);break;case 19:i=e.stateNode;break;case 22:i=e.stateNode._retryCache;break;default:throw Error(s(314))}i!==null&&i.delete(a),Ah(e,l)}function D0(e,a){return ce(e,a)}var fc=null,Kr=null,bd=!1,hc=!1,Ed=!1,Oo=0;function Va(e){e!==Kr&&e.next===null&&(Kr===null?fc=Kr=e:Kr=Kr.next=e),hc=!0,bd||(bd=!0,F0())}function es(e,a){if(!Ed&&hc){Ed=!0;do for(var l=!1,i=fc;i!==null;){if(e!==0){var _=i.pendingLanes;if(_===0)var S=0;else{var $=i.suspendedLanes,Q=i.pingedLanes;S=(1<<31-rt(42|e)+1)-1,S&=_&~($&~Q),S=S&201326741?S&201326741|1:S?S|2:0}S!==0&&(l=!0,Ph(i,S))}else S=bt,S=un(i,i===Mt?S:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),(S&3)===0||jn(i,S)||(l=!0,Ph(i,S));i=i.next}while(l);Ed=!1}}function A0(){Fh()}function Fh(){hc=bd=!1;var e=0;Oo!==0&&V0()&&(e=Oo);for(var a=ke(),l=null,i=fc;i!==null;){var _=i.next,S=Ih(i,a);S===0?(i.next=null,l===null?fc=_:l.next=_,_===null&&(Kr=l)):(l=i,(e!==0||(S&3)!==0)&&(hc=!0)),i=_}dn!==0&&dn!==5||es(e),Oo!==0&&(Oo=0)}function Ih(e,a){for(var l=e.suspendedLanes,i=e.pingedLanes,_=e.expirationTimes,S=e.pendingLanes&-62914561;0<S;){var $=31-rt(S),Q=1<<$,ae=_[$];ae===-1?((Q&l)===0||(Q&i)!==0)&&(_[$]=Xn(Q,a)):ae<=a&&(e.expiredLanes|=Q),S&=~Q}if(a=Mt,l=bt,l=un(e,e===a?l:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),i=e.callbackNode,l===0||e===a&&(It===2||It===9)||e.cancelPendingCommit!==null)return i!==null&&i!==null&&he(i),e.callbackNode=null,e.callbackPriority=0;if((l&3)===0||jn(e,l)){if(a=l&-l,a===e.callbackPriority)return a;switch(i!==null&&he(i),da(l)){case 2:case 8:l=be;break;case 32:l=Me;break;case 268435456:l=Be;break;default:l=Me}return i=$h.bind(null,e),l=ce(l,i),e.callbackPriority=a,e.callbackNode=l,a}return i!==null&&i!==null&&he(i),e.callbackPriority=2,e.callbackNode=null,2}function $h(e,a){if(dn!==0&&dn!==5)return e.callbackNode=null,e.callbackPriority=0,null;var l=e.callbackNode;if(pc()&&e.callbackNode!==l)return null;var i=bt;return i=un(e,e===Mt?i:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),i===0?null:(yh(e,i,a),Ih(e,ke()),e.callbackNode!=null&&e.callbackNode===l?$h.bind(null,e):null)}function Ph(e,a){if(pc())return null;yh(e,a,!0)}function F0(){B0(function(){(At&6)!==0?ce(Le,A0):Fh()})}function jd(){if(Oo===0){var e=qr;e===0&&(e=En,En<<=1,(En&261888)===0&&(En=256)),Oo=e}return Oo}function qh(e){return e==null||typeof e=="symbol"||typeof e=="boolean"?null:typeof e=="function"?e:Ka(""+e)}function Lh(e,a){var l=a.ownerDocument.createElement("input");return l.name=a.name,l.value=a.value,e.id&&l.setAttribute("form",e.id),a.parentNode.insertBefore(l,a),e=new FormData(e),l.parentNode.removeChild(l),e}function I0(e,a,l,i,_){if(a==="submit"&&l&&l.stateNode===_){var S=qh((_[Yt]||null).action),$=i.submitter;$&&(a=(a=$[Yt]||null)?qh(a.formAction):$.getAttribute("formAction"),a!==null&&(S=a,$=null));var Q=new js("action","action",null,i,_);e.push({event:Q,listeners:[{instance:null,listener:function(){if(i.defaultPrevented){if(Oo!==0){var ae=$?Lh(_,$):new FormData(_);Gi(l,{pending:!0,data:ae,method:_.method,action:S},null,ae)}}else typeof S=="function"&&(Q.preventDefault(),ae=$?Lh(_,$):new FormData(_),Gi(l,{pending:!0,data:ae,method:_.method,action:S},S,ae))},currentTarget:_}]})}}for(var kd=0;kd<ii.length;kd++){var Rd=ii[kd],$0=Rd.toLowerCase(),P0=Rd[0].toUpperCase()+Rd.slice(1);Aa($0,"on"+P0)}Aa(hp,"onAnimationEnd"),Aa(mp,"onAnimationIteration"),Aa(yp,"onAnimationStart"),Aa("dblclick","onDoubleClick"),Aa("focusin","onFocus"),Aa("focusout","onBlur"),Aa(K_,"onTransitionRun"),Aa(J_,"onTransitionStart"),Aa(e0,"onTransitionCancel"),Aa(gp,"onTransitionEnd"),Tn("onMouseEnter",["mouseout","mouseover"]),Tn("onMouseLeave",["mouseout","mouseover"]),Tn("onPointerEnter",["pointerout","pointerover"]),Tn("onPointerLeave",["pointerout","pointerover"]),Sn("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Sn("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Sn("onBeforeInput",["compositionend","keypress","textInput","paste"]),Sn("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Sn("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Sn("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ts="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),q0=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(ts));function Uh(e,a){a=(a&4)!==0;for(var l=0;l<e.length;l++){var i=e[l],_=i.event;i=i.listeners;e:{var S=void 0;if(a)for(var $=i.length-1;0<=$;$--){var Q=i[$],ae=Q.instance,me=Q.currentTarget;if(Q=Q.listener,ae!==S&&_.isPropagationStopped())break e;S=Q,_.currentTarget=me;try{S(_)}catch(Te){Ns(Te)}_.currentTarget=null,S=ae}else for($=0;$<i.length;$++){if(Q=i[$],ae=Q.instance,me=Q.currentTarget,Q=Q.listener,ae!==S&&_.isPropagationStopped())break e;S=Q,_.currentTarget=me;try{S(_)}catch(Te){Ns(Te)}_.currentTarget=null,S=ae}}}}function Ct(e,a){var l=a[pa];l===void 0&&(l=a[pa]=new Set);var i=e+"__bubble";l.has(i)||(Oh(a,e,2,!1),l.add(i))}function Nd(e,a,l){var i=0;a&&(i|=4),Oh(l,e,i,a)}var mc="_reactListening"+Math.random().toString(36).slice(2);function Td(e){if(!e[mc]){e[mc]=!0,ka.forEach(function(l){l!=="selectionchange"&&(q0.has(l)||Nd(l,!1,e),Nd(l,!0,e))});var a=e.nodeType===9?e:e.ownerDocument;a===null||a[mc]||(a[mc]=!0,Nd("selectionchange",!1,a))}}function Oh(e,a,l,i){switch(mm(a)){case 2:var _=uw;break;case 8:_=pw;break;default:_=Bd}l=_.bind(null,a,l,e),_=void 0,!Cs||a!=="touchstart"&&a!=="touchmove"&&a!=="wheel"||(_=!0),i?_!==void 0?e.addEventListener(a,l,{capture:!0,passive:_}):e.addEventListener(a,l,!0):_!==void 0?e.addEventListener(a,l,{passive:_}):e.addEventListener(a,l,!1)}function Dd(e,a,l,i,_){var S=i;if((a&1)===0&&(a&2)===0&&i!==null)e:for(;;){if(i===null)return;var $=i.tag;if($===3||$===4){var Q=i.stateNode.containerInfo;if(Q===_)break;if($===4)for($=i.return;$!==null;){var ae=$.tag;if((ae===3||ae===4)&&$.stateNode.containerInfo===_)return;$=$.return}for(;Q!==null;){if($=Un(Q),$===null)return;if(ae=$.tag,ae===5||ae===6||ae===26||ae===27){i=S=$;continue e}Q=Q.parentNode}}i=i.return}Gt(function(){var me=S,Te=Co(l),$e=[];e:{var ve=vp.get(e);if(ve!==void 0){var Ee=js,Ke=e;switch(e){case"keypress":if(bs(l)===0)break e;case"keydown":case"keyup":Ee=T_;break;case"focusin":Ke="focus",Ee=ei;break;case"focusout":Ke="blur",Ee=ei;break;case"beforeblur":case"afterblur":Ee=ei;break;case"click":if(l.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Ee=Wu;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Ee=v_;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Ee=F_;break;case hp:case mp:case yp:Ee=x_;break;case gp:Ee=$_;break;case"scroll":case"scrollend":Ee=y_;break;case"wheel":Ee=q_;break;case"copy":case"cut":case"paste":Ee=S_;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Ee=Qu;break;case"toggle":case"beforetoggle":Ee=U_}var lt=(a&4)!==0,Lt=!lt&&(e==="scroll"||e==="scrollend"),ie=lt?ve!==null?ve+"Capture":null:ve;lt=[];for(var le=me,fe;le!==null;){var Ae=le;if(fe=Ae.stateNode,Ae=Ae.tag,Ae!==5&&Ae!==26&&Ae!==27||fe===null||ie===null||(Ae=cn(le,ie),Ae!=null&&lt.push(ns(le,Ae,fe))),Lt)break;le=le.return}0<lt.length&&(ve=new Ee(ve,Ke,null,l,Te),$e.push({event:ve,listeners:lt}))}}if((a&7)===0){e:{if(ve=e==="mouseover"||e==="pointerover",Ee=e==="mouseout"||e==="pointerout",ve&&l!==xo&&(Ke=l.relatedTarget||l.fromElement)&&(Un(Ke)||Ke[Ln]))break e;if((Ee||ve)&&(ve=Te.window===Te?Te:(ve=Te.ownerDocument)?ve.defaultView||ve.parentWindow:window,Ee?(Ke=l.relatedTarget||l.toElement,Ee=me,Ke=Ke?Un(Ke):null,Ke!==null&&(Lt=d(Ke),lt=Ke.tag,Ke!==Lt||lt!==5&&lt!==27&&lt!==6)&&(Ke=null)):(Ee=null,Ke=me),Ee!==Ke)){if(lt=Wu,Ae="onMouseLeave",ie="onMouseEnter",le="mouse",(e==="pointerout"||e==="pointerover")&&(lt=Qu,Ae="onPointerLeave",ie="onPointerEnter",le="pointer"),Lt=Ee==null?ve:On(Ee),fe=Ke==null?ve:On(Ke),ve=new lt(Ae,le+"leave",Ee,l,Te),ve.target=Lt,ve.relatedTarget=fe,Ae=null,Un(Te)===me&&(lt=new lt(ie,le+"enter",Ke,l,Te),lt.target=fe,lt.relatedTarget=Lt,Ae=lt),Lt=Ae,Ee&&Ke)t:{for(lt=L0,ie=Ee,le=Ke,fe=0,Ae=ie;Ae;Ae=lt(Ae))fe++;Ae=0;for(var at=le;at;at=lt(at))Ae++;for(;0<fe-Ae;)ie=lt(ie),fe--;for(;0<Ae-fe;)le=lt(le),Ae--;for(;fe--;){if(ie===le||le!==null&&ie===le.alternate){lt=ie;break t}ie=lt(ie),le=lt(le)}lt=null}else lt=null;Ee!==null&&Mh($e,ve,Ee,lt,!1),Ke!==null&&Lt!==null&&Mh($e,Lt,Ke,lt,!0)}}e:{if(ve=me?On(me):window,Ee=ve.nodeName&&ve.nodeName.toLowerCase(),Ee==="select"||Ee==="input"&&ve.type==="file")var Nt=ap;else if(tp(ve))if(op)Nt=Q_;else{Nt=W_;var nt=G_}else Ee=ve.nodeName,!Ee||Ee.toLowerCase()!=="input"||ve.type!=="checkbox"&&ve.type!=="radio"?me&&Za(me.elementType)&&(Nt=ap):Nt=Y_;if(Nt&&(Nt=Nt(e,me))){np($e,Nt,l,Te);break e}nt&&nt(e,ve,me),e==="focusout"&&me&&ve.type==="number"&&me.memoizedProps.value!=null&&Na(ve,"number",ve.value)}switch(nt=me?On(me):window,e){case"focusin":(tp(nt)||nt.contentEditable==="true")&&(Nr=nt,li=me,Dl=null);break;case"focusout":Dl=li=Nr=null;break;case"mousedown":si=!0;break;case"contextmenu":case"mouseup":case"dragend":si=!1,pp($e,l,Te);break;case"selectionchange":if(Z_)break;case"keydown":case"keyup":pp($e,l,Te)}var vt;if(ni)e:{switch(e){case"compositionstart":var Et="onCompositionStart";break e;case"compositionend":Et="onCompositionEnd";break e;case"compositionupdate":Et="onCompositionUpdate";break e}Et=void 0}else Rr?Ju(e,l)&&(Et="onCompositionEnd"):e==="keydown"&&l.keyCode===229&&(Et="onCompositionStart");Et&&(Xu&&l.locale!=="ko"&&(Rr||Et!=="onCompositionStart"?Et==="onCompositionEnd"&&Rr&&(vt=Bu()):(bo=Te,Zc="value"in bo?bo.value:bo.textContent,Rr=!0)),nt=yc(me,Et),0<nt.length&&(Et=new Yu(Et,e,null,l,Te),$e.push({event:Et,listeners:nt}),vt?Et.data=vt:(vt=ep(l),vt!==null&&(Et.data=vt)))),(vt=M_?H_(e,l):V_(e,l))&&(Et=yc(me,"onBeforeInput"),0<Et.length&&(nt=new Yu("onBeforeInput","beforeinput",null,l,Te),$e.push({event:nt,listeners:Et}),nt.data=vt)),I0($e,e,me,l,Te)}Uh($e,a)})}function ns(e,a,l){return{instance:e,listener:a,currentTarget:l}}function yc(e,a){for(var l=a+"Capture",i=[];e!==null;){var _=e,S=_.stateNode;if(_=_.tag,_!==5&&_!==26&&_!==27||S===null||(_=cn(e,l),_!=null&&i.unshift(ns(e,_,S)),_=cn(e,a),_!=null&&i.push(ns(e,_,S))),e.tag===3)return i;e=e.return}return[]}function L0(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5&&e.tag!==27);return e||null}function Mh(e,a,l,i,_){for(var S=a._reactName,$=[];l!==null&&l!==i;){var Q=l,ae=Q.alternate,me=Q.stateNode;if(Q=Q.tag,ae!==null&&ae===i)break;Q!==5&&Q!==26&&Q!==27||me===null||(ae=me,_?(me=cn(l,S),me!=null&&$.unshift(ns(l,me,ae))):_||(me=cn(l,S),me!=null&&$.push(ns(l,me,ae)))),l=l.return}$.length!==0&&e.push({event:a,listeners:$})}var U0=/\r\n?/g,O0=/\u0000|\uFFFD/g;function Hh(e){return(typeof e=="string"?e:""+e).replace(U0,`
`).replace(O0,"")}function Vh(e,a){return a=Hh(a),Hh(e)===a}function qt(e,a,l,i,_,S){switch(l){case"children":typeof i=="string"?a==="body"||a==="textarea"&&i===""||fa(e,i):(typeof i=="number"||typeof i=="bigint")&&a!=="body"&&fa(e,""+i);break;case"className":Je(e,"class",i);break;case"tabIndex":Je(e,"tabindex",i);break;case"dir":case"role":case"viewBox":case"width":case"height":Je(e,l,i);break;case"style":wo(e,i,S);break;case"data":if(a!=="object"){Je(e,"data",i);break}case"src":case"href":if(i===""&&(a!=="a"||l!=="href")){e.removeAttribute(l);break}if(i==null||typeof i=="function"||typeof i=="symbol"||typeof i=="boolean"){e.removeAttribute(l);break}i=Ka(""+i),e.setAttribute(l,i);break;case"action":case"formAction":if(typeof i=="function"){e.setAttribute(l,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof S=="function"&&(l==="formAction"?(a!=="input"&&qt(e,a,"name",_.name,_,null),qt(e,a,"formEncType",_.formEncType,_,null),qt(e,a,"formMethod",_.formMethod,_,null),qt(e,a,"formTarget",_.formTarget,_,null)):(qt(e,a,"encType",_.encType,_,null),qt(e,a,"method",_.method,_,null),qt(e,a,"target",_.target,_,null)));if(i==null||typeof i=="symbol"||typeof i=="boolean"){e.removeAttribute(l);break}i=Ka(""+i),e.setAttribute(l,i);break;case"onClick":i!=null&&(e.onclick=Mn);break;case"onScroll":i!=null&&Ct("scroll",e);break;case"onScrollEnd":i!=null&&Ct("scrollend",e);break;case"dangerouslySetInnerHTML":if(i!=null){if(typeof i!="object"||!("__html"in i))throw Error(s(61));if(l=i.__html,l!=null){if(_.children!=null)throw Error(s(60));e.innerHTML=l}}break;case"multiple":e.multiple=i&&typeof i!="function"&&typeof i!="symbol";break;case"muted":e.muted=i&&typeof i!="function"&&typeof i!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(i==null||typeof i=="function"||typeof i=="boolean"||typeof i=="symbol"){e.removeAttribute("xlink:href");break}l=Ka(""+i),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",l);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":i!=null&&typeof i!="function"&&typeof i!="symbol"?e.setAttribute(l,""+i):e.removeAttribute(l);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":i&&typeof i!="function"&&typeof i!="symbol"?e.setAttribute(l,""):e.removeAttribute(l);break;case"capture":case"download":i===!0?e.setAttribute(l,""):i!==!1&&i!=null&&typeof i!="function"&&typeof i!="symbol"?e.setAttribute(l,i):e.removeAttribute(l);break;case"cols":case"rows":case"size":case"span":i!=null&&typeof i!="function"&&typeof i!="symbol"&&!isNaN(i)&&1<=i?e.setAttribute(l,i):e.removeAttribute(l);break;case"rowSpan":case"start":i==null||typeof i=="function"||typeof i=="symbol"||isNaN(i)?e.removeAttribute(l):e.setAttribute(l,i);break;case"popover":Ct("beforetoggle",e),Ct("toggle",e),Ze(e,"popover",i);break;case"xlinkActuate":ct(e,"http://www.w3.org/1999/xlink","xlink:actuate",i);break;case"xlinkArcrole":ct(e,"http://www.w3.org/1999/xlink","xlink:arcrole",i);break;case"xlinkRole":ct(e,"http://www.w3.org/1999/xlink","xlink:role",i);break;case"xlinkShow":ct(e,"http://www.w3.org/1999/xlink","xlink:show",i);break;case"xlinkTitle":ct(e,"http://www.w3.org/1999/xlink","xlink:title",i);break;case"xlinkType":ct(e,"http://www.w3.org/1999/xlink","xlink:type",i);break;case"xmlBase":ct(e,"http://www.w3.org/XML/1998/namespace","xml:base",i);break;case"xmlLang":ct(e,"http://www.w3.org/XML/1998/namespace","xml:lang",i);break;case"xmlSpace":ct(e,"http://www.w3.org/XML/1998/namespace","xml:space",i);break;case"is":Ze(e,"is",i);break;case"innerText":case"textContent":break;default:(!(2<l.length)||l[0]!=="o"&&l[0]!=="O"||l[1]!=="n"&&l[1]!=="N")&&(l=ar.get(l)||l,Ze(e,l,i))}}function Ad(e,a,l,i,_,S){switch(l){case"style":wo(e,i,S);break;case"dangerouslySetInnerHTML":if(i!=null){if(typeof i!="object"||!("__html"in i))throw Error(s(61));if(l=i.__html,l!=null){if(_.children!=null)throw Error(s(60));e.innerHTML=l}}break;case"children":typeof i=="string"?fa(e,i):(typeof i=="number"||typeof i=="bigint")&&fa(e,""+i);break;case"onScroll":i!=null&&Ct("scroll",e);break;case"onScrollEnd":i!=null&&Ct("scrollend",e);break;case"onClick":i!=null&&(e.onclick=Mn);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Ra.hasOwnProperty(l))e:{if(l[0]==="o"&&l[1]==="n"&&(_=l.endsWith("Capture"),a=l.slice(2,_?l.length-7:void 0),S=e[Yt]||null,S=S!=null?S[l]:null,typeof S=="function"&&e.removeEventListener(a,S,_),typeof i=="function")){typeof S!="function"&&S!==null&&(l in e?e[l]=null:e.hasAttribute(l)&&e.removeAttribute(l)),e.addEventListener(a,i,_);break e}l in e?e[l]=i:i===!0?e.setAttribute(l,""):Ze(e,l,i)}}}function vn(e,a,l){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Ct("error",e),Ct("load",e);var i=!1,_=!1,S;for(S in l)if(l.hasOwnProperty(S)){var $=l[S];if($!=null)switch(S){case"src":i=!0;break;case"srcSet":_=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(s(137,a));default:qt(e,a,S,$,l,null)}}_&&qt(e,a,"srcSet",l.srcSet,l,null),i&&qt(e,a,"src",l.src,l,null);return;case"input":Ct("invalid",e);var Q=S=$=_=null,ae=null,me=null;for(i in l)if(l.hasOwnProperty(i)){var Te=l[i];if(Te!=null)switch(i){case"name":_=Te;break;case"type":$=Te;break;case"checked":ae=Te;break;case"defaultChecked":me=Te;break;case"value":S=Te;break;case"defaultValue":Q=Te;break;case"children":case"dangerouslySetInnerHTML":if(Te!=null)throw Error(s(137,a));break;default:qt(e,a,i,Te,l,null)}}Kn(e,S,Q,ae,me,$,_,!1);return;case"select":Ct("invalid",e),i=$=S=null;for(_ in l)if(l.hasOwnProperty(_)&&(Q=l[_],Q!=null))switch(_){case"value":S=Q;break;case"defaultValue":$=Q;break;case"multiple":i=Q;default:qt(e,a,_,Q,l,null)}a=S,l=$,e.multiple=!!i,a!=null?hn(e,!!i,a,!1):l!=null&&hn(e,!!i,l,!0);return;case"textarea":Ct("invalid",e),S=_=i=null;for($ in l)if(l.hasOwnProperty($)&&(Q=l[$],Q!=null))switch($){case"value":i=Q;break;case"defaultValue":_=Q;break;case"children":S=Q;break;case"dangerouslySetInnerHTML":if(Q!=null)throw Error(s(91));break;default:qt(e,a,$,Q,l,null)}kr(e,i,_,S);return;case"option":for(ae in l)if(l.hasOwnProperty(ae)&&(i=l[ae],i!=null))switch(ae){case"selected":e.selected=i&&typeof i!="function"&&typeof i!="symbol";break;default:qt(e,a,ae,i,l,null)}return;case"dialog":Ct("beforetoggle",e),Ct("toggle",e),Ct("cancel",e),Ct("close",e);break;case"iframe":case"object":Ct("load",e);break;case"video":case"audio":for(i=0;i<ts.length;i++)Ct(ts[i],e);break;case"image":Ct("error",e),Ct("load",e);break;case"details":Ct("toggle",e);break;case"embed":case"source":case"link":Ct("error",e),Ct("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(me in l)if(l.hasOwnProperty(me)&&(i=l[me],i!=null))switch(me){case"children":case"dangerouslySetInnerHTML":throw Error(s(137,a));default:qt(e,a,me,i,l,null)}return;default:if(Za(a)){for(Te in l)l.hasOwnProperty(Te)&&(i=l[Te],i!==void 0&&Ad(e,a,Te,i,l,void 0));return}}for(Q in l)l.hasOwnProperty(Q)&&(i=l[Q],i!=null&&qt(e,a,Q,i,l,null))}function M0(e,a,l,i){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var _=null,S=null,$=null,Q=null,ae=null,me=null,Te=null;for(Ee in l){var $e=l[Ee];if(l.hasOwnProperty(Ee)&&$e!=null)switch(Ee){case"checked":break;case"value":break;case"defaultValue":ae=$e;default:i.hasOwnProperty(Ee)||qt(e,a,Ee,null,i,$e)}}for(var ve in i){var Ee=i[ve];if($e=l[ve],i.hasOwnProperty(ve)&&(Ee!=null||$e!=null))switch(ve){case"type":S=Ee;break;case"name":_=Ee;break;case"checked":me=Ee;break;case"defaultChecked":Te=Ee;break;case"value":$=Ee;break;case"defaultValue":Q=Ee;break;case"children":case"dangerouslySetInnerHTML":if(Ee!=null)throw Error(s(137,a));break;default:Ee!==$e&&qt(e,a,ve,Ee,i,$e)}}Dn(e,$,Q,ae,me,Te,S,_);return;case"select":Ee=$=Q=ve=null;for(S in l)if(ae=l[S],l.hasOwnProperty(S)&&ae!=null)switch(S){case"value":break;case"multiple":Ee=ae;default:i.hasOwnProperty(S)||qt(e,a,S,null,i,ae)}for(_ in i)if(S=i[_],ae=l[_],i.hasOwnProperty(_)&&(S!=null||ae!=null))switch(_){case"value":ve=S;break;case"defaultValue":Q=S;break;case"multiple":$=S;default:S!==ae&&qt(e,a,_,S,i,ae)}a=Q,l=$,i=Ee,ve!=null?hn(e,!!l,ve,!1):!!i!=!!l&&(a!=null?hn(e,!!l,a,!0):hn(e,!!l,l?[]:"",!1));return;case"textarea":Ee=ve=null;for(Q in l)if(_=l[Q],l.hasOwnProperty(Q)&&_!=null&&!i.hasOwnProperty(Q))switch(Q){case"value":break;case"children":break;default:qt(e,a,Q,null,i,_)}for($ in i)if(_=i[$],S=l[$],i.hasOwnProperty($)&&(_!=null||S!=null))switch($){case"value":ve=_;break;case"defaultValue":Ee=_;break;case"children":break;case"dangerouslySetInnerHTML":if(_!=null)throw Error(s(91));break;default:_!==S&&qt(e,a,$,_,i,S)}tr(e,ve,Ee);return;case"option":for(var Ke in l)if(ve=l[Ke],l.hasOwnProperty(Ke)&&ve!=null&&!i.hasOwnProperty(Ke))switch(Ke){case"selected":e.selected=!1;break;default:qt(e,a,Ke,null,i,ve)}for(ae in i)if(ve=i[ae],Ee=l[ae],i.hasOwnProperty(ae)&&ve!==Ee&&(ve!=null||Ee!=null))switch(ae){case"selected":e.selected=ve&&typeof ve!="function"&&typeof ve!="symbol";break;default:qt(e,a,ae,ve,i,Ee)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var lt in l)ve=l[lt],l.hasOwnProperty(lt)&&ve!=null&&!i.hasOwnProperty(lt)&&qt(e,a,lt,null,i,ve);for(me in i)if(ve=i[me],Ee=l[me],i.hasOwnProperty(me)&&ve!==Ee&&(ve!=null||Ee!=null))switch(me){case"children":case"dangerouslySetInnerHTML":if(ve!=null)throw Error(s(137,a));break;default:qt(e,a,me,ve,i,Ee)}return;default:if(Za(a)){for(var Lt in l)ve=l[Lt],l.hasOwnProperty(Lt)&&ve!==void 0&&!i.hasOwnProperty(Lt)&&Ad(e,a,Lt,void 0,i,ve);for(Te in i)ve=i[Te],Ee=l[Te],!i.hasOwnProperty(Te)||ve===Ee||ve===void 0&&Ee===void 0||Ad(e,a,Te,ve,i,Ee);return}}for(var ie in l)ve=l[ie],l.hasOwnProperty(ie)&&ve!=null&&!i.hasOwnProperty(ie)&&qt(e,a,ie,null,i,ve);for($e in i)ve=i[$e],Ee=l[$e],!i.hasOwnProperty($e)||ve===Ee||ve==null&&Ee==null||qt(e,a,$e,ve,i,Ee)}function zh(e){switch(e){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function H0(){if(typeof performance.getEntriesByType=="function"){for(var e=0,a=0,l=performance.getEntriesByType("resource"),i=0;i<l.length;i++){var _=l[i],S=_.transferSize,$=_.initiatorType,Q=_.duration;if(S&&Q&&zh($)){for($=0,Q=_.responseEnd,i+=1;i<l.length;i++){var ae=l[i],me=ae.startTime;if(me>Q)break;var Te=ae.transferSize,$e=ae.initiatorType;Te&&zh($e)&&(ae=ae.responseEnd,$+=Te*(ae<Q?1:(Q-me)/(ae-me)))}if(--i,a+=8*(S+$)/(_.duration/1e3),e++,10<e)break}}if(0<e)return a/e/1e6}return navigator.connection&&(e=navigator.connection.downlink,typeof e=="number")?e:5}var Fd=null,Id=null;function gc(e){return e.nodeType===9?e:e.ownerDocument}function Bh(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Gh(e,a){if(e===0)switch(a){case"svg":return 1;case"math":return 2;default:return 0}return e===1&&a==="foreignObject"?0:e}function $d(e,a){return e==="textarea"||e==="noscript"||typeof a.children=="string"||typeof a.children=="number"||typeof a.children=="bigint"||typeof a.dangerouslySetInnerHTML=="object"&&a.dangerouslySetInnerHTML!==null&&a.dangerouslySetInnerHTML.__html!=null}var Pd=null;function V0(){var e=window.event;return e&&e.type==="popstate"?e===Pd?!1:(Pd=e,!0):(Pd=null,!1)}var Wh=typeof setTimeout=="function"?setTimeout:void 0,z0=typeof clearTimeout=="function"?clearTimeout:void 0,Yh=typeof Promise=="function"?Promise:void 0,B0=typeof queueMicrotask=="function"?queueMicrotask:typeof Yh<"u"?function(e){return Yh.resolve(null).then(e).catch(G0)}:Wh;function G0(e){setTimeout(function(){throw e})}function Mo(e){return e==="head"}function Qh(e,a){var l=a,i=0;do{var _=l.nextSibling;if(e.removeChild(l),_&&_.nodeType===8)if(l=_.data,l==="/$"||l==="/&"){if(i===0){e.removeChild(_),nl(a);return}i--}else if(l==="$"||l==="$?"||l==="$~"||l==="$!"||l==="&")i++;else if(l==="html")as(e.ownerDocument.documentElement);else if(l==="head"){l=e.ownerDocument.head,as(l);for(var S=l.firstChild;S;){var $=S.nextSibling,Q=S.nodeName;S[Zn]||Q==="SCRIPT"||Q==="STYLE"||Q==="LINK"&&S.rel.toLowerCase()==="stylesheet"||l.removeChild(S),S=$}}else l==="body"&&as(e.ownerDocument.body);l=_}while(l);nl(a)}function Xh(e,a){var l=e;e=0;do{var i=l.nextSibling;if(l.nodeType===1?a?(l._stashedDisplay=l.style.display,l.style.display="none"):(l.style.display=l._stashedDisplay||"",l.getAttribute("style")===""&&l.removeAttribute("style")):l.nodeType===3&&(a?(l._stashedText=l.nodeValue,l.nodeValue=""):l.nodeValue=l._stashedText||""),i&&i.nodeType===8)if(l=i.data,l==="/$"){if(e===0)break;e--}else l!=="$"&&l!=="$?"&&l!=="$~"&&l!=="$!"||e++;l=i}while(l)}function qd(e){var a=e.firstChild;for(a&&a.nodeType===10&&(a=a.nextSibling);a;){var l=a;switch(a=a.nextSibling,l.nodeName){case"HTML":case"HEAD":case"BODY":qd(l),ja(l);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(l.rel.toLowerCase()==="stylesheet")continue}e.removeChild(l)}}function W0(e,a,l,i){for(;e.nodeType===1;){var _=l;if(e.nodeName.toLowerCase()!==a.toLowerCase()){if(!i&&(e.nodeName!=="INPUT"||e.type!=="hidden"))break}else if(i){if(!e[Zn])switch(a){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if(S=e.getAttribute("rel"),S==="stylesheet"&&e.hasAttribute("data-precedence"))break;if(S!==_.rel||e.getAttribute("href")!==(_.href==null||_.href===""?null:_.href)||e.getAttribute("crossorigin")!==(_.crossOrigin==null?null:_.crossOrigin)||e.getAttribute("title")!==(_.title==null?null:_.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(S=e.getAttribute("src"),(S!==(_.src==null?null:_.src)||e.getAttribute("type")!==(_.type==null?null:_.type)||e.getAttribute("crossorigin")!==(_.crossOrigin==null?null:_.crossOrigin))&&S&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else if(a==="input"&&e.type==="hidden"){var S=_.name==null?null:""+_.name;if(_.type==="hidden"&&e.getAttribute("name")===S)return e}else return e;if(e=wa(e.nextSibling),e===null)break}return null}function Y0(e,a,l){if(a==="")return null;for(;e.nodeType!==3;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!l||(e=wa(e.nextSibling),e===null))return null;return e}function Zh(e,a){for(;e.nodeType!==8;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!a||(e=wa(e.nextSibling),e===null))return null;return e}function Ld(e){return e.data==="$?"||e.data==="$~"}function Ud(e){return e.data==="$!"||e.data==="$?"&&e.ownerDocument.readyState!=="loading"}function Q0(e,a){var l=e.ownerDocument;if(e.data==="$~")e._reactRetry=a;else if(e.data!=="$?"||l.readyState!=="loading")a();else{var i=function(){a(),l.removeEventListener("DOMContentLoaded",i)};l.addEventListener("DOMContentLoaded",i),e._reactRetry=i}}function wa(e){for(;e!=null;e=e.nextSibling){var a=e.nodeType;if(a===1||a===3)break;if(a===8){if(a=e.data,a==="$"||a==="$!"||a==="$?"||a==="$~"||a==="&"||a==="F!"||a==="F")break;if(a==="/$"||a==="/&")return null}}return e}var Od=null;function Kh(e){e=e.nextSibling;for(var a=0;e;){if(e.nodeType===8){var l=e.data;if(l==="/$"||l==="/&"){if(a===0)return wa(e.nextSibling);a--}else l!=="$"&&l!=="$!"&&l!=="$?"&&l!=="$~"&&l!=="&"||a++}e=e.nextSibling}return null}function Jh(e){e=e.previousSibling;for(var a=0;e;){if(e.nodeType===8){var l=e.data;if(l==="$"||l==="$!"||l==="$?"||l==="$~"||l==="&"){if(a===0)return e;a--}else l!=="/$"&&l!=="/&"||a++}e=e.previousSibling}return null}function em(e,a,l){switch(a=gc(l),e){case"html":if(e=a.documentElement,!e)throw Error(s(452));return e;case"head":if(e=a.head,!e)throw Error(s(453));return e;case"body":if(e=a.body,!e)throw Error(s(454));return e;default:throw Error(s(451))}}function as(e){for(var a=e.attributes;a.length;)e.removeAttributeNode(a[0]);ja(e)}var xa=new Map,tm=new Set;function vc(e){return typeof e.getRootNode=="function"?e.getRootNode():e.nodeType===9?e:e.ownerDocument}var mo=N.d;N.d={f:X0,r:Z0,D:K0,C:J0,L:ew,m:tw,X:aw,S:nw,M:ow};function X0(){var e=mo.f(),a=ic();return e||a}function Z0(e){var a=Rn(e);a!==null&&a.tag===5&&a.type==="form"?vf(a):mo.r(e)}var Jr=typeof document>"u"?null:document;function nm(e,a,l){var i=Jr;if(i&&typeof a=="string"&&a){var _=Dt(a);_='link[rel="'+e+'"][href="'+_+'"]',typeof l=="string"&&(_+='[crossorigin="'+l+'"]'),tm.has(_)||(tm.add(_),e={rel:e,crossOrigin:l,href:a},i.querySelector(_)===null&&(a=i.createElement("link"),vn(a,"link",e),Ot(a),i.head.appendChild(a)))}}function K0(e){mo.D(e),nm("dns-prefetch",e,null)}function J0(e,a){mo.C(e,a),nm("preconnect",e,a)}function ew(e,a,l){mo.L(e,a,l);var i=Jr;if(i&&e&&a){var _='link[rel="preload"][as="'+Dt(a)+'"]';a==="image"&&l&&l.imageSrcSet?(_+='[imagesrcset="'+Dt(l.imageSrcSet)+'"]',typeof l.imageSizes=="string"&&(_+='[imagesizes="'+Dt(l.imageSizes)+'"]')):_+='[href="'+Dt(e)+'"]';var S=_;switch(a){case"style":S=el(e);break;case"script":S=tl(e)}xa.has(S)||(e=m({rel:"preload",href:a==="image"&&l&&l.imageSrcSet?void 0:e,as:a},l),xa.set(S,e),i.querySelector(_)!==null||a==="style"&&i.querySelector(os(S))||a==="script"&&i.querySelector(rs(S))||(a=i.createElement("link"),vn(a,"link",e),Ot(a),i.head.appendChild(a)))}}function tw(e,a){mo.m(e,a);var l=Jr;if(l&&e){var i=a&&typeof a.as=="string"?a.as:"script",_='link[rel="modulepreload"][as="'+Dt(i)+'"][href="'+Dt(e)+'"]',S=_;switch(i){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":S=tl(e)}if(!xa.has(S)&&(e=m({rel:"modulepreload",href:e},a),xa.set(S,e),l.querySelector(_)===null)){switch(i){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(l.querySelector(rs(S)))return}i=l.createElement("link"),vn(i,"link",e),Ot(i),l.head.appendChild(i)}}}function nw(e,a,l){mo.S(e,a,l);var i=Jr;if(i&&e){var _=Nn(i).hoistableStyles,S=el(e);a=a||"default";var $=_.get(S);if(!$){var Q={loading:0,preload:null};if($=i.querySelector(os(S)))Q.loading=5;else{e=m({rel:"stylesheet",href:e,"data-precedence":a},l),(l=xa.get(S))&&Md(e,l);var ae=$=i.createElement("link");Ot(ae),vn(ae,"link",e),ae._p=new Promise(function(me,Te){ae.onload=me,ae.onerror=Te}),ae.addEventListener("load",function(){Q.loading|=1}),ae.addEventListener("error",function(){Q.loading|=2}),Q.loading|=4,_c($,a,i)}$={type:"stylesheet",instance:$,count:1,state:Q},_.set(S,$)}}}function aw(e,a){mo.X(e,a);var l=Jr;if(l&&e){var i=Nn(l).hoistableScripts,_=tl(e),S=i.get(_);S||(S=l.querySelector(rs(_)),S||(e=m({src:e,async:!0},a),(a=xa.get(_))&&Hd(e,a),S=l.createElement("script"),Ot(S),vn(S,"link",e),l.head.appendChild(S)),S={type:"script",instance:S,count:1,state:null},i.set(_,S))}}function ow(e,a){mo.M(e,a);var l=Jr;if(l&&e){var i=Nn(l).hoistableScripts,_=tl(e),S=i.get(_);S||(S=l.querySelector(rs(_)),S||(e=m({src:e,async:!0,type:"module"},a),(a=xa.get(_))&&Hd(e,a),S=l.createElement("script"),Ot(S),vn(S,"link",e),l.head.appendChild(S)),S={type:"script",instance:S,count:1,state:null},i.set(_,S))}}function am(e,a,l,i){var _=(_=Z.current)?vc(_):null;if(!_)throw Error(s(446));switch(e){case"meta":case"title":return null;case"style":return typeof l.precedence=="string"&&typeof l.href=="string"?(a=el(l.href),l=Nn(_).hoistableStyles,i=l.get(a),i||(i={type:"style",instance:null,count:0,state:null},l.set(a,i)),i):{type:"void",instance:null,count:0,state:null};case"link":if(l.rel==="stylesheet"&&typeof l.href=="string"&&typeof l.precedence=="string"){e=el(l.href);var S=Nn(_).hoistableStyles,$=S.get(e);if($||(_=_.ownerDocument||_,$={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},S.set(e,$),(S=_.querySelector(os(e)))&&!S._p&&($.instance=S,$.state.loading=5),xa.has(e)||(l={rel:"preload",as:"style",href:l.href,crossOrigin:l.crossOrigin,integrity:l.integrity,media:l.media,hrefLang:l.hrefLang,referrerPolicy:l.referrerPolicy},xa.set(e,l),S||rw(_,e,l,$.state))),a&&i===null)throw Error(s(528,""));return $}if(a&&i!==null)throw Error(s(529,""));return null;case"script":return a=l.async,l=l.src,typeof l=="string"&&a&&typeof a!="function"&&typeof a!="symbol"?(a=tl(l),l=Nn(_).hoistableScripts,i=l.get(a),i||(i={type:"script",instance:null,count:0,state:null},l.set(a,i)),i):{type:"void",instance:null,count:0,state:null};default:throw Error(s(444,e))}}function el(e){return'href="'+Dt(e)+'"'}function os(e){return'link[rel="stylesheet"]['+e+"]"}function om(e){return m({},e,{"data-precedence":e.precedence,precedence:null})}function rw(e,a,l,i){e.querySelector('link[rel="preload"][as="style"]['+a+"]")?i.loading=1:(a=e.createElement("link"),i.preload=a,a.addEventListener("load",function(){return i.loading|=1}),a.addEventListener("error",function(){return i.loading|=2}),vn(a,"link",l),Ot(a),e.head.appendChild(a))}function tl(e){return'[src="'+Dt(e)+'"]'}function rs(e){return"script[async]"+e}function rm(e,a,l){if(a.count++,a.instance===null)switch(a.type){case"style":var i=e.querySelector('style[data-href~="'+Dt(l.href)+'"]');if(i)return a.instance=i,Ot(i),i;var _=m({},l,{"data-href":l.href,"data-precedence":l.precedence,href:null,precedence:null});return i=(e.ownerDocument||e).createElement("style"),Ot(i),vn(i,"style",_),_c(i,l.precedence,e),a.instance=i;case"stylesheet":_=el(l.href);var S=e.querySelector(os(_));if(S)return a.state.loading|=4,a.instance=S,Ot(S),S;i=om(l),(_=xa.get(_))&&Md(i,_),S=(e.ownerDocument||e).createElement("link"),Ot(S);var $=S;return $._p=new Promise(function(Q,ae){$.onload=Q,$.onerror=ae}),vn(S,"link",i),a.state.loading|=4,_c(S,l.precedence,e),a.instance=S;case"script":return S=tl(l.src),(_=e.querySelector(rs(S)))?(a.instance=_,Ot(_),_):(i=l,(_=xa.get(S))&&(i=m({},l),Hd(i,_)),e=e.ownerDocument||e,_=e.createElement("script"),Ot(_),vn(_,"link",i),e.head.appendChild(_),a.instance=_);case"void":return null;default:throw Error(s(443,a.type))}else a.type==="stylesheet"&&(a.state.loading&4)===0&&(i=a.instance,a.state.loading|=4,_c(i,l.precedence,e));return a.instance}function _c(e,a,l){for(var i=l.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),_=i.length?i[i.length-1]:null,S=_,$=0;$<i.length;$++){var Q=i[$];if(Q.dataset.precedence===a)S=Q;else if(S!==_)break}S?S.parentNode.insertBefore(e,S.nextSibling):(a=l.nodeType===9?l.head:l,a.insertBefore(e,a.firstChild))}function Md(e,a){e.crossOrigin==null&&(e.crossOrigin=a.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=a.referrerPolicy),e.title==null&&(e.title=a.title)}function Hd(e,a){e.crossOrigin==null&&(e.crossOrigin=a.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=a.referrerPolicy),e.integrity==null&&(e.integrity=a.integrity)}var wc=null;function lm(e,a,l){if(wc===null){var i=new Map,_=wc=new Map;_.set(l,i)}else _=wc,i=_.get(l),i||(i=new Map,_.set(l,i));if(i.has(e))return i;for(i.set(e,null),l=l.getElementsByTagName(e),_=0;_<l.length;_++){var S=l[_];if(!(S[Zn]||S[Vt]||e==="link"&&S.getAttribute("rel")==="stylesheet")&&S.namespaceURI!=="http://www.w3.org/2000/svg"){var $=S.getAttribute(a)||"";$=e+$;var Q=i.get($);Q?Q.push(S):i.set($,[S])}}return i}function sm(e,a,l){e=e.ownerDocument||e,e.head.insertBefore(l,a==="title"?e.querySelector("head > title"):null)}function lw(e,a,l){if(l===1||a.itemProp!=null)return!1;switch(e){case"meta":case"title":return!0;case"style":if(typeof a.precedence!="string"||typeof a.href!="string"||a.href==="")break;return!0;case"link":if(typeof a.rel!="string"||typeof a.href!="string"||a.href===""||a.onLoad||a.onError)break;switch(a.rel){case"stylesheet":return e=a.disabled,typeof a.precedence=="string"&&e==null;default:return!0}case"script":if(a.async&&typeof a.async!="function"&&typeof a.async!="symbol"&&!a.onLoad&&!a.onError&&a.src&&typeof a.src=="string")return!0}return!1}function cm(e){return!(e.type==="stylesheet"&&(e.state.loading&3)===0)}function sw(e,a,l,i){if(l.type==="stylesheet"&&(typeof i.media!="string"||matchMedia(i.media).matches!==!1)&&(l.state.loading&4)===0){if(l.instance===null){var _=el(i.href),S=a.querySelector(os(_));if(S){a=S._p,a!==null&&typeof a=="object"&&typeof a.then=="function"&&(e.count++,e=xc.bind(e),a.then(e,e)),l.state.loading|=4,l.instance=S,Ot(S);return}S=a.ownerDocument||a,i=om(i),(_=xa.get(_))&&Md(i,_),S=S.createElement("link"),Ot(S);var $=S;$._p=new Promise(function(Q,ae){$.onload=Q,$.onerror=ae}),vn(S,"link",i),l.instance=S}e.stylesheets===null&&(e.stylesheets=new Map),e.stylesheets.set(l,a),(a=l.state.preload)&&(l.state.loading&3)===0&&(e.count++,l=xc.bind(e),a.addEventListener("load",l),a.addEventListener("error",l))}}var Vd=0;function cw(e,a){return e.stylesheets&&e.count===0&&Sc(e,e.stylesheets),0<e.count||0<e.imgCount?function(l){var i=setTimeout(function(){if(e.stylesheets&&Sc(e,e.stylesheets),e.unsuspend){var S=e.unsuspend;e.unsuspend=null,S()}},6e4+a);0<e.imgBytes&&Vd===0&&(Vd=62500*H0());var _=setTimeout(function(){if(e.waitingForImages=!1,e.count===0&&(e.stylesheets&&Sc(e,e.stylesheets),e.unsuspend)){var S=e.unsuspend;e.unsuspend=null,S()}},(e.imgBytes>Vd?50:800)+a);return e.unsuspend=l,function(){e.unsuspend=null,clearTimeout(i),clearTimeout(_)}}:null}function xc(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Sc(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}}var Cc=null;function Sc(e,a){e.stylesheets=null,e.unsuspend!==null&&(e.count++,Cc=new Map,a.forEach(iw,e),Cc=null,xc.call(e))}function iw(e,a){if(!(a.state.loading&4)){var l=Cc.get(e);if(l)var i=l.get(null);else{l=new Map,Cc.set(e,l);for(var _=e.querySelectorAll("link[data-precedence],style[data-precedence]"),S=0;S<_.length;S++){var $=_[S];($.nodeName==="LINK"||$.getAttribute("media")!=="not all")&&(l.set($.dataset.precedence,$),i=$)}i&&l.set(null,i)}_=a.instance,$=_.getAttribute("data-precedence"),S=l.get($)||i,S===i&&l.set(null,_),l.set($,_),this.count++,i=xc.bind(this),_.addEventListener("load",i),_.addEventListener("error",i),S?S.parentNode.insertBefore(_,S.nextSibling):(e=e.nodeType===9?e.head:e,e.insertBefore(_,e.firstChild)),a.state.loading|=4}}var ls={$$typeof:k,Provider:null,Consumer:null,_currentValue:T,_currentValue2:T,_threadCount:0};function dw(e,a,l,i,_,S,$,Q,ae){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=kn(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=kn(0),this.hiddenUpdates=kn(null),this.identifierPrefix=i,this.onUncaughtError=_,this.onCaughtError=S,this.onRecoverableError=$,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=ae,this.incompleteTransitions=new Map}function im(e,a,l,i,_,S,$,Q,ae,me,Te,$e){return e=new dw(e,a,l,$,ae,me,Te,$e,Q),a=1,S===!0&&(a|=24),S=ea(3,null,null,a),e.current=S,S.stateNode=e,a=Ci(),a.refCount++,e.pooledCache=a,a.refCount++,S.memoizedState={element:i,isDehydrated:l,cache:a},ji(S),e}function dm(e){return e?(e=Ar,e):Ar}function um(e,a,l,i,_,S){_=dm(_),i.context===null?i.context=_:i.pendingContext=_,i=To(a),i.payload={element:l},S=S===void 0?null:S,S!==null&&(i.callback=S),l=Do(e,i,a),l!==null&&(Wn(l,e,a),Ll(l,e,a))}function pm(e,a){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var l=e.retryLane;e.retryLane=l!==0&&l<a?l:a}}function zd(e,a){pm(e,a),(e=e.alternate)&&pm(e,a)}function fm(e){if(e.tag===13||e.tag===31){var a=sr(e,67108864);a!==null&&Wn(a,e,67108864),zd(e,67108864)}}function hm(e){if(e.tag===13||e.tag===31){var a=ra();a=Ea(a);var l=sr(e,a);l!==null&&Wn(l,e,a),zd(e,a)}}var bc=!0;function uw(e,a,l,i){var _=A.T;A.T=null;var S=N.p;try{N.p=2,Bd(e,a,l,i)}finally{N.p=S,A.T=_}}function pw(e,a,l,i){var _=A.T;A.T=null;var S=N.p;try{N.p=8,Bd(e,a,l,i)}finally{N.p=S,A.T=_}}function Bd(e,a,l,i){if(bc){var _=Gd(i);if(_===null)Dd(e,a,i,Ec,l),ym(e,i);else if(hw(_,e,a,l,i))i.stopPropagation();else if(ym(e,i),a&4&&-1<fw.indexOf(e)){for(;_!==null;){var S=Rn(_);if(S!==null)switch(S.tag){case 3:if(S=S.stateNode,S.current.memoizedState.isDehydrated){var $=nn(S.pendingLanes);if($!==0){var Q=S;for(Q.pendingLanes|=2,Q.entangledLanes|=2;$;){var ae=1<<31-rt($);Q.entanglements[1]|=ae,$&=~ae}Va(S),(At&6)===0&&(sc=ke()+500,es(0))}}break;case 31:case 13:Q=sr(S,2),Q!==null&&Wn(Q,S,2),ic(),zd(S,2)}if(S=Gd(i),S===null&&Dd(e,a,i,Ec,l),S===_)break;_=S}_!==null&&i.stopPropagation()}else Dd(e,a,i,null,l)}}function Gd(e){return e=Co(e),Wd(e)}var Ec=null;function Wd(e){if(Ec=null,e=Un(e),e!==null){var a=d(e);if(a===null)e=null;else{var l=a.tag;if(l===13){if(e=u(a),e!==null)return e;e=null}else if(l===31){if(e=p(a),e!==null)return e;e=null}else if(l===3){if(a.stateNode.current.memoizedState.isDehydrated)return a.tag===3?a.stateNode.containerInfo:null;e=null}else a!==e&&(e=null)}}return Ec=e,null}function mm(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Xe()){case Le:return 2;case be:return 8;case Me:case Ne:return 32;case Be:return 268435456;default:return 32}default:return 32}}var Yd=!1,Ho=null,Vo=null,zo=null,ss=new Map,cs=new Map,Bo=[],fw="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function ym(e,a){switch(e){case"focusin":case"focusout":Ho=null;break;case"dragenter":case"dragleave":Vo=null;break;case"mouseover":case"mouseout":zo=null;break;case"pointerover":case"pointerout":ss.delete(a.pointerId);break;case"gotpointercapture":case"lostpointercapture":cs.delete(a.pointerId)}}function is(e,a,l,i,_,S){return e===null||e.nativeEvent!==S?(e={blockedOn:a,domEventName:l,eventSystemFlags:i,nativeEvent:S,targetContainers:[_]},a!==null&&(a=Rn(a),a!==null&&fm(a)),e):(e.eventSystemFlags|=i,a=e.targetContainers,_!==null&&a.indexOf(_)===-1&&a.push(_),e)}function hw(e,a,l,i,_){switch(a){case"focusin":return Ho=is(Ho,e,a,l,i,_),!0;case"dragenter":return Vo=is(Vo,e,a,l,i,_),!0;case"mouseover":return zo=is(zo,e,a,l,i,_),!0;case"pointerover":var S=_.pointerId;return ss.set(S,is(ss.get(S)||null,e,a,l,i,_)),!0;case"gotpointercapture":return S=_.pointerId,cs.set(S,is(cs.get(S)||null,e,a,l,i,_)),!0}return!1}function gm(e){var a=Un(e.target);if(a!==null){var l=d(a);if(l!==null){if(a=l.tag,a===13){if(a=u(l),a!==null){e.blockedOn=a,La(e.priority,function(){hm(l)});return}}else if(a===31){if(a=p(l),a!==null){e.blockedOn=a,La(e.priority,function(){hm(l)});return}}else if(a===3&&l.stateNode.current.memoizedState.isDehydrated){e.blockedOn=l.tag===3?l.stateNode.containerInfo:null;return}}}e.blockedOn=null}function jc(e){if(e.blockedOn!==null)return!1;for(var a=e.targetContainers;0<a.length;){var l=Gd(e.nativeEvent);if(l===null){l=e.nativeEvent;var i=new l.constructor(l.type,l);xo=i,l.target.dispatchEvent(i),xo=null}else return a=Rn(l),a!==null&&fm(a),e.blockedOn=l,!1;a.shift()}return!0}function vm(e,a,l){jc(e)&&l.delete(a)}function mw(){Yd=!1,Ho!==null&&jc(Ho)&&(Ho=null),Vo!==null&&jc(Vo)&&(Vo=null),zo!==null&&jc(zo)&&(zo=null),ss.forEach(vm),cs.forEach(vm)}function kc(e,a){e.blockedOn===a&&(e.blockedOn=null,Yd||(Yd=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,mw)))}var Rc=null;function _m(e){Rc!==e&&(Rc=e,t.unstable_scheduleCallback(t.unstable_NormalPriority,function(){Rc===e&&(Rc=null);for(var a=0;a<e.length;a+=3){var l=e[a],i=e[a+1],_=e[a+2];if(typeof i!="function"){if(Wd(i||l)===null)continue;break}var S=Rn(l);S!==null&&(e.splice(a,3),a-=3,Gi(S,{pending:!0,data:_,method:l.method,action:i},i,_))}}))}function nl(e){function a(ae){return kc(ae,e)}Ho!==null&&kc(Ho,e),Vo!==null&&kc(Vo,e),zo!==null&&kc(zo,e),ss.forEach(a),cs.forEach(a);for(var l=0;l<Bo.length;l++){var i=Bo[l];i.blockedOn===e&&(i.blockedOn=null)}for(;0<Bo.length&&(l=Bo[0],l.blockedOn===null);)gm(l),l.blockedOn===null&&Bo.shift();if(l=(e.ownerDocument||e).$$reactFormReplay,l!=null)for(i=0;i<l.length;i+=3){var _=l[i],S=l[i+1],$=_[Yt]||null;if(typeof S=="function")$||_m(l);else if($){var Q=null;if(S&&S.hasAttribute("formAction")){if(_=S,$=S[Yt]||null)Q=$.formAction;else if(Wd(_)!==null)continue}else Q=$.action;typeof Q=="function"?l[i+1]=Q:(l.splice(i,3),i-=3),_m(l)}}}function wm(){function e(S){S.canIntercept&&S.info==="react-transition"&&S.intercept({handler:function(){return new Promise(function($){return _=$})},focusReset:"manual",scroll:"manual"})}function a(){_!==null&&(_(),_=null),i||setTimeout(l,20)}function l(){if(!i&&!navigation.transition){var S=navigation.currentEntry;S&&S.url!=null&&navigation.navigate(S.url,{state:S.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var i=!1,_=null;return navigation.addEventListener("navigate",e),navigation.addEventListener("navigatesuccess",a),navigation.addEventListener("navigateerror",a),setTimeout(l,100),function(){i=!0,navigation.removeEventListener("navigate",e),navigation.removeEventListener("navigatesuccess",a),navigation.removeEventListener("navigateerror",a),_!==null&&(_(),_=null)}}}function Qd(e){this._internalRoot=e}Nc.prototype.render=Qd.prototype.render=function(e){var a=this._internalRoot;if(a===null)throw Error(s(409));var l=a.current,i=ra();um(l,i,e,a,null,null)},Nc.prototype.unmount=Qd.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var a=e.containerInfo;um(e.current,2,null,e,null,null),ic(),a[Ln]=null}};function Nc(e){this._internalRoot=e}Nc.prototype.unstable_scheduleHydration=function(e){if(e){var a=ua();e={blockedOn:null,target:e,priority:a};for(var l=0;l<Bo.length&&a!==0&&a<Bo[l].priority;l++);Bo.splice(l,0,e),l===0&&gm(e)}};var xm=n.version;if(xm!=="19.2.3")throw Error(s(527,xm,"19.2.3"));N.findDOMNode=function(e){var a=e._reactInternals;if(a===void 0)throw typeof e.render=="function"?Error(s(188)):(e=Object.keys(e).join(","),Error(s(268,e)));return e=h(a),e=e!==null?y(e):null,e=e===null?null:e.stateNode,e};var yw={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:A,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Tc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Tc.isDisabled&&Tc.supportsFiber)try{Ge=Tc.inject(yw),et=Tc}catch{}}return us.createRoot=function(e,a){if(!c(e))throw Error(s(299));var l=!1,i="",_=Rf,S=Nf,$=Tf;return a!=null&&(a.unstable_strictMode===!0&&(l=!0),a.identifierPrefix!==void 0&&(i=a.identifierPrefix),a.onUncaughtError!==void 0&&(_=a.onUncaughtError),a.onCaughtError!==void 0&&(S=a.onCaughtError),a.onRecoverableError!==void 0&&($=a.onRecoverableError)),a=im(e,1,!1,null,null,l,i,null,_,S,$,wm),e[Ln]=a.current,Td(e),new Qd(a)},us.hydrateRoot=function(e,a,l){if(!c(e))throw Error(s(299));var i=!1,_="",S=Rf,$=Nf,Q=Tf,ae=null;return l!=null&&(l.unstable_strictMode===!0&&(i=!0),l.identifierPrefix!==void 0&&(_=l.identifierPrefix),l.onUncaughtError!==void 0&&(S=l.onUncaughtError),l.onCaughtError!==void 0&&($=l.onCaughtError),l.onRecoverableError!==void 0&&(Q=l.onRecoverableError),l.formState!==void 0&&(ae=l.formState)),a=im(e,1,!0,a,l??null,i,_,ae,S,$,Q,wm),a.context=dm(null),l=a.current,i=ra(),i=Ea(i),_=To(i),_.callback=null,Do(l,_,i),l=i,a.current.lanes=l,qn(a,l),Va(a),e[Ln]=a.current,Td(e),new Nc(a)},us.version="19.2.3",us}var Dm;function jw(){if(Dm)return Zd.exports;Dm=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(n){console.error(n)}}return t(),Zd.exports=Ew(),Zd.exports}var kw=jw(),J=Nu();/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const St=({card:t,onPointerDown:n,onPointerEnter:r,onPointerLeave:s,isFaceUp:c,faceDownValue:d=2,isSelected:u,isMultiSelected:p,isTargetable:f,isSourceOfEffect:h,style:y,additionalClassName:m})=>{const g=x=>x.replace(/<[^>]*>/g,"").length,v=({content:x,className:j})=>{if(!x)return o.jsx("div",{className:`card-rule-box ${j||""}`});const E=g(x),k=E>95,D=E>140?"very-long-text":k?"long-text":"";return o.jsx("div",{className:`card-rule-box ${j||""} ${D}`,dangerouslySetInnerHTML:{__html:x}})},C=["card-component"];t.protocol&&C.push(`card-protocol-${t.protocol.toLowerCase()}`),t.color&&C.push("has-custom-color"),t.pattern&&C.push(`card-pattern-${t.pattern}`),u&&C.push("selected"),p&&C.push("multi-selected"),f&&C.push("is-targetable"),h&&C.push("is-source-of-effect"),m&&C.push(m);const b={...y};return t.color&&(b["--card-custom-color"]=t.color),o.jsx("div",{className:C.join(" "),onPointerDown:n,onPointerEnter:r,onPointerLeave:s,role:"button",tabIndex:n?0:-1,style:b,children:o.jsxs("div",{className:`card-inner ${c?"":"is-flipped"}`,children:[o.jsxs("div",{className:"card-face card-front",children:[o.jsxs("div",{className:"card-header",children:[o.jsx("span",{className:`card-protocol ${t.protocol.length<=10?"short-protocol":""}`,children:t.protocol.slice(0,10)}),o.jsx("span",{className:"card-value",children:t.value})]}),o.jsxs("div",{className:"card-body",children:[o.jsx(v,{content:t.top,className:"card-rule-top"}),o.jsx(v,{content:t.middle,className:"card-rule-middle"}),o.jsx(v,{content:t.bottom,className:"card-rule-bottom"})]})]}),o.jsx("div",{className:"card-face card-back",children:o.jsx("div",{className:"card-back-value",children:d})})]})})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const la=[{protocol:"Apathy",value:0,top:"Your total value in this line is increased by 1 for each face-down card in this line.",middle:"",bottom:"",keywords:{},category:"Aux 1"},{protocol:"Apathy",value:1,top:"",middle:"Flip all other face-up cards in this line.",bottom:"",keywords:{flip:!0},category:"Aux 1"},{protocol:"Apathy",value:2,top:"Ignore all middle commands of cards in this line.",middle:"",bottom:"<div><span class='emphasis'>When this card would be covered:</span> First, flip this card.</div>",keywords:{flip:!0},category:"Aux 1"},{protocol:"Apathy",value:3,top:"",middle:"Flip 1 of your opponent's face-up cards.",bottom:"",keywords:{flip:!0},category:"Aux 1"},{protocol:"Apathy",value:4,top:"",middle:"You may flip 1 of your face-up covered cards.",bottom:"",keywords:{flip:!0},category:"Aux 1"},{protocol:"Apathy",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Aux 1"},{protocol:"Chaos",value:0,top:"",middle:"In each line, flip 1 covered card.",bottom:"<div><span class='emphasis'>Start:</span> Draw the top card of your opponent's deck. Your opponent draws the top card of your deck.</div>",keywords:{flip:!0,draw:!0},category:"Main 2"},{protocol:"Chaos",value:1,top:"",middle:"Rearrange your protocols. Rearrange your opponent's protocols.",bottom:"",keywords:{},category:"Main 2"},{protocol:"Chaos",value:2,top:"",middle:"Shift 1 of your covered cards.",bottom:"",keywords:{shift:!0},category:"Main 2"},{protocol:"Chaos",value:3,top:"",middle:"",bottom:"You may play cards without matching protocols.",keywords:{play:!0},category:"Main 2"},{protocol:"Chaos",value:4,top:"",middle:"",bottom:"<div><span class='emphasis'>End:</span> Discard your hand. Draw the same amount of cards.</div>",keywords:{discard:!0,draw:!0},category:"Main 2"},{protocol:"Chaos",value:5,top:"",middle:"Discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 2"},{protocol:"Darkness",value:0,top:"",middle:"Draw 3 cards. Shift 1 of your opponent's covered cards.",bottom:"",keywords:{draw:!0,shift:!0},category:"Main 1"},{protocol:"Darkness",value:1,top:"",middle:"Flip 1 of your opponent's cards. You may shift that card.",bottom:"",keywords:{flip:!0,shift:!0},category:"Main 1"},{protocol:"Darkness",value:2,top:"All face-down cards in this stack have a value of 4.",middle:"You may flip 1 covered card in this line.",bottom:"",keywords:{flip:!0},category:"Main 1"},{protocol:"Darkness",value:3,top:"",middle:"Play 1 card face-down in another line.",bottom:"",keywords:{play:!0},category:"Main 1"},{protocol:"Darkness",value:4,top:"",middle:"Shift 1 face-down card.",bottom:"",keywords:{shift:!0},category:"Main 1"},{protocol:"Darkness",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Death",value:0,top:"",middle:"Delete 1 card from each other line.",bottom:"",keywords:{delete:!0},category:"Main 1"},{protocol:"Death",value:1,top:"<div><span class='emphasis'>Start:</span> You may draw 1 card. If you do, delete 1 other card, then delete this card.</div>",middle:"",bottom:"",keywords:{draw:!0,delete:!0},category:"Main 1"},{protocol:"Death",value:2,top:"",middle:"Delete all cards in 1 line with values of 1 or 2.",bottom:"",keywords:{delete:!0},category:"Main 1"},{protocol:"Death",value:3,top:"",middle:"Delete 1 face-down card.",bottom:"",keywords:{delete:!0},category:"Main 1"},{protocol:"Death",value:4,top:"",middle:"Delete a card with a value of 0 or 1.",bottom:"",keywords:{delete:!0},category:"Main 1"},{protocol:"Death",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Fire",value:0,top:"",middle:"Flip 1 other card. Draw 2 cards.",bottom:"<div><span class='emphasis'>When this card would be covered:</span> First, draw 1 card and flip 1 other card.</div>",keywords:{draw:!0,flip:!0},category:"Main 1"},{protocol:"Fire",value:1,top:"",middle:"Discard 1 card. If you do, delete 1 card.",bottom:"",keywords:{delete:!0,discard:!0},category:"Main 1"},{protocol:"Fire",value:2,top:"",middle:"Discard 1 card. If you do, return 1 card.",bottom:"",keywords:{discard:!0,return:!0},category:"Main 1"},{protocol:"Fire",value:3,top:"",middle:"",bottom:"<div><span class='emphasis'>End:</span> You may discard 1 card. If you do, flip 1 card.</div>",keywords:{discard:!0,flip:!0},category:"Main 1"},{protocol:"Fire",value:4,top:"",middle:"Discard 1 or more cards. Draw the amount discarded plus 1.",bottom:"",keywords:{discard:!0,draw:!0},category:"Main 1"},{protocol:"Fire",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Gravity",value:0,top:"",middle:"For every 2 cards in this line, play the top card of your deck face-down under this card.",bottom:"",keywords:{play:!0},category:"Main 1"},{protocol:"Gravity",value:1,top:"",middle:"Draw 2 cards. Shift 1 card either to or from this line.",bottom:"",keywords:{draw:!0,shift:!0},category:"Main 1"},{protocol:"Gravity",value:2,top:"",middle:"Flip 1 card. Shift that card to this line.",bottom:"",keywords:{flip:!0,shift:!0},category:"Main 1"},{protocol:"Gravity",value:4,top:"",middle:"Shift 1 face-down card to this line.",bottom:"",keywords:{shift:!0},category:"Main 1"},{protocol:"Gravity",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Gravity",value:6,top:"",middle:"Your opponent plays the top card of their deck face-down in this line.",bottom:"",keywords:{play:!0},category:"Main 1"},{protocol:"Hate",value:0,top:"",middle:"Delete 1 card.",bottom:"",keywords:{delete:!0},category:"Aux 1"},{protocol:"Hate",value:1,top:"",middle:"Discard 3 cards. Delete 1 card. Delete 1 card.",bottom:"",keywords:{delete:!0,discard:!0},category:"Aux 1"},{protocol:"Hate",value:2,top:"",middle:"Delete your highest value uncovered card. Delete your opponent's highest value uncovered card.",bottom:"",keywords:{delete:!0},category:"Aux 1"},{protocol:"Hate",value:3,top:"<div><span class='emphasis'>After you delete cards:</span> Draw 1 card.</div>",middle:"",bottom:"",keywords:{draw:!0},category:"Aux 1"},{protocol:"Hate",value:4,top:"",middle:"",bottom:"<div><span class='emphasis'>When this card would be covered:</span> First, delete the lowest value covered card in this line.</div>",keywords:{delete:!0},category:"Aux 1"},{protocol:"Hate",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Aux 1"},{protocol:"Life",value:0,top:"",middle:"Play the top card of your deck face-down in each line where you have a card.",bottom:"<div><span class='emphasis'>When this card would be covered:</span> First, delete this card.</div>",keywords:{delete:!0,play:!0},category:"Main 1"},{protocol:"Life",value:1,top:"",middle:"Flip 1 card. Flip 1 card.",bottom:"",keywords:{flip:!0},category:"Main 1"},{protocol:"Life",value:2,top:"",middle:"Draw 1 card. You may flip 1 face-down card.",bottom:"",keywords:{draw:!0,flip:!0},category:"Main 1"},{protocol:"Life",value:3,top:"",middle:"",bottom:"<div><span class='emphasis'>When this card would be covered:</span> First, play the top card of your deck face-down in another line.</div>",keywords:{play:!0},category:"Main 1"},{protocol:"Life",value:4,top:"",middle:"If this card is covering a card, draw 1 card.",bottom:"",keywords:{draw:!0},category:"Main 1"},{protocol:"Life",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Light",value:0,top:"",middle:"Flip 1 card. Draw cards equal to that card's value.",bottom:"",keywords:{draw:!0,flip:!0},category:"Main 1"},{protocol:"Light",value:1,top:"",middle:"",bottom:"<div><span class='emphasis'>End:</span> Draw 1 card.</div>",keywords:{draw:!0},category:"Main 1"},{protocol:"Light",value:2,top:"",middle:"Draw 2 cards. Reveal 1 face-down card. You may shift or flip that card.",bottom:"",keywords:{draw:!0,flip:!0,reveal:!0,shift:!0},category:"Main 1"},{protocol:"Light",value:3,top:"",middle:"Shift all face-down cards in this line to another line.",bottom:"",keywords:{shift:!0},category:"Main 1"},{protocol:"Light",value:4,top:"",middle:"Your opponent reveals their hand.",bottom:"",keywords:{reveal:!0},category:"Main 1"},{protocol:"Light",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Love",value:1,top:"",middle:"Draw the top card of your opponent's deck.",bottom:"<div><span class='emphasis'>End:</span> You may give 1 card from your hand to your opponent. If you do, draw 2 cards.</div>",keywords:{draw:!0,give:!0},category:"Aux 1"},{protocol:"Love",value:2,top:"",middle:"Your opponent draws 1 card. Refresh.",bottom:"",keywords:{draw:!0,refresh:!0},category:"Aux 1"},{protocol:"Love",value:3,top:"",middle:"Take 1 random card from your opponent's hand. Give 1 card from your hand to your opponent.",bottom:"",keywords:{give:!0,take:!0},category:"Aux 1"},{protocol:"Love",value:4,top:"",middle:"Reveal 1 card from your hand. Flip 1 card.",bottom:"",keywords:{flip:!0,reveal:!0},category:"Aux 1"},{protocol:"Love",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Aux 1"},{protocol:"Love",value:6,top:"",middle:"Your opponent draws 2 cards.",bottom:"",keywords:{draw:!0},category:"Aux 1"},{protocol:"Metal",value:0,top:"Your opponent's total value in this line is reduced by 2.",middle:"Flip 1 card.",bottom:"",keywords:{flip:!0},category:"Main 1"},{protocol:"Metal",value:1,top:"",middle:"Draw 2 cards. Your opponent cannot compile next turn.",bottom:"",keywords:{draw:!0},category:"Main 1"},{protocol:"Metal",value:2,top:"Your opponent cannot play cards face-down in this line.",middle:"",bottom:"",keywords:{},category:"Main 1"},{protocol:"Metal",value:3,top:"",middle:"Draw 1 card. Delete all cards in 1 other line with 8 or more cards.",bottom:"",keywords:{delete:!0,draw:!0},category:"Main 1"},{protocol:"Metal",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Metal",value:6,top:"<div><span class='emphasis'>When this card would be covered or flipped:</span> First, delete this card.</div>",middle:"",bottom:"",keywords:{delete:!0},category:"Main 1"},{protocol:"Plague",value:0,top:"",middle:"Your opponent discards 1 card.",bottom:"Your opponent cannot play cards in this line.",keywords:{discard:!0},category:"Main 1"},{protocol:"Plague",value:1,top:"<div><span class='emphasis'>After your opponent discards cards:</span> Draw 1 card.</div>",middle:"Your opponent discards 1 card.",bottom:"",keywords:{discard:!0,draw:!0},category:"Main 1"},{protocol:"Plague",value:2,top:"",middle:"Dicard 1 or more cards. Your opponent discards the amount of cards discarded plus 1.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Plague",value:3,top:"",middle:"Flip each other face-up card.",bottom:"",keywords:{flip:!0},category:"Main 1"},{protocol:"Plague",value:4,top:"",middle:"",bottom:"<div><span class='emphasis'>End:</span> Your opponent deletes 1 of their face-down cards. You may flip this card.</div>",keywords:{delete:!0,flip:!0},category:"Main 1"},{protocol:"Plague",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Psychic",value:0,top:"",middle:"Draw 2 cards. Your opponent discards 2 cards, then reveals their hand.",bottom:"",keywords:{discard:!0,draw:!0,reveal:!0},category:"Main 1"},{protocol:"Psychic",value:1,top:"Your opponent can only play cards face-down.",middle:"",bottom:"<div><span class='emphasis'>Start:</span> Flip this card.</div>",keywords:{flip:!0},category:"Main 1"},{protocol:"Psychic",value:2,top:"",middle:"Your opponent discards 2 cards. Rearrange their protocols.",bottom:"",keywords:{discard:!0,rearrange:!0},category:"Main 1"},{protocol:"Psychic",value:3,top:"",middle:"Your opponent discards 1 card. Shift 1 of their cards.",bottom:"",keywords:{discard:!0,shift:!0},category:"Main 1"},{protocol:"Psychic",value:4,top:"",middle:"",bottom:"<div><span class='emphasis'>End:</span> You may return 1 of your opponent's cards. If you do, flip this card.</div>",keywords:{flip:!0,return:!0},category:"Main 1"},{protocol:"Psychic",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Speed",value:0,top:"",middle:"Play 1 card.",bottom:"",keywords:{play:!0},category:"Main 1"},{protocol:"Speed",value:1,top:"<div><span class='emphasis'>After you clear cache:</span> Draw 1 card.</div>",middle:"Draw 2 cards.",bottom:"",keywords:{draw:!0},category:"Main 1"},{protocol:"Speed",value:2,top:"<div><span class='emphasis'>When this card would be deleted by compiling:</span> Shift this card, even if this card is covered.</div>",middle:"",bottom:"",keywords:{shift:!0},category:"Main 1"},{protocol:"Speed",value:3,top:"",middle:"Shift 1 of your other cards.",bottom:"<div><span class='emphasis'>End:</span> You may shift 1 of your cards. If you do, flip this card.</div>",keywords:{flip:!0,shift:!0},category:"Main 1"},{protocol:"Speed",value:4,top:"",middle:"Shift 1 of your opponent's face-down cards.",bottom:"",keywords:{shift:!0},category:"Main 1"},{protocol:"Speed",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Spirit",value:0,top:"",middle:"Refresh. Draw 1 card.",bottom:"Skip your check cache phase.",keywords:{draw:!0,refresh:!0},category:"Main 1"},{protocol:"Spirit",value:1,top:"You can play cards in any line.",middle:"Draw 2 cards.",bottom:"<div><span class='emphasis'>Start:</span> Either discard 1 card or flip this card.</div>",keywords:{discard:!0,draw:!0,flip:!0},category:"Main 1"},{protocol:"Spirit",value:2,top:"",middle:"You may flip 1 card.",bottom:"",keywords:{flip:!0},category:"Main 1"},{protocol:"Spirit",value:3,top:"<div><span class='emphasis'>After you draw cards:</span> You may shift this card, even if this card is covered.</div>",middle:"",bottom:"",keywords:{shift:!0},category:"Main 1"},{protocol:"Spirit",value:4,top:"",middle:"Swap the positions of 2 of your protocols",bottom:"",keywords:{swap:!0},category:"Main 1"},{protocol:"Spirit",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Water",value:0,top:"",middle:"Flip 1 other card. Flip this card.",bottom:"",keywords:{flip:!0},category:"Main 1"},{protocol:"Water",value:1,top:"",middle:"Play the top card of your deck face-down in each other line.",bottom:"",keywords:{play:!0},category:"Main 1"},{protocol:"Water",value:2,top:"",middle:"Draw 2 cards. Rearrange your protocols.",bottom:"",keywords:{draw:!0,rearrange:!0},category:"Main 1"},{protocol:"Water",value:3,top:"",middle:"Return all cards with a value of 2 in 1 line.",bottom:"",keywords:{return:!0},category:"Main 1"},{protocol:"Water",value:4,top:"",middle:"Return 1 of your cards.",bottom:"",keywords:{return:!0},category:"Main 1"},{protocol:"Water",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Frost",value:0,top:"",middle:"Draw 1 card for each face-down card.",bottom:"",keywords:{draw:!0},category:"Fan-Content"},{protocol:"Frost",value:1,top:"Cards cannot be flipped face-up.",middle:"",bottom:"Protocols cannot be rearranged.",keywords:{flip:!0,rearrange:!0},category:"Fan-Content"},{protocol:"Frost",value:2,top:"",middle:"Play a card face-down.",bottom:"",keywords:{play:!0},category:"Fan-Content"},{protocol:"Frost",value:3,top:"Cards cannot shift from or to this line.",middle:"",bottom:"",keywords:{shift:!0},category:"Fan-Content"},{protocol:"Frost",value:4,top:"",middle:"You may flip 1 card of your face-up covered cards.",bottom:"",keywords:{flip:!0},category:"Fan-Content"},{protocol:"Frost",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Fan-Content"},{protocol:"Anarchy",value:0,top:"",middle:"Shift 1 card. For each line that contains a face-up card without matching protocol, draw 1 card.",bottom:"",keywords:{shift:!0,draw:!0},category:"Fan-Content"},{protocol:"Anarchy",value:1,top:"Cards can only be played without matching protocols.",middle:"Shift 1 other card to a line without a matching protocol.",bottom:"",keywords:{shift:!0,play:!0},category:"Fan-Content"},{protocol:"Anarchy",value:2,top:"",middle:"Delete a covered or uncovered card in a line with a matching protocol.",bottom:"",keywords:{delete:!0},category:"Fan-Content"},{protocol:"Anarchy",value:3,top:"",middle:"Swap the positions of 2 of your opponent's protocols.",bottom:"<div><span class='emphasis'>End:</span> Rearrange your protocols. Anarchy cannot be on this line.</div>",keywords:{swap:!0,rearrange:!0},category:"Fan-Content"},{protocol:"Anarchy",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Fan-Content"},{protocol:"Anarchy",value:6,top:"<div><span class='emphasis'>Start:</span> Flip this card, if this card is in the line with the Anarchy protocol.</div>",middle:"",bottom:"",keywords:{flip:!0},category:"Fan-Content"}],Rw=new Set(la.map(t=>t.protocol)),Nw=Array.from(Rw).sort();/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function yo(t,n=1){var h,y,m;const r=t.count??n,s=((h=t.targetFilter)==null?void 0:h.owner)||"any",c=((y=t.targetFilter)==null?void 0:y.position)||"uncovered",d=(m=t.targetFilter)==null?void 0:m.faceState;let u="";c==="any"?u="covered or uncovered ":c==="covered"&&(u="covered ");let p="";d==="face_down"?p="face-down ":d==="face_up"&&(p="face-up ");const f=r===1?"card":"cards";return s==="own"?`${r} of your ${u}${p}${f}`:s==="opponent"?`${r} of your opponent's ${u}${p}${f}`:r==="all"?`all ${u}${p}cards`:`${r} ${u}${p}${f}`}const dl=(t,n)=>{var d,u,p,f,h,y,m,g,v,C,b,x,j,E,k,R,D,L,I,F,U,B,G,W,P,z,H,A,N,T,q,O,M,Y,X,K,ne,Z,oe,xe,ye,Ce,pe,_e,ee,je,de,Pe,Ue,se,re,ce,he,we,Se,ke,Xe,Le,be,Me,Ne,Be,Ye,De,Ge,et,tt,rt,ht,Rt,Ft,En,fn,Zt,nn,un,jn,Xn,xn,kn,qn,Ya,$a,Pa,qa,Ea,da,ua,La,Cn,Vt,Yt,Ln,pa,Qa,Xa,Ua,Zn,ja,Un,Rn,On,Nn,Ot,ka,Ra,Sn,Tn;const r=t.params,s=(n==null?void 0:n.protocolName)||"[protocol]";let c="";switch(r.action){case"refresh":{r.target==="opponent"?c="Your opponent refreshes their hand.":c="Refresh.";break}case"mutual_draw":{const ge=r.count||1;c=`Draw the top card${ge!==1?"s":""} of your opponent's deck. Your opponent draws the top card${ge!==1?"s":""} of your deck.`;break}case"draw":{if(t.useCardFromPreviousEffect){r.target==="opponent"?c="Opponent draws cards equal to that card's value.":c="Draw cards equal to that card's value.";break}if(r.revealFromDrawn){const Qe=r.count||3;let Ze=`Draw ${Qe} ${Qe===1?"card":"cards"}.`;const Je=r.revealFromDrawn.count||1,ct=Je==="all"?"all cards":Je===1?"1 card":`${Je} cards`;(r.revealFromDrawn.valueSource||"stated_number")==="stated_number"?Ze+=` Reveal ${ct} drawn with the face-up value of your stated number.`:Ze+=` Reveal ${ct} drawn.`,r.revealFromDrawn.thenAction==="may_play"&&(Ze+=" You may play it."),c=Ze;break}if(r.countType==="count_face_down"){c="Draw 1 card for each face-down card.";break}if(r.conditional){switch(r.conditional.type){case"count_face_down":c="Draw 1 card for each face-down card.";break;case"is_covering":c=`Draw ${r.count} card${r.count!==1?"s":""} if this card is covering another.`;break;case"non_matching_protocols":c="Draw 1 card for each line with a non-matching protocol.";break}break}let ge="";if(r.countType==="equal_to_discarded"){const Qe=r.countOffset||0;Qe===1?ge+="Draw 1 more card than the amount discarded.":Qe===0?ge+="Draw the same amount of cards.":ge+=`Draw the amount discarded plus ${Qe}.`,c=ge;break}else if(r.countType==="equal_to_card_value"){ge+="Draw cards equal to that card's value.",c=ge;break}else if(r.countType==="hand_size"){ge+="Draw the same amount of cards.",c=ge;break}else if(r.countType==="all_matching"&&((d=r.valueFilter)==null?void 0:d.equals)!==void 0){const Qe=r.valueFilter.equals;ge+=`Draw all cards with a value of ${Qe}.`,c=ge;break}else if(r.countType==="equal_to_unique_protocols_in_lane"){ge+="Draw cards equal to the number of different protocols in this line.",c=ge;break}else if(r.countType==="count_own_protocol_cards_on_field"){ge+=`Draw cards equal to the number of face-up ${s} cards in the field.`,c=ge;break}else if(((u=r.valueFilter)==null?void 0:u.equals)!==void 0&&r.count){const Qe=r.valueFilter.equals,mt=r.count===1?"card":"cards",Ze=r.fromRevealed?" revealed this way":"";ge+=`Draw ${r.count} ${mt} with a value of ${Qe}${Ze}.`,c=ge;break}if(((p=r.protocolFilter)==null?void 0:p.type)==="same_as_source"){((f=r.advancedConditional)==null?void 0:f.type)==="empty_hand"?c=`If your hand is empty, reveal your deck, draw all ${s} cards from it, and shuffle your deck.`:c=`Reveal your deck and draw all ${s} cards.`;break}if(((h=r.advancedConditional)==null?void 0:h.type)==="empty_hand"){c=`If you have no cards in hand, draw ${yo(r)}.`;break}if(((y=r.advancedConditional)==null?void 0:y.type)==="opponent_higher_value_in_lane"){c=`If your opponent has a higher total value than you do in this line, draw ${yo(r)}.`;break}if(((m=r.advancedConditional)==null?void 0:m.type)==="same_protocol_on_field"){c=`If there is another face-up ${s} card in the field, draw ${yo(r)}.`;break}const Oe=r.optional?"You may ":"";if(r.source==="opponent_deck"){const Qe=r.count===1?"the top card":`the top ${r.count} cards`;ge+=`${Oe}Draw ${Qe} of your opponent's deck.`}else if(r.target==="opponent")if(r.source==="own_deck"){const Qe=r.count===1?"the top card":`the top ${r.count} cards`;ge+=`Your opponent draws ${Qe} of your deck.`}else ge+=`Opponent draws ${r.count} card${r.count!==1?"s":""}.`;else{const Qe=r.optional?"draw":"Draw";ge+=`${Oe}${Qe} ${r.count} card${r.count!==1?"s":""}.`}c=ge;break}case"flip":{if(t.useCardFromPreviousEffect){const Re=r.optional?"May flip":"Flip",Fe=r.skipMiddleCommand?", ignoring its middle commands":"";c=`${Re} that card${Fe}.`;break}if(r.flipSelf){if(((g=r.advancedConditional)==null?void 0:g.type)==="opponent_higher_value_in_lane"){c="If your opponent has a higher value in this line than you do, flip this card.";break}if(((v=r.advancedConditional)==null?void 0:v.type)==="hand_size_greater_than"){const Fe=r.advancedConditional.threshold??0;c=`If you have more than ${Fe} ${Fe===1?"card":"cards"} in your hand, flip this card.`;break}if(((C=r.advancedConditional)==null?void 0:C.type)==="same_protocol_on_field"){c=`If there is another face-up ${s} card in the field, you may flip this card.`;break}if(((b=r.advancedConditional)==null?void 0:b.type)==="this_card_is_covered"){c=r.optional?"If this card is covered, you may flip this card.":"If this card is covered, flip this card.";break}let Re=r.optional?"You may flip this card":"Flip this card";((x=r.advancedConditional)==null?void 0:x.type)==="protocol_match"&&(Re+=`, if this card is in the line with the ${r.advancedConditional.protocol||"[Protocol]"} protocol`),c=Re+".";break}if(((j=r.advancedConditional)==null?void 0:j.type)==="same_protocol_on_field"){const Re=r.count||1,Fe=((E=r.targetFilter)==null?void 0:E.faceState)==="face_up"?"face-up ":"";c=`If there is another face-up ${s} card in the field, you may flip ${Re} ${Fe}card${Re!==1?"s":""}.`;break}const ge=r.optional?"You may flip":"Flip",Oe=((k=r.targetFilter)==null?void 0:k.owner)==="own",Qe=((R=r.targetFilter)==null?void 0:R.owner)==="opponent",mt=(D=r.targetFilter)==null?void 0:D.excludeSelf;let Ze="";Oe&&mt?Ze+="of your other ":Oe?Ze+="of your ":Qe?Ze+="of your opponent's ":mt&&(Ze+="other "),((L=r.targetFilter)==null?void 0:L.position)==="any"?Ze+="covered or uncovered ":((I=r.targetFilter)==null?void 0:I.position)==="covered"&&(Ze+="covered "),((F=r.targetFilter)==null?void 0:F.faceState)==="face_down"&&(Ze+="face-down "),((U=r.targetFilter)==null?void 0:U.faceState)==="face_up"&&(Ze+="face-up ");let Je="";r.count==="all"?Je="all":r.count==="each"?r.eachLineScope==="each_line"?(Je="1",Ze=Ze+"(in each line) "):Je="each":Je=r.count.toString();const ot=Oe||Qe?"cards":r.count===1?"card":"cards";let ue="";if(Oe&&((B=r.targetFilter)==null?void 0:B.position)==="covered"&&((G=r.targetFilter)==null?void 0:G.faceState)==="face_up"&&r.optional?ue=`${ge} ${Je} of your ${r.targetFilter.faceState.replace("_","-")} ${r.targetFilter.position} cards`:ue=`${ge} ${Je} ${Ze}${ot}`,r.scope==="this_lane"){const Re=((W=r.targetFilter)==null?void 0:W.owner)==="own";ue+=Re?" in this stack":" in this line"}else r.scope==="each_lane"&&(ue=`In each line, ${ue.charAt(0).toLowerCase()+ue.slice(1)}`);r.sameLaneAsFirst&&(ue+=" in the same line"),(P=r.targetFilter)!=null&&P.valueMinGreaterThanHandSize&&(ue+=" that has a value greater than the number of cards in your hand"),(z=r.targetFilter)!=null&&z.valueLessThanUniqueProtocolsOnField&&(ue+=" with a value less than the number of different protocols on cards in the field"),ue+=".",r.selfFlipAfter&&(ue+=" Then flip this card."),c=ue;break}case"shift":{const ge=r.optional?"You may shift":"Shift";if(((H=r.advancedConditional)==null?void 0:H.type)==="empty_hand"){c=`If you have no cards in hand, ${ge.toLowerCase()} ${yo(r)}.`;break}if(((A=r.advancedConditional)==null?void 0:A.type)==="opponent_higher_value_in_lane"){c=`If your opponent has a higher total value than you do in this line, ${ge.toLowerCase()} ${yo(r)}.`;break}if(((N=r.advancedConditional)==null?void 0:N.type)==="this_card_is_covered"){c=`If this card is covered, ${ge.toLowerCase()} it.`;break}if(r.shiftSelf){if(((T=r.destinationRestriction)==null?void 0:T.type)==="opponent_highest_value_lane"){c=`${ge} this card to the line where your opponent has their highest total value.`;break}let it=`${ge} this card`;r.allowCoveredSelf&&(it+=", even if this card is covered"),c=it+".";break}if(t.useCardFromPreviousEffect){let it=`${ge} that card`;((q=r.destinationRestriction)==null?void 0:q.type)==="to_this_lane"?it+=" to this line":((O=r.destinationRestriction)==null?void 0:O.type)==="to_another_line"?it+=" to another line":((M=r.destinationRestriction)==null?void 0:M.type)==="non_matching_protocol"?it+=" to a line without a matching protocol":((Y=r.destinationRestriction)==null?void 0:Y.type)==="specific_lane"&&(it+=" within this line"),c=it+".";break}const Oe=r.count||1,Qe=((X=r.targetFilter)==null?void 0:X.owner)==="own",mt=((K=r.targetFilter)==null?void 0:K.position)==="covered";if(Qe&&mt&&Oe===1){let it=`${ge} 1 of your covered cards`;((ne=r.destinationRestriction)==null?void 0:ne.type)==="non_matching_protocol"?it+=" to a line without a matching protocol":((Z=r.destinationRestriction)==null?void 0:Z.type)==="specific_lane"?it+=" within this line":((oe=r.destinationRestriction)==null?void 0:oe.type)==="to_another_line"&&(it+=" to another line"),c=it+".";break}if(((xe=r.targetFilter)==null?void 0:xe.owner)==="own"&&((ye=r.targetFilter)==null?void 0:ye.position)==="any"&&!((Ce=r.targetFilter)!=null&&Ce.excludeSelf)&&Oe===1){c=`${ge} this card, even if this card is covered`+".";break}if(Qe&&!mt&&!((pe=r.targetFilter)!=null&&pe.excludeSelf)&&Oe===1){c=`${ge} 1 of your cards`+".";break}let Je="";const ct=((_e=r.targetFilter)==null?void 0:_e.owner)==="opponent",ot=(ee=r.targetFilter)==null?void 0:ee.excludeSelf,ue=((je=r.targetFilter)==null?void 0:je.position)==="any";Qe&&ot?Je+="of your other ":ct?Je+="of your opponent's ":ot&&(Je+="other "),ue?Je+="covered or uncovered ":((de=r.targetFilter)==null?void 0:de.position)==="covered"&&(Je+="covered "),((Pe=r.targetFilter)==null?void 0:Pe.faceState)==="face_down"&&(Je+="face-down "),((Ue=r.targetFilter)==null?void 0:Ue.faceState)==="face_up"&&(Je+="face-up ");const Re=r.count==="all"?"all":"1";let dt=`${ge} ${Re} ${Je}${Qe&&ot||ct?"cards":Re==="1"?"card":"cards"}`;r.scope==="this_lane"&&(dt+=" in this line"),((se=r.destinationRestriction)==null?void 0:se.type)==="non_matching_protocol"?dt+=" to a line without a matching protocol":((re=r.destinationRestriction)==null?void 0:re.type)==="specific_lane"?dt+=" within this line":((ce=r.destinationRestriction)==null?void 0:ce.type)==="to_another_line"?dt+=" to another line":((he=r.destinationRestriction)==null?void 0:he.type)==="to_this_lane"?dt+=" to this line":((we=r.destinationRestriction)==null?void 0:we.type)==="to_or_from_this_lane"&&(dt+=" either to or from this line"),c=dt+".";break}case"delete":{if(((Se=r.advancedConditional)==null?void 0:Se.type)==="empty_hand"){const ot=r.count||1;c=`If you have no cards in hand, delete ${ot} card${ot!==1?"s":""}.`;break}if(((ke=r.advancedConditional)==null?void 0:ke.type)==="opponent_higher_value_in_lane"){const ot=r.count||1;c=`If your opponent has a higher total value than you do in this line, delete ${ot} card${ot!==1?"s":""}.`;break}if(t.useCardFromPreviousEffect){c="Delete that card.";break}if(r.deleteSelf){((Xe=r.protocolCountConditional)==null?void 0:Xe.type)==="unique_protocols_on_field_below"?c=`If there are not at least ${r.protocolCountConditional.threshold} different protocols on cards in the field, delete this card.`:((Le=r.advancedConditional)==null?void 0:Le.type)==="this_card_is_covered"?c="If this card is covered, delete this card.":c="Delete this card.";break}if(((be=r.laneCondition)==null?void 0:be.type)==="opponent_higher_value"){const ot=r.count||1,ue=((Me=r.targetFilter)==null?void 0:Me.owner)==="opponent"?"of your opponent's ":"";c=`Delete ${ot} ${ue}${ot===1?"card":"cards"} in a line where they have a higher total value than you do.`;break}let ge=r.optional?"You may delete ":"Delete ";const Oe=((Ne=r.targetFilter)==null?void 0:Ne.position)==="any",Qe=((Be=r.targetFilter)==null?void 0:Be.calculation)==="highest_value"||((Ye=r.targetFilter)==null?void 0:Ye.calculation)==="lowest_value",mt=((De=r.targetFilter)==null?void 0:De.owner)==="own"||((Ge=r.targetFilter)==null?void 0:Ge.owner)==="opponent",Ze=r.count===1&&Qe&&mt,Je=r.count===1&&Qe&&!mt;if(r.count==="all_in_lane"?ge+="all ":Ze||(Je?ge+="the ":ge+=Oe?"a ":`${r.count} `),Ze&&(((et=r.targetFilter)==null?void 0:et.owner)==="own"?ge+="your ":((tt=r.targetFilter)==null?void 0:tt.owner)==="opponent"&&(ge+="opponent's ")),((rt=r.targetFilter)==null?void 0:rt.calculation)==="highest_value"?ge+="highest value ":((ht=r.targetFilter)==null?void 0:ht.calculation)==="lowest_value"&&(ge+="lowest value "),(Rt=r.targetFilter)!=null&&Rt.valueRange){const{min:ot,max:ue}=r.targetFilter.valueRange,Re=[];for(let ze=ot;ze<=ue;ze++)Re.push(ze);const Fe=Re.join(" or ");ge+=`value ${Fe} `}Ze||(((Ft=r.targetFilter)==null?void 0:Ft.owner)==="own"?ge+="your ":((En=r.targetFilter)==null?void 0:En.owner)==="opponent"&&(ge+="opponent's ")),r.excludeSelf&&(ge+="other "),Oe?ge+="covered or uncovered ":(((fn=r.targetFilter)==null?void 0:fn.position)==="covered"||((Zt=r.targetFilter)==null?void 0:Zt.position)==="covered_by_context")&&(ge+="covered "),((nn=r.targetFilter)==null?void 0:nn.faceState)==="face_down"?ge+="face-down ":((un=r.targetFilter)==null?void 0:un.faceState)==="face_up"&&(ge+="face-up ");const ct=r.count===1?"card":"cards";ge+=ct,r.selectLane&&(ge+=" in 1 line"),r.protocolMatching==="must_match"?ge+=" in a line with a matching protocol":r.protocolMatching==="must_not_match"&&(ge+=" in a line without a matching protocol"),((jn=r.scope)==null?void 0:jn.type)==="this_line"?ge+=" in this line":((Xn=r.scope)==null?void 0:Xn.type)==="other_lanes"?ge+=" in other lanes":((xn=r.scope)==null?void 0:xn.type)==="each_other_line"&&(ge+=" from each other line"),((kn=r.targetFilter)==null?void 0:kn.valueSource)==="previous_effect_card"&&(ge+=" that shares a value with the discarded card"),c=ge+".";break}case"discard":{if(r.source==="top_deck_own"){c="Discard the top card of your deck.";break}if(r.source==="top_deck_opponent"){c="Discard the top card of your opponent's deck.";break}if(r.source==="entire_deck"){c="Discard your entire deck.";break}if(r.useCardFromPreviousEffect){r.actor==="opponent"?c="Opponent discards that card.":c="discard that card.";break}if(r.countType==="equal_to_discarded"){const Je=r.countOffset||0;r.actor==="opponent"?Je===1?c="Your opponent discards the amount of cards discarded plus 1.":Je===0?c="Your opponent discards the same amount of cards.":c=`Your opponent discards the amount discarded plus ${Je}.`:Je===1?c="Discard 1 more card than the amount discarded.":Je===0?c="Discard the same amount of cards.":c=`Discard the amount discarded plus ${Je}.`;break}const ge=r.variableCount;let Oe="";if(ge)Oe="1 or more cards";else if(r.count==="all")Oe="your hand";else{const Je=r.count===1?"card":"cards";Oe=`${r.count} ${Je}`}const Qe=r.optional?"You may discard":r.count==="all"||ge?"Discard":"You discard";if(r.actor==="both"){if(r.count==="all")c="Both players discard their hand.";else{const Je=r.count===1?"card":"cards";c=`Both players discard ${r.count} ${Je}.`}break}const Ze=(r.discardTo||"own_trash")==="opponent_trash"?" into their trash":"";if(r.actor==="opponent")if(r.count==="all")c=`Opponent discards their hand${Ze}.`;else if(r.random){const Je=r.count===1?"card":"cards";c=`Your opponent discards ${r.count} random ${Je}${Ze}.`}else c=`Your opponent discards ${Oe}${Ze}.`;else c=`${Qe} ${Oe}${Ze}.`;break}case"return":{if(((qn=r.advancedConditional)==null?void 0:qn.type)==="empty_hand"){c=`If you have no cards in hand, return ${yo(r)}.`;break}if(((Ya=r.advancedConditional)==null?void 0:Ya.type)==="opponent_higher_value_in_lane"){c=`If your opponent has a higher total value than you do in this line, return ${yo(r)}.`;break}if(r.returnSelf){(($a=r.advancedConditional)==null?void 0:$a.type)==="this_card_is_covered"?c=r.optional?"If this card is covered, you may return this card to hand.":"If this card is covered, return this card to hand.":c=r.optional?"You may return this card to hand.":"Return this card to hand.";break}if(t.useCardFromPreviousEffect){c="Return that card to hand.";break}const Oe=r.selectLane||!1?" in 1 line":"";if(((Pa=r.targetFilter)==null?void 0:Pa.valueEquals)!==void 0){c=`Return all cards with a value of ${r.targetFilter.valueEquals}${Oe}.`;break}const Qe=((qa=r.targetFilter)==null?void 0:qa.owner)||"any",mt=((Ea=r.targetFilter)==null?void 0:Ea.position)||"uncovered",Ze=(da=r.targetFilter)==null?void 0:da.faceState,Je=r.destination||"owner_hand";let ct="";mt==="any"?ct="covered or uncovered ":mt==="covered"&&(ct="covered ");let ot="";Ze==="face_down"?ot="face-down ":Ze==="face_up"&&(ot="face-up ");const ue=r.count,Re=ue===1?"card":"cards";let Fe="";if(Qe==="own"?Fe=`${ue==="all"?"all":ue} of your ${ct}${ot}${Re}`:Qe==="opponent"?Fe=`${ue==="all"?"all":ue} of your opponent's ${ct}${ot}${Re}`:Fe=ue==="all"?`all ${ct}${ot}cards`:`${ue} ${ct}${ot}${Re}`,Je==="actor_hand"&&Qe==="opponent"){c=`${r.optional?"You may p":"P"}ut ${Fe}${Oe} into your hand.`;break}c=`${r.optional?"You may r":"R"}eturn ${Fe}${Oe}.`;break}case"play":{if(((ua=r.advancedConditional)==null?void 0:ua.type)==="empty_hand"){c=`If you have no cards in hand, play ${yo(r)}.`;break}if(((La=r.advancedConditional)==null?void 0:La.type)==="opponent_higher_value_in_lane"){c=`If your opponent has a higher total value than you do in this line, play ${yo(r)}.`;break}if(t.useCardFromPreviousEffect){const Fe=r.faceDown===!0?"face-down":r.faceDown===!1?"face-up":"";let ze="";((Cn=r.destinationRule)==null?void 0:Cn.type)==="other_lines"&&(ze=" in another line"),c=Fe?`Play that card ${Fe}${ze}.`:`Play that card${ze}.`;break}if(r.source==="trash"){const Fe=r.count||1,ze=Fe===1?"card":"cards",it=(r.sourceOwner||"own")==="opponent"?"your opponent's trash":"your trash";c=`Play ${Fe} ${ze} from ${it}.`;break}const ge=r.actor,Oe=r.count||1,Qe=r.faceDown===!0?" face-down":r.faceDown===!1?" face-up":"",mt=r.sourceOwner||"own",Ze=r.targetBoard||"own";let Je="",ct="";const ot=((Vt=r.valueFilter)==null?void 0:Vt.equals)!==void 0?` with a value of ${r.valueFilter.equals}`:"";ge==="opponent"?(Je="Your opponent plays",r.source==="deck"?mt==="opponent"?ct=Oe===1?"the top card of your deck":`${Oe} cards from your deck`:ct=Oe===1?"the top card of their deck":`${Oe} cards from their deck`:ct=Oe===1?`a card${ot} from their hand`:`${Oe} cards${ot} from their hand`):(Je=r.optional?"You may play":"Play",r.source==="deck"?mt==="opponent"?ct=Oe===1?"the top card of your opponent's deck":`${Oe} cards from your opponent's deck`:ct=Oe===1?"the top card of your deck":`${Oe} cards from your deck`:ct=Oe===1?`1 card${ot}`:`${Oe} cards${ot}`);let ue="";((Yt=r.condition)==null?void 0:Yt.type)==="per_x_cards_in_line"&&(ue=`For every ${r.condition.cardCount||2} cards in this line, `,Je=Je.toLowerCase());let Re=`${ue}${Je} ${ct}${Qe}`;if(((Ln=r.destinationRule)==null?void 0:Ln.type)==="other_lines")Re+=" to other lines";else if(((pa=r.destinationRule)==null?void 0:pa.type)==="another_line")Re+=" in another line";else if(((Qa=r.destinationRule)==null?void 0:Qa.type)==="each_other_line")Re+=" in each other line";else if(((Xa=r.destinationRule)==null?void 0:Xa.type)==="under_this_card")Re+=" under this card";else if(((Ua=r.destinationRule)==null?void 0:Ua.type)==="each_line_with_card"){const Fe=r.destinationRule.ownerFilter,ze=r.destinationRule.cardFilter;(ze==null?void 0:ze.faceState)==="face_down"?Re+=" in each line with a face-down card":(ze==null?void 0:ze.faceState)==="face_up"?Re+=" in each line with a face-up card":Fe==="own"?Re+=" in each line where you have a card":Fe==="opponent"?Re+=" in each line where opponent has a card":Re+=" to each line with a card"}else if(((Zn=r.destinationRule)==null?void 0:Zn.type)==="line_with_matching_cards"){const Fe=r.destinationRule.cardFilter;(Fe==null?void 0:Fe.faceState)==="face_down"?Re+=" in a line with a face-down card":(Fe==null?void 0:Fe.faceState)==="face_up"?Re+=" in a line with a face-up card":Re+=" in a line with a card"}else((ja=r.destinationRule)==null?void 0:ja.type)==="specific_lane"&&(Re+=" in this line");Ze==="opponent"&&(Re+=" on your opponent's side"),r.excludeSourceProtocol&&(Re=Re.replace(/(\d+) card/,`$1 non-${s} card`)),c=Re+".";break}case"rearrange_protocols":case"swap_protocols":{const ge=r.target==="opponent"?"your opponent's":r.target==="both_sequential"?"both players'":"your";let Oe="";r.action==="rearrange_protocols"?Oe=`Rearrange ${ge} protocols`:Oe=`Swap the positions of 2 of ${ge} protocols`,r.restriction&&r.restriction.disallowedProtocol&&(Oe+=`. ${r.restriction.disallowedProtocol} cannot be on this line`),c=Oe+".";break}case"reveal":case"give":{if(t.useCardFromPreviousEffect){c=`${r.action==="give"?"Give":"Reveal"} that card.`;break}if(r.action,r.source==="board"){const ct=((Un=r.targetFilter)==null?void 0:Un.faceState)==="face_down"?"face-down ":"",ot=r.count||1;let Re=`Reveal ${ot} ${ct}${ot===1?"card":"cards"}`;r.optional?Re+=". You may shift or flip that card":r.followUpAction==="flip"?Re+=". Then flip it":r.followUpAction==="shift"&&(Re+=". Then shift it"),c=Re+".";break}if(r.source==="own_deck_top"){let ct="Reveal the top card of your deck";r.followUpAction==="may_discard"&&(ct+=". You may discard it"),c=ct+".";break}if(r.source==="own_deck"){c="Reveal your deck.";break}if(r.source==="own_trash"){const ct=r.count||1;c=`Reveal ${ct} ${ct===1?"card":"cards"} from your trash.`;break}if(((Rn=r.protocolFilter)==null?void 0:Rn.type)==="same_as_source"){c=`Reveal all ${s} cards in your hand.`;break}if(r.count===-1){r.source==="opponent_hand"?c=r.action==="reveal"?"Your opponent reveals their hand.":"Give your entire hand to your opponent.":c=r.action==="reveal"?"Reveal your hand.":"Give your entire hand.";break}const ge=r.count===1?"card":"cards",Oe=r.source==="opponent_hand"?"opponent's hand":"your hand",Qe=r.optional?"You may ":"",mt=r.action==="give"?"give":"reveal",Ze=r.action==="give"?"Give":"Reveal";let Je;r.optional?Je=`${Qe}${mt} ${r.count} ${ge} from ${Oe}`:Je=`${Ze} ${r.count} ${ge} from ${Oe}`,r.action==="give"&&r.source!=="opponent_hand"&&(Je+=" to your opponent"),r.followUpAction==="flip"?Je+=". Then flip it.":r.followUpAction==="shift"?Je+=". Then shift it.":Je+=".",c=Je;break}case"take":{const ge=r.count===1?"card":"cards",Oe=r.random!==!1?"random ":"";c=`Take ${r.count} ${Oe}${ge} from your opponent's hand.`;break}case"choice":{const ge=r.options||[];if(ge.length===0){c="Effect";break}if(ge.length===2){const Oe=ge.map(Qe=>{const mt={params:Qe.params};let Ze=dl(mt);return Ze.endsWith(".")&&(Ze=Ze.slice(0,-1)),Ze=Ze.charAt(0).toLowerCase()+Ze.slice(1),Ze});((On=r.advancedConditional)==null?void 0:On.type)==="same_protocol_on_field"?c=`If there is another ${s} card in the field, either ${Oe[0]} or ${Oe[1]}.`:c=`Either ${Oe[0]} or ${Oe[1]}.`}else c="Effect";break}case"passive_rule":{const ge=r.rule;switch(ge==null?void 0:ge.type){case"require_non_matching_protocol":c="Cards can only be played without matching protocols.";break;case"block_all_play":ge.target==="opponent"?c="Your opponent cannot play cards in this line.":ge.target==="self"?c="You cannot play cards in this line.":c="Cards cannot be played in this line.";break;case"ignore_middle_commands":if(ge.onlyDuringYourTurn&&ge.target==="opponent"&&ge.scope==="global")c="During your turn, your opponent's cards do not have middle commands.";else if(ge.onlyDuringYourTurn){const Oe=ge.target==="opponent"?"your opponent's ":ge.target==="self"?"your ":"",Qe=ge.scope==="global"?"":" in this line";c=`During your turn, ignore all middle commands of ${Oe}cards${Qe}.`}else c="Ignore all middle commands of cards in this line.";break;case"block_face_down_play":c="Opponent can't play cards face-down in this line.";break;case"require_face_down_play":c=ge.scope==="global"?"Your opponent can only play cards face-down.":"Opponent can only play cards face-down in this line.";break;case"allow_any_protocol_play":c="You may play cards without matching protocols.";break;case"allow_play_on_opponent_side":c="You may play this card in any line on either player's side.";break;case"block_flips":c=ge.scope==="global"?"Cards cannot be flipped face-up.":"Cards can't be flipped face-up in this line.";break;case"block_protocol_rearrange":c="Protocols can't be rearranged.";break;case"block_shifts_from_lane":c="Cards can't shift from this line.";break;case"block_shifts_to_lane":c="Cards can't shift to this line.";break;case"block_shifts_from_and_to_lane":c="Cards cannot shift from or to this line.";break;case"skip_check_cache_phase":c="Skip check cache phase.";break;case"block_flip_this_card":c="This card cannot be flipped.";break;case"allow_same_protocol_face_up_play":c=`${s} cards may be played face-up in this line.`;break;case"block_draw_conditional":{const Oe=ge.conditionTarget||"self",Qe=ge.blockTarget||"self",mt=Oe==="self"?"you have":"your opponent has";let Ze;Qe==="self"?Ze="you cannot draw":Qe==="opponent"?Ze="your opponent cannot draw":Ze="neither player can draw",c=`If ${mt} any cards in hand, ${Ze} cards.`;break}default:c="Passive rule effect."}break}case"value_modifier":{const ge=r.modifier;switch(ge==null?void 0:ge.type){case"add_per_condition":{const Oe=ge.scope==="this_lane"?"in this line":"",Qe=ge.target==="own_total"?"Your total value":ge.target==="opponent_total"?"Your opponent's total value":"Total value";let mt="",Ze="";ge.condition==="per_face_down_card"?(mt="for each face-down card",Ze=Oe):ge.condition==="per_face_up_card"?(mt="for each face-up card",Ze=Oe):ge.condition==="per_card"?(mt="for each card",Ze=Oe):ge.condition==="per_card_in_hand"?mt="for each card in your hand":ge.condition==="per_opponent_card_in_lane"&&(mt="for each of your opponent's cards",Ze=Oe);const Je=Math.abs(ge.value),ct=ge.value>=0?"increased":"reduced";c=`${Qe} ${Oe} is ${ct} by ${Je} ${mt} ${Ze}.`.replace(/\s+/g," ").trim();break}case"set_to_fixed":{let Oe="";ge.target==="own_cards"?Oe="your":ge.target==="opponent_cards"?Oe="opponent's":Oe="all";let Qe="";((Nn=ge.filter)==null?void 0:Nn.faceState)==="face_down"?Qe=" face-down":((Ot=ge.filter)==null?void 0:Ot.faceState)==="face_up"&&(Qe=" face-up");let mt="";ge.scope==="this_lane"&&(mt=" in this stack"),c=`All ${Oe}${Qe} cards${mt} have a value of ${ge.value}.`;break}case"add_to_total":{const Oe=ge.scope==="this_lane"?" in this line":"",Qe=ge.condition==="has_non_own_protocol_face_up"?` if there are any non-${s} face-up cards in this stack`:"";ge.target==="opponent_total"?ge.value<0?c=`Your opponent's total value${Oe} is reduced by ${Math.abs(ge.value)}${Qe}.`:c=`Your opponent's total value${Oe} is increased by ${ge.value}${Qe}.`:ge.value<0?c=`Your total value${Oe} is reduced by ${Math.abs(ge.value)}${Qe}.`:c=`Your total value${Oe} is increased by ${ge.value}${Qe}.`;break}default:c="Value modifier effect."}break}case"block_compile":{c=`${r.target==="opponent"?"Your opponent":"You"} cannot compile next turn.`;break}case"delete_all_in_lane":{const ge=((ka=r.laneCondition)==null?void 0:ka.count)||8;c=`Delete all cards in ${r.excludeCurrentLane?"1 other line":"1 line"} with ${ge} or more cards.`;break}case"modify_value":{const ge=r.modifier||0,Oe=r.target==="opponent"?"Your opponent's":"Your",Qe=ge<0?`reduced by ${Math.abs(ge)}`:`increased by ${ge}`;c=`${Oe} total value in this line is ${Qe}.`;break}case"block_play_face_down":{c="Your opponent cannot play cards face-down in this line.";break}case"shuffle_trash":{let Oe=`${r.optional!==!1?"You may shuffle":"Shuffle"} your trash into your deck.`;((Ra=r.advancedConditional)==null?void 0:Ra.type)==="trash_not_empty"&&(Oe=`If there are any cards in your trash, ${Oe.charAt(0).toLowerCase()+Oe.slice(1)}`),c=Oe;break}case"shuffle_deck":{c="Shuffle your deck.";break}case"redirect_return_to_deck":{c=`Put that card on top of their deck ${r.faceDown!==!1?"face-down ":""}instead.`;break}case"state_number":{c="State a number.";break}case"state_protocol":{c="State a protocol.";break}case"swap_stacks":{c="Swap all of your cards in one of your stacks with another one of your stacks.";break}case"copy_opponent_middle":{c=`${r.optional?"You may resolve":"Resolve"} the middle command of 1 of your opponent's cards as if it were on this card.`;break}case"auto_compile":{if(((Sn=r.protocolCountConditional)==null?void 0:Sn.type)==="unique_protocols_on_field")c=`If there are ${r.protocolCountConditional.threshold} different protocols on cards in the field, compile this protocol.`;else if(((Tn=r.protocolCountConditional)==null?void 0:Tn.type)==="same_protocol_count_on_field"){const ge=r.protocolCountConditional.threshold,Oe=r.protocolCountConditional.faceState==="face_up"?"face-up ":"",Qe=r.deleteAllInLane?" and delete all cards in this line":"";c=`If there are ${ge} or more ${Oe}${s} cards in the field, compile this protocol${Qe}.`}else c="Compile this protocol.";break}case"card_property":{r.property==="ignore_protocol_matching"?c="This card may be played without matching protocols.":c="Card property.";break}default:c="Effect";break}if(t.conditional&&t.conditional.thenEffect){let ge=dl(t.conditional.thenEffect);const Oe=t.conditional.thenEffect.params;Oe!=null&&Oe.useCardFromPreviousEffect&&(ge=ge.replace(/\d+ cards?/i,"that card")),t.conditional.type==="then"?c=`${c.endsWith(".")?c.slice(0,-1):c}, then ${ge.toLowerCase()}`:t.conditional.type==="optional"?c=`${c.endsWith(".")?c.slice(0,-1):c}. You may ${ge.toLowerCase()}`:t.conditional.type==="if_protocol_matches_stated"?c=`${c} If the discarded card matches the stated protocol, ${ge.toLowerCase()}`:c=`${c} If you do, ${ge.toLowerCase()}`}return c},Tw=t=>{const n={};for(const r of t){const c=r.params.action;c==="draw"&&(n.draw=!0),c==="flip"&&(n.flip=!0),c==="shift"&&(n.shift=!0),c==="delete"&&(n.delete=!0),c==="discard"&&(n.discard=!0),c==="return"&&(n.return=!0),c==="play"&&(n.play=!0),c==="reveal"&&(n.reveal=!0),c==="give"&&(n.give=!0),c==="take"&&(n.take=!0)}return n},xr=(t,n)=>t.length===0?"":t.map(r=>{var d;const s=dl(r,n),c=r.trigger;if(c==="start")return`<div><span class='emphasis'>Start:</span> ${s}</div>`;if(c==="end")return`<div><span class='emphasis'>End:</span> ${s}</div>`;if(c==="on_cover")return r.onCoverProtocolRestriction==="same_protocol"?`<div><span class='emphasis'>When this card would be covered by another ${(n==null?void 0:n.protocolName)||"[protocol]"} card:</span> First, ${s.toLowerCase()}</div>`:`<div><span class='emphasis'>When this card would be covered:</span> First, ${s.toLowerCase()}</div>`;if(c==="on_flip")return`<div><span class='emphasis'>When this card would be flipped:</span> First, ${s.toLowerCase()}</div>`;if(c==="on_cover_or_flip")return`<div><span class='emphasis'>When this card would be covered or flipped:</span> First, ${s.toLowerCase()}</div>`;if(c==="after_draw"||c==="after_delete"||c==="after_discard"||c==="after_shift"||c==="after_flip"||c==="after_clear_cache"){const u=r.reactiveTriggerActor||"self",p=u==="self"?"you":u==="opponent"?"opponent":"a card is";let f="";c==="after_draw"?f=u==="any"?"drawn":"draw cards":c==="after_delete"?f=u==="any"?"deleted":"delete cards":c==="after_discard"?f=u==="any"?"discarded":"discard cards":c==="after_shift"?f=u==="any"?"shifted":"shift cards":c==="after_flip"?f=u==="any"?"flipped":"flip cards":c==="after_clear_cache"&&(f="clear cache");const h=r.onlyDuringOpponentTurn?" during your opponent's turn":"";return`<div><span class='emphasis'>${`After ${p} ${f}${h}`}:</span> ${s}</div>`}if(c==="after_opponent_discard")return`<div><span class='emphasis'>After your opponent discards cards:</span> ${s}</div>`;if(c==="after_opponent_draw")return`<div><span class='emphasis'>After your opponent draws cards:</span> ${s}</div>`;if(c==="after_refresh"){const u=r.reactiveTriggerActor||"self";let p="After you refresh:";return u==="opponent"?p="After your opponent refreshes:":u==="any"&&(p="After a player refreshes:"),`<div><span class='emphasis'>${p}</span> ${s}</div>`}if(c==="after_opponent_refresh")return`<div><span class='emphasis'>After your opponent refreshes:</span> ${s}</div>`;if(c==="after_compile")return`<div><span class='emphasis'>After you compile:</span> ${s}</div>`;if(c==="after_opponent_compile")return`<div><span class='emphasis'>After your opponent compiles:</span> ${s}</div>`;if(c==="after_shuffle"){const u=r.reactiveTriggerActor||"self";let p="After you shuffle your deck:";return u==="opponent"?p="After your opponent shuffles their deck:":u==="any"&&(p="After any player shuffles their deck:"),`<div><span class='emphasis'>${p}</span> ${s}</div>`}if(c==="after_play"){const u=r.reactiveTriggerActor||"self",p=r.reactiveScope||"global";return u==="opponent"&&p==="this_lane"?`<div><span class='emphasis'>After your opponent plays a card in this line:</span> ${s}</div>`:u==="opponent"?`<div><span class='emphasis'>After your opponent plays a card:</span> ${s}</div>`:p==="this_lane"?`<div><span class='emphasis'>After you play a card in this line:</span> ${s}</div>`:`<div><span class='emphasis'>After you play a card:</span> ${s}</div>`}return c==="before_compile_delete"?`<div><span class='emphasis'>When this card would be deleted by compiling:</span> ${s}</div>`:c==="when_card_returned"?`<div><span class='emphasis'>When a card would be returned to ${(((d=r.params)==null?void 0:d.targetOwner)||"opponent")==="opponent"?"your opponent's":"your"} hand:</span> ${s}</div>`:s}).join(" "),Dw=(t,n)=>{var h,y,m;const r={protocolName:n.name},s=((h=t.text)==null?void 0:h.top)!==void 0?t.text.top:xr(t.topEffects,r),c=((y=t.text)==null?void 0:y.middle)!==void 0?t.text.middle:xr(t.middleEffects,r),d=((m=t.text)==null?void 0:m.bottom)!==void 0?t.text.bottom:xr(t.bottomEffects,r),u=[...t.topEffects,...t.middleEffects,...t.bottomEffects],p=Tw(u);return{protocol:n.name,value:t.value,top:s,middle:c,bottom:d,keywords:p,category:n.category||"Custom",color:n.color,pattern:n.pattern,customEffects:{topEffects:t.topEffects,middleEffects:t.middleEffects,bottomEffects:t.bottomEffects}}},Aw=t=>t.cards.map(n=>Dw(n,t)),er=()=>{try{const t=localStorage.getItem("custom_protocols_v1");if(!t)return[];const r=JSON.parse(t).protocols||[],s=[];for(const c of r){const d=Aw(c);s.push(...d)}return s}catch(t){return console.error("Failed to load custom protocol cards:",t),[]}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const cy="custom_protocols_v1",_u=1,jr=()=>{try{const t=localStorage.getItem(cy);if(!t)return[];const n=JSON.parse(t);return n.version!==_u&&console.warn(`Custom protocol storage version mismatch: expected ${_u}, got ${n.version}`),n.protocols||[]}catch(t){return console.error("Error loading custom protocols:",t),[]}},Tu=t=>{try{const n={protocols:t,version:_u};localStorage.setItem(cy,JSON.stringify(n))}catch(n){console.error("Error saving custom protocols:",n)}},kt=t=>{const n=jr(),r=n.findIndex(s=>s.id===t.id);r>=0?n[r]=t:n.push(t),Tu(n)},Fw=t=>{const r=jr().filter(s=>s.id!==t);Tu(r)},Iw=["anarchy-custom-001","apathy_custom","assimilation-custom-001","chaos_custom_1","clarity-custom-001","corruption-custom-001","courage-custom-001","darkness_custom_v1","death_custom_v1","diversity-custom-001","fear_custom","fire-custom-001","frost_custom_1","gravity_custom_1","hate-custom-001","ice_custom","life_custom_1","light_custom_1","love_custom_v1","luck-custom-001","metal_custom_1","mirror-custom-001","peace-custom-001","plague-custom-001","psychic_custom_v1","smoke-custom-001","speed_custom_1","spirit_custom_1","time-custom-001","unity-custom-001","war-custom-001","water_custom_1"],hl=t=>Iw.includes(t.id),$w=(t,n)=>{const r=(c,d)=>{c=c.replace("#","");const u=parseInt(c.substring(0,2),16),p=parseInt(c.substring(2,4),16),f=parseInt(c.substring(4,6),16);return`rgba(${u}, ${p}, ${f}, ${d})`},s={borderColor:n};switch(t){case"solid":return{...s,backgroundColor:n};case"radial":return{...s,backgroundColor:"var(--surface-color)",backgroundImage:`radial-gradient(circle at 50% 50%, ${r(n,.25)} 0%, transparent 60%)`};case"dual-radial":return{...s,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 0% 0%, ${r(n,.2)}, transparent 50%),
                    radial-gradient(at 100% 100%, ${r(n,.2)}, transparent 50%)
                `};case"multi-radial":return{...s,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 0%, ${r(n,.2)}, transparent 70%),
                    radial-gradient(circle at 20% 30%, ${r(n,.15)}, transparent 40%),
                    radial-gradient(circle at 80% 70%, ${r(n,.2)}, transparent 50%)
                `};case"chaos":return{...s,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 10% 10%, hsla(60, 100%, 50%, 0.15), transparent 30%),
                    radial-gradient(at 90% 20%, hsla(180, 100%, 50%, 0.15), transparent 35%),
                    radial-gradient(at 30% 80%, hsla(300, 100%, 50%, 0.15), transparent 40%),
                    radial-gradient(at 70% 60%, hsla(0, 100%, 50%, 0.1), transparent 25%)
                `};case"grid":return{...s,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(circle at 50% 50%, ${r(n,.2)} 0%, transparent 40%),
                    linear-gradient(hsla(0,0%,100%,0.03) 1px, transparent 1px),
                    linear-gradient(90deg, hsla(0,0%,100%,0.03) 1px, transparent 1px)
                `,backgroundSize:"100% 100%, 20px 20px, 20px 20px"};case"diagonal-lines":return{...s,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 0% 100%, ${r(n,.25)}, transparent 70%),
                    repeating-linear-gradient(120deg, transparent, transparent 15px, ${r(n,.05)} 15px, ${r(n,.05)} 30px)
                `};case"cross-diagonal":return{...s,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 50%, ${r(n,.25)} 0%, transparent 50%),
                    repeating-linear-gradient(45deg, transparent, transparent 8px, ${r(n,.08)} 8px, ${r(n,.08)} 16px),
                    repeating-linear-gradient(-45deg, transparent, transparent 8px, ${r(n,.06)} 8px, ${r(n,.06)} 16px)
                `};case"horizontal-lines":return{...s,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 80% 80%, ${r(n,.1)}, transparent 50%),
                    repeating-linear-gradient(0deg, hsla(0,0%,100%,0.02), hsla(0,0%,100%,0.02) 1px, transparent 1px, transparent 3px)
                `};case"vertical-lines":return{...s,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 10% 10%, ${r(n,.2)}, transparent 50%),
                    repeating-linear-gradient(175deg, transparent, transparent 1px, ${r(n,.05)} 1px, ${r(n,.05)} 2px)
                `};case"cross":return{...s,backgroundColor:"var(--surface-color)",backgroundImage:`
                    linear-gradient(0deg, transparent 40%, ${r(n,.1)} 50%, transparent 60%),
                    linear-gradient(90deg, transparent 48%, ${r(n,.2)} 50%, transparent 52%)
                `};case"hexagons":return{...s,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 0%, ${r(n,.2)}, transparent 70%),
                    url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='28' height='49' viewBox='0 0 28 49'%3E%3Cg fill-rule='evenodd'%3E%3Cg id='hexagons' fill='${encodeURIComponent(n)}' fill-opacity='0.05' fill-rule='nonzero'%3E%3Cpath d='M13.99 9.25l13 7.5v15l-13 7.5L1 31.75v-15l12.99-7.5zM3 17.9v12.7l10.99 6.34 11-6.35V17.9l-11-6.34L3 17.9zM0 15l12.99-7.5L26 15v18.5l-13 7.5L0 33.5V15z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")
                `};case"stripes":return{...s,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 100%, ${r(n,.25)}, transparent 60%),
                    linear-gradient(135deg, hsla(0,0%,0%,0.1) 23%, transparent 23%, transparent 25%, hsla(0,0%,0%,0.1) 25%, hsla(0,0%,0%,0.1) 27%, transparent 27%, transparent 73%, hsla(0,0%,0%,0.1) 73%, hsla(0,0%,0%,0.1) 75%, transparent 75%, transparent 77%, hsla(0,0%,0%,0.1) 77%)
                `};default:return{...s,backgroundColor:n}}},Pw=({protocols:t,onCreateNew:n,onEdit:r,onDelete:s,onImport:c,onBack:d})=>{const[u,p]=J.useState(!1),[f,h]=J.useState(!1),[y,m]=J.useState(""),[g,v]=J.useState(""),C=u?t:t.filter(x=>!hl(x)),b=()=>{v("");try{const x=JSON.parse(y);if(!x.name||!x.color||!x.pattern||!Array.isArray(x.cards)){v("Invalid protocol format. Missing required fields.");return}if(x.cards.length!==6){v("Invalid protocol: must have exactly 6 cards.");return}const j=t.find(E=>E.name.toLowerCase()===x.name.toLowerCase());if(j){confirm(`A protocol named "${x.name}" already exists. Overwrite it?`)&&(x.id=j.id,c(x),h(!1),m(""),alert("Protocol imported and overwritten successfully!"));return}x.id=Date.now().toString(),x.createdAt=new Date().toISOString(),c(x),h(!1),m(""),alert("Protocol imported successfully!")}catch{v("Invalid JSON format. Please check your input.")}};return o.jsxs("div",{className:"protocol-list",children:[o.jsxs("div",{className:"list-header",children:[o.jsx("h2",{children:"Custom Protocols"}),o.jsxs("div",{className:"header-actions",children:[o.jsxs("label",{className:"system-protocols-toggle",children:[o.jsx("input",{type:"checkbox",checked:u,onChange:x=>p(x.target.checked)}),"Show System Protocols"]}),o.jsx("button",{onClick:()=>h(!0),className:"btn",children:"Import Protocol"}),d&&o.jsx("button",{onClick:d,className:"btn btn-back",children:"Back"})]})]}),f&&o.jsx("div",{className:"custom-protocol-modal-overlay",onClick:()=>h(!1),children:o.jsxs("div",{className:"custom-protocol-modal-content",onClick:x=>x.stopPropagation(),children:[o.jsx("h3",{children:"Import Protocol"}),o.jsx("p",{children:"Paste the protocol JSON below:"}),o.jsx("textarea",{value:y,onChange:x=>m(x.target.value),placeholder:'{"name":"Protocol Name","color":"#1976D2",...}',rows:10,className:"import-textarea"}),g&&o.jsx("div",{className:"error-message",children:g}),o.jsxs("div",{className:"custom-protocol-modal-actions",children:[o.jsx("button",{onClick:()=>h(!1),className:"btn btn-back",children:"Cancel"}),o.jsx("button",{onClick:b,className:"btn",children:"Import"})]})]})}),o.jsxs("div",{className:"protocols-grid",children:[o.jsxs("div",{className:"protocol-card new-protocol-card",onClick:n,children:[o.jsx("div",{className:"protocol-header new-protocol-header",children:o.jsxs("div",{className:"protocol-header-content",children:[o.jsx("h3",{children:"+ New Protocol"}),o.jsx("p",{className:"header-description",children:"Create a custom protocol"})]})}),o.jsx("div",{className:"protocol-body new-protocol-body"})]}),C.map(x=>{const j=hl(x);return o.jsx("div",{className:`protocol-card ${j?"system-protocol":""}`,style:$w(x.pattern,x.color),onClick:()=>r(x),children:o.jsxs("div",{className:"protocol-header-content",children:[o.jsx("h3",{children:x.name}),j&&o.jsx("span",{className:"system-badge",children:"System"}),x.description&&o.jsx("p",{className:"header-description",children:x.description})]})},x.id)})]})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const iy="customProtocolsEnabled";function Du(){try{return localStorage.getItem(iy)==="true"}catch{return!1}}function qw(t){try{localStorage.setItem(iy,t?"true":"false")}catch{}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */let Pc=null;function Lw(){if(!Pc){const t=Du(),n=er(),r=jr(),s=new Set(r.filter(c=>hl(c)).map(c=>c.name));Pc=n.filter(c=>s.has(c.protocol)||t)}return Pc}function hs(){Pc=null}function go(t){const n=Lw(),r=[];for(const s of t){const c=n.filter(d=>d.protocol===s);r.push(...c)}return r}function Yn(t){const n=[...t];for(let r=n.length-1;r>0;r--){const s=Math.floor(Math.random()*(r+1));[n[r],n[s]]=[n[s],n[r]]}return n}function Am({onNavigate:t,difficulty:n,setDifficulty:r,useControl:s,onUseControlChange:c}){const[d,u]=J.useState(null),[p,f]=J.useState(null),[h,y]=J.useState(null),[m,g]=J.useState([]),[v,C]=J.useState(!0),[b,x]=J.useState(0);J.useEffect(()=>{const E=new Set;for(;E.size<2&&E.size<la.length;)E.add(Math.floor(Math.random()*la.length));const k=Array.from(E).map(R=>la[R]);k.length>0&&(y(k[0]),f(k[0])),k.length>1&&u(k[1]),g(Yn(la))},[]);const j=()=>{const E=b+1;if(x(E),E>=5){const k=!v;C(k),qw(k),x(0)}};return o.jsxs("div",{className:"screen main-menu",children:[o.jsx("h1",{children:"COMPILE: MAIN 1 & 2"}),o.jsxs("div",{className:"main-menu-attribution",children:[o.jsxs("p",{children:["based on the card game ",o.jsx("a",{href:"https://boardgamegeek.com/boardgame/406652/compile-main-1",target:"_blank",rel:"noopener noreferrer",children:"Compile: Main 1"})," designed by ",o.jsx("a",{href:"https://justgravyllc.com/",target:"_blank",rel:"noopener noreferrer",children:"Michael Yang"})]}),o.jsxs("p",{children:[o.jsx("span",{onClick:j,style:{cursor:"default",userSelect:"none"},children:"developed"})," by ",o.jsx("a",{href:"https://apo-games.de/",target:"_blank",rel:"noopener noreferrer",children:"Dirk Aporius"})]})]}),o.jsxs("div",{className:"main-menu-layout",children:[o.jsx("div",{className:"main-menu-preview decorative-card",children:p&&o.jsx(St,{card:{...p,id:"preview",isFaceUp:!0},isFaceUp:!0})}),o.jsxs("div",{className:"main-menu-actions-container",children:[o.jsxs("div",{className:"main-menu-start-group",children:[o.jsxs("div",{className:"difficulty-selector",children:[o.jsx("h3",{className:"difficulty-title",children:"Difficulty"}),o.jsxs("div",{className:"difficulty-options",children:[o.jsx("button",{className:`btn ${n==="easy"?"active":""}`,onClick:()=>r("easy"),children:"Easy"}),o.jsx("button",{className:`btn ${n==="normal"?"active":""}`,onClick:()=>r("normal"),children:"Normal"}),o.jsx("button",{className:`btn btn-wip ${n==="hard"?"active":""}`,disabled:!0,children:"Hard"})]})]}),o.jsxs("div",{className:"control-mechanic-selector",children:[o.jsx("input",{type:"checkbox",id:"control-mechanic",checked:s,onChange:E=>c(E.target.checked)}),o.jsx("label",{htmlFor:"control-mechanic",children:"Use Control Mechanic"})]}),o.jsx("button",{className:"btn btn-start",onClick:()=>t("ProtocolSelection"),children:"Start Game"})]}),o.jsxs("div",{className:"main-menu-other-actions",children:[o.jsx("button",{className:"btn",onClick:()=>t("CardLibrary"),children:"Cards"}),o.jsx("button",{className:"btn",onClick:()=>t("Statistics"),children:"Statistics"}),v&&o.jsx("button",{className:"btn",onClick:()=>t("CustomProtocols"),children:"Custom Protocols"}),o.jsx("button",{className:"btn",onClick:()=>t("Rules"),children:"Rules"}),o.jsx("p",{className:"version-info",children:"Version 0.30"})]})]}),o.jsx("div",{className:"decorative-card decorative-card-right",children:d&&o.jsx(St,{card:{...d,id:"deco-2",isFaceUp:!0},isFaceUp:!0})})]}),o.jsx("div",{className:"card-ticker-container",onPointerLeave:()=>f(h),children:o.jsxs("div",{className:"card-ticker-track",children:[m.map((E,k)=>o.jsx(St,{card:{...E,id:`ticker-1-${k}`,isFaceUp:!0},isFaceUp:!0,additionalClassName:"in-hand",onPointerEnter:()=>f(E)},`ticker-1-${k}`)),m.map((E,k)=>o.jsx(St,{card:{...E,id:`ticker-2-${k}`,isFaceUp:!0},isFaceUp:!0,additionalClassName:"in-hand",onPointerEnter:()=>f(E)},`ticker-2-${k}`))]})})]})}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function Gc({title:t,onBack:n}){return o.jsxs("header",{className:"app-header",children:[o.jsx("h2",{children:t}),n&&o.jsx("button",{className:"btn btn-back",onClick:n,children:"Back"})]})}const Dc=[{player:"Player",picks:1},{player:"Opponent",picks:2},{player:"Player",picks:2},{player:"Opponent",picks:1}];function Uw({onBack:t,onStartGame:n}){const[r,s]=J.useState(0),[c,d]=J.useState([]),[u,p]=J.useState([]),[f,h]=J.useState([]),[y,m]=J.useState(!1),[g,v]=J.useState(null),[C,b]=J.useState(null),[x,j]=J.useState(0);J.useEffect(()=>{hs(),j(K=>K+1)},[]);const E=J.useMemo(()=>{const K=Du(),ne=er(),Z=jr(),oe=new Set(Z.filter(ye=>hl(ye)).map(ye=>ye.name));return ne.filter(ye=>oe.has(ye.protocol)||K)},[x]),k=J.useMemo(()=>{const K=new Set(E.map(ne=>ne.protocol));return Array.from(K).sort()},[E]),R=J.useMemo(()=>{const K=new Set(E.map(ne=>ne.category));return Array.from(K).sort()},[E]),D=["Fan-Content","Main 2","Aux 2"],[L,I]=J.useState(new Set),[F,U]=J.useState(!1);J.useEffect(()=>{if(R.length>0&&!F){const K=new Set(R);D.forEach(ne=>K.delete(ne)),I(K),U(!0)}},[R,F]);const B=K=>{const ne=E.find(Z=>Z.protocol===K);return(ne==null?void 0:ne.category)||""},G=K=>{const Z=E.find(oe=>oe.protocol===K);return Z!=null&&Z.color?{"--card-custom-color":Z.color,borderColor:Z.color}:{}},W=K=>{const Z=E.find(oe=>oe.protocol===K);return Z!=null&&Z.pattern?`pattern-${Z.pattern}`:""},P=J.useMemo(()=>k.filter(K=>{const ne=B(K);return L.has(ne)}),[L]),z=K=>{I(ne=>{const Z=new Set(ne);return Z.has(K)?Z.delete(K):Z.add(K),Z})},H=Dc[r],A=(H==null?void 0:H.player)==="Player",N=(H==null?void 0:H.player)==="Opponent",T=J.useMemo(()=>new Set([...c,...u]),[c,u]),q=J.useMemo(()=>f.map(K=>({name:K,cards:E.filter(ne=>ne.protocol===K).sort((ne,Z)=>ne.value-Z.value)})),[f]),O=K=>{if(!A||y)return;const ne=E.filter(Z=>Z.protocol===K).sort((Z,oe)=>Z.value-oe.value);ne.length>0&&b(ne[0]),h(Z=>{if(Z.includes(K))return Z.filter(oe=>oe!==K);if(Z.length<H.picks)return[...Z,K];if(Z.length===H.picks){const oe=Z.slice(1);return oe.push(K),oe}return Z})},M=async()=>{if(!A||y||f.length!==H.picks)return;m(!0);const K=[...f];h([]);for(const ne of K)d(Z=>[...Z,ne]),await new Promise(Z=>setTimeout(Z,300));m(!1),s(ne=>ne+1)};J.useEffect(()=>{N&&!y&&r<Dc.length&&(async()=>{m(!0),await new Promise(pe=>setTimeout(pe,100));const ne=[],Z=k.filter(pe=>{if(T.has(pe))return!1;const _e=B(pe);return L.has(_e)}),oe=k.filter(pe=>!T.has(pe)),xe=Z.length>=H.picks?[...Z]:[...oe],ye=[],Ce=ne.filter(pe=>xe.includes(pe));for(let pe=0;pe<H.picks;pe++)if(Ce.length>0){const _e=Ce.shift();ye.push(_e);const ee=xe.indexOf(_e);ee>-1&&xe.splice(ee,1)}else if(xe.length>0){const _e=Math.floor(Math.random()*xe.length);ye.push(xe.splice(_e,1)[0])}for(const pe of ye)await new Promise(_e=>setTimeout(_e,1e3)),v(pe),await new Promise(_e=>setTimeout(_e,1e3)),v(null),p(_e=>[..._e,pe]);m(!1),s(pe=>pe+1)})()},[r,N,y,T,H,L,k,B]),J.useEffect(()=>{r>=Dc.length&&!y&&setTimeout(()=>{n(c,u)},1e3)},[r,y,n,c,u]);const Y=K=>{const ne=["protocol-card",`card-protocol-${K.toLowerCase()}`];return f.includes(K)&&ne.push("selected"),T.has(K)&&ne.push("chosen"),g===K&&ne.push("is-scanning"),ne.join(" ")},X=()=>y&&N?"Opponent is selecting protocols...":(H==null?void 0:H.player)==="Player"?`Player, select ${H.picks} protocol(s). (${f.length}/${H.picks})`:r>=Dc.length?"Finalizing selections...":"Waiting for Opponent...";return o.jsxs("div",{className:"screen protocol-selection-screen",children:[o.jsx(Gc,{title:"Protocol Selection",onBack:t}),o.jsxs("div",{className:"protocol-selection-layout",children:[o.jsxs("div",{className:"protocol-selection-sidebar",children:[o.jsxs("div",{className:"player-protocols-area",children:[o.jsx("h3",{children:"Your Protocols"}),c.map(K=>o.jsx("div",{className:`protocol-display-card player card-protocol-${K.toLowerCase()} ${W(K)}`,style:G(K),children:K},K))]}),o.jsx("div",{className:"protocol-preview-area",children:C?o.jsx(St,{card:{...C,id:"preview",isFaceUp:!0},isFaceUp:!0}):o.jsx("p",{children:q.length>0?"Hover over a card below to see details.":"Select a protocol to see its cards."})})]}),o.jsxs("div",{className:"protocol-grid-container",children:[o.jsx("p",{children:X()}),o.jsx("div",{className:"category-filters",children:R.map(K=>o.jsxs("label",{className:"category-filter-item",children:[o.jsx("input",{type:"checkbox",checked:L.has(K),onChange:()=>z(K)}),o.jsx("span",{children:K})]},K))}),o.jsx("div",{className:"protocol-grid-scroll-wrapper",children:o.jsx("div",{className:"protocol-grid",children:P.map(K=>{const ne=G(K),oe={fontSize:K.length>10?"0.65em":"1em"};return o.jsxs("div",{className:`${Y(K)} ${W(K)}`,style:ne,onClick:()=>O(K),role:"button","aria-disabled":T.has(K)||!A||y,tabIndex:!T.has(K)&&A&&!y?0:-1,onKeyPress:xe=>xe.key==="Enter"&&O(K),children:[o.jsx("span",{className:"protocol-category-label",children:B(K)}),o.jsx("span",{className:"protocol-name",style:oe,children:K})]},K)})})}),A&&o.jsx("button",{className:"btn",onClick:M,disabled:y||f.length!==(H==null?void 0:H.picks),children:"Confirm Selection"})]}),o.jsxs("div",{className:"opponent-protocols-area",children:[o.jsx("h3",{children:"Opponent Protocols"}),u.map(K=>o.jsx("div",{className:`protocol-display-card opponent card-protocol-${K.toLowerCase()} ${W(K)}`,style:G(K),children:K},K))]})]}),o.jsx("div",{className:"selected-protocol-cards-container",children:q.length>0&&[...q].reverse().map(K=>o.jsx("div",{className:"protocol-card-row",children:K.cards.map(ne=>o.jsx(St,{card:{...ne,id:`selection-${ne.protocol}-${ne.value}`,isFaceUp:!0},isFaceUp:!0,additionalClassName:"in-hand",onClick:()=>b(ne),onPointerEnter:()=>b(ne)},`${K.name}-${ne.value}`))},K.name))})]})}const Ow="modulepreload",Mw=function(t){return"/"+t},Fm={},Hw=function(n,r,s){let c=Promise.resolve();if(r&&r.length>0){let u=function(h){return Promise.all(h.map(y=>Promise.resolve(y).then(m=>({status:"fulfilled",value:m}),m=>({status:"rejected",reason:m}))))};document.getElementsByTagName("link");const p=document.querySelector("meta[property=csp-nonce]"),f=(p==null?void 0:p.nonce)||(p==null?void 0:p.getAttribute("nonce"));c=u(r.map(h=>{if(h=Mw(h),h in Fm)return;Fm[h]=!0;const y=h.endsWith(".css"),m=y?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${m}`))return;const g=document.createElement("link");if(g.rel=y?"stylesheet":Ow,y||(g.as="script"),g.crossOrigin="",g.href=h,f&&g.setAttribute("nonce",f),document.head.appendChild(g),y)return new Promise((v,C)=>{g.addEventListener("load",v),g.addEventListener("error",()=>C(new Error(`Unable to preload CSS for ${h}`)))})}))}function d(u){const p=new Event("vite:preloadError",{cancelable:!0});if(p.payload=u,window.dispatchEvent(p),!p.defaultPrevented)throw u}return c.then(u=>{for(const p of u||[])p.status==="rejected"&&d(p.reason);return n().catch(d)})},_n=[];for(let t=0;t<256;++t)_n.push((t+256).toString(16).slice(1));function Vw(t,n=0){return(_n[t[n+0]]+_n[t[n+1]]+_n[t[n+2]]+_n[t[n+3]]+"-"+_n[t[n+4]]+_n[t[n+5]]+"-"+_n[t[n+6]]+_n[t[n+7]]+"-"+_n[t[n+8]]+_n[t[n+9]]+"-"+_n[t[n+10]]+_n[t[n+11]]+_n[t[n+12]]+_n[t[n+13]]+_n[t[n+14]]+_n[t[n+15]]).toLowerCase()}let nu;const zw=new Uint8Array(16);function Bw(){if(!nu){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");nu=crypto.getRandomValues.bind(crypto)}return nu(zw)}const Gw=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Im={randomUUID:Gw};function pt(t,n,r){var c;if(Im.randomUUID&&!t)return Im.randomUUID();t=t||{};const s=t.random??((c=t.rng)==null?void 0:c.call(t))??Bw();if(s.length<16)throw new Error("Random bytes length must be >= 16");return s[6]=s[6]&15|64,s[8]=s[8]&63|128,Vw(s)}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const te=(t,n,r,s)=>{let c=t._logIndentLevel||0;t._currentPhaseContext&&c===0&&(c=1);const d={player:n,message:r,indentLevel:c,sourceCard:t._currentEffectSource,phase:t._currentPhaseContext,sourceCardRef:s==null?void 0:s.sourceCardRef,targetCardRefs:s==null?void 0:s.targetCardRefs};return{...t,log:[...t.log,d]}},Ga=t=>({...t,_logIndentLevel:(t._logIndentLevel||0)+1}),br=t=>({...t,_logIndentLevel:Math.max(0,(t._logIndentLevel||0)-1)}),st=(t,n)=>({...t,_currentEffectSource:n}),ft=(t,n)=>({...t,_currentPhaseContext:n});/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function Pn(t){const n=[];for(const r of["player","opponent"])t[r].lanes.forEach((s,c)=>{s.forEach((d,u)=>{if(d.isFaceUp){const p=d;if(p.customEffects){const f=u===s.length-1;(p.customEffects.topEffects||[]).forEach(m=>{m.params.action==="passive_rule"&&m.trigger==="passive"&&n.push({rule:m.params.rule,cardOwner:r,laneIndex:c,sourceCardId:d.id})}),(p.customEffects.middleEffects||[]).forEach(m=>{m.params.action==="passive_rule"&&m.trigger==="passive"&&n.push({rule:m.params.rule,cardOwner:r,laneIndex:c,sourceCardId:d.id})}),f&&(p.customEffects.bottomEffects||[]).forEach(g=>{g.params.action==="passive_rule"&&g.trigger==="passive"&&n.push({rule:g.params.rule,cardOwner:r,laneIndex:c,sourceCardId:d.id})})}d.protocol==="Frost"&&d.value===1&&(n.push({rule:{type:"block_flips",target:"all",scope:"global"},cardOwner:r,laneIndex:c}),u===s.length-1&&n.push({rule:{type:"block_protocol_rearrange",target:"all",scope:"global"},cardOwner:r,laneIndex:c})),d.protocol==="Frost"&&d.value===3&&n.push({rule:{type:"block_shifts_from_and_to_lane",target:"all",scope:"this_lane"},cardOwner:r,laneIndex:c})}})});return n}function Cr(t,n,r,s,c,d,u){var j,E,k;const p=Pn(t),f=n==="player"?"opponent":"player",h=t[n].protocols[r],y=t[f].protocols[r],m=c===h||c===y;let g=!1,v=!1;if(d){const R=d,D=[...((j=R.customEffects)==null?void 0:j.topEffects)||[],...((E=R.customEffects)==null?void 0:E.middleEffects)||[],...((k=R.customEffects)==null?void 0:k.bottomEffects)||[]];g=D.some(L=>{var I,F,U;return((I=L.params)==null?void 0:I.action)==="passive_rule"&&((U=(F=L.params)==null?void 0:F.rule)==null?void 0:U.type)==="allow_play_on_opponent_side"}),v=D.some(L=>{var I,F;return((I=L.params)==null?void 0:I.action)==="card_property"&&((F=L.params)==null?void 0:F.property)==="ignore_protocol_matching"})}for(const{rule:R,cardOwner:D,laneIndex:L}of p){const I=R.scope==="global"||L===r,F=R.target==="all"||R.target==="self"&&D===n||R.target==="opponent"&&D===f;if(!(!I||!F))switch(R.type){case"block_all_play":return{allowed:!1,reason:"Cannot play cards in this lane (passive rule)"};case"block_face_down_play":if(!s)return{allowed:!1,reason:"Cannot play cards face-down in this lane (passive rule)"};break;case"block_face_up_play":if(s)return{allowed:!1,reason:"Cannot play cards face-up in this lane (passive rule)"};break;case"require_face_down_play":if(s)return{allowed:!1,reason:"Can only play cards face-down (passive rule)"};break;case"allow_any_protocol_play":break;case"require_non_matching_protocol":if(s&&m)return{allowed:!1,reason:"Can only play cards without matching protocols (passive rule)"};break}}const C=p.some(({rule:R,cardOwner:D,laneIndex:L})=>{if(R.type!=="allow_any_protocol_play")return!1;const I=R.scope==="global"||L===r,F=R.target==="all"||R.target==="self"&&D===n||R.target==="opponent"&&D===f;return I&&F}),b=p.some(({rule:R,cardOwner:D,laneIndex:L})=>{if(R.type!=="require_non_matching_protocol")return!1;const I=R.scope==="global"||L===r,F=R.target==="all"||R.target==="self"&&D===n||R.target==="opponent"&&D===f;return I&&F}),x=Cl(t,n,r,c);return s&&!m&&!C&&!b&&!g&&!x&&!v&&!u?{allowed:!1,reason:"Face-up play requires matching protocol"}:{allowed:!0}}function Au(t){return Pn(t).some(({rule:r})=>r.type==="require_non_matching_protocol"&&r.scope==="global")}function Wc(t,n,r){const s=Pn(t),c=n==="player"?"opponent":"player";return s.some(({rule:d,cardOwner:u,laneIndex:p})=>{if(d.type!=="allow_any_protocol_play")return!1;const f=d.scope==="global"||r!==void 0&&p===r,h=d.target==="all"||d.target==="self"&&u===n||d.target==="opponent"&&u===c;return f&&h})}function ml(t,n){const r=n.customEffects;return r?(r.bottomEffects||[]).some(c=>{var d,u,p;return((d=c.params)==null?void 0:d.action)!=="passive_rule"?!1:((p=(u=c.params)==null?void 0:u.rule)==null?void 0:p.type)==="allow_play_on_opponent_side"}):!1}function Ww(t,n){const r=Pn(t);for(const{rule:s,laneIndex:c}of r)if(!(s.type!=="block_flips"||!(s.scope==="global"||c===n)))return{allowed:!1,reason:"Cards cannot be flipped face-up in this lane (passive rule)"};return{allowed:!0}}function gs(t,n,r){const s=Pn(t);for(const{rule:c,laneIndex:d}of s){if(c.type==="block_shifts_from_lane"&&d===n)return c.scope,{allowed:!1,reason:"Cards cannot shift from this lane (passive rule)"};if(c.type==="block_shifts_to_lane"&&d===r)return c.scope,{allowed:!1,reason:"Cards cannot shift to this lane (passive rule)"};if(c.type==="block_shifts_from_and_to_lane"&&(d===n||d===r))return{allowed:!1,reason:"Cards cannot shift from or to this lane (passive rule)"}}return{allowed:!0}}function Yw(t){const n=Pn(t);for(const{rule:r}of n)if(r.type==="block_protocol_rearrange")return{allowed:!1,reason:"Protocols cannot be rearranged (passive rule)"};return{allowed:!0}}function Qw(t,n,r){const s=Pn(t),c=t.turn;for(const{rule:d,cardOwner:u,laneIndex:p,sourceCardId:f}of s)if(!(d.type!=="ignore_middle_commands"||!(d.scope==="global"||p===n))&&!(d.onlyDuringYourTurn&&c!==u)){if(r!==void 0){const y=u==="player"?"opponent":"player";if(d.target==="opponent"&&r!==y||d.target==="self"&&r!==u)continue}if(f)for(const y of["player","opponent"])for(const m of t[y].lanes){const g=m.find(v=>v.id===f);if(g)return g}return null}return null}function za(t){return Pn(t).some(({rule:r})=>r.type==="block_flips"&&r.scope==="global")}function Xw(t){return Pn(t).some(({rule:r})=>r.type==="block_protocol_rearrange")}function ms(t,n){const r=Pn(t);for(const{rule:s,sourceCardId:c}of r)if(s.type==="block_flip_this_card"&&c===n)return{allowed:!1,reason:"This card cannot be flipped (passive rule)"};return{allowed:!0}}function Fu(t,n){const r=Pn(t);for(const{rule:s,cardOwner:c}of r)if(s.type==="block_draw_conditional"){const u=(s.conditionTarget||"self")==="self"?c:c==="player"?"opponent":"player",p=s.blockTarget||"self";let f;if(p==="self"?f=c:p==="opponent"?f=c==="player"?"opponent":"player":f="all",t[u].hand.length>0&&(f==="all"||f===n))return{allowed:!1,reason:"Cannot draw cards (passive rule)"}}return{allowed:!0}}function Cl(t,n,r,s){const c=Pn(t);for(const{rule:d,cardOwner:u,laneIndex:p}of c)if(d.type==="allow_same_protocol_face_up_play"&&!(d.scope!=="this_lane"||p!==r)&&u===n&&d.protocolScope==="same_as_source"){const f=t[u].lanes[p];for(let h=0;h<f.length;h++){const y=f[h];if(!y.isFaceUp||!(h===f.length-1))continue;const g=y;if(!g.customEffects)continue;if([...g.customEffects.topEffects||[],...g.customEffects.middleEffects||[],...g.customEffects.bottomEffects||[]].some(b=>{var x,j,E;return((x=b.params)==null?void 0:x.action)==="passive_rule"&&((E=(j=b.params)==null?void 0:j.rule)==null?void 0:E.type)==="allow_same_protocol_face_up_play"})&&y.protocol===s)return!0}}return!1}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Zw={},Kw={},Jw={},ex={};function Sl(t,n,r,s){const{cardOwner:c,opponent:d,triggerType:u}=s,p=r[c].lanes[n];if(!p.find(C=>C.id===t.id))return{newState:r};if(!(u==="uncover"||p.length>0&&p[p.length-1].id===t.id))return{newState:r};const y=Qw(r,n,c);if(y){const C=`${t.protocol}-${t.value}`,b=`${y.protocol}-${y.value}`;return{newState:te(r,c,`${C}: Effect blocked by ${b}.`)}}if(r.skipNextMiddleCommand===t.id){const C=`${t.protocol}-${t.value}`;let b={...r};return delete b.skipNextMiddleCommand,b=te(b,c,`${C}: Middle commands ignored.`),{newState:b}}const m=t;if(m.customEffects&&m.customEffects.middleEffects&&m.customEffects.middleEffects.length>0){let C=Ga(r);const b=`${t.protocol}-${t.value}`;C=st(C,b),C=ft(C,"middle");let x=C;const j=x._pendingCustomEffects;if(j&&j.sourceCardId!==t.id){const D=x.lastCustomEffectTargetCardId,L={type:"execute_remaining_custom_effects",sourceCardId:j.sourceCardId,laneIndex:j.laneIndex,effects:j.effects,context:j.context,actor:j.context.cardOwner,selectedCardFromPreviousEffect:D||j.selectedCardFromPreviousEffect,savedLastCustomEffectTargetCardId:x.lastCustomEffectTargetCardId,logSource:j.logSource,logPhase:j.logPhase,logIndentLevel:j.logIndentLevel},I=x._deferredParentEffects||[];x={...x,_deferredParentEffects:[...I,L]},delete x._pendingCustomEffects}x.lastCustomEffectTargetCardId&&(x={...x,lastCustomEffectTargetCardId:null});let E=[];for(let D=0;D<m.customEffects.middleEffects.length;D++){const L=m.customEffects.middleEffects[D],I=m.customEffects.middleEffects.slice(D+1),F=I.length>0;F&&(x._pendingCustomEffects={sourceCardId:t.id,laneIndex:n,context:s,effects:I,logSource:x._currentEffectSource,logPhase:x._currentPhaseContext,logIndentLevel:x._logIndentLevel||0});const U=_t(t,n,x,s,L);if(x=U.newState,U.animationRequests&&U.animationRequests.length>0&&(E=[...E,...U.animationRequests]),x.actionRequired)return{newState:qe(x),animationRequests:E.length>0?E:void 0};const B=x._pendingCustomEffects;B&&F&&B.sourceCardId===t.id&&delete x._pendingCustomEffects}const k=x._deferredParentEffects;if(k&&k.length>0){const D=k[k.length-1],L=k.slice(0,-1);x={...x,_deferredParentEffects:L.length>0?L:void 0,lastCustomEffectTargetCardId:D.savedLastCustomEffectTargetCardId||D.selectedCardFromPreviousEffect,_pendingCustomEffects:{sourceCardId:D.sourceCardId,laneIndex:D.laneIndex,context:D.context,effects:D.effects,selectedCardFromPreviousEffect:D.selectedCardFromPreviousEffect,logSource:D.logSource,logPhase:D.logPhase,logIndentLevel:D.logIndentLevel}}}return{newState:qe(x),animationRequests:E.length>0?E:void 0}}const g=`${t.protocol}-${t.value}`,v=Zw[g];if(v){let C=Ga(r);const b=`${t.protocol}-${t.value}`;C=st(C,b),C=ft(C,"middle");const x=v(t,n,C,s);let j=x.newState;const E=qe(j);return{...x,newState:E}}return{newState:r}}function vs(t,n,r,s){if(!t.isFaceUp)return{newState:r};const c=t;if(c.customEffects){const f=[...c.customEffects.topEffects||[],...c.customEffects.middleEffects||[],...c.customEffects.bottomEffects||[]].filter(h=>{if(!(h.trigger==="on_cover"||h.trigger==="on_cover_or_flip"))return!1;if(h.onCoverProtocolRestriction==="same_protocol"){const m=r._coveringCardProtocol;if(m&&m!==t.protocol)return!1}return!0});if(f.length>0){const h=`${t.protocol}-${t.value}`;let y=st(r,h);y=ft(y,"oncover");let m=y;const g=[];for(const C of f){const b=_t(t,n,m,s,C);if(m=b.newState,b.animationRequests&&g.push(...b.animationRequests),m.actionRequired)return{newState:qe(m),animationRequests:g.length>0?g:void 0}}return{newState:qe(m),animationRequests:g.length>0?g:void 0}}}const d=`${t.protocol}-${t.value}`,u=ex[d];if(u){const p=`${t.protocol}-${t.value}`;let f=st(r,p);f=ft(f,"oncover");const h=u(t,n,f,s),y=qe(h.newState);return{...h,newState:y}}return{newState:r}}function tx(t,n,r){const s=[],c=new Set,d=r==="Start"?"start":"end";return t[n].lanes.flat().forEach(u=>{var f;if(!u.isFaceUp||c.has(u.id))return;const p=u;if((f=p.customEffects)!=null&&f.topEffects){const h=p.customEffects.topEffects.filter(y=>y.trigger===d);h.length>0&&(s.push({cardId:u.id,box:"top",effectIds:h.map(y=>y.id)}),c.add(u.id))}u.top.includes(`'emphasis'>${r}:`)&&(c.has(u.id)||(s.push({cardId:u.id,box:"top",effectIds:[]}),c.add(u.id)))}),t[n].lanes.forEach(u=>{var h;if(u.length===0)return;const p=u[u.length-1];if(!p.isFaceUp||c.has(p.id))return;const f=p;if((h=f.customEffects)!=null&&h.bottomEffects){const y=f.customEffects.bottomEffects.filter(m=>m.trigger===d);y.length>0&&(s.push({cardId:p.id,box:"bottom",effectIds:y.map(m=>m.id)}),c.add(p.id))}p.bottom.includes(`'emphasis'>${r}:`)&&(c.has(p.id)||(s.push({cardId:p.id,box:"bottom",effectIds:[]}),c.add(p.id)))}),s}function nx(t,n,r){for(let s=0;s<t[n].lanes.length;s++){const c=t[n].lanes[s],d=c.find(u=>u.id===r.cardId);if(d)return!d.isFaceUp||r.box==="bottom"&&!(c.length>0&&c[c.length-1].id===d.id)?null:{card:d,laneIndex:s}}return null}function ax(t,n,r){const s=t,c=r==="Start"?"start":"end";if(s.customEffects){const p=n==="top"?s.customEffects.topEffects:s.customEffects.bottomEffects,f=(p==null?void 0:p.filter(h=>h.trigger===c))||[];if(f.length>0)return f.map(y=>{var v,C;const m=((v=y.params)==null?void 0:v.action)||"effect",g=(C=y.params)==null?void 0:C.count;return g?`${m} ${g}`:m}).join(", ")}const u=(n==="top"?t.top:t.bottom).match(new RegExp(`${r}:\\s*</span>\\s*([^<]+)`,"i"));return u?u[1].trim():r+" effect"}function Oc(t,n,r){const s=t.turn;let c={...t,_logIndentLevel:0};const d=n==="Start",u=d?"_startPhaseEffectSnapshot":"_endPhaseEffectSnapshot",p=d?"_selectedStartEffectId":"_selectedEndEffectId",f=c[p];let h=c[u];h&&h.length>0&&(h.some(I=>c[s].lanes.flat().some(F=>F.id===I.cardId))||(h=void 0,c[u]=void 0)),h||(h=tx(c,s,n),c[u]=h);const y=d?c.processedStartEffectIds||[]:c.processedEndEffectIds||[],m=[];for(const L of h){if(y.includes(L.cardId))continue;const F=nx(c,s,L);F&&m.push({entry:L,card:F.card,laneIndex:F.laneIndex})}if(m.length===0)return c[u]=void 0,c[p]=void 0,{newState:c};let g;if(f&&(g=m.find(L=>L.entry.cardId===f),g||console.warn(`[processTriggeredEffects] Selected effect ${f} not found in valid effects!`),c[p]=void 0),!g){if(m.length>1){const L=m.map(({entry:I,card:F})=>({cardId:I.cardId,cardName:`${F.protocol}-${F.value}`,box:I.box,effectDescription:ax(F,I.box,n)}));return c.actionRequired={type:"select_phase_effect",actor:s,phase:n,availableEffects:L},{newState:c}}g=m[0]}const{entry:v,card:C,laneIndex:b}=g,x=s==="player"?"opponent":"player",j={cardOwner:s,actor:s,currentTurn:t.turn,opponent:x,triggerType:n==="Start"?"start":"end"},E=C,k=n==="Start"?"start":"end";if(E.customEffects){const L=v.box==="top"?E.customEffects.topEffects:E.customEffects.bottomEffects,I=(L==null?void 0:L.filter(F=>F.trigger===k))||[];if(I.length>0){const F=`${C.protocol}-${C.value}`,U=n==="Start"?"start":"end";c=st(c,F),c=ft(c,U);const B={...c,_currentPhaseContext:void 0},G=te(B,s,`${n} effect triggers.`);c={...c,log:G.log},c=Ga(c);for(let W=0;W<I.length;W++){const P=I[W],z=_t(C,b,c,j,P);if(c=qe(z.newState),z.animationRequests&&z.animationRequests.length>0){const H=c._pendingAnimationRequests||[];c._pendingAnimationRequests=[...H,...z.animationRequests]}if(c.actionRequired){const H=I.slice(W+1);return H.length>0&&(c._pendingCustomEffects={sourceCardId:C.id,laneIndex:b,context:j,effects:H,logSource:c._currentEffectSource,logPhase:c._currentPhaseContext,logIndentLevel:c._logIndentLevel||0}),d?c.processedStartEffectIds=[...c.processedStartEffectIds||[],C.id]:c.processedEndEffectIds=[...c.processedEndEffectIds||[],C.id],{newState:c}}}return d?c.processedStartEffectIds=[...c.processedStartEffectIds||[],C.id]:c.processedEndEffectIds=[...c.processedEndEffectIds||[],C.id],c=br(c),c=st(c,void 0),c=ft(c,void 0),Oc(c,n,r)}}const R=`${C.protocol}-${C.value}`,D=r[R];if(D){const L=`${C.protocol}-${C.value}`,I=n==="Start"?"start":"end";c=st(c,L),c=ft(c,I);const F={...c,_currentPhaseContext:void 0},U=te(F,s,`${n} effect triggers.`);c={...c,log:U.log},c=Ga(c);const B=D(C,c,j);if(c=qe(B.newState),B.animationRequests&&B.animationRequests.length>0){const G=c._pendingAnimationRequests||[];c._pendingAnimationRequests=[...G,...B.animationRequests]}return d?c.processedStartEffectIds=[...c.processedStartEffectIds||[],C.id]:c.processedEndEffectIds=[...c.processedEndEffectIds||[],C.id],c.actionRequired?{newState:c}:(c=br(c),c=st(c,void 0),c=ft(c,void 0),Oc(c,n,r))}return{newState:c}}function Iu(t){return Oc(t,"Start",Kw)}function dy(t){return Oc(t,"End",Jw)}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const ox=t=>{if(!t.useControlMechanic)return t;const n=t.turn,r=n==="player"?"opponent":"player",s=t[n],c=t[r];let d=0;const u=s.laneValues[0],p=s.laneValues[1],f=s.laneValues[2],h=c.laneValues[0],y=c.laneValues[1],m=c.laneValues[2];if(u>h&&d++,p>y&&d++,f>m&&d++,d>=2&&t.controlCardHolder!==n){let g=st(t,void 0);return g=ft(g,void 0),g={...g,_logIndentLevel:0},g=te(g,n,`${n==="player"?"Player":"Opponent"} gains the Control Component.`),{...g,controlCardHolder:n}}return t},yl=t=>{if(t.winner)return t;const n=t.turn;let r={...t};switch(r=st(r,void 0),r=ft(r,void 0),r={...r,_logIndentLevel:0},t.phase){case"start":return r=Iu(r).newState,r.actionRequired?r:(r=st(r,void 0),r=ft(r,void 0),r={...r,_logIndentLevel:0},r._startPhaseEffectSnapshot=void 0,{...r,phase:"control"});case"control":{const s=ox(r);let c=st(s,void 0);return c=ft(c,void 0),c={...c,_logIndentLevel:0},{...c,phase:"compile"}}case"compile":{const s=xy(r,n);return s.length>0?{...r,compilableLanes:s}:(r=st(r,void 0),r=ft(r,void 0),r={...r,_logIndentLevel:0},{...r,phase:"action",compilableLanes:[]})}case"action":return r=st(r,void 0),r=ft(r,void 0),r={...r,_logIndentLevel:0},{...r,phase:"hand_limit",_cardPlayedThisActionPhase:void 0};case"hand_limit":{const s=r[n],c=s.lanes.some(p=>p.length>0&&p[p.length-1].isFaceUp&&p[p.length-1].protocol==="Spirit"&&p[p.length-1].value===0),u=Pn(r).some(({rule:p,cardOwner:f})=>p.type==="skip_check_cache_phase"&&(p.target==="self"&&f===n||p.target==="all")&&f===n);if(c||u){let p=te(r,n,"Skipping Check Cache phase.");return p=st(p,void 0),p=ft(p,void 0),p={...p,_logIndentLevel:0},{...p,phase:"end"}}if(s.hand.length>5){const p=s.hand.length-5;let h=te(r,n,`Check Cache: ${n==="player"?"Player":"Opponent"} has ${s.hand.length} cards, must discard ${p}.`);return h=Ga(h),{...h,actionRequired:{type:"discard",actor:n,count:p}}}return r=st(r,void 0),r=ft(r,void 0),r={...r,_logIndentLevel:0},{...r,phase:"end"}}case"end":{const s={...r};r=dy(r).newState;const c=s.actionRequired,d=r.actionRequired;if(d&&d!==c||r.queuedActions&&r.queuedActions.length>0&&(r=Sr(r),r.actionRequired))return r;const u=n==="player"?"opponent":"player",p={...r[n],cannotCompile:!1};return r=st(r,void 0),r=ft(r,void 0),r={...r,_logIndentLevel:0},r=qe(r),{...r,[n]:p,turn:u,phase:"start",processedStartEffectIds:[],processedEndEffectIds:[],processedSpeed1TriggerThisTurn:!1,processedUncoverEventIds:[],_startPhaseEffectSnapshot:void 0,_endPhaseEffectSnapshot:void 0,_interruptedTurn:void 0,_interruptedPhase:void 0}}}return t};function gt(t){var p;const n=t._pendingCustomEffects;if(!n||n.effects.length===0)return t;const r=n.effects.map(f=>f.id).join(",");if((p=t.queuedActions)==null?void 0:p.some(f=>{var h;return f.type==="execute_remaining_custom_effects"&&f.sourceCardId===n.sourceCardId&&((h=f.effects)==null?void 0:h.map(y=>y.id).join(","))===r})){const f={...t};return delete f._pendingCustomEffects,f}const c=n.selectedCardFromPreviousEffect||t.lastCustomEffectTargetCardId,d={type:"execute_remaining_custom_effects",sourceCardId:n.sourceCardId,laneIndex:n.laneIndex,effects:n.effects,context:n.context,actor:n.context.cardOwner,selectedCardFromPreviousEffect:c,logSource:n.logSource,logPhase:n.logPhase,logIndentLevel:n.logIndentLevel},u={...t,queuedActions:[d,...t.queuedActions||[]]};return delete u._pendingCustomEffects,u}const Wa=t=>{var c,d,u;let n=gt(t);const r=n._pendingFollowUpEffect;if(r&&!n.actionRequired){const{followUpEffect:p,conditionalType:f,previousHandSize:h,sourceCardId:y,actor:m,savedIndentLevel:g}=r;delete n._pendingFollowUpEffect;const v=Ie(n,y);if(v){const C=m,b=n[C].hand.length,x=Math.max(0,(h||0)-b);if(f==="then"||f==="if_executed"&&x>0){const E=`${v.card.protocol}-${v.card.value}`;n=st(n,E),n=ft(n,"middle"),g!==void 0&&(n={...n,_logIndentLevel:g});let k=-1;for(let R=0;R<n[v.owner].lanes.length;R++)if(n[v.owner].lanes[R].some(D=>D.id===y)){k=R;break}if(k!==-1){const R={cardOwner:v.owner,opponent:v.owner==="player"?"opponent":"player",currentTurn:n.turn,actor:C,discardedCount:x};if(n=_t(v.card,k,n,R,p).newState,n.actionRequired)return n}}}}if(!n.queuedActions||n.queuedActions.length===0){const p=n._deferredParentEffects;if(p&&p.length>0&&!n.actionRequired){const f=p[p.length-1],h=p.slice(0,-1),y={type:"execute_remaining_custom_effects",sourceCardId:f.sourceCardId,laneIndex:f.laneIndex,effects:f.effects,context:f.context,actor:f.actor||((c=f.context)==null?void 0:c.cardOwner),selectedCardFromPreviousEffect:f.selectedCardFromPreviousEffect,savedLastCustomEffectTargetCardId:f.savedLastCustomEffectTargetCardId,logSource:f.logSource,logPhase:f.logPhase,logIndentLevel:f.logIndentLevel};return Wa({...n,_deferredParentEffects:h.length>0?h:void 0,lastCustomEffectTargetCardId:f.savedLastCustomEffectTargetCardId||f.selectedCardFromPreviousEffect,queuedActions:[y]})}return n}let s=[...n.queuedActions];for(;s.length>0;){const p=s.shift();if(p.sourceCardId&&p.type!=="flip_self"){const f=Ie(n,p.sourceCardId);if(!f||!f.card.isFaceUp){const h=f?`${f.card.protocol}-${f.card.value}`:"a card",y=n._logSource;n=st(n,h),n=te(n,p.actor,"Queued effect was cancelled because the source is no longer active."),n=st(n,y);continue}}if(p.type==="flip_self"){if(n._deferFlipSelf){delete n._deferFlipSelf,n._hasDeferredFlipSelf=!0,n.queuedActions=[p,...s];break}const{sourceCardId:f,actor:h}=p,y=Ie(n,f),m=vo(n,f);if(y&&y.card.isFaceUp&&m){const g=`${y.card.protocol}-${y.card.value}`;n=te(n,h,`${g}: Flips itself.`);const v={type:"flip",cardId:f,owner:y.owner,laneIndex:y.laneIndex,cardIndex:y.cardIndex},C=n._pendingAnimationRequests||[];n._pendingAnimationRequests=[...C,v],n=_l(new Set([f]),n)}else{const g=y?`${y.card.protocol}-${y.card.value}`:"the source card",v=y?y.card.isFaceUp?"now covered":"flipped face-down":"deleted";n=te(n,h,`The self-flip effect from ${g} was cancelled because it is ${v}.`)}continue}if(p.type==="execute_follow_up_effect"){const{sourceCardId:f,followUpEffect:h,actor:y,logContext:m}=p,g=Ie(n,f),v=vo(n,f);if(g&&g.card.isFaceUp&&v){const C=n[g.owner].lanes.find(R=>R.some(D=>D.id===f)),b=n[g.owner].lanes.indexOf(C),x={cardOwner:g.owner,actor:y,currentTurn:n.turn,opponent:g.owner==="player"?"opponent":"player"},j=(m==null?void 0:m.sourceCardName)||`${g.card.protocol}-${g.card.value}`,E=(m==null?void 0:m.phase)||(n.phase==="start"?"start":"end");if(n={...n,_logIndentLevel:(m==null?void 0:m.indentLevel)||1,_currentEffectSource:j,_currentPhaseContext:E},n=_t(g.card,b,n,x,h).newState,n.actionRequired)return n={...n,queuedActions:s},n}else{const C=g?`${g.card.protocol}-${g.card.value}`:"the source card",b=g?g.card.isFaceUp?"now covered":"flipped face-down":"deleted";n=te(n,y,`The follow-up effect from ${C} was cancelled because it is ${b}.`)}continue}if(p.type==="execute_conditional_followup"){const{sourceCardId:f,laneIndex:h,followUpEffect:y,context:m,actor:g}=p,v=[...n.player.lanes.flat(),...n.opponent.lanes.flat()].find(b=>b.id===f);if(!v){n=te(n,g,"Conditional follow-up effect skipped: source card no longer exists.");continue}if(!v.isFaceUp){const b=`${v.protocol}-${v.value}`;n=te(n,g,`Conditional follow-up effect from ${b} cancelled: card was flipped face-down.`);continue}const C=_t(v,h,n,m,y);if(n=qe(C.newState),n.actionRequired)return y.conditional&&y.conditional.thenEffect&&(n.actionRequired={...n.actionRequired,followUpEffect:y.conditional.thenEffect,conditionalType:y.conditional.type}),n={...n,queuedActions:s},n;if(y.conditional&&y.conditional.thenEffect){const b=_t(v,h,n,m,y.conditional.thenEffect);if(n=qe(b.newState),n.actionRequired)return n={...n,queuedActions:s},n}continue}if(p.type==="execute_remaining_custom_effects"){const{sourceCardId:f,laneIndex:h,effects:y,context:m,selectedCardFromPreviousEffect:g,logSource:v,logPhase:C,logIndentLevel:b}=p;v!==void 0&&(n={...n,_currentEffectSource:v}),C!==void 0&&(n={...n,_currentPhaseContext:C}),b!==void 0&&(n={...n,_logIndentLevel:b});const x=Ie(n,f);if(!x){n=te(n,m.cardOwner,"Remaining effects cancelled because the source card was deleted or returned.");continue}if(!x.card.isFaceUp){const D=`${x.card.protocol}-${x.card.value}`;n=te(n,m.cardOwner,`Remaining effects from ${D} cancelled because it was flipped face-down.`);continue}const j=m.triggerType==="start"||m.triggerType==="end";if(!bx(n,f)&&!j){const D=`${x.card.protocol}-${x.card.value}`;n=te(n,m.cardOwner,`Remaining effects from ${D} cancelled because it is now covered.`);continue}const k=p.savedLastCustomEffectTargetCardId;k&&(n.lastCustomEffectTargetCardId=k),g&&(n._selectedCardFromPreviousEffect=g,k||(n.lastCustomEffectTargetCardId=g));for(let D=0;D<y.length;D++){const L=y[D];if((d=L.params)!=null&&d.flipSelf&&n._deferFlipSelf){delete n._deferFlipSelf;const F={type:"flip_self",sourceCardId:f,actor:m.cardOwner},U=y.slice(D+1),B=[F];return U.length>0&&B.push({type:"execute_remaining_custom_effects",sourceCardId:f,laneIndex:h,effects:U,context:m,actor:m.cardOwner,logSource:n._currentEffectSource,logPhase:n._currentPhaseContext,logIndentLevel:n._logIndentLevel||0}),n.queuedActions=[...B,...s],n._hasDeferredFlipSelf=!0,n}const I=_t(x.card,h,n,m,L);if(n=I.newState,I.animationRequests&&I.animationRequests.length>0&&!n.actionRequired){const F=y.slice(D+1);if(F.length>0){const B={type:"execute_remaining_custom_effects",sourceCardId:f,laneIndex:h,effects:F,context:m,actor:m.cardOwner,logSource:n._currentEffectSource,logPhase:n._currentPhaseContext,logIndentLevel:n._logIndentLevel||0};n.queuedActions=[B,...s||[]]}else n.queuedActions=s;const U=n._pendingAnimationRequests||[];return n._pendingAnimationRequests=[...U,...I.animationRequests],n}if(n.actionRequired){const F=y.slice(D+1);if(F.length>0&&(n._pendingCustomEffects={sourceCardId:f,laneIndex:h,context:m,effects:F,logSource:n._currentEffectSource,logPhase:n._currentPhaseContext,logIndentLevel:n._logIndentLevel||0}),n._interruptedTurn){const U=n._interruptedTurn,B=n._interruptedPhase||n.phase;delete n._interruptedTurn,delete n._interruptedPhase,n.turn=U,n.phase=B}return n.queuedActions=s,n}}const R=n._deferredParentEffects;if(R&&R.length>0){const D=R[R.length-1],L=R.slice(0,-1);s=[{type:"execute_remaining_custom_effects",sourceCardId:D.sourceCardId,laneIndex:D.laneIndex,effects:D.effects,context:D.context,actor:D.actor||((u=D.context)==null?void 0:u.cardOwner),selectedCardFromPreviousEffect:D.selectedCardFromPreviousEffect,savedLastCustomEffectTargetCardId:D.savedLastCustomEffectTargetCardId,logSource:D.logSource,logPhase:D.logPhase,logIndentLevel:D.logIndentLevel},...s||[]],n={...n,_deferredParentEffects:L.length>0?L:void 0,lastCustomEffectTargetCardId:D.savedLastCustomEffectTargetCardId||D.selectedCardFromPreviousEffect}}continue}if(p.type==="reveal_opponent_hand"){const f=n.turn==="player"?"opponent":"player",h={...n[f]};if(h.hand.length>0){h.hand=h.hand.map(g=>({...g,isRevealed:!0})),n[f]=h;const y=Ie(n,p.sourceCardId),m=y?`${y.card.protocol}-${y.card.value}`:"A card effect";n=te(n,n.turn,`${m}: Opponent reveals their hand.`)}else{const y=Ie(n,p.sourceCardId),m=y?`${y.card.protocol}-${y.card.value}`:"A card effect";n=te(n,n.turn,`${m}: Opponent has no cards to reveal.`)}continue}if(p.type==="pending_uncover_effect"){const{owner:f,laneIndex:h}=p;if(n=Sa(n,f,h).newState,n.actionRequired)return n.queuedActions=s,n;continue}if(p.type==="discard"&&p.actor){const f=p.actor,h=n[f].hand.length,y=p.count||1;if(h===0){const m=f==="player"?"Player":"Opponent";if(p.sourceCardId){const g=Ie(n,p.sourceCardId);if(g){const v=`${g.card.protocol}-${g.card.value}`;n=st(n,v),n=ft(n,"middle");const C=p._savedIndentLevel;C!==void 0&&(n={...n,_logIndentLevel:C})}}n=te(n,f,`${m} has no cards to discard - effect skipped.`),n=st(n,void 0),n=ft(n,void 0),n={...n,_logIndentLevel:0};continue}else typeof y=="number"&&h<y&&(p.count=h)}return n.actionRequired=p,n.queuedActions=s,n}return{...n,queuedActions:[],actionRequired:null}},Sr=t=>{var u;if(t.winner||t.actionRequired)return t;const n=t._deferredParentEffects&&t._deferredParentEffects.length>0;if(t.queuedActions&&t.queuedActions.length>0||n){const p=Wa(t);if(p.actionRequired||p._hasDeferredFlipSelf)return p;t=p}if(t._interruptedTurn){const p=t._interruptedTurn,f=t._interruptedPhase||t.phase;let h={...t};if(delete h._interruptedTurn,delete h._interruptedPhase,h.turn=p,h.phase=f,t._interruptedCardPlayedFlag!==void 0&&(h._cardPlayedThisActionPhase=t._interruptedCardPlayedFlag,delete h._interruptedCardPlayedFlag),f==="start"||f==="end"){if(h.queuedActions&&h.queuedActions.length>0&&(h=Wa(h)),!h.actionRequired&&f==="end"){const y=dy(h).newState;if(y.actionRequired)return y;const m=y.turn==="player"?"opponent":"player",g={...y[y.turn],cannotCompile:!1};let v=st(y,void 0);return v=ft(v,void 0),v={...v,_logIndentLevel:0},v=qe(v),{...v,[y.turn]:g,turn:m,phase:"start",processedStartEffectIds:[],processedEndEffectIds:[],processedSpeed1TriggerThisTurn:!1,processedUncoverEventIds:[],_startPhaseEffectSnapshot:void 0,_endPhaseEffectSnapshot:void 0,_interruptedTurn:void 0,_interruptedPhase:void 0}}if(f==="start"&&!h.actionRequired){const y=Iu(h).newState;if(y.actionRequired)return y;let m={...y,phase:"control"};return ul(m)}return h}t=h}if(((u=t.actionRequired)==null?void 0:u.type)==="prompt_rearrange_protocols"&&t.actionRequired.originalAction){const p=t.actionRequired.originalAction;let f={...t,actionRequired:null,controlCardHolder:null};if(p.type==="compile")return ul(f);if(p.type==="fill_hand"){const h=bl(f,f.turn,5-f[f.turn].hand.length);return ul(h)}}if(t.queuedEffect){const{card:p,laneIndex:f}=t.queuedEffect,h={...t,queuedEffect:void 0,_committedCardId:void 0},y=Ie(h,p.id);if(y){const{card:m,owner:g}=y;let v={...h,_logIndentLevel:0};const C={cardOwner:g,actor:g,currentTurn:v.turn,opponent:g==="player"?"opponent":"player",triggerType:"play"},b=Sl(m,f,v,C);let x=b.newState;if(b.animationRequests&&b.animationRequests.length>0){const j=x._pendingAnimationRequests||[];x._pendingAnimationRequests=[...j,...b.animationRequests]}if(x.actionRequired)return x;t=x}else console.warn(`Skipping queued effect for ${p.protocol}-${p.value} as it is no longer on the board.`),t=te(t,t.turn,`Skipping queued effect for ${p.protocol}-${p.value} as it is no longer on the board.`),t=h}if(t.queuedActions&&t.queuedActions.length>0){let p={...t},f=[...p.queuedActions];for(;f.length>0;){const h=f.shift(),y=h.type==="flip_self";if(h.sourceCardId&&!y){const m=Ie(p,h.sourceCardId);if(!m||!m.card.isFaceUp){const g=m?`${m.card.protocol}-${m.card.value}`:"a card",v=p._logSource;p=st(p,g),p=te(p,h.actor,"Queued effect was cancelled because the source is no longer active."),p=st(p,v);continue}}if(y){if(p._deferFlipSelf){delete p._deferFlipSelf,p._hasDeferredFlipSelf=!0,p.queuedActions=[h,...f];break}const{sourceCardId:m,actor:g}=h,v=Ie(p,m),C=vo(p,m);if(v&&v.card.isFaceUp&&C){const b=`${v.card.protocol}-${v.card.value}`;p=te(p,g,`${b}: Flips itself.`);const x={type:"flip",cardId:m,owner:v.owner,laneIndex:v.laneIndex,cardIndex:v.cardIndex},j=p._pendingAnimationRequests||[];p._pendingAnimationRequests=[...j,x],p=_l(new Set([m]),p)}else{const b=v?`${v.card.protocol}-${v.card.value}`:"the source card",x=v?v.card.isFaceUp?"now covered":"flipped face-down":"deleted";p=te(p,g,`The self-flip effect from ${b} was cancelled because it is ${x}.`)}continue}if(h.type==="reveal_opponent_hand"){const m=p.turn==="player"?"opponent":"player",g={...p[m]};if(g.hand.length>0){g.hand=g.hand.map(b=>({...b,isRevealed:!0})),p[m]=g;const v=Ie(p,h.sourceCardId),C=v?`${v.card.protocol}-${v.card.value}`:"A card effect";p=te(p,p.turn,`${C}: Opponent reveals their hand.`)}else{const v=Ie(p,h.sourceCardId),C=v?`${v.card.protocol}-${v.card.value}`:"A card effect";p=te(p,p.turn,`${C}: Opponent has no cards to reveal.`)}continue}if(h.type==="discard"&&h.actor){const m=h.actor,g=p[m].hand.length,v=h.count||1;if(g===0){const C=m==="player"?"Player":"Opponent";if(h.sourceCardId){const b=Ie(p,h.sourceCardId);if(b){const x=`${b.card.protocol}-${b.card.value}`;p=st(p,x),p=ft(p,"middle");const j=h._savedIndentLevel;j!==void 0&&(p={...p,_logIndentLevel:j})}}p=te(p,m,`${C} has no cards to discard - effect skipped.`),p=st(p,void 0),p=ft(p,void 0),p={...p,_logIndentLevel:0};continue}else typeof v=="number"&&g<v&&(h.count=g)}return p.actionRequired=h,p.queuedActions=f,p}t={...p,queuedActions:[],actionRequired:null}}const r=t.phase==="action"?"hand_limit":t.phase,s=t.phase==="action";let c={...t,phase:r,compilableLanes:[],processedUncoverEventIds:[],...s?{_cardPlayedThisActionPhase:void 0}:{}};const d=t.turn;for(;c.turn===d&&!c.winner;){const p=c.actionRequired,f=c.phase;c=yl(c);const h=c.actionRequired;if(h&&h!==p)break;if(c.phase===f&&c.turn===d){console.error("Game is stuck in a phase loop:",c.phase);break}}return c},ul=t=>{if(t.winner)return t;let n={...t};if(n._interruptedTurn){const s=n._interruptedTurn,c=n._interruptedPhase||n.phase;delete n._interruptedTurn,delete n._interruptedPhase,n.turn=s,n.phase=c}const r=n.turn;for(;n.turn===r&&!n.actionRequired&&!n.winner;){const s=n.phase;if(s==="action")break;if(s==="compile"){const d=xy(n,r);if(d.length>0){n={...n,compilableLanes:d};break}}const c=n.phase;if(n=yl(n),c===n.phase&&!n.actionRequired){console.error("Game is stuck in an automatic phase loop:",c);break}}return n},uy=t=>{let n={...t,actionRequired:null};if(n._interruptedTurn)return Sr(n);const r=n._deferredParentEffects&&n._deferredParentEffects.length>0;if(n.queuedActions&&n.queuedActions.length>0||r){const d=Wa(n);if(d.actionRequired)return d;n=d}const s=Iu(n).newState;if(s.actionRequired)return s;let c=s;return c.phase!=="control"&&(c={...c,phase:"control"}),c=yl(c),c.actionRequired||(c=yl(c)),c},py=t=>{if(t.winner)return t;let n={...t,phase:"start"};return n=qe(n),n=yl(n),n.actionRequired?n:ul(n)},$m=Object.freeze(Object.defineProperty({__proto__:null,advancePhase:yl,continueTurnAfterStartPhaseAction:uy,continueTurnProgression:ul,processEndOfAction:Sr,processQueuedActions:Wa,processStartOfTurn:py,queuePendingCustomEffects:gt},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * AI Card Memory - Tracks known values of face-down cards
 *
 * The AI can remember card values when:
 * 1. AI plays its own card face-down (AI knows what's in its hand)
 * 2. A face-up card is flipped to face-down (the value was visible)
 * 3. A card is revealed (Psychic effects, etc.)
 *
 * This allows the AI to make smarter decisions about flipping cards.
 */function fy(t,n,r){const s=t.aiCardMemory||{};return{...t,aiCardMemory:{...s,[n]:r}}}function Pm(t,n){return t.aiCardMemory?t.aiCardMemory[n]??null:null}function rx(t,n){return fy(t,n.id,n.value)}function qc(t,n){return n.isFaceUp?fy(t,n.id,n.value):t}function lx(t){if(!t.aiCardMemory)return t;const n=new Set;for(const s of["player","opponent"])for(const c of t[s].lanes)for(const d of c)n.add(d.id);const r={};for(const[s,c]of Object.entries(t.aiCardMemory))n.has(s)&&(r[s]=c);return{...t,aiCardMemory:r}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function $n(t,n){return{player:qm(t,"player",n),opponent:qm(t,"opponent",n),controlCardHolder:t.controlCardHolder,turn:t.turn,phase:t.phase}}function qm(t,n,r){const s=t[n],c=s.lanes.map(p=>p.filter(f=>!r||!r.has(f.id)).map(f=>({...f}))),d=s.hand.filter(p=>!r||!r.has(p.id)).map(p=>({...p})),u=s.discard.length>0?{...s.discard[s.discard.length-1]}:void 0;return{protocols:[...s.protocols],compiled:[...s.compiled],laneValues:[...s.laneValues],lanes:c,hand:d,deckCount:s.deck.length,trashCount:s.discard.length,topTrashCard:u}}function au(t,n=!1){return{player:Lm(t.player),opponent:Lm(t.opponent),turn:t.turn,phase:t.phase,controlCardHolder:t.controlCardHolder,useControlMechanic:n,winner:null,log:[],actionRequired:null,queuedActions:[],compilableLanes:[]}}function Lm(t){const n=Array(t.deckCount).fill(null).map((s,c)=>({id:`fake-deck-${c}`,protocol:"Unknown",value:0,isFaceUp:!1,bottomRule:"",middleRule:""})),r=[];if(t.topTrashCard){for(let s=0;s<t.trashCount-1;s++)r.push({id:`fake-discard-${s}`,protocol:"Unknown",value:0,isFaceUp:!1,bottomRule:"",middleRule:""});r.push(t.topTrashCard)}return{protocols:t.protocols,deck:n,hand:t.hand,lanes:t.lanes,discard:r,compiled:t.compiled,laneValues:t.laneValues,cannotCompile:!1,stats:{cardsPlayed:0,cardsDrawn:0,cardsDeleted:0,protocolsCompiled:0,effectsTriggered:0}}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const ia={play:1e3,delete:1e3,flip:400,shift:1e3,return:1e3,discard:800,draw:1200,compile:1200,give:800,take:800,reveal:800,swap:600,refresh:1200,phaseTransition:400,delay:1e3},Um=1200,sx=80,hy=100;function my(t){if(t<=0)return 0;if(t===1)return Um;const n=Math.floor(Um/t);return Math.max(n,sx)}const cx=1200,ix={play:"ease-out",delete:"ease-in",flip:"ease-in-out",shift:"ease-in-out",return:"ease-out",discard:"ease-in",draw:"ease-out",compile:"ease-in-out",give:"ease-in-out",take:"ease-in-out",reveal:"ease-in-out",swap:"ease-in-out",refresh:"ease-out",phaseTransition:"ease-in-out",delay:"linear"},dx=400;/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */let ux=0;function Qn(t){return`${t}-${Date.now()}-${++ux}`}function sa(t,n,r){const s=t[r];for(let c=0;c<s.lanes.length;c++){const u=s.lanes[c].findIndex(p=>p.id===n);if(u!==-1)return{laneIndex:c,cardIndex:u}}return null}function Om(t,n,r){return t[r].hand.findIndex(s=>s.id===n)}function Zo(t,n,r,s,c=!0,d,u=!0,p=!1){const f=$n(t),h=t[r].lanes[s].length,y=c?{type:"hand",owner:r,handIndex:d??0}:{type:"deck",owner:r},m={type:"lane",owner:r,laneIndex:s,cardIndex:h};return{id:Qn("play"),type:"play",snapshot:f,duration:ia.play,animatingCard:{card:n,fromPosition:y,toPosition:m,targetIsFaceUp:u,isOpponentAction:p},laneIndex:s}}function gl(t,n,r,s,c,d=!1,u){const p=$n(t,u),f={type:"lane",owner:r,laneIndex:s,cardIndex:c},h={type:"trash",owner:r};return{id:Qn("delete"),type:"delete",snapshot:p,duration:ia.delete,animatingCard:{card:n,fromPosition:f,toPosition:h,targetRotation:90,isOpponentAction:d},laneIndex:s}}function $u(t,n,r,s,c,d,u=!1){const p=$n(t),f={type:"lane",owner:r,laneIndex:s,cardIndex:c};return{id:Qn("flip"),type:"flip",snapshot:p,duration:ia.flip,animatingCard:{card:n,fromPosition:f,toPosition:f,flipDirection:d?"toFaceUp":"toFaceDown",isOpponentAction:u},laneIndex:s}}function _s(t,n,r,s,c,d,u=!1){const p=$n(t),f=t[r].lanes[d].length,h={type:"lane",owner:r,laneIndex:s,cardIndex:c},y={type:"lane",owner:r,laneIndex:d,cardIndex:f};return{id:Qn("shift"),type:"shift",snapshot:p,duration:ia.shift,animatingCard:{card:n,fromPosition:h,toPosition:y,isOpponentAction:u},laneIndex:s}}function vl(t,n,r,s,c,d=!0,u=!1,p){const f=$n(t,p),h={type:"lane",owner:r,laneIndex:s,cardIndex:c},y={type:"hand",owner:r,handIndex:t[r].hand.length};return{id:Qn("return"),type:"return",snapshot:f,duration:ia.return,animatingCard:{card:n,fromPosition:h,toPosition:y,targetIsFaceUp:n.isFaceUp,isOpponentAction:u},laneIndex:s}}function yy(t,n,r,s,c=!1){const d=$n(t),u={type:"hand",owner:r,handIndex:s},p={type:"trash",owner:r};return{id:Qn("discard"),type:"discard",snapshot:d,duration:ia.discard,animatingCard:{card:n,fromPosition:u,toPosition:p,targetRotation:90,isOpponentAction:c}}}function px(t,n,r,s,c){const d=n.length,u=Math.max(100,Math.floor(cx/d)),p=c??r;return n.map((f,h)=>{const y=n.slice(0,h),m={...t,[r]:{...t[r],hand:[...t[r].hand,...y]}},g=$n(m);return{id:Qn("draw"),type:"draw",snapshot:g,duration:u,animatingCard:{card:f,fromPosition:{type:"deck",owner:p},toPosition:{type:"hand",owner:r,handIndex:s+h}}}})}function gy(t,n){const r=new Set,s={player:[],opponent:[]},c=n.length,d=my(c);return n.map((u,p)=>{const f={...t,player:{...t.player,discard:[...t.player.discard,...s.player]},opponent:{...t.opponent,discard:[...t.opponent.discard,...s.opponent]}},h=$n(f,r);r.add(u.card.id);const{id:y,isFaceUp:m,...g}=u.card;s[u.owner].push({...g,id:y,isFaceUp:!0});const v={type:"lane",owner:u.owner,laneIndex:u.laneIndex,cardIndex:u.cardIndex},C={type:"trash",owner:u.owner};return{id:Qn("delete"),type:"delete",snapshot:h,duration:d,animatingCard:{card:u.card,fromPosition:v,toPosition:C,targetRotation:90,startDelay:p===0?hy:0},laneIndex:u.laneIndex}})}function Pu(t,n,r,s){const c=$n(t),d=r==="player"?"opponent":"player",u={type:"hand",owner:r,handIndex:s},p={type:"hand",owner:d,handIndex:t[d].hand.length};return{id:Qn("give"),type:"give",snapshot:c,duration:ia.give,animatingCard:{card:n,fromPosition:u,toPosition:p}}}function fx(t,n,r,s){const c=$n(t),u={type:"hand",owner:r==="player"?"opponent":"player",handIndex:s},p={type:"hand",owner:r,handIndex:t[r].hand.length};return{id:Qn("take"),type:"take",snapshot:c,duration:ia.take,animatingCard:{card:n,fromPosition:u,toPosition:p}}}function hx(t,n,r,s,c){const d=$n(t);let u;return u={type:"hand",owner:r,handIndex:c},{id:Qn("reveal"),type:"reveal",snapshot:d,duration:ia.reveal,animatingCard:{card:n,fromPosition:u,toPosition:u,flipDirection:"toFaceUp"}}}function mx(t,n=ia.delay,r){const s=$n(t);return{id:Qn("delay"),type:"delay",snapshot:s,duration:n,logMessage:r}}const al=["start","control","compile","action","hand_limit","end"];function yx(t,n,r,s,c){const d=$n(t),u=[],p=al.indexOf(n),f=c,h=al.indexOf(f);if(r===s)for(let m=p+1;m<=h;m++)u.push({phase:al[m],turn:r});else{for(let m=p+1;m<al.length;m++)u.push({phase:al[m],turn:r});for(let m=0;m<=h;m++)u.push({phase:al[m],turn:s})}const y=u.length*dx;return{id:Qn("phaseTransition"),type:"phaseTransition",snapshot:d,duration:y,phaseTransitionData:{fromPhase:n,toPhase:f,fromTurn:r,toTurn:s,phaseSequence:u}}}function gx(t,n,r=!1){switch(n.type){case"delete":{const s=sa(t,n.cardId,n.owner);if(!s)return console.warn("[convertAnimationRequest] delete: Card not found in lanes:",n.cardId),null;const c=t[n.owner].lanes[s.laneIndex][s.cardIndex];return c?gl(t,c,n.owner,s.laneIndex,s.cardIndex,r):(console.warn("[convertAnimationRequest] delete: Card object not found:",n.cardId),null)}case"flip":{const s=n.owner||(t.player.lanes.flat().some(p=>p.id===n.cardId)?"player":"opponent"),c=sa(t,n.cardId,s);if(!c)return console.warn("[convertAnimationRequest] flip: Card not found in lanes:",n.cardId),null;const d=t[s].lanes[c.laneIndex][c.cardIndex];if(!d)return console.warn("[convertAnimationRequest] flip: Card object not found:",n.cardId),null;const u=n.toFaceUp!==void 0?n.toFaceUp:!d.isFaceUp;return $u(t,d,s,c.laneIndex,c.cardIndex,u)}case"shift":{const s=sa(t,n.cardId,n.owner);if(!s)return console.warn("[convertAnimationRequest] shift: Card not found in lanes:",n.cardId),null;const c=t[n.owner].lanes[s.laneIndex][s.cardIndex];return c?_s(t,c,n.owner,n.fromLane,s.cardIndex,n.toLane,r):(console.warn("[convertAnimationRequest] shift: Card object not found:",n.cardId),null)}case"return":{const s=sa(t,n.cardId,n.owner);if(!s)return console.warn("[convertAnimationRequest] return: Card not found in lanes:",n.cardId),null;const c=t[n.owner].lanes[s.laneIndex][s.cardIndex];return c?vl(t,c,n.owner,s.laneIndex,s.cardIndex,r):(console.warn("[convertAnimationRequest] return: Card object not found:",n.cardId),null)}case"discard":{const s=Om(t,n.cardId,n.owner);if(s<0)return console.warn("[convertAnimationRequest] discard: Card not found in hand:",n.cardId),null;const c=t[n.owner].hand[s];return c?yy(t,c,n.owner,s,r):(console.warn("[convertAnimationRequest] discard: Card object not found:",n.cardId),null)}case"play":if(n.fromDeck&&n.toLane!==void 0){const s=sa(t,n.cardId,n.owner);if(!s)return console.warn("[convertAnimationRequest] play (from deck): Card not found in lanes:",n.cardId),null;const c=t[n.owner].lanes[s.laneIndex][s.cardIndex];if(!c)return console.warn("[convertAnimationRequest] play (from deck): Card object not found:",n.cardId),null;const d=n.prePlayLanes;let u=t;return d&&(u={...t,player:{...t.player,lanes:d.player},opponent:{...t.opponent,lanes:d.opponent}}),Zo(u,c,n.owner,n.toLane,!1,void 0,n.isFaceUp??!1,r)}else{const s=Om(t,n.cardId,n.owner),c=n.toLane??0;if(s>=0){const u=t[n.owner].hand[s];return Zo(t,u,n.owner,c,!0,s,n.isFaceUp??!0,r)}const d=sa(t,n.cardId,n.owner);if(d){const u=t[n.owner].lanes[d.laneIndex][d.cardIndex];return Zo(t,u,n.owner,c,!0,0,n.isFaceUp??!0,r)}return console.warn("[convertAnimationRequest] play: Card not found:",n.cardId),null}case"draw":return null;case"compile_delete":{const s=[];for(const d of n.deletedCards){const u=sa(t,d.cardId,d.owner);if(u){const p=t[d.owner].lanes[u.laneIndex][u.cardIndex];p&&s.push({card:p,owner:d.owner,laneIndex:u.laneIndex,cardIndex:u.cardIndex})}}if(s.length===0)return console.warn("[convertAnimationRequest] compile_delete: No cards found"),null;const c=gy(t,s);return c.length>0?c[0]:null}default:return console.warn("[convertAnimationRequest] Unknown animation type:",n.type),null}}function vx(t,n,r=!1){const s=[];for(const c of n){const d=gx(t,c,r);d&&s.push(d)}return s}function Ba(t,n,r,s){var v,C,b;if(!n||n.length===0)return;const c=[];let d=t.log.length-n.length;d<0&&(d=0);const u=new Set,p={player:[],opponent:[]},f={player:[],opponent:[]},h={player:0,opponent:0};for(const x of n)(x.type==="delete"||x.type==="discard")&&h[x.owner]++;const y={player:t.player.discard.slice(0,Math.max(0,t.player.discard.length-h.player)),opponent:t.opponent.discard.slice(0,Math.max(0,t.opponent.discard.length-h.opponent))},m=n.filter(x=>x.type==="delete").length;let g=0;for(const x of n){const j=t.log[d],E=j?{message:j.message,player:j.player}:void 0;if(d++,x.type==="play"&&x.fromDeck&&x.toLane!==void 0){const k=(v=t[x.owner].lanes[x.toLane])==null?void 0:v.find(L=>L.id===x.cardId),R=x.prePlayLanes,D=x.playIndex;if(k){let L;if(R&&D!==void 0){const F=R.player.map((B,G)=>{const W=n.filter(P=>P.type==="play"&&P.owner==="player"&&P.toLane===G&&P.playIndex!==void 0&&P.playIndex<D&&P.prePlayLanes===R).map(P=>{var z;return(z=t.player.lanes[G])==null?void 0:z.find(H=>H.id===P.cardId)}).filter(Boolean);return[...B,...W]}),U=R.opponent.map((B,G)=>{const W=n.filter(P=>P.type==="play"&&P.owner==="opponent"&&P.toLane===G&&P.playIndex!==void 0&&P.playIndex<D&&P.prePlayLanes===R).map(P=>{var z;return(z=t.opponent.lanes[G])==null?void 0:z.find(H=>H.id===P.cardId)}).filter(Boolean);return[...B,...W]});L={...t,player:{...t.player,lanes:F},opponent:{...t.opponent,lanes:U}}}else L={...t,[x.owner]:{...t[x.owner],lanes:t[x.owner].lanes.map((F,U)=>U===x.toLane?F.filter(B=>B.id!==x.cardId):F)}};const I=Zo(L,k,x.owner,x.toLane,!1,void 0,x.isFaceUp??!1,x.owner==="opponent");c.push({...I,logMessage:E})}}else if(x.type==="shift"){const k=x.cardSnapshot,R=x.cardIndex,D=x.preShiftLanes;let L=(C=t[x.owner].lanes[x.fromLane])==null?void 0:C.find(F=>F.id===x.cardId),I=L?(b=t[x.owner].lanes[x.fromLane])==null?void 0:b.findIndex(F=>F.id===x.cardId):R;if(!L&&k&&(L=k,I=R??0),L&&I!==void 0&&I>=0){let F=t;D&&(F={...t,player:{...t.player,lanes:D.player},opponent:{...t.opponent,lanes:D.opponent}});const U=_s(F,L,x.owner,x.fromLane,I,x.toLane);c.push({...U,logMessage:E})}}else if(x.type==="delete"){const k=x.cardSnapshot,R=x.laneIndex,D=x.cardIndex;let L,I,F;if(k&&R!==void 0&&D!==void 0)L=k,I=R,F=D;else{L=t[x.owner].lanes.flat().find(B=>B.id===x.cardId);const U=sa(t,x.cardId,x.owner);U&&(I=U.laneIndex,F=U.cardIndex)}if(L&&I!==void 0&&F!==void 0){const U={...t,player:{...t.player,discard:[...y.player,...p.player,...f.player]},opponent:{...t.opponent,discard:[...y.opponent,...p.opponent,...f.opponent]}},B=$n(U,u),G=my(m),W={id:Qn("delete"),type:"delete",snapshot:B,duration:G,animatingCard:{card:L,fromPosition:{type:"lane",owner:x.owner,laneIndex:I,cardIndex:F},toPosition:{type:"trash",owner:x.owner},targetRotation:90,startDelay:g===0?hy:0},laneIndex:I};c.push({...W,logMessage:E}),u.add(L.id);const{id:P,isFaceUp:z,...H}=L;p[x.owner].push({...H,id:P,isFaceUp:!0}),g++}}else if(x.type==="draw"){const k=t[x.player].hand,R=new Set(x.cardIds),D=k.filter(L=>R.has(L.id));if(D.length>0){const L=k.findIndex(G=>R.has(G.id));L>=0||k.length-D.length;const I=k.filter(G=>!R.has(G.id)),F={...t,[x.player]:{...t[x.player],hand:I}},U=x.fromOpponentDeck?x.player==="player"?"opponent":"player":void 0,B=px(F,D,x.player,I.length,U);B.length>0&&(c.push({...B[0],logMessage:E}),c.push(...B.slice(1)))}}else if(x.type==="return"){const k=x.cardSnapshot,R=x.laneIndex,D=x.cardIndex;if(k&&R!==void 0&&D!==void 0){const L=vl(t,k,x.owner,R,D,!0);c.push({...L,logMessage:E})}else{const L=sa(t,x.cardId,x.owner),I=t[x.owner].lanes.flat().find(F=>F.id===x.cardId);if(I&&L){const F=vl(t,I,x.owner,L.laneIndex,L.cardIndex,!0);c.push({...F,logMessage:E})}}}else if(x.type==="flip"){const k={type:"delay",snapshot:$n(t),duration:ia.flip,logMessage:E};c.push(k)}else if(x.type==="discard"){const k=x.cardSnapshot,R=x.preDiscardHand,D=x.discardIndex,L=k??t[x.owner].hand.find(W=>W.id===x.cardId);if(!L)continue;let I;if(R&&D!==void 0&&D>0){const W=new Set(n.filter(P=>P.type==="discard"&&P.discardIndex!==void 0&&P.discardIndex<D&&P.preDiscardHand===R).map(P=>{var z;return(z=P.cardSnapshot)==null?void 0:z.id}).filter(Boolean));I=R.filter(P=>!W.has(P.id))}else R?I=R:I=t[x.owner].hand;const F=I.findIndex(W=>W.id===L.id);if(F<0)continue;const U={...t,player:{...t.player,discard:[...y.player,...p.player,...f.player]},opponent:{...t.opponent,discard:[...y.opponent,...p.opponent,...f.opponent]}},B={...U,[x.owner]:{...U[x.owner],hand:I}},G=yy(B,L,x.owner,F);c.push({...G,logMessage:E}),f[x.owner].push(L)}else if(x.type==="take"){const k=x.cardSnapshot,R=x.fromHandIndex;if(!k||R===void 0)continue;const D=x.owner==="player"?"opponent":"player",L=t[x.owner].hand.filter(B=>B.id!==k.id),I=[...t[D].hand];I.splice(R,0,k);const F={...t,[x.owner]:{...t[x.owner],hand:L},[D]:{...t[D],hand:I}},U=fx(F,k,x.owner,R);c.push({...U,logMessage:E})}else if(x.type==="give"){const k=x.cardSnapshot,R=x.handIndex;if(!k||R===void 0)continue;const D=x.owner==="player"?"opponent":"player",L=[...t[x.owner].hand];L.splice(R,0,k);const I=t[D].hand.filter(B=>B.id!==k.id),F={...t,[x.owner]:{...t[x.owner],hand:L},[D]:{...t[D],hand:I}},U=Pu(F,k,x.owner,R);c.push({...U,logMessage:E})}}c.forEach(x=>r(x))}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Yc=t=>t==="player"?"Player":"Opponent",qu=(t,n=!1)=>!t.isFaceUp&&!n?"a face-down card":`${t.protocol}-${t.value}`;function wu(t,n,r,s,c){const d=Yc(t),u=`${n.protocol}-${n.value}`;let p=`${d} plays ${u}`;return s||(p+=" face-down"),c&&c!==t?p+=` into ${c==="player"?"Player's":"Opponent's"} Protocol ${r}.`:p+=` into Protocol ${r}.`,p}function _x(t,n,r,s){const c=Yc(t),d=qu(n,!0);return`${c} shifts ${d} from ${r} to ${s}.`}function wx(t,n){return`Shifting all cards from ${t} to ${n}.`}function Lu(t){return`Deleting ${qu(t,!0)}.`}function xx(t){return`Returning ${qu(t,!0)} to hand.`}function Cx(t,n){return`${Yc(t)} returns all cards from ${n} to hand.`}function vy(t,n){return`Flipping ${`${t.protocol}-${t.value}`} ${n?"face-up":"face-down"}.`}function Sx(t,n){return`${Yc(t)} compiles Protocol ${n}!`}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function Ie(t,n){if(!n)return null;for(const r of["player","opponent"])for(let s=0;s<t[r].lanes.length;s++){const c=t[r].lanes[s];for(let d=0;d<c.length;d++)if(c[d].id===n)return{card:c[d],owner:r,laneIndex:s,cardIndex:d}}return null}function vo(t,n){var s;if(!n)return!1;const r=t._committedCardId;for(const c of["player","opponent"])for(const d of t[c].lanes){if(d.length===0)continue;let u=d.length-1;const p=d[d.length-1].id;if(r&&d.length>=2&&p===r&&n!==r&&(u=d.length-2),((s=d[u])==null?void 0:s.id)===n)return!0}return!1}function bx(t,n){if(!n)return!1;for(const r of["player","opponent"])for(const s of t[r].lanes)if(s.length!==0&&s[s.length-1].id===n)return!0;return!1}function Ko(t,n){return n?t._committedCardId===n:!1}function Jo(t,n,r){if(n.length===0||r<0||r>=n.length)return!1;const s=t._committedCardId;let c=n.length-1;return s&&n.length>=2&&n[n.length-1].id===s&&(c=n.length-2),r===c}function Ex(t,n,r,s){var f;let c={...t};const d=s||((f=t.actionRequired)==null?void 0:f.followUpEffect),u=Ie(c,n),p=u?wn(u.card,c[u.owner].lanes.find(h=>h.some(y=>y.id===n))||[]):0;if(c=gt(c),c.actionRequired=null,d&&r){const h=Ie(c,r);if(h){const y={cardOwner:h.owner,opponent:h.owner==="player"?"opponent":"player",currentTurn:c.turn,actor:h.owner,referencedCard:u==null?void 0:u.card,referencedCardValue:p};let m=-1;for(let g=0;g<c[h.owner].lanes.length;g++)if(c[h.owner].lanes[g].some(v=>v.id===r)){m=g;break}if(m!==-1)return _t(h.card,m,c,y,d).newState}}return c}function jx(t,n,r,s){var v,C,b,x,j;let c={...t};const d=(v=t.actionRequired)==null?void 0:v.followUpEffect,u=(C=t.actionRequired)==null?void 0:C.conditionalType;if(c=gt(c),c.actionRequired=null,s&&(c=br(c)),d&&s){const E=Ie(c,s);if(E){const k=((b=t.actionRequired)==null?void 0:b.previousHandSize)||0,R=c[n].hand.length,D=Math.max(0,k-R);if(!(u==="then"||u==="if_executed"&&D>0))return c;const I={cardOwner:E.owner,opponent:E.owner==="player"?"opponent":"player",currentTurn:c.turn,actor:n,discardedCount:D,previousHandSize:k};let F=-1;for(let U=0;U<c[E.owner].lanes.length;U++)if(c[E.owner].lanes[U].some(B=>B.id===s)){F=U;break}if(F!==-1)return _t(E.card,F,c,I,d).newState}return c}if(!r||!s)return c;const p=((x=t.actionRequired)==null?void 0:x.previousHandSize)||0,f=c[n].hand.length;if(Math.max(0,p-f)===0)return c;const y=(j=Ie(c,s))==null?void 0:j.card;y&&`${y.protocol}${y.value}`;const m=c.queuedActions&&c.queuedActions.length>0;let g=null;switch(r){case"fire_1":g={type:"select_cards_to_delete",count:1,sourceCardId:s,disallowedIds:[s],actor:n};break;case"fire_2":g={type:"select_card_to_return",sourceCardId:s,actor:n};break;case"fire_3":g={type:"select_card_to_flip",sourceCardId:s,actor:n,targetFilter:{position:"uncovered",excludeSelf:!0}};break}if(g)if(m){const E=c.queuedActions||[],k=E.filter(D=>D.type==="select_card_to_shift"&&D.followUpEffect),R=E.filter(D=>!(D.type==="select_card_to_shift"&&D.followUpEffect));c.queuedActions=[...R,g,...k]}else c.actionRequired=g;return c}function xu(t,n,r=null,s){const c=Ie(t,n);if(!c)return t;const{card:d,owner:u}=c;let p=-1,f=-1;for(let k=0;k<t[u].lanes.length;k++){const R=t[u].lanes[k].findIndex(D=>D.id===n);if(R!==-1){p=k,f=R;break}}if(!d.isFaceUp&&p!==-1&&!Ww(t,p).allowed)return t;const h=wt(t,"on_flip",{player:u,cardId:n});let y=h.newState;if(h.animationRequests&&s&&Ba(y,h.animationRequests,s),!Ie(y,n))return y;const g=y.actionRequired&&"actor"in y.actionRequired?y.actionRequired.actor:y.turn,v=g==="player"?"Player":"Opponent",C=u==="player"?"Player's":"Opponent's",b=d.isFaceUp?"face-down":"face-up",x=`${d.protocol}-${d.value}`;y=te(y,g,`${v} flips ${C} ${x} ${b}.`);const j={...y.stats[g],cardsFlipped:y.stats[g].cardsFlipped+1},E={...y[g],stats:j};if(y={...y,[g]:E,stats:{...y.stats,[g]:j}},d.isFaceUp&&(y=qc(y,d)),p!==-1&&f!==-1){const k=!d.isFaceUp;if(s){const R=$u(t,d,u,p,f,k),D=vy(d,k);s({...R,logMessage:{message:D,player:g}})}else{const R={type:"flip",cardId:n,owner:u,laneIndex:p,cardIndex:f},D=y._pendingAnimationRequests||[];y._pendingAnimationRequests=[...D,R]}}return y=_l(new Set([n]),y),y.actionRequired=r,y}function Sa(t,n,r){var u;const s=t[n].lanes[r];if(s.length===0)return{newState:t};const c=s[s.length-1],d=vo(t,c.id);if(c.isFaceUp&&d){const p=`${c.id}-${r}`;if((u=t.processedUncoverEventIds)!=null&&u.includes(p))return{newState:t};const f={source:t._currentEffectSource,phase:t._currentPhaseContext,indentLevel:t._logIndentLevel||0},h=`${c.protocol}-${c.value}`;let y=st(t,h);y=ft(y,"uncover"),y=te(y,n,`${c.protocol}-${c.value} is uncovered and its effects are re-triggered.`),y.processedUncoverEventIds=[...y.processedUncoverEventIds||[],p];const m={cardOwner:n,actor:n,currentTurn:y.turn,opponent:n==="player"?"opponent":"player",triggerType:"uncover"},g=Sl(c,r,y,m);if(g.newState.actionRequired||(g.newState={...g.newState,_currentEffectSource:f.source,_currentPhaseContext:f.phase,_logIndentLevel:f.indentLevel}),g.newState.actionRequired){const v=g.newState.actionRequired.actor;if(t._interruptedTurn&&v===t._interruptedTurn){const C=g.newState.actionRequired;return g.newState.actionRequired=null,g.newState.queuedActions=[...g.newState.queuedActions||[],C],g.newState=gt(g.newState),g}g.newState=gt(g.newState),v!==t.turn&&(g.newState._interruptedTurn=t.turn,g.newState._interruptedPhase=t.phase,g.newState._interruptedCardPlayedFlag=t._cardPlayedThisActionPhase,g.newState.turn=v,g.newState.actionRequired.type==="prompt_rearrange_protocols"&&(g.newState.actionRequired={...g.newState.actionRequired,originalAction:{type:"resume_interrupted_turn",interruptedTurn:t.turn,interruptedPhase:t.phase}}))}else g.newState._interruptedTurn&&(g.newState.turn=g.newState._interruptedTurn,g.newState._interruptedTurn=void 0,g.newState._interruptedPhase=void 0);return g}return{newState:t}}function kx(t,n,r){var s,c;for(const d of["player","opponent"])for(const u of t[d].lanes)for(const p of u){if(!p.isFaceUp)continue;const f=p.customEffects;if(!f)continue;const h=f.bottomEffects||[];for(const y of h){if(y.trigger!=="when_card_returned"||((s=y.params)==null?void 0:s.action)!=="redirect_return_to_deck")continue;const m=((c=y.params)==null?void 0:c.targetOwner)||"opponent",g=d;if(m==="opponent"&&n!==g||m==="own"&&n===g)return p}}return null}function Mc(t,n,r){const s=Ie(t,n);if(!s)return{newState:t};const{card:c,owner:d}=s,u=t[d].lanes.findIndex(D=>D.some(L=>L.id===c.id));if(u===-1)return{newState:t};const p=t[d].lanes[u],f=p.length>0&&p[p.length-1].id===n;let h={...t};const y=h.actionRequired&&"actor"in h.actionRequired?h.actionRequired.actor:h.turn,m=y==="player"?"Player":"Opponent",g=d==="player"?"Player's":"Opponent's",v=`${c.protocol}-${c.value}`,C=r||"owner_hand",b=C==="actor_hand"?y:d,x=C==="owner_hand"?kx(t,d):null,j={...h[d]};if(j.lanes=j.lanes.map(D=>D.filter(L=>L.id!==n)),h[d]=j,x){const D={...c,isFaceUp:!1,isRevealed:!1},L={...h[d]};L.deck=[D,...L.deck],h[d]=L;const I=`${x.protocol}-${x.value}`;h=te(h,y,`${I}: ${g} ${v} is put on top of their deck face-down instead of returning to hand.`)}else if(C==="actor_hand"&&y!==d){const D={...h[b]};D.hand=[...D.hand,{...c,isFaceUp:!0,isRevealed:!1}],h[b]=D,h=te(h,y,`${m} takes ${g} ${v} and puts it into their hand.`)}else{const D={...h[b]};D.hand=[...D.hand,{...c,isFaceUp:!0,isRevealed:!1}],h[b]=D,h=te(h,y,`${m} returns ${g} ${v} to their hand.`)}h=gt(h);const E={...h.stats[y],cardsReturned:h.stats[y].cardsReturned+1},k={...h[y],stats:E};h={...h,[y]:k},h.actionRequired=null;const R=qe(h);return f&&R[d].lanes[u].length>0?Sa(R,d,u):{newState:R}}function Xo(t,n,r,s,c){const d=Ie(t,n);if(!d||d.owner!==r)return{newState:t};const{card:u}=d,p=t[r];let f=-1;for(let q=0;q<p.lanes.length;q++)if(p.lanes[q].some(O=>O.id===n)){f=q;break}if(f===-1)return{newState:t};if(f===s)return{newState:t};if(!gs(t,f,s).allowed)return{newState:t};const y=t[r].lanes[f],m=y.length>0&&y[y.length-1].id===n,g=y.findIndex(q=>q.id===n),v={player:t.player.lanes.map(q=>q.map(O=>({...O}))),opponent:t.opponent.lanes.map(q=>q.map(O=>({...O})))},C=p.lanes.map((q,O)=>O===f?q.filter(M=>M.id!==n):q),b=C[s].length>0?C[s][C[s].length-1]:null;let x={...t,[r]:{...p,lanes:C}};x._committedCardId=n;const j=C.map((q,O)=>O===s?[...q,u]:q),E={...p,lanes:j};let k={...x,[r]:E};(!t._currentEffectSource||!t._currentPhaseContext)&&(k=st(k,void 0),k=ft(k,void 0));const R=c==="player"?"Player":"Opponent",D=r==="player"?"Player's":"Opponent's",L=u.isFaceUp?`${u.protocol}-${u.value}`:"a card",I=k[r].protocols[s];k=te(k,c,`${R} shifts ${D} ${L} to Protocol ${I}.`);const F={...k.stats[c],cardsShifted:k.stats[c].cardsShifted+1},U={...k[c],stats:F};k={...k,[c]:U,stats:{...k.stats,[c]:F}},k=gt(k),k.actionRequired=null;let B=qe(k),G={newState:B};if(b){b.customEffects;const q={cardOwner:r,actor:c,currentTurn:B.turn,opponent:r==="player"?"opponent":"player",triggerType:"cover"};G=vs(b,s,B,q)}let W=G.newState,z=[{type:"shift",cardId:n,owner:r,fromLane:f,toLane:s,cardSnapshot:{...u},cardIndex:g,preShiftLanes:v},...G.animationRequests||[]];if(m){const q=Sa(W,r,f);W=q.newState,q.animationRequests&&z.push(...q.animationRequests)}const H=W[r].lanes[s],A=H.length>0&&H[H.length-1].id===n,N=!m;if(A&&u.isFaceUp&&N){const q=Sa(W,r,s);q.animationRequests&&z.push(...q.animationRequests);let O=q.newState;return!O.actionRequired&&(!O.queuedActions||O.queuedActions.length===0)&&(O._committedCardId=void 0),{newState:O,animationRequests:z.length>0?z:void 0}}let T=W;return!T.actionRequired&&(!T.queuedActions||T.queuedActions.length===0)&&(T._committedCardId=void 0),{newState:T,animationRequests:z.length>0?z:void 0}}const Cu=(t,n)=>{var y;const r=Ie(t,n);if(!r)return{newState:t};const{card:s,owner:c}=r,d=t[c].lanes.findIndex(m=>m.some(g=>g.id===s.id));if(d===-1)return{newState:t};let u=t;const p=t._pendingCustomEffects;p&&((y=p.effects)==null?void 0:y.length)>0&&p.effects.some(g=>g.useCardFromPreviousEffect)&&(u={...t,_pendingCustomEffects:{...p,selectedCardFromPreviousEffect:n}});const f={cardOwner:c,actor:c,currentTurn:u.turn,opponent:c==="player"?"opponent":"player",triggerType:"flip"},h=Sl(s,d,u,f);if(h.newState.actionRequired){h.newState=gt(h.newState);const m=h.newState.actionRequired.actor;if(t._interruptedTurn&&m===t._interruptedTurn)return h.newState.queuedActions=[...h.newState.queuedActions||[],h.newState.actionRequired],h.newState=gt(h.newState),h.newState.actionRequired=null,h;m!==t.turn&&(h.newState._interruptedTurn=t.turn,h.newState._interruptedPhase=t.phase,h.newState._interruptedCardPlayedFlag=t._cardPlayedThisActionPhase,h.newState.turn=m,h.newState.actionRequired.type==="prompt_rearrange_protocols"&&(h.newState.actionRequired={...h.newState.actionRequired,originalAction:{type:"resume_interrupted_turn",interruptedTurn:t.turn,interruptedPhase:t.phase}}))}return h};function Rx(t,n){const r=[];if(t[n].lanes.forEach((c,d)=>{if(c.length>0){const u=c[c.length-1],p=wn(u,c);r.push({card:u,laneIndex:d,owner:n,value:p})}}),r.length===0)return[];const s=Math.max(...r.map(c=>c.value));return r.filter(c=>c.value===s)}function Er(t){const n=new Set;for(const r of["player","opponent"])for(const s of t[r].lanes)for(const c of s)c.isFaceUp&&n.add(c.protocol);return n.size}function Nx(t,n){const r=new Set;for(const s of["player","opponent"]){const c=t[s].lanes[n];if(c)for(const d of c)d.isFaceUp&&r.add(d.protocol)}return r.size}function Uu(t,n,r){let s=0;for(const c of["player","opponent"])for(const d of t[c].lanes)for(const u of d)if(u.isFaceUp&&u.protocol===n){if(r&&u.id===r)continue;s++}return s}function ws(t,n){return Uu(t,n.protocol,n.id)>0}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Draw Effect Executor
 *
 * Handles all draw-related effects.
 * Extracted 1:1 from effectInterpreter.ts for modularity.
 */function Mm(t,n,r,s){let c=[...t],d=[...r],u=[],p=!1;for(let h=0;h<s;h++){if(c.length===0){if(d.length===0)break;c=Yn(d),d=[],p=!0}const y=c.shift();u.push({...y,id:pt(),isFaceUp:!0})}return{drawnCards:[...n,...u],remainingDeck:c,newCards:u,newDiscard:d,reshuffled:p}}function Tx(t,n,r,s,c){var F,U,B,G,W,P,z,H,A,N;const d=c._conditional,{cardOwner:u}=s,f=(c.target||"self")==="opponent"?s.opponent:u,h=Fu(r,f);if(!h.allowed)return{newState:te(r,u,h.reason||"Cannot draw cards.")};if(c.conditional){let T=0;switch(c.conditional.type){case"non_matching_protocols":{for(let Ce=0;Ce<3;Ce++){const pe=r.player.protocols[Ce],_e=r.opponent.protocols[Ce],ee=r.player.lanes[Ce].filter(Ue=>Ue.isFaceUp),je=r.opponent.lanes[Ce].filter(Ue=>Ue.isFaceUp);[...ee,...je].some(Ue=>Ue.protocol!==pe&&Ue.protocol!==_e)&&T++}break}case"count_face_down":{let Ce=0;for(const pe of["player","opponent"])for(const _e of r[pe].lanes)Ce+=_e.filter(ee=>!ee.isFaceUp).length;T=Ce;break}case"is_covering":{T=r[u].lanes[n].length>1?c.count||1:0;break}case"same_protocol_on_field":{ws(r,t)?T=c.count||1:T=0;break}}let q=T;if(q<=0)return{newState:r};const{drawnCards:O,remainingDeck:M,newCards:Y,newDiscard:X,reshuffled:K}=Mm(r[f].deck,r[f].hand,r[f].discard,q);let ne={...r};if(ne[f]={...ne[f],deck:M,hand:O,discard:X},K&&(ne=te(ne,f,`${f==="player"?"Player":"Opponent"}'s deck is empty. Discard pile has been reshuffled into the deck.`)),ne.detailedGameStats&&Y.length>0){const Ce=f==="player"?"playerFromEffect":"aiFromEffect";ne={...ne,detailedGameStats:{...ne.detailedGameStats,cardsDrawn:{...ne.detailedGameStats.cardsDrawn,[Ce]:ne.detailedGameStats.cardsDrawn[Ce]+Y.length}}}}const Z=f==="player"?"Player":"Opponent";let oe="";switch(c.conditional.type){case"non_matching_protocols":oe=" from non-matching protocols";break;case"is_covering":oe=" (this card is covering another)";break;case"count_face_down":oe=" (for face-down cards)";break;default:oe=""}const xe=Y.length>0&&f==="player"?` (${Y.map(Ce=>`${Ce.protocol}-${Ce.value}`).join(", ")})`:"";ne=te(ne,f,`${Z} draws ${q} card${q!==1?"s":""}${oe}${xe}.`),q>0&&(ne=wt(ne,"after_draw",{player:f}).newState,ne=wt(ne,"after_opponent_draw",{player:f==="player"?"opponent":"player"}).newState),Y.length>0&&delete ne._effectSkippedNoTargets;const ye=Y.length>0?[{type:"draw",player:f,count:Y.length,cardIds:Y.map(Ce=>Ce.id)}]:[];return{newState:ne,animationRequests:ye}}let y=c.count||1;const m=c.countType||"fixed";switch(m){case"equal_to_card_value":{const T=r.lastCustomEffectTargetCardId;if(T){const q=Ie(r,T);if(q){const O=q.owner,M=r[O].lanes.find(Y=>Y.some(X=>X.id===T))||[];y=wn(q.card,M)}else if(r.lastCustomEffectTargetValue!==void 0)y=r.lastCustomEffectTargetValue;else return y=0,{newState:te(r,u,"Cannot draw cards - referenced card is no longer available.")}}else r.lastCustomEffectTargetValue!==void 0?y=r.lastCustomEffectTargetValue:y=s.referencedCardValue||0;break}case"equal_to_discarded":y=(s.discardedCount||0)+(c.countOffset||0);break;case"hand_size":case"previous_hand_size":y=s.previousHandSize||s.handSize||0;break;case"count_face_down":{let T=0;for(const q of["player","opponent"])for(const O of r[q].lanes)T+=O.filter(M=>!M.isFaceUp).length;y=T*(c.count||1);break}case"all_matching":{if(((F=c.valueFilter)==null?void 0:F.equals)!==void 0){const T=c.valueFilter.equals;y=r[f].deck.filter(O=>O.value===T).length}else y=0;break}case"equal_to_unique_protocols_in_lane":{y=Nx(r,n);break}case"count_own_protocol_cards_on_field":{y=Uu(r,t.protocol);break}case"fixed":default:y=c.count||1;break}if(y<=0)return{newState:r};if(((U=c.advancedConditional)==null?void 0:U.type)==="protocol_match"){const T=c.advancedConditional.protocol;if(r[u].protocols[n]!==T)return{newState:r}}if(((B=c.advancedConditional)==null?void 0:B.type)==="empty_hand"&&r[f].hand.length>0)return{newState:r};if(((G=c.advancedConditional)==null?void 0:G.type)==="opponent_higher_value_in_lane"){const T=u==="player"?"opponent":"player",q=ba(r,u,n);if(ba(r,T,n)<=q)return{newState:r}}if(((W=c.advancedConditional)==null?void 0:W.type)==="same_protocol_on_field"&&!ws(r,t))return{newState:r};let g={...r};if(((P=c.advancedConditional)==null?void 0:P.type)==="compile_block"){const T=c.advancedConditional.turnDuration||1,q=u==="player"?"opponent":"player";g={...g,compileBlockedUntilTurn:(g.turnNumber||0)+T,compileBlockedPlayer:q},g=te(g,u,`Opponent can't compile for ${T} turn${T!==1?"s":""}.`)}if(c.optional)return g.actionRequired={type:"prompt_optional_draw",sourceCardId:t.id,actor:u,count:y,drawingPlayer:f,followUpEffect:d==null?void 0:d.thenEffect,conditionalType:d==null?void 0:d.type,logSource:r._currentEffectSource,logPhase:r._currentPhaseContext,logIndentLevel:r._logIndentLevel||0},{newState:g};const v=c.source;let C;v==="opponent_deck"?C=s.opponent:v==="own_deck"?C=u:C=f;let b,x,j=[],E=g[C].discard,k=!1;if(m==="all_matching"&&((z=c.valueFilter)==null?void 0:z.equals)!==void 0){const T=c.valueFilter.equals,q=g[C].deck,O=q.filter(Y=>Y.value===T),M=q.filter(Y=>Y.value!==T);j=O.map(Y=>({...Y,id:pt(),isFaceUp:!0})),b=[...g[f].hand,...j],x=M}else if(((H=c.valueFilter)==null?void 0:H.equals)!==void 0&&c.fromRevealed){const T=c.valueFilter.equals,q=g[C].deck,O=q.filter(M=>M.value===T);if(O.length===0){const M=`${t.protocol}-${t.value}`;g=te(g,f,`${M}: No cards with value ${T} in deck.`),b=g[f].hand,x=q,j=[]}else return g.actionRequired={type:"select_card_from_revealed_deck",sourceCardId:t.id,actor:f,count:y,valueFilter:T,revealedCards:q,selectableCardIds:O.map(M=>M.id||`deck-${q.indexOf(M)}`)},{newState:g}}else if(((A=c.valueFilter)==null?void 0:A.equals)!==void 0){const T=c.valueFilter.equals,q=[...g[C].deck],O=[];for(let X=0;X<q.length&&O.length<y;X++)q[X].value===T&&O.push(X);const M=O.map(X=>q[X]),Y=q.filter((X,K)=>!O.includes(K));j=M.map(X=>({...X,id:pt(),isFaceUp:!0})),b=[...g[f].hand,...j],x=Y}else if(((N=c.protocolFilter)==null?void 0:N.type)==="same_as_source"){const T=g[C].deck,q=t.protocol,O=[];return T.forEach((M,Y)=>{M.protocol===q&&O.push(Y)}),g.actionRequired={type:"reveal_deck_draw_protocol",sourceCardId:t.id,actor:f,revealedCards:T,targetProtocol:q,autoSelectedIndices:O,shuffleAfter:c.shuffleAfter||!1},{newState:g}}else{const T=Mm(g[C].deck,g[f].hand,g[C].discard,y);b=T.drawnCards,x=T.remainingDeck,j=T.newCards,E=T.newDiscard,k=T.reshuffled}if(g[C]={...g[C],deck:x,discard:E},g[f]={...g[f],hand:b},j.length>0&&delete g._effectSkippedNoTargets,k&&(g=te(g,f,`${C==="player"?"Player":"Opponent"}'s deck is empty. Discard pile has been reshuffled into the deck.`)),g.detailedGameStats&&j.length>0){const T=f==="player"?"playerFromEffect":"aiFromEffect";g={...g,detailedGameStats:{...g.detailedGameStats,cardsDrawn:{...g.detailedGameStats.cardsDrawn,[T]:g.detailedGameStats.cardsDrawn[T]+j.length}}}}const R=f==="player"?"Player":"Opponent";if(j.length===0)return v==="opponent_deck"?g=te(g,f,`${C==="player"?"Player's":"Opponent's"} deck and discard are empty. No cards drawn.`):v==="own_deck"&&f!==u?g=te(g,f,`${u==="player"?"Player's":"Opponent's"} deck and discard are empty. No cards drawn.`):g=te(g,f,"Deck and discard are empty. No cards drawn."),{newState:g};const D=j.length>0&&f==="player"?` (${j.map(T=>`${T.protocol}-${T.value}`).join(", ")})`:"";if(v==="opponent_deck"){const T=C==="player"?"Player's":"Opponent's";g=te(g,f,`${R} draws the top ${y===1?"card":`${y} cards`} of ${T} deck${D}.`)}else if(v==="own_deck"&&f!==u){const T=u==="player"?"Player's":"Opponent's";g=te(g,f,`${R} draws the top ${y===1?"card":`${y} cards`} of ${T} deck${D}.`)}else g=te(g,f,`${R} draws ${y} card${y!==1?"s":""}${D}.`);if(j.length>0&&(g=wt(g,"after_draw",{player:f,count:j.length}).newState,g=wt(g,"after_opponent_draw",{player:f==="player"?"opponent":"player",count:j.length}).newState),c.revealFromDrawn&&j.length>0){const T=c.revealFromDrawn.valueSource||"stated_number",q=c.revealFromDrawn.count||1;let O=j;if(T==="stated_number"){const Y=g.lastStatedNumber;Y===void 0?g=te(g,f,"No number was stated. Cannot filter drawn cards."):O=j.filter(X=>X.value===Y)}const M=q==="all"?O.length:Math.min(q,O.length);return g.actionRequired={type:"select_from_drawn_to_reveal",actor:f,sourceCardId:t.id,allDrawnCardIds:j.map(Y=>Y.id),eligibleCardIds:O.map(Y=>Y.id),revealCount:M,statedNumber:T==="stated_number"?g.lastStatedNumber:void 0,thenAction:c.revealFromDrawn.thenAction},{newState:g}}j.length>0&&delete g._effectSkippedNoTargets;const L=C!==f,I=j.length>0?[{type:"draw",player:f,count:j.length,cardIds:j.map(T=>T.id),...L?{fromOpponentDeck:!0}:{}}]:[];return{newState:g,animationRequests:I}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Flip Effect Executor
 *
 * Handles all flip-related effects.
 * Extracted 1:1 from effectInterpreter.ts for modularity.
 */function Dx(t,n,r,s,c){var j,E,k,R,D,L,I;const{cardOwner:d}=s,u=c._conditional;if(((j=c.advancedConditional)==null?void 0:j.type)==="same_protocol_on_field"&&!ws(r,t))return{newState:r};if(c.useCardFromPreviousEffect&&r.lastCustomEffectTargetCardId){const F=r.lastCustomEffectTargetCardId,U=Ie(r,F);if(!U)return{newState:te(r,d,"Target card from previous effect no longer exists. Flip skipped.")};let B={...r};const G=U.owner,W=B[G].lanes.findIndex(P=>P.some(z=>z.id===F));if(W!==-1){const z=B[G].lanes[W].find(H=>H.id===F);if(z){c.skipMiddleCommand&&!z.isFaceUp&&(B.skipNextMiddleCommand=F),z.isFaceUp&&(B=qc(B,z)),z.isFaceUp=!z.isFaceUp;const H=z.isFaceUp?"face-up":"face-down",A=c.skipMiddleCommand&&z.isFaceUp?", ignoring its middle commands":"";B=te(B,d,`Flips that card ${H}${A}.`)}}return{newState:B}}if(c.scope==="each_lane"){const F=c.targetFilter||{},U=za(r),B=H=>{const A=r.player.lanes[H],N=r.opponent.lanes[H];let T=[];if(F.position==="covered"?T=[...A.filter((O,M)=>M<A.length-1),...N.filter((O,M)=>M<N.length-1)]:T=[...A,...N],F.owner==="own")T=T.filter(O=>A.includes(O)&&d==="player"||N.includes(O)&&d==="opponent");else if(F.owner==="opponent"){const O=d==="player"?"opponent":"player";T=T.filter(M=>A.includes(M)&&O==="player"||N.includes(M)&&O==="opponent")}return F.excludeSelf&&(T=T.filter(O=>O.id!==t.id)),(U?T.filter(O=>O.isFaceUp):T).length>0},G=[0,1,2].filter(H=>B(H));if(G.length===0){let H=te(r,d,U?"No valid face-up targets to flip (Frost-1 is active).":"No valid targets to flip in any lane.");return H._effectSkippedNoTargets=!0,{newState:H}}const W=G[0],P=G.slice(1);let z={...r};return z.actionRequired={type:"select_card_to_flip",sourceCardId:t.id,actor:d,currentLaneIndex:W,remainingLanes:P,targetFilter:c.targetFilter,params:c,followUpEffect:u==null?void 0:u.thenEffect,conditionalType:u==null?void 0:u.type},{newState:z}}if(c.flipSelf){if(((E=c.advancedConditional)==null?void 0:E.type)==="protocol_match"){const G=c.advancedConditional.protocol;if(r[d].protocols[n]!==G)return{newState:r}}if(((k=c.advancedConditional)==null?void 0:k.type)==="opponent_higher_value_in_lane"){const G=d==="player"?"opponent":"player",W=ba(r,d,n);if(ba(r,G,n)<=W)return{newState:r}}if(((R=c.advancedConditional)==null?void 0:R.type)==="hand_size_greater_than"){const G=c.advancedConditional.threshold??0;if(r[d].hand.length<=G)return{newState:r}}if(((D=c.advancedConditional)==null?void 0:D.type)==="same_protocol_on_field"&&!ws(r,t))return{newState:r};if(((L=c.advancedConditional)==null?void 0:L.type)==="this_card_is_covered"){const G=r[d].lanes;let W=!1;for(let P=0;P<G.length;P++){const z=G[P],H=z.findIndex(A=>A.id===t.id);if(H!==-1&&H<z.length-1){W=!0;break}}if(!W)return{newState:r}}let F={...r};const B=F[d].lanes[n].find(G=>G.id===t.id);if(B){B.isFaceUp&&(F=qc(F,B)),B.isFaceUp=!B.isFaceUp;const G=d==="player"?"Player":"Opponent",W=B.isFaceUp?"face-up":"face-down";F=te(F,d,`${G} flips this card ${W}.`)}return{newState:F}}const p=c.count||1,f=((I=c.scope)==null?void 0:I.type)||c.scope||"anywhere",h=p==="all"||typeof p!="number",y=f==="this_lane"&&h,m=f==="anywhere"&&h;if(y||m){let F={...r};const U=d==="player"?"opponent":"player",B=c.targetFilter||{},G=za(r),W=new Set,P=m?[0,1,2]:[n];for(const z of P){const H=F[d].lanes[z];for(const N of H){if(B.excludeSelf&&N.id===t.id||B.faceState==="face_up"&&!N.isFaceUp||B.faceState==="face_down"&&N.isFaceUp||B.owner==="opponent")continue;const T=H.indexOf(N)===H.length-1;B.position==="uncovered"&&!T||B.position==="covered"&&T||m&&!B.position&&!T||G&&!N.isFaceUp||W.add(N.id)}const A=F[U].lanes[z];for(const N of A){if(B.faceState==="face_up"&&!N.isFaceUp||B.faceState==="face_down"&&N.isFaceUp||B.owner==="own")continue;const T=A.indexOf(N)===A.length-1;B.position==="uncovered"&&!T||B.position==="covered"&&T||m&&!B.position&&!T||G&&!N.isFaceUp||W.add(N.id)}}if(W.size>0){const z=m?"":" in this lane";F=te(F,d,`Flipping ${W.size} card(s)${z}.`);for(const H of W)for(const A of["player","opponent"])for(const N of F[A].lanes){const T=N.find(q=>q.id===H);T&&(T.isFaceUp&&(F=qc(F,T)),T.isFaceUp=!T.isFaceUp)}return{newState:F}}else return F=te(F,d,`No cards to flip${m?"":" in this lane"}.`),{newState:F}}const g=c.targetFilter||{},v=g.position||"uncovered",C=za(r),b=[];for(const F of["player","opponent"])for(let U=0;U<r[F].lanes.length;U++){const B=r[F].lanes[U];if(!(c.scope==="this_lane"&&U!==n)&&!(c.sameLaneAsFirst&&r.lastFlipLaneIndex!==void 0&&U!==r.lastFlipLaneIndex))for(let G=0;G<B.length;G++){const W=B[G];if(Ko(r,W.id))continue;const P=Jo(r,B,G);if(!(g.excludeSelf&&W.id===t.id||g.owner==="own"&&F!==d||g.owner==="opponent"&&F===d||v==="uncovered"&&!P||v==="covered"&&P||g.faceState==="face_up"&&!W.isFaceUp||g.faceState==="face_down"&&W.isFaceUp||C&&!W.isFaceUp||!ms(r,W.id).allowed)){if(g.valueMinGreaterThanHandSize){const H=r[d].hand.length;if(W.value<=H)continue}if(g.valueLessThanUniqueProtocolsOnField){const H=Er(r);if(W.value>=H)continue}b.push(W.id)}}}if(b.length===0){let F=r;if(g.valueMinGreaterThanHandSize){const U=r[d].hand.length,B=U+1;F=te(F,d,`Hand size: ${U} cards. No cards with value ${B} or higher available. Effect skipped.`)}else if(g.valueLessThanUniqueProtocolsOnField){const U=Er(r);F=te(F,d,`${U} unique protocols on field. No cards with value less than ${U} available. Effect skipped.`)}else F=te(F,d,"No valid cards to flip. Effect skipped.");return F._effectSkippedNoTargets=!0,{newState:F}}let x={...r};if(g.valueMinGreaterThanHandSize){const F=r[d].hand.length,U=F+1,B=p==="all"?"all cards":p===1?"1 card":`${p} cards`;x=te(x,d,`Hand size: ${F} cards. Flip ${B} with value ${U} or higher.`)}return x.actionRequired={type:"select_card_to_flip",count:p,sourceCardId:t.id,actor:d,targetFilter:c.targetFilter,optional:c.optional||!1,scope:c.scope,laneIndex:c.scope==="this_lane"?n:void 0,sameLaneAsFirst:c.sameLaneAsFirst||!1,restrictedLaneIndex:c.sameLaneAsFirst?r.lastFlipLaneIndex:void 0,followUpEffect:u==null?void 0:u.thenEffect,conditionalType:u==null?void 0:u.type},{newState:x}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Delete Effect Executor
 *
 * Handles all delete-related effects.
 * Extracted 1:1 from effectInterpreter.ts for modularity.
 */function ou(t,n,r){const{id:s,isFaceUp:c,...d}=r,u=[...t[n].discard,d];return{...t,[n]:{...t[n],discard:u}}}function Ax(t,n,r,s,c){var k,R,D,L,I,F,U,B,G,W,P,z;const{cardOwner:d}=s,u=c._conditional;let p=c.count||1;if(((k=c.advancedConditional)==null?void 0:k.type)==="empty_hand"&&r[d].hand.length>0)return{newState:r};if(((R=c.advancedConditional)==null?void 0:R.type)==="opponent_higher_value_in_lane"){const H=d==="player"?"opponent":"player",A=ba(r,d,n);if(ba(r,H,n)<=A)return{newState:r}}if(((D=c.advancedConditional)==null?void 0:D.type)==="this_card_is_covered"){const H=r[d].lanes;let A=!1;for(let N=0;N<H.length;N++){const T=H[N],q=T.findIndex(O=>O.id===t.id);if(q!==-1&&q<T.length-1){A=!0;break}}if(!A)return{newState:r}}if(c.useCardFromPreviousEffect&&r.lastCustomEffectTargetCardId){const H=r.lastCustomEffectTargetCardId,A=Ie(r,H);if(!A)return{newState:te(r,d,"Target card from previous effect no longer exists. Delete skipped.")};let N={...r};const T=A.owner,q=N[T].lanes.findIndex(O=>O.some(M=>M.id===H));if(q!==-1){const O=[...N[T].lanes[q]],M=O.findIndex(Y=>Y.id===H);if(M!==-1){const Y=M===O.length-1,X=O[M];O.splice(M,1);const K=[...N[T].lanes];K[q]=O,N={...N,[T]:{...N[T],lanes:K}},N=ou(N,T,X);const ne=A.card.isFaceUp?`${A.card.protocol}-${A.card.value}`:"that card";N=te(N,d,`Deletes ${ne}.`);const Z={...N.stats[d],cardsDeleted:N.stats[d].cardsDeleted+1};N={...N,stats:{...N.stats,[d]:Z}};const oe=s.triggerType==="cover"||s.triggerType==="on_cover";Y&&O.length>0&&!oe&&(N=Sa(N,T,q).newState);const xe=[{type:"delete",cardId:H,owner:T,cardSnapshot:{...X},laneIndex:q,cardIndex:M}];return{newState:N,animationRequests:xe}}}return{newState:N}}if((L=c.scope)!=null&&L.minCardsInLane){const H=c.scope.minCardsInLane,A=((I=r.player.lanes[n])==null?void 0:I.length)||0,N=((F=r.opponent.lanes[n])==null?void 0:F.length)||0;if(A+N<H)return{newState:r}}let f=[0,1,2];if(((U=c.laneCondition)==null?void 0:U.type)==="opponent_higher_value"&&(f=rC(r,d),f.length===0)){let H=te(r,d,"No lanes where opponent has higher value. Delete effect skipped.");return H._effectSkippedNoTargets=!0,{newState:H}}const h=c.actorChooses||"effect_owner",y=((B=c.targetFilter)==null?void 0:B.owner)||"any";let m=d;h==="card_owner"&&y==="opponent"&&(m=s.opponent);const g=c.targetFilter||{},v=g.position||"uncovered",C=[];for(const H of["player","opponent"])for(let A=0;A<r[H].lanes.length;A++){if(((G=c.scope)==null?void 0:G.type)==="this_line"&&A!==n)continue;const N=r[H].lanes[A];for(let T=0;T<N.length;T++){const q=N[T];if(Ko(r,q.id))continue;const O=Jo(r,N,T);if(!(c.excludeSelf&&q.id===t.id)&&!(g.owner==="own"&&H!==d)&&!(g.owner==="opponent"&&H===d)&&!(v==="uncovered"&&!O)&&!(v==="covered"&&O)){if(v==="covered_by_context"&&s.triggerType==="cover"){if(H!==s.cardOwner&&O)continue}else if(v==="covered_by_context"&&O)continue;if(!(g.faceState==="face_up"&&!q.isFaceUp)&&!(g.faceState==="face_down"&&q.isFaceUp)){if(g.valueRange){const{min:M,max:Y}=g.valueRange;if(q.value<M||q.value>Y)continue}if(g.valueSource==="previous_effect_card"){const M=r.lastCustomEffectTargetValue;if(M===void 0||q.value!==M)continue}if(c.protocolMatching){const M=r.player.protocols[A],Y=r.opponent.protocols[A],X=q.protocol,K=X===M||X===Y;if(c.protocolMatching==="must_match"&&!K||c.protocolMatching==="must_not_match"&&K)continue}C.push(q.id)}}}}if(C.length===0){let H=te(r,d,"No valid cards to delete. Effect skipped.");return H._effectSkippedNoTargets=!0,{newState:H}}if(c.upTo&&(p=Math.min(p,C.length),p===0))return{newState:te(r,d,"No valid targets available. Delete effect skipped.")};let b=C;if(g.calculation==="highest_value"||g.calculation==="lowest_value"){const H=new Map;for(const T of C){const q=Ie(r,T);if(!q)continue;let O=-1;for(let Y=0;Y<r[q.owner].lanes.length;Y++)if(r[q.owner].lanes[Y].some(X=>X.id===T)){O=Y;break}let M=q.card.value;!q.card.isFaceUp&&O!==-1&&(M=r[q.owner].lanes[O].some(X=>X.isFaceUp&&X.protocol==="Darkness"&&X.value===2)?4:2),H.set(T,M)}const A=Array.from(H.values()),N=g.calculation==="highest_value"?Math.max(...A):Math.min(...A);b=C.filter(T=>H.get(T)===N)}if(c.autoExecute){const A=[...b].sort((q,O)=>{var oe,xe;const M=Ie(r,q),Y=Ie(r,O);if(!M||!Y)return 0;r[M.owner].lanes.flat().findIndex(ye=>ye.id===q),r[Y.owner].lanes.flat().findIndex(ye=>ye.id===O);const X=r[M.owner].lanes.findIndex(ye=>ye.some(Ce=>Ce.id===q)),K=r[Y.owner].lanes.findIndex(ye=>ye.some(Ce=>Ce.id===O)),ne=((oe=r[M.owner].lanes[X])==null?void 0:oe.findIndex(ye=>ye.id===q))??0;return(((xe=r[Y.owner].lanes[K])==null?void 0:xe.findIndex(ye=>ye.id===O))??0)-ne}).slice(0,p);let N=r;const T=[];for(const q of A){const O=Ie(N,q);if(!O)continue;const{card:M,owner:Y}=O;let X=-1;for(let ee=0;ee<N[Y].lanes.length;ee++)if(N[Y].lanes[ee].some(je=>je.id===q)){X=ee;break}if(X===-1)continue;const K=N[Y].lanes[X],ne=K[K.length-1].id===q,Z=M.isFaceUp?`${M.protocol}-${M.value}`:"a face-down card";N=te(N,d,`Effect triggers, deleting the lowest value covered card (${Y==="player"?"Player's":"Opponent's"} ${Z}).`);const xe=[...K],ye=xe.findIndex(ee=>ee.id===q);xe.splice(ye,1);const Ce=[...N[Y].lanes];Ce[X]=xe,N={...N,[Y]:{...N[Y],lanes:Ce}},N=ou(N,Y,M);const pe={...N.stats[d],cardsDeleted:N.stats[d].cardsDeleted+1};N={...N,stats:{...N.stats,[d]:pe}},T.push({type:"delete",cardId:q,owner:Y,cardSnapshot:{...M},laneIndex:X,cardIndex:ye});const _e=s.triggerType==="cover"||s.triggerType==="on_cover";ne&&xe.length>0&&!_e&&(N=Sa(N,Y,X).newState)}return{newState:N,animationRequests:T}}let x={...r};if(c.deleteSelf){if(((W=c.protocolCountConditional)==null?void 0:W.type)==="unique_protocols_on_field_below"){const Z=c.protocolCountConditional.threshold,oe=Er(r);if(oe>=Z)return x=te(x,d,`${oe} different protocols on field (need less than ${Z}). Card not deleted.`),{newState:x};x=te(x,d,`Only ${oe} different protocols on field (need ${Z}). Deleting this card.`)}const H=d,A=r[H].lanes[n];if(!A||A.length===0)return x=te(x,d,"Card already deleted. Delete effect skipped."),{newState:x};if(A.findIndex(Z=>Z.id===t.id)===-1)return x=te(x,d,"Card already deleted. Delete effect skipped."),{newState:x};const T=r[H].lanes[n],q=T.length>0&&T[T.length-1].id===t.id;x=te(x,d,`Deleting ${t.protocol}-${t.value}.`);const O=[...T],M=O.findIndex(Z=>Z.id===t.id);if(M===-1)return{newState:x};O.splice(M,1);const Y=[...x[H].lanes];Y[n]=O,x={...x,[H]:{...x[H],lanes:Y}},x=ou(x,H,t);const X={...x.stats[d],cardsDeleted:x.stats[d].cardsDeleted+1};x={...x,stats:{...x.stats,[d]:X}};const K=[{type:"delete",cardId:t.id,owner:H,cardSnapshot:{...t},laneIndex:n,cardIndex:M}],ne=s.triggerType==="cover"||s.triggerType==="on_cover";if(q&&O.length>0&&!ne){const Z=Sa(x,H,n);x=Z.newState,Z.animationRequests&&K.push(...Z.animationRequests)}return{newState:x,animationRequests:K}}if(c.selectLane)return x.actionRequired={type:"select_lane_for_delete",sourceCardId:t.id,actor:m,count:c.count,targetFilter:c.targetFilter,deleteAll:c.count==="all_in_lane"||c.count==="all",validLanes:f.length<3?f:void 0,laneCondition:c.laneCondition,followUpEffect:u==null?void 0:u.thenEffect,conditionalType:u==null?void 0:u.type},{newState:x};if(((P=c.scope)==null?void 0:P.type)==="each_lane"){const H=q=>{for(const O of["player","opponent"]){const M=r[O].lanes[q];for(let Y=0;Y<M.length;Y++){const X=M[Y];if(Ko(r,X.id))continue;const K=Jo(r,M,Y);if(!(c.excludeSelf&&X.id===t.id)&&!(g.owner==="own"&&O!==m)&&!(g.owner==="opponent"&&O===m)&&!(v==="uncovered"&&!K)&&!(v==="covered"&&K)&&!(g.faceState==="face_up"&&!X.isFaceUp)&&!(g.faceState==="face_down"&&X.isFaceUp))return!0}}return!1},A=[0,1,2].filter(q=>H(q));if(A.length===0)return x=te(x,d,"No valid targets to delete in any lane."),x._effectSkippedNoTargets=!0,{newState:x};const N=A[0],T=A.slice(1);return x.actionRequired={type:"select_cards_to_delete",count:p,sourceCardId:t.id,actor:m,currentLaneIndex:N,remainingLanes:T,disallowedIds:c.excludeSelf?[t.id]:[],targetFilter:c.targetFilter,scope:c.scope,protocolMatching:c.protocolMatching,params:c,followUpEffect:u==null?void 0:u.thenEffect,conditionalType:u==null?void 0:u.type},{newState:x}}if(((z=c.scope)==null?void 0:z.type)==="each_other_line"){const N=[0,1,2].filter(T=>T!==n).filter(T=>r.player.lanes[T].length>0||r.opponent.lanes[T].length>0).length;return N===0?(x=te(x,d,"No other lanes have cards. Effect skipped."),{newState:x}):(x.actionRequired={type:"select_card_from_other_lanes_to_delete",sourceCardId:t.id,disallowedLaneIndex:n,lanesSelected:[],count:N,actor:m,targetFilter:c.targetFilter,followUpEffect:u==null?void 0:u.thenEffect,conditionalType:u==null?void 0:u.type},{newState:x})}const j=g.valueSource==="previous_effect_card",E=b.length<C.length||j?b:void 0;return x.actionRequired={type:"select_cards_to_delete",count:p,sourceCardId:t.id,actor:m,actorChooses:h,disallowedIds:c.excludeSelf?[t.id]:[],followUpEffect:u==null?void 0:u.thenEffect,conditionalType:u==null?void 0:u.type,allowedIds:E,targetFilter:c.targetFilter,scope:c.scope,protocolMatching:c.protocolMatching},{newState:x}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Discard Effect Executor
 *
 * Handles all discard-related effects.
 * Extracted 1:1 from effectInterpreter.ts for modularity.
 */function Fx(t,n,r,s,c){const{cardOwner:d}=s,u=c._conditional;if(c.actor==="both"){let C={...r};const b=R=>{const D=C[R].hand;if(D.length===0)return{discardedCount:0,discardedCards:[]};const L=D.map(({id:I,isFaceUp:F,...U})=>U);return C[R]={...C[R],hand:[],discard:[...C[R].discard,...L],stats:{...C[R].stats,cardsDiscarded:C[R].stats.cardsDiscarded+L.length}},{discardedCount:L.length,discardedCards:L}},x=b(d),j=d==="player"?"Player":"Opponent";if(x.discardedCount>0){const R=x.discardedCards.map(D=>`${D.protocol}-${D.value}`).join(", ");C=te(C,d,`${j} discards their hand (${x.discardedCount} cards: ${R}).`)}else C=te(C,d,`${j} has no cards to discard.`);const E=b(s.opponent),k=s.opponent==="player"?"Player":"Opponent";if(E.discardedCount>0){const R=E.discardedCards.map(D=>`${D.protocol}-${D.value}`).join(", ");C=te(C,s.opponent,`${k} discards their hand (${E.discardedCount} cards: ${R}).`)}else C=te(C,s.opponent,`${k} has no cards to discard.`);return C._discardContext={actor:"both",discardedCount:x.discardedCount+E.discardedCount,sourceCardId:t.id},{newState:C}}const p=c.actor==="opponent"?s.opponent:d;if(c.useCardFromPreviousEffect&&r.lastCustomEffectTargetCardId){const C=r.lastCustomEffectTargetCardId;let b={...r};const x={...b[p]},j=`${t.protocol}-${t.value}`,E=p==="player"?"Player":"Opponent",k=x.deck.findIndex(D=>D.id===C);if(k!==-1){const D=[...x.deck],L=D.splice(k,1)[0];return x.deck=D,x.discard=[...x.discard,L],b[p]=x,b=te(b,p,`${E} discards ${L.protocol}-${L.value} from their deck.`),b._discardContext={actor:p,discardedCount:1,sourceCardId:t.id},{newState:b}}const R=x.hand.findIndex(D=>D.id===C);if(R!==-1){const D=[...x.hand],L=D.splice(R,1)[0],{id:I,isFaceUp:F,...U}=L;return x.hand=D,x.discard=[...x.discard,U],b[p]=x,b=te(b,p,`${E} discards ${L.protocol}-${L.value}.`),b._discardContext={actor:p,discardedCount:1,sourceCardId:t.id},{newState:b}}return console.warn(`[Discard Effect] useCardFromPreviousEffect: Card ${C} not found`),b=te(b,p,`${j}: Card to discard not found - effect skipped.`),b._discardContext={discardedCount:0},{newState:b}}const f=c.source||"hand";if(f==="entire_deck"){let C={...r};const b={...C[d]},x=`${t.protocol}-${t.value}`;if(b.deck.length===0)return C=te(C,d,`${x}: No cards in deck - effect skipped.`),C._effectSkippedNoTargets=!0,C._discardContext={discardedCount:0},{newState:C};const j=b.deck.length,E=[...b.deck];return b.discard=[...b.discard,...E],b.deck=[],C[d]=b,C=te(C,d,`${x}: Discards entire deck (${j} card${j!==1?"s":""}).`),C._discardContext={actor:d,discardedCount:j,sourceCardId:t.id},{newState:C}}if(f==="top_deck_own"||f==="top_deck_opponent"){const C=f==="top_deck_own"?d:s.opponent;let b={...r};const x={...b[C]},j=C===d?"your":"opponent's";if(x.deck.length===0)return b=te(b,d,`No cards in ${j} deck - effect skipped.`),b._effectSkippedNoTargets=!0,b._discardContext={discardedCount:0},{newState:b};const E=[...x.deck],k=E.shift();return x.deck=E,x.discard=[...x.discard,k],b[C]=x,b=te(b,d,`Discard the top card of ${j} deck: ${k.protocol}-${k.value}.`),b.lastCustomEffectTargetCardId=k.id,b.lastCustomEffectTargetValue=k.value,b._discardContext={actor:C,discardedCount:1,sourceCardId:t.id,discardedCardValue:k.value,discardedCardProtocol:k.protocol},b.actionRequired={type:"confirm_deck_discard",actor:d,sourceCardId:t.id,discardedCard:k,deckOwner:f==="top_deck_own"?"own":"opponent",followUpEffect:u==null?void 0:u.thenEffect,conditionalType:u==null?void 0:u.type,laneIndex:n},{newState:b}}let h=c.count||1;if((c.countType||"fixed")==="equal_to_discarded"){const C=(s.discardedCount||0)+(c.countOffset||0);if(h=Math.min(C,r[p].hand.length),h<=0){let x=te(r,p,`${p==="player"?"Player":"Opponent"} has no cards to discard - effect skipped.`);return x._effectSkippedNoTargets=!0,x._discardContext={discardedCount:0},{newState:x}}}if(r[p].hand.length===0){let b=te(r,p,`${p==="player"?"Player":"Opponent"} has no cards to discard - effect skipped.`);return b._effectSkippedNoTargets=!0,b._discardContext={discardedCount:0},{newState:b}}c.upTo&&(h=Math.min(h,r[p].hand.length));const m=h;typeof h=="number"&&h>r[p].hand.length&&(h=r[p].hand.length);const g=!c.upTo&&typeof m=="number"&&m>h;if(c.random&&p!==d){const C=[...r[p].hand],b=Math.min(h,C.length),x=[],j=C.map((B,G)=>G);for(let B=0;B<b&&j.length>0;B++){const G=Math.floor(Math.random()*j.length);x.push(j[G]),j.splice(G,1)}x.sort((B,G)=>G-B);const E=[],k=[...C];for(const B of x){const{id:G,isFaceUp:W,...P}=k.splice(B,1)[0];E.push(P)}const R=[...r[p].discard,...E],D={...r[p].stats,cardsDiscarded:r[p].stats.cardsDiscarded+E.length},L={...r[p],hand:k,discard:R,stats:D};let I={...r,[p]:L,stats:{...r.stats,[p]:D}};const F=p==="player"?"Player":"Opponent",U=E.length===1?"card":"cards";if(p==="player"||E.every(B=>B.isRevealed)){const B=E.map(G=>`${G.protocol}-${G.value}`).join(", ");I=te(I,p,`${F} randomly discards ${E.length} ${U}: ${B}.`)}else I=te(I,p,`${F} randomly discards ${E.length} ${U}.`);return I._discardContext={actor:p,discardedCount:E.length,sourceCardId:t.id},{newState:I}}if(h==="all"){const C=r[p].hand,b=C.map(({id:L,isFaceUp:I,...F})=>F),x=[],j=[...r[p].discard,...b],E={...r[p].stats,cardsDiscarded:r[p].stats.cardsDiscarded+b.length},k={...r[p],hand:x,discard:j,stats:E};let R={...r,[p]:k,stats:{...r.stats,[p]:E}};const D=p==="player"?"Player":"Opponent";if(p==="player"||b.every(L=>L.isRevealed)){const L=b.map(I=>`${I.protocol}-${I.value}`).join(", ");R=te(R,p,`${D} discards entire hand (${b.length} cards: ${L}).`)}else R=te(R,p,`${D} discards entire hand (${b.length} cards).`);return R._discardContext={actor:p,discardedCount:b.length,previousHandSize:C.length,sourceCardId:t.id},{newState:R}}let v={...r};return g&&(v=te(v,p,`${p==="player"?"Player":"Opponent"} only has ${h} card${h!==1?"s":""} (${m} required) - discarding all.`)),v.actionRequired={type:"discard",actor:p,count:h,sourceCardId:t.id,variableCount:c.variableCount||!1,previousHandSize:r[p].hand.length,followUpEffect:u==null?void 0:u.thenEffect,conditionalType:u==null?void 0:u.type,_savedIndentLevel:r._logIndentLevel,discardTo:c.discardTo||"own_trash"},{newState:v}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Shift Effect Executor
 *
 * Handles all shift-related effects.
 * Extracted 1:1 from effectInterpreter.ts for modularity.
 */function Ix(t,n,r,s,c){var I,F,U,B;const{cardOwner:d}=s,u=c._conditional;let p={...r};if(((I=c.advancedConditional)==null?void 0:I.type)==="empty_hand"&&r[d].hand.length>0)return{newState:r};if(((F=c.advancedConditional)==null?void 0:F.type)==="opponent_higher_value_in_lane"){const G=d==="player"?"opponent":"player",W=ba(r,d,n);if(ba(r,G,n)<=W)return{newState:r}}if(((U=c.advancedConditional)==null?void 0:U.type)==="this_card_is_covered"){const G=r[d].lanes;let W=!1;for(let P=0;P<G.length;P++){const z=G[P],H=z.findIndex(A=>A.id===t.id);if(H!==-1){W=H<z.length-1;break}}if(!W)return{newState:r}}if(c.useCardFromPreviousEffect&&r.lastCustomEffectTargetCardId){const G=r.lastCustomEffectTargetCardId,W=Ie(r,G);if(!W)return{newState:te(r,d,"Target card from previous effect no longer exists. Shift skipped.")};const P=c.destinationRestriction;if((P==null?void 0:P.type)==="to_this_lane"){const H=P.laneIndex==="current"?n:P.laneIndex;if(H===void 0||H<0||H>2)return console.error(`[Shift Effect] Invalid target lane index: ${H}`),{newState:r};const A=Xo(r,G,W.owner,H,d);return{newState:A.newState,animationRequests:A.animationRequests}}let z=-1;for(let H=0;H<r[W.owner].lanes.length;H++)if(r[W.owner].lanes[H].some(A=>A.id===G)){z=H;break}return z===-1?{newState:r}:(p.actionRequired={type:"select_lane_for_shift",cardToShiftId:G,cardOwner:W.owner,originalLaneIndex:z,sourceCardId:t.id,actor:d,destinationRestriction:P,followUpEffect:u==null?void 0:u.thenEffect,conditionalType:u==null?void 0:u.type},{newState:p})}const f=r._selectedCardFromPreviousEffect;if(p._selectedCardFromPreviousEffect&&delete p._selectedCardFromPreviousEffect,f&&c.useCardFromPreviousEffect){const G=c.destinationRestriction;if((G==null?void 0:G.type)==="to_this_lane"){const W=G.laneIndex==="current"?n:G.laneIndex;if(W===void 0||W<0||W>2)return console.error(`[Shift Effect] Invalid target lane index: ${W}`),{newState:p};const P=Ie(p,f);if(!P)return console.error(`[Shift Effect] Selected card not found: ${f}`),{newState:p};const z=Xo(p,f,P.owner,W,d);return{newState:z.newState,animationRequests:z.animationRequests}}return p.actionRequired={type:"shift_flipped_card_optional",cardId:f,sourceCardId:t.id,optional:c.optional||!1,actor:d,followUpEffect:u==null?void 0:u.thenEffect,conditionalType:u==null?void 0:u.type},{newState:p}}if(c.shiftSelf){if(((B=c.destinationRestriction)==null?void 0:B.type)==="opponent_highest_value_lane"){const G=Cy(p,d);if(G.includes(n))return p=te(p,d,"Card is already in opponent's highest value lane. Shift skipped."),{newState:p};const W=G.filter(P=>P!==n);if(W.length===0)return p=te(p,d,"No valid destination lane. Shift skipped."),{newState:p};if(W.length===1){if(c.optional)return p.actionRequired={type:"select_lane_for_shift",cardToShiftId:t.id,cardOwner:d,originalLaneIndex:n,sourceCardId:t.id,actor:d,validLanes:W,destinationRestriction:c.destinationRestriction,optional:!0,followUpEffect:u==null?void 0:u.thenEffect,conditionalType:u==null?void 0:u.type},{newState:p};const P=W[0],z=Xo(p,t.id,d,P,d);return{newState:z.newState,animationRequests:z.animationRequests}}return p.actionRequired={type:"select_lane_for_shift",cardToShiftId:t.id,cardOwner:d,originalLaneIndex:n,sourceCardId:t.id,actor:d,validLanes:W,destinationRestriction:c.destinationRestriction,optional:c.optional||!1,followUpEffect:u==null?void 0:u.thenEffect,conditionalType:u==null?void 0:u.type},{newState:p}}return p.actionRequired={type:"shift_flipped_card_optional",cardId:t.id,sourceCardId:t.id,optional:c.optional||!1,actor:d,allowCovered:c.allowCoveredSelf||!1,followUpEffect:u==null?void 0:u.thenEffect,conditionalType:u==null?void 0:u.type},{newState:p}}const h=c.targetFilter||{},y=h.position||"uncovered",m=h.faceState||"any",g=h.owner||"any",v=h.excludeSelf||!1,C=c.count||1;if(y==="any"&&g==="own"&&!v&&C===1)return p.actionRequired={type:"shift_flipped_card_optional",cardId:t.id,sourceCardId:t.id,optional:c.optional||!1,actor:d,followUpEffect:u==null?void 0:u.thenEffect,conditionalType:u==null?void 0:u.type},{newState:p};const x=[];for(const G of["player","opponent"])if(!(g==="own"&&G!==d)&&!(g==="opponent"&&G===d))for(let W=0;W<p[G].lanes.length;W++){if(c.scope==="this_lane"&&W!==n)continue;const P=p[G].lanes[W];for(let z=0;z<P.length;z++){const H=P[z];if(Ko(p,H.id)||v&&H.id===t.id)continue;const A=Jo(p,P,z);y==="uncovered"&&!A||y==="covered"&&A||m==="face_up"&&!H.isFaceUp||m==="face_down"&&H.isFaceUp||x.push({card:H,currentLane:W,owner:G})}}if(x.length===0)return p=te(p,d,"No valid cards to shift."),p._effectSkippedNoTargets=!0,{newState:p};if((C==="all"||typeof C!="number"&&C!==1)&&x.length>0){const G=[],W=c.destinationRestriction;for(let P=0;P<3;P++){if((W==null?void 0:W.type)==="to_another_line"){if(P===n)continue}else if((W==null?void 0:W.type)==="to_this_lane"){const z=W.laneIndex==="current"?n:W.laneIndex;if(P!==z)continue}else if(!W&&P===n)continue;G.push(P)}return G.length===0?(p=te(p,d,"No valid destination lanes for shifting all cards."),{newState:p}):(p=te(p,d,`Shifting ${x.length} card(s) from this lane.`),p.actionRequired={type:"select_lane_for_shift_all",sourceCardId:t.id,actor:d,cardsToShift:x.map(P=>({cardId:P.card.id,owner:P.owner})),validDestinationLanes:G,sourceLaneIndex:n,followUpEffect:u==null?void 0:u.thenEffect,conditionalType:u==null?void 0:u.type},{newState:p})}const E=c.destinationRestriction;let k=!1;const R=(E==null?void 0:E.laneIndex)==="current"?n:E==null?void 0:E.laneIndex;for(const{card:G,currentLane:W,owner:P}of x){if((E==null?void 0:E.type)==="non_matching_protocol"&&!G.isFaceUp)continue;const z=G.protocol;for(let H=0;H<3;H++){if(E){if(E.type==="non_matching_protocol"){if(H===W)continue;const N=p.player.protocols[H],T=p.opponent.protocols[H];if(z===N||z===T)continue}else if(E.type==="specific_lane"){if(H!==W)continue}else if(E.type==="to_this_lane"){if(H!==R||W===R)continue}else if(E.type==="to_another_line"){if(H===W)continue}else if(E.type==="to_or_from_this_lane"&&(!(W===R)&&!(H===R)||H===W))continue}else if(H===W)continue;if(gs(p,W,H).allowed){k=!0;break}}if(k)break}if(!k)return p=te(p,d,"No valid shift destinations available."),{newState:p};const D=E&&R!==void 0?{...E,laneIndex:R}:E,L=(E==null?void 0:E.type)==="to_this_lane"&&R!==void 0?R:void 0;return p.actionRequired={type:"select_card_to_shift",sourceCardId:t.id,actor:d,targetFilter:c.targetFilter,destinationRestriction:D,sourceLaneIndex:n,targetLaneIndex:L,scope:c.scope,followUpEffect:u==null?void 0:u.thenEffect,conditionalType:u==null?void 0:u.type},{newState:p}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Return Effect Executor
 *
 * Handles all return-related effects.
 * Extracted 1:1 from effectInterpreter.ts for modularity.
 */function $x(t,n,r,s,c){var x,j,E,k,R,D;const{cardOwner:d,opponent:u}=s,p=c._conditional;c.count==="all"||c.count;const f=((x=c.targetFilter)==null?void 0:x.owner)||"any",h=((j=c.targetFilter)==null?void 0:j.position)||"uncovered",y=(E=c.targetFilter)==null?void 0:E.faceState,m=c.destination||"owner_hand";if(((k=c.advancedConditional)==null?void 0:k.type)==="empty_hand"&&r[d].hand.length>0)return{newState:r};if(((R=c.advancedConditional)==null?void 0:R.type)==="opponent_higher_value_in_lane"){const L=d==="player"?"opponent":"player",I=ba(r,d,n);if(ba(r,L,n)<=I)return{newState:r}}if(((D=c.advancedConditional)==null?void 0:D.type)==="this_card_is_covered"){const L=r[d].lanes;let I=!1;for(let F=0;F<L.length;F++){const U=L[F],B=U.findIndex(G=>G.id===t.id);if(B!==-1&&B<U.length-1){I=!0;break}}if(!I)return{newState:r}}if(c.returnSelf){let L={...r};const I=L[d].lanes;for(let F=0;F<I.length;F++){const U=I[F],B=U.findIndex(G=>G.id===t.id);if(B!==-1){const[G]=U.splice(B,1);L[d].hand.push(G),L=te(L,d,`${d==="player"?"Player":"Opponent"} returns this card to hand.`);break}}return{newState:L}}if(c.selectLane){let L={...r};return L.actionRequired={type:"select_lane_for_return",sourceCardId:t.id,actor:d,count:c.count,targetFilter:c.targetFilter,followUpEffect:p==null?void 0:p.thenEffect,conditionalType:p==null?void 0:p.type},{newState:L}}let g=[];const v=L=>{var I;for(const F of r[L].lanes)for(let U=0;U<F.length;U++){const B=F[U];if(Ko(r,B.id))continue;const G=Jo(r,F,U);if(h==="uncovered"&&!G||h==="covered"&&G||y==="face_up"&&!B.isFaceUp||y==="face_down"&&B.isFaceUp)continue;const W=(I=c.targetFilter)==null?void 0:I.valueEquals;W!==void 0&&B.value!==W||g.push({card:B,isUncovered:G})}};if(f==="own"?v(d):f==="opponent"?v(u):(v("player"),v("opponent")),g.length===0)return{newState:te(r,d,"No cards on board to return. Effect skipped.")};let C={...r};const b=g.map(L=>L.card.id);return C.actionRequired={type:"select_card_to_return",sourceCardId:t.id,actor:d,targetOwner:f,targetFilter:c.targetFilter,destination:m,allowedIds:b,followUpEffect:p==null?void 0:p.thenEffect,conditionalType:p==null?void 0:p.type},{newState:C}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Play Effect Executor
 *
 * Handles all play-related effects (play cards from hand/deck to board).
 * Extracted 1:1 from effectInterpreter.ts for modularity.
 */function Px(t,n,r,s,c){var x,j,E,k,R,D,L,I,F,U,B,G,W;const{cardOwner:d,opponent:u}=s,p=c._conditional,f=c.count||1,h=c.source||"hand",y=c.faceDown,m=c.actor==="opponent"?u:d;if(((x=c.advancedConditional)==null?void 0:x.type)==="empty_hand"&&r[d].hand.length>0)return{newState:r};if(((j=c.advancedConditional)==null?void 0:j.type)==="opponent_higher_value_in_lane"){const P=d==="player"?"opponent":"player",z=ba(r,d,n);if(ba(r,P,n)<=z)return{newState:r}}if(h==="deck"&&((E=c.destinationRule)==null?void 0:E.type)==="each_other_line"){const P=[0,1,2].filter(Z=>Z!==n);if(P.length===0)return{newState:r};const z=r[m];if(z.deck.length===0&&z.discard.length===0)return{newState:te(r,d,`${m==="player"?"Player":"Opponent"} has no cards in deck/discard - effect skipped.`)};const{drawnCards:H,remainingDeck:A,newDiscard:N}=ca(z.deck,z.discard,P.length);if(H.length===0)return{newState:r};const T=H.map(Z=>({...Z,id:pt(),isFaceUp:!1})),q=[...z.lanes],O=[],M={player:r.player.lanes.map(Z=>Z.map(oe=>({...oe}))),opponent:r.opponent.lanes.map(Z=>Z.map(oe=>({...oe})))};for(let Z=0;Z<T.length;Z++){const oe=P[Z];q[oe]=[...q[oe],T[Z]],O.push({type:"play",cardId:T[Z].id,owner:m,toLane:oe,fromDeck:!0,isFaceUp:!1,prePlayLanes:M,playIndex:Z})}const Y={...z,lanes:q,deck:A,discard:N};let X={...r,[m]:Y};if(X.detailedGameStats&&H.length>0){const Z=m==="player"?"playerFromEffect":"aiFromEffect",oe=m==="player"?"playerFaceDown":"aiFaceDown";X={...X,detailedGameStats:{...X.detailedGameStats,cardsPlayed:{...X.detailedGameStats.cardsPlayed,[Z]:X.detailedGameStats.cardsPlayed[Z]+H.length,[oe]:X.detailedGameStats.cardsPlayed[oe]+H.length}}}}const K=Ie(r,t.id),ne=K?`${K.card.protocol}-${K.card.value}`:"a card effect";return X=te(X,d,`${ne}: Plays ${H.length} card(s) face-down in other lines.`),{newState:X,animationRequests:O.length>0?O:void 0}}if(h==="deck"&&((k=c.destinationRule)==null?void 0:k.type)==="each_line_with_card"){const P=c.destinationRule.ownerFilter||"any",z=c.destinationRule.cardFilter,H=P==="own"?m:P==="opponent"?m==="player"?"opponent":"player":null,A=je=>{const de=Pe=>Pe.length===0?!1:z?Pe.some(Ue=>z.faceState==="face_down"?!Ue.isFaceUp:z.faceState==="face_up"?Ue.isFaceUp:!0):!0;return H?de(r[H].lanes[je]):de(r.player.lanes[je])||de(r.opponent.lanes[je])},N=[];for(let je=0;je<3;je++)A(je)&&N.push(je);if(N.length===0)return{newState:r};const T=r[m];if(T.deck.length===0&&T.discard.length===0)return{newState:te(r,d,`${m==="player"?"Player":"Opponent"} has no cards in deck/discard - effect skipped.`)};const{drawnCards:q,remainingDeck:O,newDiscard:M}=ca(T.deck,T.discard,N.length);if(q.length===0)return{newState:r};const Y=q.map(je=>({...je,id:pt(),isFaceUp:!y}));let X=r;const K=[];for(let je=0;je<N.length;je++){const de=N[je],Pe=X[m].lanes[de];if(Pe.length>0){const Ue=Pe[Pe.length-1],se={...s,triggerType:"cover"},re=vs(Ue,de,X,se);if(X=re.newState,re.animationRequests&&K.push(...re.animationRequests),X.actionRequired)break}}const ne=[...X[m].lanes],Z=[],oe={player:X.player.lanes.map(je=>je.map(de=>({...de}))),opponent:X.opponent.lanes.map(je=>je.map(de=>({...de})))};for(let je=0;je<Y.length;je++){const de=N[je];ne[de]=[...ne[de],Y[je]],Z.push({type:"play",cardId:Y[je].id,owner:m,toLane:de,fromDeck:!0,isFaceUp:!y,prePlayLanes:oe,playIndex:je})}const xe={...X[m],lanes:ne,deck:O,discard:M};let ye={...X,[m]:xe};if(ye.detailedGameStats&&q.length>0){const je=m==="player"?"playerFromEffect":"aiFromEffect",de=m==="player"?"playerFaceDown":"aiFaceDown";ye={...ye,detailedGameStats:{...ye.detailedGameStats,cardsPlayed:{...ye.detailedGameStats.cardsPlayed,[je]:ye.detailedGameStats.cardsPlayed[je]+q.length,[de]:ye.detailedGameStats.cardsPlayed[de]+q.length}}}}const Ce=Ie(r,t.id),pe=Ce?`${Ce.card.protocol}-${Ce.card.value}`:"a card effect";let _e="";(z==null?void 0:z.faceState)==="face_down"?_e="with a face-down card":(z==null?void 0:z.faceState)==="face_up"?_e="with a face-up card":P==="own"?_e="where you have a card":P==="opponent"?_e="where opponent has a card":_e="with a card",ye=te(ye,d,`${pe}: Plays ${q.length} card(s) face-down in each line ${_e}.`);const ee=[...K,...Z];return{newState:ye,animationRequests:ee.length>0?ee:void 0}}if(h==="deck"&&((R=c.destinationRule)==null?void 0:R.type)==="another_line"){if([0,1,2].filter(O=>O!==n).length===0)return{newState:r};const z=r[m];if(z.deck.length===0&&z.discard.length===0)return{newState:te(r,d,`${m==="player"?"Player":"Opponent"} has no cards in deck/discard - effect skipped.`)};const{drawnCards:H,remainingDeck:A,newDiscard:N}=ca(z.deck,z.discard,1);if(H.length===0)return{newState:r};const T={...H[0],id:pt(),isFaceUp:!0};let q={...r,[m]:{...z,deck:A,discard:N}};return q.actionRequired={type:"confirm_deck_play_preview",sourceCardId:t.id,actor:m,drawnCard:T,isFaceDown:c.faceDown,excludeCurrentLane:!0,currentLaneIndex:n,followUpEffect:p==null?void 0:p.thenEffect,conditionalType:p==null?void 0:p.type},{newState:q}}if(h==="deck"&&((D=c.destinationRule)==null?void 0:D.type)==="under_this_card"&&((L=c.condition)==null?void 0:L.type)==="per_x_cards_in_line"){const P=c.condition.cardCount||2,z=r[d].lanes[n].length,H=r[u].lanes[n].length,A=z+H,N=Math.floor(A/P);if(N===0)return{newState:r};const T=r[m];if(T.deck.length===0&&T.discard.length===0)return{newState:r};const{drawnCards:q,remainingDeck:O,newDiscard:M}=ca(T.deck,T.discard,N);if(q.length===0)return{newState:r};const Y=q.map(Ce=>({...Ce,id:pt(),isFaceUp:!1})),X=[...T.lanes[n]];X.splice(X.length-1,0,...Y);const K=[...T.lanes];K[n]=X;const ne={...T,lanes:K,deck:O,discard:M};let Z={...r,[m]:ne};if(Z.detailedGameStats&&q.length>0){const Ce=m==="player"?"playerFromEffect":"aiFromEffect",pe=m==="player"?"playerFaceDown":"aiFaceDown";Z={...Z,detailedGameStats:{...Z.detailedGameStats,cardsPlayed:{...Z.detailedGameStats.cardsPlayed,[Ce]:Z.detailedGameStats.cardsPlayed[Ce]+q.length,[pe]:Z.detailedGameStats.cardsPlayed[pe]+q.length}}}}const oe=Y.map((Ce,pe)=>({type:"play",cardId:Ce.id,owner:m,toLane:n,fromDeck:!0,isFaceUp:!1})),xe=Ie(r,t.id),ye=xe?`${xe.card.protocol}-${xe.card.value}`:"a card effect";return Z=te(Z,d,`${ye}: Plays ${q.length} card(s) face-down under itself.`),{newState:Z,animationRequests:oe.length>0?oe:void 0}}if(h==="deck"&&((I=c.destinationRule)==null?void 0:I.type)==="specific_lane"){const P=c.destinationRule.laneIndex==="current"?n:c.destinationRule.laneIndex;if(P===void 0||P<0||P>2)return console.error(`[Play Effect] Invalid lane index: ${P}`),{newState:r};const z=c.sourceOwner||"own",H=z==="opponent"?m==="player"?"opponent":"player":m,A=r[H],N=c.targetBoard||"own",T=N==="opponent"?m==="player"?"opponent":"player":m;if(A.deck.length===0&&A.discard.length===0)return{newState:te(r,d,`No cards in ${z==="opponent"?"opponent's":"your"} deck/discard - effect skipped.`)};const{drawnCards:q,remainingDeck:O,newDiscard:M}=ca(A.deck,A.discard,f);if(q.length===0)return{newState:r};const Y=q.map(_e=>({..._e,id:pt(),isFaceUp:!y}));let X={...r};X[H]={...X[H],deck:O,discard:M};const K=X[T].lanes[P];if(K.length>0){const _e=K[K.length-1];if(_e.isFaceUp){const ee={cardOwner:T,actor:T,currentTurn:X.turn,opponent:T==="player"?"opponent":"player",triggerType:"cover"},je={...X,_coveringCardProtocol:(F=Y[0])==null?void 0:F.protocol};X=vs(_e,P,je,ee).newState,X.actionRequired}}const ne=[...X[T].lanes];if(ne[P]=[...ne[P],...Y],X[T]={...X[T],lanes:ne},X.detailedGameStats&&q.length>0){const _e=d==="player"?"playerFromEffect":"aiFromEffect",ee=d==="player"?y?"playerFaceDown":"playerFaceUp":y?"aiFaceDown":"aiFaceUp";X={...X,detailedGameStats:{...X.detailedGameStats,cardsPlayed:{...X.detailedGameStats.cardsPlayed,[_e]:X.detailedGameStats.cardsPlayed[_e]+q.length,[ee]:X.detailedGameStats.cardsPlayed[ee]+q.length}}}}const Z=Ie(r,t.id),oe=Z?`${Z.card.protocol}-${Z.card.value}`:"a card effect",xe=y?"face-down":"face-up",ye=r.player.protocols[P];let Ce=`${oe}: Plays `;z==="opponent"?Ce+="the top card of opponent's deck ":Ce+=`${q.length} card(s) from deck `,Ce+=`${xe} `,N==="opponent"?Ce+=`on opponent's ${ye} line.`:Ce+=`in ${ye} line.`,X=te(X,d,Ce);const pe=Y.map(_e=>({type:"play",cardId:_e.id,owner:T,toLane:P,fromDeck:!0,isFaceUp:!y}));return{newState:X,animationRequests:pe.length>0?pe:void 0}}if(h==="hand"&&((U=c.destinationRule)==null?void 0:U.type)==="line_with_matching_cards"){const P=c.destinationRule.cardFilter,z=N=>{const T=q=>q.length===0?!1:P?q.some(O=>P.faceState==="face_down"?!O.isFaceUp:P.faceState==="face_up"?O.isFaceUp:!0):!0;return T(r.player.lanes[N])||T(r.opponent.lanes[N])},H=[];for(let N=0;N<3;N++)z(N)&&H.push(N);if(H.length===0){const N=Ie(r,t.id),T=N?`${N.card.protocol}-${N.card.value}`:"Effect";return{newState:te(r,d,`${T}: No valid lanes with face-down cards. Effect skipped.`)}}if(r[m].hand.length===0)return{newState:r};let A={...r};return A.actionRequired={type:"select_card_from_hand_to_play",sourceCardId:t.id,actor:m,count:c.count||1,faceDown:c.faceDown,source:"hand",validLanes:H,cardFilter:P,followUpEffect:p==null?void 0:p.thenEffect,conditionalType:p==null?void 0:p.type},{newState:A}}if(h==="hand"&&((B=c.valueFilter)==null?void 0:B.equals)!==void 0&&!c.destinationRule){const P=c.valueFilter.equals,z=r[m].hand.filter(A=>A.value===P);if(z.length===0){const A=Ie(r,t.id),N=A?`${A.card.protocol}-${A.card.value}`:"Effect";return{newState:te(r,d,`${N}: No cards with value ${P} in hand. Effect skipped.`)}}let H={...r};return H.actionRequired={type:"select_card_from_hand_to_play",sourceCardId:t.id,actor:m,count:c.count||1,faceDown:c.faceDown,source:"hand",valueFilter:P,selectableCardIds:z.map(A=>A.id),followUpEffect:p==null?void 0:p.thenEffect,conditionalType:p==null?void 0:p.type},{newState:H}}if(h==="trash"){if(r[m].discard.length===0){const H=Ie(r,t.id),A=H?`${H.card.protocol}-${H.card.value}`:"Effect";return{newState:te(r,d,`${A}: No cards in trash. Effect skipped.`)}}let z={...r};return z.actionRequired={type:"select_card_from_trash_to_play",sourceCardId:t.id,actor:m,count:c.count||1,faceDown:c.faceDown,destinationRule:c.destinationRule,followUpEffect:p==null?void 0:p.thenEffect,conditionalType:p==null?void 0:p.type,sourceLaneIndex:n},{newState:z}}if(h==="hand"&&r[m].hand.length===0)return{newState:r};if(h==="hand"&&((G=c.destinationRule)==null?void 0:G.type)==="specific_lane"){const P=c.destinationRule.laneIndex==="current"?n:c.destinationRule.laneIndex;if(P===void 0||P<0||P>2)return console.error(`[Play Effect] Invalid lane index for hand play: ${P}`),{newState:r};let z;if(c.excludeSourceProtocol){const A=t.protocol,N=r[m].hand.filter(T=>T.protocol!==A);if(N.length===0){const T=Ie(r,t.id),q=T?`${T.card.protocol}-${T.card.value}`:"Effect";return{newState:te(r,d,`${q}: No non-${A} cards in hand. Effect skipped.`)}}z=N.map(T=>T.id)}let H={...r};return H.actionRequired={type:"select_card_from_hand_to_play",count:c.count||1,sourceCardId:t.id,actor:m,faceDown:y,source:h,forcedLaneIndex:P,ignoreProtocolMatching:y===void 0,selectableCardIds:z,excludeSourceProtocol:c.excludeSourceProtocol,sourceProtocol:c.excludeSourceProtocol?t.protocol:void 0,optional:c.optional,followUpEffect:p==null?void 0:p.thenEffect,conditionalType:p==null?void 0:p.type},{newState:H}}let g;if(c.excludeSourceProtocol&&h==="hand"){const P=t.protocol,z=r[m].hand.filter(H=>H.protocol!==P);if(z.length===0){const H=Ie(r,t.id),A=H?`${H.card.protocol}-${H.card.value}`:"Effect";return{newState:te(r,d,`${A}: No non-${P} cards in hand. Effect skipped.`)}}g=z.map(H=>H.id)}let v={...r},C;(W=c.destinationRule)!=null&&W.excludeCurrentLane&&(C=n);let b;if(c.useCardFromPreviousEffect&&h==="hand"){const P=r.lastCustomEffectTargetCardId;if(P&&(b=[P],!r[m].hand.find(H=>H.id===P)))return{newState:r}}return g&&(b=g),v.actionRequired={type:"select_card_from_hand_to_play",count:f,sourceCardId:t.id,actor:m,faceDown:y,source:h,disallowedLaneIndex:C,destinationRule:c.destinationRule,condition:c.condition,selectableCardIds:b,excludeSourceProtocol:c.excludeSourceProtocol,sourceProtocol:c.excludeSourceProtocol?t.protocol:void 0,optional:c.optional,followUpEffect:p==null?void 0:p.thenEffect,conditionalType:p==null?void 0:p.type},{newState:v}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Reveal/Give Effect Executor
 *
 * Handles reveal and give card effects.
 * Extracted 1:1 from effectInterpreter.ts for modularity.
 */function qx(t,n,r,s,c){var g;const{cardOwner:d,opponent:u}=s,p=c._conditional,f=c.count||1,h=c.action,y=c.source||"own_hand";if(h==="reveal"&&y==="board"){const v=c.targetFilter||{owner:"any",position:"uncovered",faceState:"face_down"},C=c.followUpAction,b=c.optional!==!1,x=[],j=v.owner==="own"?[d]:v.owner==="opponent"?[u]:[d,u];for(const k of j)for(let R=0;R<r[k].lanes.length;R++){const D=r[k].lanes[R];if(D.length>0){let L=[];v.position==="uncovered"?L=[D[D.length-1]]:v.position==="covered"?L=D.slice(0,-1):L=[...D];const I=L.filter(F=>v.faceState==="face_up"?F.isFaceUp:v.faceState==="face_down"?!F.isFaceUp:!0);x.push(...I)}}if(x.length===0)return{newState:te(r,d,"No valid cards to reveal. Effect skipped.")};let E={...r};return E.actionRequired={type:"select_board_card_to_reveal_custom",sourceCardId:t.id,actor:d,targetFilter:v,followUpAction:C,optional:b,followUpEffect:p==null?void 0:p.thenEffect,conditionalType:p==null?void 0:p.type},{newState:E}}if(h==="reveal"&&y==="opponent_hand"){let v={...r};const C={...v[u]};if(C.hand.length>0){C.hand=C.hand.map(x=>({...x,isRevealed:!0})),v[u]=C;const b=`${t.protocol}-${t.value}`;v=te(v,d,`${b}: Your opponent reveals their hand.`)}else{const b=`${t.protocol}-${t.value}`;v=te(v,d,`${b}: Opponent has no cards to reveal.`)}return{newState:v}}if(h==="reveal"&&y==="own_deck_top"){let v={...r};const C={...v[d]},b=`${t.protocol}-${t.value}`;if(C.deck.length===0)return v=te(v,d,`${b}: No cards in deck to reveal.`),{newState:v};const x=[...C.deck],j=x[0];v=te(v,d,`${b}: Revealed ${j.protocol}-${j.value} from top of deck.`);const E=`deck-top-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;return x[0]={...j,id:E},C.deck=x,v[d]=C,v.lastCustomEffectTargetCardId=E,{newState:v}}if(h==="reveal"&&y==="own_trash"){let v={...r};const C={...v[d]},b=`${t.protocol}-${t.value}`;return C.discard.length===0?(v=te(v,d,`${b}: No cards in trash to reveal.`),v._effectSkippedNoTargets=!0,{newState:v}):(v.actionRequired={type:"select_card_from_trash_to_reveal",sourceCardId:t.id,actor:d,count:f,followUpEffect:p==null?void 0:p.thenEffect,conditionalType:p==null?void 0:p.type,sourceLaneIndex:n},{newState:v})}if(h==="reveal"&&y==="own_deck"){let v={...r};const C={...v[d]},b=`${t.protocol}-${t.value}`;if(C.deck.length===0)return v=te(v,d,`${b}: No cards in deck to reveal.`),{newState:v};C.deckRevealed=!0,v[d]=C;const x=C.deck.map(j=>`${j.protocol}-${j.value}`).join(", ");return v=te(v,d,`${b}: Revealed deck: ${x}`),{newState:v}}if(h==="reveal"&&y==="own_hand"&&((g=c.protocolFilter)==null?void 0:g.type)==="same_as_source"){let v={...r};const C={...v[d]},b=`${t.protocol}-${t.value}`,x=C.hand.filter(E=>E.protocol===t.protocol);if(x.length===0)return v=te(v,d,`${b}: No ${t.protocol} cards in hand to reveal.`),{newState:v};C.hand=C.hand.map(E=>E.protocol===t.protocol?{...E,isRevealed:!0}:E),v[d]=C;const j=x.map(E=>`${E.protocol}-${E.value}`).join(", ");return v=te(v,d,`${b}: Revealed ${x.length} ${t.protocol} card(s) from hand: ${j}`),{newState:v}}if(r[d].hand.length===0)return{newState:te(r,d,`No cards in hand to ${h}. Effect skipped.`)};let m={...r};return h==="reveal"?m.actionRequired={type:"select_card_from_hand_to_reveal",count:f,sourceCardId:t.id,actor:d,followUpEffect:p==null?void 0:p.thenEffect,conditionalType:p==null?void 0:p.type}:h==="give"&&(m.actionRequired={type:"select_card_from_hand_to_give",count:f,sourceCardId:t.id,actor:d,followUpEffect:p==null?void 0:p.thenEffect,conditionalType:p==null?void 0:p.type}),{newState:m}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Shuffle Effect Executor
 *
 * Handles shuffle_trash and shuffle_deck effects.
 * - shuffle_trash: Clarity-4 "You may shuffle your trash into your deck."
 *   (In this codebase, "trash" = "discard pile")
 * - shuffle_deck: Clarity-2/3 "Shuffle your deck."
 */function Lx(t,n,r,s,c){var h;const{cardOwner:d}=s,u=c._conditional,p=`${t.protocol}-${t.value}`,f=c.optional!==!1;if(((h=c.advancedConditional)==null?void 0:h.type)==="trash_not_empty"&&r[d].discard.length===0)return{newState:te(r,d,`${p}: No cards in trash - effect skipped.`)};if(r[d].discard.length===0)return{newState:te(r,d,`${p}: No cards in trash to shuffle.`)};if(f){let y={...r};return y.actionRequired={type:"prompt_optional_shuffle_trash",sourceCardId:t.id,actor:d,trashCount:r[d].discard.length,followUpEffect:u==null?void 0:u.thenEffect,conditionalType:u==null?void 0:u.type},{newState:y}}return _y(r,d,p)}function _y(t,n,r){let s={...t};const c={...s[n]},d=c.discard.length;return d===0?(s=te(s,n,`${r}: No cards in trash to shuffle.`),{newState:s}):(c.deck=[...c.deck,...c.discard],c.discard=[],c.deck=Yn([...c.deck]),s[n]=c,s=te(s,n,`${r}: Shuffled ${d} card${d!==1?"s":""} from trash into deck.`),s=wt(s,"after_shuffle",{player:n}).newState,{newState:s})}function Ux(t,n,r,s,c){const{cardOwner:d}=s,u=`${t.protocol}-${t.value}`;let p={...r};const f={...p[d]};return f.deck.length===0?(p=te(p,d,`${u}: No cards in deck to shuffle.`),{newState:p}):(f.deck=Yn([...f.deck]),f.deckRevealed=!1,p[d]=f,p=te(p,d,`${u}: Shuffled deck.`),p=wt(p,"after_shuffle",{player:d}).newState,{newState:p})}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * State Number Effect Executor
 *
 * Handles the "state a number" effect (Luck-0).
 * Player chooses a number (0-5) which is stored in state for subsequent effects.
 */function Ox(t,n,r,s,c){const{cardOwner:d}=s;let u={...r};return u.actionRequired={type:"state_number",actor:d,sourceCardId:t.id,numberSource:c.numberSource||"own_protocol_values"},{newState:u}}function Mx(t,n,r){let s={...t};return s.lastStatedNumber=r,s=te(s,n,`${n==="player"?"Player":"Opponent"} states the number ${r}.`),s.actionRequired=null,s}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * State Protocol Effect Executor
 *
 * Handles the "state a protocol" effect (Luck-3).
 * Player chooses a protocol from opponent's cards which is stored for subsequent effects.
 */function Hx(t,n){const r=new Set;t[n].deck.forEach(u=>r.add(u.protocol)),t[n].hand.forEach(u=>r.add(u.protocol)),t[n].lanes.forEach(u=>{u.forEach(p=>r.add(p.protocol))}),t[n].discard.forEach(u=>r.add(u.protocol));const s=[],c=t[n].protocols;for(const u of c)r.has(u)&&!s.includes(u)&&s.push(u);const d=Array.from(r).filter(u=>!s.includes(u)).sort();return s.push(...d),s}function Vx(t,n,r,s,c){const{cardOwner:d,opponent:u}=s;let p=[];if(c.protocolSource==="opponent_cards"&&(p=Hx(r,u)),p.length===0){let h=te(r,d,"No protocols available to state - effect skipped.");return h._effectSkippedNoTargets=!0,{newState:h}}let f={...r};return f.actionRequired={type:"state_protocol",actor:d,sourceCardId:t.id,protocolSource:c.protocolSource||"opponent_cards",availableProtocols:p},{newState:f}}function zx(t,n,r){let s={...t};return s.lastStatedProtocol=r,s=te(s,n,`${n==="player"?"Player":"Opponent"} states the protocol "${r}".`),s.actionRequired=null,s}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Swap Stacks Effect Executor (Mirror-2)
 *
 * Swaps all cards between two of the player's own lanes.
 * Does NOT swap protocols - only the card stacks.
 */function Bx(t,n,r,s,c){const{cardOwner:d}=s;if(!r[d].lanes.some(h=>h.length>0))return{newState:te(r,d,"Cannot swap stacks: no cards on board.")};const p=[0,1,2];let f={...r};return f.actionRequired={type:"select_lanes_for_swap_stacks",actor:d,sourceCardId:t.id,validLanes:p,selectedFirstLane:void 0},{newState:f}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Copy Opponent Middle Effect Executor (Mirror-1)
 *
 * Allows the player to select one of the opponent's face-up uncovered cards
 * and execute its middle effects as if they were on this card.
 */function Gx(t){var r,s;return((s=(r=t.customEffects)==null?void 0:r.middleEffects)==null?void 0:s.length)>0}function Wx(t){var r;return((r=t.customEffects)==null?void 0:r.middleEffects)||[]}function Yx(t,n,r,s,c){const{cardOwner:d}=s,u=d==="player"?"opponent":"player",p=c.optional??!1,f=[];for(let y=0;y<r[u].lanes.length;y++){const m=r[u].lanes[y];if(m.length===0)continue;const g=m[m.length-1];g.isFaceUp&&Gx(g)&&f.push(g.id)}if(f.length===0)return{newState:te(r,d,"No opponent cards with middle commands to copy.")};let h={...r};return h.actionRequired={type:"select_card_for_copy_middle",actor:d,sourceCardId:t.id,validTargetIds:f,optional:p},{newState:h}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function Qx(t,n,r,s,c){var p,f;const{cardOwner:d}=s;let u={...r};if(((p=c.protocolCountConditional)==null?void 0:p.type)==="unique_protocols_on_field"){const h=c.protocolCountConditional.threshold,y=Er(r);if(y<h)return u=te(u,d,`Not enough different protocols on field (${y}/${h}). Effect skipped.`),{newState:u};u=te(u,d,`${y} different protocols on field. Protocol compiled!`)}else if(((f=c.protocolCountConditional)==null?void 0:f.type)==="same_protocol_count_on_field"){const h=c.protocolCountConditional.threshold,y=Uu(r,t.protocol);if(y<h)return u=te(u,d,`Not enough face-up ${t.protocol} cards on field (${y}/${h}). Effect skipped.`),{newState:u};u=te(u,d,`${y} face-up ${t.protocol} cards on field. Protocol compiled!`)}if(!u[d].compiled[n]){u[d]={...u[d],compiled:[...u[d].compiled.slice(0,n),!0,...u[d].compiled.slice(n+1)]};const h={...u.stats[d],protocolsCompiled:u.stats[d].protocolsCompiled+1};u={...u,stats:{...u.stats,[d]:h}}}if(c.deleteAllInLane){const h=d==="player"?"opponent":"player",y=[...u[d].lanes[n]],m=[...u[h].lanes[n]],g=y.map(({id:b,isFaceUp:x,...j})=>j),v=m.map(({id:b,isFaceUp:x,...j})=>j);u={...u,[d]:{...u[d],lanes:[...u[d].lanes.slice(0,n),[],...u[d].lanes.slice(n+1)],discard:[...u[d].discard,...g]},[h]:{...u[h],lanes:[...u[h].lanes.slice(0,n),[],...u[h].lanes.slice(n+1)],discard:[...u[h].discard,...v]}};const C=y.length+m.length;C>0&&(u=te(u,d,`All ${C} cards in this line deleted.`))}return{newState:u}}function _t(t,n,r,s,c,d){var j,E,k;const u={...c.params,_conditional:c.conditional},p=u.action,f=Ie(r,t.id);if(!f)return{newState:r};if(!f.card.isFaceUp)return{newState:r};const h=c.position||"middle",m=c.trigger==="on_cover",g=u.useCardFromPreviousEffect===!0;if(h!=="top"&&!m&&!g&&!vo(r,t.id))return{newState:r};const C=p==="reveal"&&u.source==="board";if(u.optional===!0&&!C){const R=u.actor==="opponent"?s.opponent:s.cardOwner,D=R==="player"?"opponent":"player",L=u.targetFilter||{},I=G=>{for(const W of["player","opponent"])for(let P=0;P<r[W].lanes.length;P++){const z=r[W].lanes[P];for(let H=0;H<z.length;H++)if(G(z[H],W,P,H))return!0}return!1};let F=!0,U="";switch(p){case"discard":!u.useCardFromPreviousEffect&&r[R].hand.length===0&&(F=!1,U="No cards to discard");break;case"flip":{const G=(j=r.passiveEffects)==null?void 0:j.some(W=>W.type==="prevent_flip_to_face_up"&&W.isActive);F=I((W,P,z,H)=>{if(L.excludeSelf&&W.id===t.id||L.owner==="own"&&P!==R||L.owner==="opponent"&&P===R)return!1;const A=H===r[P].lanes[z].length-1;return!(L.position==="uncovered"&&!A||L.position==="covered"&&A||L.faceState==="face_up"&&!W.isFaceUp||L.faceState==="face_down"&&W.isFaceUp||G&&!W.isFaceUp)}),F||(U="No valid cards to flip");break}case"delete":{F=I((G,W,P,z)=>{if(L.excludeSelf&&G.id===t.id||L.owner==="own"&&W!==R||L.owner==="opponent"&&W===R)return!1;const H=z===r[W].lanes[P].length-1,A=L.position||"uncovered";return!(A==="uncovered"&&!H||A==="covered"&&H||L.faceState==="face_up"&&!G.isFaceUp||L.faceState==="face_down"&&G.isFaceUp)}),F||(U="No valid cards to delete");break}case"shift":{if(c.useCardFromPreviousEffect){const G=r.lastCustomEffectTargetCardId||r._selectedCardFromPreviousEffect;G?(F=!!Ie(r,G),F||(U="Target card no longer exists")):(F=!1,U="No target card from previous effect")}else if(u.shiftSelf&&((E=u.destinationRestriction)==null?void 0:E.type)==="opponent_highest_value_lane")Cy(r,s.cardOwner).includes(n)&&(F=!1,U="Card is already in opponent's highest value lane");else if(((k=u.advancedConditional)==null?void 0:k.type)==="this_card_is_covered"){const G=r[s.cardOwner].lanes;let W=!1;for(let P=0;P<G.length;P++){const z=G[P],H=z.findIndex(A=>A.id===t.id);if(H!==-1){W=H<z.length-1;break}}W||(F=!1,U="Card is not covered")}else{const G=L.position||"uncovered";G==="any"&&L.owner==="own"&&!L.excludeSelf?F=!0:(F=I((P,z,H,A)=>{if(L.excludeSelf&&P.id===t.id||L.owner==="own"&&z!==R||L.owner==="opponent"&&z===R)return!1;const N=A===r[z].lanes[H].length-1;return!(G==="uncovered"&&!N||G==="covered"&&N)}),F||(U="No valid cards to shift"))}break}case"return":{const G=L.owner==="opponent"?D:R;F=I((W,P,z,H)=>{if(P!==G)return!1;const A=H===r[P].lanes[z].length-1,N=L.position||"uncovered";return!(N==="uncovered"&&!A||N==="covered"&&A)}),F||(U="No valid cards to return");break}case"draw":r[R].deck.length===0&&r[R].discard.length===0&&(F=!1,U="No cards to draw");break;case"play":r[R].hand.length===0&&(F=!1,U="No cards to play");break}if(!F){let G=te(r,R,`${U} - effect skipped.`);return G._effectSkippedNoTargets=!0,p==="discard"&&(G._discardContext={discardedCount:0}),{newState:G}}let B={...r};return B.actionRequired={type:"prompt_optional_effect",actor:s.cardOwner,sourceCardId:t.id,effectDef:c,laneIndex:n,logSource:r._currentEffectSource,logPhase:r._currentPhaseContext,logIndentLevel:r._logIndentLevel||0},{newState:B}}let b;const x={logSource:r._currentEffectSource,logPhase:r._currentPhaseContext,logIndentLevel:r._logIndentLevel||0};switch(p){case"refresh":{const D=(u.target||"self")==="opponent"?s.opponent:s.actor,L=Fu(r,D);if(!L.allowed){b={newState:te(r,s.cardOwner,L.reason||"Cannot refresh (draw blocked).")};break}const I=r[D].hand.length,F=Math.max(0,5-I);if(F>0){const{drawnCards:U,remainingDeck:B,newDiscard:G}=ca(r[D].deck,r[D].discard,F),W=U.map(q=>({...q,id:pt()}));let P={...r,[D]:{...r[D],hand:[...r[D].hand,...W],deck:B,discard:G}};const z={type:"draw",player:D,count:U.length,cardIds:W.map(q=>q.id)},H=P._pendingAnimationRequests||[];P._pendingAnimationRequests=[...H,z];const A=D==="player"?` (${U.map(q=>`${q.protocol}-${q.value}`).join(", ")})`:"";P=te(P,D,`[Refresh] Drew ${U.length} cards to reach hand size 5${A}.`),P=wt(P,"after_draw",{player:D,count:U.length}).newState,P=wt(P,"after_refresh",{player:D}).newState,b={newState:P}}else{let U=te(r,D,`[Refresh] Hand already at ${I} cards, no draw needed.`);U=wt(U,"after_refresh",{player:D}).newState,b={newState:U}}break}case"mutual_draw":{const R=s.actor,D=R==="player"?"opponent":"player",L=u.count||1;let I={...r};if(I[D].deck.length>0){const{drawnCards:F,remainingDeck:U,newDiscard:B}=ca(I[D].deck,I[D].discard,L);if(F.length>0){const G=F.map(N=>({...N,id:pt(),isFaceUp:!0}));I={...I,[D]:{...I[D],deck:U,discard:B},[R]:{...I[R],hand:[...I[R].hand,...G]}};const W={type:"draw",player:R,count:F.length,cardIds:G.map(N=>N.id)},P=I._pendingAnimationRequests||[];I._pendingAnimationRequests=[...P,W];const z=R==="player"?"Player":"Opponent",H=D==="player"?"Player":"Opponent",A=R==="player"?` (${G.map(N=>`${N.protocol}-${N.value}`).join(", ")})`:"";I=te(I,R,`${z} drew ${F.length} card(s) from ${H}'s deck${A}.`)}}if(I[R].deck.length>0){const{drawnCards:F,remainingDeck:U,newDiscard:B}=ca(I[R].deck,I[R].discard,L);if(F.length>0){const G=F.map(N=>({...N,id:pt(),isFaceUp:!0}));I={...I,[R]:{...I[R],deck:U,discard:B},[D]:{...I[D],hand:[...I[D].hand,...G]}};const W={type:"draw",player:D,count:F.length,cardIds:G.map(N=>N.id)},P=I._pendingAnimationRequests||[];I._pendingAnimationRequests=[...P,W];const z=D==="player"?"Player":"Opponent",H=R==="player"?"Player":"Opponent",A=D==="player"?` (${G.map(N=>`${N.protocol}-${N.value}`).join(", ")})`:"";I=te(I,D,`${z} drew ${F.length} card(s) from ${H}'s deck${A}.`)}}b={newState:I};break}case"draw":b=Tx(t,n,r,s,u);break;case"flip":b=Dx(t,n,r,s,{...u,useCardFromPreviousEffect:c.useCardFromPreviousEffect,_conditional:c.conditional});break;case"delete":b=Ax(t,n,r,s,{...u,_conditional:c.conditional});break;case"discard":b=Fx(t,n,r,s,{...u,_conditional:c.conditional});break;case"shift":b=Ix(t,n,r,s,{...u,useCardFromPreviousEffect:c.useCardFromPreviousEffect});break;case"return":b=$x(t,n,r,s,u);break;case"play":b=Px(t,n,r,s,u);break;case"rearrange_protocols":case"swap_protocols":b=Xx(t,n,r,s,u);break;case"reveal":case"give":b=qx(t,n,r,s,u);break;case"take":b=Zx(t,n,r,s,u);break;case"choice":b=Kx(t,n,r,s,u);break;case"block_compile":b=Jx(t,n,r,s,u);break;case"delete_all_in_lane":b=eC(t,n,r,s,u);break;case"shuffle_trash":b=Lx(t,n,r,s,u);break;case"shuffle_deck":b=Ux(t,n,r,s);break;case"state_number":b=Ox(t,n,r,s,u);break;case"state_protocol":b=Vx(t,n,r,s,u);break;case"swap_stacks":b=Bx(t,n,r,s);break;case"copy_opponent_middle":b=Yx(t,n,r,s,u);break;case"auto_compile":b=Qx(t,n,r,s,u);break;default:console.error(`[Custom Effect] Unknown action: ${p}`),b={newState:r};break}if(b.newState.actionRequired&&!b.newState.actionRequired.logSource&&(b={...b,newState:{...b.newState,actionRequired:{...b.newState.actionRequired,logSource:x.logSource,logPhase:x.logPhase,logIndentLevel:x.logIndentLevel}}}),c.conditional&&c.conditional.thenEffect){const{newState:R}=b;if(R.actionRequired)b={newState:{...R,actionRequired:{...R.actionRequired,followUpEffect:c.conditional.thenEffect,conditionalType:c.conditional.type,outerSourceCardId:t.id,outerLaneIndex:n}}};else{if(c.conditional.type==="if_executed"){const I=R._discardContext;if(((I==null?void 0:I.discardedCount)||0)===0)return delete R._discardContext,b={newState:R},b}if(c.conditional.type==="if_protocol_matches_stated"){const I=R._discardContext,F=I==null?void 0:I.discardedCardProtocol,U=R.lastStatedProtocol;if(!U||!F||F!==U){let G=te(R,s.cardOwner,`Discarded card does not match stated protocol "${U||"none"}". Effect skipped.`);return delete G._discardContext,b={newState:G},b}let B=te(R,s.cardOwner,`Discarded card matches stated protocol "${U}"!`);delete B._discardContext,b={newState:B}}if(c.conditional.type==="optional"){let I={...R};return I.actionRequired={type:"prompt_optional_effect",actor:s.cardOwner,sourceCardId:t.id,effectDef:c.conditional.thenEffect,laneIndex:n,savedTargetCardId:R.lastCustomEffectTargetCardId},b={newState:I},b}let D=s;const L=R._discardContext;L&&(D={...s,discardedCount:L.discardedCount,previousHandSize:L.previousHandSize},delete R._discardContext),b=_t(t,n,R,D,c.conditional.thenEffect)}}if(b.animationRequests&&b.animationRequests.length>0){const R=b.newState._pendingAnimationRequests||[];b={newState:{...b.newState,_pendingAnimationRequests:[...R,...b.animationRequests]}}}return b}function Xx(t,n,r,s,c){const{cardOwner:d,opponent:u}=s,p=c.action,h=(c.target||"own")==="opponent"?u:d,y=d;if(Xw(r)&&p==="rearrange_protocols")return{newState:te(r,d,"Protocols cannot be rearranged (Frost-1 bottom effect is active).")};let g={...r},v;return c.restriction&&(v={laneIndex:c.restriction.laneIndex==="current"?n:c.restriction.laneIndex,protocol:c.restriction.disallowedProtocol}),p==="rearrange_protocols"?g.actionRequired={type:"prompt_rearrange_protocols",actor:y,target:h,sourceCardId:t.id,disallowedProtocolForLane:v}:p==="swap_protocols"&&(g.actionRequired={type:"prompt_swap_protocols",actor:y,target:h,sourceCardId:t.id,disallowedProtocolForLane:v}),{newState:g}}function Zx(t,n,r,s,c){const{cardOwner:d,opponent:u}=s,p=c.count||1,f=c.random!==!1;if(r[u].hand.length===0)return{newState:te(r,d,"Opponent has no cards in hand. Effect skipped.")};let h={...r};const y={...h[u]},m={...h[d]};if(f){const g=Math.min(p,y.hand.length),v=[],C=[];for(let E=0;E<g;E++){const k=Math.floor(Math.random()*y.hand.length),R=y.hand.splice(k,1)[0];m.hand.push(R),v.push(R),C.push({type:"take",cardId:R.id,owner:d,cardSnapshot:{...R},fromHandIndex:k})}h={...h,[d]:m,[u]:y};const b=d==="player"?"Player":"Opponent",x=`${t.protocol}-${t.value}`,j=v.map(E=>d==="player"?`${E.protocol}-${E.value}`:"a card").join(", ");return h=te(h,d,`${x}: ${b} takes ${j} from the opponent's hand.`),{newState:h,animationRequests:C}}else{console.warn("[Take Effect] Non-random take not yet implemented, falling back to random");const g=Math.floor(Math.random()*y.hand.length),v=y.hand.splice(g,1)[0];m.hand.push(v),h={...h,[d]:m,[u]:y};const C=d==="player"?"Player":"Opponent",b=`${t.protocol}-${t.value}`,x=d==="player"?`${v.protocol}-${v.value}`:"a card";h=te(h,d,`${b}: ${C} takes ${x} from the opponent's hand.`);const j=[{type:"take",cardId:v.id,owner:d,cardSnapshot:{...v},fromHandIndex:g}];return{newState:h,animationRequests:j}}}function Kx(t,n,r,s,c){var f;const{cardOwner:d}=s,u=c.options||[];if(((f=c.advancedConditional)==null?void 0:f.type)==="same_protocol_on_field"&&!ws(r,t))return{newState:r};if(u.length!==2)return console.error(`[Choice Effect] Expected 2 options, got ${u.length}`),{newState:r};let p={...r};return p.actionRequired={type:"custom_choice",options:u,sourceCardId:t.id,actor:d,laneIndex:n},{newState:p}}function Jx(t,n,r,s,c){const{cardOwner:d,opponent:u}=s,f=(c.target||"opponent")==="opponent"?u:d,h={...r[f],cannotCompile:!0};let y={...r,[f]:h};const m=Ie(r,t.id),g=m?`${m.card.protocol}-${m.card.value}`:"Effect";return y=te(y,d,`${g}: ${f==="player"?"Player":"Opponent"} cannot compile next turn.`),{newState:y}}function eC(t,n,r,s,c){var y;const{cardOwner:d}=s,u=c.excludeCurrentLane!==!1,p=((y=c.laneCondition)==null?void 0:y.count)||8,f=[];for(let m=0;m<3;m++){if(u&&m===n)continue;r.player.lanes[m].length+r.opponent.lanes[m].length>=p&&f.push(m)}if(f.length===0){const m=`${t.protocol}-${t.value}`;return{newState:te(r,d,`${m}: No line has ${p} or more cards. Effect skipped.`)}}let h={...r};return h.actionRequired={type:"select_lane_for_delete_all",sourceCardId:t.id,actor:d,validLanes:f,minCards:p},{newState:h}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function wt(t,n,r){var f;let s={...t};const c=[];if(s._processingReactiveEffects)return{newState:s};s={...s,_processingReactiveEffects:!0};const d=s.processedClearCacheTriggerIds||[],u=[],p=h=>h.some(y=>y.trigger===n||y.trigger==="on_cover_or_flip"&&(n==="on_cover"||n==="on_flip"));for(const h of["player","opponent"])s[h].lanes.forEach((y,m)=>{y.forEach((g,v)=>{if(!g.isFaceUp)return;const C=s._committedCardId;if(C&&g.id===C)return;const b=g;if(!b.customEffects)return;const x=v===y.length-1;if(b.customEffects.topEffects&&p(b.customEffects.topEffects)){if(n==="after_clear_cache"&&d.includes(g.id))return;u.push({card:g,owner:h,laneIndex:m,box:"top"})}if(b.customEffects.middleEffects&&p(b.customEffects.middleEffects)){if(n==="after_clear_cache"&&d.includes(g.id))return;u.push({card:g,owner:h,laneIndex:m,box:"middle"})}if(x&&b.customEffects.bottomEffects){const j=b.customEffects.bottomEffects.filter(E=>E.trigger!=="on_cover");if(j.length>0&&p(j)){if(n==="after_clear_cache"&&d.includes(g.id))return;u.push({card:g,owner:h,laneIndex:m,box:"bottom"})}}})});if(u.length===0)return delete s._processingReactiveEffects,{newState:s};for(const{card:h,owner:y,laneIndex:m,box:g}of u){const v=s[y].lanes[m],C=v==null?void 0:v.findIndex(I=>I.id===h.id);if(!(C!==void 0&&C!==-1&&((f=v[C])==null?void 0:f.isFaceUp))||g==="bottom"&&!(C===v.length-1)||n==="before_compile_delete"&&(r==null?void 0:r.cardId)!==h.id||n==="on_flip"&&(r==null?void 0:r.cardId)!==h.id||(n==="on_cover"||n==="on_flip")&&r!=null&&r.cardId&&r.cardId!==h.id)continue;const x=h,k=(g==="top"?x.customEffects.topEffects:g==="middle"?x.customEffects.middleEffects:x.customEffects.bottomEffects).filter(I=>I.trigger===n||I.trigger==="on_cover_or_flip"&&(n==="on_cover"||n==="on_flip")).filter(I=>{const F=I.reactiveTriggerActor||"self";if(!(r!=null&&r.player))return!0;if(n==="after_opponent_discard"||n==="after_opponent_draw"||n==="after_opponent_refresh"||n==="after_opponent_compile")return r.player===y;if(F==="self"){if(r.player!==y)return!1}else if(F==="opponent"&&r.player===y)return!1;return!((I.reactiveScope||"global")==="this_lane"&&(r==null?void 0:r.laneIndex)!==void 0&&m!==r.laneIndex||I.onlyDuringOpponentTurn&&s.turn===y)});if(k.length===0)continue;const R=`${h.protocol}-${h.value}`;s=Ga(s),s=st(s,R),s=ft(s,"after");const D=y==="player"?"opponent":"player",L={cardOwner:y,actor:y,currentTurn:s.turn,opponent:D,triggerType:n};if(n==="after_clear_cache"){const I=s.processedClearCacheTriggerIds||[];s.processedClearCacheTriggerIds=[...I,h.id]}for(const I of k){const F=_t(h,m,s,L,I);if(s=qe(F.newState),F.animationRequests&&c.push(...F.animationRequests),F.animationRequests&&F.animationRequests.length>0){const U=s._pendingAnimationRequests||[];s._pendingAnimationRequests=[...U,...F.animationRequests]}if(s.actionRequired){const U=s.actionRequired.actor||y;U!==t.turn&&!s._interruptedTurn&&(s._interruptedTurn=t.turn,s._interruptedPhase=t.phase,s._interruptedCardPlayedFlag=t._cardPlayedThisActionPhase,s.turn=U);const B=s._pendingCustomEffects;if(B&&B.effects.length>0){const G={type:"execute_remaining_custom_effects",sourceCardId:B.sourceCardId,laneIndex:B.laneIndex,effects:B.effects,context:B.context,actor:B.context.cardOwner};s.queuedActions=[G,...s.queuedActions||[]],delete s._pendingCustomEffects}return delete s._processingReactiveEffects,{newState:s,animationRequests:c.length>0?c:void 0}}}s=br(s),s=st(s,void 0),s=ft(s,void 0)}return delete s._processingReactiveEffects,{newState:s,animationRequests:c.length>0?c:void 0}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function ca(t,n,r){let s=[...t],c=[...n],d=[],u=!1;for(let p=0;p<r;p++){if(s.length===0){if(c.length===0)break;s=Yn(c),c=[],u=!0}d.push(s.shift())}return{drawnCards:d,remainingDeck:s,newDiscard:c,reshuffled:u}}function bl(t,n,r,s="effect"){const c=t[n],{drawnCards:d,remainingDeck:u,newDiscard:p,reshuffled:f}=ca(c.deck,c.discard,r);if(d.length===0)return t;const h=d.map(C=>({...C,id:pt(),isFaceUp:!0})),y=h.map(C=>C.id),m={...c.stats,cardsDrawn:c.stats.cardsDrawn+d.length},g={...c,deck:u,discard:p,hand:[...c.hand,...h],stats:m};let v={...t,[n]:g,stats:{...t.stats,[n]:m}};if(v.detailedGameStats&&d.length>0){const C=s==="refresh",b=n==="player"?C?"playerFromRefresh":"playerFromEffect":C?"aiFromRefresh":"aiFromEffect";v={...v,detailedGameStats:{...v.detailedGameStats,cardsDrawn:{...v.detailedGameStats.cardsDrawn,[b]:v.detailedGameStats.cardsDrawn[b]+d.length}}}}if(y.length>0){const C={type:"draw",player:n,count:d.length,cardIds:y},b=v._pendingAnimationRequests||[];v._pendingAnimationRequests=[...b,C]}return f&&(v=te(v,n,`${n==="player"?"Player":"Opponent"}'s deck is empty. Discard pile has been reshuffled into the deck.`)),d.length>0&&(v=wt(v,"after_draw",{player:n,count:d.length}).newState,v=wt(v,"after_opponent_draw",{player:n==="player"?"opponent":"player",count:d.length}).newState),v}function tC(t,n,r){const s=n==="player"?"opponent":"player";let c={...t};const d={...c[s]},u={...c[n]},{drawnCards:p,remainingDeck:f,newDiscard:h,reshuffled:y}=ca(d.deck,d.discard,r);if(p.length>0){const m=p.map(C=>({...C,id:pt(),isFaceUp:!0})),g=m.map(C=>C.id);u.hand=[...u.hand,...m];const v={...u.stats,cardsDrawn:u.stats.cardsDrawn+p.length};if(u.stats=v,d.deck=f,d.discard=h,c={...c,[n]:u,[s]:d,stats:{...c.stats,[n]:v}},g.length>0){const C={type:"draw",player:n,count:p.length,cardIds:g},b=c._pendingAnimationRequests||[];c._pendingAnimationRequests=[...b,C]}if(y&&(c=te(c,n,`${s==="player"?"Player":"Opponent"}'s deck is empty. Discard pile has been reshuffled into the deck.`)),c.detailedGameStats&&p.length>0){const C=n==="player"?"playerFromEffect":"aiFromEffect";c={...c,detailedGameStats:{...c.detailedGameStats,cardsDrawn:{...c.detailedGameStats.cardsDrawn,[C]:c.detailedGameStats.cardsDrawn[C]+p.length}}}}}return c}function nC(t,n){const s=5-t[n].hand.length;if(s<=0)return t;let d=te(t,n,`${n==="player"?"Player":"Opponent"} refreshes their hand, drawing ${s} card(s).`);d=bl(d,n,s,"refresh");const u={...d[n],stats:{...d[n].stats,handsRefreshed:d[n].stats.handsRefreshed+1}};if(d={...d,[n]:u,stats:{...d.stats,[n]:u.stats}},d.detailedGameStats){const y=n==="player"?"playerCardsDrawn":"aiCardsDrawn";d={...d,detailedGameStats:{...d.detailedGameStats,refreshes:{...d.detailedGameStats.refreshes,[y]:d.detailedGameStats.refreshes[y]+s}}}}return d=wt(d,"after_refresh",{player:n}).newState,d=wt(d,"after_opponent_refresh",{player:n==="player"?"opponent":"player"}).newState,d}function _l(t,n){const r={...n},s=c=>c.map(d=>d.map(u=>t.has(u.id)?{...u,isFaceUp:!u.isFaceUp}:u));return r.player.lanes=s(r.player.lanes),r.opponent.lanes=s(r.opponent.lanes),qe(r)}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Hm=t=>{const n=Yn(go(t)),{drawnCards:r,remainingDeck:s}=ca(n,[],5),c={cardsPlayed:0,cardsDiscarded:0,cardsDeleted:0,cardsFlipped:0,cardsShifted:0,cardsDrawn:r.length,cardsReturned:0,handsRefreshed:0},d=r.map(u=>({...u,id:pt(),isFaceUp:!0}));return{protocols:t,deck:s,hand:d,lanes:[[],[],[]],discard:[],compiled:[!1,!1,!1],laneValues:[0,0,0],cannotCompile:!1,stats:c}},ps=(t,n,r,s="player")=>{const c=Hm(t),d=Hm(n),u={player:c,opponent:d,turn:s,phase:"start",controlCardHolder:null,useControlMechanic:r,winner:null,log:[],actionRequired:null,queuedActions:[],compilableLanes:[],processedStartEffectIds:[],processedEndEffectIds:[],lastPlayedCardId:void 0,stats:{player:c.stats,opponent:d.stats},detailedGameStats:{cardsPlayed:{playerFromHand:0,playerFromEffect:0,aiFromHand:0,aiFromEffect:0,playerFaceUp:0,playerFaceDown:0,aiFaceUp:0,aiFaceDown:0},cardsDrawn:{playerFromRefresh:0,playerFromEffect:0,aiFromRefresh:0,aiFromEffect:0},compiles:{playerFirstCompile:0,playerRecompile:0,aiFirstCompile:0,aiRecompile:0},refreshes:{playerCardsDrawn:0,aiCardsDrawn:0}}},p=s==="player"?"Player":"Opponent",f=t.join(", "),h=n.join(", ");let y=te(u,"player","Game Started.");return y=te(y,"player",`Player protocols: ${f}`),y=te(y,"opponent",`Opponent protocols: ${h}`),y=te(y,"player",`${p} goes first.`),y},wn=(t,n,r,s,c)=>{if(t.isFaceUp)return t.value;if(n.some(u=>u.isFaceUp&&u.protocol==="Darkness"&&u.value===2))return 4;if(r&&s!==void 0&&c!==void 0){const u=wy(r);for(const p of u)if(p.type==="set_to_fixed"){if(!(p.scope==="global"||p.scope==="this_lane"&&p.laneIndex===s))continue;const h=p.cardOwner;if(p.target==="own_cards"&&h!==c||p.target==="opponent_cards"&&h===c)continue;const y=p.filter;if(y&&(!y.faceState||y.faceState==="any"||y.faceState==="face_down"&&!t.isFaceUp||y.faceState==="face_up"&&t.isFaceUp))return p.value}}return 2},Vm=(t,n,r,s)=>{let c=0;for(const d of t)d.isFaceUp?c+=d.value:c+=wn(d,t,n,r,s);return Math.max(0,c)};function wy(t){const n=[];for(const r of["player","opponent"])t[r].lanes.forEach((s,c)=>{s.forEach(d=>{if(d.isFaceUp){const u=d;u.customEffects&&[...u.customEffects.topEffects||[],...u.customEffects.middleEffects||[],...u.customEffects.bottomEffects||[]].forEach(f=>{f.params.action==="value_modifier"&&f.trigger==="passive"&&n.push({...f.params.modifier,cardOwner:r,laneIndex:c,sourceCardProtocol:d.protocol})})}})});return n}function aC(t,n,r){const s=wy(t),c=[...n],d=[...r];for(const u of s){const{type:p,value:f,condition:h,target:y,scope:m,filter:g,cardOwner:v,laneIndex:C}=u,b=m==="global"?[0,1,2]:[C];for(const x of b)switch(p){case"add_per_condition":{if(!h)continue;let j=0;const E=t.player.lanes[x],k=t.opponent.lanes[x];h==="per_face_down_card"?j=E.filter(R=>!R.isFaceUp).length+k.filter(R=>!R.isFaceUp).length:h==="per_face_up_card"?j=E.filter(R=>R.isFaceUp).length+k.filter(R=>R.isFaceUp).length:h==="per_card"?j=E.length+k.length:h==="per_card_in_hand"?j=t[v].hand.length:h==="per_opponent_card_in_lane"&&(j=t[v==="player"?"opponent":"player"].lanes[x].length),y==="own_total"&&v==="player"?c[x]+=f*j:y==="own_total"&&v==="opponent"||y==="opponent_total"&&v==="player"?d[x]+=f*j:y==="opponent_total"&&v==="opponent"&&(c[x]+=f*j);break}case"set_to_fixed":break;case"add_to_total":{if(h==="has_non_own_protocol_face_up"){const j=t[v].lanes[C],E=u.sourceCardProtocol;if(!E||!j.some(R=>R.isFaceUp&&R.protocol!==E))continue}y==="own_total"&&v==="player"?c[x]+=f:y==="own_total"&&v==="opponent"||y==="opponent_total"&&v==="player"?d[x]+=f:y==="opponent_total"&&v==="opponent"&&(c[x]+=f);break}}}return{finalPlayerValues:c.map(u=>Math.max(0,u)),finalOpponentValues:d.map(u=>Math.max(0,u))}}function oC(t,n,r){let s=[...n],c=[...r];return{finalPlayerValues:s,finalOpponentValues:c}}const qe=t=>{const n=t.player.lanes.map((u,p)=>Vm(u,t,p,"player")),r=t.opponent.lanes.map((u,p)=>Vm(u,t,p,"opponent")),s=oC(t,n,r),{finalPlayerValues:c,finalOpponentValues:d}=aC(t,s.finalPlayerValues,s.finalOpponentValues);return{...t,player:{...t.player,laneValues:c},opponent:{...t.opponent,laneValues:d}}},xy=(t,n)=>{const r=[],s=t[n],c=t[n==="player"?"opponent":"player"];if(!s.cannotCompile)for(let d=0;d<3;d++){const u=s.laneValues[d],p=c.laneValues[d];u>=10&&u>p&&r.push(d)}return r},ba=(t,n,r)=>t[n].laneValues[r],rC=(t,n)=>{const r=n==="player"?"opponent":"player",s=[];for(let c=0;c<3;c++){const d=t[n].laneValues[c];t[r].laneValues[c]>d&&s.push(c)}return s},Cy=(t,n)=>{const r=n==="player"?"opponent":"player";let s=-1,c=[];for(let d=0;d<3;d++){const u=t[r].laneValues[d];u>s?(s=u,c=[d]):u===s&&c.push(d)}return c};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function pl(t,n){let r=null,s=null;const c=["player","opponent"];for(const y of c){for(const m of t[y].lanes){const g=m.find(v=>v.id===n);if(g){r=y,s=g;break}}if(r)break}if(!r||!s)return console.error("Card to delete not found on board:",n),t;const d={...t},u={...d[r]};u.lanes=u.lanes.map(y=>y.filter(m=>m.id!==n));const{id:p,isFaceUp:f,...h}=s;return u.discard=[...u.discard,h],d[r]=u,d}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function Su(t,n,r,s=!0){if(!n)return t;const c=n==null?void 0:n.followUpEffect,d=n==null?void 0:n.conditionalType,u=n.sourceCardId;if(!c||!u||!(d!=="if_executed"||s))return t;const f=Ie(t,u),h=t._currentPhaseContext||(t.phase==="start"?"start":"end"),y={type:"execute_follow_up_effect",sourceCardId:u,followUpEffect:c,actor:r,logContext:{indentLevel:1,sourceCardName:f?`${f.card.protocol}-${f.card.value}`:void 0,phase:h}};return(t.queuedActions||[]).some(g=>g.type==="execute_follow_up_effect"&&g.sourceCardId===u)?t:{...t,queuedActions:[...t.queuedActions||[],y]}}function ru(t,n){return(t.queuedActions||[]).some(r=>r.type==="execute_follow_up_effect"&&r.sourceCardId===n)}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const lu=(t,n)=>t.actionRequired?t:n(t),lC=["select_card_to_flip","select_any_card_to_flip"];function sC(t,n,r){if(!r||!lC.includes(r.type))return null;const s=Ie(t,n);if(s&&s.card.protocol==="Metal"&&s.card.value===6){const c="actor"in r?r.actor:t.turn,d=c==="player"?"Player":"Opponent",u=s.owner==="player"?"Player's":"Opponent's";let p="An effect";if("sourceCardId"in r&&r.sourceCardId){const R=Ie(t,r.sourceCardId);R&&(p=`${R.card.protocol}-${R.card.value}`)}let f=te(t,c,`${p}: ${d} flips ${u} Metal-6.`);f=te(f,c,"Metal-6: Deletes itself when flipped.");const h={...t.stats[c],cardsDeleted:t.stats[c].cardsDeleted+1},y={...t[c],stats:h};f={...f,[c]:y,stats:{...f.stats,[c]:h}};const m=s.owner,g=t[m].lanes.findIndex(R=>R.some(D=>D.id===n)),v=t[m].lanes[g],C=v&&v.length>0&&v[v.length-1].id===n,b=v&&v.length>1,x=(v==null?void 0:v.findIndex(R=>R.id===n))??0,j={...s.card};f=pl(f,n);const E=t._pendingCustomEffects,k=(R,D)=>{var G,W;let L={...R};const I=E&&((G=L.queuedActions)==null?void 0:G.some(P=>P.type==="execute_remaining_custom_effects"&&P.sourceCardId===E.sourceCardId));E&&!I&&(L._pendingCustomEffects=E,L.lastCustomEffectTargetCardId=n);let U=wt(L,"after_delete",{player:L.turn}).newState;if(C&&b&&(U=Sa(U,m,g).newState),r&&"count"in r&&r.count>1){const P=r.count-1;return U.actionRequired={...r,count:P},{...U}}if(L.actionRequired||L.queuedActions&&L.queuedActions.length>0)return{...U,actionRequired:L.actionRequired,queuedActions:L.queuedActions};const B=E&&((W=U.queuedActions)==null?void 0:W.some(P=>P.type==="execute_remaining_custom_effects"&&P.sourceCardId===E.sourceCardId));if(E&&!U._pendingCustomEffects&&!B&&(U._pendingCustomEffects=E,U.lastCustomEffectTargetCardId=n),U=gt(U),U.actionRequired=null,U.queuedActions&&U.queuedActions.length>0){const P=[...U.queuedActions],z=P.shift(),H=z==null?void 0:z.type;if(["execute_remaining_custom_effects","execute_follow_up_effect","flip_self","reveal_opponent_hand","delete_self"].includes(H)){const N={...U,queuedActions:[z,...P]},T=Wa(N);if(T.actionRequired)return{...T};if(T.queuedActions&&T.queuedActions.length>0){const q=[...T.queuedActions],O=q.shift();return{...T,actionRequired:O,queuedActions:q}}return D(T)}return{...U,actionRequired:z,queuedActions:P}}return D(U)};return{nextState:{...f,actionRequired:null},requiresAnimation:{animationRequests:[{type:"delete",cardId:n,owner:m,cardSnapshot:j,laneIndex:g,cardIndex:x}],onCompleteCallback:k},requiresTurnEnd:!1}}return null}const cC=(t,n=r=>r)=>t.requiresAnimation&&t.requiresAnimation.onCompleteCallback?t.requiresAnimation.onCompleteCallback(t.nextState,n):t.nextState,Sy=(t,n,r)=>{var p,f,h,y,m,g,v,C,b,x,j,E,k,R,D,L,I;if(!t.actionRequired)return{nextState:t};let s={...t},c=!0,d=null;const u=sC(t,n,t.actionRequired);if(u)return u;switch(t.actionRequired.type){case"select_card_to_flip":{const{logSource:F,logPhase:U,logIndentLevel:B}=t.actionRequired;F!==void 0&&(s=st(s,F)),U!==void 0&&(s=ft(s,U)),B!==void 0&&(s._logIndentLevel=B);const G=t._committedCardId;if(G&&n===G)return{nextState:t};if(!ms(t,n).allowed)return{nextState:t};const P=Ie(t,n),z="draws"in t.actionRequired?t.actionRequired.draws:0;s=xu(t,n,null,r);const H={type:"flip",cardId:n,owner:P==null?void 0:P.owner,laneIndex:P?t[P.owner].lanes.findIndex(oe=>oe.some(xe=>xe.id===n)):void 0},A=n;s.lastCustomEffectTargetCardId=A;let N;if(P){const oe=t[P.owner].lanes.findIndex(xe=>xe.some(ye=>ye.id===n));oe!==-1&&(N=oe,s.lastFlipLaneIndex=oe)}const T=(p=t.actionRequired)==null?void 0:p.sourceCardId;if(T&&s.queuedActions&&(s.queuedActions=s.queuedActions.map(oe=>{var xe;return oe.type==="execute_remaining_custom_effects"&&oe.sourceCardId===T&&!oe.selectedCardFromPreviousEffect&&((xe=oe.effects)==null?void 0:xe.some(Ce=>Ce.useCardFromPreviousEffect))?{...oe,selectedCardFromPreviousEffect:n}:oe})),z&&z>0){const{actor:oe,sourceCardId:xe}=t.actionRequired,ye=Ie(s,xe),Ce=ye?`${ye.card.protocol}-${ye.card.value}`:"A card effect";s=te(s,oe,`${Ce}: Drawing ${z} card(s).`),s=bl(s,oe,z)}if(P&&!P.card.isFaceUp){const oe=Cu(s,n);s=oe.newState,s.lastCustomEffectTargetCardId=A,N!==void 0&&(s.lastFlipLaneIndex=N),d={animationRequests:[H,...oe.animationRequests||[]],onCompleteCallback:lu}}else P&&(d={animationRequests:[H],onCompleteCallback:lu});const O=((f=t.actionRequired)==null?void 0:f._followUpAlreadyExecuted)||(h=t.actionRequired)==null?void 0:h.followUpEffect,M=(y=t.actionRequired)==null?void 0:y.sourceCardId;O&&M&&(s=Ex(s,n,M,O));const Y=((m=t.actionRequired)==null?void 0:m.actor)||t.turn,X=s.actionRequired;X&&(s.actionRequired=null),s=wt(s,"after_flip",{player:Y,cardId:n}).newState,X&&(s.actionRequired?s.queuedActions=[{...X,type:X.type},...s.queuedActions||[]]:s.actionRequired=X);const ne=s._pendingCustomEffects;if(ne&&ne.effects.length>0){const oe={type:"execute_remaining_custom_effects",sourceCardId:ne.sourceCardId,laneIndex:ne.laneIndex,effects:ne.effects,context:ne.context,actor:ne.context.cardOwner,selectedCardFromPreviousEffect:ne.effects[0].useCardFromPreviousEffect?n:void 0,logSource:ne.logSource,logPhase:ne.logPhase,logIndentLevel:ne.logIndentLevel};s.queuedActions=[oe,...s.queuedActions||[]],delete s._pendingCustomEffects}const Z=(g=t.actionRequired)==null?void 0:g.remainingLanes;if(Z&&Z.length>0&&!s.actionRequired){const oe=Z[0],xe=Z.slice(1),ye=(v=t.actionRequired)==null?void 0:v.params,Ce=(C=t.actionRequired)==null?void 0:C.sourceCardId,pe=(b=t.actionRequired)==null?void 0:b.actor,_e=(x=t.actionRequired)==null?void 0:x.targetFilter;s.actionRequired={type:"select_card_to_flip",sourceCardId:Ce,actor:pe,currentLaneIndex:oe,remainingLanes:xe,targetFilter:_e,params:ye,followUpEffect:(j=t.actionRequired)==null?void 0:j.followUpEffect,conditionalType:(E=t.actionRequired)==null?void 0:E.conditionalType}}(s.actionRequired||s.queuedActions&&s.queuedActions.length>0)&&(c=!1);break}case"select_card_to_shift":{const{logSource:F,logPhase:U,logIndentLevel:B}=t.actionRequired;F!==void 0&&(s=st(s,F)),U!==void 0&&(s=ft(s,U)),B!==void 0&&(s._logIndentLevel=B);const{sourceCardId:G,optional:W}=t.actionRequired;if(W&&G){const z=Ie(t,G);if(!z||!z.card.isFaceUp){const H=z?`${z.card.protocol}-${z.card.value}`:"the source card",A=t._logSource;s=st(t,H),s=te(s,t.actionRequired.actor,"Shift was cancelled because the source is no longer active."),s=st(s,A),s=gt(s),s.actionRequired=null,c=!0;break}}const P=Ie(t,n);if(P){const{owner:z}=P;let H=-1;for(let X=0;X<t[z].lanes.length;X++)if(t[z].lanes[X].some(K=>K.id===n)){H=X;break}if(H===-1)return{nextState:t,requiresTurnEnd:!1};const N=(t.actionRequired.targetFilter||{}).position||"uncovered",T=t[z].lanes[H],O=T.findIndex(X=>X.id===n)===T.length-1;if(N==="uncovered"&&!O)return{nextState:t,requiresTurnEnd:!1};if(N==="covered"&&O)return{nextState:t,requiresTurnEnd:!1};const M=t.actionRequired.scope,Y=t.actionRequired.sourceLaneIndex;if(M==="this_lane"&&Y!==void 0&&H!==Y)return{nextState:t,requiresTurnEnd:!1};if(H!==-1){const X=t.actionRequired.targetLaneIndex;if(X!==void 0){const ne=t.actionRequired.actor,Z=Xo(t,n,z,X,ne);if(s=Z.newState,Z.animationRequests&&Z.animationRequests.length>0){const oe=s._pendingAnimationRequests||[];s._pendingAnimationRequests=[...oe,...Z.animationRequests]}c=!s.actionRequired;break}const K={type:"select_lane_for_shift",cardToShiftId:n,cardOwner:z,originalLaneIndex:H,sourceCardId:t.actionRequired.sourceCardId,actor:t.actionRequired.actor,destinationRestriction:t.actionRequired.destinationRestriction,followUpEffect:t.actionRequired.followUpEffect,conditionalType:t.actionRequired.conditionalType};s.actionRequired=K}}c=!1;break}case"delete_self":{const{sourceCardId:F,cardToDeleteId:U,actor:B,logSource:G,logPhase:W,logIndentLevel:P}=t.actionRequired;G!==void 0&&(s=st(s,G)),W!==void 0&&(s=ft(s,W)),P!==void 0&&(s._logIndentLevel=P);const z=Ie(t,U);if(!z){s=te(s,B,"Card no longer on board. Delete skipped."),s=gt(s),s.actionRequired=null,c=!0;break}const H=`${z.card.protocol}-${z.card.value}`;s=te(s,B,`Deleting ${H}.`);const{owner:A,laneIndex:N}=z,T=t[A].lanes[N],q=T[T.length-1].id===U;s=pl(t,U),s=gt(s),s.actionRequired=null;const O={...s.stats[B],cardsDeleted:s.stats[B].cardsDeleted+1};s={...s,stats:{...s.stats,[B]:O}},q&&T.length>0&&(s=Sa(s,A,N).newState),c=!0;break}case"select_cards_to_delete":case"select_face_down_card_to_delete":case"select_low_value_card_to_delete":case"select_card_from_other_lanes_to_delete":{const{sourceCardId:F,actor:U}=t.actionRequired,{logSource:B,logPhase:G,logIndentLevel:W}=t.actionRequired;B!==void 0&&(s=st(s,B)),G!==void 0&&(s=ft(s,G)),W!==void 0&&(s._logIndentLevel=W);const P=Ie(t,F);if(!P||!P.card.isFaceUp){const Ce=P?`${P.card.protocol}-${P.card.value}`:"the source card";s=te(s,U,`Effect from ${Ce} was cancelled because the source is no longer active.`),s=gt(s),s.actionRequired=null,c=!0;break}const z=Ie(t,n);if(!z)return{nextState:t};const H=t.actionRequired.allowedIds;if(H&&!H.includes(n))return console.error(`Illegal delete: Card ${n} is not in allowedIds - value filter not met`),{nextState:t};if(t.actionRequired.protocolMatching){const Ce=t.actionRequired.protocolMatching,pe=t[z.owner].lanes.findIndex(_e=>_e.some(ee=>ee.id===n));if(pe!==-1){const _e=t.player.protocols[pe],ee=t.opponent.protocols[pe],je=z.card.protocol,de=je===_e||je===ee;if(Ce==="must_match"&&!de)return console.error(`Illegal delete: ${je}-${z.card.value} in lane ${pe} (protocols: ${_e}/${ee}) - card must be in lane with matching protocol`),{nextState:t};if(Ce==="must_not_match"&&de)return console.error(`Illegal delete: ${je}-${z.card.value} in lane ${pe} (protocols: ${_e}/${ee}) - card must be in lane without matching protocol`),{nextState:t}}}const A=t.actionRequired.targetFilter;if((A==null?void 0:A.calculation)==="highest_value"||(A==null?void 0:A.calculation)==="lowest_value"){const Ce=A.owner,pe=Ce==="opponent"?U==="player"?"opponent":"player":Ce==="own"?U:z.owner,ee=Rx(t,pe).some(de=>de.card.id===n),je=A.calculation==="highest_value"?"highest":"lowest";if(!ee)return console.error(`Illegal delete: Card ${n} is not one of the ${je} value uncovered cards`),{nextState:t}}const N=U==="player"?"Player":"Opponent",T=z.owner==="player"?"Player's":"Opponent's",q=t[z.owner].lanes.findIndex(Ce=>Ce.some(pe=>pe.id===n)),O=q!==-1?t[z.owner].protocols[q]:"unknown",M=z.card.isFaceUp?`${z.card.protocol}-${z.card.value}`:`face-down card in Protocol ${O}`,Y=Ie(t,t.actionRequired.sourceCardId),X=Y?`${Y.card.protocol}-${Y.card.value}`:"a card effect";s=te(s,U,`${X}: ${N} deletes ${T} ${M}.`);const K={...s.stats[U],cardsDeleted:s.stats[U].cardsDeleted+1},ne={...s[U],stats:K};s={...s,[U]:ne,stats:{...s.stats,[U]:K}};const Z=t[z.owner].lanes.findIndex(Ce=>Ce.some(pe=>pe.id===n)),oe=t[z.owner].lanes[Z],xe=oe&&oe.length>0&&oe[oe.length-1].id===n;s=pl(s,n),s=gt(s),s=Su(s,t.actionRequired,U,!0),s.actionRequired=null;const ye=oe?oe.findIndex(Ce=>Ce.id===n):-1;d={animationRequests:[{type:"delete",cardId:n,owner:z.owner,cardSnapshot:{...z.card},laneIndex:Z,cardIndex:ye}],onCompleteCallback:(Ce,pe)=>{var Se,ke,Xe;const _e=t.actionRequired.actor,ee=t.actionRequired;let de=wt(Ce,"after_delete",{player:_e}).newState;de=gt(de);let Pe=null;const Ue=Ie(de,ee.sourceCardId),se=vo(de,ee.sourceCardId),re=ee.followUpEffect;if(Ue&&Ue.card.isFaceUp&&se){const Le=ee.remainingLanes;if(ee.type==="select_cards_to_delete"&&Le&&Le.length>0){const be=Le[0],Me=Le.slice(1);Pe={type:"select_cards_to_delete",count:((Se=ee.params)==null?void 0:Se.count)||ee.count,sourceCardId:ee.sourceCardId,actor:ee.actor,currentLaneIndex:be,remainingLanes:Me,disallowedIds:(ke=ee.params)!=null&&ke.excludeSelf?[ee.sourceCardId]:[],targetFilter:ee.targetFilter,scope:ee.scope,protocolMatching:ee.protocolMatching,params:ee.params}}else if(ee.type==="select_cards_to_delete"&&ee.count>1)Pe={type:"select_cards_to_delete",count:ee.count-1,sourceCardId:ee.sourceCardId,disallowedIds:[...ee.disallowedIds,n],actor:ee.actor,followUpEffect:re};else if(ee.type==="select_card_from_other_lanes_to_delete"&&ee.count>1){const be=t[z.owner].lanes.findIndex(Ye=>Ye.some(De=>De.id===n)),Me=[...ee.lanesSelected,be];[0,1,2].filter(Ye=>Ye!==ee.disallowedLaneIndex&&!Me.includes(Ye)).some(Ye=>de.player.lanes[Ye].length>0||de.opponent.lanes[Ye].length>0)?Pe={type:"select_card_from_other_lanes_to_delete",count:ee.count-1,sourceCardId:ee.sourceCardId,disallowedLaneIndex:ee.disallowedLaneIndex,lanesSelected:Me,actor:ee.actor,logSource:ee.logSource,logPhase:ee.logPhase,logIndentLevel:ee.logIndentLevel}:de=te(de,ee.actor,"No cards left in remaining lanes. Effect skipped.")}}else if("count"in ee&&ee.count>1){const Le=Ue?`${Ue.card.protocol}-${Ue.card.value}`:"the source card",be=!Ue||!Ue.card.isFaceUp?"the source is no longer active":"the source was covered";de=te(de,ee.actor,`Remaining deletes from ${Le} were cancelled because ${be}.`)}let ce=!1;if(xe){const Le=de,be=Sa(Le,z.owner,Z),Me=be.newState._interruptedTurn!==void 0;Le._interruptedTurn&&!be.newState._interruptedTurn&&(ce=!0);const Ne=[...be.newState.queuedActions||[]];Pe&&(Me?Ne.push(Pe):Ne.unshift(Pe)),de={...be.newState,queuedActions:Ne}}else Pe&&(de.queuedActions=[...de.queuedActions||[],Pe]);const he=ru(de,ee.sourceCardId);if(re&&!Pe&&!he)if(de.actionRequired){const Le=Ie(de,ee.sourceCardId),be=ee.actor==="player"?"opponent":"player";let Me=-1;Le&&(Me=de[Le.owner].lanes.findIndex(Ye=>Ye.some(De=>De.id===ee.sourceCardId)));const Ne={cardOwner:ee.actor,actor:ee.actor,currentTurn:de.turn,opponent:be,triggerType:"start"},Be={type:"execute_remaining_custom_effects",sourceCardId:ee.sourceCardId,actor:ee.actor,laneIndex:Me,effects:[re],context:Ne,logSource:ee.logSource,logPhase:ee.logPhase,logIndentLevel:ee.logIndentLevel??1};de.queuedActions=[...de.queuedActions||[],Be]}else{const Le=Ie(de,ee.sourceCardId),be=ee.actor==="player"?"opponent":"player";if(Le){const Me=de[Le.owner].lanes.findIndex(Ge=>Ge.some(et=>et.id===ee.sourceCardId)),Ne={cardOwner:ee.actor,actor:ee.actor,currentTurn:de.turn,opponent:be,triggerType:"start"},Be=`${Le.card.protocol}-${Le.card.value}`;de=st(de,ee.logSource||Be),de=ft(de,ee.logPhase||"start"),de._logIndentLevel=ee.logIndentLevel??1;const Ye=de,De=_t(Le.card,Me,de,Ne,re);if(de=De.newState,De.animationRequests&&De.animationRequests.length>0){const Ge=vx(Ye,De.animationRequests,!0);Ge.length>0&&(de._pendingAnimations=[...de._pendingAnimations||[],...Ge])}de=gt(de)}else if((Xe=re.params)!=null&&Xe.deleteSelf){de=st(de,ee.logSource||"the source card"),de=ft(de,ee.logPhase||"start"),de._logIndentLevel=ee.logIndentLevel??1;const Me=Ie(de,ee.sourceCardId);if(Me){const{card:Ne,owner:Be,laneIndex:Ye,cardIndex:De}=Me,Ge=gl(de,Ne,Be,Ye,De,!0);de._pendingAnimations=[...de._pendingAnimations||[],Ge]}de=pl(de,ee.sourceCardId),de=te(de,ee.actor,"Deletes itself.")}}if(de.actionRequired)return de;if(de.queuedActions&&de.queuedActions.length>0){const Le=de.queuedActions[0];if((Le==null?void 0:Le.type)==="execute_remaining_custom_effects"||(Le==null?void 0:Le.type)==="execute_follow_up_effect"){const Ne=Wa(de);return Ne.actionRequired?Ne:pe(Ne)}const be=[...de.queuedActions],Me=be.shift();if((Me==null?void 0:Me.type)==="shift_flipped_card_optional"||(Me==null?void 0:Me.type)==="gravity_2_shift_after_flip"){const Ne=Ie(de,Me.sourceCardId),Be=vo(de,Me.sourceCardId);if(!Ne||!Ne.card.isFaceUp||!Be){const Ye=Ne?`${Ne.card.protocol}-${Ne.card.value}`:"the source card";let De=te(de,Me.actor,`Shift from ${Ye} was cancelled because the source is no longer active.`);if(be.length>0){const Ge=be.shift();return{...De,actionRequired:Ge,queuedActions:be}}else return pe({...De,actionRequired:null,queuedActions:[]})}}return{...de,actionRequired:Me,queuedActions:be}}if(ce){if(de.queuedActions&&de.queuedActions.length>0){const Le=[...de.queuedActions],be=Le.shift();if((be==null?void 0:be.type)==="execute_remaining_custom_effects"||(be==null?void 0:be.type)==="execute_follow_up_effect"){const Me={...de,queuedActions:[be,...Le]},Ne=Wa(Me);return Ne.actionRequired?Ne:de}return{...de,actionRequired:be,queuedActions:Le}}return de}if(re&&Ue&&Ue.card.isFaceUp&&(!((re.position||"middle")!=="top")||se)){const Ne=de[Ue.owner].lanes.findIndex(et=>et.some(tt=>tt.id===ee.sourceCardId)),Be=ee.actor==="player"?"opponent":"player",Ye=re.trigger||"on_play",De={cardOwner:ee.actor,actor:ee.actor,currentTurn:de.turn,opponent:Be,triggerType:Ye};if(de=_t(Ue.card,Ne,de,De,re).newState,Ie(de,ee.sourceCardId),de.actionRequired)return de}return pe(de)}},c=!1;break}case"plague_4_opponent_delete":{const F=Ie(t,n);if(!F)return{nextState:t};const U=t.actionRequired.actor;s=te(s,U,"Plague-4: Opponent deletes one of their face-down cards.");const B={...s.stats[U],cardsDeleted:s.stats[U].cardsDeleted+1},G={...s[U],stats:B};s={...s,[U]:G,stats:{...s.stats,[U]:B}};const W=t[F.owner].lanes.findIndex(A=>A.some(N=>N.id===n)),P=t[F.owner].lanes[W],z=P&&P.length>0&&P[P.length-1].id===n,H=P?P.findIndex(A=>A.id===n):-1;s=gt(s),s.actionRequired=null,d={animationRequests:[{type:"delete",cardId:n,owner:F.owner,cardSnapshot:{...F.card},laneIndex:W,cardIndex:H}],onCompleteCallback:(A,N)=>{let q=wt(A,"after_delete",{player:U}).newState;z&&(q=Sa(q,F.owner,W).newState);const O=Ie(q,t.actionRequired.sourceCardId),M=(O==null?void 0:O.owner)||t.turn,Y={type:"plague_4_player_flip_optional",sourceCardId:t.actionRequired.sourceCardId,optional:!0,actor:M};return q.actionRequired?q.queuedActions=[...q.queuedActions||[],Y]:q.actionRequired=Y,q}},c=!1;break}case"select_card_to_return":{const{logSource:F,logPhase:U,logIndentLevel:B}=t.actionRequired;F!==void 0&&(s=st(s,F)),U!==void 0&&(s=ft(s,U)),B!==void 0&&(s._logIndentLevel=B);const{sourceCardId:G,actor:W}=t.actionRequired,z=((k=t.actionRequired)==null?void 0:k._followUpAlreadyExecuted)||(R=t.actionRequired)==null?void 0:R.followUpEffect,H=(D=t.actionRequired)==null?void 0:D.conditionalType,A=(L=t.actionRequired)==null?void 0:L.targetFilter,N=(I=t.actionRequired)==null?void 0:I.destination,T=Ie(t,n);if(T){const O=vo(t,n),M=(A==null?void 0:A.position)==="covered"||(A==null?void 0:A.position)==="any";if(!O&&!M)return console.error(`[cardResolver] Invalid return target: ${T.card.protocol}-${T.card.value} is covered`),{nextState:t,requiresTurnEnd:!1}}const q=Mc(t,n,N);if(s=q.newState,s=Su(s,t.actionRequired,W,!0),q.animationRequests)d={animationRequests:q.animationRequests,onCompleteCallback:(O,M)=>{if(O.actionRequired)return O;let Y=O;const X=ru(Y,G);if(z&&G&&!X&&(H!=="if_executed"||n)){const ne=Ie(Y,G);if(ne&&ne.card.isFaceUp){const Z=Y[ne.owner].lanes.find(Ce=>Ce.some(pe=>pe.id===G)),oe=Y[ne.owner].lanes.indexOf(Z),xe={cardOwner:ne.owner,actor:W,currentTurn:Y.turn,opponent:ne.owner==="player"?"opponent":"player"};if(Y=_t(ne.card,oe,Y,xe,z).newState,Y.actionRequired)return Y}}return M(Y)}};else{const O=ru(s,G);if(z&&G&&!O&&(H!=="if_executed"||n)){const Y=Ie(s,G);if(Y&&Y.card.isFaceUp){const X=s[Y.owner].lanes.find(oe=>oe.some(xe=>xe.id===G)),K=s[Y.owner].lanes.indexOf(X),ne={cardOwner:Y.owner,actor:W,currentTurn:s.turn,opponent:Y.owner==="player"?"opponent":"player"};s=_t(Y.card,K,s,ne,z).newState}}}s=gt(s),c=!s.actionRequired&&(!s.queuedActions||s.queuedActions.length===0);break}case"select_opponent_card_to_return":{const{sourceCardId:F,actor:U}=t.actionRequired,B=Mc(t,n);let G=B.newState;if(G.actionRequired){const W={type:"flip_self",sourceCardId:F,actor:U};G.queuedActions=[W,...G.queuedActions||[]],s=G,c=!1}else{const W=Ie(G,F);if(W){const P=`${W.card.protocol}-${W.card.value}`;G=te(G,U,`${P}: Flips itself.`);const z={type:"flip",cardId:F,owner:W.owner,laneIndex:W.laneIndex,cardIndex:W.cardIndex},H=G._pendingAnimationRequests||[];G._pendingAnimationRequests=[...H,z],G=_l(new Set([F]),G)}s=G,c=!0}B.animationRequests&&(d={animationRequests:B.animationRequests,onCompleteCallback:(W,P)=>W.actionRequired?W:P(W)}),s=gt(s),c||(c=!s.actionRequired&&(!s.queuedActions||s.queuedActions.length===0));break}case"select_any_card_to_flip":{const F=Ie(t,n),{count:U,sourceCardId:B,actor:G}=t.actionRequired,W=Ie(t,B);if(!W||!W.card.isFaceUp){const H=W?`${W.card.protocol}-${W.card.value}`:"a card";s=te(t,G,`Effect from ${H} was cancelled because the source is no longer active.`),s=gt(s),s.actionRequired=null,c=!0;break}let P=null;U>1&&(P={type:"select_any_card_to_flip",count:U-1,sourceCardId:B,actor:G});let z=xu(t,n,P,r);if(F&&!F.card.isFaceUp){const H=Cu(z,n),A=H.newState.actionRequired;A&&A!==P&&P&&(H.newState.queuedActions=[...H.newState.queuedActions||[],P]),s=H.newState,H.animationRequests&&(d={animationRequests:H.animationRequests,onCompleteCallback:lu})}else s=z;s=gt(s),c=!s.actionRequired&&(!s.queuedActions||s.queuedActions.length===0);break}case"select_board_card_to_reveal_custom":{const{sourceCardId:F,actor:U,followUpAction:B,optional:G}=t.actionRequired,W=U.charAt(0).toUpperCase()+U.slice(1),P=Ie(t,n);if(!P)return{nextState:t,requiresTurnEnd:!0};const z=P.owner,H=t[z].lanes.findIndex(O=>O.some(M=>M.id===n));if(H===-1)return{nextState:t,requiresTurnEnd:!0};const A=[...t[z].lanes[H]],N=A.findIndex(O=>O.id===n);if(N===-1)return{nextState:t,requiresTurnEnd:!0};A[N]={...A[N],isFaceUp:!0};const T=[...t[z].lanes];T[H]=A,s={...t,[z]:{...t[z],lanes:T}};const q=`${A[N].protocol}-${A[N].value}`;s=te(s,U,`${W} reveals ${q}.`),s.actionRequired={type:"prompt_shift_or_flip_board_card_custom",sourceCardId:F,revealedCardId:n,followUpAction:B,optional:G!==!1,actor:U},c=!1;break}case"select_phase_effect":{const F=t.actionRequired;if(!F.availableEffects.find(G=>G.cardId===n))return console.warn(`[cardResolver] Invalid phase effect selection: ${n} not in available effects`),{nextState:t};const B=F.phase==="Start"?"_selectedStartEffectId":"_selectedEndEffectId";s[B]=n,s.actionRequired=null,c=!1;break}case"select_card_for_copy_middle":{const F=t.actionRequired;if(!F.validTargetIds.includes(n))return console.warn(`[cardResolver] Invalid copy_middle target: ${n}`),{nextState:t};const U=Ie(t,n);if(!U)return console.error(`[cardResolver] Target card not found: ${n}`),{nextState:t};const{card:B,owner:G}=U;s[G].lanes.findIndex(O=>O.some(M=>M.id===n));const W=Wx(B);if(W.length===0){s=te(s,F.actor,`${B.protocol}-${B.value} has no middle commands.`),s.actionRequired=null;break}s=te(s,F.actor,`Copies the middle command of ${B.protocol}-${B.value}.`);const P=Ie(t,F.sourceCardId),z=P?s[P.owner].lanes.findIndex(O=>O.some(M=>M.id===F.sourceCardId)):0,H={cardOwner:F.actor,actor:F.actor,opponent:F.actor==="player"?"opponent":"player",currentTurn:s.turn,triggerType:"on_play"},A=[...s.processedEndEffectIds||[]],N=[...s.processedStartEffectIds||[]];let T=s;T.actionRequired=null;for(const O of W){if(O.trigger!=="on_play")continue;const M=P==null?void 0:P.card;if(!M)continue;if(T=_t(M,z,T,H,O).newState,T.actionRequired)return{nextState:T,requiresTurnEnd:!1}}T.processedEndEffectIds=[...new Set([...T.processedEndEffectIds||[],...A])],T.processedStartEffectIds=[...new Set([...T.processedStartEffectIds||[],...N])];const q=F.sourceCardId;q&&t.phase==="end"&&(T.processedEndEffectIds.includes(q)||T.processedEndEffectIds.push(q)),q&&t.phase==="start"&&(T.processedStartEffectIds.includes(q)||T.processedStartEffectIds.push(q)),T.actionRequired=null,s=T;break}default:return{nextState:t,requiresTurnEnd:!0}}if(!d&&s.actionRequired===null){if(s.queuedActions&&s.queuedActions.length>0){const F=[...s.queuedActions],U=F.shift();if((U==null?void 0:U.type)==="execute_remaining_custom_effects")return{nextState:{...gt(s),actionRequired:null,queuedActions:[U,...F]},requiresTurnEnd:!1};if((U==null?void 0:U.type)==="shift_flipped_card_optional"||(U==null?void 0:U.type)==="gravity_2_shift_after_flip"){const B=Ie(s,U.sourceCardId),G=vo(s,U.sourceCardId);if(!B||!B.card.isFaceUp||!G){const W=B?`${B.card.protocol}-${B.card.value}`:"the source card",P=te(s,U.actor,`Shift from ${W} was cancelled because the source is no longer active.`);if(F.length>0){const z=F.shift();return(z==null?void 0:z.type)==="execute_remaining_custom_effects"?{nextState:{...P,queuedActions:[z,...F]},requiresTurnEnd:!1}:{nextState:{...P,actionRequired:z,queuedActions:F},requiresTurnEnd:!1}}else return{nextState:{...P,actionRequired:null,queuedActions:[]},requiresTurnEnd:!0}}}return(U==null?void 0:U.type)==="execute_remaining_custom_effects"?{nextState:{...s,queuedActions:[U,...F]},requiresTurnEnd:!1}:{nextState:{...s,actionRequired:U,queuedActions:F},requiresTurnEnd:!1}}}else!d&&s.actionRequired!==null&&(c=!1);return{nextState:s,requiresAnimation:d,requiresTurnEnd:c}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Lc=(t,n,r,s,c,d=c)=>{var z,H,A,N,T,q;const u={...t[c]},p=u.hand.find(O=>O.id===n);if(!p)return{newState:t};if(d===c){const O=t._ignoreProtocolMatching||!1,M=Cr(t,c,r,s,p.protocol,p,O);if(!M.allowed)return console.error(`Illegal Move: ${c} tried to play ${p.protocol}-${p.value} - ${M.reason}`),{newState:t}}const f=c==="player"?"opponent":"player",y=t[d==="player"?"opponent":"player"].lanes[r],m=y.length>0?y[y.length-1]:null;if(m&&m.isFaceUp&&m.protocol==="Plague"&&m.value===0)return{newState:t};if(!s&&m&&m.isFaceUp&&m.protocol==="Metal"&&m.value===2)return console.error(`Illegal Move: ${c} tried to play face-down against Metal-2 in lane ${r}`),{newState:t};if(s){const O=t[d].protocols[r],M=u.protocols[r],Y=t[f].protocols[r],X=t[f].lanes.flat().some(ee=>ee.isFaceUp&&ee.protocol==="Psychic"&&ee.value===1),K=[...t.player.lanes.flat(),...t.opponent.lanes.flat()].some(ee=>ee.isFaceUp&&ee.protocol==="Anarchy"&&ee.value===1),ne=Au(t),Z=t[c].lanes.flat().some(ee=>ee.isFaceUp&&ee.protocol==="Spirit"&&ee.value===1),oe=((H=(z=p.customEffects)==null?void 0:z.bottomEffects)==null?void 0:H.some(ee=>{var je,de;return((je=ee.params)==null?void 0:je.action)==="card_property"&&((de=ee.params)==null?void 0:de.property)==="ignore_protocol_matching"}))||((N=(A=p.customEffects)==null?void 0:A.topEffects)==null?void 0:N.some(ee=>{var je,de;return((je=ee.params)==null?void 0:je.action)==="card_property"&&((de=ee.params)==null?void 0:de.property)==="ignore_protocol_matching"}))||((q=(T=p.customEffects)==null?void 0:T.middleEffects)==null?void 0:q.some(ee=>{var je,de;return((je=ee.params)==null?void 0:je.action)==="card_property"&&((de=ee.params)==null?void 0:de.property)==="ignore_protocol_matching"})),xe=Wc(t,c,r),ye=ml(t,p),Ce=Cl(t,c,r,p.protocol),pe=t._ignoreProtocolMatching||!1;let _e;if(ye?_e=!X:d!==c?_e=p.protocol===O&&!X:K||ne?_e=p.protocol!==M&&p.protocol!==Y&&!X:_e=(p.protocol===M||p.protocol===Y||Z||oe||xe||Ce||pe)&&!X,!_e){const ee=K||ne?"Non-matching protocol required":"matching protocol required";return console.error(`Illegal Move: ${c} tried to play ${p.protocol}-${p.value} face-up in lane ${r} (${ee}, protocols: player=${M}, opponent=${Y})`),{newState:t}}}let g={...t,_committedCardId:n};t._currentEffectSource!==void 0||t._currentPhaseContext!==void 0||t._logIndentLevel!==void 0&&t._logIndentLevel>0?g._currentPhaseContext!=="after"&&(g=Ga(g)):(g=st(g,void 0),g=ft(g,void 0),g={...g,_logIndentLevel:0});const C=c==="player"?"Player":"Opponent",b=g[d].protocols[r];let x;if(c==="opponent"&&!s)x=`${C} plays a face-down card into Protocol ${b}.`;else{const O=`${p.protocol}-${p.value}`;x=`${C} plays ${O}`,s||(x+=" face-down"),d!==c?x+=` into ${d==="player"?"Player's":"Opponent's"} Protocol ${b}.`:x+=` into Protocol ${b}.`}g=te(g,c,x),g=Ga(g);let j={newState:g};const E=g[d].lanes[r];if(E.length>0){const O=E[E.length-1];let Y=wt(g,"on_cover",{player:d,cardId:O.id}).newState;if(Y[d].lanes[r].some(ne=>ne.id===O.id)&&O.isFaceUp){const ne={cardOwner:d,actor:c,currentTurn:Y.turn,opponent:d==="player"?"opponent":"player",triggerType:"cover"},Z={...Y,_coveringCardProtocol:p.protocol};j=vs(O,r,Z,ne)}else j={newState:Y}}const k=j.newState;if(j.animationRequests&&j.animationRequests.length>0){const O={...g,[d]:{...g[d],lanes:g[d].lanes.map((M,Y)=>Y===r?[...M,{...p,isFaceUp:s,isRevealed:!1}]:M)}};j.animationRequests=j.animationRequests.map(M=>M.type==="delete"?{...M,_snapshotState:O}:M)}const R={...p,isFaceUp:s,isRevealed:!1},D={...k[c]},L={...D.stats,cardsPlayed:D.stats.cardsPlayed+1},I=c==="player"?"playerFromHand":"aiFromHand",F=c==="player"?s?"playerFaceUp":"playerFaceDown":s?"aiFaceUp":"aiFaceDown",U=k.detailedGameStats?{...k.detailedGameStats,cardsPlayed:{...k.detailedGameStats.cardsPlayed,[I]:k.detailedGameStats.cardsPlayed[I]+1,[F]:k.detailedGameStats.cardsPlayed[F]+1}}:void 0;let B;if(d===c){const O={...D,hand:D.hand.filter(M=>M.id!==n),lanes:D.lanes.map((M,Y)=>Y===r?[...M,R]:M),stats:L};B={...k,[c]:O,stats:{...k.stats,[c]:L},detailedGameStats:U}}else{const O={...D,hand:D.hand.filter(X=>X.id!==n),stats:L},M={...k[d]},Y={...M,lanes:M.lanes.map((X,K)=>K===r?[...X,R]:X)};B={...k,[c]:O,[d]:Y,stats:{...k.stats,[c]:L},detailedGameStats:U}}const G=t.queuedActions||[],W=k.queuedActions||[];if(W===G||W.length===G.length&&W.every((O,M)=>O===G[M])?G.length>0&&(B.queuedActions=G):B.queuedActions=[...G,...W],B.lastPlayedCardId=R.id,B=qe(B),c==="opponent"&&!s&&(B=rx(B,R)),k.actionRequired||(B={...B,_logIndentLevel:0}),B=wt(B,"after_play",{player:c,cardId:R.id,laneIndex:r}).newState,k.actionRequired)return s&&(B.queuedEffect={card:R,laneIndex:r}),{newState:B,animationRequests:j.animationRequests};{if(B={...B,_committedCardId:void 0},c==="opponent")return s&&(B.queuedEffect={card:R,laneIndex:r}),{newState:B,animationRequests:j.animationRequests};let O={newState:B};if(s&&!B.actionRequired){const Y={cardOwner:d,actor:c,currentTurn:B.turn,opponent:d==="player"?"opponent":"player",triggerType:"play"};O=Sl(R,r,B,Y)}const M=[...j.animationRequests||[],...O.animationRequests||[]];return{newState:O.newState,animationRequests:M.length>0?M:void 0}}},fl=(t,n)=>{let r=st(t,void 0);return r=ft(r,void 0),r={...r,_logIndentLevel:0},nC(r,n)},by=(t,n)=>{if(t.useControlMechanic&&t.controlCardHolder===n){let r=te(t,n,`${n==="player"?"Player":"Opponent"} has Control and may rearrange protocols before refreshing.`);return r=Ga(r),{...r,controlCardHolder:null,actionRequired:{type:"prompt_use_control_mechanic",sourceCardId:"CONTROL_MECHANIC",actor:n,originalAction:{type:"fill_hand"}}}}return fl(t,n)};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const bu=(t,n)=>{var c,d,u,p,f,h,y,m,g,v,C,b,x,j,E,k,R,D,L,I,F,U,B,G,W,P,z,H,A,N;if(!t.actionRequired)return{nextState:t};let r={...t},s=null;switch(t.actionRequired.type){case"select_lane_for_shift_all":{const{cardsToShift:T,validDestinationLanes:q,sourceLaneIndex:O,actor:M,sourceCardId:Y}=t.actionRequired;if(!q.includes(n))return console.error(`Illegal shift: Lane ${n} is not a valid destination`),{nextState:t};if(n===O)return console.error(`Illegal shift: Cannot shift to the same lane ${O}`),{nextState:t};let X={...t};const K=[],ne=[...T].sort((Z,oe)=>{const xe=t[Z.owner].lanes.find(_e=>_e.some(ee=>ee.id===Z.cardId)),ye=t[oe.owner].lanes.find(_e=>_e.some(ee=>ee.id===oe.cardId)),Ce=(xe==null?void 0:xe.findIndex(_e=>_e.id===Z.cardId))??-1;return((ye==null?void 0:ye.findIndex(_e=>_e.id===oe.cardId))??-1)-Ce});for(const{cardId:Z,owner:oe}of ne){if(!Ie(X,Z))continue;const ye=X[oe].lanes.findIndex(_e=>_e.some(ee=>ee.id===Z));if(ye===-1||!gs(X,ye,n).allowed)continue;const pe=Xo(X,Z,oe,n,M);X=pe.newState,pe.animationRequests&&K.push(...pe.animationRequests)}if(r=X,r=gt(r),(!r.actionRequired||r.actionRequired.type==="select_lane_for_shift_all")&&(r.actionRequired=null),K.length>0){const Z=(c=t.actionRequired)==null?void 0:c.followUpEffect,oe=(d=t.actionRequired)==null?void 0:d.conditionalType;s={animationRequests:K,onCompleteCallback:(xe,ye)=>{if(xe.actionRequired||xe.queuedActions&&xe.queuedActions.length>0)return xe;let Ce=xe;if(Z&&Y&&(oe!=="if_executed"||K.length>0)){const _e=Ie(Ce,Y);if(_e&&_e.card.isFaceUp){const ee=Ce[_e.owner].lanes.find(Ue=>Ue.some(se=>se.id===Y)),je=Ce[_e.owner].lanes.indexOf(ee),de={cardOwner:_e.owner,actor:M,currentTurn:Ce.turn,opponent:_e.owner==="player"?"opponent":"player"};if(Ce=_t(_e.card,je,Ce,de,Z).newState,Ce.actionRequired)return Ce}}return ye(Ce)}}}break}case"select_lane_for_shift":{const{cardToShiftId:T,cardOwner:q,actor:O,sourceEffect:M,originalLaneIndex:Y,sourceCardId:X}=t.actionRequired;if(n===Y)return console.error(`Illegal shift: Cannot shift to the same lane ${Y}`),{nextState:t};const K=t.actionRequired.validLanes;if(K&&!K.includes(n))return console.error(`Illegal shift: Lane ${n} not in valid lanes ${K}`),{nextState:t};const ne=Ie(t,X),Z=Ie(t,T);if(ne&&ne.card.protocol==="Anarchy"&&ne.card.value===1&&Z&&Z.card.isFaceUp){const pe=t.player.protocols[n],_e=t.opponent.protocols[n],ee=Z.card.protocol;if(ee===pe||ee===_e)return console.error(`Illegal Anarchy-1 shift: ${ee}-${Z.card.value} cannot be shifted to lane ${n} (protocols: ${pe}/${_e}) - matching protocol not allowed`),{nextState:t}}if(ne&&ne.card.protocol==="Gravity"&&ne.card.value===1){let pe=-1;for(let _e=0;_e<t[ne.owner].lanes.length;_e++)if(t[ne.owner].lanes[_e].some(ee=>ee.id===X)){pe=_e;break}if(pe!==-1&&!(Y===pe)&&!(n===pe))return console.error(`Illegal Gravity-1 shift: Must shift to or from Gravity lane ${pe}, but tried ${Y}  ${n}`),{nextState:t}}if(t.actionRequired.destinationRestriction&&Z){const pe=t.actionRequired.destinationRestriction;if(pe.type==="non_matching_protocol"&&Z.card.isFaceUp){const _e=t.player.protocols[n],ee=t.opponent.protocols[n],je=Z.card.protocol;if(je===_e||je===ee)return console.error(`Illegal shift: ${je} cannot be shifted to lane ${n} (protocols: ${_e}/${ee}) - matching protocol not allowed`),{nextState:t}}if(pe.type==="to_or_from_this_lane"){const _e=pe.laneIndex==="current"&&ne?(()=>{for(let ee=0;ee<t[ne.owner].lanes.length;ee++)if(t[ne.owner].lanes[ee].some(je=>je.id===X))return ee;return-1})():pe.laneIndex;if(_e!==void 0&&_e!==-1&&!(Y===_e)&&!(n===_e))return console.error(`Illegal shift: Must shift to or from lane ${_e}, but tried ${Y}  ${n}`),{nextState:t}}}const oe=gs(t,Y,n);if(!oe.allowed)return console.error(`Illegal shift: Cannot shift from lane ${Y} to ${n} - ${oe.reason}`),{nextState:t};const xe=Xo(t,T,q,n,O);r=xe.newState;const ye=r.actionRequired!==null,Ce=!!T;if(r=Su(r,t.actionRequired,O,Ce),xe.animationRequests)s={animationRequests:xe.animationRequests,onCompleteCallback:(pe,_e)=>{var se,re;let ee=pe;if(ye){if(M==="speed_3_end"){const we={type:"speed_3_self_flip_after_shift",sourceCardId:t.actionRequired.sourceCardId,actor:O};ee.queuedActions=[...ee.queuedActions||[],we]}Ie(ee,X);const ce=ee._pendingCustomEffects;if(ce){const he=Ie(ee,ce.sourceCardId);if(he&&he.card.isFaceUp){const we=ee[he.owner].lanes.find(ke=>ke.some(Xe=>Xe.id===ce.sourceCardId));if(we&&we.length>0&&we[we.length-1].id===ce.sourceCardId){const ke={type:"execute_remaining_custom_effects",sourceCardId:ce.sourceCardId,laneIndex:ce.laneIndex,effects:ce.effects,context:ce.context,actor:O,logSource:ce.logSource,logPhase:ce.logPhase,logIndentLevel:ce.logIndentLevel};ee.queuedActions=[ke,...ee.queuedActions||[]]}}delete ee._pendingCustomEffects}return ee}if(M==="speed_3_end"){const ce=t.actionRequired.sourceCardId,he=Ie(ee,ce);if(ee=te(ee,O,"Speed-3: Flipping itself after shifting a card."),he){const we={type:"flip",cardId:ce,owner:he.owner,laneIndex:he.laneIndex,cardIndex:he.cardIndex},Se=ee._pendingAnimationRequests||[];ee._pendingAnimationRequests=[...Se,we]}ee=_l(new Set([ce]),ee)}const je=ee._pendingCustomEffects;if(je){const ce=Ie(ee,je.sourceCardId);if(ce&&ce.card.isFaceUp){const he=ee[ce.owner].lanes.find(Se=>Se.some(ke=>ke.id===je.sourceCardId));if(he&&he.length>0&&he[he.length-1].id===je.sourceCardId){for(const Se of je.effects)ee=_t(ce.card,je.laneIndex,ee,je.context,Se).newState;delete ee._pendingCustomEffects}else ee=te(ee,O,"Pending effects cancelled because source card is now covered."),delete ee._pendingCustomEffects}else delete ee._pendingCustomEffects}X&&(ee=br(ee)),ee=wt(ee,"after_shift",{player:O,cardId:T}).newState;const Pe=(se=t.actionRequired)==null?void 0:se.followUpEffect,Ue=(re=t.actionRequired)==null?void 0:re.conditionalType;if(Pe&&X&&(Ue!=="if_executed"||T)){const he=Ie(ee,X);if(he&&he.card.isFaceUp){const we=ee[he.owner].lanes.find(Me=>Me.some(Ne=>Ne.id===X)),Se=ee[he.owner].lanes.indexOf(we),ke={cardOwner:he.owner,actor:O,currentTurn:ee.turn,opponent:he.owner==="player"?"opponent":"player"},Xe=`${he.card.protocol}-${he.card.value}`,Le=t._currentPhaseContext||(t.phase==="start"?"start":"end");ee={...ee,_logIndentLevel:1,_currentEffectSource:Xe,_currentPhaseContext:Le},ee=_t(he.card,Se,ee,ke,Pe).newState}}if(ee=gt(ee),ee.actionRequired=null,ee.queuedActions&&ee.queuedActions.length>0){const ce=ee.queuedActions[0];ce.type==="execute_remaining_custom_effects"?ee=Wa(ee):(ee.queuedActions=ee.queuedActions.slice(1),ee.actionRequired=ce)}return ee._interruptedTurn?Sr(ee):_e(ee)}};else if(ye){if(M==="speed_3_end"){const je={type:"speed_3_self_flip_after_shift",sourceCardId:t.actionRequired.sourceCardId,actor:O};r.queuedActions=[...r.queuedActions||[],je]}const pe=(u=t.actionRequired)==null?void 0:u.followUpEffect,_e=(p=t.actionRequired)==null?void 0:p.conditionalType;if(pe&&X&&(_e!=="if_executed"||T)){const je=Ie(r,X),de=t._currentPhaseContext||(t.phase==="start"?"start":"end"),Pe={type:"execute_follow_up_effect",sourceCardId:X,followUpEffect:pe,actor:O,logContext:{indentLevel:1,sourceCardName:je?`${je.card.protocol}-${je.card.value}`:void 0,phase:de}};r.queuedActions=[...r.queuedActions||[],Pe]}}else{if(M==="speed_3_end"){const de=t.actionRequired.sourceCardId,Pe=Ie(r,de);if(r=te(r,O,"Speed-3: Flipping itself after shifting a card."),Pe){const Ue={type:"flip",cardId:de,owner:Pe.owner,laneIndex:Pe.laneIndex,cardIndex:Pe.cardIndex},se=r._pendingAnimationRequests||[];r._pendingAnimationRequests=[...se,Ue]}r=_l(new Set([de]),r)}const pe=r._pendingCustomEffects;if(pe){const de=Ie(r,pe.sourceCardId);if(de&&de.card.isFaceUp){const Pe=r[de.owner].lanes.find(se=>se.some(re=>re.id===pe.sourceCardId));if(Pe&&Pe.length>0&&Pe[Pe.length-1].id===pe.sourceCardId){for(const se of pe.effects)r=_t(de.card,pe.laneIndex,r,pe.context,se).newState;delete r._pendingCustomEffects}else r=te(r,O,"Pending effects cancelled because source card is now covered."),delete r._pendingCustomEffects}else delete r._pendingCustomEffects}X&&(r=br(r)),r=wt(r,"after_shift",{player:O,cardId:T}).newState;const ee=(f=t.actionRequired)==null?void 0:f.followUpEffect,je=(h=t.actionRequired)==null?void 0:h.conditionalType;if(ee&&X&&(je!=="if_executed"||T)){const Pe=Ie(r,X);if(Pe&&Pe.card.isFaceUp){const Ue=r[Pe.owner].lanes.find(Se=>Se.some(ke=>ke.id===X)),se=r[Pe.owner].lanes.indexOf(Ue),re={cardOwner:Pe.owner,actor:O,currentTurn:r.turn,opponent:Pe.owner==="player"?"opponent":"player"},ce=`${Pe.card.protocol}-${Pe.card.value}`,he=t._currentPhaseContext||(t.phase==="start"?"start":"end");r={...r,_logIndentLevel:1,_currentEffectSource:ce,_currentPhaseContext:he},r=_t(Pe.card,se,r,re,ee).newState}}if(r=gt(r),r.actionRequired=null,r.queuedActions&&r.queuedActions.length>0){const de=r.queuedActions[0];de.type==="execute_remaining_custom_effects"?r=Wa(r):(r.queuedActions=r.queuedActions.slice(1),r.actionRequired=de)}}break}case"shift_flipped_card_optional":{const T=t.actionRequired.cardId,q=t.actionRequired.actor;let O=null;for(const ne of["player","opponent"])if(t[ne].lanes.flat().some(Z=>Z.id===T)){O=ne;break}if(!O){console.error("[shift_flipped_card_optional] Card not found on board:",T),r=t;break}const M=(y=t.actionRequired)==null?void 0:y.followUpEffect,Y=(m=t.actionRequired)==null?void 0:m.conditionalType,X=(g=t.actionRequired)==null?void 0:g.sourceCardId,K=Xo(t,T,O,n,q);if(r=K.newState,M&&X&&(Y!=="if_executed"||T)){const Z=Ie(r,X),oe=t._currentPhaseContext||(t.phase==="start"?"start":"end"),xe={type:"execute_follow_up_effect",sourceCardId:X,followUpEffect:M,actor:q,logContext:{indentLevel:1,sourceCardName:Z?`${Z.card.protocol}-${Z.card.value}`:void 0,phase:oe}};r={...r,queuedActions:[...r.queuedActions||[],xe]}}K.animationRequests&&(s={animationRequests:K.animationRequests,onCompleteCallback:(ne,Z)=>Z(ne)});break}case"select_lane_for_play":{const{cardInHandId:T,isFaceDown:q,actor:O,source:M,disallowedLaneIndex:Y,validLanes:X,preSelectedLane:K,ignoreProtocolMatching:ne}=t.actionRequired,Z=K!==void 0?K:n;if(Y!==void 0&&Z===Y)return{nextState:t,requiresTurnEnd:!1};if(X&&!X.includes(Z))return{nextState:t,requiresTurnEnd:!1};if(M==="deck"){const _e=(v=t.actionRequired)==null?void 0:v.followUpEffect;(C=t.actionRequired)==null||C.conditionalType;const ee=(b=t.actionRequired)==null?void 0:b.sourceCardId,je=(x=t.actionRequired)==null?void 0:x.preDrawnCard,de={...t,actionRequired:null},Pe=de[O];let Ue,se=Pe.deck,re=Pe.discard;if(je)Ue={...je,isFaceUp:!q};else{const ke=ca(Pe.deck,Pe.discard,1);if(se=ke.remainingDeck,re=ke.newDiscard,ke.drawnCards.length===0){console.error("No cards in deck/discard to play"),r=de;break}Ue={...ke.drawnCards[0],id:pt(),isFaceUp:!q}}const ce=[...Pe.lanes];ce[Z]=[...ce[Z],Ue];const he={...Pe,lanes:ce,deck:se,discard:re};r={...de,[O]:he,lastCustomEffectTargetCardId:Ue.id};const we=O==="player"?"Player":"Opponent",Se=q?"face-down":"face-up";r=te(r,O,`${we} plays ${Ue.protocol}-${Ue.value} ${Se} from deck.`),s={animationRequests:[{type:"play",cardId:Ue.id,owner:O,laneIndex:Z,isFaceUp:Ue.isFaceUp}],onCompleteCallback:(ke,Xe)=>{let Le=ke;if(_e&&ee){const be=Ie(Le,ee);if(be&&be.card.isFaceUp){const Me=Le[be.owner].lanes.find(De=>De.some(Ge=>Ge.id===ee)),Ne=Le[be.owner].lanes.indexOf(Me),Be={cardOwner:be.owner,actor:O,currentTurn:Le.turn,opponent:be.owner==="player"?"opponent":"player"};if(Le=_t(be.card,Ne,Le,Be,_e).newState,Le.actionRequired)return Le}}return Xe(Le)}};break}if(M==="trash"){const _e=(j=t.actionRequired)==null?void 0:j.preDrawnCard,ee=(E=t.actionRequired)==null?void 0:E.sourceCardId,je=(k=t.actionRequired)==null?void 0:k.followUpEffect,de=(R=t.actionRequired)==null?void 0:R.conditionalType,Pe=(D=t.actionRequired)==null?void 0:D.useNormalPlayRules;if(!_e){console.error("No preDrawnCard for trash play"),r={...t,actionRequired:null};break}const Ue={...t,actionRequired:null};Ue[O];let se;if(typeof q=="boolean")se=!q;else if(Pe){const be=O==="player"?"opponent":"player",Me=t[O].protocols[Z],Ne=t[be].protocols[Z],Be=_e.protocol===Me||_e.protocol===Ne,Ye=Wc(t,O,Z);se=Be||Ye}else se=!0;const re={..._e,isFaceUp:se};let ce=Ue;const he=ce[O].lanes[Z];if(he.length>0){const be=he[he.length-1];if(ce=wt(ce,"on_cover",{player:O,cardId:be.id}).newState,ce[O].lanes[Z].some(Ye=>Ye.id===be.id)&&be.isFaceUp){const Ye={cardOwner:O,actor:O,currentTurn:ce.turn,opponent:O==="player"?"opponent":"player",triggerType:"cover"},De={...ce,_coveringCardProtocol:re.protocol};ce=vs(be,Z,De,Ye).newState}}const we=ce[O],Se=[...we.lanes];Se[Z]=[...Se[Z],re];const ke={...we,lanes:Se};r={...ce,[O]:ke,lastCustomEffectTargetCardId:re.id};const Xe=O==="player"?"Player":"Opponent",Le=se?"face-up":"face-down";r=te(r,O,`${Xe} plays ${re.protocol}-${re.value} ${Le} from trash.`),r=qe(r),s={animationRequests:[{type:"play",cardId:re.id,owner:O,laneIndex:Z,isFaceUp:re.isFaceUp}],onCompleteCallback:(be,Me)=>{let Ne=be;if(re.isFaceUp){const Be=Ie(Ne,re.id);if(Be){const Ye={cardOwner:O,actor:O,currentTurn:Ne.turn,opponent:O==="player"?"opponent":"player",triggerType:"play"};if(Ne=Sl(Be.card,Z,Ne,Ye).newState,Ne.actionRequired)return je&&ee&&(Ne={...Ne,queuedActions:[...Ne.queuedActions||[],{type:"execute_followup_effect",sourceCardId:ee,followUpEffect:je,conditionalType:de,actor:O}]}),Ne}}if(je&&ee){const Be=Ie(Ne,ee);if(Be&&Be.card.isFaceUp){const Ye=Ne[Be.owner].lanes.find(tt=>tt.some(rt=>rt.id===ee)),De=Ne[Be.owner].lanes.indexOf(Ye),Ge={cardOwner:Be.owner,actor:O,currentTurn:Ne.turn,opponent:Be.owner==="player"?"opponent":"player"};if(Ne=_t(Be.card,De,Ne,Ge,je).newState,Ne.actionRequired)return Ne}}return Me(Ne)}};break}const oe=t[O].hand.find(_e=>_e.id===T);if(!oe){console.error("Card for play not found in hand"),r={...t,actionRequired:null};break}const xe={...t,actionRequired:null,_ignoreProtocolMatching:ne||!1};let ye;if(typeof q=="boolean")ye=!q;else{const _e=t[O].lanes.flat().some(Ue=>Ue.isFaceUp&&Ue.protocol==="Spirit"&&Ue.value===1),ee=((I=(L=oe.customEffects)==null?void 0:L.bottomEffects)==null?void 0:I.some(Ue=>{var se,re;return((se=Ue.params)==null?void 0:se.action)==="card_property"&&((re=Ue.params)==null?void 0:re.property)==="ignore_protocol_matching"}))||((U=(F=oe.customEffects)==null?void 0:F.topEffects)==null?void 0:U.some(Ue=>{var se,re;return((se=Ue.params)==null?void 0:se.action)==="card_property"&&((re=Ue.params)==null?void 0:re.property)==="ignore_protocol_matching"}))||((G=(B=oe.customEffects)==null?void 0:B.middleEffects)==null?void 0:G.some(Ue=>{var se,re;return((se=Ue.params)==null?void 0:se.action)==="card_property"&&((re=Ue.params)==null?void 0:re.property)==="ignore_protocol_matching"})),je=O==="player"?"opponent":"player",de=t[je].lanes.flat().some(Ue=>Ue.isFaceUp&&Ue.protocol==="Psychic"&&Ue.value===1),Pe=Cl(t,O,Z,oe.protocol);ye=(_e||ee||ne||Pe||oe.protocol===t[O].protocols[Z]||oe.protocol===t[je].protocols[Z])&&!de}const{newState:Ce,animationRequests:pe}=Lc(xe,T,Z,ye,O);r=Ce,pe&&(s={animationRequests:pe,onCompleteCallback:(_e,ee)=>(_e.queuedActions&&_e.queuedActions.length>0,ee(_e))});break}case"select_lane_for_delete":{const T=t.actionRequired.actor,q=T==="player"?"Player":"Opponent",O=t.player.protocols[n],M=t.actionRequired.targetFilter||{},Y=Ie(t,t.actionRequired.sourceCardId),X=Y?`${Y.card.protocol}-${Y.card.value}`:"a card effect",K=t.actionRequired.count||1,ne=t.actionRequired.deleteAll===!0,Z=t.actionRequired.validLanes;if(Z&&!Z.includes(n))return console.error(`Illegal delete lane selection: Lane ${n} not in valid lanes ${Z}`),{nextState:t};r=te(r,T,`${X}: ${q} targets Protocol ${O}.`);const oe=new Map;for(const pe of["player","opponent"]){const _e=t[pe].lanes[n];oe.set(pe,_e.length>0?_e[_e.length-1].id:null)}const xe=[],ye=[],Ce=new Set;for(const pe of["player","opponent"]){const _e=t[pe],ee=_e.lanes[n].some(de=>de.isFaceUp&&de.protocol==="Darkness"&&de.value===2)?4:2,je=_e.lanes[n];for(let de=0;de<je.length;de++){const Pe=je[de],Ue=de===je.length-1,se=Pe.isFaceUp?Pe.value:ee;if(M.valueRange){const{min:he,max:we}=M.valueRange;if(se<he||se>we)continue}if(M.faceState==="face_up"&&!Pe.isFaceUp||M.faceState==="face_down"&&Pe.isFaceUp||M.owner==="own"&&pe!==T||M.owner==="opponent"&&pe===T||M.position==="uncovered"&&!Ue||M.position==="covered"&&Ue)continue;xe.push({type:"delete",cardId:Pe.id,owner:pe,cardSnapshot:{...Pe},laneIndex:n,cardIndex:de}),Ce.add(Pe.id);const re=pe==="player"?"Player's":"Opponent's",ce=Pe.isFaceUp?`${Pe.protocol}-${Pe.value}`:"a face-down card";if(ye.push(`${re} ${ce}`),!ne&&xe.length>=K)break}if(!ne&&xe.length>=K)break}if(ye.length>0){r=te(r,T,`${X}: Deleting ${ye.join(", ")}.`);const pe={...r.stats[T],cardsDeleted:r.stats[T].cardsDeleted+ye.length},_e={...r[T],stats:pe};r={...r,[T]:_e,stats:{...r.stats,[T]:pe}}}xe.sort((pe,_e)=>(_e.cardIndex??0)-(pe.cardIndex??0));for(const pe of xe)r=pl(r,pe.cardId);if(r=qe(r),r=gt(r),r.actionRequired=null,xe.length>0){const pe=(W=t.actionRequired)==null?void 0:W.followUpEffect,_e=(P=t.actionRequired)==null?void 0:P.conditionalType,ee=t.actionRequired.sourceCardId;s={animationRequests:xe,onCompleteCallback:(je,de)=>{let Pe=je;Pe=wt(Pe,"after_delete",{player:T}).newState;const se=[];for(const re of["player","opponent"]){const ce=oe.get(re),he=Pe[re].lanes[n];ce&&Ce.has(ce)&&he.length>0&&se.push(re)}for(let re=0;re<se.length;re++){const ce=se[re];if(Pe=Sa(Pe,ce,n).newState,Pe.actionRequired&&re<se.length-1){const we=se.slice(re+1);for(const Se of we)Pe.queuedActions=[...Pe.queuedActions||[],{type:"pending_uncover_effect",owner:Se,laneIndex:n}];return Pe}}if(pe&&ee&&(_e!=="if_executed"||xe.length>0)){const ce=Ie(Pe,ee);if(ce&&ce.card.isFaceUp){const he=Pe[ce.owner].lanes.find(Xe=>Xe.some(Le=>Le.id===ee)),we=Pe[ce.owner].lanes.indexOf(he),Se={cardOwner:ce.owner,actor:T,currentTurn:Pe.turn,opponent:ce.owner==="player"?"opponent":"player"};if(Pe=_t(ce.card,we,Pe,Se,pe).newState,Pe.actionRequired)return Pe}}return de(Pe)}}}break}case"select_lane_for_return":{const T=t.actionRequired.actor,q=T==="player"?"Player":"Opponent",O=t.player.protocols[n],M=t.actionRequired.targetFilter||{},Y=Ie(t,t.actionRequired.sourceCardId),X=Y?`${Y.card.protocol}-${Y.card.value}`:"a card effect";r=te(r,T,`${X}: ${q} targets Protocol ${O}.`);const K=[],ne=[];for(const Z of["player","opponent"]){const oe=t[Z],xe=oe.lanes[n].some(Ce=>Ce.isFaceUp&&Ce.protocol==="Darkness"&&Ce.value===2)?4:2,ye=oe.lanes[n];for(let Ce=0;Ce<ye.length;Ce++){const pe=ye[Ce],_e=pe.isFaceUp?pe.value:xe;if(M.valueEquals!==void 0&&_e!==M.valueEquals||M.faceState==="face_up"&&!pe.isFaceUp||M.faceState==="face_down"&&pe.isFaceUp||M.owner==="own"&&Z!==T||M.owner==="opponent"&&Z===T)continue;K.push({type:"return",cardId:pe.id,owner:Z,cardSnapshot:{...pe},laneIndex:n,cardIndex:Ce});const ee=Z==="player"?"Player's":"Opponent's",je=pe.isFaceUp?`${pe.protocol}-${pe.value}`:"a face-down card";ne.push(`${ee} ${je}`)}}if(K.length===0){r=te(r,T,`${X}: No matching cards in Protocol ${O}.`),r=gt(r),r.actionRequired=null;break}ne.length>0&&(r=te(r,T,`${X}: Returning ${ne.join(", ")}.`)),K.sort((Z,oe)=>(oe.cardIndex??0)-(Z.cardIndex??0));for(const Z of K)r=Mc(r,Z.cardId).newState;if(r=qe(r),r=gt(r),r.actionRequired=null,K.length>0){const Z=(z=t.actionRequired)==null?void 0:z.followUpEffect,oe=(H=t.actionRequired)==null?void 0:H.conditionalType,xe=t.actionRequired.sourceCardId;s={animationRequests:K,onCompleteCallback:(ye,Ce)=>{let pe=ye;if(Z&&xe&&(oe!=="if_executed"||K.length>0)){const ee=Ie(pe,xe);if(ee&&ee.card.isFaceUp){const je=pe[ee.owner].lanes.find(se=>se.some(re=>re.id===xe)),de=pe[ee.owner].lanes.indexOf(je),Pe={cardOwner:ee.owner,actor:T,currentTurn:pe.turn,opponent:ee.owner==="player"?"opponent":"player"};if(pe=_t(ee.card,de,pe,Pe,Z).newState,pe.actionRequired)return pe}}return Ce(pe)}}}break}case"select_lane_for_delete_all":{const T=t.actionRequired.actor,q=T==="player"?"Player":"Opponent",O=t.player.protocols[n],M=t.actionRequired.minCards||8;if(!(t.actionRequired.validLanes||[0,1,2]).includes(n)){r=te(r,T,"Cannot select this lane for deletion.");break}const X=t.player.lanes[n].length+t.opponent.lanes[n].length;if(X<M){r=te(r,T,`Cannot delete ${O} line (only ${X} cards, need ${M}+).`),r=gt(r),r.actionRequired=null;break}const K=Ie(t,t.actionRequired.sourceCardId),ne=K?`${K.card.protocol}-${K.card.value}`:"Effect";r=te(r,T,`${ne}: ${q} deletes all cards in ${O} line.`);const Z=[];for(const ye of["player","opponent"]){const Ce=t[ye].lanes[n];for(let pe=0;pe<Ce.length;pe++){const _e=Ce[pe];Z.push({type:"delete",cardId:_e.id,owner:ye,cardSnapshot:{..._e},laneIndex:n,cardIndex:pe})}}const oe={...r.stats[T],cardsDeleted:r.stats[T].cardsDeleted+Z.length},xe={...r[T],stats:oe};r={...r,[T]:xe,stats:{...r.stats,[T]:oe}},Z.sort((ye,Ce)=>(Ce.cardIndex??0)-(ye.cardIndex??0));for(const ye of Z)r=pl(r,ye.cardId);if(r=qe(r),r=gt(r),r.actionRequired=null,Z.length>0){const ye=(A=t.actionRequired)==null?void 0:A.followUpEffect,Ce=(N=t.actionRequired)==null?void 0:N.conditionalType,pe=t.actionRequired.sourceCardId;s={animationRequests:Z,onCompleteCallback:(_e,ee)=>{let je=_e;if(je=wt(je,"after_delete",{player:T}).newState,ye&&pe&&(Ce!=="if_executed"||Z.length>0)){const Ue=Ie(je,pe);if(Ue&&Ue.card.isFaceUp){const se=je[Ue.owner].lanes.find(we=>we.some(Se=>Se.id===pe)),re=je[Ue.owner].lanes.indexOf(se),ce={cardOwner:Ue.owner,actor:T,currentTurn:je.turn,opponent:Ue.owner==="player"?"opponent":"player"};if(je=_t(Ue.card,re,je,ce,ye).newState,je.actionRequired)return je}}return ee(je)}}}break}case"select_lane_to_shift_revealed_board_card_custom":{const{revealedCardId:T,actor:q}=t.actionRequired,O=Ie(t,T);if(O){const M=Xo(t,T,O.owner,n,q);r=M.newState,M.animationRequests&&(s={animationRequests:M.animationRequests,onCompleteCallback:(Y,X)=>Y.actionRequired?Y:X(Y)})}break}case"select_lanes_for_swap_stacks":{const{actor:T,sourceCardId:q,validLanes:O,selectedFirstLane:M}=t.actionRequired;if(!O.includes(n))return console.error(`Illegal swap_stacks: Lane ${n} is not a valid selection`),{nextState:t};if(M===void 0)r.actionRequired={type:"select_lanes_for_swap_stacks",actor:T,sourceCardId:q,validLanes:O.filter(Y=>Y!==n),selectedFirstLane:n},r=te(r,T,`Selected lane ${n+1} for swap.`);else{const Y=M,X=n,K=[...r[T].lanes[Y]],ne=[...r[T].lanes[X]];r[T].lanes[Y]=ne,r[T].lanes[X]=K,r=te(r,T,`Swapped all cards between lane ${Y+1} and lane ${X+1}.`),r.actionRequired=null}break}default:return{nextState:t}}return{nextState:qe(r),requiresAnimation:s}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const zm=(t,n)=>{if(t.processedSpeed1TriggerThisTurn)return t;if(t[n].lanes.flat().some(c=>c.isFaceUp&&c.protocol==="Speed"&&c.value===1)){let c={...t};return c=st(c,"Speed-1"),c=ft(c,void 0),c=te(c,n,"Triggers after clearing cache: Draw 1 card."),c=bl(c,n,1),c.processedSpeed1TriggerThisTurn=!0,c=st(c,void 0),c.phase="end",c}return t},Bm=(t,n,r,s,c,d,u)=>{const p=Ie(t,c);if(!p)return t;const f=t[d].hand.length,h=Math.max(0,(s||0)-f);if(!(r==="then"||r==="if_executed"&&h>0))return t;const m=`${p.card.protocol}-${p.card.value}`;let g=st(t,m);g=ft(g,"middle"),u!==void 0&&(g={...g,_logIndentLevel:u});let v=-1;for(let j=0;j<g[p.owner].lanes.length;j++)if(g[p.owner].lanes[j].some(E=>E.id===c)){v=j;break}if(v===-1)return g;const C={cardOwner:p.owner,opponent:p.owner==="player"?"opponent":"player",currentTurn:g.turn,actor:d,discardedCount:h},b=_t(p.card,v,g,C,n);let x=b.newState;if(b.animationRequests&&b.animationRequests.length>0){const j=x._pendingAnimationRequests||[];x._pendingAnimationRequests=[...j,...b.animationRequests]}return x},Uc=(t,n,r)=>{var P,z;const s=t[r],c=new Set(n),d=s.hand.filter(H=>c.has(H.id));if(d.length===0)return t;const u=[...s.hand],p=d.map((H,A)=>{const N=s.hand.findIndex(T=>T.id===H.id);return{type:"discard",cardId:H.id,owner:r,handIndex:N,cardSnapshot:H,preDiscardHand:u,discardIndex:A}}),f=t._pendingAnimationRequests||[],h=s.hand.filter(H=>!c.has(H.id)),y=((P=t.actionRequired)==null?void 0:P.type)==="discard"?t.actionRequired:null,m=(y==null?void 0:y.discardTo)||"own_trash",g=r==="player"?"opponent":"player",v=m==="opponent_trash"?g:r,C=d.map(({id:H,isFaceUp:A,...N})=>N),b={...s.stats,cardsDiscarded:s.stats.cardsDiscarded+d.length},x={...s,hand:h,stats:b};v===r&&(x.discard=[...s.discard,...C]),y==null||y.followUpEffect,y==null||y.conditionalType,y==null||y.previousHandSize;let j;if(v===g){const H=t[g],A={...H,discard:[...H.discard,...C]};j={...t,[r]:x,[g]:A,stats:{...t.stats,[r]:b},actionRequired:null}}else j={...t,[r]:x,stats:{...t.stats,[r]:b},actionRequired:null};if(j._pendingAnimationRequests=[...f,...p],y!=null&&y.sourceCardId){const H=j.player.lanes.flat().find(A=>A.id===y.sourceCardId)||j.opponent.lanes.flat().find(A=>A.id===y.sourceCardId);if(H){const A=`${H.protocol}-${H.value}`;j=st(j,A),j=ft(j,"middle")}else j=st(j,void 0),j=ft(j,void 0),j={...j,_logIndentLevel:0}}else j=st(j,void 0),j=ft(j,void 0);const E=r==="player"?"Player":"Opponent",k=v!==r?" into their trash":"";let R;const D=d.map(H=>`${H.protocol}-${H.value}`).join(", ");R=`${E} discards ${D}${k}.`,j=te(j,r,R);const L=(H,A)=>{var K;const N=t.phase==="hand_limit"&&!(A!=null&&A.sourceCardId);let T=H;N&&(T=br(T),T=zm(T,r),T=wt(T,"after_clear_cache",{player:r}).newState,((K=T.processedClearCacheTriggerIds)==null?void 0:K.length)>0&&(T.phase="end")),T=jx(T,r,A==null?void 0:A.sourceEffect,A==null?void 0:A.sourceCardId);const q=T.actionRequired,O=(A==null?void 0:A._savedIndentLevel)||T._logIndentLevel||1;if(q&&(T.actionRequired=null),T=wt(T,"after_discard",{player:r}).newState,T=wt(T,"after_opponent_discard",{player:r==="player"?"opponent":"player"}).newState,q){const ne=q.actor,Z=ne?T[ne].hand.length:0,oe=q.count||1,xe=Math.min(oe,Z);xe<=0||(T.actionRequired?T.queuedActions=[{...q,type:q.type,count:xe,_savedIndentLevel:O},...T.queuedActions||[]]:T.actionRequired={...q,count:xe})}return T};if(y&&y.actor===r){const H=y.count-n.length;if(H>0)return j.actionRequired={...y,count:H},j;if(y.followUpEffect){const A=j._logIndentLevel||2;let T=wt(j,"after_discard",{player:r}).newState;return T=wt(T,"after_opponent_discard",{player:r==="player"?"opponent":"player"}).newState,T.actionRequired?(T._pendingFollowUpEffect={followUpEffect:y.followUpEffect,conditionalType:y.conditionalType,previousHandSize:y.previousHandSize,sourceCardId:y.sourceCardId,actor:r,savedIndentLevel:A},T):Bm(T,y.followUpEffect,y.conditionalType,y.previousHandSize,y.sourceCardId,r,A)}return L(j,y)}const I=t.actionRequired;if(I&&I.type==="discard"&&I.actor===r){const H=I.count-n.length;if(H>0)return j.actionRequired={...I,count:H},j;if(I.followUpEffect){const A=j._logIndentLevel||2;let T=wt(j,"after_discard",{player:r}).newState;return T=wt(T,"after_opponent_discard",{player:r==="player"?"opponent":"player"}).newState,T.actionRequired?(T._pendingFollowUpEffect={followUpEffect:I.followUpEffect,conditionalType:I.conditionalType,previousHandSize:I.previousHandSize,sourceCardId:I.sourceCardId,actor:r,savedIndentLevel:A},T):Bm(T,I.followUpEffect,I.conditionalType,I.previousHandSize,I.sourceCardId,r,A)}return L(j,I)}const F=t.phase==="hand_limit";j=wt(j,"after_discard",{player:r}).newState;let W=wt(j,"after_opponent_discard",{player:r==="player"?"opponent":"player"}).newState;return F&&(W=zm(W,r),W=wt(W,"after_clear_cache",{player:r}).newState,((z=W.processedClearCacheTriggerIds)==null?void 0:z.length)>0&&(W.phase="end")),W},Ac=(t,n)=>{var p,f,h;const r=((p=t.actionRequired)==null?void 0:p.type)==="discard"&&((f=t.actionRequired)==null?void 0:f.variableCount),s=((h=t.actionRequired)==null?void 0:h.type)==="discard"&&t.actionRequired.count>1;if(!r&&!s)return t;const c=t.actionRequired.actor,d=t.actionRequired.sourceCardId;let u=Uc(t,n,c);return u};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Qo=(t,n,r)=>{const s=t.turn,c=s==="player"?"opponent":"player";let d={...t};if(d.compileBlockedPlayer===s&&d.compileBlockedUntilTurn>(d.turnNumber||0))return d=te(d,s,`${s==="player"?"Player":"Opponent"} can't compile - blocked by opponent's effect.`),d;if(d.useControlMechanic&&d.controlCardHolder===s){const N=s==="player"?"Player":"Opponent";return d=st(d,void 0),d=ft(d,void 0),d={...d,_logIndentLevel:0},d=te(d,s,`${N} has Control and may rearrange protocols before compiling.`),d=Ga(d),d.actionRequired={type:"prompt_use_control_mechanic",sourceCardId:"CONTROL_MECHANIC",actor:s,originalAction:{type:"compile",laneIndex:n}},d.controlCardHolder=null,d}let f={...d[s]},h={...d[c]};const y=f.compiled[n],m=[];for(const N of[s,c])d[N].lanes[n].forEach(q=>{if(q.isFaceUp){const O=q;O.customEffects&&O.customEffects.topEffects&&O.customEffects.topEffects.some(Y=>Y.trigger==="before_compile_delete")&&m.push({card:q,owner:N})}});for(const{card:N,owner:T}of m)d=wt(d,"before_compile_delete",{player:T,cardId:N.id}).newState;f={...d[s]},h={...d[c]};const g=N=>{if(N.protocol==="Speed"&&N.value===2&&N.isFaceUp)return!0;const T=N;return T.customEffects&&T.customEffects.topEffects&&N.isFaceUp?T.customEffects.topEffects.some(q=>{var O,M;return q.trigger==="before_compile_delete"&&((O=q.params)==null?void 0:O.action)==="shift"&&((M=q.params)==null?void 0:M.shiftSelf)===!0}):!1},v=[],C=[],b=f.lanes[n].filter(N=>g(N)?(v.push(N),!1):!0),x=h.lanes[n].filter(N=>g(N)?(C.push(N),!1):!0),j=[],E=f.lanes[n],k=h.lanes[n];b.forEach(N=>{const T=E.findIndex(q=>q.id===N.id);T!==-1&&j.push({card:N,owner:s,laneIndex:n,cardIndex:T})}),x.forEach(N=>{const T=k.findIndex(q=>q.id===N.id);T!==-1&&j.push({card:N,owner:c,laneIndex:n,cardIndex:T})}),j.sort((N,T)=>T.cardIndex-N.cardIndex);const R={...f.stats},D={...h.stats};f.discard=[...f.discard,...b.map(({id:N,isFaceUp:T,...q})=>q)],h.discard=[...h.discard,...x.map(({id:N,isFaceUp:T,...q})=>q)];const L=[...f.lanes];L[n]=v,f.lanes=L;const I=[...h.lanes];I[n]=C,h.lanes=I;const F=[...f.compiled];if(F[n]=!0,f.compiled=F,d={...d,[s]:f,[c]:h,stats:{...d.stats,[s]:R,[c]:D}},d.detailedGameStats){const N=y,T=s==="player"?N?"playerRecompile":"playerFirstCompile":N?"aiRecompile":"aiFirstCompile";d={...d,detailedGameStats:{...d.detailedGameStats,compiles:{...d.detailedGameStats.compiles,[T]:d.detailedGameStats.compiles[T]+1}}}}d=st(d,void 0),d=ft(d,void 0),d={...d,_logIndentLevel:0};const U=s==="player"?"Player":"Opponent",B=f.protocols[n];if(d=te(d,s,`${U} compiles Protocol ${B}!`),y&&(d=te(d,s,`${U} draws 1 card from the opponent's deck as a re-compile reward.`),d=tC(d,s,1)),d=qe(d),d={...d,[s]:{...d[s],cannotCompile:!0}},f.compiled.every(N=>N===!0))return d.winner=s,r(s,d),d;b.length+x.length>0&&(d=wt(d,"after_delete",{player:s}).newState),d=wt(d,"after_compile",{player:s}).newState,d=wt(d,"after_opponent_compile",{player:c}).newState;const A=[...v,...C].map(N=>{const T=Ie(d,N.id).owner,q=N.isFaceUp?`${N.protocol}-${N.value}`:"Card";return d=te(d,T,`${q} survives compilation and must be shifted.`),{type:"select_lane_for_shift",cardToShiftId:N.id,cardOwner:T,originalLaneIndex:n,sourceCardId:N.id,actor:T}});if(A.length>0){const N=A.shift();d.actionRequired=N,d.queuedActions=A,N.actor!==s&&(d._interruptedTurn=s,d._interruptedPhase=d.phase,d._interruptedCardPlayedFlag=t._cardPlayedThisActionPhase,d.turn=N.actor)}else d.actionRequired=null,d.queuedActions=[];return j.length>0&&(d._compileAnimations=j),d},iC=(t,n)=>{var C;if(((C=t.actionRequired)==null?void 0:C.type)!=="select_card_from_hand_to_play")return t;const{disallowedLaneIndex:r,sourceCardId:s,isFaceDown:c,actor:d,destinationRule:u,condition:p,faceDown:f,targetLaneIndex:h,validLanes:y,selectableCardIds:m,valueFilter:g,forcedLaneIndex:v}=t.actionRequired;if(m&&!m.includes(n))return t;if(v!==void 0){const b=f!==void 0?f:c,{ignoreProtocolMatching:x}=t.actionRequired;return b===void 0?{...t,actionRequired:{type:"select_lane_for_play",cardInHandId:n,sourceCardId:s,isFaceDown:void 0,actor:d,source:"hand",validLanes:[v],ignoreProtocolMatching:x}}:{...t,actionRequired:{type:"select_lane_for_play",cardInHandId:n,sourceCardId:s,isFaceDown:b,actor:d,source:"hand",preSelectedLane:v}}}return h!==void 0?{...t,actionRequired:{type:"select_lane_for_play",cardInHandId:n,sourceCardId:s,isFaceDown:c||f,actor:d,source:"hand",preSelectedLane:h}}:{...t,actionRequired:{type:"select_lane_for_play",cardInHandId:n,disallowedLaneIndex:r,sourceCardId:s,isFaceDown:c||f,actor:d,destinationRule:u,condition:p,validLanes:y}}},su=t=>{if(!t.actionRequired||!("optional"in t.actionRequired)||!t.actionRequired.optional)return t;const n="actor"in t.actionRequired?t.actionRequired.actor:t.turn,r=n==="player"?"Player":"Opponent";let s={...t,actionRequired:null};return s=te(s,n,`${r} skips the optional action.`),s},Gm=t=>{var d;if(((d=t.actionRequired)==null?void 0:d.type)!=="reveal_opponent_hand")return t;const n=t.actionRequired.actor,r=n==="player"?"opponent":"player";let s={...t};const c={...s[r]};if(c.hand.length>0){c.hand=c.hand.map(f=>({...f,isRevealed:!0})),s[r]=c;const u=Ie(s,t.actionRequired.sourceCardId),p=u?`${u.card.protocol}-${u.card.value}`:"A card effect";s=te(s,n,`${p}: Opponent reveals their hand.`)}return s.actionRequired=null,s},Wm=(t,n)=>xu(t,n),Ym=(t,n)=>Mc(t,n).newState,Ey=(t,n)=>{var m;if(((m=t.actionRequired)==null?void 0:m.type)!=="select_card_from_revealed_deck")return t;const s=t.actionRequired.actor,c=s==="player"?"Player":"Opponent";let d={...t};const u={...d[s]},p=[...u.deck],f=p.findIndex(g=>(g.id||`deck-${p.indexOf(g)}`)===n);if(f===-1)return console.warn(`[resolveSelectRevealedDeckCard] Card ${n} not found in deck`),d.actionRequired=null,d;const h=p.splice(f,1)[0],y={...h,id:h.id||`drawn-${Date.now()}`,isFaceUp:!0};return u.deck=p,u.hand=[...u.hand,y],u.deckRevealed=!1,d[s]=u,d=te(d,s,`${c} draws ${h.protocol}-${h.value} from the revealed deck.`),d.actionRequired=null,d=gt(d),d},jy=t=>{var g;if(((g=t.actionRequired)==null?void 0:g.type)!=="reveal_deck_draw_protocol")return t;const n=t.actionRequired,r=n.actor,s=r==="player"?"Player":"Opponent",c=n.targetProtocol,d=n.shuffleAfter;let u={...t};const p={...u[r]},f=[...p.deck],h=f.filter(v=>v.protocol===c),y=f.filter(v=>v.protocol!==c),m=h.map(v=>({...v,id:pt(),isFaceUp:!0}));if(p.deck=y,p.hand=[...p.hand,...m],p.deckRevealed=!1,u[r]=p,m.length>0){const v=m.map(C=>`${C.protocol}-${C.value}`).join(", ");u=te(u,r,`${s} draws ${m.length} ${c} card${m.length!==1?"s":""} (${v}).`)}else u=te(u,r,`No ${c} cards in deck.`);if(d){const v=[...u[r].deck].sort(()=>Math.random()-.5);u[r]={...u[r],deck:v},u=te(u,r,`${s} shuffles their deck.`)}return u.actionRequired=null,u=gt(u),u},ky=(t,n)=>{var d;if(((d=t.actionRequired)==null?void 0:d.type)!=="state_number")return t;const s=t.actionRequired.actor;let c=Mx(t,s,n);return c=gt(c),c},Ry=(t,n)=>{var d;if(((d=t.actionRequired)==null?void 0:d.type)!=="state_protocol")return t;const s=t.actionRequired.actor;let c=zx(t,s,n);return c=gt(c),c},Ny=(t,n)=>{var m;if(((m=t.actionRequired)==null?void 0:m.type)!=="select_from_drawn_to_reveal")return t;const r=t.actionRequired,s=r.actor,c=s==="player"?"Player":"Opponent",d=r.statedNumber,u=r.thenAction;let p={...t};const h=p[s].hand.find(g=>g.id===n);if(!h)return p.actionRequired=null,p=gt(p),p;const y=d!==void 0?` (stated value: ${d})`:"";return p=te(p,s,`${c} reveals ${h.protocol}-${h.value}${y}.`),p.lastCustomEffectTargetCardId=n,p.actionRequired=null,u==="may_play"&&(p.actionRequired={type:"prompt_optional_effect",actor:s,sourceCardId:r.sourceCardId,effectDef:{params:{action:"play",source:"hand",useCardFromPreviousEffect:!0}},optional:!0}),p},Ty=t=>{var h;if(((h=t.actionRequired)==null?void 0:h.type)!=="confirm_deck_discard")return t;const n=t.actionRequired,{sourceCardId:r,followUpEffect:s,conditionalType:c,laneIndex:d,actor:u,discardedCard:p}=n;let f={...t};if(f.actionRequired=null,s&&r){const y=Ie(f,r);if(y&&y.card.isFaceUp){const m={cardOwner:y.owner,opponent:y.owner==="player"?"opponent":"player"},g=d!==void 0?d:f[y.owner].lanes.findIndex(C=>C.some(b=>b.id===r));if(c==="if_protocol_matches_stated"){const C=p==null?void 0:p.protocol,b=f.lastStatedProtocol;if(!b||!C||C!==b)return f=te(f,y.owner,`Discarded card (${C}) does not match stated protocol "${b||"none"}". Effect skipped.`),f=gt(f),f;f=te(f,y.owner,`Discarded card matches stated protocol "${b}"!`)}if(f=_t(y.card,g,f,m,s).newState,f.actionRequired)return f}}return f=gt(f),f},Dy=(t,n)=>{var j;if(((j=t.actionRequired)==null?void 0:j.type)!=="select_card_from_trash_to_play")return t;const r=t.actionRequired,s=r.actor,c=s==="player"?"Player":"Opponent",{sourceCardId:d,faceDown:u,destinationRule:p,followUpEffect:f,conditionalType:h,sourceLaneIndex:y}=r;let m={...t};const g={...m[s]};if(n<0||n>=g.discard.length)return console.warn(`[resolveSelectTrashCardToPlay] Invalid index ${n}`),m.actionRequired=null,m;const v=[...g.discard],C=v.splice(n,1)[0];g.discard=v,m[s]=g;const b={...C,id:`trash-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,isFaceUp:u!==!0};m=te(m,s,`${c} selects ${C.protocol}-${C.value} from trash.`);const x=u===void 0;if((p==null?void 0:p.type)==="other_lines"){const E=[0,1,2].filter(k=>k!==y);m.actionRequired={type:"select_lane_for_play",sourceCardId:d,actor:s,isFaceDown:u,source:"trash",preDrawnCard:b,disallowedLaneIndex:y,validLanes:E,useNormalPlayRules:x,followUpEffect:f,conditionalType:h}}else m.actionRequired={type:"select_lane_for_play",sourceCardId:d,actor:s,isFaceDown:u,source:"trash",preDrawnCard:b,useNormalPlayRules:x,followUpEffect:f,conditionalType:h};return m},Ay=(t,n)=>{var C,b;if(((C=t.actionRequired)==null?void 0:C.type)!=="select_card_from_trash_to_reveal")return t;const r=t.actionRequired,s=r.actor,c=s==="player"?"Player":"Opponent",{sourceCardId:d,followUpEffect:u,conditionalType:p,sourceLaneIndex:f}=r;let h={...t};const y={...h[s]};if(n<0||n>=y.discard.length)return console.warn(`[resolveSelectTrashCardToReveal] Invalid index ${n}`),h.actionRequired=null,h;const m=[...y.discard],g=m.splice(n,1)[0];y.discard=m,h[s]=y,h=te(h,s,`${c} reveals ${g.protocol}-${g.value} from trash.`);const v={...g,id:`trash-revealed-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,isFaceUp:!1};if(u){const x=Ie(h,d);if(x&&x.card.isFaceUp){const j=(b=u.params)==null?void 0:b.destinationRule,E=(j==null?void 0:j.type)==="other_lines"?[0,1,2].filter(k=>k!==f):[0,1,2];h.actionRequired={type:"select_lane_for_play",sourceCardId:d,actor:s,isFaceDown:!0,source:"trash",preDrawnCard:v,disallowedLaneIndex:(j==null?void 0:j.type)==="other_lines"?f:void 0,validLanes:(j==null?void 0:j.type)==="other_lines"?E:void 0}}else h=te(h,s,"Source card no longer active. Play effect skipped."),h.actionRequired=null,h=gt(h)}else h.actionRequired=null,h=gt(h);return h},Fy=t=>{var m;if(((m=t.actionRequired)==null?void 0:m.type)!=="confirm_deck_play_preview")return t;const n=t.actionRequired,{sourceCardId:r,actor:s,drawnCard:c,isFaceDown:d,excludeCurrentLane:u,currentLaneIndex:p,followUpEffect:f,conditionalType:h}=n;let y={...t};return y.actionRequired={type:"select_lane_for_play",sourceCardId:r,actor:s,count:1,isFaceDown:d,excludeCurrentLane:u,currentLaneIndex:p,source:"deck",preDrawnCard:c,followUpEffect:f,conditionalType:h},y};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const cu=(t,n)=>{var m,g;if(((m=t.actionRequired)==null?void 0:m.type)!=="prompt_optional_draw")return t;const{sourceCardId:r,actor:s,count:c,drawingPlayer:d,logSource:u,logPhase:p,logIndentLevel:f}=t.actionRequired,h=s.charAt(0).toUpperCase()+s.slice(1);let y={...t};if(u!==void 0&&(y=st(y,u)),p!==void 0&&(y=ft(y,p)),f!==void 0&&(y._logIndentLevel=f),n){y=te(y,s,`${h} chooses to execute the optional draw effect.`),y=bl(y,d||s,c),y=te(y,s,`${h} draws ${c} card${c!==1?"s":""}.`);const v=t.actionRequired.followUpEffect;if(t.actionRequired.conditionalType,v){const C=Ie(y,r);if(C){const b=y[C.owner].lanes.findIndex(k=>k.some(R=>R.id===r)),x=s==="player"?"opponent":"player",j={cardOwner:s,actor:s,currentTurn:y.turn,opponent:x,triggerType:"start"};y=_t(C.card,b,y,j,v).newState,y=gt(y)}else{const b=t.actionRequired.logSource||"deleted card";y=te(y,s,`${b}: Follow-up effect skipped (source no longer active).`),y.actionRequired=null,((g=y._pendingCustomEffects)==null?void 0:g.sourceCardId)===r&&delete y._pendingCustomEffects,y.queuedActions&&y.queuedActions.length>0&&(y.queuedActions=y.queuedActions.filter(x=>x.sourceCardId!==r))}}else y.actionRequired=null}else y=te(y,s,`${h} skips the draw.`),y.actionRequired=null;return y},iu=(t,n)=>{var h,y,m;if(((h=t.actionRequired)==null?void 0:h.type)!=="prompt_optional_discard_custom")return t;const{actor:r,count:s,sourceCardId:c}=t.actionRequired,d=r.charAt(0).toUpperCase()+r.slice(1);let u={...t};const p=(y=t.actionRequired)==null?void 0:y.followUpEffect,f=(m=t.actionRequired)==null?void 0:m.conditionalType;return n?(u=te(u,r,`${d} chooses to discard ${s} card(s).`),u.actionRequired={type:"discard",actor:r,count:s,sourceCardId:c,followUpEffect:p,conditionalType:f,previousHandSize:u[r].hand.length}):(u=te(u,r,`${d} skips the discard.`),u.actionRequired=null),u},du=(t,n)=>{var h,y,m,g,v,C,b;if(((h=t.actionRequired)==null?void 0:h.type)!=="prompt_optional_effect")return t;const{actor:r,sourceCardId:s,effectDef:c,laneIndex:d,savedTargetCardId:u}=t.actionRequired,p=r.charAt(0).toUpperCase()+r.slice(1);let f={...t};if(u&&(f.lastCustomEffectTargetCardId=u),n){const x=c.params.action;f=te(f,r,`${p} chooses to execute the optional ${x} effect.`),f.actionRequired=null;const j=[...f.player.lanes.flat(),...f.opponent.lanes.flat()].find(G=>G.id===s);if(!j)return console.error("[Optional Effect] Source card not found!"),f;const E={cardOwner:r,opponent:r==="player"?"opponent":"player",currentTurn:f.turn,actor:r},k={...c,params:{...c.params,optional:!1},conditional:void 0},R=_t(j,d,f,E,k),D=!!R.newState.actionRequired,L=!!R.newState._effectSkippedNoTargets;if(L&&!D){const G={...R.newState};return delete G._effectSkippedNoTargets,G.actionRequired=null,G}if(L&&D&&delete R.newState._effectSkippedNoTargets,c.conditional&&c.conditional.type==="if_executed"&&c.conditional.thenEffect){if(R.newState.actionRequired){const z=R.newState.actionRequired.sourceCardId;if(z&&z!==s){const A={type:"execute_conditional_followup",sourceCardId:s,laneIndex:d,followUpEffect:c.conditional.thenEffect,context:E,actor:r,logSource:t.actionRequired.logSource,logPhase:t.actionRequired.logPhase,logIndentLevel:t.actionRequired.logIndentLevel};return{...R.newState,queuedActions:[...R.newState.queuedActions||[],A]}}return{...R.newState,actionRequired:{...R.newState.actionRequired,followUpEffect:c.conditional.thenEffect,conditionalType:"if_executed"}}}const G=[...R.newState.player.lanes.flat(),...R.newState.opponent.lanes.flat()].find(z=>z.id===s);if(!G){let z={...R.newState};const H=t.actionRequired.logSource,A=t.actionRequired.logPhase,N=t.actionRequired.logIndentLevel;return H!==void 0&&(z._currentEffectSource=H),A!==void 0&&(z._currentPhaseContext=A),N!==void 0&&(z._logIndentLevel=N),z=te(z,r,"Follow-up effect skipped (source no longer active)."),z}const W=c.conditional.thenEffect,P=_t(G,d,R.newState,E,W);return P.newState.actionRequired&&W.conditional&&W.conditional.thenEffect?{...P.newState,actionRequired:{...P.newState.actionRequired,followUpEffect:W.conditional.thenEffect,conditionalType:W.conditional.type}}:P.newState}const F=(y=t.actionRequired)==null?void 0:y.followUpEffect,U=(m=t.actionRequired)==null?void 0:m.outerSourceCardId,B=(g=t.actionRequired)==null?void 0:g.outerLaneIndex;if(F&&U){let G=R.newState;if(G.actionRequired)return{...G,actionRequired:{...G.actionRequired,followUpEffect:F,outerSourceCardId:U,outerLaneIndex:B}};const W=[...G.player.lanes.flat(),...G.opponent.lanes.flat()].find(P=>P.id===U);if(W){const P=G.player.lanes.flat().some(N=>N.id===U)?"player":"opponent",z={cardOwner:P,opponent:P==="player"?"opponent":"player",currentTurn:G.turn,actor:P};let A=_t(W,B||0,G,z,F).newState;return A._interruptedTurn&&!A.actionRequired&&(A={...A,turn:A._interruptedTurn,_interruptedTurn:void 0,_interruptedPhase:void 0}),A}}return R.newState}else{const x=c.params.action;f=te(f,r,`${p} skips the optional ${x} effect.`),f.actionRequired=null;const j=(v=t.actionRequired)==null?void 0:v.followUpEffect,E=(C=t.actionRequired)==null?void 0:C.outerSourceCardId,k=(b=t.actionRequired)==null?void 0:b.outerLaneIndex;if(j&&E){const R=[...f.player.lanes.flat(),...f.opponent.lanes.flat()].find(D=>D.id===E);if(R){let D=k;if(D===void 0){for(const B of["player","opponent"])for(let G=0;G<f[B].lanes.length;G++)if(f[B].lanes[G].some(W=>W.id===E)){D=G;break}}const L=f.player.lanes.flat().some(B=>B.id===E)?"player":"opponent",I={cardOwner:L,opponent:L==="player"?"opponent":"player",currentTurn:f.turn,actor:L};let U=_t(R,D||0,f,I,j).newState;return U._interruptedTurn&&!U.actionRequired&&(U={...U,turn:U._interruptedTurn,_interruptedTurn:void 0,_interruptedPhase:void 0}),U}}return f}},uu=(t,n,r)=>{var k;if(((k=t.actionRequired)==null?void 0:k.type)!=="prompt_rearrange_protocols")return t;const s=Yw(t);if(!s.allowed)return console.error(`Protocol rearrangement blocked: ${s.reason}`),t;const{target:c,actor:d,originalAction:u,sourceCardId:p,disallowedProtocolForLane:f}=t.actionRequired;if(f){const{laneIndex:R,protocol:D}=f;if(n[R]===D)return console.error(`Illegal rearrange: ${D} cannot be placed on lane ${R} due to Anarchy-3 restriction`),t}let h={...t};const y={...h[c]},m={};y.protocols.forEach((R,D)=>{m[R]=y.compiled[D]});const g=n.map(R=>m[R]);y.protocols=n,y.compiled=g,h[c]=y,h.actionRequired=null;const v=h._pendingCustomEffects;if(v&&v.effects.length>0){const R={type:"execute_remaining_custom_effects",sourceCardId:v.sourceCardId,laneIndex:v.laneIndex,effects:v.effects,context:v.context,actor:d,logSource:v.logSource,logPhase:v.logPhase,logIndentLevel:v.logIndentLevel};h.queuedActions=[R,...h.queuedActions||[]],delete h._pendingCustomEffects}let C="Control Action";if(p!=="CONTROL_MECHANIC"){const R=[...h.player.lanes.flat(),...h.opponent.lanes.flat()].find(D=>D.id===p);R&&(C=`${R.protocol}-${R.value}`)}const b=d.charAt(0).toUpperCase()+d.slice(1),x=c===d?"their own":"the opponent's",j=n.join(" | ");h=te(h,d,`${C}: ${b} rearranges ${x} protocols.`),h=te(h,d,`New protocol order for ${c}: ${j}`);let E=qe(h);if(u){if(E={...E,_logIndentLevel:0},u.type==="compile")return Qo(E,u.laneIndex,r);if(u.type==="fill_hand")return fl(E,d);u.type==="continue_turn"?u.queuedSpeed2Actions&&u.queuedSpeed2Actions.length>0?(E=te(E,d,"Processing remaining Speed-2 effects..."),E.queuedActions=[...u.queuedSpeed2Actions,...E.queuedActions||[]]):(E=te(E,d,"Turn ends after compile."),E.phase="hand_limit"):u.type==="resume_interrupted_turn"&&(E=te(E,d,"Resuming interrupted turn..."),E._interruptedTurn=u.interruptedTurn,E._interruptedPhase=u.interruptedPhase,u.queuedSpeed2Actions&&u.queuedSpeed2Actions.length>0&&(E.queuedActions=[...u.queuedSpeed2Actions,...E.queuedActions||[]]))}return E},pu=(t,n,r)=>{var E;if(((E=t.actionRequired)==null?void 0:E.type)!=="prompt_swap_protocols")return t;const{actor:s,target:c,originalAction:d,sourceCardId:u}=t.actionRequired,p={...t[c]},[f,h]=n.sort((k,R)=>k-R),y=[...p.protocols],m=[...p.compiled];[y[f],y[h]]=[y[h],y[f]],[m[f],m[h]]=[m[h],m[f]],p.protocols=y,p.compiled=m;let g={...t,[c]:p,actionRequired:null};const v=g._pendingCustomEffects;if(v&&v.effects.length>0){const k={type:"execute_remaining_custom_effects",sourceCardId:v.sourceCardId,laneIndex:v.laneIndex,effects:v.effects,context:v.context,actor:s,logSource:v.logSource,logPhase:v.logPhase,logIndentLevel:v.logIndentLevel};g.queuedActions=[k,...g.queuedActions||[]],delete g._pendingCustomEffects}const C=s.charAt(0).toUpperCase()+s.slice(1),b=c.charAt(0).toUpperCase()+c.slice(1);g=te(g,s,`${u==="CONTROL_MECHANIC"?"Control":"Spirit-4"}: ${C} swaps ${b}'s protocols ${y[h]} and ${y[f]}.`),u==="CONTROL_MECHANIC"&&(g.controlCardHolder=null);let j=qe(g);if(d){if(d.type==="compile")return j=te(j,s,"Resuming Compile action..."),Qo(j,d.laneIndex,r);if(d.type==="fill_hand")return j=te(j,s,"Resuming Refresh action..."),fl(j,s)}return j},Eu=(t,n)=>{var g;if(((g=t.actionRequired)==null?void 0:g.type)!=="prompt_shift_or_flip_board_card_custom")return t;const{actor:r,sourceCardId:s,revealedCardId:c,followUpAction:d,optional:u}=t.actionRequired,p=r.charAt(0).toUpperCase()+r.slice(1),f=Ie(t,c);if(!f)return t;if(d&&n!=="skip"&&n!==d)return console.error(`Invalid choice: ${n}, followUpAction restricts to: ${d}`),t;const h=f.owner,y=t[h].lanes.findIndex(v=>v.some(C=>C.id===c));if(y===-1)return t;let m={...t};switch(n){case"shift":{const v=[...m[h].lanes[y]],C=v.findIndex(b=>b.id===c);if(C!==-1){v[C]={...v[C],isFaceUp:!1};const b=[...m[h].lanes];b[y]=v,m={...m,[h]:{...m[h],lanes:b}}}m=te(m,r,`${p} chooses to shift the revealed card (face-down).`),m.actionRequired={type:"select_lane_to_shift_revealed_board_card_custom",sourceCardId:s,revealedCardId:c,actor:r};break}case"flip":{m=te(m,r,`${p} chooses to flip the revealed card face-up permanently.`);const v={...m,actionRequired:null};m=Cu(v,c).newState;break}case"skip":{const v=[...m[h].lanes[y]],C=v.findIndex(b=>b.id===c);if(C!==-1){v[C]={...v[C],isFaceUp:!1};const b=[...m[h].lanes];b[y]=v,m={...m,[h]:{...m[h],lanes:b}}}m=te(m,r,`${p} chooses to do nothing with the revealed card.`),m.actionRequired=null;break}}return m};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const fu=(t,n)=>{if(!t.actionRequired)return t;const{actionRequired:r}=t,s=r.actor,c=s==="player"?"opponent":"player";switch(r.type){case"select_card_from_hand_to_give":{const d=t[s].hand.find(v=>v.id===n);if(!d)return t;let u={...t};const p={...u[s]},f={...u[c]};p.hand=p.hand.filter(v=>v.id!==n),f.hand=[...f.hand,d],u={...u,[s]:p,[c]:f};const h=s==="player"?"Player":"Opponent",y=`${d.protocol}-${d.value}`;u=te(u,s,`${h} gives ${y} to the opponent.`),r.sourceEffect==="love_1_end"&&(u=te(u,s,`Love-1: ${h} draws 2 cards.`),u=bl(u,s,2));const m=r.followUpEffect,g=r.conditionalType;if(m&&g==="if_executed"){const v=Ie(u,r.sourceCardId);if(v){const{card:C,laneIndex:b}=v,x={cardOwner:s,actor:s,currentTurn:u.turn,opponent:c,triggerType:"play"};u=_t(C,b,u,x,m).newState}}return u.actionRequired=null,u}case"select_card_from_hand_to_reveal":{const d=t[s].hand.find(g=>g.id===n);if(!d)return t;let u={...t};const p={...u[s]},f=p.hand.map(g=>g.id===n?{...g,isRevealed:!0}:g);p.hand=f,u={...u,[s]:p};const h=s==="player"?"Player":"Opponent",y=`${d.protocol}-${d.value}`;u=te(u,s,`${h} reveals ${y} from their hand.`);const m=u._pendingCustomEffects;if(m&&m.effects.length>0){const g=Ie(u,m.sourceCardId);if(g){const{card:v}=g,C=m.effects[0],b=m.effects.slice(1),x={cardOwner:s,actor:s,currentTurn:u.turn,opponent:c,triggerType:"play"};return u=_t(v,m.laneIndex,u,x,C).newState,b.length>0?u._pendingCustomEffects={...m,effects:b}:delete u._pendingCustomEffects,u}}return u.actionRequired={type:"select_any_card_to_flip",count:1,sourceCardId:r.sourceCardId,actor:s},u}default:return t}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const hu=(t,n)=>{var v;if(((v=t.actionRequired)==null?void 0:v.type)!=="custom_choice")return t;const{options:r,sourceCardId:s,actor:c,laneIndex:d}=t.actionRequired;if(n<0||n>=r.length)return console.error(`[Choice Resolver] Invalid option index: ${n}`),t;const u=r[n],p=Ie(t,s);if(!p){console.error(`[Choice Resolver] Source card ${s} not found`);let C={...t};return C.actionRequired=null,C}const f=c==="player"?"opponent":"player",h={cardOwner:c,actor:c,currentTurn:t.turn,opponent:f};let y={...t,actionRequired:null};const m=_t(p.card,d,y,h,u);return qe(m.newState)};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Control Mechanic Logic for AI
 *
 * CRITICAL: When evaluating rearrangements during a compile action,
 * the lane being compiled will have its value RESET TO 0 after the compile.
 * This must be considered when determining beneficial swaps!
 */function Hc(t,n){const r=[...t];return n!==null&&n>=0&&n<3&&(r[n]=0),r}function Iy(t,n=null){const r=t.player,s=[],c=[];for(let u=0;u<3;u++)r.compiled[u]?s.push(u):c.push(u);if(s.length===0||c.length===0)return!1;const d=Hc(r.laneValues,n);for(const u of s)for(const p of c)if(d[p]-d[u]>0)return!0;return!1}function Vc(t,n=null){const r=t.opponent,s=[],c=[];for(let u=0;u<3;u++)r.compiled[u]?s.push(u):c.push(u);if(s.length===0||c.length===0)return!1;if(s.length===2&&c.length===1&&n!==null&&r.compiled[n])return!0;const d=Hc(r.laneValues,n);for(const u of s)for(const p of c){const h=10-d[u];if(h>=0&&h<=3){const m=10-d[p];if(h<m)return!0}}return!1}function $y(t,n){if(!n||n.type!=="prompt_rearrange_protocols")return{type:"rearrangeProtocols",newOrder:[...t.opponent.protocols]};const r=n.target,s=n.disallowedProtocolForLane;let c=null;n.originalAction&&n.originalAction.type==="compile"&&(c=n.originalAction.laneIndex);const d=v=>{if(!s)return!0;const{laneIndex:C,protocol:b}=s;return v[C]!==b},u=t.opponent,p=t.player,f=Hc(u.laneValues,c),h=Hc(p.laneValues,c),y=u.compiled.filter(v=>v).length;if(p.compiled.filter(v=>v).length===2&&y===2){const v=p.compiled.findIndex(j=>!j),C=u.compiled.findIndex(j=>!j),b=h[v],x=f[C];if(b>x&&r==="player"){let j=-1,E=1/0;for(let k=0;k<3;k++)p.compiled[k]&&h[k]<E&&(E=h[k],j=k);if(j!==-1&&E<=b){const k=[...p.protocols];if([k[v],k[j]]=[k[j],k[v]],d(k))return{type:"rearrangeProtocols",newOrder:k}}return wr(p.protocols,d)}if(b<=x&&r==="opponent"){let j=-1,E=-1;for(let k=0;k<3;k++)u.compiled[k]&&f[k]>E&&(E=f[k],j=k);if(j!==-1&&E>x&&E>0){const k=[...u.protocols];if([k[C],k[j]]=[k[j],k[C]],d(k))return{type:"rearrangeProtocols",newOrder:k}}return wr(u.protocols,d)}}if(r==="player"){const v=[],C=[];for(let E=0;E<3;E++)p.compiled[E]?v.push(E):C.push(E);if(v.length===0||C.length===0){if(n.sourceCardId!=="CONTROL_MECHANIC")for(let k=0;k<3;k++)for(let R=k+1;R<3;R++){const D=[...p.protocols];if([D[k],D[R]]=[D[R],D[k]],d(D))return{type:"rearrangeProtocols",newOrder:D}}return wr(p.protocols,d)}let b=null;for(const E of C)if(h[E]>=10&&h[E]>f[E]){for(const R of v){b={compiledIdx:R,uncompiledIdx:E};break}if(b)break}if(b){const E=[...p.protocols];if([E[b.compiledIdx],E[b.uncompiledIdx]]=[E[b.uncompiledIdx],E[b.compiledIdx]],d(E))return{type:"rearrangeProtocols",newOrder:E}}let x=null;for(const E of v)for(const k of C){const R=h[k]-h[E];(!x||R>x.score)&&(x={compiledIdx:E,uncompiledIdx:k,score:R})}const j=n.sourceCardId!=="CONTROL_MECHANIC";if(x&&x.score>0){const E=[...p.protocols];if([E[x.compiledIdx],E[x.uncompiledIdx]]=[E[x.uncompiledIdx],E[x.compiledIdx]],d(E))return{type:"rearrangeProtocols",newOrder:E}}if(j)for(let E=0;E<3;E++)for(let k=E+1;k<3;k++){const R=[...p.protocols];if([R[E],R[k]]=[R[k],R[E]],d(R))return{type:"rearrangeProtocols",newOrder:R}}return wr(p.protocols,d)}if(r==="opponent"){const v=[],C=[];for(let j=0;j<3;j++)u.compiled[j]?v.push(j):C.push(j);if(v.length===0||C.length===0){if(n.sourceCardId!=="CONTROL_MECHANIC")for(let E=0;E<3;E++)for(let k=E+1;k<3;k++){const R=[...u.protocols];if([R[E],R[k]]=[R[k],R[E]],d(R))return{type:"rearrangeProtocols",newOrder:R}}return wr(u.protocols,d)}if(v.length===2&&C.length===1&&c!==null){const j=C[0];if(u.compiled[c]){const E=[...u.protocols];if([E[c],E[j]]=[E[j],E[c]],d(E))return{type:"rearrangeProtocols",newOrder:E}}}let b=null;for(const j of v)for(const E of C){const k=f[j],R=f[E],D=k-R,I=k>=10&&k>h[j]?D+100:D;(!b||I>b.score)&&(b={compiledIdx:j,uncompiledIdx:E,score:I,newUncompiledValue:k})}const x=n.sourceCardId!=="CONTROL_MECHANIC";if(b&&b.score>0){const j=[...u.protocols];if([j[b.compiledIdx],j[b.uncompiledIdx]]=[j[b.uncompiledIdx],j[b.compiledIdx]],d(j))return{type:"rearrangeProtocols",newOrder:j}}if(x)for(let j=0;j<3;j++)for(let E=j+1;E<3;E++){const k=[...u.protocols];if([k[j],k[E]]=[k[E],k[j]],d(k))return{type:"rearrangeProtocols",newOrder:k}}return wr(u.protocols,d)}const g=r==="player"?[...p.protocols]:[...u.protocols];return wr(g,d)}function wr(t,n){if(n(t))return{type:"rearrangeProtocols",newOrder:[...t]};for(let r=0;r<3;r++)for(let s=r+1;s<3;s++){const c=[...t];if([c[r],c[s]]=[c[s],c[r]],n(c))return{type:"rearrangeProtocols",newOrder:c}}return console.error("[AI Rearrange] Could not find any valid arrangement - returning current order"),{type:"rearrangeProtocols",newOrder:[...t]}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function Py(t,n){return Pn(t).some(({rule:s,cardOwner:c})=>s.type!=="require_face_down_play"?!1:s.target==="all"||s.target==="opponent"&&c!==n)}function Ou(t){const n=t;return n.customEffects?[...n.customEffects.topEffects||[],...n.customEffects.middleEffects||[],...n.customEffects.bottomEffects||[]].some(s=>{var u,p;const c=s.trigger;return(c==="on_cover"||c==="on_cover_or_flip")&&((u=s.params)==null?void 0:u.action)==="delete"&&((p=s.params)==null?void 0:p.deleteSelf)===!0}):!1}function qy(t,n,r){const s=t[n].lanes[r];if(s.length===0)return null;const c=s[s.length-1];return c.isFaceUp&&Ou(c)?c.value:null}function Ly(t){const n=t;return n.customEffects?[...n.customEffects.topEffects||[],...n.customEffects.middleEffects||[],...n.customEffects.bottomEffects||[]].some(s=>{var c;return s.params.action==="return"&&((c=s.params.targetFilter)==null?void 0:c.owner)==="own"}):!1}function Uy(t){const n=t;return n.customEffects?[...n.customEffects.topEffects||[],...n.customEffects.middleEffects||[],...n.customEffects.bottomEffects||[]].some(s=>{var c,d,u;return s.params.action==="delete"&&((c=s.params.targetFilter)==null?void 0:c.owner)==="own"&&(((d=s.params.targetFilter)==null?void 0:d.valueFilter)==="highest"||((u=s.params.targetFilter)==null?void 0:u.calculation)==="highest_value")}):!1}function dC(t){const n=t;if(!n.customEffects)return 0;const r=n.customEffects.topEffects||[];for(const s of r)if(s.trigger==="passive"&&s.params.action==="value_modifier"&&(s.params.condition==="per_face_down_card"||s.params.applyTo==="face_down_cards"))return s.params.modifier||0;return 0}function Oy(t,n){let r=0;for(const s of["player","opponent"])for(const c of t[s].lanes[n])if(c.isFaceUp){const d=dC(c);d>0&&(r=Math.max(r,d))}return r}function uC(t){const n=t;return n.customEffects?[...n.customEffects.topEffects||[],...n.customEffects.middleEffects||[],...n.customEffects.bottomEffects||[]].some(s=>{var d,u,p;if(((d=s.params)==null?void 0:d.action)!=="flip")return!1;const c=(u=s.params)==null?void 0:u.targetFilter;return(c==null?void 0:c.owner)==="own"&&((c==null?void 0:c.scope)==="this_lane"||((p=s.params)==null?void 0:p.scope)==="this_lane"||(c==null?void 0:c.position)==="in_this_stack")}):!1}function pC(t){const n=t;return n.customEffects?[...n.customEffects.topEffects||[],...n.customEffects.middleEffects||[],...n.customEffects.bottomEffects||[]].some(s=>{var d,u,p;if(((d=s.params)==null?void 0:d.action)!=="delete")return!1;const c=(u=s.params)==null?void 0:u.targetFilter;return(c==null?void 0:c.owner)==="own"&&((c==null?void 0:c.scope)==="this_lane"||((p=s.params)==null?void 0:p.scope)==="this_lane"||(c==null?void 0:c.position)==="in_this_stack")}):!1}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * EASY AI - Old Normal AI logic (before strategic modules)
 * - Makes good strategic decisions
 * - No memory of revealed cards
 * - 5% chance to make suboptimal moves for slight unpredictability
 * - Challenging but beatable
 */const wl=["delete","flip","shift","return","discard"],Fn=t=>{let n=12-t.value;return wl.some(r=>t.keywords[r])&&(n+=6),t.keywords.draw&&(n+=3),t.keywords.play&&(n+=8),t.keywords.prevent&&(n+=4),n},ol=(t,n,r)=>{let s;for(const d of r[n].lanes)if(d.some(u=>u.id===t.id)){s=d;break}if(!s)return 0;if(!t.isFaceUp)return s.some(u=>u.isFaceUp&&u.protocol==="Darkness"&&u.value===2)?4:2;let c=t.value*2.5;return t.top.length>0&&(c+=6),(t.bottom.includes("Start:")||t.bottom.includes("End:"))&&(c+=8),t.bottom.includes("covered:")&&(c+=5),wl.some(d=>t.keywords[d])&&(c+=4),c},sl=()=>Math.random()<.05,Qm=t=>t+(Math.random()*4-2),rl=(t,n,r,s)=>{const c=r.position||"uncovered";return!(c==="uncovered"&&!n||c==="covered"&&n||r.faceState==="face_up"&&!t.isFaceUp||r.faceState==="face_down"&&t.isFaceUp||r.excludeSelf&&s&&t.id===s||r.valueRange&&(!t.isFaceUp||t.value<r.valueRange.min||t.value>r.valueRange.max)||r.valueEquals!==void 0&&(!t.isFaceUp||t.value!==r.valueEquals))},fC=t=>{var k,R,D,L;const n=[],r=Py(t,"opponent"),s=t.player.lanes.flat().length+t.opponent.lanes.flat().length,c=s<=3,d=s>3&&s<=8,p=t.player.lanes.flat().length>0,f=t.player.compiled.filter(Boolean).length,h=t.controlCardHolder==="opponent";t.controlCardHolder;let y=0;for(let I=0;I<3;I++)t.opponent.laneValues[I]>t.player.laneValues[I]?y++:t.player.laneValues[I]>t.opponent.laneValues[I];const g=t.useControlMechanic===!0&&f>=1&&!h;for(let I=0;I<3&&!(!t.player.compiled[I]&&t.player.laneValues[I]>=10&&t.player.laneValues[I]>t.opponent.laneValues[I]);I++);const v=t.opponent.compiled.filter(Boolean).length;let C=-1;if(v<3&&!g){const I=[];for(let F=0;F<3;F++){if(t.opponent.compiled[F])continue;const U=t.opponent.protocols[F],B=t.player.protocols[F],G=t.opponent.laneValues[F],W=t.player.laneValues[F],P=t.opponent.hand.filter(N=>N.protocol===U||N.protocol===B);if(W>=10&&!t.player.compiled[F]){const N=Math.max(...P.map(M=>M.value),0),q=Math.max(N,2);if(G+q<=W)continue}let z=0,H=`Lane ${F} (${U}): value=${G}`;z+=G*15,G>=8?(z+=100,H+=` [ALMOST COMPILE: ${G}]`):G>=6?(z+=60,H+=` [Near compile: ${G}]`):G>=4&&(z+=30,H+=` [Building: ${G}]`),z+=P.length*10,P.length>0&&(H+=` [${P.length} cards]`);const A=P.filter(N=>N.value>=4);z+=A.length*20,W>G&&(z-=(W-G)*5),P.length===0&&(z-=30,H+=" [No matching cards - face-down only]"),I.push({laneIndex:F,score:z,reason:H})}I.sort((F,U)=>U.score-F.score),I.length>0&&(C=I[0].laneIndex)}const b=(I,F)=>I.keywords.flip||I.keywords.delete||I.keywords.shift||I.keywords.return?t.player.lanes.flat().length>0||t.opponent.lanes.some((G,W)=>W!==F&&G.length>0)||t.opponent.lanes[F].length>0:!0,x=I=>I.keywords.draw?t.opponent.hand.length>=5:!1;for(const I of t.opponent.hand)for(let F=0;F<3;F++){const U=Cr(t,"opponent",F,!0,I.protocol),B=Cr(t,"opponent",F,!1,I.protocol);if(!U.allowed&&!B.allowed||t.opponent.compiled[F])continue;const G=t.player.laneValues[F]>=10&&t.player.laneValues[F]>t.opponent.laneValues[F]&&!t.player.compiled[F];if(G){const N=Math.max(U.allowed?I.value:0,B.allowed?wn({...I,isFaceUp:!1},t.opponent.lanes[F]):0);if(t.opponent.laneValues[F]+N<t.player.laneValues[F]&&!wl.some(q=>I.keywords[q]))continue}let W=!1;if(Ly(I)){let N=0;for(let T=0;T<3;T++)if(t.opponent.lanes[T].length>0){if(T===F)continue;N++}N===0&&(W=!0)}if(Ou(I)){const N=t.opponent.laneValues[F],T=Math.max(0,10-I.value);if(N<T)continue;const q=N+I.value,O=t.player.laneValues[F];if(q<=O)continue}const P=qy(t,"opponent",F);if(P!==null){const N=t.opponent.laneValues[F],T=N+I.value-P,q=T>=10&&T>t.player.laneValues[F],O=N-P>=4;if(!q&&!O)continue}const z=G;let H=!1;if(Uy(I)){let N=0;for(let T=0;T<3;T++){const q=t.opponent.lanes[T];if(q.length>0&&T!==F){const O=q[q.length-1],M=O.isFaceUp?O.value:2;M>N&&(N=M)}}I.value>=N&&(H=!0)}if(U.allowed&&!r&&!H&&!W){let N=0,T=`Play ${I.protocol}-${I.value} face-up in lane ${F}`;const q=I.value,O=t.opponent.laneValues[F]+q;if(z)O>t.player.laneValues[F]?(N=180+O*5,T+=" [Blocks compile!]"):O===t.player.laneValues[F]?(N=160+O*3,T+=" [Blocks compile with tie!]"):(N=-500,T+=" [WASTE: Card goes to trash when player compiles!]");else{if(N+=q*10,O>=10&&O>t.player.laneValues[F]&&!t.opponent.compiled[F])N+=200,T+=` [COMPILE: ${O}]`;else if(O>=8&&O<10&&!t.opponent.compiled[F]){const Y=t.opponent.lanes[F].some(K=>K.isFaceUp&&K.protocol==="Darkness"&&K.value===2)?4:2;t.opponent.laneValues[F]+Y>=10&&O<10?(N-=50,T+=` [Near ${O} but face-down could compile!]`):(N+=40,T+=` [Near compile: ${O}]`)}c&&q<=2&&(N-=50,T+=" [Low value early game penalty]"),b(I,F)||(N-=80,T+=" [No valid targets for effect]"),x(I)&&(N-=30,T+=" [Draw would cause discard]");const M=wl.some(Y=>I.keywords[Y]);if(M&&p?d&&t.player.laneValues[F]>=5?(N+=35,T+=" [Disruption with targets]"):t.player.laneValues[F]>=8&&(N+=50,T+=" [Disruption near compile]"):M&&!p&&(N-=40,T+=" [Disruption but no targets]"),C!==-1&&!g&&(F===C?(N+=150,T+=" [FOCUS LANE]"):(N-=100,T+=" [Not focus lane]")),g){const Y=t.opponent.laneValues[F]>t.player.laneValues[F],X=O>t.player.laneValues[F],K=t.opponent.laneValues[F]===t.player.laneValues[F];if(Y)N-=200,T+=" [ALREADY LEADING - DON'T WASTE!]";else if(!Y&&X)y===1?(N+=500,T+=" [CONTROL CAPTURE! 1->2 leads]"):y===0?(N+=300,T+=" [First lead! 0->1 leads]"):(N+=100,T+=" [Extra lead]");else if(K&&X)y===1?(N+=450,T+=" [BREAK TIE FOR CONTROL!]"):(N+=250,T+=" [Break tie]");else if(!Y&&!X&&y===1){const ne=t.player.laneValues[F]-O;ne<=3?(N+=200,T+=` [BUILD toward 2nd lead, gap=${ne}]`):ne<=6?(N+=150,T+=` [BUILD toward 2nd lead, gap=${ne}]`):(N+=100,T+=` [BUILD toward 2nd lead, gap=${ne}]`)}}}n.push({move:{type:"playCard",cardId:I.id,laneIndex:F,isFaceUp:!0},score:Qm(N),reason:T})}if(B.allowed){const N=wn({...I,isFaceUp:!1},t.opponent.lanes[F]),T=t.opponent.laneValues[F]+N,q=t.opponent.laneValues[F];let O=-100,M=`Play ${I.protocol}-${I.value} face-down in lane ${F}`;if(z?T>=t.player.laneValues[F]?(O=150,M+=` [Blocks compile: ${T} vs ${t.player.laneValues[F]}]`):(O=-500,M+=" [WASTE: Card goes to trash when player compiles!]"):!t.opponent.compiled[F]&&T>=10&&T>t.player.laneValues[F]?(O=300,M+=` [COMPILE: Face-down finishes at ${q} -> ${T} beats player ${t.player.laneValues[F]}]`):!t.opponent.compiled[F]&&t.player.laneValues[F]>=10&&T>=t.player.laneValues[F]?(O=250,M+=` [BLOCK COMPILE: Face-down reaches ${T} vs player ${t.player.laneValues[F]}]`):!t.opponent.compiled[F]&&t.player.laneValues[F]>=10&&T<t.player.laneValues[F]?(O=-500,M+=" [WASTE: Card goes to trash when player compiles!]"):C===F&&!t.opponent.compiled[F]&&q>=4?(O=50+q*10,M+=` [BUILD FOCUS: ${q} -> ${T}]`):!U.allowed&&I.value<=1?(O=-20,M+=" [No face-up option, low value]"):(O=-120,M+=" [Avoid: Face-up is better]"),C!==-1&&O<50&&!g&&(F===C?(O+=50,M+=" [Focus lane]"):(O-=80,M+=" [Not focus lane]")),g){const Y=t.opponent.laneValues[F]>t.player.laneValues[F],X=T>t.player.laneValues[F],K=t.opponent.laneValues[F]===t.player.laneValues[F];if(Y)O-=200,M+=" [FD ALREADY LEADING - DON'T WASTE!]";else if(!Y&&X)y===1?(O+=400,M+=" [FD CONTROL CAPTURE! 1->2 leads]"):y===0&&(O+=250,M+=" [FD First lead!]");else if(K&&X)y===1?(O+=350,M+=" [FD BREAK TIE FOR CONTROL!]"):(O+=200,M+=" [FD Break tie]");else if(!Y&&!X&&y===1){const ne=t.player.laneValues[F]-T;ne<=3?(O+=150,M+=` [FD BUILD toward 2nd lead, gap=${ne}]`):ne<=6&&(O+=100,M+=` [FD BUILD toward 2nd lead, gap=${ne}]`)}}n.push({move:{type:"playCard",cardId:I.id,laneIndex:F,isFaceUp:!1},score:Qm(O),reason:M})}}if(t.opponent.hand.length===0)n.push({move:{type:"fillHand"},score:500,reason:"Must refill - no cards"});else{const I=t.player.laneValues.some((B,G)=>B>=10&&B>t.opponent.laneValues[G]&&!t.player.compiled[G]),F=t.controlCardHolder==="opponent",U=t.player.compiled.some(B=>B);I&&F&&U&&n.push({move:{type:"fillHand"},score:200,reason:"Emergency draw to block compile with control swap"})}if(n.length===0)return{type:"fillHand"};n.sort((I,F)=>F.score-I.score);const j=I=>{if(I.type==="playCard"&&I.isFaceUp){const F=t.opponent.hand.find(B=>B.id===I.cardId);if(!F)return!1;const U=Cr(t,"opponent",I.laneIndex,!0,F.protocol);if(!U.allowed)return console.warn(`[AI Safety] Rejecting invalid face-up play: ${F.protocol}-${F.value} in lane ${I.laneIndex} - ${U.reason}`),!1}return!0};if(!(((R=(k=n[0])==null?void 0:k.reason)==null?void 0:R.includes("Blocks compile"))||((L=(D=n[0])==null?void 0:D.reason)==null?void 0:L.includes("BLOCK COMPILE")))&&sl()&&n.length>1&&n[1].score>0&&j(n[1].move))return n[1].move;for(const I of n)if(j(I.move))return I.move;return console.warn("[AI Safety] No valid moves found, falling back to fillHand"),{type:"fillHand"}},hC=(t,n)=>{var r,s;switch(n.type){case"prompt_use_control_mechanic":{const c=t.player.compiled.filter(f=>f).length,d=t.compilableLanes.length>0?t.compilableLanes[0]:null;let u=-1;for(let f=0;f<3;f++)if(!t.player.compiled[f]&&t.player.laneValues[f]>=10&&t.player.laneValues[f]>t.opponent.laneValues[f]){u=f;break}const p=t.player.compiled.map((f,h)=>f?h:-1).filter(f=>f!==-1);return u!==-1&&p.length>0?{type:"resolveControlMechanicPrompt",choice:"player"}:c===0?Vc(t,d)&&!sl()?{type:"resolveControlMechanicPrompt",choice:"opponent"}:{type:"resolveControlMechanicPrompt",choice:"skip"}:Iy(t,d)?{type:"resolveControlMechanicPrompt",choice:"player"}:Vc(t,d)&&!sl()?{type:"resolveControlMechanicPrompt",choice:"opponent"}:{type:"resolveControlMechanicPrompt",choice:"skip"}}case"discard":return{type:"discardCards",cardIds:[...t.opponent.hand].sort((d,u)=>{const p=wl.some(h=>d.keywords[h]),f=wl.some(h=>u.keywords[h]);return p&&!f?1:!p&&f?-1:Fn(d)-Fn(u)}).slice(0,n.count).map(d=>d.id)};case"discard_completed":return{type:"skip"};case"select_opponent_card_to_flip":{const d=(p=>t[p].lanes.map(f=>f.length>0?f[f.length-1]:null).filter(f=>f!==null))("player");if(d.length===0)return{type:"skip"};const u=d.map(p=>({cardId:p.id,score:p.isFaceUp?p.value+5:3}));return u.sort((p,f)=>f.score-p.score),{type:"flipCard",cardId:u[0].cardId}}case"select_cards_to_delete":{const c=n.disallowedIds||[],d=n.allowedIds,u=n.targetFilter??{},p="actorChooses"in n?n.actorChooses:"effect_owner",f=n.sourceCardId;if(p==="card_owner"&&(u==null?void 0:u.owner)==="opponent"){const m=[];return t.opponent.lanes.forEach(g=>{if(g.length>0){const v=g[g.length-1];if(rl(v,!0,u,f)){if(d&&!d.includes(v.id))return;m.push(v)}}}),m.length>0?(m.sort((g,v)=>g.value-v.value),{type:"deleteCard",cardId:m[0].id}):{type:"skip"}}const h=m=>t[m].lanes.map(g=>g.length>0?g[g.length-1]:null).filter(g=>g!==null).filter(g=>rl(g,!0,u,f)).filter(g=>!d||d.includes(g.id)),y=u==null?void 0:u.owner;if(y==="own"){const m=h("opponent").filter(g=>!c.includes(g.id));if(m.length>0)return{type:"deleteCard",cardId:m.sort((v,C)=>v.value-C.value)[0].id}}else if(y==="opponent"){const m=h("player").filter(g=>!c.includes(g.id));if(m.length>0){const g=m.map(v=>{const C=t.player.lanes.findIndex(j=>j.some(E=>E.id===v.id)),b=t.player.laneValues[C],x=b>=10&&b>t.opponent.laneValues[C];return{cardId:v.id,score:ol(v,"player",t)+b+(x?50:0)}});return g.sort((v,C)=>C.score-v.score),{type:"deleteCard",cardId:g[0].cardId}}}else{const m=h("player").filter(v=>!c.includes(v.id));if(m.length>0){const v=m.map(C=>{const b=t.player.lanes.findIndex(E=>E.some(k=>k.id===C.id)),x=t.player.laneValues[b],j=x>=10&&x>t.opponent.laneValues[b];return{cardId:C.id,score:ol(C,"player",t)+x+(j?50:0)}});return v.sort((C,b)=>b.score-C.score),{type:"deleteCard",cardId:v[0].cardId}}const g=h("opponent").filter(v=>!c.includes(v.id));if(g.length>0)return{type:"deleteCard",cardId:g.sort((C,b)=>C.value-b.value)[0].id}}return{type:"skip"}}case"select_any_card_to_flip":case"select_any_other_card_to_flip":case"select_any_face_down_card_to_flip_optional":case"select_any_card_to_flip_optional":{const c=za(t),d=n.targetFilter,u=n.sourceCardId,p=n.actor,f=n.currentLaneIndex??n.laneIndex,h=n.scope,y=[];for(const g of["player","opponent"])if(!(d&&(d.owner==="own"&&g!==p||d.owner==="opponent"&&g===p)))for(let v=0;v<t[g].lanes.length;v++){if(f!==void 0&&v!==f||h==="this_lane"&&f!==void 0&&v!==f)continue;const C=t[g].lanes[v];if(C.length!==0)for(let b=0;b<C.length;b++){const x=C[b],j=b===C.length-1;if(d){if(!rl(x,j,d,u))continue}else if(!j)continue;c&&!x.isFaceUp||y.push({card:x,owner:g})}}if(y.length===0)return{type:"skip"};const m=y.map(({card:g,owner:v})=>{let C=0,b=-1;for(let D=0;D<t[v].lanes.length;D++)if(t[v].lanes[D].some(L=>L.id===g.id)){b=D;break}const x=b>=0?t[v].laneValues[b]:0,j=b>=0?t[v].compiled[b]:!1,E=g.isFaceUp?g.value:2,R=(g.isFaceUp?2:g.value)-E;return v==="player"?g.isFaceUp?(C=-R*15,C+=ol(g,"player",t)):g.value<=1?C=20:C=-30:g.isFaceUp?R>0?(C=R*20+50,!j&&x+R>=10&&(C+=200)):C=R*15-30:R>0?(C=R*20+40,!j&&x+R>=10&&(C+=200)):C=-10,{cardId:g.id,score:C}});return m.sort((g,v)=>v.score-g.score),{type:"flipCard",cardId:m[0].cardId}}case"select_card_from_hand_to_play":{if(t.opponent.hand.length===0)return{type:"skip"};const c=n.faceDown===!0,d=n.selectableCardIds,u=d?t.opponent.hand.filter(m=>d.includes(m.id)):t.opponent.hand;if(u.length===0)return{type:"skip"};const p=n.forcedLaneIndex;let f;if(p!==void 0?f=[p]:f=n.validLanes||[0,1,2].filter(m=>m!==n.disallowedLaneIndex),f=f.filter(m=>{const g=t.player.lanes[m],v=g.length>0?g[g.length-1]:null;return!(v&&v.isFaceUp&&v.protocol==="Plague"&&v.value===0)}),f.length===0)return{type:"skip"};const h=[];for(const m of u)for(const g of f){if(!c){const b=t.opponent.lanes.flat().some(k=>k.isFaceUp&&k.protocol==="Spirit"&&k.value===1),x=t.opponent.lanes.some(k=>{if(k.length===0)return!1;const R=k[k.length-1];return R.isFaceUp&&R.protocol==="Chaos"&&R.value===3}),j=[...t.player.lanes.flat(),...t.opponent.lanes.flat()].some(k=>k.isFaceUp&&k.protocol==="Anarchy"&&k.value===1);let E;if(j?E=m.protocol!==t.opponent.protocols[g]&&m.protocol!==t.player.protocols[g]:E=m.protocol===t.opponent.protocols[g]||m.protocol===t.player.protocols[g]||b||x,E){const k=m.value,R=t.opponent.laneValues[g]+k;let D=Fn(m)+k*2;R>=10&&R>t.player.laneValues[g]&&(D+=100);const L=t.player.laneValues[g],I=t.player.compiled[g],F=t.opponent.compiled[g],U=t.opponent.laneValues[g];!I&&!F&&L>=10&&L>U&&R>=L&&(D+=160),h.push({cardId:m.id,laneIndex:g,isFaceUp:!0,score:D})}}if(!t.player.lanes[g].some(b=>b.isFaceUp&&b.protocol==="Metal"&&b.value===2)){const b=wn({...m,isFaceUp:!1},t.opponent.lanes[g]),x=t.opponent.laneValues[g]+b;let j=b*2;x>=10&&x>t.player.laneValues[g]&&(j+=80);const E=t.player.laneValues[g],k=t.player.compiled[g],R=t.opponent.compiled[g],D=t.opponent.laneValues[g];!k&&!R&&E>=10&&E>D&&x>=E&&(j+=150),h.push({cardId:m.id,laneIndex:g,isFaceUp:!1,score:j})}}if(h.length===0)return{type:"skip"};h.sort((m,g)=>g.score-m.score);const y=h[0];return{type:"playCard",cardId:y.cardId,laneIndex:y.laneIndex,isFaceUp:y.isFaceUp}}case"select_card_from_hand_to_give":return t.opponent.hand.length===0?{type:"skip"}:{type:"giveCard",cardId:[...t.opponent.hand].sort((d,u)=>Fn(d)-Fn(u))[0].id};case"select_card_from_hand_to_reveal":return t.opponent.hand.length===0?{type:"skip"}:{type:"revealCard",cardId:[...t.opponent.hand].sort((d,u)=>Fn(u)-Fn(d))[0].id};case"select_card_to_return":case"select_opponent_card_to_return":{const d={position:"uncovered",...n.targetFilter||{}},u=n.targetOwner||d.owner,p=n.sourceCardId,f=n.actor,h=[];for(const g of["player","opponent"])if(!(u==="own"&&g!==f)&&!(u==="opponent"&&g===f))for(const v of t[g].lanes)for(let C=0;C<v.length;C++){const b=v[C],x=C===v.length-1;rl(b,x,d,p)&&h.push({card:b,owner:g})}if(h.length===0)return{type:"skip"};const y=h.filter(g=>g.owner==="player"),m=h.filter(g=>g.owner==="opponent");return y.length>0?(y.sort((g,v)=>ol(v.card,"player",t)-ol(g.card,"player",t)),{type:"returnCard",cardId:y[0].card.id}):m.length>0?(m.sort((g,v)=>g.card.value-v.card.value),{type:"returnCard",cardId:m[0].card.id}):{type:"returnCard",cardId:h[0].card.id}}case"select_lane_for_play":{let c=n.validLanes||[0,1,2];if(c=c.filter(p=>!("disallowedLaneIndex"in n)||p!==n.disallowedLaneIndex),n.excludeCurrentLane&&n.currentLaneIndex!==void 0&&(c=c.filter(p=>p!==n.currentLaneIndex)),c=c.filter(p=>{const f=t.player.lanes[p],h=f.length>0?f[f.length-1]:null,y=h&&h.isFaceUp&&h.protocol==="Plague"&&h.value===0,m="isFaceDown"in n&&n.isFaceDown&&f.some(g=>g.isFaceUp&&g.protocol==="Metal"&&g.value===2);return!y&&!m}),c.length===0)return{type:"skip"};const d=c.filter(p=>{const f=t.player.laneValues[p],h=t.opponent.laneValues[p],y=t.player.compiled[p],m=t.opponent.compiled[p],g=!y&&f>=10&&f>h,v=h+2>=f;return g&&v&&!m});if(d.length>0)return d.sort((p,f)=>t.player.laneValues[f]-t.player.laneValues[p]),{type:"selectLane",laneIndex:d[0]};const u=c.map(p=>{const f=t.opponent.laneValues[p]-t.player.laneValues[p];return{laneIndex:p,score:-f}});return u.sort((p,f)=>f.score-p.score),{type:"selectLane",laneIndex:u[0].laneIndex}}case"prompt_rearrange_protocols":return $y(t,n);case"prompt_swap_protocols":{const{target:c}=n,d=t[c].protocols,u=t[c].hand,p=t[c].compiled,f=t[c].laneValues,h=[[0,1],[0,2],[1,2]];let y=[0,1],m=-1/0;for(const g of h){const[v,C]=g,b=[...d];[b[v],b[C]]=[b[C],b[v]];let x=0;const j=p[v],E=p[C],k=f[v],R=f[C];if(c==="opponent"){j&&!E?R<k&&(x+=30):E&&!j&&k<R&&(x+=30);for(const D of u){const L=D.protocol===d[v],I=D.protocol===d[C],F=D.protocol===b[v],U=D.protocol===b[C],B=j?.5:1.5,G=E?.5:1.5;F&&!L&&(x+=Fn(D)*B),U&&!I&&(x+=Fn(D)*G),!F&&L&&(x-=Fn(D)*B),!U&&I&&(x-=Fn(D)*G)}}else{j&&!E?k>R&&(x+=25):E&&!j&&R>k&&(x+=25);for(const D of u){const L=D.protocol===d[v],I=D.protocol===d[C],F=D.protocol===b[v],U=D.protocol===b[C],B=j?.5:1.5,G=E?.5:1.5;F&&!L&&(x-=Fn(D)*B),U&&!I&&(x-=Fn(D)*G),!F&&L&&(x+=Fn(D)*B),!U&&I&&(x+=Fn(D)*G)}}x>m&&(m=x,y=g)}return{type:"resolveSwapProtocols",indices:y}}case"select_lane_for_shift":{let c=n.validLanes||[0,1,2];if(c=c.filter(d=>!("disallowedLaneIndex"in n)||d!==n.disallowedLaneIndex).filter(d=>!("originalLaneIndex"in n)||d!==n.originalLaneIndex),"sourceCardId"in n){const d=[...t.player.lanes.flat(),...t.opponent.lanes.flat()].find(u=>u.id===n.sourceCardId);if(d&&d.protocol==="Gravity"&&d.value===1){let u=null;for(let p=0;p<3;p++)if([...t.player.lanes[p],...t.opponent.lanes[p]].some(h=>h.id===n.sourceCardId)){u=p;break}u!==null&&"originalLaneIndex"in n&&(n.originalLaneIndex===u||(c=[u]))}if(d&&d.protocol==="Anarchy"&&d.value===1){const u="cardToShiftId"in n?n.cardToShiftId:null;if(u){const p=[...t.player.lanes.flat(),...t.opponent.lanes.flat()].find(f=>f.id===u);p&&(c=c.filter(f=>{const h=t.player.protocols[f],y=t.opponent.protocols[f],m=p.protocol;return m!==h&&m!==y}))}}}if(c.length>0){const d="cardToShiftId"in n?n.cardToShiftId:null;let u=null,p=0;if(d)for(const h of["player","opponent"]){for(const y of t[h].lanes){const m=y.find(g=>g.id===d);if(m){u=h,p=m.isFaceUp?m.value:2;break}}if(u)break}const f=c.map(h=>{let y=0;const m=t.player.laneValues[h],g=t.opponent.laneValues[h],v=t.player.compiled[h],C=t.opponent.compiled[h];return u==="player"?v?y+=100:g>m?y+=50:m>=6&&m<10&&!v&&(y-=50):u==="opponent"&&(!C&&g<10?g+p>=10?y+=100:g>=6?y+=60:y+=30:C&&(y-=50)),{laneIdx:h,score:y}});if(f.sort((h,y)=>y.score-h.score),sl()&&f.length>1){const h=Math.floor(Math.random()*f.length);return{type:"selectLane",laneIndex:f[h].laneIdx}}return{type:"selectLane",laneIndex:f[0].laneIdx}}return{type:"selectLane",laneIndex:0}}case"select_lane_for_delete_all":{const c="validLanes"in n?n.validLanes:[0,1,2];return c.length>0?{type:"selectLane",laneIndex:c[Math.floor(Math.random()*c.length)]}:{type:"skip"}}case"select_lanes_for_swap_stacks":{const c=n.validLanes,d=n.selectedFirstLane;if(c.length===0)return{type:"skip"};if(d===void 0){const u=c.map(p=>{const f=t.opponent.laneValues[p];return{laneIdx:p,score:f}});return u.sort((p,f)=>p.score-f.score),{type:"selectLane",laneIndex:u[0].laneIdx}}else{const u=c.map(p=>{const f=t.opponent.laneValues[p];return{laneIdx:p,score:f}});return u.sort((p,f)=>f.score-p.score),{type:"selectLane",laneIndex:u[0].laneIdx}}}case"select_card_for_copy_middle":{const c=n.validTargetIds||[];if(c.length===0)return{type:"skip"};const d=c.map(u=>{var f,h;let p=0;for(const y of["player","opponent"])for(const m of t[y].lanes){const g=m.find(v=>v.id===u);if(g){const C=((f=g.customEffects)==null?void 0:f.middleEffects)||[];for(const b of C){const x=(h=b.params)==null?void 0:h.action;x==="draw"&&(p+=5),x==="flip"&&(p+=3),x==="delete"&&(p+=4),x==="shift"&&(p+=2),x==="discard"&&(p-=2)}}}return{cardId:u,score:p}});return d.sort((u,p)=>p.score-u.score),{type:"selectCard",cardId:d[0].cardId}}case"select_lane_for_return":{const c=n.targetFilter||{},d=n.actor,u=c.valueEquals,p=c.valueRange,f=[];for(let h=0;h<3;h++){let y=0,m=0;const g=Oy(t,h);for(const b of["player","opponent"]){if(c.owner==="own"&&b!==d||c.owner==="opponent"&&b===d)continue;const x=t[b].lanes[h];for(let j=0;j<x.length;j++){const E=x[j],k=j===x.length-1;if(c.position==="uncovered"&&!k||c.position==="covered"&&k)continue;const R=E.isFaceUp?E.value:2+g;u!==void 0&&R!==u||p&&(R<p.min||R>p.max)||(b==="player"?y+=R:m+=R)}}const v=y-m,C=`Lane ${h}: Player loses ${y}, we lose ${m}, net=${v}`;f.push({laneIndex:h,score:v,reason:C})}f.sort((h,y)=>y.score-h.score);for(const h of f);return f.length>0?{type:"selectLane",laneIndex:f[0].laneIndex}:{type:"selectLane",laneIndex:0}}case"prompt_optional_effect":{const{effectDef:c}=n,d=(r=c==null?void 0:c.params)==null?void 0:r.action,u=(s=c==null?void 0:c.params)==null?void 0:s.targetFilter;if(d==="give")return{type:"resolveOptionalEffectPrompt",accept:!1};if(d==="flip"){let p=!1;const f=(u==null?void 0:u.position)||"uncovered";for(const h of["player","opponent"])if(!((u==null?void 0:u.owner)==="own"&&h!=="opponent")&&!((u==null?void 0:u.owner)==="opponent"&&h==="opponent")){for(let y=0;y<t[h].lanes.length;y++){const m=t[h].lanes[y];if(m.length!==0){for(let g=0;g<m.length;g++){const v=m[g],C=g===m.length-1,b=!C;if(f==="uncovered"&&!C||f==="covered"&&!b||(u==null?void 0:u.faceState)==="face_up"&&!v.isFaceUp||(u==null?void 0:u.faceState)==="face_down"&&v.isFaceUp)continue;const x=v.isFaceUp?v.value:2,j=v.isFaceUp?2:v.value;if(h==="player"){if(v.isFaceUp&&x>j){p=!0;break}}else{const E=t.opponent.laneValues[y],k=j-x;if(v.isFaceUp&&k>0){p=!0;break}if(!v.isFaceUp&&v.value>2){p=!0;break}if(k>0&&E+k>=10&&!t.opponent.compiled[y]){p=!0;break}}}if(p)break}}if(p)break}return{type:"resolveOptionalEffectPrompt",accept:p}}return{type:"resolveOptionalEffectPrompt",accept:!sl()}}case"select_card_from_other_lanes_to_delete":{const{disallowedLaneIndex:c,lanesSelected:d}=n,u=[];for(let p=0;p<3;p++){if(p===c||d.includes(p))continue;const f=t.player.lanes[p];if(f.length>0){u.push(f[f.length-1]);continue}const h=t.opponent.lanes[p];h.length>0&&u.push(h[h.length-1])}return u.length>0?{type:"deleteCard",cardId:u[0].id}:{type:"skip"}}case"select_face_down_card_to_delete":{const c="disallowedIds"in n&&Array.isArray(n.disallowedIds)?n.disallowedIds:[],d=f=>t[f].lanes.map(h=>h.length>0?h[h.length-1]:null).filter(h=>h!==null),u=d("player").filter(f=>!c.includes(f.id));if(u.length>0)return{type:"deleteCard",cardId:u[0].id};const p=d("opponent").filter(f=>!c.includes(f.id));return p.length>0?{type:"deleteCard",cardId:p[0].id}:{type:"skip"}}case"select_low_value_card_to_delete":{const c=[];for(const u of["player","opponent"])for(const p of t[u].lanes)p.length>0&&c.push(p[p.length-1]);const d=c.filter(u=>u.isFaceUp&&(u.value===0||u.value===1));return d.length>0?{type:"deleteCard",cardId:d[0].id}:{type:"skip"}}case"select_opponent_face_up_card_to_flip":{const d=(u=>t[u].lanes.map(p=>p.length>0?p[p.length-1]:null).filter(p=>p!==null))("player").filter(u=>u.isFaceUp);return d.length>0?(d.sort((u,p)=>p.value-u.value),{type:"flipCard",cardId:d[0].id}):{type:"skip"}}case"select_covered_card_in_line_to_flip_optional":{const c="optional"in n&&n.optional,u=!["select_any_other_card_to_flip","select_any_other_card_to_flip_for_water_0"].includes(n.type);if(n.type==="select_covered_card_in_line_to_flip_optional"){const{laneIndex:g}=n,v=t.opponent.lanes[g],C=t.player.lanes[g],b=v.filter((L,I,F)=>I<F.length-1),x=C.filter((L,I,F)=>I<F.length-1),j=t.opponent.laneValues[g];if(!t.opponent.compiled[g]){let L=null,I=null;for(const F of b){let U,B;F.isFaceUp?(U=F.value,B=2):(U=wn(F,v,t,g,"opponent"),B=F.value);const G=B-U,W=j+G;G>0&&W>=10&&(!L||W>L.newValue)&&(L={card:F,newValue:W,gain:G}),G>0&&(!I||G>I.gain)&&(I={card:F,gain:G,newValue:W})}if(L)return{type:"flipCard",cardId:L.card.id};if(I&&I.gain>0)return{type:"flipCard",cardId:I.card.id}}if(t.opponent.compiled[g]){let L=null;for(const I of b){const F=I.isFaceUp?I.value:wn(I,v,t,g,"opponent"),B=(I.isFaceUp?2:I.value)-F;B>0&&(!L||B>L.gain)&&(L={card:I,gain:B})}if(L)return{type:"flipCard",cardId:L.card.id}}const k=x.filter(L=>L.isFaceUp);if(k.length>0)return k.sort((L,I)=>I.value-L.value),{type:"flipCard",cardId:k[0].id};const R=b.filter(L=>!L.isFaceUp).map(L=>({card:L,gain:L.value-wn(L,v,t,g,"opponent")})).filter(L=>L.gain>0).sort((L,I)=>I.gain-L.gain);if(R.length>0)return{type:"flipCard",cardId:R[0].card.id};const D=x.filter(L=>!L.isFaceUp);return D.length>0?{type:"flipCard",cardId:D[0].id}:{type:"skip"}}const p=g=>t[g].lanes.map(v=>v.length>0?v[v.length-1]:null).filter(v=>v!==null),f=p("player"),h=p("opponent");{const g=f.filter(v=>v.isFaceUp).sort((v,C)=>C.value-v.value);if(g.length>0)return{type:"flipCard",cardId:g[0].id}}const y=h.filter(g=>!g.isFaceUp);if(y.length>0)return{type:"flipCard",cardId:y[0].id};const m=f.filter(g=>!g.isFaceUp);if(m.length>0)return{type:"flipCard",cardId:m[0].id};{const g=h.filter(C=>!(!C.isFaceUp||!u&&C.id===n.sourceCardId)),v=g.filter(C=>{const b=t.opponent.lanes.findIndex(x=>x.length>0&&x[x.length-1].id===C.id);return b!==-1&&t.opponent.compiled[b]});if(v.length>0&&!c)return{type:"flipCard",cardId:v[0].id};if(g.length>0&&!c)return{type:"flipCard",cardId:g[0].id}}return{type:"skip"}}case"shift_flipped_card_optional":{const c=n.cardId,d=n.optional,u=Ie(t,c);if(!u)return{type:"skip"};const p=u.card,f=u.owner,h=p.isFaceUp?p.value:2;let y=u.laneIndex??-1;if(y===-1){const D=t[f];for(let L=0;L<D.lanes.length;L++)if(D.lanes[L].some(I=>I.id===c)){y=L;break}}if(y===-1)return{type:"skip"};const m=[0,1,2].filter(D=>D!==y);if(m.length===0)return{type:"skip"};const g=t.opponent,v=t.player,C=g.laneValues[y],b=g.compiled[y],x=v.laneValues[y],j=C-h;let E=-1,k=-1/0;const R=0;for(const D of m){const L=g.laneValues[D],I=g.compiled[D],F=v.laneValues[D],U=L+h;let B=0;!b&&C>=8&&C>x&&(B-=100),!I&&U>=10&&U>F&&(B+=80),!I&&L<C&&(b||C<6)&&(B+=20),I&&(B-=30),!I&&L<=F&&U>F&&(B+=25),!b&&C>x&&j<=x&&(B-=40),B>k&&(k=B,E=D)}return d&&k<R?{type:"skip"}:E!==-1?{type:"selectLane",laneIndex:E}:d?{type:"skip"}:{type:"selectLane",laneIndex:m[0]}}case"select_lane_to_shift_revealed_card_for_light_2":case"select_lane_to_shift_revealed_card":{const c=n.revealedCardId,d=Ie(t,c);if(!d)return{type:"selectLane",laneIndex:0};let u=-1;for(let f=0;f<t[d.owner].lanes.length;f++)if(t[d.owner].lanes[f].some(h=>h.id===c)){u=f;break}const p=[0,1,2].filter(f=>f!==u);return p.length>0?(d.owner==="opponent"?p.sort((f,h)=>{const y=t.opponent.laneValues[f],m=t.opponent.laneValues[h];return!t.opponent.compiled[f]&&t.opponent.compiled[h]?-1:t.opponent.compiled[f]&&!t.opponent.compiled[h]?1:m-y}):p.sort((f,h)=>t.player.laneValues[f]-t.player.laneValues[h]),{type:"selectLane",laneIndex:p[0]}):{type:"selectLane",laneIndex:0}}case"select_opponent_face_down_card_to_shift":{const c=[];for(const d of t.player.lanes)if(d.length>0){const u=d[d.length-1];u.isFaceUp||c.push(u)}return c.length>0?{type:"deleteCard",cardId:c[Math.floor(Math.random()*c.length)].id}:{type:"skip"}}case"select_opponent_covered_card_to_shift":{const c=[];for(const d of t.player.lanes)for(let u=0;u<d.length-1;u++)c.push(d[u]);return c.length>0?{type:"deleteCard",cardId:c[Math.floor(Math.random()*c.length)].id}:{type:"skip"}}case"select_own_covered_card_to_shift":{const c=[];for(const d of t.opponent.lanes)for(let u=0;u<d.length-1;u++)c.push(d[u]);return c.length>0?{type:"deleteCard",cardId:c[Math.floor(Math.random()*c.length)].id}:{type:"skip"}}case"select_card_to_flip":{const c=n.targetFilter||{},d=n.restrictedLaneIndex??n.currentLaneIndex??n.laneIndex,u=n.scope,p=n.actor,f=n.sourceCardId,h=[];for(const m of["player","opponent"])if(!(c.owner==="own"&&m!==p)&&!(c.owner==="opponent"&&m===p))for(let g=0;g<t[m].lanes.length;g++){if(d!==void 0&&g!==d||u==="this_lane"&&d!==void 0&&g!==d)continue;const v=t[m].lanes[g];for(let C=0;C<v.length;C++){const b=v[C];if(Ko(t,b.id))continue;const x=Jo(t,v,C);if(rl(b,x,c,f)&&!(c.position==="covered_in_this_line"&&x)){if(c.valueMinGreaterThanHandSize){const j=t[p].hand.length;if(b.value<=j)continue}if(c.valueLessThanUniqueProtocolsOnField){const j=Er(t);if(b.value>=j)continue}h.push({card:b,owner:m,laneIndex:g})}}}if(h.length===0)return{type:"skip"};const y=h.map(({card:m,owner:g,laneIndex:v})=>{let C=0;const b=t[g].laneValues[v],x=t[g].compiled[v],j=m.isFaceUp?m.value:2,k=(m.isFaceUp?2:m.value)-j;return g==="player"?m.isFaceUp?(C=-k*15,C+=ol(m,"player",t)):m.value<=1?C=20:C=-30:m.isFaceUp?k>0?(C=k*20+50,!x&&b+k>=10&&(C+=200)):C=k*15-30:k>0?(C=k*20+40,!x&&b+k>=10&&(C+=200)):C=-10,{card:m,score:C}});if(y.sort((m,g)=>g.score-m.score),sl()&&y.length>1){const m=Math.floor(Math.random()*y.length);return{type:"flipCard",cardId:y[m].card.id}}return{type:"flipCard",cardId:y[0].card.id}}case"select_card_to_shift":{const c=n.targetFilter||{},d=n.scope,u=n.destinationRestriction,p=n.targetLaneIndex,f=d==="this_lane"?n.sourceLaneIndex??n.currentLaneIndex??n.laneIndex:void 0,h=n.actor,y=n.sourceCardId,m=[];for(const g of["player","opponent"])if(!(c.owner==="own"&&g!==h)&&!(c.owner==="opponent"&&g===h))for(let v=0;v<t[g].lanes.length;v++){if(f!==void 0&&v!==f||(u==null?void 0:u.type)==="to_this_lane"&&p!==void 0&&v===p)continue;const C=t[g].lanes[v];for(let b=0;b<C.length;b++){const x=C[b],j=b===C.length-1;rl(x,j,c,y)&&m.push(x)}}return m.length>0?{type:"shiftCard",cardId:m[Math.floor(Math.random()*m.length)].id}:{type:"skip"}}case"select_board_card_to_reveal_custom":{const c=[];for(const d of["player","opponent"])for(const u of t[d].lanes)if(u.length>0){const p=u[u.length-1];p.isFaceUp||c.push({card:p,owner:d})}if(c.length>0){const d=c.filter(u=>u.owner==="player");return d.length>0?{type:"deleteCard",cardId:d[0].card.id}:{type:"deleteCard",cardId:c[0].card.id}}return{type:"skip"}}case"prompt_shift_or_flip_board_card_custom":{const{revealedCardId:c}=n,d=Ie(t,c);return d?d.owner==="opponent"?{type:"resolveRevealBoardCardPrompt",choice:"flip"}:{type:"resolveRevealBoardCardPrompt",choice:"shift"}:{type:"resolveRevealBoardCardPrompt",choice:"skip"}}case"select_lane_to_shift_revealed_board_card_custom":{const c=[0,1,2];return c.sort((d,u)=>t.player.laneValues[d]-t.player.laneValues[u]),{type:"selectLane",laneIndex:c[0]}}case"gravity_2_shift_after_flip":{const{targetLaneIndex:c}=n;return{type:"selectLane",laneIndex:c}}case"flip_self":case"flip_self_for_water_0":case"flip_self_for_psychic_4":case"speed_3_self_flip_after_shift":return n.sourceCardId?{type:"flipCard",cardId:n.sourceCardId}:{type:"skip"};case"anarchy_0_conditional_draw":return{type:"skip"};case"select_any_opponent_card_to_shift":{const c=t.player.lanes.map(d=>d.length>0?d[d.length-1]:null).filter(d=>d!==null);return c.length>0?{type:"deleteCard",cardId:c[Math.floor(Math.random()*c.length)].id}:{type:"skip"}}case"select_own_other_card_to_shift":{const c=t.opponent.lanes.flat().find(d=>d.id!==n.sourceCardId);return c?{type:"deleteCard",cardId:c.id}:{type:"skip"}}case"select_own_face_up_covered_card_to_flip":return{type:"skip"};case"reveal_opponent_hand":case"delete_self":return{type:"skip"};case"select_card_from_trash_to_play":{const c=t.opponent.discard;return c.length===0?{type:"skip"}:{type:"selectTrashCard",cardIndex:[...c].map((u,p)=>{var h,y,m;let f=u.value*10;for(let g=0;g<3;g++){if(t.opponent.compiled[g])continue;const v=t.opponent.laneValues[g]+u.value;v>=10&&v>t.player.laneValues[g]&&(f+=100)}return(h=u.keywords)!=null&&h.flip&&(f+=5),(y=u.keywords)!=null&&y.draw&&(f+=3),(m=u.keywords)!=null&&m.delete&&(f+=5),{card:u,index:p,score:f}}).sort((u,p)=>p.score-u.score)[0].index}}case"select_card_from_trash_to_reveal":{const c=t.opponent.discard;return c.length===0?{type:"skip"}:{type:"selectTrashCard",cardIndex:[...c].map((u,p)=>({card:u,index:p,value:u.value})).sort((u,p)=>p.value-u.value)[0].index}}case"select_lane_for_delete":{const c=n.validLanes||[0,1,2],d=n.valueFilter,u=c.map(p=>{let f=0,h=0;for(const y of t.player.lanes[p]){const m=y.isFaceUp?y.value:2;d?y.isFaceUp?y.value>=d.min&&y.value<=d.max&&(f+=m+1):f+=(m+1)*.5:f+=m+1}for(const y of t.opponent.lanes[p]){const m=y.isFaceUp?y.value:2;d?y.isFaceUp?y.value>=d.min&&y.value<=d.max&&(h+=m+3):h+=(m+3)*.5:h+=m+3}return{laneIndex:p,score:f-h}});return u.sort((p,f)=>f.score-p.score),u[0].score>0?{type:"selectLane",laneIndex:u[0].laneIndex}:{type:"selectLane",laneIndex:u[0].laneIndex}}case"select_lane_for_shift_all":{const c=n.validDestinationLanes||n.validLanes||[0,1,2],d=n.sourceLaneIndex,u=c.filter(p=>p!==d);if(u.length>0){const p=u.map(f=>{let h=0;return h+=t.opponent.lanes[f].length*2,h+=t.opponent.laneValues[f],t.player.laneValues[f]>=8&&(h-=5),{laneIndex:f,score:h}});return p.sort((f,h)=>h.score-f.score),{type:"selectLane",laneIndex:p[0].laneIndex}}return c.length>0?{type:"selectLane",laneIndex:c[0]}:{type:"selectLane",laneIndex:0}}case"prompt_optional_draw":return{type:"resolveOptionalEffectPrompt",accept:!0};case"prompt_optional_discard_custom":return{type:"resolveOptionalEffectPrompt",accept:t.opponent.hand.length>4};case"prompt_optional_shuffle_trash":return{type:"resolvePrompt",accept:(n.trashCount||0)>0};case"select_card_from_revealed_deck":{const c=n.selectableCardIds||[];if(c.length>0){const d=Math.floor(Math.random()*c.length);return{type:"selectRevealedDeckCard",cardId:c[d]}}return{type:"resolvePrompt",accept:!1}}case"custom_choice":{const{options:c}=n;if(!c||c.length!==2)return{type:"resolveCustomChoice",optionIndex:0};const d=f=>{var m,g,v;let h=0;const y=((m=f.action)==null?void 0:m.toLowerCase())||"";return y.includes("draw")&&(h+=30),y.includes("discard")&&(h-=20),y.includes("delete")&&((g=f.targetFilter)==null?void 0:g.owner)==="opponent"&&(h+=40),y.includes("delete")&&((v=f.targetFilter)==null?void 0:v.owner)==="own"&&(h-=30),h},u=d(c[0]),p=d(c[1]);return{type:"resolveCustomChoice",optionIndex:u>=p?0:1}}case"select_phase_effect":{const c=n;if(c.availableEffects.length===0)return{type:"skip"};const d=c.availableEffects.map(p=>{let f=0;const h=p.effectDescription.toLowerCase();return h.includes("draw")?f+=100:h.includes("delete")?f+=80:h.includes("shift")?f+=60:h.includes("flip")?f+=40:f+=20,Math.random()<.05&&(f=Math.random()*50),{effect:p,score:f}});return d.sort((p,f)=>f.score-p.score),{type:"flipCard",cardId:d[0].effect.cardId}}case"state_number":{const c={0:0,1:0,2:0,3:0,4:0,5:0};t.opponent.hand.forEach(p=>{p.value>=0&&p.value<=5&&c[p.value]++}),c[2]+=2,c[3]+=2;let d=0,u=c[0];for(let p=1;p<=5;p++)c[p]>u&&(u=c[p],d=p);return Math.random()<.05&&(d=Math.floor(Math.random()*6)),{type:"stateNumber",number:d}}case"state_protocol":{const d=n.availableProtocols||[];if(d.length===0)return{type:"skip"};const u=t.player.protocols,p=d.map(f=>{let h=0;return u.includes(f)&&(h+=50),h+=Math.random()*20,{protocol:f,score:h}});return p.sort((f,h)=>h.score-f.score),{type:"stateProtocol",protocol:p[0].protocol}}case"select_from_drawn_to_reveal":{const d=n.eligibleCardIds||[];if(d.length===0)return{type:"skip"};const u=t.opponent.hand,p=d.map(f=>{const h=u.find(m=>m.id===f);if(!h)return{cardId:f,score:0};let y=h.value;return t.opponent.protocols.includes(h.protocol)&&(y+=10),{cardId:f,score:y}});return p.sort((f,h)=>h.score-f.score),{type:"selectFromDrawnToReveal",cardId:p[0].cardId}}case"confirm_deck_discard":return{type:"confirmDeckDiscard"};case"confirm_deck_play_preview":return{type:"confirmDeckPlayPreview"};default:{if("optional"in n&&n.optional)return{type:"skip"};const c=[...t.player.lanes.flat(),...t.opponent.lanes.flat()];return c.length>0&&(n.type.includes("select_")||n.type.includes("shift"))?{type:"deleteCard",cardId:c[0].id}:{type:"skip"}}}},mC=(t,n)=>n?hC(t,n):t.phase==="compile"&&t.compilableLanes.length>0?{type:"compile",laneIndex:t.compilableLanes.reduce((s,c)=>t.opponent.laneValues[c]>t.opponent.laneValues[s]?c:s)}:t.phase==="action"?fC(t):{type:"fillHand"};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * GameStateAnalyzer - Analyzes the current game state to recommend strategies
 *
 * This module provides deep analysis of the game state to help the AI make
 * intelligent decisions based on the current situation rather than just card values.
 */function yC(t){const n=t.player.lanes.flat().length,r=t.opponent.lanes.flat().length;return n+r}function zc(t,n){return t[n].compiled.filter(r=>r).length}function gC(t){const n=yC(t),r=zc(t,"player"),s=zc(t,"opponent"),c=r+s;return r===2||s===2?"endgame":c>=2?"late":n<=4?"early":"mid"}function vC(t,n,r,s=3.5){if(r)return-1;const c=Math.max(10-t,n-t+1);return c<=0?0:Math.ceil(c/s)}function _C(t){const n=[];for(let r=0;r<3;r++){const s=t.opponent.laneValues[r],c=t.player.laneValues[r],d=t.opponent.compiled[r],u=t.player.compiled[r];n.push({laneIndex:r,ourValue:s,playerValue:c,weAreLeading:s>c,playerIsLeading:c>s,isTied:s===c,ourDistanceToCompile:d?-1:Math.max(10-s,c-s+1),playerDistanceToCompile:u?-1:Math.max(10-c,s-c+1),ourProtocol:t.opponent.protocols[r],playerProtocol:t.player.protocols[r],isCompiled:d,playerLaneCompiled:u})}return n}function wC(t,n){const r=[],s=[];for(const d of n)d.playerLaneCompiled||(d.playerValue>=10&&d.playerValue>d.ourValue?r.push(d.laneIndex):d.playerValue>=8&&d.playerValue<10&&s.push(d.laneIndex));let c=1/0;for(const d of n){if(d.playerLaneCompiled)continue;const u=vC(d.playerValue,d.ourValue,d.playerLaneCompiled);u>=0&&u<c&&(c=u)}return{playerCanCompile:r.length>0,playerCompileLanes:r,playerNearCompileLanes:s,turnsUntilPlayerCompile:c===1/0?99:c,playerHasControl:t.controlCardHolder==="player",playerCompiledCount:zc(t,"player")}}function xC(t,n){const r=n.map(f=>f.ourValue),s=n.filter(f=>f.weAreLeading&&!f.isCompiled).length,c=t.controlCardHolder==="opponent";let d=-1,u=1/0;for(const f of n)f.isCompiled||f.ourDistanceToCompile>=0&&f.ourDistanceToCompile<u&&(u=f.ourDistanceToCompile,d=f.laneIndex);const p=!c&&s>=1;return{ourCompileProgress:r,closestLane:d,closestLaneDistance:u===1/0?99:u,weHaveControl:c,lanesWeLeadIn:s,canGetControlThisTurn:p,ourCompiledCount:zc(t,"opponent")}}function CC(t,n,r){let s=0;switch(t.playerCanCompile&&(s+=80),s+=t.playerNearCompileLanes.length*20,r){case"endgame":s+=30;break;case"late":s+=15;break;case"mid":s+=5;break}return t.playerCompiledCount>n.ourCompiledCount&&(s+=20),t.playerHasControl&&(s+=15,t.playerCompiledCount>=1&&(s+=30)),Math.min(100,s)}function SC(t,n,r,s){if(n.playerCanCompile){for(const c of n.playerCompileLanes){const d=s[c];if(d.playerValue-d.ourValue<=6)return"defend"}return r.closestLaneDistance<=3?"rush":"disrupt"}if(n.playerHasControl&&n.playerCompiledCount>=1)return"control";if(t==="endgame"){if(r.ourCompiledCount===2)return"rush";if(n.playerCompiledCount===2)return n.playerNearCompileLanes.length>0?"defend":"disrupt"}if(n.playerCompiledCount>=1){if(!r.weHaveControl&&r.canGetControlThisTurn)return"control";if(n.playerNearCompileLanes.length>0)return r.lanesWeLeadIn>=1?"control":"disrupt"}if(r.closestLaneDistance<=4)return"rush";if(t==="early"||t==="mid"){if(r.closestLaneDistance<=6)return"rush";if(n.turnsUntilPlayerCompile<3)return"disrupt"}return"rush"}function My(t){const n=_C(t),r=gC(t),s=wC(t,n),c=xC(t,n),d=CC(s,c,r),u=SC(r,s,c,n);return{gamePhase:r,threats:s,position:c,lanes:n,recommendedStrategy:u,urgency:d}}function bC(t,n){const r=n.lanes[t],{recommendedStrategy:s}=n;if(r.isCompiled)return{isGood:!1,reason:"Already compiled",score:-1e3};switch(s){case"rush":{const c=100-r.ourDistanceToCompile*10;return{isGood:r.ourDistanceToCompile<=6,reason:`Distance to compile: ${r.ourDistanceToCompile}`,score:c}}case"control":{if(r.weAreLeading)return{isGood:!1,reason:"Already leading - need other lanes for control",score:-50};const c=r.playerValue-r.ourValue,d=100-c*15;return{isGood:c<=4,reason:`Gap to lead: ${c}`,score:d}}case"disrupt":{if(r.playerLaneCompiled)return{isGood:!1,reason:"Player already compiled",score:-100};const c=r.playerValue*10;return{isGood:r.playerValue>=5,reason:`Player value: ${r.playerValue}`,score:c}}case"defend":return n.threats.playerCompileLanes.includes(t)?{isGood:!0,reason:"BLOCKING COMPILE THREAT",score:200}:{isGood:!1,reason:"Not a threat lane",score:0}}}function EC(t){const n=[];for(let r=0;r<3;r++){const s=bC(r,t);s.score>-100&&n.push({laneIndex:r,score:s.score,reason:s.reason})}return n.sort((r,s)=>s.score-r.score),n}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * EffectEvaluator - Evaluates card effects in context
 *
 * This module provides intelligent evaluation of card effects based on
 * the current game state and strategy, not just raw card values.
 *
 * KEY INSIGHT: A flip effect on a 6-value card is GREAT (reduces by 4),
 * but on a 0-value card is TERRIBLE (increases by 2)!
 *
 * NEW: Uses AI Card Memory to remember face-down card values for smarter decisions.
 */function Mu(t,n){for(const r of["player","opponent"])for(let s=0;s<t[r].lanes.length;s++)if(t[r].lanes[s].some(c=>c.id===n))return s;return-1}function xs(t,n){const r=[];for(const s of t[n].lanes)s.length>0&&r.push(s[s.length-1]);return r}function Hy(t){const n=t.keywords;return n.delete||n.return||n.discard||t.top.length>0||t.bottom.includes("Start:")||t.bottom.includes("End:")}function jC(t,n,r,s){const c=[],d=r||{};for(const u of["player","opponent"]){if(d.owner==="own"&&u!=="opponent"||d.owner==="opponent"&&u!=="player")continue;const p=xs(t,u);for(const f of p){if(s&&f.id===s||d.faceState==="face_up"&&!f.isFaceUp||d.faceState==="face_down"&&f.isFaceUp)continue;const h=Mu(t,f.id);let y=0,m="";if(u==="player")if(f.isFaceUp){const g=f.value-2;y=g*25,g>0?m=`Flip ${f.protocol}-${f.value}: Enemy loses ${g} value`:g<0?m=`BAD: Flip ${f.protocol}-${f.value}: Enemy GAINS ${-g} value!`:m=`Neutral: Flip ${f.protocol}-${f.value}: No value change`;const v=n.lanes[h];v&&v.playerValue>=8&&(y+=40,m+=" [Near compile!]"),Hy(f)&&(y+=30,m+=" [Has dangerous effects]")}else{const g=Pm(t,f.id);if(g!==null){const v=g-2;v>0?(y=-v*20,m=`BAD: KNOWN card ${f.protocol}-${g}: Enemy gains ${v}!`):v<0?(y=-v*20,m=`GOOD: KNOWN card ${f.protocol}-${g}: Enemy loses ${-v}`):(y=10,m=`Neutral: KNOWN card ${f.protocol}-${g}: No change`)}else y=5,m="Reveal UNKNOWN enemy card (risky - might help them)"}else if(f.isFaceUp){const g=f.value-2;y=-g*30,m=`BAD: Flip own ${f.protocol}-${f.value}: We lose ${g} value`}else{const g=Pm(t,f.id),v=g!==null?g:f.value,C=v-2;C>0?(y=C*25+20,m=`Flip own card: Gain ${C} value (${v} - 2)`):C<0?(y=C*20,m=`BAD: Flip own card: LOSE ${-C} value`):(y=5,m="Neutral: Flip own card: No value change");const b=n.lanes[h];if(b&&!b.isCompiled){const x=b.ourValue-2+v;x>=10&&x>b.playerValue?(y+=150,m+=" [ENABLES COMPILE!]"):b.ourDistanceToCompile<=4&&(y+=30,m+=" [Near compile]")}}c.push({targetId:f.id,targetOwner:u,laneIndex:h,score:y,reasoning:m})}}return c.sort((u,p)=>p.score-u.score),c}function Xm(t,n,r,s){const c=[],d=r||{};for(const u of["player","opponent"]){if(d.owner==="own"&&u!=="opponent"||d.owner==="opponent"&&u!=="player")continue;const p=xs(t,u);for(const f of p){if(s&&f.id===s||d.faceState==="face_up"&&!f.isFaceUp||d.faceState==="face_down"&&f.isFaceUp)continue;const h=Mu(t,f.id),y=f.isFaceUp?f.value:2;let m=0,g="";if(u==="player"){m=y*25,g=`Delete ${f.isFaceUp?f.protocol+"-"+f.value:"face-down"}: Remove ${y} value`;const v=n.lanes[h];v&&(v.playerValue>=10&&v.playerValue>v.ourValue?(m+=100,g+=" [BLOCKS COMPILE!]"):v.playerValue>=8&&(m+=50,g+=" [Near compile]")),f.isFaceUp&&Hy(f)&&(m+=40,g+=" [Has dangerous effects]")}else{m=-y*30,g=`BAD: Delete own ${f.isFaceUp?f.protocol+"-"+f.value:"face-down"}: Lose ${y} value`;const v=n.lanes[h];v&&v.isCompiled&&(m+=50,g+=" [Lane already compiled]")}c.push({targetId:f.id,targetOwner:u,laneIndex:h,score:m,reasoning:g})}}return c.sort((u,p)=>p.score-u.score),c}function kC(t,n,r,s){const c=[],d=r||{};for(const u of["player","opponent"]){if(d.owner==="own"&&u!=="opponent"||d.owner==="opponent"&&u!=="player")continue;const p=xs(t,u);for(const f of p){if(s&&f.id===s)continue;const h=Mu(t,f.id),y=f.isFaceUp?f.value:2;let m=0,g="";if(u==="player"){m=y*20,g=`Return ${f.isFaceUp?f.protocol+"-"+f.value:"face-down"}: Remove ${y} value (to hand)`;const v=n.lanes[h];v&&(v.playerValue>=10&&v.playerValue>v.ourValue?(m+=80,g+=" [BLOCKS COMPILE!]"):v.playerValue>=8&&(m+=40,g+=" [Near compile]")),m+=15,g+=" [Tempo gain]"}else m=-y*20,g=`Return own ${f.isFaceUp?f.protocol+"-"+f.value:"face-down"}: Lose ${y} value (recoverable)`;c.push({targetId:f.id,targetOwner:u,laneIndex:h,score:m,reasoning:g})}}return c.sort((u,p)=>p.score-u.score),c}function RC(t,n,r,s,c){var y,m,g,v,C,b;const d=(y=t.params)==null?void 0:y.action,u=(m=t.params)==null?void 0:m.targetFilter,p=(u==null?void 0:u.owner)||"any",f=xs(n,"player"),h=xs(n,"opponent");switch(d){case"flip":return NC(p,f,h);case"delete":return TC(p,f,h,n);case"draw":return DC(((g=t.params)==null?void 0:g.count)||1,n);case"shift":return AC(p,f,h,n);case"return":return FC(p,f,h,n);case"discard":return((v=t.params)==null?void 0:v.actor)==="opponent"?(((C=t.params)==null?void 0:C.count)||1)*15:-(((b=t.params)==null?void 0:b.count)||1)*10;case"value_modifier":return 10;default:return 0}}function NC(t,n,r,s,c){if(t==="opponent"){if(n.length===0)return 0;const d=n.filter(u=>u.isFaceUp);return d.length>0?(d.sort((f,h)=>h.value-f.value)[0].value-2)*12:5}if(t==="own")return r.length===0?0:r.filter(u=>u.isFaceUp&&u.value<=1).length>0?15:-25;if(n.length>0){const d=n.filter(u=>u.isFaceUp&&u.value>=3);return d.length>0?(Math.max(...d.map(p=>p.value))-2)*10:5}return r.length>0?r.filter(u=>u.isFaceUp&&u.value===0).length>0?10:-30:0}function TC(t,n,r,s,c){if(t==="opponent"){if(n.length===0)return 0;let d=40;for(let u=0;u<3;u++)s.player.laneValues[u]>=10&&!s.player.compiled[u]?s.player.lanes[u].filter(f=>n.some(h=>h.id===f.id)).length>0&&(d=80):s.player.laneValues[u]>=8&&(d=Math.max(d,60));return d}if(t==="own")return r.length===0?0:-Math.min(...r.map(u=>u.isFaceUp?u.value:2))*8-20;if(n.length>0){let d=35;for(let u=0;u<3;u++)s.player.laneValues[u]>=8&&(d=Math.max(d,50));return d}return r.length>0?-Math.min(...r.map(u=>u.isFaceUp?u.value:2))*10-40:0}function DC(t,n){const s=n.opponent.hand.length-1,c=s+t;if(c>5){const d=c-5;return t*10-d*8}return s<=2?t*20:t*12}function AC(t,n,r,s,c){if(t==="opponent"){if(n.length===0)return 0;for(let d=0;d<3;d++)if(s.player.laneValues[d]>=8)return 35;return 20}if(t==="own"){if(r.length===0)return 0;for(let d=0;d<3;d++)if(!s.opponent.compiled[d]&&s.opponent.laneValues[d]>=6)return 25;return 5}return n.length>0?15:0}function FC(t,n,r,s,c){if(t==="opponent"){if(n.length===0)return 0;for(let d=0;d<3;d++)if(s.player.laneValues[d]>=8)return 40;return 25}return t==="own"?r.length===0?0:-20:n.length>0?20:r.length>0?-25:0}function IC(t,n,r,s){const c=t;if(!c.customEffects)return 0;let d=0;const u=[...c.customEffects.topEffects||[],...c.customEffects.middleEffects||[],...c.customEffects.bottomEffects||[]],p=["start","instant","on_play",void 0];for(const f of u){const h=f.trigger;if(h&&!p.includes(h))continue;const y=RC(f,n);d+=y}return d}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * NORMAL AI - Strategic AI that plays to win
 *
 * NEW ARCHITECTURE:
 * - Uses GameStateAnalyzer to understand the current situation
 * - Uses EffectEvaluator to score card effects contextually
 * - Uses Strategies to make decisions based on game phase
 * - 5% chance to make suboptimal moves for slight unpredictability
 */const xl=["delete","flip","shift","return","discard"],In=t=>{let n=12-t.value;return xl.some(r=>t.keywords[r])&&(n+=6),t.keywords.draw&&(n+=3),t.keywords.play&&(n+=8),t.keywords.prevent&&(n+=4),n},mu=(t,n,r)=>{let s;for(const d of r[n].lanes)if(d.some(u=>u.id===t.id)){s=d;break}if(!s)return 0;if(!t.isFaceUp)return s.some(u=>u.isFaceUp&&u.protocol==="Darkness"&&u.value===2)?4:2;let c=t.value*2.5;return t.top.length>0&&(c+=6),(t.bottom.includes("Start:")||t.bottom.includes("End:"))&&(c+=8),t.bottom.includes("covered:")&&(c+=5),xl.some(d=>t.keywords[d])&&(c+=4),c},cl=()=>Math.random()<.05,yu=t=>t+(Math.random()*4-2),ll=(t,n,r,s)=>{const c=r.position||"uncovered";return!(c==="uncovered"&&!n||c==="covered"&&n||r.faceState==="face_up"&&!t.isFaceUp||r.faceState==="face_down"&&t.isFaceUp||r.excludeSelf&&s&&t.id===s||r.valueRange&&(!t.isFaceUp||t.value<r.valueRange.min||t.value>r.valueRange.max)||r.valueEquals!==void 0&&(!t.isFaceUp||t.value!==r.valueEquals))},$C=t=>{var W,P,z,H;t=lx(t);const n=[],r=My(t),{gamePhase:s,threats:c,position:d,lanes:u,recommendedStrategy:p}=r,f=Py(t,"opponent");t.player.lanes.flat().length+t.opponent.lanes.flat().length;const h=s==="early",y=s==="mid",g=t.player.lanes.flat().length>0,v=c.playerCompiledCount,C=d.weHaveControl;c.playerHasControl;const b=d.lanesWeLeadIn;3-b-u.filter(A=>A.isTied&&!A.isCompiled).length;const x=t.useControlMechanic===!0,j=p==="control"&&x;c.playerCanCompile,c.playerCompileLanes[0],d.ourCompiledCount;const E=v===2,D=j||E&&x&&!C,L=EC(r),I=L.length>0?L[0].laneIndex:-1,F=(A,N)=>A.keywords.flip||A.keywords.delete||A.keywords.shift||A.keywords.return?t.player.lanes.flat().length>0||t.opponent.lanes.some((O,M)=>M!==N&&O.length>0)||t.opponent.lanes[N].length>0:!0,U=A=>A.keywords.draw?t.opponent.hand.length>=5:!1;for(const A of t.opponent.hand)for(let N=0;N<3;N++){const T=Cr(t,"opponent",N,!0,A.protocol),q=Cr(t,"opponent",N,!1,A.protocol);if(!T.allowed&&!q.allowed||t.opponent.compiled[N])continue;const O=t.player.laneValues[N]>=10&&t.player.laneValues[N]>t.opponent.laneValues[N]&&!t.player.compiled[N];if(O){const Z=Math.max(T.allowed?A.value:0,q.allowed?wn({...A,isFaceUp:!1},t.opponent.lanes[N]):0);if(t.opponent.laneValues[N]+Z<t.player.laneValues[N]&&!xl.some(xe=>A.keywords[xe]))continue}let M=!1;if(Ly(A)){let Z=0;for(let oe=0;oe<3;oe++)if(t.opponent.lanes[oe].length>0){if(oe===N)continue;Z++}Z===0&&(M=!0)}if(Ou(A)){const Z=t.opponent.laneValues[N],oe=Math.max(0,10-A.value);if(Z<oe)continue;const xe=Z+A.value,ye=t.player.laneValues[N];if(xe<=ye)continue}const Y=qy(t,"opponent",N);if(Y!==null){const Z=t.opponent.laneValues[N],oe=Z+A.value-Y,xe=oe>=10&&oe>t.player.laneValues[N],ye=Z-Y>=4;if(!xe&&!ye)continue}const X=O;let K=!1;if(Uy(A)){let Z=0;for(let oe=0;oe<3;oe++){const xe=t.opponent.lanes[oe];if(xe.length>0&&oe!==N){const ye=xe[xe.length-1],Ce=ye.isFaceUp?ye.value:2;Ce>Z&&(Z=Ce)}}A.value>=Z&&(K=!0)}let ne=T.allowed&&!f&&!K&&!M;if(ne){let Z=0,oe=`Play ${A.protocol}-${A.value} face-up in lane ${N}`;const xe=A.value,ye=t.opponent.laneValues[N]+xe;if(X)ye>t.player.laneValues[N]?(Z=180+ye*5,oe+=" [Blocks compile!]"):ye===t.player.laneValues[N]?(Z=160+ye*3,oe+=" [Blocks compile with tie!]"):(Z=-500,oe+=" [WASTE: Card goes to trash when player compiles!]");else{Z+=xe*10;const pe=t.player.lanes.flat().length+t.opponent.lanes.flat().length;if(pe===0&&xe>=4?(Z+=50,oe+=` [STRONG OPENING: ${xe}]`):pe<=2&&xe>=5&&(Z+=30,oe+=` [Early pressure: ${xe}]`),ye>=10&&ye>t.player.laneValues[N]&&!t.opponent.compiled[N])Z+=200,oe+=` [COMPILE: ${ye}]`;else if(ye>=8&&ye<10&&!t.opponent.compiled[N]){const ee=t.opponent.lanes[N].some(de=>de.isFaceUp&&de.protocol==="Darkness"&&de.value===2)?4:2;t.opponent.laneValues[N]+ee>=10&&ye<10?(Z-=50,oe+=` [Near ${ye} but face-down could compile!]`):(Z+=40,oe+=` [Near compile: ${ye}]`)}h&&xe<=2&&(Z-=50,oe+=" [Low value early game penalty]"),F(A,N)||(Z-=80,oe+=" [No valid targets for effect]"),U(A)&&(Z-=30,oe+=" [Draw would cause discard]");const _e=xl.some(ee=>A.keywords[ee]);if(_e&&g?y&&t.player.laneValues[N]>=5?(Z+=35,oe+=" [Disruption with targets]"):t.player.laneValues[N]>=8&&(Z+=50,oe+=" [Disruption near compile]"):_e&&!g&&(Z-=40,oe+=" [Disruption but no targets]"),I!==-1&&!D&&(N===I?(Z+=150,oe+=" [FOCUS LANE]"):(Z-=100,oe+=" [Not focus lane]")),D){const ee=t.opponent.laneValues[N]>t.player.laneValues[N],je=ye>t.player.laneValues[N],de=t.opponent.laneValues[N]===t.player.laneValues[N],Pe=E?1.5:1;if(ee)Z-=200*Pe,oe+=E?" [CRITICAL: ALREADY LEADING - FOCUS ELSEWHERE!]":" [ALREADY LEADING - DON'T WASTE!]";else if(!ee&&je)b===1?(Z+=500*Pe,oe+=E?" [CRITICAL: CONTROL CAPTURE WINS GAME!]":" [CONTROL CAPTURE! 1->2 leads]"):b===0?(Z+=300*Pe,oe+=E?" [CRITICAL: First lead toward control!]":" [First lead! 0->1 leads]"):(Z+=100,oe+=" [Extra lead]");else if(de&&je)b===1?(Z+=450*Pe,oe+=E?" [CRITICAL: BREAK TIE FOR CONTROL!]":" [BREAK TIE FOR CONTROL!]"):(Z+=250*Pe,oe+=" [Break tie]");else if(!ee&&!je&&b===1){const Ue=t.player.laneValues[N]-ye;Ue<=3?(Z+=200*Pe,oe+=E?` [CRITICAL: BUILD toward control, gap=${Ue}]`:` [BUILD toward 2nd lead, gap=${Ue}]`):Ue<=6?(Z+=150*Pe,oe+=` [BUILD toward 2nd lead, gap=${Ue}]`):(Z+=100*Pe,oe+=` [BUILD toward 2nd lead, gap=${Ue}]`)}}}const Ce=IC(A,t);Ce!==0&&(Z+=Ce,oe+=` [Effect: ${Ce>=0?"+":""}${Ce}]`),n.push({move:{type:"playCard",cardId:A.id,laneIndex:N,isFaceUp:!0},score:yu(Z),reason:oe})}if(q.allowed){const Z=wn({...A,isFaceUp:!1},t.opponent.lanes[N]),oe=t.opponent.laneValues[N]+Z,xe=t.opponent.laneValues[N],ye=A.value-Z;let Ce=-200-ye*30,pe=`Play ${A.protocol}-${A.value} face-down in lane ${N} (loses ${ye} value)`;!t.opponent.compiled[N]&&oe>=10&&oe>t.player.laneValues[N]?(Ce=300,pe=`Play ${A.protocol}-${A.value} face-down COMPILES lane ${N}: ${xe} -> ${oe}`):X&&oe>=t.player.laneValues[N]?(Ce=150,pe=`Play ${A.protocol}-${A.value} face-down BLOCKS compile in lane ${N}`):!t.opponent.compiled[N]&&xe>=8&&oe>=10&&oe>t.player.laneValues[N]?(Ce=250,pe=`Play ${A.protocol}-${A.value} face-down finishes compile: ${xe} -> ${oe}`):ne?X&&oe<t.player.laneValues[N]&&(Ce=-500,pe+=" [WASTE: Goes to trash when player compiles!]"):(Ce=-100,pe=`Play ${A.protocol}-${A.value} face-down (no face-up option)`),n.push({move:{type:"playCard",cardId:A.id,laneIndex:N,isFaceUp:!1},score:yu(Ce),reason:pe})}if(ml(t,A)&&!t.player.compiled[N]){const oe=uC(A)||pC(A);let xe=0,ye=`Play ${A.protocol}-${A.value} on OPPONENT's lane ${N}`;oe?(xe=A.value*8,xe+=50,ye+=" [SMART: Avoids harmful self-effect!]"):(xe=-100-A.value*10,ye+=" [Gives opponent value - usually bad]"),n.push({move:{type:"playCard",cardId:A.id,laneIndex:N,isFaceUp:!0,targetOwner:"player"},score:yu(xe),reason:ye})}}if(t.opponent.hand.length===0)n.push({move:{type:"fillHand"},score:500,reason:"Must refill - no cards"});else{const A=t.player.laneValues.some((q,O)=>q>=10&&q>t.opponent.laneValues[O]&&!t.player.compiled[O]),N=t.controlCardHolder==="opponent",T=t.player.compiled.some(q=>q);A&&N&&T&&n.push({move:{type:"fillHand"},score:200,reason:"Emergency draw to block compile with control swap"}),E&&A&&!N&&(n.length>0?Math.max(...n.map(O=>O.score)):-1e3)<100&&n.push({move:{type:"fillHand"},score:50,reason:"CRITICAL: Refresh to find better options vs opponent win threat"})}if(n.length===0)return{type:"fillHand"};n.sort((A,N)=>N.score-A.score);const B=A=>{if(A.type==="playCard"&&A.isFaceUp){const N=t.opponent.hand.find(q=>q.id===A.cardId);if(!N)return!1;const T=Cr(t,"opponent",A.laneIndex,!0,N.protocol);if(!T.allowed)return console.warn(`[AI Safety] Rejecting invalid face-up play: ${N.protocol}-${N.value} in lane ${A.laneIndex} - ${T.reason}`),!1}return!0};if(!(((P=(W=n[0])==null?void 0:W.reason)==null?void 0:P.includes("Blocks compile"))||((H=(z=n[0])==null?void 0:z.reason)==null?void 0:H.includes("BLOCK COMPILE")))&&cl()&&n.length>1&&n[1].score>0&&B(n[1].move))return n[1].move;for(const A of n)if(B(A.move))return A.move;return console.warn("[AI Safety] No valid moves found, falling back to fillHand"),{type:"fillHand"}},PC=(t,n)=>{var s,c,d,u,p,f,h,y;const r=My(t);switch(n.type){case"prompt_use_control_mechanic":{const m=t.player.compiled.filter(x=>x).length,g=t.opponent.compiled.filter(x=>x).length,v=t.compilableLanes.length>0?t.compilableLanes[0]:null;if(g===2&&v!==null&&t.opponent.compiled[v])return{type:"resolveControlMechanicPrompt",choice:"opponent"};let C=-1;for(let x=0;x<3;x++)if(!t.player.compiled[x]&&t.player.laneValues[x]>=10&&t.player.laneValues[x]>t.opponent.laneValues[x]){C=x;break}const b=t.player.compiled.map((x,j)=>x?j:-1).filter(x=>x!==-1);return C!==-1&&b.length>0?{type:"resolveControlMechanicPrompt",choice:"player"}:m===0?Vc(t,v)&&!cl()?{type:"resolveControlMechanicPrompt",choice:"opponent"}:{type:"resolveControlMechanicPrompt",choice:"skip"}:Iy(t,v)?{type:"resolveControlMechanicPrompt",choice:"player"}:Vc(t,v)&&!cl()?{type:"resolveControlMechanicPrompt",choice:"opponent"}:{type:"resolveControlMechanicPrompt",choice:"skip"}}case"discard":return{type:"discardCards",cardIds:[...t.opponent.hand].sort((g,v)=>{const C=xl.some(x=>g.keywords[x]),b=xl.some(x=>v.keywords[x]);return C&&!b?1:!C&&b?-1:In(g)-In(v)}).slice(0,n.count).map(g=>g.id)};case"discard_completed":return{type:"skip"};case"select_opponent_card_to_flip":{const g=(C=>t[C].lanes.map(b=>b.length>0?b[b.length-1]:null).filter(b=>b!==null))("player");if(g.length===0)return{type:"skip"};const v=g.map(C=>({cardId:C.id,score:C.isFaceUp?C.value+5:3}));return v.sort((C,b)=>b.score-C.score),{type:"flipCard",cardId:v[0].cardId}}case"select_cards_to_delete":{const m=n.disallowedIds||[],g=n.allowedIds,v=n.targetFilter??{},C="actorChooses"in n?n.actorChooses:"effect_owner",b=n.sourceCardId,x=(v==null?void 0:v.position)||"uncovered";if(g&&g.length>0){const k=D=>{for(const L of["player","opponent"])for(const I of t[L].lanes)for(let F=0;F<I.length;F++)if(I[F].id===D)return{card:I[F],owner:L,isUncovered:F===I.length-1};return null},R=g.map(D=>({id:D,info:k(D)})).filter(({info:D})=>D!==null).filter(({info:D})=>x==="any"?!0:x==="uncovered"?D.isUncovered:x==="covered"?!D.isUncovered:!0).filter(({id:D})=>!m.includes(D));if(R.length>0){const D=R.filter(({info:I})=>I.owner==="player");if(D.length>0)return D.sort((I,F)=>F.info.card.value-I.info.card.value),{type:"deleteCard",cardId:D[0].id};const L=R.filter(({info:I})=>I.owner==="opponent");if(L.length>0)return L.sort((I,F)=>I.info.card.value-F.info.card.value),{type:"deleteCard",cardId:L[0].id}}return{type:"skip"}}if(C==="card_owner"&&(v==null?void 0:v.owner)==="opponent"){const k=[];return t.opponent.lanes.forEach(R=>{if(R.length>0){const D=R[R.length-1];if(ll(D,!0,v,b)){if(g&&!g.includes(D.id))return;k.push(D)}}}),k.length>0?(k.sort((R,D)=>R.value-D.value),{type:"deleteCard",cardId:k[0].id}):{type:"skip"}}const j=k=>t[k].lanes.map(R=>R.length>0?R[R.length-1]:null).filter(R=>R!==null).filter(R=>ll(R,!0,v,b)).filter(R=>!g||g.includes(R.id)),E=v==null?void 0:v.owner;if(E==="own"){const k=j("opponent").filter(R=>!m.includes(R.id));if(k.length>0)return{type:"deleteCard",cardId:k.sort((D,L)=>D.value-L.value)[0].id}}else if(E==="opponent"){const k=j("player").filter(R=>!m.includes(R.id));if(k.length>0){const R=Xm(t,r,{owner:"opponent"},b),D=new Set(k.map(I=>I.id)),L=R.filter(I=>D.has(I.targetId));return L.length>0?{type:"deleteCard",cardId:L[0].targetId}:{type:"deleteCard",cardId:k[0].id}}}else{const k=j("player").filter(D=>!m.includes(D.id));if(k.length>0){const D=Xm(t,r,void 0,b),L=new Set(k.map(F=>F.id)),I=D.filter(F=>L.has(F.targetId));return I.length>0?{type:"deleteCard",cardId:I[0].targetId}:{type:"deleteCard",cardId:k[0].id}}const R=j("opponent").filter(D=>!m.includes(D.id));if(R.length>0)return{type:"deleteCard",cardId:R.sort((L,I)=>L.value-I.value)[0].id}}return{type:"skip"}}case"select_any_card_to_flip":case"select_any_other_card_to_flip":case"select_any_face_down_card_to_flip_optional":case"select_any_card_to_flip_optional":{const m=za(t),g=n.targetFilter,v=n.sourceCardId;g!=null&&g.position;const C=n.actor,b=n.currentLaneIndex??n.laneIndex,x=n.scope,j=[];for(const D of["player","opponent"])if(!(g&&(g.owner==="own"&&D!==C||g.owner==="opponent"&&D===C)))for(let L=0;L<t[D].lanes.length;L++){if(b!==void 0&&L!==b||x==="this_lane"&&b!==void 0&&L!==b)continue;const I=t[D].lanes[L];if(I.length!==0)for(let F=0;F<I.length;F++){const U=I[F],B=F===I.length-1;if(g){if(!ll(U,B,g,v))continue}else if(!B)continue;m&&!U.isFaceUp||j.push({card:U,owner:D})}}if(j.length===0)return{type:"skip"};const E=jC(t,r,g,v),k=new Set(j.map(D=>D.card.id)),R=E.filter(D=>k.has(D.targetId));return R.length>0?{type:"flipCard",cardId:R[0].targetId}:{type:"flipCard",cardId:j[0].card.id}}case"select_card_from_hand_to_play":{if(t.opponent.hand.length===0)return{type:"skip"};const m=n.faceDown===!0,g=n.selectableCardIds,v=g?t.opponent.hand.filter(E=>g.includes(E.id)):t.opponent.hand;if(v.length===0)return{type:"skip"};const C=n.forcedLaneIndex;let b;if(C!==void 0?b=[C]:b=n.validLanes||[0,1,2].filter(E=>E!==n.disallowedLaneIndex),b=b.filter(E=>{const k=t.player.lanes[E],R=k.length>0?k[k.length-1]:null;return!(R&&R.isFaceUp&&R.protocol==="Plague"&&R.value===0)}),b.length===0)return{type:"skip"};const x=[];for(const E of v)for(const k of b){if(!m){const L=t.opponent.lanes.flat().some(G=>G.isFaceUp&&G.protocol==="Spirit"&&G.value===1),I=((c=(s=E.customEffects)==null?void 0:s.bottomEffects)==null?void 0:c.some(G=>{var W,P;return((W=G.params)==null?void 0:W.action)==="card_property"&&((P=G.params)==null?void 0:P.property)==="ignore_protocol_matching"}))||((u=(d=E.customEffects)==null?void 0:d.topEffects)==null?void 0:u.some(G=>{var W,P;return((W=G.params)==null?void 0:W.action)==="card_property"&&((P=G.params)==null?void 0:P.property)==="ignore_protocol_matching"}))||((f=(p=E.customEffects)==null?void 0:p.middleEffects)==null?void 0:f.some(G=>{var W,P;return((W=G.params)==null?void 0:W.action)==="card_property"&&((P=G.params)==null?void 0:P.property)==="ignore_protocol_matching"})),F=[...t.player.lanes.flat(),...t.opponent.lanes.flat()].some(G=>G.isFaceUp&&G.protocol==="Anarchy"&&G.value===1),U=Cl(t,"opponent",k,E.protocol);let B;if(F?B=E.protocol!==t.opponent.protocols[k]&&E.protocol!==t.player.protocols[k]:B=E.protocol===t.opponent.protocols[k]||E.protocol===t.player.protocols[k]||L||I||U,B){const G=E.value,W=t.opponent.laneValues[k]+G;let P=In(E)+G*2;W>=10&&W>t.player.laneValues[k]&&(P+=100);const z=t.player.laneValues[k],H=t.player.compiled[k],A=t.opponent.compiled[k],N=t.opponent.laneValues[k];!H&&!A&&z>=10&&z>N&&W>=z&&(P+=160),x.push({cardId:E.id,laneIndex:k,isFaceUp:!0,score:P})}}if(!t.player.lanes[k].some(L=>L.isFaceUp&&L.protocol==="Metal"&&L.value===2)){const L=wn({...E,isFaceUp:!1},t.opponent.lanes[k]),I=t.opponent.laneValues[k]+L;let F=L*2;I>=10&&I>t.player.laneValues[k]&&(F+=80);const U=t.player.laneValues[k],B=t.player.compiled[k],G=t.opponent.compiled[k],W=t.opponent.laneValues[k];!B&&!G&&U>=10&&U>W&&I>=U&&(F+=150),x.push({cardId:E.id,laneIndex:k,isFaceUp:!1,score:F})}}if(x.length===0)return{type:"skip"};x.sort((E,k)=>k.score-E.score);const j=x[0];return{type:"playCard",cardId:j.cardId,laneIndex:j.laneIndex,isFaceUp:j.isFaceUp}}case"select_card_from_hand_to_give":return t.opponent.hand.length===0?{type:"skip"}:{type:"giveCard",cardId:[...t.opponent.hand].sort((g,v)=>In(g)-In(v))[0].id};case"select_card_from_hand_to_reveal":return t.opponent.hand.length===0?{type:"skip"}:{type:"revealCard",cardId:[...t.opponent.hand].sort((g,v)=>In(v)-In(g))[0].id};case"select_card_to_return":case"select_opponent_card_to_return":{const g={position:"uncovered",...n.targetFilter||{}},v=n.targetOwner||g.owner,C=n.sourceCardId;g!=null&&g.position;const b=n.actor,x=[];for(const L of["player","opponent"])if(!(v==="own"&&L!==b)&&!(v==="opponent"&&L===b))for(const I of t[L].lanes)for(let F=0;F<I.length;F++){const U=I[F],B=F===I.length-1;ll(U,B,g,C)&&x.push({card:U,owner:L})}if(x.length===0)return{type:"skip"};const j=kC(t,r,g,C),E=new Set(x.map(L=>L.card.id)),k=j.filter(L=>E.has(L.targetId));if(k.length>0)return{type:"returnCard",cardId:k[0].targetId};const R=x.filter(L=>L.owner==="player"),D=x.filter(L=>L.owner==="opponent");return R.length>0?(R.sort((L,I)=>mu(I.card,"player",t)-mu(L.card,"player",t)),{type:"returnCard",cardId:R[0].card.id}):D.length>0?(D.sort((L,I)=>L.card.value-I.card.value),{type:"returnCard",cardId:D[0].card.id}):{type:"returnCard",cardId:x[0].card.id}}case"select_lane_for_play":{let m=n.validLanes||[0,1,2];m=m.filter(x=>!("disallowedLaneIndex"in n)||x!==n.disallowedLaneIndex),n.excludeCurrentLane&&n.currentLaneIndex!==void 0&&(m=m.filter(x=>x!==n.currentLaneIndex));const v=(n.actor||"opponent")==="opponent"?t.opponent:t.player;if(m=m.filter(x=>{const j=v.lanes[x],E=j.length>0?j[j.length-1]:null,k=E&&E.isFaceUp&&E.protocol==="Plague"&&E.value===0,R="isFaceDown"in n&&n.isFaceDown&&j.some(D=>D.isFaceUp&&D.protocol==="Metal"&&D.value===2);return!k&&!R}),m.length===0)return{type:"skip"};const C=m.filter(x=>{const j=t.player.laneValues[x],E=t.opponent.laneValues[x],k=t.player.compiled[x],R=t.opponent.compiled[x],D=!k&&j>=10&&j>E,L=E+2>=j;return D&&L&&!R});if(C.length>0)return C.sort((x,j)=>t.player.laneValues[j]-t.player.laneValues[x]),{type:"selectLane",laneIndex:C[0]};const b=m.map(x=>{const j=t.opponent.laneValues[x]-t.player.laneValues[x];return{laneIndex:x,score:-j}});return b.sort((x,j)=>j.score-x.score),{type:"selectLane",laneIndex:b[0].laneIndex}}case"prompt_rearrange_protocols":return $y(t,n);case"prompt_swap_protocols":{const{target:m}=n,g=t[m].protocols,v=t[m].hand,C=t[m].compiled,b=t[m].laneValues,x=[[0,1],[0,2],[1,2]];let j=[0,1],E=-1/0;for(const k of x){const[R,D]=k,L=[...g];[L[R],L[D]]=[L[D],L[R]];let I=0;const F=C[R],U=C[D],B=b[R],G=b[D];if(m==="opponent"){F&&!U?G<B&&(I+=30):U&&!F&&B<G&&(I+=30);for(const W of v){const P=W.protocol===g[R],z=W.protocol===g[D],H=W.protocol===L[R],A=W.protocol===L[D],N=F?.5:1.5,T=U?.5:1.5;H&&!P&&(I+=In(W)*N),A&&!z&&(I+=In(W)*T),!H&&P&&(I-=In(W)*N),!A&&z&&(I-=In(W)*T)}}else{F&&!U?B>G&&(I+=25):U&&!F&&G>B&&(I+=25);for(const W of v){const P=W.protocol===g[R],z=W.protocol===g[D],H=W.protocol===L[R],A=W.protocol===L[D],N=F?.5:1.5,T=U?.5:1.5;H&&!P&&(I-=In(W)*N),A&&!z&&(I-=In(W)*T),!H&&P&&(I+=In(W)*N),!A&&z&&(I+=In(W)*T)}}I>E&&(E=I,j=k)}return{type:"resolveSwapProtocols",indices:j}}case"select_lane_for_shift":{let m=n.validLanes||[0,1,2];if(m=m.filter(g=>!("disallowedLaneIndex"in n)||g!==n.disallowedLaneIndex).filter(g=>!("originalLaneIndex"in n)||g!==n.originalLaneIndex),"sourceCardId"in n){const g=[...t.player.lanes.flat(),...t.opponent.lanes.flat()].find(v=>v.id===n.sourceCardId);if(g&&g.protocol==="Gravity"&&g.value===1){let v=null;for(let C=0;C<3;C++)if([...t.player.lanes[C],...t.opponent.lanes[C]].some(x=>x.id===n.sourceCardId)){v=C;break}v!==null&&"originalLaneIndex"in n&&(n.originalLaneIndex===v||(m=[v]))}if(g&&g.protocol==="Anarchy"&&g.value===1){const v="cardToShiftId"in n?n.cardToShiftId:null;if(v){const C=[...t.player.lanes.flat(),...t.opponent.lanes.flat()].find(b=>b.id===v);C&&(m=m.filter(b=>{const x=t.player.protocols[b],j=t.opponent.protocols[b],E=C.protocol;return E!==x&&E!==j}))}}}if(m.length>0){const g="cardToShiftId"in n?n.cardToShiftId:null;let v=null,C=0;if(g)for(const x of["player","opponent"]){for(const j of t[x].lanes){const E=j.find(k=>k.id===g);if(E){v=x,C=E.isFaceUp?E.value:2;break}}if(v)break}const b=m.map(x=>{let j=0;const E=t.player.laneValues[x],k=t.opponent.laneValues[x],R=t.player.compiled[x],D=t.opponent.compiled[x];return v==="player"?R?j+=100:k>E?j+=50:E>=6&&E<10&&!R&&(j-=50):v==="opponent"&&(!D&&k<10?k+C>=10?j+=100:k>=6?j+=60:j+=30:D&&(j-=50)),{laneIdx:x,score:j}});if(b.sort((x,j)=>j.score-x.score),cl()&&b.length>1){const x=Math.floor(Math.random()*b.length);return{type:"selectLane",laneIndex:b[x].laneIdx}}return{type:"selectLane",laneIndex:b[0].laneIdx}}return{type:"selectLane",laneIndex:0}}case"select_lane_for_delete_all":{const m="validLanes"in n?n.validLanes:[0,1,2];if(m.length===0)return{type:"skip"};let g=m[0],v=-1/0;for(const C of m){const b=t.opponent.laneValues[C],j=t.player.laneValues[C]-b;j>v&&(v=j,g=C)}return{type:"selectLane",laneIndex:g}}case"select_lanes_for_swap_stacks":{const m=n.validLanes,g=n.selectedFirstLane;if(m.length===0)return{type:"skip"};if(g===void 0){const v=m.map(C=>{const b=t.opponent.laneValues[C];return{laneIdx:C,score:b}});return v.sort((C,b)=>C.score-b.score),{type:"selectLane",laneIndex:v[0].laneIdx}}else{const v=m.map(C=>{const b=t.opponent.laneValues[C];return{laneIdx:C,score:b}});return v.sort((C,b)=>b.score-C.score),{type:"selectLane",laneIndex:v[0].laneIdx}}}case"select_card_for_copy_middle":{const m=n.validTargetIds||[];if(m.length===0)return{type:"skip"};const g=m.map(v=>{var b,x;let C=0;for(const j of["player","opponent"])for(const E of t[j].lanes){const k=E.find(R=>R.id===v);if(k){const D=((b=k.customEffects)==null?void 0:b.middleEffects)||[];for(const L of D){const I=(x=L.params)==null?void 0:x.action;I==="draw"&&(C+=5),I==="flip"&&(C+=3),I==="delete"&&(C+=4),I==="shift"&&(C+=2),I==="discard"&&(C-=2)}}}return{cardId:v,score:C}});return g.sort((v,C)=>C.score-v.score),{type:"selectCard",cardId:g[0].cardId}}case"select_lane_for_return":{const m=n.targetFilter||{},g=n.actor,v=m.valueEquals,C=m.valueRange,b=[];for(let x=0;x<3;x++){let j=0,E=0;const k=Oy(t,x);for(const L of["player","opponent"]){if(m.owner==="own"&&L!==g||m.owner==="opponent"&&L===g)continue;const I=t[L].lanes[x];for(let F=0;F<I.length;F++){const U=I[F],B=F===I.length-1;if(m.position==="uncovered"&&!B||m.position==="covered"&&B)continue;const G=U.isFaceUp?U.value:2+k;v!==void 0&&G!==v||C&&(G<C.min||G>C.max)||(L==="player"?j+=G:E+=G)}}const R=j-E,D=`Lane ${x}: Player loses ${j}, we lose ${E}, net=${R}`;b.push({laneIndex:x,score:R,reason:D})}b.sort((x,j)=>j.score-x.score);for(const x of b);return b.length>0?{type:"selectLane",laneIndex:b[0].laneIndex}:{type:"selectLane",laneIndex:0}}case"prompt_optional_effect":{const{effectDef:m}=n,g=(h=m==null?void 0:m.params)==null?void 0:h.action,v=(y=m==null?void 0:m.params)==null?void 0:y.targetFilter;if(g==="give")return{type:"resolveOptionalEffectPrompt",accept:!1};if(g==="flip"){let C=!1;const b=(v==null?void 0:v.position)||"uncovered";for(const x of["player","opponent"])if(!((v==null?void 0:v.owner)==="own"&&x!=="opponent")&&!((v==null?void 0:v.owner)==="opponent"&&x==="opponent")){for(let j=0;j<t[x].lanes.length;j++){const E=t[x].lanes[j];if(E.length!==0){for(let k=0;k<E.length;k++){const R=E[k],D=k===E.length-1,L=!D;if(b==="uncovered"&&!D||b==="covered"&&!L||(v==null?void 0:v.faceState)==="face_up"&&!R.isFaceUp||(v==null?void 0:v.faceState)==="face_down"&&R.isFaceUp)continue;const I=R.isFaceUp?R.value:2,F=R.isFaceUp?2:R.value;if(x==="player"){if(R.isFaceUp&&I>F){C=!0;break}}else{const U=t.opponent.laneValues[j],B=F-I;if(R.isFaceUp&&B>0){C=!0;break}if(!R.isFaceUp&&R.value>2){C=!0;break}if(B>0&&U+B>=10&&!t.opponent.compiled[j]){C=!0;break}}}if(C)break}}if(C)break}return{type:"resolveOptionalEffectPrompt",accept:C}}return{type:"resolveOptionalEffectPrompt",accept:!cl()}}case"select_card_from_other_lanes_to_delete":{const{disallowedLaneIndex:m,lanesSelected:g}=n,v=[];for(let C=0;C<3;C++){if(C===m||g.includes(C))continue;const b=t.player.lanes[C];if(b.length>0){const j=b[b.length-1],E=j.isFaceUp?j.value:Math.min(j.value,2);v.push({cardId:j.id,score:E+100})}const x=t.opponent.lanes[C];if(x.length>0){const j=x[x.length-1],E=j.isFaceUp?j.value:Math.min(j.value,2);v.push({cardId:j.id,score:-E})}}return v.length>0?(v.sort((C,b)=>b.score-C.score),{type:"deleteCard",cardId:v[0].cardId}):{type:"skip"}}case"select_face_down_card_to_delete":{const m="disallowedIds"in n&&Array.isArray(n.disallowedIds)?n.disallowedIds:[],g=b=>t[b].lanes.map(x=>x.length>0?x[x.length-1]:null).filter(x=>x!==null&&!x.isFaceUp),v=g("player").filter(b=>!m.includes(b.id));if(v.length>0){const b=v.map(x=>{const j=t.player.lanes.findIndex(k=>k.some(R=>R.id===x.id)),E=t.player.laneValues[j]||0;return{cardId:x.id,score:E}});return b.sort((x,j)=>j.score-x.score),{type:"deleteCard",cardId:b[0].cardId}}const C=g("opponent").filter(b=>!m.includes(b.id));return C.length>0?(C.sort((b,x)=>b.value-x.value),{type:"deleteCard",cardId:C[0].id}):{type:"skip"}}case"select_low_value_card_to_delete":{const m=[];for(const g of["player","opponent"])for(let v=0;v<3;v++){const C=t[g].lanes[v];if(C.length>0){const b=C[C.length-1];if(b.isFaceUp&&(b.value===0||b.value===1)){const x=g==="player",j=t[g].laneValues[v],E=x?100+j:-j;m.push({cardId:b.id,score:E})}}}return m.length>0?(m.sort((g,v)=>v.score-g.score),{type:"deleteCard",cardId:m[0].cardId}):{type:"skip"}}case"select_opponent_face_up_card_to_flip":{const g=(v=>t[v].lanes.map(C=>C.length>0?C[C.length-1]:null).filter(C=>C!==null))("player").filter(v=>v.isFaceUp);return g.length>0?(g.sort((v,C)=>C.value-v.value),{type:"flipCard",cardId:g[0].id}):{type:"skip"}}case"select_covered_card_in_line_to_flip_optional":{const m="optional"in n&&n.optional,v=!["select_any_other_card_to_flip","select_any_other_card_to_flip_for_water_0"].includes(n.type);if(n.type==="select_covered_card_in_line_to_flip_optional"){const{laneIndex:k}=n,R=t.opponent.lanes[k],D=t.player.lanes[k],L=R.filter((P,z,H)=>z<H.length-1),I=D.filter((P,z,H)=>z<H.length-1),F=t.opponent.laneValues[k];if(!t.opponent.compiled[k]){let P=null,z=null;for(const H of L){let A,N;H.isFaceUp?(A=H.value,N=2):(A=wn(H,R,t,k,"opponent"),N=H.value);const T=N-A,q=F+T;T>0&&q>=10&&(!P||q>P.newValue)&&(P={card:H,newValue:q,gain:T}),T>0&&(!z||T>z.gain)&&(z={card:H,gain:T,newValue:q})}if(P)return{type:"flipCard",cardId:P.card.id};if(z&&z.gain>0)return{type:"flipCard",cardId:z.card.id}}if(t.opponent.compiled[k]){let P=null;for(const z of L){const H=z.isFaceUp?z.value:wn(z,R,t,k,"opponent"),N=(z.isFaceUp?2:z.value)-H;N>0&&(!P||N>P.gain)&&(P={card:z,gain:N})}if(P)return{type:"flipCard",cardId:P.card.id}}const B=I.filter(P=>P.isFaceUp);if(B.length>0)return B.sort((P,z)=>z.value-P.value),{type:"flipCard",cardId:B[0].id};const G=L.filter(P=>!P.isFaceUp).map(P=>({card:P,gain:P.value-wn(P,R,t,k,"opponent")})).filter(P=>P.gain>0).sort((P,z)=>z.gain-P.gain);if(G.length>0)return{type:"flipCard",cardId:G[0].card.id};const W=I.filter(P=>!P.isFaceUp);return W.length>0?{type:"flipCard",cardId:W[0].id}:{type:"skip"}}const C=k=>t[k].lanes.map(R=>R.length>0?R[R.length-1]:null).filter(R=>R!==null),b=C("player"),x=C("opponent");{const k=b.filter(R=>R.isFaceUp).sort((R,D)=>D.value-R.value);if(k.length>0)return{type:"flipCard",cardId:k[0].id}}const j=x.filter(k=>!k.isFaceUp);if(j.length>0)return{type:"flipCard",cardId:j[0].id};const E=b.filter(k=>!k.isFaceUp);if(E.length>0)return{type:"flipCard",cardId:E[0].id};{const k=x.filter(D=>!(!D.isFaceUp||!v&&D.id===n.sourceCardId)),R=k.filter(D=>{const L=t.opponent.lanes.findIndex(I=>I.length>0&&I[I.length-1].id===D.id);return L!==-1&&t.opponent.compiled[L]});if(R.length>0&&!m)return{type:"flipCard",cardId:R[0].id};if(k.length>0&&!m)return{type:"flipCard",cardId:k[0].id}}return{type:"skip"}}case"shift_flipped_card_optional":{const m=n.cardId,g=n.optional,v=Ie(t,m);if(!v)return{type:"skip"};const C=v.card,b=v.owner,x=C.isFaceUp?C.value:2;let j=v.laneIndex??-1;if(j===-1){const W=t[b];for(let P=0;P<W.lanes.length;P++)if(W.lanes[P].some(z=>z.id===m)){j=P;break}}if(j===-1)return{type:"skip"};const E=[0,1,2].filter(W=>W!==j);if(E.length===0)return{type:"skip"};const k=t.opponent,R=t.player,D=k.laneValues[j],L=k.compiled[j],I=R.laneValues[j],F=D-x;let U=-1,B=-1/0;const G=0;for(const W of E){const P=k.laneValues[W],z=k.compiled[W],H=R.laneValues[W],A=P+x;let N=0;!L&&D>=8&&D>I&&(N-=100),!z&&A>=10&&A>H&&(N+=80),!z&&P<D&&(L||D<6)&&(N+=20),z&&(N-=30),!z&&P<=H&&A>H&&(N+=25),!L&&D>I&&F<=I&&(N-=40),N>B&&(B=N,U=W)}return g&&B<G?{type:"skip"}:U!==-1?{type:"selectLane",laneIndex:U}:g?{type:"skip"}:{type:"selectLane",laneIndex:E[0]}}case"select_lane_to_shift_revealed_card_for_light_2":case"select_lane_to_shift_revealed_card":{const m=n.revealedCardId,g=Ie(t,m);if(!g)return{type:"selectLane",laneIndex:0};let v=-1;for(let b=0;b<t[g.owner].lanes.length;b++)if(t[g.owner].lanes[b].some(x=>x.id===m)){v=b;break}const C=[0,1,2].filter(b=>b!==v);return C.length>0?(g.owner==="opponent"?C.sort((b,x)=>{const j=t.opponent.laneValues[b],E=t.opponent.laneValues[x];return!t.opponent.compiled[b]&&t.opponent.compiled[x]?-1:t.opponent.compiled[b]&&!t.opponent.compiled[x]?1:E-j}):C.sort((b,x)=>t.player.laneValues[b]-t.player.laneValues[x]),{type:"selectLane",laneIndex:C[0]}):{type:"selectLane",laneIndex:0}}case"select_opponent_face_down_card_to_shift":{const m=[];for(let g=0;g<3;g++){const v=t.player.lanes[g];if(v.length>0){const C=v[v.length-1];if(!C.isFaceUp){const b=t.player.laneValues[g];m.push({cardId:C.id,laneValue:b})}}}return m.length>0?(m.sort((g,v)=>v.laneValue-g.laneValue),{type:"deleteCard",cardId:m[0].cardId}):{type:"skip"}}case"select_opponent_covered_card_to_shift":{const m=[];for(let g=0;g<3;g++){const v=t.player.lanes[g],C=t.player.laneValues[g];for(let b=0;b<v.length-1;b++){const x=v[b],j=x.isFaceUp?x.value:Math.min(x.value,2);m.push({cardId:x.id,score:j+C})}}return m.length>0?(m.sort((g,v)=>v.score-g.score),{type:"deleteCard",cardId:m[0].cardId}):{type:"skip"}}case"select_own_covered_card_to_shift":{const m=[];for(let g=0;g<3;g++){const v=t.opponent.lanes[g],C=t.opponent.laneValues[g];for(let b=0;b<v.length-1;b++){const x=v[b],E=(x.isFaceUp?x.value:Math.min(x.value,2))-C*.5;m.push({cardId:x.id,score:E})}}return m.length>0?(m.sort((g,v)=>v.score-g.score),{type:"deleteCard",cardId:m[0].cardId}):{type:"skip"}}case"select_card_to_flip":{const m=n.targetFilter||{},g=n.restrictedLaneIndex??n.currentLaneIndex??n.laneIndex,v=n.scope,C=n.actor,b=n.sourceCardId;m!=null&&m.position;const x=[];for(const E of["player","opponent"])if(!(m.owner==="own"&&E!==C)&&!(m.owner==="opponent"&&E===C))for(let k=0;k<t[E].lanes.length;k++){if(g!==void 0&&k!==g||v==="this_lane"&&g!==void 0&&k!==g)continue;const R=t[E].lanes[k];for(let D=0;D<R.length;D++){const L=R[D];if(Ko(t,L.id))continue;const I=Jo(t,R,D);if(ll(L,I,m,b)&&!(m.position==="covered_in_this_line"&&I)){if(m.valueMinGreaterThanHandSize){const F=t[C].hand.length;if(L.value<=F)continue}if(m.valueLessThanUniqueProtocolsOnField){const F=Er(t);if(L.value>=F)continue}x.push({card:L,owner:E,laneIndex:k})}}}if(x.length===0)return{type:"skip"};const j=x.map(({card:E,owner:k,laneIndex:R})=>{let D=0;const L=t[k].laneValues[R],I=t[k].compiled[R],F=E.isFaceUp?E.value:2,B=(E.isFaceUp?2:E.value)-F;return k==="player"?E.isFaceUp?(D=-B*15,D+=mu(E,"player",t)):E.value<=1?D=20:D=-30:E.isFaceUp?B>0?(D=B*20+50,!I&&L+B>=10&&(D+=200)):D=B*15-30:B>0?(D=B*20+40,!I&&L+B>=10&&(D+=200)):D=-10,{card:E,score:D}});if(j.sort((E,k)=>k.score-E.score),cl()&&j.length>1){const E=Math.floor(Math.random()*j.length);return{type:"flipCard",cardId:j[E].card.id}}return{type:"flipCard",cardId:j[0].card.id}}case"select_card_to_shift":{const m=n.targetFilter||{},g=n.scope,v=n.destinationRestriction,C=n.targetLaneIndex,b=g==="this_lane"?n.sourceLaneIndex??n.currentLaneIndex??n.laneIndex:void 0,x=n.actor,j=n.sourceCardId,E=[];for(const k of["player","opponent"])if(!(m.owner==="own"&&k!==x)&&!(m.owner==="opponent"&&k===x))for(let R=0;R<t[k].lanes.length;R++){if(b!==void 0&&R!==b||(v==null?void 0:v.type)==="to_this_lane"&&C!==void 0&&R===C)continue;const D=t[k].lanes[R],L=t[k].laneValues[R];for(let I=0;I<D.length;I++){const F=D[I],U=I===D.length-1;if(!ll(F,U,m,j))continue;const B=F.isFaceUp?F.value:Math.min(F.value,2),G=k==="player";let W;const P=C??-1,z=P>=0?t.opponent.laneValues[P]:0,H=P>=0?t.player.laneValues[P]:0,A=P>=0?t.opponent.compiled[P]:!1,N=P>=0?t.player.compiled[P]:!1;G?P>=0?!N&&H+B>=10&&H+B>z?W=-1e3:N?W=B+100:W=B+L:W=B+L:P>=0?!A&&z+B>=10&&z+B>H?W=1e3+B:A?W=-100:W=B+z*.5:W=B-L*.5,E.push({cardId:F.id,score:W})}}return E.length>0?(E.sort((k,R)=>R.score-k.score),{type:"shiftCard",cardId:E[0].cardId}):{type:"skip"}}case"select_board_card_to_reveal_custom":{const m=[];for(const g of["player","opponent"])for(const v of t[g].lanes)if(v.length>0){const C=v[v.length-1];C.isFaceUp||m.push({card:C,owner:g})}if(m.length>0){const g=m.filter(v=>v.owner==="player");return g.length>0?{type:"deleteCard",cardId:g[0].card.id}:{type:"deleteCard",cardId:m[0].card.id}}return{type:"skip"}}case"prompt_shift_or_flip_board_card_custom":{const{revealedCardId:m}=n,g=Ie(t,m);if(!g)return{type:"resolveRevealBoardCardPrompt",choice:"skip"};const v=g.card,C=g.owner==="opponent",b=v.isFaceUp?v.value:Math.min(v.value,2),j=(v.isFaceUp?Math.min(v.value,2):v.value)-b;let E=0;C?E=j*20:E=-j*20;let k=-50;const R=v.isFaceUp?v.value:Math.min(v.value,2);if(C)for(let D=0;D<3;D++){const L=t.opponent.laneValues[D],I=t.player.laneValues[D],F=L+R;F>=10&&F>I?k=Math.max(k,100):F>I&&(k=Math.max(k,20))}else for(let D=0;D<3;D++)t.player.laneValues[D]+R>=10&&(k=Math.min(k,-100));return E>=k?{type:"resolveRevealBoardCardPrompt",choice:"flip"}:{type:"resolveRevealBoardCardPrompt",choice:"shift"}}case"select_lane_to_shift_revealed_board_card_custom":{const m=n.cardToShiftId,g=Ie(t,m);if(!g)return{type:"selectLane",laneIndex:0};const v=g.card,C=v.isFaceUp?v.value:Math.min(v.value,2),b=g.owner==="opponent";let x=0,j=-1e3;for(let E=0;E<3;E++){let k=0;if(b){const R=t.opponent.laneValues[E]+C,D=t.player.laneValues[E];R>=10&&R>D?k=200:k=R-D}else{const R=t.player.laneValues[E]+C,D=t.opponent.laneValues[E];R>=10&&R>D?k=-200:k=D-R}k>j&&(j=k,x=E)}return{type:"selectLane",laneIndex:x}}case"gravity_2_shift_after_flip":{const{targetLaneIndex:m}=n;return{type:"selectLane",laneIndex:m}}case"flip_self":case"flip_self_for_water_0":case"flip_self_for_psychic_4":case"speed_3_self_flip_after_shift":return n.sourceCardId?{type:"flipCard",cardId:n.sourceCardId}:{type:"skip"};case"anarchy_0_conditional_draw":return{type:"skip"};case"select_any_opponent_card_to_shift":{const m=[];for(let g=0;g<3;g++){const v=t.player.lanes[g];if(v.length>0){const C=v[v.length-1],b=C.isFaceUp?C.value:Math.min(C.value,2),x=t.player.laneValues[g];m.push({cardId:C.id,score:b+x})}}return m.length>0?(m.sort((g,v)=>v.score-g.score),{type:"deleteCard",cardId:m[0].cardId}):{type:"skip"}}case"select_own_other_card_to_shift":{const m=[];for(let g=0;g<3;g++){const v=t.opponent.lanes[g],C=t.opponent.laneValues[g];for(const b of v){if(b.id===n.sourceCardId)continue;const x=b.isFaceUp?b.value:Math.min(b.value,2);m.push({cardId:b.id,score:x-C*.5})}}return m.length>0?(m.sort((g,v)=>v.score-g.score),{type:"deleteCard",cardId:m[0].cardId}):{type:"skip"}}case"select_own_face_up_covered_card_to_flip":return{type:"skip"};case"reveal_opponent_hand":case"delete_self":return{type:"skip"};case"select_card_from_trash_to_play":{const m=t.opponent.discard;return m.length===0?{type:"skip"}:{type:"selectTrashCard",cardIndex:[...m].map((v,C)=>{var x,j,E;let b=v.value*10;for(let k=0;k<3;k++){if(t.opponent.compiled[k])continue;const R=t.opponent.laneValues[k]+v.value;R>=10&&R>t.player.laneValues[k]&&(b+=100)}return(x=v.keywords)!=null&&x.flip&&(b+=5),(j=v.keywords)!=null&&j.draw&&(b+=3),(E=v.keywords)!=null&&E.delete&&(b+=5),{card:v,index:C,score:b}}).sort((v,C)=>C.score-v.score)[0].index}}case"select_card_from_trash_to_reveal":{const m=t.opponent.discard;return m.length===0?{type:"skip"}:{type:"selectTrashCard",cardIndex:[...m].map((v,C)=>({card:v,index:C,value:v.value})).sort((v,C)=>C.value-v.value)[0].index}}case"select_lane_for_delete":{const m=n.validLanes||[0,1,2],g=n.valueFilter,v=m.map(C=>{let b=0,x=0;for(const j of t.player.lanes[C]){const E=j.isFaceUp?j.value:2;g?j.isFaceUp?j.value>=g.min&&j.value<=g.max&&(b+=E+1):b+=(E+1)*.5:b+=E+1}for(const j of t.opponent.lanes[C]){const E=j.isFaceUp?j.value:2;g?j.isFaceUp?j.value>=g.min&&j.value<=g.max&&(x+=E+3):x+=(E+3)*.5:x+=E+3}return{laneIndex:C,score:b-x}});return v.sort((C,b)=>b.score-C.score),v[0].score>0?{type:"selectLane",laneIndex:v[0].laneIndex}:{type:"selectLane",laneIndex:v[0].laneIndex}}case"select_lane_for_shift_all":{const m=n.validDestinationLanes||n.validLanes||[0,1,2],g=n.sourceLaneIndex,v=m.filter(C=>C!==g);if(v.length>0){const C=v.map(b=>{let x=0;return x+=t.opponent.lanes[b].length*2,x+=t.opponent.laneValues[b],t.player.laneValues[b]>=8&&(x-=5),{laneIndex:b,score:x}});return C.sort((b,x)=>x.score-b.score),{type:"selectLane",laneIndex:C[0].laneIndex}}return m.length>0?{type:"selectLane",laneIndex:m[0]}:{type:"selectLane",laneIndex:0}}case"prompt_optional_draw":return t.opponent.hand.length>=6?{type:"resolveOptionalEffectPrompt",accept:!1}:{type:"resolveOptionalEffectPrompt",accept:!0};case"prompt_optional_discard_custom":return{type:"resolveOptionalEffectPrompt",accept:t.opponent.hand.length>4};case"prompt_optional_shuffle_trash":return{type:"resolvePrompt",accept:(n.trashCount||0)>0};case"select_card_from_revealed_deck":{const m=n.selectableCardIds||[];if(m.length>0){const g=Math.floor(Math.random()*m.length);return{type:"selectRevealedDeckCard",cardId:m[g]}}return{type:"resolvePrompt",accept:!1}}case"reveal_deck_draw_protocol":return{type:"confirmRevealDeckDrawProtocol"};case"custom_choice":{const{options:m}=n;if(!m||m.length!==2)return{type:"resolveCustomChoice",optionIndex:0};const g=b=>{var E,k,R;let x=0;const j=((E=b.action)==null?void 0:E.toLowerCase())||"";return j.includes("draw")&&(x+=30),j.includes("discard")&&(x-=20),j.includes("delete")&&((k=b.targetFilter)==null?void 0:k.owner)==="opponent"&&(x+=40),j.includes("delete")&&((R=b.targetFilter)==null?void 0:R.owner)==="own"&&(x-=30),x},v=g(m[0]),C=g(m[1]);return{type:"resolveCustomChoice",optionIndex:v>=C?0:1}}case"select_phase_effect":{const m=n;if(m.availableEffects.length===0)return{type:"skip"};const g=m.availableEffects.map(C=>{let b=0;const x=C.effectDescription.toLowerCase();return x.includes("draw")?b+=100:x.includes("delete")?b+=80:x.includes("shift")?b+=60:x.includes("flip")?b+=40:b+=20,Math.random()<.05&&(b=Math.random()*50),{effect:C,score:b}});return g.sort((C,b)=>b.score-C.score),{type:"flipCard",cardId:g[0].effect.cardId}}case"state_number":{const m={0:0,1:0,2:0,3:0,4:0,5:0};t.opponent.hand.forEach(C=>{C.value>=0&&C.value<=5&&m[C.value]++}),m[2]+=2,m[3]+=2;let g=0,v=m[0];for(let C=1;C<=5;C++)m[C]>v&&(v=m[C],g=C);return Math.random()<.05&&(g=Math.floor(Math.random()*6)),{type:"stateNumber",number:g}}case"state_protocol":{const g=n.availableProtocols||[];if(g.length===0)return{type:"skip"};const v=t.player.protocols,C=g.map(b=>{let x=0;return v.includes(b)&&(x+=50),x+=Math.random()*20,{protocol:b,score:x}});return C.sort((b,x)=>x.score-b.score),{type:"stateProtocol",protocol:C[0].protocol}}case"select_from_drawn_to_reveal":{const g=n.eligibleCardIds||[];if(g.length===0)return{type:"skip"};const v=t.opponent.hand,C=g.map(b=>{const x=v.find(E=>E.id===b);if(!x)return{cardId:b,score:0};let j=x.value;return t.opponent.protocols.includes(x.protocol)&&(j+=10),{cardId:b,score:j}});return C.sort((b,x)=>x.score-b.score),{type:"selectFromDrawnToReveal",cardId:C[0].cardId}}case"confirm_deck_discard":return{type:"confirmDeckDiscard"};case"confirm_deck_play_preview":return{type:"confirmDeckPlayPreview"};default:{if("optional"in n&&n.optional)return{type:"skip"};const m=[...t.player.lanes.flat(),...t.opponent.lanes.flat()];return m.length>0&&(n.type.includes("select_")||n.type.includes("shift"))?{type:"deleteCard",cardId:m[0].id}:{type:"skip"}}}},Zm=(t,n)=>n?PC(t,n):t.phase==="compile"&&t.compilableLanes.length>0?{type:"compile",laneIndex:t.compilableLanes.reduce((s,c)=>t.opponent.laneValues[c]>t.opponent.laneValues[s]?c:s)}:t.phase==="action"?$C(t):{type:"fillHand"};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Zentrale Animation-Helper fr AI-Aktionen.
 *
 * Dieses Modul folgt dem Prinzip "Capture  Change  Enqueue":
 * 1. Animation VOR State-nderung erstellen (Snapshot korrekt)
 * 2. Resolver ausfhren (State ndert sich)
 * 3. Animation(s) enqueuen
 *
 * DRY: Eine zentrale Stelle fr alle AI-Animation-Erstellung.
 */function Hu(t,n){return t.player.lanes.flat().some(r=>r.id===n)?"player":t.opponent.lanes.flat().some(r=>r.id===n)?"opponent":null}function qC(t,n,r,s=!0){const c=Hu(t,n);if(!c)return!1;const d=sa(t,n,c);if(!d)return!1;const u=t[c].lanes[d.laneIndex][d.cardIndex];if(!u)return!1;const p=!u.isFaceUp,f=vy(u,p),h=$u(t,u,c,d.laneIndex,d.cardIndex,p,s);return r({...h,logMessage:{message:f,player:c}}),!0}function LC(t,n,r,s=!0){const c=Hu(t,n);if(!c)return!1;const d=sa(t,n,c);if(!d)return!1;const u=t[c].lanes[d.laneIndex][d.cardIndex];if(!u)return!1;const p=Lu(u),f=gl(t,u,c,d.laneIndex,d.cardIndex,s);return r({...f,logMessage:{message:p,player:c}}),!0}function UC(t,n,r,s=!0){const c=Hu(t,n);if(!c)return!1;const d=sa(t,n,c);if(!d)return!1;const u=t[c].lanes[d.laneIndex][d.cardIndex];if(!u)return!1;const p=xx(u),f=vl(t,u,c,d.laneIndex,d.cardIndex,!0,s);return r({...f,logMessage:{message:p,player:c}}),!0}function Vy(t,n,r,s,c=!0){var j,E;if(!(n.type||"").toLowerCase().includes("shift"))return!1;const p=n;let f,h,y;if(p.cardToShiftId)f=p.cardToShiftId,h=p.cardOwner,y=p.originalLaneIndex;else if(p.cardId){f=p.cardId;for(const k of["player","opponent"]){const R=t[k].lanes.findIndex(D=>D.some(L=>L.id===f));if(R>=0){h=k,y=R;break}}}else if(p.revealedCardId){f=p.revealedCardId;for(const k of["player","opponent"]){const R=t[k].lanes.findIndex(D=>D.some(L=>L.id===f));if(R>=0){h=k,y=R;break}}}if(!f||!h||y===void 0||y===r)return!1;const m=(j=t[h].lanes[y])==null?void 0:j.find(k=>k.id===f),g=((E=t[h].lanes[y])==null?void 0:E.findIndex(k=>k.id===f))??-1;if(!m||g<0)return!1;const v=t[h].protocols[y],C=t[h].protocols[r],b=_x(h,m,v,C),x=_s(t,m,h,y,g,r,c);return s({...x,logMessage:{message:b,player:h}}),!0}function zy(t,n,r,s,c,d,u=!0){const p=t[c].hand.find(g=>g.id===n),f=t[c].hand.findIndex(g=>g.id===n);if(!p||f<0)return!1;const h=t[c].protocols[r],y=wu(c,p,h,s),m=Zo(t,p,c,r,!0,f,s,u);return d({...m,logMessage:{message:y,player:c}}),!0}function By(t,n,r,s,c=!1){const d=n.type==="select_lane_for_delete",u=n.type==="select_lane_for_delete_all";if(!d&&!u)return!1;const p=n,f=p.actor||(c?"opponent":"player"),h=[];if(u)for(const g of["player","opponent"]){const v=t[g].lanes[r];for(let C=0;C<v.length;C++)h.push({card:v[C],owner:g,cardIndex:C})}else{const g=p.targetFilter||{},v=p.deleteAll===!0,C=p.count||1;for(const b of["player","opponent"]){const x=t[b].lanes[r],j=x.some(E=>E.isFaceUp&&E.protocol==="Darkness"&&E.value===2)?4:2;for(let E=0;E<x.length;E++){const k=x[E],R=E===x.length-1,D=k.isFaceUp?k.value:j;if(g.valueRange){const{min:L,max:I}=g.valueRange;if(D<L||D>I)continue}if(!(g.faceState==="face_up"&&!k.isFaceUp)&&!(g.faceState==="face_down"&&k.isFaceUp)&&!(g.owner==="own"&&b!==f)&&!(g.owner==="opponent"&&b===f)&&!(g.position==="uncovered"&&!R)&&!(g.position==="covered"&&R)&&(h.push({card:k,owner:b,cardIndex:E}),!v&&h.length>=C))break}if(!v&&h.length>=C)break}}if(h.length===0)return!1;h.sort((g,v)=>v.cardIndex-g.cardIndex);const y=[],m=new Set;return h.forEach(({card:g,owner:v,cardIndex:C},b)=>{const x=gl(t,g,v,r,C,c,m);if(m.add(g.id),b===0){const j=Lu(g);y.push({...x,logMessage:{message:j,player:v}})}else y.push(x)}),y.length>0&&s(y),!0}function ys(t,n,r,s,c){const d=t._compileAnimations;if(d&&d.length>0&&c){const p=gy(n,d);if(p.length>0){const f=n[s].protocols[r],h=Sx(s,f);p[0]={...p[0],logMessage:{message:h,player:s}}}p.length>0&&p.forEach(f=>c(f))}const u={...t};return delete u._compileAnimations,u}function OC(t,n,r,s){return!t._compileAnimations||!s||(r==null?void 0:r.type)!=="compile"||r.laneIndex===void 0?t:ys(t,n,r.laneIndex,"opponent",s)}function Gy(t,n,r,s){const c=t[r].hand.findIndex(p=>p.id===n),d=t[r].hand[c];if(!d||c<0)return!1;const u=Pu(t,d,r,c);return s(u),!0}function MC(t,n,r){const s=new Set;switch(n.type){case"flipCard":qC(t,n.cardId,r)&&s.add("flip");break;case"deleteCard":LC(t,n.cardId,r)&&s.add("delete");break;case"returnCard":UC(t,n.cardId,r)&&s.add("return");break;case"giveCard":Gy(t,n.cardId,t.turn,r)&&s.add("give");break}return s}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Ut=(t,n)=>t.phase==="start"?n.continueTurnAfterStartPhaseAction(t):n.processEndOfAction(t),ju=(t,n,r)=>{switch(r){case"normal":return Zm(t,n);case"hard":return Zm(t,n);default:return mC(t,n)}},Wy=(t,n,r,s,c)=>{const d=t.actionRequired;if(d.type==="execute_follow_up_effect"){const{sourceCardId:p,followUpEffect:f,actor:h,logContext:y}=d,m=Ie(t,p);if(!m||!m.card.isFaceUp){let j={...t};y!=null&&y.sourceCardName&&(j._currentEffectSource=y.sourceCardName),y!=null&&y.phase&&(j._currentPhaseContext=y.phase),(y==null?void 0:y.indentLevel)!==void 0&&(j._logIndentLevel=y.indentLevel);const E=m?`${m.card.protocol}-${m.card.value}`:"the source card";return j=te(j,h,`Follow-up effect from ${E} skipped (${m?"flipped face-down":"deleted"}).`),j.actionRequired=null,Ut(j,s)}const g=t[m.owner].lanes.find(j=>j.some(E=>E.id===p)),v=t[m.owner].lanes.indexOf(g),C={cardOwner:m.owner,actor:h,currentTurn:t.turn,opponent:m.owner==="player"?"opponent":"player"};let b={...t,actionRequired:null};return y!=null&&y.sourceCardName&&(b._currentEffectSource=y.sourceCardName),y!=null&&y.phase&&(b._currentPhaseContext=y.phase),(y==null?void 0:y.indentLevel)!==void 0&&(b._logIndentLevel=y.indentLevel),b=_t(m.card,v,b,C,f).newState,b.actionRequired?b:Ut(b,s)}const u=ju(t,d,n);if(u.type==="skip"){const p=r.skipAction(t);return t.phase==="start"?s.continueTurnAfterStartPhaseAction(p):s.processEndOfAction(p)}if(u.type==="selectLane"){const p=Vy(t,d,u.laneIndex,c,!0),f=c?g=>g.forEach(v=>c(v)):void 0,h=f?By(t,d,u.laneIndex,f,!0):!1,{nextState:y,requiresAnimation:m}=bu(t,u.laneIndex);if(m&&c){let g=m.animationRequests;p&&(g=g.filter(v=>v.type!=="shift")),h&&(g=g.filter(v=>v.type!=="delete")),g.length>0&&Ba(t,g,c)}return y.actionRequired&&y.actionRequired.actor==="opponent"?y:Ut(y,s)}if(u.type==="flipCard"||u.type==="deleteCard"||u.type==="returnCard"||u.type==="shiftCard"||u.type==="selectCard"){MC(t,u,c);const p=Sy(t,u.cardId);let h=cC(p,y=>y.actionRequired&&y.actionRequired.actor==="opponent"?y:t.phase==="start"?s.continueTurnAfterStartPhaseAction(y):s.processEndOfAction(y));if(h._pendingAnimations&&h._pendingAnimations.length>0){for(const y of h._pendingAnimations){const{id:m,...g}=y;c(g)}h={...h,_pendingAnimations:void 0}}return h.actionRequired&&h.actionRequired.actor==="opponent"?h:p.requiresTurnEnd||h.queuedActions&&h.queuedActions.length>0?Ut(h,s):h}if(u.type==="discardCards"&&d.type==="discard"){const f=d.variableCount===!0?u.cardIds.length:d.count,h=u.cardIds.slice(0,f),y=r.discardCards(t,h,"opponent");return y.actionRequired?y:Ut(y,s)}if(u.type==="rearrangeProtocols"&&d.type==="prompt_rearrange_protocols"){const p=t;let f=r.resolveRearrangeProtocols(t,u.newOrder);return f=OC(f,p,d.originalAction,c),Ut(f,s)}if(u.type==="resolveOptionalEffectPrompt"){if(d.type==="prompt_optional_draw"){const f=r.resolveOptionalDrawPrompt(t,u.accept);return f.actionRequired?f:Ut(f,s)}const p=r.resolveOptionalEffectPrompt(t,u.accept);return p.actionRequired?p:Ut(p,s)}if(u.type==="resolveCustomChoice"&&d.type==="custom_choice"){const p=r.resolveCustomChoice(t,u.optionIndex);return p.actionRequired?p:Ut(p,s)}if(u.type==="resolveSwapProtocols"&&d.type==="prompt_swap_protocols"){const p=r.resolveSwapProtocols(t,u.indices);return Ut(p,s)}if(u.type==="resolveControlMechanicPrompt"&&d.type==="prompt_use_control_mechanic"){const{choice:p}=u,{originalAction:f,actor:h}=d;if(p==="skip"){let y=te(t,h,"Opponent skips rearranging protocols.");if(y.actionRequired=null,y={...y,_logIndentLevel:0},f.type==="compile")return{...y,phase:"compile"};if(f.type==="fill_hand"){const m=r.fillHand(y,h);return s.processEndOfAction(m)}else return s.processEndOfAction(y)}else{const y=p;let v=te(t,h,`Opponent chooses to rearrange ${y==="opponent"?"the player's":"their own"} protocols.`);return v.actionRequired={type:"prompt_rearrange_protocols",sourceCardId:"CONTROL_MECHANIC",target:y,actor:h,originalAction:f},v}}if(u.type==="playCard"&&d.type==="select_card_from_hand_to_play"){const{cardId:p,laneIndex:f,isFaceUp:h}=u;zy(t,p,f,h,"opponent",c,!0);const{newState:y,animationRequests:m}=r.playCard({...t,actionRequired:null},p,f,h,"opponent");m&&m.length>0&&Ba(y,m,c);const g={...y,_cardPlayedThisActionPhase:!0};return g.actionRequired?g:Ut(g,s)}if(u.type==="stateNumber"&&d.type==="state_number"){const p=ky(t,u.number);return p.actionRequired?p:Ut(p,s)}if(u.type==="stateProtocol"&&d.type==="state_protocol"){const p=Ry(t,u.protocol);return p.actionRequired?p:Ut(p,s)}if(u.type==="selectFromDrawnToReveal"&&d.type==="select_from_drawn_to_reveal"){const p=Ny(t,u.cardId);return p.actionRequired?p:Ut(p,s)}if(u.type==="confirmDeckDiscard"&&d.type==="confirm_deck_discard"){const p=Ty(t);return p.actionRequired?p:Ut(p,s)}if(u.type==="confirmDeckPlayPreview"&&d.type==="confirm_deck_play_preview"){const p=Fy(t);return p.actionRequired?p:Ut(p,s)}if(u.type==="selectTrashCard"&&d.type==="select_card_from_trash_to_play"){const p=Dy(t,u.cardIndex);return p.actionRequired?p:Ut(p,s)}if(u.type==="selectTrashCard"&&d.type==="select_card_from_trash_to_reveal"){const p=Ay(t,u.cardIndex);return p.actionRequired?p:Ut(p,s)}if(u.type==="giveCard"&&d.type==="select_card_from_hand_to_give"){c&&Gy(t,u.cardId,"opponent",c);const p=r.resolveActionWithHandCard(t,u.cardId);return p.actionRequired?p:Ut(p,s)}if(u.type==="revealCard"&&d.type==="select_card_from_hand_to_reveal")return r.resolveActionWithHandCard(t,u.cardId);if(u.type==="confirmRevealDeckDrawProtocol"&&d.type==="reveal_deck_draw_protocol"){const p=jy(t);return Ut(p,s)}if(u.type==="selectRevealedDeckCard"&&d.type==="select_card_from_revealed_deck"){const p=Ey(t,u.cardId);return Ut(p,s)}if(u.type==="resolveRevealBoardCardPrompt"&&(d.type==="prompt_shift_or_flip_revealed_card"||d.type==="prompt_shift_or_flip_board_card_custom")){const p=Eu(t,u.choice);return p.actionRequired?p:Ut(p,s)}if(u.type==="resolvePrompt"&&d.type==="prompt_optional_shuffle_trash"){if(!u.accept){let f={...t,actionRequired:null};return f=te(f,d.actor,"Opponent skips shuffling trash into deck."),Ut(f,s)}const p=_y(t,d.actor,"Clarity-4");return Ut(p.newState,s)}if(u.type==="resolveOptionalDiscardCustomPrompt"&&d.type==="prompt_optional_discard_custom"){const p=r.resolveOptionalDiscardCustomPrompt(t,u.accept);return p.actionRequired?p:Ut(p,s)}if(d.type==="execute_conditional_followup"){const{sourceCardId:p,laneIndex:f,followUpEffect:h,context:y,actor:m,logSource:g,logPhase:v,logIndentLevel:C}=d,b=Ie(t,p);if(!b){let E={...t};return g!==void 0&&(E._currentEffectSource=g),v!==void 0&&(E._currentPhaseContext=v),C!==void 0&&(E._logIndentLevel=C),E=te(E,m,"Follow-up effect skipped (source no longer active)."),E.actionRequired=null,Ut(E,s)}let x={...t,actionRequired:null};return x=_t(b.card,f,x,y,h).newState,x.actionRequired?x:Ut(x,s)}return Ut({...t,actionRequired:null},s)},HC=(t,n,r,s,c,d)=>{let u={...t};const p=mx(u,1e3);c(p);let f=0;const h=50;for(;f<h;){if(f++,u.winner||u.turn!=="opponent")return u;if(u.phase==="start"&&!u.actionRequired&&(u=s.processStartOfTurn(u)),u.actionRequired){const y=u.actionRequired;if("actor"in y&&y.actor==="player")return u;u=Wy(u,n,r,s,c);continue}if(u.phase==="compile"&&u.compilableLanes.length>0){const y=ju(u,null,n);if(y.type==="compile"){const m=y.laneIndex,g=u;if(d?u=d(u,m):u=r.compileLane(u,m),u=ys(u,g,m,"opponent",c),u.winner)return u;u=s.processEndOfAction(u);continue}}if(u.phase==="action"&&!u._cardPlayedThisActionPhase){const y=ju(u,null,n);if(y.type==="fillHand"){if(u=by(u,"opponent"),u.actionRequired)continue;u=s.processEndOfAction(u);continue}if(y.type==="playCard"){const{cardId:m,laneIndex:g,isFaceUp:v}=y;zy(u,m,g,v,"opponent",c,!0);const{newState:C,animationRequests:b}=r.playCard(u,m,g,v,"opponent");if(u={...C,_cardPlayedThisActionPhase:!0},b&&b.length>0&&Ba(u,b,c),!u.actionRequired&&u.queuedEffect){const{card:x,laneIndex:j}=u.queuedEffect,E={cardOwner:"opponent",actor:"opponent",currentTurn:u.turn,opponent:"player",triggerType:"play"},k=Sl(x,j,u,E);u={...k.newState,queuedEffect:void 0},k.animationRequests&&k.animationRequests.length>0&&Ba(u,k.animationRequests,c)}continue}}if(u.queuedActions&&u.queuedActions.length>0){u=s.processEndOfAction(u);continue}if(u.phase==="action"&&u._cardPlayedThisActionPhase&&(u={...u,phase:"hand_limit",_cardPlayedThisActionPhase:void 0}),u=s.continueTurnProgression(u),u.turn==="player")return u}return console.error("[SYNC] AI turn exceeded max iterations, returning current state"),u};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const VC=(t,n,r,s,c,d="player",u,p,f,h)=>{const[y,m]=J.useState(()=>{const se=ps(t,n,c,d);return qe(se)}),[g,v]=J.useState(null),C=J.useRef(!1),b=J.useRef(0),x=J.useRef(new Set(y.player.hand.map(se=>se.id))),j=J.useRef(new Set(y.opponent.hand.map(se=>se.id))),E=J.useRef(y.player.hand.length),k=J.useRef(y.opponent.hand.length),R=J.useRef(d),D=J.useRef(y.phase),L=J.useRef(!1),I=J.useRef(!1);J.useEffect(()=>{y.turn!==d&&y.log.length<=4&&m(se=>{const re=d==="player"?"Player":"Opponent",ce=[...se.log];return ce.length>0&&(ce[ce.length-1]={player:"player",message:`${re} goes first.`}),{...se,turn:d,log:ce}})},[d,y.turn,y.log.length]);const F=J.useCallback(se=>{switch(se){case"start":return uy;case"end":return ul;default:return Sr}},[]),U=(se,re,ce="player")=>{if(!g||y.turn!=="player"||y.phase!=="action")return;const he=g;if(v(null),p){const we=y.player.hand.find(ke=>ke.id===he),Se=y.player.hand.findIndex(ke=>ke.id===he);if(we){const ke=ce==="player"?y.player.protocols[se]:y.opponent.protocols[se],Xe=wu("player",we,ke,re,ce),Le=Zo(y,we,"player",se,!0,Se,re);p({...Le,logMessage:{message:Xe,player:"player"}})}m(ke=>{var Me,Ne;const Xe=F(ke.phase),{newState:Le,animationRequests:be}=Lc(ke,he,se,re,"player",ce);if(be&&be.length>0){for(const De of be)if(De.type==="shift"){const Ge=(Me=ke[De.owner].lanes[De.fromLane])==null?void 0:Me.find(tt=>tt.id===De.cardId),et=((Ne=ke[De.owner].lanes[De.fromLane])==null?void 0:Ne.findIndex(tt=>tt.id===De.cardId))??-1;if(Ge&&et>=0){const tt=_s(ke,Ge,De.owner,De.fromLane,et,De.toLane);p(tt),De._animationAlreadyCreated=!0}}else if(De.type!=="flip"){if(De.type==="delete"){const Ge=De._snapshotState||ke,et=Ge[De.owner].lanes.flat().find(rt=>rt.id===De.cardId),tt=sa(Ge,De.cardId,De.owner);if(et&&tt){const rt=gl(Ge,et,De.owner,tt.laneIndex,tt.cardIndex);p(rt)}}}const Be=be.filter(De=>De.type==="play"&&De.fromDeck&&De.toLane!==void 0);if(Be.length>0){const De=Be.map(Ge=>Ge.cardId);Be.forEach((Ge,et)=>{var ht;const tt=Ge,rt=(ht=Le[tt.owner].lanes[tt.toLane])==null?void 0:ht.find(Rt=>Rt.id===tt.cardId);if(rt){const Rt=De.slice(et);let Ft={...Le};for(const fn of Rt)for(const Zt of["player","opponent"])for(let nn=0;nn<3;nn++)Ft[Zt].lanes[nn].some(un=>un.id===fn)&&(Ft={...Ft,[Zt]:{...Ft[Zt],lanes:Ft[Zt].lanes.map((un,jn)=>jn===nn?un.filter(Xn=>Xn.id!==fn):un)}});const En=Zo(Ft,rt,tt.owner,tt.toLane,!1,void 0,tt.isFaceUp??!1,tt.owner==="opponent");p(En)}})}const Ye=be.filter(De=>!(De.type==="play"&&De.fromDeck||De.type==="shift"&&De._animationAlreadyCreated||De.type==="delete"));return p&&Ye.length>0&&Ba(Le,Ye,p),Le.actionRequired?Le:Xe(Le)}return Le.actionRequired?Le:Xe(Le)})}},B=()=>{y.turn!=="player"||y.phase!=="action"||y.actionRequired||m(se=>{const re=F(se.phase);let ce=by(se,"player");return ce.actionRequired?ce:re(ce)})},G=J.useCallback(se=>{m(re=>{var Se;if(((Se=re.actionRequired)==null?void 0:Se.type)!=="discard"||re.actionRequired.actor!=="player")return re;const ce=re.actionRequired;if(!re.player.hand.find(ke=>ke.id===se))return re;let we;return ce.count>1||ce.variableCount?we=Ac(re,[se]):we=Uc(re,[se],"player"),we.actionRequired?we:F(re.phase)(we)})},[F]),W=J.useCallback(se=>{m(re=>{if(re.winner||re.phase!=="compile")return re;const ce=F(re.phase);if(re.useControlMechanic&&re.controlCardHolder===re.turn)return{...Qo(re,se,r),compilableLanes:[]};const we=Qo(re,se,r);if(we.winner)return we;const Se=ys(we,re,se,"player",p);return ce({...Se,compilableLanes:[]})})},[r,F,p]),P=se=>{var he,we;const re=(he=y.actionRequired)==null?void 0:he.type;if(p&&(re==="select_card_to_return"||re==="select_opponent_card_to_return")){const Se=(we=y.actionRequired)==null?void 0:we.allowedIds;if(!Se||Se.includes(se))for(const Xe of["player","opponent"]){let Le=!1;for(const[be,Me]of y[Xe].lanes.entries()){const Ne=Me.findIndex(Be=>Be.id===se);if(Ne>=0){const Be=Me[Ne],Ye=vl(y,Be,Xe,be,Ne,!0);p(Ye),Le=!0;break}}if(Le)break}}if(p&&(re==="select_cards_to_delete"||re==="select_face_down_card_to_delete"||re==="select_low_value_card_to_delete"||re==="select_card_from_other_lanes_to_delete"))for(const Se of["player","opponent"]){let ke=!1;for(const[Xe,Le]of y[Se].lanes.entries()){const be=Le.findIndex(Me=>Me.id===se);if(be>=0){const Me=Le[be],Ne=Lu(Me),Be=gl(y,Me,Se,Xe,be);p({...Be,logMessage:{message:Ne,player:Se}}),ke=!0;break}}if(ke)break}m(Se=>{const ke=Se.turn,Xe=F(Se.phase),{nextState:Le,requiresAnimation:be}=Sy(Se,se,p);if(be){if(p&&be.animationRequests&&be.animationRequests.length>0){const Ne=be.animationRequests.filter(Be=>Be.type!=="delete");Ne.some(Be=>Be.type==="flip")&&(Le._deferFlipSelf=!0),Ne.length>0&&Ba(Le,Ne,p)}const Me=Le.turn!==ke?Ne=>Ne:Xe;return be.onCompleteCallback(Le,Me)}return Le.actionRequired?Le:Xe(Le)})},z=se=>{var we,Se,ke,Xe,Le;const re=(we=y.actionRequired)==null?void 0:we.type,ce=re==="select_lane_for_shift_all";if(p&&y.actionRequired&&Vy(y,y.actionRequired,se,p,!1),f&&ce){const be=y.actionRequired,Me=be.sourceLaneIndex,Ne=be.cardsToShift;if(Ne&&Me!==se){const Be=[];let Ye=!0;for(const{cardId:De,owner:Ge}of Ne){const et=((Se=y[Ge].lanes[Me])==null?void 0:Se.findIndex(rt=>rt.id===De))??-1,tt=(ke=y[Ge].lanes[Me])==null?void 0:ke[et];if(tt&&et>=0){const rt=_s(y,tt,Ge,Me,et,se);if(Ye){const ht=y[Ge].protocols[Me],Rt=y[Ge].protocols[se],Ft=wx(ht,Rt);Be.push({...rt,logMessage:{message:Ft,player:Ge}}),Ye=!1}else Be.push(rt)}}Be.length>0&&f(Be)}}const he=re==="select_lane_for_play"&&((Xe=y.actionRequired)==null?void 0:Xe.cardInHandId);if(p&&he){const be=y.actionRequired,Me=be.cardInHandId,Ne=be.actor||"player",Be=y[Ne].hand.findIndex(De=>De.id===Me),Ye=y[Ne].hand[Be];if(Ye&&Be>=0){const De=be.isFaceDown;let Ge;if(typeof De=="boolean")Ge=!De;else{const ht=Ne==="player"?"opponent":"player";Ge=Ye.protocol===y[Ne].protocols[se]||Ye.protocol===y[ht].protocols[se]}const et=y[Ne].protocols[se],tt=wu(Ne,Ye,et,Ge),rt=Zo(y,Ye,Ne,se,!0,Be,Ge,Ne==="opponent");p({...rt,logMessage:{message:tt,player:Ne}})}}if(f&&((Le=y.actionRequired)==null?void 0:Le.type)==="select_lane_for_return"){const be=y.actionRequired,Me=be.cardOwner||be.actor||"player",Ne=be.targetFilter||{},Be=y.player.protocols[se],Ye=[];for(const et of["player","opponent"]){const tt=y[et].lanes[se],rt=tt.some(ht=>ht.isFaceUp&&ht.protocol==="Darkness"&&ht.value===2)?4:2;tt.forEach((ht,Rt)=>{const Ft=ht.isFaceUp?ht.value:rt;Ne.valueEquals!==void 0&&Ft!==Ne.valueEquals||Ne.faceState==="face_up"&&!ht.isFaceUp||Ne.faceState==="face_down"&&ht.isFaceUp||Ne.owner==="own"&&et!==Me||Ne.owner==="opponent"&&et===Me||Ye.push({card:ht,owner:et,cardIndex:Rt})})}const De=[],Ge=new Set;Ye.forEach(({card:et,owner:tt,cardIndex:rt},ht)=>{const Rt=vl(y,et,tt,se,rt,!0,!1,Ge);if(Ge.add(et.id),ht===0){const Ft=Cx(tt,Be);De.push({...Rt,logMessage:{message:Ft,player:tt}})}else De.push(Rt)}),De.length>0&&f(De)}f&&y.actionRequired&&By(y,y.actionRequired,se,f,!1),m(be=>{var Ye,De;const Me=F(be.phase),{nextState:Ne,requiresAnimation:Be}=bu(be,se);if(Be){const Ge=((Ye=be.actionRequired)==null?void 0:Ye.type)||"",et=Ge.toLowerCase().includes("shift"),tt=Ge==="select_lane_for_play"&&((De=be.actionRequired)==null?void 0:De.cardInHandId),rt=Ge==="select_lane_for_return",ht=Ge==="select_lane_for_delete";let Rt=Be.animationRequests;return et&&(Rt=Rt.filter(Ft=>Ft.type!=="shift")),tt&&(Rt=Rt.filter(Ft=>Ft.type!=="play")),rt&&(Rt=Rt.filter(Ft=>Ft.type!=="return")),ht&&(Rt=Rt.filter(Ft=>Ft.type!=="delete")),p&&Rt.length>0&&Ba(Ne,Rt,p),Be.onCompleteCallback(Ne,Me)}return Ne.actionRequired?Ne:Me(Ne)})},H=se=>{m(re=>{const ce={...re,actionRequired:re.actionRequired?{...re.actionRequired,isFaceDown:!0}:null},he=F(re.phase),{nextState:we,requiresAnimation:Se}=bu(ce,se);return Se?(p&&Se.animationRequests&&Se.animationRequests.length>0&&Ba(we,Se.animationRequests,p),Se.onCompleteCallback(we,he)):we.actionRequired?we:he(we)})},A=se=>{var ce;const re=(ce=y.actionRequired)==null?void 0:ce.type;if(p&&re==="select_card_from_hand_to_give"){const he=y.player.hand.find(Se=>Se.id===se),we=y.player.hand.findIndex(Se=>Se.id===se);if(he&&we>=0){const Se=Pu(y,he,"player",we);p(Se)}}if(p&&re==="select_card_from_hand_to_reveal"){const he=y.player.hand.find(Se=>Se.id===se),we=y.player.hand.findIndex(Se=>Se.id===se);if(he&&we>=0){const Se=hx(y,he,"player","hand",we);p(Se)}}m(he=>{const we=F(he.phase),Se=fu(he,se);return Se.actionRequired?Se:we(Se)})},N=se=>{m(re=>iC(re,se))},T=()=>{m(se=>{var he,we;const re=F(se.phase);let ce={...se};return((he=ce.actionRequired)==null?void 0:he.type)==="prompt_shift_or_flip_board_card_custom"?ce=Eu(ce,"skip"):ce=su(ce),((we=ce.actionRequired)==null?void 0:we.type)==="plague_4_player_flip_optional"?ce:re(ce)})},q=J.useCallback(se=>{m(re=>{var we;if(((we=re.actionRequired)==null?void 0:we.type)!=="prompt_use_control_mechanic")return re;const{originalAction:ce,actor:he}=re.actionRequired;if(se==="skip"){let Se=te(re,he,"Player skips rearranging protocols.");if(Se.actionRequired=null,Se={...Se,_logIndentLevel:0},ce.type==="compile"){const ke=Qo(Se,ce.laneIndex,r);if(ke.winner)return ke;const Xe=ys(ke,Se,ce.laneIndex,"player",p);return F(Xe.phase)({...Xe,compilableLanes:[]})}else if(ce.type==="continue_turn"){let ke={...Se};return ce.queuedSpeed2Actions&&ce.queuedSpeed2Actions.length>0&&(ke.queuedActions=[...ce.queuedSpeed2Actions,...ke.queuedActions||[]]),F(ke.phase)(ke)}else if(ce.type==="resume_interrupted_turn"){let ke={...Se};return ke._interruptedTurn=ce.interruptedTurn,ke._interruptedPhase=ce.interruptedPhase,ce.queuedSpeed2Actions&&ce.queuedSpeed2Actions.length>0&&(ke.queuedActions=[...ce.queuedSpeed2Actions,...ke.queuedActions||[]]),Sr(ke)}else{const ke=fl(Se,he);return F(ke.phase)(ke)}}else{const Se=se;let Le=te(re,he,`${he==="player"?"Player":"Opponent"} chooses to rearrange ${Se==="player"?"their own":"the opponent's"} protocols.`);return Le.actionRequired={type:"prompt_rearrange_protocols",sourceCardId:"CONTROL_MECHANIC",target:Se,actor:he,originalAction:ce},Le}})},[r,F]),O=J.useCallback(se=>{m(re=>{const ce=F(re.phase),he=cu(re,se);return he.actionRequired?he:ce(he)})},[F]),M=J.useCallback(se=>{m(re=>{const ce=F(re.phase),he=iu(re,se);return se?he:ce(he)})},[F]),Y=J.useCallback(se=>{m(re=>{const ce=F(re.phase),he=du(re,se);return he.actionRequired?he:ce(he)})},[F]),X=J.useCallback(se=>{m(re=>{var Se,ke,Xe;const ce=((Se=re.actionRequired)==null?void 0:Se.type)==="discard"&&((ke=re.actionRequired)==null?void 0:ke.variableCount),he=((Xe=re.actionRequired)==null?void 0:Xe.type)==="discard"&&re.actionRequired.count>1;if(!ce&&!he)return re;const we=Ac(re,se);return we.actionRequired?we:F(re.phase)(we)})},[F]),K=J.useCallback(se=>{m(re=>{const ce=F(re.phase),he=Eu(re,se);return he.actionRequired?he:ce(he)})},[F]),ne=J.useCallback(se=>{m(re=>{var Se,ke,Xe;u&&((Se=re.actionRequired)==null?void 0:Se.sourceCardId)==="CONTROL_MECHANIC"&&((ke=re.actionRequired)!=null&&ke.actor)&&u(re.actionRequired.actor);const ce=(Xe=re.actionRequired)==null?void 0:Xe.originalAction,he=F(re.phase),we=uu(re,se,r);if(we.winner)return we;if((ce==null?void 0:ce.type)==="compile"&&we._compileAnimations){const Le=ce.laneIndex,be=ys(we,re,Le,"player",p);return he(be)}return he(we)})},[F,r,u]),Z=J.useCallback(se=>{m(re=>{const ce=F(re.phase),he=hu(re,se);return he.actionRequired?he:ce(he)})},[F]),oe=J.useCallback(se=>{m(re=>{const ce=F(re.phase),he=pu(re,se,r);return he.winner?he:ce(he)})},[F,r]),xe=J.useCallback(se=>{m(re=>{const ce=F(re.phase),he=Ey(re,se);return he.winner?he:ce(he)})},[F]),ye=J.useCallback(()=>{m(se=>{const re=F(se.phase),ce=jy(se);return ce.winner?ce:re(ce)})},[F]),Ce=J.useCallback(se=>{m(re=>{const ce=F(re.phase),he=ky(re,se);return he.winner?he:ce(he)})},[F]),pe=J.useCallback(se=>{m(re=>{const ce=F(re.phase),he=Ry(re,se);return he.winner?he:ce(he)})},[F]),_e=J.useCallback(se=>{m(re=>{const ce=F(re.phase),he=Ny(re,se);return he.winner?he:ce(he)})},[F]),ee=J.useCallback(()=>{m(se=>{const re=F(se.phase),ce=Ty(se);return ce.winner?ce:re(ce)})},[F]),je=J.useCallback(()=>{m(se=>Fy(se))},[]),de=J.useCallback(se=>{m(re=>Dy(re,se))},[]),Pe=J.useCallback(se=>{m(re=>Ay(re,se))},[]),Ue=J.useCallback(se=>{C.current=!1,b.current++,m(re=>{if(typeof se=="function")return se(re);const ce=se;if(ce==="speed-0-interrupt"){const he=["Speed","Life","Water"],we=["Metal","Death","Hate"];let Se=Yn(go(he)),ke=Yn(go(we));const Xe=(Ge,et,tt)=>{const rt=Ge.findIndex(ht=>ht.protocol===et&&ht.value===tt);return rt>-1?Ge.splice(rt,1)[0]:la.find(ht=>ht.protocol===et&&ht.value===tt)},Le=Xe(Se,"Speed",0),be=Xe(ke,"Metal",0),Me=Xe(Se,"Speed",1),Ne=Xe(Se,"Life",1),Be=Xe(Se,"Water",1),Ye=Xe(Se,"Speed",3);let De=ps(he,we,c,d);return De.player.lanes=[[],[],[]],De.player.lanes[0]=[{...Le,id:pt(),isFaceUp:!1}],De.player.hand=[{...Me,id:pt(),isFaceUp:!0},{...Ne,id:pt(),isFaceUp:!0},{...Be,id:pt(),isFaceUp:!0},{...Ye,id:pt(),isFaceUp:!0}],De.player.deck=Se,De.player.discard=[],De.opponent.lanes=[[],[],[]],De.opponent.hand=[{...be,id:pt(),isFaceUp:!0}],De.opponent.deck=ke,De.opponent.discard=[],De.turn="opponent",De.phase="start",De.actionRequired=null,De.queuedActions=[],De=qe(De),De=te(De,"player","DEBUG: Dynamic Speed-0 interrupt scenario set up. AI will play Metal-0."),De}else if(ce==="speed-1-trigger"){const he=["Speed","Life","Water"],we=["Metal","Death","Hate"];let Se=Yn(go(he));const ke=Yn(go(we)),Le=((Be,Ye,De)=>{const Ge=Be.findIndex(et=>et.protocol===Ye&&et.value===De);return Ge>-1?Be.splice(Ge,1)[0]:la.find(et=>et.protocol===Ye&&et.value===De)})(Se,"Speed",1);let be=ps(he,we,c,d);be.player.lanes=[[],[],[]],be.player.lanes[0]=[{...Le,id:pt(),isFaceUp:!0}];const{drawnCards:Me,remainingDeck:Ne}=ca(Se,[],6);return be.player.hand=Me.map(Be=>({...Be,id:pt(),isFaceUp:!0})),be.player.deck=Ne,be.player.discard=[],be.opponent.lanes=[[],[],[]],be.opponent.hand=[],be.opponent.deck=ke,be.opponent.discard=[],be.turn="player",be.phase="hand_limit",be.actionRequired={type:"discard",actor:"player",count:1},be.queuedActions=[],be=qe(be),be=te(be,"player","DEBUG: Speed-1 discard trigger scenario set up."),be}else if(ce==="fire-oncover-test"){const he=["Death","Hate","Water"],we=["Fire","Plague","Metal"],Se=Yn(go(he));let ke=Yn(go(we));const Xe=(Ge,et,tt)=>{const rt=Ge.findIndex(ht=>ht.protocol===et&&ht.value===tt);return rt>-1?Ge.splice(rt,1)[0]:la.find(ht=>ht.protocol===et&&ht.value===tt)},Le=Xe(ke,"Fire",0),be=Xe(ke,"Fire",2),Me=Xe(ke,"Fire",3),Ne=la.find(Ge=>Ge.protocol==="Death"&&Ge.value===1),Be=la.find(Ge=>Ge.protocol==="Hate"&&Ge.value===2),Ye=la.find(Ge=>Ge.protocol==="Water"&&Ge.value===3);let De=ps(he,we,c,"opponent");return De.player.lanes=[[{...Ne,id:pt(),isFaceUp:!0}],[{...Be,id:pt(),isFaceUp:!0}],[{...Ye,id:pt(),isFaceUp:!0}]],De.player.hand=[],De.player.deck=Se,De.player.discard=[],De.opponent.lanes=[[{...Le,id:pt(),isFaceUp:!0}],[],[]],De.opponent.hand=[{...Me,id:pt(),isFaceUp:!0},{...be,id:pt(),isFaceUp:!0}],De.opponent.deck=ke,De.opponent.discard=[],De.turn="opponent",De.phase="action",De.actionRequired=null,De.queuedActions=[],De=qe(De),De=te(De,"opponent","DEBUG: Fire On-Cover test scenario. Opponent has Fire-0 in play, Fire-3 and Fire-2 in hand. Ready to play Fire-3."),De}else if(ce==="speed-2-control-test"){const he=["Speed","Light","Water"],we=["Fire","Plague","Metal"],Se=Yn(go(he)),ke=Yn(go(we)),Le=((Me,Ne,Be)=>{const Ye=Me.findIndex(De=>De.protocol===Ne&&De.value===Be);return Ye>-1?Me.splice(Ye,1)[0]:la.find(De=>De.protocol===Ne&&De.value===Be)})(Se,"Speed",2);let be=ps(he,we,!0,"player");return be.player.lanes=[[{...Le,id:pt(),isFaceUp:!0}],[],[]],be.player.protocols[0]="Speed",be.player.laneValues[0]=10,be.player.hand=[],be.player.deck=Se,be.player.discard=[],be.controlCardHolder="player",be.opponent.lanes=[[],[],[]],be.opponent.hand=[],be.opponent.deck=ke,be.opponent.discard=[],be.turn="player",be.phase="compile",be.compilableLanes=[0],be.actionRequired=null,be.queuedActions=[],be=qe(be),be=te(be,"player","DEBUG: Speed-2 + Control test scenario. Player has Speed-2 (value 10), Control Component active. Ready to compile Protocol Speed!"),be}return re})},[c]);return J.useEffect(()=>{x.current=new Set(y.player.hand.map(se=>se.id)),j.current=new Set(y.opponent.hand.map(se=>se.id)),E.current=y.player.hand.length,k.current=y.opponent.hand.length},[y.player.hand,y.opponent.hand]),J.useEffect(()=>{const se=y._pendingAnimationRequests;!se||se.length===0||p&&(Ba(y,se,p),m(re=>{if(!re._pendingAnimationRequests)return re;const ce={...re};return delete ce._pendingAnimationRequests,ce}))},[y._pendingAnimationRequests,p]),J.useEffect(()=>{y._hasDeferredFlipSelf&&!h&&m(se=>{if(!se._hasDeferredFlipSelf)return se;const re={...se};return delete re._hasDeferredFlipSelf,Sr(re)})},[y._hasDeferredFlipSelf,h]),J.useEffect(()=>{var we,Se;const se=y.phase,re=R.current!==y.turn,ce=!!y._interruptedTurn,he=I.current&&re;if(ce&&(I.current=!0),re&&p&&!y.winner&&!ce&&!he){L.current=!0;const ke=R.current,Xe=y.turn,Le=D.current,Me=yx(y,Le,ke,Xe,Xe==="opponent"?"action":"start");((Se=(we=Me.phaseTransitionData)==null?void 0:we.phaseSequence)==null?void 0:Se.length)>0?p(Me):L.current=!1}he&&(I.current=!1),R.current=y.turn,D.current=se},[y.turn,y.phase,y.winner,p]),J.useEffect(()=>{h||(L.current=!1)},[h]),J.useEffect(()=>{const se=y.actionRequired&&"actor"in y.actionRequired&&y.actionRequired.actor==="player",re=y.actionRequired&&(!("actor"in y.actionRequired)||y.actionRequired.actor!=="opponent");if(y.turn==="opponent"&&!y.winner&&!h&&!L.current&&!y._interruptedTurn&&!se&&!re&&!C.current){C.current=!0;const ce=b.current;queueMicrotask(()=>{if(b.current!==ce){C.current=!1;return}const he=HC(y,s,{compileLane:(we,Se)=>Qo(we,Se,r),playCard:Lc,fillHand:fl,discardCards:Uc,flipCard:Wm,deleteCard:(we,Se)=>({newState:we,animationRequests:[{type:"delete",cardId:Se,owner:"opponent"}]}),returnCard:Ym,skipAction:su,resolveOptionalDrawPrompt:cu,resolveOptionalDiscardCustomPrompt:iu,resolveOptionalEffectPrompt:du,resolveVariableDiscard:Ac,resolveRearrangeProtocols:(we,Se)=>uu(we,Se,r),resolveActionWithHandCard:fu,resolveSwapProtocols:(we,Se)=>pu(we,Se,r),revealOpponentHand:Gm,resolveCustomChoice:hu},$m,p,(we,Se)=>Qo(we,Se,r));m(he),C.current=!1})}},[y.turn,y.phase,y.winner,h,y._interruptedTurn,s,r,p,y.actionRequired]),J.useEffect(()=>{const se=y.actionRequired,re=y.turn==="player"||y._interruptedTurn==="player",ce=se&&"actor"in se&&se.actor==="opponent";re&&!h&&ce&&!C.current&&p&&(C.current=!0,m(we=>Wy(we,s,{compileLane:(Se,ke)=>Qo(Se,ke,r),playCard:Lc,fillHand:fl,discardCards:Uc,flipCard:Wm,deleteCard:(Se,ke)=>({newState:Se,animationRequests:[{type:"delete",cardId:ke,owner:"opponent"}]}),returnCard:Ym,skipAction:su,resolveOptionalDrawPrompt:cu,resolveOptionalDiscardCustomPrompt:iu,resolveOptionalEffectPrompt:du,resolveVariableDiscard:Ac,resolveRearrangeProtocols:(Se,ke)=>uu(Se,ke,r),resolveActionWithHandCard:fu,resolveSwapProtocols:(Se,ke)=>pu(Se,ke,r),revealOpponentHand:Gm,resolveCustomChoice:hu},$m,p)),C.current=!1)},[y.actionRequired,y.turn,y._interruptedTurn,h,s,r,p]),J.useEffect(()=>{m(se=>{let re=qe(se);return re.turn==="player"&&re.phase==="start"&&!re.actionRequired?py(re):re})},[y.turn,y.phase]),{gameState:y,selectedCard:g,setSelectedCard:v,playSelectedCard:U,fillHand:B,discardCardFromHand:G,compileLane:W,resolveActionWithCard:P,resolveActionWithLane:z,resolveActionWithLaneFaceDown:H,selectHandCardForAction:N,skipAction:T,resolveActionWithHandCard:A,resolveOptionalDiscardCustomPrompt:M,resolveOptionalEffectPrompt:Y,resolveVariableDiscard:X,resolveRevealBoardCardPrompt:K,resolveRearrangeProtocols:ne,resolveOptionalDrawPrompt:O,resolveSwapProtocols:oe,resolveControlMechanicPrompt:q,resolveCustomChoice:Z,resolveSelectRevealedDeckCard:xe,resolveRevealDeckDrawProtocol:ye,resolveStateNumber:Ce,resolveStateProtocol:pe,resolveSelectFromDrawnToReveal:_e,resolveConfirmDeckDiscard:ee,resolveConfirmDeckPlayPreview:je,resolveSelectTrashCardToPlay:de,resolveSelectTrashCardToReveal:Pe,setupTestScenario:Ue}},Km=({cards:t,isPlayable:n,isCompilable:r,isShiftTarget:s,isEffectTarget:c,isMatching:d,onLanePointerDown:u,onPlayFaceDown:p,onCardPointerDown:f,onCardPointerEnter:h,onCardPointerLeave:y,owner:m,isCardTargetable:g,laneIndex:v,sourceCardId:C,gameState:b,animatingCardIds:x,animatingCardInfo:j})=>{const E=["lane"];return n&&E.push("playable"),d&&E.push("matching-protocol"),r&&E.push("compilable"),s&&E.push("shift-target"),c&&E.push("effect-target"),o.jsxs("div",{className:E.join(" "),onPointerDown:u,children:[n&&d&&m==="player"&&p&&o.jsx("button",{className:"btn btn-play-facedown",onPointerDown:k=>{k.stopPropagation(),p()},children:"Play Face-Down"}),o.jsx("div",{className:"lane-stack",children:(()=>{const k=new Set;return t.filter(R=>k.has(R.id)?(console.warn("[Lane] Duplicate card ID in lane:",R.id,m,v),!1):(k.add(R.id),!0)).map((R,D)=>{var U;const L=((U=b.actionRequired)==null?void 0:U.type)==="prompt_shift_or_flip_for_light_2"&&b.actionRequired.revealedCardId===R.id,I=wn(R,t,b,v,m);let F=!1;return(j==null?void 0:j.cardId)===R.id?j.fromPosition.type==="lane"&&(F=j.fromPosition.owner===m&&j.fromPosition.laneIndex===v&&j.fromPosition.cardIndex===D):x!=null&&x.has(R.id)&&(F=!0),o.jsx(St,{card:R,isFaceUp:R.isFaceUp||L,style:{"--i":D},onPointerDown:B=>{B.stopPropagation(),f(R)},onPointerEnter:()=>h(R),isTargetable:g(R),isSourceOfEffect:R.id===C,faceDownValue:I,additionalClassName:F?"animating-hidden":void 0},`lane-${m}-${v}-${R.id}-${D}`)})})()})]})},Jm=({owner:t,deckCount:n,topTrashCard:r,trashCount:s,onDeckClick:c,onTrashClick:d,onTrashCardHover:u,onTrashCardLeave:p})=>{const f=t==="opponent",h={id:`deck-display-${t}`,protocol:"Deck",value:n,isFaceUp:!1,bottomRule:"",middleRule:""};return o.jsx("div",{className:`deck-trash-area ${t}`,children:f?o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:`deck-pile ${t}`,onClick:c,title:`${t==="player"?"Your":"Opponent's"} Deck (${n} cards) - Click for details`,children:[o.jsx("div",{className:"pile-label",children:"Deck"}),o.jsx("div",{className:"pile-card-wrapper",children:n>0?o.jsx(St,{card:h,isFaceUp:!1,faceDownValue:n}):o.jsx("div",{className:"empty-pile",children:"Empty"})}),o.jsx("div",{className:"pile-count",children:n})]}),o.jsxs("div",{className:`trash-pile ${t}`,onClick:d,onPointerEnter:()=>r&&(u==null?void 0:u(r)),onPointerLeave:()=>p==null?void 0:p(),title:`${t==="player"?"Your":"Opponent's"} Trash (${s} cards) - Click for details`,children:[o.jsx("div",{className:"pile-label",children:"Trash"}),o.jsx("div",{className:"pile-card-wrapper",children:r?o.jsx(St,{card:r,isFaceUp:!0}):o.jsx("div",{className:"empty-pile",children:"Empty"})}),o.jsx("div",{className:"pile-count",children:s})]})]}):o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:`trash-pile ${t}`,onClick:d,onPointerEnter:()=>r&&(u==null?void 0:u(r)),onPointerLeave:()=>p==null?void 0:p(),title:`${t==="player"?"Your":"Opponent's"} Trash (${s} cards) - Click for details`,children:[o.jsx("div",{className:"pile-label",children:"Trash"}),o.jsx("div",{className:"pile-card-wrapper",children:r?o.jsx(St,{card:r,isFaceUp:!0}):o.jsx("div",{className:"empty-pile",children:"Empty"})}),o.jsx("div",{className:"pile-count",children:s})]}),o.jsxs("div",{className:`deck-pile ${t}`,onClick:c,title:`${t==="player"?"Your":"Opponent's"} Deck (${n} cards) - Click for details`,children:[o.jsx("div",{className:"pile-label",children:"Deck"}),o.jsx("div",{className:"pile-card-wrapper",children:n>0?o.jsx(St,{card:h,isFaceUp:!1,faceDownValue:n}):o.jsx("div",{className:"empty-pile",children:"Empty"})}),o.jsx("div",{className:"pile-count",children:n})]})]})})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Wo=(t,n)=>Ko(t,n),Ca=(t,n)=>Pn(t).some(({rule:s,laneIndex:c})=>s.type==="block_shifts_from_and_to_lane"&&c===n),Bc=(t,n)=>{const{actionRequired:r}=n;if(!r||"actor"in r&&r.actor!=="player")return!1;let s=null,c=-1,d=[];for(const f of["player","opponent"]){for(let h=0;h<n[f].lanes.length;h++)if(n[f].lanes[h].some(y=>y.id===t.id)){s=f,c=h,d=n[f].lanes[h];break}if(s)break}if(!s)return!1;const u=d.findIndex(f=>f.id===t.id),p=Jo(n,d,u);if(r.type==="select_lane_for_shift"){const f=r.cardToShiftId;return!!(f&&t.id===f)}if(r.type==="shift_flipped_card_optional"){const f=r.cardId;return!!(f&&t.id===f)}switch(r.type){case"select_opponent_face_up_card_to_flip":return s==="opponent"&&t.isFaceUp&&p;case"select_card_to_flip":{if(Wo(n,t.id))return!1;const f=r.targetFilter||{},h=d.findIndex(x=>x.id===t.id),y=r.currentLaneIndex,m=r.laneIndex,g=r.scope,v=r.restrictedLaneIndex;if(y!==void 0&&c!==y||g==="this_lane"&&m!==void 0&&c!==m||v!==void 0&&c!==v)return!1;const C=f.position||"uncovered";if(C==="uncovered"&&!p||C==="covered"&&h>=d.length-1||f.owner==="own"&&s!==r.actor||f.owner==="opponent"&&s===r.actor||f.faceState==="face_up"&&!t.isFaceUp||f.faceState==="face_down"&&t.isFaceUp||f.excludeSelf&&t.id===r.sourceCardId||!ms(n,t.id).allowed)return!1;if(f.valueMinGreaterThanHandSize){const x=n[r.actor].hand.length;if(t.value<=x)return!1}if(f.valueLessThanUniqueProtocolsOnField){const x=Er(n);if(t.value>=x)return!1}return!0}case"select_own_face_up_covered_card_to_flip":{const f=d.findIndex(h=>h.id===t.id);return s==="player"&&t.isFaceUp&&f<d.length-1}case"select_opponent_covered_card_to_shift":{const f=d.findIndex(y=>y.id===t.id),h=n.turn==="player"?"opponent":"player";return Ca(n,c)?!1:s===h&&f<d.length-1}case"select_own_covered_card_to_shift":{const f=d.findIndex(h=>h.id===t.id);return Ca(n,c)?!1:s===r.actor&&f<d.length-1}case"select_covered_card_in_line_to_flip_optional":{const h=d.findIndex(m=>m.id===t.id)<d.length-1;return za(n)&&!t.isFaceUp?!1:c===r.laneIndex&&h}case"select_covered_card_to_flip_for_chaos_0":{const h=d.findIndex(m=>m.id===t.id)<d.length-1;return za(n)&&!t.isFaceUp?!1:c===r.laneIndex&&h}case"shift_flipped_card_optional":return Ca(n,c)?!1:t.id===r.cardId;case"select_opponent_card_to_flip":return za(n)&&!t.isFaceUp?!1:s==="opponent"&&p;case"select_face_down_card_to_shift_for_darkness_4":return Ca(n,c)?!1:!t.isFaceUp&&p;case"select_cards_to_delete":{if(Wo(n,t.id)||r.disallowedIds.includes(t.id))return!1;const f=r.allowedIds;if(f&&!f.includes(t.id))return!1;const h=r.currentLaneIndex;if(h!==void 0&&c!==h)return!1;const y=r.targetFilter;if(y){const m=d.findIndex(j=>j.id===t.id),g=y.position||"uncovered";if(g==="uncovered"&&!p||g==="covered"&&m>=d.length-1||y.faceState==="face_up"&&!t.isFaceUp||y.faceState==="face_down"&&t.isFaceUp)return!1;if(y.valueRange){const{min:j,max:E}=y.valueRange;if(t.value<j||t.value>E)return!1}const v=r.actorChooses,C=r.sourceCardId;let b=null;for(const j of["player","opponent"])if(n[j].lanes.flat().some(E=>E.id===C)){b=j;break}if(v==="card_owner"&&b){if(y.owner==="own"&&s!==b||y.owner==="opponent"&&s===b)return!1}else if(y.owner==="own"&&s!==r.actor||y.owner==="opponent"&&s===r.actor)return!1;const x=r.protocolMatching;if(x){const j=n.player.protocols[c],E=n.opponent.protocols[c],k=t.protocol,R=k===j||k===E;if(x==="must_match"&&!R||x==="must_not_match"&&R)return!1}return!0}return p}case"select_face_down_card_to_delete":return!t.isFaceUp&&p;case"select_low_value_card_to_delete":return t.isFaceUp&&(t.value===0||t.value===1)&&p;case"select_card_from_other_lanes_to_delete":{if(Wo(n,t.id))return!1;const{disallowedLaneIndex:f,lanesSelected:h}=r;return c!==f&&!h.includes(c)&&p}case"select_any_other_card_to_flip":return za(n)&&!t.isFaceUp?!1:t.id!==r.sourceCardId&&p;case"select_card_to_return":{if(Wo(n,t.id))return!1;const f=r.targetOwner||"any",h=r.targetFilter,y=r.actor,m=(h==null?void 0:h.position)||"uncovered",v=d.findIndex(b=>b.id===t.id)<d.length-1;if(m==="uncovered"&&!p||m==="covered"&&!v)return!1;const C=h==null?void 0:h.faceState;return C==="face_up"&&!t.isFaceUp||C==="face_down"&&t.isFaceUp?!1:f==="own"?s===y:f==="opponent"?s!==y:!0}case"select_card_to_shift_for_gravity_1":return Wo(n,t.id)||Ca(n,c)?!1:p;case"select_face_down_card_to_shift_for_gravity_4":return Ca(n,c)?!1:!t.isFaceUp&&c!==r.targetLaneIndex&&p;case"select_any_card_to_flip":case"select_any_card_to_flip_optional":return za(n)&&!t.isFaceUp||!ms(n,t.id).allowed?!1:p;case"select_any_face_down_card_to_flip_optional":return ms(n,t.id).allowed?!t.isFaceUp&&p:!1;case"select_board_card_to_reveal_custom":{const f=r.targetFilter;if(!f)return!t.isFaceUp&&p;const h=d.findIndex(m=>m.id===t.id),y=f.position||"uncovered";return!(y==="uncovered"&&!p||y==="covered"&&h>=d.length-1||f.owner==="own"&&s!==r.actor||f.owner==="opponent"&&s===r.actor||f.faceState==="face_up"&&!t.isFaceUp||f.faceState==="face_down"&&t.isFaceUp)}case"select_own_other_card_to_shift":return Ca(n,c)?!1:s===r.actor&&t.id!==r.sourceCardId&&p;case"select_opponent_face_down_card_to_shift":return Ca(n,c)?!1:s!==r.actor&&!t.isFaceUp&&p;case"select_any_opponent_card_to_shift":return Ca(n,c)?!1:s!==r.actor&&p;case"select_opponent_card_to_return":return s==="opponent"&&p;case"select_card_to_shift_for_anarchy_1":return Wo(n,t.id)||Ca(n,c)?!1:p;case"select_card_to_shift_for_anarchy_0":return Wo(n,t.id)||Ca(n,c)?!1:p;case"select_card_to_shift":{if(Wo(n,t.id)||Ca(n,c))return!1;const f=r.targetFilter||{},h=r.destinationRestriction,y=r.scope,m=r.sourceLaneIndex;if(y==="this_lane"&&m!==void 0&&c!==m||(h==null?void 0:h.type)==="non_matching_protocol"&&!t.isFaceUp)return!1;const g=f.position||"uncovered",C=d.findIndex(b=>b.id===t.id)<d.length-1;return!(g==="uncovered"&&!p||g==="covered"&&!C||f.owner==="own"&&s!==r.actor||f.owner==="opponent"&&s===r.actor||f.faceState==="face_up"&&!t.isFaceUp||f.faceState==="face_down"&&t.isFaceUp||f.excludeSelf&&t.id===r.sourceCardId)}case"select_phase_effect":return r.availableEffects.some(h=>h.cardId===t.id);case"select_card_for_copy_middle":return(r.validTargetIds||[]).includes(t.id);default:return!1}},Yy=J.createContext(null),zC=({children:t})=>{const[n,r]=J.useState([]),[s,c]=J.useState(null),d=J.useRef(!1),u=J.useRef(null);u.current=s;const p=J.useRef(!1),f=J.useRef(null),h=s!==null||n.length>0,y=J.useCallback(()=>{d.current||r(R=>{if(R.length===0)return u.current=null,f.current=null,p.current=!1,c(null),R;d.current=!0;const[D,...L]=R;return u.current=D,f.current=null,c(D),d.current=!1,L})},[]),m=J.useCallback(R=>{const D={...R,id:pt()};p.current=!0,!f.current&&!u.current&&(f.current=D),queueMicrotask(()=>{r(L=>!(u.current!==null)&&L.length===0?(u.current=D,f.current=null,c(D),L):[...L,D])})},[]),g=J.useCallback(R=>{if(R.length===0)return;p.current=!0;const D=R.map(L=>({...L,id:pt()}));!f.current&&!u.current&&D.length>0&&(f.current=D[0]),queueMicrotask(()=>{r(L=>{if(!(u.current!==null)&&L.length===0){const[F,...U]=D;return u.current=F,f.current=null,c(F),U}return[...L,...D]})})},[]),v=J.useCallback(()=>{var R;if((R=u.current)!=null&&R.pauseAfter){u.current=null,f.current=null,c(null);return}y()},[y]),C=J.useCallback(()=>{y()},[y]),b=J.useCallback(()=>{r([]),c(null),u.current=null,f.current=null,p.current=!1,d.current=!1},[]),x=J.useCallback(()=>{r([]),c(null),u.current=null,d.current=!1,p.current=!1},[]),j=J.useCallback(()=>p.current,[]),E=J.useCallback(()=>f.current||u.current,[]),k={queue:n,isAnimating:h,currentAnimation:s,enqueueAnimation:m,enqueueAnimations:g,onAnimationComplete:v,getIsAnimatingSync:j,getAnimationSync:E,skipCurrentAnimation:C,skipAllAnimations:b,clearQueue:x};return o.jsx(Yy.Provider,{value:k,children:t})},Vu=()=>{const t=J.useContext(Yy);if(!t)throw new Error("useAnimationQueue must be used within an AnimationQueueProvider");return t},BC=({gameState:t,onLanePointerDown:n,onPlayFaceDown:r,onCardPointerDown:s,onCardPointerEnter:c,onCardPointerLeave:d,onOpponentHandCardPointerEnter:u,onOpponentHandCardPointerLeave:p,selectedCardId:f,sourceCardId:h,animatingCardIds:y,animatingCardInfo:m,onDeckClick:g,onTrashClick:v,onTrashCardHover:C,onTrashCardLeave:b})=>{const{player:x,opponent:j,phase:E,turn:k,compilableLanes:R,actionRequired:D,controlCardHolder:L}=t,{currentAnimation:I}=Vu(),F=A=>{var Pe,Ue,se,re,ce,he;const N=E==="compile"&&k==="player"&&!D&&R.includes(A),T=k==="player",q=E==="action"&&!D&&f,O=(D==null?void 0:D.type)==="select_lane_for_play";if(!(O?(D==null?void 0:D.actor)==="player":T)||!q&&!O)return{isPlayable:!1,isMatching:!1,isCompilable:N};let Y;if(q)Y=x.hand.find(we=>we.id===f);else if(O){if(D.disallowedLaneIndex!==void 0&&A===D.disallowedLaneIndex)return{isPlayable:!1,isMatching:!1,isCompilable:N};const we=D.validLanes;if(we&&!we.includes(A))return{isPlayable:!1,isMatching:!1,isCompilable:N};if(D.source==="deck")return D.excludeCurrentLane&&A===D.currentLaneIndex?{isPlayable:!1,isMatching:!1,isCompilable:N}:{isPlayable:!0,isMatching:!1,isCompilable:N};if(D.source==="trash"){const Se=D.useNormalPlayRules,ke=D.preDrawnCard;if(Se&&ke){const Xe=x.protocols[A],Le=j.protocols[A];return{isPlayable:!0,isMatching:ke.protocol===Xe||ke.protocol===Le,isCompilable:N}}return{isPlayable:!0,isMatching:!1,isCompilable:N}}Y=x.hand.find(Se=>Se.id===D.cardInHandId)}if(!Y)return{isPlayable:!1,isMatching:!1,isCompilable:N};const X=j.lanes[A];if(X.length>0&&X[X.length-1].isFaceUp&&X[X.length-1].protocol==="Plague"&&X[X.length-1].value===0)return{isPlayable:!1,isMatching:!1,isCompilable:N};const ne=j.lanes.flat().some(we=>we.isFaceUp&&we.protocol==="Psychic"&&we.value===1),Z=x.lanes.flat().some(we=>we.isFaceUp&&we.protocol==="Spirit"&&we.value===1),oe=((Ue=(Pe=Y.customEffects)==null?void 0:Pe.bottomEffects)==null?void 0:Ue.some(we=>{var Se,ke;return((Se=we.params)==null?void 0:Se.action)==="card_property"&&((ke=we.params)==null?void 0:ke.property)==="ignore_protocol_matching"}))||((re=(se=Y.customEffects)==null?void 0:se.topEffects)==null?void 0:re.some(we=>{var Se,ke;return((Se=we.params)==null?void 0:Se.action)==="card_property"&&((ke=we.params)==null?void 0:ke.property)==="ignore_protocol_matching"}))||((he=(ce=Y.customEffects)==null?void 0:ce.middleEffects)==null?void 0:he.some(we=>{var Se,ke;return((Se=we.params)==null?void 0:Se.action)==="card_property"&&((ke=we.params)==null?void 0:ke.property)==="ignore_protocol_matching"})),xe=[...x.lanes.flat(),...j.lanes.flat()].some(we=>we.isFaceUp&&we.protocol==="Anarchy"&&we.value===1),ye=Au(t),Ce=Wc(t,"player",A),pe=ml(t,Y),_e=Cl(t,"player",A,Y.protocol),ee=O&&D.ignoreProtocolMatching;let je;return pe||ee?je=!ne:xe||ye?je=Y.protocol!==x.protocols[A]&&Y.protocol!==j.protocols[A]&&!ne:je=(Z||Ce||oe||_e||Y.protocol===x.protocols[A]||Y.protocol===j.protocols[A])&&!ne,X.some(we=>we.isFaceUp&&we.protocol==="Metal"&&we.value===2)&&!je?{isPlayable:!1,isMatching:!1,isCompilable:N}:O&&(D.isFaceDown||D.faceDown)?{isPlayable:!0,isMatching:!1,isCompilable:N}:{isPlayable:!0,isMatching:je,isCompilable:N}},U=A=>{if(!(k==="player")||!(E==="action"&&!D&&f))return{isPlayable:!1,isMatching:!1};const q=x.hand.find(Y=>Y.id===f);if(!q)return{isPlayable:!1,isMatching:!1};if(!ml(t,q))return{isPlayable:!1,isMatching:!1};const O=x.lanes[A];return O.length>0&&O[O.length-1].isFaceUp&&O[O.length-1].protocol==="Plague"&&O[O.length-1].value===0?{isPlayable:!1,isMatching:!1}:{isPlayable:!0,isMatching:!0}},B=A=>{if(!D||D.actor!=="player")return!1;switch(D.type){case"select_lane_for_delete":{const N=D.validLanes;return!(N&&!N.includes(A))}case"select_lane_for_death_2":case"select_lane_for_water_3":case"select_lane_for_return":return!0;case"select_lane_for_metal_3_delete":return A===D.disallowedLaneIndex?!1:x.lanes[A].length+j.lanes[A].length>=8;case"select_lane_for_delete_all":return(D.validLanes||[]).includes(A);case"select_lanes_for_swap_stacks":return(D.validLanes||[]).includes(A);default:return!1}},G=(A,N)=>{if(!D||D.actor!=="player")return!1;const T=D.type==="select_lane_for_shift"?D.originalLaneIndex:(D.type==="select_card_to_shift",-1);if(T!==-1&&!gs(t,T,A).allowed)return!1;switch(D.type){case"select_lane_for_shift":{if(N!==D.cardOwner||A===D.originalLaneIndex)return!1;const q=D.validLanes;if(q&&!q.includes(A))return!1;const O=[...t.player.lanes.flat(),...t.opponent.lanes.flat()].find(Y=>Y.id===D.sourceCardId),M=D.destinationRestriction;if(M&&M.type==="to_or_from_this_lane"){let Y=M.laneIndex;if(M.laneIndex==="current"&&O)for(const X of["player","opponent"]){for(let K=0;K<t[X].lanes.length;K++)if(t[X].lanes[K].some(ne=>ne.id===D.sourceCardId)){Y=K;break}if(typeof Y=="number")break}if(typeof Y=="number"&&!(D.originalLaneIndex===Y)&&!(A===Y))return!1}else if(O&&O.protocol==="Gravity"&&O.value===1){let Y=-1;for(const X of["player","opponent"]){for(let K=0;K<t[X].lanes.length;K++)if(t[X].lanes[K].some(ne=>ne.id===D.sourceCardId)){Y=K;break}if(Y!==-1)break}if(Y!==-1&&!(D.originalLaneIndex===Y)&&!(A===Y))return!1}return!0}case"shift_flipped_card_optional":{const q=D.cardId;let O=null,M=-1;for(let Y=0;Y<x.lanes.length;Y++)if(x.lanes[Y].some(X=>X.id===q)){O="player",M=Y;break}if(O===null){for(let Y=0;Y<j.lanes.length;Y++)if(j.lanes[Y].some(X=>X.id===q)){O="opponent",M=Y;break}}return N!==O?!1:A!==M}case"select_lane_for_life_3_play":return N==="player"&&A!==D.disallowedLaneIndex;case"select_lane_to_shift_revealed_card_for_light_2":return N==="player";case"select_lane_to_shift_revealed_board_card_custom":{const q=D.revealedCardId;if(![...t.player.lanes.flat(),...t.opponent.lanes.flat()].find(X=>X.id===q))return!1;let M=null,Y=-1;for(const X of["player","opponent"]){for(let K=0;K<t[X].lanes.length;K++)if(t[X].lanes[K].some(ne=>ne.id===q)){M=X,Y=K;break}if(M)break}return N===M&&A!==Y}case"select_lane_for_shift_all":{const q=D.sourceLaneIndex;return A!==q}case"select_lane_to_shift_cards_for_light_3":return A!==D.sourceLaneIndex;default:return!1}},W=(A,N,T)=>{let q=[A];return N&&q.push("compiled"),(I==null?void 0:I.type)==="delete"&&I.laneIndex===T&&q.push("is-compiling"),q.join(" ")},P=()=>L==="player"?"player-controlled":L==="opponent"?"opponent-controlled":"neutral",z=()=>L==="player"?"Player has control.":L==="opponent"?"Opponent has control.":"Control is neutral.",H=()=>L==="player"?"Control Player":L==="opponent"?"Control Opponent":"Control Neutral";return o.jsxs("div",{className:"game-board",children:[o.jsx("div",{className:"opponent-hand-area",children:(()=>{const A=new Set;return j.hand.filter(N=>A.has(N.id)?(console.warn("[GameBoard] Duplicate card ID in opponent hand:",N.id),!1):(A.add(N.id),!0)).map((N,T)=>{const q=y==null?void 0:y.has(N.id);return o.jsx(St,{card:N,isFaceUp:N.isRevealed||!1,additionalClassName:`in-hand ${q?"animating-hidden":""}`,onPointerEnter:()=>u(N)},`opp-hand-${N.id}-${T}`)})})()}),o.jsxs("div",{className:`player-side opponent-side ${k==="opponent"?"active-turn":""}`,children:[o.jsx(Jm,{owner:"opponent",deckCount:j.deck.length,topTrashCard:j.discard.length>0?j.discard[j.discard.length-1]:null,trashCount:j.discard.length,onDeckClick:()=>g==null?void 0:g("opponent"),onTrashClick:()=>v==null?void 0:v("opponent"),onTrashCardHover:A=>C==null?void 0:C(A,"opponent"),onTrashCardLeave:b}),o.jsx("div",{className:"lanes",children:j.lanes.map((A,N)=>{const{isPlayable:T,isMatching:q}=U(N);return o.jsx(Km,{cards:A,isPlayable:T,isMatching:q,isCompilable:!1,isShiftTarget:G(N,"opponent"),isEffectTarget:B(N),onLanePointerDown:()=>n(N,"opponent"),onCardPointerDown:O=>s(O,"opponent",N),onCardPointerEnter:O=>c(O,"opponent"),onCardPointerLeave:()=>d(),owner:"opponent",isCardTargetable:O=>Bc(O,t),laneIndex:N,sourceCardId:h,gameState:t,animatingCardIds:y,animatingCardInfo:m},`opp-lane-${N}`)})})]}),o.jsxs("div",{className:"protocol-bars-container",children:[t.useControlMechanic&&o.jsxs("div",{className:"control-coin-container",children:[o.jsx("div",{className:`control-coin ${P()}`,title:z(),children:"C"}),o.jsx("div",{className:`control-coin-label ${P()}`,children:H()})]}),o.jsx("div",{className:`protocol-bar opponent-bar ${k==="opponent"?"active-turn":""}`,children:j.protocols.map((A,N)=>o.jsxs("div",{className:W("protocol-display",j.compiled[N],N),children:[o.jsx("span",{className:"protocol-name",children:A}),o.jsx("span",{className:"protocol-value",children:j.laneValues[N]})]},`opp-proto-${A}-${N}`))}),o.jsx("div",{className:`protocol-bar player-bar ${k==="player"?"active-turn":""}`,children:x.protocols.map((A,N)=>o.jsxs("div",{className:W("protocol-display",x.compiled[N],N),children:[o.jsx("span",{className:"protocol-name",children:A}),o.jsx("span",{className:"protocol-value",children:x.laneValues[N]})]},`player-proto-${A}-${N}`))})]}),o.jsxs("div",{className:`player-side ${k==="player"?"active-turn":""}`,children:[o.jsx(Jm,{owner:"player",deckCount:x.deck.length,topTrashCard:x.discard.length>0?x.discard[x.discard.length-1]:null,trashCount:x.discard.length,onDeckClick:()=>g==null?void 0:g("player"),onTrashClick:()=>v==null?void 0:v("player"),onTrashCardHover:A=>C==null?void 0:C(A,"player"),onTrashCardLeave:b}),o.jsx("div",{className:"lanes",children:x.lanes.map((A,N)=>{const{isPlayable:T,isMatching:q,isCompilable:O}=F(N);return o.jsx(Km,{cards:A,isPlayable:T,isMatching:q,isCompilable:O,isShiftTarget:G(N,"player"),isEffectTarget:B(N),onLanePointerDown:()=>n(N,"player"),onPlayFaceDown:()=>r(N),onCardPointerDown:M=>s(M,"player",N),onCardPointerEnter:M=>c(M,"player"),onCardPointerLeave:()=>d(),owner:"player",isCardTargetable:M=>Bc(M,t),laneIndex:N,sourceCardId:h,gameState:t,animatingCardIds:y,animatingCardInfo:m},`player-lane-${N}`)})})]})]})},GC=({gameState:t,onFillHand:n,onSkipAction:r,onResolveOptionalDiscardCustomPrompt:s,onResolveOptionalEffectPrompt:c,onResolveVariableDiscard:d,onResolveRevealBoardCardPrompt:u,onResolveOptionalDrawPrompt:p,onResolveControlMechanicPrompt:f,onResolveCustomChoice:h,selectedCardId:y,multiSelectedCardIds:m,actionRequiredClass:g,isAnimating:v,snapshotTurn:C,snapshotPhase:b})=>{const{phase:x,turn:j,actionRequired:E,player:k,compilableLanes:R}=t;if(v){const W=C||j,P=b||x,z=W.charAt(0).toUpperCase()+W.slice(1),H=P.replace("_"," ");return H.charAt(0).toUpperCase()+H.slice(1),o.jsxs("div",{className:"phase-controller",children:[o.jsx("div",{className:"effect-source-info",children:o.jsxs("span",{children:[z,"'s Turn"]})}),o.jsxs("div",{className:"phase-controller-main",children:[o.jsxs("div",{className:"phase-info",children:["Phase: ",H]}),o.jsx("div",{className:"phase-actions",children:o.jsx("button",{className:"btn",disabled:!0,children:"Processing..."})})]})]})}const D=W=>{for(const P of["player","opponent"])for(const z of t[P].lanes){const H=z.find(A=>A.id===W);if(H)return H}return null},L=E==null?void 0:E.sourceCardId,I=L?D(L):null,F=(E==null?void 0:E.actor)||j,U=F.charAt(0).toUpperCase()+F.slice(1),B=()=>{var W,P,z,H;if(j!=="player"&&(!E||E.actor!=="player"))return o.jsx("button",{className:"btn",disabled:!0,children:"Processing..."});if((E==null?void 0:E.type)==="prompt_use_control_mechanic")return o.jsxs(o.Fragment,{children:[o.jsx("button",{className:"btn",onClick:()=>f("player"),children:"Rearrange Own"}),o.jsx("button",{className:"btn",onClick:()=>f("opponent"),children:"Rearrange Opponent's"}),o.jsx("button",{className:"btn btn-back",onClick:()=>f("skip"),children:"Skip"})]});if((E==null?void 0:E.type)==="prompt_optional_draw")return o.jsxs(o.Fragment,{children:[o.jsx("button",{className:"btn",onClick:()=>p(!0),children:"Draw"}),o.jsx("button",{className:"btn btn-back",onClick:()=>p(!1),children:"Skip"})]});if((E==null?void 0:E.type)==="prompt_optional_discard_custom")return o.jsxs(o.Fragment,{children:[o.jsxs("button",{className:"btn",onClick:()=>s(!0),children:["Discard ",E.count," Card(s)"]}),o.jsx("button",{className:"btn btn-back",onClick:()=>s(!1),children:"Skip"})]});if((E==null?void 0:E.type)==="prompt_optional_effect"){const A=((P=(W=E.effectDef)==null?void 0:W.params)==null?void 0:P.action)||"effect",N=(H=(z=E.effectDef)==null?void 0:z.params)==null?void 0:H.count,T=N?`${A} ${N}`:A;return o.jsxs(o.Fragment,{children:[o.jsxs("button",{className:"btn",onClick:()=>c(!0),children:["Execute (",T,")"]}),o.jsx("button",{className:"btn btn-back",onClick:()=>c(!1),children:"Skip"})]})}if((E==null?void 0:E.type)==="custom_choice"){const A=E.options||[];if(A.length===2){const N=A[0].params,T=A[1].params,q=O=>O.action==="discard"?`Discard ${O.count||1}`:O.action==="flip"&&O.flipSelf?"Flip This Card":O.action==="draw"?`Draw ${O.count||1}`:O.action==="delete"&&O.deleteSelf?"Delete This Card":O.action==="delete"?`Delete ${O.count||1}`:O.action==="return"?`Return ${O.count||1}`:O.action==="shift"?"Shift":O.action||"Option";return o.jsxs(o.Fragment,{children:[o.jsx("button",{className:"btn",onClick:()=>h(0),children:q(N)}),o.jsx("button",{className:"btn btn-back",onClick:()=>h(1),children:q(T)})]})}}if((E==null?void 0:E.type)==="prompt_shift_or_flip_board_card_custom")return o.jsxs(o.Fragment,{children:[o.jsx("button",{className:"btn",onClick:()=>u("shift"),children:"Shift"}),o.jsx("button",{className:"btn",onClick:()=>u("flip"),children:"Flip"}),o.jsx("button",{className:"btn btn-back",onClick:()=>u("skip"),children:"Skip"})]});if((E==null?void 0:E.type)==="discard"&&E.actor==="player"){const A=E.count,N=E.variableCount;if(A>1||N){const T=N?1:A;return o.jsxs("button",{className:"btn",onClick:()=>d(m),disabled:m.length<T,children:["Confirm Discard (",m.length,"/",N?"?":A,")"]})}}if(E&&"optional"in E&&E.optional)return o.jsx("button",{className:"btn btn-back",onClick:r,children:"Skip Action"});if(E)return o.jsx("button",{className:"btn",disabled:!0,children:"Action Required"});if(x==="compile"&&R.length>0)return o.jsx("button",{className:"btn",disabled:!0,children:"Select Lane to Compile"});if(x==="action"){const A=k.hand.length<5,N=k.hand.length===0,T=Fu(t,"player"),q=A&&T.allowed;return N?o.jsx("button",{className:"btn",onClick:n,disabled:!T.allowed,title:T.allowed?void 0:T.reason,children:"Refresh (Required)"}):o.jsx("button",{className:"btn",onClick:n,disabled:!q||!!y,title:T.allowed?void 0:T.reason,children:"Refresh"})}return o.jsx("button",{className:"btn",disabled:!0,children:"Processing..."})},G=()=>{var W,P,z,H;if(E)switch(E.type){case"discard":return E.actor==="player"?E.variableCount?"Action: Select 1 or more cards to discard":E.count>1?`Action: Select ${E.count} cards to discard, then confirm`:`Action: Discard ${E.count} card from your hand`:"Waiting for Opponent to discard...";case"prompt_use_control_mechanic":return"Control Action: Rearrange protocols?";case"select_opponent_face_up_card_to_flip":return"Action: Select an opponent's face-up card to flip";case"select_own_face_up_covered_card_to_flip":return"Action: Select one of your face-up, covered cards to flip";case"select_opponent_covered_card_to_shift":return"Action: Select one of your opponent's covered cards to shift";case"select_own_covered_card_to_shift":return"Action: Select one of your covered cards to shift";case"select_lane_for_shift":return"Action: Select a new lane for the card";case"select_lane_for_shift_all":return"Action: Select a lane to shift all cards to";case"select_opponent_card_to_flip":return"Action: Select an opponent's card to flip";case"select_card_to_flip":{const A=E.targetFilter||{},N=A.owner||"any",T=A.faceState||"any",q=A.position||"uncovered";let O="Action: Flip ";return N==="own"?O+="one of your ":N==="opponent"?O+="an opponent's ":O+="a ",T==="face_down"?O+="face-down ":T==="face_up"&&(O+="face-up "),q==="covered"?O+="covered ":q==="uncovered"&&(O+="uncovered "),O+="card",O}case"shift_flipped_card_optional":return"Action: You may shift the card you just flipped. Select a lane or skip.";case"select_covered_card_in_line_to_flip_optional":return"Action: You may flip one of your covered cards in this lane. Select a card or skip.";case"select_card_from_hand_to_play":{const A=E.valueFilter;return A!==void 0?`Action: Select a card with value ${A} from your hand to play`:"Action: Select a card from your hand to play"}case"select_lane_for_play":return"Action: Select another lane to play your card in";case"select_face_down_card_to_shift_for_darkness_4":return"Action: Select any face-down card to shift";case"select_cards_to_delete":return`Action: Select a card to delete (${E.count} remaining)`;case"select_face_down_card_to_delete":return"Action: Select a face-down card to delete";case"select_low_value_card_to_delete":return"Action: Select a card with value 0 or 1 to delete";case"select_card_from_other_lanes_to_delete":return`Action: Select a card to delete (${E.count} remaining)`;case"select_lane_for_death_2":return"Action: Select a lane to delete cards with value 1 or 2";case"select_lane_for_delete":return"Action: Select a lane";case"prompt_optional_draw":return"Optional: Draw card(s)?";case"select_card_to_delete_for_death_1":return"Action: Select a card to delete";case"delete_self":return"Deleting card...";case"select_card_from_hand_to_give":return"Action: Select a card from your hand to give";case"select_card_from_hand_to_reveal":return"Action: Select a card from your hand to reveal";case"plague_2_player_discard":return"Action: Select 1 or more cards to discard";case"plague_4_opponent_delete":return"Waiting for opponent to delete one of their face-down cards";case"plague_4_player_flip_optional":return"Action: You may flip Plague-4";case"select_any_other_card_to_flip":return"Action: Select any other card to flip";case"select_card_to_return":{const A=E.targetFilter||{},N=E.targetOwner||A.owner||"any",T=A.position||"uncovered";let q="Action: Select ";return N==="own"?q+="one of your ":N==="opponent"?q+="an opponent's ":q+="a ",T==="any"?q+="covered or uncovered ":T==="covered"&&(q+="covered "),q+="card to return",q}case"select_covered_card_to_flip_for_chaos_0":return"Action: Select a covered card to flip in this lane";case"prompt_optional_discard_custom":return`Optional: Discard ${E.count} card(s) to continue?`;case"prompt_optional_effect":{const A=((P=(W=E.effectDef)==null?void 0:W.params)==null?void 0:P.action)||"effect",N=(H=(z=E.effectDef)==null?void 0:z.params)==null?void 0:H.count;return`Do you want to ${A==="shift"?"shift a card":A==="flip"?"flip a card":A==="draw"?`draw ${N||1} card(s)`:A==="discard"?`discard ${N||1} card(s)`:A==="delete"?"delete a card":A==="return"?"return a card":`execute ${A}${N?` ${N}`:""}`}?`}case"select_card_to_flip_for_fire_3":return"Action: Select a card to flip";case"select_own_other_card_to_shift":return"Action: Select one of your cards to shift";case"select_opponent_face_down_card_to_shift":return"Action: Select an opponent's face-down card to shift";case"select_any_card_to_flip_optional":return"Action: You may flip one card. Select a card or skip.";case"prompt_swap_protocols":return"Action: Swap two protocols.";case"select_any_card_to_flip":return`Action: Select a card to flip (${E.count} remaining)`;case"select_any_face_down_card_to_flip_optional":return"Action: You may flip a face-down card. Select a card or skip.";case"select_lane_for_life_3_play":return"Action: Select another lane to play a card into";case"select_card_to_flip_for_light_0":return"Action: Select any card to flip";case"prompt_shift_or_flip_board_card_custom":return"Action: Choose to shift, flip, or skip";case"select_board_card_to_reveal_custom":return"Action: Select a face-down card to reveal";case"select_lane_to_shift_revealed_card_for_light_2":return"Action: Select a lane to shift the revealed card to";case"select_lane_to_shift_revealed_board_card_custom":return"Action: Select a lane to shift the revealed card to";case"select_lane_to_shift_cards_for_light_3":return"Action: Select a lane to shift all face-down cards to";case"select_lane_for_metal_3_delete":return"Action: Select a lane with 8+ cards to delete";case"select_lane_for_delete_all":return"Action: Select a lane to delete all cards";case"select_lanes_for_swap_stacks":{const A=E.selectedFirstLane;return A===void 0?"Action: Select the first lane to swap":`Action: Select the second lane to swap with lane ${A+1}`}case"select_any_other_card_to_flip_for_water_0":return"Action: Select any other card to flip";case"prompt_rearrange_protocols":return"Action: Rearrange protocols";case"select_lane_for_water_3":return"Action: Select a lane to return cards from";case"select_own_card_to_return_for_water_4":return"Action: Select one of your cards to return to your hand";case"prompt_return_for_psychic_4":return"End Phase: Return an opponent's card?";case"select_any_opponent_card_to_shift":return"Action: Select an opponent's card to shift";case"select_card_to_shift":{const A=E.targetFilter||{},N=A.owner||"any",T=A.faceState||"any",q=A.position||"uncovered";let O="Action: Select ";return N==="own"?O+="one of your ":N==="opponent"?O+="an opponent's ":O+="a ",T==="face_down"?O+="face-down ":T==="face_up"&&(O+="face-up "),q==="covered"?O+="covered ":q==="uncovered"&&(O+="uncovered "),O+="card to shift",O}case"select_opponent_card_to_return":return"Action: Select an opponent's card to return";case"select_own_highest_card_to_delete_for_hate_2":return"Action: Select your highest value uncovered card to delete";case"select_opponent_highest_card_to_delete_for_hate_2":return"Action: Select opponent's highest value uncovered card to delete";case"custom_choice":{const A=E.options||[];if(A.length===2){const N=A[0].params,T=A[1].params,q=O=>O.action==="discard"?`you discard ${O.count||1} card${O.count!==1?"s":""}`:O.action==="flip"&&O.flipSelf?"flip this card":O.action==="draw"?`draw ${O.count||1} card${O.count!==1?"s":""}`:O.action==="delete"&&O.deleteSelf?"delete this card":O.action==="delete"?`delete ${O.count||1} card${O.count!==1?"s":""}`:O.action==="return"?`return ${O.count||1} card${O.count!==1?"s":""}`:O.action==="shift"?"shift a card":O.action||"option";return`Either ${q(N)} or ${q(T)}.`}return"Action: Make a choice"}case"select_card_from_revealed_deck":return`Action: Select a card with value ${E.valueFilter} from your revealed deck`;case"select_phase_effect":{const A=E,N=A.availableEffects.map(T=>T.cardName).join(", ");return`${A.phase} Phase: Choose which effect to resolve first (${N})`}case"select_card_from_trash_to_play":{const A=E.trashOwner||"own";return`Action: Select a card from ${A==="opponent"?"opponent's":A==="any"?"any player's":"your"} trash to play`}case"select_card_from_trash_to_reveal":{const A=E.trashOwner||"own";return`Action: Select a card from ${A==="opponent"?"opponent's":A==="any"?"any player's":"your"} trash to reveal`}default:return"Action Required"}return x==="compile"&&R.length>0?"Phase: Compile":`Phase: ${x.replace("_"," ")}`};return o.jsxs("div",{className:`phase-controller ${g}`,children:[o.jsxs("div",{className:"effect-source-info",children:[o.jsxs("span",{children:[U,"'s Turn"]}),E&&I&&o.jsxs(o.Fragment,{children:[" | Effect from: ",o.jsxs("span",{children:[I.protocol,"-",I.value]})]}),(E==null?void 0:E.sourceCardId)==="CONTROL_MECHANIC"&&o.jsxs(o.Fragment,{children:[" | Effect from: ",o.jsx("span",{children:"Control Component"})]})]}),o.jsxs("div",{className:"phase-controller-main",children:[o.jsx("div",{className:"phase-info",children:G()}),o.jsx("div",{className:"phase-actions",children:B()})]})]})},ey={start:"Start",control:"Control",compile:"Compile",action:"Action",hand_limit:"Hand Limit",end:"End"},WC=["start","control","compile","action","hand_limit","end"],YC=({gameState:t,turn:n,difficulty:r,phaseTransitionAnimation:s,overridePhase:c,overrideTurn:d,onPlayerClick:u,onOpponentClick:p})=>{const{player:f,opponent:h}=t,[y,m]=J.useState(t.phase),[g,v]=J.useState(n),C=J.useRef(null);J.useEffect(()=>{if(C.current&&(clearTimeout(C.current),C.current=null),s){const{phaseSequence:E,duration:k}=s;if(E.length===0)return;const R=k/E.length;let D=0;const L=()=>{if(D<E.length){const I=E[D];m(I.phase),v(I.turn),D++,D<E.length&&(C.current=setTimeout(L,R))}};return L(),()=>{C.current&&(clearTimeout(C.current),C.current=null)}}if(c){m(c),v(d??n);return}m(t.phase),v(n)},[s,t.phase,n,c,d]),J.useEffect(()=>()=>{C.current&&clearTimeout(C.current)},[]);const b=E=>{const k=["info-section"];return k.push(E==="player"?"player-info":"opponent-info"),n===E&&k.push("active-turn"),k.join(" ")},x=E=>{const k=E==="player"?f:h,R=E==="player"?u:p,D=E==="player"?"Player":`Opponent${r?` (${r.charAt(0).toUpperCase()+r.slice(1)})`:""}`,L=g===E;return o.jsx("div",{className:b(E),onClick:R,children:o.jsxs("div",{className:"info-section-body",children:[o.jsx("h3",{children:D}),L&&o.jsx("span",{className:"phase-badge",children:ey[y]}),o.jsxs("div",{className:"info-line",children:[o.jsx("span",{children:"Hand:"}),o.jsx("span",{children:k.hand.length})]}),o.jsxs("div",{className:"info-line",children:[o.jsx("span",{children:"Deck:"}),o.jsx("span",{children:k.deck.length})]}),o.jsxs("div",{className:"info-line",children:[o.jsx("span",{children:"Trash:"}),o.jsx("span",{children:k.discard.length})]})]})})},j=r?` (${r.charAt(0).toUpperCase()+r.slice(1)})`:"";return o.jsxs("div",{className:"game-info-panel",children:[o.jsx("div",{className:"info-header opponent-header",children:o.jsxs("h3",{children:["Opponent",j]})}),o.jsx("div",{className:"turn-phase-indicator",children:o.jsx("div",{className:`phase-list ${g}-turn`,children:WC.map(E=>o.jsx("div",{className:`phase-item ${E===y?"active":""} ${g}-turn`,children:ey[E]},E))})}),o.jsx("div",{className:"info-header player-header",children:o.jsx("h3",{children:"Player"})}),o.jsxs("div",{className:"info-stats",children:[x("opponent"),x("player")]})]})},QC=/\b([A-Z][a-z]+(?:_custom)?)-(\d)\b/g;function Fc(t,n){return{...t,id:`preview-${t.protocol}-${t.value}`,isFaceUp:n}}function Qy(t){const n=t.match(/^([A-Z][a-z]+(?:_custom)?)-(\d)$/);return n?{protocol:n[1],value:parseInt(n[2],10)}:null}function Xy(t){const n=[];let r;const s=new RegExp(QC);for(;(r=s.exec(t))!==null;)n.push({protocol:r[1],value:parseInt(r[2],10)});return n}function ty(t,n){if(t.sourceCardRef||t.targetCardRefs&&t.targetCardRefs.length>0)return!0;if(t.sourceCard){const s=Qy(t.sourceCard);if(s&&n.some(c=>c.protocol===s.protocol&&c.value===s.value))return!0}const r=Xy(t.message);return!!(r.length>0&&r.some(s=>n.some(c=>c.protocol===s.protocol&&c.value===s.value)))}function XC(t,n){const r={source:null,targets:[]};if(t.sourceCardRef){const s=n.find(c=>c.protocol===t.sourceCardRef.protocol&&c.value===t.sourceCardRef.value);s&&(r.source=Fc(s,t.sourceCardRef.isFaceUp))}if(t.targetCardRefs&&t.targetCardRefs.length>0)for(const s of t.targetCardRefs){const c=n.find(d=>d.protocol===s.protocol&&d.value===s.value);c&&r.targets.push(Fc(c,s.isFaceUp))}if(!r.source&&r.targets.length===0){if(t.sourceCard){const c=Qy(t.sourceCard);if(c){const d=n.find(u=>u.protocol===c.protocol&&u.value===c.value);d&&(r.source=Fc(d,!0))}}const s=Xy(t.message);for(const c of s){const d=n.find(u=>u.protocol===c.protocol&&u.value===c.value);if(d){const u=Fc(d,!0);r.source?(r.source.protocol!==c.protocol||r.source.value!==c.value)&&r.targets.push(u):r.source=u}}}return r}function ZC({log:t,onClose:n}){const[r,s]=J.useState(null),[c,d]=J.useState(0),u=J.useMemo(()=>{const y=er();return[...la,...y]},[]),p=y=>{let m="";if(y.phase){const g=y.phase.charAt(0).toUpperCase()+y.phase.slice(1);m+=`[${g}] `}return y.sourceCard&&!y.message.startsWith(y.sourceCard)&&(m+=`${y.sourceCard}: `),`${m}${y.message}`},f=J.useMemo(()=>{if(r===null)return null;const y=t[r];return y?XC(y,u):null},[r,t,u]),h=(y,m)=>{ty(m,u)&&(r===y?f&&f.targets.length>1?d(g=>(g+1)%f.targets.length):(s(null),d(0)):(s(y),d(0)))};return o.jsx("div",{className:"modal-overlay",onClick:n,children:o.jsxs("div",{className:"modal-content log-modal-content log-modal-with-preview",onClick:y=>y.stopPropagation(),children:[o.jsx("button",{className:"btn btn-back modal-close-btn",onClick:n,children:"X"}),o.jsx("h2",{children:"Game Log"}),o.jsxs("div",{className:"log-content-wrapper",children:[o.jsx("div",{className:"log-preview-area log-preview-left",children:(f==null?void 0:f.source)&&o.jsx("div",{className:"log-preview-card",children:o.jsx(St,{card:f.source,isFaceUp:f.source.isFaceUp})})}),o.jsx("ol",{className:"log-list",children:t.map((y,m)=>{const g=y.indentLevel!==void 0,v=g?{paddingLeft:`${y.indentLevel*20+40}px`}:{};g&&y.indentLevel===0&&(v.fontWeight="bold");const C=ty(y,u),b=r===m;return o.jsx("li",{className:`log-entry log-entry-${y.player}${C?" log-entry-clickable":""}${b?" log-entry-selected":""}`,style:v,onClick:()=>h(m,y),children:p(y)},m)})}),o.jsx("div",{className:"log-preview-area log-preview-right",children:(f==null?void 0:f.targets)&&f.targets.length>0&&o.jsxs("div",{className:"log-preview-card",children:[o.jsx(St,{card:f.targets[c],isFaceUp:f.targets[c].isFaceUp}),f.targets.length>1&&o.jsxs("div",{className:"log-preview-counter",children:[c+1," / ",f.targets.length]})]})})]})]})})}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const KC=({message:t,player:n})=>o.jsx("div",{className:`toaster toaster-${n}`,children:t});function JC({gameState:t,targetPlayer:n,onConfirm:r}){var N;const[s]=J.useState([...t[n].protocols]),[c,d]=J.useState([...t[n].protocols]),[u,p]=J.useState([0,1,2]),f=J.useRef(null),h=J.useRef(null),y=J.useRef(0),m=J.useRef(null),g=J.useRef(0),v=((N=t.actionRequired)==null?void 0:N.type)==="prompt_rearrange_protocols"?t.actionRequired.disallowedProtocolForLane:void 0,C=J.useMemo(()=>{if(c.length!==s.length)return!1;for(let T=0;T<c.length;T++)if(c[T]!==s[T])return!0;return!1},[c,s]),b=J.useMemo(()=>{if(!v)return!1;const{laneIndex:T,protocol:q}=v;return c[T]===q},[c,v]),x=t[n],E=t[n==="player"?"opponent":"player"],k=x.laneValues,R=x.compiled,D=(T,q)=>{let O=[T];return q&&O.push("compiled"),O.join(" ")},L=(T,q)=>{f.current=q,T.dataTransfer.effectAllowed="move"},I=(T,q)=>{T.preventDefault(),h.current=q},F=()=>{if(f.current!==null&&h.current!==null&&f.current!==h.current){const T=[...c],q=[...u],O=T[f.current];T[f.current]=T[h.current],T[h.current]=O;const M=q[f.current];q[f.current]=q[h.current],q[h.current]=M,f.current=null,h.current=null,d(T),p(q)}},U=T=>{T.preventDefault()},B=(T,q)=>{m.current=q,y.current=T.touches[0].clientY,g.current=T.touches[0].clientY},G=T=>{var M;if(m.current===null)return;g.current=T.touches[0].clientY;const q=T.touches[0],O=document.elementFromPoint(q.clientX,q.clientY);if(O){const Y=O.closest(".rearrange-item");if(Y){const K=Array.from(((M=Y.parentElement)==null?void 0:M.children)||[]).indexOf(Y);K!==-1&&K!==m.current&&(h.current=K)}}},W=()=>{if(m.current!==null&&h.current!==null&&m.current!==h.current){const T=[...c],q=[...u],O=T[m.current];T[m.current]=T[h.current],T[h.current]=O;const M=q[m.current];q[m.current]=q[h.current],q[h.current]=M,d(T),p(q)}m.current=null,h.current=null,y.current=0,g.current=0},P=n==="player",z=P?"Rearrange Your Protocols":"Rearrange Opponent's Protocols",H=o.jsx("div",{className:`protocol-bar ${P?"player-bar":"opponent-bar"} rearrange-editable`,onDragOver:U,children:c.map((T,q)=>{const O=T!==s[q],M=v&&v.laneIndex===q&&T===v.protocol,Y=u[q],X=R[Y],K=D("protocol-display rearrange-item",X);return o.jsxs("div",{className:`${K} ${O?"changed":""} ${M?"violation":""}`,draggable:!0,onDragStart:ne=>L(ne,q),onDragEnter:ne=>I(ne,q),onDragEnd:F,onTouchStart:ne=>B(ne,q),onTouchMove:G,onTouchEnd:W,children:[o.jsx("span",{className:"protocol-name",children:T}),o.jsx("span",{className:"protocol-value",children:k[q]})]},`${T}-${q}`)})}),A=o.jsx("div",{className:`protocol-bar ${P?"opponent-bar":"player-bar"}`,children:E.protocols.map((T,q)=>o.jsxs("div",{className:D("protocol-display",E.compiled[q]),children:[o.jsx("span",{className:"protocol-name",children:T}),o.jsx("span",{className:"protocol-value",children:E.laneValues[q]})]},`other-proto-${T}-${q}`))});return o.jsx("div",{className:"modal-overlay",children:o.jsxs("div",{className:"modal-content rearrange-modal-content",onClick:T=>T.stopPropagation(),children:[o.jsx("h2",{children:z}),o.jsx("p",{children:"Drag and drop the protocols to reorder them. You must change the order to continue."}),v&&o.jsxs("p",{className:"warning-text",children:[" ",o.jsx("strong",{children:v.protocol})," cannot be placed on line ",o.jsx("strong",{children:v.laneIndex})," due to Anarchy-3's restriction."]}),o.jsx("div",{className:"rearrange-board-view",children:o.jsxs("div",{className:"protocol-bars-container",children:[P?A:H,P?H:A]})}),o.jsxs("div",{className:"rearrange-actions",children:[o.jsx("button",{className:"btn",onClick:()=>r(c),disabled:!C||b,children:"Confirm Rearrangement"}),b&&o.jsxs("p",{className:"error-text",children:["Cannot confirm: ",v.protocol," is on line ",v.laneIndex]})]})]})})}function eS({gameState:t,targetPlayer:n,onConfirm:r}){const[s]=J.useState([...t[n].protocols]),[c,d]=J.useState([...t[n].protocols]),[u,p]=J.useState([0,1,2]),f=J.useRef(null),h=J.useRef(null),y=J.useRef(0),m=J.useRef(null),g=J.useRef(0),v=t[n],b=t[n==="player"?"opponent":"player"],x=n==="player",j=x?"Swap Your Protocols":"Swap Opponent's Protocols",E=v.laneValues,k=v.compiled,R=J.useMemo(()=>{const T=[];for(let q=0;q<c.length;q++)c[q]!==s[q]&&T.push(q);return T},[c,s]),D=R.length===2,L=()=>R.length===2?[R[0],R[1]]:[0,0],I=(T,q)=>{let O=[T];return q&&O.push("compiled"),O.join(" ")},F=(T,q)=>{f.current=q,T.dataTransfer.effectAllowed="move"},U=(T,q)=>{T.preventDefault(),h.current=q},B=()=>{if(f.current!==null&&h.current!==null&&f.current!==h.current){const T=[...c],q=[...u],O=T[f.current];T[f.current]=T[h.current],T[h.current]=O;const M=q[f.current];q[f.current]=q[h.current],q[h.current]=M,f.current=null,h.current=null,d(T),p(q)}},G=T=>{T.preventDefault()},W=(T,q)=>{m.current=q,y.current=T.touches[0].clientY,g.current=T.touches[0].clientY},P=T=>{var M;if(m.current===null)return;g.current=T.touches[0].clientY;const q=T.touches[0],O=document.elementFromPoint(q.clientX,q.clientY);if(O){const Y=O.closest(".rearrange-item");if(Y){const K=Array.from(((M=Y.parentElement)==null?void 0:M.children)||[]).indexOf(Y);K!==-1&&K!==m.current&&(h.current=K)}}},z=()=>{if(m.current!==null&&h.current!==null&&m.current!==h.current){const T=[...c],q=[...u],O=T[m.current];T[m.current]=T[h.current],T[h.current]=O;const M=q[m.current];q[m.current]=q[h.current],q[h.current]=M,d(T),p(q)}m.current=null,h.current=null,y.current=0,g.current=0},H=o.jsx("div",{className:`protocol-bar ${x?"player-bar":"opponent-bar"} rearrange-editable`,onDragOver:G,children:c.map((T,q)=>{const O=T!==s[q],M=u[q],Y=k[M],X=I("protocol-display rearrange-item",Y);return o.jsxs("div",{className:`${X} ${O?"changed":""}`,draggable:!0,onDragStart:K=>F(K,q),onDragEnter:K=>U(K,q),onDragEnd:B,onTouchStart:K=>W(K,q),onTouchMove:P,onTouchEnd:z,children:[o.jsx("span",{className:"protocol-name",children:T}),o.jsx("span",{className:"protocol-value",children:E[q]})]},`${T}-${q}`)})}),A=o.jsx("div",{className:`protocol-bar ${x?"opponent-bar":"player-bar"}`,children:b.protocols.map((T,q)=>o.jsxs("div",{className:I("protocol-display",b.compiled[q]),children:[o.jsx("span",{className:"protocol-name",children:T}),o.jsx("span",{className:"protocol-value",children:b.laneValues[q]})]},`other-proto-${T}-${q}`))}),N=()=>R.length===0?"Drag and drop to swap exactly two protocols.":R.length===2?"Two protocols swapped - you can confirm now.":`${R.length} positions changed - swap must change exactly 2 positions.`;return o.jsx("div",{className:"modal-overlay",children:o.jsxs("div",{className:"modal-content rearrange-modal-content",onClick:T=>T.stopPropagation(),children:[o.jsx("h2",{children:j}),o.jsx("p",{children:N()}),o.jsx("div",{className:"rearrange-board-view",children:o.jsxs("div",{className:"protocol-bars-container",children:[x?A:H,x?H:A]})}),o.jsxs("div",{className:"rearrange-actions",children:[o.jsx("button",{className:"btn",onClick:()=>r(L()),disabled:!D,children:"Confirm Swap"}),R.length>2&&o.jsx("p",{className:"error-text",children:"Too many changes! Swap only exchanges two protocols."})]})]})})}function tS({gameState:t,onConfirm:n}){const[r,s]=J.useState(null),c=p=>{s(p)},d=()=>{r!==null&&n(r)},u=p=>{let f=["number-button"];return r===p&&f.push("selected"),f.join(" ")};return o.jsx("div",{className:"modal-overlay",children:o.jsxs("div",{className:"modal-content state-number-modal",onClick:p=>p.stopPropagation(),children:[o.jsx("h2",{children:"State a Number"}),o.jsx("p",{children:"Choose a number (0-5) to state. Cards drawn with this value may be revealed and played."}),o.jsx("div",{className:"number-selection",children:[0,1,2,3,4,5].map(p=>o.jsx("button",{className:u(p),onClick:()=>c(p),children:p},p))}),o.jsx("div",{className:"modal-actions",children:o.jsx("button",{className:"btn",onClick:d,disabled:r===null,children:"Confirm"})})]})})}function nS({gameState:t,availableProtocols:n,onConfirm:r}){const[s,c]=J.useState(null),d=f=>{c(f)},u=()=>{s!==null&&r(s)},p=f=>{let h=["protocol-button"];return s===f&&h.push("selected"),h.join(" ")};return o.jsx("div",{className:"modal-overlay",children:o.jsxs("div",{className:"modal-content state-protocol-modal",onClick:f=>f.stopPropagation(),children:[o.jsx("h2",{children:"State a Protocol"}),o.jsx("p",{children:"Choose a protocol from your opponent's cards. If the discarded card matches, you'll delete a card."}),o.jsx("div",{className:"protocol-selection",children:n.map(f=>o.jsx("button",{className:p(f),onClick:()=>d(f),children:f},f))}),o.jsx("div",{className:"modal-actions",children:o.jsx("button",{className:"btn",onClick:u,disabled:s===null,children:"Confirm"})})]})})}function aS({gameState:t,allDrawnCardIds:n,eligibleCardIds:r,statedNumber:s,revealCount:c=1,onConfirm:d,onClose:u}){const[p,f]=J.useState(null),h=J.useRef(!1),y=t.player.hand.filter(j=>n.includes(j.id)),m=j=>r.includes(j),g=r.length>0;J.useEffect(()=>{if(!h.current&&r.length>0){const j=y.find(E=>m(E.id));j&&(f(j),h.current=!0)}},[y,r]);const v=j=>{m(j.id)&&f(j)},C=j=>{m(j.id)&&f(j)},b=()=>{p&&m(p.id)&&d(p.id)},x=()=>{u&&u()};return o.jsx("div",{className:"modal-overlay",children:o.jsxs("div",{className:"modal-content revealed-deck-modal",onClick:j=>j.stopPropagation(),children:[o.jsx("h2",{children:"Cards Drawn"}),s!==void 0?o.jsxs("p",{children:["Select a card with value ",o.jsx("strong",{children:s})," to reveal:"]}):o.jsx("p",{children:"Select a card to reveal:"}),o.jsxs("div",{className:"revealed-deck-content-wrapper",children:[o.jsx("div",{className:"revealed-deck-preview-area",children:p?o.jsxs("div",{className:"revealed-deck-preview-card",children:[o.jsx(St,{card:p,isFaceUp:!0}),o.jsxs("button",{className:"btn preview-confirm-btn",onClick:b,children:["Reveal ",p.protocol,"-",p.value]})]}):o.jsx("div",{className:"revealed-deck-preview-card no-selection",children:o.jsx("p",{className:"no-match-message",children:g?"Select an eligible card":`No cards match value ${s}`})})}),o.jsx("div",{className:"revealed-deck-grids-area",children:o.jsx("div",{className:"revealed-deck-card-grid",children:y.length>0?y.map(j=>{const E=m(j.id),k=(p==null?void 0:p.id)===j.id;return o.jsx("div",{onClick:R=>{R.stopPropagation(),C(j)},onMouseEnter:()=>v(j),style:{cursor:E?"pointer":"default"},children:o.jsx(St,{card:j,isFaceUp:!0,additionalClassName:`in-hand ${E?k?"highlight-selectable":"":"dimmed"}`})},j.id)}):o.jsx("p",{className:"no-cards",children:"No cards drawn."})})})]}),!g&&o.jsx("div",{className:"modal-actions",children:o.jsx("button",{className:"btn",onClick:x,children:"Continue"})})]})})}function oS({gameState:t,onSelectCard:n,onConfirmProtocolDraw:r}){var W;const[s,c]=J.useState(null),[d,u]=J.useState(null),p=J.useRef(!1),f=d||s,h=t.actionRequired,y=(h==null?void 0:h.type)==="reveal_deck_draw_protocol",m=h==null?void 0:h.revealedCards,g=h==null?void 0:h.selectableCardIds,v=(h==null?void 0:h.autoSelectedIndices)||[],C=h==null?void 0:h.targetProtocol,b=m||(h!=null&&h.actor?(W=t[h.actor])==null?void 0:W.deck:[])||[],x=J.useMemo(()=>b.map((P,z)=>({...P,id:P.id||`deck-${z}`,deckIndex:z,isFaceUp:!0})),[b]),j=J.useMemo(()=>y?x.filter((P,z)=>v.includes(z)):[],[y,x,v]);if(J.useEffect(()=>{if((h==null?void 0:h.type)==="select_card_from_revealed_deck"&&(g==null?void 0:g.length)>0&&!p.current){const P=x.find(z=>g.includes(z.id));P&&(c(P),p.current=!0)}},[h==null?void 0:h.type,g,x]),J.useEffect(()=>{(!h||h.type!=="select_card_from_revealed_deck"&&h.type!=="reveal_deck_draw_protocol")&&(p.current=!1,c(null),u(null))},[h]),!h||h.type!=="select_card_from_revealed_deck"&&h.type!=="reveal_deck_draw_protocol")return null;const{valueFilter:E}=h,k=P=>y?!1:g==null?void 0:g.includes(P),R=P=>y&&v.includes(P),D=P=>{(y||k(P.id))&&u(P)},L=()=>{u(null)},I=P=>{!y&&k(P.id)&&c(P)},F=()=>{y?r==null||r():f&&k(f.id)&&n(f.id)},U=y?"Revealed Deck":"Your Revealed Deck",B=y?`All ${C} cards will be drawn (${j.length} found):`:`Select a card with value ${E} to draw:`,G=y?j.length>0?`Draw ${j.length} ${C} card${j.length!==1?"s":""}`:"Confirm (no matching cards)":f?`Draw ${f.protocol}-${f.value}`:"Select a card";return o.jsx("div",{className:"modal-overlay",children:o.jsxs("div",{className:"modal-content revealed-deck-modal",onClick:P=>P.stopPropagation(),children:[o.jsx("h2",{children:U}),o.jsx("p",{children:B}),o.jsxs("div",{className:"revealed-deck-content-wrapper",children:[o.jsx("div",{className:"revealed-deck-preview-area",children:y?o.jsxs("div",{className:"revealed-deck-preview-card",children:[f&&o.jsx(St,{card:f,isFaceUp:!0}),o.jsx("button",{className:"btn preview-confirm-btn",onClick:F,children:G})]}):f&&o.jsxs("div",{className:"revealed-deck-preview-card",children:[o.jsx(St,{card:f,isFaceUp:!0}),o.jsx("button",{className:"btn preview-confirm-btn",onClick:F,children:G})]})}),o.jsx("div",{className:"revealed-deck-grids-area",children:o.jsx("div",{className:"revealed-deck-card-grid",children:x.length>0?x.map(P=>{const z=k(P.id),H=R(P.deckIndex),A=(s==null?void 0:s.id)===P.id,T=(d==null?void 0:d.id)===P.id||A,q=H||z&&T,O=y?!H:!z;return o.jsx("div",{onClick:M=>{M.stopPropagation(),I(P)},onMouseEnter:()=>D(P),onMouseLeave:L,style:{cursor:z?"pointer":"default"},children:o.jsx(St,{card:P,isFaceUp:!0,additionalClassName:`in-hand ${q?"highlight-selectable":""} ${O?"dimmed":""} ${A||H?"selected-card":""}`})},P.id)}):o.jsx("p",{className:"no-cards",children:"No cards in deck."})})})]})]})})}function rS({gameState:t,onAccept:n,onDecline:r}){var m,g;const s=t.actionRequired;if(!s||s.type!=="prompt_optional_effect")return null;const c=s.effectDef;if(!c||((m=c.params)==null?void 0:m.action)!=="discard"||!((g=c.params)!=null&&g.useCardFromPreviousEffect))return null;const d=t.lastCustomEffectTargetCardId;if(!d)return null;const u=s.actor||"player",f=t[u].deck.find(v=>v.id===d);if(!f)return null;const h={...f,id:f.id||"revealed-top",isFaceUp:!0},y=`${f.protocol}-${f.value}`;return o.jsx("div",{className:"modal-overlay",children:o.jsxs("div",{className:"modal-content revealed-deck-top-modal",onClick:v=>v.stopPropagation(),children:[o.jsx("h2",{children:"Revealed: Top Card of Your Deck"}),o.jsx("p",{children:"You may discard this card:"}),o.jsx("div",{className:"revealed-card-display",children:o.jsx(St,{card:h,isFaceUp:!0})}),o.jsxs("div",{className:"revealed-deck-top-actions",children:[o.jsxs("button",{className:"btn",onClick:n,children:["Discard ",y]}),o.jsx("button",{className:"btn btn-back",onClick:r,children:"Keep in Deck"})]})]})})}function lS({discardedCard:t,deckOwner:n,onConfirm:r}){const s=n==="own"?"your":"opponent's",c={...t,id:t.id||"deck-discard-preview",isFaceUp:!0};return o.jsx("div",{className:"modal-overlay",children:o.jsxs("div",{className:"modal-content deck-discard-modal",onClick:d=>d.stopPropagation(),children:[o.jsx("h2",{children:"Card Discarded"}),o.jsxs("p",{children:["From the top of ",o.jsx("strong",{children:s})," deck:"]}),o.jsx("div",{className:"deck-discard-preview-content",children:o.jsx("div",{className:"deck-discard-preview-card",children:o.jsx(St,{card:c,isFaceUp:!0})})}),o.jsx("div",{className:"modal-actions",children:o.jsx("button",{className:"btn",onClick:r,children:"Continue"})})]})})}function sS({card:t,isFaceDown:n,onConfirm:r}){const s=n?"face-down":"face-up";return o.jsx("div",{className:"modal-overlay",children:o.jsxs("div",{className:"modal-content deck-play-preview-modal",onClick:c=>c.stopPropagation(),children:[o.jsx("h2",{children:"Card from Deck"}),o.jsxs("p",{children:["You will play this card ",o.jsx("strong",{children:s}),":"]}),o.jsx("div",{className:"deck-play-preview-content",children:o.jsx("div",{className:"deck-play-preview-card",children:o.jsx(St,{card:t,isFaceUp:!0})})}),o.jsx("div",{className:"modal-actions",children:o.jsx("button",{className:"btn",onClick:r,children:"Select Lane"})})]})})}function ny({gameState:t,onSelectCard:n}){var G,W,P,z;const[r,s]=J.useState(null),[c,d]=J.useState(null),[u,p]=J.useState(null),[f,h]=J.useState(null),y=J.useRef(!1),m=u||r,g=f!==null?f:c,v=t.actionRequired,C=v==null?void 0:v.actor,b=(v==null?void 0:v.trashOwner)||"own";let x=[];b==="own"?x=C?((G=t[C])==null?void 0:G.discard)||[]:[]:b==="opponent"?x=((W=t[C==="player"?"opponent":"player"])==null?void 0:W.discard)||[]:b==="any"&&(x=[...((P=t.player)==null?void 0:P.discard)||[],...((z=t.opponent)==null?void 0:z.discard)||[]]);const j=J.useMemo(()=>(x||[]).map((H,A)=>({...H,id:H.id||`trash-${A}`,isFaceUp:!0,_trashIndex:A})),[x]);J.useEffect(()=>{((v==null?void 0:v.type)==="select_card_from_trash_to_play"||(v==null?void 0:v.type)==="select_card_from_trash_to_reveal")&&j.length>0&&!y.current&&(s(j[0]),d(0),y.current=!0)},[v==null?void 0:v.type,j]),J.useEffect(()=>{const H=(v==null?void 0:v.type)==="select_card_from_trash_to_play"||(v==null?void 0:v.type)==="select_card_from_trash_to_reveal";(!v||!H)&&(y.current=!1,s(null),d(null),p(null),h(null))},[v]);const E=(v==null?void 0:v.type)==="select_card_from_trash_to_play"||(v==null?void 0:v.type)==="select_card_from_trash_to_reveal";if(!v||!E)return null;const k=v.type==="select_card_from_trash_to_play",R=k?"Select Card to Play":"Select Card to Reveal",D=b==="opponent"?"opponent's":b==="any"?"any player's":"your",L=k?`Select a card from ${D} trash to play:`:`Select a card from ${D} trash to reveal:`,I=(H,A)=>{p(H),h(A)},F=()=>{p(null),h(null)},U=(H,A)=>{s(H),d(A)},B=()=>{m&&g!==null&&n(g)};return o.jsx("div",{className:"modal-overlay",children:o.jsxs("div",{className:"modal-content revealed-deck-modal",onClick:H=>H.stopPropagation(),children:[o.jsx("h2",{children:R}),o.jsx("p",{children:L}),o.jsxs("div",{className:"revealed-deck-content-wrapper",children:[o.jsx("div",{className:"revealed-deck-preview-area",children:m&&o.jsxs("div",{className:"revealed-deck-preview-card",children:[o.jsx(St,{card:m,isFaceUp:!0}),o.jsxs("button",{className:"btn preview-confirm-btn",onClick:B,children:[k?"Play":"Reveal"," ",m.protocol,"-",m.value]})]})}),o.jsx("div",{className:"revealed-deck-grids-area",children:o.jsx("div",{className:"revealed-deck-card-grid",children:j.length>0?j.map((H,A)=>{const N=c===A,q=f===A||N;return o.jsx("div",{onClick:O=>{O.stopPropagation(),U(H,A)},onMouseEnter:()=>I(H,A),onMouseLeave:F,style:{cursor:"pointer"},children:o.jsx(St,{card:H,isFaceUp:!0,additionalClassName:`in-hand ${q?"highlight-selectable":""} ${N?"selected-card":""}`})},H.id)}):o.jsx("p",{className:"no-cards",children:"No cards in trash."})})})]})]})})}function cS({player:t,playerState:n,onClose:r,difficulty:s}){const c=t==="player"?"Player":`Opponent${s?` (${s.charAt(0).toUpperCase()+s.slice(1)})`:""}`,[d,u]=J.useState(null),p=h=>{u(h)},f=(h,y,m)=>{const g=h.map((v,C)=>({...v,id:`${y}-${v.protocol}-${v.value}-${C}`,isFaceUp:m}));return o.jsxs(o.Fragment,{children:[o.jsxs("h3",{children:[y," (",g.length,")"]}),o.jsx("div",{className:"debug-card-grid",children:g.length>0?g.map(v=>o.jsx("div",{onClick:C=>{C.stopPropagation(),u(v)},onMouseEnter:()=>p(v),onMouseLeave:()=>p(null),style:{cursor:"pointer"},children:o.jsx(St,{card:v,isFaceUp:m,additionalClassName:"in-hand"})},v.id)):o.jsxs("p",{className:"no-cards",children:["No cards in ",y.toLowerCase(),"."]})})]})};return o.jsx("div",{className:"modal-overlay",onClick:r,children:o.jsxs("div",{className:"modal-content debug-modal-content debug-modal-with-preview",onClick:h=>h.stopPropagation(),children:[o.jsx("button",{className:"btn btn-back modal-close-btn",onClick:r,children:"X"}),o.jsxs("h2",{children:[c,"'s Info"]}),o.jsxs("div",{className:"debug-content-wrapper",children:[o.jsx("div",{className:"debug-preview-area",children:d&&o.jsx("div",{className:"debug-preview-card",children:o.jsx(St,{card:d,isFaceUp:d.isFaceUp})})}),o.jsxs("div",{className:"debug-grids-area",children:[f(n.deck,"Deck",!1),f(n.discard,"Discard Pile",!0)]})]})]})})}function iS({onComplete:t}){const[n,r]=J.useState("choose"),[s,c]=J.useState(null),[d,u]=J.useState(null),[p,f]=J.useState(!1),h=m=>{c(m),r("flipping"),f(!0);const g=Math.random()<.5?"heads":"tails";setTimeout(()=>{u(g),f(!1),r("result")},2e3)},y=()=>{if(d===null||s===null)return;const m=d===s;t(m?"player":"opponent",s,m)};return o.jsx("div",{className:"coin-flip-modal-overlay",children:o.jsxs("div",{className:"modal-content coin-flip-modal-content",onClick:m=>m.stopPropagation(),children:[n==="choose"&&o.jsxs(o.Fragment,{children:[o.jsx("h2",{children:"Coin Flip"}),o.jsx("p",{children:"Choose heads or tails to determine who starts the game."}),o.jsxs("div",{className:"coin-flip-choices",children:[o.jsxs("button",{className:"btn coin-flip-choice-btn",onClick:()=>h("heads"),children:[o.jsx("div",{className:"coin-choice-icon",children:"H"}),o.jsx("div",{className:"coin-choice-label",children:"Heads"})]}),o.jsxs("button",{className:"btn coin-flip-choice-btn",onClick:()=>h("tails"),children:[o.jsx("div",{className:"coin-choice-icon",children:"T"}),o.jsx("div",{className:"coin-choice-label",children:"Tails"})]})]})]}),n==="flipping"&&o.jsxs(o.Fragment,{children:[o.jsx("h2",{children:"Flipping..."}),o.jsxs("p",{children:["You chose: ",o.jsx("span",{className:"coin-flip-highlight",children:s==="heads"?"Heads":"Tails"})]}),o.jsx("div",{className:"coin-flip-animation-container",children:o.jsxs("div",{className:`coin-3d ${p?"is-flipping":""}`,children:[o.jsx("div",{className:"coin-face coin-heads",children:"H"}),o.jsx("div",{className:"coin-face coin-tails",children:"T"})]})})]}),n==="result"&&d&&s&&o.jsxs(o.Fragment,{children:[o.jsx("h2",{children:"Result"}),o.jsxs("p",{children:["You chose: ",o.jsx("span",{className:"coin-flip-highlight",children:s==="heads"?"Heads":"Tails"})]}),o.jsx("div",{className:"coin-flip-animation-container",children:o.jsxs("div",{className:`coin-3d result-${d}`,children:[o.jsx("div",{className:"coin-face coin-heads",children:"H"}),o.jsx("div",{className:"coin-face coin-tails",children:"T"})]})}),o.jsxs("p",{className:"coin-flip-result-text",children:["The coin landed on: ",o.jsx("span",{className:"coin-flip-highlight",children:d==="heads"?"Heads":"Tails"})]}),d===s?o.jsx("p",{className:"coin-flip-winner-text",children:"You won! You will start the game."}):o.jsx("p",{className:"coin-flip-loser-text",children:"Opponent won! Opponent will start the game."}),o.jsx("button",{className:"btn",onClick:y,children:"Continue"})]})]})})}const dS="anarchy-custom-001",uS="Anarchy",pS="Custom recreation of Anarchy protocol to validate editor capabilities",fS="System Validation",hS="2025-11-08T00:00:00.000Z",mS="#8B0000",yS="chaos",gS=[{value:0,topEffects:[],middleEffects:[{id:"anarchy-0-shift",params:{action:"shift",targetFilter:{owner:"any",position:"uncovered",faceState:"any"}},position:"middle",trigger:"on_play"},{id:"anarchy-0-draw",params:{action:"draw",count:1,target:"self",source:"own_deck",conditional:{type:"non_matching_protocols"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[{id:"anarchy-1-passive",params:{action:"passive_rule",rule:{type:"require_non_matching_protocol",target:"all",scope:"global"}},position:"top",trigger:"passive"}],middleEffects:[{id:"anarchy-1-shift",params:{action:"shift",targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!0},destinationRestriction:{type:"non_matching_protocol"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"anarchy-2-delete",params:{action:"delete",count:1,targetFilter:{position:"any",faceState:"face_up"},protocolMatching:"must_match",excludeSelf:!1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"anarchy-3-swap",params:{action:"swap_protocols",target:"opponent"},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"anarchy-3-end-rearrange",params:{action:"rearrange_protocols",target:"own",restriction:{disallowedProtocol:"Anarchy",laneIndex:"current"}},position:"bottom",trigger:"end"}]},{value:5,topEffects:[],middleEffects:[{id:"anarchy-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:6,topEffects:[{id:"anarchy-6-start-flip",params:{action:"flip",count:1,flipSelf:!0,optional:!1,targetFilter:{owner:"any",position:"any",faceState:"any",excludeSelf:!1},advancedConditional:{type:"protocol_match",protocol:"Anarchy"}},position:"top",trigger:"start"}],middleEffects:[],bottomEffects:[]}],vS="Fan-Content",Zy={id:dS,name:uS,description:pS,author:fS,createdAt:hS,color:mS,pattern:yS,cards:gS,category:vS},_S="apathy_custom",wS="Apathy",xS="Custom implementation of Apathy protocol",CS="System",SS="2025-01-08T00:00:00Z",bS="#9E9E9E",ES="radial",jS=[{value:0,topEffects:[{id:"apathy-0-value-modifier",params:{action:"value_modifier",modifier:{type:"add_per_condition",value:1,condition:"per_face_down_card",target:"own_total",scope:"this_lane"}},position:"top",trigger:"passive"}],middleEffects:[],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"apathy-1-flip-all",params:{action:"flip",count:"all",optional:!1,scope:"this_lane",targetFilter:{owner:"any",position:"any",faceState:"face_up",excludeSelf:!0}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:2,topEffects:[{id:"apathy-2-passive",params:{action:"passive_rule",rule:{type:"ignore_middle_commands",target:"all",scope:"this_lane"}},position:"top",trigger:"passive"}],middleEffects:[],bottomEffects:[{id:"apathy-2-on-cover",params:{action:"flip",count:1,flipSelf:!0,optional:!1,targetFilter:{owner:"any",position:"any",faceState:"any",excludeSelf:!1}},position:"bottom",trigger:"on_cover"}]},{value:3,topEffects:[],middleEffects:[{id:"apathy-3-flip-opponent",params:{action:"flip",count:1,optional:!1,targetFilter:{owner:"opponent",position:"uncovered",faceState:"face_up",excludeSelf:!1}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"apathy-4-flip-covered",params:{action:"flip",count:1,optional:!0,targetFilter:{owner:"own",position:"covered",faceState:"face_up",excludeSelf:!1}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"apathy-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],kS="Aux 1",Ky={id:_S,name:wS,description:xS,author:CS,createdAt:SS,color:bS,pattern:ES,cards:jS,category:kS},RS="assimilation-custom-001",NS="Assimilation",TS="Absorb your opponent's resources. Draw from their deck, steal their cards, and infiltrate their board.",DS="System",AS="2025-12-18T00:00:00.000Z",FS="#8B008B",IS="radial",$S=[{value:0,topEffects:[],middleEffects:[{id:"assimilation-0-steal-facedown",params:{action:"return",count:1,targetFilter:{owner:"opponent",position:"any",faceState:"face_down"},destination:"actor_hand"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"assimilation-1-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"},{id:"assimilation-1-refresh",params:{action:"refresh",target:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"assimilation-1-reactive-draw",params:{action:"draw",count:1,target:"self",source:"opponent_deck"},position:"bottom",trigger:"after_refresh",reactiveTriggerActor:"any",conditional:{type:"then",thenEffect:{id:"assimilation-1-reactive-discard",params:{action:"discard",count:1,actor:"self",discardTo:"opponent_trash"},position:"bottom",trigger:"on_play"}}}]},{value:2,topEffects:[],middleEffects:[],bottomEffects:[{id:"assimilation-2-play-opponent-deck",params:{action:"play",source:"deck",sourceOwner:"opponent",count:1,faceDown:!0,destinationRule:{type:"specific_lane",laneIndex:"current"}},position:"bottom",trigger:"end"}]},{value:4,topEffects:[],middleEffects:[{id:"assimilation-4-draw-opponent-deck",params:{action:"draw",count:1,target:"self",source:"opponent_deck"},position:"middle",trigger:"on_play"},{id:"assimilation-4-opponent-draw-own-deck",params:{action:"draw",count:1,target:"opponent",source:"own_deck"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"assimilation-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:6,topEffects:[],middleEffects:[],bottomEffects:[{id:"assimilation-6-play-to-opponent-board",params:{action:"play",source:"deck",count:1,faceDown:!0,destinationRule:{type:"specific_lane",laneIndex:"current"},targetBoard:"opponent"},position:"bottom",trigger:"end"}]}],PS="Aux 2",Jy={id:RS,name:NS,description:TS,author:DS,createdAt:AS,color:FS,pattern:IS,cards:$S,category:PS},qS="chaos_custom_1",LS="Chaos",US="Embrace the unpredictable. Custom protocol migration of original Chaos protocol.",OS="#E64DB8",MS="chaos",HS=[{value:0,topEffects:[],middleEffects:[{id:"chaos_0_flip_covered",trigger:"on_play",params:{action:"flip",count:1,scope:"each_lane",targetFilter:{owner:"any",position:"covered",faceState:"any"}},position:"middle"}],bottomEffects:[{id:"chaos_0_start_swap_draws",trigger:"start",params:{action:"mutual_draw",count:1},position:"bottom"}]},{value:1,topEffects:[],middleEffects:[{id:"chaos_1_rearrange_own",trigger:"on_play",params:{action:"rearrange_protocols",target:"own"},position:"middle"},{id:"chaos_1_rearrange_opponent",trigger:"on_play",params:{action:"rearrange_protocols",target:"opponent"},position:"middle"}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"chaos_2_shift_covered",trigger:"on_play",params:{action:"shift",count:1,targetFilter:{owner:"own",position:"covered",faceState:"any"}},position:"middle"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[],bottomEffects:[{id:"chaos_3_ignore_protocol",trigger:"passive",params:{action:"card_property",property:"ignore_protocol_matching"},position:"bottom"}]},{value:4,topEffects:[],middleEffects:[],bottomEffects:[{id:"chaos_4_end_discard_draw",trigger:"end",params:{action:"discard",count:"all",actor:"self"},conditional:{type:"then",thenEffect:{id:"chaos_4_draw_after_discard",trigger:"on_play",params:{action:"draw",count:1,countType:"equal_to_discarded",countOffset:0,target:"self",source:"own_deck"},position:"bottom"}},position:"bottom"}]},{value:5,topEffects:[],middleEffects:[{id:"chaos_5_discard",trigger:"on_play",params:{action:"discard",count:1,actor:"self"},position:"middle"}],bottomEffects:[]}],VS="Main 2",eg={id:qS,name:LS,description:US,color:OS,pattern:MS,cards:HS,category:VS},zS="darkness_custom_v1",BS="Darkness",GS="Custom Darkness protocol - manipulate face-down cards, flip and shift",WS="System",YS="2025-01-08T00:00:00Z",QS="#1a0033",XS="grid",ZS=[{value:0,topEffects:[],middleEffects:[{id:"dark-0-draw",params:{action:"draw",count:3,target:"self",source:"own_deck"},position:"middle",trigger:"on_play"},{id:"dark-0-shift",params:{action:"shift",targetFilter:{owner:"opponent",position:"covered",faceState:"any",excludeSelf:!1},destinationRestriction:{type:"any"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"dark-1-flip",params:{action:"flip",count:1,optional:!1,targetFilter:{owner:"opponent",position:"uncovered",faceState:"any",excludeSelf:!1}},position:"middle",trigger:"on_play"},{id:"dark-1-shift",params:{action:"shift",optional:!0,targetFilter:{owner:"any",position:"any",faceState:"any",excludeSelf:!1},destinationRestriction:{type:"any"}},position:"middle",trigger:"on_play",useCardFromPreviousEffect:!0}],bottomEffects:[]},{value:2,topEffects:[{id:"dark-2-value-modifier",params:{action:"value_modifier",modifier:{type:"set_to_fixed",value:4,target:"own_cards",scope:"this_lane",filter:{faceState:"face_down",position:"any"}}},position:"top",trigger:"passive"}],middleEffects:[{id:"dark-2-flip",params:{action:"flip",count:1,optional:!0,scope:"this_lane",targetFilter:{owner:"any",position:"covered",faceState:"any",excludeSelf:!1}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"dark-3-play",params:{action:"play",source:"hand",count:1,faceDown:!0,destinationRule:{type:"other_lines",excludeCurrentLane:!0}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"dark-4-shift",params:{action:"shift",targetFilter:{owner:"any",position:"uncovered",faceState:"face_down",excludeSelf:!1},destinationRestriction:{type:"any"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"dark-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],KS="Main 1",tg={id:zS,name:BS,description:GS,author:WS,createdAt:YS,color:QS,pattern:XS,cards:ZS,category:KS},JS="death_custom_v1",e1="Death",t1="Custom Death protocol - delete cards with various conditions",n1="System",a1="2025-01-09T00:00:00Z",o1="#8B0000",r1="stripes",l1=[{value:0,topEffects:[],middleEffects:[{id:"death-0-delete-from-each-lane",params:{action:"delete",count:1,scope:{type:"each_other_line"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[{id:"death-1-optional-draw",params:{action:"draw",count:1,optional:!0},position:"top",trigger:"start",conditional:{type:"if_executed",thenEffect:{id:"death-1-delete-other",params:{action:"delete",count:1,excludeSelf:!0},position:"top",trigger:"start",conditional:{type:"then",thenEffect:{id:"death-1-delete-self",params:{action:"delete",count:1,targetFilter:{position:"any",owner:"own"},deleteSelf:!0},position:"top",trigger:"start"}}}}}],middleEffects:[],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"death-2-delete-lane-values",params:{action:"delete",count:"all",selectLane:!0,targetFilter:{faceState:"any",valueRange:{min:1,max:2}}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"death-3-delete-facedown",params:{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"face_down"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"death-4-delete-low-value",params:{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"face_up",valueRange:{min:0,max:1}}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"death-5-discard",params:{action:"discard",count:1},position:"middle",trigger:"on_play"}],bottomEffects:[]}],s1="Main 1",ng={id:JS,name:e1,description:t1,author:n1,createdAt:a1,color:o1,pattern:r1,cards:l1,category:s1},c1="fire-custom-001",i1="Fire",d1="Fire protocol - discard cards to fuel powerful effects",u1="System",p1="2025-11-09T00:00:00.000Z",f1="#F06838",h1="radial",m1=[{value:0,topEffects:[],middleEffects:[{id:"fire-0-flip",params:{action:"flip",count:1,targetFilter:{excludeSelf:!0}},position:"middle",trigger:"on_play"},{id:"fire-0-draw",params:{action:"draw",count:2},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"fire-0-oncover-draw",params:{action:"draw",count:1},position:"bottom",trigger:"on_cover",conditional:{type:"then",thenEffect:{id:"fire-0-oncover-flip",params:{action:"flip",count:1,targetFilter:{excludeSelf:!0}},position:"bottom",trigger:"on_cover"}}}]},{value:1,topEffects:[],middleEffects:[{id:"fire-1-discard",params:{action:"discard",count:1},position:"middle",trigger:"on_play",conditional:{type:"if_executed",thenEffect:{id:"fire-1-delete",params:{action:"delete",count:1},position:"middle",trigger:"on_play"}}}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"fire-2-discard",params:{action:"discard",count:1},position:"middle",trigger:"on_play",conditional:{type:"if_executed",thenEffect:{id:"fire-2-return",params:{action:"return",count:1,targetFilter:{position:"uncovered"}},position:"middle",trigger:"on_play"}}}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[],bottomEffects:[{id:"fire-3-discard",params:{action:"discard",count:1,optional:!0},position:"bottom",trigger:"end",conditional:{type:"if_executed",thenEffect:{id:"fire-3-flip",params:{action:"flip",count:1},position:"bottom",trigger:"end"}}}]},{value:4,topEffects:[],middleEffects:[{id:"fire-4-discard-variable",params:{action:"discard",count:1,variableCount:!0},position:"middle",trigger:"on_play",conditional:{type:"then",thenEffect:{id:"fire-4-draw-based-on-discard",params:{action:"draw",countType:"equal_to_discarded",countOffset:1},position:"middle",trigger:"on_play"}}}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"fire-5-discard",params:{action:"discard",count:1,optional:!1},position:"middle",trigger:"on_play"}],bottomEffects:[]}],y1="Main 1",ag={id:c1,name:i1,description:d1,author:u1,createdAt:p1,color:f1,pattern:h1,cards:m1,category:y1},g1="frost_custom_1",v1="Frost",_1="Freeze the game state. Frost blocks actions and preserves face-down cards.",w1="#87CEEB",x1="frost",C1=[{value:0,topEffects:[],middleEffects:[{id:"frost_0_draw_per_face_down",trigger:"on_play",position:"middle",params:{action:"draw",count:1,source:"own_deck",target:"self",countType:"count_face_down"}}],bottomEffects:[]},{value:1,topEffects:[{id:"frost_1_block_flips",trigger:"passive",position:"top",params:{action:"passive_rule",rule:{type:"block_flips",target:"all",scope:"global"}}}],middleEffects:[],bottomEffects:[{id:"frost_1_block_rearrange",trigger:"passive",position:"bottom",params:{action:"passive_rule",rule:{type:"block_protocol_rearrange",target:"all",scope:"global"}}}]},{value:2,topEffects:[],middleEffects:[{id:"frost_2_play_face_down",trigger:"on_play",position:"middle",params:{action:"play",count:1,source:"hand",faceDown:!0}}],bottomEffects:[]},{value:3,topEffects:[{id:"frost_3_block_shifts",trigger:"passive",position:"top",params:{action:"passive_rule",rule:{type:"block_shifts_from_and_to_lane",target:"all",scope:"this_lane"}}}],middleEffects:[],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"frost_4_flip_covered",trigger:"on_play",position:"middle",params:{action:"flip",count:1,optional:!0,targetFilter:{owner:"own",faceState:"face_up",position:"covered"}}}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"frost_5_discard",trigger:"on_play",position:"middle",params:{action:"discard",count:1,target:"self"}}],bottomEffects:[]}],S1="Fan-Content",og={id:g1,name:v1,description:_1,color:w1,pattern:x1,cards:C1,category:S1},b1="hate-custom-001",E1="Hate",j1="Focused on deletion and sacrifice. Delete cards to gain advantage.",k1="System Migration",R1="2025-11-13T00:00:00.000Z",N1="#E67A7A",T1="diagonal-lines",D1=[{value:0,topEffects:[],middleEffects:[{id:"hate-0-delete",params:{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"any"},scope:{type:"anywhere"},excludeSelf:!1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"hate-1-discard",params:{action:"discard",count:3,actor:"self",upTo:!0},position:"middle",trigger:"on_play"},{id:"hate-1-delete-1",params:{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"any"},scope:{type:"anywhere"},excludeSelf:!1,upTo:!0},position:"middle",trigger:"on_play"},{id:"hate-1-delete-2",params:{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"any"},scope:{type:"anywhere"},excludeSelf:!1,upTo:!0},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"hate-2-delete-own",params:{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"any",calculation:"highest_value",owner:"own"},scope:{type:"anywhere"},excludeSelf:!1},position:"middle",trigger:"on_play"},{id:"hate-2-delete-opponent",params:{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"any",calculation:"highest_value",owner:"opponent"},scope:{type:"anywhere"},excludeSelf:!1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[{id:"hate-3-reactive-draw",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"top",trigger:"after_delete",reactiveTriggerActor:"self"}],middleEffects:[],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[],bottomEffects:[{id:"hate-4-on-cover-delete",params:{action:"delete",count:1,targetFilter:{position:"covered_by_context",faceState:"any",calculation:"lowest_value"},scope:{type:"this_line"},excludeSelf:!1,autoExecute:!0},position:"bottom",trigger:"on_cover"}]},{value:5,topEffects:[],middleEffects:[{id:"hate-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],A1="Aux 1",rg={id:b1,name:E1,description:j1,author:k1,createdAt:R1,color:N1,pattern:T1,cards:D1,category:A1},F1="water_custom_1",I1="Water",$1="Wash away and renew. Custom protocol migration of original Water protocol.",P1="#5DADE2",q1="multi-radial",L1=[{value:0,topEffects:[],middleEffects:[{id:"water_0_flip_other",trigger:"immediate",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!0},optional:!1},position:"middle"},{id:"water_0_flip_self",trigger:"immediate",params:{action:"flip",flipSelf:!0},position:"middle"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"water_1_play",trigger:"immediate",params:{action:"play",source:"deck",count:1,faceDown:!0,destinationRule:{type:"each_other_line"}},position:"middle"}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"water_2_draw",trigger:"immediate",params:{action:"draw",count:2},position:"middle"},{id:"water_2_rearrange",trigger:"immediate",params:{action:"rearrange_protocols",target:"own"},position:"middle"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"water_3_return",trigger:"immediate",params:{action:"return",count:"all",targetFilter:{owner:"any",position:"uncovered",valueEquals:2},selectLane:!0},position:"middle"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"water_4_return",trigger:"immediate",params:{action:"return",count:1,targetFilter:{owner:"own",position:"uncovered"}},position:"middle"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"water_5_discard",trigger:"immediate",params:{action:"discard",count:1,actor:"self"},position:"middle"}],bottomEffects:[]}],U1="Main 1",lg={id:F1,name:I1,description:$1,color:P1,pattern:q1,cards:L1,category:U1},O1="spirit_custom_1",M1="Spirit",H1="True strength from within. Custom protocol migration of original Spirit protocol.",V1="#5DD9C1",z1="dual-radial",B1=[{value:0,topEffects:[],middleEffects:[{id:"spirit_0_refresh",trigger:"on_play",params:{action:"refresh",target:"self"},position:"middle"},{id:"spirit_0_draw",trigger:"on_play",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"middle"}],bottomEffects:[{id:"spirit_0_skip_cache",trigger:"passive",params:{action:"passive_rule",rule:{type:"skip_check_cache_phase",target:"self",scope:"global"}},position:"bottom"}]},{value:1,topEffects:[{id:"spirit_1_play_anywhere",trigger:"passive",params:{action:"passive_rule",rule:{type:"allow_any_protocol_play",target:"self",scope:"global"}},position:"top"}],middleEffects:[{id:"spirit_1_draw",trigger:"on_play",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"middle"}],bottomEffects:[{id:"spirit_1_choice",trigger:"start",params:{action:"choice",options:[{id:"spirit_1_choice_discard",trigger:"on_play",params:{action:"discard",count:1,actor:"self"},position:"bottom"},{id:"spirit_1_choice_flip",trigger:"on_play",params:{action:"flip",flipSelf:!0},position:"bottom"}]},position:"bottom"}]},{value:2,topEffects:[],middleEffects:[{id:"spirit_2_flip",trigger:"on_play",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1},optional:!0},position:"middle"}],bottomEffects:[]},{value:3,topEffects:[{id:"spirit_3_shift",trigger:"after_draw",reactiveTriggerActor:"self",params:{action:"shift",count:1,optional:!0,targetFilter:{owner:"own",position:"any",faceState:"any",excludeSelf:!1}},position:"top"}],middleEffects:[],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"spirit_4_swap",trigger:"on_play",params:{action:"swap_protocols",target:"own"},position:"middle"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"spirit_5_discard",trigger:"on_play",params:{action:"discard",count:1,actor:"self"},position:"middle"}],bottomEffects:[]}],G1="Main 1",sg={id:O1,name:M1,description:H1,color:V1,pattern:z1,cards:B1,category:G1},W1="gravity_custom_1",Y1="Gravity",Q1="Pull everything together. Gravity draws cards towards this line.",X1="#7599EB",Z1="grid",K1=[{value:0,topEffects:[],middleEffects:[{id:"gravity_0_play_per_2_cards",trigger:"on_play",params:{action:"play",source:"deck",count:1,faceDown:!0,destinationRule:{type:"under_this_card"},condition:{type:"per_x_cards_in_line",cardCount:2},actor:"self"},position:"middle"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"gravity_1_draw_2",trigger:"on_play",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"middle"},{id:"gravity_1_shift_to_or_from",trigger:"on_play",params:{action:"shift",targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1},destinationRestriction:{type:"to_or_from_this_lane",laneIndex:"current"}},position:"middle"}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"gravity_2_flip",trigger:"on_play",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1},optional:!1},position:"middle"},{id:"gravity_2_shift_to_this_line",trigger:"on_play",params:{action:"shift",targetFilter:{owner:"any",position:"any",faceState:"any",excludeSelf:!1},destinationRestriction:{type:"to_this_lane",laneIndex:"current"}},position:"middle",useCardFromPreviousEffect:!0}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"gravity_4_shift_face_down_to_this_line",trigger:"on_play",params:{action:"shift",targetFilter:{owner:"any",position:"uncovered",faceState:"face_down",excludeSelf:!1},destinationRestriction:{type:"to_this_lane",laneIndex:"current"}},position:"middle"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"gravity_5_discard",trigger:"on_play",params:{action:"discard",count:1,actor:"self"},position:"middle"}],bottomEffects:[]},{value:6,topEffects:[],middleEffects:[{id:"gravity_6_opponent_plays",trigger:"on_play",params:{action:"play",source:"deck",count:1,faceDown:!0,destinationRule:{type:"specific_lane",laneIndex:"current"},actor:"opponent"},position:"middle",comment:"Opponent plays top of their deck in this line"}],bottomEffects:[]}],J1="Main 1",cg={id:W1,name:Y1,description:Q1,color:X1,pattern:Z1,cards:K1,category:J1},eb="life_custom_1",tb="Life",nb="Life begets more life. Play cards from your deck to grow your presence.",ab="#3CE076",ob="hexagons",rb=[{value:0,topEffects:[{id:"life_0_end_delete_if_covered",trigger:"end",position:"top",params:{action:"delete",deleteSelf:!0,advancedConditional:{type:"this_card_is_covered"}}}],middleEffects:[{id:"life_0_play_each_line_with_card",trigger:"on_play",position:"middle",params:{action:"play",source:"deck",count:1,faceDown:!0,destinationRule:{type:"each_line_with_card",ownerFilter:"own"},actor:"self"}}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"life_1_flip_1",trigger:"on_play",position:"middle",params:{action:"flip",count:1,optional:!1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1}}},{id:"life_1_flip_2",trigger:"on_play",position:"middle",params:{action:"flip",count:1,optional:!1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1}}}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"life_2_draw",trigger:"on_play",position:"middle",params:{action:"draw",count:1,target:"self",source:"own_deck"}},{id:"life_2_flip",trigger:"on_play",position:"middle",params:{action:"flip",count:1,optional:!0,targetFilter:{owner:"any",position:"uncovered",faceState:"face_down",excludeSelf:!1}}}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[],bottomEffects:[{id:"life_3_on_cover_play",trigger:"on_cover",position:"bottom",params:{action:"play",source:"deck",count:1,faceDown:!0,destinationRule:{type:"another_line",excludeCurrentLane:!0},actor:"self"}}]},{value:4,topEffects:[],middleEffects:[{id:"life_4_conditional_draw",trigger:"on_play",position:"middle",params:{action:"draw",count:1,target:"self",source:"own_deck",conditional:{type:"is_covering"}}}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"life_5_discard",trigger:"on_play",position:"middle",params:{action:"discard",count:1,actor:"self"}}],bottomEffects:[]}],lb="Main 1",ig={id:eb,name:tb,description:nb,color:ab,pattern:ob,cards:rb,category:lb},sb="light_custom_1",cb="Light",ib="Burn away the dark. Light protocol reveals and manipulates through illumination.",db="System",ub="2025-11-14T00:00:00.000Z",pb="#F4D03F",fb="radial",hb=[{value:0,topEffects:[],middleEffects:[{id:"light-0-flip",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1},optional:!1},position:"middle",trigger:"on_play"},{id:"light-0-draw",params:{action:"draw",count:1,target:"self",source:"own_deck",countType:"equal_to_card_value"},position:"middle",trigger:"on_play",useCardFromPreviousEffect:!0}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[],bottomEffects:[{id:"light-1-draw",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"bottom",trigger:"end"}]},{value:2,topEffects:[],middleEffects:[{id:"light-2-draw",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"middle",trigger:"on_play"},{id:"light-2-reveal-board-card",params:{action:"reveal",source:"board",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"face_down"},optional:!0},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"light-3-shift-all",params:{action:"shift",count:"all",targetFilter:{owner:"any",position:"any",faceState:"face_down",excludeSelf:!1},destinationRestriction:{type:"to_another_line"},scope:"this_lane"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"light-4-reveal",params:{action:"reveal",source:"opponent_hand",count:-1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"light-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],mb="Main 1",dg={id:sb,name:cb,description:ib,author:db,createdAt:ub,color:pb,pattern:fb,cards:hb,category:mb},yb="speed_custom_1",gb="Speed",vb="Swift and adaptive. Custom protocol migration of original Speed protocol.",_b="#33E6E6",wb="cross",xb=[{value:0,topEffects:[],middleEffects:[{id:"speed_0_play",trigger:"on_play",params:{action:"play",source:"hand",count:1},position:"middle"}],bottomEffects:[]},{value:1,topEffects:[{id:"speed_1_reactive_draw",trigger:"after_clear_cache",reactiveTriggerActor:"self",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"top"}],middleEffects:[{id:"speed_1_draw",trigger:"on_play",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"middle"}],bottomEffects:[]},{value:2,topEffects:[{id:"speed_2_before_compile",trigger:"before_compile_delete",params:{action:"shift",count:1,shiftSelf:!0,allowCoveredSelf:!0,targetFilter:{owner:"own",position:"any",faceState:"any"}},position:"top"}],middleEffects:[],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"speed_3_shift_other",trigger:"on_play",params:{action:"shift",count:1,targetFilter:{owner:"own",position:"uncovered",faceState:"any",excludeSelf:!0}},position:"middle"}],bottomEffects:[{id:"speed_3_end_shift",trigger:"end",params:{action:"shift",count:1,optional:!0,targetFilter:{owner:"own",position:"uncovered",faceState:"any"}},position:"bottom",conditional:{type:"if_executed",thenEffect:{id:"speed_3_flip_self",trigger:"on_play",params:{action:"flip",flipSelf:!0},position:"bottom"}}}]},{value:4,topEffects:[],middleEffects:[{id:"speed_4_shift_opponent",trigger:"on_play",params:{action:"shift",count:1,targetFilter:{owner:"opponent",position:"uncovered",faceState:"face_down"}},position:"middle"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"speed_5_discard",trigger:"on_play",params:{action:"discard",count:1,actor:"self"},position:"middle"}],bottomEffects:[]}],Cb="Main 1",ug={id:yb,name:gb,description:vb,color:_b,pattern:wb,cards:xb,category:Cb},Sb="metal_custom_1",bb="Metal",Eb="Unyielding defense. Custom protocol migration of original Metal protocol.",jb="#B0BEC5",kb="grid",Rb=[{value:0,topEffects:[{id:"metal_0_reduce_opponent",trigger:"passive",params:{action:"value_modifier",modifier:{type:"add_to_total",value:-2,target:"opponent_total",scope:"this_lane"}},position:"top"}],middleEffects:[{id:"metal_0_flip",trigger:"on_play",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any"}},position:"middle"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"metal_1_draw",trigger:"on_play",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"middle"},{id:"metal_1_block_compile",trigger:"on_play",params:{action:"block_compile",target:"opponent"},position:"middle"}],bottomEffects:[]},{value:2,topEffects:[{id:"metal_2_block_face_down",trigger:"passive",params:{action:"passive_rule",rule:{type:"block_face_down_play",scope:"this_lane"}},position:"top"}],middleEffects:[],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"metal_3_draw",trigger:"on_play",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"middle"},{id:"metal_3_delete_lane",trigger:"on_play",params:{action:"delete_all_in_lane",laneCondition:{type:"min_cards",count:8},excludeCurrentLane:!0},position:"middle"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"metal_5_discard",trigger:"on_play",params:{action:"discard",count:1,actor:"self"},position:"middle"}],bottomEffects:[]},{value:6,topEffects:[{id:"metal_6_delete_on_cover_or_flip",trigger:"on_cover_or_flip",params:{action:"delete",deleteSelf:!0},position:"top"}],middleEffects:[],bottomEffects:[]}],Nb="Main 1",pg={id:Sb,name:bb,description:Eb,color:jb,pattern:kb,cards:Rb,category:Nb},Tb="plague-custom-001",Db="Plague",Ab="Focused on forcing opponent discards and restricting their plays. Spread suffering.",Fb="System Migration",Ib="2025-11-26T00:00:00.000Z",$b="#8FBC3A",Pb="dual-radial",qb=[{value:0,topEffects:[],middleEffects:[{id:"plague-0-opponent-discard",params:{action:"discard",count:1,actor:"opponent"},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"plague-0-block-play",params:{action:"passive_rule",rule:{type:"block_all_play",target:"opponent",scope:"this_lane"}},position:"bottom",trigger:"passive"}]},{value:1,topEffects:[{id:"plague-1-reactive-draw",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"top",trigger:"after_opponent_discard"}],middleEffects:[{id:"plague-1-opponent-discard",params:{action:"discard",count:1,actor:"opponent"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"plague-2-self-discard",params:{action:"discard",count:1,actor:"self",variableCount:!0},position:"middle",trigger:"on_play",conditional:{type:"then",thenEffect:{id:"plague-2-opponent-discard",params:{action:"discard",actor:"opponent",countType:"equal_to_discarded",countOffset:1},position:"middle",trigger:"on_play"}}}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"plague-3-flip-each-other",params:{action:"flip",count:"all",scope:{type:"anywhere"},targetFilter:{faceState:"face_up",owner:"any",position:"uncovered",excludeSelf:!0}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,text:{bottom:"<div><span class='emphasis'>End:</span> Your opponent deletes 1 of their face-down cards. You may flip this card.</div>"},topEffects:[],middleEffects:[],bottomEffects:[{id:"plague-4-opponent-delete",params:{action:"delete",count:1,targetFilter:{faceState:"face_down",owner:"opponent",position:"uncovered"},scope:{type:"anywhere"},actorChooses:"card_owner"},position:"bottom",trigger:"end"},{id:"plague-4-may-flip-self",params:{action:"flip",flipSelf:!0,optional:!0},position:"bottom",trigger:"end"}]},{value:5,topEffects:[],middleEffects:[{id:"plague-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],Lb="Main 1",fg={id:Tb,name:Db,description:Ab,author:Fb,createdAt:Ib,color:$b,pattern:Pb,cards:qb,category:Lb},Ub="love_custom_v1",Ob="Love",Mb="Custom Love protocol - hand manipulation, giving and taking cards",Hb="System",Vb="2025-01-08T00:00:00Z",zb="#f2a3d7",Bb="radial",Gb=[{value:1,topEffects:[],middleEffects:[{id:"love-1-draw-opponent-deck",params:{action:"draw",count:1,target:"self",source:"opponent_deck"},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"love-1-end-give",params:{action:"give",count:1,source:"own_hand",optional:!0},conditional:{type:"if_executed",thenEffect:{id:"love-1-end-draw",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"bottom",trigger:"on_play"}},position:"bottom",trigger:"end"}]},{value:2,topEffects:[],middleEffects:[{id:"love-2-opponent-draw",params:{action:"draw",count:1,target:"opponent"},position:"middle",trigger:"on_play"},{id:"love-2-refresh",params:{action:"refresh",target:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"love-3-take",params:{action:"take",count:1,random:!0},position:"middle",trigger:"on_play"},{id:"love-3-give",params:{action:"give",count:1,source:"own_hand",optional:!1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"love-4-reveal",params:{action:"reveal",count:1,source:"own_hand"},position:"middle",trigger:"on_play"},{id:"love-4-flip",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"love-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:6,topEffects:[],middleEffects:[{id:"love-6-opponent-draw",params:{action:"draw",count:2,target:"opponent"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],Wb="Aux 1",hg={id:Ub,name:Ob,description:Mb,author:Hb,createdAt:Vb,color:zb,pattern:Bb,cards:Gb,category:Wb},Yb="psychic_custom_v1",Qb="Psychic",Xb="Custom Psychic protocol - mind control, discard, reveal, and protocol manipulation",Zb="System",Kb="2025-01-08T00:00:00Z",Jb="#c78dd9",eE="radial",tE=[{value:0,topEffects:[],middleEffects:[{id:"psychic-0-draw",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"middle",trigger:"on_play"},{id:"psychic-0-opponent-discard",params:{action:"discard",count:2,actor:"opponent"},position:"middle",trigger:"on_play"},{id:"psychic-0-reveal-hand",params:{action:"reveal",source:"opponent_hand",count:-1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[{id:"psychic-1-force-face-down",params:{action:"passive_rule",rule:{type:"require_face_down_play",target:"opponent",scope:"global"}},position:"top",trigger:"passive"}],middleEffects:[],bottomEffects:[{id:"psychic-1-start-flip-self",params:{action:"flip",count:1,targetFilter:{owner:"self",position:"any",faceState:"any",excludeSelf:!1},flipSelf:!0},position:"bottom",trigger:"start"}]},{value:2,topEffects:[],middleEffects:[{id:"psychic-2-opponent-discard",params:{action:"discard",count:2,actor:"opponent"},position:"middle",trigger:"on_play"},{id:"psychic-2-rearrange",params:{action:"rearrange_protocols",target:"opponent"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"psychic-3-opponent-discard",params:{action:"discard",count:1,actor:"opponent"},position:"middle",trigger:"on_play"},{id:"psychic-3-shift-opponent",params:{action:"shift",targetFilter:{owner:"opponent",position:"uncovered",faceState:"any",excludeSelf:!1},destinationRestriction:{type:"any"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[],bottomEffects:[{id:"psychic-4-end-return",params:{action:"return",count:1,optional:!0,targetFilter:{owner:"opponent",position:"uncovered",faceState:"any",excludeSelf:!1}},conditional:{type:"if_executed",thenEffect:{id:"psychic-4-end-flip-self",params:{action:"flip",count:1,flipSelf:!0,targetFilter:{owner:"self",position:"any",faceState:"any",excludeSelf:!1}},position:"bottom",trigger:"end"}},position:"bottom",trigger:"end"}]},{value:5,topEffects:[],middleEffects:[{id:"psychic-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],nE="Main 1",mg={id:Yb,name:Qb,description:Xb,author:Zb,createdAt:Kb,color:Jb,pattern:eE,cards:tE,category:nE},aE="smoke-custom-001",oE="Smoke",rE="Shroud your cards in mystery. Use face-down cards to gain value and control.",lE="System",sE="2025-12-09T00:00:00.000Z",cE="#5A5A5A",iE="radial",dE=[{value:0,topEffects:[],middleEffects:[{id:"smoke-0-play-deck-each-facedown",params:{action:"play",source:"deck",count:1,faceDown:!0,destinationRule:{type:"each_line_with_card",cardFilter:{faceState:"face_down"}}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"smoke-1-flip-own",params:{action:"flip",count:1,targetFilter:{owner:"own",position:"uncovered",faceState:"any"},optional:!1},position:"middle",trigger:"on_play"},{id:"smoke-1-shift-that-card",params:{action:"shift",optional:!0,targetFilter:{owner:"own",position:"uncovered",faceState:"any"}},position:"middle",trigger:"on_play",useCardFromPreviousEffect:!0}],bottomEffects:[]},{value:2,topEffects:[{id:"smoke-2-value-per-facedown",params:{action:"value_modifier",modifier:{type:"add_per_condition",value:1,condition:"per_face_down_card",target:"own_total",scope:"this_lane"}},position:"top",trigger:"passive"}],middleEffects:[],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"smoke-3-play-hand-facedown-lane",params:{action:"play",source:"hand",count:1,faceDown:!0,destinationRule:{type:"line_with_matching_cards",cardFilter:{faceState:"face_down"}}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"smoke-4-shift-covered-facedown",params:{action:"shift",optional:!1,targetFilter:{owner:"any",position:"covered",faceState:"face_down"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"smoke-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],uE="Main 2",yg={id:aE,name:oE,description:rE,author:lE,createdAt:sE,color:cE,pattern:iE,cards:dE,category:uE},pE="clarity-custom-001",fE="Clarity",hE="See through the fog of war. Reveal your deck and hand to gain powerful advantages.",mE="System",yE="2025-12-09T00:00:00.000Z",gE="#87CEEB",vE="radial",_E=[{value:0,topEffects:[{id:"clarity-0-value-per-hand",params:{action:"value_modifier",modifier:{type:"add_per_condition",value:1,condition:"per_card_in_hand",target:"own_total",scope:"this_lane"}},position:"top",trigger:"passive"}],middleEffects:[],bottomEffects:[]},{value:1,topEffects:[{id:"clarity-1-start-reveal-deck-top",params:{action:"reveal",source:"own_deck_top",count:1},position:"top",trigger:"start",conditional:{type:"optional",thenEffect:{id:"clarity-1-discard-revealed",params:{action:"discard",count:1,actor:"self",useCardFromPreviousEffect:!0}}}}],middleEffects:[{id:"clarity-1-middle-reveal-opponent-hand",params:{action:"reveal",source:"opponent_hand",count:-1},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"clarity-1-bottom-draw-3",params:{action:"draw",count:3,target:"self",source:"own_deck"},position:"bottom",trigger:"on_cover"}]},{value:2,topEffects:[],middleEffects:[{id:"clarity-2-reveal-deck",params:{action:"reveal",source:"own_deck",count:-1},position:"middle",trigger:"on_play"},{id:"clarity-2-draw-value-1",params:{action:"draw",count:1,target:"self",source:"own_deck",valueFilter:{equals:1},fromRevealed:!0},position:"middle",trigger:"on_play"},{id:"clarity-2-shuffle-deck",params:{action:"shuffle_deck"},position:"middle",trigger:"on_play"},{id:"clarity-2-play-value-1",params:{action:"play",source:"hand",count:1,valueFilter:{equals:1}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"clarity-3-reveal-deck",params:{action:"reveal",source:"own_deck",count:-1},position:"middle",trigger:"on_play"},{id:"clarity-3-draw-value-5",params:{action:"draw",count:1,target:"self",source:"own_deck",valueFilter:{equals:5},fromRevealed:!0},position:"middle",trigger:"on_play"},{id:"clarity-3-shuffle-deck",params:{action:"shuffle_deck"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"clarity-4-shuffle-trash",params:{action:"shuffle_trash",optional:!0},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"clarity-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],wE="Main 2",gg={id:pE,name:fE,description:hE,author:mE,createdAt:yE,color:gE,pattern:vE,cards:_E,category:wE},xE="corruption-custom-001",CE="Corruption",SE="Corrupt your opponents plans. Use discard synergies and manipulate the return mechanic.",bE="System",EE="2025-12-09T00:00:00.000Z",jE="#4A0080",kE="stripes",RE=[{value:0,topEffects:[{id:"corruption-0-start-flip",params:{action:"flip",count:1,scope:"this_lane",targetFilter:{owner:"own",position:"any",faceState:"face_up",excludeSelf:!0},optional:!1},position:"top",trigger:"start"}],middleEffects:[],bottomEffects:[{id:"corruption-0-play-opponent-side",params:{action:"passive_rule",rule:{type:"allow_play_on_opponent_side",target:"self",scope:"global"}},position:"bottom",trigger:"passive"}]},{value:1,topEffects:[],middleEffects:[{id:"corruption-1-return",params:{action:"return",count:1,targetFilter:{owner:"any",position:"uncovered"}},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"corruption-1-redirect-return",params:{action:"redirect_return_to_deck",faceDown:!0,targetOwner:"opponent"},position:"bottom",trigger:"when_card_returned"}]},{value:2,topEffects:[{id:"corruption-2-after-discard",params:{action:"discard",count:1,actor:"opponent"},position:"top",trigger:"after_discard",reactiveTriggerActor:"self"}],middleEffects:[{id:"corruption-2-draw",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"middle",trigger:"on_play"},{id:"corruption-2-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"corruption-3-flip-covered",params:{action:"flip",count:1,optional:!0,targetFilter:{owner:"any",position:"covered",faceState:"face_up",excludeSelf:!1}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"corruption-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:6,topEffects:[{id:"corruption-6-end-choice",params:{action:"choice",options:[{id:"corruption-6-choice-discard",params:{action:"discard",count:1,actor:"self"},position:"top",trigger:"end"},{id:"corruption-6-choice-delete-self",params:{action:"delete",deleteSelf:!0},position:"top",trigger:"end"}]},position:"top",trigger:"end"}],middleEffects:[],bottomEffects:[]}],NE="Main 2",vg={id:xE,name:CE,description:SE,author:bE,createdAt:EE,color:jE,pattern:kE,cards:RE,category:NE},TE="courage-custom-001",DE="Courage",AE="Face challenges head-on. Gain power when outnumbered.",FE="System",IE="2025-12-10T00:00:00.000Z",$E="#D4AF37",PE="radial",qE=[{value:0,topEffects:[{id:"courage-0-start-draw",params:{action:"draw",count:1,advancedConditional:{type:"empty_hand"}},position:"top",trigger:"start"}],middleEffects:[{id:"courage-0-draw",params:{action:"draw",count:1},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"courage-0-end-discard",params:{action:"discard",count:1,optional:!0},position:"bottom",trigger:"end",conditional:{type:"if_executed",thenEffect:{id:"courage-0-opponent-discard",params:{action:"discard",count:1,actor:"opponent"},position:"bottom",trigger:"end"}}}]},{value:1,topEffects:[],middleEffects:[{id:"courage-1-delete",params:{action:"delete",count:1,targetFilter:{owner:"opponent",position:"uncovered"},selectLane:!0,laneCondition:{type:"opponent_higher_value"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"courage-2-draw",params:{action:"draw",count:1},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"courage-2-end-draw",params:{action:"draw",count:1,advancedConditional:{type:"opponent_higher_value_in_lane"}},position:"bottom",trigger:"end"}]},{value:3,topEffects:[],middleEffects:[],bottomEffects:[{id:"courage-3-shift",params:{action:"shift",shiftSelf:!0,optional:!0,destinationRestriction:{type:"opponent_highest_value_lane"}},position:"bottom",trigger:"end"}]},{value:5,topEffects:[],middleEffects:[{id:"courage-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:6,topEffects:[{id:"courage-6-flip",params:{action:"flip",flipSelf:!0,advancedConditional:{type:"opponent_higher_value_in_lane"}},position:"top",trigger:"end"}],middleEffects:[],bottomEffects:[]}],LE="Main 2",_g={id:TE,name:DE,description:AE,author:FE,createdAt:IE,color:$E,pattern:PE,cards:qE,category:LE},UE="diversity-custom-001",OE="Diversity",ME="Embrace variety. The more different protocols on the field, the stronger your effects become.",HE="System",VE="2025-12-18T00:00:00.000Z",zE="#FF6B6B",BE="zigzag",GE=[{value:0,topEffects:[],middleEffects:[{id:"diversity-0-auto-compile",params:{action:"auto_compile",protocolCountConditional:{type:"unique_protocols_on_field",threshold:6}},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"diversity-0-play-non-protocol",params:{action:"play",source:"hand",count:1,excludeSourceProtocol:!0,optional:!0,destinationRule:{type:"specific_lane",laneIndex:"current"}},position:"bottom",trigger:"end"}]},{value:1,topEffects:[],middleEffects:[{id:"diversity-1-shift",params:{action:"shift",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any"}},position:"middle",trigger:"on_play"},{id:"diversity-1-draw-protocols",params:{action:"draw",countType:"equal_to_unique_protocols_in_lane",target:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[{id:"diversity-3-value-modifier",params:{action:"value_modifier",modifier:{type:"add_to_total",value:2,target:"own_total",scope:"this_lane",condition:"has_non_own_protocol_face_up"}},position:"top",trigger:"passive"}],middleEffects:[],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"diversity-4-flip-dynamic",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1,valueLessThanUniqueProtocolsOnField:!0}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"diversity-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:6,topEffects:[{id:"diversity-6-conditional-delete",params:{action:"delete",deleteSelf:!0,protocolCountConditional:{type:"unique_protocols_on_field_below",threshold:3}},position:"top",trigger:"end"}],middleEffects:[],bottomEffects:[]}],WE="Aux 2",wg={id:UE,name:OE,description:ME,author:HE,createdAt:VE,color:zE,pattern:BE,cards:GE,category:WE},YE="fear_custom",QE="Fear",XE="Terror and disruption protocol - Control through fear",ZE="System",KE="2025-01-10T00:00:00Z",JE="#800020",ej="radial",tj="Main 2",nj=[{value:0,topEffects:[{id:"fear-0-passive",params:{action:"passive_rule",rule:{type:"ignore_middle_commands",target:"opponent",scope:"global",onlyDuringYourTurn:!0}},position:"top",trigger:"passive"}],middleEffects:[{id:"fear-0-choice",params:{action:"choice",options:[{id:"fear-0-shift",params:{action:"shift",targetFilter:{owner:"any",position:"uncovered",faceState:"any"}},position:"middle",trigger:"on_play"},{id:"fear-0-flip",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1},optional:!1},position:"middle",trigger:"on_play"}]},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"fear-1-draw",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"middle",trigger:"on_play",conditional:{type:"then",thenEffect:{id:"fear-1-opponent-discard-hand",params:{action:"discard",count:"all",actor:"opponent"},position:"middle",trigger:"on_play",conditional:{type:"then",thenEffect:{id:"fear-1-opponent-draw",params:{action:"draw",countType:"equal_to_discarded",countOffset:-1,target:"opponent"},position:"middle",trigger:"on_play"}}}}}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"fear-2-return",params:{action:"return",count:1,targetFilter:{owner:"opponent"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"fear-3-shift",params:{action:"shift",targetFilter:{owner:"opponent",position:"any",faceState:"any"},scope:"this_lane"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"fear-4-discard-random",params:{action:"discard",count:1,actor:"opponent",random:!0},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"fear-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],xg={id:YE,name:QE,description:XE,author:ZE,createdAt:KE,color:JE,pattern:ej,category:tj,cards:nj},aj="ice_custom",oj="Ice",rj="Control and disruption through shifting and conditional effects",lj="System",sj="2025-12-10T00:00:00Z",cj="#B0E0E6",ij="radial",dj="Main 2",uj=[{value:1,topEffects:[],middleEffects:[{id:"ice-1-shift",params:{action:"shift",shiftSelf:!0,optional:!0},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"ice-1-reactive",params:{action:"discard",actor:"opponent",count:1},position:"bottom",trigger:"after_play",reactiveTriggerActor:"opponent",reactiveScope:"this_lane"}]},{value:2,topEffects:[],middleEffects:[{id:"ice-2-shift",params:{action:"shift",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!0}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[{id:"ice-3-end-shift",params:{action:"shift",shiftSelf:!0,optional:!0,advancedConditional:{type:"this_card_is_covered"}},position:"top",trigger:"end"}],middleEffects:[],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[],bottomEffects:[{id:"ice-4-passive",params:{action:"passive_rule",rule:{type:"block_flip_this_card",target:"this_card",scope:"this_card"}},position:"bottom",trigger:"passive"}]},{value:5,topEffects:[],middleEffects:[{id:"ice-5-discard",params:{action:"discard",actor:"self",count:1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:6,topEffects:[{id:"ice-6-passive",params:{action:"passive_rule",rule:{type:"block_draw_conditional",conditionTarget:"self",blockTarget:"self",scope:"global"}},position:"top",trigger:"passive"}],middleEffects:[],bottomEffects:[]}],Cg={id:aj,name:oj,description:rj,author:lj,createdAt:sj,color:cj,pattern:ij,category:dj,cards:uj},pj="luck-custom-001",fj="Luck",hj="Gamble with fate. State numbers and protocols to manipulate the top of decks.",mj="System",yj="2025-01-15T00:00:00.000Z",gj="#FFD700",vj="chaos",_j=[{value:0,topEffects:[],middleEffects:[{id:"luck-0-state-number",params:{action:"state_number",numberSource:"own_protocol_values"},position:"middle",trigger:"on_play"},{id:"luck-0-draw-and-reveal",params:{action:"draw",count:3,target:"self",source:"own_deck",revealFromDrawn:{valueSource:"stated_number",thenAction:"may_play"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"luck-1-play-deck-top",params:{action:"play",source:"deck",count:1,faceDown:!0,destinationRule:{type:"another_line"}},position:"middle",trigger:"on_play",conditional:{type:"then",thenEffect:{id:"luck-1-flip-skip-middle",params:{action:"flip",skipMiddleCommand:!0},useCardFromPreviousEffect:!0}}}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"luck-2-discard-deck-top",params:{action:"discard",source:"top_deck_own",count:1},position:"middle",trigger:"on_play",conditional:{type:"then",thenEffect:{id:"luck-2-draw-equal-value",params:{action:"draw",countType:"equal_to_card_value",target:"self",source:"own_deck"},useCardFromPreviousEffect:!0}}}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"luck-3-state-protocol",params:{action:"state_protocol",protocolSource:"opponent_cards"},position:"middle",trigger:"on_play"},{id:"luck-3-discard-opponent-deck",params:{action:"discard",source:"top_deck_opponent",count:1},position:"middle",trigger:"on_play",conditional:{type:"if_protocol_matches_stated",thenEffect:{id:"luck-3-delete",params:{action:"delete",count:1}}}}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"luck-4-discard-deck-top",params:{action:"discard",source:"top_deck_own",count:1},position:"middle",trigger:"on_play",conditional:{type:"then",thenEffect:{id:"luck-4-delete-same-value",params:{action:"delete",count:1,targetFilter:{position:"any",valueSource:"previous_effect_card"}}}}}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"luck-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],wj="Main 2",Sg={id:pj,name:fj,description:hj,author:mj,createdAt:yj,color:gj,pattern:vj,cards:_j,category:wj},xj="mirror-custom-001",Cj="Mirror",Sj="Copy, symmetry, and reflection. Mirror your opponent's actions.",bj="System",Ej="2025-01-15T00:00:00.000Z",jj="#C0C0C0",kj="radial",Rj="Main 2",Nj=[{value:0,topEffects:[{id:"mirror-0-value-modifier",params:{action:"value_modifier",modifier:{type:"add_per_condition",value:1,condition:"per_opponent_card_in_lane",target:"own_total",scope:"this_lane"}},position:"top",trigger:"passive"}],middleEffects:[],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[],bottomEffects:[{id:"mirror-1-copy-middle",params:{action:"copy_opponent_middle",optional:!0},position:"bottom",trigger:"end"}]},{value:2,topEffects:[],middleEffects:[{id:"mirror-2-swap-stacks",params:{action:"swap_stacks",target:"own"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"mirror-3-flip-own",params:{action:"flip",count:1,targetFilter:{owner:"own",position:"uncovered",faceState:"any",excludeSelf:!0},optional:!1},position:"middle",trigger:"on_play",conditional:{type:"then",thenEffect:{id:"mirror-3-flip-opponent-same-lane",params:{action:"flip",count:1,targetFilter:{owner:"opponent",position:"uncovered",faceState:"any"},sameLaneAsFirst:!0,optional:!1},position:"middle",trigger:"on_play"}}}],bottomEffects:[]},{value:4,topEffects:[{id:"mirror-4-after-opponent-draw",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"top",trigger:"after_opponent_draw"}],middleEffects:[],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"mirror-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],bg={id:xj,name:Cj,description:Sj,author:bj,createdAt:Ej,color:jj,pattern:kj,category:Rj,cards:Nj},Tj="peace-custom-001",Dj="Peace",Aj="Harmony and balance. Sacrifice to achieve equilibrium.",Fj="System",Ij="2025-01-16T00:00:00.000Z",$j="#87CEEB",Pj="radial",qj="Main 2",Lj=[{value:1,topEffects:[],middleEffects:[{id:"peace-1-both-discard",params:{action:"discard",actor:"both",count:"all"},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"peace-1-end-draw",params:{action:"draw",count:1,target:"self",source:"own_deck",advancedConditional:{type:"empty_hand"}},position:"bottom",trigger:"end"}]},{value:2,topEffects:[],middleEffects:[{id:"peace-2-draw",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"middle",trigger:"on_play"},{id:"peace-2-play",params:{action:"play",source:"hand",count:1,faceDown:!0},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"peace-3-discard-flip",params:{action:"discard",actor:"self",count:1},position:"middle",trigger:"on_play",optional:!0,conditional:{type:"if_executed",thenEffect:{id:"peace-3-flip",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1,valueMinGreaterThanHandSize:!0},optional:!1},position:"middle",trigger:"on_play"}}}],bottomEffects:[]},{value:4,topEffects:[{id:"peace-4-reactive-draw",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"top",trigger:"after_discard",reactiveTriggerActor:"self",onlyDuringOpponentTurn:!0}],middleEffects:[],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"peace-5-discard",params:{action:"discard",actor:"self",count:1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:6,topEffects:[],middleEffects:[{id:"peace-6-flip-self",params:{action:"flip",count:1,flipSelf:!0,advancedConditional:{type:"hand_size_greater_than",threshold:1}},position:"middle",trigger:"on_play"}],bottomEffects:[]}],Eg={id:Tj,name:Dj,description:Aj,author:Fj,createdAt:Ij,color:$j,pattern:Pj,category:qj,cards:Lj},Uj="time-custom-001",Oj="Time",Mj="Manipulate time through your trash and deck. Recycle discarded cards and control the flow of battle.",Hj="System",Vj="2025-12-17T00:00:00.000Z",zj="#8B4513",Bj="hexagons",Gj=[{value:0,topEffects:[],middleEffects:[{id:"time-0-play-from-trash",params:{action:"play",source:"trash",count:1},position:"middle",trigger:"on_play"},{id:"time-0-shuffle-trash",params:{action:"shuffle_trash",optional:!1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"time-1-flip-covered",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"covered",faceState:"any",excludeSelf:!1},optional:!1},position:"middle",trigger:"on_play"},{id:"time-1-discard-entire-deck",params:{action:"discard",count:1,actor:"self",source:"entire_deck"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:2,topEffects:[{id:"time-2-after-shuffle-draw",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"top",trigger:"after_shuffle",reactiveTriggerActor:"self",conditional:{type:"then",thenEffect:{id:"time-2-then-shift-self",params:{action:"shift",targetFilter:{owner:"own"},shiftSelf:!0,optional:!0}}}}],middleEffects:[{id:"time-2-conditional-shuffle-trash",params:{action:"shuffle_trash",optional:!0,advancedConditional:{type:"trash_not_empty"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"time-3-reveal-from-trash",params:{action:"reveal",source:"own_trash",count:1},position:"middle",trigger:"on_play",conditional:{type:"if_executed",thenEffect:{id:"time-3-play-face-down",params:{action:"play",source:"trash",count:1,faceDown:!0,destinationRule:{type:"other_lines"}},useCardFromPreviousEffect:!0}}}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"time-4-draw-2",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"middle",trigger:"on_play"},{id:"time-4-discard-2",params:{action:"discard",count:2,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"time-5-discard-1",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],Wj="Main 2",jg={id:Uj,name:Oj,description:Mj,author:Hj,createdAt:Vj,color:zj,pattern:Bj,cards:Gj,category:Wj},Yj="unity-custom-001",Qj="Unity",Xj="Strength in unity. Unity cards synergize with each other - effects become stronger with more face-up Unity cards on the field.",Zj="System",Kj="2025-12-18T00:00:00.000Z",Jj="#4CAF50",ek="hexagons",tk=[{value:0,topEffects:[],middleEffects:[{id:"unity-0-choice",params:{action:"choice",advancedConditional:{type:"same_protocol_on_field"},options:[{id:"unity-0-choice-flip",trigger:"on_play",params:{action:"flip",count:1,optional:!0,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1}},position:"middle"},{id:"unity-0-choice-draw",trigger:"on_play",params:{action:"draw",count:1,target:"self"},position:"middle"}]},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"unity-0-on-cover-choice",params:{action:"choice",options:[{id:"unity-0-cover-choice-flip",trigger:"on_cover",params:{action:"flip",count:1,optional:!1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1}},position:"bottom"},{id:"unity-0-cover-choice-draw",trigger:"on_cover",params:{action:"draw",count:1,target:"self"},position:"bottom"}]},position:"bottom",trigger:"on_cover",onCoverProtocolRestriction:"same_protocol"}]},{value:1,topEffects:[{id:"unity-1-shift-if-covered",params:{action:"shift",shiftSelf:!0,optional:!0,advancedConditional:{type:"this_card_is_covered"}},position:"top",trigger:"start"}],middleEffects:[{id:"unity-1-auto-compile",params:{action:"auto_compile",protocolCountConditional:{type:"same_protocol_count_on_field",threshold:5,faceState:"face_up"},deleteAllInLane:!0},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"unity-1-face-up-play",params:{action:"passive_rule",rule:{type:"allow_same_protocol_face_up_play",scope:"this_lane",protocolScope:"same_as_source"}},position:"bottom",trigger:"passive"}]},{value:2,topEffects:[],middleEffects:[{id:"unity-2-draw-count",params:{action:"draw",countType:"count_own_protocol_cards_on_field",target:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"unity-3-conditional-flip",params:{action:"flip",count:1,optional:!0,advancedConditional:{type:"same_protocol_on_field"},targetFilter:{owner:"any",position:"uncovered",faceState:"face_up",excludeSelf:!1}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[{id:"unity-4-draw-all-protocol",params:{action:"draw",advancedConditional:{type:"empty_hand"},protocolFilter:{type:"same_as_source"},revealDeck:!0,shuffleAfter:!0,target:"self"},position:"top",trigger:"start"}],middleEffects:[],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"unity-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],nk="Aux 2",kg={id:Yj,name:Qj,description:Xj,author:Zj,createdAt:Kj,color:Jj,pattern:ek,cards:tk,category:nk},ak="war-custom-001",ok="War",rk="CONFLICT, AGGRESSION - Punishes opponent actions with reactive effects",lk="System",sk="2025-01-01T00:00:00.000Z",ck="#8B0000",ik="grid",dk="Main 2",uk=[{value:0,topEffects:[{id:"war-0-top-flip-self",params:{action:"flip",flipSelf:!0,optional:!0},position:"top",trigger:"after_refresh"}],middleEffects:[],bottomEffects:[{id:"war-0-bottom-delete",params:{action:"delete",count:1,optional:!0,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1},scope:{type:"anywhere"}},position:"bottom",trigger:"after_opponent_draw"}]},{value:1,topEffects:[],middleEffects:[],bottomEffects:[{id:"war-1-discard-refresh",params:{action:"discard",actor:"self",variableCount:!0},position:"bottom",trigger:"after_opponent_refresh",conditional:{type:"then",thenEffect:{id:"war-1-refresh",params:{action:"refresh",target:"self"},position:"bottom",trigger:"after_opponent_refresh"}}}]},{value:2,topEffects:[],middleEffects:[{id:"war-2-flip",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1}},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"war-2-opponent-discard-all",params:{action:"discard",actor:"opponent",count:"all"},position:"bottom",trigger:"after_opponent_compile"}]},{value:3,topEffects:[],middleEffects:[{id:"war-3-draw",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"war-3-play-facedown",params:{action:"play",source:"hand",count:1,faceDown:!0,optional:!0,destinationRule:{type:"other_lines"}},position:"bottom",trigger:"after_opponent_discard"}]},{value:4,topEffects:[],middleEffects:[{id:"war-4-opponent-discard",params:{action:"discard",actor:"opponent",count:1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"war-5-self-discard",params:{action:"discard",actor:"self",count:1},position:"middle",trigger:"on_play"}],bottomEffects:[]}],Rg={id:ak,name:ok,description:rk,author:lk,createdAt:sk,color:ck,pattern:ik,category:dk,cards:uk};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const pk=[Zy,Ky,Jy,eg,tg,ng,wg,ag,og,rg,lg,sg,cg,ig,dg,ug,pg,fg,hg,mg,yg,gg,vg,_g,xg,Cg,Sg,bg,Eg,jg,kg,Rg],fk=()=>pk.map(t=>t.name.replace(/_custom$/i,"")),hk=()=>{try{const t=jr(),n=t.findIndex(r=>r.id==="dark_cust_v2"||r.name==="Dark_cust");n>=0&&(t.splice(n,1),Tu(t)),kt(Zy),kt(Ky),kt(Jy),kt(tg),kt(ng),kt(ag),kt(lg),kt(sg),kt(eg),kt(cg),kt(og),kt(rg),kt(ig),kt(dg),kt(ug),kt(pg),kt(fg),kt(hg),kt(mg),kt(yg),kt(gg),kt(vg),kt(_g),kt(wg),kt(xg),kt(Cg),kt(Sg),kt(bg),kt(Eg),kt(jg),kt(kg),kt(Rg)}catch(t){console.error("[Default Protocols] Error loading default protocols:",t)}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const zu="compile_game_statistics",Ng=()=>{const t=Nw,n=fk(),r=new Set([...t,...n]);return Array.from(r).sort()},Tg=1;function ay(){const t=Ng(),n={};return t.forEach(r=>{n[r]={timesUsed:0,wins:0,losses:0}}),{version:Tg,global:{totalGamesPlayed:0,totalGamesWon:0,totalGamesLost:0,totalPlaytime:0,fastestWin:null,longestGame:null,lastGameDuration:null,currentStreak:0,longestWinStreak:0,longestLoseStreak:0},protocols:n,aiDifficulty:{easy:{played:0,wins:0,losses:0},normal:{played:0,wins:0,losses:0},hard:{played:0,wins:0,losses:0}},cards:{played:{},deleted:{}},actions:{totalCardsDrawn:0,totalCardsPlayed:0,totalShifts:0,totalDeletes:0,totalDiscards:0,totalFlips:0,totalCompiles:0,totalRefreshes:0,totalReturns:0,detailedStats:{cardsPlayed:{total:0,player:0,ai:0,playerFromHand:0,playerFromEffect:0,aiFromHand:0,aiFromEffect:0,playerFaceUp:0,playerFaceDown:0,aiFaceUp:0,aiFaceDown:0},cardsDrawn:{total:0,player:0,ai:0,playerFromRefresh:0,playerFromEffect:0,aiFromRefresh:0,aiFromEffect:0},discards:{total:0,player:0,ai:0},deletes:{total:0,player:0,ai:0},flips:{total:0,player:0,ai:0},shifts:{total:0,player:0,ai:0},returns:{total:0,player:0,ai:0},compiles:{total:0,player:0,ai:0,playerFirstCompile:0,playerRecompile:0,aiFirstCompile:0,aiRecompile:0},refreshes:{total:0,player:0,ai:0,playerCardsDrawn:0,aiCardsDrawn:0}}},control:{gamesWithControl:0,gamesWithoutControl:0,playerRearranges:0,aiRearranges:0,totalRearranges:0},coinFlip:{headsChosen:0,tailsChosen:0,headsWon:0,tailsWon:0}}}function ku(){var t,n,r,s,c,d,u,p,f,h,y,m,g,v,C,b,x,j,E,k,R,D,L,I,F,U,B,G,W,P,z,H,A,N,T,q,O,M,Y,X,K,ne,Z,oe,xe,ye,Ce,pe,_e,ee,je,de,Pe,Ue,se,re,ce,he,we,Se,ke,Xe,Le,be,Me,Ne,Be,Ye,De,Ge,et,tt,rt,ht,Rt,Ft,En,fn,Zt,nn,un,jn,Xn,xn,kn,qn,Ya,$a,Pa,qa,Ea,da,ua,La,Cn,Vt,Yt,Ln,pa,Qa,Xa,Ua,Zn,ja,Un,Rn,On,Nn,Ot,ka,Ra,Sn,Tn,ge,Oe,Qe,mt,Ze,Je,ct,ot,ue,Re,Fe,ze,dt,it,Dt,Dn,Kn,Na,hn,tr,kr,fa,nr,_o,wo,Za,ar,Kt,Ka,Mn,xo,Co,Ta,Da;try{const Ja=localStorage.getItem(zu);if(!Ja)return ay();const We=JSON.parse(Ja),Gt=Ng(),cn={...We.protocols||{}};Gt.forEach(So=>{cn[So]||(cn[So]={timesUsed:0,wins:0,losses:0})});const Jt={...We,version:Tg,global:{...We.global,lastGameDuration:((t=We.global)==null?void 0:t.lastGameDuration)||null},protocols:cn,control:{gamesWithControl:((n=We.control)==null?void 0:n.gamesWithControl)||0,gamesWithoutControl:((r=We.control)==null?void 0:r.gamesWithoutControl)||0,playerRearranges:((s=We.control)==null?void 0:s.playerRearranges)||0,aiRearranges:((c=We.control)==null?void 0:c.aiRearranges)||0,totalRearranges:((d=We.control)==null?void 0:d.totalRearranges)||0},coinFlip:We.coinFlip||{headsChosen:0,tailsChosen:0,headsWon:0,tailsWon:0},actions:{...We.actions,totalCompiles:((u=We.actions)==null?void 0:u.totalCompiles)||0,totalRefreshes:((p=We.actions)==null?void 0:p.totalRefreshes)||0,totalReturns:((f=We.actions)==null?void 0:f.totalReturns)||0,detailedStats:{cardsPlayed:{total:((m=(y=(h=We.actions)==null?void 0:h.detailedStats)==null?void 0:y.cardsPlayed)==null?void 0:m.total)||0,player:((C=(v=(g=We.actions)==null?void 0:g.detailedStats)==null?void 0:v.cardsPlayed)==null?void 0:C.player)||0,ai:((j=(x=(b=We.actions)==null?void 0:b.detailedStats)==null?void 0:x.cardsPlayed)==null?void 0:j.ai)||0,playerFromHand:((R=(k=(E=We.actions)==null?void 0:E.detailedStats)==null?void 0:k.cardsPlayed)==null?void 0:R.playerFromHand)||0,playerFromEffect:((I=(L=(D=We.actions)==null?void 0:D.detailedStats)==null?void 0:L.cardsPlayed)==null?void 0:I.playerFromEffect)||0,aiFromHand:((B=(U=(F=We.actions)==null?void 0:F.detailedStats)==null?void 0:U.cardsPlayed)==null?void 0:B.aiFromHand)||0,aiFromEffect:((P=(W=(G=We.actions)==null?void 0:G.detailedStats)==null?void 0:W.cardsPlayed)==null?void 0:P.aiFromEffect)||0,playerFaceUp:((A=(H=(z=We.actions)==null?void 0:z.detailedStats)==null?void 0:H.cardsPlayed)==null?void 0:A.playerFaceUp)||0,playerFaceDown:((q=(T=(N=We.actions)==null?void 0:N.detailedStats)==null?void 0:T.cardsPlayed)==null?void 0:q.playerFaceDown)||0,aiFaceUp:((Y=(M=(O=We.actions)==null?void 0:O.detailedStats)==null?void 0:M.cardsPlayed)==null?void 0:Y.aiFaceUp)||0,aiFaceDown:((ne=(K=(X=We.actions)==null?void 0:X.detailedStats)==null?void 0:K.cardsPlayed)==null?void 0:ne.aiFaceDown)||0},cardsDrawn:{total:((xe=(oe=(Z=We.actions)==null?void 0:Z.detailedStats)==null?void 0:oe.cardsDrawn)==null?void 0:xe.total)||0,player:((pe=(Ce=(ye=We.actions)==null?void 0:ye.detailedStats)==null?void 0:Ce.cardsDrawn)==null?void 0:pe.player)||0,ai:((je=(ee=(_e=We.actions)==null?void 0:_e.detailedStats)==null?void 0:ee.cardsDrawn)==null?void 0:je.ai)||0,playerFromRefresh:((Ue=(Pe=(de=We.actions)==null?void 0:de.detailedStats)==null?void 0:Pe.cardsDrawn)==null?void 0:Ue.playerFromRefresh)||0,playerFromEffect:((ce=(re=(se=We.actions)==null?void 0:se.detailedStats)==null?void 0:re.cardsDrawn)==null?void 0:ce.playerFromEffect)||0,aiFromRefresh:((Se=(we=(he=We.actions)==null?void 0:he.detailedStats)==null?void 0:we.cardsDrawn)==null?void 0:Se.aiFromRefresh)||0,aiFromEffect:((Le=(Xe=(ke=We.actions)==null?void 0:ke.detailedStats)==null?void 0:Xe.cardsDrawn)==null?void 0:Le.aiFromEffect)||0},discards:{total:((Ne=(Me=(be=We.actions)==null?void 0:be.detailedStats)==null?void 0:Me.discards)==null?void 0:Ne.total)||0,player:((De=(Ye=(Be=We.actions)==null?void 0:Be.detailedStats)==null?void 0:Ye.discards)==null?void 0:De.player)||0,ai:((tt=(et=(Ge=We.actions)==null?void 0:Ge.detailedStats)==null?void 0:et.discards)==null?void 0:tt.ai)||0},deletes:{total:((Rt=(ht=(rt=We.actions)==null?void 0:rt.detailedStats)==null?void 0:ht.deletes)==null?void 0:Rt.total)||0,player:((fn=(En=(Ft=We.actions)==null?void 0:Ft.detailedStats)==null?void 0:En.deletes)==null?void 0:fn.player)||0,ai:((un=(nn=(Zt=We.actions)==null?void 0:Zt.detailedStats)==null?void 0:nn.deletes)==null?void 0:un.ai)||0},flips:{total:((xn=(Xn=(jn=We.actions)==null?void 0:jn.detailedStats)==null?void 0:Xn.flips)==null?void 0:xn.total)||0,player:((Ya=(qn=(kn=We.actions)==null?void 0:kn.detailedStats)==null?void 0:qn.flips)==null?void 0:Ya.player)||0,ai:((qa=(Pa=($a=We.actions)==null?void 0:$a.detailedStats)==null?void 0:Pa.flips)==null?void 0:qa.ai)||0},shifts:{total:((ua=(da=(Ea=We.actions)==null?void 0:Ea.detailedStats)==null?void 0:da.shifts)==null?void 0:ua.total)||0,player:((Vt=(Cn=(La=We.actions)==null?void 0:La.detailedStats)==null?void 0:Cn.shifts)==null?void 0:Vt.player)||0,ai:((pa=(Ln=(Yt=We.actions)==null?void 0:Yt.detailedStats)==null?void 0:Ln.shifts)==null?void 0:pa.ai)||0},returns:{total:((Ua=(Xa=(Qa=We.actions)==null?void 0:Qa.detailedStats)==null?void 0:Xa.returns)==null?void 0:Ua.total)||0,player:((Un=(ja=(Zn=We.actions)==null?void 0:Zn.detailedStats)==null?void 0:ja.returns)==null?void 0:Un.player)||0,ai:((Nn=(On=(Rn=We.actions)==null?void 0:Rn.detailedStats)==null?void 0:On.returns)==null?void 0:Nn.ai)||0},compiles:{total:((Ra=(ka=(Ot=We.actions)==null?void 0:Ot.detailedStats)==null?void 0:ka.compiles)==null?void 0:Ra.total)||0,player:((ge=(Tn=(Sn=We.actions)==null?void 0:Sn.detailedStats)==null?void 0:Tn.compiles)==null?void 0:ge.player)||0,ai:((mt=(Qe=(Oe=We.actions)==null?void 0:Oe.detailedStats)==null?void 0:Qe.compiles)==null?void 0:mt.ai)||0,playerFirstCompile:((ct=(Je=(Ze=We.actions)==null?void 0:Ze.detailedStats)==null?void 0:Je.compiles)==null?void 0:ct.playerFirstCompile)||0,playerRecompile:((Re=(ue=(ot=We.actions)==null?void 0:ot.detailedStats)==null?void 0:ue.compiles)==null?void 0:Re.playerRecompile)||0,aiFirstCompile:((dt=(ze=(Fe=We.actions)==null?void 0:Fe.detailedStats)==null?void 0:ze.compiles)==null?void 0:dt.aiFirstCompile)||0,aiRecompile:((Dn=(Dt=(it=We.actions)==null?void 0:it.detailedStats)==null?void 0:Dt.compiles)==null?void 0:Dn.aiRecompile)||0},refreshes:{total:((hn=(Na=(Kn=We.actions)==null?void 0:Kn.detailedStats)==null?void 0:Na.refreshes)==null?void 0:hn.total)||0,player:((fa=(kr=(tr=We.actions)==null?void 0:tr.detailedStats)==null?void 0:kr.refreshes)==null?void 0:fa.player)||0,ai:((wo=(_o=(nr=We.actions)==null?void 0:nr.detailedStats)==null?void 0:_o.refreshes)==null?void 0:wo.ai)||0,playerCardsDrawn:((Kt=(ar=(Za=We.actions)==null?void 0:Za.detailedStats)==null?void 0:ar.refreshes)==null?void 0:Kt.playerCardsDrawn)||0,aiCardsDrawn:((xo=(Mn=(Ka=We.actions)==null?void 0:Ka.detailedStats)==null?void 0:Mn.refreshes)==null?void 0:xo.aiCardsDrawn)||0}}}};return(!((Co=We.control)!=null&&Co.playerRearranges)||!We.coinFlip||!((Ta=We.actions)!=null&&Ta.totalCompiles)||!((Da=We.actions)!=null&&Da.detailedStats)||Object.keys(cn).length!==Object.keys(We.protocols||{}).length)&&il(Jt),Jt}catch(Ja){return console.error("Failed to load statistics:",Ja),ay()}}function il(t){try{localStorage.setItem(zu,JSON.stringify(t))}catch(n){console.error("Failed to save statistics:",n)}}function mk(){try{localStorage.removeItem(zu)}catch(t){console.error("Failed to reset statistics:",t)}}function yk(t,n,r,s,c,d=!1,u,p,f,h){const y=n==="player",m={...t.global},g={...t.protocols},v={easy:{...t.aiDifficulty.easy},normal:{...t.aiDifficulty.normal},hard:{...t.aiDifficulty.hard}},C={...t.control},b={...t.actions},x={...t.coinFlip},j={played:{...t.cards.played},deleted:{...t.cards.deleted}};m.totalGamesPlayed++,y?m.totalGamesWon++:m.totalGamesLost++,m.totalPlaytime+=c,y&&(m.fastestWin===null||c<m.fastestWin)&&(m.fastestWin=c),(m.longestGame===null||c>m.longestGame)&&(m.longestGame=c),m.lastGameDuration=c,y?(m.currentStreak>=0?m.currentStreak++:m.currentStreak=1,m.currentStreak>m.longestWinStreak&&(m.longestWinStreak=m.currentStreak)):(m.currentStreak<=0?m.currentStreak--:m.currentStreak=-1,Math.abs(m.currentStreak)>m.longestLoseStreak&&(m.longestLoseStreak=Math.abs(m.currentStreak))),r.forEach(k=>{g[k]?g[k]={...g[k]}:g[k]={timesUsed:0,wins:0,losses:0},g[k].timesUsed++,y?g[k].wins++:g[k].losses++}),v[s].played++,y?v[s].wins++:v[s].losses++,d?C.gamesWithControl++:C.gamesWithoutControl++;const E={cardsPlayed:{...t.actions.detailedStats.cardsPlayed},cardsDrawn:{...t.actions.detailedStats.cardsDrawn},discards:{...t.actions.detailedStats.discards},deletes:{...t.actions.detailedStats.deletes},flips:{...t.actions.detailedStats.flips},shifts:{...t.actions.detailedStats.shifts},returns:{...t.actions.detailedStats.returns},compiles:{...t.actions.detailedStats.compiles},refreshes:{...t.actions.detailedStats.refreshes}};return u&&(b.totalCardsPlayed+=u.cardsPlayed,b.totalCardsDrawn+=u.cardsDrawn,b.totalDiscards+=u.cardsDiscarded,b.totalDeletes+=u.cardsDeleted,b.totalFlips+=u.cardsFlipped,b.totalShifts+=u.cardsShifted,b.totalRefreshes+=u.handsRefreshed,b.totalReturns+=u.cardsReturned||0,E.cardsPlayed.total+=u.cardsPlayed,E.cardsPlayed.player+=u.cardsPlayed,E.cardsDrawn.total+=u.cardsDrawn,E.cardsDrawn.player+=u.cardsDrawn,E.discards.total+=u.cardsDiscarded,E.discards.player+=u.cardsDiscarded,E.deletes.total+=u.cardsDeleted,E.deletes.player+=u.cardsDeleted,E.flips.total+=u.cardsFlipped,E.flips.player+=u.cardsFlipped,E.shifts.total+=u.cardsShifted,E.shifts.player+=u.cardsShifted,E.returns.total+=u.cardsReturned||0,E.returns.player+=u.cardsReturned||0,E.refreshes.total+=u.handsRefreshed,E.refreshes.player+=u.handsRefreshed),f&&(b.totalCardsPlayed+=f.cardsPlayed,b.totalCardsDrawn+=f.cardsDrawn,b.totalDiscards+=f.cardsDiscarded,b.totalDeletes+=f.cardsDeleted,b.totalFlips+=f.cardsFlipped,b.totalShifts+=f.cardsShifted,b.totalRefreshes+=f.handsRefreshed,b.totalReturns+=f.cardsReturned||0,E.cardsPlayed.total+=f.cardsPlayed,E.cardsPlayed.ai+=f.cardsPlayed,E.cardsDrawn.total+=f.cardsDrawn,E.cardsDrawn.ai+=f.cardsDrawn,E.discards.total+=f.cardsDiscarded,E.discards.ai+=f.cardsDiscarded,E.deletes.total+=f.cardsDeleted,E.deletes.ai+=f.cardsDeleted,E.flips.total+=f.cardsFlipped,E.flips.ai+=f.cardsFlipped,E.shifts.total+=f.cardsShifted,E.shifts.ai+=f.cardsShifted,E.returns.total+=f.cardsReturned||0,E.returns.ai+=f.cardsReturned||0,E.refreshes.total+=f.handsRefreshed,E.refreshes.ai+=f.handsRefreshed),h&&(h.cardsPlayed&&(E.cardsPlayed.playerFromHand+=h.cardsPlayed.playerFromHand,E.cardsPlayed.playerFromEffect+=h.cardsPlayed.playerFromEffect,E.cardsPlayed.aiFromHand+=h.cardsPlayed.aiFromHand,E.cardsPlayed.aiFromEffect+=h.cardsPlayed.aiFromEffect,E.cardsPlayed.playerFaceUp+=h.cardsPlayed.playerFaceUp,E.cardsPlayed.playerFaceDown+=h.cardsPlayed.playerFaceDown,E.cardsPlayed.aiFaceUp+=h.cardsPlayed.aiFaceUp,E.cardsPlayed.aiFaceDown+=h.cardsPlayed.aiFaceDown),h.cardsDrawn&&(E.cardsDrawn.playerFromRefresh+=h.cardsDrawn.playerFromRefresh,E.cardsDrawn.playerFromEffect+=h.cardsDrawn.playerFromEffect,E.cardsDrawn.aiFromRefresh+=h.cardsDrawn.aiFromRefresh,E.cardsDrawn.aiFromEffect+=h.cardsDrawn.aiFromEffect),h.compiles&&(E.compiles.playerFirstCompile+=h.compiles.playerFirstCompile,E.compiles.playerRecompile+=h.compiles.playerRecompile,E.compiles.aiFirstCompile+=h.compiles.aiFirstCompile,E.compiles.aiRecompile+=h.compiles.aiRecompile,E.compiles.player+=h.compiles.playerFirstCompile+h.compiles.playerRecompile,E.compiles.ai+=h.compiles.aiFirstCompile+h.compiles.aiRecompile,E.compiles.total+=h.compiles.playerFirstCompile+h.compiles.playerRecompile+h.compiles.aiFirstCompile+h.compiles.aiRecompile),h.refreshes&&(E.refreshes.playerCardsDrawn+=h.refreshes.playerCardsDrawn,E.refreshes.aiCardsDrawn+=h.refreshes.aiCardsDrawn)),p!==void 0&&(b.totalCompiles+=p),b.detailedStats=E,{version:t.version,global:m,protocols:g,aiDifficulty:v,cards:j,actions:b,control:C,coinFlip:x}}function gk(t,n){const r={...t,cards:{...t.cards,played:{...t.cards.played}}};return r.cards.played[n]||(r.cards.played[n]=0),r.cards.played[n]++,r}function vk(t,n){const r={...t,cards:{...t.cards,deleted:{...t.cards.deleted}}};return r.cards.deleted[n]||(r.cards.deleted[n]=0),r.cards.deleted[n]++,r}function _k(t,n){const r={...t,control:{...t.control}};return n==="player"?r.control.playerRearranges++:r.control.aiRearranges++,r.control.totalRearranges++,r}function wk(t,n,r){const s={...t,coinFlip:{...t.coinFlip}};return n==="heads"?(s.coinFlip.headsChosen++,r&&s.coinFlip.headsWon++):(s.coinFlip.tailsChosen++,r&&s.coinFlip.tailsWon++),s}function xk(t){return t.global.totalGamesPlayed===0?0:t.global.totalGamesWon/t.global.totalGamesPlayed*100}function Ck(t){return t.global.totalGamesPlayed===0?0:Math.floor(t.global.totalPlaytime/t.global.totalGamesPlayed)}function Sk(t){return Object.entries(t.protocols).map(([r,s])=>({protocol:r,timesUsed:s.timesUsed,winRate:s.timesUsed>0?s.wins/s.timesUsed*100:0})).sort((r,s)=>s.timesUsed-r.timesUsed).slice(0,5)}function bk(t){return Object.entries(t.protocols).filter(([r,s])=>s.timesUsed>=3).map(([r,s])=>({protocol:r,timesUsed:s.timesUsed,winRate:s.wins/s.timesUsed*100})).sort((r,s)=>s.winRate-r.winRate).slice(0,5)}function Ek(t){return Object.entries(t.protocols).map(([r,s])=>({protocol:r,timesUsed:s.timesUsed,winRate:s.timesUsed>0?s.wins/s.timesUsed*100:0})).sort((r,s)=>r.timesUsed-s.timesUsed).slice(0,5)}function jk(t){return Object.entries(t.cards.played).map(([r,s])=>({card:r,count:s})).sort((r,s)=>s.count-r.count).slice(0,5)}function kk(t){return Object.entries(t.cards.deleted).map(([r,s])=>({card:r,count:s})).sort((r,s)=>s.count-r.count).slice(0,5)}function fs(t){const n=Math.floor(t/3600),r=Math.floor(t%3600/60),s=t%60;return n>0?`${n}h ${r}m`:r>0?`${r}m ${s}s`:`${s}s`}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function Rk(t,n,r){const[s,c]=J.useState(()=>ku()),d=J.useRef(null),u=J.useCallback(()=>{d.current=Date.now()},[]),p=J.useCallback((g,v)=>{c(C=>{const b=`${g}-${v}`,x=gk(C,b);return il(x),x})},[]),f=J.useCallback((g,v)=>{c(C=>{const b=`${g}-${v}`,x=vk(C,b);return il(x),x})},[]),h=J.useCallback((g,v)=>{c(C=>{const b=wk(C,g,v);return il(b),b})},[]),y=J.useCallback(g=>{c(v=>{const C=_k(v,g);return il(C),C})},[]),m=J.useCallback((g,v,C,b,x)=>{if(d.current===null)return;const j=Math.floor((Date.now()-d.current)/1e3);c(E=>{const k=yk(E,g,t,n,j,r,v,C,b,x);return il(k),k}),d.current=null},[t,n,r]);return{statistics:s,startGame:u,endGame:m,trackPlayerCardPlayed:p,trackPlayerCardDeleted:f,trackPlayerCoinFlip:h,trackPlayerRearrange:y}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function w(t,n,r=!0){const c=er().find(d=>d.protocol===t&&d.value===n);return c?{id:pt(),protocol:c.protocol,value:c.value,top:c.top,middle:c.middle,bottom:c.bottom,keywords:c.keywords,isFaceUp:r,isRevealed:!1,category:c.category||"Main",...c.customEffects&&{customEffects:c.customEffects}}:(console.warn(`Card not found: ${t}-${n}`),{id:pt(),protocol:t,value:n,top:"",middle:"",bottom:"",keywords:{},isFaceUp:r,isRevealed:!1,category:"Main"})}function V(t,n,r,s){const c={...t},d={...c[n]},u=[...d.lanes];return u[r]=[...u[r],s],d.lanes=u,c[n]=d,c}function sn(t,n){const r=[],s=er();for(const c of t){const d=s.filter(u=>u.protocol===c);for(const u of d)n.some(f=>f.protocol===u.protocol&&f.value===u.value)||r.push(w(u.protocol,u.value,!0))}return r}function He(t,n,r,s,c){return{...t,player:{...t.player,protocols:n,lanes:[[],[],[]],hand:[]},opponent:{...t.opponent,protocols:r,lanes:[[],[],[]],hand:[]},turn:s,phase:c,actionRequired:null,queuedActions:[],_interruptedTurn:void 0,_interruptedPhase:void 0,processedStartEffectIds:[],processedEndEffectIds:[],processedUncoverEventIds:[]}}function Ve(t){const n=[...t.player.hand,...t.player.lanes.flat()],r=[...t.opponent.hand,...t.opponent.lanes.flat()],s=sn(t.player.protocols,n),c=sn(t.opponent.protocols,r),d=t.turn==="player"?"Player":"Opponent",u=[{player:"player",message:`Player protocols: ${t.player.protocols.join(", ")}`},{player:"opponent",message:`Opponent protocols: ${t.opponent.protocols.join(", ")}`},{player:t.turn,message:`${d} goes first.`},{player:"player",message:"---"},{player:t.turn,message:`[Test Scenario] Phase: ${t.phase}`}];return{...t,player:{...t.player,deck:s,discard:[],compiled:[!1,!1,!1]},opponent:{...t.opponent,deck:c,discard:[],compiled:[!1,!1,!1]},log:u}}const Dg={name:"Psychic-3 Uncover whrend Opponent's Turn",description:"Player lscht Opponent's face-down card  Psychic-3 uncovered  Player discardet, Opponent shiftet",setup:t=>{let n=He(t,["Hate","Fire","Water"],["Psychic","Death","Spirit"],"player","action");return n.player.hand=[w("Hate",0,!0),w("Fire",1,!0),w("Water",1,!0)],n=V(n,"opponent",1,w("Psychic",3,!0)),n=V(n,"opponent",1,w("Fire",1,!1)),n=qe(n),Ve(n)}},Ag={name:"Psychic-4 End Effect mit Uncover-Interrupt",description:"Psychic-4 returnt Fire-2  Fire-4 uncovered  Interrupt  Psychic-4 flip aus Queue",setup:t=>{let n=He(t,["Fire","Water","Spirit"],["Psychic","Death","Metal"],"opponent","end");return n=V(n,"opponent",0,w("Psychic",4,!0)),n=V(n,"player",1,w("Fire",4,!0)),n=V(n,"player",1,w("Fire",2,!0)),n.opponent.hand=[w("Water",1),w("Water",2)],n=qe(n),Ve(n)}},Fg={name:"Spirit-3 Draw whrend End Phase",description:"Spirit-3 draw in End Phase  Shift-prompt in Queue  Player kann lanes klicken",setup:t=>{let n=He(t,["Spirit","Fire","Water"],["Death","Metal","Psychic"],"player","action");n=V(n,"player",0,w("Spirit",3,!0));const r=er(),s=r.find(u=>u.protocol==="Fire"&&u.value===1),c=r.find(u=>u.protocol==="Water"&&u.value===1),d=r.find(u=>u.protocol==="Spirit"&&u.value===1);return n.player.deck=[s,c,d],n=qe(n),Ve(n)}},Ig={name:"Plague-2 Actor Propagation",description:"Player spielt Plague-2  Player discardet  Opponent discardet (actor korrekt)",setup:t=>{let n=He(t,["Plague","Death","Hate"],["Fire","Water","Spirit"],"player","action");return n.player.hand=[w("Plague",2,!0),w("Fire",1),w("Water",1),w("Spirit",1)],n.opponent.hand=[w("Fire",2),w("Water",2),w("Spirit",2),w("Death",2)],n=qe(n),Ve(n)}},$g={name:"Darkness-1 Flip + Shift mit Interrupt",description:"Darkness-1 flippt Fire-0  Delete-Interrupt  Player shiftet",setup:t=>{let n=He(t,["Darkness","Fire","Water"],["Spirit","Death","Metal"],"player","action");return n.player.hand=[w("Darkness",1,!0)],n=V(n,"opponent",0,w("Fire",0,!1)),n=qe(n),Ve(n)}},Pg={name:"Plague-4 Owner vs Turn Check",description:"Plague-4 End  Player deletet  Opponent (owner) wird fr flip gefragt",setup:t=>{let n=He(t,["Fire","Water","Spirit"],["Plague","Death","Metal"],"opponent","end");return n=V(n,"opponent",0,w("Plague",4,!0)),n=V(n,"player",1,w("Water",2,!1)),n=qe(n),Ve(n)}},qg={name:"Water Owner vs Turn Check",description:"Plague-4 End  Player deletet  Opponent (owner) wird fr flip gefragt",setup:t=>{let n=He(t,["Fire","Water","Spirit"],["Plague","Death","Metal"],"player","action");return n=V(n,"opponent",0,w("Plague",4,!0)),n=V(n,"player",2,w("Water",4,!1)),n.player.hand=[w("Water",0,!0),w("Fire",1),w("Water",1),w("Spirit",1)],n.opponent.hand=[w("Fire",2),w("Water",2),w("Spirit",2),w("Death",2)],n=qe(n),Ve(n)}},Lg={name:"Hate-1 Multi-Delete mit Uncover-Interrupt",description:"Hate-1 lscht Plague-0  Plague-5 uncovered  Interrupt  Player macht 2. Delete",setup:t=>{let n=He(t,["Fire","Hate","Water"],["Plague","Death","Metal"],"player","action");return n.player.hand=[w("Hate",1,!0),w("Psychic",2,!0),w("Psychic",4,!0),w("Hate",4,!0),w("Water",1,!0)],n=V(n,"opponent",0,w("Plague",2,!0)),n=V(n,"opponent",0,w("Plague",0,!0)),n=V(n,"player",0,w("War",3,!0)),n.opponent.hand=[w("Fire",2,!0),w("Water",2,!0),w("Spirit",2,!0),w("Death",2,!0),w("Metal",2,!0)],n=qe(n),Ve(n)}},Ug={name:"Darkness-1  Hate-0 Flip  Multi-Effect Chain",description:" Darkness-1 flippt Hate-0  Delete-Interrupt  Draw-Interrupt  Shift aus Queue",setup:t=>{let n=He(t,["Darkness","Fire","Water"],["Hate","Death","Metal"],"player","action");n.player.hand=[w("Darkness",1,!0)],n=V(n,"opponent",0,w("Hate",0,!1)),n=V(n,"opponent",1,w("Hate",3,!0)),n=V(n,"opponent",2,w("Fire",1,!1)),n=V(n,"player",1,w("Water",2,!0)),n.opponent.hand=[w("Death",2),w("Metal",3)];const s=er().find(c=>c.protocol==="Death"&&c.value===1);return n.opponent.deck=[s],n=qe(n),Ve(n)}},Og={name:"Water-4 Return  Turn End",description:" Water-4 returnt Karte  Turn endet (Bug-Fix: Opponent spielt nicht zweimal)",setup:t=>{let n=He(t,["Hate","Spirit","Light"],["Fire","Water","Death"],"opponent","action");return n.opponent.hand=[w("Water",4,!0)],n=V(n,"opponent",0,w("Life",4,!0)),n=V(n,"opponent",2,w("Death",4,!1)),n=V(n,"player",1,w("Spirit",1,!0)),n=V(n,"player",2,w("Light",5,!1)),n.player.hand=[w("Fire",1),w("Spirit",2),w("Hate",4)],n=qe(n),Ve(n)}},Mg={name:"Psychic-3 Discard + Shift",description:" Psychic-3 On-Play  Player discardet  AI shiftet (Bug-Fix: AI kann shiften)",setup:t=>{let n=He(t,["Fire","Water","Spirit"],["Psychic","Death","Metal"],"opponent","action");return n.opponent.hand=[w("Psychic",3,!0)],n.player.hand=[w("Fire",1),w("Water",2),w("Spirit",1)],n=V(n,"player",0,w("Fire",2,!0)),n=V(n,"player",1,w("Water",3,!0)),n=V(n,"player",2,w("Spirit",4,!0)),n=qe(n),Ve(n)}},Hg={name:"Death-1 Delete  Speed-3 Uncover",description:" Death-1 lscht Light-0  Speed-3 uncovered  Player shiftet (Bug-Fix Test)",setup:t=>{let n=He(t,["Speed","Light","Water"],["Death","Fire","Metal"],"opponent","start");return n=V(n,"player",0,w("Speed",3,!0)),n=V(n,"player",0,w("Light",0,!0)),n=V(n,"player",1,w("Water",1,!0)),n=V(n,"opponent",0,w("Death",1,!0)),n.player.hand=[],n.opponent.hand=[],n=qe(n),Ve(n)}},Vg={name:"Gravity-2 Flip  Metal-5 Discard  Shift",description:" Gravity-2 flippt Metal-5  Discard Interrupt  shiften (Bug-Fix: AI stuck)",setup:t=>{let n=He(t,["Fire","Water","Light"],["Gravity","Metal","Fire"],"opponent","action");return n.opponent.hand=[w("Gravity",2,!0),w("Fire",1)],n=V(n,"opponent",1,w("Metal",5,!1)),n=V(n,"player",0,w("Fire",2,!0)),n=V(n,"player",2,w("Light",3,!0)),n.player.hand=[w("Water",1),w("Fire",3)],n=qe(n),Ve(n)}},zg={name:"Hate-2 Player spielt (Einfach)",description:" Player spielt Hate-2  Whlt eigene & Gegners hchste Karte",setup:t=>{let n=He(t,["Hate","Water","Light"],["Metal","Death","Gravity"],"player","action");return n.player.hand=[w("Hate",2,!0)],n=V(n,"player",0,w("Fire",4,!0)),n=V(n,"player",1,w("Water",2,!0)),n=V(n,"player",2,w("Light",5,!0)),n=V(n,"opponent",0,w("Metal",3,!0)),n=V(n,"opponent",1,w("Death",5,!0)),n=V(n,"opponent",2,w("Gravity",2,!1)),n=qe(n),Ve(n)}},Bg={name:"Hate-2 AI spielt (Normal)",description:" AI spielt Hate-2  AI whlt eigene & Players hchste automatisch",setup:t=>{let n=He(t,["Water","Spirit","Light"],["Hate","Metal","Death"],"opponent","action");return n.opponent.hand=[w("Hate",2,!0)],n=V(n,"opponent",0,w("Fire",5,!0)),n=V(n,"opponent",1,w("Metal",3,!0)),n=V(n,"opponent",2,w("Death",2,!1)),n=V(n,"player",0,w("Water",4,!0)),n=V(n,"player",1,w("Spirit",5,!0)),n=V(n,"player",2,w("Light",2,!0)),n=qe(n),Ve(n)}},Gg={name:"Hate-2 AI spielt (Normal) mit Auswahl",description:" AI spielt Hate-2  AI whlt eigene & Players hchste automatisch",setup:t=>{let n=He(t,["Water","Spirit","Light"],["Hate","Metal","Death"],"opponent","action");return n.opponent.hand=[w("Hate",2,!0)],n=V(n,"opponent",0,w("Fire",5,!0)),n=V(n,"opponent",1,w("Metal",3,!0)),n=V(n,"opponent",2,w("Death",2,!1)),n=V(n,"player",0,w("Water",4,!0)),n=V(n,"player",1,w("Spirit",5,!0)),n=V(n,"player",2,w("Light",5,!0)),n=qe(n),Ve(n)}},Wg={name:"Hate-2 Selbst-Lschung",description:" Hate-2 lscht sich selbst  Zweite Klausel entfllt (Regelwerk-Check)",setup:t=>{let n=He(t,["Hate","Fire","Water"],["Metal","Death","Gravity"],"player","action");return n.player.hand=[w("Hate",2,!0)],n=V(n,"player",1,w("Fire",1,!0)),n=V(n,"player",2,w("Water",0,!0)),n=V(n,"opponent",0,w("Metal",3,!0)),n=V(n,"opponent",1,w("Death",5,!0)),n=qe(n),Ve(n)}},Yg={name:"Hate-2 Gleichstand (Auswahl)",description:" Hate-2 mit mehreren hchsten  Player muss whlen (Tied values)",setup:t=>{let n=He(t,["Hate","Water","Spirit"],["Metal","Death","Gravity"],"player","action");return n.player.hand=[w("Hate",2,!0)],n=V(n,"player",0,w("Fire",4,!0)),n=V(n,"player",1,w("Water",4,!0)),n=V(n,"player",2,w("Spirit",4,!0)),n=V(n,"opponent",0,w("Metal",5,!0)),n=V(n,"opponent",1,w("Death",5,!0)),n=V(n,"opponent",2,w("Gravity",2,!1)),n=qe(n),Ve(n)}},Qg={name:"Hate-2 Face-Down Karten",description:" Hate-2 mit face-down  Alle face-down sind value 2 (Tied mit Hate-2)",setup:t=>{let n=He(t,["Hate","Fire","Water"],["Metal","Death","Gravity"],"player","action");return n.player.hand=[w("Hate",2,!0)],n=V(n,"player",1,w("Fire",5,!1)),n=V(n,"player",2,w("Water",5,!1)),n=V(n,"opponent",0,w("Metal",5,!0)),n=V(n,"opponent",1,w("Death",4,!1)),n=V(n,"opponent",2,w("Gravity",1,!0)),n=qe(n),Ve(n)}},Xg={name:"Hate-2 AI Play-Validation",description:" AI spielt Hate-2 NICHT face-up wenn es sich selbst lschen wrde",setup:t=>{let n=He(t,["Fire","Water","Spirit"],["Hate","Death","Metal"],"opponent","action");return n.opponent.hand=[w("Hate",2,!0)],n=V(n,"opponent",1,w("Fire",0,!0)),n=V(n,"opponent",2,w("Water",1,!0)),n=V(n,"player",0,w("Fire",5,!0)),n=V(n,"player",1,w("Water",4,!0)),n=qe(n),Ve(n)}},Zg={name:"Hate-2 AI spielt OFFEN (Optimal)",description:" AI spielt Hate-2 offen weil nicht hchste Karte",setup:t=>{let n=He(t,["Water","Spirit","Light"],["Hate","Metal","Death"],"opponent","action");return n.opponent.hand=[w("Hate",2,!0)],n=V(n,"opponent",0,w("Fire",5,!0)),n=V(n,"opponent",1,w("Metal",4,!0)),n=V(n,"opponent",2,w("Death",3,!0)),n=V(n,"player",0,w("Water",2,!0)),n=V(n,"player",1,w("Spirit",5,!0)),n=V(n,"player",2,w("Light",1,!0)),n=qe(n),Ve(n)}},Nk={name:"Chaos-3 Protocol-Free Playing",description:"Player with Chaos-3 can play any card face-up in any lane",setup:t=>{let n=He(t,["Chaos","Fire","Water"],["Spirit","Death","Metal"],"player","action");return n=V(n,"player",0,w("Chaos",3,!0)),n.player.hand=[w("Gravity",2,!0),w("Hate",3,!0),w("Love",1,!0)],n=qe(n),Ve(n)}},Tk={name:"Frost-3 Blocks Shifts (Covered)",description:"Frost-3 should prevent shifts even when covered (Top-Box effect always active)",setup:t=>{let n=He(t,["Gravity","Water","Fire"],["Frost","Metal","Death"],"player","action");return n=V(n,"opponent",0,w("Frost",3,!0)),n=V(n,"opponent",0,w("Metal",2,!1)),n=V(n,"player",1,w("Water",2,!0)),n.player.hand=[w("Gravity",1,!0),w("Fire",2,!0)],n=qe(n),Ve(n)}},Dk={name:"Water-0 Softlock Bug Fix",description:"Water-0 self-flip should be cancelled when card becomes covered before self-flip executes",setup:t=>{let n=He(t,["Water","Darkness","Light"],["Apathy","Fire","Death"],"player","action");return n=V(n,"player",1,w("Darkness",3,!1)),n.player.hand=[w("Water",0,!0),w("Darkness",2,!0),w("Fire",1,!0)],n=qe(n),Ve(n)}},Ak={name:"Darkness-1 Flip and Shift Chain",description:"Darkness-1 should flip opponent card, then allow shifting that same card",setup:t=>{let n=He(t,["Darkness","Water","Fire"],["Metal","Fire","Death"],"player","action");return n=V(n,"opponent",0,w("Metal",2,!1)),n=V(n,"opponent",1,w("Fire",1,!0)),n=V(n,"opponent",2,w("Hate",0,!1)),n.player.hand=[w("Darkness",1,!0),w("Water",2,!0),w("Fire",3,!0)],n=qe(n),Ve(n)}},Fk={name:"Darkness-1 Flips Speed-3 - Middle Effect Execution",description:"When Darkness-1 flips Speed-3, Speed-3's middle effect (shift) should execute before Darkness-1's shift",setup:t=>{let n=He(t,["Darkness","Water","Fire"],["Speed","Fire","Metal"],"player","action");return n=V(n,"opponent",0,w("Speed",3,!1)),n=V(n,"opponent",1,w("Fire",1,!0)),n=V(n,"opponent",2,w("Metal",2,!0)),n.player.hand=[w("Darkness",1,!0),w("Water",2,!0),w("Fire",3,!0)],n=qe(n),Ve(n)}},Ik={name:"Darkness-1 Flips Speed-3 - Middle Effect Execution",description:"When Darkness-1 flips Speed-3, Speed-3's middle effect (shift) should execute before Darkness-1's shift",setup:t=>{let n=He(t,["Darkness","Water","Fire"],["Speed","Fire","Metal"],"player","action");return n=V(n,"opponent",0,w("Speed",3,!1)),n=V(n,"opponent",1,w("Fire",1,!0)),n=V(n,"opponent",2,w("Metal",2,!0)),n.player.hand=[w("Darkness",1,!0),w("Water",2,!0),w("Fire",3,!0)],n=qe(n),Ve(n)}},Kg={name:"Fire-1 & Fire-2 Conditional Test",description:" Fire-1 (discard -> delete) & Fire-2 (discard -> return) if_executed logic",setup:t=>{let n=He(t,["Fire","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[w("Fire",1,!0),w("Fire",2,!0),w("Fire",0,!0),w("Fire",3,!0),w("Fire",4,!0),w("Fire",5,!0)],n=V(n,"opponent",0,w("Metal",3,!0)),n=V(n,"opponent",1,w("Death",4,!0)),n=V(n,"opponent",2,w("Fire",2,!0)),n=V(n,"opponent",0,w("Metal",1,!0)),n=V(n,"player",2,w("Spirit",3,!0)),n=V(n,"player",1,w("Water",3,!0)),n=V(n,"player",2,w("Spirit",2,!0)),n=qe(n),Ve(n)}},Jg={name:"Anarchy Test Playground",description:" All Anarchy cards on hand for testing",setup:t=>{let n=He(t,["Anarchy","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[w("Anarchy",0,!0),w("Anarchy",1,!0),w("Anarchy",2,!0),w("Anarchy",3,!0),w("Anarchy",5,!0),w("Anarchy",6,!0)],n=V(n,"opponent",0,w("Metal",3,!0)),n=V(n,"opponent",1,w("Death",4,!1)),n=V(n,"opponent",2,w("Fire",2,!0)),n=V(n,"opponent",0,w("Metal",1,!0)),n=V(n,"player",2,w("Spirit",3,!0)),n=V(n,"player",1,w("Water",3,!0)),n=V(n,"player",2,w("Spirit",2,!0)),n=qe(n),Ve(n)}},ev={name:"Darkness Test Playground",description:" All Darkness cards on hand for testing",setup:t=>{let n=He(t,["Darkness","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[w("Darkness",0,!0),w("Darkness",1,!0),w("Darkness",2,!0),w("Darkness",3,!0),w("Darkness",4,!0),w("Darkness",5,!0)],n=V(n,"opponent",0,w("Metal",3,!1)),n=V(n,"opponent",1,w("Death",4,!0)),n=V(n,"opponent",2,w("Fire",2,!1)),n=V(n,"opponent",0,w("Metal",1,!0)),n=V(n,"opponent",1,w("Death",2,!1)),n=V(n,"player",2,w("Spirit",3,!0)),n=V(n,"player",1,w("Water",3,!0)),n=V(n,"player",2,w("Spirit",2,!0)),n=qe(n),Ve(n)}},tv={name:"Apathy Test Playground",description:" All Apathy cards on hand for testing",setup:t=>{let n=He(t,["Apathy","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[w("Apathy",0,!0),w("Apathy",1,!0),w("Apathy",2,!0),w("Apathy",3,!0),w("Apathy",4,!0),w("Apathy",5,!0)],n=V(n,"opponent",0,w("Metal",3,!0)),n=V(n,"opponent",1,w("Death",4,!0)),n=V(n,"opponent",2,w("Fire",2,!0)),n=V(n,"opponent",0,w("Metal",1,!0)),n=V(n,"opponent",2,w("Fire",1,!1)),n=V(n,"player",2,w("Spirit",3,!0)),n=V(n,"player",1,w("Water",3,!0)),n=V(n,"player",2,w("Spirit",2,!0)),n=qe(n),Ve(n)}},nv={name:"Death Test Playground",description:" All Death cards on hand for testing",setup:t=>{let n=He(t,["Death","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[w("Death",0,!0),w("Death",1,!0),w("Death",2,!0),w("Death",3,!0),w("Death",4,!0),w("Death",5,!0)],n=V(n,"opponent",0,w("Metal",0,!0)),n=V(n,"opponent",1,w("Death",1,!0)),n=V(n,"opponent",2,w("Fire",3,!0)),n=V(n,"opponent",0,w("Metal",2,!0)),n=V(n,"opponent",1,w("Death",4,!1)),n=V(n,"player",2,w("Spirit",3,!0)),n=V(n,"player",1,w("Water",3,!0)),n=V(n,"player",2,w("Spirit",2,!0)),n=qe(n),Ve(n)}},av={name:"Water Test Playground",description:" All Water cards on hand for testing - wash away and renew",setup:t=>{let n=He(t,["Water","Fire","Spirit"],["Metal","Death","Light"],"player","action");return n.player.hand=[w("Water",0,!0),w("Water",1,!0),w("Water",2,!0),w("Water",3,!0),w("Water",4,!0),w("Water",5,!0)],n=V(n,"opponent",0,w("Metal",2,!0)),n=V(n,"opponent",1,w("Death",3,!0)),n=V(n,"opponent",2,w("Light",2,!0)),n=V(n,"opponent",0,w("Metal",4,!0)),n=V(n,"opponent",1,w("Death",2,!1)),n=V(n,"opponent",2,w("Light",5,!1)),n=V(n,"player",1,w("Fire",2,!0)),n=V(n,"player",2,w("Spirit",3,!0)),n=V(n,"player",1,w("Fire",4,!0)),n=V(n,"player",2,w("Spirit",5,!1)),n=qe(n),Ve(n)}},ov={name:"Spirit Test Playground",description:" All Spirit cards on hand - true strength from within",setup:t=>{let n=He(t,["Spirit","Fire","Water"],["Metal","Death","Light"],"player","action");return n.player.hand=[w("Spirit",0,!0),w("Spirit",1,!0),w("Spirit",2,!0),w("Spirit",3,!0),w("Spirit",4,!0),w("Spirit",5,!0)],n=V(n,"opponent",0,w("Metal",3,!0)),n=V(n,"opponent",1,w("Death",2,!1)),n=V(n,"opponent",2,w("Light",4,!0)),n=V(n,"opponent",0,w("Metal",5,!1)),n=V(n,"opponent",2,w("Light",3,!0)),n=V(n,"player",1,w("Fire",2,!0)),n=V(n,"player",2,w("Water",4,!0)),n=V(n,"player",1,w("Fire",3,!1)),n=qe(n),Ve(n)}},rv={name:"Chaos Test Playground",description:" All Chaos cards on hand - embrace the unpredictable",setup:t=>{let n=He(t,["Chaos","Fire","Water"],["Metal","Death","Light"],"player","action");return n.player.hand=[w("Chaos",0,!0),w("Chaos",1,!0),w("Chaos",2,!0),w("Chaos",3,!0),w("Chaos",4,!0),w("Chaos",5,!0)],n=V(n,"opponent",0,w("Metal",2,!0)),n=V(n,"opponent",0,w("Metal",4,!0)),n=V(n,"opponent",1,w("Death",3,!1)),n=V(n,"opponent",1,w("Death",5,!0)),n=V(n,"opponent",2,w("Light",1,!0)),n=V(n,"opponent",2,w("Light",3,!1)),n=V(n,"player",0,w("Fire",2,!0)),n=V(n,"player",0,w("Fire",4,!0)),n=V(n,"player",1,w("Water",3,!1)),n=V(n,"player",1,w("Water",5,!0)),n=V(n,"player",2,w("Fire",1,!0)),n=qe(n),Ve(n)}},lv={name:"Gravity Test Playground",description:" All Gravity cards on hand - pull everything together",setup:t=>{let n=He(t,["Fire","Gravity","Water"],["Metal","Death","Light"],"player","action");return n.player.hand=[w("Gravity",0,!0),w("Gravity",1,!0),w("Gravity",2,!0),w("Gravity",4,!0),w("Gravity",5,!0),w("Gravity",6,!0)],n=V(n,"player",0,w("Fire",1,!0)),n=V(n,"player",2,w("Water",2,!1)),n=V(n,"opponent",0,w("Metal",3,!1)),n=V(n,"opponent",0,w("Metal",4,!0)),n=V(n,"opponent",1,w("Death",2,!1)),n=V(n,"opponent",1,w("Death",3,!0)),n=V(n,"opponent",2,w("Light",4,!1)),n.opponent.deck=[w("Metal",5,!0),w("Death",4,!0),w("Light",5,!0)],n=qe(n),Ve(n)}},sv={name:"Frost Test Playground",description:" All Frost cards on hand - pull everything together",setup:t=>{let n=He(t,["Fire","Frost","Water"],["Metal","Death","Light"],"player","action");return n.player.hand=[w("Frost",0,!0),w("Frost",1,!0),w("Frost",2,!0),w("Frost",3,!0),w("Frost",4,!0),w("Frost",5,!0)],n=V(n,"player",0,w("Fire",1,!0)),n=V(n,"player",2,w("Water",2,!1)),n=V(n,"opponent",0,w("Metal",3,!1)),n=V(n,"opponent",0,w("Metal",4,!0)),n=V(n,"opponent",1,w("Death",2,!1)),n=V(n,"opponent",1,w("Death",3,!0)),n=V(n,"opponent",2,w("Light",4,!1)),n.opponent.deck=[w("Metal",5,!0),w("Death",4,!0),w("Light",5,!0)],n=qe(n),Ve(n)}},cv={name:"Hate Test Playground",description:" All Hate cards on hand - test deletion mechanics",setup:t=>{let n=He(t,["Hate","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[w("Hate",0,!0),w("Hate",1,!0),w("Hate",2,!0),w("Hate",3,!0),w("Hate",4,!0),w("Hate",5,!0)],n=V(n,"player",1,w("Water",1,!0)),n=V(n,"player",1,w("Water",2,!0)),n=V(n,"player",1,w("Water",3,!0)),n=V(n,"player",2,w("Spirit",2,!0)),n=V(n,"player",2,w("Spirit",4,!1)),n=V(n,"opponent",0,w("Metal",5,!0)),n=V(n,"opponent",1,w("Death",2,!0)),n=V(n,"opponent",1,w("Death",4,!0)),n=V(n,"opponent",2,w("Fire",3,!1)),n.player.deck=[w("Water",0,!0),w("Water",4,!0),w("Spirit",0,!0),w("Spirit",5,!0)],n.opponent.deck=[w("Metal",3,!0),w("Death",5,!0),w("Fire",1,!0)],n=qe(n),Ve(n)}},iv={name:"Life Test Playground",description:" All Life cards on hand - test play and flip mechanics",setup:t=>{let n=He(t,["Life","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[w("Life",0,!0),w("Life",1,!0),w("Life",2,!0),w("Life",3,!0),w("Life",4,!0),w("Life",5,!0)],n=V(n,"player",1,w("Water",1,!0)),n=V(n,"player",1,w("Water",2,!0)),n=V(n,"player",1,w("Water",3,!0)),n=V(n,"player",2,w("Spirit",2,!0)),n=V(n,"player",2,w("Spirit",4,!1)),n=V(n,"opponent",0,w("Metal",3,!1)),n=V(n,"opponent",1,w("Death",2,!0)),n=V(n,"opponent",1,w("Death",4,!1)),n=V(n,"opponent",2,w("Fire",5,!1)),n.player.deck=[w("Water",0,!0),w("Water",3,!0),w("Water",4,!0),w("Spirit",0,!0),w("Spirit",1,!0),w("Spirit",2,!0),w("Spirit",3,!0),w("Spirit",4,!0)],n.opponent.deck=[w("Metal",1,!0),w("Death",3,!0),w("Fire",2,!0)],n=qe(n),Ve(n)}},dv={name:"Light Test Playground",description:" All Light cards on hand - burn away the dark",setup:t=>{let n=He(t,["Light","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[w("Light",0,!0),w("Light",1,!0),w("Light",2,!0),w("Light",3,!0),w("Light",4,!0),w("Light",5,!0)],n=V(n,"opponent",0,w("Fire",3,!1)),n=V(n,"opponent",1,w("Metal",4,!1)),n=V(n,"opponent",2,w("Death",5,!0)),n=V(n,"player",1,w("Water",2,!1)),n=V(n,"player",1,w("Water",3,!1)),n=V(n,"player",1,w("Water",4,!1)),n=V(n,"player",0,w("Spirit",1,!0)),n=V(n,"player",0,w("Spirit",2,!1)),n=V(n,"player",2,w("Spirit",5,!1)),n.player.deck=[w("Water",0,!0),w("Water",1,!0),w("Spirit",0,!0),w("Spirit",3,!0),w("Spirit",4,!0)],n.opponent.hand=[w("Metal",1,!0),w("Death",2,!0),w("Fire",3,!0),w("Metal",0,!0)],n=qe(n),Ve(n)}},uv={name:"Death-2 Uncover Interrupt - Turn Wechsel Test",description:"Death-2 lscht  Darkness-4 uncovered  Opponent shiftet  Turn muss zu Opponent wechseln",setup:t=>{let n=He(t,["Death","Fire","Hate"],["Water","Darkness","Spirit"],"player","action");return n.player.hand=[w("Death",2,!0),w("Fire",1,!0),w("Hate",1,!0)],n=V(n,"player",0,w("Fire",0,!1)),n=V(n,"opponent",1,w("Darkness",4,!0)),n=V(n,"opponent",1,w("Darkness",1,!0)),n=V(n,"opponent",0,w("Water",0,!1)),n.opponent.hand=[w("Water",1,!0),w("Spirit",1,!0)],n=qe(n),Ve(n)}},pv={name:"Apathy-5 Uncover - darf nur einmal triggern",description:"Hate-0 lscht Apathy-0  Apathy-5 uncovered  darf nur 1x triggern",setup:t=>{let n=He(t,["Hate","Fire","Death"],["Apathy","Darkness","Plague"],"player","action");return n.player.hand=[w("Hate",0,!0),w("Fire",2,!0),w("Death",2,!0)],n=V(n,"opponent",0,w("Apathy",5,!0)),n=V(n,"opponent",0,w("Apathy",4,!0)),n.opponent.hand=[w("Darkness",1,!0),w("Apathy",1,!0),w("Darkness",2,!0)],n=qe(n),Ve(n)}},fv={name:"Psychic-1 facedown flip darkness 2 test",description:"Psychic-1 facedown, darkness-2 flippt Karte nur noch facedown bug",setup:t=>{let n=He(t,["Frost","Gravity","Plague"],["Psychic","Darkness","Speed"],"player","action");return n.player.hand=[w("Darkness",1,!0),w("Darkness",2,!0),w("Speed",3,!0)],n=V(n,"opponent",0,w("Frost",0,!1)),n=V(n,"opponent",1,w("Gravity",6,!1)),n=V(n,"player",0,w("Psychic",4,!1)),n=V(n,"player",1,w("Psychic",1,!1)),n.opponent.hand=[w("Gravity",1,!0)],n=qe(n),Ve(n)}},hv={name:"Speed Test Playground",description:" All Speed cards on hand - swift and adaptive",setup:t=>{let n=He(t,["Speed","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[w("Speed",0,!0),w("Speed",1,!0),w("Speed",2,!0),w("Speed",3,!0),w("Speed",4,!0),w("Speed",5,!0)],n=V(n,"player",0,w("Water",2,!0)),n=V(n,"player",1,w("Spirit",3,!0)),n=V(n,"opponent",0,w("Metal",3,!1)),n=V(n,"opponent",1,w("Death",4,!1)),n=V(n,"opponent",2,w("Fire",2,!0)),n=V(n,"player",2,w("Spirit",5,!0)),n=V(n,"player",2,w("Spirit",4,!0)),n=qe(n),Ve(n)}},mv={name:"Metal Test Playground",description:" All Metal cards on hand - unyielding defense",setup:t=>{let n=He(t,["Metal","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[w("Metal",0,!0),w("Metal",1,!0),w("Metal",2,!0),w("Metal",3,!0),w("Metal",5,!0),w("Metal",6,!0)],n=V(n,"opponent",0,w("Metal",3,!1)),n=V(n,"opponent",1,w("Death",4,!0)),n=V(n,"player",1,w("Water",3,!0)),n=V(n,"opponent",2,w("Fire",0,!0)),n=V(n,"opponent",2,w("Fire",1,!0)),n=V(n,"opponent",2,w("Fire",2,!0)),n=V(n,"opponent",2,w("Fire",3,!0)),n=V(n,"opponent",2,w("Fire",4,!0)),n=V(n,"opponent",2,w("Fire",5,!0)),n=V(n,"player",2,w("Spirit",3,!0)),n=V(n,"player",2,w("Spirit",2,!0)),n=qe(n),Ve(n)}},yv={name:"Plague Test Playground",description:" All Plague cards on hand - spread suffering",setup:t=>{let n=He(t,["Plague","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[w("Plague",0,!0),w("Plague",1,!0),w("Plague",2,!0),w("Plague",3,!0),w("Plague",4,!0),w("Plague",5,!0)],n.opponent.hand=[w("Fire",2,!0),w("Death",3,!0),w("Water",1,!0)],n.player.lanes[0]=[w("Spirit",2,!0)],n.player.lanes[1]=[],n.player.lanes[2]=[],n.opponent.lanes[0]=[w("Metal",1,!0)],n.opponent.lanes[1]=[w("Death",2,!1)],n.opponent.lanes[2]=[w("Fire",3,!0)],n=qe(n),Ve(n)}},gv={name:"Love Test Playground",description:" All Love cards on hand - share the love",setup:t=>{let n=He(t,["Love","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[w("Love",1,!0),w("Love",2,!0),w("Love",3,!0),w("Love",4,!0),w("Love",5,!0),w("Love",6,!0)],n.opponent.hand=[w("Fire",2,!0),w("Death",3,!0),w("Water",1,!0),w("Metal",4,!0)],n.player.lanes[0]=[w("Spirit",2,!0)],n.player.lanes[1]=[],n.player.lanes[2]=[],n.opponent.lanes[0]=[w("Metal",1,!0)],n.opponent.lanes[1]=[w("Death",2,!1)],n.opponent.lanes[2]=[w("Fire",3,!0)],n=qe(n),Ve(n)}},vv={name:"Psychic Test Playground",description:" All Psychic cards on hand - read minds and control",setup:t=>{let n=He(t,["Psychic","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[w("Psychic",0,!0),w("Psychic",1,!0),w("Psychic",2,!0),w("Psychic",3,!0),w("Psychic",4,!0),w("Psychic",5,!0)],n.opponent.hand=[w("Fire",2,!0),w("Death",3,!0),w("Water",1,!0),w("Metal",4,!0)],n.player.lanes[0]=[w("Spirit",2,!0)],n.player.lanes[1]=[],n.player.lanes[2]=[],n.opponent.lanes[0]=[w("Metal",1,!0)],n.opponent.lanes[1]=[w("Death",2,!1)],n.opponent.lanes[2]=[w("Fire",3,!0)],n=qe(n),Ve(n)}},_v={name:" Gravity-2 AI Single Card Bug",description:"AI spielt Gravity-2  Flip  Shift  Turn endet (NUR 1 Karte!)",setup:t=>{let n=He(t,["Hate","Fire","Water"],["Gravity","Death","Metal"],"opponent","action");return n.opponent.hand=[w("Gravity",2,!0),w("Death",1,!0),w("Metal",3,!0)],n=V(n,"player",1,w("Hate",5,!0)),n=V(n,"player",1,w("Hate",4,!0)),n=V(n,"player",0,w("Fire",2,!0)),n=V(n,"player",2,w("Water",3,!0)),n=qe(n),Ve(n)}},wv={name:"Speed-3 End-Effekt Softlock Test",description:"Speed-3 als einzige uncovered Karte sollte sich selbst im End-Effekt shiften knnen",setup:t=>{let n=He(t,["Fire","Water","Death"],["Speed","Gravity","Light"],"opponent","end");return n.player.hand=[w("Fire",1,!0),w("Water",2,!0),w("Death",0,!0)],n=V(n,"player",0,w("Fire",3,!0)),n=V(n,"player",1,w("Water",1,!0)),n=V(n,"opponent",0,w("Speed",3,!0)),n.opponent.hand=[w("Gravity",1,!0),w("Light",2,!0)],n=qe(n),Ve(n)}},xv={name:"Uncover nach Delete All in Lane Test",description:"Death-2 lscht alle 1/2er  Karte darunter wird uncovered  Effekt triggert",setup:t=>{let n=He(t,["Death","Fire","Water"],["Fire","Spirit","Light"],"player","action");return n.player.hand=[w("Death",2,!0),w("Fire",3,!0),w("Water",4,!0)],n=V(n,"opponent",0,w("Fire",5,!0)),n=V(n,"opponent",0,w("Fire",2,!0)),n=V(n,"player",0,w("Fire",4,!0)),n=V(n,"player",1,w("Water",3,!0)),n=V(n,"opponent",1,w("Spirit",2,!0)),n=qe(n),Ve(n)}},Cv={name:"Mehrfach-Uncover nach Delete All Test",description:"Death-2 lscht bei beiden Spielern  beide Karten darunter werden uncovered",setup:t=>{let n=He(t,["Death","Water","Spirit"],["Fire","Light","Gravity"],"player","action");return n.player.hand=[w("Death",2,!0),w("Spirit",3,!0)],n.opponent.hand=[w("Fire",3,!0),w("Light",5,!0)],n=V(n,"player",0,w("Water",5,!0)),n=V(n,"player",0,w("Water",1,!0)),n=V(n,"opponent",0,w("Fire",5,!0)),n=V(n,"opponent",0,w("Fire",2,!0)),n=qe(n),Ve(n)}},Sv={name:"Life-1 Uncover  Double Flip Bug",description:"Death-1 Start lscht  Life-1 uncovered  BEIDE Flips mssen ausgefhrt werden",setup:t=>{let n=He(t,["Death","Fire","Water"],["Life","Metal","Spirit"],"player","start");return n.player.hand=[w("Fire",2,!0)],n.opponent.hand=[w("Metal",3,!0),w("Spirit",2,!0)],n=V(n,"player",0,w("Death",1,!0)),n=V(n,"opponent",0,w("Life",1,!0)),n=V(n,"opponent",0,w("Metal",0,!0)),n=V(n,"player",1,w("Water",1,!0)),n=V(n,"opponent",1,w("Metal",1,!0)),n=V(n,"opponent",2,w("Spirit",0,!0)),n=qe(n),Ve(n)}},bv={name:"Smoke Test Playground",description:" All Smoke cards on hand - shroud your cards in mystery",setup:t=>{let n=He(t,["Smoke","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[w("Smoke",0,!0),w("Smoke",1,!0),w("Smoke",2,!0),w("Smoke",3,!0),w("Smoke",4,!0),w("Smoke",5,!0)],n=V(n,"player",0,w("Water",2,!1)),n=V(n,"opponent",1,w("Metal",3,!1)),n=V(n,"opponent",1,w("Death",2,!0)),n=V(n,"opponent",2,w("Fire",2,!0)),n=V(n,"player",2,w("Spirit",3,!0)),n=V(n,"player",1,w("Spirit",4,!0)),n=qe(n),Ve(n)}},Ev={name:"Smoke AI Test",description:" AI spielt Smoke Karten - test all Smoke card effects with AI",setup:t=>{let n=He(t,["Water","Spirit","Light"],["Smoke","Metal","Death"],"opponent","action");return n.opponent.hand=[w("Smoke",0,!0),w("Smoke",1,!0),w("Smoke",2,!0),w("Smoke",3,!0),w("Smoke",4,!0),w("Smoke",5,!0)],n=V(n,"opponent",0,w("Metal",2,!1)),n=V(n,"player",0,w("Water",3,!0)),n=V(n,"player",1,w("Spirit",2,!1)),n=V(n,"player",1,w("Spirit",4,!0)),n=V(n,"opponent",2,w("Death",3,!0)),n=V(n,"player",2,w("Light",2,!0)),n=V(n,"opponent",1,w("Metal",4,!0)),n=qe(n),Ve(n)}},jv={name:"Clarity Test Playground",description:"All Clarity cards on hand - see through the fog of war",setup:t=>{let n=He(t,["Clarity","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[w("Clarity",0,!0),w("Clarity",1,!0),w("Clarity",2,!0),w("Clarity",3,!0),w("Clarity",4,!0),w("Clarity",5,!0)],n.player.deck=[w("Clarity",1,!0),w("Water",1,!0),w("Spirit",5,!0),w("Spirit",3,!0),w("Water",2,!0),w("Fire",4,!0)],n.player.discard=[w("Water",4,!0),w("Spirit",1,!0)],n=V(n,"player",0,w("Water",2,!0)),n.opponent.hand=[w("Metal",3,!0),w("Death",2,!0),w("Fire",4,!0)],n=V(n,"opponent",1,w("Metal",3,!0)),n=V(n,"opponent",2,w("Fire",2,!0)),n=qe(n),Ve(n)}},kv={name:"Clarity AI Test",description:"AI spielt Clarity Karten - test all Clarity card effects with AI",setup:t=>{let n=He(t,["Water","Spirit","Light"],["Clarity","Metal","Death"],"opponent","action");return n.opponent.hand=[w("Clarity",0,!0),w("Clarity",1,!0),w("Clarity",2,!0),w("Clarity",3,!0),w("Clarity",4,!0),w("Clarity",5,!0)],n.opponent.deck=[w("Clarity",1,!0),w("Metal",1,!0),w("Death",5,!0),w("Death",3,!0),w("Metal",2,!0)],n.opponent.discard=[w("Metal",4,!0),w("Death",2,!0)],n.player.hand=[w("Water",3,!0),w("Spirit",2,!0),w("Light",4,!0)],n=V(n,"player",0,w("Water",3,!0)),n=V(n,"opponent",0,w("Metal",2,!0)),n=V(n,"player",1,w("Spirit",4,!0)),n=V(n,"opponent",2,w("Death",3,!0)),n=qe(n),Ve(n)}},Rv={name:"Courage Custom Playground",description:"Test all Courage effects: empty hand draw, opponent higher value delete, conditional draw/flip, highest value shift",setup:t=>{let s=He(t,["Courage","Fire","Speed"],["Spirit","Water","Darkness"],"player","action");return s.player.hand=[w("Courage",0,!0),w("Courage",1,!0),w("Courage",2,!0),w("Courage",3,!0),w("Courage",5,!0),w("Courage",6,!0)],s=V(s,"opponent",0,w("Spirit",3,!0)),s=V(s,"opponent",0,w("Spirit",5,!0)),s=V(s,"player",0,w("Fire",3,!0)),s=V(s,"opponent",1,w("Water",6,!0)),s=V(s,"player",1,w("Speed",4,!0)),s=V(s,"opponent",2,w("Darkness",2,!0)),s=V(s,"player",2,w("Fire",5,!0)),Ve(s)}},Nv={name:"Courage AI Test",description:"Test AI with Courage protocol: lane-restricted delete, self-shift to highest value lane",setup:t=>{let s=He(t,["Spirit","Water","Fire"],["Courage","Speed","Darkness"],"opponent","action");return s.opponent.hand=[w("Courage",0,!0),w("Courage",1,!0),w("Courage",2,!0),w("Courage",3,!0),w("Courage",5,!0),w("Courage",6,!0)],s=V(s,"player",0,w("Spirit",5,!0)),s=V(s,"player",0,w("Spirit",5,!0)),s=V(s,"opponent",0,w("Speed",3,!0)),s=V(s,"player",1,w("Water",6,!0)),s=V(s,"opponent",1,w("Darkness",2,!0)),s=V(s,"opponent",1,w("Darkness",2,!1)),s=V(s,"player",2,w("Fire",3,!0)),s=V(s,"opponent",2,w("Speed",5,!0)),Ve(s)}},Tv={name:"Corruption Test Playground",description:" All Corruption cards on hand - corrupt your opponent's plans",setup:t=>{let n=He(t,["Corruption","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[w("Corruption",0,!0),w("Corruption",1,!0),w("Corruption",2,!0),w("Corruption",3,!0),w("Corruption",5,!0),w("Corruption",6,!0)],n=V(n,"player",0,w("Water",2,!0)),n=V(n,"opponent",0,w("Metal",3,!0)),n=V(n,"opponent",1,w("Death",4,!0)),n=V(n,"opponent",2,w("Fire",2,!0)),n=V(n,"player",1,w("Spirit",3,!0)),n=V(n,"player",1,w("Spirit",5,!0)),n.opponent.hand=[w("Fire",3,!0),w("Metal",4,!0),w("Death",5,!0)],n=qe(n),Ve(n)}},Dv={name:"Fear Custom Playground",description:"Test all Fear effects: passive ignore middle, choice shift/flip, chain discard, return, random discard",setup:t=>{let s=He(t,["Fear","Fire","Speed"],["Spirit","Water","Darkness"],"player","action");return s.player.hand=[w("Fear",0,!0),w("Fear",1,!0),w("Fear",2,!0),w("Fear",3,!0),w("Fear",4,!0),w("Fear",5,!0)],s=V(s,"opponent",0,w("Spirit",2,!0)),s=V(s,"opponent",0,w("Spirit",3,!0)),s=V(s,"player",0,w("Fire",3,!0)),s=V(s,"opponent",1,w("Water",4,!0)),s=V(s,"player",1,w("Speed",4,!0)),s=V(s,"opponent",2,w("Darkness",2,!1)),s=V(s,"player",2,w("Fire",5,!0)),s.opponent.hand=[w("Spirit",1,!0),w("Water",2,!0),w("Darkness",3,!0),w("Spirit",4,!0)],Ve(s)}},Av={name:"Fear AI Test",description:"Test AI with Fear protocol: random discard execution, passive rule handling",setup:t=>{let s=He(t,["Spirit","Water","Fire"],["Fear","Speed","Darkness"],"opponent","action");return s.opponent.hand=[w("Fear",0,!0),w("Fear",1,!0),w("Fear",2,!0),w("Fear",3,!0),w("Fear",4,!0),w("Fear",5,!0)],s=V(s,"player",0,w("Spirit",3,!0)),s=V(s,"player",0,w("Spirit",5,!0)),s=V(s,"opponent",0,w("Speed",3,!0)),s=V(s,"player",1,w("Water",2,!0)),s=V(s,"player",1,w("Water",4,!0)),s=V(s,"player",2,w("Fire",3,!0)),s=V(s,"opponent",2,w("Darkness",5,!0)),s.player.hand=[w("Spirit",1,!0),w("Water",3,!0),w("Fire",4,!0)],Ve(s)}},Fv={name:"Ice Custom Playground",description:" Test all Ice effects: conditional shift, flip block, draw block, lane-reactive discard",setup:t=>{let s=He(t,["Ice","Fire","Speed"],["Spirit","Water","Darkness"],"player","action");return s.player.hand=[w("Ice",1,!0),w("Ice",2,!0),w("Ice",3,!0),w("Ice",4,!0),w("Ice",5,!0),w("Ice",6,!0),w("Fire",0,!0)],s=V(s,"player",0,w("Fire",3,!0)),s=V(s,"player",0,w("Fire",5,!0)),s=V(s,"opponent",1,w("Water",4,!0)),s=V(s,"player",1,w("Speed",4,!0)),s=V(s,"opponent",2,w("Darkness",2,!0)),s=V(s,"player",2,w("Fire",5,!0)),s.opponent.hand=[w("Spirit",1,!0),w("Water",2,!0),w("Darkness",3,!0)],Ve(s)}},Iv={name:"Ice AI Test",description:" Test AI with Ice protocol: shift self, shift others, passive rules",setup:t=>{let s=He(t,["Spirit","Water","Fire"],["Ice","Speed","Darkness"],"opponent","action");return s.opponent.hand=[w("Ice",1,!0),w("Ice",2,!0),w("Ice",3,!0),w("Ice",4,!0),w("Ice",5,!0),w("Ice",6,!0)],s=V(s,"player",0,w("Spirit",3,!0)),s=V(s,"player",0,w("Spirit",5,!0)),s=V(s,"opponent",0,w("Speed",3,!0)),s=V(s,"opponent",1,w("Darkness",2,!0)),s=V(s,"opponent",1,w("Darkness",4,!0)),s=V(s,"player",1,w("Water",4,!0)),s=V(s,"player",2,w("Fire",3,!0)),s=V(s,"opponent",2,w("Speed",5,!0)),s.player.hand=[w("Spirit",1,!0),w("Water",3,!0),w("Fire",4,!0)],Ve(s)}},$v={name:"End Phase Test",description:"Test the game rule for the end or start phase, only 1 trigger",setup:t=>{let s=He(t,["Light","Fire","Speed"],["Spirit","Water","Darkness"],"player","action");return s.player.hand=[w("Light",5,!0),w("Fire",0,!0)],s=V(s,"player",0,w("Light",1,!0)),s=V(s,"player",0,w("Light",2,!0)),s=V(s,"player",1,w("Fire",3,!0)),s=V(s,"player",2,w("Speed",3,!0)),s.opponent.hand=[w("Spirit",1,!0),w("Water",2,!0),w("Darkness",3,!0)],Ve(s)}},Pv={name:"Start Phase Test",description:"Test the game rule for the end or start phase, only 1 trigger",setup:t=>{let s=He(t,["Spirit","Death","Psychic"],["Light","Water","Darkness"],"player","action");return s.player.hand=[w("Spirit",5,!0),w("Death",0,!0)],s=V(s,"player",0,w("Spirit",1,!0)),s=V(s,"player",0,w("Spirit",2,!0)),s=V(s,"player",1,w("Death",1,!0)),s=V(s,"player",1,w("Spirit",3,!0)),s=V(s,"player",2,w("Psychic",1,!0)),s.opponent.hand=[w("Light",1,!0),w("Water",2,!0),w("Darkness",3,!0)],Ve(s)}},qv={name:"Committed Card Test",description:"Committed Card Test",setup:t=>{let s=He(t,["Spirit","Darkness","Psychic"],["Light","Water","Fire"],"player","action");return s.player.hand=[w("Darkness",0,!0),w("Death",0,!0)],s=V(s,"player",0,w("Spirit",0,!0)),s=V(s,"player",0,w("Spirit",3,!0)),s=V(s,"opponent",0,w("Light",1,!0)),s=V(s,"opponent",0,w("Light",2,!0)),s.opponent.hand=[w("Light",5,!0),w("Water",2,!0),w("Darkness",3,!0)],Ve(s)}},Lv={name:"Fear 0 prob Test",description:"Bla bla",setup:t=>{let s=He(t,["Chaos","Fear","Psychic"],["Light","Water","Fire"],"player","action");return s.player.hand=[w("Chaos",2,!0),w("Fear",3,!0)],s=V(s,"player",1,w("Fear",2,!0)),s=V(s,"player",1,w("Fear",0,!0)),s=V(s,"opponent",1,w("Water",5,!0)),s=V(s,"opponent",2,w("Darkness",2,!1)),s.opponent.hand=[w("Light",5,!0),w("Water",2,!0),w("Darkness",3,!0)],Ve(s)}},Uv={name:"MultiChain Test",description:"Multi Chain test",setup:t=>{let s=He(t,["Chaos","Smoke","Test"],["Light","Water","Fire"],"player","action");return s.player.hand=[w("Smoke",1,!0),w("Chaos",3,!0)],s=V(s,"player",2,w("Test",1,!1)),s=V(s,"opponent",1,w("Water",5,!0)),s=V(s,"opponent",2,w("Darkness",2,!1)),s.opponent.hand=[w("Light",5,!0),w("Water",2,!0),w("Darkness",3,!0)],Ve(s)}},Ov={name:"Light3-Uncover Test",description:"Light3-Uncover_actionType Test",setup:t=>{let s=He(t,["Chaos","Smoke","Test"],["Light","Water","Fire"],"player","action");return s.player.hand=[w("Smoke",1,!0),w("Chaos",3,!0)],s=V(s,"player",0,w("Chaos",3,!0)),s=V(s,"player",0,w("Chaos",2,!0)),s=V(s,"player",0,w("Test",1,!1)),s.opponent.hand=[w("Light",3,!0)],Ve(s)}},Mv={name:"Luck Test Playground",description:" All Luck cards on hand - gamble with fate!",setup:t=>{let n=He(t,["Luck","Fire","Water"],["Death","Life","Gravity"],"player","action");return n.player.hand=[w("Luck",0,!0),w("Luck",1,!0),w("Luck",2,!0),w("Luck",3,!0),w("Luck",4,!0),w("Luck",5,!0)],n=V(n,"opponent",0,w("Death",3,!0)),n=V(n,"opponent",0,w("Death",2,!1)),n=V(n,"opponent",1,w("Life",2,!0)),n=V(n,"player",1,w("Fire",3,!0)),n=V(n,"opponent",2,w("Gravity",4,!0)),n=V(n,"player",2,w("Water",3,!0)),n=qe(n),Ve(n)}},Hv={name:"Luck AI Test",description:" AI spielt Luck Karten - test all Luck card effects with AI",setup:t=>{let n=He(t,["Fire","Water","Spirit"],["Luck","Death","Life"],"opponent","action");return n.opponent.hand=[w("Luck",0,!0),w("Luck",1,!0),w("Luck",2,!0),w("Luck",3,!0),w("Luck",4,!0),w("Luck",5,!0)],n=V(n,"player",0,w("Fire",3,!0)),n=V(n,"opponent",0,w("Death",2,!0)),n=V(n,"player",1,w("Water",2,!0)),n=V(n,"player",1,w("Water",4,!1)),n=V(n,"player",2,w("Spirit",3,!0)),n=V(n,"opponent",2,w("Life",4,!0)),n=qe(n),Ve(n)}},Vv={name:"Mirror Test Playground",description:" All Mirror cards on hand - copy, reflect, and swap",setup:t=>{let n=He(t,["Mirror","Fire","Water"],["Death","Metal","Spirit"],"player","action");return n.player.hand=[w("Mirror",0,!0),w("Mirror",1,!0),w("Mirror",2,!0),w("Mirror",3,!0),w("Mirror",4,!0),w("Mirror",5,!0)],n=V(n,"player",0,w("Fire",3,!0)),n=V(n,"player",0,w("Fire",2,!1)),n=V(n,"player",1,w("Water",4,!0)),n=V(n,"player",2,w("Water",1,!0)),n=V(n,"opponent",0,w("Death",3,!0)),n=V(n,"opponent",0,w("Death",2,!1)),n=V(n,"opponent",1,w("Courage",2,!0)),n=V(n,"opponent",2,w("Spirit",2,!0)),n.opponent.hand=[w("Metal",1,!0),w("Spirit",3,!0),w("Death",4,!0)],n=qe(n),Ve(n)}},zv={name:"Mirror AI Test",description:" AI spielt Mirror Karten - test all Mirror card effects with AI",setup:t=>{let n=He(t,["Fire","Water","Spirit"],["Mirror","Death","Metal"],"opponent","action");return n.opponent.hand=[w("Mirror",0,!0),w("Mirror",1,!0),w("Mirror",2,!0),w("Mirror",3,!0),w("Mirror",4,!0),w("Mirror",5,!0)],n=V(n,"opponent",0,w("Death",3,!0)),n=V(n,"opponent",0,w("Death",2,!1)),n=V(n,"opponent",1,w("Metal",4,!0)),n=V(n,"opponent",2,w("Metal",1,!0)),n=V(n,"player",0,w("Fire",3,!0)),n=V(n,"player",0,w("Fire",2,!1)),n=V(n,"player",1,w("Water",4,!0)),n=V(n,"player",2,w("Spirit",2,!0)),n.player.hand=[w("Fire",1,!0),w("Water",3,!0),w("Spirit",4,!0)],n=qe(n),Ve(n)}},Bv={name:"Peace Test Playground",description:" All Peace cards on hand - harmony, balance, sacrifice",setup:t=>{let n=He(t,["Peace","Fire","Water"],["Death","Metal","Spirit"],"player","action");return n.player.hand=[w("Peace",1,!0),w("Peace",2,!0),w("Peace",3,!0),w("Peace",4,!0),w("Peace",5,!0),w("Peace",6,!0)],n=V(n,"player",0,w("Fire",3,!0)),n=V(n,"player",1,w("Water",4,!0)),n=V(n,"player",2,w("Water",5,!0)),n=V(n,"opponent",0,w("Death",5,!1)),n=V(n,"opponent",1,w("Metal",6,!0)),n=V(n,"opponent",2,w("Spirit",4,!0)),n.opponent.hand=[w("Metal",1,!0),w("Spirit",4,!0),w("Death",0,!0)],n=qe(n),Ve(n)}},Gv={name:"Peace AI Test",description:" AI spielt Peace Karten - test all Peace card effects with AI",setup:t=>{let n=He(t,["Fire","Water","Spirit"],["Peace","Death","Life"],"opponent","action");return n.opponent.hand=[w("Peace",1,!0),w("Peace",2,!0),w("Peace",3,!0),w("Peace",4,!0),w("Peace",5,!0),w("Peace",6,!0)],n=V(n,"player",0,w("Fire",3,!0)),n=V(n,"player",1,w("Water",4,!0)),n=V(n,"player",2,w("Spirit",5,!0)),n=V(n,"opponent",0,w("Death",2,!0)),n=V(n,"opponent",1,w("Life",3,!0)),n.player.hand=[w("Fire",1,!0),w("Water",3,!0),w("Spirit",4,!0)],n=qe(n),Ve(n)}},Wv={name:"Peace-4 Reactive Test",description:" Test Peace-4: AI spielt Plague  du discardest  Peace-4 triggert  du ziehst",setup:t=>{let n=He(t,["Peace","Fire","Water"],["Plague","Death","Life"],"opponent","action");return n=V(n,"player",0,w("Peace",4,!0)),n=V(n,"player",1,w("Fire",3,!0)),n=V(n,"player",2,w("Water",2,!0)),n.opponent.hand=[w("Plague",0,!0),w("Plague",1,!0)],n=V(n,"opponent",0,w("Death",5,!0)),n.player.hand=[w("Fire",1,!0),w("Water",3,!0),w("Peace",2,!0)],n=qe(n),Ve(n)}},Yv={name:"War Custom Protocol Playground",description:"Player has War protocol with cards on board for testing reactive triggers",setup:t=>{let n=He(t,["War","Fire","Water"],["Plague","Death","Spirit"],"player","action");return n.player.hand=[w("War",1,!0),w("War",2,!0),w("War",3,!0),w("War",4,!0),w("War",5,!0)],n=V(n,"player",2,w("War",0,!0)),n=V(n,"opponent",0,w("Fire",1,!0)),n=V(n,"opponent",1,w("Spirit",5,!0)),n=V(n,"opponent",1,w("Death",5,!0)),n.opponent.hand=[w("Death",1,!0),w("Spirit",2,!0),w("Plague",1,!0)],n=qe(n),Ve(n)}},Qv={name:"War AI Test",description:"AI plays with War protocol - tests reactive trigger handling",setup:t=>{let n=He(t,["Fire","Water","Death"],["War","Plague","Spirit"],"player","action");return n=V(n,"opponent",0,w("War",0,!0)),n=V(n,"opponent",1,w("War",1,!0)),n=V(n,"opponent",2,w("War",2,!0)),n=V(n,"player",0,w("Fire",1,!0)),n=V(n,"player",1,w("Water",2,!0)),n=V(n,"player",2,w("Death",1,!0)),n.player.hand=[w("Fire",2,!0),w("Water",3,!0),w("Death",2,!0)],n.opponent.hand=[w("Spirit",1,!0),w("Plague",2,!0)],n=qe(n),Ve(n)}},Xv={name:"Time Test Playground",description:" All Time cards on hand - manipulate trash and deck",setup:t=>{const n=["Time","Clarity","Life"],r=["Fire","Water","Death"];let s=He(t,n,r,"player","action");const c=[w("Time",0),w("Time",1),w("Time",2),w("Time",3),w("Time",4),w("Time",5)],d=[w("Life",3),w("Clarity",2),w("Life",1)];s={...s,player:{...s.player,hand:c,discard:d}},s=V(s,"player",0,w("Clarity",0,!0)),s=V(s,"player",0,w("Life",0,!1)),s=V(s,"opponent",1,w("Fire",2,!1));const u=[...c,...d,...s.player.lanes.flat(),...s.opponent.lanes.flat()];return s.player.deck=sn(n,u),s.opponent.deck=sn(r,[]),s=qe(s),Ve(s)}},Zv={name:"Time AI Test",description:" AI plays Time cards - test trash selection and shuffle triggers",setup:t=>{const n=["Fire","Water","Death"],r=["Time","Clarity","Life"];let s=He(t,n,r,"opponent","action");const c=[w("Fire",2),w("Water",3)],d=[w("Time",0),w("Time",1),w("Time",2),w("Time",3),w("Time",4),w("Time",5)],u=[w("Life",4),w("Clarity",3)];s={...s,player:{...s.player,hand:c},opponent:{...s.opponent,hand:d,discard:u}},s=V(s,"player",0,w("Fire",1,!0)),s=V(s,"player",0,w("Water",0,!1)),s=V(s,"opponent",1,w("Clarity",1,!0));const p=[...c,...d,...u,...s.player.lanes.flat(),...s.opponent.lanes.flat()];return s.player.deck=sn(n,p),s.opponent.deck=sn(r,p),s=qe(s),Ve(s)}},Kv={name:"Assimilation Test Playground",description:"All Assimilation cards on hand - steal, draw from opponent, play to opponent's board",setup:t=>{const n=["Assimilation","Clarity","Life"],r=["Fire","Water","Death"];let s=He(t,n,r,"player","action");const c=[w("Assimilation",0),w("Assimilation",1),w("Assimilation",2),w("Assimilation",4),w("Assimilation",5),w("Assimilation",6)];s={...s,player:{...s.player,hand:c}},s=V(s,"opponent",0,w("Fire",3,!1)),s=V(s,"opponent",0,w("Fire",2,!1)),s=V(s,"opponent",1,w("Water",4,!0)),s=V(s,"opponent",2,w("Death",1,!1)),s=V(s,"player",0,w("Clarity",0,!0)),s=V(s,"player",1,w("Life",1,!0));const d=[...c,...s.player.lanes.flat(),...s.opponent.lanes.flat()];return s.player.deck=sn(n,d),s.opponent.deck=sn(r,[]),s=qe(s),Ve(s)}},Jv={name:"Assimilation AI Test",description:"AI plays Assimilation cards - test steal and play to opponent's board",setup:t=>{const n=["Fire","Water","Death"],r=["Assimilation","Clarity","Life"];let s=He(t,n,r,"opponent","action");const c=[w("Fire",2),w("Water",3)],d=[w("Assimilation",0),w("Assimilation",1),w("Assimilation",2),w("Assimilation",4),w("Assimilation",5),w("Assimilation",6)];s={...s,player:{...s.player,hand:c},opponent:{...s.opponent,hand:d}},s=V(s,"player",0,w("Fire",5,!1)),s=V(s,"player",1,w("Water",4,!0)),s=V(s,"player",2,w("Death",2,!1)),s=V(s,"opponent",0,w("Clarity",1,!0));const u=[...c,...d,...s.player.lanes.flat(),...s.opponent.lanes.flat()];return s.player.deck=sn(n,u),s.opponent.deck=sn(r,[]),s=qe(s),Ve(s)}},e_={name:"Diversity Test Playground",description:"All Diversity cards on hand - test auto-compile, value modifiers, and protocol-count effects",setup:t=>{const n=["Diversity","Fire","Water"],r=["Death","Life","Light"];let s=He(t,n,r,"player","action");const c=[w("Diversity",0),w("Diversity",1),w("Diversity",3),w("Diversity",4),w("Diversity",5),w("Diversity",6)];s={...s,player:{...s.player,hand:c}},s=V(s,"player",0,w("Fire",2,!0)),s=V(s,"player",1,w("Water",3,!0)),s=V(s,"opponent",0,w("Death",4,!0)),s=V(s,"opponent",1,w("Life",2,!0)),s=V(s,"opponent",2,w("Light",1,!0));const d=[...c,...s.player.lanes.flat(),...s.opponent.lanes.flat()];return s.player.deck=sn(n,d),s.opponent.deck=sn(r,[]),s=qe(s),Ve(s)}},t_={name:"Diversity AI Test",description:"AI plays Diversity cards - test auto-compile and conditional effects",setup:t=>{const n=["Fire","Water","Death"],r=["Diversity","Life","Light"];let s=He(t,n,r,"opponent","action");const c=[w("Fire",2),w("Water",3)],d=[w("Diversity",0),w("Diversity",1),w("Diversity",3),w("Diversity",4),w("Diversity",5),w("Diversity",6)];s={...s,player:{...s.player,hand:c},opponent:{...s.opponent,hand:d}},s=V(s,"player",0,w("Fire",4,!0)),s=V(s,"player",1,w("Water",2,!0)),s=V(s,"player",2,w("Death",1,!0)),s=V(s,"opponent",0,w("Life",3,!0)),s=V(s,"opponent",1,w("Light",2,!0));const u=[...c,...d,...s.player.lanes.flat(),...s.opponent.lanes.flat()];return s.player.deck=sn(n,u),s.opponent.deck=sn(r,[]),s=qe(s),Ve(s)}},n_={name:"Unity Custom Playground (Player)",description:"Test Unity synergy effects - cards become stronger with more face-up Unity on field",setup:t=>{const n=["Unity","Fire","Water"],r=["Death","Spirit","Light"];let s=He(t,n,r,"player","action");const c=[w("Unity",0,!0),w("Unity",1,!0),w("Unity",2,!0),w("Unity",3,!0),w("Unity",4,!0),w("Unity",5,!0)];s.player.hand=c;const d=[w("Death",1,!0),w("Spirit",2,!0),w("Light",3,!0)];s.opponent.hand=d,s=V(s,"player",0,w("Fire",2,!0)),s=V(s,"opponent",0,w("Death",3,!0));const u=[...c,...d,...s.player.lanes.flat(),...s.opponent.lanes.flat()];return s.player.deck=sn(n,u),s.opponent.deck=sn(r,[]),s=qe(s),Ve(s)}},a_={name:"Unity AI Test (Opponent)",description:"Test AI handling of Unity synergy effects",setup:t=>{const n=["Fire","Water","Spirit"],r=["Unity","Death","Light"];let s=He(t,n,r,"opponent","action");const c=[w("Fire",1,!0),w("Water",2,!0),w("Spirit",3,!0)];s.player.hand=c;const d=[w("Unity",0,!0),w("Unity",2,!0),w("Unity",3,!0),w("Unity",5,!0)];s.opponent.hand=d,s=V(s,"opponent",0,w("Unity",1,!0)),s=V(s,"player",1,w("Fire",4,!0));const u=[...c,...d,...s.player.lanes.flat(),...s.opponent.lanes.flat()];return s.player.deck=sn(n,u),s.opponent.deck=sn(r,[]),s=qe(s),Ve(s)}},o_={name:"Speed-3 End Test (Opponent)",description:"Speed-3 End Test",setup:t=>{const n=["Fire","Water","Spirit"],r=["Speed","Death","Light"];let s=He(t,n,r,"opponent","end");const c=[w("Fire",1,!0),w("Water",2,!0),w("Spirit",3,!0)];s.player.hand=c;const d=[w("Speed",0,!0),w("Speed",1,!0),w("Speed",2,!0),w("Speed",5,!0)];s.opponent.hand=d,s=V(s,"opponent",0,w("Speed",3,!0)),s=V(s,"opponent",1,w("Death",5,!0)),s=V(s,"opponent",2,w("Light",5,!0)),s=V(s,"player",1,w("Fire",4,!0));const u=[...c,...d,...s.player.lanes.flat(),...s.opponent.lanes.flat()];return s.player.deck=sn(n,u),s.opponent.deck=sn(r,[]),s=qe(s),Ve(s)}},r_=[Dg,Ag,Fg,Ig,$g,Pg,qg,Lg,Ug,Og,Mg,Hg,Vg,zg,Bg,Gg,Wg,Yg,Qg,Xg,Zg,Nk,Tk,Dk,Ak,Fk,Ik,Kg,Jg,ev,tv,nv,av,ov,rv,lv,sv,cv,iv,dv,uv,pv,fv,hv,mv,yv,gv,vv,_v,wv,xv,Cv,Sv,bv,Ev,jv,kv,Tv,Rv,Nv,Dv,Av,Fv,Iv,$v,Pv,qv,Lv,Uv,Ov,Mv,Hv,Vv,zv,Bv,Gv,Wv,Yv,Qv,Xv,Zv,Kv,Jv,e_,t_,n_,a_,o_],Ru=Object.freeze(Object.defineProperty({__proto__:null,allScenarios:r_,scenario10_Hate1Interrupt:Lg,scenario11_Darkness1HateChain:Ug,scenario12_Water4TurnEnd:Og,scenario13_Psychic3ShiftTest:Mg,scenario14_Death1UncoverTest:Hg,scenario15_Gravity2ShiftInterrupt:Vg,scenario16_Hate2PlayerPlays:zg,scenario171_Hate2AIPlays:Gg,scenario17_Hate2AIPlays:Bg,scenario18_Hate2SelfDelete:Wg,scenario19_Hate2MultipleTies:Yg,scenario1_Psychic3Uncover:Dg,scenario20_Hate2FaceDown:Qg,scenario21_Hate2AIValidation:Xg,scenario22_Hate2AIPlaysOpen:Zg,scenario29_FireCustomConditional:Kg,scenario2_Psychic4EndEffect:Ag,scenario30_AnarchyCustomPlayground:Jg,scenario31_DarkCustPlayground:ev,scenario32_ApathyCustomPlayground:tv,scenario33_DeathCustomPlayground:nv,scenario34_WaterCustomPlayground:av,scenario35_SpiritCustomPlayground:ov,scenario36_ChaosCustomPlayground:rv,scenario37_GravityCustomPlayground:lv,scenario38_FrostCustomPlayground:sv,scenario39_HateCustomPlayground:cv,scenario3_Spirit3EndPhase:Fg,scenario40_LifeCustomPlayground:iv,scenario41_LightCustomPlayground:dv,scenario42_Death2UncoverInterruptTurn:uv,scenario43_Apathy5DoubleUncover:pv,scenario44_Psychic1Darkness2Test:fv,scenario45_SpeedCustomPlayground:hv,scenario46_MetalCustomPlayground:mv,scenario47_PlagueCustomPlayground:yv,scenario48_LoveCustomPlayground:gv,scenario49_PsychicCustomPlayground:vv,scenario4_Plague2Actor:Ig,scenario50_Gravity2SingleCardBug:_v,scenario51_Speed3EndEffectSoftlock:wv,scenario52_UncoverAfterBulkDelete:xv,scenario53_MultiUncoverAfterBulkDelete:Cv,scenario54_Life1UncoverDoubleFlip:Sv,scenario55_SmokeCustomPlayground:bv,scenario56_SmokeAITest:Ev,scenario57_ClarityCustomPlayground:jv,scenario58_ClarityAITest:kv,scenario59_CorruptionCustomPlayground:Tv,scenario5_Darkness1Interrupt:$g,scenario60_CourageCustomPlayground:Rv,scenario61_CourageAITest:Nv,scenario62_FearCustomPlayground:Dv,scenario63_FearAITest:Av,scenario64_IceCustomPlayground:Fv,scenario65_IceAITest:Iv,scenario66_endPhasePlayground:$v,scenario67_startPhasePlayground:Pv,scenario68_CommittedCardPlayground:qv,scenario69_fear0shiftCardPlayground:Lv,scenario70_multiChainCardPlayground:Uv,scenario71_Light3ProblemPlayground:Ov,scenario72_LuckCustomPlayground:Mv,scenario73_LuckAITest:Hv,scenario74_MirrorCustomPlayground:Vv,scenario75_MirrorAITest:zv,scenario76_PeaceCustomPlayground:Bv,scenario77_PeaceAITest:Gv,scenario78_Peace4ReactiveTest:Wv,scenario79_WarCustomPlayground:Yv,scenario80_WarAITest:Qv,scenario81_TimeCustomPlayground:Xv,scenario82_TimeAITest:Zv,scenario83_AssimilationCustomPlayground:Kv,scenario84_AssimilationAITest:Jv,scenario85_DiversityCustomPlayground:e_,scenario86_DiversityAITest:t_,scenario87_UnityCustomPlayground:n_,scenario88_UnityAITest:a_,scenario89_Speed3Test:o_,scenario8_Plague4Owner:Pg,scenario9_Water:qg},Symbol.toStringTag,{value:"Module"})),$k=({onLoadScenario:t,onSkipCoinFlip:n,onForceWin:r,onForceLose:s})=>{const[c,d]=J.useState(!1);return c?o.jsxs("div",{style:{position:"fixed",top:"20px",left:"20px",width:"400px",maxHeight:"600px",backgroundColor:"#2c2c2c",border:"2px solid #ff6b6b",borderRadius:"8px",padding:"20px",zIndex:9999,overflowY:"auto",color:"white",fontFamily:"monospace"},children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"20px"},children:[o.jsx("h3",{style:{margin:0},children:" Debug Panel"}),o.jsx("button",{onClick:()=>d(!1),style:{backgroundColor:"transparent",border:"none",color:"white",cursor:"pointer",fontSize:"20px"},children:""})]}),o.jsx("div",{style:{marginBottom:"15px",fontSize:"12px",color:"#aaa"},children:"Lade vordefinierte Test-Szenarien zum Testen der Actor/Owner-Fixes."}),o.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:r_.map((u,p)=>o.jsxs("div",{style:{backgroundColor:"#1a1a1a",padding:"12px",borderRadius:"5px",border:"1px solid #444"},children:[o.jsx("div",{style:{fontWeight:"bold",marginBottom:"5px",color:"#4ecdc4"},children:u.name}),o.jsx("div",{style:{fontSize:"11px",color:"#bbb",marginBottom:"10px"},children:u.description}),o.jsx("button",{onClick:()=>{n&&n(),t(u.setup),d(!1)},style:{padding:"6px 12px",backgroundColor:"#4ecdc4",color:"#1a1a1a",border:"none",borderRadius:"3px",cursor:"pointer",fontWeight:"bold",fontSize:"12px"},children:"Load Scenario"})]},p))}),(r||s)&&o.jsxs("div",{style:{marginTop:"20px",paddingTop:"15px",borderTop:"1px solid #444",display:"flex",gap:"10px",justifyContent:"center"},children:[r&&o.jsx("button",{onClick:()=>{r(),d(!1)},style:{padding:"10px 20px",backgroundColor:"#4ecdc4",color:"#1a1a1a",border:"none",borderRadius:"5px",cursor:"pointer",fontWeight:"bold",fontSize:"14px"},children:" Force Win"}),s&&o.jsx("button",{onClick:()=>{s(),d(!1)},style:{padding:"10px 20px",backgroundColor:"#ff6b6b",color:"white",border:"none",borderRadius:"5px",cursor:"pointer",fontWeight:"bold",fontSize:"14px"},children:" Force Lose"})]}),o.jsx("div",{style:{marginTop:"20px",fontSize:"11px",color:"#666",textAlign:"center"},children:"Drcke ESC oder klicke  zum Schlieen"})]}):o.jsx("button",{onClick:()=>d(!0),style:{position:"fixed",top:"20px",left:"20px",padding:"10px 20px",backgroundColor:"#ff6b6b",color:"white",border:"none",borderRadius:"5px",cursor:"pointer",fontWeight:"bold",zIndex:9999,fontSize:"14px"},children:" DEBUG"})},Pk=500,qk=100,gu=({animation:t,startDelay:n=0,onComplete:r})=>{const s=J.useRef(null),[c,d]=J.useState("waiting"),[u,p]=J.useState({start:null,end:null}),f=J.useRef(!1),h=t.animatingCard;if(!h)return null;const{card:y,fromPosition:m,toPosition:g,flipDirection:v,targetRotation:C}=h,b=m.owner==="opponent",j=(h.isOpponentAction??!1)&&t.type!=="flip"&&t.type!=="draw",E=b,k=t.duration||ia[t.type]||400,R=ix[t.type]||"ease-in-out";J.useLayoutEffect(()=>{const G=setTimeout(()=>{const W=ry(m),P=ry(g);p({start:W,end:P}),d("idle")},qk);return()=>clearTimeout(G)},[m,g]),J.useEffect(()=>{if(c!=="idle")return;const G=h.startDelay||0,W=n+G,P=setTimeout(()=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{d(j?"highlight":"flying")})})},W);return()=>clearTimeout(P)},[c,n,j,h.startDelay]);const D=J.useRef(r);D.current=r,J.useEffect(()=>{if(c==="highlight"){const G=setTimeout(()=>{d("flying")},Pk);return()=>clearTimeout(G)}if(c==="flying"){const G=setTimeout(()=>{var W;d("complete"),f.current||(f.current=!0,(W=D.current)==null||W.call(D))},k);return()=>clearTimeout(G)}},[c,k]);const L=J.useMemo(()=>u.start?{left:u.start.left,top:u.start.top,width:u.start.width,height:u.start.height}:ly(m),[m,u.start]),I=J.useMemo(()=>u.end?{left:u.end.left,top:u.end.top,width:u.end.width,height:u.end.height}:ly(g),[g,u.end]),F=J.useMemo(()=>{const G=E?180:0,W=G+(C||0),P={position:"fixed",zIndex:2e3,pointerEvents:"none",overflow:"hidden"};return c==="waiting"?{...P,transform:G?`rotate(${G}deg)`:"none",opacity:0,visibility:"hidden"}:c==="idle"||c==="highlight"?{...P,...L,transform:G?`rotate(${G}deg)`:"none",transition:"none"}:c==="flying"?{...P,...I,transform:W?`rotate(${W}deg)`:"none",transition:`left ${k}ms ${R}, top ${k}ms ${R}, width ${k}ms ${R}, height ${k}ms ${R}, transform ${k}ms ${R}`}:{...P,...I,transform:W?`rotate(${W}deg)`:"none",transition:"none",opacity:0}},[c,L,I,k,R,E,C]),U=J.useMemo(()=>{const G=["animated-card",`animation-${t.type}`];return c==="waiting"&&G.push("is-waiting"),c==="idle"&&G.push("is-idle"),c==="highlight"&&G.push("is-highlighting"),c==="flying"&&G.push("is-flying"),c==="complete"&&G.push("is-complete"),v==="toFaceUp"&&G.push("flip-to-face-up"),G.join(" ")},[t.type,c,v]),B=J.useMemo(()=>t.type==="draw"&&m.owner==="opponent"?!1:v?y.isFaceUp:h.targetIsFaceUp!==void 0?h.targetIsFaceUp:y.isFaceUp,[v,c,y.isFaceUp,h.targetIsFaceUp,t.type,m.owner]);return o.jsx("div",{ref:s,className:U,style:F,children:o.jsx("div",{className:"animated-card-inner",children:o.jsx(St,{card:y,isFaceUp:B})})})};function oy(){const t=document.querySelector(".lane-stack .card-component");if(t){const r=window.getComputedStyle(t),s=parseFloat(r.width)||100,c=parseFloat(r.height)||140;parseFloat(r.top);const d=window.innerWidth;let u=64;return d<=1024&&(u=50),d<=768&&(u=42),{width:s,height:c,stackOffset:u}}const n=window.innerWidth;return n<=768?{width:70,height:98,stackOffset:42}:n<=1024?{width:85,height:119,stackOffset:50}:{width:100,height:140,stackOffset:64}}function ry(t){try{if(t.type==="hand"){const n=t.owner==="player"?document.querySelector(".game-main-area .player-hand-area"):document.querySelector(".game-board .opponent-hand-area");if(n){const r=n.querySelectorAll(".card-component");if(r[t.handIndex])return r[t.handIndex].getBoundingClientRect();{const s=oy();if(r.length>0){const d=r[r.length-1].getBoundingClientRect(),u=s.width*.35,p=t.handIndex-(r.length-1),f=d.left+u*p;return new DOMRect(f,d.top,d.width,d.height)}else{const c=n.getBoundingClientRect(),d=c.left+(c.width-s.width)/2,u=c.top+(c.height-s.height)/2;return new DOMRect(d,u,s.width,s.height)}}}}if(t.type==="lane"){const n=document.querySelector(".game-main-area .game-board");if(n){const r=t.owner==="player"?n.querySelector(".player-side:not(.opponent-side)"):n.querySelector(".opponent-side");if(r){const s=r.querySelectorAll(".lane-stack");if(s[t.laneIndex]){const c=s[t.laneIndex],d=c.querySelectorAll(".card-component");if(d[t.cardIndex])return d[t.cardIndex].getBoundingClientRect();const u=oy(),p=c.getBoundingClientRect(),f=p.left+(p.width-u.width)/2;if(d.length>0){const g=d[d.length-1].getBoundingClientRect(),C=t.owner==="opponent"?-1:1,b=g.top+C*u.stackOffset;return new DOMRect(f,b,u.width,u.height)}const y=t.owner==="opponent"?p.bottom-u.height:p.top;return new DOMRect(f,y,u.width,u.height)}}}}if(t.type==="deck"){const n=`.deck-pile.${t.owner} .pile-card-wrapper`,r=document.querySelector(n);if(r)return r.getBoundingClientRect()}if(t.type==="trash"){const n=`.trash-pile.${t.owner} .pile-card-wrapper`,r=document.querySelector(n);if(r)return r.getBoundingClientRect()}}catch(n){console.warn("[AnimatedCard] Could not get DOM position:",n)}return null}function ly(t){const d=window.innerWidth,u=window.innerHeight,p=f=>(d-340)/2+f*120;switch(t.type){case"lane":{const f=p(t.laneIndex),m=(t.owner==="opponent"?u*.15:u*.45)+t.cardIndex*64;return{left:f,top:m,width:100,height:140}}case"hand":{const f=t.owner==="opponent",h=6*(100*.7),m=(d-h)/2+t.handIndex*(100*.7),g=f?20:u-140-80;return{left:m,top:g,width:100,height:140}}case"deck":{const f=t.owner==="opponent";return{left:d-100-40,top:f?20:u-140-80,width:100,height:140}}case"trash":return{left:40,top:t.owner==="opponent"?20:u-140-80,width:100,height:140,opacity:0,transform:"scale(0.8)"};case"offscreen":return{left:d/2-100/2,top:-160,width:100,height:140,opacity:0};default:return{left:d/2-100/2,top:u/2-140/2,width:100,height:140}}}const vu=({duration:t,onComplete:n,animationId:r})=>{const s=J.useRef(!1);return J.useEffect(()=>{s.current=!1;const c=setTimeout(()=>{s.current||(s.current=!0,n())},t);return()=>clearTimeout(c)},[t,n,r]),null},Lk=()=>{const{currentAnimation:t,onAnimationComplete:n,skipAllAnimations:r}=Vu(),s=J.useRef(!1);J.useEffect(()=>{s.current=!1},[t==null?void 0:t.id]);const c=J.useCallback(()=>{s.current||(s.current=!0,n())},[n]);return J.useEffect(()=>{var h;if(!t)return;const d=t.duration||ia[t.type]||400,p=((((h=t.animatingCard)==null?void 0:h.startDelay)||0)+d)*2+500,f=setTimeout(()=>{s.current||(console.error(`[AnimationOverlay] EMERGENCY fallback triggered for ${t.type} after ${p}ms - AnimatedCard.onComplete failed!`),c())},p);return()=>clearTimeout(f)},[t,c]),J.useEffect(()=>{const d=u=>{u.key==="Escape"&&t&&r()};return window.addEventListener("keydown",d),()=>window.removeEventListener("keydown",d)},[t,r]),t?t.type==="phaseTransition"?o.jsx(vu,{duration:t.duration,onComplete:c,animationId:t.id}):t.type==="delay"?o.jsx(vu,{duration:t.duration,onComplete:c,animationId:t.id}):t.type==="flip"?o.jsx(vu,{duration:t.duration,onComplete:c,animationId:t.id}):o.jsxs("div",{className:"animation-overlay",style:{pointerEvents:"all"},onClick:d=>{d.stopPropagation()},children:[t.animatingCard&&o.jsx(gu,{animation:t,onComplete:c},t.id),t.animatingCards&&t.animatingCards.map((d,u)=>o.jsx(gu,{animation:{...t,animatingCard:{card:d.card,fromPosition:{type:"lane",owner:d.owner,laneIndex:t.laneIndex??0,cardIndex:u},toPosition:{type:"trash",owner:d.owner}}},startDelay:d.startDelay,onComplete:u===t.animatingCards.length-1?c:void 0},`compile-${d.card.id}-${u}`)),t.multiAnimatingCards&&t.multiAnimatingCards.map((d,u)=>o.jsx(gu,{animation:{...t,animatingCard:{card:d.card,fromPosition:d.fromPosition,toPosition:d.toPosition}},startDelay:d.startDelay,onComplete:u===t.multiAnimatingCards.length-1?c:void 0},`multi-${d.card.id}-${u}`))]}):null},sy=(t,n)=>{if(!n)return null;for(const r of["player","opponent"])for(const s of t[r].lanes){const c=s.find(d=>d.id===n);if(c)return{card:c,owner:r}}return null},Uk=new Set(["discard","select_card_from_hand_to_play","select_card_from_hand_to_give","select_card_from_hand_to_reveal","plague_2_player_discard","select_cards_from_hand_to_discard_for_fire_4","select_cards_from_hand_to_discard_for_hate_1"]);function Ok(t){return o.jsx(zC,{children:o.jsx(Mk,{...t})})}function Mk({onBack:t,onEndGame:n,playerProtocols:r,opponentProtocols:s,difficulty:c,useControlMechanic:d,startingPlayer:u="player",initialScenarioSetup:p}){var Rn,On,Nn,Ot,ka,Ra,Sn,Tn,ge,Oe,Qe,mt,Ze,Je,ct,ot;const{isAnimating:f,currentAnimation:h,enqueueAnimation:y,enqueueAnimations:m,getIsAnimatingSync:g,getAnimationSync:v}=Vu(),[C,b]=J.useState(null),[x,j]=J.useState(!0),{startGame:E,endGame:k,trackPlayerCoinFlip:R,trackPlayerRearrange:D}=Rk(r,c,d),L=J.useCallback((ue,Re,Fe)=>{b(ue),j(!1),R(Re,Fe)},[R]),I=J.useCallback(()=>{b("player"),j(!1),E()},[E]);J.useEffect(()=>{p&&x&&(console.log("[E2E] Auto-skipping coin flip for scenario"),b("player"),j(!1))},[p,x]),J.useEffect(()=>{!x&&C&&E()},[x,C,E]);const F=J.useCallback((ue,Re)=>{const Fe=Re.player.compiled.filter(ze=>ze).length;k(ue,Re.stats.player,Fe,Re.stats.opponent,Re.detailedGameStats),n(ue,Re)},[k,n]),{gameState:U,selectedCard:B,setSelectedCard:G,playSelectedCard:W,fillHand:P,discardCardFromHand:z,compileLane:H,resolveActionWithCard:A,resolveActionWithLane:N,resolveActionWithLaneFaceDown:T,selectHandCardForAction:q,resolveActionWithHandCard:O,skipAction:M,resolveOptionalDrawPrompt:Y,resolveOptionalDiscardCustomPrompt:X,resolveOptionalEffectPrompt:K,resolveVariableDiscard:ne,resolveRevealBoardCardPrompt:Z,resolveRearrangeProtocols:oe,resolveSwapProtocols:xe,resolveControlMechanicPrompt:ye,resolveCustomChoice:Ce,resolveSelectRevealedDeckCard:pe,resolveRevealDeckDrawProtocol:_e,resolveStateNumber:ee,resolveStateProtocol:je,resolveSelectFromDrawnToReveal:de,resolveConfirmDeckDiscard:Pe,resolveConfirmDeckPlayPreview:Ue,resolveSelectTrashCardToPlay:se,resolveSelectTrashCardToReveal:re,setupTestScenario:ce}=VC(r,s,F,c,d,C??"player",D,y,m,f),he=J.useRef(null),we=J.useMemo(()=>{var dt;const ue=v(),Re=g(),Fe=ue||h;if((Fe==null?void 0:Fe.type)==="flip")return he.current=null,U;if(Re&&(ue!=null&&ue.snapshot)){const it=new Set;return ue.animatingCard&&it.add(ue.animatingCard.card.id),ue.animatingCards&&ue.animatingCards.forEach(Dt=>it.add(Dt.card.id)),he.current={snapshot:ue.snapshot,cardIds:it},au(ue.snapshot,d)}if(f&&(h!=null&&h.snapshot)){const it=new Set;return h.animatingCard&&it.add(h.animatingCard.card.id),h.animatingCards&&h.animatingCards.forEach(Dt=>it.add(Dt.card.id)),he.current={snapshot:h.snapshot,cardIds:it},au(h.snapshot,d)}return(Re||f)&&((dt=he.current)!=null&&dt.snapshot)?au(he.current.snapshot,d):(he.current=null,U)},[f,h,U,d,v,g]),Se=J.useMemo(()=>{var it;const ue=new Set,Re=g(),Fe=v(),ze=Fe||h;return(ze==null?void 0:ze.type)==="flip"||Re&&Fe&&(Fe.animatingCard&&ue.add(Fe.animatingCard.card.id),Fe.animatingCards&&Fe.animatingCards.forEach(Dt=>ue.add(Dt.card.id)),ue.size>0)||f&&h&&(h.animatingCard&&ue.add(h.animatingCard.card.id),h.animatingCards&&h.animatingCards.forEach(Dt=>ue.add(Dt.card.id)),ue.size>0)?ue:(Re||f)&&((it=he.current)!=null&&it.cardIds)?he.current.cardIds:ue},[f,h,g,v]),ke=J.useMemo(()=>{if(f&&(h!=null&&h.animatingCard)){const{card:ue,fromPosition:Re}=h.animatingCard;return{cardId:ue.id,fromPosition:Re}}return null},[f,h]),Xe=J.useMemo(()=>(h==null?void 0:h.type)==="phaseTransition"&&h.phaseTransitionData?{phaseSequence:h.phaseTransitionData.phaseSequence,duration:h.duration}:null,[h]),{overridePhase:Le,overrideTurn:be}=J.useMemo(()=>(h==null?void 0:h.type)==="phaseTransition"?{overridePhase:void 0,overrideTurn:void 0}:h!=null&&h.snapshot?{overridePhase:h.snapshot.phase,overrideTurn:h.snapshot.turn}:{overridePhase:void 0,overrideTurn:void 0},[h]),[Me,Ne]=J.useState(null),[Be,Ye]=J.useState([]),[De,Ge]=J.useState(!1),[et,tt]=J.useState([]),rt=J.useRef(U.log.length),[ht,Rt]=J.useState(!1),[Ft,En]=J.useState(!1),[fn,Zt]=J.useState(null),[nn,un]=J.useState(!1),[jn,Xn]=J.useState(0),xn=J.useRef(null),kn=J.useRef(U);J.useEffect(()=>{kn.current=U},[U]);const qn=J.useRef(!1);J.useEffect(()=>{p&&!qn.current&&(console.log("[E2E] Applying initial scenario setup..."),qn.current=!0,setTimeout(()=>{ce(p),console.log("[E2E] Scenario setup complete")},100))},[p,ce]);const Ya=()=>{const ue=jn+1;if(Xn(ue),ue>=5){un(Re=>!Re),Xn(0),xn.current&&(clearTimeout(xn.current),xn.current=null);return}xn.current&&clearTimeout(xn.current),xn.current=setTimeout(()=>{Xn(0),xn.current=null},2e3)},$a=J.useCallback(()=>{console.log("Debug: Forcing player win via DebugPanel."),F("player",U)},[F,U]),Pa=J.useCallback(()=>{console.log("Debug: Forcing player loss via DebugPanel."),F("opponent",U)},[F,U]),qa=J.useMemo(()=>{if(U.lastPlayedCardId){const ue=sy(U,U.lastPlayedCardId);if(ue){const Re=ue.owner==="player"||ue.card.isFaceUp;return{card:ue.card,showContents:Re}}}return null},[U.lastPlayedCardId,U.player.lanes,U.opponent.lanes]),Ea=J.useMemo(()=>{var Re;const ue=(Re=U.actionRequired)==null?void 0:Re.sourceCardId;if(ue){const Fe=sy(U,ue);if(Fe){const ze=Fe.owner==="player"||Fe.card.isFaceUp;return{card:Fe.card,showContents:ze}}}return null},[(Rn=U.actionRequired)==null?void 0:Rn.sourceCardId,U.player.lanes,U.opponent.lanes]);J.useEffect(()=>{var ue;(ue=U.actionRequired)!=null&&ue.sourceCardId&&Ne(null)},[(On=U.actionRequired)==null?void 0:On.sourceCardId]);const da=Me||Ea||qa;J.useEffect(()=>{if(h!=null&&h.logMessage){const{message:ue,player:Re}=h.logMessage,Fe={message:ue,player:Re,id:pt()};tt(ze=>[...ze,Fe]),setTimeout(()=>{tt(ze=>ze.filter(dt=>dt.id!==Fe.id))},5e3)}},[h==null?void 0:h.id]),J.useEffect(()=>{if(U.log.length>rt.current){const ue=U.log.slice(rt.current);g()||ue.forEach(Re=>{if(Re.message!=="Game Started."){const Fe={message:Re.message,player:Re.player,id:pt()};tt(ze=>[...ze,Fe]),setTimeout(()=>{tt(ze=>ze.filter(dt=>dt.id!==Fe.id))},5e3)}})}rt.current=U.log.length},[U.log,g]),J.useEffect(()=>{var Re,Fe,ze,dt,it;!(((Re=U.actionRequired)==null?void 0:Re.type)==="discard"&&((Fe=U.actionRequired)==null?void 0:Fe.variableCount))&&((ze=U.actionRequired)==null?void 0:ze.type)!=="plague_2_player_discard"&&((dt=U.actionRequired)==null?void 0:dt.type)!=="select_cards_from_hand_to_discard_for_fire_4"&&((it=U.actionRequired)==null?void 0:it.type)!=="select_cards_from_hand_to_discard_for_hate_1"&&Ye([])},[U.actionRequired]),J.useEffect(()=>{var ue,Re;Rt(((ue=U.actionRequired)==null?void 0:ue.type)==="prompt_rearrange_protocols"&&U.actionRequired.actor==="player"),En(((Re=U.actionRequired)==null?void 0:Re.type)==="prompt_swap_protocols"&&U.actionRequired.actor==="player")},[U.actionRequired]),J.useEffect(()=>{const ue=Re=>{Re.ctrlKey&&Re.shiftKey&&(Re.preventDefault(),Re.key.toLowerCase()==="d"?(console.log("Debug: Toggling debug button visibility."),un(Fe=>!Fe)):Re.key.toLowerCase()==="w"?(console.log("Debug: Forcing player win."),n("player",U)):Re.key.toLowerCase()==="o"?(console.log("Debug: Forcing opponent win."),n("opponent",U)):Re.key.toLowerCase()==="p"?(console.log("Debug: Setting up Speed-0 interrupt scenario."),ce("speed-0-interrupt")):Re.key.toLowerCase()==="l"?(console.log("Debug: Setting up Speed-1 discard trigger scenario."),ce("speed-1-trigger")):Re.key.toLowerCase()==="f"?(console.log("Debug: Setting up Fire On-Cover test scenario."),ce("fire-oncover-test")):Re.key.toLowerCase()==="s"?(console.log("Debug: Setting up Speed-2 + Control test scenario."),ce("speed-2-control-test")):Re.key.toLowerCase()==="u"&&(console.log("Debug: Setting up Death-1 Uncover test scenario."),Hw(()=>Promise.resolve().then(()=>Ru),void 0).then(Fe=>{ce(Fe.scenario14_Death1UncoverTest.setup)})))};return window.addEventListener("keydown",ue),()=>{window.removeEventListener("keydown",ue)}},[U,n,ce]);const ua=(ue,Re)=>{var fa,nr,_o,wo,Za,ar;const Fe=kn.current;if(f)return;const{actionRequired:ze,turn:dt,phase:it,compilableLanes:Dt,player:Dn,opponent:Kn}=Fe;if(Re==="player"&&dt==="player"&&it==="compile"&&Dt.includes(ue)){if(ze){console.warn("Compile click blocked by pending action:",ze);return}H(ue);return}if(ze&&ze.actor==="player"&&["select_lane_for_shift","select_lane_for_shift_all","shift_flipped_card_optional","select_lane_for_play","select_lane_for_delete","select_lane_for_death_2","select_lane_for_life_3_play","select_lane_to_shift_revealed_card_for_light_2","select_lane_to_shift_revealed_board_card_custom","select_lane_to_shift_cards_for_light_3","select_lane_for_water_3","select_lane_for_metal_3_delete","select_lane_for_delete_all","select_lane_for_return","select_lanes_for_swap_stacks"].includes(ze.type)){N(ue);return}const Na=Kn.lanes.flat().some(Kt=>Kt.isFaceUp&&Kt.protocol==="Psychic"&&Kt.value===1),hn=Kn.lanes[ue],tr=hn.length>0&&hn[hn.length-1].isFaceUp&&hn[hn.length-1].protocol==="Plague"&&hn[hn.length-1].value===0;if(B&&it==="action"&&!ze&&Dn.hand.some(Kt=>Kt.id===B)&&!tr){const Kt=Dn.hand.find(Gt=>Gt.id===B);if(Re==="opponent"){if(!ml(Fe,Kt)){G(null),Ne(null);return}if(Na){G(null),Ne(null);return}W(ue,!0,"opponent"),Ne(null);return}const Ka=Dn.lanes.flat().some(Gt=>Gt.isFaceUp&&Gt.protocol==="Spirit"&&Gt.value===1),Mn=((nr=(fa=Kt.customEffects)==null?void 0:fa.bottomEffects)==null?void 0:nr.some(Gt=>{var cn,Jt;return((cn=Gt.params)==null?void 0:cn.action)==="card_property"&&((Jt=Gt.params)==null?void 0:Jt.property)==="ignore_protocol_matching"}))||((wo=(_o=Kt.customEffects)==null?void 0:_o.topEffects)==null?void 0:wo.some(Gt=>{var cn,Jt;return((cn=Gt.params)==null?void 0:cn.action)==="card_property"&&((Jt=Gt.params)==null?void 0:Jt.property)==="ignore_protocol_matching"}))||((ar=(Za=Kt.customEffects)==null?void 0:Za.middleEffects)==null?void 0:ar.some(Gt=>{var cn,Jt;return((cn=Gt.params)==null?void 0:cn.action)==="card_property"&&((Jt=Gt.params)==null?void 0:Jt.property)==="ignore_protocol_matching"})),xo=[...Dn.lanes.flat(),...Kn.lanes.flat()].some(Gt=>Gt.isFaceUp&&Gt.protocol==="Anarchy"&&Gt.value===1),Co=Au(Fe),Ta=Wc(Fe,"player",ue),Da=ml(Fe,Kt),Ja=Cl(Fe,"player",ue,Kt.protocol);let We;Da?We=!Na:xo||Co?We=Kt.protocol!==Dn.protocols[ue]&&Kt.protocol!==Kn.protocols[ue]&&!Na:We=(Ka||Ta||Mn||Ja||Kt.protocol===Dn.protocols[ue]||Kt.protocol===Kn.protocols[ue])&&!Na,W(ue,We),Ne(null);return}B&&(G(null),Ne(null))},La=ue=>{const Re=kn.current;if(f)return;const{phase:Fe,actionRequired:ze,player:dt}=Re;if((ze==null?void 0:ze.type)==="select_lane_for_play"&&ze.ignoreProtocolMatching&&ze.isFaceDown===void 0){const it=ze.validLanes;if(it&&!it.includes(ue))return;T(ue);return}B&&(Fe!=="action"||ze||!dt.hand.some(it=>it.id===B)||(W(ue,!1),Ne(null)))},Cn=ue=>{const Re=kn.current;if(!f){if(Re.actionRequired){if(Re.actionRequired.type==="discard"&&Re.actionRequired.actor==="player"){const Fe=Re.actionRequired.count;if(Fe>1||Re.actionRequired.variableCount){Ye(ze=>ze.includes(ue.id)?ze.filter(dt=>dt!==ue.id):!Re.actionRequired.variableCount&&ze.length>=Fe?ze:[...ze,ue.id]);return}else{z(ue.id);return}}if(Re.actionRequired.type==="select_card_from_hand_to_play"){q(ue.id);return}if(Re.actionRequired.type==="select_card_from_hand_to_give"||Re.actionRequired.type==="select_card_from_hand_to_reveal"){O(ue.id);return}if(Re.actionRequired.type==="plague_2_player_discard"||Re.actionRequired.type==="select_cards_from_hand_to_discard_for_fire_4"||Re.actionRequired.type==="select_cards_from_hand_to_discard_for_hate_1"){Ye(Fe=>Fe.includes(ue.id)?Fe.filter(ze=>ze!==ue.id):[...Fe,ue.id]);return}return}Re.turn!=="player"||Re.phase!=="action"&&Re.phase!=="compile"||(ue.id===B?(G(null),Ne(null)):(G(ue.id),Ne({card:ue,showContents:!0})))}},Vt=(ue,Re,Fe)=>{const ze=kn.current;if(f)return;const{actionRequired:dt,turn:it,phase:Dt,compilableLanes:Dn}=ze;if(it==="player"&&Dt==="compile"&&Dn.includes(Fe)){ua(Fe,Re);return}if(it==="player"&&!dt&&B&&Dt==="action"){ua(Fe,Re);return}if(dt&&dt.actor==="player"&&(dt.type==="select_own_highest_card_to_delete_for_hate_2"||dt.type==="select_opponent_highest_card_to_delete_for_hate_2")&&Bc(ue,ze)){A(ue.id);return}if(Bc(ue,ze))A(ue.id);else if(B)G(null),Ne(null);else{const Kn=Re==="player"||ue.isFaceUp;Ne({card:ue,showContents:Kn})}},Yt=ue=>{B||Ne({card:ue,showContents:!0})},Ln=(ue,Re)=>{if(!B){const Fe=Re==="player"||ue.isFaceUp;Ne({card:ue,showContents:Fe})}},pa=()=>{B||Ne(null)},Qa=ue=>{!B&&!U.actionRequired&&Ne({card:ue,showContents:ue.isRevealed||!1})},Xa=()=>{if(!da)return null;const{card:ue,showContents:Re}=da;return o.jsx(St,{card:ue,isFaceUp:Re})},Ua=U.turn==="player"&&!U.actionRequired&&U.phase==="compile"&&U.compilableLanes.length>0,Zn=((Nn=U.actionRequired)==null?void 0:Nn.sourceCardId)??null,ja=J.useMemo(()=>{var ue;return(ue=U.actionRequired)!=null&&ue.actor?U.actionRequired.actor==="player"?"action-required-player":"action-required-opponent":""},[U.actionRequired]),Un=J.useMemo(()=>{const ue=U.actionRequired;return ue&&ue.actor==="player"?Uk.has(ue.type)?"":"hand-in-background":""},[U.actionRequired]);return o.jsxs("div",{className:"screen game-screen",children:[fn&&o.jsx(cS,{player:fn,playerState:U[fn],onClose:()=>Zt(null),difficulty:c}),!f&&ht&&((Ot=U.actionRequired)==null?void 0:Ot.type)==="prompt_rearrange_protocols"&&o.jsx(JC,{gameState:U,targetPlayer:U.actionRequired.target,onConfirm:ue=>{var Re,Fe;((Re=U.actionRequired)==null?void 0:Re.sourceCardId)==="CONTROL_MECHANIC"&&((Fe=U.actionRequired)!=null&&Fe.actor)&&D(U.actionRequired.actor),oe(ue),Rt(!1)}}),!f&&Ft&&((ka=U.actionRequired)==null?void 0:ka.type)==="prompt_swap_protocols"&&o.jsx(eS,{gameState:U,targetPlayer:U.actionRequired.target,onConfirm:ue=>{xe(ue),En(!1)}}),!f&&(((Ra=U.actionRequired)==null?void 0:Ra.type)==="select_card_from_revealed_deck"||((Sn=U.actionRequired)==null?void 0:Sn.type)==="reveal_deck_draw_protocol")&&U.actionRequired.actor==="player"&&o.jsx(oS,{gameState:U,onSelectCard:ue=>{pe(ue)},onConfirmProtocolDraw:()=>{_e()}}),!f&&((Tn=U.actionRequired)==null?void 0:Tn.type)==="select_card_from_trash_to_play"&&U.actionRequired.actor==="player"&&o.jsx(ny,{gameState:U,onSelectCard:ue=>{se(ue)}}),!f&&((ge=U.actionRequired)==null?void 0:ge.type)==="select_card_from_trash_to_reveal"&&U.actionRequired.actor==="player"&&o.jsx(ny,{gameState:U,onSelectCard:ue=>{re(ue)}}),!f&&((Oe=U.actionRequired)==null?void 0:Oe.type)==="prompt_optional_effect"&&U.actionRequired.actor==="player"&&o.jsx(rS,{gameState:U,onAccept:()=>K(!0),onDecline:()=>K(!1)}),!f&&((Qe=U.actionRequired)==null?void 0:Qe.type)==="state_number"&&U.actionRequired.actor==="player"&&o.jsx(tS,{gameState:U,onConfirm:ue=>ee(ue)}),!f&&((mt=U.actionRequired)==null?void 0:mt.type)==="state_protocol"&&U.actionRequired.actor==="player"&&o.jsx(nS,{gameState:U,availableProtocols:U.actionRequired.availableProtocols||[],onConfirm:ue=>je(ue)}),!f&&((Ze=U.actionRequired)==null?void 0:Ze.type)==="select_from_drawn_to_reveal"&&U.actionRequired.actor==="player"&&o.jsx(aS,{gameState:U,allDrawnCardIds:U.actionRequired.allDrawnCardIds||[],eligibleCardIds:U.actionRequired.eligibleCardIds||[],statedNumber:U.actionRequired.statedNumber,revealCount:U.actionRequired.revealCount,onConfirm:ue=>de(ue),onClose:()=>{de("")}}),!f&&((Je=U.actionRequired)==null?void 0:Je.type)==="confirm_deck_discard"&&U.actionRequired.actor==="player"&&o.jsx(lS,{discardedCard:U.actionRequired.discardedCard,deckOwner:U.actionRequired.deckOwner,onConfirm:()=>Pe()}),!f&&((ct=U.actionRequired)==null?void 0:ct.type)==="confirm_deck_play_preview"&&U.actionRequired.actor==="player"&&o.jsx(sS,{card:U.actionRequired.drawnCard,isFaceDown:U.actionRequired.isFaceDown,onConfirm:()=>Ue()}),o.jsx("div",{className:"toaster-container",children:et.map(ue=>o.jsx(KC,{message:ue.message,player:ue.player},ue.id))}),De&&o.jsx(ZC,{log:U.log,onClose:()=>Ge(!1)}),o.jsx("button",{className:"btn log-button",onClick:()=>Ge(!0),children:"Log"}),o.jsxs("div",{className:"game-screen-layout",children:[o.jsxs("div",{className:"game-preview-container",children:[o.jsx("h2",{onClick:Ya,style:{cursor:"pointer",userSelect:"none"},title:"Click 5 times to toggle debug mode",children:"Mainframe"}),o.jsx(YC,{gameState:we,turn:f?we.turn:((ot=U.actionRequired)==null?void 0:ot.actor)||we.turn,difficulty:c,phaseTransitionAnimation:Xe,overridePhase:Le,overrideTurn:be,onPlayerClick:()=>Zt("player"),onOpponentClick:()=>Zt("opponent")}),o.jsx("div",{className:"preview-card-area",children:Xa()}),o.jsx("button",{className:"btn btn-back",onClick:t,children:"Back"})]}),o.jsxs("div",{className:"game-main-area",children:[Ua&&o.jsx("div",{className:"compile-prompt-container",children:o.jsx("h3",{children:"Select a Protocol to Compile"})}),o.jsx(BC,{gameState:we,onLanePointerDown:ua,onPlayFaceDown:La,selectedCardId:f?null:B,onCardPointerDown:Vt,onCardPointerEnter:Ln,onCardPointerLeave:pa,onOpponentHandCardPointerEnter:Qa,onOpponentHandCardPointerLeave:pa,sourceCardId:f?null:Zn,animatingCardIds:Se,animatingCardInfo:ke,onDeckClick:ue=>Zt(ue),onTrashClick:ue=>Zt(ue),onTrashCardHover:(ue,Re)=>{B||Ne({card:ue,showContents:!0})},onTrashCardLeave:()=>{B||Ne(null)}}),o.jsxs("div",{className:"player-action-area",children:[o.jsx(GC,{gameState:U,onFillHand:P,onSkipAction:M,onResolveOptionalDrawPrompt:Y,onResolveOptionalDiscardCustomPrompt:X,onResolveOptionalEffectPrompt:K,onResolveVariableDiscard:ne,onResolveRevealBoardCardPrompt:Z,onResolveControlMechanicPrompt:ye,onResolveCustomChoice:Ce,selectedCardId:B,multiSelectedCardIds:Be,actionRequiredClass:ja,isAnimating:f,snapshotTurn:we.turn,snapshotPhase:we.phase}),o.jsx("div",{className:`player-hand-area ${f?"":Un}`,children:(()=>{const ue=new Set;return we.player.hand.filter(Fe=>ue.has(Fe.id)?(console.warn("[GameScreen] Duplicate card ID in hand:",Fe.id,Fe.protocol,Fe.value),!1):(ue.add(Fe.id),!0)).filter(Fe=>{if(f)return!0;const ze=U.actionRequired;return(ze==null?void 0:ze.type)==="select_card_from_hand_to_play"&&(ze==null?void 0:ze.selectableCardIds)?ze.selectableCardIds.includes(Fe.id):!0}).map((Fe,ze)=>{var Dt;const dt=Se.has(Fe.id);if(f)return o.jsx(St,{card:Fe,isFaceUp:!0,additionalClassName:`in-hand ${dt?"animating-hidden":""}`},`hand-${Fe.id}-${ze}`);const it=((Dt=U.actionRequired)==null?void 0:Dt.type)==="select_lane_for_play"?Fe.id===U.actionRequired.cardInHandId:Fe.id===B;return o.jsx(St,{card:Fe,isFaceUp:!0,onPointerDown:()=>Cn(Fe),onPointerEnter:()=>Yt(Fe),isSelected:it,isMultiSelected:Be.includes(Fe.id),additionalClassName:"in-hand"},`hand-${Fe.id}-${ze}`)})})()})]})]})]}),x&&o.jsx(iS,{onComplete:L}),nn&&o.jsx($k,{onLoadScenario:ce,onSkipCoinFlip:I,onForceWin:$a,onForceLose:Pa}),o.jsx(Lk,{})]})}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function Hk({onPlayAgain:t,winner:n,finalState:r,difficulty:s}){if(!r)return o.jsxs("div",{className:"screen",children:[o.jsx("h1",{children:"Loading Results..."}),o.jsx("button",{className:"btn",onClick:t,children:"Back to Menu"})]});const c=n==="player",d=(u,p)=>{let f=[u];return p&&f.push("compiled"),f.join(" ")};return o.jsx("div",{className:`screen results-screen ${c?"victory":"defeat"}`,children:o.jsxs("div",{className:"results-screen-content",children:[o.jsxs("header",{className:"results-header",children:[o.jsx("h1",{children:c?"VICTORY":"DEFEAT"}),o.jsx("p",{children:c?"System compiled successfully.":"Critical error in the mainframe."})]}),o.jsxs("div",{className:"results-body",children:[o.jsxs("div",{className:"final-score-section",children:[o.jsx("h3",{children:"Final Score"}),o.jsxs("h4",{className:"results-label results-opponent-label",children:["Opponent (",s.charAt(0).toUpperCase()+s.slice(1),")"]}),o.jsxs("div",{className:"protocol-bars-container",children:[o.jsx("div",{className:"protocol-bar opponent-bar",children:r.opponent.protocols.map((u,p)=>o.jsxs("div",{className:d("protocol-display",r.opponent.compiled[p]),children:[o.jsx("span",{className:"protocol-name",children:u}),o.jsx("span",{className:"protocol-value",children:r.opponent.laneValues[p]})]},`opp-proto-${u}-${p}`))}),o.jsx("div",{className:"protocol-bar player-bar",children:r.player.protocols.map((u,p)=>o.jsxs("div",{className:d("protocol-display",r.player.compiled[p]),children:[o.jsx("span",{className:"protocol-name",children:u}),o.jsx("span",{className:"protocol-value",children:r.player.laneValues[p]})]},`player-proto-${u}-${p}`))})]}),o.jsx("h4",{className:"results-label results-player-label",children:"Player"})]}),o.jsxs("div",{className:"stats-section",children:[o.jsx("h3",{children:"Statistics"}),o.jsxs("div",{className:"stats-grid",children:[o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-item-label",children:"Cards Played"}),o.jsx("span",{className:"stat-item-value opponent",children:r.stats.opponent.cardsPlayed}),o.jsx("span",{className:"stat-item-value player",children:r.stats.player.cardsPlayed})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-item-label",children:"Cards Drawn"}),o.jsx("span",{className:"stat-item-value opponent",children:r.stats.opponent.cardsDrawn}),o.jsx("span",{className:"stat-item-value player",children:r.stats.player.cardsDrawn})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-item-label",children:"Cards Discarded"}),o.jsx("span",{className:"stat-item-value opponent",children:r.stats.opponent.cardsDiscarded}),o.jsx("span",{className:"stat-item-value player",children:r.stats.player.cardsDiscarded})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-item-label",children:"Cards Deleted"}),o.jsx("span",{className:"stat-item-value opponent",children:r.stats.opponent.cardsDeleted}),o.jsx("span",{className:"stat-item-value player",children:r.stats.player.cardsDeleted})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-item-label",children:"Cards Flipped"}),o.jsx("span",{className:"stat-item-value opponent",children:r.stats.opponent.cardsFlipped}),o.jsx("span",{className:"stat-item-value player",children:r.stats.player.cardsFlipped})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-item-label",children:"Cards Shifted"}),o.jsx("span",{className:"stat-item-value opponent",children:r.stats.opponent.cardsShifted}),o.jsx("span",{className:"stat-item-value player",children:r.stats.player.cardsShifted})]})]})]})]}),o.jsx("button",{className:"btn",onClick:t,children:"Play Again"})]})})}function Vk({onBack:t}){const[n,r]=J.useState(0);J.useEffect(()=>{hs(),r(x=>x+1)},[]);const s=J.useMemo(()=>{const x=Du(),j=er(),E=jr(),k=new Set(E.filter(D=>hl(D)).map(D=>D.name));return j.filter(D=>k.has(D.protocol)||x)},[n]),c=J.useMemo(()=>{const x=new Set(s.map(j=>j.protocol));return Array.from(x).sort()},[s]),[d,u]=J.useState(null),p=J.useMemo(()=>{const x=new Set(s.map(j=>j.category));return Array.from(x).sort()},[s]),[f,h]=J.useState(()=>new Set(p));J.useEffect(()=>{s.length>0&&!d&&u(s[0])},[s,d]);const y=x=>{h(j=>{const E=new Set(j);return E.has(x)?E.delete(x):E.add(x),E})},m=x=>{const j=s.find(E=>E.protocol===x);return(j==null?void 0:j.category)||""},g=J.useMemo(()=>c.filter(x=>{const j=m(x);return f.has(j)}),[c,f,s]),v=J.useMemo(()=>{const x={};for(const j of s)x[j.protocol]||(x[j.protocol]=[]),x[j.protocol].push(j);for(const j in x)x[j].sort((E,k)=>E.value-k.value);return x},[s]),C=x=>{u(x)},b=()=>{if(!d)return null;const x={...d,id:"preview",isFaceUp:!0};return o.jsx(St,{card:x,isFaceUp:!0})};return o.jsxs("div",{className:"screen card-library-screen",children:[o.jsx(Gc,{title:"Card Library",onBack:t}),o.jsxs("div",{className:"card-library-layout",children:[o.jsxs("div",{className:"game-preview-container",children:[o.jsx("h2",{children:"Card Preview"}),o.jsx("div",{className:"preview-card-area",children:b()})]}),o.jsxs("div",{className:"card-list-container",children:[o.jsx("div",{className:"category-filters",children:p.map(x=>o.jsxs("label",{className:"category-filter-item",children:[o.jsx("input",{type:"checkbox",checked:f.has(x),onChange:()=>y(x)}),o.jsx("span",{children:x})]},x))}),g.map(x=>o.jsxs("div",{className:"protocol-group",children:[o.jsxs("h3",{children:[x,o.jsxs("span",{className:"protocol-category-label",children:[" (",m(x),")"]})]}),o.jsx("div",{className:"protocol-card-grid",children:v[x].map(j=>{const E={...j,id:`${j.protocol}-${j.value}`,isFaceUp:!0};return o.jsx(St,{card:E,isFaceUp:!0,additionalClassName:"in-hand",onPointerEnter:()=>C(j),onPointerDown:()=>C(j)},E.id)})})]},x))]})]})]})}function zk({onBack:t}){const[n,r]=J.useState(()=>ku()),[s,c]=J.useState(!1),d=xk(n),u=Ck(n),p=Sk(n),f=bk(n),h=Ek(n),y=jk(n),m=kk(n),[g,v]=J.useState(null),C=()=>{mk(),r(ku()),c(!1)},b=q=>{v(O=>O===q?null:q)},x=n.global.totalGamesPlayed,j=n.actions.detailedStats,E=q=>x>0?(q/x).toFixed(1):"0.0",k=(q,O)=>O>0?(q/O).toFixed(1):"0.0",R=j.cardsDrawn.playerFromRefresh+j.cardsDrawn.playerFromEffect,D=j.cardsDrawn.aiFromRefresh+j.cardsDrawn.aiFromEffect,L=R+D,I=j.cardsPlayed.playerFromHand+j.cardsPlayed.playerFromEffect,F=j.cardsPlayed.aiFromHand+j.cardsPlayed.aiFromEffect,U=I+F,B=j.compiles.playerFirstCompile+j.compiles.playerRecompile,G=j.compiles.aiFirstCompile+j.compiles.aiRecompile,W=B+G,P=j.discards.player+j.discards.ai,z=j.deletes.player+j.deletes.ai,H=j.flips.player+j.flips.ai,A=j.shifts.player+j.shifts.ai,N=j.returns.player+j.returns.ai,T=j.refreshes.player+j.refreshes.ai;return o.jsxs("div",{className:"screen statistics-screen",children:[o.jsx(Gc,{title:"STATISTICS",onBack:t}),o.jsxs("div",{className:"stats-content",children:[o.jsxs("section",{className:"stats-section",children:[o.jsx("h2",{className:"section-title",children:"Overview"}),o.jsxs("div",{className:"stats-grid",children:[o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Games Played"}),o.jsx("span",{className:"stat-value",children:n.global.totalGamesPlayed})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Win Rate"}),o.jsxs("span",{className:"stat-value",children:[d.toFixed(1),"%"]})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Games Won"}),o.jsx("span",{className:"stat-value win",children:n.global.totalGamesWon})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Games Lost"}),o.jsx("span",{className:"stat-value loss",children:n.global.totalGamesLost})]})]})]}),o.jsxs("section",{className:"stats-section",children:[o.jsx("h2",{className:"section-title",children:"Streaks"}),o.jsxs("div",{className:"stats-grid",children:[o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Current Streak"}),o.jsx("span",{className:`stat-value ${n.global.currentStreak>0?"win":n.global.currentStreak<0?"loss":""}`,children:n.global.currentStreak>0?`+${n.global.currentStreak}`:n.global.currentStreak})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Best Win Streak"}),o.jsx("span",{className:"stat-value win",children:n.global.longestWinStreak})]})]})]}),o.jsxs("section",{className:"stats-section",children:[o.jsx("h2",{className:"section-title",children:"Playtime"}),o.jsxs("div",{className:"stats-grid",children:[o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Total Playtime"}),o.jsx("span",{className:"stat-value",children:fs(n.global.totalPlaytime)})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Average Game"}),o.jsx("span",{className:"stat-value",children:fs(u)})]}),n.global.fastestWin&&o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Fastest Win"}),o.jsx("span",{className:"stat-value",children:fs(n.global.fastestWin)})]}),n.global.longestGame&&o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Longest Game"}),o.jsx("span",{className:"stat-value",children:fs(n.global.longestGame)})]}),n.global.lastGameDuration&&o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Last Game"}),o.jsx("span",{className:"stat-value",children:fs(n.global.lastGameDuration)})]})]})]}),o.jsxs("section",{className:"stats-section",children:[o.jsx("h2",{className:"section-title",children:"AI Performance"}),o.jsx("div",{className:"ai-stats",children:["easy","normal","hard"].map(q=>{const O=n.aiDifficulty[q],M=O.played>0?O.wins/O.played*100:0;return o.jsxs("div",{className:"ai-item",children:[o.jsx("span",{className:"ai-name",children:q}),o.jsxs("span",{className:"ai-record",children:[o.jsxs("span",{className:"win",children:[O.wins,"W"]})," - ",o.jsxs("span",{className:"loss",children:[O.losses,"L"]})]}),o.jsxs("span",{className:"ai-winrate",children:["(",M.toFixed(1),"%)"]})]},q)})})]}),f.length>0&&o.jsxs("section",{className:"stats-section",children:[o.jsx("h2",{className:"section-title",children:"Best Win Rate"}),o.jsx("div",{className:"protocol-list",children:f.map((q,O)=>o.jsxs("div",{className:"protocol-item",children:[o.jsxs("span",{className:"protocol-rank",children:[O+1,"."]}),o.jsx("span",{className:"protocol-name",children:q.protocol}),o.jsxs("span",{className:"protocol-stats win",children:[q.winRate.toFixed(0),"%  ",q.timesUsed]})]},q.protocol))})]}),p.length>0&&o.jsxs("section",{className:"stats-section",children:[o.jsx("h2",{className:"section-title",children:"Favorite Protocols"}),o.jsx("div",{className:"protocol-list",children:p.map((q,O)=>o.jsxs("div",{className:"protocol-item",children:[o.jsxs("span",{className:"protocol-rank",children:[O+1,"."]}),o.jsx("span",{className:"protocol-name",children:q.protocol}),o.jsxs("span",{className:"protocol-stats",children:[q.timesUsed,"  ",q.winRate.toFixed(0),"%"]})]},q.protocol))})]}),h.length>0&&o.jsxs("section",{className:"stats-section",children:[o.jsx("h2",{className:"section-title",children:"Least Used Protocols"}),o.jsx("div",{className:"protocol-list",children:h.map((q,O)=>o.jsxs("div",{className:"protocol-item",children:[o.jsxs("span",{className:"protocol-rank",children:[O+1,"."]}),o.jsx("span",{className:"protocol-name",children:q.protocol}),o.jsxs("span",{className:"protocol-stats",children:[q.timesUsed,"  ",q.winRate.toFixed(0),"%"]})]},q.protocol))})]}),y.length>0&&o.jsxs("section",{className:"stats-section",children:[o.jsx("h2",{className:"section-title",children:"Most Played Cards"}),o.jsx("div",{className:"card-list",children:y.map((q,O)=>o.jsxs("div",{className:"card-item",children:[o.jsxs("span",{className:"card-rank",children:[O+1,"."]}),o.jsx("span",{className:"card-name",children:q.card}),o.jsxs("span",{className:"card-count",children:[q.count,""]})]},q.card))})]}),m.length>0&&o.jsxs("section",{className:"stats-section",children:[o.jsx("h2",{className:"section-title",children:"Most Deleted Cards"}),o.jsx("div",{className:"card-list",children:m.map((q,O)=>o.jsxs("div",{className:"card-item",children:[o.jsxs("span",{className:"card-rank",children:[O+1,"."]}),o.jsx("span",{className:"card-name",children:q.card}),o.jsxs("span",{className:"card-count",children:[q.count,""]})]},q.card))})]}),o.jsxs("section",{className:"stats-section",children:[o.jsx("h2",{className:"section-title",children:"Control Mechanic"}),o.jsxs("div",{className:"stats-grid",children:[o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"With Control"}),o.jsx("span",{className:"stat-value",children:n.control.gamesWithControl})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Without Control"}),o.jsx("span",{className:"stat-value",children:n.control.gamesWithoutControl})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Your Rearranges"}),o.jsx("span",{className:"stat-value",children:n.control.playerRearranges})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"AI Rearranges"}),o.jsx("span",{className:"stat-value",children:n.control.aiRearranges})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Total Rearranges"}),o.jsx("span",{className:"stat-value",children:n.control.totalRearranges})]})]})]}),o.jsxs("section",{className:"stats-section",children:[o.jsx("h2",{className:"section-title",children:"Coin Flip"}),o.jsxs("div",{className:"stats-grid",children:[o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Heads Chosen"}),o.jsxs("span",{className:"stat-value",children:[n.coinFlip.headsChosen," (",n.coinFlip.headsChosen>0?(n.coinFlip.headsWon/n.coinFlip.headsChosen*100).toFixed(0):0,"%)"]})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Tails Chosen"}),o.jsxs("span",{className:"stat-value",children:[n.coinFlip.tailsChosen," (",n.coinFlip.tailsChosen>0?(n.coinFlip.tailsWon/n.coinFlip.tailsChosen*100).toFixed(0):0,"%)"]})]})]})]}),o.jsxs("section",{className:"stats-section full-width",children:[o.jsx("h2",{className:"section-title",children:"Actions (click for details)"}),o.jsxs("div",{className:"actions-container",children:[o.jsxs("div",{className:`stat-item clickable ${g==="played"?"expanded":""}`,onClick:()=>b("played"),children:[o.jsx("span",{className:"stat-label",children:"Cards Played"}),o.jsx("span",{className:"stat-value",children:U})]}),o.jsxs("div",{className:`stat-item clickable ${g==="drawn"?"expanded":""}`,onClick:()=>b("drawn"),children:[o.jsx("span",{className:"stat-label",children:"Cards Drawn"}),o.jsx("span",{className:"stat-value",children:L})]}),o.jsxs("div",{className:`stat-item clickable ${g==="discards"?"expanded":""}`,onClick:()=>b("discards"),children:[o.jsx("span",{className:"stat-label",children:"Discards"}),o.jsx("span",{className:"stat-value",children:P})]}),o.jsxs("div",{className:`stat-item clickable ${g==="deletes"?"expanded":""}`,onClick:()=>b("deletes"),children:[o.jsx("span",{className:"stat-label",children:"Deletes"}),o.jsx("span",{className:"stat-value",children:z})]}),o.jsxs("div",{className:`stat-item clickable ${g==="flips"?"expanded":""}`,onClick:()=>b("flips"),children:[o.jsx("span",{className:"stat-label",children:"Flips"}),o.jsx("span",{className:"stat-value",children:H})]}),o.jsxs("div",{className:`stat-item clickable ${g==="shifts"?"expanded":""}`,onClick:()=>b("shifts"),children:[o.jsx("span",{className:"stat-label",children:"Shifts"}),o.jsx("span",{className:"stat-value",children:A})]}),o.jsxs("div",{className:`stat-item clickable ${g==="returns"?"expanded":""}`,onClick:()=>b("returns"),children:[o.jsx("span",{className:"stat-label",children:"Returns"}),o.jsx("span",{className:"stat-value",children:N})]}),o.jsxs("div",{className:`stat-item clickable ${g==="compiles"?"expanded":""}`,onClick:()=>b("compiles"),children:[o.jsx("span",{className:"stat-label",children:"Compiles"}),o.jsx("span",{className:"stat-value",children:W})]}),o.jsxs("div",{className:`stat-item clickable ${g==="refreshes"?"expanded":""}`,onClick:()=>b("refreshes"),children:[o.jsx("span",{className:"stat-label",children:"Refreshes"}),o.jsx("span",{className:"stat-value",children:T})]})]}),g==="played"&&o.jsxs("div",{className:"action-details-section",children:[o.jsx("h3",{className:"section-title",children:"Cards Played"}),o.jsxs("div",{className:"action-details-total",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:U})]}),o.jsxs("div",{className:"action-details-columns",children:[o.jsxs("div",{className:"action-details-column player",children:[o.jsx("div",{className:"column-header",children:"Player"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:I})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"From Hand"}),o.jsx("span",{className:"detail-value",children:j.cardsPlayed.playerFromHand})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"From Effect"}),o.jsx("span",{className:"detail-value",children:j.cardsPlayed.playerFromEffect})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Face-Up"}),o.jsx("span",{className:"detail-value",children:j.cardsPlayed.playerFaceUp})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Face-Down"}),o.jsx("span",{className:"detail-value",children:j.cardsPlayed.playerFaceDown})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:E(I)})]})]}),o.jsxs("div",{className:"action-details-column ai",children:[o.jsx("div",{className:"column-header",children:"AI"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:F})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"From Hand"}),o.jsx("span",{className:"detail-value",children:j.cardsPlayed.aiFromHand})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"From Effect"}),o.jsx("span",{className:"detail-value",children:j.cardsPlayed.aiFromEffect})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Face-Up"}),o.jsx("span",{className:"detail-value",children:j.cardsPlayed.aiFaceUp})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Face-Down"}),o.jsx("span",{className:"detail-value",children:j.cardsPlayed.aiFaceDown})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:E(F)})]})]})]})]}),g==="drawn"&&o.jsxs("div",{className:"action-details-section",children:[o.jsx("h3",{className:"section-title",children:"Cards Drawn"}),o.jsxs("div",{className:"action-details-total",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:L})]}),o.jsxs("div",{className:"action-details-columns",children:[o.jsxs("div",{className:"action-details-column player",children:[o.jsx("div",{className:"column-header",children:"Player"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:R})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"From Refresh"}),o.jsx("span",{className:"detail-value",children:j.cardsDrawn.playerFromRefresh})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"From Effect"}),o.jsx("span",{className:"detail-value",children:j.cardsDrawn.playerFromEffect})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:E(R)})]})]}),o.jsxs("div",{className:"action-details-column ai",children:[o.jsx("div",{className:"column-header",children:"AI"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:D})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"From Refresh"}),o.jsx("span",{className:"detail-value",children:j.cardsDrawn.aiFromRefresh})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"From Effect"}),o.jsx("span",{className:"detail-value",children:j.cardsDrawn.aiFromEffect})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:E(D)})]})]})]})]}),g==="discards"&&o.jsxs("div",{className:"action-details-section",children:[o.jsx("h3",{className:"section-title",children:"Discards"}),o.jsxs("div",{className:"action-details-total",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:P})]}),o.jsxs("div",{className:"action-details-columns",children:[o.jsxs("div",{className:"action-details-column player",children:[o.jsx("div",{className:"column-header",children:"Player"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:j.discards.player})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:E(j.discards.player)})]})]}),o.jsxs("div",{className:"action-details-column ai",children:[o.jsx("div",{className:"column-header",children:"AI"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:j.discards.ai})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:E(j.discards.ai)})]})]})]})]}),g==="deletes"&&o.jsxs("div",{className:"action-details-section",children:[o.jsx("h3",{className:"section-title",children:"Deletes"}),o.jsxs("div",{className:"action-details-total",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:z})]}),o.jsxs("div",{className:"action-details-columns",children:[o.jsxs("div",{className:"action-details-column player",children:[o.jsx("div",{className:"column-header",children:"Player"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:j.deletes.player})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:E(j.deletes.player)})]})]}),o.jsxs("div",{className:"action-details-column ai",children:[o.jsx("div",{className:"column-header",children:"AI"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:j.deletes.ai})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:E(j.deletes.ai)})]})]})]})]}),g==="flips"&&o.jsxs("div",{className:"action-details-section",children:[o.jsx("h3",{className:"section-title",children:"Flips"}),o.jsxs("div",{className:"action-details-total",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:H})]}),o.jsxs("div",{className:"action-details-columns",children:[o.jsxs("div",{className:"action-details-column player",children:[o.jsx("div",{className:"column-header",children:"Player"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:j.flips.player})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:E(j.flips.player)})]})]}),o.jsxs("div",{className:"action-details-column ai",children:[o.jsx("div",{className:"column-header",children:"AI"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:j.flips.ai})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:E(j.flips.ai)})]})]})]})]}),g==="shifts"&&o.jsxs("div",{className:"action-details-section",children:[o.jsx("h3",{className:"section-title",children:"Shifts"}),o.jsxs("div",{className:"action-details-total",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:A})]}),o.jsxs("div",{className:"action-details-columns",children:[o.jsxs("div",{className:"action-details-column player",children:[o.jsx("div",{className:"column-header",children:"Player"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:j.shifts.player})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:E(j.shifts.player)})]})]}),o.jsxs("div",{className:"action-details-column ai",children:[o.jsx("div",{className:"column-header",children:"AI"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:j.shifts.ai})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:E(j.shifts.ai)})]})]})]})]}),g==="returns"&&o.jsxs("div",{className:"action-details-section",children:[o.jsx("h3",{className:"section-title",children:"Returns"}),o.jsxs("div",{className:"action-details-total",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:N})]}),o.jsxs("div",{className:"action-details-columns",children:[o.jsxs("div",{className:"action-details-column player",children:[o.jsx("div",{className:"column-header",children:"Player"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:j.returns.player})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:E(j.returns.player)})]})]}),o.jsxs("div",{className:"action-details-column ai",children:[o.jsx("div",{className:"column-header",children:"AI"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:j.returns.ai})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:E(j.returns.ai)})]})]})]})]}),g==="compiles"&&o.jsxs("div",{className:"action-details-section",children:[o.jsx("h3",{className:"section-title",children:"Compiles"}),o.jsxs("div",{className:"action-details-total",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:W})]}),o.jsxs("div",{className:"action-details-columns",children:[o.jsxs("div",{className:"action-details-column player",children:[o.jsx("div",{className:"column-header",children:"Player"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:B})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"First-Compile"}),o.jsx("span",{className:"detail-value",children:j.compiles.playerFirstCompile})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Re-Compile"}),o.jsx("span",{className:"detail-value",children:j.compiles.playerRecompile})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:E(B)})]})]}),o.jsxs("div",{className:"action-details-column ai",children:[o.jsx("div",{className:"column-header",children:"AI"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:G})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"First-Compile"}),o.jsx("span",{className:"detail-value",children:j.compiles.aiFirstCompile})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Re-Compile"}),o.jsx("span",{className:"detail-value",children:j.compiles.aiRecompile})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:E(G)})]})]})]})]}),g==="refreshes"&&o.jsxs("div",{className:"action-details-section",children:[o.jsx("h3",{className:"section-title",children:"Refreshes"}),o.jsxs("div",{className:"action-details-total",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:T})]}),o.jsxs("div",{className:"action-details-columns",children:[o.jsxs("div",{className:"action-details-column player",children:[o.jsx("div",{className:"column-header",children:"Player"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:j.refreshes.player})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Cards / Refresh"}),o.jsx("span",{className:"detail-value",children:k(j.refreshes.playerCardsDrawn,j.refreshes.player)})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:E(j.refreshes.player)})]})]}),o.jsxs("div",{className:"action-details-column ai",children:[o.jsx("div",{className:"column-header",children:"AI"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:j.refreshes.ai})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Cards / Refresh"}),o.jsx("span",{className:"detail-value",children:k(j.refreshes.aiCardsDrawn,j.refreshes.ai)})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:E(j.refreshes.ai)})]})]})]})]})]}),o.jsx("section",{className:"stats-section reset-section",children:o.jsx("button",{className:"reset-stats-button",onClick:()=>c(!0),children:"Reset All Statistics"})})]}),s&&o.jsx("div",{className:"reset-modal-overlay",onClick:()=>c(!1),children:o.jsxs("div",{className:"reset-modal",onClick:q=>q.stopPropagation(),children:[o.jsx("h3",{children:"Reset Statistics?"}),o.jsx("p",{children:"This will permanently delete all your statistics. This action cannot be undone."}),o.jsxs("div",{className:"reset-modal-buttons",children:[o.jsx("button",{className:"cancel-button",onClick:()=>c(!1),children:"Cancel"}),o.jsx("button",{className:"confirm-reset-button",onClick:C,children:"Reset"})]})]})})]})}const Ht=({title:t,defaultOpen:n=!1,forceOpen:r=!1,children:s})=>{const[c,d]=J.useState(n||r),u=r||c;return o.jsxs("div",{className:"collapsible-section",children:[o.jsxs("button",{type:"button",className:`collapsible-header ${u?"open":""}`,onClick:()=>d(!c),children:[o.jsx("span",{className:"collapsible-arrow",children:u?"":""}),t]}),u&&o.jsx("div",{className:"collapsible-content",children:s})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Qc=({filter:t,onChange:n,showOwner:r=!0,showPosition:s=!0,showFaceState:c=!0,showExcludeSelf:d=!1,positionOptions:u})=>{const f=u||[{value:"any",label:"Any"},{value:"uncovered",label:"Uncovered"},{value:"covered",label:"Covered"}];return o.jsxs(o.Fragment,{children:[r&&o.jsxs("label",{children:["Owner",o.jsxs("select",{value:t.owner||"any",onChange:h=>{const y=h.target.value,m={...t};y==="any"?delete m.owner:m.owner=y,n(m)},children:[o.jsx("option",{value:"any",children:"Any"}),o.jsx("option",{value:"own",children:"Own"}),o.jsx("option",{value:"opponent",children:"Opponent"})]})]}),s&&o.jsxs("label",{children:["Position",o.jsx("select",{value:t.position||"uncovered",onChange:h=>n({...t,position:h.target.value}),children:f.map(h=>o.jsx("option",{value:h.value,children:h.label},h.value))})]}),c&&o.jsxs("label",{children:["Face State",o.jsxs("select",{value:t.faceState||"any",onChange:h=>n({...t,faceState:h.target.value}),children:[o.jsx("option",{value:"any",children:"Any"}),o.jsx("option",{value:"face_up",children:"Face-up"}),o.jsx("option",{value:"face_down",children:"Face-down"})]})]}),d&&o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:t.excludeSelf||!1,onChange:h=>n({...t,excludeSelf:h.target.checked})}),"Exclude self"]})]})},Bk=["none","empty_hand","opponent_higher_value_in_lane","this_card_is_covered"],Gk={none:"None",empty_hand:"Only if hand is empty",opponent_higher_value_in_lane:"Only if opponent has higher value in lane",this_card_is_covered:"Only if this card is covered",protocol_match:"Only in lane with specific protocol",hand_size_greater_than:"Only if hand size greater than...",same_protocol_on_field:"Only if same protocol card on field (Unity)",compile_block:"Block opponent compile next turn",trash_not_empty:"Only if trash is not empty"},Xc=({conditional:t,onChange:n,availableTypes:r=Bk,showProtocolInput:s=!1,showThresholdInput:c=!1,showTurnDuration:d=!1})=>{const u=(t==null?void 0:t.type)||"none",p=u!=="none",f=h=>{n(h==="none"?void 0:{...t,type:h})};return o.jsxs(Ht,{title:"Conditionals",forceOpen:p,children:[o.jsxs("div",{className:"filter-row",children:[o.jsxs("label",{children:["Condition",o.jsx("select",{value:u,onChange:h=>f(h.target.value),children:r.map(h=>o.jsx("option",{value:h,children:Gk[h||"none"]},h))})]}),u==="protocol_match"&&s&&o.jsxs("label",{children:["Protocol",o.jsx("input",{type:"text",value:(t==null?void 0:t.protocol)||"",onChange:h=>n({...t,type:"protocol_match",protocol:h.target.value}),placeholder:"e.g., Fire, Water..."})]}),u==="hand_size_greater_than"&&c&&o.jsxs("label",{children:["Threshold",o.jsx("input",{type:"number",min:0,max:10,value:(t==null?void 0:t.threshold)||0,onChange:h=>n({...t,type:"hand_size_greater_than",threshold:parseInt(h.target.value)})})]}),u==="compile_block"&&d&&o.jsxs("label",{children:["Turns",o.jsxs("select",{value:(t==null?void 0:t.turnDuration)||1,onChange:h=>n({...t,type:"compile_block",turnDuration:parseInt(h.target.value)}),children:[o.jsx("option",{value:1,children:"1 turn"}),o.jsx("option",{value:2,children:"2 turns"}),o.jsx("option",{value:3,children:"3 turns"})]})]})]}),u!=="none"&&o.jsx("small",{className:"hint-text",children:"Effect only triggers when condition is met"})]})},l_=({params:t,onChange:n})=>{var p,f,h,y,m,g,v,C,b,x,j,E;const r=t.countType||"fixed",s=t.revealFromDrawn!==void 0,c=t.valueFilter!==void 0,d=((p=t.conditional)==null?void 0:p.type)||((f=t.advancedConditional)==null?void 0:f.type),u=((h=t.protocolFilter)==null?void 0:h.type)==="same_as_source";return o.jsxs("div",{className:"param-editor draw-effect-editor",children:[o.jsx("h4",{children:"Draw Effect"}),o.jsxs("div",{className:"effect-editor-basic",children:[o.jsxs("label",{children:["Count Type",o.jsxs("select",{value:r,onChange:k=>{const R=k.target.value;n({...t,countType:R,countOffset:R==="equal_to_discarded"?0:void 0})},children:[o.jsx("option",{value:"fixed",children:"Fixed"}),o.jsx("option",{value:"equal_to_card_value",children:"Card Value"}),o.jsx("option",{value:"equal_to_discarded",children:"Discarded Count"}),o.jsx("option",{value:"hand_size",children:"Hand Size"}),o.jsx("option",{value:"count_own_protocol_cards_on_field",children:"Same Protocol (Unity)"})]})]}),r==="fixed"&&o.jsxs("label",{children:["Count",o.jsx("select",{value:t.count,onChange:k=>n({...t,count:parseInt(k.target.value)||1}),children:[1,2,3,4,5,6].map(k=>o.jsx("option",{value:k,children:k},k))})]}),r==="equal_to_discarded"&&o.jsxs("label",{children:["Offset",o.jsx("input",{type:"number",min:-5,max:5,value:t.countOffset||0,onChange:k=>n({...t,countOffset:parseInt(k.target.value)||0})})]}),o.jsxs("label",{children:["Target",o.jsxs("select",{value:t.target,onChange:k=>n({...t,target:k.target.value}),children:[o.jsx("option",{value:"self",children:"Self"}),o.jsx("option",{value:"opponent",children:"Opponent"})]})]}),o.jsxs("label",{children:["Source",o.jsxs("select",{value:t.source,onChange:k=>n({...t,source:k.target.value}),children:[o.jsx("option",{value:"own_deck",children:"Own Deck"}),o.jsx("option",{value:"opponent_deck",children:"Opponent's Deck"})]})]})]}),o.jsxs("div",{className:"effect-editor-basic",children:[o.jsxs("label",{className:"checkbox-label",children:[o.jsx("input",{type:"checkbox",checked:t.preAction==="refresh",onChange:k=>n({...t,preAction:k.target.checked?"refresh":void 0})}),"Refresh first"]}),o.jsxs("label",{className:"checkbox-label",children:[o.jsx("input",{type:"checkbox",checked:t.optional||!1,onChange:k=>n({...t,optional:k.target.checked})}),"Optional"]})]}),o.jsxs(Ht,{title:"Reveal from Drawn",forceOpen:s,children:[o.jsxs("label",{className:"checkbox-label",children:[o.jsx("input",{type:"checkbox",checked:s,onChange:k=>{if(k.target.checked)n({...t,revealFromDrawn:{valueSource:"stated_number"}});else{const{revealFromDrawn:R,...D}=t;n(D)}}}),"Enable reveal from drawn cards"]}),s&&o.jsxs("div",{className:"filter-row",children:[o.jsxs("label",{children:["Reveal Count",o.jsxs("select",{value:((y=t.revealFromDrawn)==null?void 0:y.count)==="all"?"all":(((m=t.revealFromDrawn)==null?void 0:m.count)||1).toString(),onChange:k=>{const R=k.target.value;n({...t,revealFromDrawn:{...t.revealFromDrawn,count:R==="all"?"all":parseInt(R)}})},children:[o.jsx("option",{value:"1",children:"1"}),o.jsx("option",{value:"2",children:"2"}),o.jsx("option",{value:"3",children:"3"}),o.jsx("option",{value:"all",children:"All"})]})]}),o.jsxs("label",{children:["Value Filter",o.jsxs("select",{value:((g=t.revealFromDrawn)==null?void 0:g.valueSource)||"stated_number",onChange:k=>n({...t,revealFromDrawn:{...t.revealFromDrawn,valueSource:k.target.value}}),children:[o.jsx("option",{value:"stated_number",children:"Stated Number"}),o.jsx("option",{value:"any",children:"Any"})]})]}),o.jsxs("label",{children:["After Reveal",o.jsxs("select",{value:((v=t.revealFromDrawn)==null?void 0:v.thenAction)||"",onChange:k=>{if(k.target.value===""){const{thenAction:R,...D}=t.revealFromDrawn;n({...t,revealFromDrawn:D})}else n({...t,revealFromDrawn:{...t.revealFromDrawn,thenAction:k.target.value}})},children:[o.jsx("option",{value:"",children:"None"}),o.jsx("option",{value:"may_play",children:"May Play"})]})]})]})]}),o.jsxs(Ht,{title:"Draw Specific Value",forceOpen:c,children:[o.jsxs("label",{className:"checkbox-label",children:[o.jsx("input",{type:"checkbox",checked:c,onChange:k=>{if(k.target.checked)n({...t,valueFilter:{equals:1}});else{const{valueFilter:R,...D}=t;n(D)}}}),"Draw specific value only"]}),c&&o.jsxs("div",{className:"filter-row",children:[o.jsxs("label",{children:["Card Value",o.jsx("select",{value:((C=t.valueFilter)==null?void 0:C.equals)??1,onChange:k=>n({...t,valueFilter:{equals:parseInt(k.target.value)||0}}),children:[0,1,2,3,4,5].map(k=>o.jsx("option",{value:k,children:k},k))})]}),o.jsxs("label",{className:"checkbox-label",children:[o.jsx("input",{type:"checkbox",checked:t.fromRevealed||!1,onChange:k=>n({...t,fromRevealed:k.target.checked})}),"From revealed"]})]})]}),o.jsxs(Ht,{title:"Conditionals",forceOpen:d,children:[o.jsxs("div",{className:"filter-row",children:[o.jsxs("label",{children:["Basic Conditional",o.jsxs("select",{value:((b=t.conditional)==null?void 0:b.type)||"none",onChange:k=>{if(k.target.value==="none"){const{conditional:R,...D}=t;n(D)}else n({...t,conditional:{type:k.target.value}})},children:[o.jsx("option",{value:"none",children:"None"}),o.jsx("option",{value:"count_face_down",children:"1 per face-down"}),o.jsx("option",{value:"is_covering",children:"If covering"}),o.jsx("option",{value:"non_matching_protocols",children:"1 per non-matching"})]})]}),o.jsxs("label",{children:["Advanced",o.jsxs("select",{value:((x=t.advancedConditional)==null?void 0:x.type)||"none",onChange:k=>{if(k.target.value==="none"){const{advancedConditional:R,...D}=t;n(D)}else k.target.value==="protocol_match"?n({...t,advancedConditional:{type:"protocol_match",protocol:""}}):k.target.value==="compile_block"?n({...t,advancedConditional:{type:"compile_block",turnDuration:1}}):n({...t,advancedConditional:{type:k.target.value}})},children:[o.jsx("option",{value:"none",children:"None"}),o.jsx("option",{value:"protocol_match",children:"Protocol match"}),o.jsx("option",{value:"compile_block",children:"Block compile"}),o.jsx("option",{value:"empty_hand",children:"Empty hand"}),o.jsx("option",{value:"opponent_higher_value_in_lane",children:"Opponent higher"}),o.jsx("option",{value:"same_protocol_on_field",children:"Same protocol (Unity)"})]})]})]}),((j=t.advancedConditional)==null?void 0:j.type)==="protocol_match"&&o.jsxs("label",{children:["Protocol",o.jsx("input",{type:"text",placeholder:"e.g., Fire",value:t.advancedConditional.protocol||"",onChange:k=>n({...t,advancedConditional:{...t.advancedConditional,type:"protocol_match",protocol:k.target.value}})})]}),((E=t.advancedConditional)==null?void 0:E.type)==="compile_block"&&o.jsxs("label",{children:["Block Duration",o.jsxs("select",{value:t.advancedConditional.turnDuration||1,onChange:k=>n({...t,advancedConditional:{...t.advancedConditional,type:"compile_block",turnDuration:parseInt(k.target.value)||1}}),children:[o.jsx("option",{value:1,children:"1 turn"}),o.jsx("option",{value:2,children:"2 turns"}),o.jsx("option",{value:3,children:"3 turns"})]})]})]}),o.jsx(Ht,{title:"Special Options",forceOpen:u,children:o.jsxs("label",{className:"checkbox-label",children:[o.jsx("input",{type:"checkbox",checked:u,onChange:k=>{if(k.target.checked)n({...t,protocolFilter:{type:"same_as_source"}});else{const{protocolFilter:R,...D}=t;n(D)}}}),"Draw all same-protocol cards (Unity-4)"]})})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Wk=({params:t,onChange:n})=>o.jsxs("div",{className:"param-editor refresh-effect-editor",children:[o.jsx("h4",{children:"Refresh Effect"}),o.jsx("small",{className:"hint-text",children:'Refresh fills the hand to 5 cards (Spirit-0: "Refresh.")'}),o.jsx("div",{className:"effect-editor-basic",children:o.jsxs("label",{children:["Target",o.jsxs("select",{value:t.target||"self",onChange:r=>n({...t,target:r.target.value}),children:[o.jsx("option",{value:"self",children:"Self"}),o.jsx("option",{value:"opponent",children:"Opponent"})]})]})})]});/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Yk=({params:t,onChange:n})=>o.jsxs("div",{className:"param-editor mutual-draw-effect-editor",children:[o.jsx("h4",{children:"Mutual Draw Effect"}),o.jsx("small",{className:"hint-text",children:`Both players draw from each other's decks (Chaos-0: "Draw the top card of your opponent's deck. Your opponent draws the top card of your deck.")`}),o.jsx("div",{className:"effect-editor-basic",children:o.jsxs("label",{children:["Count",o.jsx("input",{type:"number",min:"1",max:"10",value:t.count||1,onChange:r=>n({...t,count:parseInt(r.target.value)||1})})]})})]}),s_=({params:t,onChange:n})=>{var p,f,h,y;const r=t.targetFilter||{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1},s=t.count??1,c=r.owner!=="any"||r.position!=="uncovered"||r.faceState!=="any"||r.excludeSelf||r.valueMinGreaterThanHandSize||r.valueLessThanUniqueProtocolsOnField,d=t.flipSelf||t.selfFlipAfter||t.skipMiddleCommand||t.sameLaneAsFirst,u=!!((p=t.advancedConditional)!=null&&p.type);return typeof s=="number"&&t.scope&&t.scope!=="any"||s==="each"&&t.eachLineScope,o.jsxs("div",{className:"param-editor flip-effect-editor",children:[o.jsx("h4",{children:"Flip Effect"}),o.jsxs("div",{className:"effect-editor-basic",children:[o.jsxs("label",{children:["Count",o.jsxs("select",{value:s==="all"?"all":s==="each"?"each":s.toString(),onChange:m=>{const g=m.target.value;n(g==="all"?{...t,count:"all"}:g==="each"?{...t,count:"each"}:{...t,count:parseInt(g)})},children:[o.jsx("option",{value:"1",children:"1"}),o.jsx("option",{value:"2",children:"2"}),o.jsx("option",{value:"3",children:"3"}),o.jsx("option",{value:"all",children:"All"}),o.jsx("option",{value:"each",children:"Each"})]})]}),typeof s=="number"&&o.jsxs("label",{children:["Scope",o.jsxs("select",{value:t.scope||"any",onChange:m=>n({...t,scope:m.target.value}),children:[o.jsx("option",{value:"any",children:"Any lane"}),o.jsx("option",{value:"this_lane",children:"This lane only"}),o.jsx("option",{value:"each_lane",children:"Each lane"})]})]}),s==="each"&&o.jsxs("label",{children:["Each Scope",o.jsxs("select",{value:t.eachLineScope||"all_lines",onChange:m=>n({...t,eachLineScope:m.target.value}),children:[o.jsx("option",{value:"all_lines",children:"Each on board"}),o.jsx("option",{value:"each_line",children:"1 per lane"})]})]}),o.jsxs("label",{className:"checkbox-label",children:[o.jsx("input",{type:"checkbox",checked:t.optional,onChange:m=>n({...t,optional:m.target.checked})}),"Optional"]})]}),o.jsxs(Ht,{title:"Target Filter",forceOpen:c,children:[o.jsx(Qc,{filter:r,onChange:m=>n({...t,targetFilter:{...r,...m}}),showOwner:!0,showPosition:!0,showFaceState:!0,showExcludeSelf:!0,positionOptions:[{value:"any",label:"Any"},{value:"uncovered",label:"Uncovered"},{value:"covered",label:"Covered"},{value:"covered_in_this_line",label:"Covered in this line"}]}),o.jsxs("div",{className:"filter-row",children:[o.jsxs("label",{className:"checkbox-label",children:[o.jsx("input",{type:"checkbox",checked:r.valueMinGreaterThanHandSize||!1,onChange:m=>n({...t,targetFilter:{...r,valueMinGreaterThanHandSize:m.target.checked}})}),"Value > hand size"]}),o.jsxs("label",{className:"checkbox-label",children:[o.jsx("input",{type:"checkbox",checked:r.valueLessThanUniqueProtocolsOnField||!1,onChange:m=>n({...t,targetFilter:{...r,valueLessThanUniqueProtocolsOnField:m.target.checked}})}),"Value < protocol count"]})]})]}),o.jsxs(Ht,{title:"Advanced Options",forceOpen:d,children:[o.jsxs("div",{className:"filter-row",children:[o.jsxs("label",{className:"checkbox-label",children:[o.jsx("input",{type:"checkbox",checked:t.flipSelf||!1,onChange:m=>n({...t,flipSelf:m.target.checked})}),"Flip ONLY this card"]}),o.jsxs("label",{className:"checkbox-label",children:[o.jsx("input",{type:"checkbox",checked:t.selfFlipAfter||!1,onChange:m=>n({...t,selfFlipAfter:m.target.checked})}),"Also flip this card after"]})]}),o.jsxs("div",{className:"filter-row",children:[o.jsxs("label",{className:"checkbox-label",children:[o.jsx("input",{type:"checkbox",checked:t.skipMiddleCommand||!1,onChange:m=>n({...t,skipMiddleCommand:m.target.checked})}),"Skip middle command"]}),o.jsxs("label",{className:"checkbox-label",children:[o.jsx("input",{type:"checkbox",checked:t.sameLaneAsFirst||!1,onChange:m=>n({...t,sameLaneAsFirst:m.target.checked})}),"Same lane as first flip"]})]})]}),o.jsx(Ht,{title:"Conditionals",forceOpen:u,children:o.jsxs("div",{className:"filter-row",children:[o.jsxs("label",{children:["Condition",o.jsxs("select",{value:((f=t.advancedConditional)==null?void 0:f.type)||"",onChange:m=>{if(m.target.value===""){const{advancedConditional:g,...v}=t;n(v)}else m.target.value==="protocol_match"?n({...t,advancedConditional:{type:"protocol_match",protocol:""}}):m.target.value==="hand_size_greater_than"?n({...t,advancedConditional:{type:"hand_size_greater_than",threshold:1}}):n({...t,advancedConditional:{type:m.target.value}})},children:[o.jsx("option",{value:"",children:"None"}),o.jsx("option",{value:"protocol_match",children:"In specific protocol lane"}),o.jsx("option",{value:"opponent_higher_value_in_lane",children:"Opponent higher value"}),o.jsx("option",{value:"hand_size_greater_than",children:"Hand size greater than"}),o.jsx("option",{value:"same_protocol_on_field",children:"Same protocol on field (Unity)"}),o.jsx("option",{value:"this_card_is_covered",children:"This card is covered"})]})]}),((h=t.advancedConditional)==null?void 0:h.type)==="protocol_match"&&o.jsxs("label",{children:["Protocol",o.jsx("input",{type:"text",value:t.advancedConditional.protocol||"",onChange:m=>n({...t,advancedConditional:{...t.advancedConditional,protocol:m.target.value}}),placeholder:"e.g., Fire"})]}),((y=t.advancedConditional)==null?void 0:y.type)==="hand_size_greater_than"&&o.jsxs("label",{children:["Threshold",o.jsx("input",{type:"number",min:"0",max:"10",value:t.advancedConditional.threshold??1,onChange:m=>n({...t,advancedConditional:{...t.advancedConditional,threshold:parseInt(m.target.value)||0}})})]})]})})]})},c_=({params:t,onChange:n})=>{var d,u,p;const r=t.targetFilter||{owner:"any",position:"uncovered",faceState:"any"},s=r.owner!=="any"||r.position!=="uncovered"||r.faceState!=="any"||r.excludeSelf,c=((d=t.destinationRestriction)==null?void 0:d.type)!=="any"&&((u=t.destinationRestriction)==null?void 0:u.type)||t.scope&&t.scope!=="any";return o.jsxs("div",{className:"param-editor shift-effect-editor",children:[o.jsx("h4",{children:"Shift Effect"}),o.jsxs("div",{className:"effect-editor-basic",children:[o.jsxs("label",{children:["Count",o.jsxs("select",{value:t.count==="all"?"all":"1",onChange:f=>{if(f.target.value==="all")n({...t,count:"all"});else{const{count:h,...y}=t;n(y)}},children:[o.jsx("option",{value:"1",children:"1 card"}),o.jsx("option",{value:"all",children:"All matching"})]})]}),o.jsxs("label",{className:"checkbox-label",children:[o.jsx("input",{type:"checkbox",checked:t.optional||!1,onChange:f=>n({...t,optional:f.target.checked})}),"Optional"]}),o.jsxs("label",{className:"checkbox-label",children:[o.jsx("input",{type:"checkbox",checked:t.shiftSelf||!1,onChange:f=>n({...t,shiftSelf:f.target.checked})}),"Shift this card"]})]}),o.jsx(Ht,{title:"Target Filter",forceOpen:s,children:o.jsx(Qc,{filter:r,onChange:f=>n({...t,targetFilter:{...r,...f}}),showOwner:!0,showPosition:!0,showFaceState:!0,showExcludeSelf:!0})}),o.jsx(Ht,{title:"Scope & Destination",forceOpen:c,children:o.jsxs("div",{className:"filter-row",children:[o.jsxs("label",{children:["Source Scope",o.jsxs("select",{value:t.scope||"any",onChange:f=>{if(f.target.value==="any"){const{scope:h,...y}=t;n(y)}else n({...t,scope:f.target.value})},children:[o.jsx("option",{value:"any",children:"Any lane"}),o.jsx("option",{value:"this_lane",children:"This lane only"}),o.jsx("option",{value:"each_lane",children:"Each lane"})]})]}),o.jsxs("label",{children:["Destination",o.jsxs("select",{value:((p=t.destinationRestriction)==null?void 0:p.type)||"any",onChange:f=>{if(f.target.value==="any"){const{destinationRestriction:h,...y}=t;n(y)}else n({...t,destinationRestriction:{type:f.target.value}})},children:[o.jsx("option",{value:"any",children:"Any lane"}),o.jsx("option",{value:"to_another_line",children:"To another lane"}),o.jsx("option",{value:"non_matching_protocol",children:"Non-matching protocol"}),o.jsx("option",{value:"specific_lane",children:"This lane (within)"}),o.jsx("option",{value:"to_this_lane",children:"To THIS lane only"}),o.jsx("option",{value:"to_or_from_this_lane",children:"To OR from this lane"}),o.jsx("option",{value:"opponent_highest_value_lane",children:"Opponent's highest value lane"})]})]})]})}),o.jsx(Xc,{conditional:t.advancedConditional,onChange:f=>{if(f)n({...t,advancedConditional:f});else{const{advancedConditional:h,...y}=t;n(y)}},availableTypes:["none","empty_hand","opponent_higher_value_in_lane","this_card_is_covered"]})]})},i_=({params:t,onChange:n})=>{var p,f,h,y,m,g,v,C;const r=t.targetFilter||{position:"uncovered",faceState:"any"},s=r.position!=="uncovered"||r.faceState!=="any"||r.owner||r.calculation||r.valueRange||r.valueSource,c=((p=t.scope)==null?void 0:p.type)&&t.scope.type!=="any",d=((f=t.laneCondition)==null?void 0:f.type)||t.selectLane,u=t.deleteSelf;return o.jsxs("div",{className:"param-editor delete-effect-editor",children:[o.jsx("h4",{children:"Delete Effect"}),o.jsxs("div",{className:"effect-editor-basic",children:[o.jsxs("label",{children:["Count",o.jsxs("select",{value:typeof t.count=="number"?t.count.toString():"all",onChange:b=>n({...t,count:b.target.value==="all"?"all_in_lane":parseInt(b.target.value)}),children:[o.jsx("option",{value:"1",children:"1"}),o.jsx("option",{value:"2",children:"2"}),o.jsx("option",{value:"3",children:"3"}),o.jsx("option",{value:"all",children:"All in lane"})]})]}),o.jsxs("label",{className:"checkbox-label",children:[o.jsx("input",{type:"checkbox",checked:t.excludeSelf,onChange:b=>n({...t,excludeSelf:b.target.checked})}),"Exclude self"]}),o.jsxs("label",{className:"checkbox-label",children:[o.jsx("input",{type:"checkbox",checked:t.deleteSelf||!1,onChange:b=>n({...t,deleteSelf:b.target.checked})}),"Delete this card"]})]}),u&&o.jsx(Ht,{title:"Delete Self Condition",forceOpen:!!t.protocolCountConditional,children:o.jsxs("label",{children:["Protocol Count",o.jsxs("select",{value:((h=t.protocolCountConditional)==null?void 0:h.threshold)||"none",onChange:b=>{const x=b.target.value;if(x==="none"){const{protocolCountConditional:j,...E}=t;n(E)}else n({...t,protocolCountConditional:{type:"unique_protocols_on_field_below",threshold:parseInt(x)}})},children:[o.jsx("option",{value:"none",children:"Always delete"}),o.jsx("option",{value:"2",children:"If < 2 protocols"}),o.jsx("option",{value:"3",children:"If < 3 protocols"}),o.jsx("option",{value:"4",children:"If < 4 protocols"}),o.jsx("option",{value:"5",children:"If < 5 protocols"}),o.jsx("option",{value:"6",children:"If < 6 protocols"})]})]})}),o.jsxs(Ht,{title:"Target Filter",forceOpen:s,children:[o.jsx(Qc,{filter:r,onChange:b=>n({...t,targetFilter:{...r,...b}}),showOwner:!0,showPosition:!0,showFaceState:!0}),o.jsxs("div",{className:"filter-row",children:[o.jsxs("label",{children:["Calculation",o.jsxs("select",{value:r.calculation||"none",onChange:b=>{const x=b.target.value,j={...r};x==="none"?delete j.calculation:j.calculation=x,n({...t,targetFilter:j})},children:[o.jsx("option",{value:"none",children:"None"}),o.jsx("option",{value:"highest_value",children:"Highest value"}),o.jsx("option",{value:"lowest_value",children:"Lowest value"})]})]}),o.jsxs("label",{children:["Value Range",o.jsxs("select",{value:r.valueRange?`${r.valueRange.min}-${r.valueRange.max}`:"none",onChange:b=>{const x=b.target.value,j={...r};x==="none"?delete j.valueRange:x==="0-1"?j.valueRange={min:0,max:1}:x==="1-2"?j.valueRange={min:1,max:2}:x==="0-0"&&(j.valueRange={min:0,max:0}),n({...t,targetFilter:j})},children:[o.jsx("option",{value:"none",children:"Any value"}),o.jsx("option",{value:"0-0",children:"Value 0 only"}),o.jsx("option",{value:"0-1",children:"Values 0-1"}),o.jsx("option",{value:"1-2",children:"Values 1-2"})]})]}),o.jsxs("label",{children:["Value Source",o.jsxs("select",{value:r.valueSource||"none",onChange:b=>{const x=b.target.value,j={...r};x==="none"?delete j.valueSource:j.valueSource=x,n({...t,targetFilter:j})},children:[o.jsx("option",{value:"none",children:"None"}),o.jsx("option",{value:"previous_effect_card",children:"Previous effect card"})]})]})]})]}),o.jsx(Ht,{title:"Scope",forceOpen:c,children:o.jsxs("div",{className:"filter-row",children:[o.jsxs("label",{children:["Lane Scope",o.jsxs("select",{value:((y=t.scope)==null?void 0:y.type)||"any",onChange:b=>{const x=b.target.value;if(x==="any"){const{scope:j,...E}=t;n(E)}else n({...t,scope:{type:x}})},children:[o.jsx("option",{value:"any",children:"Any lane"}),o.jsx("option",{value:"this_line",children:"This lane only"}),o.jsx("option",{value:"other_lanes",children:"Other lanes"}),o.jsx("option",{value:"each_other_line",children:"Each other lane"}),o.jsx("option",{value:"each_lane",children:"Each lane"})]})]}),(((m=t.scope)==null?void 0:m.type)==="other_lanes"||((g=t.scope)==null?void 0:g.type)==="any")&&o.jsxs("label",{children:["Min Cards",o.jsxs("select",{value:((v=t.scope)==null?void 0:v.minCardsInLane)||0,onChange:b=>{const x=parseInt(b.target.value);if(x===0){const j={...t.scope};delete j.minCardsInLane,n({...t,scope:j})}else n({...t,scope:{...t.scope,minCardsInLane:x}})},children:[o.jsx("option",{value:0,children:"No minimum"}),o.jsx("option",{value:4,children:"4+ cards"}),o.jsx("option",{value:6,children:"6+ cards"}),o.jsx("option",{value:8,children:"8+ cards"})]})]}),o.jsxs("label",{children:["Who Chooses",o.jsxs("select",{value:t.actorChooses||"effect_owner",onChange:b=>{const x=b.target.value;if(x==="effect_owner"){const{actorChooses:j,...E}=t;n(E)}else n({...t,actorChooses:x})},children:[o.jsx("option",{value:"effect_owner",children:"Effect owner"}),o.jsx("option",{value:"card_owner",children:"Card owner (Plague-4)"})]})]})]})}),o.jsx(Ht,{title:"Lane Restriction",forceOpen:d,children:o.jsxs("div",{className:"filter-row",children:[o.jsxs("label",{children:["Lane Condition",o.jsxs("select",{value:((C=t.laneCondition)==null?void 0:C.type)||"none",onChange:b=>{const x=b.target.value;if(x==="none"){const{laneCondition:j,selectLane:E,...k}=t;n(k)}else n({...t,laneCondition:{type:x},selectLane:!0})},children:[o.jsx("option",{value:"none",children:"None"}),o.jsx("option",{value:"opponent_higher_value",children:"Opponent higher value"})]})]}),o.jsxs("label",{className:"checkbox-label",children:[o.jsx("input",{type:"checkbox",checked:t.selectLane||!1,onChange:b=>n({...t,selectLane:b.target.checked})}),"Select lane first"]})]})}),o.jsx(Xc,{conditional:t.advancedConditional,onChange:b=>{if(b)n({...t,advancedConditional:b});else{const{advancedConditional:x,...j}=t;n(j)}},availableTypes:["none","empty_hand","opponent_higher_value_in_lane","this_card_is_covered"]})]})},d_=({params:t,onChange:n})=>{const r=t.source||"hand",s=t.countType||"fixed",c=t.variableCount,d=r==="hand",u=t.random||t.discardTo==="opponent_trash"||s!=="fixed";return o.jsxs("div",{className:"param-editor discard-effect-editor",children:[o.jsx("h4",{children:"Discard Effect"}),o.jsxs("div",{className:"effect-editor-basic",children:[o.jsxs("label",{children:["Source",o.jsxs("select",{value:r,onChange:p=>n({...t,source:p.target.value}),children:[o.jsx("option",{value:"hand",children:"From Hand"}),o.jsx("option",{value:"top_deck_own",children:"Top of Own Deck"}),o.jsx("option",{value:"top_deck_opponent",children:"Top of Opponent's Deck"}),o.jsx("option",{value:"entire_deck",children:"Entire Deck"})]})]}),d&&o.jsxs(o.Fragment,{children:[o.jsxs("label",{children:["Actor",o.jsxs("select",{value:t.actor,onChange:p=>n({...t,actor:p.target.value}),children:[o.jsx("option",{value:"self",children:"Self"}),o.jsx("option",{value:"opponent",children:"Opponent"}),o.jsx("option",{value:"both",children:"Both"})]})]}),o.jsxs("label",{children:["Count",o.jsxs("select",{value:c?"variable":t.count==="all"?"all":t.count.toString(),onChange:p=>{const f=p.target.value;if(f==="variable")n({...t,variableCount:!0,count:1});else if(f==="all"){const{variableCount:h,...y}=t;n({...y,count:"all"})}else{const{variableCount:h,...y}=t;n({...y,count:parseInt(f)})}},children:[o.jsx("option",{value:"1",children:"1"}),o.jsx("option",{value:"2",children:"2"}),o.jsx("option",{value:"3",children:"3"}),o.jsx("option",{value:"all",children:"All (entire hand)"}),o.jsx("option",{value:"variable",children:"1 or more (variable)"})]})]})]})]}),!d&&o.jsx("small",{className:"hint-text",children:r==="entire_deck"?"Discards all cards from deck to trash automatically.":"Deck discard is automatic - no player choice needed. The discarded card's value is saved for follow-up effects."}),d&&o.jsxs(Ht,{title:"Advanced Options",forceOpen:u,children:[o.jsxs("div",{className:"filter-row",children:[o.jsxs("label",{children:["Count Type",o.jsxs("select",{value:s,onChange:p=>n({...t,countType:p.target.value}),children:[o.jsx("option",{value:"fixed",children:"Fixed Count"}),o.jsx("option",{value:"equal_to_discarded",children:"Equal to Previously Discarded (Plague-2)"})]})]}),s==="equal_to_discarded"&&o.jsxs("label",{children:["Offset",o.jsx("input",{type:"number",value:t.countOffset||0,onChange:p=>n({...t,countOffset:parseInt(p.target.value)}),min:"-5",max:"5"})]})]}),o.jsxs("div",{className:"filter-row",children:[t.actor==="opponent"&&o.jsxs("label",{className:"checkbox-label",children:[o.jsx("input",{type:"checkbox",checked:t.random||!1,onChange:p=>n({...t,random:p.target.checked})}),"Random selection",o.jsx("small",{className:"hint-text",children:"Opponent can't choose which card"})]}),o.jsxs("label",{children:["Discard to",o.jsxs("select",{value:t.discardTo||"own_trash",onChange:p=>n({...t,discardTo:p.target.value}),children:[o.jsx("option",{value:"own_trash",children:"Own trash"}),o.jsx("option",{value:"opponent_trash",children:"Opponent's trash"})]})]})]})]})]})},u_=({params:t,onChange:n})=>{var m,g,v,C;const r=((m=t.targetFilter)==null?void 0:m.owner)||"any",s=((g=t.targetFilter)==null?void 0:g.position)||"uncovered",c=((v=t.targetFilter)==null?void 0:v.faceState)||"any",d=(C=t.targetFilter)==null?void 0:C.valueEquals,u=t.selectLane||!1,p=t.destination||"owner_hand",f=r!=="any"||s!=="uncovered"||c!=="any"||d!==void 0,h=t.returnSelf||u,y=b=>{n({...t,targetFilter:{...t.targetFilter,...b}})};return o.jsxs("div",{className:"param-editor return-effect-editor",children:[o.jsx("h4",{children:"Return Effect"}),o.jsxs("div",{className:"effect-editor-basic",children:[o.jsxs("label",{children:["Count",o.jsxs("select",{value:typeof t.count=="number"?t.count.toString():"all",onChange:b=>n({...t,count:b.target.value==="all"?"all":parseInt(b.target.value)}),children:[o.jsx("option",{value:"1",children:"1"}),o.jsx("option",{value:"2",children:"2"}),o.jsx("option",{value:"all",children:"All"})]})]}),r==="opponent"&&o.jsxs("label",{children:["Destination",o.jsxs("select",{value:p,onChange:b=>n({...t,destination:b.target.value}),children:[o.jsx("option",{value:"owner_hand",children:"Owner's hand"}),o.jsx("option",{value:"actor_hand",children:"Your hand (steal)"})]})]})]}),o.jsxs(Ht,{title:"Target Filter",forceOpen:f,children:[o.jsx("div",{className:"filter-row",children:o.jsx(Qc,{filter:t.targetFilter||{},onChange:y,showOwner:!0,showPosition:!0,showFaceState:!0})}),o.jsxs("div",{className:"filter-row",children:[o.jsxs("label",{className:"checkbox-label",children:[o.jsx("input",{type:"checkbox",checked:d!==void 0,onChange:b=>{if(b.target.checked)n({...t,targetFilter:{...t.targetFilter,valueEquals:2}});else{const{valueEquals:x,...j}=t.targetFilter||{};n({...t,targetFilter:j})}}}),"Filter by value"]}),d!==void 0&&o.jsxs("label",{children:["Value",o.jsx("select",{value:d,onChange:b=>n({...t,targetFilter:{...t.targetFilter,valueEquals:parseInt(b.target.value)}}),children:[0,1,2,3,4,5,6].map(b=>o.jsx("option",{value:b,children:b},b))})]})]})]}),o.jsx(Ht,{title:"Advanced Options",forceOpen:h,children:o.jsxs("div",{className:"filter-row",children:[o.jsxs("label",{className:"checkbox-label",children:[o.jsx("input",{type:"checkbox",checked:u,onChange:b=>{if(b.target.checked)n({...t,selectLane:!0});else{const{selectLane:x,...j}=t;n(j)}}}),"Select lane first",o.jsx("small",{className:"hint-text",children:'Water-3: "in 1 line"'})]}),o.jsxs("label",{className:"checkbox-label",children:[o.jsx("input",{type:"checkbox",checked:t.returnSelf||!1,onChange:b=>{if(b.target.checked)n({...t,returnSelf:!0});else{const{returnSelf:x,optional:j,...E}=t;n(E)}}}),"Return this card"]}),t.returnSelf&&o.jsxs("label",{className:"checkbox-label",children:[o.jsx("input",{type:"checkbox",checked:t.optional||!1,onChange:b=>n({...t,optional:b.target.checked})}),"Optional"]})]})}),o.jsx(Xc,{conditional:t.advancedConditional,onChange:b=>{if(b)n({...t,advancedConditional:b});else{const{advancedConditional:x,...j}=t;n(j)}},availableTypes:["none","empty_hand","opponent_higher_value_in_lane","this_card_is_covered"]})]})},p_=({params:t,onChange:n})=>{var u,p,f,h;const r=t.destinationRule||{type:"other_lines"},s=r.type!=="other_lines"||r.cardFilter,c=((u=t.condition)==null?void 0:u.type)&&t.condition.type!=="none",d=t.sourceOwner==="opponent"||t.targetBoard==="opponent";return o.jsxs("div",{className:"param-editor play-effect-editor",children:[o.jsx("h4",{children:"Play Effect"}),o.jsxs("div",{className:"effect-editor-basic",children:[o.jsxs("label",{children:["Actor",o.jsxs("select",{value:t.actor||"self",onChange:y=>{if(y.target.value==="self"){const{actor:m,...g}=t;n(g)}else n({...t,actor:y.target.value})},children:[o.jsx("option",{value:"self",children:"You"}),o.jsx("option",{value:"opponent",children:"Opponent"})]})]}),o.jsxs("label",{children:["Source",o.jsxs("select",{value:t.source,onChange:y=>n({...t,source:y.target.value}),children:[o.jsx("option",{value:"hand",children:"Hand"}),o.jsx("option",{value:"deck",children:"Deck"}),o.jsx("option",{value:"trash",children:"Trash"})]})]}),o.jsxs("label",{children:["Count",o.jsx("select",{value:t.count,onChange:y=>n({...t,count:parseInt(y.target.value)||1}),children:[1,2,3,4,5,6].map(y=>o.jsx("option",{value:y,children:y},y))})]}),o.jsxs("label",{children:["Orientation",o.jsxs("select",{value:t.faceDown===void 0?"choice":t.faceDown?"down":"up",onChange:y=>{const m=y.target.value;if(m==="choice"){const{faceDown:g,...v}=t;n(v)}else n({...t,faceDown:m==="down"})},children:[o.jsx("option",{value:"up",children:"Face-up"}),o.jsx("option",{value:"down",children:"Face-down"}),o.jsx("option",{value:"choice",children:"Player Chooses"})]})]})]}),o.jsx(Ht,{title:"Destination",forceOpen:s,children:o.jsxs("div",{className:"filter-row",children:[o.jsxs("label",{children:["Destination Rule",o.jsxs("select",{value:r.type,onChange:y=>n({...t,destinationRule:{...r,type:y.target.value}}),children:[o.jsx("option",{value:"other_lines",children:"Other lines"}),o.jsx("option",{value:"each_other_line",children:"Each other line"}),o.jsx("option",{value:"specific_lane",children:"This lane"}),o.jsx("option",{value:"each_line_with_card",children:"Each line with card"}),o.jsx("option",{value:"line_with_matching_cards",children:"Line with matching cards"}),o.jsx("option",{value:"under_this_card",children:"Under this card"})]})]}),(r.type==="each_line_with_card"||r.type==="line_with_matching_cards")&&o.jsxs("label",{children:["Card Filter",o.jsxs("select",{value:((p=r.cardFilter)==null?void 0:p.faceState)||"any",onChange:y=>{const m=y.target.value;if(m==="any"){const{cardFilter:g,...v}=r;n({...t,destinationRule:v})}else n({...t,destinationRule:{...r,cardFilter:{faceState:m}}})},children:[o.jsx("option",{value:"any",children:"Any card"}),o.jsx("option",{value:"face_down",children:"Face-down only"}),o.jsx("option",{value:"face_up",children:"Face-up only"})]})]})]})}),o.jsx(Ht,{title:"Advanced Options",forceOpen:d,children:o.jsxs("div",{className:"filter-row",children:[(t.source==="deck"||t.source==="trash")&&o.jsxs("label",{children:["Source Owner",o.jsxs("select",{value:t.sourceOwner||"own",onChange:y=>n({...t,sourceOwner:y.target.value}),children:[o.jsxs("option",{value:"own",children:["Own ",t.source]}),o.jsxs("option",{value:"opponent",children:["Opponent's ",t.source]})]})]}),o.jsxs("label",{children:["Target Board",o.jsxs("select",{value:t.targetBoard||"own",onChange:y=>n({...t,targetBoard:y.target.value}),children:[o.jsx("option",{value:"own",children:"Own board"}),o.jsx("option",{value:"opponent",children:"Opponent's board"})]})]})]})}),o.jsx(Ht,{title:"Condition",forceOpen:c,children:o.jsxs("div",{className:"filter-row",children:[o.jsxs("label",{children:["Play Condition",o.jsxs("select",{value:((f=t.condition)==null?void 0:f.type)||"none",onChange:y=>{const m=y.target.value;if(m==="none"){const{condition:g,...v}=t;n(v)}else n(m==="per_x_cards_in_line"?{...t,condition:{type:m,cardCount:2}}:{...t,condition:{type:m}})},children:[o.jsx("option",{value:"none",children:"None"}),o.jsx("option",{value:"per_x_cards_in_line",children:"For every X cards"}),o.jsx("option",{value:"only_in_lines_with_cards",children:"Only in lines with cards"})]})]}),((h=t.condition)==null?void 0:h.type)==="per_x_cards_in_line"&&o.jsxs("label",{children:["Cards per Play",o.jsx("select",{value:t.condition.cardCount||2,onChange:y=>n({...t,condition:{...t.condition,cardCount:parseInt(y.target.value)||2}}),children:[1,2,3,4,5,6].map(y=>o.jsx("option",{value:y,children:y},y))})]})]})}),o.jsx(Xc,{conditional:t.advancedConditional,onChange:y=>{if(y)n({...t,advancedConditional:y});else{const{advancedConditional:m,...g}=t;n(g)}},availableTypes:["none","empty_hand","opponent_higher_value_in_lane"]})]})},f_=({params:t,onChange:n})=>{const r=!!t.restriction;return o.jsxs("div",{className:"param-editor protocol-effect-editor",children:[o.jsx("h4",{children:"Protocol Effect"}),o.jsxs("div",{className:"effect-editor-basic",children:[o.jsxs("label",{children:["Action",o.jsxs("select",{value:t.action,onChange:s=>n({...t,action:s.target.value}),children:[o.jsx("option",{value:"rearrange_protocols",children:"Rearrange"}),o.jsx("option",{value:"swap_protocols",children:"Swap"})]})]}),o.jsxs("label",{children:["Target",o.jsxs("select",{value:t.target,onChange:s=>n({...t,target:s.target.value}),children:[o.jsx("option",{value:"own",children:"Own"}),o.jsx("option",{value:"opponent",children:"Opponent"}),o.jsx("option",{value:"both_sequential",children:"Both (sequential)"})]})]})]}),o.jsxs(Ht,{title:"Restriction (Anarchy-3)",forceOpen:r,children:[o.jsxs("label",{className:"checkbox-label",children:[o.jsx("input",{type:"checkbox",checked:r,onChange:s=>{if(s.target.checked)n({...t,restriction:{disallowedProtocol:"",laneIndex:"current"}});else{const{restriction:c,...d}=t;n(d)}}}),"Protocol cannot be on specific lane"]}),r&&o.jsxs("div",{className:"filter-row",children:[o.jsxs("label",{children:["Disallowed Protocol",o.jsx("input",{type:"text",value:t.restriction.disallowedProtocol,onChange:s=>n({...t,restriction:{...t.restriction,disallowedProtocol:s.target.value}}),placeholder:"e.g., Anarchy, Fire"})]}),o.jsxs("label",{children:["Lane",o.jsxs("select",{value:t.restriction.laneIndex,onChange:s=>n({...t,restriction:{...t.restriction,laneIndex:s.target.value==="current"?"current":parseInt(s.target.value)}}),children:[o.jsx("option",{value:"current",children:"Current lane"}),o.jsx("option",{value:"0",children:"Lane 1 (Left)"}),o.jsx("option",{value:"1",children:"Lane 2 (Middle)"}),o.jsx("option",{value:"2",children:"Lane 3 (Right)"})]})]})]})]})]})},h_=({params:t,onChange:n})=>{var u;const r=t.source==="own_hand"||t.source==="opponent_hand"||t.source==="board"||t.source==="own_trash",s=t.source==="board",c=t.source==="own_hand"&&t.action==="reveal",d=((u=t.protocolFilter)==null?void 0:u.type)==="same_as_source";return o.jsxs("div",{className:"param-editor reveal-effect-editor",children:[o.jsx("h4",{children:"Reveal/Give Effect"}),o.jsxs("div",{className:"effect-editor-basic",children:[o.jsxs("label",{children:["Action",o.jsxs("select",{value:t.action,onChange:p=>n({...t,action:p.target.value}),children:[o.jsx("option",{value:"reveal",children:"Reveal"}),o.jsx("option",{value:"give",children:"Give"})]})]}),o.jsxs("label",{children:["Source",o.jsxs("select",{value:t.source,onChange:p=>n({...t,source:p.target.value}),children:[o.jsx("option",{value:"own_hand",children:"Your hand"}),o.jsx("option",{value:"opponent_hand",children:"Opponent's hand"}),o.jsx("option",{value:"own_deck_top",children:"Top of your deck"}),o.jsx("option",{value:"own_deck",children:"Your entire deck"}),o.jsx("option",{value:"own_trash",children:"Your trash"}),o.jsx("option",{value:"board",children:"Board card"})]})]}),r&&o.jsxs("label",{children:["Count",o.jsx("select",{value:t.count||1,onChange:p=>n({...t,count:parseInt(p.target.value)}),children:[1,2,3,4,5,6].map(p=>o.jsx("option",{value:p,children:p},p))})]}),s&&o.jsxs("label",{children:["Follow-up",o.jsxs("select",{value:t.followUpAction||"none",onChange:p=>{if(p.target.value==="none"){const{followUpAction:f,...h}=t;n(h)}else n({...t,followUpAction:p.target.value})},children:[o.jsx("option",{value:"none",children:"None"}),o.jsx("option",{value:"flip",children:"Then flip"}),o.jsx("option",{value:"shift",children:"Then shift"})]})]})]}),c&&o.jsxs(Ht,{title:"Special Options",forceOpen:d,children:[o.jsxs("label",{className:"checkbox-label",children:[o.jsx("input",{type:"checkbox",checked:d,onChange:p=>{if(p.target.checked)n({...t,protocolFilter:{type:"same_as_source"}});else{const{protocolFilter:f,...h}=t;n(h)}}}),"Reveal all same-protocol cards (Unity-0)"]}),o.jsx("small",{className:"hint-text",children:"Reveals all cards in hand that match this card's protocol."})]})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const m_=({params:t,onChange:n})=>o.jsxs("div",{className:"param-editor take-effect-editor",children:[o.jsx("h4",{children:"Take Effect"}),o.jsxs("div",{className:"effect-editor-basic",children:[o.jsxs("label",{children:["Count",o.jsx("select",{value:t.count||1,onChange:r=>n({...t,count:parseInt(r.target.value)}),children:[1,2,3,4,5,6].map(r=>o.jsx("option",{value:r,children:r},r))})]}),o.jsxs("label",{children:["Source",o.jsx("select",{value:t.source,onChange:r=>n({...t,source:r.target.value}),children:o.jsx("option",{value:"opponent_hand",children:"Opponent's Hand"})})]}),o.jsxs("label",{className:"checkbox-label",children:[o.jsx("input",{type:"checkbox",checked:t.random,onChange:r=>n({...t,random:r.target.checked})}),"Random",o.jsx("small",{className:"hint-text",children:"If unchecked, you choose"})]})]})]}),Ic=t=>{switch(t){case"draw":return{action:"draw",count:1,target:"self",source:"own_deck"};case"flip":return{action:"flip",count:1,targetFilter:{owner:"any",position:"any",faceState:"any",excludeSelf:!1},optional:!1};case"shift":return{action:"shift",targetFilter:{owner:"any",position:"any",faceState:"any"},destinationRestriction:{type:"any"}};case"delete":return{action:"delete",count:1,targetFilter:{position:"any",faceState:"any"},scope:{type:"anywhere"},excludeSelf:!1};case"discard":return{action:"discard",count:1,actor:"self"};case"return":return{action:"return",count:1,targetFilter:{},scope:{type:"any_card"}};case"play":return{action:"play",source:"hand",count:1,faceDown:!1,destinationRule:{type:"other_lines"}};case"rearrange_protocols":return{action:"rearrange_protocols",target:"own"};case"swap_protocols":return{action:"swap_protocols",target:"own"};case"reveal":case"give":return{action:t,source:"own_hand",count:1};case"take":return{action:"take",source:"opponent_hand",count:1,random:!0};default:return{}}},Qk=({params:t,onChange:n})=>{const[r,s]=J.useState(""),[c,d]=J.useState(""),[u,p]=J.useState(null),f=t.options||[],h=f[0],y=f[1],m=()=>{if(!r)return;const R={id:pt(),params:Ic(r),position:"middle",trigger:"on_play"};n({...t,options:[R,y].filter(Boolean)}),s(""),p(1)},g=()=>{if(!c)return;const R={id:pt(),params:Ic(c),position:"middle",trigger:"on_play"};n({...t,options:[h,R].filter(Boolean)}),d(""),p(2)},v=()=>{n({...t,options:[y].filter(Boolean)}),u===1&&p(null)},C=()=>{n({...t,options:[h].filter(Boolean)}),u===2&&p(null)},b=R=>{const D={...h,params:R};n({...t,options:[D,y].filter(Boolean)})},x=R=>{const D={...y,params:R};n({...t,options:[h,D].filter(Boolean)})},j=R=>{const D=Ic(R),L={...h,params:D};n({...t,options:[L,y].filter(Boolean)})},E=R=>{const D=Ic(R),L={...y,params:D};n({...t,options:[h,L].filter(Boolean)})},k=(R,D)=>{switch(R.params.action){case"draw":return o.jsx(l_,{params:R.params,onChange:D});case"flip":return o.jsx(s_,{params:R.params,onChange:D});case"shift":return o.jsx(c_,{params:R.params,onChange:D});case"delete":return o.jsx(i_,{params:R.params,onChange:D});case"discard":return o.jsx(d_,{params:R.params,onChange:D});case"return":return o.jsx(u_,{params:R.params,onChange:D});case"play":return o.jsx(p_,{params:R.params,onChange:D});case"rearrange_protocols":case"swap_protocols":return o.jsx(f_,{params:R.params,onChange:D});case"reveal":case"give":return o.jsx(h_,{params:R.params,onChange:D});case"take":return o.jsx(m_,{params:R.params,onChange:D});default:return o.jsx("div",{children:"Unknown effect type"})}};return o.jsxs("div",{className:"param-editor choice-effect-editor",children:[o.jsx("h4",{children:"Either/Or Choice"}),o.jsx("small",{className:"hint-text",children:"Player chooses one of two options during gameplay."}),o.jsxs("div",{className:"choice-option-container",children:[o.jsx("label",{className:"choice-option-header",children:"Option 1:"}),h?o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"choice-option-row",children:[o.jsxs("select",{className:"choice-action-select",value:h.params.action,onChange:R=>j(R.target.value),children:[o.jsx("option",{value:"draw",children:"Draw Cards"}),o.jsx("option",{value:"flip",children:"Flip Cards"}),o.jsx("option",{value:"shift",children:"Shift Card"}),o.jsx("option",{value:"delete",children:"Delete Cards"}),o.jsx("option",{value:"discard",children:"Discard Cards"}),o.jsx("option",{value:"return",children:"Return to Hand"}),o.jsx("option",{value:"play",children:"Play from Hand/Deck"})]}),o.jsx("button",{className:`choice-btn ${u===1?"choice-btn-active":"choice-btn-edit"}`,onClick:()=>p(u===1?null:1),children:u===1?"Hide":"Edit"}),o.jsx("button",{className:"choice-btn choice-btn-remove",onClick:v,children:"Remove"})]}),u===1&&o.jsx("div",{className:"choice-option-editor",children:k(h,b)})]}):o.jsxs("div",{className:"choice-option-row",children:[o.jsxs("select",{className:"choice-action-select",value:r,onChange:R=>s(R.target.value),children:[o.jsx("option",{value:"",children:"Choose Action"}),o.jsx("option",{value:"draw",children:"Draw Cards"}),o.jsx("option",{value:"flip",children:"Flip Cards"}),o.jsx("option",{value:"shift",children:"Shift Card"}),o.jsx("option",{value:"delete",children:"Delete Cards"}),o.jsx("option",{value:"discard",children:"Discard Cards"}),o.jsx("option",{value:"return",children:"Return to Hand"}),o.jsx("option",{value:"play",children:"Play from Hand/Deck"})]}),o.jsx("button",{className:`choice-btn ${r?"choice-btn-add":"choice-btn-disabled"}`,onClick:m,disabled:!r,children:"Add"})]})]}),o.jsxs("div",{className:"choice-option-container",children:[o.jsx("label",{className:"choice-option-header",children:"Option 2:"}),y?o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"choice-option-row",children:[o.jsxs("select",{className:"choice-action-select",value:y.params.action,onChange:R=>E(R.target.value),children:[o.jsx("option",{value:"draw",children:"Draw Cards"}),o.jsx("option",{value:"flip",children:"Flip Cards"}),o.jsx("option",{value:"shift",children:"Shift Card"}),o.jsx("option",{value:"delete",children:"Delete Cards"}),o.jsx("option",{value:"discard",children:"Discard Cards"}),o.jsx("option",{value:"return",children:"Return to Hand"}),o.jsx("option",{value:"play",children:"Play from Hand/Deck"})]}),o.jsx("button",{className:`choice-btn ${u===2?"choice-btn-active":"choice-btn-edit"}`,onClick:()=>p(u===2?null:2),children:u===2?"Hide":"Edit"}),o.jsx("button",{className:"choice-btn choice-btn-remove",onClick:C,children:"Remove"})]}),u===2&&o.jsx("div",{className:"choice-option-editor",children:k(y,x)})]}):o.jsxs("div",{className:"choice-option-row",children:[o.jsxs("select",{className:"choice-action-select",value:c,onChange:R=>d(R.target.value),children:[o.jsx("option",{value:"",children:"Choose Action"}),o.jsx("option",{value:"draw",children:"Draw Cards"}),o.jsx("option",{value:"flip",children:"Flip Cards"}),o.jsx("option",{value:"shift",children:"Shift Card"}),o.jsx("option",{value:"delete",children:"Delete Cards"}),o.jsx("option",{value:"discard",children:"Discard Cards"}),o.jsx("option",{value:"return",children:"Return to Hand"}),o.jsx("option",{value:"play",children:"Play from Hand/Deck"})]}),o.jsx("button",{className:`choice-btn ${c?"choice-btn-add":"choice-btn-disabled"}`,onClick:g,disabled:!c,children:"Add"})]})]}),f.length===2&&o.jsx("div",{className:"choice-complete-notice",children:"Both options configured. Player will choose one during gameplay."})]})},Xk=({params:t,onChange:n})=>{var y,m,g,v,C,b;const r=((y=t.rule)==null?void 0:y.type)||"block_all_play",s=((m=t.rule)==null?void 0:m.target)||"opponent",c=((g=t.rule)==null?void 0:g.scope)||"this_lane",d=((v=t.rule)==null?void 0:v.onlyDuringYourTurn)||!1,u=((C=t.rule)==null?void 0:C.conditionTarget)||"self",p=((b=t.rule)==null?void 0:b.blockTarget)||"self",f=r==="block_draw_conditional",h=r==="ignore_middle_commands"&&d;return o.jsxs("div",{className:"param-editor passive-rule-editor",children:[o.jsx("h4",{children:"Passive Rule"}),o.jsx("small",{className:"hint-text",children:"Active while card is face-up. Modifies game behavior."}),o.jsxs("div",{className:"effect-editor-basic",children:[o.jsxs("label",{children:["Rule Type",o.jsxs("select",{value:r,onChange:x=>n({...t,rule:{...t.rule,type:x.target.value,target:s,scope:c}}),children:[o.jsxs("optgroup",{label:"Play Restrictions",children:[o.jsx("option",{value:"block_face_down_play",children:"Block Face-Down"}),o.jsx("option",{value:"block_face_up_play",children:"Block Face-Up"}),o.jsx("option",{value:"block_all_play",children:"Block All"}),o.jsx("option",{value:"require_face_down_play",children:"Require Face-Down"})]}),o.jsxs("optgroup",{label:"Protocol Matching",children:[o.jsx("option",{value:"allow_any_protocol_play",children:"Allow Any Protocol"}),o.jsx("option",{value:"allow_play_on_opponent_side",children:"Allow Opponent Side"}),o.jsx("option",{value:"allow_same_protocol_face_up_play",children:"Same Protocol Face-Up"}),o.jsx("option",{value:"require_non_matching_protocol",children:"Non-Matching Only"})]}),o.jsxs("optgroup",{label:"Action Blocks",children:[o.jsx("option",{value:"block_flips",children:"Block Flips"}),o.jsx("option",{value:"block_protocol_rearrange",children:"Block Rearrange"}),o.jsx("option",{value:"block_shifts_from_lane",children:"Block Shift From"}),o.jsx("option",{value:"block_shifts_to_lane",children:"Block Shift To"}),o.jsx("option",{value:"block_flip_this_card",children:"Can't Flip This Card"})]}),o.jsxs("optgroup",{label:"Other",children:[o.jsx("option",{value:"block_draw_conditional",children:"Conditional Draw Block"}),o.jsx("option",{value:"ignore_middle_commands",children:"Ignore Middle Commands"}),o.jsx("option",{value:"skip_check_cache_phase",children:"Skip Check Cache"})]})]})]}),o.jsxs("label",{children:["Target",o.jsxs("select",{value:s,onChange:x=>n({...t,rule:{...t.rule,type:r,target:x.target.value,scope:c}}),children:[o.jsx("option",{value:"self",children:"Self"}),o.jsx("option",{value:"opponent",children:"Opponent"}),o.jsx("option",{value:"all",children:"All"})]})]}),o.jsxs("label",{children:["Scope",o.jsxs("select",{value:c,onChange:x=>n({...t,rule:{...t.rule,type:r,target:s,scope:x.target.value,onlyDuringYourTurn:d}}),children:[o.jsx("option",{value:"this_lane",children:"This Lane"}),o.jsx("option",{value:"global",children:"Global"})]})]})]}),r==="block_draw_conditional"&&o.jsx(Ht,{title:"Draw Block Settings",forceOpen:f,children:o.jsxs("div",{className:"filter-row",children:[o.jsxs("label",{children:["Condition (who must have cards)",o.jsxs("select",{value:u,onChange:x=>n({...t,rule:{...t.rule,type:r,target:"this_card",scope:"global",conditionTarget:x.target.value,blockTarget:p}}),children:[o.jsx("option",{value:"self",children:"Card owner"}),o.jsx("option",{value:"opponent",children:"Opponent"})]})]}),o.jsxs("label",{children:["Block Target (who can't draw)",o.jsxs("select",{value:p,onChange:x=>n({...t,rule:{...t.rule,type:r,target:"this_card",scope:"global",conditionTarget:u,blockTarget:x.target.value}}),children:[o.jsx("option",{value:"self",children:"Card owner"}),o.jsx("option",{value:"opponent",children:"Opponent"}),o.jsx("option",{value:"all",children:"Both"})]})]})]})}),r==="ignore_middle_commands"&&o.jsx(Ht,{title:"Timing",forceOpen:h,children:o.jsxs("label",{className:"checkbox-label",children:[o.jsx("input",{type:"checkbox",checked:d,onChange:x=>n({...t,rule:{...t.rule,type:r,target:s,scope:c,onlyDuringYourTurn:x.target.checked}})}),"Only during your turn"]})})]})},Zk=({params:t,onChange:n})=>{var v,C,b,x,j,E,k,R,D;const r=((v=t.modifier)==null?void 0:v.type)||"add_per_condition",s=((C=t.modifier)==null?void 0:C.value)||1,c=((b=t.modifier)==null?void 0:b.condition)||"per_face_down_card",d=((x=t.modifier)==null?void 0:x.target)||"own_total",u=((j=t.modifier)==null?void 0:j.scope)||"this_lane",p=((k=(E=t.modifier)==null?void 0:E.filter)==null?void 0:k.faceState)||"face_down",f=((D=(R=t.modifier)==null?void 0:R.filter)==null?void 0:D.position)||"any",h=r==="add_per_condition",y=r==="set_to_fixed"&&(d==="own_cards"||d==="opponent_cards"||d==="all_cards"),m=y&&(p!=="face_down"||f!=="any"),g=L=>{n({...t,modifier:{...t.modifier,type:r,value:s,condition:h?c:void 0,target:d,scope:u,filter:y?{faceState:p,position:f}:void 0,...L}})};return o.jsxs("div",{className:"param-editor value-modifier-editor",children:[o.jsx("h4",{children:"Value Modifier"}),o.jsx("small",{className:"hint-text",children:"Active while card is face-up. Modifies card values or lane totals."}),o.jsxs("div",{className:"effect-editor-basic",children:[o.jsxs("label",{children:["Type",o.jsxs("select",{value:r,onChange:L=>g({type:L.target.value}),children:[o.jsx("option",{value:"add_per_condition",children:"Add Per Condition"}),o.jsx("option",{value:"set_to_fixed",children:"Set To Fixed Value"}),o.jsx("option",{value:"add_to_total",children:"Add To Total"})]})]}),o.jsxs("label",{children:["Value",o.jsx("input",{type:"number",value:s,onChange:L=>g({value:parseInt(L.target.value)||0})})]}),h&&o.jsxs("label",{children:["Condition",o.jsxs("select",{value:c,onChange:L=>g({condition:L.target.value}),children:[o.jsx("option",{value:"per_face_down_card",children:"Per Face-Down"}),o.jsx("option",{value:"per_face_up_card",children:"Per Face-Up"}),o.jsx("option",{value:"per_card",children:"Per Card (any)"}),o.jsx("option",{value:"per_card_in_hand",children:"Per Hand Card"}),o.jsx("option",{value:"per_opponent_card_in_lane",children:"Per Opp. Card"})]})]})]}),o.jsx(Ht,{title:"Target & Scope",forceOpen:d!=="own_total"||u!=="this_lane",children:o.jsxs("div",{className:"filter-row",children:[o.jsxs("label",{children:["Target",o.jsxs("select",{value:d,onChange:L=>g({target:L.target.value}),children:[o.jsxs("optgroup",{label:"Card Values",children:[o.jsx("option",{value:"own_cards",children:"Own Cards"}),o.jsx("option",{value:"opponent_cards",children:"Opponent Cards"}),o.jsx("option",{value:"all_cards",children:"All Cards"})]}),o.jsxs("optgroup",{label:"Lane Totals",children:[o.jsx("option",{value:"own_total",children:"Own Total"}),o.jsx("option",{value:"opponent_total",children:"Opponent Total"})]})]})]}),o.jsxs("label",{children:["Scope",o.jsxs("select",{value:u,onChange:L=>g({scope:L.target.value}),children:[o.jsx("option",{value:"this_lane",children:"This Lane"}),o.jsx("option",{value:"global",children:"Global"})]})]})]})}),y&&o.jsx(Ht,{title:"Card Filter",forceOpen:m,children:o.jsxs("div",{className:"filter-row",children:[o.jsxs("label",{children:["Face State",o.jsxs("select",{value:p,onChange:L=>g({filter:{faceState:L.target.value,position:f}}),children:[o.jsx("option",{value:"face_down",children:"Face-Down"}),o.jsx("option",{value:"face_up",children:"Face-Up"}),o.jsx("option",{value:"any",children:"Any"})]})]}),o.jsxs("label",{children:["Position",o.jsxs("select",{value:f,onChange:L=>g({filter:{faceState:p,position:L.target.value}}),children:[o.jsx("option",{value:"any",children:"Any"}),o.jsx("option",{value:"covered",children:"Covered"}),o.jsx("option",{value:"uncovered",children:"Uncovered"})]})]})]})})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Kk=({params:t,onChange:n})=>o.jsxs("div",{className:"param-editor block-compile-effect-editor",children:[o.jsx("h4",{children:"Block Compile Effect"}),o.jsx("div",{className:"effect-editor-basic",children:o.jsxs("label",{children:["Target",o.jsxs("select",{value:t.target||"opponent",onChange:r=>n({...t,target:r.target.value}),children:[o.jsx("option",{value:"opponent",children:"Opponent cannot compile next turn"}),o.jsx("option",{value:"self",children:"You cannot compile next turn"})]})]})})]});/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Jk=({params:t,onChange:n})=>{var s;const r=((s=t.laneCondition)==null?void 0:s.count)||8;return o.jsxs("div",{className:"param-editor delete-all-in-lane-effect-editor",children:[o.jsx("h4",{children:"Delete All In Lane Effect"}),o.jsxs("div",{className:"effect-editor-basic",children:[o.jsxs("label",{children:["Minimum cards in lane",o.jsxs("select",{value:r,onChange:c=>n({...t,laneCondition:{type:"min_cards",count:parseInt(c.target.value)}}),children:[o.jsx("option",{value:0,children:"No minimum (any lane)"}),o.jsx("option",{value:4,children:"4 or more cards"}),o.jsx("option",{value:6,children:"6 or more cards"}),o.jsx("option",{value:8,children:"8 or more cards (Metal-3)"}),o.jsx("option",{value:10,children:"10 or more cards"})]})]}),o.jsxs("label",{className:"checkbox-label",children:[o.jsx("input",{type:"checkbox",checked:t.excludeCurrentLane!==!1,onChange:c=>n({...t,excludeCurrentLane:c.target.checked})}),"Exclude current lane",o.jsx("small",{className:"hint-text",children:"Other lanes only"})]})]})]})},e2=({params:t,onChange:n})=>{var s;const r=((s=t.advancedConditional)==null?void 0:s.type)==="trash_not_empty";return o.jsxs("div",{className:"param-editor shuffle-trash-effect-editor",children:[o.jsx("h4",{children:"Shuffle Trash Effect"}),o.jsx("small",{className:"hint-text",children:"Shuffle your trash (discarded/deleted cards) back into your deck."}),o.jsx("div",{className:"effect-editor-basic",children:o.jsxs("label",{className:"checkbox-label",children:[o.jsx("input",{type:"checkbox",checked:t.optional!==!1,onChange:c=>n({...t,optional:c.target.checked})}),'Optional ("You may shuffle...")']})}),o.jsxs(Ht,{title:"Conditionals",forceOpen:r,children:[o.jsxs("label",{className:"checkbox-label",children:[o.jsx("input",{type:"checkbox",checked:r,onChange:c=>{if(c.target.checked)n({...t,advancedConditional:{type:"trash_not_empty"}});else{const{advancedConditional:d,...u}=t;n(u)}}}),"Only if trash is not empty"]}),o.jsx("small",{className:"hint-text",children:'"If there are any cards in your trash..."'})]})]})},t2=()=>o.jsxs("div",{className:"param-editor shuffle-deck-effect-editor",children:[o.jsx("h4",{children:"Shuffle Deck Effect"}),o.jsx("small",{className:"hint-text",children:"Shuffle your deck. Typically used after revealing the deck."}),o.jsx("p",{className:"hint-text",children:"No additional parameters required."})]});/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const n2=({params:t,onChange:n})=>o.jsxs("div",{className:"param-editor state-number-effect-editor",children:[o.jsx("h4",{children:"State Number Effect"}),o.jsx("small",{className:"hint-text",children:"Player chooses a number from the available protocol card values. The stated number is stored for subsequent effects."}),o.jsx("div",{className:"effect-editor-basic",children:o.jsxs("label",{children:["Number Source",o.jsx("select",{value:t.numberSource||"own_protocol_values",onChange:r=>n({...t,numberSource:r.target.value}),children:o.jsx("option",{value:"own_protocol_values",children:"Own Protocol Values (0-5)"})})]})})]});/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const a2=({params:t,onChange:n})=>o.jsxs("div",{className:"param-editor state-protocol-effect-editor",children:[o.jsx("h4",{children:"State Protocol Effect"}),o.jsx("small",{className:"hint-text",children:"Player chooses a protocol from the opponent's unique protocols. The stated protocol is stored for subsequent effects (e.g., matching conditionals)."}),o.jsx("div",{className:"effect-editor-basic",children:o.jsxs("label",{children:["Protocol Source",o.jsx("select",{value:t.protocolSource||"opponent_cards",onChange:r=>n({...t,protocolSource:r.target.value}),children:o.jsx("option",{value:"opponent_cards",children:"Opponent's Cards (unique protocols)"})})]})})]}),$c=t=>{switch(t){case"draw":return{action:"draw",count:1,target:"self",source:"own_deck"};case"refresh":return{action:"refresh",target:"self"};case"mutual_draw":return{action:"mutual_draw",count:1};case"flip":return{action:"flip",count:1,targetFilter:{owner:"any",position:"any",faceState:"any",excludeSelf:!1},optional:!1};case"shift":return{action:"shift",targetFilter:{owner:"any",position:"any",faceState:"any"},destinationRestriction:{type:"any"}};case"delete":return{action:"delete",count:1,targetFilter:{position:"any",faceState:"any"},scope:{type:"anywhere"},excludeSelf:!1};case"discard":return{action:"discard",count:1,actor:"self"};case"return":return{action:"return",count:1,targetFilter:{},scope:{type:"any_card"}};case"play":return{action:"play",source:"hand",count:1,faceDown:!1,destinationRule:{type:"other_lines"}};case"rearrange_protocols":return{action:"rearrange_protocols",target:"own"};case"swap_protocols":return{action:"swap_protocols",target:"own"};case"reveal":case"give":return{action:t,source:"own_hand",count:1};case"take":return{action:"take",source:"opponent_hand",count:1,random:!0};case"choice":return{action:"choice",options:[]};case"passive_rule":return{action:"passive_rule",rule:{type:"block_all_play",target:"opponent",scope:"this_lane"}};case"value_modifier":return{action:"value_modifier",modifier:{type:"add_per_condition",value:1,condition:"per_face_down_card",target:"own_total",scope:"this_lane"}};case"block_compile":return{action:"block_compile",target:"opponent"};case"delete_all_in_lane":return{action:"delete_all_in_lane",laneCondition:{type:"min_cards",count:8},excludeCurrentLane:!0};case"shuffle_trash":return{action:"shuffle_trash",optional:!0};case"shuffle_deck":return{action:"shuffle_deck"};case"redirect_return_to_deck":return{action:"redirect_return_to_deck",faceDown:!0};case"state_number":return{action:"state_number",numberSource:"own_protocol_values"};case"state_protocol":return{action:"state_protocol",protocolSource:"opponent_cards"};case"swap_stacks":return{action:"swap_stacks",target:"own"};case"copy_opponent_middle":return{action:"copy_opponent_middle",optional:!0};case"auto_compile":return{action:"auto_compile",protocolCountConditional:{type:"unique_protocols_on_field",threshold:6}};case"card_property":return{action:"card_property",property:"ignore_protocol_matching"};default:return{}}},o2=({effect:t,onChange:n,readOnly:r=!1})=>{const s=v=>{r||n({...t,params:v})},c=v=>{if(v){const C={id:pt(),params:$c("draw"),position:t.position,trigger:t.trigger};n({...t,conditional:{type:"then",thenEffect:C}})}else{const{conditional:C,...b}=t;n(b)}},d=v=>{t.conditional&&n({...t,conditional:{...t.conditional,type:v}})},u=v=>{t.conditional&&n({...t,conditional:{...t.conditional,thenEffect:v}})},p=v=>{if(!t.conditional)return;const C=$c(v),b={...t.conditional.thenEffect,params:C};n({...t,conditional:{...t.conditional,thenEffect:b}})},f=v=>{if(t.conditional)if(v){const C={id:pt(),params:$c("delete"),position:t.position,trigger:t.trigger};n({...t,conditional:{...t.conditional,thenEffect:{...t.conditional.thenEffect,conditional:{type:"then",thenEffect:C}}}})}else{const{conditional:C,...b}=t.conditional.thenEffect;n({...t,conditional:{...t.conditional,thenEffect:b}})}},h=v=>{var C;(C=t.conditional)!=null&&C.thenEffect.conditional&&n({...t,conditional:{...t.conditional,thenEffect:{...t.conditional.thenEffect,conditional:{...t.conditional.thenEffect.conditional,type:v}}}})},y=v=>{var C;(C=t.conditional)!=null&&C.thenEffect.conditional&&n({...t,conditional:{...t.conditional,thenEffect:{...t.conditional.thenEffect,conditional:{...t.conditional.thenEffect.conditional,thenEffect:v}}}})},m=v=>{var x;if(!((x=t.conditional)!=null&&x.thenEffect.conditional))return;const C=$c(v),b={...t.conditional.thenEffect.conditional.thenEffect,params:C};n({...t,conditional:{...t.conditional,thenEffect:{...t.conditional.thenEffect,conditional:{...t.conditional.thenEffect.conditional,thenEffect:b}}}})},g=(v,C)=>{var b,x,j,E;switch(v.params.action){case"draw":return o.jsx(l_,{params:v.params,onChange:C});case"refresh":return o.jsx(Wk,{params:v.params,onChange:C});case"mutual_draw":return o.jsx(Yk,{params:v.params,onChange:C});case"flip":return o.jsx(s_,{params:v.params,onChange:C});case"shift":return o.jsx(c_,{params:v.params,onChange:C});case"delete":return o.jsx(i_,{params:v.params,onChange:C});case"discard":return o.jsx(d_,{params:v.params,onChange:C});case"return":return o.jsx(u_,{params:v.params,onChange:C});case"play":return o.jsx(p_,{params:v.params,onChange:C});case"rearrange_protocols":case"swap_protocols":return o.jsx(f_,{params:v.params,onChange:C});case"reveal":case"give":return o.jsx(h_,{params:v.params,onChange:C});case"take":return o.jsx(m_,{params:v.params,onChange:C});case"choice":return o.jsx(Qk,{params:v.params,onChange:C});case"passive_rule":return o.jsx(Xk,{params:v.params,onChange:C});case"value_modifier":return o.jsx(Zk,{params:v.params,onChange:C});case"block_compile":return o.jsx(Kk,{params:v.params,onChange:C});case"auto_compile":return o.jsxs("div",{className:"param-editor auto-compile-effect-editor",children:[o.jsx("h4",{children:"Auto Compile Effect Parameters"}),o.jsxs("label",{children:["Conditional Type",o.jsxs("select",{value:((b=v.params.protocolCountConditional)==null?void 0:b.type)||"unique_protocols_on_field",onChange:k=>{var D;const R=k.target.value;C(R==="same_protocol_count_on_field"?{...v.params,protocolCountConditional:{type:"same_protocol_count_on_field",threshold:5,faceState:"face_up"}}:{...v.params,protocolCountConditional:{type:"unique_protocols_on_field",threshold:((D=v.params.protocolCountConditional)==null?void 0:D.threshold)||6}})},children:[o.jsx("option",{value:"unique_protocols_on_field",children:"Unique Protocols on Field (Diversity)"}),o.jsx("option",{value:"same_protocol_count_on_field",children:"Same Protocol Count on Field (Unity)"})]})]}),o.jsxs("label",{children:["Required Count",o.jsxs("select",{value:((x=v.params.protocolCountConditional)==null?void 0:x.threshold)||6,onChange:k=>C({...v.params,protocolCountConditional:{...v.params.protocolCountConditional,threshold:parseInt(k.target.value)}}),children:[o.jsx("option",{value:"2",children:"2"}),o.jsx("option",{value:"3",children:"3"}),o.jsx("option",{value:"4",children:"4"}),o.jsx("option",{value:"5",children:"5"}),o.jsx("option",{value:"6",children:"6"}),o.jsx("option",{value:"7",children:"7"}),o.jsx("option",{value:"8",children:"8"})]})]}),((j=v.params.protocolCountConditional)==null?void 0:j.type)==="same_protocol_count_on_field"&&o.jsxs(o.Fragment,{children:[o.jsxs("label",{style:{marginTop:"10px"},children:[o.jsx("input",{type:"checkbox",checked:v.params.deleteAllInLane||!1,onChange:k=>C({...v.params,deleteAllInLane:k.target.checked})}),"Also delete all cards in this lane (Unity-1)"]}),o.jsx("p",{className:"param-hint",style:{marginTop:"10px"},children:'"If there are X or more face-up [Protocol] cards in the field, compile this protocol."'})]}),((E=v.params.protocolCountConditional)==null?void 0:E.type)!=="same_protocol_count_on_field"&&o.jsx("p",{className:"param-hint",children:'"If there are X different protocols on cards in the field, compile this protocol."'})]});case"delete_all_in_lane":return o.jsx(Jk,{params:v.params,onChange:C});case"shuffle_trash":return o.jsx(e2,{params:v.params,onChange:C});case"shuffle_deck":return o.jsx(t2,{params:v.params,onChange:C});case"state_number":return o.jsx(n2,{params:v.params,onChange:C});case"state_protocol":return o.jsx(a2,{params:v.params,onChange:C});case"swap_stacks":return o.jsxs("div",{className:"param-editor swap-stacks-editor",children:[o.jsx("h4",{children:"Swap Stacks"}),o.jsx("p",{style:{color:"#8A79E8"},children:"Swap all of your cards in one of your stacks with another one of your stacks."})]});case"copy_opponent_middle":return o.jsxs("div",{className:"param-editor copy-opponent-middle-editor",children:[o.jsx("h4",{children:"Copy Opponent's Middle Command"}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:v.params.optional??!0,onChange:k=>C({...v.params,optional:k.target.checked})}),'Optional ("You may resolve..." instead of "Resolve...")']}),o.jsx("p",{style:{color:"#8A79E8",marginTop:"10px"},children:"Select one of your opponent's face-up uncovered cards and execute its middle commands as if they were on this card."})]});case"card_property":return o.jsxs("div",{className:"param-editor card-property-editor",children:[o.jsx("h4",{children:"Card Property"}),o.jsxs("label",{children:["Property",o.jsx("select",{value:v.params.property||"ignore_protocol_matching",onChange:k=>C({...v.params,property:k.target.value}),children:o.jsx("option",{value:"ignore_protocol_matching",children:"Ignore Protocol Matching (Chaos-3)"})})]}),o.jsx("p",{style:{color:"#8A79E8",marginTop:"10px"},children:"This card may be played face-up in any lane, regardless of protocol matching rules."})]});default:return o.jsxs("div",{children:["Unknown effect type: ",v.params.action]})}};return o.jsxs("div",{className:`effect-editor ${r?"read-only-mode":""}`,children:[o.jsx("div",{className:"trigger-info",style:{marginBottom:"15px",padding:"10px",backgroundColor:"#1A113B",borderRadius:"4px",border:"1px solid rgba(97, 239, 255, 0.3)"},children:o.jsxs("div",{style:{display:"flex",gap:"20px",alignItems:"center",flexWrap:"wrap"},children:[o.jsxs("label",{style:{flex:1,minWidth:"200px"},children:[o.jsx("strong",{children:"Trigger:"}),o.jsxs("select",{value:t.trigger,onChange:v=>!r&&n({...t,trigger:v.target.value}),disabled:r,style:{width:"100%",padding:"6px",marginTop:"4px",backgroundColor:"#2c1d63",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px"},children:[o.jsx("optgroup",{label:"Immediate",children:o.jsx("option",{value:"on_play",children:"On Play"})}),o.jsx("optgroup",{label:"Passive (Top Box)",children:o.jsx("option",{value:"passive",children:"Passive (always active)"})}),o.jsxs("optgroup",{label:"Phase Triggers (Bottom Box)",children:[o.jsx("option",{value:"start",children:"Start Phase"}),o.jsx("option",{value:"end",children:"End Phase"}),o.jsx("option",{value:"on_cover",children:"When Covered"})]}),o.jsxs("optgroup",{label:"Reactive (Top Box)",children:[o.jsx("option",{value:"on_flip",children:"When this card would be flipped"}),o.jsx("option",{value:"on_cover_or_flip",children:"When covered or flipped"}),o.jsx("option",{value:"after_delete",children:"After cards are deleted"}),o.jsx("option",{value:"after_discard",children:"After cards are discarded"}),o.jsx("option",{value:"after_draw",children:"After cards are drawn"}),o.jsx("option",{value:"after_shift",children:"After cards are shifted"}),o.jsx("option",{value:"after_flip",children:"After cards are flipped"}),o.jsx("option",{value:"after_play",children:"After a card is played"}),o.jsx("option",{value:"after_shuffle",children:"After deck is shuffled"}),o.jsx("option",{value:"after_clear_cache",children:"After cache is cleared"}),o.jsx("option",{value:"after_refresh",children:"After you refresh"}),o.jsx("option",{value:"after_opponent_refresh",children:"After opponent refreshes"}),o.jsx("option",{value:"after_compile",children:"After you compile"}),o.jsx("option",{value:"after_opponent_compile",children:"After opponent compiles"}),o.jsx("option",{value:"after_opponent_discard",children:"After opponent discards"}),o.jsx("option",{value:"after_opponent_draw",children:"After opponent draws"}),o.jsx("option",{value:"before_compile_delete",children:"Before deleted by compile"}),o.jsx("option",{value:"when_card_returned",children:"When card returned to hand"})]})]})]}),o.jsxs("div",{style:{color:"#8A79E8",fontSize:"13px"},children:[o.jsx("strong",{children:"Position:"})," ",t.position.charAt(0).toUpperCase()+t.position.slice(1)," Box"]})]})}),o.jsxs("div",{className:"main-effect",children:[o.jsx("h3",{children:"Main Effect"}),g(t,s),o.jsxs("div",{className:"effect-preview",children:[o.jsx("strong",{children:"Preview:"})," ",o.jsx("span",{dangerouslySetInnerHTML:{__html:xr([t])}})]})]}),o.jsxs("div",{style:{marginTop:"15px"},children:[o.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[o.jsx("input",{type:"checkbox",checked:!!t.useCardFromPreviousEffect,onChange:v=>n({...t,useCardFromPreviousEffect:v.target.checked})}),o.jsx("span",{children:`Use card from previous effect (for "shift THAT card", "draw equal to THAT card's value", etc.)`})]}),t.useCardFromPreviousEffect&&o.jsx("small",{style:{display:"block",marginLeft:"24px",marginTop:"4px",color:"#8A79E8"},children:"This effect will target/use the card selected by the previous effect in the chain."})]}),(t.trigger==="after_draw"||t.trigger==="after_delete"||t.trigger==="after_discard"||t.trigger==="after_shift"||t.trigger==="after_flip"||t.trigger==="after_shuffle"||t.trigger==="after_clear_cache"||t.trigger==="after_opponent_discard"||t.trigger==="after_play")&&o.jsxs("div",{style:{marginTop:"15px"},children:[o.jsxs("label",{children:["Trigger Actor (who triggers this effect?)",o.jsxs("select",{value:t.reactiveTriggerActor||"self",onChange:v=>n({...t,reactiveTriggerActor:v.target.value}),style:{width:"100%",padding:"8px",marginTop:"5px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px",cursor:"pointer"},children:[o.jsx("option",{value:"self",children:"Only when YOU perform the action (default)"}),o.jsx("option",{value:"opponent",children:"Only when OPPONENT performs the action"}),o.jsx("option",{value:"any",children:"When ANYONE performs the action"})]})]}),o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:t.reactiveTriggerActor==="self"||!t.reactiveTriggerActor?"Effect triggers only when YOU delete/draw/etc.":t.reactiveTriggerActor==="opponent"?"Effect triggers only when OPPONENT deletes/draws/etc.":"Effect triggers when ANYONE deletes/draws/etc."})]}),(t.trigger==="after_play"||t.trigger==="after_shift"||t.trigger==="after_flip"||t.trigger==="after_delete")&&o.jsxs("div",{style:{marginTop:"15px"},children:[o.jsxs("label",{children:["Reactive Scope",o.jsxs("select",{value:t.reactiveScope||"global",onChange:v=>n({...t,reactiveScope:v.target.value}),style:{width:"100%",padding:"8px",marginTop:"5px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px",cursor:"pointer"},children:[o.jsx("option",{value:"global",children:"Any lane (default)"}),o.jsx("option",{value:"this_lane",children:"This lane only"})]})]}),o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:t.reactiveScope==="this_lane"?"Effect only triggers when the action happens in the same lane as this card.":"Effect triggers when the action happens anywhere on the board."})]}),t.trigger==="on_cover"&&o.jsxs("div",{style:{marginTop:"15px"},children:[o.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",cursor:"pointer"},children:[o.jsx("input",{type:"checkbox",checked:t.onCoverProtocolRestriction==="same_protocol",onChange:v=>{if(v.target.checked)n({...t,onCoverProtocolRestriction:"same_protocol"});else{const{onCoverProtocolRestriction:C,...b}=t;n(b)}},style:{width:"18px",height:"18px",cursor:"pointer"}}),"Only trigger when covered by same protocol (Unity)"]}),o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:t.onCoverProtocolRestriction==="same_protocol"?"Effect only triggers when covered by another card of the same protocol.":"Effect triggers when covered by any card."})]}),(t.trigger==="after_draw"||t.trigger==="after_delete"||t.trigger==="after_discard"||t.trigger==="after_shift"||t.trigger==="after_flip"||t.trigger==="after_shuffle")&&o.jsxs("div",{style:{marginTop:"15px"},children:[o.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",cursor:"pointer"},children:[o.jsx("input",{type:"checkbox",checked:t.onlyDuringOpponentTurn||!1,onChange:v=>n({...t,onlyDuringOpponentTurn:v.target.checked}),style:{width:"18px",height:"18px",cursor:"pointer"}}),"Only During Opponent's Turn"]}),o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:t.onlyDuringOpponentTurn?"Effect only triggers during your opponent's turn.":"Effect triggers during any turn."})]}),o.jsxs("div",{className:"conditional-section",style:{marginTop:"20px",borderTop:"1px solid #2c1d63",paddingTop:"15px"},children:[o.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"10px"},children:[o.jsx("input",{type:"checkbox",checked:!!t.conditional,onChange:v=>c(v.target.checked)}),o.jsx("strong",{children:"Add follow-up effect"})]}),t.conditional&&o.jsxs("div",{className:"follow-up-effect",style:{marginLeft:"20px",padding:"10px",backgroundColor:"#2c1d63",borderRadius:"4px",border:"1px solid rgba(97, 239, 255, 0.2)"},children:[o.jsx("h4",{style:{marginTop:0},children:"Follow-Up Effect"}),o.jsxs("label",{children:["Connection Type",o.jsxs("select",{value:t.conditional.type||"then",onChange:v=>d(v.target.value),style:{width:"100%",padding:"8px",marginTop:"5px",marginBottom:"15px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px",cursor:"pointer"},children:[o.jsx("option",{value:"then",children:"Then (always executes)"}),o.jsx("option",{value:"if_executed",children:"If you do (only if first effect succeeds)"})]})]}),o.jsxs("label",{children:["Effect Type",o.jsxs("select",{value:t.conditional.thenEffect.params.action,onChange:v=>p(v.target.value),style:{width:"100%",padding:"8px",marginTop:"5px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px",cursor:"pointer"},children:[o.jsx("option",{value:"draw",children:"Draw Cards"}),o.jsx("option",{value:"refresh",children:"Refresh Hand"}),o.jsx("option",{value:"mutual_draw",children:"Mutual Draw (Exchange)"}),o.jsx("option",{value:"flip",children:"Flip Cards"}),o.jsx("option",{value:"shift",children:"Shift Card"}),o.jsx("option",{value:"delete",children:"Delete Cards"}),o.jsx("option",{value:"delete_all_in_lane",children:"Delete All in Lane"}),o.jsx("option",{value:"discard",children:"Discard Cards"}),o.jsx("option",{value:"return",children:"Return to Hand"}),o.jsx("option",{value:"play",children:"Play from Hand/Deck"}),o.jsx("option",{value:"rearrange_protocols",children:"Rearrange Protocols"}),o.jsx("option",{value:"swap_protocols",children:"Swap Protocols"}),o.jsx("option",{value:"reveal",children:"Reveal Hand"}),o.jsx("option",{value:"give",children:"Give Cards"}),o.jsx("option",{value:"take",children:"Take from Hand"}),o.jsx("option",{value:"choice",children:"Either/Or Choice"}),o.jsx("option",{value:"block_compile",children:"Block Compile"}),o.jsx("option",{value:"auto_compile",children:"Auto Compile (Diversity)"}),o.jsx("option",{value:"shuffle_trash",children:"Shuffle Trash into Deck"}),o.jsx("option",{value:"shuffle_deck",children:"Shuffle Deck"}),o.jsx("option",{value:"state_number",children:"State a Number"}),o.jsx("option",{value:"state_protocol",children:"State a Protocol"}),o.jsx("option",{value:"swap_stacks",children:"Swap Stacks"}),o.jsx("option",{value:"copy_opponent_middle",children:"Copy Opponent's Middle"}),o.jsx("option",{value:"card_property",children:"Card Property (Chaos-3)"})]})]}),o.jsx("div",{style:{marginTop:"15px"},children:g(t.conditional.thenEffect,v=>u({...t.conditional.thenEffect,params:v}))}),o.jsxs("div",{className:"nested-conditional-section",style:{marginTop:"15px",borderTop:"1px solid rgba(97, 239, 255, 0.2)",paddingTop:"15px"},children:[o.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"10px"},children:[o.jsx("input",{type:"checkbox",checked:!!t.conditional.thenEffect.conditional,onChange:v=>f(v.target.checked)}),o.jsx("strong",{children:"Add 2nd follow-up effect"})]}),t.conditional.thenEffect.conditional&&o.jsxs("div",{className:"nested-follow-up-effect",style:{marginLeft:"10px",padding:"10px",backgroundColor:"#1A113B",borderRadius:"4px",border:"1px solid rgba(97, 239, 255, 0.2)"},children:[o.jsx("h5",{style:{marginTop:0,fontSize:"0.9rem"},children:"2nd Follow-Up Effect"}),o.jsxs("label",{children:["Connection Type",o.jsxs("select",{value:t.conditional.thenEffect.conditional.type||"then",onChange:v=>h(v.target.value),style:{width:"100%",padding:"6px",marginTop:"5px",marginBottom:"10px",backgroundColor:"#0D0825",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px",cursor:"pointer",fontSize:"0.9rem"},children:[o.jsx("option",{value:"then",children:"Then (always executes)"}),o.jsx("option",{value:"if_executed",children:"If you do (only if first effect succeeds)"})]})]}),o.jsxs("label",{children:["Effect Type",o.jsxs("select",{value:t.conditional.thenEffect.conditional.thenEffect.params.action,onChange:v=>m(v.target.value),style:{width:"100%",padding:"6px",marginTop:"5px",backgroundColor:"#0D0825",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px",cursor:"pointer",fontSize:"0.9rem"},children:[o.jsx("option",{value:"draw",children:"Draw Cards"}),o.jsx("option",{value:"refresh",children:"Refresh Hand"}),o.jsx("option",{value:"mutual_draw",children:"Mutual Draw (Exchange)"}),o.jsx("option",{value:"flip",children:"Flip Cards"}),o.jsx("option",{value:"shift",children:"Shift Card"}),o.jsx("option",{value:"delete",children:"Delete Cards"}),o.jsx("option",{value:"delete_all_in_lane",children:"Delete All in Lane"}),o.jsx("option",{value:"discard",children:"Discard Cards"}),o.jsx("option",{value:"return",children:"Return to Hand"}),o.jsx("option",{value:"play",children:"Play from Hand/Deck"}),o.jsx("option",{value:"rearrange_protocols",children:"Rearrange Protocols"}),o.jsx("option",{value:"swap_protocols",children:"Swap Protocols"}),o.jsx("option",{value:"reveal",children:"Reveal Hand"}),o.jsx("option",{value:"give",children:"Give Cards"}),o.jsx("option",{value:"take",children:"Take from Hand"}),o.jsx("option",{value:"choice",children:"Either/Or Choice"}),o.jsx("option",{value:"block_compile",children:"Block Compile"}),o.jsx("option",{value:"auto_compile",children:"Auto Compile (Diversity)"}),o.jsx("option",{value:"shuffle_trash",children:"Shuffle Trash into Deck"}),o.jsx("option",{value:"shuffle_deck",children:"Shuffle Deck"}),o.jsx("option",{value:"state_number",children:"State a Number"}),o.jsx("option",{value:"state_protocol",children:"State a Protocol"}),o.jsx("option",{value:"swap_stacks",children:"Swap Stacks"}),o.jsx("option",{value:"copy_opponent_middle",children:"Copy Opponent's Middle"}),o.jsx("option",{value:"card_property",children:"Card Property (Chaos-3)"})]})]}),o.jsx("div",{style:{marginTop:"10px"},children:g(t.conditional.thenEffect.conditional.thenEffect,v=>y({...t.conditional.thenEffect.conditional.thenEffect,params:v}))})]})]})]})]})]})},r2=({card:t,protocolName:n,protocolColor:r,protocolPattern:s,onChange:c,readOnly:d=!1})=>{const[u,p]=J.useState(null),[f,h]=J.useState(null),[y,m]=J.useState(!1);J.useEffect(()=>{p(null)},[t.value]);const g=(P,z,H)=>{const A={id:pt(),params:l2(z),position:P,trigger:H},N={...t};P==="top"?N.topEffects=[...N.topEffects,A]:P==="middle"?N.middleEffects=[...N.middleEffects,A]:N.bottomEffects=[...N.bottomEffects,A],c(N);const T=P==="top"?N.topEffects.length-1:P==="middle"?N.middleEffects.length-1:N.bottomEffects.length-1;p({box:P,effectIndex:T,effect:A})},v=(P,z)=>{h({box:P,effectIndex:z})},C=()=>{if(!f)return;const{box:P,effectIndex:z}=f,H={...t};P==="top"?H.topEffects.splice(z,1):P==="middle"?H.middleEffects.splice(z,1):H.bottomEffects.splice(z,1),c(H),u&&u.box===P&&u.effectIndex===z&&p(null),h(null)},b=P=>{if(!u)return;const{box:z,effectIndex:H}=u,A={...t};z==="top"?(A.topEffects=[...A.topEffects],A.topEffects[H]=P):z==="middle"?(A.middleEffects=[...A.middleEffects],A.middleEffects[H]=P):(A.bottomEffects=[...A.bottomEffects],A.bottomEffects[H]=P),c(A),p({box:z,effectIndex:H,effect:P})},x=(P,z)=>{const H=P==="top"?t.topEffects[z]:P==="middle"?t.middleEffects[z]:t.bottomEffects[z];p({box:P,effectIndex:z,effect:H})},j=(P,z)=>{const H=(z==null?void 0:z.reactiveTriggerActor)||"self",A=(z==null?void 0:z.reactiveScope)||"global";if(P==="after_play")return`After ${H==="opponent"?"your opponent plays":H==="any"?"a card is played":"you play"} a card${A==="this_lane"?" in this line":""}`;if(["after_delete","after_discard","after_draw","after_shift","after_flip"].includes(P)){const N={after_delete:"delete cards",after_discard:"discard cards",after_draw:"draw cards",after_shift:"shift cards",after_flip:"flip cards"},T=H==="opponent"?"your opponent":H==="any"?"anyone":"you",q=A==="this_lane"?" in this line":"";return`After ${T} ${N[P]}${q}`}switch(P){case"passive":return"";case"on_play":return"";case"start":return"Start";case"end":return"End";case"on_cover":return"On Cover";case"after_opponent_discard":return"After opponent discards";case"after_clear_cache":return"After you clear cache";case"before_compile_delete":return"Before deleted by compile";case"on_flip":return"When this card would be flipped";case"on_cover_or_flip":return"When covered or flipped";default:return P}},E=P=>{const z={...t,value:P};c(z)},k={protocolName:n},R=xr(t.topEffects,k),D=xr(t.middleEffects,k),L=xr(t.bottomEffects,k),I=JSON.stringify({top:t.topEffects.map(P=>({id:P.id,params:P.params})),middle:t.middleEffects.map(P=>({id:P.id,params:P.params})),bottom:t.bottomEffects.map(P=>({id:P.id,params:P.params}))}),F=`${n}-${t.value}-${I}`,U={id:F,protocol:n,value:t.value,top:R,middle:D,bottom:L,isFaceUp:!0,owner:"player",laneIndex:0,category:"Custom",keywords:{}},B=(P,z)=>{P=P.replace("#","");const H=parseInt(P.substring(0,2),16),A=parseInt(P.substring(2,4),16),N=parseInt(P.substring(4,6),16);return`rgba(${H}, ${A}, ${N}, ${z})`},G=`card-custom-preview pattern-${s}`,W={"--custom-color":r,"--custom-color-alpha-05":B(r,.05),"--custom-color-alpha-06":B(r,.06),"--custom-color-alpha-08":B(r,.08),"--custom-color-alpha-10":B(r,.1),"--custom-color-alpha-15":B(r,.15),"--custom-color-alpha-20":B(r,.2),"--custom-color-alpha-25":B(r,.25),borderColor:r};return o.jsxs("div",{className:"card-editor-container",children:[o.jsxs("div",{className:"card-editor-content",children:[o.jsxs("div",{className:"card-live-preview",children:[o.jsx("h4",{children:"Card Preview"}),o.jsxs("label",{className:"card-value-selector",children:["Card Value:",o.jsxs("select",{value:t.value,onChange:P=>E(Number(P.target.value)),children:[o.jsx("option",{value:-1,children:"-1"}),o.jsx("option",{value:0,children:"0"}),o.jsx("option",{value:1,children:"1"}),o.jsx("option",{value:2,children:"2"}),o.jsx("option",{value:3,children:"3"}),o.jsx("option",{value:4,children:"4"}),o.jsx("option",{value:5,children:"5"}),o.jsx("option",{value:6,children:"6"})]})]}),o.jsx("div",{className:"card-preview-wrapper",style:W,children:o.jsx(St,{card:U,isFaceUp:!0,additionalClassName:G},F)})]}),o.jsx("div",{className:"card-effects-editor",children:o.jsxs("div",{className:"card-preview",style:{borderColor:r},children:[o.jsx("div",{className:"card-header",style:{backgroundColor:r},children:o.jsxs("h3",{children:[n,"-",t.value]})}),o.jsxs("div",{className:"card-box top-box",children:[o.jsx("h4",{children:"Top Box (Passive/Reactive)"}),o.jsx("p",{className:"box-description",children:"Passive effects or reactive triggers"}),o.jsxs("div",{className:"effects-list",children:[t.topEffects.map((P,z)=>o.jsxs("div",{className:"effect-item",children:[o.jsxs("span",{onClick:()=>x("top",z),className:d?"read-only-clickable":"",children:[P.trigger!=="passive"&&o.jsxs("strong",{children:[j(P.trigger,P),":"]})," ",dl(P)]}),!d&&o.jsx("button",{onClick:()=>v("top",z),children:""})]},P.id)),t.topEffects.length===0&&o.jsx("p",{className:"empty-box",children:"No effects"})]}),!d&&o.jsxs("div",{className:"add-effect-controls",children:[o.jsxs("select",{id:"top-trigger",defaultValue:"",children:[o.jsx("option",{value:"",children:"Choose Trigger"}),o.jsx("optgroup",{label:"Passive",children:o.jsx("option",{value:"passive",children:"Passive (always active)"})}),o.jsxs("optgroup",{label:"Phase Triggers",children:[o.jsx("option",{value:"start",children:"Start Phase"}),o.jsx("option",{value:"end",children:"End Phase"}),o.jsx("option",{value:"on_cover",children:"On Cover"})]}),o.jsxs("optgroup",{label:"Reactive Triggers",children:[o.jsx("option",{value:"after_delete",children:"After you delete cards"}),o.jsx("option",{value:"after_opponent_discard",children:"After opponent discards"}),o.jsx("option",{value:"after_draw",children:"After you draw cards"}),o.jsx("option",{value:"after_clear_cache",children:"After you clear cache"}),o.jsx("option",{value:"before_compile_delete",children:"Before deleted by compile"}),o.jsx("option",{value:"after_flip",children:"After cards are flipped"}),o.jsx("option",{value:"after_shift",children:"After cards are shifted"}),o.jsx("option",{value:"after_play",children:"After cards are played"}),o.jsx("option",{value:"on_flip",children:"When this card would be flipped"}),o.jsx("option",{value:"on_cover_or_flip",children:"When this card would be covered or flipped"})]})]}),o.jsxs("select",{id:"top-action",defaultValue:"",children:[o.jsx("option",{value:"",children:"Choose Action"}),o.jsx("option",{value:"draw",children:"Draw Cards"}),o.jsx("option",{value:"refresh",children:"Refresh Hand"}),o.jsx("option",{value:"mutual_draw",children:"Mutual Draw (Exchange)"}),o.jsx("option",{value:"flip",children:"Flip Cards"}),o.jsx("option",{value:"shift",children:"Shift Card"}),o.jsx("option",{value:"delete",children:"Delete Cards"}),o.jsx("option",{value:"discard",children:"Discard Cards"}),o.jsx("option",{value:"return",children:"Return to Hand"}),o.jsx("option",{value:"play",children:"Play from Hand/Deck"}),o.jsx("option",{value:"rearrange_protocols",children:"Rearrange Protocols"}),o.jsx("option",{value:"swap_protocols",children:"Swap Protocols"}),o.jsx("option",{value:"reveal",children:"Reveal Hand"}),o.jsx("option",{value:"give",children:"Give Cards"}),o.jsx("option",{value:"take",children:"Take from Hand"}),o.jsx("option",{value:"choice",children:"Either/Or Choice"}),o.jsx("option",{value:"passive_rule",children:"Passive Rule"}),o.jsx("option",{value:"value_modifier",children:"Value Modifier"}),o.jsx("option",{value:"block_compile",children:"Block Compile"}),o.jsx("option",{value:"delete_all_in_lane",children:"Delete All in Lane"})]}),o.jsx("button",{className:"btn btn-add-effect",onClick:()=>{const P=document.getElementById("top-trigger"),z=document.getElementById("top-action"),H=P.value,A=z.value;H&&A?(g("top",A,H),P.value="",z.value=""):m(!0)},children:"+"})]})]}),o.jsxs("div",{className:"card-box middle-box",children:[o.jsx("h4",{children:"Middle Box (On Play)"}),o.jsx("p",{className:"box-description",children:"When played or uncovered"}),o.jsxs("div",{className:"effects-list",children:[t.middleEffects.map((P,z)=>o.jsxs("div",{className:"effect-item",children:[o.jsx("span",{onClick:()=>x("middle",z),className:d?"read-only-clickable":"",children:dl(P)}),!d&&o.jsx("button",{onClick:()=>v("middle",z),children:""})]},P.id)),t.middleEffects.length===0&&o.jsx("p",{className:"empty-box",children:"No effects"})]}),!d&&o.jsxs("select",{onChange:P=>{P.target.value&&(g("middle",P.target.value,"on_play"),P.target.value="")},children:[o.jsx("option",{value:"",children:"+ Add Effect"}),o.jsx("option",{value:"draw",children:"Draw Cards"}),o.jsx("option",{value:"refresh",children:"Refresh Hand"}),o.jsx("option",{value:"flip",children:"Flip Cards"}),o.jsx("option",{value:"shift",children:"Shift Card"}),o.jsx("option",{value:"delete",children:"Delete Cards"}),o.jsx("option",{value:"discard",children:"Discard Cards"}),o.jsx("option",{value:"return",children:"Return to Hand"}),o.jsx("option",{value:"play",children:"Play from Hand/Deck"}),o.jsx("option",{value:"rearrange_protocols",children:"Rearrange Protocols"}),o.jsx("option",{value:"swap_protocols",children:"Swap Protocols"}),o.jsx("option",{value:"reveal",children:"Reveal Hand"}),o.jsx("option",{value:"give",children:"Give Cards"}),o.jsx("option",{value:"take",children:"Take from Hand"}),o.jsx("option",{value:"choice",children:"Either/Or Choice"}),o.jsx("option",{value:"passive_rule",children:"Passive Rule"}),o.jsx("option",{value:"value_modifier",children:"Value Modifier"}),o.jsx("option",{value:"block_compile",children:"Block Compile"}),o.jsx("option",{value:"delete_all_in_lane",children:"Delete All in Lane"})]})]}),o.jsxs("div",{className:"card-box bottom-box",children:[o.jsx("h4",{children:"Bottom Box (Triggered)"}),o.jsx("p",{className:"box-description",children:"Only when uncovered AND face-up"}),o.jsxs("div",{className:"effects-list",children:[t.bottomEffects.map((P,z)=>o.jsxs("div",{className:"effect-item",children:[o.jsxs("span",{onClick:()=>x("bottom",z),className:d?"read-only-clickable":"",children:[o.jsxs("strong",{children:[j(P.trigger,P),":"]})," ",dl(P)]}),!d&&o.jsx("button",{onClick:()=>v("bottom",z),children:""})]},P.id)),t.bottomEffects.length===0&&o.jsx("p",{className:"empty-box",children:"No effects"})]}),!d&&o.jsxs("div",{className:"bottom-effect-add",children:[o.jsxs("select",{id:"bottom-trigger",children:[o.jsx("option",{value:"",children:"1. Choose Trigger"}),o.jsx("option",{value:"start",children:"Start Phase"}),o.jsx("option",{value:"end",children:"End Phase"}),o.jsx("option",{value:"on_cover",children:"On Cover"})]}),o.jsxs("select",{id:"bottom-action",children:[o.jsx("option",{value:"",children:"2. Choose Effect"}),o.jsx("option",{value:"draw",children:"Draw Cards"}),o.jsx("option",{value:"refresh",children:"Refresh Hand"}),o.jsx("option",{value:"mutual_draw",children:"Mutual Draw (Exchange)"}),o.jsx("option",{value:"flip",children:"Flip Cards"}),o.jsx("option",{value:"shift",children:"Shift Card"}),o.jsx("option",{value:"delete",children:"Delete Cards"}),o.jsx("option",{value:"discard",children:"Discard Cards"}),o.jsx("option",{value:"return",children:"Return to Hand"}),o.jsx("option",{value:"play",children:"Play from Hand/Deck"}),o.jsx("option",{value:"rearrange_protocols",children:"Rearrange Protocols"}),o.jsx("option",{value:"swap_protocols",children:"Swap Protocols"}),o.jsx("option",{value:"reveal",children:"Reveal Hand"}),o.jsx("option",{value:"give",children:"Give Cards"}),o.jsx("option",{value:"take",children:"Take from Hand"}),o.jsx("option",{value:"choice",children:"Either/Or Choice"}),o.jsx("option",{value:"passive_rule",children:"Passive Rule"}),o.jsx("option",{value:"value_modifier",children:"Value Modifier"}),o.jsx("option",{value:"block_compile",children:"Block Compile"}),o.jsx("option",{value:"delete_all_in_lane",children:"Delete All in Lane"})]}),o.jsx("button",{className:"btn btn-add-effect",onClick:()=>{const P=document.getElementById("bottom-trigger"),z=document.getElementById("bottom-action"),H=P.value,A=z.value;H&&A?(g("bottom",A,H),P.value="",z.value=""):m(!0)},children:"+"})]})]})]})})]}),u&&o.jsxs("div",{className:"effect-parameter-editor",children:[o.jsx("h3",{children:d?"View Effect":"Configure Effect"}),d&&o.jsx("div",{className:"read-only-notice",children:"This effect is read-only"}),o.jsx(o2,{effect:u.effect,onChange:b,readOnly:d}),o.jsx("button",{onClick:()=>p(null),className:"btn",children:d?"Close":"Done"})]}),f&&o.jsx("div",{className:"custom-protocol-modal-overlay",onClick:()=>h(null),children:o.jsxs("div",{className:"custom-protocol-modal-content",onClick:P=>P.stopPropagation(),children:[o.jsx("h3",{children:"Delete Effect"}),o.jsx("p",{children:"Are you sure you want to delete this effect?"}),o.jsxs("div",{className:"custom-protocol-modal-actions",children:[o.jsx("button",{onClick:()=>h(null),className:"btn btn-back",children:"Cancel"}),o.jsx("button",{onClick:C,className:"btn btn-delete",children:"Delete"})]})]})}),y&&o.jsx("div",{className:"custom-protocol-modal-overlay",onClick:()=>m(!1),children:o.jsxs("div",{className:"custom-protocol-modal-content",onClick:P=>P.stopPropagation(),children:[o.jsx("h3",{children:"Missing Selection"}),o.jsx("p",{children:"Please select both a trigger and an effect before adding."}),o.jsx("div",{className:"custom-protocol-modal-actions",children:o.jsx("button",{onClick:()=>m(!1),className:"btn",children:"OK"})})]})})]})},l2=t=>{switch(t){case"draw":return{action:"draw",count:1,target:"self",source:"own_deck"};case"flip":return{action:"flip",count:1,targetFilter:{owner:"any",position:"any",faceState:"any",excludeSelf:!1},optional:!1};case"shift":return{action:"shift",targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1}};case"delete":return{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"any"},excludeSelf:!0};case"discard":return{action:"discard",count:1,actor:"self"};case"return":return{action:"return",count:1,targetFilter:{},scope:{type:"any_card"}};case"play":return{action:"play",source:"hand",count:1,faceDown:!0,destinationRule:{type:"other_lines"}};case"rearrange_protocols":return{action:"rearrange_protocols",target:"own"};case"swap_protocols":return{action:"swap_protocols",target:"own"};case"reveal":case"give":return{action:t,source:"own_hand",count:1};case"take":return{action:"take",source:"opponent_hand",count:1,random:!0};case"choice":return{action:"choice",options:[]};case"passive_rule":return{action:"passive_rule",rule:{type:"block_all_play",target:"opponent",scope:"this_lane"}};case"value_modifier":return{action:"value_modifier",modifier:{type:"add_per_condition",value:1,condition:"per_face_down_card",target:"own_total",scope:"this_lane"}};default:return{}}},s2=(t,n)=>{const r=(c,d)=>{c=c.replace("#","");const u=parseInt(c.substring(0,2),16),p=parseInt(c.substring(2,4),16),f=parseInt(c.substring(4,6),16);return`rgba(${u}, ${p}, ${f}, ${d})`},s={borderColor:n};switch(t){case"solid":return{...s,backgroundColor:n};case"radial":return{...s,backgroundColor:"var(--surface-color)",backgroundImage:`radial-gradient(circle at 50% 50%, ${r(n,.25)} 0%, transparent 60%)`};case"dual-radial":return{...s,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 0% 0%, ${r(n,.2)}, transparent 50%),
                    radial-gradient(at 100% 100%, ${r(n,.2)}, transparent 50%)
                `};case"multi-radial":return{...s,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 0%, ${r(n,.2)}, transparent 70%),
                    radial-gradient(circle at 20% 30%, ${r(n,.15)}, transparent 40%),
                    radial-gradient(circle at 80% 70%, ${r(n,.2)}, transparent 50%)
                `};case"chaos":return{...s,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 10% 10%, hsla(60, 100%, 50%, 0.15), transparent 30%),
                    radial-gradient(at 90% 20%, hsla(180, 100%, 50%, 0.15), transparent 35%),
                    radial-gradient(at 30% 80%, hsla(300, 100%, 50%, 0.15), transparent 40%),
                    radial-gradient(at 70% 60%, hsla(0, 100%, 50%, 0.1), transparent 25%)
                `};case"grid":return{...s,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(circle at 50% 50%, ${r(n,.2)} 0%, transparent 40%),
                    linear-gradient(hsla(0,0%,100%,0.03) 1px, transparent 1px),
                    linear-gradient(90deg, hsla(0,0%,100%,0.03) 1px, transparent 1px)
                `,backgroundSize:"100% 100%, 20px 20px, 20px 20px"};case"diagonal-lines":return{...s,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 0% 100%, ${r(n,.25)}, transparent 70%),
                    repeating-linear-gradient(120deg, transparent, transparent 15px, ${r(n,.05)} 15px, ${r(n,.05)} 30px)
                `};case"cross-diagonal":return{...s,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 50%, ${r(n,.25)} 0%, transparent 50%),
                    repeating-linear-gradient(45deg, transparent, transparent 8px, ${r(n,.08)} 8px, ${r(n,.08)} 16px),
                    repeating-linear-gradient(-45deg, transparent, transparent 8px, ${r(n,.06)} 8px, ${r(n,.06)} 16px)
                `};case"horizontal-lines":return{...s,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 80% 80%, ${r(n,.1)}, transparent 50%),
                    repeating-linear-gradient(0deg, hsla(0,0%,100%,0.02), hsla(0,0%,100%,0.02) 1px, transparent 1px, transparent 3px)
                `};case"vertical-lines":return{...s,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 10% 10%, ${r(n,.2)}, transparent 50%),
                    repeating-linear-gradient(175deg, transparent, transparent 1px, ${r(n,.05)} 1px, ${r(n,.05)} 2px)
                `};case"cross":return{...s,backgroundColor:"var(--surface-color)",backgroundImage:`
                    linear-gradient(0deg, transparent 40%, ${r(n,.1)} 50%, transparent 60%),
                    linear-gradient(90deg, transparent 48%, ${r(n,.2)} 50%, transparent 52%)
                `};case"hexagons":return{...s,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 0%, ${r(n,.2)}, transparent 70%),
                    url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='28' height='49' viewBox='0 0 28 49'%3E%3Cg fill-rule='evenodd'%3E%3Cg id='hexagons' fill='%23ffffff' fill-opacity='0.05' fill-rule='nonzero'%3E%3Cpath d='M13.99 9.25l13 7.5v15l-13 7.5L1 31.75v-15l12.99-7.5zM3 17.9v12.7l10.99 6.34 11-6.35V17.9l-11-6.34L3 17.9zM0 15l12.99-7.5L26 15v18.5l-13 7.5L0 33.5V15z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")
                `};case"stripes":return{...s,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 100%, ${r(n,.25)}, transparent 60%),
                    linear-gradient(135deg, hsla(0,0%,0%,0.1) 23%, transparent 23%, transparent 25%, hsla(0,0%,0%,0.1) 25%, hsla(0,0%,0%,0.1) 27%, transparent 27%, transparent 73%, hsla(0,0%,0%,0.1) 73%, hsla(0,0%,0%,0.1) 75%, transparent 75%, transparent 77%, hsla(0,0%,0%,0.1) 77%)
                `};case"frost":return{...s,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(circle at 50% 50%, ${r(n,.2)} 0%, transparent 50%),
                    repeating-linear-gradient(30deg, transparent, transparent 10px, ${r(n,.08)} 10px, ${r(n,.08)} 11px),
                    repeating-linear-gradient(-30deg, transparent, transparent 10px, ${r(n,.08)} 10px, ${r(n,.08)} 11px),
                    repeating-linear-gradient(90deg, transparent, transparent 8px, ${r(n,.05)} 8px, ${r(n,.05)} 9px)
                `};default:return s}},c2=[{name:"Anarchy",hex:"#EA5A3C"},{name:"Apathy",hex:"#989A9A"},{name:"Chaos",hex:"#E53FE5"},{name:"Darkness",hex:"#A772D4"},{name:"Death",hex:"#E25656"},{name:"Fire",hex:"#F06838"},{name:"Gravity",hex:"#7599EB"},{name:"Hate",hex:"#E03E5E"},{name:"Life",hex:"#3CE076"},{name:"Light",hex:"#FFEB7F"},{name:"Love",hex:"#F074D9"},{name:"Metal",hex:"#B3B8BD"},{name:"Plague",hex:"#A2CD3A"},{name:"Psychic",hex:"#C971EB"},{name:"Speed",hex:"#33DDDD"},{name:"Spirit",hex:"#42D4A8"},{name:"Water",hex:"#3FA4EB"}],i2=[{name:"Solid",value:"solid",description:"Solid color background"},{name:"Radial Glow",value:"radial",description:"Single radial gradient glow"},{name:"Dual Radial",value:"dual-radial",description:"Two radial gradient spots"},{name:"Multi Radial",value:"multi-radial",description:"Multiple radial gradient spots"},{name:"Chaos",value:"chaos",description:"Colorful chaotic spots"},{name:"Grid",value:"grid",description:"Grid line pattern"},{name:"Diagonal Lines",value:"diagonal-lines",description:"Repeating diagonal lines"},{name:"Cross Diagonal",value:"cross-diagonal",description:"Crossed diagonal lines"},{name:"Horizontal Lines",value:"horizontal-lines",description:"Fine horizontal lines"},{name:"Vertical Lines",value:"vertical-lines",description:"Fine vertical lines"},{name:"Cross Pattern",value:"cross",description:"Cross/plus pattern"},{name:"Hexagons",value:"hexagons",description:"Hexagon pattern"},{name:"Stripes",value:"stripes",description:"Diagonal stripe pattern"},{name:"Frost",value:"frost",description:"Icy crystalline pattern with crossing lines"}],d2=({onSave:t,onCancel:n,onDelete:r,initialProtocol:s})=>{const[c,d]=J.useState("name"),[u,p]=J.useState(0),[f,h]=J.useState(!1),[y,m]=J.useState(""),[g,v]=J.useState(!1),C=s?hl(s):!1;console.log("ProtocolWizard render - initialProtocol:",s,"isReadOnly:",C);const[b,x]=J.useState((s==null?void 0:s.name)||""),[j,E]=J.useState((s==null?void 0:s.description)||""),[k,R]=J.useState((s==null?void 0:s.color)||"#1976D2"),[D,L]=J.useState((s==null?void 0:s.pattern)||"solid"),[I,F]=J.useState((s==null?void 0:s.cards)||[{value:0,topEffects:[],middleEffects:[],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[],bottomEffects:[]}]);console.log("ProtocolWizard state - name:",b,"color:",k,"pattern:",D);const U=()=>{if(c==="name"){if(!b.trim()){alert("Please enter a protocol name.");return}d("color")}else c==="color"?d("pattern"):c==="pattern"&&d("cards")},B=N=>{const T=[...I];T[u]=N,F(T)},G=()=>{const N={id:(s==null?void 0:s.id)||pt(),name:b,description:j,author:"Player",createdAt:(s==null?void 0:s.createdAt)||new Date().toISOString(),color:k,pattern:D,cards:I};t(N)},W=()=>{s&&r&&r(s.id),v(!1)},P=()=>{const N={id:(s==null?void 0:s.id)||pt(),name:b,description:j,author:"Player",createdAt:(s==null?void 0:s.createdAt)||new Date().toISOString(),color:k,pattern:D,cards:I},T=JSON.stringify(N,null,2);m(T),h(!0)},z=()=>{navigator.clipboard.writeText(y).then(()=>{alert("Protocol JSON copied to clipboard!"),h(!1)}).catch(()=>{alert("Failed to copy to clipboard. Please try again.")})},H=N=>!(!b.trim()&&N!=="name"),A=N=>{if(!H(N)){alert("Please enter a protocol name first.");return}d(N)};return o.jsxs("div",{className:"protocol-wizard",children:[o.jsxs("div",{className:"wizard-header",children:[o.jsxs("h2",{children:[C?`View Protocol: ${b}`:s?`Edit Protocol: ${b}`:"Create New Protocol",C&&o.jsx("span",{className:"read-only-badge",children:"Read-Only"})]}),o.jsxs("div",{className:"wizard-progress",children:[o.jsx("button",{className:`step ${c==="name"?"active":"done"}`,onClick:()=>A("name"),type:"button",children:"1. Name"}),o.jsx("button",{className:`step ${c==="color"?"active":c==="pattern"||c==="cards"?"done":""}`,onClick:()=>A("color"),disabled:!H("color"),type:"button",children:"2. Color"}),o.jsx("button",{className:`step ${c==="pattern"?"active":c==="cards"?"done":""}`,onClick:()=>A("pattern"),disabled:!H("pattern"),type:"button",children:"3. Pattern"}),o.jsx("button",{className:`step ${c==="cards"?"active":""}`,onClick:()=>A("cards"),disabled:!H("cards"),type:"button",children:"4. Cards"})]})]}),o.jsxs("div",{className:"wizard-content",children:[c==="name"&&o.jsxs("div",{className:"wizard-step name-step",children:[o.jsx("h3",{children:"Step 1: Name and Description"}),o.jsxs("label",{children:["Protocol Name *",o.jsx("input",{type:"text",value:b,onChange:N=>!C&&x(N.target.value),placeholder:"e.g. Lightning, Shadow, Void",autoFocus:!0,readOnly:C,className:C?"read-only":""})]}),o.jsxs("label",{children:["Description",o.jsx("textarea",{value:j,onChange:N=>!C&&E(N.target.value),placeholder:"Describe the strategy and theme of your protocol",rows:4,readOnly:C,className:C?"read-only":""})]})]}),c==="color"&&o.jsxs("div",{className:"wizard-step color-step",children:[o.jsx("h3",{children:"Step 2: Choose Color"}),o.jsx("div",{className:"color-preview",style:{backgroundColor:k},children:o.jsx("span",{children:b||"Your Protocol"})}),o.jsx("h4",{children:"Predefined Colors"}),o.jsx("div",{className:`color-grid ${C?"read-only":""}`,children:c2.map(N=>o.jsx("button",{className:`color-option ${k===N.hex?"selected":""}`,style:{backgroundColor:N.hex},onClick:()=>!C&&R(N.hex),title:N.name,disabled:C,children:k===N.hex&&""},N.hex))}),o.jsx("h4",{children:"Custom Color"}),o.jsxs("div",{className:"custom-color",children:[o.jsx("input",{type:"color",value:k,onChange:N=>!C&&R(N.target.value),disabled:C}),o.jsx("input",{type:"text",value:k,onChange:N=>!C&&R(N.target.value),placeholder:"#1976D2",readOnly:C,className:C?"read-only":""})]})]}),c==="pattern"&&o.jsxs("div",{className:"wizard-step pattern-step",children:[o.jsx("h3",{children:"Step 3: Choose Card Pattern"}),o.jsx("div",{className:`pattern-selection-grid ${C?"read-only":""}`,children:i2.map(N=>{const T=s2(N.value,k);return o.jsxs("div",{className:`pattern-option ${D===N.value?"selected":""}`,onClick:()=>!C&&L(N.value),children:[o.jsxs("div",{className:"pattern-preview",style:T,children:[b||"Protocol","-0"]}),o.jsx("h4",{children:N.name}),o.jsx("p",{children:N.description}),D===N.value&&o.jsx("div",{className:"selected-badge",children:" Selected"})]},N.value)})})]}),c==="cards"&&o.jsxs("div",{className:"wizard-step cards-step",children:[o.jsx("h3",{children:"Step 4: Configure Cards"}),o.jsx("div",{className:"card-navigation",children:I.map((N,T)=>o.jsxs("button",{className:`card-nav-btn ${u===T?"active":""}`,onClick:()=>p(T),type:"button",children:["Card ",N.value]},T))}),o.jsx(r2,{card:I[u],protocolName:b,protocolColor:k,protocolPattern:D,onChange:B,readOnly:C})]})]}),o.jsxs("div",{className:"wizard-actions",children:[o.jsxs("div",{className:"wizard-actions-left",children:[o.jsx("button",{onClick:n,className:"btn btn-back",children:C?"Back":"Cancel"}),s&&r&&!C&&o.jsx("button",{onClick:()=>v(!0),className:"btn btn-delete",children:"Delete Protocol"})]}),o.jsxs("div",{className:"wizard-actions-right",children:[s&&o.jsxs(o.Fragment,{children:[o.jsx("button",{onClick:P,className:"btn btn-export",children:"Export JSON"}),!C&&o.jsx("button",{onClick:G,className:"btn",children:"Save"})]}),!s&&o.jsxs(o.Fragment,{children:[c!=="cards"&&o.jsx("button",{onClick:U,className:"btn",children:"Next"}),c==="cards"&&o.jsxs(o.Fragment,{children:[o.jsx("button",{onClick:P,className:"btn btn-export",children:"Export JSON"}),o.jsx("button",{onClick:G,className:"btn",children:"Save"})]})]})]})]}),f&&o.jsx("div",{className:"custom-protocol-modal-overlay",onClick:()=>h(!1),children:o.jsxs("div",{className:"custom-protocol-modal-content custom-protocol-modal-large",onClick:N=>N.stopPropagation(),children:[o.jsx("h3",{children:"Export Protocol JSON"}),o.jsx("p",{children:"Copy the JSON below to share or backup your protocol:"}),o.jsx("textarea",{value:y,readOnly:!0,rows:15,className:"export-textarea",onClick:N=>N.target.select()}),o.jsxs("div",{className:"custom-protocol-modal-actions",children:[o.jsx("button",{onClick:()=>h(!1),className:"btn btn-back",children:"Close"}),o.jsx("button",{onClick:z,className:"btn",children:"Copy to Clipboard"})]})]})}),g&&o.jsx("div",{className:"custom-protocol-modal-overlay",onClick:()=>v(!1),children:o.jsxs("div",{className:"custom-protocol-modal-content",onClick:N=>N.stopPropagation(),children:[o.jsx("h3",{children:"Delete Protocol"}),o.jsxs("p",{children:['Are you sure you want to delete "',b,'"?']}),o.jsx("p",{style:{color:"var(--danger-color)",fontSize:"0.9rem"},children:"This action cannot be undone."}),o.jsxs("div",{className:"custom-protocol-modal-actions",children:[o.jsx("button",{onClick:()=>v(!1),className:"btn btn-back",children:"Cancel"}),o.jsx("button",{onClick:W,className:"btn btn-delete",children:"Delete"})]})]})})]})},u2=({onBack:t})=>{const[n,r]=J.useState("list"),[s,c]=J.useState([]),[d,u]=J.useState(void 0);J.useEffect(()=>{p()},[]);const p=()=>{const C=jr();c(C)},f=()=>{u(void 0),r("create")},h=C=>{console.log("handleEdit called with protocol:",C),u(C),r("edit"),console.log("View set to edit, editingProtocol:",C)},y=C=>{Fw(C),hs(),p(),r("list"),u(void 0)},m=C=>{kt(C),hs(),p(),r("list"),u(void 0)},g=C=>{kt(C),hs(),p()},v=()=>{r("list"),u(void 0)};return o.jsxs("div",{className:"custom-protocol-creator",children:[n==="list"&&o.jsx(Pw,{protocols:s,onCreateNew:f,onEdit:h,onDelete:y,onImport:g,onBack:t}),(n==="create"||n==="edit")&&o.jsx(d2,{onSave:m,onCancel:v,onDelete:y,initialProtocol:d})]})},p2={id:"spirit-1-example",protocol:"Spirit",value:1,top:"When you play cards face-up, they may be played without matching protocols.",middle:"Draw 2 cards.",bottom:'<span class="emphasis">Start:</span> Either discard 1 card or flip this card.',isFaceUp:!0,category:"Main 1",keywords:{}},f2={id:"face-down-example",protocol:"Spirit",value:1,top:"",middle:"",bottom:"",isFaceUp:!1,category:"Main 1",keywords:{}},h2=[{id:"opp-light-4",protocol:"Light",value:4,top:"",middle:"Your opponent reveals their hand.",bottom:"",isFaceUp:!0,category:"Main 1",keywords:{reveal:!0}}],m2=[{id:"opp-spirit-3",protocol:"Spirit",value:3,top:"<div><span class='emphasis'>After you draw cards:</span> You may shift this card, even if this card is covered.</div>",middle:"",bottom:"",isFaceUp:!0,category:"Main 1",keywords:{shift:!0}},{id:"opp-spirit-2",protocol:"Spirit",value:2,top:"",middle:"You may flip 1 card.",bottom:"",isFaceUp:!0,category:"Main 1",keywords:{flip:!0}}],y2=[{id:"opp-water-3",protocol:"Water",value:3,top:"",middle:"Return all cards with a value of 2 in 1 line.",bottom:"",isFaceUp:!0,category:"Main 1",keywords:{return:!0}}],g2=[{id:"player-darkness-5",protocol:"Darkness",value:5,top:"",middle:"You discard 1 card.",bottom:"",isFaceUp:!0,category:"Main 1",keywords:{discard:!0}},{id:"player-facedown-0",protocol:"Darkness",value:2,top:"",middle:"",bottom:"",isFaceUp:!1,category:"Main 1",keywords:{}}],v2=[{id:"player-plague-1",protocol:"Plague",value:1,top:"<div><span class='emphasis'>After your opponent discards cards:</span> Draw 1 card.</div>",middle:"Your opponent discards 1 card.",bottom:"",isFaceUp:!0,category:"Main 1",keywords:{draw:!0,discard:!0}},{id:"player-plague-5",protocol:"Plague",value:5,top:"",middle:"You discard 1 card.",bottom:"",isFaceUp:!0,category:"Main 1",keywords:{discard:!0}},{id:"player-plague-4",protocol:"Plague",value:4,top:"",middle:"",bottom:"<div><span class='emphasis'>End:</span> Your opponent deletes 1 of their face-down cards. You may flip this card.</div>",isFaceUp:!0,category:"Main 1",keywords:{delete:!0,flip:!0}}],_2=[{id:"player-death-0",protocol:"Death",value:0,top:"",middle:"Delete 1 card from each other line.",bottom:"",isFaceUp:!0,category:"Main 1",keywords:{delete:!0}},{id:"player-facedown-3",protocol:"Death",value:2,top:"",middle:"",bottom:"",isFaceUp:!1,category:"Main 1",keywords:{}}],Yo={opponent:["Light","Spirit","Water"],player:["Darkness","Plague","Death"],opponentCompiled:[!0,!1,!1],playerCompiled:[!1,!1,!1],opponentValues:[4,5,3],playerValues:[7,10,2]};function w2({onBack:t}){const n=[h2,m2,y2],r=[g2,v2,_2];return o.jsxs("div",{className:"screen rules-screen",children:[o.jsx(Gc,{title:"GAME RULES",onBack:t}),o.jsxs("div",{className:"rules-content",children:[o.jsxs("section",{className:"rules-section",children:[o.jsx("h2",{className:"section-title",children:"Objective"}),o.jsxs("div",{className:"rules-text",children:[o.jsxs("p",{children:["You play as an artificial intelligence trying to ",o.jsx("span",{className:"emphasis",children:"compile your 3 protocols"}),". Play command cards on protocols and execute their effects. If you reach a total value of",o.jsx("span",{className:"emphasis",children:" at least 10"})," with your cards on a protocol and exceed the opponent's total value in the same line, you may compile that protocol."]}),o.jsx("p",{className:"rules-highlight",children:"The first player to compile all 3 protocols wins!"})]})]}),o.jsxs("section",{className:"rules-section field-overview-section",children:[o.jsx("h2",{className:"section-title",children:"The Field"}),o.jsx("div",{className:"field-intro",children:o.jsxs("p",{children:["The field consists of ",o.jsx("span",{className:"emphasis",children:"3 lines"}),", each passing through two opposing protocols. Both players place cards on their side of each line. The goal is to build up value in your stacks to reach the compile threshold."]})}),o.jsxs("div",{className:"demo-board-container",children:[o.jsxs("div",{className:"demo-board",children:[o.jsx("div",{className:"demo-side-label opponent-label",children:"Opponent"}),o.jsx("div",{className:"demo-player-side demo-opponent-side",children:o.jsx("div",{className:"demo-lanes",children:n.map((s,c)=>o.jsx("div",{className:`demo-lane ${Yo.opponentCompiled[c]?"demo-lane-compiled":""}`,children:o.jsx("div",{className:"demo-lane-stack",children:s.map((d,u)=>o.jsx(St,{card:d,isFaceUp:d.isFaceUp,style:{"--i":u},faceDownValue:2},d.id))})},`opp-lane-${c}`))})}),o.jsxs("div",{className:"demo-protocol-bars-container",children:[o.jsx("div",{className:"demo-protocol-bar demo-opponent-bar",children:Yo.opponent.map((s,c)=>o.jsxs("div",{className:`demo-protocol-display ${Yo.opponentCompiled[c]?"compiled":""}`,children:[o.jsx("span",{className:"demo-protocol-name",children:s}),o.jsx("span",{className:"demo-protocol-value",children:Yo.opponentValues[c]})]},`opp-proto-${c}`))}),o.jsx("div",{className:"demo-protocol-bar demo-player-bar",children:Yo.player.map((s,c)=>o.jsxs("div",{className:`demo-protocol-display ${Yo.playerCompiled[c]?"compiled":""}`,children:[o.jsx("span",{className:"demo-protocol-name",children:s}),o.jsx("span",{className:"demo-protocol-value",children:Yo.playerValues[c]})]},`player-proto-${c}`))})]}),o.jsx("div",{className:"demo-player-side",children:o.jsx("div",{className:"demo-lanes",children:r.map((s,c)=>o.jsx("div",{className:`demo-lane ${Yo.playerCompiled[c]?"demo-lane-compiled":""} ${c===1?"demo-lane-compilable":""}`,children:o.jsx("div",{className:"demo-lane-stack",children:s.map((d,u)=>o.jsx(St,{card:d,isFaceUp:d.isFaceUp,style:{"--i":u},faceDownValue:2},d.id))})},`player-lane-${c}`))})}),o.jsx("div",{className:"demo-side-label player-label",children:"You"})]}),o.jsxs("div",{className:"demo-board-annotations",children:[o.jsxs("div",{className:"demo-annotation compiled-annotation",children:[o.jsx("div",{className:"demo-annotation-marker compiled-marker",children:"1"}),o.jsxs("div",{className:"demo-annotation-content",children:[o.jsx("strong",{children:"Compiled Protocol"}),o.jsx("p",{children:"Light has been compiled by the opponent! The protocol bar glows cyan."})]})]}),o.jsxs("div",{className:"demo-annotation compilable-annotation",children:[o.jsx("div",{className:"demo-annotation-marker compilable-marker",children:"2"}),o.jsxs("div",{className:"demo-annotation-content",children:[o.jsx("strong",{children:"Ready to Compile!"}),o.jsx("p",{children:"Plague has value 10 (1+5+4) which is 10 and higher than opponent's Spirit at 5. This protocol can be compiled!"})]})]}),o.jsxs("div",{className:"demo-annotation inprogress-annotation",children:[o.jsx("div",{className:"demo-annotation-marker inprogress-marker",children:"3"}),o.jsxs("div",{className:"demo-annotation-content",children:[o.jsx("strong",{children:"In Progress"}),o.jsx("p",{children:"Death/Water lanes are still building up. Keep playing cards to reach the compile threshold of 10!"})]})]}),o.jsxs("div",{className:"demo-annotation topbox-annotation",children:[o.jsx("div",{className:"demo-annotation-marker topbox-marker",children:"4"}),o.jsxs("div",{className:"demo-annotation-content",children:[o.jsx("strong",{children:"Top Effect Always Visible"}),o.jsx("p",{children:"See Plague-1's top effect? It stays active even when covered! Top effects are always visible and active on face-up cards."})]})]})]})]}),o.jsxs("div",{className:"field-legend",children:[o.jsxs("div",{className:"legend-item",children:[o.jsx("div",{className:"legend-swatch legend-compiled"}),o.jsx("span",{children:"Compiled Protocol"})]}),o.jsxs("div",{className:"legend-item",children:[o.jsx("div",{className:"legend-swatch legend-compilable"}),o.jsx("span",{children:"Ready to Compile (10 value & higher than opponent)"})]}),o.jsxs("div",{className:"legend-item",children:[o.jsx("div",{className:"legend-swatch legend-facedown"}),o.jsx("span",{children:"Face-down Card (base value: 2)"})]})]})]}),o.jsxs("section",{className:"rules-section card-anatomy-section",children:[o.jsx("h2",{className:"section-title",children:"Card Anatomy"}),o.jsxs("div",{className:"card-anatomy-layout",children:[o.jsx("div",{className:"card-anatomy-display",children:o.jsxs("div",{className:"anatomy-card-wrapper",children:[o.jsx(St,{card:p2,isFaceUp:!0}),o.jsxs("div",{className:"anatomy-annotation annotation-protocol",children:[o.jsx("div",{className:"annotation-line annotation-line-left"}),o.jsxs("div",{className:"annotation-label",children:[o.jsx("span",{className:"annotation-letter",children:"A"}),o.jsx("span",{className:"annotation-text",children:"Protocol"})]})]}),o.jsxs("div",{className:"anatomy-annotation annotation-value",children:[o.jsx("div",{className:"annotation-line annotation-line-right"}),o.jsxs("div",{className:"annotation-label",children:[o.jsx("span",{className:"annotation-letter",children:"B"}),o.jsx("span",{className:"annotation-text",children:"Value"})]})]}),o.jsxs("div",{className:"anatomy-annotation annotation-top",children:[o.jsx("div",{className:"annotation-line annotation-line-right"}),o.jsxs("div",{className:"annotation-label",children:[o.jsx("span",{className:"annotation-letter",children:"C"}),o.jsx("span",{className:"annotation-text",children:"Top Effect"})]})]}),o.jsxs("div",{className:"anatomy-annotation annotation-middle",children:[o.jsx("div",{className:"annotation-line annotation-line-right"}),o.jsxs("div",{className:"annotation-label",children:[o.jsx("span",{className:"annotation-letter",children:"D"}),o.jsx("span",{className:"annotation-text",children:"Middle Effect"})]})]}),o.jsxs("div",{className:"anatomy-annotation annotation-bottom",children:[o.jsx("div",{className:"annotation-line annotation-line-right"}),o.jsxs("div",{className:"annotation-label",children:[o.jsx("span",{className:"annotation-letter",children:"E"}),o.jsx("span",{className:"annotation-text",children:"Bottom Effect"})]})]})]})}),o.jsxs("div",{className:"card-anatomy-descriptions",children:[o.jsxs("div",{className:"anatomy-item",children:[o.jsx("span",{className:"anatomy-letter",children:"A"}),o.jsxs("div",{className:"anatomy-desc",children:[o.jsx("strong",{children:"Protocol Indicator"}),o.jsx("p",{children:"Dictates which line a card can be played face-up in. Cards must match the protocol of that line."})]})]}),o.jsxs("div",{className:"anatomy-item",children:[o.jsx("span",{className:"anatomy-letter",children:"B"}),o.jsxs("div",{className:"anatomy-desc",children:[o.jsx("strong",{children:"Value"}),o.jsx("p",{children:"The value added to the total value of a stack. Higher values help you reach the compile threshold of 10."})]})]}),o.jsxs("div",{className:"anatomy-item anatomy-item-highlight",children:[o.jsx("span",{className:"anatomy-letter",children:"C"}),o.jsxs("div",{className:"anatomy-desc",children:[o.jsx("strong",{children:"Top Command - Persistent"}),o.jsxs("p",{children:["While this card is face-up, this passive text is ",o.jsx("span",{className:"emphasis",children:"always active"}),", even when covered by other cards."]})]})]}),o.jsxs("div",{className:"anatomy-item anatomy-item-highlight",children:[o.jsx("span",{className:"anatomy-letter",children:"D"}),o.jsxs("div",{className:"anatomy-desc",children:[o.jsx("strong",{children:"Middle Command - Immediate"}),o.jsx("p",{children:"Resolve this active text immediately when the card is played, flipped face-up, or uncovered."})]})]}),o.jsxs("div",{className:"anatomy-item anatomy-item-highlight",children:[o.jsx("span",{className:"anatomy-letter",children:"E"}),o.jsxs("div",{className:"anatomy-desc",children:[o.jsx("strong",{children:"Bottom Command - Auxiliary"}),o.jsxs("p",{children:['This passive text (often triggered effects like "Start:" or "End:") is only active when the card is ',o.jsx("span",{className:"emphasis",children:"uncovered"}),"."]})]})]})]})]})]}),o.jsxs("section",{className:"rules-section face-down-section",children:[o.jsx("h2",{className:"section-title",children:"Face-Down Cards"}),o.jsxs("div",{className:"face-down-layout",children:[o.jsx("div",{className:"face-down-card-wrapper",children:o.jsx(St,{card:f2,isFaceUp:!1,faceDownValue:2})}),o.jsxs("div",{className:"face-down-description",children:[o.jsxs("p",{children:["Cards can be played ",o.jsx("span",{className:"emphasis",children:"face-down"})," into any line, regardless of protocol matching."]}),o.jsxs("ul",{children:[o.jsxs("li",{children:["Face-down cards have a ",o.jsx("span",{className:"emphasis",children:"base value of 2"})]}),o.jsx("li",{children:"No effects are active while face-down"}),o.jsx("li",{children:"Can be flipped face-up by card effects"}),o.jsx("li",{children:"When flipped, the middle effect triggers"}),o.jsx("li",{children:"Some cards modify face-down values (e.g., Darkness-2)"})]})]})]})]}),o.jsxs("section",{className:"rules-section",children:[o.jsx("h2",{className:"section-title",children:"Turn Order"}),o.jsxs("div",{className:"turn-order-grid",children:[o.jsxs("div",{className:"turn-phase",children:[o.jsx("span",{className:"phase-number",children:"1"}),o.jsxs("div",{className:"phase-content",children:[o.jsx("strong",{children:"Start Phase"}),o.jsx("p",{children:'Resolve all visible "Start" effects of your face-up command cards.'})]})]}),o.jsxs("div",{className:"turn-phase",children:[o.jsx("span",{className:"phase-number",children:"2"}),o.jsxs("div",{className:"phase-content",children:[o.jsx("strong",{children:"Check Control"}),o.jsx("p",{children:"If your total value is higher than opponent's in at least 2 lines, take the control component."})]})]}),o.jsxs("div",{className:"turn-phase",children:[o.jsx("span",{className:"phase-number",children:"3"}),o.jsxs("div",{className:"phase-content",children:[o.jsx("strong",{children:"Check Compile"}),o.jsx("p",{children:"If you can compile (10+ value and higher than opponent), you must compile one protocol."})]})]}),o.jsxs("div",{className:"turn-phase",children:[o.jsx("span",{className:"phase-number",children:"4"}),o.jsxs("div",{className:"phase-content",children:[o.jsx("strong",{children:"Action"}),o.jsx("p",{children:"Play 1 card from hand OR refresh your hand (draw until you have 5 cards)."})]})]}),o.jsxs("div",{className:"turn-phase",children:[o.jsx("span",{className:"phase-number",children:"5"}),o.jsxs("div",{className:"phase-content",children:[o.jsx("strong",{children:"Check Cache"}),o.jsx("p",{children:"If you have more than 5 cards, discard down to 5."})]})]}),o.jsxs("div",{className:"turn-phase",children:[o.jsx("span",{className:"phase-number",children:"6"}),o.jsxs("div",{className:"phase-content",children:[o.jsx("strong",{children:"End Phase"}),o.jsx("p",{children:'Resolve all visible "End" effects of your face-up command cards.'})]})]})]})]}),o.jsxs("section",{className:"rules-section glossary-section",children:[o.jsx("h2",{className:"section-title",children:"Glossary"}),o.jsxs("div",{className:"glossary-grid",children:[o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Compile"}),o.jsx("p",{children:'Delete all cards in a line on both sides and flip your protocol to "Compiled".'})]}),o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Covered"}),o.jsx("p",{children:"A card with another card on top of it. Only top effects remain active."})]}),o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Uncovered"}),o.jsx("p",{children:"The topmost card in a stack, furthest from the protocol."})]}),o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Delete"}),o.jsx("p",{children:"Move a card from the field to the trash."})]}),o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Discard"}),o.jsx("p",{children:"Move a card from hand to the owner's trash."})]}),o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Flip"}),o.jsx("p",{children:"Change a card from face-down to face-up, or vice versa."})]}),o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Shift"}),o.jsx("p",{children:"Move a card to another line on the same side of the field."})]}),o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Return"}),o.jsx("p",{children:"Move a card from the field to its owner's hand."})]}),o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Reveal"}),o.jsx("p",{children:"Show hidden information publicly, then return it to its previous state."})]}),o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Refresh"}),o.jsx("p",{children:"Draw cards until you have 5 cards in hand."})]}),o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Line"}),o.jsx("p",{children:"The area passing through two opposing protocols. The field has 3 lines."})]}),o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Stack"}),o.jsx("p",{children:"The cards in a line on one player's side."})]})]})]})]})]})}function x2(){const[t,n]=J.useState("MainMenu"),[r,s]=J.useState([]),[c,d]=J.useState([]),[u,p]=J.useState(null),[f,h]=J.useState("easy"),[y,m]=J.useState(null),[g,v]=J.useState(!0),[C,b]=J.useState("player"),[x,j]=J.useState(null);J.useEffect(()=>{hk()},[]),J.useEffect(()=>{const L=new URLSearchParams(window.location.search),I=L.get("testScenario"),F=L.get("scenario");if(I&&(console.log(`[E2E] Loading JSON test scenario: ${I}`),fetch(`/e2e/scenarios/${I}.json`).then(U=>{if(!U.ok)throw new Error(`Scenario not found: ${I}`);return U.json()}).then(U=>{console.log("[E2E] Scenario loaded:",U),h(U.difficulty),v(U.useControlMechanic),s(U.playerProtocols),d(U.opponentProtocols),b(U.startingPlayer),n("GameScreen")}).catch(U=>{console.error("[E2E] Failed to load scenario:",U)})),F){console.log(`[E2E] Loading complex scenario: ${F}`);const U=Ru[F];U?(console.log("[E2E] Complex scenario found:",U.name),j(()=>U.setup),s(["Fire","Water","Speed"]),d(["Death","Life","Light"]),h("easy"),v(!1),n("GameScreen")):(console.error(`[E2E] Scenario not found: ${F}`),console.log("[E2E] Available scenarios:",Object.keys(Ru).filter(B=>B.startsWith("scenario"))))}},[]);const E=J.useCallback(()=>{n("MainMenu"),s([]),d([]),p(null),m(null)},[]);J.useEffect(()=>{const L=I=>{I.key==="Escape"&&E()};return window.addEventListener("keydown",L),()=>{window.removeEventListener("keydown",L)}},[E]);const k=J.useCallback((L,I)=>{s(L),d(I),p(null),m(null),b("player"),n("GameScreen")},[]),R=J.useCallback((L,I)=>{p(L),m(I),n("ResultsScreen")},[]),D=()=>{switch(t){case"MainMenu":return o.jsx(Am,{onNavigate:L=>n(L),difficulty:f,setDifficulty:h,useControl:g,onUseControlChange:v});case"ProtocolSelection":return o.jsx(Uw,{onBack:E,onStartGame:k});case"GameScreen":return o.jsx(Ok,{onBack:E,onEndGame:R,playerProtocols:r,opponentProtocols:c,difficulty:f,useControlMechanic:g,startingPlayer:C,initialScenarioSetup:x});case"ResultsScreen":return o.jsx(Hk,{onPlayAgain:E,winner:u,finalState:y,difficulty:f});case"CardLibrary":return o.jsx(Vk,{onBack:E});case"Statistics":return o.jsx(zk,{onBack:E});case"CustomProtocols":return o.jsx(u2,{onBack:E});case"Rules":return o.jsx(w2,{onBack:E});default:return o.jsx(Am,{onNavigate:L=>n(L),difficulty:f,setDifficulty:h,useControl:g,onUseControlChange:v})}};return o.jsx(o.Fragment,{children:D()})}const C2=document.getElementById("root"),S2=kw.createRoot(C2);S2.render(o.jsx(x2,{}));
