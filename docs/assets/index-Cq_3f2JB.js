(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))c(s);new MutationObserver(s=>{for(const d of s)if(d.type==="childList")for(const p of d.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&c(p)}).observe(document,{childList:!0,subtree:!0});function l(s){const d={};return s.integrity&&(d.integrity=s.integrity),s.referrerPolicy&&(d.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?d.credentials="include":s.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function c(s){if(s.ep)return;s.ep=!0;const d=l(s);fetch(s.href,d)}})();var od={exports:{}},xl={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ih;function $v(){if(ih)return xl;ih=1;var a=Symbol.for("react.transitional.element"),n=Symbol.for("react.fragment");function l(c,s,d){var p=null;if(d!==void 0&&(p=""+d),s.key!==void 0&&(p=""+s.key),"key"in s){d={};for(var f in s)f!=="key"&&(d[f]=s[f])}else d=s;return s=d.ref,{$$typeof:a,type:c,key:p,ref:s!==void 0?s:null,props:d}}return xl.Fragment=n,xl.jsx=l,xl.jsxs=l,xl}var ch;function Uv(){return ch||(ch=1,od.exports=$v()),od.exports}var r=Uv(),rd={exports:{}},wl={},ld={exports:{}},id={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var sh;function Ov(){return sh||(sh=1,(function(a){function n(D,O){var X=D.length;D.push(O);e:for(;0<X;){var ne=X-1>>>1,z=D[ne];if(0<s(z,O))D[ne]=O,D[X]=z,X=ne;else break e}}function l(D){return D.length===0?null:D[0]}function c(D){if(D.length===0)return null;var O=D[0],X=D.pop();if(X!==O){D[0]=X;e:for(var ne=0,z=D.length,G=z>>>1;ne<G;){var Z=2*(ne+1)-1,Q=D[Z],I=Z+1,W=D[I];if(0>s(Q,X))I<z&&0>s(W,Q)?(D[ne]=W,D[I]=X,ne=I):(D[ne]=Q,D[Z]=X,ne=Z);else if(I<z&&0>s(W,X))D[ne]=W,D[I]=X,ne=I;else break e}}return O}function s(D,O){var X=D.sortIndex-O.sortIndex;return X!==0?X:D.id-O.id}if(a.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var d=performance;a.unstable_now=function(){return d.now()}}else{var p=Date,f=p.now();a.unstable_now=function(){return p.now()-f}}var h=[],m=[],g=1,y=null,w=3,_=!1,b=!1,k=!1,S=!1,$=typeof setTimeout=="function"?setTimeout:null,E=typeof clearTimeout=="function"?clearTimeout:null,C=typeof setImmediate<"u"?setImmediate:null;function N(D){for(var O=l(m);O!==null;){if(O.callback===null)c(m);else if(O.startTime<=D)c(m),O.sortIndex=O.expirationTime,n(h,O);else break;O=l(m)}}function T(D){if(k=!1,N(D),!b)if(l(h)!==null)b=!0,H||(H=!0,j());else{var O=l(m);O!==null&&L(T,O.startTime-D)}}var H=!1,q=-1,B=5,K=-1;function U(){return S?!0:!(a.unstable_now()-K<B)}function R(){if(S=!1,H){var D=a.unstable_now();K=D;var O=!0;try{e:{b=!1,k&&(k=!1,E(q),q=-1),_=!0;var X=w;try{t:{for(N(D),y=l(h);y!==null&&!(y.expirationTime>D&&U());){var ne=y.callback;if(typeof ne=="function"){y.callback=null,w=y.priorityLevel;var z=ne(y.expirationTime<=D);if(D=a.unstable_now(),typeof z=="function"){y.callback=z,N(D),O=!0;break t}y===l(h)&&c(h),N(D)}else c(h);y=l(h)}if(y!==null)O=!0;else{var G=l(m);G!==null&&L(T,G.startTime-D),O=!1}}break e}finally{y=null,w=X,_=!1}O=void 0}}finally{O?j():H=!1}}}var j;if(typeof C=="function")j=function(){C(R)};else if(typeof MessageChannel<"u"){var F=new MessageChannel,M=F.port2;F.port1.onmessage=R,j=function(){M.postMessage(null)}}else j=function(){$(R,0)};function L(D,O){q=$(function(){D(a.unstable_now())},O)}a.unstable_IdlePriority=5,a.unstable_ImmediatePriority=1,a.unstable_LowPriority=4,a.unstable_NormalPriority=3,a.unstable_Profiling=null,a.unstable_UserBlockingPriority=2,a.unstable_cancelCallback=function(D){D.callback=null},a.unstable_forceFrameRate=function(D){0>D||125<D?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):B=0<D?Math.floor(1e3/D):5},a.unstable_getCurrentPriorityLevel=function(){return w},a.unstable_next=function(D){switch(w){case 1:case 2:case 3:var O=3;break;default:O=w}var X=w;w=O;try{return D()}finally{w=X}},a.unstable_requestPaint=function(){S=!0},a.unstable_runWithPriority=function(D,O){switch(D){case 1:case 2:case 3:case 4:case 5:break;default:D=3}var X=w;w=D;try{return O()}finally{w=X}},a.unstable_scheduleCallback=function(D,O,X){var ne=a.unstable_now();switch(typeof X=="object"&&X!==null?(X=X.delay,X=typeof X=="number"&&0<X?ne+X:ne):X=ne,D){case 1:var z=-1;break;case 2:z=250;break;case 5:z=1073741823;break;case 4:z=1e4;break;default:z=5e3}return z=X+z,D={id:g++,callback:O,priorityLevel:D,startTime:X,expirationTime:z,sortIndex:-1},X>ne?(D.sortIndex=X,n(m,D),l(h)===null&&D===l(m)&&(k?(E(q),q=-1):k=!0,L(T,X-ne))):(D.sortIndex=z,n(h,D),b||_||(b=!0,H||(H=!0,j()))),D},a.unstable_shouldYield=U,a.unstable_wrapCallback=function(D){var O=w;return function(){var X=w;w=O;try{return D.apply(this,arguments)}finally{w=X}}}})(id)),id}var dh;function Iv(){return dh||(dh=1,ld.exports=Ov()),ld.exports}var cd={exports:{}},He={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var uh;function Lv(){if(uh)return He;uh=1;var a=Symbol.for("react.transitional.element"),n=Symbol.for("react.portal"),l=Symbol.for("react.fragment"),c=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),d=Symbol.for("react.consumer"),p=Symbol.for("react.context"),f=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),m=Symbol.for("react.memo"),g=Symbol.for("react.lazy"),y=Symbol.iterator;function w(z){return z===null||typeof z!="object"?null:(z=y&&z[y]||z["@@iterator"],typeof z=="function"?z:null)}var _={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},b=Object.assign,k={};function S(z,G,Z){this.props=z,this.context=G,this.refs=k,this.updater=Z||_}S.prototype.isReactComponent={},S.prototype.setState=function(z,G){if(typeof z!="object"&&typeof z!="function"&&z!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,z,G,"setState")},S.prototype.forceUpdate=function(z){this.updater.enqueueForceUpdate(this,z,"forceUpdate")};function $(){}$.prototype=S.prototype;function E(z,G,Z){this.props=z,this.context=G,this.refs=k,this.updater=Z||_}var C=E.prototype=new $;C.constructor=E,b(C,S.prototype),C.isPureReactComponent=!0;var N=Array.isArray,T={H:null,A:null,T:null,S:null,V:null},H=Object.prototype.hasOwnProperty;function q(z,G,Z,Q,I,W){return Z=W.ref,{$$typeof:a,type:z,key:G,ref:Z!==void 0?Z:null,props:W}}function B(z,G){return q(z.type,G,void 0,void 0,void 0,z.props)}function K(z){return typeof z=="object"&&z!==null&&z.$$typeof===a}function U(z){var G={"=":"=0",":":"=2"};return"$"+z.replace(/[=:]/g,function(Z){return G[Z]})}var R=/\/+/g;function j(z,G){return typeof z=="object"&&z!==null&&z.key!=null?U(""+z.key):G.toString(36)}function F(){}function M(z){switch(z.status){case"fulfilled":return z.value;case"rejected":throw z.reason;default:switch(typeof z.status=="string"?z.then(F,F):(z.status="pending",z.then(function(G){z.status==="pending"&&(z.status="fulfilled",z.value=G)},function(G){z.status==="pending"&&(z.status="rejected",z.reason=G)})),z.status){case"fulfilled":return z.value;case"rejected":throw z.reason}}throw z}function L(z,G,Z,Q,I){var W=typeof z;(W==="undefined"||W==="boolean")&&(z=null);var Y=!1;if(z===null)Y=!0;else switch(W){case"bigint":case"string":case"number":Y=!0;break;case"object":switch(z.$$typeof){case a:case n:Y=!0;break;case g:return Y=z._init,L(Y(z._payload),G,Z,Q,I)}}if(Y)return I=I(z),Y=Q===""?"."+j(z,0):Q,N(I)?(Z="",Y!=null&&(Z=Y.replace(R,"$&/")+"/"),L(I,G,Z,"",function(ge){return ge})):I!=null&&(K(I)&&(I=B(I,Z+(I.key==null||z&&z.key===I.key?"":(""+I.key).replace(R,"$&/")+"/")+Y)),G.push(I)),1;Y=0;var de=Q===""?".":Q+":";if(N(z))for(var ee=0;ee<z.length;ee++)Q=z[ee],W=de+j(Q,ee),Y+=L(Q,G,Z,W,I);else if(ee=w(z),typeof ee=="function")for(z=ee.call(z),ee=0;!(Q=z.next()).done;)Q=Q.value,W=de+j(Q,ee++),Y+=L(Q,G,Z,W,I);else if(W==="object"){if(typeof z.then=="function")return L(M(z),G,Z,Q,I);throw G=String(z),Error("Objects are not valid as a React child (found: "+(G==="[object Object]"?"object with keys {"+Object.keys(z).join(", ")+"}":G)+"). If you meant to render a collection of children, use an array instead.")}return Y}function D(z,G,Z){if(z==null)return z;var Q=[],I=0;return L(z,Q,"","",function(W){return G.call(Z,W,I++)}),Q}function O(z){if(z._status===-1){var G=z._result;G=G(),G.then(function(Z){(z._status===0||z._status===-1)&&(z._status=1,z._result=Z)},function(Z){(z._status===0||z._status===-1)&&(z._status=2,z._result=Z)}),z._status===-1&&(z._status=0,z._result=G)}if(z._status===1)return z._result.default;throw z._result}var X=typeof reportError=="function"?reportError:function(z){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var G=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof z=="object"&&z!==null&&typeof z.message=="string"?String(z.message):String(z),error:z});if(!window.dispatchEvent(G))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",z);return}console.error(z)};function ne(){}return He.Children={map:D,forEach:function(z,G,Z){D(z,function(){G.apply(this,arguments)},Z)},count:function(z){var G=0;return D(z,function(){G++}),G},toArray:function(z){return D(z,function(G){return G})||[]},only:function(z){if(!K(z))throw Error("React.Children.only expected to receive a single React element child.");return z}},He.Component=S,He.Fragment=l,He.Profiler=s,He.PureComponent=E,He.StrictMode=c,He.Suspense=h,He.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=T,He.__COMPILER_RUNTIME={__proto__:null,c:function(z){return T.H.useMemoCache(z)}},He.cache=function(z){return function(){return z.apply(null,arguments)}},He.cloneElement=function(z,G,Z){if(z==null)throw Error("The argument must be a React element, but you passed "+z+".");var Q=b({},z.props),I=z.key,W=void 0;if(G!=null)for(Y in G.ref!==void 0&&(W=void 0),G.key!==void 0&&(I=""+G.key),G)!H.call(G,Y)||Y==="key"||Y==="__self"||Y==="__source"||Y==="ref"&&G.ref===void 0||(Q[Y]=G[Y]);var Y=arguments.length-2;if(Y===1)Q.children=Z;else if(1<Y){for(var de=Array(Y),ee=0;ee<Y;ee++)de[ee]=arguments[ee+2];Q.children=de}return q(z.type,I,void 0,void 0,W,Q)},He.createContext=function(z){return z={$$typeof:p,_currentValue:z,_currentValue2:z,_threadCount:0,Provider:null,Consumer:null},z.Provider=z,z.Consumer={$$typeof:d,_context:z},z},He.createElement=function(z,G,Z){var Q,I={},W=null;if(G!=null)for(Q in G.key!==void 0&&(W=""+G.key),G)H.call(G,Q)&&Q!=="key"&&Q!=="__self"&&Q!=="__source"&&(I[Q]=G[Q]);var Y=arguments.length-2;if(Y===1)I.children=Z;else if(1<Y){for(var de=Array(Y),ee=0;ee<Y;ee++)de[ee]=arguments[ee+2];I.children=de}if(z&&z.defaultProps)for(Q in Y=z.defaultProps,Y)I[Q]===void 0&&(I[Q]=Y[Q]);return q(z,W,void 0,void 0,null,I)},He.createRef=function(){return{current:null}},He.forwardRef=function(z){return{$$typeof:f,render:z}},He.isValidElement=K,He.lazy=function(z){return{$$typeof:g,_payload:{_status:-1,_result:z},_init:O}},He.memo=function(z,G){return{$$typeof:m,type:z,compare:G===void 0?null:G}},He.startTransition=function(z){var G=T.T,Z={};T.T=Z;try{var Q=z(),I=T.S;I!==null&&I(Z,Q),typeof Q=="object"&&Q!==null&&typeof Q.then=="function"&&Q.then(ne,X)}catch(W){X(W)}finally{T.T=G}},He.unstable_useCacheRefresh=function(){return T.H.useCacheRefresh()},He.use=function(z){return T.H.use(z)},He.useActionState=function(z,G,Z){return T.H.useActionState(z,G,Z)},He.useCallback=function(z,G){return T.H.useCallback(z,G)},He.useContext=function(z){return T.H.useContext(z)},He.useDebugValue=function(){},He.useDeferredValue=function(z,G){return T.H.useDeferredValue(z,G)},He.useEffect=function(z,G,Z){var Q=T.H;if(typeof Z=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return Q.useEffect(z,G)},He.useId=function(){return T.H.useId()},He.useImperativeHandle=function(z,G,Z){return T.H.useImperativeHandle(z,G,Z)},He.useInsertionEffect=function(z,G){return T.H.useInsertionEffect(z,G)},He.useLayoutEffect=function(z,G){return T.H.useLayoutEffect(z,G)},He.useMemo=function(z,G){return T.H.useMemo(z,G)},He.useOptimistic=function(z,G){return T.H.useOptimistic(z,G)},He.useReducer=function(z,G,Z){return T.H.useReducer(z,G,Z)},He.useRef=function(z){return T.H.useRef(z)},He.useState=function(z){return T.H.useState(z)},He.useSyncExternalStore=function(z,G,Z){return T.H.useSyncExternalStore(z,G,Z)},He.useTransition=function(){return T.H.useTransition()},He.version="19.1.1",He}var ph;function Sd(){return ph||(ph=1,cd.exports=Lv()),cd.exports}var sd={exports:{}},Gt={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var fh;function Mv(){if(fh)return Gt;fh=1;var a=Sd();function n(h){var m="https://react.dev/errors/"+h;if(1<arguments.length){m+="?args[]="+encodeURIComponent(arguments[1]);for(var g=2;g<arguments.length;g++)m+="&args[]="+encodeURIComponent(arguments[g])}return"Minified React error #"+h+"; visit "+m+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function l(){}var c={d:{f:l,r:function(){throw Error(n(522))},D:l,C:l,L:l,m:l,X:l,S:l,M:l},p:0,findDOMNode:null},s=Symbol.for("react.portal");function d(h,m,g){var y=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:s,key:y==null?null:""+y,children:h,containerInfo:m,implementation:g}}var p=a.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function f(h,m){if(h==="font")return"";if(typeof m=="string")return m==="use-credentials"?m:""}return Gt.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=c,Gt.createPortal=function(h,m){var g=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!m||m.nodeType!==1&&m.nodeType!==9&&m.nodeType!==11)throw Error(n(299));return d(h,m,null,g)},Gt.flushSync=function(h){var m=p.T,g=c.p;try{if(p.T=null,c.p=2,h)return h()}finally{p.T=m,c.p=g,c.d.f()}},Gt.preconnect=function(h,m){typeof h=="string"&&(m?(m=m.crossOrigin,m=typeof m=="string"?m==="use-credentials"?m:"":void 0):m=null,c.d.C(h,m))},Gt.prefetchDNS=function(h){typeof h=="string"&&c.d.D(h)},Gt.preinit=function(h,m){if(typeof h=="string"&&m&&typeof m.as=="string"){var g=m.as,y=f(g,m.crossOrigin),w=typeof m.integrity=="string"?m.integrity:void 0,_=typeof m.fetchPriority=="string"?m.fetchPriority:void 0;g==="style"?c.d.S(h,typeof m.precedence=="string"?m.precedence:void 0,{crossOrigin:y,integrity:w,fetchPriority:_}):g==="script"&&c.d.X(h,{crossOrigin:y,integrity:w,fetchPriority:_,nonce:typeof m.nonce=="string"?m.nonce:void 0})}},Gt.preinitModule=function(h,m){if(typeof h=="string")if(typeof m=="object"&&m!==null){if(m.as==null||m.as==="script"){var g=f(m.as,m.crossOrigin);c.d.M(h,{crossOrigin:g,integrity:typeof m.integrity=="string"?m.integrity:void 0,nonce:typeof m.nonce=="string"?m.nonce:void 0})}}else m==null&&c.d.M(h)},Gt.preload=function(h,m){if(typeof h=="string"&&typeof m=="object"&&m!==null&&typeof m.as=="string"){var g=m.as,y=f(g,m.crossOrigin);c.d.L(h,g,{crossOrigin:y,integrity:typeof m.integrity=="string"?m.integrity:void 0,nonce:typeof m.nonce=="string"?m.nonce:void 0,type:typeof m.type=="string"?m.type:void 0,fetchPriority:typeof m.fetchPriority=="string"?m.fetchPriority:void 0,referrerPolicy:typeof m.referrerPolicy=="string"?m.referrerPolicy:void 0,imageSrcSet:typeof m.imageSrcSet=="string"?m.imageSrcSet:void 0,imageSizes:typeof m.imageSizes=="string"?m.imageSizes:void 0,media:typeof m.media=="string"?m.media:void 0})}},Gt.preloadModule=function(h,m){if(typeof h=="string")if(m){var g=f(m.as,m.crossOrigin);c.d.m(h,{as:typeof m.as=="string"&&m.as!=="script"?m.as:void 0,crossOrigin:g,integrity:typeof m.integrity=="string"?m.integrity:void 0})}else c.d.m(h)},Gt.requestFormReset=function(h){c.d.r(h)},Gt.unstable_batchedUpdates=function(h,m){return h(m)},Gt.useFormState=function(h,m,g){return p.H.useFormState(h,m,g)},Gt.useFormStatus=function(){return p.H.useHostTransitionStatus()},Gt.version="19.1.1",Gt}var hh;function Pv(){if(hh)return sd.exports;hh=1;function a(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(a)}catch(n){console.error(n)}}return a(),sd.exports=Mv(),sd.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var mh;function Hv(){if(mh)return wl;mh=1;var a=Iv(),n=Sd(),l=Pv();function c(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var o=2;o<arguments.length;o++)t+="&args[]="+encodeURIComponent(arguments[o])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function d(e){var t=e,o=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,(t.flags&4098)!==0&&(o=t.return),e=t.return;while(e)}return t.tag===3?o:null}function p(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function f(e){if(d(e)!==e)throw Error(c(188))}function h(e){var t=e.alternate;if(!t){if(t=d(e),t===null)throw Error(c(188));return t!==e?null:e}for(var o=e,i=t;;){var u=o.return;if(u===null)break;var v=u.alternate;if(v===null){if(i=u.return,i!==null){o=i;continue}break}if(u.child===v.child){for(v=u.child;v;){if(v===o)return f(u),e;if(v===i)return f(u),t;v=v.sibling}throw Error(c(188))}if(o.return!==i.return)o=u,i=v;else{for(var A=!1,P=u.child;P;){if(P===o){A=!0,o=u,i=v;break}if(P===i){A=!0,i=u,o=v;break}P=P.sibling}if(!A){for(P=v.child;P;){if(P===o){A=!0,o=v,i=u;break}if(P===i){A=!0,i=v,o=u;break}P=P.sibling}if(!A)throw Error(c(189))}}if(o.alternate!==i)throw Error(c(190))}if(o.tag!==3)throw Error(c(188));return o.stateNode.current===o?e:t}function m(e){var t=e.tag;if(t===5||t===26||t===27||t===6)return e;for(e=e.child;e!==null;){if(t=m(e),t!==null)return t;e=e.sibling}return null}var g=Object.assign,y=Symbol.for("react.element"),w=Symbol.for("react.transitional.element"),_=Symbol.for("react.portal"),b=Symbol.for("react.fragment"),k=Symbol.for("react.strict_mode"),S=Symbol.for("react.profiler"),$=Symbol.for("react.provider"),E=Symbol.for("react.consumer"),C=Symbol.for("react.context"),N=Symbol.for("react.forward_ref"),T=Symbol.for("react.suspense"),H=Symbol.for("react.suspense_list"),q=Symbol.for("react.memo"),B=Symbol.for("react.lazy"),K=Symbol.for("react.activity"),U=Symbol.for("react.memo_cache_sentinel"),R=Symbol.iterator;function j(e){return e===null||typeof e!="object"?null:(e=R&&e[R]||e["@@iterator"],typeof e=="function"?e:null)}var F=Symbol.for("react.client.reference");function M(e){if(e==null)return null;if(typeof e=="function")return e.$$typeof===F?null:e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case b:return"Fragment";case S:return"Profiler";case k:return"StrictMode";case T:return"Suspense";case H:return"SuspenseList";case K:return"Activity"}if(typeof e=="object")switch(e.$$typeof){case _:return"Portal";case C:return(e.displayName||"Context")+".Provider";case E:return(e._context.displayName||"Context")+".Consumer";case N:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case q:return t=e.displayName||null,t!==null?t:M(e.type)||"Memo";case B:t=e._payload,e=e._init;try{return M(e(t))}catch{}}return null}var L=Array.isArray,D=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,O=l.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,X={pending:!1,data:null,method:null,action:null},ne=[],z=-1;function G(e){return{current:e}}function Z(e){0>z||(e.current=ne[z],ne[z]=null,z--)}function Q(e,t){z++,ne[z]=e.current,e.current=t}var I=G(null),W=G(null),Y=G(null),de=G(null);function ee(e,t){switch(Q(Y,t),Q(W,e),Q(I,null),t.nodeType){case 9:case 11:e=(e=t.documentElement)&&(e=e.namespaceURI)?$f(e):0;break;default:if(e=t.tagName,t=t.namespaceURI)t=$f(t),e=Uf(t,e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}Z(I),Q(I,e)}function ge(){Z(I),Z(W),Z(Y)}function Se(e){e.memoizedState!==null&&Q(de,e);var t=I.current,o=Uf(t,e.type);t!==o&&(Q(W,e),Q(I,o))}function ye(e){W.current===e&&(Z(I),Z(W)),de.current===e&&(Z(de),ml._currentValue=X)}var Ne=Object.prototype.hasOwnProperty,Le=a.unstable_scheduleCallback,Je=a.unstable_cancelCallback,at=a.unstable_shouldYield,we=a.unstable_requestPaint,Ce=a.unstable_now,Ie=a.unstable_getCurrentPriorityLevel,ze=a.unstable_ImmediatePriority,wt=a.unstable_UserBlockingPriority,Qe=a.unstable_NormalPriority,Mt=a.unstable_LowPriority,rn=a.unstable_IdlePriority,Hn=a.log,ga=a.unstable_setDisableYieldValue,qn=null,$t=null;function Xt(e){if(typeof Hn=="function"&&ga(e),$t&&typeof $t.setStrictMode=="function")try{$t.setStrictMode(qn,e)}catch{}}var At=Math.clz32?Math.clz32:eo,va=Math.log,Fo=Math.LN2;function eo(e){return e>>>=0,e===0?32:31-(va(e)/Fo|0)|0}var Xn=256,$n=4194304;function Ut(e){var t=e&42;if(t!==0)return t;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return e&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function ln(e,t,o){var i=e.pendingLanes;if(i===0)return 0;var u=0,v=e.suspendedLanes,A=e.pingedLanes;e=e.warmLanes;var P=i&134217727;return P!==0?(i=P&~v,i!==0?u=Ut(i):(A&=P,A!==0?u=Ut(A):o||(o=P&~e,o!==0&&(u=Ut(o))))):(P=i&~v,P!==0?u=Ut(P):A!==0?u=Ut(A):o||(o=i&~e,o!==0&&(u=Ut(o)))),u===0?0:t!==0&&t!==u&&(t&v)===0&&(v=u&-u,o=t&-t,v>=o||v===32&&(o&4194048)!==0)?t:u}function zn(e,t){return(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&t)===0}function qo(e,t){switch(e){case 1:case 2:case 4:case 8:case 64:return t+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function to(){var e=Xn;return Xn<<=1,(Xn&4194048)===0&&(Xn=256),e}function no(){var e=$n;return $n<<=1,($n&62914560)===0&&($n=4194304),e}function _a(e){for(var t=[],o=0;31>o;o++)t.push(e);return t}function Un(e,t){e.pendingLanes|=t,t!==268435456&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function xa(e,t,o,i,u,v){var A=e.pendingLanes;e.pendingLanes=o,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=o,e.entangledLanes&=o,e.errorRecoveryDisabledLanes&=o,e.shellSuspendCounter=0;var P=e.entanglements,J=e.expirationTimes,ie=e.hiddenUpdates;for(o=A&~o;0<o;){var pe=31-At(o),me=1<<pe;P[pe]=0,J[pe]=-1;var ce=ie[pe];if(ce!==null)for(ie[pe]=null,pe=0;pe<ce.length;pe++){var se=ce[pe];se!==null&&(se.lane&=-536870913)}o&=~me}i!==0&&ao(e,i,0),v!==0&&u===0&&e.tag!==0&&(e.suspendedLanes|=v&~(A&~t))}function ao(e,t,o){e.pendingLanes|=t,e.suspendedLanes&=~t;var i=31-At(t);e.entangledLanes|=t,e.entanglements[i]=e.entanglements[i]|1073741824|o&4194090}function oo(e,t){var o=e.entangledLanes|=t;for(e=e.entanglements;o;){var i=31-At(o),u=1<<i;u&t|e[i]&t&&(e[i]|=t),o&=~u}}function wa(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function Ca(e){return e&=-e,2<e?8<e?(e&134217727)!==0?32:268435456:8:2}function ro(){var e=O.p;return e!==0?e:(e=window.event,e===void 0?32:th(e.type))}function lo(e,t){var o=O.p;try{return O.p=e,t()}finally{O.p=o}}var cn=Math.random().toString(36).slice(2),St="__reactFiber$"+cn,Nt="__reactProps$"+cn,ue="__reactContainer$"+cn,be="__reactEvents$"+cn,Ae="__reactListeners$"+cn,Ue="__reactHandles$"+cn,De="__reactResources$"+cn,Pe="__reactMarker$"+cn;function tt(e){delete e[St],delete e[Nt],delete e[be],delete e[Ae],delete e[Ue]}function Ye(e){var t=e[St];if(t)return t;for(var o=e.parentNode;o;){if(t=o[ue]||o[St]){if(o=t.alternate,t.child!==null||o!==null&&o.child!==null)for(e=Mf(e);e!==null;){if(o=e[St])return o;e=Mf(e)}return t}e=o,o=e.parentNode}return null}function Fe(e){if(e=e[St]||e[ue]){var t=e.tag;if(t===5||t===6||t===13||t===26||t===27||t===3)return e}return null}function ot(e){var t=e.tag;if(t===5||t===26||t===27||t===6)return e.stateNode;throw Error(c(33))}function Zt(e){var t=e[De];return t||(t=e[De]={hoistableStyles:new Map,hoistableScripts:new Map}),t}function fe(e){e[Pe]=!0}var xe=new Set,Ee={};function Ke(e,t){Et(e,t),Et(e+"Capture",t)}function Et(e,t){for(Ee[e]=t,e=0;e<t.length;e++)xe.add(t[e])}var _n=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),io={},xn={};function Zn(e){return Ne.call(xn,e)?!0:Ne.call(io,e)?!1:_n.test(e)?xn[e]=!0:(io[e]=!0,!1)}function Kn(e,t,o){if(Zn(t))if(o===null)e.removeAttribute(t);else{switch(typeof o){case"undefined":case"function":case"symbol":e.removeAttribute(t);return;case"boolean":var i=t.toLowerCase().slice(0,5);if(i!=="data-"&&i!=="aria-"){e.removeAttribute(t);return}}e.setAttribute(t,""+o)}}function wn(e,t,o){if(o===null)e.removeAttribute(t);else{switch(typeof o){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(t);return}e.setAttribute(t,""+o)}}function On(e,t,o,i){if(i===null)e.removeAttribute(o);else{switch(typeof i){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(o);return}e.setAttributeNS(t,o,""+i)}}var Nl,Wt;function ba(e){if(Nl===void 0)try{throw Error()}catch(o){var t=o.stack.trim().match(/\n( *(at )?)/);Nl=t&&t[1]||"",Wt=-1<o.stack.indexOf(`
    at`)?" (<anonymous>)":-1<o.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Nl+e+Wt}var Er=!1;function jr(e,t){if(!e||Er)return"";Er=!0;var o=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var i={DetermineComponentFrameRoot:function(){try{if(t){var me=function(){throw Error()};if(Object.defineProperty(me.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(me,[])}catch(se){var ce=se}Reflect.construct(e,[],me)}else{try{me.call()}catch(se){ce=se}e.call(me.prototype)}}else{try{throw Error()}catch(se){ce=se}(me=e())&&typeof me.catch=="function"&&me.catch(function(){})}}catch(se){if(se&&ce&&typeof se.stack=="string")return[se.stack,ce.stack]}return[null,null]}};i.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var u=Object.getOwnPropertyDescriptor(i.DetermineComponentFrameRoot,"name");u&&u.configurable&&Object.defineProperty(i.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var v=i.DetermineComponentFrameRoot(),A=v[0],P=v[1];if(A&&P){var J=A.split(`
`),ie=P.split(`
`);for(u=i=0;i<J.length&&!J[i].includes("DetermineComponentFrameRoot");)i++;for(;u<ie.length&&!ie[u].includes("DetermineComponentFrameRoot");)u++;if(i===J.length||u===ie.length)for(i=J.length-1,u=ie.length-1;1<=i&&0<=u&&J[i]!==ie[u];)u--;for(;1<=i&&0<=u;i--,u--)if(J[i]!==ie[u]){if(i!==1||u!==1)do if(i--,u--,0>u||J[i]!==ie[u]){var pe=`
`+J[i].replace(" at new "," at ");return e.displayName&&pe.includes("<anonymous>")&&(pe=pe.replace("<anonymous>",e.displayName)),pe}while(1<=i&&0<=u);break}}}finally{Er=!1,Error.prepareStackTrace=o}return(o=e?e.displayName||e.name:"")?ba(o):""}function ec(e){switch(e.tag){case 26:case 27:case 5:return ba(e.type);case 16:return ba("Lazy");case 13:return ba("Suspense");case 19:return ba("SuspenseList");case 0:case 15:return jr(e.type,!1);case 11:return jr(e.type.render,!1);case 1:return jr(e.type,!0);case 31:return ba("Activity");default:return""}}function Fl(e){try{var t="";do t+=ec(e),e=e.return;while(e);return t}catch(o){return`
Error generating stack: `+o.message+`
`+o.stack}}function Kt(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function co(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function Bt(e){var t=co(e)?"checked":"value",o=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),i=""+e[t];if(!e.hasOwnProperty(t)&&typeof o<"u"&&typeof o.get=="function"&&typeof o.set=="function"){var u=o.get,v=o.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return u.call(this)},set:function(A){i=""+A,v.call(this,A)}}),Object.defineProperty(e,t,{enumerable:o.enumerable}),{getValue:function(){return i},setValue:function(A){i=""+A},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function kr(e){e._valueTracker||(e._valueTracker=Bt(e))}function $o(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var o=t.getValue(),i="";return e&&(i=co(e)?e.checked?"true":"false":e.value),e=i,e!==o?(t.setValue(e),!0):!1}function ql(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}var Dy=/[\n"\\]/g;function Cn(e){return e.replace(Dy,function(t){return"\\"+t.charCodeAt(0).toString(16)+" "})}function tc(e,t,o,i,u,v,A,P){e.name="",A!=null&&typeof A!="function"&&typeof A!="symbol"&&typeof A!="boolean"?e.type=A:e.removeAttribute("type"),t!=null?A==="number"?(t===0&&e.value===""||e.value!=t)&&(e.value=""+Kt(t)):e.value!==""+Kt(t)&&(e.value=""+Kt(t)):A!=="submit"&&A!=="reset"||e.removeAttribute("value"),t!=null?nc(e,A,Kt(t)):o!=null?nc(e,A,Kt(o)):i!=null&&e.removeAttribute("value"),u==null&&v!=null&&(e.defaultChecked=!!v),u!=null&&(e.checked=u&&typeof u!="function"&&typeof u!="symbol"),P!=null&&typeof P!="function"&&typeof P!="symbol"&&typeof P!="boolean"?e.name=""+Kt(P):e.removeAttribute("name")}function Dd(e,t,o,i,u,v,A,P){if(v!=null&&typeof v!="function"&&typeof v!="symbol"&&typeof v!="boolean"&&(e.type=v),t!=null||o!=null){if(!(v!=="submit"&&v!=="reset"||t!=null))return;o=o!=null?""+Kt(o):"",t=t!=null?""+Kt(t):o,P||t===e.value||(e.value=t),e.defaultValue=t}i=i??u,i=typeof i!="function"&&typeof i!="symbol"&&!!i,e.checked=P?e.checked:!!i,e.defaultChecked=!!i,A!=null&&typeof A!="function"&&typeof A!="symbol"&&typeof A!="boolean"&&(e.name=A)}function nc(e,t,o){t==="number"&&ql(e.ownerDocument)===e||e.defaultValue===""+o||(e.defaultValue=""+o)}function Uo(e,t,o,i){if(e=e.options,t){t={};for(var u=0;u<o.length;u++)t["$"+o[u]]=!0;for(o=0;o<e.length;o++)u=t.hasOwnProperty("$"+e[o].value),e[o].selected!==u&&(e[o].selected=u),u&&i&&(e[o].defaultSelected=!0)}else{for(o=""+Kt(o),t=null,u=0;u<e.length;u++){if(e[u].value===o){e[u].selected=!0,i&&(e[u].defaultSelected=!0);return}t!==null||e[u].disabled||(t=e[u])}t!==null&&(t.selected=!0)}}function Nd(e,t,o){if(t!=null&&(t=""+Kt(t),t!==e.value&&(e.value=t),o==null)){e.defaultValue!==t&&(e.defaultValue=t);return}e.defaultValue=o!=null?""+Kt(o):""}function Fd(e,t,o,i){if(t==null){if(i!=null){if(o!=null)throw Error(c(92));if(L(i)){if(1<i.length)throw Error(c(93));i=i[0]}o=i}o==null&&(o=""),t=o}o=Kt(t),e.defaultValue=o,i=e.textContent,i===o&&i!==""&&i!==null&&(e.value=i)}function Oo(e,t){if(t){var o=e.firstChild;if(o&&o===e.lastChild&&o.nodeType===3){o.nodeValue=t;return}}e.textContent=t}var Ny=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function qd(e,t,o){var i=t.indexOf("--")===0;o==null||typeof o=="boolean"||o===""?i?e.setProperty(t,""):t==="float"?e.cssFloat="":e[t]="":i?e.setProperty(t,o):typeof o!="number"||o===0||Ny.has(t)?t==="float"?e.cssFloat=o:e[t]=(""+o).trim():e[t]=o+"px"}function $d(e,t,o){if(t!=null&&typeof t!="object")throw Error(c(62));if(e=e.style,o!=null){for(var i in o)!o.hasOwnProperty(i)||t!=null&&t.hasOwnProperty(i)||(i.indexOf("--")===0?e.setProperty(i,""):i==="float"?e.cssFloat="":e[i]="");for(var u in t)i=t[u],t.hasOwnProperty(u)&&o[u]!==i&&qd(e,u,i)}else for(var v in t)t.hasOwnProperty(v)&&qd(e,v,t[v])}function ac(e){if(e.indexOf("-")===-1)return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Fy=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),qy=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function $l(e){return qy.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}var oc=null;function rc(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var Io=null,Lo=null;function Ud(e){var t=Fe(e);if(t&&(e=t.stateNode)){var o=e[Nt]||null;e:switch(e=t.stateNode,t.type){case"input":if(tc(e,o.value,o.defaultValue,o.defaultValue,o.checked,o.defaultChecked,o.type,o.name),t=o.name,o.type==="radio"&&t!=null){for(o=e;o.parentNode;)o=o.parentNode;for(o=o.querySelectorAll('input[name="'+Cn(""+t)+'"][type="radio"]'),t=0;t<o.length;t++){var i=o[t];if(i!==e&&i.form===e.form){var u=i[Nt]||null;if(!u)throw Error(c(90));tc(i,u.value,u.defaultValue,u.defaultValue,u.checked,u.defaultChecked,u.type,u.name)}}for(t=0;t<o.length;t++)i=o[t],i.form===e.form&&$o(i)}break e;case"textarea":Nd(e,o.value,o.defaultValue);break e;case"select":t=o.value,t!=null&&Uo(e,!!o.multiple,t,!1)}}}var lc=!1;function Od(e,t,o){if(lc)return e(t,o);lc=!0;try{var i=e(t);return i}finally{if(lc=!1,(Io!==null||Lo!==null)&&(xi(),Io&&(t=Io,e=Lo,Lo=Io=null,Ud(t),e)))for(t=0;t<e.length;t++)Ud(e[t])}}function Rr(e,t){var o=e.stateNode;if(o===null)return null;var i=o[Nt]||null;if(i===null)return null;o=i[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(e=e.type,i=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!i;break e;default:e=!1}if(e)return null;if(o&&typeof o!="function")throw Error(c(231,t,typeof o));return o}var Jn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ic=!1;if(Jn)try{var Ar={};Object.defineProperty(Ar,"passive",{get:function(){ic=!0}}),window.addEventListener("test",Ar,Ar),window.removeEventListener("test",Ar,Ar)}catch{ic=!1}var Sa=null,cc=null,Ul=null;function Id(){if(Ul)return Ul;var e,t=cc,o=t.length,i,u="value"in Sa?Sa.value:Sa.textContent,v=u.length;for(e=0;e<o&&t[e]===u[e];e++);var A=o-e;for(i=1;i<=A&&t[o-i]===u[v-i];i++);return Ul=u.slice(e,1<i?1-i:void 0)}function Ol(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function Il(){return!0}function Ld(){return!1}function Jt(e){function t(o,i,u,v,A){this._reactName=o,this._targetInst=u,this.type=i,this.nativeEvent=v,this.target=A,this.currentTarget=null;for(var P in e)e.hasOwnProperty(P)&&(o=e[P],this[P]=o?o(v):v[P]);return this.isDefaultPrevented=(v.defaultPrevented!=null?v.defaultPrevented:v.returnValue===!1)?Il:Ld,this.isPropagationStopped=Ld,this}return g(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var o=this.nativeEvent;o&&(o.preventDefault?o.preventDefault():typeof o.returnValue!="unknown"&&(o.returnValue=!1),this.isDefaultPrevented=Il)},stopPropagation:function(){var o=this.nativeEvent;o&&(o.stopPropagation?o.stopPropagation():typeof o.cancelBubble!="unknown"&&(o.cancelBubble=!0),this.isPropagationStopped=Il)},persist:function(){},isPersistent:Il}),t}var so={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ll=Jt(so),Tr=g({},so,{view:0,detail:0}),$y=Jt(Tr),sc,dc,Dr,Ml=g({},Tr,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:pc,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Dr&&(Dr&&e.type==="mousemove"?(sc=e.screenX-Dr.screenX,dc=e.screenY-Dr.screenY):dc=sc=0,Dr=e),sc)},movementY:function(e){return"movementY"in e?e.movementY:dc}}),Md=Jt(Ml),Uy=g({},Ml,{dataTransfer:0}),Oy=Jt(Uy),Iy=g({},Tr,{relatedTarget:0}),uc=Jt(Iy),Ly=g({},so,{animationName:0,elapsedTime:0,pseudoElement:0}),My=Jt(Ly),Py=g({},so,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Hy=Jt(Py),zy=g({},so,{data:0}),Pd=Jt(zy),Vy={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},By={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Yy={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Gy(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=Yy[e])?!!t[e]:!1}function pc(){return Gy}var Wy=g({},Tr,{key:function(e){if(e.key){var t=Vy[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=Ol(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?By[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:pc,charCode:function(e){return e.type==="keypress"?Ol(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?Ol(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),Qy=Jt(Wy),Xy=g({},Ml,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Hd=Jt(Xy),Zy=g({},Tr,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:pc}),Ky=Jt(Zy),Jy=g({},so,{propertyName:0,elapsedTime:0,pseudoElement:0}),eg=Jt(Jy),tg=g({},Ml,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),ng=Jt(tg),ag=g({},so,{newState:0,oldState:0}),og=Jt(ag),rg=[9,13,27,32],fc=Jn&&"CompositionEvent"in window,Nr=null;Jn&&"documentMode"in document&&(Nr=document.documentMode);var lg=Jn&&"TextEvent"in window&&!Nr,zd=Jn&&(!fc||Nr&&8<Nr&&11>=Nr),Vd=" ",Bd=!1;function Yd(e,t){switch(e){case"keyup":return rg.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Gd(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Mo=!1;function ig(e,t){switch(e){case"compositionend":return Gd(t);case"keypress":return t.which!==32?null:(Bd=!0,Vd);case"textInput":return e=t.data,e===Vd&&Bd?null:e;default:return null}}function cg(e,t){if(Mo)return e==="compositionend"||!fc&&Yd(e,t)?(e=Id(),Ul=cc=Sa=null,Mo=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return zd&&t.locale!=="ko"?null:t.data;default:return null}}var sg={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Wd(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!sg[e.type]:t==="textarea"}function Qd(e,t,o,i){Io?Lo?Lo.push(i):Lo=[i]:Io=i,t=ji(t,"onChange"),0<t.length&&(o=new Ll("onChange","change",null,o,i),e.push({event:o,listeners:t}))}var Fr=null,qr=null;function dg(e){Tf(e,0)}function Pl(e){var t=ot(e);if($o(t))return e}function Xd(e,t){if(e==="change")return t}var Zd=!1;if(Jn){var hc;if(Jn){var mc="oninput"in document;if(!mc){var Kd=document.createElement("div");Kd.setAttribute("oninput","return;"),mc=typeof Kd.oninput=="function"}hc=mc}else hc=!1;Zd=hc&&(!document.documentMode||9<document.documentMode)}function Jd(){Fr&&(Fr.detachEvent("onpropertychange",eu),qr=Fr=null)}function eu(e){if(e.propertyName==="value"&&Pl(qr)){var t=[];Qd(t,qr,e,rc(e)),Od(dg,t)}}function ug(e,t,o){e==="focusin"?(Jd(),Fr=t,qr=o,Fr.attachEvent("onpropertychange",eu)):e==="focusout"&&Jd()}function pg(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return Pl(qr)}function fg(e,t){if(e==="click")return Pl(t)}function hg(e,t){if(e==="input"||e==="change")return Pl(t)}function mg(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var sn=typeof Object.is=="function"?Object.is:mg;function $r(e,t){if(sn(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var o=Object.keys(e),i=Object.keys(t);if(o.length!==i.length)return!1;for(i=0;i<o.length;i++){var u=o[i];if(!Ne.call(t,u)||!sn(e[u],t[u]))return!1}return!0}function tu(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function nu(e,t){var o=tu(e);e=0;for(var i;o;){if(o.nodeType===3){if(i=e+o.textContent.length,e<=t&&i>=t)return{node:o,offset:t-e};e=i}e:{for(;o;){if(o.nextSibling){o=o.nextSibling;break e}o=o.parentNode}o=void 0}o=tu(o)}}function au(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?au(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function ou(e){e=e!=null&&e.ownerDocument!=null&&e.ownerDocument.defaultView!=null?e.ownerDocument.defaultView:window;for(var t=ql(e.document);t instanceof e.HTMLIFrameElement;){try{var o=typeof t.contentWindow.location.href=="string"}catch{o=!1}if(o)e=t.contentWindow;else break;t=ql(e.document)}return t}function yc(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}var yg=Jn&&"documentMode"in document&&11>=document.documentMode,Po=null,gc=null,Ur=null,vc=!1;function ru(e,t,o){var i=o.window===o?o.document:o.nodeType===9?o:o.ownerDocument;vc||Po==null||Po!==ql(i)||(i=Po,"selectionStart"in i&&yc(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),Ur&&$r(Ur,i)||(Ur=i,i=ji(gc,"onSelect"),0<i.length&&(t=new Ll("onSelect","select",null,t,o),e.push({event:t,listeners:i}),t.target=Po)))}function uo(e,t){var o={};return o[e.toLowerCase()]=t.toLowerCase(),o["Webkit"+e]="webkit"+t,o["Moz"+e]="moz"+t,o}var Ho={animationend:uo("Animation","AnimationEnd"),animationiteration:uo("Animation","AnimationIteration"),animationstart:uo("Animation","AnimationStart"),transitionrun:uo("Transition","TransitionRun"),transitionstart:uo("Transition","TransitionStart"),transitioncancel:uo("Transition","TransitionCancel"),transitionend:uo("Transition","TransitionEnd")},_c={},lu={};Jn&&(lu=document.createElement("div").style,"AnimationEvent"in window||(delete Ho.animationend.animation,delete Ho.animationiteration.animation,delete Ho.animationstart.animation),"TransitionEvent"in window||delete Ho.transitionend.transition);function po(e){if(_c[e])return _c[e];if(!Ho[e])return e;var t=Ho[e],o;for(o in t)if(t.hasOwnProperty(o)&&o in lu)return _c[e]=t[o];return e}var iu=po("animationend"),cu=po("animationiteration"),su=po("animationstart"),gg=po("transitionrun"),vg=po("transitionstart"),_g=po("transitioncancel"),du=po("transitionend"),uu=new Map,xc="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");xc.push("scrollEnd");function In(e,t){uu.set(e,t),Ke(t,[e])}var pu=new WeakMap;function bn(e,t){if(typeof e=="object"&&e!==null){var o=pu.get(e);return o!==void 0?o:(t={value:e,source:t,stack:Fl(t)},pu.set(e,t),t)}return{value:e,source:t,stack:Fl(t)}}var Sn=[],zo=0,wc=0;function Hl(){for(var e=zo,t=wc=zo=0;t<e;){var o=Sn[t];Sn[t++]=null;var i=Sn[t];Sn[t++]=null;var u=Sn[t];Sn[t++]=null;var v=Sn[t];if(Sn[t++]=null,i!==null&&u!==null){var A=i.pending;A===null?u.next=u:(u.next=A.next,A.next=u),i.pending=u}v!==0&&fu(o,u,v)}}function zl(e,t,o,i){Sn[zo++]=e,Sn[zo++]=t,Sn[zo++]=o,Sn[zo++]=i,wc|=i,e.lanes|=i,e=e.alternate,e!==null&&(e.lanes|=i)}function Cc(e,t,o,i){return zl(e,t,o,i),Vl(e)}function Vo(e,t){return zl(e,null,null,t),Vl(e)}function fu(e,t,o){e.lanes|=o;var i=e.alternate;i!==null&&(i.lanes|=o);for(var u=!1,v=e.return;v!==null;)v.childLanes|=o,i=v.alternate,i!==null&&(i.childLanes|=o),v.tag===22&&(e=v.stateNode,e===null||e._visibility&1||(u=!0)),e=v,v=v.return;return e.tag===3?(v=e.stateNode,u&&t!==null&&(u=31-At(o),e=v.hiddenUpdates,i=e[u],i===null?e[u]=[t]:i.push(t),t.lane=o|536870912),v):null}function Vl(e){if(50<il)throw il=0,Rs=null,Error(c(185));for(var t=e.return;t!==null;)e=t,t=e.return;return e.tag===3?e.stateNode:null}var Bo={};function xg(e,t,o,i){this.tag=e,this.key=o,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function dn(e,t,o,i){return new xg(e,t,o,i)}function bc(e){return e=e.prototype,!(!e||!e.isReactComponent)}function ea(e,t){var o=e.alternate;return o===null?(o=dn(e.tag,t,e.key,e.mode),o.elementType=e.elementType,o.type=e.type,o.stateNode=e.stateNode,o.alternate=e,e.alternate=o):(o.pendingProps=t,o.type=e.type,o.flags=0,o.subtreeFlags=0,o.deletions=null),o.flags=e.flags&65011712,o.childLanes=e.childLanes,o.lanes=e.lanes,o.child=e.child,o.memoizedProps=e.memoizedProps,o.memoizedState=e.memoizedState,o.updateQueue=e.updateQueue,t=e.dependencies,o.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},o.sibling=e.sibling,o.index=e.index,o.ref=e.ref,o.refCleanup=e.refCleanup,o}function hu(e,t){e.flags&=65011714;var o=e.alternate;return o===null?(e.childLanes=0,e.lanes=t,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=o.childLanes,e.lanes=o.lanes,e.child=o.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=o.memoizedProps,e.memoizedState=o.memoizedState,e.updateQueue=o.updateQueue,e.type=o.type,t=o.dependencies,e.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),e}function Bl(e,t,o,i,u,v){var A=0;if(i=e,typeof e=="function")bc(e)&&(A=1);else if(typeof e=="string")A=Cv(e,o,I.current)?26:e==="html"||e==="head"||e==="body"?27:5;else e:switch(e){case K:return e=dn(31,o,t,u),e.elementType=K,e.lanes=v,e;case b:return fo(o.children,u,v,t);case k:A=8,u|=24;break;case S:return e=dn(12,o,t,u|2),e.elementType=S,e.lanes=v,e;case T:return e=dn(13,o,t,u),e.elementType=T,e.lanes=v,e;case H:return e=dn(19,o,t,u),e.elementType=H,e.lanes=v,e;default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case $:case C:A=10;break e;case E:A=9;break e;case N:A=11;break e;case q:A=14;break e;case B:A=16,i=null;break e}A=29,o=Error(c(130,e===null?"null":typeof e,"")),i=null}return t=dn(A,o,t,u),t.elementType=e,t.type=i,t.lanes=v,t}function fo(e,t,o,i){return e=dn(7,e,i,t),e.lanes=o,e}function Sc(e,t,o){return e=dn(6,e,null,t),e.lanes=o,e}function Ec(e,t,o){return t=dn(4,e.children!==null?e.children:[],e.key,t),t.lanes=o,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}var Yo=[],Go=0,Yl=null,Gl=0,En=[],jn=0,ho=null,ta=1,na="";function mo(e,t){Yo[Go++]=Gl,Yo[Go++]=Yl,Yl=e,Gl=t}function mu(e,t,o){En[jn++]=ta,En[jn++]=na,En[jn++]=ho,ho=e;var i=ta;e=na;var u=32-At(i)-1;i&=~(1<<u),o+=1;var v=32-At(t)+u;if(30<v){var A=u-u%5;v=(i&(1<<A)-1).toString(32),i>>=A,u-=A,ta=1<<32-At(t)+u|o<<u|i,na=v+e}else ta=1<<v|o<<u|i,na=e}function jc(e){e.return!==null&&(mo(e,1),mu(e,1,0))}function kc(e){for(;e===Yl;)Yl=Yo[--Go],Yo[Go]=null,Gl=Yo[--Go],Yo[Go]=null;for(;e===ho;)ho=En[--jn],En[jn]=null,na=En[--jn],En[jn]=null,ta=En[--jn],En[jn]=null}var Qt=null,Ct=null,it=!1,yo=null,Vn=!1,Rc=Error(c(519));function go(e){var t=Error(c(418,""));throw Lr(bn(t,e)),Rc}function yu(e){var t=e.stateNode,o=e.type,i=e.memoizedProps;switch(t[St]=e,t[Nt]=i,o){case"dialog":Ze("cancel",t),Ze("close",t);break;case"iframe":case"object":case"embed":Ze("load",t);break;case"video":case"audio":for(o=0;o<sl.length;o++)Ze(sl[o],t);break;case"source":Ze("error",t);break;case"img":case"image":case"link":Ze("error",t),Ze("load",t);break;case"details":Ze("toggle",t);break;case"input":Ze("invalid",t),Dd(t,i.value,i.defaultValue,i.checked,i.defaultChecked,i.type,i.name,!0),kr(t);break;case"select":Ze("invalid",t);break;case"textarea":Ze("invalid",t),Fd(t,i.value,i.defaultValue,i.children),kr(t)}o=i.children,typeof o!="string"&&typeof o!="number"&&typeof o!="bigint"||t.textContent===""+o||i.suppressHydrationWarning===!0||qf(t.textContent,o)?(i.popover!=null&&(Ze("beforetoggle",t),Ze("toggle",t)),i.onScroll!=null&&Ze("scroll",t),i.onScrollEnd!=null&&Ze("scrollend",t),i.onClick!=null&&(t.onclick=ki),t=!0):t=!1,t||go(e)}function gu(e){for(Qt=e.return;Qt;)switch(Qt.tag){case 5:case 13:Vn=!1;return;case 27:case 3:Vn=!0;return;default:Qt=Qt.return}}function Or(e){if(e!==Qt)return!1;if(!it)return gu(e),it=!0,!1;var t=e.tag,o;if((o=t!==3&&t!==27)&&((o=t===5)&&(o=e.type,o=!(o!=="form"&&o!=="button")||Vs(e.type,e.memoizedProps)),o=!o),o&&Ct&&go(e),gu(e),t===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(c(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8)if(o=e.data,o==="/$"){if(t===0){Ct=Mn(e.nextSibling);break e}t--}else o!=="$"&&o!=="$!"&&o!=="$?"||t++;e=e.nextSibling}Ct=null}}else t===27?(t=Ct,Ma(e.type)?(e=Ws,Ws=null,Ct=e):Ct=t):Ct=Qt?Mn(e.stateNode.nextSibling):null;return!0}function Ir(){Ct=Qt=null,it=!1}function vu(){var e=yo;return e!==null&&(nn===null?nn=e:nn.push.apply(nn,e),yo=null),e}function Lr(e){yo===null?yo=[e]:yo.push(e)}var Ac=G(null),vo=null,aa=null;function Ea(e,t,o){Q(Ac,t._currentValue),t._currentValue=o}function oa(e){e._currentValue=Ac.current,Z(Ac)}function Tc(e,t,o){for(;e!==null;){var i=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,i!==null&&(i.childLanes|=t)):i!==null&&(i.childLanes&t)!==t&&(i.childLanes|=t),e===o)break;e=e.return}}function Dc(e,t,o,i){var u=e.child;for(u!==null&&(u.return=e);u!==null;){var v=u.dependencies;if(v!==null){var A=u.child;v=v.firstContext;e:for(;v!==null;){var P=v;v=u;for(var J=0;J<t.length;J++)if(P.context===t[J]){v.lanes|=o,P=v.alternate,P!==null&&(P.lanes|=o),Tc(v.return,o,e),i||(A=null);break e}v=P.next}}else if(u.tag===18){if(A=u.return,A===null)throw Error(c(341));A.lanes|=o,v=A.alternate,v!==null&&(v.lanes|=o),Tc(A,o,e),A=null}else A=u.child;if(A!==null)A.return=u;else for(A=u;A!==null;){if(A===e){A=null;break}if(u=A.sibling,u!==null){u.return=A.return,A=u;break}A=A.return}u=A}}function Mr(e,t,o,i){e=null;for(var u=t,v=!1;u!==null;){if(!v){if((u.flags&524288)!==0)v=!0;else if((u.flags&262144)!==0)break}if(u.tag===10){var A=u.alternate;if(A===null)throw Error(c(387));if(A=A.memoizedProps,A!==null){var P=u.type;sn(u.pendingProps.value,A.value)||(e!==null?e.push(P):e=[P])}}else if(u===de.current){if(A=u.alternate,A===null)throw Error(c(387));A.memoizedState.memoizedState!==u.memoizedState.memoizedState&&(e!==null?e.push(ml):e=[ml])}u=u.return}e!==null&&Dc(t,e,o,i),t.flags|=262144}function Wl(e){for(e=e.firstContext;e!==null;){if(!sn(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function _o(e){vo=e,aa=null,e=e.dependencies,e!==null&&(e.firstContext=null)}function Yt(e){return _u(vo,e)}function Ql(e,t){return vo===null&&_o(e),_u(e,t)}function _u(e,t){var o=t._currentValue;if(t={context:t,memoizedValue:o,next:null},aa===null){if(e===null)throw Error(c(308));aa=t,e.dependencies={lanes:0,firstContext:t},e.flags|=524288}else aa=aa.next=t;return o}var wg=typeof AbortController<"u"?AbortController:function(){var e=[],t=this.signal={aborted:!1,addEventListener:function(o,i){e.push(i)}};this.abort=function(){t.aborted=!0,e.forEach(function(o){return o()})}},Cg=a.unstable_scheduleCallback,bg=a.unstable_NormalPriority,Ft={$$typeof:C,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Nc(){return{controller:new wg,data:new Map,refCount:0}}function Pr(e){e.refCount--,e.refCount===0&&Cg(bg,function(){e.controller.abort()})}var Hr=null,Fc=0,Wo=0,Qo=null;function Sg(e,t){if(Hr===null){var o=Hr=[];Fc=0,Wo=$s(),Qo={status:"pending",value:void 0,then:function(i){o.push(i)}}}return Fc++,t.then(xu,xu),t}function xu(){if(--Fc===0&&Hr!==null){Qo!==null&&(Qo.status="fulfilled");var e=Hr;Hr=null,Wo=0,Qo=null;for(var t=0;t<e.length;t++)(0,e[t])()}}function Eg(e,t){var o=[],i={status:"pending",value:null,reason:null,then:function(u){o.push(u)}};return e.then(function(){i.status="fulfilled",i.value=t;for(var u=0;u<o.length;u++)(0,o[u])(t)},function(u){for(i.status="rejected",i.reason=u,u=0;u<o.length;u++)(0,o[u])(void 0)}),i}var wu=D.S;D.S=function(e,t){typeof t=="object"&&t!==null&&typeof t.then=="function"&&Sg(e,t),wu!==null&&wu(e,t)};var xo=G(null);function qc(){var e=xo.current;return e!==null?e:ht.pooledCache}function Xl(e,t){t===null?Q(xo,xo.current):Q(xo,t.pool)}function Cu(){var e=qc();return e===null?null:{parent:Ft._currentValue,pool:e}}var zr=Error(c(460)),bu=Error(c(474)),Zl=Error(c(542)),$c={then:function(){}};function Su(e){return e=e.status,e==="fulfilled"||e==="rejected"}function Kl(){}function Eu(e,t,o){switch(o=e[o],o===void 0?e.push(t):o!==t&&(t.then(Kl,Kl),t=o),t.status){case"fulfilled":return t.value;case"rejected":throw e=t.reason,ku(e),e;default:if(typeof t.status=="string")t.then(Kl,Kl);else{if(e=ht,e!==null&&100<e.shellSuspendCounter)throw Error(c(482));e=t,e.status="pending",e.then(function(i){if(t.status==="pending"){var u=t;u.status="fulfilled",u.value=i}},function(i){if(t.status==="pending"){var u=t;u.status="rejected",u.reason=i}})}switch(t.status){case"fulfilled":return t.value;case"rejected":throw e=t.reason,ku(e),e}throw Vr=t,zr}}var Vr=null;function ju(){if(Vr===null)throw Error(c(459));var e=Vr;return Vr=null,e}function ku(e){if(e===zr||e===Zl)throw Error(c(483))}var ja=!1;function Uc(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Oc(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function ka(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function Ra(e,t,o){var i=e.updateQueue;if(i===null)return null;if(i=i.shared,(ct&2)!==0){var u=i.pending;return u===null?t.next=t:(t.next=u.next,u.next=t),i.pending=t,t=Vl(e),fu(e,null,o),t}return zl(e,i,t,o),Vl(e)}function Br(e,t,o){if(t=t.updateQueue,t!==null&&(t=t.shared,(o&4194048)!==0)){var i=t.lanes;i&=e.pendingLanes,o|=i,t.lanes=o,oo(e,o)}}function Ic(e,t){var o=e.updateQueue,i=e.alternate;if(i!==null&&(i=i.updateQueue,o===i)){var u=null,v=null;if(o=o.firstBaseUpdate,o!==null){do{var A={lane:o.lane,tag:o.tag,payload:o.payload,callback:null,next:null};v===null?u=v=A:v=v.next=A,o=o.next}while(o!==null);v===null?u=v=t:v=v.next=t}else u=v=t;o={baseState:i.baseState,firstBaseUpdate:u,lastBaseUpdate:v,shared:i.shared,callbacks:i.callbacks},e.updateQueue=o;return}e=o.lastBaseUpdate,e===null?o.firstBaseUpdate=t:e.next=t,o.lastBaseUpdate=t}var Lc=!1;function Yr(){if(Lc){var e=Qo;if(e!==null)throw e}}function Gr(e,t,o,i){Lc=!1;var u=e.updateQueue;ja=!1;var v=u.firstBaseUpdate,A=u.lastBaseUpdate,P=u.shared.pending;if(P!==null){u.shared.pending=null;var J=P,ie=J.next;J.next=null,A===null?v=ie:A.next=ie,A=J;var pe=e.alternate;pe!==null&&(pe=pe.updateQueue,P=pe.lastBaseUpdate,P!==A&&(P===null?pe.firstBaseUpdate=ie:P.next=ie,pe.lastBaseUpdate=J))}if(v!==null){var me=u.baseState;A=0,pe=ie=J=null,P=v;do{var ce=P.lane&-536870913,se=ce!==P.lane;if(se?(nt&ce)===ce:(i&ce)===ce){ce!==0&&ce===Wo&&(Lc=!0),pe!==null&&(pe=pe.next={lane:0,tag:P.tag,payload:P.payload,callback:null,next:null});e:{var Oe=e,qe=P;ce=t;var pt=o;switch(qe.tag){case 1:if(Oe=qe.payload,typeof Oe=="function"){me=Oe.call(pt,me,ce);break e}me=Oe;break e;case 3:Oe.flags=Oe.flags&-65537|128;case 0:if(Oe=qe.payload,ce=typeof Oe=="function"?Oe.call(pt,me,ce):Oe,ce==null)break e;me=g({},me,ce);break e;case 2:ja=!0}}ce=P.callback,ce!==null&&(e.flags|=64,se&&(e.flags|=8192),se=u.callbacks,se===null?u.callbacks=[ce]:se.push(ce))}else se={lane:ce,tag:P.tag,payload:P.payload,callback:P.callback,next:null},pe===null?(ie=pe=se,J=me):pe=pe.next=se,A|=ce;if(P=P.next,P===null){if(P=u.shared.pending,P===null)break;se=P,P=se.next,se.next=null,u.lastBaseUpdate=se,u.shared.pending=null}}while(!0);pe===null&&(J=me),u.baseState=J,u.firstBaseUpdate=ie,u.lastBaseUpdate=pe,v===null&&(u.shared.lanes=0),Ua|=A,e.lanes=A,e.memoizedState=me}}function Ru(e,t){if(typeof e!="function")throw Error(c(191,e));e.call(t)}function Au(e,t){var o=e.callbacks;if(o!==null)for(e.callbacks=null,e=0;e<o.length;e++)Ru(o[e],t)}var Xo=G(null),Jl=G(0);function Tu(e,t){e=ua,Q(Jl,e),Q(Xo,t),ua=e|t.baseLanes}function Mc(){Q(Jl,ua),Q(Xo,Xo.current)}function Pc(){ua=Jl.current,Z(Xo),Z(Jl)}var Aa=0,Ve=null,dt=null,Tt=null,ei=!1,Zo=!1,wo=!1,ti=0,Wr=0,Ko=null,jg=0;function jt(){throw Error(c(321))}function Hc(e,t){if(t===null)return!1;for(var o=0;o<t.length&&o<e.length;o++)if(!sn(e[o],t[o]))return!1;return!0}function zc(e,t,o,i,u,v){return Aa=v,Ve=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,D.H=e===null||e.memoizedState===null?fp:hp,wo=!1,v=o(i,u),wo=!1,Zo&&(v=Nu(t,o,i,u)),Du(e),v}function Du(e){D.H=ii;var t=dt!==null&&dt.next!==null;if(Aa=0,Tt=dt=Ve=null,ei=!1,Wr=0,Ko=null,t)throw Error(c(300));e===null||Ot||(e=e.dependencies,e!==null&&Wl(e)&&(Ot=!0))}function Nu(e,t,o,i){Ve=e;var u=0;do{if(Zo&&(Ko=null),Wr=0,Zo=!1,25<=u)throw Error(c(301));if(u+=1,Tt=dt=null,e.updateQueue!=null){var v=e.updateQueue;v.lastEffect=null,v.events=null,v.stores=null,v.memoCache!=null&&(v.memoCache.index=0)}D.H=Fg,v=t(o,i)}while(Zo);return v}function kg(){var e=D.H,t=e.useState()[0];return t=typeof t.then=="function"?Qr(t):t,e=e.useState()[0],(dt!==null?dt.memoizedState:null)!==e&&(Ve.flags|=1024),t}function Vc(){var e=ti!==0;return ti=0,e}function Bc(e,t,o){t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~o}function Yc(e){if(ei){for(e=e.memoizedState;e!==null;){var t=e.queue;t!==null&&(t.pending=null),e=e.next}ei=!1}Aa=0,Tt=dt=Ve=null,Zo=!1,Wr=ti=0,Ko=null}function en(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Tt===null?Ve.memoizedState=Tt=e:Tt=Tt.next=e,Tt}function Dt(){if(dt===null){var e=Ve.alternate;e=e!==null?e.memoizedState:null}else e=dt.next;var t=Tt===null?Ve.memoizedState:Tt.next;if(t!==null)Tt=t,dt=e;else{if(e===null)throw Ve.alternate===null?Error(c(467)):Error(c(310));dt=e,e={memoizedState:dt.memoizedState,baseState:dt.baseState,baseQueue:dt.baseQueue,queue:dt.queue,next:null},Tt===null?Ve.memoizedState=Tt=e:Tt=Tt.next=e}return Tt}function Gc(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Qr(e){var t=Wr;return Wr+=1,Ko===null&&(Ko=[]),e=Eu(Ko,e,t),t=Ve,(Tt===null?t.memoizedState:Tt.next)===null&&(t=t.alternate,D.H=t===null||t.memoizedState===null?fp:hp),e}function ni(e){if(e!==null&&typeof e=="object"){if(typeof e.then=="function")return Qr(e);if(e.$$typeof===C)return Yt(e)}throw Error(c(438,String(e)))}function Wc(e){var t=null,o=Ve.updateQueue;if(o!==null&&(t=o.memoCache),t==null){var i=Ve.alternate;i!==null&&(i=i.updateQueue,i!==null&&(i=i.memoCache,i!=null&&(t={data:i.data.map(function(u){return u.slice()}),index:0})))}if(t==null&&(t={data:[],index:0}),o===null&&(o=Gc(),Ve.updateQueue=o),o.memoCache=t,o=t.data[t.index],o===void 0)for(o=t.data[t.index]=Array(e),i=0;i<e;i++)o[i]=U;return t.index++,o}function ra(e,t){return typeof t=="function"?t(e):t}function ai(e){var t=Dt();return Qc(t,dt,e)}function Qc(e,t,o){var i=e.queue;if(i===null)throw Error(c(311));i.lastRenderedReducer=o;var u=e.baseQueue,v=i.pending;if(v!==null){if(u!==null){var A=u.next;u.next=v.next,v.next=A}t.baseQueue=u=v,i.pending=null}if(v=e.baseState,u===null)e.memoizedState=v;else{t=u.next;var P=A=null,J=null,ie=t,pe=!1;do{var me=ie.lane&-536870913;if(me!==ie.lane?(nt&me)===me:(Aa&me)===me){var ce=ie.revertLane;if(ce===0)J!==null&&(J=J.next={lane:0,revertLane:0,action:ie.action,hasEagerState:ie.hasEagerState,eagerState:ie.eagerState,next:null}),me===Wo&&(pe=!0);else if((Aa&ce)===ce){ie=ie.next,ce===Wo&&(pe=!0);continue}else me={lane:0,revertLane:ie.revertLane,action:ie.action,hasEagerState:ie.hasEagerState,eagerState:ie.eagerState,next:null},J===null?(P=J=me,A=v):J=J.next=me,Ve.lanes|=ce,Ua|=ce;me=ie.action,wo&&o(v,me),v=ie.hasEagerState?ie.eagerState:o(v,me)}else ce={lane:me,revertLane:ie.revertLane,action:ie.action,hasEagerState:ie.hasEagerState,eagerState:ie.eagerState,next:null},J===null?(P=J=ce,A=v):J=J.next=ce,Ve.lanes|=me,Ua|=me;ie=ie.next}while(ie!==null&&ie!==t);if(J===null?A=v:J.next=P,!sn(v,e.memoizedState)&&(Ot=!0,pe&&(o=Qo,o!==null)))throw o;e.memoizedState=v,e.baseState=A,e.baseQueue=J,i.lastRenderedState=v}return u===null&&(i.lanes=0),[e.memoizedState,i.dispatch]}function Xc(e){var t=Dt(),o=t.queue;if(o===null)throw Error(c(311));o.lastRenderedReducer=e;var i=o.dispatch,u=o.pending,v=t.memoizedState;if(u!==null){o.pending=null;var A=u=u.next;do v=e(v,A.action),A=A.next;while(A!==u);sn(v,t.memoizedState)||(Ot=!0),t.memoizedState=v,t.baseQueue===null&&(t.baseState=v),o.lastRenderedState=v}return[v,i]}function Fu(e,t,o){var i=Ve,u=Dt(),v=it;if(v){if(o===void 0)throw Error(c(407));o=o()}else o=t();var A=!sn((dt||u).memoizedState,o);A&&(u.memoizedState=o,Ot=!0),u=u.queue;var P=Uu.bind(null,i,u,e);if(Xr(2048,8,P,[e]),u.getSnapshot!==t||A||Tt!==null&&Tt.memoizedState.tag&1){if(i.flags|=2048,Jo(9,oi(),$u.bind(null,i,u,o,t),null),ht===null)throw Error(c(349));v||(Aa&124)!==0||qu(i,t,o)}return o}function qu(e,t,o){e.flags|=16384,e={getSnapshot:t,value:o},t=Ve.updateQueue,t===null?(t=Gc(),Ve.updateQueue=t,t.stores=[e]):(o=t.stores,o===null?t.stores=[e]:o.push(e))}function $u(e,t,o,i){t.value=o,t.getSnapshot=i,Ou(t)&&Iu(e)}function Uu(e,t,o){return o(function(){Ou(t)&&Iu(e)})}function Ou(e){var t=e.getSnapshot;e=e.value;try{var o=t();return!sn(e,o)}catch{return!0}}function Iu(e){var t=Vo(e,2);t!==null&&mn(t,e,2)}function Zc(e){var t=en();if(typeof e=="function"){var o=e;if(e=o(),wo){Xt(!0);try{o()}finally{Xt(!1)}}}return t.memoizedState=t.baseState=e,t.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ra,lastRenderedState:e},t}function Lu(e,t,o,i){return e.baseState=o,Qc(e,dt,typeof i=="function"?i:ra)}function Rg(e,t,o,i,u){if(li(e))throw Error(c(485));if(e=t.action,e!==null){var v={payload:u,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(A){v.listeners.push(A)}};D.T!==null?o(!0):v.isTransition=!1,i(v),o=t.pending,o===null?(v.next=t.pending=v,Mu(t,v)):(v.next=o.next,t.pending=o.next=v)}}function Mu(e,t){var o=t.action,i=t.payload,u=e.state;if(t.isTransition){var v=D.T,A={};D.T=A;try{var P=o(u,i),J=D.S;J!==null&&J(A,P),Pu(e,t,P)}catch(ie){Kc(e,t,ie)}finally{D.T=v}}else try{v=o(u,i),Pu(e,t,v)}catch(ie){Kc(e,t,ie)}}function Pu(e,t,o){o!==null&&typeof o=="object"&&typeof o.then=="function"?o.then(function(i){Hu(e,t,i)},function(i){return Kc(e,t,i)}):Hu(e,t,o)}function Hu(e,t,o){t.status="fulfilled",t.value=o,zu(t),e.state=o,t=e.pending,t!==null&&(o=t.next,o===t?e.pending=null:(o=o.next,t.next=o,Mu(e,o)))}function Kc(e,t,o){var i=e.pending;if(e.pending=null,i!==null){i=i.next;do t.status="rejected",t.reason=o,zu(t),t=t.next;while(t!==i)}e.action=null}function zu(e){e=e.listeners;for(var t=0;t<e.length;t++)(0,e[t])()}function Vu(e,t){return t}function Bu(e,t){if(it){var o=ht.formState;if(o!==null){e:{var i=Ve;if(it){if(Ct){t:{for(var u=Ct,v=Vn;u.nodeType!==8;){if(!v){u=null;break t}if(u=Mn(u.nextSibling),u===null){u=null;break t}}v=u.data,u=v==="F!"||v==="F"?u:null}if(u){Ct=Mn(u.nextSibling),i=u.data==="F!";break e}}go(i)}i=!1}i&&(t=o[0])}}return o=en(),o.memoizedState=o.baseState=t,i={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Vu,lastRenderedState:t},o.queue=i,o=dp.bind(null,Ve,i),i.dispatch=o,i=Zc(!1),v=as.bind(null,Ve,!1,i.queue),i=en(),u={state:t,dispatch:null,action:e,pending:null},i.queue=u,o=Rg.bind(null,Ve,u,v,o),u.dispatch=o,i.memoizedState=e,[t,o,!1]}function Yu(e){var t=Dt();return Gu(t,dt,e)}function Gu(e,t,o){if(t=Qc(e,t,Vu)[0],e=ai(ra)[0],typeof t=="object"&&t!==null&&typeof t.then=="function")try{var i=Qr(t)}catch(A){throw A===zr?Zl:A}else i=t;t=Dt();var u=t.queue,v=u.dispatch;return o!==t.memoizedState&&(Ve.flags|=2048,Jo(9,oi(),Ag.bind(null,u,o),null)),[i,v,e]}function Ag(e,t){e.action=t}function Wu(e){var t=Dt(),o=dt;if(o!==null)return Gu(t,o,e);Dt(),t=t.memoizedState,o=Dt();var i=o.queue.dispatch;return o.memoizedState=e,[t,i,!1]}function Jo(e,t,o,i){return e={tag:e,create:o,deps:i,inst:t,next:null},t=Ve.updateQueue,t===null&&(t=Gc(),Ve.updateQueue=t),o=t.lastEffect,o===null?t.lastEffect=e.next=e:(i=o.next,o.next=e,e.next=i,t.lastEffect=e),e}function oi(){return{destroy:void 0,resource:void 0}}function Qu(){return Dt().memoizedState}function ri(e,t,o,i){var u=en();i=i===void 0?null:i,Ve.flags|=e,u.memoizedState=Jo(1|t,oi(),o,i)}function Xr(e,t,o,i){var u=Dt();i=i===void 0?null:i;var v=u.memoizedState.inst;dt!==null&&i!==null&&Hc(i,dt.memoizedState.deps)?u.memoizedState=Jo(t,v,o,i):(Ve.flags|=e,u.memoizedState=Jo(1|t,v,o,i))}function Xu(e,t){ri(8390656,8,e,t)}function Zu(e,t){Xr(2048,8,e,t)}function Ku(e,t){return Xr(4,2,e,t)}function Ju(e,t){return Xr(4,4,e,t)}function ep(e,t){if(typeof t=="function"){e=e();var o=t(e);return function(){typeof o=="function"?o():t(null)}}if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function tp(e,t,o){o=o!=null?o.concat([e]):null,Xr(4,4,ep.bind(null,t,e),o)}function Jc(){}function np(e,t){var o=Dt();t=t===void 0?null:t;var i=o.memoizedState;return t!==null&&Hc(t,i[1])?i[0]:(o.memoizedState=[e,t],e)}function ap(e,t){var o=Dt();t=t===void 0?null:t;var i=o.memoizedState;if(t!==null&&Hc(t,i[1]))return i[0];if(i=e(),wo){Xt(!0);try{e()}finally{Xt(!1)}}return o.memoizedState=[i,t],i}function es(e,t,o){return o===void 0||(Aa&1073741824)!==0?e.memoizedState=t:(e.memoizedState=o,e=lf(),Ve.lanes|=e,Ua|=e,o)}function op(e,t,o,i){return sn(o,t)?o:Xo.current!==null?(e=es(e,o,i),sn(e,t)||(Ot=!0),e):(Aa&42)===0?(Ot=!0,e.memoizedState=o):(e=lf(),Ve.lanes|=e,Ua|=e,t)}function rp(e,t,o,i,u){var v=O.p;O.p=v!==0&&8>v?v:8;var A=D.T,P={};D.T=P,as(e,!1,t,o);try{var J=u(),ie=D.S;if(ie!==null&&ie(P,J),J!==null&&typeof J=="object"&&typeof J.then=="function"){var pe=Eg(J,i);Zr(e,t,pe,hn(e))}else Zr(e,t,i,hn(e))}catch(me){Zr(e,t,{then:function(){},status:"rejected",reason:me},hn())}finally{O.p=v,D.T=A}}function Tg(){}function ts(e,t,o,i){if(e.tag!==5)throw Error(c(476));var u=lp(e).queue;rp(e,u,t,X,o===null?Tg:function(){return ip(e),o(i)})}function lp(e){var t=e.memoizedState;if(t!==null)return t;t={memoizedState:X,baseState:X,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ra,lastRenderedState:X},next:null};var o={};return t.next={memoizedState:o,baseState:o,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ra,lastRenderedState:o},next:null},e.memoizedState=t,e=e.alternate,e!==null&&(e.memoizedState=t),t}function ip(e){var t=lp(e).next.queue;Zr(e,t,{},hn())}function ns(){return Yt(ml)}function cp(){return Dt().memoizedState}function sp(){return Dt().memoizedState}function Dg(e){for(var t=e.return;t!==null;){switch(t.tag){case 24:case 3:var o=hn();e=ka(o);var i=Ra(t,e,o);i!==null&&(mn(i,t,o),Br(i,t,o)),t={cache:Nc()},e.payload=t;return}t=t.return}}function Ng(e,t,o){var i=hn();o={lane:i,revertLane:0,action:o,hasEagerState:!1,eagerState:null,next:null},li(e)?up(t,o):(o=Cc(e,t,o,i),o!==null&&(mn(o,e,i),pp(o,t,i)))}function dp(e,t,o){var i=hn();Zr(e,t,o,i)}function Zr(e,t,o,i){var u={lane:i,revertLane:0,action:o,hasEagerState:!1,eagerState:null,next:null};if(li(e))up(t,u);else{var v=e.alternate;if(e.lanes===0&&(v===null||v.lanes===0)&&(v=t.lastRenderedReducer,v!==null))try{var A=t.lastRenderedState,P=v(A,o);if(u.hasEagerState=!0,u.eagerState=P,sn(P,A))return zl(e,t,u,0),ht===null&&Hl(),!1}catch{}finally{}if(o=Cc(e,t,u,i),o!==null)return mn(o,e,i),pp(o,t,i),!0}return!1}function as(e,t,o,i){if(i={lane:2,revertLane:$s(),action:i,hasEagerState:!1,eagerState:null,next:null},li(e)){if(t)throw Error(c(479))}else t=Cc(e,o,i,2),t!==null&&mn(t,e,2)}function li(e){var t=e.alternate;return e===Ve||t!==null&&t===Ve}function up(e,t){Zo=ei=!0;var o=e.pending;o===null?t.next=t:(t.next=o.next,o.next=t),e.pending=t}function pp(e,t,o){if((o&4194048)!==0){var i=t.lanes;i&=e.pendingLanes,o|=i,t.lanes=o,oo(e,o)}}var ii={readContext:Yt,use:ni,useCallback:jt,useContext:jt,useEffect:jt,useImperativeHandle:jt,useLayoutEffect:jt,useInsertionEffect:jt,useMemo:jt,useReducer:jt,useRef:jt,useState:jt,useDebugValue:jt,useDeferredValue:jt,useTransition:jt,useSyncExternalStore:jt,useId:jt,useHostTransitionStatus:jt,useFormState:jt,useActionState:jt,useOptimistic:jt,useMemoCache:jt,useCacheRefresh:jt},fp={readContext:Yt,use:ni,useCallback:function(e,t){return en().memoizedState=[e,t===void 0?null:t],e},useContext:Yt,useEffect:Xu,useImperativeHandle:function(e,t,o){o=o!=null?o.concat([e]):null,ri(4194308,4,ep.bind(null,t,e),o)},useLayoutEffect:function(e,t){return ri(4194308,4,e,t)},useInsertionEffect:function(e,t){ri(4,2,e,t)},useMemo:function(e,t){var o=en();t=t===void 0?null:t;var i=e();if(wo){Xt(!0);try{e()}finally{Xt(!1)}}return o.memoizedState=[i,t],i},useReducer:function(e,t,o){var i=en();if(o!==void 0){var u=o(t);if(wo){Xt(!0);try{o(t)}finally{Xt(!1)}}}else u=t;return i.memoizedState=i.baseState=u,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:u},i.queue=e,e=e.dispatch=Ng.bind(null,Ve,e),[i.memoizedState,e]},useRef:function(e){var t=en();return e={current:e},t.memoizedState=e},useState:function(e){e=Zc(e);var t=e.queue,o=dp.bind(null,Ve,t);return t.dispatch=o,[e.memoizedState,o]},useDebugValue:Jc,useDeferredValue:function(e,t){var o=en();return es(o,e,t)},useTransition:function(){var e=Zc(!1);return e=rp.bind(null,Ve,e.queue,!0,!1),en().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,t,o){var i=Ve,u=en();if(it){if(o===void 0)throw Error(c(407));o=o()}else{if(o=t(),ht===null)throw Error(c(349));(nt&124)!==0||qu(i,t,o)}u.memoizedState=o;var v={value:o,getSnapshot:t};return u.queue=v,Xu(Uu.bind(null,i,v,e),[e]),i.flags|=2048,Jo(9,oi(),$u.bind(null,i,v,o,t),null),o},useId:function(){var e=en(),t=ht.identifierPrefix;if(it){var o=na,i=ta;o=(i&~(1<<32-At(i)-1)).toString(32)+o,t=""+t+"R"+o,o=ti++,0<o&&(t+="H"+o.toString(32)),t+=""}else o=jg++,t=""+t+"r"+o.toString(32)+"";return e.memoizedState=t},useHostTransitionStatus:ns,useFormState:Bu,useActionState:Bu,useOptimistic:function(e){var t=en();t.memoizedState=t.baseState=e;var o={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return t.queue=o,t=as.bind(null,Ve,!0,o),o.dispatch=t,[e,t]},useMemoCache:Wc,useCacheRefresh:function(){return en().memoizedState=Dg.bind(null,Ve)}},hp={readContext:Yt,use:ni,useCallback:np,useContext:Yt,useEffect:Zu,useImperativeHandle:tp,useInsertionEffect:Ku,useLayoutEffect:Ju,useMemo:ap,useReducer:ai,useRef:Qu,useState:function(){return ai(ra)},useDebugValue:Jc,useDeferredValue:function(e,t){var o=Dt();return op(o,dt.memoizedState,e,t)},useTransition:function(){var e=ai(ra)[0],t=Dt().memoizedState;return[typeof e=="boolean"?e:Qr(e),t]},useSyncExternalStore:Fu,useId:cp,useHostTransitionStatus:ns,useFormState:Yu,useActionState:Yu,useOptimistic:function(e,t){var o=Dt();return Lu(o,dt,e,t)},useMemoCache:Wc,useCacheRefresh:sp},Fg={readContext:Yt,use:ni,useCallback:np,useContext:Yt,useEffect:Zu,useImperativeHandle:tp,useInsertionEffect:Ku,useLayoutEffect:Ju,useMemo:ap,useReducer:Xc,useRef:Qu,useState:function(){return Xc(ra)},useDebugValue:Jc,useDeferredValue:function(e,t){var o=Dt();return dt===null?es(o,e,t):op(o,dt.memoizedState,e,t)},useTransition:function(){var e=Xc(ra)[0],t=Dt().memoizedState;return[typeof e=="boolean"?e:Qr(e),t]},useSyncExternalStore:Fu,useId:cp,useHostTransitionStatus:ns,useFormState:Wu,useActionState:Wu,useOptimistic:function(e,t){var o=Dt();return dt!==null?Lu(o,dt,e,t):(o.baseState=e,[e,o.queue.dispatch])},useMemoCache:Wc,useCacheRefresh:sp},er=null,Kr=0;function ci(e){var t=Kr;return Kr+=1,er===null&&(er=[]),Eu(er,e,t)}function Jr(e,t){t=t.props.ref,e.ref=t!==void 0?t:null}function si(e,t){throw t.$$typeof===y?Error(c(525)):(e=Object.prototype.toString.call(t),Error(c(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)))}function mp(e){var t=e._init;return t(e._payload)}function yp(e){function t(oe,te){if(e){var le=oe.deletions;le===null?(oe.deletions=[te],oe.flags|=16):le.push(te)}}function o(oe,te){if(!e)return null;for(;te!==null;)t(oe,te),te=te.sibling;return null}function i(oe){for(var te=new Map;oe!==null;)oe.key!==null?te.set(oe.key,oe):te.set(oe.index,oe),oe=oe.sibling;return te}function u(oe,te){return oe=ea(oe,te),oe.index=0,oe.sibling=null,oe}function v(oe,te,le){return oe.index=le,e?(le=oe.alternate,le!==null?(le=le.index,le<te?(oe.flags|=67108866,te):le):(oe.flags|=67108866,te)):(oe.flags|=1048576,te)}function A(oe){return e&&oe.alternate===null&&(oe.flags|=67108866),oe}function P(oe,te,le,he){return te===null||te.tag!==6?(te=Sc(le,oe.mode,he),te.return=oe,te):(te=u(te,le),te.return=oe,te)}function J(oe,te,le,he){var Re=le.type;return Re===b?pe(oe,te,le.props.children,he,le.key):te!==null&&(te.elementType===Re||typeof Re=="object"&&Re!==null&&Re.$$typeof===B&&mp(Re)===te.type)?(te=u(te,le.props),Jr(te,le),te.return=oe,te):(te=Bl(le.type,le.key,le.props,null,oe.mode,he),Jr(te,le),te.return=oe,te)}function ie(oe,te,le,he){return te===null||te.tag!==4||te.stateNode.containerInfo!==le.containerInfo||te.stateNode.implementation!==le.implementation?(te=Ec(le,oe.mode,he),te.return=oe,te):(te=u(te,le.children||[]),te.return=oe,te)}function pe(oe,te,le,he,Re){return te===null||te.tag!==7?(te=fo(le,oe.mode,he,Re),te.return=oe,te):(te=u(te,le),te.return=oe,te)}function me(oe,te,le){if(typeof te=="string"&&te!==""||typeof te=="number"||typeof te=="bigint")return te=Sc(""+te,oe.mode,le),te.return=oe,te;if(typeof te=="object"&&te!==null){switch(te.$$typeof){case w:return le=Bl(te.type,te.key,te.props,null,oe.mode,le),Jr(le,te),le.return=oe,le;case _:return te=Ec(te,oe.mode,le),te.return=oe,te;case B:var he=te._init;return te=he(te._payload),me(oe,te,le)}if(L(te)||j(te))return te=fo(te,oe.mode,le,null),te.return=oe,te;if(typeof te.then=="function")return me(oe,ci(te),le);if(te.$$typeof===C)return me(oe,Ql(oe,te),le);si(oe,te)}return null}function ce(oe,te,le,he){var Re=te!==null?te.key:null;if(typeof le=="string"&&le!==""||typeof le=="number"||typeof le=="bigint")return Re!==null?null:P(oe,te,""+le,he);if(typeof le=="object"&&le!==null){switch(le.$$typeof){case w:return le.key===Re?J(oe,te,le,he):null;case _:return le.key===Re?ie(oe,te,le,he):null;case B:return Re=le._init,le=Re(le._payload),ce(oe,te,le,he)}if(L(le)||j(le))return Re!==null?null:pe(oe,te,le,he,null);if(typeof le.then=="function")return ce(oe,te,ci(le),he);if(le.$$typeof===C)return ce(oe,te,Ql(oe,le),he);si(oe,le)}return null}function se(oe,te,le,he,Re){if(typeof he=="string"&&he!==""||typeof he=="number"||typeof he=="bigint")return oe=oe.get(le)||null,P(te,oe,""+he,Re);if(typeof he=="object"&&he!==null){switch(he.$$typeof){case w:return oe=oe.get(he.key===null?le:he.key)||null,J(te,oe,he,Re);case _:return oe=oe.get(he.key===null?le:he.key)||null,ie(te,oe,he,Re);case B:var Ge=he._init;return he=Ge(he._payload),se(oe,te,le,he,Re)}if(L(he)||j(he))return oe=oe.get(le)||null,pe(te,oe,he,Re,null);if(typeof he.then=="function")return se(oe,te,le,ci(he),Re);if(he.$$typeof===C)return se(oe,te,le,Ql(te,he),Re);si(te,he)}return null}function Oe(oe,te,le,he){for(var Re=null,Ge=null,Te=te,$e=te=0,Lt=null;Te!==null&&$e<le.length;$e++){Te.index>$e?(Lt=Te,Te=null):Lt=Te.sibling;var rt=ce(oe,Te,le[$e],he);if(rt===null){Te===null&&(Te=Lt);break}e&&Te&&rt.alternate===null&&t(oe,Te),te=v(rt,te,$e),Ge===null?Re=rt:Ge.sibling=rt,Ge=rt,Te=Lt}if($e===le.length)return o(oe,Te),it&&mo(oe,$e),Re;if(Te===null){for(;$e<le.length;$e++)Te=me(oe,le[$e],he),Te!==null&&(te=v(Te,te,$e),Ge===null?Re=Te:Ge.sibling=Te,Ge=Te);return it&&mo(oe,$e),Re}for(Te=i(Te);$e<le.length;$e++)Lt=se(Te,oe,$e,le[$e],he),Lt!==null&&(e&&Lt.alternate!==null&&Te.delete(Lt.key===null?$e:Lt.key),te=v(Lt,te,$e),Ge===null?Re=Lt:Ge.sibling=Lt,Ge=Lt);return e&&Te.forEach(function(Ba){return t(oe,Ba)}),it&&mo(oe,$e),Re}function qe(oe,te,le,he){if(le==null)throw Error(c(151));for(var Re=null,Ge=null,Te=te,$e=te=0,Lt=null,rt=le.next();Te!==null&&!rt.done;$e++,rt=le.next()){Te.index>$e?(Lt=Te,Te=null):Lt=Te.sibling;var Ba=ce(oe,Te,rt.value,he);if(Ba===null){Te===null&&(Te=Lt);break}e&&Te&&Ba.alternate===null&&t(oe,Te),te=v(Ba,te,$e),Ge===null?Re=Ba:Ge.sibling=Ba,Ge=Ba,Te=Lt}if(rt.done)return o(oe,Te),it&&mo(oe,$e),Re;if(Te===null){for(;!rt.done;$e++,rt=le.next())rt=me(oe,rt.value,he),rt!==null&&(te=v(rt,te,$e),Ge===null?Re=rt:Ge.sibling=rt,Ge=rt);return it&&mo(oe,$e),Re}for(Te=i(Te);!rt.done;$e++,rt=le.next())rt=se(Te,oe,$e,rt.value,he),rt!==null&&(e&&rt.alternate!==null&&Te.delete(rt.key===null?$e:rt.key),te=v(rt,te,$e),Ge===null?Re=rt:Ge.sibling=rt,Ge=rt);return e&&Te.forEach(function(qv){return t(oe,qv)}),it&&mo(oe,$e),Re}function pt(oe,te,le,he){if(typeof le=="object"&&le!==null&&le.type===b&&le.key===null&&(le=le.props.children),typeof le=="object"&&le!==null){switch(le.$$typeof){case w:e:{for(var Re=le.key;te!==null;){if(te.key===Re){if(Re=le.type,Re===b){if(te.tag===7){o(oe,te.sibling),he=u(te,le.props.children),he.return=oe,oe=he;break e}}else if(te.elementType===Re||typeof Re=="object"&&Re!==null&&Re.$$typeof===B&&mp(Re)===te.type){o(oe,te.sibling),he=u(te,le.props),Jr(he,le),he.return=oe,oe=he;break e}o(oe,te);break}else t(oe,te);te=te.sibling}le.type===b?(he=fo(le.props.children,oe.mode,he,le.key),he.return=oe,oe=he):(he=Bl(le.type,le.key,le.props,null,oe.mode,he),Jr(he,le),he.return=oe,oe=he)}return A(oe);case _:e:{for(Re=le.key;te!==null;){if(te.key===Re)if(te.tag===4&&te.stateNode.containerInfo===le.containerInfo&&te.stateNode.implementation===le.implementation){o(oe,te.sibling),he=u(te,le.children||[]),he.return=oe,oe=he;break e}else{o(oe,te);break}else t(oe,te);te=te.sibling}he=Ec(le,oe.mode,he),he.return=oe,oe=he}return A(oe);case B:return Re=le._init,le=Re(le._payload),pt(oe,te,le,he)}if(L(le))return Oe(oe,te,le,he);if(j(le)){if(Re=j(le),typeof Re!="function")throw Error(c(150));return le=Re.call(le),qe(oe,te,le,he)}if(typeof le.then=="function")return pt(oe,te,ci(le),he);if(le.$$typeof===C)return pt(oe,te,Ql(oe,le),he);si(oe,le)}return typeof le=="string"&&le!==""||typeof le=="number"||typeof le=="bigint"?(le=""+le,te!==null&&te.tag===6?(o(oe,te.sibling),he=u(te,le),he.return=oe,oe=he):(o(oe,te),he=Sc(le,oe.mode,he),he.return=oe,oe=he),A(oe)):o(oe,te)}return function(oe,te,le,he){try{Kr=0;var Re=pt(oe,te,le,he);return er=null,Re}catch(Te){if(Te===zr||Te===Zl)throw Te;var Ge=dn(29,Te,null,oe.mode);return Ge.lanes=he,Ge.return=oe,Ge}finally{}}}var tr=yp(!0),gp=yp(!1),kn=G(null),Bn=null;function Ta(e){var t=e.alternate;Q(qt,qt.current&1),Q(kn,e),Bn===null&&(t===null||Xo.current!==null||t.memoizedState!==null)&&(Bn=e)}function vp(e){if(e.tag===22){if(Q(qt,qt.current),Q(kn,e),Bn===null){var t=e.alternate;t!==null&&t.memoizedState!==null&&(Bn=e)}}else Da()}function Da(){Q(qt,qt.current),Q(kn,kn.current)}function la(e){Z(kn),Bn===e&&(Bn=null),Z(qt)}var qt=G(0);function di(e){for(var t=e;t!==null;){if(t.tag===13){var o=t.memoizedState;if(o!==null&&(o=o.dehydrated,o===null||o.data==="$?"||Gs(o)))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if((t.flags&128)!==0)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}function os(e,t,o,i){t=e.memoizedState,o=o(i,t),o=o==null?t:g({},t,o),e.memoizedState=o,e.lanes===0&&(e.updateQueue.baseState=o)}var rs={enqueueSetState:function(e,t,o){e=e._reactInternals;var i=hn(),u=ka(i);u.payload=t,o!=null&&(u.callback=o),t=Ra(e,u,i),t!==null&&(mn(t,e,i),Br(t,e,i))},enqueueReplaceState:function(e,t,o){e=e._reactInternals;var i=hn(),u=ka(i);u.tag=1,u.payload=t,o!=null&&(u.callback=o),t=Ra(e,u,i),t!==null&&(mn(t,e,i),Br(t,e,i))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var o=hn(),i=ka(o);i.tag=2,t!=null&&(i.callback=t),t=Ra(e,i,o),t!==null&&(mn(t,e,o),Br(t,e,o))}};function _p(e,t,o,i,u,v,A){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(i,v,A):t.prototype&&t.prototype.isPureReactComponent?!$r(o,i)||!$r(u,v):!0}function xp(e,t,o,i){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(o,i),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(o,i),t.state!==e&&rs.enqueueReplaceState(t,t.state,null)}function Co(e,t){var o=t;if("ref"in t){o={};for(var i in t)i!=="ref"&&(o[i]=t[i])}if(e=e.defaultProps){o===t&&(o=g({},o));for(var u in e)o[u]===void 0&&(o[u]=e[u])}return o}var ui=typeof reportError=="function"?reportError:function(e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof e=="object"&&e!==null&&typeof e.message=="string"?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",e);return}console.error(e)};function wp(e){ui(e)}function Cp(e){console.error(e)}function bp(e){ui(e)}function pi(e,t){try{var o=e.onUncaughtError;o(t.value,{componentStack:t.stack})}catch(i){setTimeout(function(){throw i})}}function Sp(e,t,o){try{var i=e.onCaughtError;i(o.value,{componentStack:o.stack,errorBoundary:t.tag===1?t.stateNode:null})}catch(u){setTimeout(function(){throw u})}}function ls(e,t,o){return o=ka(o),o.tag=3,o.payload={element:null},o.callback=function(){pi(e,t)},o}function Ep(e){return e=ka(e),e.tag=3,e}function jp(e,t,o,i){var u=o.type.getDerivedStateFromError;if(typeof u=="function"){var v=i.value;e.payload=function(){return u(v)},e.callback=function(){Sp(t,o,i)}}var A=o.stateNode;A!==null&&typeof A.componentDidCatch=="function"&&(e.callback=function(){Sp(t,o,i),typeof u!="function"&&(Oa===null?Oa=new Set([this]):Oa.add(this));var P=i.stack;this.componentDidCatch(i.value,{componentStack:P!==null?P:""})})}function qg(e,t,o,i,u){if(o.flags|=32768,i!==null&&typeof i=="object"&&typeof i.then=="function"){if(t=o.alternate,t!==null&&Mr(t,o,u,!0),o=kn.current,o!==null){switch(o.tag){case 13:return Bn===null?Ts():o.alternate===null&&bt===0&&(bt=3),o.flags&=-257,o.flags|=65536,o.lanes=u,i===$c?o.flags|=16384:(t=o.updateQueue,t===null?o.updateQueue=new Set([i]):t.add(i),Ns(e,i,u)),!1;case 22:return o.flags|=65536,i===$c?o.flags|=16384:(t=o.updateQueue,t===null?(t={transitions:null,markerInstances:null,retryQueue:new Set([i])},o.updateQueue=t):(o=t.retryQueue,o===null?t.retryQueue=new Set([i]):o.add(i)),Ns(e,i,u)),!1}throw Error(c(435,o.tag))}return Ns(e,i,u),Ts(),!1}if(it)return t=kn.current,t!==null?((t.flags&65536)===0&&(t.flags|=256),t.flags|=65536,t.lanes=u,i!==Rc&&(e=Error(c(422),{cause:i}),Lr(bn(e,o)))):(i!==Rc&&(t=Error(c(423),{cause:i}),Lr(bn(t,o))),e=e.current.alternate,e.flags|=65536,u&=-u,e.lanes|=u,i=bn(i,o),u=ls(e.stateNode,i,u),Ic(e,u),bt!==4&&(bt=2)),!1;var v=Error(c(520),{cause:i});if(v=bn(v,o),ll===null?ll=[v]:ll.push(v),bt!==4&&(bt=2),t===null)return!0;i=bn(i,o),o=t;do{switch(o.tag){case 3:return o.flags|=65536,e=u&-u,o.lanes|=e,e=ls(o.stateNode,i,e),Ic(o,e),!1;case 1:if(t=o.type,v=o.stateNode,(o.flags&128)===0&&(typeof t.getDerivedStateFromError=="function"||v!==null&&typeof v.componentDidCatch=="function"&&(Oa===null||!Oa.has(v))))return o.flags|=65536,u&=-u,o.lanes|=u,u=Ep(u),jp(u,e,o,i),Ic(o,u),!1}o=o.return}while(o!==null);return!1}var kp=Error(c(461)),Ot=!1;function Pt(e,t,o,i){t.child=e===null?gp(t,null,o,i):tr(t,e.child,o,i)}function Rp(e,t,o,i,u){o=o.render;var v=t.ref;if("ref"in i){var A={};for(var P in i)P!=="ref"&&(A[P]=i[P])}else A=i;return _o(t),i=zc(e,t,o,A,v,u),P=Vc(),e!==null&&!Ot?(Bc(e,t,u),ia(e,t,u)):(it&&P&&jc(t),t.flags|=1,Pt(e,t,i,u),t.child)}function Ap(e,t,o,i,u){if(e===null){var v=o.type;return typeof v=="function"&&!bc(v)&&v.defaultProps===void 0&&o.compare===null?(t.tag=15,t.type=v,Tp(e,t,v,i,u)):(e=Bl(o.type,null,i,t,t.mode,u),e.ref=t.ref,e.return=t,t.child=e)}if(v=e.child,!hs(e,u)){var A=v.memoizedProps;if(o=o.compare,o=o!==null?o:$r,o(A,i)&&e.ref===t.ref)return ia(e,t,u)}return t.flags|=1,e=ea(v,i),e.ref=t.ref,e.return=t,t.child=e}function Tp(e,t,o,i,u){if(e!==null){var v=e.memoizedProps;if($r(v,i)&&e.ref===t.ref)if(Ot=!1,t.pendingProps=i=v,hs(e,u))(e.flags&131072)!==0&&(Ot=!0);else return t.lanes=e.lanes,ia(e,t,u)}return is(e,t,o,i,u)}function Dp(e,t,o){var i=t.pendingProps,u=i.children,v=e!==null?e.memoizedState:null;if(i.mode==="hidden"){if((t.flags&128)!==0){if(i=v!==null?v.baseLanes|o:o,e!==null){for(u=t.child=e.child,v=0;u!==null;)v=v|u.lanes|u.childLanes,u=u.sibling;t.childLanes=v&~i}else t.childLanes=0,t.child=null;return Np(e,t,i,o)}if((o&536870912)!==0)t.memoizedState={baseLanes:0,cachePool:null},e!==null&&Xl(t,v!==null?v.cachePool:null),v!==null?Tu(t,v):Mc(),vp(t);else return t.lanes=t.childLanes=536870912,Np(e,t,v!==null?v.baseLanes|o:o,o)}else v!==null?(Xl(t,v.cachePool),Tu(t,v),Da(),t.memoizedState=null):(e!==null&&Xl(t,null),Mc(),Da());return Pt(e,t,u,o),t.child}function Np(e,t,o,i){var u=qc();return u=u===null?null:{parent:Ft._currentValue,pool:u},t.memoizedState={baseLanes:o,cachePool:u},e!==null&&Xl(t,null),Mc(),vp(t),e!==null&&Mr(e,t,i,!0),null}function fi(e,t){var o=t.ref;if(o===null)e!==null&&e.ref!==null&&(t.flags|=4194816);else{if(typeof o!="function"&&typeof o!="object")throw Error(c(284));(e===null||e.ref!==o)&&(t.flags|=4194816)}}function is(e,t,o,i,u){return _o(t),o=zc(e,t,o,i,void 0,u),i=Vc(),e!==null&&!Ot?(Bc(e,t,u),ia(e,t,u)):(it&&i&&jc(t),t.flags|=1,Pt(e,t,o,u),t.child)}function Fp(e,t,o,i,u,v){return _o(t),t.updateQueue=null,o=Nu(t,i,o,u),Du(e),i=Vc(),e!==null&&!Ot?(Bc(e,t,v),ia(e,t,v)):(it&&i&&jc(t),t.flags|=1,Pt(e,t,o,v),t.child)}function qp(e,t,o,i,u){if(_o(t),t.stateNode===null){var v=Bo,A=o.contextType;typeof A=="object"&&A!==null&&(v=Yt(A)),v=new o(i,v),t.memoizedState=v.state!==null&&v.state!==void 0?v.state:null,v.updater=rs,t.stateNode=v,v._reactInternals=t,v=t.stateNode,v.props=i,v.state=t.memoizedState,v.refs={},Uc(t),A=o.contextType,v.context=typeof A=="object"&&A!==null?Yt(A):Bo,v.state=t.memoizedState,A=o.getDerivedStateFromProps,typeof A=="function"&&(os(t,o,A,i),v.state=t.memoizedState),typeof o.getDerivedStateFromProps=="function"||typeof v.getSnapshotBeforeUpdate=="function"||typeof v.UNSAFE_componentWillMount!="function"&&typeof v.componentWillMount!="function"||(A=v.state,typeof v.componentWillMount=="function"&&v.componentWillMount(),typeof v.UNSAFE_componentWillMount=="function"&&v.UNSAFE_componentWillMount(),A!==v.state&&rs.enqueueReplaceState(v,v.state,null),Gr(t,i,v,u),Yr(),v.state=t.memoizedState),typeof v.componentDidMount=="function"&&(t.flags|=4194308),i=!0}else if(e===null){v=t.stateNode;var P=t.memoizedProps,J=Co(o,P);v.props=J;var ie=v.context,pe=o.contextType;A=Bo,typeof pe=="object"&&pe!==null&&(A=Yt(pe));var me=o.getDerivedStateFromProps;pe=typeof me=="function"||typeof v.getSnapshotBeforeUpdate=="function",P=t.pendingProps!==P,pe||typeof v.UNSAFE_componentWillReceiveProps!="function"&&typeof v.componentWillReceiveProps!="function"||(P||ie!==A)&&xp(t,v,i,A),ja=!1;var ce=t.memoizedState;v.state=ce,Gr(t,i,v,u),Yr(),ie=t.memoizedState,P||ce!==ie||ja?(typeof me=="function"&&(os(t,o,me,i),ie=t.memoizedState),(J=ja||_p(t,o,J,i,ce,ie,A))?(pe||typeof v.UNSAFE_componentWillMount!="function"&&typeof v.componentWillMount!="function"||(typeof v.componentWillMount=="function"&&v.componentWillMount(),typeof v.UNSAFE_componentWillMount=="function"&&v.UNSAFE_componentWillMount()),typeof v.componentDidMount=="function"&&(t.flags|=4194308)):(typeof v.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=i,t.memoizedState=ie),v.props=i,v.state=ie,v.context=A,i=J):(typeof v.componentDidMount=="function"&&(t.flags|=4194308),i=!1)}else{v=t.stateNode,Oc(e,t),A=t.memoizedProps,pe=Co(o,A),v.props=pe,me=t.pendingProps,ce=v.context,ie=o.contextType,J=Bo,typeof ie=="object"&&ie!==null&&(J=Yt(ie)),P=o.getDerivedStateFromProps,(ie=typeof P=="function"||typeof v.getSnapshotBeforeUpdate=="function")||typeof v.UNSAFE_componentWillReceiveProps!="function"&&typeof v.componentWillReceiveProps!="function"||(A!==me||ce!==J)&&xp(t,v,i,J),ja=!1,ce=t.memoizedState,v.state=ce,Gr(t,i,v,u),Yr();var se=t.memoizedState;A!==me||ce!==se||ja||e!==null&&e.dependencies!==null&&Wl(e.dependencies)?(typeof P=="function"&&(os(t,o,P,i),se=t.memoizedState),(pe=ja||_p(t,o,pe,i,ce,se,J)||e!==null&&e.dependencies!==null&&Wl(e.dependencies))?(ie||typeof v.UNSAFE_componentWillUpdate!="function"&&typeof v.componentWillUpdate!="function"||(typeof v.componentWillUpdate=="function"&&v.componentWillUpdate(i,se,J),typeof v.UNSAFE_componentWillUpdate=="function"&&v.UNSAFE_componentWillUpdate(i,se,J)),typeof v.componentDidUpdate=="function"&&(t.flags|=4),typeof v.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof v.componentDidUpdate!="function"||A===e.memoizedProps&&ce===e.memoizedState||(t.flags|=4),typeof v.getSnapshotBeforeUpdate!="function"||A===e.memoizedProps&&ce===e.memoizedState||(t.flags|=1024),t.memoizedProps=i,t.memoizedState=se),v.props=i,v.state=se,v.context=J,i=pe):(typeof v.componentDidUpdate!="function"||A===e.memoizedProps&&ce===e.memoizedState||(t.flags|=4),typeof v.getSnapshotBeforeUpdate!="function"||A===e.memoizedProps&&ce===e.memoizedState||(t.flags|=1024),i=!1)}return v=i,fi(e,t),i=(t.flags&128)!==0,v||i?(v=t.stateNode,o=i&&typeof o.getDerivedStateFromError!="function"?null:v.render(),t.flags|=1,e!==null&&i?(t.child=tr(t,e.child,null,u),t.child=tr(t,null,o,u)):Pt(e,t,o,u),t.memoizedState=v.state,e=t.child):e=ia(e,t,u),e}function $p(e,t,o,i){return Ir(),t.flags|=256,Pt(e,t,o,i),t.child}var cs={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function ss(e){return{baseLanes:e,cachePool:Cu()}}function ds(e,t,o){return e=e!==null?e.childLanes&~o:0,t&&(e|=Rn),e}function Up(e,t,o){var i=t.pendingProps,u=!1,v=(t.flags&128)!==0,A;if((A=v)||(A=e!==null&&e.memoizedState===null?!1:(qt.current&2)!==0),A&&(u=!0,t.flags&=-129),A=(t.flags&32)!==0,t.flags&=-33,e===null){if(it){if(u?Ta(t):Da(),it){var P=Ct,J;if(J=P){e:{for(J=P,P=Vn;J.nodeType!==8;){if(!P){P=null;break e}if(J=Mn(J.nextSibling),J===null){P=null;break e}}P=J}P!==null?(t.memoizedState={dehydrated:P,treeContext:ho!==null?{id:ta,overflow:na}:null,retryLane:536870912,hydrationErrors:null},J=dn(18,null,null,0),J.stateNode=P,J.return=t,t.child=J,Qt=t,Ct=null,J=!0):J=!1}J||go(t)}if(P=t.memoizedState,P!==null&&(P=P.dehydrated,P!==null))return Gs(P)?t.lanes=32:t.lanes=536870912,null;la(t)}return P=i.children,i=i.fallback,u?(Da(),u=t.mode,P=hi({mode:"hidden",children:P},u),i=fo(i,u,o,null),P.return=t,i.return=t,P.sibling=i,t.child=P,u=t.child,u.memoizedState=ss(o),u.childLanes=ds(e,A,o),t.memoizedState=cs,i):(Ta(t),us(t,P))}if(J=e.memoizedState,J!==null&&(P=J.dehydrated,P!==null)){if(v)t.flags&256?(Ta(t),t.flags&=-257,t=ps(e,t,o)):t.memoizedState!==null?(Da(),t.child=e.child,t.flags|=128,t=null):(Da(),u=i.fallback,P=t.mode,i=hi({mode:"visible",children:i.children},P),u=fo(u,P,o,null),u.flags|=2,i.return=t,u.return=t,i.sibling=u,t.child=i,tr(t,e.child,null,o),i=t.child,i.memoizedState=ss(o),i.childLanes=ds(e,A,o),t.memoizedState=cs,t=u);else if(Ta(t),Gs(P)){if(A=P.nextSibling&&P.nextSibling.dataset,A)var ie=A.dgst;A=ie,i=Error(c(419)),i.stack="",i.digest=A,Lr({value:i,source:null,stack:null}),t=ps(e,t,o)}else if(Ot||Mr(e,t,o,!1),A=(o&e.childLanes)!==0,Ot||A){if(A=ht,A!==null&&(i=o&-o,i=(i&42)!==0?1:wa(i),i=(i&(A.suspendedLanes|o))!==0?0:i,i!==0&&i!==J.retryLane))throw J.retryLane=i,Vo(e,i),mn(A,e,i),kp;P.data==="$?"||Ts(),t=ps(e,t,o)}else P.data==="$?"?(t.flags|=192,t.child=e.child,t=null):(e=J.treeContext,Ct=Mn(P.nextSibling),Qt=t,it=!0,yo=null,Vn=!1,e!==null&&(En[jn++]=ta,En[jn++]=na,En[jn++]=ho,ta=e.id,na=e.overflow,ho=t),t=us(t,i.children),t.flags|=4096);return t}return u?(Da(),u=i.fallback,P=t.mode,J=e.child,ie=J.sibling,i=ea(J,{mode:"hidden",children:i.children}),i.subtreeFlags=J.subtreeFlags&65011712,ie!==null?u=ea(ie,u):(u=fo(u,P,o,null),u.flags|=2),u.return=t,i.return=t,i.sibling=u,t.child=i,i=u,u=t.child,P=e.child.memoizedState,P===null?P=ss(o):(J=P.cachePool,J!==null?(ie=Ft._currentValue,J=J.parent!==ie?{parent:ie,pool:ie}:J):J=Cu(),P={baseLanes:P.baseLanes|o,cachePool:J}),u.memoizedState=P,u.childLanes=ds(e,A,o),t.memoizedState=cs,i):(Ta(t),o=e.child,e=o.sibling,o=ea(o,{mode:"visible",children:i.children}),o.return=t,o.sibling=null,e!==null&&(A=t.deletions,A===null?(t.deletions=[e],t.flags|=16):A.push(e)),t.child=o,t.memoizedState=null,o)}function us(e,t){return t=hi({mode:"visible",children:t},e.mode),t.return=e,e.child=t}function hi(e,t){return e=dn(22,e,null,t),e.lanes=0,e.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},e}function ps(e,t,o){return tr(t,e.child,null,o),e=us(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function Op(e,t,o){e.lanes|=t;var i=e.alternate;i!==null&&(i.lanes|=t),Tc(e.return,t,o)}function fs(e,t,o,i,u){var v=e.memoizedState;v===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:i,tail:o,tailMode:u}:(v.isBackwards=t,v.rendering=null,v.renderingStartTime=0,v.last=i,v.tail=o,v.tailMode=u)}function Ip(e,t,o){var i=t.pendingProps,u=i.revealOrder,v=i.tail;if(Pt(e,t,i.children,o),i=qt.current,(i&2)!==0)i=i&1|2,t.flags|=128;else{if(e!==null&&(e.flags&128)!==0)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&Op(e,o,t);else if(e.tag===19)Op(e,o,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}i&=1}switch(Q(qt,i),u){case"forwards":for(o=t.child,u=null;o!==null;)e=o.alternate,e!==null&&di(e)===null&&(u=o),o=o.sibling;o=u,o===null?(u=t.child,t.child=null):(u=o.sibling,o.sibling=null),fs(t,!1,u,o,v);break;case"backwards":for(o=null,u=t.child,t.child=null;u!==null;){if(e=u.alternate,e!==null&&di(e)===null){t.child=u;break}e=u.sibling,u.sibling=o,o=u,u=e}fs(t,!0,o,null,v);break;case"together":fs(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function ia(e,t,o){if(e!==null&&(t.dependencies=e.dependencies),Ua|=t.lanes,(o&t.childLanes)===0)if(e!==null){if(Mr(e,t,o,!1),(o&t.childLanes)===0)return null}else return null;if(e!==null&&t.child!==e.child)throw Error(c(153));if(t.child!==null){for(e=t.child,o=ea(e,e.pendingProps),t.child=o,o.return=t;e.sibling!==null;)e=e.sibling,o=o.sibling=ea(e,e.pendingProps),o.return=t;o.sibling=null}return t.child}function hs(e,t){return(e.lanes&t)!==0?!0:(e=e.dependencies,!!(e!==null&&Wl(e)))}function $g(e,t,o){switch(t.tag){case 3:ee(t,t.stateNode.containerInfo),Ea(t,Ft,e.memoizedState.cache),Ir();break;case 27:case 5:Se(t);break;case 4:ee(t,t.stateNode.containerInfo);break;case 10:Ea(t,t.type,t.memoizedProps.value);break;case 13:var i=t.memoizedState;if(i!==null)return i.dehydrated!==null?(Ta(t),t.flags|=128,null):(o&t.child.childLanes)!==0?Up(e,t,o):(Ta(t),e=ia(e,t,o),e!==null?e.sibling:null);Ta(t);break;case 19:var u=(e.flags&128)!==0;if(i=(o&t.childLanes)!==0,i||(Mr(e,t,o,!1),i=(o&t.childLanes)!==0),u){if(i)return Ip(e,t,o);t.flags|=128}if(u=t.memoizedState,u!==null&&(u.rendering=null,u.tail=null,u.lastEffect=null),Q(qt,qt.current),i)break;return null;case 22:case 23:return t.lanes=0,Dp(e,t,o);case 24:Ea(t,Ft,e.memoizedState.cache)}return ia(e,t,o)}function Lp(e,t,o){if(e!==null)if(e.memoizedProps!==t.pendingProps)Ot=!0;else{if(!hs(e,o)&&(t.flags&128)===0)return Ot=!1,$g(e,t,o);Ot=(e.flags&131072)!==0}else Ot=!1,it&&(t.flags&1048576)!==0&&mu(t,Gl,t.index);switch(t.lanes=0,t.tag){case 16:e:{e=t.pendingProps;var i=t.elementType,u=i._init;if(i=u(i._payload),t.type=i,typeof i=="function")bc(i)?(e=Co(i,e),t.tag=1,t=qp(null,t,i,e,o)):(t.tag=0,t=is(null,t,i,e,o));else{if(i!=null){if(u=i.$$typeof,u===N){t.tag=11,t=Rp(null,t,i,e,o);break e}else if(u===q){t.tag=14,t=Ap(null,t,i,e,o);break e}}throw t=M(i)||i,Error(c(306,t,""))}}return t;case 0:return is(e,t,t.type,t.pendingProps,o);case 1:return i=t.type,u=Co(i,t.pendingProps),qp(e,t,i,u,o);case 3:e:{if(ee(t,t.stateNode.containerInfo),e===null)throw Error(c(387));i=t.pendingProps;var v=t.memoizedState;u=v.element,Oc(e,t),Gr(t,i,null,o);var A=t.memoizedState;if(i=A.cache,Ea(t,Ft,i),i!==v.cache&&Dc(t,[Ft],o,!0),Yr(),i=A.element,v.isDehydrated)if(v={element:i,isDehydrated:!1,cache:A.cache},t.updateQueue.baseState=v,t.memoizedState=v,t.flags&256){t=$p(e,t,i,o);break e}else if(i!==u){u=bn(Error(c(424)),t),Lr(u),t=$p(e,t,i,o);break e}else{switch(e=t.stateNode.containerInfo,e.nodeType){case 9:e=e.body;break;default:e=e.nodeName==="HTML"?e.ownerDocument.body:e}for(Ct=Mn(e.firstChild),Qt=t,it=!0,yo=null,Vn=!0,o=gp(t,null,i,o),t.child=o;o;)o.flags=o.flags&-3|4096,o=o.sibling}else{if(Ir(),i===u){t=ia(e,t,o);break e}Pt(e,t,i,o)}t=t.child}return t;case 26:return fi(e,t),e===null?(o=Vf(t.type,null,t.pendingProps,null))?t.memoizedState=o:it||(o=t.type,e=t.pendingProps,i=Ri(Y.current).createElement(o),i[St]=t,i[Nt]=e,zt(i,o,e),fe(i),t.stateNode=i):t.memoizedState=Vf(t.type,e.memoizedProps,t.pendingProps,e.memoizedState),null;case 27:return Se(t),e===null&&it&&(i=t.stateNode=Pf(t.type,t.pendingProps,Y.current),Qt=t,Vn=!0,u=Ct,Ma(t.type)?(Ws=u,Ct=Mn(i.firstChild)):Ct=u),Pt(e,t,t.pendingProps.children,o),fi(e,t),e===null&&(t.flags|=4194304),t.child;case 5:return e===null&&it&&((u=i=Ct)&&(i=sv(i,t.type,t.pendingProps,Vn),i!==null?(t.stateNode=i,Qt=t,Ct=Mn(i.firstChild),Vn=!1,u=!0):u=!1),u||go(t)),Se(t),u=t.type,v=t.pendingProps,A=e!==null?e.memoizedProps:null,i=v.children,Vs(u,v)?i=null:A!==null&&Vs(u,A)&&(t.flags|=32),t.memoizedState!==null&&(u=zc(e,t,kg,null,null,o),ml._currentValue=u),fi(e,t),Pt(e,t,i,o),t.child;case 6:return e===null&&it&&((e=o=Ct)&&(o=dv(o,t.pendingProps,Vn),o!==null?(t.stateNode=o,Qt=t,Ct=null,e=!0):e=!1),e||go(t)),null;case 13:return Up(e,t,o);case 4:return ee(t,t.stateNode.containerInfo),i=t.pendingProps,e===null?t.child=tr(t,null,i,o):Pt(e,t,i,o),t.child;case 11:return Rp(e,t,t.type,t.pendingProps,o);case 7:return Pt(e,t,t.pendingProps,o),t.child;case 8:return Pt(e,t,t.pendingProps.children,o),t.child;case 12:return Pt(e,t,t.pendingProps.children,o),t.child;case 10:return i=t.pendingProps,Ea(t,t.type,i.value),Pt(e,t,i.children,o),t.child;case 9:return u=t.type._context,i=t.pendingProps.children,_o(t),u=Yt(u),i=i(u),t.flags|=1,Pt(e,t,i,o),t.child;case 14:return Ap(e,t,t.type,t.pendingProps,o);case 15:return Tp(e,t,t.type,t.pendingProps,o);case 19:return Ip(e,t,o);case 31:return i=t.pendingProps,o=t.mode,i={mode:i.mode,children:i.children},e===null?(o=hi(i,o),o.ref=t.ref,t.child=o,o.return=t,t=o):(o=ea(e.child,i),o.ref=t.ref,t.child=o,o.return=t,t=o),t;case 22:return Dp(e,t,o);case 24:return _o(t),i=Yt(Ft),e===null?(u=qc(),u===null&&(u=ht,v=Nc(),u.pooledCache=v,v.refCount++,v!==null&&(u.pooledCacheLanes|=o),u=v),t.memoizedState={parent:i,cache:u},Uc(t),Ea(t,Ft,u)):((e.lanes&o)!==0&&(Oc(e,t),Gr(t,null,null,o),Yr()),u=e.memoizedState,v=t.memoizedState,u.parent!==i?(u={parent:i,cache:i},t.memoizedState=u,t.lanes===0&&(t.memoizedState=t.updateQueue.baseState=u),Ea(t,Ft,i)):(i=v.cache,Ea(t,Ft,i),i!==u.cache&&Dc(t,[Ft],o,!0))),Pt(e,t,t.pendingProps.children,o),t.child;case 29:throw t.pendingProps}throw Error(c(156,t.tag))}function ca(e){e.flags|=4}function Mp(e,t){if(t.type!=="stylesheet"||(t.state.loading&4)!==0)e.flags&=-16777217;else if(e.flags|=16777216,!Qf(t)){if(t=kn.current,t!==null&&((nt&4194048)===nt?Bn!==null:(nt&62914560)!==nt&&(nt&536870912)===0||t!==Bn))throw Vr=$c,bu;e.flags|=8192}}function mi(e,t){t!==null&&(e.flags|=4),e.flags&16384&&(t=e.tag!==22?no():536870912,e.lanes|=t,rr|=t)}function el(e,t){if(!it)switch(e.tailMode){case"hidden":t=e.tail;for(var o=null;t!==null;)t.alternate!==null&&(o=t),t=t.sibling;o===null?e.tail=null:o.sibling=null;break;case"collapsed":o=e.tail;for(var i=null;o!==null;)o.alternate!==null&&(i=o),o=o.sibling;i===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:i.sibling=null}}function _t(e){var t=e.alternate!==null&&e.alternate.child===e.child,o=0,i=0;if(t)for(var u=e.child;u!==null;)o|=u.lanes|u.childLanes,i|=u.subtreeFlags&65011712,i|=u.flags&65011712,u.return=e,u=u.sibling;else for(u=e.child;u!==null;)o|=u.lanes|u.childLanes,i|=u.subtreeFlags,i|=u.flags,u.return=e,u=u.sibling;return e.subtreeFlags|=i,e.childLanes=o,t}function Ug(e,t,o){var i=t.pendingProps;switch(kc(t),t.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return _t(t),null;case 1:return _t(t),null;case 3:return o=t.stateNode,i=null,e!==null&&(i=e.memoizedState.cache),t.memoizedState.cache!==i&&(t.flags|=2048),oa(Ft),ge(),o.pendingContext&&(o.context=o.pendingContext,o.pendingContext=null),(e===null||e.child===null)&&(Or(t)?ca(t):e===null||e.memoizedState.isDehydrated&&(t.flags&256)===0||(t.flags|=1024,vu())),_t(t),null;case 26:return o=t.memoizedState,e===null?(ca(t),o!==null?(_t(t),Mp(t,o)):(_t(t),t.flags&=-16777217)):o?o!==e.memoizedState?(ca(t),_t(t),Mp(t,o)):(_t(t),t.flags&=-16777217):(e.memoizedProps!==i&&ca(t),_t(t),t.flags&=-16777217),null;case 27:ye(t),o=Y.current;var u=t.type;if(e!==null&&t.stateNode!=null)e.memoizedProps!==i&&ca(t);else{if(!i){if(t.stateNode===null)throw Error(c(166));return _t(t),null}e=I.current,Or(t)?yu(t):(e=Pf(u,i,o),t.stateNode=e,ca(t))}return _t(t),null;case 5:if(ye(t),o=t.type,e!==null&&t.stateNode!=null)e.memoizedProps!==i&&ca(t);else{if(!i){if(t.stateNode===null)throw Error(c(166));return _t(t),null}if(e=I.current,Or(t))yu(t);else{switch(u=Ri(Y.current),e){case 1:e=u.createElementNS("http://www.w3.org/2000/svg",o);break;case 2:e=u.createElementNS("http://www.w3.org/1998/Math/MathML",o);break;default:switch(o){case"svg":e=u.createElementNS("http://www.w3.org/2000/svg",o);break;case"math":e=u.createElementNS("http://www.w3.org/1998/Math/MathML",o);break;case"script":e=u.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild);break;case"select":e=typeof i.is=="string"?u.createElement("select",{is:i.is}):u.createElement("select"),i.multiple?e.multiple=!0:i.size&&(e.size=i.size);break;default:e=typeof i.is=="string"?u.createElement(o,{is:i.is}):u.createElement(o)}}e[St]=t,e[Nt]=i;e:for(u=t.child;u!==null;){if(u.tag===5||u.tag===6)e.appendChild(u.stateNode);else if(u.tag!==4&&u.tag!==27&&u.child!==null){u.child.return=u,u=u.child;continue}if(u===t)break e;for(;u.sibling===null;){if(u.return===null||u.return===t)break e;u=u.return}u.sibling.return=u.return,u=u.sibling}t.stateNode=e;e:switch(zt(e,o,i),o){case"button":case"input":case"select":case"textarea":e=!!i.autoFocus;break e;case"img":e=!0;break e;default:e=!1}e&&ca(t)}}return _t(t),t.flags&=-16777217,null;case 6:if(e&&t.stateNode!=null)e.memoizedProps!==i&&ca(t);else{if(typeof i!="string"&&t.stateNode===null)throw Error(c(166));if(e=Y.current,Or(t)){if(e=t.stateNode,o=t.memoizedProps,i=null,u=Qt,u!==null)switch(u.tag){case 27:case 5:i=u.memoizedProps}e[St]=t,e=!!(e.nodeValue===o||i!==null&&i.suppressHydrationWarning===!0||qf(e.nodeValue,o)),e||go(t)}else e=Ri(e).createTextNode(i),e[St]=t,t.stateNode=e}return _t(t),null;case 13:if(i=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(u=Or(t),i!==null&&i.dehydrated!==null){if(e===null){if(!u)throw Error(c(318));if(u=t.memoizedState,u=u!==null?u.dehydrated:null,!u)throw Error(c(317));u[St]=t}else Ir(),(t.flags&128)===0&&(t.memoizedState=null),t.flags|=4;_t(t),u=!1}else u=vu(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=u),u=!0;if(!u)return t.flags&256?(la(t),t):(la(t),null)}if(la(t),(t.flags&128)!==0)return t.lanes=o,t;if(o=i!==null,e=e!==null&&e.memoizedState!==null,o){i=t.child,u=null,i.alternate!==null&&i.alternate.memoizedState!==null&&i.alternate.memoizedState.cachePool!==null&&(u=i.alternate.memoizedState.cachePool.pool);var v=null;i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(v=i.memoizedState.cachePool.pool),v!==u&&(i.flags|=2048)}return o!==e&&o&&(t.child.flags|=8192),mi(t,t.updateQueue),_t(t),null;case 4:return ge(),e===null&&Ls(t.stateNode.containerInfo),_t(t),null;case 10:return oa(t.type),_t(t),null;case 19:if(Z(qt),u=t.memoizedState,u===null)return _t(t),null;if(i=(t.flags&128)!==0,v=u.rendering,v===null)if(i)el(u,!1);else{if(bt!==0||e!==null&&(e.flags&128)!==0)for(e=t.child;e!==null;){if(v=di(e),v!==null){for(t.flags|=128,el(u,!1),e=v.updateQueue,t.updateQueue=e,mi(t,e),t.subtreeFlags=0,e=o,o=t.child;o!==null;)hu(o,e),o=o.sibling;return Q(qt,qt.current&1|2),t.child}e=e.sibling}u.tail!==null&&Ce()>vi&&(t.flags|=128,i=!0,el(u,!1),t.lanes=4194304)}else{if(!i)if(e=di(v),e!==null){if(t.flags|=128,i=!0,e=e.updateQueue,t.updateQueue=e,mi(t,e),el(u,!0),u.tail===null&&u.tailMode==="hidden"&&!v.alternate&&!it)return _t(t),null}else 2*Ce()-u.renderingStartTime>vi&&o!==536870912&&(t.flags|=128,i=!0,el(u,!1),t.lanes=4194304);u.isBackwards?(v.sibling=t.child,t.child=v):(e=u.last,e!==null?e.sibling=v:t.child=v,u.last=v)}return u.tail!==null?(t=u.tail,u.rendering=t,u.tail=t.sibling,u.renderingStartTime=Ce(),t.sibling=null,e=qt.current,Q(qt,i?e&1|2:e&1),t):(_t(t),null);case 22:case 23:return la(t),Pc(),i=t.memoizedState!==null,e!==null?e.memoizedState!==null!==i&&(t.flags|=8192):i&&(t.flags|=8192),i?(o&536870912)!==0&&(t.flags&128)===0&&(_t(t),t.subtreeFlags&6&&(t.flags|=8192)):_t(t),o=t.updateQueue,o!==null&&mi(t,o.retryQueue),o=null,e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(o=e.memoizedState.cachePool.pool),i=null,t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(i=t.memoizedState.cachePool.pool),i!==o&&(t.flags|=2048),e!==null&&Z(xo),null;case 24:return o=null,e!==null&&(o=e.memoizedState.cache),t.memoizedState.cache!==o&&(t.flags|=2048),oa(Ft),_t(t),null;case 25:return null;case 30:return null}throw Error(c(156,t.tag))}function Og(e,t){switch(kc(t),t.tag){case 1:return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return oa(Ft),ge(),e=t.flags,(e&65536)!==0&&(e&128)===0?(t.flags=e&-65537|128,t):null;case 26:case 27:case 5:return ye(t),null;case 13:if(la(t),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(c(340));Ir()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return Z(qt),null;case 4:return ge(),null;case 10:return oa(t.type),null;case 22:case 23:return la(t),Pc(),e!==null&&Z(xo),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 24:return oa(Ft),null;case 25:return null;default:return null}}function Pp(e,t){switch(kc(t),t.tag){case 3:oa(Ft),ge();break;case 26:case 27:case 5:ye(t);break;case 4:ge();break;case 13:la(t);break;case 19:Z(qt);break;case 10:oa(t.type);break;case 22:case 23:la(t),Pc(),e!==null&&Z(xo);break;case 24:oa(Ft)}}function tl(e,t){try{var o=t.updateQueue,i=o!==null?o.lastEffect:null;if(i!==null){var u=i.next;o=u;do{if((o.tag&e)===e){i=void 0;var v=o.create,A=o.inst;i=v(),A.destroy=i}o=o.next}while(o!==u)}}catch(P){ft(t,t.return,P)}}function Na(e,t,o){try{var i=t.updateQueue,u=i!==null?i.lastEffect:null;if(u!==null){var v=u.next;i=v;do{if((i.tag&e)===e){var A=i.inst,P=A.destroy;if(P!==void 0){A.destroy=void 0,u=t;var J=o,ie=P;try{ie()}catch(pe){ft(u,J,pe)}}}i=i.next}while(i!==v)}}catch(pe){ft(t,t.return,pe)}}function Hp(e){var t=e.updateQueue;if(t!==null){var o=e.stateNode;try{Au(t,o)}catch(i){ft(e,e.return,i)}}}function zp(e,t,o){o.props=Co(e.type,e.memoizedProps),o.state=e.memoizedState;try{o.componentWillUnmount()}catch(i){ft(e,t,i)}}function nl(e,t){try{var o=e.ref;if(o!==null){switch(e.tag){case 26:case 27:case 5:var i=e.stateNode;break;case 30:i=e.stateNode;break;default:i=e.stateNode}typeof o=="function"?e.refCleanup=o(i):o.current=i}}catch(u){ft(e,t,u)}}function Yn(e,t){var o=e.ref,i=e.refCleanup;if(o!==null)if(typeof i=="function")try{i()}catch(u){ft(e,t,u)}finally{e.refCleanup=null,e=e.alternate,e!=null&&(e.refCleanup=null)}else if(typeof o=="function")try{o(null)}catch(u){ft(e,t,u)}else o.current=null}function Vp(e){var t=e.type,o=e.memoizedProps,i=e.stateNode;try{e:switch(t){case"button":case"input":case"select":case"textarea":o.autoFocus&&i.focus();break e;case"img":o.src?i.src=o.src:o.srcSet&&(i.srcset=o.srcSet)}}catch(u){ft(e,e.return,u)}}function ms(e,t,o){try{var i=e.stateNode;ov(i,e.type,o,t),i[Nt]=t}catch(u){ft(e,e.return,u)}}function Bp(e){return e.tag===5||e.tag===3||e.tag===26||e.tag===27&&Ma(e.type)||e.tag===4}function ys(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||Bp(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.tag===27&&Ma(e.type)||e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function gs(e,t,o){var i=e.tag;if(i===5||i===6)e=e.stateNode,t?(o.nodeType===9?o.body:o.nodeName==="HTML"?o.ownerDocument.body:o).insertBefore(e,t):(t=o.nodeType===9?o.body:o.nodeName==="HTML"?o.ownerDocument.body:o,t.appendChild(e),o=o._reactRootContainer,o!=null||t.onclick!==null||(t.onclick=ki));else if(i!==4&&(i===27&&Ma(e.type)&&(o=e.stateNode,t=null),e=e.child,e!==null))for(gs(e,t,o),e=e.sibling;e!==null;)gs(e,t,o),e=e.sibling}function yi(e,t,o){var i=e.tag;if(i===5||i===6)e=e.stateNode,t?o.insertBefore(e,t):o.appendChild(e);else if(i!==4&&(i===27&&Ma(e.type)&&(o=e.stateNode),e=e.child,e!==null))for(yi(e,t,o),e=e.sibling;e!==null;)yi(e,t,o),e=e.sibling}function Yp(e){var t=e.stateNode,o=e.memoizedProps;try{for(var i=e.type,u=t.attributes;u.length;)t.removeAttributeNode(u[0]);zt(t,i,o),t[St]=e,t[Nt]=o}catch(v){ft(e,e.return,v)}}var sa=!1,kt=!1,vs=!1,Gp=typeof WeakSet=="function"?WeakSet:Set,It=null;function Ig(e,t){if(e=e.containerInfo,Hs=qi,e=ou(e),yc(e)){if("selectionStart"in e)var o={start:e.selectionStart,end:e.selectionEnd};else e:{o=(o=e.ownerDocument)&&o.defaultView||window;var i=o.getSelection&&o.getSelection();if(i&&i.rangeCount!==0){o=i.anchorNode;var u=i.anchorOffset,v=i.focusNode;i=i.focusOffset;try{o.nodeType,v.nodeType}catch{o=null;break e}var A=0,P=-1,J=-1,ie=0,pe=0,me=e,ce=null;t:for(;;){for(var se;me!==o||u!==0&&me.nodeType!==3||(P=A+u),me!==v||i!==0&&me.nodeType!==3||(J=A+i),me.nodeType===3&&(A+=me.nodeValue.length),(se=me.firstChild)!==null;)ce=me,me=se;for(;;){if(me===e)break t;if(ce===o&&++ie===u&&(P=A),ce===v&&++pe===i&&(J=A),(se=me.nextSibling)!==null)break;me=ce,ce=me.parentNode}me=se}o=P===-1||J===-1?null:{start:P,end:J}}else o=null}o=o||{start:0,end:0}}else o=null;for(zs={focusedElem:e,selectionRange:o},qi=!1,It=t;It!==null;)if(t=It,e=t.child,(t.subtreeFlags&1024)!==0&&e!==null)e.return=t,It=e;else for(;It!==null;){switch(t=It,v=t.alternate,e=t.flags,t.tag){case 0:break;case 11:case 15:break;case 1:if((e&1024)!==0&&v!==null){e=void 0,o=t,u=v.memoizedProps,v=v.memoizedState,i=o.stateNode;try{var Oe=Co(o.type,u,o.elementType===o.type);e=i.getSnapshotBeforeUpdate(Oe,v),i.__reactInternalSnapshotBeforeUpdate=e}catch(qe){ft(o,o.return,qe)}}break;case 3:if((e&1024)!==0){if(e=t.stateNode.containerInfo,o=e.nodeType,o===9)Ys(e);else if(o===1)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":Ys(e);break;default:e.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((e&1024)!==0)throw Error(c(163))}if(e=t.sibling,e!==null){e.return=t.return,It=e;break}It=t.return}}function Wp(e,t,o){var i=o.flags;switch(o.tag){case 0:case 11:case 15:Fa(e,o),i&4&&tl(5,o);break;case 1:if(Fa(e,o),i&4)if(e=o.stateNode,t===null)try{e.componentDidMount()}catch(A){ft(o,o.return,A)}else{var u=Co(o.type,t.memoizedProps);t=t.memoizedState;try{e.componentDidUpdate(u,t,e.__reactInternalSnapshotBeforeUpdate)}catch(A){ft(o,o.return,A)}}i&64&&Hp(o),i&512&&nl(o,o.return);break;case 3:if(Fa(e,o),i&64&&(e=o.updateQueue,e!==null)){if(t=null,o.child!==null)switch(o.child.tag){case 27:case 5:t=o.child.stateNode;break;case 1:t=o.child.stateNode}try{Au(e,t)}catch(A){ft(o,o.return,A)}}break;case 27:t===null&&i&4&&Yp(o);case 26:case 5:Fa(e,o),t===null&&i&4&&Vp(o),i&512&&nl(o,o.return);break;case 12:Fa(e,o);break;case 13:Fa(e,o),i&4&&Zp(e,o),i&64&&(e=o.memoizedState,e!==null&&(e=e.dehydrated,e!==null&&(o=Gg.bind(null,o),uv(e,o))));break;case 22:if(i=o.memoizedState!==null||sa,!i){t=t!==null&&t.memoizedState!==null||kt,u=sa;var v=kt;sa=i,(kt=t)&&!v?qa(e,o,(o.subtreeFlags&8772)!==0):Fa(e,o),sa=u,kt=v}break;case 30:break;default:Fa(e,o)}}function Qp(e){var t=e.alternate;t!==null&&(e.alternate=null,Qp(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&tt(t)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var gt=null,tn=!1;function da(e,t,o){for(o=o.child;o!==null;)Xp(e,t,o),o=o.sibling}function Xp(e,t,o){if($t&&typeof $t.onCommitFiberUnmount=="function")try{$t.onCommitFiberUnmount(qn,o)}catch{}switch(o.tag){case 26:kt||Yn(o,t),da(e,t,o),o.memoizedState?o.memoizedState.count--:o.stateNode&&(o=o.stateNode,o.parentNode.removeChild(o));break;case 27:kt||Yn(o,t);var i=gt,u=tn;Ma(o.type)&&(gt=o.stateNode,tn=!1),da(e,t,o),ul(o.stateNode),gt=i,tn=u;break;case 5:kt||Yn(o,t);case 6:if(i=gt,u=tn,gt=null,da(e,t,o),gt=i,tn=u,gt!==null)if(tn)try{(gt.nodeType===9?gt.body:gt.nodeName==="HTML"?gt.ownerDocument.body:gt).removeChild(o.stateNode)}catch(v){ft(o,t,v)}else try{gt.removeChild(o.stateNode)}catch(v){ft(o,t,v)}break;case 18:gt!==null&&(tn?(e=gt,Lf(e.nodeType===9?e.body:e.nodeName==="HTML"?e.ownerDocument.body:e,o.stateNode),_l(e)):Lf(gt,o.stateNode));break;case 4:i=gt,u=tn,gt=o.stateNode.containerInfo,tn=!0,da(e,t,o),gt=i,tn=u;break;case 0:case 11:case 14:case 15:kt||Na(2,o,t),kt||Na(4,o,t),da(e,t,o);break;case 1:kt||(Yn(o,t),i=o.stateNode,typeof i.componentWillUnmount=="function"&&zp(o,t,i)),da(e,t,o);break;case 21:da(e,t,o);break;case 22:kt=(i=kt)||o.memoizedState!==null,da(e,t,o),kt=i;break;default:da(e,t,o)}}function Zp(e,t){if(t.memoizedState===null&&(e=t.alternate,e!==null&&(e=e.memoizedState,e!==null&&(e=e.dehydrated,e!==null))))try{_l(e)}catch(o){ft(t,t.return,o)}}function Lg(e){switch(e.tag){case 13:case 19:var t=e.stateNode;return t===null&&(t=e.stateNode=new Gp),t;case 22:return e=e.stateNode,t=e._retryCache,t===null&&(t=e._retryCache=new Gp),t;default:throw Error(c(435,e.tag))}}function _s(e,t){var o=Lg(e);t.forEach(function(i){var u=Wg.bind(null,e,i);o.has(i)||(o.add(i),i.then(u,u))})}function un(e,t){var o=t.deletions;if(o!==null)for(var i=0;i<o.length;i++){var u=o[i],v=e,A=t,P=A;e:for(;P!==null;){switch(P.tag){case 27:if(Ma(P.type)){gt=P.stateNode,tn=!1;break e}break;case 5:gt=P.stateNode,tn=!1;break e;case 3:case 4:gt=P.stateNode.containerInfo,tn=!0;break e}P=P.return}if(gt===null)throw Error(c(160));Xp(v,A,u),gt=null,tn=!1,v=u.alternate,v!==null&&(v.return=null),u.return=null}if(t.subtreeFlags&13878)for(t=t.child;t!==null;)Kp(t,e),t=t.sibling}var Ln=null;function Kp(e,t){var o=e.alternate,i=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:un(t,e),pn(e),i&4&&(Na(3,e,e.return),tl(3,e),Na(5,e,e.return));break;case 1:un(t,e),pn(e),i&512&&(kt||o===null||Yn(o,o.return)),i&64&&sa&&(e=e.updateQueue,e!==null&&(i=e.callbacks,i!==null&&(o=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=o===null?i:o.concat(i))));break;case 26:var u=Ln;if(un(t,e),pn(e),i&512&&(kt||o===null||Yn(o,o.return)),i&4){var v=o!==null?o.memoizedState:null;if(i=e.memoizedState,o===null)if(i===null)if(e.stateNode===null){e:{i=e.type,o=e.memoizedProps,u=u.ownerDocument||u;t:switch(i){case"title":v=u.getElementsByTagName("title")[0],(!v||v[Pe]||v[St]||v.namespaceURI==="http://www.w3.org/2000/svg"||v.hasAttribute("itemprop"))&&(v=u.createElement(i),u.head.insertBefore(v,u.querySelector("head > title"))),zt(v,i,o),v[St]=e,fe(v),i=v;break e;case"link":var A=Gf("link","href",u).get(i+(o.href||""));if(A){for(var P=0;P<A.length;P++)if(v=A[P],v.getAttribute("href")===(o.href==null||o.href===""?null:o.href)&&v.getAttribute("rel")===(o.rel==null?null:o.rel)&&v.getAttribute("title")===(o.title==null?null:o.title)&&v.getAttribute("crossorigin")===(o.crossOrigin==null?null:o.crossOrigin)){A.splice(P,1);break t}}v=u.createElement(i),zt(v,i,o),u.head.appendChild(v);break;case"meta":if(A=Gf("meta","content",u).get(i+(o.content||""))){for(P=0;P<A.length;P++)if(v=A[P],v.getAttribute("content")===(o.content==null?null:""+o.content)&&v.getAttribute("name")===(o.name==null?null:o.name)&&v.getAttribute("property")===(o.property==null?null:o.property)&&v.getAttribute("http-equiv")===(o.httpEquiv==null?null:o.httpEquiv)&&v.getAttribute("charset")===(o.charSet==null?null:o.charSet)){A.splice(P,1);break t}}v=u.createElement(i),zt(v,i,o),u.head.appendChild(v);break;default:throw Error(c(468,i))}v[St]=e,fe(v),i=v}e.stateNode=i}else Wf(u,e.type,e.stateNode);else e.stateNode=Yf(u,i,e.memoizedProps);else v!==i?(v===null?o.stateNode!==null&&(o=o.stateNode,o.parentNode.removeChild(o)):v.count--,i===null?Wf(u,e.type,e.stateNode):Yf(u,i,e.memoizedProps)):i===null&&e.stateNode!==null&&ms(e,e.memoizedProps,o.memoizedProps)}break;case 27:un(t,e),pn(e),i&512&&(kt||o===null||Yn(o,o.return)),o!==null&&i&4&&ms(e,e.memoizedProps,o.memoizedProps);break;case 5:if(un(t,e),pn(e),i&512&&(kt||o===null||Yn(o,o.return)),e.flags&32){u=e.stateNode;try{Oo(u,"")}catch(se){ft(e,e.return,se)}}i&4&&e.stateNode!=null&&(u=e.memoizedProps,ms(e,u,o!==null?o.memoizedProps:u)),i&1024&&(vs=!0);break;case 6:if(un(t,e),pn(e),i&4){if(e.stateNode===null)throw Error(c(162));i=e.memoizedProps,o=e.stateNode;try{o.nodeValue=i}catch(se){ft(e,e.return,se)}}break;case 3:if(Di=null,u=Ln,Ln=Ai(t.containerInfo),un(t,e),Ln=u,pn(e),i&4&&o!==null&&o.memoizedState.isDehydrated)try{_l(t.containerInfo)}catch(se){ft(e,e.return,se)}vs&&(vs=!1,Jp(e));break;case 4:i=Ln,Ln=Ai(e.stateNode.containerInfo),un(t,e),pn(e),Ln=i;break;case 12:un(t,e),pn(e);break;case 13:un(t,e),pn(e),e.child.flags&8192&&e.memoizedState!==null!=(o!==null&&o.memoizedState!==null)&&(Es=Ce()),i&4&&(i=e.updateQueue,i!==null&&(e.updateQueue=null,_s(e,i)));break;case 22:u=e.memoizedState!==null;var J=o!==null&&o.memoizedState!==null,ie=sa,pe=kt;if(sa=ie||u,kt=pe||J,un(t,e),kt=pe,sa=ie,pn(e),i&8192)e:for(t=e.stateNode,t._visibility=u?t._visibility&-2:t._visibility|1,u&&(o===null||J||sa||kt||bo(e)),o=null,t=e;;){if(t.tag===5||t.tag===26){if(o===null){J=o=t;try{if(v=J.stateNode,u)A=v.style,typeof A.setProperty=="function"?A.setProperty("display","none","important"):A.display="none";else{P=J.stateNode;var me=J.memoizedProps.style,ce=me!=null&&me.hasOwnProperty("display")?me.display:null;P.style.display=ce==null||typeof ce=="boolean"?"":(""+ce).trim()}}catch(se){ft(J,J.return,se)}}}else if(t.tag===6){if(o===null){J=t;try{J.stateNode.nodeValue=u?"":J.memoizedProps}catch(se){ft(J,J.return,se)}}}else if((t.tag!==22&&t.tag!==23||t.memoizedState===null||t===e)&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;o===t&&(o=null),t=t.return}o===t&&(o=null),t.sibling.return=t.return,t=t.sibling}i&4&&(i=e.updateQueue,i!==null&&(o=i.retryQueue,o!==null&&(i.retryQueue=null,_s(e,o))));break;case 19:un(t,e),pn(e),i&4&&(i=e.updateQueue,i!==null&&(e.updateQueue=null,_s(e,i)));break;case 30:break;case 21:break;default:un(t,e),pn(e)}}function pn(e){var t=e.flags;if(t&2){try{for(var o,i=e.return;i!==null;){if(Bp(i)){o=i;break}i=i.return}if(o==null)throw Error(c(160));switch(o.tag){case 27:var u=o.stateNode,v=ys(e);yi(e,v,u);break;case 5:var A=o.stateNode;o.flags&32&&(Oo(A,""),o.flags&=-33);var P=ys(e);yi(e,P,A);break;case 3:case 4:var J=o.stateNode.containerInfo,ie=ys(e);gs(e,ie,J);break;default:throw Error(c(161))}}catch(pe){ft(e,e.return,pe)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function Jp(e){if(e.subtreeFlags&1024)for(e=e.child;e!==null;){var t=e;Jp(t),t.tag===5&&t.flags&1024&&t.stateNode.reset(),e=e.sibling}}function Fa(e,t){if(t.subtreeFlags&8772)for(t=t.child;t!==null;)Wp(e,t.alternate,t),t=t.sibling}function bo(e){for(e=e.child;e!==null;){var t=e;switch(t.tag){case 0:case 11:case 14:case 15:Na(4,t,t.return),bo(t);break;case 1:Yn(t,t.return);var o=t.stateNode;typeof o.componentWillUnmount=="function"&&zp(t,t.return,o),bo(t);break;case 27:ul(t.stateNode);case 26:case 5:Yn(t,t.return),bo(t);break;case 22:t.memoizedState===null&&bo(t);break;case 30:bo(t);break;default:bo(t)}e=e.sibling}}function qa(e,t,o){for(o=o&&(t.subtreeFlags&8772)!==0,t=t.child;t!==null;){var i=t.alternate,u=e,v=t,A=v.flags;switch(v.tag){case 0:case 11:case 15:qa(u,v,o),tl(4,v);break;case 1:if(qa(u,v,o),i=v,u=i.stateNode,typeof u.componentDidMount=="function")try{u.componentDidMount()}catch(ie){ft(i,i.return,ie)}if(i=v,u=i.updateQueue,u!==null){var P=i.stateNode;try{var J=u.shared.hiddenCallbacks;if(J!==null)for(u.shared.hiddenCallbacks=null,u=0;u<J.length;u++)Ru(J[u],P)}catch(ie){ft(i,i.return,ie)}}o&&A&64&&Hp(v),nl(v,v.return);break;case 27:Yp(v);case 26:case 5:qa(u,v,o),o&&i===null&&A&4&&Vp(v),nl(v,v.return);break;case 12:qa(u,v,o);break;case 13:qa(u,v,o),o&&A&4&&Zp(u,v);break;case 22:v.memoizedState===null&&qa(u,v,o),nl(v,v.return);break;case 30:break;default:qa(u,v,o)}t=t.sibling}}function xs(e,t){var o=null;e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(o=e.memoizedState.cachePool.pool),e=null,t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(e=t.memoizedState.cachePool.pool),e!==o&&(e!=null&&e.refCount++,o!=null&&Pr(o))}function ws(e,t){e=null,t.alternate!==null&&(e=t.alternate.memoizedState.cache),t=t.memoizedState.cache,t!==e&&(t.refCount++,e!=null&&Pr(e))}function Gn(e,t,o,i){if(t.subtreeFlags&10256)for(t=t.child;t!==null;)ef(e,t,o,i),t=t.sibling}function ef(e,t,o,i){var u=t.flags;switch(t.tag){case 0:case 11:case 15:Gn(e,t,o,i),u&2048&&tl(9,t);break;case 1:Gn(e,t,o,i);break;case 3:Gn(e,t,o,i),u&2048&&(e=null,t.alternate!==null&&(e=t.alternate.memoizedState.cache),t=t.memoizedState.cache,t!==e&&(t.refCount++,e!=null&&Pr(e)));break;case 12:if(u&2048){Gn(e,t,o,i),e=t.stateNode;try{var v=t.memoizedProps,A=v.id,P=v.onPostCommit;typeof P=="function"&&P(A,t.alternate===null?"mount":"update",e.passiveEffectDuration,-0)}catch(J){ft(t,t.return,J)}}else Gn(e,t,o,i);break;case 13:Gn(e,t,o,i);break;case 23:break;case 22:v=t.stateNode,A=t.alternate,t.memoizedState!==null?v._visibility&2?Gn(e,t,o,i):al(e,t):v._visibility&2?Gn(e,t,o,i):(v._visibility|=2,nr(e,t,o,i,(t.subtreeFlags&10256)!==0)),u&2048&&xs(A,t);break;case 24:Gn(e,t,o,i),u&2048&&ws(t.alternate,t);break;default:Gn(e,t,o,i)}}function nr(e,t,o,i,u){for(u=u&&(t.subtreeFlags&10256)!==0,t=t.child;t!==null;){var v=e,A=t,P=o,J=i,ie=A.flags;switch(A.tag){case 0:case 11:case 15:nr(v,A,P,J,u),tl(8,A);break;case 23:break;case 22:var pe=A.stateNode;A.memoizedState!==null?pe._visibility&2?nr(v,A,P,J,u):al(v,A):(pe._visibility|=2,nr(v,A,P,J,u)),u&&ie&2048&&xs(A.alternate,A);break;case 24:nr(v,A,P,J,u),u&&ie&2048&&ws(A.alternate,A);break;default:nr(v,A,P,J,u)}t=t.sibling}}function al(e,t){if(t.subtreeFlags&10256)for(t=t.child;t!==null;){var o=e,i=t,u=i.flags;switch(i.tag){case 22:al(o,i),u&2048&&xs(i.alternate,i);break;case 24:al(o,i),u&2048&&ws(i.alternate,i);break;default:al(o,i)}t=t.sibling}}var ol=8192;function ar(e){if(e.subtreeFlags&ol)for(e=e.child;e!==null;)tf(e),e=e.sibling}function tf(e){switch(e.tag){case 26:ar(e),e.flags&ol&&e.memoizedState!==null&&Sv(Ln,e.memoizedState,e.memoizedProps);break;case 5:ar(e);break;case 3:case 4:var t=Ln;Ln=Ai(e.stateNode.containerInfo),ar(e),Ln=t;break;case 22:e.memoizedState===null&&(t=e.alternate,t!==null&&t.memoizedState!==null?(t=ol,ol=16777216,ar(e),ol=t):ar(e));break;default:ar(e)}}function nf(e){var t=e.alternate;if(t!==null&&(e=t.child,e!==null)){t.child=null;do t=e.sibling,e.sibling=null,e=t;while(e!==null)}}function rl(e){var t=e.deletions;if((e.flags&16)!==0){if(t!==null)for(var o=0;o<t.length;o++){var i=t[o];It=i,of(i,e)}nf(e)}if(e.subtreeFlags&10256)for(e=e.child;e!==null;)af(e),e=e.sibling}function af(e){switch(e.tag){case 0:case 11:case 15:rl(e),e.flags&2048&&Na(9,e,e.return);break;case 3:rl(e);break;case 12:rl(e);break;case 22:var t=e.stateNode;e.memoizedState!==null&&t._visibility&2&&(e.return===null||e.return.tag!==13)?(t._visibility&=-3,gi(e)):rl(e);break;default:rl(e)}}function gi(e){var t=e.deletions;if((e.flags&16)!==0){if(t!==null)for(var o=0;o<t.length;o++){var i=t[o];It=i,of(i,e)}nf(e)}for(e=e.child;e!==null;){switch(t=e,t.tag){case 0:case 11:case 15:Na(8,t,t.return),gi(t);break;case 22:o=t.stateNode,o._visibility&2&&(o._visibility&=-3,gi(t));break;default:gi(t)}e=e.sibling}}function of(e,t){for(;It!==null;){var o=It;switch(o.tag){case 0:case 11:case 15:Na(8,o,t);break;case 23:case 22:if(o.memoizedState!==null&&o.memoizedState.cachePool!==null){var i=o.memoizedState.cachePool.pool;i!=null&&i.refCount++}break;case 24:Pr(o.memoizedState.cache)}if(i=o.child,i!==null)i.return=o,It=i;else e:for(o=e;It!==null;){i=It;var u=i.sibling,v=i.return;if(Qp(i),i===o){It=null;break e}if(u!==null){u.return=v,It=u;break e}It=v}}}var Mg={getCacheForType:function(e){var t=Yt(Ft),o=t.data.get(e);return o===void 0&&(o=e(),t.data.set(e,o)),o}},Pg=typeof WeakMap=="function"?WeakMap:Map,ct=0,ht=null,Xe=null,nt=0,st=0,fn=null,$a=!1,or=!1,Cs=!1,ua=0,bt=0,Ua=0,So=0,bs=0,Rn=0,rr=0,ll=null,nn=null,Ss=!1,Es=0,vi=1/0,_i=null,Oa=null,Ht=0,Ia=null,lr=null,ir=0,js=0,ks=null,rf=null,il=0,Rs=null;function hn(){if((ct&2)!==0&&nt!==0)return nt&-nt;if(D.T!==null){var e=Wo;return e!==0?e:$s()}return ro()}function lf(){Rn===0&&(Rn=(nt&536870912)===0||it?to():536870912);var e=kn.current;return e!==null&&(e.flags|=32),Rn}function mn(e,t,o){(e===ht&&(st===2||st===9)||e.cancelPendingCommit!==null)&&(cr(e,0),La(e,nt,Rn,!1)),Un(e,o),((ct&2)===0||e!==ht)&&(e===ht&&((ct&2)===0&&(So|=o),bt===4&&La(e,nt,Rn,!1)),Wn(e))}function cf(e,t,o){if((ct&6)!==0)throw Error(c(327));var i=!o&&(t&124)===0&&(t&e.expiredLanes)===0||zn(e,t),u=i?Vg(e,t):Ds(e,t,!0),v=i;do{if(u===0){or&&!i&&La(e,t,0,!1);break}else{if(o=e.current.alternate,v&&!Hg(o)){u=Ds(e,t,!1),v=!1;continue}if(u===2){if(v=t,e.errorRecoveryDisabledLanes&v)var A=0;else A=e.pendingLanes&-536870913,A=A!==0?A:A&536870912?536870912:0;if(A!==0){t=A;e:{var P=e;u=ll;var J=P.current.memoizedState.isDehydrated;if(J&&(cr(P,A).flags|=256),A=Ds(P,A,!1),A!==2){if(Cs&&!J){P.errorRecoveryDisabledLanes|=v,So|=v,u=4;break e}v=nn,nn=u,v!==null&&(nn===null?nn=v:nn.push.apply(nn,v))}u=A}if(v=!1,u!==2)continue}}if(u===1){cr(e,0),La(e,t,0,!0);break}e:{switch(i=e,v=u,v){case 0:case 1:throw Error(c(345));case 4:if((t&4194048)!==t)break;case 6:La(i,t,Rn,!$a);break e;case 2:nn=null;break;case 3:case 5:break;default:throw Error(c(329))}if((t&62914560)===t&&(u=Es+300-Ce(),10<u)){if(La(i,t,Rn,!$a),ln(i,0,!0)!==0)break e;i.timeoutHandle=Of(sf.bind(null,i,o,nn,_i,Ss,t,Rn,So,rr,$a,v,2,-0,0),u);break e}sf(i,o,nn,_i,Ss,t,Rn,So,rr,$a,v,0,-0,0)}}break}while(!0);Wn(e)}function sf(e,t,o,i,u,v,A,P,J,ie,pe,me,ce,se){if(e.timeoutHandle=-1,me=t.subtreeFlags,(me&8192||(me&16785408)===16785408)&&(hl={stylesheets:null,count:0,unsuspend:bv},tf(t),me=Ev(),me!==null)){e.cancelPendingCommit=me(yf.bind(null,e,t,v,o,i,u,A,P,J,pe,1,ce,se)),La(e,v,A,!ie);return}yf(e,t,v,o,i,u,A,P,J)}function Hg(e){for(var t=e;;){var o=t.tag;if((o===0||o===11||o===15)&&t.flags&16384&&(o=t.updateQueue,o!==null&&(o=o.stores,o!==null)))for(var i=0;i<o.length;i++){var u=o[i],v=u.getSnapshot;u=u.value;try{if(!sn(v(),u))return!1}catch{return!1}}if(o=t.child,t.subtreeFlags&16384&&o!==null)o.return=t,t=o;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function La(e,t,o,i){t&=~bs,t&=~So,e.suspendedLanes|=t,e.pingedLanes&=~t,i&&(e.warmLanes|=t),i=e.expirationTimes;for(var u=t;0<u;){var v=31-At(u),A=1<<v;i[v]=-1,u&=~A}o!==0&&ao(e,o,t)}function xi(){return(ct&6)===0?(cl(0),!1):!0}function As(){if(Xe!==null){if(st===0)var e=Xe.return;else e=Xe,aa=vo=null,Yc(e),er=null,Kr=0,e=Xe;for(;e!==null;)Pp(e.alternate,e),e=e.return;Xe=null}}function cr(e,t){var o=e.timeoutHandle;o!==-1&&(e.timeoutHandle=-1,lv(o)),o=e.cancelPendingCommit,o!==null&&(e.cancelPendingCommit=null,o()),As(),ht=e,Xe=o=ea(e.current,null),nt=t,st=0,fn=null,$a=!1,or=zn(e,t),Cs=!1,rr=Rn=bs=So=Ua=bt=0,nn=ll=null,Ss=!1,(t&8)!==0&&(t|=t&32);var i=e.entangledLanes;if(i!==0)for(e=e.entanglements,i&=t;0<i;){var u=31-At(i),v=1<<u;t|=e[u],i&=~v}return ua=t,Hl(),o}function df(e,t){Ve=null,D.H=ii,t===zr||t===Zl?(t=ju(),st=3):t===bu?(t=ju(),st=4):st=t===kp?8:t!==null&&typeof t=="object"&&typeof t.then=="function"?6:1,fn=t,Xe===null&&(bt=1,pi(e,bn(t,e.current)))}function uf(){var e=D.H;return D.H=ii,e===null?ii:e}function pf(){var e=D.A;return D.A=Mg,e}function Ts(){bt=4,$a||(nt&4194048)!==nt&&kn.current!==null||(or=!0),(Ua&134217727)===0&&(So&134217727)===0||ht===null||La(ht,nt,Rn,!1)}function Ds(e,t,o){var i=ct;ct|=2;var u=uf(),v=pf();(ht!==e||nt!==t)&&(_i=null,cr(e,t)),t=!1;var A=bt;e:do try{if(st!==0&&Xe!==null){var P=Xe,J=fn;switch(st){case 8:As(),A=6;break e;case 3:case 2:case 9:case 6:kn.current===null&&(t=!0);var ie=st;if(st=0,fn=null,sr(e,P,J,ie),o&&or){A=0;break e}break;default:ie=st,st=0,fn=null,sr(e,P,J,ie)}}zg(),A=bt;break}catch(pe){df(e,pe)}while(!0);return t&&e.shellSuspendCounter++,aa=vo=null,ct=i,D.H=u,D.A=v,Xe===null&&(ht=null,nt=0,Hl()),A}function zg(){for(;Xe!==null;)ff(Xe)}function Vg(e,t){var o=ct;ct|=2;var i=uf(),u=pf();ht!==e||nt!==t?(_i=null,vi=Ce()+500,cr(e,t)):or=zn(e,t);e:do try{if(st!==0&&Xe!==null){t=Xe;var v=fn;t:switch(st){case 1:st=0,fn=null,sr(e,t,v,1);break;case 2:case 9:if(Su(v)){st=0,fn=null,hf(t);break}t=function(){st!==2&&st!==9||ht!==e||(st=7),Wn(e)},v.then(t,t);break e;case 3:st=7;break e;case 4:st=5;break e;case 7:Su(v)?(st=0,fn=null,hf(t)):(st=0,fn=null,sr(e,t,v,7));break;case 5:var A=null;switch(Xe.tag){case 26:A=Xe.memoizedState;case 5:case 27:var P=Xe;if(!A||Qf(A)){st=0,fn=null;var J=P.sibling;if(J!==null)Xe=J;else{var ie=P.return;ie!==null?(Xe=ie,wi(ie)):Xe=null}break t}}st=0,fn=null,sr(e,t,v,5);break;case 6:st=0,fn=null,sr(e,t,v,6);break;case 8:As(),bt=6;break e;default:throw Error(c(462))}}Bg();break}catch(pe){df(e,pe)}while(!0);return aa=vo=null,D.H=i,D.A=u,ct=o,Xe!==null?0:(ht=null,nt=0,Hl(),bt)}function Bg(){for(;Xe!==null&&!at();)ff(Xe)}function ff(e){var t=Lp(e.alternate,e,ua);e.memoizedProps=e.pendingProps,t===null?wi(e):Xe=t}function hf(e){var t=e,o=t.alternate;switch(t.tag){case 15:case 0:t=Fp(o,t,t.pendingProps,t.type,void 0,nt);break;case 11:t=Fp(o,t,t.pendingProps,t.type.render,t.ref,nt);break;case 5:Yc(t);default:Pp(o,t),t=Xe=hu(t,ua),t=Lp(o,t,ua)}e.memoizedProps=e.pendingProps,t===null?wi(e):Xe=t}function sr(e,t,o,i){aa=vo=null,Yc(t),er=null,Kr=0;var u=t.return;try{if(qg(e,u,t,o,nt)){bt=1,pi(e,bn(o,e.current)),Xe=null;return}}catch(v){if(u!==null)throw Xe=u,v;bt=1,pi(e,bn(o,e.current)),Xe=null;return}t.flags&32768?(it||i===1?e=!0:or||(nt&536870912)!==0?e=!1:($a=e=!0,(i===2||i===9||i===3||i===6)&&(i=kn.current,i!==null&&i.tag===13&&(i.flags|=16384))),mf(t,e)):wi(t)}function wi(e){var t=e;do{if((t.flags&32768)!==0){mf(t,$a);return}e=t.return;var o=Ug(t.alternate,t,ua);if(o!==null){Xe=o;return}if(t=t.sibling,t!==null){Xe=t;return}Xe=t=e}while(t!==null);bt===0&&(bt=5)}function mf(e,t){do{var o=Og(e.alternate,e);if(o!==null){o.flags&=32767,Xe=o;return}if(o=e.return,o!==null&&(o.flags|=32768,o.subtreeFlags=0,o.deletions=null),!t&&(e=e.sibling,e!==null)){Xe=e;return}Xe=e=o}while(e!==null);bt=6,Xe=null}function yf(e,t,o,i,u,v,A,P,J){e.cancelPendingCommit=null;do Ci();while(Ht!==0);if((ct&6)!==0)throw Error(c(327));if(t!==null){if(t===e.current)throw Error(c(177));if(v=t.lanes|t.childLanes,v|=wc,xa(e,o,v,A,P,J),e===ht&&(Xe=ht=null,nt=0),lr=t,Ia=e,ir=o,js=v,ks=u,rf=i,(t.subtreeFlags&10256)!==0||(t.flags&10256)!==0?(e.callbackNode=null,e.callbackPriority=0,Qg(Qe,function(){return wf(),null})):(e.callbackNode=null,e.callbackPriority=0),i=(t.flags&13878)!==0,(t.subtreeFlags&13878)!==0||i){i=D.T,D.T=null,u=O.p,O.p=2,A=ct,ct|=4;try{Ig(e,t,o)}finally{ct=A,O.p=u,D.T=i}}Ht=1,gf(),vf(),_f()}}function gf(){if(Ht===1){Ht=0;var e=Ia,t=lr,o=(t.flags&13878)!==0;if((t.subtreeFlags&13878)!==0||o){o=D.T,D.T=null;var i=O.p;O.p=2;var u=ct;ct|=4;try{Kp(t,e);var v=zs,A=ou(e.containerInfo),P=v.focusedElem,J=v.selectionRange;if(A!==P&&P&&P.ownerDocument&&au(P.ownerDocument.documentElement,P)){if(J!==null&&yc(P)){var ie=J.start,pe=J.end;if(pe===void 0&&(pe=ie),"selectionStart"in P)P.selectionStart=ie,P.selectionEnd=Math.min(pe,P.value.length);else{var me=P.ownerDocument||document,ce=me&&me.defaultView||window;if(ce.getSelection){var se=ce.getSelection(),Oe=P.textContent.length,qe=Math.min(J.start,Oe),pt=J.end===void 0?qe:Math.min(J.end,Oe);!se.extend&&qe>pt&&(A=pt,pt=qe,qe=A);var oe=nu(P,qe),te=nu(P,pt);if(oe&&te&&(se.rangeCount!==1||se.anchorNode!==oe.node||se.anchorOffset!==oe.offset||se.focusNode!==te.node||se.focusOffset!==te.offset)){var le=me.createRange();le.setStart(oe.node,oe.offset),se.removeAllRanges(),qe>pt?(se.addRange(le),se.extend(te.node,te.offset)):(le.setEnd(te.node,te.offset),se.addRange(le))}}}}for(me=[],se=P;se=se.parentNode;)se.nodeType===1&&me.push({element:se,left:se.scrollLeft,top:se.scrollTop});for(typeof P.focus=="function"&&P.focus(),P=0;P<me.length;P++){var he=me[P];he.element.scrollLeft=he.left,he.element.scrollTop=he.top}}qi=!!Hs,zs=Hs=null}finally{ct=u,O.p=i,D.T=o}}e.current=t,Ht=2}}function vf(){if(Ht===2){Ht=0;var e=Ia,t=lr,o=(t.flags&8772)!==0;if((t.subtreeFlags&8772)!==0||o){o=D.T,D.T=null;var i=O.p;O.p=2;var u=ct;ct|=4;try{Wp(e,t.alternate,t)}finally{ct=u,O.p=i,D.T=o}}Ht=3}}function _f(){if(Ht===4||Ht===3){Ht=0,we();var e=Ia,t=lr,o=ir,i=rf;(t.subtreeFlags&10256)!==0||(t.flags&10256)!==0?Ht=5:(Ht=0,lr=Ia=null,xf(e,e.pendingLanes));var u=e.pendingLanes;if(u===0&&(Oa=null),Ca(o),t=t.stateNode,$t&&typeof $t.onCommitFiberRoot=="function")try{$t.onCommitFiberRoot(qn,t,void 0,(t.current.flags&128)===128)}catch{}if(i!==null){t=D.T,u=O.p,O.p=2,D.T=null;try{for(var v=e.onRecoverableError,A=0;A<i.length;A++){var P=i[A];v(P.value,{componentStack:P.stack})}}finally{D.T=t,O.p=u}}(ir&3)!==0&&Ci(),Wn(e),u=e.pendingLanes,(o&4194090)!==0&&(u&42)!==0?e===Rs?il++:(il=0,Rs=e):il=0,cl(0)}}function xf(e,t){(e.pooledCacheLanes&=t)===0&&(t=e.pooledCache,t!=null&&(e.pooledCache=null,Pr(t)))}function Ci(e){return gf(),vf(),_f(),wf()}function wf(){if(Ht!==5)return!1;var e=Ia,t=js;js=0;var o=Ca(ir),i=D.T,u=O.p;try{O.p=32>o?32:o,D.T=null,o=ks,ks=null;var v=Ia,A=ir;if(Ht=0,lr=Ia=null,ir=0,(ct&6)!==0)throw Error(c(331));var P=ct;if(ct|=4,af(v.current),ef(v,v.current,A,o),ct=P,cl(0,!1),$t&&typeof $t.onPostCommitFiberRoot=="function")try{$t.onPostCommitFiberRoot(qn,v)}catch{}return!0}finally{O.p=u,D.T=i,xf(e,t)}}function Cf(e,t,o){t=bn(o,t),t=ls(e.stateNode,t,2),e=Ra(e,t,2),e!==null&&(Un(e,2),Wn(e))}function ft(e,t,o){if(e.tag===3)Cf(e,e,o);else for(;t!==null;){if(t.tag===3){Cf(t,e,o);break}else if(t.tag===1){var i=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(Oa===null||!Oa.has(i))){e=bn(o,e),o=Ep(2),i=Ra(t,o,2),i!==null&&(jp(o,i,t,e),Un(i,2),Wn(i));break}}t=t.return}}function Ns(e,t,o){var i=e.pingCache;if(i===null){i=e.pingCache=new Pg;var u=new Set;i.set(t,u)}else u=i.get(t),u===void 0&&(u=new Set,i.set(t,u));u.has(o)||(Cs=!0,u.add(o),e=Yg.bind(null,e,t,o),t.then(e,e))}function Yg(e,t,o){var i=e.pingCache;i!==null&&i.delete(t),e.pingedLanes|=e.suspendedLanes&o,e.warmLanes&=~o,ht===e&&(nt&o)===o&&(bt===4||bt===3&&(nt&62914560)===nt&&300>Ce()-Es?(ct&2)===0&&cr(e,0):bs|=o,rr===nt&&(rr=0)),Wn(e)}function bf(e,t){t===0&&(t=no()),e=Vo(e,t),e!==null&&(Un(e,t),Wn(e))}function Gg(e){var t=e.memoizedState,o=0;t!==null&&(o=t.retryLane),bf(e,o)}function Wg(e,t){var o=0;switch(e.tag){case 13:var i=e.stateNode,u=e.memoizedState;u!==null&&(o=u.retryLane);break;case 19:i=e.stateNode;break;case 22:i=e.stateNode._retryCache;break;default:throw Error(c(314))}i!==null&&i.delete(t),bf(e,o)}function Qg(e,t){return Le(e,t)}var bi=null,dr=null,Fs=!1,Si=!1,qs=!1,Eo=0;function Wn(e){e!==dr&&e.next===null&&(dr===null?bi=dr=e:dr=dr.next=e),Si=!0,Fs||(Fs=!0,Zg())}function cl(e,t){if(!qs&&Si){qs=!0;do for(var o=!1,i=bi;i!==null;){if(e!==0){var u=i.pendingLanes;if(u===0)var v=0;else{var A=i.suspendedLanes,P=i.pingedLanes;v=(1<<31-At(42|e)+1)-1,v&=u&~(A&~P),v=v&201326741?v&201326741|1:v?v|2:0}v!==0&&(o=!0,kf(i,v))}else v=nt,v=ln(i,i===ht?v:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),(v&3)===0||zn(i,v)||(o=!0,kf(i,v));i=i.next}while(o);qs=!1}}function Xg(){Sf()}function Sf(){Si=Fs=!1;var e=0;Eo!==0&&(rv()&&(e=Eo),Eo=0);for(var t=Ce(),o=null,i=bi;i!==null;){var u=i.next,v=Ef(i,t);v===0?(i.next=null,o===null?bi=u:o.next=u,u===null&&(dr=o)):(o=i,(e!==0||(v&3)!==0)&&(Si=!0)),i=u}cl(e)}function Ef(e,t){for(var o=e.suspendedLanes,i=e.pingedLanes,u=e.expirationTimes,v=e.pendingLanes&-62914561;0<v;){var A=31-At(v),P=1<<A,J=u[A];J===-1?((P&o)===0||(P&i)!==0)&&(u[A]=qo(P,t)):J<=t&&(e.expiredLanes|=P),v&=~P}if(t=ht,o=nt,o=ln(e,e===t?o:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),i=e.callbackNode,o===0||e===t&&(st===2||st===9)||e.cancelPendingCommit!==null)return i!==null&&i!==null&&Je(i),e.callbackNode=null,e.callbackPriority=0;if((o&3)===0||zn(e,o)){if(t=o&-o,t===e.callbackPriority)return t;switch(i!==null&&Je(i),Ca(o)){case 2:case 8:o=wt;break;case 32:o=Qe;break;case 268435456:o=rn;break;default:o=Qe}return i=jf.bind(null,e),o=Le(o,i),e.callbackPriority=t,e.callbackNode=o,t}return i!==null&&i!==null&&Je(i),e.callbackPriority=2,e.callbackNode=null,2}function jf(e,t){if(Ht!==0&&Ht!==5)return e.callbackNode=null,e.callbackPriority=0,null;var o=e.callbackNode;if(Ci()&&e.callbackNode!==o)return null;var i=nt;return i=ln(e,e===ht?i:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),i===0?null:(cf(e,i,t),Ef(e,Ce()),e.callbackNode!=null&&e.callbackNode===o?jf.bind(null,e):null)}function kf(e,t){if(Ci())return null;cf(e,t,!0)}function Zg(){iv(function(){(ct&6)!==0?Le(ze,Xg):Sf()})}function $s(){return Eo===0&&(Eo=to()),Eo}function Rf(e){return e==null||typeof e=="symbol"||typeof e=="boolean"?null:typeof e=="function"?e:$l(""+e)}function Af(e,t){var o=t.ownerDocument.createElement("input");return o.name=t.name,o.value=t.value,e.id&&o.setAttribute("form",e.id),t.parentNode.insertBefore(o,t),e=new FormData(e),o.parentNode.removeChild(o),e}function Kg(e,t,o,i,u){if(t==="submit"&&o&&o.stateNode===u){var v=Rf((u[Nt]||null).action),A=i.submitter;A&&(t=(t=A[Nt]||null)?Rf(t.formAction):A.getAttribute("formAction"),t!==null&&(v=t,A=null));var P=new Ll("action","action",null,i,u);e.push({event:P,listeners:[{instance:null,listener:function(){if(i.defaultPrevented){if(Eo!==0){var J=A?Af(u,A):new FormData(u);ts(o,{pending:!0,data:J,method:u.method,action:v},null,J)}}else typeof v=="function"&&(P.preventDefault(),J=A?Af(u,A):new FormData(u),ts(o,{pending:!0,data:J,method:u.method,action:v},v,J))},currentTarget:u}]})}}for(var Us=0;Us<xc.length;Us++){var Os=xc[Us],Jg=Os.toLowerCase(),ev=Os[0].toUpperCase()+Os.slice(1);In(Jg,"on"+ev)}In(iu,"onAnimationEnd"),In(cu,"onAnimationIteration"),In(su,"onAnimationStart"),In("dblclick","onDoubleClick"),In("focusin","onFocus"),In("focusout","onBlur"),In(gg,"onTransitionRun"),In(vg,"onTransitionStart"),In(_g,"onTransitionCancel"),In(du,"onTransitionEnd"),Et("onMouseEnter",["mouseout","mouseover"]),Et("onMouseLeave",["mouseout","mouseover"]),Et("onPointerEnter",["pointerout","pointerover"]),Et("onPointerLeave",["pointerout","pointerover"]),Ke("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Ke("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Ke("onBeforeInput",["compositionend","keypress","textInput","paste"]),Ke("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Ke("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Ke("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var sl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),tv=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(sl));function Tf(e,t){t=(t&4)!==0;for(var o=0;o<e.length;o++){var i=e[o],u=i.event;i=i.listeners;e:{var v=void 0;if(t)for(var A=i.length-1;0<=A;A--){var P=i[A],J=P.instance,ie=P.currentTarget;if(P=P.listener,J!==v&&u.isPropagationStopped())break e;v=P,u.currentTarget=ie;try{v(u)}catch(pe){ui(pe)}u.currentTarget=null,v=J}else for(A=0;A<i.length;A++){if(P=i[A],J=P.instance,ie=P.currentTarget,P=P.listener,J!==v&&u.isPropagationStopped())break e;v=P,u.currentTarget=ie;try{v(u)}catch(pe){ui(pe)}u.currentTarget=null,v=J}}}}function Ze(e,t){var o=t[be];o===void 0&&(o=t[be]=new Set);var i=e+"__bubble";o.has(i)||(Df(t,e,2,!1),o.add(i))}function Is(e,t,o){var i=0;t&&(i|=4),Df(o,e,i,t)}var Ei="_reactListening"+Math.random().toString(36).slice(2);function Ls(e){if(!e[Ei]){e[Ei]=!0,xe.forEach(function(o){o!=="selectionchange"&&(tv.has(o)||Is(o,!1,e),Is(o,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[Ei]||(t[Ei]=!0,Is("selectionchange",!1,t))}}function Df(e,t,o,i){switch(th(t)){case 2:var u=Rv;break;case 8:u=Av;break;default:u=Js}o=u.bind(null,t,o,e),u=void 0,!ic||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(u=!0),i?u!==void 0?e.addEventListener(t,o,{capture:!0,passive:u}):e.addEventListener(t,o,!0):u!==void 0?e.addEventListener(t,o,{passive:u}):e.addEventListener(t,o,!1)}function Ms(e,t,o,i,u){var v=i;if((t&1)===0&&(t&2)===0&&i!==null)e:for(;;){if(i===null)return;var A=i.tag;if(A===3||A===4){var P=i.stateNode.containerInfo;if(P===u)break;if(A===4)for(A=i.return;A!==null;){var J=A.tag;if((J===3||J===4)&&A.stateNode.containerInfo===u)return;A=A.return}for(;P!==null;){if(A=Ye(P),A===null)return;if(J=A.tag,J===5||J===6||J===26||J===27){i=v=A;continue e}P=P.parentNode}}i=i.return}Od(function(){var ie=v,pe=rc(o),me=[];e:{var ce=uu.get(e);if(ce!==void 0){var se=Ll,Oe=e;switch(e){case"keypress":if(Ol(o)===0)break e;case"keydown":case"keyup":se=Qy;break;case"focusin":Oe="focus",se=uc;break;case"focusout":Oe="blur",se=uc;break;case"beforeblur":case"afterblur":se=uc;break;case"click":if(o.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":se=Md;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":se=Oy;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":se=Ky;break;case iu:case cu:case su:se=My;break;case du:se=eg;break;case"scroll":case"scrollend":se=$y;break;case"wheel":se=ng;break;case"copy":case"cut":case"paste":se=Hy;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":se=Hd;break;case"toggle":case"beforetoggle":se=og}var qe=(t&4)!==0,pt=!qe&&(e==="scroll"||e==="scrollend"),oe=qe?ce!==null?ce+"Capture":null:ce;qe=[];for(var te=ie,le;te!==null;){var he=te;if(le=he.stateNode,he=he.tag,he!==5&&he!==26&&he!==27||le===null||oe===null||(he=Rr(te,oe),he!=null&&qe.push(dl(te,he,le))),pt)break;te=te.return}0<qe.length&&(ce=new se(ce,Oe,null,o,pe),me.push({event:ce,listeners:qe}))}}if((t&7)===0){e:{if(ce=e==="mouseover"||e==="pointerover",se=e==="mouseout"||e==="pointerout",ce&&o!==oc&&(Oe=o.relatedTarget||o.fromElement)&&(Ye(Oe)||Oe[ue]))break e;if((se||ce)&&(ce=pe.window===pe?pe:(ce=pe.ownerDocument)?ce.defaultView||ce.parentWindow:window,se?(Oe=o.relatedTarget||o.toElement,se=ie,Oe=Oe?Ye(Oe):null,Oe!==null&&(pt=d(Oe),qe=Oe.tag,Oe!==pt||qe!==5&&qe!==27&&qe!==6)&&(Oe=null)):(se=null,Oe=ie),se!==Oe)){if(qe=Md,he="onMouseLeave",oe="onMouseEnter",te="mouse",(e==="pointerout"||e==="pointerover")&&(qe=Hd,he="onPointerLeave",oe="onPointerEnter",te="pointer"),pt=se==null?ce:ot(se),le=Oe==null?ce:ot(Oe),ce=new qe(he,te+"leave",se,o,pe),ce.target=pt,ce.relatedTarget=le,he=null,Ye(pe)===ie&&(qe=new qe(oe,te+"enter",Oe,o,pe),qe.target=le,qe.relatedTarget=pt,he=qe),pt=he,se&&Oe)t:{for(qe=se,oe=Oe,te=0,le=qe;le;le=ur(le))te++;for(le=0,he=oe;he;he=ur(he))le++;for(;0<te-le;)qe=ur(qe),te--;for(;0<le-te;)oe=ur(oe),le--;for(;te--;){if(qe===oe||oe!==null&&qe===oe.alternate)break t;qe=ur(qe),oe=ur(oe)}qe=null}else qe=null;se!==null&&Nf(me,ce,se,qe,!1),Oe!==null&&pt!==null&&Nf(me,pt,Oe,qe,!0)}}e:{if(ce=ie?ot(ie):window,se=ce.nodeName&&ce.nodeName.toLowerCase(),se==="select"||se==="input"&&ce.type==="file")var Re=Xd;else if(Wd(ce))if(Zd)Re=hg;else{Re=pg;var Ge=ug}else se=ce.nodeName,!se||se.toLowerCase()!=="input"||ce.type!=="checkbox"&&ce.type!=="radio"?ie&&ac(ie.elementType)&&(Re=Xd):Re=fg;if(Re&&(Re=Re(e,ie))){Qd(me,Re,o,pe);break e}Ge&&Ge(e,ce,ie),e==="focusout"&&ie&&ce.type==="number"&&ie.memoizedProps.value!=null&&nc(ce,"number",ce.value)}switch(Ge=ie?ot(ie):window,e){case"focusin":(Wd(Ge)||Ge.contentEditable==="true")&&(Po=Ge,gc=ie,Ur=null);break;case"focusout":Ur=gc=Po=null;break;case"mousedown":vc=!0;break;case"contextmenu":case"mouseup":case"dragend":vc=!1,ru(me,o,pe);break;case"selectionchange":if(yg)break;case"keydown":case"keyup":ru(me,o,pe)}var Te;if(fc)e:{switch(e){case"compositionstart":var $e="onCompositionStart";break e;case"compositionend":$e="onCompositionEnd";break e;case"compositionupdate":$e="onCompositionUpdate";break e}$e=void 0}else Mo?Yd(e,o)&&($e="onCompositionEnd"):e==="keydown"&&o.keyCode===229&&($e="onCompositionStart");$e&&(zd&&o.locale!=="ko"&&(Mo||$e!=="onCompositionStart"?$e==="onCompositionEnd"&&Mo&&(Te=Id()):(Sa=pe,cc="value"in Sa?Sa.value:Sa.textContent,Mo=!0)),Ge=ji(ie,$e),0<Ge.length&&($e=new Pd($e,e,null,o,pe),me.push({event:$e,listeners:Ge}),Te?$e.data=Te:(Te=Gd(o),Te!==null&&($e.data=Te)))),(Te=lg?ig(e,o):cg(e,o))&&($e=ji(ie,"onBeforeInput"),0<$e.length&&(Ge=new Pd("onBeforeInput","beforeinput",null,o,pe),me.push({event:Ge,listeners:$e}),Ge.data=Te)),Kg(me,e,ie,o,pe)}Tf(me,t)})}function dl(e,t,o){return{instance:e,listener:t,currentTarget:o}}function ji(e,t){for(var o=t+"Capture",i=[];e!==null;){var u=e,v=u.stateNode;if(u=u.tag,u!==5&&u!==26&&u!==27||v===null||(u=Rr(e,o),u!=null&&i.unshift(dl(e,u,v)),u=Rr(e,t),u!=null&&i.push(dl(e,u,v))),e.tag===3)return i;e=e.return}return[]}function ur(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5&&e.tag!==27);return e||null}function Nf(e,t,o,i,u){for(var v=t._reactName,A=[];o!==null&&o!==i;){var P=o,J=P.alternate,ie=P.stateNode;if(P=P.tag,J!==null&&J===i)break;P!==5&&P!==26&&P!==27||ie===null||(J=ie,u?(ie=Rr(o,v),ie!=null&&A.unshift(dl(o,ie,J))):u||(ie=Rr(o,v),ie!=null&&A.push(dl(o,ie,J)))),o=o.return}A.length!==0&&e.push({event:t,listeners:A})}var nv=/\r\n?/g,av=/\u0000|\uFFFD/g;function Ff(e){return(typeof e=="string"?e:""+e).replace(nv,`
`).replace(av,"")}function qf(e,t){return t=Ff(t),Ff(e)===t}function ki(){}function ut(e,t,o,i,u,v){switch(o){case"children":typeof i=="string"?t==="body"||t==="textarea"&&i===""||Oo(e,i):(typeof i=="number"||typeof i=="bigint")&&t!=="body"&&Oo(e,""+i);break;case"className":wn(e,"class",i);break;case"tabIndex":wn(e,"tabindex",i);break;case"dir":case"role":case"viewBox":case"width":case"height":wn(e,o,i);break;case"style":$d(e,i,v);break;case"data":if(t!=="object"){wn(e,"data",i);break}case"src":case"href":if(i===""&&(t!=="a"||o!=="href")){e.removeAttribute(o);break}if(i==null||typeof i=="function"||typeof i=="symbol"||typeof i=="boolean"){e.removeAttribute(o);break}i=$l(""+i),e.setAttribute(o,i);break;case"action":case"formAction":if(typeof i=="function"){e.setAttribute(o,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof v=="function"&&(o==="formAction"?(t!=="input"&&ut(e,t,"name",u.name,u,null),ut(e,t,"formEncType",u.formEncType,u,null),ut(e,t,"formMethod",u.formMethod,u,null),ut(e,t,"formTarget",u.formTarget,u,null)):(ut(e,t,"encType",u.encType,u,null),ut(e,t,"method",u.method,u,null),ut(e,t,"target",u.target,u,null)));if(i==null||typeof i=="symbol"||typeof i=="boolean"){e.removeAttribute(o);break}i=$l(""+i),e.setAttribute(o,i);break;case"onClick":i!=null&&(e.onclick=ki);break;case"onScroll":i!=null&&Ze("scroll",e);break;case"onScrollEnd":i!=null&&Ze("scrollend",e);break;case"dangerouslySetInnerHTML":if(i!=null){if(typeof i!="object"||!("__html"in i))throw Error(c(61));if(o=i.__html,o!=null){if(u.children!=null)throw Error(c(60));e.innerHTML=o}}break;case"multiple":e.multiple=i&&typeof i!="function"&&typeof i!="symbol";break;case"muted":e.muted=i&&typeof i!="function"&&typeof i!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(i==null||typeof i=="function"||typeof i=="boolean"||typeof i=="symbol"){e.removeAttribute("xlink:href");break}o=$l(""+i),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",o);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":i!=null&&typeof i!="function"&&typeof i!="symbol"?e.setAttribute(o,""+i):e.removeAttribute(o);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":i&&typeof i!="function"&&typeof i!="symbol"?e.setAttribute(o,""):e.removeAttribute(o);break;case"capture":case"download":i===!0?e.setAttribute(o,""):i!==!1&&i!=null&&typeof i!="function"&&typeof i!="symbol"?e.setAttribute(o,i):e.removeAttribute(o);break;case"cols":case"rows":case"size":case"span":i!=null&&typeof i!="function"&&typeof i!="symbol"&&!isNaN(i)&&1<=i?e.setAttribute(o,i):e.removeAttribute(o);break;case"rowSpan":case"start":i==null||typeof i=="function"||typeof i=="symbol"||isNaN(i)?e.removeAttribute(o):e.setAttribute(o,i);break;case"popover":Ze("beforetoggle",e),Ze("toggle",e),Kn(e,"popover",i);break;case"xlinkActuate":On(e,"http://www.w3.org/1999/xlink","xlink:actuate",i);break;case"xlinkArcrole":On(e,"http://www.w3.org/1999/xlink","xlink:arcrole",i);break;case"xlinkRole":On(e,"http://www.w3.org/1999/xlink","xlink:role",i);break;case"xlinkShow":On(e,"http://www.w3.org/1999/xlink","xlink:show",i);break;case"xlinkTitle":On(e,"http://www.w3.org/1999/xlink","xlink:title",i);break;case"xlinkType":On(e,"http://www.w3.org/1999/xlink","xlink:type",i);break;case"xmlBase":On(e,"http://www.w3.org/XML/1998/namespace","xml:base",i);break;case"xmlLang":On(e,"http://www.w3.org/XML/1998/namespace","xml:lang",i);break;case"xmlSpace":On(e,"http://www.w3.org/XML/1998/namespace","xml:space",i);break;case"is":Kn(e,"is",i);break;case"innerText":case"textContent":break;default:(!(2<o.length)||o[0]!=="o"&&o[0]!=="O"||o[1]!=="n"&&o[1]!=="N")&&(o=Fy.get(o)||o,Kn(e,o,i))}}function Ps(e,t,o,i,u,v){switch(o){case"style":$d(e,i,v);break;case"dangerouslySetInnerHTML":if(i!=null){if(typeof i!="object"||!("__html"in i))throw Error(c(61));if(o=i.__html,o!=null){if(u.children!=null)throw Error(c(60));e.innerHTML=o}}break;case"children":typeof i=="string"?Oo(e,i):(typeof i=="number"||typeof i=="bigint")&&Oo(e,""+i);break;case"onScroll":i!=null&&Ze("scroll",e);break;case"onScrollEnd":i!=null&&Ze("scrollend",e);break;case"onClick":i!=null&&(e.onclick=ki);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Ee.hasOwnProperty(o))e:{if(o[0]==="o"&&o[1]==="n"&&(u=o.endsWith("Capture"),t=o.slice(2,u?o.length-7:void 0),v=e[Nt]||null,v=v!=null?v[o]:null,typeof v=="function"&&e.removeEventListener(t,v,u),typeof i=="function")){typeof v!="function"&&v!==null&&(o in e?e[o]=null:e.hasAttribute(o)&&e.removeAttribute(o)),e.addEventListener(t,i,u);break e}o in e?e[o]=i:i===!0?e.setAttribute(o,""):Kn(e,o,i)}}}function zt(e,t,o){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Ze("error",e),Ze("load",e);var i=!1,u=!1,v;for(v in o)if(o.hasOwnProperty(v)){var A=o[v];if(A!=null)switch(v){case"src":i=!0;break;case"srcSet":u=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(c(137,t));default:ut(e,t,v,A,o,null)}}u&&ut(e,t,"srcSet",o.srcSet,o,null),i&&ut(e,t,"src",o.src,o,null);return;case"input":Ze("invalid",e);var P=v=A=u=null,J=null,ie=null;for(i in o)if(o.hasOwnProperty(i)){var pe=o[i];if(pe!=null)switch(i){case"name":u=pe;break;case"type":A=pe;break;case"checked":J=pe;break;case"defaultChecked":ie=pe;break;case"value":v=pe;break;case"defaultValue":P=pe;break;case"children":case"dangerouslySetInnerHTML":if(pe!=null)throw Error(c(137,t));break;default:ut(e,t,i,pe,o,null)}}Dd(e,v,P,J,ie,A,u,!1),kr(e);return;case"select":Ze("invalid",e),i=A=v=null;for(u in o)if(o.hasOwnProperty(u)&&(P=o[u],P!=null))switch(u){case"value":v=P;break;case"defaultValue":A=P;break;case"multiple":i=P;default:ut(e,t,u,P,o,null)}t=v,o=A,e.multiple=!!i,t!=null?Uo(e,!!i,t,!1):o!=null&&Uo(e,!!i,o,!0);return;case"textarea":Ze("invalid",e),v=u=i=null;for(A in o)if(o.hasOwnProperty(A)&&(P=o[A],P!=null))switch(A){case"value":i=P;break;case"defaultValue":u=P;break;case"children":v=P;break;case"dangerouslySetInnerHTML":if(P!=null)throw Error(c(91));break;default:ut(e,t,A,P,o,null)}Fd(e,i,u,v),kr(e);return;case"option":for(J in o)if(o.hasOwnProperty(J)&&(i=o[J],i!=null))switch(J){case"selected":e.selected=i&&typeof i!="function"&&typeof i!="symbol";break;default:ut(e,t,J,i,o,null)}return;case"dialog":Ze("beforetoggle",e),Ze("toggle",e),Ze("cancel",e),Ze("close",e);break;case"iframe":case"object":Ze("load",e);break;case"video":case"audio":for(i=0;i<sl.length;i++)Ze(sl[i],e);break;case"image":Ze("error",e),Ze("load",e);break;case"details":Ze("toggle",e);break;case"embed":case"source":case"link":Ze("error",e),Ze("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(ie in o)if(o.hasOwnProperty(ie)&&(i=o[ie],i!=null))switch(ie){case"children":case"dangerouslySetInnerHTML":throw Error(c(137,t));default:ut(e,t,ie,i,o,null)}return;default:if(ac(t)){for(pe in o)o.hasOwnProperty(pe)&&(i=o[pe],i!==void 0&&Ps(e,t,pe,i,o,void 0));return}}for(P in o)o.hasOwnProperty(P)&&(i=o[P],i!=null&&ut(e,t,P,i,o,null))}function ov(e,t,o,i){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var u=null,v=null,A=null,P=null,J=null,ie=null,pe=null;for(se in o){var me=o[se];if(o.hasOwnProperty(se)&&me!=null)switch(se){case"checked":break;case"value":break;case"defaultValue":J=me;default:i.hasOwnProperty(se)||ut(e,t,se,null,i,me)}}for(var ce in i){var se=i[ce];if(me=o[ce],i.hasOwnProperty(ce)&&(se!=null||me!=null))switch(ce){case"type":v=se;break;case"name":u=se;break;case"checked":ie=se;break;case"defaultChecked":pe=se;break;case"value":A=se;break;case"defaultValue":P=se;break;case"children":case"dangerouslySetInnerHTML":if(se!=null)throw Error(c(137,t));break;default:se!==me&&ut(e,t,ce,se,i,me)}}tc(e,A,P,J,ie,pe,v,u);return;case"select":se=A=P=ce=null;for(v in o)if(J=o[v],o.hasOwnProperty(v)&&J!=null)switch(v){case"value":break;case"multiple":se=J;default:i.hasOwnProperty(v)||ut(e,t,v,null,i,J)}for(u in i)if(v=i[u],J=o[u],i.hasOwnProperty(u)&&(v!=null||J!=null))switch(u){case"value":ce=v;break;case"defaultValue":P=v;break;case"multiple":A=v;default:v!==J&&ut(e,t,u,v,i,J)}t=P,o=A,i=se,ce!=null?Uo(e,!!o,ce,!1):!!i!=!!o&&(t!=null?Uo(e,!!o,t,!0):Uo(e,!!o,o?[]:"",!1));return;case"textarea":se=ce=null;for(P in o)if(u=o[P],o.hasOwnProperty(P)&&u!=null&&!i.hasOwnProperty(P))switch(P){case"value":break;case"children":break;default:ut(e,t,P,null,i,u)}for(A in i)if(u=i[A],v=o[A],i.hasOwnProperty(A)&&(u!=null||v!=null))switch(A){case"value":ce=u;break;case"defaultValue":se=u;break;case"children":break;case"dangerouslySetInnerHTML":if(u!=null)throw Error(c(91));break;default:u!==v&&ut(e,t,A,u,i,v)}Nd(e,ce,se);return;case"option":for(var Oe in o)if(ce=o[Oe],o.hasOwnProperty(Oe)&&ce!=null&&!i.hasOwnProperty(Oe))switch(Oe){case"selected":e.selected=!1;break;default:ut(e,t,Oe,null,i,ce)}for(J in i)if(ce=i[J],se=o[J],i.hasOwnProperty(J)&&ce!==se&&(ce!=null||se!=null))switch(J){case"selected":e.selected=ce&&typeof ce!="function"&&typeof ce!="symbol";break;default:ut(e,t,J,ce,i,se)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var qe in o)ce=o[qe],o.hasOwnProperty(qe)&&ce!=null&&!i.hasOwnProperty(qe)&&ut(e,t,qe,null,i,ce);for(ie in i)if(ce=i[ie],se=o[ie],i.hasOwnProperty(ie)&&ce!==se&&(ce!=null||se!=null))switch(ie){case"children":case"dangerouslySetInnerHTML":if(ce!=null)throw Error(c(137,t));break;default:ut(e,t,ie,ce,i,se)}return;default:if(ac(t)){for(var pt in o)ce=o[pt],o.hasOwnProperty(pt)&&ce!==void 0&&!i.hasOwnProperty(pt)&&Ps(e,t,pt,void 0,i,ce);for(pe in i)ce=i[pe],se=o[pe],!i.hasOwnProperty(pe)||ce===se||ce===void 0&&se===void 0||Ps(e,t,pe,ce,i,se);return}}for(var oe in o)ce=o[oe],o.hasOwnProperty(oe)&&ce!=null&&!i.hasOwnProperty(oe)&&ut(e,t,oe,null,i,ce);for(me in i)ce=i[me],se=o[me],!i.hasOwnProperty(me)||ce===se||ce==null&&se==null||ut(e,t,me,ce,i,se)}var Hs=null,zs=null;function Ri(e){return e.nodeType===9?e:e.ownerDocument}function $f(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Uf(e,t){if(e===0)switch(t){case"svg":return 1;case"math":return 2;default:return 0}return e===1&&t==="foreignObject"?0:e}function Vs(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.children=="bigint"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var Bs=null;function rv(){var e=window.event;return e&&e.type==="popstate"?e===Bs?!1:(Bs=e,!0):(Bs=null,!1)}var Of=typeof setTimeout=="function"?setTimeout:void 0,lv=typeof clearTimeout=="function"?clearTimeout:void 0,If=typeof Promise=="function"?Promise:void 0,iv=typeof queueMicrotask=="function"?queueMicrotask:typeof If<"u"?function(e){return If.resolve(null).then(e).catch(cv)}:Of;function cv(e){setTimeout(function(){throw e})}function Ma(e){return e==="head"}function Lf(e,t){var o=t,i=0,u=0;do{var v=o.nextSibling;if(e.removeChild(o),v&&v.nodeType===8)if(o=v.data,o==="/$"){if(0<i&&8>i){o=i;var A=e.ownerDocument;if(o&1&&ul(A.documentElement),o&2&&ul(A.body),o&4)for(o=A.head,ul(o),A=o.firstChild;A;){var P=A.nextSibling,J=A.nodeName;A[Pe]||J==="SCRIPT"||J==="STYLE"||J==="LINK"&&A.rel.toLowerCase()==="stylesheet"||o.removeChild(A),A=P}}if(u===0){e.removeChild(v),_l(t);return}u--}else o==="$"||o==="$?"||o==="$!"?u++:i=o.charCodeAt(0)-48;else i=0;o=v}while(o);_l(t)}function Ys(e){var t=e.firstChild;for(t&&t.nodeType===10&&(t=t.nextSibling);t;){var o=t;switch(t=t.nextSibling,o.nodeName){case"HTML":case"HEAD":case"BODY":Ys(o),tt(o);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(o.rel.toLowerCase()==="stylesheet")continue}e.removeChild(o)}}function sv(e,t,o,i){for(;e.nodeType===1;){var u=o;if(e.nodeName.toLowerCase()!==t.toLowerCase()){if(!i&&(e.nodeName!=="INPUT"||e.type!=="hidden"))break}else if(i){if(!e[Pe])switch(t){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if(v=e.getAttribute("rel"),v==="stylesheet"&&e.hasAttribute("data-precedence"))break;if(v!==u.rel||e.getAttribute("href")!==(u.href==null||u.href===""?null:u.href)||e.getAttribute("crossorigin")!==(u.crossOrigin==null?null:u.crossOrigin)||e.getAttribute("title")!==(u.title==null?null:u.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(v=e.getAttribute("src"),(v!==(u.src==null?null:u.src)||e.getAttribute("type")!==(u.type==null?null:u.type)||e.getAttribute("crossorigin")!==(u.crossOrigin==null?null:u.crossOrigin))&&v&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else if(t==="input"&&e.type==="hidden"){var v=u.name==null?null:""+u.name;if(u.type==="hidden"&&e.getAttribute("name")===v)return e}else return e;if(e=Mn(e.nextSibling),e===null)break}return null}function dv(e,t,o){if(t==="")return null;for(;e.nodeType!==3;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!o||(e=Mn(e.nextSibling),e===null))return null;return e}function Gs(e){return e.data==="$!"||e.data==="$?"&&e.ownerDocument.readyState==="complete"}function uv(e,t){var o=e.ownerDocument;if(e.data!=="$?"||o.readyState==="complete")t();else{var i=function(){t(),o.removeEventListener("DOMContentLoaded",i)};o.addEventListener("DOMContentLoaded",i),e._reactRetry=i}}function Mn(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?"||t==="F!"||t==="F")break;if(t==="/$")return null}}return e}var Ws=null;function Mf(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var o=e.data;if(o==="$"||o==="$!"||o==="$?"){if(t===0)return e;t--}else o==="/$"&&t++}e=e.previousSibling}return null}function Pf(e,t,o){switch(t=Ri(o),e){case"html":if(e=t.documentElement,!e)throw Error(c(452));return e;case"head":if(e=t.head,!e)throw Error(c(453));return e;case"body":if(e=t.body,!e)throw Error(c(454));return e;default:throw Error(c(451))}}function ul(e){for(var t=e.attributes;t.length;)e.removeAttributeNode(t[0]);tt(e)}var An=new Map,Hf=new Set;function Ai(e){return typeof e.getRootNode=="function"?e.getRootNode():e.nodeType===9?e:e.ownerDocument}var pa=O.d;O.d={f:pv,r:fv,D:hv,C:mv,L:yv,m:gv,X:_v,S:vv,M:xv};function pv(){var e=pa.f(),t=xi();return e||t}function fv(e){var t=Fe(e);t!==null&&t.tag===5&&t.type==="form"?ip(t):pa.r(e)}var pr=typeof document>"u"?null:document;function zf(e,t,o){var i=pr;if(i&&typeof t=="string"&&t){var u=Cn(t);u='link[rel="'+e+'"][href="'+u+'"]',typeof o=="string"&&(u+='[crossorigin="'+o+'"]'),Hf.has(u)||(Hf.add(u),e={rel:e,crossOrigin:o,href:t},i.querySelector(u)===null&&(t=i.createElement("link"),zt(t,"link",e),fe(t),i.head.appendChild(t)))}}function hv(e){pa.D(e),zf("dns-prefetch",e,null)}function mv(e,t){pa.C(e,t),zf("preconnect",e,t)}function yv(e,t,o){pa.L(e,t,o);var i=pr;if(i&&e&&t){var u='link[rel="preload"][as="'+Cn(t)+'"]';t==="image"&&o&&o.imageSrcSet?(u+='[imagesrcset="'+Cn(o.imageSrcSet)+'"]',typeof o.imageSizes=="string"&&(u+='[imagesizes="'+Cn(o.imageSizes)+'"]')):u+='[href="'+Cn(e)+'"]';var v=u;switch(t){case"style":v=fr(e);break;case"script":v=hr(e)}An.has(v)||(e=g({rel:"preload",href:t==="image"&&o&&o.imageSrcSet?void 0:e,as:t},o),An.set(v,e),i.querySelector(u)!==null||t==="style"&&i.querySelector(pl(v))||t==="script"&&i.querySelector(fl(v))||(t=i.createElement("link"),zt(t,"link",e),fe(t),i.head.appendChild(t)))}}function gv(e,t){pa.m(e,t);var o=pr;if(o&&e){var i=t&&typeof t.as=="string"?t.as:"script",u='link[rel="modulepreload"][as="'+Cn(i)+'"][href="'+Cn(e)+'"]',v=u;switch(i){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":v=hr(e)}if(!An.has(v)&&(e=g({rel:"modulepreload",href:e},t),An.set(v,e),o.querySelector(u)===null)){switch(i){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(o.querySelector(fl(v)))return}i=o.createElement("link"),zt(i,"link",e),fe(i),o.head.appendChild(i)}}}function vv(e,t,o){pa.S(e,t,o);var i=pr;if(i&&e){var u=Zt(i).hoistableStyles,v=fr(e);t=t||"default";var A=u.get(v);if(!A){var P={loading:0,preload:null};if(A=i.querySelector(pl(v)))P.loading=5;else{e=g({rel:"stylesheet",href:e,"data-precedence":t},o),(o=An.get(v))&&Qs(e,o);var J=A=i.createElement("link");fe(J),zt(J,"link",e),J._p=new Promise(function(ie,pe){J.onload=ie,J.onerror=pe}),J.addEventListener("load",function(){P.loading|=1}),J.addEventListener("error",function(){P.loading|=2}),P.loading|=4,Ti(A,t,i)}A={type:"stylesheet",instance:A,count:1,state:P},u.set(v,A)}}}function _v(e,t){pa.X(e,t);var o=pr;if(o&&e){var i=Zt(o).hoistableScripts,u=hr(e),v=i.get(u);v||(v=o.querySelector(fl(u)),v||(e=g({src:e,async:!0},t),(t=An.get(u))&&Xs(e,t),v=o.createElement("script"),fe(v),zt(v,"link",e),o.head.appendChild(v)),v={type:"script",instance:v,count:1,state:null},i.set(u,v))}}function xv(e,t){pa.M(e,t);var o=pr;if(o&&e){var i=Zt(o).hoistableScripts,u=hr(e),v=i.get(u);v||(v=o.querySelector(fl(u)),v||(e=g({src:e,async:!0,type:"module"},t),(t=An.get(u))&&Xs(e,t),v=o.createElement("script"),fe(v),zt(v,"link",e),o.head.appendChild(v)),v={type:"script",instance:v,count:1,state:null},i.set(u,v))}}function Vf(e,t,o,i){var u=(u=Y.current)?Ai(u):null;if(!u)throw Error(c(446));switch(e){case"meta":case"title":return null;case"style":return typeof o.precedence=="string"&&typeof o.href=="string"?(t=fr(o.href),o=Zt(u).hoistableStyles,i=o.get(t),i||(i={type:"style",instance:null,count:0,state:null},o.set(t,i)),i):{type:"void",instance:null,count:0,state:null};case"link":if(o.rel==="stylesheet"&&typeof o.href=="string"&&typeof o.precedence=="string"){e=fr(o.href);var v=Zt(u).hoistableStyles,A=v.get(e);if(A||(u=u.ownerDocument||u,A={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},v.set(e,A),(v=u.querySelector(pl(e)))&&!v._p&&(A.instance=v,A.state.loading=5),An.has(e)||(o={rel:"preload",as:"style",href:o.href,crossOrigin:o.crossOrigin,integrity:o.integrity,media:o.media,hrefLang:o.hrefLang,referrerPolicy:o.referrerPolicy},An.set(e,o),v||wv(u,e,o,A.state))),t&&i===null)throw Error(c(528,""));return A}if(t&&i!==null)throw Error(c(529,""));return null;case"script":return t=o.async,o=o.src,typeof o=="string"&&t&&typeof t!="function"&&typeof t!="symbol"?(t=hr(o),o=Zt(u).hoistableScripts,i=o.get(t),i||(i={type:"script",instance:null,count:0,state:null},o.set(t,i)),i):{type:"void",instance:null,count:0,state:null};default:throw Error(c(444,e))}}function fr(e){return'href="'+Cn(e)+'"'}function pl(e){return'link[rel="stylesheet"]['+e+"]"}function Bf(e){return g({},e,{"data-precedence":e.precedence,precedence:null})}function wv(e,t,o,i){e.querySelector('link[rel="preload"][as="style"]['+t+"]")?i.loading=1:(t=e.createElement("link"),i.preload=t,t.addEventListener("load",function(){return i.loading|=1}),t.addEventListener("error",function(){return i.loading|=2}),zt(t,"link",o),fe(t),e.head.appendChild(t))}function hr(e){return'[src="'+Cn(e)+'"]'}function fl(e){return"script[async]"+e}function Yf(e,t,o){if(t.count++,t.instance===null)switch(t.type){case"style":var i=e.querySelector('style[data-href~="'+Cn(o.href)+'"]');if(i)return t.instance=i,fe(i),i;var u=g({},o,{"data-href":o.href,"data-precedence":o.precedence,href:null,precedence:null});return i=(e.ownerDocument||e).createElement("style"),fe(i),zt(i,"style",u),Ti(i,o.precedence,e),t.instance=i;case"stylesheet":u=fr(o.href);var v=e.querySelector(pl(u));if(v)return t.state.loading|=4,t.instance=v,fe(v),v;i=Bf(o),(u=An.get(u))&&Qs(i,u),v=(e.ownerDocument||e).createElement("link"),fe(v);var A=v;return A._p=new Promise(function(P,J){A.onload=P,A.onerror=J}),zt(v,"link",i),t.state.loading|=4,Ti(v,o.precedence,e),t.instance=v;case"script":return v=hr(o.src),(u=e.querySelector(fl(v)))?(t.instance=u,fe(u),u):(i=o,(u=An.get(v))&&(i=g({},o),Xs(i,u)),e=e.ownerDocument||e,u=e.createElement("script"),fe(u),zt(u,"link",i),e.head.appendChild(u),t.instance=u);case"void":return null;default:throw Error(c(443,t.type))}else t.type==="stylesheet"&&(t.state.loading&4)===0&&(i=t.instance,t.state.loading|=4,Ti(i,o.precedence,e));return t.instance}function Ti(e,t,o){for(var i=o.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),u=i.length?i[i.length-1]:null,v=u,A=0;A<i.length;A++){var P=i[A];if(P.dataset.precedence===t)v=P;else if(v!==u)break}v?v.parentNode.insertBefore(e,v.nextSibling):(t=o.nodeType===9?o.head:o,t.insertBefore(e,t.firstChild))}function Qs(e,t){e.crossOrigin==null&&(e.crossOrigin=t.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=t.referrerPolicy),e.title==null&&(e.title=t.title)}function Xs(e,t){e.crossOrigin==null&&(e.crossOrigin=t.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=t.referrerPolicy),e.integrity==null&&(e.integrity=t.integrity)}var Di=null;function Gf(e,t,o){if(Di===null){var i=new Map,u=Di=new Map;u.set(o,i)}else u=Di,i=u.get(o),i||(i=new Map,u.set(o,i));if(i.has(e))return i;for(i.set(e,null),o=o.getElementsByTagName(e),u=0;u<o.length;u++){var v=o[u];if(!(v[Pe]||v[St]||e==="link"&&v.getAttribute("rel")==="stylesheet")&&v.namespaceURI!=="http://www.w3.org/2000/svg"){var A=v.getAttribute(t)||"";A=e+A;var P=i.get(A);P?P.push(v):i.set(A,[v])}}return i}function Wf(e,t,o){e=e.ownerDocument||e,e.head.insertBefore(o,t==="title"?e.querySelector("head > title"):null)}function Cv(e,t,o){if(o===1||t.itemProp!=null)return!1;switch(e){case"meta":case"title":return!0;case"style":if(typeof t.precedence!="string"||typeof t.href!="string"||t.href==="")break;return!0;case"link":if(typeof t.rel!="string"||typeof t.href!="string"||t.href===""||t.onLoad||t.onError)break;switch(t.rel){case"stylesheet":return e=t.disabled,typeof t.precedence=="string"&&e==null;default:return!0}case"script":if(t.async&&typeof t.async!="function"&&typeof t.async!="symbol"&&!t.onLoad&&!t.onError&&t.src&&typeof t.src=="string")return!0}return!1}function Qf(e){return!(e.type==="stylesheet"&&(e.state.loading&3)===0)}var hl=null;function bv(){}function Sv(e,t,o){if(hl===null)throw Error(c(475));var i=hl;if(t.type==="stylesheet"&&(typeof o.media!="string"||matchMedia(o.media).matches!==!1)&&(t.state.loading&4)===0){if(t.instance===null){var u=fr(o.href),v=e.querySelector(pl(u));if(v){e=v._p,e!==null&&typeof e=="object"&&typeof e.then=="function"&&(i.count++,i=Ni.bind(i),e.then(i,i)),t.state.loading|=4,t.instance=v,fe(v);return}v=e.ownerDocument||e,o=Bf(o),(u=An.get(u))&&Qs(o,u),v=v.createElement("link"),fe(v);var A=v;A._p=new Promise(function(P,J){A.onload=P,A.onerror=J}),zt(v,"link",o),t.instance=v}i.stylesheets===null&&(i.stylesheets=new Map),i.stylesheets.set(t,e),(e=t.state.preload)&&(t.state.loading&3)===0&&(i.count++,t=Ni.bind(i),e.addEventListener("load",t),e.addEventListener("error",t))}}function Ev(){if(hl===null)throw Error(c(475));var e=hl;return e.stylesheets&&e.count===0&&Zs(e,e.stylesheets),0<e.count?function(t){var o=setTimeout(function(){if(e.stylesheets&&Zs(e,e.stylesheets),e.unsuspend){var i=e.unsuspend;e.unsuspend=null,i()}},6e4);return e.unsuspend=t,function(){e.unsuspend=null,clearTimeout(o)}}:null}function Ni(){if(this.count--,this.count===0){if(this.stylesheets)Zs(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}}var Fi=null;function Zs(e,t){e.stylesheets=null,e.unsuspend!==null&&(e.count++,Fi=new Map,t.forEach(jv,e),Fi=null,Ni.call(e))}function jv(e,t){if(!(t.state.loading&4)){var o=Fi.get(e);if(o)var i=o.get(null);else{o=new Map,Fi.set(e,o);for(var u=e.querySelectorAll("link[data-precedence],style[data-precedence]"),v=0;v<u.length;v++){var A=u[v];(A.nodeName==="LINK"||A.getAttribute("media")!=="not all")&&(o.set(A.dataset.precedence,A),i=A)}i&&o.set(null,i)}u=t.instance,A=u.getAttribute("data-precedence"),v=o.get(A)||i,v===i&&o.set(null,u),o.set(A,u),this.count++,i=Ni.bind(this),u.addEventListener("load",i),u.addEventListener("error",i),v?v.parentNode.insertBefore(u,v.nextSibling):(e=e.nodeType===9?e.head:e,e.insertBefore(u,e.firstChild)),t.state.loading|=4}}var ml={$$typeof:C,Provider:null,Consumer:null,_currentValue:X,_currentValue2:X,_threadCount:0};function kv(e,t,o,i,u,v,A,P){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=_a(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=_a(0),this.hiddenUpdates=_a(null),this.identifierPrefix=i,this.onUncaughtError=u,this.onCaughtError=v,this.onRecoverableError=A,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=P,this.incompleteTransitions=new Map}function Xf(e,t,o,i,u,v,A,P,J,ie,pe,me){return e=new kv(e,t,o,A,P,J,ie,me),t=1,v===!0&&(t|=24),v=dn(3,null,null,t),e.current=v,v.stateNode=e,t=Nc(),t.refCount++,e.pooledCache=t,t.refCount++,v.memoizedState={element:i,isDehydrated:o,cache:t},Uc(v),e}function Zf(e){return e?(e=Bo,e):Bo}function Kf(e,t,o,i,u,v){u=Zf(u),i.context===null?i.context=u:i.pendingContext=u,i=ka(t),i.payload={element:o},v=v===void 0?null:v,v!==null&&(i.callback=v),o=Ra(e,i,t),o!==null&&(mn(o,e,t),Br(o,e,t))}function Jf(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var o=e.retryLane;e.retryLane=o!==0&&o<t?o:t}}function Ks(e,t){Jf(e,t),(e=e.alternate)&&Jf(e,t)}function eh(e){if(e.tag===13){var t=Vo(e,67108864);t!==null&&mn(t,e,67108864),Ks(e,67108864)}}var qi=!0;function Rv(e,t,o,i){var u=D.T;D.T=null;var v=O.p;try{O.p=2,Js(e,t,o,i)}finally{O.p=v,D.T=u}}function Av(e,t,o,i){var u=D.T;D.T=null;var v=O.p;try{O.p=8,Js(e,t,o,i)}finally{O.p=v,D.T=u}}function Js(e,t,o,i){if(qi){var u=ed(i);if(u===null)Ms(e,t,i,$i,o),nh(e,i);else if(Dv(u,e,t,o,i))i.stopPropagation();else if(nh(e,i),t&4&&-1<Tv.indexOf(e)){for(;u!==null;){var v=Fe(u);if(v!==null)switch(v.tag){case 3:if(v=v.stateNode,v.current.memoizedState.isDehydrated){var A=Ut(v.pendingLanes);if(A!==0){var P=v;for(P.pendingLanes|=2,P.entangledLanes|=2;A;){var J=1<<31-At(A);P.entanglements[1]|=J,A&=~J}Wn(v),(ct&6)===0&&(vi=Ce()+500,cl(0))}}break;case 13:P=Vo(v,2),P!==null&&mn(P,v,2),xi(),Ks(v,2)}if(v=ed(i),v===null&&Ms(e,t,i,$i,o),v===u)break;u=v}u!==null&&i.stopPropagation()}else Ms(e,t,i,null,o)}}function ed(e){return e=rc(e),td(e)}var $i=null;function td(e){if($i=null,e=Ye(e),e!==null){var t=d(e);if(t===null)e=null;else{var o=t.tag;if(o===13){if(e=p(t),e!==null)return e;e=null}else if(o===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null)}}return $i=e,null}function th(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Ie()){case ze:return 2;case wt:return 8;case Qe:case Mt:return 32;case rn:return 268435456;default:return 32}default:return 32}}var nd=!1,Pa=null,Ha=null,za=null,yl=new Map,gl=new Map,Va=[],Tv="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function nh(e,t){switch(e){case"focusin":case"focusout":Pa=null;break;case"dragenter":case"dragleave":Ha=null;break;case"mouseover":case"mouseout":za=null;break;case"pointerover":case"pointerout":yl.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":gl.delete(t.pointerId)}}function vl(e,t,o,i,u,v){return e===null||e.nativeEvent!==v?(e={blockedOn:t,domEventName:o,eventSystemFlags:i,nativeEvent:v,targetContainers:[u]},t!==null&&(t=Fe(t),t!==null&&eh(t)),e):(e.eventSystemFlags|=i,t=e.targetContainers,u!==null&&t.indexOf(u)===-1&&t.push(u),e)}function Dv(e,t,o,i,u){switch(t){case"focusin":return Pa=vl(Pa,e,t,o,i,u),!0;case"dragenter":return Ha=vl(Ha,e,t,o,i,u),!0;case"mouseover":return za=vl(za,e,t,o,i,u),!0;case"pointerover":var v=u.pointerId;return yl.set(v,vl(yl.get(v)||null,e,t,o,i,u)),!0;case"gotpointercapture":return v=u.pointerId,gl.set(v,vl(gl.get(v)||null,e,t,o,i,u)),!0}return!1}function ah(e){var t=Ye(e.target);if(t!==null){var o=d(t);if(o!==null){if(t=o.tag,t===13){if(t=p(o),t!==null){e.blockedOn=t,lo(e.priority,function(){if(o.tag===13){var i=hn();i=wa(i);var u=Vo(o,i);u!==null&&mn(u,o,i),Ks(o,i)}});return}}else if(t===3&&o.stateNode.current.memoizedState.isDehydrated){e.blockedOn=o.tag===3?o.stateNode.containerInfo:null;return}}}e.blockedOn=null}function Ui(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var o=ed(e.nativeEvent);if(o===null){o=e.nativeEvent;var i=new o.constructor(o.type,o);oc=i,o.target.dispatchEvent(i),oc=null}else return t=Fe(o),t!==null&&eh(t),e.blockedOn=o,!1;t.shift()}return!0}function oh(e,t,o){Ui(e)&&o.delete(t)}function Nv(){nd=!1,Pa!==null&&Ui(Pa)&&(Pa=null),Ha!==null&&Ui(Ha)&&(Ha=null),za!==null&&Ui(za)&&(za=null),yl.forEach(oh),gl.forEach(oh)}function Oi(e,t){e.blockedOn===t&&(e.blockedOn=null,nd||(nd=!0,a.unstable_scheduleCallback(a.unstable_NormalPriority,Nv)))}var Ii=null;function rh(e){Ii!==e&&(Ii=e,a.unstable_scheduleCallback(a.unstable_NormalPriority,function(){Ii===e&&(Ii=null);for(var t=0;t<e.length;t+=3){var o=e[t],i=e[t+1],u=e[t+2];if(typeof i!="function"){if(td(i||o)===null)continue;break}var v=Fe(o);v!==null&&(e.splice(t,3),t-=3,ts(v,{pending:!0,data:u,method:o.method,action:i},i,u))}}))}function _l(e){function t(J){return Oi(J,e)}Pa!==null&&Oi(Pa,e),Ha!==null&&Oi(Ha,e),za!==null&&Oi(za,e),yl.forEach(t),gl.forEach(t);for(var o=0;o<Va.length;o++){var i=Va[o];i.blockedOn===e&&(i.blockedOn=null)}for(;0<Va.length&&(o=Va[0],o.blockedOn===null);)ah(o),o.blockedOn===null&&Va.shift();if(o=(e.ownerDocument||e).$$reactFormReplay,o!=null)for(i=0;i<o.length;i+=3){var u=o[i],v=o[i+1],A=u[Nt]||null;if(typeof v=="function")A||rh(o);else if(A){var P=null;if(v&&v.hasAttribute("formAction")){if(u=v,A=v[Nt]||null)P=A.formAction;else if(td(u)!==null)continue}else P=A.action;typeof P=="function"?o[i+1]=P:(o.splice(i,3),i-=3),rh(o)}}}function ad(e){this._internalRoot=e}Li.prototype.render=ad.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(c(409));var o=t.current,i=hn();Kf(o,i,e,t,null,null)},Li.prototype.unmount=ad.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;Kf(e.current,2,null,e,null,null),xi(),t[ue]=null}};function Li(e){this._internalRoot=e}Li.prototype.unstable_scheduleHydration=function(e){if(e){var t=ro();e={blockedOn:null,target:e,priority:t};for(var o=0;o<Va.length&&t!==0&&t<Va[o].priority;o++);Va.splice(o,0,e),o===0&&ah(e)}};var lh=n.version;if(lh!=="19.1.1")throw Error(c(527,lh,"19.1.1"));O.findDOMNode=function(e){var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(c(188)):(e=Object.keys(e).join(","),Error(c(268,e)));return e=h(t),e=e!==null?m(e):null,e=e===null?null:e.stateNode,e};var Fv={bundleType:0,version:"19.1.1",rendererPackageName:"react-dom",currentDispatcherRef:D,reconcilerVersion:"19.1.1"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Mi=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Mi.isDisabled&&Mi.supportsFiber)try{qn=Mi.inject(Fv),$t=Mi}catch{}}return wl.createRoot=function(e,t){if(!s(e))throw Error(c(299));var o=!1,i="",u=wp,v=Cp,A=bp,P=null;return t!=null&&(t.unstable_strictMode===!0&&(o=!0),t.identifierPrefix!==void 0&&(i=t.identifierPrefix),t.onUncaughtError!==void 0&&(u=t.onUncaughtError),t.onCaughtError!==void 0&&(v=t.onCaughtError),t.onRecoverableError!==void 0&&(A=t.onRecoverableError),t.unstable_transitionCallbacks!==void 0&&(P=t.unstable_transitionCallbacks)),t=Xf(e,1,!1,null,null,o,i,u,v,A,P,null),e[ue]=t.current,Ls(e),new ad(t)},wl.hydrateRoot=function(e,t,o){if(!s(e))throw Error(c(299));var i=!1,u="",v=wp,A=Cp,P=bp,J=null,ie=null;return o!=null&&(o.unstable_strictMode===!0&&(i=!0),o.identifierPrefix!==void 0&&(u=o.identifierPrefix),o.onUncaughtError!==void 0&&(v=o.onUncaughtError),o.onCaughtError!==void 0&&(A=o.onCaughtError),o.onRecoverableError!==void 0&&(P=o.onRecoverableError),o.unstable_transitionCallbacks!==void 0&&(J=o.unstable_transitionCallbacks),o.formState!==void 0&&(ie=o.formState)),t=Xf(e,1,!0,t,o??null,i,u,v,A,P,J,ie),t.context=Zf(null),o=t.current,i=hn(),i=wa(i),u=ka(i),u.callback=null,Ra(o,u,i),o=i,t.current.lanes=o,Un(t,o),Wn(t),e[ue]=t.current,Ls(e),new Li(t)},wl.version="19.1.1",wl}var yh;function zv(){if(yh)return rd.exports;yh=1;function a(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(a)}catch(n){console.error(n)}}return a(),rd.exports=Hv(),rd.exports}var Vv=zv(),re=Sd();/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const vt=({card:a,onPointerDown:n,onPointerEnter:l,onPointerLeave:c,isFaceUp:s,faceDownValue:d=2,isSelected:p,isMultiSelected:f,isTargetable:h,isSourceOfEffect:m,style:g,additionalClassName:y,animationState:w})=>{const _=({content:q,className:B})=>r.jsx("div",{className:`card-rule-box ${B||""}`,dangerouslySetInnerHTML:{__html:q}}),k=(w==null?void 0:w.type)==="playCard"&&w.cardId===a.id?`is-entering-${w.owner}`:"",$=(w==null?void 0:w.type)==="deleteCard"&&w.cardId===a.id?`is-deleting-${w.owner}`:"",E=(w==null?void 0:w.type)==="drawCard"||(w==null?void 0:w.type)==="discardCard"?w.owner:void 0,C=E==="player"&&(w==null?void 0:w.type)==="drawCard"&&w.cardIds.includes(a.id),N=E==="player"&&(w==null?void 0:w.type)==="discardCard"&&w.cardIds.includes(a.id),T=["card-component"];a.protocol&&T.push(`card-protocol-${a.protocol.toLowerCase()}`),a.color&&T.push("has-custom-color"),a.pattern&&T.push(`card-pattern-${a.pattern}`),p&&T.push("selected"),f&&T.push("multi-selected"),N&&T.push("is-discarding"),h&&T.push("is-targetable"),m&&T.push("is-source-of-effect"),k&&T.push(k),$&&T.push($),C&&T.push("is-drawing"),y&&T.push(y);const H={...g};return a.color&&(H["--card-custom-color"]=a.color),r.jsx("div",{className:T.join(" "),onPointerDown:n,onPointerEnter:l,onPointerLeave:c,role:"button",tabIndex:n?0:-1,style:H,children:r.jsxs("div",{className:`card-inner ${s?"":"is-flipped"}`,children:[r.jsxs("div",{className:"card-face card-front",children:[r.jsxs("div",{className:"card-header",children:[r.jsx("span",{className:`card-protocol ${a.protocol.length<=8?"short-protocol":""}`,children:a.protocol.slice(0,8)}),r.jsx("span",{className:"card-value",children:a.value})]}),r.jsxs("div",{className:"card-body",children:[r.jsx(_,{content:a.top,className:"card-rule-top"}),r.jsx(_,{content:a.middle,className:"card-rule-middle"}),r.jsx(_,{content:a.bottom,className:"card-rule-bottom"})]})]}),r.jsx("div",{className:"card-face card-back",children:r.jsx("div",{className:"card-back-value",children:d})})]})})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const gn=[{protocol:"Apathy",value:0,top:"Your total value in this line is increased by 1 for each face-down card in this line.",middle:"",bottom:"",keywords:{},category:"Aux 1"},{protocol:"Apathy",value:1,top:"",middle:"Flip all other face-up cards in this line.",bottom:"",keywords:{flip:!0},category:"Aux 1"},{protocol:"Apathy",value:2,top:"Ignore all middle commands of cards in this line.",middle:"",bottom:"<div><span class='emphasis'>When this card would be covered:</span> First, flip this card.</div>",keywords:{flip:!0},category:"Aux 1"},{protocol:"Apathy",value:3,top:"",middle:"Flip 1 of your opponent's face-up cards.",bottom:"",keywords:{flip:!0},category:"Aux 1"},{protocol:"Apathy",value:4,top:"",middle:"You may flip 1 of your face-up covered cards.",bottom:"",keywords:{flip:!0},category:"Aux 1"},{protocol:"Apathy",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Aux 1"},{protocol:"Chaos",value:0,top:"",middle:"In each line, flip 1 covered card.",bottom:"<div><span class='emphasis'>Start:</span> Draw the top card of your opponent's deck. Your opponent draws the top card of your deck.</div>",keywords:{flip:!0,draw:!0},category:"Main 2"},{protocol:"Chaos",value:1,top:"",middle:"Rearrange your protocols. Rearrange your opponent's protocols.",bottom:"",keywords:{},category:"Main 2"},{protocol:"Chaos",value:2,top:"",middle:"Shift 1 of your covered cards.",bottom:"",keywords:{shift:!0},category:"Main 2"},{protocol:"Chaos",value:3,top:"",middle:"",bottom:"You may play cards without matching protocols.",keywords:{play:!0},category:"Main 2"},{protocol:"Chaos",value:4,top:"",middle:"",bottom:"<div><span class='emphasis'>End:</span> Discard your hand. Draw the same amount of cards.</div>",keywords:{discard:!0,draw:!0},category:"Main 2"},{protocol:"Chaos",value:5,top:"",middle:"Discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 2"},{protocol:"Darkness",value:0,top:"",middle:"Draw 3 cards. Shift 1 of your opponent's covered cards.",bottom:"",keywords:{draw:!0,shift:!0},category:"Main 1"},{protocol:"Darkness",value:1,top:"",middle:"Flip 1 of your opponent's cards. You may shift that card.",bottom:"",keywords:{flip:!0,shift:!0},category:"Main 1"},{protocol:"Darkness",value:2,top:"All face-down cards in this stack have a value of 4.",middle:"You may flip 1 covered card in this line.",bottom:"",keywords:{flip:!0},category:"Main 1"},{protocol:"Darkness",value:3,top:"",middle:"Play 1 card face-down in another line.",bottom:"",keywords:{play:!0},category:"Main 1"},{protocol:"Darkness",value:4,top:"",middle:"Shift 1 face-down card.",bottom:"",keywords:{shift:!0},category:"Main 1"},{protocol:"Darkness",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Death",value:0,top:"",middle:"Delete 1 card from each other line.",bottom:"",keywords:{delete:!0},category:"Main 1"},{protocol:"Death",value:1,top:"<div><span class='emphasis'>Start:</span> You may draw 1 card. If you do, delete 1 other card, then delete this card.</div>",middle:"",bottom:"",keywords:{draw:!0,delete:!0},category:"Main 1"},{protocol:"Death",value:2,top:"",middle:"Delete all cards in 1 line with values of 1 or 2.",bottom:"",keywords:{delete:!0},category:"Main 1"},{protocol:"Death",value:3,top:"",middle:"Delete 1 face-down card.",bottom:"",keywords:{delete:!0},category:"Main 1"},{protocol:"Death",value:4,top:"",middle:"Delete a card with a value of 0 or 1.",bottom:"",keywords:{delete:!0},category:"Main 1"},{protocol:"Death",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Fire",value:0,top:"",middle:"Flip 1 other card. Draw 2 cards.",bottom:"<div><span class='emphasis'>When this card would be covered:</span> First, draw 1 card and flip 1 other card.</div>",keywords:{draw:!0,flip:!0},category:"Main 1"},{protocol:"Fire",value:1,top:"",middle:"Discard 1 card. If you do, delete 1 card.",bottom:"",keywords:{delete:!0,discard:!0},category:"Main 1"},{protocol:"Fire",value:2,top:"",middle:"Discard 1 card. If you do, return 1 card.",bottom:"",keywords:{discard:!0,return:!0},category:"Main 1"},{protocol:"Fire",value:3,top:"",middle:"",bottom:"<div><span class='emphasis'>End:</span> You may discard 1 card. If you do, flip 1 card.</div>",keywords:{discard:!0,flip:!0},category:"Main 1"},{protocol:"Fire",value:4,top:"",middle:"Discard 1 or more cards. Draw the amount discarded plus 1.",bottom:"",keywords:{discard:!0,draw:!0},category:"Main 1"},{protocol:"Fire",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Gravity",value:0,top:"",middle:"For every 2 cards in this line, play the top card of your deck face-down under this card.",bottom:"",keywords:{play:!0},category:"Main 1"},{protocol:"Gravity",value:1,top:"",middle:"Draw 2 cards. Shift 1 card either to or from this line.",bottom:"",keywords:{draw:!0,shift:!0},category:"Main 1"},{protocol:"Gravity",value:2,top:"",middle:"Flip 1 card. Shift that card to this line.",bottom:"",keywords:{flip:!0,shift:!0},category:"Main 1"},{protocol:"Gravity",value:4,top:"",middle:"Shift 1 face-down card to this line.",bottom:"",keywords:{shift:!0},category:"Main 1"},{protocol:"Gravity",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Gravity",value:6,top:"",middle:"Your opponent plays the top card of their deck face-down in this line.",bottom:"",keywords:{play:!0},category:"Main 1"},{protocol:"Hate",value:0,top:"",middle:"Delete 1 card.",bottom:"",keywords:{delete:!0},category:"Aux 1"},{protocol:"Hate",value:1,top:"",middle:"Discard 3 cards. Delete 1 card. Delete 1 card.",bottom:"",keywords:{delete:!0,discard:!0},category:"Aux 1"},{protocol:"Hate",value:2,top:"",middle:"Delete your highest value uncovered card. Delete your opponent's highest value uncovered card.",bottom:"",keywords:{delete:!0},category:"Aux 1"},{protocol:"Hate",value:3,top:"<div><span class='emphasis'>After you delete cards:</span> Draw 1 card.</div>",middle:"",bottom:"",keywords:{draw:!0},category:"Aux 1"},{protocol:"Hate",value:4,top:"",middle:"",bottom:"<div><span class='emphasis'>When this card would be covered:</span> First, delete the lowest value covered card in this line.</div>",keywords:{delete:!0},category:"Aux 1"},{protocol:"Hate",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Aux 1"},{protocol:"Life",value:0,top:"",middle:"Play the top card of your deck face-down in each line where you have a card.",bottom:"<div><span class='emphasis'>When this card would be covered:</span> First, delete this card.</div>",keywords:{delete:!0,play:!0},category:"Main 1"},{protocol:"Life",value:1,top:"",middle:"Flip 1 card. Flip 1 card.",bottom:"",keywords:{flip:!0},category:"Main 1"},{protocol:"Life",value:2,top:"",middle:"Draw 1 card. You may flip 1 face-down card.",bottom:"",keywords:{draw:!0,flip:!0},category:"Main 1"},{protocol:"Life",value:3,top:"",middle:"",bottom:"<div><span class='emphasis'>When this card would be covered:</span> First, play the top card of your deck face-down in another line.</div>",keywords:{play:!0},category:"Main 1"},{protocol:"Life",value:4,top:"",middle:"If this card is covering a card, draw 1 card.",bottom:"",keywords:{draw:!0},category:"Main 1"},{protocol:"Life",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Light",value:0,top:"",middle:"Flip 1 card. Draw cards equal to that card's value.",bottom:"",keywords:{draw:!0,flip:!0},category:"Main 1"},{protocol:"Light",value:1,top:"",middle:"",bottom:"<div><span class='emphasis'>End:</span> Draw 1 card.</div>",keywords:{draw:!0},category:"Main 1"},{protocol:"Light",value:2,top:"",middle:"Draw 2 cards. Reveal 1 face-down card. You may shift or flip that card.",bottom:"",keywords:{draw:!0,flip:!0,reveal:!0,shift:!0},category:"Main 1"},{protocol:"Light",value:3,top:"",middle:"Shift all face-down cards in this line to another line.",bottom:"",keywords:{shift:!0},category:"Main 1"},{protocol:"Light",value:4,top:"",middle:"Your opponent reveals their hand.",bottom:"",keywords:{reveal:!0},category:"Main 1"},{protocol:"Light",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Love",value:1,top:"",middle:"Draw the top card of your opponent's deck.",bottom:"<div><span class='emphasis'>End:</span> You may give 1 card from your hand to your opponent. If you do, draw 2 cards.</div>",keywords:{draw:!0,give:!0},category:"Aux 1"},{protocol:"Love",value:2,top:"",middle:"Your opponent draws 1 card. Refresh.",bottom:"",keywords:{draw:!0,refresh:!0},category:"Aux 1"},{protocol:"Love",value:3,top:"",middle:"Take 1 random card from your opponent's hand. Give 1 card from your hand to your opponent.",bottom:"",keywords:{give:!0,take:!0},category:"Aux 1"},{protocol:"Love",value:4,top:"",middle:"Reveal 1 card from your hand. Flip 1 card.",bottom:"",keywords:{flip:!0,reveal:!0},category:"Aux 1"},{protocol:"Love",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Aux 1"},{protocol:"Love",value:6,top:"",middle:"Your opponent draws 2 cards.",bottom:"",keywords:{draw:!0},category:"Aux 1"},{protocol:"Metal",value:0,top:"Your opponent's total value in this line is reduced by 2.",middle:"Flip 1 card.",bottom:"",keywords:{flip:!0},category:"Main 1"},{protocol:"Metal",value:1,top:"",middle:"Draw 2 cards. Your opponent cannot compile next turn.",bottom:"",keywords:{draw:!0},category:"Main 1"},{protocol:"Metal",value:2,top:"Your opponent cannot play cards face-down in this line.",middle:"",bottom:"",keywords:{},category:"Main 1"},{protocol:"Metal",value:3,top:"",middle:"Draw 1 card. Delete all cards in 1 other line with 8 or more cards.",bottom:"",keywords:{delete:!0,draw:!0},category:"Main 1"},{protocol:"Metal",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Metal",value:6,top:"<div><span class='emphasis'>When this card would be covered or flipped:</span> First, delete this card.</div>",middle:"",bottom:"",keywords:{delete:!0},category:"Main 1"},{protocol:"Plague",value:0,top:"",middle:"Your opponent discards 1 card.",bottom:"Your opponent cannot play cards in this line.",keywords:{discard:!0},category:"Main 1"},{protocol:"Plague",value:1,top:"<div><span class='emphasis'>After your opponent discards cards:</span> Draw 1 card.</div>",middle:"Your opponent discards 1 card.",bottom:"",keywords:{discard:!0,draw:!0},category:"Main 1"},{protocol:"Plague",value:2,top:"",middle:"Dicard 1 or more cards. Your opponent discards the amount of cards discarded plus 1.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Plague",value:3,top:"",middle:"Flip each other face-up card.",bottom:"",keywords:{flip:!0},category:"Main 1"},{protocol:"Plague",value:4,top:"",middle:"",bottom:"<div><span class='emphasis'>End:</span> Your opponent deletes 1 of their face-down cards. You may flip this card.</div>",keywords:{delete:!0,flip:!0},category:"Main 1"},{protocol:"Plague",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Psychic",value:0,top:"",middle:"Draw 2 cards. Your opponent discards 2 cards, then reveals their hand.",bottom:"",keywords:{discard:!0,draw:!0,reveal:!0},category:"Main 1"},{protocol:"Psychic",value:1,top:"Your opponent can only play cards face-down.",middle:"",bottom:"<div><span class='emphasis'>Start:</span> Flip this card.</div>",keywords:{flip:!0},category:"Main 1"},{protocol:"Psychic",value:2,top:"",middle:"Your opponent discards 2 cards. Rearrange their protocols.",bottom:"",keywords:{discard:!0,rearrange:!0},category:"Main 1"},{protocol:"Psychic",value:3,top:"",middle:"Your opponent discards 1 card. Shift 1 of their cards.",bottom:"",keywords:{discard:!0,shift:!0},category:"Main 1"},{protocol:"Psychic",value:4,top:"",middle:"",bottom:"<div><span class='emphasis'>End:</span> You may return 1 of your opponent's cards. If you do, flip this card.</div>",keywords:{flip:!0,return:!0},category:"Main 1"},{protocol:"Psychic",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Speed",value:0,top:"",middle:"Play 1 card.",bottom:"",keywords:{play:!0},category:"Main 1"},{protocol:"Speed",value:1,top:"<div><span class='emphasis'>After you clear cache:</span> Draw 1 card.</div>",middle:"Draw 2 cards.",bottom:"",keywords:{draw:!0},category:"Main 1"},{protocol:"Speed",value:2,top:"<div><span class='emphasis'>When this card would be deleted by compiling:</span> Shift this card, even if this card is covered.</div>",middle:"",bottom:"",keywords:{shift:!0},category:"Main 1"},{protocol:"Speed",value:3,top:"",middle:"Shift 1 of your other cards.",bottom:"<div><span class='emphasis'>End:</span> You may shift 1 of your cards. If you do, flip this card.</div>",keywords:{flip:!0,shift:!0},category:"Main 1"},{protocol:"Speed",value:4,top:"",middle:"Shift 1 of your opponent's face-down cards.",bottom:"",keywords:{shift:!0},category:"Main 1"},{protocol:"Speed",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Spirit",value:0,top:"",middle:"Refresh. Draw 1 card.",bottom:"Skip your check cache phase.",keywords:{draw:!0,refresh:!0},category:"Main 1"},{protocol:"Spirit",value:1,top:"You can play cards in any line.",middle:"Draw 2 cards.",bottom:"<div><span class='emphasis'>Start:</span> Either discard 1 card or flip this card.</div>",keywords:{discard:!0,draw:!0,flip:!0},category:"Main 1"},{protocol:"Spirit",value:2,top:"",middle:"You may flip 1 card.",bottom:"",keywords:{flip:!0},category:"Main 1"},{protocol:"Spirit",value:3,top:"<div><span class='emphasis'>After you draw cards:</span> You may shift this card, even if this card is covered.</div>",middle:"",bottom:"",keywords:{shift:!0},category:"Main 1"},{protocol:"Spirit",value:4,top:"",middle:"Swap the positions of 2 of your protocols",bottom:"",keywords:{swap:!0},category:"Main 1"},{protocol:"Spirit",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Water",value:0,top:"",middle:"Flip 1 other card. Flip this card.",bottom:"",keywords:{flip:!0},category:"Main 1"},{protocol:"Water",value:1,top:"",middle:"Play the top card of your deck face-down in each other line.",bottom:"",keywords:{play:!0},category:"Main 1"},{protocol:"Water",value:2,top:"",middle:"Draw 2 cards. Rearrange your protocols.",bottom:"",keywords:{draw:!0,rearrange:!0},category:"Main 1"},{protocol:"Water",value:3,top:"",middle:"Return all cards with a value of 2 in 1 line.",bottom:"",keywords:{return:!0},category:"Main 1"},{protocol:"Water",value:4,top:"",middle:"Return 1 of your cards.",bottom:"",keywords:{return:!0},category:"Main 1"},{protocol:"Water",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Frost",value:0,top:"",middle:"Draw 1 card for each face-down card.",bottom:"",keywords:{draw:!0},category:"Fan-Content"},{protocol:"Frost",value:1,top:"Cards cannot be flipped face-up.",middle:"",bottom:"Protocols cannot be rearranged.",keywords:{flip:!0,rearrange:!0},category:"Fan-Content"},{protocol:"Frost",value:2,top:"",middle:"Play a card face-down.",bottom:"",keywords:{play:!0},category:"Fan-Content"},{protocol:"Frost",value:3,top:"Cards cannot shift from or to this line.",middle:"",bottom:"",keywords:{shift:!0},category:"Fan-Content"},{protocol:"Frost",value:4,top:"",middle:"You may flip 1 card of your face-up covered cards.",bottom:"",keywords:{flip:!0},category:"Fan-Content"},{protocol:"Frost",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Fan-Content"},{protocol:"Anarchy",value:0,top:"",middle:"Shift 1 card. For each line that contains a face-up card without matching protocol, draw 1 card.",bottom:"",keywords:{shift:!0,draw:!0},category:"Fan-Content"},{protocol:"Anarchy",value:1,top:"Cards can only be played without matching protocols.",middle:"Shift 1 other card to a line without a matching protocol.",bottom:"",keywords:{shift:!0,play:!0},category:"Fan-Content"},{protocol:"Anarchy",value:2,top:"",middle:"Delete a covered or uncovered card in a line with a matching protocol.",bottom:"",keywords:{delete:!0},category:"Fan-Content"},{protocol:"Anarchy",value:3,top:"",middle:"Swap the positions of 2 of your opponent's protocols.",bottom:"<div><span class='emphasis'>End:</span> Rearrange your protocols. Anarchy cannot be on this line.</div>",keywords:{swap:!0,rearrange:!0},category:"Fan-Content"},{protocol:"Anarchy",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Fan-Content"},{protocol:"Anarchy",value:6,top:"<div><span class='emphasis'>Start:</span> Flip this card, if this card is in the line with the Anarchy protocol.</div>",middle:"",bottom:"",keywords:{flip:!0},category:"Fan-Content"}],Bv=new Set(gn.map(a=>a.protocol)),Hh=Array.from(Bv).sort();/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const _r=a=>{var c,s,d,p,f,h,m,g,y,w,_,b,k,S,$,E,C,N,T,H,q,B,K,U,R,j,F,M,L,D,O,X,ne,z,G,Z,Q,I,W,Y,de,ee,ge,Se,ye,Ne,Le,Je,at,we,Ce,Ie,ze,wt,Qe,Mt,rn,Hn,ga,qn,$t,Xt,At,va,Fo,eo,Xn,$n,Ut,ln,zn,qo,to,no,_a,Un,xa,ao,oo,wa,Ca,ro,lo,cn,St,Nt;const n=a.params;let l="";switch(n.action){case"refresh":{n.target==="opponent"?l="Your opponent refreshes their hand.":l="Refresh.";break}case"mutual_draw":{const ue=n.count||1;l=`Draw the top card${ue!==1?"s":""} of your opponent's deck. Your opponent draws the top card${ue!==1?"s":""} of your deck.`;break}case"draw":{if(a.useCardFromPreviousEffect){n.target==="opponent"?l="Opponent draws cards equal to that card's value.":l="Draw cards equal to that card's value.";break}if(n.countType==="count_face_down"){l="Draw 1 card for each face-down card.";break}if(n.conditional){switch(n.conditional.type){case"count_face_down":l="Draw 1 card for each face-down card.";break;case"is_covering":l=`Draw ${n.count} card${n.count!==1?"s":""} if this card is covering another.`;break;case"non_matching_protocols":l="Draw 1 card for each line with a non-matching protocol.";break}break}let ue="";if(n.countType==="equal_to_discarded"){const Ae=n.countOffset||0;Ae===1?ue+="Draw 1 more card than the amount discarded.":Ae===0?ue+="Draw the same amount of cards.":ue+=`Draw the amount discarded plus ${Ae}.`,l=ue;break}else if(n.countType==="equal_to_card_value"){ue+="Draw cards equal to that card's value.",l=ue;break}else if(n.countType==="hand_size"){ue+="Draw the same amount of cards.",l=ue;break}else if(n.countType==="all_matching"&&((c=n.valueFilter)==null?void 0:c.equals)!==void 0){const Ae=n.valueFilter.equals;ue+=`Draw all cards with a value of ${Ae}.`,l=ue;break}else if(((s=n.valueFilter)==null?void 0:s.equals)!==void 0&&n.count){const Ae=n.valueFilter.equals,Ue=n.count===1?"card":"cards",De=n.fromRevealed?" revealed this way":"";ue+=`Draw ${n.count} ${Ue} with a value of ${Ae}${De}.`,l=ue;break}if(((d=n.advancedConditional)==null?void 0:d.type)==="empty_hand"){const Ae=n.count||1;l=`If you have no cards in hand, draw ${Ae} card${Ae!==1?"s":""}.`;break}if(((p=n.advancedConditional)==null?void 0:p.type)==="opponent_higher_value_in_lane"){const Ae=n.count||1;l=`If your opponent has a higher total value than you do in this line, draw ${Ae} card${Ae!==1?"s":""}.`;break}const be=n.optional?"You may ":"";if(n.source==="opponent_deck"){const Ae=n.count===1?"the top card":`the top ${n.count} cards`;ue+=`${be}Draw ${Ae} of your opponent's deck.`}else if(n.target==="opponent")ue+=`Opponent draws ${n.count} card${n.count!==1?"s":""}.`;else{const Ae=n.optional?"draw":"Draw";ue+=`${be}${Ae} ${n.count} card${n.count!==1?"s":""}.`}l=ue;break}case"flip":{if(a.useCardFromPreviousEffect){l=`${n.optional?"May flip":"Flip"} that card.`;break}if(n.flipSelf){if(((f=n.advancedConditional)==null?void 0:f.type)==="opponent_higher_value_in_lane"){l="If your opponent has a higher value in this line than you do, flip this card.";break}let ot=(n.optional,"Flip this card");((h=n.advancedConditional)==null?void 0:h.type)==="protocol_match"&&(ot+=`, if this card is in the line with the ${n.advancedConditional.protocol||"[Protocol]"} protocol`),l=ot+".";break}const ue=n.optional?"You may flip":"Flip",be=((m=n.targetFilter)==null?void 0:m.owner)==="own",Ae=((g=n.targetFilter)==null?void 0:g.owner)==="opponent",Ue=(y=n.targetFilter)==null?void 0:y.excludeSelf;let De="";be&&Ue?De+="of your other ":be?De+="of your ":Ae?De+="of your opponent's ":Ue&&(De+="other "),((w=n.targetFilter)==null?void 0:w.position)==="any"?De+="covered or uncovered ":((_=n.targetFilter)==null?void 0:_.position)==="covered"&&(De+="covered "),((b=n.targetFilter)==null?void 0:b.faceState)==="face_down"&&(De+="face-down "),((k=n.targetFilter)==null?void 0:k.faceState)==="face_up"&&(De+="face-up ");let Pe="";n.count==="all"?Pe="all":n.count==="each"?n.eachLineScope==="each_line"?(Pe="1",De=De+"(in each line) "):Pe="each":Pe=n.count.toString();const Ye=be||Ae?"cards":n.count===1?"card":"cards";let Fe="";if(be&&((S=n.targetFilter)==null?void 0:S.position)==="covered"&&(($=n.targetFilter)==null?void 0:$.faceState)==="face_up"&&n.optional?Fe=`${ue} ${Pe} of your ${n.targetFilter.faceState.replace("_","-")} ${n.targetFilter.position} cards`:Fe=`${ue} ${Pe} ${De}${Ye}`,n.scope==="this_lane"){const ot=((E=n.targetFilter)==null?void 0:E.owner)==="own";Fe+=ot?" in this stack":" in this line"}else n.scope==="each_lane"&&(Fe=`In each line, ${Fe.charAt(0).toLowerCase()+Fe.slice(1)}`);Fe+=".",n.selfFlipAfter&&(Fe+=" Then flip this card."),l=Fe;break}case"shift":{const ue=n.optional?"You may shift":"Shift";if(((C=n.advancedConditional)==null?void 0:C.type)==="empty_hand"){l=`If you have no cards in hand, ${ue.toLowerCase()} 1 card.`;break}if(((N=n.advancedConditional)==null?void 0:N.type)==="opponent_higher_value_in_lane"){l=`If your opponent has a higher total value than you do in this line, ${ue.toLowerCase()} 1 card.`;break}if(((T=n.advancedConditional)==null?void 0:T.type)==="this_card_is_covered"){l=`If this card is covered, ${ue.toLowerCase()} it.`;break}if(n.shiftSelf){if(((H=n.destinationRestriction)==null?void 0:H.type)==="opponent_highest_value_lane"){l=`${ue} this card to the line where your opponent has their highest total value.`;break}let Ee=`${ue} this card`;n.allowCoveredSelf&&(Ee+=", even if this card is covered"),l=Ee+".";break}if(a.useCardFromPreviousEffect){let Ee=`${ue} that card`;((q=n.destinationRestriction)==null?void 0:q.type)==="to_this_lane"?Ee+=" to this line":((B=n.destinationRestriction)==null?void 0:B.type)==="to_another_line"?Ee+=" to another line":((K=n.destinationRestriction)==null?void 0:K.type)==="non_matching_protocol"?Ee+=" to a line without a matching protocol":((U=n.destinationRestriction)==null?void 0:U.type)==="specific_lane"&&(Ee+=" within this line"),l=Ee+".";break}const be=n.count||1,Ae=((R=n.targetFilter)==null?void 0:R.owner)==="own",Ue=((j=n.targetFilter)==null?void 0:j.position)==="covered";if(Ae&&Ue&&be===1){let Ee=`${ue} 1 of your covered cards`;((F=n.destinationRestriction)==null?void 0:F.type)==="non_matching_protocol"?Ee+=" to a line without a matching protocol":((M=n.destinationRestriction)==null?void 0:M.type)==="specific_lane"?Ee+=" within this line":((L=n.destinationRestriction)==null?void 0:L.type)==="to_another_line"&&(Ee+=" to another line"),l=Ee+".";break}if(((D=n.targetFilter)==null?void 0:D.owner)==="own"&&((O=n.targetFilter)==null?void 0:O.position)==="any"&&!((X=n.targetFilter)!=null&&X.excludeSelf)&&be===1){l=`${ue} this card, even if this card is covered`+".";break}if(Ae&&!Ue&&!((ne=n.targetFilter)!=null&&ne.excludeSelf)&&be===1){l=`${ue} 1 of your cards`+".";break}let Pe="";const tt=((z=n.targetFilter)==null?void 0:z.owner)==="opponent",Ye=(G=n.targetFilter)==null?void 0:G.excludeSelf,Fe=((Z=n.targetFilter)==null?void 0:Z.position)==="any";Ae&&Ye?Pe+="of your other ":tt?Pe+="of your opponent's ":Ye&&(Pe+="other "),Fe?Pe+="covered or uncovered ":((Q=n.targetFilter)==null?void 0:Q.position)==="covered"&&(Pe+="covered "),((I=n.targetFilter)==null?void 0:I.faceState)==="face_down"&&(Pe+="face-down "),((W=n.targetFilter)==null?void 0:W.faceState)==="face_up"&&(Pe+="face-up ");const ot=n.count==="all"?"all":"1";let xe=`${ue} ${ot} ${Pe}${Ae&&Ye||tt?"cards":ot==="1"?"card":"cards"}`;n.scope==="this_lane"&&(xe+=" in this line"),((Y=n.destinationRestriction)==null?void 0:Y.type)==="non_matching_protocol"?xe+=" to a line without a matching protocol":((de=n.destinationRestriction)==null?void 0:de.type)==="specific_lane"?xe+=" within this line":((ee=n.destinationRestriction)==null?void 0:ee.type)==="to_another_line"?xe+=" to another line":((ge=n.destinationRestriction)==null?void 0:ge.type)==="to_this_lane"?xe+=" to this line":((Se=n.destinationRestriction)==null?void 0:Se.type)==="to_or_from_this_lane"&&(xe+=" either to or from this line"),l=xe+".";break}case"delete":{if(((ye=n.advancedConditional)==null?void 0:ye.type)==="empty_hand"){const tt=n.count||1;l=`If you have no cards in hand, delete ${tt} card${tt!==1?"s":""}.`;break}if(((Ne=n.advancedConditional)==null?void 0:Ne.type)==="opponent_higher_value_in_lane"){const tt=n.count||1;l=`If your opponent has a higher total value than you do in this line, delete ${tt} card${tt!==1?"s":""}.`;break}if(a.useCardFromPreviousEffect){l="Delete that card.";break}if(n.deleteSelf){l="Delete this card.";break}if(((Le=n.laneCondition)==null?void 0:Le.type)==="opponent_higher_value"){const tt=n.count||1,Ye=((Je=n.targetFilter)==null?void 0:Je.owner)==="opponent"?"of your opponent's ":"";l=`Delete ${tt} ${Ye}${tt===1?"card":"cards"} in a line where they have a higher total value than you do.`;break}let ue="Delete ";const be=((at=n.targetFilter)==null?void 0:at.position)==="any",Ae=((we=n.targetFilter)==null?void 0:we.calculation)==="highest_value"||((Ce=n.targetFilter)==null?void 0:Ce.calculation)==="lowest_value",Ue=((Ie=n.targetFilter)==null?void 0:Ie.owner)==="own"||((ze=n.targetFilter)==null?void 0:ze.owner)==="opponent",De=n.count===1&&Ae&&Ue;if(n.count==="all_in_lane"?ue+="all ":De||(ue+=be?"a ":`${n.count} `),De&&(((wt=n.targetFilter)==null?void 0:wt.owner)==="own"?ue+="your ":((Qe=n.targetFilter)==null?void 0:Qe.owner)==="opponent"&&(ue+="opponent's ")),((Mt=n.targetFilter)==null?void 0:Mt.calculation)==="highest_value"?ue+="highest value ":((rn=n.targetFilter)==null?void 0:rn.calculation)==="lowest_value"&&(ue+="lowest value "),(Hn=n.targetFilter)!=null&&Hn.valueRange){const{min:tt,max:Ye}=n.targetFilter.valueRange,Fe=[];for(let Zt=tt;Zt<=Ye;Zt++)Fe.push(Zt);const ot=Fe.join(" or ");ue+=`value ${ot} `}De||(((ga=n.targetFilter)==null?void 0:ga.owner)==="own"?ue+="your ":((qn=n.targetFilter)==null?void 0:qn.owner)==="opponent"&&(ue+="opponent's ")),n.excludeSelf&&(ue+="other "),be?ue+="covered or uncovered ":(($t=n.targetFilter)==null?void 0:$t.position)==="covered"&&(ue+="covered "),((Xt=n.targetFilter)==null?void 0:Xt.faceState)==="face_down"?ue+="face-down ":((At=n.targetFilter)==null?void 0:At.faceState)==="face_up"&&(ue+="face-up ");const Pe=n.count===1?"card":"cards";ue+=Pe,n.selectLane&&(ue+=" in 1 line"),n.protocolMatching==="must_match"?ue+=" in a line with a matching protocol":n.protocolMatching==="must_not_match"&&(ue+=" in a line without a matching protocol"),((va=n.scope)==null?void 0:va.type)==="this_line"?ue+=" in this line":((Fo=n.scope)==null?void 0:Fo.type)==="other_lanes"?ue+=" in other lanes":((eo=n.scope)==null?void 0:eo.type)==="each_other_line"&&(ue+=" from each other line"),l=ue+".";break}case"discard":{if(n.useCardFromPreviousEffect){n.actor==="opponent"?l="Opponent discards that card.":l="discard that card.";break}if(n.countType==="equal_to_discarded"){const Ue=n.countOffset||0;n.actor==="opponent"?Ue===1?l="Your opponent discards the amount of cards discarded plus 1.":Ue===0?l="Your opponent discards the same amount of cards.":l=`Your opponent discards the amount discarded plus ${Ue}.`:Ue===1?l="Discard 1 more card than the amount discarded.":Ue===0?l="Discard the same amount of cards.":l=`Discard the amount discarded plus ${Ue}.`;break}const ue=n.variableCount;let be="";if(ue)be="1 or more cards";else if(n.count==="all")be="your hand";else{const Ue=n.count===1?"card":"cards";be=`${n.count} ${Ue}`}const Ae=n.optional?"You may discard":n.count==="all"||ue?"Discard":"You discard";if(n.actor==="opponent")if(n.count==="all")l="Opponent discards their hand.";else if(n.random){const Ue=n.count===1?"card":"cards";l=`Your opponent discards ${n.count} random ${Ue}.`}else l=`Your opponent discards ${be}.`;else l=`${Ae} ${be}.`;break}case"return":{if(((Xn=n.advancedConditional)==null?void 0:Xn.type)==="empty_hand"){const Fe=n.count||1;l=`If you have no cards in hand, return ${Fe} card${Fe!==1?"s":""}.`;break}if((($n=n.advancedConditional)==null?void 0:$n.type)==="opponent_higher_value_in_lane"){const Fe=n.count||1;l=`If your opponent has a higher total value than you do in this line, return ${Fe} card${Fe!==1?"s":""}.`;break}if(a.useCardFromPreviousEffect){l="Return that card to hand.";break}const be=n.selectLane||!1?" in 1 line":"";if(((Ut=n.targetFilter)==null?void 0:Ut.valueEquals)!==void 0){l=`Return all cards with a value of ${n.targetFilter.valueEquals}${be}.`;break}const Ae=((ln=n.targetFilter)==null?void 0:ln.owner)||"any",Ue=((zn=n.targetFilter)==null?void 0:zn.position)||"uncovered";let De="";Ue==="any"?De="covered or uncovered ":Ue==="covered"&&(De="covered ");const Pe=n.count==="all"?`all ${De}cards`:n.count===1?`1 ${De}card`:`${n.count} ${De}cards`;let tt="";Ae==="own"?tt=" of your":Ae==="opponent"&&(tt=" of your opponent's"),l=`${n.optional?"You may r":"R"}eturn ${Pe}${tt}${be}.`;break}case"play":{if(((qo=n.advancedConditional)==null?void 0:qo.type)==="empty_hand"){const Fe=n.count||1;l=`If you have no cards in hand, play ${Fe} card${Fe!==1?"s":""}.`;break}if(((to=n.advancedConditional)==null?void 0:to.type)==="opponent_higher_value_in_lane"){const Fe=n.count||1;l=`If your opponent has a higher total value than you do in this line, play ${Fe} card${Fe!==1?"s":""}.`;break}if(a.useCardFromPreviousEffect){const Fe=n.faceDown===!0?"face-down":n.faceDown===!1?"face-up":"";l=Fe?`Play that card ${Fe}.`:"Play that card.";break}const ue=n.actor,be=n.count||1,Ae=n.faceDown===!0?" face-down":n.faceDown===!1?" face-up":"";let Ue="",De="";const Pe=((no=n.valueFilter)==null?void 0:no.equals)!==void 0?` with a value of ${n.valueFilter.equals}`:"";ue==="opponent"?(Ue="Your opponent plays",n.source==="deck"?De=be===1?"the top card of their deck":`${be} cards from their deck`:De=be===1?`a card${Pe} from their hand`:`${be} cards${Pe} from their hand`):(Ue="Play",n.source==="deck"?De=be===1?"the top card of your deck":`${be} cards from your deck`:De=be===1?`1 card${Pe}`:`${be} cards${Pe}`);let tt="";((_a=n.condition)==null?void 0:_a.type)==="per_x_cards_in_line"&&(tt=`For every ${n.condition.cardCount||2} cards in this line, `,Ue=Ue.toLowerCase());let Ye=`${tt}${Ue} ${De}${Ae}`;if(((Un=n.destinationRule)==null?void 0:Un.type)==="other_lines")Ye+=" to other lines";else if(((xa=n.destinationRule)==null?void 0:xa.type)==="another_line")Ye+=" in another line";else if(((ao=n.destinationRule)==null?void 0:ao.type)==="each_other_line")Ye+=" in each other line";else if(((oo=n.destinationRule)==null?void 0:oo.type)==="under_this_card")Ye+=" under this card";else if(((wa=n.destinationRule)==null?void 0:wa.type)==="each_line_with_card"){const Fe=n.destinationRule.ownerFilter,ot=n.destinationRule.cardFilter;(ot==null?void 0:ot.faceState)==="face_down"?Ye+=" in each line with a face-down card":(ot==null?void 0:ot.faceState)==="face_up"?Ye+=" in each line with a face-up card":Fe==="own"?Ye+=" in each line where you have a card":Fe==="opponent"?Ye+=" in each line where opponent has a card":Ye+=" to each line with a card"}else if(((Ca=n.destinationRule)==null?void 0:Ca.type)==="line_with_matching_cards"){const Fe=n.destinationRule.cardFilter;(Fe==null?void 0:Fe.faceState)==="face_down"?Ye+=" in a line with a face-down card":(Fe==null?void 0:Fe.faceState)==="face_up"?Ye+=" in a line with a face-up card":Ye+=" in a line with a card"}else((ro=n.destinationRule)==null?void 0:ro.type)==="specific_lane"&&(Ye+=" in this line");l=Ye+".";break}case"rearrange_protocols":case"swap_protocols":{const ue=n.target==="opponent"?"your opponent's":n.target==="both_sequential"?"both players'":"your";let be="";n.action==="rearrange_protocols"?be=`Rearrange ${ue} protocols`:be=`Swap the positions of 2 of ${ue} protocols`,n.restriction&&n.restriction.disallowedProtocol&&(be+=`. ${n.restriction.disallowedProtocol} cannot be on this line`),l=be+".";break}case"reveal":case"give":{if(a.useCardFromPreviousEffect){l=`${n.action==="give"?"Give":"Reveal"} that card.`;break}if(n.action,n.source==="board"){const tt=((lo=n.targetFilter)==null?void 0:lo.faceState)==="face_down"?"face-down ":"",Ye=n.count||1;let ot=`Reveal ${Ye} ${tt}${Ye===1?"card":"cards"}`;n.optional?ot+=". You may shift or flip that card":n.followUpAction==="flip"?ot+=". Then flip it":n.followUpAction==="shift"&&(ot+=". Then shift it"),l=ot+".";break}if(n.source==="own_deck_top"){let tt="Reveal the top card of your deck";n.followUpAction==="may_discard"&&(tt+=". You may discard it"),l=tt+".";break}if(n.source==="own_deck"){l="Reveal your deck.";break}if(n.count===-1){n.source==="opponent_hand"?l=n.action==="reveal"?"Your opponent reveals their hand.":"Give your entire hand to your opponent.":l=n.action==="reveal"?"Reveal your hand.":"Give your entire hand.";break}const ue=n.count===1?"card":"cards",be=n.source==="opponent_hand"?"opponent's hand":"your hand",Ae=n.optional?"You may ":"",Ue=n.action==="give"?"give":"reveal",De=n.action==="give"?"Give":"Reveal";let Pe;n.optional?Pe=`${Ae}${Ue} ${n.count} ${ue} from ${be}`:Pe=`${De} ${n.count} ${ue} from ${be}`,n.action==="give"&&n.source!=="opponent_hand"&&(Pe+=" to your opponent"),n.followUpAction==="flip"?Pe+=". Then flip it.":n.followUpAction==="shift"?Pe+=". Then shift it.":Pe+=".",l=Pe;break}case"take":{const ue=n.count===1?"card":"cards",be=n.random!==!1?"random ":"";l=`Take ${n.count} ${be}${ue} from your opponent's hand.`;break}case"choice":{const ue=n.options||[];if(ue.length===0){l="Effect";break}if(ue.length===2){const be=ue.map(Ae=>{const Ue={params:Ae.params};let De=_r(Ue);return De.endsWith(".")&&(De=De.slice(0,-1)),De=De.charAt(0).toLowerCase()+De.slice(1),De});l=`Either ${be[0]} or ${be[1]}.`}else l="Effect";break}case"passive_rule":{const ue=n.rule;switch(ue==null?void 0:ue.type){case"require_non_matching_protocol":l="Cards can only be played without matching protocols.";break;case"block_all_play":ue.target==="opponent"?l="Your opponent cannot play cards in this line.":ue.target==="self"?l="You cannot play cards in this line.":l="Cards cannot be played in this line.";break;case"ignore_middle_commands":if(ue.onlyDuringYourTurn&&ue.target==="opponent"&&ue.scope==="global")l="During your turn, your opponent's cards do not have middle commands.";else if(ue.onlyDuringYourTurn){const be=ue.target==="opponent"?"your opponent's ":ue.target==="self"?"your ":"",Ae=ue.scope==="global"?"":" in this line";l=`During your turn, ignore all middle commands of ${be}cards${Ae}.`}else l="Ignore all middle commands of cards in this line.";break;case"block_face_down_play":l="Opponent can't play cards face-down in this line.";break;case"require_face_down_play":l=ue.scope==="global"?"Your opponent can only play cards face-down.":"Opponent can only play cards face-down in this line.";break;case"allow_any_protocol_play":l="You may play cards without matching protocols.";break;case"allow_play_on_opponent_side":l="You may play this card in any line on either player's side.";break;case"block_flips":l=ue.scope==="global"?"Cards cannot be flipped face-up.":"Cards can't be flipped face-up in this line.";break;case"block_protocol_rearrange":l="Protocols can't be rearranged.";break;case"block_shifts_from_lane":l="Cards can't shift from this line.";break;case"block_shifts_to_lane":l="Cards can't shift to this line.";break;case"block_shifts_from_and_to_lane":l="Cards cannot shift from or to this line.";break;case"skip_check_cache_phase":l="Skip check cache phase.";break;case"block_flip_this_card":l="This card cannot be flipped.";break;case"block_draw_conditional":{const be=ue.conditionTarget||"self",Ae=ue.blockTarget||"self",Ue=be==="self"?"you have":"your opponent has";let De;Ae==="self"?De="you cannot draw":Ae==="opponent"?De="your opponent cannot draw":De="neither player can draw",l=`If ${Ue} any cards in hand, ${De} cards.`;break}default:l="Passive rule effect."}break}case"value_modifier":{const ue=n.modifier;switch(ue==null?void 0:ue.type){case"add_per_condition":{const be=ue.scope==="this_lane"?"in this line":"",Ae=ue.target==="own_total"?"Your total value":ue.target==="opponent_total"?"Opponent's total value":"Total value";let Ue="";ue.condition==="per_face_down_card"?Ue="for each face-down card":ue.condition==="per_face_up_card"?Ue="for each face-up card":ue.condition==="per_card"?Ue="for each card":ue.condition==="per_card_in_hand"&&(Ue="for each card in your hand");const De=ue.value>=0?"+":"";l=`${Ae} ${be} is increased by ${De}${ue.value} ${Ue} ${be}.`.replace(/\s+/g," ");break}case"set_to_fixed":{let be="";ue.target==="own_cards"?be="your":ue.target==="opponent_cards"?be="opponent's":be="all";let Ae="";((cn=ue.filter)==null?void 0:cn.faceState)==="face_down"?Ae=" face-down":((St=ue.filter)==null?void 0:St.faceState)==="face_up"&&(Ae=" face-up");let Ue="";ue.scope==="this_lane"&&(Ue=" in this stack"),l=`All ${be}${Ae} cards${Ue} have a value of ${ue.value}.`;break}case"add_to_total":{const be=ue.scope==="this_lane"?" in this line":"";ue.target==="opponent_total"?ue.value<0?l=`Your opponent's total value${be} is reduced by ${Math.abs(ue.value)}.`:l=`Your opponent's total value${be} is increased by ${ue.value}.`:ue.value<0?l=`Your total value${be} is reduced by ${Math.abs(ue.value)}.`:l=`Your total value${be} is increased by ${ue.value}.`;break}default:l="Value modifier effect."}break}case"block_compile":{l=`${n.target==="opponent"?"Your opponent":"You"} cannot compile next turn.`;break}case"delete_all_in_lane":{const ue=((Nt=n.laneCondition)==null?void 0:Nt.count)||8;l=`Delete all cards in ${n.excludeCurrentLane?"1 other line":"1 line"} with ${ue} or more cards.`;break}case"modify_value":{const ue=n.modifier||0,be=n.target==="opponent"?"Your opponent's":"Your",Ae=ue<0?`reduced by ${Math.abs(ue)}`:`increased by ${ue}`;l=`${be} total value in this line is ${Ae}.`;break}case"block_play_face_down":{l="Your opponent cannot play cards face-down in this line.";break}case"shuffle_trash":{l=`${n.optional!==!1?"You may shuffle":"Shuffle"} your trash into your deck.`;break}case"shuffle_deck":{l="Shuffle your deck.";break}case"redirect_return_to_deck":{l=`Put that card on top of their deck ${n.faceDown!==!1?"face-down ":""}instead.`;break}default:l="Effect";break}if(a.conditional&&a.conditional.thenEffect){let ue=_r(a.conditional.thenEffect);const be=a.conditional.thenEffect.params;be!=null&&be.useCardFromPreviousEffect&&(ue=ue.replace(/\d+ cards?/i,"that card")),a.conditional.type==="then"?l=`${l.endsWith(".")?l.slice(0,-1):l}, then ${ue.toLowerCase()}`:a.conditional.type==="optional"?l=`${l.endsWith(".")?l.slice(0,-1):l}. You may ${ue.toLowerCase()}`:l=`${l} If you do, ${ue.toLowerCase()}`}return l},Yv=a=>{const n={};for(const l of a){const s=l.params.action;s==="draw"&&(n.draw=!0),s==="flip"&&(n.flip=!0),s==="shift"&&(n.shift=!0),s==="delete"&&(n.delete=!0),s==="discard"&&(n.discard=!0),s==="return"&&(n.return=!0),s==="play"&&(n.play=!0),s==="reveal"&&(n.reveal=!0),s==="give"&&(n.give=!0),s==="take"&&(n.take=!0)}return n},Ro=a=>a.length===0?"":a.map(n=>{var s;const l=_r(n),c=n.trigger;if(c==="start")return`<div><span class='emphasis'>Start:</span> ${l}</div>`;if(c==="end")return`<div><span class='emphasis'>End:</span> ${l}</div>`;if(c==="on_cover")return`<div><span class='emphasis'>When this card would be covered:</span> First, ${l.toLowerCase()}</div>`;if(c==="on_flip")return`<div><span class='emphasis'>When this card would be flipped:</span> First, ${l.toLowerCase()}</div>`;if(c==="on_cover_or_flip")return`<div><span class='emphasis'>When this card would be covered or flipped:</span> First, ${l.toLowerCase()}</div>`;if(c==="after_draw"||c==="after_delete"||c==="after_discard"||c==="after_shift"||c==="after_flip"||c==="after_clear_cache"){const d=n.reactiveTriggerActor||"self",p=d==="self"?"you":d==="opponent"?"opponent":"a card is";let f="";return c==="after_draw"?f=d==="any"?"drawn":"draw cards":c==="after_delete"?f=d==="any"?"deleted":"delete cards":c==="after_discard"?f=d==="any"?"discarded":"discard cards":c==="after_shift"?f=d==="any"?"shifted":"shift cards":c==="after_flip"?f=d==="any"?"flipped":"flip cards":c==="after_clear_cache"&&(f="clear cache"),`<div><span class='emphasis'>${d==="any"?`After ${p} ${f}`:`After ${p} ${f}`}:</span> ${l}</div>`}if(c==="after_opponent_discard")return`<div><span class='emphasis'>After your opponent discards cards:</span> ${l}</div>`;if(c==="after_play"){const d=n.reactiveTriggerActor||"self",p=n.reactiveScope||"global";return d==="opponent"&&p==="this_lane"?`<div><span class='emphasis'>After your opponent plays a card in this line:</span> ${l}</div>`:d==="opponent"?`<div><span class='emphasis'>After your opponent plays a card:</span> ${l}</div>`:p==="this_lane"?`<div><span class='emphasis'>After you play a card in this line:</span> ${l}</div>`:`<div><span class='emphasis'>After you play a card:</span> ${l}</div>`}return c==="before_compile_delete"?`<div><span class='emphasis'>When this card would be deleted by compiling:</span> ${l}</div>`:c==="when_card_returned"?`<div><span class='emphasis'>When a card would be returned to ${(((s=n.params)==null?void 0:s.targetOwner)||"opponent")==="opponent"?"your opponent's":"your"} hand:</span> ${l}</div>`:l}).join(" "),Gv=(a,n)=>{var h,m,g;const l=((h=a.text)==null?void 0:h.top)!==void 0?a.text.top:Ro(a.topEffects),c=((m=a.text)==null?void 0:m.middle)!==void 0?a.text.middle:Ro(a.middleEffects),s=((g=a.text)==null?void 0:g.bottom)!==void 0?a.text.bottom:Ro(a.bottomEffects),d=[...a.topEffects,...a.middleEffects,...a.bottomEffects],p=Yv(d);return{protocol:n.name,value:a.value,top:l,middle:c,bottom:s,keywords:p,category:n.category||"Custom",color:n.color,pattern:n.pattern,customEffects:{topEffects:a.topEffects,middleEffects:a.middleEffects,bottomEffects:a.bottomEffects}}},Wv=a=>a.cards.map(n=>Gv(n,a)),Ja=()=>{try{const a=localStorage.getItem("custom_protocols_v1");if(!a)return[];const l=JSON.parse(a).protocols||[],c=[];for(const s of l){const d=Wv(s);c.push(...d)}return c}catch(a){return console.error("Failed to load custom protocol cards:",a),[]}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const zh="custom_protocols_v1",md=1,Do=()=>{try{const a=localStorage.getItem(zh);if(!a)return[];const n=JSON.parse(a);return n.version!==md&&console.warn(`Custom protocol storage version mismatch: expected ${md}, got ${n.version}`),n.protocols||[]}catch(a){return console.error("Error loading custom protocols:",a),[]}},Ed=a=>{try{const n={protocols:a,version:md};localStorage.setItem(zh,JSON.stringify(n))}catch(n){console.error("Error saving custom protocols:",n)}},mt=a=>{const n=Do(),l=n.findIndex(c=>c.id===a.id);l>=0?n[l]=a:n.push(a),Ed(n)},Qv=a=>{const l=Do().filter(c=>c.id!==a);Ed(l)},Xv=["anarchy-custom-001","apathy_custom","chaos_custom_1","clarity-custom-001","corruption-custom-001","courage-custom-001","darkness_custom_v1","death_custom_v1","fear_custom","fire-custom-001","frost_custom_1","gravity_custom_1","hate-custom-001","ice_custom","life_custom_1","light_custom_1","love_custom_v1","metal_custom_1","plague-custom-001","psychic_custom_v1","smoke-custom-001","speed_custom_1","spirit_custom_1","water_custom_1"],wr=a=>Xv.includes(a.id),Zv=(a,n)=>{const l=(s,d)=>{s=s.replace("#","");const p=parseInt(s.substring(0,2),16),f=parseInt(s.substring(2,4),16),h=parseInt(s.substring(4,6),16);return`rgba(${p}, ${f}, ${h}, ${d})`},c={borderColor:n};switch(a){case"solid":return{...c,backgroundColor:n};case"radial":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`radial-gradient(circle at 50% 50%, ${l(n,.25)} 0%, transparent 60%)`};case"dual-radial":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 0% 0%, ${l(n,.2)}, transparent 50%),
                    radial-gradient(at 100% 100%, ${l(n,.2)}, transparent 50%)
                `};case"multi-radial":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 0%, ${l(n,.2)}, transparent 70%),
                    radial-gradient(circle at 20% 30%, ${l(n,.15)}, transparent 40%),
                    radial-gradient(circle at 80% 70%, ${l(n,.2)}, transparent 50%)
                `};case"chaos":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 10% 10%, hsla(60, 100%, 50%, 0.15), transparent 30%),
                    radial-gradient(at 90% 20%, hsla(180, 100%, 50%, 0.15), transparent 35%),
                    radial-gradient(at 30% 80%, hsla(300, 100%, 50%, 0.15), transparent 40%),
                    radial-gradient(at 70% 60%, hsla(0, 100%, 50%, 0.1), transparent 25%)
                `};case"grid":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(circle at 50% 50%, ${l(n,.2)} 0%, transparent 40%),
                    linear-gradient(hsla(0,0%,100%,0.03) 1px, transparent 1px),
                    linear-gradient(90deg, hsla(0,0%,100%,0.03) 1px, transparent 1px)
                `,backgroundSize:"100% 100%, 20px 20px, 20px 20px"};case"diagonal-lines":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 0% 100%, ${l(n,.25)}, transparent 70%),
                    repeating-linear-gradient(120deg, transparent, transparent 15px, ${l(n,.05)} 15px, ${l(n,.05)} 30px)
                `};case"cross-diagonal":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 50%, ${l(n,.25)} 0%, transparent 50%),
                    repeating-linear-gradient(45deg, transparent, transparent 8px, ${l(n,.08)} 8px, ${l(n,.08)} 16px),
                    repeating-linear-gradient(-45deg, transparent, transparent 8px, ${l(n,.06)} 8px, ${l(n,.06)} 16px)
                `};case"horizontal-lines":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 80% 80%, ${l(n,.1)}, transparent 50%),
                    repeating-linear-gradient(0deg, hsla(0,0%,100%,0.02), hsla(0,0%,100%,0.02) 1px, transparent 1px, transparent 3px)
                `};case"vertical-lines":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 10% 10%, ${l(n,.2)}, transparent 50%),
                    repeating-linear-gradient(175deg, transparent, transparent 1px, ${l(n,.05)} 1px, ${l(n,.05)} 2px)
                `};case"cross":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    linear-gradient(0deg, transparent 40%, ${l(n,.1)} 50%, transparent 60%),
                    linear-gradient(90deg, transparent 48%, ${l(n,.2)} 50%, transparent 52%)
                `};case"hexagons":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 0%, ${l(n,.2)}, transparent 70%),
                    url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='28' height='49' viewBox='0 0 28 49'%3E%3Cg fill-rule='evenodd'%3E%3Cg id='hexagons' fill='${encodeURIComponent(n)}' fill-opacity='0.05' fill-rule='nonzero'%3E%3Cpath d='M13.99 9.25l13 7.5v15l-13 7.5L1 31.75v-15l12.99-7.5zM3 17.9v12.7l10.99 6.34 11-6.35V17.9l-11-6.34L3 17.9zM0 15l12.99-7.5L26 15v18.5l-13 7.5L0 33.5V15z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")
                `};case"stripes":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 100%, ${l(n,.25)}, transparent 60%),
                    linear-gradient(135deg, hsla(0,0%,0%,0.1) 23%, transparent 23%, transparent 25%, hsla(0,0%,0%,0.1) 25%, hsla(0,0%,0%,0.1) 27%, transparent 27%, transparent 73%, hsla(0,0%,0%,0.1) 73%, hsla(0,0%,0%,0.1) 75%, transparent 75%, transparent 77%, hsla(0,0%,0%,0.1) 77%)
                `};default:return{...c,backgroundColor:n}}},Kv=({protocols:a,onCreateNew:n,onEdit:l,onDelete:c,onImport:s,onBack:d})=>{const[p,f]=re.useState(!1),[h,m]=re.useState(!1),[g,y]=re.useState(""),[w,_]=re.useState(""),b=p?a:a.filter(S=>!wr(S)),k=()=>{_("");try{const S=JSON.parse(g);if(!S.name||!S.color||!S.pattern||!Array.isArray(S.cards)){_("Invalid protocol format. Missing required fields.");return}if(S.cards.length!==6){_("Invalid protocol: must have exactly 6 cards.");return}const $=a.find(E=>E.name.toLowerCase()===S.name.toLowerCase());if($){confirm(`A protocol named "${S.name}" already exists. Overwrite it?`)&&(S.id=$.id,s(S),m(!1),y(""),alert("Protocol imported and overwritten successfully!"));return}S.id=Date.now().toString(),S.createdAt=new Date().toISOString(),s(S),m(!1),y(""),alert("Protocol imported successfully!")}catch{_("Invalid JSON format. Please check your input.")}};return r.jsxs("div",{className:"protocol-list",children:[r.jsxs("div",{className:"list-header",children:[r.jsx("h2",{children:"Custom Protocols"}),r.jsxs("div",{className:"header-actions",children:[r.jsxs("label",{className:"system-protocols-toggle",children:[r.jsx("input",{type:"checkbox",checked:p,onChange:S=>f(S.target.checked)}),"Show System Protocols"]}),r.jsx("button",{onClick:()=>m(!0),className:"btn",children:"Import Protocol"}),d&&r.jsx("button",{onClick:d,className:"btn btn-back",children:"Back"})]})]}),h&&r.jsx("div",{className:"custom-protocol-modal-overlay",onClick:()=>m(!1),children:r.jsxs("div",{className:"custom-protocol-modal-content",onClick:S=>S.stopPropagation(),children:[r.jsx("h3",{children:"Import Protocol"}),r.jsx("p",{children:"Paste the protocol JSON below:"}),r.jsx("textarea",{value:g,onChange:S=>y(S.target.value),placeholder:'{"name":"Protocol Name","color":"#1976D2",...}',rows:10,className:"import-textarea"}),w&&r.jsx("div",{className:"error-message",children:w}),r.jsxs("div",{className:"custom-protocol-modal-actions",children:[r.jsx("button",{onClick:()=>m(!1),className:"btn btn-back",children:"Cancel"}),r.jsx("button",{onClick:k,className:"btn",children:"Import"})]})]})}),r.jsxs("div",{className:"protocols-grid",children:[r.jsxs("div",{className:"protocol-card new-protocol-card",onClick:n,children:[r.jsx("div",{className:"protocol-header new-protocol-header",children:r.jsxs("div",{className:"protocol-header-content",children:[r.jsx("h3",{children:"+ New Protocol"}),r.jsx("p",{className:"header-description",children:"Create a custom protocol"})]})}),r.jsx("div",{className:"protocol-body new-protocol-body"})]}),b.map(S=>{const $=wr(S);return r.jsx("div",{className:`protocol-card ${$?"system-protocol":""}`,style:Zv(S.pattern,S.color),onClick:()=>l(S),children:r.jsxs("div",{className:"protocol-header-content",children:[r.jsx("h3",{children:S.name}),$&&r.jsx("span",{className:"system-badge",children:"System"}),S.description&&r.jsx("p",{className:"header-description",children:S.description})]})},S.id)})]})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Vh="customProtocolsEnabled";function jd(){try{return localStorage.getItem(Vh)==="true"}catch{return!1}}function Jv(a){try{localStorage.setItem(Vh,a?"true":"false")}catch{}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */let Bi=null;function e_(){if(!Bi){const a=jd(),n=Ja(),l=Do(),c=new Set(l.filter(s=>wr(s)).map(s=>s.name));Bi=n.filter(s=>c.has(s.protocol)||a)}return Bi}function El(){Bi=null}function fa(a){const n=e_(),l=[];for(const c of a){const s=n.filter(d=>d.protocol===c);l.push(...s)}return l}function yn(a){const n=[...a];for(let l=n.length-1;l>0;l--){const c=Math.floor(Math.random()*(l+1));[n[l],n[c]]=[n[c],n[l]]}return n}function gh({onNavigate:a,difficulty:n,setDifficulty:l,useControl:c,onUseControlChange:s}){const[d,p]=re.useState(null),[f,h]=re.useState(null),[m,g]=re.useState(null),[y,w]=re.useState([]),[_,b]=re.useState(!0),[k,S]=re.useState(0);re.useEffect(()=>{const E=new Set;for(;E.size<2&&E.size<gn.length;)E.add(Math.floor(Math.random()*gn.length));const C=Array.from(E).map(N=>gn[N]);C.length>0&&(g(C[0]),h(C[0])),C.length>1&&p(C[1]),w(yn(gn))},[]);const $=()=>{const E=k+1;if(S(E),E>=5){const C=!_;b(C),Jv(C),S(0)}};return r.jsxs("div",{className:"screen main-menu",children:[r.jsx("h1",{children:"COMPILE: MAIN 1"}),r.jsxs("div",{className:"main-menu-attribution",children:[r.jsxs("p",{children:["based on the card game ",r.jsx("a",{href:"https://boardgamegeek.com/boardgame/406652/compile-main-1",target:"_blank",rel:"noopener noreferrer",children:"Compile: Main 1"})," designed by ",r.jsx("a",{href:"https://justgravyllc.com/",target:"_blank",rel:"noopener noreferrer",children:"Michael Yang"})]}),r.jsxs("p",{children:[r.jsx("span",{onClick:$,style:{cursor:"default",userSelect:"none"},children:"developed"})," by ",r.jsx("a",{href:"https://apo-games.de/",target:"_blank",rel:"noopener noreferrer",children:"Dirk Aporius"})]})]}),r.jsxs("div",{className:"main-menu-layout",children:[r.jsx("div",{className:"main-menu-preview decorative-card",children:f&&r.jsx(vt,{card:{...f,id:"preview",isFaceUp:!0},isFaceUp:!0})}),r.jsxs("div",{className:"main-menu-actions-container",children:[r.jsxs("div",{className:"main-menu-start-group",children:[r.jsxs("div",{className:"difficulty-selector",children:[r.jsx("h3",{className:"difficulty-title",children:"Difficulty"}),r.jsxs("div",{className:"difficulty-options",children:[r.jsx("button",{className:`btn ${n==="easy"?"active":""}`,onClick:()=>l("easy"),children:"Easy"}),r.jsx("button",{className:`btn ${n==="normal"?"active":""}`,onClick:()=>l("normal"),children:"Normal"}),r.jsx("button",{className:`btn btn-wip ${n==="hard"?"active":""}`,disabled:!0,children:"Hard"})]})]}),r.jsxs("div",{className:"control-mechanic-selector",children:[r.jsx("input",{type:"checkbox",id:"control-mechanic",checked:c,onChange:E=>s(E.target.checked)}),r.jsx("label",{htmlFor:"control-mechanic",children:"Use Control Mechanic"})]}),r.jsx("button",{className:"btn btn-start",onClick:()=>a("ProtocolSelection"),children:"Start Game"})]}),r.jsxs("div",{className:"main-menu-other-actions",children:[r.jsx("button",{className:"btn",onClick:()=>a("CardLibrary"),children:"Cards"}),r.jsx("button",{className:"btn",onClick:()=>a("Statistics"),children:"Statistics"}),_&&r.jsx("button",{className:"btn",onClick:()=>a("CustomProtocols"),children:"Custom Protocols"}),r.jsx("button",{className:"btn",onClick:()=>a("Rules"),children:"Rules"}),r.jsx("p",{className:"version-info",children:"Version 0.26"})]})]}),r.jsx("div",{className:"decorative-card decorative-card-right",children:d&&r.jsx(vt,{card:{...d,id:"deco-2",isFaceUp:!0},isFaceUp:!0})})]}),r.jsx("div",{className:"card-ticker-container",onPointerLeave:()=>h(m),children:r.jsxs("div",{className:"card-ticker-track",children:[y.map((E,C)=>r.jsx(vt,{card:{...E,id:`ticker-1-${C}`,isFaceUp:!0},isFaceUp:!0,additionalClassName:"in-hand",onPointerEnter:()=>h(E)},`ticker-1-${C}`)),y.map((E,C)=>r.jsx(vt,{card:{...E,id:`ticker-2-${C}`,isFaceUp:!0},isFaceUp:!0,additionalClassName:"in-hand",onPointerEnter:()=>h(E)},`ticker-2-${C}`))]})})]})}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function Zi({title:a,onBack:n}){return r.jsxs("header",{className:"app-header",children:[r.jsx("h2",{children:a}),n&&r.jsx("button",{className:"btn btn-back",onClick:n,children:"Back"})]})}const Pi=[{player:"Player",picks:1},{player:"Opponent",picks:2},{player:"Player",picks:2},{player:"Opponent",picks:1}];function t_({onBack:a,onStartGame:n}){const[l,c]=re.useState(0),[s,d]=re.useState([]),[p,f]=re.useState([]),[h,m]=re.useState([]),[g,y]=re.useState(!1),[w,_]=re.useState(null),[b,k]=re.useState(null),[S,$]=re.useState(0);re.useEffect(()=>{El(),$(I=>I+1)},[]);const E=re.useMemo(()=>{const I=jd(),W=Ja(),Y=Do(),de=new Set(Y.filter(ge=>wr(ge)).map(ge=>ge.name)),ee=W.filter(ge=>de.has(ge.protocol)||I);return console.log("[Protocol Selection] Total cards loaded:",ee.length,"(custom enabled:",I,")"),ee},[S]),C=re.useMemo(()=>{const I=new Set(E.map(Y=>Y.protocol)),W=Array.from(I).sort();return console.log("[Protocol Selection] Unique protocols:",W),W},[E]),N=re.useMemo(()=>{const I=new Set(E.map(W=>W.category));return Array.from(I).sort()},[E]),T=["Fan-Content","Main 2"],[H,q]=re.useState(new Set),[B,K]=re.useState(!1);re.useEffect(()=>{if(N.length>0&&!B){const I=new Set(N);T.forEach(W=>I.delete(W)),q(I),K(!0)}},[N,B]);const U=I=>{const W=E.find(Y=>Y.protocol===I);return(W==null?void 0:W.category)||""},R=I=>{const Y=E.find(de=>de.protocol===I);return Y!=null&&Y.color?{"--card-custom-color":Y.color,borderColor:Y.color}:{}},j=I=>{const Y=E.find(de=>de.protocol===I);return Y!=null&&Y.pattern?`pattern-${Y.pattern}`:""},F=re.useMemo(()=>C.filter(I=>{const W=U(I);return H.has(W)}),[H]),M=I=>{q(W=>{const Y=new Set(W);return Y.has(I)?Y.delete(I):Y.add(I),Y})},L=Pi[l],D=(L==null?void 0:L.player)==="Player",O=(L==null?void 0:L.player)==="Opponent",X=re.useMemo(()=>new Set([...s,...p]),[s,p]),ne=re.useMemo(()=>h.map(I=>({name:I,cards:E.filter(W=>W.protocol===I).sort((W,Y)=>W.value-Y.value)})),[h]),z=I=>{if(!D||g)return;const W=E.filter(Y=>Y.protocol===I).sort((Y,de)=>Y.value-de.value);W.length>0&&k(W[0]),m(Y=>{if(Y.includes(I))return Y.filter(de=>de!==I);if(Y.length<L.picks)return[...Y,I];if(Y.length===L.picks){const de=Y.slice(1);return de.push(I),de}return Y})},G=async()=>{if(!D||g||h.length!==L.picks)return;y(!0);const I=[...h];m([]);for(const W of I)d(Y=>[...Y,W]),await new Promise(Y=>setTimeout(Y,300));y(!1),c(W=>W+1)};re.useEffect(()=>{O&&!g&&l<Pi.length&&(async()=>{y(!0),await new Promise(ye=>setTimeout(ye,100));const W=[],Y=C.filter(ye=>{if(X.has(ye))return!1;const Ne=U(ye);return H.has(Ne)}),de=C.filter(ye=>!X.has(ye)),ee=Y.length>=L.picks?[...Y]:[...de],ge=[],Se=W.filter(ye=>ee.includes(ye));for(let ye=0;ye<L.picks;ye++)if(Se.length>0){const Ne=Se.shift();ge.push(Ne);const Le=ee.indexOf(Ne);Le>-1&&ee.splice(Le,1)}else if(ee.length>0){const Ne=Math.floor(Math.random()*ee.length);ge.push(ee.splice(Ne,1)[0])}for(const ye of ge)await new Promise(Ne=>setTimeout(Ne,1e3)),_(ye),await new Promise(Ne=>setTimeout(Ne,1e3)),_(null),f(Ne=>[...Ne,ye]);y(!1),c(ye=>ye+1)})()},[l,O,g,X,L,H,C,U]),re.useEffect(()=>{l>=Pi.length&&!g&&setTimeout(()=>{n(s,p)},1e3)},[l,g,n,s,p]);const Z=I=>{const W=["protocol-card",`card-protocol-${I.toLowerCase()}`];return h.includes(I)&&W.push("selected"),X.has(I)&&W.push("chosen"),w===I&&W.push("is-scanning"),W.join(" ")},Q=()=>g&&O?"Opponent is selecting protocols...":(L==null?void 0:L.player)==="Player"?`Player, select ${L.picks} protocol(s). (${h.length}/${L.picks})`:l>=Pi.length?"Finalizing selections...":"Waiting for Opponent...";return r.jsxs("div",{className:"screen protocol-selection-screen",children:[r.jsx(Zi,{title:"Protocol Selection",onBack:a}),r.jsxs("div",{className:"protocol-selection-layout",children:[r.jsxs("div",{className:"protocol-selection-sidebar",children:[r.jsxs("div",{className:"player-protocols-area",children:[r.jsx("h3",{children:"Your Protocols"}),s.map(I=>r.jsx("div",{className:`protocol-display-card player card-protocol-${I.toLowerCase()} ${j(I)}`,style:R(I),children:I},I))]}),r.jsx("div",{className:"protocol-preview-area",children:b?r.jsx(vt,{card:{...b,id:"preview",isFaceUp:!0},isFaceUp:!0}):r.jsx("p",{children:ne.length>0?"Hover over a card below to see details.":"Select a protocol to see its cards."})})]}),r.jsxs("div",{className:"protocol-grid-container",children:[r.jsx("p",{children:Q()}),r.jsx("div",{className:"category-filters",children:N.map(I=>r.jsxs("label",{className:"category-filter-item",children:[r.jsx("input",{type:"checkbox",checked:H.has(I),onChange:()=>M(I)}),r.jsx("span",{children:I})]},I))}),r.jsx("div",{className:"protocol-grid-scroll-wrapper",children:r.jsx("div",{className:"protocol-grid",children:F.map(I=>{const W=R(I),de={fontSize:I.length>10?"0.65em":"1em"};return r.jsxs("div",{className:`${Z(I)} ${j(I)}`,style:W,onClick:()=>z(I),role:"button","aria-disabled":X.has(I)||!D||g,tabIndex:!X.has(I)&&D&&!g?0:-1,onKeyPress:ee=>ee.key==="Enter"&&z(I),children:[r.jsx("span",{className:"protocol-category-label",children:U(I)}),r.jsx("span",{className:"protocol-name",style:de,children:I})]},I)})})}),D&&r.jsx("button",{className:"btn",onClick:G,disabled:g||h.length!==(L==null?void 0:L.picks),children:"Confirm Selection"})]}),r.jsxs("div",{className:"opponent-protocols-area",children:[r.jsx("h3",{children:"Opponent Protocols"}),p.map(I=>r.jsx("div",{className:`protocol-display-card opponent card-protocol-${I.toLowerCase()} ${j(I)}`,style:R(I),children:I},I))]})]}),r.jsx("div",{className:"selected-protocol-cards-container",children:ne.length>0&&[...ne].reverse().map(I=>r.jsx("div",{className:"protocol-card-row",children:I.cards.map(W=>r.jsx(vt,{card:{...W,id:`selection-${W.protocol}-${W.value}`,isFaceUp:!0},isFaceUp:!0,additionalClassName:"in-hand",onClick:()=>k(W),onPointerEnter:()=>k(W)},`${I.name}-${W.value}`))},I.name))})]})}const n_="modulepreload",a_=function(a){return"/"+a},vh={},o_=function(n,l,c){let s=Promise.resolve();if(l&&l.length>0){let p=function(m){return Promise.all(m.map(g=>Promise.resolve(g).then(y=>({status:"fulfilled",value:y}),y=>({status:"rejected",reason:y}))))};document.getElementsByTagName("link");const f=document.querySelector("meta[property=csp-nonce]"),h=(f==null?void 0:f.nonce)||(f==null?void 0:f.getAttribute("nonce"));s=p(l.map(m=>{if(m=a_(m),m in vh)return;vh[m]=!0;const g=m.endsWith(".css"),y=g?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${m}"]${y}`))return;const w=document.createElement("link");if(w.rel=g?"stylesheet":n_,g||(w.as="script"),w.crossOrigin="",w.href=m,h&&w.setAttribute("nonce",h),document.head.appendChild(w),g)return new Promise((_,b)=>{w.addEventListener("load",_),w.addEventListener("error",()=>b(new Error(`Unable to preload CSS for ${m}`)))})}))}function d(p){const f=new Event("vite:preloadError",{cancelable:!0});if(f.payload=p,window.dispatchEvent(f),!f.defaultPrevented)throw p}return s.then(p=>{for(const f of p||[])f.status==="rejected"&&d(f.reason);return n().catch(d)})},Vt=[];for(let a=0;a<256;++a)Vt.push((a+256).toString(16).slice(1));function r_(a,n=0){return(Vt[a[n+0]]+Vt[a[n+1]]+Vt[a[n+2]]+Vt[a[n+3]]+"-"+Vt[a[n+4]]+Vt[a[n+5]]+"-"+Vt[a[n+6]]+Vt[a[n+7]]+"-"+Vt[a[n+8]]+Vt[a[n+9]]+"-"+Vt[a[n+10]]+Vt[a[n+11]]+Vt[a[n+12]]+Vt[a[n+13]]+Vt[a[n+14]]+Vt[a[n+15]]).toLowerCase()}let dd;const l_=new Uint8Array(16);function i_(){if(!dd){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");dd=crypto.getRandomValues.bind(crypto)}return dd(l_)}const c_=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),_h={randomUUID:c_};function Be(a,n,l){var s;if(_h.randomUUID&&!a)return _h.randomUUID();a=a||{};const c=a.random??((s=a.rng)==null?void 0:s.call(a))??i_();if(c.length<16)throw new Error("Random bytes length must be >= 16");return c[6]=c[6]&15|64,c[8]=c[8]&63|128,r_(c)}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const ae=(a,n,l,c)=>{let s=a._logIndentLevel||0;a._currentPhaseContext&&s===0&&(s=1);const d={player:n,message:l,indentLevel:s,sourceCard:a._currentEffectSource,phase:a._currentPhaseContext,sourceCardRef:c==null?void 0:c.sourceCardRef,targetCardRefs:c==null?void 0:c.targetCardRefs};return{...a,log:[...a.log,d]}},Nn=a=>({...a,_logIndentLevel:(a._logIndentLevel||0)+1}),ma=a=>({...a,_logIndentLevel:Math.max(0,(a._logIndentLevel||0)-1)}),Me=(a,n)=>({...a,_currentEffectSource:n}),et=(a,n)=>({...a,_currentPhaseContext:n});/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function on(a){const n=[];for(const l of["player","opponent"])a[l].lanes.forEach((c,s)=>{c.forEach((d,p)=>{if(d.isFaceUp){const f=d;if(f.customEffects){const h=p===c.length-1;(f.customEffects.topEffects||[]).forEach(y=>{y.params.action==="passive_rule"&&y.trigger==="passive"&&n.push({rule:y.params.rule,cardOwner:l,laneIndex:s,sourceCardId:d.id})}),(f.customEffects.middleEffects||[]).forEach(y=>{y.params.action==="passive_rule"&&y.trigger==="passive"&&n.push({rule:y.params.rule,cardOwner:l,laneIndex:s,sourceCardId:d.id})}),h&&(f.customEffects.bottomEffects||[]).forEach(w=>{w.params.action==="passive_rule"&&w.trigger==="passive"&&n.push({rule:w.params.rule,cardOwner:l,laneIndex:s,sourceCardId:d.id})})}d.protocol==="Frost"&&d.value===1&&(n.push({rule:{type:"block_flips",target:"all",scope:"global"},cardOwner:l,laneIndex:s}),p===c.length-1&&n.push({rule:{type:"block_protocol_rearrange",target:"all",scope:"global"},cardOwner:l,laneIndex:s})),d.protocol==="Frost"&&d.value===3&&n.push({rule:{type:"block_shifts_from_and_to_lane",target:"all",scope:"this_lane"},cardOwner:l,laneIndex:s})}})});return n}function ha(a,n,l,c,s){const d=on(a),p=n==="player"?"opponent":"player",f=a[n].protocols[l],h=a[p].protocols[l],m=s===f||s===h;for(const{rule:w,cardOwner:_,laneIndex:b}of d){const k=w.scope==="global"||b===l,S=w.target==="all"||w.target==="self"&&_===n||w.target==="opponent"&&_===p;if(!(!k||!S))switch(w.type){case"block_all_play":return{allowed:!1,reason:"Cannot play cards in this lane (passive rule)"};case"block_face_down_play":if(!c)return{allowed:!1,reason:"Cannot play cards face-down in this lane (passive rule)"};break;case"block_face_up_play":if(c)return{allowed:!1,reason:"Cannot play cards face-up in this lane (passive rule)"};break;case"require_face_down_play":if(c)return{allowed:!1,reason:"Can only play cards face-down (passive rule)"};break;case"allow_any_protocol_play":break;case"require_non_matching_protocol":if(c&&m)return{allowed:!1,reason:"Can only play cards without matching protocols (passive rule)"};break}}const g=d.some(({rule:w,cardOwner:_,laneIndex:b})=>{if(w.type!=="allow_any_protocol_play")return!1;const k=w.scope==="global"||b===l,S=w.target==="all"||w.target==="self"&&_===n||w.target==="opponent"&&_===p;return k&&S}),y=d.some(({rule:w,cardOwner:_,laneIndex:b})=>{if(w.type!=="require_non_matching_protocol")return!1;const k=w.scope==="global"||b===l,S=w.target==="all"||w.target==="self"&&_===n||w.target==="opponent"&&_===p;return k&&S});return c&&!m&&!g&&!y?{allowed:!1,reason:"Face-up play requires matching protocol"}:{allowed:!0}}function Ki(a){return on(a).some(({rule:l})=>l.type==="require_non_matching_protocol"&&l.scope==="global")}function Ji(a,n,l){const c=on(a),s=n==="player"?"opponent":"player";return c.some(({rule:d,cardOwner:p,laneIndex:f})=>{if(d.type!=="allow_any_protocol_play")return!1;const h=d.scope==="global"||l!==void 0&&f===l,m=d.target==="all"||d.target==="self"&&p===n||d.target==="opponent"&&p===s;return h&&m})}function Rl(a,n){const l=n.customEffects;return l?(l.bottomEffects||[]).some(s=>{var d,p,f;return((d=s.params)==null?void 0:d.action)!=="passive_rule"?!1:((f=(p=s.params)==null?void 0:p.rule)==null?void 0:f.type)==="allow_play_on_opponent_side"}):!1}function s_(a,n){const l=on(a);for(const{rule:c,laneIndex:s}of l)if(!(c.type!=="block_flips"||!(c.scope==="global"||s===n)))return{allowed:!1,reason:"Cards cannot be flipped face-up in this lane (passive rule)"};return{allowed:!0}}function Al(a,n,l){const c=on(a);for(const{rule:s,laneIndex:d}of c){if(s.type==="block_shifts_from_lane"&&d===n)return s.scope,{allowed:!1,reason:"Cards cannot shift from this lane (passive rule)"};if(s.type==="block_shifts_to_lane"&&d===l)return s.scope,{allowed:!1,reason:"Cards cannot shift to this lane (passive rule)"};if(s.type==="block_shifts_from_and_to_lane"&&(d===n||d===l))return{allowed:!1,reason:"Cards cannot shift from or to this lane (passive rule)"}}return{allowed:!0}}function d_(a){const n=on(a);for(const{rule:l}of n)if(l.type==="block_protocol_rearrange")return{allowed:!1,reason:"Protocols cannot be rearranged (passive rule)"};return{allowed:!0}}function u_(a,n,l){const c=on(a),s=a.currentPlayer;return c.some(({rule:d,cardOwner:p,laneIndex:f})=>{if(d.type!=="ignore_middle_commands"||!(d.scope==="global"||f===n)||d.onlyDuringYourTurn&&s!==p)return!1;if(l!==void 0){const m=p==="player"?"opponent":"player";if(d.target==="opponent"&&l!==m||d.target==="self"&&l!==p)return!1}return!0})}function Qn(a){return on(a).some(({rule:l})=>l.type==="block_flips"&&l.scope==="global")}function p_(a){return on(a).some(({rule:l})=>l.type==="block_protocol_rearrange")}function jl(a,n){const l=on(a);for(const{rule:c,sourceCardId:s}of l)if(c.type==="block_flip_this_card"&&s===n)return{allowed:!1,reason:"This card cannot be flipped (passive rule)"};return{allowed:!0}}function kd(a,n){const l=on(a);for(const{rule:c,cardOwner:s}of l)if(c.type==="block_draw_conditional"){const p=(c.conditionTarget||"self")==="self"?s:s==="player"?"opponent":"player",f=c.blockTarget||"self";let h;if(f==="self"?h=s:f==="opponent"?h=s==="player"?"opponent":"player":h="all",a[p].hand.length>0&&(h==="all"||h===n))return{allowed:!1,reason:"Cannot draw cards (passive rule)"}}return{allowed:!0}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const f_={},h_={},m_={},y_={};function Dl(a,n,l,c){const{cardOwner:s,opponent:d,triggerType:p}=c,f=l[s].lanes[n];if(!f.find(_=>_.id===a.id))return{newState:l};if(!(f.length>0&&f[f.length-1].id===a.id))return{newState:l};if(u_(l,n,s))return{newState:l};const g=a;if(g.customEffects&&g.customEffects.middleEffects&&g.customEffects.middleEffects.length>0){let _=l;(p==="middle"||p==="play")&&(_=Nn(_));const b=`${a.protocol}-${a.value}`;_=Me(_,b),_=et(_,"middle");let k=_;const S=k._pendingCustomEffects;if(S&&S.sourceCardId!==a.id){const E=k.lastCustomEffectTargetCardId,C={type:"execute_remaining_custom_effects",sourceCardId:S.sourceCardId,laneIndex:S.laneIndex,effects:S.effects,context:S.context,actor:S.context.cardOwner,selectedCardFromPreviousEffect:E||S.selectedCardFromPreviousEffect};k={...k,queuedActions:[...k.queuedActions||[],C]},delete k._pendingCustomEffects}k.lastCustomEffectTargetCardId&&(k={...k,lastCustomEffectTargetCardId:null});for(let E=0;E<g.customEffects.middleEffects.length;E++){const C=g.customEffects.middleEffects[E],N=g.customEffects.middleEffects.slice(E+1);if(N.length>0&&(k._pendingCustomEffects={sourceCardId:a.id,laneIndex:n,context:c,effects:N}),k=lt(a,n,k,c,C).newState,k.actionRequired)return{newState:_e(k)};k._pendingCustomEffects&&delete k._pendingCustomEffects}return{newState:_e(k)}}const y=`${a.protocol}-${a.value}`,w=f_[y];if(w){let _=l;(p==="middle"||p==="play")&&(_=Nn(_));const b=`${a.protocol}-${a.value}`;_=Me(_,b),_=et(_,"middle");const k=w(a,n,_,c);let S=k.newState;const $=_e(S);return{...k,newState:$}}return{newState:l}}function Rd(a,n,l,c){if(!a.isFaceUp)return{newState:l};const s=a;if(s.customEffects){const h=[...s.customEffects.topEffects||[],...s.customEffects.middleEffects||[],...s.customEffects.bottomEffects||[]].filter(m=>m.trigger==="on_cover"||m.trigger==="on_cover_or_flip");if(h.length>0){const m=`${a.protocol}-${a.value}`;let g=Me(l,m);g=et(g,void 0);let y=g;const w=[];for(const k of h){const S=lt(a,n,y,c,k);if(y=S.newState,S.animationRequests&&w.push(...S.animationRequests),y.actionRequired){let $=Nn(y);return{newState:_e($),animationRequests:w.length>0?w:void 0}}}let _=Nn(y);return{newState:_e(_),animationRequests:w.length>0?w:void 0}}}const d=`${a.protocol}-${a.value}`,p=y_[d];if(p){const f=`${a.protocol}-${a.value}`;let h=Me(l,f);h=et(h,void 0);const m=p(a,n,h,c);let g=Nn(m.newState);const y=_e(g);return{...m,newState:y}}return{newState:l}}function g_(a,n,l){const c=[],s=new Set,d=l==="Start"?"start":"end";return a[n].lanes.flat().forEach(p=>{var h;if(!p.isFaceUp||s.has(p.id))return;const f=p;if((h=f.customEffects)!=null&&h.topEffects){const m=f.customEffects.topEffects.filter(g=>g.trigger===d);m.length>0&&(c.push({cardId:p.id,box:"top",effectIds:m.map(g=>g.id)}),s.add(p.id))}p.top.includes(`'emphasis'>${l}:`)&&(s.has(p.id)||(c.push({cardId:p.id,box:"top",effectIds:[]}),s.add(p.id)))}),a[n].lanes.forEach(p=>{var m;if(p.length===0)return;const f=p[p.length-1];if(!f.isFaceUp||s.has(f.id))return;const h=f;if((m=h.customEffects)!=null&&m.bottomEffects){const g=h.customEffects.bottomEffects.filter(y=>y.trigger===d);g.length>0&&(c.push({cardId:f.id,box:"bottom",effectIds:g.map(y=>y.id)}),s.add(f.id))}f.bottom.includes(`'emphasis'>${l}:`)&&(s.has(f.id)||(c.push({cardId:f.id,box:"bottom",effectIds:[]}),s.add(f.id)))}),c}function v_(a,n,l){for(let c=0;c<a[n].lanes.length;c++){const s=a[n].lanes[c],d=s.find(p=>p.id===l.cardId);if(d)return!d.isFaceUp||l.box==="bottom"&&!(s.length>0&&s[s.length-1].id===d.id)?null:{card:d,laneIndex:c}}return null}function __(a,n,l){const c=a,s=l==="Start"?"start":"end";if(c.customEffects){const f=n==="top"?c.customEffects.topEffects:c.customEffects.bottomEffects,h=(f==null?void 0:f.filter(m=>m.trigger===s))||[];if(h.length>0)return h.map(g=>{var _,b;const y=((_=g.params)==null?void 0:_.action)||"effect",w=(b=g.params)==null?void 0:b.count;return w?`${y} ${w}`:y}).join(", ")}const p=(n==="top"?a.top:a.bottom).match(new RegExp(`${l}:\\s*</span>\\s*([^<]+)`,"i"));return p?p[1].trim():l+" effect"}function Gi(a,n,l){const c=a.turn;let s={...a,_logIndentLevel:0};const d=n==="Start",p=d?"_startPhaseEffectSnapshot":"_endPhaseEffectSnapshot",f=d?"_selectedStartEffectId":"_selectedEndEffectId",h=s[f];let m=s[p];m&&m.length>0&&(m.some(q=>s[c].lanes.flat().some(B=>B.id===q.cardId))||(m=void 0,s[p]=void 0)),m||(m=g_(s,c,n),s[p]=m);const g=d?s.processedStartEffectIds||[]:s.processedEndEffectIds||[],y=[];for(const H of m){if(g.includes(H.cardId))continue;const B=v_(s,c,H);B&&y.push({entry:H,card:B.card,laneIndex:B.laneIndex})}if(y.length===0)return s[p]=void 0,s[f]=void 0,{newState:s};let w;if(h&&(w=y.find(H=>H.entry.cardId===h),w||console.warn(`[processTriggeredEffects] Selected effect ${h} not found in valid effects!`),s[f]=void 0),!w){if(y.length>1){const H=y.map(({entry:q,card:B})=>({cardId:q.cardId,cardName:`${B.protocol}-${B.value}`,box:q.box,effectDescription:__(B,q.box,n)}));return s.actionRequired={type:"select_phase_effect",actor:c,phase:n,availableEffects:H},{newState:s}}w=y[0]}const{entry:_,card:b,laneIndex:k}=w,S=c==="player"?"opponent":"player",$={cardOwner:c,actor:c,currentTurn:a.turn,opponent:S,triggerType:n==="Start"?"start":"end"},E=b,C=n==="Start"?"start":"end";if(E.customEffects){const H=_.box==="top"?E.customEffects.topEffects:E.customEffects.bottomEffects,q=(H==null?void 0:H.filter(B=>B.trigger===C))||[];if(q.length>0){const B=`${b.protocol}-${b.value}`,K=n==="Start"?"start":"end";s=Me(s,B),s=et(s,K);const U={...s,_currentPhaseContext:void 0},R=ae(U,c,`${n} effect triggers.`);s={...s,log:R.log},s=Nn(s);for(let j=0;j<q.length;j++){const F=q[j],M=lt(b,k,s,$,F);if(s=_e(M.newState),s.actionRequired){const L=q.slice(j+1);return L.length>0&&(s._pendingCustomEffects={sourceCardId:b.id,laneIndex:k,context:$,effects:L}),d?s.processedStartEffectIds=[...s.processedStartEffectIds||[],b.id]:s.processedEndEffectIds=[...s.processedEndEffectIds||[],b.id],{newState:s}}}return d?s.processedStartEffectIds=[...s.processedStartEffectIds||[],b.id]:s.processedEndEffectIds=[...s.processedEndEffectIds||[],b.id],s=ma(s),s=Me(s,void 0),s=et(s,void 0),Gi(s,n,l)}}const N=`${b.protocol}-${b.value}`,T=l[N];if(T){const H=`${b.protocol}-${b.value}`,q=n==="Start"?"start":"end";s=Me(s,H),s=et(s,q);const B={...s,_currentPhaseContext:void 0},K=ae(B,c,`${n} effect triggers.`);s={...s,log:K.log},s=Nn(s);const U=T(b,s,$);return s=_e(U.newState),d?s.processedStartEffectIds=[...s.processedStartEffectIds||[],b.id]:s.processedEndEffectIds=[...s.processedEndEffectIds||[],b.id],s.actionRequired?{newState:s}:(s=ma(s),s=Me(s,void 0),s=et(s,void 0),Gi(s,n,l))}return{newState:s}}function Ad(a){return Gi(a,"Start",h_)}function Bh(a){return Gi(a,"End",m_)}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const x_=a=>{if(!a.useControlMechanic)return a;const n=a.turn,l=n==="player"?"opponent":"player",c=a[n],s=a[l];let d=0;const p=c.laneValues[0],f=c.laneValues[1],h=c.laneValues[2],m=s.laneValues[0],g=s.laneValues[1],y=s.laneValues[2];if(p>m&&d++,f>g&&d++,h>y&&d++,d>=2&&a.controlCardHolder!==n){let w=Me(a,void 0);return w=et(w,void 0),w={...w,_logIndentLevel:0},w=ae(w,n,`${n==="player"?"Player":"Opponent"} gains the Control Component.`),{...w,controlCardHolder:n}}return a},Cr=a=>{if(a.winner)return a;const n=a.turn;let l={...a};switch(l=Me(l,void 0),l=et(l,void 0),l={...l,_logIndentLevel:0},a.phase){case"start":return l=Ad(l).newState,l.actionRequired?l:(l=Me(l,void 0),l=et(l,void 0),l={...l,_logIndentLevel:0},l._startPhaseEffectSnapshot=void 0,{...l,phase:"control"});case"control":{const c=x_(l);let s=Me(c,void 0);return s=et(s,void 0),s={...s,_logIndentLevel:0},{...s,phase:"compile"}}case"compile":{const c=Zh(l,n);return c.length>0?{...l,compilableLanes:c}:(l=Me(l,void 0),l=et(l,void 0),l={...l,_logIndentLevel:0},{...l,phase:"action",compilableLanes:[]})}case"action":return l=Me(l,void 0),l=et(l,void 0),l={...l,_logIndentLevel:0},{...l,phase:"hand_limit"};case"hand_limit":{const c=l[n],s=c.lanes.some(f=>f.length>0&&f[f.length-1].isFaceUp&&f[f.length-1].protocol==="Spirit"&&f[f.length-1].value===0),p=on(l).some(({rule:f,cardOwner:h})=>f.type==="skip_check_cache_phase"&&(f.target==="self"&&h===n||f.target==="all")&&h===n);if(s||p){let f=ae(l,n,"Skipping Check Cache phase.");return f=Me(f,void 0),f=et(f,void 0),f={...f,_logIndentLevel:0},{...f,phase:"end"}}if(c.hand.length>5){const f=c.hand.length-5;let m=ae(l,n,`Check Cache: ${n==="player"?"Player":"Opponent"} has ${c.hand.length} cards, must discard ${f}.`);return m=Nn(m),{...m,actionRequired:{type:"discard",actor:n,count:f}}}return l=Me(l,void 0),l=et(l,void 0),l={...l,_logIndentLevel:0},{...l,phase:"end"}}case"end":{const c={...l};l=Bh(l).newState;const s=c.actionRequired,d=l.actionRequired;if(d&&d!==s||l.queuedActions&&l.queuedActions.length>0&&(l=br(l),l.actionRequired))return l;const p=n==="player"?"opponent":"player",f={...l[n],cannotCompile:!1};return l=Me(l,void 0),l=et(l,void 0),l={...l,_logIndentLevel:0},l=_e(l),{...l,[n]:f,turn:p,phase:"start",processedStartEffectIds:[],processedEndEffectIds:[],processedSpeed1TriggerThisTurn:!1,processedUncoverEventIds:[],_startPhaseEffectSnapshot:void 0,_endPhaseEffectSnapshot:void 0,_interruptedTurn:void 0,_interruptedPhase:void 0}}}return a};function We(a){var p;const n=a._pendingCustomEffects;if(!n||n.effects.length===0)return a;const l=n.effects.map(f=>f.id).join(",");if((p=a.queuedActions)==null?void 0:p.some(f=>{var h;return f.type==="execute_remaining_custom_effects"&&f.sourceCardId===n.sourceCardId&&((h=f.effects)==null?void 0:h.map(m=>m.id).join(","))===l})){const f={...a};return delete f._pendingCustomEffects,f}const s={type:"execute_remaining_custom_effects",sourceCardId:n.sourceCardId,laneIndex:n.laneIndex,effects:n.effects,context:n.context,actor:n.context.cardOwner,selectedCardFromPreviousEffect:n.selectedCardFromPreviousEffect},d={...a,queuedActions:[...a.queuedActions||[],s]};return delete d._pendingCustomEffects,d}const ya=a=>{let n=We(a);if(!n.queuedActions||n.queuedActions.length===0)return n;let l=[...n.queuedActions];for(;l.length>0;){const c=l.shift();if(c.sourceCardId&&c.type!=="flip_self"){const s=ve(n,c.sourceCardId);if(!s||!s.card.isFaceUp){const d=s?`${s.card.protocol}-${s.card.value}`:"a card",p=n._logSource;n=Me(n,d),n=ae(n,c.actor,"Queued effect was cancelled because the source is no longer active."),n=Me(n,p);continue}}if(c.type==="flip_self"){const{sourceCardId:s,actor:d}=c,p=ve(n,s),f=Xa(n,s);if(p&&p.card.isFaceUp&&f){const h=`${p.card.protocol}-${p.card.value}`;n=ae(n,d,`${h}: Flips itself.`),n=To(new Set([s]),n),n.animationState={type:"flipCard",cardId:s}}else{const h=p?`${p.card.protocol}-${p.card.value}`:"the source card",m=p?p.card.isFaceUp?"now covered":"flipped face-down":"deleted";n=ae(n,d,`The self-flip effect from ${h} was cancelled because it is ${m}.`)}continue}if(c.type==="execute_follow_up_effect"){const{sourceCardId:s,followUpEffect:d,actor:p,logContext:f}=c,h=ve(n,s),m=Xa(n,s);if(h&&h.card.isFaceUp&&m){const g=n[h.owner].lanes.find(S=>S.some($=>$.id===s)),y=n[h.owner].lanes.indexOf(g),w={cardOwner:h.owner,actor:p,currentTurn:n.turn,opponent:h.owner==="player"?"opponent":"player"},_=(f==null?void 0:f.sourceCardName)||`${h.card.protocol}-${h.card.value}`,b=(f==null?void 0:f.phase)||(n.phase==="start"?"start":"end");if(n={...n,_logIndentLevel:(f==null?void 0:f.indentLevel)||1,_currentEffectSource:_,_currentPhaseContext:b},n=lt(h.card,y,n,w,d).newState,n.actionRequired)return n={...n,queuedActions:l},n}else{const g=h?`${h.card.protocol}-${h.card.value}`:"the source card",y=h?h.card.isFaceUp?"now covered":"flipped face-down":"deleted";n=ae(n,p,`The follow-up effect from ${g} was cancelled because it is ${y}.`)}continue}if(c.type==="execute_conditional_followup"){const{sourceCardId:s,laneIndex:d,followUpEffect:p,context:f,actor:h}=c,m=[...n.player.lanes.flat(),...n.opponent.lanes.flat()].find(y=>y.id===s);if(!m){n=ae(n,h,"Conditional follow-up effect skipped: source card no longer exists.");continue}if(!m.isFaceUp){const y=`${m.protocol}-${m.value}`;n=ae(n,h,`Conditional follow-up effect from ${y} cancelled: card was flipped face-down.`);continue}const g=lt(m,d,n,f,p);if(n=_e(g.newState),n.actionRequired)return p.conditional&&p.conditional.thenEffect&&(n.actionRequired={...n.actionRequired,followUpEffect:p.conditional.thenEffect,conditionalType:p.conditional.type}),n={...n,queuedActions:l},n;if(p.conditional&&p.conditional.thenEffect){const y=lt(m,d,n,f,p.conditional.thenEffect);if(n=_e(y.newState),n.actionRequired)return n={...n,queuedActions:l},n}continue}if(c.type==="execute_remaining_custom_effects"){const{sourceCardId:s,laneIndex:d,effects:p,context:f,selectedCardFromPreviousEffect:h}=c,m=ve(n,s);if(!m){n=ae(n,f.cardOwner,"Remaining effects cancelled because the source card was deleted or returned.");continue}if(!m.card.isFaceUp){const y=`${m.card.protocol}-${m.card.value}`;n=ae(n,f.cardOwner,`Remaining effects from ${y} cancelled because it was flipped face-down.`);continue}if(!w_(n,s)){const y=`${m.card.protocol}-${m.card.value}`;n=ae(n,f.cardOwner,`Remaining effects from ${y} cancelled because it is now covered.`);continue}h&&(n._selectedCardFromPreviousEffect=h,n.lastCustomEffectTargetCardId=h);for(let y=0;y<p.length;y++){const w=p[y],_=lt(m.card,d,n,f,w);if(n=_.newState,_.animationRequests&&_.animationRequests.length>0&&!n.actionRequired){const b=p.slice(y+1);if(b.length>0){const S={type:"execute_remaining_custom_effects",sourceCardId:s,laneIndex:d,effects:b,context:f,actor:f.cardOwner};n.queuedActions=[S,...l||[]]}else n.queuedActions=l;const k=_.animationRequests[0];return k.type==="draw"?n.animationState={type:"drawCard",owner:k.player,cardIds:[]}:k.type==="play"?n.animationState={type:"playCard",cardId:k.cardId,owner:k.owner}:k.type==="delete"&&(n.animationState={type:"deleteCard",cardId:k.cardId,owner:k.owner}),n}if(n.actionRequired){const b=p.slice(y+1);if(b.length>0&&(n._pendingCustomEffects={sourceCardId:s,laneIndex:d,context:f,effects:b}),n._interruptedTurn){const k=n._interruptedTurn,S=n._interruptedPhase||n.phase;delete n._interruptedTurn,delete n._interruptedPhase,n.turn=k,n.phase=S}return n.queuedActions=l,n}}continue}if(c.type==="reveal_opponent_hand"){const s=n.turn==="player"?"opponent":"player",d={...n[s]};if(d.hand.length>0){d.hand=d.hand.map(h=>({...h,isRevealed:!0})),n[s]=d;const p=ve(n,c.sourceCardId),f=p?`${p.card.protocol}-${p.card.value}`:"A card effect";n=ae(n,n.turn,`${f}: Opponent reveals their hand.`)}else{const p=ve(n,c.sourceCardId),f=p?`${p.card.protocol}-${p.card.value}`:"A card effect";n=ae(n,n.turn,`${f}: Opponent has no cards to reveal.`)}continue}if(c.type==="pending_uncover_effect"){const{owner:s,laneIndex:d}=c;if(n=vn(n,s,d).newState,n.actionRequired)return n.queuedActions=l,n;continue}return n.actionRequired=c,n.queuedActions=l,n}return{...n,queuedActions:[],actionRequired:null}},br=a=>{var s;if(a.winner||a.actionRequired)return a;if(a.queuedActions&&a.queuedActions.length>0){const d=ya(a);if(d.actionRequired)return d;a=d}if(a._interruptedTurn){const d=a._interruptedTurn,p=a._interruptedPhase||a.phase;let f={...a};if(delete f._interruptedTurn,delete f._interruptedPhase,f.turn=d,f.phase=p,p==="start"||p==="end"){if(f.queuedActions&&f.queuedActions.length>0&&(f=ya(f)),!f.actionRequired&&p==="end"){const h=Bh(f).newState;if(h.actionRequired)return h;const m=h.turn==="player"?"opponent":"player",g={...h[h.turn],cannotCompile:!1};let y=Me(h,void 0);return y=et(y,void 0),y={...y,_logIndentLevel:0},y=_e(y),{...y,[h.turn]:g,turn:m,phase:"start",processedStartEffectIds:[],processedEndEffectIds:[],processedSpeed1TriggerThisTurn:!1,processedUncoverEventIds:[],_startPhaseEffectSnapshot:void 0,_endPhaseEffectSnapshot:void 0,_interruptedTurn:void 0,_interruptedPhase:void 0}}if(p==="start"&&!f.actionRequired){const h=Ad(f).newState;if(h.actionRequired)return h;let m={...h,phase:"control"};return xr(m)}return f}a=f}if(((s=a.actionRequired)==null?void 0:s.type)==="prompt_rearrange_protocols"&&a.actionRequired.originalAction){const d=a.actionRequired.originalAction;let p={...a,actionRequired:null,controlCardHolder:null};if(d.type==="compile")return xr(p);if(d.type==="fill_hand"){const f=No(p,p.turn,5-p[p.turn].hand.length);return xr(f)}}if(a.queuedEffect){const{card:d,laneIndex:p}=a.queuedEffect,f={...a,queuedEffect:void 0,_committedCardId:void 0},h=ve(f,d.id);if(h){const{card:m,owner:g}=h,y={cardOwner:g,actor:g,currentTurn:f.turn,opponent:g==="player"?"opponent":"player",triggerType:"play"},{newState:w}=Dl(m,p,f,y);if(w.actionRequired)return w;a=w}else console.warn(`Skipping queued effect for ${d.protocol}-${d.value} as it is no longer on the board.`),a=ae(a,a.turn,`Skipping queued effect for ${d.protocol}-${d.value} as it is no longer on the board.`),a=f}if(a.queuedActions&&a.queuedActions.length>0){let d={...a},p=[...d.queuedActions];for(;p.length>0;){const f=p.shift(),h=f.type==="flip_self";if(f.sourceCardId&&!h){const m=ve(d,f.sourceCardId);if(!m||!m.card.isFaceUp){const g=m?`${m.card.protocol}-${m.card.value}`:"a card",y=d._logSource;d=Me(d,g),d=ae(d,f.actor,"Queued effect was cancelled because the source is no longer active."),d=Me(d,y);continue}}if(h){const{sourceCardId:m,actor:g}=f,y=ve(d,m),w=Xa(d,m);if(y&&y.card.isFaceUp&&w){const _=`${y.card.protocol}-${y.card.value}`;d=ae(d,g,`${_}: Flips itself.`),d=To(new Set([m]),d),d.animationState={type:"flipCard",cardId:m}}else{const _=y?`${y.card.protocol}-${y.card.value}`:"the source card",b=y?y.card.isFaceUp?"now covered":"flipped face-down":"deleted";d=ae(d,g,`The self-flip effect from ${_} was cancelled because it is ${b}.`)}continue}if(f.type==="reveal_opponent_hand"){const m=d.turn==="player"?"opponent":"player",g={...d[m]};if(g.hand.length>0){g.hand=g.hand.map(_=>({..._,isRevealed:!0})),d[m]=g;const y=ve(d,f.sourceCardId),w=y?`${y.card.protocol}-${y.card.value}`:"A card effect";d=ae(d,d.turn,`${w}: Opponent reveals their hand.`)}else{const y=ve(d,f.sourceCardId),w=y?`${y.card.protocol}-${y.card.value}`:"A card effect";d=ae(d,d.turn,`${w}: Opponent has no cards to reveal.`)}continue}return d.actionRequired=f,d.queuedActions=p,d}a={...d,queuedActions:[],actionRequired:null}}const n=a.phase==="action"?"hand_limit":a.phase;let l={...a,phase:n,compilableLanes:[],processedUncoverEventIds:[]};const c=a.turn;for(;l.turn===c&&!l.winner;){const d=l.actionRequired,p=l.phase;l=Cr(l);const f=l.actionRequired;if(f&&f!==d)break;if(l.phase===p&&l.turn===c){console.error("Game is stuck in a phase loop:",l.phase);break}}return l},xr=a=>{if(a.winner)return a;let n={...a};if(n._interruptedTurn){const c=n._interruptedTurn,s=n._interruptedPhase||n.phase;delete n._interruptedTurn,delete n._interruptedPhase,n.turn=c,n.phase=s}const l=n.turn;for(;n.turn===l&&!n.actionRequired&&!n.winner;){const c=n.phase;if(c==="action")break;if(c==="compile"){const d=Zh(n,l);if(d.length>0){n={...n,compilableLanes:d};break}}const s=n.phase;if(n=Cr(n),s===n.phase&&!n.actionRequired){console.error("Game is stuck in an automatic phase loop:",s),console.error("State:",{phase:n.phase,turn:n.turn,actionRequired:n.actionRequired,queuedActions:n.queuedActions,interruptedTurn:n._interruptedTurn});break}}return{...n,animationState:null}},Yh=a=>{let n={...a,actionRequired:null};if(n._interruptedTurn)return br(n);if(n.queuedActions&&n.queuedActions.length>0){const s=ya(n);if(s.actionRequired)return s;n=s}const l=Ad(n).newState;if(l.actionRequired)return l;let c=l;return c.phase!=="control"&&(c={...c,phase:"control"}),c=Cr(c),c.actionRequired||(c=Cr(c)),c},Gh=a=>{if(a.winner)return a;let n={...a,phase:"start"};return n=_e(n),n=Cr(n),n.actionRequired?n:xr(n)},xh=Object.freeze(Object.defineProperty({__proto__:null,advancePhase:Cr,continueTurnAfterStartPhaseAction:Yh,continueTurnProgression:xr,processEndOfAction:br,processQueuedActions:ya,processStartOfTurn:Gh,queuePendingCustomEffects:We},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function ve(a,n){if(!n)return null;for(const l of["player","opponent"])for(let c=0;c<a[l].lanes.length;c++){const d=a[l].lanes[c].find(p=>p.id===n);if(d)return{card:d,owner:l,laneIndex:c}}return null}function Xa(a,n){var c;if(!n)return!1;const l=a._committedCardId;for(const s of["player","opponent"])for(const d of a[s].lanes){if(d.length===0)continue;let p=d.length-1;if(l&&d.length>=2&&d[d.length-1].id===l&&(p=d.length-2),((c=d[p])==null?void 0:c.id)===n)return!0}return!1}function w_(a,n){if(!n)return!1;for(const l of["player","opponent"])for(const c of a[l].lanes)if(c.length!==0&&c[c.length-1].id===n)return!0;return!1}function Za(a,n){return n?a._committedCardId===n:!1}function Ka(a,n,l){if(n.length===0||l<0||l>=n.length)return!1;const c=a._committedCardId;let s=n.length-1;return c&&n.length>=2&&n[n.length-1].id===c&&(s=n.length-2),l===s}function C_(a,n,l){var f;let c={...a};const s=(f=a.actionRequired)==null?void 0:f.followUpEffect,d=ve(c,n),p=d?Pn(d.card,c[d.owner].lanes.find(h=>h.some(m=>m.id===n))||[]):0;if(c=We(c),c.actionRequired=null,s&&l){const h=ve(c,l);if(h){const m={cardOwner:h.owner,opponent:h.owner==="player"?"opponent":"player",currentTurn:c.turn,actor:h.owner,referencedCard:d==null?void 0:d.card,referencedCardValue:p};let g=-1;for(let y=0;y<c[h.owner].lanes.length;y++)if(c[h.owner].lanes[y].some(w=>w.id===l)){g=y;break}if(g!==-1)return lt(h.card,g,c,m,s).newState}}return c}function Wh(a,n,l,c){var _,b,k,S,$;let s={...a};const d=(_=a.actionRequired)==null?void 0:_.followUpEffect,p=(b=a.actionRequired)==null?void 0:b.conditionalType;if(s=We(s),s.actionRequired=null,c&&(s=ma(s)),d&&c){const E=ve(s,c);if(E){const C=((k=a.actionRequired)==null?void 0:k.previousHandSize)||0,N=s[n].hand.length,T=Math.max(0,C-N);if(!(p==="then"||p==="if_executed"&&T>0))return s;const q={cardOwner:E.owner,opponent:E.owner==="player"?"opponent":"player",currentTurn:s.turn,actor:n,discardedCount:T,previousHandSize:C};let B=-1;for(let K=0;K<s[E.owner].lanes.length;K++)if(s[E.owner].lanes[K].some(U=>U.id===c)){B=K;break}if(B!==-1)return lt(E.card,B,s,q,d).newState}return s}if(!l||!c)return s;const f=((S=a.actionRequired)==null?void 0:S.previousHandSize)||0,h=s[n].hand.length;if(Math.max(0,f-h)===0)return s;const g=($=ve(s,c))==null?void 0:$.card;g&&`${g.protocol}${g.value}`;const y=s.queuedActions&&s.queuedActions.length>0;let w=null;switch(l){case"fire_1":w={type:"select_cards_to_delete",count:1,sourceCardId:c,disallowedIds:[c],actor:n};break;case"fire_2":w={type:"select_card_to_return",sourceCardId:c,actor:n};break;case"fire_3":w={type:"select_card_to_flip",sourceCardId:c,actor:n,targetFilter:{position:"uncovered",excludeSelf:!0}};break}if(w)if(y){const E=s.queuedActions||[],C=E.filter(T=>T.type==="select_card_to_shift"&&T.followUpEffect),N=E.filter(T=>!(T.type==="select_card_to_shift"&&T.followUpEffect));s.queuedActions=[...N,w,...C]}else s.actionRequired=w;return s}function yd(a,n,l=null){const c=ve(a,n);if(!c)return a;const{card:s,owner:d}=c;if(!s.isFaceUp){let S=-1;for(let $=0;$<a[d].lanes.length;$++)if(a[d].lanes[$].some(E=>E.id===n)){S=$;break}if(S!==-1&&!s_(a,S).allowed)return a}let f=xt(a,"on_flip",{player:d,cardId:n}).newState;if(!ve(f,n))return f;const m=f.actionRequired&&"actor"in f.actionRequired?f.actionRequired.actor:f.turn,g=m==="player"?"Player":"Opponent",y=d==="player"?"Player's":"Opponent's",w=s.isFaceUp?"face-down":"face-up",_=`${s.protocol}-${s.value}`;f=ae(f,m,`${g} flips ${y} ${_} ${w}.`);const b={...f.stats[m],cardsFlipped:f.stats[m].cardsFlipped+1},k={...f[m],stats:b};return f={...f,[m]:k,stats:{...f.stats,[m]:b}},f=To(new Set([n]),f),f.animationState={type:"flipCard",cardId:n},f.actionRequired=l,f}function vn(a,n,l){var p;const c=a[n].lanes[l];if(c.length===0)return{newState:a};const s=c[c.length-1],d=Xa(a,s.id);if(s.isFaceUp&&d){const f=`${s.id}-${l}`;if((p=a.processedUncoverEventIds)!=null&&p.includes(f))return{newState:a};const h=`${s.protocol}-${s.value}`;let m=Me(a,h);m=et(m,"uncover"),m=ae(m,n,`${s.protocol}-${s.value} is uncovered and its effects are re-triggered.`),m=Nn(m),m.processedUncoverEventIds=[...m.processedUncoverEventIds||[],f];const g={cardOwner:n,actor:n,currentTurn:m.turn,opponent:n==="player"?"opponent":"player",triggerType:"uncover"},y=Dl(s,l,m,g);if(y.newState.actionRequired||(y.newState=ma(y.newState),y.newState=Me(y.newState,void 0),y.newState=et(y.newState,void 0)),y.newState.actionRequired){const w=y.newState.actionRequired.actor;if(a._interruptedTurn&&w===a._interruptedTurn){const _=y.newState.actionRequired;return y.newState.actionRequired=null,y.newState.queuedActions=[...y.newState.queuedActions||[],_],y.newState=We(y.newState),y}y.newState=We(y.newState),w!==a.turn&&(y.newState._interruptedTurn=a.turn,y.newState._interruptedPhase=a.phase,y.newState.turn=w,y.newState.actionRequired.type==="prompt_rearrange_protocols"&&(y.newState.actionRequired={...y.newState.actionRequired,originalAction:{type:"resume_interrupted_turn",interruptedTurn:a.turn,interruptedPhase:a.phase}}))}else y.newState._interruptedTurn&&(y.newState.turn=y.newState._interruptedTurn,y.newState._interruptedTurn=void 0);return y}return{newState:a}}function b_(a,n,l){var c,s;for(const d of["player","opponent"])for(const p of a[d].lanes)for(const f of p){if(!f.isFaceUp)continue;const h=f.customEffects;if(!h)continue;const m=h.bottomEffects||[];for(const g of m){if(g.trigger!=="when_card_returned"||((c=g.params)==null?void 0:c.action)!=="redirect_return_to_deck")continue;const y=((s=g.params)==null?void 0:s.targetOwner)||"opponent",w=d;if(y==="opponent"&&n!==w||y==="own"&&n===w)return f}}return null}function gd(a,n){const l=ve(a,n);if(!l)return{newState:a};const{card:c,owner:s}=l,d=a[s].lanes.findIndex(S=>S.some($=>$.id===c.id));if(d===-1)return{newState:a};const p=a[s].lanes[d],f=p.length>0&&p[p.length-1].id===n;let h={...a};const m={...h[s]},g=h.actionRequired&&"actor"in h.actionRequired?h.actionRequired.actor:h.turn,y=g==="player"?"Player":"Opponent",w=s==="player"?"Player's":"Opponent's",_=`${c.protocol}-${c.value}`,b=b_(a,s);if(m.lanes=m.lanes.map(S=>S.filter($=>$.id!==n)),b){const S={...c,isFaceUp:!1,isRevealed:!1};m.deck=[S,...m.deck],h[s]=m;const $=`${b.protocol}-${b.value}`;h=ae(h,g,`${$}: ${w} ${_} is put on top of their deck face-down instead of returning to hand.`)}else m.hand=[...m.hand,{...c,isFaceUp:!0,isRevealed:!1}],h[s]=m,h=ae(h,g,`${y} returns ${w} ${_} to their hand.`);h=We(h),h.actionRequired=null;const k=_e(h);return f&&k[s].lanes[d].length>0?vn(k,s,d):{newState:k}}function Qa(a,n,l,c,s){const d=ve(a,n);if(!d||d.owner!==l)return{newState:a};const{card:p}=d,f=a[l];let h=-1;for(let D=0;D<f.lanes.length;D++)if(f.lanes[D].some(O=>O.id===n)){h=D;break}if(h===-1)return{newState:a};if(h===c)return{newState:a};if(!Al(a,h,c).allowed)return{newState:a};const g=a[l].lanes[h],y=g.length>0&&g[g.length-1].id===n,w=f.lanes.map((D,O)=>O===h?D.filter(X=>X.id!==n):D),_=w[c].length>0?w[c][w[c].length-1]:null;let b={...a,[l]:{...f,lanes:w}};b._committedCardId=n;const k=w.map((D,O)=>O===c?[...D,p]:D),S={...f,lanes:k};let $={...b,[l]:S};(!a._currentEffectSource||!a._currentPhaseContext)&&($=Me($,void 0),$=et($,void 0));const E=s==="player"?"Player":"Opponent",C=l==="player"?"Player's":"Opponent's",N=p.isFaceUp?`${p.protocol}-${p.value}`:"a card",T=$[l].protocols[c];$=ae($,s,`${E} shifts ${C} ${N} to Protocol ${T}.`);const H={...$.stats[s],cardsShifted:$.stats[s].cardsShifted+1},q={...$[s],stats:H};$={...$,[s]:q,stats:{...$.stats,[s]:H}},$=We($),$.actionRequired=null;let B=_e($),K={newState:B};if(_){_.customEffects;const D={cardOwner:l,actor:s,currentTurn:B.turn,opponent:l==="player"?"opponent":"player",triggerType:"cover"};K=Rd(_,c,B,D)}let U=K.newState,R=[...K.animationRequests||[]];if(y){const D=vn(U,l,h);U=D.newState,D.animationRequests&&R.push(...D.animationRequests)}const j=U[l].lanes[c],F=j.length>0&&j[j.length-1].id===n,M=!y;if(F&&p.isFaceUp&&M){const D=vn(U,l,c);D.animationRequests&&R.push(...D.animationRequests);let O=D.newState;return!O.actionRequired&&(!O.queuedActions||O.queuedActions.length===0)&&(O._committedCardId=void 0),{newState:O,animationRequests:R.length>0?R:void 0}}let L=U;return!L.actionRequired&&(!L.queuedActions||L.queuedActions.length===0)&&(L._committedCardId=void 0),{newState:L,animationRequests:R.length>0?R:void 0}}const S_=(a,n,l)=>{let c=0;for(const s of["player","opponent"])for(let d=0;d<a[s].lanes.length;d++){const p=a[s].lanes[d];if(p.length>0){const f=p[p.length-1];n.includes(f.id)||c++}}return c},vd=(a,n)=>{const l=ve(a,n);if(!l)return{newState:a};const{card:c,owner:s}=l,d=a[s].lanes.findIndex(h=>h.some(m=>m.id===c.id));if(d===-1)return{newState:a};const p={cardOwner:s,actor:s,currentTurn:a.turn,opponent:s==="player"?"opponent":"player",triggerType:"flip"},f=Dl(c,d,a,p);if(f.newState.actionRequired){f.newState=We(f.newState);const h=f.newState.actionRequired.actor;if(a._interruptedTurn&&h===a._interruptedTurn)return f.newState.queuedActions=[...f.newState.queuedActions||[],f.newState.actionRequired],f.newState=We(f.newState),f.newState.actionRequired=null,f;h!==a.turn&&(f.newState._interruptedTurn=a.turn,f.newState._interruptedPhase=a.phase,f.newState.turn=h,f.newState.actionRequired.type==="prompt_rearrange_protocols"&&(f.newState.actionRequired={...f.newState.actionRequired,originalAction:{type:"resume_interrupted_turn",interruptedTurn:a.turn,interruptedPhase:a.phase}}))}return f};function E_(a,n){const l=[];if(a[n].lanes.forEach((s,d)=>{if(s.length>0){const p=s[s.length-1],f=Pn(p,s);l.push({card:p,laneIndex:d,owner:n,value:f})}}),l.length===0)return[];const c=Math.max(...l.map(s=>s.value));return l.filter(s=>s.value===c)}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Draw Effect Executor
 *
 * Handles all draw-related effects.
 * Extracted 1:1 from effectInterpreter.ts for modularity.
 */function wh(a,n,l){const c=Math.min(l,a.length),s=a.slice(0,c).map(f=>({...f,id:Be(),isFaceUp:!0})),d=[...n,...s],p=a.slice(c);return{drawnCards:d,remainingDeck:p,newCards:s}}function j_(a,n,l,c,s){var C,N,T,H,q,B,K,U;const{cardOwner:d}=c,f=(s.target||"self")==="opponent"?c.opponent:d,h=kd(l,f);if(!h.allowed)return{newState:ae(l,d,h.reason||"Cannot draw cards.")};if(s.conditional){let R=0;switch(s.conditional.type){case"non_matching_protocols":{for(let G=0;G<3;G++){const Z=l.player.protocols[G],Q=l.opponent.protocols[G],I=l.player.lanes[G].filter(ee=>ee.isFaceUp),W=l.opponent.lanes[G].filter(ee=>ee.isFaceUp);[...I,...W].some(ee=>ee.protocol!==Z&&ee.protocol!==Q)&&R++}break}case"count_face_down":{let G=0;for(const Z of["player","opponent"])for(const Q of l[Z].lanes)G+=Q.filter(I=>!I.isFaceUp).length;R=G;break}case"is_covering":{R=l[d].lanes[n].length>1?s.count||1:0;break}}let j=R;if(j<=0)return{newState:l};const{drawnCards:F,remainingDeck:M,newCards:L}=wh(l[f].deck,l[f].hand,j);let D={...l};D[f]={...D[f],deck:M,hand:F};const O=f==="player"?"Player":"Opponent";let X="";switch(s.conditional.type){case"non_matching_protocols":X=" from non-matching protocols";break;case"is_covering":X=" (this card is covering another)";break;case"count_face_down":X=" (for face-down cards)";break;default:X=""}const ne=L.length>0&&f==="player"?` (${L.map(G=>`${G.protocol}-${G.value}`).join(", ")})`:"";D=ae(D,f,`${O} draws ${j} card${j!==1?"s":""}${X}${ne}.`),j>0&&(D=xt(D,"after_draw",{player:f}).newState);const z=j>0?[{type:"draw",player:f,count:j}]:void 0;return{newState:D,animationRequests:z}}let m=s.count||1;const g=s.countType||"fixed";switch(g){case"equal_to_card_value":{const R=l.lastCustomEffectTargetCardId;if(R){const j=ve(l,R);if(j){const F=j.owner,M=l[F].lanes.find(L=>L.some(D=>D.id===R))||[];m=Pn(j.card,M)}else return m=0,{newState:ae(l,d,"Cannot draw cards - referenced card is no longer on board (was returned/deleted).")}}else m=c.referencedCardValue||0;break}case"equal_to_discarded":m=(c.discardedCount||0)+(s.countOffset||0);break;case"hand_size":case"previous_hand_size":m=c.previousHandSize||c.handSize||0;break;case"count_face_down":{let R=0;for(const j of["player","opponent"])for(const F of l[j].lanes)R+=F.filter(M=>!M.isFaceUp).length;m=R*(s.count||1);break}case"all_matching":{if(((C=s.valueFilter)==null?void 0:C.equals)!==void 0){const R=s.valueFilter.equals;m=l[f].deck.filter(F=>F.value===R).length}else m=0;break}case"fixed":default:m=s.count||1;break}if(m<=0)return{newState:l};if(((N=s.advancedConditional)==null?void 0:N.type)==="protocol_match"){const R=s.advancedConditional.protocol;if(l[d].protocols[n]!==R)return{newState:l}}if(((T=s.advancedConditional)==null?void 0:T.type)==="empty_hand"&&l[f].hand.length>0)return{newState:l};if(((H=s.advancedConditional)==null?void 0:H.type)==="opponent_higher_value_in_lane"){const R=d==="player"?"opponent":"player",j=Fn(l,d,n);if(Fn(l,R,n)<=j)return{newState:l}}let y={...l};if(((q=s.advancedConditional)==null?void 0:q.type)==="compile_block"){const R=s.advancedConditional.turnDuration||1,j=d==="player"?"opponent":"player";y={...y,compileBlockedUntilTurn:(y.turnNumber||0)+R,compileBlockedPlayer:j},y=ae(y,d,`Opponent can't compile for ${R} turn${R!==1?"s":""}.`)}if(s.optional)return y.actionRequired={type:"prompt_optional_draw",sourceCardId:a.id,actor:d,count:m,drawingPlayer:f},{newState:y};const w=s.source||"own_deck",_=w==="opponent_deck"?c.opponent:f;let b,k,S=[];if(g==="all_matching"&&((B=s.valueFilter)==null?void 0:B.equals)!==void 0){const R=s.valueFilter.equals,j=y[_].deck,F=j.filter(L=>L.value===R),M=j.filter(L=>L.value!==R);S=F.map(L=>({...L,id:Be(),isFaceUp:!0})),b=[...y[f].hand,...S],k=M}else if(((K=s.valueFilter)==null?void 0:K.equals)!==void 0&&s.fromRevealed){const R=s.valueFilter.equals,j=y[_].deck,F=j.filter(M=>M.value===R);if(F.length===0){const M=`${a.protocol}-${a.value}`;y=ae(y,f,`${M}: No cards with value ${R} in deck.`)}else return y.actionRequired={type:"select_card_from_revealed_deck",sourceCardId:a.id,actor:f,count:m,valueFilter:R,revealedCards:j,selectableCardIds:F.map(M=>M.id||`deck-${j.indexOf(M)}`)},{newState:y}}else if(((U=s.valueFilter)==null?void 0:U.equals)!==void 0){const R=s.valueFilter.equals,j=[...y[_].deck],F=[];for(let D=0;D<j.length&&F.length<m;D++)j[D].value===R&&F.push(D);const M=F.map(D=>j[D]),L=j.filter((D,O)=>!F.includes(O));S=M.map(D=>({...D,id:Be(),isFaceUp:!0})),b=[...y[f].hand,...S],k=L}else{const R=wh(y[_].deck,y[f].hand,m);b=R.drawnCards,k=R.remainingDeck,S=R.newCards}y[_]={...y[_],deck:k},y[f]={...y[f],hand:b};const $=f==="player"?"Player":"Opponent",E=S.length>0&&f==="player"?` (${S.map(R=>`${R.protocol}-${R.value}`).join(", ")})`:"";if(w==="opponent_deck"){const R=_==="player"?"Player's":"Opponent's";y=ae(y,f,`${$} draws the top ${m===1?"card":`${m} cards`} of ${R} deck${E}.`)}else y=ae(y,f,`${$} draws ${m} card${m!==1?"s":""}${E}.`);return b.length>0&&(y=xt(y,"after_draw",{player:f,count:b.length}).newState),{newState:y}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Flip Effect Executor
 *
 * Handles all flip-related effects.
 * Extracted 1:1 from effectInterpreter.ts for modularity.
 */function k_(a,n,l,c,s){var S,$,E;const{cardOwner:d}=c;if(s.useCardFromPreviousEffect&&l.lastCustomEffectTargetCardId){const C=l.lastCustomEffectTargetCardId,N=ve(l,C);if(!N)return{newState:ae(l,d,"Target card from previous effect no longer exists. Flip skipped.")};let T={...l};const H=N.owner,q=T[H].lanes.findIndex(B=>B.some(K=>K.id===C));if(q!==-1){const K=T[H].lanes[q].find(U=>U.id===C);if(K){K.isFaceUp=!K.isFaceUp;const U=K.isFaceUp?"face-up":"face-down";T=ae(T,d,`Flips that card ${U}.`)}}return{newState:T}}if(s.scope==="each_lane"){const C=s.targetFilter||{},N=Qn(l),T=U=>{const R=l.player.lanes[U],j=l.opponent.lanes[U];let F=[];if(C.position==="covered"?F=[...R.filter((L,D)=>D<R.length-1),...j.filter((L,D)=>D<j.length-1)]:F=[...R,...j],C.owner==="own")F=F.filter(L=>R.includes(L)&&d==="player"||j.includes(L)&&d==="opponent");else if(C.owner==="opponent"){const L=d==="player"?"opponent":"player";F=F.filter(D=>R.includes(D)&&L==="player"||j.includes(D)&&L==="opponent")}return C.excludeSelf&&(F=F.filter(L=>L.id!==a.id)),(N?F.filter(L=>L.isFaceUp):F).length>0},H=[0,1,2].filter(U=>T(U));if(H.length===0){let U=ae(l,d,N?"No valid face-up targets to flip (Frost-1 is active).":"No valid targets to flip in any lane.");return U._effectSkippedNoTargets=!0,{newState:U}}const q=H[0],B=H.slice(1);let K={...l};return K.actionRequired={type:"select_card_to_flip",sourceCardId:a.id,actor:d,currentLaneIndex:q,remainingLanes:B,targetFilter:s.targetFilter,params:s},{newState:K}}if(s.flipSelf){if(((S=s.advancedConditional)==null?void 0:S.type)==="protocol_match"){const H=s.advancedConditional.protocol;if(l[d].protocols[n]!==H)return{newState:l}}if((($=s.advancedConditional)==null?void 0:$.type)==="opponent_higher_value_in_lane"){const H=d==="player"?"opponent":"player",q=Fn(l,d,n);if(Fn(l,H,n)<=q)return{newState:l}}let C={...l};const T=C[d].lanes[n].find(H=>H.id===a.id);if(T){T.isFaceUp=!T.isFaceUp;const H=d==="player"?"Player":"Opponent",q=T.isFaceUp?"face-up":"face-down";C=ae(C,d,`${H} flips this card ${q}.`)}return{newState:C}}const p=s.count||1,f=((E=s.scope)==null?void 0:E.type)||s.scope||"anywhere",h=p==="all"||typeof p!="number",m=f==="this_lane"&&h,g=f==="anywhere"&&h;if(m||g){let C={...l};const N=d==="player"?"opponent":"player",T=s.targetFilter||{},H=Qn(l),q=new Set,B=g?[0,1,2]:[n];for(const K of B){const U=C[d].lanes[K];for(const j of U){if(T.excludeSelf&&j.id===a.id||T.faceState==="face_up"&&!j.isFaceUp||T.faceState==="face_down"&&j.isFaceUp||T.owner==="opponent")continue;const F=U.indexOf(j)===U.length-1;T.position==="uncovered"&&!F||T.position==="covered"&&F||g&&!T.position&&!F||H&&!j.isFaceUp||q.add(j.id)}const R=C[N].lanes[K];for(const j of R){if(T.faceState==="face_up"&&!j.isFaceUp||T.faceState==="face_down"&&j.isFaceUp||T.owner==="own")continue;const F=R.indexOf(j)===R.length-1;T.position==="uncovered"&&!F||T.position==="covered"&&F||g&&!T.position&&!F||H&&!j.isFaceUp||q.add(j.id)}}if(q.size>0){const K=g?"":" in this lane";C=ae(C,d,`Flipping ${q.size} card(s)${K}.`);for(const U of q)for(const R of["player","opponent"])for(const j of C[R].lanes){const F=j.find(M=>M.id===U);F&&(F.isFaceUp=!F.isFaceUp)}return{newState:C}}else return C=ae(C,d,`No cards to flip${g?"":" in this lane"}.`),{newState:C}}const y=s.targetFilter||{},w=y.position||"uncovered",_=Qn(l),b=[];for(const C of["player","opponent"])for(let N=0;N<l[C].lanes.length;N++){const T=l[C].lanes[N];if(!(s.scope==="this_lane"&&N!==n))for(let H=0;H<T.length;H++){const q=T[H];if(Za(l,q.id))continue;const B=Ka(l,T,H);y.excludeSelf&&q.id===a.id||y.owner==="own"&&C!==d||y.owner==="opponent"&&C===d||w==="uncovered"&&!B||w==="covered"&&B||y.faceState==="face_up"&&!q.isFaceUp||y.faceState==="face_down"&&q.isFaceUp||_&&!q.isFaceUp||!jl(l,q.id).allowed||b.push(q.id)}}if(b.length===0){let C=ae(l,d,"No valid cards to flip. Effect skipped.");return C._effectSkippedNoTargets=!0,{newState:C}}let k={...l};return k.actionRequired={type:"select_card_to_flip",count:p,sourceCardId:a.id,actor:d,targetFilter:s.targetFilter,optional:s.optional||!1,scope:s.scope,laneIndex:s.scope==="this_lane"?n:void 0},{newState:k}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Delete Effect Executor
 *
 * Handles all delete-related effects.
 * Extracted 1:1 from effectInterpreter.ts for modularity.
 */function R_(a,n,l,c,s){var S,$,E,C,N,T,H,q,B,K;const{cardOwner:d}=c;let p=s.count||1;if(((S=s.advancedConditional)==null?void 0:S.type)==="empty_hand"&&l[d].hand.length>0)return{newState:l};if((($=s.advancedConditional)==null?void 0:$.type)==="opponent_higher_value_in_lane"){const U=d==="player"?"opponent":"player",R=Fn(l,d,n);if(Fn(l,U,n)<=R)return{newState:l}}if(s.useCardFromPreviousEffect&&l.lastCustomEffectTargetCardId){const U=l.lastCustomEffectTargetCardId,R=ve(l,U);if(!R)return{newState:ae(l,d,"Target card from previous effect no longer exists. Delete skipped.")};let j={...l};const F=R.owner,M=j[F].lanes.findIndex(L=>L.some(D=>D.id===U));if(M!==-1){const L=[...j[F].lanes[M]],D=L.findIndex(O=>O.id===U);if(D!==-1){const O=D===L.length-1;L.splice(D,1);const X=[...j[F].lanes];X[M]=L,j={...j,[F]:{...j[F],lanes:X}};const ne=R.card.isFaceUp?`${R.card.protocol}-${R.card.value}`:"that card";j=ae(j,d,`Deletes ${ne}.`);const z={...j.stats[d],cardsDeleted:j.stats[d].cardsDeleted+1};j={...j,stats:{...j.stats,[d]:z}};const G=c.triggerType==="cover"||c.triggerType==="on_cover";return O&&L.length>0&&!G&&(j=vn(j,F,M).newState),{newState:j,animationRequests:[{type:"delete",cardId:U,owner:F}]}}}return{newState:j}}if((E=s.scope)!=null&&E.minCardsInLane){const U=s.scope.minCardsInLane,R=((C=l.player.lanes[n])==null?void 0:C.length)||0,j=((N=l.opponent.lanes[n])==null?void 0:N.length)||0;if(R+j<U)return{newState:l}}let f=[0,1,2];if(((T=s.laneCondition)==null?void 0:T.type)==="opponent_higher_value"&&(f=B_(l,d),f.length===0)){let U=ae(l,d,"No lanes where opponent has higher value. Delete effect skipped.");return U._effectSkippedNoTargets=!0,{newState:U}}const h=s.actorChooses||"effect_owner",m=((H=s.targetFilter)==null?void 0:H.owner)||"any";let g=d;h==="card_owner"&&m==="opponent"&&(g=c.opponent);const y=s.targetFilter||{},w=y.position||"uncovered",_=[];for(const U of["player","opponent"])for(let R=0;R<l[U].lanes.length;R++){if(((q=s.scope)==null?void 0:q.type)==="this_line"&&R!==n)continue;const j=l[U].lanes[R];for(let F=0;F<j.length;F++){const M=j[F];if(Za(l,M.id))continue;const L=Ka(l,j,F);if(!(s.excludeSelf&&M.id===a.id)&&!(y.owner==="own"&&U!==d)&&!(y.owner==="opponent"&&U===d)&&!(w==="uncovered"&&!L)&&!(w==="covered"&&L)){if(w==="covered_by_context"&&c.triggerType==="cover"){if(U!==c.cardOwner&&L)continue}else if(w==="covered_by_context"&&L)continue;if(!(y.faceState==="face_up"&&!M.isFaceUp)&&!(y.faceState==="face_down"&&M.isFaceUp)){if(y.valueRange){const{min:D,max:O}=y.valueRange;if(M.value<D||M.value>O)continue}if(s.protocolMatching){const D=l.player.protocols[R],O=l.opponent.protocols[R],X=M.protocol,ne=X===D||X===O;if(s.protocolMatching==="must_match"&&!ne||s.protocolMatching==="must_not_match"&&ne)continue}_.push(M.id)}}}}if(_.length===0){let U=ae(l,d,"No valid cards to delete. Effect skipped.");return U._effectSkippedNoTargets=!0,{newState:U}}if(s.upTo&&(p=Math.min(p,_.length),p===0))return{newState:ae(l,d,"No valid targets available. Delete effect skipped.")};let b=_;if(y.calculation==="highest_value"||y.calculation==="lowest_value"){const U=new Map;for(const F of _){const M=ve(l,F);if(!M)continue;let L=-1;for(let O=0;O<l[M.owner].lanes.length;O++)if(l[M.owner].lanes[O].some(X=>X.id===F)){L=O;break}let D=M.card.value;!M.card.isFaceUp&&L!==-1&&(D=l[M.owner].lanes[L].some(X=>X.isFaceUp&&X.protocol==="Darkness"&&X.value===2)?4:2),U.set(F,D)}const R=Array.from(U.values()),j=y.calculation==="highest_value"?Math.max(...R):Math.min(...R);b=_.filter(F=>U.get(F)===j)}if(s.autoExecute){const U=b.slice(0,p);let R=l;const j=[];for(const F of U){const M=ve(R,F);if(!M)continue;const{card:L,owner:D}=M;let O=-1;for(let de=0;de<R[D].lanes.length;de++)if(R[D].lanes[de].some(ee=>ee.id===F)){O=de;break}if(O===-1)continue;const X=R[D].lanes[O],ne=X[X.length-1].id===F,z=L.isFaceUp?`${L.protocol}-${L.value}`:"a face-down card";R=ae(R,d,`Effect triggers, deleting the lowest value covered card (${D==="player"?"Player's":"Opponent's"} ${z}).`);const Z=[...X],Q=Z.findIndex(de=>de.id===F);Z.splice(Q,1);const I=[...R[D].lanes];I[O]=Z,R={...R,[D]:{...R[D],lanes:I}};const W={...R.stats[d],cardsDeleted:R.stats[d].cardsDeleted+1};R={...R,stats:{...R.stats,[d]:W}},j.push({type:"delete",cardId:F,owner:D});const Y=c.triggerType==="cover"||c.triggerType==="on_cover";ne&&Z.length>0&&!Y&&(R=vn(R,D,O).newState)}return{newState:R,animationRequests:j}}let k={...l};if(s.deleteSelf){const U=d,R=l[U].lanes[n];if(!R||R.length===0)return k=ae(k,d,"Card already deleted. Delete effect skipped."),{newState:k};if(R.findIndex(G=>G.id===a.id)===-1)return k=ae(k,d,"Card already deleted. Delete effect skipped."),{newState:k};const F=l[U].lanes[n],M=F.length>0&&F[F.length-1].id===a.id;k=ae(k,d,`Deleting ${a.protocol}-${a.value}.`);const L=[...F],D=L.findIndex(G=>G.id===a.id);if(D===-1)return{newState:k};L.splice(D,1);const O=[...k[U].lanes];O[n]=L,k={...k,[U]:{...k[U],lanes:O}};const X={...k.stats[d],cardsDeleted:k.stats[d].cardsDeleted+1};k={...k,stats:{...k.stats,[d]:X}};const ne=[{type:"delete",cardId:a.id,owner:U}],z=c.triggerType==="cover"||c.triggerType==="on_cover";if(M&&L.length>0&&!z){const G=vn(k,U,n);k=G.newState,G.animationRequests&&ne.push(...G.animationRequests)}return{newState:k,animationRequests:ne}}if(s.selectLane)return k.actionRequired={type:"select_lane_for_delete",sourceCardId:a.id,actor:g,count:s.count,targetFilter:s.targetFilter,deleteAll:s.count==="all_in_lane"||s.count==="all",validLanes:f.length<3?f:void 0,laneCondition:s.laneCondition},{newState:k};if(((B=s.scope)==null?void 0:B.type)==="each_lane"){const U=M=>{for(const L of["player","opponent"]){const D=l[L].lanes[M];for(let O=0;O<D.length;O++){const X=D[O];if(Za(l,X.id))continue;const ne=Ka(l,D,O);if(!(s.excludeSelf&&X.id===a.id)&&!(y.owner==="own"&&L!==g)&&!(y.owner==="opponent"&&L===g)&&!(w==="uncovered"&&!ne)&&!(w==="covered"&&ne)&&!(y.faceState==="face_up"&&!X.isFaceUp)&&!(y.faceState==="face_down"&&X.isFaceUp))return!0}}return!1},R=[0,1,2].filter(M=>U(M));if(R.length===0)return k=ae(k,d,"No valid targets to delete in any lane."),k._effectSkippedNoTargets=!0,{newState:k};const j=R[0],F=R.slice(1);return k.actionRequired={type:"select_cards_to_delete",count:p,sourceCardId:a.id,actor:g,currentLaneIndex:j,remainingLanes:F,disallowedIds:s.excludeSelf?[a.id]:[],targetFilter:s.targetFilter,scope:s.scope,protocolMatching:s.protocolMatching,params:s},{newState:k}}if(((K=s.scope)==null?void 0:K.type)==="each_other_line"){const j=[0,1,2].filter(F=>F!==n).filter(F=>l.player.lanes[F].length>0||l.opponent.lanes[F].length>0).length;return j===0?(k=ae(k,d,"No other lanes have cards. Effect skipped."),{newState:k}):(k.actionRequired={type:"select_card_from_other_lanes_to_delete",sourceCardId:a.id,disallowedLaneIndex:n,lanesSelected:[],count:j,actor:g,targetFilter:s.targetFilter},{newState:k})}return k.actionRequired={type:"select_cards_to_delete",count:p,sourceCardId:a.id,actor:g,actorChooses:h,disallowedIds:s.excludeSelf?[a.id]:[],allowedIds:b.length<_.length?b:void 0,targetFilter:s.targetFilter,scope:s.scope,protocolMatching:s.protocolMatching},{newState:k}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Discard Effect Executor
 *
 * Handles all discard-related effects.
 * Extracted 1:1 from effectInterpreter.ts for modularity.
 */function A_(a,n,l,c,s){const{cardOwner:d}=c,p=s.actor==="opponent"?c.opponent:d;if(s.useCardFromPreviousEffect&&l.lastCustomEffectTargetCardId){const w=l.lastCustomEffectTargetCardId;let _={...l};const b={..._[p]},k=`${a.protocol}-${a.value}`,S=p==="player"?"Player":"Opponent",$=b.deck.findIndex(C=>C.id===w);if($!==-1){const C=[...b.deck],N=C.splice($,1)[0];return b.deck=C,b.discard=[...b.discard,N],_[p]=b,_=ae(_,p,`${S} discards ${N.protocol}-${N.value} from their deck.`),_._discardContext={actor:p,discardedCount:1,sourceCardId:a.id},{newState:_}}const E=b.hand.findIndex(C=>C.id===w);if(E!==-1){const C=[...b.hand],N=C.splice(E,1)[0],{id:T,isFaceUp:H,...q}=N;return b.hand=C,b.discard=[...b.discard,q],_[p]=b,_=ae(_,p,`${S} discards ${N.protocol}-${N.value}.`),_._discardContext={actor:p,discardedCount:1,sourceCardId:a.id},{newState:_}}return console.warn(`[Discard Effect] useCardFromPreviousEffect: Card ${w} not found`),_=ae(_,p,`${k}: Card to discard not found - effect skipped.`),_._discardContext={discardedCount:0},{newState:_}}let f=s.count||1;if((s.countType||"fixed")==="equal_to_discarded"){const w=(c.discardedCount||0)+(s.countOffset||0);if(f=Math.min(w,l[p].hand.length),f<=0)return{newState:l}}if(l[p].hand.length===0){let _=ae(l,p,`${p==="player"?"Player":"Opponent"} has no cards to discard - effect skipped.`);return _._effectSkippedNoTargets=!0,_._discardContext={discardedCount:0},{newState:_}}s.upTo&&(f=Math.min(f,l[p].hand.length));const m=f;typeof f=="number"&&f>l[p].hand.length&&(f=l[p].hand.length);const g=!s.upTo&&typeof m=="number"&&m>f;if(s.random&&p!==d){const w=[...l[p].hand],_=Math.min(f,w.length),b=[],k=w.map((B,K)=>K);for(let B=0;B<_&&k.length>0;B++){const K=Math.floor(Math.random()*k.length);b.push(k[K]),k.splice(K,1)}b.sort((B,K)=>K-B);const S=[],$=[...w];for(const B of b){const{id:K,isFaceUp:U,...R}=$.splice(B,1)[0];S.push(R)}const E=[...l[p].discard,...S],C={...l[p].stats,cardsDiscarded:l[p].stats.cardsDiscarded+S.length},N={...l[p],hand:$,discard:E,stats:C};let T={...l,[p]:N,stats:{...l.stats,[p]:C}};const H=p==="player"?"Player":"Opponent",q=S.length===1?"card":"cards";if(p==="player"||S.every(B=>B.isRevealed)){const B=S.map(K=>`${K.protocol}-${K.value}`).join(", ");T=ae(T,p,`${H} randomly discards ${S.length} ${q}: ${B}.`)}else T=ae(T,p,`${H} randomly discards ${S.length} ${q}.`);return T._discardContext={actor:p,discardedCount:S.length,sourceCardId:a.id},{newState:T}}if(f==="all"){const w=l[p].hand,_=w.map(({id:N,isFaceUp:T,...H})=>H),b=[],k=[...l[p].discard,..._],S={...l[p].stats,cardsDiscarded:l[p].stats.cardsDiscarded+_.length},$={...l[p],hand:b,discard:k,stats:S};let E={...l,[p]:$,stats:{...l.stats,[p]:S}};const C=p==="player"?"Player":"Opponent";if(p==="player"||_.every(N=>N.isRevealed)){const N=_.map(T=>`${T.protocol}-${T.value}`).join(", ");E=ae(E,p,`${C} discards entire hand (${_.length} cards: ${N}).`)}else E=ae(E,p,`${C} discards entire hand (${_.length} cards).`);return E._discardContext={actor:p,discardedCount:_.length,previousHandSize:w.length,sourceCardId:a.id},{newState:E}}let y={...l};return g&&(y=ae(y,p,`${p==="player"?"Player":"Opponent"} only has ${f} card${f!==1?"s":""} (${m} required) - discarding all.`)),y.actionRequired={type:"discard",actor:p,count:f,sourceCardId:a.id,variableCount:s.variableCount||!1,previousHandSize:l[p].hand.length},{newState:y}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Shift Effect Executor
 *
 * Handles all shift-related effects.
 * Extracted 1:1 from effectInterpreter.ts for modularity.
 */function T_(a,n,l,c,s){var H,q,B,K;const{cardOwner:d}=c;let p={...l};if(((H=s.advancedConditional)==null?void 0:H.type)==="empty_hand"&&l[d].hand.length>0)return{newState:l};if(((q=s.advancedConditional)==null?void 0:q.type)==="opponent_higher_value_in_lane"){const U=d==="player"?"opponent":"player",R=Fn(l,d,n);if(Fn(l,U,n)<=R)return{newState:l}}if(((B=s.advancedConditional)==null?void 0:B.type)==="this_card_is_covered"){const U=l[d].lanes;let R=!1;for(let j=0;j<U.length;j++){const F=U[j],M=F.findIndex(L=>L.id===a.id);if(M!==-1){R=M<F.length-1;break}}if(!R)return{newState:l}}if(s.useCardFromPreviousEffect&&l.lastCustomEffectTargetCardId){const U=l.lastCustomEffectTargetCardId,R=ve(l,U);if(!R)return{newState:ae(l,d,"Target card from previous effect no longer exists. Shift skipped.")};const j=s.destinationRestriction;if((j==null?void 0:j.type)==="to_this_lane"){const M=j.laneIndex==="current"?n:j.laneIndex;if(M===void 0||M<0||M>2)return console.error(`[Shift Effect] Invalid target lane index: ${M}`),{newState:l};const L=Qa(l,U,R.owner,M,d);return{newState:L.newState,animationRequests:L.animationRequests}}let F=-1;for(let M=0;M<l[R.owner].lanes.length;M++)if(l[R.owner].lanes[M].some(L=>L.id===U)){F=M;break}return F===-1?{newState:l}:(p.actionRequired={type:"select_lane_for_shift",cardToShiftId:U,cardOwner:R.owner,originalLaneIndex:F,sourceCardId:a.id,actor:d,destinationRestriction:j},{newState:p})}const f=l._selectedCardFromPreviousEffect;if(p._selectedCardFromPreviousEffect&&delete p._selectedCardFromPreviousEffect,f&&s.useCardFromPreviousEffect){const U=s.destinationRestriction;if((U==null?void 0:U.type)==="to_this_lane"){const R=U.laneIndex==="current"?n:U.laneIndex;if(R===void 0||R<0||R>2)return console.error(`[Shift Effect] Invalid target lane index: ${R}`),{newState:p};const j=ve(p,f);if(!j)return console.error(`[Shift Effect] Selected card not found: ${f}`),{newState:p};const F=Qa(p,f,j.owner,R,d);return{newState:F.newState,animationRequests:F.animationRequests}}return p.actionRequired={type:"shift_flipped_card_optional",cardId:f,sourceCardId:a.id,optional:s.optional||!1,actor:d},{newState:p}}if(s.shiftSelf){if(((K=s.destinationRestriction)==null?void 0:K.type)==="opponent_highest_value_lane"){const U=Kh(p,d);if(U.includes(n))return p=ae(p,d,"Card is already in opponent's highest value lane. Shift skipped."),{newState:p};const R=U.filter(j=>j!==n);if(R.length===0)return p=ae(p,d,"No valid destination lane. Shift skipped."),{newState:p};if(R.length===1){if(s.optional)return p.actionRequired={type:"select_lane_for_shift",cardToShiftId:a.id,cardOwner:d,originalLaneIndex:n,sourceCardId:a.id,actor:d,validLanes:R,destinationRestriction:s.destinationRestriction,optional:!0},{newState:p};const j=R[0],F=Qa(p,a.id,d,j,d);return{newState:F.newState,animationRequests:F.animationRequests}}return p.actionRequired={type:"select_lane_for_shift",cardToShiftId:a.id,cardOwner:d,originalLaneIndex:n,sourceCardId:a.id,actor:d,validLanes:R,destinationRestriction:s.destinationRestriction,optional:s.optional||!1},{newState:p}}return p.actionRequired={type:"shift_flipped_card_optional",cardId:a.id,sourceCardId:a.id,optional:s.optional||!1,actor:d,allowCovered:s.allowCoveredSelf||!1},{newState:p}}const h=s.targetFilter||{},m=h.position||"uncovered",g=h.faceState||"any",y=h.owner||"any",w=h.excludeSelf||!1,_=s.count||1;if(m==="any"&&y==="own"&&!w&&_===1)return p.actionRequired={type:"shift_flipped_card_optional",cardId:a.id,sourceCardId:a.id,optional:s.optional||!1,actor:d},{newState:p};const k=[];for(const U of["player","opponent"])if(!(y==="own"&&U!==d)&&!(y==="opponent"&&U===d))for(let R=0;R<p[U].lanes.length;R++){if(s.scope==="this_lane"&&R!==n)continue;const j=p[U].lanes[R];for(let F=0;F<j.length;F++){const M=j[F];if(Za(p,M.id)||w&&M.id===a.id)continue;const L=Ka(p,j,F);m==="uncovered"&&!L||m==="covered"&&L||g==="face_up"&&!M.isFaceUp||g==="face_down"&&M.isFaceUp||k.push({card:M,currentLane:R,owner:U})}}if(k.length===0)return p=ae(p,d,"No valid cards to shift."),p._effectSkippedNoTargets=!0,{newState:p};if((_==="all"||typeof _!="number"&&_!==1)&&k.length>0){const U=[],R=s.destinationRestriction;for(let j=0;j<3;j++){if((R==null?void 0:R.type)==="to_another_line"){if(j===n)continue}else if((R==null?void 0:R.type)==="to_this_lane"){const F=R.laneIndex==="current"?n:R.laneIndex;if(j!==F)continue}else if(!R&&j===n)continue;U.push(j)}return U.length===0?(p=ae(p,d,"No valid destination lanes for shifting all cards."),{newState:p}):(p=ae(p,d,`Shifting ${k.length} card(s) from this lane.`),p.actionRequired={type:"select_lane_for_shift_all",sourceCardId:a.id,actor:d,cardsToShift:k.map(j=>({cardId:j.card.id,owner:j.owner})),validDestinationLanes:U,sourceLaneIndex:n},{newState:p})}const $=s.destinationRestriction;let E=!1;const C=($==null?void 0:$.laneIndex)==="current"?n:$==null?void 0:$.laneIndex;for(const{card:U,currentLane:R,owner:j}of k){if(($==null?void 0:$.type)==="non_matching_protocol"&&!U.isFaceUp)continue;const F=U.protocol;for(let M=0;M<3;M++){if($){if($.type==="non_matching_protocol"){if(M===R)continue;const D=p.player.protocols[M],O=p.opponent.protocols[M];if(F===D||F===O)continue}else if($.type==="specific_lane"){if(M!==R)continue}else if($.type==="to_this_lane"){if(M!==C||R===C)continue}else if($.type==="to_another_line"){if(M===R)continue}else if($.type==="to_or_from_this_lane"&&(!(R===C)&&!(M===C)||M===R))continue}else if(M===R)continue;if(Al(p,R,M).allowed){E=!0;break}}if(E)break}if(!E)return p=ae(p,d,"No valid shift destinations available."),{newState:p};const N=$&&C!==void 0?{...$,laneIndex:C}:$,T=($==null?void 0:$.type)==="to_this_lane"&&C!==void 0?C:void 0;return p.actionRequired={type:"select_card_to_shift",sourceCardId:a.id,actor:d,targetFilter:s.targetFilter,destinationRestriction:N,sourceLaneIndex:n,targetLaneIndex:T,scope:s.scope},{newState:p}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Return Effect Executor
 *
 * Handles all return-related effects.
 * Extracted 1:1 from effectInterpreter.ts for modularity.
 */function D_(a,n,l,c,s){var w,_,b,k;const{cardOwner:d,opponent:p}=c;s.count==="all"||s.count;const f=((w=s.targetFilter)==null?void 0:w.owner)||"any",h=((_=s.targetFilter)==null?void 0:_.position)||"uncovered";if(((b=s.advancedConditional)==null?void 0:b.type)==="empty_hand"&&l[d].hand.length>0)return{newState:l};if(((k=s.advancedConditional)==null?void 0:k.type)==="opponent_higher_value_in_lane"){const S=d==="player"?"opponent":"player",$=Fn(l,d,n);if(Fn(l,S,n)<=$)return{newState:l}}if(s.selectLane){let S={...l};return S.actionRequired={type:"select_lane_for_return",sourceCardId:a.id,actor:d,count:s.count,targetFilter:s.targetFilter},{newState:S}}let m=[];const g=S=>{for(const $ of l[S].lanes)for(let E=0;E<$.length;E++){const C=$[E];if(Za(l,C.id))continue;const N=Ka(l,$,E);h==="uncovered"&&!N||h==="covered"&&N||m.push({card:C,isUncovered:N})}};if(f==="own"?g(d):f==="opponent"?g(p):(g("player"),g("opponent")),m.length===0)return{newState:ae(l,d,"No cards on board to return. Effect skipped.")};let y={...l};return y.actionRequired={type:"select_card_to_return",sourceCardId:a.id,actor:d,targetOwner:f,targetFilter:s.targetFilter},{newState:y}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Play Effect Executor
 *
 * Handles all play-related effects (play cards from hand/deck to board).
 * Extracted 1:1 from effectInterpreter.ts for modularity.
 */function N_(a,n,l,c,s){var _,b,k,S,$,E,C,N,T,H,q;const{cardOwner:d,opponent:p}=c,f=s.count||1,h=s.source||"hand",m=s.faceDown,g=s.actor==="opponent"?p:d;if(((_=s.advancedConditional)==null?void 0:_.type)==="empty_hand"&&l[d].hand.length>0)return{newState:l};if(((b=s.advancedConditional)==null?void 0:b.type)==="opponent_higher_value_in_lane"){const B=d==="player"?"opponent":"player",K=Fn(l,d,n);if(Fn(l,B,n)<=K)return{newState:l}}if(h==="deck"&&((k=s.destinationRule)==null?void 0:k.type)==="each_other_line"){const B=[0,1,2].filter(ne=>ne!==n);if(B.length===0)return{newState:l};const K=l[g];if(K.deck.length===0&&K.discard.length===0)return{newState:ae(l,d,`[Custom Play effect] ${g} has no cards in deck/discard - skipping.`)};const{drawnCards:U,remainingDeck:R,newDiscard:j}=Dn(K.deck,K.discard,B.length);if(U.length===0)return{newState:l};const F=U.map(ne=>({...ne,id:Be(),isFaceUp:!1})),M=[...K.lanes];for(let ne=0;ne<F.length;ne++){const z=B[ne];M[z]=[...M[z],F[ne]]}const L={...K,lanes:M,deck:R,discard:j};let D={...l,[g]:L};const O=ve(l,a.id),X=O?`${O.card.protocol}-${O.card.value}`:"a card effect";return D=ae(D,d,`${X}: Plays ${U.length} card(s) face-down in other lines.`),{newState:D}}if(h==="deck"&&((S=s.destinationRule)==null?void 0:S.type)==="each_line_with_card"){const B=s.destinationRule.ownerFilter||"any",K=s.destinationRule.cardFilter,U=B==="own"?g:B==="opponent"?g==="player"?"opponent":"player":null,R=ee=>{const ge=Se=>Se.length===0?!1:K?Se.some(ye=>K.faceState==="face_down"?!ye.isFaceUp:K.faceState==="face_up"?ye.isFaceUp:!0):!0;return U?ge(l[U].lanes[ee]):ge(l.player.lanes[ee])||ge(l.opponent.lanes[ee])},j=[];for(let ee=0;ee<3;ee++)R(ee)&&j.push(ee);if(j.length===0)return{newState:l};const F=l[g];if(F.deck.length===0&&F.discard.length===0)return{newState:ae(l,d,`[Custom Play effect] ${g} has no cards in deck/discard - skipping.`)};const{drawnCards:M,remainingDeck:L,newDiscard:D}=Dn(F.deck,F.discard,j.length);if(M.length===0)return{newState:l};const O=M.map(ee=>({...ee,id:Be(),isFaceUp:!m}));let X=l;const ne=[];for(let ee=0;ee<j.length;ee++){const ge=j[ee],Se=X[g].lanes[ge];if(Se.length>0){const ye=Se[Se.length-1],Ne={...c,triggerType:"cover"},Le=Rd(ye,ge,X,Ne);if(X=Le.newState,Le.animationRequests&&ne.push(...Le.animationRequests),X.actionRequired)break}}const z=[...X[g].lanes],G=[];for(let ee=0;ee<O.length;ee++){const ge=j[ee];z[ge]=[...z[ge],O[ee]],G.push({type:"play",cardId:O[ee].id,owner:g})}const Z={...X[g],lanes:z,deck:L,discard:D};let Q={...X,[g]:Z};const I=ve(l,a.id),W=I?`${I.card.protocol}-${I.card.value}`:"a card effect";let Y="";(K==null?void 0:K.faceState)==="face_down"?Y="with a face-down card":(K==null?void 0:K.faceState)==="face_up"?Y="with a face-up card":B==="own"?Y="where you have a card":B==="opponent"?Y="where opponent has a card":Y="with a card",Q=ae(Q,d,`${W}: Plays ${M.length} card(s) face-down in each line ${Y}.`);const de=[...ne,...G];return{newState:Q,animationRequests:de.length>0?de:void 0}}if(h==="deck"&&(($=s.destinationRule)==null?void 0:$.type)==="another_line"){if([0,1,2].filter(U=>U!==n).length===0)return{newState:l};let K=ae(l,d,"[Custom Play effect - select another line to play]");return K.actionRequired={type:"select_lane_for_play",sourceCardId:a.id,actor:g,count:s.count||1,isFaceDown:s.faceDown,excludeCurrentLane:!0,currentLaneIndex:n,source:s.source},{newState:K}}if(h==="deck"&&((E=s.destinationRule)==null?void 0:E.type)==="under_this_card"&&((C=s.condition)==null?void 0:C.type)==="per_x_cards_in_line"){const B=s.condition.cardCount||2,K=l[d].lanes[n].length,U=l[p].lanes[n].length,R=K+U,j=Math.floor(R/B);if(j===0)return{newState:l};const F=l[g];if(F.deck.length===0&&F.discard.length===0)return{newState:l};const{drawnCards:M,remainingDeck:L,newDiscard:D}=Dn(F.deck,F.discard,j);if(M.length===0)return{newState:l};const O=M.map(I=>({...I,id:Be(),isFaceUp:!1})),X=[...F.lanes[n]];X.splice(X.length-1,0,...O);const ne=[...F.lanes];ne[n]=X;const z={...F,lanes:ne,deck:L,discard:D};let G={...l,[g]:z};const Z=ve(l,a.id),Q=Z?`${Z.card.protocol}-${Z.card.value}`:"a card effect";return G=ae(G,d,`${Q}: Plays ${M.length} card(s) face-down under itself.`),{newState:G}}if(h==="deck"&&((N=s.destinationRule)==null?void 0:N.type)==="specific_lane"){const B=s.destinationRule.laneIndex==="current"?n:s.destinationRule.laneIndex;if(B===void 0||B<0||B>2)return console.error(`[Play Effect] Invalid lane index: ${B}`),{newState:l};const K=l[g];if(K.deck.length===0&&K.discard.length===0)return{newState:ae(l,d,`[Custom Play effect] ${g} has no cards in deck/discard - skipping.`)};const{drawnCards:U,remainingDeck:R,newDiscard:j}=Dn(K.deck,K.discard,f);if(U.length===0)return{newState:l};const F=U.map(Z=>({...Z,id:Be(),isFaceUp:!m})),M=[...K.lanes];M[B]=[...M[B],...F];const L={...K,lanes:M,deck:R,discard:j};let D={...l,[g]:L};const O=ve(l,a.id),X=O?`${O.card.protocol}-${O.card.value}`:"a card effect",ne=g==="player"?"Player":"Opponent",z=m?"face-down":"face-up",G=l.player.protocols[B];return D=ae(D,d,`${X}: ${ne} plays ${U.length} card(s) ${z} in ${G} line.`),{newState:D}}if(h==="hand"&&((T=s.destinationRule)==null?void 0:T.type)==="line_with_matching_cards"){const B=s.destinationRule.cardFilter,K=j=>{const F=M=>M.length===0?!1:B?M.some(L=>B.faceState==="face_down"?!L.isFaceUp:B.faceState==="face_up"?L.isFaceUp:!0):!0;return F(l.player.lanes[j])||F(l.opponent.lanes[j])},U=[];for(let j=0;j<3;j++)K(j)&&U.push(j);if(U.length===0){const j=ve(l,a.id),F=j?`${j.card.protocol}-${j.card.value}`:"Effect";return{newState:ae(l,d,`${F}: No valid lanes with face-down cards. Effect skipped.`)}}if(l[g].hand.length===0)return{newState:l};let R=ae(l,d,"[Custom Play effect - select a card to play in a lane with a face-down card]");return R.actionRequired={type:"select_card_from_hand_to_play",sourceCardId:a.id,actor:g,count:s.count||1,faceDown:s.faceDown,source:"hand",validLanes:U,cardFilter:B},{newState:R}}if(h==="hand"&&((H=s.valueFilter)==null?void 0:H.equals)!==void 0&&!s.destinationRule){const B=s.valueFilter.equals,K=l[g].hand.filter(R=>R.value===B);if(K.length===0){const R=ve(l,a.id),j=R?`${R.card.protocol}-${R.card.value}`:"Effect";return{newState:ae(l,d,`${j}: No cards with value ${B} in hand. Effect skipped.`)}}let U=ae(l,d,`[Custom Play effect - select a card with value ${B} from hand to play]`);return U.actionRequired={type:"select_card_from_hand_to_play",sourceCardId:a.id,actor:g,count:s.count||1,faceDown:s.faceDown,source:"hand",valueFilter:B,selectableCardIds:K.map(R=>R.id)},{newState:U}}if(h==="hand"&&l[g].hand.length===0)return{newState:l};let y=ae(l,d,`[Custom Play effect - playing ${f} card(s) ${m?"face-down":"face-up"} from ${h}]`),w;return(q=s.destinationRule)!=null&&q.excludeCurrentLane&&(w=n),y.actionRequired={type:"select_card_from_hand_to_play",count:f,sourceCardId:a.id,actor:g,faceDown:m,source:h,disallowedLaneIndex:w,destinationRule:s.destinationRule,condition:s.condition},{newState:y}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Reveal/Give Effect Executor
 *
 * Handles reveal and give card effects.
 * Extracted 1:1 from effectInterpreter.ts for modularity.
 */function F_(a,n,l,c,s){const{cardOwner:d,opponent:p}=c,f=s.count||1,h=s.action,m=s.source||"own_hand";if(h==="reveal"&&m==="board"){const y=s.targetFilter||{owner:"any",position:"uncovered",faceState:"face_down"},w=s.followUpAction,_=s.optional!==!1,b=[],k=y.owner==="own"?[d]:y.owner==="opponent"?[p]:[d,p];for(const $ of k)for(let E=0;E<l[$].lanes.length;E++){const C=l[$].lanes[E];if(C.length>0){let N=[];y.position==="uncovered"?N=[C[C.length-1]]:y.position==="covered"?N=C.slice(0,-1):N=[...C];const T=N.filter(H=>y.faceState==="face_up"?H.isFaceUp:y.faceState==="face_down"?!H.isFaceUp:!0);b.push(...T)}}if(b.length===0)return{newState:ae(l,d,"No valid cards to reveal. Effect skipped.")};let S={...l};return S.actionRequired={type:"select_board_card_to_reveal_custom",sourceCardId:a.id,actor:d,targetFilter:y,followUpAction:w,optional:_},{newState:S}}if(h==="reveal"&&m==="opponent_hand"){let y={...l};const w={...y[p]};if(w.hand.length>0){w.hand=w.hand.map(b=>({...b,isRevealed:!0})),y[p]=w;const _=`${a.protocol}-${a.value}`;y=ae(y,d,`${_}: Your opponent reveals their hand.`)}else{const _=`${a.protocol}-${a.value}`;y=ae(y,d,`${_}: Opponent has no cards to reveal.`)}return{newState:y}}if(h==="reveal"&&m==="own_deck_top"){let y={...l};const w={...y[d]},_=`${a.protocol}-${a.value}`;if(w.deck.length===0)return y=ae(y,d,`${_}: No cards in deck to reveal.`),{newState:y};const b=[...w.deck],k=b[0];y=ae(y,d,`${_}: Revealed ${k.protocol}-${k.value} from top of deck.`);const S=`deck-top-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;return b[0]={...k,id:S},w.deck=b,y[d]=w,y.lastCustomEffectTargetCardId=S,{newState:y}}if(h==="reveal"&&m==="own_deck"){let y={...l};const w={...y[d]},_=`${a.protocol}-${a.value}`;if(w.deck.length===0)return y=ae(y,d,`${_}: No cards in deck to reveal.`),{newState:y};w.deckRevealed=!0,y[d]=w;const b=w.deck.map(k=>`${k.protocol}-${k.value}`).join(", ");return y=ae(y,d,`${_}: Revealed deck: ${b}`),{newState:y}}if(l[d].hand.length===0)return{newState:ae(l,d,`No cards in hand to ${h}. Effect skipped.`)};let g={...l};return h==="reveal"?g.actionRequired={type:"select_card_from_hand_to_reveal",count:f,sourceCardId:a.id,actor:d}:h==="give"&&(g.actionRequired={type:"select_card_from_hand_to_give",count:f,sourceCardId:a.id,actor:d}),{newState:g}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Shuffle Effect Executor
 *
 * Handles shuffle_trash and shuffle_deck effects.
 * - shuffle_trash: Clarity-4 "You may shuffle your trash into your deck."
 *   (In this codebase, "trash" = "discard pile")
 * - shuffle_deck: Clarity-2/3 "Shuffle your deck."
 */function q_(a,n,l,c,s){const{cardOwner:d}=c,p=`${a.protocol}-${a.value}`,f=s.optional!==!1;if(l[d].discard.length===0)return{newState:ae(l,d,`${p}: No cards in trash to shuffle.`)};if(f){let h={...l};return h.actionRequired={type:"prompt_optional_shuffle_trash",sourceCardId:a.id,actor:d,trashCount:l[d].discard.length},{newState:h}}return Qh(l,d,p)}function Qh(a,n,l){let c={...a};const s={...c[n]},d=s.discard.length;return d===0?(c=ae(c,n,`${l}: No cards in trash to shuffle.`),{newState:c}):(s.deck=[...s.deck,...s.discard],s.discard=[],s.deck=yn([...s.deck]),c[n]=s,c=ae(c,n,`${l}: Shuffled ${d} card${d!==1?"s":""} from trash into deck.`),{newState:c})}function $_(a,n,l,c,s){const{cardOwner:d}=c,p=`${a.protocol}-${a.value}`;let f={...l};const h={...f[d]};return h.deck.length===0?(f=ae(f,d,`${p}: No cards in deck to shuffle.`),{newState:f}):(h.deck=yn([...h.deck]),h.deckRevealed=!1,f[d]=h,f=ae(f,d,`${p}: Shuffled deck.`),{newState:f})}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function lt(a,n,l,c,s,d){var S,$,E;const p=s.params,f=p.action,h=ve(l,a.id);if(!h)return{newState:l};if(!h.card.isFaceUp)return{newState:l};const m=s.position||"middle",y=s.trigger==="on_cover",w=p.useCardFromPreviousEffect===!0;if(m!=="top"&&!y&&!w&&!Xa(l,a.id))return{newState:l};const b=f==="reveal"&&p.source==="board";if(p.optional===!0&&!b){const C=p.actor==="opponent"?c.opponent:c.cardOwner,N=C==="player"?"opponent":"player",T=p.targetFilter||{},H=U=>{for(const R of["player","opponent"])for(let j=0;j<l[R].lanes.length;j++){const F=l[R].lanes[j];for(let M=0;M<F.length;M++)if(U(F[M],R,j,M))return!0}return!1};let q=!0,B="";switch(f){case"discard":!p.useCardFromPreviousEffect&&l[C].hand.length===0&&(q=!1,B="No cards to discard");break;case"flip":{const U=(S=l.passiveEffects)==null?void 0:S.some(R=>R.type==="prevent_flip_to_face_up"&&R.isActive);q=H((R,j,F,M)=>{if(T.excludeSelf&&R.id===a.id||T.owner==="own"&&j!==C||T.owner==="opponent"&&j===C)return!1;const L=M===l[j].lanes[F].length-1;return!(T.position==="uncovered"&&!L||T.position==="covered"&&L||T.faceState==="face_up"&&!R.isFaceUp||T.faceState==="face_down"&&R.isFaceUp||U&&!R.isFaceUp)}),q||(B="No valid cards to flip");break}case"delete":{q=H((U,R,j,F)=>{if(T.excludeSelf&&U.id===a.id||T.owner==="own"&&R!==C||T.owner==="opponent"&&R===C)return!1;const M=F===l[R].lanes[j].length-1,L=T.position||"uncovered";return!(L==="uncovered"&&!M||L==="covered"&&M||T.faceState==="face_up"&&!U.isFaceUp||T.faceState==="face_down"&&U.isFaceUp)}),q||(B="No valid cards to delete");break}case"shift":{if(s.useCardFromPreviousEffect){const U=l.lastCustomEffectTargetCardId||l._selectedCardFromPreviousEffect;U?(q=!!ve(l,U),q||(B="Target card no longer exists")):(q=!1,B="No target card from previous effect")}else if(p.shiftSelf&&(($=p.destinationRestriction)==null?void 0:$.type)==="opponent_highest_value_lane")Kh(l,c.cardOwner).includes(n)&&(q=!1,B="Card is already in opponent's highest value lane");else if(((E=p.advancedConditional)==null?void 0:E.type)==="this_card_is_covered"){const U=l[c.cardOwner].lanes;let R=!1;for(let j=0;j<U.length;j++){const F=U[j],M=F.findIndex(L=>L.id===a.id);if(M!==-1){R=M<F.length-1;break}}R||(q=!1,B="Card is not covered")}else{const U=T.position||"uncovered";U==="any"&&T.owner==="own"&&!T.excludeSelf?q=!0:(q=H((j,F,M,L)=>{if(T.excludeSelf&&j.id===a.id||T.owner==="own"&&F!==C||T.owner==="opponent"&&F===C)return!1;const D=L===l[F].lanes[M].length-1;return!(U==="uncovered"&&!D||U==="covered"&&D)}),q||(B="No valid cards to shift"))}break}case"return":{const U=T.owner==="opponent"?N:C;q=H((R,j,F,M)=>{if(j!==U)return!1;const L=M===l[j].lanes[F].length-1,D=T.position||"uncovered";return!(D==="uncovered"&&!L||D==="covered"&&L)}),q||(B="No valid cards to return");break}case"draw":l[C].deck.length===0&&l[C].discard.length===0&&(q=!1,B="No cards to draw");break;case"play":l[C].hand.length===0&&(q=!1,B="No cards to play");break}if(!q){let U=ae(l,C,`${B} - effect skipped.`);return U._effectSkippedNoTargets=!0,f==="discard"&&(U._discardContext={discardedCount:0}),{newState:U}}let K={...l};return K.actionRequired={type:"prompt_optional_effect",actor:c.cardOwner,sourceCardId:a.id,effectDef:s,laneIndex:n},{newState:K}}let k;switch(f){case"refresh":{const C=c.actor,N=kd(l,C);if(!N.allowed){k={newState:ae(l,c.cardOwner,N.reason||"Cannot refresh (draw blocked).")};break}const T=l[C].hand.length,H=Math.max(0,5-T);if(H>0){const{drawnCards:q,remainingDeck:B,newDiscard:K}=Dn(l[C].deck,l[C].discard,H),U=q.map(M=>({...M,id:Be()}));let R={...l,[C]:{...l[C],hand:[...l[C].hand,...U],deck:B,discard:K}};const j=C==="player"?` (${q.map(M=>`${M.protocol}-${M.value}`).join(", ")})`:"";R=ae(R,C,`[Refresh] Drew ${q.length} cards to reach hand size 5${j}.`),R=xt(R,"after_draw",{player:C,count:q.length}).newState,k={newState:R}}else k={newState:ae(l,C,`[Refresh] Hand already at ${T} cards, no draw needed.`)};break}case"mutual_draw":{const C=c.actor,N=C==="player"?"opponent":"player",T=p.count||1;let H={...l};if(H[N].deck.length>0){const{drawnCards:q,remainingDeck:B,newDiscard:K}=Dn(H[N].deck,H[N].discard,T);if(q.length>0){const U=q.map(M=>({...M,id:Be(),isFaceUp:!0}));H={...H,[N]:{...H[N],deck:B,discard:K},[C]:{...H[C],hand:[...H[C].hand,...U]}};const R=C==="player"?"Player":"Opponent",j=N==="player"?"Player":"Opponent",F=C==="player"?` (${U.map(M=>`${M.protocol}-${M.value}`).join(", ")})`:"";H=ae(H,C,`${R} drew ${q.length} card(s) from ${j}'s deck${F}.`)}}if(H[C].deck.length>0){const{drawnCards:q,remainingDeck:B,newDiscard:K}=Dn(H[C].deck,H[C].discard,T);if(q.length>0){const U=q.map(M=>({...M,id:Be(),isFaceUp:!0}));H={...H,[C]:{...H[C],deck:B,discard:K},[N]:{...H[N],hand:[...H[N].hand,...U]}};const R=N==="player"?"Player":"Opponent",j=C==="player"?"Player":"Opponent",F=N==="player"?` (${U.map(M=>`${M.protocol}-${M.value}`).join(", ")})`:"";H=ae(H,N,`${R} drew ${q.length} card(s) from ${j}'s deck${F}.`)}}k={newState:H};break}case"draw":k=j_(a,n,l,c,p);break;case"flip":k=k_(a,n,l,c,p);break;case"delete":k=R_(a,n,l,c,p);break;case"discard":k=A_(a,n,l,c,p);break;case"shift":k=T_(a,n,l,c,{...p,useCardFromPreviousEffect:s.useCardFromPreviousEffect});break;case"return":k=D_(a,n,l,c,p);break;case"play":k=N_(a,n,l,c,p);break;case"rearrange_protocols":case"swap_protocols":k=U_(a,n,l,c,p);break;case"reveal":case"give":k=F_(a,n,l,c,p);break;case"take":k=O_(a,n,l,c,p);break;case"choice":k=I_(a,n,l,c,p);break;case"block_compile":k=L_(a,n,l,c,p);break;case"delete_all_in_lane":k=M_(a,n,l,c,p);break;case"shuffle_trash":k=q_(a,n,l,c,p);break;case"shuffle_deck":k=$_(a,n,l,c);break;default:console.error(`[Custom Effect] Unknown action: ${f}`),k={newState:l};break}if(s.conditional&&s.conditional.thenEffect){const{newState:C}=k;if(C.actionRequired)k={newState:{...C,actionRequired:{...C.actionRequired,followUpEffect:s.conditional.thenEffect,conditionalType:s.conditional.type,outerSourceCardId:a.id,outerLaneIndex:n}}};else{if(s.conditional.type==="if_executed"){const H=C._discardContext;if(((H==null?void 0:H.discardedCount)||0)===0)return delete C._discardContext,k={newState:C},k}if(s.conditional.type==="optional"){let H={...C};return H.actionRequired={type:"prompt_optional_effect",actor:c.cardOwner,sourceCardId:a.id,effectDef:s.conditional.thenEffect,laneIndex:n,savedTargetCardId:C.lastCustomEffectTargetCardId},k={newState:H},k}let N=c;const T=C._discardContext;T&&(N={...c,discardedCount:T.discardedCount,previousHandSize:T.previousHandSize},delete C._discardContext),k=lt(a,n,C,N,s.conditional.thenEffect)}}return k}function U_(a,n,l,c,s){const{cardOwner:d,opponent:p}=c,f=s.action,m=(s.target||"own")==="opponent"?p:d,g=d;if(p_(l)&&f==="rearrange_protocols")return{newState:ae(l,d,"Protocols cannot be rearranged (Frost-1 bottom effect is active).")};let w=ae(l,d,`[Custom Protocol effect - ${f} for ${m}]`),_;return s.restriction&&(_={laneIndex:s.restriction.laneIndex==="current"?n:s.restriction.laneIndex,protocol:s.restriction.disallowedProtocol}),f==="rearrange_protocols"?w.actionRequired={type:"prompt_rearrange_protocols",actor:g,target:m,sourceCardId:a.id,disallowedProtocolForLane:_}:f==="swap_protocols"&&(w.actionRequired={type:"prompt_swap_protocols",actor:g,target:m,sourceCardId:a.id,disallowedProtocolForLane:_}),{newState:w}}function O_(a,n,l,c,s){const{cardOwner:d,opponent:p}=c,f=s.count||1,h=s.random!==!1;if(l[p].hand.length===0)return{newState:ae(l,d,"Opponent has no cards in hand. Effect skipped.")};let m={...l};const g={...m[p]},y={...m[d]};if(h){const w=Math.min(f,g.hand.length),_=[];for(let $=0;$<w;$++){const E=Math.floor(Math.random()*g.hand.length),C=g.hand.splice(E,1)[0];y.hand.push(C),_.push(C)}m={...m,[d]:y,[p]:g};const b=d==="player"?"Player":"Opponent",k=`${a.protocol}-${a.value}`,S=_.map($=>d==="player"?`${$.protocol}-${$.value}`:"a card").join(", ");return m=ae(m,d,`${k}: ${b} takes ${S} from the opponent's hand.`),{newState:m}}else{console.warn("[Take Effect] Non-random take not yet implemented, falling back to random");const w=Math.floor(Math.random()*g.hand.length),_=g.hand.splice(w,1)[0];y.hand.push(_),m={...m,[d]:y,[p]:g};const b=d==="player"?"Player":"Opponent",k=`${a.protocol}-${a.value}`,S=d==="player"?`${_.protocol}-${_.value}`:"a card";return m=ae(m,d,`${k}: ${b} takes ${S} from the opponent's hand.`),{newState:m}}}function I_(a,n,l,c,s){const{cardOwner:d}=c,p=s.options||[];if(p.length!==2)return console.error(`[Choice Effect] Expected 2 options, got ${p.length}`),{newState:l};let f=ae(l,d,"[Custom Choice effect - choose one of two options]");return f.actionRequired={type:"custom_choice",options:p,sourceCardId:a.id,actor:d,laneIndex:n},{newState:f}}function L_(a,n,l,c,s){const{cardOwner:d,opponent:p}=c,h=(s.target||"opponent")==="opponent"?p:d,m={...l[h],cannotCompile:!0};let g={...l,[h]:m};const y=ve(l,a.id),w=y?`${y.card.protocol}-${y.card.value}`:"Effect";return g=ae(g,d,`${w}: ${h==="player"?"Player":"Opponent"} cannot compile next turn.`),{newState:g}}function M_(a,n,l,c,s){var g;const{cardOwner:d}=c,p=s.excludeCurrentLane!==!1,f=((g=s.laneCondition)==null?void 0:g.count)||8,h=[];for(let y=0;y<3;y++){if(p&&y===n)continue;l.player.lanes[y].length+l.opponent.lanes[y].length>=f&&h.push(y)}if(h.length===0){const y=`${a.protocol}-${a.value}`;return{newState:ae(l,d,`${y}: No line has ${f} or more cards. Effect skipped.`)}}let m={...l};return m.actionRequired={type:"select_lane_for_delete_all",sourceCardId:a.id,actor:d,validLanes:h,minCards:f},{newState:m}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function xt(a,n,l){var f;let c={...a};if(c._processingReactiveEffects)return{newState:c};c={...c,_processingReactiveEffects:!0};const s=c.processedClearCacheTriggerIds||[],d=[],p=h=>h.some(m=>m.trigger===n||m.trigger==="on_cover_or_flip"&&(n==="on_cover"||n==="on_flip"));for(const h of["player","opponent"])c[h].lanes.forEach((m,g)=>{m.forEach((y,w)=>{if(!y.isFaceUp)return;const _=c._committedCardId;if(_&&y.id===_)return;const b=y;if(!b.customEffects)return;const k=w===m.length-1;if(b.customEffects.topEffects&&p(b.customEffects.topEffects)){if(n==="after_clear_cache"&&s.includes(y.id))return;d.push({card:y,owner:h,laneIndex:g,box:"top"})}if(b.customEffects.middleEffects&&p(b.customEffects.middleEffects)){if(n==="after_clear_cache"&&s.includes(y.id))return;d.push({card:y,owner:h,laneIndex:g,box:"middle"})}if(k&&b.customEffects.bottomEffects){const S=b.customEffects.bottomEffects.filter($=>$.trigger!=="on_cover");if(S.length>0&&p(S)){if(n==="after_clear_cache"&&s.includes(y.id))return;d.push({card:y,owner:h,laneIndex:g,box:"bottom"})}}})});if(d.length===0)return delete c._processingReactiveEffects,{newState:c};for(const{card:h,owner:m,laneIndex:g,box:y}of d){const w=c[m].lanes[g],_=w==null?void 0:w.findIndex(H=>H.id===h.id);if(!(_!==void 0&&_!==-1&&((f=w[_])==null?void 0:f.isFaceUp))||y==="bottom"&&!(_===w.length-1)||n==="before_compile_delete"&&(l==null?void 0:l.cardId)!==h.id||n==="on_flip"&&(l==null?void 0:l.cardId)!==h.id||(n==="on_cover"||n==="on_flip")&&l!=null&&l.cardId&&l.cardId!==h.id)continue;const k=h,E=(y==="top"?k.customEffects.topEffects:y==="middle"?k.customEffects.middleEffects:k.customEffects.bottomEffects).filter(H=>H.trigger===n||H.trigger==="on_cover_or_flip"&&(n==="on_cover"||n==="on_flip")).filter(H=>{const q=H.reactiveTriggerActor||"self";if(!(l!=null&&l.player))return!0;if(n==="after_opponent_discard")return l.player===m;if(q==="self"){if(l.player!==m)return!1}else if(q==="opponent"&&l.player===m)return!1;return!((H.reactiveScope||"global")==="this_lane"&&(l==null?void 0:l.laneIndex)!==void 0&&g!==l.laneIndex)});if(E.length===0)continue;const C=`${h.protocol}-${h.value}`;c=Nn(c),c=Me(c,C),c=et(c,void 0);const N=m==="player"?"opponent":"player",T={cardOwner:m,actor:m,currentTurn:c.turn,opponent:N,triggerType:n};if(n==="after_clear_cache"){const H=c.processedClearCacheTriggerIds||[];c.processedClearCacheTriggerIds=[...H,h.id]}for(const H of E){const q=lt(h,g,c,T,H);if(c=_e(q.newState),c.actionRequired){const B=c._pendingCustomEffects;if(B&&B.effects.length>0){const K={type:"execute_remaining_custom_effects",sourceCardId:B.sourceCardId,laneIndex:B.laneIndex,effects:B.effects,context:B.context,actor:B.context.cardOwner};c.queuedActions=[K,...c.queuedActions||[]],delete c._pendingCustomEffects}return delete c._processingReactiveEffects,{newState:c}}}c=ma(c),c=Me(c,void 0),c=et(c,void 0)}return delete c._processingReactiveEffects,{newState:c}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function Dn(a,n,l){let c=[...a],s=[...n],d=[],p=!1;for(let f=0;f<l;f++){if(c.length===0){if(s.length===0)break;c=yn(s),s=[],p=!0}d.push(c.shift())}return{drawnCards:d,remainingDeck:c,newDiscard:s,reshuffled:p}}function No(a,n,l){const c=a[n],{drawnCards:s,remainingDeck:d,newDiscard:p,reshuffled:f}=Dn(c.deck,c.discard,l);if(s.length===0)return a;const h=s.map(_=>({..._,id:Be(),isFaceUp:!0})),m=h.map(_=>_.id),g={...c.stats,cardsDrawn:c.stats.cardsDrawn+s.length},y={...c,deck:d,discard:p,hand:[...c.hand,...h],stats:g};let w={...a,[n]:y,stats:{...a.stats,[n]:g}};return m.length>0&&(w.animationState={type:"drawCard",owner:n,cardIds:m}),f&&(w=ae(w,n,`${n==="player"?"Player":"Opponent"}'s deck is empty. Discard pile has been reshuffled into the deck.`)),s.length>0&&(w=xt(w,"after_draw",{player:n,count:s.length}).newState),w}function P_(a,n,l){const c=n==="player"?"opponent":"player";let s={...a};const d={...s[c]},p={...s[n]},{drawnCards:f,remainingDeck:h,newDiscard:m,reshuffled:g}=Dn(d.deck,d.discard,l);if(f.length>0){const y=f.map(b=>({...b,id:Be(),isFaceUp:!0})),w=y.map(b=>b.id);p.hand=[...p.hand,...y];const _={...p.stats,cardsDrawn:p.stats.cardsDrawn+f.length};p.stats=_,d.deck=h,d.discard=m,s={...s,[n]:p,[c]:d,stats:{...s.stats,[n]:_}},w.length>0&&(s.animationState={type:"drawCard",owner:n,cardIds:w}),g&&(s=ae(s,n,`${c==="player"?"Player":"Opponent"}'s deck is empty. Discard pile has been reshuffled into the deck.`))}return s}function H_(a,n){const c=5-a[n].hand.length;if(c<=0)return a;const s=n==="player"?"Player":"Opponent";let d=No(a,n,c);const p={...d[n],stats:{...d[n].stats,handsRefreshed:d[n].stats.handsRefreshed+1}};return d={...d,[n]:p,stats:{...d.stats,[n]:p.stats}},ae(d,n,`${s} refreshes their hand, drawing ${c} card(s).`)}function To(a,n){const l={...n},c=s=>s.map(d=>d.map(p=>a.has(p.id)?{...p,isFaceUp:!p.isFaceUp}:p));return l.player.lanes=c(l.player.lanes),l.opponent.lanes=c(l.opponent.lanes),_e(l)}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Ch=a=>{const n=yn(fa(a)),{drawnCards:l,remainingDeck:c}=Dn(n,[],5),s={cardsPlayed:0,cardsDiscarded:0,cardsDeleted:0,cardsFlipped:0,cardsShifted:0,cardsDrawn:l.length,handsRefreshed:0},d=l.map(p=>({...p,id:Be(),isFaceUp:!0}));return{protocols:a,deck:c,hand:d,lanes:[[],[],[]],discard:[],compiled:[!1,!1,!1],laneValues:[0,0,0],cannotCompile:!1,stats:s}},Cl=(a,n,l,c="player")=>{const s=Ch(a),d=Ch(n),p={player:s,opponent:d,turn:c,phase:"start",controlCardHolder:null,useControlMechanic:l,winner:null,log:[],actionRequired:null,queuedActions:[],animationState:null,compilableLanes:[],processedStartEffectIds:[],processedEndEffectIds:[],lastPlayedCardId:void 0,stats:{player:s.stats,opponent:d.stats}},f=c==="player"?"Player":"Opponent",h=a.join(", "),m=n.join(", ");let g=ae(p,"player","Game Started.");return g=ae(g,"player",`Player protocols: ${h}`),g=ae(g,"opponent",`Opponent protocols: ${m}`),g=ae(g,"player",`${f} goes first.`),g},Pn=(a,n,l,c,s)=>{if(a.isFaceUp)return a.value;if(n.some(p=>p.isFaceUp&&p.protocol==="Darkness"&&p.value===2))return 4;if(l&&c!==void 0&&s!==void 0){const p=Xh(l);for(const f of p)if(f.type==="set_to_fixed"){if(!(f.scope==="global"||f.scope==="this_lane"&&f.laneIndex===c))continue;const m=f.cardOwner;if(f.target==="own_cards"&&m!==s||f.target==="opponent_cards"&&m===s)continue;const g=f.filter;if(g&&(!g.faceState||g.faceState==="any"||g.faceState==="face_down"&&!a.isFaceUp||g.faceState==="face_up"&&a.isFaceUp))return f.value}}return 2},bh=(a,n,l,c)=>{let s=0;for(const d of a)d.isFaceUp?s+=d.value:s+=Pn(d,a,n,l,c);return Math.max(0,s)};function Xh(a){const n=[];for(const l of["player","opponent"])a[l].lanes.forEach((c,s)=>{c.forEach(d=>{if(d.isFaceUp){const p=d;p.customEffects&&[...p.customEffects.topEffects||[],...p.customEffects.middleEffects||[],...p.customEffects.bottomEffects||[]].forEach(h=>{h.params.action==="value_modifier"&&h.trigger==="passive"&&n.push({...h.params.modifier,cardOwner:l,laneIndex:s})})}})});return n}function z_(a,n,l){const c=Xh(a),s=[...n],d=[...l];for(const p of c){const{type:f,value:h,condition:m,target:g,scope:y,filter:w,cardOwner:_,laneIndex:b}=p,k=y==="global"?[0,1,2]:[b];for(const S of k)switch(f){case"add_per_condition":{if(!m)continue;let $=0;const E=a.player.lanes[S],C=a.opponent.lanes[S];m==="per_face_down_card"?$=E.filter(N=>!N.isFaceUp).length+C.filter(N=>!N.isFaceUp).length:m==="per_face_up_card"?$=E.filter(N=>N.isFaceUp).length+C.filter(N=>N.isFaceUp).length:m==="per_card"?$=E.length+C.length:m==="per_card_in_hand"&&($=a[_].hand.length),g==="own_total"&&_==="player"?s[S]+=h*$:g==="own_total"&&_==="opponent"||g==="opponent_total"&&_==="player"?d[S]+=h*$:g==="opponent_total"&&_==="opponent"&&(s[S]+=h*$);break}case"set_to_fixed":break;case"add_to_total":{g==="own_total"&&_==="player"?s[S]+=h:g==="own_total"&&_==="opponent"||g==="opponent_total"&&_==="player"?d[S]+=h:g==="opponent_total"&&_==="opponent"&&(s[S]+=h);break}}}return{finalPlayerValues:s.map(p=>Math.max(0,p)),finalOpponentValues:d.map(p=>Math.max(0,p))}}function V_(a,n,l){let c=[...n],s=[...l];return{finalPlayerValues:c,finalOpponentValues:s}}const _e=a=>{const n=a.player.lanes.map((p,f)=>bh(p,a,f,"player")),l=a.opponent.lanes.map((p,f)=>bh(p,a,f,"opponent")),c=V_(a,n,l),{finalPlayerValues:s,finalOpponentValues:d}=z_(a,c.finalPlayerValues,c.finalOpponentValues);return{...a,player:{...a.player,laneValues:s},opponent:{...a.opponent,laneValues:d}}},Zh=(a,n)=>{const l=[],c=a[n],s=a[n==="player"?"opponent":"player"];if(!c.cannotCompile)for(let d=0;d<3;d++){const p=c.laneValues[d],f=s.laneValues[d];p>=10&&p>f&&l.push(d)}return l},Fn=(a,n,l)=>a[n].laneValues[l],B_=(a,n)=>{const l=n==="player"?"opponent":"player",c=[];for(let s=0;s<3;s++){const d=a[n].laneValues[s];a[l].laneValues[s]>d&&c.push(s)}return c},Kh=(a,n)=>{const l=n==="player"?"opponent":"player";let c=-1,s=[];for(let d=0;d<3;d++){const p=a[l].laneValues[d];p>c?(c=p,s=[d]):p===c&&s.push(d)}return s};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Y_=["select_card_to_flip","select_any_card_to_flip"];function G_(a,n,l){if(!l||!Y_.includes(l.type))return null;const c=ve(a,n);if(c&&c.card.protocol==="Metal"&&c.card.value===6){const s="actor"in l?l.actor:a.turn,d=s==="player"?"Player":"Opponent",p=c.owner==="player"?"Player's":"Opponent's";let f="An effect";if("sourceCardId"in l&&l.sourceCardId){const E=ve(a,l.sourceCardId);E&&(f=`${E.card.protocol}-${E.card.value}`)}let h=ae(a,s,`${f}: ${d} flips ${p} Metal-6.`);h=ae(h,s,"Metal-6: Deletes itself when flipped.");const m={...a.stats[s],cardsDeleted:a.stats[s].cardsDeleted+1},g={...a[s],stats:m};h={...h,[s]:g,stats:{...h.stats,[s]:m}};const y=c.owner,w=a[y].lanes.findIndex(E=>E.some(C=>C.id===n)),_=a[y].lanes[w],b=_&&_.length>0&&_[_.length-1].id===n,k=_&&_.length>1,S=a._pendingCustomEffects,$=(E,C)=>{var K,U;let N={...E};const T=S&&((K=N.queuedActions)==null?void 0:K.some(R=>R.type==="execute_remaining_custom_effects"&&R.sourceCardId===S.sourceCardId));S&&!T&&(N._pendingCustomEffects=S,N.lastCustomEffectTargetCardId=n);let q=xt(N,"after_delete",{player:N.turn}).newState;if(b&&k&&(q=vn(q,y,w).newState),l&&"count"in l&&l.count>1){const R=l.count-1;return q.actionRequired={...l,count:R},{...q,animationState:null}}if(N.actionRequired||N.queuedActions&&N.queuedActions.length>0)return{...q,actionRequired:N.actionRequired,queuedActions:N.queuedActions,animationState:null};const B=S&&((U=q.queuedActions)==null?void 0:U.some(R=>R.type==="execute_remaining_custom_effects"&&R.sourceCardId===S.sourceCardId));if(S&&!q._pendingCustomEffects&&!B&&(q._pendingCustomEffects=S,q.lastCustomEffectTargetCardId=n),q=We(q),q.actionRequired=null,q.queuedActions&&q.queuedActions.length>0){const R=[...q.queuedActions],j=R.shift();if((j==null?void 0:j.type)==="execute_remaining_custom_effects"){const F={...q,queuedActions:[j,...R]},M=ya(F);if(M.actionRequired)return{...M,animationState:null};if(M.queuedActions&&M.queuedActions.length>0){const L=[...M.queuedActions],D=L.shift();return{...M,actionRequired:D,queuedActions:L,animationState:null}}return C(M)}return{...q,actionRequired:j,queuedActions:R,animationState:null}}return C(q)};return{nextState:{...h,actionRequired:null},requiresAnimation:{animationRequests:[{type:"delete",cardId:n,owner:c.owner}],onCompleteCallback:$},requiresTurnEnd:!1}}return null}const _d=(a,n)=>{var p,f,h,m,g,y,w,_,b,k,S,$,E,C;if(!a.actionRequired)return{nextState:a};let l={...a},c=!0,s=null;const d=G_(a,n,a.actionRequired);if(d)return d;switch(a.actionRequired.type){case"select_card_to_flip":{const N=a._committedCardId;if(N&&n===N)return{nextState:a};if(!jl(a,n).allowed)return{nextState:a};const H=ve(a,n),q="draws"in a.actionRequired?a.actionRequired.draws:0;l=yd(a,n);const B=n;if(l.lastCustomEffectTargetCardId=B,q&&q>0){const{actor:L,sourceCardId:D}=a.actionRequired,O=ve(l,D),X=O?`${O.card.protocol}-${O.card.value}`:"A card effect";l=ae(l,L,`${X}: Drawing ${q} card(s).`),l=No(l,L,q)}if(H&&!H.card.isFaceUp){const L=vd(l,n);l=L.newState,l.lastCustomEffectTargetCardId=B,L.animationRequests&&(s={animationRequests:L.animationRequests,onCompleteCallback:(D,O)=>D.actionRequired||D.queuedActions&&D.queuedActions.length>0?D:O(D)})}const K=(p=a.actionRequired)==null?void 0:p.followUpEffect,U=(f=a.actionRequired)==null?void 0:f.sourceCardId;K&&U&&(l=C_(l,n,U));const R=((h=a.actionRequired)==null?void 0:h.actor)||a.turn;l=xt(l,"after_flip",{player:R,cardId:n}).newState;const F=l._pendingCustomEffects;if(F&&F.effects.length>0){const L={type:"execute_remaining_custom_effects",sourceCardId:F.sourceCardId,laneIndex:F.laneIndex,effects:F.effects,context:F.context,actor:F.context.cardOwner,selectedCardFromPreviousEffect:F.effects[0].useCardFromPreviousEffect?n:void 0};l.queuedActions=[...l.queuedActions||[],L],delete l._pendingCustomEffects}const M=(m=a.actionRequired)==null?void 0:m.remainingLanes;if(M&&M.length>0&&!l.actionRequired){const L=M[0],D=M.slice(1),O=(g=a.actionRequired)==null?void 0:g.params,X=(y=a.actionRequired)==null?void 0:y.sourceCardId,ne=(w=a.actionRequired)==null?void 0:w.actor,z=(_=a.actionRequired)==null?void 0:_.targetFilter;l.actionRequired={type:"select_card_to_flip",sourceCardId:X,actor:ne,currentLaneIndex:L,remainingLanes:D,targetFilter:z,params:O,followUpEffect:(b=a.actionRequired)==null?void 0:b.followUpEffect,conditionalType:(k=a.actionRequired)==null?void 0:k.conditionalType}}(l.actionRequired||l.queuedActions&&l.queuedActions.length>0)&&(c=!1);break}case"select_card_to_shift":{const{sourceCardId:N,optional:T}=a.actionRequired;if(T&&N){const q=ve(a,N);if(!q||!q.card.isFaceUp){const B=q?`${q.card.protocol}-${q.card.value}`:"the source card",K=a._logSource;l=Me(a,B),l=ae(l,a.actionRequired.actor,"Shift was cancelled because the source is no longer active."),l=Me(l,K),l=We(l),l.actionRequired=null,c=!0;break}}const H=ve(a,n);if(H){const{owner:q}=H;let B=-1;for(let D=0;D<a[q].lanes.length;D++)if(a[q].lanes[D].some(O=>O.id===n)){B=D;break}if(B===-1)return{nextState:a,requiresTurnEnd:!1};const U=(a.actionRequired.targetFilter||{}).position||"uncovered",R=a[q].lanes[B],F=R.findIndex(D=>D.id===n)===R.length-1;if(U==="uncovered"&&!F)return{nextState:a,requiresTurnEnd:!1};if(U==="covered"&&F)return{nextState:a,requiresTurnEnd:!1};const M=a.actionRequired.scope,L=a.actionRequired.sourceLaneIndex;if(M==="this_lane"&&L!==void 0&&B!==L)return{nextState:a,requiresTurnEnd:!1};if(B!==-1){const D=a.actionRequired.targetLaneIndex;if(D!==void 0){const X=a.actionRequired.actor;l=Qa(a,n,q,D,X).newState,c=!l.actionRequired;break}const O={type:"select_lane_for_shift",cardToShiftId:n,cardOwner:q,originalLaneIndex:B,sourceCardId:a.actionRequired.sourceCardId,actor:a.actionRequired.actor,destinationRestriction:a.actionRequired.destinationRestriction,followUpEffect:a.actionRequired.followUpEffect,conditionalType:a.actionRequired.conditionalType};l.actionRequired=O}}c=!1;break}case"delete_self":{const{sourceCardId:N,cardToDeleteId:T,actor:H}=a.actionRequired,q=ve(a,T);if(!q){l=ae(a,H,"Card no longer on board. Delete skipped."),l=We(l),l.actionRequired=null,c=!0;break}const{owner:B,laneIndex:K}=q,U=a[B].lanes[K][a[B].lanes[K].length-1].id===T,R=[...a[B].lanes[K]],j=R.findIndex(D=>D.id===T);R.splice(j,1);const F=[...a[B].lanes];F[K]=R;let M={...a,[B]:{...a[B],lanes:F}};l=We(M),l.actionRequired=null;const L={...l.stats[H],cardsDeleted:l.stats[H].cardsDeleted+1};l={...l,stats:{...l.stats,[H]:L}},U&&R.length>0&&(l=vn(l,B,K).newState),c=!0;break}case"select_cards_to_delete":case"select_face_down_card_to_delete":case"select_low_value_card_to_delete":case"select_card_from_other_lanes_to_delete":{const{sourceCardId:N,actor:T}=a.actionRequired,H=ve(a,N);if(!H||!H.card.isFaceUp){const G=H?`${H.card.protocol}-${H.card.value}`:"the source card";l=ae(a,T,`Effect from ${G} was cancelled because the source is no longer active.`),l=We(l),l.actionRequired=null,c=!0;break}const q=ve(a,n);if(!q)return{nextState:a};if(a.actionRequired.protocolMatching){const G=a.actionRequired.protocolMatching,Z=a[q.owner].lanes.findIndex(Q=>Q.some(I=>I.id===n));if(Z!==-1){const Q=a.player.protocols[Z],I=a.opponent.protocols[Z],W=q.card.protocol,Y=W===Q||W===I;if(G==="must_match"&&!Y)return console.error(`Illegal delete: ${W}-${q.card.value} in lane ${Z} (protocols: ${Q}/${I}) - card must be in lane with matching protocol`),{nextState:a};if(G==="must_not_match"&&Y)return console.error(`Illegal delete: ${W}-${q.card.value} in lane ${Z} (protocols: ${Q}/${I}) - card must be in lane without matching protocol`),{nextState:a}}}const B=a.actionRequired.targetFilter;if((B==null?void 0:B.calculation)==="highest_value"||(B==null?void 0:B.calculation)==="lowest_value"){const G=B.owner,Z=G==="opponent"?T==="player"?"opponent":"player":G==="own"?T:q.owner,I=E_(a,Z).some(Y=>Y.card.id===n),W=B.calculation==="highest_value"?"highest":"lowest";if(!I)return console.error(`Illegal delete: Card ${n} is not one of the ${W} value uncovered cards`),{nextState:a}}const K=T==="player"?"Player":"Opponent",U=q.owner==="player"?"Player's":"Opponent's",R=a[q.owner].lanes.findIndex(G=>G.some(Z=>Z.id===n)),j=R!==-1?a[q.owner].protocols[R]:"unknown",F=q.card.isFaceUp?`${q.card.protocol}-${q.card.value}`:`face-down card in Protocol ${j}`,M=ve(a,a.actionRequired.sourceCardId),L=M?`${M.card.protocol}-${M.card.value}`:"a card effect";l=ae(l,T,`${L}: ${K} deletes ${U} ${F}.`);const D={...l.stats[T],cardsDeleted:l.stats[T].cardsDeleted+1},O={...l[T],stats:D};l={...l,[T]:O,stats:{...l.stats,[T]:D}};const X=a[q.owner].lanes.findIndex(G=>G.some(Z=>Z.id===n)),ne=a[q.owner].lanes[X],z=ne&&ne.length>0&&ne[ne.length-1].id===n;l=We(l),l.actionRequired=null,s={animationRequests:[{type:"delete",cardId:n,owner:q.owner}],onCompleteCallback:(G,Z)=>{var Le,Je,at;const Q=a.actionRequired.actor,I=a.actionRequired;let Y=xt(G,"after_delete",{player:Q}).newState;Y=We(Y);let de=null;const ee=ve(Y,I.sourceCardId),ge=Xa(Y,I.sourceCardId),Se=I.followUpEffect;if(ee&&ee.card.isFaceUp&&ge){const we=I.remainingLanes;if(I.type==="select_cards_to_delete"&&we&&we.length>0){const Ce=we[0],Ie=we.slice(1);de={type:"select_cards_to_delete",count:((Le=I.params)==null?void 0:Le.count)||I.count,sourceCardId:I.sourceCardId,actor:I.actor,currentLaneIndex:Ce,remainingLanes:Ie,disallowedIds:(Je=I.params)!=null&&Je.excludeSelf?[I.sourceCardId]:[],targetFilter:I.targetFilter,scope:I.scope,protocolMatching:I.protocolMatching,params:I.params}}else if(I.type==="select_cards_to_delete"&&I.count>1)de={type:"select_cards_to_delete",count:I.count-1,sourceCardId:I.sourceCardId,disallowedIds:[...I.disallowedIds,n],actor:I.actor,followUpEffect:Se};else if(I.type==="select_card_from_other_lanes_to_delete"&&I.count>1){const Ce=a[q.owner].lanes.findIndex(Qe=>Qe.some(Mt=>Mt.id===n)),Ie=[...I.lanesSelected,Ce];[0,1,2].filter(Qe=>Qe!==I.disallowedLaneIndex&&!Ie.includes(Qe)).some(Qe=>Y.player.lanes[Qe].length>0||Y.opponent.lanes[Qe].length>0)?de={type:"select_card_from_other_lanes_to_delete",count:I.count-1,sourceCardId:I.sourceCardId,disallowedLaneIndex:I.disallowedLaneIndex,lanesSelected:Ie,actor:I.actor}:Y=ae(Y,I.actor,"No cards left in remaining lanes. Effect skipped.")}}else if("count"in I&&I.count>1){const we=ee?`${ee.card.protocol}-${ee.card.value}`:"the source card",Ce=!ee||!ee.card.isFaceUp?"the source is no longer active":"the source was covered";Y=ae(Y,I.actor,`Remaining deletes from ${we} were cancelled because ${Ce}.`)}let ye=!1;if(z){const we=Y,Ce=vn(we,q.owner,X),Ie=Ce.newState._interruptedTurn!==void 0;we._interruptedTurn&&!Ce.newState._interruptedTurn&&(ye=!0);const ze=[...Ce.newState.queuedActions||[]];de&&(Ie?ze.push(de):ze.unshift(de)),Y={...Ce.newState,queuedActions:ze}}else de&&(Y.queuedActions=[...Y.queuedActions||[],de]);if(Se&&!de)if(Y.actionRequired){const we=ve(Y,I.sourceCardId),Ce=I.actor==="player"?"opponent":"player";let Ie=-1;we&&(Ie=Y[we.owner].lanes.findIndex(Qe=>Qe.some(Mt=>Mt.id===I.sourceCardId)));const ze={cardOwner:I.actor,actor:I.actor,currentTurn:Y.turn,opponent:Ce,triggerType:"start"},wt={type:"execute_remaining_custom_effects",sourceCardId:I.sourceCardId,actor:I.actor,laneIndex:Ie,effects:[Se],context:ze};Y.queuedActions=[...Y.queuedActions||[],wt]}else{const we=ve(Y,I.sourceCardId),Ce=I.actor==="player"?"opponent":"player";if(we){const Ie=Y[we.owner].lanes.findIndex(Mt=>Mt.some(rn=>rn.id===I.sourceCardId)),ze={cardOwner:I.actor,actor:I.actor,currentTurn:Y.turn,opponent:Ce,triggerType:"start"},wt=`${we.card.protocol}-${we.card.value}`;Y=Me(Y,wt),Y=et(Y,"start"),Y=lt(we.card,Ie,Y,ze,Se).newState,Y=We(Y)}else(at=Se.params)!=null&&at.deleteSelf&&(Y=Me(Y,"the source card"),Y=et(Y,"start"),Y=internalDeleteCard(Y,I.sourceCardId).newState,Y=ae(Y,I.actor,"Deletes itself."))}if(Y.actionRequired)return Y;if(Y.queuedActions&&Y.queuedActions.length>0){const we=Y.queuedActions[0];if((we==null?void 0:we.type)==="execute_remaining_custom_effects"){const ze=ya(Y);return ze.actionRequired?ze:Z(ze)}const Ce=[...Y.queuedActions],Ie=Ce.shift();if((Ie==null?void 0:Ie.type)==="shift_flipped_card_optional"||(Ie==null?void 0:Ie.type)==="gravity_2_shift_after_flip"){const ze=ve(Y,Ie.sourceCardId),wt=Xa(Y,Ie.sourceCardId);if(!ze||!ze.card.isFaceUp||!wt){const Qe=ze?`${ze.card.protocol}-${ze.card.value}`:"the source card";let Mt=ae(Y,Ie.actor,`Shift from ${Qe} was cancelled because the source is no longer active.`);if(Ce.length>0){const rn=Ce.shift();return{...Mt,actionRequired:rn,queuedActions:Ce}}else return Z({...Mt,actionRequired:null,queuedActions:[]})}}return{...Y,actionRequired:Ie,queuedActions:Ce}}if(ye){if(Y.queuedActions&&Y.queuedActions.length>0){const we=[...Y.queuedActions],Ce=we.shift();if((Ce==null?void 0:Ce.type)==="execute_remaining_custom_effects"){const Ie={...Y,queuedActions:[Ce,...we]},ze=ya(Ie);return ze.actionRequired?ze:Y}return{...Y,actionRequired:Ce,queuedActions:we}}return Y}if(Se&&ee&&ee.card.isFaceUp&&(!((Se.position||"middle")!=="top")||ge)){const ze=Y[ee.owner].lanes.findIndex(Hn=>Hn.some(ga=>ga.id===I.sourceCardId)),wt=I.actor==="player"?"opponent":"player",Qe=Se.trigger||"on_play",Mt={cardOwner:I.actor,actor:I.actor,currentTurn:Y.turn,opponent:wt,triggerType:Qe};if(Y=lt(ee.card,ze,Y,Mt,Se).newState,ve(Y,I.sourceCardId),Y.actionRequired)return Y}return Z(Y)}},c=!1;break}case"plague_4_opponent_delete":{const N=ve(a,n);if(!N)return{nextState:a};const T=a.actionRequired.actor;l=ae(l,T,"Plague-4: Opponent deletes one of their face-down cards.");const H={...l.stats[T],cardsDeleted:l.stats[T].cardsDeleted+1},q={...l[T],stats:H};l={...l,[T]:q,stats:{...l.stats,[T]:H}};const B=a[N.owner].lanes.findIndex(R=>R.some(j=>j.id===n)),K=a[N.owner].lanes[B],U=K&&K.length>0&&K[K.length-1].id===n;l=We(l),l.actionRequired=null,s={animationRequests:[{type:"delete",cardId:n,owner:N.owner}],onCompleteCallback:(R,j)=>{let M=xt(R,"after_delete",{player:T}).newState;U&&(M=vn(M,N.owner,B).newState);const L=ve(M,a.actionRequired.sourceCardId),D=(L==null?void 0:L.owner)||a.turn,O={type:"plague_4_player_flip_optional",sourceCardId:a.actionRequired.sourceCardId,optional:!0,actor:D};return M.actionRequired?M.queuedActions=[...M.queuedActions||[],O]:M.actionRequired=O,M}},c=!1;break}case"select_card_to_return":{const{sourceCardId:N,actor:T}=a.actionRequired,H=(S=a.actionRequired)==null?void 0:S.followUpEffect,q=($=a.actionRequired)==null?void 0:$.conditionalType,B=(E=a.actionRequired)==null?void 0:E.targetFilter,K=ve(a,n);if(K){const R=a[K.owner].lanes[K.laneIndex],j=((C=R[R.length-1])==null?void 0:C.id)===n,F=(B==null?void 0:B.position)==="covered"||(B==null?void 0:B.position)==="any";if(!j&&!F)return console.error(`[cardResolver] Invalid return target: ${K.card.protocol}-${K.card.value} is covered`),{nextState:a,requiresTurnEnd:!1}}const U=gd(a,n);if(l=U.newState,U.animationRequests)s={animationRequests:U.animationRequests,onCompleteCallback:(R,j)=>{if(R.actionRequired)return R;let F=R;if(H&&N&&(q!=="if_executed"||n)){const L=ve(F,N);if(L&&L.card.isFaceUp){const D=F[L.owner].lanes.find(z=>z.some(G=>G.id===N)),O=F[L.owner].lanes.indexOf(D),X={cardOwner:L.owner,actor:T,currentTurn:F.turn,opponent:L.owner==="player"?"opponent":"player"};if(F=lt(L.card,O,F,X,H).newState,F.actionRequired)return F}}return j(F)}};else if(H&&N&&(q!=="if_executed"||n)){const j=ve(l,N);if(j&&j.card.isFaceUp){const F=l[j.owner].lanes.find(O=>O.some(X=>X.id===N)),M=l[j.owner].lanes.indexOf(F),L={cardOwner:j.owner,actor:T,currentTurn:l.turn,opponent:j.owner==="player"?"opponent":"player"};l=lt(j.card,M,l,L,H).newState}}l=We(l),c=!l.actionRequired&&(!l.queuedActions||l.queuedActions.length===0);break}case"select_opponent_card_to_return":{const{sourceCardId:N,actor:T}=a.actionRequired,H=gd(a,n);let q=H.newState;if(q.actionRequired){const B={type:"flip_self",sourceCardId:N,actor:T};q.queuedActions=[B,...q.queuedActions||[]],l=q,c=!1}else{const B=ve(q,N);if(B){const K=`${B.card.protocol}-${B.card.value}`;q=ae(q,T,`${K}: Flips itself.`),q=To(new Set([N]),q),q.animationState={type:"flipCard",cardId:N}}l=q,c=!0}H.animationRequests&&(s={animationRequests:H.animationRequests,onCompleteCallback:(B,K)=>B.actionRequired?B:K(B)}),l=We(l),c||(c=!l.actionRequired&&(!l.queuedActions||l.queuedActions.length===0));break}case"select_any_card_to_flip":{const N=ve(a,n),{count:T,sourceCardId:H,actor:q}=a.actionRequired,B=ve(a,H);if(!B||!B.card.isFaceUp){const R=B?`${B.card.protocol}-${B.card.value}`:"a card";l=ae(a,q,`Effect from ${R} was cancelled because the source is no longer active.`),l=We(l),l.actionRequired=null,c=!0;break}let K=null;T>1&&(K={type:"select_any_card_to_flip",count:T-1,sourceCardId:H,actor:q});let U=yd(a,n,K);if(N&&!N.card.isFaceUp){const R=vd(U,n),j=R.newState.actionRequired;j&&j!==K&&K&&(R.newState.queuedActions=[...R.newState.queuedActions||[],K]),l=R.newState,R.animationRequests&&(s={animationRequests:R.animationRequests,onCompleteCallback:(F,M)=>F.actionRequired||F.queuedActions&&F.queuedActions.length>0?F:M(F)})}else l=U;l=We(l),c=!l.actionRequired&&(!l.queuedActions||l.queuedActions.length===0);break}case"select_board_card_to_reveal_custom":{const{sourceCardId:N,actor:T,followUpAction:H,optional:q}=a.actionRequired,B=T.charAt(0).toUpperCase()+T.slice(1),K=ve(a,n);if(!K)return{nextState:a,requiresTurnEnd:!0};const U=K.owner,R=a[U].lanes.findIndex(D=>D.some(O=>O.id===n));if(R===-1)return{nextState:a,requiresTurnEnd:!0};const j=[...a[U].lanes[R]],F=j.findIndex(D=>D.id===n);if(F===-1)return{nextState:a,requiresTurnEnd:!0};j[F]={...j[F],isFaceUp:!0};const M=[...a[U].lanes];M[R]=j,l={...a,[U]:{...a[U],lanes:M}};const L=`${j[F].protocol}-${j[F].value}`;l=ae(l,T,`${B} reveals ${L}.`),l.actionRequired={type:"prompt_shift_or_flip_board_card_custom",sourceCardId:N,revealedCardId:n,followUpAction:H,optional:q!==!1,actor:T},c=!1;break}case"select_phase_effect":{const N=a.actionRequired;if(!N.availableEffects.find(q=>q.cardId===n))return console.warn(`[cardResolver] Invalid phase effect selection: ${n} not in available effects`),{nextState:a};const H=N.phase==="Start"?"_selectedStartEffectId":"_selectedEndEffectId";l[H]=n,l.actionRequired=null,c=!1;break}default:return{nextState:a,requiresTurnEnd:!0}}if(!s&&l.actionRequired===null){if(l.queuedActions&&l.queuedActions.length>0){const N=[...l.queuedActions],T=N.shift();if((T==null?void 0:T.type)==="execute_remaining_custom_effects")return{nextState:{...We(l),actionRequired:null,queuedActions:[T,...N]},requiresTurnEnd:!1};if((T==null?void 0:T.type)==="shift_flipped_card_optional"||(T==null?void 0:T.type)==="gravity_2_shift_after_flip"){const H=ve(l,T.sourceCardId),q=Xa(l,T.sourceCardId);if(!H||!H.card.isFaceUp||!q){const B=H?`${H.card.protocol}-${H.card.value}`:"the source card",K=ae(l,T.actor,`Shift from ${B} was cancelled because the source is no longer active.`);if(N.length>0){const U=N.shift();return(U==null?void 0:U.type)==="execute_remaining_custom_effects"?{nextState:{...K,queuedActions:[U,...N]},requiresTurnEnd:!1}:{nextState:{...K,actionRequired:U,queuedActions:N},requiresTurnEnd:!1}}else return{nextState:{...K,actionRequired:null,queuedActions:[]},requiresTurnEnd:!0}}}return(T==null?void 0:T.type)==="execute_remaining_custom_effects"?{nextState:{...l,queuedActions:[T,...N]},requiresTurnEnd:!1}:{nextState:{...l,actionRequired:T,queuedActions:N},requiresTurnEnd:!1}}}else!s&&l.actionRequired!==null&&(c=!1);return{nextState:l,requiresAnimation:s,requiresTurnEnd:c}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Yi=(a,n,l,c,s,d=s)=>{const p={...a[s]},f=p.hand.find(U=>U.id===n);if(!f)return{newState:a};if(d===s){const U=ha(a,s,l,c,f.protocol);if(!U.allowed)return console.error(`Illegal Move: ${s} tried to play ${f.protocol}-${f.value} - ${U.reason}`),{newState:a}}const h=s==="player"?"opponent":"player",g=a[d==="player"?"opponent":"player"].lanes[l],y=g.length>0?g[g.length-1]:null;if(y&&y.isFaceUp&&y.protocol==="Plague"&&y.value===0)return{newState:a};if(!c&&y&&y.isFaceUp&&y.protocol==="Metal"&&y.value===2)return console.error(`Illegal Move: ${s} tried to play face-down against Metal-2 in lane ${l}`),{newState:a};if(c){const U=a[d].protocols[l],R=p.protocols[l],j=a[h].protocols[l],F=a[h].lanes.flat().some(G=>G.isFaceUp&&G.protocol==="Psychic"&&G.value===1),M=[...a.player.lanes.flat(),...a.opponent.lanes.flat()].some(G=>G.isFaceUp&&G.protocol==="Anarchy"&&G.value===1),L=Ki(a),D=a[s].lanes.flat().some(G=>G.isFaceUp&&G.protocol==="Spirit"&&G.value===1),O=a[s].lanes.some(G=>{if(G.length===0)return!1;const Z=G[G.length-1];return Z.isFaceUp&&Z.protocol==="Chaos"&&Z.value===3}),X=Ji(a,s,l),ne=Rl(a,f);let z;if(ne?z=!F:d!==s?z=f.protocol===U&&!F:M||L?z=f.protocol!==R&&f.protocol!==j&&!F:z=(f.protocol===R||f.protocol===j||D||O||X)&&!F,!z){const G=M||L?"Non-matching protocol required":"matching protocol required";return console.error(`Illegal Move: ${s} tried to play ${f.protocol}-${f.value} face-up in lane ${l} (${G}, protocols: player=${R}, opponent=${j})`),{newState:a}}}let w={...a,_committedCardId:n},_={newState:w};const b=w[d].lanes[l];if(b.length>0){const U=b[b.length-1];let j=xt(w,"on_cover",{player:d,cardId:U.id}).newState;if(j[d].lanes[l].some(L=>L.id===U.id)&&U.isFaceUp){const L={cardOwner:d,actor:s,currentTurn:j.turn,opponent:d==="player"?"opponent":"player",triggerType:"cover"};_=Rd(U,l,j,L)}else _={newState:j}}const k=_.newState,S={...f,isFaceUp:c,isRevealed:!1},$={...k[s]},E={...$.stats,cardsPlayed:$.stats.cardsPlayed+1};let C;if(d===s){const U={...$,hand:$.hand.filter(R=>R.id!==n),lanes:$.lanes.map((R,j)=>j===l?[...R,S]:R),stats:E};C={...k,[s]:U,stats:{...k.stats,[s]:E}}}else{const U={...$,hand:$.hand.filter(F=>F.id!==n),stats:E},R={...k[d]},j={...R,lanes:R.lanes.map((F,M)=>M===l?[...F,S]:F)};C={...k,[s]:U,[d]:j,stats:{...k.stats,[s]:E}}}const N=a.queuedActions||[],T=k.queuedActions||[];T===N||T.length===N.length&&T.every((U,R)=>U===N[R])?N.length>0&&(C.queuedActions=N):C.queuedActions=[...N,...T],C.lastPlayedCardId=S.id,C=_e(C),C=Me(C,void 0),C=et(C,void 0),C={...C,_logIndentLevel:0};const H=s==="player"?"Player":"Opponent",q=C[d].protocols[l];let B;if(s==="opponent"&&!c)B=`${H} plays a face-down card into Protocol ${q}.`;else{const U=`${f.protocol}-${f.value}`;B=`${H} plays ${U}`,c||(B+=" face-down"),d!==s?B+=` into ${d==="player"?"Player's":"Opponent's"} Protocol ${q}.`:B+=` into Protocol ${q}.`}if(C=ae(C,s,B),C=xt(C,"after_play",{player:s,cardId:S.id,laneIndex:l}).newState,k.actionRequired)return c&&(C.queuedEffect={card:S,laneIndex:l}),{newState:C,animationRequests:_.animationRequests};{if(C={...C,_committedCardId:void 0},s==="opponent")return c&&(C.queuedEffect={card:S,laneIndex:l}),{newState:C,animationRequests:_.animationRequests};let U={newState:C};if(c&&!C.actionRequired){const j={cardOwner:d,actor:s,currentTurn:C.turn,opponent:d==="player"?"opponent":"player",triggerType:"play"};U=Dl(S,l,C,j)}const R=[..._.animationRequests||[],...U.animationRequests||[]];return{newState:U.newState,animationRequests:R.length>0?R:void 0}}},Tl=(a,n)=>{let l=Me(a,void 0);return l=et(l,void 0),l={...l,_logIndentLevel:0},H_(l,n)},Jh=(a,n)=>{if(a.useControlMechanic&&a.controlCardHolder===n){let l=ae(a,n,`${n==="player"?"Player":"Opponent"} has Control and may rearrange protocols before refreshing.`);return l=Nn(l),{...l,controlCardHolder:null,actionRequired:{type:"prompt_use_control_mechanic",sourceCardId:"CONTROL_MECHANIC",actor:n,originalAction:{type:"fill_hand"}}}}return Tl(a,n)};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const xd=(a,n)=>{var s,d,p,f,h,m,g,y,w,_,b,k,S,$,E;if(!a.actionRequired)return{nextState:a};let l={...a},c=null;switch(a.actionRequired.type){case"select_lane_for_shift_all":{const{cardsToShift:C,validDestinationLanes:N,sourceLaneIndex:T,actor:H,sourceCardId:q}=a.actionRequired;if(!N.includes(n))return console.error(`Illegal shift: Lane ${n} is not a valid destination`),{nextState:a};if(n===T)return console.error(`Illegal shift: Cannot shift to the same lane ${T}`),{nextState:a};let B={...a};const K=[];for(const{cardId:U,owner:R}of C){if(!ve(B,U))continue;const F=B[R].lanes.findIndex(D=>D.some(O=>O.id===U));if(F===-1||!Al(B,F,n).allowed)continue;const L=Qa(B,U,R,n,H);B=L.newState,L.animationRequests&&K.push(...L.animationRequests)}if(l=B,l=We(l),l.actionRequired=null,K.length>0){const U=(s=a.actionRequired)==null?void 0:s.followUpEffect,R=(d=a.actionRequired)==null?void 0:d.conditionalType;c={animationRequests:K,onCompleteCallback:(j,F)=>{if(j.actionRequired||j.queuedActions&&j.queuedActions.length>0)return j;let M=j;if(U&&q&&(R!=="if_executed"||K.length>0)){const D=ve(M,q);if(D&&D.card.isFaceUp){const O=M[D.owner].lanes.find(G=>G.some(Z=>Z.id===q)),X=M[D.owner].lanes.indexOf(O),ne={cardOwner:D.owner,actor:H,currentTurn:M.turn,opponent:D.owner==="player"?"opponent":"player"};if(M=lt(D.card,X,M,ne,U).newState,M.actionRequired)return M}}return F(M)}}}break}case"select_lane_for_shift":{const{cardToShiftId:C,cardOwner:N,actor:T,sourceEffect:H,originalLaneIndex:q,sourceCardId:B}=a.actionRequired;if(n===q)return console.error(`Illegal shift: Cannot shift to the same lane ${q}`),{nextState:a};const K=a.actionRequired.validLanes;if(K&&!K.includes(n))return console.error(`Illegal shift: Lane ${n} not in valid lanes ${K}`),{nextState:a};const U=ve(a,B),R=ve(a,C);if(U&&U.card.protocol==="Anarchy"&&U.card.value===1&&R&&R.card.isFaceUp){const L=a.player.protocols[n],D=a.opponent.protocols[n],O=R.card.protocol;if(O===L||O===D)return console.error(`Illegal Anarchy-1 shift: ${O}-${R.card.value} cannot be shifted to lane ${n} (protocols: ${L}/${D}) - matching protocol not allowed`),{nextState:a}}if(U&&U.card.protocol==="Gravity"&&U.card.value===1){let L=-1;for(let D=0;D<a[U.owner].lanes.length;D++)if(a[U.owner].lanes[D].some(O=>O.id===B)){L=D;break}if(L!==-1&&!(q===L)&&!(n===L))return console.error(`Illegal Gravity-1 shift: Must shift to or from Gravity lane ${L}, but tried ${q}  ${n}`),{nextState:a}}if(a.actionRequired.destinationRestriction&&R){const L=a.actionRequired.destinationRestriction;if(L.type==="non_matching_protocol"&&R.card.isFaceUp){const D=a.player.protocols[n],O=a.opponent.protocols[n],X=R.card.protocol;if(X===D||X===O)return console.error(`Illegal shift: ${X} cannot be shifted to lane ${n} (protocols: ${D}/${O}) - matching protocol not allowed`),{nextState:a}}if(L.type==="to_or_from_this_lane"){const D=L.laneIndex==="current"&&U?(()=>{for(let O=0;O<a[U.owner].lanes.length;O++)if(a[U.owner].lanes[O].some(X=>X.id===B))return O;return-1})():L.laneIndex;if(D!==void 0&&D!==-1&&!(q===D)&&!(n===D))return console.error(`Illegal shift: Must shift to or from lane ${D}, but tried ${q}  ${n}`),{nextState:a}}}const j=Al(a,q,n);if(!j.allowed)return console.error(`Illegal shift: Cannot shift from lane ${q} to ${n} - ${j.reason}`),{nextState:a};const F=Qa(a,C,N,n,T);l=F.newState;const M=l.actionRequired!==null;if(F.animationRequests)c={animationRequests:F.animationRequests,onCompleteCallback:(L,D)=>{var Z,Q,I,W;let O=L;if(M){if(H==="speed_3_end"){const Se={type:"speed_3_self_flip_after_shift",sourceCardId:a.actionRequired.sourceCardId,actor:T};O.queuedActions=[...O.queuedActions||[],Se]}const Y=(Z=a.actionRequired)==null?void 0:Z.followUpEffect,de=(Q=a.actionRequired)==null?void 0:Q.conditionalType;if(Y&&B&&(de!=="if_executed"||C)){const Se=ve(O,B),ye=a._currentPhaseContext||(a.phase==="start"?"start":"end"),Ne={type:"execute_follow_up_effect",sourceCardId:B,followUpEffect:Y,actor:T,logContext:{indentLevel:1,sourceCardName:Se?`${Se.card.protocol}-${Se.card.value}`:void 0,phase:ye}};O.queuedActions=[...O.queuedActions||[],Ne]}ve(O,B);const ee=O._pendingCustomEffects;if(ee){const ge=ve(O,ee.sourceCardId);if(ge&&ge.card.isFaceUp){const Se=O[ge.owner].lanes.find(Ne=>Ne.some(Le=>Le.id===ee.sourceCardId));if(Se&&Se.length>0&&Se[Se.length-1].id===ee.sourceCardId){const Ne={type:"execute_remaining_custom_effects",sourceCardId:ee.sourceCardId,laneIndex:ee.laneIndex,effects:ee.effects,context:ee.context,actor:T};O.queuedActions=[...O.queuedActions||[],Ne]}}delete O._pendingCustomEffects}return O}if(H==="speed_3_end"){const Y=a.actionRequired.sourceCardId;O=ae(O,T,"Speed-3: Flipping itself after shifting a card."),O=To(new Set([Y]),O),O.animationState={type:"flipCard",cardId:Y}}const X=O._pendingCustomEffects;if(X){const Y=ve(O,X.sourceCardId);if(Y&&Y.card.isFaceUp){const de=O[Y.owner].lanes.find(ge=>ge.some(Se=>Se.id===X.sourceCardId));if(de&&de.length>0&&de[de.length-1].id===X.sourceCardId){for(const ge of X.effects)O=lt(Y.card,X.laneIndex,O,X.context,ge).newState;delete O._pendingCustomEffects}else O=ae(O,T,"Pending effects cancelled because source card is now covered."),delete O._pendingCustomEffects}else delete O._pendingCustomEffects}B&&(O=ma(O)),O=xt(O,"after_shift",{player:T,cardId:C}).newState;const z=(I=a.actionRequired)==null?void 0:I.followUpEffect,G=(W=a.actionRequired)==null?void 0:W.conditionalType;if(z&&B&&(G!=="if_executed"||C)){const de=ve(O,B);if(de&&de.card.isFaceUp){const ee=O[de.owner].lanes.find(Je=>Je.some(at=>at.id===B)),ge=O[de.owner].lanes.indexOf(ee),Se={cardOwner:de.owner,actor:T,currentTurn:O.turn,opponent:de.owner==="player"?"opponent":"player"},ye=`${de.card.protocol}-${de.card.value}`,Ne=a._currentPhaseContext||(a.phase==="start"?"start":"end");O={...O,_logIndentLevel:1,_currentEffectSource:ye,_currentPhaseContext:Ne},O=lt(de.card,ge,O,Se,z).newState}}if(O=We(O),O.actionRequired=null,O.queuedActions&&O.queuedActions.length>0){const Y=O.queuedActions[0];Y.type==="execute_remaining_custom_effects"?(O=ya(O),O.animationState&&(O={...O,animationState:null})):(O.queuedActions=O.queuedActions.slice(1),O.actionRequired=Y)}return O._interruptedTurn?br(O):D(O)}};else if(M){if(H==="speed_3_end"){const X={type:"speed_3_self_flip_after_shift",sourceCardId:a.actionRequired.sourceCardId,actor:T};l.queuedActions=[...l.queuedActions||[],X]}const L=(p=a.actionRequired)==null?void 0:p.followUpEffect,D=(f=a.actionRequired)==null?void 0:f.conditionalType;if(L&&B&&(D!=="if_executed"||C)){const X=ve(l,B),ne=a._currentPhaseContext||(a.phase==="start"?"start":"end"),z={type:"execute_follow_up_effect",sourceCardId:B,followUpEffect:L,actor:T,logContext:{indentLevel:1,sourceCardName:X?`${X.card.protocol}-${X.card.value}`:void 0,phase:ne}};l.queuedActions=[...l.queuedActions||[],z]}}else{if(H==="speed_3_end"){const ne=a.actionRequired.sourceCardId;l=ae(l,T,"Speed-3: Flipping itself after shifting a card."),l=To(new Set([ne]),l),l.animationState={type:"flipCard",cardId:ne}}const L=l._pendingCustomEffects;if(L){const ne=ve(l,L.sourceCardId);if(ne&&ne.card.isFaceUp){const z=l[ne.owner].lanes.find(Z=>Z.some(Q=>Q.id===L.sourceCardId));if(z&&z.length>0&&z[z.length-1].id===L.sourceCardId){for(const Z of L.effects)l=lt(ne.card,L.laneIndex,l,L.context,Z).newState;delete l._pendingCustomEffects}else l=ae(l,T,"Pending effects cancelled because source card is now covered."),delete l._pendingCustomEffects}else delete l._pendingCustomEffects}B&&(l=ma(l)),l=xt(l,"after_shift",{player:T,cardId:C}).newState;const O=(h=a.actionRequired)==null?void 0:h.followUpEffect,X=(m=a.actionRequired)==null?void 0:m.conditionalType;if(O&&B&&(X!=="if_executed"||C)){const z=ve(l,B);if(z&&z.card.isFaceUp){const G=l[z.owner].lanes.find(de=>de.some(ee=>ee.id===B)),Z=l[z.owner].lanes.indexOf(G),Q={cardOwner:z.owner,actor:T,currentTurn:l.turn,opponent:z.owner==="player"?"opponent":"player"},I=`${z.card.protocol}-${z.card.value}`,W=a._currentPhaseContext||(a.phase==="start"?"start":"end");l={...l,_logIndentLevel:1,_currentEffectSource:I,_currentPhaseContext:W},l=lt(z.card,Z,l,Q,O).newState}}if(l=We(l),l.actionRequired=null,l.queuedActions&&l.queuedActions.length>0){const ne=l.queuedActions[0];if(ne.type==="execute_remaining_custom_effects"){if(l=ya(l),l.animationState&&!l.actionRequired){const z=l.animationState;z.type==="draw"&&(c={animationRequests:[{type:"draw",player:z.player,count:z.count}],onCompleteCallback:(G,Z)=>{const Q={...G,animationState:null};return Z(Q)}},l={...l,animationState:null})}}else l.queuedActions=l.queuedActions.slice(1),l.actionRequired=ne}}break}case"shift_flipped_card_optional":{const C=a.actionRequired.cardId,N=a.actionRequired.actor;let T=null;for(const U of["player","opponent"])if(a[U].lanes.flat().some(R=>R.id===C)){T=U;break}if(!T){console.error("[shift_flipped_card_optional] Card not found on board:",C),l=a;break}const H=(g=a.actionRequired)==null?void 0:g.followUpEffect,q=(y=a.actionRequired)==null?void 0:y.conditionalType,B=(w=a.actionRequired)==null?void 0:w.sourceCardId,K=Qa(a,C,T,n,N);if(l=K.newState,H&&B&&(q!=="if_executed"||C)){const R=ve(l,B),j=a._currentPhaseContext||(a.phase==="start"?"start":"end"),F={type:"execute_follow_up_effect",sourceCardId:B,followUpEffect:H,actor:N,logContext:{indentLevel:1,sourceCardName:R?`${R.card.protocol}-${R.card.value}`:void 0,phase:j}};l={...l,queuedActions:[...l.queuedActions||[],F]}}K.animationRequests&&(c={animationRequests:K.animationRequests,onCompleteCallback:(U,R)=>R(U)});break}case"select_lane_for_play":{const{cardInHandId:C,isFaceDown:N,actor:T,source:H,disallowedLaneIndex:q,validLanes:B,preSelectedLane:K}=a.actionRequired,U=K!==void 0?K:n;if(q!==void 0&&U===q)return{nextState:a,requiresTurnEnd:!1};if(B&&!B.includes(U))return{nextState:a,requiresTurnEnd:!1};if(H==="deck"){const D={...a,actionRequired:null},O=D[T],{drawnCards:X,remainingDeck:ne,newDiscard:z}=Dn(O.deck,O.discard,1);if(X.length===0){console.error("No cards in deck/discard to play"),l=D;break}const G={...X[0],id:Be(),isFaceUp:!N},Z=[...O.lanes];Z[U]=[...Z[U],G];const Q={...O,lanes:Z,deck:ne,discard:z};l={...D,[T]:Q},c={animationRequests:[{type:"play",cardId:G.id,owner:T,laneIndex:U,isFaceUp:G.isFaceUp}],onCompleteCallback:(I,W)=>W(I)};break}const R=a[T].hand.find(D=>D.id===C);if(!R){console.error("Card for play not found in hand"),l={...a,actionRequired:null};break}const j={...a,actionRequired:null};let F;if(typeof N=="boolean")F=!N;else{const D=a[T].lanes.flat().some(z=>z.isFaceUp&&z.protocol==="Spirit"&&z.value===1),O=a[T].lanes.some(z=>{if(z.length===0)return!1;const G=z[z.length-1];return G.isFaceUp&&G.protocol==="Chaos"&&G.value===3}),X=T==="player"?"opponent":"player",ne=a[X].lanes.flat().some(z=>z.isFaceUp&&z.protocol==="Psychic"&&z.value===1);F=(D||O||R.protocol===a[T].protocols[U]||R.protocol===a[X].protocols[U])&&!ne}const{newState:M,animationRequests:L}=Yi(j,C,U,F,T);l=M,L&&(c={animationRequests:L,onCompleteCallback:(D,O)=>(D.queuedActions&&D.queuedActions.length>0,O(D))});break}case"select_lane_for_delete":{const C=a.actionRequired.actor,N=C==="player"?"Player":"Opponent",T=a.player.protocols[n],H=a.actionRequired.targetFilter||{},q=ve(a,a.actionRequired.sourceCardId),B=q?`${q.card.protocol}-${q.card.value}`:"a card effect",K=a.actionRequired.count||1,U=a.actionRequired.deleteAll===!0,R=a.actionRequired.validLanes;if(R&&!R.includes(n))return console.error(`Illegal delete lane selection: Lane ${n} not in valid lanes ${R}`),{nextState:a};l=ae(l,C,`${B}: ${N} targets Protocol ${T}.`);const j=new Map;for(const D of["player","opponent"]){const O=a[D].lanes[n];j.set(D,O.length>0?O[O.length-1].id:null)}const F=[],M=[],L=new Set;for(const D of["player","opponent"]){const O=a[D],X=O.lanes[n].some(z=>z.isFaceUp&&z.protocol==="Darkness"&&z.value===2)?4:2,ne=O.lanes[n];for(let z=0;z<ne.length;z++){const G=ne[z],Z=z===ne.length-1,Q=G.isFaceUp?G.value:X;if(H.valueRange){const{min:Y,max:de}=H.valueRange;if(Q<Y||Q>de)continue}if(H.faceState==="face_up"&&!G.isFaceUp||H.faceState==="face_down"&&G.isFaceUp||H.owner==="own"&&D!==C||H.owner==="opponent"&&D===C||H.position==="uncovered"&&!Z||H.position==="covered"&&Z)continue;F.push({type:"delete",cardId:G.id,owner:D}),L.add(G.id);const I=D==="player"?"Player's":"Opponent's",W=G.isFaceUp?`${G.protocol}-${G.value}`:"a face-down card";if(M.push(`${I} ${W}`),!U&&F.length>=K)break}if(!U&&F.length>=K)break}if(M.length>0){l=ae(l,C,`${B}: Deleting ${M.join(", ")}.`);const D={...l.stats[C],cardsDeleted:l.stats[C].cardsDeleted+M.length},O={...l[C],stats:D};l={...l,[C]:O,stats:{...l.stats,[C]:D}}}if(l=We(l),l.actionRequired=null,F.length>0){const D=(_=a.actionRequired)==null?void 0:_.followUpEffect,O=(b=a.actionRequired)==null?void 0:b.conditionalType,X=a.actionRequired.sourceCardId;c={animationRequests:F,onCompleteCallback:(ne,z)=>{let G=ne;G=xt(G,"after_delete",{player:C}).newState;const Q=[];for(const I of["player","opponent"]){const W=j.get(I),Y=G[I].lanes[n];W&&L.has(W)&&Y.length>0&&Q.push(I)}for(let I=0;I<Q.length;I++){const W=Q[I];if(G=vn(G,W,n).newState,G.actionRequired&&I<Q.length-1){const de=Q.slice(I+1);for(const ee of de)G.queuedActions=[...G.queuedActions||[],{type:"pending_uncover_effect",owner:ee,laneIndex:n}];return G}}if(D&&X&&(O!=="if_executed"||F.length>0)){const W=ve(G,X);if(W&&W.card.isFaceUp){const Y=G[W.owner].lanes.find(Se=>Se.some(ye=>ye.id===X)),de=G[W.owner].lanes.indexOf(Y),ee={cardOwner:W.owner,actor:C,currentTurn:G.turn,opponent:W.owner==="player"?"opponent":"player"};if(G=lt(W.card,de,G,ee,D).newState,G.actionRequired)return G}}return z(G)}}}break}case"select_lane_for_return":{const C=a.actionRequired.actor,N=C==="player"?"Player":"Opponent",T=a.player.protocols[n],H=a.actionRequired.targetFilter||{},q=ve(a,a.actionRequired.sourceCardId),B=q?`${q.card.protocol}-${q.card.value}`:"a card effect";l=ae(l,C,`${B}: ${N} targets Protocol ${T}.`);const K=[],U=[];for(const R of["player","opponent"]){const j=a[R],F=j.lanes[n].some(M=>M.isFaceUp&&M.protocol==="Darkness"&&M.value===2)?4:2;for(const M of j.lanes[n]){const L=M.isFaceUp?M.value:F;if(H.valueEquals!==void 0&&L!==H.valueEquals||H.faceState==="face_up"&&!M.isFaceUp||H.faceState==="face_down"&&M.isFaceUp||H.owner==="own"&&R!==C||H.owner==="opponent"&&R===C)continue;K.push({type:"return",cardId:M.id,owner:R});const D=R==="player"?"Player's":"Opponent's",O=M.isFaceUp?`${M.protocol}-${M.value}`:"a face-down card";U.push(`${D} ${O}`)}}if(K.length===0){l=ae(l,C,`${B}: No matching cards in Protocol ${T}.`),l=We(l),l.actionRequired=null;break}if(U.length>0&&(l=ae(l,C,`${B}: Returning ${U.join(", ")}.`)),l=We(l),l.actionRequired=null,K.length>0){const R=(k=a.actionRequired)==null?void 0:k.followUpEffect,j=(S=a.actionRequired)==null?void 0:S.conditionalType,F=a.actionRequired.sourceCardId;c={animationRequests:K,onCompleteCallback:(M,L)=>{let D=M;if(R&&F&&(j!=="if_executed"||K.length>0)){const X=ve(D,F);if(X&&X.card.isFaceUp){const ne=D[X.owner].lanes.find(Q=>Q.some(I=>I.id===F)),z=D[X.owner].lanes.indexOf(ne),G={cardOwner:X.owner,actor:C,currentTurn:D.turn,opponent:X.owner==="player"?"opponent":"player"};if(D=lt(X.card,z,D,G,R).newState,D.actionRequired)return D}}return L(D)}}}break}case"select_lane_for_delete_all":{const C=a.actionRequired.actor,N=C==="player"?"Player":"Opponent",T=a.player.protocols[n],H=a.actionRequired.minCards||8;if(!(a.actionRequired.validLanes||[0,1,2]).includes(n)){l=ae(l,C,"Cannot select this lane for deletion.");break}const B=a.player.lanes[n].length+a.opponent.lanes[n].length;if(B<H){l=ae(l,C,`Cannot delete ${T} line (only ${B} cards, need ${H}+).`),l=We(l),l.actionRequired=null;break}const K=ve(a,a.actionRequired.sourceCardId),U=K?`${K.card.protocol}-${K.card.value}`:"Effect";l=ae(l,C,`${U}: ${N} deletes all cards in ${T} line.`);const R=[];for(const M of["player","opponent"])for(const L of a[M].lanes[n])R.push({type:"delete",cardId:L.id,owner:M});const j={...l.stats[C],cardsDeleted:l.stats[C].cardsDeleted+R.length},F={...l[C],stats:j};if(l={...l,[C]:F,stats:{...l.stats,[C]:j}},l=We(l),l.actionRequired=null,R.length>0){const M=($=a.actionRequired)==null?void 0:$.followUpEffect,L=(E=a.actionRequired)==null?void 0:E.conditionalType,D=a.actionRequired.sourceCardId;c={animationRequests:R,onCompleteCallback:(O,X)=>{let ne=O;if(ne=xt(ne,"after_delete",{player:C}).newState,M&&D&&(L!=="if_executed"||R.length>0)){const Z=ve(ne,D);if(Z&&Z.card.isFaceUp){const Q=ne[Z.owner].lanes.find(de=>de.some(ee=>ee.id===D)),I=ne[Z.owner].lanes.indexOf(Q),W={cardOwner:Z.owner,actor:C,currentTurn:ne.turn,opponent:Z.owner==="player"?"opponent":"player"};if(ne=lt(Z.card,I,ne,W,M).newState,ne.actionRequired)return ne}}return X(ne)}}}break}case"select_lane_to_shift_revealed_board_card_custom":{const{revealedCardId:C,actor:N}=a.actionRequired,T=ve(a,C);if(T){const H=Qa(a,C,T.owner,n,N);l=H.newState,H.animationRequests&&(c={animationRequests:H.animationRequests,onCompleteCallback:(q,B)=>q.actionRequired?q:B(q)})}break}default:return{nextState:a}}return{nextState:_e(l),requiresAnimation:c}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Sh=(a,n)=>{if(a.processedSpeed1TriggerThisTurn)return a;if(a[n].lanes.flat().some(s=>s.isFaceUp&&s.protocol==="Speed"&&s.value===1)){let s={...a};return s=Me(s,"Speed-1"),s=et(s,void 0),s=ae(s,n,"Triggers after clearing cache: Draw 1 card."),s=No(s,n,1),s.processedSpeed1TriggerThisTurn=!0,s=Me(s,void 0),s.phase="end",s}return a},Ao=(a,n,l)=>{var B,K,U,R;const c=a[l],s=new Set(n),d=c.hand.filter(j=>s.has(j.id));if(d.length===0)return a;const p=c.hand.filter(j=>!s.has(j.id)),f=[...c.discard,...d.map(({id:j,isFaceUp:F,...M})=>M)],h=((B=a.animationState)==null?void 0:B.type)==="discardCard"&&((K=a.animationState.originalAction)==null?void 0:K.type)==="discard"?a.animationState.originalAction:((U=a.actionRequired)==null?void 0:U.type)==="discard"?a.actionRequired:null,m={...c.stats,cardsDiscarded:c.stats.cardsDiscarded+d.length},g={...c,hand:p,discard:f,stats:m},y=h==null?void 0:h.followUpEffect,w=h==null?void 0:h.conditionalType,_=h==null?void 0:h.previousHandSize;let b={...a,[l]:g,stats:{...a.stats,[l]:m},actionRequired:y?{type:"discard_completed",followUpEffect:y,conditionalType:w,previousHandSize:_,sourceCardId:h==null?void 0:h.sourceCardId,actor:l}:null};if(h!=null&&h.sourceCardId){const j=b.player.lanes.flat().find(F=>F.id===h.sourceCardId)||b.opponent.lanes.flat().find(F=>F.id===h.sourceCardId);if(j){const F=`${j.protocol}-${j.value}`;b=Me(b,F),b=et(b,"middle")}else b=Me(b,void 0),b=et(b,void 0),b={...b,_logIndentLevel:0}}else b=Me(b,void 0),b=et(b,void 0);const k=l==="player"?"Player":"Opponent";let S;if(l==="player"||d.every(j=>j.isRevealed)){const j=d.map(F=>`${F.protocol}-${F.value}`).join(", ");S=`${k} discards ${j}.`}else{const j=d.length===1?"card":"cards";S=`${k} discards ${d.length} ${j}.`}b=ae(b,l,S);const $=(j,F)=>{var ne;const M=a.phase==="hand_limit"&&!(F!=null&&F.sourceCardId);let L=j;return M&&(L=ma(L),L=Sh(L,l),L=xt(L,"after_clear_cache",{player:l}).newState,((ne=L.processedClearCacheTriggerIds)==null?void 0:ne.length)>0&&(L.phase="end")),L=Wh(L,l,F==null?void 0:F.sourceEffect,F==null?void 0:F.sourceCardId),L=xt(L,"after_discard",{player:l}).newState,L=xt(L,"after_opponent_discard",{player:l==="player"?"opponent":"player"}).newState,L};if(h&&h.actor===l){const j=h.count-n.length;return j>0?(b.actionRequired={...h,count:j},b):$(b,h)}const E=a.actionRequired;if(E&&E.type==="discard"&&E.actor===l){const j=E.count-n.length;return j>0?(b.actionRequired={...E,count:j},b):$(b,E)}const C=a.phase==="hand_limit";b=xt(b,"after_discard",{player:l}).newState;let q=xt(b,"after_opponent_discard",{player:l==="player"?"opponent":"player"}).newState;return C&&(q=Sh(q,l),q=xt(q,"after_clear_cache",{player:l}).newState,((R=q.processedClearCacheTriggerIds)==null?void 0:R.length)>0&&(q.phase="end")),q},W_=(a,n)=>{var p;if(((p=a.actionRequired)==null?void 0:p.type)!=="plague_2_player_discard")return a;const l=a.actionRequired.actor,c=l==="player"?"opponent":"player";let s=Ao(a,n,l);const d=n.length+1;return s[c].hand.length>0?s.actionRequired={type:"discard",actor:c,count:Math.min(d,s[c].hand.length),sourceCardId:a.actionRequired.sourceCardId}:(s=We(s),s.actionRequired=null),s},ud=(a,n)=>{var p;if(((p=a.actionRequired)==null?void 0:p.type)!=="plague_2_opponent_discard")return a;const l=a.actionRequired.actor,c=l==="player"?"opponent":"player";let s=Ao(a,n,l);const d=n.length+1;return s[c].hand.length>0?s.actionRequired={type:"discard",actor:c,count:Math.min(d,s[c].hand.length),sourceCardId:a.actionRequired.sourceCardId}:(s=We(s),s.actionRequired=null),s},Eh=(a,n)=>{var h,m,g;const l=((h=a.actionRequired)==null?void 0:h.type)==="discard"&&((m=a.actionRequired)==null?void 0:m.variableCount),c=((g=a.actionRequired)==null?void 0:g.type)==="select_cards_from_hand_to_discard_for_fire_4";if(!l&&!c)return a;const s=a.actionRequired.actor,d=a.actionRequired.sourceCardId;let p=Ao(a,n,s);if(l&&d)return Wh(p,s,void 0,d);const f=n.length+1;return p=ae(p,s,`Fire-4: Drawing ${f} card(s).`),p=No(p,s,f),p},pd=(a,n)=>{var h;if(((h=a.actionRequired)==null?void 0:h.type)!=="select_cards_from_hand_to_discard_for_hate_1")return a;const{sourceCardId:l,actor:c}=a.actionRequired;let s=Ao(a,n,c);const p=S_(s,[]),f=Math.min(2,p);return f>0?s.actionRequired={type:"select_cards_to_delete",count:f,sourceCardId:l,disallowedIds:[],actor:c}:(s=ae(s,c,"Hate-1: No valid targets to delete."),s=We(s),s.actionRequired=null),s};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const kl=(a,n,l)=>{const c=a.turn,s=c==="player"?"opponent":"player";let d={...a};if(d.compileBlockedPlayer===c&&d.compileBlockedUntilTurn>(d.turnNumber||0))return d=ae(d,c,`${c==="player"?"Player":"Opponent"} can't compile - blocked by opponent's effect.`),d;if(d.useControlMechanic&&d.controlCardHolder===c){const j=c==="player"?"Player":"Opponent";return d=Me(d,void 0),d=et(d,void 0),d={...d,_logIndentLevel:0},d=ae(d,c,`${j} has Control and may rearrange protocols before compiling.`),d=Nn(d),d.actionRequired={type:"prompt_use_control_mechanic",sourceCardId:"CONTROL_MECHANIC",actor:c,originalAction:{type:"compile",laneIndex:n}},d.controlCardHolder=null,d}let h={...d[c]},m={...d[s]};const g=h.compiled[n],y=[];for(const j of[c,s])d[j].lanes[n].forEach(M=>{if(M.isFaceUp){const L=M;L.customEffects&&L.customEffects.topEffects&&L.customEffects.topEffects.some(O=>O.trigger==="before_compile_delete")&&y.push({card:M,owner:j})}});for(const{card:j,owner:F}of y)d=xt(d,"before_compile_delete",{player:F,cardId:j.id}).newState;h={...d[c]},m={...d[s]};const w=j=>{if(j.protocol==="Speed"&&j.value===2&&j.isFaceUp)return!0;const F=j;return F.customEffects&&F.customEffects.topEffects&&j.isFaceUp?F.customEffects.topEffects.some(M=>{var L,D;return M.trigger==="before_compile_delete"&&((L=M.params)==null?void 0:L.action)==="shift"&&((D=M.params)==null?void 0:D.shiftSelf)===!0}):!1},_=[],b=[],k=h.lanes[n].filter(j=>w(j)?(_.push(j),!1):!0),S=m.lanes[n].filter(j=>w(j)?(b.push(j),!1):!0),$={...h.stats,cardsDeleted:h.stats.cardsDeleted+k.length},E={...m.stats,cardsDeleted:m.stats.cardsDeleted+S.length};h.stats=$,m.stats=E,h.discard=[...h.discard,...k.map(({id:j,isFaceUp:F,...M})=>M)],m.discard=[...m.discard,...S.map(({id:j,isFaceUp:F,...M})=>M)];const C=[...h.lanes];C[n]=_,h.lanes=C;const N=[...m.lanes];N[n]=b,m.lanes=N;const T=[...h.compiled];T[n]=!0,h.compiled=T,d={...d,[c]:h,[s]:m,stats:{...d.stats,[c]:$,[s]:E}},d=Me(d,void 0),d=et(d,void 0),d={...d,_logIndentLevel:0};const H=c==="player"?"Player":"Opponent",q=h.protocols[n];if(d=ae(d,c,`${H} compiles Protocol ${q}!`),g&&(d=ae(d,c,`${H} draws 1 card from the opponent's deck as a re-compile reward.`),d=P_(d,c,1)),d=_e(d),h.compiled.every(j=>j===!0))return d.winner=c,l(c,d),d;k.length+S.length>0&&(d=xt(d,"after_delete",{player:c}).newState);const R=[..._,...b].map(j=>{const F=ve(d,j.id).owner,M=j.isFaceUp?`${j.protocol}-${j.value}`:"Card";return d=ae(d,F,`${M} survives compilation and must be shifted.`),{type:"select_lane_for_shift",cardToShiftId:j.id,cardOwner:F,originalLaneIndex:n,sourceCardId:j.id,actor:F}});if(R.length>0){const j=R.shift();d.actionRequired=j,d.queuedActions=R,j.actor!==c&&(d._interruptedTurn=c,d._interruptedPhase=d.phase,d.turn=j.actor)}else d.actionRequired=null,d.queuedActions=[];return d},em=(a,n)=>a,Q_=(a,n)=>{var _;if(((_=a.actionRequired)==null?void 0:_.type)!=="select_card_from_hand_to_play")return a;const{disallowedLaneIndex:l,sourceCardId:c,isFaceDown:s,actor:d,destinationRule:p,condition:f,faceDown:h,targetLaneIndex:m,validLanes:g,selectableCardIds:y,valueFilter:w}=a.actionRequired;return y&&!y.includes(n)?a:m!==void 0?{...a,actionRequired:{type:"select_lane_for_play",cardInHandId:n,sourceCardId:c,isFaceDown:s||h,actor:d,source:"hand",preSelectedLane:m}}:{...a,actionRequired:{type:"select_lane_for_play",cardInHandId:n,disallowedLaneIndex:l,sourceCardId:c,isFaceDown:s||h,actor:d,destinationRule:p,condition:f,validLanes:g}}},jh=a=>{if(!a.actionRequired||!("optional"in a.actionRequired)||!a.actionRequired.optional)return a;const n="actor"in a.actionRequired?a.actionRequired.actor:a.turn,l=n==="player"?"Player":"Opponent";let c={...a,actionRequired:null};return c=ae(c,n,`${l} skips the optional action.`),c},kh=a=>{var d;if(((d=a.actionRequired)==null?void 0:d.type)!=="reveal_opponent_hand")return a;const n=a.actionRequired.actor,l=n==="player"?"opponent":"player";let c={...a};const s={...c[l]};if(s.hand.length>0){s.hand=s.hand.map(h=>({...h,isRevealed:!0})),c[l]=s;const p=ve(c,a.actionRequired.sourceCardId),f=p?`${p.card.protocol}-${p.card.value}`:"A card effect";c=ae(c,n,`${f}: Opponent reveals their hand.`)}return c.actionRequired=null,c},Rh=(a,n)=>yd(a,n),Ah=(a,n)=>gd(a,n).newState,tm=(a,n)=>{var y;if(((y=a.actionRequired)==null?void 0:y.type)!=="select_card_from_revealed_deck")return a;const c=a.actionRequired.actor,s=c==="player"?"Player":"Opponent";let d={...a};const p={...d[c]},f=[...p.deck],h=f.findIndex(w=>(w.id||`deck-${f.indexOf(w)}`)===n);if(h===-1)return console.warn(`[resolveSelectRevealedDeckCard] Card ${n} not found in deck`),d.actionRequired=null,d;const m=f.splice(h,1)[0],g={...m,id:m.id||`drawn-${Date.now()}`,isFaceUp:!0};return p.deck=f,p.hand=[...p.hand,g],p.deckRevealed=!1,d[c]=p,d=ae(d,c,`${s} draws ${m.protocol}-${m.value} from the revealed deck.`),d.actionRequired=null,d=We(d),d};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Th=(a,n)=>{var h;if(((h=a.actionRequired)==null?void 0:h.type)!=="prompt_optional_draw")return a;const{sourceCardId:l,actor:c,count:s,drawingPlayer:d}=a.actionRequired,p=c.charAt(0).toUpperCase()+c.slice(1);let f={...a};if(n){f=ae(f,c,`${p} chooses to draw ${s} card${s!==1?"s":""}.`),f=No(f,d||c,s);const m=a.actionRequired.followUpEffect;if(a.actionRequired.conditionalType,m){const g=ve(f,l);if(g){const y=f[g.owner].lanes.findIndex(k=>k.some(S=>S.id===l)),w=c==="player"?"opponent":"player",_={cardOwner:c,actor:c,currentTurn:f.turn,opponent:w,triggerType:"start"};f=lt(g.card,y,f,_,m).newState,f=We(f)}else{const y=c==="player"?"opponent":"player";let w=0;for(let S=0;S<3;S++)if(f[c].lanes[S].length>0){w=S;break}const _={id:l,protocol:"Unknown",value:0},b={cardOwner:c,actor:c,currentTurn:f.turn,opponent:y,triggerType:"start"};f=lt(_,w,f,b,m).newState,f=We(f)}}else f.actionRequired=null}else f=ae(f,c,`${p} skips the draw.`),f.actionRequired=null;return f},Dh=(a,n,l)=>{var s;if(((s=a.actionRequired)==null?void 0:s.type)!=="plague_4_player_flip_optional")return a;let c={...a,actionRequired:null};if(c=Me(c,"Plague-4"),c=et(c,"end"),n){const{sourceCardId:d}=a.actionRequired;c=ae(c,l,`${l==="player"?"Player":"Opponent"} chooses to flip the card.`),c=To(new Set([d]),c),c.animationState={type:"flipCard",cardId:d}}else c=ae(c,l,`${l==="player"?"Player":"Opponent"} skips flipping the card.`);return c=Me(c,void 0),c=et(c,void 0),c=ma(c),c},Nh=(a,n)=>{var m,g,y;if(((m=a.actionRequired)==null?void 0:m.type)!=="prompt_optional_discard_custom")return a;const{actor:l,count:c,sourceCardId:s}=a.actionRequired,d=l.charAt(0).toUpperCase()+l.slice(1);let p={...a};const f=(g=a.actionRequired)==null?void 0:g.followUpEffect,h=(y=a.actionRequired)==null?void 0:y.conditionalType;return n?(p=ae(p,l,`${d} chooses to discard ${c} card(s).`),p.actionRequired={type:"discard",actor:l,count:c,sourceCardId:s,followUpEffect:f,conditionalType:h,previousHandSize:p[l].hand.length}):(p=ae(p,l,`${d} skips the discard.`),p.actionRequired=null),p},wd=(a,n)=>{var m,g,y,w,_,b,k;if(((m=a.actionRequired)==null?void 0:m.type)!=="prompt_optional_effect")return a;const{actor:l,sourceCardId:c,effectDef:s,laneIndex:d,savedTargetCardId:p}=a.actionRequired,f=l.charAt(0).toUpperCase()+l.slice(1);let h={...a};if(p&&(h.lastCustomEffectTargetCardId=p),n){const S=s.params.action;h=ae(h,l,`${f} chooses to execute the optional ${S} effect.`),h.actionRequired=null;const $=[...h.player.lanes.flat(),...h.opponent.lanes.flat()].find(R=>R.id===c);if(!$)return console.error("[Optional Effect] Source card not found!"),h;const E={cardOwner:l,opponent:l==="player"?"opponent":"player",currentTurn:h.turn,actor:l},C={...s,params:{...s.params,optional:!1},conditional:void 0},N=lt($,d,h,E,C),T=!!N.newState.actionRequired,H=!!N.newState._effectSkippedNoTargets;if(H&&!T){const R={...N.newState};return delete R._effectSkippedNoTargets,R.actionRequired=null,R}if(H&&T&&delete N.newState._effectSkippedNoTargets,s.conditional&&s.conditional.type==="if_executed"&&s.conditional.thenEffect){if(N.newState.actionRequired){const F=N.newState.actionRequired.sourceCardId;if(F&&F!==c){const L={type:"execute_conditional_followup",sourceCardId:c,laneIndex:d,followUpEffect:s.conditional.thenEffect,context:E,actor:l};return{...N.newState,queuedActions:[...N.newState.queuedActions||[],L]}}return{...N.newState,actionRequired:{...N.newState.actionRequired,followUpEffect:s.conditional.thenEffect,conditionalType:"if_executed"}}}const R=s.conditional.thenEffect,j=lt($,d,N.newState,E,R);return j.newState.actionRequired&&R.conditional&&R.conditional.thenEffect?{...j.newState,actionRequired:{...j.newState.actionRequired,followUpEffect:R.conditional.thenEffect,conditionalType:R.conditional.type}}:j.newState}const B=(g=a.actionRequired)==null?void 0:g.followUpEffect,K=(y=a.actionRequired)==null?void 0:y.outerSourceCardId,U=(w=a.actionRequired)==null?void 0:w.outerLaneIndex;if(B&&K){let R=N.newState;if(R.actionRequired)return{...R,actionRequired:{...R.actionRequired,followUpEffect:B,outerSourceCardId:K,outerLaneIndex:U}};const j=[...R.player.lanes.flat(),...R.opponent.lanes.flat()].find(F=>F.id===K);if(j){const F=R.player.lanes.flat().some(D=>D.id===K)?"player":"opponent",M={cardOwner:F,opponent:F==="player"?"opponent":"player",currentTurn:R.turn,actor:F};return lt(j,U||0,R,M,B).newState}}return N.newState}else{const S=s.params.action;h=ae(h,l,`${f} skips the optional ${S} effect.`),h.actionRequired=null;const $=(_=a.actionRequired)==null?void 0:_.followUpEffect,E=(b=a.actionRequired)==null?void 0:b.outerSourceCardId,C=(k=a.actionRequired)==null?void 0:k.outerLaneIndex;if($&&E){const N=[...h.player.lanes.flat(),...h.opponent.lanes.flat()].find(T=>T.id===E);if(N){let T=C;if(T===void 0){for(const K of["player","opponent"])for(let U=0;U<h[K].lanes.length;U++)if(h[K].lanes[U].some(R=>R.id===E)){T=U;break}}const H=h.player.lanes.flat().some(K=>K.id===E)?"player":"opponent",q={cardOwner:H,opponent:H==="player"?"opponent":"player",currentTurn:h.turn,actor:H};return lt(N,T||0,h,q,$).newState}}return h}},fd=(a,n,l)=>{var C;if(((C=a.actionRequired)==null?void 0:C.type)!=="prompt_rearrange_protocols")return a;const c=d_(a);if(!c.allowed)return console.error(`Protocol rearrangement blocked: ${c.reason}`),a;const{target:s,actor:d,originalAction:p,sourceCardId:f,disallowedProtocolForLane:h}=a.actionRequired;if(h){const{laneIndex:N,protocol:T}=h;if(n[N]===T)return console.error(`Illegal rearrange: ${T} cannot be placed on lane ${N} due to Anarchy-3 restriction`),a}let m={...a};const g={...m[s]},y={};g.protocols.forEach((N,T)=>{y[N]=g.compiled[T]});const w=n.map(N=>y[N]);g.protocols=n,g.compiled=w,m[s]=g,m.actionRequired=null;const _=m._pendingCustomEffects;if(_&&_.effects.length>0){const N={type:"execute_remaining_custom_effects",sourceCardId:_.sourceCardId,laneIndex:_.laneIndex,effects:_.effects,context:_.context,actor:d};m.queuedActions=[...m.queuedActions||[],N],delete m._pendingCustomEffects}let b="Control Action";if(f!=="CONTROL_MECHANIC"){const N=[...m.player.lanes.flat(),...m.opponent.lanes.flat()].find(T=>T.id===f);N&&(b=`${N.protocol}-${N.value}`)}const k=d.charAt(0).toUpperCase()+d.slice(1),S=s===d?"their own":"the opponent's",$=n.join(" | ");m=ae(m,d,`${b}: ${k} rearranges ${S} protocols.`),m=ae(m,d,`New protocol order for ${s}: ${$}`);let E=_e(m);if(p){if(E={...E,_logIndentLevel:0},p.type==="compile")return kl(E,p.laneIndex,l);if(p.type==="fill_hand")return Tl(E,d);p.type==="continue_turn"?p.queuedSpeed2Actions&&p.queuedSpeed2Actions.length>0?(E=ae(E,d,"Processing remaining Speed-2 effects..."),E.queuedActions=[...p.queuedSpeed2Actions,...E.queuedActions||[]]):(E=ae(E,d,"Turn ends after compile."),E.phase="hand_limit"):p.type==="resume_interrupted_turn"&&(E=ae(E,d,"Resuming interrupted turn..."),E._interruptedTurn=p.interruptedTurn,E._interruptedPhase=p.interruptedPhase,p.queuedSpeed2Actions&&p.queuedSpeed2Actions.length>0&&(E.queuedActions=[...p.queuedSpeed2Actions,...E.queuedActions||[]]))}return E},Fh=(a,n,l)=>{var E;if(((E=a.actionRequired)==null?void 0:E.type)!=="prompt_swap_protocols")return a;const{actor:c,target:s,originalAction:d,sourceCardId:p}=a.actionRequired,f={...a[s]},[h,m]=n.sort((C,N)=>C-N),g=[...f.protocols],y=[...f.compiled];[g[h],g[m]]=[g[m],g[h]],[y[h],y[m]]=[y[m],y[h]],f.protocols=g,f.compiled=y;let w={...a,[s]:f,actionRequired:null};const _=w._pendingCustomEffects;if(_&&_.effects.length>0){const C={type:"execute_remaining_custom_effects",sourceCardId:_.sourceCardId,laneIndex:_.laneIndex,effects:_.effects,context:_.context,actor:c};w.queuedActions=[...w.queuedActions||[],C],delete w._pendingCustomEffects}const b=c.charAt(0).toUpperCase()+c.slice(1),k=s.charAt(0).toUpperCase()+s.slice(1);w=ae(w,c,`${p==="CONTROL_MECHANIC"?"Control":"Spirit-4"}: ${b} swaps ${k}'s protocols ${g[m]} and ${g[h]}.`),p==="CONTROL_MECHANIC"&&(w.controlCardHolder=null);let $=_e(w);if(d){if(d.type==="compile")return $=ae($,c,"Resuming Compile action..."),kl($,d.laneIndex,l);if(d.type==="fill_hand")return $=ae($,c,"Resuming Refresh action..."),Tl($,c)}return $},Cd=(a,n)=>{var w;if(((w=a.actionRequired)==null?void 0:w.type)!=="prompt_shift_or_flip_board_card_custom")return a;const{actor:l,sourceCardId:c,revealedCardId:s,followUpAction:d,optional:p}=a.actionRequired,f=l.charAt(0).toUpperCase()+l.slice(1),h=ve(a,s);if(!h)return a;if(d&&n!=="skip"&&n!==d)return console.error(`Invalid choice: ${n}, followUpAction restricts to: ${d}`),a;const m=h.owner,g=a[m].lanes.findIndex(_=>_.some(b=>b.id===s));if(g===-1)return a;let y={...a};switch(n){case"shift":{const _=[...y[m].lanes[g]],b=_.findIndex(k=>k.id===s);if(b!==-1){_[b]={..._[b],isFaceUp:!1};const k=[...y[m].lanes];k[g]=_,y={...y,[m]:{...y[m],lanes:k}}}y=ae(y,l,`${f} chooses to shift the revealed card (face-down).`),y.actionRequired={type:"select_lane_to_shift_revealed_board_card_custom",sourceCardId:c,revealedCardId:s,actor:l};break}case"flip":{y=ae(y,l,`${f} chooses to flip the revealed card face-up permanently.`);const _={...y,actionRequired:null};y=vd(_,s).newState;break}case"skip":{const _=[...y[m].lanes[g]],b=_.findIndex(k=>k.id===s);if(b!==-1){_[b]={..._[b],isFaceUp:!1};const k=[...y[m].lanes];k[g]=_,y={...y,[m]:{...y[m],lanes:k}}}y=ae(y,l,`${f} chooses to do nothing with the revealed card.`),y.actionRequired=null;break}}return y};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const hd=(a,n)=>{if(!a.actionRequired)return a;const{actionRequired:l}=a,c=l.actor,s=c==="player"?"opponent":"player";switch(l.type){case"select_card_from_hand_to_give":{const d=a[c].hand.find(_=>_.id===n);if(!d)return a;let p={...a};const f={...p[c]},h={...p[s]};f.hand=f.hand.filter(_=>_.id!==n),h.hand=[...h.hand,d],p={...p,[c]:f,[s]:h};const m=c==="player"?"Player":"Opponent",g=`${d.protocol}-${d.value}`;p=ae(p,c,`${m} gives ${g} to the opponent.`),l.sourceEffect==="love_1_end"&&(p=ae(p,c,`Love-1: ${m} draws 2 cards.`),p=No(p,c,2));const y=l.followUpEffect,w=l.conditionalType;if(y&&w==="if_executed"){const _=ve(p,l.sourceCardId);if(_){const{card:b,laneIndex:k}=_,S={cardOwner:c,actor:c,currentTurn:p.turn,opponent:s,triggerType:"play"};p=lt(b,k,p,S,y).newState}}return p.actionRequired=null,p}case"select_card_from_hand_to_reveal":{const d=a[c].hand.find(w=>w.id===n);if(!d)return a;let p={...a};const f={...p[c]},h=f.hand.map(w=>w.id===n?{...w,isRevealed:!0}:w);f.hand=h,p={...p,[c]:f};const m=c==="player"?"Player":"Opponent",g=`${d.protocol}-${d.value}`;p=ae(p,c,`${m} reveals ${g} from their hand.`);const y=p._pendingCustomEffects;if(y&&y.effects.length>0){const w=ve(p,y.sourceCardId);if(w){const{card:_}=w,b=y.effects[0],k=y.effects.slice(1),S={cardOwner:c,actor:c,currentTurn:p.turn,opponent:s,triggerType:"play"};return p=lt(_,y.laneIndex,p,S,b).newState,k.length>0?p._pendingCustomEffects={...y,effects:k}:delete p._pendingCustomEffects,p}}return p.actionRequired={type:"select_any_card_to_flip",count:1,sourceCardId:l.sourceCardId,actor:c},p}default:return a}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const bd=(a,n)=>{var _;if(((_=a.actionRequired)==null?void 0:_.type)!=="custom_choice")return a;const{options:l,sourceCardId:c,actor:s,laneIndex:d}=a.actionRequired;if(n<0||n>=l.length)return console.error(`[Choice Resolver] Invalid option index: ${n}`),a;const p=l[n],f=ve(a,c);if(!f){console.error(`[Choice Resolver] Source card ${c} not found`);let b={...a};return b.actionRequired=null,b}const h=s==="player"?"opponent":"player",m={cardOwner:s,actor:s,currentTurn:a.turn,opponent:h};let g={...a,actionRequired:null};const y=lt(f.card,d,g,m,p);return _e(y.newState)};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Control Mechanic Logic for AI
 *
 * CRITICAL: When evaluating rearrangements during a compile action,
 * the lane being compiled will have its value RESET TO 0 after the compile.
 * This must be considered when determining beneficial swaps!
 */function Wi(a,n){const l=[...a];return n!==null&&n>=0&&n<3&&(l[n]=0),l}function X_(a,n=null){const l=a.player,c=[],s=[];for(let p=0;p<3;p++)l.compiled[p]?c.push(p):s.push(p);if(c.length===0||s.length===0)return!1;const d=Wi(l.laneValues,n);for(const p of c)for(const f of s)if(d[f]-d[p]>0)return!0;return!1}function qh(a,n=null){const l=a.opponent,c=[],s=[];for(let p=0;p<3;p++)l.compiled[p]?c.push(p):s.push(p);if(c.length===0||s.length===0)return!1;const d=Wi(l.laneValues,n);for(const p of c)for(const f of s){const m=10-d[p];if(m>=0&&m<=3){const y=10-d[f];if(m<y)return!0}}return!1}function nm(a,n){if(!n||n.type!=="prompt_rearrange_protocols")return{type:"rearrangeProtocols",newOrder:[...a.opponent.protocols]};const l=n.target,c=n.disallowedProtocolForLane;let s=null;n.originalAction&&n.originalAction.type==="compile"&&(s=n.originalAction.laneIndex);const d=_=>{if(!c)return!0;const{laneIndex:b,protocol:k}=c;return _[b]!==k},p=a.opponent,f=a.player,h=Wi(p.laneValues,s),m=Wi(f.laneValues,s),g=p.compiled.filter(_=>_).length;if(f.compiled.filter(_=>_).length===2&&g===2){const _=f.compiled.findIndex($=>!$),b=p.compiled.findIndex($=>!$),k=m[_],S=h[b];if(k>S&&l==="player"){let $=-1,E=1/0;for(let C=0;C<3;C++)f.compiled[C]&&m[C]<E&&(E=m[C],$=C);if($!==-1&&E<=k){const C=[...f.protocols];if([C[_],C[$]]=[C[$],C[_]],d(C))return{type:"rearrangeProtocols",newOrder:C}}return jo(f.protocols,d)}if(k<=S&&l==="opponent"){let $=-1,E=-1;for(let C=0;C<3;C++)p.compiled[C]&&h[C]>E&&(E=h[C],$=C);if($!==-1&&E>S&&E>0){const C=[...p.protocols];if([C[b],C[$]]=[C[$],C[b]],d(C))return{type:"rearrangeProtocols",newOrder:C}}return jo(p.protocols,d)}}if(l==="player"){const _=[],b=[];for(let E=0;E<3;E++)f.compiled[E]?_.push(E):b.push(E);if(_.length===0||b.length===0){if(n.sourceCardId!=="CONTROL_MECHANIC")for(let C=0;C<3;C++)for(let N=C+1;N<3;N++){const T=[...f.protocols];if([T[C],T[N]]=[T[N],T[C]],d(T))return{type:"rearrangeProtocols",newOrder:T}}return jo(f.protocols,d)}let k=null;for(const E of b)if(m[E]>=10&&m[E]>h[E]){for(const N of _){k={compiledIdx:N,uncompiledIdx:E};break}if(k)break}if(k){const E=[...f.protocols];if([E[k.compiledIdx],E[k.uncompiledIdx]]=[E[k.uncompiledIdx],E[k.compiledIdx]],d(E))return{type:"rearrangeProtocols",newOrder:E}}let S=null;for(const E of _)for(const C of b){const N=m[C]-m[E];(!S||N>S.score)&&(S={compiledIdx:E,uncompiledIdx:C,score:N})}const $=n.sourceCardId!=="CONTROL_MECHANIC";if(S&&S.score>0){const E=[...f.protocols];if([E[S.compiledIdx],E[S.uncompiledIdx]]=[E[S.uncompiledIdx],E[S.compiledIdx]],d(E))return{type:"rearrangeProtocols",newOrder:E}}if($)for(let E=0;E<3;E++)for(let C=E+1;C<3;C++){const N=[...f.protocols];if([N[E],N[C]]=[N[C],N[E]],d(N))return{type:"rearrangeProtocols",newOrder:N}}return jo(f.protocols,d)}if(l==="opponent"){const _=[],b=[];for(let $=0;$<3;$++)p.compiled[$]?_.push($):b.push($);if(_.length===0||b.length===0){if(n.sourceCardId!=="CONTROL_MECHANIC")for(let E=0;E<3;E++)for(let C=E+1;C<3;C++){const N=[...p.protocols];if([N[E],N[C]]=[N[C],N[E]],d(N))return{type:"rearrangeProtocols",newOrder:N}}return jo(p.protocols,d)}let k=null;for(const $ of _)for(const E of b){const C=h[$],N=h[E],T=C-N,q=C>=10&&C>m[$]?T+100:T;(!k||q>k.score)&&(k={compiledIdx:$,uncompiledIdx:E,score:q,newUncompiledValue:C})}const S=n.sourceCardId!=="CONTROL_MECHANIC";if(k&&k.score>0){const $=[...p.protocols];if([$[k.compiledIdx],$[k.uncompiledIdx]]=[$[k.uncompiledIdx],$[k.compiledIdx]],d($))return{type:"rearrangeProtocols",newOrder:$}}if(S)for(let $=0;$<3;$++)for(let E=$+1;E<3;E++){const C=[...p.protocols];if([C[$],C[E]]=[C[E],C[$]],d(C))return{type:"rearrangeProtocols",newOrder:C}}return jo(p.protocols,d)}const w=l==="player"?[...f.protocols]:[...p.protocols];return jo(w,d)}function jo(a,n){if(n(a))return{type:"rearrangeProtocols",newOrder:[...a]};for(let l=0;l<3;l++)for(let c=l+1;c<3;c++){const s=[...a];if([s[l],s[c]]=[s[c],s[l]],n(s))return{type:"rearrangeProtocols",newOrder:s}}return console.error("[AI Rearrange] Could not find any valid arrangement - returning current order"),{type:"rearrangeProtocols",newOrder:[...a]}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function am(a,n){return on(a).some(({rule:c,cardOwner:s})=>c.type!=="require_face_down_play"?!1:c.target==="all"||c.target==="opponent"&&s!==n)}function Td(a){const n=a;return n.customEffects?[...n.customEffects.topEffects||[],...n.customEffects.middleEffects||[],...n.customEffects.bottomEffects||[]].some(c=>{var p,f;const s=c.trigger;return(s==="on_cover"||s==="on_cover_or_flip")&&((p=c.params)==null?void 0:p.action)==="delete"&&((f=c.params)==null?void 0:f.deleteSelf)===!0}):!1}function Z_(a,n,l){const c=a[n].lanes[l];if(c.length===0)return null;const s=c[c.length-1];return s.isFaceUp&&Td(s)?s.value:null}function om(a){const n=a;return n.customEffects?[...n.customEffects.topEffects||[],...n.customEffects.middleEffects||[],...n.customEffects.bottomEffects||[]].some(c=>{var s;return c.params.action==="return"&&((s=c.params.targetFilter)==null?void 0:s.owner)==="own"}):!1}function rm(a){const n=a;return n.customEffects?[...n.customEffects.topEffects||[],...n.customEffects.middleEffects||[],...n.customEffects.bottomEffects||[]].some(c=>{var s,d,p;return c.params.action==="delete"&&((s=c.params.targetFilter)==null?void 0:s.owner)==="own"&&(((d=c.params.targetFilter)==null?void 0:d.valueFilter)==="highest"||((p=c.params.targetFilter)==null?void 0:p.calculation)==="highest_value")}):!1}function K_(a){const n=a;if(!n.customEffects)return 0;const l=n.customEffects.topEffects||[];for(const c of l)if(c.trigger==="passive"&&c.params.action==="value_modifier"&&(c.params.condition==="per_face_down_card"||c.params.applyTo==="face_down_cards"))return c.params.modifier||0;return 0}function lm(a,n){let l=0;for(const c of["player","opponent"])for(const s of a[c].lanes[n])if(s.isFaceUp){const d=K_(s);d>0&&(l=Math.max(l,d))}return l}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * EASY AI - Focused on winning, but only looks at own board
 * - Always tries to compile as fast as possible
 * - Prioritizes lanes closest to 10
 * - Doesn't consider opponent's strategy
 * - Makes simple decisions for effect choices
 *
 * FULLY GENERIC: Uses only targetFilter, scope, destinationRestriction from ActionRequired
 * NO card-specific handlers - all effects handled through parameters
 */function bl(a,n,l,c,s,d){const p=[],f=l||{},h=f.position||"uncovered";for(const m of["player","opponent"])if(!(f.owner==="own"&&m!==n)&&!(f.owner==="opponent"&&m===n))for(let g=0;g<a[m].lanes.length;g++){if((c==null?void 0:c.type)==="this_lane"&&c.laneIndex!==void 0&&g!==c.laneIndex||(c==null?void 0:c.type)==="other_lanes"&&c.laneIndex!==void 0&&g===c.laneIndex||d!==void 0&&(c==null?void 0:c.type)==="this_lane"&&g!==d)continue;const y=a[m].lanes[g];for(let w=0;w<y.length;w++){const _=y[w];if(Za(a,_.id))continue;const b=Ka(a,y,w);if(!(h==="uncovered"&&!b)&&!(h==="covered"&&b)&&!(f.faceState==="face_up"&&!_.isFaceUp)&&!(f.faceState==="face_down"&&_.isFaceUp)){if(f.valueRange){const k=_.isFaceUp?_.value:2;if(k<f.valueRange.min||k>f.valueRange.max)continue}f.valueEquals!==void 0&&(_.isFaceUp?_.value:2)!==f.valueEquals||f.excludeSelf&&s&&_.id===s||p.push(_)}}}return f.calculation==="highest_value"&&p.length>0?(p.sort((m,g)=>{const y=m.isFaceUp?m.value:2;return(g.isFaceUp?g.value:2)-y}),[p[0]]):f.calculation==="lowest_value"&&p.length>0?(p.sort((m,g)=>{const y=m.isFaceUp?m.value:2,w=g.isFaceUp?g.value:2;return y-w}),[p[0]]):p}function ko(a,n){return a.player.lanes.some(l=>l.some(c=>c.id===n))}function Ya(a,n,l){return a.isFaceUp?a.value:2+0}const J_=a=>{const{opponent:n,player:l}=a;if(n.hand.length===0)return null;const c=(S,$,E)=>ha(a,"opponent",S,$,E).allowed,s=am(a,"opponent"),d=Ji(a,"opponent"),p=Ki(a),f=(S,$)=>s||!c($,!0,S.protocol)?!1:p?S.protocol!==n.protocols[$]&&S.protocol!==l.protocols[$]:S.protocol===n.protocols[$]||S.protocol===l.protocols[$]||d,h=(S,$,E)=>2+lm(a,E),m=n.hand.filter(S=>om(S)?n.lanes.flat().some(C=>C.protocol!==S.protocol):!0);if(m.length===0)return null;const g=S=>{if(Td(S)){for(let $=0;$<3;$++)if(!n.compiled[$]&&n.laneValues[$]+S.value>=10)return!1;return!0}if(rm(S)){let $=0;for(let E=0;E<3;E++){const C=n.lanes[E];if(C.length>0){const N=C[C.length-1],T=N.isFaceUp?N.value:2;T>$&&($=T)}}return S.value>=$}return!1},y=[],_=l.lanes.flat().length+n.lanes.flat().length<=3,b=l.lanes.flat().length>0,k=(S,$)=>S.keywords.flip||S.keywords.delete||S.keywords.shift||S.keywords.return?b||n.lanes.some((N,T)=>T!==$&&N.length>0)||n.lanes[$].length>0:!0;for(const S of m)for(let $=0;$<3;$++){if(n.compiled[$])continue;const E=n.laneValues[$],C=l.laneValues[$];if(f(S,$)&&!g(S)){const N=E+S.value;let T=0;N>=10&&N>C?T=1e3+N:N<10?T=100+N+S.value*5:T=50+S.value,_&&S.value<=2&&(k(S,$)?T-=50:T-=200),S.keywords.draw&&n.hand.length>=5&&(T-=30),y.push({cardId:S.id,laneIndex:$,isFaceUp:!0,score:T})}if(c($,!1,S.protocol)){const N=h(S,!1,$),T=E+N;let H=0;T>=10&&T>C?H=900+T:T<10?H=80+T:H=30+N,y.push({cardId:S.id,laneIndex:$,isFaceUp:!1,score:H})}}if(y.length===0)return null;y.sort((S,$)=>$.score-S.score);for(const S of y){if(S.isFaceUp){const $=n.hand.find(C=>C.id===S.cardId);if(!$||!ha(a,"opponent",S.laneIndex,!0,$.protocol).allowed)continue}return{cardId:S.cardId,laneIndex:S.laneIndex,isFaceUp:S.isFaceUp}}return null},e0=(a,n)=>{var l,c,s,d,p,f;switch(n.type){case"prompt_use_control_mechanic":{const{player:h}=a,m=h.compiled.some(y=>y),g=h.compiled.filter(y=>!y).length;return m&&g>0?{type:"resolveControlMechanicPrompt",choice:"player"}:{type:"resolveControlMechanicPrompt",choice:"skip"}}case"discard":{const h=[...a.opponent.hand].sort((y,w)=>y.value-w.value),m=n.variableCount?Math.min(3,h.length):n.count;return{type:"discardCards",cardIds:h.slice(0,m).map(y=>y.id)}}case"select_cards_to_delete":{const h=n.currentLaneIndex??n.laneIndex,m=n.allowedIds;let g=bl(a,n.actor,n.targetFilter,n.scope,n.sourceCardId,h);m&&(g=g.filter(k=>m.includes(k.id)));const y=n.disallowedIds||[],w=g.filter(k=>!y.includes(k.id));if(w.length===0)return{type:"skip"};const _=w.filter(k=>ko(a,k.id)),b=w.filter(k=>!ko(a,k.id));return _.length>0?(_.sort((k,S)=>Ya(S)-Ya(k)),{type:"deleteCard",cardId:_[0].id}):b.length>0?(b.sort((k,S)=>Ya(k)-Ya(S)),{type:"deleteCard",cardId:b[0].id}):{type:"deleteCard",cardId:w[0].id}}case"select_card_to_flip":case"select_any_card_to_flip":case"select_any_card_to_flip_optional":{const h=Qn(a),m=n.currentLaneIndex??n.laneIndex,g=bl(a,n.actor,n.targetFilter,n.scope,n.sourceCardId,m);if(g.length===0)return n.optional?{type:"skip"}:{type:"skip"};const y=g.filter(b=>ko(a,b.id)),w=g.filter(b=>!ko(a,b.id)),_=y.filter(b=>b.isFaceUp).sort((b,k)=>k.value-b.value);if(_.length>0)return{type:"flipCard",cardId:_[0].id};if(!h){const b=y.filter(k=>!k.isFaceUp);if(b.length>0)return{type:"flipCard",cardId:b[0].id}}if(!h){const b=w.filter(k=>!k.isFaceUp);if(b.length>0)return{type:"flipCard",cardId:b[0].id}}if(!n.optional){const b=w.filter(k=>k.isFaceUp).sort((k,S)=>k.value-S.value);if(b.length>0)return{type:"flipCard",cardId:b[0].id}}return{type:"skip"}}case"select_card_to_shift":{const h=n.scope,m=h==="this_lane"?n.sourceLaneIndex??n.currentLaneIndex??n.laneIndex:void 0,g=bl(a,n.actor,n.targetFilter,h,n.sourceCardId,m);if(g.length===0)return n.optional?{type:"skip"}:{type:"skip"};const y=g.filter(w=>ko(a,w.id));return y.length>0?{type:"shiftCard",cardId:y[0].id}:{type:"shiftCard",cardId:g[0].id}}case"select_card_to_return":{const h=n.currentLaneIndex??n.laneIndex,m=bl(a,n.actor,n.targetFilter,n.scope,n.sourceCardId,h);if(m.length===0)return n.optional?{type:"skip"}:{type:"skip"};const g=m.filter(w=>ko(a,w.id));if(g.length>0)return g.sort((w,_)=>Ya(_)-Ya(w)),{type:"returnCard",cardId:g[0].id};const y=m.filter(w=>!ko(a,w.id));return y.length>0?(y.sort((w,_)=>Ya(w)-Ya(_)),{type:"returnCard",cardId:y[0].id}):{type:"returnCard",cardId:m[0].id}}case"select_lane_for_shift":{let h=n.validLanes||[0,1,2];if(h=h.filter(m=>m!==n.originalLaneIndex),n.destinationRestriction){const m=n.destinationRestriction,g=n.originalLaneIndex;if(m.type==="to_this_lane"&&m.laneIndex!==void 0)h=h.filter(y=>y===m.laneIndex);else if(m.type==="to_another_lane")h=h.filter(y=>y!==g);else if(m.type==="to_or_from_this_lane"&&m.laneIndex!==void 0){const y=typeof m.laneIndex=="number"?m.laneIndex:g;g!==y&&(h=[y])}else if(m.type==="non_matching_protocol"){const y=ve(a,n.cardToShiftId);y&&(h=h.filter(w=>{const _=a.player.protocols[w],b=a.opponent.protocols[w];return y.card.protocol!==_&&y.card.protocol!==b}))}}return h.length>0?{type:"selectLane",laneIndex:h[0]}:{type:"selectLane",laneIndex:0}}case"select_lane_for_shift_all":{let h=n.validLanes||[0,1,2];return h=h.filter(m=>m!==n.sourceLaneIndex),h.length>0?{type:"selectLane",laneIndex:h[0]}:{type:"selectLane",laneIndex:0}}case"select_lane_for_delete":{let h=n.validLanes||[0,1,2];h=h.filter(g=>!(n.excludeSourceLane&&g===n.laneIndex));const m=h.map(g=>{let y=0,w=0;const _=n.deleteFilter;for(const b of a.player.lanes[g])_!=null&&_.valueRange&&b.isFaceUp?b.value>=_.valueRange.min&&b.value<=_.valueRange.max&&(y+=1):_!=null&&_.valueRange||(y+=1);for(const b of a.opponent.lanes[g])_!=null&&_.valueRange&&b.isFaceUp?b.value>=_.valueRange.min&&b.value<=_.valueRange.max&&(w+=2):_!=null&&_.valueRange||(w+=2);return{laneIndex:g,score:y-w}});return m.sort((g,y)=>y.score-g.score),{type:"selectLane",laneIndex:((l=m[0])==null?void 0:l.laneIndex)??0}}case"select_lane_for_delete_all":return n.validLanes.length>0?{type:"selectLane",laneIndex:n.validLanes[0]}:{type:"selectLane",laneIndex:0};case"select_lane_for_play":{let h=n.validLanes||[0,1,2];return n.disallowedLaneIndex!==void 0&&(h=h.filter(m=>m!==n.disallowedLaneIndex)),h=h.filter(m=>ha(a,"opponent",m,!n.isFaceDown,"").allowed),h.length>0?{type:"selectLane",laneIndex:((c=h.filter(g=>!a.opponent.compiled[g]).map(g=>({lane:g,value:a.opponent.laneValues[g]})).sort((g,y)=>y.value-g.value)[0])==null?void 0:c.lane)??h[0]}:{type:"skip"}}case"select_lane_for_return":{const m=[0,1,2].map(g=>{const y=n.returnFilter;let w=0,_=0;for(const b of a.player.lanes[g]){const k=b.isFaceUp?b.value:2;(y==null?void 0:y.valueEquals)!==void 0&&k!==y.valueEquals||(w+=k)}for(const b of a.opponent.lanes[g]){const k=b.isFaceUp?b.value:2;(y==null?void 0:y.valueEquals)!==void 0&&k!==y.valueEquals||(_+=k)}return{laneIndex:g,score:w-_,hasTargets:w>0||_>0}}).filter(g=>g.hasTargets);return m.sort((g,y)=>y.score-g.score),{type:"selectLane",laneIndex:((s=m[0])==null?void 0:s.laneIndex)??0}}case"prompt_optional_effect":return((p=(d=n.effectDef)==null?void 0:d.params)==null?void 0:p.action)==="give"?{type:"resolveOptionalEffectPrompt",accept:!1}:{type:"resolveOptionalEffectPrompt",accept:!0};case"prompt_optional_discard_custom":return{type:"resolveOptionalDiscardCustomPrompt",accept:!1};case"prompt_optional_shuffle_trash":return{type:"resolvePrompt",accept:(n.trashCount||0)>0};case"select_card_from_revealed_deck":{const h=n.selectableCardIds||[];return h.length>0?{type:"selectRevealedDeckCard",cardId:h[0]}:{type:"resolvePrompt",accept:!1}}case"custom_choice":return{type:"resolveCustomChoice",optionIndex:0};case"flip_self":return n.sourceCardId?{type:"flipCard",cardId:n.sourceCardId}:{type:"skip"};case"prompt_rearrange_protocols":return nm(a,n);case"prompt_swap_protocols":return{type:"resolveSwapProtocols",indices:[0,1]};case"select_card_from_hand_to_play":{const h=n.selectableCardIds,m=h?a.opponent.hand.filter(g=>h.includes(g.id)):a.opponent.hand;if(m.length>0){const g=m[0];let y=n.validLanes||[0,1,2].filter(w=>w!==n.disallowedLaneIndex);if(y=y.filter(w=>ha(a,"opponent",w,!n.isFaceDown,g.protocol).allowed),y.length>0){const w=y.filter(_=>!a.opponent.compiled[_]).map(_=>({lane:_,value:a.opponent.laneValues[_]})).sort((_,b)=>b.value-_.value);return{type:"playCard",cardId:g.id,laneIndex:((f=w[0])==null?void 0:f.lane)??y[0],isFaceUp:!1}}}return{type:"skip"}}case"select_card_from_hand_to_give":return a.opponent.hand.length>0?{type:"giveCard",cardId:[...a.opponent.hand].sort((m,g)=>m.value-g.value)[0].id}:{type:"skip"};case"select_card_from_hand_to_reveal":return a.opponent.hand.length>0?{type:"revealCard",cardId:a.opponent.hand[0].id}:{type:"skip"};case"reveal_opponent_hand":return{type:"skip"};case"select_board_card_to_reveal":{const h=bl(a,n.actor,n.targetFilter||{faceState:"face_down",position:"uncovered"},void 0,n.sourceCardId);return h.length>0?{type:"revealCard",cardId:h[0].id}:{type:"skip"}}case"prompt_shift_or_flip_revealed_card":{const h=ve(a,n.revealedCardId);return h?h.owner==="player"?{type:"resolvePrompt",accept:!0}:{type:"resolvePrompt",accept:!1}:{type:"resolvePrompt",accept:!1}}case"select_lane_to_shift_revealed_card":{const h=ve(a,n.revealedCardId);if(!h)return{type:"selectLane",laneIndex:0};let m=-1;for(let y=0;y<a[h.owner].lanes.length;y++)if(a[h.owner].lanes[y].some(w=>w.id===n.revealedCardId)){m=y;break}const g=[0,1,2].filter(y=>y!==m);return g.length>0?{type:"selectLane",laneIndex:g[0]}:{type:"selectLane",laneIndex:0}}case"shift_flipped_card_optional":{const h=n.cardId,m=ve(a,h);if(!m)return{type:"skip"};let g=m.laneIndex??-1;if(g===-1){for(let w=0;w<a[m.owner].lanes.length;w++)if(a[m.owner].lanes[w].some(_=>_.id===h)){g=w;break}}const y=[0,1,2].filter(w=>w!==g);return y.length===0?{type:"skip"}:{type:"selectLane",laneIndex:y[0]}}case"select_phase_effect":{const h=n;return h.availableEffects.length===0?{type:"skip"}:{type:"flipCard",cardId:h.availableEffects[0].cardId}}}return{type:"skip"}},t0=(a,n)=>{if(n)return e0(a,n);if(a.phase==="compile"&&a.compilableLanes.length>0)return{type:"compile",laneIndex:a.compilableLanes[0]};if(a.phase==="action"){const l=J_(a);if(l)return{type:"playCard",...l};if(a.opponent.hand.length<=1)return{type:"fillHand"};for(const c of a.opponent.hand)for(let s=0;s<3;s++){if(a.opponent.compiled[s])continue;if(ha(a,"opponent",s,!1,c.protocol).allowed)return{type:"playCard",cardId:c.id,laneIndex:s,isFaceUp:!1}}return{type:"fillHand"}}return{type:"fillHand"}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * NORMAL AI - Plays like a human player
 * - Makes good strategic decisions
 * - No memory of revealed cards
 * - 20% chance to make suboptimal moves for realism
 * - Balanced between Easy and Hard
 */const Sr=["delete","flip","shift","return","discard"],Rt=a=>{let n=12-a.value;return Sr.some(l=>a.keywords[l])&&(n+=6),a.keywords.draw&&(n+=3),a.keywords.play&&(n+=8),a.keywords.prevent&&(n+=4),n},mr=(a,n,l)=>{let c;for(const d of l[n].lanes)if(d.some(p=>p.id===a.id)){c=d;break}if(!c)return 0;if(!a.isFaceUp)return c.some(p=>p.isFaceUp&&p.protocol==="Darkness"&&p.value===2)?4:2;let s=a.value*2.5;return a.top.length>0&&(s+=6),(a.bottom.includes("Start:")||a.bottom.includes("End:"))&&(s+=8),a.bottom.includes("covered:")&&(s+=5),Sr.some(d=>a.keywords[d])&&(s+=4),s},gr=()=>Math.random()<.2,$h=a=>a+(Math.random()*10-5),yr=(a,n,l,c)=>{const s=l.position||"uncovered";return!(s==="uncovered"&&!n||s==="covered"&&n||l.faceState==="face_up"&&!a.isFaceUp||l.faceState==="face_down"&&a.isFaceUp||l.excludeSelf&&c&&a.id===c||l.valueRange&&(!a.isFaceUp||a.value<l.valueRange.min||a.value>l.valueRange.max)||l.valueEquals!==void 0&&(!a.isFaceUp||a.value!==l.valueEquals))},n0=a=>{const n=[],l=am(a,"opponent"),c=a.player.lanes.flat().length+a.opponent.lanes.flat().length,s=c<=3,d=c>3&&c<=8,f=a.player.lanes.flat().length>0,h=a.player.compiled.filter(Boolean).length,m=a.controlCardHolder==="opponent";a.controlCardHolder;let g=0;for(let E=0;E<3;E++)a.opponent.laneValues[E]>a.player.laneValues[E]?g++:a.player.laneValues[E]>a.opponent.laneValues[E];const w=a.useControlMechanic===!0&&h>=1&&!m;for(let E=0;E<3&&!(!a.player.compiled[E]&&a.player.laneValues[E]>=10&&a.player.laneValues[E]>a.opponent.laneValues[E]);E++);const _=a.opponent.compiled.filter(Boolean).length;let b=-1;if(_<3&&!w){const E=[];for(let C=0;C<3;C++){if(a.opponent.compiled[C])continue;const N=a.opponent.protocols[C],T=a.player.protocols[C],H=a.opponent.laneValues[C],q=a.player.laneValues[C],B=a.opponent.hand.filter(j=>j.protocol===N||j.protocol===T);if(q>=10&&!a.player.compiled[C]){const j=Math.max(...B.map(D=>D.value),0),M=Math.max(j,2);if(H+M<=q)continue}let K=0,U=`Lane ${C} (${N}): value=${H}`;K+=H*15,H>=8?(K+=100,U+=` [ALMOST COMPILE: ${H}]`):H>=6?(K+=60,U+=` [Near compile: ${H}]`):H>=4&&(K+=30,U+=` [Building: ${H}]`),K+=B.length*10,B.length>0&&(U+=` [${B.length} cards]`);const R=B.filter(j=>j.value>=4);K+=R.length*20,q>H&&(K-=(q-H)*5),B.length===0&&(K-=30,U+=" [No matching cards - face-down only]"),E.push({laneIndex:C,score:K,reason:U})}E.sort((C,N)=>N.score-C.score),E.length>0&&(b=E[0].laneIndex)}const k=(E,C)=>E.keywords.flip||E.keywords.delete||E.keywords.shift||E.keywords.return?a.player.lanes.flat().length>0||a.opponent.lanes.some((H,q)=>q!==C&&H.length>0)||a.opponent.lanes[C].length>0:!0,S=E=>E.keywords.draw?a.opponent.hand.length>=5:!1;for(const E of a.opponent.hand)for(let C=0;C<3;C++){const N=ha(a,"opponent",C,!0,E.protocol),T=ha(a,"opponent",C,!1,E.protocol);if(!N.allowed&&!T.allowed||a.opponent.compiled[C])continue;const H=a.player.laneValues[C]>=10&&a.player.laneValues[C]>a.opponent.laneValues[C]&&!a.player.compiled[C];if(H){const j=Math.max(N.allowed?E.value:0,T.allowed?Pn({...E,isFaceUp:!1},a.opponent.lanes[C]):0);if(a.opponent.laneValues[C]+j<=a.player.laneValues[C]&&!Sr.some(M=>E.keywords[M]))continue}let q=!1;if(om(E)){let j=0;for(let F=0;F<3;F++)if(a.opponent.lanes[F].length>0){if(F===C)continue;j++}j===0&&(q=!0)}if(Td(E)){const j=a.opponent.laneValues[C],F=Math.max(0,10-E.value);if(j<F)continue;const M=j+E.value,L=a.player.laneValues[C];if(M<=L)continue}const B=Z_(a,"opponent",C);if(B!==null){const j=a.opponent.laneValues[C],F=j+E.value-B,M=F>=10&&F>a.player.laneValues[C],L=j-B>=4;if(!M&&!L)continue}const K=H;let U=!1;if(rm(E)){let j=0;for(let F=0;F<3;F++){const M=a.opponent.lanes[F];if(M.length>0&&F!==C){const L=M[M.length-1],D=L.isFaceUp?L.value:2;D>j&&(j=D)}}E.value>=j&&(U=!0)}if(N.allowed&&!l&&!U&&!q){let j=0,F=`Play ${E.protocol}-${E.value} face-up in lane ${C}`;const M=E.value,L=a.opponent.laneValues[C]+M;if(K)L>a.player.laneValues[C]?(j=180+L*5,F+=" [Blocks compile!]"):(j=-150,F+=" [Fails to block]");else{if(j+=M*10,L>=10&&L>a.player.laneValues[C]&&!a.opponent.compiled[C])j+=200,F+=` [COMPILE: ${L}]`;else if(L>=8&&L<10&&!a.opponent.compiled[C]){const O=a.opponent.lanes[C].some(ne=>ne.isFaceUp&&ne.protocol==="Darkness"&&ne.value===2)?4:2;a.opponent.laneValues[C]+O>=10&&L<10?(j-=50,F+=` [Near ${L} but face-down could compile!]`):(j+=40,F+=` [Near compile: ${L}]`)}s&&M<=2&&(j-=50,F+=" [Low value early game penalty]"),k(E,C)||(j-=80,F+=" [No valid targets for effect]"),S(E)&&(j-=30,F+=" [Draw would cause discard]");const D=Sr.some(O=>E.keywords[O]);if(D&&f?d&&a.player.laneValues[C]>=5?(j+=35,F+=" [Disruption with targets]"):a.player.laneValues[C]>=8&&(j+=50,F+=" [Disruption near compile]"):D&&!f&&(j-=40,F+=" [Disruption but no targets]"),b!==-1&&!w&&(C===b?(j+=150,F+=" [FOCUS LANE]"):(j-=100,F+=" [Not focus lane]")),w){const O=a.opponent.laneValues[C]>a.player.laneValues[C],X=L>a.player.laneValues[C],ne=a.opponent.laneValues[C]===a.player.laneValues[C];if(O)j-=200,F+=" [ALREADY LEADING - DON'T WASTE!]";else if(!O&&X)g===1?(j+=500,F+=" [CONTROL CAPTURE! 1->2 leads]"):g===0?(j+=300,F+=" [First lead! 0->1 leads]"):(j+=100,F+=" [Extra lead]");else if(ne&&X)g===1?(j+=450,F+=" [BREAK TIE FOR CONTROL!]"):(j+=250,F+=" [Break tie]");else if(!O&&!X&&g===1){const z=a.player.laneValues[C]-L;z<=3?(j+=200,F+=` [BUILD toward 2nd lead, gap=${z}]`):z<=6?(j+=150,F+=` [BUILD toward 2nd lead, gap=${z}]`):(j+=100,F+=` [BUILD toward 2nd lead, gap=${z}]`)}}}n.push({move:{type:"playCard",cardId:E.id,laneIndex:C,isFaceUp:!0},score:$h(j),reason:F})}if(T.allowed){const j=Pn({...E,isFaceUp:!1},a.opponent.lanes[C]),F=a.opponent.laneValues[C]+j,M=a.opponent.laneValues[C];let L=-100,D=`Play ${E.protocol}-${E.value} face-down in lane ${C}`;if(K?F>a.player.laneValues[C]?(L=150,D+=" [Blocks compile]"):(L=-200,D+=" [Fails to block]"):!a.opponent.compiled[C]&&F>=10&&F>a.player.laneValues[C]?(L=300,D+=` [COMPILE: Face-down finishes at ${M} -> ${F} beats player ${a.player.laneValues[C]}]`):!a.opponent.compiled[C]&&a.player.laneValues[C]>=10&&F>=a.player.laneValues[C]?(L=250,D+=` [BLOCK COMPILE: Face-down reaches ${F} vs player ${a.player.laneValues[C]}]`):!a.opponent.compiled[C]&&a.player.laneValues[C]>=10&&F<a.player.laneValues[C]?(L=-200,D+=` [WASTED: ${F} vs player ${a.player.laneValues[C]} - player still compiles!]`):b===C&&!a.opponent.compiled[C]&&M>=4?(L=50+M*10,D+=` [BUILD FOCUS: ${M} -> ${F}]`):!N.allowed&&E.value<=1?(L=-20,D+=" [No face-up option, low value]"):(L=-120,D+=" [Avoid: Face-up is better]"),b!==-1&&L<50&&!w&&(C===b?(L+=50,D+=" [Focus lane]"):(L-=80,D+=" [Not focus lane]")),w){const O=a.opponent.laneValues[C]>a.player.laneValues[C],X=F>a.player.laneValues[C],ne=a.opponent.laneValues[C]===a.player.laneValues[C];if(O)L-=200,D+=" [FD ALREADY LEADING - DON'T WASTE!]";else if(!O&&X)g===1?(L+=400,D+=" [FD CONTROL CAPTURE! 1->2 leads]"):g===0&&(L+=250,D+=" [FD First lead!]");else if(ne&&X)g===1?(L+=350,D+=" [FD BREAK TIE FOR CONTROL!]"):(L+=200,D+=" [FD Break tie]");else if(!O&&!X&&g===1){const z=a.player.laneValues[C]-F;z<=3?(L+=150,D+=` [FD BUILD toward 2nd lead, gap=${z}]`):z<=6&&(L+=100,D+=` [FD BUILD toward 2nd lead, gap=${z}]`)}}n.push({move:{type:"playCard",cardId:E.id,laneIndex:C,isFaceUp:!1},score:$h(L),reason:D})}}if(a.opponent.hand.length===0)n.push({move:{type:"fillHand"},score:500,reason:"Must refill - no cards"});else{const E=a.player.laneValues.some((T,H)=>T>=10&&T>a.opponent.laneValues[H]&&!a.player.compiled[H]),C=a.controlCardHolder==="opponent",N=a.player.compiled.some(T=>T);E&&C&&N&&n.push({move:{type:"fillHand"},score:200,reason:"Emergency draw to block compile with control swap"})}if(n.length===0)return{type:"fillHand"};n.sort((E,C)=>C.score-E.score);const $=E=>{if(E.type==="playCard"&&E.isFaceUp){const C=a.opponent.hand.find(T=>T.id===E.cardId);if(!C)return!1;const N=ha(a,"opponent",E.laneIndex,!0,C.protocol);if(!N.allowed)return console.warn(`[AI Safety] Rejecting invalid face-up play: ${C.protocol}-${C.value} in lane ${E.laneIndex} - ${N.reason}`),!1}return!0};if(gr()&&n.length>1&&n[1].score>0&&$(n[1].move))return n[1].move;for(const E of n)if($(E.move))return E.move;return console.warn("[AI Safety] No valid moves found, falling back to fillHand"),{type:"fillHand"}},a0=(a,n)=>{var l,c;switch(n.type){case"prompt_use_control_mechanic":{const s=a.player.compiled.filter(h=>h).length,d=a.compilableLanes.length>0?a.compilableLanes[0]:null;let p=-1;for(let h=0;h<3;h++)if(!a.player.compiled[h]&&a.player.laneValues[h]>=10&&a.player.laneValues[h]>a.opponent.laneValues[h]){p=h;break}const f=a.player.compiled.map((h,m)=>h?m:-1).filter(h=>h!==-1);return p!==-1&&f.length>0?{type:"resolveControlMechanicPrompt",choice:"player"}:s===0?qh(a,d)&&!gr()?{type:"resolveControlMechanicPrompt",choice:"opponent"}:{type:"resolveControlMechanicPrompt",choice:"skip"}:X_(a,d)?{type:"resolveControlMechanicPrompt",choice:"player"}:qh(a,d)&&!gr()?{type:"resolveControlMechanicPrompt",choice:"opponent"}:{type:"resolveControlMechanicPrompt",choice:"skip"}}case"discard":return{type:"discardCards",cardIds:[...a.opponent.hand].sort((d,p)=>{const f=Sr.some(m=>d.keywords[m]),h=Sr.some(m=>p.keywords[m]);return f&&!h?1:!f&&h?-1:Rt(d)-Rt(p)}).slice(0,n.count).map(d=>d.id)};case"discard_completed":return{type:"skip"};case"select_opponent_card_to_flip":{const d=(f=>a[f].lanes.map(h=>h.length>0?h[h.length-1]:null).filter(h=>h!==null))("player");if(d.length===0)return{type:"skip"};const p=d.map(f=>({cardId:f.id,score:f.isFaceUp?f.value+5:3}));return p.sort((f,h)=>h.score-f.score),{type:"flipCard",cardId:p[0].cardId}}case"select_cards_to_delete":{const s=n.disallowedIds||[],d=n.allowedIds,p=n.targetFilter??{},f="actorChooses"in n?n.actorChooses:"effect_owner",h=n.sourceCardId;if(f==="card_owner"&&(p==null?void 0:p.owner)==="opponent"){const y=[];return a.opponent.lanes.forEach(w=>{if(w.length>0){const _=w[w.length-1];if(yr(_,!0,p,h)){if(d&&!d.includes(_.id))return;y.push(_)}}}),y.length>0?(y.sort((w,_)=>w.value-_.value),{type:"deleteCard",cardId:y[0].id}):{type:"skip"}}const m=y=>a[y].lanes.map(w=>w.length>0?w[w.length-1]:null).filter(w=>w!==null).filter(w=>yr(w,!0,p,h)).filter(w=>!d||d.includes(w.id)),g=p==null?void 0:p.owner;if(g==="own"){const y=m("opponent").filter(w=>!s.includes(w.id));if(y.length>0)return{type:"deleteCard",cardId:y.sort((_,b)=>_.value-b.value)[0].id}}else if(g==="opponent"){const y=m("player").filter(w=>!s.includes(w.id));if(y.length>0){const w=y.map(_=>{const b=a.player.lanes.findIndex($=>$.some(E=>E.id===_.id)),k=a.player.laneValues[b],S=k>=10&&k>a.opponent.laneValues[b];return{cardId:_.id,score:mr(_,"player",a)+k+(S?50:0)}});return w.sort((_,b)=>b.score-_.score),{type:"deleteCard",cardId:w[0].cardId}}}else{const y=m("player").filter(_=>!s.includes(_.id));if(y.length>0){const _=y.map(b=>{const k=a.player.lanes.findIndex(E=>E.some(C=>C.id===b.id)),S=a.player.laneValues[k],$=S>=10&&S>a.opponent.laneValues[k];return{cardId:b.id,score:mr(b,"player",a)+S+($?50:0)}});return _.sort((b,k)=>k.score-b.score),{type:"deleteCard",cardId:_[0].cardId}}const w=m("opponent").filter(_=>!s.includes(_.id));if(w.length>0)return{type:"deleteCard",cardId:w.sort((b,k)=>b.value-k.value)[0].id}}return{type:"skip"}}case"select_any_card_to_flip":case"select_any_other_card_to_flip":case"select_any_face_down_card_to_flip_optional":case"select_any_card_to_flip_optional":{const s=Qn(a),d=n.targetFilter,p=n.sourceCardId,f=n.actor,h=n.currentLaneIndex??n.laneIndex,m=n.scope,g=[];for(const w of["player","opponent"])if(!(d&&(d.owner==="own"&&w!==f||d.owner==="opponent"&&w===f)))for(let _=0;_<a[w].lanes.length;_++){if(h!==void 0&&_!==h||m==="this_lane"&&h!==void 0&&_!==h)continue;const b=a[w].lanes[_];if(b.length!==0)for(let k=0;k<b.length;k++){const S=b[k],$=k===b.length-1;if(d){if(!yr(S,$,d,p))continue}else if(!$)continue;s&&!S.isFaceUp||g.push({card:S,owner:w})}}if(g.length===0)return{type:"skip"};const y=g.map(({card:w,owner:_})=>{let b=0,k=-1;for(let T=0;T<a[_].lanes.length;T++)if(a[_].lanes[T].some(H=>H.id===w.id)){k=T;break}const S=k>=0?a[_].laneValues[k]:0,$=k>=0?a[_].compiled[k]:!1,E=w.isFaceUp?w.value:2,N=(w.isFaceUp?2:w.value)-E;return _==="player"?w.isFaceUp?(b=-N*15,b+=mr(w,"player",a)):w.value<=1?b=20:b=-30:w.isFaceUp?N>0?(b=N*20+50,!$&&S+N>=10&&(b+=200)):b=N*15-30:N>0?(b=N*20+40,!$&&S+N>=10&&(b+=200)):b=-10,{cardId:w.id,score:b}});return y.sort((w,_)=>_.score-w.score),{type:"flipCard",cardId:y[0].cardId}}case"plague_2_opponent_discard":return a.opponent.hand.length===0?{type:"skip"}:{type:"discardCards",cardIds:[[...a.opponent.hand].sort((d,p)=>Rt(d)-Rt(p))[0].id]};case"select_cards_from_hand_to_discard_for_fire_4":{const s=Math.min(3,a.opponent.hand.length);return s===0?{type:"skip"}:{type:"discardCards",cardIds:[...a.opponent.hand].sort((f,h)=>Rt(f)-Rt(h)).slice(0,s).map(f=>f.id)}}case"select_cards_from_hand_to_discard_for_hate_1":{const s=Math.min(n.count||1,a.opponent.hand.length);return s===0?{type:"skip"}:{type:"discardCards",cardIds:[...a.opponent.hand].sort((f,h)=>Rt(f)-Rt(h)).slice(0,s).map(f=>f.id)}}case"select_card_from_hand_to_play":{if(a.opponent.hand.length===0)return{type:"skip"};const s=n.faceDown===!0,d=n.selectableCardIds,p=d?a.opponent.hand.filter(g=>d.includes(g.id)):a.opponent.hand;if(p.length===0)return{type:"skip"};let f=n.validLanes||[0,1,2].filter(g=>g!==n.disallowedLaneIndex);if(f=f.filter(g=>{const y=a.player.lanes[g],w=y.length>0?y[y.length-1]:null;return!(w&&w.isFaceUp&&w.protocol==="Plague"&&w.value===0)}),f.length===0)return{type:"skip"};const h=[];for(const g of p)for(const y of f){if(!s){const b=a.opponent.lanes.flat().some(E=>E.isFaceUp&&E.protocol==="Spirit"&&E.value===1),k=a.opponent.lanes.some(E=>{if(E.length===0)return!1;const C=E[E.length-1];return C.isFaceUp&&C.protocol==="Chaos"&&C.value===3}),S=[...a.player.lanes.flat(),...a.opponent.lanes.flat()].some(E=>E.isFaceUp&&E.protocol==="Anarchy"&&E.value===1);let $;if(S?$=g.protocol!==a.opponent.protocols[y]&&g.protocol!==a.player.protocols[y]:$=g.protocol===a.opponent.protocols[y]||g.protocol===a.player.protocols[y]||b||k,$){const E=g.value,C=a.opponent.laneValues[y]+E;let N=Rt(g)+E*2;C>=10&&C>a.player.laneValues[y]&&(N+=100),h.push({cardId:g.id,laneIndex:y,isFaceUp:!0,score:N})}}if(!a.player.lanes[y].some(b=>b.isFaceUp&&b.protocol==="Metal"&&b.value===2)){const b=Pn({...g,isFaceUp:!1},a.opponent.lanes[y]),k=a.opponent.laneValues[y]+b;let S=b*2;k>=10&&k>a.player.laneValues[y]&&(S+=80),h.push({cardId:g.id,laneIndex:y,isFaceUp:!1,score:S})}}if(h.length===0)return{type:"skip"};h.sort((g,y)=>y.score-g.score);const m=h[0];return{type:"playCard",cardId:m.cardId,laneIndex:m.laneIndex,isFaceUp:m.isFaceUp}}case"select_card_from_hand_to_give":return a.opponent.hand.length===0?{type:"skip"}:{type:"giveCard",cardId:[...a.opponent.hand].sort((d,p)=>Rt(d)-Rt(p))[0].id};case"select_card_from_hand_to_reveal":return a.opponent.hand.length===0?{type:"skip"}:{type:"revealCard",cardId:[...a.opponent.hand].sort((d,p)=>Rt(p)-Rt(d))[0].id};case"select_card_to_return":case"select_opponent_card_to_return":{const d={position:"uncovered",...n.targetFilter||{}},p=n.targetOwner||d.owner,f=n.sourceCardId,h=n.actor,m=[];for(const w of["player","opponent"])if(!(p==="own"&&w!==h)&&!(p==="opponent"&&w===h))for(const _ of a[w].lanes)for(let b=0;b<_.length;b++){const k=_[b],S=b===_.length-1;yr(k,S,d,f)&&m.push({card:k,owner:w})}if(m.length===0)return{type:"skip"};const g=m.filter(w=>w.owner==="player"),y=m.filter(w=>w.owner==="opponent");return g.length>0?(g.sort((w,_)=>mr(_.card,"player",a)-mr(w.card,"player",a)),{type:"returnCard",cardId:g[0].card.id}):y.length>0?(y.sort((w,_)=>w.card.value-_.card.value),{type:"returnCard",cardId:y[0].card.id}):{type:"returnCard",cardId:m[0].card.id}}case"select_lane_for_play":{let s=n.validLanes||[0,1,2];if(s=s.filter(p=>!("disallowedLaneIndex"in n)||p!==n.disallowedLaneIndex),s=s.filter(p=>{const f=a.player.lanes[p],h=f.length>0?f[f.length-1]:null,m=h&&h.isFaceUp&&h.protocol==="Plague"&&h.value===0,g="isFaceDown"in n&&n.isFaceDown&&f.some(y=>y.isFaceUp&&y.protocol==="Metal"&&y.value===2);return!m&&!g}),s.length===0)return{type:"skip"};const d=s.map(p=>{const f=a.opponent.laneValues[p]-a.player.laneValues[p];return{laneIndex:p,score:-f}});return d.sort((p,f)=>f.score-p.score),{type:"selectLane",laneIndex:d[0].laneIndex}}case"prompt_rearrange_protocols":return nm(a,n);case"prompt_swap_protocols":{const{target:s}=n,d=a[s].protocols,p=a[s].hand,f=a[s].compiled,h=a[s].laneValues,m=[[0,1],[0,2],[1,2]];let g=[0,1],y=-1/0;for(const w of m){const[_,b]=w,k=[...d];[k[_],k[b]]=[k[b],k[_]];let S=0;const $=f[_],E=f[b],C=h[_],N=h[b];if(s==="opponent"){$&&!E?N<C&&(S+=30):E&&!$&&C<N&&(S+=30);for(const T of p){const H=T.protocol===d[_],q=T.protocol===d[b],B=T.protocol===k[_],K=T.protocol===k[b],U=$?.5:1.5,R=E?.5:1.5;B&&!H&&(S+=Rt(T)*U),K&&!q&&(S+=Rt(T)*R),!B&&H&&(S-=Rt(T)*U),!K&&q&&(S-=Rt(T)*R)}}else{$&&!E?C>N&&(S+=25):E&&!$&&N>C&&(S+=25);for(const T of p){const H=T.protocol===d[_],q=T.protocol===d[b],B=T.protocol===k[_],K=T.protocol===k[b],U=$?.5:1.5,R=E?.5:1.5;B&&!H&&(S-=Rt(T)*U),K&&!q&&(S-=Rt(T)*R),!B&&H&&(S+=Rt(T)*U),!K&&q&&(S+=Rt(T)*R)}}S>y&&(y=S,g=w)}return{type:"resolveSwapProtocols",indices:g}}case"select_lane_for_shift":{let s=n.validLanes||[0,1,2];if(s=s.filter(d=>!("disallowedLaneIndex"in n)||d!==n.disallowedLaneIndex).filter(d=>!("originalLaneIndex"in n)||d!==n.originalLaneIndex),"sourceCardId"in n){const d=[...a.player.lanes.flat(),...a.opponent.lanes.flat()].find(p=>p.id===n.sourceCardId);if(d&&d.protocol==="Gravity"&&d.value===1){let p=null;for(let f=0;f<3;f++)if([...a.player.lanes[f],...a.opponent.lanes[f]].some(m=>m.id===n.sourceCardId)){p=f;break}p!==null&&"originalLaneIndex"in n&&(n.originalLaneIndex===p||(s=[p]))}if(d&&d.protocol==="Anarchy"&&d.value===1){const p="cardToShiftId"in n?n.cardToShiftId:null;if(p){const f=[...a.player.lanes.flat(),...a.opponent.lanes.flat()].find(h=>h.id===p);f&&(s=s.filter(h=>{const m=a.player.protocols[h],g=a.opponent.protocols[h],y=f.protocol;return y!==m&&y!==g}))}}}if(s.length>0){const d="cardToShiftId"in n?n.cardToShiftId:null;let p=null,f=0;if(d)for(const m of["player","opponent"]){for(const g of a[m].lanes){const y=g.find(w=>w.id===d);if(y){p=m,f=y.isFaceUp?y.value:2;break}}if(p)break}const h=s.map(m=>{let g=0;const y=a.player.laneValues[m],w=a.opponent.laneValues[m],_=a.player.compiled[m],b=a.opponent.compiled[m];return p==="player"?_?g+=100:w>y?g+=50:y>=6&&y<10&&!_&&(g-=50):p==="opponent"&&(!b&&w<10?w+f>=10?g+=100:w>=6?g+=60:g+=30:b&&(g-=50)),{laneIdx:m,score:g}});if(h.sort((m,g)=>g.score-m.score),gr()&&h.length>1){const m=Math.floor(Math.random()*h.length);return{type:"selectLane",laneIndex:h[m].laneIdx}}return{type:"selectLane",laneIndex:h[0].laneIdx}}return{type:"selectLane",laneIndex:0}}case"select_lane_for_delete_all":{const s="validLanes"in n?n.validLanes:[0,1,2];return s.length>0?{type:"selectLane",laneIndex:s[Math.floor(Math.random()*s.length)]}:{type:"skip"}}case"select_lane_for_return":{const s=n.targetFilter||{},d=n.actor,p=s.valueEquals,f=s.valueRange,h=[];for(let m=0;m<3;m++){let g=0,y=0;const w=lm(a,m);for(const k of["player","opponent"]){if(s.owner==="own"&&k!==d||s.owner==="opponent"&&k===d)continue;const S=a[k].lanes[m];for(let $=0;$<S.length;$++){const E=S[$],C=$===S.length-1;if(s.position==="uncovered"&&!C||s.position==="covered"&&C)continue;const N=E.isFaceUp?E.value:2+w;p!==void 0&&N!==p||f&&(N<f.min||N>f.max)||(k==="player"?g+=N:y+=N)}}const _=g-y,b=`Lane ${m}: Player loses ${g}, we lose ${y}, net=${_}`;h.push({laneIndex:m,score:_,reason:b})}h.sort((m,g)=>g.score-m.score);for(const m of h);return h.length>0?{type:"selectLane",laneIndex:h[0].laneIndex}:{type:"selectLane",laneIndex:0}}case"prompt_optional_effect":{const{effectDef:s}=n,d=(l=s==null?void 0:s.params)==null?void 0:l.action,p=(c=s==null?void 0:s.params)==null?void 0:c.targetFilter;if(d==="give")return{type:"resolveOptionalEffectPrompt",accept:!1};if(d==="flip"){let f=!1;const h=(p==null?void 0:p.position)||"uncovered";for(const m of["player","opponent"])if(!((p==null?void 0:p.owner)==="own"&&m!=="opponent")&&!((p==null?void 0:p.owner)==="opponent"&&m==="opponent")){for(let g=0;g<a[m].lanes.length;g++){const y=a[m].lanes[g];if(y.length!==0){for(let w=0;w<y.length;w++){const _=y[w],b=w===y.length-1,k=!b;if(h==="uncovered"&&!b||h==="covered"&&!k||(p==null?void 0:p.faceState)==="face_up"&&!_.isFaceUp||(p==null?void 0:p.faceState)==="face_down"&&_.isFaceUp)continue;const S=_.isFaceUp?_.value:2,$=_.isFaceUp?2:_.value;if(m==="player"){if(_.isFaceUp&&S>$){f=!0;break}}else{const E=a.opponent.laneValues[g],C=$-S;if(_.isFaceUp&&C>0){f=!0;break}if(!_.isFaceUp&&_.value>2){f=!0;break}if(C>0&&E+C>=10&&!a.opponent.compiled[g]){f=!0;break}}}if(f)break}}if(f)break}return{type:"resolveOptionalEffectPrompt",accept:f}}return{type:"resolveOptionalEffectPrompt",accept:!gr()}}case"select_card_from_other_lanes_to_delete":{const{disallowedLaneIndex:s,lanesSelected:d}=n,p=[];for(let f=0;f<3;f++){if(f===s||d.includes(f))continue;const h=a.player.lanes[f];if(h.length>0){p.push(h[h.length-1]);continue}const m=a.opponent.lanes[f];m.length>0&&p.push(m[m.length-1])}return p.length>0?{type:"deleteCard",cardId:p[0].id}:{type:"skip"}}case"select_face_down_card_to_delete":{const s="disallowedIds"in n&&Array.isArray(n.disallowedIds)?n.disallowedIds:[],d=h=>a[h].lanes.map(m=>m.length>0?m[m.length-1]:null).filter(m=>m!==null),p=d("player").filter(h=>!s.includes(h.id));if(p.length>0)return{type:"deleteCard",cardId:p[0].id};const f=d("opponent").filter(h=>!s.includes(h.id));return f.length>0?{type:"deleteCard",cardId:f[0].id}:{type:"skip"}}case"select_low_value_card_to_delete":{const s=[];for(const p of["player","opponent"])for(const f of a[p].lanes)f.length>0&&s.push(f[f.length-1]);const d=s.filter(p=>p.isFaceUp&&(p.value===0||p.value===1));return d.length>0?{type:"deleteCard",cardId:d[0].id}:{type:"skip"}}case"select_opponent_face_up_card_to_flip":{const d=(p=>a[p].lanes.map(f=>f.length>0?f[f.length-1]:null).filter(f=>f!==null))("player").filter(p=>p.isFaceUp);return d.length>0?(d.sort((p,f)=>f.value-p.value),{type:"flipCard",cardId:d[0].id}):{type:"skip"}}case"select_covered_card_in_line_to_flip_optional":{const s="optional"in n&&n.optional,p=!["select_any_other_card_to_flip","select_any_other_card_to_flip_for_water_0"].includes(n.type);if(n.type==="select_covered_card_in_line_to_flip_optional"){const{laneIndex:w}=n,_=a.opponent.lanes[w],b=a.player.lanes[w],k=_.filter((H,q,B)=>q<B.length-1),S=b.filter((H,q,B)=>q<B.length-1),$=a.opponent.laneValues[w];if(!a.opponent.compiled[w]){let H=null,q=null;for(const B of k){let K,U;B.isFaceUp?(K=B.value,U=2):(K=Pn(B,_,a,w,"opponent"),U=B.value);const R=U-K,j=$+R;R>0&&j>=10&&(!H||j>H.newValue)&&(H={card:B,newValue:j,gain:R}),R>0&&(!q||R>q.gain)&&(q={card:B,gain:R,newValue:j})}if(H)return{type:"flipCard",cardId:H.card.id};if(q&&q.gain>0)return{type:"flipCard",cardId:q.card.id}}if(a.opponent.compiled[w]){let H=null;for(const q of k){const B=q.isFaceUp?q.value:Pn(q,_,a,w,"opponent"),U=(q.isFaceUp?2:q.value)-B;U>0&&(!H||U>H.gain)&&(H={card:q,gain:U})}if(H)return{type:"flipCard",cardId:H.card.id}}const C=S.filter(H=>H.isFaceUp);if(C.length>0)return C.sort((H,q)=>q.value-H.value),{type:"flipCard",cardId:C[0].id};const N=k.filter(H=>!H.isFaceUp).map(H=>({card:H,gain:H.value-Pn(H,_,a,w,"opponent")})).filter(H=>H.gain>0).sort((H,q)=>q.gain-H.gain);if(N.length>0)return{type:"flipCard",cardId:N[0].card.id};const T=S.filter(H=>!H.isFaceUp);return T.length>0?{type:"flipCard",cardId:T[0].id}:{type:"skip"}}const f=w=>a[w].lanes.map(_=>_.length>0?_[_.length-1]:null).filter(_=>_!==null),h=f("player"),m=f("opponent");{const w=h.filter(_=>_.isFaceUp).sort((_,b)=>b.value-_.value);if(w.length>0)return{type:"flipCard",cardId:w[0].id}}const g=m.filter(w=>!w.isFaceUp);if(g.length>0)return{type:"flipCard",cardId:g[0].id};const y=h.filter(w=>!w.isFaceUp);if(y.length>0)return{type:"flipCard",cardId:y[0].id};{const w=m.filter(b=>!(!b.isFaceUp||!p&&b.id===n.sourceCardId)),_=w.filter(b=>{const k=a.opponent.lanes.findIndex(S=>S.length>0&&S[S.length-1].id===b.id);return k!==-1&&a.opponent.compiled[k]});if(_.length>0&&!s)return{type:"flipCard",cardId:_[0].id};if(w.length>0&&!s)return{type:"flipCard",cardId:w[0].id}}return{type:"skip"}}case"select_card_to_shift_for_anarchy_0":{const s=[...a.player.lanes.flat(),...a.opponent.lanes.flat()];return s.length>0?{type:"shiftCard",cardId:s[Math.floor(Math.random()*s.length)].id}:{type:"skip"}}case"select_card_to_shift_for_anarchy_1":{const{sourceCardId:s}=n,d=[...a.player.lanes.flat(),...a.opponent.lanes.flat()].filter(p=>p.id!==s);return d.length>0?{type:"shiftCard",cardId:d[Math.floor(Math.random()*d.length)].id}:{type:"skip"}}case"select_card_to_shift_for_gravity_1":{const s=[...a.player.lanes.flat(),...a.opponent.lanes.flat()];return s.length>0?{type:"shiftCard",cardId:s[Math.floor(Math.random()*s.length)].id}:{type:"skip"}}case"select_face_down_card_to_shift_for_gravity_4":{const{targetLaneIndex:s}=n,d=[];for(const p of["player","opponent"])for(let f=0;f<a[p].lanes.length;f++)if(f!==s)for(const h of a[p].lanes[f])h.isFaceUp||d.push(h);return d.length>0?{type:"deleteCard",cardId:d[Math.floor(Math.random()*d.length)].id}:{type:"skip"}}case"select_face_down_card_to_shift_for_darkness_4":{const s=[];for(const d of["player","opponent"])for(const p of a[d].lanes)if(p.length>0){const f=p[p.length-1];f.isFaceUp||s.push(f)}return s.length>0?{type:"deleteCard",cardId:s[Math.floor(Math.random()*s.length)].id}:{type:"skip"}}case"shift_flipped_card_optional":{const s=n.cardId,d=n.optional,p=ve(a,s);if(!p)return{type:"skip"};const f=p.card,h=p.owner,m=f.isFaceUp?f.value:2;let g=p.laneIndex??-1;if(g===-1){const T=a[h];for(let H=0;H<T.lanes.length;H++)if(T.lanes[H].some(q=>q.id===s)){g=H;break}}if(g===-1)return{type:"skip"};const y=[0,1,2].filter(T=>T!==g);if(y.length===0)return{type:"skip"};const w=a.opponent,_=a.player,b=w.laneValues[g],k=w.compiled[g],S=_.laneValues[g],$=b-m;let E=-1,C=-1/0;const N=0;for(const T of y){const H=w.laneValues[T],q=w.compiled[T],B=_.laneValues[T],K=H+m;let U=0;!k&&b>=8&&b>S&&(U-=100),!q&&K>=10&&K>B&&(U+=80),!q&&H<b&&(k||b<6)&&(U+=20),q&&(U-=30),!q&&H<=B&&K>B&&(U+=25),!k&&b>S&&$<=S&&(U-=40),U>C&&(C=U,E=T)}return d&&C<N?{type:"skip"}:E!==-1?{type:"selectLane",laneIndex:E}:d?{type:"skip"}:{type:"selectLane",laneIndex:y[0]}}case"select_opponent_face_down_card_to_shift":{const s=[];for(const d of a.player.lanes)if(d.length>0){const p=d[d.length-1];p.isFaceUp||s.push(p)}return s.length>0?{type:"deleteCard",cardId:s[Math.floor(Math.random()*s.length)].id}:{type:"skip"}}case"select_opponent_covered_card_to_shift":{const s=[];for(const d of a.player.lanes)for(let p=0;p<d.length-1;p++)s.push(d[p]);return s.length>0?{type:"deleteCard",cardId:s[Math.floor(Math.random()*s.length)].id}:{type:"skip"}}case"select_own_covered_card_to_shift":{const s=[];for(const d of a.opponent.lanes)for(let p=0;p<d.length-1;p++)s.push(d[p]);return s.length>0?{type:"deleteCard",cardId:s[Math.floor(Math.random()*s.length)].id}:{type:"skip"}}case"select_card_to_flip":{const s=n.targetFilter||{},d=n.currentLaneIndex??n.laneIndex,p=n.scope,f=n.actor,h=n.sourceCardId,m=[];for(const y of["player","opponent"])if(!(s.owner==="own"&&y!==f)&&!(s.owner==="opponent"&&y===f))for(let w=0;w<a[y].lanes.length;w++){if(d!==void 0&&w!==d||p==="this_lane"&&d!==void 0&&w!==d)continue;const _=a[y].lanes[w];for(let b=0;b<_.length;b++){const k=_[b];if(Za(a,k.id))continue;const S=Ka(a,_,b);yr(k,S,s,h)&&(s.position==="covered_in_this_line"&&S||m.push({card:k,owner:y,laneIndex:w}))}}if(m.length===0)return{type:"skip"};const g=m.map(({card:y,owner:w,laneIndex:_})=>{let b=0;const k=a[w].laneValues[_],S=a[w].compiled[_],$=y.isFaceUp?y.value:2,C=(y.isFaceUp?2:y.value)-$;return w==="player"?y.isFaceUp?(b=-C*15,b+=mr(y,"player",a)):y.value<=1?b=20:b=-30:y.isFaceUp?C>0?(b=C*20+50,!S&&k+C>=10&&(b+=200)):b=C*15-30:C>0?(b=C*20+40,!S&&k+C>=10&&(b+=200)):b=-10,{card:y,score:b}});if(g.sort((y,w)=>w.score-y.score),gr()&&g.length>1){const y=Math.floor(Math.random()*g.length);return{type:"flipCard",cardId:g[y].card.id}}return{type:"flipCard",cardId:g[0].card.id}}case"select_card_to_shift":{const s=n.targetFilter||{},p=n.scope==="this_lane"?n.sourceLaneIndex??n.currentLaneIndex??n.laneIndex:void 0,f=n.actor,h=n.sourceCardId,m=[];for(const g of["player","opponent"])if(!(s.owner==="own"&&g!==f)&&!(s.owner==="opponent"&&g===f))for(let y=0;y<a[g].lanes.length;y++){if(p!==void 0&&y!==p)continue;const w=a[g].lanes[y];for(let _=0;_<w.length;_++){const b=w[_],k=_===w.length-1;yr(b,k,s,h)&&m.push(b)}}return m.length>0?{type:"shiftCard",cardId:m[Math.floor(Math.random()*m.length)].id}:{type:"skip"}}case"select_board_card_to_reveal_custom":{const s=[];for(const d of["player","opponent"])for(const p of a[d].lanes)if(p.length>0){const f=p[p.length-1];f.isFaceUp||s.push({card:f,owner:d})}if(s.length>0){const d=s.filter(p=>p.owner==="player");return d.length>0?{type:"deleteCard",cardId:d[0].card.id}:{type:"deleteCard",cardId:s[0].card.id}}return{type:"skip"}}case"prompt_shift_or_flip_board_card_custom":{const{revealedCardId:s}=n,d=ve(a,s);return d?d.owner==="opponent"?{type:"resolveRevealBoardCardPrompt",choice:"flip"}:{type:"resolveRevealBoardCardPrompt",choice:"shift"}:{type:"resolveRevealBoardCardPrompt",choice:"skip"}}case"select_lane_to_shift_revealed_board_card_custom":{const s=[0,1,2];return s.sort((d,p)=>a.player.laneValues[d]-a.player.laneValues[p]),{type:"selectLane",laneIndex:s[0]}}case"gravity_2_shift_after_flip":{const{targetLaneIndex:s}=n;return{type:"selectLane",laneIndex:s}}case"flip_self":case"flip_self_for_water_0":case"flip_self_for_psychic_4":case"speed_3_self_flip_after_shift":return n.sourceCardId?{type:"flipCard",cardId:n.sourceCardId}:{type:"skip"};case"anarchy_0_conditional_draw":return{type:"skip"};case"select_any_opponent_card_to_shift":{const s=a.player.lanes.map(d=>d.length>0?d[d.length-1]:null).filter(d=>d!==null);return s.length>0?{type:"deleteCard",cardId:s[Math.floor(Math.random()*s.length)].id}:{type:"skip"}}case"select_own_other_card_to_shift":{const s=a.opponent.lanes.flat().find(d=>d.id!==n.sourceCardId);return s?{type:"deleteCard",cardId:s.id}:{type:"skip"}}case"select_own_face_up_covered_card_to_flip":return{type:"skip"};case"plague_4_opponent_delete":{const s=[];return a.opponent.lanes.forEach(d=>{if(d.length>0){const p=d[d.length-1];p.isFaceUp||s.push(p)}}),s.length>0?(s.sort((d,p)=>d.value-p.value),{type:"deleteCard",cardId:s[0].id}):{type:"skip"}}case"reveal_opponent_hand":case"plague_2_player_discard":case"delete_self":return{type:"skip"};case"select_lane_for_delete":{const s=n.validLanes||[0,1,2],d=n.valueFilter,p=s.map(f=>{let h=0,m=0;for(const g of a.player.lanes[f]){const y=g.isFaceUp?g.value:2;d?g.isFaceUp?g.value>=d.min&&g.value<=d.max&&(h+=y+1):h+=(y+1)*.5:h+=y+1}for(const g of a.opponent.lanes[f]){const y=g.isFaceUp?g.value:2;d?g.isFaceUp?g.value>=d.min&&g.value<=d.max&&(m+=y+3):m+=(y+3)*.5:m+=y+3}return{laneIndex:f,score:h-m}});return p.sort((f,h)=>h.score-f.score),p[0].score>0?{type:"selectLane",laneIndex:p[0].laneIndex}:{type:"selectLane",laneIndex:p[0].laneIndex}}case"select_lane_for_shift_all":{const s=n.validDestinationLanes||n.validLanes||[0,1,2],d=n.sourceLaneIndex,p=s.filter(f=>f!==d);if(p.length>0){const f=p.map(h=>{let m=0;return m+=a.opponent.lanes[h].length*2,m+=a.opponent.laneValues[h],a.player.laneValues[h]>=8&&(m-=5),{laneIndex:h,score:m}});return f.sort((h,m)=>m.score-h.score),{type:"selectLane",laneIndex:f[0].laneIndex}}return s.length>0?{type:"selectLane",laneIndex:s[0]}:{type:"selectLane",laneIndex:0}}case"prompt_optional_draw":return{type:"resolveOptionalEffectPrompt",accept:!0};case"prompt_optional_discard_custom":return{type:"resolveOptionalEffectPrompt",accept:a.opponent.hand.length>4};case"prompt_optional_shuffle_trash":return{type:"resolvePrompt",accept:(n.trashCount||0)>0};case"select_card_from_revealed_deck":{const s=n.selectableCardIds||[];if(s.length>0){const d=Math.floor(Math.random()*s.length);return{type:"selectRevealedDeckCard",cardId:s[d]}}return{type:"resolvePrompt",accept:!1}}case"custom_choice":{const{options:s}=n;if(!s||s.length!==2)return{type:"resolveCustomChoice",optionIndex:0};const d=h=>{var y,w,_;let m=0;const g=((y=h.action)==null?void 0:y.toLowerCase())||"";return g.includes("draw")&&(m+=30),g.includes("discard")&&(m-=20),g.includes("delete")&&((w=h.targetFilter)==null?void 0:w.owner)==="opponent"&&(m+=40),g.includes("delete")&&((_=h.targetFilter)==null?void 0:_.owner)==="own"&&(m-=30),m},p=d(s[0]),f=d(s[1]);return{type:"resolveCustomChoice",optionIndex:p>=f?0:1}}case"select_phase_effect":{const s=n;if(s.availableEffects.length===0)return{type:"skip"};const d=s.availableEffects.map(f=>{let h=0;const m=f.effectDescription.toLowerCase();return m.includes("draw")?h+=100:m.includes("delete")?h+=80:m.includes("shift")?h+=60:m.includes("flip")?h+=40:h+=20,Math.random()<.2&&(h=Math.random()*50),{effect:f,score:h}});return d.sort((f,h)=>h.score-f.score),{type:"flipCard",cardId:d[0].effect.cardId}}default:{if("optional"in n&&n.optional)return{type:"skip"};const s=[...a.player.lanes.flat(),...a.opponent.lanes.flat()];return s.length>0&&(n.type.includes("select_")||n.type.includes("shift"))?{type:"deleteCard",cardId:s[0].id}:{type:"skip"}}}},Uh=(a,n)=>n?a0(a,n):a.phase==="compile"&&a.compilableLanes.length>0?{type:"compile",laneIndex:a.compilableLanes.reduce((c,s)=>a.opponent.laneValues[s]>a.opponent.laneValues[c]?s:c)}:a.phase==="action"?n0(a):{type:"fillHand"};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const yt=(a,n)=>a.phase==="start"?n.continueTurnAfterStartPhaseAction(a):n.processEndOfAction(a),im=(a,n,l,c,s,d,p,f)=>{const{cardId:h,laneIndex:m,isFaceUp:g}=n,{newState:y,animationRequests:w}=s.playCard({...a,actionRequired:null},h,m,g,"opponent"),_={...y,animationState:{type:"playCard",cardId:h,owner:"opponent"}};return setTimeout(()=>{l(b=>{let k={...b,animationState:null};return w&&w.length>0?(d(w,()=>l(S=>{const $={...S,animationState:null};return f&&$.actionRequired?(an($,l,c,s,d,p),$):$.actionRequired&&$.actionRequired.actor==="opponent"?$:{...yt($,p),animationState:null}})),k):f&&k.actionRequired?(an(k,l,c,s,d,p),k):k.actionRequired&&k.actionRequired.actor==="opponent"?k:yt(k,p)})},500),_},Qi=(a,n,l)=>{switch(l){case"normal":return Uh(a,n);case"hard":return console.warn("[AI] Hard AI temporarily disabled, using Normal AI"),Uh(a,n);default:return t0(a,n)}},o0=(a,n,l,c,s,d,p,f,h)=>{n(m=>{const g=m.actionRequired;if(!g||!((m.turn==="player"||m._interruptedTurn==="player")&&"actor"in g&&g.actor==="opponent"))return m;if(g.type==="discard_completed"){const{followUpEffect:k,conditionalType:S,previousHandSize:$,sourceCardId:E,actor:C}=g;if(k&&E){const N=ve(m,E);if(N){const T=m[C].hand.length,H=Math.max(0,($||0)-T);if(S==="then"||S==="if_executed"&&H>0){let B=-1;for(let K=0;K<m[N.owner].lanes.length;K++)if(m[N.owner].lanes[K].some(U=>U.id===E)){B=K;break}if(B!==-1){const K={cardOwner:N.owner,opponent:N.owner==="player"?"opponent":"player",currentTurn:m.turn,actor:C,discardedCount:H},{executeCustomEffect:U}=require("../customProtocols/effectInterpreter");return U(N.card,B,{...m,actionRequired:null},K,k).newState}}}}return{...m,actionRequired:null}}const _=Qi(m,g,l);if(_.type==="discardCards"&&g.type==="discard"){const S=g.variableCount===!0?_.cardIds.length:g.count,$=_.cardIds.slice(0,S);$.length!==_.cardIds.length&&console.warn(`[AI Manager] Fixed discard count: AI wanted ${_.cardIds.length} but action.count=${g.count}`);const E=c.discardCards(m,$,"opponent");return E.actionRequired?E:yt(E,s)}if(_.type==="rearrangeProtocols"&&g.type==="prompt_rearrange_protocols"){h&&g.sourceCardId==="CONTROL_MECHANIC"&&g.actor&&h(g.actor);const k=c.resolveRearrangeProtocols(m,_.newOrder);return yt(k,s)}if(g.type==="reveal_opponent_hand"){const k=c.revealOpponentHand(m);return yt(k,s)}if(_.type==="resolveOptionalEffectPrompt"&&g.type==="prompt_optional_effect"){const k=wd(m,_.accept);return k.actionRequired?k:yt(k,s)}if(_.type==="resolveCustomChoice"&&g.type==="custom_choice"){const k=bd(m,_.optionIndex);return k.actionRequired?k:yt(k,s)}if(_.type==="selectLane"){const{nextState:k,requiresAnimation:S}=f(m,_.laneIndex);if(S){const $=m.phase==="start";return d(S.animationRequests,()=>{n(E=>{const C={...E,animationState:null},N=S.onCompleteCallback(C,H=>H);return N.actionRequired&&N.actionRequired.actor==="opponent"?{...N,animationState:null}:{...$?s.continueTurnAfterStartPhaseAction(N):s.processEndOfAction(N),animationState:null}})}),k}return yt(k,s)}if(_.type==="deleteCard"||_.type==="flipCard"||_.type==="returnCard"||_.type==="shiftCard"){const{nextState:k,requiresAnimation:S}=p(m,_.cardId);if(S){const $=m.phase==="start";return d(S.animationRequests,()=>{n(E=>{const C={...E,animationState:null},N=S.onCompleteCallback(C,H=>H);return N.actionRequired&&N.actionRequired.actor==="opponent"?{...N,animationState:null}:{...$?s.continueTurnAfterStartPhaseAction(N):s.processEndOfAction(N),animationState:null}})}),k}return k.actionRequired&&k.actionRequired.actor==="opponent"?k:yt(k,s)}if(_.type==="playCard"&&g.type==="select_card_from_hand_to_play")return im(m,_,n,l,c,d,s,!1);console.warn(`AI has no logic for mandatory action during player turn, clearing it: ${g.type}, aiDecision: ${JSON.stringify(_)}`);const b={...m,actionRequired:null};return yt(b,s)})},r0=(a,n,l,c,s,d,p)=>{const f=a.actionRequired;if(f.type==="discard_completed"){const{followUpEffect:g,conditionalType:y,previousHandSize:w,sourceCardId:_,actor:b}=f;if(g&&_){const k=ve(a,_);if(k){const S=a[b].hand.length,$=Math.max(0,(w||0)-S);if(y==="then"||y==="if_executed"&&$>0){let C=-1;for(let N=0;N<a[k.owner].lanes.length;N++)if(a[k.owner].lanes[N].some(T=>T.id===_)){C=N;break}if(C!==-1){const N={cardOwner:k.owner,opponent:k.owner==="player"?"opponent":"player",currentTurn:a.turn,actor:b,discardedCount:$},{executeCustomEffect:T}=require("../customProtocols/effectInterpreter");return T(k.card,C,{...a,actionRequired:null},N,g).newState}}}}return{...a,actionRequired:null}}const h=Qi(a,a.actionRequired,l);if(h.type==="skip"){const g=c.skipAction(a),y=a.phase==="start"?d.continueTurnAfterStartPhaseAction(g):d.processEndOfAction(g);return!y.actionRequired&&y.turn==="opponent"&&!y.winner&&setTimeout(()=>{an(y,n,l,c,s,d,p)},500),y}if(h.type==="resolveControlMechanicPrompt"&&f.type==="prompt_use_control_mechanic"){const{choice:g}=h,{originalAction:y,actor:w}=f;if(g==="skip"){let _=ae(a,w,"Opponent skips rearranging protocols.");if(_.actionRequired=null,_={..._,_logIndentLevel:0},y.type==="compile"){const b=y.laneIndex;return setTimeout(()=>{n(k=>{const S=c.compileLane(k,b);return S.winner?S:{...d.processEndOfAction(S),animationState:null}})},1e3),{..._,animationState:{type:"compile",laneIndex:b},compilableLanes:[]}}else if(y.type==="fill_hand"){const b=c.fillHand(_,w);return d.processEndOfAction(b)}else return d.processEndOfAction(_)}else{const _=g;let S=ae(a,w,`Opponent chooses to rearrange ${_==="opponent"?"the player's":"their own"} protocols.`);return S.actionRequired={type:"prompt_rearrange_protocols",sourceCardId:"CONTROL_MECHANIC",target:_,actor:w,originalAction:y},S}}if(h.type==="resolveOptionalDiscardCustomPrompt"&&f.type==="prompt_optional_discard_custom"){const g=c.resolveOptionalDiscardCustomPrompt(a,h.accept);return g.actionRequired?g:yt(g,d)}if(h.type==="resolveOptionalEffectPrompt"){const g=c.resolveOptionalEffectPrompt(a,h.accept);return g.actionRequired?g:yt(g,d)}if(h.type==="resolvePrompt"&&f.type==="prompt_optional_shuffle_trash"){if(!h.accept){let y={...a};return y.actionRequired=null,y=ae(y,f.actor,`${f.actor==="player"?"Player":"Opponent"} skips shuffling trash into deck.`),yt(y,d)}const g=Qh(a,f.actor,"Clarity-4");return yt(g.newState,d)}if(h.type==="resolveSwapProtocols"&&f.type==="prompt_swap_protocols"){const g=c.resolveSwapProtocols(a,h.indices);return yt(g,d)}if(h.type==="resolveCustomChoice"&&f.type==="custom_choice"){const g=c.resolveCustomChoice(a,h.optionIndex);return g.actionRequired?g:yt(g,d)}if(h.type==="resolveRevealBoardCardPrompt"&&(f.type==="prompt_shift_or_flip_revealed_card"||f.type==="prompt_shift_or_flip_board_card_custom")){const g=Cd(a,h.choice);return g.actionRequired?g:yt(g,d)}if(h.type==="rearrangeProtocols"&&f.type==="prompt_rearrange_protocols"){p&&f.sourceCardId==="CONTROL_MECHANIC"&&f.actor&&p(f.actor);const g=c.resolveRearrangeProtocols(a,h.newOrder);return yt(g,d)}if(h.type==="selectLane"){const{nextState:g,requiresAnimation:y}=xd(a,h.laneIndex);if(y){const{animationRequests:w,onCompleteCallback:_}=y;return s(w,()=>{n(b=>{const k={...b,animationState:null};return _(k,S=>{const $={...S,animationState:null},C={...a.phase==="start"?d.continueTurnAfterStartPhaseAction($):d.processEndOfAction($),animationState:null};return!C.actionRequired&&C.turn==="opponent"&&!C.winner?setTimeout(()=>{an(C,n,l,c,s,d,p)},500):C.actionRequired&&C.turn==="opponent"&&setTimeout(()=>{an(C,n,l,c,s,d,p)},300),C})})}),g}return yt(g,d)}if(h.type==="flipCard"||h.type==="deleteCard"||h.type==="returnCard"||h.type==="shiftCard"){const{nextState:g,requiresAnimation:y,requiresTurnEnd:w}=_d(a,h.cardId);if(y){const{animationRequests:_,onCompleteCallback:b}=y;return s(_,()=>{n(k=>{const S={...k,animationState:null};return b(S,$=>{const E={...$,animationState:null};if(E.queuedActions&&E.queuedActions.length>0){const C=d.processEndOfAction(E);return C.actionRequired?(an(C,n,l,c,s,d),{...C,animationState:null}):{...C,animationState:null}}if(E.actionRequired)return an(E,n,l,c,s,d),E;if(E.phase==="start"){const N={...d.continueTurnAfterStartPhaseAction(E),animationState:null};return!N.actionRequired&&N.turn==="opponent"&&!N.winner&&setTimeout(()=>{an(N,n,l,c,s,d,p)},500),N}else return{...d.processEndOfAction(E),animationState:null}})})}),g}return w||g.queuedActions&&g.queuedActions.length>0?yt(g,d):g}if(h.type==="playCard"&&f.type==="select_card_from_hand_to_play")return im(a,h,n,l,c,s,d,!0);if(h.type==="discardCards"&&f.type==="discard"){const y=f.variableCount===!0?h.cardIds.length:f.count,w=h.cardIds.slice(0,y);w.length!==h.cardIds.length&&console.warn(`[AI Manager] Fixed discard count: AI wanted ${h.cardIds.length} but action.count=${f.count}`);const _=c.discardCards(a,w,"opponent");return _.actionRequired?_:yt(_,d)}if(h.type==="giveCard"&&f.type==="select_card_from_hand_to_give"){const g=c.resolveActionWithHandCard(a,h.cardId);return g.actionRequired?g:yt(g,d)}if(h.type==="revealCard"&&f.type==="select_card_from_hand_to_reveal")return c.resolveActionWithHandCard(a,h.cardId);if(h.type==="selectRevealedDeckCard"&&f.type==="select_card_from_revealed_deck"){const g=tm(a,h.cardId);return yt(g,d)}console.warn(`AI has no logic for mandatory action, clearing it: ${f.type}`);const m={...a,actionRequired:null};return yt(m,d)},an=(a,n,l,c,s,d,p)=>{n(f=>{if(f.turn!=="opponent"||f.winner||f.animationState||!["start","compile","action","hand_limit","end"].includes(f.phase))return f;if(f.actionRequired){const g=f.actionRequired;let y=!1;if((g.type==="discard"&&g.actor==="player"||g.type==="plague_4_opponent_delete"&&g.actor==="opponent"||"actor"in g&&g.actor==="player")&&(y=!0),y)return f}let m={...f};if(m.actionRequired&&m.actionRequired.type==="reveal_opponent_hand"){const g=c.revealOpponentHand(m);return d.processEndOfAction(g)}if(m.phase==="start"&&(m=d.processStartOfTurn(m)),m.actionRequired){const g=r0(m,n,l,c,s,d,p);return!g.actionRequired&&g.turn==="opponent"&&!g.winner&&g.phase!=="hand_limit"&&setTimeout(()=>{an(g,n,l,c,s,d,p)},300),g}if(m.phase==="compile"&&m.compilableLanes.length>0){const g=Qi(m,null,l);if(g.type==="compile"){const y=g.laneIndex,w=em(m);return w.actionRequired?w:(setTimeout(()=>{n(_=>{const b=c.compileLane(_,y);return b.winner?b:{...d.processEndOfAction(b),animationState:null}})},1e3),{...w,animationState:{type:"compile",laneIndex:y},compilableLanes:[]})}}if(m.phase==="action"){const g=Qi(m,null,l);if(g.type==="fillHand"){const y=Jh(m,"opponent");return y.actionRequired?y:d.processEndOfAction(y)}if(g.type==="playCard"){const{newState:y,animationRequests:w}=c.playCard(m,g.cardId,g.laneIndex,g.isFaceUp,"opponent"),_={...y,animationState:{type:"playCard",cardId:g.cardId,owner:"opponent"}};return setTimeout(()=>{const b=()=>{n(k=>{let S={...k},$={newState:S};if(!S.actionRequired){if(S.queuedEffect){const{card:T,laneIndex:H}=S.queuedEffect,q={cardOwner:"opponent",actor:"opponent",currentTurn:S.turn,opponent:"player",triggerType:"play"};$=Dl(T,H,S,q),$.newState.queuedEffect=void 0}}const E=$.animationRequests,C=$.newState,N=()=>{n(T=>{if(T.queuedActions&&T.queuedActions.length>0){const H=d.processEndOfAction(T);return H.actionRequired&&an(H,n,l,c,s,d),H}return T.actionRequired?an(T,n,l,c,s,d):n(d.processEndOfAction(T)),T})};if(E&&E.length>0)return s(E,N),C;if(C.queuedActions&&C.queuedActions.length>0){const T=d.processEndOfAction(C);return T.actionRequired&&an(T,n,l,c,s,d),T}return C.actionRequired?an(C,n,l,c,s,d):n(d.processEndOfAction(C)),C})};n(k=>{const S={...k,animationState:null};return w&&w.length>0?s(w,b):b(),S})},500),_}}return m.phase==="end"||m.phase==="hand_limit"?d.continueTurnProgression(m):d.processEndOfAction(m)})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function l0(a,n){let l=null,c=null;const s=["player","opponent"];for(const g of s){for(const y of a[g].lanes){const w=y.find(_=>_.id===n);if(w){l=g,c=w;break}}if(l)break}if(!l||!c)return console.error("Card to delete not found on board:",n),a;const d={...a},p={...d[l]};p.lanes=p.lanes.map(g=>g.filter(y=>y.id!==n));const{id:f,isFaceUp:h,...m}=c;return p.discard=[...p.discard,m],d[l]=p,d}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const i0=(a,n,l,c,s,d="player",p)=>{const[f,h]=re.useState(()=>{const Z=Cl(a,n,s,d);return _e(Z)}),[m,g]=re.useState(null),y=re.useRef(!1),w=re.useRef(0);re.useEffect(()=>{f.turn!==d&&f.log.length<=4&&h(Z=>{const Q=d==="player"?"Player":"Opponent",I=[...Z.log];return I.length>0&&(I[I.length-1]={player:"player",message:`${Q} goes first.`}),{...Z,turn:d,log:I}})},[d,f.turn,f.log.length]);const _=re.useCallback(Z=>{switch(Z){case"start":return Yh;case"end":return xr;default:return br}},[]),b=re.useCallback((Z,Q)=>{const I=W=>{if(W.length===0){Q();return}const[Y,...de]=W;Y.type==="delete"?(h(ee=>({...ee,animationState:{type:"deleteCard",cardId:Y.cardId,owner:Y.owner}})),setTimeout(()=>{h(ee=>{if(!(ee.player.lanes.flat().some(ye=>ye.id===Y.cardId)||ee.opponent.lanes.flat().some(ye=>ye.id===Y.cardId)))return{...ee,animationState:null};let Se=l0(ee,Y.cardId);return Se=_e(Se),{...Se,animationState:null}}),setTimeout(()=>{de.length>0?I(de):Q()},10)},500)):Y.type==="return"?(h(ee=>({...ee,animationState:{type:"returnCard",cardId:Y.cardId,owner:Y.owner}})),setTimeout(()=>{h(ee=>{const ge=ee[Y.owner].lanes.findIndex(Je=>Je.some(at=>at.id===Y.cardId)),Se=ge!==-1&&ee[Y.owner].lanes[ge].length>0&&ee[Y.owner].lanes[ge][ee[Y.owner].lanes[ge].length-1].id===Y.cardId,ye=ee[Y.owner].lanes.flat().find(Je=>Je.id===Y.cardId);if(!ye)return{...ee,animationState:null};const Ne=ee[Y.owner].lanes.map(Je=>Je.filter(at=>at.id!==Y.cardId));let Le={...ee,[Y.owner]:{...ee[Y.owner],lanes:Ne,hand:[...ee[Y.owner].hand,ye]}};return Le=_e(Le),Se&&ge!==-1&&Le[Y.owner].lanes[ge].length>0&&(Le=vn(Le,Y.owner,ge).newState),{...Le,animationState:null}}),setTimeout(()=>{de.length>0?I(de):Q()},10)},500)):Y.type==="play"?(h(ee=>({...ee,animationState:{type:"playCard",cardId:Y.cardId,owner:Y.owner}})),setTimeout(()=>{h(ee=>({...ee,animationState:null})),setTimeout(()=>{de.length>0?I(de):Q()},10)},500)):Y.type==="draw"?(h(ee=>({...ee,animationState:{type:"draw",player:Y.player,count:Y.count}})),setTimeout(()=>{h(ee=>({...ee,animationState:null})),setTimeout(()=>{de.length>0?I(de):Q()},10)},500)):setTimeout(()=>{de.length>0?I(de):Q()},10)};I(Z)},[]),k=(Z,Q,I="player")=>{if(!m||f.turn!=="player"||f.phase!=="action")return;const W=m;g(null),h(Y=>{const de=_(Y.phase),{newState:ee,animationRequests:ge}=Yi(Y,W,Z,Q,"player",I),Se={...ee,animationState:{type:"playCard",cardId:W,owner:"player"}};return setTimeout(()=>{h(ye=>{let Ne={...ye,animationState:null};return ge&&ge.length>0?(b(ge,()=>{h(Le=>de(Le))}),Ne):Ne.actionRequired?Ne:de(Ne)})},500),Se})},S=()=>{f.turn!=="player"||f.phase!=="action"||f.actionRequired||h(Z=>{const Q=_(Z.phase),I=Jh(Z,"player");return I.actionRequired?I:Q(I)})},$=re.useCallback(Z=>{h(Q=>{var I;return((I=Q.actionRequired)==null?void 0:I.type)!=="discard"||Q.actionRequired.actor!=="player"?Q:{...Q,animationState:{type:"discardCard",owner:"player",cardIds:[Z],originalAction:Q.actionRequired}}})},[]),E=re.useCallback(Z=>{h(Q=>{if(Q.winner||Q.phase!=="compile")return Q;const I=_(Q.phase),Y={...em(Q),animationState:{type:"compile",laneIndex:Z},compilableLanes:[]};return setTimeout(()=>{h(de=>{var ye;const ee=kl(de,Z,l);if(ee.winner)return ee;if(((ye=ee.actionRequired)==null?void 0:ye.type)==="prompt_use_control_mechanic")return{...ee,animationState:null};const ge=ee._compileAnimations;if(ge&&ge.length>0){b(ge,()=>{h(Le=>{const Je={...Le};return delete Je._compileAnimations,{...I(Je),animationState:null}})});const Ne={...ee};return delete Ne._compileAnimations,Ne}return{...I(ee),animationState:null}})},1e3),Y})},[l,_]),C=Z=>{h(Q=>{const I=Q.turn,W=_(Q.phase),{nextState:Y,requiresAnimation:de,requiresTurnEnd:ee}=_d(Q,Z);return de?(b(de.animationRequests,()=>{h(ge=>{const Se=ge.turn!==I?ye=>ye:W;return de.onCompleteCallback(ge,Se)})}),Y):Y.actionRequired?Y:W(Y)})},N=Z=>{h(Q=>{const I=_(Q.phase),{nextState:W,requiresAnimation:Y}=xd(Q,Z);return Y?(b(Y.animationRequests,()=>{h(de=>Y.onCompleteCallback(de,I))}),W):W.actionRequired?W:I(W)})},T=Z=>{h(Q=>{const I=_(Q.phase),W=hd(Q,Z);return W.actionRequired?W:I(W)})},H=Z=>{h(Q=>Q_(Q,Z))},q=()=>{h(Z=>{var W,Y;const Q=_(Z.phase);let I={...Z,animationState:null};return((W=I.actionRequired)==null?void 0:W.type)==="prompt_shift_or_flip_board_card_custom"?I=Cd(I,"skip"):I=jh(I),((Y=I.actionRequired)==null?void 0:Y.type)==="plague_4_player_flip_optional"?I:Q(I)})},B=re.useCallback(Z=>{h(Q=>{var Y;if(((Y=Q.actionRequired)==null?void 0:Y.type)!=="prompt_use_control_mechanic")return Q;const{originalAction:I,actor:W}=Q.actionRequired;if(Z==="skip"){let de=ae(Q,W,"Player skips rearranging protocols.");if(de.actionRequired=null,de={...de,_logIndentLevel:0},I.type==="compile"){const ge={...de,animationState:{type:"compile",laneIndex:I.laneIndex},compilableLanes:[]};return setTimeout(()=>{h(Se=>{const ye=kl(Se,I.laneIndex,l);return ye.winner?ye:{..._(ye.phase)(ye),animationState:null}})},1e3),ge}else if(I.type==="continue_turn"){let ee={...de};return I.queuedSpeed2Actions&&I.queuedSpeed2Actions.length>0&&(ee.queuedActions=[...I.queuedSpeed2Actions,...ee.queuedActions||[]]),_(ee.phase)(ee)}else if(I.type==="resume_interrupted_turn"){let ee={...de};return ee._interruptedTurn=I.interruptedTurn,ee._interruptedPhase=I.interruptedPhase,I.queuedSpeed2Actions&&I.queuedSpeed2Actions.length>0&&(ee.queuedActions=[...I.queuedSpeed2Actions,...ee.queuedActions||[]]),br(ee)}else{const ee=Tl(de,W);return _(ee.phase)(ee)}}else{const de=Z;let Se=ae(Q,W,`${W==="player"?"Player":"Opponent"} chooses to rearrange ${de==="player"?"their own":"the opponent's"} protocols.`);return Se.actionRequired={type:"prompt_rearrange_protocols",sourceCardId:"CONTROL_MECHANIC",target:de,actor:W,originalAction:I},Se}})},[l,_]),K=re.useCallback(Z=>{h(Q=>{const I=_(Q.phase),W=Th(Q,Z);return W.actionRequired?W:I(W)})},[_]),U=re.useCallback(Z=>{h(Q=>{var I;return((I=Q.actionRequired)==null?void 0:I.type)!=="plague_2_player_discard"?Q:{...Q,animationState:{type:"discardCard",owner:"player",cardIds:Z,originalAction:Q.actionRequired}}})},[]),R=re.useCallback(Z=>{h(Q=>{const I=_(Q.phase),W=Dh(Q,Z,"player");return I(W)})},[_]),j=re.useCallback(Z=>{h(Q=>{const I=_(Q.phase),W=Nh(Q,Z);return Z?W:I(W)})},[_]),F=re.useCallback(Z=>{h(Q=>{const I=_(Q.phase),W=wd(Q,Z);return W.actionRequired?W:I(W)})},[_]),M=re.useCallback(Z=>{h(Q=>{var Y,de,ee;const I=((Y=Q.actionRequired)==null?void 0:Y.type)==="select_cards_from_hand_to_discard_for_fire_4",W=((de=Q.actionRequired)==null?void 0:de.type)==="discard"&&((ee=Q.actionRequired)==null?void 0:ee.variableCount);return!I&&!W?Q:{...Q,animationState:{type:"discardCard",owner:"player",cardIds:Z,originalAction:Q.actionRequired}}})},[]),L=re.useCallback(Z=>{h(Q=>{var I;return((I=Q.actionRequired)==null?void 0:I.type)!=="select_cards_from_hand_to_discard_for_hate_1"?Q:{...Q,animationState:{type:"discardCard",owner:"player",cardIds:Z,originalAction:Q.actionRequired}}})},[]),D=re.useCallback(Z=>{h(Q=>{const I=_(Q.phase),W=Cd(Q,Z);return W.actionRequired?W:I(W)})},[_]),O=re.useCallback(Z=>{h(Q=>{var Y,de;p&&((Y=Q.actionRequired)==null?void 0:Y.sourceCardId)==="CONTROL_MECHANIC"&&((de=Q.actionRequired)!=null&&de.actor)&&p(Q.actionRequired.actor);const I=_(Q.phase),W=fd(Q,Z,l);return W.winner?W:I(W)})},[_,l,p]),X=re.useCallback(Z=>{h(Q=>{const I=_(Q.phase),W=bd(Q,Z);return W.actionRequired?W:I(W)})},[_]),ne=re.useCallback(Z=>{h(Q=>{const I=_(Q.phase),W=Fh(Q,Z,l);return W.winner?W:I(W)})},[_,l]),z=re.useCallback(Z=>{h(Q=>{const I=_(Q.phase),W=tm(Q,Z);return W.winner?W:I(W)})},[_]),G=re.useCallback(Z=>{y.current=!1,w.current++,h(Q=>{if(typeof Z=="function")return Z(Q);const I=Z;if(I==="speed-0-interrupt"){const W=["Speed","Life","Water"],Y=["Metal","Death","Hate"];let de=yn(fa(W)),ee=yn(fa(Y));const ge=(Ce,Ie,ze)=>{const wt=Ce.findIndex(Qe=>Qe.protocol===Ie&&Qe.value===ze);return wt>-1?Ce.splice(wt,1)[0]:gn.find(Qe=>Qe.protocol===Ie&&Qe.value===ze)},Se=ge(de,"Speed",0),ye=ge(ee,"Metal",0),Ne=ge(de,"Speed",1),Le=ge(de,"Life",1),Je=ge(de,"Water",1),at=ge(de,"Speed",3);let we=Cl(W,Y,s,d);return we.player.lanes=[[],[],[]],we.player.lanes[0]=[{...Se,id:Be(),isFaceUp:!1}],we.player.hand=[{...Ne,id:Be(),isFaceUp:!0},{...Le,id:Be(),isFaceUp:!0},{...Je,id:Be(),isFaceUp:!0},{...at,id:Be(),isFaceUp:!0}],we.player.deck=de,we.player.discard=[],we.opponent.lanes=[[],[],[]],we.opponent.hand=[{...ye,id:Be(),isFaceUp:!0}],we.opponent.deck=ee,we.opponent.discard=[],we.turn="opponent",we.phase="start",we.actionRequired=null,we.queuedActions=[],we=_e(we),we=ae(we,"player","DEBUG: Dynamic Speed-0 interrupt scenario set up. AI will play Metal-0."),we}else if(I==="speed-1-trigger"){const W=["Speed","Life","Water"],Y=["Metal","Death","Hate"];let de=yn(fa(W));const ee=yn(fa(Y)),Se=((Je,at,we)=>{const Ce=Je.findIndex(Ie=>Ie.protocol===at&&Ie.value===we);return Ce>-1?Je.splice(Ce,1)[0]:gn.find(Ie=>Ie.protocol===at&&Ie.value===we)})(de,"Speed",1);let ye=Cl(W,Y,s,d);ye.player.lanes=[[],[],[]],ye.player.lanes[0]=[{...Se,id:Be(),isFaceUp:!0}];const{drawnCards:Ne,remainingDeck:Le}=Dn(de,[],6);return ye.player.hand=Ne.map(Je=>({...Je,id:Be(),isFaceUp:!0})),ye.player.deck=Le,ye.player.discard=[],ye.opponent.lanes=[[],[],[]],ye.opponent.hand=[],ye.opponent.deck=ee,ye.opponent.discard=[],ye.turn="player",ye.phase="hand_limit",ye.actionRequired={type:"discard",actor:"player",count:1},ye.queuedActions=[],ye=_e(ye),ye=ae(ye,"player","DEBUG: Speed-1 discard trigger scenario set up."),ye}else if(I==="fire-oncover-test"){const W=["Death","Hate","Water"],Y=["Fire","Plague","Metal"],de=yn(fa(W));let ee=yn(fa(Y));const ge=(Ce,Ie,ze)=>{const wt=Ce.findIndex(Qe=>Qe.protocol===Ie&&Qe.value===ze);return wt>-1?Ce.splice(wt,1)[0]:gn.find(Qe=>Qe.protocol===Ie&&Qe.value===ze)},Se=ge(ee,"Fire",0),ye=ge(ee,"Fire",2),Ne=ge(ee,"Fire",3),Le=gn.find(Ce=>Ce.protocol==="Death"&&Ce.value===1),Je=gn.find(Ce=>Ce.protocol==="Hate"&&Ce.value===2),at=gn.find(Ce=>Ce.protocol==="Water"&&Ce.value===3);let we=Cl(W,Y,s,"opponent");return we.player.lanes=[[{...Le,id:Be(),isFaceUp:!0}],[{...Je,id:Be(),isFaceUp:!0}],[{...at,id:Be(),isFaceUp:!0}]],we.player.hand=[],we.player.deck=de,we.player.discard=[],we.opponent.lanes=[[{...Se,id:Be(),isFaceUp:!0}],[],[]],we.opponent.hand=[{...Ne,id:Be(),isFaceUp:!0},{...ye,id:Be(),isFaceUp:!0}],we.opponent.deck=ee,we.opponent.discard=[],we.turn="opponent",we.phase="action",we.actionRequired=null,we.queuedActions=[],we=_e(we),we=ae(we,"opponent","DEBUG: Fire On-Cover test scenario. Opponent has Fire-0 in play, Fire-3 and Fire-2 in hand. Ready to play Fire-3."),we}else if(I==="speed-2-control-test"){const W=["Speed","Light","Water"],Y=["Fire","Plague","Metal"],de=yn(fa(W)),ee=yn(fa(Y)),Se=((Ne,Le,Je)=>{const at=Ne.findIndex(we=>we.protocol===Le&&we.value===Je);return at>-1?Ne.splice(at,1)[0]:gn.find(we=>we.protocol===Le&&we.value===Je)})(de,"Speed",2);let ye=Cl(W,Y,!0,"player");return ye.player.lanes=[[{...Se,id:Be(),isFaceUp:!0}],[],[]],ye.player.protocols[0]="Speed",ye.player.laneValues[0]=10,ye.player.hand=[],ye.player.deck=de,ye.player.discard=[],ye.controlCardHolder="player",ye.opponent.lanes=[[],[],[]],ye.opponent.hand=[],ye.opponent.deck=ee,ye.opponent.discard=[],ye.turn="player",ye.phase="compile",ye.compilableLanes=[0],ye.actionRequired=null,ye.queuedActions=[],ye=_e(ye),ye=ae(ye,"player","DEBUG: Speed-2 + Control test scenario. Player has Speed-2 (value 10), Control Component active. Ready to compile Protocol Speed!"),ye}return Q})},[s]);return re.useEffect(()=>{const Z=f.animationState;if(!Z)return;let Q=0,I=!1;if(Z.type==="flipCard"?(Q=600,I=!0):Z.type==="drawCard"?(Q=1e3,I=!0):Z.type==="discardCard"&&(Q=800,I=!0),I){const W=setTimeout(()=>{h(Y=>({...Y,animationState:null}))},Q);return()=>clearTimeout(W)}},[f.animationState]),re.useEffect(()=>{const Z=f.animationState;if((Z==null?void 0:Z.type)==="discardCard"&&Z.owner==="player"){const Q=setTimeout(()=>{h(I=>{const W=I.animationState;if((W==null?void 0:W.type)!=="discardCard"||!W.originalAction)return I;const{cardIds:Y,originalAction:de}=W,ee=_(I.phase);let ge;return de.type==="plague_2_player_discard"?ge=W_(I,Y):de.type==="select_cards_from_hand_to_discard_for_fire_4"?ge=Eh(I,Y):de.type==="select_cards_from_hand_to_discard_for_hate_1"?ge=pd(I,Y):ge=Ao(I,Y,"player"),ge.animationState=null,ge.actionRequired?ge:ee(ge)})},500);return()=>clearTimeout(Q)}},[f.animationState,_]),re.useEffect(()=>{if(f.turn==="opponent"&&!f.winner&&!f.animationState&&!f._interruptedTurn&&!y.current){y.current=!0;const Z=w.current,Q=f,I=setTimeout(()=>{w.current===Z&&an(Q,h,c,{compileLane:(W,Y)=>kl(W,Y,l),playCard:Yi,fillHand:Tl,discardCards:Ao,flipCard:Rh,deleteCard:(W,Y)=>({newState:W,animationRequests:[{type:"delete",cardId:Y,owner:"opponent"}]}),returnCard:Ah,skipAction:jh,resolveOptionalDrawPrompt:Th,resolvePlague4Flip:(W,Y)=>Dh(W,Y,"opponent"),resolvePlague2Discard:ud,resolvePlague2OpponentDiscard:ud,resolveOptionalDiscardCustomPrompt:Nh,resolveOptionalEffectPrompt:wd,resolveFire4Discard:Eh,resolveHate1Discard:pd,resolveRearrangeProtocols:(W,Y)=>fd(W,Y,l),resolveActionWithHandCard:hd,resolveSwapProtocols:(W,Y)=>Fh(W,Y,l),revealOpponentHand:kh,resolveCustomChoice:bd},b,xh,p)},1500);return()=>{clearTimeout(I),y.current=!1}}},[f.turn,f.phase,f.winner,f.animationState,f._interruptedTurn,c,l,b,f.actionRequired]),re.useEffect(()=>{const Z=f.actionRequired,Q=f.turn==="player"||f._interruptedTurn==="player",I=Z&&"actor"in Z&&Z.actor==="opponent";Q&&!f.animationState&&I&&!y.current&&(y.current=!0,o0(f,h,c,{playCard:Yi,discardCards:Ao,flipCard:Rh,returnCard:Ah,deleteCard:(Y,de)=>({newState:Y,animationRequests:[{type:"delete",cardId:de,owner:"opponent"}]}),resolveActionWithHandCard:hd,resolveHate1Discard:pd,resolvePlague2OpponentDiscard:ud,revealOpponentHand:kh,resolveRearrangeProtocols:(Y,de)=>fd(Y,de,l)},xh,b,_d,xd,p),y.current=!1)},[f.actionRequired,f.turn,f.animationState,c,b,l]),re.useEffect(()=>{h(Z=>{let Q=_e(Z);return Q.turn==="player"&&Q.phase==="start"&&!Q.actionRequired?Gh(Q):Q})},[f.turn,f.phase]),{gameState:f,selectedCard:m,setSelectedCard:g,playSelectedCard:k,fillHand:S,discardCardFromHand:$,compileLane:E,resolveActionWithCard:C,resolveActionWithLane:N,selectHandCardForAction:H,skipAction:q,resolvePlague2Discard:U,resolveActionWithHandCard:T,resolvePlague4Flip:R,resolveOptionalDiscardCustomPrompt:j,resolveOptionalEffectPrompt:F,resolveFire4Discard:M,resolveHate1Discard:L,resolveRevealBoardCardPrompt:D,resolveRearrangeProtocols:O,resolveOptionalDrawPrompt:K,resolveSwapProtocols:ne,resolveControlMechanicPrompt:B,resolveCustomChoice:X,resolveSelectRevealedDeckCard:z,setupTestScenario:G}},Oh=({cards:a,isPlayable:n,isCompilable:l,isShiftTarget:c,isEffectTarget:s,isMatching:d,onLanePointerDown:p,onPlayFaceDown:f,onCardPointerDown:h,onCardPointerEnter:m,onCardPointerLeave:g,owner:y,animationState:w,isCardTargetable:_,laneIndex:b,sourceCardId:k,gameState:S})=>{const $=["lane"];return n&&$.push("playable"),d&&$.push("matching-protocol"),l&&$.push("compilable"),c&&$.push("shift-target"),s&&$.push("effect-target"),r.jsxs("div",{className:$.join(" "),onPointerDown:p,children:[n&&d&&y==="player"&&f&&r.jsx("button",{className:"btn btn-play-facedown",onPointerDown:E=>{E.stopPropagation(),f()},children:"Play Face-Down"}),r.jsx("div",{className:"lane-stack",children:a.map((E,C)=>{var H;const N=((H=S.actionRequired)==null?void 0:H.type)==="prompt_shift_or_flip_for_light_2"&&S.actionRequired.revealedCardId===E.id,T=Pn(E,a,S,b,y);return r.jsx(vt,{card:E,isFaceUp:E.isFaceUp||N,style:{"--i":C},onPointerDown:q=>{q.stopPropagation(),h(E)},onPointerEnter:()=>m(E),animationState:w,isTargetable:_(E),isSourceOfEffect:E.id===k,faceDownValue:T},E.id)})})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Ga=(a,n)=>Za(a,n),Tn=(a,n)=>on(a).some(({rule:c,laneIndex:s})=>c.type==="block_shifts_from_and_to_lane"&&s===n),Xi=(a,n)=>{const{actionRequired:l}=n;if(!l||"actor"in l&&l.actor!=="player")return!1;let c=null,s=-1,d=[];for(const h of["player","opponent"]){for(let m=0;m<n[h].lanes.length;m++)if(n[h].lanes[m].some(g=>g.id===a.id)){c=h,s=m,d=n[h].lanes[m];break}if(c)break}if(!c)return!1;const p=d.findIndex(h=>h.id===a.id),f=Ka(n,d,p);if(l.type==="select_lane_for_shift"){const h=l.cardToShiftId;return!!(h&&a.id===h)}if(l.type==="shift_flipped_card_optional"){const h=l.cardId;return!!(h&&a.id===h)}switch(l.type){case"select_opponent_face_up_card_to_flip":return c==="opponent"&&a.isFaceUp&&f;case"select_card_to_flip":{if(Ga(n,a.id))return!1;const h=l.targetFilter||{},m=d.findIndex(k=>k.id===a.id),g=l.currentLaneIndex,y=l.laneIndex,w=l.scope;if(g!==void 0&&s!==g||w==="this_lane"&&y!==void 0&&s!==y)return!1;const _=h.position||"uncovered";return!(_==="uncovered"&&!f||_==="covered"&&m>=d.length-1||h.owner==="own"&&c!==l.actor||h.owner==="opponent"&&c===l.actor||h.faceState==="face_up"&&!a.isFaceUp||h.faceState==="face_down"&&a.isFaceUp||h.excludeSelf&&a.id===l.sourceCardId||!jl(n,a.id).allowed)}case"select_own_face_up_covered_card_to_flip":{const h=d.findIndex(m=>m.id===a.id);return c==="player"&&a.isFaceUp&&h<d.length-1}case"select_opponent_covered_card_to_shift":{const h=d.findIndex(g=>g.id===a.id),m=n.turn==="player"?"opponent":"player";return Tn(n,s)?!1:c===m&&h<d.length-1}case"select_own_covered_card_to_shift":{const h=d.findIndex(m=>m.id===a.id);return Tn(n,s)?!1:c===l.actor&&h<d.length-1}case"select_covered_card_in_line_to_flip_optional":{const m=d.findIndex(y=>y.id===a.id)<d.length-1;return Qn(n)&&!a.isFaceUp?!1:s===l.laneIndex&&m}case"select_covered_card_to_flip_for_chaos_0":{const m=d.findIndex(y=>y.id===a.id)<d.length-1;return Qn(n)&&!a.isFaceUp?!1:s===l.laneIndex&&m}case"shift_flipped_card_optional":return Tn(n,s)?!1:a.id===l.cardId;case"select_opponent_card_to_flip":return Qn(n)&&!a.isFaceUp?!1:c==="opponent"&&f;case"select_face_down_card_to_shift_for_darkness_4":return Tn(n,s)?!1:!a.isFaceUp&&f;case"select_cards_to_delete":{if(Ga(n,a.id)||l.disallowedIds.includes(a.id))return!1;const h=l.allowedIds;if(h&&!h.includes(a.id))return!1;const m=l.currentLaneIndex;if(m!==void 0&&s!==m)return!1;const g=l.targetFilter;if(g){const y=d.findIndex($=>$.id===a.id),w=g.position||"uncovered";if(w==="uncovered"&&!f||w==="covered"&&y>=d.length-1||g.faceState==="face_up"&&!a.isFaceUp||g.faceState==="face_down"&&a.isFaceUp)return!1;if(g.valueRange){const{min:$,max:E}=g.valueRange;if(a.value<$||a.value>E)return!1}const _=l.actorChooses,b=l.sourceCardId;let k=null;for(const $ of["player","opponent"])if(n[$].lanes.flat().some(E=>E.id===b)){k=$;break}if(_==="card_owner"&&k){if(g.owner==="own"&&c!==k||g.owner==="opponent"&&c===k)return!1}else if(g.owner==="own"&&c!==l.actor||g.owner==="opponent"&&c===l.actor)return!1;const S=l.protocolMatching;if(S){const $=n.player.protocols[s],E=n.opponent.protocols[s],C=a.protocol,N=C===$||C===E;if(S==="must_match"&&!N||S==="must_not_match"&&N)return!1}return!0}return f}case"select_face_down_card_to_delete":return!a.isFaceUp&&f;case"select_low_value_card_to_delete":return a.isFaceUp&&(a.value===0||a.value===1)&&f;case"select_card_from_other_lanes_to_delete":{if(Ga(n,a.id))return!1;const{disallowedLaneIndex:h,lanesSelected:m}=l;return s!==h&&!m.includes(s)&&f}case"plague_4_opponent_delete":return(n.turn==="player"?"opponent":"player")==="player"?c==="player"&&!a.isFaceUp&&f:!1;case"select_any_other_card_to_flip":return Qn(n)&&!a.isFaceUp?!1:a.id!==l.sourceCardId&&f;case"select_card_to_return":{if(Ga(n,a.id))return!1;const h=l.targetOwner||"any",m=l.targetFilter,g=l.actor,y=(m==null?void 0:m.position)||"uncovered",_=d.findIndex(b=>b.id===a.id)<d.length-1;return y==="uncovered"&&!f||y==="covered"&&!_?!1:h==="own"?c===g:h==="opponent"?c!==g:!0}case"select_card_to_shift_for_gravity_1":return Ga(n,a.id)||Tn(n,s)?!1:f;case"select_face_down_card_to_shift_for_gravity_4":return Tn(n,s)?!1:!a.isFaceUp&&s!==l.targetLaneIndex&&f;case"select_any_card_to_flip":case"select_any_card_to_flip_optional":return Qn(n)&&!a.isFaceUp||!jl(n,a.id).allowed?!1:f;case"select_any_face_down_card_to_flip_optional":return jl(n,a.id).allowed?!a.isFaceUp&&f:!1;case"select_board_card_to_reveal_custom":{const h=l.targetFilter;if(!h)return!a.isFaceUp&&f;const m=d.findIndex(y=>y.id===a.id),g=h.position||"uncovered";return!(g==="uncovered"&&!f||g==="covered"&&m>=d.length-1||h.owner==="own"&&c!==l.actor||h.owner==="opponent"&&c===l.actor||h.faceState==="face_up"&&!a.isFaceUp||h.faceState==="face_down"&&a.isFaceUp)}case"select_own_other_card_to_shift":return Tn(n,s)?!1:c===l.actor&&a.id!==l.sourceCardId&&f;case"select_opponent_face_down_card_to_shift":return Tn(n,s)?!1:c!==l.actor&&!a.isFaceUp&&f;case"select_any_opponent_card_to_shift":return Tn(n,s)?!1:c!==l.actor&&f;case"select_opponent_card_to_return":return c==="opponent"&&f;case"select_card_to_shift_for_anarchy_1":return Ga(n,a.id)||Tn(n,s)?!1:f;case"select_card_to_shift_for_anarchy_0":return Ga(n,a.id)||Tn(n,s)?!1:f;case"select_card_to_shift":{if(Ga(n,a.id)||Tn(n,s))return!1;const h=l.targetFilter||{},m=l.destinationRestriction,g=l.scope,y=l.sourceLaneIndex;if(g==="this_lane"&&y!==void 0&&s!==y||(m==null?void 0:m.type)==="non_matching_protocol"&&!a.isFaceUp)return!1;const w=h.position||"uncovered",b=d.findIndex(k=>k.id===a.id)<d.length-1;return!(w==="uncovered"&&!f||w==="covered"&&!b||h.owner==="own"&&c!==l.actor||h.owner==="opponent"&&c===l.actor||h.faceState==="face_up"&&!a.isFaceUp||h.faceState==="face_down"&&a.isFaceUp||h.excludeSelf&&a.id===l.sourceCardId)}case"select_phase_effect":return l.availableEffects.some(m=>m.cardId===a.id);default:return!1}},c0=({gameState:a,onLanePointerDown:n,onPlayFaceDown:l,onCardPointerDown:c,onCardPointerEnter:s,onCardPointerLeave:d,onOpponentHandCardPointerEnter:p,onOpponentHandCardPointerLeave:f,selectedCardId:h,sourceCardId:m})=>{const{player:g,opponent:y,animationState:w,phase:_,turn:b,compilableLanes:k,actionRequired:S,controlCardHolder:$}=a,E=U=>{const R=_==="compile"&&b==="player"&&!S&&k.includes(U),j=b==="player",F=_==="action"&&!S&&h,M=(S==null?void 0:S.type)==="select_lane_for_play";if(!(M?(S==null?void 0:S.actor)==="player":j)||!F&&!M)return{isPlayable:!1,isMatching:!1,isCompilable:R};let D;if(F)D=g.hand.find(ee=>ee.id===h);else if(M){if(S.disallowedLaneIndex!==void 0&&U===S.disallowedLaneIndex)return{isPlayable:!1,isMatching:!1,isCompilable:R};const ee=S.validLanes;if(ee&&!ee.includes(U))return{isPlayable:!1,isMatching:!1,isCompilable:R};if(S.source==="deck")return S.excludeCurrentLane&&U===S.currentLaneIndex?{isPlayable:!1,isMatching:!1,isCompilable:R}:{isPlayable:!0,isMatching:!1,isCompilable:R};D=g.hand.find(ge=>ge.id===S.cardInHandId)}if(!D)return{isPlayable:!1,isMatching:!1,isCompilable:R};const O=y.lanes[U];if(O.length>0&&O[O.length-1].isFaceUp&&O[O.length-1].protocol==="Plague"&&O[O.length-1].value===0)return{isPlayable:!1,isMatching:!1,isCompilable:R};const ne=y.lanes.flat().some(ee=>ee.isFaceUp&&ee.protocol==="Psychic"&&ee.value===1),z=g.lanes.flat().some(ee=>ee.isFaceUp&&ee.protocol==="Spirit"&&ee.value===1),G=g.lanes.some(ee=>{if(ee.length===0)return!1;const ge=ee[ee.length-1];return ge.isFaceUp&&ge.protocol==="Chaos"&&ge.value===3}),Z=[...g.lanes.flat(),...y.lanes.flat()].some(ee=>ee.isFaceUp&&ee.protocol==="Anarchy"&&ee.value===1),Q=Ki(a),I=Ji(a,"player",U),W=Rl(a,D);let Y;return W?Y=!ne:Z||Q?Y=D.protocol!==g.protocols[U]&&D.protocol!==y.protocols[U]&&!ne:Y=(z||I||G||D.protocol===g.protocols[U]||D.protocol===y.protocols[U])&&!ne,O.some(ee=>ee.isFaceUp&&ee.protocol==="Metal"&&ee.value===2)&&!Y?{isPlayable:!1,isMatching:!1,isCompilable:R}:M&&(S.isFaceDown||S.faceDown)?{isPlayable:!0,isMatching:!1,isCompilable:R}:{isPlayable:!0,isMatching:Y,isCompilable:R}},C=U=>{if(!(b==="player")||!(_==="action"&&!S&&h))return{isPlayable:!1,isMatching:!1};const F=g.hand.find(D=>D.id===h);if(!F)return{isPlayable:!1,isMatching:!1};if(!Rl(a,F))return{isPlayable:!1,isMatching:!1};const M=g.lanes[U];return M.length>0&&M[M.length-1].isFaceUp&&M[M.length-1].protocol==="Plague"&&M[M.length-1].value===0?{isPlayable:!1,isMatching:!1}:{isPlayable:!0,isMatching:!0}},N=U=>{if(!S||S.actor!=="player")return!1;switch(S.type){case"select_lane_for_delete":{const R=S.validLanes;return!(R&&!R.includes(U))}case"select_lane_for_death_2":case"select_lane_for_water_3":case"select_lane_for_return":return!0;case"select_lane_for_metal_3_delete":return U===S.disallowedLaneIndex?!1:g.lanes[U].length+y.lanes[U].length>=8;case"select_lane_for_delete_all":return(S.validLanes||[]).includes(U);default:return!1}},T=(U,R)=>{if(!S||S.actor!=="player")return!1;const j=S.type==="select_lane_for_shift"?S.originalLaneIndex:(S.type==="select_card_to_shift",-1);if(j!==-1&&!Al(a,j,U).allowed)return!1;switch(S.type){case"select_lane_for_shift":{if(R!==S.cardOwner||U===S.originalLaneIndex)return!1;const F=S.validLanes;if(F&&!F.includes(U))return!1;const M=[...a.player.lanes.flat(),...a.opponent.lanes.flat()].find(D=>D.id===S.sourceCardId),L=S.destinationRestriction;if(L&&L.type==="to_or_from_this_lane"){let D=L.laneIndex;if(L.laneIndex==="current"&&M)for(const O of["player","opponent"]){for(let X=0;X<a[O].lanes.length;X++)if(a[O].lanes[X].some(ne=>ne.id===S.sourceCardId)){D=X;break}if(typeof D=="number")break}if(typeof D=="number"&&!(S.originalLaneIndex===D)&&!(U===D))return!1}else if(M&&M.protocol==="Gravity"&&M.value===1){let D=-1;for(const O of["player","opponent"]){for(let X=0;X<a[O].lanes.length;X++)if(a[O].lanes[X].some(ne=>ne.id===S.sourceCardId)){D=X;break}if(D!==-1)break}if(D!==-1&&!(S.originalLaneIndex===D)&&!(U===D))return!1}return!0}case"shift_flipped_card_optional":{const F=S.cardId;let M=null,L=-1;for(let D=0;D<g.lanes.length;D++)if(g.lanes[D].some(O=>O.id===F)){M="player",L=D;break}if(M===null){for(let D=0;D<y.lanes.length;D++)if(y.lanes[D].some(O=>O.id===F)){M="opponent",L=D;break}}return R!==M?!1:U!==L}case"select_lane_for_life_3_play":return R==="player"&&U!==S.disallowedLaneIndex;case"select_lane_to_shift_revealed_card_for_light_2":return R==="player";case"select_lane_to_shift_revealed_board_card_custom":{const F=S.revealedCardId;if(![...a.player.lanes.flat(),...a.opponent.lanes.flat()].find(O=>O.id===F))return!1;let L=null,D=-1;for(const O of["player","opponent"]){for(let X=0;X<a[O].lanes.length;X++)if(a[O].lanes[X].some(ne=>ne.id===F)){L=O,D=X;break}if(L)break}return R===L&&U!==D}case"select_lane_for_shift_all":{const F=S.sourceLaneIndex;return U!==F}case"select_lane_to_shift_cards_for_light_3":return U!==S.sourceLaneIndex;default:return!1}},H=(U,R,j)=>{let F=[U];return R&&F.push("compiled"),(w==null?void 0:w.type)==="compile"&&w.laneIndex===j&&F.push("is-compiling"),F.join(" ")},q=()=>$==="player"?"player-controlled":$==="opponent"?"opponent-controlled":"neutral",B=()=>$==="player"?"Player has control.":$==="opponent"?"Opponent has control.":"Control is neutral.",K=()=>$==="player"?"Control Player":$==="opponent"?"Control Opponent":"Control Neutral";return r.jsxs("div",{className:"game-board",children:[r.jsx("div",{className:"opponent-hand-area",children:y.hand.map(U=>r.jsx(vt,{card:U,isFaceUp:U.isRevealed||!1,additionalClassName:"in-hand",onPointerEnter:()=>p(U)},U.id))}),r.jsx("div",{className:`player-side opponent-side ${b==="opponent"?"active-turn":""}`,children:r.jsx("div",{className:"lanes",children:y.lanes.map((U,R)=>{const{isPlayable:j,isMatching:F}=C(R);return r.jsx(Oh,{cards:U,isPlayable:j,isMatching:F,isCompilable:!1,isShiftTarget:T(R,"opponent"),isEffectTarget:N(R),onLanePointerDown:()=>n(R,"opponent"),onCardPointerDown:M=>c(M,"opponent",R),onCardPointerEnter:M=>s(M,"opponent"),onCardPointerLeave:()=>d(),owner:"opponent",animationState:w,isCardTargetable:M=>Xi(M,a),laneIndex:R,sourceCardId:m,gameState:a},`opp-lane-${R}`)})})}),r.jsxs("div",{className:"protocol-bars-container",children:[a.useControlMechanic&&r.jsxs("div",{className:"control-coin-container",children:[r.jsx("div",{className:`control-coin ${q()}`,title:B(),children:"C"}),r.jsx("div",{className:`control-coin-label ${q()}`,children:K()})]}),r.jsx("div",{className:`protocol-bar opponent-bar ${b==="opponent"?"active-turn":""}`,children:y.protocols.map((U,R)=>r.jsxs("div",{className:H("protocol-display",y.compiled[R],R),children:[r.jsx("span",{className:"protocol-name",children:U}),r.jsx("span",{className:"protocol-value",children:y.laneValues[R]})]},`opp-proto-${U}-${R}`))}),r.jsx("div",{className:`protocol-bar player-bar ${b==="player"?"active-turn":""}`,children:g.protocols.map((U,R)=>r.jsxs("div",{className:H("protocol-display",g.compiled[R],R),children:[r.jsx("span",{className:"protocol-name",children:U}),r.jsx("span",{className:"protocol-value",children:g.laneValues[R]})]},`player-proto-${U}-${R}`))})]}),r.jsx("div",{className:`player-side ${b==="player"?"active-turn":""}`,children:r.jsx("div",{className:"lanes",children:g.lanes.map((U,R)=>{const{isPlayable:j,isMatching:F,isCompilable:M}=E(R);return r.jsx(Oh,{cards:U,isPlayable:j,isMatching:F,isCompilable:M,isShiftTarget:T(R,"player"),isEffectTarget:N(R),onLanePointerDown:()=>n(R,"player"),onPlayFaceDown:()=>l(R),onCardPointerDown:L=>c(L,"player",R),onCardPointerEnter:L=>s(L,"player"),onCardPointerLeave:()=>d(),owner:"player",animationState:w,isCardTargetable:L=>Xi(L,a),laneIndex:R,sourceCardId:m,gameState:a},`player-lane-${R}`)})})})]})},s0=({gameState:a,onFillHand:n,onSkipAction:l,onResolvePlague2Discard:c,onResolvePlague4Flip:s,onResolveFire3Prompt:d,onResolveOptionalDiscardCustomPrompt:p,onResolveOptionalEffectPrompt:f,onResolveFire4Discard:h,onResolveHate1Discard:m,onResolveRevealBoardCardPrompt:g,onResolveOptionalDrawPrompt:y,onResolveDeath1Prompt:w,onResolveLove1Prompt:_,onResolvePsychic4Prompt:b,onResolveSpirit1Prompt:k,onResolveControlMechanicPrompt:S,onResolveCustomChoice:$,selectedCardId:E,multiSelectedCardIds:C,actionRequiredClass:N})=>{const{phase:T,turn:H,actionRequired:q,player:B,compilableLanes:K}=a,U=O=>{for(const X of["player","opponent"])for(const ne of a[X].lanes){const z=ne.find(G=>G.id===O);if(z)return z}return null},R=q==null?void 0:q.sourceCardId,j=R?U(R):null,F=(q==null?void 0:q.actor)||H,M=F.charAt(0).toUpperCase()+F.slice(1),L=()=>{var O,X,ne,z;if(H!=="player"&&(!q||q.actor!=="player"))return r.jsx("button",{className:"btn",disabled:!0,children:"Processing..."});if((q==null?void 0:q.type)==="prompt_use_control_mechanic")return r.jsxs(r.Fragment,{children:[r.jsx("button",{className:"btn",onClick:()=>S("player"),children:"Rearrange Own"}),r.jsx("button",{className:"btn",onClick:()=>S("opponent"),children:"Rearrange Opponent's"}),r.jsx("button",{className:"btn btn-back",onClick:()=>S("skip"),children:"Skip"})]});if((q==null?void 0:q.type)==="prompt_optional_draw")return r.jsxs(r.Fragment,{children:[r.jsx("button",{className:"btn",onClick:()=>y(!0),children:"Draw"}),r.jsx("button",{className:"btn btn-back",onClick:()=>y(!1),children:"Skip"})]});if((q==null?void 0:q.type)==="prompt_death_1_effect")return r.jsxs(r.Fragment,{children:[r.jsx("button",{className:"btn",onClick:()=>w(!0),children:"Draw & Delete"}),r.jsx("button",{className:"btn btn-back",onClick:()=>w(!1),children:"Skip"})]});if((q==null?void 0:q.type)==="prompt_give_card_for_love_1")return r.jsxs(r.Fragment,{children:[r.jsx("button",{className:"btn",onClick:()=>_(!0),children:"Give 1 Card"}),r.jsx("button",{className:"btn btn-back",onClick:()=>_(!1),children:"Skip"})]});if((q==null?void 0:q.type)==="prompt_fire_3_discard")return r.jsxs(r.Fragment,{children:[r.jsx("button",{className:"btn",onClick:()=>d(!0),children:"Discard 1 Card"}),r.jsx("button",{className:"btn btn-back",onClick:()=>d(!1),children:"Skip"})]});if((q==null?void 0:q.type)==="prompt_optional_discard_custom")return r.jsxs(r.Fragment,{children:[r.jsxs("button",{className:"btn",onClick:()=>p(!0),children:["Discard ",q.count," Card(s)"]}),r.jsx("button",{className:"btn btn-back",onClick:()=>p(!1),children:"Skip"})]});if((q==null?void 0:q.type)==="prompt_optional_effect"){const G=((X=(O=q.effectDef)==null?void 0:O.params)==null?void 0:X.action)||"effect",Z=(z=(ne=q.effectDef)==null?void 0:ne.params)==null?void 0:z.count,Q=Z?`${G} ${Z}`:G;return r.jsxs(r.Fragment,{children:[r.jsxs("button",{className:"btn",onClick:()=>f(!0),children:["Execute (",Q,")"]}),r.jsx("button",{className:"btn btn-back",onClick:()=>f(!1),children:"Skip"})]})}if((q==null?void 0:q.type)==="prompt_spirit_1_start")return r.jsxs(r.Fragment,{children:[r.jsx("button",{className:"btn",onClick:()=>k("discard"),children:"Discard 1"}),r.jsx("button",{className:"btn btn-back",onClick:()=>k("flip"),children:"Flip Card"})]});if((q==null?void 0:q.type)==="custom_choice"){const G=q.options||[];if(G.length===2){const Z=G[0].params,Q=G[1].params,I=W=>W.action==="discard"?`Discard ${W.count||1}`:W.action==="flip"&&W.flipSelf?"Flip This Card":W.action==="draw"?`Draw ${W.count||1}`:W.action==="delete"&&W.deleteSelf?"Delete This Card":W.action==="delete"?`Delete ${W.count||1}`:W.action==="return"?`Return ${W.count||1}`:W.action==="shift"?"Shift":W.action||"Option";return r.jsxs(r.Fragment,{children:[r.jsx("button",{className:"btn",onClick:()=>$(0),children:I(Z)}),r.jsx("button",{className:"btn btn-back",onClick:()=>$(1),children:I(Q)})]})}}if((q==null?void 0:q.type)==="prompt_return_for_psychic_4")return r.jsxs(r.Fragment,{children:[r.jsx("button",{className:"btn",onClick:()=>b(!0),children:"Return Card"}),r.jsx("button",{className:"btn btn-back",onClick:()=>b(!1),children:"Skip"})]});if((q==null?void 0:q.type)==="prompt_shift_or_flip_board_card_custom")return r.jsxs(r.Fragment,{children:[r.jsx("button",{className:"btn",onClick:()=>g("shift"),children:"Shift"}),r.jsx("button",{className:"btn",onClick:()=>g("flip"),children:"Flip"}),r.jsx("button",{className:"btn btn-back",onClick:()=>g("skip"),children:"Skip"})]});if((q==null?void 0:q.type)==="discard"&&q.variableCount&&q.actor==="player")return r.jsxs("button",{className:"btn",onClick:()=>h(C),disabled:C.length<1,children:["Confirm Discard (",C.length,")"]});if((q==null?void 0:q.type)==="plague_2_player_discard"||(q==null?void 0:q.type)==="select_cards_from_hand_to_discard_for_fire_4"||(q==null?void 0:q.type)==="select_cards_from_hand_to_discard_for_hate_1"){let G,Z=0;return q.type==="plague_2_player_discard"?(G=c,Z=1):q.type==="select_cards_from_hand_to_discard_for_fire_4"?(G=h,Z=1):(G=m,Z=q.count),r.jsxs("button",{className:"btn",onClick:()=>G(C),disabled:C.length<Z,children:["Confirm Discard (",C.length,")"]})}if((q==null?void 0:q.type)==="plague_4_player_flip_optional")return r.jsxs(r.Fragment,{children:[r.jsx("button",{className:"btn",onClick:()=>s(!0),children:"Flip Plague-4"}),r.jsx("button",{className:"btn btn-back",onClick:()=>s(!1),children:"Skip"})]});if(q&&"optional"in q&&q.optional)return r.jsx("button",{className:"btn btn-back",onClick:l,children:"Skip Action"});if(q)return r.jsx("button",{className:"btn",disabled:!0,children:"Action Required"});if(T==="compile"&&K.length>0)return r.jsx("button",{className:"btn",disabled:!0,children:"Select Lane to Compile"});if(T==="action"){const G=B.hand.length<5,Z=B.hand.length===0,Q=kd(a,"player"),I=G&&Q.allowed;return Z?r.jsx("button",{className:"btn",onClick:n,disabled:!Q.allowed,title:Q.allowed?void 0:Q.reason,children:"Refresh (Required)"}):r.jsx("button",{className:"btn",onClick:n,disabled:!I||!!E,title:Q.allowed?void 0:Q.reason,children:"Refresh"})}return r.jsx("button",{className:"btn",disabled:!0,children:"Processing..."})},D=()=>{var O,X,ne,z;if(q)switch(q.type){case"discard":return q.actor==="player"?q.variableCount?"Action: Select 1 or more cards to discard":`Action: Discard ${q.count} card(s) from your hand`:"Waiting for Opponent to discard...";case"prompt_use_control_mechanic":return"Control Action: Rearrange protocols?";case"select_opponent_face_up_card_to_flip":return"Action: Select an opponent's face-up card to flip";case"select_own_face_up_covered_card_to_flip":return"Action: Select one of your face-up, covered cards to flip";case"select_opponent_covered_card_to_shift":return"Action: Select one of your opponent's covered cards to shift";case"select_own_covered_card_to_shift":return"Action: Select one of your covered cards to shift";case"select_lane_for_shift":return"Action: Select a new lane for the card";case"select_lane_for_shift_all":return"Action: Select a lane to shift all cards to";case"select_opponent_card_to_flip":return"Action: Select an opponent's card to flip";case"select_card_to_flip":{const G=q.targetFilter||{},Z=G.owner||"any",Q=G.faceState||"any",I=G.position||"uncovered";let W="Action: Flip ";return Z==="own"?W+="one of your ":Z==="opponent"?W+="an opponent's ":W+="a ",Q==="face_down"?W+="face-down ":Q==="face_up"&&(W+="face-up "),I==="covered"?W+="covered ":I==="uncovered"&&(W+="uncovered "),W+="card",W}case"shift_flipped_card_optional":return"Action: You may shift the card you just flipped. Select a lane or skip.";case"select_covered_card_in_line_to_flip_optional":return"Action: You may flip one of your covered cards in this lane. Select a card or skip.";case"select_card_from_hand_to_play":{const G=q.valueFilter;return G!==void 0?`Action: Select a card with value ${G} from your hand to play`:"Action: Select a card from your hand to play"}case"select_lane_for_play":return"Action: Select another lane to play your card in";case"select_face_down_card_to_shift_for_darkness_4":return"Action: Select any face-down card to shift";case"select_cards_to_delete":return`Action: Select a card to delete (${q.count} remaining)`;case"select_face_down_card_to_delete":return"Action: Select a face-down card to delete";case"select_low_value_card_to_delete":return"Action: Select a card with value 0 or 1 to delete";case"select_card_from_other_lanes_to_delete":return`Action: Select a card to delete (${q.count} remaining)`;case"select_lane_for_death_2":return"Action: Select a lane to delete cards with value 1 or 2";case"select_lane_for_delete":return"Action: Select a lane";case"prompt_optional_draw":return"Optional: Draw card(s)?";case"prompt_death_1_effect":return"Start Phase: Use Death-1 effect?";case"select_card_to_delete_for_death_1":return"Action: Select a card to delete";case"delete_self":return"Deleting card...";case"prompt_give_card_for_love_1":return"End Phase: Give 1 card to draw 2?";case"select_card_from_hand_to_give":return"Action: Select a card from your hand to give";case"select_card_from_hand_to_reveal":return"Action: Select a card from your hand to reveal";case"plague_2_player_discard":return"Action: Select 1 or more cards to discard";case"plague_4_opponent_delete":return"Waiting for opponent to delete one of their face-down cards";case"plague_4_player_flip_optional":return"Action: You may flip Plague-4";case"select_any_other_card_to_flip":return"Action: Select any other card to flip";case"select_card_to_return":{const G=q.targetFilter||{},Z=q.targetOwner||G.owner||"any",Q=G.position||"uncovered";let I="Action: Select ";return Z==="own"?I+="one of your ":Z==="opponent"?I+="an opponent's ":I+="a ",Q==="any"?I+="covered or uncovered ":Q==="covered"&&(I+="covered "),I+="card to return",I}case"select_covered_card_to_flip_for_chaos_0":return"Action: Select a covered card to flip in this lane";case"prompt_fire_3_discard":return"End Phase: Discard 1 card to flip 1 card?";case"prompt_optional_discard_custom":return`Optional: Discard ${q.count} card(s) to continue?`;case"prompt_optional_effect":{const G=((X=(O=q.effectDef)==null?void 0:O.params)==null?void 0:X.action)||"effect",Z=(z=(ne=q.effectDef)==null?void 0:ne.params)==null?void 0:z.count;return`Do you want to ${G==="shift"?"shift a card":G==="flip"?"flip a card":G==="draw"?`draw ${Z||1} card(s)`:G==="discard"?`discard ${Z||1} card(s)`:G==="delete"?"delete a card":G==="return"?"return a card":`execute ${G}${Z?` ${Z}`:""}`}?`}case"select_card_to_flip_for_fire_3":return"Action: Select a card to flip";case"select_own_other_card_to_shift":return"Action: Select one of your cards to shift";case"select_opponent_face_down_card_to_shift":return"Action: Select an opponent's face-down card to shift";case"prompt_spirit_1_start":return"Start Phase: Discard 1 card or flip Spirit-1?";case"select_any_card_to_flip_optional":return"Action: You may flip one card. Select a card or skip.";case"prompt_swap_protocols":return"Action: Swap two protocols.";case"select_cards_from_hand_to_discard_for_fire_4":return"Action: Select 1 or more cards to discard";case"select_cards_from_hand_to_discard_for_hate_1":return`Action: Select ${q.count} card(s) to discard for Hate-1`;case"select_any_card_to_flip":return`Action: Select a card to flip (${q.count} remaining)`;case"select_any_face_down_card_to_flip_optional":return"Action: You may flip a face-down card. Select a card or skip.";case"select_lane_for_life_3_play":return"Action: Select another lane to play a card into";case"select_card_to_flip_for_light_0":return"Action: Select any card to flip";case"prompt_shift_or_flip_board_card_custom":return"Action: Choose to shift, flip, or skip";case"select_board_card_to_reveal_custom":return"Action: Select a face-down card to reveal";case"select_lane_to_shift_revealed_card_for_light_2":return"Action: Select a lane to shift the revealed card to";case"select_lane_to_shift_revealed_board_card_custom":return"Action: Select a lane to shift the revealed card to";case"select_lane_to_shift_cards_for_light_3":return"Action: Select a lane to shift all face-down cards to";case"select_lane_for_metal_3_delete":return"Action: Select a lane with 8+ cards to delete";case"select_lane_for_delete_all":return"Action: Select a lane to delete all cards";case"select_any_other_card_to_flip_for_water_0":return"Action: Select any other card to flip";case"prompt_rearrange_protocols":return"Action: Rearrange protocols";case"select_lane_for_water_3":return"Action: Select a lane to return cards from";case"select_own_card_to_return_for_water_4":return"Action: Select one of your cards to return to your hand";case"prompt_return_for_psychic_4":return"End Phase: Return an opponent's card?";case"select_any_opponent_card_to_shift":return"Action: Select an opponent's card to shift";case"select_card_to_shift":{const G=q.targetFilter||{},Z=G.owner||"any",Q=G.faceState||"any",I=G.position||"uncovered";let W="Action: Select ";return Z==="own"?W+="one of your ":Z==="opponent"?W+="an opponent's ":W+="a ",Q==="face_down"?W+="face-down ":Q==="face_up"&&(W+="face-up "),I==="covered"?W+="covered ":I==="uncovered"&&(W+="uncovered "),W+="card to shift",W}case"select_opponent_card_to_return":return"Action: Select an opponent's card to return";case"select_own_highest_card_to_delete_for_hate_2":return"Action: Select your highest value uncovered card to delete";case"select_opponent_highest_card_to_delete_for_hate_2":return"Action: Select opponent's highest value uncovered card to delete";case"custom_choice":{const G=q.options||[];if(G.length===2){const Z=G[0].params,Q=G[1].params,I=W=>W.action==="discard"?`you discard ${W.count||1} card${W.count!==1?"s":""}`:W.action==="flip"&&W.flipSelf?"flip this card":W.action==="draw"?`draw ${W.count||1} card${W.count!==1?"s":""}`:W.action==="delete"&&W.deleteSelf?"delete this card":W.action==="delete"?`delete ${W.count||1} card${W.count!==1?"s":""}`:W.action==="return"?`return ${W.count||1} card${W.count!==1?"s":""}`:W.action==="shift"?"shift a card":W.action||"option";return`Either ${I(Z)} or ${I(Q)}.`}return"Action: Make a choice"}case"select_card_from_revealed_deck":return`Action: Select a card with value ${q.valueFilter} from your revealed deck`;case"select_phase_effect":{const G=q,Z=G.availableEffects.map(Q=>Q.cardName).join(", ");return`${G.phase} Phase: Choose which effect to resolve first (${Z})`}default:return"Action Required"}return T==="compile"&&K.length>0?"Phase: Compile":`Phase: ${T.replace("_"," ")}`};return r.jsxs("div",{className:`phase-controller ${N}`,children:[r.jsxs("div",{className:"effect-source-info",children:[r.jsxs("span",{children:[M,"'s Turn"]}),q&&j&&r.jsxs(r.Fragment,{children:[" | Effect from: ",r.jsxs("span",{children:[j.protocol,"-",j.value]})]}),(q==null?void 0:q.sourceCardId)==="CONTROL_MECHANIC"&&r.jsxs(r.Fragment,{children:[" | Effect from: ",r.jsx("span",{children:"Control Component"})]})]}),r.jsxs("div",{className:"phase-controller-main",children:[r.jsx("div",{className:"phase-info",children:D()}),r.jsx("div",{className:"phase-actions",children:L()})]})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const d0={start:"Start",control:"Control",action:"Action",compile:"Compile",hand_limit:"Hand Limit",end:"End"},u0=({gameState:a,turn:n,animationState:l,difficulty:c,onPlayerClick:s,onOpponentClick:d})=>{const{player:p,opponent:f}=a,h=g=>{const y=["info-section"];return y.push(g==="player"?"player-info":"opponent-info"),n===g&&y.push("active-turn"),(l==null?void 0:l.type)==="drawCard"&&l.owner===g&&y.push("is-drawing"),(l==null?void 0:l.type)==="discardCard"&&l.owner===g&&y.push("is-discarding"),y.join(" ")},m=g=>{const y=g==="player"?p:f,w=g==="player"?s:d,_=g==="player"?"Player":`Opponent${c?` (${c.charAt(0).toUpperCase()+c.slice(1)})`:""}`,b=n===g;return r.jsx("div",{className:h(g),onClick:w,children:r.jsxs("div",{className:"info-section-body",children:[r.jsx("h3",{children:_}),b&&r.jsx("span",{className:"phase-badge",children:d0[a.phase]}),r.jsxs("div",{className:"info-line",children:[r.jsx("span",{children:"Hand:"}),r.jsx("span",{children:y.hand.length})]}),r.jsxs("div",{className:"info-line",children:[r.jsx("span",{children:"Deck:"}),r.jsx("span",{children:y.deck.length})]}),r.jsxs("div",{className:"info-line",children:[r.jsx("span",{children:"Trash:"}),r.jsx("span",{children:y.discard.length})]})]})})};return r.jsxs("div",{className:"game-info-panel",children:[m("opponent"),m("player")]})},p0=/\b([A-Z][a-z]+(?:_custom)?)-(\d)\b/g;function Hi(a,n){return{...a,id:`preview-${a.protocol}-${a.value}`,isFaceUp:n}}function cm(a){const n=a.match(/^([A-Z][a-z]+(?:_custom)?)-(\d)$/);return n?{protocol:n[1],value:parseInt(n[2],10)}:null}function sm(a){const n=[];let l;const c=new RegExp(p0);for(;(l=c.exec(a))!==null;)n.push({protocol:l[1],value:parseInt(l[2],10)});return n}function Ih(a,n){if(a.sourceCardRef||a.targetCardRefs&&a.targetCardRefs.length>0)return!0;if(a.sourceCard){const c=cm(a.sourceCard);if(c&&n.some(s=>s.protocol===c.protocol&&s.value===c.value))return!0}const l=sm(a.message);return!!(l.length>0&&l.some(c=>n.some(s=>s.protocol===c.protocol&&s.value===c.value)))}function f0(a,n){const l={source:null,targets:[]};if(a.sourceCardRef){const c=n.find(s=>s.protocol===a.sourceCardRef.protocol&&s.value===a.sourceCardRef.value);c&&(l.source=Hi(c,a.sourceCardRef.isFaceUp))}if(a.targetCardRefs&&a.targetCardRefs.length>0)for(const c of a.targetCardRefs){const s=n.find(d=>d.protocol===c.protocol&&d.value===c.value);s&&l.targets.push(Hi(s,c.isFaceUp))}if(!l.source&&l.targets.length===0){if(a.sourceCard){const s=cm(a.sourceCard);if(s){const d=n.find(p=>p.protocol===s.protocol&&p.value===s.value);d&&(l.source=Hi(d,!0))}}const c=sm(a.message);for(const s of c){const d=n.find(p=>p.protocol===s.protocol&&p.value===s.value);if(d){const p=Hi(d,!0);l.source?(l.source.protocol!==s.protocol||l.source.value!==s.value)&&l.targets.push(p):l.source=p}}}return l}function h0({log:a,onClose:n}){const[l,c]=re.useState(null),[s,d]=re.useState(0),p=re.useMemo(()=>{const g=Ja();return[...gn,...g]},[]),f=g=>{let y="";if(g.phase){const w=g.phase.charAt(0).toUpperCase()+g.phase.slice(1);y+=`[${w}] `}return g.sourceCard&&!g.message.startsWith(g.sourceCard)&&(y+=`${g.sourceCard}: `),`${y}${g.message}`},h=re.useMemo(()=>{if(l===null)return null;const g=a[l];return g?f0(g,p):null},[l,a,p]),m=(g,y)=>{Ih(y,p)&&(l===g?h&&h.targets.length>1?d(w=>(w+1)%h.targets.length):(c(null),d(0)):(c(g),d(0)))};return r.jsx("div",{className:"modal-overlay",onClick:n,children:r.jsxs("div",{className:"modal-content log-modal-content log-modal-with-preview",onClick:g=>g.stopPropagation(),children:[r.jsx("button",{className:"btn btn-back modal-close-btn",onClick:n,children:"X"}),r.jsx("h2",{children:"Game Log"}),r.jsxs("div",{className:"log-content-wrapper",children:[r.jsx("div",{className:"log-preview-area log-preview-left",children:(h==null?void 0:h.source)&&r.jsx("div",{className:"log-preview-card",children:r.jsx(vt,{card:h.source,isFaceUp:h.source.isFaceUp})})}),r.jsx("ol",{className:"log-list",children:a.map((g,y)=>{const w=g.indentLevel!==void 0,_=w?{paddingLeft:`${g.indentLevel*20+40}px`}:{};w&&g.indentLevel===0&&(_.fontWeight="bold");const b=Ih(g,p),k=l===y;return r.jsx("li",{className:`log-entry log-entry-${g.player}${b?" log-entry-clickable":""}${k?" log-entry-selected":""}`,style:_,onClick:()=>m(y,g),children:f(g)},y)})}),r.jsx("div",{className:"log-preview-area log-preview-right",children:(h==null?void 0:h.targets)&&h.targets.length>0&&r.jsxs("div",{className:"log-preview-card",children:[r.jsx(vt,{card:h.targets[s],isFaceUp:h.targets[s].isFaceUp}),h.targets.length>1&&r.jsxs("div",{className:"log-preview-counter",children:[s+1," / ",h.targets.length]})]})})]})]})})}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const m0=({message:a,player:n})=>r.jsx("div",{className:`toaster toaster-${n}`,children:a});function y0({gameState:a,targetPlayer:n,onConfirm:l}){var O;const[c]=re.useState([...a[n].protocols]),[s,d]=re.useState([...a[n].protocols]),[p,f]=re.useState([0,1,2]),h=re.useRef(null),m=re.useRef(null),g=re.useRef(0),y=re.useRef(null),w=re.useRef(0),_=((O=a.actionRequired)==null?void 0:O.type)==="prompt_rearrange_protocols"?a.actionRequired.disallowedProtocolForLane:void 0,b=re.useMemo(()=>{if(s.length!==c.length)return!1;for(let X=0;X<s.length;X++)if(s[X]!==c[X])return!0;return!1},[s,c]),k=re.useMemo(()=>{if(!_)return console.log("[RearrangeModal] No disallowedProtocolForLane set"),!1;const{laneIndex:X,protocol:ne}=_,z=s[X],G=z===ne;return console.log("[RearrangeModal] Checking violation:",{disallowedProtocol:ne,disallowedLaneIndex:X,currentProtocolAtLane:z,protocols:s,hasViolation:G}),G},[s,_]),S=a[n],E=a[n==="player"?"opponent":"player"],C=S.laneValues,N=S.compiled,T=(X,ne)=>{let z=[X];return ne&&z.push("compiled"),z.join(" ")},H=(X,ne)=>{h.current=ne,X.dataTransfer.effectAllowed="move"},q=(X,ne)=>{X.preventDefault(),m.current=ne},B=()=>{if(h.current!==null&&m.current!==null&&h.current!==m.current){const X=[...s],ne=[...p],z=X[h.current];X[h.current]=X[m.current],X[m.current]=z;const G=ne[h.current];ne[h.current]=ne[m.current],ne[m.current]=G,h.current=null,m.current=null,d(X),f(ne)}},K=X=>{X.preventDefault()},U=(X,ne)=>{y.current=ne,g.current=X.touches[0].clientY,w.current=X.touches[0].clientY},R=X=>{var G;if(y.current===null)return;w.current=X.touches[0].clientY;const ne=X.touches[0],z=document.elementFromPoint(ne.clientX,ne.clientY);if(z){const Z=z.closest(".rearrange-item");if(Z){const I=Array.from(((G=Z.parentElement)==null?void 0:G.children)||[]).indexOf(Z);I!==-1&&I!==y.current&&(m.current=I)}}},j=()=>{if(y.current!==null&&m.current!==null&&y.current!==m.current){const X=[...s],ne=[...p],z=X[y.current];X[y.current]=X[m.current],X[m.current]=z;const G=ne[y.current];ne[y.current]=ne[m.current],ne[m.current]=G,d(X),f(ne)}y.current=null,m.current=null,g.current=0,w.current=0},F=n==="player",M=F?"Rearrange Your Protocols":"Rearrange Opponent's Protocols",L=r.jsx("div",{className:`protocol-bar ${F?"player-bar":"opponent-bar"} rearrange-editable`,onDragOver:K,children:s.map((X,ne)=>{const z=X!==c[ne],G=_&&_.laneIndex===ne&&X===_.protocol,Z=p[ne],Q=N[Z],I=T("protocol-display rearrange-item",Q);return r.jsxs("div",{className:`${I} ${z?"changed":""} ${G?"violation":""}`,draggable:!0,onDragStart:W=>H(W,ne),onDragEnter:W=>q(W,ne),onDragEnd:B,onTouchStart:W=>U(W,ne),onTouchMove:R,onTouchEnd:j,children:[r.jsx("span",{className:"protocol-name",children:X}),r.jsx("span",{className:"protocol-value",children:C[ne]})]},`${X}-${ne}`)})}),D=r.jsx("div",{className:`protocol-bar ${F?"opponent-bar":"player-bar"}`,children:E.protocols.map((X,ne)=>r.jsxs("div",{className:T("protocol-display",E.compiled[ne]),children:[r.jsx("span",{className:"protocol-name",children:X}),r.jsx("span",{className:"protocol-value",children:E.laneValues[ne]})]},`other-proto-${X}-${ne}`))});return r.jsx("div",{className:"modal-overlay",children:r.jsxs("div",{className:"modal-content rearrange-modal-content",onClick:X=>X.stopPropagation(),children:[r.jsx("h2",{children:M}),r.jsx("p",{children:"Drag and drop the protocols to reorder them. You must change the order to continue."}),_&&r.jsxs("p",{className:"warning-text",children:[" ",r.jsx("strong",{children:_.protocol})," cannot be placed on line ",r.jsx("strong",{children:_.laneIndex})," due to Anarchy-3's restriction."]}),r.jsx("div",{className:"rearrange-board-view",children:r.jsxs("div",{className:"protocol-bars-container",children:[F?D:L,F?L:D]})}),r.jsxs("div",{className:"rearrange-actions",children:[r.jsx("button",{className:"btn",onClick:()=>l(s),disabled:!b||k,children:"Confirm Rearrangement"}),k&&r.jsxs("p",{className:"error-text",children:["Cannot confirm: ",_.protocol," is on line ",_.laneIndex]})]})]})})}function g0({gameState:a,targetPlayer:n,onConfirm:l}){const[c,s]=re.useState([]),d=a[n],p=n==="player",f=p?"Swap Your Protocols":"Swap Opponent's Protocols",h=y=>{c.includes(y)?s(w=>w.filter(_=>_!==y)):c.length<2&&s(w=>[...w,y])},m=()=>{c.length===2&&l(c)},g=y=>{let w=["protocol-display","rearrange-item"];return d.compiled[y]&&w.push("compiled"),c.includes(y)&&w.push("selected"),w.join(" ")};return r.jsx("div",{className:"modal-overlay",children:r.jsxs("div",{className:"modal-content rearrange-modal-content",onClick:y=>y.stopPropagation(),children:[r.jsx("h2",{children:f}),r.jsx("p",{children:"Select two protocols to swap their positions. This action is mandatory."}),r.jsx("div",{className:"rearrange-board-view",children:r.jsx("div",{className:"protocol-bars-container",children:r.jsx("div",{className:`protocol-bar ${p?"player-bar":"opponent-bar"}`,children:d.protocols.map((y,w)=>r.jsxs("div",{className:g(w),onClick:()=>h(w),children:[r.jsx("span",{className:"protocol-name",children:y}),r.jsx("span",{className:"protocol-value",children:d.laneValues[w]})]},y))})})}),r.jsx("div",{className:"rearrange-actions",children:r.jsx("button",{className:"btn",onClick:m,disabled:c.length!==2,children:"Confirm Swap"})})]})})}function v0({gameState:a,onSelectCard:n}){var k;const[l,c]=re.useState(null),s=re.useRef(!1),d=a.actionRequired,p=d==null?void 0:d.revealedCards,f=d==null?void 0:d.selectableCardIds,h=p||(d!=null&&d.actor?(k=a[d.actor])==null?void 0:k.deck:[])||[],m=re.useMemo(()=>h.map((S,$)=>({...S,id:S.id||`deck-${$}`,isFaceUp:!0})),[h]);if(re.useEffect(()=>{if((d==null?void 0:d.type)==="select_card_from_revealed_deck"&&(f==null?void 0:f.length)>0&&!s.current){const S=m.find($=>f.includes($.id));S&&(c(S),s.current=!0)}},[d==null?void 0:d.type,f,m]),re.useEffect(()=>{(!d||d.type!=="select_card_from_revealed_deck")&&(s.current=!1,c(null))},[d]),!d||d.type!=="select_card_from_revealed_deck")return null;const{valueFilter:g}=d,y=S=>f==null?void 0:f.includes(S),w=S=>{y(S.id)&&c(S)},_=S=>{y(S.id)&&c(S)},b=()=>{l&&y(l.id)&&n(l.id)};return r.jsx("div",{className:"modal-overlay",children:r.jsxs("div",{className:"modal-content revealed-deck-modal",onClick:S=>S.stopPropagation(),children:[r.jsx("h2",{children:"Your Revealed Deck"}),r.jsxs("p",{children:["Select a card with value ",g," to draw:"]}),r.jsxs("div",{className:"revealed-deck-content-wrapper",children:[r.jsx("div",{className:"revealed-deck-preview-area",children:l&&r.jsxs("div",{className:"revealed-deck-preview-card",children:[r.jsx(vt,{card:l,isFaceUp:!0}),r.jsxs("button",{className:"btn preview-confirm-btn",onClick:b,children:["Draw ",l.protocol,"-",l.value]})]})}),r.jsx("div",{className:"revealed-deck-grids-area",children:r.jsx("div",{className:"revealed-deck-card-grid",children:m.length>0?m.map(S=>{const $=y(S.id),E=(l==null?void 0:l.id)===S.id;return r.jsx("div",{onClick:C=>{C.stopPropagation(),_(S)},onMouseEnter:()=>w(S),style:{cursor:$?"pointer":"default"},children:r.jsx(vt,{card:S,isFaceUp:!0,additionalClassName:`in-hand ${$?E?"highlight-selectable":"":"dimmed"}`})},S.id)}):r.jsx("p",{className:"no-cards",children:"No cards in deck."})})})]})]})})}function _0({gameState:a,onAccept:n,onDecline:l}){var y,w;const c=a.actionRequired;if(!c||c.type!=="prompt_optional_effect")return null;const s=c.effectDef;if(!s||((y=s.params)==null?void 0:y.action)!=="discard"||!((w=s.params)!=null&&w.useCardFromPreviousEffect))return null;const d=a.lastCustomEffectTargetCardId;if(!d)return null;const p=c.actor||"player",h=a[p].deck.find(_=>_.id===d);if(!h)return null;const m={...h,id:h.id||"revealed-top",isFaceUp:!0},g=`${h.protocol}-${h.value}`;return r.jsx("div",{className:"modal-overlay",children:r.jsxs("div",{className:"modal-content revealed-deck-top-modal",onClick:_=>_.stopPropagation(),children:[r.jsx("h2",{children:"Revealed: Top Card of Your Deck"}),r.jsx("p",{children:"You may discard this card:"}),r.jsx("div",{className:"revealed-card-display",children:r.jsx(vt,{card:m,isFaceUp:!0})}),r.jsxs("div",{className:"revealed-deck-top-actions",children:[r.jsxs("button",{className:"btn",onClick:n,children:["Discard ",g]}),r.jsx("button",{className:"btn btn-back",onClick:l,children:"Keep in Deck"})]})]})})}function x0({player:a,playerState:n,onClose:l,difficulty:c}){const s=a==="player"?"Player":`Opponent${c?` (${c.charAt(0).toUpperCase()+c.slice(1)})`:""}`,[d,p]=re.useState(null),f=m=>{p(m)},h=(m,g,y)=>{const w=m.map((_,b)=>({..._,id:`${g}-${_.protocol}-${_.value}-${b}`,isFaceUp:y}));return r.jsxs(r.Fragment,{children:[r.jsxs("h3",{children:[g," (",w.length,")"]}),r.jsx("div",{className:"debug-card-grid",children:w.length>0?w.map(_=>r.jsx("div",{onClick:b=>{b.stopPropagation(),p(_)},onMouseEnter:()=>f(_),onMouseLeave:()=>f(null),style:{cursor:"pointer"},children:r.jsx(vt,{card:_,isFaceUp:y,additionalClassName:"in-hand"})},_.id)):r.jsxs("p",{className:"no-cards",children:["No cards in ",g.toLowerCase(),"."]})})]})};return r.jsx("div",{className:"modal-overlay",onClick:l,children:r.jsxs("div",{className:"modal-content debug-modal-content debug-modal-with-preview",onClick:m=>m.stopPropagation(),children:[r.jsx("button",{className:"btn btn-back modal-close-btn",onClick:l,children:"X"}),r.jsxs("h2",{children:[s,"'s Info"]}),r.jsxs("div",{className:"debug-content-wrapper",children:[r.jsx("div",{className:"debug-preview-area",children:d&&r.jsx("div",{className:"debug-preview-card",children:r.jsx(vt,{card:d,isFaceUp:d.isFaceUp})})}),r.jsxs("div",{className:"debug-grids-area",children:[h(n.deck,"Deck",!1),h(n.discard,"Discard Pile",!0)]})]})]})})}function w0({onComplete:a}){const[n,l]=re.useState("choose"),[c,s]=re.useState(null),[d,p]=re.useState(null),[f,h]=re.useState(!1),m=y=>{s(y),l("flipping"),h(!0);const w=Math.random()<.5?"heads":"tails";setTimeout(()=>{p(w),h(!1),l("result")},2e3)},g=()=>{if(d===null||c===null)return;const y=d===c;a(y?"player":"opponent",c,y)};return r.jsx("div",{className:"coin-flip-modal-overlay",children:r.jsxs("div",{className:"modal-content coin-flip-modal-content",onClick:y=>y.stopPropagation(),children:[n==="choose"&&r.jsxs(r.Fragment,{children:[r.jsx("h2",{children:"Coin Flip"}),r.jsx("p",{children:"Choose heads or tails to determine who starts the game."}),r.jsxs("div",{className:"coin-flip-choices",children:[r.jsxs("button",{className:"btn coin-flip-choice-btn",onClick:()=>m("heads"),children:[r.jsx("div",{className:"coin-choice-icon",children:"H"}),r.jsx("div",{className:"coin-choice-label",children:"Heads"})]}),r.jsxs("button",{className:"btn coin-flip-choice-btn",onClick:()=>m("tails"),children:[r.jsx("div",{className:"coin-choice-icon",children:"T"}),r.jsx("div",{className:"coin-choice-label",children:"Tails"})]})]})]}),n==="flipping"&&r.jsxs(r.Fragment,{children:[r.jsx("h2",{children:"Flipping..."}),r.jsxs("p",{children:["You chose: ",r.jsx("span",{className:"coin-flip-highlight",children:c==="heads"?"Heads":"Tails"})]}),r.jsx("div",{className:"coin-flip-animation-container",children:r.jsxs("div",{className:`coin-3d ${f?"is-flipping":""}`,children:[r.jsx("div",{className:"coin-face coin-heads",children:"H"}),r.jsx("div",{className:"coin-face coin-tails",children:"T"})]})})]}),n==="result"&&d&&c&&r.jsxs(r.Fragment,{children:[r.jsx("h2",{children:"Result"}),r.jsxs("p",{children:["You chose: ",r.jsx("span",{className:"coin-flip-highlight",children:c==="heads"?"Heads":"Tails"})]}),r.jsx("div",{className:"coin-flip-animation-container",children:r.jsxs("div",{className:`coin-3d result-${d}`,children:[r.jsx("div",{className:"coin-face coin-heads",children:"H"}),r.jsx("div",{className:"coin-face coin-tails",children:"T"})]})}),r.jsxs("p",{className:"coin-flip-result-text",children:["The coin landed on: ",r.jsx("span",{className:"coin-flip-highlight",children:d==="heads"?"Heads":"Tails"})]}),d===c?r.jsx("p",{className:"coin-flip-winner-text",children:"You won! You will start the game."}):r.jsx("p",{className:"coin-flip-loser-text",children:"Opponent won! Opponent will start the game."}),r.jsx("button",{className:"btn",onClick:g,children:"Continue"})]})]})})}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const dm="compile_game_statistics",um=1;function Lh(){const a=Hh,n={};return a.forEach(l=>{n[l]={timesUsed:0,wins:0,losses:0}}),{version:um,global:{totalGamesPlayed:0,totalGamesWon:0,totalGamesLost:0,totalPlaytime:0,fastestWin:null,longestGame:null,lastGameDuration:null,currentStreak:0,longestWinStreak:0,longestLoseStreak:0},protocols:n,aiDifficulty:{easy:{played:0,wins:0,losses:0},normal:{played:0,wins:0,losses:0},hard:{played:0,wins:0,losses:0}},cards:{played:{},deleted:{}},actions:{totalCardsDrawn:0,totalCardsPlayed:0,totalShifts:0,totalDeletes:0,totalDiscards:0,totalFlips:0,totalCompiles:0,totalRefreshes:0},control:{gamesWithControl:0,gamesWithoutControl:0,playerRearranges:0,aiRearranges:0,totalRearranges:0},coinFlip:{headsChosen:0,tailsChosen:0,headsWon:0,tailsWon:0}}}function pm(){var a,n,l,c,s,d,p,f,h,m;try{const g=localStorage.getItem(dm);if(!g)return Lh();const y=JSON.parse(g),w=Hh,_={...y.protocols||{}};w.forEach(S=>{_[S]||(_[S]={timesUsed:0,wins:0,losses:0})});const b={...y,version:um,global:{...y.global,lastGameDuration:((a=y.global)==null?void 0:a.lastGameDuration)||null},protocols:_,control:{gamesWithControl:((n=y.control)==null?void 0:n.gamesWithControl)||0,gamesWithoutControl:((l=y.control)==null?void 0:l.gamesWithoutControl)||0,playerRearranges:((c=y.control)==null?void 0:c.playerRearranges)||0,aiRearranges:((s=y.control)==null?void 0:s.aiRearranges)||0,totalRearranges:((d=y.control)==null?void 0:d.totalRearranges)||0},coinFlip:y.coinFlip||{headsChosen:0,tailsChosen:0,headsWon:0,tailsWon:0},actions:{...y.actions,totalCompiles:((p=y.actions)==null?void 0:p.totalCompiles)||0,totalRefreshes:((f=y.actions)==null?void 0:f.totalRefreshes)||0}};return(!((h=y.control)!=null&&h.playerRearranges)||!y.coinFlip||!((m=y.actions)!=null&&m.totalCompiles)||Object.keys(_).length!==Object.keys(y.protocols||{}).length)&&vr(b),b}catch(g){return console.error("Failed to load statistics:",g),Lh()}}function vr(a){try{localStorage.setItem(dm,JSON.stringify(a))}catch(n){console.error("Failed to save statistics:",n)}}function C0(a,n,l,c,s,d=!1,p,f){const h=n==="player",m={...a.global},g={...a.protocols},y={easy:{...a.aiDifficulty.easy},normal:{...a.aiDifficulty.normal},hard:{...a.aiDifficulty.hard}},w={...a.control},_={...a.actions},b={...a.coinFlip},k={played:{...a.cards.played},deleted:{...a.cards.deleted}};return m.totalGamesPlayed++,h?m.totalGamesWon++:m.totalGamesLost++,m.totalPlaytime+=s,h&&(m.fastestWin===null||s<m.fastestWin)&&(m.fastestWin=s),(m.longestGame===null||s>m.longestGame)&&(m.longestGame=s),m.lastGameDuration=s,h?(m.currentStreak>=0?m.currentStreak++:m.currentStreak=1,m.currentStreak>m.longestWinStreak&&(m.longestWinStreak=m.currentStreak)):(m.currentStreak<=0?m.currentStreak--:m.currentStreak=-1,Math.abs(m.currentStreak)>m.longestLoseStreak&&(m.longestLoseStreak=Math.abs(m.currentStreak))),l.forEach(S=>{g[S]?g[S]={...g[S]}:g[S]={timesUsed:0,wins:0,losses:0},g[S].timesUsed++,h?g[S].wins++:g[S].losses++}),y[c].played++,h?y[c].wins++:y[c].losses++,d?w.gamesWithControl++:w.gamesWithoutControl++,p&&(_.totalCardsPlayed+=p.cardsPlayed,_.totalCardsDrawn+=p.cardsDrawn,_.totalDiscards+=p.cardsDiscarded,_.totalDeletes+=p.cardsDeleted,_.totalFlips+=p.cardsFlipped,_.totalShifts+=p.cardsShifted,_.totalRefreshes+=p.handsRefreshed),f!==void 0&&(_.totalCompiles+=f),{version:a.version,global:m,protocols:g,aiDifficulty:y,cards:k,actions:_,control:w,coinFlip:b}}function b0(a,n){const l={...a,cards:{...a.cards,played:{...a.cards.played}}};return l.cards.played[n]||(l.cards.played[n]=0),l.cards.played[n]++,l}function S0(a,n){const l={...a,cards:{...a.cards,deleted:{...a.cards.deleted}}};return l.cards.deleted[n]||(l.cards.deleted[n]=0),l.cards.deleted[n]++,l}function E0(a,n){const l={...a,control:{...a.control}};return n==="player"?l.control.playerRearranges++:l.control.aiRearranges++,l.control.totalRearranges++,l}function j0(a,n,l){const c={...a,coinFlip:{...a.coinFlip}};return n==="heads"?(c.coinFlip.headsChosen++,l&&c.coinFlip.headsWon++):(c.coinFlip.tailsChosen++,l&&c.coinFlip.tailsWon++),c}function k0(a){return a.global.totalGamesPlayed===0?0:a.global.totalGamesWon/a.global.totalGamesPlayed*100}function R0(a){return a.global.totalGamesPlayed===0?0:Math.floor(a.global.totalPlaytime/a.global.totalGamesPlayed)}function A0(a){return Object.entries(a.protocols).map(([l,c])=>({protocol:l,timesUsed:c.timesUsed,winRate:c.timesUsed>0?c.wins/c.timesUsed*100:0})).sort((l,c)=>c.timesUsed-l.timesUsed).slice(0,5)}function T0(a){return Object.entries(a.protocols).filter(([l,c])=>c.timesUsed>=3).map(([l,c])=>({protocol:l,timesUsed:c.timesUsed,winRate:c.wins/c.timesUsed*100})).sort((l,c)=>c.winRate-l.winRate).slice(0,5)}function D0(a){return Object.entries(a.protocols).map(([l,c])=>({protocol:l,timesUsed:c.timesUsed,winRate:c.timesUsed>0?c.wins/c.timesUsed*100:0})).sort((l,c)=>l.timesUsed-c.timesUsed).slice(0,5)}function N0(a){return Object.entries(a.cards.played).map(([l,c])=>({card:l,count:c})).sort((l,c)=>c.count-l.count).slice(0,5)}function F0(a){return Object.entries(a.cards.deleted).map(([l,c])=>({card:l,count:c})).sort((l,c)=>c.count-l.count).slice(0,5)}function Sl(a){const n=Math.floor(a/3600),l=Math.floor(a%3600/60),c=a%60;return n>0?`${n}h ${l}m`:l>0?`${l}m ${c}s`:`${c}s`}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function q0(a,n,l){const[c,s]=re.useState(()=>pm()),d=re.useRef(null),p=re.useCallback(()=>{d.current=Date.now()},[]),f=re.useCallback((w,_)=>{s(b=>{const k=`${w}-${_}`,S=b0(b,k);return vr(S),S})},[]),h=re.useCallback((w,_)=>{s(b=>{const k=`${w}-${_}`,S=S0(b,k);return vr(S),S})},[]),m=re.useCallback((w,_)=>{s(b=>{const k=j0(b,w,_);return vr(k),k})},[]),g=re.useCallback(w=>{s(_=>{const b=E0(_,w);return vr(b),b})},[]),y=re.useCallback((w,_,b)=>{if(d.current===null)return;const k=Math.floor((Date.now()-d.current)/1e3);s(S=>{const $=C0(S,w,a,n,k,l,_,b);return vr($),$}),d.current=null},[a,n,l]);return{statistics:c,startGame:p,endGame:y,trackPlayerCardPlayed:f,trackPlayerCardDeleted:h,trackPlayerCoinFlip:m,trackPlayerRearrange:g}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function x(a,n,l=!0){const s=Ja().find(d=>d.protocol===a&&d.value===n);return s?{id:Be(),protocol:s.protocol,value:s.value,top:s.top,middle:s.middle,bottom:s.bottom,keywords:s.keywords,isFaceUp:l,isRevealed:!1,category:s.category||"Main",...s.customEffects&&{customEffects:s.customEffects}}:(console.warn(`Card not found: ${a}-${n}`),{id:Be(),protocol:a,value:n,top:"",middle:"",bottom:"",keywords:{},isFaceUp:l,isRevealed:!1,category:"Main"})}function V(a,n,l,c){const s={...a},d={...s[n]},p=[...d.lanes];return p[l]=[...p[l],c],d.lanes=p,s[n]=d,s}function Mh(a,n){const l=[],c=Ja();for(const s of a){const d=c.filter(p=>p.protocol===s);for(const p of d)n.some(h=>h.protocol===p.protocol&&h.value===p.value)||l.push(x(p.protocol,p.value,!0))}return l}function je(a,n,l,c,s){return{...a,player:{...a.player,protocols:n,lanes:[[],[],[]],hand:[]},opponent:{...a.opponent,protocols:l,lanes:[[],[],[]],hand:[]},turn:c,phase:s,actionRequired:null,queuedActions:[],_interruptedTurn:void 0,_interruptedPhase:void 0,processedStartEffectIds:[],processedEndEffectIds:[],processedUncoverEventIds:[]}}function ke(a){const n=[...a.player.hand,...a.player.lanes.flat()],l=[...a.opponent.hand,...a.opponent.lanes.flat()],c=Mh(a.player.protocols,n),s=Mh(a.opponent.protocols,l),d=a.turn==="player"?"Player":"Opponent",p=[{player:"player",message:`Player protocols: ${a.player.protocols.join(", ")}`},{player:"opponent",message:`Opponent protocols: ${a.opponent.protocols.join(", ")}`},{player:a.turn,message:`${d} goes first.`},{player:"player",message:"---"},{player:a.turn,message:`[Test Scenario] Phase: ${a.phase}`}];return{...a,player:{...a.player,deck:c,discard:[],compiled:[!1,!1,!1]},opponent:{...a.opponent,deck:s,discard:[],compiled:[!1,!1,!1]},log:p}}const fm={name:"Psychic-3 Uncover whrend Opponent's Turn",description:"Player lscht Opponent's face-down card  Psychic-3 uncovered  Player discardet, Opponent shiftet",setup:a=>{let n=je(a,["Hate","Fire","Water"],["Psychic","Death","Spirit"],"player","action");return n.player.hand=[x("Hate",0,!0),x("Fire",1,!0),x("Water",1,!0)],n=V(n,"opponent",1,x("Psychic",3,!0)),n=V(n,"opponent",1,x("Fire",1,!1)),n=_e(n),ke(n)}},hm={name:"Psychic-4 End Effect mit Uncover-Interrupt",description:"Psychic-4 returnt Fire-2  Fire-4 uncovered  Interrupt  Psychic-4 flip aus Queue",setup:a=>{let n=je(a,["Fire","Water","Spirit"],["Psychic","Death","Metal"],"opponent","end");return n=V(n,"opponent",0,x("Psychic",4,!0)),n=V(n,"player",1,x("Fire",4,!0)),n=V(n,"player",1,x("Fire",2,!0)),n.opponent.hand=[x("Water",1),x("Water",2)],n=_e(n),ke(n)}},mm={name:"Spirit-3 Draw whrend End Phase",description:"Spirit-3 draw in End Phase  Shift-prompt in Queue  Player kann lanes klicken",setup:a=>{let n=je(a,["Spirit","Fire","Water"],["Death","Metal","Psychic"],"player","action");n=V(n,"player",0,x("Spirit",3,!0));const l=Ja(),c=l.find(p=>p.protocol==="Fire"&&p.value===1),s=l.find(p=>p.protocol==="Water"&&p.value===1),d=l.find(p=>p.protocol==="Spirit"&&p.value===1);return n.player.deck=[c,s,d],n=_e(n),ke(n)}},ym={name:"Plague-2 Actor Propagation",description:"Player spielt Plague-2  Player discardet  Opponent discardet (actor korrekt)",setup:a=>{let n=je(a,["Plague","Death","Hate"],["Fire","Water","Spirit"],"player","action");return n.player.hand=[x("Plague",2,!0),x("Fire",1),x("Water",1),x("Spirit",1)],n.opponent.hand=[x("Fire",2),x("Water",2),x("Spirit",2),x("Death",2)],n=_e(n),ke(n)}},gm={name:"Darkness-1 Flip + Shift mit Interrupt",description:"Darkness-1 flippt Fire-0  Delete-Interrupt  Player shiftet",setup:a=>{let n=je(a,["Darkness","Fire","Water"],["Spirit","Death","Metal"],"player","action");return n.player.hand=[x("Darkness",1,!0)],n=V(n,"opponent",0,x("Fire",0,!1)),n=_e(n),ke(n)}},vm={name:"Plague-4 Owner vs Turn Check",description:"Plague-4 End  Player deletet  Opponent (owner) wird fr flip gefragt",setup:a=>{let n=je(a,["Fire","Water","Spirit"],["Plague","Death","Metal"],"opponent","end");return n=V(n,"opponent",0,x("Plague",4,!0)),n=V(n,"player",1,x("Water",2,!1)),n=_e(n),ke(n)}},_m={name:"Water Owner vs Turn Check",description:"Plague-4 End  Player deletet  Opponent (owner) wird fr flip gefragt",setup:a=>{let n=je(a,["Fire","Water","Spirit"],["Plague","Death","Metal"],"player","action");return n=V(n,"opponent",0,x("Plague",4,!0)),n=V(n,"player",2,x("Water",4,!1)),n.player.hand=[x("Water",0,!0),x("Fire",1),x("Water",1),x("Spirit",1)],n.opponent.hand=[x("Fire",2),x("Water",2),x("Spirit",2),x("Death",2)],n=_e(n),ke(n)}},xm={name:"Hate-1 Multi-Delete mit Uncover-Interrupt",description:"Hate-1 lscht Plague-0  Plague-5 uncovered  Interrupt  Player macht 2. Delete",setup:a=>{let n=je(a,["Fire","Hate","Water"],["Plague","Death","Metal"],"player","action");return n.player.hand=[x("Hate",1,!0),x("Psychic",2,!0),x("Psychic",4,!0),x("Hate",4,!0),x("Water",1,!0)],n=V(n,"opponent",0,x("Plague",2,!0)),n=V(n,"opponent",0,x("Plague",0,!0)),n.opponent.hand=[x("Fire",2,!0),x("Water",2,!0),x("Spirit",2,!0),x("Death",2,!0),x("Metal",2,!0)],n=_e(n),ke(n)}},wm={name:"Darkness-1  Hate-0 Flip  Multi-Effect Chain",description:" Darkness-1 flippt Hate-0  Delete-Interrupt  Draw-Interrupt  Shift aus Queue",setup:a=>{let n=je(a,["Darkness","Fire","Water"],["Hate","Death","Metal"],"player","action");n.player.hand=[x("Darkness",1,!0)],n=V(n,"opponent",0,x("Hate",0,!1)),n=V(n,"opponent",1,x("Hate",3,!0)),n=V(n,"opponent",2,x("Fire",1,!1)),n=V(n,"player",1,x("Water",2,!0)),n.opponent.hand=[x("Death",2),x("Metal",3)];const c=Ja().find(s=>s.protocol==="Death"&&s.value===1);return n.opponent.deck=[c],n=_e(n),ke(n)}},Cm={name:"Water-4 Return  Turn End",description:" Water-4 returnt Karte  Turn endet (Bug-Fix: Opponent spielt nicht zweimal)",setup:a=>{let n=je(a,["Hate","Spirit","Light"],["Fire","Water","Death"],"opponent","action");return n.opponent.hand=[x("Water",4,!0)],n=V(n,"opponent",0,x("Life",4,!0)),n=V(n,"opponent",2,x("Death",4,!1)),n=V(n,"player",1,x("Spirit",1,!0)),n=V(n,"player",2,x("Light",5,!1)),n.player.hand=[x("Fire",1),x("Spirit",2),x("Hate",4)],n=_e(n),ke(n)}},bm={name:"Psychic-3 Discard + Shift",description:" Psychic-3 On-Play  Player discardet  AI shiftet (Bug-Fix: AI kann shiften)",setup:a=>{let n=je(a,["Fire","Water","Spirit"],["Psychic","Death","Metal"],"opponent","action");return n.opponent.hand=[x("Psychic",3,!0)],n.player.hand=[x("Fire",1),x("Water",2),x("Spirit",1)],n=V(n,"player",0,x("Fire",2,!0)),n=V(n,"player",1,x("Water",3,!0)),n=V(n,"player",2,x("Spirit",4,!0)),n=_e(n),ke(n)}},Sm={name:"Death-1 Delete  Speed-3 Uncover",description:" Death-1 lscht Light-0  Speed-3 uncovered  Player shiftet (Bug-Fix Test)",setup:a=>{let n=je(a,["Speed","Light","Water"],["Death","Fire","Metal"],"opponent","start");return n=V(n,"player",0,x("Speed",3,!0)),n=V(n,"player",0,x("Light",0,!0)),n=V(n,"player",1,x("Water",1,!0)),n=V(n,"opponent",0,x("Death",1,!0)),n.player.hand=[],n.opponent.hand=[],n=_e(n),ke(n)}},Em={name:"Gravity-2 Flip  Metal-5 Discard  Shift",description:" Gravity-2 flippt Metal-5  Discard Interrupt  shiften (Bug-Fix: AI stuck)",setup:a=>{let n=je(a,["Fire","Water","Light"],["Gravity","Metal","Fire"],"opponent","action");return n.opponent.hand=[x("Gravity",2,!0),x("Fire",1)],n=V(n,"opponent",1,x("Metal",5,!1)),n=V(n,"player",0,x("Fire",2,!0)),n=V(n,"player",2,x("Light",3,!0)),n.player.hand=[x("Water",1),x("Fire",3)],n=_e(n),ke(n)}},jm={name:"Hate-2 Player spielt (Einfach)",description:" Player spielt Hate-2  Whlt eigene & Gegners hchste Karte",setup:a=>{let n=je(a,["Hate","Water","Light"],["Metal","Death","Gravity"],"player","action");return n.player.hand=[x("Hate",2,!0)],n=V(n,"player",0,x("Fire",4,!0)),n=V(n,"player",1,x("Water",2,!0)),n=V(n,"player",2,x("Light",5,!0)),n=V(n,"opponent",0,x("Metal",3,!0)),n=V(n,"opponent",1,x("Death",5,!0)),n=V(n,"opponent",2,x("Gravity",2,!1)),n=_e(n),ke(n)}},km={name:"Hate-2 AI spielt (Normal)",description:" AI spielt Hate-2  AI whlt eigene & Players hchste automatisch",setup:a=>{let n=je(a,["Water","Spirit","Light"],["Hate","Metal","Death"],"opponent","action");return n.opponent.hand=[x("Hate",2,!0)],n=V(n,"opponent",0,x("Fire",5,!0)),n=V(n,"opponent",1,x("Metal",3,!0)),n=V(n,"opponent",2,x("Death",2,!1)),n=V(n,"player",0,x("Water",4,!0)),n=V(n,"player",1,x("Spirit",5,!0)),n=V(n,"player",2,x("Light",2,!0)),n=_e(n),ke(n)}},Rm={name:"Hate-2 AI spielt (Normal) mit Auswahl",description:" AI spielt Hate-2  AI whlt eigene & Players hchste automatisch",setup:a=>{let n=je(a,["Water","Spirit","Light"],["Hate","Metal","Death"],"opponent","action");return n.opponent.hand=[x("Hate",2,!0)],n=V(n,"opponent",0,x("Fire",5,!0)),n=V(n,"opponent",1,x("Metal",3,!0)),n=V(n,"opponent",2,x("Death",2,!1)),n=V(n,"player",0,x("Water",4,!0)),n=V(n,"player",1,x("Spirit",5,!0)),n=V(n,"player",2,x("Light",5,!0)),n=_e(n),ke(n)}},Am={name:"Hate-2 Selbst-Lschung",description:" Hate-2 lscht sich selbst  Zweite Klausel entfllt (Regelwerk-Check)",setup:a=>{let n=je(a,["Hate","Fire","Water"],["Metal","Death","Gravity"],"player","action");return n.player.hand=[x("Hate",2,!0)],n=V(n,"player",1,x("Fire",1,!0)),n=V(n,"player",2,x("Water",0,!0)),n=V(n,"opponent",0,x("Metal",3,!0)),n=V(n,"opponent",1,x("Death",5,!0)),n=_e(n),ke(n)}},Tm={name:"Hate-2 Gleichstand (Auswahl)",description:" Hate-2 mit mehreren hchsten  Player muss whlen (Tied values)",setup:a=>{let n=je(a,["Hate","Water","Spirit"],["Metal","Death","Gravity"],"player","action");return n.player.hand=[x("Hate",2,!0)],n=V(n,"player",0,x("Fire",4,!0)),n=V(n,"player",1,x("Water",4,!0)),n=V(n,"player",2,x("Spirit",4,!0)),n=V(n,"opponent",0,x("Metal",5,!0)),n=V(n,"opponent",1,x("Death",5,!0)),n=V(n,"opponent",2,x("Gravity",2,!1)),n=_e(n),ke(n)}},Dm={name:"Hate-2 Face-Down Karten",description:" Hate-2 mit face-down  Alle face-down sind value 2 (Tied mit Hate-2)",setup:a=>{let n=je(a,["Hate","Fire","Water"],["Metal","Death","Gravity"],"player","action");return n.player.hand=[x("Hate",2,!0)],n=V(n,"player",1,x("Fire",5,!1)),n=V(n,"player",2,x("Water",5,!1)),n=V(n,"opponent",0,x("Metal",5,!0)),n=V(n,"opponent",1,x("Death",4,!1)),n=V(n,"opponent",2,x("Gravity",1,!0)),n=_e(n),ke(n)}},Nm={name:"Hate-2 AI Play-Validation",description:" AI spielt Hate-2 NICHT face-up wenn es sich selbst lschen wrde",setup:a=>{let n=je(a,["Fire","Water","Spirit"],["Hate","Death","Metal"],"opponent","action");return n.opponent.hand=[x("Hate",2,!0)],n=V(n,"opponent",1,x("Fire",0,!0)),n=V(n,"opponent",2,x("Water",1,!0)),n=V(n,"player",0,x("Fire",5,!0)),n=V(n,"player",1,x("Water",4,!0)),n=_e(n),ke(n)}},Fm={name:"Hate-2 AI spielt OFFEN (Optimal)",description:" AI spielt Hate-2 offen weil nicht hchste Karte",setup:a=>{let n=je(a,["Water","Spirit","Light"],["Hate","Metal","Death"],"opponent","action");return n.opponent.hand=[x("Hate",2,!0)],n=V(n,"opponent",0,x("Fire",5,!0)),n=V(n,"opponent",1,x("Metal",4,!0)),n=V(n,"opponent",2,x("Death",3,!0)),n=V(n,"player",0,x("Water",2,!0)),n=V(n,"player",1,x("Spirit",5,!0)),n=V(n,"player",2,x("Light",1,!0)),n=_e(n),ke(n)}},$0={name:"Chaos-3 Protocol-Free Playing",description:"Player with Chaos-3 can play any card face-up in any lane",setup:a=>{let n=je(a,["Chaos","Fire","Water"],["Spirit","Death","Metal"],"player","action");return n=V(n,"player",0,x("Chaos",3,!0)),n.player.hand=[x("Gravity",2,!0),x("Hate",3,!0),x("Love",1,!0)],n=_e(n),ke(n)}},U0={name:"Frost-3 Blocks Shifts (Covered)",description:"Frost-3 should prevent shifts even when covered (Top-Box effect always active)",setup:a=>{let n=je(a,["Gravity","Water","Fire"],["Frost","Metal","Death"],"player","action");return n=V(n,"opponent",0,x("Frost",3,!0)),n=V(n,"opponent",0,x("Metal",2,!1)),n=V(n,"player",1,x("Water",2,!0)),n.player.hand=[x("Gravity",1,!0),x("Fire",2,!0)],n=_e(n),ke(n)}},O0={name:"Water-0 Softlock Bug Fix",description:"Water-0 self-flip should be cancelled when card becomes covered before self-flip executes",setup:a=>{let n=je(a,["Water","Darkness","Light"],["Apathy","Fire","Death"],"player","action");return n=V(n,"player",1,x("Darkness",3,!1)),n.player.hand=[x("Water",0,!0),x("Darkness",2,!0),x("Fire",1,!0)],n=_e(n),ke(n)}},I0={name:"Darkness-1 Flip and Shift Chain",description:"Darkness-1 should flip opponent card, then allow shifting that same card",setup:a=>{let n=je(a,["Darkness","Water","Fire"],["Metal","Fire","Death"],"player","action");return n=V(n,"opponent",0,x("Metal",2,!1)),n=V(n,"opponent",1,x("Fire",1,!0)),n=V(n,"opponent",2,x("Hate",0,!1)),n.player.hand=[x("Darkness",1,!0),x("Water",2,!0),x("Fire",3,!0)],n=_e(n),ke(n)}},L0={name:"Darkness-1 Flips Speed-3 - Middle Effect Execution",description:"When Darkness-1 flips Speed-3, Speed-3's middle effect (shift) should execute before Darkness-1's shift",setup:a=>{let n=je(a,["Darkness","Water","Fire"],["Speed","Fire","Metal"],"player","action");return n=V(n,"opponent",0,x("Speed",3,!1)),n=V(n,"opponent",1,x("Fire",1,!0)),n=V(n,"opponent",2,x("Metal",2,!0)),n.player.hand=[x("Darkness",1,!0),x("Water",2,!0),x("Fire",3,!0)],n=_e(n),ke(n)}},M0={name:"Darkness-1 Flips Speed-3 - Middle Effect Execution",description:"When Darkness-1 flips Speed-3, Speed-3's middle effect (shift) should execute before Darkness-1's shift",setup:a=>{let n=je(a,["Darkness","Water","Fire"],["Speed","Fire","Metal"],"player","action");return n=V(n,"opponent",0,x("Speed",3,!1)),n=V(n,"opponent",1,x("Fire",1,!0)),n=V(n,"opponent",2,x("Metal",2,!0)),n.player.hand=[x("Darkness",1,!0),x("Water",2,!0),x("Fire",3,!0)],n=_e(n),ke(n)}},qm={name:"Fire-1 & Fire-2 Conditional Test",description:" Fire-1 (discard -> delete) & Fire-2 (discard -> return) if_executed logic",setup:a=>{let n=je(a,["Fire","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[x("Fire",1,!0),x("Fire",2,!0),x("Fire",0,!0),x("Fire",3,!0),x("Fire",4,!0),x("Fire",5,!0)],n=V(n,"opponent",0,x("Metal",3,!0)),n=V(n,"opponent",1,x("Death",4,!0)),n=V(n,"opponent",2,x("Fire",2,!0)),n=V(n,"opponent",0,x("Metal",1,!0)),n=V(n,"player",2,x("Spirit",3,!0)),n=V(n,"player",1,x("Water",3,!0)),n=V(n,"player",2,x("Spirit",2,!0)),n=_e(n),ke(n)}},$m={name:"Anarchy Test Playground",description:" All Anarchy cards on hand for testing",setup:a=>{let n=je(a,["Anarchy","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[x("Anarchy",0,!0),x("Anarchy",1,!0),x("Anarchy",2,!0),x("Anarchy",3,!0),x("Anarchy",5,!0),x("Anarchy",6,!0)],n=V(n,"opponent",0,x("Metal",3,!0)),n=V(n,"opponent",1,x("Death",4,!1)),n=V(n,"opponent",2,x("Fire",2,!0)),n=V(n,"opponent",0,x("Metal",1,!0)),n=V(n,"player",2,x("Spirit",3,!0)),n=V(n,"player",1,x("Water",3,!0)),n=V(n,"player",2,x("Spirit",2,!0)),n=_e(n),ke(n)}},Um={name:"Darkness Test Playground",description:" All Darkness cards on hand for testing",setup:a=>{let n=je(a,["Darkness","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[x("Darkness",0,!0),x("Darkness",1,!0),x("Darkness",2,!0),x("Darkness",3,!0),x("Darkness",4,!0),x("Darkness",5,!0)],n=V(n,"opponent",0,x("Metal",3,!1)),n=V(n,"opponent",1,x("Death",4,!0)),n=V(n,"opponent",2,x("Fire",2,!1)),n=V(n,"opponent",0,x("Metal",1,!0)),n=V(n,"opponent",1,x("Death",2,!1)),n=V(n,"player",2,x("Spirit",3,!0)),n=V(n,"player",1,x("Water",3,!0)),n=V(n,"player",2,x("Spirit",2,!0)),n=_e(n),ke(n)}},Om={name:"Apathy Test Playground",description:" All Apathy cards on hand for testing",setup:a=>{let n=je(a,["Apathy","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[x("Apathy",0,!0),x("Apathy",1,!0),x("Apathy",2,!0),x("Apathy",3,!0),x("Apathy",4,!0),x("Apathy",5,!0)],n=V(n,"opponent",0,x("Metal",3,!0)),n=V(n,"opponent",1,x("Death",4,!0)),n=V(n,"opponent",2,x("Fire",2,!0)),n=V(n,"opponent",0,x("Metal",1,!0)),n=V(n,"opponent",2,x("Fire",1,!1)),n=V(n,"player",2,x("Spirit",3,!0)),n=V(n,"player",1,x("Water",3,!0)),n=V(n,"player",2,x("Spirit",2,!0)),n=_e(n),ke(n)}},Im={name:"Death Test Playground",description:" All Death cards on hand for testing",setup:a=>{let n=je(a,["Death_cust","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[x("Death_cust",0,!0),x("Death_cust",1,!0),x("Death_cust",2,!0),x("Death_cust",3,!0),x("Death_cust",4,!0),x("Death_cust",5,!0)],n=V(n,"opponent",0,x("Metal",0,!0)),n=V(n,"opponent",1,x("Death",1,!0)),n=V(n,"opponent",2,x("Fire",3,!0)),n=V(n,"opponent",0,x("Metal",2,!0)),n=V(n,"opponent",1,x("Death",4,!1)),n=V(n,"player",2,x("Spirit",3,!0)),n=V(n,"player",1,x("Water",3,!0)),n=V(n,"player",2,x("Spirit",2,!0)),n=_e(n),ke(n)}},Lm={name:"Water Test Playground",description:" All Water cards on hand for testing - wash away and renew",setup:a=>{let n=je(a,["Water","Fire","Spirit"],["Metal","Death","Light"],"player","action");return n.player.hand=[x("Water",0,!0),x("Water",1,!0),x("Water",2,!0),x("Water",3,!0),x("Water",4,!0),x("Water",5,!0)],n=V(n,"opponent",0,x("Metal",2,!0)),n=V(n,"opponent",1,x("Death",3,!0)),n=V(n,"opponent",2,x("Light",2,!0)),n=V(n,"opponent",0,x("Metal",4,!0)),n=V(n,"opponent",1,x("Death",2,!1)),n=V(n,"opponent",2,x("Light",5,!1)),n=V(n,"player",1,x("Fire",2,!0)),n=V(n,"player",2,x("Spirit",3,!0)),n=V(n,"player",1,x("Fire",4,!0)),n=V(n,"player",2,x("Spirit",5,!1)),n=_e(n),ke(n)}},Mm={name:"Spirit Test Playground",description:" All Spirit cards on hand - true strength from within",setup:a=>{let n=je(a,["Spirit","Fire","Water"],["Metal","Death","Light"],"player","action");return n.player.hand=[x("Spirit",0,!0),x("Spirit",1,!0),x("Spirit",2,!0),x("Spirit",3,!0),x("Spirit",4,!0),x("Spirit",5,!0)],n=V(n,"opponent",0,x("Metal",3,!0)),n=V(n,"opponent",1,x("Death",2,!1)),n=V(n,"opponent",2,x("Light",4,!0)),n=V(n,"opponent",0,x("Metal",5,!1)),n=V(n,"opponent",2,x("Light",3,!0)),n=V(n,"player",1,x("Fire",2,!0)),n=V(n,"player",2,x("Water",4,!0)),n=V(n,"player",1,x("Fire",3,!1)),n=_e(n),ke(n)}},Pm={name:"Chaos Test Playground",description:" All Chaos cards on hand - embrace the unpredictable",setup:a=>{let n=je(a,["Chaos","Fire","Water"],["Metal","Death","Light"],"player","action");return n.player.hand=[x("Chaos",0,!0),x("Chaos",1,!0),x("Chaos",2,!0),x("Chaos",3,!0),x("Chaos",4,!0),x("Chaos",5,!0)],n=V(n,"opponent",0,x("Metal",2,!0)),n=V(n,"opponent",0,x("Metal",4,!0)),n=V(n,"opponent",1,x("Death",3,!1)),n=V(n,"opponent",1,x("Death",5,!0)),n=V(n,"opponent",2,x("Light",1,!0)),n=V(n,"opponent",2,x("Light",3,!1)),n=V(n,"player",0,x("Fire",2,!0)),n=V(n,"player",0,x("Fire",4,!0)),n=V(n,"player",1,x("Water",3,!1)),n=V(n,"player",1,x("Water",5,!0)),n=V(n,"player",2,x("Fire",1,!0)),n=_e(n),ke(n)}},Hm={name:"Gravity Test Playground",description:" All Gravity cards on hand - pull everything together",setup:a=>{let n=je(a,["Fire","Gravity","Water"],["Metal","Death","Light"],"player","action");return n.player.hand=[x("Gravity",0,!0),x("Gravity",1,!0),x("Gravity",2,!0),x("Gravity",4,!0),x("Gravity",5,!0),x("Gravity",6,!0)],n=V(n,"player",0,x("Fire",1,!0)),n=V(n,"player",2,x("Water",2,!1)),n=V(n,"opponent",0,x("Metal",3,!1)),n=V(n,"opponent",0,x("Metal",4,!0)),n=V(n,"opponent",1,x("Death",2,!1)),n=V(n,"opponent",1,x("Death",3,!0)),n=V(n,"opponent",2,x("Light",4,!1)),n.opponent.deck=[x("Metal",5,!0),x("Death",4,!0),x("Light",5,!0)],n=_e(n),ke(n)}},zm={name:"Frost Test Playground",description:" All Frost cards on hand - pull everything together",setup:a=>{let n=je(a,["Fire","Frost","Water"],["Metal","Death","Light"],"player","action");return n.player.hand=[x("Frost",0,!0),x("Frost",1,!0),x("Frost",2,!0),x("Frost",3,!0),x("Frost",4,!0),x("Frost",5,!0)],n=V(n,"player",0,x("Fire",1,!0)),n=V(n,"player",2,x("Water",2,!1)),n=V(n,"opponent",0,x("Metal",3,!1)),n=V(n,"opponent",0,x("Metal",4,!0)),n=V(n,"opponent",1,x("Death",2,!1)),n=V(n,"opponent",1,x("Death",3,!0)),n=V(n,"opponent",2,x("Light",4,!1)),n.opponent.deck=[x("Metal",5,!0),x("Death",4,!0),x("Light",5,!0)],n=_e(n),ke(n)}},Vm={name:"Hate Test Playground",description:" All Hate cards on hand - test deletion mechanics",setup:a=>{let n=je(a,["Hate","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[x("Hate",0,!0),x("Hate",1,!0),x("Hate",2,!0),x("Hate",3,!0),x("Hate",4,!0),x("Hate",5,!0)],n=V(n,"player",1,x("Water",1,!0)),n=V(n,"player",1,x("Water",2,!0)),n=V(n,"player",1,x("Water",3,!0)),n=V(n,"player",2,x("Spirit",2,!0)),n=V(n,"player",2,x("Spirit",4,!1)),n=V(n,"opponent",0,x("Metal",5,!0)),n=V(n,"opponent",1,x("Death",2,!0)),n=V(n,"opponent",1,x("Death",4,!0)),n=V(n,"opponent",2,x("Fire",3,!1)),n.player.deck=[x("Water",0,!0),x("Water",4,!0),x("Spirit",0,!0),x("Spirit",5,!0)],n.opponent.deck=[x("Metal",3,!0),x("Death",5,!0),x("Fire",1,!0)],n=_e(n),ke(n)}},Bm={name:"Life Test Playground",description:" All Life cards on hand - test play and flip mechanics",setup:a=>{let n=je(a,["Life","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[x("Life",0,!0),x("Life",1,!0),x("Life",2,!0),x("Life",3,!0),x("Life",4,!0),x("Life",5,!0)],n=V(n,"player",1,x("Water",1,!0)),n=V(n,"player",1,x("Water",2,!0)),n=V(n,"player",1,x("Water",3,!0)),n=V(n,"player",2,x("Spirit",2,!0)),n=V(n,"player",2,x("Spirit",4,!1)),n=V(n,"opponent",0,x("Metal",3,!1)),n=V(n,"opponent",1,x("Death",2,!0)),n=V(n,"opponent",1,x("Death",4,!1)),n=V(n,"opponent",2,x("Fire",5,!1)),n.player.deck=[x("Water",0,!0),x("Water",3,!0),x("Water",4,!0),x("Spirit",0,!0),x("Spirit",1,!0),x("Spirit",2,!0),x("Spirit",3,!0),x("Spirit",4,!0)],n.opponent.deck=[x("Metal",1,!0),x("Death",3,!0),x("Fire",2,!0)],n=_e(n),ke(n)}},Ym={name:"Light Test Playground",description:" All Light cards on hand - burn away the dark",setup:a=>{let n=je(a,["Light","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[x("Light",0,!0),x("Light",1,!0),x("Light",2,!0),x("Light",3,!0),x("Light",4,!0),x("Light",5,!0)],n=V(n,"opponent",0,x("Fire",3,!1)),n=V(n,"opponent",1,x("Metal",4,!1)),n=V(n,"opponent",2,x("Death",5,!0)),n=V(n,"player",1,x("Water",2,!1)),n=V(n,"player",1,x("Water",3,!1)),n=V(n,"player",1,x("Water",4,!1)),n=V(n,"player",0,x("Spirit",1,!0)),n=V(n,"player",0,x("Spirit",2,!1)),n=V(n,"player",2,x("Spirit",5,!1)),n.player.deck=[x("Water",0,!0),x("Water",1,!0),x("Spirit",0,!0),x("Spirit",3,!0),x("Spirit",4,!0)],n.opponent.hand=[x("Metal",1,!0),x("Death",2,!0),x("Fire",3,!0),x("Metal",0,!0)],n=_e(n),ke(n)}},Gm={name:"Death-2 Uncover Interrupt - Turn Wechsel Test",description:"Death-2 lscht  Darkness-4 uncovered  Opponent shiftet  Turn muss zu Opponent wechseln",setup:a=>{let n=je(a,["Death","Fire","Hate"],["Water","Darkness","Spirit"],"player","action");return n.player.hand=[x("Death",2,!0),x("Fire",1,!0),x("Hate",1,!0)],n=V(n,"player",0,x("Fire",0,!1)),n=V(n,"opponent",1,x("Darkness",4,!0)),n=V(n,"opponent",1,x("Darkness",1,!0)),n=V(n,"opponent",0,x("Water",0,!1)),n.opponent.hand=[x("Water",1,!0),x("Spirit",1,!0)],n=_e(n),ke(n)}},Wm={name:"Apathy-5 Uncover - darf nur einmal triggern",description:"Hate-0 lscht Apathy-0  Apathy-5 uncovered  darf nur 1x triggern",setup:a=>{let n=je(a,["Hate","Fire","Death"],["Apathy","Darkness","Plague"],"player","action");return n.player.hand=[x("Hate",0,!0),x("Fire",2,!0),x("Death",2,!0)],n=V(n,"opponent",0,x("Apathy",5,!0)),n=V(n,"opponent",0,x("Apathy",4,!0)),n.opponent.hand=[x("Darkness",1,!0),x("Apathy",1,!0),x("Darkness",2,!0)],n=_e(n),ke(n)}},Qm={name:"Psychic-1 facedown flip darkness 2 test",description:"Psychic-1 facedown, darkness-2 flippt Karte nur noch facedown bug",setup:a=>{let n=je(a,["Frost","Gravity","Plague"],["Psychic","Darkness","Speed"],"player","action");return n.player.hand=[x("Darkness",1,!0),x("Darkness",2,!0),x("Speed",3,!0)],n=V(n,"opponent",0,x("Frost",0,!1)),n=V(n,"opponent",1,x("Gravity",6,!1)),n=V(n,"player",0,x("Psychic",4,!1)),n=V(n,"player",1,x("Psychic",1,!1)),n.opponent.hand=[x("Gravity",1,!0)],n=_e(n),ke(n)}},Xm={name:"Speed Test Playground",description:" All Speed cards on hand - swift and adaptive",setup:a=>{let n=je(a,["Speed","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[x("Speed",0,!0),x("Speed",1,!0),x("Speed",2,!0),x("Speed",3,!0),x("Speed",4,!0),x("Speed",5,!0)],n=V(n,"player",0,x("Water",2,!0)),n=V(n,"player",1,x("Spirit",3,!0)),n=V(n,"opponent",0,x("Metal",3,!1)),n=V(n,"opponent",1,x("Death",4,!1)),n=V(n,"opponent",2,x("Fire",2,!0)),n=V(n,"player",2,x("Spirit",5,!0)),n=V(n,"player",2,x("Spirit",4,!0)),n=_e(n),ke(n)}},Zm={name:"Metal Test Playground",description:" All Metal cards on hand - unyielding defense",setup:a=>{let n=je(a,["Metal","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[x("Metal",0,!0),x("Metal",1,!0),x("Metal",2,!0),x("Metal",3,!0),x("Metal",5,!0),x("Metal",6,!0)],n=V(n,"opponent",0,x("Metal",3,!1)),n=V(n,"opponent",1,x("Death",4,!0)),n=V(n,"player",1,x("Water",3,!0)),n=V(n,"opponent",2,x("Fire",0,!0)),n=V(n,"opponent",2,x("Fire",1,!0)),n=V(n,"opponent",2,x("Fire",2,!0)),n=V(n,"opponent",2,x("Fire",3,!0)),n=V(n,"opponent",2,x("Fire",4,!0)),n=V(n,"opponent",2,x("Fire",5,!0)),n=V(n,"player",2,x("Spirit",3,!0)),n=V(n,"player",2,x("Spirit",2,!0)),n=_e(n),ke(n)}},Km={name:"Plague Test Playground",description:" All Plague cards on hand - spread suffering",setup:a=>{let n=je(a,["Plague","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[x("Plague",0,!0),x("Plague",1,!0),x("Plague",2,!0),x("Plague",3,!0),x("Plague",4,!0),x("Plague",5,!0)],n.opponent.hand=[x("Fire",2,!0),x("Death",3,!0),x("Water",1,!0)],n.player.lanes[0]=[x("Spirit",2,!0)],n.player.lanes[1]=[],n.player.lanes[2]=[],n.opponent.lanes[0]=[x("Metal",1,!0)],n.opponent.lanes[1]=[x("Death",2,!1)],n.opponent.lanes[2]=[x("Fire",3,!0)],n=_e(n),ke(n)}},Jm={name:"Love Test Playground",description:" All Love cards on hand - share the love",setup:a=>{let n=je(a,["Love","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[x("Love",1,!0),x("Love",2,!0),x("Love",3,!0),x("Love",4,!0),x("Love",5,!0),x("Love",6,!0)],n.opponent.hand=[x("Fire",2,!0),x("Death",3,!0),x("Water",1,!0),x("Metal",4,!0)],n.player.lanes[0]=[x("Spirit",2,!0)],n.player.lanes[1]=[],n.player.lanes[2]=[],n.opponent.lanes[0]=[x("Metal",1,!0)],n.opponent.lanes[1]=[x("Death",2,!1)],n.opponent.lanes[2]=[x("Fire",3,!0)],n=_e(n),ke(n)}},ey={name:"Psychic Test Playground",description:" All Psychic cards on hand - read minds and control",setup:a=>{let n=je(a,["Psychic","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[x("Psychic",0,!0),x("Psychic",1,!0),x("Psychic",2,!0),x("Psychic",3,!0),x("Psychic",4,!0),x("Psychic",5,!0)],n.opponent.hand=[x("Fire",2,!0),x("Death",3,!0),x("Water",1,!0),x("Metal",4,!0)],n.player.lanes[0]=[x("Spirit",2,!0)],n.player.lanes[1]=[],n.player.lanes[2]=[],n.opponent.lanes[0]=[x("Metal",1,!0)],n.opponent.lanes[1]=[x("Death",2,!1)],n.opponent.lanes[2]=[x("Fire",3,!0)],n=_e(n),ke(n)}},ty={name:" Gravity-2 AI Single Card Bug",description:"AI spielt Gravity-2  Flip  Shift  Turn endet (NUR 1 Karte!)",setup:a=>{let n=je(a,["Hate","Fire","Water"],["Gravity","Death","Metal"],"opponent","action");return n.opponent.hand=[x("Gravity",2,!0),x("Death",1,!0),x("Metal",3,!0)],n=V(n,"player",1,x("Hate",5,!0)),n=V(n,"player",1,x("Hate",4,!0)),n=V(n,"player",0,x("Fire",2,!0)),n=V(n,"player",2,x("Water",3,!0)),n=_e(n),ke(n)}},ny={name:"Speed-3 End-Effekt Softlock Test",description:"Speed-3 als einzige uncovered Karte sollte sich selbst im End-Effekt shiften knnen",setup:a=>{let n=je(a,["Fire","Water","Death"],["Speed","Gravity","Light"],"opponent","end");return n.player.hand=[x("Fire",1,!0),x("Water",2,!0),x("Death",0,!0)],n=V(n,"player",0,x("Fire",3,!0)),n=V(n,"player",1,x("Water",1,!0)),n=V(n,"opponent",0,x("Speed",3,!0)),n.opponent.hand=[x("Gravity",1,!0),x("Light",2,!0)],n=_e(n),ke(n)}},ay={name:"Uncover nach Delete All in Lane Test",description:"Death-2 lscht alle 1/2er  Karte darunter wird uncovered  Effekt triggert",setup:a=>{let n=je(a,["Death","Fire","Water"],["Fire","Spirit","Light"],"player","action");return n.player.hand=[x("Death",2,!0),x("Fire",3,!0),x("Water",4,!0)],n=V(n,"opponent",0,x("Fire",5,!0)),n=V(n,"opponent",0,x("Fire",2,!0)),n=V(n,"player",0,x("Fire",4,!0)),n=V(n,"player",1,x("Water",3,!0)),n=V(n,"opponent",1,x("Spirit",2,!0)),n=_e(n),ke(n)}},oy={name:"Mehrfach-Uncover nach Delete All Test",description:"Death-2 lscht bei beiden Spielern  beide Karten darunter werden uncovered",setup:a=>{let n=je(a,["Death","Water","Spirit"],["Fire","Light","Gravity"],"player","action");return n.player.hand=[x("Death",2,!0),x("Spirit",3,!0)],n.opponent.hand=[x("Fire",3,!0),x("Light",5,!0)],n=V(n,"player",0,x("Water",5,!0)),n=V(n,"player",0,x("Water",1,!0)),n=V(n,"opponent",0,x("Fire",5,!0)),n=V(n,"opponent",0,x("Fire",2,!0)),n=_e(n),ke(n)}},ry={name:"Life-1 Uncover  Double Flip Bug",description:"Death-1 Start lscht  Life-1 uncovered  BEIDE Flips mssen ausgefhrt werden",setup:a=>{let n=je(a,["Death","Fire","Water"],["Life","Metal","Spirit"],"player","start");return n.player.hand=[x("Fire",2,!0)],n.opponent.hand=[x("Metal",3,!0),x("Spirit",2,!0)],n=V(n,"player",0,x("Death",1,!0)),n=V(n,"opponent",0,x("Life",1,!0)),n=V(n,"opponent",0,x("Metal",0,!0)),n=V(n,"player",1,x("Water",1,!0)),n=V(n,"opponent",1,x("Metal",1,!0)),n=V(n,"opponent",2,x("Spirit",0,!0)),n=_e(n),ke(n)}},ly={name:"Smoke Test Playground",description:" All Smoke cards on hand - shroud your cards in mystery",setup:a=>{let n=je(a,["Smoke","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[x("Smoke",0,!0),x("Smoke",1,!0),x("Smoke",2,!0),x("Smoke",3,!0),x("Smoke",4,!0),x("Smoke",5,!0)],n=V(n,"player",0,x("Water",2,!1)),n=V(n,"opponent",1,x("Metal",3,!1)),n=V(n,"opponent",1,x("Death",2,!0)),n=V(n,"opponent",2,x("Fire",2,!0)),n=V(n,"player",2,x("Spirit",3,!0)),n=V(n,"player",1,x("Spirit",4,!0)),n=_e(n),ke(n)}},iy={name:"Smoke AI Test",description:" AI spielt Smoke Karten - test all Smoke card effects with AI",setup:a=>{let n=je(a,["Water","Spirit","Light"],["Smoke","Metal","Death"],"opponent","action");return n.opponent.hand=[x("Smoke",0,!0),x("Smoke",1,!0),x("Smoke",2,!0),x("Smoke",3,!0),x("Smoke",4,!0),x("Smoke",5,!0)],n=V(n,"opponent",0,x("Metal",2,!1)),n=V(n,"player",0,x("Water",3,!0)),n=V(n,"player",1,x("Spirit",2,!1)),n=V(n,"player",1,x("Spirit",4,!0)),n=V(n,"opponent",2,x("Death",3,!0)),n=V(n,"player",2,x("Light",2,!0)),n=V(n,"opponent",1,x("Metal",4,!0)),n=_e(n),ke(n)}},cy={name:"Clarity Test Playground",description:"All Clarity cards on hand - see through the fog of war",setup:a=>{let n=je(a,["Clarity","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[x("Clarity",0,!0),x("Clarity",1,!0),x("Clarity",2,!0),x("Clarity",3,!0),x("Clarity",4,!0),x("Clarity",5,!0)],n.player.deck=[x("Clarity",1,!0),x("Water",1,!0),x("Spirit",5,!0),x("Spirit",3,!0),x("Water",2,!0),x("Fire",4,!0)],n.player.discard=[x("Water",4,!0),x("Spirit",1,!0)],n=V(n,"player",0,x("Water",2,!0)),n.opponent.hand=[x("Metal",3,!0),x("Death",2,!0),x("Fire",4,!0)],n=V(n,"opponent",1,x("Metal",3,!0)),n=V(n,"opponent",2,x("Fire",2,!0)),n=_e(n),ke(n)}},sy={name:"Clarity AI Test",description:"AI spielt Clarity Karten - test all Clarity card effects with AI",setup:a=>{let n=je(a,["Water","Spirit","Light"],["Clarity","Metal","Death"],"opponent","action");return n.opponent.hand=[x("Clarity",0,!0),x("Clarity",1,!0),x("Clarity",2,!0),x("Clarity",3,!0),x("Clarity",4,!0),x("Clarity",5,!0)],n.opponent.deck=[x("Clarity",1,!0),x("Metal",1,!0),x("Death",5,!0),x("Death",3,!0),x("Metal",2,!0)],n.opponent.discard=[x("Metal",4,!0),x("Death",2,!0)],n.player.hand=[x("Water",3,!0),x("Spirit",2,!0),x("Light",4,!0)],n=V(n,"player",0,x("Water",3,!0)),n=V(n,"opponent",0,x("Metal",2,!0)),n=V(n,"player",1,x("Spirit",4,!0)),n=V(n,"opponent",2,x("Death",3,!0)),n=_e(n),ke(n)}},dy={name:"Courage Custom Playground",description:"Test all Courage effects: empty hand draw, opponent higher value delete, conditional draw/flip, highest value shift",setup:a=>{let c=je(a,["Courage","Fire","Speed"],["Spirit","Water","Darkness"],"player","action");return c.player.hand=[x("Courage",0,!0),x("Courage",1,!0),x("Courage",2,!0),x("Courage",3,!0),x("Courage",5,!0),x("Courage",6,!0)],c=V(c,"opponent",0,x("Spirit",3,!0)),c=V(c,"opponent",0,x("Spirit",5,!0)),c=V(c,"player",0,x("Fire",3,!0)),c=V(c,"opponent",1,x("Water",6,!0)),c=V(c,"player",1,x("Speed",4,!0)),c=V(c,"opponent",2,x("Darkness",2,!0)),c=V(c,"player",2,x("Fire",5,!0)),ke(c)}},uy={name:"Courage AI Test",description:"Test AI with Courage protocol: lane-restricted delete, self-shift to highest value lane",setup:a=>{let c=je(a,["Spirit","Water","Fire"],["Courage","Speed","Darkness"],"opponent","action");return c.opponent.hand=[x("Courage",0,!0),x("Courage",1,!0),x("Courage",2,!0),x("Courage",3,!0),x("Courage",5,!0),x("Courage",6,!0)],c=V(c,"player",0,x("Spirit",5,!0)),c=V(c,"player",0,x("Spirit",5,!0)),c=V(c,"opponent",0,x("Speed",3,!0)),c=V(c,"player",1,x("Water",6,!0)),c=V(c,"opponent",1,x("Darkness",2,!0)),c=V(c,"opponent",1,x("Darkness",2,!1)),c=V(c,"player",2,x("Fire",3,!0)),c=V(c,"opponent",2,x("Speed",5,!0)),ke(c)}},py={name:"Corruption Test Playground",description:" All Corruption cards on hand - corrupt your opponent's plans",setup:a=>{let n=je(a,["Corruption","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[x("Corruption",0,!0),x("Corruption",1,!0),x("Corruption",2,!0),x("Corruption",3,!0),x("Corruption",5,!0),x("Corruption",6,!0)],n=V(n,"player",0,x("Water",2,!0)),n=V(n,"opponent",0,x("Metal",3,!0)),n=V(n,"opponent",1,x("Death",4,!0)),n=V(n,"opponent",2,x("Fire",2,!0)),n=V(n,"player",1,x("Spirit",3,!0)),n=V(n,"player",1,x("Spirit",5,!0)),n.opponent.hand=[x("Fire",3,!0),x("Metal",4,!0),x("Death",5,!0)],n=_e(n),ke(n)}},fy={name:"Fear Custom Playground",description:"Test all Fear effects: passive ignore middle, choice shift/flip, chain discard, return, random discard",setup:a=>{let c=je(a,["Fear","Fire","Speed"],["Spirit","Water","Darkness"],"player","action");return c.player.hand=[x("Fear",0,!0),x("Fear",1,!0),x("Fear",2,!0),x("Fear",3,!0),x("Fear",4,!0),x("Fear",5,!0)],c=V(c,"opponent",0,x("Spirit",2,!0)),c=V(c,"opponent",0,x("Spirit",3,!0)),c=V(c,"player",0,x("Fire",3,!0)),c=V(c,"opponent",1,x("Water",4,!0)),c=V(c,"player",1,x("Speed",4,!0)),c=V(c,"opponent",2,x("Darkness",2,!1)),c=V(c,"player",2,x("Fire",5,!0)),c.opponent.hand=[x("Spirit",1,!0),x("Water",2,!0),x("Darkness",3,!0),x("Spirit",4,!0)],ke(c)}},hy={name:"Fear AI Test",description:"Test AI with Fear protocol: random discard execution, passive rule handling",setup:a=>{let c=je(a,["Spirit","Water","Fire"],["Fear","Speed","Darkness"],"opponent","action");return c.opponent.hand=[x("Fear",0,!0),x("Fear",1,!0),x("Fear",2,!0),x("Fear",3,!0),x("Fear",4,!0),x("Fear",5,!0)],c=V(c,"player",0,x("Spirit",3,!0)),c=V(c,"player",0,x("Spirit",5,!0)),c=V(c,"opponent",0,x("Speed",3,!0)),c=V(c,"player",1,x("Water",2,!0)),c=V(c,"player",1,x("Water",4,!0)),c=V(c,"player",2,x("Fire",3,!0)),c=V(c,"opponent",2,x("Darkness",5,!0)),c.player.hand=[x("Spirit",1,!0),x("Water",3,!0),x("Fire",4,!0)],ke(c)}},my={name:"Ice Custom Playground",description:" Test all Ice effects: conditional shift, flip block, draw block, lane-reactive discard",setup:a=>{let c=je(a,["Ice","Fire","Speed"],["Spirit","Water","Darkness"],"player","action");return c.player.hand=[x("Ice",1,!0),x("Ice",2,!0),x("Ice",3,!0),x("Ice",4,!0),x("Ice",5,!0),x("Ice",6,!0),x("Fire",0,!0)],c=V(c,"player",0,x("Fire",3,!0)),c=V(c,"player",0,x("Fire",5,!0)),c=V(c,"opponent",1,x("Water",4,!0)),c=V(c,"player",1,x("Speed",4,!0)),c=V(c,"opponent",2,x("Darkness",2,!0)),c=V(c,"player",2,x("Fire",5,!0)),c.opponent.hand=[x("Spirit",1,!0),x("Water",2,!0),x("Darkness",3,!0)],ke(c)}},yy={name:"Ice AI Test",description:" Test AI with Ice protocol: shift self, shift others, passive rules",setup:a=>{let c=je(a,["Spirit","Water","Fire"],["Ice","Speed","Darkness"],"opponent","action");return c.opponent.hand=[x("Ice",1,!0),x("Ice",2,!0),x("Ice",3,!0),x("Ice",4,!0),x("Ice",5,!0),x("Ice",6,!0)],c=V(c,"player",0,x("Spirit",3,!0)),c=V(c,"player",0,x("Spirit",5,!0)),c=V(c,"opponent",0,x("Speed",3,!0)),c=V(c,"opponent",1,x("Darkness",2,!0)),c=V(c,"opponent",1,x("Darkness",4,!0)),c=V(c,"player",1,x("Water",4,!0)),c=V(c,"player",2,x("Fire",3,!0)),c=V(c,"opponent",2,x("Speed",5,!0)),c.player.hand=[x("Spirit",1,!0),x("Water",3,!0),x("Fire",4,!0)],ke(c)}},gy={name:"End Phase Test",description:"Test the game rule for the end or start phase, only 1 trigger",setup:a=>{let c=je(a,["Light","Fire","Speed"],["Spirit","Water","Darkness"],"player","action");return c.player.hand=[x("Light",5,!0),x("Fire",0,!0)],c=V(c,"player",0,x("Light",1,!0)),c=V(c,"player",0,x("Light",2,!0)),c=V(c,"player",1,x("Fire",3,!0)),c=V(c,"player",2,x("Speed",3,!0)),c.opponent.hand=[x("Spirit",1,!0),x("Water",2,!0),x("Darkness",3,!0)],ke(c)}},vy={name:"Start Phase Test",description:"Test the game rule for the end or start phase, only 1 trigger",setup:a=>{let c=je(a,["Spirit","Death","Psychic"],["Light","Water","Darkness"],"player","action");return c.player.hand=[x("Spirit",5,!0),x("Death",0,!0)],c=V(c,"player",0,x("Spirit",1,!0)),c=V(c,"player",0,x("Spirit",2,!0)),c=V(c,"player",1,x("Death",1,!0)),c=V(c,"player",1,x("Spirit",3,!0)),c=V(c,"player",2,x("Psychic",1,!0)),c.opponent.hand=[x("Light",1,!0),x("Water",2,!0),x("Darkness",3,!0)],ke(c)}},_y={name:"Committed Card Test",description:"Committed Card Test",setup:a=>{let c=je(a,["Spirit","Darkness","Psychic"],["Light","Water","Fire"],"player","action");return c.player.hand=[x("Darkness",0,!0),x("Death",0,!0)],c=V(c,"player",0,x("Spirit",0,!0)),c=V(c,"player",0,x("Spirit",3,!0)),c=V(c,"opponent",0,x("Light",1,!0)),c=V(c,"opponent",0,x("Light",2,!0)),c.opponent.hand=[x("Light",5,!0),x("Water",2,!0),x("Darkness",3,!0)],ke(c)}},xy=[fm,hm,mm,ym,gm,vm,_m,xm,wm,Cm,bm,Sm,Em,jm,km,Rm,Am,Tm,Dm,Nm,Fm,$0,U0,O0,I0,L0,M0,qm,$m,Um,Om,Im,Lm,Mm,Pm,Hm,zm,Vm,Bm,Ym,Gm,Wm,Qm,Xm,Zm,Km,Jm,ey,ty,ny,ay,oy,ry,ly,iy,cy,sy,py,dy,uy,fy,hy,my,yy,gy,vy,_y],P0=Object.freeze(Object.defineProperty({__proto__:null,allScenarios:xy,scenario10_Hate1Interrupt:xm,scenario11_Darkness1HateChain:wm,scenario12_Water4TurnEnd:Cm,scenario13_Psychic3ShiftTest:bm,scenario14_Death1UncoverTest:Sm,scenario15_Gravity2ShiftInterrupt:Em,scenario16_Hate2PlayerPlays:jm,scenario171_Hate2AIPlays:Rm,scenario17_Hate2AIPlays:km,scenario18_Hate2SelfDelete:Am,scenario19_Hate2MultipleTies:Tm,scenario1_Psychic3Uncover:fm,scenario20_Hate2FaceDown:Dm,scenario21_Hate2AIValidation:Nm,scenario22_Hate2AIPlaysOpen:Fm,scenario29_FireCustomConditional:qm,scenario2_Psychic4EndEffect:hm,scenario30_AnarchyCustomPlayground:$m,scenario31_DarkCustPlayground:Um,scenario32_ApathyCustomPlayground:Om,scenario33_DeathCustomPlayground:Im,scenario34_WaterCustomPlayground:Lm,scenario35_SpiritCustomPlayground:Mm,scenario36_ChaosCustomPlayground:Pm,scenario37_GravityCustomPlayground:Hm,scenario38_FrostCustomPlayground:zm,scenario39_HateCustomPlayground:Vm,scenario3_Spirit3EndPhase:mm,scenario40_LifeCustomPlayground:Bm,scenario41_LightCustomPlayground:Ym,scenario42_Death2UncoverInterruptTurn:Gm,scenario43_Apathy5DoubleUncover:Wm,scenario44_Psychic1Darkness2Test:Qm,scenario45_SpeedCustomPlayground:Xm,scenario46_MetalCustomPlayground:Zm,scenario47_PlagueCustomPlayground:Km,scenario48_LoveCustomPlayground:Jm,scenario49_PsychicCustomPlayground:ey,scenario4_Plague2Actor:ym,scenario50_Gravity2SingleCardBug:ty,scenario51_Speed3EndEffectSoftlock:ny,scenario52_UncoverAfterBulkDelete:ay,scenario53_MultiUncoverAfterBulkDelete:oy,scenario54_Life1UncoverDoubleFlip:ry,scenario55_SmokeCustomPlayground:ly,scenario56_SmokeAITest:iy,scenario57_ClarityCustomPlayground:cy,scenario58_ClarityAITest:sy,scenario59_CorruptionCustomPlayground:py,scenario5_Darkness1Interrupt:gm,scenario60_CourageCustomPlayground:dy,scenario61_CourageAITest:uy,scenario62_FearCustomPlayground:fy,scenario63_FearAITest:hy,scenario64_IceCustomPlayground:my,scenario65_IceAITest:yy,scenario66_endPhasePlayground:gy,scenario67_startPhasePlayground:vy,scenario68_CommittedCardPlayground:_y,scenario8_Plague4Owner:vm,scenario9_Water:_m},Symbol.toStringTag,{value:"Module"})),H0=({onLoadScenario:a,onSkipCoinFlip:n,onForceWin:l,onForceLose:c})=>{const[s,d]=re.useState(!1);return s?r.jsxs("div",{style:{position:"fixed",top:"20px",left:"20px",width:"400px",maxHeight:"600px",backgroundColor:"#2c2c2c",border:"2px solid #ff6b6b",borderRadius:"8px",padding:"20px",zIndex:9999,overflowY:"auto",color:"white",fontFamily:"monospace"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"20px"},children:[r.jsx("h3",{style:{margin:0},children:" Debug Panel"}),r.jsx("button",{onClick:()=>d(!1),style:{backgroundColor:"transparent",border:"none",color:"white",cursor:"pointer",fontSize:"20px"},children:""})]}),r.jsx("div",{style:{marginBottom:"15px",fontSize:"12px",color:"#aaa"},children:"Lade vordefinierte Test-Szenarien zum Testen der Actor/Owner-Fixes."}),r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:xy.map((p,f)=>r.jsxs("div",{style:{backgroundColor:"#1a1a1a",padding:"12px",borderRadius:"5px",border:"1px solid #444"},children:[r.jsx("div",{style:{fontWeight:"bold",marginBottom:"5px",color:"#4ecdc4"},children:p.name}),r.jsx("div",{style:{fontSize:"11px",color:"#bbb",marginBottom:"10px"},children:p.description}),r.jsx("button",{onClick:()=>{n&&n(),a(p.setup),d(!1)},style:{padding:"6px 12px",backgroundColor:"#4ecdc4",color:"#1a1a1a",border:"none",borderRadius:"3px",cursor:"pointer",fontWeight:"bold",fontSize:"12px"},children:"Load Scenario"})]},f))}),(l||c)&&r.jsxs("div",{style:{marginTop:"20px",paddingTop:"15px",borderTop:"1px solid #444",display:"flex",gap:"10px",justifyContent:"center"},children:[l&&r.jsx("button",{onClick:()=>{l(),d(!1)},style:{padding:"10px 20px",backgroundColor:"#4ecdc4",color:"#1a1a1a",border:"none",borderRadius:"5px",cursor:"pointer",fontWeight:"bold",fontSize:"14px"},children:" Force Win"}),c&&r.jsx("button",{onClick:()=>{c(),d(!1)},style:{padding:"10px 20px",backgroundColor:"#ff6b6b",color:"white",border:"none",borderRadius:"5px",cursor:"pointer",fontWeight:"bold",fontSize:"14px"},children:" Force Lose"})]}),r.jsx("div",{style:{marginTop:"20px",fontSize:"11px",color:"#666",textAlign:"center"},children:"Drcke ESC oder klicke  zum Schlieen"})]}):r.jsx("button",{onClick:()=>d(!0),style:{position:"fixed",top:"20px",left:"20px",padding:"10px 20px",backgroundColor:"#ff6b6b",color:"white",border:"none",borderRadius:"5px",cursor:"pointer",fontWeight:"bold",zIndex:9999,fontSize:"14px"},children:" DEBUG"})},Ph=(a,n)=>{if(!n)return null;for(const l of["player","opponent"])for(const c of a[l].lanes){const s=c.find(d=>d.id===n);if(s)return{card:s,owner:l}}return null},z0=new Set(["discard","select_card_from_hand_to_play","select_card_from_hand_to_give","select_card_from_hand_to_reveal","plague_2_player_discard","select_cards_from_hand_to_discard_for_fire_4","select_cards_from_hand_to_discard_for_hate_1"]);function V0({onBack:a,onEndGame:n,playerProtocols:l,opponentProtocols:c,difficulty:s,useControlMechanic:d,startingPlayer:p="player"}){var Ue,De,Pe,tt,Ye,Fe,ot,Zt;const[f,h]=re.useState(null),[m,g]=re.useState(!0),{startGame:y,endGame:w,trackPlayerCoinFlip:_,trackPlayerRearrange:b}=q0(l,s,d),k=re.useCallback((fe,xe,Ee)=>{h(fe),g(!1),_(xe,Ee)},[_]),S=re.useCallback(()=>{h("player"),g(!1),y()},[y]);re.useEffect(()=>{!m&&f&&y()},[m,f,y]);const $=re.useCallback((fe,xe)=>{const Ee=xe.player.compiled.filter(Ke=>Ke).length;w(fe,xe.stats.player,Ee),n(fe,xe)},[w,n]),{gameState:E,selectedCard:C,setSelectedCard:N,playSelectedCard:T,fillHand:H,discardCardFromHand:q,compileLane:B,resolveActionWithCard:K,resolveActionWithLane:U,selectHandCardForAction:R,resolveActionWithHandCard:j,skipAction:F,resolveOptionalDrawPrompt:M,resolveDeath1Prompt:L,resolveLove1Prompt:D,resolvePlague2Discard:O,resolvePlague4Flip:X,resolveFire3Prompt:ne,resolveOptionalDiscardCustomPrompt:z,resolveOptionalEffectPrompt:G,resolveFire4Discard:Z,resolveHate1Discard:Q,resolveLight2Prompt:I,resolveRevealBoardCardPrompt:W,resolveRearrangeProtocols:Y,resolveSpirit1Prompt:de,resolveSpirit3Prompt:ee,resolveSwapProtocols:ge,resolveSpeed3Prompt:Se,resolvePsychic4Prompt:ye,resolveControlMechanicPrompt:Ne,resolveCustomChoice:Le,resolveSelectRevealedDeckCard:Je,setupTestScenario:at}=i0(l,c,$,s,d,f??"player",b),[we,Ce]=re.useState(null),[Ie,ze]=re.useState([]),[wt,Qe]=re.useState(!1),[Mt,rn]=re.useState([]),Hn=re.useRef(E.log.length),[ga,qn]=re.useState(!1),[$t,Xt]=re.useState(!1),[At,va]=re.useState(null),[Fo,eo]=re.useState(!1),[Xn,$n]=re.useState(0),Ut=re.useRef(null),ln=re.useRef(E);re.useEffect(()=>{ln.current=E},[E]);const zn=()=>{const fe=Xn+1;if($n(fe),fe>=5){eo(xe=>!xe),$n(0),Ut.current&&(clearTimeout(Ut.current),Ut.current=null);return}Ut.current&&clearTimeout(Ut.current),Ut.current=setTimeout(()=>{$n(0),Ut.current=null},2e3)},qo=re.useCallback(()=>{console.log("Debug: Forcing player win via DebugPanel."),$("player",E)},[$,E]),to=re.useCallback(()=>{console.log("Debug: Forcing player loss via DebugPanel."),$("opponent",E)},[$,E]),no=re.useMemo(()=>{if(E.lastPlayedCardId){const fe=Ph(E,E.lastPlayedCardId);if(fe){const xe=fe.owner==="player"||fe.card.isFaceUp;return{card:fe.card,showContents:xe}}}return null},[E.lastPlayedCardId,E.player.lanes,E.opponent.lanes]),_a=re.useMemo(()=>{var xe;const fe=(xe=E.actionRequired)==null?void 0:xe.sourceCardId;if(fe){const Ee=Ph(E,fe);if(Ee){const Ke=Ee.owner==="player"||Ee.card.isFaceUp;return{card:Ee.card,showContents:Ke}}}return null},[(Ue=E.actionRequired)==null?void 0:Ue.sourceCardId,E.player.lanes,E.opponent.lanes]);re.useEffect(()=>{var fe;(fe=E.actionRequired)!=null&&fe.sourceCardId&&Ce(null)},[(De=E.actionRequired)==null?void 0:De.sourceCardId]);const Un=we||_a||no;re.useEffect(()=>{E.log.length>Hn.current&&E.log.slice(Hn.current).forEach(xe=>{if(xe.message!=="Game Started."){const Ee={message:xe.message,player:xe.player,id:Be()};rn(Ke=>[...Ke,Ee]),setTimeout(()=>{rn(Ke=>Ke.filter(Et=>Et.id!==Ee.id))},5e3)}}),Hn.current=E.log.length},[E.log]),re.useEffect(()=>{var xe,Ee,Ke,Et,_n;!(((xe=E.actionRequired)==null?void 0:xe.type)==="discard"&&((Ee=E.actionRequired)==null?void 0:Ee.variableCount))&&((Ke=E.actionRequired)==null?void 0:Ke.type)!=="plague_2_player_discard"&&((Et=E.actionRequired)==null?void 0:Et.type)!=="select_cards_from_hand_to_discard_for_fire_4"&&((_n=E.actionRequired)==null?void 0:_n.type)!=="select_cards_from_hand_to_discard_for_hate_1"&&ze([])},[E.actionRequired]),re.useEffect(()=>{var fe,xe;qn(((fe=E.actionRequired)==null?void 0:fe.type)==="prompt_rearrange_protocols"&&E.actionRequired.actor==="player"),Xt(((xe=E.actionRequired)==null?void 0:xe.type)==="prompt_swap_protocols"&&E.actionRequired.actor==="player")},[E.actionRequired]),re.useEffect(()=>{const fe=xe=>{xe.ctrlKey&&xe.shiftKey&&(xe.preventDefault(),xe.key.toLowerCase()==="d"?(console.log("Debug: Toggling debug button visibility."),eo(Ee=>!Ee)):xe.key.toLowerCase()==="w"?(console.log("Debug: Forcing player win."),n("player",E)):xe.key.toLowerCase()==="o"?(console.log("Debug: Forcing opponent win."),n("opponent",E)):xe.key.toLowerCase()==="p"?(console.log("Debug: Setting up Speed-0 interrupt scenario."),at("speed-0-interrupt")):xe.key.toLowerCase()==="l"?(console.log("Debug: Setting up Speed-1 discard trigger scenario."),at("speed-1-trigger")):xe.key.toLowerCase()==="f"?(console.log("Debug: Setting up Fire On-Cover test scenario."),at("fire-oncover-test")):xe.key.toLowerCase()==="s"?(console.log("Debug: Setting up Speed-2 + Control test scenario."),at("speed-2-control-test")):xe.key.toLowerCase()==="u"&&(console.log("Debug: Setting up Death-1 Uncover test scenario."),o_(()=>Promise.resolve().then(()=>P0),void 0).then(Ee=>{at(Ee.scenario14_Death1UncoverTest.setup)})))};return window.addEventListener("keydown",fe),()=>{window.removeEventListener("keydown",fe)}},[E,n,at]);const xa=(fe,xe)=>{const Ee=ln.current;if(Ee.animationState)return;const{actionRequired:Ke,turn:Et,phase:_n,compilableLanes:io,player:xn,opponent:Zn}=Ee;if(xe==="player"&&Et==="player"&&_n==="compile"&&io.includes(fe)){if(Ke){console.warn("Compile click blocked by pending action:",Ke);return}B(fe);return}if(Ke&&Ke.actor==="player"&&["select_lane_for_shift","select_lane_for_shift_all","shift_flipped_card_optional","select_lane_for_play","select_lane_for_delete","select_lane_for_death_2","select_lane_for_life_3_play","select_lane_to_shift_revealed_card_for_light_2","select_lane_to_shift_revealed_board_card_custom","select_lane_to_shift_cards_for_light_3","select_lane_for_water_3","select_lane_for_metal_3_delete","select_lane_for_delete_all","select_lane_for_return"].includes(Ke.type)){U(fe);return}const Kn=Zn.lanes.flat().some(Wt=>Wt.isFaceUp&&Wt.protocol==="Psychic"&&Wt.value===1),wn=Zn.lanes[fe],On=wn.length>0&&wn[wn.length-1].isFaceUp&&wn[wn.length-1].protocol==="Plague"&&wn[wn.length-1].value===0;if(C&&_n==="action"&&!Ke&&xn.hand.some(Wt=>Wt.id===C)&&!On){const Wt=xn.hand.find(Bt=>Bt.id===C);if(xe==="opponent"){if(!Rl(Ee,Wt)){N(null),Ce(null);return}if(Kn){N(null),Ce(null);return}T(fe,!0,"opponent"),Ce(null);return}const ba=xn.lanes.flat().some(Bt=>Bt.isFaceUp&&Bt.protocol==="Spirit"&&Bt.value===1),Er=xn.lanes.some((Bt,kr)=>{if(Bt.length===0)return!1;const $o=Bt[Bt.length-1];return $o.isFaceUp&&$o.protocol==="Chaos"&&$o.value===3}),jr=[...xn.lanes.flat(),...Zn.lanes.flat()].some(Bt=>Bt.isFaceUp&&Bt.protocol==="Anarchy"&&Bt.value===1),ec=Ki(Ee),Fl=Ji(Ee,"player",fe),Kt=Rl(Ee,Wt);let co;Kt?co=!Kn:jr||ec?co=Wt.protocol!==xn.protocols[fe]&&Wt.protocol!==Zn.protocols[fe]&&!Kn:co=(ba||Fl||Er||Wt.protocol===xn.protocols[fe]||Wt.protocol===Zn.protocols[fe])&&!Kn,T(fe,co),Ce(null);return}C&&(N(null),Ce(null))},ao=fe=>{const xe=ln.current;if(xe.animationState||!C)return;const{phase:Ee,actionRequired:Ke,player:Et}=xe;Ee!=="action"||Ke||!Et.hand.some(_n=>_n.id===C)||(T(fe,!1),Ce(null))},oo=fe=>{const xe=ln.current;if(!xe.animationState){if(xe.actionRequired){if(xe.actionRequired.type==="discard"&&xe.actionRequired.actor==="player")if(xe.actionRequired.variableCount){ze(Ee=>Ee.includes(fe.id)?Ee.filter(Ke=>Ke!==fe.id):[...Ee,fe.id]);return}else{q(fe.id);return}if(xe.actionRequired.type==="select_card_from_hand_to_play"){R(fe.id);return}if(xe.actionRequired.type==="select_card_from_hand_to_give"||xe.actionRequired.type==="select_card_from_hand_to_reveal"){j(fe.id);return}if(xe.actionRequired.type==="plague_2_player_discard"||xe.actionRequired.type==="select_cards_from_hand_to_discard_for_fire_4"||xe.actionRequired.type==="select_cards_from_hand_to_discard_for_hate_1"){ze(Ee=>Ee.includes(fe.id)?Ee.filter(Ke=>Ke!==fe.id):[...Ee,fe.id]);return}return}xe.turn!=="player"||xe.phase!=="action"&&xe.phase!=="compile"||(fe.id===C?(N(null),Ce(null)):(N(fe.id),Ce({card:fe,showContents:!0})))}},wa=(fe,xe,Ee)=>{const Ke=ln.current;if(Ke.animationState)return;const{actionRequired:Et,turn:_n,phase:io,compilableLanes:xn}=Ke;if(_n==="player"&&io==="compile"&&xn.includes(Ee)){xa(Ee,xe);return}if(_n==="player"&&!Et&&C&&io==="action"){xa(Ee,xe);return}if(Et&&Et.actor==="player"&&(Et.type==="select_own_highest_card_to_delete_for_hate_2"||Et.type==="select_opponent_highest_card_to_delete_for_hate_2")&&Xi(fe,Ke)){K(fe.id);return}if(Xi(fe,Ke))K(fe.id);else if(C)N(null),Ce(null);else{const Zn=xe==="player"||fe.isFaceUp;Ce({card:fe,showContents:Zn})}},Ca=fe=>{C||Ce({card:fe,showContents:!0})},ro=(fe,xe)=>{if(!C){const Ee=xe==="player"||fe.isFaceUp;Ce({card:fe,showContents:Ee})}},lo=()=>{C||Ce(null)},cn=fe=>{!C&&!E.actionRequired&&Ce({card:fe,showContents:fe.isRevealed||!1})},St=()=>{if(!Un)return null;const{card:fe,showContents:xe}=Un;return r.jsx(vt,{card:fe,isFaceUp:xe})},Nt=E.turn==="player"&&!E.actionRequired&&E.phase==="compile"&&E.compilableLanes.length>0,ue=((Pe=E.actionRequired)==null?void 0:Pe.sourceCardId)??null,be=re.useMemo(()=>{var fe;return(fe=E.actionRequired)!=null&&fe.actor?E.actionRequired.actor==="player"?"action-required-player":"action-required-opponent":""},[E.actionRequired]),Ae=re.useMemo(()=>{const fe=E.actionRequired;return fe&&fe.actor==="player"?z0.has(fe.type)?"":"hand-in-background":""},[E.actionRequired]);return r.jsxs("div",{className:"screen game-screen",children:[At&&r.jsx(x0,{player:At,playerState:E[At],onClose:()=>va(null),difficulty:s}),ga&&((tt=E.actionRequired)==null?void 0:tt.type)==="prompt_rearrange_protocols"&&r.jsx(y0,{gameState:E,targetPlayer:E.actionRequired.target,onConfirm:fe=>{var xe,Ee;((xe=E.actionRequired)==null?void 0:xe.sourceCardId)==="CONTROL_MECHANIC"&&((Ee=E.actionRequired)!=null&&Ee.actor)&&b(E.actionRequired.actor),Y(fe),qn(!1)}}),$t&&((Ye=E.actionRequired)==null?void 0:Ye.type)==="prompt_swap_protocols"&&r.jsx(g0,{gameState:E,targetPlayer:E.actionRequired.target,onConfirm:fe=>{ge(fe),Xt(!1)}}),((Fe=E.actionRequired)==null?void 0:Fe.type)==="select_card_from_revealed_deck"&&E.actionRequired.actor==="player"&&r.jsx(v0,{gameState:E,onSelectCard:fe=>{Je(fe)}}),((ot=E.actionRequired)==null?void 0:ot.type)==="prompt_optional_effect"&&E.actionRequired.actor==="player"&&r.jsx(_0,{gameState:E,onAccept:()=>G(!0),onDecline:()=>G(!1)}),r.jsx("div",{className:"toaster-container",children:Mt.map(fe=>r.jsx(m0,{message:fe.message,player:fe.player},fe.id))}),wt&&r.jsx(h0,{log:E.log,onClose:()=>Qe(!1)}),r.jsx("button",{className:"btn log-button",onClick:()=>Qe(!0),children:"Log"}),r.jsxs("div",{className:"game-screen-layout",children:[r.jsxs("div",{className:"game-preview-container",children:[r.jsx("h2",{onClick:zn,style:{cursor:"pointer",userSelect:"none"},title:"Click 5 times to toggle debug mode",children:"Mainframe"}),r.jsx(u0,{gameState:E,turn:((Zt=E.actionRequired)==null?void 0:Zt.actor)||E.turn,animationState:E.animationState,difficulty:s,onPlayerClick:()=>va("player"),onOpponentClick:()=>va("opponent")}),r.jsx("div",{className:"preview-card-area",children:St()}),r.jsx("button",{className:"btn btn-back",onClick:a,children:"Back"})]}),r.jsxs("div",{className:"game-main-area",children:[Nt&&r.jsx("div",{className:"compile-prompt-container",children:r.jsx("h3",{children:"Select a Protocol to Compile"})}),r.jsx(c0,{gameState:E,onLanePointerDown:xa,onPlayFaceDown:ao,selectedCardId:C,onCardPointerDown:wa,onCardPointerEnter:ro,onCardPointerLeave:lo,onOpponentHandCardPointerEnter:cn,onOpponentHandCardPointerLeave:lo,sourceCardId:ue}),r.jsxs("div",{className:"player-action-area",children:[r.jsx(s0,{gameState:E,onFillHand:H,onSkipAction:F,onResolveOptionalDrawPrompt:M,onResolveDeath1Prompt:L,onResolveLove1Prompt:D,onResolvePlague2Discard:O,onResolvePlague4Flip:X,onResolveFire3Prompt:ne,onResolveOptionalDiscardCustomPrompt:z,onResolveOptionalEffectPrompt:G,onResolveSpeed3Prompt:Se,onResolveFire4Discard:Z,onResolveHate1Discard:Q,onResolveLight2Prompt:I,onResolveRevealBoardCardPrompt:W,onResolvePsychic4Prompt:ye,onResolveSpirit1Prompt:de,onResolveSpirit3Prompt:ee,onResolveControlMechanicPrompt:Ne,onResolveCustomChoice:Le,selectedCardId:C,multiSelectedCardIds:Ie,actionRequiredClass:be}),r.jsx("div",{className:`player-hand-area ${Ae}`,children:E.player.hand.filter(fe=>{const xe=E.actionRequired;return(xe==null?void 0:xe.type)==="select_card_from_hand_to_play"&&(xe==null?void 0:xe.selectableCardIds)?xe.selectableCardIds.includes(fe.id):!0}).map(fe=>{var Ee;const xe=((Ee=E.actionRequired)==null?void 0:Ee.type)==="select_lane_for_play"?fe.id===E.actionRequired.cardInHandId:fe.id===C;return r.jsx(vt,{card:fe,isFaceUp:!0,onPointerDown:()=>oo(fe),onPointerEnter:()=>Ca(fe),isSelected:xe,isMultiSelected:Ie.includes(fe.id),animationState:E.animationState,additionalClassName:"in-hand"},fe.id)})})]})]})]}),m&&r.jsx(w0,{onComplete:k}),Fo&&r.jsx(H0,{onLoadScenario:at,onSkipCoinFlip:S,onForceWin:qo,onForceLose:to})]})}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function B0({onPlayAgain:a,winner:n,finalState:l,difficulty:c}){if(!l)return r.jsxs("div",{className:"screen",children:[r.jsx("h1",{children:"Loading Results..."}),r.jsx("button",{className:"btn",onClick:a,children:"Back to Menu"})]});const s=n==="player",d=(p,f)=>{let h=[p];return f&&h.push("compiled"),h.join(" ")};return r.jsx("div",{className:`screen results-screen ${s?"victory":"defeat"}`,children:r.jsxs("div",{className:"results-screen-content",children:[r.jsxs("header",{className:"results-header",children:[r.jsx("h1",{children:s?"VICTORY":"DEFEAT"}),r.jsx("p",{children:s?"System compiled successfully.":"Critical error in the mainframe."})]}),r.jsxs("div",{className:"results-body",children:[r.jsxs("div",{className:"final-score-section",children:[r.jsx("h3",{children:"Final Score"}),r.jsxs("h4",{className:"results-label results-opponent-label",children:["Opponent (",c.charAt(0).toUpperCase()+c.slice(1),")"]}),r.jsxs("div",{className:"protocol-bars-container",children:[r.jsx("div",{className:"protocol-bar opponent-bar",children:l.opponent.protocols.map((p,f)=>r.jsxs("div",{className:d("protocol-display",l.opponent.compiled[f]),children:[r.jsx("span",{className:"protocol-name",children:p}),r.jsx("span",{className:"protocol-value",children:l.opponent.laneValues[f]})]},`opp-proto-${p}-${f}`))}),r.jsx("div",{className:"protocol-bar player-bar",children:l.player.protocols.map((p,f)=>r.jsxs("div",{className:d("protocol-display",l.player.compiled[f]),children:[r.jsx("span",{className:"protocol-name",children:p}),r.jsx("span",{className:"protocol-value",children:l.player.laneValues[f]})]},`player-proto-${p}-${f}`))})]}),r.jsx("h4",{className:"results-label results-player-label",children:"Player"})]}),r.jsxs("div",{className:"stats-section",children:[r.jsx("h3",{children:"Statistics"}),r.jsxs("div",{className:"stats-grid",children:[r.jsxs("div",{className:"stat-item",children:[r.jsx("span",{className:"stat-item-label",children:"Cards Played"}),r.jsx("span",{className:"stat-item-value opponent",children:l.stats.opponent.cardsPlayed}),r.jsx("span",{className:"stat-item-value player",children:l.stats.player.cardsPlayed})]}),r.jsxs("div",{className:"stat-item",children:[r.jsx("span",{className:"stat-item-label",children:"Cards Drawn"}),r.jsx("span",{className:"stat-item-value opponent",children:l.stats.opponent.cardsDrawn}),r.jsx("span",{className:"stat-item-value player",children:l.stats.player.cardsDrawn})]}),r.jsxs("div",{className:"stat-item",children:[r.jsx("span",{className:"stat-item-label",children:"Cards Discarded"}),r.jsx("span",{className:"stat-item-value opponent",children:l.stats.opponent.cardsDiscarded}),r.jsx("span",{className:"stat-item-value player",children:l.stats.player.cardsDiscarded})]}),r.jsxs("div",{className:"stat-item",children:[r.jsx("span",{className:"stat-item-label",children:"Cards Deleted"}),r.jsx("span",{className:"stat-item-value opponent",children:l.stats.opponent.cardsDeleted}),r.jsx("span",{className:"stat-item-value player",children:l.stats.player.cardsDeleted})]}),r.jsxs("div",{className:"stat-item",children:[r.jsx("span",{className:"stat-item-label",children:"Cards Flipped"}),r.jsx("span",{className:"stat-item-value opponent",children:l.stats.opponent.cardsFlipped}),r.jsx("span",{className:"stat-item-value player",children:l.stats.player.cardsFlipped})]}),r.jsxs("div",{className:"stat-item",children:[r.jsx("span",{className:"stat-item-label",children:"Cards Shifted"}),r.jsx("span",{className:"stat-item-value opponent",children:l.stats.opponent.cardsShifted}),r.jsx("span",{className:"stat-item-value player",children:l.stats.player.cardsShifted})]})]})]})]}),r.jsx("button",{className:"btn",onClick:a,children:"Play Again"})]})})}function Y0({onBack:a}){const[n,l]=re.useState(0);re.useEffect(()=>{El(),l(S=>S+1)},[]);const c=re.useMemo(()=>{console.log("[Card Library] Loading cards, refreshKey:",n);const S=jd(),$=Ja(),E=Do(),C=new Set(E.filter(T=>wr(T)).map(T=>T.name)),N=$.filter(T=>C.has(T.protocol)||S);return console.log("[Card Library] Total cards:",N.length,"(custom enabled:",S,")"),N},[n]),s=re.useMemo(()=>{const S=new Set(c.map($=>$.protocol));return Array.from(S).sort()},[c]),[d,p]=re.useState(null),f=re.useMemo(()=>{const S=new Set(c.map($=>$.category));return Array.from(S).sort()},[c]),[h,m]=re.useState(()=>new Set(f));re.useEffect(()=>{c.length>0&&!d&&p(c[0])},[c,d]);const g=S=>{m($=>{const E=new Set($);return E.has(S)?E.delete(S):E.add(S),E})},y=S=>{const $=c.find(E=>E.protocol===S);return($==null?void 0:$.category)||""},w=re.useMemo(()=>s.filter(S=>{const $=y(S);return h.has($)}),[s,h,c]),_=re.useMemo(()=>{const S={};for(const $ of c)S[$.protocol]||(S[$.protocol]=[]),S[$.protocol].push($);for(const $ in S)S[$].sort((E,C)=>E.value-C.value);return S},[c]),b=S=>{p(S)},k=()=>{if(!d)return null;const S={...d,id:"preview",isFaceUp:!0};return r.jsx(vt,{card:S,isFaceUp:!0})};return r.jsxs("div",{className:"screen card-library-screen",children:[r.jsx(Zi,{title:"Card Library",onBack:a}),r.jsxs("div",{className:"card-library-layout",children:[r.jsxs("div",{className:"game-preview-container",children:[r.jsx("h2",{children:"Card Preview"}),r.jsx("div",{className:"preview-card-area",children:k()})]}),r.jsxs("div",{className:"card-list-container",children:[r.jsx("div",{className:"category-filters",children:f.map(S=>r.jsxs("label",{className:"category-filter-item",children:[r.jsx("input",{type:"checkbox",checked:h.has(S),onChange:()=>g(S)}),r.jsx("span",{children:S})]},S))}),w.map(S=>r.jsxs("div",{className:"protocol-group",children:[r.jsxs("h3",{children:[S,r.jsxs("span",{className:"protocol-category-label",children:[" (",y(S),")"]})]}),r.jsx("div",{className:"protocol-card-grid",children:_[S].map($=>{const E={...$,id:`${$.protocol}-${$.value}`,isFaceUp:!0};return r.jsx(vt,{card:E,isFaceUp:!0,additionalClassName:"in-hand",onPointerEnter:()=>b($),onPointerDown:()=>b($)},E.id)})})]},S))]})]})]})}function G0({onBack:a}){const n=pm(),l=k0(n),c=R0(n),s=A0(n),d=T0(n),p=D0(n),f=N0(n),h=F0(n);return r.jsxs("div",{className:"screen statistics-screen",children:[r.jsx(Zi,{title:"STATISTICS",onBack:a}),r.jsxs("div",{className:"stats-content",children:[r.jsxs("section",{className:"stats-section",children:[r.jsx("h2",{className:"section-title",children:"Overview"}),r.jsxs("div",{className:"stats-grid",children:[r.jsxs("div",{className:"stat-item",children:[r.jsx("span",{className:"stat-label",children:"Games Played"}),r.jsx("span",{className:"stat-value",children:n.global.totalGamesPlayed})]}),r.jsxs("div",{className:"stat-item",children:[r.jsx("span",{className:"stat-label",children:"Win Rate"}),r.jsxs("span",{className:"stat-value",children:[l.toFixed(1),"%"]})]}),r.jsxs("div",{className:"stat-item",children:[r.jsx("span",{className:"stat-label",children:"Games Won"}),r.jsx("span",{className:"stat-value win",children:n.global.totalGamesWon})]}),r.jsxs("div",{className:"stat-item",children:[r.jsx("span",{className:"stat-label",children:"Games Lost"}),r.jsx("span",{className:"stat-value loss",children:n.global.totalGamesLost})]})]})]}),r.jsxs("section",{className:"stats-section",children:[r.jsx("h2",{className:"section-title",children:"Streaks"}),r.jsxs("div",{className:"stats-grid",children:[r.jsxs("div",{className:"stat-item",children:[r.jsx("span",{className:"stat-label",children:"Current Streak"}),r.jsx("span",{className:`stat-value ${n.global.currentStreak>0?"win":n.global.currentStreak<0?"loss":""}`,children:n.global.currentStreak>0?`+${n.global.currentStreak}`:n.global.currentStreak})]}),r.jsxs("div",{className:"stat-item",children:[r.jsx("span",{className:"stat-label",children:"Best Win Streak"}),r.jsx("span",{className:"stat-value win",children:n.global.longestWinStreak})]})]})]}),r.jsxs("section",{className:"stats-section",children:[r.jsx("h2",{className:"section-title",children:"Playtime"}),r.jsxs("div",{className:"stats-grid",children:[r.jsxs("div",{className:"stat-item",children:[r.jsx("span",{className:"stat-label",children:"Total Playtime"}),r.jsx("span",{className:"stat-value",children:Sl(n.global.totalPlaytime)})]}),r.jsxs("div",{className:"stat-item",children:[r.jsx("span",{className:"stat-label",children:"Average Game"}),r.jsx("span",{className:"stat-value",children:Sl(c)})]}),n.global.fastestWin&&r.jsxs("div",{className:"stat-item",children:[r.jsx("span",{className:"stat-label",children:"Fastest Win"}),r.jsx("span",{className:"stat-value",children:Sl(n.global.fastestWin)})]}),n.global.longestGame&&r.jsxs("div",{className:"stat-item",children:[r.jsx("span",{className:"stat-label",children:"Longest Game"}),r.jsx("span",{className:"stat-value",children:Sl(n.global.longestGame)})]}),n.global.lastGameDuration&&r.jsxs("div",{className:"stat-item",children:[r.jsx("span",{className:"stat-label",children:"Last Game"}),r.jsx("span",{className:"stat-value",children:Sl(n.global.lastGameDuration)})]})]})]}),r.jsxs("section",{className:"stats-section",children:[r.jsx("h2",{className:"section-title",children:"AI Performance"}),r.jsx("div",{className:"ai-stats",children:["easy","normal","hard"].map(m=>{const g=n.aiDifficulty[m],y=g.played>0?g.wins/g.played*100:0;return r.jsxs("div",{className:"ai-item",children:[r.jsx("span",{className:"ai-name",children:m}),r.jsxs("span",{className:"ai-record",children:[r.jsxs("span",{className:"win",children:[g.wins,"W"]})," - ",r.jsxs("span",{className:"loss",children:[g.losses,"L"]})]}),r.jsxs("span",{className:"ai-winrate",children:["(",y.toFixed(1),"%)"]})]},m)})})]}),d.length>0&&r.jsxs("section",{className:"stats-section",children:[r.jsx("h2",{className:"section-title",children:"Best Win Rate"}),r.jsx("div",{className:"protocol-list",children:d.map((m,g)=>r.jsxs("div",{className:"protocol-item",children:[r.jsxs("span",{className:"protocol-rank",children:[g+1,"."]}),r.jsx("span",{className:"protocol-name",children:m.protocol}),r.jsxs("span",{className:"protocol-stats win",children:[m.winRate.toFixed(0),"%  ",m.timesUsed]})]},m.protocol))})]}),s.length>0&&r.jsxs("section",{className:"stats-section",children:[r.jsx("h2",{className:"section-title",children:"Favorite Protocols"}),r.jsx("div",{className:"protocol-list",children:s.map((m,g)=>r.jsxs("div",{className:"protocol-item",children:[r.jsxs("span",{className:"protocol-rank",children:[g+1,"."]}),r.jsx("span",{className:"protocol-name",children:m.protocol}),r.jsxs("span",{className:"protocol-stats",children:[m.timesUsed,"  ",m.winRate.toFixed(0),"%"]})]},m.protocol))})]}),p.length>0&&r.jsxs("section",{className:"stats-section",children:[r.jsx("h2",{className:"section-title",children:"Least Used Protocols"}),r.jsx("div",{className:"protocol-list",children:p.map((m,g)=>r.jsxs("div",{className:"protocol-item",children:[r.jsxs("span",{className:"protocol-rank",children:[g+1,"."]}),r.jsx("span",{className:"protocol-name",children:m.protocol}),r.jsxs("span",{className:"protocol-stats",children:[m.timesUsed,"  ",m.winRate.toFixed(0),"%"]})]},m.protocol))})]}),f.length>0&&r.jsxs("section",{className:"stats-section",children:[r.jsx("h2",{className:"section-title",children:"Most Played Cards"}),r.jsx("div",{className:"card-list",children:f.map((m,g)=>r.jsxs("div",{className:"card-item",children:[r.jsxs("span",{className:"card-rank",children:[g+1,"."]}),r.jsx("span",{className:"card-name",children:m.card}),r.jsxs("span",{className:"card-count",children:[m.count,""]})]},m.card))})]}),h.length>0&&r.jsxs("section",{className:"stats-section",children:[r.jsx("h2",{className:"section-title",children:"Most Deleted Cards"}),r.jsx("div",{className:"card-list",children:h.map((m,g)=>r.jsxs("div",{className:"card-item",children:[r.jsxs("span",{className:"card-rank",children:[g+1,"."]}),r.jsx("span",{className:"card-name",children:m.card}),r.jsxs("span",{className:"card-count",children:[m.count,""]})]},m.card))})]}),r.jsxs("section",{className:"stats-section",children:[r.jsx("h2",{className:"section-title",children:"Control Mechanic"}),r.jsxs("div",{className:"stats-grid",children:[r.jsxs("div",{className:"stat-item",children:[r.jsx("span",{className:"stat-label",children:"With Control"}),r.jsx("span",{className:"stat-value",children:n.control.gamesWithControl})]}),r.jsxs("div",{className:"stat-item",children:[r.jsx("span",{className:"stat-label",children:"Without Control"}),r.jsx("span",{className:"stat-value",children:n.control.gamesWithoutControl})]}),r.jsxs("div",{className:"stat-item",children:[r.jsx("span",{className:"stat-label",children:"Your Rearranges"}),r.jsx("span",{className:"stat-value",children:n.control.playerRearranges})]}),r.jsxs("div",{className:"stat-item",children:[r.jsx("span",{className:"stat-label",children:"AI Rearranges"}),r.jsx("span",{className:"stat-value",children:n.control.aiRearranges})]}),r.jsxs("div",{className:"stat-item",children:[r.jsx("span",{className:"stat-label",children:"Total Rearranges"}),r.jsx("span",{className:"stat-value",children:n.control.totalRearranges})]})]})]}),r.jsxs("section",{className:"stats-section",children:[r.jsx("h2",{className:"section-title",children:"Coin Flip"}),r.jsxs("div",{className:"stats-grid",children:[r.jsxs("div",{className:"stat-item",children:[r.jsx("span",{className:"stat-label",children:"Heads Chosen"}),r.jsxs("span",{className:"stat-value",children:[n.coinFlip.headsChosen," (",n.coinFlip.headsChosen>0?(n.coinFlip.headsWon/n.coinFlip.headsChosen*100).toFixed(0):0,"%)"]})]}),r.jsxs("div",{className:"stat-item",children:[r.jsx("span",{className:"stat-label",children:"Tails Chosen"}),r.jsxs("span",{className:"stat-value",children:[n.coinFlip.tailsChosen," (",n.coinFlip.tailsChosen>0?(n.coinFlip.tailsWon/n.coinFlip.tailsChosen*100).toFixed(0):0,"%)"]})]})]})]}),r.jsxs("section",{className:"stats-section full-width",children:[r.jsx("h2",{className:"section-title",children:"Actions"}),r.jsxs("div",{className:"stats-grid",style:{gridTemplateColumns:"repeat(4, 1fr)"},children:[r.jsxs("div",{className:"stat-item",children:[r.jsx("span",{className:"stat-label",children:"Cards Played"}),r.jsx("span",{className:"stat-value",children:n.actions.totalCardsPlayed})]}),r.jsxs("div",{className:"stat-item",children:[r.jsx("span",{className:"stat-label",children:"Cards Drawn"}),r.jsx("span",{className:"stat-value",children:n.actions.totalCardsDrawn})]}),r.jsxs("div",{className:"stat-item",children:[r.jsx("span",{className:"stat-label",children:"Discards"}),r.jsx("span",{className:"stat-value",children:n.actions.totalDiscards})]}),r.jsxs("div",{className:"stat-item",children:[r.jsx("span",{className:"stat-label",children:"Deletes"}),r.jsx("span",{className:"stat-value",children:n.actions.totalDeletes})]}),r.jsxs("div",{className:"stat-item",children:[r.jsx("span",{className:"stat-label",children:"Flips"}),r.jsx("span",{className:"stat-value",children:n.actions.totalFlips})]}),r.jsxs("div",{className:"stat-item",children:[r.jsx("span",{className:"stat-label",children:"Shifts"}),r.jsx("span",{className:"stat-value",children:n.actions.totalShifts})]}),r.jsxs("div",{className:"stat-item",children:[r.jsx("span",{className:"stat-label",children:"Compiles"}),r.jsx("span",{className:"stat-value",children:n.actions.totalCompiles})]}),r.jsxs("div",{className:"stat-item",children:[r.jsx("span",{className:"stat-label",children:"Refreshes"}),r.jsx("span",{className:"stat-value",children:n.actions.totalRefreshes})]})]})]})]})]})}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const wy=({params:a,onChange:n})=>{var l,c,s,d,p;return r.jsxs("div",{className:"param-editor draw-effect-editor",children:[r.jsx("h4",{children:"Draw Effect Parameters"}),r.jsxs("label",{children:["Count Type",r.jsxs("select",{value:a.countType||"fixed",onChange:f=>{const h=f.target.value;n({...a,countType:h,countOffset:h==="equal_to_discarded"?0:void 0})},children:[r.jsx("option",{value:"fixed",children:"Fixed Amount"}),r.jsx("option",{value:"equal_to_card_value",children:"Equal to Card Value (from previous effect)"}),r.jsx("option",{value:"equal_to_discarded",children:"Equal to Discarded Cards"}),r.jsx("option",{value:"hand_size",children:"Equal to Hand Size"})]})]}),(!a.countType||a.countType==="fixed")&&r.jsxs("label",{children:["Card Count",r.jsx("input",{type:"number",min:1,max:6,value:a.count,onChange:f=>n({...a,count:parseInt(f.target.value)||1})})]}),a.countType==="equal_to_discarded"&&r.jsxs("label",{children:["Offset (+/-)",r.jsx("input",{type:"number",min:-5,max:5,value:a.countOffset||0,onChange:f=>n({...a,countOffset:parseInt(f.target.value)||0})}),r.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:'Example: +1 for "discard count plus 1" (Fire-4)'})]}),r.jsxs("label",{children:["Target",r.jsxs("select",{value:a.target,onChange:f=>n({...a,target:f.target.value}),children:[r.jsx("option",{value:"self",children:"Self"}),r.jsx("option",{value:"opponent",children:"Opponent"})]})]}),r.jsxs("label",{children:["Source",r.jsxs("select",{value:a.source,onChange:f=>n({...a,source:f.target.value}),children:[r.jsx("option",{value:"own_deck",children:"Own Deck"}),r.jsx("option",{value:"opponent_deck",children:"Opponent's Deck"})]})]}),r.jsxs("label",{children:[r.jsx("input",{type:"checkbox",checked:a.preAction==="refresh",onChange:f=>n({...a,preAction:f.target.checked?"refresh":void 0})}),"Refresh hand first (shuffle hand into deck, then draw)"]}),r.jsxs("label",{children:[r.jsx("input",{type:"checkbox",checked:a.optional||!1,onChange:f=>n({...a,optional:f.target.checked})}),'Optional ("You may draw" instead of "Draw")']}),r.jsxs("label",{children:[r.jsx("input",{type:"checkbox",checked:a.valueFilter!==void 0,onChange:f=>{if(f.target.checked)n({...a,valueFilter:{equals:1}});else{const{valueFilter:h,...m}=a;n(m)}}}),'Draw specific value only (e.g., "Draw 1 card with a value of X")']}),a.valueFilter!==void 0&&r.jsxs(r.Fragment,{children:[r.jsxs("label",{children:["Card Value to Draw",r.jsx("input",{type:"number",min:0,max:5,value:((l=a.valueFilter)==null?void 0:l.equals)??1,onChange:f=>n({...a,valueFilter:{equals:parseInt(f.target.value)||0}})}),r.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"Only draws cards with this exact value from the deck"})]}),r.jsxs("label",{children:[r.jsx("input",{type:"checkbox",checked:a.fromRevealed||!1,onChange:f=>n({...a,fromRevealed:f.target.checked})}),'From revealed deck ("revealed this way" - player selects)',r.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:'Requires "Reveal your deck" effect before this. Player picks from revealed cards.'})]})]}),r.jsxs("label",{children:["Conditional",r.jsxs("select",{value:((c=a.conditional)==null?void 0:c.type)||"none",onChange:f=>{if(f.target.value==="none"){const{conditional:h,...m}=a;n(m)}else n({...a,conditional:{type:f.target.value}})},children:[r.jsx("option",{value:"none",children:"None"}),r.jsx("option",{value:"count_face_down",children:"1 per face-down card (all on board)"}),r.jsx("option",{value:"is_covering",children:"Only if this card is covering another"}),r.jsx("option",{value:"non_matching_protocols",children:"1 per line with non-matching protocol"})]})]}),r.jsxs("label",{children:["Advanced Conditional",r.jsxs("select",{value:((s=a.advancedConditional)==null?void 0:s.type)||"none",onChange:f=>{if(f.target.value==="none"){const{advancedConditional:h,...m}=a;n(m)}else f.target.value==="protocol_match"?n({...a,advancedConditional:{type:"protocol_match",protocol:""}}):f.target.value==="compile_block"?n({...a,advancedConditional:{type:"compile_block",turnDuration:1}}):f.target.value==="empty_hand"?n({...a,advancedConditional:{type:"empty_hand"}}):f.target.value==="opponent_higher_value_in_lane"&&n({...a,advancedConditional:{type:"opponent_higher_value_in_lane"}})},children:[r.jsx("option",{value:"none",children:"None"}),r.jsx("option",{value:"protocol_match",children:"Only if in line with matching protocol"}),r.jsx("option",{value:"compile_block",children:"Block opponent's compile next turn"}),r.jsx("option",{value:"empty_hand",children:"Only if hand is empty"}),r.jsx("option",{value:"opponent_higher_value_in_lane",children:"Only if opponent has higher value in this lane"})]})]}),((d=a.advancedConditional)==null?void 0:d.type)==="protocol_match"&&r.jsxs("label",{children:["Required Protocol",r.jsx("input",{type:"text",placeholder:"e.g., Fire, Water, Lightning",value:a.advancedConditional.protocol||"",onChange:f=>n({...a,advancedConditional:{...a.advancedConditional,type:"protocol_match",protocol:f.target.value}})}),r.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"Only draw if this card is in a line with this protocol"})]}),((p=a.advancedConditional)==null?void 0:p.type)==="compile_block"&&r.jsxs("label",{children:["Block Duration (turns)",r.jsx("input",{type:"number",min:1,max:3,value:a.advancedConditional.turnDuration||1,onChange:f=>n({...a,advancedConditional:{...a.advancedConditional,type:"compile_block",turnDuration:parseInt(f.target.value)||1}})}),r.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"Opponent can't compile for this many turns"})]})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const W0=({params:a,onChange:n})=>r.jsxs("div",{className:"param-editor refresh-effect-editor",children:[r.jsx("h4",{children:"Refresh Effect Parameters"}),r.jsx("p",{className:"effect-description",children:'Refresh fills the hand to 5 cards (Spirit-0: "Refresh.")'}),r.jsxs("label",{children:["Target",r.jsxs("select",{value:a.target||"self",onChange:l=>n({...a,target:l.target.value}),children:[r.jsx("option",{value:"self",children:"Self"}),r.jsx("option",{value:"opponent",children:"Opponent"})]})]})]});/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Q0=({params:a,onChange:n})=>r.jsxs("div",{className:"param-editor mutual-draw-effect-editor",children:[r.jsx("h4",{children:"Mutual Draw Effect Parameters"}),r.jsx("p",{className:"effect-description",children:`Both players draw from each other's decks (Chaos-0: "Draw the top card of your opponent's deck. Your opponent draws the top card of your deck.")`}),r.jsxs("label",{children:["Count",r.jsx("input",{type:"number",min:"1",max:"10",value:a.count||1,onChange:l=>n({...a,count:parseInt(l.target.value)||1})})]})]});/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Cy=({params:a,onChange:n})=>{var s,d;const l=a.targetFilter||{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1},c=a.count??1;return r.jsxs("div",{className:"param-editor flip-effect-editor",children:[r.jsx("h4",{children:"Flip Effect Parameters"}),r.jsxs("label",{children:["Card Count/Scope",r.jsxs("select",{value:c==="all"?"all":c==="each"?"each":c.toString(),onChange:p=>{const f=p.target.value;n(f==="all"?{...a,count:"all"}:f==="each"?{...a,count:"each"}:{...a,count:parseInt(f)})},children:[r.jsx("option",{value:"1",children:"1 card"}),r.jsx("option",{value:"2",children:"2 cards"}),r.jsx("option",{value:"3",children:"3 cards"}),r.jsx("option",{value:"all",children:"All matching cards"}),r.jsx("option",{value:"each",children:"Each matching card"})]})]}),typeof a.count=="number"&&r.jsxs("label",{children:["Scope",r.jsxs("select",{value:a.scope||"any",onChange:p=>n({...a,scope:p.target.value}),children:[r.jsx("option",{value:"any",children:"Any lane"}),r.jsx("option",{value:"this_lane",children:"This lane only"}),r.jsx("option",{value:"each_lane",children:'Each lane (Chaos-0: "In each line...")'})]})]}),r.jsxs("label",{children:[r.jsx("input",{type:"checkbox",checked:a.optional,onChange:p=>n({...a,optional:p.target.checked})}),'Optional ("May flip" instead of "Flip")']}),a.count==="each"&&r.jsxs("label",{children:["Each Line Scope",r.jsxs("select",{value:a.eachLineScope||"all_lines",onChange:p=>n({...a,eachLineScope:p.target.value}),children:[r.jsx("option",{value:"all_lines",children:"Each card on board"}),r.jsx("option",{value:"each_line",children:"1 card in each line"})]})]}),r.jsxs("label",{children:[r.jsx("input",{type:"checkbox",checked:a.flipSelf||!1,onChange:p=>n({...a,flipSelf:p.target.checked})}),"Flip ONLY this card (no target selection)",r.jsx("small",{style:{display:"block",marginLeft:"24px",color:"#8A79E8"},children:"The card flips itself, ignoring count and target filter."})]}),r.jsxs("label",{children:[r.jsx("input",{type:"checkbox",checked:a.selfFlipAfter||!1,onChange:p=>n({...a,selfFlipAfter:p.target.checked})}),"ALSO flip this card after flipping targets",r.jsx("small",{style:{display:"block",marginLeft:"24px",color:"#8A79E8"},children:"After flipping target(s), also flip this card as bonus."})]}),r.jsx("h5",{children:"Advanced Conditional"}),r.jsxs("label",{children:["Conditional Type",r.jsxs("select",{value:((s=a.advancedConditional)==null?void 0:s.type)||"",onChange:p=>{if(p.target.value===""){const{advancedConditional:f,...h}=a;n(h)}else p.target.value==="protocol_match"?n({...a,advancedConditional:{type:"protocol_match",protocol:""}}):n({...a,advancedConditional:{type:p.target.value}})},children:[r.jsx("option",{value:"",children:"None"}),r.jsx("option",{value:"protocol_match",children:"Only if in specific protocol line"}),r.jsx("option",{value:"opponent_higher_value_in_lane",children:"Only if opponent has higher value in this lane"})]})]}),((d=a.advancedConditional)==null?void 0:d.type)==="protocol_match"&&r.jsxs("label",{children:["Required Protocol",r.jsx("input",{type:"text",value:a.advancedConditional.protocol||"",onChange:p=>n({...a,advancedConditional:{...a.advancedConditional,protocol:p.target.value}}),placeholder:"e.g., Anarchy, Fire, Death"})]}),r.jsx("h5",{children:"Target Filter"}),r.jsxs("label",{children:["Owner",r.jsxs("select",{value:l.owner,onChange:p=>n({...a,targetFilter:{...l,owner:p.target.value}}),children:[r.jsx("option",{value:"any",children:"Any"}),r.jsx("option",{value:"own",children:"Own"}),r.jsx("option",{value:"opponent",children:"Opponent"})]})]}),r.jsxs("label",{children:["Position",r.jsxs("select",{value:l.position,onChange:p=>n({...a,targetFilter:{...l,position:p.target.value}}),children:[r.jsx("option",{value:"any",children:"Any"}),r.jsx("option",{value:"uncovered",children:"Uncovered (top card)"}),r.jsx("option",{value:"covered",children:"Covered"}),r.jsx("option",{value:"covered_in_this_line",children:"Covered in this line"})]})]}),r.jsxs("label",{children:["Face State",r.jsxs("select",{value:l.faceState,onChange:p=>n({...a,targetFilter:{...l,faceState:p.target.value}}),children:[r.jsx("option",{value:"any",children:"Any"}),r.jsx("option",{value:"face_up",children:"Face-up"}),r.jsx("option",{value:"face_down",children:"Face-down"})]})]}),r.jsxs("label",{children:[r.jsx("input",{type:"checkbox",checked:l.excludeSelf,onChange:p=>n({...a,targetFilter:{...l,excludeSelf:p.target.checked}})}),'Exclude self ("other cards")']})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const by=({params:a,onChange:n})=>{var c,s,d;const l=a.targetFilter||{owner:"any",position:"uncovered",faceState:"any"};return r.jsxs("div",{className:"param-editor",children:[r.jsx("h4",{children:"Shift Effect"}),r.jsxs("label",{children:["Count/Scope",r.jsxs("select",{value:a.count==="all"?"all":"1",onChange:p=>{if(p.target.value==="all")n({...a,count:"all"});else{const{count:f,...h}=a;n(h)}},children:[r.jsx("option",{value:"1",children:"1 card"}),r.jsx("option",{value:"all",children:"All matching cards"})]})]}),r.jsxs("label",{children:["Target Owner",r.jsxs("select",{value:l.owner||"any",onChange:p=>n({...a,targetFilter:{...l,owner:p.target.value}}),children:[r.jsx("option",{value:"any",children:"Any"}),r.jsx("option",{value:"own",children:"Own"}),r.jsx("option",{value:"opponent",children:"Opponent"})]})]}),r.jsxs("label",{children:["Position",r.jsxs("select",{value:l.position||"uncovered",onChange:p=>n({...a,targetFilter:{...l,position:p.target.value}}),children:[r.jsx("option",{value:"any",children:"Any"}),r.jsx("option",{value:"uncovered",children:"Uncovered"}),r.jsx("option",{value:"covered",children:"Covered"})]})]}),r.jsxs("label",{children:["Face State",r.jsxs("select",{value:l.faceState||"any",onChange:p=>n({...a,targetFilter:{...l,faceState:p.target.value}}),children:[r.jsx("option",{value:"any",children:"Any"}),r.jsx("option",{value:"face_up",children:"Face-up"}),r.jsx("option",{value:"face_down",children:"Face-down"})]})]}),r.jsxs("label",{children:[r.jsx("input",{type:"checkbox",checked:l.excludeSelf||!1,onChange:p=>n({...a,targetFilter:{...l,excludeSelf:p.target.checked}})}),'Exclude self ("other card")']}),r.jsxs("label",{children:[r.jsx("input",{type:"checkbox",checked:a.optional||!1,onChange:p=>n({...a,optional:p.target.checked})}),'Optional ("You may shift" instead of "Shift")']}),r.jsxs("label",{children:[r.jsx("input",{type:"checkbox",checked:a.shiftSelf||!1,onChange:p=>n({...a,shiftSelf:p.target.checked})}),"Shift this card (instead of selecting target)",r.jsx("small",{style:{display:"block",marginLeft:"24px",color:"#8A79E8"},children:"The card shifts itself, ignoring target filter."})]}),r.jsx("h5",{children:"Advanced Conditional"}),r.jsxs("label",{children:["Conditional Type",r.jsxs("select",{value:((c=a.advancedConditional)==null?void 0:c.type)||"none",onChange:p=>{if(p.target.value==="none"){const{advancedConditional:f,...h}=a;n(h)}else n({...a,advancedConditional:{type:p.target.value}})},children:[r.jsx("option",{value:"none",children:"None"}),r.jsx("option",{value:"empty_hand",children:"Only if hand is empty"}),r.jsx("option",{value:"opponent_higher_value_in_lane",children:"Only if opponent has higher value in this lane"}),r.jsx("option",{value:"this_card_is_covered",children:"Only if this card is covered"})]})]}),r.jsxs("label",{children:["Destination",r.jsxs("select",{value:((s=a.destinationRestriction)==null?void 0:s.type)||"any",onChange:p=>{if(p.target.value==="any"){const{destinationRestriction:f,...h}=a;n(h)}else n({...a,destinationRestriction:{type:p.target.value}})},children:[r.jsx("option",{value:"any",children:"Any line"}),r.jsx("option",{value:"to_another_line",children:"To another line"}),r.jsx("option",{value:"non_matching_protocol",children:"Non-matching protocol"}),r.jsx("option",{value:"specific_lane",children:"This line (within)"}),r.jsx("option",{value:"to_this_lane",children:"To THIS lane only"}),r.jsx("option",{value:"to_or_from_this_lane",children:"To OR from this lane"}),r.jsx("option",{value:"opponent_highest_value_lane",children:"To opponent's highest value lane"})]}),((d=a.destinationRestriction)==null?void 0:d.type)==="opponent_highest_value_lane"&&r.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"Card can only be shifted to the lane where opponent has highest total value."})]}),r.jsxs("label",{children:["Source Scope",r.jsxs("select",{value:a.scope||"any",onChange:p=>{if(p.target.value==="any"){const{scope:f,...h}=a;n(h)}else n({...a,scope:p.target.value})},children:[r.jsx("option",{value:"any",children:"Any lane (select from all lanes)"}),r.jsx("option",{value:"this_lane",children:"This line only"}),r.jsx("option",{value:"each_lane",children:"Each lane (execute per lane)"})]}),a.scope==="this_lane"&&r.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"Only cards in this line can be selected as shift targets."})]})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Sy=({params:a,onChange:n})=>{var c,s,d,p,f,h,m,g;const l=a.targetFilter||{position:"uncovered",faceState:"any"};return r.jsxs("div",{className:"param-editor delete-effect-editor",children:[r.jsx("h4",{children:"Delete Effect Parameters"}),r.jsxs("label",{children:["Anzahl",r.jsxs("select",{value:typeof a.count=="number"?a.count.toString():"all",onChange:y=>n({...a,count:y.target.value==="all"?"all_in_lane":parseInt(y.target.value)}),children:[r.jsx("option",{value:"1",children:"1"}),r.jsx("option",{value:"2",children:"2"}),r.jsx("option",{value:"3",children:"3"}),r.jsx("option",{value:"all",children:"All in a lane"})]})]}),r.jsxs("label",{children:[r.jsx("input",{type:"checkbox",checked:a.excludeSelf,onChange:y=>n({...a,excludeSelf:y.target.checked})}),"Exclude self (other cards only)"]}),r.jsxs("label",{children:[r.jsx("input",{type:"checkbox",checked:a.deleteSelf||!1,onChange:y=>n({...a,deleteSelf:y.target.checked})}),"Delete this card (ignores all other settings)"]}),r.jsx("h5",{children:"Target Filter"}),r.jsxs("label",{children:["Position",r.jsxs("select",{value:l.position,onChange:y=>n({...a,targetFilter:{...l,position:y.target.value}}),children:[r.jsx("option",{value:"any",children:"Any"}),r.jsx("option",{value:"uncovered",children:"Uncovered"}),r.jsx("option",{value:"covered",children:"Covered"})]})]}),r.jsxs("label",{children:["Face State",r.jsxs("select",{value:l.faceState,onChange:y=>n({...a,targetFilter:{...l,faceState:y.target.value}}),children:[r.jsx("option",{value:"any",children:"Any"}),r.jsx("option",{value:"face_up",children:"Face-up"}),r.jsx("option",{value:"face_down",children:"Face-down"})]})]}),r.jsxs("label",{children:["Owner",r.jsxs("select",{value:l.owner||"any",onChange:y=>{const w=y.target.value,_={...l};w==="any"?delete _.owner:_.owner=w,n({...a,targetFilter:_})},children:[r.jsx("option",{value:"any",children:"Any (own or opponent)"}),r.jsx("option",{value:"own",children:"Own cards only"}),r.jsx("option",{value:"opponent",children:"Opponent's cards only"})]})]}),r.jsxs("label",{children:["Calculation",r.jsxs("select",{value:l.calculation||"none",onChange:y=>{const w=y.target.value,_={...l};w==="none"?delete _.calculation:_.calculation=w,n({...a,targetFilter:_})},children:[r.jsx("option",{value:"none",children:"None"}),r.jsx("option",{value:"highest_value",children:"Highest value"}),r.jsx("option",{value:"lowest_value",children:"Lowest value"})]})]}),r.jsxs("label",{children:["Value Range (specific values to target)",r.jsxs("select",{value:l.valueRange?`${l.valueRange.min}-${l.valueRange.max}`:"none",onChange:y=>{const w=y.target.value,_={...l};w==="none"?delete _.valueRange:w==="0-1"?_.valueRange={min:0,max:1}:w==="1-2"?_.valueRange={min:1,max:2}:w==="0-0"&&(_.valueRange={min:0,max:0}),n({...a,targetFilter:_})},children:[r.jsx("option",{value:"none",children:"Any value"}),r.jsx("option",{value:"0-0",children:"Value 0 only"}),r.jsx("option",{value:"0-1",children:"Values 0 or 1"}),r.jsx("option",{value:"1-2",children:"Values 1 or 2"})]})]}),r.jsx("h5",{children:"Scope"}),r.jsxs("label",{children:["Lane Scope",r.jsxs("select",{value:((c=a.scope)==null?void 0:c.type)||"any",onChange:y=>{const w=y.target.value;if(w==="any"){const{scope:_,...b}=a;n(b)}else n({...a,scope:{type:w}})},children:[r.jsx("option",{value:"any",children:"Any lane"}),r.jsx("option",{value:"this_line",children:"This line only"}),r.jsx("option",{value:"other_lanes",children:"Other lanes"}),r.jsx("option",{value:"each_other_line",children:"Each other line (1 per line)"}),r.jsx("option",{value:"each_lane",children:"Each lane (flexible, 1 per line)"})]})]}),(((s=a.scope)==null?void 0:s.type)==="other_lanes"||((d=a.scope)==null?void 0:d.type)==="any")&&r.jsxs("label",{children:["Minimum Cards in Lane",r.jsxs("select",{value:((p=a.scope)==null?void 0:p.minCardsInLane)||0,onChange:y=>{const w=parseInt(y.target.value);if(w===0){const _={...a.scope};delete _.minCardsInLane,n({...a,scope:_})}else n({...a,scope:{...a.scope,minCardsInLane:w}})},children:[r.jsx("option",{value:0,children:"No minimum"}),r.jsx("option",{value:8,children:"8 or more cards (Metal-3)"}),r.jsx("option",{value:6,children:"6 or more cards"}),r.jsx("option",{value:4,children:"4 or more cards"})]}),((f=a.scope)==null?void 0:f.minCardsInLane)&&r.jsxs("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:["Only delete from lanes with ",a.scope.minCardsInLane,"+ cards total."]})]}),r.jsxs("label",{children:["Who Chooses Target?",r.jsxs("select",{value:a.actorChooses||"effect_owner",onChange:y=>{const w=y.target.value;if(w==="effect_owner"){const{actorChooses:_,...b}=a;n(b)}else n({...a,actorChooses:w})},children:[r.jsx("option",{value:"effect_owner",children:"Effect owner chooses (default)"}),r.jsx("option",{value:"card_owner",children:"Card owner chooses (Plague-4: opponent deletes their own)"})]}),a.actorChooses==="card_owner"&&r.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"The owner of the targeted card chooses which card to delete."})]}),r.jsx("h5",{children:"Advanced Conditional"}),r.jsxs("label",{children:["Conditional Type",r.jsxs("select",{value:((h=a.advancedConditional)==null?void 0:h.type)||"none",onChange:y=>{if(y.target.value==="none"){const{advancedConditional:w,..._}=a;n(_)}else n({...a,advancedConditional:{type:y.target.value}})},children:[r.jsx("option",{value:"none",children:"None"}),r.jsx("option",{value:"empty_hand",children:"Only if hand is empty"}),r.jsx("option",{value:"opponent_higher_value_in_lane",children:"Only if opponent has higher value in this lane"})]})]}),r.jsx("h5",{children:"Lane Restriction"}),r.jsxs("label",{children:["Lane Condition",r.jsxs("select",{value:((m=a.laneCondition)==null?void 0:m.type)||"none",onChange:y=>{const w=y.target.value;if(w==="none"){const{laneCondition:_,selectLane:b,...k}=a;n(k)}else n({...a,laneCondition:{type:w},selectLane:!0})},children:[r.jsx("option",{value:"none",children:"None (any lane)"}),r.jsx("option",{value:"opponent_higher_value",children:"Only lanes where opponent has higher value"})]}),((g=a.laneCondition)==null?void 0:g.type)==="opponent_higher_value"&&r.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"Can only delete cards in lanes where opponent's total value is higher than yours. Player selects lane first, then card."})]}),r.jsxs("label",{children:[r.jsx("input",{type:"checkbox",checked:a.selectLane||!1,onChange:y=>n({...a,selectLane:y.target.checked})}),"Select lane first (player chooses lane, then card)",r.jsx("small",{style:{display:"block",marginLeft:"24px",color:"#8A79E8"},children:"Enable if player should pick a lane before selecting a card."})]})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Ey=({params:a,onChange:n})=>{const l=a.countType||"fixed",c=a.variableCount,s=l==="equal_to_discarded";return r.jsxs("div",{className:"param-editor",children:[r.jsx("h4",{children:"Discard Effect"}),r.jsxs("label",{children:["Count Type",r.jsxs("select",{value:l,onChange:d=>n({...a,countType:d.target.value}),children:[r.jsx("option",{value:"fixed",children:"Fixed Count"}),r.jsx("option",{value:"equal_to_discarded",children:"Equal to Previously Discarded (Plague-2)"})]})]}),l==="fixed"&&r.jsxs("label",{children:["Count",r.jsxs("select",{value:c?"variable":a.count.toString(),onChange:d=>{const p=d.target.value;if(p==="variable")n({...a,variableCount:!0,count:1});else if(p==="all"){const{variableCount:f,...h}=a;n({...h,count:"all"})}else{const{variableCount:f,...h}=a;n({...h,count:parseInt(p)})}},children:[r.jsx("option",{value:"1",children:"1 card"}),r.jsx("option",{value:"2",children:"2 cards"}),r.jsx("option",{value:"3",children:"3 cards"}),r.jsx("option",{value:"all",children:"All cards (entire hand)"}),r.jsx("option",{value:"variable",children:"1 or more cards (variable)"})]})]}),s&&r.jsxs("label",{children:["Offset (add to count)",r.jsx("input",{type:"number",value:a.countOffset||0,onChange:d=>n({...a,countOffset:parseInt(d.target.value)}),min:"-5",max:"5"})]}),r.jsxs("label",{children:["Actor",r.jsxs("select",{value:a.actor,onChange:d=>n({...a,actor:d.target.value}),children:[r.jsx("option",{value:"self",children:"Self"}),r.jsx("option",{value:"opponent",children:"Opponent"})]})]}),a.actor==="opponent"&&r.jsxs("label",{children:[r.jsx("input",{type:"checkbox",checked:a.random||!1,onChange:d=>n({...a,random:d.target.checked})}),"Random selection (opponent can't choose which card)",r.jsx("small",{style:{display:"block",marginLeft:"24px",marginTop:"4px",color:"#8A79E8"},children:"A random card is discarded instead of opponent choosing."})]})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const jy=({params:a,onChange:n})=>{var p,f,h,m;const l=((p=a.targetFilter)==null?void 0:p.owner)||"any",c=((f=a.targetFilter)==null?void 0:f.position)||"uncovered",s=(h=a.targetFilter)==null?void 0:h.valueEquals,d=a.selectLane||!1;return r.jsxs("div",{className:"param-editor",children:[r.jsx("h4",{children:"Return Effect"}),r.jsxs("label",{children:["Count",r.jsxs("select",{value:typeof a.count=="number"?a.count.toString():"all",onChange:g=>n({...a,count:g.target.value==="all"?"all":parseInt(g.target.value)}),children:[r.jsx("option",{value:"1",children:"1"}),r.jsx("option",{value:"2",children:"2"}),r.jsx("option",{value:"all",children:"All"})]})]}),r.jsxs("label",{children:["Whose cards?",r.jsxs("select",{value:l,onChange:g=>n({...a,targetFilter:{...a.targetFilter,owner:g.target.value}}),children:[r.jsx("option",{value:"any",children:"Any card (own or opponent)"}),r.jsx("option",{value:"own",children:"Only own cards"}),r.jsx("option",{value:"opponent",children:"Only opponent cards"})]})]}),r.jsxs("label",{children:["Position",r.jsxs("select",{value:c,onChange:g=>n({...a,targetFilter:{...a.targetFilter,position:g.target.value}}),children:[r.jsx("option",{value:"uncovered",children:"Uncovered (default)"}),r.jsx("option",{value:"covered",children:"Covered"}),r.jsx("option",{value:"any",children:"Any (covered or uncovered)"})]})]}),r.jsxs("label",{children:[r.jsx("input",{type:"checkbox",checked:d,onChange:g=>{if(g.target.checked)n({...a,selectLane:!0});else{const{selectLane:y,...w}=a;n(w)}}}),'Select lane first (Water-3: "in 1 line")']}),r.jsxs("label",{children:[r.jsx("input",{type:"checkbox",checked:s!==void 0,onChange:g=>{if(g.target.checked)n({...a,targetFilter:{...a.targetFilter,valueEquals:2}});else{const{valueEquals:y,...w}=a.targetFilter||{};n({...a,targetFilter:w})}}}),"Filter by value"]}),s!==void 0&&r.jsxs("label",{children:["Value to return",r.jsx("input",{type:"number",min:0,max:6,value:s,onChange:g=>n({...a,targetFilter:{...a.targetFilter,valueEquals:parseInt(g.target.value)||0}})})]}),r.jsx("h5",{children:"Advanced Conditional"}),r.jsxs("label",{children:["Conditional Type",r.jsxs("select",{value:((m=a.advancedConditional)==null?void 0:m.type)||"none",onChange:g=>{if(g.target.value==="none"){const{advancedConditional:y,...w}=a;n(w)}else n({...a,advancedConditional:{type:g.target.value}})},children:[r.jsx("option",{value:"none",children:"None"}),r.jsx("option",{value:"empty_hand",children:"Only if hand is empty"}),r.jsx("option",{value:"opponent_higher_value_in_lane",children:"Only if opponent has higher value in this lane"})]})]})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const ky=({params:a,onChange:n})=>{var c,s,d,p;const l=a.destinationRule||{type:"other_lines"};return r.jsxs("div",{className:"param-editor",children:[r.jsx("h4",{children:"Play Effect"}),r.jsxs("label",{children:["Actor (who plays)",r.jsxs("select",{value:a.actor||"self",onChange:f=>{if(f.target.value==="self"){const{actor:h,...m}=a;n(m)}else n({...a,actor:f.target.value})},children:[r.jsx("option",{value:"self",children:"You"}),r.jsx("option",{value:"opponent",children:"Opponent"})]})]}),r.jsxs("label",{children:["Source",r.jsxs("select",{value:a.source,onChange:f=>n({...a,source:f.target.value}),children:[r.jsx("option",{value:"hand",children:"Hand"}),r.jsx("option",{value:"deck",children:"Deck"})]})]}),r.jsxs("label",{children:["Anzahl",r.jsx("input",{type:"number",min:1,max:6,value:a.count,onChange:f=>n({...a,count:parseInt(f.target.value)||1})})]}),r.jsxs("label",{children:[r.jsx("input",{type:"checkbox",checked:a.faceDown,onChange:f=>n({...a,faceDown:f.target.checked})}),"Face-down"]}),r.jsxs("label",{children:["Destination",r.jsxs("select",{value:l.type,onChange:f=>n({...a,destinationRule:{...l,type:f.target.value}}),children:[r.jsx("option",{value:"other_lines",children:"Other lines (choose 1)"}),r.jsx("option",{value:"each_other_line",children:"Each other line (1 per line)"}),r.jsx("option",{value:"specific_lane",children:"Specific lane (this line)"}),r.jsx("option",{value:"each_line_with_card",children:"Each line with card"}),r.jsx("option",{value:"line_with_matching_cards",children:"Line with matching cards (choose 1)"}),r.jsx("option",{value:"under_this_card",children:"Under this card"})]})]}),(l.type==="each_line_with_card"||l.type==="line_with_matching_cards")&&r.jsxs("label",{children:["Card Filter (which cards must be in line)",r.jsxs("select",{value:((c=l.cardFilter)==null?void 0:c.faceState)||"any",onChange:f=>{const h=f.target.value;if(h==="any"){const{cardFilter:m,...g}=l;n({...a,destinationRule:g})}else n({...a,destinationRule:{...l,cardFilter:{faceState:h}}})},children:[r.jsx("option",{value:"any",children:"Any card"}),r.jsx("option",{value:"face_down",children:"Face-down cards only"}),r.jsx("option",{value:"face_up",children:"Face-up cards only"})]})]}),r.jsxs("label",{children:["Condition",r.jsxs("select",{value:((s=a.condition)==null?void 0:s.type)||"none",onChange:f=>{const h=f.target.value;if(h==="none"){const{condition:m,...g}=a;n(g)}else n(h==="per_x_cards_in_line"?{...a,condition:{type:h,cardCount:2}}:{...a,condition:{type:h}})},children:[r.jsx("option",{value:"none",children:"None (always play)"}),r.jsx("option",{value:"per_x_cards_in_line",children:"For every X cards in this line"}),r.jsx("option",{value:"only_in_lines_with_cards",children:"Only in lines where you have a card"})]})]}),((d=a.condition)==null?void 0:d.type)==="per_x_cards_in_line"&&r.jsxs("label",{children:["Cards per play (X)",r.jsx("input",{type:"number",min:1,max:6,value:a.condition.cardCount||2,onChange:f=>n({...a,condition:{...a.condition,cardCount:parseInt(f.target.value)||2}})}),r.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:'Example: "For every 2 cards in this line, play..."  X = 2'})]}),r.jsx("h5",{children:"Advanced Conditional"}),r.jsxs("label",{children:["Conditional Type",r.jsxs("select",{value:((p=a.advancedConditional)==null?void 0:p.type)||"none",onChange:f=>{if(f.target.value==="none"){const{advancedConditional:h,...m}=a;n(m)}else n({...a,advancedConditional:{type:f.target.value}})},children:[r.jsx("option",{value:"none",children:"None"}),r.jsx("option",{value:"empty_hand",children:"Only if hand is empty"}),r.jsx("option",{value:"opponent_higher_value_in_lane",children:"Only if opponent has higher value in this lane"})]})]})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Ry=({params:a,onChange:n})=>r.jsxs("div",{className:"param-editor",children:[r.jsx("h4",{children:"Protocol Effect"}),r.jsxs("label",{children:["Action",r.jsxs("select",{value:a.action,onChange:l=>n({...a,action:l.target.value}),children:[r.jsx("option",{value:"rearrange_protocols",children:"Rearrange"}),r.jsx("option",{value:"swap_protocols",children:"Swap"})]})]}),r.jsxs("label",{children:["Target",r.jsxs("select",{value:a.target,onChange:l=>n({...a,target:l.target.value}),children:[r.jsx("option",{value:"own",children:"Own"}),r.jsx("option",{value:"opponent",children:"Opponent"}),r.jsx("option",{value:"both_sequential",children:"Beide (nacheinander)"})]})]}),r.jsx("h5",{children:"Restriction (Anarchy-3)"}),r.jsxs("label",{children:[r.jsx("input",{type:"checkbox",checked:!!a.restriction,onChange:l=>{if(l.target.checked)n({...a,restriction:{disallowedProtocol:"",laneIndex:"current"}});else{const{restriction:c,...s}=a;n(s)}}}),"Add restriction (protocol cannot be on specific lane)"]}),a.restriction&&r.jsxs(r.Fragment,{children:[r.jsxs("label",{children:["Disallowed Protocol",r.jsx("input",{type:"text",value:a.restriction.disallowedProtocol,onChange:l=>n({...a,restriction:{...a.restriction,disallowedProtocol:l.target.value}}),placeholder:"e.g., Anarchy, Fire, Death"})]}),r.jsxs("label",{children:["Lane",r.jsxs("select",{value:a.restriction.laneIndex,onChange:l=>n({...a,restriction:{...a.restriction,laneIndex:l.target.value==="current"?"current":parseInt(l.target.value)}}),children:[r.jsx("option",{value:"current",children:"Current lane (where this card is)"}),r.jsx("option",{value:"0",children:"Lane 1 (Left)"}),r.jsx("option",{value:"1",children:"Lane 2 (Middle)"}),r.jsx("option",{value:"2",children:"Lane 3 (Right)"})]})]})]})]});/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Ay=({params:a,onChange:n})=>r.jsxs("div",{className:"param-editor",children:[r.jsx("h4",{children:"Reveal/Give Effect"}),r.jsxs("label",{children:["Action",r.jsxs("select",{value:a.action,onChange:l=>n({...a,action:l.target.value}),children:[r.jsx("option",{value:"reveal",children:"Reveal"}),r.jsx("option",{value:"give",children:"Give"})]})]}),r.jsxs("label",{children:["Source",r.jsxs("select",{value:a.source,onChange:l=>n({...a,source:l.target.value}),children:[r.jsx("option",{value:"own_hand",children:"Your hand"}),r.jsx("option",{value:"opponent_hand",children:"Opponent's hand"}),r.jsx("option",{value:"own_deck_top",children:"Top of your deck"}),r.jsx("option",{value:"own_deck",children:"Your entire deck"}),r.jsx("option",{value:"board",children:"Board card"})]})]}),(a.source==="own_hand"||a.source==="opponent_hand"||a.source==="board")&&r.jsxs("label",{children:["Anzahl",r.jsx("input",{type:"number",min:1,max:6,value:a.count,onChange:l=>n({...a,count:parseInt(l.target.value)||1})})]}),a.source==="board"&&r.jsxs("label",{children:["Follow-up action",r.jsxs("select",{value:a.followUpAction||"none",onChange:l=>{if(l.target.value==="none"){const{followUpAction:c,...s}=a;n(s)}else n({...a,followUpAction:l.target.value})},children:[r.jsx("option",{value:"none",children:"None"}),r.jsx("option",{value:"flip",children:"Then flip"}),r.jsx("option",{value:"shift",children:"Then shift"})]})]})]});/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Ty=({params:a,onChange:n})=>r.jsxs("div",{className:"param-editor take-effect-editor",children:[r.jsx("h4",{children:"Take Effect Parameters"}),r.jsxs("label",{children:["Card Count",r.jsx("input",{type:"number",min:1,max:6,value:a.count,onChange:l=>n({...a,count:parseInt(l.target.value)||1})})]}),r.jsxs("label",{children:["Source",r.jsx("select",{value:a.source,onChange:l=>n({...a,source:l.target.value}),children:r.jsx("option",{value:"opponent_hand",children:"Opponent's Hand"})})]}),r.jsxs("label",{children:[r.jsx("input",{type:"checkbox",checked:a.random,onChange:l=>n({...a,random:l.target.checked})}),"Random (if unchecked, you choose)"]})]}),zi=a=>{switch(a){case"draw":return{action:"draw",count:1,target:"self",source:"own_deck"};case"flip":return{action:"flip",count:1,targetFilter:{owner:"any",position:"any",faceState:"any",excludeSelf:!1},optional:!1};case"shift":return{action:"shift",targetFilter:{owner:"any",position:"any",faceState:"any"},destinationRestriction:{type:"any"}};case"delete":return{action:"delete",count:1,targetFilter:{position:"any",faceState:"any"},scope:{type:"anywhere"},excludeSelf:!1};case"discard":return{action:"discard",count:1,actor:"self"};case"return":return{action:"return",count:1,targetFilter:{},scope:{type:"any_card"}};case"play":return{action:"play",source:"hand",count:1,faceDown:!1,destinationRule:{type:"other_lines"}};case"rearrange_protocols":return{action:"rearrange_protocols",target:"own"};case"swap_protocols":return{action:"swap_protocols",target:"own"};case"reveal":case"give":return{action:a,source:"own_hand",count:1};case"take":return{action:"take",source:"opponent_hand",count:1,random:!0};default:return{}}},X0=({params:a,onChange:n})=>{const[l,c]=re.useState(""),[s,d]=re.useState(""),[p,f]=re.useState(null),h=a.options||[],m=h[0],g=h[1],y=()=>{if(!l)return;const N={id:Be(),params:zi(l),position:"middle",trigger:"on_play"};n({...a,options:[N,g].filter(Boolean)}),c(""),f(1)},w=()=>{if(!s)return;const N={id:Be(),params:zi(s),position:"middle",trigger:"on_play"};n({...a,options:[m,N].filter(Boolean)}),d(""),f(2)},_=()=>{n({...a,options:[g].filter(Boolean)}),p===1&&f(null)},b=()=>{n({...a,options:[m].filter(Boolean)}),p===2&&f(null)},k=N=>{const T={...m,params:N};n({...a,options:[T,g].filter(Boolean)})},S=N=>{const T={...g,params:N};n({...a,options:[m,T].filter(Boolean)})},$=N=>{const T=zi(N),H={...m,params:T};n({...a,options:[H,g].filter(Boolean)})},E=N=>{const T=zi(N),H={...g,params:T};n({...a,options:[m,H].filter(Boolean)})},C=(N,T)=>{switch(N.params.action){case"draw":return r.jsx(wy,{params:N.params,onChange:T});case"flip":return r.jsx(Cy,{params:N.params,onChange:T});case"shift":return r.jsx(by,{params:N.params,onChange:T});case"delete":return r.jsx(Sy,{params:N.params,onChange:T});case"discard":return r.jsx(Ey,{params:N.params,onChange:T});case"return":return r.jsx(jy,{params:N.params,onChange:T});case"play":return r.jsx(ky,{params:N.params,onChange:T});case"rearrange_protocols":case"swap_protocols":return r.jsx(Ry,{params:N.params,onChange:T});case"reveal":case"give":return r.jsx(Ay,{params:N.params,onChange:T});case"take":return r.jsx(Ty,{params:N.params,onChange:T});default:return r.jsx("div",{children:"Unknown effect type"})}};return r.jsxs("div",{style:{padding:"10px",backgroundColor:"#2c1d63",borderRadius:"4px",border:"1px solid rgba(97, 239, 255, 0.3)"},children:[r.jsx("h4",{style:{color:"#61EFFF",marginTop:0},children:"Either/Or Choice"}),r.jsx("p",{style:{color:"#F0F0F0",fontSize:"14px",marginBottom:"15px"},children:'Player chooses one of two options. Example: "Either discard 1 card or flip this card"'}),r.jsxs("div",{style:{marginBottom:"15px",padding:"10px",backgroundColor:"rgba(97, 239, 255, 0.05)",borderRadius:"4px"},children:[r.jsx("label",{style:{color:"#61EFFF",display:"block",marginBottom:"10px",fontWeight:"bold"},children:"Option 1:"}),m?r.jsxs(r.Fragment,{children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"10px"},children:[r.jsxs("select",{value:m.params.action,onChange:N=>$(N.target.value),style:{flex:1,padding:"8px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px"},children:[r.jsx("option",{value:"draw",children:"Draw Cards"}),r.jsx("option",{value:"flip",children:"Flip Cards"}),r.jsx("option",{value:"shift",children:"Shift Card"}),r.jsx("option",{value:"delete",children:"Delete Cards"}),r.jsx("option",{value:"discard",children:"Discard Cards"}),r.jsx("option",{value:"return",children:"Return to Hand"}),r.jsx("option",{value:"play",children:"Play from Hand/Deck"})]}),r.jsx("button",{onClick:()=>f(p===1?null:1),style:{padding:"8px 15px",backgroundColor:p===1?"#8B0000":"#61EFFF",color:p===1?"#F0F0F0":"#0A051A",border:"none",borderRadius:"4px",cursor:"pointer",fontWeight:"bold"},children:p===1?"Hide":"Edit"}),r.jsx("button",{onClick:_,style:{padding:"8px 15px",backgroundColor:"#8B0000",color:"#F0F0F0",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Remove"})]}),p===1&&r.jsx("div",{style:{marginTop:"10px"},children:C(m,k)})]}):r.jsxs("div",{style:{display:"flex",gap:"10px"},children:[r.jsxs("select",{value:l,onChange:N=>c(N.target.value),style:{flex:1,padding:"8px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px"},children:[r.jsx("option",{value:"",children:"Choose Action"}),r.jsx("option",{value:"draw",children:"Draw Cards"}),r.jsx("option",{value:"flip",children:"Flip Cards"}),r.jsx("option",{value:"shift",children:"Shift Card"}),r.jsx("option",{value:"delete",children:"Delete Cards"}),r.jsx("option",{value:"discard",children:"Discard Cards"}),r.jsx("option",{value:"return",children:"Return to Hand"}),r.jsx("option",{value:"play",children:"Play from Hand/Deck"})]}),r.jsx("button",{onClick:y,disabled:!l,style:{padding:"8px 15px",backgroundColor:l?"#61EFFF":"#444",color:"#0A051A",border:"none",borderRadius:"4px",cursor:l?"pointer":"not-allowed",fontWeight:"bold"},children:"Add"})]})]}),r.jsxs("div",{style:{padding:"10px",backgroundColor:"rgba(97, 239, 255, 0.05)",borderRadius:"4px"},children:[r.jsx("label",{style:{color:"#61EFFF",display:"block",marginBottom:"10px",fontWeight:"bold"},children:"Option 2:"}),g?r.jsxs(r.Fragment,{children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"10px"},children:[r.jsxs("select",{value:g.params.action,onChange:N=>E(N.target.value),style:{flex:1,padding:"8px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px"},children:[r.jsx("option",{value:"draw",children:"Draw Cards"}),r.jsx("option",{value:"flip",children:"Flip Cards"}),r.jsx("option",{value:"shift",children:"Shift Card"}),r.jsx("option",{value:"delete",children:"Delete Cards"}),r.jsx("option",{value:"discard",children:"Discard Cards"}),r.jsx("option",{value:"return",children:"Return to Hand"}),r.jsx("option",{value:"play",children:"Play from Hand/Deck"})]}),r.jsx("button",{onClick:()=>f(p===2?null:2),style:{padding:"8px 15px",backgroundColor:p===2?"#8B0000":"#61EFFF",color:p===2?"#F0F0F0":"#0A051A",border:"none",borderRadius:"4px",cursor:"pointer",fontWeight:"bold"},children:p===2?"Hide":"Edit"}),r.jsx("button",{onClick:b,style:{padding:"8px 15px",backgroundColor:"#8B0000",color:"#F0F0F0",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Remove"})]}),p===2&&r.jsx("div",{style:{marginTop:"10px"},children:C(g,S)})]}):r.jsxs("div",{style:{display:"flex",gap:"10px"},children:[r.jsxs("select",{value:s,onChange:N=>d(N.target.value),style:{flex:1,padding:"8px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px"},children:[r.jsx("option",{value:"",children:"Choose Action"}),r.jsx("option",{value:"draw",children:"Draw Cards"}),r.jsx("option",{value:"flip",children:"Flip Cards"}),r.jsx("option",{value:"shift",children:"Shift Card"}),r.jsx("option",{value:"delete",children:"Delete Cards"}),r.jsx("option",{value:"discard",children:"Discard Cards"}),r.jsx("option",{value:"return",children:"Return to Hand"}),r.jsx("option",{value:"play",children:"Play from Hand/Deck"})]}),r.jsx("button",{onClick:w,disabled:!s,style:{padding:"8px 15px",backgroundColor:s?"#61EFFF":"#444",color:"#0A051A",border:"none",borderRadius:"4px",cursor:s?"pointer":"not-allowed",fontWeight:"bold"},children:"Add"})]})]}),h.length===2&&r.jsx("div",{style:{marginTop:"15px",padding:"10px",backgroundColor:"rgba(97, 239, 255, 0.1)",borderRadius:"4px"},children:r.jsx("p",{style:{color:"#61EFFF",fontSize:"14px",margin:0},children:" Both options configured. Player will choose one during gameplay."})})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Z0=({params:a,onChange:n})=>{var h,m,g,y,w,_;const l=((h=a.rule)==null?void 0:h.type)||"block_all_play",c=((m=a.rule)==null?void 0:m.target)||"opponent",s=((g=a.rule)==null?void 0:g.scope)||"this_lane",d=((y=a.rule)==null?void 0:y.onlyDuringYourTurn)||!1,p=((w=a.rule)==null?void 0:w.conditionTarget)||"self",f=((_=a.rule)==null?void 0:_.blockTarget)||"self";return r.jsxs("div",{className:"param-editor passive-rule-editor",children:[r.jsx("h4",{children:"Passive Rule Parameters"}),r.jsx("p",{style:{color:"#8A79E8",fontSize:"14px",marginBottom:"15px"},children:"This rule is active while the card is face-up. It modifies game behavior."}),r.jsxs("label",{children:["Rule Type",r.jsxs("select",{value:l,onChange:b=>n({...a,rule:{...a.rule,type:b.target.value,target:c,scope:s}}),children:[r.jsxs("optgroup",{label:"Play Restrictions",children:[r.jsx("option",{value:"block_face_down_play",children:"Block Face-Down Plays (Metal-2)"}),r.jsx("option",{value:"block_face_up_play",children:"Block Face-Up Plays"}),r.jsx("option",{value:"block_all_play",children:"Block All Plays (Plague-0)"}),r.jsx("option",{value:"require_face_down_play",children:"Require Face-Down Plays (Psychic-1)"})]}),r.jsxs("optgroup",{label:"Protocol Matching",children:[r.jsx("option",{value:"allow_any_protocol_play",children:"Allow Any Protocol (Spirit-1, Chaos-3)"}),r.jsx("option",{value:"allow_play_on_opponent_side",children:"Allow Play on Opponent Side (Corruption-0)"}),r.jsx("option",{value:"require_non_matching_protocol",children:"Require Non-Matching (Anarchy-1)"})]}),r.jsxs("optgroup",{label:"Action Blocks",children:[r.jsx("option",{value:"block_flips",children:"Block Flips (Frost-1)"}),r.jsx("option",{value:"block_protocol_rearrange",children:"Block Protocol Rearrange (Frost-1)"}),r.jsx("option",{value:"block_shifts_from_lane",children:"Block Shifts From Lane (Frost-3)"}),r.jsx("option",{value:"block_shifts_to_lane",children:"Block Shifts To Lane (Frost-3)"}),r.jsx("option",{value:"block_flip_this_card",children:"This Card Cannot Be Flipped"})]}),r.jsx("optgroup",{label:"Draw Restrictions",children:r.jsx("option",{value:"block_draw_conditional",children:"Conditional Draw Block"})}),r.jsx("optgroup",{label:"Effect Modifications",children:r.jsx("option",{value:"ignore_middle_commands",children:"Ignore Middle Commands (Apathy-2)"})}),r.jsx("optgroup",{label:"Phase Modifications",children:r.jsx("option",{value:"skip_check_cache_phase",children:"Skip Check Cache Phase (Spirit-0)"})})]})]}),r.jsxs("label",{children:["Affected Player",r.jsxs("select",{value:c,onChange:b=>n({...a,rule:{...a.rule,type:l,target:b.target.value,scope:s}}),children:[r.jsx("option",{value:"self",children:"Self (You)"}),r.jsx("option",{value:"opponent",children:"Opponent"}),r.jsx("option",{value:"all",children:"All Players"})]})]}),r.jsxs("label",{children:["Scope",r.jsxs("select",{value:s,onChange:b=>n({...a,rule:{...a.rule,type:l,target:c,scope:b.target.value,onlyDuringYourTurn:d}}),children:[r.jsx("option",{value:"this_lane",children:"This Lane Only"}),r.jsx("option",{value:"global",children:"Global (All Lanes)"})]})]}),l==="ignore_middle_commands"&&r.jsxs("label",{children:[r.jsx("input",{type:"checkbox",checked:d,onChange:b=>n({...a,rule:{...a.rule,type:l,target:c,scope:s,onlyDuringYourTurn:b.target.checked}})}),"Only during your turn",r.jsx("small",{style:{display:"block",marginLeft:"24px",marginTop:"4px",color:"#8A79E8"},children:"Effect only applies during card owner's turn, not during opponent's turn."})]}),l==="block_draw_conditional"&&r.jsxs(r.Fragment,{children:[r.jsxs("label",{children:["Condition (who must have cards in hand)",r.jsxs("select",{value:p,onChange:b=>n({...a,rule:{...a.rule,type:l,target:"this_card",scope:"global",conditionTarget:b.target.value,blockTarget:f}}),children:[r.jsx("option",{value:"self",children:"Card owner (you)"}),r.jsx("option",{value:"opponent",children:"Opponent of card owner"})]}),r.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"If this player has any cards in hand, the draw block activates."})]}),r.jsxs("label",{children:["Block target (who cannot draw)",r.jsxs("select",{value:f,onChange:b=>n({...a,rule:{...a.rule,type:l,target:"this_card",scope:"global",conditionTarget:p,blockTarget:b.target.value}}),children:[r.jsx("option",{value:"self",children:"Card owner (you)"}),r.jsx("option",{value:"opponent",children:"Opponent of card owner"}),r.jsx("option",{value:"all",children:"Both players"})]}),r.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"This player cannot draw cards when the condition is met."})]})]}),l==="block_flip_this_card"&&r.jsx("small",{style:{display:"block",marginTop:"8px",color:"#8A79E8"},children:"This card cannot be flipped by any effect. Only affects this specific card."})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const K0=({params:a,onChange:n})=>{var y,w,_,b,k,S,$,E,C;const l=((y=a.modifier)==null?void 0:y.type)||"add_per_condition",c=((w=a.modifier)==null?void 0:w.value)||1,s=((_=a.modifier)==null?void 0:_.condition)||"per_face_down_card",d=((b=a.modifier)==null?void 0:b.target)||"own_total",p=((k=a.modifier)==null?void 0:k.scope)||"this_lane",f=(($=(S=a.modifier)==null?void 0:S.filter)==null?void 0:$.faceState)||"face_down",h=((C=(E=a.modifier)==null?void 0:E.filter)==null?void 0:C.position)||"any",m=l==="add_per_condition",g=l==="set_to_fixed"&&(d==="own_cards"||d==="opponent_cards"||d==="all_cards");return r.jsxs("div",{className:"param-editor value-modifier-editor",children:[r.jsx("h4",{children:"Value Modifier Parameters"}),r.jsx("p",{style:{color:"#8A79E8",fontSize:"14px",marginBottom:"15px"},children:"This modifier is active while the card is face-up. It modifies card values or lane totals."}),r.jsxs("label",{children:["Modifier Type",r.jsxs("select",{value:l,onChange:N=>n({...a,modifier:{...a.modifier,type:N.target.value,value:c,condition:m?s:void 0,target:d,scope:p,filter:g?{faceState:f,position:h}:void 0}}),children:[r.jsx("option",{value:"add_per_condition",children:"Add Per Condition (Apathy-0: +1 per face-down)"}),r.jsx("option",{value:"set_to_fixed",children:"Set Cards To Fixed Value (Darkness-2: face-down = 4)"}),r.jsx("option",{value:"add_to_total",children:"Add To Lane Total (Metal-0: opponent total -2)"})]})]}),r.jsxs("label",{children:["Value",r.jsx("input",{type:"number",value:c,onChange:N=>n({...a,modifier:{...a.modifier,type:l,value:parseInt(N.target.value)||0,condition:m?s:void 0,target:d,scope:p,filter:g?{faceState:f,position:h}:void 0}}),style:{width:"100%",padding:"8px",marginTop:"5px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px"}}),r.jsxs("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:[l==="add_per_condition"&&"Value to add per condition (e.g., +1)",l==="set_to_fixed"&&"Fixed value to set cards to (e.g., 4)",l==="add_to_total"&&"Value to add to total (use negative for subtraction, e.g., -2)"]})]}),m&&r.jsxs("label",{children:["Condition",r.jsxs("select",{value:s,onChange:N=>n({...a,modifier:{...a.modifier,type:l,value:c,condition:N.target.value,target:d,scope:p,filter:g?{faceState:f,position:h}:void 0}}),children:[r.jsx("option",{value:"per_face_down_card",children:"Per Face-Down Card"}),r.jsx("option",{value:"per_face_up_card",children:"Per Face-Up Card"}),r.jsx("option",{value:"per_card",children:"Per Card (any)"}),r.jsx("option",{value:"per_card_in_hand",children:"Per Card in Your Hand"})]})]}),r.jsxs("label",{children:["Target",r.jsxs("select",{value:d,onChange:N=>n({...a,modifier:{...a.modifier,type:l,value:c,condition:m?s:void 0,target:N.target.value,scope:p,filter:g?{faceState:f,position:h}:void 0}}),children:[r.jsxs("optgroup",{label:"Card Values",children:[r.jsx("option",{value:"own_cards",children:"Own Cards"}),r.jsx("option",{value:"opponent_cards",children:"Opponent Cards"}),r.jsx("option",{value:"all_cards",children:"All Cards"})]}),r.jsxs("optgroup",{label:"Lane Totals",children:[r.jsx("option",{value:"own_total",children:"Own Total"}),r.jsx("option",{value:"opponent_total",children:"Opponent Total"})]})]})]}),g&&r.jsxs(r.Fragment,{children:[r.jsxs("label",{children:["Card Face State (Filter)",r.jsxs("select",{value:f,onChange:N=>n({...a,modifier:{...a.modifier,type:l,value:c,condition:m?s:void 0,target:d,scope:p,filter:{faceState:N.target.value,position:h}}}),children:[r.jsx("option",{value:"face_down",children:"Face-Down Only"}),r.jsx("option",{value:"face_up",children:"Face-Up Only"}),r.jsx("option",{value:"any",children:"Any"})]})]}),r.jsxs("label",{children:["Card Position (Filter)",r.jsxs("select",{value:h,onChange:N=>n({...a,modifier:{...a.modifier,type:l,value:c,condition:m?s:void 0,target:d,scope:p,filter:{faceState:f,position:N.target.value}}}),children:[r.jsx("option",{value:"any",children:"Any Position"}),r.jsx("option",{value:"covered",children:"Covered Only"}),r.jsx("option",{value:"uncovered",children:"Uncovered Only"})]})]})]}),r.jsxs("label",{children:["Scope",r.jsxs("select",{value:p,onChange:N=>n({...a,modifier:{...a.modifier,type:l,value:c,condition:m?s:void 0,target:d,scope:N.target.value,filter:g?{faceState:f,position:h}:void 0}}),children:[r.jsx("option",{value:"this_lane",children:"This Lane Only"}),r.jsx("option",{value:"global",children:"Global (All Lanes)"})]})]})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const J0=({params:a,onChange:n})=>r.jsxs("div",{className:"param-editor block-compile-effect-editor",children:[r.jsx("h4",{children:"Block Compile Effect Parameters"}),r.jsxs("label",{children:["Target",r.jsxs("select",{value:a.target||"opponent",onChange:l=>n({...a,target:l.target.value}),children:[r.jsx("option",{value:"opponent",children:"Opponent cannot compile next turn"}),r.jsx("option",{value:"self",children:"You cannot compile next turn"})]})]})]});/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const ex=({params:a,onChange:n})=>{var c;const l=((c=a.laneCondition)==null?void 0:c.count)||8;return r.jsxs("div",{className:"param-editor delete-all-in-lane-effect-editor",children:[r.jsx("h4",{children:"Delete All In Lane Effect Parameters"}),r.jsxs("label",{children:["Minimum cards in lane",r.jsxs("select",{value:l,onChange:s=>n({...a,laneCondition:{type:"min_cards",count:parseInt(s.target.value)}}),children:[r.jsx("option",{value:0,children:"No minimum (any lane)"}),r.jsx("option",{value:4,children:"4 or more cards"}),r.jsx("option",{value:6,children:"6 or more cards"}),r.jsx("option",{value:8,children:"8 or more cards (Metal-3)"}),r.jsx("option",{value:10,children:"10 or more cards"})]})]}),r.jsxs("label",{children:[r.jsx("input",{type:"checkbox",checked:a.excludeCurrentLane!==!1,onChange:s=>n({...a,excludeCurrentLane:s.target.checked})}),"Exclude current lane (other lanes only)"]})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const tx=({params:a,onChange:n})=>r.jsxs("div",{className:"param-editor",children:[r.jsx("h4",{children:"Shuffle Trash Effect"}),r.jsx("p",{style:{color:"#8A79E8",fontSize:"14px",marginBottom:"15px"},children:"Shuffle your trash (discarded/deleted cards) back into your deck."}),r.jsxs("label",{children:[r.jsx("input",{type:"checkbox",checked:a.optional!==!1,onChange:l=>n({...a,optional:l.target.checked})}),'Optional ("You may shuffle...")']})]}),nx=({params:a})=>r.jsxs("div",{className:"param-editor",children:[r.jsx("h4",{children:"Shuffle Deck Effect"}),r.jsx("p",{style:{color:"#8A79E8",fontSize:"14px",marginBottom:"15px"},children:"Shuffle your deck. Typically used after revealing the deck."})]}),Vi=a=>{switch(a){case"draw":return{action:"draw",count:1,target:"self",source:"own_deck"};case"refresh":return{action:"refresh",target:"self"};case"mutual_draw":return{action:"mutual_draw",count:1};case"flip":return{action:"flip",count:1,targetFilter:{owner:"any",position:"any",faceState:"any",excludeSelf:!1},optional:!1};case"shift":return{action:"shift",targetFilter:{owner:"any",position:"any",faceState:"any"},destinationRestriction:{type:"any"}};case"delete":return{action:"delete",count:1,targetFilter:{position:"any",faceState:"any"},scope:{type:"anywhere"},excludeSelf:!1};case"discard":return{action:"discard",count:1,actor:"self"};case"return":return{action:"return",count:1,targetFilter:{},scope:{type:"any_card"}};case"play":return{action:"play",source:"hand",count:1,faceDown:!1,destinationRule:{type:"other_lines"}};case"rearrange_protocols":return{action:"rearrange_protocols",target:"own"};case"swap_protocols":return{action:"swap_protocols",target:"own"};case"reveal":case"give":return{action:a,source:"own_hand",count:1};case"take":return{action:"take",source:"opponent_hand",count:1,random:!0};case"choice":return{action:"choice",options:[]};case"passive_rule":return{action:"passive_rule",rule:{type:"block_all_play",target:"opponent",scope:"this_lane"}};case"value_modifier":return{action:"value_modifier",modifier:{type:"add_per_condition",value:1,condition:"per_face_down_card",target:"own_total",scope:"this_lane"}};case"block_compile":return{action:"block_compile",target:"opponent"};case"delete_all_in_lane":return{action:"delete_all_in_lane",laneCondition:{type:"min_cards",count:8},excludeCurrentLane:!0};case"shuffle_trash":return{action:"shuffle_trash",optional:!0};case"shuffle_deck":return{action:"shuffle_deck"};case"redirect_return_to_deck":return{action:"redirect_return_to_deck",faceDown:!0};default:return{}}},ax=({effect:a,onChange:n,readOnly:l=!1})=>{const c=_=>{l||n({...a,params:_})},s=_=>{if(_){const b={id:Be(),params:Vi("draw"),position:a.position,trigger:a.trigger};n({...a,conditional:{type:"then",thenEffect:b}})}else{const{conditional:b,...k}=a;n(k)}},d=_=>{a.conditional&&n({...a,conditional:{...a.conditional,type:_}})},p=_=>{a.conditional&&n({...a,conditional:{...a.conditional,thenEffect:_}})},f=_=>{if(!a.conditional)return;const b=Vi(_),k={...a.conditional.thenEffect,params:b};n({...a,conditional:{...a.conditional,thenEffect:k}})},h=_=>{if(a.conditional)if(_){const b={id:Be(),params:Vi("delete"),position:a.position,trigger:a.trigger};n({...a,conditional:{...a.conditional,thenEffect:{...a.conditional.thenEffect,conditional:{type:"then",thenEffect:b}}}})}else{const{conditional:b,...k}=a.conditional.thenEffect;n({...a,conditional:{...a.conditional,thenEffect:k}})}},m=_=>{var b;(b=a.conditional)!=null&&b.thenEffect.conditional&&n({...a,conditional:{...a.conditional,thenEffect:{...a.conditional.thenEffect,conditional:{...a.conditional.thenEffect.conditional,type:_}}}})},g=_=>{var b;(b=a.conditional)!=null&&b.thenEffect.conditional&&n({...a,conditional:{...a.conditional,thenEffect:{...a.conditional.thenEffect,conditional:{...a.conditional.thenEffect.conditional,thenEffect:_}}}})},y=_=>{var S;if(!((S=a.conditional)!=null&&S.thenEffect.conditional))return;const b=Vi(_),k={...a.conditional.thenEffect.conditional.thenEffect,params:b};n({...a,conditional:{...a.conditional,thenEffect:{...a.conditional.thenEffect,conditional:{...a.conditional.thenEffect.conditional,thenEffect:k}}}})},w=(_,b)=>{switch(_.params.action){case"draw":return r.jsx(wy,{params:_.params,onChange:b});case"refresh":return r.jsx(W0,{params:_.params,onChange:b});case"mutual_draw":return r.jsx(Q0,{params:_.params,onChange:b});case"flip":return r.jsx(Cy,{params:_.params,onChange:b});case"shift":return r.jsx(by,{params:_.params,onChange:b});case"delete":return r.jsx(Sy,{params:_.params,onChange:b});case"discard":return r.jsx(Ey,{params:_.params,onChange:b});case"return":return r.jsx(jy,{params:_.params,onChange:b});case"play":return r.jsx(ky,{params:_.params,onChange:b});case"rearrange_protocols":case"swap_protocols":return r.jsx(Ry,{params:_.params,onChange:b});case"reveal":case"give":return r.jsx(Ay,{params:_.params,onChange:b});case"take":return r.jsx(Ty,{params:_.params,onChange:b});case"choice":return r.jsx(X0,{params:_.params,onChange:b});case"passive_rule":return r.jsx(Z0,{params:_.params,onChange:b});case"value_modifier":return r.jsx(K0,{params:_.params,onChange:b});case"block_compile":return r.jsx(J0,{params:_.params,onChange:b});case"delete_all_in_lane":return r.jsx(ex,{params:_.params,onChange:b});case"shuffle_trash":return r.jsx(tx,{params:_.params,onChange:b});case"shuffle_deck":return r.jsx(nx,{params:_.params,onChange:b});default:return r.jsxs("div",{children:["Unknown effect type: ",_.params.action]})}};return r.jsxs("div",{className:`effect-editor ${l?"read-only-mode":""}`,children:[r.jsx("div",{className:"trigger-info",style:{marginBottom:"15px",padding:"10px",backgroundColor:"#1A113B",borderRadius:"4px",border:"1px solid rgba(97, 239, 255, 0.3)"},children:r.jsxs("div",{style:{display:"flex",gap:"20px",alignItems:"center",flexWrap:"wrap"},children:[r.jsxs("label",{style:{flex:1,minWidth:"200px"},children:[r.jsx("strong",{children:"Trigger:"}),r.jsxs("select",{value:a.trigger,onChange:_=>!l&&n({...a,trigger:_.target.value}),disabled:l,style:{width:"100%",padding:"6px",marginTop:"4px",backgroundColor:"#2c1d63",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px"},children:[r.jsx("optgroup",{label:"Immediate",children:r.jsx("option",{value:"on_play",children:"On Play"})}),r.jsx("optgroup",{label:"Passive (Top Box)",children:r.jsx("option",{value:"passive",children:"Passive (always active)"})}),r.jsxs("optgroup",{label:"Phase Triggers (Bottom Box)",children:[r.jsx("option",{value:"start",children:"Start Phase"}),r.jsx("option",{value:"end",children:"End Phase"}),r.jsx("option",{value:"on_cover",children:"When Covered"})]}),r.jsxs("optgroup",{label:"Reactive (Top Box)",children:[r.jsx("option",{value:"on_flip",children:"When this card would be flipped"}),r.jsx("option",{value:"on_cover_or_flip",children:"When covered or flipped"}),r.jsx("option",{value:"after_delete",children:"After cards are deleted"}),r.jsx("option",{value:"after_discard",children:"After cards are discarded"}),r.jsx("option",{value:"after_draw",children:"After cards are drawn"}),r.jsx("option",{value:"after_shift",children:"After cards are shifted"}),r.jsx("option",{value:"after_flip",children:"After cards are flipped"}),r.jsx("option",{value:"after_play",children:"After a card is played"}),r.jsx("option",{value:"after_clear_cache",children:"After cache is cleared"}),r.jsx("option",{value:"after_opponent_discard",children:"After opponent discards"}),r.jsx("option",{value:"before_compile_delete",children:"Before deleted by compile"}),r.jsx("option",{value:"when_card_returned",children:"When card returned to hand"})]})]})]}),r.jsxs("div",{style:{color:"#8A79E8",fontSize:"13px"},children:[r.jsx("strong",{children:"Position:"})," ",a.position.charAt(0).toUpperCase()+a.position.slice(1)," Box"]})]})}),r.jsxs("div",{className:"main-effect",children:[r.jsx("h3",{children:"Main Effect"}),w(a,c),r.jsxs("div",{className:"effect-preview",children:[r.jsx("strong",{children:"Preview:"})," ",r.jsx("span",{dangerouslySetInnerHTML:{__html:Ro([a])}})]})]}),r.jsxs("div",{style:{marginTop:"15px"},children:[r.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[r.jsx("input",{type:"checkbox",checked:!!a.useCardFromPreviousEffect,onChange:_=>n({...a,useCardFromPreviousEffect:_.target.checked})}),r.jsx("span",{children:`Use card from previous effect (for "shift THAT card", "draw equal to THAT card's value", etc.)`})]}),a.useCardFromPreviousEffect&&r.jsx("small",{style:{display:"block",marginLeft:"24px",marginTop:"4px",color:"#8A79E8"},children:"This effect will target/use the card selected by the previous effect in the chain."})]}),(a.trigger==="after_draw"||a.trigger==="after_delete"||a.trigger==="after_discard"||a.trigger==="after_shift"||a.trigger==="after_flip"||a.trigger==="after_clear_cache"||a.trigger==="after_opponent_discard"||a.trigger==="after_play")&&r.jsxs("div",{style:{marginTop:"15px"},children:[r.jsxs("label",{children:["Trigger Actor (who triggers this effect?)",r.jsxs("select",{value:a.reactiveTriggerActor||"self",onChange:_=>n({...a,reactiveTriggerActor:_.target.value}),style:{width:"100%",padding:"8px",marginTop:"5px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px",cursor:"pointer"},children:[r.jsx("option",{value:"self",children:"Only when YOU perform the action (default)"}),r.jsx("option",{value:"opponent",children:"Only when OPPONENT performs the action"}),r.jsx("option",{value:"any",children:"When ANYONE performs the action"})]})]}),r.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:a.reactiveTriggerActor==="self"||!a.reactiveTriggerActor?"Effect triggers only when YOU delete/draw/etc.":a.reactiveTriggerActor==="opponent"?"Effect triggers only when OPPONENT deletes/draws/etc.":"Effect triggers when ANYONE deletes/draws/etc."})]}),(a.trigger==="after_play"||a.trigger==="after_shift"||a.trigger==="after_flip"||a.trigger==="after_delete")&&r.jsxs("div",{style:{marginTop:"15px"},children:[r.jsxs("label",{children:["Reactive Scope",r.jsxs("select",{value:a.reactiveScope||"global",onChange:_=>n({...a,reactiveScope:_.target.value}),style:{width:"100%",padding:"8px",marginTop:"5px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px",cursor:"pointer"},children:[r.jsx("option",{value:"global",children:"Any lane (default)"}),r.jsx("option",{value:"this_lane",children:"This lane only"})]})]}),r.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:a.reactiveScope==="this_lane"?"Effect only triggers when the action happens in the same lane as this card.":"Effect triggers when the action happens anywhere on the board."})]}),r.jsxs("div",{className:"conditional-section",style:{marginTop:"20px",borderTop:"1px solid #2c1d63",paddingTop:"15px"},children:[r.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"10px"},children:[r.jsx("input",{type:"checkbox",checked:!!a.conditional,onChange:_=>s(_.target.checked)}),r.jsx("strong",{children:"Add follow-up effect"})]}),a.conditional&&r.jsxs("div",{className:"follow-up-effect",style:{marginLeft:"20px",padding:"10px",backgroundColor:"#2c1d63",borderRadius:"4px",border:"1px solid rgba(97, 239, 255, 0.2)"},children:[r.jsx("h4",{style:{marginTop:0},children:"Follow-Up Effect"}),r.jsxs("label",{children:["Connection Type",r.jsxs("select",{value:a.conditional.type||"then",onChange:_=>d(_.target.value),style:{width:"100%",padding:"8px",marginTop:"5px",marginBottom:"15px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px",cursor:"pointer"},children:[r.jsx("option",{value:"then",children:"Then (always executes)"}),r.jsx("option",{value:"if_executed",children:"If you do (only if first effect succeeds)"})]})]}),r.jsxs("label",{children:["Effect Type",r.jsxs("select",{value:a.conditional.thenEffect.params.action,onChange:_=>f(_.target.value),style:{width:"100%",padding:"8px",marginTop:"5px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px",cursor:"pointer"},children:[r.jsx("option",{value:"draw",children:"Draw Cards"}),r.jsx("option",{value:"refresh",children:"Refresh Hand"}),r.jsx("option",{value:"mutual_draw",children:"Mutual Draw (Exchange)"}),r.jsx("option",{value:"flip",children:"Flip Cards"}),r.jsx("option",{value:"shift",children:"Shift Card"}),r.jsx("option",{value:"delete",children:"Delete Cards"}),r.jsx("option",{value:"delete_all_in_lane",children:"Delete All in Lane"}),r.jsx("option",{value:"discard",children:"Discard Cards"}),r.jsx("option",{value:"return",children:"Return to Hand"}),r.jsx("option",{value:"play",children:"Play from Hand/Deck"}),r.jsx("option",{value:"rearrange_protocols",children:"Rearrange Protocols"}),r.jsx("option",{value:"swap_protocols",children:"Swap Protocols"}),r.jsx("option",{value:"reveal",children:"Reveal Hand"}),r.jsx("option",{value:"give",children:"Give Cards"}),r.jsx("option",{value:"take",children:"Take from Hand"}),r.jsx("option",{value:"choice",children:"Either/Or Choice"}),r.jsx("option",{value:"block_compile",children:"Block Compile"}),r.jsx("option",{value:"shuffle_trash",children:"Shuffle Trash into Deck"}),r.jsx("option",{value:"shuffle_deck",children:"Shuffle Deck"})]})]}),r.jsx("div",{style:{marginTop:"15px"},children:w(a.conditional.thenEffect,_=>p({...a.conditional.thenEffect,params:_}))}),r.jsxs("div",{className:"nested-conditional-section",style:{marginTop:"15px",borderTop:"1px solid rgba(97, 239, 255, 0.2)",paddingTop:"15px"},children:[r.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"10px"},children:[r.jsx("input",{type:"checkbox",checked:!!a.conditional.thenEffect.conditional,onChange:_=>h(_.target.checked)}),r.jsx("strong",{children:"Add 2nd follow-up effect"})]}),a.conditional.thenEffect.conditional&&r.jsxs("div",{className:"nested-follow-up-effect",style:{marginLeft:"10px",padding:"10px",backgroundColor:"#1A113B",borderRadius:"4px",border:"1px solid rgba(97, 239, 255, 0.2)"},children:[r.jsx("h5",{style:{marginTop:0,fontSize:"0.9rem"},children:"2nd Follow-Up Effect"}),r.jsxs("label",{children:["Connection Type",r.jsxs("select",{value:a.conditional.thenEffect.conditional.type||"then",onChange:_=>m(_.target.value),style:{width:"100%",padding:"6px",marginTop:"5px",marginBottom:"10px",backgroundColor:"#0D0825",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px",cursor:"pointer",fontSize:"0.9rem"},children:[r.jsx("option",{value:"then",children:"Then (always executes)"}),r.jsx("option",{value:"if_executed",children:"If you do (only if first effect succeeds)"})]})]}),r.jsxs("label",{children:["Effect Type",r.jsxs("select",{value:a.conditional.thenEffect.conditional.thenEffect.params.action,onChange:_=>y(_.target.value),style:{width:"100%",padding:"6px",marginTop:"5px",backgroundColor:"#0D0825",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px",cursor:"pointer",fontSize:"0.9rem"},children:[r.jsx("option",{value:"draw",children:"Draw Cards"}),r.jsx("option",{value:"refresh",children:"Refresh Hand"}),r.jsx("option",{value:"mutual_draw",children:"Mutual Draw (Exchange)"}),r.jsx("option",{value:"flip",children:"Flip Cards"}),r.jsx("option",{value:"shift",children:"Shift Card"}),r.jsx("option",{value:"delete",children:"Delete Cards"}),r.jsx("option",{value:"delete_all_in_lane",children:"Delete All in Lane"}),r.jsx("option",{value:"discard",children:"Discard Cards"}),r.jsx("option",{value:"return",children:"Return to Hand"}),r.jsx("option",{value:"play",children:"Play from Hand/Deck"}),r.jsx("option",{value:"rearrange_protocols",children:"Rearrange Protocols"}),r.jsx("option",{value:"swap_protocols",children:"Swap Protocols"}),r.jsx("option",{value:"reveal",children:"Reveal Hand"}),r.jsx("option",{value:"give",children:"Give Cards"}),r.jsx("option",{value:"take",children:"Take from Hand"}),r.jsx("option",{value:"choice",children:"Either/Or Choice"}),r.jsx("option",{value:"block_compile",children:"Block Compile"}),r.jsx("option",{value:"shuffle_trash",children:"Shuffle Trash into Deck"}),r.jsx("option",{value:"shuffle_deck",children:"Shuffle Deck"})]})]}),r.jsx("div",{style:{marginTop:"10px"},children:w(a.conditional.thenEffect.conditional.thenEffect,_=>g({...a.conditional.thenEffect.conditional.thenEffect,params:_}))})]})]})]})]})]})},ox=({card:a,protocolName:n,protocolColor:l,protocolPattern:c,onChange:s,readOnly:d=!1})=>{const[p,f]=re.useState(null),[h,m]=re.useState(null),[g,y]=re.useState(!1);re.useEffect(()=>{f(null)},[a.value]);const w=(j,F,M)=>{const L={id:Be(),params:rx(F),position:j,trigger:M},D={...a};j==="top"?D.topEffects=[...D.topEffects,L]:j==="middle"?D.middleEffects=[...D.middleEffects,L]:D.bottomEffects=[...D.bottomEffects,L],s(D);const O=j==="top"?D.topEffects.length-1:j==="middle"?D.middleEffects.length-1:D.bottomEffects.length-1;f({box:j,effectIndex:O,effect:L})},_=(j,F)=>{m({box:j,effectIndex:F})},b=()=>{if(!h)return;const{box:j,effectIndex:F}=h,M={...a};j==="top"?M.topEffects.splice(F,1):j==="middle"?M.middleEffects.splice(F,1):M.bottomEffects.splice(F,1),s(M),p&&p.box===j&&p.effectIndex===F&&f(null),m(null)},k=j=>{if(!p)return;const{box:F,effectIndex:M}=p,L={...a};F==="top"?(L.topEffects=[...L.topEffects],L.topEffects[M]=j):F==="middle"?(L.middleEffects=[...L.middleEffects],L.middleEffects[M]=j):(L.bottomEffects=[...L.bottomEffects],L.bottomEffects[M]=j),s(L),f({box:F,effectIndex:M,effect:j})},S=(j,F)=>{const M=j==="top"?a.topEffects[F]:j==="middle"?a.middleEffects[F]:a.bottomEffects[F];f({box:j,effectIndex:F,effect:M})},$=(j,F)=>{const M=(F==null?void 0:F.reactiveTriggerActor)||"self",L=(F==null?void 0:F.reactiveScope)||"global";if(j==="after_play")return`After ${M==="opponent"?"your opponent plays":M==="any"?"a card is played":"you play"} a card${L==="this_lane"?" in this line":""}`;if(["after_delete","after_discard","after_draw","after_shift","after_flip"].includes(j)){const D={after_delete:"delete cards",after_discard:"discard cards",after_draw:"draw cards",after_shift:"shift cards",after_flip:"flip cards"},O=M==="opponent"?"your opponent":M==="any"?"anyone":"you",X=L==="this_lane"?" in this line":"";return`After ${O} ${D[j]}${X}`}switch(j){case"passive":return"";case"on_play":return"";case"start":return"Start";case"end":return"End";case"on_cover":return"On Cover";case"after_opponent_discard":return"After opponent discards";case"after_clear_cache":return"After you clear cache";case"before_compile_delete":return"Before deleted by compile";case"on_flip":return"When this card would be flipped";case"on_cover_or_flip":return"When covered or flipped";default:return j}},E=j=>{const F={...a,value:j};s(F)},C=Ro(a.topEffects),N=Ro(a.middleEffects),T=Ro(a.bottomEffects),H=JSON.stringify({top:a.topEffects.map(j=>({id:j.id,params:j.params})),middle:a.middleEffects.map(j=>({id:j.id,params:j.params})),bottom:a.bottomEffects.map(j=>({id:j.id,params:j.params}))}),q=`${n}-${a.value}-${H}`,B={id:q,protocol:n,value:a.value,top:C,middle:N,bottom:T,isFaceUp:!0,owner:"player",laneIndex:0,category:"Custom",keywords:{}},K=(j,F)=>{j=j.replace("#","");const M=parseInt(j.substring(0,2),16),L=parseInt(j.substring(2,4),16),D=parseInt(j.substring(4,6),16);return`rgba(${M}, ${L}, ${D}, ${F})`},U=`card-custom-preview pattern-${c}`,R={"--custom-color":l,"--custom-color-alpha-05":K(l,.05),"--custom-color-alpha-06":K(l,.06),"--custom-color-alpha-08":K(l,.08),"--custom-color-alpha-10":K(l,.1),"--custom-color-alpha-15":K(l,.15),"--custom-color-alpha-20":K(l,.2),"--custom-color-alpha-25":K(l,.25),borderColor:l};return r.jsxs("div",{className:"card-editor-container",children:[r.jsxs("div",{className:"card-editor-content",children:[r.jsxs("div",{className:"card-live-preview",children:[r.jsx("h4",{children:"Card Preview"}),r.jsxs("label",{className:"card-value-selector",children:["Card Value:",r.jsxs("select",{value:a.value,onChange:j=>E(Number(j.target.value)),children:[r.jsx("option",{value:-1,children:"-1"}),r.jsx("option",{value:0,children:"0"}),r.jsx("option",{value:1,children:"1"}),r.jsx("option",{value:2,children:"2"}),r.jsx("option",{value:3,children:"3"}),r.jsx("option",{value:4,children:"4"}),r.jsx("option",{value:5,children:"5"}),r.jsx("option",{value:6,children:"6"})]})]}),r.jsx("div",{className:"card-preview-wrapper",style:R,children:r.jsx(vt,{card:B,isFaceUp:!0,additionalClassName:U},q)})]}),r.jsx("div",{className:"card-effects-editor",children:r.jsxs("div",{className:"card-preview",style:{borderColor:l},children:[r.jsx("div",{className:"card-header",style:{backgroundColor:l},children:r.jsxs("h3",{children:[n,"-",a.value]})}),r.jsxs("div",{className:"card-box top-box",children:[r.jsx("h4",{children:"Top Box (Passive/Reactive)"}),r.jsx("p",{className:"box-description",children:"Passive effects or reactive triggers"}),r.jsxs("div",{className:"effects-list",children:[a.topEffects.map((j,F)=>r.jsxs("div",{className:"effect-item",children:[r.jsxs("span",{onClick:()=>S("top",F),className:d?"read-only-clickable":"",children:[j.trigger!=="passive"&&r.jsxs("strong",{children:[$(j.trigger,j),":"]})," ",_r(j)]}),!d&&r.jsx("button",{onClick:()=>_("top",F),children:""})]},j.id)),a.topEffects.length===0&&r.jsx("p",{className:"empty-box",children:"No effects"})]}),!d&&r.jsxs("div",{className:"add-effect-controls",children:[r.jsxs("select",{id:"top-trigger",defaultValue:"",children:[r.jsx("option",{value:"",children:"Choose Trigger"}),r.jsx("optgroup",{label:"Passive",children:r.jsx("option",{value:"passive",children:"Passive (always active)"})}),r.jsxs("optgroup",{label:"Phase Triggers",children:[r.jsx("option",{value:"start",children:"Start Phase"}),r.jsx("option",{value:"end",children:"End Phase"}),r.jsx("option",{value:"on_cover",children:"On Cover"})]}),r.jsxs("optgroup",{label:"Reactive Triggers",children:[r.jsx("option",{value:"after_delete",children:"After you delete cards"}),r.jsx("option",{value:"after_opponent_discard",children:"After opponent discards"}),r.jsx("option",{value:"after_draw",children:"After you draw cards"}),r.jsx("option",{value:"after_clear_cache",children:"After you clear cache"}),r.jsx("option",{value:"before_compile_delete",children:"Before deleted by compile"}),r.jsx("option",{value:"after_flip",children:"After cards are flipped"}),r.jsx("option",{value:"after_shift",children:"After cards are shifted"}),r.jsx("option",{value:"after_play",children:"After cards are played"}),r.jsx("option",{value:"on_flip",children:"When this card would be flipped"}),r.jsx("option",{value:"on_cover_or_flip",children:"When this card would be covered or flipped"})]})]}),r.jsxs("select",{id:"top-action",defaultValue:"",children:[r.jsx("option",{value:"",children:"Choose Action"}),r.jsx("option",{value:"draw",children:"Draw Cards"}),r.jsx("option",{value:"refresh",children:"Refresh Hand"}),r.jsx("option",{value:"mutual_draw",children:"Mutual Draw (Exchange)"}),r.jsx("option",{value:"flip",children:"Flip Cards"}),r.jsx("option",{value:"shift",children:"Shift Card"}),r.jsx("option",{value:"delete",children:"Delete Cards"}),r.jsx("option",{value:"discard",children:"Discard Cards"}),r.jsx("option",{value:"return",children:"Return to Hand"}),r.jsx("option",{value:"play",children:"Play from Hand/Deck"}),r.jsx("option",{value:"rearrange_protocols",children:"Rearrange Protocols"}),r.jsx("option",{value:"swap_protocols",children:"Swap Protocols"}),r.jsx("option",{value:"reveal",children:"Reveal Hand"}),r.jsx("option",{value:"give",children:"Give Cards"}),r.jsx("option",{value:"take",children:"Take from Hand"}),r.jsx("option",{value:"choice",children:"Either/Or Choice"}),r.jsx("option",{value:"passive_rule",children:"Passive Rule"}),r.jsx("option",{value:"value_modifier",children:"Value Modifier"}),r.jsx("option",{value:"block_compile",children:"Block Compile"}),r.jsx("option",{value:"delete_all_in_lane",children:"Delete All in Lane"})]}),r.jsx("button",{className:"btn btn-add-effect",onClick:()=>{const j=document.getElementById("top-trigger"),F=document.getElementById("top-action"),M=j.value,L=F.value;M&&L?(w("top",L,M),j.value="",F.value=""):y(!0)},children:"+"})]})]}),r.jsxs("div",{className:"card-box middle-box",children:[r.jsx("h4",{children:"Middle Box (On Play)"}),r.jsx("p",{className:"box-description",children:"When played or uncovered"}),r.jsxs("div",{className:"effects-list",children:[a.middleEffects.map((j,F)=>r.jsxs("div",{className:"effect-item",children:[r.jsx("span",{onClick:()=>S("middle",F),className:d?"read-only-clickable":"",children:_r(j)}),!d&&r.jsx("button",{onClick:()=>_("middle",F),children:""})]},j.id)),a.middleEffects.length===0&&r.jsx("p",{className:"empty-box",children:"No effects"})]}),!d&&r.jsxs("select",{onChange:j=>{j.target.value&&(w("middle",j.target.value,"on_play"),j.target.value="")},children:[r.jsx("option",{value:"",children:"+ Add Effect"}),r.jsx("option",{value:"draw",children:"Draw Cards"}),r.jsx("option",{value:"refresh",children:"Refresh Hand"}),r.jsx("option",{value:"flip",children:"Flip Cards"}),r.jsx("option",{value:"shift",children:"Shift Card"}),r.jsx("option",{value:"delete",children:"Delete Cards"}),r.jsx("option",{value:"discard",children:"Discard Cards"}),r.jsx("option",{value:"return",children:"Return to Hand"}),r.jsx("option",{value:"play",children:"Play from Hand/Deck"}),r.jsx("option",{value:"rearrange_protocols",children:"Rearrange Protocols"}),r.jsx("option",{value:"swap_protocols",children:"Swap Protocols"}),r.jsx("option",{value:"reveal",children:"Reveal Hand"}),r.jsx("option",{value:"give",children:"Give Cards"}),r.jsx("option",{value:"take",children:"Take from Hand"}),r.jsx("option",{value:"choice",children:"Either/Or Choice"}),r.jsx("option",{value:"passive_rule",children:"Passive Rule"}),r.jsx("option",{value:"value_modifier",children:"Value Modifier"}),r.jsx("option",{value:"block_compile",children:"Block Compile"}),r.jsx("option",{value:"delete_all_in_lane",children:"Delete All in Lane"})]})]}),r.jsxs("div",{className:"card-box bottom-box",children:[r.jsx("h4",{children:"Bottom Box (Triggered)"}),r.jsx("p",{className:"box-description",children:"Only when uncovered AND face-up"}),r.jsxs("div",{className:"effects-list",children:[a.bottomEffects.map((j,F)=>r.jsxs("div",{className:"effect-item",children:[r.jsxs("span",{onClick:()=>S("bottom",F),className:d?"read-only-clickable":"",children:[r.jsxs("strong",{children:[$(j.trigger,j),":"]})," ",_r(j)]}),!d&&r.jsx("button",{onClick:()=>_("bottom",F),children:""})]},j.id)),a.bottomEffects.length===0&&r.jsx("p",{className:"empty-box",children:"No effects"})]}),!d&&r.jsxs("div",{className:"bottom-effect-add",children:[r.jsxs("select",{id:"bottom-trigger",children:[r.jsx("option",{value:"",children:"1. Choose Trigger"}),r.jsx("option",{value:"start",children:"Start Phase"}),r.jsx("option",{value:"end",children:"End Phase"}),r.jsx("option",{value:"on_cover",children:"On Cover"})]}),r.jsxs("select",{id:"bottom-action",children:[r.jsx("option",{value:"",children:"2. Choose Effect"}),r.jsx("option",{value:"draw",children:"Draw Cards"}),r.jsx("option",{value:"refresh",children:"Refresh Hand"}),r.jsx("option",{value:"mutual_draw",children:"Mutual Draw (Exchange)"}),r.jsx("option",{value:"flip",children:"Flip Cards"}),r.jsx("option",{value:"shift",children:"Shift Card"}),r.jsx("option",{value:"delete",children:"Delete Cards"}),r.jsx("option",{value:"discard",children:"Discard Cards"}),r.jsx("option",{value:"return",children:"Return to Hand"}),r.jsx("option",{value:"play",children:"Play from Hand/Deck"}),r.jsx("option",{value:"rearrange_protocols",children:"Rearrange Protocols"}),r.jsx("option",{value:"swap_protocols",children:"Swap Protocols"}),r.jsx("option",{value:"reveal",children:"Reveal Hand"}),r.jsx("option",{value:"give",children:"Give Cards"}),r.jsx("option",{value:"take",children:"Take from Hand"}),r.jsx("option",{value:"choice",children:"Either/Or Choice"}),r.jsx("option",{value:"passive_rule",children:"Passive Rule"}),r.jsx("option",{value:"value_modifier",children:"Value Modifier"}),r.jsx("option",{value:"block_compile",children:"Block Compile"}),r.jsx("option",{value:"delete_all_in_lane",children:"Delete All in Lane"})]}),r.jsx("button",{className:"btn btn-add-effect",onClick:()=>{const j=document.getElementById("bottom-trigger"),F=document.getElementById("bottom-action"),M=j.value,L=F.value;M&&L?(w("bottom",L,M),j.value="",F.value=""):y(!0)},children:"+"})]})]})]})})]}),p&&r.jsxs("div",{className:"effect-parameter-editor",children:[r.jsx("h3",{children:d?"View Effect":"Configure Effect"}),d&&r.jsx("div",{className:"read-only-notice",children:"This effect is read-only"}),r.jsx(ax,{effect:p.effect,onChange:k,readOnly:d}),r.jsx("button",{onClick:()=>f(null),className:"btn",children:d?"Close":"Done"})]}),h&&r.jsx("div",{className:"custom-protocol-modal-overlay",onClick:()=>m(null),children:r.jsxs("div",{className:"custom-protocol-modal-content",onClick:j=>j.stopPropagation(),children:[r.jsx("h3",{children:"Delete Effect"}),r.jsx("p",{children:"Are you sure you want to delete this effect?"}),r.jsxs("div",{className:"custom-protocol-modal-actions",children:[r.jsx("button",{onClick:()=>m(null),className:"btn btn-back",children:"Cancel"}),r.jsx("button",{onClick:b,className:"btn btn-delete",children:"Delete"})]})]})}),g&&r.jsx("div",{className:"custom-protocol-modal-overlay",onClick:()=>y(!1),children:r.jsxs("div",{className:"custom-protocol-modal-content",onClick:j=>j.stopPropagation(),children:[r.jsx("h3",{children:"Missing Selection"}),r.jsx("p",{children:"Please select both a trigger and an effect before adding."}),r.jsx("div",{className:"custom-protocol-modal-actions",children:r.jsx("button",{onClick:()=>y(!1),className:"btn",children:"OK"})})]})})]})},rx=a=>{switch(a){case"draw":return{action:"draw",count:1,target:"self",source:"own_deck"};case"flip":return{action:"flip",count:1,targetFilter:{owner:"any",position:"any",faceState:"any",excludeSelf:!1},optional:!1};case"shift":return{action:"shift",targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1}};case"delete":return{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"any"},excludeSelf:!0};case"discard":return{action:"discard",count:1,actor:"self"};case"return":return{action:"return",count:1,targetFilter:{},scope:{type:"any_card"}};case"play":return{action:"play",source:"hand",count:1,faceDown:!0,destinationRule:{type:"other_lines"}};case"rearrange_protocols":return{action:"rearrange_protocols",target:"own"};case"swap_protocols":return{action:"swap_protocols",target:"own"};case"reveal":case"give":return{action:a,source:"own_hand",count:1};case"take":return{action:"take",source:"opponent_hand",count:1,random:!0};case"choice":return{action:"choice",options:[]};case"passive_rule":return{action:"passive_rule",rule:{type:"block_all_play",target:"opponent",scope:"this_lane"}};case"value_modifier":return{action:"value_modifier",modifier:{type:"add_per_condition",value:1,condition:"per_face_down_card",target:"own_total",scope:"this_lane"}};default:return{}}},lx=(a,n)=>{const l=(s,d)=>{s=s.replace("#","");const p=parseInt(s.substring(0,2),16),f=parseInt(s.substring(2,4),16),h=parseInt(s.substring(4,6),16);return`rgba(${p}, ${f}, ${h}, ${d})`},c={borderColor:n};switch(a){case"solid":return{...c,backgroundColor:n};case"radial":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`radial-gradient(circle at 50% 50%, ${l(n,.25)} 0%, transparent 60%)`};case"dual-radial":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 0% 0%, ${l(n,.2)}, transparent 50%),
                    radial-gradient(at 100% 100%, ${l(n,.2)}, transparent 50%)
                `};case"multi-radial":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 0%, ${l(n,.2)}, transparent 70%),
                    radial-gradient(circle at 20% 30%, ${l(n,.15)}, transparent 40%),
                    radial-gradient(circle at 80% 70%, ${l(n,.2)}, transparent 50%)
                `};case"chaos":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 10% 10%, hsla(60, 100%, 50%, 0.15), transparent 30%),
                    radial-gradient(at 90% 20%, hsla(180, 100%, 50%, 0.15), transparent 35%),
                    radial-gradient(at 30% 80%, hsla(300, 100%, 50%, 0.15), transparent 40%),
                    radial-gradient(at 70% 60%, hsla(0, 100%, 50%, 0.1), transparent 25%)
                `};case"grid":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(circle at 50% 50%, ${l(n,.2)} 0%, transparent 40%),
                    linear-gradient(hsla(0,0%,100%,0.03) 1px, transparent 1px),
                    linear-gradient(90deg, hsla(0,0%,100%,0.03) 1px, transparent 1px)
                `,backgroundSize:"100% 100%, 20px 20px, 20px 20px"};case"diagonal-lines":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 0% 100%, ${l(n,.25)}, transparent 70%),
                    repeating-linear-gradient(120deg, transparent, transparent 15px, ${l(n,.05)} 15px, ${l(n,.05)} 30px)
                `};case"cross-diagonal":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 50%, ${l(n,.25)} 0%, transparent 50%),
                    repeating-linear-gradient(45deg, transparent, transparent 8px, ${l(n,.08)} 8px, ${l(n,.08)} 16px),
                    repeating-linear-gradient(-45deg, transparent, transparent 8px, ${l(n,.06)} 8px, ${l(n,.06)} 16px)
                `};case"horizontal-lines":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 80% 80%, ${l(n,.1)}, transparent 50%),
                    repeating-linear-gradient(0deg, hsla(0,0%,100%,0.02), hsla(0,0%,100%,0.02) 1px, transparent 1px, transparent 3px)
                `};case"vertical-lines":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 10% 10%, ${l(n,.2)}, transparent 50%),
                    repeating-linear-gradient(175deg, transparent, transparent 1px, ${l(n,.05)} 1px, ${l(n,.05)} 2px)
                `};case"cross":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    linear-gradient(0deg, transparent 40%, ${l(n,.1)} 50%, transparent 60%),
                    linear-gradient(90deg, transparent 48%, ${l(n,.2)} 50%, transparent 52%)
                `};case"hexagons":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 0%, ${l(n,.2)}, transparent 70%),
                    url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='28' height='49' viewBox='0 0 28 49'%3E%3Cg fill-rule='evenodd'%3E%3Cg id='hexagons' fill='%23ffffff' fill-opacity='0.05' fill-rule='nonzero'%3E%3Cpath d='M13.99 9.25l13 7.5v15l-13 7.5L1 31.75v-15l12.99-7.5zM3 17.9v12.7l10.99 6.34 11-6.35V17.9l-11-6.34L3 17.9zM0 15l12.99-7.5L26 15v18.5l-13 7.5L0 33.5V15z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")
                `};case"stripes":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 100%, ${l(n,.25)}, transparent 60%),
                    linear-gradient(135deg, hsla(0,0%,0%,0.1) 23%, transparent 23%, transparent 25%, hsla(0,0%,0%,0.1) 25%, hsla(0,0%,0%,0.1) 27%, transparent 27%, transparent 73%, hsla(0,0%,0%,0.1) 73%, hsla(0,0%,0%,0.1) 75%, transparent 75%, transparent 77%, hsla(0,0%,0%,0.1) 77%)
                `};case"frost":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(circle at 50% 50%, ${l(n,.2)} 0%, transparent 50%),
                    repeating-linear-gradient(30deg, transparent, transparent 10px, ${l(n,.08)} 10px, ${l(n,.08)} 11px),
                    repeating-linear-gradient(-30deg, transparent, transparent 10px, ${l(n,.08)} 10px, ${l(n,.08)} 11px),
                    repeating-linear-gradient(90deg, transparent, transparent 8px, ${l(n,.05)} 8px, ${l(n,.05)} 9px)
                `};default:return c}},ix=[{name:"Anarchy",hex:"#EA5A3C"},{name:"Apathy",hex:"#989A9A"},{name:"Chaos",hex:"#E53FE5"},{name:"Darkness",hex:"#A772D4"},{name:"Death",hex:"#E25656"},{name:"Fire",hex:"#F06838"},{name:"Gravity",hex:"#7599EB"},{name:"Hate",hex:"#E03E5E"},{name:"Life",hex:"#3CE076"},{name:"Light",hex:"#FFEB7F"},{name:"Love",hex:"#F074D9"},{name:"Metal",hex:"#B3B8BD"},{name:"Plague",hex:"#A2CD3A"},{name:"Psychic",hex:"#C971EB"},{name:"Speed",hex:"#33DDDD"},{name:"Spirit",hex:"#42D4A8"},{name:"Water",hex:"#3FA4EB"}],cx=[{name:"Solid",value:"solid",description:"Solid color background"},{name:"Radial Glow",value:"radial",description:"Single radial gradient glow"},{name:"Dual Radial",value:"dual-radial",description:"Two radial gradient spots"},{name:"Multi Radial",value:"multi-radial",description:"Multiple radial gradient spots"},{name:"Chaos",value:"chaos",description:"Colorful chaotic spots"},{name:"Grid",value:"grid",description:"Grid line pattern"},{name:"Diagonal Lines",value:"diagonal-lines",description:"Repeating diagonal lines"},{name:"Cross Diagonal",value:"cross-diagonal",description:"Crossed diagonal lines"},{name:"Horizontal Lines",value:"horizontal-lines",description:"Fine horizontal lines"},{name:"Vertical Lines",value:"vertical-lines",description:"Fine vertical lines"},{name:"Cross Pattern",value:"cross",description:"Cross/plus pattern"},{name:"Hexagons",value:"hexagons",description:"Hexagon pattern"},{name:"Stripes",value:"stripes",description:"Diagonal stripe pattern"},{name:"Frost",value:"frost",description:"Icy crystalline pattern with crossing lines"}],sx=({onSave:a,onCancel:n,onDelete:l,initialProtocol:c})=>{const[s,d]=re.useState("name"),[p,f]=re.useState(0),[h,m]=re.useState(!1),[g,y]=re.useState(""),[w,_]=re.useState(!1),b=c?wr(c):!1;console.log("ProtocolWizard render - initialProtocol:",c,"isReadOnly:",b);const[k,S]=re.useState((c==null?void 0:c.name)||""),[$,E]=re.useState((c==null?void 0:c.description)||""),[C,N]=re.useState((c==null?void 0:c.color)||"#1976D2"),[T,H]=re.useState((c==null?void 0:c.pattern)||"solid"),[q,B]=re.useState((c==null?void 0:c.cards)||[{value:0,topEffects:[],middleEffects:[],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[],bottomEffects:[]}]);console.log("ProtocolWizard state - name:",k,"color:",C,"pattern:",T);const K=()=>{if(s==="name"){if(!k.trim()){alert("Please enter a protocol name.");return}d("color")}else s==="color"?d("pattern"):s==="pattern"&&d("cards")},U=O=>{const X=[...q];X[p]=O,B(X)},R=()=>{const O={id:(c==null?void 0:c.id)||Be(),name:k,description:$,author:"Player",createdAt:(c==null?void 0:c.createdAt)||new Date().toISOString(),color:C,pattern:T,cards:q};a(O)},j=()=>{c&&l&&l(c.id),_(!1)},F=()=>{const O={id:(c==null?void 0:c.id)||Be(),name:k,description:$,author:"Player",createdAt:(c==null?void 0:c.createdAt)||new Date().toISOString(),color:C,pattern:T,cards:q},X=JSON.stringify(O,null,2);y(X),m(!0)},M=()=>{navigator.clipboard.writeText(g).then(()=>{alert("Protocol JSON copied to clipboard!"),m(!1)}).catch(()=>{alert("Failed to copy to clipboard. Please try again.")})},L=O=>!(!k.trim()&&O!=="name"),D=O=>{if(!L(O)){alert("Please enter a protocol name first.");return}d(O)};return r.jsxs("div",{className:"protocol-wizard",children:[r.jsxs("div",{className:"wizard-header",children:[r.jsxs("h2",{children:[b?`View Protocol: ${k}`:c?`Edit Protocol: ${k}`:"Create New Protocol",b&&r.jsx("span",{className:"read-only-badge",children:"Read-Only"})]}),r.jsxs("div",{className:"wizard-progress",children:[r.jsx("button",{className:`step ${s==="name"?"active":"done"}`,onClick:()=>D("name"),type:"button",children:"1. Name"}),r.jsx("button",{className:`step ${s==="color"?"active":s==="pattern"||s==="cards"?"done":""}`,onClick:()=>D("color"),disabled:!L("color"),type:"button",children:"2. Color"}),r.jsx("button",{className:`step ${s==="pattern"?"active":s==="cards"?"done":""}`,onClick:()=>D("pattern"),disabled:!L("pattern"),type:"button",children:"3. Pattern"}),r.jsx("button",{className:`step ${s==="cards"?"active":""}`,onClick:()=>D("cards"),disabled:!L("cards"),type:"button",children:"4. Cards"})]})]}),r.jsxs("div",{className:"wizard-content",children:[s==="name"&&r.jsxs("div",{className:"wizard-step name-step",children:[r.jsx("h3",{children:"Step 1: Name and Description"}),r.jsxs("label",{children:["Protocol Name *",r.jsx("input",{type:"text",value:k,onChange:O=>!b&&S(O.target.value),placeholder:"e.g. Lightning, Shadow, Void",autoFocus:!0,readOnly:b,className:b?"read-only":""})]}),r.jsxs("label",{children:["Description",r.jsx("textarea",{value:$,onChange:O=>!b&&E(O.target.value),placeholder:"Describe the strategy and theme of your protocol",rows:4,readOnly:b,className:b?"read-only":""})]})]}),s==="color"&&r.jsxs("div",{className:"wizard-step color-step",children:[r.jsx("h3",{children:"Step 2: Choose Color"}),r.jsx("div",{className:"color-preview",style:{backgroundColor:C},children:r.jsx("span",{children:k||"Your Protocol"})}),r.jsx("h4",{children:"Predefined Colors"}),r.jsx("div",{className:`color-grid ${b?"read-only":""}`,children:ix.map(O=>r.jsx("button",{className:`color-option ${C===O.hex?"selected":""}`,style:{backgroundColor:O.hex},onClick:()=>!b&&N(O.hex),title:O.name,disabled:b,children:C===O.hex&&""},O.hex))}),r.jsx("h4",{children:"Custom Color"}),r.jsxs("div",{className:"custom-color",children:[r.jsx("input",{type:"color",value:C,onChange:O=>!b&&N(O.target.value),disabled:b}),r.jsx("input",{type:"text",value:C,onChange:O=>!b&&N(O.target.value),placeholder:"#1976D2",readOnly:b,className:b?"read-only":""})]})]}),s==="pattern"&&r.jsxs("div",{className:"wizard-step pattern-step",children:[r.jsx("h3",{children:"Step 3: Choose Card Pattern"}),r.jsx("div",{className:`pattern-selection-grid ${b?"read-only":""}`,children:cx.map(O=>{const X=lx(O.value,C);return r.jsxs("div",{className:`pattern-option ${T===O.value?"selected":""}`,onClick:()=>!b&&H(O.value),children:[r.jsxs("div",{className:"pattern-preview",style:X,children:[k||"Protocol","-0"]}),r.jsx("h4",{children:O.name}),r.jsx("p",{children:O.description}),T===O.value&&r.jsx("div",{className:"selected-badge",children:" Selected"})]},O.value)})})]}),s==="cards"&&r.jsxs("div",{className:"wizard-step cards-step",children:[r.jsx("h3",{children:"Step 4: Configure Cards"}),r.jsx("div",{className:"card-navigation",children:q.map((O,X)=>r.jsxs("button",{className:`card-nav-btn ${p===X?"active":""}`,onClick:()=>f(X),type:"button",children:["Card ",O.value]},X))}),r.jsx(ox,{card:q[p],protocolName:k,protocolColor:C,protocolPattern:T,onChange:U,readOnly:b})]})]}),r.jsxs("div",{className:"wizard-actions",children:[r.jsxs("div",{className:"wizard-actions-left",children:[r.jsx("button",{onClick:n,className:"btn btn-back",children:b?"Back":"Cancel"}),c&&l&&!b&&r.jsx("button",{onClick:()=>_(!0),className:"btn btn-delete",children:"Delete Protocol"})]}),r.jsxs("div",{className:"wizard-actions-right",children:[c&&r.jsxs(r.Fragment,{children:[r.jsx("button",{onClick:F,className:"btn btn-export",children:"Export JSON"}),!b&&r.jsx("button",{onClick:R,className:"btn",children:"Save"})]}),!c&&r.jsxs(r.Fragment,{children:[s!=="cards"&&r.jsx("button",{onClick:K,className:"btn",children:"Next"}),s==="cards"&&r.jsxs(r.Fragment,{children:[r.jsx("button",{onClick:F,className:"btn btn-export",children:"Export JSON"}),r.jsx("button",{onClick:R,className:"btn",children:"Save"})]})]})]})]}),h&&r.jsx("div",{className:"custom-protocol-modal-overlay",onClick:()=>m(!1),children:r.jsxs("div",{className:"custom-protocol-modal-content custom-protocol-modal-large",onClick:O=>O.stopPropagation(),children:[r.jsx("h3",{children:"Export Protocol JSON"}),r.jsx("p",{children:"Copy the JSON below to share or backup your protocol:"}),r.jsx("textarea",{value:g,readOnly:!0,rows:15,className:"export-textarea",onClick:O=>O.target.select()}),r.jsxs("div",{className:"custom-protocol-modal-actions",children:[r.jsx("button",{onClick:()=>m(!1),className:"btn btn-back",children:"Close"}),r.jsx("button",{onClick:M,className:"btn",children:"Copy to Clipboard"})]})]})}),w&&r.jsx("div",{className:"custom-protocol-modal-overlay",onClick:()=>_(!1),children:r.jsxs("div",{className:"custom-protocol-modal-content",onClick:O=>O.stopPropagation(),children:[r.jsx("h3",{children:"Delete Protocol"}),r.jsxs("p",{children:['Are you sure you want to delete "',k,'"?']}),r.jsx("p",{style:{color:"var(--danger-color)",fontSize:"0.9rem"},children:"This action cannot be undone."}),r.jsxs("div",{className:"custom-protocol-modal-actions",children:[r.jsx("button",{onClick:()=>_(!1),className:"btn btn-back",children:"Cancel"}),r.jsx("button",{onClick:j,className:"btn btn-delete",children:"Delete"})]})]})})]})},dx=({onBack:a})=>{const[n,l]=re.useState("list"),[c,s]=re.useState([]),[d,p]=re.useState(void 0);re.useEffect(()=>{f()},[]);const f=()=>{const b=Do();s(b)},h=()=>{p(void 0),l("create")},m=b=>{console.log("handleEdit called with protocol:",b),p(b),l("edit"),console.log("View set to edit, editingProtocol:",b)},g=b=>{Qv(b),El(),f(),l("list"),p(void 0)},y=b=>{mt(b),El(),f(),l("list"),p(void 0)},w=b=>{mt(b),El(),f()},_=()=>{l("list"),p(void 0)};return r.jsxs("div",{className:"custom-protocol-creator",children:[n==="list"&&r.jsx(Kv,{protocols:c,onCreateNew:h,onEdit:m,onDelete:g,onImport:w,onBack:a}),(n==="create"||n==="edit")&&r.jsx(sx,{onSave:y,onCancel:_,onDelete:g,initialProtocol:d})]})},ux={id:"spirit-1-example",protocol:"Spirit",value:1,top:"When you play cards face-up, they may be played without matching protocols.",middle:"Draw 2 cards.",bottom:'<span class="emphasis">Start:</span> Either discard 1 card or flip this card.',isFaceUp:!0,category:"Main 1",keywords:{}},px={id:"face-down-example",protocol:"Spirit",value:1,top:"",middle:"",bottom:"",isFaceUp:!1,category:"Main 1",keywords:{}},fx=[{id:"opp-light-4",protocol:"Light",value:4,top:"",middle:"Your opponent reveals their hand.",bottom:"",isFaceUp:!0,category:"Main 1",keywords:{reveal:!0}}],hx=[{id:"opp-spirit-3",protocol:"Spirit",value:3,top:"<div><span class='emphasis'>After you draw cards:</span> You may shift this card, even if this card is covered.</div>",middle:"",bottom:"",isFaceUp:!0,category:"Main 1",keywords:{shift:!0}},{id:"opp-spirit-2",protocol:"Spirit",value:2,top:"",middle:"You may flip 1 card.",bottom:"",isFaceUp:!0,category:"Main 1",keywords:{flip:!0}}],mx=[{id:"opp-water-3",protocol:"Water",value:3,top:"",middle:"Return all cards with a value of 2 in 1 line.",bottom:"",isFaceUp:!0,category:"Main 1",keywords:{return:!0}}],yx=[{id:"player-darkness-5",protocol:"Darkness",value:5,top:"",middle:"You discard 1 card.",bottom:"",isFaceUp:!0,category:"Main 1",keywords:{discard:!0}},{id:"player-facedown-0",protocol:"Darkness",value:2,top:"",middle:"",bottom:"",isFaceUp:!1,category:"Main 1",keywords:{}}],gx=[{id:"player-plague-1",protocol:"Plague",value:1,top:"<div><span class='emphasis'>After your opponent discards cards:</span> Draw 1 card.</div>",middle:"Your opponent discards 1 card.",bottom:"",isFaceUp:!0,category:"Main 1",keywords:{draw:!0,discard:!0}},{id:"player-plague-5",protocol:"Plague",value:5,top:"",middle:"You discard 1 card.",bottom:"",isFaceUp:!0,category:"Main 1",keywords:{discard:!0}},{id:"player-plague-4",protocol:"Plague",value:4,top:"",middle:"",bottom:"<div><span class='emphasis'>End:</span> Your opponent deletes 1 of their face-down cards. You may flip this card.</div>",isFaceUp:!0,category:"Main 1",keywords:{delete:!0,flip:!0}}],vx=[{id:"player-death-0",protocol:"Death",value:0,top:"",middle:"Delete 1 card from each other line.",bottom:"",isFaceUp:!0,category:"Main 1",keywords:{delete:!0}},{id:"player-facedown-3",protocol:"Death",value:2,top:"",middle:"",bottom:"",isFaceUp:!1,category:"Main 1",keywords:{}}],Wa={opponent:["Light","Spirit","Water"],player:["Darkness","Plague","Death"],opponentCompiled:[!0,!1,!1],playerCompiled:[!1,!1,!1],opponentValues:[4,5,3],playerValues:[7,10,2]};function _x({onBack:a}){const n=[fx,hx,mx],l=[yx,gx,vx];return r.jsxs("div",{className:"screen rules-screen",children:[r.jsx(Zi,{title:"GAME RULES",onBack:a}),r.jsxs("div",{className:"rules-content",children:[r.jsxs("section",{className:"rules-section",children:[r.jsx("h2",{className:"section-title",children:"Objective"}),r.jsxs("div",{className:"rules-text",children:[r.jsxs("p",{children:["You play as an artificial intelligence trying to ",r.jsx("span",{className:"emphasis",children:"compile your 3 protocols"}),". Play command cards on protocols and execute their effects. If you reach a total value of",r.jsx("span",{className:"emphasis",children:" at least 10"})," with your cards on a protocol and exceed the opponent's total value in the same line, you may compile that protocol."]}),r.jsx("p",{className:"rules-highlight",children:"The first player to compile all 3 protocols wins!"})]})]}),r.jsxs("section",{className:"rules-section field-overview-section",children:[r.jsx("h2",{className:"section-title",children:"The Field"}),r.jsx("div",{className:"field-intro",children:r.jsxs("p",{children:["The field consists of ",r.jsx("span",{className:"emphasis",children:"3 lines"}),", each passing through two opposing protocols. Both players place cards on their side of each line. The goal is to build up value in your stacks to reach the compile threshold."]})}),r.jsxs("div",{className:"demo-board-container",children:[r.jsxs("div",{className:"demo-board",children:[r.jsx("div",{className:"demo-side-label opponent-label",children:"Opponent"}),r.jsx("div",{className:"demo-player-side demo-opponent-side",children:r.jsx("div",{className:"demo-lanes",children:n.map((c,s)=>r.jsx("div",{className:`demo-lane ${Wa.opponentCompiled[s]?"demo-lane-compiled":""}`,children:r.jsx("div",{className:"demo-lane-stack",children:c.map((d,p)=>r.jsx(vt,{card:d,isFaceUp:d.isFaceUp,style:{"--i":p},faceDownValue:2},d.id))})},`opp-lane-${s}`))})}),r.jsxs("div",{className:"demo-protocol-bars-container",children:[r.jsx("div",{className:"demo-protocol-bar demo-opponent-bar",children:Wa.opponent.map((c,s)=>r.jsxs("div",{className:`demo-protocol-display ${Wa.opponentCompiled[s]?"compiled":""}`,children:[r.jsx("span",{className:"demo-protocol-name",children:c}),r.jsx("span",{className:"demo-protocol-value",children:Wa.opponentValues[s]})]},`opp-proto-${s}`))}),r.jsx("div",{className:"demo-protocol-bar demo-player-bar",children:Wa.player.map((c,s)=>r.jsxs("div",{className:`demo-protocol-display ${Wa.playerCompiled[s]?"compiled":""}`,children:[r.jsx("span",{className:"demo-protocol-name",children:c}),r.jsx("span",{className:"demo-protocol-value",children:Wa.playerValues[s]})]},`player-proto-${s}`))})]}),r.jsx("div",{className:"demo-player-side",children:r.jsx("div",{className:"demo-lanes",children:l.map((c,s)=>r.jsx("div",{className:`demo-lane ${Wa.playerCompiled[s]?"demo-lane-compiled":""} ${s===1?"demo-lane-compilable":""}`,children:r.jsx("div",{className:"demo-lane-stack",children:c.map((d,p)=>r.jsx(vt,{card:d,isFaceUp:d.isFaceUp,style:{"--i":p},faceDownValue:2},d.id))})},`player-lane-${s}`))})}),r.jsx("div",{className:"demo-side-label player-label",children:"You"})]}),r.jsxs("div",{className:"demo-board-annotations",children:[r.jsxs("div",{className:"demo-annotation compiled-annotation",children:[r.jsx("div",{className:"demo-annotation-marker compiled-marker",children:"1"}),r.jsxs("div",{className:"demo-annotation-content",children:[r.jsx("strong",{children:"Compiled Protocol"}),r.jsx("p",{children:"Light has been compiled by the opponent! The protocol bar glows cyan."})]})]}),r.jsxs("div",{className:"demo-annotation compilable-annotation",children:[r.jsx("div",{className:"demo-annotation-marker compilable-marker",children:"2"}),r.jsxs("div",{className:"demo-annotation-content",children:[r.jsx("strong",{children:"Ready to Compile!"}),r.jsx("p",{children:"Plague has value 10 (1+5+4) which is 10 and higher than opponent's Spirit at 5. This protocol can be compiled!"})]})]}),r.jsxs("div",{className:"demo-annotation inprogress-annotation",children:[r.jsx("div",{className:"demo-annotation-marker inprogress-marker",children:"3"}),r.jsxs("div",{className:"demo-annotation-content",children:[r.jsx("strong",{children:"In Progress"}),r.jsx("p",{children:"Death/Water lanes are still building up. Keep playing cards to reach the compile threshold of 10!"})]})]}),r.jsxs("div",{className:"demo-annotation topbox-annotation",children:[r.jsx("div",{className:"demo-annotation-marker topbox-marker",children:"4"}),r.jsxs("div",{className:"demo-annotation-content",children:[r.jsx("strong",{children:"Top Effect Always Visible"}),r.jsx("p",{children:"See Plague-1's top effect? It stays active even when covered! Top effects are always visible and active on face-up cards."})]})]})]})]}),r.jsxs("div",{className:"field-legend",children:[r.jsxs("div",{className:"legend-item",children:[r.jsx("div",{className:"legend-swatch legend-compiled"}),r.jsx("span",{children:"Compiled Protocol"})]}),r.jsxs("div",{className:"legend-item",children:[r.jsx("div",{className:"legend-swatch legend-compilable"}),r.jsx("span",{children:"Ready to Compile (10 value & higher than opponent)"})]}),r.jsxs("div",{className:"legend-item",children:[r.jsx("div",{className:"legend-swatch legend-facedown"}),r.jsx("span",{children:"Face-down Card (base value: 2)"})]})]})]}),r.jsxs("section",{className:"rules-section card-anatomy-section",children:[r.jsx("h2",{className:"section-title",children:"Card Anatomy"}),r.jsxs("div",{className:"card-anatomy-layout",children:[r.jsx("div",{className:"card-anatomy-display",children:r.jsxs("div",{className:"anatomy-card-wrapper",children:[r.jsx(vt,{card:ux,isFaceUp:!0}),r.jsxs("div",{className:"anatomy-annotation annotation-protocol",children:[r.jsx("div",{className:"annotation-line annotation-line-left"}),r.jsxs("div",{className:"annotation-label",children:[r.jsx("span",{className:"annotation-letter",children:"A"}),r.jsx("span",{className:"annotation-text",children:"Protocol"})]})]}),r.jsxs("div",{className:"anatomy-annotation annotation-value",children:[r.jsx("div",{className:"annotation-line annotation-line-right"}),r.jsxs("div",{className:"annotation-label",children:[r.jsx("span",{className:"annotation-letter",children:"B"}),r.jsx("span",{className:"annotation-text",children:"Value"})]})]}),r.jsxs("div",{className:"anatomy-annotation annotation-top",children:[r.jsx("div",{className:"annotation-line annotation-line-right"}),r.jsxs("div",{className:"annotation-label",children:[r.jsx("span",{className:"annotation-letter",children:"C"}),r.jsx("span",{className:"annotation-text",children:"Top Effect"})]})]}),r.jsxs("div",{className:"anatomy-annotation annotation-middle",children:[r.jsx("div",{className:"annotation-line annotation-line-right"}),r.jsxs("div",{className:"annotation-label",children:[r.jsx("span",{className:"annotation-letter",children:"D"}),r.jsx("span",{className:"annotation-text",children:"Middle Effect"})]})]}),r.jsxs("div",{className:"anatomy-annotation annotation-bottom",children:[r.jsx("div",{className:"annotation-line annotation-line-right"}),r.jsxs("div",{className:"annotation-label",children:[r.jsx("span",{className:"annotation-letter",children:"E"}),r.jsx("span",{className:"annotation-text",children:"Bottom Effect"})]})]})]})}),r.jsxs("div",{className:"card-anatomy-descriptions",children:[r.jsxs("div",{className:"anatomy-item",children:[r.jsx("span",{className:"anatomy-letter",children:"A"}),r.jsxs("div",{className:"anatomy-desc",children:[r.jsx("strong",{children:"Protocol Indicator"}),r.jsx("p",{children:"Dictates which line a card can be played face-up in. Cards must match the protocol of that line."})]})]}),r.jsxs("div",{className:"anatomy-item",children:[r.jsx("span",{className:"anatomy-letter",children:"B"}),r.jsxs("div",{className:"anatomy-desc",children:[r.jsx("strong",{children:"Value"}),r.jsx("p",{children:"The value added to the total value of a stack. Higher values help you reach the compile threshold of 10."})]})]}),r.jsxs("div",{className:"anatomy-item anatomy-item-highlight",children:[r.jsx("span",{className:"anatomy-letter",children:"C"}),r.jsxs("div",{className:"anatomy-desc",children:[r.jsx("strong",{children:"Top Command - Persistent"}),r.jsxs("p",{children:["While this card is face-up, this passive text is ",r.jsx("span",{className:"emphasis",children:"always active"}),", even when covered by other cards."]})]})]}),r.jsxs("div",{className:"anatomy-item anatomy-item-highlight",children:[r.jsx("span",{className:"anatomy-letter",children:"D"}),r.jsxs("div",{className:"anatomy-desc",children:[r.jsx("strong",{children:"Middle Command - Immediate"}),r.jsx("p",{children:"Resolve this active text immediately when the card is played, flipped face-up, or uncovered."})]})]}),r.jsxs("div",{className:"anatomy-item anatomy-item-highlight",children:[r.jsx("span",{className:"anatomy-letter",children:"E"}),r.jsxs("div",{className:"anatomy-desc",children:[r.jsx("strong",{children:"Bottom Command - Auxiliary"}),r.jsxs("p",{children:['This passive text (often triggered effects like "Start:" or "End:") is only active when the card is ',r.jsx("span",{className:"emphasis",children:"uncovered"}),"."]})]})]})]})]})]}),r.jsxs("section",{className:"rules-section face-down-section",children:[r.jsx("h2",{className:"section-title",children:"Face-Down Cards"}),r.jsxs("div",{className:"face-down-layout",children:[r.jsx("div",{className:"face-down-card-wrapper",children:r.jsx(vt,{card:px,isFaceUp:!1,faceDownValue:2})}),r.jsxs("div",{className:"face-down-description",children:[r.jsxs("p",{children:["Cards can be played ",r.jsx("span",{className:"emphasis",children:"face-down"})," into any line, regardless of protocol matching."]}),r.jsxs("ul",{children:[r.jsxs("li",{children:["Face-down cards have a ",r.jsx("span",{className:"emphasis",children:"base value of 2"})]}),r.jsx("li",{children:"No effects are active while face-down"}),r.jsx("li",{children:"Can be flipped face-up by card effects"}),r.jsx("li",{children:"When flipped, the middle effect triggers"}),r.jsx("li",{children:"Some cards modify face-down values (e.g., Darkness-2)"})]})]})]})]}),r.jsxs("section",{className:"rules-section",children:[r.jsx("h2",{className:"section-title",children:"Turn Order"}),r.jsxs("div",{className:"turn-order-grid",children:[r.jsxs("div",{className:"turn-phase",children:[r.jsx("span",{className:"phase-number",children:"1"}),r.jsxs("div",{className:"phase-content",children:[r.jsx("strong",{children:"Start Phase"}),r.jsx("p",{children:'Resolve all visible "Start" effects of your face-up command cards.'})]})]}),r.jsxs("div",{className:"turn-phase",children:[r.jsx("span",{className:"phase-number",children:"2"}),r.jsxs("div",{className:"phase-content",children:[r.jsx("strong",{children:"Check Control"}),r.jsx("p",{children:"If your total value is higher than opponent's in at least 2 lines, take the control component."})]})]}),r.jsxs("div",{className:"turn-phase",children:[r.jsx("span",{className:"phase-number",children:"3"}),r.jsxs("div",{className:"phase-content",children:[r.jsx("strong",{children:"Check Compile"}),r.jsx("p",{children:"If you can compile (10+ value and higher than opponent), you must compile one protocol."})]})]}),r.jsxs("div",{className:"turn-phase",children:[r.jsx("span",{className:"phase-number",children:"4"}),r.jsxs("div",{className:"phase-content",children:[r.jsx("strong",{children:"Action"}),r.jsx("p",{children:"Play 1 card from hand OR refresh your hand (draw until you have 5 cards)."})]})]}),r.jsxs("div",{className:"turn-phase",children:[r.jsx("span",{className:"phase-number",children:"5"}),r.jsxs("div",{className:"phase-content",children:[r.jsx("strong",{children:"Check Cache"}),r.jsx("p",{children:"If you have more than 5 cards, discard down to 5."})]})]}),r.jsxs("div",{className:"turn-phase",children:[r.jsx("span",{className:"phase-number",children:"6"}),r.jsxs("div",{className:"phase-content",children:[r.jsx("strong",{children:"End Phase"}),r.jsx("p",{children:'Resolve all visible "End" effects of your face-up command cards.'})]})]})]})]}),r.jsxs("section",{className:"rules-section glossary-section",children:[r.jsx("h2",{className:"section-title",children:"Glossary"}),r.jsxs("div",{className:"glossary-grid",children:[r.jsxs("div",{className:"glossary-item",children:[r.jsx("strong",{children:"Compile"}),r.jsx("p",{children:'Delete all cards in a line on both sides and flip your protocol to "Compiled".'})]}),r.jsxs("div",{className:"glossary-item",children:[r.jsx("strong",{children:"Covered"}),r.jsx("p",{children:"A card with another card on top of it. Only top effects remain active."})]}),r.jsxs("div",{className:"glossary-item",children:[r.jsx("strong",{children:"Uncovered"}),r.jsx("p",{children:"The topmost card in a stack, furthest from the protocol."})]}),r.jsxs("div",{className:"glossary-item",children:[r.jsx("strong",{children:"Delete"}),r.jsx("p",{children:"Move a card from the field to the trash."})]}),r.jsxs("div",{className:"glossary-item",children:[r.jsx("strong",{children:"Discard"}),r.jsx("p",{children:"Move a card from hand to the owner's trash."})]}),r.jsxs("div",{className:"glossary-item",children:[r.jsx("strong",{children:"Flip"}),r.jsx("p",{children:"Change a card from face-down to face-up, or vice versa."})]}),r.jsxs("div",{className:"glossary-item",children:[r.jsx("strong",{children:"Shift"}),r.jsx("p",{children:"Move a card to another line on the same side of the field."})]}),r.jsxs("div",{className:"glossary-item",children:[r.jsx("strong",{children:"Return"}),r.jsx("p",{children:"Move a card from the field to its owner's hand."})]}),r.jsxs("div",{className:"glossary-item",children:[r.jsx("strong",{children:"Reveal"}),r.jsx("p",{children:"Show hidden information publicly, then return it to its previous state."})]}),r.jsxs("div",{className:"glossary-item",children:[r.jsx("strong",{children:"Refresh"}),r.jsx("p",{children:"Draw cards until you have 5 cards in hand."})]}),r.jsxs("div",{className:"glossary-item",children:[r.jsx("strong",{children:"Line"}),r.jsx("p",{children:"The area passing through two opposing protocols. The field has 3 lines."})]}),r.jsxs("div",{className:"glossary-item",children:[r.jsx("strong",{children:"Stack"}),r.jsx("p",{children:"The cards in a line on one player's side."})]})]})]})]})]})}const xx="anarchy-custom-001",wx="Anarchy",Cx="Custom recreation of Anarchy protocol to validate editor capabilities",bx="System Validation",Sx="2025-11-08T00:00:00.000Z",Ex="#8B0000",jx="chaos",kx=[{value:0,topEffects:[],middleEffects:[{id:"anarchy-0-shift",params:{action:"shift",targetFilter:{owner:"any",position:"uncovered",faceState:"any"}},position:"middle",trigger:"on_play"},{id:"anarchy-0-draw",params:{action:"draw",count:1,target:"self",source:"own_deck",conditional:{type:"non_matching_protocols"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[{id:"anarchy-1-passive",params:{action:"passive_rule",rule:{type:"require_non_matching_protocol",target:"all",scope:"global"}},position:"top",trigger:"passive"}],middleEffects:[{id:"anarchy-1-shift",params:{action:"shift",targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!0},destinationRestriction:{type:"non_matching_protocol"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"anarchy-2-delete",params:{action:"delete",count:1,targetFilter:{position:"any",faceState:"face_up"},protocolMatching:"must_match",excludeSelf:!1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"anarchy-3-swap",params:{action:"swap_protocols",target:"opponent"},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"anarchy-3-end-rearrange",params:{action:"rearrange_protocols",target:"own",restriction:{disallowedProtocol:"Anarchy",laneIndex:"current"}},position:"bottom",trigger:"end"}]},{value:5,topEffects:[],middleEffects:[{id:"anarchy-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:6,topEffects:[{id:"anarchy-6-start-flip",params:{action:"flip",count:1,flipSelf:!0,optional:!1,targetFilter:{owner:"any",position:"any",faceState:"any",excludeSelf:!1},advancedConditional:{type:"protocol_match",protocol:"Anarchy"}},position:"top",trigger:"start"}],middleEffects:[],bottomEffects:[]}],Rx="Fan-Content",Ax={id:xx,name:wx,description:Cx,author:bx,createdAt:Sx,color:Ex,pattern:jx,cards:kx,category:Rx},Tx="apathy_custom",Dx="Apathy",Nx="Custom implementation of Apathy protocol",Fx="System",qx="2025-01-08T00:00:00Z",$x="#9E9E9E",Ux="radial",Ox=[{value:0,topEffects:[{id:"apathy-0-value-modifier",params:{action:"value_modifier",modifier:{type:"add_per_condition",value:1,condition:"per_face_down_card",target:"own_total",scope:"this_lane"}},position:"top",trigger:"passive"}],middleEffects:[],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"apathy-1-flip-all",params:{action:"flip",count:"all",optional:!1,scope:"this_lane",targetFilter:{owner:"any",position:"any",faceState:"face_up",excludeSelf:!0}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:2,topEffects:[{id:"apathy-2-passive",params:{action:"passive_rule",rule:{type:"ignore_middle_commands",target:"all",scope:"this_lane"}},position:"top",trigger:"passive"}],middleEffects:[],bottomEffects:[{id:"apathy-2-on-cover",params:{action:"flip",count:1,flipSelf:!0,optional:!1,targetFilter:{owner:"any",position:"any",faceState:"any",excludeSelf:!1}},position:"bottom",trigger:"on_cover"}]},{value:3,topEffects:[],middleEffects:[{id:"apathy-3-flip-opponent",params:{action:"flip",count:1,optional:!1,targetFilter:{owner:"opponent",position:"uncovered",faceState:"face_up",excludeSelf:!1}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"apathy-4-flip-covered",params:{action:"flip",count:1,optional:!0,targetFilter:{owner:"own",position:"covered",faceState:"face_up",excludeSelf:!1}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"apathy-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],Ix="Aux 1",Lx={id:Tx,name:Dx,description:Nx,author:Fx,createdAt:qx,color:$x,pattern:Ux,cards:Ox,category:Ix},Mx="chaos_custom_1",Px="Chaos",Hx="Embrace the unpredictable. Custom protocol migration of original Chaos protocol.",zx="#E64DB8",Vx="chaos",Bx=[{value:0,topEffects:[],middleEffects:[{id:"chaos_0_flip_covered",trigger:"on_play",params:{action:"flip",count:1,scope:"each_lane",targetFilter:{owner:"any",position:"covered",faceState:"any"}},position:"middle"}],bottomEffects:[{id:"chaos_0_start_swap_draws",trigger:"start",params:{action:"mutual_draw",count:1},position:"bottom"}]},{value:1,topEffects:[],middleEffects:[{id:"chaos_1_rearrange_own",trigger:"on_play",params:{action:"rearrange_protocols",target:"own"},position:"middle"},{id:"chaos_1_rearrange_opponent",trigger:"on_play",params:{action:"rearrange_protocols",target:"opponent"},position:"middle"}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"chaos_2_shift_covered",trigger:"on_play",params:{action:"shift",count:1,targetFilter:{owner:"own",position:"covered",faceState:"any"}},position:"middle"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[],bottomEffects:[{id:"chaos_3_allow_any_protocol",trigger:"passive",params:{action:"passive_rule",rule:{type:"allow_any_protocol_play",target:"self",scope:"global"}},position:"bottom"}]},{value:4,topEffects:[],middleEffects:[],bottomEffects:[{id:"chaos_4_end_discard_draw",trigger:"end",params:{action:"discard",count:"all",actor:"self"},conditional:{type:"then",thenEffect:{id:"chaos_4_draw_after_discard",trigger:"on_play",params:{action:"draw",count:1,countType:"equal_to_discarded",countOffset:0,target:"self",source:"own_deck"},position:"bottom"}},position:"bottom"}]},{value:5,topEffects:[],middleEffects:[{id:"chaos_5_discard",trigger:"on_play",params:{action:"discard",count:1,actor:"self"},position:"middle"}],bottomEffects:[]}],Yx="Main 2",Gx={id:Mx,name:Px,description:Hx,color:zx,pattern:Vx,cards:Bx,category:Yx},Wx="darkness_custom_v1",Qx="Darkness",Xx="Custom Darkness protocol - manipulate face-down cards, flip and shift",Zx="System",Kx="2025-01-08T00:00:00Z",Jx="#1a0033",ew="grid",tw=[{value:0,topEffects:[],middleEffects:[{id:"dark-0-draw",params:{action:"draw",count:3,target:"self",source:"own_deck"},position:"middle",trigger:"on_play"},{id:"dark-0-shift",params:{action:"shift",targetFilter:{owner:"opponent",position:"covered",faceState:"any",excludeSelf:!1},destinationRestriction:{type:"any"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"dark-1-flip",params:{action:"flip",count:1,optional:!1,targetFilter:{owner:"opponent",position:"uncovered",faceState:"any",excludeSelf:!1}},position:"middle",trigger:"on_play"},{id:"dark-1-shift",params:{action:"shift",optional:!0,targetFilter:{owner:"any",position:"any",faceState:"any",excludeSelf:!1},destinationRestriction:{type:"any"}},position:"middle",trigger:"on_play",useCardFromPreviousEffect:!0}],bottomEffects:[]},{value:2,topEffects:[{id:"dark-2-value-modifier",params:{action:"value_modifier",modifier:{type:"set_to_fixed",value:4,target:"own_cards",scope:"this_lane",filter:{faceState:"face_down",position:"any"}}},position:"top",trigger:"passive"}],middleEffects:[{id:"dark-2-flip",params:{action:"flip",count:1,optional:!0,scope:"this_lane",targetFilter:{owner:"any",position:"covered",faceState:"any",excludeSelf:!1}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"dark-3-play",params:{action:"play",source:"hand",count:1,faceDown:!0,destinationRule:{type:"other_lines",excludeCurrentLane:!0}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"dark-4-shift",params:{action:"shift",targetFilter:{owner:"any",position:"uncovered",faceState:"face_down",excludeSelf:!1},destinationRestriction:{type:"any"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"dark-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],nw="Main 1",aw={id:Wx,name:Qx,description:Xx,author:Zx,createdAt:Kx,color:Jx,pattern:ew,cards:tw,category:nw},ow="death_custom_v1",rw="Death",lw="Custom Death protocol - delete cards with various conditions",iw="System",cw="2025-01-09T00:00:00Z",sw="#8B0000",dw="stripes",uw=[{value:0,topEffects:[],middleEffects:[{id:"death-0-delete-from-each-lane",params:{action:"delete",count:1,scope:{type:"each_other_line"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[{id:"death-1-optional-draw",params:{action:"draw",count:1,optional:!0},position:"top",trigger:"start",conditional:{type:"if_executed",thenEffect:{id:"death-1-delete-other",params:{action:"delete",count:1,excludeSelf:!0},position:"top",trigger:"start",conditional:{type:"then",thenEffect:{id:"death-1-delete-self",params:{action:"delete",count:1,targetFilter:{position:"any",owner:"own"},deleteSelf:!0},position:"top",trigger:"start"}}}}}],middleEffects:[],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"death-2-delete-lane-values",params:{action:"delete",count:"all",selectLane:!0,targetFilter:{faceState:"any",valueRange:{min:1,max:2}}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"death-3-delete-facedown",params:{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"face_down"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"death-4-delete-low-value",params:{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"face_up",valueRange:{min:0,max:1}}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"death-5-discard",params:{action:"discard",count:1},position:"middle",trigger:"on_play"}],bottomEffects:[]}],pw="Main 1",fw={id:ow,name:rw,description:lw,author:iw,createdAt:cw,color:sw,pattern:dw,cards:uw,category:pw},hw="fire-custom-001",mw="Fire",yw="Fire protocol - discard cards to fuel powerful effects",gw="System",vw="2025-11-09T00:00:00.000Z",_w="#F06838",xw="radial",ww=[{value:0,topEffects:[],middleEffects:[{id:"fire-0-flip",params:{action:"flip",count:1,targetFilter:{excludeSelf:!0}},position:"middle",trigger:"on_play"},{id:"fire-0-draw",params:{action:"draw",count:2},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"fire-0-oncover-draw",params:{action:"draw",count:1},position:"bottom",trigger:"on_cover",conditional:{type:"then",thenEffect:{id:"fire-0-oncover-flip",params:{action:"flip",count:1,targetFilter:{excludeSelf:!0}},position:"bottom",trigger:"on_cover"}}}]},{value:1,topEffects:[],middleEffects:[{id:"fire-1-discard",params:{action:"discard",count:1},position:"middle",trigger:"on_play",conditional:{type:"if_executed",thenEffect:{id:"fire-1-delete",params:{action:"delete",count:1},position:"middle",trigger:"on_play"}}}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"fire-2-discard",params:{action:"discard",count:1},position:"middle",trigger:"on_play",conditional:{type:"if_executed",thenEffect:{id:"fire-2-return",params:{action:"return",count:1,targetFilter:{position:"uncovered"}},position:"middle",trigger:"on_play"}}}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[],bottomEffects:[{id:"fire-3-discard",params:{action:"discard",count:1,optional:!0},position:"bottom",trigger:"end",conditional:{type:"if_executed",thenEffect:{id:"fire-3-flip",params:{action:"flip",count:1},position:"bottom",trigger:"end"}}}]},{value:4,topEffects:[],middleEffects:[{id:"fire-4-discard-variable",params:{action:"discard",count:1,variableCount:!0},position:"middle",trigger:"on_play",conditional:{type:"then",thenEffect:{id:"fire-4-draw-based-on-discard",params:{action:"draw",countType:"equal_to_discarded",countOffset:1},position:"middle",trigger:"on_play"}}}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"fire-5-discard",params:{action:"discard",count:1,optional:!1},position:"middle",trigger:"on_play"}],bottomEffects:[]}],Cw="Main 1",bw={id:hw,name:mw,description:yw,author:gw,createdAt:vw,color:_w,pattern:xw,cards:ww,category:Cw},Sw="frost_custom_1",Ew="Frost",jw="Freeze the game state. Frost blocks actions and preserves face-down cards.",kw="#87CEEB",Rw="frost",Aw=[{value:0,topEffects:[],middleEffects:[{id:"frost_0_draw_per_face_down",trigger:"on_play",position:"middle",params:{action:"draw",count:1,source:"own_deck",target:"self",countType:"count_face_down"}}],bottomEffects:[]},{value:1,topEffects:[{id:"frost_1_block_flips",trigger:"passive",position:"top",params:{action:"passive_rule",rule:{type:"block_flips",target:"all",scope:"global"}}}],middleEffects:[],bottomEffects:[{id:"frost_1_block_rearrange",trigger:"passive",position:"bottom",params:{action:"passive_rule",rule:{type:"block_protocol_rearrange",target:"all",scope:"global"}}}]},{value:2,topEffects:[],middleEffects:[{id:"frost_2_play_face_down",trigger:"on_play",position:"middle",params:{action:"play",count:1,source:"hand",faceDown:!0}}],bottomEffects:[]},{value:3,topEffects:[{id:"frost_3_block_shifts",trigger:"passive",position:"top",params:{action:"passive_rule",rule:{type:"block_shifts_from_and_to_lane",target:"all",scope:"this_lane"}}}],middleEffects:[],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"frost_4_flip_covered",trigger:"on_play",position:"middle",params:{action:"flip",count:1,optional:!0,targetFilter:{owner:"own",faceState:"face_up",position:"covered"}}}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"frost_5_discard",trigger:"on_play",position:"middle",params:{action:"discard",count:1,target:"self"}}],bottomEffects:[]}],Tw="Fan-Content",Dw={id:Sw,name:Ew,description:jw,color:kw,pattern:Rw,cards:Aw,category:Tw},Nw="hate-custom-001",Fw="Hate",qw="Focused on deletion and sacrifice. Delete cards to gain advantage.",$w="System Migration",Uw="2025-11-13T00:00:00.000Z",Ow="#E67A7A",Iw="diagonal-lines",Lw=[{value:0,topEffects:[],middleEffects:[{id:"hate-0-delete",params:{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"any"},scope:{type:"anywhere"},excludeSelf:!1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"hate-1-discard",params:{action:"discard",count:3,actor:"self",upTo:!0},position:"middle",trigger:"on_play"},{id:"hate-1-delete-1",params:{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"any"},scope:{type:"anywhere"},excludeSelf:!1,upTo:!0},position:"middle",trigger:"on_play"},{id:"hate-1-delete-2",params:{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"any"},scope:{type:"anywhere"},excludeSelf:!1,upTo:!0},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"hate-2-delete-own",params:{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"any",calculation:"highest_value",owner:"own"},scope:{type:"anywhere"},excludeSelf:!1},position:"middle",trigger:"on_play"},{id:"hate-2-delete-opponent",params:{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"any",calculation:"highest_value",owner:"opponent"},scope:{type:"anywhere"},excludeSelf:!1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[{id:"hate-3-reactive-draw",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"top",trigger:"after_delete",reactiveTriggerActor:"self"}],middleEffects:[],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[],bottomEffects:[{id:"hate-4-on-cover-delete",params:{action:"delete",count:1,targetFilter:{position:"covered_by_context",faceState:"any",calculation:"lowest_value"},scope:{type:"this_line"},excludeSelf:!1,autoExecute:!0},position:"bottom",trigger:"on_cover"}]},{value:5,topEffects:[],middleEffects:[{id:"hate-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],Mw="Aux 1",Pw={id:Nw,name:Fw,description:qw,author:$w,createdAt:Uw,color:Ow,pattern:Iw,cards:Lw,category:Mw},Hw="water_custom_1",zw="Water",Vw="Wash away and renew. Custom protocol migration of original Water protocol.",Bw="#5DADE2",Yw="multi-radial",Gw=[{value:0,topEffects:[],middleEffects:[{id:"water_0_flip_other",trigger:"immediate",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!0},optional:!1},position:"middle"},{id:"water_0_flip_self",trigger:"immediate",params:{action:"flip",flipSelf:!0},position:"middle"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"water_1_play",trigger:"immediate",params:{action:"play",source:"deck",count:1,faceDown:!0,destinationRule:{type:"each_other_line"}},position:"middle"}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"water_2_draw",trigger:"immediate",params:{action:"draw",count:2},position:"middle"},{id:"water_2_rearrange",trigger:"immediate",params:{action:"rearrange_protocols",target:"own"},position:"middle"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"water_3_return",trigger:"immediate",params:{action:"return",count:"all",targetFilter:{owner:"any",position:"uncovered",valueEquals:2},selectLane:!0},position:"middle"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"water_4_return",trigger:"immediate",params:{action:"return",count:1,targetFilter:{owner:"own",position:"uncovered"}},position:"middle"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"water_5_discard",trigger:"immediate",params:{action:"discard",count:1,actor:"self"},position:"middle"}],bottomEffects:[]}],Ww="Main 1",Qw={id:Hw,name:zw,description:Vw,color:Bw,pattern:Yw,cards:Gw,category:Ww},Xw="spirit_custom_1",Zw="Spirit",Kw="True strength from within. Custom protocol migration of original Spirit protocol.",Jw="#5DD9C1",e1="dual-radial",t1=[{value:0,topEffects:[],middleEffects:[{id:"spirit_0_refresh",trigger:"on_play",params:{action:"refresh",target:"self"},position:"middle"},{id:"spirit_0_draw",trigger:"on_play",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"middle"}],bottomEffects:[{id:"spirit_0_skip_cache",trigger:"passive",params:{action:"passive_rule",rule:{type:"skip_check_cache_phase",target:"self",scope:"global"}},position:"bottom"}]},{value:1,topEffects:[{id:"spirit_1_play_anywhere",trigger:"passive",params:{action:"passive_rule",rule:{type:"allow_any_protocol_play",target:"self",scope:"global"}},position:"top"}],middleEffects:[{id:"spirit_1_draw",trigger:"on_play",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"middle"}],bottomEffects:[{id:"spirit_1_choice",trigger:"start",params:{action:"choice",options:[{id:"spirit_1_choice_discard",trigger:"on_play",params:{action:"discard",count:1,actor:"self"},position:"bottom"},{id:"spirit_1_choice_flip",trigger:"on_play",params:{action:"flip",flipSelf:!0},position:"bottom"}]},position:"bottom"}]},{value:2,topEffects:[],middleEffects:[{id:"spirit_2_flip",trigger:"on_play",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1},optional:!0},position:"middle"}],bottomEffects:[]},{value:3,topEffects:[{id:"spirit_3_shift",trigger:"after_draw",reactiveTriggerActor:"self",params:{action:"shift",count:1,optional:!0,targetFilter:{owner:"own",position:"any",faceState:"any",excludeSelf:!1}},position:"top"}],middleEffects:[],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"spirit_4_swap",trigger:"on_play",params:{action:"swap_protocols",target:"own"},position:"middle"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"spirit_5_discard",trigger:"on_play",params:{action:"discard",count:1,actor:"self"},position:"middle"}],bottomEffects:[]}],n1="Main 1",a1={id:Xw,name:Zw,description:Kw,color:Jw,pattern:e1,cards:t1,category:n1},o1="gravity_custom_1",r1="Gravity",l1="Pull everything together. Gravity draws cards towards this line.",i1="#7599EB",c1="grid",s1=[{value:0,topEffects:[],middleEffects:[{id:"gravity_0_play_per_2_cards",trigger:"on_play",params:{action:"play",source:"deck",count:1,faceDown:!0,destinationRule:{type:"under_this_card"},condition:{type:"per_x_cards_in_line",cardCount:2},actor:"self"},position:"middle"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"gravity_1_draw_2",trigger:"on_play",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"middle"},{id:"gravity_1_shift_to_or_from",trigger:"on_play",params:{action:"shift",targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1},destinationRestriction:{type:"to_or_from_this_lane",laneIndex:"current"}},position:"middle"}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"gravity_2_flip",trigger:"on_play",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1},optional:!1},position:"middle"},{id:"gravity_2_shift_to_this_line",trigger:"on_play",params:{action:"shift",targetFilter:{owner:"any",position:"any",faceState:"any",excludeSelf:!1},destinationRestriction:{type:"to_this_lane",laneIndex:"current"}},position:"middle",useCardFromPreviousEffect:!0}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"gravity_4_shift_face_down_to_this_line",trigger:"on_play",params:{action:"shift",targetFilter:{owner:"any",position:"uncovered",faceState:"face_down",excludeSelf:!1},destinationRestriction:{type:"to_this_lane",laneIndex:"current"}},position:"middle"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"gravity_5_discard",trigger:"on_play",params:{action:"discard",count:1,actor:"self"},position:"middle"}],bottomEffects:[]},{value:6,topEffects:[],middleEffects:[{id:"gravity_6_opponent_plays",trigger:"on_play",params:{action:"play",source:"deck",count:1,faceDown:!0,destinationRule:{type:"specific_lane",laneIndex:"current"},actor:"opponent"},position:"middle",comment:"Opponent plays top of their deck in this line"}],bottomEffects:[]}],d1="Main 1",u1={id:o1,name:r1,description:l1,color:i1,pattern:c1,cards:s1,category:d1},p1="life_custom_1",f1="Life",h1="Life begets more life. Play cards from your deck to grow your presence.",m1="#3CE076",y1="hexagons",g1=[{value:0,topEffects:[],middleEffects:[{id:"life_0_play_each_line_with_card",trigger:"on_play",position:"middle",params:{action:"play",source:"deck",count:1,faceDown:!0,destinationRule:{type:"each_line_with_card",ownerFilter:"own"},actor:"self"}}],bottomEffects:[{id:"life_0_on_cover_delete_self",trigger:"on_cover",position:"bottom",params:{action:"delete",deleteSelf:!0}}]},{value:1,topEffects:[],middleEffects:[{id:"life_1_flip_1",trigger:"on_play",position:"middle",params:{action:"flip",count:1,optional:!1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1}}},{id:"life_1_flip_2",trigger:"on_play",position:"middle",params:{action:"flip",count:1,optional:!1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1}}}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"life_2_draw",trigger:"on_play",position:"middle",params:{action:"draw",count:1,target:"self",source:"own_deck"}},{id:"life_2_flip",trigger:"on_play",position:"middle",params:{action:"flip",count:1,optional:!0,targetFilter:{owner:"any",position:"uncovered",faceState:"face_down",excludeSelf:!1}}}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[],bottomEffects:[{id:"life_3_on_cover_play",trigger:"on_cover",position:"bottom",params:{action:"play",source:"deck",count:1,faceDown:!0,destinationRule:{type:"another_line",excludeCurrentLane:!0},actor:"self"}}]},{value:4,topEffects:[],middleEffects:[{id:"life_4_conditional_draw",trigger:"on_play",position:"middle",params:{action:"draw",count:1,target:"self",source:"own_deck",conditional:{type:"is_covering"}}}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"life_5_discard",trigger:"on_play",position:"middle",params:{action:"discard",count:1,actor:"self"}}],bottomEffects:[]}],v1="Main 1",_1={id:p1,name:f1,description:h1,color:m1,pattern:y1,cards:g1,category:v1},x1="light_custom_1",w1="Light",C1="Burn away the dark. Light protocol reveals and manipulates through illumination.",b1="System",S1="2025-11-14T00:00:00.000Z",E1="#F4D03F",j1="radial",k1=[{value:0,topEffects:[],middleEffects:[{id:"light-0-flip",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1},optional:!1},position:"middle",trigger:"on_play"},{id:"light-0-draw",params:{action:"draw",count:1,target:"self",source:"own_deck",countType:"equal_to_card_value"},position:"middle",trigger:"on_play",useCardFromPreviousEffect:!0}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[],bottomEffects:[{id:"light-1-draw",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"bottom",trigger:"end"}]},{value:2,topEffects:[],middleEffects:[{id:"light-2-draw",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"middle",trigger:"on_play"},{id:"light-2-reveal-board-card",params:{action:"reveal",source:"board",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"face_down"},optional:!0},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"light-3-shift-all",params:{action:"shift",count:"all",targetFilter:{owner:"any",position:"any",faceState:"face_down",excludeSelf:!1},destinationRestriction:{type:"to_another_line"},scope:"this_lane"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"light-4-reveal",params:{action:"reveal",source:"opponent_hand",count:-1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"light-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],R1="Main 1",A1={id:x1,name:w1,description:C1,author:b1,createdAt:S1,color:E1,pattern:j1,cards:k1,category:R1},T1="speed_custom_1",D1="Speed",N1="Swift and adaptive. Custom protocol migration of original Speed protocol.",F1="#33E6E6",q1="cross",$1=[{value:0,topEffects:[],middleEffects:[{id:"speed_0_play",trigger:"on_play",params:{action:"play",source:"hand",count:1},position:"middle"}],bottomEffects:[]},{value:1,topEffects:[{id:"speed_1_reactive_draw",trigger:"after_clear_cache",reactiveTriggerActor:"self",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"top"}],middleEffects:[{id:"speed_1_draw",trigger:"on_play",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"middle"}],bottomEffects:[]},{value:2,topEffects:[{id:"speed_2_before_compile",trigger:"before_compile_delete",params:{action:"shift",count:1,shiftSelf:!0,allowCoveredSelf:!0,targetFilter:{owner:"own",position:"any",faceState:"any"}},position:"top"}],middleEffects:[],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"speed_3_shift_other",trigger:"on_play",params:{action:"shift",count:1,targetFilter:{owner:"own",position:"uncovered",faceState:"any",excludeSelf:!0}},position:"middle"}],bottomEffects:[{id:"speed_3_end_shift",trigger:"end",params:{action:"shift",count:1,optional:!0,targetFilter:{owner:"own",position:"uncovered",faceState:"any"}},position:"bottom",conditional:{type:"if_executed",thenEffect:{id:"speed_3_flip_self",trigger:"on_play",params:{action:"flip",flipSelf:!0},position:"bottom"}}}]},{value:4,topEffects:[],middleEffects:[{id:"speed_4_shift_opponent",trigger:"on_play",params:{action:"shift",count:1,targetFilter:{owner:"opponent",position:"uncovered",faceState:"face_down"}},position:"middle"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"speed_5_discard",trigger:"on_play",params:{action:"discard",count:1,actor:"self"},position:"middle"}],bottomEffects:[]}],U1="Main 1",O1={id:T1,name:D1,description:N1,color:F1,pattern:q1,cards:$1,category:U1},I1="metal_custom_1",L1="Metal",M1="Unyielding defense. Custom protocol migration of original Metal protocol.",P1="#B0BEC5",H1="grid",z1=[{value:0,topEffects:[{id:"metal_0_reduce_opponent",trigger:"passive",params:{action:"value_modifier",modifier:{type:"add_to_total",value:-2,target:"opponent_total",scope:"this_lane"}},position:"top"}],middleEffects:[{id:"metal_0_flip",trigger:"on_play",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any"}},position:"middle"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"metal_1_draw",trigger:"on_play",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"middle"},{id:"metal_1_block_compile",trigger:"on_play",params:{action:"block_compile",target:"opponent"},position:"middle"}],bottomEffects:[]},{value:2,topEffects:[{id:"metal_2_block_face_down",trigger:"passive",params:{action:"passive_rule",rule:{type:"block_face_down_play",scope:"this_lane"}},position:"top"}],middleEffects:[],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"metal_3_draw",trigger:"on_play",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"middle"},{id:"metal_3_delete_lane",trigger:"on_play",params:{action:"delete_all_in_lane",laneCondition:{type:"min_cards",count:8},excludeCurrentLane:!0},position:"middle"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"metal_5_discard",trigger:"on_play",params:{action:"discard",count:1,actor:"self"},position:"middle"}],bottomEffects:[]},{value:6,topEffects:[{id:"metal_6_delete_on_cover_or_flip",trigger:"on_cover_or_flip",params:{action:"delete",deleteSelf:!0},position:"top"}],middleEffects:[],bottomEffects:[]}],V1="Main 1",B1={id:I1,name:L1,description:M1,color:P1,pattern:H1,cards:z1,category:V1},Y1="plague-custom-001",G1="Plague",W1="Focused on forcing opponent discards and restricting their plays. Spread suffering.",Q1="System Migration",X1="2025-11-26T00:00:00.000Z",Z1="#8FBC3A",K1="dual-radial",J1=[{value:0,topEffects:[],middleEffects:[{id:"plague-0-opponent-discard",params:{action:"discard",count:1,actor:"opponent"},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"plague-0-block-play",params:{action:"passive_rule",rule:{type:"block_all_play",target:"opponent",scope:"this_lane"}},position:"bottom",trigger:"passive"}]},{value:1,topEffects:[{id:"plague-1-reactive-draw",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"top",trigger:"after_opponent_discard"}],middleEffects:[{id:"plague-1-opponent-discard",params:{action:"discard",count:1,actor:"opponent"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"plague-2-self-discard",params:{action:"discard",count:1,actor:"self",variableCount:!0},position:"middle",trigger:"on_play",conditional:{type:"then",thenEffect:{id:"plague-2-opponent-discard",params:{action:"discard",actor:"opponent",countType:"equal_to_discarded",countOffset:1},position:"middle",trigger:"on_play"}}}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"plague-3-flip-each-other",params:{action:"flip",count:"all",scope:{type:"anywhere"},targetFilter:{faceState:"face_up",owner:"any",position:"uncovered",excludeSelf:!0}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,text:{bottom:"<div><span class='emphasis'>End:</span> Your opponent deletes 1 of their face-down cards. You may flip this card.</div>"},topEffects:[],middleEffects:[],bottomEffects:[{id:"plague-4-opponent-delete",params:{action:"delete",count:1,targetFilter:{faceState:"face_down",owner:"opponent",position:"uncovered"},scope:{type:"anywhere"},actorChooses:"card_owner"},position:"bottom",trigger:"end"},{id:"plague-4-may-flip-self",params:{action:"flip",flipSelf:!0,optional:!0},position:"bottom",trigger:"end"}]},{value:5,topEffects:[],middleEffects:[{id:"plague-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],eC="Main 1",tC={id:Y1,name:G1,description:W1,author:Q1,createdAt:X1,color:Z1,pattern:K1,cards:J1,category:eC},nC="love_custom_v1",aC="Love",oC="Custom Love protocol - hand manipulation, giving and taking cards",rC="System",lC="2025-01-08T00:00:00Z",iC="#f2a3d7",cC="radial",sC=[{value:1,topEffects:[],middleEffects:[{id:"love-1-draw-opponent-deck",params:{action:"draw",count:1,target:"self",source:"opponent_deck"},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"love-1-end-give",params:{action:"give",count:1,source:"own_hand",optional:!0},conditional:{type:"if_executed",thenEffect:{id:"love-1-end-draw",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"bottom",trigger:"on_play"}},position:"bottom",trigger:"end"}]},{value:2,topEffects:[],middleEffects:[{id:"love-2-opponent-draw",params:{action:"draw",count:1,target:"opponent",source:"own_deck"},position:"middle",trigger:"on_play"},{id:"love-2-refresh",params:{action:"refresh",target:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"love-3-take",params:{action:"take",count:1,random:!0},position:"middle",trigger:"on_play"},{id:"love-3-give",params:{action:"give",count:1,source:"own_hand",optional:!1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"love-4-reveal",params:{action:"reveal",count:1,source:"own_hand"},position:"middle",trigger:"on_play"},{id:"love-4-flip",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"love-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:6,topEffects:[],middleEffects:[{id:"love-6-opponent-draw",params:{action:"draw",count:2,target:"opponent",source:"own_deck"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],dC="Aux 1",uC={id:nC,name:aC,description:oC,author:rC,createdAt:lC,color:iC,pattern:cC,cards:sC,category:dC},pC="psychic_custom_v1",fC="Psychic",hC="Custom Psychic protocol - mind control, discard, reveal, and protocol manipulation",mC="System",yC="2025-01-08T00:00:00Z",gC="#c78dd9",vC="radial",_C=[{value:0,topEffects:[],middleEffects:[{id:"psychic-0-draw",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"middle",trigger:"on_play"},{id:"psychic-0-opponent-discard",params:{action:"discard",count:2,actor:"opponent"},position:"middle",trigger:"on_play"},{id:"psychic-0-reveal-hand",params:{action:"reveal",source:"opponent_hand",count:-1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[{id:"psychic-1-force-face-down",params:{action:"passive_rule",rule:{type:"require_face_down_play",target:"opponent",scope:"global"}},position:"top",trigger:"passive"}],middleEffects:[],bottomEffects:[{id:"psychic-1-start-flip-self",params:{action:"flip",count:1,targetFilter:{owner:"self",position:"any",faceState:"any",excludeSelf:!1},flipSelf:!0},position:"bottom",trigger:"start"}]},{value:2,topEffects:[],middleEffects:[{id:"psychic-2-opponent-discard",params:{action:"discard",count:2,actor:"opponent"},position:"middle",trigger:"on_play"},{id:"psychic-2-rearrange",params:{action:"rearrange_protocols",target:"opponent"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"psychic-3-opponent-discard",params:{action:"discard",count:1,actor:"opponent"},position:"middle",trigger:"on_play"},{id:"psychic-3-shift-opponent",params:{action:"shift",targetFilter:{owner:"opponent",position:"uncovered",faceState:"any",excludeSelf:!1},destinationRestriction:{type:"any"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[],bottomEffects:[{id:"psychic-4-end-return",params:{action:"return",count:1,optional:!0,targetFilter:{owner:"opponent",position:"uncovered",faceState:"any",excludeSelf:!1}},conditional:{type:"if_executed",thenEffect:{id:"psychic-4-end-flip-self",params:{action:"flip",count:1,flipSelf:!0,targetFilter:{owner:"self",position:"any",faceState:"any",excludeSelf:!1}},position:"bottom",trigger:"end"}},position:"bottom",trigger:"end"}]},{value:5,topEffects:[],middleEffects:[{id:"psychic-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],xC="Main 1",wC={id:pC,name:fC,description:hC,author:mC,createdAt:yC,color:gC,pattern:vC,cards:_C,category:xC},CC="smoke-custom-001",bC="Smoke",SC="Shroud your cards in mystery. Use face-down cards to gain value and control.",EC="System",jC="2025-12-09T00:00:00.000Z",kC="#5A5A5A",RC="radial",AC=[{value:0,topEffects:[],middleEffects:[{id:"smoke-0-play-deck-each-facedown",params:{action:"play",source:"deck",count:1,faceDown:!0,destinationRule:{type:"each_line_with_card",cardFilter:{faceState:"face_down"}}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"smoke-1-flip-own",params:{action:"flip",count:1,targetFilter:{owner:"own",position:"uncovered",faceState:"any"},optional:!1},position:"middle",trigger:"on_play"},{id:"smoke-1-shift-that-card",params:{action:"shift",optional:!0,targetFilter:{owner:"own",position:"uncovered",faceState:"any"}},position:"middle",trigger:"on_play",useCardFromPreviousEffect:!0}],bottomEffects:[]},{value:2,topEffects:[{id:"smoke-2-value-per-facedown",params:{action:"value_modifier",modifier:{type:"add_per_condition",value:1,condition:"per_face_down_card",target:"own_total",scope:"this_lane"}},position:"top",trigger:"passive"}],middleEffects:[],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"smoke-3-play-hand-facedown-lane",params:{action:"play",source:"hand",count:1,faceDown:!0,destinationRule:{type:"line_with_matching_cards",cardFilter:{faceState:"face_down"}}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"smoke-4-shift-covered-facedown",params:{action:"shift",optional:!1,targetFilter:{owner:"any",position:"covered",faceState:"face_down"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"smoke-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],TC="Main 2",DC={id:CC,name:bC,description:SC,author:EC,createdAt:jC,color:kC,pattern:RC,cards:AC,category:TC},NC="clarity-custom-001",FC="Clarity",qC="See through the fog of war. Reveal your deck and hand to gain powerful advantages.",$C="System",UC="2025-12-09T00:00:00.000Z",OC="#87CEEB",IC="radial",LC=[{value:0,topEffects:[{id:"clarity-0-value-per-hand",params:{action:"value_modifier",modifier:{type:"add_per_condition",value:1,condition:"per_card_in_hand",target:"own_total",scope:"this_lane"}},position:"top",trigger:"passive"}],middleEffects:[],bottomEffects:[]},{value:1,topEffects:[{id:"clarity-1-start-reveal-deck-top",params:{action:"reveal",source:"own_deck_top",count:1},position:"top",trigger:"start",conditional:{type:"optional",thenEffect:{id:"clarity-1-discard-revealed",params:{action:"discard",count:1,actor:"self",useCardFromPreviousEffect:!0}}}}],middleEffects:[{id:"clarity-1-middle-reveal-opponent-hand",params:{action:"reveal",source:"opponent_hand",count:-1},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"clarity-1-bottom-draw-3",params:{action:"draw",count:3,target:"self",source:"own_deck"},position:"bottom",trigger:"on_cover"}]},{value:2,topEffects:[],middleEffects:[{id:"clarity-2-reveal-deck",params:{action:"reveal",source:"own_deck",count:-1},position:"middle",trigger:"on_play"},{id:"clarity-2-draw-value-1",params:{action:"draw",count:1,target:"self",source:"own_deck",valueFilter:{equals:1},fromRevealed:!0},position:"middle",trigger:"on_play"},{id:"clarity-2-shuffle-deck",params:{action:"shuffle_deck"},position:"middle",trigger:"on_play"},{id:"clarity-2-play-value-1",params:{action:"play",source:"hand",count:1,faceDown:!1,valueFilter:{equals:1}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"clarity-3-reveal-deck",params:{action:"reveal",source:"own_deck",count:-1},position:"middle",trigger:"on_play"},{id:"clarity-3-draw-value-5",params:{action:"draw",count:1,target:"self",source:"own_deck",valueFilter:{equals:5},fromRevealed:!0},position:"middle",trigger:"on_play"},{id:"clarity-3-shuffle-deck",params:{action:"shuffle_deck"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"clarity-4-shuffle-trash",params:{action:"shuffle_trash",optional:!0},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"clarity-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],MC="Main 2",PC={id:NC,name:FC,description:qC,author:$C,createdAt:UC,color:OC,pattern:IC,cards:LC,category:MC},HC="corruption-custom-001",zC="Corruption",VC="Corrupt your opponents plans. Use discard synergies and manipulate the return mechanic.",BC="System",YC="2025-12-09T00:00:00.000Z",GC="#4A0080",WC="stripes",QC=[{value:0,topEffects:[{id:"corruption-0-start-flip",params:{action:"flip",count:1,scope:"this_lane",targetFilter:{owner:"own",position:"any",faceState:"face_up",excludeSelf:!0},optional:!1},position:"top",trigger:"start"}],middleEffects:[],bottomEffects:[{id:"corruption-0-play-opponent-side",params:{action:"passive_rule",rule:{type:"allow_play_on_opponent_side",target:"self",scope:"global"}},position:"bottom",trigger:"passive"}]},{value:1,topEffects:[],middleEffects:[{id:"corruption-1-return",params:{action:"return",count:1,targetFilter:{owner:"any",position:"uncovered"}},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"corruption-1-redirect-return",params:{action:"redirect_return_to_deck",faceDown:!0,targetOwner:"opponent"},position:"bottom",trigger:"when_card_returned"}]},{value:2,topEffects:[{id:"corruption-2-after-discard",params:{action:"discard",count:1,actor:"opponent"},position:"top",trigger:"after_discard",reactiveTriggerActor:"self"}],middleEffects:[{id:"corruption-2-draw",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"middle",trigger:"on_play"},{id:"corruption-2-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"corruption-3-flip-covered",params:{action:"flip",count:1,optional:!0,targetFilter:{owner:"any",position:"covered",faceState:"face_up",excludeSelf:!1}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"corruption-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:6,topEffects:[{id:"corruption-6-end-choice",params:{action:"choice",options:[{id:"corruption-6-choice-discard",params:{action:"discard",count:1,actor:"self"},position:"top",trigger:"end"},{id:"corruption-6-choice-delete-self",params:{action:"delete",deleteSelf:!0},position:"top",trigger:"end"}]},position:"top",trigger:"end"}],middleEffects:[],bottomEffects:[]}],XC="Main 2",ZC={id:HC,name:zC,description:VC,author:BC,createdAt:YC,color:GC,pattern:WC,cards:QC,category:XC},KC="courage-custom-001",JC="Courage",eb="Face challenges head-on. Gain power when outnumbered.",tb="System",nb="2025-12-10T00:00:00.000Z",ab="#D4AF37",ob="radial",rb=[{value:0,topEffects:[{id:"courage-0-start-draw",params:{action:"draw",count:1,advancedConditional:{type:"empty_hand"}},position:"top",trigger:"start"}],middleEffects:[{id:"courage-0-draw",params:{action:"draw",count:1},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"courage-0-end-discard",params:{action:"discard",count:1,optional:!0},position:"bottom",trigger:"end",conditional:{type:"if_executed",thenEffect:{id:"courage-0-opponent-discard",params:{action:"discard",count:1,actor:"opponent"},position:"bottom",trigger:"end"}}}]},{value:1,topEffects:[],middleEffects:[{id:"courage-1-delete",params:{action:"delete",count:1,targetFilter:{owner:"opponent",position:"uncovered"},selectLane:!0,laneCondition:{type:"opponent_higher_value"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"courage-2-draw",params:{action:"draw",count:1},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"courage-2-end-draw",params:{action:"draw",count:1,advancedConditional:{type:"opponent_higher_value_in_lane"}},position:"bottom",trigger:"end"}]},{value:3,topEffects:[],middleEffects:[],bottomEffects:[{id:"courage-3-shift",params:{action:"shift",shiftSelf:!0,optional:!0,destinationRestriction:{type:"opponent_highest_value_lane"}},position:"bottom",trigger:"end"}]},{value:5,topEffects:[],middleEffects:[{id:"courage-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:6,topEffects:[{id:"courage-6-flip",params:{action:"flip",flipSelf:!0,advancedConditional:{type:"opponent_higher_value_in_lane"}},position:"top",trigger:"end"}],middleEffects:[],bottomEffects:[]}],lb="Main 2",ib={id:KC,name:JC,description:eb,author:tb,createdAt:nb,color:ab,pattern:ob,cards:rb,category:lb},cb="fear_custom",sb="Fear",db="Terror and disruption protocol - Control through fear",ub="System",pb="2025-01-10T00:00:00Z",fb="#800020",hb="radial",mb="Main 2",yb=[{value:0,topEffects:[{id:"fear-0-passive",params:{action:"passive_rule",rule:{type:"ignore_middle_commands",target:"opponent",scope:"global",onlyDuringYourTurn:!0}},position:"top",trigger:"passive"}],middleEffects:[{id:"fear-0-choice",params:{action:"choice",options:[{id:"fear-0-shift",params:{action:"shift",targetFilter:{owner:"any",position:"uncovered",faceState:"any"}},position:"middle",trigger:"on_play"},{id:"fear-0-flip",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1},optional:!1},position:"middle",trigger:"on_play"}]},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"fear-1-draw",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"middle",trigger:"on_play",conditional:{type:"then",thenEffect:{id:"fear-1-opponent-discard-hand",params:{action:"discard",count:"all",actor:"opponent"},position:"middle",trigger:"on_play",conditional:{type:"then",thenEffect:{id:"fear-1-opponent-draw",params:{action:"draw",countType:"equal_to_discarded",countOffset:-1,target:"opponent",source:"own_deck"},position:"middle",trigger:"on_play"}}}}}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"fear-2-return",params:{action:"return",count:1,targetFilter:{owner:"opponent"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"fear-3-shift",params:{action:"shift",targetFilter:{owner:"opponent",position:"any",faceState:"any"},scope:"this_lane"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"fear-4-discard-random",params:{action:"discard",count:1,actor:"opponent",random:!0},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"fear-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],gb={id:cb,name:sb,description:db,author:ub,createdAt:pb,color:fb,pattern:hb,category:mb,cards:yb},vb="ice_custom",_b="Ice",xb="Control and disruption through shifting and conditional effects",wb="System",Cb="2025-12-10T00:00:00Z",bb="#B0E0E6",Sb="radial",Eb="Main 2",jb=[{value:1,topEffects:[],middleEffects:[{id:"ice-1-shift",params:{action:"shift",shiftSelf:!0,optional:!0},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"ice-1-reactive",params:{action:"discard",actor:"opponent",count:1},position:"bottom",trigger:"after_play",reactiveTriggerActor:"opponent",reactiveScope:"this_lane"}]},{value:2,topEffects:[],middleEffects:[{id:"ice-2-shift",params:{action:"shift",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!0}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[{id:"ice-3-end-shift",params:{action:"shift",shiftSelf:!0,optional:!0,advancedConditional:{type:"this_card_is_covered"}},position:"top",trigger:"end"}],middleEffects:[],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[],bottomEffects:[{id:"ice-4-passive",params:{action:"passive_rule",rule:{type:"block_flip_this_card",target:"this_card",scope:"this_card"}},position:"bottom",trigger:"passive"}]},{value:5,topEffects:[],middleEffects:[{id:"ice-5-discard",params:{action:"discard",actor:"self",count:1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:6,topEffects:[{id:"ice-6-passive",params:{action:"passive_rule",rule:{type:"block_draw_conditional",conditionTarget:"self",blockTarget:"self",scope:"global"}},position:"top",trigger:"passive"}],middleEffects:[],bottomEffects:[]}],kb={id:vb,name:_b,description:xb,author:wb,createdAt:Cb,color:bb,pattern:Sb,category:Eb,cards:jb};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Rb=()=>{try{const a=Do(),n=a.findIndex(l=>l.id==="dark_cust_v2"||l.name==="Dark_cust");n>=0&&(a.splice(n,1),Ed(a)),mt(Ax),mt(Lx),mt(aw),mt(fw),mt(bw),mt(Qw),mt(a1),mt(Gx),mt(u1),mt(Dw),mt(Pw),mt(_1),mt(A1),mt(O1),mt(B1),mt(tC),mt(uC),mt(wC),mt(DC),mt(PC),mt(ZC),mt(ib),mt(gb),mt(kb)}catch(a){console.error("[Default Protocols] Error loading default protocols:",a)}};function Ab(){const[a,n]=re.useState("MainMenu"),[l,c]=re.useState([]),[s,d]=re.useState([]),[p,f]=re.useState(null),[h,m]=re.useState("easy"),[g,y]=re.useState(null),[w,_]=re.useState(!0),[b,k]=re.useState("player");re.useEffect(()=>{Rb()},[]);const S=re.useCallback(()=>{n("MainMenu"),c([]),d([]),f(null),y(null)},[]);re.useEffect(()=>{const N=T=>{T.key==="Escape"&&S()};return window.addEventListener("keydown",N),()=>{window.removeEventListener("keydown",N)}},[S]);const $=re.useCallback((N,T)=>{c(N),d(T),f(null),y(null),k("player"),n("GameScreen")},[]),E=re.useCallback((N,T)=>{f(N),y(T),n("ResultsScreen")},[]),C=()=>{switch(a){case"MainMenu":return r.jsx(gh,{onNavigate:N=>n(N),difficulty:h,setDifficulty:m,useControl:w,onUseControlChange:_});case"ProtocolSelection":return r.jsx(t_,{onBack:S,onStartGame:$});case"GameScreen":return r.jsx(V0,{onBack:S,onEndGame:E,playerProtocols:l,opponentProtocols:s,difficulty:h,useControlMechanic:w,startingPlayer:b});case"ResultsScreen":return r.jsx(B0,{onPlayAgain:S,winner:p,finalState:g,difficulty:h});case"CardLibrary":return r.jsx(Y0,{onBack:S});case"Statistics":return r.jsx(G0,{onBack:S});case"CustomProtocols":return r.jsx(dx,{onBack:S});case"Rules":return r.jsx(_x,{onBack:S});default:return r.jsx(gh,{onNavigate:N=>n(N),difficulty:h,setDifficulty:m,useControl:w,onUseControlChange:_})}};return r.jsx(r.Fragment,{children:C()})}const Tb=document.getElementById("root"),Db=Vv.createRoot(Tb);Db.render(r.jsx(Ab,{}));
