(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const l of r)if(l.type==="childList")for(const s of l.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function c(r){const l={};return r.integrity&&(l.integrity=r.integrity),r.referrerPolicy&&(l.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?l.credentials="include":r.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function i(r){if(r.ep)return;r.ep=!0;const l=c(r);fetch(r.href,l)}})();function Pm(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Mi={exports:{}},Hr={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Qf;function Im(){if(Qf)return Hr;Qf=1;var n=Symbol.for("react.transitional.element"),o=Symbol.for("react.fragment");function c(i,r,l){var s=null;if(l!==void 0&&(s=""+l),r.key!==void 0&&(s=""+r.key),"key"in r){l={};for(var f in r)f!=="key"&&(l[f]=r[f])}else l=r;return r=l.ref,{$$typeof:n,type:i,key:s,ref:r!==void 0?r:null,props:l}}return Hr.Fragment=o,Hr.jsx=c,Hr.jsxs=c,Hr}var Xf;function Hm(){return Xf||(Xf=1,Mi.exports=Im()),Mi.exports}var u=Hm(),Pi={exports:{}},Vr={},Ii={exports:{}},Hi={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Zf;function Vm(){return Zf||(Zf=1,(function(n){function o(k,W){var ee=k.length;k.push(W);e:for(;0<ee;){var ge=ee-1>>>1,F=k[ge];if(0<r(F,W))k[ge]=W,k[ee]=F,ee=ge;else break e}}function c(k){return k.length===0?null:k[0]}function i(k){if(k.length===0)return null;var W=k[0],ee=k.pop();if(ee!==W){k[0]=ee;e:for(var ge=0,F=k.length,O=F>>>1;ge<O;){var K=2*(ge+1)-1,U=k[K],Q=K+1,ye=k[Q];if(0>r(U,ee))Q<F&&0>r(ye,U)?(k[ge]=ye,k[Q]=ee,ge=Q):(k[ge]=U,k[K]=ee,ge=K);else if(Q<F&&0>r(ye,ee))k[ge]=ye,k[Q]=ee,ge=Q;else break e}}return W}function r(k,W){var ee=k.sortIndex-W.sortIndex;return ee!==0?ee:k.id-W.id}if(n.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var l=performance;n.unstable_now=function(){return l.now()}}else{var s=Date,f=s.now();n.unstable_now=function(){return s.now()-f}}var p=[],h=[],_=1,m=null,v=3,w=!1,x=!1,C=!1,S=!1,E=typeof setTimeout=="function"?setTimeout:null,j=typeof clearTimeout=="function"?clearTimeout:null,D=typeof setImmediate<"u"?setImmediate:null;function A(k){for(var W=c(h);W!==null;){if(W.callback===null)i(h);else if(W.startTime<=k)i(h),W.sortIndex=W.expirationTime,o(p,W);else break;W=c(h)}}function L(k){if(C=!1,A(k),!x)if(c(p)!==null)x=!0,H||(H=!0,G());else{var W=c(h);W!==null&&N(L,W.startTime-k)}}var H=!1,ce=-1,B=5,z=-1;function V(){return S?!0:!(n.unstable_now()-z<B)}function le(){if(S=!1,H){var k=n.unstable_now();z=k;var W=!0;try{e:{x=!1,C&&(C=!1,j(ce),ce=-1),w=!0;var ee=v;try{t:{for(A(k),m=c(p);m!==null&&!(m.expirationTime>k&&V());){var ge=m.callback;if(typeof ge=="function"){m.callback=null,v=m.priorityLevel;var F=ge(m.expirationTime<=k);if(k=n.unstable_now(),typeof F=="function"){m.callback=F,A(k),W=!0;break t}m===c(p)&&i(p),A(k)}else i(p);m=c(p)}if(m!==null)W=!0;else{var O=c(h);O!==null&&N(L,O.startTime-k),W=!1}}break e}finally{m=null,v=ee,w=!1}W=void 0}}finally{W?G():H=!1}}}var G;if(typeof D=="function")G=function(){D(le)};else if(typeof MessageChannel<"u"){var P=new MessageChannel,q=P.port2;P.port1.onmessage=le,G=function(){q.postMessage(null)}}else G=function(){E(le,0)};function N(k,W){ce=E(function(){k(n.unstable_now())},W)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(k){k.callback=null},n.unstable_forceFrameRate=function(k){0>k||125<k?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):B=0<k?Math.floor(1e3/k):5},n.unstable_getCurrentPriorityLevel=function(){return v},n.unstable_next=function(k){switch(v){case 1:case 2:case 3:var W=3;break;default:W=v}var ee=v;v=W;try{return k()}finally{v=ee}},n.unstable_requestPaint=function(){S=!0},n.unstable_runWithPriority=function(k,W){switch(k){case 1:case 2:case 3:case 4:case 5:break;default:k=3}var ee=v;v=k;try{return W()}finally{v=ee}},n.unstable_scheduleCallback=function(k,W,ee){var ge=n.unstable_now();switch(typeof ee=="object"&&ee!==null?(ee=ee.delay,ee=typeof ee=="number"&&0<ee?ge+ee:ge):ee=ge,k){case 1:var F=-1;break;case 2:F=250;break;case 5:F=1073741823;break;case 4:F=1e4;break;default:F=5e3}return F=ee+F,k={id:_++,callback:W,priorityLevel:k,startTime:ee,expirationTime:F,sortIndex:-1},ee>ge?(k.sortIndex=ee,o(h,k),c(p)===null&&k===c(h)&&(C?(j(ce),ce=-1):C=!0,N(L,ee-ge))):(k.sortIndex=F,o(p,k),x||w||(x=!0,H||(H=!0,G()))),k},n.unstable_shouldYield=V,n.unstable_wrapCallback=function(k){var W=v;return function(){var ee=v;v=W;try{return k.apply(this,arguments)}finally{v=ee}}}})(Hi)),Hi}var Kf;function Bm(){return Kf||(Kf=1,Ii.exports=Vm()),Ii.exports}var Vi={exports:{}},qe={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Jf;function zm(){if(Jf)return qe;Jf=1;var n=Symbol.for("react.transitional.element"),o=Symbol.for("react.portal"),c=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),l=Symbol.for("react.consumer"),s=Symbol.for("react.context"),f=Symbol.for("react.forward_ref"),p=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),_=Symbol.for("react.lazy"),m=Symbol.iterator;function v(F){return F===null||typeof F!="object"?null:(F=m&&F[m]||F["@@iterator"],typeof F=="function"?F:null)}var w={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},x=Object.assign,C={};function S(F,O,K){this.props=F,this.context=O,this.refs=C,this.updater=K||w}S.prototype.isReactComponent={},S.prototype.setState=function(F,O){if(typeof F!="object"&&typeof F!="function"&&F!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,F,O,"setState")},S.prototype.forceUpdate=function(F){this.updater.enqueueForceUpdate(this,F,"forceUpdate")};function E(){}E.prototype=S.prototype;function j(F,O,K){this.props=F,this.context=O,this.refs=C,this.updater=K||w}var D=j.prototype=new E;D.constructor=j,x(D,S.prototype),D.isPureReactComponent=!0;var A=Array.isArray,L={H:null,A:null,T:null,S:null,V:null},H=Object.prototype.hasOwnProperty;function ce(F,O,K,U,Q,ye){return K=ye.ref,{$$typeof:n,type:F,key:O,ref:K!==void 0?K:null,props:ye}}function B(F,O){return ce(F.type,O,void 0,void 0,void 0,F.props)}function z(F){return typeof F=="object"&&F!==null&&F.$$typeof===n}function V(F){var O={"=":"=0",":":"=2"};return"$"+F.replace(/[=:]/g,function(K){return O[K]})}var le=/\/+/g;function G(F,O){return typeof F=="object"&&F!==null&&F.key!=null?V(""+F.key):O.toString(36)}function P(){}function q(F){switch(F.status){case"fulfilled":return F.value;case"rejected":throw F.reason;default:switch(typeof F.status=="string"?F.then(P,P):(F.status="pending",F.then(function(O){F.status==="pending"&&(F.status="fulfilled",F.value=O)},function(O){F.status==="pending"&&(F.status="rejected",F.reason=O)})),F.status){case"fulfilled":return F.value;case"rejected":throw F.reason}}throw F}function N(F,O,K,U,Q){var ye=typeof F;(ye==="undefined"||ye==="boolean")&&(F=null);var fe=!1;if(F===null)fe=!0;else switch(ye){case"bigint":case"string":case"number":fe=!0;break;case"object":switch(F.$$typeof){case n:case o:fe=!0;break;case _:return fe=F._init,N(fe(F._payload),O,K,U,Q)}}if(fe)return Q=Q(F),fe=U===""?"."+G(F,0):U,A(Q)?(K="",fe!=null&&(K=fe.replace(le,"$&/")+"/"),N(Q,O,K,"",function(re){return re})):Q!=null&&(z(Q)&&(Q=B(Q,K+(Q.key==null||F&&F.key===Q.key?"":(""+Q.key).replace(le,"$&/")+"/")+fe)),O.push(Q)),1;fe=0;var ne=U===""?".":U+":";if(A(F))for(var X=0;X<F.length;X++)U=F[X],ye=ne+G(U,X),fe+=N(U,O,K,ye,Q);else if(X=v(F),typeof X=="function")for(F=X.call(F),X=0;!(U=F.next()).done;)U=U.value,ye=ne+G(U,X++),fe+=N(U,O,K,ye,Q);else if(ye==="object"){if(typeof F.then=="function")return N(q(F),O,K,U,Q);throw O=String(F),Error("Objects are not valid as a React child (found: "+(O==="[object Object]"?"object with keys {"+Object.keys(F).join(", ")+"}":O)+"). If you meant to render a collection of children, use an array instead.")}return fe}function k(F,O,K){if(F==null)return F;var U=[],Q=0;return N(F,U,"","",function(ye){return O.call(K,ye,Q++)}),U}function W(F){if(F._status===-1){var O=F._result;O=O(),O.then(function(K){(F._status===0||F._status===-1)&&(F._status=1,F._result=K)},function(K){(F._status===0||F._status===-1)&&(F._status=2,F._result=K)}),F._status===-1&&(F._status=0,F._result=O)}if(F._status===1)return F._result.default;throw F._result}var ee=typeof reportError=="function"?reportError:function(F){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var O=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof F=="object"&&F!==null&&typeof F.message=="string"?String(F.message):String(F),error:F});if(!window.dispatchEvent(O))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",F);return}console.error(F)};function ge(){}return qe.Children={map:k,forEach:function(F,O,K){k(F,function(){O.apply(this,arguments)},K)},count:function(F){var O=0;return k(F,function(){O++}),O},toArray:function(F){return k(F,function(O){return O})||[]},only:function(F){if(!z(F))throw Error("React.Children.only expected to receive a single React element child.");return F}},qe.Component=S,qe.Fragment=c,qe.Profiler=r,qe.PureComponent=j,qe.StrictMode=i,qe.Suspense=p,qe.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=L,qe.__COMPILER_RUNTIME={__proto__:null,c:function(F){return L.H.useMemoCache(F)}},qe.cache=function(F){return function(){return F.apply(null,arguments)}},qe.cloneElement=function(F,O,K){if(F==null)throw Error("The argument must be a React element, but you passed "+F+".");var U=x({},F.props),Q=F.key,ye=void 0;if(O!=null)for(fe in O.ref!==void 0&&(ye=void 0),O.key!==void 0&&(Q=""+O.key),O)!H.call(O,fe)||fe==="key"||fe==="__self"||fe==="__source"||fe==="ref"&&O.ref===void 0||(U[fe]=O[fe]);var fe=arguments.length-2;if(fe===1)U.children=K;else if(1<fe){for(var ne=Array(fe),X=0;X<fe;X++)ne[X]=arguments[X+2];U.children=ne}return ce(F.type,Q,void 0,void 0,ye,U)},qe.createContext=function(F){return F={$$typeof:s,_currentValue:F,_currentValue2:F,_threadCount:0,Provider:null,Consumer:null},F.Provider=F,F.Consumer={$$typeof:l,_context:F},F},qe.createElement=function(F,O,K){var U,Q={},ye=null;if(O!=null)for(U in O.key!==void 0&&(ye=""+O.key),O)H.call(O,U)&&U!=="key"&&U!=="__self"&&U!=="__source"&&(Q[U]=O[U]);var fe=arguments.length-2;if(fe===1)Q.children=K;else if(1<fe){for(var ne=Array(fe),X=0;X<fe;X++)ne[X]=arguments[X+2];Q.children=ne}if(F&&F.defaultProps)for(U in fe=F.defaultProps,fe)Q[U]===void 0&&(Q[U]=fe[U]);return ce(F,ye,void 0,void 0,null,Q)},qe.createRef=function(){return{current:null}},qe.forwardRef=function(F){return{$$typeof:f,render:F}},qe.isValidElement=z,qe.lazy=function(F){return{$$typeof:_,_payload:{_status:-1,_result:F},_init:W}},qe.memo=function(F,O){return{$$typeof:h,type:F,compare:O===void 0?null:O}},qe.startTransition=function(F){var O=L.T,K={};L.T=K;try{var U=F(),Q=L.S;Q!==null&&Q(K,U),typeof U=="object"&&U!==null&&typeof U.then=="function"&&U.then(ge,ee)}catch(ye){ee(ye)}finally{L.T=O}},qe.unstable_useCacheRefresh=function(){return L.H.useCacheRefresh()},qe.use=function(F){return L.H.use(F)},qe.useActionState=function(F,O,K){return L.H.useActionState(F,O,K)},qe.useCallback=function(F,O){return L.H.useCallback(F,O)},qe.useContext=function(F){return L.H.useContext(F)},qe.useDebugValue=function(){},qe.useDeferredValue=function(F,O){return L.H.useDeferredValue(F,O)},qe.useEffect=function(F,O,K){var U=L.H;if(typeof K=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return U.useEffect(F,O)},qe.useId=function(){return L.H.useId()},qe.useImperativeHandle=function(F,O,K){return L.H.useImperativeHandle(F,O,K)},qe.useInsertionEffect=function(F,O){return L.H.useInsertionEffect(F,O)},qe.useLayoutEffect=function(F,O){return L.H.useLayoutEffect(F,O)},qe.useMemo=function(F,O){return L.H.useMemo(F,O)},qe.useOptimistic=function(F,O){return L.H.useOptimistic(F,O)},qe.useReducer=function(F,O,K){return L.H.useReducer(F,O,K)},qe.useRef=function(F){return L.H.useRef(F)},qe.useState=function(F){return L.H.useState(F)},qe.useSyncExternalStore=function(F,O,K){return L.H.useSyncExternalStore(F,O,K)},qe.useTransition=function(){return L.H.useTransition()},qe.version="19.1.1",qe}var eh;function sd(){return eh||(eh=1,Vi.exports=zm()),Vi.exports}var Bi={exports:{}},Yt={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var th;function Gm(){if(th)return Yt;th=1;var n=sd();function o(p){var h="https://react.dev/errors/"+p;if(1<arguments.length){h+="?args[]="+encodeURIComponent(arguments[1]);for(var _=2;_<arguments.length;_++)h+="&args[]="+encodeURIComponent(arguments[_])}return"Minified React error #"+p+"; visit "+h+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function c(){}var i={d:{f:c,r:function(){throw Error(o(522))},D:c,C:c,L:c,m:c,X:c,S:c,M:c},p:0,findDOMNode:null},r=Symbol.for("react.portal");function l(p,h,_){var m=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:r,key:m==null?null:""+m,children:p,containerInfo:h,implementation:_}}var s=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function f(p,h){if(p==="font")return"";if(typeof h=="string")return h==="use-credentials"?h:""}return Yt.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=i,Yt.createPortal=function(p,h){var _=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11)throw Error(o(299));return l(p,h,null,_)},Yt.flushSync=function(p){var h=s.T,_=i.p;try{if(s.T=null,i.p=2,p)return p()}finally{s.T=h,i.p=_,i.d.f()}},Yt.preconnect=function(p,h){typeof p=="string"&&(h?(h=h.crossOrigin,h=typeof h=="string"?h==="use-credentials"?h:"":void 0):h=null,i.d.C(p,h))},Yt.prefetchDNS=function(p){typeof p=="string"&&i.d.D(p)},Yt.preinit=function(p,h){if(typeof p=="string"&&h&&typeof h.as=="string"){var _=h.as,m=f(_,h.crossOrigin),v=typeof h.integrity=="string"?h.integrity:void 0,w=typeof h.fetchPriority=="string"?h.fetchPriority:void 0;_==="style"?i.d.S(p,typeof h.precedence=="string"?h.precedence:void 0,{crossOrigin:m,integrity:v,fetchPriority:w}):_==="script"&&i.d.X(p,{crossOrigin:m,integrity:v,fetchPriority:w,nonce:typeof h.nonce=="string"?h.nonce:void 0})}},Yt.preinitModule=function(p,h){if(typeof p=="string")if(typeof h=="object"&&h!==null){if(h.as==null||h.as==="script"){var _=f(h.as,h.crossOrigin);i.d.M(p,{crossOrigin:_,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0})}}else h==null&&i.d.M(p)},Yt.preload=function(p,h){if(typeof p=="string"&&typeof h=="object"&&h!==null&&typeof h.as=="string"){var _=h.as,m=f(_,h.crossOrigin);i.d.L(p,_,{crossOrigin:m,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0,type:typeof h.type=="string"?h.type:void 0,fetchPriority:typeof h.fetchPriority=="string"?h.fetchPriority:void 0,referrerPolicy:typeof h.referrerPolicy=="string"?h.referrerPolicy:void 0,imageSrcSet:typeof h.imageSrcSet=="string"?h.imageSrcSet:void 0,imageSizes:typeof h.imageSizes=="string"?h.imageSizes:void 0,media:typeof h.media=="string"?h.media:void 0})}},Yt.preloadModule=function(p,h){if(typeof p=="string")if(h){var _=f(h.as,h.crossOrigin);i.d.m(p,{as:typeof h.as=="string"&&h.as!=="script"?h.as:void 0,crossOrigin:_,integrity:typeof h.integrity=="string"?h.integrity:void 0})}else i.d.m(p)},Yt.requestFormReset=function(p){i.d.r(p)},Yt.unstable_batchedUpdates=function(p,h){return p(h)},Yt.useFormState=function(p,h,_){return s.H.useFormState(p,h,_)},Yt.useFormStatus=function(){return s.H.useHostTransitionStatus()},Yt.version="19.1.1",Yt}var nh;function Ym(){if(nh)return Bi.exports;nh=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(o){console.error(o)}}return n(),Bi.exports=Gm(),Bi.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var oh;function Wm(){if(oh)return Vr;oh=1;var n=Bm(),o=sd(),c=Ym();function i(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var a=2;a<arguments.length;a++)t+="&args[]="+encodeURIComponent(arguments[a])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function r(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function l(e){var t=e,a=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,(t.flags&4098)!==0&&(a=t.return),e=t.return;while(e)}return t.tag===3?a:null}function s(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function f(e){if(l(e)!==e)throw Error(i(188))}function p(e){var t=e.alternate;if(!t){if(t=l(e),t===null)throw Error(i(188));return t!==e?null:e}for(var a=e,d=t;;){var y=a.return;if(y===null)break;var g=y.alternate;if(g===null){if(d=y.return,d!==null){a=d;continue}break}if(y.child===g.child){for(g=y.child;g;){if(g===a)return f(y),e;if(g===d)return f(y),t;g=g.sibling}throw Error(i(188))}if(a.return!==d.return)a=y,d=g;else{for(var b=!1,R=y.child;R;){if(R===a){b=!0,a=y,d=g;break}if(R===d){b=!0,d=y,a=g;break}R=R.sibling}if(!b){for(R=g.child;R;){if(R===a){b=!0,a=g,d=y;break}if(R===d){b=!0,d=g,a=y;break}R=R.sibling}if(!b)throw Error(i(189))}}if(a.alternate!==d)throw Error(i(190))}if(a.tag!==3)throw Error(i(188));return a.stateNode.current===a?e:t}function h(e){var t=e.tag;if(t===5||t===26||t===27||t===6)return e;for(e=e.child;e!==null;){if(t=h(e),t!==null)return t;e=e.sibling}return null}var _=Object.assign,m=Symbol.for("react.element"),v=Symbol.for("react.transitional.element"),w=Symbol.for("react.portal"),x=Symbol.for("react.fragment"),C=Symbol.for("react.strict_mode"),S=Symbol.for("react.profiler"),E=Symbol.for("react.provider"),j=Symbol.for("react.consumer"),D=Symbol.for("react.context"),A=Symbol.for("react.forward_ref"),L=Symbol.for("react.suspense"),H=Symbol.for("react.suspense_list"),ce=Symbol.for("react.memo"),B=Symbol.for("react.lazy"),z=Symbol.for("react.activity"),V=Symbol.for("react.memo_cache_sentinel"),le=Symbol.iterator;function G(e){return e===null||typeof e!="object"?null:(e=le&&e[le]||e["@@iterator"],typeof e=="function"?e:null)}var P=Symbol.for("react.client.reference");function q(e){if(e==null)return null;if(typeof e=="function")return e.$$typeof===P?null:e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case x:return"Fragment";case S:return"Profiler";case C:return"StrictMode";case L:return"Suspense";case H:return"SuspenseList";case z:return"Activity"}if(typeof e=="object")switch(e.$$typeof){case w:return"Portal";case D:return(e.displayName||"Context")+".Provider";case j:return(e._context.displayName||"Context")+".Consumer";case A:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case ce:return t=e.displayName||null,t!==null?t:q(e.type)||"Memo";case B:t=e._payload,e=e._init;try{return q(e(t))}catch{}}return null}var N=Array.isArray,k=o.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,W=c.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ee={pending:!1,data:null,method:null,action:null},ge=[],F=-1;function O(e){return{current:e}}function K(e){0>F||(e.current=ge[F],ge[F]=null,F--)}function U(e,t){F++,ge[F]=e.current,e.current=t}var Q=O(null),ye=O(null),fe=O(null),ne=O(null);function X(e,t){switch(U(fe,t),U(ye,e),U(Q,null),t.nodeType){case 9:case 11:e=(e=t.documentElement)&&(e=e.namespaceURI)?Sf(e):0;break;default:if(e=t.tagName,t=t.namespaceURI)t=Sf(t),e=bf(t,e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}K(Q),U(Q,e)}function re(){K(Q),K(ye),K(fe)}function se(e){e.memoizedState!==null&&U(ne,e);var t=Q.current,a=bf(t,e.type);t!==a&&(U(ye,e),U(Q,a))}function we(e){ye.current===e&&(K(Q),K(ye)),ne.current===e&&(K(ne),$r._currentValue=ee)}var Ee=Object.prototype.hasOwnProperty,xe=n.unstable_scheduleCallback,be=n.unstable_cancelCallback,rt=n.unstable_shouldYield,ve=n.unstable_requestPaint,Be=n.unstable_now,gt=n.unstable_getCurrentPriorityLevel,ft=n.unstable_ImmediatePriority,Rt=n.unstable_UserBlockingPriority,je=n.unstable_NormalPriority,lt=n.unstable_LowPriority,St=n.unstable_IdlePriority,vn=n.log,rn=n.unstable_setDisableYieldValue,ct=null,bt=null;function ln(e){if(typeof vn=="function"&&rn(e),bt&&typeof bt.setStrictMode=="function")try{bt.setStrictMode(ct,e)}catch{}}var At=Math.clz32?Math.clz32:Te,ca=Math.log,me=Math.LN2;function Te(e){return e>>>=0,e===0?32:31-(ca(e)/me|0)|0}var Me=256,We=4194304;function Xe(e){var t=e&42;if(t!==0)return t;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return e&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function vt(e,t,a){var d=e.pendingLanes;if(d===0)return 0;var y=0,g=e.suspendedLanes,b=e.pingedLanes;e=e.warmLanes;var R=d&134217727;return R!==0?(d=R&~g,d!==0?y=Xe(d):(b&=R,b!==0?y=Xe(b):a||(a=R&~e,a!==0&&(y=Xe(a))))):(R=d&~g,R!==0?y=Xe(R):b!==0?y=Xe(b):a||(a=d&~e,a!==0&&(y=Xe(a)))),y===0?0:t!==0&&t!==y&&(t&g)===0&&(g=y&-y,a=t&-t,g>=a||g===32&&(a&4194048)!==0)?t:y}function Bn(e,t){return(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&t)===0}function Dc(e,t){switch(e){case 1:case 2:case 4:case 8:case 64:return t+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function tl(){var e=Me;return Me<<=1,(Me&4194048)===0&&(Me=256),e}function nl(){var e=We;return We<<=1,(We&62914560)===0&&(We=4194304),e}function Ya(e){for(var t=[],a=0;31>a;a++)t.push(e);return t}function Io(e,t){e.pendingLanes|=t,t!==268435456&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function ol(e,t,a,d,y,g){var b=e.pendingLanes;e.pendingLanes=a,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=a,e.entangledLanes&=a,e.errorRecoveryDisabledLanes&=a,e.shellSuspendCounter=0;var R=e.entanglements,$=e.expirationTimes,J=e.hiddenUpdates;for(a=b&~a;0<a;){var de=31-At(a),pe=1<<de;R[de]=0,$[de]=-1;var oe=J[de];if(oe!==null)for(J[de]=null,de=0;de<oe.length;de++){var ae=oe[de];ae!==null&&(ae.lane&=-536870913)}a&=~pe}d!==0&&al(e,d,0),g!==0&&y===0&&e.tag!==0&&(e.suspendedLanes|=g&~(b&~t))}function al(e,t,a){e.pendingLanes|=t,e.suspendedLanes&=~t;var d=31-At(t);e.entangledLanes|=t,e.entanglements[d]=e.entanglements[d]|1073741824|a&4194090}function rl(e,t){var a=e.entangledLanes|=t;for(e=e.entanglements;a;){var d=31-At(a),y=1<<d;y&t|e[d]&t&&(e[d]|=t),a&=~y}}function Wa(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function Qa(e){return e&=-e,2<e?8<e?(e&134217727)!==0?32:268435456:8:2}function ll(){var e=W.p;return e!==0?e:(e=window.event,e===void 0?32:Vf(e.type))}function Tc(e,t){var a=W.p;try{return W.p=e,t()}finally{W.p=a}}var Tn=Math.random().toString(36).slice(2),kt="__reactFiber$"+Tn,Mt="__reactProps$"+Tn,_e="__reactContainer$"+Tn,Ce="__reactEvents$"+Tn,Fe="__reactListeners$"+Tn,dt="__reactHandles$"+Tn,qt="__reactResources$"+Tn,Qt="__reactMarker$"+Tn;function Zt(e){delete e[kt],delete e[Mt],delete e[Ce],delete e[Fe],delete e[dt]}function Kt(e){var t=e[kt];if(t)return t;for(var a=e.parentNode;a;){if(t=a[_e]||a[kt]){if(a=t.alternate,t.child!==null||a!==null&&a.child!==null)for(e=Af(e);e!==null;){if(a=e[kt])return a;e=Af(e)}return t}e=a,a=e.parentNode}return null}function Nn(e){if(e=e[kt]||e[_e]){var t=e.tag;if(t===5||t===6||t===13||t===26||t===27||t===3)return e}return null}function cn(e){var t=e.tag;if(t===5||t===26||t===27||t===6)return e.stateNode;throw Error(i(33))}function po(e){var t=e[qt];return t||(t=e[qt]={hoistableStyles:new Map,hoistableScripts:new Map}),t}function Dt(e){e[Qt]=!0}var sn=new Set,cl={};function zn(e,t){fo(e,t),fo(e+"Capture",t)}function fo(e,t){for(cl[e]=t,e=0;e<t.length;e++)sn.add(t[e])}var Nc=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),sa={},Pt={};function hd(e){return Ee.call(Pt,e)?!0:Ee.call(sa,e)?!1:Nc.test(e)?Pt[e]=!0:(sa[e]=!0,!1)}function ho(e,t,a){if(hd(t))if(a===null)e.removeAttribute(t);else{switch(typeof a){case"undefined":case"function":case"symbol":e.removeAttribute(t);return;case"boolean":var d=t.toLowerCase().slice(0,5);if(d!=="data-"&&d!=="aria-"){e.removeAttribute(t);return}}e.setAttribute(t,""+a)}}function sl(e,t,a){if(a===null)e.removeAttribute(t);else{switch(typeof a){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(t);return}e.setAttribute(t,""+a)}}function Gn(e,t,a,d){if(d===null)e.removeAttribute(a);else{switch(typeof d){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(a);return}e.setAttributeNS(t,a,""+d)}}var Fc,yd;function ia(e){if(Fc===void 0)try{throw Error()}catch(a){var t=a.stack.trim().match(/\n( *(at )?)/);Fc=t&&t[1]||"",yd=-1<a.stack.indexOf(`
    at`)?" (<anonymous>)":-1<a.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Fc+e+yd}var qc=!1;function Uc(e,t){if(!e||qc)return"";qc=!0;var a=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var d={DetermineComponentFrameRoot:function(){try{if(t){var pe=function(){throw Error()};if(Object.defineProperty(pe.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(pe,[])}catch(ae){var oe=ae}Reflect.construct(e,[],pe)}else{try{pe.call()}catch(ae){oe=ae}e.call(pe.prototype)}}else{try{throw Error()}catch(ae){oe=ae}(pe=e())&&typeof pe.catch=="function"&&pe.catch(function(){})}}catch(ae){if(ae&&oe&&typeof ae.stack=="string")return[ae.stack,oe.stack]}return[null,null]}};d.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var y=Object.getOwnPropertyDescriptor(d.DetermineComponentFrameRoot,"name");y&&y.configurable&&Object.defineProperty(d.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var g=d.DetermineComponentFrameRoot(),b=g[0],R=g[1];if(b&&R){var $=b.split(`
`),J=R.split(`
`);for(y=d=0;d<$.length&&!$[d].includes("DetermineComponentFrameRoot");)d++;for(;y<J.length&&!J[y].includes("DetermineComponentFrameRoot");)y++;if(d===$.length||y===J.length)for(d=$.length-1,y=J.length-1;1<=d&&0<=y&&$[d]!==J[y];)y--;for(;1<=d&&0<=y;d--,y--)if($[d]!==J[y]){if(d!==1||y!==1)do if(d--,y--,0>y||$[d]!==J[y]){var de=`
`+$[d].replace(" at new "," at ");return e.displayName&&de.includes("<anonymous>")&&(de=de.replace("<anonymous>",e.displayName)),de}while(1<=d&&0<=y);break}}}finally{qc=!1,Error.prepareStackTrace=a}return(a=e?e.displayName||e.name:"")?ia(a):""}function qy(e){switch(e.tag){case 26:case 27:case 5:return ia(e.type);case 16:return ia("Lazy");case 13:return ia("Suspense");case 19:return ia("SuspenseList");case 0:case 15:return Uc(e.type,!1);case 11:return Uc(e.type.render,!1);case 1:return Uc(e.type,!0);case 31:return ia("Activity");default:return""}}function _d(e){try{var t="";do t+=qy(e),e=e.return;while(e);return t}catch(a){return`
Error generating stack: `+a.message+`
`+a.stack}}function wn(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function md(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function Uy(e){var t=md(e)?"checked":"value",a=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),d=""+e[t];if(!e.hasOwnProperty(t)&&typeof a<"u"&&typeof a.get=="function"&&typeof a.set=="function"){var y=a.get,g=a.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return y.call(this)},set:function(b){d=""+b,g.call(this,b)}}),Object.defineProperty(e,t,{enumerable:a.enumerable}),{getValue:function(){return d},setValue:function(b){d=""+b},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function il(e){e._valueTracker||(e._valueTracker=Uy(e))}function gd(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var a=t.getValue(),d="";return e&&(d=md(e)?e.checked?"true":"false":e.value),e=d,e!==a?(t.setValue(e),!0):!1}function dl(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}var Oy=/[\n"\\]/g;function xn(e){return e.replace(Oy,function(t){return"\\"+t.charCodeAt(0).toString(16)+" "})}function Oc(e,t,a,d,y,g,b,R){e.name="",b!=null&&typeof b!="function"&&typeof b!="symbol"&&typeof b!="boolean"?e.type=b:e.removeAttribute("type"),t!=null?b==="number"?(t===0&&e.value===""||e.value!=t)&&(e.value=""+wn(t)):e.value!==""+wn(t)&&(e.value=""+wn(t)):b!=="submit"&&b!=="reset"||e.removeAttribute("value"),t!=null?$c(e,b,wn(t)):a!=null?$c(e,b,wn(a)):d!=null&&e.removeAttribute("value"),y==null&&g!=null&&(e.defaultChecked=!!g),y!=null&&(e.checked=y&&typeof y!="function"&&typeof y!="symbol"),R!=null&&typeof R!="function"&&typeof R!="symbol"&&typeof R!="boolean"?e.name=""+wn(R):e.removeAttribute("name")}function vd(e,t,a,d,y,g,b,R){if(g!=null&&typeof g!="function"&&typeof g!="symbol"&&typeof g!="boolean"&&(e.type=g),t!=null||a!=null){if(!(g!=="submit"&&g!=="reset"||t!=null))return;a=a!=null?""+wn(a):"",t=t!=null?""+wn(t):a,R||t===e.value||(e.value=t),e.defaultValue=t}d=d??y,d=typeof d!="function"&&typeof d!="symbol"&&!!d,e.checked=R?e.checked:!!d,e.defaultChecked=!!d,b!=null&&typeof b!="function"&&typeof b!="symbol"&&typeof b!="boolean"&&(e.name=b)}function $c(e,t,a){t==="number"&&dl(e.ownerDocument)===e||e.defaultValue===""+a||(e.defaultValue=""+a)}function da(e,t,a,d){if(e=e.options,t){t={};for(var y=0;y<a.length;y++)t["$"+a[y]]=!0;for(a=0;a<e.length;a++)y=t.hasOwnProperty("$"+e[a].value),e[a].selected!==y&&(e[a].selected=y),y&&d&&(e[a].defaultSelected=!0)}else{for(a=""+wn(a),t=null,y=0;y<e.length;y++){if(e[y].value===a){e[y].selected=!0,d&&(e[y].defaultSelected=!0);return}t!==null||e[y].disabled||(t=e[y])}t!==null&&(t.selected=!0)}}function wd(e,t,a){if(t!=null&&(t=""+wn(t),t!==e.value&&(e.value=t),a==null)){e.defaultValue!==t&&(e.defaultValue=t);return}e.defaultValue=a!=null?""+wn(a):""}function xd(e,t,a,d){if(t==null){if(d!=null){if(a!=null)throw Error(i(92));if(N(d)){if(1<d.length)throw Error(i(93));d=d[0]}a=d}a==null&&(a=""),t=a}a=wn(t),e.defaultValue=a,d=e.textContent,d===a&&d!==""&&d!==null&&(e.value=d)}function ua(e,t){if(t){var a=e.firstChild;if(a&&a===e.lastChild&&a.nodeType===3){a.nodeValue=t;return}}e.textContent=t}var $y=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Cd(e,t,a){var d=t.indexOf("--")===0;a==null||typeof a=="boolean"||a===""?d?e.setProperty(t,""):t==="float"?e.cssFloat="":e[t]="":d?e.setProperty(t,a):typeof a!="number"||a===0||$y.has(t)?t==="float"?e.cssFloat=a:e[t]=(""+a).trim():e[t]=a+"px"}function Sd(e,t,a){if(t!=null&&typeof t!="object")throw Error(i(62));if(e=e.style,a!=null){for(var d in a)!a.hasOwnProperty(d)||t!=null&&t.hasOwnProperty(d)||(d.indexOf("--")===0?e.setProperty(d,""):d==="float"?e.cssFloat="":e[d]="");for(var y in t)d=t[y],t.hasOwnProperty(y)&&a[y]!==d&&Cd(e,y,d)}else for(var g in t)t.hasOwnProperty(g)&&Cd(e,g,t[g])}function Lc(e){if(e.indexOf("-")===-1)return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ly=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),My=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function ul(e){return My.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}var Mc=null;function Pc(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var pa=null,fa=null;function bd(e){var t=Nn(e);if(t&&(e=t.stateNode)){var a=e[Mt]||null;e:switch(e=t.stateNode,t.type){case"input":if(Oc(e,a.value,a.defaultValue,a.defaultValue,a.checked,a.defaultChecked,a.type,a.name),t=a.name,a.type==="radio"&&t!=null){for(a=e;a.parentNode;)a=a.parentNode;for(a=a.querySelectorAll('input[name="'+xn(""+t)+'"][type="radio"]'),t=0;t<a.length;t++){var d=a[t];if(d!==e&&d.form===e.form){var y=d[Mt]||null;if(!y)throw Error(i(90));Oc(d,y.value,y.defaultValue,y.defaultValue,y.checked,y.defaultChecked,y.type,y.name)}}for(t=0;t<a.length;t++)d=a[t],d.form===e.form&&gd(d)}break e;case"textarea":wd(e,a.value,a.defaultValue);break e;case"select":t=a.value,t!=null&&da(e,!!a.multiple,t,!1)}}}var Ic=!1;function Ed(e,t,a){if(Ic)return e(t,a);Ic=!0;try{var d=e(t);return d}finally{if(Ic=!1,(pa!==null||fa!==null)&&(Xl(),pa&&(t=pa,e=fa,fa=pa=null,bd(t),e)))for(t=0;t<e.length;t++)bd(e[t])}}function Xa(e,t){var a=e.stateNode;if(a===null)return null;var d=a[Mt]||null;if(d===null)return null;a=d[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(d=!d.disabled)||(e=e.type,d=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!d;break e;default:e=!1}if(e)return null;if(a&&typeof a!="function")throw Error(i(231,t,typeof a));return a}var Yn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Hc=!1;if(Yn)try{var Za={};Object.defineProperty(Za,"passive",{get:function(){Hc=!0}}),window.addEventListener("test",Za,Za),window.removeEventListener("test",Za,Za)}catch{Hc=!1}var yo=null,Vc=null,pl=null;function jd(){if(pl)return pl;var e,t=Vc,a=t.length,d,y="value"in yo?yo.value:yo.textContent,g=y.length;for(e=0;e<a&&t[e]===y[e];e++);var b=a-e;for(d=1;d<=b&&t[a-d]===y[g-d];d++);return pl=y.slice(e,1<d?1-d:void 0)}function fl(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function hl(){return!0}function Rd(){return!1}function Jt(e){function t(a,d,y,g,b){this._reactName=a,this._targetInst=y,this.type=d,this.nativeEvent=g,this.target=b,this.currentTarget=null;for(var R in e)e.hasOwnProperty(R)&&(a=e[R],this[R]=a?a(g):g[R]);return this.isDefaultPrevented=(g.defaultPrevented!=null?g.defaultPrevented:g.returnValue===!1)?hl:Rd,this.isPropagationStopped=Rd,this}return _(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():typeof a.returnValue!="unknown"&&(a.returnValue=!1),this.isDefaultPrevented=hl)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():typeof a.cancelBubble!="unknown"&&(a.cancelBubble=!0),this.isPropagationStopped=hl)},persist:function(){},isPersistent:hl}),t}var Ho={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},yl=Jt(Ho),Ka=_({},Ho,{view:0,detail:0}),Py=Jt(Ka),Bc,zc,Ja,_l=_({},Ka,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Yc,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Ja&&(Ja&&e.type==="mousemove"?(Bc=e.screenX-Ja.screenX,zc=e.screenY-Ja.screenY):zc=Bc=0,Ja=e),Bc)},movementY:function(e){return"movementY"in e?e.movementY:zc}}),Ad=Jt(_l),Iy=_({},_l,{dataTransfer:0}),Hy=Jt(Iy),Vy=_({},Ka,{relatedTarget:0}),Gc=Jt(Vy),By=_({},Ho,{animationName:0,elapsedTime:0,pseudoElement:0}),zy=Jt(By),Gy=_({},Ho,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Yy=Jt(Gy),Wy=_({},Ho,{data:0}),kd=Jt(Wy),Qy={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Xy={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Zy={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Ky(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=Zy[e])?!!t[e]:!1}function Yc(){return Ky}var Jy=_({},Ka,{key:function(e){if(e.key){var t=Qy[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=fl(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?Xy[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Yc,charCode:function(e){return e.type==="keypress"?fl(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?fl(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),e_=Jt(Jy),t_=_({},_l,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Dd=Jt(t_),n_=_({},Ka,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Yc}),o_=Jt(n_),a_=_({},Ho,{propertyName:0,elapsedTime:0,pseudoElement:0}),r_=Jt(a_),l_=_({},_l,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),c_=Jt(l_),s_=_({},Ho,{newState:0,oldState:0}),i_=Jt(s_),d_=[9,13,27,32],Wc=Yn&&"CompositionEvent"in window,er=null;Yn&&"documentMode"in document&&(er=document.documentMode);var u_=Yn&&"TextEvent"in window&&!er,Td=Yn&&(!Wc||er&&8<er&&11>=er),Nd=" ",Fd=!1;function qd(e,t){switch(e){case"keyup":return d_.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Ud(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var ha=!1;function p_(e,t){switch(e){case"compositionend":return Ud(t);case"keypress":return t.which!==32?null:(Fd=!0,Nd);case"textInput":return e=t.data,e===Nd&&Fd?null:e;default:return null}}function f_(e,t){if(ha)return e==="compositionend"||!Wc&&qd(e,t)?(e=jd(),pl=Vc=yo=null,ha=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Td&&t.locale!=="ko"?null:t.data;default:return null}}var h_={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Od(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!h_[e.type]:t==="textarea"}function $d(e,t,a,d){pa?fa?fa.push(d):fa=[d]:pa=d,t=nc(t,"onChange"),0<t.length&&(a=new yl("onChange","change",null,a,d),e.push({event:a,listeners:t}))}var tr=null,nr=null;function y_(e){gf(e,0)}function ml(e){var t=cn(e);if(gd(t))return e}function Ld(e,t){if(e==="change")return t}var Md=!1;if(Yn){var Qc;if(Yn){var Xc="oninput"in document;if(!Xc){var Pd=document.createElement("div");Pd.setAttribute("oninput","return;"),Xc=typeof Pd.oninput=="function"}Qc=Xc}else Qc=!1;Md=Qc&&(!document.documentMode||9<document.documentMode)}function Id(){tr&&(tr.detachEvent("onpropertychange",Hd),nr=tr=null)}function Hd(e){if(e.propertyName==="value"&&ml(nr)){var t=[];$d(t,nr,e,Pc(e)),Ed(y_,t)}}function __(e,t,a){e==="focusin"?(Id(),tr=t,nr=a,tr.attachEvent("onpropertychange",Hd)):e==="focusout"&&Id()}function m_(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return ml(nr)}function g_(e,t){if(e==="click")return ml(t)}function v_(e,t){if(e==="input"||e==="change")return ml(t)}function w_(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var dn=typeof Object.is=="function"?Object.is:w_;function or(e,t){if(dn(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var a=Object.keys(e),d=Object.keys(t);if(a.length!==d.length)return!1;for(d=0;d<a.length;d++){var y=a[d];if(!Ee.call(t,y)||!dn(e[y],t[y]))return!1}return!0}function Vd(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Bd(e,t){var a=Vd(e);e=0;for(var d;a;){if(a.nodeType===3){if(d=e+a.textContent.length,e<=t&&d>=t)return{node:a,offset:t-e};e=d}e:{for(;a;){if(a.nextSibling){a=a.nextSibling;break e}a=a.parentNode}a=void 0}a=Vd(a)}}function zd(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?zd(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function Gd(e){e=e!=null&&e.ownerDocument!=null&&e.ownerDocument.defaultView!=null?e.ownerDocument.defaultView:window;for(var t=dl(e.document);t instanceof e.HTMLIFrameElement;){try{var a=typeof t.contentWindow.location.href=="string"}catch{a=!1}if(a)e=t.contentWindow;else break;t=dl(e.document)}return t}function Zc(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}var x_=Yn&&"documentMode"in document&&11>=document.documentMode,ya=null,Kc=null,ar=null,Jc=!1;function Yd(e,t,a){var d=a.window===a?a.document:a.nodeType===9?a:a.ownerDocument;Jc||ya==null||ya!==dl(d)||(d=ya,"selectionStart"in d&&Zc(d)?d={start:d.selectionStart,end:d.selectionEnd}:(d=(d.ownerDocument&&d.ownerDocument.defaultView||window).getSelection(),d={anchorNode:d.anchorNode,anchorOffset:d.anchorOffset,focusNode:d.focusNode,focusOffset:d.focusOffset}),ar&&or(ar,d)||(ar=d,d=nc(Kc,"onSelect"),0<d.length&&(t=new yl("onSelect","select",null,t,a),e.push({event:t,listeners:d}),t.target=ya)))}function Vo(e,t){var a={};return a[e.toLowerCase()]=t.toLowerCase(),a["Webkit"+e]="webkit"+t,a["Moz"+e]="moz"+t,a}var _a={animationend:Vo("Animation","AnimationEnd"),animationiteration:Vo("Animation","AnimationIteration"),animationstart:Vo("Animation","AnimationStart"),transitionrun:Vo("Transition","TransitionRun"),transitionstart:Vo("Transition","TransitionStart"),transitioncancel:Vo("Transition","TransitionCancel"),transitionend:Vo("Transition","TransitionEnd")},es={},Wd={};Yn&&(Wd=document.createElement("div").style,"AnimationEvent"in window||(delete _a.animationend.animation,delete _a.animationiteration.animation,delete _a.animationstart.animation),"TransitionEvent"in window||delete _a.transitionend.transition);function Bo(e){if(es[e])return es[e];if(!_a[e])return e;var t=_a[e],a;for(a in t)if(t.hasOwnProperty(a)&&a in Wd)return es[e]=t[a];return e}var Qd=Bo("animationend"),Xd=Bo("animationiteration"),Zd=Bo("animationstart"),C_=Bo("transitionrun"),S_=Bo("transitionstart"),b_=Bo("transitioncancel"),Kd=Bo("transitionend"),Jd=new Map,ts="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");ts.push("scrollEnd");function Fn(e,t){Jd.set(e,t),zn(t,[e])}var eu=new WeakMap;function Cn(e,t){if(typeof e=="object"&&e!==null){var a=eu.get(e);return a!==void 0?a:(t={value:e,source:t,stack:_d(t)},eu.set(e,t),t)}return{value:e,source:t,stack:_d(t)}}var Sn=[],ma=0,ns=0;function gl(){for(var e=ma,t=ns=ma=0;t<e;){var a=Sn[t];Sn[t++]=null;var d=Sn[t];Sn[t++]=null;var y=Sn[t];Sn[t++]=null;var g=Sn[t];if(Sn[t++]=null,d!==null&&y!==null){var b=d.pending;b===null?y.next=y:(y.next=b.next,b.next=y),d.pending=y}g!==0&&tu(a,y,g)}}function vl(e,t,a,d){Sn[ma++]=e,Sn[ma++]=t,Sn[ma++]=a,Sn[ma++]=d,ns|=d,e.lanes|=d,e=e.alternate,e!==null&&(e.lanes|=d)}function os(e,t,a,d){return vl(e,t,a,d),wl(e)}function ga(e,t){return vl(e,null,null,t),wl(e)}function tu(e,t,a){e.lanes|=a;var d=e.alternate;d!==null&&(d.lanes|=a);for(var y=!1,g=e.return;g!==null;)g.childLanes|=a,d=g.alternate,d!==null&&(d.childLanes|=a),g.tag===22&&(e=g.stateNode,e===null||e._visibility&1||(y=!0)),e=g,g=g.return;return e.tag===3?(g=e.stateNode,y&&t!==null&&(y=31-At(a),e=g.hiddenUpdates,d=e[y],d===null?e[y]=[t]:d.push(t),t.lane=a|536870912),g):null}function wl(e){if(50<kr)throw kr=0,ii=null,Error(i(185));for(var t=e.return;t!==null;)e=t,t=e.return;return e.tag===3?e.stateNode:null}var va={};function E_(e,t,a,d){this.tag=e,this.key=a,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=d,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function un(e,t,a,d){return new E_(e,t,a,d)}function as(e){return e=e.prototype,!(!e||!e.isReactComponent)}function Wn(e,t){var a=e.alternate;return a===null?(a=un(e.tag,t,e.key,e.mode),a.elementType=e.elementType,a.type=e.type,a.stateNode=e.stateNode,a.alternate=e,e.alternate=a):(a.pendingProps=t,a.type=e.type,a.flags=0,a.subtreeFlags=0,a.deletions=null),a.flags=e.flags&65011712,a.childLanes=e.childLanes,a.lanes=e.lanes,a.child=e.child,a.memoizedProps=e.memoizedProps,a.memoizedState=e.memoizedState,a.updateQueue=e.updateQueue,t=e.dependencies,a.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},a.sibling=e.sibling,a.index=e.index,a.ref=e.ref,a.refCleanup=e.refCleanup,a}function nu(e,t){e.flags&=65011714;var a=e.alternate;return a===null?(e.childLanes=0,e.lanes=t,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=a.childLanes,e.lanes=a.lanes,e.child=a.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=a.memoizedProps,e.memoizedState=a.memoizedState,e.updateQueue=a.updateQueue,e.type=a.type,t=a.dependencies,e.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),e}function xl(e,t,a,d,y,g){var b=0;if(d=e,typeof e=="function")as(e)&&(b=1);else if(typeof e=="string")b=Rm(e,a,Q.current)?26:e==="html"||e==="head"||e==="body"?27:5;else e:switch(e){case z:return e=un(31,a,t,y),e.elementType=z,e.lanes=g,e;case x:return zo(a.children,y,g,t);case C:b=8,y|=24;break;case S:return e=un(12,a,t,y|2),e.elementType=S,e.lanes=g,e;case L:return e=un(13,a,t,y),e.elementType=L,e.lanes=g,e;case H:return e=un(19,a,t,y),e.elementType=H,e.lanes=g,e;default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case E:case D:b=10;break e;case j:b=9;break e;case A:b=11;break e;case ce:b=14;break e;case B:b=16,d=null;break e}b=29,a=Error(i(130,e===null?"null":typeof e,"")),d=null}return t=un(b,a,t,y),t.elementType=e,t.type=d,t.lanes=g,t}function zo(e,t,a,d){return e=un(7,e,d,t),e.lanes=a,e}function rs(e,t,a){return e=un(6,e,null,t),e.lanes=a,e}function ls(e,t,a){return t=un(4,e.children!==null?e.children:[],e.key,t),t.lanes=a,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}var wa=[],xa=0,Cl=null,Sl=0,bn=[],En=0,Go=null,Qn=1,Xn="";function Yo(e,t){wa[xa++]=Sl,wa[xa++]=Cl,Cl=e,Sl=t}function ou(e,t,a){bn[En++]=Qn,bn[En++]=Xn,bn[En++]=Go,Go=e;var d=Qn;e=Xn;var y=32-At(d)-1;d&=~(1<<y),a+=1;var g=32-At(t)+y;if(30<g){var b=y-y%5;g=(d&(1<<b)-1).toString(32),d>>=b,y-=b,Qn=1<<32-At(t)+y|a<<y|d,Xn=g+e}else Qn=1<<g|a<<y|d,Xn=e}function cs(e){e.return!==null&&(Yo(e,1),ou(e,1,0))}function ss(e){for(;e===Cl;)Cl=wa[--xa],wa[xa]=null,Sl=wa[--xa],wa[xa]=null;for(;e===Go;)Go=bn[--En],bn[En]=null,Xn=bn[--En],bn[En]=null,Qn=bn[--En],bn[En]=null}var Xt=null,ht=null,Qe=!1,Wo=null,Ln=!1,is=Error(i(519));function Qo(e){var t=Error(i(418,""));throw cr(Cn(t,e)),is}function au(e){var t=e.stateNode,a=e.type,d=e.memoizedProps;switch(t[kt]=e,t[Mt]=d,a){case"dialog":Ie("cancel",t),Ie("close",t);break;case"iframe":case"object":case"embed":Ie("load",t);break;case"video":case"audio":for(a=0;a<Tr.length;a++)Ie(Tr[a],t);break;case"source":Ie("error",t);break;case"img":case"image":case"link":Ie("error",t),Ie("load",t);break;case"details":Ie("toggle",t);break;case"input":Ie("invalid",t),vd(t,d.value,d.defaultValue,d.checked,d.defaultChecked,d.type,d.name,!0),il(t);break;case"select":Ie("invalid",t);break;case"textarea":Ie("invalid",t),xd(t,d.value,d.defaultValue,d.children),il(t)}a=d.children,typeof a!="string"&&typeof a!="number"&&typeof a!="bigint"||t.textContent===""+a||d.suppressHydrationWarning===!0||Cf(t.textContent,a)?(d.popover!=null&&(Ie("beforetoggle",t),Ie("toggle",t)),d.onScroll!=null&&Ie("scroll",t),d.onScrollEnd!=null&&Ie("scrollend",t),d.onClick!=null&&(t.onclick=oc),t=!0):t=!1,t||Qo(e)}function ru(e){for(Xt=e.return;Xt;)switch(Xt.tag){case 5:case 13:Ln=!1;return;case 27:case 3:Ln=!0;return;default:Xt=Xt.return}}function rr(e){if(e!==Xt)return!1;if(!Qe)return ru(e),Qe=!0,!1;var t=e.tag,a;if((a=t!==3&&t!==27)&&((a=t===5)&&(a=e.type,a=!(a!=="form"&&a!=="button")||Ei(e.type,e.memoizedProps)),a=!a),a&&ht&&Qo(e),ru(e),t===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(i(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8)if(a=e.data,a==="/$"){if(t===0){ht=Un(e.nextSibling);break e}t--}else a!=="$"&&a!=="$!"&&a!=="$?"||t++;e=e.nextSibling}ht=null}}else t===27?(t=ht,To(e.type)?(e=ki,ki=null,ht=e):ht=t):ht=Xt?Un(e.stateNode.nextSibling):null;return!0}function lr(){ht=Xt=null,Qe=!1}function lu(){var e=Wo;return e!==null&&(nn===null?nn=e:nn.push.apply(nn,e),Wo=null),e}function cr(e){Wo===null?Wo=[e]:Wo.push(e)}var ds=O(null),Xo=null,Zn=null;function _o(e,t,a){U(ds,t._currentValue),t._currentValue=a}function Kn(e){e._currentValue=ds.current,K(ds)}function us(e,t,a){for(;e!==null;){var d=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,d!==null&&(d.childLanes|=t)):d!==null&&(d.childLanes&t)!==t&&(d.childLanes|=t),e===a)break;e=e.return}}function ps(e,t,a,d){var y=e.child;for(y!==null&&(y.return=e);y!==null;){var g=y.dependencies;if(g!==null){var b=y.child;g=g.firstContext;e:for(;g!==null;){var R=g;g=y;for(var $=0;$<t.length;$++)if(R.context===t[$]){g.lanes|=a,R=g.alternate,R!==null&&(R.lanes|=a),us(g.return,a,e),d||(b=null);break e}g=R.next}}else if(y.tag===18){if(b=y.return,b===null)throw Error(i(341));b.lanes|=a,g=b.alternate,g!==null&&(g.lanes|=a),us(b,a,e),b=null}else b=y.child;if(b!==null)b.return=y;else for(b=y;b!==null;){if(b===e){b=null;break}if(y=b.sibling,y!==null){y.return=b.return,b=y;break}b=b.return}y=b}}function sr(e,t,a,d){e=null;for(var y=t,g=!1;y!==null;){if(!g){if((y.flags&524288)!==0)g=!0;else if((y.flags&262144)!==0)break}if(y.tag===10){var b=y.alternate;if(b===null)throw Error(i(387));if(b=b.memoizedProps,b!==null){var R=y.type;dn(y.pendingProps.value,b.value)||(e!==null?e.push(R):e=[R])}}else if(y===ne.current){if(b=y.alternate,b===null)throw Error(i(387));b.memoizedState.memoizedState!==y.memoizedState.memoizedState&&(e!==null?e.push($r):e=[$r])}y=y.return}e!==null&&ps(t,e,a,d),t.flags|=262144}function bl(e){for(e=e.firstContext;e!==null;){if(!dn(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function Zo(e){Xo=e,Zn=null,e=e.dependencies,e!==null&&(e.firstContext=null)}function Gt(e){return cu(Xo,e)}function El(e,t){return Xo===null&&Zo(e),cu(e,t)}function cu(e,t){var a=t._currentValue;if(t={context:t,memoizedValue:a,next:null},Zn===null){if(e===null)throw Error(i(308));Zn=t,e.dependencies={lanes:0,firstContext:t},e.flags|=524288}else Zn=Zn.next=t;return a}var j_=typeof AbortController<"u"?AbortController:function(){var e=[],t=this.signal={aborted:!1,addEventListener:function(a,d){e.push(d)}};this.abort=function(){t.aborted=!0,e.forEach(function(a){return a()})}},R_=n.unstable_scheduleCallback,A_=n.unstable_NormalPriority,Tt={$$typeof:D,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function fs(){return{controller:new j_,data:new Map,refCount:0}}function ir(e){e.refCount--,e.refCount===0&&R_(A_,function(){e.controller.abort()})}var dr=null,hs=0,Ca=0,Sa=null;function k_(e,t){if(dr===null){var a=dr=[];hs=0,Ca=_i(),Sa={status:"pending",value:void 0,then:function(d){a.push(d)}}}return hs++,t.then(su,su),t}function su(){if(--hs===0&&dr!==null){Sa!==null&&(Sa.status="fulfilled");var e=dr;dr=null,Ca=0,Sa=null;for(var t=0;t<e.length;t++)(0,e[t])()}}function D_(e,t){var a=[],d={status:"pending",value:null,reason:null,then:function(y){a.push(y)}};return e.then(function(){d.status="fulfilled",d.value=t;for(var y=0;y<a.length;y++)(0,a[y])(t)},function(y){for(d.status="rejected",d.reason=y,y=0;y<a.length;y++)(0,a[y])(void 0)}),d}var iu=k.S;k.S=function(e,t){typeof t=="object"&&t!==null&&typeof t.then=="function"&&k_(e,t),iu!==null&&iu(e,t)};var Ko=O(null);function ys(){var e=Ko.current;return e!==null?e:ot.pooledCache}function jl(e,t){t===null?U(Ko,Ko.current):U(Ko,t.pool)}function du(){var e=ys();return e===null?null:{parent:Tt._currentValue,pool:e}}var ur=Error(i(460)),uu=Error(i(474)),Rl=Error(i(542)),_s={then:function(){}};function pu(e){return e=e.status,e==="fulfilled"||e==="rejected"}function Al(){}function fu(e,t,a){switch(a=e[a],a===void 0?e.push(t):a!==t&&(t.then(Al,Al),t=a),t.status){case"fulfilled":return t.value;case"rejected":throw e=t.reason,yu(e),e;default:if(typeof t.status=="string")t.then(Al,Al);else{if(e=ot,e!==null&&100<e.shellSuspendCounter)throw Error(i(482));e=t,e.status="pending",e.then(function(d){if(t.status==="pending"){var y=t;y.status="fulfilled",y.value=d}},function(d){if(t.status==="pending"){var y=t;y.status="rejected",y.reason=d}})}switch(t.status){case"fulfilled":return t.value;case"rejected":throw e=t.reason,yu(e),e}throw pr=t,ur}}var pr=null;function hu(){if(pr===null)throw Error(i(459));var e=pr;return pr=null,e}function yu(e){if(e===ur||e===Rl)throw Error(i(483))}var mo=!1;function ms(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function gs(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function go(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function vo(e,t,a){var d=e.updateQueue;if(d===null)return null;if(d=d.shared,(Ze&2)!==0){var y=d.pending;return y===null?t.next=t:(t.next=y.next,y.next=t),d.pending=t,t=wl(e),tu(e,null,a),t}return vl(e,d,t,a),wl(e)}function fr(e,t,a){if(t=t.updateQueue,t!==null&&(t=t.shared,(a&4194048)!==0)){var d=t.lanes;d&=e.pendingLanes,a|=d,t.lanes=a,rl(e,a)}}function vs(e,t){var a=e.updateQueue,d=e.alternate;if(d!==null&&(d=d.updateQueue,a===d)){var y=null,g=null;if(a=a.firstBaseUpdate,a!==null){do{var b={lane:a.lane,tag:a.tag,payload:a.payload,callback:null,next:null};g===null?y=g=b:g=g.next=b,a=a.next}while(a!==null);g===null?y=g=t:g=g.next=t}else y=g=t;a={baseState:d.baseState,firstBaseUpdate:y,lastBaseUpdate:g,shared:d.shared,callbacks:d.callbacks},e.updateQueue=a;return}e=a.lastBaseUpdate,e===null?a.firstBaseUpdate=t:e.next=t,a.lastBaseUpdate=t}var ws=!1;function hr(){if(ws){var e=Sa;if(e!==null)throw e}}function yr(e,t,a,d){ws=!1;var y=e.updateQueue;mo=!1;var g=y.firstBaseUpdate,b=y.lastBaseUpdate,R=y.shared.pending;if(R!==null){y.shared.pending=null;var $=R,J=$.next;$.next=null,b===null?g=J:b.next=J,b=$;var de=e.alternate;de!==null&&(de=de.updateQueue,R=de.lastBaseUpdate,R!==b&&(R===null?de.firstBaseUpdate=J:R.next=J,de.lastBaseUpdate=$))}if(g!==null){var pe=y.baseState;b=0,de=J=$=null,R=g;do{var oe=R.lane&-536870913,ae=oe!==R.lane;if(ae?(Ve&oe)===oe:(d&oe)===oe){oe!==0&&oe===Ca&&(ws=!0),de!==null&&(de=de.next={lane:0,tag:R.tag,payload:R.payload,callback:null,next:null});e:{var Ne=e,ke=R;oe=t;var tt=a;switch(ke.tag){case 1:if(Ne=ke.payload,typeof Ne=="function"){pe=Ne.call(tt,pe,oe);break e}pe=Ne;break e;case 3:Ne.flags=Ne.flags&-65537|128;case 0:if(Ne=ke.payload,oe=typeof Ne=="function"?Ne.call(tt,pe,oe):Ne,oe==null)break e;pe=_({},pe,oe);break e;case 2:mo=!0}}oe=R.callback,oe!==null&&(e.flags|=64,ae&&(e.flags|=8192),ae=y.callbacks,ae===null?y.callbacks=[oe]:ae.push(oe))}else ae={lane:oe,tag:R.tag,payload:R.payload,callback:R.callback,next:null},de===null?(J=de=ae,$=pe):de=de.next=ae,b|=oe;if(R=R.next,R===null){if(R=y.shared.pending,R===null)break;ae=R,R=ae.next,ae.next=null,y.lastBaseUpdate=ae,y.shared.pending=null}}while(!0);de===null&&($=pe),y.baseState=$,y.firstBaseUpdate=J,y.lastBaseUpdate=de,g===null&&(y.shared.lanes=0),Ro|=b,e.lanes=b,e.memoizedState=pe}}function _u(e,t){if(typeof e!="function")throw Error(i(191,e));e.call(t)}function mu(e,t){var a=e.callbacks;if(a!==null)for(e.callbacks=null,e=0;e<a.length;e++)_u(a[e],t)}var ba=O(null),kl=O(0);function gu(e,t){e=ro,U(kl,e),U(ba,t),ro=e|t.baseLanes}function xs(){U(kl,ro),U(ba,ba.current)}function Cs(){ro=kl.current,K(ba),K(kl)}var wo=0,Oe=null,Je=null,Et=null,Dl=!1,Ea=!1,Jo=!1,Tl=0,_r=0,ja=null,T_=0;function wt(){throw Error(i(321))}function Ss(e,t){if(t===null)return!1;for(var a=0;a<t.length&&a<e.length;a++)if(!dn(e[a],t[a]))return!1;return!0}function bs(e,t,a,d,y,g){return wo=g,Oe=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,k.H=e===null||e.memoizedState===null?tp:np,Jo=!1,g=a(d,y),Jo=!1,Ea&&(g=wu(t,a,d,y)),vu(e),g}function vu(e){k.H=$l;var t=Je!==null&&Je.next!==null;if(wo=0,Et=Je=Oe=null,Dl=!1,_r=0,ja=null,t)throw Error(i(300));e===null||Ut||(e=e.dependencies,e!==null&&bl(e)&&(Ut=!0))}function wu(e,t,a,d){Oe=e;var y=0;do{if(Ea&&(ja=null),_r=0,Ea=!1,25<=y)throw Error(i(301));if(y+=1,Et=Je=null,e.updateQueue!=null){var g=e.updateQueue;g.lastEffect=null,g.events=null,g.stores=null,g.memoCache!=null&&(g.memoCache.index=0)}k.H=L_,g=t(a,d)}while(Ea);return g}function N_(){var e=k.H,t=e.useState()[0];return t=typeof t.then=="function"?mr(t):t,e=e.useState()[0],(Je!==null?Je.memoizedState:null)!==e&&(Oe.flags|=1024),t}function Es(){var e=Tl!==0;return Tl=0,e}function js(e,t,a){t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a}function Rs(e){if(Dl){for(e=e.memoizedState;e!==null;){var t=e.queue;t!==null&&(t.pending=null),e=e.next}Dl=!1}wo=0,Et=Je=Oe=null,Ea=!1,_r=Tl=0,ja=null}function en(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Et===null?Oe.memoizedState=Et=e:Et=Et.next=e,Et}function jt(){if(Je===null){var e=Oe.alternate;e=e!==null?e.memoizedState:null}else e=Je.next;var t=Et===null?Oe.memoizedState:Et.next;if(t!==null)Et=t,Je=e;else{if(e===null)throw Oe.alternate===null?Error(i(467)):Error(i(310));Je=e,e={memoizedState:Je.memoizedState,baseState:Je.baseState,baseQueue:Je.baseQueue,queue:Je.queue,next:null},Et===null?Oe.memoizedState=Et=e:Et=Et.next=e}return Et}function As(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function mr(e){var t=_r;return _r+=1,ja===null&&(ja=[]),e=fu(ja,e,t),t=Oe,(Et===null?t.memoizedState:Et.next)===null&&(t=t.alternate,k.H=t===null||t.memoizedState===null?tp:np),e}function Nl(e){if(e!==null&&typeof e=="object"){if(typeof e.then=="function")return mr(e);if(e.$$typeof===D)return Gt(e)}throw Error(i(438,String(e)))}function ks(e){var t=null,a=Oe.updateQueue;if(a!==null&&(t=a.memoCache),t==null){var d=Oe.alternate;d!==null&&(d=d.updateQueue,d!==null&&(d=d.memoCache,d!=null&&(t={data:d.data.map(function(y){return y.slice()}),index:0})))}if(t==null&&(t={data:[],index:0}),a===null&&(a=As(),Oe.updateQueue=a),a.memoCache=t,a=t.data[t.index],a===void 0)for(a=t.data[t.index]=Array(e),d=0;d<e;d++)a[d]=V;return t.index++,a}function Jn(e,t){return typeof t=="function"?t(e):t}function Fl(e){var t=jt();return Ds(t,Je,e)}function Ds(e,t,a){var d=e.queue;if(d===null)throw Error(i(311));d.lastRenderedReducer=a;var y=e.baseQueue,g=d.pending;if(g!==null){if(y!==null){var b=y.next;y.next=g.next,g.next=b}t.baseQueue=y=g,d.pending=null}if(g=e.baseState,y===null)e.memoizedState=g;else{t=y.next;var R=b=null,$=null,J=t,de=!1;do{var pe=J.lane&-536870913;if(pe!==J.lane?(Ve&pe)===pe:(wo&pe)===pe){var oe=J.revertLane;if(oe===0)$!==null&&($=$.next={lane:0,revertLane:0,action:J.action,hasEagerState:J.hasEagerState,eagerState:J.eagerState,next:null}),pe===Ca&&(de=!0);else if((wo&oe)===oe){J=J.next,oe===Ca&&(de=!0);continue}else pe={lane:0,revertLane:J.revertLane,action:J.action,hasEagerState:J.hasEagerState,eagerState:J.eagerState,next:null},$===null?(R=$=pe,b=g):$=$.next=pe,Oe.lanes|=oe,Ro|=oe;pe=J.action,Jo&&a(g,pe),g=J.hasEagerState?J.eagerState:a(g,pe)}else oe={lane:pe,revertLane:J.revertLane,action:J.action,hasEagerState:J.hasEagerState,eagerState:J.eagerState,next:null},$===null?(R=$=oe,b=g):$=$.next=oe,Oe.lanes|=pe,Ro|=pe;J=J.next}while(J!==null&&J!==t);if($===null?b=g:$.next=R,!dn(g,e.memoizedState)&&(Ut=!0,de&&(a=Sa,a!==null)))throw a;e.memoizedState=g,e.baseState=b,e.baseQueue=$,d.lastRenderedState=g}return y===null&&(d.lanes=0),[e.memoizedState,d.dispatch]}function Ts(e){var t=jt(),a=t.queue;if(a===null)throw Error(i(311));a.lastRenderedReducer=e;var d=a.dispatch,y=a.pending,g=t.memoizedState;if(y!==null){a.pending=null;var b=y=y.next;do g=e(g,b.action),b=b.next;while(b!==y);dn(g,t.memoizedState)||(Ut=!0),t.memoizedState=g,t.baseQueue===null&&(t.baseState=g),a.lastRenderedState=g}return[g,d]}function xu(e,t,a){var d=Oe,y=jt(),g=Qe;if(g){if(a===void 0)throw Error(i(407));a=a()}else a=t();var b=!dn((Je||y).memoizedState,a);b&&(y.memoizedState=a,Ut=!0),y=y.queue;var R=bu.bind(null,d,y,e);if(gr(2048,8,R,[e]),y.getSnapshot!==t||b||Et!==null&&Et.memoizedState.tag&1){if(d.flags|=2048,Ra(9,ql(),Su.bind(null,d,y,a,t),null),ot===null)throw Error(i(349));g||(wo&124)!==0||Cu(d,t,a)}return a}function Cu(e,t,a){e.flags|=16384,e={getSnapshot:t,value:a},t=Oe.updateQueue,t===null?(t=As(),Oe.updateQueue=t,t.stores=[e]):(a=t.stores,a===null?t.stores=[e]:a.push(e))}function Su(e,t,a,d){t.value=a,t.getSnapshot=d,Eu(t)&&ju(e)}function bu(e,t,a){return a(function(){Eu(t)&&ju(e)})}function Eu(e){var t=e.getSnapshot;e=e.value;try{var a=t();return!dn(e,a)}catch{return!0}}function ju(e){var t=ga(e,2);t!==null&&_n(t,e,2)}function Ns(e){var t=en();if(typeof e=="function"){var a=e;if(e=a(),Jo){ln(!0);try{a()}finally{ln(!1)}}}return t.memoizedState=t.baseState=e,t.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Jn,lastRenderedState:e},t}function Ru(e,t,a,d){return e.baseState=a,Ds(e,Je,typeof d=="function"?d:Jn)}function F_(e,t,a,d,y){if(Ol(e))throw Error(i(485));if(e=t.action,e!==null){var g={payload:y,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(b){g.listeners.push(b)}};k.T!==null?a(!0):g.isTransition=!1,d(g),a=t.pending,a===null?(g.next=t.pending=g,Au(t,g)):(g.next=a.next,t.pending=a.next=g)}}function Au(e,t){var a=t.action,d=t.payload,y=e.state;if(t.isTransition){var g=k.T,b={};k.T=b;try{var R=a(y,d),$=k.S;$!==null&&$(b,R),ku(e,t,R)}catch(J){Fs(e,t,J)}finally{k.T=g}}else try{g=a(y,d),ku(e,t,g)}catch(J){Fs(e,t,J)}}function ku(e,t,a){a!==null&&typeof a=="object"&&typeof a.then=="function"?a.then(function(d){Du(e,t,d)},function(d){return Fs(e,t,d)}):Du(e,t,a)}function Du(e,t,a){t.status="fulfilled",t.value=a,Tu(t),e.state=a,t=e.pending,t!==null&&(a=t.next,a===t?e.pending=null:(a=a.next,t.next=a,Au(e,a)))}function Fs(e,t,a){var d=e.pending;if(e.pending=null,d!==null){d=d.next;do t.status="rejected",t.reason=a,Tu(t),t=t.next;while(t!==d)}e.action=null}function Tu(e){e=e.listeners;for(var t=0;t<e.length;t++)(0,e[t])()}function Nu(e,t){return t}function Fu(e,t){if(Qe){var a=ot.formState;if(a!==null){e:{var d=Oe;if(Qe){if(ht){t:{for(var y=ht,g=Ln;y.nodeType!==8;){if(!g){y=null;break t}if(y=Un(y.nextSibling),y===null){y=null;break t}}g=y.data,y=g==="F!"||g==="F"?y:null}if(y){ht=Un(y.nextSibling),d=y.data==="F!";break e}}Qo(d)}d=!1}d&&(t=a[0])}}return a=en(),a.memoizedState=a.baseState=t,d={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Nu,lastRenderedState:t},a.queue=d,a=Ku.bind(null,Oe,d),d.dispatch=a,d=Ns(!1),g=Ls.bind(null,Oe,!1,d.queue),d=en(),y={state:t,dispatch:null,action:e,pending:null},d.queue=y,a=F_.bind(null,Oe,y,g,a),y.dispatch=a,d.memoizedState=e,[t,a,!1]}function qu(e){var t=jt();return Uu(t,Je,e)}function Uu(e,t,a){if(t=Ds(e,t,Nu)[0],e=Fl(Jn)[0],typeof t=="object"&&t!==null&&typeof t.then=="function")try{var d=mr(t)}catch(b){throw b===ur?Rl:b}else d=t;t=jt();var y=t.queue,g=y.dispatch;return a!==t.memoizedState&&(Oe.flags|=2048,Ra(9,ql(),q_.bind(null,y,a),null)),[d,g,e]}function q_(e,t){e.action=t}function Ou(e){var t=jt(),a=Je;if(a!==null)return Uu(t,a,e);jt(),t=t.memoizedState,a=jt();var d=a.queue.dispatch;return a.memoizedState=e,[t,d,!1]}function Ra(e,t,a,d){return e={tag:e,create:a,deps:d,inst:t,next:null},t=Oe.updateQueue,t===null&&(t=As(),Oe.updateQueue=t),a=t.lastEffect,a===null?t.lastEffect=e.next=e:(d=a.next,a.next=e,e.next=d,t.lastEffect=e),e}function ql(){return{destroy:void 0,resource:void 0}}function $u(){return jt().memoizedState}function Ul(e,t,a,d){var y=en();d=d===void 0?null:d,Oe.flags|=e,y.memoizedState=Ra(1|t,ql(),a,d)}function gr(e,t,a,d){var y=jt();d=d===void 0?null:d;var g=y.memoizedState.inst;Je!==null&&d!==null&&Ss(d,Je.memoizedState.deps)?y.memoizedState=Ra(t,g,a,d):(Oe.flags|=e,y.memoizedState=Ra(1|t,g,a,d))}function Lu(e,t){Ul(8390656,8,e,t)}function Mu(e,t){gr(2048,8,e,t)}function Pu(e,t){return gr(4,2,e,t)}function Iu(e,t){return gr(4,4,e,t)}function Hu(e,t){if(typeof t=="function"){e=e();var a=t(e);return function(){typeof a=="function"?a():t(null)}}if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function Vu(e,t,a){a=a!=null?a.concat([e]):null,gr(4,4,Hu.bind(null,t,e),a)}function qs(){}function Bu(e,t){var a=jt();t=t===void 0?null:t;var d=a.memoizedState;return t!==null&&Ss(t,d[1])?d[0]:(a.memoizedState=[e,t],e)}function zu(e,t){var a=jt();t=t===void 0?null:t;var d=a.memoizedState;if(t!==null&&Ss(t,d[1]))return d[0];if(d=e(),Jo){ln(!0);try{e()}finally{ln(!1)}}return a.memoizedState=[d,t],d}function Us(e,t,a){return a===void 0||(wo&1073741824)!==0?e.memoizedState=t:(e.memoizedState=a,e=Wp(),Oe.lanes|=e,Ro|=e,a)}function Gu(e,t,a,d){return dn(a,t)?a:ba.current!==null?(e=Us(e,a,d),dn(e,t)||(Ut=!0),e):(wo&42)===0?(Ut=!0,e.memoizedState=a):(e=Wp(),Oe.lanes|=e,Ro|=e,t)}function Yu(e,t,a,d,y){var g=W.p;W.p=g!==0&&8>g?g:8;var b=k.T,R={};k.T=R,Ls(e,!1,t,a);try{var $=y(),J=k.S;if(J!==null&&J(R,$),$!==null&&typeof $=="object"&&typeof $.then=="function"){var de=D_($,d);vr(e,t,de,yn(e))}else vr(e,t,d,yn(e))}catch(pe){vr(e,t,{then:function(){},status:"rejected",reason:pe},yn())}finally{W.p=g,k.T=b}}function U_(){}function Os(e,t,a,d){if(e.tag!==5)throw Error(i(476));var y=Wu(e).queue;Yu(e,y,t,ee,a===null?U_:function(){return Qu(e),a(d)})}function Wu(e){var t=e.memoizedState;if(t!==null)return t;t={memoizedState:ee,baseState:ee,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Jn,lastRenderedState:ee},next:null};var a={};return t.next={memoizedState:a,baseState:a,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Jn,lastRenderedState:a},next:null},e.memoizedState=t,e=e.alternate,e!==null&&(e.memoizedState=t),t}function Qu(e){var t=Wu(e).next.queue;vr(e,t,{},yn())}function $s(){return Gt($r)}function Xu(){return jt().memoizedState}function Zu(){return jt().memoizedState}function O_(e){for(var t=e.return;t!==null;){switch(t.tag){case 24:case 3:var a=yn();e=go(a);var d=vo(t,e,a);d!==null&&(_n(d,t,a),fr(d,t,a)),t={cache:fs()},e.payload=t;return}t=t.return}}function $_(e,t,a){var d=yn();a={lane:d,revertLane:0,action:a,hasEagerState:!1,eagerState:null,next:null},Ol(e)?Ju(t,a):(a=os(e,t,a,d),a!==null&&(_n(a,e,d),ep(a,t,d)))}function Ku(e,t,a){var d=yn();vr(e,t,a,d)}function vr(e,t,a,d){var y={lane:d,revertLane:0,action:a,hasEagerState:!1,eagerState:null,next:null};if(Ol(e))Ju(t,y);else{var g=e.alternate;if(e.lanes===0&&(g===null||g.lanes===0)&&(g=t.lastRenderedReducer,g!==null))try{var b=t.lastRenderedState,R=g(b,a);if(y.hasEagerState=!0,y.eagerState=R,dn(R,b))return vl(e,t,y,0),ot===null&&gl(),!1}catch{}finally{}if(a=os(e,t,y,d),a!==null)return _n(a,e,d),ep(a,t,d),!0}return!1}function Ls(e,t,a,d){if(d={lane:2,revertLane:_i(),action:d,hasEagerState:!1,eagerState:null,next:null},Ol(e)){if(t)throw Error(i(479))}else t=os(e,a,d,2),t!==null&&_n(t,e,2)}function Ol(e){var t=e.alternate;return e===Oe||t!==null&&t===Oe}function Ju(e,t){Ea=Dl=!0;var a=e.pending;a===null?t.next=t:(t.next=a.next,a.next=t),e.pending=t}function ep(e,t,a){if((a&4194048)!==0){var d=t.lanes;d&=e.pendingLanes,a|=d,t.lanes=a,rl(e,a)}}var $l={readContext:Gt,use:Nl,useCallback:wt,useContext:wt,useEffect:wt,useImperativeHandle:wt,useLayoutEffect:wt,useInsertionEffect:wt,useMemo:wt,useReducer:wt,useRef:wt,useState:wt,useDebugValue:wt,useDeferredValue:wt,useTransition:wt,useSyncExternalStore:wt,useId:wt,useHostTransitionStatus:wt,useFormState:wt,useActionState:wt,useOptimistic:wt,useMemoCache:wt,useCacheRefresh:wt},tp={readContext:Gt,use:Nl,useCallback:function(e,t){return en().memoizedState=[e,t===void 0?null:t],e},useContext:Gt,useEffect:Lu,useImperativeHandle:function(e,t,a){a=a!=null?a.concat([e]):null,Ul(4194308,4,Hu.bind(null,t,e),a)},useLayoutEffect:function(e,t){return Ul(4194308,4,e,t)},useInsertionEffect:function(e,t){Ul(4,2,e,t)},useMemo:function(e,t){var a=en();t=t===void 0?null:t;var d=e();if(Jo){ln(!0);try{e()}finally{ln(!1)}}return a.memoizedState=[d,t],d},useReducer:function(e,t,a){var d=en();if(a!==void 0){var y=a(t);if(Jo){ln(!0);try{a(t)}finally{ln(!1)}}}else y=t;return d.memoizedState=d.baseState=y,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:y},d.queue=e,e=e.dispatch=$_.bind(null,Oe,e),[d.memoizedState,e]},useRef:function(e){var t=en();return e={current:e},t.memoizedState=e},useState:function(e){e=Ns(e);var t=e.queue,a=Ku.bind(null,Oe,t);return t.dispatch=a,[e.memoizedState,a]},useDebugValue:qs,useDeferredValue:function(e,t){var a=en();return Us(a,e,t)},useTransition:function(){var e=Ns(!1);return e=Yu.bind(null,Oe,e.queue,!0,!1),en().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,t,a){var d=Oe,y=en();if(Qe){if(a===void 0)throw Error(i(407));a=a()}else{if(a=t(),ot===null)throw Error(i(349));(Ve&124)!==0||Cu(d,t,a)}y.memoizedState=a;var g={value:a,getSnapshot:t};return y.queue=g,Lu(bu.bind(null,d,g,e),[e]),d.flags|=2048,Ra(9,ql(),Su.bind(null,d,g,a,t),null),a},useId:function(){var e=en(),t=ot.identifierPrefix;if(Qe){var a=Xn,d=Qn;a=(d&~(1<<32-At(d)-1)).toString(32)+a,t=""+t+"R"+a,a=Tl++,0<a&&(t+="H"+a.toString(32)),t+=""}else a=T_++,t=""+t+"r"+a.toString(32)+"";return e.memoizedState=t},useHostTransitionStatus:$s,useFormState:Fu,useActionState:Fu,useOptimistic:function(e){var t=en();t.memoizedState=t.baseState=e;var a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return t.queue=a,t=Ls.bind(null,Oe,!0,a),a.dispatch=t,[e,t]},useMemoCache:ks,useCacheRefresh:function(){return en().memoizedState=O_.bind(null,Oe)}},np={readContext:Gt,use:Nl,useCallback:Bu,useContext:Gt,useEffect:Mu,useImperativeHandle:Vu,useInsertionEffect:Pu,useLayoutEffect:Iu,useMemo:zu,useReducer:Fl,useRef:$u,useState:function(){return Fl(Jn)},useDebugValue:qs,useDeferredValue:function(e,t){var a=jt();return Gu(a,Je.memoizedState,e,t)},useTransition:function(){var e=Fl(Jn)[0],t=jt().memoizedState;return[typeof e=="boolean"?e:mr(e),t]},useSyncExternalStore:xu,useId:Xu,useHostTransitionStatus:$s,useFormState:qu,useActionState:qu,useOptimistic:function(e,t){var a=jt();return Ru(a,Je,e,t)},useMemoCache:ks,useCacheRefresh:Zu},L_={readContext:Gt,use:Nl,useCallback:Bu,useContext:Gt,useEffect:Mu,useImperativeHandle:Vu,useInsertionEffect:Pu,useLayoutEffect:Iu,useMemo:zu,useReducer:Ts,useRef:$u,useState:function(){return Ts(Jn)},useDebugValue:qs,useDeferredValue:function(e,t){var a=jt();return Je===null?Us(a,e,t):Gu(a,Je.memoizedState,e,t)},useTransition:function(){var e=Ts(Jn)[0],t=jt().memoizedState;return[typeof e=="boolean"?e:mr(e),t]},useSyncExternalStore:xu,useId:Xu,useHostTransitionStatus:$s,useFormState:Ou,useActionState:Ou,useOptimistic:function(e,t){var a=jt();return Je!==null?Ru(a,Je,e,t):(a.baseState=e,[e,a.queue.dispatch])},useMemoCache:ks,useCacheRefresh:Zu},Aa=null,wr=0;function Ll(e){var t=wr;return wr+=1,Aa===null&&(Aa=[]),fu(Aa,e,t)}function xr(e,t){t=t.props.ref,e.ref=t!==void 0?t:null}function Ml(e,t){throw t.$$typeof===m?Error(i(525)):(e=Object.prototype.toString.call(t),Error(i(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)))}function op(e){var t=e._init;return t(e._payload)}function ap(e){function t(Y,I){if(e){var Z=Y.deletions;Z===null?(Y.deletions=[I],Y.flags|=16):Z.push(I)}}function a(Y,I){if(!e)return null;for(;I!==null;)t(Y,I),I=I.sibling;return null}function d(Y){for(var I=new Map;Y!==null;)Y.key!==null?I.set(Y.key,Y):I.set(Y.index,Y),Y=Y.sibling;return I}function y(Y,I){return Y=Wn(Y,I),Y.index=0,Y.sibling=null,Y}function g(Y,I,Z){return Y.index=Z,e?(Z=Y.alternate,Z!==null?(Z=Z.index,Z<I?(Y.flags|=67108866,I):Z):(Y.flags|=67108866,I)):(Y.flags|=1048576,I)}function b(Y){return e&&Y.alternate===null&&(Y.flags|=67108866),Y}function R(Y,I,Z,ue){return I===null||I.tag!==6?(I=rs(Z,Y.mode,ue),I.return=Y,I):(I=y(I,Z),I.return=Y,I)}function $(Y,I,Z,ue){var Se=Z.type;return Se===x?de(Y,I,Z.props.children,ue,Z.key):I!==null&&(I.elementType===Se||typeof Se=="object"&&Se!==null&&Se.$$typeof===B&&op(Se)===I.type)?(I=y(I,Z.props),xr(I,Z),I.return=Y,I):(I=xl(Z.type,Z.key,Z.props,null,Y.mode,ue),xr(I,Z),I.return=Y,I)}function J(Y,I,Z,ue){return I===null||I.tag!==4||I.stateNode.containerInfo!==Z.containerInfo||I.stateNode.implementation!==Z.implementation?(I=ls(Z,Y.mode,ue),I.return=Y,I):(I=y(I,Z.children||[]),I.return=Y,I)}function de(Y,I,Z,ue,Se){return I===null||I.tag!==7?(I=zo(Z,Y.mode,ue,Se),I.return=Y,I):(I=y(I,Z),I.return=Y,I)}function pe(Y,I,Z){if(typeof I=="string"&&I!==""||typeof I=="number"||typeof I=="bigint")return I=rs(""+I,Y.mode,Z),I.return=Y,I;if(typeof I=="object"&&I!==null){switch(I.$$typeof){case v:return Z=xl(I.type,I.key,I.props,null,Y.mode,Z),xr(Z,I),Z.return=Y,Z;case w:return I=ls(I,Y.mode,Z),I.return=Y,I;case B:var ue=I._init;return I=ue(I._payload),pe(Y,I,Z)}if(N(I)||G(I))return I=zo(I,Y.mode,Z,null),I.return=Y,I;if(typeof I.then=="function")return pe(Y,Ll(I),Z);if(I.$$typeof===D)return pe(Y,El(Y,I),Z);Ml(Y,I)}return null}function oe(Y,I,Z,ue){var Se=I!==null?I.key:null;if(typeof Z=="string"&&Z!==""||typeof Z=="number"||typeof Z=="bigint")return Se!==null?null:R(Y,I,""+Z,ue);if(typeof Z=="object"&&Z!==null){switch(Z.$$typeof){case v:return Z.key===Se?$(Y,I,Z,ue):null;case w:return Z.key===Se?J(Y,I,Z,ue):null;case B:return Se=Z._init,Z=Se(Z._payload),oe(Y,I,Z,ue)}if(N(Z)||G(Z))return Se!==null?null:de(Y,I,Z,ue,null);if(typeof Z.then=="function")return oe(Y,I,Ll(Z),ue);if(Z.$$typeof===D)return oe(Y,I,El(Y,Z),ue);Ml(Y,Z)}return null}function ae(Y,I,Z,ue,Se){if(typeof ue=="string"&&ue!==""||typeof ue=="number"||typeof ue=="bigint")return Y=Y.get(Z)||null,R(I,Y,""+ue,Se);if(typeof ue=="object"&&ue!==null){switch(ue.$$typeof){case v:return Y=Y.get(ue.key===null?Z:ue.key)||null,$(I,Y,ue,Se);case w:return Y=Y.get(ue.key===null?Z:ue.key)||null,J(I,Y,ue,Se);case B:var $e=ue._init;return ue=$e(ue._payload),ae(Y,I,Z,ue,Se)}if(N(ue)||G(ue))return Y=Y.get(Z)||null,de(I,Y,ue,Se,null);if(typeof ue.then=="function")return ae(Y,I,Z,Ll(ue),Se);if(ue.$$typeof===D)return ae(Y,I,Z,El(I,ue),Se);Ml(I,ue)}return null}function Ne(Y,I,Z,ue){for(var Se=null,$e=null,Re=I,De=I=0,$t=null;Re!==null&&De<Z.length;De++){Re.index>De?($t=Re,Re=null):$t=Re.sibling;var ze=oe(Y,Re,Z[De],ue);if(ze===null){Re===null&&(Re=$t);break}e&&Re&&ze.alternate===null&&t(Y,Re),I=g(ze,I,De),$e===null?Se=ze:$e.sibling=ze,$e=ze,Re=$t}if(De===Z.length)return a(Y,Re),Qe&&Yo(Y,De),Se;if(Re===null){for(;De<Z.length;De++)Re=pe(Y,Z[De],ue),Re!==null&&(I=g(Re,I,De),$e===null?Se=Re:$e.sibling=Re,$e=Re);return Qe&&Yo(Y,De),Se}for(Re=d(Re);De<Z.length;De++)$t=ae(Re,Y,De,Z[De],ue),$t!==null&&(e&&$t.alternate!==null&&Re.delete($t.key===null?De:$t.key),I=g($t,I,De),$e===null?Se=$t:$e.sibling=$t,$e=$t);return e&&Re.forEach(function(Oo){return t(Y,Oo)}),Qe&&Yo(Y,De),Se}function ke(Y,I,Z,ue){if(Z==null)throw Error(i(151));for(var Se=null,$e=null,Re=I,De=I=0,$t=null,ze=Z.next();Re!==null&&!ze.done;De++,ze=Z.next()){Re.index>De?($t=Re,Re=null):$t=Re.sibling;var Oo=oe(Y,Re,ze.value,ue);if(Oo===null){Re===null&&(Re=$t);break}e&&Re&&Oo.alternate===null&&t(Y,Re),I=g(Oo,I,De),$e===null?Se=Oo:$e.sibling=Oo,$e=Oo,Re=$t}if(ze.done)return a(Y,Re),Qe&&Yo(Y,De),Se;if(Re===null){for(;!ze.done;De++,ze=Z.next())ze=pe(Y,ze.value,ue),ze!==null&&(I=g(ze,I,De),$e===null?Se=ze:$e.sibling=ze,$e=ze);return Qe&&Yo(Y,De),Se}for(Re=d(Re);!ze.done;De++,ze=Z.next())ze=ae(Re,Y,De,ze.value,ue),ze!==null&&(e&&ze.alternate!==null&&Re.delete(ze.key===null?De:ze.key),I=g(ze,I,De),$e===null?Se=ze:$e.sibling=ze,$e=ze);return e&&Re.forEach(function(Mm){return t(Y,Mm)}),Qe&&Yo(Y,De),Se}function tt(Y,I,Z,ue){if(typeof Z=="object"&&Z!==null&&Z.type===x&&Z.key===null&&(Z=Z.props.children),typeof Z=="object"&&Z!==null){switch(Z.$$typeof){case v:e:{for(var Se=Z.key;I!==null;){if(I.key===Se){if(Se=Z.type,Se===x){if(I.tag===7){a(Y,I.sibling),ue=y(I,Z.props.children),ue.return=Y,Y=ue;break e}}else if(I.elementType===Se||typeof Se=="object"&&Se!==null&&Se.$$typeof===B&&op(Se)===I.type){a(Y,I.sibling),ue=y(I,Z.props),xr(ue,Z),ue.return=Y,Y=ue;break e}a(Y,I);break}else t(Y,I);I=I.sibling}Z.type===x?(ue=zo(Z.props.children,Y.mode,ue,Z.key),ue.return=Y,Y=ue):(ue=xl(Z.type,Z.key,Z.props,null,Y.mode,ue),xr(ue,Z),ue.return=Y,Y=ue)}return b(Y);case w:e:{for(Se=Z.key;I!==null;){if(I.key===Se)if(I.tag===4&&I.stateNode.containerInfo===Z.containerInfo&&I.stateNode.implementation===Z.implementation){a(Y,I.sibling),ue=y(I,Z.children||[]),ue.return=Y,Y=ue;break e}else{a(Y,I);break}else t(Y,I);I=I.sibling}ue=ls(Z,Y.mode,ue),ue.return=Y,Y=ue}return b(Y);case B:return Se=Z._init,Z=Se(Z._payload),tt(Y,I,Z,ue)}if(N(Z))return Ne(Y,I,Z,ue);if(G(Z)){if(Se=G(Z),typeof Se!="function")throw Error(i(150));return Z=Se.call(Z),ke(Y,I,Z,ue)}if(typeof Z.then=="function")return tt(Y,I,Ll(Z),ue);if(Z.$$typeof===D)return tt(Y,I,El(Y,Z),ue);Ml(Y,Z)}return typeof Z=="string"&&Z!==""||typeof Z=="number"||typeof Z=="bigint"?(Z=""+Z,I!==null&&I.tag===6?(a(Y,I.sibling),ue=y(I,Z),ue.return=Y,Y=ue):(a(Y,I),ue=rs(Z,Y.mode,ue),ue.return=Y,Y=ue),b(Y)):a(Y,I)}return function(Y,I,Z,ue){try{wr=0;var Se=tt(Y,I,Z,ue);return Aa=null,Se}catch(Re){if(Re===ur||Re===Rl)throw Re;var $e=un(29,Re,null,Y.mode);return $e.lanes=ue,$e.return=Y,$e}finally{}}}var ka=ap(!0),rp=ap(!1),jn=O(null),Mn=null;function xo(e){var t=e.alternate;U(Nt,Nt.current&1),U(jn,e),Mn===null&&(t===null||ba.current!==null||t.memoizedState!==null)&&(Mn=e)}function lp(e){if(e.tag===22){if(U(Nt,Nt.current),U(jn,e),Mn===null){var t=e.alternate;t!==null&&t.memoizedState!==null&&(Mn=e)}}else Co()}function Co(){U(Nt,Nt.current),U(jn,jn.current)}function eo(e){K(jn),Mn===e&&(Mn=null),K(Nt)}var Nt=O(0);function Pl(e){for(var t=e;t!==null;){if(t.tag===13){var a=t.memoizedState;if(a!==null&&(a=a.dehydrated,a===null||a.data==="$?"||Ai(a)))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if((t.flags&128)!==0)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}function Ms(e,t,a,d){t=e.memoizedState,a=a(d,t),a=a==null?t:_({},t,a),e.memoizedState=a,e.lanes===0&&(e.updateQueue.baseState=a)}var Ps={enqueueSetState:function(e,t,a){e=e._reactInternals;var d=yn(),y=go(d);y.payload=t,a!=null&&(y.callback=a),t=vo(e,y,d),t!==null&&(_n(t,e,d),fr(t,e,d))},enqueueReplaceState:function(e,t,a){e=e._reactInternals;var d=yn(),y=go(d);y.tag=1,y.payload=t,a!=null&&(y.callback=a),t=vo(e,y,d),t!==null&&(_n(t,e,d),fr(t,e,d))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var a=yn(),d=go(a);d.tag=2,t!=null&&(d.callback=t),t=vo(e,d,a),t!==null&&(_n(t,e,a),fr(t,e,a))}};function cp(e,t,a,d,y,g,b){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(d,g,b):t.prototype&&t.prototype.isPureReactComponent?!or(a,d)||!or(y,g):!0}function sp(e,t,a,d){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(a,d),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(a,d),t.state!==e&&Ps.enqueueReplaceState(t,t.state,null)}function ea(e,t){var a=t;if("ref"in t){a={};for(var d in t)d!=="ref"&&(a[d]=t[d])}if(e=e.defaultProps){a===t&&(a=_({},a));for(var y in e)a[y]===void 0&&(a[y]=e[y])}return a}var Il=typeof reportError=="function"?reportError:function(e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof e=="object"&&e!==null&&typeof e.message=="string"?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",e);return}console.error(e)};function ip(e){Il(e)}function dp(e){console.error(e)}function up(e){Il(e)}function Hl(e,t){try{var a=e.onUncaughtError;a(t.value,{componentStack:t.stack})}catch(d){setTimeout(function(){throw d})}}function pp(e,t,a){try{var d=e.onCaughtError;d(a.value,{componentStack:a.stack,errorBoundary:t.tag===1?t.stateNode:null})}catch(y){setTimeout(function(){throw y})}}function Is(e,t,a){return a=go(a),a.tag=3,a.payload={element:null},a.callback=function(){Hl(e,t)},a}function fp(e){return e=go(e),e.tag=3,e}function hp(e,t,a,d){var y=a.type.getDerivedStateFromError;if(typeof y=="function"){var g=d.value;e.payload=function(){return y(g)},e.callback=function(){pp(t,a,d)}}var b=a.stateNode;b!==null&&typeof b.componentDidCatch=="function"&&(e.callback=function(){pp(t,a,d),typeof y!="function"&&(Ao===null?Ao=new Set([this]):Ao.add(this));var R=d.stack;this.componentDidCatch(d.value,{componentStack:R!==null?R:""})})}function M_(e,t,a,d,y){if(a.flags|=32768,d!==null&&typeof d=="object"&&typeof d.then=="function"){if(t=a.alternate,t!==null&&sr(t,a,y,!0),a=jn.current,a!==null){switch(a.tag){case 13:return Mn===null?ui():a.alternate===null&&yt===0&&(yt=3),a.flags&=-257,a.flags|=65536,a.lanes=y,d===_s?a.flags|=16384:(t=a.updateQueue,t===null?a.updateQueue=new Set([d]):t.add(d),fi(e,d,y)),!1;case 22:return a.flags|=65536,d===_s?a.flags|=16384:(t=a.updateQueue,t===null?(t={transitions:null,markerInstances:null,retryQueue:new Set([d])},a.updateQueue=t):(a=t.retryQueue,a===null?t.retryQueue=new Set([d]):a.add(d)),fi(e,d,y)),!1}throw Error(i(435,a.tag))}return fi(e,d,y),ui(),!1}if(Qe)return t=jn.current,t!==null?((t.flags&65536)===0&&(t.flags|=256),t.flags|=65536,t.lanes=y,d!==is&&(e=Error(i(422),{cause:d}),cr(Cn(e,a)))):(d!==is&&(t=Error(i(423),{cause:d}),cr(Cn(t,a))),e=e.current.alternate,e.flags|=65536,y&=-y,e.lanes|=y,d=Cn(d,a),y=Is(e.stateNode,d,y),vs(e,y),yt!==4&&(yt=2)),!1;var g=Error(i(520),{cause:d});if(g=Cn(g,a),Ar===null?Ar=[g]:Ar.push(g),yt!==4&&(yt=2),t===null)return!0;d=Cn(d,a),a=t;do{switch(a.tag){case 3:return a.flags|=65536,e=y&-y,a.lanes|=e,e=Is(a.stateNode,d,e),vs(a,e),!1;case 1:if(t=a.type,g=a.stateNode,(a.flags&128)===0&&(typeof t.getDerivedStateFromError=="function"||g!==null&&typeof g.componentDidCatch=="function"&&(Ao===null||!Ao.has(g))))return a.flags|=65536,y&=-y,a.lanes|=y,y=fp(y),hp(y,e,a,d),vs(a,y),!1}a=a.return}while(a!==null);return!1}var yp=Error(i(461)),Ut=!1;function It(e,t,a,d){t.child=e===null?rp(t,null,a,d):ka(t,e.child,a,d)}function _p(e,t,a,d,y){a=a.render;var g=t.ref;if("ref"in d){var b={};for(var R in d)R!=="ref"&&(b[R]=d[R])}else b=d;return Zo(t),d=bs(e,t,a,b,g,y),R=Es(),e!==null&&!Ut?(js(e,t,y),to(e,t,y)):(Qe&&R&&cs(t),t.flags|=1,It(e,t,d,y),t.child)}function mp(e,t,a,d,y){if(e===null){var g=a.type;return typeof g=="function"&&!as(g)&&g.defaultProps===void 0&&a.compare===null?(t.tag=15,t.type=g,gp(e,t,g,d,y)):(e=xl(a.type,null,d,t,t.mode,y),e.ref=t.ref,e.return=t,t.child=e)}if(g=e.child,!Qs(e,y)){var b=g.memoizedProps;if(a=a.compare,a=a!==null?a:or,a(b,d)&&e.ref===t.ref)return to(e,t,y)}return t.flags|=1,e=Wn(g,d),e.ref=t.ref,e.return=t,t.child=e}function gp(e,t,a,d,y){if(e!==null){var g=e.memoizedProps;if(or(g,d)&&e.ref===t.ref)if(Ut=!1,t.pendingProps=d=g,Qs(e,y))(e.flags&131072)!==0&&(Ut=!0);else return t.lanes=e.lanes,to(e,t,y)}return Hs(e,t,a,d,y)}function vp(e,t,a){var d=t.pendingProps,y=d.children,g=e!==null?e.memoizedState:null;if(d.mode==="hidden"){if((t.flags&128)!==0){if(d=g!==null?g.baseLanes|a:a,e!==null){for(y=t.child=e.child,g=0;y!==null;)g=g|y.lanes|y.childLanes,y=y.sibling;t.childLanes=g&~d}else t.childLanes=0,t.child=null;return wp(e,t,d,a)}if((a&536870912)!==0)t.memoizedState={baseLanes:0,cachePool:null},e!==null&&jl(t,g!==null?g.cachePool:null),g!==null?gu(t,g):xs(),lp(t);else return t.lanes=t.childLanes=536870912,wp(e,t,g!==null?g.baseLanes|a:a,a)}else g!==null?(jl(t,g.cachePool),gu(t,g),Co(),t.memoizedState=null):(e!==null&&jl(t,null),xs(),Co());return It(e,t,y,a),t.child}function wp(e,t,a,d){var y=ys();return y=y===null?null:{parent:Tt._currentValue,pool:y},t.memoizedState={baseLanes:a,cachePool:y},e!==null&&jl(t,null),xs(),lp(t),e!==null&&sr(e,t,d,!0),null}function Vl(e,t){var a=t.ref;if(a===null)e!==null&&e.ref!==null&&(t.flags|=4194816);else{if(typeof a!="function"&&typeof a!="object")throw Error(i(284));(e===null||e.ref!==a)&&(t.flags|=4194816)}}function Hs(e,t,a,d,y){return Zo(t),a=bs(e,t,a,d,void 0,y),d=Es(),e!==null&&!Ut?(js(e,t,y),to(e,t,y)):(Qe&&d&&cs(t),t.flags|=1,It(e,t,a,y),t.child)}function xp(e,t,a,d,y,g){return Zo(t),t.updateQueue=null,a=wu(t,d,a,y),vu(e),d=Es(),e!==null&&!Ut?(js(e,t,g),to(e,t,g)):(Qe&&d&&cs(t),t.flags|=1,It(e,t,a,g),t.child)}function Cp(e,t,a,d,y){if(Zo(t),t.stateNode===null){var g=va,b=a.contextType;typeof b=="object"&&b!==null&&(g=Gt(b)),g=new a(d,g),t.memoizedState=g.state!==null&&g.state!==void 0?g.state:null,g.updater=Ps,t.stateNode=g,g._reactInternals=t,g=t.stateNode,g.props=d,g.state=t.memoizedState,g.refs={},ms(t),b=a.contextType,g.context=typeof b=="object"&&b!==null?Gt(b):va,g.state=t.memoizedState,b=a.getDerivedStateFromProps,typeof b=="function"&&(Ms(t,a,b,d),g.state=t.memoizedState),typeof a.getDerivedStateFromProps=="function"||typeof g.getSnapshotBeforeUpdate=="function"||typeof g.UNSAFE_componentWillMount!="function"&&typeof g.componentWillMount!="function"||(b=g.state,typeof g.componentWillMount=="function"&&g.componentWillMount(),typeof g.UNSAFE_componentWillMount=="function"&&g.UNSAFE_componentWillMount(),b!==g.state&&Ps.enqueueReplaceState(g,g.state,null),yr(t,d,g,y),hr(),g.state=t.memoizedState),typeof g.componentDidMount=="function"&&(t.flags|=4194308),d=!0}else if(e===null){g=t.stateNode;var R=t.memoizedProps,$=ea(a,R);g.props=$;var J=g.context,de=a.contextType;b=va,typeof de=="object"&&de!==null&&(b=Gt(de));var pe=a.getDerivedStateFromProps;de=typeof pe=="function"||typeof g.getSnapshotBeforeUpdate=="function",R=t.pendingProps!==R,de||typeof g.UNSAFE_componentWillReceiveProps!="function"&&typeof g.componentWillReceiveProps!="function"||(R||J!==b)&&sp(t,g,d,b),mo=!1;var oe=t.memoizedState;g.state=oe,yr(t,d,g,y),hr(),J=t.memoizedState,R||oe!==J||mo?(typeof pe=="function"&&(Ms(t,a,pe,d),J=t.memoizedState),($=mo||cp(t,a,$,d,oe,J,b))?(de||typeof g.UNSAFE_componentWillMount!="function"&&typeof g.componentWillMount!="function"||(typeof g.componentWillMount=="function"&&g.componentWillMount(),typeof g.UNSAFE_componentWillMount=="function"&&g.UNSAFE_componentWillMount()),typeof g.componentDidMount=="function"&&(t.flags|=4194308)):(typeof g.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=d,t.memoizedState=J),g.props=d,g.state=J,g.context=b,d=$):(typeof g.componentDidMount=="function"&&(t.flags|=4194308),d=!1)}else{g=t.stateNode,gs(e,t),b=t.memoizedProps,de=ea(a,b),g.props=de,pe=t.pendingProps,oe=g.context,J=a.contextType,$=va,typeof J=="object"&&J!==null&&($=Gt(J)),R=a.getDerivedStateFromProps,(J=typeof R=="function"||typeof g.getSnapshotBeforeUpdate=="function")||typeof g.UNSAFE_componentWillReceiveProps!="function"&&typeof g.componentWillReceiveProps!="function"||(b!==pe||oe!==$)&&sp(t,g,d,$),mo=!1,oe=t.memoizedState,g.state=oe,yr(t,d,g,y),hr();var ae=t.memoizedState;b!==pe||oe!==ae||mo||e!==null&&e.dependencies!==null&&bl(e.dependencies)?(typeof R=="function"&&(Ms(t,a,R,d),ae=t.memoizedState),(de=mo||cp(t,a,de,d,oe,ae,$)||e!==null&&e.dependencies!==null&&bl(e.dependencies))?(J||typeof g.UNSAFE_componentWillUpdate!="function"&&typeof g.componentWillUpdate!="function"||(typeof g.componentWillUpdate=="function"&&g.componentWillUpdate(d,ae,$),typeof g.UNSAFE_componentWillUpdate=="function"&&g.UNSAFE_componentWillUpdate(d,ae,$)),typeof g.componentDidUpdate=="function"&&(t.flags|=4),typeof g.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof g.componentDidUpdate!="function"||b===e.memoizedProps&&oe===e.memoizedState||(t.flags|=4),typeof g.getSnapshotBeforeUpdate!="function"||b===e.memoizedProps&&oe===e.memoizedState||(t.flags|=1024),t.memoizedProps=d,t.memoizedState=ae),g.props=d,g.state=ae,g.context=$,d=de):(typeof g.componentDidUpdate!="function"||b===e.memoizedProps&&oe===e.memoizedState||(t.flags|=4),typeof g.getSnapshotBeforeUpdate!="function"||b===e.memoizedProps&&oe===e.memoizedState||(t.flags|=1024),d=!1)}return g=d,Vl(e,t),d=(t.flags&128)!==0,g||d?(g=t.stateNode,a=d&&typeof a.getDerivedStateFromError!="function"?null:g.render(),t.flags|=1,e!==null&&d?(t.child=ka(t,e.child,null,y),t.child=ka(t,null,a,y)):It(e,t,a,y),t.memoizedState=g.state,e=t.child):e=to(e,t,y),e}function Sp(e,t,a,d){return lr(),t.flags|=256,It(e,t,a,d),t.child}var Vs={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Bs(e){return{baseLanes:e,cachePool:du()}}function zs(e,t,a){return e=e!==null?e.childLanes&~a:0,t&&(e|=Rn),e}function bp(e,t,a){var d=t.pendingProps,y=!1,g=(t.flags&128)!==0,b;if((b=g)||(b=e!==null&&e.memoizedState===null?!1:(Nt.current&2)!==0),b&&(y=!0,t.flags&=-129),b=(t.flags&32)!==0,t.flags&=-33,e===null){if(Qe){if(y?xo(t):Co(),Qe){var R=ht,$;if($=R){e:{for($=R,R=Ln;$.nodeType!==8;){if(!R){R=null;break e}if($=Un($.nextSibling),$===null){R=null;break e}}R=$}R!==null?(t.memoizedState={dehydrated:R,treeContext:Go!==null?{id:Qn,overflow:Xn}:null,retryLane:536870912,hydrationErrors:null},$=un(18,null,null,0),$.stateNode=R,$.return=t,t.child=$,Xt=t,ht=null,$=!0):$=!1}$||Qo(t)}if(R=t.memoizedState,R!==null&&(R=R.dehydrated,R!==null))return Ai(R)?t.lanes=32:t.lanes=536870912,null;eo(t)}return R=d.children,d=d.fallback,y?(Co(),y=t.mode,R=Bl({mode:"hidden",children:R},y),d=zo(d,y,a,null),R.return=t,d.return=t,R.sibling=d,t.child=R,y=t.child,y.memoizedState=Bs(a),y.childLanes=zs(e,b,a),t.memoizedState=Vs,d):(xo(t),Gs(t,R))}if($=e.memoizedState,$!==null&&(R=$.dehydrated,R!==null)){if(g)t.flags&256?(xo(t),t.flags&=-257,t=Ys(e,t,a)):t.memoizedState!==null?(Co(),t.child=e.child,t.flags|=128,t=null):(Co(),y=d.fallback,R=t.mode,d=Bl({mode:"visible",children:d.children},R),y=zo(y,R,a,null),y.flags|=2,d.return=t,y.return=t,d.sibling=y,t.child=d,ka(t,e.child,null,a),d=t.child,d.memoizedState=Bs(a),d.childLanes=zs(e,b,a),t.memoizedState=Vs,t=y);else if(xo(t),Ai(R)){if(b=R.nextSibling&&R.nextSibling.dataset,b)var J=b.dgst;b=J,d=Error(i(419)),d.stack="",d.digest=b,cr({value:d,source:null,stack:null}),t=Ys(e,t,a)}else if(Ut||sr(e,t,a,!1),b=(a&e.childLanes)!==0,Ut||b){if(b=ot,b!==null&&(d=a&-a,d=(d&42)!==0?1:Wa(d),d=(d&(b.suspendedLanes|a))!==0?0:d,d!==0&&d!==$.retryLane))throw $.retryLane=d,ga(e,d),_n(b,e,d),yp;R.data==="$?"||ui(),t=Ys(e,t,a)}else R.data==="$?"?(t.flags|=192,t.child=e.child,t=null):(e=$.treeContext,ht=Un(R.nextSibling),Xt=t,Qe=!0,Wo=null,Ln=!1,e!==null&&(bn[En++]=Qn,bn[En++]=Xn,bn[En++]=Go,Qn=e.id,Xn=e.overflow,Go=t),t=Gs(t,d.children),t.flags|=4096);return t}return y?(Co(),y=d.fallback,R=t.mode,$=e.child,J=$.sibling,d=Wn($,{mode:"hidden",children:d.children}),d.subtreeFlags=$.subtreeFlags&65011712,J!==null?y=Wn(J,y):(y=zo(y,R,a,null),y.flags|=2),y.return=t,d.return=t,d.sibling=y,t.child=d,d=y,y=t.child,R=e.child.memoizedState,R===null?R=Bs(a):($=R.cachePool,$!==null?(J=Tt._currentValue,$=$.parent!==J?{parent:J,pool:J}:$):$=du(),R={baseLanes:R.baseLanes|a,cachePool:$}),y.memoizedState=R,y.childLanes=zs(e,b,a),t.memoizedState=Vs,d):(xo(t),a=e.child,e=a.sibling,a=Wn(a,{mode:"visible",children:d.children}),a.return=t,a.sibling=null,e!==null&&(b=t.deletions,b===null?(t.deletions=[e],t.flags|=16):b.push(e)),t.child=a,t.memoizedState=null,a)}function Gs(e,t){return t=Bl({mode:"visible",children:t},e.mode),t.return=e,e.child=t}function Bl(e,t){return e=un(22,e,null,t),e.lanes=0,e.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},e}function Ys(e,t,a){return ka(t,e.child,null,a),e=Gs(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function Ep(e,t,a){e.lanes|=t;var d=e.alternate;d!==null&&(d.lanes|=t),us(e.return,t,a)}function Ws(e,t,a,d,y){var g=e.memoizedState;g===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:d,tail:a,tailMode:y}:(g.isBackwards=t,g.rendering=null,g.renderingStartTime=0,g.last=d,g.tail=a,g.tailMode=y)}function jp(e,t,a){var d=t.pendingProps,y=d.revealOrder,g=d.tail;if(It(e,t,d.children,a),d=Nt.current,(d&2)!==0)d=d&1|2,t.flags|=128;else{if(e!==null&&(e.flags&128)!==0)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&Ep(e,a,t);else if(e.tag===19)Ep(e,a,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}d&=1}switch(U(Nt,d),y){case"forwards":for(a=t.child,y=null;a!==null;)e=a.alternate,e!==null&&Pl(e)===null&&(y=a),a=a.sibling;a=y,a===null?(y=t.child,t.child=null):(y=a.sibling,a.sibling=null),Ws(t,!1,y,a,g);break;case"backwards":for(a=null,y=t.child,t.child=null;y!==null;){if(e=y.alternate,e!==null&&Pl(e)===null){t.child=y;break}e=y.sibling,y.sibling=a,a=y,y=e}Ws(t,!0,a,null,g);break;case"together":Ws(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function to(e,t,a){if(e!==null&&(t.dependencies=e.dependencies),Ro|=t.lanes,(a&t.childLanes)===0)if(e!==null){if(sr(e,t,a,!1),(a&t.childLanes)===0)return null}else return null;if(e!==null&&t.child!==e.child)throw Error(i(153));if(t.child!==null){for(e=t.child,a=Wn(e,e.pendingProps),t.child=a,a.return=t;e.sibling!==null;)e=e.sibling,a=a.sibling=Wn(e,e.pendingProps),a.return=t;a.sibling=null}return t.child}function Qs(e,t){return(e.lanes&t)!==0?!0:(e=e.dependencies,!!(e!==null&&bl(e)))}function P_(e,t,a){switch(t.tag){case 3:X(t,t.stateNode.containerInfo),_o(t,Tt,e.memoizedState.cache),lr();break;case 27:case 5:se(t);break;case 4:X(t,t.stateNode.containerInfo);break;case 10:_o(t,t.type,t.memoizedProps.value);break;case 13:var d=t.memoizedState;if(d!==null)return d.dehydrated!==null?(xo(t),t.flags|=128,null):(a&t.child.childLanes)!==0?bp(e,t,a):(xo(t),e=to(e,t,a),e!==null?e.sibling:null);xo(t);break;case 19:var y=(e.flags&128)!==0;if(d=(a&t.childLanes)!==0,d||(sr(e,t,a,!1),d=(a&t.childLanes)!==0),y){if(d)return jp(e,t,a);t.flags|=128}if(y=t.memoizedState,y!==null&&(y.rendering=null,y.tail=null,y.lastEffect=null),U(Nt,Nt.current),d)break;return null;case 22:case 23:return t.lanes=0,vp(e,t,a);case 24:_o(t,Tt,e.memoizedState.cache)}return to(e,t,a)}function Rp(e,t,a){if(e!==null)if(e.memoizedProps!==t.pendingProps)Ut=!0;else{if(!Qs(e,a)&&(t.flags&128)===0)return Ut=!1,P_(e,t,a);Ut=(e.flags&131072)!==0}else Ut=!1,Qe&&(t.flags&1048576)!==0&&ou(t,Sl,t.index);switch(t.lanes=0,t.tag){case 16:e:{e=t.pendingProps;var d=t.elementType,y=d._init;if(d=y(d._payload),t.type=d,typeof d=="function")as(d)?(e=ea(d,e),t.tag=1,t=Cp(null,t,d,e,a)):(t.tag=0,t=Hs(null,t,d,e,a));else{if(d!=null){if(y=d.$$typeof,y===A){t.tag=11,t=_p(null,t,d,e,a);break e}else if(y===ce){t.tag=14,t=mp(null,t,d,e,a);break e}}throw t=q(d)||d,Error(i(306,t,""))}}return t;case 0:return Hs(e,t,t.type,t.pendingProps,a);case 1:return d=t.type,y=ea(d,t.pendingProps),Cp(e,t,d,y,a);case 3:e:{if(X(t,t.stateNode.containerInfo),e===null)throw Error(i(387));d=t.pendingProps;var g=t.memoizedState;y=g.element,gs(e,t),yr(t,d,null,a);var b=t.memoizedState;if(d=b.cache,_o(t,Tt,d),d!==g.cache&&ps(t,[Tt],a,!0),hr(),d=b.element,g.isDehydrated)if(g={element:d,isDehydrated:!1,cache:b.cache},t.updateQueue.baseState=g,t.memoizedState=g,t.flags&256){t=Sp(e,t,d,a);break e}else if(d!==y){y=Cn(Error(i(424)),t),cr(y),t=Sp(e,t,d,a);break e}else{switch(e=t.stateNode.containerInfo,e.nodeType){case 9:e=e.body;break;default:e=e.nodeName==="HTML"?e.ownerDocument.body:e}for(ht=Un(e.firstChild),Xt=t,Qe=!0,Wo=null,Ln=!0,a=rp(t,null,d,a),t.child=a;a;)a.flags=a.flags&-3|4096,a=a.sibling}else{if(lr(),d===y){t=to(e,t,a);break e}It(e,t,d,a)}t=t.child}return t;case 26:return Vl(e,t),e===null?(a=Nf(t.type,null,t.pendingProps,null))?t.memoizedState=a:Qe||(a=t.type,e=t.pendingProps,d=ac(fe.current).createElement(a),d[kt]=t,d[Mt]=e,Vt(d,a,e),Dt(d),t.stateNode=d):t.memoizedState=Nf(t.type,e.memoizedProps,t.pendingProps,e.memoizedState),null;case 27:return se(t),e===null&&Qe&&(d=t.stateNode=kf(t.type,t.pendingProps,fe.current),Xt=t,Ln=!0,y=ht,To(t.type)?(ki=y,ht=Un(d.firstChild)):ht=y),It(e,t,t.pendingProps.children,a),Vl(e,t),e===null&&(t.flags|=4194304),t.child;case 5:return e===null&&Qe&&((y=d=ht)&&(d=hm(d,t.type,t.pendingProps,Ln),d!==null?(t.stateNode=d,Xt=t,ht=Un(d.firstChild),Ln=!1,y=!0):y=!1),y||Qo(t)),se(t),y=t.type,g=t.pendingProps,b=e!==null?e.memoizedProps:null,d=g.children,Ei(y,g)?d=null:b!==null&&Ei(y,b)&&(t.flags|=32),t.memoizedState!==null&&(y=bs(e,t,N_,null,null,a),$r._currentValue=y),Vl(e,t),It(e,t,d,a),t.child;case 6:return e===null&&Qe&&((e=a=ht)&&(a=ym(a,t.pendingProps,Ln),a!==null?(t.stateNode=a,Xt=t,ht=null,e=!0):e=!1),e||Qo(t)),null;case 13:return bp(e,t,a);case 4:return X(t,t.stateNode.containerInfo),d=t.pendingProps,e===null?t.child=ka(t,null,d,a):It(e,t,d,a),t.child;case 11:return _p(e,t,t.type,t.pendingProps,a);case 7:return It(e,t,t.pendingProps,a),t.child;case 8:return It(e,t,t.pendingProps.children,a),t.child;case 12:return It(e,t,t.pendingProps.children,a),t.child;case 10:return d=t.pendingProps,_o(t,t.type,d.value),It(e,t,d.children,a),t.child;case 9:return y=t.type._context,d=t.pendingProps.children,Zo(t),y=Gt(y),d=d(y),t.flags|=1,It(e,t,d,a),t.child;case 14:return mp(e,t,t.type,t.pendingProps,a);case 15:return gp(e,t,t.type,t.pendingProps,a);case 19:return jp(e,t,a);case 31:return d=t.pendingProps,a=t.mode,d={mode:d.mode,children:d.children},e===null?(a=Bl(d,a),a.ref=t.ref,t.child=a,a.return=t,t=a):(a=Wn(e.child,d),a.ref=t.ref,t.child=a,a.return=t,t=a),t;case 22:return vp(e,t,a);case 24:return Zo(t),d=Gt(Tt),e===null?(y=ys(),y===null&&(y=ot,g=fs(),y.pooledCache=g,g.refCount++,g!==null&&(y.pooledCacheLanes|=a),y=g),t.memoizedState={parent:d,cache:y},ms(t),_o(t,Tt,y)):((e.lanes&a)!==0&&(gs(e,t),yr(t,null,null,a),hr()),y=e.memoizedState,g=t.memoizedState,y.parent!==d?(y={parent:d,cache:d},t.memoizedState=y,t.lanes===0&&(t.memoizedState=t.updateQueue.baseState=y),_o(t,Tt,d)):(d=g.cache,_o(t,Tt,d),d!==y.cache&&ps(t,[Tt],a,!0))),It(e,t,t.pendingProps.children,a),t.child;case 29:throw t.pendingProps}throw Error(i(156,t.tag))}function no(e){e.flags|=4}function Ap(e,t){if(t.type!=="stylesheet"||(t.state.loading&4)!==0)e.flags&=-16777217;else if(e.flags|=16777216,!$f(t)){if(t=jn.current,t!==null&&((Ve&4194048)===Ve?Mn!==null:(Ve&62914560)!==Ve&&(Ve&536870912)===0||t!==Mn))throw pr=_s,uu;e.flags|=8192}}function zl(e,t){t!==null&&(e.flags|=4),e.flags&16384&&(t=e.tag!==22?nl():536870912,e.lanes|=t,Fa|=t)}function Cr(e,t){if(!Qe)switch(e.tailMode){case"hidden":t=e.tail;for(var a=null;t!==null;)t.alternate!==null&&(a=t),t=t.sibling;a===null?e.tail=null:a.sibling=null;break;case"collapsed":a=e.tail;for(var d=null;a!==null;)a.alternate!==null&&(d=a),a=a.sibling;d===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:d.sibling=null}}function ut(e){var t=e.alternate!==null&&e.alternate.child===e.child,a=0,d=0;if(t)for(var y=e.child;y!==null;)a|=y.lanes|y.childLanes,d|=y.subtreeFlags&65011712,d|=y.flags&65011712,y.return=e,y=y.sibling;else for(y=e.child;y!==null;)a|=y.lanes|y.childLanes,d|=y.subtreeFlags,d|=y.flags,y.return=e,y=y.sibling;return e.subtreeFlags|=d,e.childLanes=a,t}function I_(e,t,a){var d=t.pendingProps;switch(ss(t),t.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ut(t),null;case 1:return ut(t),null;case 3:return a=t.stateNode,d=null,e!==null&&(d=e.memoizedState.cache),t.memoizedState.cache!==d&&(t.flags|=2048),Kn(Tt),re(),a.pendingContext&&(a.context=a.pendingContext,a.pendingContext=null),(e===null||e.child===null)&&(rr(t)?no(t):e===null||e.memoizedState.isDehydrated&&(t.flags&256)===0||(t.flags|=1024,lu())),ut(t),null;case 26:return a=t.memoizedState,e===null?(no(t),a!==null?(ut(t),Ap(t,a)):(ut(t),t.flags&=-16777217)):a?a!==e.memoizedState?(no(t),ut(t),Ap(t,a)):(ut(t),t.flags&=-16777217):(e.memoizedProps!==d&&no(t),ut(t),t.flags&=-16777217),null;case 27:we(t),a=fe.current;var y=t.type;if(e!==null&&t.stateNode!=null)e.memoizedProps!==d&&no(t);else{if(!d){if(t.stateNode===null)throw Error(i(166));return ut(t),null}e=Q.current,rr(t)?au(t):(e=kf(y,d,a),t.stateNode=e,no(t))}return ut(t),null;case 5:if(we(t),a=t.type,e!==null&&t.stateNode!=null)e.memoizedProps!==d&&no(t);else{if(!d){if(t.stateNode===null)throw Error(i(166));return ut(t),null}if(e=Q.current,rr(t))au(t);else{switch(y=ac(fe.current),e){case 1:e=y.createElementNS("http://www.w3.org/2000/svg",a);break;case 2:e=y.createElementNS("http://www.w3.org/1998/Math/MathML",a);break;default:switch(a){case"svg":e=y.createElementNS("http://www.w3.org/2000/svg",a);break;case"math":e=y.createElementNS("http://www.w3.org/1998/Math/MathML",a);break;case"script":e=y.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild);break;case"select":e=typeof d.is=="string"?y.createElement("select",{is:d.is}):y.createElement("select"),d.multiple?e.multiple=!0:d.size&&(e.size=d.size);break;default:e=typeof d.is=="string"?y.createElement(a,{is:d.is}):y.createElement(a)}}e[kt]=t,e[Mt]=d;e:for(y=t.child;y!==null;){if(y.tag===5||y.tag===6)e.appendChild(y.stateNode);else if(y.tag!==4&&y.tag!==27&&y.child!==null){y.child.return=y,y=y.child;continue}if(y===t)break e;for(;y.sibling===null;){if(y.return===null||y.return===t)break e;y=y.return}y.sibling.return=y.return,y=y.sibling}t.stateNode=e;e:switch(Vt(e,a,d),a){case"button":case"input":case"select":case"textarea":e=!!d.autoFocus;break e;case"img":e=!0;break e;default:e=!1}e&&no(t)}}return ut(t),t.flags&=-16777217,null;case 6:if(e&&t.stateNode!=null)e.memoizedProps!==d&&no(t);else{if(typeof d!="string"&&t.stateNode===null)throw Error(i(166));if(e=fe.current,rr(t)){if(e=t.stateNode,a=t.memoizedProps,d=null,y=Xt,y!==null)switch(y.tag){case 27:case 5:d=y.memoizedProps}e[kt]=t,e=!!(e.nodeValue===a||d!==null&&d.suppressHydrationWarning===!0||Cf(e.nodeValue,a)),e||Qo(t)}else e=ac(e).createTextNode(d),e[kt]=t,t.stateNode=e}return ut(t),null;case 13:if(d=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(y=rr(t),d!==null&&d.dehydrated!==null){if(e===null){if(!y)throw Error(i(318));if(y=t.memoizedState,y=y!==null?y.dehydrated:null,!y)throw Error(i(317));y[kt]=t}else lr(),(t.flags&128)===0&&(t.memoizedState=null),t.flags|=4;ut(t),y=!1}else y=lu(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=y),y=!0;if(!y)return t.flags&256?(eo(t),t):(eo(t),null)}if(eo(t),(t.flags&128)!==0)return t.lanes=a,t;if(a=d!==null,e=e!==null&&e.memoizedState!==null,a){d=t.child,y=null,d.alternate!==null&&d.alternate.memoizedState!==null&&d.alternate.memoizedState.cachePool!==null&&(y=d.alternate.memoizedState.cachePool.pool);var g=null;d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(g=d.memoizedState.cachePool.pool),g!==y&&(d.flags|=2048)}return a!==e&&a&&(t.child.flags|=8192),zl(t,t.updateQueue),ut(t),null;case 4:return re(),e===null&&wi(t.stateNode.containerInfo),ut(t),null;case 10:return Kn(t.type),ut(t),null;case 19:if(K(Nt),y=t.memoizedState,y===null)return ut(t),null;if(d=(t.flags&128)!==0,g=y.rendering,g===null)if(d)Cr(y,!1);else{if(yt!==0||e!==null&&(e.flags&128)!==0)for(e=t.child;e!==null;){if(g=Pl(e),g!==null){for(t.flags|=128,Cr(y,!1),e=g.updateQueue,t.updateQueue=e,zl(t,e),t.subtreeFlags=0,e=a,a=t.child;a!==null;)nu(a,e),a=a.sibling;return U(Nt,Nt.current&1|2),t.child}e=e.sibling}y.tail!==null&&Be()>Wl&&(t.flags|=128,d=!0,Cr(y,!1),t.lanes=4194304)}else{if(!d)if(e=Pl(g),e!==null){if(t.flags|=128,d=!0,e=e.updateQueue,t.updateQueue=e,zl(t,e),Cr(y,!0),y.tail===null&&y.tailMode==="hidden"&&!g.alternate&&!Qe)return ut(t),null}else 2*Be()-y.renderingStartTime>Wl&&a!==536870912&&(t.flags|=128,d=!0,Cr(y,!1),t.lanes=4194304);y.isBackwards?(g.sibling=t.child,t.child=g):(e=y.last,e!==null?e.sibling=g:t.child=g,y.last=g)}return y.tail!==null?(t=y.tail,y.rendering=t,y.tail=t.sibling,y.renderingStartTime=Be(),t.sibling=null,e=Nt.current,U(Nt,d?e&1|2:e&1),t):(ut(t),null);case 22:case 23:return eo(t),Cs(),d=t.memoizedState!==null,e!==null?e.memoizedState!==null!==d&&(t.flags|=8192):d&&(t.flags|=8192),d?(a&536870912)!==0&&(t.flags&128)===0&&(ut(t),t.subtreeFlags&6&&(t.flags|=8192)):ut(t),a=t.updateQueue,a!==null&&zl(t,a.retryQueue),a=null,e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(a=e.memoizedState.cachePool.pool),d=null,t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(d=t.memoizedState.cachePool.pool),d!==a&&(t.flags|=2048),e!==null&&K(Ko),null;case 24:return a=null,e!==null&&(a=e.memoizedState.cache),t.memoizedState.cache!==a&&(t.flags|=2048),Kn(Tt),ut(t),null;case 25:return null;case 30:return null}throw Error(i(156,t.tag))}function H_(e,t){switch(ss(t),t.tag){case 1:return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return Kn(Tt),re(),e=t.flags,(e&65536)!==0&&(e&128)===0?(t.flags=e&-65537|128,t):null;case 26:case 27:case 5:return we(t),null;case 13:if(eo(t),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(i(340));lr()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return K(Nt),null;case 4:return re(),null;case 10:return Kn(t.type),null;case 22:case 23:return eo(t),Cs(),e!==null&&K(Ko),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 24:return Kn(Tt),null;case 25:return null;default:return null}}function kp(e,t){switch(ss(t),t.tag){case 3:Kn(Tt),re();break;case 26:case 27:case 5:we(t);break;case 4:re();break;case 13:eo(t);break;case 19:K(Nt);break;case 10:Kn(t.type);break;case 22:case 23:eo(t),Cs(),e!==null&&K(Ko);break;case 24:Kn(Tt)}}function Sr(e,t){try{var a=t.updateQueue,d=a!==null?a.lastEffect:null;if(d!==null){var y=d.next;a=y;do{if((a.tag&e)===e){d=void 0;var g=a.create,b=a.inst;d=g(),b.destroy=d}a=a.next}while(a!==y)}}catch(R){nt(t,t.return,R)}}function So(e,t,a){try{var d=t.updateQueue,y=d!==null?d.lastEffect:null;if(y!==null){var g=y.next;d=g;do{if((d.tag&e)===e){var b=d.inst,R=b.destroy;if(R!==void 0){b.destroy=void 0,y=t;var $=a,J=R;try{J()}catch(de){nt(y,$,de)}}}d=d.next}while(d!==g)}}catch(de){nt(t,t.return,de)}}function Dp(e){var t=e.updateQueue;if(t!==null){var a=e.stateNode;try{mu(t,a)}catch(d){nt(e,e.return,d)}}}function Tp(e,t,a){a.props=ea(e.type,e.memoizedProps),a.state=e.memoizedState;try{a.componentWillUnmount()}catch(d){nt(e,t,d)}}function br(e,t){try{var a=e.ref;if(a!==null){switch(e.tag){case 26:case 27:case 5:var d=e.stateNode;break;case 30:d=e.stateNode;break;default:d=e.stateNode}typeof a=="function"?e.refCleanup=a(d):a.current=d}}catch(y){nt(e,t,y)}}function Pn(e,t){var a=e.ref,d=e.refCleanup;if(a!==null)if(typeof d=="function")try{d()}catch(y){nt(e,t,y)}finally{e.refCleanup=null,e=e.alternate,e!=null&&(e.refCleanup=null)}else if(typeof a=="function")try{a(null)}catch(y){nt(e,t,y)}else a.current=null}function Np(e){var t=e.type,a=e.memoizedProps,d=e.stateNode;try{e:switch(t){case"button":case"input":case"select":case"textarea":a.autoFocus&&d.focus();break e;case"img":a.src?d.src=a.src:a.srcSet&&(d.srcset=a.srcSet)}}catch(y){nt(e,e.return,y)}}function Xs(e,t,a){try{var d=e.stateNode;im(d,e.type,a,t),d[Mt]=t}catch(y){nt(e,e.return,y)}}function Fp(e){return e.tag===5||e.tag===3||e.tag===26||e.tag===27&&To(e.type)||e.tag===4}function Zs(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||Fp(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.tag===27&&To(e.type)||e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Ks(e,t,a){var d=e.tag;if(d===5||d===6)e=e.stateNode,t?(a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a).insertBefore(e,t):(t=a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a,t.appendChild(e),a=a._reactRootContainer,a!=null||t.onclick!==null||(t.onclick=oc));else if(d!==4&&(d===27&&To(e.type)&&(a=e.stateNode,t=null),e=e.child,e!==null))for(Ks(e,t,a),e=e.sibling;e!==null;)Ks(e,t,a),e=e.sibling}function Gl(e,t,a){var d=e.tag;if(d===5||d===6)e=e.stateNode,t?a.insertBefore(e,t):a.appendChild(e);else if(d!==4&&(d===27&&To(e.type)&&(a=e.stateNode),e=e.child,e!==null))for(Gl(e,t,a),e=e.sibling;e!==null;)Gl(e,t,a),e=e.sibling}function qp(e){var t=e.stateNode,a=e.memoizedProps;try{for(var d=e.type,y=t.attributes;y.length;)t.removeAttributeNode(y[0]);Vt(t,d,a),t[kt]=e,t[Mt]=a}catch(g){nt(e,e.return,g)}}var oo=!1,xt=!1,Js=!1,Up=typeof WeakSet=="function"?WeakSet:Set,Ot=null;function V_(e,t){if(e=e.containerInfo,Si=dc,e=Gd(e),Zc(e)){if("selectionStart"in e)var a={start:e.selectionStart,end:e.selectionEnd};else e:{a=(a=e.ownerDocument)&&a.defaultView||window;var d=a.getSelection&&a.getSelection();if(d&&d.rangeCount!==0){a=d.anchorNode;var y=d.anchorOffset,g=d.focusNode;d=d.focusOffset;try{a.nodeType,g.nodeType}catch{a=null;break e}var b=0,R=-1,$=-1,J=0,de=0,pe=e,oe=null;t:for(;;){for(var ae;pe!==a||y!==0&&pe.nodeType!==3||(R=b+y),pe!==g||d!==0&&pe.nodeType!==3||($=b+d),pe.nodeType===3&&(b+=pe.nodeValue.length),(ae=pe.firstChild)!==null;)oe=pe,pe=ae;for(;;){if(pe===e)break t;if(oe===a&&++J===y&&(R=b),oe===g&&++de===d&&($=b),(ae=pe.nextSibling)!==null)break;pe=oe,oe=pe.parentNode}pe=ae}a=R===-1||$===-1?null:{start:R,end:$}}else a=null}a=a||{start:0,end:0}}else a=null;for(bi={focusedElem:e,selectionRange:a},dc=!1,Ot=t;Ot!==null;)if(t=Ot,e=t.child,(t.subtreeFlags&1024)!==0&&e!==null)e.return=t,Ot=e;else for(;Ot!==null;){switch(t=Ot,g=t.alternate,e=t.flags,t.tag){case 0:break;case 11:case 15:break;case 1:if((e&1024)!==0&&g!==null){e=void 0,a=t,y=g.memoizedProps,g=g.memoizedState,d=a.stateNode;try{var Ne=ea(a.type,y,a.elementType===a.type);e=d.getSnapshotBeforeUpdate(Ne,g),d.__reactInternalSnapshotBeforeUpdate=e}catch(ke){nt(a,a.return,ke)}}break;case 3:if((e&1024)!==0){if(e=t.stateNode.containerInfo,a=e.nodeType,a===9)Ri(e);else if(a===1)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":Ri(e);break;default:e.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((e&1024)!==0)throw Error(i(163))}if(e=t.sibling,e!==null){e.return=t.return,Ot=e;break}Ot=t.return}}function Op(e,t,a){var d=a.flags;switch(a.tag){case 0:case 11:case 15:bo(e,a),d&4&&Sr(5,a);break;case 1:if(bo(e,a),d&4)if(e=a.stateNode,t===null)try{e.componentDidMount()}catch(b){nt(a,a.return,b)}else{var y=ea(a.type,t.memoizedProps);t=t.memoizedState;try{e.componentDidUpdate(y,t,e.__reactInternalSnapshotBeforeUpdate)}catch(b){nt(a,a.return,b)}}d&64&&Dp(a),d&512&&br(a,a.return);break;case 3:if(bo(e,a),d&64&&(e=a.updateQueue,e!==null)){if(t=null,a.child!==null)switch(a.child.tag){case 27:case 5:t=a.child.stateNode;break;case 1:t=a.child.stateNode}try{mu(e,t)}catch(b){nt(a,a.return,b)}}break;case 27:t===null&&d&4&&qp(a);case 26:case 5:bo(e,a),t===null&&d&4&&Np(a),d&512&&br(a,a.return);break;case 12:bo(e,a);break;case 13:bo(e,a),d&4&&Mp(e,a),d&64&&(e=a.memoizedState,e!==null&&(e=e.dehydrated,e!==null&&(a=K_.bind(null,a),_m(e,a))));break;case 22:if(d=a.memoizedState!==null||oo,!d){t=t!==null&&t.memoizedState!==null||xt,y=oo;var g=xt;oo=d,(xt=t)&&!g?Eo(e,a,(a.subtreeFlags&8772)!==0):bo(e,a),oo=y,xt=g}break;case 30:break;default:bo(e,a)}}function $p(e){var t=e.alternate;t!==null&&(e.alternate=null,$p(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&Zt(t)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var st=null,tn=!1;function ao(e,t,a){for(a=a.child;a!==null;)Lp(e,t,a),a=a.sibling}function Lp(e,t,a){if(bt&&typeof bt.onCommitFiberUnmount=="function")try{bt.onCommitFiberUnmount(ct,a)}catch{}switch(a.tag){case 26:xt||Pn(a,t),ao(e,t,a),a.memoizedState?a.memoizedState.count--:a.stateNode&&(a=a.stateNode,a.parentNode.removeChild(a));break;case 27:xt||Pn(a,t);var d=st,y=tn;To(a.type)&&(st=a.stateNode,tn=!1),ao(e,t,a),Fr(a.stateNode),st=d,tn=y;break;case 5:xt||Pn(a,t);case 6:if(d=st,y=tn,st=null,ao(e,t,a),st=d,tn=y,st!==null)if(tn)try{(st.nodeType===9?st.body:st.nodeName==="HTML"?st.ownerDocument.body:st).removeChild(a.stateNode)}catch(g){nt(a,t,g)}else try{st.removeChild(a.stateNode)}catch(g){nt(a,t,g)}break;case 18:st!==null&&(tn?(e=st,Rf(e.nodeType===9?e.body:e.nodeName==="HTML"?e.ownerDocument.body:e,a.stateNode),Ir(e)):Rf(st,a.stateNode));break;case 4:d=st,y=tn,st=a.stateNode.containerInfo,tn=!0,ao(e,t,a),st=d,tn=y;break;case 0:case 11:case 14:case 15:xt||So(2,a,t),xt||So(4,a,t),ao(e,t,a);break;case 1:xt||(Pn(a,t),d=a.stateNode,typeof d.componentWillUnmount=="function"&&Tp(a,t,d)),ao(e,t,a);break;case 21:ao(e,t,a);break;case 22:xt=(d=xt)||a.memoizedState!==null,ao(e,t,a),xt=d;break;default:ao(e,t,a)}}function Mp(e,t){if(t.memoizedState===null&&(e=t.alternate,e!==null&&(e=e.memoizedState,e!==null&&(e=e.dehydrated,e!==null))))try{Ir(e)}catch(a){nt(t,t.return,a)}}function B_(e){switch(e.tag){case 13:case 19:var t=e.stateNode;return t===null&&(t=e.stateNode=new Up),t;case 22:return e=e.stateNode,t=e._retryCache,t===null&&(t=e._retryCache=new Up),t;default:throw Error(i(435,e.tag))}}function ei(e,t){var a=B_(e);t.forEach(function(d){var y=J_.bind(null,e,d);a.has(d)||(a.add(d),d.then(y,y))})}function pn(e,t){var a=t.deletions;if(a!==null)for(var d=0;d<a.length;d++){var y=a[d],g=e,b=t,R=b;e:for(;R!==null;){switch(R.tag){case 27:if(To(R.type)){st=R.stateNode,tn=!1;break e}break;case 5:st=R.stateNode,tn=!1;break e;case 3:case 4:st=R.stateNode.containerInfo,tn=!0;break e}R=R.return}if(st===null)throw Error(i(160));Lp(g,b,y),st=null,tn=!1,g=y.alternate,g!==null&&(g.return=null),y.return=null}if(t.subtreeFlags&13878)for(t=t.child;t!==null;)Pp(t,e),t=t.sibling}var qn=null;function Pp(e,t){var a=e.alternate,d=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:pn(t,e),fn(e),d&4&&(So(3,e,e.return),Sr(3,e),So(5,e,e.return));break;case 1:pn(t,e),fn(e),d&512&&(xt||a===null||Pn(a,a.return)),d&64&&oo&&(e=e.updateQueue,e!==null&&(d=e.callbacks,d!==null&&(a=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=a===null?d:a.concat(d))));break;case 26:var y=qn;if(pn(t,e),fn(e),d&512&&(xt||a===null||Pn(a,a.return)),d&4){var g=a!==null?a.memoizedState:null;if(d=e.memoizedState,a===null)if(d===null)if(e.stateNode===null){e:{d=e.type,a=e.memoizedProps,y=y.ownerDocument||y;t:switch(d){case"title":g=y.getElementsByTagName("title")[0],(!g||g[Qt]||g[kt]||g.namespaceURI==="http://www.w3.org/2000/svg"||g.hasAttribute("itemprop"))&&(g=y.createElement(d),y.head.insertBefore(g,y.querySelector("head > title"))),Vt(g,d,a),g[kt]=e,Dt(g),d=g;break e;case"link":var b=Uf("link","href",y).get(d+(a.href||""));if(b){for(var R=0;R<b.length;R++)if(g=b[R],g.getAttribute("href")===(a.href==null||a.href===""?null:a.href)&&g.getAttribute("rel")===(a.rel==null?null:a.rel)&&g.getAttribute("title")===(a.title==null?null:a.title)&&g.getAttribute("crossorigin")===(a.crossOrigin==null?null:a.crossOrigin)){b.splice(R,1);break t}}g=y.createElement(d),Vt(g,d,a),y.head.appendChild(g);break;case"meta":if(b=Uf("meta","content",y).get(d+(a.content||""))){for(R=0;R<b.length;R++)if(g=b[R],g.getAttribute("content")===(a.content==null?null:""+a.content)&&g.getAttribute("name")===(a.name==null?null:a.name)&&g.getAttribute("property")===(a.property==null?null:a.property)&&g.getAttribute("http-equiv")===(a.httpEquiv==null?null:a.httpEquiv)&&g.getAttribute("charset")===(a.charSet==null?null:a.charSet)){b.splice(R,1);break t}}g=y.createElement(d),Vt(g,d,a),y.head.appendChild(g);break;default:throw Error(i(468,d))}g[kt]=e,Dt(g),d=g}e.stateNode=d}else Of(y,e.type,e.stateNode);else e.stateNode=qf(y,d,e.memoizedProps);else g!==d?(g===null?a.stateNode!==null&&(a=a.stateNode,a.parentNode.removeChild(a)):g.count--,d===null?Of(y,e.type,e.stateNode):qf(y,d,e.memoizedProps)):d===null&&e.stateNode!==null&&Xs(e,e.memoizedProps,a.memoizedProps)}break;case 27:pn(t,e),fn(e),d&512&&(xt||a===null||Pn(a,a.return)),a!==null&&d&4&&Xs(e,e.memoizedProps,a.memoizedProps);break;case 5:if(pn(t,e),fn(e),d&512&&(xt||a===null||Pn(a,a.return)),e.flags&32){y=e.stateNode;try{ua(y,"")}catch(ae){nt(e,e.return,ae)}}d&4&&e.stateNode!=null&&(y=e.memoizedProps,Xs(e,y,a!==null?a.memoizedProps:y)),d&1024&&(Js=!0);break;case 6:if(pn(t,e),fn(e),d&4){if(e.stateNode===null)throw Error(i(162));d=e.memoizedProps,a=e.stateNode;try{a.nodeValue=d}catch(ae){nt(e,e.return,ae)}}break;case 3:if(cc=null,y=qn,qn=rc(t.containerInfo),pn(t,e),qn=y,fn(e),d&4&&a!==null&&a.memoizedState.isDehydrated)try{Ir(t.containerInfo)}catch(ae){nt(e,e.return,ae)}Js&&(Js=!1,Ip(e));break;case 4:d=qn,qn=rc(e.stateNode.containerInfo),pn(t,e),fn(e),qn=d;break;case 12:pn(t,e),fn(e);break;case 13:pn(t,e),fn(e),e.child.flags&8192&&e.memoizedState!==null!=(a!==null&&a.memoizedState!==null)&&(li=Be()),d&4&&(d=e.updateQueue,d!==null&&(e.updateQueue=null,ei(e,d)));break;case 22:y=e.memoizedState!==null;var $=a!==null&&a.memoizedState!==null,J=oo,de=xt;if(oo=J||y,xt=de||$,pn(t,e),xt=de,oo=J,fn(e),d&8192)e:for(t=e.stateNode,t._visibility=y?t._visibility&-2:t._visibility|1,y&&(a===null||$||oo||xt||ta(e)),a=null,t=e;;){if(t.tag===5||t.tag===26){if(a===null){$=a=t;try{if(g=$.stateNode,y)b=g.style,typeof b.setProperty=="function"?b.setProperty("display","none","important"):b.display="none";else{R=$.stateNode;var pe=$.memoizedProps.style,oe=pe!=null&&pe.hasOwnProperty("display")?pe.display:null;R.style.display=oe==null||typeof oe=="boolean"?"":(""+oe).trim()}}catch(ae){nt($,$.return,ae)}}}else if(t.tag===6){if(a===null){$=t;try{$.stateNode.nodeValue=y?"":$.memoizedProps}catch(ae){nt($,$.return,ae)}}}else if((t.tag!==22&&t.tag!==23||t.memoizedState===null||t===e)&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;a===t&&(a=null),t=t.return}a===t&&(a=null),t.sibling.return=t.return,t=t.sibling}d&4&&(d=e.updateQueue,d!==null&&(a=d.retryQueue,a!==null&&(d.retryQueue=null,ei(e,a))));break;case 19:pn(t,e),fn(e),d&4&&(d=e.updateQueue,d!==null&&(e.updateQueue=null,ei(e,d)));break;case 30:break;case 21:break;default:pn(t,e),fn(e)}}function fn(e){var t=e.flags;if(t&2){try{for(var a,d=e.return;d!==null;){if(Fp(d)){a=d;break}d=d.return}if(a==null)throw Error(i(160));switch(a.tag){case 27:var y=a.stateNode,g=Zs(e);Gl(e,g,y);break;case 5:var b=a.stateNode;a.flags&32&&(ua(b,""),a.flags&=-33);var R=Zs(e);Gl(e,R,b);break;case 3:case 4:var $=a.stateNode.containerInfo,J=Zs(e);Ks(e,J,$);break;default:throw Error(i(161))}}catch(de){nt(e,e.return,de)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function Ip(e){if(e.subtreeFlags&1024)for(e=e.child;e!==null;){var t=e;Ip(t),t.tag===5&&t.flags&1024&&t.stateNode.reset(),e=e.sibling}}function bo(e,t){if(t.subtreeFlags&8772)for(t=t.child;t!==null;)Op(e,t.alternate,t),t=t.sibling}function ta(e){for(e=e.child;e!==null;){var t=e;switch(t.tag){case 0:case 11:case 14:case 15:So(4,t,t.return),ta(t);break;case 1:Pn(t,t.return);var a=t.stateNode;typeof a.componentWillUnmount=="function"&&Tp(t,t.return,a),ta(t);break;case 27:Fr(t.stateNode);case 26:case 5:Pn(t,t.return),ta(t);break;case 22:t.memoizedState===null&&ta(t);break;case 30:ta(t);break;default:ta(t)}e=e.sibling}}function Eo(e,t,a){for(a=a&&(t.subtreeFlags&8772)!==0,t=t.child;t!==null;){var d=t.alternate,y=e,g=t,b=g.flags;switch(g.tag){case 0:case 11:case 15:Eo(y,g,a),Sr(4,g);break;case 1:if(Eo(y,g,a),d=g,y=d.stateNode,typeof y.componentDidMount=="function")try{y.componentDidMount()}catch(J){nt(d,d.return,J)}if(d=g,y=d.updateQueue,y!==null){var R=d.stateNode;try{var $=y.shared.hiddenCallbacks;if($!==null)for(y.shared.hiddenCallbacks=null,y=0;y<$.length;y++)_u($[y],R)}catch(J){nt(d,d.return,J)}}a&&b&64&&Dp(g),br(g,g.return);break;case 27:qp(g);case 26:case 5:Eo(y,g,a),a&&d===null&&b&4&&Np(g),br(g,g.return);break;case 12:Eo(y,g,a);break;case 13:Eo(y,g,a),a&&b&4&&Mp(y,g);break;case 22:g.memoizedState===null&&Eo(y,g,a),br(g,g.return);break;case 30:break;default:Eo(y,g,a)}t=t.sibling}}function ti(e,t){var a=null;e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(a=e.memoizedState.cachePool.pool),e=null,t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(e=t.memoizedState.cachePool.pool),e!==a&&(e!=null&&e.refCount++,a!=null&&ir(a))}function ni(e,t){e=null,t.alternate!==null&&(e=t.alternate.memoizedState.cache),t=t.memoizedState.cache,t!==e&&(t.refCount++,e!=null&&ir(e))}function In(e,t,a,d){if(t.subtreeFlags&10256)for(t=t.child;t!==null;)Hp(e,t,a,d),t=t.sibling}function Hp(e,t,a,d){var y=t.flags;switch(t.tag){case 0:case 11:case 15:In(e,t,a,d),y&2048&&Sr(9,t);break;case 1:In(e,t,a,d);break;case 3:In(e,t,a,d),y&2048&&(e=null,t.alternate!==null&&(e=t.alternate.memoizedState.cache),t=t.memoizedState.cache,t!==e&&(t.refCount++,e!=null&&ir(e)));break;case 12:if(y&2048){In(e,t,a,d),e=t.stateNode;try{var g=t.memoizedProps,b=g.id,R=g.onPostCommit;typeof R=="function"&&R(b,t.alternate===null?"mount":"update",e.passiveEffectDuration,-0)}catch($){nt(t,t.return,$)}}else In(e,t,a,d);break;case 13:In(e,t,a,d);break;case 23:break;case 22:g=t.stateNode,b=t.alternate,t.memoizedState!==null?g._visibility&2?In(e,t,a,d):Er(e,t):g._visibility&2?In(e,t,a,d):(g._visibility|=2,Da(e,t,a,d,(t.subtreeFlags&10256)!==0)),y&2048&&ti(b,t);break;case 24:In(e,t,a,d),y&2048&&ni(t.alternate,t);break;default:In(e,t,a,d)}}function Da(e,t,a,d,y){for(y=y&&(t.subtreeFlags&10256)!==0,t=t.child;t!==null;){var g=e,b=t,R=a,$=d,J=b.flags;switch(b.tag){case 0:case 11:case 15:Da(g,b,R,$,y),Sr(8,b);break;case 23:break;case 22:var de=b.stateNode;b.memoizedState!==null?de._visibility&2?Da(g,b,R,$,y):Er(g,b):(de._visibility|=2,Da(g,b,R,$,y)),y&&J&2048&&ti(b.alternate,b);break;case 24:Da(g,b,R,$,y),y&&J&2048&&ni(b.alternate,b);break;default:Da(g,b,R,$,y)}t=t.sibling}}function Er(e,t){if(t.subtreeFlags&10256)for(t=t.child;t!==null;){var a=e,d=t,y=d.flags;switch(d.tag){case 22:Er(a,d),y&2048&&ti(d.alternate,d);break;case 24:Er(a,d),y&2048&&ni(d.alternate,d);break;default:Er(a,d)}t=t.sibling}}var jr=8192;function Ta(e){if(e.subtreeFlags&jr)for(e=e.child;e!==null;)Vp(e),e=e.sibling}function Vp(e){switch(e.tag){case 26:Ta(e),e.flags&jr&&e.memoizedState!==null&&km(qn,e.memoizedState,e.memoizedProps);break;case 5:Ta(e);break;case 3:case 4:var t=qn;qn=rc(e.stateNode.containerInfo),Ta(e),qn=t;break;case 22:e.memoizedState===null&&(t=e.alternate,t!==null&&t.memoizedState!==null?(t=jr,jr=16777216,Ta(e),jr=t):Ta(e));break;default:Ta(e)}}function Bp(e){var t=e.alternate;if(t!==null&&(e=t.child,e!==null)){t.child=null;do t=e.sibling,e.sibling=null,e=t;while(e!==null)}}function Rr(e){var t=e.deletions;if((e.flags&16)!==0){if(t!==null)for(var a=0;a<t.length;a++){var d=t[a];Ot=d,Gp(d,e)}Bp(e)}if(e.subtreeFlags&10256)for(e=e.child;e!==null;)zp(e),e=e.sibling}function zp(e){switch(e.tag){case 0:case 11:case 15:Rr(e),e.flags&2048&&So(9,e,e.return);break;case 3:Rr(e);break;case 12:Rr(e);break;case 22:var t=e.stateNode;e.memoizedState!==null&&t._visibility&2&&(e.return===null||e.return.tag!==13)?(t._visibility&=-3,Yl(e)):Rr(e);break;default:Rr(e)}}function Yl(e){var t=e.deletions;if((e.flags&16)!==0){if(t!==null)for(var a=0;a<t.length;a++){var d=t[a];Ot=d,Gp(d,e)}Bp(e)}for(e=e.child;e!==null;){switch(t=e,t.tag){case 0:case 11:case 15:So(8,t,t.return),Yl(t);break;case 22:a=t.stateNode,a._visibility&2&&(a._visibility&=-3,Yl(t));break;default:Yl(t)}e=e.sibling}}function Gp(e,t){for(;Ot!==null;){var a=Ot;switch(a.tag){case 0:case 11:case 15:So(8,a,t);break;case 23:case 22:if(a.memoizedState!==null&&a.memoizedState.cachePool!==null){var d=a.memoizedState.cachePool.pool;d!=null&&d.refCount++}break;case 24:ir(a.memoizedState.cache)}if(d=a.child,d!==null)d.return=a,Ot=d;else e:for(a=e;Ot!==null;){d=Ot;var y=d.sibling,g=d.return;if($p(d),d===a){Ot=null;break e}if(y!==null){y.return=g,Ot=y;break e}Ot=g}}}var z_={getCacheForType:function(e){var t=Gt(Tt),a=t.data.get(e);return a===void 0&&(a=e(),t.data.set(e,a)),a}},G_=typeof WeakMap=="function"?WeakMap:Map,Ze=0,ot=null,Pe=null,Ve=0,Ke=0,hn=null,jo=!1,Na=!1,oi=!1,ro=0,yt=0,Ro=0,na=0,ai=0,Rn=0,Fa=0,Ar=null,nn=null,ri=!1,li=0,Wl=1/0,Ql=null,Ao=null,Ht=0,ko=null,qa=null,Ua=0,ci=0,si=null,Yp=null,kr=0,ii=null;function yn(){if((Ze&2)!==0&&Ve!==0)return Ve&-Ve;if(k.T!==null){var e=Ca;return e!==0?e:_i()}return ll()}function Wp(){Rn===0&&(Rn=(Ve&536870912)===0||Qe?tl():536870912);var e=jn.current;return e!==null&&(e.flags|=32),Rn}function _n(e,t,a){(e===ot&&(Ke===2||Ke===9)||e.cancelPendingCommit!==null)&&(Oa(e,0),Do(e,Ve,Rn,!1)),Io(e,a),((Ze&2)===0||e!==ot)&&(e===ot&&((Ze&2)===0&&(na|=a),yt===4&&Do(e,Ve,Rn,!1)),Hn(e))}function Qp(e,t,a){if((Ze&6)!==0)throw Error(i(327));var d=!a&&(t&124)===0&&(t&e.expiredLanes)===0||Bn(e,t),y=d?Q_(e,t):pi(e,t,!0),g=d;do{if(y===0){Na&&!d&&Do(e,t,0,!1);break}else{if(a=e.current.alternate,g&&!Y_(a)){y=pi(e,t,!1),g=!1;continue}if(y===2){if(g=t,e.errorRecoveryDisabledLanes&g)var b=0;else b=e.pendingLanes&-536870913,b=b!==0?b:b&536870912?536870912:0;if(b!==0){t=b;e:{var R=e;y=Ar;var $=R.current.memoizedState.isDehydrated;if($&&(Oa(R,b).flags|=256),b=pi(R,b,!1),b!==2){if(oi&&!$){R.errorRecoveryDisabledLanes|=g,na|=g,y=4;break e}g=nn,nn=y,g!==null&&(nn===null?nn=g:nn.push.apply(nn,g))}y=b}if(g=!1,y!==2)continue}}if(y===1){Oa(e,0),Do(e,t,0,!0);break}e:{switch(d=e,g=y,g){case 0:case 1:throw Error(i(345));case 4:if((t&4194048)!==t)break;case 6:Do(d,t,Rn,!jo);break e;case 2:nn=null;break;case 3:case 5:break;default:throw Error(i(329))}if((t&62914560)===t&&(y=li+300-Be(),10<y)){if(Do(d,t,Rn,!jo),vt(d,0,!0)!==0)break e;d.timeoutHandle=Ef(Xp.bind(null,d,a,nn,Ql,ri,t,Rn,na,Fa,jo,g,2,-0,0),y);break e}Xp(d,a,nn,Ql,ri,t,Rn,na,Fa,jo,g,0,-0,0)}}break}while(!0);Hn(e)}function Xp(e,t,a,d,y,g,b,R,$,J,de,pe,oe,ae){if(e.timeoutHandle=-1,pe=t.subtreeFlags,(pe&8192||(pe&16785408)===16785408)&&(Or={stylesheets:null,count:0,unsuspend:Am},Vp(t),pe=Dm(),pe!==null)){e.cancelPendingCommit=pe(of.bind(null,e,t,g,a,d,y,b,R,$,de,1,oe,ae)),Do(e,g,b,!J);return}of(e,t,g,a,d,y,b,R,$)}function Y_(e){for(var t=e;;){var a=t.tag;if((a===0||a===11||a===15)&&t.flags&16384&&(a=t.updateQueue,a!==null&&(a=a.stores,a!==null)))for(var d=0;d<a.length;d++){var y=a[d],g=y.getSnapshot;y=y.value;try{if(!dn(g(),y))return!1}catch{return!1}}if(a=t.child,t.subtreeFlags&16384&&a!==null)a.return=t,t=a;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Do(e,t,a,d){t&=~ai,t&=~na,e.suspendedLanes|=t,e.pingedLanes&=~t,d&&(e.warmLanes|=t),d=e.expirationTimes;for(var y=t;0<y;){var g=31-At(y),b=1<<g;d[g]=-1,y&=~b}a!==0&&al(e,a,t)}function Xl(){return(Ze&6)===0?(Dr(0),!1):!0}function di(){if(Pe!==null){if(Ke===0)var e=Pe.return;else e=Pe,Zn=Xo=null,Rs(e),Aa=null,wr=0,e=Pe;for(;e!==null;)kp(e.alternate,e),e=e.return;Pe=null}}function Oa(e,t){var a=e.timeoutHandle;a!==-1&&(e.timeoutHandle=-1,um(a)),a=e.cancelPendingCommit,a!==null&&(e.cancelPendingCommit=null,a()),di(),ot=e,Pe=a=Wn(e.current,null),Ve=t,Ke=0,hn=null,jo=!1,Na=Bn(e,t),oi=!1,Fa=Rn=ai=na=Ro=yt=0,nn=Ar=null,ri=!1,(t&8)!==0&&(t|=t&32);var d=e.entangledLanes;if(d!==0)for(e=e.entanglements,d&=t;0<d;){var y=31-At(d),g=1<<y;t|=e[y],d&=~g}return ro=t,gl(),a}function Zp(e,t){Oe=null,k.H=$l,t===ur||t===Rl?(t=hu(),Ke=3):t===uu?(t=hu(),Ke=4):Ke=t===yp?8:t!==null&&typeof t=="object"&&typeof t.then=="function"?6:1,hn=t,Pe===null&&(yt=1,Hl(e,Cn(t,e.current)))}function Kp(){var e=k.H;return k.H=$l,e===null?$l:e}function Jp(){var e=k.A;return k.A=z_,e}function ui(){yt=4,jo||(Ve&4194048)!==Ve&&jn.current!==null||(Na=!0),(Ro&134217727)===0&&(na&134217727)===0||ot===null||Do(ot,Ve,Rn,!1)}function pi(e,t,a){var d=Ze;Ze|=2;var y=Kp(),g=Jp();(ot!==e||Ve!==t)&&(Ql=null,Oa(e,t)),t=!1;var b=yt;e:do try{if(Ke!==0&&Pe!==null){var R=Pe,$=hn;switch(Ke){case 8:di(),b=6;break e;case 3:case 2:case 9:case 6:jn.current===null&&(t=!0);var J=Ke;if(Ke=0,hn=null,$a(e,R,$,J),a&&Na){b=0;break e}break;default:J=Ke,Ke=0,hn=null,$a(e,R,$,J)}}W_(),b=yt;break}catch(de){Zp(e,de)}while(!0);return t&&e.shellSuspendCounter++,Zn=Xo=null,Ze=d,k.H=y,k.A=g,Pe===null&&(ot=null,Ve=0,gl()),b}function W_(){for(;Pe!==null;)ef(Pe)}function Q_(e,t){var a=Ze;Ze|=2;var d=Kp(),y=Jp();ot!==e||Ve!==t?(Ql=null,Wl=Be()+500,Oa(e,t)):Na=Bn(e,t);e:do try{if(Ke!==0&&Pe!==null){t=Pe;var g=hn;t:switch(Ke){case 1:Ke=0,hn=null,$a(e,t,g,1);break;case 2:case 9:if(pu(g)){Ke=0,hn=null,tf(t);break}t=function(){Ke!==2&&Ke!==9||ot!==e||(Ke=7),Hn(e)},g.then(t,t);break e;case 3:Ke=7;break e;case 4:Ke=5;break e;case 7:pu(g)?(Ke=0,hn=null,tf(t)):(Ke=0,hn=null,$a(e,t,g,7));break;case 5:var b=null;switch(Pe.tag){case 26:b=Pe.memoizedState;case 5:case 27:var R=Pe;if(!b||$f(b)){Ke=0,hn=null;var $=R.sibling;if($!==null)Pe=$;else{var J=R.return;J!==null?(Pe=J,Zl(J)):Pe=null}break t}}Ke=0,hn=null,$a(e,t,g,5);break;case 6:Ke=0,hn=null,$a(e,t,g,6);break;case 8:di(),yt=6;break e;default:throw Error(i(462))}}X_();break}catch(de){Zp(e,de)}while(!0);return Zn=Xo=null,k.H=d,k.A=y,Ze=a,Pe!==null?0:(ot=null,Ve=0,gl(),yt)}function X_(){for(;Pe!==null&&!rt();)ef(Pe)}function ef(e){var t=Rp(e.alternate,e,ro);e.memoizedProps=e.pendingProps,t===null?Zl(e):Pe=t}function tf(e){var t=e,a=t.alternate;switch(t.tag){case 15:case 0:t=xp(a,t,t.pendingProps,t.type,void 0,Ve);break;case 11:t=xp(a,t,t.pendingProps,t.type.render,t.ref,Ve);break;case 5:Rs(t);default:kp(a,t),t=Pe=nu(t,ro),t=Rp(a,t,ro)}e.memoizedProps=e.pendingProps,t===null?Zl(e):Pe=t}function $a(e,t,a,d){Zn=Xo=null,Rs(t),Aa=null,wr=0;var y=t.return;try{if(M_(e,y,t,a,Ve)){yt=1,Hl(e,Cn(a,e.current)),Pe=null;return}}catch(g){if(y!==null)throw Pe=y,g;yt=1,Hl(e,Cn(a,e.current)),Pe=null;return}t.flags&32768?(Qe||d===1?e=!0:Na||(Ve&536870912)!==0?e=!1:(jo=e=!0,(d===2||d===9||d===3||d===6)&&(d=jn.current,d!==null&&d.tag===13&&(d.flags|=16384))),nf(t,e)):Zl(t)}function Zl(e){var t=e;do{if((t.flags&32768)!==0){nf(t,jo);return}e=t.return;var a=I_(t.alternate,t,ro);if(a!==null){Pe=a;return}if(t=t.sibling,t!==null){Pe=t;return}Pe=t=e}while(t!==null);yt===0&&(yt=5)}function nf(e,t){do{var a=H_(e.alternate,e);if(a!==null){a.flags&=32767,Pe=a;return}if(a=e.return,a!==null&&(a.flags|=32768,a.subtreeFlags=0,a.deletions=null),!t&&(e=e.sibling,e!==null)){Pe=e;return}Pe=e=a}while(e!==null);yt=6,Pe=null}function of(e,t,a,d,y,g,b,R,$){e.cancelPendingCommit=null;do Kl();while(Ht!==0);if((Ze&6)!==0)throw Error(i(327));if(t!==null){if(t===e.current)throw Error(i(177));if(g=t.lanes|t.childLanes,g|=ns,ol(e,a,g,b,R,$),e===ot&&(Pe=ot=null,Ve=0),qa=t,ko=e,Ua=a,ci=g,si=y,Yp=d,(t.subtreeFlags&10256)!==0||(t.flags&10256)!==0?(e.callbackNode=null,e.callbackPriority=0,em(je,function(){return sf(),null})):(e.callbackNode=null,e.callbackPriority=0),d=(t.flags&13878)!==0,(t.subtreeFlags&13878)!==0||d){d=k.T,k.T=null,y=W.p,W.p=2,b=Ze,Ze|=4;try{V_(e,t,a)}finally{Ze=b,W.p=y,k.T=d}}Ht=1,af(),rf(),lf()}}function af(){if(Ht===1){Ht=0;var e=ko,t=qa,a=(t.flags&13878)!==0;if((t.subtreeFlags&13878)!==0||a){a=k.T,k.T=null;var d=W.p;W.p=2;var y=Ze;Ze|=4;try{Pp(t,e);var g=bi,b=Gd(e.containerInfo),R=g.focusedElem,$=g.selectionRange;if(b!==R&&R&&R.ownerDocument&&zd(R.ownerDocument.documentElement,R)){if($!==null&&Zc(R)){var J=$.start,de=$.end;if(de===void 0&&(de=J),"selectionStart"in R)R.selectionStart=J,R.selectionEnd=Math.min(de,R.value.length);else{var pe=R.ownerDocument||document,oe=pe&&pe.defaultView||window;if(oe.getSelection){var ae=oe.getSelection(),Ne=R.textContent.length,ke=Math.min($.start,Ne),tt=$.end===void 0?ke:Math.min($.end,Ne);!ae.extend&&ke>tt&&(b=tt,tt=ke,ke=b);var Y=Bd(R,ke),I=Bd(R,tt);if(Y&&I&&(ae.rangeCount!==1||ae.anchorNode!==Y.node||ae.anchorOffset!==Y.offset||ae.focusNode!==I.node||ae.focusOffset!==I.offset)){var Z=pe.createRange();Z.setStart(Y.node,Y.offset),ae.removeAllRanges(),ke>tt?(ae.addRange(Z),ae.extend(I.node,I.offset)):(Z.setEnd(I.node,I.offset),ae.addRange(Z))}}}}for(pe=[],ae=R;ae=ae.parentNode;)ae.nodeType===1&&pe.push({element:ae,left:ae.scrollLeft,top:ae.scrollTop});for(typeof R.focus=="function"&&R.focus(),R=0;R<pe.length;R++){var ue=pe[R];ue.element.scrollLeft=ue.left,ue.element.scrollTop=ue.top}}dc=!!Si,bi=Si=null}finally{Ze=y,W.p=d,k.T=a}}e.current=t,Ht=2}}function rf(){if(Ht===2){Ht=0;var e=ko,t=qa,a=(t.flags&8772)!==0;if((t.subtreeFlags&8772)!==0||a){a=k.T,k.T=null;var d=W.p;W.p=2;var y=Ze;Ze|=4;try{Op(e,t.alternate,t)}finally{Ze=y,W.p=d,k.T=a}}Ht=3}}function lf(){if(Ht===4||Ht===3){Ht=0,ve();var e=ko,t=qa,a=Ua,d=Yp;(t.subtreeFlags&10256)!==0||(t.flags&10256)!==0?Ht=5:(Ht=0,qa=ko=null,cf(e,e.pendingLanes));var y=e.pendingLanes;if(y===0&&(Ao=null),Qa(a),t=t.stateNode,bt&&typeof bt.onCommitFiberRoot=="function")try{bt.onCommitFiberRoot(ct,t,void 0,(t.current.flags&128)===128)}catch{}if(d!==null){t=k.T,y=W.p,W.p=2,k.T=null;try{for(var g=e.onRecoverableError,b=0;b<d.length;b++){var R=d[b];g(R.value,{componentStack:R.stack})}}finally{k.T=t,W.p=y}}(Ua&3)!==0&&Kl(),Hn(e),y=e.pendingLanes,(a&4194090)!==0&&(y&42)!==0?e===ii?kr++:(kr=0,ii=e):kr=0,Dr(0)}}function cf(e,t){(e.pooledCacheLanes&=t)===0&&(t=e.pooledCache,t!=null&&(e.pooledCache=null,ir(t)))}function Kl(e){return af(),rf(),lf(),sf()}function sf(){if(Ht!==5)return!1;var e=ko,t=ci;ci=0;var a=Qa(Ua),d=k.T,y=W.p;try{W.p=32>a?32:a,k.T=null,a=si,si=null;var g=ko,b=Ua;if(Ht=0,qa=ko=null,Ua=0,(Ze&6)!==0)throw Error(i(331));var R=Ze;if(Ze|=4,zp(g.current),Hp(g,g.current,b,a),Ze=R,Dr(0,!1),bt&&typeof bt.onPostCommitFiberRoot=="function")try{bt.onPostCommitFiberRoot(ct,g)}catch{}return!0}finally{W.p=y,k.T=d,cf(e,t)}}function df(e,t,a){t=Cn(a,t),t=Is(e.stateNode,t,2),e=vo(e,t,2),e!==null&&(Io(e,2),Hn(e))}function nt(e,t,a){if(e.tag===3)df(e,e,a);else for(;t!==null;){if(t.tag===3){df(t,e,a);break}else if(t.tag===1){var d=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof d.componentDidCatch=="function"&&(Ao===null||!Ao.has(d))){e=Cn(a,e),a=fp(2),d=vo(t,a,2),d!==null&&(hp(a,d,t,e),Io(d,2),Hn(d));break}}t=t.return}}function fi(e,t,a){var d=e.pingCache;if(d===null){d=e.pingCache=new G_;var y=new Set;d.set(t,y)}else y=d.get(t),y===void 0&&(y=new Set,d.set(t,y));y.has(a)||(oi=!0,y.add(a),e=Z_.bind(null,e,t,a),t.then(e,e))}function Z_(e,t,a){var d=e.pingCache;d!==null&&d.delete(t),e.pingedLanes|=e.suspendedLanes&a,e.warmLanes&=~a,ot===e&&(Ve&a)===a&&(yt===4||yt===3&&(Ve&62914560)===Ve&&300>Be()-li?(Ze&2)===0&&Oa(e,0):ai|=a,Fa===Ve&&(Fa=0)),Hn(e)}function uf(e,t){t===0&&(t=nl()),e=ga(e,t),e!==null&&(Io(e,t),Hn(e))}function K_(e){var t=e.memoizedState,a=0;t!==null&&(a=t.retryLane),uf(e,a)}function J_(e,t){var a=0;switch(e.tag){case 13:var d=e.stateNode,y=e.memoizedState;y!==null&&(a=y.retryLane);break;case 19:d=e.stateNode;break;case 22:d=e.stateNode._retryCache;break;default:throw Error(i(314))}d!==null&&d.delete(t),uf(e,a)}function em(e,t){return xe(e,t)}var Jl=null,La=null,hi=!1,ec=!1,yi=!1,oa=0;function Hn(e){e!==La&&e.next===null&&(La===null?Jl=La=e:La=La.next=e),ec=!0,hi||(hi=!0,nm())}function Dr(e,t){if(!yi&&ec){yi=!0;do for(var a=!1,d=Jl;d!==null;){if(e!==0){var y=d.pendingLanes;if(y===0)var g=0;else{var b=d.suspendedLanes,R=d.pingedLanes;g=(1<<31-At(42|e)+1)-1,g&=y&~(b&~R),g=g&201326741?g&201326741|1:g?g|2:0}g!==0&&(a=!0,yf(d,g))}else g=Ve,g=vt(d,d===ot?g:0,d.cancelPendingCommit!==null||d.timeoutHandle!==-1),(g&3)===0||Bn(d,g)||(a=!0,yf(d,g));d=d.next}while(a);yi=!1}}function tm(){pf()}function pf(){ec=hi=!1;var e=0;oa!==0&&(dm()&&(e=oa),oa=0);for(var t=Be(),a=null,d=Jl;d!==null;){var y=d.next,g=ff(d,t);g===0?(d.next=null,a===null?Jl=y:a.next=y,y===null&&(La=a)):(a=d,(e!==0||(g&3)!==0)&&(ec=!0)),d=y}Dr(e)}function ff(e,t){for(var a=e.suspendedLanes,d=e.pingedLanes,y=e.expirationTimes,g=e.pendingLanes&-62914561;0<g;){var b=31-At(g),R=1<<b,$=y[b];$===-1?((R&a)===0||(R&d)!==0)&&(y[b]=Dc(R,t)):$<=t&&(e.expiredLanes|=R),g&=~R}if(t=ot,a=Ve,a=vt(e,e===t?a:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),d=e.callbackNode,a===0||e===t&&(Ke===2||Ke===9)||e.cancelPendingCommit!==null)return d!==null&&d!==null&&be(d),e.callbackNode=null,e.callbackPriority=0;if((a&3)===0||Bn(e,a)){if(t=a&-a,t===e.callbackPriority)return t;switch(d!==null&&be(d),Qa(a)){case 2:case 8:a=Rt;break;case 32:a=je;break;case 268435456:a=St;break;default:a=je}return d=hf.bind(null,e),a=xe(a,d),e.callbackPriority=t,e.callbackNode=a,t}return d!==null&&d!==null&&be(d),e.callbackPriority=2,e.callbackNode=null,2}function hf(e,t){if(Ht!==0&&Ht!==5)return e.callbackNode=null,e.callbackPriority=0,null;var a=e.callbackNode;if(Kl()&&e.callbackNode!==a)return null;var d=Ve;return d=vt(e,e===ot?d:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),d===0?null:(Qp(e,d,t),ff(e,Be()),e.callbackNode!=null&&e.callbackNode===a?hf.bind(null,e):null)}function yf(e,t){if(Kl())return null;Qp(e,t,!0)}function nm(){pm(function(){(Ze&6)!==0?xe(ft,tm):pf()})}function _i(){return oa===0&&(oa=tl()),oa}function _f(e){return e==null||typeof e=="symbol"||typeof e=="boolean"?null:typeof e=="function"?e:ul(""+e)}function mf(e,t){var a=t.ownerDocument.createElement("input");return a.name=t.name,a.value=t.value,e.id&&a.setAttribute("form",e.id),t.parentNode.insertBefore(a,t),e=new FormData(e),a.parentNode.removeChild(a),e}function om(e,t,a,d,y){if(t==="submit"&&a&&a.stateNode===y){var g=_f((y[Mt]||null).action),b=d.submitter;b&&(t=(t=b[Mt]||null)?_f(t.formAction):b.getAttribute("formAction"),t!==null&&(g=t,b=null));var R=new yl("action","action",null,d,y);e.push({event:R,listeners:[{instance:null,listener:function(){if(d.defaultPrevented){if(oa!==0){var $=b?mf(y,b):new FormData(y);Os(a,{pending:!0,data:$,method:y.method,action:g},null,$)}}else typeof g=="function"&&(R.preventDefault(),$=b?mf(y,b):new FormData(y),Os(a,{pending:!0,data:$,method:y.method,action:g},g,$))},currentTarget:y}]})}}for(var mi=0;mi<ts.length;mi++){var gi=ts[mi],am=gi.toLowerCase(),rm=gi[0].toUpperCase()+gi.slice(1);Fn(am,"on"+rm)}Fn(Qd,"onAnimationEnd"),Fn(Xd,"onAnimationIteration"),Fn(Zd,"onAnimationStart"),Fn("dblclick","onDoubleClick"),Fn("focusin","onFocus"),Fn("focusout","onBlur"),Fn(C_,"onTransitionRun"),Fn(S_,"onTransitionStart"),Fn(b_,"onTransitionCancel"),Fn(Kd,"onTransitionEnd"),fo("onMouseEnter",["mouseout","mouseover"]),fo("onMouseLeave",["mouseout","mouseover"]),fo("onPointerEnter",["pointerout","pointerover"]),fo("onPointerLeave",["pointerout","pointerover"]),zn("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),zn("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),zn("onBeforeInput",["compositionend","keypress","textInput","paste"]),zn("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),zn("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),zn("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Tr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),lm=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Tr));function gf(e,t){t=(t&4)!==0;for(var a=0;a<e.length;a++){var d=e[a],y=d.event;d=d.listeners;e:{var g=void 0;if(t)for(var b=d.length-1;0<=b;b--){var R=d[b],$=R.instance,J=R.currentTarget;if(R=R.listener,$!==g&&y.isPropagationStopped())break e;g=R,y.currentTarget=J;try{g(y)}catch(de){Il(de)}y.currentTarget=null,g=$}else for(b=0;b<d.length;b++){if(R=d[b],$=R.instance,J=R.currentTarget,R=R.listener,$!==g&&y.isPropagationStopped())break e;g=R,y.currentTarget=J;try{g(y)}catch(de){Il(de)}y.currentTarget=null,g=$}}}}function Ie(e,t){var a=t[Ce];a===void 0&&(a=t[Ce]=new Set);var d=e+"__bubble";a.has(d)||(vf(t,e,2,!1),a.add(d))}function vi(e,t,a){var d=0;t&&(d|=4),vf(a,e,d,t)}var tc="_reactListening"+Math.random().toString(36).slice(2);function wi(e){if(!e[tc]){e[tc]=!0,sn.forEach(function(a){a!=="selectionchange"&&(lm.has(a)||vi(a,!1,e),vi(a,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[tc]||(t[tc]=!0,vi("selectionchange",!1,t))}}function vf(e,t,a,d){switch(Vf(t)){case 2:var y=Fm;break;case 8:y=qm;break;default:y=qi}a=y.bind(null,t,a,e),y=void 0,!Hc||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(y=!0),d?y!==void 0?e.addEventListener(t,a,{capture:!0,passive:y}):e.addEventListener(t,a,!0):y!==void 0?e.addEventListener(t,a,{passive:y}):e.addEventListener(t,a,!1)}function xi(e,t,a,d,y){var g=d;if((t&1)===0&&(t&2)===0&&d!==null)e:for(;;){if(d===null)return;var b=d.tag;if(b===3||b===4){var R=d.stateNode.containerInfo;if(R===y)break;if(b===4)for(b=d.return;b!==null;){var $=b.tag;if(($===3||$===4)&&b.stateNode.containerInfo===y)return;b=b.return}for(;R!==null;){if(b=Kt(R),b===null)return;if($=b.tag,$===5||$===6||$===26||$===27){d=g=b;continue e}R=R.parentNode}}d=d.return}Ed(function(){var J=g,de=Pc(a),pe=[];e:{var oe=Jd.get(e);if(oe!==void 0){var ae=yl,Ne=e;switch(e){case"keypress":if(fl(a)===0)break e;case"keydown":case"keyup":ae=e_;break;case"focusin":Ne="focus",ae=Gc;break;case"focusout":Ne="blur",ae=Gc;break;case"beforeblur":case"afterblur":ae=Gc;break;case"click":if(a.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ae=Ad;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ae=Hy;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ae=o_;break;case Qd:case Xd:case Zd:ae=zy;break;case Kd:ae=r_;break;case"scroll":case"scrollend":ae=Py;break;case"wheel":ae=c_;break;case"copy":case"cut":case"paste":ae=Yy;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ae=Dd;break;case"toggle":case"beforetoggle":ae=i_}var ke=(t&4)!==0,tt=!ke&&(e==="scroll"||e==="scrollend"),Y=ke?oe!==null?oe+"Capture":null:oe;ke=[];for(var I=J,Z;I!==null;){var ue=I;if(Z=ue.stateNode,ue=ue.tag,ue!==5&&ue!==26&&ue!==27||Z===null||Y===null||(ue=Xa(I,Y),ue!=null&&ke.push(Nr(I,ue,Z))),tt)break;I=I.return}0<ke.length&&(oe=new ae(oe,Ne,null,a,de),pe.push({event:oe,listeners:ke}))}}if((t&7)===0){e:{if(oe=e==="mouseover"||e==="pointerover",ae=e==="mouseout"||e==="pointerout",oe&&a!==Mc&&(Ne=a.relatedTarget||a.fromElement)&&(Kt(Ne)||Ne[_e]))break e;if((ae||oe)&&(oe=de.window===de?de:(oe=de.ownerDocument)?oe.defaultView||oe.parentWindow:window,ae?(Ne=a.relatedTarget||a.toElement,ae=J,Ne=Ne?Kt(Ne):null,Ne!==null&&(tt=l(Ne),ke=Ne.tag,Ne!==tt||ke!==5&&ke!==27&&ke!==6)&&(Ne=null)):(ae=null,Ne=J),ae!==Ne)){if(ke=Ad,ue="onMouseLeave",Y="onMouseEnter",I="mouse",(e==="pointerout"||e==="pointerover")&&(ke=Dd,ue="onPointerLeave",Y="onPointerEnter",I="pointer"),tt=ae==null?oe:cn(ae),Z=Ne==null?oe:cn(Ne),oe=new ke(ue,I+"leave",ae,a,de),oe.target=tt,oe.relatedTarget=Z,ue=null,Kt(de)===J&&(ke=new ke(Y,I+"enter",Ne,a,de),ke.target=Z,ke.relatedTarget=tt,ue=ke),tt=ue,ae&&Ne)t:{for(ke=ae,Y=Ne,I=0,Z=ke;Z;Z=Ma(Z))I++;for(Z=0,ue=Y;ue;ue=Ma(ue))Z++;for(;0<I-Z;)ke=Ma(ke),I--;for(;0<Z-I;)Y=Ma(Y),Z--;for(;I--;){if(ke===Y||Y!==null&&ke===Y.alternate)break t;ke=Ma(ke),Y=Ma(Y)}ke=null}else ke=null;ae!==null&&wf(pe,oe,ae,ke,!1),Ne!==null&&tt!==null&&wf(pe,tt,Ne,ke,!0)}}e:{if(oe=J?cn(J):window,ae=oe.nodeName&&oe.nodeName.toLowerCase(),ae==="select"||ae==="input"&&oe.type==="file")var Se=Ld;else if(Od(oe))if(Md)Se=v_;else{Se=m_;var $e=__}else ae=oe.nodeName,!ae||ae.toLowerCase()!=="input"||oe.type!=="checkbox"&&oe.type!=="radio"?J&&Lc(J.elementType)&&(Se=Ld):Se=g_;if(Se&&(Se=Se(e,J))){$d(pe,Se,a,de);break e}$e&&$e(e,oe,J),e==="focusout"&&J&&oe.type==="number"&&J.memoizedProps.value!=null&&$c(oe,"number",oe.value)}switch($e=J?cn(J):window,e){case"focusin":(Od($e)||$e.contentEditable==="true")&&(ya=$e,Kc=J,ar=null);break;case"focusout":ar=Kc=ya=null;break;case"mousedown":Jc=!0;break;case"contextmenu":case"mouseup":case"dragend":Jc=!1,Yd(pe,a,de);break;case"selectionchange":if(x_)break;case"keydown":case"keyup":Yd(pe,a,de)}var Re;if(Wc)e:{switch(e){case"compositionstart":var De="onCompositionStart";break e;case"compositionend":De="onCompositionEnd";break e;case"compositionupdate":De="onCompositionUpdate";break e}De=void 0}else ha?qd(e,a)&&(De="onCompositionEnd"):e==="keydown"&&a.keyCode===229&&(De="onCompositionStart");De&&(Td&&a.locale!=="ko"&&(ha||De!=="onCompositionStart"?De==="onCompositionEnd"&&ha&&(Re=jd()):(yo=de,Vc="value"in yo?yo.value:yo.textContent,ha=!0)),$e=nc(J,De),0<$e.length&&(De=new kd(De,e,null,a,de),pe.push({event:De,listeners:$e}),Re?De.data=Re:(Re=Ud(a),Re!==null&&(De.data=Re)))),(Re=u_?p_(e,a):f_(e,a))&&(De=nc(J,"onBeforeInput"),0<De.length&&($e=new kd("onBeforeInput","beforeinput",null,a,de),pe.push({event:$e,listeners:De}),$e.data=Re)),om(pe,e,J,a,de)}gf(pe,t)})}function Nr(e,t,a){return{instance:e,listener:t,currentTarget:a}}function nc(e,t){for(var a=t+"Capture",d=[];e!==null;){var y=e,g=y.stateNode;if(y=y.tag,y!==5&&y!==26&&y!==27||g===null||(y=Xa(e,a),y!=null&&d.unshift(Nr(e,y,g)),y=Xa(e,t),y!=null&&d.push(Nr(e,y,g))),e.tag===3)return d;e=e.return}return[]}function Ma(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5&&e.tag!==27);return e||null}function wf(e,t,a,d,y){for(var g=t._reactName,b=[];a!==null&&a!==d;){var R=a,$=R.alternate,J=R.stateNode;if(R=R.tag,$!==null&&$===d)break;R!==5&&R!==26&&R!==27||J===null||($=J,y?(J=Xa(a,g),J!=null&&b.unshift(Nr(a,J,$))):y||(J=Xa(a,g),J!=null&&b.push(Nr(a,J,$)))),a=a.return}b.length!==0&&e.push({event:t,listeners:b})}var cm=/\r\n?/g,sm=/\u0000|\uFFFD/g;function xf(e){return(typeof e=="string"?e:""+e).replace(cm,`
`).replace(sm,"")}function Cf(e,t){return t=xf(t),xf(e)===t}function oc(){}function et(e,t,a,d,y,g){switch(a){case"children":typeof d=="string"?t==="body"||t==="textarea"&&d===""||ua(e,d):(typeof d=="number"||typeof d=="bigint")&&t!=="body"&&ua(e,""+d);break;case"className":sl(e,"class",d);break;case"tabIndex":sl(e,"tabindex",d);break;case"dir":case"role":case"viewBox":case"width":case"height":sl(e,a,d);break;case"style":Sd(e,d,g);break;case"data":if(t!=="object"){sl(e,"data",d);break}case"src":case"href":if(d===""&&(t!=="a"||a!=="href")){e.removeAttribute(a);break}if(d==null||typeof d=="function"||typeof d=="symbol"||typeof d=="boolean"){e.removeAttribute(a);break}d=ul(""+d),e.setAttribute(a,d);break;case"action":case"formAction":if(typeof d=="function"){e.setAttribute(a,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof g=="function"&&(a==="formAction"?(t!=="input"&&et(e,t,"name",y.name,y,null),et(e,t,"formEncType",y.formEncType,y,null),et(e,t,"formMethod",y.formMethod,y,null),et(e,t,"formTarget",y.formTarget,y,null)):(et(e,t,"encType",y.encType,y,null),et(e,t,"method",y.method,y,null),et(e,t,"target",y.target,y,null)));if(d==null||typeof d=="symbol"||typeof d=="boolean"){e.removeAttribute(a);break}d=ul(""+d),e.setAttribute(a,d);break;case"onClick":d!=null&&(e.onclick=oc);break;case"onScroll":d!=null&&Ie("scroll",e);break;case"onScrollEnd":d!=null&&Ie("scrollend",e);break;case"dangerouslySetInnerHTML":if(d!=null){if(typeof d!="object"||!("__html"in d))throw Error(i(61));if(a=d.__html,a!=null){if(y.children!=null)throw Error(i(60));e.innerHTML=a}}break;case"multiple":e.multiple=d&&typeof d!="function"&&typeof d!="symbol";break;case"muted":e.muted=d&&typeof d!="function"&&typeof d!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(d==null||typeof d=="function"||typeof d=="boolean"||typeof d=="symbol"){e.removeAttribute("xlink:href");break}a=ul(""+d),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",a);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":d!=null&&typeof d!="function"&&typeof d!="symbol"?e.setAttribute(a,""+d):e.removeAttribute(a);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":d&&typeof d!="function"&&typeof d!="symbol"?e.setAttribute(a,""):e.removeAttribute(a);break;case"capture":case"download":d===!0?e.setAttribute(a,""):d!==!1&&d!=null&&typeof d!="function"&&typeof d!="symbol"?e.setAttribute(a,d):e.removeAttribute(a);break;case"cols":case"rows":case"size":case"span":d!=null&&typeof d!="function"&&typeof d!="symbol"&&!isNaN(d)&&1<=d?e.setAttribute(a,d):e.removeAttribute(a);break;case"rowSpan":case"start":d==null||typeof d=="function"||typeof d=="symbol"||isNaN(d)?e.removeAttribute(a):e.setAttribute(a,d);break;case"popover":Ie("beforetoggle",e),Ie("toggle",e),ho(e,"popover",d);break;case"xlinkActuate":Gn(e,"http://www.w3.org/1999/xlink","xlink:actuate",d);break;case"xlinkArcrole":Gn(e,"http://www.w3.org/1999/xlink","xlink:arcrole",d);break;case"xlinkRole":Gn(e,"http://www.w3.org/1999/xlink","xlink:role",d);break;case"xlinkShow":Gn(e,"http://www.w3.org/1999/xlink","xlink:show",d);break;case"xlinkTitle":Gn(e,"http://www.w3.org/1999/xlink","xlink:title",d);break;case"xlinkType":Gn(e,"http://www.w3.org/1999/xlink","xlink:type",d);break;case"xmlBase":Gn(e,"http://www.w3.org/XML/1998/namespace","xml:base",d);break;case"xmlLang":Gn(e,"http://www.w3.org/XML/1998/namespace","xml:lang",d);break;case"xmlSpace":Gn(e,"http://www.w3.org/XML/1998/namespace","xml:space",d);break;case"is":ho(e,"is",d);break;case"innerText":case"textContent":break;default:(!(2<a.length)||a[0]!=="o"&&a[0]!=="O"||a[1]!=="n"&&a[1]!=="N")&&(a=Ly.get(a)||a,ho(e,a,d))}}function Ci(e,t,a,d,y,g){switch(a){case"style":Sd(e,d,g);break;case"dangerouslySetInnerHTML":if(d!=null){if(typeof d!="object"||!("__html"in d))throw Error(i(61));if(a=d.__html,a!=null){if(y.children!=null)throw Error(i(60));e.innerHTML=a}}break;case"children":typeof d=="string"?ua(e,d):(typeof d=="number"||typeof d=="bigint")&&ua(e,""+d);break;case"onScroll":d!=null&&Ie("scroll",e);break;case"onScrollEnd":d!=null&&Ie("scrollend",e);break;case"onClick":d!=null&&(e.onclick=oc);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!cl.hasOwnProperty(a))e:{if(a[0]==="o"&&a[1]==="n"&&(y=a.endsWith("Capture"),t=a.slice(2,y?a.length-7:void 0),g=e[Mt]||null,g=g!=null?g[a]:null,typeof g=="function"&&e.removeEventListener(t,g,y),typeof d=="function")){typeof g!="function"&&g!==null&&(a in e?e[a]=null:e.hasAttribute(a)&&e.removeAttribute(a)),e.addEventListener(t,d,y);break e}a in e?e[a]=d:d===!0?e.setAttribute(a,""):ho(e,a,d)}}}function Vt(e,t,a){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Ie("error",e),Ie("load",e);var d=!1,y=!1,g;for(g in a)if(a.hasOwnProperty(g)){var b=a[g];if(b!=null)switch(g){case"src":d=!0;break;case"srcSet":y=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(i(137,t));default:et(e,t,g,b,a,null)}}y&&et(e,t,"srcSet",a.srcSet,a,null),d&&et(e,t,"src",a.src,a,null);return;case"input":Ie("invalid",e);var R=g=b=y=null,$=null,J=null;for(d in a)if(a.hasOwnProperty(d)){var de=a[d];if(de!=null)switch(d){case"name":y=de;break;case"type":b=de;break;case"checked":$=de;break;case"defaultChecked":J=de;break;case"value":g=de;break;case"defaultValue":R=de;break;case"children":case"dangerouslySetInnerHTML":if(de!=null)throw Error(i(137,t));break;default:et(e,t,d,de,a,null)}}vd(e,g,R,$,J,b,y,!1),il(e);return;case"select":Ie("invalid",e),d=b=g=null;for(y in a)if(a.hasOwnProperty(y)&&(R=a[y],R!=null))switch(y){case"value":g=R;break;case"defaultValue":b=R;break;case"multiple":d=R;default:et(e,t,y,R,a,null)}t=g,a=b,e.multiple=!!d,t!=null?da(e,!!d,t,!1):a!=null&&da(e,!!d,a,!0);return;case"textarea":Ie("invalid",e),g=y=d=null;for(b in a)if(a.hasOwnProperty(b)&&(R=a[b],R!=null))switch(b){case"value":d=R;break;case"defaultValue":y=R;break;case"children":g=R;break;case"dangerouslySetInnerHTML":if(R!=null)throw Error(i(91));break;default:et(e,t,b,R,a,null)}xd(e,d,y,g),il(e);return;case"option":for($ in a)if(a.hasOwnProperty($)&&(d=a[$],d!=null))switch($){case"selected":e.selected=d&&typeof d!="function"&&typeof d!="symbol";break;default:et(e,t,$,d,a,null)}return;case"dialog":Ie("beforetoggle",e),Ie("toggle",e),Ie("cancel",e),Ie("close",e);break;case"iframe":case"object":Ie("load",e);break;case"video":case"audio":for(d=0;d<Tr.length;d++)Ie(Tr[d],e);break;case"image":Ie("error",e),Ie("load",e);break;case"details":Ie("toggle",e);break;case"embed":case"source":case"link":Ie("error",e),Ie("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(J in a)if(a.hasOwnProperty(J)&&(d=a[J],d!=null))switch(J){case"children":case"dangerouslySetInnerHTML":throw Error(i(137,t));default:et(e,t,J,d,a,null)}return;default:if(Lc(t)){for(de in a)a.hasOwnProperty(de)&&(d=a[de],d!==void 0&&Ci(e,t,de,d,a,void 0));return}}for(R in a)a.hasOwnProperty(R)&&(d=a[R],d!=null&&et(e,t,R,d,a,null))}function im(e,t,a,d){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var y=null,g=null,b=null,R=null,$=null,J=null,de=null;for(ae in a){var pe=a[ae];if(a.hasOwnProperty(ae)&&pe!=null)switch(ae){case"checked":break;case"value":break;case"defaultValue":$=pe;default:d.hasOwnProperty(ae)||et(e,t,ae,null,d,pe)}}for(var oe in d){var ae=d[oe];if(pe=a[oe],d.hasOwnProperty(oe)&&(ae!=null||pe!=null))switch(oe){case"type":g=ae;break;case"name":y=ae;break;case"checked":J=ae;break;case"defaultChecked":de=ae;break;case"value":b=ae;break;case"defaultValue":R=ae;break;case"children":case"dangerouslySetInnerHTML":if(ae!=null)throw Error(i(137,t));break;default:ae!==pe&&et(e,t,oe,ae,d,pe)}}Oc(e,b,R,$,J,de,g,y);return;case"select":ae=b=R=oe=null;for(g in a)if($=a[g],a.hasOwnProperty(g)&&$!=null)switch(g){case"value":break;case"multiple":ae=$;default:d.hasOwnProperty(g)||et(e,t,g,null,d,$)}for(y in d)if(g=d[y],$=a[y],d.hasOwnProperty(y)&&(g!=null||$!=null))switch(y){case"value":oe=g;break;case"defaultValue":R=g;break;case"multiple":b=g;default:g!==$&&et(e,t,y,g,d,$)}t=R,a=b,d=ae,oe!=null?da(e,!!a,oe,!1):!!d!=!!a&&(t!=null?da(e,!!a,t,!0):da(e,!!a,a?[]:"",!1));return;case"textarea":ae=oe=null;for(R in a)if(y=a[R],a.hasOwnProperty(R)&&y!=null&&!d.hasOwnProperty(R))switch(R){case"value":break;case"children":break;default:et(e,t,R,null,d,y)}for(b in d)if(y=d[b],g=a[b],d.hasOwnProperty(b)&&(y!=null||g!=null))switch(b){case"value":oe=y;break;case"defaultValue":ae=y;break;case"children":break;case"dangerouslySetInnerHTML":if(y!=null)throw Error(i(91));break;default:y!==g&&et(e,t,b,y,d,g)}wd(e,oe,ae);return;case"option":for(var Ne in a)if(oe=a[Ne],a.hasOwnProperty(Ne)&&oe!=null&&!d.hasOwnProperty(Ne))switch(Ne){case"selected":e.selected=!1;break;default:et(e,t,Ne,null,d,oe)}for($ in d)if(oe=d[$],ae=a[$],d.hasOwnProperty($)&&oe!==ae&&(oe!=null||ae!=null))switch($){case"selected":e.selected=oe&&typeof oe!="function"&&typeof oe!="symbol";break;default:et(e,t,$,oe,d,ae)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var ke in a)oe=a[ke],a.hasOwnProperty(ke)&&oe!=null&&!d.hasOwnProperty(ke)&&et(e,t,ke,null,d,oe);for(J in d)if(oe=d[J],ae=a[J],d.hasOwnProperty(J)&&oe!==ae&&(oe!=null||ae!=null))switch(J){case"children":case"dangerouslySetInnerHTML":if(oe!=null)throw Error(i(137,t));break;default:et(e,t,J,oe,d,ae)}return;default:if(Lc(t)){for(var tt in a)oe=a[tt],a.hasOwnProperty(tt)&&oe!==void 0&&!d.hasOwnProperty(tt)&&Ci(e,t,tt,void 0,d,oe);for(de in d)oe=d[de],ae=a[de],!d.hasOwnProperty(de)||oe===ae||oe===void 0&&ae===void 0||Ci(e,t,de,oe,d,ae);return}}for(var Y in a)oe=a[Y],a.hasOwnProperty(Y)&&oe!=null&&!d.hasOwnProperty(Y)&&et(e,t,Y,null,d,oe);for(pe in d)oe=d[pe],ae=a[pe],!d.hasOwnProperty(pe)||oe===ae||oe==null&&ae==null||et(e,t,pe,oe,d,ae)}var Si=null,bi=null;function ac(e){return e.nodeType===9?e:e.ownerDocument}function Sf(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function bf(e,t){if(e===0)switch(t){case"svg":return 1;case"math":return 2;default:return 0}return e===1&&t==="foreignObject"?0:e}function Ei(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.children=="bigint"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var ji=null;function dm(){var e=window.event;return e&&e.type==="popstate"?e===ji?!1:(ji=e,!0):(ji=null,!1)}var Ef=typeof setTimeout=="function"?setTimeout:void 0,um=typeof clearTimeout=="function"?clearTimeout:void 0,jf=typeof Promise=="function"?Promise:void 0,pm=typeof queueMicrotask=="function"?queueMicrotask:typeof jf<"u"?function(e){return jf.resolve(null).then(e).catch(fm)}:Ef;function fm(e){setTimeout(function(){throw e})}function To(e){return e==="head"}function Rf(e,t){var a=t,d=0,y=0;do{var g=a.nextSibling;if(e.removeChild(a),g&&g.nodeType===8)if(a=g.data,a==="/$"){if(0<d&&8>d){a=d;var b=e.ownerDocument;if(a&1&&Fr(b.documentElement),a&2&&Fr(b.body),a&4)for(a=b.head,Fr(a),b=a.firstChild;b;){var R=b.nextSibling,$=b.nodeName;b[Qt]||$==="SCRIPT"||$==="STYLE"||$==="LINK"&&b.rel.toLowerCase()==="stylesheet"||a.removeChild(b),b=R}}if(y===0){e.removeChild(g),Ir(t);return}y--}else a==="$"||a==="$?"||a==="$!"?y++:d=a.charCodeAt(0)-48;else d=0;a=g}while(a);Ir(t)}function Ri(e){var t=e.firstChild;for(t&&t.nodeType===10&&(t=t.nextSibling);t;){var a=t;switch(t=t.nextSibling,a.nodeName){case"HTML":case"HEAD":case"BODY":Ri(a),Zt(a);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(a.rel.toLowerCase()==="stylesheet")continue}e.removeChild(a)}}function hm(e,t,a,d){for(;e.nodeType===1;){var y=a;if(e.nodeName.toLowerCase()!==t.toLowerCase()){if(!d&&(e.nodeName!=="INPUT"||e.type!=="hidden"))break}else if(d){if(!e[Qt])switch(t){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if(g=e.getAttribute("rel"),g==="stylesheet"&&e.hasAttribute("data-precedence"))break;if(g!==y.rel||e.getAttribute("href")!==(y.href==null||y.href===""?null:y.href)||e.getAttribute("crossorigin")!==(y.crossOrigin==null?null:y.crossOrigin)||e.getAttribute("title")!==(y.title==null?null:y.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(g=e.getAttribute("src"),(g!==(y.src==null?null:y.src)||e.getAttribute("type")!==(y.type==null?null:y.type)||e.getAttribute("crossorigin")!==(y.crossOrigin==null?null:y.crossOrigin))&&g&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else if(t==="input"&&e.type==="hidden"){var g=y.name==null?null:""+y.name;if(y.type==="hidden"&&e.getAttribute("name")===g)return e}else return e;if(e=Un(e.nextSibling),e===null)break}return null}function ym(e,t,a){if(t==="")return null;for(;e.nodeType!==3;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!a||(e=Un(e.nextSibling),e===null))return null;return e}function Ai(e){return e.data==="$!"||e.data==="$?"&&e.ownerDocument.readyState==="complete"}function _m(e,t){var a=e.ownerDocument;if(e.data!=="$?"||a.readyState==="complete")t();else{var d=function(){t(),a.removeEventListener("DOMContentLoaded",d)};a.addEventListener("DOMContentLoaded",d),e._reactRetry=d}}function Un(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?"||t==="F!"||t==="F")break;if(t==="/$")return null}}return e}var ki=null;function Af(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var a=e.data;if(a==="$"||a==="$!"||a==="$?"){if(t===0)return e;t--}else a==="/$"&&t++}e=e.previousSibling}return null}function kf(e,t,a){switch(t=ac(a),e){case"html":if(e=t.documentElement,!e)throw Error(i(452));return e;case"head":if(e=t.head,!e)throw Error(i(453));return e;case"body":if(e=t.body,!e)throw Error(i(454));return e;default:throw Error(i(451))}}function Fr(e){for(var t=e.attributes;t.length;)e.removeAttributeNode(t[0]);Zt(e)}var An=new Map,Df=new Set;function rc(e){return typeof e.getRootNode=="function"?e.getRootNode():e.nodeType===9?e:e.ownerDocument}var lo=W.d;W.d={f:mm,r:gm,D:vm,C:wm,L:xm,m:Cm,X:bm,S:Sm,M:Em};function mm(){var e=lo.f(),t=Xl();return e||t}function gm(e){var t=Nn(e);t!==null&&t.tag===5&&t.type==="form"?Qu(t):lo.r(e)}var Pa=typeof document>"u"?null:document;function Tf(e,t,a){var d=Pa;if(d&&typeof t=="string"&&t){var y=xn(t);y='link[rel="'+e+'"][href="'+y+'"]',typeof a=="string"&&(y+='[crossorigin="'+a+'"]'),Df.has(y)||(Df.add(y),e={rel:e,crossOrigin:a,href:t},d.querySelector(y)===null&&(t=d.createElement("link"),Vt(t,"link",e),Dt(t),d.head.appendChild(t)))}}function vm(e){lo.D(e),Tf("dns-prefetch",e,null)}function wm(e,t){lo.C(e,t),Tf("preconnect",e,t)}function xm(e,t,a){lo.L(e,t,a);var d=Pa;if(d&&e&&t){var y='link[rel="preload"][as="'+xn(t)+'"]';t==="image"&&a&&a.imageSrcSet?(y+='[imagesrcset="'+xn(a.imageSrcSet)+'"]',typeof a.imageSizes=="string"&&(y+='[imagesizes="'+xn(a.imageSizes)+'"]')):y+='[href="'+xn(e)+'"]';var g=y;switch(t){case"style":g=Ia(e);break;case"script":g=Ha(e)}An.has(g)||(e=_({rel:"preload",href:t==="image"&&a&&a.imageSrcSet?void 0:e,as:t},a),An.set(g,e),d.querySelector(y)!==null||t==="style"&&d.querySelector(qr(g))||t==="script"&&d.querySelector(Ur(g))||(t=d.createElement("link"),Vt(t,"link",e),Dt(t),d.head.appendChild(t)))}}function Cm(e,t){lo.m(e,t);var a=Pa;if(a&&e){var d=t&&typeof t.as=="string"?t.as:"script",y='link[rel="modulepreload"][as="'+xn(d)+'"][href="'+xn(e)+'"]',g=y;switch(d){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":g=Ha(e)}if(!An.has(g)&&(e=_({rel:"modulepreload",href:e},t),An.set(g,e),a.querySelector(y)===null)){switch(d){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(a.querySelector(Ur(g)))return}d=a.createElement("link"),Vt(d,"link",e),Dt(d),a.head.appendChild(d)}}}function Sm(e,t,a){lo.S(e,t,a);var d=Pa;if(d&&e){var y=po(d).hoistableStyles,g=Ia(e);t=t||"default";var b=y.get(g);if(!b){var R={loading:0,preload:null};if(b=d.querySelector(qr(g)))R.loading=5;else{e=_({rel:"stylesheet",href:e,"data-precedence":t},a),(a=An.get(g))&&Di(e,a);var $=b=d.createElement("link");Dt($),Vt($,"link",e),$._p=new Promise(function(J,de){$.onload=J,$.onerror=de}),$.addEventListener("load",function(){R.loading|=1}),$.addEventListener("error",function(){R.loading|=2}),R.loading|=4,lc(b,t,d)}b={type:"stylesheet",instance:b,count:1,state:R},y.set(g,b)}}}function bm(e,t){lo.X(e,t);var a=Pa;if(a&&e){var d=po(a).hoistableScripts,y=Ha(e),g=d.get(y);g||(g=a.querySelector(Ur(y)),g||(e=_({src:e,async:!0},t),(t=An.get(y))&&Ti(e,t),g=a.createElement("script"),Dt(g),Vt(g,"link",e),a.head.appendChild(g)),g={type:"script",instance:g,count:1,state:null},d.set(y,g))}}function Em(e,t){lo.M(e,t);var a=Pa;if(a&&e){var d=po(a).hoistableScripts,y=Ha(e),g=d.get(y);g||(g=a.querySelector(Ur(y)),g||(e=_({src:e,async:!0,type:"module"},t),(t=An.get(y))&&Ti(e,t),g=a.createElement("script"),Dt(g),Vt(g,"link",e),a.head.appendChild(g)),g={type:"script",instance:g,count:1,state:null},d.set(y,g))}}function Nf(e,t,a,d){var y=(y=fe.current)?rc(y):null;if(!y)throw Error(i(446));switch(e){case"meta":case"title":return null;case"style":return typeof a.precedence=="string"&&typeof a.href=="string"?(t=Ia(a.href),a=po(y).hoistableStyles,d=a.get(t),d||(d={type:"style",instance:null,count:0,state:null},a.set(t,d)),d):{type:"void",instance:null,count:0,state:null};case"link":if(a.rel==="stylesheet"&&typeof a.href=="string"&&typeof a.precedence=="string"){e=Ia(a.href);var g=po(y).hoistableStyles,b=g.get(e);if(b||(y=y.ownerDocument||y,b={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},g.set(e,b),(g=y.querySelector(qr(e)))&&!g._p&&(b.instance=g,b.state.loading=5),An.has(e)||(a={rel:"preload",as:"style",href:a.href,crossOrigin:a.crossOrigin,integrity:a.integrity,media:a.media,hrefLang:a.hrefLang,referrerPolicy:a.referrerPolicy},An.set(e,a),g||jm(y,e,a,b.state))),t&&d===null)throw Error(i(528,""));return b}if(t&&d!==null)throw Error(i(529,""));return null;case"script":return t=a.async,a=a.src,typeof a=="string"&&t&&typeof t!="function"&&typeof t!="symbol"?(t=Ha(a),a=po(y).hoistableScripts,d=a.get(t),d||(d={type:"script",instance:null,count:0,state:null},a.set(t,d)),d):{type:"void",instance:null,count:0,state:null};default:throw Error(i(444,e))}}function Ia(e){return'href="'+xn(e)+'"'}function qr(e){return'link[rel="stylesheet"]['+e+"]"}function Ff(e){return _({},e,{"data-precedence":e.precedence,precedence:null})}function jm(e,t,a,d){e.querySelector('link[rel="preload"][as="style"]['+t+"]")?d.loading=1:(t=e.createElement("link"),d.preload=t,t.addEventListener("load",function(){return d.loading|=1}),t.addEventListener("error",function(){return d.loading|=2}),Vt(t,"link",a),Dt(t),e.head.appendChild(t))}function Ha(e){return'[src="'+xn(e)+'"]'}function Ur(e){return"script[async]"+e}function qf(e,t,a){if(t.count++,t.instance===null)switch(t.type){case"style":var d=e.querySelector('style[data-href~="'+xn(a.href)+'"]');if(d)return t.instance=d,Dt(d),d;var y=_({},a,{"data-href":a.href,"data-precedence":a.precedence,href:null,precedence:null});return d=(e.ownerDocument||e).createElement("style"),Dt(d),Vt(d,"style",y),lc(d,a.precedence,e),t.instance=d;case"stylesheet":y=Ia(a.href);var g=e.querySelector(qr(y));if(g)return t.state.loading|=4,t.instance=g,Dt(g),g;d=Ff(a),(y=An.get(y))&&Di(d,y),g=(e.ownerDocument||e).createElement("link"),Dt(g);var b=g;return b._p=new Promise(function(R,$){b.onload=R,b.onerror=$}),Vt(g,"link",d),t.state.loading|=4,lc(g,a.precedence,e),t.instance=g;case"script":return g=Ha(a.src),(y=e.querySelector(Ur(g)))?(t.instance=y,Dt(y),y):(d=a,(y=An.get(g))&&(d=_({},a),Ti(d,y)),e=e.ownerDocument||e,y=e.createElement("script"),Dt(y),Vt(y,"link",d),e.head.appendChild(y),t.instance=y);case"void":return null;default:throw Error(i(443,t.type))}else t.type==="stylesheet"&&(t.state.loading&4)===0&&(d=t.instance,t.state.loading|=4,lc(d,a.precedence,e));return t.instance}function lc(e,t,a){for(var d=a.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),y=d.length?d[d.length-1]:null,g=y,b=0;b<d.length;b++){var R=d[b];if(R.dataset.precedence===t)g=R;else if(g!==y)break}g?g.parentNode.insertBefore(e,g.nextSibling):(t=a.nodeType===9?a.head:a,t.insertBefore(e,t.firstChild))}function Di(e,t){e.crossOrigin==null&&(e.crossOrigin=t.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=t.referrerPolicy),e.title==null&&(e.title=t.title)}function Ti(e,t){e.crossOrigin==null&&(e.crossOrigin=t.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=t.referrerPolicy),e.integrity==null&&(e.integrity=t.integrity)}var cc=null;function Uf(e,t,a){if(cc===null){var d=new Map,y=cc=new Map;y.set(a,d)}else y=cc,d=y.get(a),d||(d=new Map,y.set(a,d));if(d.has(e))return d;for(d.set(e,null),a=a.getElementsByTagName(e),y=0;y<a.length;y++){var g=a[y];if(!(g[Qt]||g[kt]||e==="link"&&g.getAttribute("rel")==="stylesheet")&&g.namespaceURI!=="http://www.w3.org/2000/svg"){var b=g.getAttribute(t)||"";b=e+b;var R=d.get(b);R?R.push(g):d.set(b,[g])}}return d}function Of(e,t,a){e=e.ownerDocument||e,e.head.insertBefore(a,t==="title"?e.querySelector("head > title"):null)}function Rm(e,t,a){if(a===1||t.itemProp!=null)return!1;switch(e){case"meta":case"title":return!0;case"style":if(typeof t.precedence!="string"||typeof t.href!="string"||t.href==="")break;return!0;case"link":if(typeof t.rel!="string"||typeof t.href!="string"||t.href===""||t.onLoad||t.onError)break;switch(t.rel){case"stylesheet":return e=t.disabled,typeof t.precedence=="string"&&e==null;default:return!0}case"script":if(t.async&&typeof t.async!="function"&&typeof t.async!="symbol"&&!t.onLoad&&!t.onError&&t.src&&typeof t.src=="string")return!0}return!1}function $f(e){return!(e.type==="stylesheet"&&(e.state.loading&3)===0)}var Or=null;function Am(){}function km(e,t,a){if(Or===null)throw Error(i(475));var d=Or;if(t.type==="stylesheet"&&(typeof a.media!="string"||matchMedia(a.media).matches!==!1)&&(t.state.loading&4)===0){if(t.instance===null){var y=Ia(a.href),g=e.querySelector(qr(y));if(g){e=g._p,e!==null&&typeof e=="object"&&typeof e.then=="function"&&(d.count++,d=sc.bind(d),e.then(d,d)),t.state.loading|=4,t.instance=g,Dt(g);return}g=e.ownerDocument||e,a=Ff(a),(y=An.get(y))&&Di(a,y),g=g.createElement("link"),Dt(g);var b=g;b._p=new Promise(function(R,$){b.onload=R,b.onerror=$}),Vt(g,"link",a),t.instance=g}d.stylesheets===null&&(d.stylesheets=new Map),d.stylesheets.set(t,e),(e=t.state.preload)&&(t.state.loading&3)===0&&(d.count++,t=sc.bind(d),e.addEventListener("load",t),e.addEventListener("error",t))}}function Dm(){if(Or===null)throw Error(i(475));var e=Or;return e.stylesheets&&e.count===0&&Ni(e,e.stylesheets),0<e.count?function(t){var a=setTimeout(function(){if(e.stylesheets&&Ni(e,e.stylesheets),e.unsuspend){var d=e.unsuspend;e.unsuspend=null,d()}},6e4);return e.unsuspend=t,function(){e.unsuspend=null,clearTimeout(a)}}:null}function sc(){if(this.count--,this.count===0){if(this.stylesheets)Ni(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}}var ic=null;function Ni(e,t){e.stylesheets=null,e.unsuspend!==null&&(e.count++,ic=new Map,t.forEach(Tm,e),ic=null,sc.call(e))}function Tm(e,t){if(!(t.state.loading&4)){var a=ic.get(e);if(a)var d=a.get(null);else{a=new Map,ic.set(e,a);for(var y=e.querySelectorAll("link[data-precedence],style[data-precedence]"),g=0;g<y.length;g++){var b=y[g];(b.nodeName==="LINK"||b.getAttribute("media")!=="not all")&&(a.set(b.dataset.precedence,b),d=b)}d&&a.set(null,d)}y=t.instance,b=y.getAttribute("data-precedence"),g=a.get(b)||d,g===d&&a.set(null,y),a.set(b,y),this.count++,d=sc.bind(this),y.addEventListener("load",d),y.addEventListener("error",d),g?g.parentNode.insertBefore(y,g.nextSibling):(e=e.nodeType===9?e.head:e,e.insertBefore(y,e.firstChild)),t.state.loading|=4}}var $r={$$typeof:D,Provider:null,Consumer:null,_currentValue:ee,_currentValue2:ee,_threadCount:0};function Nm(e,t,a,d,y,g,b,R){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Ya(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ya(0),this.hiddenUpdates=Ya(null),this.identifierPrefix=d,this.onUncaughtError=y,this.onCaughtError=g,this.onRecoverableError=b,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=R,this.incompleteTransitions=new Map}function Lf(e,t,a,d,y,g,b,R,$,J,de,pe){return e=new Nm(e,t,a,b,R,$,J,pe),t=1,g===!0&&(t|=24),g=un(3,null,null,t),e.current=g,g.stateNode=e,t=fs(),t.refCount++,e.pooledCache=t,t.refCount++,g.memoizedState={element:d,isDehydrated:a,cache:t},ms(g),e}function Mf(e){return e?(e=va,e):va}function Pf(e,t,a,d,y,g){y=Mf(y),d.context===null?d.context=y:d.pendingContext=y,d=go(t),d.payload={element:a},g=g===void 0?null:g,g!==null&&(d.callback=g),a=vo(e,d,t),a!==null&&(_n(a,e,t),fr(a,e,t))}function If(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var a=e.retryLane;e.retryLane=a!==0&&a<t?a:t}}function Fi(e,t){If(e,t),(e=e.alternate)&&If(e,t)}function Hf(e){if(e.tag===13){var t=ga(e,67108864);t!==null&&_n(t,e,67108864),Fi(e,67108864)}}var dc=!0;function Fm(e,t,a,d){var y=k.T;k.T=null;var g=W.p;try{W.p=2,qi(e,t,a,d)}finally{W.p=g,k.T=y}}function qm(e,t,a,d){var y=k.T;k.T=null;var g=W.p;try{W.p=8,qi(e,t,a,d)}finally{W.p=g,k.T=y}}function qi(e,t,a,d){if(dc){var y=Ui(d);if(y===null)xi(e,t,d,uc,a),Bf(e,d);else if(Om(y,e,t,a,d))d.stopPropagation();else if(Bf(e,d),t&4&&-1<Um.indexOf(e)){for(;y!==null;){var g=Nn(y);if(g!==null)switch(g.tag){case 3:if(g=g.stateNode,g.current.memoizedState.isDehydrated){var b=Xe(g.pendingLanes);if(b!==0){var R=g;for(R.pendingLanes|=2,R.entangledLanes|=2;b;){var $=1<<31-At(b);R.entanglements[1]|=$,b&=~$}Hn(g),(Ze&6)===0&&(Wl=Be()+500,Dr(0))}}break;case 13:R=ga(g,2),R!==null&&_n(R,g,2),Xl(),Fi(g,2)}if(g=Ui(d),g===null&&xi(e,t,d,uc,a),g===y)break;y=g}y!==null&&d.stopPropagation()}else xi(e,t,d,null,a)}}function Ui(e){return e=Pc(e),Oi(e)}var uc=null;function Oi(e){if(uc=null,e=Kt(e),e!==null){var t=l(e);if(t===null)e=null;else{var a=t.tag;if(a===13){if(e=s(t),e!==null)return e;e=null}else if(a===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null)}}return uc=e,null}function Vf(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(gt()){case ft:return 2;case Rt:return 8;case je:case lt:return 32;case St:return 268435456;default:return 32}default:return 32}}var $i=!1,No=null,Fo=null,qo=null,Lr=new Map,Mr=new Map,Uo=[],Um="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Bf(e,t){switch(e){case"focusin":case"focusout":No=null;break;case"dragenter":case"dragleave":Fo=null;break;case"mouseover":case"mouseout":qo=null;break;case"pointerover":case"pointerout":Lr.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Mr.delete(t.pointerId)}}function Pr(e,t,a,d,y,g){return e===null||e.nativeEvent!==g?(e={blockedOn:t,domEventName:a,eventSystemFlags:d,nativeEvent:g,targetContainers:[y]},t!==null&&(t=Nn(t),t!==null&&Hf(t)),e):(e.eventSystemFlags|=d,t=e.targetContainers,y!==null&&t.indexOf(y)===-1&&t.push(y),e)}function Om(e,t,a,d,y){switch(t){case"focusin":return No=Pr(No,e,t,a,d,y),!0;case"dragenter":return Fo=Pr(Fo,e,t,a,d,y),!0;case"mouseover":return qo=Pr(qo,e,t,a,d,y),!0;case"pointerover":var g=y.pointerId;return Lr.set(g,Pr(Lr.get(g)||null,e,t,a,d,y)),!0;case"gotpointercapture":return g=y.pointerId,Mr.set(g,Pr(Mr.get(g)||null,e,t,a,d,y)),!0}return!1}function zf(e){var t=Kt(e.target);if(t!==null){var a=l(t);if(a!==null){if(t=a.tag,t===13){if(t=s(a),t!==null){e.blockedOn=t,Tc(e.priority,function(){if(a.tag===13){var d=yn();d=Wa(d);var y=ga(a,d);y!==null&&_n(y,a,d),Fi(a,d)}});return}}else if(t===3&&a.stateNode.current.memoizedState.isDehydrated){e.blockedOn=a.tag===3?a.stateNode.containerInfo:null;return}}}e.blockedOn=null}function pc(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var a=Ui(e.nativeEvent);if(a===null){a=e.nativeEvent;var d=new a.constructor(a.type,a);Mc=d,a.target.dispatchEvent(d),Mc=null}else return t=Nn(a),t!==null&&Hf(t),e.blockedOn=a,!1;t.shift()}return!0}function Gf(e,t,a){pc(e)&&a.delete(t)}function $m(){$i=!1,No!==null&&pc(No)&&(No=null),Fo!==null&&pc(Fo)&&(Fo=null),qo!==null&&pc(qo)&&(qo=null),Lr.forEach(Gf),Mr.forEach(Gf)}function fc(e,t){e.blockedOn===t&&(e.blockedOn=null,$i||($i=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,$m)))}var hc=null;function Yf(e){hc!==e&&(hc=e,n.unstable_scheduleCallback(n.unstable_NormalPriority,function(){hc===e&&(hc=null);for(var t=0;t<e.length;t+=3){var a=e[t],d=e[t+1],y=e[t+2];if(typeof d!="function"){if(Oi(d||a)===null)continue;break}var g=Nn(a);g!==null&&(e.splice(t,3),t-=3,Os(g,{pending:!0,data:y,method:a.method,action:d},d,y))}}))}function Ir(e){function t($){return fc($,e)}No!==null&&fc(No,e),Fo!==null&&fc(Fo,e),qo!==null&&fc(qo,e),Lr.forEach(t),Mr.forEach(t);for(var a=0;a<Uo.length;a++){var d=Uo[a];d.blockedOn===e&&(d.blockedOn=null)}for(;0<Uo.length&&(a=Uo[0],a.blockedOn===null);)zf(a),a.blockedOn===null&&Uo.shift();if(a=(e.ownerDocument||e).$$reactFormReplay,a!=null)for(d=0;d<a.length;d+=3){var y=a[d],g=a[d+1],b=y[Mt]||null;if(typeof g=="function")b||Yf(a);else if(b){var R=null;if(g&&g.hasAttribute("formAction")){if(y=g,b=g[Mt]||null)R=b.formAction;else if(Oi(y)!==null)continue}else R=b.action;typeof R=="function"?a[d+1]=R:(a.splice(d,3),d-=3),Yf(a)}}}function Li(e){this._internalRoot=e}yc.prototype.render=Li.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(i(409));var a=t.current,d=yn();Pf(a,d,e,t,null,null)},yc.prototype.unmount=Li.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;Pf(e.current,2,null,e,null,null),Xl(),t[_e]=null}};function yc(e){this._internalRoot=e}yc.prototype.unstable_scheduleHydration=function(e){if(e){var t=ll();e={blockedOn:null,target:e,priority:t};for(var a=0;a<Uo.length&&t!==0&&t<Uo[a].priority;a++);Uo.splice(a,0,e),a===0&&zf(e)}};var Wf=o.version;if(Wf!=="19.1.1")throw Error(i(527,Wf,"19.1.1"));W.findDOMNode=function(e){var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(i(188)):(e=Object.keys(e).join(","),Error(i(268,e)));return e=p(t),e=e!==null?h(e):null,e=e===null?null:e.stateNode,e};var Lm={bundleType:0,version:"19.1.1",rendererPackageName:"react-dom",currentDispatcherRef:k,reconcilerVersion:"19.1.1"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var _c=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!_c.isDisabled&&_c.supportsFiber)try{ct=_c.inject(Lm),bt=_c}catch{}}return Vr.createRoot=function(e,t){if(!r(e))throw Error(i(299));var a=!1,d="",y=ip,g=dp,b=up,R=null;return t!=null&&(t.unstable_strictMode===!0&&(a=!0),t.identifierPrefix!==void 0&&(d=t.identifierPrefix),t.onUncaughtError!==void 0&&(y=t.onUncaughtError),t.onCaughtError!==void 0&&(g=t.onCaughtError),t.onRecoverableError!==void 0&&(b=t.onRecoverableError),t.unstable_transitionCallbacks!==void 0&&(R=t.unstable_transitionCallbacks)),t=Lf(e,1,!1,null,null,a,d,y,g,b,R,null),e[_e]=t.current,wi(e),new Li(t)},Vr.hydrateRoot=function(e,t,a){if(!r(e))throw Error(i(299));var d=!1,y="",g=ip,b=dp,R=up,$=null,J=null;return a!=null&&(a.unstable_strictMode===!0&&(d=!0),a.identifierPrefix!==void 0&&(y=a.identifierPrefix),a.onUncaughtError!==void 0&&(g=a.onUncaughtError),a.onCaughtError!==void 0&&(b=a.onCaughtError),a.onRecoverableError!==void 0&&(R=a.onRecoverableError),a.unstable_transitionCallbacks!==void 0&&($=a.unstable_transitionCallbacks),a.formState!==void 0&&(J=a.formState)),t=Lf(e,1,!0,t,a??null,d,y,g,b,R,$,J),t.context=Mf(null),a=t.current,d=yn(),d=Wa(d),y=go(d),y.callback=null,vo(a,y,d),a=d,t.current.lanes=a,Io(t,a),Hn(t),e[_e]=t.current,wi(e),new yc(t)},Vr.version="19.1.1",Vr}var ah;function Qm(){if(ah)return Pi.exports;ah=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(o){console.error(o)}}return n(),Pi.exports=Wm(),Pi.exports}var Xm=Qm(),te=sd();const zi=Pm(te);/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function Zm({onClose:n}){return u.jsx("div",{className:"modal-overlay",onClick:n,children:u.jsxs("div",{className:"modal-content",onClick:o=>o.stopPropagation(),children:[u.jsx("button",{className:"btn btn-back modal-close-btn",onClick:n,children:"X"}),u.jsx("h2",{children:"Game Rules"}),u.jsx("h3",{children:"Objective"}),u.jsx("p",{children:"You play as an artificial intelligence trying to compile your own 3 protocols. To do this, you play command cards on the protocols over several rounds and execute their effects. If you reach a total value of at least 10 with your own command cards on a protocol and exceed the other person's total value in the same row, you may compile the protocol (turn it over). The first person to compile their 3 protocols wins."}),u.jsx("h3",{children:"Game Flow"}),u.jsx("p",{children:"The person who chose a protocol first begins. You always play alternately until one person wins. On your turn, handle the following 6 phases in sequence:"}),u.jsxs("ol",{children:[u.jsx("li",{children:"Start"}),u.jsx("li",{children:"Check Control"}),u.jsx("li",{children:"Check Compile"}),u.jsx("li",{children:"Perform Action"}),u.jsx("li",{children:"Check Hand Limit"}),u.jsx("li",{children:"End"})]}),u.jsx("h3",{children:"Phases in Detail"}),u.jsxs("p",{children:[u.jsx("strong",{children:"1. Start:"}),' Resolve all visible "Start" effects of your face-up command cards in an order of your choice.']}),u.jsxs("p",{children:[u.jsx("strong",{children:"2. Check Control:"})," If the total value of your command cards in at least 2 rows is higher than the total value of the other person's command cards in the corresponding rows, take the control card and place it in front of you."]}),u.jsxs("p",{children:[u.jsx("strong",{children:"3. Check Compile:"})," If you can compile protocols, you must now compile 1 of them. If you can compile multiple protocols, choose 1 of them. If you have compiled, you must skip phase 4 and proceed directly to phase 5."]}),u.jsxs("p",{children:[u.jsx("strong",{children:"Compile Action:"}),` If your cards in a row have a total value of 10 or more AND this is higher than the other person's total value in that row, you must compile your protocol in that row. To do this, both of you remove all cards on your side of that row and place them on your respective discard piles. Then, turn your protocol in that row to the "Compiled" side. If you compile this protocol again later, you draw 1 card from the other person's deck as a reward instead. Use it from now on as if it were your own card.`]}),u.jsxs("p",{children:[u.jsx("strong",{children:"4. Perform Action:"}),' Play 1 command card from your hand OR fill your hand. If you have no hand cards, you must perform the "Fill Hand" action. If you have 5 or more hand cards, you may not perform the "Fill Hand" action.']}),u.jsxs("p",{children:[u.jsx("strong",{children:"5. Check Hand Limit:"})," If you have more than 5 command cards in your hand, you must reduce to your hand limit: discard hand cards until you have only 5."]}),u.jsxs("p",{children:[u.jsx("strong",{children:"6. End:"}),' Resolve all visible "End" effects of your face-up command cards in an order of your choice.']}),u.jsx("h3",{children:"Glossary"}),u.jsxs("p",{children:[u.jsx("strong",{children:"Clear Cache:"})," Discard down to 5 cards in hand."]}),u.jsxs("p",{children:[u.jsx("strong",{children:"Compile:"})," To delete all cards in a line on both players sides and flip a protocol."]}),u.jsxs("p",{children:[u.jsx("strong",{children:"Covered:"})," A card with another card on top of it is covered."]}),u.jsxs("p",{children:[u.jsx("strong",{children:"Delete:"})," Move a card from the field to the trash."]}),u.jsxs("p",{children:[u.jsx("strong",{children:"Discard:"})," Move a card from hand to the owners trash."]}),u.jsxs("p",{children:[u.jsx("strong",{children:"Flip:"})," Change the facing of a card from face-down to face-up, or from face-up to face-down."]}),u.jsxs("p",{children:[u.jsx("strong",{children:"Line:"})," The area of play through both protocols. The field is made up of 3 lines, each passing through 2 opposing protocols."]}),u.jsxs("p",{children:[u.jsx("strong",{children:"Protocol:"})," The header that dictates which line you are allowed to play cards into."]}),u.jsxs("p",{children:[u.jsx("strong",{children:"Rearrange:"})," Change the position of protocols."]}),u.jsxs("p",{children:[u.jsx("strong",{children:"Refresh:"})," Draw until you have 5 cards in hand."]}),u.jsxs("p",{children:[u.jsx("strong",{children:"Return:"})," Move a card from the field to its owners hand."]}),u.jsxs("p",{children:[u.jsx("strong",{children:"Reveal:"})," Publicly share information that was hidden or private without effect, then return it to its previous state."]}),u.jsxs("p",{children:[u.jsx("strong",{children:"Shift:"})," Move a card to another line on the same side of the field."]}),u.jsxs("p",{children:[u.jsx("strong",{children:"Stack:"})," The cards in a line on one players side."]}),u.jsxs("p",{children:[u.jsx("strong",{children:"Trash:"})," Where discarded and deleted cards go. This is reshuffled to reform your deck when need be."]}),u.jsxs("p",{children:[u.jsx("strong",{children:"Uncovered:"})," The card at the end of a stack, furthest from the protocol is the uncovered card."]})]})})}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const an=({card:n,onPointerDown:o,onPointerEnter:c,onPointerLeave:i,isFaceUp:r,faceDownValue:l=2,isSelected:s,isMultiSelected:f,isTargetable:p,isSourceOfEffect:h,style:_,additionalClassName:m,animationState:v})=>{const w=({content:ce,className:B})=>u.jsx("div",{className:`card-rule-box ${B||""}`,dangerouslySetInnerHTML:{__html:ce}}),C=(v==null?void 0:v.type)==="playCard"&&v.cardId===n.id?`is-entering-${v.owner}`:"",E=(v==null?void 0:v.type)==="deleteCard"&&v.cardId===n.id?`is-deleting-${v.owner}`:"",j=(v==null?void 0:v.type)==="drawCard"||(v==null?void 0:v.type)==="discardCard"?v.owner:void 0,D=j==="player"&&(v==null?void 0:v.type)==="drawCard"&&v.cardIds.includes(n.id),A=j==="player"&&(v==null?void 0:v.type)==="discardCard"&&v.cardIds.includes(n.id),L=["card-component"];n.protocol&&L.push(`card-protocol-${n.protocol.toLowerCase()}`),n.color&&L.push("has-custom-color"),n.pattern&&L.push(`card-pattern-${n.pattern}`),s&&L.push("selected"),f&&L.push("multi-selected"),A&&L.push("is-discarding"),p&&L.push("is-targetable"),h&&L.push("is-source-of-effect"),C&&L.push(C),E&&L.push(E),D&&L.push("is-drawing"),m&&L.push(m);const H={..._};return n.color&&(H["--card-custom-color"]=n.color),u.jsx("div",{className:L.join(" "),onPointerDown:o,onPointerEnter:c,onPointerLeave:i,role:"button",tabIndex:o?0:-1,style:H,children:u.jsxs("div",{className:`card-inner ${r?"":"is-flipped"}`,children:[u.jsxs("div",{className:"card-face card-front",children:[u.jsxs("div",{className:"card-header",children:[u.jsx("span",{className:`card-protocol ${n.protocol.length<=8?"short-protocol":""}`,children:n.protocol.slice(0,8)}),u.jsx("span",{className:"card-value",children:n.value})]}),u.jsxs("div",{className:"card-body",children:[u.jsx(w,{content:n.top,className:"card-rule-top"}),u.jsx(w,{content:n.middle,className:"card-rule-middle"}),u.jsx(w,{content:n.bottom,className:"card-rule-bottom"})]})]}),u.jsx("div",{className:"card-face card-back",children:u.jsx("div",{className:"card-back-value",children:l})})]})})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const _t=[{protocol:"Apathy",value:0,top:"Your total value in this line is increased by 1 for each face-down card in this line.",middle:"",bottom:"",keywords:{},category:"Aux 1"},{protocol:"Apathy",value:1,top:"",middle:"Flip all other face-up cards in this line.",bottom:"",keywords:{flip:!0},category:"Aux 1"},{protocol:"Apathy",value:2,top:"Ignore all middle commands of cards in this line.",middle:"",bottom:"<div><span class='emphasis'>When this card would be covered:</span> First, flip this card.</div>",keywords:{flip:!0},category:"Aux 1"},{protocol:"Apathy",value:3,top:"",middle:"Flip 1 of your opponent's face-up cards.",bottom:"",keywords:{flip:!0},category:"Aux 1"},{protocol:"Apathy",value:4,top:"",middle:"You may flip 1 of your face-up covered cards.",bottom:"",keywords:{flip:!0},category:"Aux 1"},{protocol:"Apathy",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Aux 1"},{protocol:"Chaos",value:0,top:"",middle:"In each line, flip 1 covered card.",bottom:"<div><span class='emphasis'>Start:</span> Draw the top card of your opponent's deck. Your opponent draws the top card of your deck.</div>",keywords:{flip:!0,draw:!0},category:"Main 2"},{protocol:"Chaos",value:1,top:"",middle:"Rearrange your protocols. Rearrange your opponent's protocols.",bottom:"",keywords:{},category:"Main 2"},{protocol:"Chaos",value:2,top:"",middle:"Shift 1 of your covered cards.",bottom:"",keywords:{shift:!0},category:"Main 2"},{protocol:"Chaos",value:3,top:"",middle:"",bottom:"You may play cards without matching protocols.",keywords:{play:!0},category:"Main 2"},{protocol:"Chaos",value:4,top:"",middle:"",bottom:"<div><span class='emphasis'>End:</span> Discard your hand. Draw the same amount of cards.</div>",keywords:{discard:!0,draw:!0},category:"Main 2"},{protocol:"Chaos",value:5,top:"",middle:"Discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 2"},{protocol:"Darkness",value:0,top:"",middle:"Draw 3 cards. Shift 1 of your opponent's covered cards.",bottom:"",keywords:{draw:!0,shift:!0},category:"Main 1"},{protocol:"Darkness",value:1,top:"",middle:"Flip 1 of your opponent's cards. You may shift that card.",bottom:"",keywords:{flip:!0,shift:!0},category:"Main 1"},{protocol:"Darkness",value:2,top:"All face-down cards in this stack have a value of 4.",middle:"You may flip 1 covered card in this line.",bottom:"",keywords:{flip:!0},category:"Main 1"},{protocol:"Darkness",value:3,top:"",middle:"Play 1 card face-down in another line.",bottom:"",keywords:{play:!0},category:"Main 1"},{protocol:"Darkness",value:4,top:"",middle:"Shift 1 face-down card.",bottom:"",keywords:{shift:!0},category:"Main 1"},{protocol:"Darkness",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Death",value:0,top:"",middle:"Delete 1 card from each other line.",bottom:"",keywords:{delete:!0},category:"Main 1"},{protocol:"Death",value:1,top:"<div><span class='emphasis'>Start:</span> You may draw 1 card. If you do, delete 1 other card, then delete this card.</div>",middle:"",bottom:"",keywords:{draw:!0,delete:!0},category:"Main 1"},{protocol:"Death",value:2,top:"",middle:"Delete all cards in 1 line with values of 1 or 2.",bottom:"",keywords:{delete:!0},category:"Main 1"},{protocol:"Death",value:3,top:"",middle:"Delete 1 face-down card.",bottom:"",keywords:{delete:!0},category:"Main 1"},{protocol:"Death",value:4,top:"",middle:"Delete a card with a value of 0 or 1.",bottom:"",keywords:{delete:!0},category:"Main 1"},{protocol:"Death",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Fire",value:0,top:"",middle:"Flip 1 other card. Draw 2 cards.",bottom:"<div><span class='emphasis'>When this card would be covered:</span> First, draw 1 card and flip 1 other card.</div>",keywords:{draw:!0,flip:!0},category:"Main 1"},{protocol:"Fire",value:1,top:"",middle:"Discard 1 card. If you do, delete 1 card.",bottom:"",keywords:{delete:!0,discard:!0},category:"Main 1"},{protocol:"Fire",value:2,top:"",middle:"Discard 1 card. If you do, return 1 card.",bottom:"",keywords:{discard:!0,return:!0},category:"Main 1"},{protocol:"Fire",value:3,top:"",middle:"",bottom:"<div><span class='emphasis'>End:</span> You may discard 1 card. If you do, flip 1 card.</div>",keywords:{discard:!0,flip:!0},category:"Main 1"},{protocol:"Fire",value:4,top:"",middle:"Discard 1 or more cards. Draw the amount discarded plus 1.",bottom:"",keywords:{discard:!0,draw:!0},category:"Main 1"},{protocol:"Fire",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Gravity",value:0,top:"",middle:"For every 2 cards in this line, play the top card of your deck face-down under this card.",bottom:"",keywords:{play:!0},category:"Main 1"},{protocol:"Gravity",value:1,top:"",middle:"Draw 2 cards. Shift 1 card either to or from this line.",bottom:"",keywords:{draw:!0,shift:!0},category:"Main 1"},{protocol:"Gravity",value:2,top:"",middle:"Flip 1 card. Shift that card to this line.",bottom:"",keywords:{flip:!0,shift:!0},category:"Main 1"},{protocol:"Gravity",value:4,top:"",middle:"Shift 1 face-down card to this line.",bottom:"",keywords:{shift:!0},category:"Main 1"},{protocol:"Gravity",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Gravity",value:6,top:"",middle:"Your opponent plays the top card of their deck face-down in this line.",bottom:"",keywords:{play:!0},category:"Main 1"},{protocol:"Hate",value:0,top:"",middle:"Delete 1 card.",bottom:"",keywords:{delete:!0},category:"Aux 1"},{protocol:"Hate",value:1,top:"",middle:"Discard 3 cards. Delete 1 card. Delete 1 card.",bottom:"",keywords:{delete:!0,discard:!0},category:"Aux 1"},{protocol:"Hate",value:2,top:"",middle:"Delete your highest value uncovered card. Delete your opponent's highest value uncovered card.",bottom:"",keywords:{delete:!0},category:"Aux 1"},{protocol:"Hate",value:3,top:"<div><span class='emphasis'>After you delete cards:</span> Draw 1 card.</div>",middle:"",bottom:"",keywords:{draw:!0},category:"Aux 1"},{protocol:"Hate",value:4,top:"",middle:"",bottom:"<div><span class='emphasis'>When this card would be covered:</span> First, delete the lowest value covered card in this line.</div>",keywords:{delete:!0},category:"Aux 1"},{protocol:"Hate",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Aux 1"},{protocol:"Life",value:0,top:"",middle:"Play the top card of your deck face-down in each line where you have a card.",bottom:"<div><span class='emphasis'>When this card would be covered:</span> First, delete this card.</div>",keywords:{delete:!0,play:!0},category:"Main 1"},{protocol:"Life",value:1,top:"",middle:"Flip 1 card. Flip 1 card.",bottom:"",keywords:{flip:!0},category:"Main 1"},{protocol:"Life",value:2,top:"",middle:"Draw 1 card. You may flip 1 face-down card.",bottom:"",keywords:{draw:!0,flip:!0},category:"Main 1"},{protocol:"Life",value:3,top:"",middle:"",bottom:"<div><span class='emphasis'>When this card would be covered:</span> First, play the top card of your deck face-down in another line.</div>",keywords:{play:!0},category:"Main 1"},{protocol:"Life",value:4,top:"",middle:"If this card is covering a card, draw 1 card.",bottom:"",keywords:{draw:!0},category:"Main 1"},{protocol:"Life",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Light",value:0,top:"",middle:"Flip 1 card. Draw cards equal to that card's value.",bottom:"",keywords:{draw:!0,flip:!0},category:"Main 1"},{protocol:"Light",value:1,top:"",middle:"",bottom:"<div><span class='emphasis'>End:</span> Draw 1 card.</div>",keywords:{draw:!0},category:"Main 1"},{protocol:"Light",value:2,top:"",middle:"Draw 2 cards. Reveal 1 face-down card. You may shift or flip that card.",bottom:"",keywords:{draw:!0,flip:!0,reveal:!0,shift:!0},category:"Main 1"},{protocol:"Light",value:3,top:"",middle:"Shift all face-down cards in this line to another line.",bottom:"",keywords:{shift:!0},category:"Main 1"},{protocol:"Light",value:4,top:"",middle:"Your opponent reveals their hand.",bottom:"",keywords:{reveal:!0},category:"Main 1"},{protocol:"Light",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Love",value:1,top:"",middle:"Draw the top card of your opponent's deck.",bottom:"<div><span class='emphasis'>End:</span> You may give 1 card from your hand to your opponent. If you do, draw 2 cards.</div>",keywords:{draw:!0,give:!0},category:"Aux 1"},{protocol:"Love",value:2,top:"",middle:"Your opponent draws 1 card. Refresh.",bottom:"",keywords:{draw:!0,refresh:!0},category:"Aux 1"},{protocol:"Love",value:3,top:"",middle:"Take 1 random card from your opponent's hand. Give 1 card from your hand to your opponent.",bottom:"",keywords:{give:!0,take:!0},category:"Aux 1"},{protocol:"Love",value:4,top:"",middle:"Reveal 1 card from your hand. Flip 1 card.",bottom:"",keywords:{flip:!0,reveal:!0},category:"Aux 1"},{protocol:"Love",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Aux 1"},{protocol:"Love",value:6,top:"",middle:"Your opponent draws 2 cards.",bottom:"",keywords:{draw:!0},category:"Aux 1"},{protocol:"Metal",value:0,top:"Your opponent's total value in this line is reduced by 2.",middle:"Flip 1 card.",bottom:"",keywords:{flip:!0},category:"Main 1"},{protocol:"Metal",value:1,top:"",middle:"Draw 2 cards. Your opponent cannot compile next turn.",bottom:"",keywords:{draw:!0},category:"Main 1"},{protocol:"Metal",value:2,top:"Your opponent cannot play cards face-down in this line.",middle:"",bottom:"",keywords:{},category:"Main 1"},{protocol:"Metal",value:3,top:"",middle:"Draw 1 card. Delete all cards in 1 other line with 8 or more cards.",bottom:"",keywords:{delete:!0,draw:!0},category:"Main 1"},{protocol:"Metal",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Metal",value:6,top:"<div><span class='emphasis'>When this card would be covered or flipped:</span> First, delete this card.</div>",middle:"",bottom:"",keywords:{delete:!0},category:"Main 1"},{protocol:"Plague",value:0,top:"",middle:"Your opponent discards 1 card.",bottom:"Your opponent cannot play cards in this line.",keywords:{discard:!0},category:"Main 1"},{protocol:"Plague",value:1,top:"<div><span class='emphasis'>After your opponent discards cards:</span> Draw 1 card.</div>",middle:"Your opponent discards 1 card.",bottom:"",keywords:{discard:!0,draw:!0},category:"Main 1"},{protocol:"Plague",value:2,top:"",middle:"Dicard 1 or more cards. Your opponent discards the amount of cards discarded plus 1.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Plague",value:3,top:"",middle:"Flip each other face-up card.",bottom:"",keywords:{flip:!0},category:"Main 1"},{protocol:"Plague",value:4,top:"",middle:"",bottom:"<div><span class='emphasis'>End:</span> Your opponent deletes 1 of their face-down cards. You may flip this card.</div>",keywords:{delete:!0,flip:!0},category:"Main 1"},{protocol:"Plague",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Psychic",value:0,top:"",middle:"Draw 2 cards. Your opponent discards 2 cards, then reveals their hand.",bottom:"",keywords:{discard:!0,draw:!0,reveal:!0},category:"Main 1"},{protocol:"Psychic",value:1,top:"Your opponent can only play cards face-down.",middle:"",bottom:"<div><span class='emphasis'>Start:</span> Flip this card.</div>",keywords:{flip:!0},category:"Main 1"},{protocol:"Psychic",value:2,top:"",middle:"Your opponent discards 2 cards. Rearrange their protocols.",bottom:"",keywords:{discard:!0,rearrange:!0},category:"Main 1"},{protocol:"Psychic",value:3,top:"",middle:"Your opponent discards 1 card. Shift 1 of their cards.",bottom:"",keywords:{discard:!0,shift:!0},category:"Main 1"},{protocol:"Psychic",value:4,top:"",middle:"",bottom:"<div><span class='emphasis'>End:</span> You may return 1 of your opponent's cards. If you do, flip this card.</div>",keywords:{flip:!0,return:!0},category:"Main 1"},{protocol:"Psychic",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Speed",value:0,top:"",middle:"Play 1 card.",bottom:"",keywords:{play:!0},category:"Main 1"},{protocol:"Speed",value:1,top:"<div><span class='emphasis'>After you clear cache:</span> Draw 1 card.</div>",middle:"Draw 2 cards.",bottom:"",keywords:{draw:!0},category:"Main 1"},{protocol:"Speed",value:2,top:"<div><span class='emphasis'>When this card would be deleted by compiling:</span> Shift this card, even if this card is covered.</div>",middle:"",bottom:"",keywords:{shift:!0},category:"Main 1"},{protocol:"Speed",value:3,top:"",middle:"Shift 1 of your other cards.",bottom:"<div><span class='emphasis'>End:</span> You may shift 1 of your cards. If you do, flip this card.</div>",keywords:{flip:!0,shift:!0},category:"Main 1"},{protocol:"Speed",value:4,top:"",middle:"Shift 1 of your opponent's face-down cards.",bottom:"",keywords:{shift:!0},category:"Main 1"},{protocol:"Speed",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Spirit",value:0,top:"",middle:"Refresh. Draw 1 card.",bottom:"Skip your check cache phase.",keywords:{draw:!0,refresh:!0},category:"Main 1"},{protocol:"Spirit",value:1,top:"You can play cards in any line.",middle:"Draw 2 cards.",bottom:"<div><span class='emphasis'>Start:</span> Either discard 1 card or flip this card.</div>",keywords:{discard:!0,draw:!0,flip:!0},category:"Main 1"},{protocol:"Spirit",value:2,top:"",middle:"You may flip 1 card.",bottom:"",keywords:{flip:!0},category:"Main 1"},{protocol:"Spirit",value:3,top:"<div><span class='emphasis'>After you draw cards:</span> You may shift this card, even if this card is covered.</div>",middle:"",bottom:"",keywords:{shift:!0},category:"Main 1"},{protocol:"Spirit",value:4,top:"",middle:"Swap the positions of 2 of your protocols",bottom:"",keywords:{swap:!0},category:"Main 1"},{protocol:"Spirit",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Water",value:0,top:"",middle:"Flip 1 other card. Flip this card.",bottom:"",keywords:{flip:!0},category:"Main 1"},{protocol:"Water",value:1,top:"",middle:"Play the top card of your deck face-down in each other line.",bottom:"",keywords:{play:!0},category:"Main 1"},{protocol:"Water",value:2,top:"",middle:"Draw 2 cards. Rearrange your protocols.",bottom:"",keywords:{draw:!0,rearrange:!0},category:"Main 1"},{protocol:"Water",value:3,top:"",middle:"Return all cards with a value of 2 in 1 line.",bottom:"",keywords:{return:!0},category:"Main 1"},{protocol:"Water",value:4,top:"",middle:"Return 1 of your cards.",bottom:"",keywords:{return:!0},category:"Main 1"},{protocol:"Water",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Frost",value:0,top:"",middle:"Draw 1 card for each face-down card.",bottom:"",keywords:{draw:!0},category:"Fan-Content"},{protocol:"Frost",value:1,top:"Cards cannot be flipped face-up.",middle:"",bottom:"Protocols cannot be rearranged.",keywords:{flip:!0,rearrange:!0},category:"Fan-Content"},{protocol:"Frost",value:2,top:"",middle:"Play a card face-down.",bottom:"",keywords:{play:!0},category:"Fan-Content"},{protocol:"Frost",value:3,top:"Cards cannot shift from or to this line.",middle:"",bottom:"",keywords:{shift:!0},category:"Fan-Content"},{protocol:"Frost",value:4,top:"",middle:"You may flip 1 card of your face-up covered cards.",bottom:"",keywords:{flip:!0},category:"Fan-Content"},{protocol:"Frost",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Fan-Content"},{protocol:"Anarchy",value:0,top:"",middle:"Shift 1 card. For each line that contains a face-up card without matching protocol, draw 1 card.",bottom:"",keywords:{shift:!0,draw:!0},category:"Fan-Content"},{protocol:"Anarchy",value:1,top:"Cards can only be played without matching protocols.",middle:"Shift 1 other card to a line without a matching protocol.",bottom:"",keywords:{shift:!0,play:!0},category:"Fan-Content"},{protocol:"Anarchy",value:2,top:"",middle:"Delete a covered or uncovered card in a line with a matching protocol.",bottom:"",keywords:{delete:!0},category:"Fan-Content"},{protocol:"Anarchy",value:3,top:"",middle:"Swap the positions of 2 of your opponent's protocols.",bottom:"<div><span class='emphasis'>End:</span> Rearrange your protocols. Anarchy cannot be on this line.</div>",keywords:{swap:!0,rearrange:!0},category:"Fan-Content"},{protocol:"Anarchy",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Fan-Content"},{protocol:"Anarchy",value:6,top:"<div><span class='emphasis'>Start:</span> Flip this card, if this card is in the line with the Anarchy protocol.</div>",middle:"",bottom:"",keywords:{flip:!0},category:"Fan-Content"}],Km=new Set(_t.map(n=>n.protocol)),Ah=Array.from(Km).sort();/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const kh=n=>{var i,r,l,s,f,p,h,_,m,v,w,x,C,S,E,j,D,A,L,H,ce,B,z,V,le,G,P,q,N,k,W,ee,ge,F,O,K;const o=n.params;let c="";switch(o.action){case"draw":{if(n.useCardFromPreviousEffect){o.target==="opponent"?c="Opponent draws cards equal to that card's value.":c="Draw cards equal to that card's value.";break}if(o.conditional){switch(o.conditional.type){case"count_face_down":c="Draw 1 card for each face-down card.";break;case"is_covering":c=`Draw ${o.count} card${o.count!==1?"s":""} if this card is covering another.`;break;case"non_matching_protocols":c="Draw 1 card for each line with a non-matching protocol.";break}break}let U="";if(o.preAction==="refresh"&&(U="Refresh your hand. "),o.countType==="equal_to_discarded"){const ye=o.countOffset||0;ye===1?U+="Draw the amount discarded plus 1.":ye===0?U+="Draw the amount discarded.":U+=`Draw the amount discarded plus ${ye}.`,c=U;break}else if(o.countType==="equal_to_card_value"){U+="Draw cards equal to that card's value.",c=U;break}else if(o.countType==="hand_size"){U+="Draw the same amount of cards.",c=U;break}const Q=o.optional?"You may ":"";if(o.source==="opponent_deck")U+=`${Q}Draw ${o.count} card${o.count!==1?"s":""} from opponent's deck.`;else if(o.target==="opponent")U+=`Opponent draws ${o.count} card${o.count!==1?"s":""}.`;else{const ye=o.optional?"draw":"Draw";U+=`${Q}${ye} ${o.count} card${o.count!==1?"s":""}.`}c=U;break}case"flip":{if(n.useCardFromPreviousEffect){c=`${o.optional?"May flip":"Flip"} that card.`;break}if(o.flipSelf){let se=(o.optional,"Flip this card");((i=o.advancedConditional)==null?void 0:i.type)==="protocol_match"&&(se+=`, if this card is in the line with the ${o.advancedConditional.protocol||"[Protocol]"} protocol`),c=se+".";break}const U=o.optional?"You may flip":"Flip",Q=((r=o.targetFilter)==null?void 0:r.owner)==="own",ye=((l=o.targetFilter)==null?void 0:l.owner)==="opponent";let fe="";Q&&(fe="your "),ye&&(fe="opponent's "),((s=o.targetFilter)==null?void 0:s.position)==="covered"&&(fe+="covered "),((f=o.targetFilter)==null?void 0:f.faceState)==="face_down"&&(fe+="face-down "),((p=o.targetFilter)==null?void 0:p.faceState)==="face_up"&&(fe+="face-up "),(h=o.targetFilter)!=null&&h.excludeSelf&&(fe+="other ");let ne="";o.count==="all"?ne="all":o.count==="each"?o.eachLineScope==="each_line"?(ne="1",fe=fe+"(in each line) "):ne="each":ne=o.count.toString();const X=o.count===1?"card":"cards";let re="";Q&&((_=o.targetFilter)==null?void 0:_.position)==="covered"&&((m=o.targetFilter)==null?void 0:m.faceState)==="face_up"&&o.optional?re=`${U} ${ne} of your ${o.targetFilter.faceState.replace("_","-")} ${o.targetFilter.position} cards`:re=`${U} ${ne} ${fe}${X}`,o.scope==="this_lane"&&(re+=" in this line"),re+=".",o.selfFlipAfter&&(re+=" Then flip this card."),c=re;break}case"shift":{const U=o.optional?"You may shift":"Shift";if(n.useCardFromPreviousEffect){c=`${U} that card.`;break}let Q="";((v=o.targetFilter)==null?void 0:v.owner)==="opponent"&&(Q+="opponent's "),(w=o.targetFilter)!=null&&w.excludeSelf&&(Q+="other "),((x=o.targetFilter)==null?void 0:x.position)==="covered"&&(Q+="covered "),((C=o.targetFilter)==null?void 0:C.faceState)==="face_down"&&(Q+="face-down "),((S=o.targetFilter)==null?void 0:S.faceState)==="face_up"&&(Q+="face-up ");const ye=o.count==="all"?"all":"1";let ne=`${U} ${ye} ${Q}${ye==="1"?"card":"cards"}`;((E=o.destinationRestriction)==null?void 0:E.type)==="non_matching_protocol"?ne+=" to a line without a matching protocol":((j=o.destinationRestriction)==null?void 0:j.type)==="specific_lane"?ne+=" within this line":((D=o.destinationRestriction)==null?void 0:D.type)==="to_another_line"&&(ne+=" to another line"),c=ne+".";break}case"delete":{if(n.useCardFromPreviousEffect){c="Delete that card.";break}if(o.deleteSelf){c="Delete this card.";break}let U="Delete ";const Q=((A=o.targetFilter)==null?void 0:A.position)==="any";if(o.count==="all_in_lane"?U+="all ":U+=Q?"a ":`${o.count} `,((L=o.targetFilter)==null?void 0:L.calculation)==="highest_value"?U+="highest value ":((H=o.targetFilter)==null?void 0:H.calculation)==="lowest_value"&&(U+="lowest value "),(ce=o.targetFilter)!=null&&ce.valueRange){const{min:ne,max:X}=o.targetFilter.valueRange,re=[];for(let we=ne;we<=X;we++)re.push(we);const se=re.join(" or ");U+=`value ${se} `}Q?U+="covered or uncovered ":((B=o.targetFilter)==null?void 0:B.position)==="covered"&&(U+="covered "),((z=o.targetFilter)==null?void 0:z.faceState)==="face_down"?U+="face-down ":((V=o.targetFilter)==null?void 0:V.faceState)==="face_up"&&(U+="face-up ");const ye=o.excludeSelf?"other ":"",fe=o.count===1?"card":"cards";U+=ye+fe,o.selectLane&&(U+=" in 1 line"),o.protocolMatching==="must_match"?U+=" in a line with a matching protocol":o.protocolMatching==="must_not_match"&&(U+=" in a line without a matching protocol"),((le=o.scope)==null?void 0:le.type)==="this_line"?U+=" in this line":((G=o.scope)==null?void 0:G.type)==="other_lanes"?U+=" in other lanes":((P=o.scope)==null?void 0:P.type)==="each_other_line"&&(U+=" from each other line"),c=U+".";break}case"discard":{if(n.useCardFromPreviousEffect){o.actor==="opponent"?c="Opponent discards that card.":c="Discard that card.";break}const U=o.variableCount;let Q="";if(U)Q="1 or more cards";else{const fe=o.count===1?"card":"cards";Q=`${o.count} ${fe}`}const ye=o.optional?"You may discard":"Discard";o.actor==="opponent"?c=`Opponent discards ${Q}.`:c=`${ye} ${Q}.`;break}case"return":{if(n.useCardFromPreviousEffect){c="Return that card to hand.";break}if(((q=o.targetFilter)==null?void 0:q.valueEquals)!==void 0){c=`Return all value ${o.targetFilter.valueEquals} cards to hand.`;break}const U=o.count==="all"?"all cards":o.count===1?"1 card":`${o.count} cards`,Q=((N=o.targetFilter)==null?void 0:N.owner)||"any";let ye="";Q==="own"?ye=" of your own":Q==="opponent"&&(ye=" of opponent's"),c=`Return ${U}${ye} to hand.`;break}case"play":{if(n.useCardFromPreviousEffect){c=`Play that card ${o.faceDown?"face-down":"face-up"}.`;break}const U=o.actor,Q=o.count===1?"card":"cards",ye=o.faceDown?"face-down":"face-up";let fe="",ne="";U==="opponent"?(fe="Opponent plays",ne=o.source==="deck"?"from their deck":"from their hand"):(fe="Play",ne=o.source==="deck"?"from your deck":"from your hand");let X=`${fe} ${o.count} ${Q} ${ye} ${ne}`;((k=o.destinationRule)==null?void 0:k.type)==="other_lines"?X+=" to other lines":((W=o.destinationRule)==null?void 0:W.type)==="each_other_line"?X+=" in each other line":((ee=o.destinationRule)==null?void 0:ee.type)==="under_this_card"?X+=" under this card":((ge=o.destinationRule)==null?void 0:ge.type)==="each_line_with_card"?X+=" to each line with a card":((F=o.destinationRule)==null?void 0:F.type)==="specific_lane"&&(X+=" in this line"),c=X+".";break}case"rearrange_protocols":case"swap_protocols":{const U=o.target==="opponent"?"opponent's":o.target==="both_sequential"?"both players'":"your";let Q="";o.action==="rearrange_protocols"?Q=`Rearrange ${U} protocols`:Q=`Swap 2 ${U} protocols`,o.restriction&&o.restriction.disallowedProtocol&&(Q+=`. ${o.restriction.disallowedProtocol} cannot be on this line`),c=Q+".";break}case"reveal":case"give":{if(n.useCardFromPreviousEffect){c=`${o.action==="give"?"Give":"Reveal"} that card.`;break}const U=o.count===1?"card":"cards",Q=o.action==="give"?"Give":"Reveal",ye=o.source==="opponent_hand"?"opponent's hand":"your hand";let fe=`${Q} ${o.count} ${U} from ${ye}`;o.followUpAction==="flip"?fe+=". Then flip it.":o.followUpAction==="shift"?fe+=". Then shift it.":fe+=".",c=fe;break}case"take":{const U=o.count===1?"card":"cards",Q=o.random?"random ":"";c=`Take ${o.count} ${Q}${U} from opponent's hand.`;break}case"passive_rule":{const U=o.rule;switch(U==null?void 0:U.type){case"require_non_matching_protocol":c="Cards can only be played without matching protocols.";break;case"block_all_play":c="Cards cannot be played in this line.";break;case"ignore_middle_commands":c="Ignore all middle commands of cards in this line.";break;case"block_face_down_play":c="Opponent can't play cards face-down in this line.";break;case"require_face_down_play":c="Opponent can only play cards face-down in this line.";break;case"allow_any_protocol_play":c="You can play cards without matching protocols.";break;case"block_flips":c="Cards can't be flipped face-up in this line.";break;case"block_protocol_rearrange":c="Protocols can't be rearranged.";break;case"block_shifts_from_lane":c="Cards can't shift from this line.";break;case"block_shifts_to_lane":c="Cards can't shift to this line.";break;case"skip_check_cache_phase":c="Skip check cache phase.";break;default:c="Passive rule effect."}break}case"value_modifier":{const U=o.modifier;switch(U==null?void 0:U.type){case"add_per_condition":{const Q=U.scope==="this_lane"?"in this line":"",ye=U.target==="own_total"?"Your total value":U.target==="opponent_total"?"Opponent's total value":"Total value";let fe="";U.condition==="per_face_down_card"?fe="for each face-down card":U.condition==="per_face_up_card"?fe="for each face-up card":U.condition==="per_card"&&(fe="for each card");const ne=U.value>=0?"+":"";c=`${ye} ${Q} is increased by ${ne}${U.value} ${fe} ${Q}.`.replace(/\s+/g," ");break}case"set_to_fixed":{let Q="";U.target==="own_cards"?Q="your":U.target==="opponent_cards"?Q="opponent's":Q="all";let ye="";((O=U.filter)==null?void 0:O.faceState)==="face_down"?ye=" face-down":((K=U.filter)==null?void 0:K.faceState)==="face_up"&&(ye=" face-up");let fe="";U.scope==="this_lane"&&(fe=" in this stack"),c=`All ${Q}${ye} cards${fe} have a value of ${U.value}.`;break}case"add_to_total":{const Q=U.target==="opponent_total"?"Opponent total":"Your total",ye=U.value>=0?"+":"";c=`${Q} ${ye}${U.value}.`;break}default:c="Value modifier effect."}break}default:c="Effect";break}if(n.conditional&&n.conditional.thenEffect){const U=kh(n.conditional.thenEffect),Q=n.conditional.type==="then"?"then":"If you do,";c=`${c} ${Q} ${U.toLowerCase()}`}return c},Jm=n=>{const o={};for(const c of n){const r=c.params.action;r==="draw"&&(o.draw=!0),r==="flip"&&(o.flip=!0),r==="shift"&&(o.shift=!0),r==="delete"&&(o.delete=!0),r==="discard"&&(o.discard=!0),r==="return"&&(o.return=!0),r==="play"&&(o.play=!0),r==="reveal"&&(o.reveal=!0),r==="give"&&(o.give=!0),r==="take"&&(o.take=!0)}return o},Gi=n=>n.length===0?"":n.map(o=>{const c=kh(o),i=o.trigger;return i==="start"?`<div><span class='emphasis'>Start:</span> ${c}</div>`:i==="end"?`<div><span class='emphasis'>End:</span> ${c}</div>`:i==="on_cover"?`<div><span class='emphasis'>When this card would be covered:</span> First, ${c.toLowerCase()}</div>`:c}).join(" "),eg=(n,o)=>{var p,h,_;const c=((p=n.text)==null?void 0:p.top)!==void 0?n.text.top:Gi(n.topEffects),i=((h=n.text)==null?void 0:h.middle)!==void 0?n.text.middle:Gi(n.middleEffects),r=((_=n.text)==null?void 0:_.bottom)!==void 0?n.text.bottom:Gi(n.bottomEffects),l=[...n.topEffects,...n.middleEffects,...n.bottomEffects],s=Jm(l);return{protocol:o.name,value:n.value,top:c,middle:i,bottom:r,keywords:s,category:"Custom",color:o.color,pattern:o.pattern,customEffects:{topEffects:n.topEffects,middleEffects:n.middleEffects,bottomEffects:n.bottomEffects}}},tg=n=>n.cards.map(o=>eg(o,n)),Rc=()=>{try{const n=localStorage.getItem("custom_protocols_v1");if(!n)return console.log("[Custom Protocols] No custom protocols in localStorage"),[];const c=JSON.parse(n).protocols||[];console.log("[Custom Protocols] Loaded protocols from localStorage:",c.map(r=>r.name));const i=[];for(const r of c){const l=tg(r);console.log(`[Custom Protocols] Converted ${r.name} to ${l.length} cards`),i.push(...l)}return console.log("[Custom Protocols] Total custom cards:",i.length),i}catch(n){return console.error("Failed to load custom protocol cards:",n),[]}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Dh="customProtocolsEnabled";function Ac(){try{return localStorage.getItem(Dh)==="true"}catch{return!1}}function ng(n){try{localStorage.setItem(Dh,n?"true":"false")}catch{}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */let xc=null;function og(){if(!xc){const o=Ac()?Rc():[];xc=[..._t,...o]}return xc}function Yr(){xc=null}function so(n){const o=og(),c=[];for(const i of n){const r=o.filter(l=>l.protocol===i);c.push(...r)}return c}function On(n){const o=[...n];for(let c=o.length-1;c>0;c--){const i=Math.floor(Math.random()*(c+1));[o[c],o[i]]=[o[i],o[c]]}return o}function rh({onNavigate:n,difficulty:o,setDifficulty:c,useControl:i,onUseControlChange:r}){const[l,s]=te.useState(!1),[f,p]=te.useState(null),[h,_]=te.useState(null),[m,v]=te.useState(null),[w,x]=te.useState([]),[C,S]=te.useState(Ac()),[E,j]=te.useState(0);te.useEffect(()=>{const A=new Set;for(;A.size<2&&A.size<_t.length;)A.add(Math.floor(Math.random()*_t.length));const L=Array.from(A).map(H=>_t[H]);L.length>0&&(v(L[0]),_(L[0])),L.length>1&&p(L[1]),x(On(_t))},[]);const D=()=>{const A=E+1;if(j(A),A>=5){const L=!C;S(L),ng(L),j(0)}};return u.jsxs("div",{className:"screen main-menu",children:[l&&u.jsx(Zm,{onClose:()=>s(!1)}),u.jsx("h1",{children:"COMPILE: MAIN 1"}),u.jsxs("div",{className:"main-menu-attribution",children:[u.jsxs("p",{children:["based on the card game ",u.jsx("a",{href:"https://boardgamegeek.com/boardgame/406652/compile-main-1",target:"_blank",rel:"noopener noreferrer",children:"Compile: Main 1"})," designed by ",u.jsx("a",{href:"https://justgravyllc.com/",target:"_blank",rel:"noopener noreferrer",children:"Michael Yang"})]}),u.jsxs("p",{children:[u.jsx("span",{onClick:D,style:{cursor:"default",userSelect:"none"},children:"developed"})," by ",u.jsx("a",{href:"https://apo-games.de/",target:"_blank",rel:"noopener noreferrer",children:"Dirk Aporius"})]})]}),u.jsxs("div",{className:"main-menu-layout",children:[u.jsx("div",{className:"main-menu-preview decorative-card",children:h&&u.jsx(an,{card:{...h,id:"preview",isFaceUp:!0},isFaceUp:!0})}),u.jsxs("div",{className:"main-menu-actions-container",children:[u.jsxs("div",{className:"main-menu-start-group",children:[u.jsxs("div",{className:"difficulty-selector",children:[u.jsx("h3",{className:"difficulty-title",children:"Difficulty"}),u.jsxs("div",{className:"difficulty-options",children:[u.jsx("button",{className:`btn ${o==="easy"?"active":""}`,onClick:()=>c("easy"),children:"Easy"}),u.jsx("button",{className:`btn ${o==="normal"?"active":""}`,onClick:()=>c("normal"),children:"Normal"}),u.jsx("button",{className:`btn ${o==="hard"?"active":""}`,onClick:()=>c("hard"),children:"Hard"})]})]}),u.jsxs("div",{className:"control-mechanic-selector",children:[u.jsx("input",{type:"checkbox",id:"control-mechanic",checked:i,onChange:A=>r(A.target.checked)}),u.jsx("label",{htmlFor:"control-mechanic",children:"Use Control Mechanic"})]}),u.jsx("button",{className:"btn btn-start",onClick:()=>n("ProtocolSelection"),children:"Start Game"})]}),u.jsxs("div",{className:"main-menu-other-actions",children:[u.jsx("button",{className:"btn",onClick:()=>n("CardLibrary"),children:"Cards"}),u.jsx("button",{className:"btn",onClick:()=>n("Statistics"),children:"Statistics"}),C&&u.jsx("button",{className:"btn",onClick:()=>n("CustomProtocols"),children:"Custom Protocols"}),u.jsx("button",{className:"btn",onClick:()=>s(!0),children:"Rules"}),u.jsx("p",{className:"version-info",children:"Version 0.25"})]})]}),u.jsx("div",{className:"decorative-card decorative-card-right",children:f&&u.jsx(an,{card:{...f,id:"deco-2",isFaceUp:!0},isFaceUp:!0})})]}),u.jsx("div",{className:"card-ticker-container",onPointerLeave:()=>_(m),children:u.jsxs("div",{className:"card-ticker-track",children:[w.map((A,L)=>u.jsx(an,{card:{...A,id:`ticker-1-${L}`,isFaceUp:!0},isFaceUp:!0,additionalClassName:"in-hand",onPointerEnter:()=>_(A)},`ticker-1-${L}`)),w.map((A,L)=>u.jsx(an,{card:{...A,id:`ticker-2-${L}`,isFaceUp:!0},isFaceUp:!0,additionalClassName:"in-hand",onPointerEnter:()=>_(A)},`ticker-2-${L}`))]})})]})}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function id({title:n,onBack:o}){return u.jsxs("header",{className:"app-header",children:[u.jsx("h2",{children:n}),o&&u.jsx("button",{className:"btn btn-back",onClick:o,children:"Back"})]})}const mc=[{player:"Player",picks:1},{player:"Opponent",picks:2},{player:"Player",picks:2},{player:"Opponent",picks:1}];function ag({onBack:n,onStartGame:o}){const[c,i]=te.useState(0),[r,l]=te.useState([]),[s,f]=te.useState([]),[p,h]=te.useState([]),[_,m]=te.useState(!1),[v,w]=te.useState(null),[x,C]=te.useState(null),[S,E]=te.useState(0);te.useEffect(()=>{Yr(),E(O=>O+1)},[]);const j=te.useMemo(()=>{const O=Ac(),K=O?Rc():[],U=[..._t,...K];return console.log("[Protocol Selection] Total cards loaded:",U.length,"(base:",_t.length,", custom:",K.length,", enabled:",O,")"),U},[S]),D=te.useMemo(()=>{const O=new Set(j.map(U=>U.protocol)),K=Array.from(O).sort();return console.log("[Protocol Selection] Unique protocols:",K),K},[j]),A=te.useMemo(()=>{const O=new Set(j.map(K=>K.category));return Array.from(O).sort()},[j]),[L,H]=te.useState(()=>new Set(A));te.useEffect(()=>{H(new Set(A))},[A]);const ce=O=>{const K=j.find(U=>U.protocol===O);return(K==null?void 0:K.category)||""},B=O=>{const U=j.find(Q=>Q.protocol===O);return U!=null&&U.color?{"--card-custom-color":U.color,borderColor:U.color}:{}},z=O=>{const U=j.find(Q=>Q.protocol===O);return U!=null&&U.pattern?`pattern-${U.pattern}`:""},V=te.useMemo(()=>D.filter(O=>{const K=ce(O);return L.has(K)}),[L]),le=O=>{H(K=>{const U=new Set(K);return U.has(O)?U.delete(O):U.add(O),U})},G=mc[c],P=(G==null?void 0:G.player)==="Player",q=(G==null?void 0:G.player)==="Opponent",N=te.useMemo(()=>new Set([...r,...s]),[r,s]),k=te.useMemo(()=>p.map(O=>({name:O,cards:j.filter(K=>K.protocol===O).sort((K,U)=>K.value-U.value)})),[p]),W=O=>{if(!P||_)return;const K=j.filter(U=>U.protocol===O).sort((U,Q)=>U.value-Q.value);K.length>0&&C(K[0]),h(U=>{if(U.includes(O))return U.filter(Q=>Q!==O);if(U.length<G.picks)return[...U,O];if(U.length===G.picks){const Q=U.slice(1);return Q.push(O),Q}return U})},ee=async()=>{if(!P||_||p.length!==G.picks)return;m(!0);const O=[...p];h([]);for(const K of O)l(U=>[...U,K]),await new Promise(U=>setTimeout(U,300));m(!1),i(K=>K+1)};te.useEffect(()=>{q&&!_&&c<mc.length&&(async()=>{m(!0),await new Promise(fe=>setTimeout(fe,100));const K=[],U=D.filter(fe=>!(N.has(fe)||ce(fe)==="Custom")),Q=[],ye=K.filter(fe=>U.includes(fe));for(let fe=0;fe<G.picks;fe++)if(ye.length>0){const ne=ye.shift();Q.push(ne);const X=U.indexOf(ne);X>-1&&U.splice(X,1)}else if(U.length>0){const ne=Math.floor(Math.random()*U.length);Q.push(U.splice(ne,1)[0])}for(const fe of Q)await new Promise(ne=>setTimeout(ne,1e3)),w(fe),await new Promise(ne=>setTimeout(ne,1e3)),w(null),f(ne=>[...ne,fe]);m(!1),i(fe=>fe+1)})()},[c,q,_,N,G]),te.useEffect(()=>{c>=mc.length&&!_&&setTimeout(()=>{o(r,s)},1e3)},[c,_,o,r,s]);const ge=O=>{const K=["protocol-card",`card-protocol-${O.toLowerCase()}`];return p.includes(O)&&K.push("selected"),N.has(O)&&K.push("chosen"),v===O&&K.push("is-scanning"),K.join(" ")},F=()=>_&&q?"Opponent is selecting protocols...":(G==null?void 0:G.player)==="Player"?`Player, select ${G.picks} protocol(s). (${p.length}/${G.picks})`:c>=mc.length?"Finalizing selections...":"Waiting for Opponent...";return u.jsxs("div",{className:"screen protocol-selection-screen",children:[u.jsx(id,{title:"Protocol Selection",onBack:n}),u.jsxs("div",{className:"protocol-selection-layout",children:[u.jsxs("div",{className:"protocol-selection-sidebar",children:[u.jsxs("div",{className:"player-protocols-area",children:[u.jsx("h3",{children:"Your Protocols"}),r.map(O=>u.jsx("div",{className:`protocol-display-card player card-protocol-${O.toLowerCase()} ${z(O)}`,style:B(O),children:O},O))]}),u.jsx("div",{className:"protocol-preview-area",children:x?u.jsx(an,{card:{...x,id:"preview",isFaceUp:!0},isFaceUp:!0}):u.jsx("p",{children:k.length>0?"Hover over a card below to see details.":"Select a protocol to see its cards."})})]}),u.jsxs("div",{className:"protocol-grid-container",children:[u.jsx("p",{children:F()}),u.jsx("div",{className:"category-filters",children:A.map(O=>u.jsxs("label",{className:"category-filter-item",children:[u.jsx("input",{type:"checkbox",checked:L.has(O),onChange:()=>le(O)}),u.jsx("span",{children:O})]},O))}),u.jsx("div",{className:"protocol-grid-scroll-wrapper",children:u.jsx("div",{className:"protocol-grid",children:V.map(O=>{const K=B(O),Q={fontSize:O.length>10?"0.65em":"1em"};return u.jsxs("div",{className:`${ge(O)} ${z(O)}`,style:K,onClick:()=>W(O),role:"button","aria-disabled":N.has(O)||!P||_,tabIndex:!N.has(O)&&P&&!_?0:-1,onKeyPress:ye=>ye.key==="Enter"&&W(O),children:[u.jsx("span",{className:"protocol-category-label",children:ce(O)}),u.jsx("span",{className:"protocol-name",style:Q,children:O})]},O)})})}),P&&u.jsx("button",{className:"btn",onClick:ee,disabled:_||p.length!==(G==null?void 0:G.picks),children:"Confirm Selection"})]}),u.jsxs("div",{className:"opponent-protocols-area",children:[u.jsx("h3",{children:"Opponent Protocols"}),s.map(O=>u.jsx("div",{className:`protocol-display-card opponent card-protocol-${O.toLowerCase()} ${z(O)}`,style:B(O),children:O},O))]})]}),u.jsx("div",{className:"selected-protocol-cards-container",children:k.length>0&&[...k].reverse().map(O=>u.jsx("div",{className:"protocol-card-row",children:O.cards.map(K=>u.jsx(an,{card:{...K,id:`selection-${K.protocol}-${K.value}`,isFaceUp:!0},isFaceUp:!0,additionalClassName:"in-hand",onClick:()=>C(K),onPointerEnter:()=>C(K)},`${O.name}-${K.value}`))},O.name))})]})}const rg="modulepreload",lg=function(n){return"/"+n},lh={},cg=function(o,c,i){let r=Promise.resolve();if(c&&c.length>0){let s=function(h){return Promise.all(h.map(_=>Promise.resolve(_).then(m=>({status:"fulfilled",value:m}),m=>({status:"rejected",reason:m}))))};document.getElementsByTagName("link");const f=document.querySelector("meta[property=csp-nonce]"),p=(f==null?void 0:f.nonce)||(f==null?void 0:f.getAttribute("nonce"));r=s(c.map(h=>{if(h=lg(h),h in lh)return;lh[h]=!0;const _=h.endsWith(".css"),m=_?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${m}`))return;const v=document.createElement("link");if(v.rel=_?"stylesheet":rg,_||(v.as="script"),v.crossOrigin="",v.href=h,p&&v.setAttribute("nonce",p),document.head.appendChild(v),_)return new Promise((w,x)=>{v.addEventListener("load",w),v.addEventListener("error",()=>x(new Error(`Unable to preload CSS for ${h}`)))})}))}function l(s){const f=new Event("vite:preloadError",{cancelable:!0});if(f.payload=s,window.dispatchEvent(f),!f.defaultPrevented)throw s}return r.then(s=>{for(const f of s||[])f.status==="rejected"&&l(f.reason);return o().catch(l)})},zt=[];for(let n=0;n<256;++n)zt.push((n+256).toString(16).slice(1));function sg(n,o=0){return(zt[n[o+0]]+zt[n[o+1]]+zt[n[o+2]]+zt[n[o+3]]+"-"+zt[n[o+4]]+zt[n[o+5]]+"-"+zt[n[o+6]]+zt[n[o+7]]+"-"+zt[n[o+8]]+zt[n[o+9]]+"-"+zt[n[o+10]]+zt[n[o+11]]+zt[n[o+12]]+zt[n[o+13]]+zt[n[o+14]]+zt[n[o+15]]).toLowerCase()}let Yi;const ig=new Uint8Array(16);function dg(){if(!Yi){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Yi=crypto.getRandomValues.bind(crypto)}return Yi(ig)}const ug=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),ch={randomUUID:ug};function He(n,o,c){var r;if(ch.randomUUID&&!n)return ch.randomUUID();n=n||{};const i=n.random??((r=n.rng)==null?void 0:r.call(n))??dg();if(i.length<16)throw new Error("Random bytes length must be >= 16");return i[6]=i[6]&15|64,i[8]=i[8]&63|128,sg(i)}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const T=(n,o,c)=>{let i=n._logIndentLevel||0;n._currentPhaseContext&&i===0&&(i=1);const r={player:o,message:c,indentLevel:i,sourceCard:n._currentEffectSource,phase:n._currentPhaseContext};return{...n,log:[...n.log,r]}},io=n=>({...n,_logIndentLevel:(n._logIndentLevel||0)+1}),mn=n=>({...n,_logIndentLevel:Math.max(0,(n._logIndentLevel||0)-1)}),Ue=(n,o)=>({...n,_currentEffectSource:o}),Le=(n,o)=>({...n,_currentPhaseContext:o});/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const pg=(n,o,c,i)=>{const{cardOwner:r,opponent:l}=i,s=c[r].lanes[o],f=c[l].lanes[o],p=new Set;if(s.filter(h=>h.id!==n.id&&h.isFaceUp).forEach(h=>p.add(h.id)),f.filter(h=>h.isFaceUp).forEach(h=>p.add(h.id)),p.size>0){let h={...c};return h=T(h,r,`Apathy-1: Flip ${p.size} card(s) face-down in the line.`),{newState:Lt(p,h)}}return{newState:c}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const fg=(n,o,c,i)=>{const{cardOwner:r,opponent:l}=i;let s={...c};return s[l].lanes.map(p=>p.length>0?p[p.length-1]:null).filter(p=>p!==null&&p.isFaceUp).length>0&&(s.actionRequired={type:"select_opponent_face_up_card_to_flip",count:1,sourceCardId:n.id,actor:r}),{newState:s}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const hg=(n,o,c,i)=>{const{cardOwner:r}=i;let l={...c};return l[r].lanes.flatMap(f=>f.filter((p,h)=>p.isFaceUp&&h<f.length-1)).length>0&&(l.actionRequired={type:"select_own_face_up_covered_card_to_flip",count:1,optional:!0,sourceCardId:n.id,actor:r}),{newState:l}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Bt=(n,o,c,i)=>{const{cardOwner:r}=i;let l={...c};return l[r].hand.length>0&&(l.actionRequired={type:"discard",actor:r,count:1,sourceCardId:n.id}),{newState:l}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Vn=n=>[n.player,n.opponent].some(o=>o.lanes.some(c=>c.some(i=>i.isFaceUp&&i.protocol==="Frost"&&i.value===1))),dd=n=>[n.player,n.opponent].some(o=>o.lanes.some(c=>{const i=c[c.length-1];return i&&i.isFaceUp&&i.protocol==="Frost"&&i.value===1}));/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const yg=(n,o,c,i)=>{const{cardOwner:r}=i,l=Vn(c),s=h=>{const _=c.player.lanes[h],m=c.opponent.lanes[h],v=[..._.filter((x,C)=>C<_.length-1),...m.filter((x,C)=>C<m.length-1)];return(l?v.filter(x=>x.isFaceUp):v).length>0},f=[0,1,2].filter(h=>s(h));if(f.length>0){const h=f[0],_=f.slice(1);return{newState:{...c,actionRequired:{type:"select_covered_card_to_flip_for_chaos_0",sourceCardId:n.id,laneIndex:h,remainingLanes:_,actor:r}}}}return{newState:T(c,r,l?"Chaos-0: Cannot flip face-down covered cards (Frost-1 is active).":"Chaos-0: No covered cards to flip.")}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const _g=(n,o,c,i)=>{const{cardOwner:r}=i,l=r==="player"?"opponent":"player";let s=T(c,r,`${r==="player"?"Player":"Opponent"}'s Chaos-1 triggers.`);return dd(s)?(s=T(s,r,"Frost-1 blocks protocol rearrangement. All protocols remain unchanged."),{newState:s}):(s.actionRequired={type:"prompt_rearrange_protocols",sourceCardId:n.id,target:r,actor:r},s.queuedActions=[...s.queuedActions||[],{type:"prompt_rearrange_protocols",sourceCardId:n.id,target:l,actor:r}],{newState:s})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const mg=(n,o,c,i)=>{const{cardOwner:r}=i;return c[r].lanes.some(s=>s.length>1)?{newState:{...c,actionRequired:{type:"select_own_covered_card_to_shift",sourceCardId:n.id,actor:r}}}:{newState:c}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const gg=(n,o,c,i)=>{const{cardOwner:r}=i;return c[r].hand.length===0?{newState:T(c,r,"Chaos-5: No cards to discard.")}:{newState:{...c,actionRequired:{type:"discard",actor:r,count:1,sourceCardId:n.id}}}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const vg=(n,o,c,i)=>{const{cardOwner:r,opponent:l}=i;let s=Ge(c,r,3);return s=T(s,r,"Darkness-0: Draw 3 cards."),s[l].lanes.flatMap(p=>p.filter((h,_)=>_<p.length-1)).length>0&&(s=T(s,r,"Darkness-0: Prompts to shift 1 of opponent's covered cards."),s.actionRequired={type:"select_opponent_covered_card_to_shift",sourceCardId:n.id,actor:r}),{newState:s}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const wg=(n,o,c,i)=>{const{cardOwner:r,opponent:l}=i;let s={...c};return s[l].lanes.flat().length>0&&(s.actionRequired={type:"select_opponent_card_to_flip",sourceCardId:n.id,actor:r}),{newState:s}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const xg=(n,o,c,i)=>{const{cardOwner:r,opponent:l}=i;let s={...c};const f=[s.player,s.opponent].some(v=>v.lanes.some(w=>{const x=w[w.length-1];return x&&x.isFaceUp&&x.protocol==="Frost"&&x.value===1})),p=s[r].lanes[o].filter((v,w,x)=>w<x.length-1),h=s[l].lanes[o].filter((v,w,x)=>w<x.length-1),_=[...p,...h];return(f?_.filter(v=>v.isFaceUp):_).length>0&&(s.actionRequired={type:"select_covered_card_in_line_to_flip_optional",laneIndex:o,sourceCardId:n.id,optional:!0,actor:r}),{newState:s}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Cg=(n,o,c,i)=>{const{cardOwner:r}=i;let l={...c};return l[r].hand.length>0&&(l.actionRequired={type:"select_card_from_hand_to_play",disallowedLaneIndex:o,sourceCardId:n.id,isFaceDown:!0,actor:r}),{newState:l}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Sg=(n,o,c,i)=>{const{cardOwner:r}=i;let l={...c};const s=[];for(const f of["player","opponent"])for(const p of c[f].lanes)if(p.length>0){const h=p[p.length-1];h.isFaceUp||s.push(h)}return s.length>0?(l=T(l,r,"Darkness-4: Prompts to shift 1 face-down card."),l.actionRequired={type:"select_face_down_card_to_shift_for_darkness_4",sourceCardId:n.id,actor:r}):l=T(l,r,"Darkness-4: No valid face-down card to shift."),{newState:l}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const bg=(n,o,c,i)=>{const{cardOwner:r}=i,l={...c},s={...l[r]},f=[];for(let E=0;E<3;E++)l[r].lanes[E].length>0&&f.push(E);if(f.length===0)return{newState:c};const{drawnCards:p,remainingDeck:h,newDiscard:_}=uo(s.deck,s.discard,f.length);if(p.length===0)return{newState:c};const m=p.map(E=>({...E,id:He(),isFaceUp:!1}));let v=l,w=[];for(let E=0;E<f.length;E++){const j=f[E],D=v[r].lanes[j];if(D.length>0){const A=D[D.length-1],L={...i,triggerType:"cover"},H=Ga(A,j,v,L);if(v=H.newState,H.animationRequests&&w.push(...H.animationRequests),v.actionRequired)break}}const x={...v[r]},C=[...x.lanes];for(let E=0;E<m.length;E++){const j=f[E];C[j]=[...C[j],m[E]]}x.lanes=C,x.deck=h,x.discard=_;let S={...v,[r]:x};return S=T(S,r,`Life-0: Plays ${p.length} card(s) face-down.`),{newState:S,animationRequests:w.length>0?w:void 0}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Eg=(n,o,c,i)=>{const{cardOwner:r}=i,l=Vn(c),s=[...c.player.lanes.flat(),...c.opponent.lanes.flat()];if((l?s.filter(h=>h.isFaceUp):s).length>0){let h={...c};return h=T(h,r,"Life-1: Prompts to flip 2 cards."),h.actionRequired={type:"select_any_card_to_flip",count:2,sourceCardId:n.id,actor:r},{newState:h}}return{newState:T(c,r,l?"Life-1: Cannot flip face-down cards (Frost-1 is active).":"Life-1: No cards to flip.")}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const jg=(n,o,c,i)=>{const{cardOwner:r}=i;let l=Ge(c,r,1);return l=T(l,r,"Life-2: Draw 1 card."),[l.player,l.opponent].some(p=>p.lanes.some(h=>{const _=h[h.length-1];return _&&_.isFaceUp&&_.protocol==="Frost"&&_.value===1}))?(l=T(l,r,"Life-2: Cannot flip face-down cards (Frost-1 is active)."),{newState:l}):([...l.player.lanes.flat(),...l.opponent.lanes.flat()].filter(p=>!p.isFaceUp).length>0&&(l.actionRequired={type:"select_any_face_down_card_to_flip_optional",sourceCardId:n.id,optional:!0,actor:r}),{newState:l})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Rg=(n,o,c,i)=>{const{cardOwner:r}=i;if(c[r].lanes[o].length>1){let s=Ge(c,r,1);return s=T(s,r,"Life-4: Card is covering another, draw 1 card."),{newState:s}}return{newState:c}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Ag=(n,o,c,i)=>{const{cardOwner:r}=i;let l=Uh(c,r,1);return l=T(l,r,`Love-1: ${r==="player"?"Player":"Opponent"} draws the top card of the opponent's deck.`),{newState:l}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const kg=(n,o,c,i)=>{const{cardOwner:r,opponent:l}=i;let s={...c};return s=T(s,r,"Love-2: Opponent draws 1 card."),s=Ge(s,l,1),s=pd(s,r),{newState:s}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Dg=(n,o,c,i)=>{const{cardOwner:r,opponent:l}=i;let s={...c};const f={...s[l]},p={...s[r]};if(f.hand.length===0)return s=T(s,r,"Love-3: Opponent has no cards to take."),{newState:s};const h=Math.floor(Math.random()*f.hand.length),_=f.hand.splice(h,1)[0];p.hand.push(_),s={...s,[r]:p,[l]:f};const m=r==="player"?"Player":"Opponent",v=r==="player"?`${_.protocol}-${_.value}`:"a random card";return s=T(s,r,`Love-3: ${m} takes ${v} from the opponent.`),s.actionRequired={type:"select_card_from_hand_to_give",sourceCardId:n.id,sourceEffect:"love_3",actor:r},{newState:s}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Tg=(n,o,c,i)=>{const{cardOwner:r}=i;let l={...c};return l[r].hand.length>0&&(l.actionRequired={type:"select_card_from_hand_to_reveal",sourceCardId:n.id,actor:r}),{newState:l}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Ng=(n,o,c,i)=>{const{cardOwner:r,opponent:l}=i;let s=Ge(c,l,2);return s=T(s,r,"Love-6: Opponent draws 2 cards."),{newState:s}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Fg=(n,o,c,i)=>{const{cardOwner:r}=i,l=Vn(c),s=[...c.player.lanes.flat(),...c.opponent.lanes.flat()];return(l?s.filter(h=>h.isFaceUp):s).length>0?{newState:{...c,actionRequired:{type:"select_any_card_to_flip",count:1,sourceCardId:n.id,actor:r}}}:{newState:T(c,r,l?"Metal-0: Cannot flip face-down cards (Frost-1 is active).":"Metal-0: No cards to flip.")}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const qg=(n,o,c,i)=>{const{cardOwner:r,opponent:l}=i;let s={...c};s=Ge(s,r,2),s=T(s,r,"Metal-1: Draw 2 cards.");const f={...s[l],cannotCompile:!0};return s={...s,[l]:f},s=T(s,r,"Metal-1: Opponent cannot compile next turn."),{newState:s}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Ug=(n,o,c,i)=>{const{cardOwner:r}=i;let l=Ge(c,r,1);l=T(l,r,"Metal-3: Draw 1 card.");const s=[0,1,2].filter(p=>p!==o);let f=!1;for(const p of s)if(l.player.lanes[p].length+l.opponent.lanes[p].length>=8){f=!0;break}return f&&(l.actionRequired={type:"select_lane_for_metal_3_delete",sourceCardId:n.id,disallowedLaneIndex:o,actor:r}),{newState:l}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Og=(n,o,c,i)=>{const{opponent:r}=i;let l={...c};return l[r].hand.length>0&&(l.actionRequired={type:"discard",actor:r,count:1,sourceCardId:n.id}),{newState:l}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const $g=(n,o,c,i)=>{const{opponent:r}=i;let l={...c};return l[r].hand.length>0&&(l.actionRequired={type:"discard",actor:r,count:1,sourceCardId:n.id}),{newState:l}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Lg=(n,o,c,i)=>{let r={...c};const{cardOwner:l,opponent:s}=i;return r[l].hand.length>0&&(l==="player"?r.actionRequired={type:"plague_2_player_discard",sourceCardId:n.id,actor:l}:r.actionRequired={type:"plague_2_opponent_discard",sourceCardId:n.id,actor:l}),{newState:r}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Mg=(n,o,c,i)=>{const{cardOwner:r}=i,l=new Set;for(const s of["player","opponent"])for(const f of c[s].lanes)if(f.length>0){const p=f[f.length-1];p.id!==n.id&&p.isFaceUp&&l.add(p.id)}if(l.size>0){let s={...c};return s=T(s,r,`Plague-3: Flip ${l.size} card(s) face-down.`),{newState:Lt(new Set(l),s)}}return{newState:c}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Pg=(n,o,c,i)=>{const{cardOwner:r,opponent:l}=i;let s=Ge(c,r,2);s=T(s,r,"Psychic-0: Draw 2 cards.");const f=s[l].hand.length;return f>0&&(s.actionRequired={type:"discard",actor:l,count:Math.min(2,f),sourceCardId:n.id},s.queuedActions=[...s.queuedActions||[],{type:"reveal_opponent_hand",sourceCardId:n.id,actor:r}]),{newState:s}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Ig=(n,o,c,i)=>{const{cardOwner:r,opponent:l}=i;let s={...c};const f=s[l].hand.length,p={type:"prompt_rearrange_protocols",sourceCardId:n.id,target:l,actor:r};return f>0?(s.actionRequired={type:"discard",actor:l,count:Math.min(2,f),sourceCardId:n.id},s.queuedActions=[...s.queuedActions||[],p]):s.actionRequired=p,{newState:s}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Hg=(n,o,c,i)=>{const{cardOwner:r,opponent:l}=i;let s={...c};const f=s[l].hand.length,p={type:"select_any_opponent_card_to_shift",sourceCardId:n.id,actor:r};return f>0?(s.actionRequired={type:"discard",actor:l,count:1,sourceCardId:n.id},s.queuedActions=[...s.queuedActions||[],p]):s[l].lanes.flat().length>0&&(s.actionRequired=p),{newState:s}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Vg=(n,o,c,i)=>{const{cardOwner:r}=i;let l={...c};return l[r].hand.length>0&&(l=T(l,r,"Speed-0: Play another card."),l.actionRequired={type:"select_card_from_hand_to_play",disallowedLaneIndex:-1,sourceCardId:n.id,actor:r}),{newState:l}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Bg=(n,o,c,i)=>{const{cardOwner:r}=i;let l=Ge(c,r,2);return l=T(l,r,"Speed-1: Draw 2 cards."),{newState:l}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const zg=(n,o,c,i)=>{const{cardOwner:r}=i,l=[];for(const s of c[r].lanes)if(s.length>0){const f=s[s.length-1];f.id!==n.id&&l.push(f)}return l.length>0?{newState:{...c,actionRequired:{type:"select_own_other_card_to_shift",sourceCardId:n.id,actor:r}}}:{newState:c}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Gg=(n,o,c,i)=>{const{cardOwner:r,opponent:l}=i,s=[];for(const p of c[l].lanes)if(p.length>0){const h=p[p.length-1];h.isFaceUp||s.push(h)}return s.length>0?{newState:{...c,actionRequired:{type:"select_opponent_face_down_card_to_shift",sourceCardId:n.id,actor:r}}}:{newState:T(c,r,"Speed-4: Opponent has no valid (uncovered) face-down cards to shift.")}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Yg=(n,o,c,i)=>{const{cardOwner:r}=i;let l={...c};return l=pd(l,r),l=Ge(l,r,1),l=T(l,r,"Spirit-0: Draw 1 card."),{newState:l}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Wg=(n,o,c,i)=>{const{cardOwner:r}=i;let l=Ge(c,r,2);return l=T(l,r,"Spirit-1: Draw 2 cards."),{newState:l}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Qg=(n,o,c,i)=>{const{cardOwner:r}=i,l=[c.player,c.opponent].some(p=>p.lanes.some(h=>{const _=h[h.length-1];return _&&_.isFaceUp&&_.protocol==="Frost"&&_.value===1})),s=[...c.player.lanes.flat(),...c.opponent.lanes.flat()];return(l?s.filter(p=>p.isFaceUp):s).length>0?{newState:{...c,actionRequired:{type:"select_any_card_to_flip_optional",sourceCardId:n.id,optional:!0,actor:r}}}:{newState:c}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Xg=(n,o,c,i)=>{const{cardOwner:r}=i,l=T(c,r,"Spirit-4 prompts to swap protocols.");return l.actionRequired={type:"prompt_swap_protocols",sourceCardId:n.id,actor:r,target:r},{newState:l}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Zg=(n,o,c,i)=>{const{cardOwner:r}=i,l=[];for(const f of["player","opponent"])for(const p of c[f].lanes)if(p.length>0){const h=p[p.length-1];h.id!==n.id&&l.push(h)}return l.length>0?{newState:{...c,actionRequired:{type:"select_cards_to_delete",count:1,sourceCardId:n.id,disallowedIds:[n.id],actor:r}}}:{newState:T(c,r,"Hate-0: No valid (uncovered) cards to delete.")}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Kg=(n,o,c,i)=>{const{cardOwner:r}=i;let l={...c};const s=l[r],f=Math.min(3,s.hand.length);return f>0?l.actionRequired={type:"select_cards_from_hand_to_discard_for_hate_1",count:f,sourceCardId:n.id,actor:r}:l.actionRequired={type:"select_cards_to_delete",count:2,sourceCardId:n.id,disallowedIds:[],actor:r},{newState:l}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Jg=(n,o,c,i)=>{const{cardOwner:r}=i;let l={...c};return l.actionRequired={type:"select_own_highest_card_to_delete_for_hate_2",actor:r,sourceCardId:n.id,count:1},{newState:l}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const ev=(n,o,c,i)=>{const{cardOwner:r}=i,f=[0,1,2].filter(p=>p!==o).filter(p=>c.player.lanes[p].length>0||c.opponent.lanes[p].length>0).length;return f>0?{newState:{...c,actionRequired:{type:"select_card_from_other_lanes_to_delete",sourceCardId:n.id,disallowedLaneIndex:o,lanesSelected:[],count:f,actor:r}}}:{newState:c}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const tv=(n,o,c,i)=>{const{cardOwner:r}=i;return{newState:{...c,actionRequired:{type:"select_lane_for_death_2",sourceCardId:n.id,actor:r}}}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const nv=(n,o,c,i)=>{const{cardOwner:r}=i,l=[];for(const f of["player","opponent"])for(const p of c[f].lanes)if(p.length>0){const h=p[p.length-1];h.isFaceUp||l.push(h)}return l.length>0?{newState:{...c,actionRequired:{type:"select_face_down_card_to_delete",sourceCardId:n.id,actor:r}}}:{newState:T(c,r,"Death-3: No valid targets (uncovered face-down cards) found.")}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const ov=(n,o,c,i)=>{const{cardOwner:r}=i,l=[];for(const f of["player","opponent"])for(const p of c[f].lanes)if(p.length>0){const h=p[p.length-1];h.isFaceUp&&(h.value===0||h.value===1)&&l.push(h)}return l.length>0?{newState:{...c,actionRequired:{type:"select_low_value_card_to_delete",sourceCardId:n.id,actor:r}}}:{newState:T(c,r,"Death-4: No valid targets (face-up, uncovered card with value 0 or 1) found.")}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const av=(n,o,c,i)=>{const{cardOwner:r}=i,l=Vn(c),s=[...c.player.lanes.flat(),...c.opponent.lanes.flat()].filter(p=>p.id!==n.id);if((l?s.filter(p=>p.isFaceUp):s).length>0)return{newState:{...c,actionRequired:{type:"select_any_other_card_to_flip",sourceCardId:n.id,draws:2,actor:r}}};{let p=l?T(c,r,"Fire-0: Cannot flip face-down cards (Frost-1 is active). Drawing 2 cards."):T(c,r,"Fire-0: No other cards to flip, drawing 2 cards.");return p=Ge(p,r,2),{newState:p}}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const rv=(n,o,c,i)=>{const{cardOwner:r}=i;let l={...c};return l[r].hand.length>0&&(l.actionRequired={type:"discard",actor:r,count:1,sourceCardId:n.id,sourceEffect:"fire_1"}),{newState:l}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const lv=(n,o,c,i)=>{const{cardOwner:r}=i;let l={...c};return l[r].hand.length>0&&(l.actionRequired={type:"discard",actor:r,count:1,sourceCardId:n.id,sourceEffect:"fire_2"}),{newState:l}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const cv=(n,o,c,i)=>{const{cardOwner:r}=i;return c[r].hand.length>0?{newState:{...c,actionRequired:{type:"select_cards_from_hand_to_discard_for_fire_4",sourceCardId:n.id,actor:r}}}:{newState:c}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const sv=(n,o,c,i)=>{const{cardOwner:r,opponent:l}=i,s=c[r].lanes[o].length,f=c[l].lanes[o].length,p=s+f,h=Math.floor(p/2);if(h===0)return{newState:c};let _={...c};const m={..._[r]},{drawnCards:v,remainingDeck:w,newDiscard:x}=uo(m.deck,m.discard,h);if(v.length===0)return{newState:_};const C=v.map(j=>({...j,id:He(),isFaceUp:!1})),S=[...m.lanes[o]];S.splice(S.length-1,0,...C);const E=[...m.lanes];return E[o]=S,_[r]={...m,lanes:E,deck:w,discard:x},_=T(_,r,`Gravity-0: Plays ${v.length} card(s) face-down under itself.`),{newState:_}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const iv=(n,o,c,i)=>{const{cardOwner:r}=i;let l=Ge(c,r,2);l=T(l,r,"Gravity-1: Draw 2 cards.");const s=[...l.player.lanes.flat(),...l.opponent.lanes.flat()],f=()=>{const p=h=>{const _=l.player.lanes[h].some(v=>v.isFaceUp&&v.protocol==="Frost"&&v.value===3),m=l.opponent.lanes[h].some(v=>v.isFaceUp&&v.protocol==="Frost"&&v.value===3);return _||m};for(const h of s){let _=-1;for(let m=0;m<3;m++){if(l.player.lanes[m].some(v=>v.id===h.id)){_=m;break}if(l.opponent.lanes[m].some(v=>v.id===h.id)){_=m;break}}if(_!==-1){for(let m=0;m<3;m++)if(!(m===_||!(_===o)&&!(m===o))&&!p(_)&&!p(m))return!0}}return!1};return s.length>0&&f()?l.actionRequired={type:"select_card_to_shift_for_gravity_1",sourceCardId:n.id,sourceLaneIndex:o,actor:r}:s.length>0&&(l=T(l,r,"Gravity-1: No valid shift targets available (blocked by Frost-3 or lane restrictions).")),{newState:l}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const dv=(n,o,c,i)=>{const{cardOwner:r}=i,l=Vn(c);let s={...c};const f=[...s.player.lanes.flat(),...s.opponent.lanes.flat()];return(l?f.filter(h=>h.isFaceUp):f).length>0?(s.actionRequired={type:"select_card_to_flip_and_shift_for_gravity_2",sourceCardId:n.id,targetLaneIndex:o,actor:r},{newState:s}):(s=T(s,r,l?"Gravity-2: Cannot flip face-down cards (Frost-1 is active).":"Gravity-2: No cards to flip."),{newState:s})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const uv=(n,o,c,i)=>{const{cardOwner:r}=i;let l={...c};const s=[],f=["player","opponent"];for(const p of f)l[p].lanes.forEach((h,_)=>{if(_!==o&&h.length>0){const m=h[h.length-1];m.isFaceUp||s.push(m)}});return s.length>0?l.actionRequired={type:"select_face_down_card_to_shift_for_gravity_4",sourceCardId:n.id,targetLaneIndex:o,actor:r}:l=T(l,r,"Gravity-4: No valid face-down cards in other lines to shift."),{newState:l}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const pv=(n,o,c,i)=>{const{cardOwner:r,opponent:l}=i,s={...c},f={...s[l]},{drawnCards:p,remainingDeck:h,newDiscard:_}=uo(f.deck,f.discard,1);if(p.length===0)return{newState:c};let m=s,v={newState:m};const w=s[l].lanes[o];if(w.length>0){const D=w[w.length-1],A={cardOwner:l,actor:r,currentTurn:i.currentTurn,opponent:r,triggerType:"cover"};v=Ga(D,o,s,A),m=v.newState}const x={...p[0],id:He(),isFaceUp:!1},C={...m[l]},S=[...C.lanes];S[o]=[...S[o],x],C.lanes=S,C.deck=h,C.discard=_;let E={...m,[l]:C};const j=E[l].protocols[o];return E=T(E,r,`Gravity-6: Opponent plays the top card of their deck face-down into Protocol ${j}.`),{newState:E,animationRequests:v.animationRequests}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const fv=(n,o,c,i)=>{const{cardOwner:r}=i,l=Vn(c),s=[...c.player.lanes.flat(),...c.opponent.lanes.flat()];return(l?s.filter(h=>h.isFaceUp):s).length>0?{newState:{...c,actionRequired:{type:"select_card_to_flip_for_light_0",sourceCardId:n.id,actor:r}}}:{newState:T(c,r,l?"Light-0: Cannot flip face-down cards (Frost-1 is active).":"Light-0: No cards to flip.")}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const hv=(n,o,c,i)=>{const{cardOwner:r}=i;let l=Ge(c,r,2);l=T(l,r,"Light-2: Draw 2 cards.");const s=[];for(const f of["player","opponent"])for(const p of l[f].lanes)if(p.length>0){const h=p[p.length-1];h.isFaceUp||s.push(h)}return s.length>0?l.actionRequired={type:"select_face_down_card_to_reveal_for_light_2",sourceCardId:n.id,actor:r}:l=T(l,r,"Light-2: No valid face-down cards to reveal."),{newState:l}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const yv=(n,o,c,i)=>{const{cardOwner:r,opponent:l}=i;let s={...c};return[...s[r].lanes[o],...s[l].lanes[o]].filter(p=>!p.isFaceUp).length>0&&(s.actionRequired={type:"select_lane_to_shift_cards_for_light_3",sourceCardId:n.id,sourceLaneIndex:o,actor:r}),{newState:s}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const _v=(n,o,c,i)=>{const{cardOwner:r,opponent:l}=i;let s={...c};const f={...s[l]};if(f.hand.length>0){f.hand=f.hand.map(h=>({...h,isRevealed:!0})),s[l]=f;const p=`${n.protocol}-${n.value}`;s=T(s,r,`${p}: Your opponent reveals their hand.`)}else{const p=`${n.protocol}-${n.value}`;s=T(s,r,`${p}: Opponent has no cards to reveal.`)}return{newState:s}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const mv=(n,o,c,i)=>{const{cardOwner:r}=i,l=Vn(c),s=[...c.player.lanes.flat(),...c.opponent.lanes.flat()].filter(h=>h.id!==n.id);if((l?s.filter(h=>h.isFaceUp):s).length>0){const h={type:"select_any_other_card_to_flip_for_water_0",sourceCardId:n.id,actor:r};return{newState:{...c,actionRequired:h}}}return{newState:T(c,r,l?"Water-0: Cannot flip face-down cards (Frost-1 is active).":"Water-0: No other cards to flip.")}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const gv=(n,o,c,i)=>{const{cardOwner:r}=i,l={...c},s={...l[r]},f=[0,1,2].filter(E=>E!==o);if(f.length===0)return{newState:c};const{drawnCards:p,remainingDeck:h,newDiscard:_}=uo(s.deck,s.discard,f.length);if(p.length===0)return{newState:c};const m=p.map(E=>({...E,id:He(),isFaceUp:!1}));let v=l,w=[];for(let E=0;E<f.length;E++){const j=f[E],D=v[r].lanes[j];if(D.length>0){const A=D[D.length-1],L={...i,triggerType:"cover"},H=Ga(A,j,v,L);if(v=H.newState,H.animationRequests&&w.push(...H.animationRequests),v.actionRequired)break}}const x={...v[r]},C=[...x.lanes];for(let E=0;E<m.length;E++){const j=f[E];C[j]=[...C[j],m[E]]}x.lanes=C,x.deck=h,x.discard=_;let S={...v,[r]:x};return S=T(S,r,`Water-1: Plays ${p.length} card(s) face-down in other lines.`),{newState:S,animationRequests:w.length>0?w:void 0}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const vv=(n,o,c,i)=>{const{cardOwner:r}=i;let l=Ge(c,r,2);return l=T(l,r,"Water-2: Draw 2 cards."),dd(l)?(l=T(l,r,`Frost-1 blocks protocol rearrangement. ${r==="player"?"Player's":"Opponent's"} protocols remain unchanged.`),{newState:l}):(l.actionRequired={type:"prompt_rearrange_protocols",sourceCardId:n.id,target:r,actor:r},{newState:l})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const wv=(n,o,c,i)=>{const{cardOwner:r}=i;return{newState:{...c,actionRequired:{type:"select_lane_for_water_3",sourceCardId:n.id,actor:r}}}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const xv=(n,o,c,i)=>{const{cardOwner:r}=i;return{newState:{...c,actionRequired:{type:"select_own_card_to_return_for_water_4",sourceCardId:n.id,actor:r}}}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Cv=(n,o,c,i)=>{const{cardOwner:r}=i;let l={...c};const s=[];for(const f of["player","opponent"])for(const p of l[f].lanes)p.length>0&&s.push(p[p.length-1]);return s.length===0?(l=T(l,r,"Anarchy-0: No uncovered cards to shift. Skipping to conditional draw."),l=Qr(l,r),{newState:l}):(l.actionRequired={type:"select_card_to_shift_for_anarchy_0",sourceCardId:n.id,actor:r},{newState:l})},Qr=(n,o)=>{let c={...n};c=Ue(c,"Anarchy-0"),c=Le(c,"middle");let i=0;for(let r=0;r<3;r++){const l=c.player.protocols[r],s=c.opponent.protocols[r],f=c.player.lanes[r].filter(m=>m.isFaceUp),p=c.opponent.lanes[r].filter(m=>m.isFaceUp);[...f,...p].some(m=>m.protocol!==l&&m.protocol!==s)&&i++}return i>0?(c=Ge(c,o,i),c=T(c,o,`${o==="player"?"Player":"Opponent"} draws ${i} card(s) from non-matching protocols.`)):c=T(c,o,"No non-matching face-up cards found. No draw."),c=Ue(c,void 0),c=Le(c,void 0),c};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Sv=(n,o,c,i)=>{const{cardOwner:r}=i;let l={...c};const s=[];for(const p of["player","opponent"])for(let h=0;h<l[p].lanes.length;h++){const _=l[p].lanes[h];if(_.length>0){const m=_[_.length-1];m.id!==n.id&&s.push({card:m,currentLane:h})}}if(s.length===0)return l=T(l,r,"Anarchy-1: No other uncovered cards to shift."),{newState:l};let f=!1;for(const{card:p,currentLane:h}of s){const _=p.protocol;for(let m=0;m<3;m++){if(m===h)continue;const v=l.player.protocols[m],w=l.opponent.protocols[m];if(_!==v&&_!==w){f=!0;break}}if(f)break}return f?(l.actionRequired={type:"select_card_to_shift_for_anarchy_1",sourceCardId:n.id,actor:r},{newState:l}):(l=T(l,r,"Anarchy-1: No valid targets (all cards match protocols in all other lanes)."),{newState:l})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const bv=(n,o,c,i)=>{const{cardOwner:r}=i;let l={...c};const s=[];for(let f=0;f<l.player.lanes.length;f++){const p=l.player.protocols[f],h=l.opponent.protocols[f];for(const _ of l.player.lanes[f])(_.protocol===p||_.protocol===h)&&s.push(_);for(const _ of l.opponent.lanes[f])(_.protocol===p||_.protocol===h)&&s.push(_)}return s.length===0?(l=T(l,r,"Anarchy-2: No valid targets (no cards in lanes with matching protocols)."),{newState:l}):(l.actionRequired={type:"select_card_to_delete_for_anarchy_2",sourceCardId:n.id,actor:r},{newState:l})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Ev=(n,o,c,i)=>{const{cardOwner:r,opponent:l}=i,s=T(c,r,"Anarchy-3 prompts to swap opponent's protocols.");return s.actionRequired={type:"prompt_swap_protocols",sourceCardId:n.id,actor:r,target:l},{newState:s}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const jv=(n,o,c,i)=>{const{cardOwner:r,opponent:l}=i;let s=0;c[r].lanes.forEach(p=>{p.forEach(h=>{h.isFaceUp||s++})}),c[l].lanes.forEach(p=>{p.forEach(h=>{h.isFaceUp||s++})});let f={...c};return s>0?(f=Ge(f,r,s),f=T(f,r,`Frost-0: Counted ${s} face-down card(s). Draw ${s} card(s).`)):f=T(f,r,"Frost-0: No face-down cards on the field. Draw 0 cards."),{newState:f}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Rv=(n,o,c,i)=>{const{cardOwner:r}=i;let l={...c};return l[r].hand.length>0&&(l.actionRequired={type:"select_card_from_hand_to_play",sourceCardId:n.id,isFaceDown:!0,actor:r}),{newState:l}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Av=(n,o,c,i)=>{const{cardOwner:r}=i;let l={...c};return l[r].lanes.flatMap(f=>f.filter((p,h)=>p.isFaceUp&&h<f.length-1)).length>0&&(l.actionRequired={type:"select_own_face_up_covered_card_to_flip",count:1,optional:!0,sourceCardId:n.id,actor:r}),{newState:l}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const kv={"Anarchy-0":Cv,"Anarchy-1":Sv,"Anarchy-2":bv,"Anarchy-3":Ev,"Anarchy-5":Bt,"Apathy-1":pg,"Apathy-3":fg,"Apathy-4":hg,"Apathy-5":Bt,"Chaos-0":yg,"Chaos-1":_g,"Chaos-2":mg,"Chaos-5":gg,"Darkness-0":vg,"Darkness-1":wg,"Darkness-2":xg,"Darkness-3":Cg,"Darkness-4":Sg,"Darkness-5":Bt,"Death-0":ev,"Death-2":tv,"Death-3":nv,"Death-4":ov,"Death-5":Bt,"Fire-0":av,"Fire-1":rv,"Fire-2":lv,"Fire-4":cv,"Fire-5":Bt,"Gravity-0":sv,"Gravity-1":iv,"Gravity-2":dv,"Gravity-4":uv,"Gravity-5":Bt,"Gravity-6":pv,"Hate-0":Zg,"Hate-1":Kg,"Hate-2":Jg,"Hate-5":Bt,"Life-0":bg,"Life-1":Eg,"Life-2":jg,"Life-4":Rg,"Life-5":Bt,"Light-0":fv,"Light-2":hv,"Light-3":yv,"Light-4":_v,"Light-5":Bt,"Love-1":Ag,"Love-2":kg,"Love-3":Dg,"Love-4":Tg,"Love-5":Bt,"Love-6":Ng,"Metal-0":Fg,"Metal-1":qg,"Metal-3":Ug,"Metal-5":Bt,"Plague-0":Og,"Plague-1":$g,"Plague-2":Lg,"Plague-3":Mg,"Plague-5":Bt,"Psychic-0":Pg,"Psychic-2":Ig,"Psychic-3":Hg,"Psychic-5":Bt,"Speed-0":Vg,"Speed-1":Bg,"Speed-3":zg,"Speed-4":Gg,"Speed-5":Bt,"Spirit-0":Yg,"Spirit-1":Wg,"Spirit-2":Qg,"Spirit-4":Xg,"Spirit-5":Bt,"Water-0":mv,"Water-1":gv,"Water-2":vv,"Water-3":wv,"Water-4":xv,"Water-5":Bt,"Frost-0":jv,"Frost-2":Rv,"Frost-4":Av,"Frost-5":Bt};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Dv=(n,o,c)=>{const{cardOwner:i}=c,r=i==="player"?"opponent":"player";let l={...o};if(l[r].deck.length>0){const s=l[r].deck.shift();s.id=He(),l[i].hand.push(s),l=T(l,i,`${i==="player"?"Player":"Opponent"} drew ${s.protocol}-${s.value} from ${r==="player"?"Player":"Opponent"}'s deck via Chaos-0.`)}else l=T(l,i,`${i==="player"?"Player":"Opponent"} could not draw from ${r==="player"?"Player":"Opponent"}'s deck (empty) via Chaos-0.`);if(l[i].deck.length>0){const s=l[i].deck.shift();s.id=He(),l[r].hand.push(s),l=T(l,r,`${r==="player"?"Player":"Opponent"} drew 1 card from ${i==="player"?"Player":"Opponent"}'s deck via Chaos-0.`)}else l=T(l,r,`${r==="player"?"Player":"Opponent"} could not draw from ${i==="player"?"Player":"Opponent"}'s deck (empty) via Chaos-0.`);return{newState:l}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Tv=(n,o,c)=>{const{cardOwner:i}=c;return{newState:{...o,actionRequired:{type:"prompt_death_1_effect",sourceCardId:n.id,optional:!0,actor:i}}}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Nv=(n,o,c)=>{const{cardOwner:i}=c,r=`${n.protocol}-${n.value}`;let l=T(o,i,`${r} Start Phase: Flipping itself.`);return l=Lt(new Set([n.id]),l),l.animationState={type:"flipCard",cardId:n.id},{newState:l}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Fv=(n,o,c)=>{const{cardOwner:i}=c;return{newState:{...o,actionRequired:{type:"prompt_spirit_1_start",sourceCardId:n.id,actor:i}}}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const qv=(n,o,c)=>{const{cardOwner:i}=c;let r=-1;for(let p=0;p<3;p++)if(o[i].lanes[p].some(_=>_.id===n.id)){r=p;break}if(r===-1)return{newState:o};const l=o.player.protocols[r],s=o.opponent.protocols[r];if(l==="Anarchy"||s==="Anarchy"){const p=`${n.protocol}-${n.value}`;let h=T(o,i,`${p} Start Phase: In Anarchy line - flipping itself.`);return h=Lt(new Set([n.id]),h),h.animationState={type:"flipCard",cardId:n.id},{newState:h}}else return{newState:o}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Uv={"Anarchy-6":qv,"Chaos-0":Dv,"Death-1":Tv,"Psychic-1":Nv,"Spirit-1":Fv};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Ov=(n,o,c)=>{const{cardOwner:i}=c,r=o[i].hand.length;if(r===0)return{newState:o};let l={...o};const s={...l[i]};return s.discard=[...s.discard,...s.hand],s.hand=[],l[i]=s,l=T(l,i,`Chaos-4: Discarded ${r} card(s).`),l=Ge(l,i,r),l=T(l,i,`Chaos-4: Drew ${r} card(s).`),{newState:l}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const $v=(n,o,c)=>{const{cardOwner:i,opponent:r}=c,l=[];for(const f of o[r].lanes)if(f.length>0){const p=f[f.length-1];p.isFaceUp||l.push(p)}return l.length>0?{newState:{...o,actionRequired:{type:"plague_4_opponent_delete",sourceCardId:n.id,actor:r}}}:{newState:{...T(o,i,"Plague-4: Opponent has no targetable face-down cards to delete."),actionRequired:{type:"plague_4_player_flip_optional",sourceCardId:n.id,optional:!0,actor:i}}}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Lv=(n,o,c)=>{const{cardOwner:i}=c;let r=Ge(o,i,1);return r=T(r,i,"Light-1 End Phase: Draw 1 card."),{newState:r}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Mv=(n,o,c)=>{const{cardOwner:i}=c;return o[i].hand.length>0?{newState:{...o,actionRequired:{type:"prompt_fire_3_discard",sourceCardId:n.id,optional:!0,actor:i}}}:{newState:o}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Pv=(n,o,c)=>{const{cardOwner:i}=c,r=[];for(const l of o[i].lanes)if(l.length>0){const s=l[l.length-1];r.push(s)}return r.length>0?{newState:{...o,actionRequired:{type:"prompt_shift_for_speed_3",sourceCardId:n.id,optional:!0,actor:i}}}:{newState:o}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Iv=(n,o,c)=>{const{cardOwner:i}=c;return o[i].hand.length>0?{newState:{...o,actionRequired:{type:"prompt_give_card_for_love_1",sourceCardId:n.id,optional:!0,actor:i}}}:{newState:o}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Hv=(n,o,c)=>{const{cardOwner:i,opponent:r}=c;return o[r].lanes.flat().length>0?{newState:{...o,actionRequired:{type:"prompt_return_for_psychic_4",sourceCardId:n.id,optional:!0,actor:i}}}:{newState:o}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Vv=(n,o,c)=>{const{cardOwner:i}=c;if(dd(o))return{newState:T(o,i,`Frost-1 blocks protocol rearrangement. ${i==="player"?"Player's":"Opponent's"} protocols remain unchanged.`)};let r=-1;for(let s=0;s<3;s++){const f=o[i].lanes[s],p=f.length>0?f[f.length-1]:null;if(p&&p.id===n.id&&p.isFaceUp){r=s;break}}if(r===-1)return{newState:o};const l=T(o,i,`Anarchy-3: Rearrange protocols (Anarchy cannot be on line ${r}).`);return l.actionRequired={type:"prompt_rearrange_protocols",sourceCardId:n.id,target:i,actor:i,disallowedProtocolForLane:{laneIndex:r,protocol:"Anarchy"}},{newState:l}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Bv={"Chaos-4":Ov,"Plague-4":$v,"Light-1":Lv,"Fire-3":Mv,"Speed-3":Pv,"Love-1":Iv,"Psychic-4":Hv,"Anarchy-3":Vv};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const zv=(n,o,c,i)=>{const{cardOwner:r}=i,l=["player","opponent"],s=[];for(const m of l){const v=c[m].lanes[o];for(let w=0;w<v.length;w++)s.push({card:v[w],owner:m})}if(s.length===0)return{newState:c};const f=s.reduce((m,v)=>{const w=x=>x.card.isFaceUp?x.card.value:c[x.owner].lanes[o].some(S=>S.isFaceUp&&S.protocol==="Darkness"&&S.value===2)?4:2;return w(v)<w(m)?v:m}),p=f.card.isFaceUp?`${f.card.protocol}-${f.card.value}`:"a face-down card",h=f.owner==="player"?"Player's":"Opponent's";return{newState:T(c,r,`Effect triggers, deleting the lowest value covered card (${h} ${p}).`),animationRequests:[{type:"delete",cardId:f.card.id,owner:f.owner}]}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Gv=(n,o,c,i)=>{const{cardOwner:r}=i,l=`${n.protocol}-${n.value}`;let s=T(c,r,`${l} On-Cover: Draw 1 card.`);return s=Ge(s,r,1),[...s.player.lanes.flat(),...s.opponent.lanes.flat()].filter(p=>p.id!==n.id).length>0?(s=T(s,r,`${l} On-Cover: Prompts to flip another card.`),s.actionRequired={type:"select_any_other_card_to_flip",sourceCardId:n.id,draws:0,actor:r},c.turn!==r&&(s._interruptedTurn=c.turn,s._interruptedPhase=c.phase,s.turn=r)):s=T(s,r,`${l} On-Cover: No other cards to flip.`),{newState:s}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Yv=(n,o,c,i)=>{const{cardOwner:r}=i;if(c[r].deck.length>0||c[r].discard.length>0){let l={...c};return l.actionRequired={type:"select_lane_for_life_3_play",sourceCardId:n.id,disallowedLaneIndex:o,actor:r},c.turn!==r&&(l._interruptedTurn=c.turn,l._interruptedPhase=c.phase,l.turn=r),{newState:l}}return{newState:c}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Wv=(n,o,c,i)=>{const{actor:r,cardOwner:l}=i,s=`${n.protocol}-${n.value}`;let f=T(c,r,`${s} effect triggers: flipping itself face-down.`);return f=Lt(new Set([n.id]),f),{newState:f}},Qv=(n,o,c,i)=>{const{actor:r,cardOwner:l}=i,s=`${n.protocol}-${n.value}`;return{newState:T(c,r,`${s} effect triggers: deleting itself.`),animationRequests:[{type:"delete",cardId:n.id,owner:l}]}},Xv=(n,o,c,i)=>{const{actor:r,cardOwner:l}=i,s=`${n.protocol}-${n.value}`;return{newState:T(c,r,`${s} effect triggers on cover: deleting itself.`),animationRequests:[{type:"delete",cardId:n.id,owner:l}]}},Zv={"Apathy-2":Wv,"Hate-4":zv,"Fire-0":Gv,"Life-0":Qv,"Life-3":Yv,"Metal-6":Xv};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function Po(n){const o=[];for(const c of["player","opponent"])n[c].lanes.forEach((i,r)=>{i.forEach(l=>{if(l.isFaceUp){const s=l;s.customEffects&&[...s.customEffects.topEffects||[],...s.customEffects.middleEffects||[],...s.customEffects.bottomEffects||[]].forEach(p=>{p.params.action==="passive_rule"&&p.trigger==="passive"&&o.push({rule:p.params.rule,cardOwner:c,laneIndex:r})})}})});return o}function Kv(n,o,c,i,r){const l=Po(n),s=o==="player"?"opponent":"player",f=n[o].protocols[c],p=n[s].protocols[c],h=r===f||r===p;for(const{rule:_,cardOwner:m,laneIndex:v}of l){const w=_.scope==="global"||v===c,x=_.target==="all"||_.target==="self"&&m===o||_.target==="opponent"&&m===s;if(!(!w||!x))switch(_.type){case"block_all_play":return{allowed:!1,reason:"Cannot play cards in this lane (passive rule)"};case"block_face_down_play":if(!i)return{allowed:!1,reason:"Cannot play cards face-down in this lane (passive rule)"};break;case"block_face_up_play":if(i)return{allowed:!1,reason:"Cannot play cards face-up in this lane (passive rule)"};break;case"require_face_down_play":if(i)return{allowed:!1,reason:"Can only play cards face-down (passive rule)"};break;case"allow_any_protocol_play":break;case"require_non_matching_protocol":if(i&&h)return{allowed:!1,reason:"Can only play cards without matching protocols (passive rule)"};break}}return{allowed:!0}}function ud(n){return Po(n).some(({rule:c})=>c.type==="require_non_matching_protocol"&&c.scope==="global")}function Jv(n,o,c){const i=Po(n),r=o==="player"?"opponent":"player";return i.some(({rule:l,cardOwner:s,laneIndex:f})=>{if(l.type!=="allow_any_protocol_play")return!1;const p=l.scope==="global"||c!==void 0&&f===c,h=l.target==="all"||l.target==="self"&&s===o||l.target==="opponent"&&s===r;return p&&h})}function e0(n,o){const c=Po(n);for(const{rule:i,laneIndex:r}of c)if(!(i.type!=="block_flips"||!(i.scope==="global"||r===o)))return{allowed:!1,reason:"Cards cannot be flipped face-up in this lane (passive rule)"};return{allowed:!0}}function t0(n,o,c){const i=Po(n);for(const{rule:r,laneIndex:l}of i){if(r.type==="block_shifts_from_lane"&&l===o)return r.scope,{allowed:!1,reason:"Cards cannot shift from this lane (passive rule)"};if(r.type==="block_shifts_to_lane"&&l===c)return r.scope,{allowed:!1,reason:"Cards cannot shift to this lane (passive rule)"}}return{allowed:!0}}function n0(n){const o=Po(n);for(const{rule:c}of o)if(c.type==="block_protocol_rearrange")return{allowed:!1,reason:"Protocols cannot be rearranged (passive rule)"};return{allowed:!0}}function o0(n,o){return Po(n).some(({rule:i,laneIndex:r})=>i.type!=="ignore_middle_commands"?!1:i.scope==="global"||r===o)}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function el(n,o,c,i){const{cardOwner:r,opponent:l,triggerType:s}=i,f=c[r].lanes[o];if(!f.find(w=>w.id===n.id))return{newState:c};if(!(f.length>0&&f[f.length-1].id===n.id))return{newState:c};if(o0(c,o))return{newState:c};const _=n;if(_.customEffects&&_.customEffects.middleEffects&&_.customEffects.middleEffects.length>0){console.log(`[effectExecutor] Executing custom card ${n.protocol}-${n.value} with ${_.customEffects.middleEffects.length} middle effects, triggerType=${s}`);let w=c;(s==="middle"||s==="play")&&(w=io(w));const x=`${n.protocol}-${n.value}`;w=Ue(w,x),w=Le(w,"middle");let C=w;for(let E=0;E<_.customEffects.middleEffects.length;E++){console.log(`[effectExecutor] Executing effect ${E+1}/${_.customEffects.middleEffects.length}:`,_.customEffects.middleEffects[E].params.action);const j=_.customEffects.middleEffects[E];if(C=gn(n,o,C,i,j).newState,console.log(`[effectExecutor] Effect ${E+1} done. actionRequired?`,!!C.actionRequired),C.actionRequired){const A=_.customEffects.middleEffects.slice(E+1);return console.log(`[effectExecutor]  Action required! Remaining effects: ${A.length}`),console.log(`[effectExecutor] Current effect index: ${E}, Total effects: ${_.customEffects.middleEffects.length}`),console.log("[effectExecutor] Remaining effects:",A.map(L=>`${L.params.action} (trigger: ${L.trigger}, useCardFromPreviousEffect: ${L.useCardFromPreviousEffect})`)),A.length>0?(console.log(`[effectExecutor]  Setting _pendingCustomEffects with ${A.length} effects`),C._pendingCustomEffects={sourceCardId:n.id,laneIndex:o,context:i,effects:A},console.log("[effectExecutor]  _pendingCustomEffects confirmed set:",!!C._pendingCustomEffects)):console.log("[effectExecutor]  No remaining effects - this was the last effect"),{newState:Ae(C)}}}return{newState:Ae(C)}}const m=`${n.protocol}-${n.value}`,v=kv[m];if(v){let w=c;(s==="middle"||s==="play")&&(w=io(w));const x=`${n.protocol}-${n.value}`;w=Ue(w,x),w=Le(w,"middle");const C=v(n,o,w,i);let S=C.newState;const E=Ae(S);return{...C,newState:E}}return{newState:c}}function Ga(n,o,c,i){if(!n.isFaceUp)return{newState:c};const r=n;if(r.customEffects&&r.customEffects.bottomEffects){const f=r.customEffects.bottomEffects.filter(p=>p.trigger==="on_cover");if(f.length>0){const p=`${n.protocol}-${n.value}`;let h=Ue(c,p);h=Le(h,void 0);let _=h;for(const w of f)if(_=gn(n,o,_,i,w).newState,_.actionRequired){let C=io(_);return{newState:Ae(C)}}let m=io(_);return{newState:Ae(m)}}}const l=`${n.protocol}-${n.value}`,s=Zv[l];if(s){const f=`${n.protocol}-${n.value}`;let p=Ue(c,f);p=Le(p,void 0);const h=s(n,o,p,i);let _=io(h.newState);const m=Ae(_);return{...h,newState:m}}return{newState:c}}function Th(n,o,c){const i=n.turn;let r={...n};const l=o==="Start"?r.processedStartEffectIds||[]:r.processedEndEffectIds||[],s=[],f=new Set;r[i].lanes.flat().forEach(p=>{p.isFaceUp&&p.top.includes(`'emphasis'>${o}:`)&&!l.includes(p.id)&&!f.has(p.id)&&(s.push({card:p,box:"top"}),f.add(p.id))}),r[i].lanes.forEach(p=>{if(p.length>0){const h=p[p.length-1];h.isFaceUp&&h.bottom.includes(`'emphasis'>${o}:`)&&!l.includes(h.id)&&!f.has(h.id)&&(s.push({card:h,box:"bottom"}),f.add(h.id))}});for(const{card:p,box:h}of s){const _=r[i].lanes.find(j=>j.some(D=>D.id===p.id));if(!_||!_.some(j=>j.id===p.id&&j.isFaceUp)||h==="bottom"&&!(_[_.length-1].id===p.id))continue;const v=i==="player"?"opponent":"player",w={cardOwner:i,actor:i,currentTurn:n.turn,opponent:v,triggerType:o==="Start"?"start":"end"},x=p,C=o==="Start"?"start":"end";if(x.customEffects){const j=h==="top"?x.customEffects.topEffects:x.customEffects.bottomEffects,D=(j==null?void 0:j.filter(A=>A.trigger===C))||[];if(D.length>0){r=io(r);const A=`${p.protocol}-${p.value}`,L=o==="Start"?"start":"end";r=Ue(r,A),r=Le(r,L),r=T(r,i,`${o} Effect: ${p.protocol}-${p.value} triggers.`);const H=r[i].lanes.findIndex(B=>B.some(z=>z.id===p.id));for(const B of D){const z=gn(p,H,r,w,B);if(r=Ae(z.newState),r.actionRequired){const V=o==="Start"?"processedStartEffectIds":"processedEndEffectIds";return r[V]=[...r[V]||[],p.id],{newState:r}}}const ce=o==="Start"?"processedStartEffectIds":"processedEndEffectIds";r[ce]=[...r[ce]||[],p.id],r=mn(r),r=Ue(r,void 0),r=Le(r,void 0);continue}}const S=`${p.protocol}-${p.value}`,E=c[S];if(E){r=io(r);const j=`${p.protocol}-${p.value}`,D=o==="Start"?"start":"end";r=Ue(r,j),r=Le(r,D),r=T(r,i,`${o} Effect: ${p.protocol}-${p.value} triggers.`);const A=E(p,r,w);r=Ae(A.newState);const L=o==="Start"?"processedStartEffectIds":"processedEndEffectIds";if(r[L]=[...r[L]||[],p.id],r.actionRequired)return{newState:r};r=mn(r),r=Ue(r,void 0),r=Le(r,void 0)}}return{newState:r}}function Nh(n){return Th(n,"Start",Uv)}function a0(n){return Th(n,"End",Bv)}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function he(n,o){if(!o)return null;for(const c of["player","opponent"])for(const i of n[c].lanes){const r=i.find(l=>l.id===o);if(r)return{card:r,owner:c}}return null}function Wt(n,o){if(!o)return!1;for(const c of["player","opponent"])for(const i of n[c].lanes)if(i.length>0&&i[i.length-1].id===o)return!0;return!1}function r0(n,o,c){var f;let i={...n};const r=(f=n.actionRequired)==null?void 0:f.followUpEffect,l=he(i,o),s=l?mt(l.card,i[l.owner].lanes.find(p=>p.some(h=>h.id===o))||[]):0;if(i.actionRequired=null,r&&c){const p=he(i,c);if(p){console.log("[Custom Effect] Executing conditional follow-up effect after flip");const h={cardOwner:p.owner,opponent:p.owner==="player"?"opponent":"player",currentTurn:i.turn,actor:p.owner,referencedCard:l==null?void 0:l.card,referencedCardValue:s};console.log(`[Context Propagation] Flipped card ${l==null?void 0:l.card.protocol}-${l==null?void 0:l.card.value}, value: ${s}`);let _=-1;for(let m=0;m<i[p.owner].lanes.length;m++)if(i[p.owner].lanes[m].some(v=>v.id===c)){_=m;break}if(_!==-1)return gn(p.card,_,i,h,r).newState}}return i}function Fh(n,o,c,i){var m,v,w,x;let r={...n};const l=(m=n.actionRequired)==null?void 0:m.followUpEffect,s=(v=n.actionRequired)==null?void 0:v.conditionalType;if(r.actionRequired=null,i&&(r=mn(r)),l&&i){const C=he(r,i);if(C){const S=((w=n.actionRequired)==null?void 0:w.previousHandSize)||0,E=r[o].hand.length,j=Math.max(0,S-E);if(!(s==="then"||s==="if_executed"&&j>0))return console.log(`[Custom Effect] Skipping follow-up effect - conditional type: ${s}, discarded: ${j}`),r;console.log(`[Custom Effect] Executing conditional follow-up effect after discard (type: ${s})`);const A={cardOwner:C.owner,opponent:C.owner==="player"?"opponent":"player",currentTurn:r.turn,discardedCount:j};console.log(`[Context Propagation] Discarded ${j} cards`);let L=-1;for(let H=0;H<r[C.owner].lanes.length;H++)if(r[C.owner].lanes[H].some(ce=>ce.id===i)){L=H;break}if(L!==-1)return gn(C.card,L,r,A,l).newState}return r}if(!c||!i)return r;const f=(x=he(r,i))==null?void 0:x.card,p=f?`${f.protocol}-${f.value}`:"A card effect",h=r.queuedActions&&r.queuedActions.length>0;let _=null;switch(c){case"fire_1":r=T(r,o,`${p}: Discard successful. Prompting to delete 1 card.`),_={type:"select_cards_to_delete",count:1,sourceCardId:i,disallowedIds:[i],actor:o};break;case"fire_2":r=T(r,o,`${p}: Discard successful. Prompting to return 1 card.`),_={type:"select_card_to_return",sourceCardId:i,actor:o};break;case"fire_3":r=T(r,o,`${p}: Discard successful. Prompting to flip 1 card.`),_={type:"select_card_to_flip_for_fire_3",sourceCardId:i,actor:o};break}if(_)if(h){const C=r.queuedActions||[],S=C.filter(j=>j.type==="shift_flipped_card_optional"||j.type==="gravity_2_shift_after_flip"),E=C.filter(j=>j.type!=="shift_flipped_card_optional"&&j.type!=="gravity_2_shift_after_flip");r.queuedActions=[...E,_,...S]}else r.actionRequired=_;return r}function $o(n,o,c=null){const i=he(n,o);if(!i)return n;const{card:r,owner:l}=i;if(!r.isFaceUp){let S=-1;for(let E=0;E<n[l].lanes.length;E++)if(n[l].lanes[E].some(j=>j.id===o)){S=E;break}if(S!==-1){const E=e0(n,S);if(!E.allowed)return console.log(`Flip blocked: ${E.reason}`),n}}let f=Ct(n,"on_flip",{cardId:o}).newState;if(!he(f,o))return console.log(`[on_flip] Card ${r.protocol}-${r.value} no longer exists after on_flip effect`),f;const h=f.actionRequired&&"actor"in f.actionRequired?f.actionRequired.actor:f.turn,_=h==="player"?"Player":"Opponent",m=l==="player"?"Player's":"Opponent's",v=r.isFaceUp?"face-down":"face-up",w=`${r.protocol}-${r.value}`;f=T(f,h,`${_} flips ${m} ${w} ${v}.`);const x={...f.stats[h],cardsFlipped:f.stats[h].cardsFlipped+1},C={...f[h],stats:x};return f={...f,[h]:C,stats:{...f.stats,[h]:x}},f=Lt(new Set([o]),f),f.animationState={type:"flipCard",cardId:o},f.actionRequired=c,f}function kn(n,o,c){var s;const i=n[o].lanes[c];if(i.length===0)return{newState:n};const r=i[i.length-1],l=Wt(n,r.id);if(r.isFaceUp&&l){const f=`${r.id}-${c}`;if((s=n.processedUncoverEventIds)!=null&&s.includes(f))return{newState:n};const p=`${r.protocol}-${r.value}`;let h=Ue(n,p);h=Le(h,"uncover"),h=T(h,o,`${r.protocol}-${r.value} is uncovered and its effects are re-triggered.`),h=io(h),h.processedUncoverEventIds=[...h.processedUncoverEventIds||[],f];const _={cardOwner:o,actor:o,currentTurn:h.turn,opponent:o==="player"?"opponent":"player",triggerType:"uncover"},m=el(r,c,h,_);if(m.newState.actionRequired||(m.newState=mn(m.newState),m.newState=Ue(m.newState,void 0),m.newState=Le(m.newState,void 0)),m.newState.actionRequired){const v=m.newState.actionRequired.actor;if(n._interruptedTurn&&v===n._interruptedTurn)return m.newState.queuedActions=[...m.newState.queuedActions||[],m.newState.actionRequired],m.newState.actionRequired=null,m;v!==n.turn&&(m.newState._interruptedTurn=n.turn,m.newState._interruptedPhase=n.phase,m.newState.turn=v,m.newState.actionRequired.type==="prompt_rearrange_protocols"&&(m.newState.actionRequired={...m.newState.actionRequired,originalAction:{type:"resume_interrupted_turn",interruptedTurn:n.turn,interruptedPhase:n.phase}}))}else m.newState._interruptedTurn&&(m.newState.turn=m.newState._interruptedTurn,m.newState._interruptedTurn=void 0);return m}return{newState:n}}function Cc(n,o){const c=he(n,o);if(!c)return{newState:n};const{card:i,owner:r}=c,l=n[r].lanes.findIndex(S=>S.some(E=>E.id===i.id));if(l===-1)return{newState:n};const s=n[r].lanes[l],f=s.length>0&&s[s.length-1].id===o,p=s.length>1&&!f;let h={...n};const _={...h[r]};_.lanes=_.lanes.map(S=>S.filter(E=>E.id!==o)),_.hand=[..._.hand,{...i,isFaceUp:!0,isRevealed:!1}],h[r]=_;const m=h.actionRequired&&"actor"in h.actionRequired?h.actionRequired.actor:h.turn,v=m==="player"?"Player":"Opponent",w=r==="player"?"Player's":"Opponent's",x=`${i.protocol}-${i.value}`;h=T(h,m,`${v} returns ${w} ${x} to their hand.`),h.actionRequired=null;const C=Ae(h);return(f||p)&&C[r].lanes[l].length>0?kn(C,r,l):{newState:C}}function ra(n,o,c,i,r){console.log("[DEBUG internalShiftCard] Attempting to shift card",o,"to lane",i,"owner:",c);const l=he(n,o);if(!l||l.owner!==c)return{newState:n};const{card:s}=l,f=n[c];let p=-1;for(let q=0;q<f.lanes.length;q++)if(f.lanes[q].some(N=>N.id===o)){p=q;break}if(p===-1)return{newState:n};console.log("[DEBUG internalShiftCard] Shifting from lane",p,"to lane",i);const h=t0(n,p,i);if(!h.allowed)return console.log(`[SHIFT BLOCKED] ${h.reason}`),{newState:n};const _=n[c].lanes[p],m=_.length>0&&_[_.length-1].id===o,v=f.lanes.map((q,N)=>N===p?q.filter(k=>k.id!==o):q),w=v[i].length>0?v[i][v[i].length-1]:null,x=v.map((q,N)=>N===i?[...q,s]:q),C={...f,lanes:x};let S={...n,[c]:C};(!n._currentEffectSource||!n._currentPhaseContext)&&(S=Ue(S,void 0),S=Le(S,void 0));const E=r==="player"?"Player":"Opponent",j=c==="player"?"Player's":"Opponent's",D=s.isFaceUp?`${s.protocol}-${s.value}`:"a card",A=S[c].protocols[i];S=T(S,r,`${E} shifts ${j} ${D} to Protocol ${A}.`);const L={...S.stats[r],cardsShifted:S.stats[r].cardsShifted+1},H={...S[r],stats:L};S={...S,[r]:H,stats:{...S.stats,[r]:L}},S.actionRequired=null;let ce=Ae(S),B={newState:ce};if(w){const q={cardOwner:c,actor:r,currentTurn:ce.turn,opponent:c==="player"?"opponent":"player",triggerType:"cover"};B=Ga(w,i,ce,q)}let z=B.newState,V=[...B.animationRequests||[]];if(m){const q=kn(z,c,p);z=q.newState,q.animationRequests&&V.push(...q.animationRequests)}const le=z[c].lanes[i],G=le.length>0&&le[le.length-1].id===o,P=!m;if(G&&s.isFaceUp&&P){const q=kn(z,c,i);return q.animationRequests&&V.push(...q.animationRequests),{newState:q.newState,animationRequests:V.length>0?V:void 0}}return{newState:z,animationRequests:V.length>0?V:void 0}}const l0=(n,o,c)=>{let i=0;for(const r of["player","opponent"])for(let l=0;l<n[r].lanes.length;l++){const s=n[r].lanes[l];if(s.length>0){const f=s[s.length-1];o.includes(f.id)||i++}}return i},Lo=(n,o)=>{const c=he(n,o);if(!c)return{newState:n};const{card:i,owner:r}=c,l=n[r].lanes.findIndex(p=>p.some(h=>h.id===i.id));if(l===-1)return{newState:n};const s={cardOwner:r,actor:r,currentTurn:n.turn,opponent:r==="player"?"opponent":"player",triggerType:"flip"},f=el(i,l,n,s);if(f.newState.actionRequired){const p=f.newState.actionRequired.actor;if(n._interruptedTurn&&p===n._interruptedTurn)return f.newState.queuedActions=[...f.newState.queuedActions||[],f.newState.actionRequired],f.newState.actionRequired=null,f;p!==n.turn&&(f.newState._interruptedTurn=n.turn,f.newState._interruptedPhase=n.phase,f.newState.turn=p,f.newState.actionRequired.type==="prompt_rearrange_protocols"&&(f.newState.actionRequired={...f.newState.actionRequired,originalAction:{type:"resume_interrupted_turn",interruptedTurn:n.turn,interruptedPhase:n.phase}}))}return f};function Sc(n,o){const c=[];if(n[o].lanes.forEach((r,l)=>{if(r.length>0){const s=r[r.length-1],f=mt(s,r);c.push({card:s,laneIndex:l,owner:o,value:f})}}),c.length===0)return[];const i=Math.max(...c.map(r=>r.value));return c.filter(r=>r.value===i)}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function gn(n,o,c,i,r){const l=r.params,s=l.action,f=he(c,n.id);if(!f)return{newState:c};if(!f.card.isFaceUp)return{newState:c};if((r.position||"middle")!=="top"&&!Wt(c,n.id))return{newState:c};if(l.optional===!0){console.log(`[Custom Effect] Optional effect detected (${s}) - creating prompt`);let m={...c};return m.actionRequired={type:"prompt_optional_effect",actor:i.cardOwner,sourceCardId:n.id,effectDef:r,laneIndex:o},{newState:m}}let _;switch(s){case"draw":_=c0(n,o,c,i,l);break;case"flip":_=s0(n,o,c,i,l);break;case"delete":_=i0(n,o,c,i,l);break;case"discard":_=d0(n,o,c,i,l);break;case"shift":_=u0(n,o,c,i,l);break;case"return":_=p0(n,o,c,i,l);break;case"play":_=f0(n,o,c,i,l);break;case"rearrange_protocols":case"swap_protocols":_=h0(n,o,c,i,l);break;case"reveal":case"give":_=y0(n,o,c,i,l);break;case"take":_=_0(n,o,c,i,l);break;case"choice":_=m0(n,o,c,i,l);break;default:console.error(`[Custom Effect] Unknown action: ${s}`),_={newState:c};break}if(r.conditional&&r.conditional.thenEffect){const{newState:m}=_;console.log("[Custom Effect] Effect has conditional follow-up:",r.id,"Conditional type:",r.conditional.type,"Action created?",!!m.actionRequired),m.actionRequired?(console.log("[Custom Effect] Storing follow-up effect for later execution:",r.conditional.thenEffect.id),_={newState:{...m,actionRequired:{...m.actionRequired,followUpEffect:r.conditional.thenEffect,conditionalType:r.conditional.type}}}):(console.log("[Custom Effect] Executing conditional follow-up effect immediately"),_=gn(n,o,m,i,r.conditional.thenEffect))}return _}function c0(n,o,c,i,r){var x,C;const{cardOwner:l}=i,f=(r.target||"self")==="opponent"?i.opponent:l;if(r.conditional){let S=0;switch(r.conditional.type){case"non_matching_protocols":{for(let H=0;H<3;H++){const ce=c.player.protocols[H],B=c.opponent.protocols[H],z=c.player.lanes[H].filter(P=>P.isFaceUp),V=c.opponent.lanes[H].filter(P=>P.isFaceUp);[...z,...V].some(P=>P.protocol!==ce&&P.protocol!==B)&&S++}console.log(`[Draw Effect] non_matching_protocols: ${S} lanes have non-matching face-up cards`);break}case"count_face_down":{S=c[l].lanes[o].filter(ce=>!ce.isFaceUp).length,console.log(`[Draw Effect] count_face_down: ${S} face-down cards in lane`);break}case"is_covering":{const H=c[l].lanes[o],B=H.findIndex(z=>z.id===n.id)<H.length-1;S=B?r.count||1:0,console.log(`[Draw Effect] is_covering: ${B?"yes":"no"}`);break}}let E=S;if(E<=0)return console.log(`[Draw Effect] Conditional count is ${E}, skipping draw`),{newState:c};const{drawnCards:j,remainingDeck:D}=sh(c[f].deck,c[f].hand,E);let A={...c};return A[f]={...A[f],deck:D,hand:j},A=T(A,f,`${f==="player"?"Player":"Opponent"} draws ${E} card${E!==1?"s":""} from non-matching protocols.`),{newState:A}}let p=r.count||1;switch(r.countType||"fixed"){case"equal_to_card_value":p=i.referencedCardValue||0,console.log(`[Draw Effect] Using referenced card value: ${p}`);break;case"equal_to_discarded":p=(i.discardedCount||0)+(r.countOffset||0),console.log(`[Draw Effect] Using discarded count: ${i.discardedCount} + offset ${r.countOffset} = ${p}`);break;case"hand_size":p=i.handSize||0,console.log(`[Draw Effect] Using hand size: ${p}`);break;case"fixed":default:p=r.count||1;break}if(p<=0)return console.log(`[Draw Effect] Count is ${p}, skipping draw`),{newState:c};if(((x=r.advancedConditional)==null?void 0:x.type)==="protocol_match"){const S=r.advancedConditional.protocol,E=c[l].protocols[o];if(E!==S)return console.log(`[Draw Effect] Protocol match failed: card is in ${E} lane, requires ${S}. Skipping draw.`),{newState:c};console.log(`[Draw Effect] Protocol match success: card is in ${E} lane (requires ${S}).`)}let _={...c};if(((C=r.advancedConditional)==null?void 0:C.type)==="compile_block"){const S=r.advancedConditional.turnDuration||1,E=l==="player"?"opponent":"player";_={..._,compileBlockedUntilTurn:(_.turnNumber||0)+S,compileBlockedPlayer:E},console.log(`[Draw Effect] Opponent's compile blocked for ${S} turn(s).`),_=T(_,l,`Opponent can't compile for ${S} turn${S!==1?"s":""}.`)}if(r.optional)return _.actionRequired={type:"prompt_optional_draw",sourceCardId:n.id,actor:l,count:p,drawingPlayer:f},{newState:_};const{drawnCards:m,remainingDeck:v}=sh(_[f].deck,_[f].hand,p);return _[f]={..._[f],deck:v,hand:m},_=T(_,f,`${f==="player"?"Player":"Opponent"} draws ${p} card${p!==1?"s":""}.`),{newState:_}}function s0(n,o,c,i,r){var v;const{cardOwner:l}=i;if(r.flipSelf){if(((v=r.advancedConditional)==null?void 0:v.type)==="protocol_match"){const S=r.advancedConditional.protocol,E=c[l].protocols[o];if(E!==S)return console.log(`[Flip Effect] Protocol match failed: card is in ${E} lane, requires ${S}. Skipping flip.`),{newState:c};console.log(`[Flip Effect] Protocol match success: card is in ${E} lane (requires ${S}).`)}let w={...c};const C=w[l].lanes[o].find(S=>S.id===n.id);if(C){C.isFaceUp=!C.isFaceUp;const S=l==="player"?"Player":"Opponent",E=C.isFaceUp?"face-up":"face-down";w=T(w,l,`${S} flips this card ${E}.`)}return{newState:w}}const s=r.count||1;if(r.scope==="this_lane"&&(s==="all"||typeof s!="number")){let w={...c};const x=l==="player"?"opponent":"player",C=r.targetFilter||{},S=new Set,E=w[l].lanes[o];for(const D of E)C.excludeSelf&&D.id===n.id||C.faceState==="face_up"&&!D.isFaceUp||C.faceState==="face_down"&&D.isFaceUp||C.owner!=="opponent"&&S.add(D.id);const j=w[x].lanes[o];for(const D of j)C.faceState==="face_up"&&!D.isFaceUp||C.faceState==="face_down"&&D.isFaceUp||C.owner!=="own"&&S.add(D.id);if(S.size>0){w=T(w,l,`Flipping ${S.size} card(s) in this lane.`);for(const D of S)for(const A of["player","opponent"])for(const L of w[A].lanes){const H=L.find(ce=>ce.id===D);H&&(H.isFaceUp=!H.isFaceUp)}return{newState:w}}else return w=T(w,l,"No cards to flip in this lane."),{newState:w}}const p=r.targetFilter||{},h=p.position||"uncovered",_=[];for(const w of["player","opponent"])for(let x=0;x<c[w].lanes.length;x++){const C=c[w].lanes[x];if(!(r.scope==="this_lane"&&x!==o))for(let S=0;S<C.length;S++){const E=C[S],j=S===C.length-1;p.excludeSelf&&E.id===n.id||p.owner==="own"&&w!==l||p.owner==="opponent"&&w===l||h==="uncovered"&&!j||h==="covered"&&j||p.faceState==="face_up"&&!E.isFaceUp||p.faceState==="face_down"&&E.isFaceUp||_.push(E.id)}}if(_.length===0)return{newState:T(c,l,"No valid cards to flip. Effect skipped.")};let m=T(c,l,`[Custom Flip effect - selecting ${s} card(s) to flip]`);return m.actionRequired={type:"select_card_to_flip",count:s,sourceCardId:n.id,actor:l,targetFilter:r.targetFilter,optional:r.optional||!1,scope:r.scope,laneIndex:r.scope==="this_lane"?o:void 0},{newState:m}}function i0(n,o,c,i,r){var x,C,S;const{cardOwner:l}=i,s=r.count||1;if((x=r.scope)!=null&&x.minCardsInLane){const E=r.scope.minCardsInLane,j=c.lanes[o].length;if(j<E)return console.log(`[Delete Effect] Line filter not met: ${j} < ${E} cards in lane. Skipping delete.`),{newState:c};console.log(`[Delete Effect] Line filter met: ${j} >= ${E} cards in lane.`)}const f=r.actorChooses||"effect_owner",p=((C=r.targetFilter)==null?void 0:C.owner)||"any";let h=l;f==="card_owner"&&p==="opponent"&&(h=i.opponent);const _=r.targetFilter||{},m=_.position||"uncovered",v=[];for(const E of["player","opponent"])for(let j=0;j<c[E].lanes.length;j++){const D=c[E].lanes[j];for(let A=0;A<D.length;A++){const L=D[A],H=A===D.length-1;if(!(r.excludeSelf&&L.id===n.id)&&!(_.owner==="own"&&E!==h)&&!(_.owner==="opponent"&&E===h)&&!(m==="uncovered"&&!H)&&!(m==="covered"&&H)&&!(_.faceState==="face_up"&&!L.isFaceUp)&&!(_.faceState==="face_down"&&L.isFaceUp)){if(_.valueRange){const{min:ce,max:B}=_.valueRange;if(L.value<ce||L.value>B)continue}if(r.protocolMatching){const ce=c.player.protocols[j],B=c.opponent.protocols[j],z=L.protocol,V=z===ce||z===B;if(r.protocolMatching==="must_match"&&!V||r.protocolMatching==="must_not_match"&&V)continue}v.push(L.id)}}}if(v.length===0)return{newState:T(c,l,"No valid cards to delete. Effect skipped.")};let w=T(c,l,`[Custom Delete effect - ${h===l?"you":"opponent"} selecting ${s} card(s) to delete]`);if(r.deleteSelf){const E=he(c,n.id);if(!E)return w=T(w,l,"Source card no longer on board. Delete effect skipped."),{newState:w};const{owner:j,laneIndex:D}=E,A=c[j].lanes[D];if(!A||A.length===0)return w=T(w,l,"Card already deleted. Delete effect skipped."),{newState:w};const L=A[A.length-1].id===n.id;w=T(w,l,`Deleting ${E.card.protocol}-${E.card.value}.`);const H=[...A],ce=H.findIndex(V=>V.id===n.id);H.splice(ce,1);const B=[...w[j].lanes];B[D]=H,w={...w,[j]:{...w[j],lanes:B}};const z={...w.stats[l],cardsDeleted:w.stats[l].cardsDeleted+1};return w={...w,stats:{...w.stats,[l]:z}},L&&H.length>0&&(w=kn(w,j,D).newState),{newState:w}}if(r.selectLane)return w.actionRequired={type:"select_lane_for_delete",sourceCardId:n.id,actor:h,count:r.count,targetFilter:r.targetFilter,deleteAll:r.count==="all"||r.count===void 0},{newState:w};if(((S=r.scope)==null?void 0:S.type)==="each_other_line"){const D=[0,1,2].filter(A=>A!==o).filter(A=>c.player.lanes[A].length>0||c.opponent.lanes[A].length>0).length;return D===0?(w=T(w,l,"No other lanes have cards. Effect skipped."),{newState:w}):(w.actionRequired={type:"select_card_from_other_lanes_to_delete",sourceCardId:n.id,disallowedLaneIndex:o,lanesSelected:[],count:D,actor:h,targetFilter:r.targetFilter},{newState:w})}return w.actionRequired={type:"select_cards_to_delete",count:s,sourceCardId:n.id,actor:h,disallowedIds:r.excludeSelf?[n.id]:[],targetFilter:r.targetFilter,scope:r.scope,protocolMatching:r.protocolMatching},{newState:w}}function d0(n,o,c,i,r){const{cardOwner:l}=i,s=r.actor==="opponent"?i.opponent:l;let f=r.count||1;if((r.countType||"fixed")==="equal_to_discarded"&&(f=(i.discardedCount||0)+(r.countOffset||0),console.log(`[Discard Effect] Using dynamic count: ${i.discardedCount} + ${r.countOffset} = ${f}`),f<=0))return console.log("[Discard Effect] Dynamic count is 0 or less, skipping discard."),{newState:c};if(c[s].hand.length===0)return console.log(`[Discard Effect] ${s} has no cards to discard - skipping effect.`),{newState:c};let h={...c};return h.actionRequired={type:"discard",actor:s,count:f,sourceCardId:n.id,variableCount:r.variableCount||!1,previousHandSize:c[s].hand.length},{newState:h}}function u0(n,o,c,i,r){const{cardOwner:l}=i;let s={...c};const f=c._selectedCardFromPreviousEffect;if(f)return delete s._selectedCardFromPreviousEffect,s.actionRequired={type:"shift_flipped_card_optional",cardId:f,sourceCardId:n.id,optional:r.optional||!1,actor:l},{newState:s};const p=r.targetFilter||{},h=p.position||"uncovered",_=p.faceState||"any",m=p.owner||"any",v=p.excludeSelf||!1,w=[];for(const S of["player","opponent"])if(!(m==="own"&&S!==l)&&!(m==="opponent"&&S===l))for(let E=0;E<s[S].lanes.length;E++){const j=s[S].lanes[E];for(let D=0;D<j.length;D++){const A=j[D];if(v&&A.id===n.id)continue;const L=D===j.length-1;h==="uncovered"&&!L||h==="covered"&&L||_==="face_up"&&!A.isFaceUp||_==="face_down"&&A.isFaceUp||w.push({card:A,currentLane:E,owner:S})}}if(w.length===0)return s=T(s,l,"[Custom Shift] No valid cards to shift."),{newState:s};const x=r.destinationRestriction;let C=!1;for(const{card:S,currentLane:E,owner:j}of w){if((x==null?void 0:x.type)==="non_matching_protocol"&&!S.isFaceUp)continue;const D=S.protocol;for(let A=0;A<3;A++)if(A!==E){if(x){if(x.type==="non_matching_protocol"){const L=s.player.protocols[A],H=s.opponent.protocols[A];if(D===L||D===H)continue}else if(x.type==="specific_lane"&&A!==E)continue}C=!0;break}if(C)break}return C?(s=T(s,l,"[Custom Shift effect - selecting card to shift]"),s.actionRequired={type:"select_card_to_shift",sourceCardId:n.id,actor:l,targetFilter:r.targetFilter,destinationRestriction:r.destinationRestriction},{newState:s}):(s=T(s,l,"[Custom Shift] No valid shift destinations available."),{newState:s})}function p0(n,o,c,i,r){var m;const{cardOwner:l,opponent:s}=i,f=r.count==="all"?99:r.count||1,p=((m=r.targetFilter)==null?void 0:m.owner)||"any";let h=[];if(p==="own"?h=c[l].lanes.flat():p==="opponent"?h=c[s].lanes.flat():h=[...c.player.lanes.flat(),...c.opponent.lanes.flat()],h.length===0)return{newState:T(c,l,"No cards on board to return. Effect skipped.")};let _=T(c,l,`[Custom Return effect - selecting ${f} card(s) to return]`);return _.actionRequired={type:"select_card_to_return",sourceCardId:n.id,actor:l,targetOwner:p},{newState:_}}function f0(n,o,c,i,r){var v;const{cardOwner:l}=i,s=r.count||1,f=r.source||"hand",p=r.faceDown||!1,h=r.actor==="opponent"?i.opponent:l;if(f==="hand"&&c[h].hand.length===0)return console.log(`[Play Effect] ${h} has no cards in hand to play - skipping effect.`),{newState:c};let _=T(c,l,`[Custom Play effect - playing ${s} card(s) ${p?"face-down":"face-up"} from ${f}]`),m;return(v=r.destinationRule)!=null&&v.excludeCurrentLane&&(m=o),_.actionRequired={type:"select_card_from_hand_to_play",count:s,sourceCardId:n.id,actor:h,faceDown:p,source:f,disallowedLaneIndex:m,destinationRule:r.destinationRule,condition:r.condition},{newState:_}}function h0(n,o,c,i,r){const{cardOwner:l,opponent:s}=i,f=r.action,h=(r.target||"own")==="opponent"?s:l,_=l;let m=T(c,l,`[Custom Protocol effect - ${f} for ${h}]`),v;return r.restriction&&(v={laneIndex:r.restriction.laneIndex==="current"?o:r.restriction.laneIndex,protocol:r.restriction.disallowedProtocol}),f==="rearrange_protocols"?m.actionRequired={type:"prompt_rearrange_protocols",actor:_,target:h,sourceCardId:n.id,disallowedProtocolForLane:v}:f==="swap_protocols"&&(m.actionRequired={type:"prompt_swap_protocols",actor:_,target:h,sourceCardId:n.id,disallowedProtocolForLane:v}),{newState:m}}function y0(n,o,c,i,r){const{cardOwner:l}=i,s=r.count||1,f=r.action;if(c[l].hand.length===0)return{newState:T(c,l,`No cards in hand to ${f}. Effect skipped.`)};let p=T(c,l,`[Custom ${f} effect - selecting ${s} card(s)]`);return f==="reveal"?p.actionRequired={type:"select_card_from_hand_to_reveal",count:s,sourceCardId:n.id,actor:l}:f==="give"&&(p.actionRequired={type:"select_card_from_hand_to_give",count:s,sourceCardId:n.id,actor:l}),{newState:p}}function _0(n,o,c,i,r){const{cardOwner:l,opponent:s}=i,f=r.count||1,p=r.random!==!1;if(c[s].hand.length===0)return{newState:T(c,l,"Opponent has no cards in hand. Effect skipped.")};let h=T(c,l,`[Custom Take effect - taking ${f} card(s) from opponent's hand]`);return h.actionRequired={type:p?"take_random_from_opponent_hand":"take_from_opponent_hand",count:f,sourceCardId:n.id,actor:l},{newState:h}}function m0(n,o,c,i,r){const{cardOwner:l}=i,s=r.options||[];if(s.length!==2)return console.error(`[Choice Effect] Expected 2 options, got ${s.length}`),{newState:c};let f=T(c,l,"[Custom Choice effect - choose one of two options]");return f.actionRequired={type:"custom_choice",options:s,sourceCardId:n.id,actor:l,laneIndex:o},{newState:f}}function sh(n,o,c){const i=Math.min(c,n.length),r=n.slice(0,i).map(f=>({...f,id:He(),isFaceUp:!0})),l=[...o,...r],s=n.slice(i);return{drawnCards:l,remainingDeck:s}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function Ct(n,o,c){let i={...n};if(i._processingReactiveEffects)return console.log(`[Reactive Effects] Already processing reactive effects, skipping ${o}`),{newState:i};i={...i,_processingReactiveEffects:!0};const r=[];for(const l of["player","opponent"])i[l].lanes.forEach((s,f)=>{s.forEach(p=>{if(p.isFaceUp){const h=p;h.customEffects&&h.customEffects.topEffects&&h.customEffects.topEffects.filter(m=>m.trigger===o).length>0&&r.push({card:p,owner:l,laneIndex:f,box:"top"})}})});if(r.length===0)return delete i._processingReactiveEffects,{newState:i};console.log(`[Reactive Effects] Found ${r.length} card(s) with ${o} trigger`);for(const{card:l,owner:s,laneIndex:f}of r){const p=i[s].lanes[f];if(!(p==null?void 0:p.some(S=>S.id===l.id&&S.isFaceUp))){console.log(`[Reactive Effects] Card ${l.protocol}-${l.value} no longer face-up, skipping`);continue}if(o==="before_compile_delete"&&(c==null?void 0:c.cardId)!==l.id||o==="on_flip"&&(c==null?void 0:c.cardId)!==l.id||(o==="on_cover"||o==="on_flip")&&c!=null&&c.cardId&&c.cardId!==l.id)continue;const m=l.customEffects.topEffects.filter(S=>S.trigger===o||S.trigger==="on_cover_or_flip"&&(o==="on_cover"||o==="on_flip")),v=`${l.protocol}-${l.value}`;i=io(i),i=Ue(i,v),i=Le(i,void 0);const w=g0(o);i=T(i,s,`${w}: ${v} triggers.`);const x=s==="player"?"opponent":"player",C={cardOwner:s,currentTurn:i.turn,opponent:x};for(const S of m){const E=gn(l,f,i,C,S);if(i=Ae(E.newState),i.actionRequired)return console.log(`[Reactive Effects] Action required after ${v} reactive effect`),delete i._processingReactiveEffects,{newState:i}}i=mn(i),i=Ue(i,void 0),i=Le(i,void 0)}return delete i._processingReactiveEffects,{newState:i}}function g0(n){switch(n){case"after_delete":return"After you delete cards";case"after_opponent_discard":return"After opponent discards";case"after_draw":return"After you draw cards";case"after_clear_cache":return"After you clear cache";case"before_compile_delete":return"Before deleted by compile";case"after_flip":return"After cards are flipped";case"after_shift":return"After cards are shifted";case"after_play":return"After cards are played";case"on_flip":return"When this card would be flipped";case"on_cover_or_flip":return"When this card would be covered or flipped";default:return n}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function uo(n,o,c){let i=[...n],r=[...o],l=[],s=!1;for(let f=0;f<c;f++){if(i.length===0){if(r.length===0)break;i=On(r),r=[],s=!0}l.push(i.shift())}return{drawnCards:l,remainingDeck:i,newDiscard:r,reshuffled:s}}function qh(n,o){const c=n[o];let i=n;const r=c.lanes.flat().filter(l=>l.protocol==="Spirit"&&l.value===3&&l.isFaceUp);if(r.length>0)for(const l of r){i=T(i,o,"Spirit-3 triggers after drawing: You may shift this card.");const s={type:"prompt_shift_for_spirit_3",sourceCardId:l.id,optional:!0,actor:o};i.queuedActions=[...i.queuedActions||[],s]}return i}function Ge(n,o,c){const i=n[o],{drawnCards:r,remainingDeck:l,newDiscard:s,reshuffled:f}=uo(i.deck,i.discard,c);if(r.length===0)return n;const p=r.map(w=>({...w,id:He(),isFaceUp:!0})),h=p.map(w=>w.id),_={...i.stats,cardsDrawn:i.stats.cardsDrawn+r.length},m={...i,deck:l,discard:s,hand:[...i.hand,...p],stats:_};let v={...n,[o]:m,stats:{...n.stats,[o]:_}};return h.length>0&&(v.animationState={type:"drawCard",owner:o,cardIds:h}),f&&(v=T(v,o,`${o==="player"?"Player":"Opponent"}'s deck is empty. Discard pile has been reshuffled into the deck.`)),r.length>0&&(v=qh(v,o),v=Ct(v,"after_draw",{count:r.length}).newState),v}function Uh(n,o,c){const i=o==="player"?"opponent":"player";let r={...n};const l={...r[i]},s={...r[o]},{drawnCards:f,remainingDeck:p,newDiscard:h,reshuffled:_}=uo(l.deck,l.discard,c);if(f.length>0){const m=f.map(x=>({...x,id:He(),isFaceUp:!0})),v=m.map(x=>x.id);s.hand=[...s.hand,...m];const w={...s.stats,cardsDrawn:s.stats.cardsDrawn+f.length};s.stats=w,l.deck=p,l.discard=h,r={...r,[o]:s,[i]:l,stats:{...r.stats,[o]:w}},v.length>0&&(r.animationState={type:"drawCard",owner:o,cardIds:v}),_&&(r=T(r,o,`${i==="player"?"Player":"Opponent"}'s deck is empty. Discard pile has been reshuffled into the deck.`)),r=qh(r,o)}return r}function pd(n,o){const i=5-n[o].hand.length;if(i<=0)return n;const r=o==="player"?"Player":"Opponent";let l=Ge(n,o,i);const s={...l[o],stats:{...l[o].stats,handsRefreshed:l[o].stats.handsRefreshed+1}};return l={...l,[o]:s,stats:{...l.stats,[o]:s.stats}},T(l,o,`${r} refreshes their hand, drawing ${i} card(s).`)}function Lt(n,o){const c={...o},i=r=>r.map(l=>l.map(s=>n.has(s.id)?{...s,isFaceUp:!s.isFaceUp}:s));return c.player.lanes=i(c.player.lanes),c.opponent.lanes=i(c.opponent.lanes),Ae(c)}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const ih=n=>{const o=On(so(n)),{drawnCards:c,remainingDeck:i}=uo(o,[],5),r={cardsPlayed:0,cardsDiscarded:0,cardsDeleted:0,cardsFlipped:0,cardsShifted:0,cardsDrawn:c.length,handsRefreshed:0},l=c.map(s=>({...s,id:He(),isFaceUp:!0}));return{protocols:n,deck:i,hand:l,lanes:[[],[],[]],discard:[],compiled:[!1,!1,!1],laneValues:[0,0,0],cannotCompile:!1,stats:r}},Br=(n,o,c,i="player")=>{const r=ih(n),l=ih(o),s={player:r,opponent:l,turn:i,phase:"start",controlCardHolder:null,useControlMechanic:c,winner:null,log:[],actionRequired:null,queuedActions:[],animationState:null,compilableLanes:[],processedStartEffectIds:[],processedEndEffectIds:[],lastPlayedCardId:void 0,stats:{player:r.stats,opponent:l.stats}},f=i==="player"?"Player":"Opponent",p=n.join(", "),h=o.join(", ");let _=T(s,"player","Game Started.");return _=T(_,"player",`Player protocols: ${p}`),_=T(_,"opponent",`Opponent protocols: ${h}`),_=T(_,"player",`${f} goes first.`),_},mt=(n,o,c,i,r)=>{if(n.isFaceUp)return n.value;if(o.some(s=>s.isFaceUp&&s.protocol==="Darkness"&&s.value===2))return 4;if(c&&i!==void 0&&r!==void 0){const s=Oh(c);for(const f of s)if(f.type==="set_to_fixed"){if(!(f.scope==="global"||f.scope==="this_lane"&&f.laneIndex===i))continue;const h=f.cardOwner;if(f.target==="own_cards"&&h!==r||f.target==="opponent_cards"&&h===r)continue;const _=f.filter;if(_&&(!_.faceState||_.faceState==="any"||_.faceState==="face_down"&&!n.isFaceUp||_.faceState==="face_up"&&n.isFaceUp))return f.value}}return 2},dh=(n,o,c,i)=>{let r=0;for(const l of n)l.isFaceUp?r+=l.value:r+=mt(l,n,o,c,i);return Math.max(0,r)};function Oh(n){const o=[];for(const c of["player","opponent"])n[c].lanes.forEach((i,r)=>{i.forEach(l=>{if(l.isFaceUp){const s=l;s.customEffects&&[...s.customEffects.topEffects||[],...s.customEffects.middleEffects||[],...s.customEffects.bottomEffects||[]].forEach(p=>{p.params.action==="value_modifier"&&p.trigger==="passive"&&o.push({...p.params.modifier,cardOwner:c,laneIndex:r})})}})});return o}function v0(n,o,c){const i=Oh(n),r=[...o],l=[...c];for(const s of i){const{type:f,value:p,condition:h,target:_,scope:m,filter:v,cardOwner:w,laneIndex:x}=s,C=m==="global"?[0,1,2]:[x];for(const S of C)switch(f){case"add_per_condition":{if(!h)continue;let E=0;const j=n.player.lanes[S],D=n.opponent.lanes[S];h==="per_face_down_card"?E=j.filter(A=>!A.isFaceUp).length+D.filter(A=>!A.isFaceUp).length:h==="per_face_up_card"?E=j.filter(A=>A.isFaceUp).length+D.filter(A=>A.isFaceUp).length:h==="per_card"&&(E=j.length+D.length),_==="own_total"&&w==="player"?r[S]+=p*E:_==="own_total"&&w==="opponent"||_==="opponent_total"&&w==="player"?l[S]+=p*E:_==="opponent_total"&&w==="opponent"&&(r[S]+=p*E);break}case"set_to_fixed":break;case"add_to_total":{_==="own_total"&&w==="player"?r[S]+=p:_==="own_total"&&w==="opponent"||_==="opponent_total"&&w==="player"?l[S]+=p:_==="opponent_total"&&w==="opponent"&&(r[S]+=p);break}}}return{finalPlayerValues:r.map(s=>Math.max(0,s)),finalOpponentValues:l.map(s=>Math.max(0,s))}}function w0(n,o,c){let i=[...o],r=[...c];for(let l=0;l<3;l++)n.opponent.lanes[l].some(s=>s.isFaceUp&&s.protocol==="Metal"&&s.value===0)&&(i[l]=Math.max(0,i[l]-2)),n.player.lanes[l].some(s=>s.isFaceUp&&s.protocol==="Metal"&&s.value===0)&&(r[l]=Math.max(0,r[l]-2));for(let l=0;l<3;l++){for(const s of n.player.lanes[l])if(s.isFaceUp)switch(`${s.protocol}-${s.value}`){case"Apathy-0":{const f=n.player.lanes[l].filter(h=>!h.isFaceUp).length,p=n.opponent.lanes[l].filter(h=>!h.isFaceUp).length;i[l]+=f+p;break}case"Darkness-2":{const f=n.player.lanes[l].filter(p=>!p.isFaceUp).length;i[l]+=f*2;break}}for(const s of n.opponent.lanes[l])if(s.isFaceUp)switch(`${s.protocol}-${s.value}`){case"Apathy-0":{const f=n.player.lanes[l].filter(h=>!h.isFaceUp).length,p=n.opponent.lanes[l].filter(h=>!h.isFaceUp).length;r[l]+=f+p;break}case"Darkness-2":{const f=n.opponent.lanes[l].filter(p=>!p.isFaceUp).length;r[l]+=f*2;break}}}return{finalPlayerValues:i,finalOpponentValues:r}}const Ae=n=>{const o=n.player.lanes.map((s,f)=>dh(s,n,f,"player")),c=n.opponent.lanes.map((s,f)=>dh(s,n,f,"opponent")),i=w0(n,o,c),{finalPlayerValues:r,finalOpponentValues:l}=v0(n,i.finalPlayerValues,i.finalOpponentValues);return{...n,player:{...n.player,laneValues:r},opponent:{...n.opponent,laneValues:l}}},$h=(n,o)=>{const c=[],i=n[o],r=n[o==="player"?"opponent":"player"];if(!i.cannotCompile)for(let l=0;l<3;l++){const s=i.laneValues[l],f=r.laneValues[l];s>=10&&s>f&&c.push(l)}return c};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const x0=n=>{if(!n.useControlMechanic)return n;const o=n.turn,c=o==="player"?"opponent":"player",i=n[o],r=n[c];let l=0;const s=i.laneValues[0],f=i.laneValues[1],p=i.laneValues[2],h=r.laneValues[0],_=r.laneValues[1],m=r.laneValues[2];if(s>h&&l++,f>_&&l++,p>m&&l++,l>=2&&n.controlCardHolder!==o){let v=Ue(n,void 0);return v=Le(v,void 0),v={...v,_logIndentLevel:0},v=T(v,o,`${o==="player"?"Player":"Opponent"} gains the Control Component.`),{...v,controlCardHolder:o}}return n},Ba=n=>{if(n.winner)return n;const o=n.turn;let c={...n};switch(c=Ue(c,void 0),c=Le(c,void 0),c={...c,_logIndentLevel:0},n.phase){case"start":return c=Nh(c).newState,c.actionRequired?c:(c=Ue(c,void 0),c=Le(c,void 0),c={...c,_logIndentLevel:0},{...c,phase:"control"});case"control":{const i=x0(c);let r=Ue(i,void 0);return r=Le(r,void 0),r={...r,_logIndentLevel:0},{...r,phase:"compile"}}case"compile":{const i=$h(c,o);return i.length>0?{...c,compilableLanes:i}:(c=Ue(c,void 0),c=Le(c,void 0),c={...c,_logIndentLevel:0},{...c,phase:"action",compilableLanes:[]})}case"action":return c=Ue(c,void 0),c=Le(c,void 0),c={...c,_logIndentLevel:0},{...c,phase:"hand_limit"};case"hand_limit":{const i=c[o],r=i.lanes.some(f=>f.length>0&&f[f.length-1].isFaceUp&&f[f.length-1].protocol==="Spirit"&&f[f.length-1].value===0),s=Po(c).some(({rule:f,cardOwner:p})=>f.type==="skip_check_cache_phase"&&(f.target==="self"&&p===o||f.target==="all")&&p===o);if(r||s){let f=T(c,o,"Skipping Check Cache phase.");return f=Ue(f,void 0),f=Le(f,void 0),f={...f,_logIndentLevel:0},{...f,phase:"end"}}if(i.hand.length>5){const f=i.hand.length-5;return{...T(c,o,`Check Cache: ${o==="player"?"Player":"Opponent"} has ${i.hand.length} cards, must discard ${f}.`),actionRequired:{type:"discard",actor:o,count:f}}}return c=Ue(c,void 0),c=Le(c,void 0),c={...c,_logIndentLevel:0},{...c,phase:"end"}}case"end":{const i={...c};c=a0(c).newState;const r=i.actionRequired,l=c.actionRequired;if(l&&l!==r||c.queuedActions&&c.queuedActions.length>0&&(c=bc(c),c.actionRequired))return c;const s=o==="player"?"opponent":"player",f={...c[o],cannotCompile:!1};return c=Ue(c,void 0),c=Le(c,void 0),c={...c,_logIndentLevel:0},{...c,[o]:f,turn:s,phase:"start",processedStartEffectIds:[],processedEndEffectIds:[],processedSpeed1TriggerThisTurn:!1,processedUncoverEventIds:[],_interruptedTurn:void 0,_interruptedPhase:void 0}}}return n},Mo=n=>{if(!n.queuedActions||n.queuedActions.length===0)return n;console.log("[PROCESS QUEUE] Processing queue with",n.queuedActions.length,"actions"),console.log("[PROCESS QUEUE] Action types:",n.queuedActions.map(i=>i.type));let o={...n},c=[...o.queuedActions];for(;c.length>0;){const i=c.shift();if(console.log("[PROCESS QUEUE] Processing action:",i.type),i.sourceCardId&&i.type!=="flip_self_for_water_0"&&i.type!=="flip_self_for_psychic_4"){const r=he(o,i.sourceCardId);if(!r||!r.card.isFaceUp){const l=r?`${r.card.protocol}-${r.card.value}`:"a card";o=T(o,i.actor,`Queued effect from ${l} was cancelled because the source is no longer active.`);continue}}if(i.type==="flip_self_for_water_0"){console.log("[WATER-0 FLIP] Processing flip_self_for_water_0 in processQueuedActions");const{sourceCardId:r,actor:l}=i,s=he(o,r),f=Wt(o,r);if(console.log("[DEBUG] Water-0 self-flip queue processing:",{sourceCardId:r,foundCard:!!s,cardName:s?`${s.card.protocol}-${s.card.value}`:"NOT_FOUND",isFaceUp:s==null?void 0:s.card.isFaceUp,isUncovered:f,willExecute:!!(s&&s.card.isFaceUp&&f)}),s&&s.card.isFaceUp&&f){const p=`${s.card.protocol}-${s.card.value}`;console.log("[WATER-0 FLIP] Executing self-flip"),o=T(o,l,`${p}: Flips itself.`),o=Lt(new Set([r]),o),o.animationState={type:"flipCard",cardId:r}}else{const p=s?`${s.card.protocol}-${s.card.value}`:"Water-0",h=s?s.card.isFaceUp?"now covered":"flipped face-down":"deleted";console.log("[WATER-0 FLIP] Cancelling self-flip - reason:",h),o=T(o,l,`The self-flip effect from ${p} was cancelled because it is ${h}.`)}continue}if(i.type==="flip_self_for_psychic_4"){const{sourceCardId:r,actor:l}=i,s=he(o,r),f=Wt(o,r);if(s&&s.card.isFaceUp&&f){const p=`${s.card.protocol}-${s.card.value}`;o=T(o,l,`${p}: Flips itself.`),o=Lt(new Set([r]),o),o.animationState={type:"flipCard",cardId:r}}else{const p=s?`${s.card.protocol}-${s.card.value}`:"Psychic-4",h=s?s.card.isFaceUp?"now covered":"flipped face-down":"deleted";o=T(o,l,`The self-flip effect from ${p} was cancelled because it is ${h}.`)}continue}if(i.type==="anarchy_0_conditional_draw"){const{sourceCardId:r,actor:l}=i,s=he(o,r);if(s&&s.card.isFaceUp)o=Qr(o,l),o=mn(o);else{const f=s?`${s.card.protocol}-${s.card.value}`:"Anarchy-0";o=T(o,l,`The conditional draw from ${f} was cancelled because the source is no longer active.`),o=mn(o)}continue}if(i.type==="execute_remaining_custom_effects"){const{sourceCardId:r,laneIndex:l,effects:s,context:f,selectedCardFromPreviousEffect:p}=i,h=he(o,r);if(!h){o=T(o,f.cardOwner,"Remaining effects cancelled because the source card was deleted or returned.");continue}if(!h.card.isFaceUp){const m=`${h.card.protocol}-${h.card.value}`;o=T(o,f.cardOwner,`Remaining effects from ${m} cancelled because it was flipped face-down.`);continue}if(!Wt(o,r)){const m=`${h.card.protocol}-${h.card.value}`;o=T(o,f.cardOwner,`Remaining effects from ${m} cancelled because it is now covered.`);continue}p&&(o._selectedCardFromPreviousEffect=p);for(const m of s)if(o=gn(h.card,l,o,f,m).newState,o.actionRequired){if(o._interruptedTurn){const w=o._interruptedTurn,x=o._interruptedPhase||o.phase;delete o._interruptedTurn,delete o._interruptedPhase,o.turn=w,o.phase=x}return o.queuedActions=c,o}continue}if(i.type==="speed_3_self_flip_after_shift"){const{sourceCardId:r,actor:l}=i,s=he(o,r),f=Wt(o,r);if(s&&s.card.isFaceUp&&f)o=T(o,l,"Speed-3: Flipping itself after shifting a card."),o=Lt(new Set([r]),o),o.animationState={type:"flipCard",cardId:r};else{const p=s?`${s.card.protocol}-${s.card.value}`:"Speed-3",h=s?s.card.isFaceUp?"now covered":"flipped face-down":"deleted";o=T(o,l,`The self-flip effect from ${p} was cancelled because it is ${h}.`)}continue}if(i.type==="reveal_opponent_hand"){const r=o.turn==="player"?"opponent":"player",l={...o[r]};if(l.hand.length>0){l.hand=l.hand.map(p=>({...p,isRevealed:!0})),o[r]=l;const s=he(o,i.sourceCardId),f=s?`${s.card.protocol}-${s.card.value}`:"A card effect";o=T(o,o.turn,`${f}: Opponent reveals their hand.`)}else{const s=he(o,i.sourceCardId),f=s?`${s.card.protocol}-${s.card.value}`:"A card effect";o=T(o,o.turn,`${f}: Opponent has no cards to reveal.`)}continue}if(i.type==="gravity_2_shift_after_flip"){const{cardToShiftId:r,targetLaneIndex:l,cardOwner:s,actor:f,sourceCardId:p}=i,h=he(o,r),_=he(o,p),m=Wt(o,p),v=_&&_.card.isFaceUp&&m;if(!h||!v){const w=_?`${_.card.protocol}-${_.card.value}`:"Gravity-2";o=T(o,f,`${w}: Shift cancelled because the card no longer exists or is not active.`)}else o=ra(o,r,s,l,f).newState;continue}if(i.type==="select_any_opponent_card_to_shift"){const r=i.actor==="player"?"opponent":"player";if(o[r].lanes.flat().length===0){const l=he(o,i.sourceCardId),s=l?`${l.card.protocol}-${l.card.value}`:"A card effect";o=T(o,i.actor,`${s}: Opponent has no cards to shift, skipping effect.`);continue}}if(i.type==="shift_flipped_card_optional"){const r=he(o,i.sourceCardId),l=Wt(o,i.sourceCardId);if(!r||!r.card.isFaceUp||!l){const s=r?`${r.card.protocol}-${r.card.value}`:"the source card";o=T(o,i.actor,`Shift from ${s} was cancelled because the source is no longer active.`);continue}}return o.actionRequired=i,o.queuedActions=c,o}return{...o,queuedActions:[],actionRequired:null}},bc=n=>{var r,l;if(n.winner)return n;if(((r=n.actionRequired)==null?void 0:r.type)==="execute_remaining_custom_effects"){const s=n.actionRequired,f={...n,actionRequired:null,queuedActions:[s,...n.queuedActions||[]]};return Mo(f)}if(n.actionRequired)return n;if(n.queuedActions&&n.queuedActions.length>0){const s=Mo(n);if(s.actionRequired)return s;n=s}if(n._interruptedTurn){const s=n._interruptedTurn,f=n._interruptedPhase||n.phase;let p={...n};if(delete p._interruptedTurn,delete p._interruptedPhase,p.turn=s,p.phase=f,f==="start"||f==="end"){if(p.queuedActions&&p.queuedActions.length>0&&(p=Mo(p)),!p.actionRequired&&f==="end"){const h=p.turn==="player"?"opponent":"player",_={...p[p.turn],cannotCompile:!1};return p=Ue(p,void 0),p=Le(p,void 0),p={...p,_logIndentLevel:0},{...p,[p.turn]:_,turn:h,phase:"start",processedStartEffectIds:[],processedEndEffectIds:[],processedSpeed1TriggerThisTurn:!1,processedUncoverEventIds:[],_interruptedTurn:void 0,_interruptedPhase:void 0}}return p}n=p}if(((l=n.actionRequired)==null?void 0:l.type)==="prompt_rearrange_protocols"&&n.actionRequired.originalAction){console.log("[DEBUG processEndOfAction] FALLBACK HANDLER TRIGGERED - This should NOT happen if resolveRearrangeProtocols was called!"),console.log("[DEBUG processEndOfAction] originalAction:",n.actionRequired.originalAction);const s=n.actionRequired.originalAction;let f={...n,actionRequired:null,controlCardHolder:null};if(s.type==="compile")return Xr(f);if(s.type==="fill_hand"){console.log("[DEBUG processEndOfAction] Using fallback drawForPlayer, hand before:",f[f.turn].hand.length);const p=Ge(f,f.turn,5-f[f.turn].hand.length);return console.log("[DEBUG processEndOfAction] After fallback drawForPlayer, hand:",p[p.turn].hand.length),Xr(p)}}if(n.queuedEffect){const{card:s,laneIndex:f}=n.queuedEffect,p={...n,queuedEffect:void 0},h=he(p,s.id);if(h){const{card:_,owner:m}=h,v={cardOwner:m,actor:m,currentTurn:p.turn,opponent:m==="player"?"opponent":"player",triggerType:"play"},{newState:w}=el(_,f,p,v);if(w.actionRequired)return w;n=w}else console.warn(`Skipping queued effect for ${s.protocol}-${s.value} as it is no longer on the board.`),n=T(n,n.turn,`Skipping queued effect for ${s.protocol}-${s.value} as it is no longer on the board.`),n=p}if(n.queuedActions&&n.queuedActions.length>0){let s={...n},f=[...s.queuedActions];for(;f.length>0;){const p=f.shift();if(p.sourceCardId&&p.type!=="flip_self_for_water_0"&&p.type!=="flip_self_for_psychic_4"){const h=he(s,p.sourceCardId);if(!h||!h.card.isFaceUp){const _=h?`${h.card.protocol}-${h.card.value}`:"a card";s=T(s,p.actor,`Queued effect from ${_} was cancelled because the source is no longer active.`);continue}}if(p.type==="flip_self_for_water_0"){console.log("[WATER-0 FLIP] Processing flip_self_for_water_0 in processEndOfAction (SECOND LOCATION - SHOULD NOT BE CALLED)");const{sourceCardId:h,actor:_}=p,m=he(s,h),v=Wt(s,h);if(console.log("[DEBUG] Water-0 self-flip queue processing (processEndOfAction):",{sourceCardId:h,foundCard:!!m,cardName:m?`${m.card.protocol}-${m.card.value}`:"NOT_FOUND",isFaceUp:m==null?void 0:m.card.isFaceUp,isUncovered:v,willExecute:!!(m&&m.card.isFaceUp&&v)}),m&&m.card.isFaceUp&&v){const w=`${m.card.protocol}-${m.card.value}`;console.log("[WATER-0 FLIP] Executing self-flip (processEndOfAction)"),s=T(s,_,`${w}: Flips itself.`),s=Lt(new Set([h]),s),s.animationState={type:"flipCard",cardId:h}}else{const w=m?`${m.card.protocol}-${m.card.value}`:"Water-0",x=m?m.card.isFaceUp?"now covered":"flipped face-down":"deleted";console.log("[WATER-0 FLIP] Cancelling self-flip (processEndOfAction) - reason:",x),s=T(s,_,`The self-flip effect from ${w} was cancelled because it is ${x}.`)}continue}if(p.type==="flip_self_for_psychic_4"){const{sourceCardId:h,actor:_}=p,m=he(s,h),v=Wt(s,h);if(m&&m.card.isFaceUp&&v){const w=`${m.card.protocol}-${m.card.value}`;s=T(s,_,`${w}: Flips itself.`),s=Lt(new Set([h]),s),s.animationState={type:"flipCard",cardId:h}}else{const w=m?`${m.card.protocol}-${m.card.value}`:"Psychic-4",x=m?m.card.isFaceUp?"now covered":"flipped face-down":"deleted";s=T(s,_,`The self-flip effect from ${w} was cancelled because it is ${x}.`)}continue}if(p.type==="anarchy_0_conditional_draw"){const{sourceCardId:h,actor:_}=p,m=he(s,h);if(m&&m.card.isFaceUp)s=Qr(s,_),s=mn(s);else{const v=m?`${m.card.protocol}-${m.card.value}`:"Anarchy-0";s=T(s,_,`The conditional draw from ${v} was cancelled because the source is no longer active.`),s=mn(s)}continue}if(p.type==="speed_3_self_flip_after_shift"){const{sourceCardId:h,actor:_}=p,m=he(s,h),v=Wt(s,h);if(m&&m.card.isFaceUp&&v)s=T(s,_,"Speed-3: Flipping itself after shifting a card."),s=Lt(new Set([h]),s),s.animationState={type:"flipCard",cardId:h};else{const w=m?`${m.card.protocol}-${m.card.value}`:"Speed-3",x=m?m.card.isFaceUp?"now covered":"flipped face-down":"deleted";s=T(s,_,`The self-flip effect from ${w} was cancelled because it is ${x}.`)}continue}if(p.type==="reveal_opponent_hand"){const h=s.turn==="player"?"opponent":"player",_={...s[h]};if(_.hand.length>0){_.hand=_.hand.map(w=>({...w,isRevealed:!0})),s[h]=_;const m=he(s,p.sourceCardId),v=m?`${m.card.protocol}-${m.card.value}`:"A card effect";s=T(s,s.turn,`${v}: Opponent reveals their hand.`)}else{const m=he(s,p.sourceCardId),v=m?`${m.card.protocol}-${m.card.value}`:"A card effect";s=T(s,s.turn,`${v}: Opponent has no cards to reveal.`)}continue}if(p.type==="select_any_opponent_card_to_shift"){const h=p.actor==="player"?"opponent":"player";if(s[h].lanes.flat().length===0){const _=he(s,p.sourceCardId),m=_?`${_.card.protocol}-${_.card.value}`:"A card effect";s=T(s,p.actor,`${m}: Opponent has no cards to shift, skipping effect.`);continue}}if(p.type==="shift_flipped_card_optional"){const h=he(s,p.sourceCardId),_=Wt(s,p.sourceCardId);if(!h||!h.card.isFaceUp||!_){const m=h?`${h.card.protocol}-${h.card.value}`:"the source card";s=T(s,p.actor,`Shift from ${m} was cancelled because the source is no longer active.`);continue}}return s.actionRequired=p,s.queuedActions=f,s}n={...s,queuedActions:[],actionRequired:null}}const o=n.phase==="action"?"hand_limit":n.phase;let c={...n,phase:o,compilableLanes:[],processedUncoverEventIds:[]};const i=n.turn;for(;c.turn===i&&!c.winner;){const s=c.actionRequired,f=c.phase;c=Ba(c);const p=c.actionRequired;if(p&&p!==s)break;if(c.phase===f&&c.turn===i){console.error("Game is stuck in a phase loop:",c.phase);break}}return c},Xr=n=>{if(n.winner)return n;let o={...n};if(o._interruptedTurn){const i=o._interruptedTurn,r=o._interruptedPhase||o.phase;delete o._interruptedTurn,delete o._interruptedPhase,o.turn=i,o.phase=r}const c=o.turn;for(;o.turn===c&&!o.actionRequired&&!o.winner;){const i=o.phase;if(i==="action")break;if(i==="compile"){const l=$h(o,c);if(l.length>0){o={...o,compilableLanes:l};break}}const r=o.phase;if(o=Ba(o),r===o.phase&&!o.actionRequired){console.error("Game is stuck in an automatic phase loop:",r),console.error("State:",{phase:o.phase,turn:o.turn,actionRequired:o.actionRequired,queuedActions:o.queuedActions,interruptedTurn:o._interruptedTurn});break}}return o},Lh=n=>{let o={...n,actionRequired:null};const c=Nh(o).newState;if(c.actionRequired)return c;let i=c;return i.phase!=="control"&&(i={...i,phase:"control"}),i=Ba(i),i.actionRequired||(i=Ba(i)),i},Mh=n=>{if(n.winner)return n;let o={...n,phase:"start"};return o=Ba(o),o.actionRequired?o:Xr(o)},uh=Object.freeze(Object.defineProperty({__proto__:null,advancePhase:Ba,continueTurnAfterStartPhaseAction:Lh,continueTurnProgression:Xr,processEndOfAction:bc,processQueuedActions:Mo,processStartOfTurn:Mh},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const $n=(n,o)=>{if(n[o].lanes.flat().some(r=>r.isFaceUp&&r.protocol==="Hate"&&r.value===3)){let r={...n};return r=Ue(r,"Hate-3"),r=Le(r,void 0),r=T(r,o,"Triggers after deleting cards: Draw 1 card."),r=Ge(r,o,1),r=Ue(r,void 0),r}return n};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function C0(n,o,c){const i=he(n,o);if(i&&i.card.protocol==="Metal"&&i.card.value===6){const r="actor"in c?c.actor:n.turn;let l=T(n,r,"Metal-6 effect triggers on flip: deleting itself.");const s={...n.stats[r],cardsDeleted:n.stats[r].cardsDeleted+1},f={...n[r],stats:s};l={...l,[r]:f,stats:{...l.stats,[r]:s}};const p=(h,_)=>{let m=$n(h,h.turn);if(m=Ct(m,"after_delete",{player:h.turn}).newState,(c==null?void 0:c.type)==="select_card_to_flip_for_light_0")return m=T(m,c.actor,"Light-0: Drawing 6 card(s) after Metal-6 was deleted."),m=Ge(m,c.actor,6),m.actionRequired=null,m.actionRequired?m:_(m);if((c==null?void 0:c.type)==="select_any_other_card_to_flip_for_water_0")return m.actionRequired=null,_(m);if(c&&"count"in c&&c.count>1){const w=c.count-1;return m.actionRequired={...c,count:w},m}if(m.actionRequired=null,m.queuedActions&&m.queuedActions.length>0){const w=[...m.queuedActions],x=w.shift();return{...m,actionRequired:x,queuedActions:w}}return _(m)};return{nextState:{...n,actionRequired:null},requiresAnimation:{animationRequests:[{type:"delete",cardId:o,owner:i.owner}],onCompleteCallback:p},requiresTurnEnd:!1}}return null}const ad=(n,o)=>{var s,f,p,h,_;if(!n.actionRequired)return{nextState:n};let c={...n},i=!0,r=null;const l=C0(n,o,n.actionRequired);if(l)return l;switch(n.actionRequired.type){case"select_covered_card_to_flip_for_chaos_0":{const{actor:m,sourceCardId:v,remainingLanes:w}=n.actionRequired,x=he(n,o);if(c=$o(n,o),x&&!x.card.isFaceUp){const C=Lo(c,o);c=C.newState,C.animationRequests&&(r={animationRequests:C.animationRequests,onCompleteCallback:(S,E)=>S.actionRequired||S.queuedActions&&S.queuedActions.length>0?S:E(S)})}if(w.length>0){const C=w[0],S=w.slice(1);c.actionRequired={type:"select_covered_card_to_flip_for_chaos_0",sourceCardId:v,laneIndex:C,remainingLanes:S,actor:m},i=!1}else c.actionRequired=null,c.queuedActions&&c.queuedActions.length>0&&(i=!1);break}case"select_any_other_card_to_flip":case"select_opponent_face_up_card_to_flip":case"select_own_face_up_covered_card_to_flip":case"select_covered_card_in_line_to_flip_optional":case"select_any_card_to_flip_optional":case"select_any_face_down_card_to_flip_optional":case"select_card_to_flip_for_fire_3":case"select_card_to_flip":{const m=he(n,o),v="draws"in n.actionRequired?n.actionRequired.draws:0;if(c=$o(n,o),v&&v>0){const{actor:j,sourceCardId:D}=n.actionRequired,A=he(c,D),L=A?`${A.card.protocol}-${A.card.value}`:"A card effect";c=T(c,j,`${L}: Drawing ${v} card(s).`),c=Ge(c,j,v)}if(m&&!m.card.isFaceUp){const j=Lo(c,o);c=j.newState,j.animationRequests&&(r={animationRequests:j.animationRequests,onCompleteCallback:(D,A)=>D.actionRequired||D.queuedActions&&D.queuedActions.length>0?D:A(D)})}const w=(s=n.actionRequired)==null?void 0:s.followUpEffect,x=(f=n.actionRequired)==null?void 0:f.sourceCardId;w&&x&&(c=r0(c,o,x));const C=((p=n.actionRequired)==null?void 0:p.actor)||n.turn;c=Ct(c,"after_flip",{cardId:o}).newState;const E=c._pendingCustomEffects;if(E&&E.effects.length>0){const j={type:"execute_remaining_custom_effects",sourceCardId:E.sourceCardId,laneIndex:E.laneIndex,effects:E.effects,context:E.context,actor:C,selectedCardFromPreviousEffect:E.effects[0].useCardFromPreviousEffect?o:void 0};c.queuedActions=[...c.queuedActions||[],j],delete c._pendingCustomEffects}(c.actionRequired||c.queuedActions&&c.queuedActions.length>0)&&(i=!1);break}case"select_opponent_card_to_flip":{const{actor:m,sourceCardId:v}=n.actionRequired,w=he(n,o),x={type:"shift_flipped_card_optional",cardId:o,sourceCardId:v,optional:!0,actor:m};if(c=$o(n,o,x),w&&!w.card.isFaceUp){const C=Lo(c,o),S=C.newState.actionRequired;S&&S!==x&&he(C.newState,o)&&(C.newState.queuedActions=[...C.newState.queuedActions||[],x]),c=C.newState,C.animationRequests&&(r={animationRequests:C.animationRequests,onCompleteCallback:E=>E})}i=!1;break}case"select_card_to_shift_for_anarchy_0":case"select_card_to_shift_for_anarchy_1":case"select_card_to_shift_for_gravity_1":case"shift_flipped_card_optional":case"select_opponent_covered_card_to_shift":case"select_own_covered_card_to_shift":case"select_face_down_card_to_shift_for_darkness_4":case"select_any_opponent_card_to_shift":case"select_card_to_shift":{if(n.actionRequired.type==="shift_flipped_card_optional"){const v=n.actionRequired.sourceCardId,w=he(n,v);if(!w||!w.card.isFaceUp){const x=w?`${w.card.protocol}-${w.card.value}`:"the source card";c=T(n,n.actionRequired.actor,`Shift from ${x} was cancelled because the source is no longer active.`),c.actionRequired=null,i=!0;break}}const m=he(n,o);if(m){const{owner:v}=m;let w=-1;for(let x=0;x<n[v].lanes.length;x++)if(n[v].lanes[x].some(C=>C.id===o)){w=x;break}if(w!==-1){const x={type:"select_lane_for_shift",cardToShiftId:o,cardOwner:v,originalLaneIndex:w,sourceCardId:n.actionRequired.sourceCardId,actor:n.actionRequired.actor,destinationRestriction:n.actionRequired.destinationRestriction};c.actionRequired=x}}i=!1;break}case"select_face_down_card_to_shift_for_gravity_4":{const{targetLaneIndex:m,actor:v}=n.actionRequired,w=he(n,o);if(!w)return{nextState:n,requiresTurnEnd:!0};const x=ra(n,o,w.owner,m,v);c=x.newState,x.animationRequests?(r={animationRequests:x.animationRequests,onCompleteCallback:(C,S)=>C.actionRequired?C:S(C)},i=!1):i=!c.actionRequired;break}case"select_own_other_card_to_shift":{const m=he(n,o);if(m){const{owner:v}=m;let w=-1;for(let x=0;x<n[v].lanes.length;x++)if(n[v].lanes[x].some(C=>C.id===o)){w=x;break}if(w!==-1){const x={type:"select_lane_for_shift",cardToShiftId:o,cardOwner:v,originalLaneIndex:w,sourceCardId:n.actionRequired.sourceCardId,actor:n.actionRequired.actor};c.actionRequired=x}}i=!1;break}case"select_opponent_face_down_card_to_shift":{const m=he(n,o);if(m){const{owner:v}=m;let w=-1;for(let x=0;x<n[v].lanes.length;x++)if(n[v].lanes[x].some(C=>C.id===o)){w=x;break}if(w!==-1){const x={type:"select_lane_for_shift",cardToShiftId:o,cardOwner:v,originalLaneIndex:w,sourceCardId:n.actionRequired.sourceCardId,actor:n.actionRequired.actor};c.actionRequired=x}}i=!1;break}case"select_own_card_to_shift_for_speed_3":{const m=he(n,o);if(m){const{owner:v}=m;let w=-1;for(let x=0;x<n[v].lanes.length;x++)if(n[v].lanes[x].some(C=>C.id===o)){w=x;break}if(w!==-1){const x={type:"select_lane_for_shift",cardToShiftId:o,cardOwner:v,originalLaneIndex:w,sourceCardId:n.actionRequired.sourceCardId,actor:n.actionRequired.actor,sourceEffect:"speed_3_end"};c.actionRequired=x}}i=!1;break}case"select_card_to_delete_for_death_1":{const{sourceCardId:m,actor:v}=n.actionRequired,w=he(n,o),x=he(n,m);if(!w||!x)return{nextState:n};const C=v==="player"?"Player":"Opponent",S=w.owner==="player"?"Player's":"Opponent's",E=w.card.isFaceUp?`${w.card.protocol}-${w.card.value}`:"a face-down card";c=T(c,v,`Death-1: ${C} deletes ${S} ${E} and the Death-1 card itself.`);const j={...c.stats[v],cardsDeleted:c.stats[v].cardsDeleted+2},D={...c[v],stats:j};c={...c,[v]:D,stats:{...c.stats,[v]:j}};const A=n[w.owner].lanes.findIndex(V=>V.some(le=>le.id===o)),L=n[w.owner].lanes[A],H=L&&L.length>0&&L[L.length-1].id===o,ce=n[x.owner].lanes.findIndex(V=>V.some(le=>le.id===m)),B=n[x.owner].lanes[ce],z=B&&B.length>0&&B[B.length-1].id===m;c.actionRequired=null,r={animationRequests:[{type:"delete",cardId:o,owner:w.owner},{type:"delete",cardId:m,owner:x.owner}],onCompleteCallback:(V,le)=>{let G=$n(V,v);if(G=$n(G,v),G=Ct(G,"after_delete",{}).newState,H&&(G=kn(G,w.owner,A).newState),z&&(G=kn(G,x.owner,ce).newState),G=mn(G),G.actionRequired)return G;if(G.queuedActions&&G.queuedActions.length>0){const q=[...G.queuedActions],N=q.shift();return{...G,actionRequired:N,queuedActions:q}}return le(G)}},i=!1;break}case"delete_self":{const{sourceCardId:m,cardToDeleteId:v,actor:w}=n.actionRequired,x=he(n,v);if(!x){c=T(n,w,"Card no longer on board. Delete skipped."),c.actionRequired=null,i=!0;break}const{owner:C,laneIndex:S}=x,E=n[C].lanes[S][n[C].lanes[S].length-1].id===v,j=[...n[C].lanes[S]],D=j.findIndex(H=>H.id===v);j.splice(D,1);const A=[...n[C].lanes];A[S]=j,c={...n,[C]:{...n[C],lanes:A},actionRequired:null};const L={...c.stats[w],cardsDeleted:c.stats[w].cardsDeleted+1};c={...c,stats:{...c.stats,[w]:L}},E&&j.length>0&&(c=kn(c,C,S).newState),i=!0;break}case"select_cards_to_delete":case"select_face_down_card_to_delete":case"select_low_value_card_to_delete":case"select_card_from_other_lanes_to_delete":case"select_card_to_delete_for_anarchy_2":{const{sourceCardId:m,actor:v}=n.actionRequired,w=he(n,m);if(!w||!w.card.isFaceUp){const z=w?`${w.card.protocol}-${w.card.value}`:"the source card";c=T(n,v,`Effect from ${z} was cancelled because the source is no longer active.`),c.actionRequired=null,i=!0;break}const x=he(n,o);if(!x)return{nextState:n};if(n.actionRequired.type==="select_card_to_delete_for_anarchy_2"){const z=n[x.owner].lanes.findIndex(V=>V.some(le=>le.id===o));if(z!==-1){const V=n.player.protocols[z],le=n.opponent.protocols[z],G=x.card.protocol;if(G!==V&&G!==le)return console.error(`Illegal Anarchy-2 delete: ${G}-${x.card.value} in lane ${z} (protocols: ${V}/${le}) - card must be in lane with matching protocol`),{nextState:n}}}if(n.actionRequired.protocolMatching){const z=n.actionRequired.protocolMatching,V=n[x.owner].lanes.findIndex(le=>le.some(G=>G.id===o));if(V!==-1){const le=n.player.protocols[V],G=n.opponent.protocols[V],P=x.card.protocol,q=P===le||P===G;if(z==="must_match"&&!q)return console.error(`Illegal delete: ${P}-${x.card.value} in lane ${V} (protocols: ${le}/${G}) - card must be in lane with matching protocol`),{nextState:n};if(z==="must_not_match"&&q)return console.error(`Illegal delete: ${P}-${x.card.value} in lane ${V} (protocols: ${le}/${G}) - card must be in lane without matching protocol`),{nextState:n}}}const C=v==="player"?"Player":"Opponent",S=x.owner==="player"?"Player's":"Opponent's",E=x.card.isFaceUp?`${x.card.protocol}-${x.card.value}`:"a face-down card",j=he(n,n.actionRequired.sourceCardId),D=j?`${j.card.protocol}-${j.card.value}`:"a card effect";c=T(c,v,`${D}: ${C} deletes ${S} ${E}.`);const A={...c.stats[v],cardsDeleted:c.stats[v].cardsDeleted+1},L={...c[v],stats:A};c={...c,[v]:L,stats:{...c.stats,[v]:A}};const H=n[x.owner].lanes.findIndex(z=>z.some(V=>V.id===o)),ce=n[x.owner].lanes[H],B=ce&&ce.length>0&&ce[ce.length-1].id===o;c.actionRequired=null,r={animationRequests:[{type:"delete",cardId:o,owner:x.owner}],onCompleteCallback:(z,V)=>{const le=n.actionRequired.actor,G=n.actionRequired;console.log("[DELETE CALLBACK] Started! followUpEffect?",!!G.followUpEffect);let P=$n(z,le);P=Ct(P,"after_delete",{}).newState;let N=null;const k=he(P,G.sourceCardId),W=Wt(P,G.sourceCardId),ee=G.followUpEffect;if(k&&k.card.isFaceUp&&W){if(G.type==="select_cards_to_delete"&&G.count>1)N={type:"select_cards_to_delete",count:G.count-1,sourceCardId:G.sourceCardId,disallowedIds:[...G.disallowedIds,o],actor:G.actor,followUpEffect:ee};else if(G.type==="select_card_from_other_lanes_to_delete"&&G.count>1){const O=n[x.owner].lanes.findIndex(ye=>ye.some(fe=>fe.id===o)),K=[...G.lanesSelected,O];[0,1,2].filter(ye=>ye!==G.disallowedLaneIndex&&!K.includes(ye)).some(ye=>P.player.lanes[ye].length>0||P.opponent.lanes[ye].length>0)?N={type:"select_card_from_other_lanes_to_delete",count:G.count-1,sourceCardId:G.sourceCardId,disallowedLaneIndex:G.disallowedLaneIndex,lanesSelected:K,actor:G.actor}:P=T(P,G.actor,"No cards left in remaining lanes. Effect skipped.")}}else if("count"in G&&G.count>1){const O=k?`${k.card.protocol}-${k.card.value}`:"the source card",K=!k||!k.card.isFaceUp?"the source is no longer active":"the source was covered";P=T(P,G.actor,`Remaining deletes from ${O} were cancelled because ${K}.`)}let ge=!1;if(B){const O=P,K=kn(O,x.owner,H),U=K.newState._interruptedTurn!==void 0;O._interruptedTurn&&!K.newState._interruptedTurn&&(ge=!0);const Q=[...K.newState.queuedActions||[]];N&&(U?Q.push(N):Q.unshift(N)),P={...K.newState,queuedActions:Q}}else N&&(P.queuedActions=[...P.queuedActions||[],N]);if(P.actionRequired)return P;if(P.queuedActions&&P.queuedActions.length>0){const O=P.queuedActions[0];if((O==null?void 0:O.type)==="execute_remaining_custom_effects"){const Q=Mo(P);return Q.actionRequired?Q:V(Q)}const K=[...P.queuedActions],U=K.shift();if((U==null?void 0:U.type)==="shift_flipped_card_optional"||(U==null?void 0:U.type)==="gravity_2_shift_after_flip"){const Q=he(P,U.sourceCardId),ye=Wt(P,U.sourceCardId);if(!Q||!Q.card.isFaceUp||!ye){const fe=Q?`${Q.card.protocol}-${Q.card.value}`:"the source card";let ne=T(P,U.actor,`Shift from ${fe} was cancelled because the source is no longer active.`);if(K.length>0){const X=K.shift();return{...ne,actionRequired:X,queuedActions:K}}else return V({...ne,actionRequired:null,queuedActions:[]})}}return{...P,actionRequired:U,queuedActions:K}}if(ge)return console.log("[DELETE CALLBACK] Interrupt resolved, returning early"),P;if(console.log("[DELETE CALLBACK] Reached followUpEffect check. followUpEffect?",!!ee,"sourceCardInfo?",!!k,"isFaceUp?",k==null?void 0:k.card.isFaceUp),ee&&k&&k.card.isFaceUp)if(!((ee.position||"middle")!=="top")||W){console.log("[Death-1 Follow-up] Executing follow-up effect after delete:",ee),P=T(P,G.actor,`[DEBUG] Executing followUp: ${ee.id}`);const Q=P[k.owner].lanes.findIndex(re=>re.some(se=>se.id===G.sourceCardId)),ye=G.actor==="player"?"opponent":"player";ee.trigger;const fe={cardOwner:G.actor,actor:G.actor,currentTurn:P.turn,opponent:ye};P=gn(k.card,Q,P,fe,ee).newState,console.log("[Death-1 Follow-up] Result actionRequired:",P.actionRequired);const X=he(P,G.sourceCardId);if(console.log("[Death-1 Follow-up] Card still exists after deleteSelf?",!!X),P.actionRequired)return P}else console.log("[Death-1 Follow-up] Follow-up effect requires uncovered but card is covered"),P=T(P,G.actor,"[DEBUG] Follow-up skipped: middle effect but card is covered");else console.log("[Death-1 Follow-up] No follow-up effect or source card not valid:",{hasFollowUp:!!ee,hasSourceCard:!!k,isFaceUp:k==null?void 0:k.card.isFaceUp,isUncovered:W}),ee?(!k||!k.card.isFaceUp)&&(P=T(P,G.actor,"[DEBUG] Source card not valid for followUp")):P=T(P,G.actor,"[DEBUG] No followUpEffect on delete action!");return V(P)}},i=!1;break}case"plague_4_opponent_delete":{const m=he(n,o);if(!m)return{nextState:n};const v=n.actionRequired.actor;c=T(c,v,"Plague-4: Opponent deletes one of their face-down cards.");const w={...c.stats[v],cardsDeleted:c.stats[v].cardsDeleted+1},x={...c[v],stats:w};c={...c,[v]:x,stats:{...c.stats,[v]:w}};const C=n[m.owner].lanes.findIndex(j=>j.some(D=>D.id===o)),S=n[m.owner].lanes[C],E=S&&S.length>0&&S[S.length-1].id===o;c.actionRequired=null,r={animationRequests:[{type:"delete",cardId:o,owner:m.owner}],onCompleteCallback:(j,D)=>{let A=$n(j,v);A=Ct(A,"after_delete",{}).newState,E&&(A=kn(A,m.owner,C).newState);const H=he(A,n.actionRequired.sourceCardId),ce=(H==null?void 0:H.owner)||n.turn,B={type:"plague_4_player_flip_optional",sourceCardId:n.actionRequired.sourceCardId,optional:!0,actor:ce};return A.actionRequired?A.queuedActions=[...A.queuedActions||[],B]:A.actionRequired=B,A}},i=!1;break}case"select_own_highest_card_to_delete_for_hate_2":{const{sourceCardId:m,actor:v}=n.actionRequired,w=he(n,o);if(!w)return{nextState:n};if(!Sc(n,v).some(ce=>ce.card.id===o))return c=T(n,v,"Invalid selection: Card is not one of your highest value uncovered cards."),{nextState:n};const S=v==="player"?"Player":"Opponent",E=w.card.isFaceUp?`${w.card.protocol}-${w.card.value}`:"a face-down card";c=T(c,v,`Hate-2: ${S} deletes their highest value uncovered card (${E}).`);const j={...c.stats[v],cardsDeleted:c.stats[v].cardsDeleted+1},D={...c[v],stats:j};c={...c,[v]:D,stats:{...c.stats,[v]:j}};const A=n[w.owner].lanes.findIndex(ce=>ce.some(B=>B.id===o)),L=n[w.owner].lanes[A],H=L&&L.length>0&&L[L.length-1].id===o;c.actionRequired=null,r={animationRequests:[{type:"delete",cardId:o,owner:w.owner}],onCompleteCallback:(ce,B)=>{let z=$n(ce,v);z=Ct(z,"after_delete",{}).newState,H&&(z=kn(z,w.owner,A).newState);const le=he(z,m),G=le&&Wt(z,m);if(le&&le.card.isFaceUp&&G){const P={type:"select_opponent_highest_card_to_delete_for_hate_2",sourceCardId:m,actor:v,count:1};return z.actionRequired?z.queuedActions=[...z.queuedActions||[],P]:z.actionRequired=P,z}else{const P=le?le.card.isFaceUp?"is now covered":"was flipped face-down":"deleted itself";return z=T(z,v,`Hate-2 ${P}, second clause does not trigger.`),B(z)}}},i=!1;break}case"select_opponent_highest_card_to_delete_for_hate_2":{const{sourceCardId:m,actor:v}=n.actionRequired,w=v==="player"?"opponent":"player",x=he(n,o);if(!x)return{nextState:n};if(!Sc(n,w).some(z=>z.card.id===o))return c=T(n,v,"Invalid selection: Card is not one of opponent's highest value uncovered cards."),{nextState:n};c=Ue(c,"Hate-2"),c=Le(c,"middle");const E=v==="player"?"Player":"Opponent",j=x.owner==="player"?"Player's":"Opponent's",D=x.card.isFaceUp?`${x.card.protocol}-${x.card.value}`:"a face-down card";c=T(c,v,`${E} deletes ${j} highest value uncovered card (${D}).`);const A={...c.stats[v],cardsDeleted:c.stats[v].cardsDeleted+1},L={...c[v],stats:A};c={...c,[v]:L,stats:{...c.stats,[v]:A}};const H=n[x.owner].lanes.findIndex(z=>z.some(V=>V.id===o)),ce=n[x.owner].lanes[H],B=ce&&ce.length>0&&ce[ce.length-1].id===o;c.actionRequired=null,r={animationRequests:[{type:"delete",cardId:o,owner:x.owner}],onCompleteCallback:(z,V)=>{let le=$n(z,v);return le=Ct(le,"after_delete",{}).newState,B&&(le=kn(le,x.owner,H).newState),V(le)}},i=!1;break}case"select_card_to_return":{const m=Cc(n,o);c=m.newState,m.animationRequests&&(r={animationRequests:m.animationRequests,onCompleteCallback:(v,w)=>v.actionRequired?v:w(v)}),i=!c.actionRequired;break}case"select_opponent_card_to_return":{const{sourceCardId:m,actor:v}=n.actionRequired,w=Cc(n,o);let x=w.newState;if(x.actionRequired){const C={type:"flip_self_for_psychic_4",sourceCardId:m,actor:v};x.queuedActions=[...x.queuedActions||[],C],c=x,i=!1}else{const C=he(x,m);if(C){const S=`${C.card.protocol}-${C.card.value}`;x=T(x,v,`${S}: Flips itself.`),x=Lt(new Set([m]),x),x.animationState={type:"flipCard",cardId:m}}c=x,i=!0}w.animationRequests&&(r={animationRequests:w.animationRequests,onCompleteCallback:(C,S)=>C.actionRequired?C:S(C)});break}case"select_own_card_to_return_for_water_4":{const m=Cc(n,o);c=m.newState,m.animationRequests?r={animationRequests:m.animationRequests,onCompleteCallback:(v,w)=>{const x=Mo(v);return x.actionRequired?x:w(x)}}:c=Mo(c),i=!c.actionRequired;break}case"select_any_card_to_flip":{const m=he(n,o),{count:v,sourceCardId:w,actor:x}=n.actionRequired,C=he(n,w);if(!C||!C.card.isFaceUp){const j=C?`${C.card.protocol}-${C.card.value}`:"a card";c=T(n,x,`Effect from ${j} was cancelled because the source is no longer active.`),c.actionRequired=null,i=!0;break}let S=null;v>1&&(S={type:"select_any_card_to_flip",count:v-1,sourceCardId:w,actor:x});let E=$o(n,o,S);if(m&&!m.card.isFaceUp){const j=Lo(E,o),D=j.newState.actionRequired;D&&D!==S&&S&&(j.newState.queuedActions=[...j.newState.queuedActions||[],S]),c=j.newState,j.animationRequests&&(r={animationRequests:j.animationRequests,onCompleteCallback:(A,L)=>A.actionRequired||A.queuedActions&&A.queuedActions.length>0?A:L(A)})}else c=E;i=!c.actionRequired&&(!c.queuedActions||c.queuedActions.length===0);break}case"select_card_to_flip_for_light_0":{const{sourceCardId:m,actor:v}=n.actionRequired,w=he(n,o);let x=$o(n,o,null);const C=he(x,o);let S=0;if(C){const E=C.owner,j=x[E].lanes.find(D=>D.some(A=>A.id===o))||[];S=mt(C.card,j)}S>0&&(x=T(x,v,`Light-0: Drawing ${S} card(s).`),x=Ge(x,v,S)),w&&!w.card.isFaceUp?c=Lo(x,o).newState:c=x,i=!c.actionRequired;break}case"select_any_other_card_to_flip_for_water_0":{const{sourceCardId:m,actor:v}=n.actionRequired,w=he(n,o);let x=$o(n,o,null),C={newState:x};w&&!w.card.isFaceUp&&(C=Lo(x,o));let S=C.newState;const E={type:"flip_self_for_water_0",sourceCardId:m,actor:v};console.log("[DEBUG] cardResolver - Water-0 self-flip action CREATED:",{sourceCardId:m,actor:v,hasInterrupt:!!S.actionRequired,existingQueueLength:((h=S.queuedActions)==null?void 0:h.length)||0}),S.actionRequired?(S.queuedActions=[...S.queuedActions||[],E],console.log("[WATER-0 QUEUE] Added to END of queue (interrupt case), new queue length:",S.queuedActions.length),console.log("[WATER-0 QUEUE] Current actionRequired:",S.actionRequired.type)):(S.queuedActions=[E],console.log("[WATER-0 QUEUE] Created NEW queue (no interrupt), queue length:",S.queuedActions.length)),c=S,c.queuedActions&&c.queuedActions.length>0&&!c.actionRequired&&(console.log("[WATER-0 NO INTERRUPT] Queue exists but no actionRequired - processing queue immediately"),c=Mo(c),console.log("[WATER-0 NO INTERRUPT] After queue processing - actionRequired?",((_=c.actionRequired)==null?void 0:_.type)||"null")),i=!c.actionRequired,C.animationRequests&&(r={animationRequests:C.animationRequests,onCompleteCallback:(D,A)=>D.actionRequired?D:A(D)});break}case"select_card_to_flip_and_shift_for_gravity_2":{const m=he(n,o),{sourceCardId:v,targetLaneIndex:w,actor:x}=n.actionRequired;let C=$o(n,o,null);if(m&&!m.card.isFaceUp){const E=Lo(C,o),j=E.newState.actionRequired;if(console.log("[Gravity-2] After flip, interruptAction:",(j==null?void 0:j.type)||"none"),j){const D=he(E.newState,o);if(console.log("[Gravity-2] Flipped card still exists:",!!D),D){const A={type:"gravity_2_shift_after_flip",cardToShiftId:o,targetLaneIndex:w,cardOwner:m.owner,sourceCardId:v,actor:x};E.newState.queuedActions=[...E.newState.queuedActions||[],A],console.log("[Gravity-2] Queued shift action. Queue length:",E.newState.queuedActions.length)}c=E.newState,i=!1;break}C=E.newState}console.log("[Gravity-2] No interrupt detected, performing immediate shift"),c=ra(C,o,m.owner,w,x).newState,i=!c.actionRequired;break}case"gravity_2_shift_after_flip":{const{cardToShiftId:m,targetLaneIndex:v,cardOwner:w,actor:x,sourceCardId:C}=n.actionRequired,S=he(n,m),E=he(n,C),j=E&&E.card.isFaceUp;if(!S||!j){c={...n,actionRequired:null},i=!0;break}c=ra(n,m,w,v,x).newState,i=!c.actionRequired;break}case"select_face_down_card_to_reveal_for_light_2":{const{sourceCardId:m,actor:v}=n.actionRequired,w=v.charAt(0).toUpperCase()+v.slice(1),x=he(n,o),C=x?`${x.card.protocol}-${x.card.value}`:"a card";c=T(n,v,`Light-2: ${w} reveals ${C}.`),c.actionRequired={type:"prompt_shift_or_flip_for_light_2",sourceCardId:m,revealedCardId:o,optional:!0,actor:v},i=!1;break}default:return{nextState:n,requiresTurnEnd:!0}}if(!r&&c.actionRequired===null){if(c.queuedActions&&c.queuedActions.length>0){const m=[...c.queuedActions],v=m.shift();if((v==null?void 0:v.type)==="execute_remaining_custom_effects")return{nextState:{...c,actionRequired:null,queuedActions:[v,...m]},requiresTurnEnd:!1};if((v==null?void 0:v.type)==="shift_flipped_card_optional"||(v==null?void 0:v.type)==="gravity_2_shift_after_flip"){const w=he(c,v.sourceCardId),x=Wt(c,v.sourceCardId);if(!w||!w.card.isFaceUp||!x){const C=w?`${w.card.protocol}-${w.card.value}`:"the source card",S=T(c,v.actor,`Shift from ${C} was cancelled because the source is no longer active.`);if(m.length>0){const E=m.shift();return{nextState:{...S,actionRequired:E,queuedActions:m},requiresTurnEnd:!1}}else return{nextState:{...S,actionRequired:null,queuedActions:[]},requiresTurnEnd:!0}}}return{nextState:{...c,actionRequired:v,queuedActions:m},requiresTurnEnd:!1}}}else!r&&c.actionRequired!==null&&(i=!1);return{nextState:c,requiresAnimation:r,requiresTurnEnd:i}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const rd=(n,o,c,i,r)=>{const l={...n[r]},s=l.hand.find(z=>z.id===o);if(!s)return{newState:n};const f=Kv(n,r,c,i,s.protocol);if(!f.allowed)return console.error(`Illegal Move: ${r} tried to play ${s.protocol}-${s.value} - ${f.reason}`),{newState:n};const p=r==="player"?"opponent":"player",h=n[p].lanes[c],_=h.length>0?h[h.length-1]:null;if(_&&_.isFaceUp&&_.protocol==="Plague"&&_.value===0)return{newState:n};if(!i&&_&&_.isFaceUp&&_.protocol==="Metal"&&_.value===2)return console.error(`Illegal Move: ${r} tried to play face-down against Metal-2 in lane ${c}`),{newState:n};if(i){const z=l.protocols[c],V=n[p].protocols[c],le=[...n.player.lanes.flat(),...n.opponent.lanes.flat()].some(ee=>ee.isFaceUp&&ee.protocol==="Psychic"&&ee.value===1),G=[...n.player.lanes.flat(),...n.opponent.lanes.flat()].some(ee=>ee.isFaceUp&&ee.protocol==="Anarchy"&&ee.value===1),P=ud(n),q=n[r].lanes.flat().some(ee=>ee.isFaceUp&&ee.protocol==="Spirit"&&ee.value===1),N=n[r].lanes.some(ee=>{if(ee.length===0)return!1;const ge=ee[ee.length-1];return ge.isFaceUp&&ge.protocol==="Chaos"&&ge.value===3}),k=Jv(n,r,c);let W;if(G||P?W=s.protocol!==z&&s.protocol!==V&&!le:W=(s.protocol===z||s.protocol===V||q||N||k)&&!le,!W){const ee=G||P?"Non-matching protocol required":"matching protocol required";return console.error(`Illegal Move: ${r} tried to play ${s.protocol}-${s.value} face-up in lane ${c} (${ee}, protocols: player=${z}, opponent=${V})`),{newState:n}}}let m={newState:n};const v=n[r].lanes[c];if(v.length>0){const z=v[v.length-1],V={cardOwner:r,actor:r,currentTurn:n.turn,opponent:r==="player"?"opponent":"player",triggerType:"cover"};m=Ga(z,c,n,V)}const w=m.newState,x={...w[r]},C={...s,isFaceUp:i,isRevealed:!1},S={...x.stats,cardsPlayed:x.stats.cardsPlayed+1},E={...x,hand:x.hand.filter(z=>z.id!==o),lanes:x.lanes.map((z,V)=>V===c?[...z,C]:z),stats:S};let j={...w,[r]:E,stats:{...w.stats,[r]:S}};const D=n.queuedActions||[],A=w.queuedActions||[];A===D||A.length===D.length&&A.every((z,V)=>z===D[V])?D.length>0&&(j.queuedActions=D):(console.log("[DEBUG] playCard - Merging queuedActions: oldQueue:",D.length,"coverQueue:",A.length),j.queuedActions=[...D,...A]),j.lastPlayedCardId=C.id,j=Ae(j),j=Ue(j,void 0),j=Le(j,void 0);const L=r==="player"?"Player":"Opponent",H=j[r].protocols[c];let ce;if(r==="opponent"&&!i)ce=`${L} plays a face-down card into Protocol ${H}.`;else{const z=`${s.protocol}-${s.value}`;ce=`${L} plays ${z}`,i||(ce+=" face-down"),ce+=` into Protocol ${H}.`}if(j=T(j,r,ce),j=Ct(j,"after_play",{cardId:C.id}).newState,w.actionRequired)return i&&(j.queuedEffect={card:C,laneIndex:c}),{newState:j,animationRequests:m.animationRequests};{if(r==="opponent")return i&&(j.queuedEffect={card:C,laneIndex:c}),{newState:j,animationRequests:m.animationRequests};let z={newState:j};if(i&&!j.actionRequired){const le={cardOwner:r,actor:r,currentTurn:j.turn,opponent:r==="player"?"opponent":"player",triggerType:"play"};z=el(C,c,j,le)}const V=[...m.animationRequests||[],...z.animationRequests||[]];return{newState:z.newState,animationRequests:V.length>0?V:void 0}}},Zr=(n,o)=>{console.log("[DEBUG performFillHand] Called for player:",o,"Current hand length:",n[o].hand.length);let c=Ue(n,void 0);c=Le(c,void 0),c={...c,_logIndentLevel:0};const i=pd(c,o);return console.log("[DEBUG performFillHand] After refresh, hand length:",i[o].hand.length),i},Ph=(n,o)=>n.useControlMechanic&&n.controlCardHolder===o?{...T(n,o,`${o==="player"?"Player":"Opponent"} has Control and may rearrange protocols before refreshing.`),controlCardHolder:null,actionRequired:{type:"prompt_use_control_mechanic",sourceCardId:"CONTROL_MECHANIC",actor:o,originalAction:{type:"fill_hand"}}}:Zr(n,o);/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const ld=(n,o)=>{var r,l,s,f;if(!n.actionRequired)return{nextState:n};let c={...n},i=null;switch(n.actionRequired.type){case"select_lane_for_shift":{const{cardToShiftId:p,cardOwner:h,actor:_,sourceEffect:m,originalLaneIndex:v,sourceCardId:w}=n.actionRequired;if(o===v)return console.error(`Illegal shift: Cannot shift to the same lane ${v}`),{nextState:n};const x=he(n,w),C=he(n,p);if(x&&x.card.protocol==="Anarchy"&&x.card.value===1&&C&&C.card.isFaceUp){const A=n.player.protocols[o],L=n.opponent.protocols[o],H=C.card.protocol;if(H===A||H===L)return console.error(`Illegal Anarchy-1 shift: ${H}-${C.card.value} cannot be shifted to lane ${o} (protocols: ${A}/${L}) - matching protocol not allowed`),{nextState:n}}if(x&&x.card.protocol==="Gravity"&&x.card.value===1){let A=-1;for(let L=0;L<n[x.owner].lanes.length;L++)if(n[x.owner].lanes[L].some(H=>H.id===w)){A=L;break}if(A!==-1&&!(v===A)&&!(o===A))return console.error(`Illegal Gravity-1 shift: Must shift to or from Gravity lane ${A}, but tried ${v}  ${o}`),{nextState:n}}if(n.actionRequired.destinationRestriction&&C&&n.actionRequired.destinationRestriction.type==="non_matching_protocol"&&C.card.isFaceUp){const L=n.player.protocols[o],H=n.opponent.protocols[o],ce=C.card.protocol;if(ce===L||ce===H)return console.error(`Illegal shift: ${ce} cannot be shifted to lane ${o} (protocols: ${L}/${H}) - matching protocol not allowed`),{nextState:n}}const S=n.player.lanes[v].some(A=>A.isFaceUp&&A.protocol==="Frost"&&A.value===3)||n.opponent.lanes[v].some(A=>A.isFaceUp&&A.protocol==="Frost"&&A.value===3),E=n.player.lanes[o].some(A=>A.isFaceUp&&A.protocol==="Frost"&&A.value===3)||n.opponent.lanes[o].some(A=>A.isFaceUp&&A.protocol==="Frost"&&A.value===3);if(S)return console.error(`Illegal shift: Cannot shift from lane ${v} - blocked by Frost-3`),{nextState:n};if(E)return console.error(`Illegal shift: Cannot shift to lane ${o} - blocked by Frost-3`),{nextState:n};const j=ra(n,p,h,o,_);c=j.newState;const D=c.actionRequired!==null;if(j.animationRequests)i={animationRequests:j.animationRequests,onCompleteCallback:(A,L)=>{let H=A;if(D){if(m==="speed_3_end"){const P={type:"speed_3_self_flip_after_shift",sourceCardId:n.actionRequired.sourceCardId,actor:_};H.queuedActions=[...H.queuedActions||[],P]}const V=he(H,w);if(V&&V.card.protocol==="Anarchy"&&V.card.value===0&&V.card.isFaceUp){const G=H[V.owner].lanes.find(q=>q.some(N=>N.id===w));if(G&&G.length>0&&G[G.length-1].id===w){const q={type:"anarchy_0_conditional_draw",sourceCardId:w,actor:_};H.queuedActions=[...H.queuedActions||[],q]}else H=T(H,_,"Anarchy-0's conditional draw is cancelled because the card is now covered.")}const le=H._pendingCustomEffects;if(le){console.log(`[laneResolver] Queueing ${le.effects.length} pending effects due to interrupt`);const G=he(H,le.sourceCardId);if(G&&G.card.isFaceUp){const P=H[G.owner].lanes.find(N=>N.some(k=>k.id===le.sourceCardId));if(P&&P.length>0&&P[P.length-1].id===le.sourceCardId){const N={type:"execute_remaining_custom_effects",sourceCardId:le.sourceCardId,laneIndex:le.laneIndex,effects:le.effects,context:le.context,actor:_};H.queuedActions=[...H.queuedActions||[],N]}}delete H._pendingCustomEffects}return H}if(m==="speed_3_end"){const V=n.actionRequired.sourceCardId;H=T(H,_,"Speed-3: Flipping itself after shifting a card."),H=Lt(new Set([V]),H),H.animationState={type:"flipCard",cardId:V}}const ce=he(H,w);if(ce&&ce.card.protocol==="Anarchy"&&ce.card.value===0&&ce.card.isFaceUp){const V=H[ce.owner].lanes.find(G=>G.some(P=>P.id===w));V&&V.length>0&&V[V.length-1].id===w?H=Qr(H,_):H=T(H,_,"Anarchy-0's conditional draw is cancelled because the card is now covered.")}const B=H._pendingCustomEffects;if(B){console.log(`[laneResolver] Executing ${B.effects.length} pending effects after shift`);const V=he(H,B.sourceCardId);if(V&&V.card.isFaceUp){const le=H[V.owner].lanes.find(P=>P.some(q=>q.id===B.sourceCardId));if(le&&le.length>0&&le[le.length-1].id===B.sourceCardId){for(const P of B.effects)H=gn(V.card,B.laneIndex,H,B.context,P).newState;delete H._pendingCustomEffects}else H=T(H,_,"Pending effects cancelled because source card is now covered."),delete H._pendingCustomEffects}else delete H._pendingCustomEffects}if(w&&(H=mn(H)),H.actionRequired=null,H=Ct(H,"after_shift",{cardId:p}).newState,H.queuedActions&&H.queuedActions.length>0){const V=H.queuedActions[0];H.queuedActions=H.queuedActions.slice(1),H.actionRequired=V}return L(H)}};else if(D){if(m==="speed_3_end"){const H={type:"speed_3_self_flip_after_shift",sourceCardId:n.actionRequired.sourceCardId,actor:_};c.queuedActions=[...c.queuedActions||[],H]}const A=he(c,w);if(A&&A.card.protocol==="Anarchy"&&A.card.value===0&&A.card.isFaceUp){const L=c[A.owner].lanes.find(ce=>ce.some(B=>B.id===w));if(L&&L.length>0&&L[L.length-1].id===w){const ce={type:"anarchy_0_conditional_draw",sourceCardId:w,actor:_};c.queuedActions=[...c.queuedActions||[],ce]}else c=T(c,_,"Anarchy-0's conditional draw is cancelled because the card is now covered.")}}else{if(m==="speed_3_end"){const ce=n.actionRequired.sourceCardId;c=T(c,_,"Speed-3: Flipping itself after shifting a card."),c=Lt(new Set([ce]),c),c.animationState={type:"flipCard",cardId:ce}}const A=c._pendingCustomEffects;if(A){console.log(`[laneResolver NO ANIM] Executing ${A.effects.length} pending effects after shift`);const ce=he(c,A.sourceCardId);if(ce&&ce.card.isFaceUp){const B=c[ce.owner].lanes.find(V=>V.some(le=>le.id===A.sourceCardId));if(B&&B.length>0&&B[B.length-1].id===A.sourceCardId){for(const V of A.effects)c=gn(ce.card,A.laneIndex,c,A.context,V).newState;delete c._pendingCustomEffects}else c=T(c,_,"Pending effects cancelled because source card is now covered."),delete c._pendingCustomEffects}else delete c._pendingCustomEffects}const L=he(c,w);if(L&&L.card.protocol==="Anarchy"&&L.card.value===0&&L.card.isFaceUp){const ce=c[L.owner].lanes.find(z=>z.some(V=>V.id===w));ce&&ce.length>0&&ce[ce.length-1].id===w?c=Qr(c,_):c=T(c,_,"Anarchy-0's conditional draw is cancelled because the card is now covered.")}if(w&&(c=mn(c)),c.actionRequired=null,c=Ct(c,"after_shift",{cardId:p}).newState,c.queuedActions&&c.queuedActions.length>0){const ce=c.queuedActions[0];c.queuedActions=c.queuedActions.slice(1),c.actionRequired=ce}}break}case"shift_flipped_card_optional":{const p=n.actionRequired.cardId,h=n.actionRequired.actor,m=ra(n,p,h==="player"?"opponent":"player",o,h);c=m.newState,m.animationRequests&&(i={animationRequests:m.animationRequests,onCompleteCallback:(v,w)=>w(v)});break}case"select_lane_for_play":{const{cardInHandId:p,isFaceDown:h,actor:_}=n.actionRequired,m=n[_].hand.find(S=>S.id===p);if(!m){console.error("Card for play not found in hand"),c={...n,actionRequired:null};break}const v={...n,actionRequired:null};let w;if(typeof h=="boolean")w=!h;else{const S=n[_].lanes.flat().some(A=>A.isFaceUp&&A.protocol==="Spirit"&&A.value===1),E=n[_].lanes.some(A=>{if(A.length===0)return!1;const L=A[A.length-1];return L.isFaceUp&&L.protocol==="Chaos"&&L.value===3}),j=_==="player"?"opponent":"player",D=n[j].lanes.flat().some(A=>A.isFaceUp&&A.protocol==="Psychic"&&A.value===1);w=(S||E||m.protocol===n[_].protocols[o]||m.protocol===n[j].protocols[o])&&!D}const{newState:x,animationRequests:C}=rd(v,p,o,w,_);c=x,console.log("[LANE RESOLVER] After playCard - actionRequired?",((r=c.actionRequired)==null?void 0:r.type)||"null","queuedActions?",((l=c.queuedActions)==null?void 0:l.length)||0,"animationRequests?",(C==null?void 0:C.length)||0),C&&(i={animationRequests:C,onCompleteCallback:(S,E)=>{var j;return console.log("[PLAY CALLBACK] Animation complete. queuedActions?",((j=S.queuedActions)==null?void 0:j.length)||0),S.queuedActions&&S.queuedActions.length>0&&console.log("[PLAY CALLBACK] Queue found! First action:",S.queuedActions[0].type),console.log("[PLAY CALLBACK] Calling endTurnCb"),E(S)}});break}case"select_lane_for_delete":{const p=n.actionRequired.actor,h=p==="player"?"Player":"Opponent",_=n.player.protocols[o],m=n.actionRequired.targetFilter||{},v=he(n,n.actionRequired.sourceCardId),w=v?`${v.card.protocol}-${v.card.value}`:"a card effect";c=T(c,p,`${w}: ${h} targets Protocol ${_}.`);const x=[],C=[];for(const S of["player","opponent"]){const E=n[S],j=E.lanes[o].some(D=>D.isFaceUp&&D.protocol==="Darkness"&&D.value===2)?4:2;for(const D of E.lanes[o]){const A=D.isFaceUp?D.value:j;if(m.valueRange){const{min:ce,max:B}=m.valueRange;if(A<ce||A>B)continue}if(m.faceState==="face_up"&&!D.isFaceUp||m.faceState==="face_down"&&D.isFaceUp||m.owner==="own"&&S!==p||m.owner==="opponent"&&S===p)continue;x.push({type:"delete",cardId:D.id,owner:S});const L=S==="player"?"Player's":"Opponent's",H=D.isFaceUp?`${D.protocol}-${D.value}`:"a face-down card";C.push(`${L} ${H}`)}}if(C.length>0){c=T(c,p,`${w}: Deleting ${C.join(", ")}.`);const S={...c.stats[p],cardsDeleted:c.stats[p].cardsDeleted+C.length},E={...c[p],stats:S};c={...c,[p]:E,stats:{...c.stats,[p]:S}}}c.actionRequired=null,x.length>0&&(i={animationRequests:x,onCompleteCallback:(S,E)=>{let j=S;for(let A=0;A<x.length;A++)j=$n(j,p);return j=Ct(j,"after_delete",{}).newState,E(j)}});break}case"select_lane_for_death_2":{const p=n.actionRequired.actor,h=p==="player"?"Player":"Opponent",_=n.player.protocols[o];c=T(c,p,`Death-2: ${h} targets Protocol ${_}.`);const m=[],v=[];for(const w of["player","opponent"]){const x=n[w],C=x.lanes[o].some(S=>S.isFaceUp&&S.protocol==="Darkness"&&S.value===2)?4:2;for(const S of x.lanes[o]){const E=S.isFaceUp?S.value:C;if(E===1||E===2){m.push({type:"delete",cardId:S.id,owner:w});const j=w==="player"?"Player's":"Opponent's",D=S.isFaceUp?`${S.protocol}-${S.value}`:"a face-down card";v.push(`${j} ${D}`)}}}if(v.length>0){const w=he(n,n.actionRequired.sourceCardId),x=w?`${w.card.protocol}-${w.card.value}`:"Death-2";c=T(c,p,`${x}: Deleting ${v.join(", ")}.`);const C={...c.stats[p],cardsDeleted:c.stats[p].cardsDeleted+v.length},S={...c[p],stats:C};c={...c,[p]:S,stats:{...c.stats,[p]:C}}}c.actionRequired=null,m.length>0&&(i={animationRequests:m,onCompleteCallback:(w,x)=>{let C=w;for(let E=0;E<m.length;E++)C=$n(C,p);return C=Ct(C,"after_delete",{}).newState,x(C)}});break}case"select_lane_for_metal_3_delete":{const p=n.actionRequired.actor,h=p==="player"?"Player":"Opponent",_=n.player.protocols[o],m=n.player.lanes[o].length+n.opponent.lanes[o].length;if(m<8){c=T(c,p,`Metal-3: ${h} cannot delete Protocol ${_} (only ${m} cards, need 8+).`),c.actionRequired=null;break}c=T(c,p,`Metal-3: ${h} targets Protocol ${_} for deletion.`);const v=[];for(const C of["player","opponent"])for(const S of n[C].lanes[o])v.push({type:"delete",cardId:S.id,owner:C});const w={...c.stats[p],cardsDeleted:c.stats[p].cardsDeleted+v.length},x={...c[p],stats:w};c={...c,[p]:x,stats:{...c.stats,[p]:w}},c.actionRequired=null,v.length>0&&(i={animationRequests:v,onCompleteCallback:(C,S)=>{let E=C;for(let D=0;D<v.length;D++)E=$n(E,p);return E=Ct(E,"after_delete",{}).newState,S(E)}});break}case"select_lane_for_life_3_play":{const{actor:p}=n.actionRequired,h={...n,actionRequired:null};let _=h,m={newState:_};const v=h[p].lanes[o].length>0?h[p].lanes[o][h[p].lanes[o].length-1]:null;if(v){const E={cardOwner:p,actor:p,currentTurn:h.turn,opponent:p==="player"?"opponent":"player",triggerType:"cover"};m=Ga(v,o,h,E),_=m.newState}const w={..._[p]},{drawnCards:x,remainingDeck:C,newDiscard:S}=uo(w.deck,w.discard,1);if(x.length>0){const E={...x[0],id:He(),isFaceUp:!1},j=[...w.lanes];j[o]=[...j[o],E];const D={...w,lanes:j,deck:C,discard:S};c={..._,[p]:D},c=T(c,p,"Life-3 On-Cover: Plays a card face-down."),m.animationRequests&&(i={animationRequests:m.animationRequests,onCompleteCallback:(A,L)=>L(A)})}else c=_;break}case"select_lane_to_shift_revealed_card_for_light_2":{const{revealedCardId:p,actor:h}=n.actionRequired,_=he(n,p);if(_){const m=ra(n,p,_.owner,o,h);c=m.newState,m.animationRequests&&(i={animationRequests:m.animationRequests,onCompleteCallback:(v,w)=>v.actionRequired?v:w(v)})}break}case"select_lane_to_shift_cards_for_light_3":{const{sourceLaneIndex:p,actor:h}=n.actionRequired,_=h==="player"?"opponent":"player",m=n[h].lanes[p].filter(j=>!j.isFaceUp),v=n[_].lanes[p].filter(j=>!j.isFaceUp),w=n[h].lanes.map((j,D)=>D===p?j.filter(A=>A.isFaceUp):D===o?[...j,...m]:j),x=n[_].lanes.map((j,D)=>D===p?j.filter(A=>A.isFaceUp):D===o?[...j,...v]:j),C=m.length+v.length,S={...n.stats[h],cardsShifted:n.stats[h].cardsShifted+C},E={...n[h],lanes:w,stats:S};if(c={...n,[h]:E,[_]:{...n[_],lanes:x},stats:{...n.stats,[h]:S},actionRequired:null},C>0){const j=n[h].protocols[p],D=n[h].protocols[o];c=T(c,h,`Light-3: Shifts ${C} face-down card(s) from Protocol ${j} to Protocol ${D}.`)}break}case"select_lane_for_water_3":{const p=n.actionRequired.actor,h=p==="player"?"opponent":"player",_={...n[p]},m={...n[h]},v=_.lanes[o].filter(E=>mt(E,_.lanes[o])===2),w=m.lanes[o].filter(E=>mt(E,m.lanes[o])===2);if(v.length===0&&w.length===0){c={...n,actionRequired:null};break}const x=new Set(v.map(E=>E.id)),C=new Set(w.map(E=>E.id));_.lanes[o]=_.lanes[o].filter(E=>!x.has(E.id)),m.lanes[o]=m.lanes[o].filter(E=>!C.has(E.id)),_.hand.push(...v),m.hand.push(...w),c={...n,[p]:_,[h]:m,actionRequired:null};const S=v.length+w.length;if(S>0){const E=p==="player"?"Player":"Opponent",j=he(n,n.actionRequired.sourceCardId),D=j?`${j.card.protocol}-${j.card.value}`:"a card effect";c=T(c,p,`${D}: ${E} selects ${["left","middle","right"][o]} lane and returns ${S} card(s) with value 2 (Player: ${v.length}, Opponent: ${w.length}).`)}break}default:return{nextState:n}}return console.log("[LANE RESOLVER END] Returning - actionRequired?",((s=c.actionRequired)==null?void 0:s.type)||"null","queuedActions?",((f=c.queuedActions)==null?void 0:f.length)||0,"requiresAnimation?",i?"yes":"no"),{nextState:Ae(c),requiresAnimation:i}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const ph=(n,o)=>{const c=o==="player"?"opponent":"player";if(n[c].lanes.flat().some(l=>l.isFaceUp&&l.protocol==="Plague"&&l.value===1)){let l={...n};return l=Ue(l,"Plague-1"),l=Le(l,void 0),l=T(l,c,"Triggers after opponent discards: Draw 1 card."),l=Ge(l,c,1),l=Ue(l,void 0),l}return n};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const fh=(n,o)=>{if(n.processedSpeed1TriggerThisTurn)return n;if(n[o].lanes.flat().some(r=>r.isFaceUp&&r.protocol==="Speed"&&r.value===1)){let r={...n};return r=Ue(r,"Speed-1"),r=Le(r,void 0),r=T(r,o,"Triggers after clearing cache: Draw 1 card."),r=Ge(r,o,1),r.processedSpeed1TriggerThisTurn=!0,r=Ue(r,void 0),r.phase="end",r}return n},la=(n,o,c)=>{var H,ce,B;const i=n[c],r=new Set(o),l=i.hand.filter(z=>r.has(z.id));if(l.length===0)return n;const s=i.hand.filter(z=>!r.has(z.id)),f=[...i.discard,...l.map(({id:z,isFaceUp:V,...le})=>le)],p=((H=n.animationState)==null?void 0:H.type)==="discardCard"&&((ce=n.animationState.originalAction)==null?void 0:ce.type)==="discard"?n.animationState.originalAction:((B=n.actionRequired)==null?void 0:B.type)==="discard"?n.actionRequired:null,h={...i.stats,cardsDiscarded:i.stats.cardsDiscarded+l.length},_={...i,hand:s,discard:f,stats:h},m=p==null?void 0:p.followUpEffect,v=p==null?void 0:p.conditionalType,w=p==null?void 0:p.previousHandSize;let x={...n,[c]:_,stats:{...n.stats,[c]:h},actionRequired:m?{type:"discard_completed",followUpEffect:m,conditionalType:v,previousHandSize:w,sourceCardId:p==null?void 0:p.sourceCardId,actor:c}:null};if(p!=null&&p.sourceCardId){const z=x.player.lanes.flat().find(V=>V.id===p.sourceCardId)||x.opponent.lanes.flat().find(V=>V.id===p.sourceCardId);if(z){const V=`${z.protocol}-${z.value}`;x=Ue(x,V),x=Le(x,"middle")}else x=Ue(x,void 0),x=Le(x,void 0),x={...x,_logIndentLevel:0}}else x=Ue(x,void 0),x=Le(x,void 0),x={...x,_logIndentLevel:0};const C=c==="player"?"Player":"Opponent";let S;if(c==="player"||l.every(z=>z.isRevealed)){const z=l.map(V=>`${V.protocol}-${V.value}`).join(", ");S=`${C} discards ${z}.`}else{const z=l.length===1?"card":"cards";S=`${C} discards ${l.length} ${z}.`}x=T(x,c,S);const E=(z,V)=>{const le=n.phase==="hand_limit"&&!(V!=null&&V.sourceCardId);let G=z;le&&(G=fh(G,c),G=Ct(G,"after_clear_cache",{}).newState);const P=ph(G,c),N=Ct(P,"after_opponent_discard",{}).newState;return Fh(N,c,V==null?void 0:V.sourceEffect,V==null?void 0:V.sourceCardId)};if(p&&p.actor===c){const z=p.count-o.length;return z>0?(x.actionRequired={...p,count:z},x):E(x,p)}const j=n.actionRequired;if(j&&j.type==="discard"&&j.actor===c){const z=j.count-o.length;return z>0?(x.actionRequired={...j,count:z},x):E(x,j)}const D=n.phase==="hand_limit";let A=ph(x,c);return A=Ct(A,"after_opponent_discard",{}).newState,D&&(A=fh(A,c),A=Ct(A,"after_clear_cache",{}).newState),A},S0=(n,o)=>{var s;if(((s=n.actionRequired)==null?void 0:s.type)!=="plague_2_player_discard")return n;const c=n.actionRequired.actor,i=c==="player"?"opponent":"player";let r=la(n,o,c);const l=o.length+1;return r[i].hand.length>0?r.actionRequired={type:"discard",actor:i,count:Math.min(l,r[i].hand.length),sourceCardId:n.actionRequired.sourceCardId}:r.actionRequired=null,r},Ih=(n,o)=>{var s;if(((s=n.actionRequired)==null?void 0:s.type)!=="plague_2_opponent_discard")return n;const c=n.actionRequired.actor,i=c==="player"?"opponent":"player";let r=la(n,o,c);const l=o.length+1;return r[i].hand.length>0?r.actionRequired={type:"discard",actor:i,count:Math.min(l,r[i].hand.length),sourceCardId:n.actionRequired.sourceCardId}:r.actionRequired=null,r},hh=(n,o)=>{var p,h,_;const c=((p=n.actionRequired)==null?void 0:p.type)==="discard"&&((h=n.actionRequired)==null?void 0:h.variableCount),i=((_=n.actionRequired)==null?void 0:_.type)==="select_cards_from_hand_to_discard_for_fire_4";if(!c&&!i)return n;const r=n.actionRequired.actor,l=n.actionRequired.sourceCardId;let s=la(n,o,r);if(c&&l)return Fh(s,r,void 0,l);const f=o.length+1;return s=T(s,r,`Fire-4: Drawing ${f} card(s).`),s=Ge(s,r,f),s},Wi=(n,o)=>{var p;if(((p=n.actionRequired)==null?void 0:p.type)!=="select_cards_from_hand_to_discard_for_hate_1")return n;const{sourceCardId:c,actor:i}=n.actionRequired;let r=la(n,o,i);const s=l0(r,[]),f=Math.min(2,s);return f>0?r.actionRequired={type:"select_cards_to_delete",count:f,sourceCardId:c,disallowedIds:[],actor:i}:(r=T(r,i,"Hate-1: No valid targets to delete."),r.actionRequired=null),r};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Wr=(n,o,c)=>{const i=n.turn,r=i==="player"?"opponent":"player";let l={...n};if(l.compileBlockedPlayer===i&&l.compileBlockedUntilTurn>(l.turnNumber||0)){const le=i==="player"?"Player":"Opponent";return console.log(`[Compile Block] ${le}'s compile is blocked until turn ${l.compileBlockedUntilTurn}`),l=T(l,i,`${le} can't compile - blocked by opponent's effect.`),l}if(l.useControlMechanic&&l.controlCardHolder===i){const le=i==="player"?"Player":"Opponent";return l=Ue(l,void 0),l=Le(l,void 0),l={...l,_logIndentLevel:0},l=T(l,i,`${le} has Control and may rearrange protocols before compiling.`),l.actionRequired={type:"prompt_use_control_mechanic",sourceCardId:"CONTROL_MECHANIC",actor:i,originalAction:{type:"compile",laneIndex:o}},l.controlCardHolder=null,l}let p={...l[i]},h={...l[r]};const _=p.compiled[o],m=[];for(const le of[i,r])l[le].lanes[o].forEach(P=>{if(P.isFaceUp){const q=P;q.customEffects&&q.customEffects.topEffects&&q.customEffects.topEffects.some(k=>k.trigger==="before_compile_delete")&&m.push({card:P,owner:le})}});for(const{card:le,owner:G}of m)console.log(`[before_compile_delete] Executing effect for custom card ${le.protocol}-${le.value}`),l=Ct(l,"before_compile_delete",{cardId:le.id}).newState;p={...l[i]},h={...l[r]};const v=[],w=[],x=p.lanes[o].filter(le=>le.protocol==="Speed"&&le.value===2&&le.isFaceUp?(v.push(le),!1):!0),C=h.lanes[o].filter(le=>le.protocol==="Speed"&&le.value===2&&le.isFaceUp?(w.push(le),!1):!0),S={...p.stats,cardsDeleted:p.stats.cardsDeleted+x.length},E={...h.stats,cardsDeleted:h.stats.cardsDeleted+C.length};p.stats=S,h.stats=E,p.discard=[...p.discard,...x.map(({id:le,isFaceUp:G,...P})=>P)],h.discard=[...h.discard,...C.map(({id:le,isFaceUp:G,...P})=>P)];const j=[...p.lanes];j[o]=v,p.lanes=j;const D=[...h.lanes];D[o]=w,h.lanes=D;const A=[...p.compiled];A[o]=!0,p.compiled=A,l={...l,[i]:p,[r]:h,stats:{...l.stats,[i]:S,[r]:E}},l=Ue(l,void 0),l=Le(l,void 0),l={...l,_logIndentLevel:0};const L=i==="player"?"Player":"Opponent",H=p.protocols[o];if(l=T(l,i,`${L} compiles Protocol ${H}!`),_&&(l=T(l,i,`${L} draws 1 card from the opponent's deck as a re-compile reward.`),l=Uh(l,i,1)),l=Ae(l),p.compiled.every(le=>le===!0))return l.winner=i,c(i,l),l;x.length+C.length>0&&(l=$n(l,i),l=Ct(l,"after_delete",{}).newState);const V=[...v,...w].map(le=>{const G=he(l,le.id).owner;return l=T(l,G,"Speed-2 survives compilation and must be shifted."),{type:"select_lane_for_shift",cardToShiftId:le.id,cardOwner:G,originalLaneIndex:o,sourceCardId:le.id,actor:G}});if(V.length>0){const le=V.shift();l.actionRequired=le,l.queuedActions=V,le.actor!==i&&(l._interruptedTurn=i,l._interruptedPhase=l.phase,l.turn=le.actor)}else l.actionRequired=null,l.queuedActions=[];return l},Hh=(n,o)=>n,b0=(n,o)=>{var h;if(((h=n.actionRequired)==null?void 0:h.type)!=="select_card_from_hand_to_play")return n;const{disallowedLaneIndex:c,sourceCardId:i,isFaceDown:r,actor:l,destinationRule:s,condition:f,faceDown:p}=n.actionRequired;return{...n,actionRequired:{type:"select_lane_for_play",cardInHandId:o,disallowedLaneIndex:c,sourceCardId:i,isFaceDown:r||p,actor:l,destinationRule:s,condition:f}}},yh=n=>{if(!n.actionRequired||!("optional"in n.actionRequired)||!n.actionRequired.optional)return n;const o="actor"in n.actionRequired?n.actionRequired.actor:n.turn,c=o==="player"?"Player":"Opponent";let i={...n,actionRequired:null};return i=T(i,o,`${c} skips the optional action.`),i},_h=n=>{var l;if(((l=n.actionRequired)==null?void 0:l.type)!=="reveal_opponent_hand")return n;const o=n.actionRequired.actor,c=o==="player"?"opponent":"player";let i={...n};const r={...i[c]};if(r.hand.length>0){r.hand=r.hand.map(p=>({...p,isRevealed:!0})),i[c]=r;const s=he(i,n.actionRequired.sourceCardId),f=s?`${s.card.protocol}-${s.card.value}`:"A card effect";i=T(i,o,`${f}: Opponent reveals their hand.`)}return i.actionRequired=null,i},mh=(n,o)=>$o(n,o),gh=(n,o)=>Cc(n,o).newState;/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const vh=(n,o)=>{var p;if(((p=n.actionRequired)==null?void 0:p.type)!=="prompt_optional_draw")return n;const{sourceCardId:c,actor:i,count:r,drawingPlayer:l}=n.actionRequired,s=i.charAt(0).toUpperCase()+i.slice(1);let f={...n};if(o){f=T(f,i,`${s} chooses to draw ${r} card${r!==1?"s":""}.`),f=Ge(f,l||i,r);const h=n.actionRequired.followUpEffect;if(h){f=T(f,i,`[DEBUG] Draw accepted, executing followUp: ${h.id}`);const _=he(f,c);if(_){const m=f[_.owner].lanes.findIndex(C=>C.some(S=>S.id===c)),v=i==="player"?"opponent":"player",w={cardOwner:i,currentTurn:f.turn,opponent:v};f=gn(_.card,m,f,w,h).newState}else f.actionRequired=null}else f.actionRequired=null}else f=T(f,i,`${s} skips the draw.`),f.actionRequired=null;return f},wh=(n,o)=>{var s;if(((s=n.actionRequired)==null?void 0:s.type)!=="prompt_death_1_effect")return n;const{sourceCardId:c,actor:i}=n.actionRequired,r=i.charAt(0).toUpperCase()+i.slice(1);let l={...n};return o?(l=T(l,i,`Death-1: ${r} chooses to draw and delete.`),l=Ge(l,i,1),l.actionRequired={type:"select_card_to_delete_for_death_1",sourceCardId:c,actor:i}):(l=T(l,i,`Death-1: ${r} skips the effect.`),l.actionRequired=null),l},Qi=(n,o)=>{var l;if(((l=n.actionRequired)==null?void 0:l.type)!=="prompt_give_card_for_love_1")return n;const{actor:c}=n.actionRequired,i=c.charAt(0).toUpperCase()+c.slice(1);let r={...n};return o?(r=T(r,c,`Love-1 End: ${i} chooses to give 1 card to draw 2.`),r.actionRequired={type:"select_card_from_hand_to_give",sourceCardId:n.actionRequired.sourceCardId,sourceEffect:"love_1_end",actor:c}):(r=T(r,c,`Love-1 End: ${i} skips the effect.`),r.actionRequired=null),r},xh=(n,o,c)=>{var r;if(((r=n.actionRequired)==null?void 0:r.type)!=="plague_4_player_flip_optional")return n;let i={...n,actionRequired:null};if(i=Ue(i,"Plague-4"),i=Le(i,"end"),o){const{sourceCardId:l}=n.actionRequired;i=T(i,c,`${c==="player"?"Player":"Opponent"} chooses to flip the card.`),i=Lt(new Set([l]),i),i.animationState={type:"flipCard",cardId:l}}else i=T(i,c,`${c==="player"?"Player":"Opponent"} skips flipping the card.`);return i=Ue(i,void 0),i=Le(i,void 0),i=mn(i),i},Ch=(n,o)=>{var l;if(((l=n.actionRequired)==null?void 0:l.type)!=="prompt_fire_3_discard")return n;const{actor:c}=n.actionRequired,i=c.charAt(0).toUpperCase()+c.slice(1);let r={...n};return o?(r=T(r,c,`Fire-3 End: ${i} chooses to discard 1 to flip 1.`),r.actionRequired={type:"discard",actor:c,count:1,sourceCardId:n.actionRequired.sourceCardId,sourceEffect:"fire_3"}):(r=T(r,c,`Fire-3 End: ${i} skips the effect.`),r.actionRequired=null),r},Sh=(n,o)=>{var h,_,m;if(((h=n.actionRequired)==null?void 0:h.type)!=="prompt_optional_discard_custom")return n;const{actor:c,count:i,sourceCardId:r}=n.actionRequired,l=c.charAt(0).toUpperCase()+c.slice(1);let s={...n};const f=(_=n.actionRequired)==null?void 0:_.followUpEffect,p=(m=n.actionRequired)==null?void 0:m.conditionalType;return o?(s=T(s,c,`${l} chooses to discard ${i} card(s).`),s.actionRequired={type:"discard",actor:c,count:i,sourceCardId:r,followUpEffect:f,conditionalType:p,previousHandSize:s[c].hand.length}):(s=T(s,c,`${l} skips the discard.`),s.actionRequired=null),s},E0=(n,o)=>{var p;if(((p=n.actionRequired)==null?void 0:p.type)!=="prompt_optional_effect")return n;const{actor:c,sourceCardId:i,effectDef:r,laneIndex:l}=n.actionRequired,s=c.charAt(0).toUpperCase()+c.slice(1);let f={...n};if(o){const h=r.params.action;f=T(f,c,`${s} chooses to execute the optional ${h} effect.`);const _=[...f.player.lanes.flat(),...f.opponent.lanes.flat()].find(x=>x.id===i);if(!_)return console.error("[Optional Effect] Source card not found!"),f.actionRequired=null,f;const m={cardOwner:c,opponent:c==="player"?"opponent":"player",currentTurn:f.turn},v={...r,params:{...r.params,optional:!1}};return gn(_,l,f,m,v).newState}else{const h=r.params.action;return f=T(f,c,`${s} skips the optional ${h} effect.`),f.actionRequired=null,f}},bh=(n,o)=>{var s;if(((s=n.actionRequired)==null?void 0:s.type)!=="prompt_shift_for_speed_3")return n;const{actor:c,sourceCardId:i}=n.actionRequired,r=c.charAt(0).toUpperCase()+c.slice(1);let l={...n};if(o){const f=[];for(const p of l[c].lanes)if(p.length>0){const h=p[p.length-1];h.id!==i&&f.push(h)}f.length>0?(l=T(l,c,`Speed-3 End: ${r} chooses to shift a card.`),l.actionRequired={type:"select_own_card_to_shift_for_speed_3",sourceCardId:i,actor:c}):(l=T(l,c,`Speed-3 End: ${r} has no cards to shift, skipping effect.`),l.actionRequired=null)}else l=T(l,c,`Speed-3 End: ${r} skips the shift.`),l.actionRequired=null;return l},Xi=(n,o)=>{var f;if(((f=n.actionRequired)==null?void 0:f.type)!=="prompt_shift_or_flip_for_light_2")return n;const{actor:c,sourceCardId:i,revealedCardId:r}=n.actionRequired,l=c.charAt(0).toUpperCase()+c.slice(1);let s={...n};switch(o){case"shift":s=T(s,c,`Light-2: ${l} chooses to shift the revealed card.`),s.actionRequired={type:"select_lane_to_shift_revealed_card_for_light_2",sourceCardId:i,revealedCardId:r,actor:c};break;case"flip":{s=T(s,c,`Light-2: ${l} chooses to flip the revealed card face-up.`);const p={...s,actionRequired:null};let h=Lt(new Set([r]),p);h.animationState={type:"flipCard",cardId:r},s=Lo(h,r).newState;break}case"skip":s=T(s,c,`Light-2: ${l} chooses to do nothing with the revealed card.`),s.actionRequired=null;break}return s},Zi=(n,o,c)=>{var j;if(((j=n.actionRequired)==null?void 0:j.type)!=="prompt_rearrange_protocols")return n;const i=n0(n);if(!i.allowed)return console.error(`Protocol rearrangement blocked: ${i.reason}`),n;const{target:r,actor:l,originalAction:s,sourceCardId:f,disallowedProtocolForLane:p}=n.actionRequired;if(p){const{laneIndex:D,protocol:A}=p;if(o[D]===A)return console.error(`Illegal rearrange: ${A} cannot be placed on lane ${D} due to Anarchy-3 restriction`),n}let h={...n};const _={...h[r]},m={};_.protocols.forEach((D,A)=>{m[D]=_.compiled[A]});const v=o.map(D=>m[D]);_.protocols=o,_.compiled=v,h[r]=_,h.actionRequired=null;let w="Control Action";if(f!=="CONTROL_MECHANIC"){const D=[...h.player.lanes.flat(),...h.opponent.lanes.flat()].find(A=>A.id===f);D&&(w=`${D.protocol}-${D.value}`)}const x=l.charAt(0).toUpperCase()+l.slice(1),C=r===l?"their own":"the opponent's",S=o.join(" | ");h=T(h,l,`${w}: ${x} rearranges ${C} protocols.`),h=T(h,l,`New protocol order for ${r}: ${S}`);let E=Ae(h);if(s){if(console.log("[DEBUG resolveRearrangeProtocols] originalAction:",s),s.type==="compile")return E=T(E,l,"Resuming Compile action..."),Wr(E,s.laneIndex,c);if(s.type==="fill_hand"){console.log("[DEBUG resolveRearrangeProtocols] Calling performFillHand for actor:",l,"hand before:",E[l].hand.length),E=T(E,l,"Resuming Refresh action...");const D=Zr(E,l);return console.log("[DEBUG resolveRearrangeProtocols] After performFillHand, hand length:",D[l].hand.length),console.log("[DEBUG resolveRearrangeProtocols] RETURNING state with",D[l].hand.length,"cards"),D}else s.type==="continue_turn"?s.queuedSpeed2Actions&&s.queuedSpeed2Actions.length>0?(E=T(E,l,"Processing remaining Speed-2 effects..."),E.queuedActions=[...s.queuedSpeed2Actions,...E.queuedActions||[]]):(E=T(E,l,"Turn ends after compile."),E.phase="hand_limit"):s.type==="resume_interrupted_turn"&&(E=T(E,l,"Resuming interrupted turn..."),E._interruptedTurn=s.interruptedTurn,E._interruptedPhase=s.interruptedPhase,s.queuedSpeed2Actions&&s.queuedSpeed2Actions.length>0&&(E.queuedActions=[...s.queuedSpeed2Actions,...E.queuedActions||[]]))}return E},Ki=(n,o)=>{var l;if(((l=n.actionRequired)==null?void 0:l.type)!=="prompt_return_for_psychic_4")return n;const{actor:c}=n.actionRequired,i=c.charAt(0).toUpperCase()+c.slice(1);let r={...n};return o?(r=T(r,c,`Psychic-4 End: ${i} chooses to return an opponent's card.`),r.actionRequired={type:"select_opponent_card_to_return",sourceCardId:n.actionRequired.sourceCardId,actor:c}):(r=T(r,c,`Psychic-4 End: ${i} skips the effect.`),r.actionRequired=null),r},Ji=(n,o)=>{var s;if(((s=n.actionRequired)==null?void 0:s.type)!=="prompt_spirit_1_start")return n;const{actor:c,sourceCardId:i}=n.actionRequired,r=c.charAt(0).toUpperCase()+c.slice(1);let l={...n};return o==="discard"?(l=T(l,c,`Spirit-1 Start: ${r} chooses to discard 1 card.`),l.actionRequired={type:"discard",actor:c,count:1,sourceCardId:i,sourceEffect:"spirit_1_start"}):(l=T(l,c,`Spirit-1 Start: ${r} chooses to flip the card.`),l=Lt(new Set([i]),l),l.animationState={type:"flipCard",cardId:i},l.actionRequired=null),l},ed=(n,o)=>{var s;if(((s=n.actionRequired)==null?void 0:s.type)!=="prompt_shift_for_spirit_3")return n;const{actor:c,sourceCardId:i}=n.actionRequired,r=c.charAt(0).toUpperCase()+c.slice(1);let l={...n};if(o){const f=he(l,i);if(f){const{owner:p,card:h}=f;let _=-1;for(let m=0;m<l[p].lanes.length;m++)if(l[p].lanes[m].some(v=>v.id===h.id)){_=m;break}_!==-1&&(l=T(l,c,`Spirit-3 Trigger: ${r} chooses to shift the card.`),l.actionRequired={type:"select_lane_for_shift",cardToShiftId:i,cardOwner:p,originalLaneIndex:_,sourceCardId:i,actor:c})}}else l=T(l,c,`Spirit-3 Trigger: ${r} skips the shift.`),l.actionRequired=null;return l},Eh=(n,o,c)=>{var E;if(((E=n.actionRequired)==null?void 0:E.type)!=="prompt_swap_protocols")return n;const{actor:i,target:r,originalAction:l,sourceCardId:s}=n.actionRequired,f={...n[r]},[p,h]=o.sort((j,D)=>j-D),_=[...f.protocols],m=[...f.compiled];[_[p],_[h]]=[_[h],_[p]],[m[p],m[h]]=[m[h],m[p]],f.protocols=_,f.compiled=m;let v={...n,[r]:f,actionRequired:null};const w=i.charAt(0).toUpperCase()+i.slice(1),x=r.charAt(0).toUpperCase()+r.slice(1);v=T(v,i,`${s==="CONTROL_MECHANIC"?"Control":"Spirit-4"}: ${w} swaps ${x}'s protocols ${_[h]} and ${_[p]}.`),s==="CONTROL_MECHANIC"&&(v.controlCardHolder=null);let S=Ae(v);if(l){if(l.type==="compile")return S=T(S,i,"Resuming Compile action..."),Wr(S,l.laneIndex,c);if(l.type==="fill_hand")return S=T(S,i,"Resuming Refresh action..."),Zr(S,i)}return S};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const td=(n,o)=>{if(!n.actionRequired)return n;const{actionRequired:c}=n,i=c.actor,r=i==="player"?"opponent":"player";switch(c.type){case"select_card_from_hand_to_give":{const l=n[i].hand.find(m=>m.id===o);if(!l)return n;let s={...n};const f={...s[i]},p={...s[r]};f.hand=f.hand.filter(m=>m.id!==o),p.hand=[...p.hand,l],s={...s,[i]:f,[r]:p};const h=i==="player"?"Player":"Opponent",_=`${l.protocol}-${l.value}`;return s=T(s,i,`${h} gives ${_} to the opponent.`),c.sourceEffect==="love_1_end"&&(s=T(s,i,`Love-1: ${h} draws 2 cards.`),s=Ge(s,i,2)),s.actionRequired=null,s}case"select_card_from_hand_to_reveal":{const l=n[i].hand.find(m=>m.id===o);if(!l)return n;let s={...n};const f={...s[i]},p=f.hand.map(m=>m.id===o?{...m,isRevealed:!0}:m);f.hand=p,s={...s,[i]:f};const h=i==="player"?"Player":"Opponent",_=`${l.protocol}-${l.value}`;return s=T(s,i,`Love-4: ${h} reveals ${_} from their hand.`),s.actionRequired={type:"select_any_card_to_flip",count:1,sourceCardId:c.sourceCardId,actor:i},s}default:return n}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function Vh(n){const o=n.player,c=[],i=[];for(let r=0;r<3;r++)o.compiled[r]?c.push(r):i.push(r);if(c.length===0||i.length===0)return!1;for(const r of c)for(const l of i)if(o.laneValues[l]-o.laneValues[r]>0)return!0;return!1}function Bh(n){const o=n.opponent,c=[],i=[];for(let r=0;r<3;r++)o.compiled[r]?c.push(r):i.push(r);if(c.length===0||i.length===0)return!1;for(const r of c)for(const l of i){const f=10-o.laneValues[r];if(f>=0&&f<=3){const h=10-o.laneValues[l];if(f<h)return!0}}return!1}function fd(n,o){if(!o||o.type!=="prompt_rearrange_protocols")return{type:"rearrangeProtocols",newOrder:[...n.opponent.protocols]};const c=o.target,i=o.disallowedProtocolForLane,r=_=>{if(!i)return!0;const{laneIndex:m,protocol:v}=i;return _[m]!==v},l=n.opponent,s=n.player,f=l.compiled.filter(_=>_).length;if(s.compiled.filter(_=>_).length===2&&f===2){const _=s.compiled.findIndex(x=>!x),m=l.compiled.findIndex(x=>!x),v=s.laneValues[_],w=l.laneValues[m];if(v>w&&c==="player"){let x=-1,C=1/0;for(let S=0;S<3;S++)s.compiled[S]&&s.laneValues[S]<C&&(C=s.laneValues[S],x=S);if(x!==-1&&C<=v){const S=[...s.protocols];return[S[_],S[x]]=[S[x],S[_]],{type:"rearrangeProtocols",newOrder:S}}return{type:"rearrangeProtocols",newOrder:[...s.protocols]}}if(v<=w&&c==="opponent"){let x=-1,C=-1;for(let S=0;S<3;S++)l.compiled[S]&&l.laneValues[S]>C&&(C=l.laneValues[S],x=S);if(x!==-1&&C>w&&C>0){const S=[...l.protocols];return[S[m],S[x]]=[S[x],S[m]],{type:"rearrangeProtocols",newOrder:S}}return{type:"rearrangeProtocols",newOrder:[...l.protocols]}}}if(c==="player"){const _=[],m=[];for(let x=0;x<3;x++)s.compiled[x]?_.push(x):m.push(x);if(_.length===0||m.length===0)return{type:"rearrangeProtocols",newOrder:[...s.protocols]};let v=null;for(const x of _)for(const C of m){const S=s.laneValues[C]-s.laneValues[x];(!v||S>v.score)&&(v={compiledIdx:x,uncompiledIdx:C,score:S})}if(v&&v.score>0){const x=[...s.protocols];return[x[v.compiledIdx],x[v.uncompiledIdx]]=[x[v.uncompiledIdx],x[v.compiledIdx]],{type:"rearrangeProtocols",newOrder:x}}if(o.sourceCardId!=="CONTROL_MECHANIC"){const x=[...s.protocols];return[x[0],x[1]]=[x[1],x[0]],{type:"rearrangeProtocols",newOrder:x}}return{type:"rearrangeProtocols",newOrder:[...s.protocols]}}if(c==="opponent"){const _=[],m=[];for(let x=0;x<3;x++)l.compiled[x]?_.push(x):m.push(x);if(_.length===0||m.length===0){if(o.sourceCardId!=="CONTROL_MECHANIC"){const C=[...l.protocols];return[C[0],C[1]]=[C[1],C[0]],{type:"rearrangeProtocols",newOrder:C}}return{type:"rearrangeProtocols",newOrder:[...l.protocols]}}let v=null;for(const x of _)for(const C of m){const E=10-l.laneValues[x];E>=0&&(!v||E<v.distanceToWin)&&(v={compiledIdx:x,uncompiledIdx:C,distanceToWin:E})}if(v&&v.distanceToWin<=3){const C=10-l.laneValues[v.uncompiledIdx];if(v.distanceToWin<C){const S=[...l.protocols];return[S[v.compiledIdx],S[v.uncompiledIdx]]=[S[v.uncompiledIdx],S[v.compiledIdx]],{type:"rearrangeProtocols",newOrder:S}}}if(o.sourceCardId!=="CONTROL_MECHANIC"){const x=[...l.protocols];return[x[0],x[1]]=[x[1],x[0]],{type:"rearrangeProtocols",newOrder:x}}return{type:"rearrangeProtocols",newOrder:[...l.protocols]}}const h=c==="player"?[...s.protocols]:[...l.protocols];if(r(h))return{type:"rearrangeProtocols",newOrder:h};for(let _=0;_<3;_++)for(let m=_+1;m<3;m++){const v=[...h];if([v[_],v[m]]=[v[m],v[_]],r(v))return{type:"rearrangeProtocols",newOrder:v}}return{type:"rearrangeProtocols",newOrder:h}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const j0=n=>{const{opponent:o,player:c}=n;if(o.hand.length===0)return null;const i=v=>{const w=n.player.lanes[v];if(w.length===0)return!1;const x=w[w.length-1];return x.isFaceUp&&x.protocol==="Plague"&&x.value===0},r=v=>n.player.laneValues[v]>=10&&n.player.laneValues[v]>n.opponent.laneValues[v],l=c.lanes.flat().some(v=>v.isFaceUp&&v.protocol==="Psychic"&&v.value===1);for(let v=0;v<3;v++)if(!i(v)&&!r(v)&&!o.compiled[v]&&(o.laneValues[v]===8||o.laneValues[v]===9))return{cardId:o.hand[0].id,laneIndex:v,isFaceUp:!1};const s=o.hand.filter(v=>v.protocol==="Water"&&v.value===4?o.lanes.flat().some(C=>C.protocol!=="Water"):!0);if(s.length===0)return null;const f=[...s].sort((v,w)=>w.value-v.value),p=f.find(v=>{if(v.protocol==="Metal"&&v.value===6){for(let w=0;w<3;w++)if(o.laneValues[w]+6>=10)return!0;return!1}return!0})||f[0];let h=!1;if(p.protocol==="Hate"&&p.value===2){for(let v=0;v<3;v++)if(o.protocols[v]==="Hate"){let w=0;for(let x=0;x<3;x++){const C=o.lanes[x];if(C.length>0&&x!==v){const S=C[C.length-1],E=S.isFaceUp?S.value:2;E>w&&(w=E)}}if(2>=w){h=!0;break}}}if(!l&&!h){const v=o.lanes.flat().some(C=>C.isFaceUp&&C.protocol==="Spirit"&&C.value===1),w=o.lanes.some(C=>{if(C.length===0)return!1;const S=C[C.length-1];return S.isFaceUp&&S.protocol==="Chaos"&&S.value===3}),x=[...c.lanes.flat(),...o.lanes.flat()].some(C=>C.isFaceUp&&C.protocol==="Anarchy"&&C.value===1);for(let C=0;C<3;C++){if(i(C)||r(C))continue;let S;if(x?S=p.protocol!==o.protocols[C]&&p.protocol!==c.protocols[C]:S=p.protocol===o.protocols[C]||p.protocol===c.protocols[C]||v||w,S)return{cardId:p.id,laneIndex:C,isFaceUp:!0}}}const _=[0,1,2].filter(v=>n.player.lanes[v].some(x=>x.isFaceUp&&x.protocol==="Metal"&&x.value===2)?!1:!i(v)&&!r(v));if(_.length===0)return null;const m=_[Math.floor(Math.random()*_.length)];return{cardId:p.id,laneIndex:m,isFaceUp:!1}},R0=(n,o)=>{switch(o.type){case"prompt_use_control_mechanic":{const{player:r}=n,l=r.compiled.some(f=>f),s=r.compiled.filter(f=>!f).length;return l&&s>0?{type:"resolveControlMechanicPrompt",choice:"player"}:{type:"resolveControlMechanicPrompt",choice:"skip"}}case"discard":return{type:"discardCards",cardIds:[...n.opponent.hand].sort((r,l)=>r.value-l.value).slice(0,o.count).map(r=>r.id)};case"select_opponent_card_to_flip":{const l=(p=>n[p].lanes.map(h=>h.length>0?h[h.length-1]:null).filter(h=>h!==null))("player");if(l.length===0)return{type:"skip"};const s=l.filter(p=>!p.isFaceUp);return s.length>0?{type:"flipCard",cardId:s[0].id}:{type:"flipCard",cardId:l.filter(p=>p.isFaceUp).sort((p,h)=>h.value-p.value)[0].id}}case"select_card_to_delete_for_anarchy_2":{const r=(f,p,h)=>{const _=n[p].protocols[h];return f.protocol===_},l=[];if(n.player.lanes.forEach((f,p)=>{f.forEach(h=>{h.isFaceUp&&r(h,"player",p)&&l.push(h)})}),l.length>0)return{type:"deleteCard",cardId:l[0].id};const s=[];return n.opponent.lanes.forEach((f,p)=>{f.forEach(h=>{h.isFaceUp&&r(h,"opponent",p)&&s.push(h)})}),s.length>0?{type:"deleteCard",cardId:s[0].id}:{type:"skip"}}case"select_cards_to_delete":case"select_face_down_card_to_delete":case"select_card_to_delete_for_death_1":case"plague_4_opponent_delete":{const r="disallowedIds"in o&&o.disallowedIds?o.disallowedIds:[],l=p=>n[p].lanes.map(h=>h.length>0?h[h.length-1]:null).filter(h=>h!==null),s=l("player").filter(p=>!r.includes(p.id));if(s.length>0)return{type:"deleteCard",cardId:s[0].id};const f=l("opponent").filter(p=>!r.includes(p.id));return f.length>0?{type:"deleteCard",cardId:f[0].id}:{type:"skip"}}case"select_card_from_other_lanes_to_delete":{const{disallowedLaneIndex:r,lanesSelected:l}=o,s=[];for(let f=0;f<3;f++){if(f===r||l.includes(f))continue;const p=n.player.lanes[f];if(p.length>0){s.push(p[p.length-1]);continue}const h=n.opponent.lanes[f];h.length>0&&s.push(h[h.length-1])}return s.length>0?{type:"deleteCard",cardId:s[0].id}:{type:"skip"}}case"select_low_value_card_to_delete":{const r=[];for(const s of["player","opponent"])for(const f of n[s].lanes)f.length>0&&r.push(f[f.length-1]);const l=r.filter(s=>s.isFaceUp&&(s.value===0||s.value===1));return l.length>0?{type:"deleteCard",cardId:l[0].id}:{type:"skip"}}case"select_own_highest_card_to_delete_for_hate_2":{const r=o.actor,l=[];if(n[r].lanes.forEach((p,h)=>{if(p.length>0){const _=p[p.length-1],m=_.isFaceUp?_.value:2;l.push({card:_,laneIndex:h,value:m})}}),l.length===0)return{type:"skip"};const s=Math.max(...l.map(p=>p.value));return{type:"deleteCard",cardId:l.filter(p=>p.value===s)[0].card.id}}case"select_opponent_highest_card_to_delete_for_hate_2":{const l=o.actor==="player"?"opponent":"player",s=[];if(n[l].lanes.forEach((h,_)=>{if(h.length>0){const m=h[h.length-1],v=m.isFaceUp?m.value:2;s.push({card:m,laneIndex:_,value:v})}}),s.length===0)return{type:"skip"};const f=Math.max(...s.map(h=>h.value));return{type:"deleteCard",cardId:s.filter(h=>h.value===f)[0].card.id}}case"select_own_face_up_covered_card_to_flip":return{type:"skip"};case"select_face_down_card_to_reveal_for_light_2":{const r=h=>n[h].lanes.map(_=>_.length>0?_[_.length-1]:null).filter(_=>_!==null),l=r("player"),s=r("opponent"),f=l.filter(h=>!h.isFaceUp);if(f.length>0)return{type:"deleteCard",cardId:f[0].id};const p=s.filter(h=>!h.isFaceUp);return p.length>0?{type:"deleteCard",cardId:p[0].id}:{type:"skip"}}case"select_opponent_face_up_card_to_flip":{const l=(s=>n[s].lanes.map(f=>f.length>0?f[f.length-1]:null).filter(f=>f!==null))("player").filter(s=>s.isFaceUp);return l.length>0?(l.sort((s,f)=>f.value-s.value),{type:"flipCard",cardId:l[0].id}):{type:"skip"}}case"select_any_other_card_to_flip":case"select_any_card_to_flip":case"select_any_card_to_flip_optional":case"select_card_to_flip_for_fire_3":case"select_card_to_flip_for_light_0":case"select_any_other_card_to_flip_for_water_0":case"select_any_face_down_card_to_flip_optional":case"select_covered_card_to_flip_for_chaos_0":case"select_covered_card_in_line_to_flip_optional":{const r=Vn(n),l="optional"in o&&o.optional,f=!["select_any_other_card_to_flip","select_any_other_card_to_flip_for_water_0"].includes(o.type),p=o.type==="select_any_face_down_card_to_flip_optional";if(o.type==="select_covered_card_to_flip_for_chaos_0"){const{laneIndex:v}=o,w=n.player.lanes[v].filter((C,S,E)=>S<E.length-1);if(w.length>0)return{type:"flipCard",cardId:w[0].id};const x=n.opponent.lanes[v].filter((C,S,E)=>S<E.length-1);return x.length>0?{type:"flipCard",cardId:x[0].id}:{type:"skip"}}if(o.type==="select_covered_card_in_line_to_flip_optional"){const{laneIndex:v}=o,w=n.player.lanes[v].filter((C,S,E)=>S<E.length-1);if(w.length>0)return{type:"flipCard",cardId:w[0].id};const x=n.opponent.lanes[v].filter((C,S,E)=>S<E.length-1);return x.length>0?{type:"flipCard",cardId:x[0].id}:{type:"skip"}}const h=v=>n[v].lanes.map(w=>w.length>0?w[w.length-1]:null).filter(w=>w!==null),_=h("player"),m=h("opponent");if(!p){const v=_.filter(w=>w.isFaceUp).sort((w,x)=>x.value-w.value);if(v.length>0)return{type:"flipCard",cardId:v[0].id}}if(!r){const v=m.filter(w=>!w.isFaceUp);if(v.length>0)return{type:"flipCard",cardId:v[0].id}}if(!r){const v=_.filter(w=>!w.isFaceUp);if(v.length>0)return{type:"flipCard",cardId:v[0].id}}if(!p){const v=m.filter(x=>!(!x.isFaceUp||!f&&x.id===o.sourceCardId)),w=v.filter(x=>{const C=n.opponent.lanes.findIndex(S=>S.length>0&&S[S.length-1].id===x.id);return C!==-1&&n.opponent.compiled[C]});if(w.length>0&&!l)return{type:"flipCard",cardId:w[0].id};if(v.length>0&&!l)return{type:"flipCard",cardId:v[0].id}}return{type:"skip"}}case"select_card_to_return":case"select_opponent_card_to_return":{const r=[];return n.player.lanes.forEach(l=>{l.length>0&&r.push(l[l.length-1])}),n.opponent.lanes.forEach(l=>{l.length>0&&r.push(l[l.length-1])}),r.length>0?{type:"returnCard",cardId:r[0].id}:"optional"in o&&o.optional?{type:"skip"}:{type:"skip"}}case"select_own_card_to_return_for_water_4":{const r=[];return n.opponent.lanes.forEach(l=>{l.length>0&&r.push(l[l.length-1])}),r.length>0?{type:"returnCard",cardId:r[Math.floor(Math.random()*r.length)].id}:"optional"in o&&o.optional?{type:"skip"}:{type:"skip"}}case"select_card_to_shift_for_anarchy_0":{const r=[...n.player.lanes.flat(),...n.opponent.lanes.flat()];return r.length>0?{type:"shiftCard",cardId:r[Math.floor(Math.random()*r.length)].id}:{type:"skip"}}case"select_card_to_shift_for_anarchy_1":{const{sourceCardId:r}=o,l=[...n.player.lanes.flat(),...n.opponent.lanes.flat()].filter(s=>s.id!==r);return l.length>0?{type:"shiftCard",cardId:l[Math.floor(Math.random()*l.length)].id}:{type:"skip"}}case"select_card_to_shift_for_gravity_1":{const r=[...n.player.lanes.flat(),...n.opponent.lanes.flat()];return r.length>0?{type:"shiftCard",cardId:r[Math.floor(Math.random()*r.length)].id}:{type:"skip"}}case"select_card_to_flip_and_shift_for_gravity_2":{const r=f=>n[f].lanes.map(p=>p.length>0?p[p.length-1]:null).filter(p=>p!==null),l=r("player");if(l.length>0)return{type:"deleteCard",cardId:l[Math.floor(Math.random()*l.length)].id};const s=r("opponent");return s.length>0?{type:"deleteCard",cardId:s[Math.floor(Math.random()*s.length)].id}:{type:"skip"}}case"select_face_down_card_to_shift_for_gravity_4":{const{targetLaneIndex:r}=o,l=[];for(const s of["player","opponent"])for(let f=0;f<n[s].lanes.length;f++)if(f!==r)for(const p of n[s].lanes[f])p.isFaceUp||l.push(p);return l.length>0?{type:"deleteCard",cardId:l[Math.floor(Math.random()*l.length)].id}:{type:"skip"}}case"select_face_down_card_to_shift_for_darkness_4":{const r=[];for(const l of["player","opponent"])for(const s of n[l].lanes)if(s.length>0){const f=s[s.length-1];f.isFaceUp||r.push(f)}return r.length>0?{type:"deleteCard",cardId:r[Math.floor(Math.random()*r.length)].id}:{type:"skip"}}case"shift_flipped_card_optional":{const r=he(n,o.cardId);if(!r)return{type:"skip"};let l=-1;const s=n[r.owner];for(let p=0;p<s.lanes.length;p++)if(s.lanes[p].some(h=>h.id===o.cardId)){l=p;break}if(l===-1)return{type:"skip"};const f=[0,1,2].filter(p=>p!==l);return f.length>0?{type:"selectLane",laneIndex:f[Math.floor(Math.random()*f.length)]}:{type:"skip"}}case"select_lane_for_play":{let r=[0,1,2];"disallowedLaneIndex"in o&&o.disallowedLaneIndex!==void 0&&(r=r.filter(s=>s!==o.disallowedLaneIndex));const l="player";return r=r.filter(s=>{const f=n[l].lanes[s],p=f.length>0?f[f.length-1]:null,h=p&&p.isFaceUp&&p.protocol==="Plague"&&p.value===0,_=o.isFaceDown&&f.some(m=>m.isFaceUp&&m.protocol==="Metal"&&m.value===2);return!h&&!_}),r.length>0?{type:"selectLane",laneIndex:r[Math.floor(Math.random()*r.length)]}:{type:"skip"}}case"select_lane_for_shift":{let r=[0,1,2];if("disallowedLaneIndex"in o&&o.disallowedLaneIndex!==void 0&&(r=r.filter(l=>l!==o.disallowedLaneIndex)),"originalLaneIndex"in o&&o.originalLaneIndex!==void 0&&(r=r.filter(l=>l!==o.originalLaneIndex)),"sourceCardId"in o){const l=[...n.player.lanes.flat(),...n.opponent.lanes.flat()].find(s=>s.id===o.sourceCardId);if(l&&l.protocol==="Gravity"&&l.value===1){let s=null;for(let f=0;f<3;f++)if([...n.player.lanes[f],...n.opponent.lanes[f]].some(h=>h.id===o.sourceCardId)){s=f;break}s!==null&&"originalLaneIndex"in o&&(o.originalLaneIndex===s||(r=[s]))}if(l&&l.protocol==="Anarchy"&&l.value===1){const s="cardToShiftId"in o?o.cardToShiftId:null;if(s){const f=[...n.player.lanes.flat(),...n.opponent.lanes.flat()].find(p=>p.id===s);f&&(r=r.filter(p=>{const h=n.player.protocols[p],_=n.opponent.protocols[p],m=f.protocol;return m!==h&&m!==_}))}}}return r.length>0?{type:"selectLane",laneIndex:r[Math.floor(Math.random()*r.length)]}:{type:"selectLane",laneIndex:0}}case"select_lane_for_death_2":case"select_lane_for_life_3_play":case"select_lane_to_shift_revealed_card_for_light_2":case"select_lane_to_shift_cards_for_light_3":{let r=[0,1,2];return"disallowedLaneIndex"in o&&o.disallowedLaneIndex!==void 0&&(r=r.filter(l=>l!==o.disallowedLaneIndex)),"originalLaneIndex"in o&&o.originalLaneIndex!==void 0&&(r=r.filter(l=>l!==o.originalLaneIndex)),r.length>0?{type:"selectLane",laneIndex:r[Math.floor(Math.random()*r.length)]}:"optional"in o&&o.optional?{type:"skip"}:{type:"skip"}}case"select_lane_for_metal_3_delete":{let r=[0,1,2];return"disallowedLaneIndex"in o&&o.disallowedLaneIndex!==void 0&&(r=r.filter(l=>l!==o.disallowedLaneIndex)),r=r.filter(l=>n.player.lanes[l].length+n.opponent.lanes[l].length>=8),r.length>0?{type:"selectLane",laneIndex:r[Math.floor(Math.random()*r.length)]}:{type:"skip"}}case"select_lane_for_water_3":{const l=(s=>{const f=[];for(let p=0;p<3;p++){let h=!1;for(const _ of["player","opponent"]){const m=s[_].lanes[p],w=m.some(x=>x.isFaceUp&&x.protocol==="Darkness"&&x.value===2)?4:2;for(const x of m)if((x.isFaceUp?x.value:w)===2){h=!0;break}if(h)break}h&&f.push(p)}return f})(n);return l.length>0?{type:"selectLane",laneIndex:l[Math.floor(Math.random()*l.length)]}:{type:"selectLane",laneIndex:0}}case"prompt_death_1_effect":return{type:"resolveDeath1Prompt",accept:Math.random()>.7};case"prompt_give_card_for_love_1":return{type:"resolveLove1Prompt",accept:!1};case"plague_4_player_flip_optional":return{type:"resolvePlague4Flip",accept:!1};case"prompt_fire_3_discard":return{type:"resolveFire3Prompt",accept:!1};case"prompt_shift_for_speed_3":return{type:"resolveSpeed3Prompt",accept:!1};case"prompt_shift_for_spirit_3":return{type:"resolveSpirit3Prompt",accept:!1};case"prompt_return_for_psychic_4":return{type:"resolvePsychic4Prompt",accept:!1};case"prompt_spirit_1_start":return{type:"resolveSpirit1Prompt",choice:"flip"};case"prompt_shift_or_flip_for_light_2":{const{revealedCardId:r}=o,l=he(n,r);return l?l.owner==="opponent"?{type:"resolveLight2Prompt",choice:"flip"}:{type:"resolveLight2Prompt",choice:"skip"}:{type:"skip"}}case"plague_2_opponent_discard":return n.opponent.hand.length>0?{type:"resolvePlague2Discard",cardIds:[n.opponent.hand[0].id]}:{type:"skip"};case"select_cards_from_hand_to_discard_for_fire_4":{const r=Math.min(3,n.opponent.hand.length);return r===0?{type:"skip"}:{type:"resolveFire4Discard",cardIds:n.opponent.hand.slice(0,r).map(s=>s.id)}}case"select_cards_from_hand_to_discard_for_hate_1":return n.opponent.hand.length>0?{type:"resolveHate1Discard",cardIds:n.opponent.hand.slice(0,o.count).map(r=>r.id)}:{type:"skip"};case"select_card_from_hand_to_play":if(n.opponent.hand.length>0){const r=n.opponent.hand[0];let l=[0,1,2].filter(s=>s!==o.disallowedLaneIndex);if(l=l.filter(s=>{const f=n.player.lanes[s],p=f.length>0?f[f.length-1]:null,h=p&&p.isFaceUp&&p.protocol==="Plague"&&p.value===0,_=o.isFaceDown&&f.some(m=>m.isFaceUp&&m.protocol==="Metal"&&m.value===2);return!h&&!_}),l.length>0)return{type:"playCard",cardId:r.id,laneIndex:l[0],isFaceUp:!1}}return{type:"skip"};case"select_card_from_hand_to_give":return n.opponent.hand.length>0?{type:"giveCard",cardId:n.opponent.hand[0].id}:{type:"skip"};case"select_card_from_hand_to_reveal":return n.opponent.hand.length>0?{type:"revealCard",cardId:n.opponent.hand[0].id}:{type:"skip"};case"prompt_rearrange_protocols":return fd(n,o);case"prompt_swap_protocols":{const r=Math.floor(Math.random()*3);let l=Math.floor(Math.random()*3);for(;r===l;)l=Math.floor(Math.random()*3);return{type:"resolveSwapProtocols",indices:[r,l]}}case"select_opponent_face_down_card_to_shift":{const r=[];for(const l of n.player.lanes)if(l.length>0){const s=l[l.length-1];s.isFaceUp||r.push(s)}return r.length>0?{type:"deleteCard",cardId:r[Math.floor(Math.random()*r.length)].id}:{type:"skip"}}case"select_own_other_card_to_shift":{const r=n.opponent.lanes.flat().find(l=>l.id!==o.sourceCardId);return r?{type:"deleteCard",cardId:r.id}:{type:"skip"}}case"select_own_card_to_shift_for_speed_3":return{type:"deleteCard",cardId:n.opponent.lanes.flat()[0].id};case"select_opponent_covered_card_to_shift":{const r=[];for(const l of n.player.lanes)for(let s=0;s<l.length-1;s++)r.push(l[s]);return r.length>0?{type:"deleteCard",cardId:r[Math.floor(Math.random()*r.length)].id}:{type:"skip"}}case"select_own_covered_card_to_shift":{const r=[];for(const l of n.opponent.lanes)for(let s=0;s<l.length-1;s++)r.push(l[s]);return r.length>0?{type:"deleteCard",cardId:r[Math.floor(Math.random()*r.length)].id}:{type:"skip"}}case"select_any_opponent_card_to_shift":{const r=n.player.lanes.map(l=>l.length>0?l[l.length-1]:null).filter(l=>l!==null);return r.length>0?{type:"deleteCard",cardId:r[Math.floor(Math.random()*r.length)].id}:{type:"skip"}}case"flip_self_for_water_0":return o.sourceCardId?{type:"flipCard",cardId:o.sourceCardId}:{type:"skip"};case"plague_2_player_discard":return{type:"skip"};case"reveal_opponent_hand":return{type:"skip"}}return{type:"skip"}},A0=(n,o)=>{if(o)return R0(n,o);if(n.phase==="compile"&&n.compilableLanes.length>0)return{type:"compile",laneIndex:n.compilableLanes[0]};if(n.phase==="action"){const c=j0(n);return c?{type:"playCard",...c}:{type:"fillHand"}}return{type:"fillHand"}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * NORMAL AI - Plays like a human player
 * - Makes good strategic decisions
 * - No memory of revealed cards
 * - 20% chance to make suboptimal moves for realism
 * - Balanced between Easy and Hard
 */const Kr=["delete","flip","shift","return","discard"],pt=n=>{let o=12-n.value;return Kr.some(c=>n.keywords[c])&&(o+=6),n.keywords.draw&&(o+=3),n.keywords.play&&(o+=8),n.keywords.prevent&&(o+=4),o},gc=(n,o,c)=>{let i;for(const l of c[o].lanes)if(l.some(s=>s.id===n.id)){i=l;break}if(!i)return 0;if(!n.isFaceUp)return i.some(s=>s.isFaceUp&&s.protocol==="Darkness"&&s.value===2)?4:2;let r=n.value*2.5;return n.top.length>0&&(r+=6),(n.bottom.includes("Start:")||n.bottom.includes("End:"))&&(r+=8),n.bottom.includes("covered:")&&(r+=5),Kr.some(l=>n.keywords[l])&&(r+=4),r},Gr=()=>Math.random()<.2,nd=n=>n+(Math.random()*10-5),k0=n=>{const o=[],c=r=>{const l=n.player.lanes[r];if(l.length===0)return!1;const s=l[l.length-1];return s.isFaceUp&&s.protocol==="Plague"&&s.value===0},i=n.player.lanes.flat().some(r=>r.isFaceUp&&r.protocol==="Psychic"&&r.value===1);for(const r of n.opponent.hand)for(let l=0;l<3;l++){if(c(l))continue;if(r.protocol==="Water"&&r.value===4){let x=!1;for(let C=0;C<3;C++)if(C!==l&&n.opponent.lanes[C].length>0){x=!0;break}if(!x)continue}if(n.opponent.compiled[l])continue;if(r.protocol==="Metal"&&r.value===6){const C=n.opponent.laneValues[l]+6;if(C<10)continue;const S=n.player.laneValues[l];if(C<=S)continue}const s=n.player.laneValues[l]>=10&&n.player.laneValues[l]>n.opponent.laneValues[l]&&!n.player.compiled[l],f=pt(r);let p=!1;if(r.protocol==="Hate"&&r.value===2){let x=0;for(let C=0;C<3;C++){const S=n.opponent.lanes[C];if(S.length>0&&C!==l){const E=S[S.length-1],j=E.isFaceUp?E.value:2;j>x&&(x=j)}}2>=x&&(p=!0)}const h=n.opponent.lanes.flat().some(x=>x.isFaceUp&&x.protocol==="Spirit"&&x.value===1),_=n.opponent.lanes.some(x=>{if(x.length===0)return!1;const C=x[x.length-1];return C.isFaceUp&&C.protocol==="Chaos"&&C.value===3}),m=[...n.player.lanes.flat(),...n.opponent.lanes.flat()].some(x=>x.isFaceUp&&x.protocol==="Anarchy"&&x.value===1);let v;if(m?v=r.protocol!==n.opponent.protocols[l]&&r.protocol!==n.player.protocols[l]&&!i&&!p:v=(r.protocol===n.opponent.protocols[l]||r.protocol===n.player.protocols[l]||h||_)&&!i&&!p,v){let x=0,C=`Play ${r.protocol}-${r.value} face-up in lane ${l}`;const S=r.value,E=n.opponent.laneValues[l]+S;s?E>n.player.laneValues[l]?(x=180+E*5,C+=" [Blocks compile!]"):(x=-150,C+=" [Fails to block]"):(x+=f,x+=S*1.5,E>=10&&E>n.player.laneValues[l]&&!n.opponent.compiled[l]?(x+=120,C+=" [Compile setup]"):E>=8&&!n.opponent.compiled[l]&&(x+=40,C+=" [Near compile]"),Kr.some(D=>r.keywords[D])&&n.player.laneValues[l]>=6&&(x+=30,C+=" [Disruption]")),o.push({move:{type:"playCard",cardId:r.id,laneIndex:l,isFaceUp:!0},score:nd(x),reason:C})}if(!n.player.lanes[l].some(x=>x.isFaceUp&&x.protocol==="Metal"&&x.value===2)){const x=mt({...r,isFaceUp:!1},n.opponent.lanes[l]),C=n.opponent.laneValues[l]+x;let S=0,E=`Play ${r.protocol}-${r.value} face-down in lane ${l}`;s?C>n.player.laneValues[l]?(S=170+C*5,E+=" [Blocks compile]"):(S=-140,E+=" [Fails to block]"):(S+=x*2,r.protocol==="Hate"&&r.value===2&&(S+=25,E+=" [Hate-2 effect bonus]"),C>=10&&C>n.player.laneValues[l]&&!n.opponent.compiled[l]&&(S+=110,E+=" [Compile setup]")),o.push({move:{type:"playCard",cardId:r.id,laneIndex:l,isFaceUp:!1},score:nd(S),reason:E})}}if(n.opponent.hand.length<5){let r=8;const l=n.opponent.hand.reduce((s,f)=>s+pt(f),0)/(n.opponent.hand.length||1);n.opponent.hand.length===0?r=500:l<12&&(r=35),o.push({move:{type:"fillHand"},score:nd(r),reason:"Refill hand"})}return o.length===0?{type:"fillHand"}:(o.sort((r,l)=>l.score-r.score),Gr()&&o.length>1&&o[1].score>0?o[1].move:o[0].move)},D0=(n,o)=>{switch(o.type){case"prompt_use_control_mechanic":return Vh(n)?{type:"resolveControlMechanicPrompt",choice:"player"}:Bh(n)&&!Gr()?{type:"resolveControlMechanicPrompt",choice:"opponent"}:{type:"resolveControlMechanicPrompt",choice:"skip"};case"discard":return{type:"discardCards",cardIds:[...n.opponent.hand].sort((i,r)=>{const l=Kr.some(f=>i.keywords[f]),s=Kr.some(f=>r.keywords[f]);return l&&!s?1:!l&&s?-1:pt(i)-pt(r)}).slice(0,o.count).map(i=>i.id)};case"select_opponent_card_to_flip":{const i=(l=>n[l].lanes.map(s=>s.length>0?s[s.length-1]:null).filter(s=>s!==null))("player");if(i.length===0)return{type:"skip"};const r=i.map(l=>({cardId:l.id,score:l.isFaceUp?l.value+5:3}));return r.sort((l,s)=>s.score-l.score),{type:"flipCard",cardId:r[0].cardId}}case"select_card_to_delete_for_anarchy_2":{const c=(l,s,f)=>{const p=n[s].protocols[f];return l.protocol===p},i=[];if(n.player.lanes.forEach((l,s)=>{l.forEach(f=>{f.isFaceUp&&c(f,"player",s)&&i.push(f)})}),i.length>0)return{type:"deleteCard",cardId:i.sort((s,f)=>f.value-s.value)[0].id};const r=[];return n.opponent.lanes.forEach((l,s)=>{l.forEach(f=>{f.isFaceUp&&c(f,"opponent",s)&&r.push(f)})}),r.length>0?{type:"deleteCard",cardId:r.sort((s,f)=>s.value-f.value)[0].id}:{type:"skip"}}case"select_cards_to_delete":case"select_card_to_delete_for_death_1":{const c=o.type==="select_cards_to_delete"?o.disallowedIds:[o.sourceCardId],i=s=>n[s].lanes.map(f=>f.length>0?f[f.length-1]:null).filter(f=>f!==null),r=i("player").filter(s=>!c.includes(s.id));if(r.length>0){const s=r.map(f=>{const p=n.player.lanes.findIndex(m=>m.some(v=>v.id===f.id)),h=n.player.laneValues[p],_=h>=10&&h>n.opponent.laneValues[p];return{cardId:f.id,score:gc(f,"player",n)+h+(_?50:0)}});return s.sort((f,p)=>p.score-f.score),{type:"deleteCard",cardId:s[0].cardId}}const l=i("opponent").filter(s=>!c.includes(s.id));return l.length>0?{type:"deleteCard",cardId:l.sort((f,p)=>f.value-p.value)[0].id}:{type:"skip"}}case"select_any_card_to_flip":case"select_any_other_card_to_flip":case"select_any_face_down_card_to_flip_optional":case"select_any_card_to_flip_optional":{const c=Vn(n),i=f=>n[f].lanes.map(p=>p.length>0?p[p.length-1]:null).filter(p=>p!==null),r=i("player"),l=i("opponent"),s=[];return r.forEach(f=>{f.isFaceUp?s.push({cardId:f.id,score:gc(f,"player",n)+10}):c||s.push({cardId:f.id,score:3})}),c||l.forEach(f=>{f.isFaceUp||s.push({cardId:f.id,score:f.value+8})}),s.length===0?{type:"skip"}:(s.sort((f,p)=>p.score-f.score),{type:"flipCard",cardId:s[0].cardId})}case"plague_2_opponent_discard":return n.opponent.hand.length===0?{type:"skip"}:{type:"resolvePlague2Discard",cardIds:[[...n.opponent.hand].sort((i,r)=>pt(i)-pt(r))[0].id]};case"select_cards_from_hand_to_discard_for_fire_4":{const c=Math.min(3,n.opponent.hand.length);return c===0?{type:"skip"}:{type:"resolveFire4Discard",cardIds:[...n.opponent.hand].sort((l,s)=>pt(l)-pt(s)).slice(0,c).map(l=>l.id)}}case"select_cards_from_hand_to_discard_for_hate_1":{const c=Math.min(o.count,n.opponent.hand.length);return c===0?{type:"skip"}:{type:"resolveHate1Discard",cardIds:[...n.opponent.hand].sort((l,s)=>pt(l)-pt(s)).slice(0,c).map(l=>l.id)}}case"select_card_from_hand_to_play":{if(n.opponent.hand.length===0)return{type:"skip"};const c=o.isFaceDown===!0;let i=[0,1,2].filter(s=>s!==o.disallowedLaneIndex);if(i=i.filter(s=>{const f=n.player.lanes[s],p=f.length>0?f[f.length-1]:null;return!(p&&p.isFaceUp&&p.protocol==="Plague"&&p.value===0)}),i.length===0)return{type:"skip"};const r=[];for(const s of n.opponent.hand)for(const f of i){if(!c){const _=n.opponent.lanes.flat().some(x=>x.isFaceUp&&x.protocol==="Spirit"&&x.value===1),m=n.opponent.lanes.some(x=>{if(x.length===0)return!1;const C=x[x.length-1];return C.isFaceUp&&C.protocol==="Chaos"&&C.value===3}),v=[...n.player.lanes.flat(),...n.opponent.lanes.flat()].some(x=>x.isFaceUp&&x.protocol==="Anarchy"&&x.value===1);let w;if(v?w=s.protocol!==n.opponent.protocols[f]&&s.protocol!==n.player.protocols[f]:w=s.protocol===n.opponent.protocols[f]||s.protocol===n.player.protocols[f]||_||m,w){const x=s.value,C=n.opponent.laneValues[f]+x;let S=pt(s)+x*2;C>=10&&C>n.player.laneValues[f]&&(S+=100),r.push({cardId:s.id,laneIndex:f,isFaceUp:!0,score:S})}}if(!n.player.lanes[f].some(_=>_.isFaceUp&&_.protocol==="Metal"&&_.value===2)){const _=mt({...s,isFaceUp:!1},n.opponent.lanes[f]),m=n.opponent.laneValues[f]+_;let v=_*2;m>=10&&m>n.player.laneValues[f]&&(v+=80),r.push({cardId:s.id,laneIndex:f,isFaceUp:!1,score:v})}}if(r.length===0)return{type:"skip"};r.sort((s,f)=>f.score-s.score);const l=r[0];return{type:"playCard",cardId:l.cardId,laneIndex:l.laneIndex,isFaceUp:l.isFaceUp}}case"select_card_from_hand_to_give":return n.opponent.hand.length===0?{type:"skip"}:{type:"giveCard",cardId:[...n.opponent.hand].sort((i,r)=>pt(i)-pt(r))[0].id};case"select_card_from_hand_to_reveal":return n.opponent.hand.length===0?{type:"skip"}:{type:"revealCard",cardId:[...n.opponent.hand].sort((i,r)=>pt(r)-pt(i))[0].id};case"select_lane_for_death_2":{const c=[0,1,2].map(i=>{let r=0,l=0;return n.player.lanes[i].forEach(s=>{s.isFaceUp&&(s.value===1||s.value===2)&&r++}),n.opponent.lanes[i].forEach(s=>{s.isFaceUp&&(s.value===1||s.value===2)&&l++}),{laneIndex:i,score:r*10-l*5}});return c.sort((i,r)=>r.score-i.score),{type:"selectLane",laneIndex:c[0].laneIndex}}case"select_card_to_return":case"select_opponent_card_to_return":{const c=[];if(n.player.lanes.forEach(r=>{r.length>0&&c.push(r[r.length-1])}),c.length>0)return c.sort((r,l)=>gc(l,"player",n)-gc(r,"player",n)),{type:"returnCard",cardId:c[0].id};const i=[];return n.opponent.lanes.forEach(r=>{r.length>0&&i.push(r[r.length-1])}),i.length>0?(i.sort((r,l)=>r.value-l.value),{type:"returnCard",cardId:i[0].id}):{type:"skip"}}case"select_lane_for_play":case"select_lane_for_life_3_play":{let c=[0,1,2].filter(r=>!("disallowedLaneIndex"in o)||r!==o.disallowedLaneIndex);if(c=c.filter(r=>{const l=n.player.lanes[r],s=l.length>0?l[l.length-1]:null,f=s&&s.isFaceUp&&s.protocol==="Plague"&&s.value===0,p="isFaceDown"in o&&o.isFaceDown&&l.some(h=>h.isFaceUp&&h.protocol==="Metal"&&h.value===2);return!f&&!p}),c.length===0)return{type:"skip"};const i=c.map(r=>{const l=n.opponent.laneValues[r]-n.player.laneValues[r];return{laneIndex:r,score:-l}});return i.sort((r,l)=>l.score-r.score),{type:"selectLane",laneIndex:i[0].laneIndex}}case"prompt_rearrange_protocols":return fd(n,o);case"prompt_swap_protocols":{const{target:c}=o,i=n[c].protocols,r=n[c].hand,l=[[0,1],[0,2],[1,2]];let s=[0,1],f=-1/0;for(const p of l){const[h,_]=p,m=[...i];[m[h],m[_]]=[m[_],m[h]];let v=0;if(c==="opponent")for(const w of r){const x=w.protocol===i[h],C=w.protocol===i[_],S=w.protocol===m[h],E=w.protocol===m[_];S&&!x&&(v+=pt(w)),E&&!C&&(v+=pt(w)),!S&&x&&(v-=pt(w)),!E&&C&&(v-=pt(w))}else for(const w of r){const x=w.protocol===i[h],C=w.protocol===i[_],S=w.protocol===m[h],E=w.protocol===m[_];S&&!x&&(v-=pt(w)),E&&!C&&(v-=pt(w)),!S&&x&&(v+=pt(w)),!E&&C&&(v+=pt(w))}v>f&&(f=v,s=p)}return{type:"resolveSwapProtocols",indices:s}}case"select_lane_for_shift":{let c=[0,1,2].filter(i=>!("disallowedLaneIndex"in o)||i!==o.disallowedLaneIndex).filter(i=>!("originalLaneIndex"in o)||i!==o.originalLaneIndex);if("sourceCardId"in o){const i=[...n.player.lanes.flat(),...n.opponent.lanes.flat()].find(r=>r.id===o.sourceCardId);if(i&&i.protocol==="Gravity"&&i.value===1){let r=null;for(let l=0;l<3;l++)if([...n.player.lanes[l],...n.opponent.lanes[l]].some(f=>f.id===o.sourceCardId)){r=l;break}r!==null&&"originalLaneIndex"in o&&(o.originalLaneIndex===r||(c=[r]))}if(i&&i.protocol==="Anarchy"&&i.value===1){const r="cardToShiftId"in o?o.cardToShiftId:null;if(r){const l=[...n.player.lanes.flat(),...n.opponent.lanes.flat()].find(s=>s.id===r);l&&(c=c.filter(s=>{const f=n.player.protocols[s],p=n.opponent.protocols[s],h=l.protocol;return h!==f&&h!==p}))}}}return c.length>0?{type:"selectLane",laneIndex:c[Math.floor(Math.random()*c.length)]}:{type:"selectLane",laneIndex:0}}case"select_lane_for_water_3":case"select_lane_to_shift_cards_for_light_3":{const c=[0,1,2].filter(i=>!("disallowedLaneIndex"in o)||i!==o.disallowedLaneIndex).filter(i=>!("originalLaneIndex"in o)||i!==o.originalLaneIndex);return c.length>0?{type:"selectLane",laneIndex:c[Math.floor(Math.random()*c.length)]}:{type:"selectLane",laneIndex:0}}case"select_lane_for_metal_3_delete":{const c=[0,1,2].filter(i=>!("disallowedLaneIndex"in o)||i!==o.disallowedLaneIndex).filter(i=>!("originalLaneIndex"in o)||i!==o.originalLaneIndex).filter(i=>n.player.lanes[i].length+n.opponent.lanes[i].length>=8);return c.length>0?{type:"selectLane",laneIndex:c[Math.floor(Math.random()*c.length)]}:{type:"skip"}}case"prompt_death_1_effect":return{type:"resolveDeath1Prompt",accept:!Gr()};case"prompt_give_card_for_love_1":return{type:"resolveLove1Prompt",accept:!1};case"plague_4_player_flip_optional":return{type:"resolvePlague4Flip",accept:!1};case"prompt_fire_3_discard":return{type:"resolveFire3Prompt",accept:n.opponent.hand.length>2};case"prompt_shift_for_speed_3":return{type:"resolveSpeed3Prompt",accept:!Gr()};case"prompt_shift_for_spirit_3":return{type:"resolveSpirit3Prompt",accept:!Gr()};case"prompt_return_for_psychic_4":return{type:"resolvePsychic4Prompt",accept:!0};case"prompt_spirit_1_start":return{type:"resolveSpirit1Prompt",choice:"flip"};case"select_card_from_other_lanes_to_delete":{const{disallowedLaneIndex:c,lanesSelected:i}=o,r=[];for(let l=0;l<3;l++){if(l===c||i.includes(l))continue;const s=n.player.lanes[l];if(s.length>0){r.push(s[s.length-1]);continue}const f=n.opponent.lanes[l];f.length>0&&r.push(f[f.length-1])}return r.length>0?{type:"deleteCard",cardId:r[0].id}:{type:"skip"}}case"select_face_down_card_to_delete":{const c="disallowedIds"in o&&Array.isArray(o.disallowedIds)?o.disallowedIds:[],i=s=>n[s].lanes.map(f=>f.length>0?f[f.length-1]:null).filter(f=>f!==null),r=i("player").filter(s=>!c.includes(s.id));if(r.length>0)return{type:"deleteCard",cardId:r[0].id};const l=i("opponent").filter(s=>!c.includes(s.id));return l.length>0?{type:"deleteCard",cardId:l[0].id}:{type:"skip"}}case"select_low_value_card_to_delete":{const c=[];for(const r of["player","opponent"])for(const l of n[r].lanes)l.length>0&&c.push(l[l.length-1]);const i=c.filter(r=>r.isFaceUp&&(r.value===0||r.value===1));return i.length>0?{type:"deleteCard",cardId:i[0].id}:{type:"skip"}}case"select_own_highest_card_to_delete_for_hate_2":{const c=o.actor,i=[];if(n[c].lanes.forEach((s,f)=>{if(s.length>0){const p=s[s.length-1],h=p.isFaceUp?p.value:2;i.push({card:p,laneIndex:f,value:h})}}),i.length===0)return{type:"skip"};const r=Math.max(...i.map(s=>s.value));return{type:"deleteCard",cardId:i.filter(s=>s.value===r)[0].card.id}}case"select_opponent_highest_card_to_delete_for_hate_2":{const i=o.actor==="player"?"opponent":"player",r=[];if(n[i].lanes.forEach((f,p)=>{if(f.length>0){const h=f[f.length-1],_=h.isFaceUp?h.value:2;r.push({card:h,laneIndex:p,value:_})}}),r.length===0)return{type:"skip"};const l=Math.max(...r.map(f=>f.value));return{type:"deleteCard",cardId:r.filter(f=>f.value===l)[0].card.id}}case"select_opponent_face_up_card_to_flip":{const i=(r=>n[r].lanes.map(l=>l.length>0?l[l.length-1]:null).filter(l=>l!==null))("player").filter(r=>r.isFaceUp);return i.length>0?(i.sort((r,l)=>l.value-r.value),{type:"flipCard",cardId:i[0].id}):{type:"skip"}}case"select_face_down_card_to_reveal_for_light_2":{const c=f=>n[f].lanes.map(p=>p.length>0?p[p.length-1]:null).filter(p=>p!==null),i=c("player"),r=c("opponent"),l=i.filter(f=>!f.isFaceUp);if(l.length>0)return{type:"deleteCard",cardId:l[0].id};const s=r.filter(f=>!f.isFaceUp);return s.length>0?{type:"deleteCard",cardId:s[0].id}:{type:"skip"}}case"select_any_other_card_to_flip_for_water_0":case"select_card_to_flip_for_fire_3":case"select_card_to_flip_for_light_0":case"select_covered_card_to_flip_for_chaos_0":case"select_covered_card_in_line_to_flip_optional":{const c="optional"in o&&o.optional,r=!["select_any_other_card_to_flip","select_any_other_card_to_flip_for_water_0"].includes(o.type);if(o.type==="select_covered_card_to_flip_for_chaos_0"){const{laneIndex:_}=o,m=n.player.lanes[_].filter((w,x,C)=>x<C.length-1);if(m.length>0)return{type:"flipCard",cardId:m[0].id};const v=n.opponent.lanes[_].filter((w,x,C)=>x<C.length-1);return v.length>0?{type:"flipCard",cardId:v[0].id}:{type:"skip"}}if(o.type==="select_covered_card_in_line_to_flip_optional"){const{laneIndex:_}=o,m=n.player.lanes[_].filter((w,x,C)=>x<C.length-1);if(m.length>0)return{type:"flipCard",cardId:m[0].id};const v=n.opponent.lanes[_].filter((w,x,C)=>x<C.length-1);return v.length>0?{type:"flipCard",cardId:v[0].id}:{type:"skip"}}const l=_=>n[_].lanes.map(m=>m.length>0?m[m.length-1]:null).filter(m=>m!==null),s=l("player"),f=l("opponent");{const _=s.filter(m=>m.isFaceUp).sort((m,v)=>v.value-m.value);if(_.length>0)return{type:"flipCard",cardId:_[0].id}}const p=f.filter(_=>!_.isFaceUp);if(p.length>0)return{type:"flipCard",cardId:p[0].id};const h=s.filter(_=>!_.isFaceUp);if(h.length>0)return{type:"flipCard",cardId:h[0].id};{const _=f.filter(v=>!(!v.isFaceUp||!r&&v.id===o.sourceCardId)),m=_.filter(v=>{const w=n.opponent.lanes.findIndex(x=>x.length>0&&x[x.length-1].id===v.id);return w!==-1&&n.opponent.compiled[w]});if(m.length>0&&!c)return{type:"flipCard",cardId:m[0].id};if(_.length>0&&!c)return{type:"flipCard",cardId:_[0].id}}return{type:"skip"}}case"select_own_card_to_return_for_water_4":{const c=[];return n.opponent.lanes.forEach(i=>{i.length>0&&c.push(i[i.length-1])}),c.length>0?{type:"returnCard",cardId:c[Math.floor(Math.random()*c.length)].id}:"optional"in o&&o.optional?{type:"skip"}:{type:"skip"}}case"select_card_to_shift_for_anarchy_0":{const c=[...n.player.lanes.flat(),...n.opponent.lanes.flat()];return c.length>0?{type:"shiftCard",cardId:c[Math.floor(Math.random()*c.length)].id}:{type:"skip"}}case"select_card_to_shift_for_anarchy_1":{const{sourceCardId:c}=o,i=[...n.player.lanes.flat(),...n.opponent.lanes.flat()].filter(r=>r.id!==c);return i.length>0?{type:"shiftCard",cardId:i[Math.floor(Math.random()*i.length)].id}:{type:"skip"}}case"select_card_to_shift_for_gravity_1":{const c=[...n.player.lanes.flat(),...n.opponent.lanes.flat()];return c.length>0?{type:"shiftCard",cardId:c[Math.floor(Math.random()*c.length)].id}:{type:"skip"}}case"select_card_to_flip_and_shift_for_gravity_2":{const c=l=>n[l].lanes.map(s=>s.length>0?s[s.length-1]:null).filter(s=>s!==null),i=c("player");if(i.length>0)return{type:"deleteCard",cardId:i[Math.floor(Math.random()*i.length)].id};const r=c("opponent");return r.length>0?{type:"deleteCard",cardId:r[Math.floor(Math.random()*r.length)].id}:{type:"skip"}}case"select_face_down_card_to_shift_for_gravity_4":{const{targetLaneIndex:c}=o,i=[];for(const r of["player","opponent"])for(let l=0;l<n[r].lanes.length;l++)if(l!==c)for(const s of n[r].lanes[l])s.isFaceUp||i.push(s);return i.length>0?{type:"deleteCard",cardId:i[Math.floor(Math.random()*i.length)].id}:{type:"skip"}}case"select_face_down_card_to_shift_for_darkness_4":{const c=[];for(const i of["player","opponent"])for(const r of n[i].lanes)if(r.length>0){const l=r[r.length-1];l.isFaceUp||c.push(l)}return c.length>0?{type:"deleteCard",cardId:c[Math.floor(Math.random()*c.length)].id}:{type:"skip"}}case"shift_flipped_card_optional":{const c=he(n,o.cardId);if(!c)return{type:"skip"};let i=-1;const r=n[c.owner];for(let s=0;s<r.lanes.length;s++)if(r.lanes[s].some(f=>f.id===o.cardId)){i=s;break}if(i===-1)return{type:"skip"};const l=[0,1,2].filter(s=>s!==i);return l.length>0?{type:"selectLane",laneIndex:l[Math.floor(Math.random()*l.length)]}:{type:"skip"}}case"select_lane_to_shift_revealed_card_for_light_2":{let c=[0,1,2];return"disallowedLaneIndex"in o&&o.disallowedLaneIndex!==void 0&&(c=c.filter(i=>i!==o.disallowedLaneIndex)),"originalLaneIndex"in o&&o.originalLaneIndex!==void 0&&(c=c.filter(i=>i!==o.originalLaneIndex)),c.length>0?{type:"selectLane",laneIndex:c[Math.floor(Math.random()*c.length)]}:"optional"in o&&o.optional?{type:"skip"}:{type:"skip"}}case"select_opponent_face_down_card_to_shift":{const c=[];for(const i of n.player.lanes)if(i.length>0){const r=i[i.length-1];r.isFaceUp||c.push(r)}return c.length>0?{type:"deleteCard",cardId:c[Math.floor(Math.random()*c.length)].id}:{type:"skip"}}case"select_own_card_to_shift_for_speed_3":return{type:"deleteCard",cardId:n.opponent.lanes.flat()[0].id};case"select_opponent_covered_card_to_shift":{const c=[];for(const i of n.player.lanes)for(let r=0;r<i.length-1;r++)c.push(i[r]);return c.length>0?{type:"deleteCard",cardId:c[Math.floor(Math.random()*c.length)].id}:{type:"skip"}}case"select_own_covered_card_to_shift":{const c=[];for(const i of n.opponent.lanes)for(let r=0;r<i.length-1;r++)c.push(i[r]);return c.length>0?{type:"deleteCard",cardId:c[Math.floor(Math.random()*c.length)].id}:{type:"skip"}}case"select_card_to_shift":{const c=o.targetFilter||{},i=[];for(const r of["player","opponent"]){const l=r==="opponent";if(!(c.owner==="own"&&!l)&&!(c.owner==="opponent"&&l))for(const s of n[r].lanes)for(let f=0;f<s.length;f++){const p=s[f],h=f===s.length-1;c.position==="uncovered"&&!h||c.position==="covered"&&h||c.faceState==="face_up"&&!p.isFaceUp||c.faceState==="face_down"&&p.isFaceUp||c.excludeSelf&&p.id===o.sourceCardId||i.push(p)}}return i.length>0?{type:"deleteCard",cardId:i[Math.floor(Math.random()*i.length)].id}:{type:"skip"}}case"select_any_opponent_card_to_shift":{const c=n.player.lanes.map(i=>i.length>0?i[i.length-1]:null).filter(i=>i!==null);return c.length>0?{type:"deleteCard",cardId:c[Math.floor(Math.random()*c.length)].id}:{type:"skip"}}case"select_own_other_card_to_shift":{const c=n.opponent.lanes.flat().find(i=>i.id!==o.sourceCardId);return c?{type:"deleteCard",cardId:c.id}:{type:"skip"}}case"select_own_face_up_covered_card_to_flip":return{type:"skip"};case"prompt_shift_or_flip_for_light_2":{const{revealedCardId:c}=o,i=he(n,c);return i?i.owner==="opponent"?{type:"resolveLight2Prompt",choice:"flip"}:{type:"resolveLight2Prompt",choice:"skip"}:{type:"skip"}}case"plague_4_opponent_delete":{const c="disallowedIds"in o&&Array.isArray(o.disallowedIds)?o.disallowedIds:[],i=s=>n[s].lanes.map(f=>f.length>0?f[f.length-1]:null).filter(f=>f!==null),r=i("player").filter(s=>!c.includes(s.id));if(r.length>0)return{type:"deleteCard",cardId:r[0].id};const l=i("opponent").filter(s=>!c.includes(s.id));return l.length>0?{type:"deleteCard",cardId:l[0].id}:{type:"skip"}}case"flip_self_for_water_0":return o.sourceCardId?{type:"flipCard",cardId:o.sourceCardId}:{type:"skip"};case"reveal_opponent_hand":return{type:"skip"};default:{if("optional"in o&&o.optional)return{type:"skip"};const c=[...n.player.lanes.flat(),...n.opponent.lanes.flat()];return c.length>0&&(o.type.includes("select_")||o.type.includes("shift"))?{type:"deleteCard",cardId:c[0].id}:{type:"skip"}}}},T0=(n,o)=>o?D0(n,o):n.phase==="compile"&&n.compilableLanes.length>0?{type:"compile",laneIndex:n.compilableLanes.reduce((i,r)=>n.opponent.laneValues[r]>n.opponent.laneValues[i]?r:i)}:n.phase==="action"?k0(n):{type:"fillHand"};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * IMPROVED HARD AI with Memory & Strategic Thinking
 */let Dn={knownPlayerCards:new Map,knownOwnCards:new Map,suspectedThreats:new Set,lastPlayerLaneValues:[0,0,0],turnsPlayed:0};const zh=n=>{Dn.turnsPlayed++,n.player.lanes.flat().forEach(o=>{o.isFaceUp&&Dn.knownPlayerCards.set(o.id,o)}),n.opponent.lanes.flat().forEach(o=>{o.isFaceUp&&Dn.knownOwnCards.set(o.id,o)}),n.player.lanes.forEach((o,c)=>{n.player.laneValues[c]>=7&&o.forEach(i=>{i.isFaceUp||Dn.suspectedThreats.add(i.id)})}),Dn.lastPlayerLaneValues=[...n.player.laneValues]},za=["delete","flip","shift","return","discard"],it=(n,o)=>{var i,r,l,s;let c=0;if(n.keywords.delete){const f=o.player.lanes.flat().length,p=(i=n.middle.match(/Delete (\d+)/))==null?void 0:i[1];if(p){const h=Math.min(parseInt(p),f);c+=h*100}}if(n.keywords.flip&&n.middle.includes("opponent")){const f=o.player.lanes.flat().filter(p=>p.isFaceUp);if(f.length>0){const p=Math.min(1,f.length);c+=p*2*50}}if(n.keywords.flip&&(n.middle.includes("your")||n.middle.includes("1 of YOUR"))){const f=o.opponent.lanes.flat().filter(p=>!p.isFaceUp);if(f.length>0){const p=Math.min(1,f.length);c+=p*2*50}}if(n.keywords.discard&&!n.middle.includes("opponent")){const f=(r=n.middle.match(/Discard (\d+)/))==null?void 0:r[1];f&&(c-=parseInt(f)*30)}if(n.keywords.discard&&n.middle.includes("opponent")){const f=(l=n.middle.match(/(\d+)/))==null?void 0:l[1];if(f&&o.player.hand.length>0){const p=Math.min(parseInt(f),o.player.hand.length);c+=p*30}}if(n.keywords.return&&o.opponent.lanes.flat().length>0&&(c+=20),n.keywords.shift&&o.player.lanes.flat().length+o.opponent.lanes.flat().length>0&&(c+=30),n.keywords.draw){const f=(s=n.middle.match(/Draw (\d+)/))==null?void 0:s[1];f&&(c+=parseInt(f)*20)}return n.keywords.play&&(c+=40),c},at=(n,o,c)=>{let i;for(const l of c[o].lanes)if(l.some(s=>s.id===n.id)){i=l;break}if(!i)return 0;if(!n.isFaceUp){const s=i.some(f=>f.isFaceUp&&f.protocol==="Darkness"&&f.value===2)?4:2;if(Dn.knownPlayerCards.has(n.id)){const f=Dn.knownPlayerCards.get(n.id);return f.value*2+(za.some(p=>f.keywords[p])?8:0)}return Dn.suspectedThreats.has(n.id)?s+6:s}let r=n.value*2.5;return n.top.length>0&&(r+=8),(n.bottom.includes("Start:")||n.bottom.includes("End:"))&&(r+=10),n.bottom.includes("covered:")&&(r+=6),za.some(l=>n.keywords[l])&&(r+=5),r},co=(n,o,c,i)=>{const r=i[o].laneValues[c],l=i[o].compiled[c];if(o==="opponent"){if(l)return 1e4;const s=10-r;return s<=0?-1e4:s<=3?-5e3:1e3}else{if(l)return 0;let s=r*1e3;return r>=10&&r>i.opponent.laneValues[c]&&(s+=1e5),s}},N0=(n,o,c,i)=>{const r=i[o].laneValues[c],l=i[o].compiled[c],s=mt(n,i[o].lanes[c]);if(o==="opponent"){if(l)return-1e4;const f=r+s,p=10-f;return p<=0?f>i.player.laneValues[c]?5e4:3e4:p<=3?2e4:1e4-r*100}else{if(l)return 1e5;const f=r+s;return f>=10&&f>i.opponent.laneValues[c]?-1e5:5e4-r*1e3}},od=n=>{let o=0;return n.keywords.delete&&(o+=30),n.keywords.discard&&(o+=20),n.keywords.return&&(o+=15),n.keywords.shift&&(o+=10),n.keywords.draw&&(o+=8),n.keywords.play&&(o+=25),n.keywords.prevent&&(o+=12),n.keywords.flip&&(o+=10),n.protocol==="Hate"&&n.value===1&&(o+=40),n.protocol==="Death"&&n.value===3&&(o+=35),n.protocol==="Fire"&&n.value===4&&(o+=30),n.protocol==="Psychic"&&n.value===0&&(o+=25),o},Ft=(n,o,c,i)=>{const r=i[o].laneValues[c],l=i[o].compiled[c];if(o==="player")if(n.isFaceUp){let f=-(2-n.value)*100;const p=od(n);return f+=p*10,r>=8&&(f+=200),f}else if(Dn.knownPlayerCards.has(n.id)){const s=Dn.knownPlayerCards.get(n.id);if(s.value<=1)return-800;const f=od(s);return s.value>=4||f>30?-400:-300}else return-600;else{if(n.isFaceUp)return n.value<=1&&!(n.keywords&&(n.keywords.play||n.keywords.uncover))?50:-1e3;{let s;Dn.knownOwnCards.has(n.id)&&(s=Dn.knownOwnCards.get(n.id));const f=(s==null?void 0:s.value)??n.value,p=s?od(s):10;let h=f*100;if(h+=p*5,!l){const _=r-2+f;_>=10&&_>i.player.laneValues[c]?h+=500:_>=7&&(h+=200)}return f<=1&&h<300&&(h=10),h}}},F0=n=>{const o=n.opponent.compiled.filter(C=>C).length,c=n.player.compiled.filter(C=>C).length,i=o===2,r=o>=2||o===1&&c===0,l=n.player.laneValues.map((C,S)=>({lane:S,value:C,canCompile:C>=10&&C>n.opponent.laneValues[S]&&!n.player.compiled[S]})),s=l.some(C=>C.canCompile),f=l.some(C=>C.value>=8&&!C.canCompile),p=s||f&&n.opponent.hand.length<3,h=n.player.laneValues.some(C=>C>=6)&&n.opponent.hand.some(C=>za.some(S=>C.keywords[S])),_=l.reduce((C,S)=>S.value>l[C].value?S.lane:C,0);let m=-1,v=-999;for(let C=0;C<3;C++)if(!n.opponent.compiled[C]){const S=n.opponent.laneValues[C]-n.player.laneValues[C];(S>v||S===v&&n.opponent.laneValues[C]>=10)&&(v=S,m=C)}let w=!1,x=-1;if(n.player.hand.length<=1&&n.opponent.hand.length>=2)for(let C=0;C<3;C++){if(n.opponent.compiled[C])continue;if(n.opponent.laneValues[C]-n.player.laneValues[C]>=-2){w=!0,x=C;break}}return{shouldDisrupt:h,shouldRush:r,needsDefense:p,criticalLane:_,oneAwayFromWin:i,closestToWin:m,canWinByOutlasting:w,outLastLane:x}},q0=n=>{zh(n);const o=[],c=F0(n),i=w=>{const x=n.player.lanes[w];if(x.length===0)return!1;const C=x[x.length-1];return C.isFaceUp&&C.protocol==="Plague"&&C.value===0},r=n.player.lanes.flat().some(w=>w.isFaceUp&&w.protocol==="Psychic"&&w.value===1),l=n.player.compiled.filter(w=>w).length,s=n.useControlMechanic&&l>=2,f=n.opponent.compiled.filter(w=>w).length,p=n.useControlMechanic&&n.controlCardHolder==="player",h=f>=1&&p,_=(w,x)=>n.opponent.lanes[w].filter(C=>C.protocol===x).length,m=w=>{if(!h)return 0;let x=0;n.opponent.lanes.forEach((E,j)=>{if(!n.opponent.compiled[j]){const D=n.opponent.laneValues[j];D>x&&(x=D)}});const C=n.opponent.laneValues[w];return C<x&&!n.opponent.compiled[w]?500+(x-C)*50:0},v=w=>{const x=n.player.laneValues[w],C=n.opponent.laneValues[w],S=n.player.compiled[w];if(x<10||S||x<=C)return!1;const E=n.opponent.lanes.flat().some(L=>L.isFaceUp&&L.protocol==="Spirit"&&L.value===1),j=n.opponent.lanes.some(L=>{if(L.length===0)return!1;const H=L[L.length-1];return H.isFaceUp&&H.protocol==="Chaos"&&H.value===3}),D=n.opponent.protocols[w],A=n.player.protocols[w];for(const L of n.opponent.hand){const ce=(L.protocol===D||L.protocol===A||E||j)&&!r?L.value:0,z=n.player.lanes[w].some(G=>G.isFaceUp&&G.protocol==="Metal"&&G.value===2)?0:mt({...L,isFaceUp:!1},n.opponent.lanes[w]),V=Math.max(ce,z);if(C+V>=x)return!1}return!0};for(const w of n.opponent.hand){const x=n.opponent.lanes.flat().length+n.player.lanes.flat().length;if(!(w.value===0&&x===0))for(let C=0;C<3;C++){if(i(C))continue;if(w.protocol==="Water"&&w.value===4){let N=!1;for(let k=0;k<3;k++)if(k!==C&&n.opponent.lanes[k].length>0){N=!0;break}if(!N)continue}if(n.opponent.compiled[C]&&(!n.useControlMechanic||n.opponent.laneValues[C]>=n.player.laneValues[C]))continue;if(w.protocol==="Metal"&&w.value===6){const k=n.opponent.laneValues[C]+6;if(!(k>=10))continue;const ee=n.player.laneValues[C];if(k<=ee)continue}const S=w.protocol==="Hate"&&w.value===2;let E=!1,j=!1;if(S){const N=k=>{const W={...w,isFaceUp:k},ee=n.opponent.lanes.map((F,O)=>{if(O===C){const K=[...F,W];return{card:W,laneContext:K}}else if(F.length>0)return{card:F[F.length-1],laneContext:F};return null}).filter(F=>F!==null);if(ee.length===0)return!1;const ge=ee.reduce((F,O)=>{const K=mt(F.card,F.laneContext);return mt(O.card,O.laneContext)>K?O:F});return ge.card.protocol==="Hate"&&ge.card.value===2&&ge.card.isFaceUp===k};E=N(!0),j=N(!1)}const D=n.player.laneValues[C]>=10&&n.player.laneValues[C]>n.opponent.laneValues[C]&&!n.player.compiled[C],A=n.player.laneValues[C]>=10&&!n.player.compiled[C],L=n.opponent.laneValues[C]<=n.player.laneValues[C]+2,H=A&&L,ce=it(w,n),B=w.protocol===n.opponent.protocols[C],z=w.protocol===n.player.protocols[C],V=n.opponent.lanes.flat().some(N=>N.isFaceUp&&N.protocol==="Spirit"&&N.value===1),le=n.opponent.lanes.some(N=>{if(N.length===0)return!1;const k=N[N.length-1];return k.isFaceUp&&k.protocol==="Chaos"&&k.value===3}),G=[...n.player.lanes.flat(),...n.opponent.lanes.flat()].some(N=>N.isFaceUp&&N.protocol==="Anarchy"&&N.value===1);let P;if(G?P=!B&&!z&&!r:P=(B||z||V||le)&&!r,P&&!(S&&E)){let N=0,k=`Play ${w.protocol}-${w.value} face-up in lane ${C}.`;const W=w.value,ee=n.opponent.laneValues[C]+W;if(D)N=W*1e3+ce*10,ee>=n.player.laneValues[C]?(N+=1e4,k+=" [BLOCKS IMMEDIATE COMPILE]"):(N-=5,k+=" [FAILS TO BLOCK]");else if(c.oneAwayFromWin&&C===c.closestToWin)ee>=10&&ee>n.player.laneValues[C]?(N=2e4,k+=" [GAME-WINNING COMPILE!!!]"):(N=5e3+ee*50,k+=" [Building winning lane]");else if(c.canWinByOutlasting&&C===c.outLastLane)ee>=10&&ee>n.player.laneValues[C]?(N=18e3,k+=" [OUTLAST WIN]"):(N=8e3+ee*30,k+=" [OUTLAST: Building]");else{if(N=W*1e3+ce*10,ee>=10&&ee>n.player.laneValues[C]&&!n.opponent.compiled[C])N+=3e3,k+=" [COMPILES PROTOCOL!]";else if(ee>=10&&n.player.laneValues[C]>=10&&!n.opponent.compiled[C]&&(ee>=n.player.laneValues[C]||w.keywords.delete)){const U=n.player.laneValues[C]-ee;N+=2500-U*50,k+=` [FIGHTING STANDOFF: ${ee} vs ${n.player.laneValues[C]}]`}else ee>=5&&!n.opponent.compiled[C]?(N+=1e3+ee*50,k+=` [Building: ${ee}/10]`):ee<5&&!n.opponent.compiled[C]&&(N+=200+ee*20,k+=` [Weak lane: ${ee}/10]`);const ge=_(C,w.protocol);if(ge>0){const U=ge*800;N+=U,k+=` [SYNERGY: ${ge+1}x ${w.protocol}]`}const F=n.opponent.laneValues[C],O=m(C);if(O>0?(N+=O,k+=` [DIVERSIFY: +${O}]`):F>=6?(N+=600,k+=" [Concentration]"):F>=3&&(N+=200),za.some(U=>w.keywords[U])&&(c.shouldDisrupt&&(N+=400,k+=" [Disruption]"),n.player.laneValues[C]>=7&&(N+=200,k+=" [vs threat]")),s&&n.opponent.compiled[C]){const U=ee-n.player.laneValues[C];U>0&&(N+=1500+U*100,k+=` [CONTROL: lead +${U}]`)}(w.keywords.play||w.keywords.draw)&&(N+=300,k+=" [Card+]"),n.opponent.compiled[C]&&!s&&(N-=3,k+=" [WASTED in compiled]"),H&&ee<=n.player.laneValues[C]&&(N-=1,k+=" [DANGER: Falls behind]"),v(C)&&(N-=4e3,k+=" [UNDEFENDABLE LANE]")}o.push({move:{type:"playCard",cardId:w.id,laneIndex:C,isFaceUp:!0},score:N,reason:k})}if(!n.player.lanes[C].some(N=>N.isFaceUp&&N.protocol==="Metal"&&N.value===2)&&!(S&&j)){const N=mt({...w,isFaceUp:!1},n.opponent.lanes[C]),k=n.opponent.laneValues[C]+N;let W=0,ee=`Play ${w.protocol}-${w.value} face-down in lane ${C}.`;if(D)k>n.player.laneValues[C]?(W=9e3,ee+=" [BLOCKS COMPILE]"):(W=-4e3,ee+=" [FAILS TO BLOCK]");else if(c.oneAwayFromWin&&C===c.closestToWin)k>=10&&k>n.player.laneValues[C]?(W=17e3,ee+=" [GAME-WIN]"):(W=4500+k*40,ee+=" [Building win]");else if(c.canWinByOutlasting&&C===c.outLastLane)k>=10&&k>n.player.laneValues[C]?(W=16e3,ee+=" [OUTLAST WIN]"):(W=7e3+k*25,ee+=" [OUTLAST]");else{if(W=N*50,k>=10&&k>n.player.laneValues[C]&&!n.opponent.compiled[C])W+=6e3,ee+=" [COMPILES]";else if(k>=10&&n.player.laneValues[C]>=10&&!n.opponent.compiled[C]&&(k>=n.player.laneValues[C]||w.keywords.delete)){const K=n.player.laneValues[C]-k;W+=5e3-K*100,ee+=` [STANDOFF: ${k} vs ${n.player.laneValues[C]}]`}else k>=8&&!n.opponent.compiled[C]?(W+=2e3-(10-k)*300,ee+=` [Close: ${k}/10]`):k>=5&&!n.opponent.compiled[C]?(W+=600+k*30,ee+=` [Building: ${k}/10]`):n.opponent.compiled[C]||(W+=100+k*15,ee+=` [Weak: ${k}/10]`);const ge=_(C,w.protocol);ge>0&&(W+=ge*400,ee+=` [SYNERGY: ${ge+1}x]`);const F=n.opponent.laneValues[C],O=m(C);O>0?(W+=O/2,ee+=" [DIVERSIFY]"):F>=6&&(W+=300,ee+=" [Conc]"),it(w,n)>=150&&!c.oneAwayFromWin&&(W-=800,ee+=" [Wasting effect]"),n.opponent.compiled[C]&&!s&&(W-=2500,ee+=" [WASTED]"),H&&k<=n.player.laneValues[C]&&(W-=1500,ee+=" [DANGER]"),v(C)&&(W-=4e3,ee+=" [UNDEFENDABLE LANE]")}o.push({move:{type:"playCard",cardId:w.id,laneIndex:C,isFaceUp:!1},score:W,reason:ee})}}}if(n.opponent.hand.length<5){let w=-5e3,x="Refresh hand";if(n.opponent.hand.length===0)w=1e3,x="Refresh hand (EMPTY - must draw!)";else if(n.opponent.hand.length===1){const C=n.opponent.hand[0];let S=!1;for(let E=0;E<3;E++){if(i(E))continue;const j=n.opponent.laneValues[E]+C.value,D=n.opponent.laneValues[E]+mt({...C,isFaceUp:!1},n.opponent.lanes[E]);if((j>=10||D>=10)&&!n.opponent.compiled[E]){S=!0;break}if(j>=5||D>=5){S=!0;break}}S||(w=500,x="Refresh hand (1 card - not useful)")}else{const C=n.useControlMechanic&&n.controlCardHolder==="opponent",S=n.player.compiled.filter(E=>E).length;C&&S>=1&&n.player.laneValues.some((j,D)=>!n.player.compiled[D]&&j>=10&&j>n.opponent.laneValues[D])&&(w=2e3,x="Refresh hand (CONTROL - stop player's next compile!)")}c.oneAwayFromWin&&n.opponent.hand.some(S=>{const E=c.closestToWin;if(E===-1)return!1;const j=n.opponent.laneValues[E]+S.value,D=n.opponent.laneValues[E]+mt({...S,isFaceUp:!1},n.opponent.lanes[E]);return j>=10||D>=10})&&(w=-5e3,x="Refresh hand (CAN WIN - DON'T REFRESH!)"),o.push({move:{type:"fillHand"},score:w,reason:x})}return o.length===0?{type:"fillHand"}:(o.sort((w,x)=>x.score-w.score),o[0].move)},U0=(n,o)=>{var c,i;switch(zh(n),o.type){case"prompt_use_control_mechanic":return Vh(n)?{type:"resolveControlMechanicPrompt",choice:"player"}:Bh(n)?{type:"resolveControlMechanicPrompt",choice:"opponent"}:{type:"resolveControlMechanicPrompt",choice:"skip"};case"discard":return{type:"discardCards",cardIds:[...n.opponent.hand].sort((l,s)=>{const f=za.some(h=>l.keywords[h]),p=za.some(h=>s.keywords[h]);return f&&!p?1:!f&&p?-1:it(l,n)-it(s,n)}).slice(0,o.count).map(l=>l.id)};case"select_opponent_card_to_flip":{const r=[];return n.player.lanes.forEach((l,s)=>{if(l.length>0){const f=l[l.length-1],p=Ft(f,"player",s,n);r.push({card:f,laneIndex:s,score:p})}}),r.length===0?{type:"skip"}:(r.sort((l,s)=>s.score-l.score),{type:"flipCard",cardId:r[0].card.id})}case"select_card_to_delete_for_anarchy_2":{const r=(s,f,p)=>{const h=n[f].protocols[p];return s.protocol===h},l=[];return n.player.lanes.forEach((s,f)=>{s.forEach((p,h)=>{if(!p.isFaceUp||!r(p,"player",f))return;const _=h===s.length-1,m=at(p,"player",n),v=n.player.laneValues[f],w=v>=10&&v>n.opponent.laneValues[f];let x=m+v*.5+(w?100:0);_&&(x+=50),l.push({card:p,owner:"player",laneIndex:f,score:x})})}),n.opponent.lanes.forEach((s,f)=>{s.forEach((p,h)=>{if(!p.isFaceUp||!r(p,"opponent",f))return;const _=h===s.length-1;let v=-at(p,"opponent",n)-50;_||(v-=20),l.push({card:p,owner:"opponent",laneIndex:f,score:v})})}),l.length===0?{type:"skip"}:(l.sort((s,f)=>f.score-s.score),{type:"deleteCard",cardId:l[0].card.id})}case"select_cards_to_delete":case"select_card_to_delete_for_death_1":{const r=o.type==="select_cards_to_delete"?o.disallowedIds:[o.sourceCardId],l=p=>n[p].lanes.map((h,_)=>h.length>0?{card:h[h.length-1],laneIndex:_}:null).filter(h=>h!==null),s=l("player").filter(({card:p})=>!r.includes(p.id));if(s.length>0){const p=s.map(({card:h,laneIndex:_})=>{const m=n.player.laneValues[_],v=m>=10&&m>n.opponent.laneValues[_],x=n.player.compiled[_]?-1e3:0;return{cardId:h.id,score:at(h,"player",n)*2+m+(v?100:0)+x}});return p.sort((h,_)=>_.score-h.score),{type:"deleteCard",cardId:p[0].cardId}}const f=l("opponent").filter(({card:p})=>!r.includes(p.id));return f.length>0?{type:"deleteCard",cardId:f.sort((h,_)=>at(h.card,"opponent",n)-at(_.card,"opponent",n))[0].card.id}:{type:"skip"}}case"select_any_card_to_flip":case"select_any_other_card_to_flip":{const r=Vn(n),l=[],s=o.type==="select_any_other_card_to_flip"?o.sourceCardId:null;return n.player.lanes.forEach((f,p)=>{if(f.length>0){const h=f[f.length-1];if(r&&!h.isFaceUp)return;if(h.id!==s){const _=Ft(h,"player",p,n);l.push({card:h,laneIndex:p,owner:"player",score:_})}}}),n.opponent.lanes.forEach((f,p)=>{if(f.length>0){const h=f[f.length-1];if(r&&!h.isFaceUp)return;if(h.id!==s){const _=Ft(h,"opponent",p,n);l.push({card:h,laneIndex:p,owner:"opponent",score:_})}}}),l.length===0?{type:"skip"}:(l.sort((f,p)=>p.score-f.score),{type:"flipCard",cardId:l[0].card.id})}case"select_any_face_down_card_to_flip_optional":{const r=[];return n.player.lanes.forEach((l,s)=>{if(l.length>0){const f=l[l.length-1];if(!f.isFaceUp){const p=Ft(f,"player",s,n);r.push({card:f,laneIndex:s,owner:"player",score:p})}}}),n.opponent.lanes.forEach((l,s)=>{if(l.length>0){const f=l[l.length-1];if(!f.isFaceUp){const p=Ft(f,"opponent",s,n);r.push({card:f,laneIndex:s,owner:"opponent",score:p})}}}),r.length===0?{type:"skip"}:(r.sort((l,s)=>s.score-l.score),{type:"flipCard",cardId:r[0].card.id})}case"select_any_card_to_flip_optional":{const r=[];return n.player.lanes.forEach((l,s)=>{if(l.length>0){const f=l[l.length-1],p=Ft(f,"player",s,n);r.push({card:f,laneIndex:s,owner:"player",score:p})}}),n.opponent.lanes.forEach((l,s)=>{if(l.length>0){const f=l[l.length-1],p=Ft(f,"opponent",s,n);r.push({card:f,laneIndex:s,owner:"opponent",score:p})}}),r.length===0?{type:"skip"}:(r.sort((l,s)=>s.score-l.score),{type:"flipCard",cardId:r[0].card.id})}case"select_own_face_up_covered_card_to_flip":{const r=[];return n.opponent.lanes.forEach((l,s)=>{for(let f=0;f<l.length-1;f++){const p=l[f];if(p.isFaceUp){const h=Ft(p,"opponent",s,n);r.push({card:p,laneIndex:s,score:h})}}}),r.length===0?{type:"skip"}:(r.sort((l,s)=>s.score-l.score),r[0].score>0?{type:"flipCard",cardId:r[0].card.id}:{type:"skip"})}case"select_face_down_card_to_reveal_for_light_2":{const r=[];return n.player.lanes.forEach((l,s)=>{if(l.length>0){const f=l[l.length-1];if(!f.isFaceUp){const p=Ft(f,"player",s,n);r.push({card:f,laneIndex:s,owner:"player",score:p})}}}),n.opponent.lanes.forEach((l,s)=>{if(l.length>0){const f=l[l.length-1];if(!f.isFaceUp){const p=Ft(f,"opponent",s,n);r.push({card:f,laneIndex:s,owner:"opponent",score:p})}}}),r.length===0?{type:"skip"}:(r.sort((l,s)=>s.score-l.score),{type:"flipCard",cardId:r[0].card.id})}case"select_opponent_face_up_card_to_flip":{const r=[];return n.player.lanes.forEach((l,s)=>{if(l.length>0){const f=l[l.length-1];if(f.isFaceUp){const p=Ft(f,"player",s,n);r.push({card:f,laneIndex:s,score:p})}}}),r.length===0?{type:"skip"}:(r.sort((l,s)=>s.score-l.score),{type:"flipCard",cardId:r[0].card.id})}case"select_card_to_flip_for_fire_3":case"select_card_to_flip_for_light_0":case"select_any_other_card_to_flip_for_water_0":case"select_covered_card_to_flip_for_chaos_0":case"select_covered_card_in_line_to_flip_optional":{const r=[];if(o.type==="select_covered_card_to_flip_for_chaos_0"){const{laneIndex:l}=o;n.player.lanes[l].forEach((s,f,p)=>{if(f<p.length-1){const h=Ft(s,"player",l,n);r.push({card:s,laneIndex:l,owner:"player",score:h})}}),n.opponent.lanes[l].forEach((s,f,p)=>{if(f<p.length-1){const h=Ft(s,"opponent",l,n);r.push({card:s,laneIndex:l,owner:"opponent",score:h})}})}else if(o.type==="select_covered_card_in_line_to_flip_optional"){const{laneIndex:l}=o;n.player.lanes[l].forEach((s,f,p)=>{if(f<p.length-1){const h=Ft(s,"player",l,n);r.push({card:s,laneIndex:l,owner:"player",score:h})}}),n.opponent.lanes[l].forEach((s,f,p)=>{if(f<p.length-1){const h=Ft(s,"opponent",l,n);r.push({card:s,laneIndex:l,owner:"opponent",score:h})}})}else{const l=o.type==="select_any_other_card_to_flip_for_water_0"?o.sourceCardId:null;n.player.lanes.forEach((s,f)=>{if(s.length>0){const p=s[s.length-1];if(p.id!==l){const h=Ft(p,"player",f,n);r.push({card:p,laneIndex:f,owner:"player",score:h})}}}),n.opponent.lanes.forEach((s,f)=>{if(s.length>0){const p=s[s.length-1];if(p.id!==l){const h=Ft(p,"opponent",f,n);r.push({card:p,laneIndex:f,owner:"opponent",score:h})}}})}return r.length===0?{type:"skip"}:(r.sort((l,s)=>s.score-l.score),{type:"flipCard",cardId:r[0].card.id})}case"select_card_from_other_lanes_to_delete":{const{disallowedLaneIndex:r,lanesSelected:l}=o,s=[],f=[];for(let p=0;p<3;p++){if(p===r||l.includes(p))continue;const h=n.player.lanes[p];h.length>0&&s.push({card:h[h.length-1],laneIndex:p,isCompiled:n.player.compiled[p]});const _=n.opponent.lanes[p];_.length>0&&f.push({card:_[_.length-1],laneIndex:p})}return s.length>0?(s.sort((p,h)=>{const _=p.isCompiled?-1e3:0,m=h.isCompiled?-1e3:0,v=at(p.card,"player",n)+_;return at(h.card,"player",n)+m-v}),{type:"deleteCard",cardId:s[0].card.id}):f.length>0?(f.sort((p,h)=>at(p.card,"opponent",n)-at(h.card,"opponent",n)),{type:"deleteCard",cardId:f[0].card.id}):{type:"skip"}}case"select_low_value_card_to_delete":{const r=[];for(const s of["player","opponent"])for(let f=0;f<3;f++){const p=n[s].lanes[f];p.length>0&&r.push({card:p[p.length-1],owner:s,laneIndex:f})}const l=r.filter(({card:s})=>s.isFaceUp&&(s.value===0||s.value===1));return l.length>0?(l.sort((s,f)=>{const p=s.owner==="player",h=f.owner==="player";if(p&&!h)return-1;if(!p&&h)return 1;if(p&&h){const _=n.player.compiled[s.laneIndex],m=n.player.compiled[f.laneIndex];if(!_&&m)return-1;if(_&&!m)return 1}return at(f.card,f.owner,n)-at(s.card,s.owner,n)}),{type:"deleteCard",cardId:l[0].card.id}):{type:"skip"}}case"select_own_highest_card_to_delete_for_hate_2":{const r=o.actor,l=[];if(n[r].lanes.forEach((p,h)=>{if(p.length>0){const _=p[p.length-1],m=_.isFaceUp?_.value:2;l.push({card:_,laneIndex:h,value:m})}}),l.length===0)return{type:"skip"};const s=Math.max(...l.map(p=>p.value)),f=l.filter(p=>p.value===s);return f.sort((p,h)=>{const _=n[r].laneValues[p.laneIndex],m=n[r].laneValues[h.laneIndex],v=n[r].compiled[p.laneIndex],w=n[r].compiled[h.laneIndex];return v&&!w?-1:!v&&w?1:_-m}),{type:"deleteCard",cardId:f[0].card.id}}case"select_opponent_highest_card_to_delete_for_hate_2":{const l=o.actor==="player"?"opponent":"player",s=[];if(n[l].lanes.forEach((h,_)=>{if(h.length>0){const m=h[h.length-1],v=m.isFaceUp?m.value:2;s.push({card:m,laneIndex:_,value:v})}}),s.length===0)return{type:"skip"};const f=Math.max(...s.map(h=>h.value)),p=s.filter(h=>h.value===f);return p.sort((h,_)=>{const m=n[l].laneValues[h.laneIndex],v=n[l].laneValues[_.laneIndex],w=n[l].compiled[h.laneIndex],x=n[l].compiled[_.laneIndex];return!w&&x?-1:w&&!x?1:v-m}),{type:"deleteCard",cardId:p[0].card.id}}case"select_own_card_to_return_for_water_4":{const r=[];if(n.opponent.lanes.forEach(l=>{if(l.length>0){const s=l[l.length-1];r.push({card:s,lane:l})}}),r.length>0){const l=r.map(({card:s,lane:f})=>{let h=-mt(s,f);return(s.keywords.delete||s.keywords.play||s.keywords.draw||s.keywords.flip||s.keywords.return)&&s.id!==o.sourceCardId&&(h+=8),{card:s,score:h}});return l.sort((s,f)=>f.score-s.score),{type:"returnCard",cardId:l[0].card.id}}return{type:"skip"}}case"gravity_2_shift_after_flip":case"shift_flipped_card_optional":{const r=o.type==="gravity_2_shift_after_flip"?o.cardToShiftId:o.cardId,l=he(n,r);if(!l||l.owner!=="player")return{type:"skip"};const{card:s}=l;let f=-1;for(let _=0;_<n.player.lanes.length;_++)if(n.player.lanes[_].some(m=>m.id===r)){f=_;break}if(f===-1)return{type:"skip"};const p=[0,1,2].filter(_=>_!==f);if(p.length===0)return{type:"skip"};const h=p.map(_=>{const m=mt(s,n.player.lanes[_]),v=n.player.laneValues[_]+m;let x=-(v-n.opponent.laneValues[_]);const C=n.player.compiled[_];return v>=10&&v>n.opponent.laneValues[_]?x-=1e3:C&&(x+=800),{laneIndex:_,score:x}});return h.sort((_,m)=>m.score-_.score),{type:"selectLane",laneIndex:h[0].laneIndex}}case"select_lane_for_shift":{const{cardToShiftId:r,cardOwner:l,originalLaneIndex:s,sourceCardId:f}=o,p=(c=he(n,r))==null?void 0:c.card;if(!p)return{type:"skip"};const h=(i=he(n,f))==null?void 0:i.card;let _=null;if(h&&h.protocol==="Gravity"&&h.value===1){for(let w=0;w<3;w++)if([...n.player.lanes[w],...n.opponent.lanes[w]].some(C=>C.id===f)){_=w;break}}let m=[0,1,2].filter(w=>w!==s);_!==null&&(s===_?m=m:m=[_]),h&&h.protocol==="Anarchy"&&h.value===1&&(m=m.filter(w=>{const x=n.player.protocols[w],C=n.opponent.protocols[w],S=p.protocol;return S!==x&&S!==C}));const v=m.map(w=>({laneIndex:w,score:N0(p,l,w,n)}));return v.sort((w,x)=>x.score-w.score),{type:"selectLane",laneIndex:v[0].laneIndex}}case"select_own_card_to_shift_for_speed_3":{const r=[];return n.opponent.lanes.forEach((l,s)=>{if(l.length===0)return;const f=l[l.length-1],p=n.opponent.compiled[s];let h=-1/0;for(let _=0;_<3;_++){if(_===s)continue;const m=n.opponent.laneValues[_];if(n.opponent.compiled[_])continue;const w=m+2,x=n.player.laneValues[_];let C=0;p?(C+=1e4,w>=10&&w>x?C+=5e4:w>=8&&(C+=5e3)):w>=10&&w>x?C+=5e4:C=-1e4,C>h&&(h=C)}r.push({card:f,sourceLaneIndex:s,bestScore:h})}),r.length===0?{type:"skip"}:(r.sort((l,s)=>s.bestScore-l.bestScore),r[0].bestScore>0?{type:"shiftCard",cardId:r[0].card.id}:{type:"skip"})}case"select_lane_for_water_3":{const r=(s,f)=>{let p=0,h=0;for(const _ of["player","opponent"]){const m=s[_].lanes[f],w=m.some(x=>x.isFaceUp&&x.protocol==="Darkness"&&x.value===2)?4:2;for(const x of m)(x.isFaceUp?x.value:w)===2&&(_==="player"?p++:h++)}return{playerTargets:p,opponentTargets:h}},l=[0,1,2].map(s=>{const{playerTargets:f,opponentTargets:p}=r(n,s),h=5-n.player.hand.length,_=f*(12+h)-p*6;return{laneIndex:s,score:_}});return l.sort((s,f)=>f.score-s.score),{type:"selectLane",laneIndex:l[0].laneIndex}}case"prompt_rearrange_protocols":return fd(n,o);case"prompt_swap_protocols":{const{target:r}=o,l=n[r].protocols,s=n[r].hand,f=[[0,1],[0,2],[1,2]];let p=[0,1],h=-1/0;for(const _ of f){const[m,v]=_,w=[...l];[w[m],w[v]]=[w[v],w[m]];let x=0;if(r==="opponent")for(const C of s){const S=C.protocol===l[m],E=C.protocol===l[v],j=C.protocol===w[m],D=C.protocol===w[v];j&&!S&&(x+=it(C,n)),D&&!E&&(x+=it(C,n)),!j&&S&&(x-=it(C,n)),!D&&E&&(x-=it(C,n))}else for(const C of s){const S=C.protocol===l[m],E=C.protocol===l[v],j=C.protocol===w[m],D=C.protocol===w[v];j&&!S&&(x-=it(C,n)),D&&!E&&(x-=it(C,n)),!j&&S&&(x+=it(C,n)),!D&&E&&(x+=it(C,n))}x>h&&(h=x,p=_)}return{type:"resolveSwapProtocols",indices:p}}case"select_card_to_shift_for_anarchy_0":{const r=[];return n.opponent.lanes.forEach((l,s)=>{if(l.length===0)return;const f=l[l.length-1],p=co(f,"opponent",s,n);r.push({card:f,laneIndex:s,score:p})}),n.player.lanes.forEach((l,s)=>{if(l.length===0)return;const f=l[l.length-1],p=co(f,"player",s,n);r.push({card:f,laneIndex:s,score:p})}),r.length===0?{type:"skip"}:(r.sort((l,s)=>s.score-l.score),{type:"shiftCard",cardId:r[0].card.id})}case"select_card_to_shift_for_anarchy_1":{const{sourceCardId:r}=o,l=[];return n.opponent.lanes.forEach((s,f)=>{if(s.length===0)return;const p=s[s.length-1];if(p.id===r)return;const h=co(p,"opponent",f,n);l.push({card:p,laneIndex:f,score:h})}),n.player.lanes.forEach((s,f)=>{if(s.length===0)return;const p=s[s.length-1];if(p.id===r)return;const h=co(p,"player",f,n);l.push({card:p,laneIndex:f,score:h})}),l.length===0?{type:"skip"}:(l.sort((s,f)=>f.score-s.score),{type:"shiftCard",cardId:l[0].card.id})}case"select_card_to_shift_for_gravity_1":{const{sourceLaneIndex:r}=o,l=[];return n.opponent.lanes.forEach((s,f)=>{if(s.length===0)return;const p=s[s.length-1],h=co(p,"opponent",f,n);l.push({card:p,laneIndex:f,score:h})}),n.player.lanes.forEach((s,f)=>{if(s.length===0)return;const p=s[s.length-1],h=co(p,"player",f,n);l.push({card:p,laneIndex:f,score:h})}),l.length===0?{type:"skip"}:(l.sort((s,f)=>f.score-s.score),{type:"shiftCard",cardId:l[0].card.id})}case"select_card_to_flip_and_shift_for_gravity_2":{const r=[];return n.player.lanes.forEach((l,s)=>{if(l.length>0){const f=l[l.length-1],p=Ft(f,"player",s,n);r.push({card:f,laneIndex:s,owner:"player",score:p})}}),n.opponent.lanes.forEach((l,s)=>{if(l.length>0){const f=l[l.length-1],p=Ft(f,"opponent",s,n);r.push({card:f,laneIndex:s,owner:"opponent",score:p})}}),r.length===0?{type:"skip"}:(r.sort((l,s)=>s.score-l.score),{type:"flipCard",cardId:r[0].card.id})}case"select_face_down_card_to_shift_for_gravity_4":{const{targetLaneIndex:r}=o;let l=null,s=-1/0;for(let f=0;f<3;f++){if(f===r||n.player.lanes[f].filter(D=>!D.isFaceUp).length===0)continue;const h=n.player.lanes[f][n.player.lanes[f].length-1];if(h.isFaceUp)continue;const _=n.player.laneValues[f],m=n.opponent.laneValues[f],v=_-m,x=n.player.lanes[f].some(D=>D.isFaceUp&&D.protocol==="Darkness"&&D.value===2)?4:2;let C=x*5;v>0&&(C+=v*10),_>=8&&(C+=50),_>=10&&_>m&&!n.player.compiled[f]&&(C+=200);const S=n.player.compiled[f],E=n.player.laneValues[r]+x,j=n.opponent.laneValues[r];E>=10&&E>j&&!n.player.compiled[r]?C-=500:n.player.compiled[r]?C+=400:S&&(C+=300),C>s&&(s=C,l=h)}if(l)return{type:"deleteCard",cardId:l.id};for(let f=0;f<3;f++){if(f===r)continue;const p=n.opponent.lanes[f][n.opponent.lanes[f].length-1];if(!p||p.isFaceUp)continue;const h=n.opponent.laneValues[f],_=n.player.laneValues[f],m=h-_,w=n.opponent.lanes[f].some(E=>E.isFaceUp&&E.protocol==="Darkness"&&E.value===2)?4:2;let x=0;n.opponent.compiled[f]&&(x+=100),m>3&&(x+=m*5);const C=n.opponent.laneValues[r],S=n.player.laneValues[r];C+w>=10&&C+w>S&&!n.opponent.compiled[r]&&(x+=150),x>s&&(s=x,l=p)}return l?{type:"deleteCard",cardId:l.id}:{type:"skip"}}case"select_face_down_card_to_shift_for_darkness_4":{const r=[];return n.player.lanes.forEach((l,s)=>{if(l.length>0){const f=l[l.length-1];if(!f.isFaceUp){const p=n.player.laneValues[s],h=n.opponent.laneValues[s],_=p-h;let w=(l.some(C=>C.isFaceUp&&C.protocol==="Darkness"&&C.value===2)?4:2)*3;const x=n.player.compiled[s];_>0&&(w+=_*8),p>=10&&p>h&&!n.player.compiled[s]?w+=150:p>=8&&(w+=40),x&&(w+=300),r.push({cardId:f.id,score:w,owner:"player"})}}}),n.opponent.lanes.forEach((l,s)=>{if(l.length>0){const f=l[l.length-1];if(!f.isFaceUp){const p=n.opponent.laneValues[s],h=n.player.laneValues[s],_=p-h;let m=0;n.opponent.compiled[s]?m=50:_>5&&(m=25+_*2),r.push({cardId:f.id,score:m,owner:"opponent"})}}}),r.length>0?(r.sort((l,s)=>s.score-l.score),{type:"deleteCard",cardId:r[0].cardId}):{type:"skip"}}case"select_opponent_face_down_card_to_shift":{const r=[];return n.player.lanes.forEach((l,s)=>{if(l.length===0)return;const f=l[l.length-1];if(!f.isFaceUp){const p=co(f,"player",s,n);r.push({card:f,laneIndex:s,score:p})}}),r.length===0?{type:"skip"}:(r.sort((l,s)=>s.score-l.score),{type:"shiftCard",cardId:r[0].card.id})}case"select_any_opponent_card_to_shift":{const r=[];return n.player.lanes.forEach((l,s)=>{if(l.length===0)return;const f=l[l.length-1],p=co(f,"player",s,n);r.push({card:f,laneIndex:s,score:p})}),r.length===0?{type:"skip"}:(r.sort((l,s)=>s.score-l.score),{type:"shiftCard",cardId:r[0].card.id})}case"select_card_from_hand_to_play":{if(n.opponent.hand.length===0)return{type:"skip"};const r=[0,1,2].filter(p=>p!==o.disallowedLaneIndex);if(r.length===0)return{type:"skip"};const l=o.isFaceDown===!0,s=[];for(const p of n.opponent.hand)for(const h of r){if(!l){const w=n.opponent.lanes.flat().some(S=>S.isFaceUp&&S.protocol==="Spirit"&&S.value===1),x=n.opponent.lanes.some(S=>{if(S.length===0)return!1;const E=S[S.length-1];return E.isFaceUp&&E.protocol==="Chaos"&&E.value===3});if(p.protocol===n.opponent.protocols[h]||p.protocol===n.player.protocols[h]||w||x){const S=p.value,E=n.opponent.laneValues[h]+S;let j=it(p,n)+S*2;E>=10&&E>n.player.laneValues[h]&&(j+=500),s.push({cardId:p.id,laneIndex:h,isFaceUp:!0,score:j})}}const _=mt({...p,isFaceUp:!1},n.opponent.lanes[h]),m=n.opponent.laneValues[h]+_;let v=_*2;m>=10&&m>n.player.laneValues[h]&&(v+=400),s.push({cardId:p.id,laneIndex:h,isFaceUp:!1,score:v})}if(s.length===0)return{type:"skip"};s.sort((p,h)=>h.score-p.score);const f=s[0];return{type:"playCard",cardId:f.cardId,laneIndex:f.laneIndex,isFaceUp:f.isFaceUp}}case"select_card_from_hand_to_give":return n.opponent.hand.length===0?{type:"skip"}:{type:"giveCard",cardId:[...n.opponent.hand].sort((l,s)=>it(l,n)-it(s,n))[0].id};case"select_card_from_hand_to_reveal":return n.opponent.hand.length===0?{type:"skip"}:{type:"revealCard",cardId:[...n.opponent.hand].sort((l,s)=>it(s,n)-it(l,n))[0].id};case"plague_2_opponent_discard":return n.opponent.hand.length===0?{type:"skip"}:{type:"resolvePlague2Discard",cardIds:[[...n.opponent.hand].sort((l,s)=>it(l,n)-it(s,n))[0].id]};case"select_cards_from_hand_to_discard_for_fire_4":{const r=Math.min(3,n.opponent.hand.length);return r===0?{type:"skip"}:{type:"resolveFire4Discard",cardIds:[...n.opponent.hand].sort((f,p)=>it(f,n)-it(p,n)).slice(0,r).map(f=>f.id)}}case"select_cards_from_hand_to_discard_for_hate_1":{const r=Math.min(o.count,n.opponent.hand.length);return r===0?{type:"skip"}:{type:"resolveHate1Discard",cardIds:[...n.opponent.hand].sort((f,p)=>it(f,n)-it(p,n)).slice(0,r).map(f=>f.id)}}case"select_lane_for_death_2":{const r=[0,1,2].map(l=>{let s=0,f=0;n.player.lanes[l].forEach(h=>{h.isFaceUp&&(h.value===1||h.value===2)&&s++}),n.opponent.lanes[l].forEach(h=>{h.isFaceUp&&(h.value===1||h.value===2)&&f++});const p=s*10-f*5;return{laneIndex:l,score:p}});return r.sort((l,s)=>s.score-l.score),{type:"selectLane",laneIndex:r[0].laneIndex}}case"select_card_to_return":{const r=[];if(n.player.lanes.forEach(s=>{s.length>0&&r.push(s[s.length-1])}),r.length>0)return r.sort((s,f)=>at(f,"player",n)-at(s,"player",n)),{type:"returnCard",cardId:r[0].id};const l=[];return n.opponent.lanes.forEach(s=>{s.length>0&&l.push(s[s.length-1])}),l.length>0?(l.sort((s,f)=>at(s,"opponent",n)-at(f,"opponent",n)),{type:"returnCard",cardId:l[0].id}):{type:"skip"}}case"select_opponent_card_to_return":{const r=[];return n.player.lanes.forEach(l=>{l.length>0&&r.push(l[l.length-1])}),r.length>0?(r.sort((l,s)=>at(s,"player",n)-at(l,"player",n)),{type:"returnCard",cardId:r[0].id}):{type:"skip"}}case"select_lane_for_play":{const{cardInHandId:r,disallowedLaneIndex:l}=o,s=n.opponent.hand.find(h=>h.id===r);if(!s)return{type:"skip"};const p=[0,1,2].filter(h=>h!==l).map(h=>{const _=o.isFaceDown?mt({...s,isFaceUp:!1},n.opponent.lanes[h]):s.value,m=n.opponent.laneValues[h]+_;let v=m-n.player.laneValues[h];return m>=10&&m>n.player.laneValues[h]&&(v+=200),{laneIndex:h,score:v}});return p.sort((h,_)=>_.score-h.score),{type:"selectLane",laneIndex:p[0].laneIndex}}case"select_lane_for_life_3_play":{const l=[0,1,2].map(s=>{const f=n.opponent.laneValues[s]-n.player.laneValues[s];return{laneIndex:s,score:f}});return l.sort((s,f)=>s.score-f.score),{type:"selectLane",laneIndex:l[0].laneIndex}}case"select_face_down_card_to_delete":{const r=[];return n.player.lanes.forEach((l,s)=>{if(l.length>0){const f=l[l.length-1];if(!f.isFaceUp){const p=n.player.laneValues[s],_=n.player.compiled[s]?-1e3:0;r.push({cardId:f.id,score:p+10+_})}}}),r.length>0?(r.sort((l,s)=>s.score-l.score),{type:"deleteCard",cardId:r[0].cardId}):(n.opponent.lanes.forEach(l=>{if(l.length>0){const s=l[l.length-1];s.isFaceUp||r.push({cardId:s.id,score:-5})}}),r.length>0?(r.sort((l,s)=>s.score-l.score),{type:"deleteCard",cardId:r[0].cardId}):{type:"skip"})}case"select_own_other_card_to_shift":{const r=[];return n.opponent.lanes.forEach((l,s)=>{if(l.length===0)return;const f=l[l.length-1];if(f.id===o.sourceCardId)return;const p=co(f,"opponent",s,n);r.push({card:f,laneIndex:s,score:p})}),r.length===0?{type:"skip"}:(r.sort((l,s)=>s.score-l.score),{type:"shiftCard",cardId:r[0].card.id})}case"select_lane_to_shift_cards_for_light_3":{const r=o.sourceLaneIndex,l=o.actor,s=[0,1,2].filter(p=>p!==r);if(s.length===0)return{type:"skip"};const f=s.map(p=>{let h=0;const _=n[l].laneValues[p];return h+=(10-_)*10,n[l].compiled[p]||(h+=100),{laneIndex:p,score:h}});return f.sort((p,h)=>h.score-p.score),{type:"selectLane",laneIndex:f[0].laneIndex}}case"select_lane_to_shift_revealed_card_for_light_2":{const r=o.revealedCardId;let l=null,s=null;for(let p=0;p<3;p++){if(n.opponent.lanes[p].some(h=>h.id===r)){l="opponent",s=p;break}if(n.player.lanes[p].some(h=>h.id===r)){l="player",s=p;break}}let f=[0,1,2];if(s!==null&&(f=f.filter(p=>p!==s)),f.length>0){const p=l==="opponent"?n.opponent.lanes:n.player.lanes;return f.sort((h,_)=>p[h].length-p[_].length),{type:"selectLane",laneIndex:f[0]}}return{type:"skip"}}case"select_lane_for_metal_3_delete":{const r=[0,1,2].map(l=>{const s=n.player.lanes[l],f=Math.max(...s.map(p=>p.isFaceUp?p.value:2),0);return{laneIndex:l,score:f}});return r.sort((l,s)=>s.score-l.score),{type:"selectLane",laneIndex:r[0].laneIndex}}case"prompt_death_1_effect":return{type:"resolveDeath1Prompt",accept:!0};case"prompt_give_card_for_love_1":return{type:"resolveLove1Prompt",accept:!1};case"plague_4_player_flip_optional":{if(o.sourceCardId){const r=he(n,o.sourceCardId);if(r&&!r.card.isFaceUp){const l=r.card;if(l.keywords.flip||l.keywords.shift||l.keywords.draw)return{type:"resolvePlague4Flip",accept:!0}}}return{type:"resolvePlague4Flip",accept:!1}}case"prompt_fire_3_discard":{if(n.opponent.hand.length<=1)return{type:"resolveFire3Prompt",accept:!1};const r=p=>n[p].lanes.map(h=>h.length>0?h[h.length-1]:null).filter(h=>h!==null),l=r("player"),s=r("opponent");let f=-999;return l.forEach(p=>{if(p.isFaceUp){const _=at(p,"player",n)+10;_>f&&(f=_)}}),s.forEach(p=>{if(p.isFaceUp){const _=at(p,"opponent",n)+10;_>f&&(f=_)}else{const h=at(p,"opponent",n),v=-(at({...p,isFaceUp:!0},"opponent",n)-h);v>f&&(f=v)}}),{type:"resolveFire3Prompt",accept:f>5}}case"prompt_shift_for_speed_3":{const r=[];return n.opponent.lanes.forEach((s,f)=>{if(s.length===0)return;const p=s[s.length-1],h=n.opponent.compiled[f];let _=-1/0;for(let m=0;m<3;m++){if(m===f)continue;const v=n.opponent.laneValues[m];if(n.opponent.compiled[m])continue;const x=v+2,C=n.player.laneValues[m];let S=0;h?(S+=1e4,x>=10&&x>C?S+=5e4:x>=8&&(S+=5e3)):x>=10&&x>C?S+=5e4:S=-1e4,S>_&&(_=S)}r.push({card:p,sourceLaneIndex:f,bestScore:_})}),r.length===0?{type:"resolveSpeed3Prompt",accept:!1}:(r.sort((s,f)=>f.bestScore-s.bestScore),{type:"resolveSpeed3Prompt",accept:r[0].bestScore>0})}case"prompt_shift_for_spirit_3":return{type:"resolveSpirit3Prompt",accept:!0};case"prompt_return_for_psychic_4":return{type:"resolvePsychic4Prompt",accept:!0};case"prompt_spirit_1_start":return{type:"resolveSpirit1Prompt",choice:"flip"};case"flip_self_for_water_0":return o.sourceCardId?{type:"flipCard",cardId:o.sourceCardId}:{type:"skip"};case"plague_2_player_discard":return{type:"skip"};case"plague_4_opponent_delete":{const r=[];return n.opponent.lanes.forEach(l=>{if(l.length>0){const s=l[l.length-1];s.isFaceUp||r.push(s)}}),r.length>0?(r.sort((l,s)=>l.value-s.value),{type:"deleteCard",cardId:r[0].id}):{type:"skip"}}case"reveal_opponent_hand":return{type:"skip"};case"prompt_shift_or_flip_for_light_2":{const{revealedCardId:r}=o,l=he(n,r);if(!l)return{type:"skip"};const{card:s,owner:f}=l;let p=0;f==="opponent"?p=it(s,n)+s.value:p=-at(s,"player",n);let h=0,_=-1;for(let m=0;m<n[f].lanes.length;m++)if(n[f].lanes[m].some(v=>v.id===r)){_=m;break}if(_!==-1){const m=[0,1,2].filter(v=>v!==_);if(m.length>0){let v=-1/0;for(const w of m){let x=0;if(f==="opponent"){const C=n.opponent.laneValues[w]+mt(s,[])-n.player.laneValues[w],S=n.opponent.laneValues[_]-n.player.laneValues[_];x=C-S}else{const C=n.player.laneValues[w]+mt(s,[])-n.opponent.laneValues[w];x=n.player.laneValues[_]-n.opponent.laneValues[_]-C}x>v&&(v=x)}h=v}}return p>h&&p>0?{type:"resolveLight2Prompt",choice:"flip"}:h>0?{type:"resolveLight2Prompt",choice:"shift"}:{type:"resolveLight2Prompt",choice:"skip"}}case"select_opponent_covered_card_to_shift":{const r=[];for(let l=0;l<n.player.lanes.length;l++){const s=n.player.lanes[l];for(let f=0;f<s.length-1;f++)r.push({card:s[f],laneIndex:l})}return r.length>0?(r.sort((l,s)=>{const f=n.player.compiled[l.laneIndex],p=n.player.compiled[s.laneIndex];if(f&&!p)return-1;if(!f&&p)return 1;const h=n.player.laneValues[l.laneIndex],_=n.player.laneValues[s.laneIndex];return h!==_?_-h:at(s.card,"player",n)-at(l.card,"player",n)}),{type:"shiftCard",cardId:r[0].card.id}):{type:"skip"}}case"select_own_covered_card_to_shift":{const r=[];for(let l=0;l<n.opponent.lanes.length;l++){const s=n.opponent.lanes[l];for(let f=0;f<s.length-1;f++)r.push({card:s[f],laneIndex:l})}return r.length>0?(r.sort((l,s)=>{const f=n.opponent.compiled[l.laneIndex],p=n.opponent.compiled[s.laneIndex];if(f&&!p)return 1;if(!f&&p)return-1;const h=n.opponent.laneValues[l.laneIndex],_=n.opponent.laneValues[s.laneIndex];return h!==_?h-_:at(l.card,"opponent",n)-at(s.card,"opponent",n)}),{type:"shiftCard",cardId:r[0].card.id}):{type:"skip"}}default:return{type:"skip"}}},O0=(n,o)=>o?U0(n,o):n.phase==="compile"&&n.compilableLanes.length>0?{type:"compile",laneIndex:n.compilableLanes.reduce((i,r)=>{const l=n.opponent.laneValues[i]-n.player.laneValues[i],s=n.opponent.laneValues[r]-n.player.laneValues[r];return n.opponent.compiled.filter(p=>p).length===0,s>l?r:i})}:n.phase==="action"?q0(n):{type:"fillHand"};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Ec=(n,o,c)=>{switch(c){case"normal":return T0(n,o);case"hard":return O0(n,o);default:return A0(n,o)}},$0=(n,o,c,i,r,l,s,f,p)=>{o(h=>{const _=h.actionRequired;if(!_||!((h.turn==="player"||h._interruptedTurn==="player")&&"actor"in _&&_.actor==="opponent"))return h;const w=Ec(h,_,c);if(w.type==="discardCards"&&_.type==="discard"){const C=i.discardCards(h,w.cardIds,"opponent");return C.actionRequired?C:r.processEndOfAction(C)}if(w.type==="resolveHate1Discard"&&_.type==="select_cards_from_hand_to_discard_for_hate_1")return i.resolveHate1Discard(h,w.cardIds);if(w.type==="rearrangeProtocols"&&_.type==="prompt_rearrange_protocols"){p&&_.sourceCardId==="CONTROL_MECHANIC"&&_.actor&&p(_.actor),console.log("[DEBUG aiManager] Before resolveRearrangeProtocols, actor hand:",h[_.actor].hand.length);const C=i.resolveRearrangeProtocols(h,w.newOrder);console.log("[DEBUG aiManager] After resolveRearrangeProtocols, actor hand:",C[_.actor].hand.length);const S=r.processEndOfAction(C);return console.log("[DEBUG aiManager] After processEndOfAction, actor hand:",S[_.actor].hand.length),S}if(_.type==="reveal_opponent_hand"){const C=i.revealOpponentHand(h);return r.processEndOfAction(C)}if(w.type==="resolveSpirit3Prompt"&&_.type==="prompt_shift_for_spirit_3"){const C=i.resolveSpirit3Prompt(h,w.accept);return C.actionRequired&&C.actionRequired.actor==="opponent"?C:r.processEndOfAction(C)}if(w.type==="selectLane"){const{nextState:C,requiresAnimation:S}=f(h,w.laneIndex);return S?(l(S.animationRequests,()=>{o(E=>{const j=S.onCompleteCallback(E,D=>D);return j.actionRequired&&j.actionRequired.actor==="opponent"?j:r.processEndOfAction(j)})}),C):r.processEndOfAction(C)}if(w.type==="deleteCard"||w.type==="flipCard"||w.type==="returnCard"||w.type==="shiftCard"){const{nextState:C,requiresAnimation:S}=s(h,w.cardId);return S?(l(S.animationRequests,()=>{o(E=>{const j=S.onCompleteCallback(E,D=>D);return j.actionRequired&&j.actionRequired.actor==="opponent"?j:r.processEndOfAction(j)})}),C):C.actionRequired&&C.actionRequired.actor==="opponent"?C:r.processEndOfAction(C)}console.warn(`AI has no logic for mandatory action during player turn, clearing it: ${_.type}`);const x={...h,actionRequired:null};return r.processEndOfAction(x)})},L0=(n,o,c,i,r,l,s)=>{const f=Ec(n,n.actionRequired,c),p=n.actionRequired;if(f.type==="skip"){const _=i.skipAction(n);return n.phase==="start"?l.continueTurnAfterStartPhaseAction(_):l.processEndOfAction(_)}if(f.type==="resolveControlMechanicPrompt"&&p.type==="prompt_use_control_mechanic"){const{choice:_}=f,{originalAction:m,actor:v}=p;if(_==="skip"){let w=T(n,v,"Opponent skips rearranging protocols.");if(w.actionRequired=null,m.type==="compile"){const x=m.laneIndex;return setTimeout(()=>{o(C=>{const S=i.compileLane(C,x);return S.winner?S:{...l.processEndOfAction(S),animationState:null}})},1e3),{...w,animationState:{type:"compile",laneIndex:x},compilableLanes:[]}}else if(m.type==="fill_hand"){const x=i.fillHand(w,v);return l.processEndOfAction(x)}else return l.processEndOfAction(w)}else{const w=_;let S=T(n,v,`Opponent chooses to rearrange ${w==="opponent"?"the player's":"their own"} protocols.`);return S.actionRequired={type:"prompt_rearrange_protocols",sourceCardId:"CONTROL_MECHANIC",target:w,actor:v,originalAction:m},S}}if(f.type==="resolveDeath1Prompt"&&p.type==="prompt_death_1_effect"){const _=i.resolveDeath1Prompt(n,f.accept);return _.actionRequired?_:l.continueTurnAfterStartPhaseAction(_)}if(f.type==="resolveLove1Prompt"&&p.type==="prompt_give_card_for_love_1"){const _=i.resolveLove1Prompt(n,f.accept);return _.actionRequired?_:l.processEndOfAction(_)}if(f.type==="resolvePlague2Discard"&&p.type==="plague_2_opponent_discard")return Ih(n,f.cardIds);if(f.type==="resolvePlague4Flip"&&p.type==="plague_4_player_flip_optional")return i.resolvePlague4Flip(n,f.accept,"opponent");if(f.type==="resolveFire3Prompt"&&p.type==="prompt_fire_3_discard"){const _=i.resolveFire3Prompt(n,f.accept);return _.actionRequired?_:l.processEndOfAction(_)}if(f.type==="resolveOptionalDiscardCustomPrompt"&&p.type==="prompt_optional_discard_custom"){const _=i.resolveOptionalDiscardCustomPrompt(n,f.accept);return _.actionRequired?_:l.processEndOfAction(_)}if(f.type==="resolveOptionalEffectPrompt"&&p.type==="prompt_optional_effect"){const _=i.resolveOptionalEffectPrompt(n,f.accept);return _.actionRequired?_:l.processEndOfAction(_)}if(f.type==="resolveSpeed3Prompt"&&p.type==="prompt_shift_for_speed_3"){const _=i.resolveSpeed3Prompt(n,f.accept);return _.actionRequired?_:l.processEndOfAction(_)}if(f.type==="resolvePsychic4Prompt"&&p.type==="prompt_return_for_psychic_4"){const _=i.resolvePsychic4Prompt(n,f.accept);return _.actionRequired?_:l.processEndOfAction(_)}if(f.type==="resolveSpirit1Prompt"&&p.type==="prompt_spirit_1_start"){const _=i.resolveSpirit1Prompt(n,f.choice);return _.actionRequired?_:l.continueTurnAfterStartPhaseAction(_)}if(f.type==="resolveSpirit3Prompt"&&p.type==="prompt_shift_for_spirit_3"){const _=i.resolveSpirit3Prompt(n,f.accept);return _.actionRequired?_:l.processEndOfAction(_)}if(f.type==="resolveSwapProtocols"&&p.type==="prompt_swap_protocols"){const _=i.resolveSwapProtocols(n,f.indices);return l.processEndOfAction(_)}if(f.type==="resolveFire4Discard"&&p.type==="select_cards_from_hand_to_discard_for_fire_4"){const _=i.resolveFire4Discard(n,f.cardIds);return l.processEndOfAction(_)}if(f.type==="resolveHate1Discard"&&p.type==="select_cards_from_hand_to_discard_for_hate_1")return i.resolveHate1Discard(n,f.cardIds);if(f.type==="resolveLight2Prompt"&&p.type==="prompt_shift_or_flip_for_light_2"){const _=i.resolveLight2Prompt(n,f.choice);return _.actionRequired?_:l.processEndOfAction(_)}if(f.type==="rearrangeProtocols"&&p.type==="prompt_rearrange_protocols"){s&&p.sourceCardId==="CONTROL_MECHANIC"&&p.actor&&s(p.actor),console.log("[DEBUG aiManager 2] Before resolveRearrangeProtocols, actor hand:",n[p.actor].hand.length);const _=i.resolveRearrangeProtocols(n,f.newOrder);console.log("[DEBUG aiManager 2] After resolveRearrangeProtocols, actor hand:",_[p.actor].hand.length);const m=l.processEndOfAction(_);return console.log("[DEBUG aiManager 2] After processEndOfAction, actor hand:",m[p.actor].hand.length),m}if(f.type==="selectLane"&&(p.type==="select_lane_for_shift"||p.type==="select_lane_for_death_2"||p.type==="select_lane_for_play"||p.type==="select_lane_for_water_3"||p.type==="select_lane_for_metal_3_delete"||p.type==="select_lane_for_life_3_play"||p.type==="shift_flipped_card_optional"||p.type==="gravity_2_shift_after_flip"||p.type==="select_lane_to_shift_revealed_card_for_light_2"||p.type==="select_lane_to_shift_cards_for_light_3")){const{nextState:_,requiresAnimation:m}=ld(n,f.laneIndex);if(m){const{animationRequests:v,onCompleteCallback:w}=m;return r(v,()=>{o(x=>w(x,C=>n.phase==="start"?l.continueTurnAfterStartPhaseAction(C):l.processEndOfAction(C)))}),_}return l.processEndOfAction(_)}if(f.type==="flipCard"||f.type==="deleteCard"||f.type==="returnCard"||f.type==="shiftCard"){const{nextState:_,requiresAnimation:m,requiresTurnEnd:v}=ad(n,f.cardId);if(m){const{animationRequests:w,onCompleteCallback:x}=m;return r(w,()=>{o(C=>x(C,S=>S.actionRequired?(Jr(S,o,c,i,r,l),S):S.phase==="start"?l.continueTurnAfterStartPhaseAction(S):l.processEndOfAction(S)))}),_}return v?l.processEndOfAction(_):_}if(f.type==="playCard"&&p.type==="select_card_from_hand_to_play"){const{cardId:_,laneIndex:m,isFaceUp:v}=f,{newState:w,animationRequests:x}=i.playCard({...n,actionRequired:null},_,m,v,"opponent"),C={...w,animationState:{type:"playCard",cardId:_,owner:"opponent"}};return setTimeout(()=>{o(S=>{let E={...S,animationState:null};return x&&x.length>0?(r(x,()=>o(j=>l.processEndOfAction(j))),E):E.actionRequired?(Jr(E,o,c,i,r,l),E):l.processEndOfAction(E)})},500),C}if(f.type==="discardCards"&&p.type==="discard"){const _=i.discardCards(n,f.cardIds,"opponent");return _.actionRequired?_:l.processEndOfAction(_)}if(f.type==="giveCard"&&p.type==="select_card_from_hand_to_give"){const _=i.resolveActionWithHandCard(n,f.cardId);return _.actionRequired?_:l.processEndOfAction(_)}if(f.type==="revealCard"&&p.type==="select_card_from_hand_to_reveal")return i.resolveActionWithHandCard(n,f.cardId);console.warn(`AI has no logic for mandatory action, clearing it: ${p.type}`);const h={...n,actionRequired:null};return l.processEndOfAction(h)},Jr=(n,o,c,i,r,l,s)=>{o(f=>{if(f.turn!=="opponent"||f.winner||f.animationState||!["start","compile","action","hand_limit","end"].includes(f.phase))return f;if(f.actionRequired){const _=f.actionRequired;let m=!1;if((_.type==="discard"&&_.actor==="player"||_.type==="plague_4_opponent_delete"&&_.actor==="opponent"||"actor"in _&&_.actor==="player")&&(m=!0),m)return f}let h={...f};if(h.actionRequired&&h.actionRequired.type==="reveal_opponent_hand"){const _=i.revealOpponentHand(h);return l.processEndOfAction(_)}if(h.phase==="start"&&(h=l.processStartOfTurn(h)),h.actionRequired)return L0(h,o,c,i,r,l,s);if(h.phase==="compile"&&h.compilableLanes.length>0){const _=Ec(h,null,c);if(_.type==="compile"){const m=_.laneIndex,v=Hh(h);return v.actionRequired?v:(setTimeout(()=>{o(w=>{const x=i.compileLane(w,m);return x.winner?x:{...l.processEndOfAction(x),animationState:null}})},1e3),{...v,animationState:{type:"compile",laneIndex:m},compilableLanes:[]})}}if(h.phase==="action"){const _=Ec(h,null,c);if(_.type==="fillHand"){const m=Ph(h,"opponent");return m.actionRequired?m:l.processEndOfAction(m)}if(_.type==="playCard"){const{newState:m,animationRequests:v}=i.playCard(h,_.cardId,_.laneIndex,_.isFaceUp,"opponent"),w={...m,animationState:{type:"playCard",cardId:_.cardId,owner:"opponent"}};return setTimeout(()=>{const x=()=>{o(C=>{let S={...C},E={newState:S};if(!S.actionRequired){if(S.queuedEffect){const{card:L,laneIndex:H}=S.queuedEffect,ce={cardOwner:"opponent",actor:"opponent",currentTurn:S.turn,opponent:"player",triggerType:"play"};E=el(L,H,S,ce),E.newState.queuedEffect=void 0}}const j=E.animationRequests,D=E.newState,A=()=>{o(L=>(L.actionRequired?Jr(L,o,c,i,r,l):o(l.processEndOfAction(L)),L))};return j&&j.length>0?(r(j,A),D):(D.actionRequired?Jr(D,o,c,i,r,l):o(l.processEndOfAction(D)),D)})};o(C=>{const S={...C,animationState:null};return v&&v.length>0?r(v,x):x(),S})},500),w}}return l.processEndOfAction(h)})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function M0(n,o){let c=null,i=null;const r=["player","opponent"];for(const _ of r){for(const m of n[_].lanes){const v=m.find(w=>w.id===o);if(v){c=_,i=v;break}}if(c)break}if(!c||!i)return console.error("Card to delete not found on board:",o),n;const l={...n},s={...l[c]};s.lanes=s.lanes.map(_=>_.filter(m=>m.id!==o));const{id:f,isFaceUp:p,...h}=i;return s.discard=[...s.discard,h],l[c]=s,l}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const P0=(n,o,c,i,r,l="player",s)=>{const[f,p]=te.useState(()=>{const ne=Br(n,o,r,l);return Ae(ne)}),[h,_]=te.useState(null),m=te.useRef(!1),v=te.useRef(0);te.useEffect(()=>{f.turn!==l&&f.log.length<=4&&p(ne=>{const X=l==="player"?"Player":"Opponent",re=[...ne.log];return re.length>0&&(re[re.length-1]={player:"player",message:`${X} goes first.`}),{...ne,turn:l,log:re}})},[l,f.turn,f.log.length]);const w=te.useCallback(ne=>{switch(ne){case"start":return Lh;case"end":return Xr;default:return bc}},[]),x=te.useCallback((ne,X)=>{const re=se=>{if(se.length===0){X();return}const[we,...Ee]=se;p(xe=>({...xe,animationState:{type:"deleteCard",cardId:we.cardId,owner:we.owner}})),setTimeout(()=>{p(xe=>{const be=xe[we.owner].lanes.findIndex(Be=>Be.some(gt=>gt.id===we.cardId)),rt=be!==-1&&xe[we.owner].lanes[be].length>0&&xe[we.owner].lanes[be][xe[we.owner].lanes[be].length-1].id===we.cardId;let ve=M0(xe,we.cardId);return ve=Ae(ve),rt&&be!==-1&&(ve=kn(ve,we.owner,be).newState),{...ve,animationState:null}}),setTimeout(()=>{Ee.length>0?re(Ee):X()},10)},500)};re(ne)},[]),C=(ne,X)=>{if(!h||f.turn!=="player"||f.phase!=="action")return;const re=h;_(null),p(se=>{const we=w(se.phase),{newState:Ee,animationRequests:xe}=rd(se,re,ne,X,"player"),be={...Ee,animationState:{type:"playCard",cardId:re,owner:"player"}};return setTimeout(()=>{p(rt=>{let ve={...rt,animationState:null};return xe&&xe.length>0?(x(xe,()=>{p(Be=>we(Be))}),ve):ve.actionRequired?ve:we(ve)})},500),be})},S=()=>{f.turn!=="player"||f.phase!=="action"||f.actionRequired||p(ne=>{const X=w(ne.phase),re=Ph(ne,"player");return re.actionRequired?re:X(re)})},E=te.useCallback(ne=>{p(X=>{var re;return((re=X.actionRequired)==null?void 0:re.type)!=="discard"||X.actionRequired.actor!=="player"?X:{...X,animationState:{type:"discardCard",owner:"player",cardIds:[ne],originalAction:X.actionRequired}}})},[]),j=te.useCallback(ne=>{p(X=>{if(X.winner||X.phase!=="compile")return X;const re=w(X.phase),we={...Hh(X),animationState:{type:"compile",laneIndex:ne},compilableLanes:[]};return setTimeout(()=>{p(Ee=>{var ve;const xe=Wr(Ee,ne,c);if(xe.winner)return xe;if(((ve=xe.actionRequired)==null?void 0:ve.type)==="prompt_use_control_mechanic")return{...xe,animationState:null};const be=xe._compileAnimations;if(be&&be.length>0){x(be,()=>{p(gt=>{const ft={...gt};return delete ft._compileAnimations,{...re(ft),animationState:null}})});const Be={...xe};return delete Be._compileAnimations,Be}return{...re(xe),animationState:null}})},1e3),we})},[c,w]),D=ne=>{p(X=>{const re=w(X.phase),{nextState:se,requiresAnimation:we,requiresTurnEnd:Ee}=ad(X,ne);return we?(x(we.animationRequests,()=>{p(xe=>we.onCompleteCallback(xe,re))}),se):se.actionRequired?se:re(se)})},A=ne=>{p(X=>{const re=w(X.phase),{nextState:se,requiresAnimation:we}=ld(X,ne);return we?(x(we.animationRequests,()=>{p(Ee=>we.onCompleteCallback(Ee,re))}),se):se.actionRequired?se:re(se)})},L=ne=>{p(X=>{const re=w(X.phase),se=td(X,ne);return se.actionRequired?se:re(se)})},H=ne=>{p(X=>b0(X,ne))},ce=()=>{p(ne=>{var se,we;const X=w(ne.phase);let re={...ne,animationState:null};return((se=re.actionRequired)==null?void 0:se.type)==="prompt_shift_or_flip_for_light_2"?re=Xi(re,"skip"):re=yh(re),((we=re.actionRequired)==null?void 0:we.type)==="plague_4_player_flip_optional"?re:X(re)})},B=te.useCallback(ne=>{p(X=>{var we;if(((we=X.actionRequired)==null?void 0:we.type)!=="prompt_use_control_mechanic")return X;const{originalAction:re,actor:se}=X.actionRequired;if(ne==="skip"){let Ee=T(X,se,"Player skips rearranging protocols.");if(Ee.actionRequired=null,re.type==="compile"){const be={...Ee,animationState:{type:"compile",laneIndex:re.laneIndex},compilableLanes:[]};return setTimeout(()=>{p(rt=>{const ve=Wr(rt,re.laneIndex,c);return ve.winner?ve:{...w(ve.phase)(ve),animationState:null}})},1e3),be}else if(re.type==="continue_turn"){let xe={...Ee};return re.queuedSpeed2Actions&&re.queuedSpeed2Actions.length>0&&(xe.queuedActions=[...re.queuedSpeed2Actions,...xe.queuedActions||[]]),w(xe.phase)(xe)}else if(re.type==="resume_interrupted_turn"){let xe={...Ee};return xe._interruptedTurn=re.interruptedTurn,xe._interruptedPhase=re.interruptedPhase,re.queuedSpeed2Actions&&re.queuedSpeed2Actions.length>0&&(xe.queuedActions=[...re.queuedSpeed2Actions,...xe.queuedActions||[]]),bc(xe)}else{const xe=Zr(Ee,se);return w(xe.phase)(xe)}}else{const Ee=ne;let rt=T(X,se,`${se==="player"?"Player":"Opponent"} chooses to rearrange ${Ee==="player"?"their own":"the opponent's"} protocols.`);return rt.actionRequired={type:"prompt_rearrange_protocols",sourceCardId:"CONTROL_MECHANIC",target:Ee,actor:se,originalAction:re},rt}})},[c,w]),z=te.useCallback(ne=>{p(X=>{const re=w(X.phase),se=vh(X,ne);return se.actionRequired?se:re(se)})},[w]),V=te.useCallback(ne=>{p(X=>{const re=w(X.phase),se=wh(X,ne);return se.actionRequired?se:re(se)})},[w]),le=te.useCallback(ne=>{p(X=>{const re=w(X.phase),se=Qi(X,ne);return ne?se:re(se)})},[w]),G=te.useCallback(ne=>{p(X=>{var re;return((re=X.actionRequired)==null?void 0:re.type)!=="plague_2_player_discard"?X:{...X,animationState:{type:"discardCard",owner:"player",cardIds:ne,originalAction:X.actionRequired}}})},[]),P=te.useCallback(ne=>{p(X=>{const re=w(X.phase),se=xh(X,ne,"player");return re(se)})},[w]),q=te.useCallback(ne=>{p(X=>{const re=w(X.phase),se=Ch(X,ne);return ne?se:re(se)})},[w]),N=te.useCallback(ne=>{p(X=>{const re=w(X.phase),se=Sh(X,ne);return ne?se:re(se)})},[w]),k=te.useCallback(ne=>{p(X=>{const re=w(X.phase),se=E0(X,ne);return ne?se:re(se)})},[w]),W=te.useCallback(ne=>{p(X=>{const re=w(X.phase),se=bh(X,ne);return ne?se:re(se)})},[w]),ee=te.useCallback(ne=>{p(X=>{var we,Ee,xe;const re=((we=X.actionRequired)==null?void 0:we.type)==="select_cards_from_hand_to_discard_for_fire_4",se=((Ee=X.actionRequired)==null?void 0:Ee.type)==="discard"&&((xe=X.actionRequired)==null?void 0:xe.variableCount);return!re&&!se?X:{...X,animationState:{type:"discardCard",owner:"player",cardIds:ne,originalAction:X.actionRequired}}})},[]),ge=te.useCallback(ne=>{p(X=>{var re;return((re=X.actionRequired)==null?void 0:re.type)!=="select_cards_from_hand_to_discard_for_hate_1"?X:{...X,animationState:{type:"discardCard",owner:"player",cardIds:ne,originalAction:X.actionRequired}}})},[]),F=te.useCallback(ne=>{p(X=>{const re=w(X.phase),se=Xi(X,ne);return se.actionRequired?se:re(se)})},[w]),O=te.useCallback(ne=>{p(X=>{var Ee,xe;s&&((Ee=X.actionRequired)==null?void 0:Ee.sourceCardId)==="CONTROL_MECHANIC"&&((xe=X.actionRequired)!=null&&xe.actor)&&s(X.actionRequired.actor);const re=w(X.phase);console.log("[DEBUG useGameState resolveRearrangeProtocols] Before resolvers.resolveRearrangeProtocols, hand:",X.opponent.hand.length);const se=Zi(X,ne,c);if(console.log("[DEBUG useGameState resolveRearrangeProtocols] After resolvers.resolveRearrangeProtocols, hand:",se.opponent.hand.length),se.winner)return se;const we=re(se);return console.log("[DEBUG useGameState resolveRearrangeProtocols] After turnProgressionCb, hand:",we.opponent.hand.length),we})},[w,c,s]),K=te.useCallback(ne=>{p(X=>{const re=w(X.phase),se=Ki(X,ne);return ne?se:re(se)})},[w]),U=te.useCallback(ne=>{p(X=>{const re=w(X.phase),se=Ji(X,ne);return se.actionRequired?se:re(se)})},[w]),Q=te.useCallback(ne=>{p(X=>{const re=w(X.phase),se=ed(X,ne);return se.actionRequired?se:re(se)})},[w]),ye=te.useCallback(ne=>{p(X=>{const re=w(X.phase),se=Eh(X,ne,c);return se.winner?se:re(se)})},[w,c]),fe=te.useCallback(ne=>{m.current=!1,v.current++,p(X=>{if(typeof ne=="function")return ne(X);const re=ne;if(re==="speed-0-interrupt"){const se=["Speed","Life","Water"],we=["Metal","Death","Hate"];let Ee=On(so(se)),xe=On(so(we));const be=(lt,St,vn)=>{const rn=lt.findIndex(ct=>ct.protocol===St&&ct.value===vn);return rn>-1?lt.splice(rn,1)[0]:_t.find(ct=>ct.protocol===St&&ct.value===vn)},rt=be(Ee,"Speed",0),ve=be(xe,"Metal",0),Be=be(Ee,"Speed",1),gt=be(Ee,"Life",1),ft=be(Ee,"Water",1),Rt=be(Ee,"Speed",3);let je=Br(se,we,r,l);return je.player.lanes=[[],[],[]],je.player.lanes[0]=[{...rt,id:He(),isFaceUp:!1}],je.player.hand=[{...Be,id:He(),isFaceUp:!0},{...gt,id:He(),isFaceUp:!0},{...ft,id:He(),isFaceUp:!0},{...Rt,id:He(),isFaceUp:!0}],je.player.deck=Ee,je.player.discard=[],je.opponent.lanes=[[],[],[]],je.opponent.hand=[{...ve,id:He(),isFaceUp:!0}],je.opponent.deck=xe,je.opponent.discard=[],je.turn="opponent",je.phase="start",je.actionRequired=null,je.queuedActions=[],je=Ae(je),je=T(je,"player","DEBUG: Dynamic Speed-0 interrupt scenario set up. AI will play Metal-0."),je}else if(re==="speed-1-trigger"){const se=["Speed","Life","Water"],we=["Metal","Death","Hate"];let Ee=On(so(se));const xe=On(so(we)),rt=((ft,Rt,je)=>{const lt=ft.findIndex(St=>St.protocol===Rt&&St.value===je);return lt>-1?ft.splice(lt,1)[0]:_t.find(St=>St.protocol===Rt&&St.value===je)})(Ee,"Speed",1);let ve=Br(se,we,r,l);ve.player.lanes=[[],[],[]],ve.player.lanes[0]=[{...rt,id:He(),isFaceUp:!0}];const{drawnCards:Be,remainingDeck:gt}=uo(Ee,[],6);return ve.player.hand=Be.map(ft=>({...ft,id:He(),isFaceUp:!0})),ve.player.deck=gt,ve.player.discard=[],ve.opponent.lanes=[[],[],[]],ve.opponent.hand=[],ve.opponent.deck=xe,ve.opponent.discard=[],ve.turn="player",ve.phase="hand_limit",ve.actionRequired={type:"discard",actor:"player",count:1},ve.queuedActions=[],ve=Ae(ve),ve=T(ve,"player","DEBUG: Speed-1 discard trigger scenario set up."),ve}else if(re==="fire-oncover-test"){const se=["Death","Hate","Water"],we=["Fire","Plague","Metal"],Ee=On(so(se));let xe=On(so(we));const be=(lt,St,vn)=>{const rn=lt.findIndex(ct=>ct.protocol===St&&ct.value===vn);return rn>-1?lt.splice(rn,1)[0]:_t.find(ct=>ct.protocol===St&&ct.value===vn)},rt=be(xe,"Fire",0),ve=be(xe,"Fire",2),Be=be(xe,"Fire",3),gt=_t.find(lt=>lt.protocol==="Death"&&lt.value===1),ft=_t.find(lt=>lt.protocol==="Hate"&&lt.value===2),Rt=_t.find(lt=>lt.protocol==="Water"&&lt.value===3);let je=Br(se,we,r,"opponent");return je.player.lanes=[[{...gt,id:He(),isFaceUp:!0}],[{...ft,id:He(),isFaceUp:!0}],[{...Rt,id:He(),isFaceUp:!0}]],je.player.hand=[],je.player.deck=Ee,je.player.discard=[],je.opponent.lanes=[[{...rt,id:He(),isFaceUp:!0}],[],[]],je.opponent.hand=[{...Be,id:He(),isFaceUp:!0},{...ve,id:He(),isFaceUp:!0}],je.opponent.deck=xe,je.opponent.discard=[],je.turn="opponent",je.phase="action",je.actionRequired=null,je.queuedActions=[],je=Ae(je),je=T(je,"opponent","DEBUG: Fire On-Cover test scenario. Opponent has Fire-0 in play, Fire-3 and Fire-2 in hand. Ready to play Fire-3."),je}else if(re==="speed-2-control-test"){const se=["Speed","Light","Water"],we=["Fire","Plague","Metal"],Ee=On(so(se)),xe=On(so(we)),rt=((Be,gt,ft)=>{const Rt=Be.findIndex(je=>je.protocol===gt&&je.value===ft);return Rt>-1?Be.splice(Rt,1)[0]:_t.find(je=>je.protocol===gt&&je.value===ft)})(Ee,"Speed",2);let ve=Br(se,we,!0,"player");return ve.player.lanes=[[{...rt,id:He(),isFaceUp:!0}],[],[]],ve.player.protocols[0]="Speed",ve.player.laneValues[0]=10,ve.player.hand=[],ve.player.deck=Ee,ve.player.discard=[],ve.controlCardHolder="player",ve.opponent.lanes=[[],[],[]],ve.opponent.hand=[],ve.opponent.deck=xe,ve.opponent.discard=[],ve.turn="player",ve.phase="compile",ve.compilableLanes=[0],ve.actionRequired=null,ve.queuedActions=[],ve=Ae(ve),ve=T(ve,"player","DEBUG: Speed-2 + Control test scenario. Player has Speed-2 (value 10), Control Component active. Ready to compile Protocol Speed!"),ve}return X})},[r]);return te.useEffect(()=>{const ne=f.animationState;if(!ne)return;let X=0,re=!1;if(ne.type==="flipCard"?(X=600,re=!0):ne.type==="drawCard"?(X=1e3,re=!0):ne.type==="discardCard"&&(X=800,re=!0),re){const se=setTimeout(()=>{p(we=>({...we,animationState:null}))},X);return()=>clearTimeout(se)}},[f.animationState]),te.useEffect(()=>{const ne=f.animationState;if((ne==null?void 0:ne.type)==="discardCard"&&ne.owner==="player"){const X=setTimeout(()=>{p(re=>{const se=re.animationState;if((se==null?void 0:se.type)!=="discardCard"||!se.originalAction)return re;const{cardIds:we,originalAction:Ee}=se,xe=w(re.phase);let be;return Ee.type==="plague_2_player_discard"?be=S0(re,we):Ee.type==="select_cards_from_hand_to_discard_for_fire_4"?be=hh(re,we):Ee.type==="select_cards_from_hand_to_discard_for_hate_1"?be=Wi(re,we):be=la(re,we,"player"),be.animationState=null,be.actionRequired?be:xe(be)})},500);return()=>clearTimeout(X)}},[f.animationState,w]),te.useEffect(()=>{if(f.turn==="opponent"&&!f.winner&&!f.animationState&&!m.current){m.current=!0;const ne=v.current,X=setTimeout(()=>{if(v.current!==ne){console.log("[AI Hook 1] Scenario changed, aborting stale callback");return}Jr(f,p,i,{compileLane:(re,se)=>Wr(re,se,c),playCard:rd,fillHand:Zr,discardCards:la,flipCard:mh,deleteCard:(re,se)=>({newState:re,animationRequests:[{type:"delete",cardId:se,owner:"opponent"}]}),returnCard:gh,skipAction:yh,resolveOptionalDrawPrompt:vh,resolveDeath1Prompt:wh,resolveLove1Prompt:Qi,resolvePlague4Flip:(re,se)=>xh(re,se,"opponent"),resolvePlague2Discard:Ih,resolveFire3Prompt:Ch,resolveOptionalDiscardCustomPrompt:Sh,resolveSpeed3Prompt:bh,resolveFire4Discard:hh,resolveHate1Discard:Wi,resolveLight2Prompt:Xi,resolveRearrangeProtocols:(re,se)=>Zi(re,se,c),resolveActionWithHandCard:td,resolvePsychic4Prompt:Ki,resolveSpirit1Prompt:Ji,resolveSpirit3Prompt:ed,resolveSwapProtocols:(re,se)=>Eh(re,se,c),revealOpponentHand:_h},x,uh,s)},1500);return()=>{clearTimeout(X),m.current=!1}}},[f.turn,f.winner,f.animationState,i,c,x,f.actionRequired]),te.useEffect(()=>{const ne=f.actionRequired,X=f.turn==="player"||f._interruptedTurn==="player",re=ne&&"actor"in ne&&ne.actor==="opponent";if(X&&!f.animationState&&re&&!m.current){m.current=!0;const we=v.current,Ee=setTimeout(()=>{if(v.current!==we){console.log("[AI Hook 2] Scenario changed, aborting stale callback");return}$0(f,p,i,{discardCards:la,flipCard:mh,returnCard:gh,deleteCard:(xe,be)=>({newState:xe,animationRequests:[{type:"delete",cardId:be,owner:"opponent"}]}),resolveActionWithHandCard:td,resolveLove1Prompt:Qi,resolveHate1Discard:Wi,revealOpponentHand:_h,resolveRearrangeProtocols:(xe,be)=>Zi(xe,be,c),resolveSpirit3Prompt:ed,resolveSpirit1Prompt:Ji,resolvePsychic4Prompt:Ki},uh,x,ad,ld,s)},1400);return()=>{clearTimeout(Ee),m.current=!1}}},[f.actionRequired,f.turn,f.animationState,i,x,c]),te.useEffect(()=>{p(ne=>ne.turn==="player"&&ne.phase==="start"&&!ne.actionRequired?Mh(ne):ne)},[f.turn,f.phase]),{gameState:f,selectedCard:h,setSelectedCard:_,playSelectedCard:C,fillHand:S,discardCardFromHand:E,compileLane:j,resolveActionWithCard:D,resolveActionWithLane:A,selectHandCardForAction:H,skipAction:ce,resolvePlague2Discard:G,resolveActionWithHandCard:L,resolvePlague4Flip:P,resolveFire3Prompt:q,resolveOptionalDiscardCustomPrompt:N,resolveOptionalEffectPrompt:k,resolveFire4Discard:ee,resolveHate1Discard:ge,resolveLight2Prompt:F,resolveRearrangeProtocols:O,resolveSpeed3Prompt:W,resolveOptionalDrawPrompt:z,resolveDeath1Prompt:V,resolveLove1Prompt:le,resolvePsychic4Prompt:K,resolveSpirit1Prompt:U,resolveSpirit3Prompt:Q,resolveSwapProtocols:ye,resolveControlMechanicPrompt:B,setupTestScenario:fe}},jh=({cards:n,isPlayable:o,isCompilable:c,isShiftTarget:i,isEffectTarget:r,isMatching:l,onLanePointerDown:s,onPlayFaceDown:f,onCardPointerDown:p,onCardPointerEnter:h,onCardPointerLeave:_,owner:m,animationState:v,isCardTargetable:w,laneIndex:x,sourceCardId:C,gameState:S})=>{const E=["lane"];return o&&E.push("playable"),l&&E.push("matching-protocol"),c&&E.push("compilable"),i&&E.push("shift-target"),r&&E.push("effect-target"),u.jsxs("div",{className:E.join(" "),onPointerDown:s,children:[o&&l&&m==="player"&&f&&u.jsx("button",{className:"btn btn-play-facedown",onPointerDown:j=>{j.stopPropagation(),f()},children:"Play Face-Down"}),u.jsx("div",{className:"lane-stack",children:n.map((j,D)=>{var H;const A=((H=S.actionRequired)==null?void 0:H.type)==="prompt_shift_or_flip_for_light_2"&&S.actionRequired.revealedCardId===j.id,L=mt(j,n,S,x,m);return u.jsx(an,{card:j,isFaceUp:j.isFaceUp||A,style:{"--i":D},onPointerDown:ce=>{ce.stopPropagation(),p(j)},onPointerEnter:()=>h(j),animationState:v,isTargetable:w(j),isSourceOfEffect:j.id===C,faceDownValue:L},j.id)})})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const on=(n,o)=>{const c=n.player.lanes[o].some(r=>r.isFaceUp&&r.protocol==="Frost"&&r.value===3),i=n.opponent.lanes[o].some(r=>r.isFaceUp&&r.protocol==="Frost"&&r.value===3);return c||i},jc=(n,o)=>{var f;const{actionRequired:c}=o;if(!c||"actor"in c&&c.actor!=="player")return!1;let i=null,r=-1,l=[];for(const p of["player","opponent"]){for(let h=0;h<o[p].lanes.length;h++)if(o[p].lanes[h].some(_=>_.id===n.id)){i=p,r=h,l=o[p].lanes[h];break}if(i)break}if(!i)return!1;const s=n.id===((f=l[l.length-1])==null?void 0:f.id);switch(c.type){case"select_opponent_face_up_card_to_flip":return i==="opponent"&&n.isFaceUp&&s;case"select_card_to_flip":{const p=c.targetFilter||{},h=l.findIndex(m=>m.id===n.id),_=p.position||"uncovered";return!(_==="uncovered"&&!s||_==="covered"&&h>=l.length-1||p.owner==="own"&&i!==c.actor||p.owner==="opponent"&&i===c.actor||p.faceState==="face_up"&&!n.isFaceUp||p.faceState==="face_down"&&n.isFaceUp||p.excludeSelf&&n.id===c.sourceCardId)}case"select_own_face_up_covered_card_to_flip":{const p=l.findIndex(h=>h.id===n.id);return i==="player"&&n.isFaceUp&&p<l.length-1}case"select_opponent_covered_card_to_shift":{const p=l.findIndex(_=>_.id===n.id),h=o.turn==="player"?"opponent":"player";return on(o,r)?!1:i===h&&p<l.length-1}case"select_own_covered_card_to_shift":{const p=l.findIndex(h=>h.id===n.id);return on(o,r)?!1:i===c.actor&&p<l.length-1}case"select_covered_card_in_line_to_flip_optional":{const p=l.findIndex(h=>h.id===n.id);return r===c.laneIndex&&p<l.length-1}case"select_covered_card_to_flip_for_chaos_0":{const p=l.findIndex(h=>h.id===n.id);return r===c.laneIndex&&p<l.length-1}case"shift_flipped_card_optional":return on(o,r)?!1:n.id===c.cardId;case"select_opponent_card_to_flip":return i==="opponent"&&s;case"select_face_down_card_to_shift_for_darkness_4":return on(o,r)?!1:!n.isFaceUp&&s;case"select_cards_to_delete":{if(c.disallowedIds.includes(n.id))return!1;const p=c.targetFilter;if(p){const h=l.findIndex(v=>v.id===n.id),_=p.position||"uncovered";if(_==="uncovered"&&!s||_==="covered"&&h>=l.length-1||p.faceState==="face_up"&&!n.isFaceUp||p.faceState==="face_down"&&n.isFaceUp)return!1;if(p.valueRange){const{min:v,max:w}=p.valueRange;if(n.value<v||n.value>w)return!1}if(p.owner==="own"&&i!==c.actor||p.owner==="opponent"&&i===c.actor)return!1;const m=c.protocolMatching;if(m){const v=o.player.protocols[r],w=o.opponent.protocols[r],x=n.protocol,C=x===v||x===w;if(m==="must_match"&&!C||m==="must_not_match"&&C)return!1}return!0}return s}case"select_card_to_delete_for_death_1":return n.id!==c.sourceCardId&&s;case"select_face_down_card_to_delete":return!n.isFaceUp&&s;case"select_low_value_card_to_delete":return n.isFaceUp&&(n.value===0||n.value===1)&&s;case"select_card_from_other_lanes_to_delete":{const{disallowedLaneIndex:p,lanesSelected:h}=c;return r!==p&&!h.includes(r)&&s}case"plague_4_opponent_delete":return(o.turn==="player"?"opponent":"player")==="player"?i==="player"&&!n.isFaceUp&&s:!1;case"select_any_other_card_to_flip":return n.id!==c.sourceCardId&&s;case"select_card_to_return":{const p=c.targetOwner||"any",h=c.actor;return p==="own"?i===h&&s:p==="opponent"?i!==h&&s:s}case"select_card_to_flip_for_fire_3":return s;case"select_card_to_shift_for_gravity_1":return on(o,r)?!1:s;case"select_card_to_flip_and_shift_for_gravity_2":return on(o,r)?!1:s;case"select_face_down_card_to_shift_for_gravity_4":return on(o,r)?!1:!n.isFaceUp&&r!==c.targetLaneIndex&&s;case"select_any_card_to_flip":case"select_any_card_to_flip_optional":return s;case"select_any_face_down_card_to_flip_optional":return!n.isFaceUp&&s;case"select_card_to_flip_for_light_0":return s;case"select_face_down_card_to_reveal_for_light_2":return!n.isFaceUp&&s;case"select_any_other_card_to_flip_for_water_0":return n.id!==c.sourceCardId&&s;case"select_own_card_to_return_for_water_4":return i===c.actor&&s;case"select_own_other_card_to_shift":return on(o,r)?!1:i===c.actor&&n.id!==c.sourceCardId&&s;case"select_own_card_to_shift_for_speed_3":return on(o,r)?!1:i===c.actor&&s;case"select_opponent_face_down_card_to_shift":return on(o,r)?!1:i!==c.actor&&!n.isFaceUp&&s;case"select_any_opponent_card_to_shift":return on(o,r)?!1:i!==c.actor&&s;case"select_opponent_card_to_return":return i==="opponent"&&s;case"select_own_highest_card_to_delete_for_hate_2":return s?Sc(o,c.actor).some(h=>h.card.id===n.id):!1;case"select_opponent_highest_card_to_delete_for_hate_2":{if(!s)return!1;const p=c.actor==="player"?"opponent":"player";return Sc(o,p).some(_=>_.card.id===n.id)}case"select_card_to_delete_for_anarchy_2":{const p=o.player.protocols[r],h=o.opponent.protocols[r],_=n.protocol;return _===p||_===h}case"select_card_to_shift_for_anarchy_1":return on(o,r)?!1:s;case"select_card_to_shift_for_anarchy_0":return on(o,r)?!1:s;case"select_card_to_shift":{if(on(o,r))return!1;const p=c.targetFilter||{},h=c.destinationRestriction;if((h==null?void 0:h.type)==="non_matching_protocol"&&!n.isFaceUp)return!1;const _=l.findIndex(m=>m.id===n.id);return!(p.position==="uncovered"&&!s||p.position==="covered"&&_>=l.length-1||p.owner==="own"&&i!==c.actor||p.owner==="opponent"&&i===c.actor||p.faceState==="face_up"&&!n.isFaceUp||p.faceState==="face_down"&&n.isFaceUp||p.excludeSelf&&n.id===c.sourceCardId)}default:return!1}},I0=({gameState:n,onLanePointerDown:o,onPlayFaceDown:c,onCardPointerDown:i,onCardPointerEnter:r,onCardPointerLeave:l,onOpponentHandCardPointerEnter:s,onOpponentHandCardPointerLeave:f,selectedCardId:p,sourceCardId:h})=>{const{player:_,opponent:m,animationState:v,phase:w,turn:x,compilableLanes:C,actionRequired:S,controlCardHolder:E}=n,j=z=>{const V=w==="compile"&&x==="player"&&!S&&C.includes(z),le=x==="player",G=w==="action"&&!S&&p,P=(S==null?void 0:S.type)==="select_lane_for_play";if(!le||!G&&!P)return{isPlayable:!1,isMatching:!1,isCompilable:V};let q;if(G?q=_.hand.find(Q=>Q.id===p):P&&(q=_.hand.find(Q=>Q.id===S.cardInHandId)),!q)return{isPlayable:!1,isMatching:!1,isCompilable:V};if(P&&z===S.disallowedLaneIndex)return{isPlayable:!1,isMatching:!1,isCompilable:V};const N=m.lanes[z];if(N.length>0&&N[N.length-1].isFaceUp&&N[N.length-1].protocol==="Plague"&&N[N.length-1].value===0)return{isPlayable:!1,isMatching:!1,isCompilable:V};const W=m.lanes.flat().some(Q=>Q.isFaceUp&&Q.protocol==="Psychic"&&Q.value===1),ee=_.lanes.flat().some(Q=>Q.isFaceUp&&Q.protocol==="Spirit"&&Q.value===1),ge=_.lanes.some(Q=>{if(Q.length===0)return!1;const ye=Q[Q.length-1];return ye.isFaceUp&&ye.protocol==="Chaos"&&ye.value===3}),F=[..._.lanes.flat(),...m.lanes.flat()].some(Q=>Q.isFaceUp&&Q.protocol==="Anarchy"&&Q.value===1),O=ud(n);let K;return F||O?K=q.protocol!==_.protocols[z]&&q.protocol!==m.protocols[z]&&!W:K=(ee||ge||q.protocol===_.protocols[z]||q.protocol===m.protocols[z])&&!W,N.some(Q=>Q.isFaceUp&&Q.protocol==="Metal"&&Q.value===2)&&!K?{isPlayable:!1,isMatching:!1,isCompilable:V}:P&&(S.isFaceDown||S.faceDown)?{isPlayable:!0,isMatching:!1,isCompilable:V}:{isPlayable:!0,isMatching:K,isCompilable:V}},D=z=>{if(!S||S.actor!=="player")return!1;switch(S.type){case"select_lane_for_delete":case"select_lane_for_death_2":case"select_lane_for_water_3":return!0;case"select_lane_for_metal_3_delete":return z===S.disallowedLaneIndex?!1:_.lanes[z].length+m.lanes[z].length>=8;default:return!1}},A=(z,V)=>{if(!S||S.actor!=="player"||n.player.lanes[z].some(G=>G.isFaceUp&&G.protocol==="Frost"&&G.value===3)||n.opponent.lanes[z].some(G=>G.isFaceUp&&G.protocol==="Frost"&&G.value===3))return!1;switch(S.type){case"select_lane_for_shift":{if(V!==S.cardOwner||z===S.originalLaneIndex)return!1;const G=[...n.player.lanes.flat(),...n.opponent.lanes.flat()].find(P=>P.id===S.sourceCardId);if(G&&G.protocol==="Gravity"&&G.value===1){let P=-1;for(const q of["player","opponent"]){for(let N=0;N<n[q].lanes.length;N++)if(n[q].lanes[N].some(k=>k.id===S.sourceCardId)){P=N;break}if(P!==-1)break}if(P!==-1&&!(S.originalLaneIndex===P)&&!(z===P))return!1}return!0}case"shift_flipped_card_optional":{if(V!=="opponent")return!1;const P=S.cardId;let q=-1;for(let N=0;N<m.lanes.length;N++)if(m.lanes[N].some(k=>k.id===P)){q=N;break}return z!==q}case"select_lane_for_life_3_play":return V==="player"&&z!==S.disallowedLaneIndex;case"select_lane_to_shift_revealed_card_for_light_2":return V==="player";case"select_lane_to_shift_cards_for_light_3":return z!==S.sourceLaneIndex;default:return!1}},L=(z,V,le)=>{let G=[z];return V&&G.push("compiled"),(v==null?void 0:v.type)==="compile"&&v.laneIndex===le&&G.push("is-compiling"),G.join(" ")},H=()=>E==="player"?"player-controlled":E==="opponent"?"opponent-controlled":"neutral",ce=()=>E==="player"?"Player has control.":E==="opponent"?"Opponent has control.":"Control is neutral.",B=()=>E==="player"?"Control Player":E==="opponent"?"Control Opponent":"Control Neutral";return u.jsxs("div",{className:"game-board",children:[u.jsx("div",{className:"opponent-hand-area",children:m.hand.map(z=>u.jsx(an,{card:z,isFaceUp:z.isRevealed||!1,additionalClassName:"in-hand",onPointerEnter:()=>s(z)},z.id))}),u.jsx("div",{className:`player-side opponent-side ${x==="opponent"?"active-turn":""}`,children:u.jsx("div",{className:"lanes",children:m.lanes.map((z,V)=>u.jsx(jh,{cards:z,isPlayable:!1,isCompilable:!1,isShiftTarget:A(V,"opponent"),isEffectTarget:D(V),onLanePointerDown:()=>o(V),onCardPointerDown:le=>i(le,"opponent",V),onCardPointerEnter:le=>r(le,"opponent"),onCardPointerLeave:()=>l(),owner:"opponent",animationState:v,isCardTargetable:le=>jc(le,n),laneIndex:V,sourceCardId:h,gameState:n},`opp-lane-${V}`))})}),u.jsxs("div",{className:"protocol-bars-container",children:[n.useControlMechanic&&u.jsxs("div",{className:"control-coin-container",children:[u.jsx("div",{className:`control-coin ${H()}`,title:ce(),children:"C"}),u.jsx("div",{className:`control-coin-label ${H()}`,children:B()})]}),u.jsx("div",{className:`protocol-bar opponent-bar ${x==="opponent"?"active-turn":""}`,children:m.protocols.map((z,V)=>u.jsxs("div",{className:L("protocol-display",m.compiled[V],V),children:[u.jsx("span",{className:"protocol-name",children:z}),u.jsx("span",{className:"protocol-value",children:m.laneValues[V]})]},`opp-proto-${z}-${V}`))}),u.jsx("div",{className:`protocol-bar player-bar ${x==="player"?"active-turn":""}`,children:_.protocols.map((z,V)=>u.jsxs("div",{className:L("protocol-display",_.compiled[V],V),children:[u.jsx("span",{className:"protocol-name",children:z}),u.jsx("span",{className:"protocol-value",children:_.laneValues[V]})]},`player-proto-${z}-${V}`))})]}),u.jsx("div",{className:`player-side ${x==="player"?"active-turn":""}`,children:u.jsx("div",{className:"lanes",children:_.lanes.map((z,V)=>{const{isPlayable:le,isMatching:G,isCompilable:P}=j(V);return u.jsx(jh,{cards:z,isPlayable:le,isMatching:G,isCompilable:P,isShiftTarget:A(V,"player"),isEffectTarget:D(V),onLanePointerDown:()=>o(V),onPlayFaceDown:()=>c(V),onCardPointerDown:q=>i(q,"player",V),onCardPointerEnter:q=>r(q,"player"),onCardPointerLeave:()=>l(),owner:"player",animationState:v,isCardTargetable:q=>jc(q,n),laneIndex:V,sourceCardId:h,gameState:n},`player-lane-${V}`)})})})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const H0=({gameState:n,onFillHand:o,onSkipAction:c,onResolvePlague2Discard:i,onResolvePlague4Flip:r,onResolveFire3Prompt:l,onResolveOptionalDiscardCustomPrompt:s,onResolveOptionalEffectPrompt:f,onResolveSpeed3Prompt:p,onResolveFire4Discard:h,onResolveHate1Discard:_,onResolveLight2Prompt:m,onResolveOptionalDrawPrompt:v,onResolveDeath1Prompt:w,onResolveLove1Prompt:x,onResolvePsychic4Prompt:C,onResolveSpirit1Prompt:S,onResolveSpirit3Prompt:E,onResolveControlMechanicPrompt:j,selectedCardId:D,multiSelectedCardIds:A,actionRequiredClass:L})=>{const{phase:H,turn:ce,actionRequired:B,player:z,compilableLanes:V}=n,le=W=>{for(const ee of["player","opponent"])for(const ge of n[ee].lanes){const F=ge.find(O=>O.id===W);if(F)return F}return null},G=B==null?void 0:B.sourceCardId,P=G?le(G):null,q=ce.charAt(0).toUpperCase()+ce.slice(1),N=()=>{var W,ee,ge,F;if(ce!=="player"&&(!B||B.actor!=="player"))return u.jsx("button",{className:"btn",disabled:!0,children:"Processing..."});if((B==null?void 0:B.type)==="prompt_use_control_mechanic")return u.jsxs(u.Fragment,{children:[u.jsx("button",{className:"btn",onClick:()=>j("player"),children:"Rearrange Own"}),u.jsx("button",{className:"btn",onClick:()=>j("opponent"),children:"Rearrange Opponent's"}),u.jsx("button",{className:"btn btn-back",onClick:()=>j("skip"),children:"Skip"})]});if((B==null?void 0:B.type)==="prompt_optional_draw")return u.jsxs(u.Fragment,{children:[u.jsx("button",{className:"btn",onClick:()=>v(!0),children:"Draw"}),u.jsx("button",{className:"btn btn-back",onClick:()=>v(!1),children:"Skip"})]});if((B==null?void 0:B.type)==="prompt_death_1_effect")return u.jsxs(u.Fragment,{children:[u.jsx("button",{className:"btn",onClick:()=>w(!0),children:"Draw & Delete"}),u.jsx("button",{className:"btn btn-back",onClick:()=>w(!1),children:"Skip"})]});if((B==null?void 0:B.type)==="prompt_give_card_for_love_1")return u.jsxs(u.Fragment,{children:[u.jsx("button",{className:"btn",onClick:()=>x(!0),children:"Give 1 Card"}),u.jsx("button",{className:"btn btn-back",onClick:()=>x(!1),children:"Skip"})]});if((B==null?void 0:B.type)==="prompt_fire_3_discard")return u.jsxs(u.Fragment,{children:[u.jsx("button",{className:"btn",onClick:()=>l(!0),children:"Discard 1 Card"}),u.jsx("button",{className:"btn btn-back",onClick:()=>l(!1),children:"Skip"})]});if((B==null?void 0:B.type)==="prompt_optional_discard_custom")return u.jsxs(u.Fragment,{children:[u.jsxs("button",{className:"btn",onClick:()=>s(!0),children:["Discard ",B.count," Card(s)"]}),u.jsx("button",{className:"btn btn-back",onClick:()=>s(!1),children:"Skip"})]});if((B==null?void 0:B.type)==="prompt_optional_effect"){const O=((ee=(W=B.effectDef)==null?void 0:W.params)==null?void 0:ee.action)||"effect",K=(F=(ge=B.effectDef)==null?void 0:ge.params)==null?void 0:F.count,U=K?`${O} ${K}`:O;return u.jsxs(u.Fragment,{children:[u.jsxs("button",{className:"btn",onClick:()=>f(!0),children:["Execute (",U,")"]}),u.jsx("button",{className:"btn btn-back",onClick:()=>f(!1),children:"Skip"})]})}if((B==null?void 0:B.type)==="prompt_shift_for_speed_3")return u.jsxs(u.Fragment,{children:[u.jsx("button",{className:"btn",onClick:()=>p(!0),children:"Shift"}),u.jsx("button",{className:"btn btn-back",onClick:()=>p(!1),children:"Skip"})]});if((B==null?void 0:B.type)==="prompt_spirit_1_start")return u.jsxs(u.Fragment,{children:[u.jsx("button",{className:"btn",onClick:()=>S("discard"),children:"Discard 1"}),u.jsx("button",{className:"btn btn-back",onClick:()=>S("flip"),children:"Flip Card"})]});if((B==null?void 0:B.type)==="prompt_shift_for_spirit_3")return u.jsxs(u.Fragment,{children:[u.jsx("button",{className:"btn",onClick:()=>E(!0),children:"Shift"}),u.jsx("button",{className:"btn btn-back",onClick:()=>E(!1),children:"Skip"})]});if((B==null?void 0:B.type)==="prompt_return_for_psychic_4")return u.jsxs(u.Fragment,{children:[u.jsx("button",{className:"btn",onClick:()=>C(!0),children:"Return Card"}),u.jsx("button",{className:"btn btn-back",onClick:()=>C(!1),children:"Skip"})]});if((B==null?void 0:B.type)==="prompt_shift_or_flip_for_light_2")return u.jsxs(u.Fragment,{children:[u.jsx("button",{className:"btn",onClick:()=>m("shift"),children:"Shift"}),u.jsx("button",{className:"btn",onClick:()=>m("flip"),children:"Flip Back"}),u.jsx("button",{className:"btn btn-back",onClick:()=>m("skip"),children:"Skip"})]});if((B==null?void 0:B.type)==="discard"&&B.variableCount&&B.actor==="player")return u.jsxs("button",{className:"btn",onClick:()=>h(A),disabled:A.length<1,children:["Confirm Discard (",A.length,")"]});if((B==null?void 0:B.type)==="plague_2_player_discard"||(B==null?void 0:B.type)==="select_cards_from_hand_to_discard_for_fire_4"||(B==null?void 0:B.type)==="select_cards_from_hand_to_discard_for_hate_1"){let O,K=0;return B.type==="plague_2_player_discard"?(O=i,K=1):B.type==="select_cards_from_hand_to_discard_for_fire_4"?(O=h,K=1):(O=_,K=B.count),u.jsxs("button",{className:"btn",onClick:()=>O(A),disabled:A.length<K,children:["Confirm Discard (",A.length,")"]})}if((B==null?void 0:B.type)==="plague_4_player_flip_optional")return u.jsxs(u.Fragment,{children:[u.jsx("button",{className:"btn",onClick:()=>r(!0),children:"Flip Plague-4"}),u.jsx("button",{className:"btn btn-back",onClick:()=>r(!1),children:"Skip"})]});if(B&&"optional"in B&&B.optional)return u.jsx("button",{className:"btn btn-back",onClick:c,children:"Skip Action"});if(B)return u.jsx("button",{className:"btn",disabled:!0,children:"Action Required"});if(H==="compile"&&V.length>0)return u.jsx("button",{className:"btn",disabled:!0,children:"Select Lane to Compile"});if(H==="action"){const O=z.hand.length<5;return z.hand.length===0?u.jsx("button",{className:"btn",onClick:o,children:"Refresh (Required)"}):u.jsx("button",{className:"btn",onClick:o,disabled:!O||!!D,children:"Refresh"})}return u.jsx("button",{className:"btn",disabled:!0,children:"Processing..."})},k=()=>{var W,ee,ge,F;if(B)switch(B.type){case"discard":return B.actor==="player"?B.variableCount?"Action: Select 1 or more cards to discard":`Action: Discard ${B.count} card(s) from your hand`:"Waiting for Opponent to discard...";case"prompt_use_control_mechanic":return"Control Action: Rearrange protocols?";case"select_opponent_face_up_card_to_flip":return"Action: Select an opponent's face-up card to flip";case"select_own_face_up_covered_card_to_flip":return"Action: Select one of your face-up, covered cards to flip";case"select_opponent_covered_card_to_shift":return"Action: Select one of your opponent's covered cards to shift";case"select_own_covered_card_to_shift":return"Action: Select one of your covered cards to shift";case"select_lane_for_shift":return"Action: Select a new lane for the card";case"select_opponent_card_to_flip":return"Action: Select an opponent's card to flip";case"shift_flipped_card_optional":return"Action: You may shift the card you just flipped. Select a lane or skip.";case"select_covered_card_in_line_to_flip_optional":return"Action: You may flip one of your covered cards in this lane. Select a card or skip.";case"select_card_from_hand_to_play":return"Action: Select a card from your hand to play";case"select_lane_for_play":return"Action: Select another lane to play your card in";case"select_face_down_card_to_shift_for_darkness_4":return"Action: Select any face-down card to shift";case"select_cards_to_delete":return`Action: Select a card to delete (${B.count} remaining)`;case"select_face_down_card_to_delete":return"Action: Select a face-down card to delete";case"select_low_value_card_to_delete":return"Action: Select a card with value 0 or 1 to delete";case"select_card_from_other_lanes_to_delete":return`Action: Select a card to delete (${B.count} remaining)`;case"select_lane_for_death_2":return"Action: Select a lane to delete cards with value 1 or 2";case"select_lane_for_delete":return"Action: Select a lane";case"prompt_optional_draw":return"Optional: Draw card(s)?";case"prompt_death_1_effect":return"Start Phase: Use Death-1 effect?";case"select_card_to_delete_for_death_1":return"Action: Select a card to delete";case"delete_self":return"Deleting card...";case"prompt_give_card_for_love_1":return"End Phase: Give 1 card to draw 2?";case"select_card_from_hand_to_give":return"Action: Select a card from your hand to give";case"select_card_from_hand_to_reveal":return"Action: Select a card from your hand to reveal";case"plague_2_player_discard":return"Action: Select 1 or more cards to discard";case"plague_4_opponent_delete":return"Waiting for opponent to delete one of their face-down cards";case"plague_4_player_flip_optional":return"Action: You may flip Plague-4";case"select_any_other_card_to_flip":return"Action: Select any other card to flip";case"select_card_to_return":return"Action: Select a card to return to its owner's hand";case"select_covered_card_to_flip_for_chaos_0":return"Action: Select a covered card to flip in this lane";case"prompt_fire_3_discard":return"End Phase: Discard 1 card to flip 1 card?";case"prompt_optional_discard_custom":return`Optional: Discard ${B.count} card(s) to continue?`;case"prompt_optional_effect":{const O=((ee=(W=B.effectDef)==null?void 0:W.params)==null?void 0:ee.action)||"effect",K=(F=(ge=B.effectDef)==null?void 0:ge.params)==null?void 0:F.count;return`Optional: Execute ${O}${K?` ${K}`:""}?`}case"select_card_to_flip_for_fire_3":return"Action: Select a card to flip";case"prompt_shift_for_speed_3":return"End Phase: Shift 1 card?";case"select_own_card_to_shift_for_speed_3":case"select_own_other_card_to_shift":return"Action: Select one of your cards to shift";case"select_opponent_face_down_card_to_shift":return"Action: Select an opponent's face-down card to shift";case"prompt_spirit_1_start":return"Start Phase: Discard 1 card or flip Spirit-1?";case"select_any_card_to_flip_optional":return"Action: You may flip one card. Select a card or skip.";case"prompt_shift_for_spirit_3":return"Triggered: You may shift your Spirit-3. Select a lane or skip.";case"prompt_swap_protocols":return"Action: Swap two protocols.";case"select_cards_from_hand_to_discard_for_fire_4":return"Action: Select 1 or more cards to discard";case"select_cards_from_hand_to_discard_for_hate_1":return`Action: Select ${B.count} card(s) to discard for Hate-1`;case"select_any_card_to_flip":return`Action: Select a card to flip (${B.count} remaining)`;case"select_any_face_down_card_to_flip_optional":return"Action: You may flip a face-down card. Select a card or skip.";case"select_lane_for_life_3_play":return"Action: Select another lane to play a card into";case"select_card_to_flip_for_light_0":return"Action: Select any card to flip";case"select_face_down_card_to_reveal_for_light_2":return"Action: Select a face-down card to reveal";case"prompt_shift_or_flip_for_light_2":return"Action: Choose to shift, flip back, or skip";case"select_lane_to_shift_revealed_card_for_light_2":return"Action: Select a lane to shift the revealed card to";case"select_lane_to_shift_cards_for_light_3":return"Action: Select a lane to shift all face-down cards to";case"select_lane_for_metal_3_delete":return"Action: Select a lane with 8+ cards to delete";case"select_any_other_card_to_flip_for_water_0":return"Action: Select any other card to flip";case"prompt_rearrange_protocols":return"Action: Rearrange protocols";case"select_lane_for_water_3":return"Action: Select a lane to return cards from";case"select_own_card_to_return_for_water_4":return"Action: Select one of your cards to return to your hand";case"prompt_return_for_psychic_4":return"End Phase: Return an opponent's card?";case"select_any_opponent_card_to_shift":return"Action: Select an opponent's card to shift";case"select_opponent_card_to_return":return"Action: Select an opponent's card to return";case"select_own_highest_card_to_delete_for_hate_2":return"Action: Select your highest value uncovered card to delete";case"select_opponent_highest_card_to_delete_for_hate_2":return"Action: Select opponent's highest value uncovered card to delete";default:return"Action Required"}return H==="compile"&&V.length>0?"Phase: Compile":`Phase: ${H.replace("_"," ")}`};return u.jsxs("div",{className:`phase-controller ${L}`,children:[u.jsxs("div",{className:"effect-source-info",children:[u.jsxs("span",{children:[q,"'s Turn"]}),B&&P&&u.jsxs(u.Fragment,{children:[" | Effect from: ",u.jsxs("span",{children:[P.protocol,"-",P.value]})]}),(B==null?void 0:B.sourceCardId)==="CONTROL_MECHANIC"&&u.jsxs(u.Fragment,{children:[" | Effect from: ",u.jsx("span",{children:"Control Component"})]})]}),u.jsxs("div",{className:"phase-controller-main",children:[u.jsx("div",{className:"phase-info",children:k()}),u.jsx("div",{className:"phase-actions",children:N()})]})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const V0=({gameState:n,turn:o,animationState:c,difficulty:i,onPlayerClick:r,onOpponentClick:l})=>{const{player:s,opponent:f}=n,p=_=>{const m=["info-section"];return m.push(_==="player"?"player-info":"opponent-info"),o===_&&m.push("active-turn"),(c==null?void 0:c.type)==="drawCard"&&c.owner===_&&m.push("is-drawing"),(c==null?void 0:c.type)==="discardCard"&&c.owner===_&&m.push("is-discarding"),m.join(" ")},h=_=>{const m=_==="player"?s:f,v=_==="player"?r:l,w=_==="player"?"Player":`Opponent${i?` (${i.charAt(0).toUpperCase()+i.slice(1)})`:""}`;return u.jsx("div",{className:p(_),onClick:v,children:u.jsxs("div",{className:"info-section-body",children:[u.jsx("h3",{children:w}),u.jsxs("div",{className:"info-line",children:[u.jsx("span",{children:"Hand:"}),u.jsx("span",{children:m.hand.length})]}),u.jsxs("div",{className:"info-line",children:[u.jsx("span",{children:"Deck:"}),u.jsx("span",{children:m.deck.length})]}),u.jsxs("div",{className:"info-line",children:[u.jsx("span",{children:"Trash:"}),u.jsx("span",{children:m.discard.length})]})]})})};return u.jsxs("div",{className:"game-info-panel",children:[h("opponent"),h("player")]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function B0({log:n,onClose:o}){const c=i=>{let r="";if(i.phase){const l=i.phase.charAt(0).toUpperCase()+i.phase.slice(1);r+=`[${l}] `}return i.sourceCard&&!i.message.startsWith(i.sourceCard)&&(r+=`${i.sourceCard}: `),`${r}${i.message}`};return u.jsx("div",{className:"modal-overlay",onClick:o,children:u.jsxs("div",{className:"modal-content log-modal-content",onClick:i=>i.stopPropagation(),children:[u.jsx("button",{className:"btn btn-back modal-close-btn",onClick:o,children:"X"}),u.jsx("h2",{children:"Game Log"}),u.jsx("ol",{className:"log-list",children:n.map((i,r)=>{const l=i.indentLevel!==void 0,s=l?{paddingLeft:`${i.indentLevel*20+40}px`}:{};return l&&i.indentLevel===0&&(s.fontWeight="bold"),u.jsx("li",{className:`log-entry log-entry-${i.player}`,style:s,children:c(i)},r)})})]})})}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const z0=({message:n,player:o})=>u.jsx("div",{className:`toaster toaster-${o}`,children:n});function G0({gameState:n,targetPlayer:o,onConfirm:c}){var q;const[i]=te.useState([...n[o].protocols]),[r,l]=te.useState([...n[o].protocols]),s=te.useRef(null),f=te.useRef(null),p=te.useRef(0),h=te.useRef(null),_=te.useRef(0),m=((q=n.actionRequired)==null?void 0:q.type)==="prompt_rearrange_protocols"?n.actionRequired.disallowedProtocolForLane:void 0,v=te.useMemo(()=>{if(r.length!==i.length)return!1;for(let N=0;N<r.length;N++)if(r[N]!==i[N])return!0;return!1},[r,i]),w=te.useMemo(()=>{if(!m)return!1;const{laneIndex:N,protocol:k}=m;return r[N]===k},[r,m]),x=n[o],S=n[o==="player"?"opponent":"player"],E=te.useMemo(()=>{const N={};return x.protocols.forEach((k,W)=>{N[k]={value:x.laneValues[W],compiled:x.compiled[W]}}),N},[x.protocols,x.laneValues,x.compiled]),j=(N,k)=>{let W=[N];return k&&W.push("compiled"),W.join(" ")},D=(N,k)=>{s.current=k,N.dataTransfer.effectAllowed="move"},A=(N,k)=>{N.preventDefault(),f.current=k},L=()=>{if(s.current!==null&&f.current!==null&&s.current!==f.current){const N=[...r],k=N.splice(s.current,1)[0];N.splice(f.current,0,k),s.current=null,f.current=null,l(N)}},H=N=>{N.preventDefault()},ce=(N,k)=>{h.current=k,p.current=N.touches[0].clientY,_.current=N.touches[0].clientY},B=N=>{var ee;if(h.current===null)return;_.current=N.touches[0].clientY;const k=N.touches[0],W=document.elementFromPoint(k.clientX,k.clientY);if(W){const ge=W.closest(".rearrange-item");if(ge){const O=Array.from(((ee=ge.parentElement)==null?void 0:ee.children)||[]).indexOf(ge);O!==-1&&O!==h.current&&(f.current=O)}}},z=()=>{if(h.current!==null&&f.current!==null&&h.current!==f.current){const N=[...r],k=N.splice(h.current,1)[0];N.splice(f.current,0,k),l(N)}h.current=null,f.current=null,p.current=0,_.current=0},V=o==="player",le=V?"Rearrange Your Protocols":"Rearrange Opponent's Protocols",G=u.jsx("div",{className:`protocol-bar ${V?"player-bar":"opponent-bar"}`,onDragOver:H,children:r.map((N,k)=>{const W=E[N],ee=N!==i[k],ge=m&&m.laneIndex===k&&N===m.protocol,F=j("protocol-display rearrange-item",W.compiled);return u.jsxs("div",{className:`${F} ${ee?"changed":""} ${ge?"violation":""}`,draggable:!0,onDragStart:O=>D(O,k),onDragEnter:O=>A(O,k),onDragEnd:L,onTouchStart:O=>ce(O,k),onTouchMove:B,onTouchEnd:z,children:[u.jsx("span",{className:"protocol-name",children:N}),u.jsx("span",{className:"protocol-value",children:W.value})]},N)})}),P=u.jsx("div",{className:`protocol-bar ${V?"opponent-bar":"player-bar"}`,children:S.protocols.map((N,k)=>u.jsxs("div",{className:j("protocol-display",S.compiled[k]),children:[u.jsx("span",{className:"protocol-name",children:N}),u.jsx("span",{className:"protocol-value",children:S.laneValues[k]})]},`other-proto-${N}-${k}`))});return u.jsx("div",{className:"modal-overlay",children:u.jsxs("div",{className:"modal-content rearrange-modal-content",onClick:N=>N.stopPropagation(),children:[u.jsx("h2",{children:le}),u.jsx("p",{children:"Drag and drop the protocols to reorder them. You must change the order to continue."}),m&&u.jsxs("p",{className:"warning-text",children:[" ",u.jsx("strong",{children:m.protocol})," cannot be placed on line ",u.jsx("strong",{children:m.laneIndex})," due to Anarchy-3's restriction."]}),u.jsx("div",{className:"rearrange-board-view",children:u.jsxs("div",{className:"protocol-bars-container",children:[V?P:G,V?G:P]})}),u.jsxs("div",{className:"rearrange-actions",children:[u.jsx("button",{className:"btn",onClick:()=>c(r),disabled:!v||w,children:"Confirm Rearrangement"}),w&&u.jsxs("p",{className:"error-text",children:["Cannot confirm: ",m.protocol," is on line ",m.laneIndex]})]})]})})}function Y0({gameState:n,targetPlayer:o,onConfirm:c}){const[i,r]=te.useState([]),l=n[o],s=o==="player",f=s?"Swap Your Protocols":"Swap Opponent's Protocols",p=m=>{i.includes(m)?r(v=>v.filter(w=>w!==m)):i.length<2&&r(v=>[...v,m])},h=()=>{i.length===2&&c(i)},_=m=>{let v=["protocol-display","rearrange-item"];return l.compiled[m]&&v.push("compiled"),i.includes(m)&&v.push("selected"),v.join(" ")};return u.jsx("div",{className:"modal-overlay",children:u.jsxs("div",{className:"modal-content rearrange-modal-content",onClick:m=>m.stopPropagation(),children:[u.jsx("h2",{children:f}),u.jsx("p",{children:"Select two protocols to swap their positions. This action is mandatory."}),u.jsx("div",{className:"rearrange-board-view",children:u.jsx("div",{className:"protocol-bars-container",children:u.jsx("div",{className:`protocol-bar ${s?"player-bar":"opponent-bar"}`,children:l.protocols.map((m,v)=>u.jsxs("div",{className:_(v),onClick:()=>p(v),children:[u.jsx("span",{className:"protocol-name",children:m}),u.jsx("span",{className:"protocol-value",children:l.laneValues[v]})]},m))})})}),u.jsx("div",{className:"rearrange-actions",children:u.jsx("button",{className:"btn",onClick:h,disabled:i.length!==2,children:"Confirm Swap"})})]})})}function W0({player:n,playerState:o,onClose:c}){const i=n.charAt(0).toUpperCase()+n.slice(1),r=(l,s,f)=>{const p=l.map((h,_)=>({...h,id:`${s}-${h.protocol}-${h.value}-${_}`,isFaceUp:f}));return u.jsxs(u.Fragment,{children:[u.jsxs("h3",{children:[s," (",p.length,")"]}),u.jsx("div",{className:"debug-card-grid",children:p.length>0?p.map(h=>u.jsx(an,{card:h,isFaceUp:f,additionalClassName:"in-hand"},h.id)):u.jsxs("p",{className:"no-cards",children:["No cards in ",s.toLowerCase(),"."]})})]})};return u.jsx("div",{className:"modal-overlay",onClick:c,children:u.jsxs("div",{className:"modal-content debug-modal-content",onClick:l=>l.stopPropagation(),children:[u.jsx("button",{className:"btn btn-back modal-close-btn",onClick:c,children:"X"}),u.jsxs("h2",{children:[i,"'s Info"]}),r(o.deck,"Deck",!1),r(o.discard,"Discard Pile",!0)]})})}function Q0({onComplete:n}){const[o,c]=te.useState("choose"),[i,r]=te.useState(null),[l,s]=te.useState(null),[f,p]=te.useState(!1),h=m=>{r(m),c("flipping"),p(!0);const v=Math.random()<.5?"heads":"tails";setTimeout(()=>{s(v),p(!1),c("result")},2e3)},_=()=>{if(l===null||i===null)return;const m=l===i;n(m?"player":"opponent",i,m)};return u.jsx("div",{className:"coin-flip-modal-overlay",children:u.jsxs("div",{className:"modal-content coin-flip-modal-content",onClick:m=>m.stopPropagation(),children:[o==="choose"&&u.jsxs(u.Fragment,{children:[u.jsx("h2",{children:"Coin Flip"}),u.jsx("p",{children:"Choose heads or tails to determine who starts the game."}),u.jsxs("div",{className:"coin-flip-choices",children:[u.jsxs("button",{className:"btn coin-flip-choice-btn",onClick:()=>h("heads"),children:[u.jsx("div",{className:"coin-choice-icon",children:"H"}),u.jsx("div",{className:"coin-choice-label",children:"Heads"})]}),u.jsxs("button",{className:"btn coin-flip-choice-btn",onClick:()=>h("tails"),children:[u.jsx("div",{className:"coin-choice-icon",children:"T"}),u.jsx("div",{className:"coin-choice-label",children:"Tails"})]})]})]}),o==="flipping"&&u.jsxs(u.Fragment,{children:[u.jsx("h2",{children:"Flipping..."}),u.jsxs("p",{children:["You chose: ",u.jsx("span",{className:"coin-flip-highlight",children:i==="heads"?"Heads":"Tails"})]}),u.jsx("div",{className:"coin-flip-animation-container",children:u.jsxs("div",{className:`coin-3d ${f?"is-flipping":""}`,children:[u.jsx("div",{className:"coin-face coin-heads",children:"H"}),u.jsx("div",{className:"coin-face coin-tails",children:"T"})]})})]}),o==="result"&&l&&i&&u.jsxs(u.Fragment,{children:[u.jsx("h2",{children:"Result"}),u.jsxs("p",{children:["You chose: ",u.jsx("span",{className:"coin-flip-highlight",children:i==="heads"?"Heads":"Tails"})]}),u.jsx("div",{className:"coin-flip-animation-container",children:u.jsxs("div",{className:`coin-3d result-${l}`,children:[u.jsx("div",{className:"coin-face coin-heads",children:"H"}),u.jsx("div",{className:"coin-face coin-tails",children:"T"})]})}),u.jsxs("p",{className:"coin-flip-result-text",children:["The coin landed on: ",u.jsx("span",{className:"coin-flip-highlight",children:l==="heads"?"Heads":"Tails"})]}),l===i?u.jsx("p",{className:"coin-flip-winner-text",children:"You won! You will start the game."}):u.jsx("p",{className:"coin-flip-loser-text",children:"Opponent won! Opponent will start the game."}),u.jsx("button",{className:"btn",onClick:_,children:"Continue"})]})]})})}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Gh="compile_game_statistics",Yh=1;function Rh(){const n=Ah,o={};return n.forEach(c=>{o[c]={timesUsed:0,wins:0,losses:0}}),{version:Yh,global:{totalGamesPlayed:0,totalGamesWon:0,totalGamesLost:0,totalPlaytime:0,fastestWin:null,longestGame:null,lastGameDuration:null,currentStreak:0,longestWinStreak:0,longestLoseStreak:0},protocols:o,aiDifficulty:{easy:{played:0,wins:0,losses:0},normal:{played:0,wins:0,losses:0},hard:{played:0,wins:0,losses:0}},cards:{played:{},deleted:{}},actions:{totalCardsDrawn:0,totalCardsPlayed:0,totalShifts:0,totalDeletes:0,totalDiscards:0,totalFlips:0,totalCompiles:0,totalRefreshes:0},control:{gamesWithControl:0,gamesWithoutControl:0,playerRearranges:0,aiRearranges:0,totalRearranges:0},coinFlip:{headsChosen:0,tailsChosen:0,headsWon:0,tailsWon:0}}}function Wh(){var n,o,c,i,r,l,s,f,p,h;try{const _=localStorage.getItem(Gh);if(!_)return Rh();const m=JSON.parse(_),v=Ah,w={...m.protocols||{}};v.forEach(S=>{w[S]||(w[S]={timesUsed:0,wins:0,losses:0})});const x={...m,version:Yh,global:{...m.global,lastGameDuration:((n=m.global)==null?void 0:n.lastGameDuration)||null},protocols:w,control:{gamesWithControl:((o=m.control)==null?void 0:o.gamesWithControl)||0,gamesWithoutControl:((c=m.control)==null?void 0:c.gamesWithoutControl)||0,playerRearranges:((i=m.control)==null?void 0:i.playerRearranges)||0,aiRearranges:((r=m.control)==null?void 0:r.aiRearranges)||0,totalRearranges:((l=m.control)==null?void 0:l.totalRearranges)||0},coinFlip:m.coinFlip||{headsChosen:0,tailsChosen:0,headsWon:0,tailsWon:0},actions:{...m.actions,totalCompiles:((s=m.actions)==null?void 0:s.totalCompiles)||0,totalRefreshes:((f=m.actions)==null?void 0:f.totalRefreshes)||0}};return(!((p=m.control)!=null&&p.playerRearranges)||!m.coinFlip||!((h=m.actions)!=null&&h.totalCompiles)||Object.keys(w).length!==Object.keys(m.protocols||{}).length)&&Va(x),x}catch(_){return console.error("Failed to load statistics:",_),Rh()}}function Va(n){try{localStorage.setItem(Gh,JSON.stringify(n))}catch(o){console.error("Failed to save statistics:",o)}}function X0(n,o,c,i,r,l=!1,s,f){const p=o==="player",h={...n.global},_={...n.protocols},m={easy:{...n.aiDifficulty.easy},normal:{...n.aiDifficulty.normal},hard:{...n.aiDifficulty.hard}},v={...n.control},w={...n.actions},x={...n.coinFlip},C={played:{...n.cards.played},deleted:{...n.cards.deleted}};return h.totalGamesPlayed++,p?h.totalGamesWon++:h.totalGamesLost++,h.totalPlaytime+=r,p&&(h.fastestWin===null||r<h.fastestWin)&&(h.fastestWin=r),(h.longestGame===null||r>h.longestGame)&&(h.longestGame=r),h.lastGameDuration=r,p?(h.currentStreak>=0?h.currentStreak++:h.currentStreak=1,h.currentStreak>h.longestWinStreak&&(h.longestWinStreak=h.currentStreak)):(h.currentStreak<=0?h.currentStreak--:h.currentStreak=-1,Math.abs(h.currentStreak)>h.longestLoseStreak&&(h.longestLoseStreak=Math.abs(h.currentStreak))),c.forEach(S=>{_[S]?_[S]={..._[S]}:_[S]={timesUsed:0,wins:0,losses:0},_[S].timesUsed++,p?_[S].wins++:_[S].losses++}),m[i].played++,p?m[i].wins++:m[i].losses++,l?v.gamesWithControl++:v.gamesWithoutControl++,s&&(w.totalCardsPlayed+=s.cardsPlayed,w.totalCardsDrawn+=s.cardsDrawn,w.totalDiscards+=s.cardsDiscarded,w.totalDeletes+=s.cardsDeleted,w.totalFlips+=s.cardsFlipped,w.totalShifts+=s.cardsShifted,w.totalRefreshes+=s.handsRefreshed),f!==void 0&&(w.totalCompiles+=f),{version:n.version,global:h,protocols:_,aiDifficulty:m,cards:C,actions:w,control:v,coinFlip:x}}function Z0(n,o){const c={...n,cards:{...n.cards,played:{...n.cards.played}}};return c.cards.played[o]||(c.cards.played[o]=0),c.cards.played[o]++,c}function K0(n,o){const c={...n,cards:{...n.cards,deleted:{...n.cards.deleted}}};return c.cards.deleted[o]||(c.cards.deleted[o]=0),c.cards.deleted[o]++,c}function J0(n,o){const c={...n,control:{...n.control}};return o==="player"?c.control.playerRearranges++:c.control.aiRearranges++,c.control.totalRearranges++,c}function e1(n,o,c){const i={...n,coinFlip:{...n.coinFlip}};return o==="heads"?(i.coinFlip.headsChosen++,c&&i.coinFlip.headsWon++):(i.coinFlip.tailsChosen++,c&&i.coinFlip.tailsWon++),i}function t1(n){return n.global.totalGamesPlayed===0?0:n.global.totalGamesWon/n.global.totalGamesPlayed*100}function n1(n){return n.global.totalGamesPlayed===0?0:Math.floor(n.global.totalPlaytime/n.global.totalGamesPlayed)}function o1(n){return Object.entries(n.protocols).map(([c,i])=>({protocol:c,timesUsed:i.timesUsed,winRate:i.timesUsed>0?i.wins/i.timesUsed*100:0})).sort((c,i)=>i.timesUsed-c.timesUsed).slice(0,5)}function a1(n){return Object.entries(n.protocols).filter(([c,i])=>i.timesUsed>=3).map(([c,i])=>({protocol:c,timesUsed:i.timesUsed,winRate:i.wins/i.timesUsed*100})).sort((c,i)=>i.winRate-c.winRate).slice(0,5)}function r1(n){return Object.entries(n.protocols).map(([c,i])=>({protocol:c,timesUsed:i.timesUsed,winRate:i.timesUsed>0?i.wins/i.timesUsed*100:0})).sort((c,i)=>c.timesUsed-i.timesUsed).slice(0,5)}function l1(n){return Object.entries(n.cards.played).map(([c,i])=>({card:c,count:i})).sort((c,i)=>i.count-c.count).slice(0,5)}function c1(n){return Object.entries(n.cards.deleted).map(([c,i])=>({card:c,count:i})).sort((c,i)=>i.count-c.count).slice(0,5)}function zr(n){const o=Math.floor(n/3600),c=Math.floor(n%3600/60),i=n%60;return o>0?`${o}h ${c}m`:c>0?`${c}m ${i}s`:`${i}s`}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function s1(n,o,c){const[i,r]=te.useState(()=>Wh()),l=te.useRef(null),s=te.useCallback(()=>{l.current=Date.now()},[]),f=te.useCallback((v,w)=>{r(x=>{const C=`${v}-${w}`,S=Z0(x,C);return Va(S),S})},[]),p=te.useCallback((v,w)=>{r(x=>{const C=`${v}-${w}`,S=K0(x,C);return Va(S),S})},[]),h=te.useCallback((v,w)=>{r(x=>{const C=e1(x,v,w);return Va(C),C})},[]),_=te.useCallback(v=>{r(w=>{const x=J0(w,v);return Va(x),x})},[]),m=te.useCallback((v,w,x)=>{if(l.current===null)return;const C=Math.floor((Date.now()-l.current)/1e3);r(S=>{const E=X0(S,v,n,o,C,c,w,x);return Va(E),E}),l.current=null},[n,o,c]);return{statistics:i,startGame:s,endGame:m,trackPlayerCardPlayed:f,trackPlayerCardDeleted:p,trackPlayerCoinFlip:h,trackPlayerRearrange:_}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function M(n,o,c=!0){let i=_t.find(r=>r.protocol===n&&r.value===o);return i||(i=Rc().find(l=>l.protocol===n&&l.value===o)),i?{id:He(),protocol:i.protocol,value:i.value,top:i.top,middle:i.middle,bottom:i.bottom,keywords:i.keywords,isFaceUp:c,isRevealed:!1,...i.customEffects&&{customEffects:i.customEffects}}:(console.warn(`Card not found: ${n}-${o}`),{id:He(),protocol:n,value:o,top:"",middle:"",bottom:"",keywords:{},isFaceUp:c,isRevealed:!1})}function ie(n,o,c,i){const r={...n},l={...r[o]},s=[...l.lanes];return s[c]=[...s[c],i],l.lanes=s,r[o]=l,r}function Ye(n,o,c,i,r){let l={...n};return l.player.protocols=o,l.opponent.protocols=c,l.player.lanes=[[],[],[]],l.opponent.lanes=[[],[],[]],l.player.hand=[],l.opponent.hand=[],l.turn=i,l.phase=r,l.actionRequired=null,l.queuedActions=[],l._interruptedTurn=void 0,l._interruptedPhase=void 0,l.processedStartEffectIds=[],l.processedEndEffectIds=[],l.processedUncoverEventIds=[],l}const Qh={name:"Psychic-3 Uncover whrend Opponent's Turn",description:"Player lscht Opponent's face-down card  Psychic-3 uncovered  Player discardet, Opponent shiftet",setup:n=>{let o=Ye(n,["Hate","Fire","Water"],["Psychic","Death","Spirit"],"player","action");return o.player.hand=[M("Hate",0,!0),M("Fire",1,!0),M("Water",1,!0)],o=ie(o,"opponent",1,M("Psychic",3,!0)),o=ie(o,"opponent",1,M("Fire",1,!1)),o=Ae(o),o}},Xh={name:"Psychic-4 End Effect mit Uncover-Interrupt",description:"Psychic-4 returnt Fire-2  Fire-4 uncovered  Interrupt  Psychic-4 flip aus Queue",setup:n=>{let o=Ye(n,["Fire","Water","Spirit"],["Psychic","Death","Metal"],"opponent","end");return o=ie(o,"opponent",0,M("Psychic",4,!0)),o=ie(o,"player",1,M("Fire",4,!0)),o=ie(o,"player",1,M("Fire",2,!0)),o.opponent.hand=[M("Water",1),M("Water",2)],o=Ae(o),o}},Zh={name:"Spirit-3 Draw whrend End Phase",description:"Spirit-3 draw in End Phase  Shift-prompt in Queue  Player kann lanes klicken",setup:n=>{let o=Ye(n,["Spirit","Fire","Water"],["Death","Metal","Psychic"],"player","action");o=ie(o,"player",0,M("Spirit",3,!0));const c=_t.find(l=>l.protocol==="Fire"&&l.value===1),i=_t.find(l=>l.protocol==="Water"&&l.value===1),r=_t.find(l=>l.protocol==="Spirit"&&l.value===1);return o.player.deck=[c,i,r],o=Ae(o),o}},Kh={name:"Plague-2 Actor Propagation",description:"Player spielt Plague-2  Player discardet  Opponent discardet (actor korrekt)",setup:n=>{let o=Ye(n,["Plague","Death","Hate"],["Fire","Water","Spirit"],"player","action");return o.player.hand=[M("Plague",2,!0),M("Fire",1),M("Water",1),M("Spirit",1)],o.opponent.hand=[M("Fire",2),M("Water",2),M("Spirit",2),M("Death",2)],o=Ae(o),o}},Jh={name:"Darkness-1 Flip + Shift mit Interrupt",description:"Darkness-1 flippt Fire-0  Delete-Interrupt  Player shiftet",setup:n=>{let o=Ye(n,["Darkness","Fire","Water"],["Spirit","Death","Metal"],"player","action");return o.player.hand=[M("Darkness",1,!0)],o=ie(o,"opponent",0,M("Fire",0,!1)),o=Ae(o),o}},ey={name:"Plague-4 Owner vs Turn Check",description:"Plague-4 End  Player deletet  Opponent (owner) wird fr flip gefragt",setup:n=>{let o=Ye(n,["Fire","Water","Spirit"],["Plague","Death","Metal"],"opponent","end");return o=ie(o,"opponent",0,M("Plague",4,!0)),o=ie(o,"player",1,M("Water",2,!1)),o=Ae(o),o}},ty={name:"Water Owner vs Turn Check",description:"Plague-4 End  Player deletet  Opponent (owner) wird fr flip gefragt",setup:n=>{let o=Ye(n,["Fire","Water","Spirit"],["Plague","Death","Metal"],"player","action");return o=ie(o,"opponent",0,M("Plague",4,!0)),o=ie(o,"player",2,M("Water",4,!1)),o.player.hand=[M("Water",0,!0),M("Fire",1),M("Water",1),M("Spirit",1)],o.opponent.hand=[M("Fire",2),M("Water",2),M("Spirit",2),M("Death",2)],o=Ae(o),o}},ny={name:"Hate-1 Multi-Delete mit Uncover-Interrupt",description:"Hate-1 lscht Plague-0  Plague-5 uncovered  Interrupt  Player macht 2. Delete",setup:n=>{let o=Ye(n,["Fire","Hate","Water"],["Plague","Death","Metal"],"player","action");return o.player.hand=[M("Hate",1,!0),M("Psychic",2,!0),M("Psychic",4,!0),M("Hate",4,!0),M("Water",1,!0)],o=ie(o,"opponent",0,M("Plague",2,!0)),o=ie(o,"opponent",0,M("Plague",0,!0)),o.opponent.hand=[M("Fire",2,!0),M("Water",2,!0),M("Spirit",2,!0),M("Death",2,!0),M("Metal",2,!0)],o=Ae(o),o}},oy={name:"Darkness-1  Hate-0 Flip  Multi-Effect Chain",description:" Darkness-1 flippt Hate-0  Delete-Interrupt  Draw-Interrupt  Shift aus Queue",setup:n=>{let o=Ye(n,["Darkness","Fire","Water"],["Hate","Death","Metal"],"player","action");o.player.hand=[M("Darkness",1,!0)],o=ie(o,"opponent",0,M("Hate",0,!1)),o=ie(o,"opponent",1,M("Hate",3,!0)),o=ie(o,"opponent",2,M("Fire",1,!1)),o=ie(o,"player",1,M("Water",2,!0)),o.opponent.hand=[M("Death",2),M("Metal",3)];const c=_t.find(i=>i.protocol==="Death"&&i.value===1);return o.opponent.deck=[c],o=Ae(o),o}},ay={name:"Water-4 Return  Turn End",description:" Water-4 returnt Karte  Turn endet (Bug-Fix: Opponent spielt nicht zweimal)",setup:n=>{let o=Ye(n,["Hate","Spirit","Light"],["Fire","Water","Death"],"opponent","action");return o.opponent.hand=[M("Water",4,!0)],o=ie(o,"opponent",0,M("Life",4,!0)),o=ie(o,"opponent",2,M("Death",4,!1)),o=ie(o,"player",1,M("Spirit",1,!0)),o=ie(o,"player",2,M("Light",5,!1)),o.player.hand=[M("Fire",1),M("Spirit",2),M("Hate",4)],o=Ae(o),o}},ry={name:"Psychic-3 Discard + Shift",description:" Psychic-3 On-Play  Player discardet  AI shiftet (Bug-Fix: AI kann shiften)",setup:n=>{let o=Ye(n,["Fire","Water","Spirit"],["Psychic","Death","Metal"],"opponent","action");return o.opponent.hand=[M("Psychic",3,!0)],o.player.hand=[M("Fire",1),M("Water",2),M("Spirit",1)],o=ie(o,"player",0,M("Fire",2,!0)),o=ie(o,"player",1,M("Water",3,!0)),o=ie(o,"player",2,M("Spirit",4,!0)),o=Ae(o),o}},ly={name:"Death-1 Delete  Speed-3 Uncover",description:" Death-1 lscht Light-0  Speed-3 uncovered  Player shiftet (Bug-Fix Test)",setup:n=>{let o=Ye(n,["Speed","Light","Water"],["Death","Fire","Metal"],"opponent","start");return o=ie(o,"player",0,M("Speed",3,!0)),o=ie(o,"player",0,M("Light",0,!0)),o=ie(o,"player",1,M("Water",1,!0)),o=ie(o,"opponent",0,M("Death",1,!0)),o.player.hand=[],o.opponent.hand=[],o=Ae(o),o}},cy={name:"Gravity-2 Flip  Metal-5 Discard  Shift",description:" Gravity-2 flippt Metal-5  Discard Interrupt  shiften (Bug-Fix: AI stuck)",setup:n=>{let o=Ye(n,["Fire","Water","Light"],["Gravity","Metal","Fire"],"opponent","action");return o.opponent.hand=[M("Gravity",2,!0),M("Fire",1)],o=ie(o,"opponent",1,M("Metal",5,!1)),o=ie(o,"player",0,M("Fire",2,!0)),o=ie(o,"player",2,M("Light",3,!0)),o.player.hand=[M("Water",1),M("Fire",3)],o=Ae(o),o}},sy={name:"Hate-2 Player spielt (Einfach)",description:" Player spielt Hate-2  Whlt eigene & Gegners hchste Karte",setup:n=>{let o=Ye(n,["Hate","Water","Light"],["Metal","Death","Gravity"],"player","action");return o.player.hand=[M("Hate",2,!0)],o=ie(o,"player",0,M("Fire",4,!0)),o=ie(o,"player",1,M("Water",2,!0)),o=ie(o,"player",2,M("Light",5,!0)),o=ie(o,"opponent",0,M("Metal",3,!0)),o=ie(o,"opponent",1,M("Death",5,!0)),o=ie(o,"opponent",2,M("Gravity",2,!1)),o=Ae(o),o}},iy={name:"Hate-2 AI spielt (Normal)",description:" AI spielt Hate-2  AI whlt eigene & Players hchste automatisch",setup:n=>{let o=Ye(n,["Water","Spirit","Light"],["Hate","Metal","Death"],"opponent","action");return o.opponent.hand=[M("Hate",2,!0)],o=ie(o,"opponent",0,M("Fire",5,!0)),o=ie(o,"opponent",1,M("Metal",3,!0)),o=ie(o,"opponent",2,M("Death",2,!1)),o=ie(o,"player",0,M("Water",4,!0)),o=ie(o,"player",1,M("Spirit",5,!0)),o=ie(o,"player",2,M("Light",2,!0)),o=Ae(o),o}},dy={name:"Hate-2 AI spielt (Normal) mit Auswahl",description:" AI spielt Hate-2  AI whlt eigene & Players hchste automatisch",setup:n=>{let o=Ye(n,["Water","Spirit","Light"],["Hate","Metal","Death"],"opponent","action");return o.opponent.hand=[M("Hate",2,!0)],o=ie(o,"opponent",0,M("Fire",5,!0)),o=ie(o,"opponent",1,M("Metal",3,!0)),o=ie(o,"opponent",2,M("Death",2,!1)),o=ie(o,"player",0,M("Water",4,!0)),o=ie(o,"player",1,M("Spirit",5,!0)),o=ie(o,"player",2,M("Light",5,!0)),o=Ae(o),o}},uy={name:"Hate-2 Selbst-Lschung",description:" Hate-2 lscht sich selbst  Zweite Klausel entfllt (Regelwerk-Check)",setup:n=>{let o=Ye(n,["Hate","Fire","Water"],["Metal","Death","Gravity"],"player","action");return o.player.hand=[M("Hate",2,!0)],o=ie(o,"player",1,M("Fire",1,!0)),o=ie(o,"player",2,M("Water",0,!0)),o=ie(o,"opponent",0,M("Metal",3,!0)),o=ie(o,"opponent",1,M("Death",5,!0)),o=Ae(o),o}},py={name:"Hate-2 Gleichstand (Auswahl)",description:" Hate-2 mit mehreren hchsten  Player muss whlen (Tied values)",setup:n=>{let o=Ye(n,["Hate","Water","Spirit"],["Metal","Death","Gravity"],"player","action");return o.player.hand=[M("Hate",2,!0)],o=ie(o,"player",0,M("Fire",4,!0)),o=ie(o,"player",1,M("Water",4,!0)),o=ie(o,"player",2,M("Spirit",4,!0)),o=ie(o,"opponent",0,M("Metal",5,!0)),o=ie(o,"opponent",1,M("Death",5,!0)),o=ie(o,"opponent",2,M("Gravity",2,!1)),o=Ae(o),o}},fy={name:"Hate-2 Face-Down Karten",description:" Hate-2 mit face-down  Alle face-down sind value 2 (Tied mit Hate-2)",setup:n=>{let o=Ye(n,["Hate","Fire","Water"],["Metal","Death","Gravity"],"player","action");return o.player.hand=[M("Hate",2,!0)],o=ie(o,"player",1,M("Fire",5,!1)),o=ie(o,"player",2,M("Water",5,!1)),o=ie(o,"opponent",0,M("Metal",5,!0)),o=ie(o,"opponent",1,M("Death",4,!1)),o=ie(o,"opponent",2,M("Gravity",1,!0)),o=Ae(o),o}},hy={name:"Hate-2 AI Play-Validation",description:" AI spielt Hate-2 NICHT face-up wenn es sich selbst lschen wrde",setup:n=>{let o=Ye(n,["Fire","Water","Spirit"],["Hate","Death","Metal"],"opponent","action");return o.opponent.hand=[M("Hate",2,!0)],o=ie(o,"opponent",1,M("Fire",0,!0)),o=ie(o,"opponent",2,M("Water",1,!0)),o=ie(o,"player",0,M("Fire",5,!0)),o=ie(o,"player",1,M("Water",4,!0)),o=Ae(o),o}},yy={name:"Hate-2 AI spielt OFFEN (Optimal)",description:" AI spielt Hate-2 offen weil nicht hchste Karte",setup:n=>{let o=Ye(n,["Water","Spirit","Light"],["Hate","Metal","Death"],"opponent","action");return o.opponent.hand=[M("Hate",2,!0)],o=ie(o,"opponent",0,M("Fire",5,!0)),o=ie(o,"opponent",1,M("Metal",4,!0)),o=ie(o,"opponent",2,M("Death",3,!0)),o=ie(o,"player",0,M("Water",2,!0)),o=ie(o,"player",1,M("Spirit",5,!0)),o=ie(o,"player",2,M("Light",1,!0)),o=Ae(o),o}},i1={name:"Chaos-3 Protocol-Free Playing",description:"Player with Chaos-3 can play any card face-up in any lane",setup:n=>{let o=Ye(n,["Chaos","Fire","Water"],["Spirit","Death","Metal"],"player","action");return o=ie(o,"player",0,M("Chaos",3,!0)),o.player.hand=[M("Gravity",2,!0),M("Hate",3,!0),M("Love",1,!0)],o=Ae(o),o}},d1={name:"Frost-3 Blocks Shifts (Covered)",description:"Frost-3 should prevent shifts even when covered (Top-Box effect always active)",setup:n=>{let o=Ye(n,["Gravity","Water","Fire"],["Frost","Metal","Death"],"player","action");return o=ie(o,"opponent",0,M("Frost",3,!0)),o=ie(o,"opponent",0,M("Metal",2,!1)),o=ie(o,"player",1,M("Water",2,!0)),o.player.hand=[M("Gravity",1,!0),M("Fire",2,!0)],o=Ae(o),o}},u1={name:"Water-0 Softlock Bug Fix",description:"Water-0 self-flip should be cancelled when card becomes covered before self-flip executes",setup:n=>{let o=Ye(n,["Water","Darkness","Light"],["Apathy","Fire","Death"],"player","action");return o=ie(o,"player",1,M("Darkness",3,!1)),o.player.hand=[M("Water",0,!0),M("Darkness",2,!0),M("Fire",1,!0)],o=Ae(o),o}},p1={name:"Dark_cust-1 Flip and Shift Chain",description:"Dark_cust-1 should flip opponent card, then allow shifting that same card",setup:n=>{let o=Ye(n,["Dark_cust","Water","Fire"],["Metal","Fire","Death"],"player","action");return o=ie(o,"opponent",0,M("Metal",2,!1)),o=ie(o,"opponent",1,M("Fire",1,!0)),o=ie(o,"opponent",2,M("Hate",0,!1)),o.player.hand=[M("Dark_cust",1,!0),M("Water",2,!0),M("Fire",3,!0)],o=Ae(o),o}},f1={name:"Dark_cust-1 Flips Speed-3 - Middle Effect Execution",description:"When Dark_cust-1 flips Speed-3, Speed-3's middle effect (shift) should execute before Dark_cust-1's shift",setup:n=>{let o=Ye(n,["Dark_cust","Water","Fire"],["Speed","Fire","Metal"],"player","action");return o=ie(o,"opponent",0,M("Speed",3,!1)),o=ie(o,"opponent",1,M("Fire",1,!0)),o=ie(o,"opponent",2,M("Metal",2,!0)),o.player.hand=[M("Dark_cust",1,!0),M("Water",2,!0),M("Fire",3,!0)],o=Ae(o),o}},h1={name:"Dark_cust-1 Flips Speed-3 - Middle Effect Execution",description:"When Dark_cust-1 flips Speed-3, Speed-3's middle effect (shift) should execute before Dark_cust-1's shift",setup:n=>{let o=Ye(n,["Darkness","Water","Fire"],["Speed","Fire","Metal"],"player","action");return o=ie(o,"opponent",0,M("Speed",3,!1)),o=ie(o,"opponent",1,M("Fire",1,!0)),o=ie(o,"opponent",2,M("Metal",2,!0)),o.player.hand=[M("Darkness",1,!0),M("Water",2,!0),M("Fire",3,!0)],o=Ae(o),o}},_y={name:"Fire_custom-1 & Fire_custom-2 Conditional Test",description:" Fire_custom-1 (discard -> delete) & Fire_custom-2 (discard -> return) if_executed logic",setup:n=>{let o=Ye(n,["Fire_custom","Water","Spirit"],["Metal","Death","Fire"],"player","action");return o.player.hand=[M("Fire_custom",1,!0),M("Fire_custom",2,!0),M("Fire_custom",0,!0),M("Fire_custom",3,!0),M("Fire_custom",4,!0),M("Fire_custom",5,!0)],o=ie(o,"opponent",0,M("Metal",3,!0)),o=ie(o,"opponent",1,M("Death",4,!0)),o=ie(o,"opponent",2,M("Fire",2,!0)),o=ie(o,"opponent",0,M("Metal",1,!0)),o=ie(o,"player",2,M("Spirit",3,!0)),o=ie(o,"player",1,M("Water",3,!0)),o=ie(o,"player",2,M("Spirit",2,!0)),o=Ae(o),o}},my={name:"Anarchy_custom Test Playground",description:" All Anarchy_custom cards on hand for testing",setup:n=>{let o=Ye(n,["Anarchy_custom","Water","Spirit"],["Metal","Death","Fire"],"player","action");return o.player.hand=[M("Anarchy_custom",0,!0),M("Anarchy_custom",1,!0),M("Anarchy_custom",2,!0),M("Anarchy_custom",3,!0),M("Anarchy_custom",5,!0),M("Anarchy_custom",6,!0)],o=ie(o,"opponent",0,M("Metal",3,!0)),o=ie(o,"opponent",1,M("Death",4,!1)),o=ie(o,"opponent",2,M("Fire",2,!0)),o=ie(o,"opponent",0,M("Metal",1,!0)),o=ie(o,"player",2,M("Spirit",3,!0)),o=ie(o,"player",1,M("Water",3,!0)),o=ie(o,"player",2,M("Spirit",2,!0)),o=Ae(o),o}},gy={name:"Dark_cust Test Playground",description:" All Dark_cust cards on hand for testing",setup:n=>{let o=Ye(n,["Dark_cust","Water","Spirit"],["Metal","Death","Fire"],"player","action");return o.player.hand=[M("Dark_cust",0,!0),M("Dark_cust",1,!0),M("Dark_cust",2,!0),M("Dark_cust",3,!0),M("Dark_cust",4,!0),M("Dark_cust",5,!0)],o=ie(o,"opponent",0,M("Metal",3,!1)),o=ie(o,"opponent",1,M("Death",4,!0)),o=ie(o,"opponent",2,M("Fire",2,!1)),o=ie(o,"opponent",0,M("Metal",1,!0)),o=ie(o,"opponent",1,M("Death",2,!1)),o=ie(o,"player",2,M("Spirit",3,!0)),o=ie(o,"player",1,M("Water",3,!0)),o=ie(o,"player",2,M("Spirit",2,!0)),o=Ae(o),o}},vy={name:"Apathy_custom Test Playground",description:" All Apathy_custom cards on hand for testing",setup:n=>{let o=Ye(n,["Apathy_custom","Water","Spirit"],["Metal","Death","Fire"],"player","action");return o.player.hand=[M("Apathy_custom",0,!0),M("Apathy_custom",1,!0),M("Apathy_custom",2,!0),M("Apathy_custom",3,!0),M("Apathy_custom",4,!0),M("Apathy_custom",5,!0)],o=ie(o,"opponent",0,M("Metal",3,!0)),o=ie(o,"opponent",1,M("Death",4,!0)),o=ie(o,"opponent",2,M("Fire",2,!0)),o=ie(o,"opponent",0,M("Metal",1,!0)),o=ie(o,"opponent",2,M("Fire",1,!1)),o=ie(o,"player",2,M("Spirit",3,!0)),o=ie(o,"player",1,M("Water",3,!0)),o=ie(o,"player",2,M("Spirit",2,!0)),o=Ae(o),o}},wy={name:"Death_custom Test Playground",description:" All Death_custom cards on hand for testing",setup:n=>{let o=Ye(n,["Death_cust","Water","Spirit"],["Metal","Death","Fire"],"player","action");return o.player.hand=[M("Death_cust",0,!0),M("Death_cust",1,!0),M("Death_cust",2,!0),M("Death_cust",3,!0),M("Death_cust",4,!0),M("Death_cust",5,!0)],o=ie(o,"opponent",0,M("Metal",0,!0)),o=ie(o,"opponent",1,M("Death",1,!0)),o=ie(o,"opponent",2,M("Fire",3,!0)),o=ie(o,"opponent",0,M("Metal",2,!0)),o=ie(o,"opponent",1,M("Death",4,!1)),o=ie(o,"player",2,M("Spirit",3,!0)),o=ie(o,"player",1,M("Water",3,!0)),o=ie(o,"player",2,M("Spirit",2,!0)),o=Ae(o),o}},xy=[Qh,Xh,Zh,Kh,Jh,ey,ty,ny,oy,ay,ry,ly,cy,sy,iy,dy,uy,py,fy,hy,yy,i1,d1,u1,p1,f1,h1,_y,my,gy,vy,wy],y1=Object.freeze(Object.defineProperty({__proto__:null,allScenarios:xy,scenario10_Hate1Interrupt:ny,scenario11_Darkness1HateChain:oy,scenario12_Water4TurnEnd:ay,scenario13_Psychic3ShiftTest:ry,scenario14_Death1UncoverTest:ly,scenario15_Gravity2ShiftInterrupt:cy,scenario16_Hate2PlayerPlays:sy,scenario171_Hate2AIPlays:dy,scenario17_Hate2AIPlays:iy,scenario18_Hate2SelfDelete:uy,scenario19_Hate2MultipleTies:py,scenario1_Psychic3Uncover:Qh,scenario20_Hate2FaceDown:fy,scenario21_Hate2AIValidation:hy,scenario22_Hate2AIPlaysOpen:yy,scenario29_FireCustomConditional:_y,scenario2_Psychic4EndEffect:Xh,scenario30_AnarchyCustomPlayground:my,scenario31_DarkCustPlayground:gy,scenario32_ApathyCustomPlayground:vy,scenario33_DeathCustomPlayground:wy,scenario3_Spirit3EndPhase:Zh,scenario4_Plague2Actor:Kh,scenario5_Darkness1Interrupt:Jh,scenario8_Plague4Owner:ey,scenario9_Water:ty},Symbol.toStringTag,{value:"Module"})),_1=({onLoadScenario:n,onSkipCoinFlip:o})=>{const[c,i]=te.useState(!1);return c?u.jsxs("div",{style:{position:"fixed",top:"20px",left:"20px",width:"400px",maxHeight:"600px",backgroundColor:"#2c2c2c",border:"2px solid #ff6b6b",borderRadius:"8px",padding:"20px",zIndex:9999,overflowY:"auto",color:"white",fontFamily:"monospace"},children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"20px"},children:[u.jsx("h3",{style:{margin:0},children:" Debug Panel"}),u.jsx("button",{onClick:()=>i(!1),style:{backgroundColor:"transparent",border:"none",color:"white",cursor:"pointer",fontSize:"20px"},children:""})]}),u.jsx("div",{style:{marginBottom:"15px",fontSize:"12px",color:"#aaa"},children:"Lade vordefinierte Test-Szenarien zum Testen der Actor/Owner-Fixes."}),u.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:xy.map((r,l)=>u.jsxs("div",{style:{backgroundColor:"#1a1a1a",padding:"12px",borderRadius:"5px",border:"1px solid #444"},children:[u.jsx("div",{style:{fontWeight:"bold",marginBottom:"5px",color:"#4ecdc4"},children:r.name}),u.jsx("div",{style:{fontSize:"11px",color:"#bbb",marginBottom:"10px"},children:r.description}),u.jsx("button",{onClick:()=>{o&&o(),n(r.setup),i(!1)},style:{padding:"6px 12px",backgroundColor:"#4ecdc4",color:"#1a1a1a",border:"none",borderRadius:"3px",cursor:"pointer",fontWeight:"bold",fontSize:"12px"},children:"Load Scenario"})]},l))}),u.jsx("div",{style:{marginTop:"20px",fontSize:"11px",color:"#666",textAlign:"center"},children:"Drcke ESC oder klicke  zum Schlieen"})]}):u.jsx("button",{onClick:()=>i(!0),style:{position:"fixed",top:"20px",left:"20px",padding:"10px 20px",backgroundColor:"#ff6b6b",color:"white",border:"none",borderRadius:"5px",cursor:"pointer",fontWeight:"bold",zIndex:9999,fontSize:"14px"},children:" DEBUG"})},m1=(n,o)=>{if(!o)return null;for(const c of["player","opponent"])for(const i of n[c].lanes){const r=i.find(l=>l.id===o);if(r)return{card:r,owner:c}}return null},g1=new Set(["discard","select_card_from_hand_to_play","select_card_from_hand_to_give","select_card_from_hand_to_reveal","plague_2_player_discard","select_cards_from_hand_to_discard_for_fire_4","select_cards_from_hand_to_discard_for_hate_1"]);function v1({onBack:n,onEndGame:o,playerProtocols:c,opponentProtocols:i,difficulty:r,useControlMechanic:l,startingPlayer:s="player"}){var Tn,kt,Mt;const[f,p]=te.useState(null),[h,_]=te.useState(!0),{startGame:m,endGame:v,trackPlayerCoinFlip:w,trackPlayerRearrange:x}=s1(c,r,l),C=te.useCallback((_e,Ce,Fe)=>{p(_e),_(!1),w(Ce,Fe)},[w]),S=te.useCallback(()=>{p("player"),_(!1),m()},[m]);te.useEffect(()=>{!h&&f&&m()},[h,f,m]);const E=te.useCallback((_e,Ce)=>{const Fe=Ce.player.compiled.filter(dt=>dt).length;v(_e,Ce.stats.player,Fe),o(_e,Ce)},[v,o]),{gameState:j,selectedCard:D,setSelectedCard:A,playSelectedCard:L,fillHand:H,discardCardFromHand:ce,compileLane:B,resolveActionWithCard:z,resolveActionWithLane:V,selectHandCardForAction:le,resolveActionWithHandCard:G,skipAction:P,resolveOptionalDrawPrompt:q,resolveDeath1Prompt:N,resolveLove1Prompt:k,resolvePlague2Discard:W,resolvePlague4Flip:ee,resolveFire3Prompt:ge,resolveOptionalDiscardCustomPrompt:F,resolveOptionalEffectPrompt:O,resolveFire4Discard:K,resolveHate1Discard:U,resolveLight2Prompt:Q,resolveRearrangeProtocols:ye,resolveSpirit1Prompt:fe,resolveSpirit3Prompt:ne,resolveSwapProtocols:X,resolveSpeed3Prompt:re,resolvePsychic4Prompt:se,resolveControlMechanicPrompt:we,setupTestScenario:Ee}=P0(c,i,E,r,l,f??"player",x),[xe,be]=te.useState(null),[rt,ve]=te.useState([]),[Be,gt]=te.useState(!1),[ft,Rt]=te.useState([]),je=te.useRef(j.log.length),[lt,St]=te.useState(!1),[vn,rn]=te.useState(!1),[ct,bt]=te.useState(null),[ln,At]=te.useState(!1),[ca,me]=te.useState(0),Te=te.useRef(null),Me=te.useRef(j);te.useEffect(()=>{Me.current=j},[j]);const We=()=>{const _e=ca+1;if(me(_e),_e>=5){At(Ce=>!Ce),me(0),Te.current&&(clearTimeout(Te.current),Te.current=null);return}Te.current&&clearTimeout(Te.current),Te.current=setTimeout(()=>{me(0),Te.current=null},2e3)},Xe=te.useMemo(()=>{if(j.lastPlayedCardId){const _e=m1(j,j.lastPlayedCardId);if(_e){const Ce=_e.owner==="player"||_e.card.isFaceUp;return{card:_e.card,showContents:Ce}}}return null},[j.lastPlayedCardId,j.player.lanes,j.opponent.lanes]),vt=xe||Xe;te.useEffect(()=>{j.log.length>je.current&&j.log.slice(je.current).forEach(Ce=>{if(Ce.message!=="Game Started."){const Fe={message:Ce.message,player:Ce.player,id:He()};Rt(dt=>[...dt,Fe]),setTimeout(()=>{Rt(dt=>dt.filter(qt=>qt.id!==Fe.id))},5e3)}}),je.current=j.log.length},[j.log]),te.useEffect(()=>{var Ce,Fe,dt,qt,Qt;!(((Ce=j.actionRequired)==null?void 0:Ce.type)==="discard"&&((Fe=j.actionRequired)==null?void 0:Fe.variableCount))&&((dt=j.actionRequired)==null?void 0:dt.type)!=="plague_2_player_discard"&&((qt=j.actionRequired)==null?void 0:qt.type)!=="select_cards_from_hand_to_discard_for_fire_4"&&((Qt=j.actionRequired)==null?void 0:Qt.type)!=="select_cards_from_hand_to_discard_for_hate_1"&&ve([])},[j.actionRequired]),te.useEffect(()=>{var _e,Ce;St(((_e=j.actionRequired)==null?void 0:_e.type)==="prompt_rearrange_protocols"&&j.actionRequired.actor==="player"),rn(((Ce=j.actionRequired)==null?void 0:Ce.type)==="prompt_swap_protocols"&&j.actionRequired.actor==="player")},[j.actionRequired]),te.useEffect(()=>{const _e=Ce=>{Ce.ctrlKey&&Ce.shiftKey&&(Ce.preventDefault(),Ce.key.toLowerCase()==="d"?(console.log("Debug: Toggling debug button visibility."),At(Fe=>!Fe)):Ce.key.toLowerCase()==="w"?(console.log("Debug: Forcing player win."),o("player",j)):Ce.key.toLowerCase()==="o"?(console.log("Debug: Forcing opponent win."),o("opponent",j)):Ce.key.toLowerCase()==="p"?(console.log("Debug: Setting up Speed-0 interrupt scenario."),Ee("speed-0-interrupt")):Ce.key.toLowerCase()==="l"?(console.log("Debug: Setting up Speed-1 discard trigger scenario."),Ee("speed-1-trigger")):Ce.key.toLowerCase()==="f"?(console.log("Debug: Setting up Fire On-Cover test scenario."),Ee("fire-oncover-test")):Ce.key.toLowerCase()==="s"?(console.log("Debug: Setting up Speed-2 + Control test scenario."),Ee("speed-2-control-test")):Ce.key.toLowerCase()==="u"&&(console.log("Debug: Setting up Death-1 Uncover test scenario."),cg(()=>Promise.resolve().then(()=>y1),void 0).then(Fe=>{Ee(Fe.scenario14_Death1UncoverTest.setup)})))};return window.addEventListener("keydown",_e),()=>{window.removeEventListener("keydown",_e)}},[j,o,Ee]);const Bn=_e=>{const Ce=Me.current;if(Ce.animationState)return;const{actionRequired:Fe,turn:dt,phase:qt,compilableLanes:Qt,player:Zt,opponent:Kt}=Ce;if(dt==="player"&&qt==="compile"&&Qt.includes(_e)){if(Fe){console.warn("Compile click blocked by pending action:",Fe);return}B(_e);return}if(Fe&&Fe.actor==="player"&&["select_lane_for_shift","shift_flipped_card_optional","select_lane_for_play","select_lane_for_delete","select_lane_for_death_2","select_lane_for_life_3_play","select_lane_to_shift_revealed_card_for_light_2","select_lane_to_shift_cards_for_light_3","select_lane_for_water_3","select_lane_for_metal_3_delete"].includes(Fe.type)){V(_e);return}const Nn=Kt.lanes.flat().some(sn=>sn.isFaceUp&&sn.protocol==="Psychic"&&sn.value===1),cn=Kt.lanes[_e],po=cn.length>0&&cn[cn.length-1].isFaceUp&&cn[cn.length-1].protocol==="Plague"&&cn[cn.length-1].value===0;if(D&&qt==="action"&&!Fe&&Zt.hand.some(sn=>sn.id===D)&&!po){const sn=Zt.hand.find(Pt=>Pt.id===D),cl=Zt.lanes.flat().some(Pt=>Pt.isFaceUp&&Pt.protocol==="Spirit"&&Pt.value===1),zn=Zt.lanes.some((Pt,hd)=>{if(Pt.length===0)return!1;const ho=Pt[Pt.length-1];return ho.isFaceUp&&ho.protocol==="Chaos"&&ho.value===3}),fo=[...Zt.lanes.flat(),...Kt.lanes.flat()].some(Pt=>Pt.isFaceUp&&Pt.protocol==="Anarchy"&&Pt.value===1),Nc=ud(Ce);let sa;fo||Nc?sa=sn.protocol!==Zt.protocols[_e]&&sn.protocol!==Kt.protocols[_e]&&!Nn:sa=(cl||zn||sn.protocol===Zt.protocols[_e]||sn.protocol===Kt.protocols[_e])&&!Nn,L(_e,sa),be(null);return}D&&(A(null),be(null))},Dc=_e=>{const Ce=Me.current;if(Ce.animationState||!D)return;const{phase:Fe,actionRequired:dt,player:qt}=Ce;Fe!=="action"||dt||!qt.hand.some(Qt=>Qt.id===D)||(L(_e,!1),be(null))},tl=_e=>{const Ce=Me.current;if(!Ce.animationState){if(Ce.actionRequired){if(Ce.actionRequired.type==="discard"&&Ce.actionRequired.actor==="player")if(Ce.actionRequired.variableCount){ve(Fe=>Fe.includes(_e.id)?Fe.filter(dt=>dt!==_e.id):[...Fe,_e.id]);return}else{ce(_e.id);return}if(Ce.actionRequired.type==="select_card_from_hand_to_play"){le(_e.id);return}if(Ce.actionRequired.type==="select_card_from_hand_to_give"||Ce.actionRequired.type==="select_card_from_hand_to_reveal"){G(_e.id);return}if(Ce.actionRequired.type==="plague_2_player_discard"||Ce.actionRequired.type==="select_cards_from_hand_to_discard_for_fire_4"||Ce.actionRequired.type==="select_cards_from_hand_to_discard_for_hate_1"){ve(Fe=>Fe.includes(_e.id)?Fe.filter(dt=>dt!==_e.id):[...Fe,_e.id]);return}return}Ce.turn!=="player"||Ce.phase!=="action"&&Ce.phase!=="compile"||(_e.id===D?(A(null),be(null)):(A(_e.id),be({card:_e,showContents:!0})))}},nl=(_e,Ce,Fe)=>{const dt=Me.current;if(dt.animationState)return;const{actionRequired:qt,turn:Qt,phase:Zt,compilableLanes:Kt}=dt;if(Qt==="player"&&Zt==="compile"&&Kt.includes(Fe)){Bn(Fe);return}if(Qt==="player"&&!qt&&D&&Zt==="action"){Bn(Fe);return}if(qt&&qt.actor==="player"&&(qt.type==="select_own_highest_card_to_delete_for_hate_2"||qt.type==="select_opponent_highest_card_to_delete_for_hate_2")&&jc(_e,dt)){z(_e.id);return}if(jc(_e,dt))z(_e.id);else if(D)A(null),be(null);else{const Nn=Ce==="player"||_e.isFaceUp;be({card:_e,showContents:Nn})}},Ya=_e=>{D||be({card:_e,showContents:!0})},Io=(_e,Ce)=>{if(!D){const Fe=Ce==="player"||_e.isFaceUp;be({card:_e,showContents:Fe})}},ol=()=>{D||be(null)},al=_e=>{!D&&!j.actionRequired&&be({card:_e,showContents:_e.isRevealed||!1})},rl=()=>{if(!vt)return null;const{card:_e,showContents:Ce}=vt;return u.jsx(an,{card:_e,isFaceUp:Ce})},Wa=j.turn==="player"&&!j.actionRequired&&j.phase==="compile"&&j.compilableLanes.length>0,Qa=((Tn=j.actionRequired)==null?void 0:Tn.sourceCardId)??null,ll=te.useMemo(()=>{var _e;return(_e=j.actionRequired)!=null&&_e.actor?j.actionRequired.actor==="player"?"action-required-player":"action-required-opponent":""},[j.actionRequired]),Tc=te.useMemo(()=>{const _e=j.actionRequired;return _e&&_e.actor==="player"?g1.has(_e.type)?"":"hand-in-background":""},[j.actionRequired]);return u.jsxs("div",{className:"screen game-screen",children:[ct&&u.jsx(W0,{player:ct,playerState:j[ct],onClose:()=>bt(null)}),lt&&((kt=j.actionRequired)==null?void 0:kt.type)==="prompt_rearrange_protocols"&&u.jsx(G0,{gameState:j,targetPlayer:j.actionRequired.target,onConfirm:_e=>{var Ce,Fe;((Ce=j.actionRequired)==null?void 0:Ce.sourceCardId)==="CONTROL_MECHANIC"&&((Fe=j.actionRequired)!=null&&Fe.actor)&&x(j.actionRequired.actor),ye(_e),St(!1)}}),vn&&((Mt=j.actionRequired)==null?void 0:Mt.type)==="prompt_swap_protocols"&&u.jsx(Y0,{gameState:j,targetPlayer:j.actionRequired.target,onConfirm:_e=>{X(_e),rn(!1)}}),u.jsx("div",{className:"toaster-container",children:ft.map(_e=>u.jsx(z0,{message:_e.message,player:_e.player},_e.id))}),Be&&u.jsx(B0,{log:j.log,onClose:()=>gt(!1)}),u.jsx("button",{className:"btn log-button",onClick:()=>gt(!0),children:"Log"}),u.jsxs("div",{className:"game-screen-layout",children:[u.jsxs("div",{className:"game-preview-container",children:[u.jsx("h2",{onClick:We,style:{cursor:"pointer",userSelect:"none"},title:"Click 5 times to toggle debug mode",children:"Mainframe"}),u.jsx(V0,{gameState:j,turn:j.turn,animationState:j.animationState,difficulty:r,onPlayerClick:()=>bt("player"),onOpponentClick:()=>bt("opponent")}),u.jsx("div",{className:"preview-card-area",children:rl()}),u.jsx("button",{className:"btn btn-back",onClick:n,children:"Back"})]}),u.jsxs("div",{className:"game-main-area",children:[Wa&&u.jsx("div",{className:"compile-prompt-container",children:u.jsx("h3",{children:"Select a Protocol to Compile"})}),u.jsx(I0,{gameState:j,onLanePointerDown:Bn,onPlayFaceDown:Dc,selectedCardId:D,onCardPointerDown:nl,onCardPointerEnter:Io,onCardPointerLeave:ol,onOpponentHandCardPointerEnter:al,onOpponentHandCardPointerLeave:ol,sourceCardId:Qa}),u.jsxs("div",{className:"player-action-area",children:[u.jsx(H0,{gameState:j,onFillHand:H,onSkipAction:P,onResolveOptionalDrawPrompt:q,onResolveDeath1Prompt:N,onResolveLove1Prompt:k,onResolvePlague2Discard:W,onResolvePlague4Flip:ee,onResolveFire3Prompt:ge,onResolveOptionalDiscardCustomPrompt:F,onResolveOptionalEffectPrompt:O,onResolveSpeed3Prompt:re,onResolveFire4Discard:K,onResolveHate1Discard:U,onResolveLight2Prompt:Q,onResolvePsychic4Prompt:se,onResolveSpirit1Prompt:fe,onResolveSpirit3Prompt:ne,onResolveControlMechanicPrompt:we,selectedCardId:D,multiSelectedCardIds:rt,actionRequiredClass:ll}),u.jsx("div",{className:`player-hand-area ${Tc}`,children:j.player.hand.map(_e=>u.jsx(an,{card:_e,isFaceUp:!0,onPointerDown:()=>tl(_e),onPointerEnter:()=>Ya(_e),isSelected:_e.id===D,isMultiSelected:rt.includes(_e.id),animationState:j.animationState,additionalClassName:"in-hand"},_e.id))})]})]})]}),h&&u.jsx(Q0,{onComplete:C}),ln&&u.jsx(_1,{onLoadScenario:Ee,onSkipCoinFlip:S})]})}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function w1({onPlayAgain:n,winner:o,finalState:c,difficulty:i}){if(!c)return u.jsxs("div",{className:"screen",children:[u.jsx("h1",{children:"Loading Results..."}),u.jsx("button",{className:"btn",onClick:n,children:"Back to Menu"})]});const r=o==="player",l=(s,f)=>{let p=[s];return f&&p.push("compiled"),p.join(" ")};return u.jsx("div",{className:`screen results-screen ${r?"victory":"defeat"}`,children:u.jsxs("div",{className:"results-screen-content",children:[u.jsxs("header",{className:"results-header",children:[u.jsx("h1",{children:r?"VICTORY":"DEFEAT"}),u.jsx("p",{children:r?"System compiled successfully.":"Critical error in the mainframe."})]}),u.jsxs("div",{className:"results-body",children:[u.jsxs("div",{className:"final-score-section",children:[u.jsx("h3",{children:"Final Score"}),u.jsxs("h4",{className:"results-label results-opponent-label",children:["Opponent (",i.charAt(0).toUpperCase()+i.slice(1),")"]}),u.jsxs("div",{className:"protocol-bars-container",children:[u.jsx("div",{className:"protocol-bar opponent-bar",children:c.opponent.protocols.map((s,f)=>u.jsxs("div",{className:l("protocol-display",c.opponent.compiled[f]),children:[u.jsx("span",{className:"protocol-name",children:s}),u.jsx("span",{className:"protocol-value",children:c.opponent.laneValues[f]})]},`opp-proto-${s}-${f}`))}),u.jsx("div",{className:"protocol-bar player-bar",children:c.player.protocols.map((s,f)=>u.jsxs("div",{className:l("protocol-display",c.player.compiled[f]),children:[u.jsx("span",{className:"protocol-name",children:s}),u.jsx("span",{className:"protocol-value",children:c.player.laneValues[f]})]},`player-proto-${s}-${f}`))})]}),u.jsx("h4",{className:"results-label results-player-label",children:"Player"})]}),u.jsxs("div",{className:"stats-section",children:[u.jsx("h3",{children:"Statistics"}),u.jsxs("div",{className:"stats-grid",children:[u.jsxs("div",{className:"stat-item",children:[u.jsx("span",{className:"stat-item-label",children:"Cards Played"}),u.jsx("span",{className:"stat-item-value opponent",children:c.stats.opponent.cardsPlayed}),u.jsx("span",{className:"stat-item-value player",children:c.stats.player.cardsPlayed})]}),u.jsxs("div",{className:"stat-item",children:[u.jsx("span",{className:"stat-item-label",children:"Cards Drawn"}),u.jsx("span",{className:"stat-item-value opponent",children:c.stats.opponent.cardsDrawn}),u.jsx("span",{className:"stat-item-value player",children:c.stats.player.cardsDrawn})]}),u.jsxs("div",{className:"stat-item",children:[u.jsx("span",{className:"stat-item-label",children:"Cards Discarded"}),u.jsx("span",{className:"stat-item-value opponent",children:c.stats.opponent.cardsDiscarded}),u.jsx("span",{className:"stat-item-value player",children:c.stats.player.cardsDiscarded})]}),u.jsxs("div",{className:"stat-item",children:[u.jsx("span",{className:"stat-item-label",children:"Cards Deleted"}),u.jsx("span",{className:"stat-item-value opponent",children:c.stats.opponent.cardsDeleted}),u.jsx("span",{className:"stat-item-value player",children:c.stats.player.cardsDeleted})]}),u.jsxs("div",{className:"stat-item",children:[u.jsx("span",{className:"stat-item-label",children:"Cards Flipped"}),u.jsx("span",{className:"stat-item-value opponent",children:c.stats.opponent.cardsFlipped}),u.jsx("span",{className:"stat-item-value player",children:c.stats.player.cardsFlipped})]}),u.jsxs("div",{className:"stat-item",children:[u.jsx("span",{className:"stat-item-label",children:"Cards Shifted"}),u.jsx("span",{className:"stat-item-value opponent",children:c.stats.opponent.cardsShifted}),u.jsx("span",{className:"stat-item-value player",children:c.stats.player.cardsShifted})]})]})]})]}),u.jsx("button",{className:"btn",onClick:n,children:"Play Again"})]})})}function x1({onBack:n}){const[o,c]=te.useState(0);te.useEffect(()=>{Yr(),c(S=>S+1)},[]);const i=te.useMemo(()=>{console.log("[Card Library] Loading cards, refreshKey:",o);const S=Ac(),E=S?Rc():[],j=[..._t,...E];return console.log("[Card Library] Total cards:",j.length,"(base:",_t.length,", custom:",E.length,", enabled:",S,")"),j},[o]),r=te.useMemo(()=>{const S=new Set(i.map(E=>E.protocol));return Array.from(S).sort()},[i]),[l,s]=te.useState(null),f=te.useMemo(()=>{const S=new Set(i.map(E=>E.category));return Array.from(S).sort()},[i]),[p,h]=te.useState(()=>new Set(f));te.useEffect(()=>{i.length>0&&!l&&s(i[0])},[i,l]);const _=S=>{h(E=>{const j=new Set(E);return j.has(S)?j.delete(S):j.add(S),j})},m=S=>{const E=i.find(j=>j.protocol===S);return(E==null?void 0:E.category)||""},v=te.useMemo(()=>r.filter(S=>{const E=m(S);return p.has(E)}),[r,p,i]),w=te.useMemo(()=>{const S={};for(const E of i)S[E.protocol]||(S[E.protocol]=[]),S[E.protocol].push(E);for(const E in S)S[E].sort((j,D)=>j.value-D.value);return S},[i]),x=S=>{s(S)},C=()=>{if(!l)return null;const S={...l,id:"preview",isFaceUp:!0};return u.jsx(an,{card:S,isFaceUp:!0})};return u.jsxs("div",{className:"screen card-library-screen",children:[u.jsx(id,{title:"Card Library",onBack:n}),u.jsxs("div",{className:"card-library-layout",children:[u.jsxs("div",{className:"game-preview-container",children:[u.jsx("h2",{children:"Card Preview"}),u.jsx("div",{className:"preview-card-area",children:C()})]}),u.jsxs("div",{className:"card-list-container",children:[u.jsx("div",{className:"category-filters",children:f.map(S=>u.jsxs("label",{className:"category-filter-item",children:[u.jsx("input",{type:"checkbox",checked:p.has(S),onChange:()=>_(S)}),u.jsx("span",{children:S})]},S))}),v.map(S=>u.jsxs("div",{className:"protocol-group",children:[u.jsxs("h3",{children:[S,u.jsxs("span",{className:"protocol-category-label",children:[" (",m(S),")"]})]}),u.jsx("div",{className:"protocol-card-grid",children:w[S].map(E=>{const j={...E,id:`${E.protocol}-${E.value}`,isFaceUp:!0};return u.jsx(an,{card:j,isFaceUp:!0,additionalClassName:"in-hand",onPointerEnter:()=>x(E),onPointerDown:()=>x(E)},j.id)})})]},S))]})]})]})}function C1({onBack:n}){const o=Wh(),c=t1(o),i=n1(o),r=o1(o),l=a1(o),s=r1(o),f=l1(o),p=c1(o);return u.jsxs("div",{className:"screen statistics-screen",children:[u.jsx(id,{title:"STATISTICS",onBack:n}),u.jsxs("div",{className:"stats-content",children:[u.jsxs("section",{className:"stats-section",children:[u.jsx("h2",{className:"section-title",children:"Overview"}),u.jsxs("div",{className:"stats-grid",children:[u.jsxs("div",{className:"stat-item",children:[u.jsx("span",{className:"stat-label",children:"Games Played"}),u.jsx("span",{className:"stat-value",children:o.global.totalGamesPlayed})]}),u.jsxs("div",{className:"stat-item",children:[u.jsx("span",{className:"stat-label",children:"Win Rate"}),u.jsxs("span",{className:"stat-value",children:[c.toFixed(1),"%"]})]}),u.jsxs("div",{className:"stat-item",children:[u.jsx("span",{className:"stat-label",children:"Games Won"}),u.jsx("span",{className:"stat-value win",children:o.global.totalGamesWon})]}),u.jsxs("div",{className:"stat-item",children:[u.jsx("span",{className:"stat-label",children:"Games Lost"}),u.jsx("span",{className:"stat-value loss",children:o.global.totalGamesLost})]})]})]}),u.jsxs("section",{className:"stats-section",children:[u.jsx("h2",{className:"section-title",children:"Streaks"}),u.jsxs("div",{className:"stats-grid",children:[u.jsxs("div",{className:"stat-item",children:[u.jsx("span",{className:"stat-label",children:"Current Streak"}),u.jsx("span",{className:`stat-value ${o.global.currentStreak>0?"win":o.global.currentStreak<0?"loss":""}`,children:o.global.currentStreak>0?`+${o.global.currentStreak}`:o.global.currentStreak})]}),u.jsxs("div",{className:"stat-item",children:[u.jsx("span",{className:"stat-label",children:"Best Win Streak"}),u.jsx("span",{className:"stat-value win",children:o.global.longestWinStreak})]})]})]}),u.jsxs("section",{className:"stats-section",children:[u.jsx("h2",{className:"section-title",children:"Playtime"}),u.jsxs("div",{className:"stats-grid",children:[u.jsxs("div",{className:"stat-item",children:[u.jsx("span",{className:"stat-label",children:"Total Playtime"}),u.jsx("span",{className:"stat-value",children:zr(o.global.totalPlaytime)})]}),u.jsxs("div",{className:"stat-item",children:[u.jsx("span",{className:"stat-label",children:"Average Game"}),u.jsx("span",{className:"stat-value",children:zr(i)})]}),o.global.fastestWin&&u.jsxs("div",{className:"stat-item",children:[u.jsx("span",{className:"stat-label",children:"Fastest Win"}),u.jsx("span",{className:"stat-value",children:zr(o.global.fastestWin)})]}),o.global.longestGame&&u.jsxs("div",{className:"stat-item",children:[u.jsx("span",{className:"stat-label",children:"Longest Game"}),u.jsx("span",{className:"stat-value",children:zr(o.global.longestGame)})]}),o.global.lastGameDuration&&u.jsxs("div",{className:"stat-item",children:[u.jsx("span",{className:"stat-label",children:"Last Game"}),u.jsx("span",{className:"stat-value",children:zr(o.global.lastGameDuration)})]})]})]}),u.jsxs("section",{className:"stats-section",children:[u.jsx("h2",{className:"section-title",children:"AI Performance"}),u.jsx("div",{className:"ai-stats",children:["easy","normal","hard"].map(h=>{const _=o.aiDifficulty[h],m=_.played>0?_.wins/_.played*100:0;return u.jsxs("div",{className:"ai-item",children:[u.jsx("span",{className:"ai-name",children:h}),u.jsxs("span",{className:"ai-record",children:[u.jsxs("span",{className:"win",children:[_.wins,"W"]})," - ",u.jsxs("span",{className:"loss",children:[_.losses,"L"]})]}),u.jsxs("span",{className:"ai-winrate",children:["(",m.toFixed(1),"%)"]})]},h)})})]}),l.length>0&&u.jsxs("section",{className:"stats-section",children:[u.jsx("h2",{className:"section-title",children:"Best Win Rate"}),u.jsx("div",{className:"protocol-list",children:l.map((h,_)=>u.jsxs("div",{className:"protocol-item",children:[u.jsxs("span",{className:"protocol-rank",children:[_+1,"."]}),u.jsx("span",{className:"protocol-name",children:h.protocol}),u.jsxs("span",{className:"protocol-stats win",children:[h.winRate.toFixed(0),"%  ",h.timesUsed]})]},h.protocol))})]}),r.length>0&&u.jsxs("section",{className:"stats-section",children:[u.jsx("h2",{className:"section-title",children:"Favorite Protocols"}),u.jsx("div",{className:"protocol-list",children:r.map((h,_)=>u.jsxs("div",{className:"protocol-item",children:[u.jsxs("span",{className:"protocol-rank",children:[_+1,"."]}),u.jsx("span",{className:"protocol-name",children:h.protocol}),u.jsxs("span",{className:"protocol-stats",children:[h.timesUsed,"  ",h.winRate.toFixed(0),"%"]})]},h.protocol))})]}),s.length>0&&u.jsxs("section",{className:"stats-section",children:[u.jsx("h2",{className:"section-title",children:"Least Used Protocols"}),u.jsx("div",{className:"protocol-list",children:s.map((h,_)=>u.jsxs("div",{className:"protocol-item",children:[u.jsxs("span",{className:"protocol-rank",children:[_+1,"."]}),u.jsx("span",{className:"protocol-name",children:h.protocol}),u.jsxs("span",{className:"protocol-stats",children:[h.timesUsed,"  ",h.winRate.toFixed(0),"%"]})]},h.protocol))})]}),f.length>0&&u.jsxs("section",{className:"stats-section",children:[u.jsx("h2",{className:"section-title",children:"Most Played Cards"}),u.jsx("div",{className:"card-list",children:f.map((h,_)=>u.jsxs("div",{className:"card-item",children:[u.jsxs("span",{className:"card-rank",children:[_+1,"."]}),u.jsx("span",{className:"card-name",children:h.card}),u.jsxs("span",{className:"card-count",children:[h.count,""]})]},h.card))})]}),p.length>0&&u.jsxs("section",{className:"stats-section",children:[u.jsx("h2",{className:"section-title",children:"Most Deleted Cards"}),u.jsx("div",{className:"card-list",children:p.map((h,_)=>u.jsxs("div",{className:"card-item",children:[u.jsxs("span",{className:"card-rank",children:[_+1,"."]}),u.jsx("span",{className:"card-name",children:h.card}),u.jsxs("span",{className:"card-count",children:[h.count,""]})]},h.card))})]}),u.jsxs("section",{className:"stats-section",children:[u.jsx("h2",{className:"section-title",children:"Control Mechanic"}),u.jsxs("div",{className:"stats-grid",children:[u.jsxs("div",{className:"stat-item",children:[u.jsx("span",{className:"stat-label",children:"With Control"}),u.jsx("span",{className:"stat-value",children:o.control.gamesWithControl})]}),u.jsxs("div",{className:"stat-item",children:[u.jsx("span",{className:"stat-label",children:"Without Control"}),u.jsx("span",{className:"stat-value",children:o.control.gamesWithoutControl})]}),u.jsxs("div",{className:"stat-item",children:[u.jsx("span",{className:"stat-label",children:"Your Rearranges"}),u.jsx("span",{className:"stat-value",children:o.control.playerRearranges})]}),u.jsxs("div",{className:"stat-item",children:[u.jsx("span",{className:"stat-label",children:"AI Rearranges"}),u.jsx("span",{className:"stat-value",children:o.control.aiRearranges})]}),u.jsxs("div",{className:"stat-item",children:[u.jsx("span",{className:"stat-label",children:"Total Rearranges"}),u.jsx("span",{className:"stat-value",children:o.control.totalRearranges})]})]})]}),u.jsxs("section",{className:"stats-section",children:[u.jsx("h2",{className:"section-title",children:"Coin Flip"}),u.jsxs("div",{className:"stats-grid",children:[u.jsxs("div",{className:"stat-item",children:[u.jsx("span",{className:"stat-label",children:"Heads Chosen"}),u.jsxs("span",{className:"stat-value",children:[o.coinFlip.headsChosen," (",o.coinFlip.headsChosen>0?(o.coinFlip.headsWon/o.coinFlip.headsChosen*100).toFixed(0):0,"%)"]})]}),u.jsxs("div",{className:"stat-item",children:[u.jsx("span",{className:"stat-label",children:"Tails Chosen"}),u.jsxs("span",{className:"stat-value",children:[o.coinFlip.tailsChosen," (",o.coinFlip.tailsChosen>0?(o.coinFlip.tailsWon/o.coinFlip.tailsChosen*100).toFixed(0):0,"%)"]})]})]})]}),u.jsxs("section",{className:"stats-section full-width",children:[u.jsx("h2",{className:"section-title",children:"Actions"}),u.jsxs("div",{className:"stats-grid",style:{gridTemplateColumns:"repeat(4, 1fr)"},children:[u.jsxs("div",{className:"stat-item",children:[u.jsx("span",{className:"stat-label",children:"Cards Played"}),u.jsx("span",{className:"stat-value",children:o.actions.totalCardsPlayed})]}),u.jsxs("div",{className:"stat-item",children:[u.jsx("span",{className:"stat-label",children:"Cards Drawn"}),u.jsx("span",{className:"stat-value",children:o.actions.totalCardsDrawn})]}),u.jsxs("div",{className:"stat-item",children:[u.jsx("span",{className:"stat-label",children:"Discards"}),u.jsx("span",{className:"stat-value",children:o.actions.totalDiscards})]}),u.jsxs("div",{className:"stat-item",children:[u.jsx("span",{className:"stat-label",children:"Deletes"}),u.jsx("span",{className:"stat-value",children:o.actions.totalDeletes})]}),u.jsxs("div",{className:"stat-item",children:[u.jsx("span",{className:"stat-label",children:"Flips"}),u.jsx("span",{className:"stat-value",children:o.actions.totalFlips})]}),u.jsxs("div",{className:"stat-item",children:[u.jsx("span",{className:"stat-label",children:"Shifts"}),u.jsx("span",{className:"stat-value",children:o.actions.totalShifts})]}),u.jsxs("div",{className:"stat-item",children:[u.jsx("span",{className:"stat-label",children:"Compiles"}),u.jsx("span",{className:"stat-value",children:o.actions.totalCompiles})]}),u.jsxs("div",{className:"stat-item",children:[u.jsx("span",{className:"stat-label",children:"Refreshes"}),u.jsx("span",{className:"stat-value",children:o.actions.totalRefreshes})]})]})]})]})]})}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Cy="custom_protocols_v1",cd=1,kc=()=>{try{const n=localStorage.getItem(Cy);if(!n)return[];const o=JSON.parse(n);return o.version!==cd&&console.warn(`Custom protocol storage version mismatch: expected ${cd}, got ${o.version}`),o.protocols||[]}catch(n){return console.error("Error loading custom protocols:",n),[]}},Sy=n=>{try{const o={protocols:n,version:cd};localStorage.setItem(Cy,JSON.stringify(o))}catch(o){console.error("Error saving custom protocols:",o)}},aa=n=>{const o=kc(),c=o.findIndex(i=>i.id===n.id);c>=0?o[c]=n:o.push(n),Sy(o)},S1=n=>{const c=kc().filter(i=>i.id!==n);Sy(c)},b1=(n,o)=>{const c=(r,l)=>{r=r.replace("#","");const s=parseInt(r.substring(0,2),16),f=parseInt(r.substring(2,4),16),p=parseInt(r.substring(4,6),16);return`rgba(${s}, ${f}, ${p}, ${l})`},i={borderColor:o};switch(n){case"solid":return{...i,backgroundColor:o};case"radial":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`radial-gradient(circle at 50% 50%, ${c(o,.25)} 0%, transparent 60%)`};case"dual-radial":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 0% 0%, ${c(o,.2)}, transparent 50%),
                    radial-gradient(at 100% 100%, ${c(o,.2)}, transparent 50%)
                `};case"multi-radial":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 0%, ${c(o,.2)}, transparent 70%),
                    radial-gradient(circle at 20% 30%, ${c(o,.15)}, transparent 40%),
                    radial-gradient(circle at 80% 70%, ${c(o,.2)}, transparent 50%)
                `};case"chaos":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 10% 10%, hsla(60, 100%, 50%, 0.15), transparent 30%),
                    radial-gradient(at 90% 20%, hsla(180, 100%, 50%, 0.15), transparent 35%),
                    radial-gradient(at 30% 80%, hsla(300, 100%, 50%, 0.15), transparent 40%),
                    radial-gradient(at 70% 60%, hsla(0, 100%, 50%, 0.1), transparent 25%)
                `};case"grid":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(circle at 50% 50%, ${c(o,.2)} 0%, transparent 40%),
                    linear-gradient(hsla(0,0%,100%,0.03) 1px, transparent 1px),
                    linear-gradient(90deg, hsla(0,0%,100%,0.03) 1px, transparent 1px)
                `,backgroundSize:"100% 100%, 20px 20px, 20px 20px"};case"diagonal-lines":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 0% 100%, ${c(o,.25)}, transparent 70%),
                    repeating-linear-gradient(120deg, transparent, transparent 15px, ${c(o,.05)} 15px, ${c(o,.05)} 30px)
                `};case"cross-diagonal":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 50%, ${c(o,.25)} 0%, transparent 50%),
                    repeating-linear-gradient(45deg, transparent, transparent 8px, ${c(o,.08)} 8px, ${c(o,.08)} 16px),
                    repeating-linear-gradient(-45deg, transparent, transparent 8px, ${c(o,.06)} 8px, ${c(o,.06)} 16px)
                `};case"horizontal-lines":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 80% 80%, ${c(o,.1)}, transparent 50%),
                    repeating-linear-gradient(0deg, hsla(0,0%,100%,0.02), hsla(0,0%,100%,0.02) 1px, transparent 1px, transparent 3px)
                `};case"vertical-lines":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 10% 10%, ${c(o,.2)}, transparent 50%),
                    repeating-linear-gradient(175deg, transparent, transparent 1px, ${c(o,.05)} 1px, ${c(o,.05)} 2px)
                `};case"cross":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    linear-gradient(0deg, transparent 40%, ${c(o,.1)} 50%, transparent 60%),
                    linear-gradient(90deg, transparent 48%, ${c(o,.2)} 50%, transparent 52%)
                `};case"hexagons":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 0%, ${c(o,.2)}, transparent 70%),
                    url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='28' height='49' viewBox='0 0 28 49'%3E%3Cg fill-rule='evenodd'%3E%3Cg id='hexagons' fill='${encodeURIComponent(o)}' fill-opacity='0.05' fill-rule='nonzero'%3E%3Cpath d='M13.99 9.25l13 7.5v15l-13 7.5L1 31.75v-15l12.99-7.5zM3 17.9v12.7l10.99 6.34 11-6.35V17.9l-11-6.34L3 17.9zM0 15l12.99-7.5L26 15v18.5l-13 7.5L0 33.5V15z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")
                `};case"stripes":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 100%, ${c(o,.25)}, transparent 60%),
                    linear-gradient(135deg, hsla(0,0%,0%,0.1) 23%, transparent 23%, transparent 25%, hsla(0,0%,0%,0.1) 25%, hsla(0,0%,0%,0.1) 27%, transparent 27%, transparent 73%, hsla(0,0%,0%,0.1) 73%, hsla(0,0%,0%,0.1) 75%, transparent 75%, transparent 77%, hsla(0,0%,0%,0.1) 77%)
                `};default:return{...i,backgroundColor:o}}},E1=({protocols:n,onCreateNew:o,onEdit:c,onDelete:i,onBack:r})=>{const[l,s]=zi.useState(!1),[f,p]=zi.useState(""),[h,_]=zi.useState(""),m=()=>{_("");try{const v=JSON.parse(f);if(!v.name||!v.color||!v.pattern||!Array.isArray(v.cards)){_("Invalid protocol format. Missing required fields.");return}if(v.cards.length!==6){_("Invalid protocol: must have exactly 6 cards.");return}const w=n.find(x=>x.name.toLowerCase()===v.name.toLowerCase());if(w){confirm(`A protocol named "${v.name}" already exists. Overwrite it?`)&&(v.id=w.id,onImport(v),s(!1),p(""),alert("Protocol imported and overwritten successfully!"));return}v.id=Date.now().toString(),v.createdAt=new Date().toISOString(),onImport(v),s(!1),p(""),alert("Protocol imported successfully!")}catch{_("Invalid JSON format. Please check your input.")}};return u.jsxs("div",{className:"protocol-list",children:[u.jsxs("div",{className:"list-header",children:[u.jsx("h2",{children:"Custom Protocols"}),u.jsxs("div",{className:"header-actions",children:[u.jsx("button",{onClick:()=>s(!0),className:"btn",children:"Import Protocol"}),r&&u.jsx("button",{onClick:r,className:"btn btn-back",children:"Back"})]})]}),l&&u.jsx("div",{className:"custom-protocol-modal-overlay",onClick:()=>s(!1),children:u.jsxs("div",{className:"custom-protocol-modal-content",onClick:v=>v.stopPropagation(),children:[u.jsx("h3",{children:"Import Protocol"}),u.jsx("p",{children:"Paste the protocol JSON below:"}),u.jsx("textarea",{value:f,onChange:v=>p(v.target.value),placeholder:'{"name":"Protocol Name","color":"#1976D2",...}',rows:10,className:"import-textarea"}),h&&u.jsx("div",{className:"error-message",children:h}),u.jsxs("div",{className:"custom-protocol-modal-actions",children:[u.jsx("button",{onClick:()=>s(!1),className:"btn btn-back",children:"Cancel"}),u.jsx("button",{onClick:m,className:"btn",children:"Import"})]})]})}),u.jsxs("div",{className:"protocols-grid",children:[u.jsxs("div",{className:"protocol-card new-protocol-card",onClick:o,children:[u.jsx("div",{className:"protocol-header new-protocol-header",children:u.jsxs("div",{className:"protocol-header-content",children:[u.jsx("h3",{children:"+ New Protocol"}),u.jsx("p",{className:"header-description",children:"Create a custom protocol"})]})}),u.jsx("div",{className:"protocol-body new-protocol-body"})]}),n.map(v=>u.jsx("div",{className:"protocol-card",style:b1(v.pattern,v.color),onClick:()=>c(v),children:u.jsxs("div",{className:"protocol-header-content",children:[u.jsx("h3",{children:v.name}),v.description&&u.jsx("p",{className:"header-description",children:v.description})]})},v.id))]})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const by=({params:n,onChange:o})=>{var c,i,r,l;return u.jsxs("div",{className:"param-editor draw-effect-editor",children:[u.jsx("h4",{children:"Draw Effect Parameters"}),u.jsxs("label",{children:["Count Type",u.jsxs("select",{value:n.countType||"fixed",onChange:s=>{const f=s.target.value;o({...n,countType:f,countOffset:f==="equal_to_discarded"?0:void 0})},children:[u.jsx("option",{value:"fixed",children:"Fixed Amount"}),u.jsx("option",{value:"equal_to_card_value",children:"Equal to Card Value (from previous effect)"}),u.jsx("option",{value:"equal_to_discarded",children:"Equal to Discarded Cards"}),u.jsx("option",{value:"hand_size",children:"Equal to Hand Size"})]})]}),(!n.countType||n.countType==="fixed")&&u.jsxs("label",{children:["Card Count",u.jsx("input",{type:"number",min:1,max:6,value:n.count,onChange:s=>o({...n,count:parseInt(s.target.value)||1})})]}),n.countType==="equal_to_discarded"&&u.jsxs("label",{children:["Offset (+/-)",u.jsx("input",{type:"number",min:-5,max:5,value:n.countOffset||0,onChange:s=>o({...n,countOffset:parseInt(s.target.value)||0})}),u.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:'Example: +1 for "discard count plus 1" (Fire-4)'})]}),u.jsxs("label",{children:["Target",u.jsxs("select",{value:n.target,onChange:s=>o({...n,target:s.target.value}),children:[u.jsx("option",{value:"self",children:"Self"}),u.jsx("option",{value:"opponent",children:"Opponent"})]})]}),u.jsxs("label",{children:["Source",u.jsxs("select",{value:n.source,onChange:s=>o({...n,source:s.target.value}),children:[u.jsx("option",{value:"own_deck",children:"Own Deck"}),u.jsx("option",{value:"opponent_deck",children:"Opponent's Deck"})]})]}),u.jsxs("label",{children:[u.jsx("input",{type:"checkbox",checked:n.preAction==="refresh",onChange:s=>o({...n,preAction:s.target.checked?"refresh":void 0})}),"Refresh hand first (shuffle hand into deck, then draw)"]}),u.jsxs("label",{children:[u.jsx("input",{type:"checkbox",checked:n.optional||!1,onChange:s=>o({...n,optional:s.target.checked})}),'Optional ("You may draw" instead of "Draw")']}),u.jsxs("label",{children:["Conditional",u.jsxs("select",{value:((c=n.conditional)==null?void 0:c.type)||"none",onChange:s=>{if(s.target.value==="none"){const{conditional:f,...p}=n;o(p)}else o({...n,conditional:{type:s.target.value}})},children:[u.jsx("option",{value:"none",children:"None"}),u.jsx("option",{value:"count_face_down",children:"1 per face-down card (all on board)"}),u.jsx("option",{value:"is_covering",children:"Only if this card is covering another"}),u.jsx("option",{value:"non_matching_protocols",children:"1 per line with non-matching protocol"})]})]}),u.jsxs("label",{children:["Advanced Conditional",u.jsxs("select",{value:((i=n.advancedConditional)==null?void 0:i.type)||"none",onChange:s=>{if(s.target.value==="none"){const{advancedConditional:f,...p}=n;o(p)}else s.target.value==="protocol_match"?o({...n,advancedConditional:{type:"protocol_match",protocol:""}}):s.target.value==="compile_block"&&o({...n,advancedConditional:{type:"compile_block",turnDuration:1}})},children:[u.jsx("option",{value:"none",children:"None"}),u.jsx("option",{value:"protocol_match",children:"Only if in line with matching protocol (Anarchy-6)"}),u.jsx("option",{value:"compile_block",children:"Block opponent's compile next turn (Metal-1)"})]})]}),((r=n.advancedConditional)==null?void 0:r.type)==="protocol_match"&&u.jsxs("label",{children:["Required Protocol",u.jsx("input",{type:"text",placeholder:"e.g., Fire, Water, Lightning",value:n.advancedConditional.protocol||"",onChange:s=>o({...n,advancedConditional:{...n.advancedConditional,type:"protocol_match",protocol:s.target.value}})}),u.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"Only draw if this card is in a line with this protocol"})]}),((l=n.advancedConditional)==null?void 0:l.type)==="compile_block"&&u.jsxs("label",{children:["Block Duration (turns)",u.jsx("input",{type:"number",min:1,max:3,value:n.advancedConditional.turnDuration||1,onChange:s=>o({...n,advancedConditional:{...n.advancedConditional,type:"compile_block",turnDuration:parseInt(s.target.value)||1}})}),u.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"Opponent can't compile for this many turns"})]}),u.jsxs("div",{className:"effect-preview",children:[u.jsx("strong",{children:"Preview:"})," ",j1(n)]})]})},j1=n=>{if(n.conditional)switch(n.conditional.type){case"count_face_down":return"Draw 1 card for each face-down card.";case"is_covering":return`Draw ${n.count} card${n.count!==1?"s":""} if this card is covering another.`;case"non_matching_protocols":return"Draw 1 card for each line with a non-matching protocol."}let o="";n.preAction==="refresh"&&(o="Refresh your hand. ");const c=n.countType||"fixed";let i="";switch(c){case"equal_to_card_value":i="cards equal to that card's value";break;case"equal_to_discarded":const r=n.countOffset||0;r>0?i=`the amount discarded plus ${r}`:r<0?i=`the amount discarded minus ${Math.abs(r)}`:i="the same amount of cards";break;case"hand_size":i="the same amount of cards";break;default:i=`${n.count} card${n.count!==1?"s":""}`;break}if(n.source==="opponent_deck"?o+=`Draw ${i} from opponent's deck.`:n.target==="opponent"?o+=`Opponent draws ${i}.`:o+=`Draw ${i}.`,n.advancedConditional)switch(n.advancedConditional.type){case"protocol_match":const r=n.advancedConditional.protocol||"[Protocol]";o+=` Only if in ${r} line.`;break;case"compile_block":const l=n.advancedConditional.turnDuration||1;o+=` Opponent can't compile for ${l} ${l===1?"turn":"turns"}.`;break}return o};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Ey=({params:n,onChange:o})=>{var i,r;const c=n.targetFilter||{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1};return u.jsxs("div",{className:"param-editor flip-effect-editor",children:[u.jsx("h4",{children:"Flip Effect Parameters"}),u.jsxs("label",{children:["Card Count/Scope",u.jsxs("select",{value:n.count==="all"?"all":n.count==="each"?"each":n.count.toString(),onChange:l=>{const s=l.target.value;o(s==="all"?{...n,count:"all"}:s==="each"?{...n,count:"each"}:{...n,count:parseInt(s)})},children:[u.jsx("option",{value:"1",children:"1 card"}),u.jsx("option",{value:"2",children:"2 cards"}),u.jsx("option",{value:"3",children:"3 cards"}),u.jsx("option",{value:"all",children:"All matching cards"}),u.jsx("option",{value:"each",children:"Each matching card"})]})]}),u.jsxs("label",{children:[u.jsx("input",{type:"checkbox",checked:n.optional,onChange:l=>o({...n,optional:l.target.checked})}),'Optional ("May flip" instead of "Flip")']}),n.count==="each"&&u.jsxs("label",{children:["Each Line Scope",u.jsxs("select",{value:n.eachLineScope||"all_lines",onChange:l=>o({...n,eachLineScope:l.target.value}),children:[u.jsx("option",{value:"all_lines",children:"Each card on board"}),u.jsx("option",{value:"each_line",children:"1 card in each line"})]})]}),u.jsxs("label",{children:[u.jsx("input",{type:"checkbox",checked:n.selfFlipAfter||!1,onChange:l=>o({...n,selfFlipAfter:l.target.checked})}),"Then flip this card"]}),u.jsxs("label",{children:[u.jsx("input",{type:"checkbox",checked:n.flipSelf||!1,onChange:l=>o({...n,flipSelf:l.target.checked})}),"Flip this card (instead of selecting target)"]}),u.jsx("h5",{children:"Advanced Conditional"}),u.jsxs("label",{children:["Conditional Type",u.jsxs("select",{value:((i=n.advancedConditional)==null?void 0:i.type)||"",onChange:l=>{if(l.target.value===""){const{advancedConditional:s,...f}=n;o(f)}else o({...n,advancedConditional:{type:l.target.value}})},children:[u.jsx("option",{value:"",children:"None"}),u.jsx("option",{value:"protocol_match",children:"Only if in specific protocol line"})]})]}),((r=n.advancedConditional)==null?void 0:r.type)==="protocol_match"&&u.jsxs("label",{children:["Required Protocol",u.jsx("input",{type:"text",value:n.advancedConditional.protocol||"",onChange:l=>o({...n,advancedConditional:{...n.advancedConditional,protocol:l.target.value}}),placeholder:"e.g., Anarchy, Fire, Death"})]}),u.jsx("h5",{children:"Target Filter"}),u.jsxs("label",{children:["Owner",u.jsxs("select",{value:c.owner,onChange:l=>o({...n,targetFilter:{...c,owner:l.target.value}}),children:[u.jsx("option",{value:"any",children:"Any"}),u.jsx("option",{value:"own",children:"Own"}),u.jsx("option",{value:"opponent",children:"Opponent"})]})]}),u.jsxs("label",{children:["Position",u.jsxs("select",{value:c.position,onChange:l=>o({...n,targetFilter:{...c,position:l.target.value}}),children:[u.jsx("option",{value:"any",children:"Any"}),u.jsx("option",{value:"uncovered",children:"Uncovered (top card)"}),u.jsx("option",{value:"covered",children:"Covered"}),u.jsx("option",{value:"covered_in_this_line",children:"Covered in this line"})]})]}),u.jsxs("label",{children:["Face State",u.jsxs("select",{value:c.faceState,onChange:l=>o({...n,targetFilter:{...c,faceState:l.target.value}}),children:[u.jsx("option",{value:"any",children:"Any"}),u.jsx("option",{value:"face_up",children:"Face-up"}),u.jsx("option",{value:"face_down",children:"Face-down"})]})]}),u.jsxs("label",{children:[u.jsx("input",{type:"checkbox",checked:c.excludeSelf,onChange:l=>o({...n,targetFilter:{...c,excludeSelf:l.target.checked}})}),'Exclude self ("other cards")']}),u.jsxs("div",{className:"effect-preview",children:[u.jsx("strong",{children:"Preview:"})," ",R1(n)]})]})},R1=n=>{var f;if(n.flipSelf){let p=n.optional?"May flip this card":"Flip this card";return((f=n.advancedConditional)==null?void 0:f.type)==="protocol_match"&&(p+=`, if this card is in the line with the ${n.advancedConditional.protocol||"[Protocol]"} protocol`),p+=".",p}const o=n.targetFilter||{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1},c=n.optional?"May flip":"Flip";let i="";o.owner==="opponent"&&(i="opponent's "),o.position==="covered"&&(i+="covered "),o.position==="uncovered"&&(i+="uncovered "),o.faceState==="face_down"&&(i+="face-down "),o.faceState==="face_up"&&(i+="face-up "),o.excludeSelf&&(i+="other ");let r="";n.count==="all"?r="all":n.count==="each"?n.eachLineScope==="each_line"?(r="1",i=i+"(in each line) "):r="each":r=n.count.toString();const l=n.count===1?"card":"cards";let s=`${c} ${r} ${i}${l}.`;return n.selfFlipAfter&&(s+=" Then flip this card."),s};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const jy=({params:n,onChange:o})=>{var c;return u.jsxs("div",{className:"param-editor",children:[u.jsx("h4",{children:"Shift Effect"}),u.jsxs("label",{children:["Count/Scope",u.jsxs("select",{value:n.count==="all"?"all":"1",onChange:i=>{if(i.target.value==="all")o({...n,count:"all"});else{const{count:r,...l}=n;o(l)}},children:[u.jsx("option",{value:"1",children:"1 card"}),u.jsx("option",{value:"all",children:"All matching cards"})]})]}),u.jsxs("label",{children:["Target Owner",u.jsxs("select",{value:n.targetFilter.owner,onChange:i=>o({...n,targetFilter:{...n.targetFilter,owner:i.target.value}}),children:[u.jsx("option",{value:"any",children:"Any"}),u.jsx("option",{value:"own",children:"Own"}),u.jsx("option",{value:"opponent",children:"Opponent"})]})]}),u.jsxs("label",{children:["Position",u.jsxs("select",{value:n.targetFilter.position,onChange:i=>o({...n,targetFilter:{...n.targetFilter,position:i.target.value}}),children:[u.jsx("option",{value:"any",children:"Any"}),u.jsx("option",{value:"uncovered",children:"Uncovered"}),u.jsx("option",{value:"covered",children:"Covered"})]})]}),u.jsxs("label",{children:["Face State",u.jsxs("select",{value:n.targetFilter.faceState,onChange:i=>o({...n,targetFilter:{...n.targetFilter,faceState:i.target.value}}),children:[u.jsx("option",{value:"any",children:"Any"}),u.jsx("option",{value:"face_up",children:"Face-up"}),u.jsx("option",{value:"face_down",children:"Face-down"})]})]}),u.jsxs("label",{children:[u.jsx("input",{type:"checkbox",checked:n.targetFilter.excludeSelf||!1,onChange:i=>o({...n,targetFilter:{...n.targetFilter,excludeSelf:i.target.checked}})}),'Exclude self ("other card")']}),u.jsxs("label",{children:[u.jsx("input",{type:"checkbox",checked:n.optional||!1,onChange:i=>o({...n,optional:i.target.checked})}),'Optional ("You may shift" instead of "Shift")']}),u.jsxs("label",{children:["Destination",u.jsxs("select",{value:((c=n.destinationRestriction)==null?void 0:c.type)||"any",onChange:i=>{if(i.target.value==="any"){const{destinationRestriction:r,...l}=n;o(l)}else o({...n,destinationRestriction:{type:i.target.value}})},children:[u.jsx("option",{value:"any",children:"Any line"}),u.jsx("option",{value:"to_another_line",children:"To another line"}),u.jsx("option",{value:"non_matching_protocol",children:"Non-matching protocol"}),u.jsx("option",{value:"specific_lane",children:"This line (within)"})]})]}),u.jsxs("div",{className:"effect-preview",children:[u.jsx("strong",{children:"Preview:"})," ",A1(n)]})]})},A1=n=>{var s,f,p;const o=n.optional?"You may shift":"Shift";let c="";n.targetFilter.owner==="opponent"&&(c+="opponent's "),n.targetFilter.excludeSelf&&(c+="other "),n.targetFilter.position==="covered"&&(c+="covered "),n.targetFilter.position==="uncovered"&&(c+="uncovered "),n.targetFilter.faceState==="face_down"&&(c+="face-down "),n.targetFilter.faceState==="face_up"&&(c+="face-up ");const i=n.count==="all"?"all":"1";let l=`${o} ${i} ${c}${i==="1"?"card":"cards"}`;return((s=n.destinationRestriction)==null?void 0:s.type)==="non_matching_protocol"?l+=" to a line without a matching protocol":((f=n.destinationRestriction)==null?void 0:f.type)==="specific_lane"?l+=" within this line":((p=n.destinationRestriction)==null?void 0:p.type)==="to_another_line"&&(l+=" to another line"),l+"."};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Ry=({params:n,onChange:o})=>{var i,r,l,s,f;const c=n.targetFilter||{position:"uncovered",faceState:"any"};return u.jsxs("div",{className:"param-editor delete-effect-editor",children:[u.jsx("h4",{children:"Delete Effect Parameters"}),u.jsxs("label",{children:["Anzahl",u.jsxs("select",{value:typeof n.count=="number"?n.count.toString():"all",onChange:p=>o({...n,count:p.target.value==="all"?"all_in_lane":parseInt(p.target.value)}),children:[u.jsx("option",{value:"1",children:"1"}),u.jsx("option",{value:"2",children:"2"}),u.jsx("option",{value:"3",children:"3"}),u.jsx("option",{value:"all",children:"Alle in einer Lane"})]})]}),u.jsxs("label",{children:[u.jsx("input",{type:"checkbox",checked:n.excludeSelf,onChange:p=>o({...n,excludeSelf:p.target.checked})}),"Exclude self (other cards only)"]}),u.jsxs("label",{children:[u.jsx("input",{type:"checkbox",checked:n.deleteSelf||!1,onChange:p=>o({...n,deleteSelf:p.target.checked})}),"Delete this card (ignores all other settings)"]}),u.jsx("h5",{children:"Target Filter"}),u.jsxs("label",{children:["Position",u.jsxs("select",{value:c.position,onChange:p=>o({...n,targetFilter:{...c,position:p.target.value}}),children:[u.jsx("option",{value:"any",children:"Any"}),u.jsx("option",{value:"uncovered",children:"Uncovered"}),u.jsx("option",{value:"covered",children:"Covered"})]})]}),u.jsxs("label",{children:["Face State",u.jsxs("select",{value:c.faceState,onChange:p=>o({...n,targetFilter:{...c,faceState:p.target.value}}),children:[u.jsx("option",{value:"any",children:"Any"}),u.jsx("option",{value:"face_up",children:"Face-up"}),u.jsx("option",{value:"face_down",children:"Face-down"})]})]}),u.jsxs("label",{children:["Owner",u.jsxs("select",{value:c.owner||"any",onChange:p=>{const h=p.target.value,_={...c};h==="any"?delete _.owner:_.owner=h,o({...n,targetFilter:_})},children:[u.jsx("option",{value:"any",children:"Any (own or opponent)"}),u.jsx("option",{value:"own",children:"Own cards only"}),u.jsx("option",{value:"opponent",children:"Opponent's cards only"})]})]}),u.jsxs("label",{children:["Calculation",u.jsxs("select",{value:c.calculation||"none",onChange:p=>{const h=p.target.value,_={...c};h==="none"?delete _.calculation:_.calculation=h,o({...n,targetFilter:_})},children:[u.jsx("option",{value:"none",children:"None"}),u.jsx("option",{value:"highest_value",children:"Highest value"}),u.jsx("option",{value:"lowest_value",children:"Lowest value"})]})]}),u.jsxs("label",{children:["Value Range (specific values to target)",u.jsxs("select",{value:c.valueRange?`${c.valueRange.min}-${c.valueRange.max}`:"none",onChange:p=>{const h=p.target.value,_={...c};h==="none"?delete _.valueRange:h==="0-1"?_.valueRange={min:0,max:1}:h==="1-2"?_.valueRange={min:1,max:2}:h==="0-0"&&(_.valueRange={min:0,max:0}),o({...n,targetFilter:_})},children:[u.jsx("option",{value:"none",children:"Any value"}),u.jsx("option",{value:"0-0",children:"Value 0 only"}),u.jsx("option",{value:"0-1",children:"Values 0 or 1"}),u.jsx("option",{value:"1-2",children:"Values 1 or 2"})]})]}),u.jsx("h5",{children:"Scope"}),u.jsxs("label",{children:["Lane Scope",u.jsxs("select",{value:((i=n.scope)==null?void 0:i.type)||"any",onChange:p=>{const h=p.target.value;if(h==="any"){const{scope:_,...m}=n;o(m)}else o({...n,scope:{type:h}})},children:[u.jsx("option",{value:"any",children:"Any lane"}),u.jsx("option",{value:"this_line",children:"This line only"}),u.jsx("option",{value:"other_lanes",children:"Other lanes"}),u.jsx("option",{value:"each_other_line",children:"Each other line (1 per line)"})]})]}),(((r=n.scope)==null?void 0:r.type)==="other_lanes"||((l=n.scope)==null?void 0:l.type)==="any")&&u.jsxs("label",{children:["Minimum Cards in Lane",u.jsxs("select",{value:((s=n.scope)==null?void 0:s.minCardsInLane)||0,onChange:p=>{const h=parseInt(p.target.value);if(h===0){const _={...n.scope};delete _.minCardsInLane,o({...n,scope:_})}else o({...n,scope:{...n.scope,minCardsInLane:h}})},children:[u.jsx("option",{value:0,children:"No minimum"}),u.jsx("option",{value:8,children:"8 or more cards (Metal-3)"}),u.jsx("option",{value:6,children:"6 or more cards"}),u.jsx("option",{value:4,children:"4 or more cards"})]}),((f=n.scope)==null?void 0:f.minCardsInLane)&&u.jsxs("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:["Only delete from lanes with ",n.scope.minCardsInLane,"+ cards total."]})]}),u.jsxs("label",{children:["Who Chooses Target?",u.jsxs("select",{value:n.actorChooses||"effect_owner",onChange:p=>{const h=p.target.value;if(h==="effect_owner"){const{actorChooses:_,...m}=n;o(m)}else o({...n,actorChooses:h})},children:[u.jsx("option",{value:"effect_owner",children:"Effect owner chooses (default)"}),u.jsx("option",{value:"card_owner",children:"Card owner chooses (Plague-4: opponent deletes their own)"})]}),n.actorChooses==="card_owner"&&u.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"The owner of the targeted card chooses which card to delete."})]}),u.jsxs("div",{className:"effect-preview",children:[u.jsx("strong",{children:"Preview:"})," ",k1(n)]})]})},k1=n=>{var r,l,s,f;let o="Delete ";n.count==="all_in_lane"?o+="all ":o+=`${n.count} `;const c=n.targetFilter||{position:"uncovered",faceState:"any"};c.calculation==="highest_value"?o+="highest value ":c.calculation==="lowest_value"&&(o+="lowest value "),c.valueRange&&(o+=`value ${c.valueRange.min}-${c.valueRange.max} `),c.position==="covered"?o+="covered ":c.position==="uncovered"&&(o+="uncovered "),c.faceState==="face_down"?o+="face-down ":c.faceState==="face_up"&&(o+="face-up ");const i=n.count===1?"card":"cards";return o+=i,((r=n.scope)==null?void 0:r.type)==="this_line"?o+=" in this line":((l=n.scope)==null?void 0:l.type)==="other_lanes"?(o+=" in other lanes",n.scope.minCardsInLane&&(o+=` with ${n.scope.minCardsInLane}+ cards`)):((s=n.scope)==null?void 0:s.type)==="each_other_line"?o+=" from each other line":((f=n.scope)==null?void 0:f.type)==="any"&&n.scope.minCardsInLane&&(o+=` in lanes with ${n.scope.minCardsInLane}+ cards`),c.owner==="own"?o+=" (your cards)":c.owner==="opponent"&&(o+=" (opponent's cards)"),n.excludeSelf&&(o+=" (excluding self)"),n.actorChooses==="card_owner"?(o+=". Card owner chooses which.",o):o+"."};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Ay=({params:n,onChange:o})=>{const c=n.countType||"fixed",i=n.variableCount,r=c==="equal_to_discarded";return u.jsxs("div",{className:"param-editor",children:[u.jsx("h4",{children:"Discard Effect"}),u.jsxs("label",{children:["Count Type",u.jsxs("select",{value:c,onChange:l=>o({...n,countType:l.target.value}),children:[u.jsx("option",{value:"fixed",children:"Fixed Count"}),u.jsx("option",{value:"equal_to_discarded",children:"Equal to Previously Discarded (Plague-2)"})]})]}),c==="fixed"&&u.jsxs("label",{children:["Count",u.jsxs("select",{value:i?"variable":n.count.toString(),onChange:l=>{const s=l.target.value;if(s==="variable")o({...n,variableCount:!0,count:1});else{const{variableCount:f,...p}=n;o({...p,count:parseInt(s)})}},children:[u.jsx("option",{value:"1",children:"1 card"}),u.jsx("option",{value:"2",children:"2 cards"}),u.jsx("option",{value:"3",children:"3 cards"}),u.jsx("option",{value:"variable",children:"1 or more cards (variable)"})]})]}),r&&u.jsxs("label",{children:["Offset (add to count)",u.jsx("input",{type:"number",value:n.countOffset||0,onChange:l=>o({...n,countOffset:parseInt(l.target.value)}),min:"-5",max:"5"})]}),u.jsxs("label",{children:["Actor",u.jsxs("select",{value:n.actor,onChange:l=>o({...n,actor:l.target.value}),children:[u.jsx("option",{value:"self",children:"Self"}),u.jsx("option",{value:"opponent",children:"Opponent"})]})]}),u.jsxs("div",{className:"effect-preview",children:[u.jsx("strong",{children:"Preview:"})," ",D1(n)]})]})},D1=n=>{const o=n.variableCount,c=n.countType||"fixed";let i="";if(c==="equal_to_discarded"){const r=n.countOffset||0;i=`(amount discarded${r>0?` + ${r}`:r<0?` - ${Math.abs(r)}`:""}) cards`}else if(o)i="1 or more cards";else{const r=n.count===1?"card":"cards";i=`${n.count} ${r}`}return n.actor==="opponent"?`Opponent discards ${i}.`:`Discard ${i}.`};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const ky=({params:n,onChange:o})=>{var i;const c=((i=n.targetFilter)==null?void 0:i.owner)||"any";return u.jsxs("div",{className:"param-editor",children:[u.jsx("h4",{children:"Return Effect"}),u.jsxs("label",{children:["Count",u.jsxs("select",{value:typeof n.count=="number"?n.count.toString():"all",onChange:r=>o({...n,count:r.target.value==="all"?"all":parseInt(r.target.value)}),children:[u.jsx("option",{value:"1",children:"1"}),u.jsx("option",{value:"2",children:"2"}),u.jsx("option",{value:"all",children:"All"})]})]}),u.jsxs("label",{children:["Whose cards?",u.jsxs("select",{value:c,onChange:r=>o({...n,targetFilter:{...n.targetFilter,owner:r.target.value}}),children:[u.jsx("option",{value:"any",children:"Any card (own or opponent)"}),u.jsx("option",{value:"own",children:"Only own cards"}),u.jsx("option",{value:"opponent",children:"Only opponent cards"})]})]}),u.jsxs("div",{className:"effect-preview",children:[u.jsx("strong",{children:"Preview:"})," ",T1(n)]})]})},T1=n=>{var r,l;if(((r=n.targetFilter)==null?void 0:r.valueEquals)!==void 0)return`Return all value ${n.targetFilter.valueEquals} cards to hand.`;const o=n.count==="all"?"all cards":n.count===1?"1 card":`${n.count} cards`,c=((l=n.targetFilter)==null?void 0:l.owner)||"any";let i="";return c==="own"?i=" of your own":c==="opponent"&&(i=" of opponent's"),`Return ${o}${i} to hand.`};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Dy=({params:n,onChange:o})=>{var c,i;return u.jsxs("div",{className:"param-editor",children:[u.jsx("h4",{children:"Play Effect"}),u.jsxs("label",{children:["Actor (who plays)",u.jsxs("select",{value:n.actor||"self",onChange:r=>{if(r.target.value==="self"){const{actor:l,...s}=n;o(s)}else o({...n,actor:r.target.value})},children:[u.jsx("option",{value:"self",children:"You"}),u.jsx("option",{value:"opponent",children:"Opponent"})]})]}),u.jsxs("label",{children:["Source",u.jsxs("select",{value:n.source,onChange:r=>o({...n,source:r.target.value}),children:[u.jsx("option",{value:"hand",children:"Hand"}),u.jsx("option",{value:"deck",children:"Deck"})]})]}),u.jsxs("label",{children:["Anzahl",u.jsx("input",{type:"number",min:1,max:6,value:n.count,onChange:r=>o({...n,count:parseInt(r.target.value)||1})})]}),u.jsxs("label",{children:[u.jsx("input",{type:"checkbox",checked:n.faceDown,onChange:r=>o({...n,faceDown:r.target.checked})}),"Face-down"]}),u.jsxs("label",{children:["Destination",u.jsxs("select",{value:n.destinationRule.type,onChange:r=>o({...n,destinationRule:{...n.destinationRule,type:r.target.value}}),children:[u.jsx("option",{value:"other_lines",children:"Other lines (choose 1)"}),u.jsx("option",{value:"each_other_line",children:"Each other line (1 per line)"}),u.jsx("option",{value:"specific_lane",children:"Specific lane (this line)"}),u.jsx("option",{value:"each_line_with_card",children:"Each line with card"}),u.jsx("option",{value:"under_this_card",children:"Under this card"})]})]}),u.jsxs("label",{children:["Condition",u.jsxs("select",{value:((c=n.condition)==null?void 0:c.type)||"none",onChange:r=>{const l=r.target.value;if(l==="none"){const{condition:s,...f}=n;o(f)}else o(l==="per_x_cards_in_line"?{...n,condition:{type:l,cardCount:2}}:{...n,condition:{type:l}})},children:[u.jsx("option",{value:"none",children:"None (always play)"}),u.jsx("option",{value:"per_x_cards_in_line",children:"For every X cards in this line"}),u.jsx("option",{value:"only_in_lines_with_cards",children:"Only in lines where you have a card"})]})]}),((i=n.condition)==null?void 0:i.type)==="per_x_cards_in_line"&&u.jsxs("label",{children:["Cards per play (X)",u.jsx("input",{type:"number",min:1,max:6,value:n.condition.cardCount||2,onChange:r=>o({...n,condition:{...n.condition,cardCount:parseInt(r.target.value)||2}})}),u.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:'Gravity-0: "For every 2 cards in this line, play..."  X = 2'})]}),u.jsxs("div",{className:"effect-preview",children:[u.jsx("strong",{children:"Preview:"})," ",N1(n)]})]})},N1=n=>{var f,p;const o=n.actor,c=n.count===1?"card":"cards",i=n.faceDown?"face-down":"face-up";let r="",l="";o==="opponent"?(r="Opponent plays",l=n.source==="deck"?"from their deck":"from their hand"):(r="Play",l=n.source==="deck"?"from your deck":"from your hand");let s="";if(((f=n.condition)==null?void 0:f.type)==="per_x_cards_in_line")s=`For every ${n.condition.cardCount||2} cards in this line, `,s+=`${r.toLowerCase()} ${n.count} ${c} ${i} ${l}`;else{if(((p=n.condition)==null?void 0:p.type)==="only_in_lines_with_cards")return s=`${r} ${n.count} ${c} ${i} ${l}`,s+=" only in lines where you have a card",s+".";s=`${r} ${n.count} ${c} ${i} ${l}`}return n.destinationRule.type==="other_lines"?s+=" to other lines":n.destinationRule.type==="each_other_line"?s+=" in each other line":n.destinationRule.type==="under_this_card"?s+=" under this card":n.destinationRule.type==="each_line_with_card"?s+=" to each line with a card":n.destinationRule.type==="specific_lane"&&(s+=" in this line"),s+"."};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Ty=({params:n,onChange:o})=>u.jsxs("div",{className:"param-editor",children:[u.jsx("h4",{children:"Protocol Effect"}),u.jsxs("label",{children:["Action",u.jsxs("select",{value:n.action,onChange:c=>o({...n,action:c.target.value}),children:[u.jsx("option",{value:"rearrange_protocols",children:"Rearrange"}),u.jsx("option",{value:"swap_protocols",children:"Swap"})]})]}),u.jsxs("label",{children:["Target",u.jsxs("select",{value:n.target,onChange:c=>o({...n,target:c.target.value}),children:[u.jsx("option",{value:"own",children:"Own"}),u.jsx("option",{value:"opponent",children:"Opponent"}),u.jsx("option",{value:"both_sequential",children:"Beide (nacheinander)"})]})]}),u.jsx("h5",{children:"Restriction (Anarchy-3)"}),u.jsxs("label",{children:[u.jsx("input",{type:"checkbox",checked:!!n.restriction,onChange:c=>{if(c.target.checked)o({...n,restriction:{disallowedProtocol:"",laneIndex:"current"}});else{const{restriction:i,...r}=n;o(r)}}}),"Add restriction (protocol cannot be on specific lane)"]}),n.restriction&&u.jsxs(u.Fragment,{children:[u.jsxs("label",{children:["Disallowed Protocol",u.jsx("input",{type:"text",value:n.restriction.disallowedProtocol,onChange:c=>o({...n,restriction:{...n.restriction,disallowedProtocol:c.target.value}}),placeholder:"e.g., Anarchy, Fire, Death"})]}),u.jsxs("label",{children:["Lane",u.jsxs("select",{value:n.restriction.laneIndex,onChange:c=>o({...n,restriction:{...n.restriction,laneIndex:c.target.value==="current"?"current":parseInt(c.target.value)}}),children:[u.jsx("option",{value:"current",children:"Current lane (where this card is)"}),u.jsx("option",{value:"0",children:"Lane 1 (Left)"}),u.jsx("option",{value:"1",children:"Lane 2 (Middle)"}),u.jsx("option",{value:"2",children:"Lane 3 (Right)"})]})]})]}),u.jsxs("div",{className:"effect-preview",children:[u.jsx("strong",{children:"Preview:"})," ",F1(n)]})]}),F1=n=>{const o=n.target==="opponent"?"opponent's":n.target==="both_sequential"?"both players'":"your";let c="";if(n.action==="rearrange_protocols"?c=`Rearrange ${o} protocols.`:c=`Swap 2 ${o} protocols.`,n.restriction&&n.restriction.disallowedProtocol){const i=n.restriction.laneIndex==="current"?"this line":`lane ${typeof n.restriction.laneIndex=="number"?n.restriction.laneIndex+1:n.restriction.laneIndex}`;c+=` ${n.restriction.disallowedProtocol} cannot be on ${i}.`}return c};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Ny=({params:n,onChange:o})=>u.jsxs("div",{className:"param-editor",children:[u.jsx("h4",{children:"Reveal/Give Effect"}),u.jsxs("label",{children:["Action",u.jsxs("select",{value:n.action,onChange:c=>o({...n,action:c.target.value}),children:[u.jsx("option",{value:"reveal",children:"Reveal"}),u.jsx("option",{value:"give",children:"Give"})]})]}),u.jsxs("label",{children:["Source",u.jsxs("select",{value:n.source,onChange:c=>o({...n,source:c.target.value}),children:[u.jsx("option",{value:"own_hand",children:"Your hand"}),u.jsx("option",{value:"opponent_hand",children:"Opponent's hand"})]})]}),u.jsxs("label",{children:["Anzahl",u.jsx("input",{type:"number",min:1,max:6,value:n.count,onChange:c=>o({...n,count:parseInt(c.target.value)||1})})]}),u.jsxs("label",{children:["Follow-up action",u.jsxs("select",{value:n.followUpAction||"none",onChange:c=>{if(c.target.value==="none"){const{followUpAction:i,...r}=n;o(r)}else o({...n,followUpAction:c.target.value})},children:[u.jsx("option",{value:"none",children:"None"}),u.jsx("option",{value:"flip",children:"Then flip"}),u.jsx("option",{value:"shift",children:"Then shift"})]})]}),u.jsxs("div",{className:"effect-preview",children:[u.jsx("strong",{children:"Preview:"})," ",q1(n)]})]}),q1=n=>{const o=n.count===1?"card":"cards",c=n.action==="give"?"Give":"Reveal",i=n.source==="opponent_hand"?"opponent's hand":"your hand";let r=`${c} ${n.count} ${o} from ${i}`;return n.followUpAction==="flip"?r+=". Then flip it.":n.followUpAction==="shift"?r+=". Then shift it.":r+=".",r};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Fy=({params:n,onChange:o})=>u.jsxs("div",{className:"param-editor take-effect-editor",children:[u.jsx("h4",{children:"Take Effect Parameters"}),u.jsxs("label",{children:["Card Count",u.jsx("input",{type:"number",min:1,max:6,value:n.count,onChange:c=>o({...n,count:parseInt(c.target.value)||1})})]}),u.jsxs("label",{children:["Source",u.jsx("select",{value:n.source,onChange:c=>o({...n,source:c.target.value}),children:u.jsx("option",{value:"opponent_hand",children:"Opponent's Hand"})})]}),u.jsxs("label",{children:[u.jsx("input",{type:"checkbox",checked:n.random,onChange:c=>o({...n,random:c.target.checked})}),"Random (if unchecked, you choose)"]}),u.jsxs("div",{className:"effect-preview",children:[u.jsx("strong",{children:"Preview:"})," ",U1(n)]})]}),U1=n=>{const o=n.count===1?"card":"cards",c=n.random?"random ":"";return`Take ${n.count} ${c}${o} from opponent's hand.`},vc=n=>{switch(n){case"draw":return{action:"draw",count:1,target:"self",source:"own_deck"};case"flip":return{action:"flip",count:1,targetFilter:{owner:"any",position:"any",faceState:"any",excludeSelf:!1},optional:!1};case"shift":return{action:"shift",targetFilter:{owner:"any",position:"any",faceState:"any"},destinationRestriction:{type:"any"}};case"delete":return{action:"delete",count:1,targetFilter:{position:"any",faceState:"any"},scope:{type:"anywhere"},excludeSelf:!1};case"discard":return{action:"discard",count:1,actor:"self"};case"return":return{action:"return",count:1,targetFilter:{},scope:{type:"any_card"}};case"play":return{action:"play",source:"hand",count:1,faceDown:!1,destinationRule:{type:"other_lines"}};case"rearrange_protocols":return{action:"rearrange_protocols",target:"own"};case"swap_protocols":return{action:"swap_protocols",target:"own"};case"reveal":case"give":return{action:n,source:"own_hand",count:1};case"take":return{action:"take",source:"opponent_hand",count:1,random:!0};default:return{}}},O1=({params:n,onChange:o})=>{const[c,i]=te.useState(""),[r,l]=te.useState(""),[s,f]=te.useState(null),p=n.options||[],h=p[0],_=p[1],m=()=>{if(!c)return;const A={id:He(),params:vc(c),position:"middle",trigger:"on_play"};o({...n,options:[A,_].filter(Boolean)}),i(""),f(1)},v=()=>{if(!r)return;const A={id:He(),params:vc(r),position:"middle",trigger:"on_play"};o({...n,options:[h,A].filter(Boolean)}),l(""),f(2)},w=()=>{o({...n,options:[_].filter(Boolean)}),s===1&&f(null)},x=()=>{o({...n,options:[h].filter(Boolean)}),s===2&&f(null)},C=A=>{const L={...h,params:A};o({...n,options:[L,_].filter(Boolean)})},S=A=>{const L={..._,params:A};o({...n,options:[h,L].filter(Boolean)})},E=A=>{const L=vc(A),H={...h,params:L};o({...n,options:[H,_].filter(Boolean)})},j=A=>{const L=vc(A),H={..._,params:L};o({...n,options:[h,H].filter(Boolean)})},D=(A,L)=>{switch(A.params.action){case"draw":return u.jsx(by,{params:A.params,onChange:L});case"flip":return u.jsx(Ey,{params:A.params,onChange:L});case"shift":return u.jsx(jy,{params:A.params,onChange:L});case"delete":return u.jsx(Ry,{params:A.params,onChange:L});case"discard":return u.jsx(Ay,{params:A.params,onChange:L});case"return":return u.jsx(ky,{params:A.params,onChange:L});case"play":return u.jsx(Dy,{params:A.params,onChange:L});case"rearrange_protocols":case"swap_protocols":return u.jsx(Ty,{params:A.params,onChange:L});case"reveal":case"give":return u.jsx(Ny,{params:A.params,onChange:L});case"take":return u.jsx(Fy,{params:A.params,onChange:L});default:return u.jsx("div",{children:"Unknown effect type"})}};return u.jsxs("div",{style:{padding:"10px",backgroundColor:"#2c1d63",borderRadius:"4px",border:"1px solid rgba(97, 239, 255, 0.3)"},children:[u.jsx("h4",{style:{color:"#61EFFF",marginTop:0},children:"Either/Or Choice"}),u.jsx("p",{style:{color:"#F0F0F0",fontSize:"14px",marginBottom:"15px"},children:'Player chooses one of two options. Example: "Either discard 1 card or flip this card"'}),u.jsxs("div",{style:{marginBottom:"15px",padding:"10px",backgroundColor:"rgba(97, 239, 255, 0.05)",borderRadius:"4px"},children:[u.jsx("label",{style:{color:"#61EFFF",display:"block",marginBottom:"10px",fontWeight:"bold"},children:"Option 1:"}),h?u.jsxs(u.Fragment,{children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"10px"},children:[u.jsxs("select",{value:h.params.action,onChange:A=>E(A.target.value),style:{flex:1,padding:"8px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px"},children:[u.jsx("option",{value:"draw",children:"Draw Cards"}),u.jsx("option",{value:"flip",children:"Flip Cards"}),u.jsx("option",{value:"shift",children:"Shift Card"}),u.jsx("option",{value:"delete",children:"Delete Cards"}),u.jsx("option",{value:"discard",children:"Discard Cards"}),u.jsx("option",{value:"return",children:"Return to Hand"}),u.jsx("option",{value:"play",children:"Play from Hand/Deck"})]}),u.jsx("button",{onClick:()=>f(s===1?null:1),style:{padding:"8px 15px",backgroundColor:s===1?"#8B0000":"#61EFFF",color:s===1?"#F0F0F0":"#0A051A",border:"none",borderRadius:"4px",cursor:"pointer",fontWeight:"bold"},children:s===1?"Hide":"Edit"}),u.jsx("button",{onClick:w,style:{padding:"8px 15px",backgroundColor:"#8B0000",color:"#F0F0F0",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Remove"})]}),s===1&&u.jsx("div",{style:{marginTop:"10px"},children:D(h,C)})]}):u.jsxs("div",{style:{display:"flex",gap:"10px"},children:[u.jsxs("select",{value:c,onChange:A=>i(A.target.value),style:{flex:1,padding:"8px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px"},children:[u.jsx("option",{value:"",children:"Choose Action"}),u.jsx("option",{value:"draw",children:"Draw Cards"}),u.jsx("option",{value:"flip",children:"Flip Cards"}),u.jsx("option",{value:"shift",children:"Shift Card"}),u.jsx("option",{value:"delete",children:"Delete Cards"}),u.jsx("option",{value:"discard",children:"Discard Cards"}),u.jsx("option",{value:"return",children:"Return to Hand"}),u.jsx("option",{value:"play",children:"Play from Hand/Deck"})]}),u.jsx("button",{onClick:m,disabled:!c,style:{padding:"8px 15px",backgroundColor:c?"#61EFFF":"#444",color:"#0A051A",border:"none",borderRadius:"4px",cursor:c?"pointer":"not-allowed",fontWeight:"bold"},children:"Add"})]})]}),u.jsxs("div",{style:{padding:"10px",backgroundColor:"rgba(97, 239, 255, 0.05)",borderRadius:"4px"},children:[u.jsx("label",{style:{color:"#61EFFF",display:"block",marginBottom:"10px",fontWeight:"bold"},children:"Option 2:"}),_?u.jsxs(u.Fragment,{children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"10px"},children:[u.jsxs("select",{value:_.params.action,onChange:A=>j(A.target.value),style:{flex:1,padding:"8px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px"},children:[u.jsx("option",{value:"draw",children:"Draw Cards"}),u.jsx("option",{value:"flip",children:"Flip Cards"}),u.jsx("option",{value:"shift",children:"Shift Card"}),u.jsx("option",{value:"delete",children:"Delete Cards"}),u.jsx("option",{value:"discard",children:"Discard Cards"}),u.jsx("option",{value:"return",children:"Return to Hand"}),u.jsx("option",{value:"play",children:"Play from Hand/Deck"})]}),u.jsx("button",{onClick:()=>f(s===2?null:2),style:{padding:"8px 15px",backgroundColor:s===2?"#8B0000":"#61EFFF",color:s===2?"#F0F0F0":"#0A051A",border:"none",borderRadius:"4px",cursor:"pointer",fontWeight:"bold"},children:s===2?"Hide":"Edit"}),u.jsx("button",{onClick:x,style:{padding:"8px 15px",backgroundColor:"#8B0000",color:"#F0F0F0",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Remove"})]}),s===2&&u.jsx("div",{style:{marginTop:"10px"},children:D(_,S)})]}):u.jsxs("div",{style:{display:"flex",gap:"10px"},children:[u.jsxs("select",{value:r,onChange:A=>l(A.target.value),style:{flex:1,padding:"8px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px"},children:[u.jsx("option",{value:"",children:"Choose Action"}),u.jsx("option",{value:"draw",children:"Draw Cards"}),u.jsx("option",{value:"flip",children:"Flip Cards"}),u.jsx("option",{value:"shift",children:"Shift Card"}),u.jsx("option",{value:"delete",children:"Delete Cards"}),u.jsx("option",{value:"discard",children:"Discard Cards"}),u.jsx("option",{value:"return",children:"Return to Hand"}),u.jsx("option",{value:"play",children:"Play from Hand/Deck"})]}),u.jsx("button",{onClick:v,disabled:!r,style:{padding:"8px 15px",backgroundColor:r?"#61EFFF":"#444",color:"#0A051A",border:"none",borderRadius:"4px",cursor:r?"pointer":"not-allowed",fontWeight:"bold"},children:"Add"})]})]}),p.length===2&&u.jsx("div",{style:{marginTop:"15px",padding:"10px",backgroundColor:"rgba(97, 239, 255, 0.1)",borderRadius:"4px"},children:u.jsx("p",{style:{color:"#61EFFF",fontSize:"14px",margin:0},children:" Both options configured. Player will choose one during gameplay."})})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const $1=({params:n,onChange:o})=>{var l,s,f;const c=((l=n.rule)==null?void 0:l.type)||"block_all_play",i=((s=n.rule)==null?void 0:s.target)||"opponent",r=((f=n.rule)==null?void 0:f.scope)||"this_lane";return u.jsxs("div",{className:"param-editor passive-rule-editor",children:[u.jsx("h4",{children:"Passive Rule Parameters"}),u.jsx("p",{style:{color:"#8A79E8",fontSize:"14px",marginBottom:"15px"},children:"This rule is active while the card is face-up. It modifies game behavior."}),u.jsxs("label",{children:["Rule Type",u.jsxs("select",{value:c,onChange:p=>o({...n,rule:{...n.rule,type:p.target.value,target:i,scope:r}}),children:[u.jsxs("optgroup",{label:"Play Restrictions",children:[u.jsx("option",{value:"block_face_down_play",children:"Block Face-Down Plays (Metal-2)"}),u.jsx("option",{value:"block_face_up_play",children:"Block Face-Up Plays"}),u.jsx("option",{value:"block_all_play",children:"Block All Plays (Plague-0)"}),u.jsx("option",{value:"require_face_down_play",children:"Require Face-Down Plays (Psychic-1)"})]}),u.jsxs("optgroup",{label:"Protocol Matching",children:[u.jsx("option",{value:"allow_any_protocol_play",children:"Allow Any Protocol (Spirit-1, Chaos-3)"}),u.jsx("option",{value:"require_non_matching_protocol",children:"Require Non-Matching (Anarchy-1)"})]}),u.jsxs("optgroup",{label:"Action Blocks",children:[u.jsx("option",{value:"block_flips",children:"Block Flips (Frost-1)"}),u.jsx("option",{value:"block_protocol_rearrange",children:"Block Protocol Rearrange (Frost-1)"}),u.jsx("option",{value:"block_shifts_from_lane",children:"Block Shifts From Lane (Frost-3)"}),u.jsx("option",{value:"block_shifts_to_lane",children:"Block Shifts To Lane (Frost-3)"})]}),u.jsx("optgroup",{label:"Effect Modifications",children:u.jsx("option",{value:"ignore_middle_commands",children:"Ignore Middle Commands (Apathy-2)"})}),u.jsx("optgroup",{label:"Phase Modifications",children:u.jsx("option",{value:"skip_check_cache_phase",children:"Skip Check Cache Phase (Spirit-0)"})})]})]}),u.jsxs("label",{children:["Affected Player",u.jsxs("select",{value:i,onChange:p=>o({...n,rule:{...n.rule,type:c,target:p.target.value,scope:r}}),children:[u.jsx("option",{value:"self",children:"Self (You)"}),u.jsx("option",{value:"opponent",children:"Opponent"}),u.jsx("option",{value:"all",children:"All Players"})]})]}),u.jsxs("label",{children:["Scope",u.jsxs("select",{value:r,onChange:p=>o({...n,rule:{...n.rule,type:c,target:i,scope:p.target.value}}),children:[u.jsx("option",{value:"this_lane",children:"This Lane Only"}),u.jsx("option",{value:"global",children:"Global (All Lanes)"})]})]}),u.jsxs("div",{className:"effect-preview",children:[u.jsx("strong",{children:"Preview:"})," ",L1(n)]})]})},L1=n=>{var s,f,p;const o=((s=n.rule)==null?void 0:s.type)||"block_all_play",c=((f=n.rule)==null?void 0:f.target)||"opponent",i=((p=n.rule)==null?void 0:p.scope)||"this_lane",r=c==="self"?"You":c==="opponent"?"Your opponent":"All players",l=i==="this_lane"?" in this lane":"";switch(o){case"block_face_down_play":return`${r} cannot play cards face-down${l}.`;case"block_face_up_play":return`${r} cannot play cards face-up${l}.`;case"block_all_play":return`${r} cannot play cards${l}.`;case"require_face_down_play":return`${r} can only play cards face-down${l}.`;case"allow_any_protocol_play":return`${r} may play cards without matching protocols${l}.`;case"require_non_matching_protocol":return`${r} can only play cards without matching protocols${l}.`;case"block_flips":return`Cards cannot be flipped face-up${l}.`;case"block_protocol_rearrange":return"Protocols cannot be rearranged.";case"block_shifts_from_lane":return"Cards cannot shift from this lane.";case"block_shifts_to_lane":return"Cards cannot shift to this lane.";case"ignore_middle_commands":return`Ignore all middle commands of cards${l}.`;case"skip_check_cache_phase":return"Skip your check cache phase.";default:return"Passive rule active."}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const M1=({params:n,onChange:o})=>{var m,v,w,x,C,S,E,j,D;const c=((m=n.modifier)==null?void 0:m.type)||"add_per_condition",i=((v=n.modifier)==null?void 0:v.value)||1,r=((w=n.modifier)==null?void 0:w.condition)||"per_face_down_card",l=((x=n.modifier)==null?void 0:x.target)||"own_total",s=((C=n.modifier)==null?void 0:C.scope)||"this_lane",f=((E=(S=n.modifier)==null?void 0:S.filter)==null?void 0:E.faceState)||"face_down",p=((D=(j=n.modifier)==null?void 0:j.filter)==null?void 0:D.position)||"any",h=c==="add_per_condition",_=c==="set_to_fixed"&&(l==="own_cards"||l==="opponent_cards"||l==="all_cards");return u.jsxs("div",{className:"param-editor value-modifier-editor",children:[u.jsx("h4",{children:"Value Modifier Parameters"}),u.jsx("p",{style:{color:"#8A79E8",fontSize:"14px",marginBottom:"15px"},children:"This modifier is active while the card is face-up. It modifies card values or lane totals."}),u.jsxs("label",{children:["Modifier Type",u.jsxs("select",{value:c,onChange:A=>o({...n,modifier:{...n.modifier,type:A.target.value,value:i,condition:h?r:void 0,target:l,scope:s,filter:_?{faceState:f,position:p}:void 0}}),children:[u.jsx("option",{value:"add_per_condition",children:"Add Per Condition (Apathy-0: +1 per face-down)"}),u.jsx("option",{value:"set_to_fixed",children:"Set Cards To Fixed Value (Darkness-2: face-down = 4)"}),u.jsx("option",{value:"add_to_total",children:"Add To Lane Total (Metal-0: opponent total -2)"})]})]}),u.jsxs("label",{children:["Value",u.jsx("input",{type:"number",value:i,onChange:A=>o({...n,modifier:{...n.modifier,type:c,value:parseInt(A.target.value)||0,condition:h?r:void 0,target:l,scope:s,filter:_?{faceState:f,position:p}:void 0}}),style:{width:"100%",padding:"8px",marginTop:"5px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px"}}),u.jsxs("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:[c==="add_per_condition"&&"Value to add per condition (e.g., +1)",c==="set_to_fixed"&&"Fixed value to set cards to (e.g., 4)",c==="add_to_total"&&"Value to add to total (use negative for subtraction, e.g., -2)"]})]}),h&&u.jsxs("label",{children:["Condition",u.jsxs("select",{value:r,onChange:A=>o({...n,modifier:{...n.modifier,type:c,value:i,condition:A.target.value,target:l,scope:s,filter:_?{faceState:f,position:p}:void 0}}),children:[u.jsx("option",{value:"per_face_down_card",children:"Per Face-Down Card"}),u.jsx("option",{value:"per_face_up_card",children:"Per Face-Up Card"}),u.jsx("option",{value:"per_card",children:"Per Card (any)"})]})]}),u.jsxs("label",{children:["Target",u.jsxs("select",{value:l,onChange:A=>o({...n,modifier:{...n.modifier,type:c,value:i,condition:h?r:void 0,target:A.target.value,scope:s,filter:_?{faceState:f,position:p}:void 0}}),children:[u.jsxs("optgroup",{label:"Card Values",children:[u.jsx("option",{value:"own_cards",children:"Own Cards"}),u.jsx("option",{value:"opponent_cards",children:"Opponent Cards"}),u.jsx("option",{value:"all_cards",children:"All Cards"})]}),u.jsxs("optgroup",{label:"Lane Totals",children:[u.jsx("option",{value:"own_total",children:"Own Total"}),u.jsx("option",{value:"opponent_total",children:"Opponent Total"})]})]})]}),_&&u.jsxs(u.Fragment,{children:[u.jsxs("label",{children:["Card Face State (Filter)",u.jsxs("select",{value:f,onChange:A=>o({...n,modifier:{...n.modifier,type:c,value:i,condition:h?r:void 0,target:l,scope:s,filter:{faceState:A.target.value,position:p}}}),children:[u.jsx("option",{value:"face_down",children:"Face-Down Only"}),u.jsx("option",{value:"face_up",children:"Face-Up Only"}),u.jsx("option",{value:"any",children:"Any"})]})]}),u.jsxs("label",{children:["Card Position (Filter)",u.jsxs("select",{value:p,onChange:A=>o({...n,modifier:{...n.modifier,type:c,value:i,condition:h?r:void 0,target:l,scope:s,filter:{faceState:f,position:A.target.value}}}),children:[u.jsx("option",{value:"any",children:"Any Position"}),u.jsx("option",{value:"covered",children:"Covered Only"}),u.jsx("option",{value:"uncovered",children:"Uncovered Only"})]})]})]}),u.jsxs("label",{children:["Scope",u.jsxs("select",{value:s,onChange:A=>o({...n,modifier:{...n.modifier,type:c,value:i,condition:h?r:void 0,target:l,scope:A.target.value,filter:_?{faceState:f,position:p}:void 0}}),children:[u.jsx("option",{value:"this_lane",children:"This Lane Only"}),u.jsx("option",{value:"global",children:"Global (All Lanes)"})]})]}),u.jsxs("div",{className:"effect-preview",children:[u.jsx("strong",{children:"Preview:"})," ",P1(n)]})]})},P1=n=>{var h,_,m,v,w,x,C;const o=((h=n.modifier)==null?void 0:h.type)||"add_per_condition",c=((_=n.modifier)==null?void 0:_.value)||0,i=((m=n.modifier)==null?void 0:m.condition)||"per_face_down_card",r=((v=n.modifier)==null?void 0:v.target)||"own_total",l=((w=n.modifier)==null?void 0:w.scope)||"this_lane",s=((C=(x=n.modifier)==null?void 0:x.filter)==null?void 0:C.faceState)||"face_down",f=l==="this_lane"?" in this lane":"";let p="";switch(r){case"own_cards":p="your cards";break;case"opponent_cards":p="opponent's cards";break;case"all_cards":p="all cards";break;case"own_total":p="your total value";break;case"opponent_total":p="opponent's total value";break}switch(o){case"add_per_condition":{let S="";switch(i){case"per_face_down_card":S="face-down card";break;case"per_face_up_card":S="face-up card";break;case"per_card":S="card";break}const E=c>=0?"+":"";return`${p}${f} is increased by ${E}${c} for each ${S}${f}.`}case"set_to_fixed":return`All ${s==="face_down"?"face-down ":s==="face_up"?"face-up ":""}${p}${f} have a value of ${c}.`;case"add_to_total":{const S=c>=0?"increased":"reduced",E=Math.abs(c);return`${p}${f} is ${S} by ${E}.`}default:return"Value modifier active."}},wc=n=>{switch(n){case"draw":return{action:"draw",count:1,target:"self",source:"own_deck"};case"flip":return{action:"flip",count:1,targetFilter:{owner:"any",position:"any",faceState:"any",excludeSelf:!1},optional:!1};case"shift":return{action:"shift",targetFilter:{owner:"any",position:"any",faceState:"any"},destinationRestriction:{type:"any"}};case"delete":return{action:"delete",count:1,targetFilter:{position:"any",faceState:"any"},scope:{type:"anywhere"},excludeSelf:!1};case"discard":return{action:"discard",count:1,actor:"self"};case"return":return{action:"return",count:1,targetFilter:{},scope:{type:"any_card"}};case"play":return{action:"play",source:"hand",count:1,faceDown:!1,destinationRule:{type:"other_lines"}};case"rearrange_protocols":return{action:"rearrange_protocols",target:"own"};case"swap_protocols":return{action:"swap_protocols",target:"own"};case"reveal":case"give":return{action:n,source:"own_hand",count:1};case"take":return{action:"take",source:"opponent_hand",count:1,random:!0};case"choice":return{action:"choice",options:[]};case"passive_rule":return{action:"passive_rule",rule:{type:"block_all_play",target:"opponent",scope:"this_lane"}};case"value_modifier":return{action:"value_modifier",modifier:{type:"add_per_condition",value:1,condition:"per_face_down_card",target:"own_total",scope:"this_lane"}};default:return{}}},I1=({effect:n,onChange:o})=>{const c=v=>{o({...n,params:v})},i=v=>{if(v){const w={id:He(),params:wc("draw"),position:n.position,trigger:n.trigger};o({...n,conditional:{type:"then",thenEffect:w}})}else{const{conditional:w,...x}=n;o(x)}},r=v=>{n.conditional&&o({...n,conditional:{...n.conditional,type:v}})},l=v=>{n.conditional&&o({...n,conditional:{...n.conditional,thenEffect:v}})},s=v=>{if(!n.conditional)return;const w=wc(v),x={...n.conditional.thenEffect,params:w};o({...n,conditional:{...n.conditional,thenEffect:x}})},f=v=>{if(n.conditional)if(v){const w={id:He(),params:wc("delete"),position:n.position,trigger:n.trigger};o({...n,conditional:{...n.conditional,thenEffect:{...n.conditional.thenEffect,conditional:{type:"then",thenEffect:w}}}})}else{const{conditional:w,...x}=n.conditional.thenEffect;o({...n,conditional:{...n.conditional,thenEffect:x}})}},p=v=>{var w;(w=n.conditional)!=null&&w.thenEffect.conditional&&o({...n,conditional:{...n.conditional,thenEffect:{...n.conditional.thenEffect,conditional:{...n.conditional.thenEffect.conditional,type:v}}}})},h=v=>{var w;(w=n.conditional)!=null&&w.thenEffect.conditional&&o({...n,conditional:{...n.conditional,thenEffect:{...n.conditional.thenEffect,conditional:{...n.conditional.thenEffect.conditional,thenEffect:v}}}})},_=v=>{var C;if(!((C=n.conditional)!=null&&C.thenEffect.conditional))return;const w=wc(v),x={...n.conditional.thenEffect.conditional.thenEffect,params:w};o({...n,conditional:{...n.conditional,thenEffect:{...n.conditional.thenEffect,conditional:{...n.conditional.thenEffect.conditional,thenEffect:x}}}})},m=(v,w)=>{switch(v.params.action){case"draw":return u.jsx(by,{params:v.params,onChange:w});case"flip":return u.jsx(Ey,{params:v.params,onChange:w});case"shift":return u.jsx(jy,{params:v.params,onChange:w});case"delete":return u.jsx(Ry,{params:v.params,onChange:w});case"discard":return u.jsx(Ay,{params:v.params,onChange:w});case"return":return u.jsx(ky,{params:v.params,onChange:w});case"play":return u.jsx(Dy,{params:v.params,onChange:w});case"rearrange_protocols":case"swap_protocols":return u.jsx(Ty,{params:v.params,onChange:w});case"reveal":case"give":return u.jsx(Ny,{params:v.params,onChange:w});case"take":return u.jsx(Fy,{params:v.params,onChange:w});case"choice":return u.jsx(O1,{params:v.params,onChange:w});case"passive_rule":return u.jsx($1,{params:v.params,onChange:w});case"value_modifier":return u.jsx(M1,{params:v.params,onChange:w});default:return u.jsx("div",{children:"Unknown effect type"})}};return u.jsxs("div",{className:"effect-editor",children:[u.jsxs("div",{className:"main-effect",children:[u.jsx("h3",{children:"Main Effect"}),m(n,c)]}),u.jsxs("div",{style:{marginTop:"15px"},children:[u.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[u.jsx("input",{type:"checkbox",checked:!!n.useCardFromPreviousEffect,onChange:v=>o({...n,useCardFromPreviousEffect:v.target.checked})}),u.jsx("span",{children:`Use card from previous effect (for "shift THAT card", "draw equal to THAT card's value", etc.)`})]}),n.useCardFromPreviousEffect&&u.jsx("small",{style:{display:"block",marginLeft:"24px",marginTop:"4px",color:"#8A79E8"},children:"This effect will target/use the card selected by the previous effect in the chain."})]}),u.jsxs("div",{className:"conditional-section",style:{marginTop:"20px",borderTop:"1px solid #2c1d63",paddingTop:"15px"},children:[u.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"10px"},children:[u.jsx("input",{type:"checkbox",checked:!!n.conditional,onChange:v=>i(v.target.checked)}),u.jsx("strong",{children:"Add follow-up effect"})]}),n.conditional&&u.jsxs("div",{className:"follow-up-effect",style:{marginLeft:"20px",padding:"10px",backgroundColor:"#2c1d63",borderRadius:"4px",border:"1px solid rgba(97, 239, 255, 0.2)"},children:[u.jsx("h4",{style:{marginTop:0},children:"Follow-Up Effect"}),u.jsxs("label",{children:["Connection Type",u.jsxs("select",{value:n.conditional.type||"then",onChange:v=>r(v.target.value),style:{width:"100%",padding:"8px",marginTop:"5px",marginBottom:"15px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px",cursor:"pointer"},children:[u.jsx("option",{value:"then",children:"Then (always executes)"}),u.jsx("option",{value:"if_executed",children:"If you do (only if first effect succeeds)"})]})]}),u.jsxs("label",{children:["Effect Type",u.jsxs("select",{value:n.conditional.thenEffect.params.action,onChange:v=>s(v.target.value),style:{width:"100%",padding:"8px",marginTop:"5px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px",cursor:"pointer"},children:[u.jsx("option",{value:"draw",children:"Draw Cards"}),u.jsx("option",{value:"flip",children:"Flip Cards"}),u.jsx("option",{value:"shift",children:"Shift Card"}),u.jsx("option",{value:"delete",children:"Delete Cards"}),u.jsx("option",{value:"discard",children:"Discard Cards"}),u.jsx("option",{value:"return",children:"Return to Hand"}),u.jsx("option",{value:"play",children:"Play from Hand/Deck"}),u.jsx("option",{value:"reveal",children:"Reveal Hand"}),u.jsx("option",{value:"give",children:"Give Cards"}),u.jsx("option",{value:"take",children:"Take from Hand"}),u.jsx("option",{value:"choice",children:"Either/Or Choice"})]})]}),u.jsx("div",{style:{marginTop:"15px"},children:m(n.conditional.thenEffect,v=>l({...n.conditional.thenEffect,params:v}))}),u.jsxs("div",{className:"nested-conditional-section",style:{marginTop:"15px",borderTop:"1px solid rgba(97, 239, 255, 0.2)",paddingTop:"15px"},children:[u.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"10px"},children:[u.jsx("input",{type:"checkbox",checked:!!n.conditional.thenEffect.conditional,onChange:v=>f(v.target.checked)}),u.jsx("strong",{children:"Add 2nd follow-up effect"})]}),n.conditional.thenEffect.conditional&&u.jsxs("div",{className:"nested-follow-up-effect",style:{marginLeft:"10px",padding:"10px",backgroundColor:"#1A113B",borderRadius:"4px",border:"1px solid rgba(97, 239, 255, 0.2)"},children:[u.jsx("h5",{style:{marginTop:0,fontSize:"0.9rem"},children:"2nd Follow-Up Effect"}),u.jsxs("label",{children:["Connection Type",u.jsxs("select",{value:n.conditional.thenEffect.conditional.type||"then",onChange:v=>p(v.target.value),style:{width:"100%",padding:"6px",marginTop:"5px",marginBottom:"10px",backgroundColor:"#0D0825",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px",cursor:"pointer",fontSize:"0.9rem"},children:[u.jsx("option",{value:"then",children:"Then (always executes)"}),u.jsx("option",{value:"if_executed",children:"If you do (only if first effect succeeds)"})]})]}),u.jsxs("label",{children:["Effect Type",u.jsxs("select",{value:n.conditional.thenEffect.conditional.thenEffect.params.action,onChange:v=>_(v.target.value),style:{width:"100%",padding:"6px",marginTop:"5px",backgroundColor:"#0D0825",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px",cursor:"pointer",fontSize:"0.9rem"},children:[u.jsx("option",{value:"draw",children:"Draw Cards"}),u.jsx("option",{value:"flip",children:"Flip Cards"}),u.jsx("option",{value:"shift",children:"Shift Card"}),u.jsx("option",{value:"delete",children:"Delete Cards"}),u.jsx("option",{value:"discard",children:"Discard Cards"}),u.jsx("option",{value:"return",children:"Return to Hand"}),u.jsx("option",{value:"play",children:"Play from Hand/Deck"}),u.jsx("option",{value:"reveal",children:"Reveal Hand"}),u.jsx("option",{value:"give",children:"Give Cards"}),u.jsx("option",{value:"take",children:"Take from Hand"})]})]}),u.jsx("div",{style:{marginTop:"10px"},children:m(n.conditional.thenEffect.conditional.thenEffect,v=>h({...n.conditional.thenEffect.conditional.thenEffect,params:v}))})]})]})]})]})]})},H1=({card:n,protocolName:o,protocolColor:c,protocolPattern:i,onChange:r})=>{const[l,s]=te.useState(null),[f,p]=te.useState(null),[h,_]=te.useState(!1);te.useEffect(()=>{s(null)},[n.value]);const m=(P,q,N)=>{const k={id:He(),params:V1(q),position:P,trigger:N},W={...n};P==="top"?W.topEffects=[...W.topEffects,k]:P==="middle"?W.middleEffects=[...W.middleEffects,k]:W.bottomEffects=[...W.bottomEffects,k],r(W);const ee=P==="top"?W.topEffects.length-1:P==="middle"?W.middleEffects.length-1:W.bottomEffects.length-1;s({box:P,effectIndex:ee,effect:k})},v=(P,q)=>{p({box:P,effectIndex:q})},w=()=>{if(!f)return;const{box:P,effectIndex:q}=f,N={...n};P==="top"?N.topEffects.splice(q,1):P==="middle"?N.middleEffects.splice(q,1):N.bottomEffects.splice(q,1),r(N),l&&l.box===P&&l.effectIndex===q&&s(null),p(null)},x=P=>{if(!l)return;const{box:q,effectIndex:N}=l,k={...n};q==="top"?(k.topEffects=[...k.topEffects],k.topEffects[N]=P):q==="middle"?(k.middleEffects=[...k.middleEffects],k.middleEffects[N]=P):(k.bottomEffects=[...k.bottomEffects],k.bottomEffects[N]=P),r(k),s({box:q,effectIndex:N,effect:P})},C=(P,q)=>{const N=P==="top"?n.topEffects[q]:P==="middle"?n.middleEffects[q]:n.bottomEffects[q];s({box:P,effectIndex:q,effect:N})},S=P=>{switch(P){case"passive":return"";case"on_play":return"";case"start":return"Start";case"end":return"End";case"on_cover":return"On Cover";case"after_delete":return"After you delete cards";case"after_opponent_discard":return"After opponent discards";case"after_draw":return"After you draw cards";case"after_clear_cache":return"After you clear cache";case"before_compile_delete":return"Before deleted by compile";case"after_flip":return"After cards are flipped";case"after_shift":return"After cards are shifted";case"after_play":return"After cards are played";case"on_flip":return"When this card would be flipped";case"on_cover_or_flip":return"When covered or flipped";default:return P}},E=P=>{var k,W,ee,ge,F,O,K,U,Q,ye,fe,ne,X,re,se,we,Ee,xe,be,rt,ve,Be,gt,ft,Rt,je,lt,St,vn,rn,ct,bt,ln,At,ca;const q=P.params;let N="";switch(q.action){case"draw":{if(q.countType==="equal_to_discarded"){const Me=q.countOffset||0;Me===0?N="draw the amount discarded":Me>0?N=`draw the amount discarded plus ${Me}`:N=`draw the amount discarded minus ${Math.abs(Me)}`;break}if(q.conditional){switch(q.conditional.type){case"count_face_down":N="Draw 1 card for each face-down card.";break;case"is_covering":N=`Draw ${q.count} card${q.count!==1?"s":""} if this card is covering another.`;break;case"non_matching_protocols":N="Draw 1 card for each line with a non-matching protocol.";break}break}let me="";q.preAction==="refresh"&&(me="Refresh your hand. ");const Te=q.optional?"You may ":"";q.source==="opponent_deck"?me+=`${Te}draw ${q.count} card${q.count!==1?"s":""} from opponent's deck`:q.target==="opponent"?me+=`Opponent ${q.optional?"may draw":"draws"} ${q.count} card${q.count!==1?"s":""}`:me+=`${Te}draw ${q.count} card${q.count!==1?"s":""}`,N=me;break}case"flip":{if(q.flipSelf){let vt=q.optional?"May flip this card":"Flip this card";((k=q.advancedConditional)==null?void 0:k.type)==="protocol_match"&&(vt+=`, if this card is in the line with the ${q.advancedConditional.protocol||"[Protocol]"} protocol`),vt+=".",N=vt;break}const me=q.optional?"May flip":"Flip";let Te="";((W=q.targetFilter)==null?void 0:W.owner)==="opponent"&&(Te="opponent's "),((ee=q.targetFilter)==null?void 0:ee.position)==="covered"&&(Te+="covered "),((ge=q.targetFilter)==null?void 0:ge.position)==="uncovered"&&(Te+="uncovered "),((F=q.targetFilter)==null?void 0:F.faceState)==="face_down"&&(Te+="face-down "),((O=q.targetFilter)==null?void 0:O.faceState)==="face_up"&&(Te+="face-up "),(K=q.targetFilter)!=null&&K.excludeSelf&&(Te+="other ");let Me="";q.count==="all"?Me="all":q.count==="each"?q.eachLineScope==="each_line"?(Me="1",Te=Te+"(in each line) "):Me="each":Me=q.count.toString();const We=q.count===1?"card":"cards";let Xe=`${me} ${Me} ${Te}${We}.`;q.selfFlipAfter&&(Xe+=" Then flip this card."),N=Xe;break}case"shift":{let me="";((U=q.targetFilter)==null?void 0:U.owner)==="opponent"&&(me+="opponent's "),(Q=q.targetFilter)!=null&&Q.excludeSelf&&(me+="other "),((ye=q.targetFilter)==null?void 0:ye.position)==="covered"&&(me+="covered "),((fe=q.targetFilter)==null?void 0:fe.position)==="uncovered"&&(me+="uncovered "),((ne=q.targetFilter)==null?void 0:ne.faceState)==="face_down"&&(me+="face-down "),((X=q.targetFilter)==null?void 0:X.faceState)==="face_up"&&(me+="face-up ");const Te=q.count==="all"?"all":"1";let We=`Shift ${Te} ${me}${Te==="1"?"card":"cards"}`;((re=q.destinationRestriction)==null?void 0:re.type)==="non_matching_protocol"?We+=" to a line without a matching protocol":((se=q.destinationRestriction)==null?void 0:se.type)==="specific_lane"?We+=" within this line":((we=q.destinationRestriction)==null?void 0:we.type)==="to_another_line"&&(We+=" to another line"),N=We+".";break}case"delete":{if(q.deleteSelf){N="delete this card";break}let me="Delete ";q.count==="all_in_lane"?me+="all ":me+=`${q.count} `,((Ee=q.targetFilter)==null?void 0:Ee.calculation)==="highest_value"?me+="highest value ":((xe=q.targetFilter)==null?void 0:xe.calculation)==="lowest_value"&&(me+="lowest value "),(be=q.targetFilter)!=null&&be.valueRange&&(me+=`value ${q.targetFilter.valueRange.min}-${q.targetFilter.valueRange.max} `),q.excludeSelf&&(me+="other "),((rt=q.targetFilter)==null?void 0:rt.position)==="covered"?me+="covered ":((ve=q.targetFilter)==null?void 0:ve.position)==="uncovered"&&(me+="uncovered "),((Be=q.targetFilter)==null?void 0:Be.faceState)==="face_down"?me+="face-down ":((gt=q.targetFilter)==null?void 0:gt.faceState)==="face_up"&&(me+="face-up ");const Te=q.count===1?"card":"cards";me+=Te,((ft=q.scope)==null?void 0:ft.type)==="this_line"?me+=" in this line":((Rt=q.scope)==null?void 0:Rt.type)==="other_lanes"?me+=" in other lanes":((je=q.scope)==null?void 0:je.type)==="each_other_line"&&(me+=" from each other line"),N=me;break}case"discard":{const me=q.variableCount;let Te="";if(me)Te="1 or more cards";else{const Me=q.count===1?"card":"cards";Te=`${q.count} ${Me}`}q.actor==="opponent"?N=`Opponent discards ${Te}.`:N=`Discard ${Te}.`;break}case"return":{if(((lt=q.targetFilter)==null?void 0:lt.valueEquals)!==void 0){N=`Return all value ${q.targetFilter.valueEquals} cards to hand.`;break}N=`Return ${q.count==="all"?"all cards":q.count===1?"1 card":`${q.count} cards`} to hand.`;break}case"play":{const me=q.actor,Te=q.count===1?"card":"cards",Me=q.faceDown?"face-down":"face-up";let We="",Xe="";me==="opponent"?(We="Opponent plays",Xe=q.source==="deck"?"from their deck":"from their hand"):(We="Play",Xe=q.source==="deck"?"from your deck":"from your hand");let vt=`${We} ${q.count} ${Te} ${Me} ${Xe}`;((St=q.destinationRule)==null?void 0:St.type)==="other_lines"?vt+=" to other lines":((vn=q.destinationRule)==null?void 0:vn.type)==="each_other_line"?vt+=" in each other line":((rn=q.destinationRule)==null?void 0:rn.type)==="under_this_card"?vt+=" under this card":((ct=q.destinationRule)==null?void 0:ct.type)==="each_line_with_card"?vt+=" to each line with a card":((bt=q.destinationRule)==null?void 0:bt.type)==="specific_lane"&&(vt+=" in this line"),N=vt+".";break}case"rearrange_protocols":case"swap_protocols":{const me=q.target==="opponent"?"opponent's":q.target==="both_sequential"?"both players'":"your";let Te="";if(q.action==="rearrange_protocols"?Te=`Rearrange ${me} protocols.`:Te=`Swap 2 ${me} protocols.`,q.restriction&&q.restriction.disallowedProtocol){const Me=q.restriction.laneIndex==="current"?"this line":`lane ${typeof q.restriction.laneIndex=="number"?q.restriction.laneIndex+1:q.restriction.laneIndex}`;Te+=` ${q.restriction.disallowedProtocol} cannot be on ${Me}.`}N=Te;break}case"reveal":case"give":{const me=q.count===1?"card":"cards",Te=q.action==="give"?"Give":"Reveal",Me=q.source==="opponent_hand"?"opponent's hand":"your hand";let We=`${Te} ${q.count} ${me} from ${Me}`;q.followUpAction==="flip"?We+=". Then flip it.":q.followUpAction==="shift"?We+=". Then shift it.":We+=".",N=We;break}case"take":{const me=q.count===1?"card":"cards",Te=q.random?"random ":"";N=`Take ${q.count} ${Te}${me} from opponent's hand.`;break}case"choice":{const me=q.options||[];if(me.length!==2)N="Either/Or (incomplete)";else{const Te=E(me[0]),Me=E(me[1]);N=`Either ${Te.toLowerCase()} or ${Me.toLowerCase()}`}break}case"passive_rule":{const me=((ln=q.rule)==null?void 0:ln.type)||"block_all_play",Te=((At=q.rule)==null?void 0:At.target)||"opponent",Me=((ca=q.rule)==null?void 0:ca.scope)||"this_lane",We=Te==="self"?"You":Te==="opponent"?"Your opponent":"All players",Xe=Me==="this_lane"?" in this lane":"";switch(me){case"block_face_down_play":N=`${We} cannot play cards face-down${Xe}`;break;case"block_face_up_play":N=`${We} cannot play cards face-up${Xe}`;break;case"block_all_play":N=`${We} cannot play cards${Xe}`;break;case"require_face_down_play":N=`${We} can only play cards face-down${Xe}`;break;case"allow_any_protocol_play":N=`${We} may play cards without matching protocols${Xe}`;break;case"require_non_matching_protocol":N=`${We} can only play cards without matching protocols${Xe}`;break;case"block_flips":N=`Cards cannot be flipped face-up${Xe}`;break;case"block_protocol_rearrange":N="Protocols cannot be rearranged";break;case"block_shifts_from_lane":N="Cards cannot shift from this lane";break;case"block_shifts_to_lane":N="Cards cannot shift to this lane";break;case"ignore_middle_commands":N=`Ignore all middle commands of cards${Xe}`;break;case"skip_check_cache_phase":N="Skip your check cache phase";break;default:N="Passive rule active";break}break}case"value_modifier":{const me=q.modifier;switch((me==null?void 0:me.type)||"add_per_condition"){case"add_per_condition":{const Me=me.scope==="this_lane"?"in this line":"",We=me.target==="own_total"?"Your total value":me.target==="opponent_total"?"Opponent's total value":"Total value";let Xe="";me.condition==="per_face_down_card"?Xe="for each face-down card":me.condition==="per_face_up_card"?Xe="for each face-up card":me.condition==="per_card"&&(Xe="for each card");const vt=me.value>=0?"+":"";N=`${We} ${Me} is increased by ${vt}${me.value} ${Xe} ${Me}.`.replace(/\s+/g," ");break}case"set_to_fixed":N=`Set cards to value ${(me==null?void 0:me.value)||0}`;break;case"add_to_total":N=((me==null?void 0:me.value)||0)>=0?`+${(me==null?void 0:me.value)||0} to total`:`${(me==null?void 0:me.value)||0} to total`;break;default:N="Value modifier active";break}break}default:N="Effect";break}if(P.conditional&&P.conditional.thenEffect){const me=E(P.conditional.thenEffect);P.conditional.type==="then"?N=`${N} Then ${me.toLowerCase()}`:P.conditional.type==="if_executed"?N=`${N} If you do, ${me.toLowerCase()}`:N=`${N} ${me}`}return N},j=P=>{const q={...n,value:P};r(q)},D=P=>P.length===0?"":P.map(q=>{const N=E(q),k=q.trigger;return k==="start"?`<div><span class='emphasis'>Start:</span> ${N}</div>`:k==="end"?`<div><span class='emphasis'>End:</span> ${N}</div>`:k==="on_cover"?`<div><span class='emphasis'>When this card would be covered:</span> First, ${N.toLowerCase()}</div>`:N}).join(". "),A=D(n.topEffects),L=D(n.middleEffects),H=D(n.bottomEffects),ce=JSON.stringify({top:n.topEffects.map(P=>({id:P.id,params:P.params})),middle:n.middleEffects.map(P=>({id:P.id,params:P.params})),bottom:n.bottomEffects.map(P=>({id:P.id,params:P.params}))}),B=`${o}-${n.value}-${ce}`,z={id:B,protocol:o,value:n.value,top:A,middle:L,bottom:H,isFaceUp:!0,owner:"player",laneIndex:0,category:"Custom",keywords:{}},V=(P,q)=>{P=P.replace("#","");const N=parseInt(P.substring(0,2),16),k=parseInt(P.substring(2,4),16),W=parseInt(P.substring(4,6),16);return`rgba(${N}, ${k}, ${W}, ${q})`},le=`card-custom-preview pattern-${i}`,G={"--custom-color":c,"--custom-color-alpha-05":V(c,.05),"--custom-color-alpha-06":V(c,.06),"--custom-color-alpha-08":V(c,.08),"--custom-color-alpha-10":V(c,.1),"--custom-color-alpha-15":V(c,.15),"--custom-color-alpha-20":V(c,.2),"--custom-color-alpha-25":V(c,.25),borderColor:c};return u.jsxs("div",{className:"card-editor-container",children:[u.jsxs("div",{className:"card-editor-content",children:[u.jsxs("div",{className:"card-live-preview",children:[u.jsx("h4",{children:"Card Preview"}),u.jsxs("label",{className:"card-value-selector",children:["Card Value:",u.jsxs("select",{value:n.value,onChange:P=>j(Number(P.target.value)),children:[u.jsx("option",{value:-1,children:"-1"}),u.jsx("option",{value:0,children:"0"}),u.jsx("option",{value:1,children:"1"}),u.jsx("option",{value:2,children:"2"}),u.jsx("option",{value:3,children:"3"}),u.jsx("option",{value:4,children:"4"}),u.jsx("option",{value:5,children:"5"}),u.jsx("option",{value:6,children:"6"})]})]}),u.jsx("div",{className:"card-preview-wrapper",style:G,children:u.jsx(an,{card:z,isFaceUp:!0,additionalClassName:le},B)})]}),u.jsx("div",{className:"card-effects-editor",children:u.jsxs("div",{className:"card-preview",style:{borderColor:c},children:[u.jsx("div",{className:"card-header",style:{backgroundColor:c},children:u.jsxs("h3",{children:[o,"-",n.value]})}),u.jsxs("div",{className:"card-box top-box",children:[u.jsx("h4",{children:"Top Box (Passive/Reactive)"}),u.jsx("p",{className:"box-description",children:"Passive effects or reactive triggers"}),u.jsxs("div",{className:"effects-list",children:[n.topEffects.map((P,q)=>u.jsxs("div",{className:"effect-item",children:[u.jsxs("span",{onClick:()=>C("top",q),children:[P.trigger!=="passive"&&u.jsxs("strong",{children:[S(P.trigger),":"]})," ",E(P)]}),u.jsx("button",{onClick:()=>v("top",q),children:""})]},P.id)),n.topEffects.length===0&&u.jsx("p",{className:"empty-box",children:"No effects"})]}),u.jsxs("div",{className:"add-effect-controls",children:[u.jsxs("select",{id:"top-trigger",defaultValue:"",children:[u.jsx("option",{value:"",children:"Choose Trigger"}),u.jsx("optgroup",{label:"Passive",children:u.jsx("option",{value:"passive",children:"Passive (always active)"})}),u.jsxs("optgroup",{label:"Phase Triggers",children:[u.jsx("option",{value:"start",children:"Start Phase"}),u.jsx("option",{value:"end",children:"End Phase"}),u.jsx("option",{value:"on_cover",children:"On Cover"})]}),u.jsxs("optgroup",{label:"Reactive Triggers",children:[u.jsx("option",{value:"after_delete",children:"After you delete cards"}),u.jsx("option",{value:"after_opponent_discard",children:"After opponent discards"}),u.jsx("option",{value:"after_draw",children:"After you draw cards"}),u.jsx("option",{value:"after_clear_cache",children:"After you clear cache"}),u.jsx("option",{value:"before_compile_delete",children:"Before deleted by compile"}),u.jsx("option",{value:"after_flip",children:"After cards are flipped"}),u.jsx("option",{value:"after_shift",children:"After cards are shifted"}),u.jsx("option",{value:"after_play",children:"After cards are played"}),u.jsx("option",{value:"on_flip",children:"When this card would be flipped"})]})]}),u.jsxs("select",{id:"top-action",defaultValue:"",children:[u.jsx("option",{value:"",children:"Choose Action"}),u.jsx("option",{value:"draw",children:"Draw Cards"}),u.jsx("option",{value:"flip",children:"Flip Cards"}),u.jsx("option",{value:"shift",children:"Shift Card"}),u.jsx("option",{value:"delete",children:"Delete Cards"}),u.jsx("option",{value:"discard",children:"Discard Cards"}),u.jsx("option",{value:"return",children:"Return to Hand"}),u.jsx("option",{value:"play",children:"Play from Hand/Deck"}),u.jsx("option",{value:"rearrange_protocols",children:"Rearrange Protocols"}),u.jsx("option",{value:"swap_protocols",children:"Swap Protocols"}),u.jsx("option",{value:"reveal",children:"Reveal Hand"}),u.jsx("option",{value:"give",children:"Give Cards"}),u.jsx("option",{value:"take",children:"Take from Hand"}),u.jsx("option",{value:"choice",children:"Either/Or Choice"}),u.jsx("option",{value:"passive_rule",children:"Passive Rule"}),u.jsx("option",{value:"value_modifier",children:"Value Modifier"})]}),u.jsx("button",{className:"btn btn-add-effect",onClick:()=>{const P=document.getElementById("top-trigger"),q=document.getElementById("top-action"),N=P.value,k=q.value;N&&k?(m("top",k,N),P.value="",q.value=""):_(!0)},children:"+"})]})]}),u.jsxs("div",{className:"card-box middle-box",children:[u.jsx("h4",{children:"Middle Box (On Play)"}),u.jsx("p",{className:"box-description",children:"When played or uncovered"}),u.jsxs("div",{className:"effects-list",children:[n.middleEffects.map((P,q)=>u.jsxs("div",{className:"effect-item",children:[u.jsx("span",{onClick:()=>C("middle",q),children:E(P)}),u.jsx("button",{onClick:()=>v("middle",q),children:""})]},P.id)),n.middleEffects.length===0&&u.jsx("p",{className:"empty-box",children:"No effects"})]}),u.jsxs("select",{onChange:P=>{P.target.value&&(m("middle",P.target.value,"on_play"),P.target.value="")},children:[u.jsx("option",{value:"",children:"+ Add Effect"}),u.jsx("option",{value:"draw",children:"Draw Cards"}),u.jsx("option",{value:"flip",children:"Flip Cards"}),u.jsx("option",{value:"shift",children:"Shift Card"}),u.jsx("option",{value:"delete",children:"Delete Cards"}),u.jsx("option",{value:"discard",children:"Discard Cards"}),u.jsx("option",{value:"return",children:"Return to Hand"}),u.jsx("option",{value:"play",children:"Play from Hand/Deck"}),u.jsx("option",{value:"rearrange_protocols",children:"Rearrange Protocols"}),u.jsx("option",{value:"swap_protocols",children:"Swap Protocols"}),u.jsx("option",{value:"reveal",children:"Reveal Hand"}),u.jsx("option",{value:"give",children:"Give Cards"}),u.jsx("option",{value:"take",children:"Take from Hand"}),u.jsx("option",{value:"choice",children:"Either/Or Choice"}),u.jsx("option",{value:"passive_rule",children:"Passive Rule"}),u.jsx("option",{value:"value_modifier",children:"Value Modifier"})]})]}),u.jsxs("div",{className:"card-box bottom-box",children:[u.jsx("h4",{children:"Bottom Box (Triggered)"}),u.jsx("p",{className:"box-description",children:"Only when uncovered AND face-up"}),u.jsxs("div",{className:"effects-list",children:[n.bottomEffects.map((P,q)=>u.jsxs("div",{className:"effect-item",children:[u.jsxs("span",{onClick:()=>C("bottom",q),children:[u.jsxs("strong",{children:[S(P.trigger),":"]})," ",E(P)]}),u.jsx("button",{onClick:()=>v("bottom",q),children:""})]},P.id)),n.bottomEffects.length===0&&u.jsx("p",{className:"empty-box",children:"No effects"})]}),u.jsxs("div",{className:"bottom-effect-add",children:[u.jsxs("select",{id:"bottom-trigger",children:[u.jsx("option",{value:"",children:"1. Choose Trigger"}),u.jsx("option",{value:"start",children:"Start Phase"}),u.jsx("option",{value:"end",children:"End Phase"}),u.jsx("option",{value:"on_cover",children:"On Cover"})]}),u.jsxs("select",{id:"bottom-action",children:[u.jsx("option",{value:"",children:"2. Choose Effect"}),u.jsx("option",{value:"draw",children:"Draw Cards"}),u.jsx("option",{value:"flip",children:"Flip Cards"}),u.jsx("option",{value:"shift",children:"Shift Card"}),u.jsx("option",{value:"delete",children:"Delete Cards"}),u.jsx("option",{value:"discard",children:"Discard Cards"}),u.jsx("option",{value:"return",children:"Return to Hand"}),u.jsx("option",{value:"play",children:"Play from Hand/Deck"}),u.jsx("option",{value:"rearrange_protocols",children:"Rearrange Protocols"}),u.jsx("option",{value:"swap_protocols",children:"Swap Protocols"}),u.jsx("option",{value:"reveal",children:"Reveal Hand"}),u.jsx("option",{value:"give",children:"Give Cards"}),u.jsx("option",{value:"take",children:"Take from Hand"}),u.jsx("option",{value:"choice",children:"Either/Or Choice"}),u.jsx("option",{value:"passive_rule",children:"Passive Rule"}),u.jsx("option",{value:"value_modifier",children:"Value Modifier"})]}),u.jsx("button",{className:"btn btn-add-effect",onClick:()=>{const P=document.getElementById("bottom-trigger"),q=document.getElementById("bottom-action"),N=P.value,k=q.value;N&&k?(m("bottom",k,N),P.value="",q.value=""):_(!0)},children:"+"})]})]})]})})]}),l&&u.jsxs("div",{className:"effect-parameter-editor",children:[u.jsx("h3",{children:"Configure Effect"}),u.jsx(I1,{effect:l.effect,onChange:x}),u.jsx("button",{onClick:()=>s(null),className:"btn",children:"Done"})]}),f&&u.jsx("div",{className:"custom-protocol-modal-overlay",onClick:()=>p(null),children:u.jsxs("div",{className:"custom-protocol-modal-content",onClick:P=>P.stopPropagation(),children:[u.jsx("h3",{children:"Delete Effect"}),u.jsx("p",{children:"Are you sure you want to delete this effect?"}),u.jsxs("div",{className:"custom-protocol-modal-actions",children:[u.jsx("button",{onClick:()=>p(null),className:"btn btn-back",children:"Cancel"}),u.jsx("button",{onClick:w,className:"btn btn-delete",children:"Delete"})]})]})}),h&&u.jsx("div",{className:"custom-protocol-modal-overlay",onClick:()=>_(!1),children:u.jsxs("div",{className:"custom-protocol-modal-content",onClick:P=>P.stopPropagation(),children:[u.jsx("h3",{children:"Missing Selection"}),u.jsx("p",{children:"Please select both a trigger and an effect before adding."}),u.jsx("div",{className:"custom-protocol-modal-actions",children:u.jsx("button",{onClick:()=>_(!1),className:"btn",children:"OK"})})]})})]})},V1=n=>{switch(n){case"draw":return{action:"draw",count:1,target:"self",source:"own_deck"};case"flip":return{action:"flip",count:1,targetFilter:{owner:"any",position:"any",faceState:"any",excludeSelf:!1},optional:!1};case"shift":return{action:"shift",targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1}};case"delete":return{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"any"},excludeSelf:!0};case"discard":return{action:"discard",count:1,actor:"self"};case"return":return{action:"return",count:1,targetFilter:{},scope:{type:"any_card"}};case"play":return{action:"play",source:"hand",count:1,faceDown:!0,destinationRule:{type:"other_lines"}};case"rearrange_protocols":return{action:"rearrange_protocols",target:"own"};case"swap_protocols":return{action:"swap_protocols",target:"own"};case"reveal":case"give":return{action:n,source:"own_hand",count:1};case"take":return{action:"take",source:"opponent_hand",count:1,random:!0};case"choice":return{action:"choice",options:[]};case"passive_rule":return{action:"passive_rule",rule:{type:"block_all_play",target:"opponent",scope:"this_lane"}};case"value_modifier":return{action:"value_modifier",modifier:{type:"add_per_condition",value:1,condition:"per_face_down_card",target:"own_total",scope:"this_lane"}};default:return{}}},B1=(n,o)=>{const c=(r,l)=>{r=r.replace("#","");const s=parseInt(r.substring(0,2),16),f=parseInt(r.substring(2,4),16),p=parseInt(r.substring(4,6),16);return`rgba(${s}, ${f}, ${p}, ${l})`},i={borderColor:o};switch(n){case"solid":return{...i,backgroundColor:o};case"radial":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`radial-gradient(circle at 50% 50%, ${c(o,.25)} 0%, transparent 60%)`};case"dual-radial":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 0% 0%, ${c(o,.2)}, transparent 50%),
                    radial-gradient(at 100% 100%, ${c(o,.2)}, transparent 50%)
                `};case"multi-radial":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 0%, ${c(o,.2)}, transparent 70%),
                    radial-gradient(circle at 20% 30%, ${c(o,.15)}, transparent 40%),
                    radial-gradient(circle at 80% 70%, ${c(o,.2)}, transparent 50%)
                `};case"chaos":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 10% 10%, hsla(60, 100%, 50%, 0.15), transparent 30%),
                    radial-gradient(at 90% 20%, hsla(180, 100%, 50%, 0.15), transparent 35%),
                    radial-gradient(at 30% 80%, hsla(300, 100%, 50%, 0.15), transparent 40%),
                    radial-gradient(at 70% 60%, hsla(0, 100%, 50%, 0.1), transparent 25%)
                `};case"grid":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(circle at 50% 50%, ${c(o,.2)} 0%, transparent 40%),
                    linear-gradient(hsla(0,0%,100%,0.03) 1px, transparent 1px),
                    linear-gradient(90deg, hsla(0,0%,100%,0.03) 1px, transparent 1px)
                `,backgroundSize:"100% 100%, 20px 20px, 20px 20px"};case"diagonal-lines":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 0% 100%, ${c(o,.25)}, transparent 70%),
                    repeating-linear-gradient(120deg, transparent, transparent 15px, ${c(o,.05)} 15px, ${c(o,.05)} 30px)
                `};case"cross-diagonal":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 50%, ${c(o,.25)} 0%, transparent 50%),
                    repeating-linear-gradient(45deg, transparent, transparent 8px, ${c(o,.08)} 8px, ${c(o,.08)} 16px),
                    repeating-linear-gradient(-45deg, transparent, transparent 8px, ${c(o,.06)} 8px, ${c(o,.06)} 16px)
                `};case"horizontal-lines":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 80% 80%, ${c(o,.1)}, transparent 50%),
                    repeating-linear-gradient(0deg, hsla(0,0%,100%,0.02), hsla(0,0%,100%,0.02) 1px, transparent 1px, transparent 3px)
                `};case"vertical-lines":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 10% 10%, ${c(o,.2)}, transparent 50%),
                    repeating-linear-gradient(175deg, transparent, transparent 1px, ${c(o,.05)} 1px, ${c(o,.05)} 2px)
                `};case"cross":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    linear-gradient(0deg, transparent 40%, ${c(o,.1)} 50%, transparent 60%),
                    linear-gradient(90deg, transparent 48%, ${c(o,.2)} 50%, transparent 52%)
                `};case"hexagons":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 0%, ${c(o,.2)}, transparent 70%),
                    url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='28' height='49' viewBox='0 0 28 49'%3E%3Cg fill-rule='evenodd'%3E%3Cg id='hexagons' fill='%23ffffff' fill-opacity='0.05' fill-rule='nonzero'%3E%3Cpath d='M13.99 9.25l13 7.5v15l-13 7.5L1 31.75v-15l12.99-7.5zM3 17.9v12.7l10.99 6.34 11-6.35V17.9l-11-6.34L3 17.9zM0 15l12.99-7.5L26 15v18.5l-13 7.5L0 33.5V15z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")
                `};case"stripes":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 100%, ${c(o,.25)}, transparent 60%),
                    linear-gradient(135deg, hsla(0,0%,0%,0.1) 23%, transparent 23%, transparent 25%, hsla(0,0%,0%,0.1) 25%, hsla(0,0%,0%,0.1) 27%, transparent 27%, transparent 73%, hsla(0,0%,0%,0.1) 73%, hsla(0,0%,0%,0.1) 75%, transparent 75%, transparent 77%, hsla(0,0%,0%,0.1) 77%)
                `};default:return i}},z1=[{name:"Anarchy",hex:"#EA5A3C"},{name:"Apathy",hex:"#989A9A"},{name:"Chaos",hex:"#E53FE5"},{name:"Darkness",hex:"#A772D4"},{name:"Death",hex:"#E25656"},{name:"Fire",hex:"#F06838"},{name:"Gravity",hex:"#7599EB"},{name:"Hate",hex:"#E03E5E"},{name:"Life",hex:"#3CE076"},{name:"Light",hex:"#FFEB7F"},{name:"Love",hex:"#F074D9"},{name:"Metal",hex:"#B3B8BD"},{name:"Plague",hex:"#A2CD3A"},{name:"Psychic",hex:"#C971EB"},{name:"Speed",hex:"#33DDDD"},{name:"Spirit",hex:"#42D4A8"},{name:"Water",hex:"#3FA4EB"}],G1=[{name:"Solid",value:"solid",description:"Solid color background"},{name:"Radial Glow",value:"radial",description:"Single radial gradient glow"},{name:"Dual Radial",value:"dual-radial",description:"Two radial gradient spots"},{name:"Multi Radial",value:"multi-radial",description:"Multiple radial gradient spots"},{name:"Chaos",value:"chaos",description:"Colorful chaotic spots"},{name:"Grid",value:"grid",description:"Grid line pattern"},{name:"Diagonal Lines",value:"diagonal-lines",description:"Repeating diagonal lines"},{name:"Cross Diagonal",value:"cross-diagonal",description:"Crossed diagonal lines"},{name:"Horizontal Lines",value:"horizontal-lines",description:"Fine horizontal lines"},{name:"Vertical Lines",value:"vertical-lines",description:"Fine vertical lines"},{name:"Cross Pattern",value:"cross",description:"Cross/plus pattern"},{name:"Hexagons",value:"hexagons",description:"Hexagon pattern"},{name:"Stripes",value:"stripes",description:"Diagonal stripe pattern"}],Y1=({onSave:n,onCancel:o,onDelete:c,initialProtocol:i})=>{const[r,l]=te.useState("name"),[s,f]=te.useState(0),[p,h]=te.useState(!1),[_,m]=te.useState(""),[v,w]=te.useState(!1);console.log("ProtocolWizard render - initialProtocol:",i);const[x,C]=te.useState((i==null?void 0:i.name)||""),[S,E]=te.useState((i==null?void 0:i.description)||""),[j,D]=te.useState((i==null?void 0:i.color)||"#1976D2"),[A,L]=te.useState((i==null?void 0:i.pattern)||"solid"),[H,ce]=te.useState((i==null?void 0:i.cards)||[{value:0,topEffects:[],middleEffects:[],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[],bottomEffects:[]}]);console.log("ProtocolWizard state - name:",x,"color:",j,"pattern:",A);const B=()=>{if(r==="name"){if(!x.trim()){alert("Please enter a protocol name.");return}l("color")}else r==="color"?l("pattern"):r==="pattern"&&l("cards")},z=k=>{const W=[...H];W[s]=k,ce(W)},V=()=>{const k={id:(i==null?void 0:i.id)||He(),name:x,description:S,author:"Player",createdAt:(i==null?void 0:i.createdAt)||new Date().toISOString(),color:j,pattern:A,cards:H};n(k)},le=()=>{i&&c&&c(i.id),w(!1)},G=()=>{const k={id:(i==null?void 0:i.id)||He(),name:x,description:S,author:"Player",createdAt:(i==null?void 0:i.createdAt)||new Date().toISOString(),color:j,pattern:A,cards:H},W=JSON.stringify(k,null,2);m(W),h(!0)},P=()=>{navigator.clipboard.writeText(_).then(()=>{alert("Protocol JSON copied to clipboard!"),h(!1)}).catch(()=>{alert("Failed to copy to clipboard. Please try again.")})},q=k=>!(!x.trim()&&k!=="name"),N=k=>{if(!q(k)){alert("Please enter a protocol name first.");return}l(k)};return u.jsxs("div",{className:"protocol-wizard",children:[u.jsxs("div",{className:"wizard-header",children:[u.jsx("h2",{children:i?`Edit Protocol: ${x}`:"Create New Protocol"}),u.jsxs("div",{className:"wizard-progress",children:[u.jsx("button",{className:`step ${r==="name"?"active":"done"}`,onClick:()=>N("name"),type:"button",children:"1. Name"}),u.jsx("button",{className:`step ${r==="color"?"active":r==="pattern"||r==="cards"?"done":""}`,onClick:()=>N("color"),disabled:!q("color"),type:"button",children:"2. Color"}),u.jsx("button",{className:`step ${r==="pattern"?"active":r==="cards"?"done":""}`,onClick:()=>N("pattern"),disabled:!q("pattern"),type:"button",children:"3. Pattern"}),u.jsx("button",{className:`step ${r==="cards"?"active":""}`,onClick:()=>N("cards"),disabled:!q("cards"),type:"button",children:"4. Cards"})]})]}),u.jsxs("div",{className:"wizard-content",children:[r==="name"&&u.jsxs("div",{className:"wizard-step name-step",children:[u.jsx("h3",{children:"Step 1: Name and Description"}),u.jsxs("label",{children:["Protocol Name *",u.jsx("input",{type:"text",value:x,onChange:k=>C(k.target.value),placeholder:"e.g. Lightning, Shadow, Void",autoFocus:!0})]}),u.jsxs("label",{children:["Description",u.jsx("textarea",{value:S,onChange:k=>E(k.target.value),placeholder:"Describe the strategy and theme of your protocol",rows:4})]})]}),r==="color"&&u.jsxs("div",{className:"wizard-step color-step",children:[u.jsx("h3",{children:"Step 2: Choose Color"}),u.jsx("div",{className:"color-preview",style:{backgroundColor:j},children:u.jsx("span",{children:x||"Your Protocol"})}),u.jsx("h4",{children:"Predefined Colors"}),u.jsx("div",{className:"color-grid",children:z1.map(k=>u.jsx("button",{className:`color-option ${j===k.hex?"selected":""}`,style:{backgroundColor:k.hex},onClick:()=>D(k.hex),title:k.name,children:j===k.hex&&""},k.hex))}),u.jsx("h4",{children:"Custom Color"}),u.jsxs("div",{className:"custom-color",children:[u.jsx("input",{type:"color",value:j,onChange:k=>D(k.target.value)}),u.jsx("input",{type:"text",value:j,onChange:k=>D(k.target.value),placeholder:"#1976D2"})]})]}),r==="pattern"&&u.jsxs("div",{className:"wizard-step pattern-step",children:[u.jsx("h3",{children:"Step 3: Choose Card Pattern"}),u.jsx("div",{className:"pattern-grid",children:G1.map(k=>{const W=B1(k.value,j);return u.jsxs("div",{className:`pattern-option ${A===k.value?"selected":""}`,onClick:()=>L(k.value),children:[u.jsxs("div",{className:"pattern-preview",style:W,children:[x||"Protocol","-0"]}),u.jsx("h4",{children:k.name}),u.jsx("p",{children:k.description}),A===k.value&&u.jsx("div",{className:"selected-badge",children:" Selected"})]},k.value)})})]}),r==="cards"&&u.jsxs("div",{className:"wizard-step cards-step",children:[u.jsx("h3",{children:"Step 4: Configure Cards"}),u.jsx("div",{className:"card-navigation",children:H.map((k,W)=>u.jsxs("button",{className:`card-nav-btn ${s===W?"active":""}`,onClick:()=>f(W),type:"button",children:["Card ",k.value]},W))}),u.jsx(H1,{card:H[s],protocolName:x,protocolColor:j,protocolPattern:A,onChange:z})]})]}),u.jsxs("div",{className:"wizard-actions",children:[u.jsxs("div",{className:"wizard-actions-left",children:[u.jsx("button",{onClick:o,className:"btn btn-back",children:"Cancel"}),i&&c&&u.jsx("button",{onClick:()=>w(!0),className:"btn btn-delete",children:"Delete Protocol"})]}),u.jsxs("div",{className:"wizard-actions-right",children:[i&&u.jsxs(u.Fragment,{children:[u.jsx("button",{onClick:G,className:"btn btn-export",children:"Export JSON"}),u.jsx("button",{onClick:V,className:"btn",children:"Save"})]}),!i&&u.jsxs(u.Fragment,{children:[r!=="cards"&&u.jsx("button",{onClick:B,className:"btn",children:"Next"}),r==="cards"&&u.jsxs(u.Fragment,{children:[u.jsx("button",{onClick:G,className:"btn btn-export",children:"Export JSON"}),u.jsx("button",{onClick:V,className:"btn",children:"Save"})]})]})]})]}),p&&u.jsx("div",{className:"custom-protocol-modal-overlay",onClick:()=>h(!1),children:u.jsxs("div",{className:"custom-protocol-modal-content custom-protocol-modal-large",onClick:k=>k.stopPropagation(),children:[u.jsx("h3",{children:"Export Protocol JSON"}),u.jsx("p",{children:"Copy the JSON below to share or backup your protocol:"}),u.jsx("textarea",{value:_,readOnly:!0,rows:15,className:"export-textarea",onClick:k=>k.target.select()}),u.jsxs("div",{className:"custom-protocol-modal-actions",children:[u.jsx("button",{onClick:()=>h(!1),className:"btn btn-back",children:"Close"}),u.jsx("button",{onClick:P,className:"btn",children:"Copy to Clipboard"})]})]})}),v&&u.jsx("div",{className:"custom-protocol-modal-overlay",onClick:()=>w(!1),children:u.jsxs("div",{className:"custom-protocol-modal-content",onClick:k=>k.stopPropagation(),children:[u.jsx("h3",{children:"Delete Protocol"}),u.jsxs("p",{children:['Are you sure you want to delete "',x,'"?']}),u.jsx("p",{style:{color:"var(--danger-color)",fontSize:"0.9rem"},children:"This action cannot be undone."}),u.jsxs("div",{className:"custom-protocol-modal-actions",children:[u.jsx("button",{onClick:()=>w(!1),className:"btn btn-back",children:"Cancel"}),u.jsx("button",{onClick:le,className:"btn btn-delete",children:"Delete"})]})]})})]})},W1=({onBack:n})=>{const[o,c]=te.useState("list"),[i,r]=te.useState([]),[l,s]=te.useState(void 0);te.useEffect(()=>{f()},[]);const f=()=>{const x=kc();r(x)},p=()=>{s(void 0),c("create")},h=x=>{console.log("handleEdit called with protocol:",x),s(x),c("edit"),console.log("View set to edit, editingProtocol:",x)},_=x=>{S1(x),Yr(),f(),c("list"),s(void 0)},m=x=>{aa(x),Yr(),f(),c("list"),s(void 0)},v=x=>{aa(x),Yr(),f()},w=()=>{c("list"),s(void 0)};return u.jsxs("div",{className:"custom-protocol-creator",children:[o==="list"&&u.jsx(E1,{protocols:i,onCreateNew:p,onEdit:h,onDelete:_,onImport:v,onBack:n}),(o==="create"||o==="edit")&&u.jsx(Y1,{onSave:m,onCancel:w,onDelete:_,initialProtocol:l})]})},Q1="anarchy-custom-001",X1="Anarchy_custom",Z1="Custom recreation of Anarchy protocol to validate editor capabilities",K1="System Validation",J1="2025-11-08T00:00:00.000Z",ew="#8B0000",tw="chaos",nw=[{value:0,topEffects:[],middleEffects:[{id:"anarchy-0-shift",params:{action:"shift",targetFilter:{owner:"any",position:"uncovered",faceState:"any"}},position:"middle",trigger:"on_play"},{id:"anarchy-0-draw",params:{action:"draw",count:1,target:"self",source:"own_deck",conditional:{type:"non_matching_protocols"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[{id:"anarchy-1-passive",params:{action:"passive_rule",rule:{type:"require_non_matching_protocol",target:"all",scope:"global"}},position:"top",trigger:"passive"}],middleEffects:[{id:"anarchy-1-shift",params:{action:"shift",targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!0},destinationRestriction:{type:"non_matching_protocol"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"anarchy-2-delete",params:{action:"delete",count:1,targetFilter:{position:"any",faceState:"face_up"},protocolMatching:"must_match",excludeSelf:!1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"anarchy-3-swap",params:{action:"swap_protocols",target:"opponent"},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"anarchy-3-end-rearrange",params:{action:"rearrange_protocols",target:"own",restriction:{disallowedProtocol:"Anarchy_custom",laneIndex:"current"}},position:"bottom",trigger:"end"}]},{value:5,topEffects:[],middleEffects:[{id:"anarchy-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:6,topEffects:[{id:"anarchy-6-start-flip",params:{action:"flip",count:1,flipSelf:!0,optional:!1,targetFilter:{owner:"any",position:"any",faceState:"any",excludeSelf:!1},advancedConditional:{type:"protocol_match",protocol:"Anarchy_custom"}},position:"top",trigger:"start"}],middleEffects:[],bottomEffects:[]}],ow={id:Q1,name:X1,description:Z1,author:K1,createdAt:J1,color:ew,pattern:tw,cards:nw},aw="apathy_custom",rw="Apathy_custom",lw="Custom implementation of Apathy protocol",cw="System",sw="2025-01-08T00:00:00Z",iw="#9E9E9E",dw="radial",uw=[{value:0,topEffects:[{id:"apathy-0-value-modifier",params:{action:"value_modifier",modifier:{type:"add_per_condition",value:1,condition:"per_face_down_card",target:"own_total",scope:"this_lane"}},position:"top",trigger:"passive"}],middleEffects:[],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"apathy-1-flip-all",params:{action:"flip",count:"all",optional:!1,scope:"this_lane",targetFilter:{owner:"any",position:"any",faceState:"face_up",excludeSelf:!0}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:2,topEffects:[{id:"apathy-2-passive",params:{action:"passive_rule",rule:{type:"ignore_middle_commands",target:"all",scope:"this_lane"}},position:"top",trigger:"passive"}],middleEffects:[],bottomEffects:[{id:"apathy-2-on-cover",params:{action:"flip",count:1,flipSelf:!0,optional:!1,targetFilter:{owner:"any",position:"any",faceState:"any",excludeSelf:!1}},position:"bottom",trigger:"on_cover"}]},{value:3,topEffects:[],middleEffects:[{id:"apathy-3-flip-opponent",params:{action:"flip",count:1,optional:!1,targetFilter:{owner:"opponent",position:"uncovered",faceState:"face_up",excludeSelf:!1}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"apathy-4-flip-covered",params:{action:"flip",count:1,optional:!0,targetFilter:{owner:"own",position:"covered",faceState:"face_up",excludeSelf:!1}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"apathy-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],pw={id:aw,name:rw,description:lw,author:cw,createdAt:sw,color:iw,pattern:dw,cards:uw},fw="dark_cust_v2",hw="Dark_cust",yw="Custom Darkness protocol - manipulate face-down cards, flip and shift",_w="System",mw="2025-01-08T00:00:00Z",gw="#1a0033",vw="grid",ww=[{value:0,topEffects:[],middleEffects:[{id:"dark-0-draw",params:{action:"draw",count:3,target:"self",source:"own_deck"},position:"middle",trigger:"on_play"},{id:"dark-0-shift",params:{action:"shift",targetFilter:{owner:"opponent",position:"covered",faceState:"any",excludeSelf:!1},destinationRestriction:{type:"any"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"dark-1-flip",params:{action:"flip",count:1,optional:!1,targetFilter:{owner:"opponent",position:"uncovered",faceState:"any",excludeSelf:!1}},position:"middle",trigger:"on_play"},{id:"dark-1-shift",params:{action:"shift",optional:!0,targetFilter:{owner:"any",position:"any",faceState:"any",excludeSelf:!1},destinationRestriction:{type:"any"}},position:"middle",trigger:"on_play",useCardFromPreviousEffect:!0}],bottomEffects:[]},{value:2,topEffects:[{id:"dark-2-value-modifier",params:{action:"value_modifier",modifier:{type:"set_to_fixed",value:4,target:"own_cards",scope:"this_lane",filter:{faceState:"face_down",position:"any"}}},position:"top",trigger:"passive"}],middleEffects:[{id:"dark-2-flip",params:{action:"flip",count:1,optional:!0,scope:"this_lane",targetFilter:{owner:"any",position:"covered",faceState:"any",excludeSelf:!1}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"dark-3-play",params:{action:"play",source:"hand",count:1,faceDown:!0,destinationRule:{type:"other_lines",excludeCurrentLane:!0}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"dark-4-shift",params:{action:"shift",targetFilter:{owner:"any",position:"uncovered",faceState:"face_down",excludeSelf:!1},destinationRestriction:{type:"any"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"dark-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],xw={id:fw,name:hw,description:yw,author:_w,createdAt:mw,color:gw,pattern:vw,cards:ww},Cw="death_custom_v1",Sw="Death_cust",bw="Custom Death protocol - delete cards with various conditions",Ew="System",jw="2025-01-09T00:00:00Z",Rw="#8B0000",Aw="stripes",kw=[{value:0,topEffects:[],middleEffects:[{id:"death-0-delete-from-each-lane",params:{action:"delete",count:1,scope:{type:"each_other_line"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[{id:"death-1-optional-draw",params:{action:"draw",count:1,optional:!0},position:"top",trigger:"start",conditional:{type:"if_executed",thenEffect:{id:"death-1-delete-other",params:{action:"delete",count:1,excludeSelf:!0},position:"top",trigger:"start",conditional:{type:"then",thenEffect:{id:"death-1-delete-self",params:{action:"delete",count:1,targetFilter:{position:"any",owner:"own"},deleteSelf:!0},position:"top",trigger:"start"}}}}}],middleEffects:[],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"death-2-delete-lane-values",params:{action:"delete",count:"all",selectLane:!0,targetFilter:{faceState:"any",valueRange:{min:1,max:2}}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"death-3-delete-facedown",params:{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"face_down"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"death-4-delete-low-value",params:{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"face_up",valueRange:{min:0,max:1}}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"death-5-discard",params:{action:"discard",count:1},position:"middle",trigger:"on_play"}],bottomEffects:[]}],Dw={id:Cw,name:Sw,description:bw,author:Ew,createdAt:jw,color:Rw,pattern:Aw,cards:kw},Tw="fire-custom-001",Nw="Fire_custom",Fw="Fire protocol - discard cards to fuel powerful effects",qw="System",Uw="2025-11-09T00:00:00.000Z",Ow="#F06838",$w="radial",Lw=[{value:0,topEffects:[],middleEffects:[{id:"fire-0-flip",params:{action:"flip",count:1,targetFilter:{excludeSelf:!0}},position:"middle",trigger:"on_play"},{id:"fire-0-draw",params:{action:"draw",count:2},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"fire-0-oncover-draw",params:{action:"draw",count:1},position:"bottom",trigger:"on_cover",conditional:{type:"then",thenEffect:{id:"fire-0-oncover-flip",params:{action:"flip",count:1,targetFilter:{excludeSelf:!0}},position:"bottom",trigger:"on_cover"}}}]},{value:1,topEffects:[],middleEffects:[{id:"fire-1-discard",params:{action:"discard",count:1},position:"middle",trigger:"on_play",conditional:{type:"if_executed",thenEffect:{id:"fire-1-delete",params:{action:"delete",count:1},position:"middle",trigger:"on_play"}}}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"fire-2-discard",params:{action:"discard",count:1},position:"middle",trigger:"on_play",conditional:{type:"if_executed",thenEffect:{id:"fire-2-return",params:{action:"return",count:1},position:"middle",trigger:"on_play"}}}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[],bottomEffects:[{id:"fire-3-discard",params:{action:"discard",count:1,optional:!0},position:"bottom",trigger:"end",conditional:{type:"if_executed",thenEffect:{id:"fire-3-flip",params:{action:"flip",count:1},position:"bottom",trigger:"end"}}}]},{value:4,topEffects:[],middleEffects:[{id:"fire-4-discard-variable",params:{action:"discard",count:1,variableCount:!0},position:"middle",trigger:"on_play",conditional:{type:"then",thenEffect:{id:"fire-4-draw-based-on-discard",params:{action:"draw",countType:"equal_to_discarded",countOffset:1},position:"middle",trigger:"on_play"}}}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"fire-5-discard",params:{action:"discard",count:1,optional:!1},position:"middle",trigger:"on_play"}],bottomEffects:[]}],Mw={id:Tw,name:Nw,description:Fw,author:qw,createdAt:Uw,color:Ow,pattern:$w,cards:Lw};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Pw=()=>{try{const n=kc();console.log("[Default Protocols] Loading/Updating Anarchy_custom protocol..."),aa(ow),console.log("[Default Protocols] Anarchy_custom loaded/updated successfully!"),console.log("[Default Protocols] Loading/Updating Apathy_custom protocol..."),aa(pw),console.log("[Default Protocols] Apathy_custom loaded/updated successfully!"),console.log("[Default Protocols] Loading/Updating Dark_cust protocol..."),aa(xw),console.log("[Default Protocols] Dark_cust loaded/updated successfully!"),console.log("[Default Protocols] Loading/Updating Death_cust protocol..."),aa(Dw),console.log("[Default Protocols] Death_cust loaded/updated successfully!"),console.log("[Default Protocols] Loading/Updating Fire protocol..."),aa(Mw),console.log("[Default Protocols] Fire loaded/updated successfully!")}catch(n){console.error("[Default Protocols] Error loading default protocols:",n)}};function Iw(){const[n,o]=te.useState("MainMenu"),[c,i]=te.useState([]),[r,l]=te.useState([]),[s,f]=te.useState(null),[p,h]=te.useState("easy"),[_,m]=te.useState(null),[v,w]=te.useState(!0),[x,C]=te.useState("player");te.useEffect(()=>{Pw()},[]);const S=te.useCallback(()=>{o("MainMenu"),i([]),l([]),f(null),m(null)},[]);te.useEffect(()=>{const A=L=>{L.key==="Escape"&&S()};return window.addEventListener("keydown",A),()=>{window.removeEventListener("keydown",A)}},[S]);const E=te.useCallback((A,L)=>{i(A),l(L),f(null),m(null),C("player"),o("GameScreen")},[]),j=te.useCallback((A,L)=>{f(A),m(L),o("ResultsScreen")},[]),D=()=>{switch(n){case"MainMenu":return u.jsx(rh,{onNavigate:A=>o(A),difficulty:p,setDifficulty:h,useControl:v,onUseControlChange:w});case"ProtocolSelection":return u.jsx(ag,{onBack:S,onStartGame:E});case"GameScreen":return u.jsx(v1,{onBack:S,onEndGame:j,playerProtocols:c,opponentProtocols:r,difficulty:p,useControlMechanic:v,startingPlayer:x});case"ResultsScreen":return u.jsx(w1,{onPlayAgain:S,winner:s,finalState:_,difficulty:p});case"CardLibrary":return u.jsx(x1,{onBack:S});case"Statistics":return u.jsx(C1,{onBack:S});case"CustomProtocols":return u.jsx(W1,{onBack:S});default:return u.jsx(rh,{onNavigate:A=>o(A),difficulty:p,setDifficulty:h,useControl:v,onUseControlChange:w})}};return u.jsx(u.Fragment,{children:D()})}const Hw=document.getElementById("root"),Vw=Xm.createRoot(Hw);Vw.render(u.jsx(Iw,{}));
