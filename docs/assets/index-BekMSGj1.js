(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))c(i);new MutationObserver(i=>{for(const d of i)if(d.type==="childList")for(const u of d.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&c(u)}).observe(document,{childList:!0,subtree:!0});function l(i){const d={};return i.integrity&&(d.integrity=i.integrity),i.referrerPolicy&&(d.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?d.credentials="include":i.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function c(i){if(i.ep)return;i.ep=!0;const d=l(i);fetch(i.href,d)}})();var md={exports:{}},Ol={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ph;function c_(){if(ph)return Ol;ph=1;var a=Symbol.for("react.transitional.element"),n=Symbol.for("react.fragment");function l(c,i,d){var u=null;if(d!==void 0&&(u=""+d),i.key!==void 0&&(u=""+i.key),"key"in i){d={};for(var h in i)h!=="key"&&(d[h]=i[h])}else d=i;return i=d.ref,{$$typeof:a,type:c,key:u,ref:i!==void 0?i:null,props:d}}return Ol.Fragment=n,Ol.jsx=l,Ol.jsxs=l,Ol}var hh;function i_(){return hh||(hh=1,md.exports=c_()),md.exports}var o=i_(),yd={exports:{}},Ml={},gd={exports:{}},vd={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var mh;function d_(){return mh||(mh=1,(function(a){function n(T,q){var Y=T.length;T.push(q);e:for(;0<Y;){var K=Y-1>>>1,P=T[K];if(0<i(P,q))T[K]=q,T[Y]=P,Y=K;else break e}}function l(T){return T.length===0?null:T[0]}function c(T){if(T.length===0)return null;var q=T[0],Y=T.pop();if(Y!==q){T[0]=Y;e:for(var K=0,P=T.length,Z=P>>>1;K<Z;){var W=2*(K+1)-1,G=T[W],H=W+1,B=T[H];if(0>i(G,Y))H<P&&0>i(B,G)?(T[K]=B,T[H]=Y,K=H):(T[K]=G,T[W]=Y,K=W);else if(H<P&&0>i(B,Y))T[K]=B,T[H]=Y,K=H;else break e}}return q}function i(T,q){var Y=T.sortIndex-q.sortIndex;return Y!==0?Y:T.id-q.id}if(a.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var d=performance;a.unstable_now=function(){return d.now()}}else{var u=Date,h=u.now();a.unstable_now=function(){return u.now()-h}}var f=[],m=[],y=1,v=null,_=3,w=!1,b=!1,N=!1,S=!1,k=typeof setTimeout=="function"?setTimeout:null,C=typeof clearTimeout=="function"?clearTimeout:null,j=typeof setImmediate<"u"?setImmediate:null;function R(T){for(var q=l(m);q!==null;){if(q.callback===null)c(m);else if(q.startTime<=T)c(m),q.sortIndex=q.expirationTime,n(f,q);else break;q=l(m)}}function F(T){if(N=!1,R(T),!b)if(l(f)!==null)b=!0,L||(L=!0,E());else{var q=l(m);q!==null&&I(F,q.startTime-T)}}var L=!1,U=-1,Q=5,X=-1;function V(){return S?!0:!(a.unstable_now()-X<Q)}function $(){if(S=!1,L){var T=a.unstable_now();X=T;var q=!0;try{e:{b=!1,N&&(N=!1,C(U),U=-1),w=!0;var Y=_;try{t:{for(R(T),v=l(f);v!==null&&!(v.expirationTime>T&&V());){var K=v.callback;if(typeof K=="function"){v.callback=null,_=v.priorityLevel;var P=K(v.expirationTime<=T);if(T=a.unstable_now(),typeof P=="function"){v.callback=P,R(T),q=!0;break t}v===l(f)&&c(f),R(T)}else c(f);v=l(f)}if(v!==null)q=!0;else{var Z=l(m);Z!==null&&I(F,Z.startTime-T),q=!1}}break e}finally{v=null,_=Y,w=!1}q=void 0}}finally{q?E():L=!1}}}var E;if(typeof j=="function")E=function(){j($)};else if(typeof MessageChannel<"u"){var A=new MessageChannel,O=A.port2;A.port1.onmessage=$,E=function(){O.postMessage(null)}}else E=function(){k($,0)};function I(T,q){U=k(function(){T(a.unstable_now())},q)}a.unstable_IdlePriority=5,a.unstable_ImmediatePriority=1,a.unstable_LowPriority=4,a.unstable_NormalPriority=3,a.unstable_Profiling=null,a.unstable_UserBlockingPriority=2,a.unstable_cancelCallback=function(T){T.callback=null},a.unstable_forceFrameRate=function(T){0>T||125<T?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Q=0<T?Math.floor(1e3/T):5},a.unstable_getCurrentPriorityLevel=function(){return _},a.unstable_next=function(T){switch(_){case 1:case 2:case 3:var q=3;break;default:q=_}var Y=_;_=q;try{return T()}finally{_=Y}},a.unstable_requestPaint=function(){S=!0},a.unstable_runWithPriority=function(T,q){switch(T){case 1:case 2:case 3:case 4:case 5:break;default:T=3}var Y=_;_=T;try{return q()}finally{_=Y}},a.unstable_scheduleCallback=function(T,q,Y){var K=a.unstable_now();switch(typeof Y=="object"&&Y!==null?(Y=Y.delay,Y=typeof Y=="number"&&0<Y?K+Y:K):Y=K,T){case 1:var P=-1;break;case 2:P=250;break;case 5:P=1073741823;break;case 4:P=1e4;break;default:P=5e3}return P=Y+P,T={id:y++,callback:q,priorityLevel:T,startTime:Y,expirationTime:P,sortIndex:-1},Y>K?(T.sortIndex=Y,n(m,T),l(f)===null&&T===l(m)&&(N?(C(U),U=-1):N=!0,I(F,Y-K))):(T.sortIndex=P,n(f,T),b||w||(b=!0,L||(L=!0,E()))),T},a.unstable_shouldYield=V,a.unstable_wrapCallback=function(T){var q=_;return function(){var Y=_;_=q;try{return T.apply(this,arguments)}finally{_=Y}}}})(vd)),vd}var yh;function u_(){return yh||(yh=1,gd.exports=d_()),gd.exports}var _d={exports:{}},Ye={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var gh;function f_(){if(gh)return Ye;gh=1;var a=Symbol.for("react.transitional.element"),n=Symbol.for("react.portal"),l=Symbol.for("react.fragment"),c=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),d=Symbol.for("react.consumer"),u=Symbol.for("react.context"),h=Symbol.for("react.forward_ref"),f=Symbol.for("react.suspense"),m=Symbol.for("react.memo"),y=Symbol.for("react.lazy"),v=Symbol.iterator;function _(P){return P===null||typeof P!="object"?null:(P=v&&P[v]||P["@@iterator"],typeof P=="function"?P:null)}var w={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},b=Object.assign,N={};function S(P,Z,W){this.props=P,this.context=Z,this.refs=N,this.updater=W||w}S.prototype.isReactComponent={},S.prototype.setState=function(P,Z){if(typeof P!="object"&&typeof P!="function"&&P!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,P,Z,"setState")},S.prototype.forceUpdate=function(P){this.updater.enqueueForceUpdate(this,P,"forceUpdate")};function k(){}k.prototype=S.prototype;function C(P,Z,W){this.props=P,this.context=Z,this.refs=N,this.updater=W||w}var j=C.prototype=new k;j.constructor=C,b(j,S.prototype),j.isPureReactComponent=!0;var R=Array.isArray,F={H:null,A:null,T:null,S:null,V:null},L=Object.prototype.hasOwnProperty;function U(P,Z,W,G,H,B){return W=B.ref,{$$typeof:a,type:P,key:Z,ref:W!==void 0?W:null,props:B}}function Q(P,Z){return U(P.type,Z,void 0,void 0,void 0,P.props)}function X(P){return typeof P=="object"&&P!==null&&P.$$typeof===a}function V(P){var Z={"=":"=0",":":"=2"};return"$"+P.replace(/[=:]/g,function(W){return Z[W]})}var $=/\/+/g;function E(P,Z){return typeof P=="object"&&P!==null&&P.key!=null?V(""+P.key):Z.toString(36)}function A(){}function O(P){switch(P.status){case"fulfilled":return P.value;case"rejected":throw P.reason;default:switch(typeof P.status=="string"?P.then(A,A):(P.status="pending",P.then(function(Z){P.status==="pending"&&(P.status="fulfilled",P.value=Z)},function(Z){P.status==="pending"&&(P.status="rejected",P.reason=Z)})),P.status){case"fulfilled":return P.value;case"rejected":throw P.reason}}throw P}function I(P,Z,W,G,H){var B=typeof P;(B==="undefined"||B==="boolean")&&(P=null);var ee=!1;if(P===null)ee=!0;else switch(B){case"bigint":case"string":case"number":ee=!0;break;case"object":switch(P.$$typeof){case a:case n:ee=!0;break;case y:return ee=P._init,I(ee(P._payload),Z,W,G,H)}}if(ee)return H=H(P),ee=G===""?"."+E(P,0):G,R(H)?(W="",ee!=null&&(W=ee.replace($,"$&/")+"/"),I(H,Z,W,"",function(pe){return pe})):H!=null&&(X(H)&&(H=Q(H,W+(H.key==null||P&&P.key===H.key?"":(""+H.key).replace($,"$&/")+"/")+ee)),Z.push(H)),1;ee=0;var de=G===""?".":G+":";if(R(P))for(var J=0;J<P.length;J++)G=P[J],B=de+E(G,J),ee+=I(G,Z,W,B,H);else if(J=_(P),typeof J=="function")for(P=J.call(P),J=0;!(G=P.next()).done;)G=G.value,B=de+E(G,J++),ee+=I(G,Z,W,B,H);else if(B==="object"){if(typeof P.then=="function")return I(O(P),Z,W,G,H);throw Z=String(P),Error("Objects are not valid as a React child (found: "+(Z==="[object Object]"?"object with keys {"+Object.keys(P).join(", ")+"}":Z)+"). If you meant to render a collection of children, use an array instead.")}return ee}function T(P,Z,W){if(P==null)return P;var G=[],H=0;return I(P,G,"","",function(B){return Z.call(W,B,H++)}),G}function q(P){if(P._status===-1){var Z=P._result;Z=Z(),Z.then(function(W){(P._status===0||P._status===-1)&&(P._status=1,P._result=W)},function(W){(P._status===0||P._status===-1)&&(P._status=2,P._result=W)}),P._status===-1&&(P._status=0,P._result=Z)}if(P._status===1)return P._result.default;throw P._result}var Y=typeof reportError=="function"?reportError:function(P){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Z=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof P=="object"&&P!==null&&typeof P.message=="string"?String(P.message):String(P),error:P});if(!window.dispatchEvent(Z))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",P);return}console.error(P)};function K(){}return Ye.Children={map:T,forEach:function(P,Z,W){T(P,function(){Z.apply(this,arguments)},W)},count:function(P){var Z=0;return T(P,function(){Z++}),Z},toArray:function(P){return T(P,function(Z){return Z})||[]},only:function(P){if(!X(P))throw Error("React.Children.only expected to receive a single React element child.");return P}},Ye.Component=S,Ye.Fragment=l,Ye.Profiler=i,Ye.PureComponent=C,Ye.StrictMode=c,Ye.Suspense=f,Ye.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=F,Ye.__COMPILER_RUNTIME={__proto__:null,c:function(P){return F.H.useMemoCache(P)}},Ye.cache=function(P){return function(){return P.apply(null,arguments)}},Ye.cloneElement=function(P,Z,W){if(P==null)throw Error("The argument must be a React element, but you passed "+P+".");var G=b({},P.props),H=P.key,B=void 0;if(Z!=null)for(ee in Z.ref!==void 0&&(B=void 0),Z.key!==void 0&&(H=""+Z.key),Z)!L.call(Z,ee)||ee==="key"||ee==="__self"||ee==="__source"||ee==="ref"&&Z.ref===void 0||(G[ee]=Z[ee]);var ee=arguments.length-2;if(ee===1)G.children=W;else if(1<ee){for(var de=Array(ee),J=0;J<ee;J++)de[J]=arguments[J+2];G.children=de}return U(P.type,H,void 0,void 0,B,G)},Ye.createContext=function(P){return P={$$typeof:u,_currentValue:P,_currentValue2:P,_threadCount:0,Provider:null,Consumer:null},P.Provider=P,P.Consumer={$$typeof:d,_context:P},P},Ye.createElement=function(P,Z,W){var G,H={},B=null;if(Z!=null)for(G in Z.key!==void 0&&(B=""+Z.key),Z)L.call(Z,G)&&G!=="key"&&G!=="__self"&&G!=="__source"&&(H[G]=Z[G]);var ee=arguments.length-2;if(ee===1)H.children=W;else if(1<ee){for(var de=Array(ee),J=0;J<ee;J++)de[J]=arguments[J+2];H.children=de}if(P&&P.defaultProps)for(G in ee=P.defaultProps,ee)H[G]===void 0&&(H[G]=ee[G]);return U(P,B,void 0,void 0,null,H)},Ye.createRef=function(){return{current:null}},Ye.forwardRef=function(P){return{$$typeof:h,render:P}},Ye.isValidElement=X,Ye.lazy=function(P){return{$$typeof:y,_payload:{_status:-1,_result:P},_init:q}},Ye.memo=function(P,Z){return{$$typeof:m,type:P,compare:Z===void 0?null:Z}},Ye.startTransition=function(P){var Z=F.T,W={};F.T=W;try{var G=P(),H=F.S;H!==null&&H(W,G),typeof G=="object"&&G!==null&&typeof G.then=="function"&&G.then(K,Y)}catch(B){Y(B)}finally{F.T=Z}},Ye.unstable_useCacheRefresh=function(){return F.H.useCacheRefresh()},Ye.use=function(P){return F.H.use(P)},Ye.useActionState=function(P,Z,W){return F.H.useActionState(P,Z,W)},Ye.useCallback=function(P,Z){return F.H.useCallback(P,Z)},Ye.useContext=function(P){return F.H.useContext(P)},Ye.useDebugValue=function(){},Ye.useDeferredValue=function(P,Z){return F.H.useDeferredValue(P,Z)},Ye.useEffect=function(P,Z,W){var G=F.H;if(typeof W=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return G.useEffect(P,Z)},Ye.useId=function(){return F.H.useId()},Ye.useImperativeHandle=function(P,Z,W){return F.H.useImperativeHandle(P,Z,W)},Ye.useInsertionEffect=function(P,Z){return F.H.useInsertionEffect(P,Z)},Ye.useLayoutEffect=function(P,Z){return F.H.useLayoutEffect(P,Z)},Ye.useMemo=function(P,Z){return F.H.useMemo(P,Z)},Ye.useOptimistic=function(P,Z){return F.H.useOptimistic(P,Z)},Ye.useReducer=function(P,Z,W){return F.H.useReducer(P,Z,W)},Ye.useRef=function(P){return F.H.useRef(P)},Ye.useState=function(P){return F.H.useState(P)},Ye.useSyncExternalStore=function(P,Z,W){return F.H.useSyncExternalStore(P,Z,W)},Ye.useTransition=function(){return F.H.useTransition()},Ye.version="19.1.1",Ye}var vh;function Id(){return vh||(vh=1,_d.exports=f_()),_d.exports}var xd={exports:{}},on={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _h;function p_(){if(_h)return on;_h=1;var a=Id();function n(f){var m="https://react.dev/errors/"+f;if(1<arguments.length){m+="?args[]="+encodeURIComponent(arguments[1]);for(var y=2;y<arguments.length;y++)m+="&args[]="+encodeURIComponent(arguments[y])}return"Minified React error #"+f+"; visit "+m+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function l(){}var c={d:{f:l,r:function(){throw Error(n(522))},D:l,C:l,L:l,m:l,X:l,S:l,M:l},p:0,findDOMNode:null},i=Symbol.for("react.portal");function d(f,m,y){var v=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:i,key:v==null?null:""+v,children:f,containerInfo:m,implementation:y}}var u=a.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function h(f,m){if(f==="font")return"";if(typeof m=="string")return m==="use-credentials"?m:""}return on.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=c,on.createPortal=function(f,m){var y=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!m||m.nodeType!==1&&m.nodeType!==9&&m.nodeType!==11)throw Error(n(299));return d(f,m,null,y)},on.flushSync=function(f){var m=u.T,y=c.p;try{if(u.T=null,c.p=2,f)return f()}finally{u.T=m,c.p=y,c.d.f()}},on.preconnect=function(f,m){typeof f=="string"&&(m?(m=m.crossOrigin,m=typeof m=="string"?m==="use-credentials"?m:"":void 0):m=null,c.d.C(f,m))},on.prefetchDNS=function(f){typeof f=="string"&&c.d.D(f)},on.preinit=function(f,m){if(typeof f=="string"&&m&&typeof m.as=="string"){var y=m.as,v=h(y,m.crossOrigin),_=typeof m.integrity=="string"?m.integrity:void 0,w=typeof m.fetchPriority=="string"?m.fetchPriority:void 0;y==="style"?c.d.S(f,typeof m.precedence=="string"?m.precedence:void 0,{crossOrigin:v,integrity:_,fetchPriority:w}):y==="script"&&c.d.X(f,{crossOrigin:v,integrity:_,fetchPriority:w,nonce:typeof m.nonce=="string"?m.nonce:void 0})}},on.preinitModule=function(f,m){if(typeof f=="string")if(typeof m=="object"&&m!==null){if(m.as==null||m.as==="script"){var y=h(m.as,m.crossOrigin);c.d.M(f,{crossOrigin:y,integrity:typeof m.integrity=="string"?m.integrity:void 0,nonce:typeof m.nonce=="string"?m.nonce:void 0})}}else m==null&&c.d.M(f)},on.preload=function(f,m){if(typeof f=="string"&&typeof m=="object"&&m!==null&&typeof m.as=="string"){var y=m.as,v=h(y,m.crossOrigin);c.d.L(f,y,{crossOrigin:v,integrity:typeof m.integrity=="string"?m.integrity:void 0,nonce:typeof m.nonce=="string"?m.nonce:void 0,type:typeof m.type=="string"?m.type:void 0,fetchPriority:typeof m.fetchPriority=="string"?m.fetchPriority:void 0,referrerPolicy:typeof m.referrerPolicy=="string"?m.referrerPolicy:void 0,imageSrcSet:typeof m.imageSrcSet=="string"?m.imageSrcSet:void 0,imageSizes:typeof m.imageSizes=="string"?m.imageSizes:void 0,media:typeof m.media=="string"?m.media:void 0})}},on.preloadModule=function(f,m){if(typeof f=="string")if(m){var y=h(m.as,m.crossOrigin);c.d.m(f,{as:typeof m.as=="string"&&m.as!=="script"?m.as:void 0,crossOrigin:y,integrity:typeof m.integrity=="string"?m.integrity:void 0})}else c.d.m(f)},on.requestFormReset=function(f){c.d.r(f)},on.unstable_batchedUpdates=function(f,m){return f(m)},on.useFormState=function(f,m,y){return u.H.useFormState(f,m,y)},on.useFormStatus=function(){return u.H.useHostTransitionStatus()},on.version="19.1.1",on}var xh;function h_(){if(xh)return xd.exports;xh=1;function a(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(a)}catch(n){console.error(n)}}return a(),xd.exports=p_(),xd.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var wh;function m_(){if(wh)return Ml;wh=1;var a=u_(),n=Id(),l=h_();function c(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var r=2;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function d(e){var t=e,r=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,(t.flags&4098)!==0&&(r=t.return),e=t.return;while(e)}return t.tag===3?r:null}function u(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function h(e){if(d(e)!==e)throw Error(c(188))}function f(e){var t=e.alternate;if(!t){if(t=d(e),t===null)throw Error(c(188));return t!==e?null:e}for(var r=e,s=t;;){var p=r.return;if(p===null)break;var g=p.alternate;if(g===null){if(s=p.return,s!==null){r=s;continue}break}if(p.child===g.child){for(g=p.child;g;){if(g===r)return h(p),e;if(g===s)return h(p),t;g=g.sibling}throw Error(c(188))}if(r.return!==s.return)r=p,s=g;else{for(var D=!1,M=p.child;M;){if(M===r){D=!0,r=p,s=g;break}if(M===s){D=!0,s=p,r=g;break}M=M.sibling}if(!D){for(M=g.child;M;){if(M===r){D=!0,r=g,s=p;break}if(M===s){D=!0,s=g,r=p;break}M=M.sibling}if(!D)throw Error(c(189))}}if(r.alternate!==s)throw Error(c(190))}if(r.tag!==3)throw Error(c(188));return r.stateNode.current===r?e:t}function m(e){var t=e.tag;if(t===5||t===26||t===27||t===6)return e;for(e=e.child;e!==null;){if(t=m(e),t!==null)return t;e=e.sibling}return null}var y=Object.assign,v=Symbol.for("react.element"),_=Symbol.for("react.transitional.element"),w=Symbol.for("react.portal"),b=Symbol.for("react.fragment"),N=Symbol.for("react.strict_mode"),S=Symbol.for("react.profiler"),k=Symbol.for("react.provider"),C=Symbol.for("react.consumer"),j=Symbol.for("react.context"),R=Symbol.for("react.forward_ref"),F=Symbol.for("react.suspense"),L=Symbol.for("react.suspense_list"),U=Symbol.for("react.memo"),Q=Symbol.for("react.lazy"),X=Symbol.for("react.activity"),V=Symbol.for("react.memo_cache_sentinel"),$=Symbol.iterator;function E(e){return e===null||typeof e!="object"?null:(e=$&&e[$]||e["@@iterator"],typeof e=="function"?e:null)}var A=Symbol.for("react.client.reference");function O(e){if(e==null)return null;if(typeof e=="function")return e.$$typeof===A?null:e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case b:return"Fragment";case S:return"Profiler";case N:return"StrictMode";case F:return"Suspense";case L:return"SuspenseList";case X:return"Activity"}if(typeof e=="object")switch(e.$$typeof){case w:return"Portal";case j:return(e.displayName||"Context")+".Provider";case C:return(e._context.displayName||"Context")+".Consumer";case R:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case U:return t=e.displayName||null,t!==null?t:O(e.type)||"Memo";case Q:t=e._payload,e=e._init;try{return O(e(t))}catch{}}return null}var I=Array.isArray,T=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,q=l.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Y={pending:!1,data:null,method:null,action:null},K=[],P=-1;function Z(e){return{current:e}}function W(e){0>P||(e.current=K[P],K[P]=null,P--)}function G(e,t){P++,K[P]=e.current,e.current=t}var H=Z(null),B=Z(null),ee=Z(null),de=Z(null);function J(e,t){switch(G(ee,t),G(B,e),G(H,null),t.nodeType){case 9:case 11:e=(e=t.documentElement)&&(e=e.namespaceURI)?Mp(e):0;break;default:if(e=t.tagName,t=t.namespaceURI)t=Mp(t),e=Hp(t,e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}W(H),G(H,e)}function pe(){W(H),W(B),W(ee)}function fe(e){e.memoizedState!==null&&G(de,e);var t=H.current,r=Hp(t,e.type);t!==r&&(G(B,e),G(H,r))}function ye(e){B.current===e&&(W(H),W(B)),de.current===e&&(W(de),$l._currentValue=Y)}var ke=Object.prototype.hasOwnProperty,Ve=a.unstable_scheduleCallback,Le=a.unstable_cancelCallback,at=a.unstable_shouldYield,Te=a.unstable_requestPaint,qe=a.unstable_now,_t=a.unstable_getCurrentPriorityLevel,Ft=a.unstable_ImmediatePriority,He=a.unstable_UserBlockingPriority,$e=a.unstable_NormalPriority,nt=a.unstable_LowPriority,ot=a.unstable_IdlePriority,Pt=a.log,bt=a.unstable_setDisableYieldValue,xt=null,yt=null;function Mt(e){if(typeof Pt=="function"&&bt(e),yt&&typeof yt.setStrictMode=="function")try{yt.setStrictMode(xt,e)}catch{}}var wt=Math.clz32?Math.clz32:ta,Vn=Math.log,ga=Math.LN2;function ta(e){return e>>>=0,e===0?32:31-(Vn(e)/ga|0)|0}var Tn=256,un=4194304;function qt(e){var t=e&42;if(t!==0)return t;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return e&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function tn(e,t,r){var s=e.pendingLanes;if(s===0)return 0;var p=0,g=e.suspendedLanes,D=e.pingedLanes;e=e.warmLanes;var M=s&134217727;return M!==0?(s=M&~g,s!==0?p=qt(s):(D&=M,D!==0?p=qt(D):r||(r=M&~e,r!==0&&(p=qt(r))))):(M=s&~g,M!==0?p=qt(M):D!==0?p=qt(D):r||(r=s&~e,r!==0&&(p=qt(r)))),p===0?0:t!==0&&t!==p&&(t&g)===0&&(g=p&-p,r=t&-t,g>=r||g===32&&(r&4194048)!==0)?t:p}function xn(e,t){return(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&t)===0}function va(e,t){switch(e){case 1:case 2:case 4:case 8:case 64:return t+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function na(){var e=Tn;return Tn<<=1,(Tn&4194048)===0&&(Tn=256),e}function aa(){var e=un;return un<<=1,(un&62914560)===0&&(un=4194304),e}function Bn(e){for(var t=[],r=0;31>r;r++)t.push(e);return t}function fn(e,t){e.pendingLanes|=t,t!==268435456&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function Yn(e,t,r,s,p,g){var D=e.pendingLanes;e.pendingLanes=r,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=r,e.entangledLanes&=r,e.errorRecoveryDisabledLanes&=r,e.shellSuspendCounter=0;var M=e.entanglements,te=e.expirationTimes,se=e.hiddenUpdates;for(r=D&~r;0<r;){var he=31-wt(r),ve=1<<he;M[he]=0,te[he]=-1;var ce=se[he];if(ce!==null)for(se[he]=null,he=0;he<ce.length;he++){var ie=ce[he];ie!==null&&(ie.lane&=-536870913)}r&=~ve}s!==0&&oa(e,s,0),g!==0&&p===0&&e.tag!==0&&(e.suspendedLanes|=g&~(D&~t))}function oa(e,t,r){e.pendingLanes|=t,e.suspendedLanes&=~t;var s=31-wt(t);e.entangledLanes|=t,e.entanglements[s]=e.entanglements[s]|1073741824|r&4194090}function ra(e,t){var r=e.entangledLanes|=t;for(e=e.entanglements;r;){var s=31-wt(r),p=1<<s;p&t|e[s]&t&&(e[s]|=t),r&=~p}}function Gn(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function Wn(e){return e&=-e,2<e?8<e?(e&134217727)!==0?32:268435456:8:2}function la(){var e=q.p;return e!==0?e:(e=window.event,e===void 0?32:sh(e.type))}function sa(e,t){var r=q.p;try{return q.p=e,t()}finally{q.p=r}}var nn=Math.random().toString(36).slice(2),St="__reactFiber$"+nn,At="__reactProps$"+nn,ue="__reactContainer$"+nn,Ce="__reactEvents$"+nn,Re="__reactListeners$"+nn,Ie="__reactHandles$"+nn,De="__reactResources$"+nn,ze="__reactMarker$"+nn;function Je(e){delete e[St],delete e[At],delete e[Ce],delete e[Re],delete e[Ie]}function Be(e){var t=e[St];if(t)return t;for(var r=e.parentNode;r;){if(t=r[ue]||r[St]){if(r=t.alternate,t.child!==null||r!==null&&r.child!==null)for(e=Yp(e);e!==null;){if(r=e[St])return r;e=Yp(e)}return t}e=r,r=e.parentNode}return null}function Fe(e){if(e=e[St]||e[ue]){var t=e.tag;if(t===5||t===6||t===13||t===26||t===27||t===3)return e}return null}function rt(e){var t=e.tag;if(t===5||t===26||t===27||t===6)return e.stateNode;throw Error(c(33))}function Qt(e){var t=e[De];return t||(t=e[De]={hoistableStyles:new Map,hoistableScripts:new Map}),t}function me(e){e[ze]=!0}var xe=new Set,be={};function We(e,t){Et(e,t),Et(e+"Capture",t)}function Et(e,t){for(be[e]=t,e=0;e<t.length;e++)xe.add(t[e])}var rn=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),ca={},ln={};function Dn(e){return ke.call(ln,e)?!0:ke.call(ca,e)?!1:rn.test(e)?ln[e]=!0:(ca[e]=!0,!1)}function Fn(e,t,r){if(Dn(t))if(r===null)e.removeAttribute(t);else{switch(typeof r){case"undefined":case"function":case"symbol":e.removeAttribute(t);return;case"boolean":var s=t.toLowerCase().slice(0,5);if(s!=="data-"&&s!=="aria-"){e.removeAttribute(t);return}}e.setAttribute(t,""+r)}}function sn(e,t,r){if(r===null)e.removeAttribute(t);else{switch(typeof r){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(t);return}e.setAttribute(t,""+r)}}function pn(e,t,r,s){if(s===null)e.removeAttribute(r);else{switch(typeof s){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(r);return}e.setAttributeNS(t,r,""+s)}}var bo,Bt;function Qn(e){if(bo===void 0)try{throw Error()}catch(r){var t=r.stack.trim().match(/\n( *(at )?)/);bo=t&&t[1]||"",Bt=-1<r.stack.indexOf(`
    at`)?" (<anonymous>)":-1<r.stack.indexOf("@")?"@unknown:0:0":""}return`
`+bo+e+Bt}var Ma=!1;function Ha(e,t){if(!e||Ma)return"";Ma=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var s={DetermineComponentFrameRoot:function(){try{if(t){var ve=function(){throw Error()};if(Object.defineProperty(ve.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(ve,[])}catch(ie){var ce=ie}Reflect.construct(e,[],ve)}else{try{ve.call()}catch(ie){ce=ie}e.call(ve.prototype)}}else{try{throw Error()}catch(ie){ce=ie}(ve=e())&&typeof ve.catch=="function"&&ve.catch(function(){})}}catch(ie){if(ie&&ce&&typeof ie.stack=="string")return[ie.stack,ce.stack]}return[null,null]}};s.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var p=Object.getOwnPropertyDescriptor(s.DetermineComponentFrameRoot,"name");p&&p.configurable&&Object.defineProperty(s.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var g=s.DetermineComponentFrameRoot(),D=g[0],M=g[1];if(D&&M){var te=D.split(`
`),se=M.split(`
`);for(p=s=0;s<te.length&&!te[s].includes("DetermineComponentFrameRoot");)s++;for(;p<se.length&&!se[p].includes("DetermineComponentFrameRoot");)p++;if(s===te.length||p===se.length)for(s=te.length-1,p=se.length-1;1<=s&&0<=p&&te[s]!==se[p];)p--;for(;1<=s&&0<=p;s--,p--)if(te[s]!==se[p]){if(s!==1||p!==1)do if(s--,p--,0>p||te[s]!==se[p]){var he=`
`+te[s].replace(" at new "," at ");return e.displayName&&he.includes("<anonymous>")&&(he=he.replace("<anonymous>",e.displayName)),he}while(1<=s&&0<=p);break}}}finally{Ma=!1,Error.prepareStackTrace=r}return(r=e?e.displayName||e.name:"")?Qn(r):""}function Zo(e){switch(e.tag){case 26:case 27:case 5:return Qn(e.type);case 16:return Qn("Lazy");case 13:return Qn("Suspense");case 19:return Qn("SuspenseList");case 0:case 15:return Ha(e.type,!1);case 11:return Ha(e.type.render,!1);case 1:return Ha(e.type,!0);case 31:return Qn("Activity");default:return""}}function So(e){try{var t="";do t+=Zo(e),e=e.return;while(e);return t}catch(r){return`
Error generating stack: `+r.message+`
`+r.stack}}function Xt(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function ia(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function Ht(e){var t=ia(e)?"checked":"value",r=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),s=""+e[t];if(!e.hasOwnProperty(t)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var p=r.get,g=r.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return p.call(this)},set:function(D){s=""+D,g.call(this,D)}}),Object.defineProperty(e,t,{enumerable:r.enumerable}),{getValue:function(){return s},setValue:function(D){s=""+D},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function za(e){e._valueTracker||(e._valueTracker=Ht(e))}function _a(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var r=t.getValue(),s="";return e&&(s=ia(e)?e.checked?"true":"false":e.value),e=s,e!==r?(t.setValue(e),!0):!1}function Eo(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}var Kl=/[\n"\\]/g;function cn(e){return e.replace(Kl,function(t){return"\\"+t.charCodeAt(0).toString(16)+" "})}function Ko(e,t,r,s,p,g,D,M){e.name="",D!=null&&typeof D!="function"&&typeof D!="symbol"&&typeof D!="boolean"?e.type=D:e.removeAttribute("type"),t!=null?D==="number"?(t===0&&e.value===""||e.value!=t)&&(e.value=""+Xt(t)):e.value!==""+Xt(t)&&(e.value=""+Xt(t)):D!=="submit"&&D!=="reset"||e.removeAttribute("value"),t!=null?Jo(e,D,Xt(t)):r!=null?Jo(e,D,Xt(r)):s!=null&&e.removeAttribute("value"),p==null&&g!=null&&(e.defaultChecked=!!g),p!=null&&(e.checked=p&&typeof p!="function"&&typeof p!="symbol"),M!=null&&typeof M!="function"&&typeof M!="symbol"&&typeof M!="boolean"?e.name=""+Xt(M):e.removeAttribute("name")}function Vr(e,t,r,s,p,g,D,M){if(g!=null&&typeof g!="function"&&typeof g!="symbol"&&typeof g!="boolean"&&(e.type=g),t!=null||r!=null){if(!(g!=="submit"&&g!=="reset"||t!=null))return;r=r!=null?""+Xt(r):"",t=t!=null?""+Xt(t):r,M||t===e.value||(e.value=t),e.defaultValue=t}s=s??p,s=typeof s!="function"&&typeof s!="symbol"&&!!s,e.checked=M?e.checked:!!s,e.defaultChecked=!!s,D!=null&&typeof D!="function"&&typeof D!="symbol"&&typeof D!="boolean"&&(e.name=D)}function Jo(e,t,r){t==="number"&&Eo(e.ownerDocument)===e||e.defaultValue===""+r||(e.defaultValue=""+r)}function xa(e,t,r,s){if(e=e.options,t){t={};for(var p=0;p<r.length;p++)t["$"+r[p]]=!0;for(r=0;r<e.length;r++)p=t.hasOwnProperty("$"+e[r].value),e[r].selected!==p&&(e[r].selected=p),p&&s&&(e[r].defaultSelected=!0)}else{for(r=""+Xt(r),t=null,p=0;p<e.length;p++){if(e[p].value===r){e[p].selected=!0,s&&(e[p].defaultSelected=!0);return}t!==null||e[p].disabled||(t=e[p])}t!==null&&(t.selected=!0)}}function Br(e,t,r){if(t!=null&&(t=""+Xt(t),t!==e.value&&(e.value=t),r==null)){e.defaultValue!==t&&(e.defaultValue=t);return}e.defaultValue=r!=null?""+Xt(r):""}function Yr(e,t,r,s){if(t==null){if(s!=null){if(r!=null)throw Error(c(92));if(I(s)){if(1<s.length)throw Error(c(93));s=s[0]}r=s}r==null&&(r=""),t=r}r=Xt(t),e.defaultValue=r,s=e.textContent,s===r&&s!==""&&s!==null&&(e.value=s)}function wa(e,t){if(t){var r=e.firstChild;if(r&&r===e.lastChild&&r.nodeType===3){r.nodeValue=t;return}}e.textContent=t}var Jl=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Gr(e,t,r){var s=t.indexOf("--")===0;r==null||typeof r=="boolean"||r===""?s?e.setProperty(t,""):t==="float"?e.cssFloat="":e[t]="":s?e.setProperty(t,r):typeof r!="number"||r===0||Jl.has(t)?t==="float"?e.cssFloat=r:e[t]=(""+r).trim():e[t]=r+"px"}function Wr(e,t,r){if(t!=null&&typeof t!="object")throw Error(c(62));if(e=e.style,r!=null){for(var s in r)!r.hasOwnProperty(s)||t!=null&&t.hasOwnProperty(s)||(s.indexOf("--")===0?e.setProperty(s,""):s==="float"?e.cssFloat="":e[s]="");for(var p in t)s=t[p],t.hasOwnProperty(p)&&r[p]!==s&&Gr(e,p,s)}else for(var g in t)t.hasOwnProperty(g)&&Gr(e,g,t[g])}function er(e){if(e.indexOf("-")===-1)return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var es=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),ts=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function jo(e){return ts.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}var tr=null;function nr(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var Ca=null,ba=null;function Qr(e){var t=Fe(e);if(t&&(e=t.stateNode)){var r=e[At]||null;e:switch(e=t.stateNode,t.type){case"input":if(Ko(e,r.value,r.defaultValue,r.defaultValue,r.checked,r.defaultChecked,r.type,r.name),t=r.name,r.type==="radio"&&t!=null){for(r=e;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll('input[name="'+cn(""+t)+'"][type="radio"]'),t=0;t<r.length;t++){var s=r[t];if(s!==e&&s.form===e.form){var p=s[At]||null;if(!p)throw Error(c(90));Ko(s,p.value,p.defaultValue,p.defaultValue,p.checked,p.defaultChecked,p.type,p.name)}}for(t=0;t<r.length;t++)s=r[t],s.form===e.form&&_a(s)}break e;case"textarea":Br(e,r.value,r.defaultValue);break e;case"select":t=r.value,t!=null&&xa(e,!!r.multiple,t,!1)}}}var ar=!1;function ko(e,t,r){if(ar)return e(t,r);ar=!0;try{var s=e(t);return s}finally{if(ar=!1,(Ca!==null||ba!==null)&&(Os(),Ca&&(t=Ca,e=ba,ba=Ca=null,Qr(t),e)))for(t=0;t<e.length;t++)Qr(e[t])}}function Se(e,t){var r=e.stateNode;if(r===null)return null;var s=r[At]||null;if(s===null)return null;r=s[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(s=!s.disabled)||(e=e.type,s=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!s;break e;default:e=!1}if(e)return null;if(r&&typeof r!="function")throw Error(c(231,t,typeof r));return r}var Xn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Va=!1;if(Xn)try{var Ba={};Object.defineProperty(Ba,"passive",{get:function(){Va=!0}}),window.addEventListener("test",Ba,Ba),window.removeEventListener("test",Ba,Ba)}catch{Va=!1}var Sa=null,or=null,ns=null;function Vd(){if(ns)return ns;var e,t=or,r=t.length,s,p="value"in Sa?Sa.value:Sa.textContent,g=p.length;for(e=0;e<r&&t[e]===p[e];e++);var D=r-e;for(s=1;s<=D&&t[r-s]===p[g-s];s++);return ns=p.slice(e,1<s?1-s:void 0)}function as(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function os(){return!0}function Bd(){return!1}function hn(e){function t(r,s,p,g,D){this._reactName=r,this._targetInst=p,this.type=s,this.nativeEvent=g,this.target=D,this.currentTarget=null;for(var M in e)e.hasOwnProperty(M)&&(r=e[M],this[M]=r?r(g):g[M]);return this.isDefaultPrevented=(g.defaultPrevented!=null?g.defaultPrevented:g.returnValue===!1)?os:Bd,this.isPropagationStopped=Bd,this}return y(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=os)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=os)},persist:function(){},isPersistent:os}),t}var No={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},rs=hn(No),Xr=y({},No,{view:0,detail:0}),cg=hn(Xr),xc,wc,Zr,ls=y({},Xr,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:bc,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Zr&&(Zr&&e.type==="mousemove"?(xc=e.screenX-Zr.screenX,wc=e.screenY-Zr.screenY):wc=xc=0,Zr=e),xc)},movementY:function(e){return"movementY"in e?e.movementY:wc}}),Yd=hn(ls),ig=y({},ls,{dataTransfer:0}),dg=hn(ig),ug=y({},Xr,{relatedTarget:0}),Cc=hn(ug),fg=y({},No,{animationName:0,elapsedTime:0,pseudoElement:0}),pg=hn(fg),hg=y({},No,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),mg=hn(hg),yg=y({},No,{data:0}),Gd=hn(yg),gg={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},vg={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},_g={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function xg(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=_g[e])?!!t[e]:!1}function bc(){return xg}var wg=y({},Xr,{key:function(e){if(e.key){var t=gg[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=as(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?vg[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:bc,charCode:function(e){return e.type==="keypress"?as(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?as(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),Cg=hn(wg),bg=y({},ls,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Wd=hn(bg),Sg=y({},Xr,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:bc}),Eg=hn(Sg),jg=y({},No,{propertyName:0,elapsedTime:0,pseudoElement:0}),kg=hn(jg),Ng=y({},ls,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Rg=hn(Ng),Ag=y({},No,{newState:0,oldState:0}),Tg=hn(Ag),Dg=[9,13,27,32],Sc=Xn&&"CompositionEvent"in window,Kr=null;Xn&&"documentMode"in document&&(Kr=document.documentMode);var Fg=Xn&&"TextEvent"in window&&!Kr,Qd=Xn&&(!Sc||Kr&&8<Kr&&11>=Kr),Xd=" ",Zd=!1;function Kd(e,t){switch(e){case"keyup":return Dg.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Jd(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var rr=!1;function qg(e,t){switch(e){case"compositionend":return Jd(t);case"keypress":return t.which!==32?null:(Zd=!0,Xd);case"textInput":return e=t.data,e===Xd&&Zd?null:e;default:return null}}function $g(e,t){if(rr)return e==="compositionend"||!Sc&&Kd(e,t)?(e=Vd(),ns=or=Sa=null,rr=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Qd&&t.locale!=="ko"?null:t.data;default:return null}}var Ig={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function eu(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!Ig[e.type]:t==="textarea"}function tu(e,t,r,s){Ca?ba?ba.push(s):ba=[s]:Ca=s,t=Ys(t,"onChange"),0<t.length&&(r=new rs("onChange","change",null,r,s),e.push({event:r,listeners:t}))}var Jr=null,el=null;function Ug(e){Ip(e,0)}function ss(e){var t=rt(e);if(_a(t))return e}function nu(e,t){if(e==="change")return t}var au=!1;if(Xn){var Ec;if(Xn){var jc="oninput"in document;if(!jc){var ou=document.createElement("div");ou.setAttribute("oninput","return;"),jc=typeof ou.oninput=="function"}Ec=jc}else Ec=!1;au=Ec&&(!document.documentMode||9<document.documentMode)}function ru(){Jr&&(Jr.detachEvent("onpropertychange",lu),el=Jr=null)}function lu(e){if(e.propertyName==="value"&&ss(el)){var t=[];tu(t,el,e,nr(e)),ko(Ug,t)}}function Pg(e,t,r){e==="focusin"?(ru(),Jr=t,el=r,Jr.attachEvent("onpropertychange",lu)):e==="focusout"&&ru()}function Lg(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return ss(el)}function Og(e,t){if(e==="click")return ss(t)}function Mg(e,t){if(e==="input"||e==="change")return ss(t)}function Hg(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var wn=typeof Object.is=="function"?Object.is:Hg;function tl(e,t){if(wn(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var r=Object.keys(e),s=Object.keys(t);if(r.length!==s.length)return!1;for(s=0;s<r.length;s++){var p=r[s];if(!ke.call(t,p)||!wn(e[p],t[p]))return!1}return!0}function su(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function cu(e,t){var r=su(e);e=0;for(var s;r;){if(r.nodeType===3){if(s=e+r.textContent.length,e<=t&&s>=t)return{node:r,offset:t-e};e=s}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=su(r)}}function iu(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?iu(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function du(e){e=e!=null&&e.ownerDocument!=null&&e.ownerDocument.defaultView!=null?e.ownerDocument.defaultView:window;for(var t=Eo(e.document);t instanceof e.HTMLIFrameElement;){try{var r=typeof t.contentWindow.location.href=="string"}catch{r=!1}if(r)e=t.contentWindow;else break;t=Eo(e.document)}return t}function kc(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}var zg=Xn&&"documentMode"in document&&11>=document.documentMode,lr=null,Nc=null,nl=null,Rc=!1;function uu(e,t,r){var s=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;Rc||lr==null||lr!==Eo(s)||(s=lr,"selectionStart"in s&&kc(s)?s={start:s.selectionStart,end:s.selectionEnd}:(s=(s.ownerDocument&&s.ownerDocument.defaultView||window).getSelection(),s={anchorNode:s.anchorNode,anchorOffset:s.anchorOffset,focusNode:s.focusNode,focusOffset:s.focusOffset}),nl&&tl(nl,s)||(nl=s,s=Ys(Nc,"onSelect"),0<s.length&&(t=new rs("onSelect","select",null,t,r),e.push({event:t,listeners:s}),t.target=lr)))}function Ro(e,t){var r={};return r[e.toLowerCase()]=t.toLowerCase(),r["Webkit"+e]="webkit"+t,r["Moz"+e]="moz"+t,r}var sr={animationend:Ro("Animation","AnimationEnd"),animationiteration:Ro("Animation","AnimationIteration"),animationstart:Ro("Animation","AnimationStart"),transitionrun:Ro("Transition","TransitionRun"),transitionstart:Ro("Transition","TransitionStart"),transitioncancel:Ro("Transition","TransitionCancel"),transitionend:Ro("Transition","TransitionEnd")},Ac={},fu={};Xn&&(fu=document.createElement("div").style,"AnimationEvent"in window||(delete sr.animationend.animation,delete sr.animationiteration.animation,delete sr.animationstart.animation),"TransitionEvent"in window||delete sr.transitionend.transition);function Ao(e){if(Ac[e])return Ac[e];if(!sr[e])return e;var t=sr[e],r;for(r in t)if(t.hasOwnProperty(r)&&r in fu)return Ac[e]=t[r];return e}var pu=Ao("animationend"),hu=Ao("animationiteration"),mu=Ao("animationstart"),Vg=Ao("transitionrun"),Bg=Ao("transitionstart"),Yg=Ao("transitioncancel"),yu=Ao("transitionend"),gu=new Map,Tc="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Tc.push("scrollEnd");function Zn(e,t){gu.set(e,t),We(t,[e])}var vu=new WeakMap;function qn(e,t){if(typeof e=="object"&&e!==null){var r=vu.get(e);return r!==void 0?r:(t={value:e,source:t,stack:So(t)},vu.set(e,t),t)}return{value:e,source:t,stack:So(t)}}var $n=[],cr=0,Dc=0;function cs(){for(var e=cr,t=Dc=cr=0;t<e;){var r=$n[t];$n[t++]=null;var s=$n[t];$n[t++]=null;var p=$n[t];$n[t++]=null;var g=$n[t];if($n[t++]=null,s!==null&&p!==null){var D=s.pending;D===null?p.next=p:(p.next=D.next,D.next=p),s.pending=p}g!==0&&_u(r,p,g)}}function is(e,t,r,s){$n[cr++]=e,$n[cr++]=t,$n[cr++]=r,$n[cr++]=s,Dc|=s,e.lanes|=s,e=e.alternate,e!==null&&(e.lanes|=s)}function Fc(e,t,r,s){return is(e,t,r,s),ds(e)}function ir(e,t){return is(e,null,null,t),ds(e)}function _u(e,t,r){e.lanes|=r;var s=e.alternate;s!==null&&(s.lanes|=r);for(var p=!1,g=e.return;g!==null;)g.childLanes|=r,s=g.alternate,s!==null&&(s.childLanes|=r),g.tag===22&&(e=g.stateNode,e===null||e._visibility&1||(p=!0)),e=g,g=g.return;return e.tag===3?(g=e.stateNode,p&&t!==null&&(p=31-wt(r),e=g.hiddenUpdates,s=e[p],s===null?e[p]=[t]:s.push(t),t.lane=r|536870912),g):null}function ds(e){if(50<kl)throw kl=0,Li=null,Error(c(185));for(var t=e.return;t!==null;)e=t,t=e.return;return e.tag===3?e.stateNode:null}var dr={};function Gg(e,t,r,s){this.tag=e,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=s,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Cn(e,t,r,s){return new Gg(e,t,r,s)}function qc(e){return e=e.prototype,!(!e||!e.isReactComponent)}function Ea(e,t){var r=e.alternate;return r===null?(r=Cn(e.tag,t,e.key,e.mode),r.elementType=e.elementType,r.type=e.type,r.stateNode=e.stateNode,r.alternate=e,e.alternate=r):(r.pendingProps=t,r.type=e.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=e.flags&65011712,r.childLanes=e.childLanes,r.lanes=e.lanes,r.child=e.child,r.memoizedProps=e.memoizedProps,r.memoizedState=e.memoizedState,r.updateQueue=e.updateQueue,t=e.dependencies,r.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},r.sibling=e.sibling,r.index=e.index,r.ref=e.ref,r.refCleanup=e.refCleanup,r}function xu(e,t){e.flags&=65011714;var r=e.alternate;return r===null?(e.childLanes=0,e.lanes=t,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=r.childLanes,e.lanes=r.lanes,e.child=r.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=r.memoizedProps,e.memoizedState=r.memoizedState,e.updateQueue=r.updateQueue,e.type=r.type,t=r.dependencies,e.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),e}function us(e,t,r,s,p,g){var D=0;if(s=e,typeof e=="function")qc(e)&&(D=1);else if(typeof e=="string")D=Qv(e,r,H.current)?26:e==="html"||e==="head"||e==="body"?27:5;else e:switch(e){case X:return e=Cn(31,r,t,p),e.elementType=X,e.lanes=g,e;case b:return To(r.children,p,g,t);case N:D=8,p|=24;break;case S:return e=Cn(12,r,t,p|2),e.elementType=S,e.lanes=g,e;case F:return e=Cn(13,r,t,p),e.elementType=F,e.lanes=g,e;case L:return e=Cn(19,r,t,p),e.elementType=L,e.lanes=g,e;default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case k:case j:D=10;break e;case C:D=9;break e;case R:D=11;break e;case U:D=14;break e;case Q:D=16,s=null;break e}D=29,r=Error(c(130,e===null?"null":typeof e,"")),s=null}return t=Cn(D,r,t,p),t.elementType=e,t.type=s,t.lanes=g,t}function To(e,t,r,s){return e=Cn(7,e,s,t),e.lanes=r,e}function $c(e,t,r){return e=Cn(6,e,null,t),e.lanes=r,e}function Ic(e,t,r){return t=Cn(4,e.children!==null?e.children:[],e.key,t),t.lanes=r,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}var ur=[],fr=0,fs=null,ps=0,In=[],Un=0,Do=null,ja=1,ka="";function Fo(e,t){ur[fr++]=ps,ur[fr++]=fs,fs=e,ps=t}function wu(e,t,r){In[Un++]=ja,In[Un++]=ka,In[Un++]=Do,Do=e;var s=ja;e=ka;var p=32-wt(s)-1;s&=~(1<<p),r+=1;var g=32-wt(t)+p;if(30<g){var D=p-p%5;g=(s&(1<<D)-1).toString(32),s>>=D,p-=D,ja=1<<32-wt(t)+p|r<<p|s,ka=g+e}else ja=1<<g|r<<p|s,ka=e}function Uc(e){e.return!==null&&(Fo(e,1),wu(e,1,0))}function Pc(e){for(;e===fs;)fs=ur[--fr],ur[fr]=null,ps=ur[--fr],ur[fr]=null;for(;e===Do;)Do=In[--Un],In[Un]=null,ka=In[--Un],In[Un]=null,ja=In[--Un],In[Un]=null}var dn=null,Tt=null,it=!1,qo=null,da=!1,Lc=Error(c(519));function $o(e){var t=Error(c(418,""));throw rl(qn(t,e)),Lc}function Cu(e){var t=e.stateNode,r=e.type,s=e.memoizedProps;switch(t[St]=e,t[At]=s,r){case"dialog":tt("cancel",t),tt("close",t);break;case"iframe":case"object":case"embed":tt("load",t);break;case"video":case"audio":for(r=0;r<Rl.length;r++)tt(Rl[r],t);break;case"source":tt("error",t);break;case"img":case"image":case"link":tt("error",t),tt("load",t);break;case"details":tt("toggle",t);break;case"input":tt("invalid",t),Vr(t,s.value,s.defaultValue,s.checked,s.defaultChecked,s.type,s.name,!0),za(t);break;case"select":tt("invalid",t);break;case"textarea":tt("invalid",t),Yr(t,s.value,s.defaultValue,s.children),za(t)}r=s.children,typeof r!="string"&&typeof r!="number"&&typeof r!="bigint"||t.textContent===""+r||s.suppressHydrationWarning===!0||Op(t.textContent,r)?(s.popover!=null&&(tt("beforetoggle",t),tt("toggle",t)),s.onScroll!=null&&tt("scroll",t),s.onScrollEnd!=null&&tt("scrollend",t),s.onClick!=null&&(t.onclick=Gs),t=!0):t=!1,t||$o(e)}function bu(e){for(dn=e.return;dn;)switch(dn.tag){case 5:case 13:da=!1;return;case 27:case 3:da=!0;return;default:dn=dn.return}}function al(e){if(e!==dn)return!1;if(!it)return bu(e),it=!0,!1;var t=e.tag,r;if((r=t!==3&&t!==27)&&((r=t===5)&&(r=e.type,r=!(r!=="form"&&r!=="button")||td(e.type,e.memoizedProps)),r=!r),r&&Tt&&$o(e),bu(e),t===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(c(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8)if(r=e.data,r==="/$"){if(t===0){Tt=Jn(e.nextSibling);break e}t--}else r!=="$"&&r!=="$!"&&r!=="$?"||t++;e=e.nextSibling}Tt=null}}else t===27?(t=Tt,so(e.type)?(e=rd,rd=null,Tt=e):Tt=t):Tt=dn?Jn(e.stateNode.nextSibling):null;return!0}function ol(){Tt=dn=null,it=!1}function Su(){var e=qo;return e!==null&&(gn===null?gn=e:gn.push.apply(gn,e),qo=null),e}function rl(e){qo===null?qo=[e]:qo.push(e)}var Oc=Z(null),Io=null,Na=null;function Ya(e,t,r){G(Oc,t._currentValue),t._currentValue=r}function Ra(e){e._currentValue=Oc.current,W(Oc)}function Mc(e,t,r){for(;e!==null;){var s=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,s!==null&&(s.childLanes|=t)):s!==null&&(s.childLanes&t)!==t&&(s.childLanes|=t),e===r)break;e=e.return}}function Hc(e,t,r,s){var p=e.child;for(p!==null&&(p.return=e);p!==null;){var g=p.dependencies;if(g!==null){var D=p.child;g=g.firstContext;e:for(;g!==null;){var M=g;g=p;for(var te=0;te<t.length;te++)if(M.context===t[te]){g.lanes|=r,M=g.alternate,M!==null&&(M.lanes|=r),Mc(g.return,r,e),s||(D=null);break e}g=M.next}}else if(p.tag===18){if(D=p.return,D===null)throw Error(c(341));D.lanes|=r,g=D.alternate,g!==null&&(g.lanes|=r),Mc(D,r,e),D=null}else D=p.child;if(D!==null)D.return=p;else for(D=p;D!==null;){if(D===e){D=null;break}if(p=D.sibling,p!==null){p.return=D.return,D=p;break}D=D.return}p=D}}function ll(e,t,r,s){e=null;for(var p=t,g=!1;p!==null;){if(!g){if((p.flags&524288)!==0)g=!0;else if((p.flags&262144)!==0)break}if(p.tag===10){var D=p.alternate;if(D===null)throw Error(c(387));if(D=D.memoizedProps,D!==null){var M=p.type;wn(p.pendingProps.value,D.value)||(e!==null?e.push(M):e=[M])}}else if(p===de.current){if(D=p.alternate,D===null)throw Error(c(387));D.memoizedState.memoizedState!==p.memoizedState.memoizedState&&(e!==null?e.push($l):e=[$l])}p=p.return}e!==null&&Hc(t,e,r,s),t.flags|=262144}function hs(e){for(e=e.firstContext;e!==null;){if(!wn(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function Uo(e){Io=e,Na=null,e=e.dependencies,e!==null&&(e.firstContext=null)}function an(e){return Eu(Io,e)}function ms(e,t){return Io===null&&Uo(e),Eu(e,t)}function Eu(e,t){var r=t._currentValue;if(t={context:t,memoizedValue:r,next:null},Na===null){if(e===null)throw Error(c(308));Na=t,e.dependencies={lanes:0,firstContext:t},e.flags|=524288}else Na=Na.next=t;return r}var Wg=typeof AbortController<"u"?AbortController:function(){var e=[],t=this.signal={aborted:!1,addEventListener:function(r,s){e.push(s)}};this.abort=function(){t.aborted=!0,e.forEach(function(r){return r()})}},Qg=a.unstable_scheduleCallback,Xg=a.unstable_NormalPriority,zt={$$typeof:j,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function zc(){return{controller:new Wg,data:new Map,refCount:0}}function sl(e){e.refCount--,e.refCount===0&&Qg(Xg,function(){e.controller.abort()})}var cl=null,Vc=0,pr=0,hr=null;function Zg(e,t){if(cl===null){var r=cl=[];Vc=0,pr=Yi(),hr={status:"pending",value:void 0,then:function(s){r.push(s)}}}return Vc++,t.then(ju,ju),t}function ju(){if(--Vc===0&&cl!==null){hr!==null&&(hr.status="fulfilled");var e=cl;cl=null,pr=0,hr=null;for(var t=0;t<e.length;t++)(0,e[t])()}}function Kg(e,t){var r=[],s={status:"pending",value:null,reason:null,then:function(p){r.push(p)}};return e.then(function(){s.status="fulfilled",s.value=t;for(var p=0;p<r.length;p++)(0,r[p])(t)},function(p){for(s.status="rejected",s.reason=p,p=0;p<r.length;p++)(0,r[p])(void 0)}),s}var ku=T.S;T.S=function(e,t){typeof t=="object"&&t!==null&&typeof t.then=="function"&&Zg(e,t),ku!==null&&ku(e,t)};var Po=Z(null);function Bc(){var e=Po.current;return e!==null?e:gt.pooledCache}function ys(e,t){t===null?G(Po,Po.current):G(Po,t.pool)}function Nu(){var e=Bc();return e===null?null:{parent:zt._currentValue,pool:e}}var il=Error(c(460)),Ru=Error(c(474)),gs=Error(c(542)),Yc={then:function(){}};function Au(e){return e=e.status,e==="fulfilled"||e==="rejected"}function vs(){}function Tu(e,t,r){switch(r=e[r],r===void 0?e.push(t):r!==t&&(t.then(vs,vs),t=r),t.status){case"fulfilled":return t.value;case"rejected":throw e=t.reason,Fu(e),e;default:if(typeof t.status=="string")t.then(vs,vs);else{if(e=gt,e!==null&&100<e.shellSuspendCounter)throw Error(c(482));e=t,e.status="pending",e.then(function(s){if(t.status==="pending"){var p=t;p.status="fulfilled",p.value=s}},function(s){if(t.status==="pending"){var p=t;p.status="rejected",p.reason=s}})}switch(t.status){case"fulfilled":return t.value;case"rejected":throw e=t.reason,Fu(e),e}throw dl=t,il}}var dl=null;function Du(){if(dl===null)throw Error(c(459));var e=dl;return dl=null,e}function Fu(e){if(e===il||e===gs)throw Error(c(483))}var Ga=!1;function Gc(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Wc(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function Wa(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function Qa(e,t,r){var s=e.updateQueue;if(s===null)return null;if(s=s.shared,(dt&2)!==0){var p=s.pending;return p===null?t.next=t:(t.next=p.next,p.next=t),s.pending=t,t=ds(e),_u(e,null,r),t}return is(e,s,t,r),ds(e)}function ul(e,t,r){if(t=t.updateQueue,t!==null&&(t=t.shared,(r&4194048)!==0)){var s=t.lanes;s&=e.pendingLanes,r|=s,t.lanes=r,ra(e,r)}}function Qc(e,t){var r=e.updateQueue,s=e.alternate;if(s!==null&&(s=s.updateQueue,r===s)){var p=null,g=null;if(r=r.firstBaseUpdate,r!==null){do{var D={lane:r.lane,tag:r.tag,payload:r.payload,callback:null,next:null};g===null?p=g=D:g=g.next=D,r=r.next}while(r!==null);g===null?p=g=t:g=g.next=t}else p=g=t;r={baseState:s.baseState,firstBaseUpdate:p,lastBaseUpdate:g,shared:s.shared,callbacks:s.callbacks},e.updateQueue=r;return}e=r.lastBaseUpdate,e===null?r.firstBaseUpdate=t:e.next=t,r.lastBaseUpdate=t}var Xc=!1;function fl(){if(Xc){var e=hr;if(e!==null)throw e}}function pl(e,t,r,s){Xc=!1;var p=e.updateQueue;Ga=!1;var g=p.firstBaseUpdate,D=p.lastBaseUpdate,M=p.shared.pending;if(M!==null){p.shared.pending=null;var te=M,se=te.next;te.next=null,D===null?g=se:D.next=se,D=te;var he=e.alternate;he!==null&&(he=he.updateQueue,M=he.lastBaseUpdate,M!==D&&(M===null?he.firstBaseUpdate=se:M.next=se,he.lastBaseUpdate=te))}if(g!==null){var ve=p.baseState;D=0,he=se=te=null,M=g;do{var ce=M.lane&-536870913,ie=ce!==M.lane;if(ie?(lt&ce)===ce:(s&ce)===ce){ce!==0&&ce===pr&&(Xc=!0),he!==null&&(he=he.next={lane:0,tag:M.tag,payload:M.payload,callback:null,next:null});e:{var Oe=e,Ue=M;ce=t;var ht=r;switch(Ue.tag){case 1:if(Oe=Ue.payload,typeof Oe=="function"){ve=Oe.call(ht,ve,ce);break e}ve=Oe;break e;case 3:Oe.flags=Oe.flags&-65537|128;case 0:if(Oe=Ue.payload,ce=typeof Oe=="function"?Oe.call(ht,ve,ce):Oe,ce==null)break e;ve=y({},ve,ce);break e;case 2:Ga=!0}}ce=M.callback,ce!==null&&(e.flags|=64,ie&&(e.flags|=8192),ie=p.callbacks,ie===null?p.callbacks=[ce]:ie.push(ce))}else ie={lane:ce,tag:M.tag,payload:M.payload,callback:M.callback,next:null},he===null?(se=he=ie,te=ve):he=he.next=ie,D|=ce;if(M=M.next,M===null){if(M=p.shared.pending,M===null)break;ie=M,M=ie.next,ie.next=null,p.lastBaseUpdate=ie,p.shared.pending=null}}while(!0);he===null&&(te=ve),p.baseState=te,p.firstBaseUpdate=se,p.lastBaseUpdate=he,g===null&&(p.shared.lanes=0),ao|=D,e.lanes=D,e.memoizedState=ve}}function qu(e,t){if(typeof e!="function")throw Error(c(191,e));e.call(t)}function $u(e,t){var r=e.callbacks;if(r!==null)for(e.callbacks=null,e=0;e<r.length;e++)qu(r[e],t)}var mr=Z(null),_s=Z(0);function Iu(e,t){e=Ia,G(_s,e),G(mr,t),Ia=e|t.baseLanes}function Zc(){G(_s,Ia),G(mr,mr.current)}function Kc(){Ia=_s.current,W(mr),W(_s)}var Xa=0,Qe=null,ft=null,Lt=null,xs=!1,yr=!1,Lo=!1,ws=0,hl=0,gr=null,Jg=0;function $t(){throw Error(c(321))}function Jc(e,t){if(t===null)return!1;for(var r=0;r<t.length&&r<e.length;r++)if(!wn(e[r],t[r]))return!1;return!0}function ei(e,t,r,s,p,g){return Xa=g,Qe=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,T.H=e===null||e.memoizedState===null?xf:wf,Lo=!1,g=r(s,p),Lo=!1,yr&&(g=Pu(t,r,s,p)),Uu(e),g}function Uu(e){T.H=ks;var t=ft!==null&&ft.next!==null;if(Xa=0,Lt=ft=Qe=null,xs=!1,hl=0,gr=null,t)throw Error(c(300));e===null||Yt||(e=e.dependencies,e!==null&&hs(e)&&(Yt=!0))}function Pu(e,t,r,s){Qe=e;var p=0;do{if(yr&&(gr=null),hl=0,yr=!1,25<=p)throw Error(c(301));if(p+=1,Lt=ft=null,e.updateQueue!=null){var g=e.updateQueue;g.lastEffect=null,g.events=null,g.stores=null,g.memoCache!=null&&(g.memoCache.index=0)}T.H=lv,g=t(r,s)}while(yr);return g}function ev(){var e=T.H,t=e.useState()[0];return t=typeof t.then=="function"?ml(t):t,e=e.useState()[0],(ft!==null?ft.memoizedState:null)!==e&&(Qe.flags|=1024),t}function ti(){var e=ws!==0;return ws=0,e}function ni(e,t,r){t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r}function ai(e){if(xs){for(e=e.memoizedState;e!==null;){var t=e.queue;t!==null&&(t.pending=null),e=e.next}xs=!1}Xa=0,Lt=ft=Qe=null,yr=!1,hl=ws=0,gr=null}function mn(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Lt===null?Qe.memoizedState=Lt=e:Lt=Lt.next=e,Lt}function Ot(){if(ft===null){var e=Qe.alternate;e=e!==null?e.memoizedState:null}else e=ft.next;var t=Lt===null?Qe.memoizedState:Lt.next;if(t!==null)Lt=t,ft=e;else{if(e===null)throw Qe.alternate===null?Error(c(467)):Error(c(310));ft=e,e={memoizedState:ft.memoizedState,baseState:ft.baseState,baseQueue:ft.baseQueue,queue:ft.queue,next:null},Lt===null?Qe.memoizedState=Lt=e:Lt=Lt.next=e}return Lt}function oi(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function ml(e){var t=hl;return hl+=1,gr===null&&(gr=[]),e=Tu(gr,e,t),t=Qe,(Lt===null?t.memoizedState:Lt.next)===null&&(t=t.alternate,T.H=t===null||t.memoizedState===null?xf:wf),e}function Cs(e){if(e!==null&&typeof e=="object"){if(typeof e.then=="function")return ml(e);if(e.$$typeof===j)return an(e)}throw Error(c(438,String(e)))}function ri(e){var t=null,r=Qe.updateQueue;if(r!==null&&(t=r.memoCache),t==null){var s=Qe.alternate;s!==null&&(s=s.updateQueue,s!==null&&(s=s.memoCache,s!=null&&(t={data:s.data.map(function(p){return p.slice()}),index:0})))}if(t==null&&(t={data:[],index:0}),r===null&&(r=oi(),Qe.updateQueue=r),r.memoCache=t,r=t.data[t.index],r===void 0)for(r=t.data[t.index]=Array(e),s=0;s<e;s++)r[s]=V;return t.index++,r}function Aa(e,t){return typeof t=="function"?t(e):t}function bs(e){var t=Ot();return li(t,ft,e)}function li(e,t,r){var s=e.queue;if(s===null)throw Error(c(311));s.lastRenderedReducer=r;var p=e.baseQueue,g=s.pending;if(g!==null){if(p!==null){var D=p.next;p.next=g.next,g.next=D}t.baseQueue=p=g,s.pending=null}if(g=e.baseState,p===null)e.memoizedState=g;else{t=p.next;var M=D=null,te=null,se=t,he=!1;do{var ve=se.lane&-536870913;if(ve!==se.lane?(lt&ve)===ve:(Xa&ve)===ve){var ce=se.revertLane;if(ce===0)te!==null&&(te=te.next={lane:0,revertLane:0,action:se.action,hasEagerState:se.hasEagerState,eagerState:se.eagerState,next:null}),ve===pr&&(he=!0);else if((Xa&ce)===ce){se=se.next,ce===pr&&(he=!0);continue}else ve={lane:0,revertLane:se.revertLane,action:se.action,hasEagerState:se.hasEagerState,eagerState:se.eagerState,next:null},te===null?(M=te=ve,D=g):te=te.next=ve,Qe.lanes|=ce,ao|=ce;ve=se.action,Lo&&r(g,ve),g=se.hasEagerState?se.eagerState:r(g,ve)}else ce={lane:ve,revertLane:se.revertLane,action:se.action,hasEagerState:se.hasEagerState,eagerState:se.eagerState,next:null},te===null?(M=te=ce,D=g):te=te.next=ce,Qe.lanes|=ve,ao|=ve;se=se.next}while(se!==null&&se!==t);if(te===null?D=g:te.next=M,!wn(g,e.memoizedState)&&(Yt=!0,he&&(r=hr,r!==null)))throw r;e.memoizedState=g,e.baseState=D,e.baseQueue=te,s.lastRenderedState=g}return p===null&&(s.lanes=0),[e.memoizedState,s.dispatch]}function si(e){var t=Ot(),r=t.queue;if(r===null)throw Error(c(311));r.lastRenderedReducer=e;var s=r.dispatch,p=r.pending,g=t.memoizedState;if(p!==null){r.pending=null;var D=p=p.next;do g=e(g,D.action),D=D.next;while(D!==p);wn(g,t.memoizedState)||(Yt=!0),t.memoizedState=g,t.baseQueue===null&&(t.baseState=g),r.lastRenderedState=g}return[g,s]}function Lu(e,t,r){var s=Qe,p=Ot(),g=it;if(g){if(r===void 0)throw Error(c(407));r=r()}else r=t();var D=!wn((ft||p).memoizedState,r);D&&(p.memoizedState=r,Yt=!0),p=p.queue;var M=Hu.bind(null,s,p,e);if(yl(2048,8,M,[e]),p.getSnapshot!==t||D||Lt!==null&&Lt.memoizedState.tag&1){if(s.flags|=2048,vr(9,Ss(),Mu.bind(null,s,p,r,t),null),gt===null)throw Error(c(349));g||(Xa&124)!==0||Ou(s,t,r)}return r}function Ou(e,t,r){e.flags|=16384,e={getSnapshot:t,value:r},t=Qe.updateQueue,t===null?(t=oi(),Qe.updateQueue=t,t.stores=[e]):(r=t.stores,r===null?t.stores=[e]:r.push(e))}function Mu(e,t,r,s){t.value=r,t.getSnapshot=s,zu(t)&&Vu(e)}function Hu(e,t,r){return r(function(){zu(t)&&Vu(e)})}function zu(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!wn(e,r)}catch{return!0}}function Vu(e){var t=ir(e,2);t!==null&&kn(t,e,2)}function ci(e){var t=mn();if(typeof e=="function"){var r=e;if(e=r(),Lo){Mt(!0);try{r()}finally{Mt(!1)}}}return t.memoizedState=t.baseState=e,t.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Aa,lastRenderedState:e},t}function Bu(e,t,r,s){return e.baseState=r,li(e,ft,typeof s=="function"?s:Aa)}function tv(e,t,r,s,p){if(js(e))throw Error(c(485));if(e=t.action,e!==null){var g={payload:p,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(D){g.listeners.push(D)}};T.T!==null?r(!0):g.isTransition=!1,s(g),r=t.pending,r===null?(g.next=t.pending=g,Yu(t,g)):(g.next=r.next,t.pending=r.next=g)}}function Yu(e,t){var r=t.action,s=t.payload,p=e.state;if(t.isTransition){var g=T.T,D={};T.T=D;try{var M=r(p,s),te=T.S;te!==null&&te(D,M),Gu(e,t,M)}catch(se){ii(e,t,se)}finally{T.T=g}}else try{g=r(p,s),Gu(e,t,g)}catch(se){ii(e,t,se)}}function Gu(e,t,r){r!==null&&typeof r=="object"&&typeof r.then=="function"?r.then(function(s){Wu(e,t,s)},function(s){return ii(e,t,s)}):Wu(e,t,r)}function Wu(e,t,r){t.status="fulfilled",t.value=r,Qu(t),e.state=r,t=e.pending,t!==null&&(r=t.next,r===t?e.pending=null:(r=r.next,t.next=r,Yu(e,r)))}function ii(e,t,r){var s=e.pending;if(e.pending=null,s!==null){s=s.next;do t.status="rejected",t.reason=r,Qu(t),t=t.next;while(t!==s)}e.action=null}function Qu(e){e=e.listeners;for(var t=0;t<e.length;t++)(0,e[t])()}function Xu(e,t){return t}function Zu(e,t){if(it){var r=gt.formState;if(r!==null){e:{var s=Qe;if(it){if(Tt){t:{for(var p=Tt,g=da;p.nodeType!==8;){if(!g){p=null;break t}if(p=Jn(p.nextSibling),p===null){p=null;break t}}g=p.data,p=g==="F!"||g==="F"?p:null}if(p){Tt=Jn(p.nextSibling),s=p.data==="F!";break e}}$o(s)}s=!1}s&&(t=r[0])}}return r=mn(),r.memoizedState=r.baseState=t,s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Xu,lastRenderedState:t},r.queue=s,r=gf.bind(null,Qe,s),s.dispatch=r,s=ci(!1),g=hi.bind(null,Qe,!1,s.queue),s=mn(),p={state:t,dispatch:null,action:e,pending:null},s.queue=p,r=tv.bind(null,Qe,p,g,r),p.dispatch=r,s.memoizedState=e,[t,r,!1]}function Ku(e){var t=Ot();return Ju(t,ft,e)}function Ju(e,t,r){if(t=li(e,t,Xu)[0],e=bs(Aa)[0],typeof t=="object"&&t!==null&&typeof t.then=="function")try{var s=ml(t)}catch(D){throw D===il?gs:D}else s=t;t=Ot();var p=t.queue,g=p.dispatch;return r!==t.memoizedState&&(Qe.flags|=2048,vr(9,Ss(),nv.bind(null,p,r),null)),[s,g,e]}function nv(e,t){e.action=t}function ef(e){var t=Ot(),r=ft;if(r!==null)return Ju(t,r,e);Ot(),t=t.memoizedState,r=Ot();var s=r.queue.dispatch;return r.memoizedState=e,[t,s,!1]}function vr(e,t,r,s){return e={tag:e,create:r,deps:s,inst:t,next:null},t=Qe.updateQueue,t===null&&(t=oi(),Qe.updateQueue=t),r=t.lastEffect,r===null?t.lastEffect=e.next=e:(s=r.next,r.next=e,e.next=s,t.lastEffect=e),e}function Ss(){return{destroy:void 0,resource:void 0}}function tf(){return Ot().memoizedState}function Es(e,t,r,s){var p=mn();s=s===void 0?null:s,Qe.flags|=e,p.memoizedState=vr(1|t,Ss(),r,s)}function yl(e,t,r,s){var p=Ot();s=s===void 0?null:s;var g=p.memoizedState.inst;ft!==null&&s!==null&&Jc(s,ft.memoizedState.deps)?p.memoizedState=vr(t,g,r,s):(Qe.flags|=e,p.memoizedState=vr(1|t,g,r,s))}function nf(e,t){Es(8390656,8,e,t)}function af(e,t){yl(2048,8,e,t)}function of(e,t){return yl(4,2,e,t)}function rf(e,t){return yl(4,4,e,t)}function lf(e,t){if(typeof t=="function"){e=e();var r=t(e);return function(){typeof r=="function"?r():t(null)}}if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function sf(e,t,r){r=r!=null?r.concat([e]):null,yl(4,4,lf.bind(null,t,e),r)}function di(){}function cf(e,t){var r=Ot();t=t===void 0?null:t;var s=r.memoizedState;return t!==null&&Jc(t,s[1])?s[0]:(r.memoizedState=[e,t],e)}function df(e,t){var r=Ot();t=t===void 0?null:t;var s=r.memoizedState;if(t!==null&&Jc(t,s[1]))return s[0];if(s=e(),Lo){Mt(!0);try{e()}finally{Mt(!1)}}return r.memoizedState=[s,t],s}function ui(e,t,r){return r===void 0||(Xa&1073741824)!==0?e.memoizedState=t:(e.memoizedState=r,e=pp(),Qe.lanes|=e,ao|=e,r)}function uf(e,t,r,s){return wn(r,t)?r:mr.current!==null?(e=ui(e,r,s),wn(e,t)||(Yt=!0),e):(Xa&42)===0?(Yt=!0,e.memoizedState=r):(e=pp(),Qe.lanes|=e,ao|=e,t)}function ff(e,t,r,s,p){var g=q.p;q.p=g!==0&&8>g?g:8;var D=T.T,M={};T.T=M,hi(e,!1,t,r);try{var te=p(),se=T.S;if(se!==null&&se(M,te),te!==null&&typeof te=="object"&&typeof te.then=="function"){var he=Kg(te,s);gl(e,t,he,jn(e))}else gl(e,t,s,jn(e))}catch(ve){gl(e,t,{then:function(){},status:"rejected",reason:ve},jn())}finally{q.p=g,T.T=D}}function av(){}function fi(e,t,r,s){if(e.tag!==5)throw Error(c(476));var p=pf(e).queue;ff(e,p,t,Y,r===null?av:function(){return hf(e),r(s)})}function pf(e){var t=e.memoizedState;if(t!==null)return t;t={memoizedState:Y,baseState:Y,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Aa,lastRenderedState:Y},next:null};var r={};return t.next={memoizedState:r,baseState:r,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Aa,lastRenderedState:r},next:null},e.memoizedState=t,e=e.alternate,e!==null&&(e.memoizedState=t),t}function hf(e){var t=pf(e).next.queue;gl(e,t,{},jn())}function pi(){return an($l)}function mf(){return Ot().memoizedState}function yf(){return Ot().memoizedState}function ov(e){for(var t=e.return;t!==null;){switch(t.tag){case 24:case 3:var r=jn();e=Wa(r);var s=Qa(t,e,r);s!==null&&(kn(s,t,r),ul(s,t,r)),t={cache:zc()},e.payload=t;return}t=t.return}}function rv(e,t,r){var s=jn();r={lane:s,revertLane:0,action:r,hasEagerState:!1,eagerState:null,next:null},js(e)?vf(t,r):(r=Fc(e,t,r,s),r!==null&&(kn(r,e,s),_f(r,t,s)))}function gf(e,t,r){var s=jn();gl(e,t,r,s)}function gl(e,t,r,s){var p={lane:s,revertLane:0,action:r,hasEagerState:!1,eagerState:null,next:null};if(js(e))vf(t,p);else{var g=e.alternate;if(e.lanes===0&&(g===null||g.lanes===0)&&(g=t.lastRenderedReducer,g!==null))try{var D=t.lastRenderedState,M=g(D,r);if(p.hasEagerState=!0,p.eagerState=M,wn(M,D))return is(e,t,p,0),gt===null&&cs(),!1}catch{}finally{}if(r=Fc(e,t,p,s),r!==null)return kn(r,e,s),_f(r,t,s),!0}return!1}function hi(e,t,r,s){if(s={lane:2,revertLane:Yi(),action:s,hasEagerState:!1,eagerState:null,next:null},js(e)){if(t)throw Error(c(479))}else t=Fc(e,r,s,2),t!==null&&kn(t,e,2)}function js(e){var t=e.alternate;return e===Qe||t!==null&&t===Qe}function vf(e,t){yr=xs=!0;var r=e.pending;r===null?t.next=t:(t.next=r.next,r.next=t),e.pending=t}function _f(e,t,r){if((r&4194048)!==0){var s=t.lanes;s&=e.pendingLanes,r|=s,t.lanes=r,ra(e,r)}}var ks={readContext:an,use:Cs,useCallback:$t,useContext:$t,useEffect:$t,useImperativeHandle:$t,useLayoutEffect:$t,useInsertionEffect:$t,useMemo:$t,useReducer:$t,useRef:$t,useState:$t,useDebugValue:$t,useDeferredValue:$t,useTransition:$t,useSyncExternalStore:$t,useId:$t,useHostTransitionStatus:$t,useFormState:$t,useActionState:$t,useOptimistic:$t,useMemoCache:$t,useCacheRefresh:$t},xf={readContext:an,use:Cs,useCallback:function(e,t){return mn().memoizedState=[e,t===void 0?null:t],e},useContext:an,useEffect:nf,useImperativeHandle:function(e,t,r){r=r!=null?r.concat([e]):null,Es(4194308,4,lf.bind(null,t,e),r)},useLayoutEffect:function(e,t){return Es(4194308,4,e,t)},useInsertionEffect:function(e,t){Es(4,2,e,t)},useMemo:function(e,t){var r=mn();t=t===void 0?null:t;var s=e();if(Lo){Mt(!0);try{e()}finally{Mt(!1)}}return r.memoizedState=[s,t],s},useReducer:function(e,t,r){var s=mn();if(r!==void 0){var p=r(t);if(Lo){Mt(!0);try{r(t)}finally{Mt(!1)}}}else p=t;return s.memoizedState=s.baseState=p,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:p},s.queue=e,e=e.dispatch=rv.bind(null,Qe,e),[s.memoizedState,e]},useRef:function(e){var t=mn();return e={current:e},t.memoizedState=e},useState:function(e){e=ci(e);var t=e.queue,r=gf.bind(null,Qe,t);return t.dispatch=r,[e.memoizedState,r]},useDebugValue:di,useDeferredValue:function(e,t){var r=mn();return ui(r,e,t)},useTransition:function(){var e=ci(!1);return e=ff.bind(null,Qe,e.queue,!0,!1),mn().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,t,r){var s=Qe,p=mn();if(it){if(r===void 0)throw Error(c(407));r=r()}else{if(r=t(),gt===null)throw Error(c(349));(lt&124)!==0||Ou(s,t,r)}p.memoizedState=r;var g={value:r,getSnapshot:t};return p.queue=g,nf(Hu.bind(null,s,g,e),[e]),s.flags|=2048,vr(9,Ss(),Mu.bind(null,s,g,r,t),null),r},useId:function(){var e=mn(),t=gt.identifierPrefix;if(it){var r=ka,s=ja;r=(s&~(1<<32-wt(s)-1)).toString(32)+r,t=""+t+"R"+r,r=ws++,0<r&&(t+="H"+r.toString(32)),t+=""}else r=Jg++,t=""+t+"r"+r.toString(32)+"";return e.memoizedState=t},useHostTransitionStatus:pi,useFormState:Zu,useActionState:Zu,useOptimistic:function(e){var t=mn();t.memoizedState=t.baseState=e;var r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return t.queue=r,t=hi.bind(null,Qe,!0,r),r.dispatch=t,[e,t]},useMemoCache:ri,useCacheRefresh:function(){return mn().memoizedState=ov.bind(null,Qe)}},wf={readContext:an,use:Cs,useCallback:cf,useContext:an,useEffect:af,useImperativeHandle:sf,useInsertionEffect:of,useLayoutEffect:rf,useMemo:df,useReducer:bs,useRef:tf,useState:function(){return bs(Aa)},useDebugValue:di,useDeferredValue:function(e,t){var r=Ot();return uf(r,ft.memoizedState,e,t)},useTransition:function(){var e=bs(Aa)[0],t=Ot().memoizedState;return[typeof e=="boolean"?e:ml(e),t]},useSyncExternalStore:Lu,useId:mf,useHostTransitionStatus:pi,useFormState:Ku,useActionState:Ku,useOptimistic:function(e,t){var r=Ot();return Bu(r,ft,e,t)},useMemoCache:ri,useCacheRefresh:yf},lv={readContext:an,use:Cs,useCallback:cf,useContext:an,useEffect:af,useImperativeHandle:sf,useInsertionEffect:of,useLayoutEffect:rf,useMemo:df,useReducer:si,useRef:tf,useState:function(){return si(Aa)},useDebugValue:di,useDeferredValue:function(e,t){var r=Ot();return ft===null?ui(r,e,t):uf(r,ft.memoizedState,e,t)},useTransition:function(){var e=si(Aa)[0],t=Ot().memoizedState;return[typeof e=="boolean"?e:ml(e),t]},useSyncExternalStore:Lu,useId:mf,useHostTransitionStatus:pi,useFormState:ef,useActionState:ef,useOptimistic:function(e,t){var r=Ot();return ft!==null?Bu(r,ft,e,t):(r.baseState=e,[e,r.queue.dispatch])},useMemoCache:ri,useCacheRefresh:yf},_r=null,vl=0;function Ns(e){var t=vl;return vl+=1,_r===null&&(_r=[]),Tu(_r,e,t)}function _l(e,t){t=t.props.ref,e.ref=t!==void 0?t:null}function Rs(e,t){throw t.$$typeof===v?Error(c(525)):(e=Object.prototype.toString.call(t),Error(c(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)))}function Cf(e){var t=e._init;return t(e._payload)}function bf(e){function t(oe,ne){if(e){var le=oe.deletions;le===null?(oe.deletions=[ne],oe.flags|=16):le.push(ne)}}function r(oe,ne){if(!e)return null;for(;ne!==null;)t(oe,ne),ne=ne.sibling;return null}function s(oe){for(var ne=new Map;oe!==null;)oe.key!==null?ne.set(oe.key,oe):ne.set(oe.index,oe),oe=oe.sibling;return ne}function p(oe,ne){return oe=Ea(oe,ne),oe.index=0,oe.sibling=null,oe}function g(oe,ne,le){return oe.index=le,e?(le=oe.alternate,le!==null?(le=le.index,le<ne?(oe.flags|=67108866,ne):le):(oe.flags|=67108866,ne)):(oe.flags|=1048576,ne)}function D(oe){return e&&oe.alternate===null&&(oe.flags|=67108866),oe}function M(oe,ne,le,ge){return ne===null||ne.tag!==6?(ne=$c(le,oe.mode,ge),ne.return=oe,ne):(ne=p(ne,le),ne.return=oe,ne)}function te(oe,ne,le,ge){var Ne=le.type;return Ne===b?he(oe,ne,le.props.children,ge,le.key):ne!==null&&(ne.elementType===Ne||typeof Ne=="object"&&Ne!==null&&Ne.$$typeof===Q&&Cf(Ne)===ne.type)?(ne=p(ne,le.props),_l(ne,le),ne.return=oe,ne):(ne=us(le.type,le.key,le.props,null,oe.mode,ge),_l(ne,le),ne.return=oe,ne)}function se(oe,ne,le,ge){return ne===null||ne.tag!==4||ne.stateNode.containerInfo!==le.containerInfo||ne.stateNode.implementation!==le.implementation?(ne=Ic(le,oe.mode,ge),ne.return=oe,ne):(ne=p(ne,le.children||[]),ne.return=oe,ne)}function he(oe,ne,le,ge,Ne){return ne===null||ne.tag!==7?(ne=To(le,oe.mode,ge,Ne),ne.return=oe,ne):(ne=p(ne,le),ne.return=oe,ne)}function ve(oe,ne,le){if(typeof ne=="string"&&ne!==""||typeof ne=="number"||typeof ne=="bigint")return ne=$c(""+ne,oe.mode,le),ne.return=oe,ne;if(typeof ne=="object"&&ne!==null){switch(ne.$$typeof){case _:return le=us(ne.type,ne.key,ne.props,null,oe.mode,le),_l(le,ne),le.return=oe,le;case w:return ne=Ic(ne,oe.mode,le),ne.return=oe,ne;case Q:var ge=ne._init;return ne=ge(ne._payload),ve(oe,ne,le)}if(I(ne)||E(ne))return ne=To(ne,oe.mode,le,null),ne.return=oe,ne;if(typeof ne.then=="function")return ve(oe,Ns(ne),le);if(ne.$$typeof===j)return ve(oe,ms(oe,ne),le);Rs(oe,ne)}return null}function ce(oe,ne,le,ge){var Ne=ne!==null?ne.key:null;if(typeof le=="string"&&le!==""||typeof le=="number"||typeof le=="bigint")return Ne!==null?null:M(oe,ne,""+le,ge);if(typeof le=="object"&&le!==null){switch(le.$$typeof){case _:return le.key===Ne?te(oe,ne,le,ge):null;case w:return le.key===Ne?se(oe,ne,le,ge):null;case Q:return Ne=le._init,le=Ne(le._payload),ce(oe,ne,le,ge)}if(I(le)||E(le))return Ne!==null?null:he(oe,ne,le,ge,null);if(typeof le.then=="function")return ce(oe,ne,Ns(le),ge);if(le.$$typeof===j)return ce(oe,ne,ms(oe,le),ge);Rs(oe,le)}return null}function ie(oe,ne,le,ge,Ne){if(typeof ge=="string"&&ge!==""||typeof ge=="number"||typeof ge=="bigint")return oe=oe.get(le)||null,M(ne,oe,""+ge,Ne);if(typeof ge=="object"&&ge!==null){switch(ge.$$typeof){case _:return oe=oe.get(ge.key===null?le:ge.key)||null,te(ne,oe,ge,Ne);case w:return oe=oe.get(ge.key===null?le:ge.key)||null,se(ne,oe,ge,Ne);case Q:var Ze=ge._init;return ge=Ze(ge._payload),ie(oe,ne,le,ge,Ne)}if(I(ge)||E(ge))return oe=oe.get(le)||null,he(ne,oe,ge,Ne,null);if(typeof ge.then=="function")return ie(oe,ne,le,Ns(ge),Ne);if(ge.$$typeof===j)return ie(oe,ne,le,ms(ne,ge),Ne);Rs(ne,ge)}return null}function Oe(oe,ne,le,ge){for(var Ne=null,Ze=null,Ae=ne,Pe=ne=0,Wt=null;Ae!==null&&Pe<le.length;Pe++){Ae.index>Pe?(Wt=Ae,Ae=null):Wt=Ae.sibling;var st=ce(oe,Ae,le[Pe],ge);if(st===null){Ae===null&&(Ae=Wt);break}e&&Ae&&st.alternate===null&&t(oe,Ae),ne=g(st,ne,Pe),Ze===null?Ne=st:Ze.sibling=st,Ze=st,Ae=Wt}if(Pe===le.length)return r(oe,Ae),it&&Fo(oe,Pe),Ne;if(Ae===null){for(;Pe<le.length;Pe++)Ae=ve(oe,le[Pe],ge),Ae!==null&&(ne=g(Ae,ne,Pe),Ze===null?Ne=Ae:Ze.sibling=Ae,Ze=Ae);return it&&Fo(oe,Pe),Ne}for(Ae=s(Ae);Pe<le.length;Pe++)Wt=ie(Ae,oe,Pe,le[Pe],ge),Wt!==null&&(e&&Wt.alternate!==null&&Ae.delete(Wt.key===null?Pe:Wt.key),ne=g(Wt,ne,Pe),Ze===null?Ne=Wt:Ze.sibling=Wt,Ze=Wt);return e&&Ae.forEach(function(po){return t(oe,po)}),it&&Fo(oe,Pe),Ne}function Ue(oe,ne,le,ge){if(le==null)throw Error(c(151));for(var Ne=null,Ze=null,Ae=ne,Pe=ne=0,Wt=null,st=le.next();Ae!==null&&!st.done;Pe++,st=le.next()){Ae.index>Pe?(Wt=Ae,Ae=null):Wt=Ae.sibling;var po=ce(oe,Ae,st.value,ge);if(po===null){Ae===null&&(Ae=Wt);break}e&&Ae&&po.alternate===null&&t(oe,Ae),ne=g(po,ne,Pe),Ze===null?Ne=po:Ze.sibling=po,Ze=po,Ae=Wt}if(st.done)return r(oe,Ae),it&&Fo(oe,Pe),Ne;if(Ae===null){for(;!st.done;Pe++,st=le.next())st=ve(oe,st.value,ge),st!==null&&(ne=g(st,ne,Pe),Ze===null?Ne=st:Ze.sibling=st,Ze=st);return it&&Fo(oe,Pe),Ne}for(Ae=s(Ae);!st.done;Pe++,st=le.next())st=ie(Ae,oe,Pe,st.value,ge),st!==null&&(e&&st.alternate!==null&&Ae.delete(st.key===null?Pe:st.key),ne=g(st,ne,Pe),Ze===null?Ne=st:Ze.sibling=st,Ze=st);return e&&Ae.forEach(function(s_){return t(oe,s_)}),it&&Fo(oe,Pe),Ne}function ht(oe,ne,le,ge){if(typeof le=="object"&&le!==null&&le.type===b&&le.key===null&&(le=le.props.children),typeof le=="object"&&le!==null){switch(le.$$typeof){case _:e:{for(var Ne=le.key;ne!==null;){if(ne.key===Ne){if(Ne=le.type,Ne===b){if(ne.tag===7){r(oe,ne.sibling),ge=p(ne,le.props.children),ge.return=oe,oe=ge;break e}}else if(ne.elementType===Ne||typeof Ne=="object"&&Ne!==null&&Ne.$$typeof===Q&&Cf(Ne)===ne.type){r(oe,ne.sibling),ge=p(ne,le.props),_l(ge,le),ge.return=oe,oe=ge;break e}r(oe,ne);break}else t(oe,ne);ne=ne.sibling}le.type===b?(ge=To(le.props.children,oe.mode,ge,le.key),ge.return=oe,oe=ge):(ge=us(le.type,le.key,le.props,null,oe.mode,ge),_l(ge,le),ge.return=oe,oe=ge)}return D(oe);case w:e:{for(Ne=le.key;ne!==null;){if(ne.key===Ne)if(ne.tag===4&&ne.stateNode.containerInfo===le.containerInfo&&ne.stateNode.implementation===le.implementation){r(oe,ne.sibling),ge=p(ne,le.children||[]),ge.return=oe,oe=ge;break e}else{r(oe,ne);break}else t(oe,ne);ne=ne.sibling}ge=Ic(le,oe.mode,ge),ge.return=oe,oe=ge}return D(oe);case Q:return Ne=le._init,le=Ne(le._payload),ht(oe,ne,le,ge)}if(I(le))return Oe(oe,ne,le,ge);if(E(le)){if(Ne=E(le),typeof Ne!="function")throw Error(c(150));return le=Ne.call(le),Ue(oe,ne,le,ge)}if(typeof le.then=="function")return ht(oe,ne,Ns(le),ge);if(le.$$typeof===j)return ht(oe,ne,ms(oe,le),ge);Rs(oe,le)}return typeof le=="string"&&le!==""||typeof le=="number"||typeof le=="bigint"?(le=""+le,ne!==null&&ne.tag===6?(r(oe,ne.sibling),ge=p(ne,le),ge.return=oe,oe=ge):(r(oe,ne),ge=$c(le,oe.mode,ge),ge.return=oe,oe=ge),D(oe)):r(oe,ne)}return function(oe,ne,le,ge){try{vl=0;var Ne=ht(oe,ne,le,ge);return _r=null,Ne}catch(Ae){if(Ae===il||Ae===gs)throw Ae;var Ze=Cn(29,Ae,null,oe.mode);return Ze.lanes=ge,Ze.return=oe,Ze}finally{}}}var xr=bf(!0),Sf=bf(!1),Pn=Z(null),ua=null;function Za(e){var t=e.alternate;G(Vt,Vt.current&1),G(Pn,e),ua===null&&(t===null||mr.current!==null||t.memoizedState!==null)&&(ua=e)}function Ef(e){if(e.tag===22){if(G(Vt,Vt.current),G(Pn,e),ua===null){var t=e.alternate;t!==null&&t.memoizedState!==null&&(ua=e)}}else Ka()}function Ka(){G(Vt,Vt.current),G(Pn,Pn.current)}function Ta(e){W(Pn),ua===e&&(ua=null),W(Vt)}var Vt=Z(0);function As(e){for(var t=e;t!==null;){if(t.tag===13){var r=t.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||od(r)))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if((t.flags&128)!==0)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}function mi(e,t,r,s){t=e.memoizedState,r=r(s,t),r=r==null?t:y({},t,r),e.memoizedState=r,e.lanes===0&&(e.updateQueue.baseState=r)}var yi={enqueueSetState:function(e,t,r){e=e._reactInternals;var s=jn(),p=Wa(s);p.payload=t,r!=null&&(p.callback=r),t=Qa(e,p,s),t!==null&&(kn(t,e,s),ul(t,e,s))},enqueueReplaceState:function(e,t,r){e=e._reactInternals;var s=jn(),p=Wa(s);p.tag=1,p.payload=t,r!=null&&(p.callback=r),t=Qa(e,p,s),t!==null&&(kn(t,e,s),ul(t,e,s))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var r=jn(),s=Wa(r);s.tag=2,t!=null&&(s.callback=t),t=Qa(e,s,r),t!==null&&(kn(t,e,r),ul(t,e,r))}};function jf(e,t,r,s,p,g,D){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(s,g,D):t.prototype&&t.prototype.isPureReactComponent?!tl(r,s)||!tl(p,g):!0}function kf(e,t,r,s){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(r,s),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(r,s),t.state!==e&&yi.enqueueReplaceState(t,t.state,null)}function Oo(e,t){var r=t;if("ref"in t){r={};for(var s in t)s!=="ref"&&(r[s]=t[s])}if(e=e.defaultProps){r===t&&(r=y({},r));for(var p in e)r[p]===void 0&&(r[p]=e[p])}return r}var Ts=typeof reportError=="function"?reportError:function(e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof e=="object"&&e!==null&&typeof e.message=="string"?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",e);return}console.error(e)};function Nf(e){Ts(e)}function Rf(e){console.error(e)}function Af(e){Ts(e)}function Ds(e,t){try{var r=e.onUncaughtError;r(t.value,{componentStack:t.stack})}catch(s){setTimeout(function(){throw s})}}function Tf(e,t,r){try{var s=e.onCaughtError;s(r.value,{componentStack:r.stack,errorBoundary:t.tag===1?t.stateNode:null})}catch(p){setTimeout(function(){throw p})}}function gi(e,t,r){return r=Wa(r),r.tag=3,r.payload={element:null},r.callback=function(){Ds(e,t)},r}function Df(e){return e=Wa(e),e.tag=3,e}function Ff(e,t,r,s){var p=r.type.getDerivedStateFromError;if(typeof p=="function"){var g=s.value;e.payload=function(){return p(g)},e.callback=function(){Tf(t,r,s)}}var D=r.stateNode;D!==null&&typeof D.componentDidCatch=="function"&&(e.callback=function(){Tf(t,r,s),typeof p!="function"&&(oo===null?oo=new Set([this]):oo.add(this));var M=s.stack;this.componentDidCatch(s.value,{componentStack:M!==null?M:""})})}function sv(e,t,r,s,p){if(r.flags|=32768,s!==null&&typeof s=="object"&&typeof s.then=="function"){if(t=r.alternate,t!==null&&ll(t,r,p,!0),r=Pn.current,r!==null){switch(r.tag){case 13:return ua===null?Mi():r.alternate===null&&Dt===0&&(Dt=3),r.flags&=-257,r.flags|=65536,r.lanes=p,s===Yc?r.flags|=16384:(t=r.updateQueue,t===null?r.updateQueue=new Set([s]):t.add(s),zi(e,s,p)),!1;case 22:return r.flags|=65536,s===Yc?r.flags|=16384:(t=r.updateQueue,t===null?(t={transitions:null,markerInstances:null,retryQueue:new Set([s])},r.updateQueue=t):(r=t.retryQueue,r===null?t.retryQueue=new Set([s]):r.add(s)),zi(e,s,p)),!1}throw Error(c(435,r.tag))}return zi(e,s,p),Mi(),!1}if(it)return t=Pn.current,t!==null?((t.flags&65536)===0&&(t.flags|=256),t.flags|=65536,t.lanes=p,s!==Lc&&(e=Error(c(422),{cause:s}),rl(qn(e,r)))):(s!==Lc&&(t=Error(c(423),{cause:s}),rl(qn(t,r))),e=e.current.alternate,e.flags|=65536,p&=-p,e.lanes|=p,s=qn(s,r),p=gi(e.stateNode,s,p),Qc(e,p),Dt!==4&&(Dt=2)),!1;var g=Error(c(520),{cause:s});if(g=qn(g,r),jl===null?jl=[g]:jl.push(g),Dt!==4&&(Dt=2),t===null)return!0;s=qn(s,r),r=t;do{switch(r.tag){case 3:return r.flags|=65536,e=p&-p,r.lanes|=e,e=gi(r.stateNode,s,e),Qc(r,e),!1;case 1:if(t=r.type,g=r.stateNode,(r.flags&128)===0&&(typeof t.getDerivedStateFromError=="function"||g!==null&&typeof g.componentDidCatch=="function"&&(oo===null||!oo.has(g))))return r.flags|=65536,p&=-p,r.lanes|=p,p=Df(p),Ff(p,e,r,s),Qc(r,p),!1}r=r.return}while(r!==null);return!1}var qf=Error(c(461)),Yt=!1;function Zt(e,t,r,s){t.child=e===null?Sf(t,null,r,s):xr(t,e.child,r,s)}function $f(e,t,r,s,p){r=r.render;var g=t.ref;if("ref"in s){var D={};for(var M in s)M!=="ref"&&(D[M]=s[M])}else D=s;return Uo(t),s=ei(e,t,r,D,g,p),M=ti(),e!==null&&!Yt?(ni(e,t,p),Da(e,t,p)):(it&&M&&Uc(t),t.flags|=1,Zt(e,t,s,p),t.child)}function If(e,t,r,s,p){if(e===null){var g=r.type;return typeof g=="function"&&!qc(g)&&g.defaultProps===void 0&&r.compare===null?(t.tag=15,t.type=g,Uf(e,t,g,s,p)):(e=us(r.type,null,s,t,t.mode,p),e.ref=t.ref,e.return=t,t.child=e)}if(g=e.child,!Ei(e,p)){var D=g.memoizedProps;if(r=r.compare,r=r!==null?r:tl,r(D,s)&&e.ref===t.ref)return Da(e,t,p)}return t.flags|=1,e=Ea(g,s),e.ref=t.ref,e.return=t,t.child=e}function Uf(e,t,r,s,p){if(e!==null){var g=e.memoizedProps;if(tl(g,s)&&e.ref===t.ref)if(Yt=!1,t.pendingProps=s=g,Ei(e,p))(e.flags&131072)!==0&&(Yt=!0);else return t.lanes=e.lanes,Da(e,t,p)}return vi(e,t,r,s,p)}function Pf(e,t,r){var s=t.pendingProps,p=s.children,g=e!==null?e.memoizedState:null;if(s.mode==="hidden"){if((t.flags&128)!==0){if(s=g!==null?g.baseLanes|r:r,e!==null){for(p=t.child=e.child,g=0;p!==null;)g=g|p.lanes|p.childLanes,p=p.sibling;t.childLanes=g&~s}else t.childLanes=0,t.child=null;return Lf(e,t,s,r)}if((r&536870912)!==0)t.memoizedState={baseLanes:0,cachePool:null},e!==null&&ys(t,g!==null?g.cachePool:null),g!==null?Iu(t,g):Zc(),Ef(t);else return t.lanes=t.childLanes=536870912,Lf(e,t,g!==null?g.baseLanes|r:r,r)}else g!==null?(ys(t,g.cachePool),Iu(t,g),Ka(),t.memoizedState=null):(e!==null&&ys(t,null),Zc(),Ka());return Zt(e,t,p,r),t.child}function Lf(e,t,r,s){var p=Bc();return p=p===null?null:{parent:zt._currentValue,pool:p},t.memoizedState={baseLanes:r,cachePool:p},e!==null&&ys(t,null),Zc(),Ef(t),e!==null&&ll(e,t,s,!0),null}function Fs(e,t){var r=t.ref;if(r===null)e!==null&&e.ref!==null&&(t.flags|=4194816);else{if(typeof r!="function"&&typeof r!="object")throw Error(c(284));(e===null||e.ref!==r)&&(t.flags|=4194816)}}function vi(e,t,r,s,p){return Uo(t),r=ei(e,t,r,s,void 0,p),s=ti(),e!==null&&!Yt?(ni(e,t,p),Da(e,t,p)):(it&&s&&Uc(t),t.flags|=1,Zt(e,t,r,p),t.child)}function Of(e,t,r,s,p,g){return Uo(t),t.updateQueue=null,r=Pu(t,s,r,p),Uu(e),s=ti(),e!==null&&!Yt?(ni(e,t,g),Da(e,t,g)):(it&&s&&Uc(t),t.flags|=1,Zt(e,t,r,g),t.child)}function Mf(e,t,r,s,p){if(Uo(t),t.stateNode===null){var g=dr,D=r.contextType;typeof D=="object"&&D!==null&&(g=an(D)),g=new r(s,g),t.memoizedState=g.state!==null&&g.state!==void 0?g.state:null,g.updater=yi,t.stateNode=g,g._reactInternals=t,g=t.stateNode,g.props=s,g.state=t.memoizedState,g.refs={},Gc(t),D=r.contextType,g.context=typeof D=="object"&&D!==null?an(D):dr,g.state=t.memoizedState,D=r.getDerivedStateFromProps,typeof D=="function"&&(mi(t,r,D,s),g.state=t.memoizedState),typeof r.getDerivedStateFromProps=="function"||typeof g.getSnapshotBeforeUpdate=="function"||typeof g.UNSAFE_componentWillMount!="function"&&typeof g.componentWillMount!="function"||(D=g.state,typeof g.componentWillMount=="function"&&g.componentWillMount(),typeof g.UNSAFE_componentWillMount=="function"&&g.UNSAFE_componentWillMount(),D!==g.state&&yi.enqueueReplaceState(g,g.state,null),pl(t,s,g,p),fl(),g.state=t.memoizedState),typeof g.componentDidMount=="function"&&(t.flags|=4194308),s=!0}else if(e===null){g=t.stateNode;var M=t.memoizedProps,te=Oo(r,M);g.props=te;var se=g.context,he=r.contextType;D=dr,typeof he=="object"&&he!==null&&(D=an(he));var ve=r.getDerivedStateFromProps;he=typeof ve=="function"||typeof g.getSnapshotBeforeUpdate=="function",M=t.pendingProps!==M,he||typeof g.UNSAFE_componentWillReceiveProps!="function"&&typeof g.componentWillReceiveProps!="function"||(M||se!==D)&&kf(t,g,s,D),Ga=!1;var ce=t.memoizedState;g.state=ce,pl(t,s,g,p),fl(),se=t.memoizedState,M||ce!==se||Ga?(typeof ve=="function"&&(mi(t,r,ve,s),se=t.memoizedState),(te=Ga||jf(t,r,te,s,ce,se,D))?(he||typeof g.UNSAFE_componentWillMount!="function"&&typeof g.componentWillMount!="function"||(typeof g.componentWillMount=="function"&&g.componentWillMount(),typeof g.UNSAFE_componentWillMount=="function"&&g.UNSAFE_componentWillMount()),typeof g.componentDidMount=="function"&&(t.flags|=4194308)):(typeof g.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=s,t.memoizedState=se),g.props=s,g.state=se,g.context=D,s=te):(typeof g.componentDidMount=="function"&&(t.flags|=4194308),s=!1)}else{g=t.stateNode,Wc(e,t),D=t.memoizedProps,he=Oo(r,D),g.props=he,ve=t.pendingProps,ce=g.context,se=r.contextType,te=dr,typeof se=="object"&&se!==null&&(te=an(se)),M=r.getDerivedStateFromProps,(se=typeof M=="function"||typeof g.getSnapshotBeforeUpdate=="function")||typeof g.UNSAFE_componentWillReceiveProps!="function"&&typeof g.componentWillReceiveProps!="function"||(D!==ve||ce!==te)&&kf(t,g,s,te),Ga=!1,ce=t.memoizedState,g.state=ce,pl(t,s,g,p),fl();var ie=t.memoizedState;D!==ve||ce!==ie||Ga||e!==null&&e.dependencies!==null&&hs(e.dependencies)?(typeof M=="function"&&(mi(t,r,M,s),ie=t.memoizedState),(he=Ga||jf(t,r,he,s,ce,ie,te)||e!==null&&e.dependencies!==null&&hs(e.dependencies))?(se||typeof g.UNSAFE_componentWillUpdate!="function"&&typeof g.componentWillUpdate!="function"||(typeof g.componentWillUpdate=="function"&&g.componentWillUpdate(s,ie,te),typeof g.UNSAFE_componentWillUpdate=="function"&&g.UNSAFE_componentWillUpdate(s,ie,te)),typeof g.componentDidUpdate=="function"&&(t.flags|=4),typeof g.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof g.componentDidUpdate!="function"||D===e.memoizedProps&&ce===e.memoizedState||(t.flags|=4),typeof g.getSnapshotBeforeUpdate!="function"||D===e.memoizedProps&&ce===e.memoizedState||(t.flags|=1024),t.memoizedProps=s,t.memoizedState=ie),g.props=s,g.state=ie,g.context=te,s=he):(typeof g.componentDidUpdate!="function"||D===e.memoizedProps&&ce===e.memoizedState||(t.flags|=4),typeof g.getSnapshotBeforeUpdate!="function"||D===e.memoizedProps&&ce===e.memoizedState||(t.flags|=1024),s=!1)}return g=s,Fs(e,t),s=(t.flags&128)!==0,g||s?(g=t.stateNode,r=s&&typeof r.getDerivedStateFromError!="function"?null:g.render(),t.flags|=1,e!==null&&s?(t.child=xr(t,e.child,null,p),t.child=xr(t,null,r,p)):Zt(e,t,r,p),t.memoizedState=g.state,e=t.child):e=Da(e,t,p),e}function Hf(e,t,r,s){return ol(),t.flags|=256,Zt(e,t,r,s),t.child}var _i={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function xi(e){return{baseLanes:e,cachePool:Nu()}}function wi(e,t,r){return e=e!==null?e.childLanes&~r:0,t&&(e|=Ln),e}function zf(e,t,r){var s=t.pendingProps,p=!1,g=(t.flags&128)!==0,D;if((D=g)||(D=e!==null&&e.memoizedState===null?!1:(Vt.current&2)!==0),D&&(p=!0,t.flags&=-129),D=(t.flags&32)!==0,t.flags&=-33,e===null){if(it){if(p?Za(t):Ka(),it){var M=Tt,te;if(te=M){e:{for(te=M,M=da;te.nodeType!==8;){if(!M){M=null;break e}if(te=Jn(te.nextSibling),te===null){M=null;break e}}M=te}M!==null?(t.memoizedState={dehydrated:M,treeContext:Do!==null?{id:ja,overflow:ka}:null,retryLane:536870912,hydrationErrors:null},te=Cn(18,null,null,0),te.stateNode=M,te.return=t,t.child=te,dn=t,Tt=null,te=!0):te=!1}te||$o(t)}if(M=t.memoizedState,M!==null&&(M=M.dehydrated,M!==null))return od(M)?t.lanes=32:t.lanes=536870912,null;Ta(t)}return M=s.children,s=s.fallback,p?(Ka(),p=t.mode,M=qs({mode:"hidden",children:M},p),s=To(s,p,r,null),M.return=t,s.return=t,M.sibling=s,t.child=M,p=t.child,p.memoizedState=xi(r),p.childLanes=wi(e,D,r),t.memoizedState=_i,s):(Za(t),Ci(t,M))}if(te=e.memoizedState,te!==null&&(M=te.dehydrated,M!==null)){if(g)t.flags&256?(Za(t),t.flags&=-257,t=bi(e,t,r)):t.memoizedState!==null?(Ka(),t.child=e.child,t.flags|=128,t=null):(Ka(),p=s.fallback,M=t.mode,s=qs({mode:"visible",children:s.children},M),p=To(p,M,r,null),p.flags|=2,s.return=t,p.return=t,s.sibling=p,t.child=s,xr(t,e.child,null,r),s=t.child,s.memoizedState=xi(r),s.childLanes=wi(e,D,r),t.memoizedState=_i,t=p);else if(Za(t),od(M)){if(D=M.nextSibling&&M.nextSibling.dataset,D)var se=D.dgst;D=se,s=Error(c(419)),s.stack="",s.digest=D,rl({value:s,source:null,stack:null}),t=bi(e,t,r)}else if(Yt||ll(e,t,r,!1),D=(r&e.childLanes)!==0,Yt||D){if(D=gt,D!==null&&(s=r&-r,s=(s&42)!==0?1:Gn(s),s=(s&(D.suspendedLanes|r))!==0?0:s,s!==0&&s!==te.retryLane))throw te.retryLane=s,ir(e,s),kn(D,e,s),qf;M.data==="$?"||Mi(),t=bi(e,t,r)}else M.data==="$?"?(t.flags|=192,t.child=e.child,t=null):(e=te.treeContext,Tt=Jn(M.nextSibling),dn=t,it=!0,qo=null,da=!1,e!==null&&(In[Un++]=ja,In[Un++]=ka,In[Un++]=Do,ja=e.id,ka=e.overflow,Do=t),t=Ci(t,s.children),t.flags|=4096);return t}return p?(Ka(),p=s.fallback,M=t.mode,te=e.child,se=te.sibling,s=Ea(te,{mode:"hidden",children:s.children}),s.subtreeFlags=te.subtreeFlags&65011712,se!==null?p=Ea(se,p):(p=To(p,M,r,null),p.flags|=2),p.return=t,s.return=t,s.sibling=p,t.child=s,s=p,p=t.child,M=e.child.memoizedState,M===null?M=xi(r):(te=M.cachePool,te!==null?(se=zt._currentValue,te=te.parent!==se?{parent:se,pool:se}:te):te=Nu(),M={baseLanes:M.baseLanes|r,cachePool:te}),p.memoizedState=M,p.childLanes=wi(e,D,r),t.memoizedState=_i,s):(Za(t),r=e.child,e=r.sibling,r=Ea(r,{mode:"visible",children:s.children}),r.return=t,r.sibling=null,e!==null&&(D=t.deletions,D===null?(t.deletions=[e],t.flags|=16):D.push(e)),t.child=r,t.memoizedState=null,r)}function Ci(e,t){return t=qs({mode:"visible",children:t},e.mode),t.return=e,e.child=t}function qs(e,t){return e=Cn(22,e,null,t),e.lanes=0,e.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},e}function bi(e,t,r){return xr(t,e.child,null,r),e=Ci(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function Vf(e,t,r){e.lanes|=t;var s=e.alternate;s!==null&&(s.lanes|=t),Mc(e.return,t,r)}function Si(e,t,r,s,p){var g=e.memoizedState;g===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:s,tail:r,tailMode:p}:(g.isBackwards=t,g.rendering=null,g.renderingStartTime=0,g.last=s,g.tail=r,g.tailMode=p)}function Bf(e,t,r){var s=t.pendingProps,p=s.revealOrder,g=s.tail;if(Zt(e,t,s.children,r),s=Vt.current,(s&2)!==0)s=s&1|2,t.flags|=128;else{if(e!==null&&(e.flags&128)!==0)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&Vf(e,r,t);else if(e.tag===19)Vf(e,r,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}s&=1}switch(G(Vt,s),p){case"forwards":for(r=t.child,p=null;r!==null;)e=r.alternate,e!==null&&As(e)===null&&(p=r),r=r.sibling;r=p,r===null?(p=t.child,t.child=null):(p=r.sibling,r.sibling=null),Si(t,!1,p,r,g);break;case"backwards":for(r=null,p=t.child,t.child=null;p!==null;){if(e=p.alternate,e!==null&&As(e)===null){t.child=p;break}e=p.sibling,p.sibling=r,r=p,p=e}Si(t,!0,r,null,g);break;case"together":Si(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Da(e,t,r){if(e!==null&&(t.dependencies=e.dependencies),ao|=t.lanes,(r&t.childLanes)===0)if(e!==null){if(ll(e,t,r,!1),(r&t.childLanes)===0)return null}else return null;if(e!==null&&t.child!==e.child)throw Error(c(153));if(t.child!==null){for(e=t.child,r=Ea(e,e.pendingProps),t.child=r,r.return=t;e.sibling!==null;)e=e.sibling,r=r.sibling=Ea(e,e.pendingProps),r.return=t;r.sibling=null}return t.child}function Ei(e,t){return(e.lanes&t)!==0?!0:(e=e.dependencies,!!(e!==null&&hs(e)))}function cv(e,t,r){switch(t.tag){case 3:J(t,t.stateNode.containerInfo),Ya(t,zt,e.memoizedState.cache),ol();break;case 27:case 5:fe(t);break;case 4:J(t,t.stateNode.containerInfo);break;case 10:Ya(t,t.type,t.memoizedProps.value);break;case 13:var s=t.memoizedState;if(s!==null)return s.dehydrated!==null?(Za(t),t.flags|=128,null):(r&t.child.childLanes)!==0?zf(e,t,r):(Za(t),e=Da(e,t,r),e!==null?e.sibling:null);Za(t);break;case 19:var p=(e.flags&128)!==0;if(s=(r&t.childLanes)!==0,s||(ll(e,t,r,!1),s=(r&t.childLanes)!==0),p){if(s)return Bf(e,t,r);t.flags|=128}if(p=t.memoizedState,p!==null&&(p.rendering=null,p.tail=null,p.lastEffect=null),G(Vt,Vt.current),s)break;return null;case 22:case 23:return t.lanes=0,Pf(e,t,r);case 24:Ya(t,zt,e.memoizedState.cache)}return Da(e,t,r)}function Yf(e,t,r){if(e!==null)if(e.memoizedProps!==t.pendingProps)Yt=!0;else{if(!Ei(e,r)&&(t.flags&128)===0)return Yt=!1,cv(e,t,r);Yt=(e.flags&131072)!==0}else Yt=!1,it&&(t.flags&1048576)!==0&&wu(t,ps,t.index);switch(t.lanes=0,t.tag){case 16:e:{e=t.pendingProps;var s=t.elementType,p=s._init;if(s=p(s._payload),t.type=s,typeof s=="function")qc(s)?(e=Oo(s,e),t.tag=1,t=Mf(null,t,s,e,r)):(t.tag=0,t=vi(null,t,s,e,r));else{if(s!=null){if(p=s.$$typeof,p===R){t.tag=11,t=$f(null,t,s,e,r);break e}else if(p===U){t.tag=14,t=If(null,t,s,e,r);break e}}throw t=O(s)||s,Error(c(306,t,""))}}return t;case 0:return vi(e,t,t.type,t.pendingProps,r);case 1:return s=t.type,p=Oo(s,t.pendingProps),Mf(e,t,s,p,r);case 3:e:{if(J(t,t.stateNode.containerInfo),e===null)throw Error(c(387));s=t.pendingProps;var g=t.memoizedState;p=g.element,Wc(e,t),pl(t,s,null,r);var D=t.memoizedState;if(s=D.cache,Ya(t,zt,s),s!==g.cache&&Hc(t,[zt],r,!0),fl(),s=D.element,g.isDehydrated)if(g={element:s,isDehydrated:!1,cache:D.cache},t.updateQueue.baseState=g,t.memoizedState=g,t.flags&256){t=Hf(e,t,s,r);break e}else if(s!==p){p=qn(Error(c(424)),t),rl(p),t=Hf(e,t,s,r);break e}else{switch(e=t.stateNode.containerInfo,e.nodeType){case 9:e=e.body;break;default:e=e.nodeName==="HTML"?e.ownerDocument.body:e}for(Tt=Jn(e.firstChild),dn=t,it=!0,qo=null,da=!0,r=Sf(t,null,s,r),t.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling}else{if(ol(),s===p){t=Da(e,t,r);break e}Zt(e,t,s,r)}t=t.child}return t;case 26:return Fs(e,t),e===null?(r=Xp(t.type,null,t.pendingProps,null))?t.memoizedState=r:it||(r=t.type,e=t.pendingProps,s=Ws(ee.current).createElement(r),s[St]=t,s[At]=e,Jt(s,r,e),me(s),t.stateNode=s):t.memoizedState=Xp(t.type,e.memoizedProps,t.pendingProps,e.memoizedState),null;case 27:return fe(t),e===null&&it&&(s=t.stateNode=Gp(t.type,t.pendingProps,ee.current),dn=t,da=!0,p=Tt,so(t.type)?(rd=p,Tt=Jn(s.firstChild)):Tt=p),Zt(e,t,t.pendingProps.children,r),Fs(e,t),e===null&&(t.flags|=4194304),t.child;case 5:return e===null&&it&&((p=s=Tt)&&(s=Iv(s,t.type,t.pendingProps,da),s!==null?(t.stateNode=s,dn=t,Tt=Jn(s.firstChild),da=!1,p=!0):p=!1),p||$o(t)),fe(t),p=t.type,g=t.pendingProps,D=e!==null?e.memoizedProps:null,s=g.children,td(p,g)?s=null:D!==null&&td(p,D)&&(t.flags|=32),t.memoizedState!==null&&(p=ei(e,t,ev,null,null,r),$l._currentValue=p),Fs(e,t),Zt(e,t,s,r),t.child;case 6:return e===null&&it&&((e=r=Tt)&&(r=Uv(r,t.pendingProps,da),r!==null?(t.stateNode=r,dn=t,Tt=null,e=!0):e=!1),e||$o(t)),null;case 13:return zf(e,t,r);case 4:return J(t,t.stateNode.containerInfo),s=t.pendingProps,e===null?t.child=xr(t,null,s,r):Zt(e,t,s,r),t.child;case 11:return $f(e,t,t.type,t.pendingProps,r);case 7:return Zt(e,t,t.pendingProps,r),t.child;case 8:return Zt(e,t,t.pendingProps.children,r),t.child;case 12:return Zt(e,t,t.pendingProps.children,r),t.child;case 10:return s=t.pendingProps,Ya(t,t.type,s.value),Zt(e,t,s.children,r),t.child;case 9:return p=t.type._context,s=t.pendingProps.children,Uo(t),p=an(p),s=s(p),t.flags|=1,Zt(e,t,s,r),t.child;case 14:return If(e,t,t.type,t.pendingProps,r);case 15:return Uf(e,t,t.type,t.pendingProps,r);case 19:return Bf(e,t,r);case 31:return s=t.pendingProps,r=t.mode,s={mode:s.mode,children:s.children},e===null?(r=qs(s,r),r.ref=t.ref,t.child=r,r.return=t,t=r):(r=Ea(e.child,s),r.ref=t.ref,t.child=r,r.return=t,t=r),t;case 22:return Pf(e,t,r);case 24:return Uo(t),s=an(zt),e===null?(p=Bc(),p===null&&(p=gt,g=zc(),p.pooledCache=g,g.refCount++,g!==null&&(p.pooledCacheLanes|=r),p=g),t.memoizedState={parent:s,cache:p},Gc(t),Ya(t,zt,p)):((e.lanes&r)!==0&&(Wc(e,t),pl(t,null,null,r),fl()),p=e.memoizedState,g=t.memoizedState,p.parent!==s?(p={parent:s,cache:s},t.memoizedState=p,t.lanes===0&&(t.memoizedState=t.updateQueue.baseState=p),Ya(t,zt,s)):(s=g.cache,Ya(t,zt,s),s!==p.cache&&Hc(t,[zt],r,!0))),Zt(e,t,t.pendingProps.children,r),t.child;case 29:throw t.pendingProps}throw Error(c(156,t.tag))}function Fa(e){e.flags|=4}function Gf(e,t){if(t.type!=="stylesheet"||(t.state.loading&4)!==0)e.flags&=-16777217;else if(e.flags|=16777216,!th(t)){if(t=Pn.current,t!==null&&((lt&4194048)===lt?ua!==null:(lt&62914560)!==lt&&(lt&536870912)===0||t!==ua))throw dl=Yc,Ru;e.flags|=8192}}function $s(e,t){t!==null&&(e.flags|=4),e.flags&16384&&(t=e.tag!==22?aa():536870912,e.lanes|=t,Sr|=t)}function xl(e,t){if(!it)switch(e.tailMode){case"hidden":t=e.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e.tail=null:r.sibling=null;break;case"collapsed":r=e.tail;for(var s=null;r!==null;)r.alternate!==null&&(s=r),r=r.sibling;s===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:s.sibling=null}}function Nt(e){var t=e.alternate!==null&&e.alternate.child===e.child,r=0,s=0;if(t)for(var p=e.child;p!==null;)r|=p.lanes|p.childLanes,s|=p.subtreeFlags&65011712,s|=p.flags&65011712,p.return=e,p=p.sibling;else for(p=e.child;p!==null;)r|=p.lanes|p.childLanes,s|=p.subtreeFlags,s|=p.flags,p.return=e,p=p.sibling;return e.subtreeFlags|=s,e.childLanes=r,t}function iv(e,t,r){var s=t.pendingProps;switch(Pc(t),t.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Nt(t),null;case 1:return Nt(t),null;case 3:return r=t.stateNode,s=null,e!==null&&(s=e.memoizedState.cache),t.memoizedState.cache!==s&&(t.flags|=2048),Ra(zt),pe(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(e===null||e.child===null)&&(al(t)?Fa(t):e===null||e.memoizedState.isDehydrated&&(t.flags&256)===0||(t.flags|=1024,Su())),Nt(t),null;case 26:return r=t.memoizedState,e===null?(Fa(t),r!==null?(Nt(t),Gf(t,r)):(Nt(t),t.flags&=-16777217)):r?r!==e.memoizedState?(Fa(t),Nt(t),Gf(t,r)):(Nt(t),t.flags&=-16777217):(e.memoizedProps!==s&&Fa(t),Nt(t),t.flags&=-16777217),null;case 27:ye(t),r=ee.current;var p=t.type;if(e!==null&&t.stateNode!=null)e.memoizedProps!==s&&Fa(t);else{if(!s){if(t.stateNode===null)throw Error(c(166));return Nt(t),null}e=H.current,al(t)?Cu(t):(e=Gp(p,s,r),t.stateNode=e,Fa(t))}return Nt(t),null;case 5:if(ye(t),r=t.type,e!==null&&t.stateNode!=null)e.memoizedProps!==s&&Fa(t);else{if(!s){if(t.stateNode===null)throw Error(c(166));return Nt(t),null}if(e=H.current,al(t))Cu(t);else{switch(p=Ws(ee.current),e){case 1:e=p.createElementNS("http://www.w3.org/2000/svg",r);break;case 2:e=p.createElementNS("http://www.w3.org/1998/Math/MathML",r);break;default:switch(r){case"svg":e=p.createElementNS("http://www.w3.org/2000/svg",r);break;case"math":e=p.createElementNS("http://www.w3.org/1998/Math/MathML",r);break;case"script":e=p.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild);break;case"select":e=typeof s.is=="string"?p.createElement("select",{is:s.is}):p.createElement("select"),s.multiple?e.multiple=!0:s.size&&(e.size=s.size);break;default:e=typeof s.is=="string"?p.createElement(r,{is:s.is}):p.createElement(r)}}e[St]=t,e[At]=s;e:for(p=t.child;p!==null;){if(p.tag===5||p.tag===6)e.appendChild(p.stateNode);else if(p.tag!==4&&p.tag!==27&&p.child!==null){p.child.return=p,p=p.child;continue}if(p===t)break e;for(;p.sibling===null;){if(p.return===null||p.return===t)break e;p=p.return}p.sibling.return=p.return,p=p.sibling}t.stateNode=e;e:switch(Jt(e,r,s),r){case"button":case"input":case"select":case"textarea":e=!!s.autoFocus;break e;case"img":e=!0;break e;default:e=!1}e&&Fa(t)}}return Nt(t),t.flags&=-16777217,null;case 6:if(e&&t.stateNode!=null)e.memoizedProps!==s&&Fa(t);else{if(typeof s!="string"&&t.stateNode===null)throw Error(c(166));if(e=ee.current,al(t)){if(e=t.stateNode,r=t.memoizedProps,s=null,p=dn,p!==null)switch(p.tag){case 27:case 5:s=p.memoizedProps}e[St]=t,e=!!(e.nodeValue===r||s!==null&&s.suppressHydrationWarning===!0||Op(e.nodeValue,r)),e||$o(t)}else e=Ws(e).createTextNode(s),e[St]=t,t.stateNode=e}return Nt(t),null;case 13:if(s=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(p=al(t),s!==null&&s.dehydrated!==null){if(e===null){if(!p)throw Error(c(318));if(p=t.memoizedState,p=p!==null?p.dehydrated:null,!p)throw Error(c(317));p[St]=t}else ol(),(t.flags&128)===0&&(t.memoizedState=null),t.flags|=4;Nt(t),p=!1}else p=Su(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=p),p=!0;if(!p)return t.flags&256?(Ta(t),t):(Ta(t),null)}if(Ta(t),(t.flags&128)!==0)return t.lanes=r,t;if(r=s!==null,e=e!==null&&e.memoizedState!==null,r){s=t.child,p=null,s.alternate!==null&&s.alternate.memoizedState!==null&&s.alternate.memoizedState.cachePool!==null&&(p=s.alternate.memoizedState.cachePool.pool);var g=null;s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(g=s.memoizedState.cachePool.pool),g!==p&&(s.flags|=2048)}return r!==e&&r&&(t.child.flags|=8192),$s(t,t.updateQueue),Nt(t),null;case 4:return pe(),e===null&&Xi(t.stateNode.containerInfo),Nt(t),null;case 10:return Ra(t.type),Nt(t),null;case 19:if(W(Vt),p=t.memoizedState,p===null)return Nt(t),null;if(s=(t.flags&128)!==0,g=p.rendering,g===null)if(s)xl(p,!1);else{if(Dt!==0||e!==null&&(e.flags&128)!==0)for(e=t.child;e!==null;){if(g=As(e),g!==null){for(t.flags|=128,xl(p,!1),e=g.updateQueue,t.updateQueue=e,$s(t,e),t.subtreeFlags=0,e=r,r=t.child;r!==null;)xu(r,e),r=r.sibling;return G(Vt,Vt.current&1|2),t.child}e=e.sibling}p.tail!==null&&qe()>Ps&&(t.flags|=128,s=!0,xl(p,!1),t.lanes=4194304)}else{if(!s)if(e=As(g),e!==null){if(t.flags|=128,s=!0,e=e.updateQueue,t.updateQueue=e,$s(t,e),xl(p,!0),p.tail===null&&p.tailMode==="hidden"&&!g.alternate&&!it)return Nt(t),null}else 2*qe()-p.renderingStartTime>Ps&&r!==536870912&&(t.flags|=128,s=!0,xl(p,!1),t.lanes=4194304);p.isBackwards?(g.sibling=t.child,t.child=g):(e=p.last,e!==null?e.sibling=g:t.child=g,p.last=g)}return p.tail!==null?(t=p.tail,p.rendering=t,p.tail=t.sibling,p.renderingStartTime=qe(),t.sibling=null,e=Vt.current,G(Vt,s?e&1|2:e&1),t):(Nt(t),null);case 22:case 23:return Ta(t),Kc(),s=t.memoizedState!==null,e!==null?e.memoizedState!==null!==s&&(t.flags|=8192):s&&(t.flags|=8192),s?(r&536870912)!==0&&(t.flags&128)===0&&(Nt(t),t.subtreeFlags&6&&(t.flags|=8192)):Nt(t),r=t.updateQueue,r!==null&&$s(t,r.retryQueue),r=null,e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(r=e.memoizedState.cachePool.pool),s=null,t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(s=t.memoizedState.cachePool.pool),s!==r&&(t.flags|=2048),e!==null&&W(Po),null;case 24:return r=null,e!==null&&(r=e.memoizedState.cache),t.memoizedState.cache!==r&&(t.flags|=2048),Ra(zt),Nt(t),null;case 25:return null;case 30:return null}throw Error(c(156,t.tag))}function dv(e,t){switch(Pc(t),t.tag){case 1:return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return Ra(zt),pe(),e=t.flags,(e&65536)!==0&&(e&128)===0?(t.flags=e&-65537|128,t):null;case 26:case 27:case 5:return ye(t),null;case 13:if(Ta(t),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(c(340));ol()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return W(Vt),null;case 4:return pe(),null;case 10:return Ra(t.type),null;case 22:case 23:return Ta(t),Kc(),e!==null&&W(Po),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 24:return Ra(zt),null;case 25:return null;default:return null}}function Wf(e,t){switch(Pc(t),t.tag){case 3:Ra(zt),pe();break;case 26:case 27:case 5:ye(t);break;case 4:pe();break;case 13:Ta(t);break;case 19:W(Vt);break;case 10:Ra(t.type);break;case 22:case 23:Ta(t),Kc(),e!==null&&W(Po);break;case 24:Ra(zt)}}function wl(e,t){try{var r=t.updateQueue,s=r!==null?r.lastEffect:null;if(s!==null){var p=s.next;r=p;do{if((r.tag&e)===e){s=void 0;var g=r.create,D=r.inst;s=g(),D.destroy=s}r=r.next}while(r!==p)}}catch(M){mt(t,t.return,M)}}function Ja(e,t,r){try{var s=t.updateQueue,p=s!==null?s.lastEffect:null;if(p!==null){var g=p.next;s=g;do{if((s.tag&e)===e){var D=s.inst,M=D.destroy;if(M!==void 0){D.destroy=void 0,p=t;var te=r,se=M;try{se()}catch(he){mt(p,te,he)}}}s=s.next}while(s!==g)}}catch(he){mt(t,t.return,he)}}function Qf(e){var t=e.updateQueue;if(t!==null){var r=e.stateNode;try{$u(t,r)}catch(s){mt(e,e.return,s)}}}function Xf(e,t,r){r.props=Oo(e.type,e.memoizedProps),r.state=e.memoizedState;try{r.componentWillUnmount()}catch(s){mt(e,t,s)}}function Cl(e,t){try{var r=e.ref;if(r!==null){switch(e.tag){case 26:case 27:case 5:var s=e.stateNode;break;case 30:s=e.stateNode;break;default:s=e.stateNode}typeof r=="function"?e.refCleanup=r(s):r.current=s}}catch(p){mt(e,t,p)}}function fa(e,t){var r=e.ref,s=e.refCleanup;if(r!==null)if(typeof s=="function")try{s()}catch(p){mt(e,t,p)}finally{e.refCleanup=null,e=e.alternate,e!=null&&(e.refCleanup=null)}else if(typeof r=="function")try{r(null)}catch(p){mt(e,t,p)}else r.current=null}function Zf(e){var t=e.type,r=e.memoizedProps,s=e.stateNode;try{e:switch(t){case"button":case"input":case"select":case"textarea":r.autoFocus&&s.focus();break e;case"img":r.src?s.src=r.src:r.srcSet&&(s.srcset=r.srcSet)}}catch(p){mt(e,e.return,p)}}function ji(e,t,r){try{var s=e.stateNode;Tv(s,e.type,r,t),s[At]=t}catch(p){mt(e,e.return,p)}}function Kf(e){return e.tag===5||e.tag===3||e.tag===26||e.tag===27&&so(e.type)||e.tag===4}function ki(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||Kf(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.tag===27&&so(e.type)||e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Ni(e,t,r){var s=e.tag;if(s===5||s===6)e=e.stateNode,t?(r.nodeType===9?r.body:r.nodeName==="HTML"?r.ownerDocument.body:r).insertBefore(e,t):(t=r.nodeType===9?r.body:r.nodeName==="HTML"?r.ownerDocument.body:r,t.appendChild(e),r=r._reactRootContainer,r!=null||t.onclick!==null||(t.onclick=Gs));else if(s!==4&&(s===27&&so(e.type)&&(r=e.stateNode,t=null),e=e.child,e!==null))for(Ni(e,t,r),e=e.sibling;e!==null;)Ni(e,t,r),e=e.sibling}function Is(e,t,r){var s=e.tag;if(s===5||s===6)e=e.stateNode,t?r.insertBefore(e,t):r.appendChild(e);else if(s!==4&&(s===27&&so(e.type)&&(r=e.stateNode),e=e.child,e!==null))for(Is(e,t,r),e=e.sibling;e!==null;)Is(e,t,r),e=e.sibling}function Jf(e){var t=e.stateNode,r=e.memoizedProps;try{for(var s=e.type,p=t.attributes;p.length;)t.removeAttributeNode(p[0]);Jt(t,s,r),t[St]=e,t[At]=r}catch(g){mt(e,e.return,g)}}var qa=!1,It=!1,Ri=!1,ep=typeof WeakSet=="function"?WeakSet:Set,Gt=null;function uv(e,t){if(e=e.containerInfo,Ji=ec,e=du(e),kc(e)){if("selectionStart"in e)var r={start:e.selectionStart,end:e.selectionEnd};else e:{r=(r=e.ownerDocument)&&r.defaultView||window;var s=r.getSelection&&r.getSelection();if(s&&s.rangeCount!==0){r=s.anchorNode;var p=s.anchorOffset,g=s.focusNode;s=s.focusOffset;try{r.nodeType,g.nodeType}catch{r=null;break e}var D=0,M=-1,te=-1,se=0,he=0,ve=e,ce=null;t:for(;;){for(var ie;ve!==r||p!==0&&ve.nodeType!==3||(M=D+p),ve!==g||s!==0&&ve.nodeType!==3||(te=D+s),ve.nodeType===3&&(D+=ve.nodeValue.length),(ie=ve.firstChild)!==null;)ce=ve,ve=ie;for(;;){if(ve===e)break t;if(ce===r&&++se===p&&(M=D),ce===g&&++he===s&&(te=D),(ie=ve.nextSibling)!==null)break;ve=ce,ce=ve.parentNode}ve=ie}r=M===-1||te===-1?null:{start:M,end:te}}else r=null}r=r||{start:0,end:0}}else r=null;for(ed={focusedElem:e,selectionRange:r},ec=!1,Gt=t;Gt!==null;)if(t=Gt,e=t.child,(t.subtreeFlags&1024)!==0&&e!==null)e.return=t,Gt=e;else for(;Gt!==null;){switch(t=Gt,g=t.alternate,e=t.flags,t.tag){case 0:break;case 11:case 15:break;case 1:if((e&1024)!==0&&g!==null){e=void 0,r=t,p=g.memoizedProps,g=g.memoizedState,s=r.stateNode;try{var Oe=Oo(r.type,p,r.elementType===r.type);e=s.getSnapshotBeforeUpdate(Oe,g),s.__reactInternalSnapshotBeforeUpdate=e}catch(Ue){mt(r,r.return,Ue)}}break;case 3:if((e&1024)!==0){if(e=t.stateNode.containerInfo,r=e.nodeType,r===9)ad(e);else if(r===1)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":ad(e);break;default:e.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((e&1024)!==0)throw Error(c(163))}if(e=t.sibling,e!==null){e.return=t.return,Gt=e;break}Gt=t.return}}function tp(e,t,r){var s=r.flags;switch(r.tag){case 0:case 11:case 15:eo(e,r),s&4&&wl(5,r);break;case 1:if(eo(e,r),s&4)if(e=r.stateNode,t===null)try{e.componentDidMount()}catch(D){mt(r,r.return,D)}else{var p=Oo(r.type,t.memoizedProps);t=t.memoizedState;try{e.componentDidUpdate(p,t,e.__reactInternalSnapshotBeforeUpdate)}catch(D){mt(r,r.return,D)}}s&64&&Qf(r),s&512&&Cl(r,r.return);break;case 3:if(eo(e,r),s&64&&(e=r.updateQueue,e!==null)){if(t=null,r.child!==null)switch(r.child.tag){case 27:case 5:t=r.child.stateNode;break;case 1:t=r.child.stateNode}try{$u(e,t)}catch(D){mt(r,r.return,D)}}break;case 27:t===null&&s&4&&Jf(r);case 26:case 5:eo(e,r),t===null&&s&4&&Zf(r),s&512&&Cl(r,r.return);break;case 12:eo(e,r);break;case 13:eo(e,r),s&4&&op(e,r),s&64&&(e=r.memoizedState,e!==null&&(e=e.dehydrated,e!==null&&(r=xv.bind(null,r),Pv(e,r))));break;case 22:if(s=r.memoizedState!==null||qa,!s){t=t!==null&&t.memoizedState!==null||It,p=qa;var g=It;qa=s,(It=t)&&!g?to(e,r,(r.subtreeFlags&8772)!==0):eo(e,r),qa=p,It=g}break;case 30:break;default:eo(e,r)}}function np(e){var t=e.alternate;t!==null&&(e.alternate=null,np(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&Je(t)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var jt=null,yn=!1;function $a(e,t,r){for(r=r.child;r!==null;)ap(e,t,r),r=r.sibling}function ap(e,t,r){if(yt&&typeof yt.onCommitFiberUnmount=="function")try{yt.onCommitFiberUnmount(xt,r)}catch{}switch(r.tag){case 26:It||fa(r,t),$a(e,t,r),r.memoizedState?r.memoizedState.count--:r.stateNode&&(r=r.stateNode,r.parentNode.removeChild(r));break;case 27:It||fa(r,t);var s=jt,p=yn;so(r.type)&&(jt=r.stateNode,yn=!1),$a(e,t,r),Tl(r.stateNode),jt=s,yn=p;break;case 5:It||fa(r,t);case 6:if(s=jt,p=yn,jt=null,$a(e,t,r),jt=s,yn=p,jt!==null)if(yn)try{(jt.nodeType===9?jt.body:jt.nodeName==="HTML"?jt.ownerDocument.body:jt).removeChild(r.stateNode)}catch(g){mt(r,t,g)}else try{jt.removeChild(r.stateNode)}catch(g){mt(r,t,g)}break;case 18:jt!==null&&(yn?(e=jt,Bp(e.nodeType===9?e.body:e.nodeName==="HTML"?e.ownerDocument.body:e,r.stateNode),Ll(e)):Bp(jt,r.stateNode));break;case 4:s=jt,p=yn,jt=r.stateNode.containerInfo,yn=!0,$a(e,t,r),jt=s,yn=p;break;case 0:case 11:case 14:case 15:It||Ja(2,r,t),It||Ja(4,r,t),$a(e,t,r);break;case 1:It||(fa(r,t),s=r.stateNode,typeof s.componentWillUnmount=="function"&&Xf(r,t,s)),$a(e,t,r);break;case 21:$a(e,t,r);break;case 22:It=(s=It)||r.memoizedState!==null,$a(e,t,r),It=s;break;default:$a(e,t,r)}}function op(e,t){if(t.memoizedState===null&&(e=t.alternate,e!==null&&(e=e.memoizedState,e!==null&&(e=e.dehydrated,e!==null))))try{Ll(e)}catch(r){mt(t,t.return,r)}}function fv(e){switch(e.tag){case 13:case 19:var t=e.stateNode;return t===null&&(t=e.stateNode=new ep),t;case 22:return e=e.stateNode,t=e._retryCache,t===null&&(t=e._retryCache=new ep),t;default:throw Error(c(435,e.tag))}}function Ai(e,t){var r=fv(e);t.forEach(function(s){var p=wv.bind(null,e,s);r.has(s)||(r.add(s),s.then(p,p))})}function bn(e,t){var r=t.deletions;if(r!==null)for(var s=0;s<r.length;s++){var p=r[s],g=e,D=t,M=D;e:for(;M!==null;){switch(M.tag){case 27:if(so(M.type)){jt=M.stateNode,yn=!1;break e}break;case 5:jt=M.stateNode,yn=!1;break e;case 3:case 4:jt=M.stateNode.containerInfo,yn=!0;break e}M=M.return}if(jt===null)throw Error(c(160));ap(g,D,p),jt=null,yn=!1,g=p.alternate,g!==null&&(g.return=null),p.return=null}if(t.subtreeFlags&13878)for(t=t.child;t!==null;)rp(t,e),t=t.sibling}var Kn=null;function rp(e,t){var r=e.alternate,s=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:bn(t,e),Sn(e),s&4&&(Ja(3,e,e.return),wl(3,e),Ja(5,e,e.return));break;case 1:bn(t,e),Sn(e),s&512&&(It||r===null||fa(r,r.return)),s&64&&qa&&(e=e.updateQueue,e!==null&&(s=e.callbacks,s!==null&&(r=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=r===null?s:r.concat(s))));break;case 26:var p=Kn;if(bn(t,e),Sn(e),s&512&&(It||r===null||fa(r,r.return)),s&4){var g=r!==null?r.memoizedState:null;if(s=e.memoizedState,r===null)if(s===null)if(e.stateNode===null){e:{s=e.type,r=e.memoizedProps,p=p.ownerDocument||p;t:switch(s){case"title":g=p.getElementsByTagName("title")[0],(!g||g[ze]||g[St]||g.namespaceURI==="http://www.w3.org/2000/svg"||g.hasAttribute("itemprop"))&&(g=p.createElement(s),p.head.insertBefore(g,p.querySelector("head > title"))),Jt(g,s,r),g[St]=e,me(g),s=g;break e;case"link":var D=Jp("link","href",p).get(s+(r.href||""));if(D){for(var M=0;M<D.length;M++)if(g=D[M],g.getAttribute("href")===(r.href==null||r.href===""?null:r.href)&&g.getAttribute("rel")===(r.rel==null?null:r.rel)&&g.getAttribute("title")===(r.title==null?null:r.title)&&g.getAttribute("crossorigin")===(r.crossOrigin==null?null:r.crossOrigin)){D.splice(M,1);break t}}g=p.createElement(s),Jt(g,s,r),p.head.appendChild(g);break;case"meta":if(D=Jp("meta","content",p).get(s+(r.content||""))){for(M=0;M<D.length;M++)if(g=D[M],g.getAttribute("content")===(r.content==null?null:""+r.content)&&g.getAttribute("name")===(r.name==null?null:r.name)&&g.getAttribute("property")===(r.property==null?null:r.property)&&g.getAttribute("http-equiv")===(r.httpEquiv==null?null:r.httpEquiv)&&g.getAttribute("charset")===(r.charSet==null?null:r.charSet)){D.splice(M,1);break t}}g=p.createElement(s),Jt(g,s,r),p.head.appendChild(g);break;default:throw Error(c(468,s))}g[St]=e,me(g),s=g}e.stateNode=s}else eh(p,e.type,e.stateNode);else e.stateNode=Kp(p,s,e.memoizedProps);else g!==s?(g===null?r.stateNode!==null&&(r=r.stateNode,r.parentNode.removeChild(r)):g.count--,s===null?eh(p,e.type,e.stateNode):Kp(p,s,e.memoizedProps)):s===null&&e.stateNode!==null&&ji(e,e.memoizedProps,r.memoizedProps)}break;case 27:bn(t,e),Sn(e),s&512&&(It||r===null||fa(r,r.return)),r!==null&&s&4&&ji(e,e.memoizedProps,r.memoizedProps);break;case 5:if(bn(t,e),Sn(e),s&512&&(It||r===null||fa(r,r.return)),e.flags&32){p=e.stateNode;try{wa(p,"")}catch(ie){mt(e,e.return,ie)}}s&4&&e.stateNode!=null&&(p=e.memoizedProps,ji(e,p,r!==null?r.memoizedProps:p)),s&1024&&(Ri=!0);break;case 6:if(bn(t,e),Sn(e),s&4){if(e.stateNode===null)throw Error(c(162));s=e.memoizedProps,r=e.stateNode;try{r.nodeValue=s}catch(ie){mt(e,e.return,ie)}}break;case 3:if(Zs=null,p=Kn,Kn=Qs(t.containerInfo),bn(t,e),Kn=p,Sn(e),s&4&&r!==null&&r.memoizedState.isDehydrated)try{Ll(t.containerInfo)}catch(ie){mt(e,e.return,ie)}Ri&&(Ri=!1,lp(e));break;case 4:s=Kn,Kn=Qs(e.stateNode.containerInfo),bn(t,e),Sn(e),Kn=s;break;case 12:bn(t,e),Sn(e);break;case 13:bn(t,e),Sn(e),e.child.flags&8192&&e.memoizedState!==null!=(r!==null&&r.memoizedState!==null)&&(Ii=qe()),s&4&&(s=e.updateQueue,s!==null&&(e.updateQueue=null,Ai(e,s)));break;case 22:p=e.memoizedState!==null;var te=r!==null&&r.memoizedState!==null,se=qa,he=It;if(qa=se||p,It=he||te,bn(t,e),It=he,qa=se,Sn(e),s&8192)e:for(t=e.stateNode,t._visibility=p?t._visibility&-2:t._visibility|1,p&&(r===null||te||qa||It||Mo(e)),r=null,t=e;;){if(t.tag===5||t.tag===26){if(r===null){te=r=t;try{if(g=te.stateNode,p)D=g.style,typeof D.setProperty=="function"?D.setProperty("display","none","important"):D.display="none";else{M=te.stateNode;var ve=te.memoizedProps.style,ce=ve!=null&&ve.hasOwnProperty("display")?ve.display:null;M.style.display=ce==null||typeof ce=="boolean"?"":(""+ce).trim()}}catch(ie){mt(te,te.return,ie)}}}else if(t.tag===6){if(r===null){te=t;try{te.stateNode.nodeValue=p?"":te.memoizedProps}catch(ie){mt(te,te.return,ie)}}}else if((t.tag!==22&&t.tag!==23||t.memoizedState===null||t===e)&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;r===t&&(r=null),t=t.return}r===t&&(r=null),t.sibling.return=t.return,t=t.sibling}s&4&&(s=e.updateQueue,s!==null&&(r=s.retryQueue,r!==null&&(s.retryQueue=null,Ai(e,r))));break;case 19:bn(t,e),Sn(e),s&4&&(s=e.updateQueue,s!==null&&(e.updateQueue=null,Ai(e,s)));break;case 30:break;case 21:break;default:bn(t,e),Sn(e)}}function Sn(e){var t=e.flags;if(t&2){try{for(var r,s=e.return;s!==null;){if(Kf(s)){r=s;break}s=s.return}if(r==null)throw Error(c(160));switch(r.tag){case 27:var p=r.stateNode,g=ki(e);Is(e,g,p);break;case 5:var D=r.stateNode;r.flags&32&&(wa(D,""),r.flags&=-33);var M=ki(e);Is(e,M,D);break;case 3:case 4:var te=r.stateNode.containerInfo,se=ki(e);Ni(e,se,te);break;default:throw Error(c(161))}}catch(he){mt(e,e.return,he)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function lp(e){if(e.subtreeFlags&1024)for(e=e.child;e!==null;){var t=e;lp(t),t.tag===5&&t.flags&1024&&t.stateNode.reset(),e=e.sibling}}function eo(e,t){if(t.subtreeFlags&8772)for(t=t.child;t!==null;)tp(e,t.alternate,t),t=t.sibling}function Mo(e){for(e=e.child;e!==null;){var t=e;switch(t.tag){case 0:case 11:case 14:case 15:Ja(4,t,t.return),Mo(t);break;case 1:fa(t,t.return);var r=t.stateNode;typeof r.componentWillUnmount=="function"&&Xf(t,t.return,r),Mo(t);break;case 27:Tl(t.stateNode);case 26:case 5:fa(t,t.return),Mo(t);break;case 22:t.memoizedState===null&&Mo(t);break;case 30:Mo(t);break;default:Mo(t)}e=e.sibling}}function to(e,t,r){for(r=r&&(t.subtreeFlags&8772)!==0,t=t.child;t!==null;){var s=t.alternate,p=e,g=t,D=g.flags;switch(g.tag){case 0:case 11:case 15:to(p,g,r),wl(4,g);break;case 1:if(to(p,g,r),s=g,p=s.stateNode,typeof p.componentDidMount=="function")try{p.componentDidMount()}catch(se){mt(s,s.return,se)}if(s=g,p=s.updateQueue,p!==null){var M=s.stateNode;try{var te=p.shared.hiddenCallbacks;if(te!==null)for(p.shared.hiddenCallbacks=null,p=0;p<te.length;p++)qu(te[p],M)}catch(se){mt(s,s.return,se)}}r&&D&64&&Qf(g),Cl(g,g.return);break;case 27:Jf(g);case 26:case 5:to(p,g,r),r&&s===null&&D&4&&Zf(g),Cl(g,g.return);break;case 12:to(p,g,r);break;case 13:to(p,g,r),r&&D&4&&op(p,g);break;case 22:g.memoizedState===null&&to(p,g,r),Cl(g,g.return);break;case 30:break;default:to(p,g,r)}t=t.sibling}}function Ti(e,t){var r=null;e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(r=e.memoizedState.cachePool.pool),e=null,t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(e=t.memoizedState.cachePool.pool),e!==r&&(e!=null&&e.refCount++,r!=null&&sl(r))}function Di(e,t){e=null,t.alternate!==null&&(e=t.alternate.memoizedState.cache),t=t.memoizedState.cache,t!==e&&(t.refCount++,e!=null&&sl(e))}function pa(e,t,r,s){if(t.subtreeFlags&10256)for(t=t.child;t!==null;)sp(e,t,r,s),t=t.sibling}function sp(e,t,r,s){var p=t.flags;switch(t.tag){case 0:case 11:case 15:pa(e,t,r,s),p&2048&&wl(9,t);break;case 1:pa(e,t,r,s);break;case 3:pa(e,t,r,s),p&2048&&(e=null,t.alternate!==null&&(e=t.alternate.memoizedState.cache),t=t.memoizedState.cache,t!==e&&(t.refCount++,e!=null&&sl(e)));break;case 12:if(p&2048){pa(e,t,r,s),e=t.stateNode;try{var g=t.memoizedProps,D=g.id,M=g.onPostCommit;typeof M=="function"&&M(D,t.alternate===null?"mount":"update",e.passiveEffectDuration,-0)}catch(te){mt(t,t.return,te)}}else pa(e,t,r,s);break;case 13:pa(e,t,r,s);break;case 23:break;case 22:g=t.stateNode,D=t.alternate,t.memoizedState!==null?g._visibility&2?pa(e,t,r,s):bl(e,t):g._visibility&2?pa(e,t,r,s):(g._visibility|=2,wr(e,t,r,s,(t.subtreeFlags&10256)!==0)),p&2048&&Ti(D,t);break;case 24:pa(e,t,r,s),p&2048&&Di(t.alternate,t);break;default:pa(e,t,r,s)}}function wr(e,t,r,s,p){for(p=p&&(t.subtreeFlags&10256)!==0,t=t.child;t!==null;){var g=e,D=t,M=r,te=s,se=D.flags;switch(D.tag){case 0:case 11:case 15:wr(g,D,M,te,p),wl(8,D);break;case 23:break;case 22:var he=D.stateNode;D.memoizedState!==null?he._visibility&2?wr(g,D,M,te,p):bl(g,D):(he._visibility|=2,wr(g,D,M,te,p)),p&&se&2048&&Ti(D.alternate,D);break;case 24:wr(g,D,M,te,p),p&&se&2048&&Di(D.alternate,D);break;default:wr(g,D,M,te,p)}t=t.sibling}}function bl(e,t){if(t.subtreeFlags&10256)for(t=t.child;t!==null;){var r=e,s=t,p=s.flags;switch(s.tag){case 22:bl(r,s),p&2048&&Ti(s.alternate,s);break;case 24:bl(r,s),p&2048&&Di(s.alternate,s);break;default:bl(r,s)}t=t.sibling}}var Sl=8192;function Cr(e){if(e.subtreeFlags&Sl)for(e=e.child;e!==null;)cp(e),e=e.sibling}function cp(e){switch(e.tag){case 26:Cr(e),e.flags&Sl&&e.memoizedState!==null&&Zv(Kn,e.memoizedState,e.memoizedProps);break;case 5:Cr(e);break;case 3:case 4:var t=Kn;Kn=Qs(e.stateNode.containerInfo),Cr(e),Kn=t;break;case 22:e.memoizedState===null&&(t=e.alternate,t!==null&&t.memoizedState!==null?(t=Sl,Sl=16777216,Cr(e),Sl=t):Cr(e));break;default:Cr(e)}}function ip(e){var t=e.alternate;if(t!==null&&(e=t.child,e!==null)){t.child=null;do t=e.sibling,e.sibling=null,e=t;while(e!==null)}}function El(e){var t=e.deletions;if((e.flags&16)!==0){if(t!==null)for(var r=0;r<t.length;r++){var s=t[r];Gt=s,up(s,e)}ip(e)}if(e.subtreeFlags&10256)for(e=e.child;e!==null;)dp(e),e=e.sibling}function dp(e){switch(e.tag){case 0:case 11:case 15:El(e),e.flags&2048&&Ja(9,e,e.return);break;case 3:El(e);break;case 12:El(e);break;case 22:var t=e.stateNode;e.memoizedState!==null&&t._visibility&2&&(e.return===null||e.return.tag!==13)?(t._visibility&=-3,Us(e)):El(e);break;default:El(e)}}function Us(e){var t=e.deletions;if((e.flags&16)!==0){if(t!==null)for(var r=0;r<t.length;r++){var s=t[r];Gt=s,up(s,e)}ip(e)}for(e=e.child;e!==null;){switch(t=e,t.tag){case 0:case 11:case 15:Ja(8,t,t.return),Us(t);break;case 22:r=t.stateNode,r._visibility&2&&(r._visibility&=-3,Us(t));break;default:Us(t)}e=e.sibling}}function up(e,t){for(;Gt!==null;){var r=Gt;switch(r.tag){case 0:case 11:case 15:Ja(8,r,t);break;case 23:case 22:if(r.memoizedState!==null&&r.memoizedState.cachePool!==null){var s=r.memoizedState.cachePool.pool;s!=null&&s.refCount++}break;case 24:sl(r.memoizedState.cache)}if(s=r.child,s!==null)s.return=r,Gt=s;else e:for(r=e;Gt!==null;){s=Gt;var p=s.sibling,g=s.return;if(np(s),s===r){Gt=null;break e}if(p!==null){p.return=g,Gt=p;break e}Gt=g}}}var pv={getCacheForType:function(e){var t=an(zt),r=t.data.get(e);return r===void 0&&(r=e(),t.data.set(e,r)),r}},hv=typeof WeakMap=="function"?WeakMap:Map,dt=0,gt=null,et=null,lt=0,ut=0,En=null,no=!1,br=!1,Fi=!1,Ia=0,Dt=0,ao=0,Ho=0,qi=0,Ln=0,Sr=0,jl=null,gn=null,$i=!1,Ii=0,Ps=1/0,Ls=null,oo=null,Kt=0,ro=null,Er=null,jr=0,Ui=0,Pi=null,fp=null,kl=0,Li=null;function jn(){if((dt&2)!==0&&lt!==0)return lt&-lt;if(T.T!==null){var e=pr;return e!==0?e:Yi()}return la()}function pp(){Ln===0&&(Ln=(lt&536870912)===0||it?na():536870912);var e=Pn.current;return e!==null&&(e.flags|=32),Ln}function kn(e,t,r){(e===gt&&(ut===2||ut===9)||e.cancelPendingCommit!==null)&&(kr(e,0),lo(e,lt,Ln,!1)),fn(e,r),((dt&2)===0||e!==gt)&&(e===gt&&((dt&2)===0&&(Ho|=r),Dt===4&&lo(e,lt,Ln,!1)),ha(e))}function hp(e,t,r){if((dt&6)!==0)throw Error(c(327));var s=!r&&(t&124)===0&&(t&e.expiredLanes)===0||xn(e,t),p=s?gv(e,t):Hi(e,t,!0),g=s;do{if(p===0){br&&!s&&lo(e,t,0,!1);break}else{if(r=e.current.alternate,g&&!mv(r)){p=Hi(e,t,!1),g=!1;continue}if(p===2){if(g=t,e.errorRecoveryDisabledLanes&g)var D=0;else D=e.pendingLanes&-536870913,D=D!==0?D:D&536870912?536870912:0;if(D!==0){t=D;e:{var M=e;p=jl;var te=M.current.memoizedState.isDehydrated;if(te&&(kr(M,D).flags|=256),D=Hi(M,D,!1),D!==2){if(Fi&&!te){M.errorRecoveryDisabledLanes|=g,Ho|=g,p=4;break e}g=gn,gn=p,g!==null&&(gn===null?gn=g:gn.push.apply(gn,g))}p=D}if(g=!1,p!==2)continue}}if(p===1){kr(e,0),lo(e,t,0,!0);break}e:{switch(s=e,g=p,g){case 0:case 1:throw Error(c(345));case 4:if((t&4194048)!==t)break;case 6:lo(s,t,Ln,!no);break e;case 2:gn=null;break;case 3:case 5:break;default:throw Error(c(329))}if((t&62914560)===t&&(p=Ii+300-qe(),10<p)){if(lo(s,t,Ln,!no),tn(s,0,!0)!==0)break e;s.timeoutHandle=zp(mp.bind(null,s,r,gn,Ls,$i,t,Ln,Ho,Sr,no,g,2,-0,0),p);break e}mp(s,r,gn,Ls,$i,t,Ln,Ho,Sr,no,g,0,-0,0)}}break}while(!0);ha(e)}function mp(e,t,r,s,p,g,D,M,te,se,he,ve,ce,ie){if(e.timeoutHandle=-1,ve=t.subtreeFlags,(ve&8192||(ve&16785408)===16785408)&&(ql={stylesheets:null,count:0,unsuspend:Xv},cp(t),ve=Kv(),ve!==null)){e.cancelPendingCommit=ve(Cp.bind(null,e,t,g,r,s,p,D,M,te,he,1,ce,ie)),lo(e,g,D,!se);return}Cp(e,t,g,r,s,p,D,M,te)}function mv(e){for(var t=e;;){var r=t.tag;if((r===0||r===11||r===15)&&t.flags&16384&&(r=t.updateQueue,r!==null&&(r=r.stores,r!==null)))for(var s=0;s<r.length;s++){var p=r[s],g=p.getSnapshot;p=p.value;try{if(!wn(g(),p))return!1}catch{return!1}}if(r=t.child,t.subtreeFlags&16384&&r!==null)r.return=t,t=r;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function lo(e,t,r,s){t&=~qi,t&=~Ho,e.suspendedLanes|=t,e.pingedLanes&=~t,s&&(e.warmLanes|=t),s=e.expirationTimes;for(var p=t;0<p;){var g=31-wt(p),D=1<<g;s[g]=-1,p&=~D}r!==0&&oa(e,r,t)}function Os(){return(dt&6)===0?(Nl(0),!1):!0}function Oi(){if(et!==null){if(ut===0)var e=et.return;else e=et,Na=Io=null,ai(e),_r=null,vl=0,e=et;for(;e!==null;)Wf(e.alternate,e),e=e.return;et=null}}function kr(e,t){var r=e.timeoutHandle;r!==-1&&(e.timeoutHandle=-1,Fv(r)),r=e.cancelPendingCommit,r!==null&&(e.cancelPendingCommit=null,r()),Oi(),gt=e,et=r=Ea(e.current,null),lt=t,ut=0,En=null,no=!1,br=xn(e,t),Fi=!1,Sr=Ln=qi=Ho=ao=Dt=0,gn=jl=null,$i=!1,(t&8)!==0&&(t|=t&32);var s=e.entangledLanes;if(s!==0)for(e=e.entanglements,s&=t;0<s;){var p=31-wt(s),g=1<<p;t|=e[p],s&=~g}return Ia=t,cs(),r}function yp(e,t){Qe=null,T.H=ks,t===il||t===gs?(t=Du(),ut=3):t===Ru?(t=Du(),ut=4):ut=t===qf?8:t!==null&&typeof t=="object"&&typeof t.then=="function"?6:1,En=t,et===null&&(Dt=1,Ds(e,qn(t,e.current)))}function gp(){var e=T.H;return T.H=ks,e===null?ks:e}function vp(){var e=T.A;return T.A=pv,e}function Mi(){Dt=4,no||(lt&4194048)!==lt&&Pn.current!==null||(br=!0),(ao&134217727)===0&&(Ho&134217727)===0||gt===null||lo(gt,lt,Ln,!1)}function Hi(e,t,r){var s=dt;dt|=2;var p=gp(),g=vp();(gt!==e||lt!==t)&&(Ls=null,kr(e,t)),t=!1;var D=Dt;e:do try{if(ut!==0&&et!==null){var M=et,te=En;switch(ut){case 8:Oi(),D=6;break e;case 3:case 2:case 9:case 6:Pn.current===null&&(t=!0);var se=ut;if(ut=0,En=null,Nr(e,M,te,se),r&&br){D=0;break e}break;default:se=ut,ut=0,En=null,Nr(e,M,te,se)}}yv(),D=Dt;break}catch(he){yp(e,he)}while(!0);return t&&e.shellSuspendCounter++,Na=Io=null,dt=s,T.H=p,T.A=g,et===null&&(gt=null,lt=0,cs()),D}function yv(){for(;et!==null;)_p(et)}function gv(e,t){var r=dt;dt|=2;var s=gp(),p=vp();gt!==e||lt!==t?(Ls=null,Ps=qe()+500,kr(e,t)):br=xn(e,t);e:do try{if(ut!==0&&et!==null){t=et;var g=En;t:switch(ut){case 1:ut=0,En=null,Nr(e,t,g,1);break;case 2:case 9:if(Au(g)){ut=0,En=null,xp(t);break}t=function(){ut!==2&&ut!==9||gt!==e||(ut=7),ha(e)},g.then(t,t);break e;case 3:ut=7;break e;case 4:ut=5;break e;case 7:Au(g)?(ut=0,En=null,xp(t)):(ut=0,En=null,Nr(e,t,g,7));break;case 5:var D=null;switch(et.tag){case 26:D=et.memoizedState;case 5:case 27:var M=et;if(!D||th(D)){ut=0,En=null;var te=M.sibling;if(te!==null)et=te;else{var se=M.return;se!==null?(et=se,Ms(se)):et=null}break t}}ut=0,En=null,Nr(e,t,g,5);break;case 6:ut=0,En=null,Nr(e,t,g,6);break;case 8:Oi(),Dt=6;break e;default:throw Error(c(462))}}vv();break}catch(he){yp(e,he)}while(!0);return Na=Io=null,T.H=s,T.A=p,dt=r,et!==null?0:(gt=null,lt=0,cs(),Dt)}function vv(){for(;et!==null&&!at();)_p(et)}function _p(e){var t=Yf(e.alternate,e,Ia);e.memoizedProps=e.pendingProps,t===null?Ms(e):et=t}function xp(e){var t=e,r=t.alternate;switch(t.tag){case 15:case 0:t=Of(r,t,t.pendingProps,t.type,void 0,lt);break;case 11:t=Of(r,t,t.pendingProps,t.type.render,t.ref,lt);break;case 5:ai(t);default:Wf(r,t),t=et=xu(t,Ia),t=Yf(r,t,Ia)}e.memoizedProps=e.pendingProps,t===null?Ms(e):et=t}function Nr(e,t,r,s){Na=Io=null,ai(t),_r=null,vl=0;var p=t.return;try{if(sv(e,p,t,r,lt)){Dt=1,Ds(e,qn(r,e.current)),et=null;return}}catch(g){if(p!==null)throw et=p,g;Dt=1,Ds(e,qn(r,e.current)),et=null;return}t.flags&32768?(it||s===1?e=!0:br||(lt&536870912)!==0?e=!1:(no=e=!0,(s===2||s===9||s===3||s===6)&&(s=Pn.current,s!==null&&s.tag===13&&(s.flags|=16384))),wp(t,e)):Ms(t)}function Ms(e){var t=e;do{if((t.flags&32768)!==0){wp(t,no);return}e=t.return;var r=iv(t.alternate,t,Ia);if(r!==null){et=r;return}if(t=t.sibling,t!==null){et=t;return}et=t=e}while(t!==null);Dt===0&&(Dt=5)}function wp(e,t){do{var r=dv(e.alternate,e);if(r!==null){r.flags&=32767,et=r;return}if(r=e.return,r!==null&&(r.flags|=32768,r.subtreeFlags=0,r.deletions=null),!t&&(e=e.sibling,e!==null)){et=e;return}et=e=r}while(e!==null);Dt=6,et=null}function Cp(e,t,r,s,p,g,D,M,te){e.cancelPendingCommit=null;do Hs();while(Kt!==0);if((dt&6)!==0)throw Error(c(327));if(t!==null){if(t===e.current)throw Error(c(177));if(g=t.lanes|t.childLanes,g|=Dc,Yn(e,r,g,D,M,te),e===gt&&(et=gt=null,lt=0),Er=t,ro=e,jr=r,Ui=g,Pi=p,fp=s,(t.subtreeFlags&10256)!==0||(t.flags&10256)!==0?(e.callbackNode=null,e.callbackPriority=0,Cv($e,function(){return kp(),null})):(e.callbackNode=null,e.callbackPriority=0),s=(t.flags&13878)!==0,(t.subtreeFlags&13878)!==0||s){s=T.T,T.T=null,p=q.p,q.p=2,D=dt,dt|=4;try{uv(e,t,r)}finally{dt=D,q.p=p,T.T=s}}Kt=1,bp(),Sp(),Ep()}}function bp(){if(Kt===1){Kt=0;var e=ro,t=Er,r=(t.flags&13878)!==0;if((t.subtreeFlags&13878)!==0||r){r=T.T,T.T=null;var s=q.p;q.p=2;var p=dt;dt|=4;try{rp(t,e);var g=ed,D=du(e.containerInfo),M=g.focusedElem,te=g.selectionRange;if(D!==M&&M&&M.ownerDocument&&iu(M.ownerDocument.documentElement,M)){if(te!==null&&kc(M)){var se=te.start,he=te.end;if(he===void 0&&(he=se),"selectionStart"in M)M.selectionStart=se,M.selectionEnd=Math.min(he,M.value.length);else{var ve=M.ownerDocument||document,ce=ve&&ve.defaultView||window;if(ce.getSelection){var ie=ce.getSelection(),Oe=M.textContent.length,Ue=Math.min(te.start,Oe),ht=te.end===void 0?Ue:Math.min(te.end,Oe);!ie.extend&&Ue>ht&&(D=ht,ht=Ue,Ue=D);var oe=cu(M,Ue),ne=cu(M,ht);if(oe&&ne&&(ie.rangeCount!==1||ie.anchorNode!==oe.node||ie.anchorOffset!==oe.offset||ie.focusNode!==ne.node||ie.focusOffset!==ne.offset)){var le=ve.createRange();le.setStart(oe.node,oe.offset),ie.removeAllRanges(),Ue>ht?(ie.addRange(le),ie.extend(ne.node,ne.offset)):(le.setEnd(ne.node,ne.offset),ie.addRange(le))}}}}for(ve=[],ie=M;ie=ie.parentNode;)ie.nodeType===1&&ve.push({element:ie,left:ie.scrollLeft,top:ie.scrollTop});for(typeof M.focus=="function"&&M.focus(),M=0;M<ve.length;M++){var ge=ve[M];ge.element.scrollLeft=ge.left,ge.element.scrollTop=ge.top}}ec=!!Ji,ed=Ji=null}finally{dt=p,q.p=s,T.T=r}}e.current=t,Kt=2}}function Sp(){if(Kt===2){Kt=0;var e=ro,t=Er,r=(t.flags&8772)!==0;if((t.subtreeFlags&8772)!==0||r){r=T.T,T.T=null;var s=q.p;q.p=2;var p=dt;dt|=4;try{tp(e,t.alternate,t)}finally{dt=p,q.p=s,T.T=r}}Kt=3}}function Ep(){if(Kt===4||Kt===3){Kt=0,Te();var e=ro,t=Er,r=jr,s=fp;(t.subtreeFlags&10256)!==0||(t.flags&10256)!==0?Kt=5:(Kt=0,Er=ro=null,jp(e,e.pendingLanes));var p=e.pendingLanes;if(p===0&&(oo=null),Wn(r),t=t.stateNode,yt&&typeof yt.onCommitFiberRoot=="function")try{yt.onCommitFiberRoot(xt,t,void 0,(t.current.flags&128)===128)}catch{}if(s!==null){t=T.T,p=q.p,q.p=2,T.T=null;try{for(var g=e.onRecoverableError,D=0;D<s.length;D++){var M=s[D];g(M.value,{componentStack:M.stack})}}finally{T.T=t,q.p=p}}(jr&3)!==0&&Hs(),ha(e),p=e.pendingLanes,(r&4194090)!==0&&(p&42)!==0?e===Li?kl++:(kl=0,Li=e):kl=0,Nl(0)}}function jp(e,t){(e.pooledCacheLanes&=t)===0&&(t=e.pooledCache,t!=null&&(e.pooledCache=null,sl(t)))}function Hs(e){return bp(),Sp(),Ep(),kp()}function kp(){if(Kt!==5)return!1;var e=ro,t=Ui;Ui=0;var r=Wn(jr),s=T.T,p=q.p;try{q.p=32>r?32:r,T.T=null,r=Pi,Pi=null;var g=ro,D=jr;if(Kt=0,Er=ro=null,jr=0,(dt&6)!==0)throw Error(c(331));var M=dt;if(dt|=4,dp(g.current),sp(g,g.current,D,r),dt=M,Nl(0,!1),yt&&typeof yt.onPostCommitFiberRoot=="function")try{yt.onPostCommitFiberRoot(xt,g)}catch{}return!0}finally{q.p=p,T.T=s,jp(e,t)}}function Np(e,t,r){t=qn(r,t),t=gi(e.stateNode,t,2),e=Qa(e,t,2),e!==null&&(fn(e,2),ha(e))}function mt(e,t,r){if(e.tag===3)Np(e,e,r);else for(;t!==null;){if(t.tag===3){Np(t,e,r);break}else if(t.tag===1){var s=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof s.componentDidCatch=="function"&&(oo===null||!oo.has(s))){e=qn(r,e),r=Df(2),s=Qa(t,r,2),s!==null&&(Ff(r,s,t,e),fn(s,2),ha(s));break}}t=t.return}}function zi(e,t,r){var s=e.pingCache;if(s===null){s=e.pingCache=new hv;var p=new Set;s.set(t,p)}else p=s.get(t),p===void 0&&(p=new Set,s.set(t,p));p.has(r)||(Fi=!0,p.add(r),e=_v.bind(null,e,t,r),t.then(e,e))}function _v(e,t,r){var s=e.pingCache;s!==null&&s.delete(t),e.pingedLanes|=e.suspendedLanes&r,e.warmLanes&=~r,gt===e&&(lt&r)===r&&(Dt===4||Dt===3&&(lt&62914560)===lt&&300>qe()-Ii?(dt&2)===0&&kr(e,0):qi|=r,Sr===lt&&(Sr=0)),ha(e)}function Rp(e,t){t===0&&(t=aa()),e=ir(e,t),e!==null&&(fn(e,t),ha(e))}function xv(e){var t=e.memoizedState,r=0;t!==null&&(r=t.retryLane),Rp(e,r)}function wv(e,t){var r=0;switch(e.tag){case 13:var s=e.stateNode,p=e.memoizedState;p!==null&&(r=p.retryLane);break;case 19:s=e.stateNode;break;case 22:s=e.stateNode._retryCache;break;default:throw Error(c(314))}s!==null&&s.delete(t),Rp(e,r)}function Cv(e,t){return Ve(e,t)}var zs=null,Rr=null,Vi=!1,Vs=!1,Bi=!1,zo=0;function ha(e){e!==Rr&&e.next===null&&(Rr===null?zs=Rr=e:Rr=Rr.next=e),Vs=!0,Vi||(Vi=!0,Sv())}function Nl(e,t){if(!Bi&&Vs){Bi=!0;do for(var r=!1,s=zs;s!==null;){if(e!==0){var p=s.pendingLanes;if(p===0)var g=0;else{var D=s.suspendedLanes,M=s.pingedLanes;g=(1<<31-wt(42|e)+1)-1,g&=p&~(D&~M),g=g&201326741?g&201326741|1:g?g|2:0}g!==0&&(r=!0,Fp(s,g))}else g=lt,g=tn(s,s===gt?g:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),(g&3)===0||xn(s,g)||(r=!0,Fp(s,g));s=s.next}while(r);Bi=!1}}function bv(){Ap()}function Ap(){Vs=Vi=!1;var e=0;zo!==0&&(Dv()&&(e=zo),zo=0);for(var t=qe(),r=null,s=zs;s!==null;){var p=s.next,g=Tp(s,t);g===0?(s.next=null,r===null?zs=p:r.next=p,p===null&&(Rr=r)):(r=s,(e!==0||(g&3)!==0)&&(Vs=!0)),s=p}Nl(e)}function Tp(e,t){for(var r=e.suspendedLanes,s=e.pingedLanes,p=e.expirationTimes,g=e.pendingLanes&-62914561;0<g;){var D=31-wt(g),M=1<<D,te=p[D];te===-1?((M&r)===0||(M&s)!==0)&&(p[D]=va(M,t)):te<=t&&(e.expiredLanes|=M),g&=~M}if(t=gt,r=lt,r=tn(e,e===t?r:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),s=e.callbackNode,r===0||e===t&&(ut===2||ut===9)||e.cancelPendingCommit!==null)return s!==null&&s!==null&&Le(s),e.callbackNode=null,e.callbackPriority=0;if((r&3)===0||xn(e,r)){if(t=r&-r,t===e.callbackPriority)return t;switch(s!==null&&Le(s),Wn(r)){case 2:case 8:r=He;break;case 32:r=$e;break;case 268435456:r=ot;break;default:r=$e}return s=Dp.bind(null,e),r=Ve(r,s),e.callbackPriority=t,e.callbackNode=r,t}return s!==null&&s!==null&&Le(s),e.callbackPriority=2,e.callbackNode=null,2}function Dp(e,t){if(Kt!==0&&Kt!==5)return e.callbackNode=null,e.callbackPriority=0,null;var r=e.callbackNode;if(Hs()&&e.callbackNode!==r)return null;var s=lt;return s=tn(e,e===gt?s:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),s===0?null:(hp(e,s,t),Tp(e,qe()),e.callbackNode!=null&&e.callbackNode===r?Dp.bind(null,e):null)}function Fp(e,t){if(Hs())return null;hp(e,t,!0)}function Sv(){qv(function(){(dt&6)!==0?Ve(Ft,bv):Ap()})}function Yi(){return zo===0&&(zo=na()),zo}function qp(e){return e==null||typeof e=="symbol"||typeof e=="boolean"?null:typeof e=="function"?e:jo(""+e)}function $p(e,t){var r=t.ownerDocument.createElement("input");return r.name=t.name,r.value=t.value,e.id&&r.setAttribute("form",e.id),t.parentNode.insertBefore(r,t),e=new FormData(e),r.parentNode.removeChild(r),e}function Ev(e,t,r,s,p){if(t==="submit"&&r&&r.stateNode===p){var g=qp((p[At]||null).action),D=s.submitter;D&&(t=(t=D[At]||null)?qp(t.formAction):D.getAttribute("formAction"),t!==null&&(g=t,D=null));var M=new rs("action","action",null,s,p);e.push({event:M,listeners:[{instance:null,listener:function(){if(s.defaultPrevented){if(zo!==0){var te=D?$p(p,D):new FormData(p);fi(r,{pending:!0,data:te,method:p.method,action:g},null,te)}}else typeof g=="function"&&(M.preventDefault(),te=D?$p(p,D):new FormData(p),fi(r,{pending:!0,data:te,method:p.method,action:g},g,te))},currentTarget:p}]})}}for(var Gi=0;Gi<Tc.length;Gi++){var Wi=Tc[Gi],jv=Wi.toLowerCase(),kv=Wi[0].toUpperCase()+Wi.slice(1);Zn(jv,"on"+kv)}Zn(pu,"onAnimationEnd"),Zn(hu,"onAnimationIteration"),Zn(mu,"onAnimationStart"),Zn("dblclick","onDoubleClick"),Zn("focusin","onFocus"),Zn("focusout","onBlur"),Zn(Vg,"onTransitionRun"),Zn(Bg,"onTransitionStart"),Zn(Yg,"onTransitionCancel"),Zn(yu,"onTransitionEnd"),Et("onMouseEnter",["mouseout","mouseover"]),Et("onMouseLeave",["mouseout","mouseover"]),Et("onPointerEnter",["pointerout","pointerover"]),Et("onPointerLeave",["pointerout","pointerover"]),We("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),We("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),We("onBeforeInput",["compositionend","keypress","textInput","paste"]),We("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),We("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),We("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Rl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Nv=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Rl));function Ip(e,t){t=(t&4)!==0;for(var r=0;r<e.length;r++){var s=e[r],p=s.event;s=s.listeners;e:{var g=void 0;if(t)for(var D=s.length-1;0<=D;D--){var M=s[D],te=M.instance,se=M.currentTarget;if(M=M.listener,te!==g&&p.isPropagationStopped())break e;g=M,p.currentTarget=se;try{g(p)}catch(he){Ts(he)}p.currentTarget=null,g=te}else for(D=0;D<s.length;D++){if(M=s[D],te=M.instance,se=M.currentTarget,M=M.listener,te!==g&&p.isPropagationStopped())break e;g=M,p.currentTarget=se;try{g(p)}catch(he){Ts(he)}p.currentTarget=null,g=te}}}}function tt(e,t){var r=t[Ce];r===void 0&&(r=t[Ce]=new Set);var s=e+"__bubble";r.has(s)||(Up(t,e,2,!1),r.add(s))}function Qi(e,t,r){var s=0;t&&(s|=4),Up(r,e,s,t)}var Bs="_reactListening"+Math.random().toString(36).slice(2);function Xi(e){if(!e[Bs]){e[Bs]=!0,xe.forEach(function(r){r!=="selectionchange"&&(Nv.has(r)||Qi(r,!1,e),Qi(r,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[Bs]||(t[Bs]=!0,Qi("selectionchange",!1,t))}}function Up(e,t,r,s){switch(sh(t)){case 2:var p=t_;break;case 8:p=n_;break;default:p=dd}r=p.bind(null,t,r,e),p=void 0,!Va||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(p=!0),s?p!==void 0?e.addEventListener(t,r,{capture:!0,passive:p}):e.addEventListener(t,r,!0):p!==void 0?e.addEventListener(t,r,{passive:p}):e.addEventListener(t,r,!1)}function Zi(e,t,r,s,p){var g=s;if((t&1)===0&&(t&2)===0&&s!==null)e:for(;;){if(s===null)return;var D=s.tag;if(D===3||D===4){var M=s.stateNode.containerInfo;if(M===p)break;if(D===4)for(D=s.return;D!==null;){var te=D.tag;if((te===3||te===4)&&D.stateNode.containerInfo===p)return;D=D.return}for(;M!==null;){if(D=Be(M),D===null)return;if(te=D.tag,te===5||te===6||te===26||te===27){s=g=D;continue e}M=M.parentNode}}s=s.return}ko(function(){var se=g,he=nr(r),ve=[];e:{var ce=gu.get(e);if(ce!==void 0){var ie=rs,Oe=e;switch(e){case"keypress":if(as(r)===0)break e;case"keydown":case"keyup":ie=Cg;break;case"focusin":Oe="focus",ie=Cc;break;case"focusout":Oe="blur",ie=Cc;break;case"beforeblur":case"afterblur":ie=Cc;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ie=Yd;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ie=dg;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ie=Eg;break;case pu:case hu:case mu:ie=pg;break;case yu:ie=kg;break;case"scroll":case"scrollend":ie=cg;break;case"wheel":ie=Rg;break;case"copy":case"cut":case"paste":ie=mg;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ie=Wd;break;case"toggle":case"beforetoggle":ie=Tg}var Ue=(t&4)!==0,ht=!Ue&&(e==="scroll"||e==="scrollend"),oe=Ue?ce!==null?ce+"Capture":null:ce;Ue=[];for(var ne=se,le;ne!==null;){var ge=ne;if(le=ge.stateNode,ge=ge.tag,ge!==5&&ge!==26&&ge!==27||le===null||oe===null||(ge=Se(ne,oe),ge!=null&&Ue.push(Al(ne,ge,le))),ht)break;ne=ne.return}0<Ue.length&&(ce=new ie(ce,Oe,null,r,he),ve.push({event:ce,listeners:Ue}))}}if((t&7)===0){e:{if(ce=e==="mouseover"||e==="pointerover",ie=e==="mouseout"||e==="pointerout",ce&&r!==tr&&(Oe=r.relatedTarget||r.fromElement)&&(Be(Oe)||Oe[ue]))break e;if((ie||ce)&&(ce=he.window===he?he:(ce=he.ownerDocument)?ce.defaultView||ce.parentWindow:window,ie?(Oe=r.relatedTarget||r.toElement,ie=se,Oe=Oe?Be(Oe):null,Oe!==null&&(ht=d(Oe),Ue=Oe.tag,Oe!==ht||Ue!==5&&Ue!==27&&Ue!==6)&&(Oe=null)):(ie=null,Oe=se),ie!==Oe)){if(Ue=Yd,ge="onMouseLeave",oe="onMouseEnter",ne="mouse",(e==="pointerout"||e==="pointerover")&&(Ue=Wd,ge="onPointerLeave",oe="onPointerEnter",ne="pointer"),ht=ie==null?ce:rt(ie),le=Oe==null?ce:rt(Oe),ce=new Ue(ge,ne+"leave",ie,r,he),ce.target=ht,ce.relatedTarget=le,ge=null,Be(he)===se&&(Ue=new Ue(oe,ne+"enter",Oe,r,he),Ue.target=le,Ue.relatedTarget=ht,ge=Ue),ht=ge,ie&&Oe)t:{for(Ue=ie,oe=Oe,ne=0,le=Ue;le;le=Ar(le))ne++;for(le=0,ge=oe;ge;ge=Ar(ge))le++;for(;0<ne-le;)Ue=Ar(Ue),ne--;for(;0<le-ne;)oe=Ar(oe),le--;for(;ne--;){if(Ue===oe||oe!==null&&Ue===oe.alternate)break t;Ue=Ar(Ue),oe=Ar(oe)}Ue=null}else Ue=null;ie!==null&&Pp(ve,ce,ie,Ue,!1),Oe!==null&&ht!==null&&Pp(ve,ht,Oe,Ue,!0)}}e:{if(ce=se?rt(se):window,ie=ce.nodeName&&ce.nodeName.toLowerCase(),ie==="select"||ie==="input"&&ce.type==="file")var Ne=nu;else if(eu(ce))if(au)Ne=Mg;else{Ne=Lg;var Ze=Pg}else ie=ce.nodeName,!ie||ie.toLowerCase()!=="input"||ce.type!=="checkbox"&&ce.type!=="radio"?se&&er(se.elementType)&&(Ne=nu):Ne=Og;if(Ne&&(Ne=Ne(e,se))){tu(ve,Ne,r,he);break e}Ze&&Ze(e,ce,se),e==="focusout"&&se&&ce.type==="number"&&se.memoizedProps.value!=null&&Jo(ce,"number",ce.value)}switch(Ze=se?rt(se):window,e){case"focusin":(eu(Ze)||Ze.contentEditable==="true")&&(lr=Ze,Nc=se,nl=null);break;case"focusout":nl=Nc=lr=null;break;case"mousedown":Rc=!0;break;case"contextmenu":case"mouseup":case"dragend":Rc=!1,uu(ve,r,he);break;case"selectionchange":if(zg)break;case"keydown":case"keyup":uu(ve,r,he)}var Ae;if(Sc)e:{switch(e){case"compositionstart":var Pe="onCompositionStart";break e;case"compositionend":Pe="onCompositionEnd";break e;case"compositionupdate":Pe="onCompositionUpdate";break e}Pe=void 0}else rr?Kd(e,r)&&(Pe="onCompositionEnd"):e==="keydown"&&r.keyCode===229&&(Pe="onCompositionStart");Pe&&(Qd&&r.locale!=="ko"&&(rr||Pe!=="onCompositionStart"?Pe==="onCompositionEnd"&&rr&&(Ae=Vd()):(Sa=he,or="value"in Sa?Sa.value:Sa.textContent,rr=!0)),Ze=Ys(se,Pe),0<Ze.length&&(Pe=new Gd(Pe,e,null,r,he),ve.push({event:Pe,listeners:Ze}),Ae?Pe.data=Ae:(Ae=Jd(r),Ae!==null&&(Pe.data=Ae)))),(Ae=Fg?qg(e,r):$g(e,r))&&(Pe=Ys(se,"onBeforeInput"),0<Pe.length&&(Ze=new Gd("onBeforeInput","beforeinput",null,r,he),ve.push({event:Ze,listeners:Pe}),Ze.data=Ae)),Ev(ve,e,se,r,he)}Ip(ve,t)})}function Al(e,t,r){return{instance:e,listener:t,currentTarget:r}}function Ys(e,t){for(var r=t+"Capture",s=[];e!==null;){var p=e,g=p.stateNode;if(p=p.tag,p!==5&&p!==26&&p!==27||g===null||(p=Se(e,r),p!=null&&s.unshift(Al(e,p,g)),p=Se(e,t),p!=null&&s.push(Al(e,p,g))),e.tag===3)return s;e=e.return}return[]}function Ar(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5&&e.tag!==27);return e||null}function Pp(e,t,r,s,p){for(var g=t._reactName,D=[];r!==null&&r!==s;){var M=r,te=M.alternate,se=M.stateNode;if(M=M.tag,te!==null&&te===s)break;M!==5&&M!==26&&M!==27||se===null||(te=se,p?(se=Se(r,g),se!=null&&D.unshift(Al(r,se,te))):p||(se=Se(r,g),se!=null&&D.push(Al(r,se,te)))),r=r.return}D.length!==0&&e.push({event:t,listeners:D})}var Rv=/\r\n?/g,Av=/\u0000|\uFFFD/g;function Lp(e){return(typeof e=="string"?e:""+e).replace(Rv,`
`).replace(Av,"")}function Op(e,t){return t=Lp(t),Lp(e)===t}function Gs(){}function pt(e,t,r,s,p,g){switch(r){case"children":typeof s=="string"?t==="body"||t==="textarea"&&s===""||wa(e,s):(typeof s=="number"||typeof s=="bigint")&&t!=="body"&&wa(e,""+s);break;case"className":sn(e,"class",s);break;case"tabIndex":sn(e,"tabindex",s);break;case"dir":case"role":case"viewBox":case"width":case"height":sn(e,r,s);break;case"style":Wr(e,s,g);break;case"data":if(t!=="object"){sn(e,"data",s);break}case"src":case"href":if(s===""&&(t!=="a"||r!=="href")){e.removeAttribute(r);break}if(s==null||typeof s=="function"||typeof s=="symbol"||typeof s=="boolean"){e.removeAttribute(r);break}s=jo(""+s),e.setAttribute(r,s);break;case"action":case"formAction":if(typeof s=="function"){e.setAttribute(r,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof g=="function"&&(r==="formAction"?(t!=="input"&&pt(e,t,"name",p.name,p,null),pt(e,t,"formEncType",p.formEncType,p,null),pt(e,t,"formMethod",p.formMethod,p,null),pt(e,t,"formTarget",p.formTarget,p,null)):(pt(e,t,"encType",p.encType,p,null),pt(e,t,"method",p.method,p,null),pt(e,t,"target",p.target,p,null)));if(s==null||typeof s=="symbol"||typeof s=="boolean"){e.removeAttribute(r);break}s=jo(""+s),e.setAttribute(r,s);break;case"onClick":s!=null&&(e.onclick=Gs);break;case"onScroll":s!=null&&tt("scroll",e);break;case"onScrollEnd":s!=null&&tt("scrollend",e);break;case"dangerouslySetInnerHTML":if(s!=null){if(typeof s!="object"||!("__html"in s))throw Error(c(61));if(r=s.__html,r!=null){if(p.children!=null)throw Error(c(60));e.innerHTML=r}}break;case"multiple":e.multiple=s&&typeof s!="function"&&typeof s!="symbol";break;case"muted":e.muted=s&&typeof s!="function"&&typeof s!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(s==null||typeof s=="function"||typeof s=="boolean"||typeof s=="symbol"){e.removeAttribute("xlink:href");break}r=jo(""+s),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",r);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":s!=null&&typeof s!="function"&&typeof s!="symbol"?e.setAttribute(r,""+s):e.removeAttribute(r);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":s&&typeof s!="function"&&typeof s!="symbol"?e.setAttribute(r,""):e.removeAttribute(r);break;case"capture":case"download":s===!0?e.setAttribute(r,""):s!==!1&&s!=null&&typeof s!="function"&&typeof s!="symbol"?e.setAttribute(r,s):e.removeAttribute(r);break;case"cols":case"rows":case"size":case"span":s!=null&&typeof s!="function"&&typeof s!="symbol"&&!isNaN(s)&&1<=s?e.setAttribute(r,s):e.removeAttribute(r);break;case"rowSpan":case"start":s==null||typeof s=="function"||typeof s=="symbol"||isNaN(s)?e.removeAttribute(r):e.setAttribute(r,s);break;case"popover":tt("beforetoggle",e),tt("toggle",e),Fn(e,"popover",s);break;case"xlinkActuate":pn(e,"http://www.w3.org/1999/xlink","xlink:actuate",s);break;case"xlinkArcrole":pn(e,"http://www.w3.org/1999/xlink","xlink:arcrole",s);break;case"xlinkRole":pn(e,"http://www.w3.org/1999/xlink","xlink:role",s);break;case"xlinkShow":pn(e,"http://www.w3.org/1999/xlink","xlink:show",s);break;case"xlinkTitle":pn(e,"http://www.w3.org/1999/xlink","xlink:title",s);break;case"xlinkType":pn(e,"http://www.w3.org/1999/xlink","xlink:type",s);break;case"xmlBase":pn(e,"http://www.w3.org/XML/1998/namespace","xml:base",s);break;case"xmlLang":pn(e,"http://www.w3.org/XML/1998/namespace","xml:lang",s);break;case"xmlSpace":pn(e,"http://www.w3.org/XML/1998/namespace","xml:space",s);break;case"is":Fn(e,"is",s);break;case"innerText":case"textContent":break;default:(!(2<r.length)||r[0]!=="o"&&r[0]!=="O"||r[1]!=="n"&&r[1]!=="N")&&(r=es.get(r)||r,Fn(e,r,s))}}function Ki(e,t,r,s,p,g){switch(r){case"style":Wr(e,s,g);break;case"dangerouslySetInnerHTML":if(s!=null){if(typeof s!="object"||!("__html"in s))throw Error(c(61));if(r=s.__html,r!=null){if(p.children!=null)throw Error(c(60));e.innerHTML=r}}break;case"children":typeof s=="string"?wa(e,s):(typeof s=="number"||typeof s=="bigint")&&wa(e,""+s);break;case"onScroll":s!=null&&tt("scroll",e);break;case"onScrollEnd":s!=null&&tt("scrollend",e);break;case"onClick":s!=null&&(e.onclick=Gs);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!be.hasOwnProperty(r))e:{if(r[0]==="o"&&r[1]==="n"&&(p=r.endsWith("Capture"),t=r.slice(2,p?r.length-7:void 0),g=e[At]||null,g=g!=null?g[r]:null,typeof g=="function"&&e.removeEventListener(t,g,p),typeof s=="function")){typeof g!="function"&&g!==null&&(r in e?e[r]=null:e.hasAttribute(r)&&e.removeAttribute(r)),e.addEventListener(t,s,p);break e}r in e?e[r]=s:s===!0?e.setAttribute(r,""):Fn(e,r,s)}}}function Jt(e,t,r){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":tt("error",e),tt("load",e);var s=!1,p=!1,g;for(g in r)if(r.hasOwnProperty(g)){var D=r[g];if(D!=null)switch(g){case"src":s=!0;break;case"srcSet":p=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(c(137,t));default:pt(e,t,g,D,r,null)}}p&&pt(e,t,"srcSet",r.srcSet,r,null),s&&pt(e,t,"src",r.src,r,null);return;case"input":tt("invalid",e);var M=g=D=p=null,te=null,se=null;for(s in r)if(r.hasOwnProperty(s)){var he=r[s];if(he!=null)switch(s){case"name":p=he;break;case"type":D=he;break;case"checked":te=he;break;case"defaultChecked":se=he;break;case"value":g=he;break;case"defaultValue":M=he;break;case"children":case"dangerouslySetInnerHTML":if(he!=null)throw Error(c(137,t));break;default:pt(e,t,s,he,r,null)}}Vr(e,g,M,te,se,D,p,!1),za(e);return;case"select":tt("invalid",e),s=D=g=null;for(p in r)if(r.hasOwnProperty(p)&&(M=r[p],M!=null))switch(p){case"value":g=M;break;case"defaultValue":D=M;break;case"multiple":s=M;default:pt(e,t,p,M,r,null)}t=g,r=D,e.multiple=!!s,t!=null?xa(e,!!s,t,!1):r!=null&&xa(e,!!s,r,!0);return;case"textarea":tt("invalid",e),g=p=s=null;for(D in r)if(r.hasOwnProperty(D)&&(M=r[D],M!=null))switch(D){case"value":s=M;break;case"defaultValue":p=M;break;case"children":g=M;break;case"dangerouslySetInnerHTML":if(M!=null)throw Error(c(91));break;default:pt(e,t,D,M,r,null)}Yr(e,s,p,g),za(e);return;case"option":for(te in r)if(r.hasOwnProperty(te)&&(s=r[te],s!=null))switch(te){case"selected":e.selected=s&&typeof s!="function"&&typeof s!="symbol";break;default:pt(e,t,te,s,r,null)}return;case"dialog":tt("beforetoggle",e),tt("toggle",e),tt("cancel",e),tt("close",e);break;case"iframe":case"object":tt("load",e);break;case"video":case"audio":for(s=0;s<Rl.length;s++)tt(Rl[s],e);break;case"image":tt("error",e),tt("load",e);break;case"details":tt("toggle",e);break;case"embed":case"source":case"link":tt("error",e),tt("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(se in r)if(r.hasOwnProperty(se)&&(s=r[se],s!=null))switch(se){case"children":case"dangerouslySetInnerHTML":throw Error(c(137,t));default:pt(e,t,se,s,r,null)}return;default:if(er(t)){for(he in r)r.hasOwnProperty(he)&&(s=r[he],s!==void 0&&Ki(e,t,he,s,r,void 0));return}}for(M in r)r.hasOwnProperty(M)&&(s=r[M],s!=null&&pt(e,t,M,s,r,null))}function Tv(e,t,r,s){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var p=null,g=null,D=null,M=null,te=null,se=null,he=null;for(ie in r){var ve=r[ie];if(r.hasOwnProperty(ie)&&ve!=null)switch(ie){case"checked":break;case"value":break;case"defaultValue":te=ve;default:s.hasOwnProperty(ie)||pt(e,t,ie,null,s,ve)}}for(var ce in s){var ie=s[ce];if(ve=r[ce],s.hasOwnProperty(ce)&&(ie!=null||ve!=null))switch(ce){case"type":g=ie;break;case"name":p=ie;break;case"checked":se=ie;break;case"defaultChecked":he=ie;break;case"value":D=ie;break;case"defaultValue":M=ie;break;case"children":case"dangerouslySetInnerHTML":if(ie!=null)throw Error(c(137,t));break;default:ie!==ve&&pt(e,t,ce,ie,s,ve)}}Ko(e,D,M,te,se,he,g,p);return;case"select":ie=D=M=ce=null;for(g in r)if(te=r[g],r.hasOwnProperty(g)&&te!=null)switch(g){case"value":break;case"multiple":ie=te;default:s.hasOwnProperty(g)||pt(e,t,g,null,s,te)}for(p in s)if(g=s[p],te=r[p],s.hasOwnProperty(p)&&(g!=null||te!=null))switch(p){case"value":ce=g;break;case"defaultValue":M=g;break;case"multiple":D=g;default:g!==te&&pt(e,t,p,g,s,te)}t=M,r=D,s=ie,ce!=null?xa(e,!!r,ce,!1):!!s!=!!r&&(t!=null?xa(e,!!r,t,!0):xa(e,!!r,r?[]:"",!1));return;case"textarea":ie=ce=null;for(M in r)if(p=r[M],r.hasOwnProperty(M)&&p!=null&&!s.hasOwnProperty(M))switch(M){case"value":break;case"children":break;default:pt(e,t,M,null,s,p)}for(D in s)if(p=s[D],g=r[D],s.hasOwnProperty(D)&&(p!=null||g!=null))switch(D){case"value":ce=p;break;case"defaultValue":ie=p;break;case"children":break;case"dangerouslySetInnerHTML":if(p!=null)throw Error(c(91));break;default:p!==g&&pt(e,t,D,p,s,g)}Br(e,ce,ie);return;case"option":for(var Oe in r)if(ce=r[Oe],r.hasOwnProperty(Oe)&&ce!=null&&!s.hasOwnProperty(Oe))switch(Oe){case"selected":e.selected=!1;break;default:pt(e,t,Oe,null,s,ce)}for(te in s)if(ce=s[te],ie=r[te],s.hasOwnProperty(te)&&ce!==ie&&(ce!=null||ie!=null))switch(te){case"selected":e.selected=ce&&typeof ce!="function"&&typeof ce!="symbol";break;default:pt(e,t,te,ce,s,ie)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Ue in r)ce=r[Ue],r.hasOwnProperty(Ue)&&ce!=null&&!s.hasOwnProperty(Ue)&&pt(e,t,Ue,null,s,ce);for(se in s)if(ce=s[se],ie=r[se],s.hasOwnProperty(se)&&ce!==ie&&(ce!=null||ie!=null))switch(se){case"children":case"dangerouslySetInnerHTML":if(ce!=null)throw Error(c(137,t));break;default:pt(e,t,se,ce,s,ie)}return;default:if(er(t)){for(var ht in r)ce=r[ht],r.hasOwnProperty(ht)&&ce!==void 0&&!s.hasOwnProperty(ht)&&Ki(e,t,ht,void 0,s,ce);for(he in s)ce=s[he],ie=r[he],!s.hasOwnProperty(he)||ce===ie||ce===void 0&&ie===void 0||Ki(e,t,he,ce,s,ie);return}}for(var oe in r)ce=r[oe],r.hasOwnProperty(oe)&&ce!=null&&!s.hasOwnProperty(oe)&&pt(e,t,oe,null,s,ce);for(ve in s)ce=s[ve],ie=r[ve],!s.hasOwnProperty(ve)||ce===ie||ce==null&&ie==null||pt(e,t,ve,ce,s,ie)}var Ji=null,ed=null;function Ws(e){return e.nodeType===9?e:e.ownerDocument}function Mp(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Hp(e,t){if(e===0)switch(t){case"svg":return 1;case"math":return 2;default:return 0}return e===1&&t==="foreignObject"?0:e}function td(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.children=="bigint"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var nd=null;function Dv(){var e=window.event;return e&&e.type==="popstate"?e===nd?!1:(nd=e,!0):(nd=null,!1)}var zp=typeof setTimeout=="function"?setTimeout:void 0,Fv=typeof clearTimeout=="function"?clearTimeout:void 0,Vp=typeof Promise=="function"?Promise:void 0,qv=typeof queueMicrotask=="function"?queueMicrotask:typeof Vp<"u"?function(e){return Vp.resolve(null).then(e).catch($v)}:zp;function $v(e){setTimeout(function(){throw e})}function so(e){return e==="head"}function Bp(e,t){var r=t,s=0,p=0;do{var g=r.nextSibling;if(e.removeChild(r),g&&g.nodeType===8)if(r=g.data,r==="/$"){if(0<s&&8>s){r=s;var D=e.ownerDocument;if(r&1&&Tl(D.documentElement),r&2&&Tl(D.body),r&4)for(r=D.head,Tl(r),D=r.firstChild;D;){var M=D.nextSibling,te=D.nodeName;D[ze]||te==="SCRIPT"||te==="STYLE"||te==="LINK"&&D.rel.toLowerCase()==="stylesheet"||r.removeChild(D),D=M}}if(p===0){e.removeChild(g),Ll(t);return}p--}else r==="$"||r==="$?"||r==="$!"?p++:s=r.charCodeAt(0)-48;else s=0;r=g}while(r);Ll(t)}function ad(e){var t=e.firstChild;for(t&&t.nodeType===10&&(t=t.nextSibling);t;){var r=t;switch(t=t.nextSibling,r.nodeName){case"HTML":case"HEAD":case"BODY":ad(r),Je(r);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(r.rel.toLowerCase()==="stylesheet")continue}e.removeChild(r)}}function Iv(e,t,r,s){for(;e.nodeType===1;){var p=r;if(e.nodeName.toLowerCase()!==t.toLowerCase()){if(!s&&(e.nodeName!=="INPUT"||e.type!=="hidden"))break}else if(s){if(!e[ze])switch(t){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if(g=e.getAttribute("rel"),g==="stylesheet"&&e.hasAttribute("data-precedence"))break;if(g!==p.rel||e.getAttribute("href")!==(p.href==null||p.href===""?null:p.href)||e.getAttribute("crossorigin")!==(p.crossOrigin==null?null:p.crossOrigin)||e.getAttribute("title")!==(p.title==null?null:p.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(g=e.getAttribute("src"),(g!==(p.src==null?null:p.src)||e.getAttribute("type")!==(p.type==null?null:p.type)||e.getAttribute("crossorigin")!==(p.crossOrigin==null?null:p.crossOrigin))&&g&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else if(t==="input"&&e.type==="hidden"){var g=p.name==null?null:""+p.name;if(p.type==="hidden"&&e.getAttribute("name")===g)return e}else return e;if(e=Jn(e.nextSibling),e===null)break}return null}function Uv(e,t,r){if(t==="")return null;for(;e.nodeType!==3;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!r||(e=Jn(e.nextSibling),e===null))return null;return e}function od(e){return e.data==="$!"||e.data==="$?"&&e.ownerDocument.readyState==="complete"}function Pv(e,t){var r=e.ownerDocument;if(e.data!=="$?"||r.readyState==="complete")t();else{var s=function(){t(),r.removeEventListener("DOMContentLoaded",s)};r.addEventListener("DOMContentLoaded",s),e._reactRetry=s}}function Jn(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?"||t==="F!"||t==="F")break;if(t==="/$")return null}}return e}var rd=null;function Yp(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="$"||r==="$!"||r==="$?"){if(t===0)return e;t--}else r==="/$"&&t++}e=e.previousSibling}return null}function Gp(e,t,r){switch(t=Ws(r),e){case"html":if(e=t.documentElement,!e)throw Error(c(452));return e;case"head":if(e=t.head,!e)throw Error(c(453));return e;case"body":if(e=t.body,!e)throw Error(c(454));return e;default:throw Error(c(451))}}function Tl(e){for(var t=e.attributes;t.length;)e.removeAttributeNode(t[0]);Je(e)}var On=new Map,Wp=new Set;function Qs(e){return typeof e.getRootNode=="function"?e.getRootNode():e.nodeType===9?e:e.ownerDocument}var Ua=q.d;q.d={f:Lv,r:Ov,D:Mv,C:Hv,L:zv,m:Vv,X:Yv,S:Bv,M:Gv};function Lv(){var e=Ua.f(),t=Os();return e||t}function Ov(e){var t=Fe(e);t!==null&&t.tag===5&&t.type==="form"?hf(t):Ua.r(e)}var Tr=typeof document>"u"?null:document;function Qp(e,t,r){var s=Tr;if(s&&typeof t=="string"&&t){var p=cn(t);p='link[rel="'+e+'"][href="'+p+'"]',typeof r=="string"&&(p+='[crossorigin="'+r+'"]'),Wp.has(p)||(Wp.add(p),e={rel:e,crossOrigin:r,href:t},s.querySelector(p)===null&&(t=s.createElement("link"),Jt(t,"link",e),me(t),s.head.appendChild(t)))}}function Mv(e){Ua.D(e),Qp("dns-prefetch",e,null)}function Hv(e,t){Ua.C(e,t),Qp("preconnect",e,t)}function zv(e,t,r){Ua.L(e,t,r);var s=Tr;if(s&&e&&t){var p='link[rel="preload"][as="'+cn(t)+'"]';t==="image"&&r&&r.imageSrcSet?(p+='[imagesrcset="'+cn(r.imageSrcSet)+'"]',typeof r.imageSizes=="string"&&(p+='[imagesizes="'+cn(r.imageSizes)+'"]')):p+='[href="'+cn(e)+'"]';var g=p;switch(t){case"style":g=Dr(e);break;case"script":g=Fr(e)}On.has(g)||(e=y({rel:"preload",href:t==="image"&&r&&r.imageSrcSet?void 0:e,as:t},r),On.set(g,e),s.querySelector(p)!==null||t==="style"&&s.querySelector(Dl(g))||t==="script"&&s.querySelector(Fl(g))||(t=s.createElement("link"),Jt(t,"link",e),me(t),s.head.appendChild(t)))}}function Vv(e,t){Ua.m(e,t);var r=Tr;if(r&&e){var s=t&&typeof t.as=="string"?t.as:"script",p='link[rel="modulepreload"][as="'+cn(s)+'"][href="'+cn(e)+'"]',g=p;switch(s){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":g=Fr(e)}if(!On.has(g)&&(e=y({rel:"modulepreload",href:e},t),On.set(g,e),r.querySelector(p)===null)){switch(s){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(r.querySelector(Fl(g)))return}s=r.createElement("link"),Jt(s,"link",e),me(s),r.head.appendChild(s)}}}function Bv(e,t,r){Ua.S(e,t,r);var s=Tr;if(s&&e){var p=Qt(s).hoistableStyles,g=Dr(e);t=t||"default";var D=p.get(g);if(!D){var M={loading:0,preload:null};if(D=s.querySelector(Dl(g)))M.loading=5;else{e=y({rel:"stylesheet",href:e,"data-precedence":t},r),(r=On.get(g))&&ld(e,r);var te=D=s.createElement("link");me(te),Jt(te,"link",e),te._p=new Promise(function(se,he){te.onload=se,te.onerror=he}),te.addEventListener("load",function(){M.loading|=1}),te.addEventListener("error",function(){M.loading|=2}),M.loading|=4,Xs(D,t,s)}D={type:"stylesheet",instance:D,count:1,state:M},p.set(g,D)}}}function Yv(e,t){Ua.X(e,t);var r=Tr;if(r&&e){var s=Qt(r).hoistableScripts,p=Fr(e),g=s.get(p);g||(g=r.querySelector(Fl(p)),g||(e=y({src:e,async:!0},t),(t=On.get(p))&&sd(e,t),g=r.createElement("script"),me(g),Jt(g,"link",e),r.head.appendChild(g)),g={type:"script",instance:g,count:1,state:null},s.set(p,g))}}function Gv(e,t){Ua.M(e,t);var r=Tr;if(r&&e){var s=Qt(r).hoistableScripts,p=Fr(e),g=s.get(p);g||(g=r.querySelector(Fl(p)),g||(e=y({src:e,async:!0,type:"module"},t),(t=On.get(p))&&sd(e,t),g=r.createElement("script"),me(g),Jt(g,"link",e),r.head.appendChild(g)),g={type:"script",instance:g,count:1,state:null},s.set(p,g))}}function Xp(e,t,r,s){var p=(p=ee.current)?Qs(p):null;if(!p)throw Error(c(446));switch(e){case"meta":case"title":return null;case"style":return typeof r.precedence=="string"&&typeof r.href=="string"?(t=Dr(r.href),r=Qt(p).hoistableStyles,s=r.get(t),s||(s={type:"style",instance:null,count:0,state:null},r.set(t,s)),s):{type:"void",instance:null,count:0,state:null};case"link":if(r.rel==="stylesheet"&&typeof r.href=="string"&&typeof r.precedence=="string"){e=Dr(r.href);var g=Qt(p).hoistableStyles,D=g.get(e);if(D||(p=p.ownerDocument||p,D={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},g.set(e,D),(g=p.querySelector(Dl(e)))&&!g._p&&(D.instance=g,D.state.loading=5),On.has(e)||(r={rel:"preload",as:"style",href:r.href,crossOrigin:r.crossOrigin,integrity:r.integrity,media:r.media,hrefLang:r.hrefLang,referrerPolicy:r.referrerPolicy},On.set(e,r),g||Wv(p,e,r,D.state))),t&&s===null)throw Error(c(528,""));return D}if(t&&s!==null)throw Error(c(529,""));return null;case"script":return t=r.async,r=r.src,typeof r=="string"&&t&&typeof t!="function"&&typeof t!="symbol"?(t=Fr(r),r=Qt(p).hoistableScripts,s=r.get(t),s||(s={type:"script",instance:null,count:0,state:null},r.set(t,s)),s):{type:"void",instance:null,count:0,state:null};default:throw Error(c(444,e))}}function Dr(e){return'href="'+cn(e)+'"'}function Dl(e){return'link[rel="stylesheet"]['+e+"]"}function Zp(e){return y({},e,{"data-precedence":e.precedence,precedence:null})}function Wv(e,t,r,s){e.querySelector('link[rel="preload"][as="style"]['+t+"]")?s.loading=1:(t=e.createElement("link"),s.preload=t,t.addEventListener("load",function(){return s.loading|=1}),t.addEventListener("error",function(){return s.loading|=2}),Jt(t,"link",r),me(t),e.head.appendChild(t))}function Fr(e){return'[src="'+cn(e)+'"]'}function Fl(e){return"script[async]"+e}function Kp(e,t,r){if(t.count++,t.instance===null)switch(t.type){case"style":var s=e.querySelector('style[data-href~="'+cn(r.href)+'"]');if(s)return t.instance=s,me(s),s;var p=y({},r,{"data-href":r.href,"data-precedence":r.precedence,href:null,precedence:null});return s=(e.ownerDocument||e).createElement("style"),me(s),Jt(s,"style",p),Xs(s,r.precedence,e),t.instance=s;case"stylesheet":p=Dr(r.href);var g=e.querySelector(Dl(p));if(g)return t.state.loading|=4,t.instance=g,me(g),g;s=Zp(r),(p=On.get(p))&&ld(s,p),g=(e.ownerDocument||e).createElement("link"),me(g);var D=g;return D._p=new Promise(function(M,te){D.onload=M,D.onerror=te}),Jt(g,"link",s),t.state.loading|=4,Xs(g,r.precedence,e),t.instance=g;case"script":return g=Fr(r.src),(p=e.querySelector(Fl(g)))?(t.instance=p,me(p),p):(s=r,(p=On.get(g))&&(s=y({},r),sd(s,p)),e=e.ownerDocument||e,p=e.createElement("script"),me(p),Jt(p,"link",s),e.head.appendChild(p),t.instance=p);case"void":return null;default:throw Error(c(443,t.type))}else t.type==="stylesheet"&&(t.state.loading&4)===0&&(s=t.instance,t.state.loading|=4,Xs(s,r.precedence,e));return t.instance}function Xs(e,t,r){for(var s=r.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),p=s.length?s[s.length-1]:null,g=p,D=0;D<s.length;D++){var M=s[D];if(M.dataset.precedence===t)g=M;else if(g!==p)break}g?g.parentNode.insertBefore(e,g.nextSibling):(t=r.nodeType===9?r.head:r,t.insertBefore(e,t.firstChild))}function ld(e,t){e.crossOrigin==null&&(e.crossOrigin=t.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=t.referrerPolicy),e.title==null&&(e.title=t.title)}function sd(e,t){e.crossOrigin==null&&(e.crossOrigin=t.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=t.referrerPolicy),e.integrity==null&&(e.integrity=t.integrity)}var Zs=null;function Jp(e,t,r){if(Zs===null){var s=new Map,p=Zs=new Map;p.set(r,s)}else p=Zs,s=p.get(r),s||(s=new Map,p.set(r,s));if(s.has(e))return s;for(s.set(e,null),r=r.getElementsByTagName(e),p=0;p<r.length;p++){var g=r[p];if(!(g[ze]||g[St]||e==="link"&&g.getAttribute("rel")==="stylesheet")&&g.namespaceURI!=="http://www.w3.org/2000/svg"){var D=g.getAttribute(t)||"";D=e+D;var M=s.get(D);M?M.push(g):s.set(D,[g])}}return s}function eh(e,t,r){e=e.ownerDocument||e,e.head.insertBefore(r,t==="title"?e.querySelector("head > title"):null)}function Qv(e,t,r){if(r===1||t.itemProp!=null)return!1;switch(e){case"meta":case"title":return!0;case"style":if(typeof t.precedence!="string"||typeof t.href!="string"||t.href==="")break;return!0;case"link":if(typeof t.rel!="string"||typeof t.href!="string"||t.href===""||t.onLoad||t.onError)break;switch(t.rel){case"stylesheet":return e=t.disabled,typeof t.precedence=="string"&&e==null;default:return!0}case"script":if(t.async&&typeof t.async!="function"&&typeof t.async!="symbol"&&!t.onLoad&&!t.onError&&t.src&&typeof t.src=="string")return!0}return!1}function th(e){return!(e.type==="stylesheet"&&(e.state.loading&3)===0)}var ql=null;function Xv(){}function Zv(e,t,r){if(ql===null)throw Error(c(475));var s=ql;if(t.type==="stylesheet"&&(typeof r.media!="string"||matchMedia(r.media).matches!==!1)&&(t.state.loading&4)===0){if(t.instance===null){var p=Dr(r.href),g=e.querySelector(Dl(p));if(g){e=g._p,e!==null&&typeof e=="object"&&typeof e.then=="function"&&(s.count++,s=Ks.bind(s),e.then(s,s)),t.state.loading|=4,t.instance=g,me(g);return}g=e.ownerDocument||e,r=Zp(r),(p=On.get(p))&&ld(r,p),g=g.createElement("link"),me(g);var D=g;D._p=new Promise(function(M,te){D.onload=M,D.onerror=te}),Jt(g,"link",r),t.instance=g}s.stylesheets===null&&(s.stylesheets=new Map),s.stylesheets.set(t,e),(e=t.state.preload)&&(t.state.loading&3)===0&&(s.count++,t=Ks.bind(s),e.addEventListener("load",t),e.addEventListener("error",t))}}function Kv(){if(ql===null)throw Error(c(475));var e=ql;return e.stylesheets&&e.count===0&&cd(e,e.stylesheets),0<e.count?function(t){var r=setTimeout(function(){if(e.stylesheets&&cd(e,e.stylesheets),e.unsuspend){var s=e.unsuspend;e.unsuspend=null,s()}},6e4);return e.unsuspend=t,function(){e.unsuspend=null,clearTimeout(r)}}:null}function Ks(){if(this.count--,this.count===0){if(this.stylesheets)cd(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}}var Js=null;function cd(e,t){e.stylesheets=null,e.unsuspend!==null&&(e.count++,Js=new Map,t.forEach(Jv,e),Js=null,Ks.call(e))}function Jv(e,t){if(!(t.state.loading&4)){var r=Js.get(e);if(r)var s=r.get(null);else{r=new Map,Js.set(e,r);for(var p=e.querySelectorAll("link[data-precedence],style[data-precedence]"),g=0;g<p.length;g++){var D=p[g];(D.nodeName==="LINK"||D.getAttribute("media")!=="not all")&&(r.set(D.dataset.precedence,D),s=D)}s&&r.set(null,s)}p=t.instance,D=p.getAttribute("data-precedence"),g=r.get(D)||s,g===s&&r.set(null,p),r.set(D,p),this.count++,s=Ks.bind(this),p.addEventListener("load",s),p.addEventListener("error",s),g?g.parentNode.insertBefore(p,g.nextSibling):(e=e.nodeType===9?e.head:e,e.insertBefore(p,e.firstChild)),t.state.loading|=4}}var $l={$$typeof:j,Provider:null,Consumer:null,_currentValue:Y,_currentValue2:Y,_threadCount:0};function e_(e,t,r,s,p,g,D,M){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Bn(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Bn(0),this.hiddenUpdates=Bn(null),this.identifierPrefix=s,this.onUncaughtError=p,this.onCaughtError=g,this.onRecoverableError=D,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=M,this.incompleteTransitions=new Map}function nh(e,t,r,s,p,g,D,M,te,se,he,ve){return e=new e_(e,t,r,D,M,te,se,ve),t=1,g===!0&&(t|=24),g=Cn(3,null,null,t),e.current=g,g.stateNode=e,t=zc(),t.refCount++,e.pooledCache=t,t.refCount++,g.memoizedState={element:s,isDehydrated:r,cache:t},Gc(g),e}function ah(e){return e?(e=dr,e):dr}function oh(e,t,r,s,p,g){p=ah(p),s.context===null?s.context=p:s.pendingContext=p,s=Wa(t),s.payload={element:r},g=g===void 0?null:g,g!==null&&(s.callback=g),r=Qa(e,s,t),r!==null&&(kn(r,e,t),ul(r,e,t))}function rh(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var r=e.retryLane;e.retryLane=r!==0&&r<t?r:t}}function id(e,t){rh(e,t),(e=e.alternate)&&rh(e,t)}function lh(e){if(e.tag===13){var t=ir(e,67108864);t!==null&&kn(t,e,67108864),id(e,67108864)}}var ec=!0;function t_(e,t,r,s){var p=T.T;T.T=null;var g=q.p;try{q.p=2,dd(e,t,r,s)}finally{q.p=g,T.T=p}}function n_(e,t,r,s){var p=T.T;T.T=null;var g=q.p;try{q.p=8,dd(e,t,r,s)}finally{q.p=g,T.T=p}}function dd(e,t,r,s){if(ec){var p=ud(s);if(p===null)Zi(e,t,s,tc,r),ch(e,s);else if(o_(p,e,t,r,s))s.stopPropagation();else if(ch(e,s),t&4&&-1<a_.indexOf(e)){for(;p!==null;){var g=Fe(p);if(g!==null)switch(g.tag){case 3:if(g=g.stateNode,g.current.memoizedState.isDehydrated){var D=qt(g.pendingLanes);if(D!==0){var M=g;for(M.pendingLanes|=2,M.entangledLanes|=2;D;){var te=1<<31-wt(D);M.entanglements[1]|=te,D&=~te}ha(g),(dt&6)===0&&(Ps=qe()+500,Nl(0))}}break;case 13:M=ir(g,2),M!==null&&kn(M,g,2),Os(),id(g,2)}if(g=ud(s),g===null&&Zi(e,t,s,tc,r),g===p)break;p=g}p!==null&&s.stopPropagation()}else Zi(e,t,s,null,r)}}function ud(e){return e=nr(e),fd(e)}var tc=null;function fd(e){if(tc=null,e=Be(e),e!==null){var t=d(e);if(t===null)e=null;else{var r=t.tag;if(r===13){if(e=u(t),e!==null)return e;e=null}else if(r===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null)}}return tc=e,null}function sh(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(_t()){case Ft:return 2;case He:return 8;case $e:case nt:return 32;case ot:return 268435456;default:return 32}default:return 32}}var pd=!1,co=null,io=null,uo=null,Il=new Map,Ul=new Map,fo=[],a_="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function ch(e,t){switch(e){case"focusin":case"focusout":co=null;break;case"dragenter":case"dragleave":io=null;break;case"mouseover":case"mouseout":uo=null;break;case"pointerover":case"pointerout":Il.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ul.delete(t.pointerId)}}function Pl(e,t,r,s,p,g){return e===null||e.nativeEvent!==g?(e={blockedOn:t,domEventName:r,eventSystemFlags:s,nativeEvent:g,targetContainers:[p]},t!==null&&(t=Fe(t),t!==null&&lh(t)),e):(e.eventSystemFlags|=s,t=e.targetContainers,p!==null&&t.indexOf(p)===-1&&t.push(p),e)}function o_(e,t,r,s,p){switch(t){case"focusin":return co=Pl(co,e,t,r,s,p),!0;case"dragenter":return io=Pl(io,e,t,r,s,p),!0;case"mouseover":return uo=Pl(uo,e,t,r,s,p),!0;case"pointerover":var g=p.pointerId;return Il.set(g,Pl(Il.get(g)||null,e,t,r,s,p)),!0;case"gotpointercapture":return g=p.pointerId,Ul.set(g,Pl(Ul.get(g)||null,e,t,r,s,p)),!0}return!1}function ih(e){var t=Be(e.target);if(t!==null){var r=d(t);if(r!==null){if(t=r.tag,t===13){if(t=u(r),t!==null){e.blockedOn=t,sa(e.priority,function(){if(r.tag===13){var s=jn();s=Gn(s);var p=ir(r,s);p!==null&&kn(p,r,s),id(r,s)}});return}}else if(t===3&&r.stateNode.current.memoizedState.isDehydrated){e.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}e.blockedOn=null}function nc(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var r=ud(e.nativeEvent);if(r===null){r=e.nativeEvent;var s=new r.constructor(r.type,r);tr=s,r.target.dispatchEvent(s),tr=null}else return t=Fe(r),t!==null&&lh(t),e.blockedOn=r,!1;t.shift()}return!0}function dh(e,t,r){nc(e)&&r.delete(t)}function r_(){pd=!1,co!==null&&nc(co)&&(co=null),io!==null&&nc(io)&&(io=null),uo!==null&&nc(uo)&&(uo=null),Il.forEach(dh),Ul.forEach(dh)}function ac(e,t){e.blockedOn===t&&(e.blockedOn=null,pd||(pd=!0,a.unstable_scheduleCallback(a.unstable_NormalPriority,r_)))}var oc=null;function uh(e){oc!==e&&(oc=e,a.unstable_scheduleCallback(a.unstable_NormalPriority,function(){oc===e&&(oc=null);for(var t=0;t<e.length;t+=3){var r=e[t],s=e[t+1],p=e[t+2];if(typeof s!="function"){if(fd(s||r)===null)continue;break}var g=Fe(r);g!==null&&(e.splice(t,3),t-=3,fi(g,{pending:!0,data:p,method:r.method,action:s},s,p))}}))}function Ll(e){function t(te){return ac(te,e)}co!==null&&ac(co,e),io!==null&&ac(io,e),uo!==null&&ac(uo,e),Il.forEach(t),Ul.forEach(t);for(var r=0;r<fo.length;r++){var s=fo[r];s.blockedOn===e&&(s.blockedOn=null)}for(;0<fo.length&&(r=fo[0],r.blockedOn===null);)ih(r),r.blockedOn===null&&fo.shift();if(r=(e.ownerDocument||e).$$reactFormReplay,r!=null)for(s=0;s<r.length;s+=3){var p=r[s],g=r[s+1],D=p[At]||null;if(typeof g=="function")D||uh(r);else if(D){var M=null;if(g&&g.hasAttribute("formAction")){if(p=g,D=g[At]||null)M=D.formAction;else if(fd(p)!==null)continue}else M=D.action;typeof M=="function"?r[s+1]=M:(r.splice(s,3),s-=3),uh(r)}}}function hd(e){this._internalRoot=e}rc.prototype.render=hd.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(c(409));var r=t.current,s=jn();oh(r,s,e,t,null,null)},rc.prototype.unmount=hd.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;oh(e.current,2,null,e,null,null),Os(),t[ue]=null}};function rc(e){this._internalRoot=e}rc.prototype.unstable_scheduleHydration=function(e){if(e){var t=la();e={blockedOn:null,target:e,priority:t};for(var r=0;r<fo.length&&t!==0&&t<fo[r].priority;r++);fo.splice(r,0,e),r===0&&ih(e)}};var fh=n.version;if(fh!=="19.1.1")throw Error(c(527,fh,"19.1.1"));q.findDOMNode=function(e){var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(c(188)):(e=Object.keys(e).join(","),Error(c(268,e)));return e=f(t),e=e!==null?m(e):null,e=e===null?null:e.stateNode,e};var l_={bundleType:0,version:"19.1.1",rendererPackageName:"react-dom",currentDispatcherRef:T,reconcilerVersion:"19.1.1"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var lc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!lc.isDisabled&&lc.supportsFiber)try{xt=lc.inject(l_),yt=lc}catch{}}return Ml.createRoot=function(e,t){if(!i(e))throw Error(c(299));var r=!1,s="",p=Nf,g=Rf,D=Af,M=null;return t!=null&&(t.unstable_strictMode===!0&&(r=!0),t.identifierPrefix!==void 0&&(s=t.identifierPrefix),t.onUncaughtError!==void 0&&(p=t.onUncaughtError),t.onCaughtError!==void 0&&(g=t.onCaughtError),t.onRecoverableError!==void 0&&(D=t.onRecoverableError),t.unstable_transitionCallbacks!==void 0&&(M=t.unstable_transitionCallbacks)),t=nh(e,1,!1,null,null,r,s,p,g,D,M,null),e[ue]=t.current,Xi(e),new hd(t)},Ml.hydrateRoot=function(e,t,r){if(!i(e))throw Error(c(299));var s=!1,p="",g=Nf,D=Rf,M=Af,te=null,se=null;return r!=null&&(r.unstable_strictMode===!0&&(s=!0),r.identifierPrefix!==void 0&&(p=r.identifierPrefix),r.onUncaughtError!==void 0&&(g=r.onUncaughtError),r.onCaughtError!==void 0&&(D=r.onCaughtError),r.onRecoverableError!==void 0&&(M=r.onRecoverableError),r.unstable_transitionCallbacks!==void 0&&(te=r.unstable_transitionCallbacks),r.formState!==void 0&&(se=r.formState)),t=nh(e,1,!0,t,r??null,s,p,g,D,M,te,se),t.context=ah(null),r=t.current,s=jn(),s=Gn(s),p=Wa(s),p.callback=null,Qa(r,p,s),r=s,t.current.lanes=r,fn(t,r),ha(t),e[ue]=t.current,Xi(e),new rc(t)},Ml.version="19.1.1",Ml}var Ch;function y_(){if(Ch)return yd.exports;Ch=1;function a(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(a)}catch(n){console.error(n)}}return a(),yd.exports=m_(),yd.exports}var g_=y_(),re=Id();/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const kt=({card:a,onPointerDown:n,onPointerEnter:l,onPointerLeave:c,isFaceUp:i,faceDownValue:d=2,isSelected:u,isMultiSelected:h,isTargetable:f,isSourceOfEffect:m,style:y,additionalClassName:v,animationState:_})=>{const w=({content:U,className:Q})=>o.jsx("div",{className:`card-rule-box ${Q||""}`,dangerouslySetInnerHTML:{__html:U}}),N=(_==null?void 0:_.type)==="playCard"&&_.cardId===a.id?`is-entering-${_.owner}`:"",k=(_==null?void 0:_.type)==="deleteCard"&&_.cardId===a.id?`is-deleting-${_.owner}`:"",C=(_==null?void 0:_.type)==="drawCard"||(_==null?void 0:_.type)==="discardCard"?_.owner:void 0,j=C==="player"&&(_==null?void 0:_.type)==="drawCard"&&_.cardIds.includes(a.id),R=C==="player"&&(_==null?void 0:_.type)==="discardCard"&&_.cardIds.includes(a.id),F=["card-component"];a.protocol&&F.push(`card-protocol-${a.protocol.toLowerCase()}`),a.color&&F.push("has-custom-color"),a.pattern&&F.push(`card-pattern-${a.pattern}`),u&&F.push("selected"),h&&F.push("multi-selected"),R&&F.push("is-discarding"),f&&F.push("is-targetable"),m&&F.push("is-source-of-effect"),N&&F.push(N),k&&F.push(k),j&&F.push("is-drawing"),v&&F.push(v);const L={...y};return a.color&&(L["--card-custom-color"]=a.color),o.jsx("div",{className:F.join(" "),onPointerDown:n,onPointerEnter:l,onPointerLeave:c,role:"button",tabIndex:n?0:-1,style:L,children:o.jsxs("div",{className:`card-inner ${i?"":"is-flipped"}`,children:[o.jsxs("div",{className:"card-face card-front",children:[o.jsxs("div",{className:"card-header",children:[o.jsx("span",{className:`card-protocol ${a.protocol.length<=10?"short-protocol":""}`,children:a.protocol.slice(0,10)}),o.jsx("span",{className:"card-value",children:a.value})]}),o.jsxs("div",{className:"card-body",children:[o.jsx(w,{content:a.top,className:"card-rule-top"}),o.jsx(w,{content:a.middle,className:"card-rule-middle"}),o.jsx(w,{content:a.bottom,className:"card-rule-bottom"})]})]}),o.jsx("div",{className:"card-face card-back",children:o.jsx("div",{className:"card-back-value",children:d})})]})})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Rn=[{protocol:"Apathy",value:0,top:"Your total value in this line is increased by 1 for each face-down card in this line.",middle:"",bottom:"",keywords:{},category:"Aux 1"},{protocol:"Apathy",value:1,top:"",middle:"Flip all other face-up cards in this line.",bottom:"",keywords:{flip:!0},category:"Aux 1"},{protocol:"Apathy",value:2,top:"Ignore all middle commands of cards in this line.",middle:"",bottom:"<div><span class='emphasis'>When this card would be covered:</span> First, flip this card.</div>",keywords:{flip:!0},category:"Aux 1"},{protocol:"Apathy",value:3,top:"",middle:"Flip 1 of your opponent's face-up cards.",bottom:"",keywords:{flip:!0},category:"Aux 1"},{protocol:"Apathy",value:4,top:"",middle:"You may flip 1 of your face-up covered cards.",bottom:"",keywords:{flip:!0},category:"Aux 1"},{protocol:"Apathy",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Aux 1"},{protocol:"Chaos",value:0,top:"",middle:"In each line, flip 1 covered card.",bottom:"<div><span class='emphasis'>Start:</span> Draw the top card of your opponent's deck. Your opponent draws the top card of your deck.</div>",keywords:{flip:!0,draw:!0},category:"Main 2"},{protocol:"Chaos",value:1,top:"",middle:"Rearrange your protocols. Rearrange your opponent's protocols.",bottom:"",keywords:{},category:"Main 2"},{protocol:"Chaos",value:2,top:"",middle:"Shift 1 of your covered cards.",bottom:"",keywords:{shift:!0},category:"Main 2"},{protocol:"Chaos",value:3,top:"",middle:"",bottom:"You may play cards without matching protocols.",keywords:{play:!0},category:"Main 2"},{protocol:"Chaos",value:4,top:"",middle:"",bottom:"<div><span class='emphasis'>End:</span> Discard your hand. Draw the same amount of cards.</div>",keywords:{discard:!0,draw:!0},category:"Main 2"},{protocol:"Chaos",value:5,top:"",middle:"Discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 2"},{protocol:"Darkness",value:0,top:"",middle:"Draw 3 cards. Shift 1 of your opponent's covered cards.",bottom:"",keywords:{draw:!0,shift:!0},category:"Main 1"},{protocol:"Darkness",value:1,top:"",middle:"Flip 1 of your opponent's cards. You may shift that card.",bottom:"",keywords:{flip:!0,shift:!0},category:"Main 1"},{protocol:"Darkness",value:2,top:"All face-down cards in this stack have a value of 4.",middle:"You may flip 1 covered card in this line.",bottom:"",keywords:{flip:!0},category:"Main 1"},{protocol:"Darkness",value:3,top:"",middle:"Play 1 card face-down in another line.",bottom:"",keywords:{play:!0},category:"Main 1"},{protocol:"Darkness",value:4,top:"",middle:"Shift 1 face-down card.",bottom:"",keywords:{shift:!0},category:"Main 1"},{protocol:"Darkness",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Death",value:0,top:"",middle:"Delete 1 card from each other line.",bottom:"",keywords:{delete:!0},category:"Main 1"},{protocol:"Death",value:1,top:"<div><span class='emphasis'>Start:</span> You may draw 1 card. If you do, delete 1 other card, then delete this card.</div>",middle:"",bottom:"",keywords:{draw:!0,delete:!0},category:"Main 1"},{protocol:"Death",value:2,top:"",middle:"Delete all cards in 1 line with values of 1 or 2.",bottom:"",keywords:{delete:!0},category:"Main 1"},{protocol:"Death",value:3,top:"",middle:"Delete 1 face-down card.",bottom:"",keywords:{delete:!0},category:"Main 1"},{protocol:"Death",value:4,top:"",middle:"Delete a card with a value of 0 or 1.",bottom:"",keywords:{delete:!0},category:"Main 1"},{protocol:"Death",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Fire",value:0,top:"",middle:"Flip 1 other card. Draw 2 cards.",bottom:"<div><span class='emphasis'>When this card would be covered:</span> First, draw 1 card and flip 1 other card.</div>",keywords:{draw:!0,flip:!0},category:"Main 1"},{protocol:"Fire",value:1,top:"",middle:"Discard 1 card. If you do, delete 1 card.",bottom:"",keywords:{delete:!0,discard:!0},category:"Main 1"},{protocol:"Fire",value:2,top:"",middle:"Discard 1 card. If you do, return 1 card.",bottom:"",keywords:{discard:!0,return:!0},category:"Main 1"},{protocol:"Fire",value:3,top:"",middle:"",bottom:"<div><span class='emphasis'>End:</span> You may discard 1 card. If you do, flip 1 card.</div>",keywords:{discard:!0,flip:!0},category:"Main 1"},{protocol:"Fire",value:4,top:"",middle:"Discard 1 or more cards. Draw the amount discarded plus 1.",bottom:"",keywords:{discard:!0,draw:!0},category:"Main 1"},{protocol:"Fire",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Gravity",value:0,top:"",middle:"For every 2 cards in this line, play the top card of your deck face-down under this card.",bottom:"",keywords:{play:!0},category:"Main 1"},{protocol:"Gravity",value:1,top:"",middle:"Draw 2 cards. Shift 1 card either to or from this line.",bottom:"",keywords:{draw:!0,shift:!0},category:"Main 1"},{protocol:"Gravity",value:2,top:"",middle:"Flip 1 card. Shift that card to this line.",bottom:"",keywords:{flip:!0,shift:!0},category:"Main 1"},{protocol:"Gravity",value:4,top:"",middle:"Shift 1 face-down card to this line.",bottom:"",keywords:{shift:!0},category:"Main 1"},{protocol:"Gravity",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Gravity",value:6,top:"",middle:"Your opponent plays the top card of their deck face-down in this line.",bottom:"",keywords:{play:!0},category:"Main 1"},{protocol:"Hate",value:0,top:"",middle:"Delete 1 card.",bottom:"",keywords:{delete:!0},category:"Aux 1"},{protocol:"Hate",value:1,top:"",middle:"Discard 3 cards. Delete 1 card. Delete 1 card.",bottom:"",keywords:{delete:!0,discard:!0},category:"Aux 1"},{protocol:"Hate",value:2,top:"",middle:"Delete your highest value uncovered card. Delete your opponent's highest value uncovered card.",bottom:"",keywords:{delete:!0},category:"Aux 1"},{protocol:"Hate",value:3,top:"<div><span class='emphasis'>After you delete cards:</span> Draw 1 card.</div>",middle:"",bottom:"",keywords:{draw:!0},category:"Aux 1"},{protocol:"Hate",value:4,top:"",middle:"",bottom:"<div><span class='emphasis'>When this card would be covered:</span> First, delete the lowest value covered card in this line.</div>",keywords:{delete:!0},category:"Aux 1"},{protocol:"Hate",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Aux 1"},{protocol:"Life",value:0,top:"",middle:"Play the top card of your deck face-down in each line where you have a card.",bottom:"<div><span class='emphasis'>When this card would be covered:</span> First, delete this card.</div>",keywords:{delete:!0,play:!0},category:"Main 1"},{protocol:"Life",value:1,top:"",middle:"Flip 1 card. Flip 1 card.",bottom:"",keywords:{flip:!0},category:"Main 1"},{protocol:"Life",value:2,top:"",middle:"Draw 1 card. You may flip 1 face-down card.",bottom:"",keywords:{draw:!0,flip:!0},category:"Main 1"},{protocol:"Life",value:3,top:"",middle:"",bottom:"<div><span class='emphasis'>When this card would be covered:</span> First, play the top card of your deck face-down in another line.</div>",keywords:{play:!0},category:"Main 1"},{protocol:"Life",value:4,top:"",middle:"If this card is covering a card, draw 1 card.",bottom:"",keywords:{draw:!0},category:"Main 1"},{protocol:"Life",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Light",value:0,top:"",middle:"Flip 1 card. Draw cards equal to that card's value.",bottom:"",keywords:{draw:!0,flip:!0},category:"Main 1"},{protocol:"Light",value:1,top:"",middle:"",bottom:"<div><span class='emphasis'>End:</span> Draw 1 card.</div>",keywords:{draw:!0},category:"Main 1"},{protocol:"Light",value:2,top:"",middle:"Draw 2 cards. Reveal 1 face-down card. You may shift or flip that card.",bottom:"",keywords:{draw:!0,flip:!0,reveal:!0,shift:!0},category:"Main 1"},{protocol:"Light",value:3,top:"",middle:"Shift all face-down cards in this line to another line.",bottom:"",keywords:{shift:!0},category:"Main 1"},{protocol:"Light",value:4,top:"",middle:"Your opponent reveals their hand.",bottom:"",keywords:{reveal:!0},category:"Main 1"},{protocol:"Light",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Love",value:1,top:"",middle:"Draw the top card of your opponent's deck.",bottom:"<div><span class='emphasis'>End:</span> You may give 1 card from your hand to your opponent. If you do, draw 2 cards.</div>",keywords:{draw:!0,give:!0},category:"Aux 1"},{protocol:"Love",value:2,top:"",middle:"Your opponent draws 1 card. Refresh.",bottom:"",keywords:{draw:!0,refresh:!0},category:"Aux 1"},{protocol:"Love",value:3,top:"",middle:"Take 1 random card from your opponent's hand. Give 1 card from your hand to your opponent.",bottom:"",keywords:{give:!0,take:!0},category:"Aux 1"},{protocol:"Love",value:4,top:"",middle:"Reveal 1 card from your hand. Flip 1 card.",bottom:"",keywords:{flip:!0,reveal:!0},category:"Aux 1"},{protocol:"Love",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Aux 1"},{protocol:"Love",value:6,top:"",middle:"Your opponent draws 2 cards.",bottom:"",keywords:{draw:!0},category:"Aux 1"},{protocol:"Metal",value:0,top:"Your opponent's total value in this line is reduced by 2.",middle:"Flip 1 card.",bottom:"",keywords:{flip:!0},category:"Main 1"},{protocol:"Metal",value:1,top:"",middle:"Draw 2 cards. Your opponent cannot compile next turn.",bottom:"",keywords:{draw:!0},category:"Main 1"},{protocol:"Metal",value:2,top:"Your opponent cannot play cards face-down in this line.",middle:"",bottom:"",keywords:{},category:"Main 1"},{protocol:"Metal",value:3,top:"",middle:"Draw 1 card. Delete all cards in 1 other line with 8 or more cards.",bottom:"",keywords:{delete:!0,draw:!0},category:"Main 1"},{protocol:"Metal",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Metal",value:6,top:"<div><span class='emphasis'>When this card would be covered or flipped:</span> First, delete this card.</div>",middle:"",bottom:"",keywords:{delete:!0},category:"Main 1"},{protocol:"Plague",value:0,top:"",middle:"Your opponent discards 1 card.",bottom:"Your opponent cannot play cards in this line.",keywords:{discard:!0},category:"Main 1"},{protocol:"Plague",value:1,top:"<div><span class='emphasis'>After your opponent discards cards:</span> Draw 1 card.</div>",middle:"Your opponent discards 1 card.",bottom:"",keywords:{discard:!0,draw:!0},category:"Main 1"},{protocol:"Plague",value:2,top:"",middle:"Dicard 1 or more cards. Your opponent discards the amount of cards discarded plus 1.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Plague",value:3,top:"",middle:"Flip each other face-up card.",bottom:"",keywords:{flip:!0},category:"Main 1"},{protocol:"Plague",value:4,top:"",middle:"",bottom:"<div><span class='emphasis'>End:</span> Your opponent deletes 1 of their face-down cards. You may flip this card.</div>",keywords:{delete:!0,flip:!0},category:"Main 1"},{protocol:"Plague",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Psychic",value:0,top:"",middle:"Draw 2 cards. Your opponent discards 2 cards, then reveals their hand.",bottom:"",keywords:{discard:!0,draw:!0,reveal:!0},category:"Main 1"},{protocol:"Psychic",value:1,top:"Your opponent can only play cards face-down.",middle:"",bottom:"<div><span class='emphasis'>Start:</span> Flip this card.</div>",keywords:{flip:!0},category:"Main 1"},{protocol:"Psychic",value:2,top:"",middle:"Your opponent discards 2 cards. Rearrange their protocols.",bottom:"",keywords:{discard:!0,rearrange:!0},category:"Main 1"},{protocol:"Psychic",value:3,top:"",middle:"Your opponent discards 1 card. Shift 1 of their cards.",bottom:"",keywords:{discard:!0,shift:!0},category:"Main 1"},{protocol:"Psychic",value:4,top:"",middle:"",bottom:"<div><span class='emphasis'>End:</span> You may return 1 of your opponent's cards. If you do, flip this card.</div>",keywords:{flip:!0,return:!0},category:"Main 1"},{protocol:"Psychic",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Speed",value:0,top:"",middle:"Play 1 card.",bottom:"",keywords:{play:!0},category:"Main 1"},{protocol:"Speed",value:1,top:"<div><span class='emphasis'>After you clear cache:</span> Draw 1 card.</div>",middle:"Draw 2 cards.",bottom:"",keywords:{draw:!0},category:"Main 1"},{protocol:"Speed",value:2,top:"<div><span class='emphasis'>When this card would be deleted by compiling:</span> Shift this card, even if this card is covered.</div>",middle:"",bottom:"",keywords:{shift:!0},category:"Main 1"},{protocol:"Speed",value:3,top:"",middle:"Shift 1 of your other cards.",bottom:"<div><span class='emphasis'>End:</span> You may shift 1 of your cards. If you do, flip this card.</div>",keywords:{flip:!0,shift:!0},category:"Main 1"},{protocol:"Speed",value:4,top:"",middle:"Shift 1 of your opponent's face-down cards.",bottom:"",keywords:{shift:!0},category:"Main 1"},{protocol:"Speed",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Spirit",value:0,top:"",middle:"Refresh. Draw 1 card.",bottom:"Skip your check cache phase.",keywords:{draw:!0,refresh:!0},category:"Main 1"},{protocol:"Spirit",value:1,top:"You can play cards in any line.",middle:"Draw 2 cards.",bottom:"<div><span class='emphasis'>Start:</span> Either discard 1 card or flip this card.</div>",keywords:{discard:!0,draw:!0,flip:!0},category:"Main 1"},{protocol:"Spirit",value:2,top:"",middle:"You may flip 1 card.",bottom:"",keywords:{flip:!0},category:"Main 1"},{protocol:"Spirit",value:3,top:"<div><span class='emphasis'>After you draw cards:</span> You may shift this card, even if this card is covered.</div>",middle:"",bottom:"",keywords:{shift:!0},category:"Main 1"},{protocol:"Spirit",value:4,top:"",middle:"Swap the positions of 2 of your protocols",bottom:"",keywords:{swap:!0},category:"Main 1"},{protocol:"Spirit",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Water",value:0,top:"",middle:"Flip 1 other card. Flip this card.",bottom:"",keywords:{flip:!0},category:"Main 1"},{protocol:"Water",value:1,top:"",middle:"Play the top card of your deck face-down in each other line.",bottom:"",keywords:{play:!0},category:"Main 1"},{protocol:"Water",value:2,top:"",middle:"Draw 2 cards. Rearrange your protocols.",bottom:"",keywords:{draw:!0,rearrange:!0},category:"Main 1"},{protocol:"Water",value:3,top:"",middle:"Return all cards with a value of 2 in 1 line.",bottom:"",keywords:{return:!0},category:"Main 1"},{protocol:"Water",value:4,top:"",middle:"Return 1 of your cards.",bottom:"",keywords:{return:!0},category:"Main 1"},{protocol:"Water",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Frost",value:0,top:"",middle:"Draw 1 card for each face-down card.",bottom:"",keywords:{draw:!0},category:"Fan-Content"},{protocol:"Frost",value:1,top:"Cards cannot be flipped face-up.",middle:"",bottom:"Protocols cannot be rearranged.",keywords:{flip:!0,rearrange:!0},category:"Fan-Content"},{protocol:"Frost",value:2,top:"",middle:"Play a card face-down.",bottom:"",keywords:{play:!0},category:"Fan-Content"},{protocol:"Frost",value:3,top:"Cards cannot shift from or to this line.",middle:"",bottom:"",keywords:{shift:!0},category:"Fan-Content"},{protocol:"Frost",value:4,top:"",middle:"You may flip 1 card of your face-up covered cards.",bottom:"",keywords:{flip:!0},category:"Fan-Content"},{protocol:"Frost",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Fan-Content"},{protocol:"Anarchy",value:0,top:"",middle:"Shift 1 card. For each line that contains a face-up card without matching protocol, draw 1 card.",bottom:"",keywords:{shift:!0,draw:!0},category:"Fan-Content"},{protocol:"Anarchy",value:1,top:"Cards can only be played without matching protocols.",middle:"Shift 1 other card to a line without a matching protocol.",bottom:"",keywords:{shift:!0,play:!0},category:"Fan-Content"},{protocol:"Anarchy",value:2,top:"",middle:"Delete a covered or uncovered card in a line with a matching protocol.",bottom:"",keywords:{delete:!0},category:"Fan-Content"},{protocol:"Anarchy",value:3,top:"",middle:"Swap the positions of 2 of your opponent's protocols.",bottom:"<div><span class='emphasis'>End:</span> Rearrange your protocols. Anarchy cannot be on this line.</div>",keywords:{swap:!0,rearrange:!0},category:"Fan-Content"},{protocol:"Anarchy",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Fan-Content"},{protocol:"Anarchy",value:6,top:"<div><span class='emphasis'>Start:</span> Flip this card, if this card is in the line with the Anarchy protocol.</div>",middle:"",bottom:"",keywords:{flip:!0},category:"Fan-Content"}],v_=new Set(Rn.map(a=>a.protocol)),__=Array.from(v_).sort();/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Pr=a=>{var c,i,d,u,h,f,m,y,v,_,w,b,N,S,k,C,j,R,F,L,U,Q,X,V,$,E,A,O,I,T,q,Y,K,P,Z,W,G,H,B,ee,de,J,pe,fe,ye,ke,Ve,Le,at,Te,qe,_t,Ft,He,$e,nt,ot,Pt,bt,xt,yt,Mt,wt,Vn,ga,ta,Tn,un,qt,tn,xn,va,na,aa,Bn,fn,Yn,oa,ra,Gn,Wn,la,sa,nn,St,At;const n=a.params;let l="";switch(n.action){case"refresh":{n.target==="opponent"?l="Your opponent refreshes their hand.":l="Refresh.";break}case"mutual_draw":{const ue=n.count||1;l=`Draw the top card${ue!==1?"s":""} of your opponent's deck. Your opponent draws the top card${ue!==1?"s":""} of your deck.`;break}case"draw":{if(a.useCardFromPreviousEffect){n.target==="opponent"?l="Opponent draws cards equal to that card's value.":l="Draw cards equal to that card's value.";break}if(n.countType==="count_face_down"){l="Draw 1 card for each face-down card.";break}if(n.conditional){switch(n.conditional.type){case"count_face_down":l="Draw 1 card for each face-down card.";break;case"is_covering":l=`Draw ${n.count} card${n.count!==1?"s":""} if this card is covering another.`;break;case"non_matching_protocols":l="Draw 1 card for each line with a non-matching protocol.";break}break}let ue="";if(n.countType==="equal_to_discarded"){const Re=n.countOffset||0;Re===1?ue+="Draw 1 more card than the amount discarded.":Re===0?ue+="Draw the same amount of cards.":ue+=`Draw the amount discarded plus ${Re}.`,l=ue;break}else if(n.countType==="equal_to_card_value"){ue+="Draw cards equal to that card's value.",l=ue;break}else if(n.countType==="hand_size"){ue+="Draw the same amount of cards.",l=ue;break}else if(n.countType==="all_matching"&&((c=n.valueFilter)==null?void 0:c.equals)!==void 0){const Re=n.valueFilter.equals;ue+=`Draw all cards with a value of ${Re}.`,l=ue;break}else if(((i=n.valueFilter)==null?void 0:i.equals)!==void 0&&n.count){const Re=n.valueFilter.equals,Ie=n.count===1?"card":"cards",De=n.fromRevealed?" revealed this way":"";ue+=`Draw ${n.count} ${Ie} with a value of ${Re}${De}.`,l=ue;break}if(((d=n.advancedConditional)==null?void 0:d.type)==="empty_hand"){const Re=n.count||1;l=`If you have no cards in hand, draw ${Re} card${Re!==1?"s":""}.`;break}if(((u=n.advancedConditional)==null?void 0:u.type)==="opponent_higher_value_in_lane"){const Re=n.count||1;l=`If your opponent has a higher total value than you do in this line, draw ${Re} card${Re!==1?"s":""}.`;break}const Ce=n.optional?"You may ":"";if(n.source==="opponent_deck"){const Re=n.count===1?"the top card":`the top ${n.count} cards`;ue+=`${Ce}Draw ${Re} of your opponent's deck.`}else if(n.target==="opponent")ue+=`Opponent draws ${n.count} card${n.count!==1?"s":""}.`;else{const Re=n.optional?"draw":"Draw";ue+=`${Ce}${Re} ${n.count} card${n.count!==1?"s":""}.`}l=ue;break}case"flip":{if(a.useCardFromPreviousEffect){l=`${n.optional?"May flip":"Flip"} that card.`;break}if(n.flipSelf){if(((h=n.advancedConditional)==null?void 0:h.type)==="opponent_higher_value_in_lane"){l="If your opponent has a higher value in this line than you do, flip this card.";break}let rt=(n.optional,"Flip this card");((f=n.advancedConditional)==null?void 0:f.type)==="protocol_match"&&(rt+=`, if this card is in the line with the ${n.advancedConditional.protocol||"[Protocol]"} protocol`),l=rt+".";break}const ue=n.optional?"You may flip":"Flip",Ce=((m=n.targetFilter)==null?void 0:m.owner)==="own",Re=((y=n.targetFilter)==null?void 0:y.owner)==="opponent",Ie=(v=n.targetFilter)==null?void 0:v.excludeSelf;let De="";Ce&&Ie?De+="of your other ":Ce?De+="of your ":Re?De+="of your opponent's ":Ie&&(De+="other "),((_=n.targetFilter)==null?void 0:_.position)==="any"?De+="covered or uncovered ":((w=n.targetFilter)==null?void 0:w.position)==="covered"&&(De+="covered "),((b=n.targetFilter)==null?void 0:b.faceState)==="face_down"&&(De+="face-down "),((N=n.targetFilter)==null?void 0:N.faceState)==="face_up"&&(De+="face-up ");let ze="";n.count==="all"?ze="all":n.count==="each"?n.eachLineScope==="each_line"?(ze="1",De=De+"(in each line) "):ze="each":ze=n.count.toString();const Be=Ce||Re?"cards":n.count===1?"card":"cards";let Fe="";if(Ce&&((S=n.targetFilter)==null?void 0:S.position)==="covered"&&((k=n.targetFilter)==null?void 0:k.faceState)==="face_up"&&n.optional?Fe=`${ue} ${ze} of your ${n.targetFilter.faceState.replace("_","-")} ${n.targetFilter.position} cards`:Fe=`${ue} ${ze} ${De}${Be}`,n.scope==="this_lane"){const rt=((C=n.targetFilter)==null?void 0:C.owner)==="own";Fe+=rt?" in this stack":" in this line"}else n.scope==="each_lane"&&(Fe=`In each line, ${Fe.charAt(0).toLowerCase()+Fe.slice(1)}`);Fe+=".",n.selfFlipAfter&&(Fe+=" Then flip this card."),l=Fe;break}case"shift":{const ue=n.optional?"You may shift":"Shift";if(((j=n.advancedConditional)==null?void 0:j.type)==="empty_hand"){l=`If you have no cards in hand, ${ue.toLowerCase()} 1 card.`;break}if(((R=n.advancedConditional)==null?void 0:R.type)==="opponent_higher_value_in_lane"){l=`If your opponent has a higher total value than you do in this line, ${ue.toLowerCase()} 1 card.`;break}if(((F=n.advancedConditional)==null?void 0:F.type)==="this_card_is_covered"){l=`If this card is covered, ${ue.toLowerCase()} it.`;break}if(n.shiftSelf){if(((L=n.destinationRestriction)==null?void 0:L.type)==="opponent_highest_value_lane"){l=`${ue} this card to the line where your opponent has their highest total value.`;break}let be=`${ue} this card`;n.allowCoveredSelf&&(be+=", even if this card is covered"),l=be+".";break}if(a.useCardFromPreviousEffect){let be=`${ue} that card`;((U=n.destinationRestriction)==null?void 0:U.type)==="to_this_lane"?be+=" to this line":((Q=n.destinationRestriction)==null?void 0:Q.type)==="to_another_line"?be+=" to another line":((X=n.destinationRestriction)==null?void 0:X.type)==="non_matching_protocol"?be+=" to a line without a matching protocol":((V=n.destinationRestriction)==null?void 0:V.type)==="specific_lane"&&(be+=" within this line"),l=be+".";break}const Ce=n.count||1,Re=(($=n.targetFilter)==null?void 0:$.owner)==="own",Ie=((E=n.targetFilter)==null?void 0:E.position)==="covered";if(Re&&Ie&&Ce===1){let be=`${ue} 1 of your covered cards`;((A=n.destinationRestriction)==null?void 0:A.type)==="non_matching_protocol"?be+=" to a line without a matching protocol":((O=n.destinationRestriction)==null?void 0:O.type)==="specific_lane"?be+=" within this line":((I=n.destinationRestriction)==null?void 0:I.type)==="to_another_line"&&(be+=" to another line"),l=be+".";break}if(((T=n.targetFilter)==null?void 0:T.owner)==="own"&&((q=n.targetFilter)==null?void 0:q.position)==="any"&&!((Y=n.targetFilter)!=null&&Y.excludeSelf)&&Ce===1){l=`${ue} this card, even if this card is covered`+".";break}if(Re&&!Ie&&!((K=n.targetFilter)!=null&&K.excludeSelf)&&Ce===1){l=`${ue} 1 of your cards`+".";break}let ze="";const Je=((P=n.targetFilter)==null?void 0:P.owner)==="opponent",Be=(Z=n.targetFilter)==null?void 0:Z.excludeSelf,Fe=((W=n.targetFilter)==null?void 0:W.position)==="any";Re&&Be?ze+="of your other ":Je?ze+="of your opponent's ":Be&&(ze+="other "),Fe?ze+="covered or uncovered ":((G=n.targetFilter)==null?void 0:G.position)==="covered"&&(ze+="covered "),((H=n.targetFilter)==null?void 0:H.faceState)==="face_down"&&(ze+="face-down "),((B=n.targetFilter)==null?void 0:B.faceState)==="face_up"&&(ze+="face-up ");const rt=n.count==="all"?"all":"1";let xe=`${ue} ${rt} ${ze}${Re&&Be||Je?"cards":rt==="1"?"card":"cards"}`;n.scope==="this_lane"&&(xe+=" in this line"),((ee=n.destinationRestriction)==null?void 0:ee.type)==="non_matching_protocol"?xe+=" to a line without a matching protocol":((de=n.destinationRestriction)==null?void 0:de.type)==="specific_lane"?xe+=" within this line":((J=n.destinationRestriction)==null?void 0:J.type)==="to_another_line"?xe+=" to another line":((pe=n.destinationRestriction)==null?void 0:pe.type)==="to_this_lane"?xe+=" to this line":((fe=n.destinationRestriction)==null?void 0:fe.type)==="to_or_from_this_lane"&&(xe+=" either to or from this line"),l=xe+".";break}case"delete":{if(((ye=n.advancedConditional)==null?void 0:ye.type)==="empty_hand"){const Je=n.count||1;l=`If you have no cards in hand, delete ${Je} card${Je!==1?"s":""}.`;break}if(((ke=n.advancedConditional)==null?void 0:ke.type)==="opponent_higher_value_in_lane"){const Je=n.count||1;l=`If your opponent has a higher total value than you do in this line, delete ${Je} card${Je!==1?"s":""}.`;break}if(a.useCardFromPreviousEffect){l="Delete that card.";break}if(n.deleteSelf){l="Delete this card.";break}if(((Ve=n.laneCondition)==null?void 0:Ve.type)==="opponent_higher_value"){const Je=n.count||1,Be=((Le=n.targetFilter)==null?void 0:Le.owner)==="opponent"?"of your opponent's ":"";l=`Delete ${Je} ${Be}${Je===1?"card":"cards"} in a line where they have a higher total value than you do.`;break}let ue="Delete ";const Ce=((at=n.targetFilter)==null?void 0:at.position)==="any",Re=((Te=n.targetFilter)==null?void 0:Te.calculation)==="highest_value"||((qe=n.targetFilter)==null?void 0:qe.calculation)==="lowest_value",Ie=((_t=n.targetFilter)==null?void 0:_t.owner)==="own"||((Ft=n.targetFilter)==null?void 0:Ft.owner)==="opponent",De=n.count===1&&Re&&Ie;if(n.count==="all_in_lane"?ue+="all ":De||(ue+=Ce?"a ":`${n.count} `),De&&(((He=n.targetFilter)==null?void 0:He.owner)==="own"?ue+="your ":(($e=n.targetFilter)==null?void 0:$e.owner)==="opponent"&&(ue+="opponent's ")),((nt=n.targetFilter)==null?void 0:nt.calculation)==="highest_value"?ue+="highest value ":((ot=n.targetFilter)==null?void 0:ot.calculation)==="lowest_value"&&(ue+="lowest value "),(Pt=n.targetFilter)!=null&&Pt.valueRange){const{min:Je,max:Be}=n.targetFilter.valueRange,Fe=[];for(let Qt=Je;Qt<=Be;Qt++)Fe.push(Qt);const rt=Fe.join(" or ");ue+=`value ${rt} `}De||(((bt=n.targetFilter)==null?void 0:bt.owner)==="own"?ue+="your ":((xt=n.targetFilter)==null?void 0:xt.owner)==="opponent"&&(ue+="opponent's ")),n.excludeSelf&&(ue+="other "),Ce?ue+="covered or uncovered ":((yt=n.targetFilter)==null?void 0:yt.position)==="covered"&&(ue+="covered "),((Mt=n.targetFilter)==null?void 0:Mt.faceState)==="face_down"?ue+="face-down ":((wt=n.targetFilter)==null?void 0:wt.faceState)==="face_up"&&(ue+="face-up ");const ze=n.count===1?"card":"cards";ue+=ze,n.selectLane&&(ue+=" in 1 line"),n.protocolMatching==="must_match"?ue+=" in a line with a matching protocol":n.protocolMatching==="must_not_match"&&(ue+=" in a line without a matching protocol"),((Vn=n.scope)==null?void 0:Vn.type)==="this_line"?ue+=" in this line":((ga=n.scope)==null?void 0:ga.type)==="other_lanes"?ue+=" in other lanes":((ta=n.scope)==null?void 0:ta.type)==="each_other_line"&&(ue+=" from each other line"),l=ue+".";break}case"discard":{if(n.useCardFromPreviousEffect){n.actor==="opponent"?l="Opponent discards that card.":l="discard that card.";break}if(n.countType==="equal_to_discarded"){const Ie=n.countOffset||0;n.actor==="opponent"?Ie===1?l="Your opponent discards the amount of cards discarded plus 1.":Ie===0?l="Your opponent discards the same amount of cards.":l=`Your opponent discards the amount discarded plus ${Ie}.`:Ie===1?l="Discard 1 more card than the amount discarded.":Ie===0?l="Discard the same amount of cards.":l=`Discard the amount discarded plus ${Ie}.`;break}const ue=n.variableCount;let Ce="";if(ue)Ce="1 or more cards";else if(n.count==="all")Ce="your hand";else{const Ie=n.count===1?"card":"cards";Ce=`${n.count} ${Ie}`}const Re=n.optional?"You may discard":n.count==="all"||ue?"Discard":"You discard";if(n.actor==="opponent")if(n.count==="all")l="Opponent discards their hand.";else if(n.random){const Ie=n.count===1?"card":"cards";l=`Your opponent discards ${n.count} random ${Ie}.`}else l=`Your opponent discards ${Ce}.`;else l=`${Re} ${Ce}.`;break}case"return":{if(((Tn=n.advancedConditional)==null?void 0:Tn.type)==="empty_hand"){const Fe=n.count||1;l=`If you have no cards in hand, return ${Fe} card${Fe!==1?"s":""}.`;break}if(((un=n.advancedConditional)==null?void 0:un.type)==="opponent_higher_value_in_lane"){const Fe=n.count||1;l=`If your opponent has a higher total value than you do in this line, return ${Fe} card${Fe!==1?"s":""}.`;break}if(a.useCardFromPreviousEffect){l="Return that card to hand.";break}const Ce=n.selectLane||!1?" in 1 line":"";if(((qt=n.targetFilter)==null?void 0:qt.valueEquals)!==void 0){l=`Return all cards with a value of ${n.targetFilter.valueEquals}${Ce}.`;break}const Re=((tn=n.targetFilter)==null?void 0:tn.owner)||"any",Ie=((xn=n.targetFilter)==null?void 0:xn.position)||"uncovered";let De="";Ie==="any"?De="covered or uncovered ":Ie==="covered"&&(De="covered ");const ze=n.count==="all"?`all ${De}cards`:n.count===1?`1 ${De}card`:`${n.count} ${De}cards`;let Je="";Re==="own"?Je=" of your":Re==="opponent"&&(Je=" of your opponent's"),l=`${n.optional?"You may r":"R"}eturn ${ze}${Je}${Ce}.`;break}case"play":{if(((va=n.advancedConditional)==null?void 0:va.type)==="empty_hand"){const Fe=n.count||1;l=`If you have no cards in hand, play ${Fe} card${Fe!==1?"s":""}.`;break}if(((na=n.advancedConditional)==null?void 0:na.type)==="opponent_higher_value_in_lane"){const Fe=n.count||1;l=`If your opponent has a higher total value than you do in this line, play ${Fe} card${Fe!==1?"s":""}.`;break}if(a.useCardFromPreviousEffect){const Fe=n.faceDown===!0?"face-down":n.faceDown===!1?"face-up":"";l=Fe?`Play that card ${Fe}.`:"Play that card.";break}const ue=n.actor,Ce=n.count||1,Re=n.faceDown===!0?" face-down":n.faceDown===!1?" face-up":"";let Ie="",De="";const ze=((aa=n.valueFilter)==null?void 0:aa.equals)!==void 0?` with a value of ${n.valueFilter.equals}`:"";ue==="opponent"?(Ie="Your opponent plays",n.source==="deck"?De=Ce===1?"the top card of their deck":`${Ce} cards from their deck`:De=Ce===1?`a card${ze} from their hand`:`${Ce} cards${ze} from their hand`):(Ie="Play",n.source==="deck"?De=Ce===1?"the top card of your deck":`${Ce} cards from your deck`:De=Ce===1?`1 card${ze}`:`${Ce} cards${ze}`);let Je="";((Bn=n.condition)==null?void 0:Bn.type)==="per_x_cards_in_line"&&(Je=`For every ${n.condition.cardCount||2} cards in this line, `,Ie=Ie.toLowerCase());let Be=`${Je}${Ie} ${De}${Re}`;if(((fn=n.destinationRule)==null?void 0:fn.type)==="other_lines")Be+=" to other lines";else if(((Yn=n.destinationRule)==null?void 0:Yn.type)==="another_line")Be+=" in another line";else if(((oa=n.destinationRule)==null?void 0:oa.type)==="each_other_line")Be+=" in each other line";else if(((ra=n.destinationRule)==null?void 0:ra.type)==="under_this_card")Be+=" under this card";else if(((Gn=n.destinationRule)==null?void 0:Gn.type)==="each_line_with_card"){const Fe=n.destinationRule.ownerFilter,rt=n.destinationRule.cardFilter;(rt==null?void 0:rt.faceState)==="face_down"?Be+=" in each line with a face-down card":(rt==null?void 0:rt.faceState)==="face_up"?Be+=" in each line with a face-up card":Fe==="own"?Be+=" in each line where you have a card":Fe==="opponent"?Be+=" in each line where opponent has a card":Be+=" to each line with a card"}else if(((Wn=n.destinationRule)==null?void 0:Wn.type)==="line_with_matching_cards"){const Fe=n.destinationRule.cardFilter;(Fe==null?void 0:Fe.faceState)==="face_down"?Be+=" in a line with a face-down card":(Fe==null?void 0:Fe.faceState)==="face_up"?Be+=" in a line with a face-up card":Be+=" in a line with a card"}else((la=n.destinationRule)==null?void 0:la.type)==="specific_lane"&&(Be+=" in this line");l=Be+".";break}case"rearrange_protocols":case"swap_protocols":{const ue=n.target==="opponent"?"your opponent's":n.target==="both_sequential"?"both players'":"your";let Ce="";n.action==="rearrange_protocols"?Ce=`Rearrange ${ue} protocols`:Ce=`Swap the positions of 2 of ${ue} protocols`,n.restriction&&n.restriction.disallowedProtocol&&(Ce+=`. ${n.restriction.disallowedProtocol} cannot be on this line`),l=Ce+".";break}case"reveal":case"give":{if(a.useCardFromPreviousEffect){l=`${n.action==="give"?"Give":"Reveal"} that card.`;break}if(n.action,n.source==="board"){const Je=((sa=n.targetFilter)==null?void 0:sa.faceState)==="face_down"?"face-down ":"",Be=n.count||1;let rt=`Reveal ${Be} ${Je}${Be===1?"card":"cards"}`;n.optional?rt+=". You may shift or flip that card":n.followUpAction==="flip"?rt+=". Then flip it":n.followUpAction==="shift"&&(rt+=". Then shift it"),l=rt+".";break}if(n.source==="own_deck_top"){let Je="Reveal the top card of your deck";n.followUpAction==="may_discard"&&(Je+=". You may discard it"),l=Je+".";break}if(n.source==="own_deck"){l="Reveal your deck.";break}if(n.count===-1){n.source==="opponent_hand"?l=n.action==="reveal"?"Your opponent reveals their hand.":"Give your entire hand to your opponent.":l=n.action==="reveal"?"Reveal your hand.":"Give your entire hand.";break}const ue=n.count===1?"card":"cards",Ce=n.source==="opponent_hand"?"opponent's hand":"your hand",Re=n.optional?"You may ":"",Ie=n.action==="give"?"give":"reveal",De=n.action==="give"?"Give":"Reveal";let ze;n.optional?ze=`${Re}${Ie} ${n.count} ${ue} from ${Ce}`:ze=`${De} ${n.count} ${ue} from ${Ce}`,n.action==="give"&&n.source!=="opponent_hand"&&(ze+=" to your opponent"),n.followUpAction==="flip"?ze+=". Then flip it.":n.followUpAction==="shift"?ze+=". Then shift it.":ze+=".",l=ze;break}case"take":{const ue=n.count===1?"card":"cards",Ce=n.random!==!1?"random ":"";l=`Take ${n.count} ${Ce}${ue} from your opponent's hand.`;break}case"choice":{const ue=n.options||[];if(ue.length===0){l="Effect";break}if(ue.length===2){const Ce=ue.map(Re=>{const Ie={params:Re.params};let De=Pr(Ie);return De.endsWith(".")&&(De=De.slice(0,-1)),De=De.charAt(0).toLowerCase()+De.slice(1),De});l=`Either ${Ce[0]} or ${Ce[1]}.`}else l="Effect";break}case"passive_rule":{const ue=n.rule;switch(ue==null?void 0:ue.type){case"require_non_matching_protocol":l="Cards can only be played without matching protocols.";break;case"block_all_play":ue.target==="opponent"?l="Your opponent cannot play cards in this line.":ue.target==="self"?l="You cannot play cards in this line.":l="Cards cannot be played in this line.";break;case"ignore_middle_commands":if(ue.onlyDuringYourTurn&&ue.target==="opponent"&&ue.scope==="global")l="During your turn, your opponent's cards do not have middle commands.";else if(ue.onlyDuringYourTurn){const Ce=ue.target==="opponent"?"your opponent's ":ue.target==="self"?"your ":"",Re=ue.scope==="global"?"":" in this line";l=`During your turn, ignore all middle commands of ${Ce}cards${Re}.`}else l="Ignore all middle commands of cards in this line.";break;case"block_face_down_play":l="Opponent can't play cards face-down in this line.";break;case"require_face_down_play":l=ue.scope==="global"?"Your opponent can only play cards face-down.":"Opponent can only play cards face-down in this line.";break;case"allow_any_protocol_play":l="You may play cards without matching protocols.";break;case"allow_play_on_opponent_side":l="You may play this card in any line on either player's side.";break;case"block_flips":l=ue.scope==="global"?"Cards cannot be flipped face-up.":"Cards can't be flipped face-up in this line.";break;case"block_protocol_rearrange":l="Protocols can't be rearranged.";break;case"block_shifts_from_lane":l="Cards can't shift from this line.";break;case"block_shifts_to_lane":l="Cards can't shift to this line.";break;case"block_shifts_from_and_to_lane":l="Cards cannot shift from or to this line.";break;case"skip_check_cache_phase":l="Skip check cache phase.";break;case"block_flip_this_card":l="This card cannot be flipped.";break;case"block_draw_conditional":{const Ce=ue.conditionTarget||"self",Re=ue.blockTarget||"self",Ie=Ce==="self"?"you have":"your opponent has";let De;Re==="self"?De="you cannot draw":Re==="opponent"?De="your opponent cannot draw":De="neither player can draw",l=`If ${Ie} any cards in hand, ${De} cards.`;break}default:l="Passive rule effect."}break}case"value_modifier":{const ue=n.modifier;switch(ue==null?void 0:ue.type){case"add_per_condition":{const Ce=ue.scope==="this_lane"?"in this line":"",Re=ue.target==="own_total"?"Your total value":ue.target==="opponent_total"?"Opponent's total value":"Total value";let Ie="";ue.condition==="per_face_down_card"?Ie="for each face-down card":ue.condition==="per_face_up_card"?Ie="for each face-up card":ue.condition==="per_card"?Ie="for each card":ue.condition==="per_card_in_hand"&&(Ie="for each card in your hand");const De=ue.value>=0?"+":"";l=`${Re} ${Ce} is increased by ${De}${ue.value} ${Ie} ${Ce}.`.replace(/\s+/g," ");break}case"set_to_fixed":{let Ce="";ue.target==="own_cards"?Ce="your":ue.target==="opponent_cards"?Ce="opponent's":Ce="all";let Re="";((nn=ue.filter)==null?void 0:nn.faceState)==="face_down"?Re=" face-down":((St=ue.filter)==null?void 0:St.faceState)==="face_up"&&(Re=" face-up");let Ie="";ue.scope==="this_lane"&&(Ie=" in this stack"),l=`All ${Ce}${Re} cards${Ie} have a value of ${ue.value}.`;break}case"add_to_total":{const Ce=ue.scope==="this_lane"?" in this line":"";ue.target==="opponent_total"?ue.value<0?l=`Your opponent's total value${Ce} is reduced by ${Math.abs(ue.value)}.`:l=`Your opponent's total value${Ce} is increased by ${ue.value}.`:ue.value<0?l=`Your total value${Ce} is reduced by ${Math.abs(ue.value)}.`:l=`Your total value${Ce} is increased by ${ue.value}.`;break}default:l="Value modifier effect."}break}case"block_compile":{l=`${n.target==="opponent"?"Your opponent":"You"} cannot compile next turn.`;break}case"delete_all_in_lane":{const ue=((At=n.laneCondition)==null?void 0:At.count)||8;l=`Delete all cards in ${n.excludeCurrentLane?"1 other line":"1 line"} with ${ue} or more cards.`;break}case"modify_value":{const ue=n.modifier||0,Ce=n.target==="opponent"?"Your opponent's":"Your",Re=ue<0?`reduced by ${Math.abs(ue)}`:`increased by ${ue}`;l=`${Ce} total value in this line is ${Re}.`;break}case"block_play_face_down":{l="Your opponent cannot play cards face-down in this line.";break}case"shuffle_trash":{l=`${n.optional!==!1?"You may shuffle":"Shuffle"} your trash into your deck.`;break}case"shuffle_deck":{l="Shuffle your deck.";break}case"redirect_return_to_deck":{l=`Put that card on top of their deck ${n.faceDown!==!1?"face-down ":""}instead.`;break}default:l="Effect";break}if(a.conditional&&a.conditional.thenEffect){let ue=Pr(a.conditional.thenEffect);const Ce=a.conditional.thenEffect.params;Ce!=null&&Ce.useCardFromPreviousEffect&&(ue=ue.replace(/\d+ cards?/i,"that card")),a.conditional.type==="then"?l=`${l.endsWith(".")?l.slice(0,-1):l}, then ${ue.toLowerCase()}`:a.conditional.type==="optional"?l=`${l.endsWith(".")?l.slice(0,-1):l}. You may ${ue.toLowerCase()}`:l=`${l} If you do, ${ue.toLowerCase()}`}return l},x_=a=>{const n={};for(const l of a){const i=l.params.action;i==="draw"&&(n.draw=!0),i==="flip"&&(n.flip=!0),i==="shift"&&(n.shift=!0),i==="delete"&&(n.delete=!0),i==="discard"&&(n.discard=!0),i==="return"&&(n.return=!0),i==="play"&&(n.play=!0),i==="reveal"&&(n.reveal=!0),i==="give"&&(n.give=!0),i==="take"&&(n.take=!0)}return n},Yo=a=>a.length===0?"":a.map(n=>{var i;const l=Pr(n),c=n.trigger;if(c==="start")return`<div><span class='emphasis'>Start:</span> ${l}</div>`;if(c==="end")return`<div><span class='emphasis'>End:</span> ${l}</div>`;if(c==="on_cover")return`<div><span class='emphasis'>When this card would be covered:</span> First, ${l.toLowerCase()}</div>`;if(c==="on_flip")return`<div><span class='emphasis'>When this card would be flipped:</span> First, ${l.toLowerCase()}</div>`;if(c==="on_cover_or_flip")return`<div><span class='emphasis'>When this card would be covered or flipped:</span> First, ${l.toLowerCase()}</div>`;if(c==="after_draw"||c==="after_delete"||c==="after_discard"||c==="after_shift"||c==="after_flip"||c==="after_clear_cache"){const d=n.reactiveTriggerActor||"self",u=d==="self"?"you":d==="opponent"?"opponent":"a card is";let h="";return c==="after_draw"?h=d==="any"?"drawn":"draw cards":c==="after_delete"?h=d==="any"?"deleted":"delete cards":c==="after_discard"?h=d==="any"?"discarded":"discard cards":c==="after_shift"?h=d==="any"?"shifted":"shift cards":c==="after_flip"?h=d==="any"?"flipped":"flip cards":c==="after_clear_cache"&&(h="clear cache"),`<div><span class='emphasis'>${d==="any"?`After ${u} ${h}`:`After ${u} ${h}`}:</span> ${l}</div>`}if(c==="after_opponent_discard")return`<div><span class='emphasis'>After your opponent discards cards:</span> ${l}</div>`;if(c==="after_play"){const d=n.reactiveTriggerActor||"self",u=n.reactiveScope||"global";return d==="opponent"&&u==="this_lane"?`<div><span class='emphasis'>After your opponent plays a card in this line:</span> ${l}</div>`:d==="opponent"?`<div><span class='emphasis'>After your opponent plays a card:</span> ${l}</div>`:u==="this_lane"?`<div><span class='emphasis'>After you play a card in this line:</span> ${l}</div>`:`<div><span class='emphasis'>After you play a card:</span> ${l}</div>`}return c==="before_compile_delete"?`<div><span class='emphasis'>When this card would be deleted by compiling:</span> ${l}</div>`:c==="when_card_returned"?`<div><span class='emphasis'>When a card would be returned to ${(((i=n.params)==null?void 0:i.targetOwner)||"opponent")==="opponent"?"your opponent's":"your"} hand:</span> ${l}</div>`:l}).join(" "),w_=(a,n)=>{var f,m,y;const l=((f=a.text)==null?void 0:f.top)!==void 0?a.text.top:Yo(a.topEffects),c=((m=a.text)==null?void 0:m.middle)!==void 0?a.text.middle:Yo(a.middleEffects),i=((y=a.text)==null?void 0:y.bottom)!==void 0?a.text.bottom:Yo(a.bottomEffects),d=[...a.topEffects,...a.middleEffects,...a.bottomEffects],u=x_(d);return{protocol:n.name,value:a.value,top:l,middle:c,bottom:i,keywords:u,category:n.category||"Custom",color:n.color,pattern:n.pattern,customEffects:{topEffects:a.topEffects,middleEffects:a.middleEffects,bottomEffects:a.bottomEffects}}},C_=a=>a.cards.map(n=>w_(n,a)),Co=()=>{try{const a=localStorage.getItem("custom_protocols_v1");if(!a)return[];const l=JSON.parse(a).protocols||[],c=[];for(const i of l){const d=C_(i);c.push(...d)}return c}catch(a){return console.error("Failed to load custom protocol cards:",a),[]}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Wh="custom_protocols_v1",jd=1,Qo=()=>{try{const a=localStorage.getItem(Wh);if(!a)return[];const n=JSON.parse(a);return n.version!==jd&&console.warn(`Custom protocol storage version mismatch: expected ${jd}, got ${n.version}`),n.protocols||[]}catch(a){return console.error("Error loading custom protocols:",a),[]}},Ud=a=>{try{const n={protocols:a,version:jd};localStorage.setItem(Wh,JSON.stringify(n))}catch(n){console.error("Error saving custom protocols:",n)}},vt=a=>{const n=Qo(),l=n.findIndex(c=>c.id===a.id);l>=0?n[l]=a:n.push(a),Ud(n)},b_=a=>{const l=Qo().filter(c=>c.id!==a);Ud(l)},S_=["anarchy-custom-001","apathy_custom","chaos_custom_1","clarity-custom-001","corruption-custom-001","courage-custom-001","darkness_custom_v1","death_custom_v1","fear_custom","fire-custom-001","frost_custom_1","gravity_custom_1","hate-custom-001","ice_custom","life_custom_1","light_custom_1","love_custom_v1","metal_custom_1","plague-custom-001","psychic_custom_v1","smoke-custom-001","speed_custom_1","spirit_custom_1","water_custom_1"],Or=a=>S_.includes(a.id),E_=(a,n)=>{const l=(i,d)=>{i=i.replace("#","");const u=parseInt(i.substring(0,2),16),h=parseInt(i.substring(2,4),16),f=parseInt(i.substring(4,6),16);return`rgba(${u}, ${h}, ${f}, ${d})`},c={borderColor:n};switch(a){case"solid":return{...c,backgroundColor:n};case"radial":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`radial-gradient(circle at 50% 50%, ${l(n,.25)} 0%, transparent 60%)`};case"dual-radial":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 0% 0%, ${l(n,.2)}, transparent 50%),
                    radial-gradient(at 100% 100%, ${l(n,.2)}, transparent 50%)
                `};case"multi-radial":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 0%, ${l(n,.2)}, transparent 70%),
                    radial-gradient(circle at 20% 30%, ${l(n,.15)}, transparent 40%),
                    radial-gradient(circle at 80% 70%, ${l(n,.2)}, transparent 50%)
                `};case"chaos":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 10% 10%, hsla(60, 100%, 50%, 0.15), transparent 30%),
                    radial-gradient(at 90% 20%, hsla(180, 100%, 50%, 0.15), transparent 35%),
                    radial-gradient(at 30% 80%, hsla(300, 100%, 50%, 0.15), transparent 40%),
                    radial-gradient(at 70% 60%, hsla(0, 100%, 50%, 0.1), transparent 25%)
                `};case"grid":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(circle at 50% 50%, ${l(n,.2)} 0%, transparent 40%),
                    linear-gradient(hsla(0,0%,100%,0.03) 1px, transparent 1px),
                    linear-gradient(90deg, hsla(0,0%,100%,0.03) 1px, transparent 1px)
                `,backgroundSize:"100% 100%, 20px 20px, 20px 20px"};case"diagonal-lines":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 0% 100%, ${l(n,.25)}, transparent 70%),
                    repeating-linear-gradient(120deg, transparent, transparent 15px, ${l(n,.05)} 15px, ${l(n,.05)} 30px)
                `};case"cross-diagonal":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 50%, ${l(n,.25)} 0%, transparent 50%),
                    repeating-linear-gradient(45deg, transparent, transparent 8px, ${l(n,.08)} 8px, ${l(n,.08)} 16px),
                    repeating-linear-gradient(-45deg, transparent, transparent 8px, ${l(n,.06)} 8px, ${l(n,.06)} 16px)
                `};case"horizontal-lines":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 80% 80%, ${l(n,.1)}, transparent 50%),
                    repeating-linear-gradient(0deg, hsla(0,0%,100%,0.02), hsla(0,0%,100%,0.02) 1px, transparent 1px, transparent 3px)
                `};case"vertical-lines":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 10% 10%, ${l(n,.2)}, transparent 50%),
                    repeating-linear-gradient(175deg, transparent, transparent 1px, ${l(n,.05)} 1px, ${l(n,.05)} 2px)
                `};case"cross":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    linear-gradient(0deg, transparent 40%, ${l(n,.1)} 50%, transparent 60%),
                    linear-gradient(90deg, transparent 48%, ${l(n,.2)} 50%, transparent 52%)
                `};case"hexagons":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 0%, ${l(n,.2)}, transparent 70%),
                    url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='28' height='49' viewBox='0 0 28 49'%3E%3Cg fill-rule='evenodd'%3E%3Cg id='hexagons' fill='${encodeURIComponent(n)}' fill-opacity='0.05' fill-rule='nonzero'%3E%3Cpath d='M13.99 9.25l13 7.5v15l-13 7.5L1 31.75v-15l12.99-7.5zM3 17.9v12.7l10.99 6.34 11-6.35V17.9l-11-6.34L3 17.9zM0 15l12.99-7.5L26 15v18.5l-13 7.5L0 33.5V15z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")
                `};case"stripes":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 100%, ${l(n,.25)}, transparent 60%),
                    linear-gradient(135deg, hsla(0,0%,0%,0.1) 23%, transparent 23%, transparent 25%, hsla(0,0%,0%,0.1) 25%, hsla(0,0%,0%,0.1) 27%, transparent 27%, transparent 73%, hsla(0,0%,0%,0.1) 73%, hsla(0,0%,0%,0.1) 75%, transparent 75%, transparent 77%, hsla(0,0%,0%,0.1) 77%)
                `};default:return{...c,backgroundColor:n}}},j_=({protocols:a,onCreateNew:n,onEdit:l,onDelete:c,onImport:i,onBack:d})=>{const[u,h]=re.useState(!1),[f,m]=re.useState(!1),[y,v]=re.useState(""),[_,w]=re.useState(""),b=u?a:a.filter(S=>!Or(S)),N=()=>{w("");try{const S=JSON.parse(y);if(!S.name||!S.color||!S.pattern||!Array.isArray(S.cards)){w("Invalid protocol format. Missing required fields.");return}if(S.cards.length!==6){w("Invalid protocol: must have exactly 6 cards.");return}const k=a.find(C=>C.name.toLowerCase()===S.name.toLowerCase());if(k){confirm(`A protocol named "${S.name}" already exists. Overwrite it?`)&&(S.id=k.id,i(S),m(!1),v(""),alert("Protocol imported and overwritten successfully!"));return}S.id=Date.now().toString(),S.createdAt=new Date().toISOString(),i(S),m(!1),v(""),alert("Protocol imported successfully!")}catch{w("Invalid JSON format. Please check your input.")}};return o.jsxs("div",{className:"protocol-list",children:[o.jsxs("div",{className:"list-header",children:[o.jsx("h2",{children:"Custom Protocols"}),o.jsxs("div",{className:"header-actions",children:[o.jsxs("label",{className:"system-protocols-toggle",children:[o.jsx("input",{type:"checkbox",checked:u,onChange:S=>h(S.target.checked)}),"Show System Protocols"]}),o.jsx("button",{onClick:()=>m(!0),className:"btn",children:"Import Protocol"}),d&&o.jsx("button",{onClick:d,className:"btn btn-back",children:"Back"})]})]}),f&&o.jsx("div",{className:"custom-protocol-modal-overlay",onClick:()=>m(!1),children:o.jsxs("div",{className:"custom-protocol-modal-content",onClick:S=>S.stopPropagation(),children:[o.jsx("h3",{children:"Import Protocol"}),o.jsx("p",{children:"Paste the protocol JSON below:"}),o.jsx("textarea",{value:y,onChange:S=>v(S.target.value),placeholder:'{"name":"Protocol Name","color":"#1976D2",...}',rows:10,className:"import-textarea"}),_&&o.jsx("div",{className:"error-message",children:_}),o.jsxs("div",{className:"custom-protocol-modal-actions",children:[o.jsx("button",{onClick:()=>m(!1),className:"btn btn-back",children:"Cancel"}),o.jsx("button",{onClick:N,className:"btn",children:"Import"})]})]})}),o.jsxs("div",{className:"protocols-grid",children:[o.jsxs("div",{className:"protocol-card new-protocol-card",onClick:n,children:[o.jsx("div",{className:"protocol-header new-protocol-header",children:o.jsxs("div",{className:"protocol-header-content",children:[o.jsx("h3",{children:"+ New Protocol"}),o.jsx("p",{className:"header-description",children:"Create a custom protocol"})]})}),o.jsx("div",{className:"protocol-body new-protocol-body"})]}),b.map(S=>{const k=Or(S);return o.jsx("div",{className:`protocol-card ${k?"system-protocol":""}`,style:E_(S.pattern,S.color),onClick:()=>l(S),children:o.jsxs("div",{className:"protocol-header-content",children:[o.jsx("h3",{children:S.name}),k&&o.jsx("span",{className:"system-badge",children:"System"}),S.description&&o.jsx("p",{className:"header-description",children:S.description})]})},S.id)})]})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Qh="customProtocolsEnabled";function Pd(){try{return localStorage.getItem(Qh)==="true"}catch{return!1}}function k_(a){try{localStorage.setItem(Qh,a?"true":"false")}catch{}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */let uc=null;function N_(){if(!uc){const a=Pd(),n=Co(),l=Qo(),c=new Set(l.filter(i=>Or(i)).map(i=>i.name));uc=n.filter(i=>c.has(i.protocol)||a)}return uc}function Bl(){uc=null}function Pa(a){const n=N_(),l=[];for(const c of a){const i=n.filter(d=>d.protocol===c);l.push(...i)}return l}function Nn(a){const n=[...a];for(let l=n.length-1;l>0;l--){const c=Math.floor(Math.random()*(l+1));[n[l],n[c]]=[n[c],n[l]]}return n}function bh({onNavigate:a,difficulty:n,setDifficulty:l,useControl:c,onUseControlChange:i}){const[d,u]=re.useState(null),[h,f]=re.useState(null),[m,y]=re.useState(null),[v,_]=re.useState([]),[w,b]=re.useState(!0),[N,S]=re.useState(0);re.useEffect(()=>{const C=new Set;for(;C.size<2&&C.size<Rn.length;)C.add(Math.floor(Math.random()*Rn.length));const j=Array.from(C).map(R=>Rn[R]);j.length>0&&(y(j[0]),f(j[0])),j.length>1&&u(j[1]),_(Nn(Rn))},[]);const k=()=>{const C=N+1;if(S(C),C>=5){const j=!w;b(j),k_(j),S(0)}};return o.jsxs("div",{className:"screen main-menu",children:[o.jsx("h1",{children:"COMPILE: MAIN 1"}),o.jsxs("div",{className:"main-menu-attribution",children:[o.jsxs("p",{children:["based on the card game ",o.jsx("a",{href:"https://boardgamegeek.com/boardgame/406652/compile-main-1",target:"_blank",rel:"noopener noreferrer",children:"Compile: Main 1"})," designed by ",o.jsx("a",{href:"https://justgravyllc.com/",target:"_blank",rel:"noopener noreferrer",children:"Michael Yang"})]}),o.jsxs("p",{children:[o.jsx("span",{onClick:k,style:{cursor:"default",userSelect:"none"},children:"developed"})," by ",o.jsx("a",{href:"https://apo-games.de/",target:"_blank",rel:"noopener noreferrer",children:"Dirk Aporius"})]})]}),o.jsxs("div",{className:"main-menu-layout",children:[o.jsx("div",{className:"main-menu-preview decorative-card",children:h&&o.jsx(kt,{card:{...h,id:"preview",isFaceUp:!0},isFaceUp:!0})}),o.jsxs("div",{className:"main-menu-actions-container",children:[o.jsxs("div",{className:"main-menu-start-group",children:[o.jsxs("div",{className:"difficulty-selector",children:[o.jsx("h3",{className:"difficulty-title",children:"Difficulty"}),o.jsxs("div",{className:"difficulty-options",children:[o.jsx("button",{className:`btn ${n==="easy"?"active":""}`,onClick:()=>l("easy"),children:"Easy"}),o.jsx("button",{className:`btn ${n==="normal"?"active":""}`,onClick:()=>l("normal"),children:"Normal"}),o.jsx("button",{className:`btn btn-wip ${n==="hard"?"active":""}`,disabled:!0,children:"Hard"})]})]}),o.jsxs("div",{className:"control-mechanic-selector",children:[o.jsx("input",{type:"checkbox",id:"control-mechanic",checked:c,onChange:C=>i(C.target.checked)}),o.jsx("label",{htmlFor:"control-mechanic",children:"Use Control Mechanic"})]}),o.jsx("button",{className:"btn btn-start",onClick:()=>a("ProtocolSelection"),children:"Start Game"})]}),o.jsxs("div",{className:"main-menu-other-actions",children:[o.jsx("button",{className:"btn",onClick:()=>a("CardLibrary"),children:"Cards"}),o.jsx("button",{className:"btn",onClick:()=>a("Statistics"),children:"Statistics"}),w&&o.jsx("button",{className:"btn",onClick:()=>a("CustomProtocols"),children:"Custom Protocols"}),o.jsx("button",{className:"btn",onClick:()=>a("Rules"),children:"Rules"}),o.jsx("p",{className:"version-info",children:"Version 0.26"})]})]}),o.jsx("div",{className:"decorative-card decorative-card-right",children:d&&o.jsx(kt,{card:{...d,id:"deco-2",isFaceUp:!0},isFaceUp:!0})})]}),o.jsx("div",{className:"card-ticker-container",onPointerLeave:()=>f(m),children:o.jsxs("div",{className:"card-ticker-track",children:[v.map((C,j)=>o.jsx(kt,{card:{...C,id:`ticker-1-${j}`,isFaceUp:!0},isFaceUp:!0,additionalClassName:"in-hand",onPointerEnter:()=>f(C)},`ticker-1-${j}`)),v.map((C,j)=>o.jsx(kt,{card:{...C,id:`ticker-2-${j}`,isFaceUp:!0},isFaceUp:!0,additionalClassName:"in-hand",onPointerEnter:()=>f(C)},`ticker-2-${j}`))]})})]})}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function gc({title:a,onBack:n}){return o.jsxs("header",{className:"app-header",children:[o.jsx("h2",{children:a}),n&&o.jsx("button",{className:"btn btn-back",onClick:n,children:"Back"})]})}const sc=[{player:"Player",picks:1},{player:"Opponent",picks:2},{player:"Player",picks:2},{player:"Opponent",picks:1}];function R_({onBack:a,onStartGame:n}){const[l,c]=re.useState(0),[i,d]=re.useState([]),[u,h]=re.useState([]),[f,m]=re.useState([]),[y,v]=re.useState(!1),[_,w]=re.useState(null),[b,N]=re.useState(null),[S,k]=re.useState(0);re.useEffect(()=>{Bl(),k(H=>H+1)},[]);const C=re.useMemo(()=>{const H=Pd(),B=Co(),ee=Qo(),de=new Set(ee.filter(pe=>Or(pe)).map(pe=>pe.name)),J=B.filter(pe=>de.has(pe.protocol)||H);return console.log("[Protocol Selection] Total cards loaded:",J.length,"(custom enabled:",H,")"),J},[S]),j=re.useMemo(()=>{const H=new Set(C.map(ee=>ee.protocol)),B=Array.from(H).sort();return console.log("[Protocol Selection] Unique protocols:",B),B},[C]),R=re.useMemo(()=>{const H=new Set(C.map(B=>B.category));return Array.from(H).sort()},[C]),F=["Fan-Content","Main 2"],[L,U]=re.useState(new Set),[Q,X]=re.useState(!1);re.useEffect(()=>{if(R.length>0&&!Q){const H=new Set(R);F.forEach(B=>H.delete(B)),U(H),X(!0)}},[R,Q]);const V=H=>{const B=C.find(ee=>ee.protocol===H);return(B==null?void 0:B.category)||""},$=H=>{const ee=C.find(de=>de.protocol===H);return ee!=null&&ee.color?{"--card-custom-color":ee.color,borderColor:ee.color}:{}},E=H=>{const ee=C.find(de=>de.protocol===H);return ee!=null&&ee.pattern?`pattern-${ee.pattern}`:""},A=re.useMemo(()=>j.filter(H=>{const B=V(H);return L.has(B)}),[L]),O=H=>{U(B=>{const ee=new Set(B);return ee.has(H)?ee.delete(H):ee.add(H),ee})},I=sc[l],T=(I==null?void 0:I.player)==="Player",q=(I==null?void 0:I.player)==="Opponent",Y=re.useMemo(()=>new Set([...i,...u]),[i,u]),K=re.useMemo(()=>f.map(H=>({name:H,cards:C.filter(B=>B.protocol===H).sort((B,ee)=>B.value-ee.value)})),[f]),P=H=>{if(!T||y)return;const B=C.filter(ee=>ee.protocol===H).sort((ee,de)=>ee.value-de.value);B.length>0&&N(B[0]),m(ee=>{if(ee.includes(H))return ee.filter(de=>de!==H);if(ee.length<I.picks)return[...ee,H];if(ee.length===I.picks){const de=ee.slice(1);return de.push(H),de}return ee})},Z=async()=>{if(!T||y||f.length!==I.picks)return;v(!0);const H=[...f];m([]);for(const B of H)d(ee=>[...ee,B]),await new Promise(ee=>setTimeout(ee,300));v(!1),c(B=>B+1)};re.useEffect(()=>{q&&!y&&l<sc.length&&(async()=>{v(!0),await new Promise(ye=>setTimeout(ye,100));const B=[],ee=j.filter(ye=>{if(Y.has(ye))return!1;const ke=V(ye);return L.has(ke)}),de=j.filter(ye=>!Y.has(ye)),J=ee.length>=I.picks?[...ee]:[...de],pe=[],fe=B.filter(ye=>J.includes(ye));for(let ye=0;ye<I.picks;ye++)if(fe.length>0){const ke=fe.shift();pe.push(ke);const Ve=J.indexOf(ke);Ve>-1&&J.splice(Ve,1)}else if(J.length>0){const ke=Math.floor(Math.random()*J.length);pe.push(J.splice(ke,1)[0])}for(const ye of pe)await new Promise(ke=>setTimeout(ke,1e3)),w(ye),await new Promise(ke=>setTimeout(ke,1e3)),w(null),h(ke=>[...ke,ye]);v(!1),c(ye=>ye+1)})()},[l,q,y,Y,I,L,j,V]),re.useEffect(()=>{l>=sc.length&&!y&&setTimeout(()=>{n(i,u)},1e3)},[l,y,n,i,u]);const W=H=>{const B=["protocol-card",`card-protocol-${H.toLowerCase()}`];return f.includes(H)&&B.push("selected"),Y.has(H)&&B.push("chosen"),_===H&&B.push("is-scanning"),B.join(" ")},G=()=>y&&q?"Opponent is selecting protocols...":(I==null?void 0:I.player)==="Player"?`Player, select ${I.picks} protocol(s). (${f.length}/${I.picks})`:l>=sc.length?"Finalizing selections...":"Waiting for Opponent...";return o.jsxs("div",{className:"screen protocol-selection-screen",children:[o.jsx(gc,{title:"Protocol Selection",onBack:a}),o.jsxs("div",{className:"protocol-selection-layout",children:[o.jsxs("div",{className:"protocol-selection-sidebar",children:[o.jsxs("div",{className:"player-protocols-area",children:[o.jsx("h3",{children:"Your Protocols"}),i.map(H=>o.jsx("div",{className:`protocol-display-card player card-protocol-${H.toLowerCase()} ${E(H)}`,style:$(H),children:H},H))]}),o.jsx("div",{className:"protocol-preview-area",children:b?o.jsx(kt,{card:{...b,id:"preview",isFaceUp:!0},isFaceUp:!0}):o.jsx("p",{children:K.length>0?"Hover over a card below to see details.":"Select a protocol to see its cards."})})]}),o.jsxs("div",{className:"protocol-grid-container",children:[o.jsx("p",{children:G()}),o.jsx("div",{className:"category-filters",children:R.map(H=>o.jsxs("label",{className:"category-filter-item",children:[o.jsx("input",{type:"checkbox",checked:L.has(H),onChange:()=>O(H)}),o.jsx("span",{children:H})]},H))}),o.jsx("div",{className:"protocol-grid-scroll-wrapper",children:o.jsx("div",{className:"protocol-grid",children:A.map(H=>{const B=$(H),de={fontSize:H.length>10?"0.65em":"1em"};return o.jsxs("div",{className:`${W(H)} ${E(H)}`,style:B,onClick:()=>P(H),role:"button","aria-disabled":Y.has(H)||!T||y,tabIndex:!Y.has(H)&&T&&!y?0:-1,onKeyPress:J=>J.key==="Enter"&&P(H),children:[o.jsx("span",{className:"protocol-category-label",children:V(H)}),o.jsx("span",{className:"protocol-name",style:de,children:H})]},H)})})}),T&&o.jsx("button",{className:"btn",onClick:Z,disabled:y||f.length!==(I==null?void 0:I.picks),children:"Confirm Selection"})]}),o.jsxs("div",{className:"opponent-protocols-area",children:[o.jsx("h3",{children:"Opponent Protocols"}),u.map(H=>o.jsx("div",{className:`protocol-display-card opponent card-protocol-${H.toLowerCase()} ${E(H)}`,style:$(H),children:H},H))]})]}),o.jsx("div",{className:"selected-protocol-cards-container",children:K.length>0&&[...K].reverse().map(H=>o.jsx("div",{className:"protocol-card-row",children:H.cards.map(B=>o.jsx(kt,{card:{...B,id:`selection-${B.protocol}-${B.value}`,isFaceUp:!0},isFaceUp:!0,additionalClassName:"in-hand",onClick:()=>N(B),onPointerEnter:()=>N(B)},`${H.name}-${B.value}`))},H.name))})]})}const A_="modulepreload",T_=function(a){return"/"+a},Sh={},D_=function(n,l,c){let i=Promise.resolve();if(l&&l.length>0){let u=function(m){return Promise.all(m.map(y=>Promise.resolve(y).then(v=>({status:"fulfilled",value:v}),v=>({status:"rejected",reason:v}))))};document.getElementsByTagName("link");const h=document.querySelector("meta[property=csp-nonce]"),f=(h==null?void 0:h.nonce)||(h==null?void 0:h.getAttribute("nonce"));i=u(l.map(m=>{if(m=T_(m),m in Sh)return;Sh[m]=!0;const y=m.endsWith(".css"),v=y?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${m}"]${v}`))return;const _=document.createElement("link");if(_.rel=y?"stylesheet":A_,y||(_.as="script"),_.crossOrigin="",_.href=m,f&&_.setAttribute("nonce",f),document.head.appendChild(_),y)return new Promise((w,b)=>{_.addEventListener("load",w),_.addEventListener("error",()=>b(new Error(`Unable to preload CSS for ${m}`)))})}))}function d(u){const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=u,window.dispatchEvent(h),!h.defaultPrevented)throw u}return i.then(u=>{for(const h of u||[])h.status==="rejected"&&d(h.reason);return n().catch(d)})},en=[];for(let a=0;a<256;++a)en.push((a+256).toString(16).slice(1));function F_(a,n=0){return(en[a[n+0]]+en[a[n+1]]+en[a[n+2]]+en[a[n+3]]+"-"+en[a[n+4]]+en[a[n+5]]+"-"+en[a[n+6]]+en[a[n+7]]+"-"+en[a[n+8]]+en[a[n+9]]+"-"+en[a[n+10]]+en[a[n+11]]+en[a[n+12]]+en[a[n+13]]+en[a[n+14]]+en[a[n+15]]).toLowerCase()}let wd;const q_=new Uint8Array(16);function $_(){if(!wd){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");wd=crypto.getRandomValues.bind(crypto)}return wd(q_)}const I_=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Eh={randomUUID:I_};function Xe(a,n,l){var i;if(Eh.randomUUID&&!a)return Eh.randomUUID();a=a||{};const c=a.random??((i=a.rng)==null?void 0:i.call(a))??$_();if(c.length<16)throw new Error("Random bytes length must be >= 16");return c[6]=c[6]&15|64,c[8]=c[8]&63|128,F_(c)}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const ae=(a,n,l,c)=>{let i=a._logIndentLevel||0;a._currentPhaseContext&&i===0&&(i=1);const d={player:n,message:l,indentLevel:i,sourceCard:a._currentEffectSource,phase:a._currentPhaseContext,sourceCardRef:c==null?void 0:c.sourceCardRef,targetCardRefs:c==null?void 0:c.targetCardRefs};return{...a,log:[...a.log,d]}},Oa=a=>({...a,_logIndentLevel:(a._logIndentLevel||0)+1}),_o=a=>({...a,_logIndentLevel:Math.max(0,(a._logIndentLevel||0)-1)}),Me=(a,n)=>({...a,_currentEffectSource:n}),Ge=(a,n)=>({...a,_currentPhaseContext:n});/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function _n(a){const n=[];for(const l of["player","opponent"])a[l].lanes.forEach((c,i)=>{c.forEach((d,u)=>{if(d.isFaceUp){const h=d;if(h.customEffects){const f=u===c.length-1;(h.customEffects.topEffects||[]).forEach(v=>{v.params.action==="passive_rule"&&v.trigger==="passive"&&n.push({rule:v.params.rule,cardOwner:l,laneIndex:i,sourceCardId:d.id})}),(h.customEffects.middleEffects||[]).forEach(v=>{v.params.action==="passive_rule"&&v.trigger==="passive"&&n.push({rule:v.params.rule,cardOwner:l,laneIndex:i,sourceCardId:d.id})}),f&&(h.customEffects.bottomEffects||[]).forEach(_=>{_.params.action==="passive_rule"&&_.trigger==="passive"&&n.push({rule:_.params.rule,cardOwner:l,laneIndex:i,sourceCardId:d.id})})}d.protocol==="Frost"&&d.value===1&&(n.push({rule:{type:"block_flips",target:"all",scope:"global"},cardOwner:l,laneIndex:i}),u===c.length-1&&n.push({rule:{type:"block_protocol_rearrange",target:"all",scope:"global"},cardOwner:l,laneIndex:i})),d.protocol==="Frost"&&d.value===3&&n.push({rule:{type:"block_shifts_from_and_to_lane",target:"all",scope:"this_lane"},cardOwner:l,laneIndex:i})}})});return n}function La(a,n,l,c,i,d){var b,N,S;const u=_n(a),h=n==="player"?"opponent":"player",f=a[n].protocols[l],m=a[h].protocols[l],y=i===f||i===m;let v=!1;if(d){const k=d;v=[...((b=k.customEffects)==null?void 0:b.topEffects)||[],...((N=k.customEffects)==null?void 0:N.middleEffects)||[],...((S=k.customEffects)==null?void 0:S.bottomEffects)||[]].some(j=>{var R,F,L;return((R=j.params)==null?void 0:R.action)==="passive_rule"&&((L=(F=j.params)==null?void 0:F.rule)==null?void 0:L.type)==="allow_play_on_opponent_side"})}for(const{rule:k,cardOwner:C,laneIndex:j}of u){const R=k.scope==="global"||j===l,F=k.target==="all"||k.target==="self"&&C===n||k.target==="opponent"&&C===h;if(!(!R||!F))switch(k.type){case"block_all_play":return{allowed:!1,reason:"Cannot play cards in this lane (passive rule)"};case"block_face_down_play":if(!c)return{allowed:!1,reason:"Cannot play cards face-down in this lane (passive rule)"};break;case"block_face_up_play":if(c)return{allowed:!1,reason:"Cannot play cards face-up in this lane (passive rule)"};break;case"require_face_down_play":if(c)return{allowed:!1,reason:"Can only play cards face-down (passive rule)"};break;case"allow_any_protocol_play":break;case"require_non_matching_protocol":if(c&&y)return{allowed:!1,reason:"Can only play cards without matching protocols (passive rule)"};break}}const _=u.some(({rule:k,cardOwner:C,laneIndex:j})=>{if(k.type!=="allow_any_protocol_play")return!1;const R=k.scope==="global"||j===l,F=k.target==="all"||k.target==="self"&&C===n||k.target==="opponent"&&C===h;return R&&F}),w=u.some(({rule:k,cardOwner:C,laneIndex:j})=>{if(k.type!=="require_non_matching_protocol")return!1;const R=k.scope==="global"||j===l,F=k.target==="all"||k.target==="self"&&C===n||k.target==="opponent"&&C===h;return R&&F});return c&&!y&&!_&&!w&&!v?{allowed:!1,reason:"Face-up play requires matching protocol"}:{allowed:!0}}function vc(a){return _n(a).some(({rule:l})=>l.type==="require_non_matching_protocol"&&l.scope==="global")}function _c(a,n,l){const c=_n(a),i=n==="player"?"opponent":"player";return c.some(({rule:d,cardOwner:u,laneIndex:h})=>{if(d.type!=="allow_any_protocol_play")return!1;const f=d.scope==="global"||l!==void 0&&h===l,m=d.target==="all"||d.target==="self"&&u===n||d.target==="opponent"&&u===i;return f&&m})}function Wl(a,n){const l=n.customEffects;return l?(l.bottomEffects||[]).some(i=>{var d,u,h;return((d=i.params)==null?void 0:d.action)!=="passive_rule"?!1:((h=(u=i.params)==null?void 0:u.rule)==null?void 0:h.type)==="allow_play_on_opponent_side"}):!1}function U_(a,n){const l=_n(a);for(const{rule:c,laneIndex:i}of l)if(!(c.type!=="block_flips"||!(c.scope==="global"||i===n)))return{allowed:!1,reason:"Cards cannot be flipped face-up in this lane (passive rule)"};return{allowed:!0}}function Ql(a,n,l){const c=_n(a);for(const{rule:i,laneIndex:d}of c){if(i.type==="block_shifts_from_lane"&&d===n)return i.scope,{allowed:!1,reason:"Cards cannot shift from this lane (passive rule)"};if(i.type==="block_shifts_to_lane"&&d===l)return i.scope,{allowed:!1,reason:"Cards cannot shift to this lane (passive rule)"};if(i.type==="block_shifts_from_and_to_lane"&&(d===n||d===l))return{allowed:!1,reason:"Cards cannot shift from or to this lane (passive rule)"}}return{allowed:!0}}function P_(a){const n=_n(a);for(const{rule:l}of n)if(l.type==="block_protocol_rearrange")return{allowed:!1,reason:"Protocols cannot be rearranged (passive rule)"};return{allowed:!0}}function L_(a,n,l){const c=_n(a),i=a.turn;for(const{rule:d,cardOwner:u,laneIndex:h,sourceCardId:f}of c)if(!(d.type!=="ignore_middle_commands"||!(d.scope==="global"||h===n))&&!(d.onlyDuringYourTurn&&i!==u)){if(l!==void 0){const y=u==="player"?"opponent":"player";if(d.target==="opponent"&&l!==y||d.target==="self"&&l!==u)continue}if(f)for(const y of["player","opponent"])for(const v of a[y].lanes){const _=v.find(w=>w.id===f);if(_)return _}return null}return null}function ma(a){return _n(a).some(({rule:l})=>l.type==="block_flips"&&l.scope==="global")}function O_(a){return _n(a).some(({rule:l})=>l.type==="block_protocol_rearrange")}function Yl(a,n){const l=_n(a);for(const{rule:c,sourceCardId:i}of l)if(c.type==="block_flip_this_card"&&i===n)return{allowed:!1,reason:"This card cannot be flipped (passive rule)"};return{allowed:!0}}function Ld(a,n){const l=_n(a);for(const{rule:c,cardOwner:i}of l)if(c.type==="block_draw_conditional"){const u=(c.conditionTarget||"self")==="self"?i:i==="player"?"opponent":"player",h=c.blockTarget||"self";let f;if(h==="self"?f=i:h==="opponent"?f=i==="player"?"opponent":"player":f="all",a[u].hand.length>0&&(f==="all"||f===n))return{allowed:!1,reason:"Cannot draw cards (passive rule)"}}return{allowed:!0}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const M_={},H_={},z_={},V_={};function Zl(a,n,l,c){const{cardOwner:i,opponent:d,triggerType:u}=c,h=l[i].lanes[n];if(!h.find(b=>b.id===a.id))return{newState:l};if(!(u==="uncover"||h.length>0&&h[h.length-1].id===a.id))return{newState:l};const y=L_(l,n,i);if(y){const b=`${a.protocol}-${a.value}`,N=`${y.protocol}-${y.value}`;return{newState:ae(l,i,`${b}: Effect blocked by ${N}.`)}}const v=a;if(v.customEffects&&v.customEffects.middleEffects&&v.customEffects.middleEffects.length>0){let b=Oa(l);const N=`${a.protocol}-${a.value}`;b=Me(b,N),b=Ge(b,"middle");let S=b;const k=S._pendingCustomEffects;if(k&&k.sourceCardId!==a.id){const R=S.lastCustomEffectTargetCardId,F={type:"execute_remaining_custom_effects",sourceCardId:k.sourceCardId,laneIndex:k.laneIndex,effects:k.effects,context:k.context,actor:k.context.cardOwner,selectedCardFromPreviousEffect:R||k.selectedCardFromPreviousEffect,savedLastCustomEffectTargetCardId:S.lastCustomEffectTargetCardId,logSource:k.logSource,logPhase:k.logPhase,logIndentLevel:k.logIndentLevel},L=S._deferredParentEffects||[];S={...S,_deferredParentEffects:[...L,F]},delete S._pendingCustomEffects}S.lastCustomEffectTargetCardId&&(S={...S,lastCustomEffectTargetCardId:null});for(let R=0;R<v.customEffects.middleEffects.length;R++){const F=v.customEffects.middleEffects[R],L=v.customEffects.middleEffects.slice(R+1),U=L.length>0;if(U&&(S._pendingCustomEffects={sourceCardId:a.id,laneIndex:n,context:c,effects:L,logSource:S._currentEffectSource,logPhase:S._currentPhaseContext,logIndentLevel:S._logIndentLevel||0}),S=ct(a,n,S,c,F).newState,S.actionRequired)return{newState:we(S)};const X=S._pendingCustomEffects;X&&U&&X.sourceCardId===a.id&&delete S._pendingCustomEffects}const C=S._deferredParentEffects;if(C&&C.length>0){const R=C[C.length-1],F=C.slice(0,-1);S={...S,_deferredParentEffects:F.length>0?F:void 0,lastCustomEffectTargetCardId:R.savedLastCustomEffectTargetCardId||R.selectedCardFromPreviousEffect,_pendingCustomEffects:{sourceCardId:R.sourceCardId,laneIndex:R.laneIndex,context:R.context,effects:R.effects,selectedCardFromPreviousEffect:R.selectedCardFromPreviousEffect,logSource:R.logSource,logPhase:R.logPhase,logIndentLevel:R.logIndentLevel}}}return{newState:we(S)}}const _=`${a.protocol}-${a.value}`,w=M_[_];if(w){let b=Oa(l);const N=`${a.protocol}-${a.value}`;b=Me(b,N),b=Ge(b,"middle");const S=w(a,n,b,c);let k=S.newState;const C=we(k);return{...S,newState:C}}return{newState:l}}function Od(a,n,l,c){if(!a.isFaceUp)return{newState:l};const i=a;if(i.customEffects){const f=[...i.customEffects.topEffects||[],...i.customEffects.middleEffects||[],...i.customEffects.bottomEffects||[]].filter(m=>m.trigger==="on_cover"||m.trigger==="on_cover_or_flip");if(f.length>0){const m=`${a.protocol}-${a.value}`;let y=Me(l,m);y=Ge(y,"oncover");let v=y;const _=[];for(const b of f){const N=ct(a,n,v,c,b);if(v=N.newState,N.animationRequests&&_.push(...N.animationRequests),v.actionRequired)return{newState:we(v),animationRequests:_.length>0?_:void 0}}return{newState:we(v),animationRequests:_.length>0?_:void 0}}}const d=`${a.protocol}-${a.value}`,u=V_[d];if(u){const h=`${a.protocol}-${a.value}`;let f=Me(l,h);f=Ge(f,"oncover");const m=u(a,n,f,c),y=we(m.newState);return{...m,newState:y}}return{newState:l}}function B_(a,n,l){const c=[],i=new Set,d=l==="Start"?"start":"end";return a[n].lanes.flat().forEach(u=>{var f;if(!u.isFaceUp||i.has(u.id))return;const h=u;if((f=h.customEffects)!=null&&f.topEffects){const m=h.customEffects.topEffects.filter(y=>y.trigger===d);m.length>0&&(c.push({cardId:u.id,box:"top",effectIds:m.map(y=>y.id)}),i.add(u.id))}u.top.includes(`'emphasis'>${l}:`)&&(i.has(u.id)||(c.push({cardId:u.id,box:"top",effectIds:[]}),i.add(u.id)))}),a[n].lanes.forEach(u=>{var m;if(u.length===0)return;const h=u[u.length-1];if(!h.isFaceUp||i.has(h.id))return;const f=h;if((m=f.customEffects)!=null&&m.bottomEffects){const y=f.customEffects.bottomEffects.filter(v=>v.trigger===d);y.length>0&&(c.push({cardId:h.id,box:"bottom",effectIds:y.map(v=>v.id)}),i.add(h.id))}h.bottom.includes(`'emphasis'>${l}:`)&&(i.has(h.id)||(c.push({cardId:h.id,box:"bottom",effectIds:[]}),i.add(h.id)))}),c}function Y_(a,n,l){for(let c=0;c<a[n].lanes.length;c++){const i=a[n].lanes[c],d=i.find(u=>u.id===l.cardId);if(d)return!d.isFaceUp||l.box==="bottom"&&!(i.length>0&&i[i.length-1].id===d.id)?null:{card:d,laneIndex:c}}return null}function G_(a,n,l){const c=a,i=l==="Start"?"start":"end";if(c.customEffects){const h=n==="top"?c.customEffects.topEffects:c.customEffects.bottomEffects,f=(h==null?void 0:h.filter(m=>m.trigger===i))||[];if(f.length>0)return f.map(y=>{var w,b;const v=((w=y.params)==null?void 0:w.action)||"effect",_=(b=y.params)==null?void 0:b.count;return _?`${v} ${_}`:v}).join(", ")}const u=(n==="top"?a.top:a.bottom).match(new RegExp(`${l}:\\s*</span>\\s*([^<]+)`,"i"));return u?u[1].trim():l+" effect"}function pc(a,n,l){const c=a.turn;let i={...a,_logIndentLevel:0};const d=n==="Start",u=d?"_startPhaseEffectSnapshot":"_endPhaseEffectSnapshot",h=d?"_selectedStartEffectId":"_selectedEndEffectId",f=i[h];let m=i[u];m&&m.length>0&&(m.some(U=>i[c].lanes.flat().some(Q=>Q.id===U.cardId))||(m=void 0,i[u]=void 0)),m||(m=B_(i,c,n),i[u]=m);const y=d?i.processedStartEffectIds||[]:i.processedEndEffectIds||[],v=[];for(const L of m){if(y.includes(L.cardId))continue;const Q=Y_(i,c,L);Q&&v.push({entry:L,card:Q.card,laneIndex:Q.laneIndex})}if(v.length===0)return i[u]=void 0,i[h]=void 0,{newState:i};let _;if(f&&(_=v.find(L=>L.entry.cardId===f),_||console.warn(`[processTriggeredEffects] Selected effect ${f} not found in valid effects!`),i[h]=void 0),!_){if(v.length>1){const L=v.map(({entry:U,card:Q})=>({cardId:U.cardId,cardName:`${Q.protocol}-${Q.value}`,box:U.box,effectDescription:G_(Q,U.box,n)}));return i.actionRequired={type:"select_phase_effect",actor:c,phase:n,availableEffects:L},{newState:i}}_=v[0]}const{entry:w,card:b,laneIndex:N}=_,S=c==="player"?"opponent":"player",k={cardOwner:c,actor:c,currentTurn:a.turn,opponent:S,triggerType:n==="Start"?"start":"end"},C=b,j=n==="Start"?"start":"end";if(C.customEffects){const L=w.box==="top"?C.customEffects.topEffects:C.customEffects.bottomEffects,U=(L==null?void 0:L.filter(Q=>Q.trigger===j))||[];if(U.length>0){const Q=`${b.protocol}-${b.value}`,X=n==="Start"?"start":"end";i=Me(i,Q),i=Ge(i,X);const V={...i,_currentPhaseContext:void 0},$=ae(V,c,`${n} effect triggers.`);i={...i,log:$.log},i=Oa(i);for(let E=0;E<U.length;E++){const A=U[E],O=ct(b,N,i,k,A);if(i=we(O.newState),i.actionRequired){const I=U.slice(E+1);return I.length>0&&(i._pendingCustomEffects={sourceCardId:b.id,laneIndex:N,context:k,effects:I,logSource:i._currentEffectSource,logPhase:i._currentPhaseContext,logIndentLevel:i._logIndentLevel||0}),d?i.processedStartEffectIds=[...i.processedStartEffectIds||[],b.id]:i.processedEndEffectIds=[...i.processedEndEffectIds||[],b.id],{newState:i}}}return d?i.processedStartEffectIds=[...i.processedStartEffectIds||[],b.id]:i.processedEndEffectIds=[...i.processedEndEffectIds||[],b.id],i=_o(i),i=Me(i,void 0),i=Ge(i,void 0),pc(i,n,l)}}const R=`${b.protocol}-${b.value}`,F=l[R];if(F){const L=`${b.protocol}-${b.value}`,U=n==="Start"?"start":"end";i=Me(i,L),i=Ge(i,U);const Q={...i,_currentPhaseContext:void 0},X=ae(Q,c,`${n} effect triggers.`);i={...i,log:X.log},i=Oa(i);const V=F(b,i,k);return i=we(V.newState),d?i.processedStartEffectIds=[...i.processedStartEffectIds||[],b.id]:i.processedEndEffectIds=[...i.processedEndEffectIds||[],b.id],i.actionRequired?{newState:i}:(i=_o(i),i=Me(i,void 0),i=Ge(i,void 0),pc(i,n,l))}return{newState:i}}function Md(a){return pc(a,"Start",H_)}function Xh(a){return pc(a,"End",z_)}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const W_=a=>{if(!a.useControlMechanic)return a;const n=a.turn,l=n==="player"?"opponent":"player",c=a[n],i=a[l];let d=0;const u=c.laneValues[0],h=c.laneValues[1],f=c.laneValues[2],m=i.laneValues[0],y=i.laneValues[1],v=i.laneValues[2];if(u>m&&d++,h>y&&d++,f>v&&d++,d>=2&&a.controlCardHolder!==n){let _=Me(a,void 0);return _=Ge(_,void 0),_={..._,_logIndentLevel:0},_=ae(_,n,`${n==="player"?"Player":"Opponent"} gains the Control Component.`),{..._,controlCardHolder:n}}return a},Mr=a=>{if(a.winner)return a;const n=a.turn;let l={...a};switch(l=Me(l,void 0),l=Ge(l,void 0),l={...l,_logIndentLevel:0},a.phase){case"start":return l=Md(l).newState,l.actionRequired?l:(l=Me(l,void 0),l=Ge(l,void 0),l={...l,_logIndentLevel:0},l._startPhaseEffectSnapshot=void 0,{...l,phase:"control"});case"control":{const c=W_(l);let i=Me(c,void 0);return i=Ge(i,void 0),i={...i,_logIndentLevel:0},{...i,phase:"compile"}}case"compile":{const c=nm(l,n);return c.length>0?{...l,compilableLanes:c}:(l=Me(l,void 0),l=Ge(l,void 0),l={...l,_logIndentLevel:0},{...l,phase:"action",compilableLanes:[]})}case"action":return l=Me(l,void 0),l=Ge(l,void 0),l={...l,_logIndentLevel:0},{...l,phase:"hand_limit"};case"hand_limit":{const c=l[n],i=c.lanes.some(h=>h.length>0&&h[h.length-1].isFaceUp&&h[h.length-1].protocol==="Spirit"&&h[h.length-1].value===0),u=_n(l).some(({rule:h,cardOwner:f})=>h.type==="skip_check_cache_phase"&&(h.target==="self"&&f===n||h.target==="all")&&f===n);if(i||u){let h=ae(l,n,"Skipping Check Cache phase.");return h=Me(h,void 0),h=Ge(h,void 0),h={...h,_logIndentLevel:0},{...h,phase:"end"}}if(c.hand.length>5){const h=c.hand.length-5;let m=ae(l,n,`Check Cache: ${n==="player"?"Player":"Opponent"} has ${c.hand.length} cards, must discard ${h}.`);return m=Oa(m),{...m,actionRequired:{type:"discard",actor:n,count:h}}}return l=Me(l,void 0),l=Ge(l,void 0),l={...l,_logIndentLevel:0},{...l,phase:"end"}}case"end":{const c={...l};l=Xh(l).newState;const i=c.actionRequired,d=l.actionRequired;if(d&&d!==i||l.queuedActions&&l.queuedActions.length>0&&(l=Hr(l),l.actionRequired))return l;const u=n==="player"?"opponent":"player",h={...l[n],cannotCompile:!1};return l=Me(l,void 0),l=Ge(l,void 0),l={...l,_logIndentLevel:0},l=we(l),{...l,[n]:h,turn:u,phase:"start",processedStartEffectIds:[],processedEndEffectIds:[],processedSpeed1TriggerThisTurn:!1,processedUncoverEventIds:[],_startPhaseEffectSnapshot:void 0,_endPhaseEffectSnapshot:void 0,_interruptedTurn:void 0,_interruptedPhase:void 0}}}return a};function Ke(a){var h;const n=a._pendingCustomEffects;if(!n||n.effects.length===0)return a;const l=n.effects.map(f=>f.id).join(",");if((h=a.queuedActions)==null?void 0:h.some(f=>{var m;return f.type==="execute_remaining_custom_effects"&&f.sourceCardId===n.sourceCardId&&((m=f.effects)==null?void 0:m.map(y=>y.id).join(","))===l})){const f={...a};return delete f._pendingCustomEffects,f}const i=n.selectedCardFromPreviousEffect||a.lastCustomEffectTargetCardId,d={type:"execute_remaining_custom_effects",sourceCardId:n.sourceCardId,laneIndex:n.laneIndex,effects:n.effects,context:n.context,actor:n.context.cardOwner,selectedCardFromPreviousEffect:i,logSource:n.logSource,logPhase:n.logPhase,logIndentLevel:n.logIndentLevel},u={...a,queuedActions:[d,...a.queuedActions||[]]};return delete u._pendingCustomEffects,u}const ya=a=>{var c,i;let n=Ke(a);if(!n.queuedActions||n.queuedActions.length===0){const d=n._deferredParentEffects;if(d&&d.length>0&&!n.actionRequired){const u=d[d.length-1],h=d.slice(0,-1),f={type:"execute_remaining_custom_effects",sourceCardId:u.sourceCardId,laneIndex:u.laneIndex,effects:u.effects,context:u.context,actor:u.actor||((c=u.context)==null?void 0:c.cardOwner),selectedCardFromPreviousEffect:u.selectedCardFromPreviousEffect,savedLastCustomEffectTargetCardId:u.savedLastCustomEffectTargetCardId,logSource:u.logSource,logPhase:u.logPhase,logIndentLevel:u.logIndentLevel};return ya({...n,_deferredParentEffects:h.length>0?h:void 0,lastCustomEffectTargetCardId:u.savedLastCustomEffectTargetCardId||u.selectedCardFromPreviousEffect,queuedActions:[f]})}return n}let l=[...n.queuedActions];for(;l.length>0;){const d=l.shift();if(d.sourceCardId&&d.type!=="flip_self"){const u=_e(n,d.sourceCardId);if(!u||!u.card.isFaceUp){const h=u?`${u.card.protocol}-${u.card.value}`:"a card",f=n._logSource;n=Me(n,h),n=ae(n,d.actor,"Queued effect was cancelled because the source is no longer active."),n=Me(n,f);continue}}if(d.type==="flip_self"){const{sourceCardId:u,actor:h}=d,f=_e(n,u),m=vo(n,u);if(f&&f.card.isFaceUp&&m){const y=`${f.card.protocol}-${f.card.value}`;n=ae(n,h,`${y}: Flips itself.`),n=Wo(new Set([u]),n),n.animationState={type:"flipCard",cardId:u}}else{const y=f?`${f.card.protocol}-${f.card.value}`:"the source card",v=f?f.card.isFaceUp?"now covered":"flipped face-down":"deleted";n=ae(n,h,`The self-flip effect from ${y} was cancelled because it is ${v}.`)}continue}if(d.type==="execute_follow_up_effect"){const{sourceCardId:u,followUpEffect:h,actor:f,logContext:m}=d,y=_e(n,u),v=vo(n,u);if(y&&y.card.isFaceUp&&v){const _=n[y.owner].lanes.find(C=>C.some(j=>j.id===u)),w=n[y.owner].lanes.indexOf(_),b={cardOwner:y.owner,actor:f,currentTurn:n.turn,opponent:y.owner==="player"?"opponent":"player"},N=(m==null?void 0:m.sourceCardName)||`${y.card.protocol}-${y.card.value}`,S=(m==null?void 0:m.phase)||(n.phase==="start"?"start":"end");if(n={...n,_logIndentLevel:(m==null?void 0:m.indentLevel)||1,_currentEffectSource:N,_currentPhaseContext:S},n=ct(y.card,w,n,b,h).newState,n.actionRequired)return n={...n,queuedActions:l},n}else{const _=y?`${y.card.protocol}-${y.card.value}`:"the source card",w=y?y.card.isFaceUp?"now covered":"flipped face-down":"deleted";n=ae(n,f,`The follow-up effect from ${_} was cancelled because it is ${w}.`)}continue}if(d.type==="execute_conditional_followup"){const{sourceCardId:u,laneIndex:h,followUpEffect:f,context:m,actor:y}=d,v=[...n.player.lanes.flat(),...n.opponent.lanes.flat()].find(w=>w.id===u);if(!v){n=ae(n,y,"Conditional follow-up effect skipped: source card no longer exists.");continue}if(!v.isFaceUp){const w=`${v.protocol}-${v.value}`;n=ae(n,y,`Conditional follow-up effect from ${w} cancelled: card was flipped face-down.`);continue}const _=ct(v,h,n,m,f);if(n=we(_.newState),n.actionRequired)return f.conditional&&f.conditional.thenEffect&&(n.actionRequired={...n.actionRequired,followUpEffect:f.conditional.thenEffect,conditionalType:f.conditional.type}),n={...n,queuedActions:l},n;if(f.conditional&&f.conditional.thenEffect){const w=ct(v,h,n,m,f.conditional.thenEffect);if(n=we(w.newState),n.actionRequired)return n={...n,queuedActions:l},n}continue}if(d.type==="execute_remaining_custom_effects"){const{sourceCardId:u,laneIndex:h,effects:f,context:m,selectedCardFromPreviousEffect:y,logSource:v,logPhase:_,logIndentLevel:w}=d;v!==void 0&&(n={...n,_currentEffectSource:v}),_!==void 0&&(n={...n,_currentPhaseContext:_}),w!==void 0&&(n={...n,_logIndentLevel:w});const b=_e(n,u);if(!b){n=ae(n,m.cardOwner,"Remaining effects cancelled because the source card was deleted or returned.");continue}if(!b.card.isFaceUp){const C=`${b.card.protocol}-${b.card.value}`;n=ae(n,m.cardOwner,`Remaining effects from ${C} cancelled because it was flipped face-down.`);continue}if(!Q_(n,u)){const C=`${b.card.protocol}-${b.card.value}`;n=ae(n,m.cardOwner,`Remaining effects from ${C} cancelled because it is now covered.`);continue}const S=d.savedLastCustomEffectTargetCardId;S&&(n.lastCustomEffectTargetCardId=S),y&&(n._selectedCardFromPreviousEffect=y,S||(n.lastCustomEffectTargetCardId=y));for(let C=0;C<f.length;C++){const j=f[C],R=ct(b.card,h,n,m,j);if(n=R.newState,R.animationRequests&&R.animationRequests.length>0&&!n.actionRequired){const F=f.slice(C+1);if(F.length>0){const U={type:"execute_remaining_custom_effects",sourceCardId:u,laneIndex:h,effects:F,context:m,actor:m.cardOwner,logSource:n._currentEffectSource,logPhase:n._currentPhaseContext,logIndentLevel:n._logIndentLevel||0};n.queuedActions=[U,...l||[]]}else n.queuedActions=l;const L=R.animationRequests[0];return L.type==="draw"?n.animationState={type:"drawCard",owner:L.player,cardIds:[]}:L.type==="play"?n.animationState={type:"playCard",cardId:L.cardId,owner:L.owner}:L.type==="delete"&&(n.animationState={type:"deleteCard",cardId:L.cardId,owner:L.owner}),n}if(n.actionRequired){const F=f.slice(C+1);if(F.length>0&&(n._pendingCustomEffects={sourceCardId:u,laneIndex:h,context:m,effects:F,logSource:n._currentEffectSource,logPhase:n._currentPhaseContext,logIndentLevel:n._logIndentLevel||0}),n._interruptedTurn){const L=n._interruptedTurn,U=n._interruptedPhase||n.phase;delete n._interruptedTurn,delete n._interruptedPhase,n.turn=L,n.phase=U}return n.queuedActions=l,n}}const k=n._deferredParentEffects;if(k&&k.length>0){const C=k[k.length-1],j=k.slice(0,-1);l=[{type:"execute_remaining_custom_effects",sourceCardId:C.sourceCardId,laneIndex:C.laneIndex,effects:C.effects,context:C.context,actor:C.actor||((i=C.context)==null?void 0:i.cardOwner),selectedCardFromPreviousEffect:C.selectedCardFromPreviousEffect,savedLastCustomEffectTargetCardId:C.savedLastCustomEffectTargetCardId,logSource:C.logSource,logPhase:C.logPhase,logIndentLevel:C.logIndentLevel},...l||[]],n={...n,_deferredParentEffects:j.length>0?j:void 0,lastCustomEffectTargetCardId:C.savedLastCustomEffectTargetCardId||C.selectedCardFromPreviousEffect}}continue}if(d.type==="reveal_opponent_hand"){const u=n.turn==="player"?"opponent":"player",h={...n[u]};if(h.hand.length>0){h.hand=h.hand.map(y=>({...y,isRevealed:!0})),n[u]=h;const f=_e(n,d.sourceCardId),m=f?`${f.card.protocol}-${f.card.value}`:"A card effect";n=ae(n,n.turn,`${m}: Opponent reveals their hand.`)}else{const f=_e(n,d.sourceCardId),m=f?`${f.card.protocol}-${f.card.value}`:"A card effect";n=ae(n,n.turn,`${m}: Opponent has no cards to reveal.`)}continue}if(d.type==="pending_uncover_effect"){const{owner:u,laneIndex:h}=d;if(n=An(n,u,h).newState,n.actionRequired)return n.queuedActions=l,n;continue}return n.actionRequired=d,n.queuedActions=l,n}return{...n,queuedActions:[],actionRequired:null}},Hr=a=>{var d;if(a.winner||a.actionRequired)return a;const n=a._deferredParentEffects&&a._deferredParentEffects.length>0;if(a.queuedActions&&a.queuedActions.length>0||n){const u=ya(a);if(u.actionRequired)return u;a=u}if(a._interruptedTurn){const u=a._interruptedTurn,h=a._interruptedPhase||a.phase;let f={...a};if(delete f._interruptedTurn,delete f._interruptedPhase,f.turn=u,f.phase=h,h==="start"||h==="end"){if(f.queuedActions&&f.queuedActions.length>0&&(f=ya(f)),!f.actionRequired&&h==="end"){const m=Xh(f).newState;if(m.actionRequired)return m;const y=m.turn==="player"?"opponent":"player",v={...m[m.turn],cannotCompile:!1};let _=Me(m,void 0);return _=Ge(_,void 0),_={..._,_logIndentLevel:0},_=we(_),{..._,[m.turn]:v,turn:y,phase:"start",processedStartEffectIds:[],processedEndEffectIds:[],processedSpeed1TriggerThisTurn:!1,processedUncoverEventIds:[],_startPhaseEffectSnapshot:void 0,_endPhaseEffectSnapshot:void 0,_interruptedTurn:void 0,_interruptedPhase:void 0}}if(h==="start"&&!f.actionRequired){const m=Md(f).newState;if(m.actionRequired)return m;let y={...m,phase:"control"};return Lr(y)}return f}a=f}if(((d=a.actionRequired)==null?void 0:d.type)==="prompt_rearrange_protocols"&&a.actionRequired.originalAction){const u=a.actionRequired.originalAction;let h={...a,actionRequired:null,controlCardHolder:null};if(u.type==="compile")return Lr(h);if(u.type==="fill_hand"){const f=Xo(h,h.turn,5-h[h.turn].hand.length);return Lr(f)}}if(a.queuedEffect){const{card:u,laneIndex:h}=a.queuedEffect,f={...a,queuedEffect:void 0,_committedCardId:void 0},m=_e(f,u.id);if(m){const{card:y,owner:v}=m;let _={...f,_logIndentLevel:0};const w={cardOwner:v,actor:v,currentTurn:_.turn,opponent:v==="player"?"opponent":"player",triggerType:"play"},{newState:b}=Zl(y,h,_,w);if(b.actionRequired)return b;a=b}else console.warn(`Skipping queued effect for ${u.protocol}-${u.value} as it is no longer on the board.`),a=ae(a,a.turn,`Skipping queued effect for ${u.protocol}-${u.value} as it is no longer on the board.`),a=f}if(a.queuedActions&&a.queuedActions.length>0){let u={...a},h=[...u.queuedActions];for(;h.length>0;){const f=h.shift(),m=f.type==="flip_self";if(f.sourceCardId&&!m){const y=_e(u,f.sourceCardId);if(!y||!y.card.isFaceUp){const v=y?`${y.card.protocol}-${y.card.value}`:"a card",_=u._logSource;u=Me(u,v),u=ae(u,f.actor,"Queued effect was cancelled because the source is no longer active."),u=Me(u,_);continue}}if(m){const{sourceCardId:y,actor:v}=f,_=_e(u,y),w=vo(u,y);if(_&&_.card.isFaceUp&&w){const b=`${_.card.protocol}-${_.card.value}`;u=ae(u,v,`${b}: Flips itself.`),u=Wo(new Set([y]),u),u.animationState={type:"flipCard",cardId:y}}else{const b=_?`${_.card.protocol}-${_.card.value}`:"the source card",N=_?_.card.isFaceUp?"now covered":"flipped face-down":"deleted";u=ae(u,v,`The self-flip effect from ${b} was cancelled because it is ${N}.`)}continue}if(f.type==="reveal_opponent_hand"){const y=u.turn==="player"?"opponent":"player",v={...u[y]};if(v.hand.length>0){v.hand=v.hand.map(b=>({...b,isRevealed:!0})),u[y]=v;const _=_e(u,f.sourceCardId),w=_?`${_.card.protocol}-${_.card.value}`:"A card effect";u=ae(u,u.turn,`${w}: Opponent reveals their hand.`)}else{const _=_e(u,f.sourceCardId),w=_?`${_.card.protocol}-${_.card.value}`:"A card effect";u=ae(u,u.turn,`${w}: Opponent has no cards to reveal.`)}continue}return u.actionRequired=f,u.queuedActions=h,u}a={...u,queuedActions:[],actionRequired:null}}const l=a.phase==="action"?"hand_limit":a.phase;let c={...a,phase:l,compilableLanes:[],processedUncoverEventIds:[]};const i=a.turn;for(;c.turn===i&&!c.winner;){const u=c.actionRequired,h=c.phase;c=Mr(c);const f=c.actionRequired;if(f&&f!==u)break;if(c.phase===h&&c.turn===i){console.error("Game is stuck in a phase loop:",c.phase);break}}return c},Lr=a=>{if(a.winner)return a;let n={...a};if(n._interruptedTurn){const c=n._interruptedTurn,i=n._interruptedPhase||n.phase;delete n._interruptedTurn,delete n._interruptedPhase,n.turn=c,n.phase=i}const l=n.turn;for(;n.turn===l&&!n.actionRequired&&!n.winner;){const c=n.phase;if(c==="action")break;if(c==="compile"){const d=nm(n,l);if(d.length>0){n={...n,compilableLanes:d};break}}const i=n.phase;if(n=Mr(n),i===n.phase&&!n.actionRequired){console.error("Game is stuck in an automatic phase loop:",i),console.error("State:",{phase:n.phase,turn:n.turn,actionRequired:n.actionRequired,queuedActions:n.queuedActions,interruptedTurn:n._interruptedTurn});break}}return{...n,animationState:null}},Zh=a=>{let n={...a,actionRequired:null};if(n._interruptedTurn)return Hr(n);const l=n._deferredParentEffects&&n._deferredParentEffects.length>0;if(n.queuedActions&&n.queuedActions.length>0||l){const d=ya(n);if(d.actionRequired)return d;n=d}const c=Md(n).newState;if(c.actionRequired)return c;let i=c;return i.phase!=="control"&&(i={...i,phase:"control"}),i=Mr(i),i.actionRequired||(i=Mr(i)),i},Kh=a=>{if(a.winner)return a;let n={...a,phase:"start"};return n=we(n),n=Mr(n),n.actionRequired?n:Lr(n)},jh=Object.freeze(Object.defineProperty({__proto__:null,advancePhase:Mr,continueTurnAfterStartPhaseAction:Zh,continueTurnProgression:Lr,processEndOfAction:Hr,processQueuedActions:ya,processStartOfTurn:Kh,queuePendingCustomEffects:Ke},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function _e(a,n){if(!n)return null;for(const l of["player","opponent"])for(let c=0;c<a[l].lanes.length;c++){const d=a[l].lanes[c].find(u=>u.id===n);if(d)return{card:d,owner:l,laneIndex:c}}return null}function vo(a,n){var c;if(!n)return!1;const l=a._committedCardId;for(const i of["player","opponent"])for(const d of a[i].lanes){if(d.length===0)continue;let u=d.length-1;const h=d[d.length-1].id;if(l&&d.length>=2&&h===l&&n!==l&&(u=d.length-2),((c=d[u])==null?void 0:c.id)===n)return!0}return!1}function Q_(a,n){if(!n)return!1;for(const l of["player","opponent"])for(const c of a[l].lanes)if(c.length!==0&&c[c.length-1].id===n)return!0;return!1}function xo(a,n){return n?a._committedCardId===n:!1}function wo(a,n,l){if(n.length===0||l<0||l>=n.length)return!1;const c=a._committedCardId;let i=n.length-1;return c&&n.length>=2&&n[n.length-1].id===c&&(i=n.length-2),l===i}function X_(a,n,l){var h;let c={...a};const i=(h=a.actionRequired)==null?void 0:h.followUpEffect,d=_e(c,n),u=d?ea(d.card,c[d.owner].lanes.find(f=>f.some(m=>m.id===n))||[]):0;if(c=Ke(c),c.actionRequired=null,i&&l){const f=_e(c,l);if(f){const m={cardOwner:f.owner,opponent:f.owner==="player"?"opponent":"player",currentTurn:c.turn,actor:f.owner,referencedCard:d==null?void 0:d.card,referencedCardValue:u};let y=-1;for(let v=0;v<c[f.owner].lanes.length;v++)if(c[f.owner].lanes[v].some(_=>_.id===l)){y=v;break}if(y!==-1)return ct(f.card,y,c,m,i).newState}}return c}function Jh(a,n,l,c){var w,b,N,S,k;let i={...a};const d=(w=a.actionRequired)==null?void 0:w.followUpEffect,u=(b=a.actionRequired)==null?void 0:b.conditionalType;if(i=Ke(i),i.actionRequired=null,c&&(i=_o(i)),d&&c){const C=_e(i,c);if(C){const j=((N=a.actionRequired)==null?void 0:N.previousHandSize)||0,R=i[n].hand.length,F=Math.max(0,j-R);if(!(u==="then"||u==="if_executed"&&F>0))return i;const U={cardOwner:C.owner,opponent:C.owner==="player"?"opponent":"player",currentTurn:i.turn,actor:n,discardedCount:F,previousHandSize:j};let Q=-1;for(let X=0;X<i[C.owner].lanes.length;X++)if(i[C.owner].lanes[X].some(V=>V.id===c)){Q=X;break}if(Q!==-1)return ct(C.card,Q,i,U,d).newState}return i}if(!l||!c)return i;const h=((S=a.actionRequired)==null?void 0:S.previousHandSize)||0,f=i[n].hand.length;if(Math.max(0,h-f)===0)return i;const y=(k=_e(i,c))==null?void 0:k.card;y&&`${y.protocol}${y.value}`;const v=i.queuedActions&&i.queuedActions.length>0;let _=null;switch(l){case"fire_1":_={type:"select_cards_to_delete",count:1,sourceCardId:c,disallowedIds:[c],actor:n};break;case"fire_2":_={type:"select_card_to_return",sourceCardId:c,actor:n};break;case"fire_3":_={type:"select_card_to_flip",sourceCardId:c,actor:n,targetFilter:{position:"uncovered",excludeSelf:!0}};break}if(_)if(v){const C=i.queuedActions||[],j=C.filter(F=>F.type==="select_card_to_shift"&&F.followUpEffect),R=C.filter(F=>!(F.type==="select_card_to_shift"&&F.followUpEffect));i.queuedActions=[...R,_,...j]}else i.actionRequired=_;return i}function kd(a,n,l=null){const c=_e(a,n);if(!c)return a;const{card:i,owner:d}=c;if(!i.isFaceUp){let S=-1;for(let k=0;k<a[d].lanes.length;k++)if(a[d].lanes[k].some(C=>C.id===n)){S=k;break}if(S!==-1&&!U_(a,S).allowed)return a}let h=Rt(a,"on_flip",{player:d,cardId:n}).newState;if(!_e(h,n))return h;const m=h.actionRequired&&"actor"in h.actionRequired?h.actionRequired.actor:h.turn,y=m==="player"?"Player":"Opponent",v=d==="player"?"Player's":"Opponent's",_=i.isFaceUp?"face-down":"face-up",w=`${i.protocol}-${i.value}`;h=ae(h,m,`${y} flips ${v} ${w} ${_}.`);const b={...h.stats[m],cardsFlipped:h.stats[m].cardsFlipped+1},N={...h[m],stats:b};return h={...h,[m]:N,stats:{...h.stats,[m]:b}},h=Wo(new Set([n]),h),h.animationState={type:"flipCard",cardId:n},h.actionRequired=l,h}function An(a,n,l){var u;const c=a[n].lanes[l];if(c.length===0)return{newState:a};const i=c[c.length-1],d=vo(a,i.id);if(i.isFaceUp&&d){const h=`${i.id}-${l}`;if((u=a.processedUncoverEventIds)!=null&&u.includes(h))return{newState:a};const f={source:a._currentEffectSource,phase:a._currentPhaseContext,indentLevel:a._logIndentLevel||0},m=`${i.protocol}-${i.value}`;let y=Me(a,m);y=Ge(y,"uncover"),y=ae(y,n,`${i.protocol}-${i.value} is uncovered and its effects are re-triggered.`),y.processedUncoverEventIds=[...y.processedUncoverEventIds||[],h];const v={cardOwner:n,actor:n,currentTurn:y.turn,opponent:n==="player"?"opponent":"player",triggerType:"uncover"},_=Zl(i,l,y,v);if(_.newState.actionRequired||(_.newState={..._.newState,_currentEffectSource:f.source,_currentPhaseContext:f.phase,_logIndentLevel:f.indentLevel}),_.newState.actionRequired){const w=_.newState.actionRequired.actor;if(a._interruptedTurn&&w===a._interruptedTurn){const b=_.newState.actionRequired;return _.newState.actionRequired=null,_.newState.queuedActions=[..._.newState.queuedActions||[],b],_.newState=Ke(_.newState),_}_.newState=Ke(_.newState),w!==a.turn&&(_.newState._interruptedTurn=a.turn,_.newState._interruptedPhase=a.phase,_.newState.turn=w,_.newState.actionRequired.type==="prompt_rearrange_protocols"&&(_.newState.actionRequired={..._.newState.actionRequired,originalAction:{type:"resume_interrupted_turn",interruptedTurn:a.turn,interruptedPhase:a.phase}}))}else _.newState._interruptedTurn&&(_.newState.turn=_.newState._interruptedTurn,_.newState._interruptedTurn=void 0);return _}return{newState:a}}function Z_(a,n,l){var c,i;for(const d of["player","opponent"])for(const u of a[d].lanes)for(const h of u){if(!h.isFaceUp)continue;const f=h.customEffects;if(!f)continue;const m=f.bottomEffects||[];for(const y of m){if(y.trigger!=="when_card_returned"||((c=y.params)==null?void 0:c.action)!=="redirect_return_to_deck")continue;const v=((i=y.params)==null?void 0:i.targetOwner)||"opponent",_=d;if(v==="opponent"&&n!==_||v==="own"&&n===_)return h}}return null}function Nd(a,n){const l=_e(a,n);if(!l)return{newState:a};const{card:c,owner:i}=l,d=a[i].lanes.findIndex(C=>C.some(j=>j.id===c.id));if(d===-1)return{newState:a};const u=a[i].lanes[d],h=u.length>0&&u[u.length-1].id===n;let f={...a};const m={...f[i]},y=f.actionRequired&&"actor"in f.actionRequired?f.actionRequired.actor:f.turn,v=y==="player"?"Player":"Opponent",_=i==="player"?"Player's":"Opponent's",w=`${c.protocol}-${c.value}`,b=Z_(a,i);if(m.lanes=m.lanes.map(C=>C.filter(j=>j.id!==n)),b){const C={...c,isFaceUp:!1,isRevealed:!1};m.deck=[C,...m.deck],f[i]=m;const j=`${b.protocol}-${b.value}`;f=ae(f,y,`${j}: ${_} ${w} is put on top of their deck face-down instead of returning to hand.`)}else m.hand=[...m.hand,{...c,isFaceUp:!0,isRevealed:!1}],f[i]=m,f=ae(f,y,`${v} returns ${_} ${w} to their hand.`);f=Ke(f);const N={...f.stats[y],cardsReturned:f.stats[y].cardsReturned+1},S={...f[y],stats:N};f={...f,[y]:S},f.actionRequired=null;const k=we(f);return h&&k[i].lanes[d].length>0?An(k,i,d):{newState:k}}function go(a,n,l,c,i){const d=_e(a,n);if(!d||d.owner!==l)return{newState:a};const{card:u}=d,h=a[l];let f=-1;for(let T=0;T<h.lanes.length;T++)if(h.lanes[T].some(q=>q.id===n)){f=T;break}if(f===-1)return{newState:a};if(f===c)return{newState:a};if(!Ql(a,f,c).allowed)return{newState:a};const y=a[l].lanes[f],v=y.length>0&&y[y.length-1].id===n,_=h.lanes.map((T,q)=>q===f?T.filter(Y=>Y.id!==n):T),w=_[c].length>0?_[c][_[c].length-1]:null;let b={...a,[l]:{...h,lanes:_}};b._committedCardId=n;const N=_.map((T,q)=>q===c?[...T,u]:T),S={...h,lanes:N};let k={...b,[l]:S};(!a._currentEffectSource||!a._currentPhaseContext)&&(k=Me(k,void 0),k=Ge(k,void 0));const C=i==="player"?"Player":"Opponent",j=l==="player"?"Player's":"Opponent's",R=u.isFaceUp?`${u.protocol}-${u.value}`:"a card",F=k[l].protocols[c];k=ae(k,i,`${C} shifts ${j} ${R} to Protocol ${F}.`);const L={...k.stats[i],cardsShifted:k.stats[i].cardsShifted+1},U={...k[i],stats:L};k={...k,[i]:U,stats:{...k.stats,[i]:L}},k=Ke(k),k.actionRequired=null;let Q=we(k),X={newState:Q};if(w){w.customEffects;const T={cardOwner:l,actor:i,currentTurn:Q.turn,opponent:l==="player"?"opponent":"player",triggerType:"cover"};X=Od(w,c,Q,T)}let V=X.newState,$=[...X.animationRequests||[]];if(v){const T=An(V,l,f);V=T.newState,T.animationRequests&&$.push(...T.animationRequests)}const E=V[l].lanes[c],A=E.length>0&&E[E.length-1].id===n,O=!v;if(A&&u.isFaceUp&&O){const T=An(V,l,c);T.animationRequests&&$.push(...T.animationRequests);let q=T.newState;return!q.actionRequired&&(!q.queuedActions||q.queuedActions.length===0)&&(q._committedCardId=void 0),{newState:q,animationRequests:$.length>0?$:void 0}}let I=V;return!I.actionRequired&&(!I.queuedActions||I.queuedActions.length===0)&&(I._committedCardId=void 0),{newState:I,animationRequests:$.length>0?$:void 0}}const K_=(a,n,l)=>{let c=0;for(const i of["player","opponent"])for(let d=0;d<a[i].lanes.length;d++){const u=a[i].lanes[d];if(u.length>0){const h=u[u.length-1];n.includes(h.id)||c++}}return c},Rd=(a,n)=>{var y;const l=_e(a,n);if(!l)return{newState:a};const{card:c,owner:i}=l,d=a[i].lanes.findIndex(v=>v.some(_=>_.id===c.id));if(d===-1)return{newState:a};let u=a;const h=a._pendingCustomEffects;h&&((y=h.effects)==null?void 0:y.length)>0&&h.effects.some(_=>_.useCardFromPreviousEffect)&&(u={...a,_pendingCustomEffects:{...h,selectedCardFromPreviousEffect:n}});const f={cardOwner:i,actor:i,currentTurn:u.turn,opponent:i==="player"?"opponent":"player",triggerType:"flip"},m=Zl(c,d,u,f);if(m.newState.actionRequired){m.newState=Ke(m.newState);const v=m.newState.actionRequired.actor;if(a._interruptedTurn&&v===a._interruptedTurn)return m.newState.queuedActions=[...m.newState.queuedActions||[],m.newState.actionRequired],m.newState=Ke(m.newState),m.newState.actionRequired=null,m;v!==a.turn&&(m.newState._interruptedTurn=a.turn,m.newState._interruptedPhase=a.phase,m.newState.turn=v,m.newState.actionRequired.type==="prompt_rearrange_protocols"&&(m.newState.actionRequired={...m.newState.actionRequired,originalAction:{type:"resume_interrupted_turn",interruptedTurn:a.turn,interruptedPhase:a.phase}}))}return m};function J_(a,n){const l=[];if(a[n].lanes.forEach((i,d)=>{if(i.length>0){const u=i[i.length-1],h=ea(u,i);l.push({card:u,laneIndex:d,owner:n,value:h})}}),l.length===0)return[];const c=Math.max(...l.map(i=>i.value));return l.filter(i=>i.value===c)}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Draw Effect Executor
 *
 * Handles all draw-related effects.
 * Extracted 1:1 from effectInterpreter.ts for modularity.
 */function kh(a,n,l){const c=Math.min(l,a.length),i=a.slice(0,c).map(h=>({...h,id:Xe(),isFaceUp:!0})),d=[...n,...i],u=a.slice(c);return{drawnCards:d,remainingDeck:u,newCards:i}}function e0(a,n,l,c,i){var R,F,L,U,Q,X,V,$;const d=i._conditional,{cardOwner:u}=c,f=(i.target||"self")==="opponent"?c.opponent:u,m=Ld(l,f);if(!m.allowed)return{newState:ae(l,u,m.reason||"Cannot draw cards.")};if(i.conditional){let E=0;switch(i.conditional.type){case"non_matching_protocols":{for(let W=0;W<3;W++){const G=l.player.protocols[W],H=l.opponent.protocols[W],B=l.player.lanes[W].filter(pe=>pe.isFaceUp),ee=l.opponent.lanes[W].filter(pe=>pe.isFaceUp);[...B,...ee].some(pe=>pe.protocol!==G&&pe.protocol!==H)&&E++}break}case"count_face_down":{let W=0;for(const G of["player","opponent"])for(const H of l[G].lanes)W+=H.filter(B=>!B.isFaceUp).length;E=W;break}case"is_covering":{E=l[u].lanes[n].length>1?i.count||1:0;break}}let A=E;if(A<=0)return{newState:l};const{drawnCards:O,remainingDeck:I,newCards:T}=kh(l[f].deck,l[f].hand,A);let q={...l};if(q[f]={...q[f],deck:I,hand:O},q.detailedGameStats&&T.length>0){const W=f==="player"?"playerFromEffect":"aiFromEffect";q={...q,detailedGameStats:{...q.detailedGameStats,cardsDrawn:{...q.detailedGameStats.cardsDrawn,[W]:q.detailedGameStats.cardsDrawn[W]+T.length}}}}const Y=f==="player"?"Player":"Opponent";let K="";switch(i.conditional.type){case"non_matching_protocols":K=" from non-matching protocols";break;case"is_covering":K=" (this card is covering another)";break;case"count_face_down":K=" (for face-down cards)";break;default:K=""}const P=T.length>0&&f==="player"?` (${T.map(W=>`${W.protocol}-${W.value}`).join(", ")})`:"";q=ae(q,f,`${Y} draws ${A} card${A!==1?"s":""}${K}${P}.`),A>0&&(q=Rt(q,"after_draw",{player:f}).newState);const Z=A>0?[{type:"draw",player:f,count:A}]:void 0;return{newState:q,animationRequests:Z}}let y=i.count||1;const v=i.countType||"fixed";switch(v){case"equal_to_card_value":{const E=l.lastCustomEffectTargetCardId;if(E){const A=_e(l,E);if(A){const O=A.owner,I=l[O].lanes.find(T=>T.some(q=>q.id===E))||[];y=ea(A.card,I)}else return y=0,{newState:ae(l,u,"Cannot draw cards - referenced card is no longer on board (was returned/deleted).")}}else y=c.referencedCardValue||0;break}case"equal_to_discarded":y=(c.discardedCount||0)+(i.countOffset||0);break;case"hand_size":case"previous_hand_size":y=c.previousHandSize||c.handSize||0;break;case"count_face_down":{let E=0;for(const A of["player","opponent"])for(const O of l[A].lanes)E+=O.filter(I=>!I.isFaceUp).length;y=E*(i.count||1);break}case"all_matching":{if(((R=i.valueFilter)==null?void 0:R.equals)!==void 0){const E=i.valueFilter.equals;y=l[f].deck.filter(O=>O.value===E).length}else y=0;break}case"fixed":default:y=i.count||1;break}if(y<=0)return{newState:l};if(((F=i.advancedConditional)==null?void 0:F.type)==="protocol_match"){const E=i.advancedConditional.protocol;if(l[u].protocols[n]!==E)return{newState:l}}if(((L=i.advancedConditional)==null?void 0:L.type)==="empty_hand"&&l[f].hand.length>0)return{newState:l};if(((U=i.advancedConditional)==null?void 0:U.type)==="opponent_higher_value_in_lane"){const E=u==="player"?"opponent":"player",A=zn(l,u,n);if(zn(l,E,n)<=A)return{newState:l}}let _={...l};if(((Q=i.advancedConditional)==null?void 0:Q.type)==="compile_block"){const E=i.advancedConditional.turnDuration||1,A=u==="player"?"opponent":"player";_={..._,compileBlockedUntilTurn:(_.turnNumber||0)+E,compileBlockedPlayer:A},_=ae(_,u,`Opponent can't compile for ${E} turn${E!==1?"s":""}.`)}if(i.optional)return _.actionRequired={type:"prompt_optional_draw",sourceCardId:a.id,actor:u,count:y,drawingPlayer:f,followUpEffect:d==null?void 0:d.thenEffect,conditionalType:d==null?void 0:d.type,logSource:l._currentEffectSource,logPhase:l._currentPhaseContext,logIndentLevel:l._logIndentLevel||0},{newState:_};const w=i.source||"own_deck",b=w==="opponent_deck"?c.opponent:f;let N,S,k=[];if(v==="all_matching"&&((X=i.valueFilter)==null?void 0:X.equals)!==void 0){const E=i.valueFilter.equals,A=_[b].deck,O=A.filter(T=>T.value===E),I=A.filter(T=>T.value!==E);k=O.map(T=>({...T,id:Xe(),isFaceUp:!0})),N=[..._[f].hand,...k],S=I}else if(((V=i.valueFilter)==null?void 0:V.equals)!==void 0&&i.fromRevealed){const E=i.valueFilter.equals,A=_[b].deck,O=A.filter(I=>I.value===E);if(O.length===0){const I=`${a.protocol}-${a.value}`;_=ae(_,f,`${I}: No cards with value ${E} in deck.`)}else return _.actionRequired={type:"select_card_from_revealed_deck",sourceCardId:a.id,actor:f,count:y,valueFilter:E,revealedCards:A,selectableCardIds:O.map(I=>I.id||`deck-${A.indexOf(I)}`)},{newState:_}}else if((($=i.valueFilter)==null?void 0:$.equals)!==void 0){const E=i.valueFilter.equals,A=[..._[b].deck],O=[];for(let q=0;q<A.length&&O.length<y;q++)A[q].value===E&&O.push(q);const I=O.map(q=>A[q]),T=A.filter((q,Y)=>!O.includes(Y));k=I.map(q=>({...q,id:Xe(),isFaceUp:!0})),N=[..._[f].hand,...k],S=T}else{const E=kh(_[b].deck,_[f].hand,y);N=E.drawnCards,S=E.remainingDeck,k=E.newCards}if(_[b]={..._[b],deck:S},_[f]={..._[f],hand:N},_.detailedGameStats&&k.length>0){const E=f==="player"?"playerFromEffect":"aiFromEffect";_={..._,detailedGameStats:{..._.detailedGameStats,cardsDrawn:{..._.detailedGameStats.cardsDrawn,[E]:_.detailedGameStats.cardsDrawn[E]+k.length}}}}const C=f==="player"?"Player":"Opponent",j=k.length>0&&f==="player"?` (${k.map(E=>`${E.protocol}-${E.value}`).join(", ")})`:"";if(w==="opponent_deck"){const E=b==="player"?"Player's":"Opponent's";_=ae(_,f,`${C} draws the top ${y===1?"card":`${y} cards`} of ${E} deck${j}.`)}else _=ae(_,f,`${C} draws ${y} card${y!==1?"s":""}${j}.`);return N.length>0&&(_=Rt(_,"after_draw",{player:f,count:N.length}).newState),{newState:_}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Flip Effect Executor
 *
 * Handles all flip-related effects.
 * Extracted 1:1 from effectInterpreter.ts for modularity.
 */function t0(a,n,l,c,i){var k,C,j;const{cardOwner:d}=c,u=i._conditional;if(i.useCardFromPreviousEffect&&l.lastCustomEffectTargetCardId){const R=l.lastCustomEffectTargetCardId,F=_e(l,R);if(!F)return{newState:ae(l,d,"Target card from previous effect no longer exists. Flip skipped.")};let L={...l};const U=F.owner,Q=L[U].lanes.findIndex(X=>X.some(V=>V.id===R));if(Q!==-1){const V=L[U].lanes[Q].find($=>$.id===R);if(V){V.isFaceUp=!V.isFaceUp;const $=V.isFaceUp?"face-up":"face-down";L=ae(L,d,`Flips that card ${$}.`)}}return{newState:L}}if(i.scope==="each_lane"){const R=i.targetFilter||{},F=ma(l),L=$=>{const E=l.player.lanes[$],A=l.opponent.lanes[$];let O=[];if(R.position==="covered"?O=[...E.filter((T,q)=>q<E.length-1),...A.filter((T,q)=>q<A.length-1)]:O=[...E,...A],R.owner==="own")O=O.filter(T=>E.includes(T)&&d==="player"||A.includes(T)&&d==="opponent");else if(R.owner==="opponent"){const T=d==="player"?"opponent":"player";O=O.filter(q=>E.includes(q)&&T==="player"||A.includes(q)&&T==="opponent")}return R.excludeSelf&&(O=O.filter(T=>T.id!==a.id)),(F?O.filter(T=>T.isFaceUp):O).length>0},U=[0,1,2].filter($=>L($));if(U.length===0){let $=ae(l,d,F?"No valid face-up targets to flip (Frost-1 is active).":"No valid targets to flip in any lane.");return $._effectSkippedNoTargets=!0,{newState:$}}const Q=U[0],X=U.slice(1);let V={...l};return V.actionRequired={type:"select_card_to_flip",sourceCardId:a.id,actor:d,currentLaneIndex:Q,remainingLanes:X,targetFilter:i.targetFilter,params:i,followUpEffect:u==null?void 0:u.thenEffect,conditionalType:u==null?void 0:u.type},{newState:V}}if(i.flipSelf){if(((k=i.advancedConditional)==null?void 0:k.type)==="protocol_match"){const U=i.advancedConditional.protocol;if(l[d].protocols[n]!==U)return{newState:l}}if(((C=i.advancedConditional)==null?void 0:C.type)==="opponent_higher_value_in_lane"){const U=d==="player"?"opponent":"player",Q=zn(l,d,n);if(zn(l,U,n)<=Q)return{newState:l}}let R={...l};const L=R[d].lanes[n].find(U=>U.id===a.id);if(L){L.isFaceUp=!L.isFaceUp;const U=d==="player"?"Player":"Opponent",Q=L.isFaceUp?"face-up":"face-down";R=ae(R,d,`${U} flips this card ${Q}.`)}return{newState:R}}const h=i.count||1,f=((j=i.scope)==null?void 0:j.type)||i.scope||"anywhere",m=h==="all"||typeof h!="number",y=f==="this_lane"&&m,v=f==="anywhere"&&m;if(y||v){let R={...l};const F=d==="player"?"opponent":"player",L=i.targetFilter||{},U=ma(l),Q=new Set,X=v?[0,1,2]:[n];for(const V of X){const $=R[d].lanes[V];for(const A of $){if(L.excludeSelf&&A.id===a.id||L.faceState==="face_up"&&!A.isFaceUp||L.faceState==="face_down"&&A.isFaceUp||L.owner==="opponent")continue;const O=$.indexOf(A)===$.length-1;L.position==="uncovered"&&!O||L.position==="covered"&&O||v&&!L.position&&!O||U&&!A.isFaceUp||Q.add(A.id)}const E=R[F].lanes[V];for(const A of E){if(L.faceState==="face_up"&&!A.isFaceUp||L.faceState==="face_down"&&A.isFaceUp||L.owner==="own")continue;const O=E.indexOf(A)===E.length-1;L.position==="uncovered"&&!O||L.position==="covered"&&O||v&&!L.position&&!O||U&&!A.isFaceUp||Q.add(A.id)}}if(Q.size>0){const V=v?"":" in this lane";R=ae(R,d,`Flipping ${Q.size} card(s)${V}.`);for(const $ of Q)for(const E of["player","opponent"])for(const A of R[E].lanes){const O=A.find(I=>I.id===$);O&&(O.isFaceUp=!O.isFaceUp)}return{newState:R}}else return R=ae(R,d,`No cards to flip${v?"":" in this lane"}.`),{newState:R}}const _=i.targetFilter||{},w=_.position||"uncovered",b=ma(l),N=[];for(const R of["player","opponent"])for(let F=0;F<l[R].lanes.length;F++){const L=l[R].lanes[F];if(!(i.scope==="this_lane"&&F!==n))for(let U=0;U<L.length;U++){const Q=L[U];if(xo(l,Q.id))continue;const X=wo(l,L,U);_.excludeSelf&&Q.id===a.id||_.owner==="own"&&R!==d||_.owner==="opponent"&&R===d||w==="uncovered"&&!X||w==="covered"&&X||_.faceState==="face_up"&&!Q.isFaceUp||_.faceState==="face_down"&&Q.isFaceUp||b&&!Q.isFaceUp||!Yl(l,Q.id).allowed||N.push(Q.id)}}if(N.length===0){let R=ae(l,d,"No valid cards to flip. Effect skipped.");return R._effectSkippedNoTargets=!0,{newState:R}}let S={...l};return S.actionRequired={type:"select_card_to_flip",count:h,sourceCardId:a.id,actor:d,targetFilter:i.targetFilter,optional:i.optional||!1,scope:i.scope,laneIndex:i.scope==="this_lane"?n:void 0,followUpEffect:u==null?void 0:u.thenEffect,conditionalType:u==null?void 0:u.type},{newState:S}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Delete Effect Executor
 *
 * Handles all delete-related effects.
 * Extracted 1:1 from effectInterpreter.ts for modularity.
 */function n0(a,n,l,c,i){var k,C,j,R,F,L,U,Q,X,V;const{cardOwner:d}=c,u=i._conditional;let h=i.count||1;if(((k=i.advancedConditional)==null?void 0:k.type)==="empty_hand"&&l[d].hand.length>0)return{newState:l};if(((C=i.advancedConditional)==null?void 0:C.type)==="opponent_higher_value_in_lane"){const $=d==="player"?"opponent":"player",E=zn(l,d,n);if(zn(l,$,n)<=E)return{newState:l}}if(i.useCardFromPreviousEffect&&l.lastCustomEffectTargetCardId){const $=l.lastCustomEffectTargetCardId,E=_e(l,$);if(!E)return{newState:ae(l,d,"Target card from previous effect no longer exists. Delete skipped.")};let A={...l};const O=E.owner,I=A[O].lanes.findIndex(T=>T.some(q=>q.id===$));if(I!==-1){const T=[...A[O].lanes[I]],q=T.findIndex(Y=>Y.id===$);if(q!==-1){const Y=q===T.length-1;T.splice(q,1);const K=[...A[O].lanes];K[I]=T,A={...A,[O]:{...A[O],lanes:K}};const P=E.card.isFaceUp?`${E.card.protocol}-${E.card.value}`:"that card";A=ae(A,d,`Deletes ${P}.`);const Z={...A.stats[d],cardsDeleted:A.stats[d].cardsDeleted+1};A={...A,stats:{...A.stats,[d]:Z}};const W=c.triggerType==="cover"||c.triggerType==="on_cover";return Y&&T.length>0&&!W&&(A=An(A,O,I).newState),{newState:A,animationRequests:[{type:"delete",cardId:$,owner:O}]}}}return{newState:A}}if((j=i.scope)!=null&&j.minCardsInLane){const $=i.scope.minCardsInLane,E=((R=l.player.lanes[n])==null?void 0:R.length)||0,A=((F=l.opponent.lanes[n])==null?void 0:F.length)||0;if(E+A<$)return{newState:l}}let f=[0,1,2];if(((L=i.laneCondition)==null?void 0:L.type)==="opponent_higher_value"&&(f=_0(l,d),f.length===0)){let $=ae(l,d,"No lanes where opponent has higher value. Delete effect skipped.");return $._effectSkippedNoTargets=!0,{newState:$}}const m=i.actorChooses||"effect_owner",y=((U=i.targetFilter)==null?void 0:U.owner)||"any";let v=d;m==="card_owner"&&y==="opponent"&&(v=c.opponent);const _=i.targetFilter||{},w=_.position||"uncovered",b=[];for(const $ of["player","opponent"])for(let E=0;E<l[$].lanes.length;E++){if(((Q=i.scope)==null?void 0:Q.type)==="this_line"&&E!==n)continue;const A=l[$].lanes[E];for(let O=0;O<A.length;O++){const I=A[O];if(xo(l,I.id))continue;const T=wo(l,A,O);if(!(i.excludeSelf&&I.id===a.id)&&!(_.owner==="own"&&$!==d)&&!(_.owner==="opponent"&&$===d)&&!(w==="uncovered"&&!T)&&!(w==="covered"&&T)){if(w==="covered_by_context"&&c.triggerType==="cover"){if($!==c.cardOwner&&T)continue}else if(w==="covered_by_context"&&T)continue;if(!(_.faceState==="face_up"&&!I.isFaceUp)&&!(_.faceState==="face_down"&&I.isFaceUp)){if(_.valueRange){const{min:q,max:Y}=_.valueRange;if(I.value<q||I.value>Y)continue}if(i.protocolMatching){const q=l.player.protocols[E],Y=l.opponent.protocols[E],K=I.protocol,P=K===q||K===Y;if(i.protocolMatching==="must_match"&&!P||i.protocolMatching==="must_not_match"&&P)continue}b.push(I.id)}}}}if(b.length===0){let $=ae(l,d,"No valid cards to delete. Effect skipped.");return $._effectSkippedNoTargets=!0,{newState:$}}if(i.upTo&&(h=Math.min(h,b.length),h===0))return{newState:ae(l,d,"No valid targets available. Delete effect skipped.")};let N=b;if(_.calculation==="highest_value"||_.calculation==="lowest_value"){const $=new Map;for(const O of b){const I=_e(l,O);if(!I)continue;let T=-1;for(let Y=0;Y<l[I.owner].lanes.length;Y++)if(l[I.owner].lanes[Y].some(K=>K.id===O)){T=Y;break}let q=I.card.value;!I.card.isFaceUp&&T!==-1&&(q=l[I.owner].lanes[T].some(K=>K.isFaceUp&&K.protocol==="Darkness"&&K.value===2)?4:2),$.set(O,q)}const E=Array.from($.values()),A=_.calculation==="highest_value"?Math.max(...E):Math.min(...E);N=b.filter(O=>$.get(O)===A)}if(i.autoExecute){const $=N.slice(0,h);let E=l;const A=[];for(const O of $){const I=_e(E,O);if(!I)continue;const{card:T,owner:q}=I;let Y=-1;for(let J=0;J<E[q].lanes.length;J++)if(E[q].lanes[J].some(pe=>pe.id===O)){Y=J;break}if(Y===-1)continue;const K=E[q].lanes[Y],P=K[K.length-1].id===O,Z=T.isFaceUp?`${T.protocol}-${T.value}`:"a face-down card";E=ae(E,d,`Effect triggers, deleting the lowest value covered card (${q==="player"?"Player's":"Opponent's"} ${Z}).`);const G=[...K],H=G.findIndex(J=>J.id===O);G.splice(H,1);const B=[...E[q].lanes];B[Y]=G,E={...E,[q]:{...E[q],lanes:B}};const ee={...E.stats[d],cardsDeleted:E.stats[d].cardsDeleted+1};E={...E,stats:{...E.stats,[d]:ee}},A.push({type:"delete",cardId:O,owner:q});const de=c.triggerType==="cover"||c.triggerType==="on_cover";P&&G.length>0&&!de&&(E=An(E,q,Y).newState)}return{newState:E,animationRequests:A}}let S={...l};if(i.deleteSelf){const $=d,E=l[$].lanes[n];if(!E||E.length===0)return S=ae(S,d,"Card already deleted. Delete effect skipped."),{newState:S};if(E.findIndex(W=>W.id===a.id)===-1)return S=ae(S,d,"Card already deleted. Delete effect skipped."),{newState:S};const O=l[$].lanes[n],I=O.length>0&&O[O.length-1].id===a.id;S=ae(S,d,`Deleting ${a.protocol}-${a.value}.`);const T=[...O],q=T.findIndex(W=>W.id===a.id);if(q===-1)return{newState:S};T.splice(q,1);const Y=[...S[$].lanes];Y[n]=T,S={...S,[$]:{...S[$],lanes:Y}};const K={...S.stats[d],cardsDeleted:S.stats[d].cardsDeleted+1};S={...S,stats:{...S.stats,[d]:K}};const P=[{type:"delete",cardId:a.id,owner:$}],Z=c.triggerType==="cover"||c.triggerType==="on_cover";if(I&&T.length>0&&!Z){const W=An(S,$,n);S=W.newState,W.animationRequests&&P.push(...W.animationRequests)}return{newState:S,animationRequests:P}}if(i.selectLane)return S.actionRequired={type:"select_lane_for_delete",sourceCardId:a.id,actor:v,count:i.count,targetFilter:i.targetFilter,deleteAll:i.count==="all_in_lane"||i.count==="all",validLanes:f.length<3?f:void 0,laneCondition:i.laneCondition,followUpEffect:u==null?void 0:u.thenEffect,conditionalType:u==null?void 0:u.type},{newState:S};if(((X=i.scope)==null?void 0:X.type)==="each_lane"){const $=I=>{for(const T of["player","opponent"]){const q=l[T].lanes[I];for(let Y=0;Y<q.length;Y++){const K=q[Y];if(xo(l,K.id))continue;const P=wo(l,q,Y);if(!(i.excludeSelf&&K.id===a.id)&&!(_.owner==="own"&&T!==v)&&!(_.owner==="opponent"&&T===v)&&!(w==="uncovered"&&!P)&&!(w==="covered"&&P)&&!(_.faceState==="face_up"&&!K.isFaceUp)&&!(_.faceState==="face_down"&&K.isFaceUp))return!0}}return!1},E=[0,1,2].filter(I=>$(I));if(E.length===0)return S=ae(S,d,"No valid targets to delete in any lane."),S._effectSkippedNoTargets=!0,{newState:S};const A=E[0],O=E.slice(1);return S.actionRequired={type:"select_cards_to_delete",count:h,sourceCardId:a.id,actor:v,currentLaneIndex:A,remainingLanes:O,disallowedIds:i.excludeSelf?[a.id]:[],targetFilter:i.targetFilter,scope:i.scope,protocolMatching:i.protocolMatching,params:i,followUpEffect:u==null?void 0:u.thenEffect,conditionalType:u==null?void 0:u.type},{newState:S}}if(((V=i.scope)==null?void 0:V.type)==="each_other_line"){const A=[0,1,2].filter(O=>O!==n).filter(O=>l.player.lanes[O].length>0||l.opponent.lanes[O].length>0).length;return A===0?(S=ae(S,d,"No other lanes have cards. Effect skipped."),{newState:S}):(S.actionRequired={type:"select_card_from_other_lanes_to_delete",sourceCardId:a.id,disallowedLaneIndex:n,lanesSelected:[],count:A,actor:v,targetFilter:i.targetFilter,followUpEffect:u==null?void 0:u.thenEffect,conditionalType:u==null?void 0:u.type},{newState:S})}return S.actionRequired={type:"select_cards_to_delete",count:h,sourceCardId:a.id,actor:v,actorChooses:m,disallowedIds:i.excludeSelf?[a.id]:[],followUpEffect:u==null?void 0:u.thenEffect,conditionalType:u==null?void 0:u.type,allowedIds:N.length<b.length?N:void 0,targetFilter:i.targetFilter,scope:i.scope,protocolMatching:i.protocolMatching},{newState:S}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Discard Effect Executor
 *
 * Handles all discard-related effects.
 * Extracted 1:1 from effectInterpreter.ts for modularity.
 */function a0(a,n,l,c,i){const{cardOwner:d}=c,u=i._conditional,h=i.actor==="opponent"?c.opponent:d;if(i.useCardFromPreviousEffect&&l.lastCustomEffectTargetCardId){const w=l.lastCustomEffectTargetCardId;let b={...l};const N={...b[h]},S=`${a.protocol}-${a.value}`,k=h==="player"?"Player":"Opponent",C=N.deck.findIndex(R=>R.id===w);if(C!==-1){const R=[...N.deck],F=R.splice(C,1)[0];return N.deck=R,N.discard=[...N.discard,F],b[h]=N,b=ae(b,h,`${k} discards ${F.protocol}-${F.value} from their deck.`),b._discardContext={actor:h,discardedCount:1,sourceCardId:a.id},{newState:b}}const j=N.hand.findIndex(R=>R.id===w);if(j!==-1){const R=[...N.hand],F=R.splice(j,1)[0],{id:L,isFaceUp:U,...Q}=F;return N.hand=R,N.discard=[...N.discard,Q],b[h]=N,b=ae(b,h,`${k} discards ${F.protocol}-${F.value}.`),b._discardContext={actor:h,discardedCount:1,sourceCardId:a.id},{newState:b}}return console.warn(`[Discard Effect] useCardFromPreviousEffect: Card ${w} not found`),b=ae(b,h,`${S}: Card to discard not found - effect skipped.`),b._discardContext={discardedCount:0},{newState:b}}let f=i.count||1;if((i.countType||"fixed")==="equal_to_discarded"){const w=(c.discardedCount||0)+(i.countOffset||0);if(f=Math.min(w,l[h].hand.length),f<=0)return{newState:l}}if(l[h].hand.length===0){let b=ae(l,h,`${h==="player"?"Player":"Opponent"} has no cards to discard - effect skipped.`);return b._effectSkippedNoTargets=!0,b._discardContext={discardedCount:0},{newState:b}}i.upTo&&(f=Math.min(f,l[h].hand.length));const y=f;typeof f=="number"&&f>l[h].hand.length&&(f=l[h].hand.length);const v=!i.upTo&&typeof y=="number"&&y>f;if(i.random&&h!==d){const w=[...l[h].hand],b=Math.min(f,w.length),N=[],S=w.map((X,V)=>V);for(let X=0;X<b&&S.length>0;X++){const V=Math.floor(Math.random()*S.length);N.push(S[V]),S.splice(V,1)}N.sort((X,V)=>V-X);const k=[],C=[...w];for(const X of N){const{id:V,isFaceUp:$,...E}=C.splice(X,1)[0];k.push(E)}const j=[...l[h].discard,...k],R={...l[h].stats,cardsDiscarded:l[h].stats.cardsDiscarded+k.length},F={...l[h],hand:C,discard:j,stats:R};let L={...l,[h]:F,stats:{...l.stats,[h]:R}};const U=h==="player"?"Player":"Opponent",Q=k.length===1?"card":"cards";if(h==="player"||k.every(X=>X.isRevealed)){const X=k.map(V=>`${V.protocol}-${V.value}`).join(", ");L=ae(L,h,`${U} randomly discards ${k.length} ${Q}: ${X}.`)}else L=ae(L,h,`${U} randomly discards ${k.length} ${Q}.`);return L._discardContext={actor:h,discardedCount:k.length,sourceCardId:a.id},{newState:L}}if(f==="all"){const w=l[h].hand,b=w.map(({id:F,isFaceUp:L,...U})=>U),N=[],S=[...l[h].discard,...b],k={...l[h].stats,cardsDiscarded:l[h].stats.cardsDiscarded+b.length},C={...l[h],hand:N,discard:S,stats:k};let j={...l,[h]:C,stats:{...l.stats,[h]:k}};const R=h==="player"?"Player":"Opponent";if(h==="player"||b.every(F=>F.isRevealed)){const F=b.map(L=>`${L.protocol}-${L.value}`).join(", ");j=ae(j,h,`${R} discards entire hand (${b.length} cards: ${F}).`)}else j=ae(j,h,`${R} discards entire hand (${b.length} cards).`);return j._discardContext={actor:h,discardedCount:b.length,previousHandSize:w.length,sourceCardId:a.id},{newState:j}}let _={...l};return v&&(_=ae(_,h,`${h==="player"?"Player":"Opponent"} only has ${f} card${f!==1?"s":""} (${y} required) - discarding all.`)),_.actionRequired={type:"discard",actor:h,count:f,sourceCardId:a.id,variableCount:i.variableCount||!1,previousHandSize:l[h].hand.length,followUpEffect:u==null?void 0:u.thenEffect,conditionalType:u==null?void 0:u.type},{newState:_}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Shift Effect Executor
 *
 * Handles all shift-related effects.
 * Extracted 1:1 from effectInterpreter.ts for modularity.
 */function o0(a,n,l,c,i){var U,Q,X,V;const{cardOwner:d}=c,u=i._conditional;let h={...l};if(((U=i.advancedConditional)==null?void 0:U.type)==="empty_hand"&&l[d].hand.length>0)return{newState:l};if(((Q=i.advancedConditional)==null?void 0:Q.type)==="opponent_higher_value_in_lane"){const $=d==="player"?"opponent":"player",E=zn(l,d,n);if(zn(l,$,n)<=E)return{newState:l}}if(((X=i.advancedConditional)==null?void 0:X.type)==="this_card_is_covered"){const $=l[d].lanes;let E=!1;for(let A=0;A<$.length;A++){const O=$[A],I=O.findIndex(T=>T.id===a.id);if(I!==-1){E=I<O.length-1;break}}if(!E)return{newState:l}}if(i.useCardFromPreviousEffect&&l.lastCustomEffectTargetCardId){const $=l.lastCustomEffectTargetCardId,E=_e(l,$);if(!E)return{newState:ae(l,d,"Target card from previous effect no longer exists. Shift skipped.")};const A=i.destinationRestriction;if((A==null?void 0:A.type)==="to_this_lane"){const I=A.laneIndex==="current"?n:A.laneIndex;if(I===void 0||I<0||I>2)return console.error(`[Shift Effect] Invalid target lane index: ${I}`),{newState:l};const T=go(l,$,E.owner,I,d);return{newState:T.newState,animationRequests:T.animationRequests}}let O=-1;for(let I=0;I<l[E.owner].lanes.length;I++)if(l[E.owner].lanes[I].some(T=>T.id===$)){O=I;break}return O===-1?{newState:l}:(h.actionRequired={type:"select_lane_for_shift",cardToShiftId:$,cardOwner:E.owner,originalLaneIndex:O,sourceCardId:a.id,actor:d,destinationRestriction:A,followUpEffect:u==null?void 0:u.thenEffect,conditionalType:u==null?void 0:u.type},{newState:h})}const f=l._selectedCardFromPreviousEffect;if(h._selectedCardFromPreviousEffect&&delete h._selectedCardFromPreviousEffect,f&&i.useCardFromPreviousEffect){const $=i.destinationRestriction;if(($==null?void 0:$.type)==="to_this_lane"){const E=$.laneIndex==="current"?n:$.laneIndex;if(E===void 0||E<0||E>2)return console.error(`[Shift Effect] Invalid target lane index: ${E}`),{newState:h};const A=_e(h,f);if(!A)return console.error(`[Shift Effect] Selected card not found: ${f}`),{newState:h};const O=go(h,f,A.owner,E,d);return{newState:O.newState,animationRequests:O.animationRequests}}return h.actionRequired={type:"shift_flipped_card_optional",cardId:f,sourceCardId:a.id,optional:i.optional||!1,actor:d,followUpEffect:u==null?void 0:u.thenEffect,conditionalType:u==null?void 0:u.type},{newState:h}}if(i.shiftSelf){if(((V=i.destinationRestriction)==null?void 0:V.type)==="opponent_highest_value_lane"){const $=am(h,d);if($.includes(n))return h=ae(h,d,"Card is already in opponent's highest value lane. Shift skipped."),{newState:h};const E=$.filter(A=>A!==n);if(E.length===0)return h=ae(h,d,"No valid destination lane. Shift skipped."),{newState:h};if(E.length===1){if(i.optional)return h.actionRequired={type:"select_lane_for_shift",cardToShiftId:a.id,cardOwner:d,originalLaneIndex:n,sourceCardId:a.id,actor:d,validLanes:E,destinationRestriction:i.destinationRestriction,optional:!0,followUpEffect:u==null?void 0:u.thenEffect,conditionalType:u==null?void 0:u.type},{newState:h};const A=E[0],O=go(h,a.id,d,A,d);return{newState:O.newState,animationRequests:O.animationRequests}}return h.actionRequired={type:"select_lane_for_shift",cardToShiftId:a.id,cardOwner:d,originalLaneIndex:n,sourceCardId:a.id,actor:d,validLanes:E,destinationRestriction:i.destinationRestriction,optional:i.optional||!1,followUpEffect:u==null?void 0:u.thenEffect,conditionalType:u==null?void 0:u.type},{newState:h}}return h.actionRequired={type:"shift_flipped_card_optional",cardId:a.id,sourceCardId:a.id,optional:i.optional||!1,actor:d,allowCovered:i.allowCoveredSelf||!1,followUpEffect:u==null?void 0:u.thenEffect,conditionalType:u==null?void 0:u.type},{newState:h}}const m=i.targetFilter||{},y=m.position||"uncovered",v=m.faceState||"any",_=m.owner||"any",w=m.excludeSelf||!1,b=i.count||1;if(y==="any"&&_==="own"&&!w&&b===1)return h.actionRequired={type:"shift_flipped_card_optional",cardId:a.id,sourceCardId:a.id,optional:i.optional||!1,actor:d,followUpEffect:u==null?void 0:u.thenEffect,conditionalType:u==null?void 0:u.type},{newState:h};const S=[];for(const $ of["player","opponent"])if(!(_==="own"&&$!==d)&&!(_==="opponent"&&$===d))for(let E=0;E<h[$].lanes.length;E++){if(i.scope==="this_lane"&&E!==n)continue;const A=h[$].lanes[E];for(let O=0;O<A.length;O++){const I=A[O];if(xo(h,I.id)||w&&I.id===a.id)continue;const T=wo(h,A,O);y==="uncovered"&&!T||y==="covered"&&T||v==="face_up"&&!I.isFaceUp||v==="face_down"&&I.isFaceUp||S.push({card:I,currentLane:E,owner:$})}}if(S.length===0)return h=ae(h,d,"No valid cards to shift."),h._effectSkippedNoTargets=!0,{newState:h};if((b==="all"||typeof b!="number"&&b!==1)&&S.length>0){const $=[],E=i.destinationRestriction;for(let A=0;A<3;A++){if((E==null?void 0:E.type)==="to_another_line"){if(A===n)continue}else if((E==null?void 0:E.type)==="to_this_lane"){const O=E.laneIndex==="current"?n:E.laneIndex;if(A!==O)continue}else if(!E&&A===n)continue;$.push(A)}return $.length===0?(h=ae(h,d,"No valid destination lanes for shifting all cards."),{newState:h}):(h=ae(h,d,`Shifting ${S.length} card(s) from this lane.`),h.actionRequired={type:"select_lane_for_shift_all",sourceCardId:a.id,actor:d,cardsToShift:S.map(A=>({cardId:A.card.id,owner:A.owner})),validDestinationLanes:$,sourceLaneIndex:n,followUpEffect:u==null?void 0:u.thenEffect,conditionalType:u==null?void 0:u.type},{newState:h})}const C=i.destinationRestriction;let j=!1;const R=(C==null?void 0:C.laneIndex)==="current"?n:C==null?void 0:C.laneIndex;for(const{card:$,currentLane:E,owner:A}of S){if((C==null?void 0:C.type)==="non_matching_protocol"&&!$.isFaceUp)continue;const O=$.protocol;for(let I=0;I<3;I++){if(C){if(C.type==="non_matching_protocol"){if(I===E)continue;const q=h.player.protocols[I],Y=h.opponent.protocols[I];if(O===q||O===Y)continue}else if(C.type==="specific_lane"){if(I!==E)continue}else if(C.type==="to_this_lane"){if(I!==R||E===R)continue}else if(C.type==="to_another_line"){if(I===E)continue}else if(C.type==="to_or_from_this_lane"&&(!(E===R)&&!(I===R)||I===E))continue}else if(I===E)continue;if(Ql(h,E,I).allowed){j=!0;break}}if(j)break}if(!j)return h=ae(h,d,"No valid shift destinations available."),{newState:h};const F=C&&R!==void 0?{...C,laneIndex:R}:C,L=(C==null?void 0:C.type)==="to_this_lane"&&R!==void 0?R:void 0;return h.actionRequired={type:"select_card_to_shift",sourceCardId:a.id,actor:d,targetFilter:i.targetFilter,destinationRestriction:F,sourceLaneIndex:n,targetLaneIndex:L,scope:i.scope,followUpEffect:u==null?void 0:u.thenEffect,conditionalType:u==null?void 0:u.type},{newState:h}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Return Effect Executor
 *
 * Handles all return-related effects.
 * Extracted 1:1 from effectInterpreter.ts for modularity.
 */function r0(a,n,l,c,i){var w,b,N,S;const{cardOwner:d,opponent:u}=c,h=i._conditional;i.count==="all"||i.count;const f=((w=i.targetFilter)==null?void 0:w.owner)||"any",m=((b=i.targetFilter)==null?void 0:b.position)||"uncovered";if(((N=i.advancedConditional)==null?void 0:N.type)==="empty_hand"&&l[d].hand.length>0)return{newState:l};if(((S=i.advancedConditional)==null?void 0:S.type)==="opponent_higher_value_in_lane"){const k=d==="player"?"opponent":"player",C=zn(l,d,n);if(zn(l,k,n)<=C)return{newState:l}}if(i.selectLane){let k={...l};return k.actionRequired={type:"select_lane_for_return",sourceCardId:a.id,actor:d,count:i.count,targetFilter:i.targetFilter,followUpEffect:h==null?void 0:h.thenEffect,conditionalType:h==null?void 0:h.type},{newState:k}}let y=[];const v=k=>{for(const C of l[k].lanes)for(let j=0;j<C.length;j++){const R=C[j];if(xo(l,R.id))continue;const F=wo(l,C,j);m==="uncovered"&&!F||m==="covered"&&F||y.push({card:R,isUncovered:F})}};if(f==="own"?v(d):f==="opponent"?v(u):(v("player"),v("opponent")),y.length===0)return{newState:ae(l,d,"No cards on board to return. Effect skipped.")};let _={...l};return _.actionRequired={type:"select_card_to_return",sourceCardId:a.id,actor:d,targetOwner:f,targetFilter:i.targetFilter,followUpEffect:h==null?void 0:h.thenEffect,conditionalType:h==null?void 0:h.type},{newState:_}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Play Effect Executor
 *
 * Handles all play-related effects (play cards from hand/deck to board).
 * Extracted 1:1 from effectInterpreter.ts for modularity.
 */function l0(a,n,l,c,i){var b,N,S,k,C,j,R,F,L,U,Q;const{cardOwner:d,opponent:u}=c,h=i._conditional,f=i.count||1,m=i.source||"hand",y=i.faceDown,v=i.actor==="opponent"?u:d;if(((b=i.advancedConditional)==null?void 0:b.type)==="empty_hand"&&l[d].hand.length>0)return{newState:l};if(((N=i.advancedConditional)==null?void 0:N.type)==="opponent_higher_value_in_lane"){const X=d==="player"?"opponent":"player",V=zn(l,d,n);if(zn(l,X,n)<=V)return{newState:l}}if(m==="deck"&&((S=i.destinationRule)==null?void 0:S.type)==="each_other_line"){const X=[0,1,2].filter(P=>P!==n);if(X.length===0)return{newState:l};const V=l[v];if(V.deck.length===0&&V.discard.length===0)return{newState:ae(l,d,`${v==="player"?"Player":"Opponent"} has no cards in deck/discard - effect skipped.`)};const{drawnCards:$,remainingDeck:E,newDiscard:A}=Hn(V.deck,V.discard,X.length);if($.length===0)return{newState:l};const O=$.map(P=>({...P,id:Xe(),isFaceUp:!1})),I=[...V.lanes];for(let P=0;P<O.length;P++){const Z=X[P];I[Z]=[...I[Z],O[P]]}const T={...V,lanes:I,deck:E,discard:A};let q={...l,[v]:T};if(q.detailedGameStats&&$.length>0){const P=v==="player"?"playerFromEffect":"aiFromEffect",Z=v==="player"?"playerFaceDown":"aiFaceDown";q={...q,detailedGameStats:{...q.detailedGameStats,cardsPlayed:{...q.detailedGameStats.cardsPlayed,[P]:q.detailedGameStats.cardsPlayed[P]+$.length,[Z]:q.detailedGameStats.cardsPlayed[Z]+$.length}}}}const Y=_e(l,a.id),K=Y?`${Y.card.protocol}-${Y.card.value}`:"a card effect";return q=ae(q,d,`${K}: Plays ${$.length} card(s) face-down in other lines.`),{newState:q}}if(m==="deck"&&((k=i.destinationRule)==null?void 0:k.type)==="each_line_with_card"){const X=i.destinationRule.ownerFilter||"any",V=i.destinationRule.cardFilter,$=X==="own"?v:X==="opponent"?v==="player"?"opponent":"player":null,E=pe=>{const fe=ye=>ye.length===0?!1:V?ye.some(ke=>V.faceState==="face_down"?!ke.isFaceUp:V.faceState==="face_up"?ke.isFaceUp:!0):!0;return $?fe(l[$].lanes[pe]):fe(l.player.lanes[pe])||fe(l.opponent.lanes[pe])},A=[];for(let pe=0;pe<3;pe++)E(pe)&&A.push(pe);if(A.length===0)return{newState:l};const O=l[v];if(O.deck.length===0&&O.discard.length===0)return{newState:ae(l,d,`${v==="player"?"Player":"Opponent"} has no cards in deck/discard - effect skipped.`)};const{drawnCards:I,remainingDeck:T,newDiscard:q}=Hn(O.deck,O.discard,A.length);if(I.length===0)return{newState:l};const Y=I.map(pe=>({...pe,id:Xe(),isFaceUp:!y}));let K=l;const P=[];for(let pe=0;pe<A.length;pe++){const fe=A[pe],ye=K[v].lanes[fe];if(ye.length>0){const ke=ye[ye.length-1],Ve={...c,triggerType:"cover"},Le=Od(ke,fe,K,Ve);if(K=Le.newState,Le.animationRequests&&P.push(...Le.animationRequests),K.actionRequired)break}}const Z=[...K[v].lanes],W=[];for(let pe=0;pe<Y.length;pe++){const fe=A[pe];Z[fe]=[...Z[fe],Y[pe]],W.push({type:"play",cardId:Y[pe].id,owner:v})}const G={...K[v],lanes:Z,deck:T,discard:q};let H={...K,[v]:G};if(H.detailedGameStats&&I.length>0){const pe=v==="player"?"playerFromEffect":"aiFromEffect",fe=v==="player"?"playerFaceDown":"aiFaceDown";H={...H,detailedGameStats:{...H.detailedGameStats,cardsPlayed:{...H.detailedGameStats.cardsPlayed,[pe]:H.detailedGameStats.cardsPlayed[pe]+I.length,[fe]:H.detailedGameStats.cardsPlayed[fe]+I.length}}}}const B=_e(l,a.id),ee=B?`${B.card.protocol}-${B.card.value}`:"a card effect";let de="";(V==null?void 0:V.faceState)==="face_down"?de="with a face-down card":(V==null?void 0:V.faceState)==="face_up"?de="with a face-up card":X==="own"?de="where you have a card":X==="opponent"?de="where opponent has a card":de="with a card",H=ae(H,d,`${ee}: Plays ${I.length} card(s) face-down in each line ${de}.`);const J=[...P,...W];return{newState:H,animationRequests:J.length>0?J:void 0}}if(m==="deck"&&((C=i.destinationRule)==null?void 0:C.type)==="another_line"){if([0,1,2].filter($=>$!==n).length===0)return{newState:l};let V={...l};return V.actionRequired={type:"select_lane_for_play",sourceCardId:a.id,actor:v,count:i.count||1,isFaceDown:i.faceDown,excludeCurrentLane:!0,currentLaneIndex:n,source:i.source,followUpEffect:h==null?void 0:h.thenEffect,conditionalType:h==null?void 0:h.type},{newState:V}}if(m==="deck"&&((j=i.destinationRule)==null?void 0:j.type)==="under_this_card"&&((R=i.condition)==null?void 0:R.type)==="per_x_cards_in_line"){const X=i.condition.cardCount||2,V=l[d].lanes[n].length,$=l[u].lanes[n].length,E=V+$,A=Math.floor(E/X);if(A===0)return{newState:l};const O=l[v];if(O.deck.length===0&&O.discard.length===0)return{newState:l};const{drawnCards:I,remainingDeck:T,newDiscard:q}=Hn(O.deck,O.discard,A);if(I.length===0)return{newState:l};const Y=I.map(B=>({...B,id:Xe(),isFaceUp:!1})),K=[...O.lanes[n]];K.splice(K.length-1,0,...Y);const P=[...O.lanes];P[n]=K;const Z={...O,lanes:P,deck:T,discard:q};let W={...l,[v]:Z};if(W.detailedGameStats&&I.length>0){const B=v==="player"?"playerFromEffect":"aiFromEffect",ee=v==="player"?"playerFaceDown":"aiFaceDown";W={...W,detailedGameStats:{...W.detailedGameStats,cardsPlayed:{...W.detailedGameStats.cardsPlayed,[B]:W.detailedGameStats.cardsPlayed[B]+I.length,[ee]:W.detailedGameStats.cardsPlayed[ee]+I.length}}}}const G=_e(l,a.id),H=G?`${G.card.protocol}-${G.card.value}`:"a card effect";return W=ae(W,d,`${H}: Plays ${I.length} card(s) face-down under itself.`),{newState:W}}if(m==="deck"&&((F=i.destinationRule)==null?void 0:F.type)==="specific_lane"){const X=i.destinationRule.laneIndex==="current"?n:i.destinationRule.laneIndex;if(X===void 0||X<0||X>2)return console.error(`[Play Effect] Invalid lane index: ${X}`),{newState:l};const V=l[v];if(V.deck.length===0&&V.discard.length===0)return{newState:ae(l,d,`${v==="player"?"Player":"Opponent"} has no cards in deck/discard - effect skipped.`)};const{drawnCards:$,remainingDeck:E,newDiscard:A}=Hn(V.deck,V.discard,f);if($.length===0)return{newState:l};const O=$.map(G=>({...G,id:Xe(),isFaceUp:!y})),I=[...V.lanes];I[X]=[...I[X],...O];const T={...V,lanes:I,deck:E,discard:A};let q={...l,[v]:T};if(q.detailedGameStats&&$.length>0){const G=v==="player"?"playerFromEffect":"aiFromEffect",H=v==="player"?y?"playerFaceDown":"playerFaceUp":y?"aiFaceDown":"aiFaceUp";q={...q,detailedGameStats:{...q.detailedGameStats,cardsPlayed:{...q.detailedGameStats.cardsPlayed,[G]:q.detailedGameStats.cardsPlayed[G]+$.length,[H]:q.detailedGameStats.cardsPlayed[H]+$.length}}}}const Y=_e(l,a.id),K=Y?`${Y.card.protocol}-${Y.card.value}`:"a card effect",P=v==="player"?"Player":"Opponent",Z=y?"face-down":"face-up",W=l.player.protocols[X];return q=ae(q,d,`${K}: ${P} plays ${$.length} card(s) ${Z} in ${W} line.`),{newState:q}}if(m==="hand"&&((L=i.destinationRule)==null?void 0:L.type)==="line_with_matching_cards"){const X=i.destinationRule.cardFilter,V=A=>{const O=I=>I.length===0?!1:X?I.some(T=>X.faceState==="face_down"?!T.isFaceUp:X.faceState==="face_up"?T.isFaceUp:!0):!0;return O(l.player.lanes[A])||O(l.opponent.lanes[A])},$=[];for(let A=0;A<3;A++)V(A)&&$.push(A);if($.length===0){const A=_e(l,a.id),O=A?`${A.card.protocol}-${A.card.value}`:"Effect";return{newState:ae(l,d,`${O}: No valid lanes with face-down cards. Effect skipped.`)}}if(l[v].hand.length===0)return{newState:l};let E={...l};return E.actionRequired={type:"select_card_from_hand_to_play",sourceCardId:a.id,actor:v,count:i.count||1,faceDown:i.faceDown,source:"hand",validLanes:$,cardFilter:X,followUpEffect:h==null?void 0:h.thenEffect,conditionalType:h==null?void 0:h.type},{newState:E}}if(m==="hand"&&((U=i.valueFilter)==null?void 0:U.equals)!==void 0&&!i.destinationRule){const X=i.valueFilter.equals,V=l[v].hand.filter(E=>E.value===X);if(V.length===0){const E=_e(l,a.id),A=E?`${E.card.protocol}-${E.card.value}`:"Effect";return{newState:ae(l,d,`${A}: No cards with value ${X} in hand. Effect skipped.`)}}let $={...l};return $.actionRequired={type:"select_card_from_hand_to_play",sourceCardId:a.id,actor:v,count:i.count||1,faceDown:i.faceDown,source:"hand",valueFilter:X,selectableCardIds:V.map(E=>E.id),followUpEffect:h==null?void 0:h.thenEffect,conditionalType:h==null?void 0:h.type},{newState:$}}if(m==="hand"&&l[v].hand.length===0)return{newState:l};let _={...l},w;return(Q=i.destinationRule)!=null&&Q.excludeCurrentLane&&(w=n),_.actionRequired={type:"select_card_from_hand_to_play",count:f,sourceCardId:a.id,actor:v,faceDown:y,source:m,disallowedLaneIndex:w,destinationRule:i.destinationRule,condition:i.condition,followUpEffect:h==null?void 0:h.thenEffect,conditionalType:h==null?void 0:h.type},{newState:_}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Reveal/Give Effect Executor
 *
 * Handles reveal and give card effects.
 * Extracted 1:1 from effectInterpreter.ts for modularity.
 */function s0(a,n,l,c,i){const{cardOwner:d,opponent:u}=c,h=i._conditional,f=i.count||1,m=i.action,y=i.source||"own_hand";if(m==="reveal"&&y==="board"){const _=i.targetFilter||{owner:"any",position:"uncovered",faceState:"face_down"},w=i.followUpAction,b=i.optional!==!1,N=[],S=_.owner==="own"?[d]:_.owner==="opponent"?[u]:[d,u];for(const C of S)for(let j=0;j<l[C].lanes.length;j++){const R=l[C].lanes[j];if(R.length>0){let F=[];_.position==="uncovered"?F=[R[R.length-1]]:_.position==="covered"?F=R.slice(0,-1):F=[...R];const L=F.filter(U=>_.faceState==="face_up"?U.isFaceUp:_.faceState==="face_down"?!U.isFaceUp:!0);N.push(...L)}}if(N.length===0)return{newState:ae(l,d,"No valid cards to reveal. Effect skipped.")};let k={...l};return k.actionRequired={type:"select_board_card_to_reveal_custom",sourceCardId:a.id,actor:d,targetFilter:_,followUpAction:w,optional:b,followUpEffect:h==null?void 0:h.thenEffect,conditionalType:h==null?void 0:h.type},{newState:k}}if(m==="reveal"&&y==="opponent_hand"){let _={...l};const w={..._[u]};if(w.hand.length>0){w.hand=w.hand.map(N=>({...N,isRevealed:!0})),_[u]=w;const b=`${a.protocol}-${a.value}`;_=ae(_,d,`${b}: Your opponent reveals their hand.`)}else{const b=`${a.protocol}-${a.value}`;_=ae(_,d,`${b}: Opponent has no cards to reveal.`)}return{newState:_}}if(m==="reveal"&&y==="own_deck_top"){let _={...l};const w={..._[d]},b=`${a.protocol}-${a.value}`;if(w.deck.length===0)return _=ae(_,d,`${b}: No cards in deck to reveal.`),{newState:_};const N=[...w.deck],S=N[0];_=ae(_,d,`${b}: Revealed ${S.protocol}-${S.value} from top of deck.`);const k=`deck-top-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;return N[0]={...S,id:k},w.deck=N,_[d]=w,_.lastCustomEffectTargetCardId=k,{newState:_}}if(m==="reveal"&&y==="own_deck"){let _={...l};const w={..._[d]},b=`${a.protocol}-${a.value}`;if(w.deck.length===0)return _=ae(_,d,`${b}: No cards in deck to reveal.`),{newState:_};w.deckRevealed=!0,_[d]=w;const N=w.deck.map(S=>`${S.protocol}-${S.value}`).join(", ");return _=ae(_,d,`${b}: Revealed deck: ${N}`),{newState:_}}if(l[d].hand.length===0)return{newState:ae(l,d,`No cards in hand to ${m}. Effect skipped.`)};let v={...l};return m==="reveal"?v.actionRequired={type:"select_card_from_hand_to_reveal",count:f,sourceCardId:a.id,actor:d,followUpEffect:h==null?void 0:h.thenEffect,conditionalType:h==null?void 0:h.type}:m==="give"&&(v.actionRequired={type:"select_card_from_hand_to_give",count:f,sourceCardId:a.id,actor:d,followUpEffect:h==null?void 0:h.thenEffect,conditionalType:h==null?void 0:h.type}),{newState:v}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Shuffle Effect Executor
 *
 * Handles shuffle_trash and shuffle_deck effects.
 * - shuffle_trash: Clarity-4 "You may shuffle your trash into your deck."
 *   (In this codebase, "trash" = "discard pile")
 * - shuffle_deck: Clarity-2/3 "Shuffle your deck."
 */function c0(a,n,l,c,i){const{cardOwner:d}=c,u=i._conditional,h=`${a.protocol}-${a.value}`,f=i.optional!==!1;if(l[d].discard.length===0)return{newState:ae(l,d,`${h}: No cards in trash to shuffle.`)};if(f){let m={...l};return m.actionRequired={type:"prompt_optional_shuffle_trash",sourceCardId:a.id,actor:d,trashCount:l[d].discard.length,followUpEffect:u==null?void 0:u.thenEffect,conditionalType:u==null?void 0:u.type},{newState:m}}return em(l,d,h)}function em(a,n,l){let c={...a};const i={...c[n]},d=i.discard.length;return d===0?(c=ae(c,n,`${l}: No cards in trash to shuffle.`),{newState:c}):(i.deck=[...i.deck,...i.discard],i.discard=[],i.deck=Nn([...i.deck]),c[n]=i,c=ae(c,n,`${l}: Shuffled ${d} card${d!==1?"s":""} from trash into deck.`),{newState:c})}function i0(a,n,l,c,i){const{cardOwner:d}=c,u=`${a.protocol}-${a.value}`;let h={...l};const f={...h[d]};return f.deck.length===0?(h=ae(h,d,`${u}: No cards in deck to shuffle.`),{newState:h}):(f.deck=Nn([...f.deck]),f.deckRevealed=!1,h[d]=f,h=ae(h,d,`${u}: Shuffled deck.`),{newState:h})}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function ct(a,n,l,c,i,d){var k,C,j;const u={...i.params,_conditional:i.conditional},h=u.action,f=_e(l,a.id);if(!f)return{newState:l};if(!f.card.isFaceUp)return{newState:l};const m=i.position||"middle",v=i.trigger==="on_cover",_=u.useCardFromPreviousEffect===!0;if(m!=="top"&&!v&&!_&&!vo(l,a.id))return{newState:l};const b=h==="reveal"&&u.source==="board";if(u.optional===!0&&!b){const R=u.actor==="opponent"?c.opponent:c.cardOwner,F=R==="player"?"opponent":"player",L=u.targetFilter||{},U=$=>{for(const E of["player","opponent"])for(let A=0;A<l[E].lanes.length;A++){const O=l[E].lanes[A];for(let I=0;I<O.length;I++)if($(O[I],E,A,I))return!0}return!1};let Q=!0,X="";switch(h){case"discard":!u.useCardFromPreviousEffect&&l[R].hand.length===0&&(Q=!1,X="No cards to discard");break;case"flip":{const $=(k=l.passiveEffects)==null?void 0:k.some(E=>E.type==="prevent_flip_to_face_up"&&E.isActive);Q=U((E,A,O,I)=>{if(L.excludeSelf&&E.id===a.id||L.owner==="own"&&A!==R||L.owner==="opponent"&&A===R)return!1;const T=I===l[A].lanes[O].length-1;return!(L.position==="uncovered"&&!T||L.position==="covered"&&T||L.faceState==="face_up"&&!E.isFaceUp||L.faceState==="face_down"&&E.isFaceUp||$&&!E.isFaceUp)}),Q||(X="No valid cards to flip");break}case"delete":{Q=U(($,E,A,O)=>{if(L.excludeSelf&&$.id===a.id||L.owner==="own"&&E!==R||L.owner==="opponent"&&E===R)return!1;const I=O===l[E].lanes[A].length-1,T=L.position||"uncovered";return!(T==="uncovered"&&!I||T==="covered"&&I||L.faceState==="face_up"&&!$.isFaceUp||L.faceState==="face_down"&&$.isFaceUp)}),Q||(X="No valid cards to delete");break}case"shift":{if(i.useCardFromPreviousEffect){const $=l.lastCustomEffectTargetCardId||l._selectedCardFromPreviousEffect;$?(Q=!!_e(l,$),Q||(X="Target card no longer exists")):(Q=!1,X="No target card from previous effect")}else if(u.shiftSelf&&((C=u.destinationRestriction)==null?void 0:C.type)==="opponent_highest_value_lane")am(l,c.cardOwner).includes(n)&&(Q=!1,X="Card is already in opponent's highest value lane");else if(((j=u.advancedConditional)==null?void 0:j.type)==="this_card_is_covered"){const $=l[c.cardOwner].lanes;let E=!1;for(let A=0;A<$.length;A++){const O=$[A],I=O.findIndex(T=>T.id===a.id);if(I!==-1){E=I<O.length-1;break}}E||(Q=!1,X="Card is not covered")}else{const $=L.position||"uncovered";$==="any"&&L.owner==="own"&&!L.excludeSelf?Q=!0:(Q=U((A,O,I,T)=>{if(L.excludeSelf&&A.id===a.id||L.owner==="own"&&O!==R||L.owner==="opponent"&&O===R)return!1;const q=T===l[O].lanes[I].length-1;return!($==="uncovered"&&!q||$==="covered"&&q)}),Q||(X="No valid cards to shift"))}break}case"return":{const $=L.owner==="opponent"?F:R;Q=U((E,A,O,I)=>{if(A!==$)return!1;const T=I===l[A].lanes[O].length-1,q=L.position||"uncovered";return!(q==="uncovered"&&!T||q==="covered"&&T)}),Q||(X="No valid cards to return");break}case"draw":l[R].deck.length===0&&l[R].discard.length===0&&(Q=!1,X="No cards to draw");break;case"play":l[R].hand.length===0&&(Q=!1,X="No cards to play");break}if(!Q){let $=ae(l,R,`${X} - effect skipped.`);return $._effectSkippedNoTargets=!0,h==="discard"&&($._discardContext={discardedCount:0}),{newState:$}}let V={...l};return V.actionRequired={type:"prompt_optional_effect",actor:c.cardOwner,sourceCardId:a.id,effectDef:i,laneIndex:n},{newState:V}}let N;const S={logSource:l._currentEffectSource,logPhase:l._currentPhaseContext,logIndentLevel:l._logIndentLevel||0};switch(h){case"refresh":{const F=(u.target||"self")==="opponent"?c.opponent:c.actor,L=Ld(l,F);if(!L.allowed){N={newState:ae(l,c.cardOwner,L.reason||"Cannot refresh (draw blocked).")};break}const U=l[F].hand.length,Q=Math.max(0,5-U);if(Q>0){const{drawnCards:X,remainingDeck:V,newDiscard:$}=Hn(l[F].deck,l[F].discard,Q),E=X.map(T=>({...T,id:Xe()}));let A={...l,[F]:{...l[F],hand:[...l[F].hand,...E],deck:V,discard:$}};const O=F==="player"?` (${X.map(T=>`${T.protocol}-${T.value}`).join(", ")})`:"";A=ae(A,F,`[Refresh] Drew ${X.length} cards to reach hand size 5${O}.`),A=Rt(A,"after_draw",{player:F,count:X.length}).newState,N={newState:A}}else N={newState:ae(l,F,`[Refresh] Hand already at ${U} cards, no draw needed.`)};break}case"mutual_draw":{const R=c.actor,F=R==="player"?"opponent":"player",L=u.count||1;let U={...l};if(U[F].deck.length>0){const{drawnCards:Q,remainingDeck:X,newDiscard:V}=Hn(U[F].deck,U[F].discard,L);if(Q.length>0){const $=Q.map(I=>({...I,id:Xe(),isFaceUp:!0}));U={...U,[F]:{...U[F],deck:X,discard:V},[R]:{...U[R],hand:[...U[R].hand,...$]}};const E=R==="player"?"Player":"Opponent",A=F==="player"?"Player":"Opponent",O=R==="player"?` (${$.map(I=>`${I.protocol}-${I.value}`).join(", ")})`:"";U=ae(U,R,`${E} drew ${Q.length} card(s) from ${A}'s deck${O}.`)}}if(U[R].deck.length>0){const{drawnCards:Q,remainingDeck:X,newDiscard:V}=Hn(U[R].deck,U[R].discard,L);if(Q.length>0){const $=Q.map(I=>({...I,id:Xe(),isFaceUp:!0}));U={...U,[R]:{...U[R],deck:X,discard:V},[F]:{...U[F],hand:[...U[F].hand,...$]}};const E=F==="player"?"Player":"Opponent",A=R==="player"?"Player":"Opponent",O=F==="player"?` (${$.map(I=>`${I.protocol}-${I.value}`).join(", ")})`:"";U=ae(U,F,`${E} drew ${Q.length} card(s) from ${A}'s deck${O}.`)}}N={newState:U};break}case"draw":N=e0(a,n,l,c,u);break;case"flip":N=t0(a,n,l,c,u);break;case"delete":N=n0(a,n,l,c,u);break;case"discard":N=a0(a,n,l,c,u);break;case"shift":N=o0(a,n,l,c,{...u,useCardFromPreviousEffect:i.useCardFromPreviousEffect});break;case"return":N=r0(a,n,l,c,u);break;case"play":N=l0(a,n,l,c,u);break;case"rearrange_protocols":case"swap_protocols":N=d0(a,n,l,c,u);break;case"reveal":case"give":N=s0(a,n,l,c,u);break;case"take":N=u0(a,n,l,c,u);break;case"choice":N=f0(a,n,l,c,u);break;case"block_compile":N=p0(a,n,l,c,u);break;case"delete_all_in_lane":N=h0(a,n,l,c,u);break;case"shuffle_trash":N=c0(a,n,l,c,u);break;case"shuffle_deck":N=i0(a,n,l,c);break;default:console.error(`[Custom Effect] Unknown action: ${h}`),N={newState:l};break}if(N.newState.actionRequired&&!N.newState.actionRequired.logSource&&(N={...N,newState:{...N.newState,actionRequired:{...N.newState.actionRequired,logSource:S.logSource,logPhase:S.logPhase,logIndentLevel:S.logIndentLevel}}}),i.conditional&&i.conditional.thenEffect){const{newState:R}=N;if(R.actionRequired)N={newState:{...R,actionRequired:{...R.actionRequired,followUpEffect:i.conditional.thenEffect,conditionalType:i.conditional.type,outerSourceCardId:a.id,outerLaneIndex:n}}};else{if(i.conditional.type==="if_executed"){const U=R._discardContext;if(((U==null?void 0:U.discardedCount)||0)===0)return delete R._discardContext,N={newState:R},N}if(i.conditional.type==="optional"){let U={...R};return U.actionRequired={type:"prompt_optional_effect",actor:c.cardOwner,sourceCardId:a.id,effectDef:i.conditional.thenEffect,laneIndex:n,savedTargetCardId:R.lastCustomEffectTargetCardId},N={newState:U},N}let F=c;const L=R._discardContext;L&&(F={...c,discardedCount:L.discardedCount,previousHandSize:L.previousHandSize},delete R._discardContext),N=ct(a,n,R,F,i.conditional.thenEffect)}}return N}function d0(a,n,l,c,i){const{cardOwner:d,opponent:u}=c,h=i.action,m=(i.target||"own")==="opponent"?u:d,y=d;if(O_(l)&&h==="rearrange_protocols")return{newState:ae(l,d,"Protocols cannot be rearranged (Frost-1 bottom effect is active).")};let _={...l},w;return i.restriction&&(w={laneIndex:i.restriction.laneIndex==="current"?n:i.restriction.laneIndex,protocol:i.restriction.disallowedProtocol}),h==="rearrange_protocols"?_.actionRequired={type:"prompt_rearrange_protocols",actor:y,target:m,sourceCardId:a.id,disallowedProtocolForLane:w}:h==="swap_protocols"&&(_.actionRequired={type:"prompt_swap_protocols",actor:y,target:m,sourceCardId:a.id,disallowedProtocolForLane:w}),{newState:_}}function u0(a,n,l,c,i){const{cardOwner:d,opponent:u}=c,h=i.count||1,f=i.random!==!1;if(l[u].hand.length===0)return{newState:ae(l,d,"Opponent has no cards in hand. Effect skipped.")};let m={...l};const y={...m[u]},v={...m[d]};if(f){const _=Math.min(h,y.hand.length),w=[];for(let k=0;k<_;k++){const C=Math.floor(Math.random()*y.hand.length),j=y.hand.splice(C,1)[0];v.hand.push(j),w.push(j)}m={...m,[d]:v,[u]:y};const b=d==="player"?"Player":"Opponent",N=`${a.protocol}-${a.value}`,S=w.map(k=>d==="player"?`${k.protocol}-${k.value}`:"a card").join(", ");return m=ae(m,d,`${N}: ${b} takes ${S} from the opponent's hand.`),{newState:m}}else{console.warn("[Take Effect] Non-random take not yet implemented, falling back to random");const _=Math.floor(Math.random()*y.hand.length),w=y.hand.splice(_,1)[0];v.hand.push(w),m={...m,[d]:v,[u]:y};const b=d==="player"?"Player":"Opponent",N=`${a.protocol}-${a.value}`,S=d==="player"?`${w.protocol}-${w.value}`:"a card";return m=ae(m,d,`${N}: ${b} takes ${S} from the opponent's hand.`),{newState:m}}}function f0(a,n,l,c,i){const{cardOwner:d}=c,u=i.options||[];if(u.length!==2)return console.error(`[Choice Effect] Expected 2 options, got ${u.length}`),{newState:l};let h={...l};return h.actionRequired={type:"custom_choice",options:u,sourceCardId:a.id,actor:d,laneIndex:n},{newState:h}}function p0(a,n,l,c,i){const{cardOwner:d,opponent:u}=c,f=(i.target||"opponent")==="opponent"?u:d,m={...l[f],cannotCompile:!0};let y={...l,[f]:m};const v=_e(l,a.id),_=v?`${v.card.protocol}-${v.card.value}`:"Effect";return y=ae(y,d,`${_}: ${f==="player"?"Player":"Opponent"} cannot compile next turn.`),{newState:y}}function h0(a,n,l,c,i){var y;const{cardOwner:d}=c,u=i.excludeCurrentLane!==!1,h=((y=i.laneCondition)==null?void 0:y.count)||8,f=[];for(let v=0;v<3;v++){if(u&&v===n)continue;l.player.lanes[v].length+l.opponent.lanes[v].length>=h&&f.push(v)}if(f.length===0){const v=`${a.protocol}-${a.value}`;return{newState:ae(l,d,`${v}: No line has ${h} or more cards. Effect skipped.`)}}let m={...l};return m.actionRequired={type:"select_lane_for_delete_all",sourceCardId:a.id,actor:d,validLanes:f,minCards:h},{newState:m}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function Rt(a,n,l){var h;let c={...a};if(c._processingReactiveEffects)return{newState:c};c={...c,_processingReactiveEffects:!0};const i=c.processedClearCacheTriggerIds||[],d=[],u=f=>f.some(m=>m.trigger===n||m.trigger==="on_cover_or_flip"&&(n==="on_cover"||n==="on_flip"));for(const f of["player","opponent"])c[f].lanes.forEach((m,y)=>{m.forEach((v,_)=>{if(!v.isFaceUp)return;const w=c._committedCardId;if(w&&v.id===w)return;const b=v;if(!b.customEffects)return;const N=_===m.length-1;if(b.customEffects.topEffects&&u(b.customEffects.topEffects)){if(n==="after_clear_cache"&&i.includes(v.id))return;d.push({card:v,owner:f,laneIndex:y,box:"top"})}if(b.customEffects.middleEffects&&u(b.customEffects.middleEffects)){if(n==="after_clear_cache"&&i.includes(v.id))return;d.push({card:v,owner:f,laneIndex:y,box:"middle"})}if(N&&b.customEffects.bottomEffects){const S=b.customEffects.bottomEffects.filter(k=>k.trigger!=="on_cover");if(S.length>0&&u(S)){if(n==="after_clear_cache"&&i.includes(v.id))return;d.push({card:v,owner:f,laneIndex:y,box:"bottom"})}}})});if(d.length===0)return delete c._processingReactiveEffects,{newState:c};for(const{card:f,owner:m,laneIndex:y,box:v}of d){const _=c[m].lanes[y],w=_==null?void 0:_.findIndex(L=>L.id===f.id);if(!(w!==void 0&&w!==-1&&((h=_[w])==null?void 0:h.isFaceUp))||v==="bottom"&&!(w===_.length-1)||n==="before_compile_delete"&&(l==null?void 0:l.cardId)!==f.id||n==="on_flip"&&(l==null?void 0:l.cardId)!==f.id||(n==="on_cover"||n==="on_flip")&&l!=null&&l.cardId&&l.cardId!==f.id)continue;const N=f,C=(v==="top"?N.customEffects.topEffects:v==="middle"?N.customEffects.middleEffects:N.customEffects.bottomEffects).filter(L=>L.trigger===n||L.trigger==="on_cover_or_flip"&&(n==="on_cover"||n==="on_flip")).filter(L=>{const U=L.reactiveTriggerActor||"self";if(!(l!=null&&l.player))return!0;if(n==="after_opponent_discard")return l.player===m;if(U==="self"){if(l.player!==m)return!1}else if(U==="opponent"&&l.player===m)return!1;return!((L.reactiveScope||"global")==="this_lane"&&(l==null?void 0:l.laneIndex)!==void 0&&y!==l.laneIndex)});if(C.length===0)continue;const j=`${f.protocol}-${f.value}`;c=Oa(c),c=Me(c,j),c=Ge(c,void 0);const R=m==="player"?"opponent":"player",F={cardOwner:m,actor:m,currentTurn:c.turn,opponent:R,triggerType:n};if(n==="after_clear_cache"){const L=c.processedClearCacheTriggerIds||[];c.processedClearCacheTriggerIds=[...L,f.id]}for(const L of C){const U=ct(f,y,c,F,L);if(c=we(U.newState),c.actionRequired){const Q=c._pendingCustomEffects;if(Q&&Q.effects.length>0){const X={type:"execute_remaining_custom_effects",sourceCardId:Q.sourceCardId,laneIndex:Q.laneIndex,effects:Q.effects,context:Q.context,actor:Q.context.cardOwner};c.queuedActions=[X,...c.queuedActions||[]],delete c._pendingCustomEffects}return delete c._processingReactiveEffects,{newState:c}}}c=_o(c),c=Me(c,void 0),c=Ge(c,void 0)}return delete c._processingReactiveEffects,{newState:c}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function Hn(a,n,l){let c=[...a],i=[...n],d=[],u=!1;for(let h=0;h<l;h++){if(c.length===0){if(i.length===0)break;c=Nn(i),i=[],u=!0}d.push(c.shift())}return{drawnCards:d,remainingDeck:c,newDiscard:i,reshuffled:u}}function Xo(a,n,l,c="effect"){const i=a[n],{drawnCards:d,remainingDeck:u,newDiscard:h,reshuffled:f}=Hn(i.deck,i.discard,l);if(d.length===0)return a;const m=d.map(b=>({...b,id:Xe(),isFaceUp:!0})),y=m.map(b=>b.id),v={...i.stats,cardsDrawn:i.stats.cardsDrawn+d.length},_={...i,deck:u,discard:h,hand:[...i.hand,...m],stats:v};let w={...a,[n]:_,stats:{...a.stats,[n]:v}};if(w.detailedGameStats&&d.length>0){const b=c==="refresh",N=n==="player"?b?"playerFromRefresh":"playerFromEffect":b?"aiFromRefresh":"aiFromEffect";w={...w,detailedGameStats:{...w.detailedGameStats,cardsDrawn:{...w.detailedGameStats.cardsDrawn,[N]:w.detailedGameStats.cardsDrawn[N]+d.length}}}}return y.length>0&&(w.animationState={type:"drawCard",owner:n,cardIds:y}),f&&(w=ae(w,n,`${n==="player"?"Player":"Opponent"}'s deck is empty. Discard pile has been reshuffled into the deck.`)),d.length>0&&(w=Rt(w,"after_draw",{player:n,count:d.length}).newState),w}function m0(a,n,l){const c=n==="player"?"opponent":"player";let i={...a};const d={...i[c]},u={...i[n]},{drawnCards:h,remainingDeck:f,newDiscard:m,reshuffled:y}=Hn(d.deck,d.discard,l);if(h.length>0){const v=h.map(b=>({...b,id:Xe(),isFaceUp:!0})),_=v.map(b=>b.id);u.hand=[...u.hand,...v];const w={...u.stats,cardsDrawn:u.stats.cardsDrawn+h.length};if(u.stats=w,d.deck=f,d.discard=m,i={...i,[n]:u,[c]:d,stats:{...i.stats,[n]:w}},_.length>0&&(i.animationState={type:"drawCard",owner:n,cardIds:_}),y&&(i=ae(i,n,`${c==="player"?"Player":"Opponent"}'s deck is empty. Discard pile has been reshuffled into the deck.`)),i.detailedGameStats&&h.length>0){const b=n==="player"?"playerFromEffect":"aiFromEffect";i={...i,detailedGameStats:{...i.detailedGameStats,cardsDrawn:{...i.detailedGameStats.cardsDrawn,[b]:i.detailedGameStats.cardsDrawn[b]+h.length}}}}}return i}function y0(a,n){const c=5-a[n].hand.length;if(c<=0)return a;let d=ae(a,n,`${n==="player"?"Player":"Opponent"} refreshes their hand, drawing ${c} card(s).`);d=Xo(d,n,c,"refresh");const u={...d[n],stats:{...d[n].stats,handsRefreshed:d[n].stats.handsRefreshed+1}};if(d={...d,[n]:u,stats:{...d.stats,[n]:u.stats}},d.detailedGameStats){const h=n==="player"?"playerCardsDrawn":"aiCardsDrawn";d={...d,detailedGameStats:{...d.detailedGameStats,refreshes:{...d.detailedGameStats.refreshes,[h]:d.detailedGameStats.refreshes[h]+c}}}}return d}function Wo(a,n){const l={...n},c=i=>i.map(d=>d.map(u=>a.has(u.id)?{...u,isFaceUp:!u.isFaceUp}:u));return l.player.lanes=c(l.player.lanes),l.opponent.lanes=c(l.opponent.lanes),we(l)}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Nh=a=>{const n=Nn(Pa(a)),{drawnCards:l,remainingDeck:c}=Hn(n,[],5),i={cardsPlayed:0,cardsDiscarded:0,cardsDeleted:0,cardsFlipped:0,cardsShifted:0,cardsDrawn:l.length,cardsReturned:0,handsRefreshed:0},d=l.map(u=>({...u,id:Xe(),isFaceUp:!0}));return{protocols:a,deck:c,hand:d,lanes:[[],[],[]],discard:[],compiled:[!1,!1,!1],laneValues:[0,0,0],cannotCompile:!1,stats:i}},Hl=(a,n,l,c="player")=>{const i=Nh(a),d=Nh(n),u={player:i,opponent:d,turn:c,phase:"start",controlCardHolder:null,useControlMechanic:l,winner:null,log:[],actionRequired:null,queuedActions:[],animationState:null,compilableLanes:[],processedStartEffectIds:[],processedEndEffectIds:[],lastPlayedCardId:void 0,stats:{player:i.stats,opponent:d.stats},detailedGameStats:{cardsPlayed:{playerFromHand:0,playerFromEffect:0,aiFromHand:0,aiFromEffect:0,playerFaceUp:0,playerFaceDown:0,aiFaceUp:0,aiFaceDown:0},cardsDrawn:{playerFromRefresh:0,playerFromEffect:0,aiFromRefresh:0,aiFromEffect:0},compiles:{playerFirstCompile:0,playerRecompile:0,aiFirstCompile:0,aiRecompile:0},refreshes:{playerCardsDrawn:0,aiCardsDrawn:0}}},h=c==="player"?"Player":"Opponent",f=a.join(", "),m=n.join(", ");let y=ae(u,"player","Game Started.");return y=ae(y,"player",`Player protocols: ${f}`),y=ae(y,"opponent",`Opponent protocols: ${m}`),y=ae(y,"player",`${h} goes first.`),y},ea=(a,n,l,c,i)=>{if(a.isFaceUp)return a.value;if(n.some(u=>u.isFaceUp&&u.protocol==="Darkness"&&u.value===2))return 4;if(l&&c!==void 0&&i!==void 0){const u=tm(l);for(const h of u)if(h.type==="set_to_fixed"){if(!(h.scope==="global"||h.scope==="this_lane"&&h.laneIndex===c))continue;const m=h.cardOwner;if(h.target==="own_cards"&&m!==i||h.target==="opponent_cards"&&m===i)continue;const y=h.filter;if(y&&(!y.faceState||y.faceState==="any"||y.faceState==="face_down"&&!a.isFaceUp||y.faceState==="face_up"&&a.isFaceUp))return h.value}}return 2},Rh=(a,n,l,c)=>{let i=0;for(const d of a)d.isFaceUp?i+=d.value:i+=ea(d,a,n,l,c);return Math.max(0,i)};function tm(a){const n=[];for(const l of["player","opponent"])a[l].lanes.forEach((c,i)=>{c.forEach(d=>{if(d.isFaceUp){const u=d;u.customEffects&&[...u.customEffects.topEffects||[],...u.customEffects.middleEffects||[],...u.customEffects.bottomEffects||[]].forEach(f=>{f.params.action==="value_modifier"&&f.trigger==="passive"&&n.push({...f.params.modifier,cardOwner:l,laneIndex:i})})}})});return n}function g0(a,n,l){const c=tm(a),i=[...n],d=[...l];for(const u of c){const{type:h,value:f,condition:m,target:y,scope:v,filter:_,cardOwner:w,laneIndex:b}=u,N=v==="global"?[0,1,2]:[b];for(const S of N)switch(h){case"add_per_condition":{if(!m)continue;let k=0;const C=a.player.lanes[S],j=a.opponent.lanes[S];m==="per_face_down_card"?k=C.filter(R=>!R.isFaceUp).length+j.filter(R=>!R.isFaceUp).length:m==="per_face_up_card"?k=C.filter(R=>R.isFaceUp).length+j.filter(R=>R.isFaceUp).length:m==="per_card"?k=C.length+j.length:m==="per_card_in_hand"&&(k=a[w].hand.length),y==="own_total"&&w==="player"?i[S]+=f*k:y==="own_total"&&w==="opponent"||y==="opponent_total"&&w==="player"?d[S]+=f*k:y==="opponent_total"&&w==="opponent"&&(i[S]+=f*k);break}case"set_to_fixed":break;case"add_to_total":{y==="own_total"&&w==="player"?i[S]+=f:y==="own_total"&&w==="opponent"||y==="opponent_total"&&w==="player"?d[S]+=f:y==="opponent_total"&&w==="opponent"&&(i[S]+=f);break}}}return{finalPlayerValues:i.map(u=>Math.max(0,u)),finalOpponentValues:d.map(u=>Math.max(0,u))}}function v0(a,n,l){let c=[...n],i=[...l];return{finalPlayerValues:c,finalOpponentValues:i}}const we=a=>{const n=a.player.lanes.map((u,h)=>Rh(u,a,h,"player")),l=a.opponent.lanes.map((u,h)=>Rh(u,a,h,"opponent")),c=v0(a,n,l),{finalPlayerValues:i,finalOpponentValues:d}=g0(a,c.finalPlayerValues,c.finalOpponentValues);return{...a,player:{...a.player,laneValues:i},opponent:{...a.opponent,laneValues:d}}},nm=(a,n)=>{const l=[],c=a[n],i=a[n==="player"?"opponent":"player"];if(!c.cannotCompile)for(let d=0;d<3;d++){const u=c.laneValues[d],h=i.laneValues[d];u>=10&&u>h&&l.push(d)}return l},zn=(a,n,l)=>a[n].laneValues[l],_0=(a,n)=>{const l=n==="player"?"opponent":"player",c=[];for(let i=0;i<3;i++){const d=a[n].laneValues[i];a[l].laneValues[i]>d&&c.push(i)}return c},am=(a,n)=>{const l=n==="player"?"opponent":"player";let c=-1,i=[];for(let d=0;d<3;d++){const u=a[l].laneValues[d];u>c?(c=u,i=[d]):u===c&&i.push(d)}return i};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const x0=["select_card_to_flip","select_any_card_to_flip"];function w0(a,n,l){if(!l||!x0.includes(l.type))return null;const c=_e(a,n);if(c&&c.card.protocol==="Metal"&&c.card.value===6){const i="actor"in l?l.actor:a.turn,d=i==="player"?"Player":"Opponent",u=c.owner==="player"?"Player's":"Opponent's";let h="An effect";if("sourceCardId"in l&&l.sourceCardId){const C=_e(a,l.sourceCardId);C&&(h=`${C.card.protocol}-${C.card.value}`)}let f=ae(a,i,`${h}: ${d} flips ${u} Metal-6.`);f=ae(f,i,"Metal-6: Deletes itself when flipped.");const m={...a.stats[i],cardsDeleted:a.stats[i].cardsDeleted+1},y={...a[i],stats:m};f={...f,[i]:y,stats:{...f.stats,[i]:m}};const v=c.owner,_=a[v].lanes.findIndex(C=>C.some(j=>j.id===n)),w=a[v].lanes[_],b=w&&w.length>0&&w[w.length-1].id===n,N=w&&w.length>1,S=a._pendingCustomEffects,k=(C,j)=>{var X,V;let R={...C};const F=S&&((X=R.queuedActions)==null?void 0:X.some($=>$.type==="execute_remaining_custom_effects"&&$.sourceCardId===S.sourceCardId));S&&!F&&(R._pendingCustomEffects=S,R.lastCustomEffectTargetCardId=n);let U=Rt(R,"after_delete",{player:R.turn}).newState;if(b&&N&&(U=An(U,v,_).newState),l&&"count"in l&&l.count>1){const $=l.count-1;return U.actionRequired={...l,count:$},{...U,animationState:null}}if(R.actionRequired||R.queuedActions&&R.queuedActions.length>0)return{...U,actionRequired:R.actionRequired,queuedActions:R.queuedActions,animationState:null};const Q=S&&((V=U.queuedActions)==null?void 0:V.some($=>$.type==="execute_remaining_custom_effects"&&$.sourceCardId===S.sourceCardId));if(S&&!U._pendingCustomEffects&&!Q&&(U._pendingCustomEffects=S,U.lastCustomEffectTargetCardId=n),U=Ke(U),U.actionRequired=null,U.queuedActions&&U.queuedActions.length>0){const $=[...U.queuedActions],E=$.shift();if((E==null?void 0:E.type)==="execute_remaining_custom_effects"){const A={...U,queuedActions:[E,...$]},O=ya(A);if(O.actionRequired)return{...O,animationState:null};if(O.queuedActions&&O.queuedActions.length>0){const I=[...O.queuedActions],T=I.shift();return{...O,actionRequired:T,queuedActions:I,animationState:null}}return j(O)}return{...U,actionRequired:E,queuedActions:$,animationState:null}}return j(U)};return{nextState:{...f,actionRequired:null},requiresAnimation:{animationRequests:[{type:"delete",cardId:n,owner:c.owner}],onCompleteCallback:k},requiresTurnEnd:!1}}return null}const Ad=(a,n)=>{var u,h,f,m,y,v,_,w,b,N,S,k,C,j,R;if(!a.actionRequired)return{nextState:a};let l={...a},c=!0,i=null;const d=w0(a,n,a.actionRequired);if(d)return d;switch(a.actionRequired.type){case"select_card_to_flip":{const{logSource:F,logPhase:L,logIndentLevel:U}=a.actionRequired;F!==void 0&&(l=Me(l,F)),L!==void 0&&(l=Ge(l,L)),U!==void 0&&(l._logIndentLevel=U);const Q=a._committedCardId;if(Q&&n===Q)return{nextState:a};if(!Yl(a,n).allowed)return{nextState:a};const V=_e(a,n),$="draws"in a.actionRequired?a.actionRequired.draws:0;l=kd(a,n);const E=n;l.lastCustomEffectTargetCardId=E;const A=(u=a.actionRequired)==null?void 0:u.sourceCardId;if(A&&l.queuedActions&&(l.queuedActions=l.queuedActions.map(P=>{var Z;return P.type==="execute_remaining_custom_effects"&&P.sourceCardId===A&&!P.selectedCardFromPreviousEffect&&((Z=P.effects)==null?void 0:Z.some(G=>G.useCardFromPreviousEffect))?{...P,selectedCardFromPreviousEffect:n}:P})),$&&$>0){const{actor:P,sourceCardId:Z}=a.actionRequired,W=_e(l,Z),G=W?`${W.card.protocol}-${W.card.value}`:"A card effect";l=ae(l,P,`${G}: Drawing ${$} card(s).`),l=Xo(l,P,$)}if(V&&!V.card.isFaceUp){const P=Rd(l,n);l=P.newState,l.lastCustomEffectTargetCardId=E,P.animationRequests&&(i={animationRequests:P.animationRequests,onCompleteCallback:(Z,W)=>Z.actionRequired||Z.queuedActions&&Z.queuedActions.length>0?Z:W(Z)})}const O=(h=a.actionRequired)==null?void 0:h.followUpEffect,I=(f=a.actionRequired)==null?void 0:f.sourceCardId;O&&I&&(l=X_(l,n,I));const T=((m=a.actionRequired)==null?void 0:m.actor)||a.turn;l=Rt(l,"after_flip",{player:T,cardId:n}).newState;const Y=l._pendingCustomEffects;if(Y&&Y.effects.length>0){const P={type:"execute_remaining_custom_effects",sourceCardId:Y.sourceCardId,laneIndex:Y.laneIndex,effects:Y.effects,context:Y.context,actor:Y.context.cardOwner,selectedCardFromPreviousEffect:Y.effects[0].useCardFromPreviousEffect?n:void 0,logSource:Y.logSource,logPhase:Y.logPhase,logIndentLevel:Y.logIndentLevel};l.queuedActions=[P,...l.queuedActions||[]],delete l._pendingCustomEffects}const K=(y=a.actionRequired)==null?void 0:y.remainingLanes;if(K&&K.length>0&&!l.actionRequired){const P=K[0],Z=K.slice(1),W=(v=a.actionRequired)==null?void 0:v.params,G=(_=a.actionRequired)==null?void 0:_.sourceCardId,H=(w=a.actionRequired)==null?void 0:w.actor,B=(b=a.actionRequired)==null?void 0:b.targetFilter;l.actionRequired={type:"select_card_to_flip",sourceCardId:G,actor:H,currentLaneIndex:P,remainingLanes:Z,targetFilter:B,params:W,followUpEffect:(N=a.actionRequired)==null?void 0:N.followUpEffect,conditionalType:(S=a.actionRequired)==null?void 0:S.conditionalType}}(l.actionRequired||l.queuedActions&&l.queuedActions.length>0)&&(c=!1);break}case"select_card_to_shift":{const{logSource:F,logPhase:L,logIndentLevel:U}=a.actionRequired;F!==void 0&&(l=Me(l,F)),L!==void 0&&(l=Ge(l,L)),U!==void 0&&(l._logIndentLevel=U);const{sourceCardId:Q,optional:X}=a.actionRequired;if(X&&Q){const $=_e(a,Q);if(!$||!$.card.isFaceUp){const E=$?`${$.card.protocol}-${$.card.value}`:"the source card",A=a._logSource;l=Me(a,E),l=ae(l,a.actionRequired.actor,"Shift was cancelled because the source is no longer active."),l=Me(l,A),l=Ke(l),l.actionRequired=null,c=!0;break}}const V=_e(a,n);if(V){const{owner:$}=V;let E=-1;for(let P=0;P<a[$].lanes.length;P++)if(a[$].lanes[P].some(Z=>Z.id===n)){E=P;break}if(E===-1)return{nextState:a,requiresTurnEnd:!1};const O=(a.actionRequired.targetFilter||{}).position||"uncovered",I=a[$].lanes[E],q=I.findIndex(P=>P.id===n)===I.length-1;if(O==="uncovered"&&!q)return{nextState:a,requiresTurnEnd:!1};if(O==="covered"&&q)return{nextState:a,requiresTurnEnd:!1};const Y=a.actionRequired.scope,K=a.actionRequired.sourceLaneIndex;if(Y==="this_lane"&&K!==void 0&&E!==K)return{nextState:a,requiresTurnEnd:!1};if(E!==-1){const P=a.actionRequired.targetLaneIndex;if(P!==void 0){const W=a.actionRequired.actor;l=go(a,n,$,P,W).newState,c=!l.actionRequired;break}const Z={type:"select_lane_for_shift",cardToShiftId:n,cardOwner:$,originalLaneIndex:E,sourceCardId:a.actionRequired.sourceCardId,actor:a.actionRequired.actor,destinationRestriction:a.actionRequired.destinationRestriction,followUpEffect:a.actionRequired.followUpEffect,conditionalType:a.actionRequired.conditionalType};l.actionRequired=Z}}c=!1;break}case"delete_self":{const{sourceCardId:F,cardToDeleteId:L,actor:U,logSource:Q,logPhase:X,logIndentLevel:V}=a.actionRequired;Q!==void 0&&(l=Me(l,Q)),X!==void 0&&(l=Ge(l,X)),V!==void 0&&(l._logIndentLevel=V);const $=_e(a,L);if(!$){l=ae(l,U,"Card no longer on board. Delete skipped."),l=Ke(l),l.actionRequired=null,c=!0;break}const E=`${$.card.protocol}-${$.card.value}`;l=ae(l,U,`Deleting ${E}.`);const{owner:A,laneIndex:O}=$,I=a[A].lanes[O][a[A].lanes[O].length-1].id===L,T=[...a[A].lanes[O]],q=T.findIndex(Z=>Z.id===L);T.splice(q,1);const Y=[...a[A].lanes];Y[O]=T;let K={...a,[A]:{...a[A],lanes:Y}};l=Ke(K),l.actionRequired=null;const P={...l.stats[U],cardsDeleted:l.stats[U].cardsDeleted+1};l={...l,stats:{...l.stats,[U]:P}},I&&T.length>0&&(l=An(l,A,O).newState),c=!0;break}case"select_cards_to_delete":case"select_face_down_card_to_delete":case"select_low_value_card_to_delete":case"select_card_from_other_lanes_to_delete":{const{sourceCardId:F,actor:L}=a.actionRequired,{logSource:U,logPhase:Q,logIndentLevel:X}=a.actionRequired;U!==void 0&&(l=Me(l,U)),Q!==void 0&&(l=Ge(l,Q)),X!==void 0&&(l._logIndentLevel=X);const V=_e(a,F);if(!V||!V.card.isFaceUp){const B=V?`${V.card.protocol}-${V.card.value}`:"the source card";l=ae(l,L,`Effect from ${B} was cancelled because the source is no longer active.`),l=Ke(l),l.actionRequired=null,c=!0;break}const $=_e(a,n);if(!$)return{nextState:a};if(a.actionRequired.protocolMatching){const B=a.actionRequired.protocolMatching,ee=a[$.owner].lanes.findIndex(de=>de.some(J=>J.id===n));if(ee!==-1){const de=a.player.protocols[ee],J=a.opponent.protocols[ee],pe=$.card.protocol,fe=pe===de||pe===J;if(B==="must_match"&&!fe)return console.error(`Illegal delete: ${pe}-${$.card.value} in lane ${ee} (protocols: ${de}/${J}) - card must be in lane with matching protocol`),{nextState:a};if(B==="must_not_match"&&fe)return console.error(`Illegal delete: ${pe}-${$.card.value} in lane ${ee} (protocols: ${de}/${J}) - card must be in lane without matching protocol`),{nextState:a}}}const E=a.actionRequired.targetFilter;if((E==null?void 0:E.calculation)==="highest_value"||(E==null?void 0:E.calculation)==="lowest_value"){const B=E.owner,ee=B==="opponent"?L==="player"?"opponent":"player":B==="own"?L:$.owner,J=J_(a,ee).some(fe=>fe.card.id===n),pe=E.calculation==="highest_value"?"highest":"lowest";if(!J)return console.error(`Illegal delete: Card ${n} is not one of the ${pe} value uncovered cards`),{nextState:a}}const A=L==="player"?"Player":"Opponent",O=$.owner==="player"?"Player's":"Opponent's",I=a[$.owner].lanes.findIndex(B=>B.some(ee=>ee.id===n)),T=I!==-1?a[$.owner].protocols[I]:"unknown",q=$.card.isFaceUp?`${$.card.protocol}-${$.card.value}`:`face-down card in Protocol ${T}`,Y=_e(a,a.actionRequired.sourceCardId),K=Y?`${Y.card.protocol}-${Y.card.value}`:"a card effect";l=ae(l,L,`${K}: ${A} deletes ${O} ${q}.`);const P={...l.stats[L],cardsDeleted:l.stats[L].cardsDeleted+1},Z={...l[L],stats:P};l={...l,[L]:Z,stats:{...l.stats,[L]:P}};const W=a[$.owner].lanes.findIndex(B=>B.some(ee=>ee.id===n)),G=a[$.owner].lanes[W],H=G&&G.length>0&&G[G.length-1].id===n;l=Ke(l),l.actionRequired=null,i={animationRequests:[{type:"delete",cardId:n,owner:$.owner}],onCompleteCallback:(B,ee)=>{var qe,_t,Ft;const de=a.actionRequired.actor,J=a.actionRequired;let fe=Rt(B,"after_delete",{player:de}).newState;fe=Ke(fe);let ye=null;const ke=_e(fe,J.sourceCardId),Ve=vo(fe,J.sourceCardId),Le=J.followUpEffect;if(ke&&ke.card.isFaceUp&&Ve){const He=J.remainingLanes;if(J.type==="select_cards_to_delete"&&He&&He.length>0){const $e=He[0],nt=He.slice(1);ye={type:"select_cards_to_delete",count:((qe=J.params)==null?void 0:qe.count)||J.count,sourceCardId:J.sourceCardId,actor:J.actor,currentLaneIndex:$e,remainingLanes:nt,disallowedIds:(_t=J.params)!=null&&_t.excludeSelf?[J.sourceCardId]:[],targetFilter:J.targetFilter,scope:J.scope,protocolMatching:J.protocolMatching,params:J.params}}else if(J.type==="select_cards_to_delete"&&J.count>1)ye={type:"select_cards_to_delete",count:J.count-1,sourceCardId:J.sourceCardId,disallowedIds:[...J.disallowedIds,n],actor:J.actor,followUpEffect:Le};else if(J.type==="select_card_from_other_lanes_to_delete"&&J.count>1){const $e=a[$.owner].lanes.findIndex(bt=>bt.some(xt=>xt.id===n)),nt=[...J.lanesSelected,$e];[0,1,2].filter(bt=>bt!==J.disallowedLaneIndex&&!nt.includes(bt)).some(bt=>fe.player.lanes[bt].length>0||fe.opponent.lanes[bt].length>0)?ye={type:"select_card_from_other_lanes_to_delete",count:J.count-1,sourceCardId:J.sourceCardId,disallowedLaneIndex:J.disallowedLaneIndex,lanesSelected:nt,actor:J.actor}:fe=ae(fe,J.actor,"No cards left in remaining lanes. Effect skipped.")}}else if("count"in J&&J.count>1){const He=ke?`${ke.card.protocol}-${ke.card.value}`:"the source card",$e=!ke||!ke.card.isFaceUp?"the source is no longer active":"the source was covered";fe=ae(fe,J.actor,`Remaining deletes from ${He} were cancelled because ${$e}.`)}let at=!1;if(H){const He=fe,$e=An(He,$.owner,W),nt=$e.newState._interruptedTurn!==void 0;He._interruptedTurn&&!$e.newState._interruptedTurn&&(at=!0);const ot=[...$e.newState.queuedActions||[]];ye&&(nt?ot.push(ye):ot.unshift(ye)),fe={...$e.newState,queuedActions:ot}}else ye&&(fe.queuedActions=[...fe.queuedActions||[],ye]);if(Le&&!ye)if(fe.actionRequired){const He=_e(fe,J.sourceCardId),$e=J.actor==="player"?"opponent":"player";let nt=-1;He&&(nt=fe[He.owner].lanes.findIndex(bt=>bt.some(xt=>xt.id===J.sourceCardId)));const ot={cardOwner:J.actor,actor:J.actor,currentTurn:fe.turn,opponent:$e,triggerType:"start"},Pt={type:"execute_remaining_custom_effects",sourceCardId:J.sourceCardId,actor:J.actor,laneIndex:nt,effects:[Le],context:ot,logSource:J.logSource,logPhase:J.logPhase,logIndentLevel:J.logIndentLevel??1};fe.queuedActions=[...fe.queuedActions||[],Pt]}else{const He=_e(fe,J.sourceCardId),$e=J.actor==="player"?"opponent":"player";if(He){const nt=fe[He.owner].lanes.findIndex(xt=>xt.some(yt=>yt.id===J.sourceCardId)),ot={cardOwner:J.actor,actor:J.actor,currentTurn:fe.turn,opponent:$e,triggerType:"start"},Pt=`${He.card.protocol}-${He.card.value}`;fe=Me(fe,J.logSource||Pt),fe=Ge(fe,J.logPhase||"start"),fe._logIndentLevel=J.logIndentLevel??1,fe=ct(He.card,nt,fe,ot,Le).newState,fe=Ke(fe)}else(Ft=Le.params)!=null&&Ft.deleteSelf&&(fe=Me(fe,J.logSource||"the source card"),fe=Ge(fe,J.logPhase||"start"),fe._logIndentLevel=J.logIndentLevel??1,fe=internalDeleteCard(fe,J.sourceCardId).newState,fe=ae(fe,J.actor,"Deletes itself."))}if(fe.actionRequired)return fe;if(fe.queuedActions&&fe.queuedActions.length>0){const He=fe.queuedActions[0];if((He==null?void 0:He.type)==="execute_remaining_custom_effects"){const ot=ya(fe);return ot.actionRequired?ot:ee(ot)}const $e=[...fe.queuedActions],nt=$e.shift();if((nt==null?void 0:nt.type)==="shift_flipped_card_optional"||(nt==null?void 0:nt.type)==="gravity_2_shift_after_flip"){const ot=_e(fe,nt.sourceCardId),Pt=vo(fe,nt.sourceCardId);if(!ot||!ot.card.isFaceUp||!Pt){const bt=ot?`${ot.card.protocol}-${ot.card.value}`:"the source card";let xt=ae(fe,nt.actor,`Shift from ${bt} was cancelled because the source is no longer active.`);if($e.length>0){const yt=$e.shift();return{...xt,actionRequired:yt,queuedActions:$e}}else return ee({...xt,actionRequired:null,queuedActions:[]})}}return{...fe,actionRequired:nt,queuedActions:$e}}if(at){if(fe.queuedActions&&fe.queuedActions.length>0){const He=[...fe.queuedActions],$e=He.shift();if(($e==null?void 0:$e.type)==="execute_remaining_custom_effects"){const nt={...fe,queuedActions:[$e,...He]},ot=ya(nt);return ot.actionRequired?ot:fe}return{...fe,actionRequired:$e,queuedActions:He}}return fe}if(Le&&ke&&ke.card.isFaceUp&&(!((Le.position||"middle")!=="top")||Ve)){const ot=fe[ke.owner].lanes.findIndex(Mt=>Mt.some(wt=>wt.id===J.sourceCardId)),Pt=J.actor==="player"?"opponent":"player",bt=Le.trigger||"on_play",xt={cardOwner:J.actor,actor:J.actor,currentTurn:fe.turn,opponent:Pt,triggerType:bt};if(fe=ct(ke.card,ot,fe,xt,Le).newState,_e(fe,J.sourceCardId),fe.actionRequired)return fe}return ee(fe)}},c=!1;break}case"plague_4_opponent_delete":{const F=_e(a,n);if(!F)return{nextState:a};const L=a.actionRequired.actor;l=ae(l,L,"Plague-4: Opponent deletes one of their face-down cards.");const U={...l.stats[L],cardsDeleted:l.stats[L].cardsDeleted+1},Q={...l[L],stats:U};l={...l,[L]:Q,stats:{...l.stats,[L]:U}};const X=a[F.owner].lanes.findIndex(E=>E.some(A=>A.id===n)),V=a[F.owner].lanes[X],$=V&&V.length>0&&V[V.length-1].id===n;l=Ke(l),l.actionRequired=null,i={animationRequests:[{type:"delete",cardId:n,owner:F.owner}],onCompleteCallback:(E,A)=>{let I=Rt(E,"after_delete",{player:L}).newState;$&&(I=An(I,F.owner,X).newState);const T=_e(I,a.actionRequired.sourceCardId),q=(T==null?void 0:T.owner)||a.turn,Y={type:"plague_4_player_flip_optional",sourceCardId:a.actionRequired.sourceCardId,optional:!0,actor:q};return I.actionRequired?I.queuedActions=[...I.queuedActions||[],Y]:I.actionRequired=Y,I}},c=!1;break}case"select_card_to_return":{const{logSource:F,logPhase:L,logIndentLevel:U}=a.actionRequired;F!==void 0&&(l=Me(l,F)),L!==void 0&&(l=Ge(l,L)),U!==void 0&&(l._logIndentLevel=U);const{sourceCardId:Q,actor:X}=a.actionRequired,V=(k=a.actionRequired)==null?void 0:k.followUpEffect,$=(C=a.actionRequired)==null?void 0:C.conditionalType,E=(j=a.actionRequired)==null?void 0:j.targetFilter,A=_e(a,n);if(A){const I=a[A.owner].lanes[A.laneIndex],T=((R=I[I.length-1])==null?void 0:R.id)===n,q=(E==null?void 0:E.position)==="covered"||(E==null?void 0:E.position)==="any";if(!T&&!q)return console.error(`[cardResolver] Invalid return target: ${A.card.protocol}-${A.card.value} is covered`),{nextState:a,requiresTurnEnd:!1}}const O=Nd(a,n);if(l=O.newState,O.animationRequests)i={animationRequests:O.animationRequests,onCompleteCallback:(I,T)=>{if(I.actionRequired)return I;let q=I;if(V&&Q&&($!=="if_executed"||n)){const K=_e(q,Q);if(K&&K.card.isFaceUp){const P=q[K.owner].lanes.find(H=>H.some(B=>B.id===Q)),Z=q[K.owner].lanes.indexOf(P),W={cardOwner:K.owner,actor:X,currentTurn:q.turn,opponent:K.owner==="player"?"opponent":"player"};if(q=ct(K.card,Z,q,W,V).newState,q.actionRequired)return q}}return T(q)}};else if(V&&Q&&($!=="if_executed"||n)){const T=_e(l,Q);if(T&&T.card.isFaceUp){const q=l[T.owner].lanes.find(Z=>Z.some(W=>W.id===Q)),Y=l[T.owner].lanes.indexOf(q),K={cardOwner:T.owner,actor:X,currentTurn:l.turn,opponent:T.owner==="player"?"opponent":"player"};l=ct(T.card,Y,l,K,V).newState}}l=Ke(l),c=!l.actionRequired&&(!l.queuedActions||l.queuedActions.length===0);break}case"select_opponent_card_to_return":{const{sourceCardId:F,actor:L}=a.actionRequired,U=Nd(a,n);let Q=U.newState;if(Q.actionRequired){const X={type:"flip_self",sourceCardId:F,actor:L};Q.queuedActions=[X,...Q.queuedActions||[]],l=Q,c=!1}else{const X=_e(Q,F);if(X){const V=`${X.card.protocol}-${X.card.value}`;Q=ae(Q,L,`${V}: Flips itself.`),Q=Wo(new Set([F]),Q),Q.animationState={type:"flipCard",cardId:F}}l=Q,c=!0}U.animationRequests&&(i={animationRequests:U.animationRequests,onCompleteCallback:(X,V)=>X.actionRequired?X:V(X)}),l=Ke(l),c||(c=!l.actionRequired&&(!l.queuedActions||l.queuedActions.length===0));break}case"select_any_card_to_flip":{const F=_e(a,n),{count:L,sourceCardId:U,actor:Q}=a.actionRequired,X=_e(a,U);if(!X||!X.card.isFaceUp){const E=X?`${X.card.protocol}-${X.card.value}`:"a card";l=ae(a,Q,`Effect from ${E} was cancelled because the source is no longer active.`),l=Ke(l),l.actionRequired=null,c=!0;break}let V=null;L>1&&(V={type:"select_any_card_to_flip",count:L-1,sourceCardId:U,actor:Q});let $=kd(a,n,V);if(F&&!F.card.isFaceUp){const E=Rd($,n),A=E.newState.actionRequired;A&&A!==V&&V&&(E.newState.queuedActions=[...E.newState.queuedActions||[],V]),l=E.newState,E.animationRequests&&(i={animationRequests:E.animationRequests,onCompleteCallback:(O,I)=>O.actionRequired||O.queuedActions&&O.queuedActions.length>0?O:I(O)})}else l=$;l=Ke(l),c=!l.actionRequired&&(!l.queuedActions||l.queuedActions.length===0);break}case"select_board_card_to_reveal_custom":{const{sourceCardId:F,actor:L,followUpAction:U,optional:Q}=a.actionRequired,X=L.charAt(0).toUpperCase()+L.slice(1),V=_e(a,n);if(!V)return{nextState:a,requiresTurnEnd:!0};const $=V.owner,E=a[$].lanes.findIndex(q=>q.some(Y=>Y.id===n));if(E===-1)return{nextState:a,requiresTurnEnd:!0};const A=[...a[$].lanes[E]],O=A.findIndex(q=>q.id===n);if(O===-1)return{nextState:a,requiresTurnEnd:!0};A[O]={...A[O],isFaceUp:!0};const I=[...a[$].lanes];I[E]=A,l={...a,[$]:{...a[$],lanes:I}};const T=`${A[O].protocol}-${A[O].value}`;l=ae(l,L,`${X} reveals ${T}.`),l.actionRequired={type:"prompt_shift_or_flip_board_card_custom",sourceCardId:F,revealedCardId:n,followUpAction:U,optional:Q!==!1,actor:L},c=!1;break}case"select_phase_effect":{const F=a.actionRequired;if(!F.availableEffects.find(Q=>Q.cardId===n))return console.warn(`[cardResolver] Invalid phase effect selection: ${n} not in available effects`),{nextState:a};const U=F.phase==="Start"?"_selectedStartEffectId":"_selectedEndEffectId";l[U]=n,l.actionRequired=null,c=!1;break}default:return{nextState:a,requiresTurnEnd:!0}}if(!i&&l.actionRequired===null){if(l.queuedActions&&l.queuedActions.length>0){const F=[...l.queuedActions],L=F.shift();if((L==null?void 0:L.type)==="execute_remaining_custom_effects")return{nextState:{...Ke(l),actionRequired:null,queuedActions:[L,...F]},requiresTurnEnd:!1};if((L==null?void 0:L.type)==="shift_flipped_card_optional"||(L==null?void 0:L.type)==="gravity_2_shift_after_flip"){const U=_e(l,L.sourceCardId),Q=vo(l,L.sourceCardId);if(!U||!U.card.isFaceUp||!Q){const X=U?`${U.card.protocol}-${U.card.value}`:"the source card",V=ae(l,L.actor,`Shift from ${X} was cancelled because the source is no longer active.`);if(F.length>0){const $=F.shift();return($==null?void 0:$.type)==="execute_remaining_custom_effects"?{nextState:{...V,queuedActions:[$,...F]},requiresTurnEnd:!1}:{nextState:{...V,actionRequired:$,queuedActions:F},requiresTurnEnd:!1}}else return{nextState:{...V,actionRequired:null,queuedActions:[]},requiresTurnEnd:!0}}}return(L==null?void 0:L.type)==="execute_remaining_custom_effects"?{nextState:{...l,queuedActions:[L,...F]},requiresTurnEnd:!1}:{nextState:{...l,actionRequired:L,queuedActions:F},requiresTurnEnd:!1}}}else!i&&l.actionRequired!==null&&(c=!1);return{nextState:l,requiresAnimation:i,requiresTurnEnd:c}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const fc=(a,n,l,c,i,d=i)=>{const u={...a[i]},h=u.hand.find(A=>A.id===n);if(!h)return{newState:a};if(d===i){const A=La(a,i,l,c,h.protocol,h);if(!A.allowed)return console.error(`Illegal Move: ${i} tried to play ${h.protocol}-${h.value} - ${A.reason}`),{newState:a}}const f=i==="player"?"opponent":"player",y=a[d==="player"?"opponent":"player"].lanes[l],v=y.length>0?y[y.length-1]:null;if(v&&v.isFaceUp&&v.protocol==="Plague"&&v.value===0)return{newState:a};if(!c&&v&&v.isFaceUp&&v.protocol==="Metal"&&v.value===2)return console.error(`Illegal Move: ${i} tried to play face-down against Metal-2 in lane ${l}`),{newState:a};if(c){const A=a[d].protocols[l],O=u.protocols[l],I=a[f].protocols[l],T=a[f].lanes.flat().some(H=>H.isFaceUp&&H.protocol==="Psychic"&&H.value===1),q=[...a.player.lanes.flat(),...a.opponent.lanes.flat()].some(H=>H.isFaceUp&&H.protocol==="Anarchy"&&H.value===1),Y=vc(a),K=a[i].lanes.flat().some(H=>H.isFaceUp&&H.protocol==="Spirit"&&H.value===1),P=a[i].lanes.some(H=>{if(H.length===0)return!1;const B=H[H.length-1];return B.isFaceUp&&B.protocol==="Chaos"&&B.value===3}),Z=_c(a,i,l),W=Wl(a,h);let G;if(W?G=!T:d!==i?G=h.protocol===A&&!T:q||Y?G=h.protocol!==O&&h.protocol!==I&&!T:G=(h.protocol===O||h.protocol===I||K||P||Z)&&!T,!G){const H=q||Y?"Non-matching protocol required":"matching protocol required";return console.error(`Illegal Move: ${i} tried to play ${h.protocol}-${h.value} face-up in lane ${l} (${H}, protocols: player=${O}, opponent=${I})`),{newState:a}}}let _={...a,_committedCardId:n};_=Me(_,void 0),_=Ge(_,void 0),_={..._,_logIndentLevel:0};const w=i==="player"?"Player":"Opponent",b=_[d].protocols[l];let N;if(i==="opponent"&&!c)N=`${w} plays a face-down card into Protocol ${b}.`;else{const A=`${h.protocol}-${h.value}`;N=`${w} plays ${A}`,c||(N+=" face-down"),d!==i?N+=` into ${d==="player"?"Player's":"Opponent's"} Protocol ${b}.`:N+=` into Protocol ${b}.`}_=ae(_,i,N),_=Oa(_);let S={newState:_};const k=_[d].lanes[l];if(k.length>0){const A=k[k.length-1];let I=Rt(_,"on_cover",{player:d,cardId:A.id}).newState;if(I[d].lanes[l].some(Y=>Y.id===A.id)&&A.isFaceUp){const Y={cardOwner:d,actor:i,currentTurn:I.turn,opponent:d==="player"?"opponent":"player",triggerType:"cover"};S=Od(A,l,I,Y)}else S={newState:I}}const C=S.newState,j={...h,isFaceUp:c,isRevealed:!1},R={...C[i]},F={...R.stats,cardsPlayed:R.stats.cardsPlayed+1},L=i==="player"?"playerFromHand":"aiFromHand",U=i==="player"?c?"playerFaceUp":"playerFaceDown":c?"aiFaceUp":"aiFaceDown",Q=C.detailedGameStats?{...C.detailedGameStats,cardsPlayed:{...C.detailedGameStats.cardsPlayed,[L]:C.detailedGameStats.cardsPlayed[L]+1,[U]:C.detailedGameStats.cardsPlayed[U]+1}}:void 0;let X;if(d===i){const A={...R,hand:R.hand.filter(O=>O.id!==n),lanes:R.lanes.map((O,I)=>I===l?[...O,j]:O),stats:F};X={...C,[i]:A,stats:{...C.stats,[i]:F},detailedGameStats:Q}}else{const A={...R,hand:R.hand.filter(T=>T.id!==n),stats:F},O={...C[d]},I={...O,lanes:O.lanes.map((T,q)=>q===l?[...T,j]:T)};X={...C,[i]:A,[d]:I,stats:{...C.stats,[i]:F},detailedGameStats:Q}}const V=a.queuedActions||[],$=C.queuedActions||[];if($===V||$.length===V.length&&$.every((A,O)=>A===V[O])?V.length>0&&(X.queuedActions=V):X.queuedActions=[...V,...$],X.lastPlayedCardId=j.id,X=we(X),C.actionRequired||(X={...X,_logIndentLevel:0}),X=Rt(X,"after_play",{player:i,cardId:j.id,laneIndex:l}).newState,C.actionRequired)return c&&(X.queuedEffect={card:j,laneIndex:l}),{newState:X,animationRequests:S.animationRequests};{if(X={...X,_committedCardId:void 0},i==="opponent")return c&&(X.queuedEffect={card:j,laneIndex:l}),{newState:X,animationRequests:S.animationRequests};let A={newState:X};if(c&&!X.actionRequired){const I={cardOwner:d,actor:i,currentTurn:X.turn,opponent:d==="player"?"opponent":"player",triggerType:"play"};A=Zl(j,l,X,I)}const O=[...S.animationRequests||[],...A.animationRequests||[]];return{newState:A.newState,animationRequests:O.length>0?O:void 0}}},Xl=(a,n)=>{let l=Me(a,void 0);return l=Ge(l,void 0),l={...l,_logIndentLevel:0},y0(l,n)},om=(a,n)=>{if(a.useControlMechanic&&a.controlCardHolder===n){let l=ae(a,n,`${n==="player"?"Player":"Opponent"} has Control and may rearrange protocols before refreshing.`);return l=Oa(l),{...l,controlCardHolder:null,actionRequired:{type:"prompt_use_control_mechanic",sourceCardId:"CONTROL_MECHANIC",actor:n,originalAction:{type:"fill_hand"}}}}return Xl(a,n)};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Td=(a,n)=>{var i,d,u,h,f,m,y,v,_,w,b,N,S,k,C;if(!a.actionRequired)return{nextState:a};let l={...a},c=null;switch(a.actionRequired.type){case"select_lane_for_shift_all":{const{cardsToShift:j,validDestinationLanes:R,sourceLaneIndex:F,actor:L,sourceCardId:U}=a.actionRequired;if(!R.includes(n))return console.error(`Illegal shift: Lane ${n} is not a valid destination`),{nextState:a};if(n===F)return console.error(`Illegal shift: Cannot shift to the same lane ${F}`),{nextState:a};let Q={...a};const X=[];for(const{cardId:V,owner:$}of j){if(!_e(Q,V))continue;const A=Q[$].lanes.findIndex(T=>T.some(q=>q.id===V));if(A===-1||!Ql(Q,A,n).allowed)continue;const I=go(Q,V,$,n,L);Q=I.newState,I.animationRequests&&X.push(...I.animationRequests)}if(l=Q,l=Ke(l),(!l.actionRequired||l.actionRequired.type==="select_lane_for_shift_all")&&(l.actionRequired=null),X.length>0){const V=(i=a.actionRequired)==null?void 0:i.followUpEffect,$=(d=a.actionRequired)==null?void 0:d.conditionalType;c={animationRequests:X,onCompleteCallback:(E,A)=>{if(E.actionRequired||E.queuedActions&&E.queuedActions.length>0)return E;let O=E;if(V&&U&&($!=="if_executed"||X.length>0)){const T=_e(O,U);if(T&&T.card.isFaceUp){const q=O[T.owner].lanes.find(Z=>Z.some(W=>W.id===U)),Y=O[T.owner].lanes.indexOf(q),K={cardOwner:T.owner,actor:L,currentTurn:O.turn,opponent:T.owner==="player"?"opponent":"player"};if(O=ct(T.card,Y,O,K,V).newState,O.actionRequired)return O}}return A(O)}}}break}case"select_lane_for_shift":{const{cardToShiftId:j,cardOwner:R,actor:F,sourceEffect:L,originalLaneIndex:U,sourceCardId:Q}=a.actionRequired;if(n===U)return console.error(`Illegal shift: Cannot shift to the same lane ${U}`),{nextState:a};const X=a.actionRequired.validLanes;if(X&&!X.includes(n))return console.error(`Illegal shift: Lane ${n} not in valid lanes ${X}`),{nextState:a};const V=_e(a,Q),$=_e(a,j);if(V&&V.card.protocol==="Anarchy"&&V.card.value===1&&$&&$.card.isFaceUp){const I=a.player.protocols[n],T=a.opponent.protocols[n],q=$.card.protocol;if(q===I||q===T)return console.error(`Illegal Anarchy-1 shift: ${q}-${$.card.value} cannot be shifted to lane ${n} (protocols: ${I}/${T}) - matching protocol not allowed`),{nextState:a}}if(V&&V.card.protocol==="Gravity"&&V.card.value===1){let I=-1;for(let T=0;T<a[V.owner].lanes.length;T++)if(a[V.owner].lanes[T].some(q=>q.id===Q)){I=T;break}if(I!==-1&&!(U===I)&&!(n===I))return console.error(`Illegal Gravity-1 shift: Must shift to or from Gravity lane ${I}, but tried ${U}  ${n}`),{nextState:a}}if(a.actionRequired.destinationRestriction&&$){const I=a.actionRequired.destinationRestriction;if(I.type==="non_matching_protocol"&&$.card.isFaceUp){const T=a.player.protocols[n],q=a.opponent.protocols[n],Y=$.card.protocol;if(Y===T||Y===q)return console.error(`Illegal shift: ${Y} cannot be shifted to lane ${n} (protocols: ${T}/${q}) - matching protocol not allowed`),{nextState:a}}if(I.type==="to_or_from_this_lane"){const T=I.laneIndex==="current"&&V?(()=>{for(let q=0;q<a[V.owner].lanes.length;q++)if(a[V.owner].lanes[q].some(Y=>Y.id===Q))return q;return-1})():I.laneIndex;if(T!==void 0&&T!==-1&&!(U===T)&&!(n===T))return console.error(`Illegal shift: Must shift to or from lane ${T}, but tried ${U}  ${n}`),{nextState:a}}}const E=Ql(a,U,n);if(!E.allowed)return console.error(`Illegal shift: Cannot shift from lane ${U} to ${n} - ${E.reason}`),{nextState:a};const A=go(a,j,R,n,F);l=A.newState;const O=l.actionRequired!==null;if(A.animationRequests)c={animationRequests:A.animationRequests,onCompleteCallback:(I,T)=>{var W,G,H,B;let q=I;if(O){if(L==="speed_3_end"){const fe={type:"speed_3_self_flip_after_shift",sourceCardId:a.actionRequired.sourceCardId,actor:F};q.queuedActions=[...q.queuedActions||[],fe]}const ee=(W=a.actionRequired)==null?void 0:W.followUpEffect,de=(G=a.actionRequired)==null?void 0:G.conditionalType;if(ee&&Q&&(de!=="if_executed"||j)){const fe=_e(q,Q),ye=a._currentPhaseContext||(a.phase==="start"?"start":"end"),ke={type:"execute_follow_up_effect",sourceCardId:Q,followUpEffect:ee,actor:F,logContext:{indentLevel:1,sourceCardName:fe?`${fe.card.protocol}-${fe.card.value}`:void 0,phase:ye}};q.queuedActions=[...q.queuedActions||[],ke]}_e(q,Q);const J=q._pendingCustomEffects;if(J){const pe=_e(q,J.sourceCardId);if(pe&&pe.card.isFaceUp){const fe=q[pe.owner].lanes.find(ke=>ke.some(Ve=>Ve.id===J.sourceCardId));if(fe&&fe.length>0&&fe[fe.length-1].id===J.sourceCardId){const ke={type:"execute_remaining_custom_effects",sourceCardId:J.sourceCardId,laneIndex:J.laneIndex,effects:J.effects,context:J.context,actor:F,logSource:J.logSource,logPhase:J.logPhase,logIndentLevel:J.logIndentLevel};q.queuedActions=[ke,...q.queuedActions||[]]}}delete q._pendingCustomEffects}return q}if(L==="speed_3_end"){const ee=a.actionRequired.sourceCardId;q=ae(q,F,"Speed-3: Flipping itself after shifting a card."),q=Wo(new Set([ee]),q),q.animationState={type:"flipCard",cardId:ee}}const Y=q._pendingCustomEffects;if(Y){const ee=_e(q,Y.sourceCardId);if(ee&&ee.card.isFaceUp){const de=q[ee.owner].lanes.find(pe=>pe.some(fe=>fe.id===Y.sourceCardId));if(de&&de.length>0&&de[de.length-1].id===Y.sourceCardId){for(const pe of Y.effects)q=ct(ee.card,Y.laneIndex,q,Y.context,pe).newState;delete q._pendingCustomEffects}else q=ae(q,F,"Pending effects cancelled because source card is now covered."),delete q._pendingCustomEffects}else delete q._pendingCustomEffects}Q&&(q=_o(q)),q=Rt(q,"after_shift",{player:F,cardId:j}).newState;const P=(H=a.actionRequired)==null?void 0:H.followUpEffect,Z=(B=a.actionRequired)==null?void 0:B.conditionalType;if(P&&Q&&(Z!=="if_executed"||j)){const de=_e(q,Q);if(de&&de.card.isFaceUp){const J=q[de.owner].lanes.find(Le=>Le.some(at=>at.id===Q)),pe=q[de.owner].lanes.indexOf(J),fe={cardOwner:de.owner,actor:F,currentTurn:q.turn,opponent:de.owner==="player"?"opponent":"player"},ye=`${de.card.protocol}-${de.card.value}`,ke=a._currentPhaseContext||(a.phase==="start"?"start":"end");q={...q,_logIndentLevel:1,_currentEffectSource:ye,_currentPhaseContext:ke},q=ct(de.card,pe,q,fe,P).newState}}if(q=Ke(q),q.actionRequired=null,q.queuedActions&&q.queuedActions.length>0){const ee=q.queuedActions[0];ee.type==="execute_remaining_custom_effects"?(q=ya(q),q.animationState&&(q={...q,animationState:null})):(q.queuedActions=q.queuedActions.slice(1),q.actionRequired=ee)}return q._interruptedTurn?Hr(q):T(q)}};else if(O){if(L==="speed_3_end"){const Y={type:"speed_3_self_flip_after_shift",sourceCardId:a.actionRequired.sourceCardId,actor:F};l.queuedActions=[...l.queuedActions||[],Y]}const I=(u=a.actionRequired)==null?void 0:u.followUpEffect,T=(h=a.actionRequired)==null?void 0:h.conditionalType;if(I&&Q&&(T!=="if_executed"||j)){const Y=_e(l,Q),K=a._currentPhaseContext||(a.phase==="start"?"start":"end"),P={type:"execute_follow_up_effect",sourceCardId:Q,followUpEffect:I,actor:F,logContext:{indentLevel:1,sourceCardName:Y?`${Y.card.protocol}-${Y.card.value}`:void 0,phase:K}};l.queuedActions=[...l.queuedActions||[],P]}}else{if(L==="speed_3_end"){const K=a.actionRequired.sourceCardId;l=ae(l,F,"Speed-3: Flipping itself after shifting a card."),l=Wo(new Set([K]),l),l.animationState={type:"flipCard",cardId:K}}const I=l._pendingCustomEffects;if(I){const K=_e(l,I.sourceCardId);if(K&&K.card.isFaceUp){const P=l[K.owner].lanes.find(W=>W.some(G=>G.id===I.sourceCardId));if(P&&P.length>0&&P[P.length-1].id===I.sourceCardId){for(const W of I.effects)l=ct(K.card,I.laneIndex,l,I.context,W).newState;delete l._pendingCustomEffects}else l=ae(l,F,"Pending effects cancelled because source card is now covered."),delete l._pendingCustomEffects}else delete l._pendingCustomEffects}Q&&(l=_o(l)),l=Rt(l,"after_shift",{player:F,cardId:j}).newState;const q=(f=a.actionRequired)==null?void 0:f.followUpEffect,Y=(m=a.actionRequired)==null?void 0:m.conditionalType;if(q&&Q&&(Y!=="if_executed"||j)){const P=_e(l,Q);if(P&&P.card.isFaceUp){const Z=l[P.owner].lanes.find(de=>de.some(J=>J.id===Q)),W=l[P.owner].lanes.indexOf(Z),G={cardOwner:P.owner,actor:F,currentTurn:l.turn,opponent:P.owner==="player"?"opponent":"player"},H=`${P.card.protocol}-${P.card.value}`,B=a._currentPhaseContext||(a.phase==="start"?"start":"end");l={...l,_logIndentLevel:1,_currentEffectSource:H,_currentPhaseContext:B},l=ct(P.card,W,l,G,q).newState}}if(l=Ke(l),l.actionRequired=null,l.queuedActions&&l.queuedActions.length>0){const K=l.queuedActions[0];if(K.type==="execute_remaining_custom_effects"){if(l=ya(l),l.animationState&&!l.actionRequired){const P=l.animationState;P.type==="draw"&&(c={animationRequests:[{type:"draw",player:P.player,count:P.count}],onCompleteCallback:(Z,W)=>{const G={...Z,animationState:null};return W(G)}},l={...l,animationState:null})}}else l.queuedActions=l.queuedActions.slice(1),l.actionRequired=K}}break}case"shift_flipped_card_optional":{const j=a.actionRequired.cardId,R=a.actionRequired.actor;let F=null;for(const V of["player","opponent"])if(a[V].lanes.flat().some($=>$.id===j)){F=V;break}if(!F){console.error("[shift_flipped_card_optional] Card not found on board:",j),l=a;break}const L=(y=a.actionRequired)==null?void 0:y.followUpEffect,U=(v=a.actionRequired)==null?void 0:v.conditionalType,Q=(_=a.actionRequired)==null?void 0:_.sourceCardId,X=go(a,j,F,n,R);if(l=X.newState,L&&Q&&(U!=="if_executed"||j)){const $=_e(l,Q),E=a._currentPhaseContext||(a.phase==="start"?"start":"end"),A={type:"execute_follow_up_effect",sourceCardId:Q,followUpEffect:L,actor:R,logContext:{indentLevel:1,sourceCardName:$?`${$.card.protocol}-${$.card.value}`:void 0,phase:E}};l={...l,queuedActions:[...l.queuedActions||[],A]}}X.animationRequests&&(c={animationRequests:X.animationRequests,onCompleteCallback:(V,$)=>$(V)});break}case"select_lane_for_play":{const{cardInHandId:j,isFaceDown:R,actor:F,source:L,disallowedLaneIndex:U,validLanes:Q,preSelectedLane:X}=a.actionRequired,V=X!==void 0?X:n;if(U!==void 0&&V===U)return{nextState:a,requiresTurnEnd:!1};if(Q&&!Q.includes(V))return{nextState:a,requiresTurnEnd:!1};if(L==="deck"){const T={...a,actionRequired:null},q=T[F],{drawnCards:Y,remainingDeck:K,newDiscard:P}=Hn(q.deck,q.discard,1);if(Y.length===0){console.error("No cards in deck/discard to play"),l=T;break}const Z={...Y[0],id:Xe(),isFaceUp:!R},W=[...q.lanes];W[V]=[...W[V],Z];const G={...q,lanes:W,deck:K,discard:P};l={...T,[F]:G},c={animationRequests:[{type:"play",cardId:Z.id,owner:F,laneIndex:V,isFaceUp:Z.isFaceUp}],onCompleteCallback:(H,B)=>B(H)};break}const $=a[F].hand.find(T=>T.id===j);if(!$){console.error("Card for play not found in hand"),l={...a,actionRequired:null};break}const E={...a,actionRequired:null};let A;if(typeof R=="boolean")A=!R;else{const T=a[F].lanes.flat().some(P=>P.isFaceUp&&P.protocol==="Spirit"&&P.value===1),q=a[F].lanes.some(P=>{if(P.length===0)return!1;const Z=P[P.length-1];return Z.isFaceUp&&Z.protocol==="Chaos"&&Z.value===3}),Y=F==="player"?"opponent":"player",K=a[Y].lanes.flat().some(P=>P.isFaceUp&&P.protocol==="Psychic"&&P.value===1);A=(T||q||$.protocol===a[F].protocols[V]||$.protocol===a[Y].protocols[V])&&!K}const{newState:O,animationRequests:I}=fc(E,j,V,A,F);l=O,I&&(c={animationRequests:I,onCompleteCallback:(T,q)=>(T.queuedActions&&T.queuedActions.length>0,q(T))});break}case"select_lane_for_delete":{const j=a.actionRequired.actor,R=j==="player"?"Player":"Opponent",F=a.player.protocols[n],L=a.actionRequired.targetFilter||{},U=_e(a,a.actionRequired.sourceCardId),Q=U?`${U.card.protocol}-${U.card.value}`:"a card effect",X=a.actionRequired.count||1,V=a.actionRequired.deleteAll===!0,$=a.actionRequired.validLanes;if($&&!$.includes(n))return console.error(`Illegal delete lane selection: Lane ${n} not in valid lanes ${$}`),{nextState:a};l=ae(l,j,`${Q}: ${R} targets Protocol ${F}.`);const E=new Map;for(const T of["player","opponent"]){const q=a[T].lanes[n];E.set(T,q.length>0?q[q.length-1].id:null)}const A=[],O=[],I=new Set;for(const T of["player","opponent"]){const q=a[T],Y=q.lanes[n].some(P=>P.isFaceUp&&P.protocol==="Darkness"&&P.value===2)?4:2,K=q.lanes[n];for(let P=0;P<K.length;P++){const Z=K[P],W=P===K.length-1,G=Z.isFaceUp?Z.value:Y;if(L.valueRange){const{min:ee,max:de}=L.valueRange;if(G<ee||G>de)continue}if(L.faceState==="face_up"&&!Z.isFaceUp||L.faceState==="face_down"&&Z.isFaceUp||L.owner==="own"&&T!==j||L.owner==="opponent"&&T===j||L.position==="uncovered"&&!W||L.position==="covered"&&W)continue;A.push({type:"delete",cardId:Z.id,owner:T}),I.add(Z.id);const H=T==="player"?"Player's":"Opponent's",B=Z.isFaceUp?`${Z.protocol}-${Z.value}`:"a face-down card";if(O.push(`${H} ${B}`),!V&&A.length>=X)break}if(!V&&A.length>=X)break}if(O.length>0){l=ae(l,j,`${Q}: Deleting ${O.join(", ")}.`);const T={...l.stats[j],cardsDeleted:l.stats[j].cardsDeleted+O.length},q={...l[j],stats:T};l={...l,[j]:q,stats:{...l.stats,[j]:T}}}if(l=Ke(l),l.actionRequired=null,A.length>0){const T=(w=a.actionRequired)==null?void 0:w.followUpEffect,q=(b=a.actionRequired)==null?void 0:b.conditionalType,Y=a.actionRequired.sourceCardId;c={animationRequests:A,onCompleteCallback:(K,P)=>{let Z=K;Z=Rt(Z,"after_delete",{player:j}).newState;const G=[];for(const H of["player","opponent"]){const B=E.get(H),ee=Z[H].lanes[n];B&&I.has(B)&&ee.length>0&&G.push(H)}for(let H=0;H<G.length;H++){const B=G[H];if(Z=An(Z,B,n).newState,Z.actionRequired&&H<G.length-1){const de=G.slice(H+1);for(const J of de)Z.queuedActions=[...Z.queuedActions||[],{type:"pending_uncover_effect",owner:J,laneIndex:n}];return Z}}if(T&&Y&&(q!=="if_executed"||A.length>0)){const B=_e(Z,Y);if(B&&B.card.isFaceUp){const ee=Z[B.owner].lanes.find(fe=>fe.some(ye=>ye.id===Y)),de=Z[B.owner].lanes.indexOf(ee),J={cardOwner:B.owner,actor:j,currentTurn:Z.turn,opponent:B.owner==="player"?"opponent":"player"};if(Z=ct(B.card,de,Z,J,T).newState,Z.actionRequired)return Z}}return P(Z)}}}break}case"select_lane_for_return":{const j=a.actionRequired.actor,R=j==="player"?"Player":"Opponent",F=a.player.protocols[n],L=a.actionRequired.targetFilter||{},U=_e(a,a.actionRequired.sourceCardId),Q=U?`${U.card.protocol}-${U.card.value}`:"a card effect";l=ae(l,j,`${Q}: ${R} targets Protocol ${F}.`);const X=[],V=[];for(const $ of["player","opponent"]){const E=a[$],A=E.lanes[n].some(O=>O.isFaceUp&&O.protocol==="Darkness"&&O.value===2)?4:2;for(const O of E.lanes[n]){const I=O.isFaceUp?O.value:A;if(L.valueEquals!==void 0&&I!==L.valueEquals||L.faceState==="face_up"&&!O.isFaceUp||L.faceState==="face_down"&&O.isFaceUp||L.owner==="own"&&$!==j||L.owner==="opponent"&&$===j)continue;X.push({type:"return",cardId:O.id,owner:$});const T=$==="player"?"Player's":"Opponent's",q=O.isFaceUp?`${O.protocol}-${O.value}`:"a face-down card";V.push(`${T} ${q}`)}}if(X.length===0){l=ae(l,j,`${Q}: No matching cards in Protocol ${F}.`),l=Ke(l),l.actionRequired=null;break}if(V.length>0&&(l=ae(l,j,`${Q}: Returning ${V.join(", ")}.`)),l=Ke(l),l.actionRequired=null,X.length>0){const $=(N=a.actionRequired)==null?void 0:N.followUpEffect,E=(S=a.actionRequired)==null?void 0:S.conditionalType,A=a.actionRequired.sourceCardId;c={animationRequests:X,onCompleteCallback:(O,I)=>{let T=O;if($&&A&&(E!=="if_executed"||X.length>0)){const Y=_e(T,A);if(Y&&Y.card.isFaceUp){const K=T[Y.owner].lanes.find(G=>G.some(H=>H.id===A)),P=T[Y.owner].lanes.indexOf(K),Z={cardOwner:Y.owner,actor:j,currentTurn:T.turn,opponent:Y.owner==="player"?"opponent":"player"};if(T=ct(Y.card,P,T,Z,$).newState,T.actionRequired)return T}}return I(T)}}}break}case"select_lane_for_delete_all":{const j=a.actionRequired.actor,R=j==="player"?"Player":"Opponent",F=a.player.protocols[n],L=a.actionRequired.minCards||8;if(!(a.actionRequired.validLanes||[0,1,2]).includes(n)){l=ae(l,j,"Cannot select this lane for deletion.");break}const Q=a.player.lanes[n].length+a.opponent.lanes[n].length;if(Q<L){l=ae(l,j,`Cannot delete ${F} line (only ${Q} cards, need ${L}+).`),l=Ke(l),l.actionRequired=null;break}const X=_e(a,a.actionRequired.sourceCardId),V=X?`${X.card.protocol}-${X.card.value}`:"Effect";l=ae(l,j,`${V}: ${R} deletes all cards in ${F} line.`);const $=[];for(const O of["player","opponent"])for(const I of a[O].lanes[n])$.push({type:"delete",cardId:I.id,owner:O});const E={...l.stats[j],cardsDeleted:l.stats[j].cardsDeleted+$.length},A={...l[j],stats:E};if(l={...l,[j]:A,stats:{...l.stats,[j]:E}},l=Ke(l),l.actionRequired=null,$.length>0){const O=(k=a.actionRequired)==null?void 0:k.followUpEffect,I=(C=a.actionRequired)==null?void 0:C.conditionalType,T=a.actionRequired.sourceCardId;c={animationRequests:$,onCompleteCallback:(q,Y)=>{let K=q;if(K=Rt(K,"after_delete",{player:j}).newState,O&&T&&(I!=="if_executed"||$.length>0)){const W=_e(K,T);if(W&&W.card.isFaceUp){const G=K[W.owner].lanes.find(de=>de.some(J=>J.id===T)),H=K[W.owner].lanes.indexOf(G),B={cardOwner:W.owner,actor:j,currentTurn:K.turn,opponent:W.owner==="player"?"opponent":"player"};if(K=ct(W.card,H,K,B,O).newState,K.actionRequired)return K}}return Y(K)}}}break}case"select_lane_to_shift_revealed_board_card_custom":{const{revealedCardId:j,actor:R}=a.actionRequired,F=_e(a,j);if(F){const L=go(a,j,F.owner,n,R);l=L.newState,L.animationRequests&&(c={animationRequests:L.animationRequests,onCompleteCallback:(U,Q)=>U.actionRequired?U:Q(U)})}break}default:return{nextState:a}}return{nextState:we(l),requiresAnimation:c}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Ah=(a,n)=>{if(a.processedSpeed1TriggerThisTurn)return a;if(a[n].lanes.flat().some(i=>i.isFaceUp&&i.protocol==="Speed"&&i.value===1)){let i={...a};return i=Me(i,"Speed-1"),i=Ge(i,void 0),i=ae(i,n,"Triggers after clearing cache: Draw 1 card."),i=Xo(i,n,1),i.processedSpeed1TriggerThisTurn=!0,i=Me(i,void 0),i.phase="end",i}return a},Go=(a,n,l)=>{var Q,X,V,$;const c=a[l],i=new Set(n),d=c.hand.filter(E=>i.has(E.id));if(d.length===0)return a;const u=c.hand.filter(E=>!i.has(E.id)),h=[...c.discard,...d.map(({id:E,isFaceUp:A,...O})=>O)],f=((Q=a.animationState)==null?void 0:Q.type)==="discardCard"&&((X=a.animationState.originalAction)==null?void 0:X.type)==="discard"?a.animationState.originalAction:((V=a.actionRequired)==null?void 0:V.type)==="discard"?a.actionRequired:null,m={...c.stats,cardsDiscarded:c.stats.cardsDiscarded+d.length},y={...c,hand:u,discard:h,stats:m},v=f==null?void 0:f.followUpEffect,_=f==null?void 0:f.conditionalType,w=f==null?void 0:f.previousHandSize;let b={...a,[l]:y,stats:{...a.stats,[l]:m},actionRequired:v?{type:"discard_completed",followUpEffect:v,conditionalType:_,previousHandSize:w,sourceCardId:f==null?void 0:f.sourceCardId,actor:l}:null};if(f!=null&&f.sourceCardId){const E=b.player.lanes.flat().find(A=>A.id===f.sourceCardId)||b.opponent.lanes.flat().find(A=>A.id===f.sourceCardId);if(E){const A=`${E.protocol}-${E.value}`;b=Me(b,A),b=Ge(b,"middle")}else b=Me(b,void 0),b=Ge(b,void 0),b={...b,_logIndentLevel:0}}else b=Me(b,void 0),b=Ge(b,void 0);const N=l==="player"?"Player":"Opponent";let S;if(l==="player"||d.every(E=>E.isRevealed)){const E=d.map(A=>`${A.protocol}-${A.value}`).join(", ");S=`${N} discards ${E}.`}else{const E=d.length===1?"card":"cards";S=`${N} discards ${d.length} ${E}.`}b=ae(b,l,S);const k=(E,A)=>{var K;const O=a.phase==="hand_limit"&&!(A!=null&&A.sourceCardId);let I=E;return O&&(I=_o(I),I=Ah(I,l),I=Rt(I,"after_clear_cache",{player:l}).newState,((K=I.processedClearCacheTriggerIds)==null?void 0:K.length)>0&&(I.phase="end")),I=Jh(I,l,A==null?void 0:A.sourceEffect,A==null?void 0:A.sourceCardId),I=Rt(I,"after_discard",{player:l}).newState,I=Rt(I,"after_opponent_discard",{player:l==="player"?"opponent":"player"}).newState,I};if(f&&f.actor===l){const E=f.count-n.length;return E>0?(b.actionRequired={...f,count:E},b):k(b,f)}const C=a.actionRequired;if(C&&C.type==="discard"&&C.actor===l){const E=C.count-n.length;return E>0?(b.actionRequired={...C,count:E},b):k(b,C)}const j=a.phase==="hand_limit";b=Rt(b,"after_discard",{player:l}).newState;let U=Rt(b,"after_opponent_discard",{player:l==="player"?"opponent":"player"}).newState;return j&&(U=Ah(U,l),U=Rt(U,"after_clear_cache",{player:l}).newState,(($=U.processedClearCacheTriggerIds)==null?void 0:$.length)>0&&(U.phase="end")),U},C0=(a,n)=>{var u;if(((u=a.actionRequired)==null?void 0:u.type)!=="plague_2_player_discard")return a;const l=a.actionRequired.actor,c=l==="player"?"opponent":"player";let i=Go(a,n,l);const d=n.length+1;return i[c].hand.length>0?i.actionRequired={type:"discard",actor:c,count:Math.min(d,i[c].hand.length),sourceCardId:a.actionRequired.sourceCardId}:(i=Ke(i),i.actionRequired=null),i},Cd=(a,n)=>{var u;if(((u=a.actionRequired)==null?void 0:u.type)!=="plague_2_opponent_discard")return a;const l=a.actionRequired.actor,c=l==="player"?"opponent":"player";let i=Go(a,n,l);const d=n.length+1;return i[c].hand.length>0?i.actionRequired={type:"discard",actor:c,count:Math.min(d,i[c].hand.length),sourceCardId:a.actionRequired.sourceCardId}:(i=Ke(i),i.actionRequired=null),i},Th=(a,n)=>{var f,m,y;const l=((f=a.actionRequired)==null?void 0:f.type)==="discard"&&((m=a.actionRequired)==null?void 0:m.variableCount),c=((y=a.actionRequired)==null?void 0:y.type)==="select_cards_from_hand_to_discard_for_fire_4";if(!l&&!c)return a;const i=a.actionRequired.actor,d=a.actionRequired.sourceCardId;let u=Go(a,n,i);if(l&&d)return Jh(u,i,void 0,d);const h=n.length+1;return u=ae(u,i,`Fire-4: Drawing ${h} card(s).`),u=Xo(u,i,h),u},bd=(a,n)=>{var f;if(((f=a.actionRequired)==null?void 0:f.type)!=="select_cards_from_hand_to_discard_for_hate_1")return a;const{sourceCardId:l,actor:c}=a.actionRequired;let i=Go(a,n,c);const u=K_(i,[]),h=Math.min(2,u);return h>0?i.actionRequired={type:"select_cards_to_delete",count:h,sourceCardId:l,disallowedIds:[],actor:c}:(i=ae(i,c,"Hate-1: No valid targets to delete."),i=Ke(i),i.actionRequired=null),i};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Gl=(a,n,l)=>{const c=a.turn,i=c==="player"?"opponent":"player";let d={...a};if(d.compileBlockedPlayer===c&&d.compileBlockedUntilTurn>(d.turnNumber||0))return d=ae(d,c,`${c==="player"?"Player":"Opponent"} can't compile - blocked by opponent's effect.`),d;if(d.useControlMechanic&&d.controlCardHolder===c){const E=c==="player"?"Player":"Opponent";return d=Me(d,void 0),d=Ge(d,void 0),d={...d,_logIndentLevel:0},d=ae(d,c,`${E} has Control and may rearrange protocols before compiling.`),d=Oa(d),d.actionRequired={type:"prompt_use_control_mechanic",sourceCardId:"CONTROL_MECHANIC",actor:c,originalAction:{type:"compile",laneIndex:n}},d.controlCardHolder=null,d}let f={...d[c]},m={...d[i]};const y=f.compiled[n],v=[];for(const E of[c,i])d[E].lanes[n].forEach(O=>{if(O.isFaceUp){const I=O;I.customEffects&&I.customEffects.topEffects&&I.customEffects.topEffects.some(q=>q.trigger==="before_compile_delete")&&v.push({card:O,owner:E})}});for(const{card:E,owner:A}of v)d=Rt(d,"before_compile_delete",{player:A,cardId:E.id}).newState;f={...d[c]},m={...d[i]};const _=E=>{if(E.protocol==="Speed"&&E.value===2&&E.isFaceUp)return!0;const A=E;return A.customEffects&&A.customEffects.topEffects&&E.isFaceUp?A.customEffects.topEffects.some(O=>{var I,T;return O.trigger==="before_compile_delete"&&((I=O.params)==null?void 0:I.action)==="shift"&&((T=O.params)==null?void 0:T.shiftSelf)===!0}):!1},w=[],b=[],N=f.lanes[n].filter(E=>_(E)?(w.push(E),!1):!0),S=m.lanes[n].filter(E=>_(E)?(b.push(E),!1):!0),k={...f.stats,cardsDeleted:f.stats.cardsDeleted+N.length},C={...m.stats,cardsDeleted:m.stats.cardsDeleted+S.length};f.stats=k,m.stats=C,f.discard=[...f.discard,...N.map(({id:E,isFaceUp:A,...O})=>O)],m.discard=[...m.discard,...S.map(({id:E,isFaceUp:A,...O})=>O)];const j=[...f.lanes];j[n]=w,f.lanes=j;const R=[...m.lanes];R[n]=b,m.lanes=R;const F=[...f.compiled];if(F[n]=!0,f.compiled=F,d={...d,[c]:f,[i]:m,stats:{...d.stats,[c]:k,[i]:C}},d.detailedGameStats){const E=y,A=c==="player"?E?"playerRecompile":"playerFirstCompile":E?"aiRecompile":"aiFirstCompile";d={...d,detailedGameStats:{...d.detailedGameStats,compiles:{...d.detailedGameStats.compiles,[A]:d.detailedGameStats.compiles[A]+1}}}}d=Me(d,void 0),d=Ge(d,void 0),d={...d,_logIndentLevel:0};const L=c==="player"?"Player":"Opponent",U=f.protocols[n];if(d=ae(d,c,`${L} compiles Protocol ${U}!`),y&&(d=ae(d,c,`${L} draws 1 card from the opponent's deck as a re-compile reward.`),d=m0(d,c,1)),d=we(d),f.compiled.every(E=>E===!0))return d.winner=c,l(c,d),d;N.length+S.length>0&&(d=Rt(d,"after_delete",{player:c}).newState);const $=[...w,...b].map(E=>{const A=_e(d,E.id).owner,O=E.isFaceUp?`${E.protocol}-${E.value}`:"Card";return d=ae(d,A,`${O} survives compilation and must be shifted.`),{type:"select_lane_for_shift",cardToShiftId:E.id,cardOwner:A,originalLaneIndex:n,sourceCardId:E.id,actor:A}});if($.length>0){const E=$.shift();d.actionRequired=E,d.queuedActions=$,E.actor!==c&&(d._interruptedTurn=c,d._interruptedPhase=d.phase,d.turn=E.actor)}else d.actionRequired=null,d.queuedActions=[];return d},rm=(a,n)=>a,b0=(a,n)=>{var w;if(((w=a.actionRequired)==null?void 0:w.type)!=="select_card_from_hand_to_play")return a;const{disallowedLaneIndex:l,sourceCardId:c,isFaceDown:i,actor:d,destinationRule:u,condition:h,faceDown:f,targetLaneIndex:m,validLanes:y,selectableCardIds:v,valueFilter:_}=a.actionRequired;return v&&!v.includes(n)?a:m!==void 0?{...a,actionRequired:{type:"select_lane_for_play",cardInHandId:n,sourceCardId:c,isFaceDown:i||f,actor:d,source:"hand",preSelectedLane:m}}:{...a,actionRequired:{type:"select_lane_for_play",cardInHandId:n,disallowedLaneIndex:l,sourceCardId:c,isFaceDown:i||f,actor:d,destinationRule:u,condition:h,validLanes:y}}},Dh=a=>{if(!a.actionRequired||!("optional"in a.actionRequired)||!a.actionRequired.optional)return a;const n="actor"in a.actionRequired?a.actionRequired.actor:a.turn,l=n==="player"?"Player":"Opponent";let c={...a,actionRequired:null};return c=ae(c,n,`${l} skips the optional action.`),c},Fh=a=>{var d;if(((d=a.actionRequired)==null?void 0:d.type)!=="reveal_opponent_hand")return a;const n=a.actionRequired.actor,l=n==="player"?"opponent":"player";let c={...a};const i={...c[l]};if(i.hand.length>0){i.hand=i.hand.map(f=>({...f,isRevealed:!0})),c[l]=i;const u=_e(c,a.actionRequired.sourceCardId),h=u?`${u.card.protocol}-${u.card.value}`:"A card effect";c=ae(c,n,`${h}: Opponent reveals their hand.`)}return c.actionRequired=null,c},qh=(a,n)=>kd(a,n),$h=(a,n)=>Nd(a,n).newState,lm=(a,n)=>{var v;if(((v=a.actionRequired)==null?void 0:v.type)!=="select_card_from_revealed_deck")return a;const c=a.actionRequired.actor,i=c==="player"?"Player":"Opponent";let d={...a};const u={...d[c]},h=[...u.deck],f=h.findIndex(_=>(_.id||`deck-${h.indexOf(_)}`)===n);if(f===-1)return console.warn(`[resolveSelectRevealedDeckCard] Card ${n} not found in deck`),d.actionRequired=null,d;const m=h.splice(f,1)[0],y={...m,id:m.id||`drawn-${Date.now()}`,isFaceUp:!0};return u.deck=h,u.hand=[...u.hand,y],u.deckRevealed=!1,d[c]=u,d=ae(d,c,`${i} draws ${m.protocol}-${m.value} from the revealed deck.`),d.actionRequired=null,d=Ke(d),d};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Ih=(a,n)=>{var v;if(((v=a.actionRequired)==null?void 0:v.type)!=="prompt_optional_draw")return a;const{sourceCardId:l,actor:c,count:i,drawingPlayer:d,logSource:u,logPhase:h,logIndentLevel:f}=a.actionRequired,m=c.charAt(0).toUpperCase()+c.slice(1);let y={...a};if(u!==void 0&&(y=Me(y,u)),h!==void 0&&(y=Ge(y,h)),f!==void 0&&(y._logIndentLevel=f),n){y=ae(y,c,`${m} chooses to execute the optional draw effect.`),y=Xo(y,d||c,i),y=ae(y,c,`${m} draws ${i} card${i!==1?"s":""}.`);const _=a.actionRequired.followUpEffect;if(a.actionRequired.conditionalType,_){const w=_e(y,l);if(w){const b=y[w.owner].lanes.findIndex(C=>C.some(j=>j.id===l)),N=c==="player"?"opponent":"player",S={cardOwner:c,actor:c,currentTurn:y.turn,opponent:N,triggerType:"start"};y=ct(w.card,b,y,S,_).newState,y=Ke(y)}else{const b=c==="player"?"opponent":"player";let N=0;for(let j=0;j<3;j++)if(y[c].lanes[j].length>0){N=j;break}const S={id:l,protocol:"Unknown",value:0},k={cardOwner:c,actor:c,currentTurn:y.turn,opponent:b,triggerType:"start"};y=ct(S,N,y,k,_).newState,y=Ke(y)}}else y.actionRequired=null}else y=ae(y,c,`${m} skips the draw.`),y.actionRequired=null;return y},Uh=(a,n,l)=>{var i;if(((i=a.actionRequired)==null?void 0:i.type)!=="plague_4_player_flip_optional")return a;let c={...a,actionRequired:null};if(c=Me(c,"Plague-4"),c=Ge(c,"end"),n){const{sourceCardId:d}=a.actionRequired;c=ae(c,l,`${l==="player"?"Player":"Opponent"} chooses to flip the card.`),c=Wo(new Set([d]),c),c.animationState={type:"flipCard",cardId:d}}else c=ae(c,l,`${l==="player"?"Player":"Opponent"} skips flipping the card.`);return c=Me(c,void 0),c=Ge(c,void 0),c=_o(c),c},Ph=(a,n)=>{var m,y,v;if(((m=a.actionRequired)==null?void 0:m.type)!=="prompt_optional_discard_custom")return a;const{actor:l,count:c,sourceCardId:i}=a.actionRequired,d=l.charAt(0).toUpperCase()+l.slice(1);let u={...a};const h=(y=a.actionRequired)==null?void 0:y.followUpEffect,f=(v=a.actionRequired)==null?void 0:v.conditionalType;return n?(u=ae(u,l,`${d} chooses to discard ${c} card(s).`),u.actionRequired={type:"discard",actor:l,count:c,sourceCardId:i,followUpEffect:h,conditionalType:f,previousHandSize:u[l].hand.length}):(u=ae(u,l,`${d} skips the discard.`),u.actionRequired=null),u},Dd=(a,n)=>{var m,y,v,_,w,b,N;if(((m=a.actionRequired)==null?void 0:m.type)!=="prompt_optional_effect")return a;const{actor:l,sourceCardId:c,effectDef:i,laneIndex:d,savedTargetCardId:u}=a.actionRequired,h=l.charAt(0).toUpperCase()+l.slice(1);let f={...a};if(u&&(f.lastCustomEffectTargetCardId=u),n){const S=i.params.action;f=ae(f,l,`${h} chooses to execute the optional ${S} effect.`),f.actionRequired=null;const k=[...f.player.lanes.flat(),...f.opponent.lanes.flat()].find($=>$.id===c);if(!k)return console.error("[Optional Effect] Source card not found!"),f;const C={cardOwner:l,opponent:l==="player"?"opponent":"player",currentTurn:f.turn,actor:l},j={...i,params:{...i.params,optional:!1},conditional:void 0},R=ct(k,d,f,C,j),F=!!R.newState.actionRequired,L=!!R.newState._effectSkippedNoTargets;if(L&&!F){const $={...R.newState};return delete $._effectSkippedNoTargets,$.actionRequired=null,$}if(L&&F&&delete R.newState._effectSkippedNoTargets,i.conditional&&i.conditional.type==="if_executed"&&i.conditional.thenEffect){if(R.newState.actionRequired){const A=R.newState.actionRequired.sourceCardId;if(A&&A!==c){const I={type:"execute_conditional_followup",sourceCardId:c,laneIndex:d,followUpEffect:i.conditional.thenEffect,context:C,actor:l};return{...R.newState,queuedActions:[...R.newState.queuedActions||[],I]}}return{...R.newState,actionRequired:{...R.newState.actionRequired,followUpEffect:i.conditional.thenEffect,conditionalType:"if_executed"}}}const $=i.conditional.thenEffect,E=ct(k,d,R.newState,C,$);return E.newState.actionRequired&&$.conditional&&$.conditional.thenEffect?{...E.newState,actionRequired:{...E.newState.actionRequired,followUpEffect:$.conditional.thenEffect,conditionalType:$.conditional.type}}:E.newState}const Q=(y=a.actionRequired)==null?void 0:y.followUpEffect,X=(v=a.actionRequired)==null?void 0:v.outerSourceCardId,V=(_=a.actionRequired)==null?void 0:_.outerLaneIndex;if(Q&&X){let $=R.newState;if($.actionRequired)return{...$,actionRequired:{...$.actionRequired,followUpEffect:Q,outerSourceCardId:X,outerLaneIndex:V}};const E=[...$.player.lanes.flat(),...$.opponent.lanes.flat()].find(A=>A.id===X);if(E){const A=$.player.lanes.flat().some(T=>T.id===X)?"player":"opponent",O={cardOwner:A,opponent:A==="player"?"opponent":"player",currentTurn:$.turn,actor:A};return ct(E,V||0,$,O,Q).newState}}return R.newState}else{const S=i.params.action;f=ae(f,l,`${h} skips the optional ${S} effect.`),f.actionRequired=null;const k=(w=a.actionRequired)==null?void 0:w.followUpEffect,C=(b=a.actionRequired)==null?void 0:b.outerSourceCardId,j=(N=a.actionRequired)==null?void 0:N.outerLaneIndex;if(k&&C){const R=[...f.player.lanes.flat(),...f.opponent.lanes.flat()].find(F=>F.id===C);if(R){let F=j;if(F===void 0){for(const X of["player","opponent"])for(let V=0;V<f[X].lanes.length;V++)if(f[X].lanes[V].some($=>$.id===C)){F=V;break}}const L=f.player.lanes.flat().some(X=>X.id===C)?"player":"opponent",U={cardOwner:L,opponent:L==="player"?"opponent":"player",currentTurn:f.turn,actor:L};return ct(R,F||0,f,U,k).newState}}return f}},Sd=(a,n,l)=>{var j;if(((j=a.actionRequired)==null?void 0:j.type)!=="prompt_rearrange_protocols")return a;const c=P_(a);if(!c.allowed)return console.error(`Protocol rearrangement blocked: ${c.reason}`),a;const{target:i,actor:d,originalAction:u,sourceCardId:h,disallowedProtocolForLane:f}=a.actionRequired;if(f){const{laneIndex:R,protocol:F}=f;if(n[R]===F)return console.error(`Illegal rearrange: ${F} cannot be placed on lane ${R} due to Anarchy-3 restriction`),a}let m={...a};const y={...m[i]},v={};y.protocols.forEach((R,F)=>{v[R]=y.compiled[F]});const _=n.map(R=>v[R]);y.protocols=n,y.compiled=_,m[i]=y,m.actionRequired=null;const w=m._pendingCustomEffects;if(w&&w.effects.length>0){const R={type:"execute_remaining_custom_effects",sourceCardId:w.sourceCardId,laneIndex:w.laneIndex,effects:w.effects,context:w.context,actor:d,logSource:w.logSource,logPhase:w.logPhase,logIndentLevel:w.logIndentLevel};m.queuedActions=[R,...m.queuedActions||[]],delete m._pendingCustomEffects}let b="Control Action";if(h!=="CONTROL_MECHANIC"){const R=[...m.player.lanes.flat(),...m.opponent.lanes.flat()].find(F=>F.id===h);R&&(b=`${R.protocol}-${R.value}`)}const N=d.charAt(0).toUpperCase()+d.slice(1),S=i===d?"their own":"the opponent's",k=n.join(" | ");m=ae(m,d,`${b}: ${N} rearranges ${S} protocols.`),m=ae(m,d,`New protocol order for ${i}: ${k}`);let C=we(m);if(u){if(C={...C,_logIndentLevel:0},u.type==="compile")return Gl(C,u.laneIndex,l);if(u.type==="fill_hand")return Xl(C,d);u.type==="continue_turn"?u.queuedSpeed2Actions&&u.queuedSpeed2Actions.length>0?(C=ae(C,d,"Processing remaining Speed-2 effects..."),C.queuedActions=[...u.queuedSpeed2Actions,...C.queuedActions||[]]):(C=ae(C,d,"Turn ends after compile."),C.phase="hand_limit"):u.type==="resume_interrupted_turn"&&(C=ae(C,d,"Resuming interrupted turn..."),C._interruptedTurn=u.interruptedTurn,C._interruptedPhase=u.interruptedPhase,u.queuedSpeed2Actions&&u.queuedSpeed2Actions.length>0&&(C.queuedActions=[...u.queuedSpeed2Actions,...C.queuedActions||[]]))}return C},Lh=(a,n,l)=>{var C;if(((C=a.actionRequired)==null?void 0:C.type)!=="prompt_swap_protocols")return a;const{actor:c,target:i,originalAction:d,sourceCardId:u}=a.actionRequired,h={...a[i]},[f,m]=n.sort((j,R)=>j-R),y=[...h.protocols],v=[...h.compiled];[y[f],y[m]]=[y[m],y[f]],[v[f],v[m]]=[v[m],v[f]],h.protocols=y,h.compiled=v;let _={...a,[i]:h,actionRequired:null};const w=_._pendingCustomEffects;if(w&&w.effects.length>0){const j={type:"execute_remaining_custom_effects",sourceCardId:w.sourceCardId,laneIndex:w.laneIndex,effects:w.effects,context:w.context,actor:c,logSource:w.logSource,logPhase:w.logPhase,logIndentLevel:w.logIndentLevel};_.queuedActions=[j,..._.queuedActions||[]],delete _._pendingCustomEffects}const b=c.charAt(0).toUpperCase()+c.slice(1),N=i.charAt(0).toUpperCase()+i.slice(1);_=ae(_,c,`${u==="CONTROL_MECHANIC"?"Control":"Spirit-4"}: ${b} swaps ${N}'s protocols ${y[m]} and ${y[f]}.`),u==="CONTROL_MECHANIC"&&(_.controlCardHolder=null);let k=we(_);if(d){if(d.type==="compile")return k=ae(k,c,"Resuming Compile action..."),Gl(k,d.laneIndex,l);if(d.type==="fill_hand")return k=ae(k,c,"Resuming Refresh action..."),Xl(k,c)}return k},Fd=(a,n)=>{var _;if(((_=a.actionRequired)==null?void 0:_.type)!=="prompt_shift_or_flip_board_card_custom")return a;const{actor:l,sourceCardId:c,revealedCardId:i,followUpAction:d,optional:u}=a.actionRequired,h=l.charAt(0).toUpperCase()+l.slice(1),f=_e(a,i);if(!f)return a;if(d&&n!=="skip"&&n!==d)return console.error(`Invalid choice: ${n}, followUpAction restricts to: ${d}`),a;const m=f.owner,y=a[m].lanes.findIndex(w=>w.some(b=>b.id===i));if(y===-1)return a;let v={...a};switch(n){case"shift":{const w=[...v[m].lanes[y]],b=w.findIndex(N=>N.id===i);if(b!==-1){w[b]={...w[b],isFaceUp:!1};const N=[...v[m].lanes];N[y]=w,v={...v,[m]:{...v[m],lanes:N}}}v=ae(v,l,`${h} chooses to shift the revealed card (face-down).`),v.actionRequired={type:"select_lane_to_shift_revealed_board_card_custom",sourceCardId:c,revealedCardId:i,actor:l};break}case"flip":{v=ae(v,l,`${h} chooses to flip the revealed card face-up permanently.`);const w={...v,actionRequired:null};v=Rd(w,i).newState;break}case"skip":{const w=[...v[m].lanes[y]],b=w.findIndex(N=>N.id===i);if(b!==-1){w[b]={...w[b],isFaceUp:!1};const N=[...v[m].lanes];N[y]=w,v={...v,[m]:{...v[m],lanes:N}}}v=ae(v,l,`${h} chooses to do nothing with the revealed card.`),v.actionRequired=null;break}}return v};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Ed=(a,n)=>{if(!a.actionRequired)return a;const{actionRequired:l}=a,c=l.actor,i=c==="player"?"opponent":"player";switch(l.type){case"select_card_from_hand_to_give":{const d=a[c].hand.find(w=>w.id===n);if(!d)return a;let u={...a};const h={...u[c]},f={...u[i]};h.hand=h.hand.filter(w=>w.id!==n),f.hand=[...f.hand,d],u={...u,[c]:h,[i]:f};const m=c==="player"?"Player":"Opponent",y=`${d.protocol}-${d.value}`;u=ae(u,c,`${m} gives ${y} to the opponent.`),l.sourceEffect==="love_1_end"&&(u=ae(u,c,`Love-1: ${m} draws 2 cards.`),u=Xo(u,c,2));const v=l.followUpEffect,_=l.conditionalType;if(v&&_==="if_executed"){const w=_e(u,l.sourceCardId);if(w){const{card:b,laneIndex:N}=w,S={cardOwner:c,actor:c,currentTurn:u.turn,opponent:i,triggerType:"play"};u=ct(b,N,u,S,v).newState}}return u.actionRequired=null,u}case"select_card_from_hand_to_reveal":{const d=a[c].hand.find(_=>_.id===n);if(!d)return a;let u={...a};const h={...u[c]},f=h.hand.map(_=>_.id===n?{..._,isRevealed:!0}:_);h.hand=f,u={...u,[c]:h};const m=c==="player"?"Player":"Opponent",y=`${d.protocol}-${d.value}`;u=ae(u,c,`${m} reveals ${y} from their hand.`);const v=u._pendingCustomEffects;if(v&&v.effects.length>0){const _=_e(u,v.sourceCardId);if(_){const{card:w}=_,b=v.effects[0],N=v.effects.slice(1),S={cardOwner:c,actor:c,currentTurn:u.turn,opponent:i,triggerType:"play"};return u=ct(w,v.laneIndex,u,S,b).newState,N.length>0?u._pendingCustomEffects={...v,effects:N}:delete u._pendingCustomEffects,u}}return u.actionRequired={type:"select_any_card_to_flip",count:1,sourceCardId:l.sourceCardId,actor:c},u}default:return a}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const qd=(a,n)=>{var w;if(((w=a.actionRequired)==null?void 0:w.type)!=="custom_choice")return a;const{options:l,sourceCardId:c,actor:i,laneIndex:d}=a.actionRequired;if(n<0||n>=l.length)return console.error(`[Choice Resolver] Invalid option index: ${n}`),a;const u=l[n],h=_e(a,c);if(!h){console.error(`[Choice Resolver] Source card ${c} not found`);let b={...a};return b.actionRequired=null,b}const f=i==="player"?"opponent":"player",m={cardOwner:i,actor:i,currentTurn:a.turn,opponent:f};let y={...a,actionRequired:null};const v=ct(h.card,d,y,m,u);return we(v.newState)};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Control Mechanic Logic for AI
 *
 * CRITICAL: When evaluating rearrangements during a compile action,
 * the lane being compiled will have its value RESET TO 0 after the compile.
 * This must be considered when determining beneficial swaps!
 */function hc(a,n){const l=[...a];return n!==null&&n>=0&&n<3&&(l[n]=0),l}function S0(a,n=null){const l=a.player,c=[],i=[];for(let u=0;u<3;u++)l.compiled[u]?c.push(u):i.push(u);if(c.length===0||i.length===0)return!1;const d=hc(l.laneValues,n);for(const u of c)for(const h of i)if(d[h]-d[u]>0)return!0;return!1}function Oh(a,n=null){const l=a.opponent,c=[],i=[];for(let u=0;u<3;u++)l.compiled[u]?c.push(u):i.push(u);if(c.length===0||i.length===0)return!1;const d=hc(l.laneValues,n);for(const u of c)for(const h of i){const m=10-d[u];if(m>=0&&m<=3){const v=10-d[h];if(m<v)return!0}}return!1}function sm(a,n){if(!n||n.type!=="prompt_rearrange_protocols")return{type:"rearrangeProtocols",newOrder:[...a.opponent.protocols]};const l=n.target,c=n.disallowedProtocolForLane;let i=null;n.originalAction&&n.originalAction.type==="compile"&&(i=n.originalAction.laneIndex);const d=w=>{if(!c)return!0;const{laneIndex:b,protocol:N}=c;return w[b]!==N},u=a.opponent,h=a.player,f=hc(u.laneValues,i),m=hc(h.laneValues,i),y=u.compiled.filter(w=>w).length;if(h.compiled.filter(w=>w).length===2&&y===2){const w=h.compiled.findIndex(k=>!k),b=u.compiled.findIndex(k=>!k),N=m[w],S=f[b];if(N>S&&l==="player"){let k=-1,C=1/0;for(let j=0;j<3;j++)h.compiled[j]&&m[j]<C&&(C=m[j],k=j);if(k!==-1&&C<=N){const j=[...h.protocols];if([j[w],j[k]]=[j[k],j[w]],d(j))return{type:"rearrangeProtocols",newOrder:j}}return Vo(h.protocols,d)}if(N<=S&&l==="opponent"){let k=-1,C=-1;for(let j=0;j<3;j++)u.compiled[j]&&f[j]>C&&(C=f[j],k=j);if(k!==-1&&C>S&&C>0){const j=[...u.protocols];if([j[b],j[k]]=[j[k],j[b]],d(j))return{type:"rearrangeProtocols",newOrder:j}}return Vo(u.protocols,d)}}if(l==="player"){const w=[],b=[];for(let C=0;C<3;C++)h.compiled[C]?w.push(C):b.push(C);if(w.length===0||b.length===0){if(n.sourceCardId!=="CONTROL_MECHANIC")for(let j=0;j<3;j++)for(let R=j+1;R<3;R++){const F=[...h.protocols];if([F[j],F[R]]=[F[R],F[j]],d(F))return{type:"rearrangeProtocols",newOrder:F}}return Vo(h.protocols,d)}let N=null;for(const C of b)if(m[C]>=10&&m[C]>f[C]){for(const R of w){N={compiledIdx:R,uncompiledIdx:C};break}if(N)break}if(N){const C=[...h.protocols];if([C[N.compiledIdx],C[N.uncompiledIdx]]=[C[N.uncompiledIdx],C[N.compiledIdx]],d(C))return{type:"rearrangeProtocols",newOrder:C}}let S=null;for(const C of w)for(const j of b){const R=m[j]-m[C];(!S||R>S.score)&&(S={compiledIdx:C,uncompiledIdx:j,score:R})}const k=n.sourceCardId!=="CONTROL_MECHANIC";if(S&&S.score>0){const C=[...h.protocols];if([C[S.compiledIdx],C[S.uncompiledIdx]]=[C[S.uncompiledIdx],C[S.compiledIdx]],d(C))return{type:"rearrangeProtocols",newOrder:C}}if(k)for(let C=0;C<3;C++)for(let j=C+1;j<3;j++){const R=[...h.protocols];if([R[C],R[j]]=[R[j],R[C]],d(R))return{type:"rearrangeProtocols",newOrder:R}}return Vo(h.protocols,d)}if(l==="opponent"){const w=[],b=[];for(let k=0;k<3;k++)u.compiled[k]?w.push(k):b.push(k);if(w.length===0||b.length===0){if(n.sourceCardId!=="CONTROL_MECHANIC")for(let C=0;C<3;C++)for(let j=C+1;j<3;j++){const R=[...u.protocols];if([R[C],R[j]]=[R[j],R[C]],d(R))return{type:"rearrangeProtocols",newOrder:R}}return Vo(u.protocols,d)}let N=null;for(const k of w)for(const C of b){const j=f[k],R=f[C],F=j-R,U=j>=10&&j>m[k]?F+100:F;(!N||U>N.score)&&(N={compiledIdx:k,uncompiledIdx:C,score:U,newUncompiledValue:j})}const S=n.sourceCardId!=="CONTROL_MECHANIC";if(N&&N.score>0){const k=[...u.protocols];if([k[N.compiledIdx],k[N.uncompiledIdx]]=[k[N.uncompiledIdx],k[N.compiledIdx]],d(k))return{type:"rearrangeProtocols",newOrder:k}}if(S)for(let k=0;k<3;k++)for(let C=k+1;C<3;C++){const j=[...u.protocols];if([j[k],j[C]]=[j[C],j[k]],d(j))return{type:"rearrangeProtocols",newOrder:j}}return Vo(u.protocols,d)}const _=l==="player"?[...h.protocols]:[...u.protocols];return Vo(_,d)}function Vo(a,n){if(n(a))return{type:"rearrangeProtocols",newOrder:[...a]};for(let l=0;l<3;l++)for(let c=l+1;c<3;c++){const i=[...a];if([i[l],i[c]]=[i[c],i[l]],n(i))return{type:"rearrangeProtocols",newOrder:i}}return console.error("[AI Rearrange] Could not find any valid arrangement - returning current order"),{type:"rearrangeProtocols",newOrder:[...a]}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function cm(a,n){return _n(a).some(({rule:c,cardOwner:i})=>c.type!=="require_face_down_play"?!1:c.target==="all"||c.target==="opponent"&&i!==n)}function Hd(a){const n=a;return n.customEffects?[...n.customEffects.topEffects||[],...n.customEffects.middleEffects||[],...n.customEffects.bottomEffects||[]].some(c=>{var u,h;const i=c.trigger;return(i==="on_cover"||i==="on_cover_or_flip")&&((u=c.params)==null?void 0:u.action)==="delete"&&((h=c.params)==null?void 0:h.deleteSelf)===!0}):!1}function E0(a,n,l){const c=a[n].lanes[l];if(c.length===0)return null;const i=c[c.length-1];return i.isFaceUp&&Hd(i)?i.value:null}function im(a){const n=a;return n.customEffects?[...n.customEffects.topEffects||[],...n.customEffects.middleEffects||[],...n.customEffects.bottomEffects||[]].some(c=>{var i;return c.params.action==="return"&&((i=c.params.targetFilter)==null?void 0:i.owner)==="own"}):!1}function dm(a){const n=a;return n.customEffects?[...n.customEffects.topEffects||[],...n.customEffects.middleEffects||[],...n.customEffects.bottomEffects||[]].some(c=>{var i,d,u;return c.params.action==="delete"&&((i=c.params.targetFilter)==null?void 0:i.owner)==="own"&&(((d=c.params.targetFilter)==null?void 0:d.valueFilter)==="highest"||((u=c.params.targetFilter)==null?void 0:u.calculation)==="highest_value")}):!1}function j0(a){const n=a;if(!n.customEffects)return 0;const l=n.customEffects.topEffects||[];for(const c of l)if(c.trigger==="passive"&&c.params.action==="value_modifier"&&(c.params.condition==="per_face_down_card"||c.params.applyTo==="face_down_cards"))return c.params.modifier||0;return 0}function um(a,n){let l=0;for(const c of["player","opponent"])for(const i of a[c].lanes[n])if(i.isFaceUp){const d=j0(i);d>0&&(l=Math.max(l,d))}return l}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * EASY AI - Focused on winning, but only looks at own board
 * - Always tries to compile as fast as possible
 * - Prioritizes lanes closest to 10
 * - Doesn't consider opponent's strategy
 * - Makes simple decisions for effect choices
 *
 * FULLY GENERIC: Uses only targetFilter, scope, destinationRestriction from ActionRequired
 * NO card-specific handlers - all effects handled through parameters
 */function zl(a,n,l,c,i,d){const u=[],h=l||{},f=h.position||"uncovered";for(const m of["player","opponent"])if(!(h.owner==="own"&&m!==n)&&!(h.owner==="opponent"&&m===n))for(let y=0;y<a[m].lanes.length;y++){if((c==null?void 0:c.type)==="this_lane"&&c.laneIndex!==void 0&&y!==c.laneIndex||(c==null?void 0:c.type)==="other_lanes"&&c.laneIndex!==void 0&&y===c.laneIndex||d!==void 0&&(c==null?void 0:c.type)==="this_lane"&&y!==d)continue;const v=a[m].lanes[y];for(let _=0;_<v.length;_++){const w=v[_];if(xo(a,w.id))continue;const b=wo(a,v,_);if(!(f==="uncovered"&&!b)&&!(f==="covered"&&b)&&!(h.faceState==="face_up"&&!w.isFaceUp)&&!(h.faceState==="face_down"&&w.isFaceUp)){if(h.valueRange){const N=w.isFaceUp?w.value:2;if(N<h.valueRange.min||N>h.valueRange.max)continue}h.valueEquals!==void 0&&(w.isFaceUp?w.value:2)!==h.valueEquals||h.excludeSelf&&i&&w.id===i||u.push(w)}}}return h.calculation==="highest_value"&&u.length>0?(u.sort((m,y)=>{const v=m.isFaceUp?m.value:2;return(y.isFaceUp?y.value:2)-v}),[u[0]]):h.calculation==="lowest_value"&&u.length>0?(u.sort((m,y)=>{const v=m.isFaceUp?m.value:2,_=y.isFaceUp?y.value:2;return v-_}),[u[0]]):u}function Bo(a,n){return a.player.lanes.some(l=>l.some(c=>c.id===n))}function ho(a,n,l){return a.isFaceUp?a.value:2+0}const k0=a=>{const{opponent:n,player:l}=a;if(n.hand.length===0)return null;const c=(S,k,C)=>La(a,"opponent",S,k,C).allowed,i=cm(a,"opponent"),d=_c(a,"opponent"),u=vc(a),h=(S,k)=>i||!c(k,!0,S.protocol)?!1:u?S.protocol!==n.protocols[k]&&S.protocol!==l.protocols[k]:S.protocol===n.protocols[k]||S.protocol===l.protocols[k]||d,f=(S,k,C)=>2+um(a,C),m=n.hand.filter(S=>im(S)?n.lanes.flat().some(j=>j.protocol!==S.protocol):!0);if(m.length===0)return null;const y=S=>{if(Hd(S)){for(let k=0;k<3;k++)if(!n.compiled[k]&&n.laneValues[k]+S.value>=10)return!1;return!0}if(dm(S)){let k=0;for(let C=0;C<3;C++){const j=n.lanes[C];if(j.length>0){const R=j[j.length-1],F=R.isFaceUp?R.value:2;F>k&&(k=F)}}return S.value>=k}return!1},v=[],w=l.lanes.flat().length+n.lanes.flat().length<=3,b=l.lanes.flat().length>0,N=(S,k)=>S.keywords.flip||S.keywords.delete||S.keywords.shift||S.keywords.return?b||n.lanes.some((R,F)=>F!==k&&R.length>0)||n.lanes[k].length>0:!0;for(const S of m)for(let k=0;k<3;k++){if(n.compiled[k])continue;const C=n.laneValues[k],j=l.laneValues[k];if(h(S,k)&&!y(S)){const R=C+S.value;let F=0;R>=10&&R>j?F=1e3+R:R<10?F=100+R+S.value*5:F=50+S.value,w&&S.value<=2&&(N(S,k)?F-=50:F-=200),S.keywords.draw&&n.hand.length>=5&&(F-=30),v.push({cardId:S.id,laneIndex:k,isFaceUp:!0,score:F})}if(c(k,!1,S.protocol)){const R=f(S,!1,k),F=C+R;let L=0;F>=10&&F>j?L=900+F:F<10?L=80+F:L=30+R,v.push({cardId:S.id,laneIndex:k,isFaceUp:!1,score:L})}}if(v.length===0)return null;v.sort((S,k)=>k.score-S.score);for(const S of v){if(S.isFaceUp){const k=n.hand.find(j=>j.id===S.cardId);if(!k||!La(a,"opponent",S.laneIndex,!0,k.protocol).allowed)continue}return{cardId:S.cardId,laneIndex:S.laneIndex,isFaceUp:S.isFaceUp}}return null},N0=(a,n)=>{var l,c,i,d,u,h;switch(n.type){case"prompt_use_control_mechanic":{const{player:f}=a,m=f.compiled.some(v=>v),y=f.compiled.filter(v=>!v).length;return m&&y>0?{type:"resolveControlMechanicPrompt",choice:"player"}:{type:"resolveControlMechanicPrompt",choice:"skip"}}case"discard":{const f=[...a.opponent.hand].sort((v,_)=>v.value-_.value),m=n.variableCount?Math.min(3,f.length):n.count;return{type:"discardCards",cardIds:f.slice(0,m).map(v=>v.id)}}case"select_cards_to_delete":{const f=n.currentLaneIndex??n.laneIndex,m=n.allowedIds;let y=zl(a,n.actor,n.targetFilter,n.scope,n.sourceCardId,f);m&&(y=y.filter(N=>m.includes(N.id)));const v=n.disallowedIds||[],_=y.filter(N=>!v.includes(N.id));if(_.length===0)return{type:"skip"};const w=_.filter(N=>Bo(a,N.id)),b=_.filter(N=>!Bo(a,N.id));return w.length>0?(w.sort((N,S)=>ho(S)-ho(N)),{type:"deleteCard",cardId:w[0].id}):b.length>0?(b.sort((N,S)=>ho(N)-ho(S)),{type:"deleteCard",cardId:b[0].id}):{type:"deleteCard",cardId:_[0].id}}case"select_card_to_flip":case"select_any_card_to_flip":case"select_any_card_to_flip_optional":{const f=ma(a),m=n.currentLaneIndex??n.laneIndex,y=zl(a,n.actor,n.targetFilter,n.scope,n.sourceCardId,m);if(y.length===0)return n.optional?{type:"skip"}:{type:"skip"};const v=y.filter(b=>Bo(a,b.id)),_=y.filter(b=>!Bo(a,b.id)),w=v.filter(b=>b.isFaceUp).sort((b,N)=>N.value-b.value);if(w.length>0)return{type:"flipCard",cardId:w[0].id};if(!f){const b=v.filter(N=>!N.isFaceUp);if(b.length>0)return{type:"flipCard",cardId:b[0].id}}if(!f){const b=_.filter(N=>!N.isFaceUp);if(b.length>0)return{type:"flipCard",cardId:b[0].id}}if(!n.optional){const b=_.filter(N=>N.isFaceUp).sort((N,S)=>N.value-S.value);if(b.length>0)return{type:"flipCard",cardId:b[0].id}}return{type:"skip"}}case"select_card_to_shift":{const f=n.scope,m=f==="this_lane"?n.sourceLaneIndex??n.currentLaneIndex??n.laneIndex:void 0,y=zl(a,n.actor,n.targetFilter,f,n.sourceCardId,m);if(y.length===0)return n.optional?{type:"skip"}:{type:"skip"};const v=y.filter(_=>Bo(a,_.id));return v.length>0?{type:"shiftCard",cardId:v[0].id}:{type:"shiftCard",cardId:y[0].id}}case"select_card_to_return":{const f=n.currentLaneIndex??n.laneIndex,m=zl(a,n.actor,n.targetFilter,n.scope,n.sourceCardId,f);if(m.length===0)return n.optional?{type:"skip"}:{type:"skip"};const y=m.filter(_=>Bo(a,_.id));if(y.length>0)return y.sort((_,w)=>ho(w)-ho(_)),{type:"returnCard",cardId:y[0].id};const v=m.filter(_=>!Bo(a,_.id));return v.length>0?(v.sort((_,w)=>ho(_)-ho(w)),{type:"returnCard",cardId:v[0].id}):{type:"returnCard",cardId:m[0].id}}case"select_lane_for_shift":{let f=n.validLanes||[0,1,2];if(f=f.filter(m=>m!==n.originalLaneIndex),n.destinationRestriction){const m=n.destinationRestriction,y=n.originalLaneIndex;if(m.type==="to_this_lane"&&m.laneIndex!==void 0)f=f.filter(v=>v===m.laneIndex);else if(m.type==="to_another_lane")f=f.filter(v=>v!==y);else if(m.type==="to_or_from_this_lane"&&m.laneIndex!==void 0){const v=typeof m.laneIndex=="number"?m.laneIndex:y;y!==v&&(f=[v])}else if(m.type==="non_matching_protocol"){const v=_e(a,n.cardToShiftId);v&&(f=f.filter(_=>{const w=a.player.protocols[_],b=a.opponent.protocols[_];return v.card.protocol!==w&&v.card.protocol!==b}))}}return f.length>0?{type:"selectLane",laneIndex:f[0]}:{type:"selectLane",laneIndex:0}}case"select_lane_for_shift_all":{let f=n.validLanes||[0,1,2];return f=f.filter(m=>m!==n.sourceLaneIndex),f.length>0?{type:"selectLane",laneIndex:f[0]}:{type:"selectLane",laneIndex:0}}case"select_lane_for_delete":{let f=n.validLanes||[0,1,2];f=f.filter(y=>!(n.excludeSourceLane&&y===n.laneIndex));const m=f.map(y=>{let v=0,_=0;const w=n.deleteFilter;for(const b of a.player.lanes[y])w!=null&&w.valueRange&&b.isFaceUp?b.value>=w.valueRange.min&&b.value<=w.valueRange.max&&(v+=1):w!=null&&w.valueRange||(v+=1);for(const b of a.opponent.lanes[y])w!=null&&w.valueRange&&b.isFaceUp?b.value>=w.valueRange.min&&b.value<=w.valueRange.max&&(_+=2):w!=null&&w.valueRange||(_+=2);return{laneIndex:y,score:v-_}});return m.sort((y,v)=>v.score-y.score),{type:"selectLane",laneIndex:((l=m[0])==null?void 0:l.laneIndex)??0}}case"select_lane_for_delete_all":return n.validLanes.length>0?{type:"selectLane",laneIndex:n.validLanes[0]}:{type:"selectLane",laneIndex:0};case"select_lane_for_play":{let f=n.validLanes||[0,1,2];return n.disallowedLaneIndex!==void 0&&(f=f.filter(m=>m!==n.disallowedLaneIndex)),f=f.filter(m=>La(a,"opponent",m,!n.isFaceDown,"").allowed),f.length>0?{type:"selectLane",laneIndex:((c=f.filter(y=>!a.opponent.compiled[y]).map(y=>({lane:y,value:a.opponent.laneValues[y]})).sort((y,v)=>v.value-y.value)[0])==null?void 0:c.lane)??f[0]}:{type:"skip"}}case"select_lane_for_return":{const m=[0,1,2].map(y=>{const v=n.returnFilter;let _=0,w=0;for(const b of a.player.lanes[y]){const N=b.isFaceUp?b.value:2;(v==null?void 0:v.valueEquals)!==void 0&&N!==v.valueEquals||(_+=N)}for(const b of a.opponent.lanes[y]){const N=b.isFaceUp?b.value:2;(v==null?void 0:v.valueEquals)!==void 0&&N!==v.valueEquals||(w+=N)}return{laneIndex:y,score:_-w,hasTargets:_>0||w>0}}).filter(y=>y.hasTargets);return m.sort((y,v)=>v.score-y.score),{type:"selectLane",laneIndex:((i=m[0])==null?void 0:i.laneIndex)??0}}case"prompt_optional_effect":return((u=(d=n.effectDef)==null?void 0:d.params)==null?void 0:u.action)==="give"?{type:"resolveOptionalEffectPrompt",accept:!1}:{type:"resolveOptionalEffectPrompt",accept:!0};case"prompt_optional_discard_custom":return{type:"resolveOptionalDiscardCustomPrompt",accept:!1};case"prompt_optional_shuffle_trash":return{type:"resolvePrompt",accept:(n.trashCount||0)>0};case"select_card_from_revealed_deck":{const f=n.selectableCardIds||[];return f.length>0?{type:"selectRevealedDeckCard",cardId:f[0]}:{type:"resolvePrompt",accept:!1}}case"custom_choice":return{type:"resolveCustomChoice",optionIndex:0};case"flip_self":return n.sourceCardId?{type:"flipCard",cardId:n.sourceCardId}:{type:"skip"};case"prompt_rearrange_protocols":return sm(a,n);case"prompt_swap_protocols":return{type:"resolveSwapProtocols",indices:[0,1]};case"select_card_from_hand_to_play":{const f=n.selectableCardIds,m=f?a.opponent.hand.filter(y=>f.includes(y.id)):a.opponent.hand;if(m.length>0){const y=m[0];let v=n.validLanes||[0,1,2].filter(_=>_!==n.disallowedLaneIndex);if(v=v.filter(_=>La(a,"opponent",_,!n.isFaceDown,y.protocol).allowed),v.length>0){const _=v.filter(w=>!a.opponent.compiled[w]).map(w=>({lane:w,value:a.opponent.laneValues[w]})).sort((w,b)=>b.value-w.value);return{type:"playCard",cardId:y.id,laneIndex:((h=_[0])==null?void 0:h.lane)??v[0],isFaceUp:!1}}}return{type:"skip"}}case"select_card_from_hand_to_give":return a.opponent.hand.length>0?{type:"giveCard",cardId:[...a.opponent.hand].sort((m,y)=>m.value-y.value)[0].id}:{type:"skip"};case"select_card_from_hand_to_reveal":return a.opponent.hand.length>0?{type:"revealCard",cardId:a.opponent.hand[0].id}:{type:"skip"};case"reveal_opponent_hand":return{type:"skip"};case"select_board_card_to_reveal":{const f=zl(a,n.actor,n.targetFilter||{faceState:"face_down",position:"uncovered"},void 0,n.sourceCardId);return f.length>0?{type:"revealCard",cardId:f[0].id}:{type:"skip"}}case"prompt_shift_or_flip_revealed_card":{const f=_e(a,n.revealedCardId);return f?f.owner==="player"?{type:"resolvePrompt",accept:!0}:{type:"resolvePrompt",accept:!1}:{type:"resolvePrompt",accept:!1}}case"select_lane_to_shift_revealed_card":{const f=_e(a,n.revealedCardId);if(!f)return{type:"selectLane",laneIndex:0};let m=-1;for(let v=0;v<a[f.owner].lanes.length;v++)if(a[f.owner].lanes[v].some(_=>_.id===n.revealedCardId)){m=v;break}const y=[0,1,2].filter(v=>v!==m);return y.length>0?{type:"selectLane",laneIndex:y[0]}:{type:"selectLane",laneIndex:0}}case"shift_flipped_card_optional":{const f=n.cardId,m=_e(a,f);if(!m)return{type:"skip"};let y=m.laneIndex??-1;if(y===-1){for(let _=0;_<a[m.owner].lanes.length;_++)if(a[m.owner].lanes[_].some(w=>w.id===f)){y=_;break}}const v=[0,1,2].filter(_=>_!==y);return v.length===0?{type:"skip"}:{type:"selectLane",laneIndex:v[0]}}case"select_phase_effect":{const f=n;return f.availableEffects.length===0?{type:"skip"}:{type:"flipCard",cardId:f.availableEffects[0].cardId}}}return{type:"skip"}},R0=(a,n)=>{if(n)return N0(a,n);if(a.phase==="compile"&&a.compilableLanes.length>0)return{type:"compile",laneIndex:a.compilableLanes[0]};if(a.phase==="action"){const l=k0(a);if(l)return{type:"playCard",...l};if(a.opponent.hand.length<=1)return{type:"fillHand"};for(const c of a.opponent.hand)for(let i=0;i<3;i++){if(a.opponent.compiled[i])continue;if(La(a,"opponent",i,!1,c.protocol).allowed)return{type:"playCard",cardId:c.id,laneIndex:i,isFaceUp:!1}}return{type:"fillHand"}}return{type:"fillHand"}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * NORMAL AI - Plays like a human player
 * - Makes good strategic decisions
 * - No memory of revealed cards
 * - 20% chance to make suboptimal moves for realism
 * - Balanced between Easy and Hard
 */const zr=["delete","flip","shift","return","discard"],Ut=a=>{let n=12-a.value;return zr.some(l=>a.keywords[l])&&(n+=6),a.keywords.draw&&(n+=3),a.keywords.play&&(n+=8),a.keywords.prevent&&(n+=4),n},qr=(a,n,l)=>{let c;for(const d of l[n].lanes)if(d.some(u=>u.id===a.id)){c=d;break}if(!c)return 0;if(!a.isFaceUp)return c.some(u=>u.isFaceUp&&u.protocol==="Darkness"&&u.value===2)?4:2;let i=a.value*2.5;return a.top.length>0&&(i+=6),(a.bottom.includes("Start:")||a.bottom.includes("End:"))&&(i+=8),a.bottom.includes("covered:")&&(i+=5),zr.some(d=>a.keywords[d])&&(i+=4),i},Ir=()=>Math.random()<.2,Mh=a=>a+(Math.random()*10-5),$r=(a,n,l,c)=>{const i=l.position||"uncovered";return!(i==="uncovered"&&!n||i==="covered"&&n||l.faceState==="face_up"&&!a.isFaceUp||l.faceState==="face_down"&&a.isFaceUp||l.excludeSelf&&c&&a.id===c||l.valueRange&&(!a.isFaceUp||a.value<l.valueRange.min||a.value>l.valueRange.max)||l.valueEquals!==void 0&&(!a.isFaceUp||a.value!==l.valueEquals))},A0=a=>{const n=[],l=cm(a,"opponent"),c=a.player.lanes.flat().length+a.opponent.lanes.flat().length,i=c<=3,d=c>3&&c<=8,h=a.player.lanes.flat().length>0,f=a.player.compiled.filter(Boolean).length,m=a.controlCardHolder==="opponent";a.controlCardHolder;let y=0;for(let C=0;C<3;C++)a.opponent.laneValues[C]>a.player.laneValues[C]?y++:a.player.laneValues[C]>a.opponent.laneValues[C];const _=a.useControlMechanic===!0&&f>=1&&!m;for(let C=0;C<3&&!(!a.player.compiled[C]&&a.player.laneValues[C]>=10&&a.player.laneValues[C]>a.opponent.laneValues[C]);C++);const w=a.opponent.compiled.filter(Boolean).length;let b=-1;if(w<3&&!_){const C=[];for(let j=0;j<3;j++){if(a.opponent.compiled[j])continue;const R=a.opponent.protocols[j],F=a.player.protocols[j],L=a.opponent.laneValues[j],U=a.player.laneValues[j],Q=a.opponent.hand.filter(E=>E.protocol===R||E.protocol===F);if(U>=10&&!a.player.compiled[j]){const E=Math.max(...Q.map(T=>T.value),0),O=Math.max(E,2);if(L+O<=U)continue}let X=0,V=`Lane ${j} (${R}): value=${L}`;X+=L*15,L>=8?(X+=100,V+=` [ALMOST COMPILE: ${L}]`):L>=6?(X+=60,V+=` [Near compile: ${L}]`):L>=4&&(X+=30,V+=` [Building: ${L}]`),X+=Q.length*10,Q.length>0&&(V+=` [${Q.length} cards]`);const $=Q.filter(E=>E.value>=4);X+=$.length*20,U>L&&(X-=(U-L)*5),Q.length===0&&(X-=30,V+=" [No matching cards - face-down only]"),C.push({laneIndex:j,score:X,reason:V})}C.sort((j,R)=>R.score-j.score),C.length>0&&(b=C[0].laneIndex)}const N=(C,j)=>C.keywords.flip||C.keywords.delete||C.keywords.shift||C.keywords.return?a.player.lanes.flat().length>0||a.opponent.lanes.some((L,U)=>U!==j&&L.length>0)||a.opponent.lanes[j].length>0:!0,S=C=>C.keywords.draw?a.opponent.hand.length>=5:!1;for(const C of a.opponent.hand)for(let j=0;j<3;j++){const R=La(a,"opponent",j,!0,C.protocol),F=La(a,"opponent",j,!1,C.protocol);if(!R.allowed&&!F.allowed||a.opponent.compiled[j])continue;const L=a.player.laneValues[j]>=10&&a.player.laneValues[j]>a.opponent.laneValues[j]&&!a.player.compiled[j];if(L){const E=Math.max(R.allowed?C.value:0,F.allowed?ea({...C,isFaceUp:!1},a.opponent.lanes[j]):0);if(a.opponent.laneValues[j]+E<=a.player.laneValues[j]&&!zr.some(O=>C.keywords[O]))continue}let U=!1;if(im(C)){let E=0;for(let A=0;A<3;A++)if(a.opponent.lanes[A].length>0){if(A===j)continue;E++}E===0&&(U=!0)}if(Hd(C)){const E=a.opponent.laneValues[j],A=Math.max(0,10-C.value);if(E<A)continue;const O=E+C.value,I=a.player.laneValues[j];if(O<=I)continue}const Q=E0(a,"opponent",j);if(Q!==null){const E=a.opponent.laneValues[j],A=E+C.value-Q,O=A>=10&&A>a.player.laneValues[j],I=E-Q>=4;if(!O&&!I)continue}const X=L;let V=!1;if(dm(C)){let E=0;for(let A=0;A<3;A++){const O=a.opponent.lanes[A];if(O.length>0&&A!==j){const I=O[O.length-1],T=I.isFaceUp?I.value:2;T>E&&(E=T)}}C.value>=E&&(V=!0)}if(R.allowed&&!l&&!V&&!U){let E=0,A=`Play ${C.protocol}-${C.value} face-up in lane ${j}`;const O=C.value,I=a.opponent.laneValues[j]+O;if(X)I>a.player.laneValues[j]?(E=180+I*5,A+=" [Blocks compile!]"):(E=-150,A+=" [Fails to block]");else{if(E+=O*10,I>=10&&I>a.player.laneValues[j]&&!a.opponent.compiled[j])E+=200,A+=` [COMPILE: ${I}]`;else if(I>=8&&I<10&&!a.opponent.compiled[j]){const q=a.opponent.lanes[j].some(K=>K.isFaceUp&&K.protocol==="Darkness"&&K.value===2)?4:2;a.opponent.laneValues[j]+q>=10&&I<10?(E-=50,A+=` [Near ${I} but face-down could compile!]`):(E+=40,A+=` [Near compile: ${I}]`)}i&&O<=2&&(E-=50,A+=" [Low value early game penalty]"),N(C,j)||(E-=80,A+=" [No valid targets for effect]"),S(C)&&(E-=30,A+=" [Draw would cause discard]");const T=zr.some(q=>C.keywords[q]);if(T&&h?d&&a.player.laneValues[j]>=5?(E+=35,A+=" [Disruption with targets]"):a.player.laneValues[j]>=8&&(E+=50,A+=" [Disruption near compile]"):T&&!h&&(E-=40,A+=" [Disruption but no targets]"),b!==-1&&!_&&(j===b?(E+=150,A+=" [FOCUS LANE]"):(E-=100,A+=" [Not focus lane]")),_){const q=a.opponent.laneValues[j]>a.player.laneValues[j],Y=I>a.player.laneValues[j],K=a.opponent.laneValues[j]===a.player.laneValues[j];if(q)E-=200,A+=" [ALREADY LEADING - DON'T WASTE!]";else if(!q&&Y)y===1?(E+=500,A+=" [CONTROL CAPTURE! 1->2 leads]"):y===0?(E+=300,A+=" [First lead! 0->1 leads]"):(E+=100,A+=" [Extra lead]");else if(K&&Y)y===1?(E+=450,A+=" [BREAK TIE FOR CONTROL!]"):(E+=250,A+=" [Break tie]");else if(!q&&!Y&&y===1){const P=a.player.laneValues[j]-I;P<=3?(E+=200,A+=` [BUILD toward 2nd lead, gap=${P}]`):P<=6?(E+=150,A+=` [BUILD toward 2nd lead, gap=${P}]`):(E+=100,A+=` [BUILD toward 2nd lead, gap=${P}]`)}}}n.push({move:{type:"playCard",cardId:C.id,laneIndex:j,isFaceUp:!0},score:Mh(E),reason:A})}if(F.allowed){const E=ea({...C,isFaceUp:!1},a.opponent.lanes[j]),A=a.opponent.laneValues[j]+E,O=a.opponent.laneValues[j];let I=-100,T=`Play ${C.protocol}-${C.value} face-down in lane ${j}`;if(X?A>a.player.laneValues[j]?(I=150,T+=" [Blocks compile]"):(I=-200,T+=" [Fails to block]"):!a.opponent.compiled[j]&&A>=10&&A>a.player.laneValues[j]?(I=300,T+=` [COMPILE: Face-down finishes at ${O} -> ${A} beats player ${a.player.laneValues[j]}]`):!a.opponent.compiled[j]&&a.player.laneValues[j]>=10&&A>=a.player.laneValues[j]?(I=250,T+=` [BLOCK COMPILE: Face-down reaches ${A} vs player ${a.player.laneValues[j]}]`):!a.opponent.compiled[j]&&a.player.laneValues[j]>=10&&A<a.player.laneValues[j]?(I=-200,T+=` [WASTED: ${A} vs player ${a.player.laneValues[j]} - player still compiles!]`):b===j&&!a.opponent.compiled[j]&&O>=4?(I=50+O*10,T+=` [BUILD FOCUS: ${O} -> ${A}]`):!R.allowed&&C.value<=1?(I=-20,T+=" [No face-up option, low value]"):(I=-120,T+=" [Avoid: Face-up is better]"),b!==-1&&I<50&&!_&&(j===b?(I+=50,T+=" [Focus lane]"):(I-=80,T+=" [Not focus lane]")),_){const q=a.opponent.laneValues[j]>a.player.laneValues[j],Y=A>a.player.laneValues[j],K=a.opponent.laneValues[j]===a.player.laneValues[j];if(q)I-=200,T+=" [FD ALREADY LEADING - DON'T WASTE!]";else if(!q&&Y)y===1?(I+=400,T+=" [FD CONTROL CAPTURE! 1->2 leads]"):y===0&&(I+=250,T+=" [FD First lead!]");else if(K&&Y)y===1?(I+=350,T+=" [FD BREAK TIE FOR CONTROL!]"):(I+=200,T+=" [FD Break tie]");else if(!q&&!Y&&y===1){const P=a.player.laneValues[j]-A;P<=3?(I+=150,T+=` [FD BUILD toward 2nd lead, gap=${P}]`):P<=6&&(I+=100,T+=` [FD BUILD toward 2nd lead, gap=${P}]`)}}n.push({move:{type:"playCard",cardId:C.id,laneIndex:j,isFaceUp:!1},score:Mh(I),reason:T})}}if(a.opponent.hand.length===0)n.push({move:{type:"fillHand"},score:500,reason:"Must refill - no cards"});else{const C=a.player.laneValues.some((F,L)=>F>=10&&F>a.opponent.laneValues[L]&&!a.player.compiled[L]),j=a.controlCardHolder==="opponent",R=a.player.compiled.some(F=>F);C&&j&&R&&n.push({move:{type:"fillHand"},score:200,reason:"Emergency draw to block compile with control swap"})}if(n.length===0)return{type:"fillHand"};n.sort((C,j)=>j.score-C.score);const k=C=>{if(C.type==="playCard"&&C.isFaceUp){const j=a.opponent.hand.find(F=>F.id===C.cardId);if(!j)return!1;const R=La(a,"opponent",C.laneIndex,!0,j.protocol);if(!R.allowed)return console.warn(`[AI Safety] Rejecting invalid face-up play: ${j.protocol}-${j.value} in lane ${C.laneIndex} - ${R.reason}`),!1}return!0};if(Ir()&&n.length>1&&n[1].score>0&&k(n[1].move))return n[1].move;for(const C of n)if(k(C.move))return C.move;return console.warn("[AI Safety] No valid moves found, falling back to fillHand"),{type:"fillHand"}},T0=(a,n)=>{var l,c;switch(n.type){case"prompt_use_control_mechanic":{const i=a.player.compiled.filter(f=>f).length,d=a.compilableLanes.length>0?a.compilableLanes[0]:null;let u=-1;for(let f=0;f<3;f++)if(!a.player.compiled[f]&&a.player.laneValues[f]>=10&&a.player.laneValues[f]>a.opponent.laneValues[f]){u=f;break}const h=a.player.compiled.map((f,m)=>f?m:-1).filter(f=>f!==-1);return u!==-1&&h.length>0?{type:"resolveControlMechanicPrompt",choice:"player"}:i===0?Oh(a,d)&&!Ir()?{type:"resolveControlMechanicPrompt",choice:"opponent"}:{type:"resolveControlMechanicPrompt",choice:"skip"}:S0(a,d)?{type:"resolveControlMechanicPrompt",choice:"player"}:Oh(a,d)&&!Ir()?{type:"resolveControlMechanicPrompt",choice:"opponent"}:{type:"resolveControlMechanicPrompt",choice:"skip"}}case"discard":return{type:"discardCards",cardIds:[...a.opponent.hand].sort((d,u)=>{const h=zr.some(m=>d.keywords[m]),f=zr.some(m=>u.keywords[m]);return h&&!f?1:!h&&f?-1:Ut(d)-Ut(u)}).slice(0,n.count).map(d=>d.id)};case"discard_completed":return{type:"skip"};case"select_opponent_card_to_flip":{const d=(h=>a[h].lanes.map(f=>f.length>0?f[f.length-1]:null).filter(f=>f!==null))("player");if(d.length===0)return{type:"skip"};const u=d.map(h=>({cardId:h.id,score:h.isFaceUp?h.value+5:3}));return u.sort((h,f)=>f.score-h.score),{type:"flipCard",cardId:u[0].cardId}}case"select_cards_to_delete":{const i=n.disallowedIds||[],d=n.allowedIds,u=n.targetFilter??{},h="actorChooses"in n?n.actorChooses:"effect_owner",f=n.sourceCardId;if(h==="card_owner"&&(u==null?void 0:u.owner)==="opponent"){const v=[];return a.opponent.lanes.forEach(_=>{if(_.length>0){const w=_[_.length-1];if($r(w,!0,u,f)){if(d&&!d.includes(w.id))return;v.push(w)}}}),v.length>0?(v.sort((_,w)=>_.value-w.value),{type:"deleteCard",cardId:v[0].id}):{type:"skip"}}const m=v=>a[v].lanes.map(_=>_.length>0?_[_.length-1]:null).filter(_=>_!==null).filter(_=>$r(_,!0,u,f)).filter(_=>!d||d.includes(_.id)),y=u==null?void 0:u.owner;if(y==="own"){const v=m("opponent").filter(_=>!i.includes(_.id));if(v.length>0)return{type:"deleteCard",cardId:v.sort((w,b)=>w.value-b.value)[0].id}}else if(y==="opponent"){const v=m("player").filter(_=>!i.includes(_.id));if(v.length>0){const _=v.map(w=>{const b=a.player.lanes.findIndex(k=>k.some(C=>C.id===w.id)),N=a.player.laneValues[b],S=N>=10&&N>a.opponent.laneValues[b];return{cardId:w.id,score:qr(w,"player",a)+N+(S?50:0)}});return _.sort((w,b)=>b.score-w.score),{type:"deleteCard",cardId:_[0].cardId}}}else{const v=m("player").filter(w=>!i.includes(w.id));if(v.length>0){const w=v.map(b=>{const N=a.player.lanes.findIndex(C=>C.some(j=>j.id===b.id)),S=a.player.laneValues[N],k=S>=10&&S>a.opponent.laneValues[N];return{cardId:b.id,score:qr(b,"player",a)+S+(k?50:0)}});return w.sort((b,N)=>N.score-b.score),{type:"deleteCard",cardId:w[0].cardId}}const _=m("opponent").filter(w=>!i.includes(w.id));if(_.length>0)return{type:"deleteCard",cardId:_.sort((b,N)=>b.value-N.value)[0].id}}return{type:"skip"}}case"select_any_card_to_flip":case"select_any_other_card_to_flip":case"select_any_face_down_card_to_flip_optional":case"select_any_card_to_flip_optional":{const i=ma(a),d=n.targetFilter,u=n.sourceCardId,h=n.actor,f=n.currentLaneIndex??n.laneIndex,m=n.scope,y=[];for(const _ of["player","opponent"])if(!(d&&(d.owner==="own"&&_!==h||d.owner==="opponent"&&_===h)))for(let w=0;w<a[_].lanes.length;w++){if(f!==void 0&&w!==f||m==="this_lane"&&f!==void 0&&w!==f)continue;const b=a[_].lanes[w];if(b.length!==0)for(let N=0;N<b.length;N++){const S=b[N],k=N===b.length-1;if(d){if(!$r(S,k,d,u))continue}else if(!k)continue;i&&!S.isFaceUp||y.push({card:S,owner:_})}}if(y.length===0)return{type:"skip"};const v=y.map(({card:_,owner:w})=>{let b=0,N=-1;for(let F=0;F<a[w].lanes.length;F++)if(a[w].lanes[F].some(L=>L.id===_.id)){N=F;break}const S=N>=0?a[w].laneValues[N]:0,k=N>=0?a[w].compiled[N]:!1,C=_.isFaceUp?_.value:2,R=(_.isFaceUp?2:_.value)-C;return w==="player"?_.isFaceUp?(b=-R*15,b+=qr(_,"player",a)):_.value<=1?b=20:b=-30:_.isFaceUp?R>0?(b=R*20+50,!k&&S+R>=10&&(b+=200)):b=R*15-30:R>0?(b=R*20+40,!k&&S+R>=10&&(b+=200)):b=-10,{cardId:_.id,score:b}});return v.sort((_,w)=>w.score-_.score),{type:"flipCard",cardId:v[0].cardId}}case"plague_2_opponent_discard":return a.opponent.hand.length===0?{type:"skip"}:{type:"discardCards",cardIds:[[...a.opponent.hand].sort((d,u)=>Ut(d)-Ut(u))[0].id]};case"select_cards_from_hand_to_discard_for_fire_4":{const i=Math.min(3,a.opponent.hand.length);return i===0?{type:"skip"}:{type:"discardCards",cardIds:[...a.opponent.hand].sort((h,f)=>Ut(h)-Ut(f)).slice(0,i).map(h=>h.id)}}case"select_cards_from_hand_to_discard_for_hate_1":{const i=Math.min(n.count||1,a.opponent.hand.length);return i===0?{type:"skip"}:{type:"discardCards",cardIds:[...a.opponent.hand].sort((h,f)=>Ut(h)-Ut(f)).slice(0,i).map(h=>h.id)}}case"select_card_from_hand_to_play":{if(a.opponent.hand.length===0)return{type:"skip"};const i=n.faceDown===!0,d=n.selectableCardIds,u=d?a.opponent.hand.filter(y=>d.includes(y.id)):a.opponent.hand;if(u.length===0)return{type:"skip"};let h=n.validLanes||[0,1,2].filter(y=>y!==n.disallowedLaneIndex);if(h=h.filter(y=>{const v=a.player.lanes[y],_=v.length>0?v[v.length-1]:null;return!(_&&_.isFaceUp&&_.protocol==="Plague"&&_.value===0)}),h.length===0)return{type:"skip"};const f=[];for(const y of u)for(const v of h){if(!i){const b=a.opponent.lanes.flat().some(C=>C.isFaceUp&&C.protocol==="Spirit"&&C.value===1),N=a.opponent.lanes.some(C=>{if(C.length===0)return!1;const j=C[C.length-1];return j.isFaceUp&&j.protocol==="Chaos"&&j.value===3}),S=[...a.player.lanes.flat(),...a.opponent.lanes.flat()].some(C=>C.isFaceUp&&C.protocol==="Anarchy"&&C.value===1);let k;if(S?k=y.protocol!==a.opponent.protocols[v]&&y.protocol!==a.player.protocols[v]:k=y.protocol===a.opponent.protocols[v]||y.protocol===a.player.protocols[v]||b||N,k){const C=y.value,j=a.opponent.laneValues[v]+C;let R=Ut(y)+C*2;j>=10&&j>a.player.laneValues[v]&&(R+=100),f.push({cardId:y.id,laneIndex:v,isFaceUp:!0,score:R})}}if(!a.player.lanes[v].some(b=>b.isFaceUp&&b.protocol==="Metal"&&b.value===2)){const b=ea({...y,isFaceUp:!1},a.opponent.lanes[v]),N=a.opponent.laneValues[v]+b;let S=b*2;N>=10&&N>a.player.laneValues[v]&&(S+=80),f.push({cardId:y.id,laneIndex:v,isFaceUp:!1,score:S})}}if(f.length===0)return{type:"skip"};f.sort((y,v)=>v.score-y.score);const m=f[0];return{type:"playCard",cardId:m.cardId,laneIndex:m.laneIndex,isFaceUp:m.isFaceUp}}case"select_card_from_hand_to_give":return a.opponent.hand.length===0?{type:"skip"}:{type:"giveCard",cardId:[...a.opponent.hand].sort((d,u)=>Ut(d)-Ut(u))[0].id};case"select_card_from_hand_to_reveal":return a.opponent.hand.length===0?{type:"skip"}:{type:"revealCard",cardId:[...a.opponent.hand].sort((d,u)=>Ut(u)-Ut(d))[0].id};case"select_card_to_return":case"select_opponent_card_to_return":{const d={position:"uncovered",...n.targetFilter||{}},u=n.targetOwner||d.owner,h=n.sourceCardId,f=n.actor,m=[];for(const _ of["player","opponent"])if(!(u==="own"&&_!==f)&&!(u==="opponent"&&_===f))for(const w of a[_].lanes)for(let b=0;b<w.length;b++){const N=w[b],S=b===w.length-1;$r(N,S,d,h)&&m.push({card:N,owner:_})}if(m.length===0)return{type:"skip"};const y=m.filter(_=>_.owner==="player"),v=m.filter(_=>_.owner==="opponent");return y.length>0?(y.sort((_,w)=>qr(w.card,"player",a)-qr(_.card,"player",a)),{type:"returnCard",cardId:y[0].card.id}):v.length>0?(v.sort((_,w)=>_.card.value-w.card.value),{type:"returnCard",cardId:v[0].card.id}):{type:"returnCard",cardId:m[0].card.id}}case"select_lane_for_play":{let i=n.validLanes||[0,1,2];if(i=i.filter(u=>!("disallowedLaneIndex"in n)||u!==n.disallowedLaneIndex),i=i.filter(u=>{const h=a.player.lanes[u],f=h.length>0?h[h.length-1]:null,m=f&&f.isFaceUp&&f.protocol==="Plague"&&f.value===0,y="isFaceDown"in n&&n.isFaceDown&&h.some(v=>v.isFaceUp&&v.protocol==="Metal"&&v.value===2);return!m&&!y}),i.length===0)return{type:"skip"};const d=i.map(u=>{const h=a.opponent.laneValues[u]-a.player.laneValues[u];return{laneIndex:u,score:-h}});return d.sort((u,h)=>h.score-u.score),{type:"selectLane",laneIndex:d[0].laneIndex}}case"prompt_rearrange_protocols":return sm(a,n);case"prompt_swap_protocols":{const{target:i}=n,d=a[i].protocols,u=a[i].hand,h=a[i].compiled,f=a[i].laneValues,m=[[0,1],[0,2],[1,2]];let y=[0,1],v=-1/0;for(const _ of m){const[w,b]=_,N=[...d];[N[w],N[b]]=[N[b],N[w]];let S=0;const k=h[w],C=h[b],j=f[w],R=f[b];if(i==="opponent"){k&&!C?R<j&&(S+=30):C&&!k&&j<R&&(S+=30);for(const F of u){const L=F.protocol===d[w],U=F.protocol===d[b],Q=F.protocol===N[w],X=F.protocol===N[b],V=k?.5:1.5,$=C?.5:1.5;Q&&!L&&(S+=Ut(F)*V),X&&!U&&(S+=Ut(F)*$),!Q&&L&&(S-=Ut(F)*V),!X&&U&&(S-=Ut(F)*$)}}else{k&&!C?j>R&&(S+=25):C&&!k&&R>j&&(S+=25);for(const F of u){const L=F.protocol===d[w],U=F.protocol===d[b],Q=F.protocol===N[w],X=F.protocol===N[b],V=k?.5:1.5,$=C?.5:1.5;Q&&!L&&(S-=Ut(F)*V),X&&!U&&(S-=Ut(F)*$),!Q&&L&&(S+=Ut(F)*V),!X&&U&&(S+=Ut(F)*$)}}S>v&&(v=S,y=_)}return{type:"resolveSwapProtocols",indices:y}}case"select_lane_for_shift":{let i=n.validLanes||[0,1,2];if(i=i.filter(d=>!("disallowedLaneIndex"in n)||d!==n.disallowedLaneIndex).filter(d=>!("originalLaneIndex"in n)||d!==n.originalLaneIndex),"sourceCardId"in n){const d=[...a.player.lanes.flat(),...a.opponent.lanes.flat()].find(u=>u.id===n.sourceCardId);if(d&&d.protocol==="Gravity"&&d.value===1){let u=null;for(let h=0;h<3;h++)if([...a.player.lanes[h],...a.opponent.lanes[h]].some(m=>m.id===n.sourceCardId)){u=h;break}u!==null&&"originalLaneIndex"in n&&(n.originalLaneIndex===u||(i=[u]))}if(d&&d.protocol==="Anarchy"&&d.value===1){const u="cardToShiftId"in n?n.cardToShiftId:null;if(u){const h=[...a.player.lanes.flat(),...a.opponent.lanes.flat()].find(f=>f.id===u);h&&(i=i.filter(f=>{const m=a.player.protocols[f],y=a.opponent.protocols[f],v=h.protocol;return v!==m&&v!==y}))}}}if(i.length>0){const d="cardToShiftId"in n?n.cardToShiftId:null;let u=null,h=0;if(d)for(const m of["player","opponent"]){for(const y of a[m].lanes){const v=y.find(_=>_.id===d);if(v){u=m,h=v.isFaceUp?v.value:2;break}}if(u)break}const f=i.map(m=>{let y=0;const v=a.player.laneValues[m],_=a.opponent.laneValues[m],w=a.player.compiled[m],b=a.opponent.compiled[m];return u==="player"?w?y+=100:_>v?y+=50:v>=6&&v<10&&!w&&(y-=50):u==="opponent"&&(!b&&_<10?_+h>=10?y+=100:_>=6?y+=60:y+=30:b&&(y-=50)),{laneIdx:m,score:y}});if(f.sort((m,y)=>y.score-m.score),Ir()&&f.length>1){const m=Math.floor(Math.random()*f.length);return{type:"selectLane",laneIndex:f[m].laneIdx}}return{type:"selectLane",laneIndex:f[0].laneIdx}}return{type:"selectLane",laneIndex:0}}case"select_lane_for_delete_all":{const i="validLanes"in n?n.validLanes:[0,1,2];return i.length>0?{type:"selectLane",laneIndex:i[Math.floor(Math.random()*i.length)]}:{type:"skip"}}case"select_lane_for_return":{const i=n.targetFilter||{},d=n.actor,u=i.valueEquals,h=i.valueRange,f=[];for(let m=0;m<3;m++){let y=0,v=0;const _=um(a,m);for(const N of["player","opponent"]){if(i.owner==="own"&&N!==d||i.owner==="opponent"&&N===d)continue;const S=a[N].lanes[m];for(let k=0;k<S.length;k++){const C=S[k],j=k===S.length-1;if(i.position==="uncovered"&&!j||i.position==="covered"&&j)continue;const R=C.isFaceUp?C.value:2+_;u!==void 0&&R!==u||h&&(R<h.min||R>h.max)||(N==="player"?y+=R:v+=R)}}const w=y-v,b=`Lane ${m}: Player loses ${y}, we lose ${v}, net=${w}`;f.push({laneIndex:m,score:w,reason:b})}f.sort((m,y)=>y.score-m.score);for(const m of f);return f.length>0?{type:"selectLane",laneIndex:f[0].laneIndex}:{type:"selectLane",laneIndex:0}}case"prompt_optional_effect":{const{effectDef:i}=n,d=(l=i==null?void 0:i.params)==null?void 0:l.action,u=(c=i==null?void 0:i.params)==null?void 0:c.targetFilter;if(d==="give")return{type:"resolveOptionalEffectPrompt",accept:!1};if(d==="flip"){let h=!1;const f=(u==null?void 0:u.position)||"uncovered";for(const m of["player","opponent"])if(!((u==null?void 0:u.owner)==="own"&&m!=="opponent")&&!((u==null?void 0:u.owner)==="opponent"&&m==="opponent")){for(let y=0;y<a[m].lanes.length;y++){const v=a[m].lanes[y];if(v.length!==0){for(let _=0;_<v.length;_++){const w=v[_],b=_===v.length-1,N=!b;if(f==="uncovered"&&!b||f==="covered"&&!N||(u==null?void 0:u.faceState)==="face_up"&&!w.isFaceUp||(u==null?void 0:u.faceState)==="face_down"&&w.isFaceUp)continue;const S=w.isFaceUp?w.value:2,k=w.isFaceUp?2:w.value;if(m==="player"){if(w.isFaceUp&&S>k){h=!0;break}}else{const C=a.opponent.laneValues[y],j=k-S;if(w.isFaceUp&&j>0){h=!0;break}if(!w.isFaceUp&&w.value>2){h=!0;break}if(j>0&&C+j>=10&&!a.opponent.compiled[y]){h=!0;break}}}if(h)break}}if(h)break}return{type:"resolveOptionalEffectPrompt",accept:h}}return{type:"resolveOptionalEffectPrompt",accept:!Ir()}}case"select_card_from_other_lanes_to_delete":{const{disallowedLaneIndex:i,lanesSelected:d}=n,u=[];for(let h=0;h<3;h++){if(h===i||d.includes(h))continue;const f=a.player.lanes[h];if(f.length>0){u.push(f[f.length-1]);continue}const m=a.opponent.lanes[h];m.length>0&&u.push(m[m.length-1])}return u.length>0?{type:"deleteCard",cardId:u[0].id}:{type:"skip"}}case"select_face_down_card_to_delete":{const i="disallowedIds"in n&&Array.isArray(n.disallowedIds)?n.disallowedIds:[],d=f=>a[f].lanes.map(m=>m.length>0?m[m.length-1]:null).filter(m=>m!==null),u=d("player").filter(f=>!i.includes(f.id));if(u.length>0)return{type:"deleteCard",cardId:u[0].id};const h=d("opponent").filter(f=>!i.includes(f.id));return h.length>0?{type:"deleteCard",cardId:h[0].id}:{type:"skip"}}case"select_low_value_card_to_delete":{const i=[];for(const u of["player","opponent"])for(const h of a[u].lanes)h.length>0&&i.push(h[h.length-1]);const d=i.filter(u=>u.isFaceUp&&(u.value===0||u.value===1));return d.length>0?{type:"deleteCard",cardId:d[0].id}:{type:"skip"}}case"select_opponent_face_up_card_to_flip":{const d=(u=>a[u].lanes.map(h=>h.length>0?h[h.length-1]:null).filter(h=>h!==null))("player").filter(u=>u.isFaceUp);return d.length>0?(d.sort((u,h)=>h.value-u.value),{type:"flipCard",cardId:d[0].id}):{type:"skip"}}case"select_covered_card_in_line_to_flip_optional":{const i="optional"in n&&n.optional,u=!["select_any_other_card_to_flip","select_any_other_card_to_flip_for_water_0"].includes(n.type);if(n.type==="select_covered_card_in_line_to_flip_optional"){const{laneIndex:_}=n,w=a.opponent.lanes[_],b=a.player.lanes[_],N=w.filter((L,U,Q)=>U<Q.length-1),S=b.filter((L,U,Q)=>U<Q.length-1),k=a.opponent.laneValues[_];if(!a.opponent.compiled[_]){let L=null,U=null;for(const Q of N){let X,V;Q.isFaceUp?(X=Q.value,V=2):(X=ea(Q,w,a,_,"opponent"),V=Q.value);const $=V-X,E=k+$;$>0&&E>=10&&(!L||E>L.newValue)&&(L={card:Q,newValue:E,gain:$}),$>0&&(!U||$>U.gain)&&(U={card:Q,gain:$,newValue:E})}if(L)return{type:"flipCard",cardId:L.card.id};if(U&&U.gain>0)return{type:"flipCard",cardId:U.card.id}}if(a.opponent.compiled[_]){let L=null;for(const U of N){const Q=U.isFaceUp?U.value:ea(U,w,a,_,"opponent"),V=(U.isFaceUp?2:U.value)-Q;V>0&&(!L||V>L.gain)&&(L={card:U,gain:V})}if(L)return{type:"flipCard",cardId:L.card.id}}const j=S.filter(L=>L.isFaceUp);if(j.length>0)return j.sort((L,U)=>U.value-L.value),{type:"flipCard",cardId:j[0].id};const R=N.filter(L=>!L.isFaceUp).map(L=>({card:L,gain:L.value-ea(L,w,a,_,"opponent")})).filter(L=>L.gain>0).sort((L,U)=>U.gain-L.gain);if(R.length>0)return{type:"flipCard",cardId:R[0].card.id};const F=S.filter(L=>!L.isFaceUp);return F.length>0?{type:"flipCard",cardId:F[0].id}:{type:"skip"}}const h=_=>a[_].lanes.map(w=>w.length>0?w[w.length-1]:null).filter(w=>w!==null),f=h("player"),m=h("opponent");{const _=f.filter(w=>w.isFaceUp).sort((w,b)=>b.value-w.value);if(_.length>0)return{type:"flipCard",cardId:_[0].id}}const y=m.filter(_=>!_.isFaceUp);if(y.length>0)return{type:"flipCard",cardId:y[0].id};const v=f.filter(_=>!_.isFaceUp);if(v.length>0)return{type:"flipCard",cardId:v[0].id};{const _=m.filter(b=>!(!b.isFaceUp||!u&&b.id===n.sourceCardId)),w=_.filter(b=>{const N=a.opponent.lanes.findIndex(S=>S.length>0&&S[S.length-1].id===b.id);return N!==-1&&a.opponent.compiled[N]});if(w.length>0&&!i)return{type:"flipCard",cardId:w[0].id};if(_.length>0&&!i)return{type:"flipCard",cardId:_[0].id}}return{type:"skip"}}case"select_card_to_shift_for_anarchy_0":{const i=[...a.player.lanes.flat(),...a.opponent.lanes.flat()];return i.length>0?{type:"shiftCard",cardId:i[Math.floor(Math.random()*i.length)].id}:{type:"skip"}}case"select_card_to_shift_for_anarchy_1":{const{sourceCardId:i}=n,d=[...a.player.lanes.flat(),...a.opponent.lanes.flat()].filter(u=>u.id!==i);return d.length>0?{type:"shiftCard",cardId:d[Math.floor(Math.random()*d.length)].id}:{type:"skip"}}case"select_card_to_shift_for_gravity_1":{const i=[...a.player.lanes.flat(),...a.opponent.lanes.flat()];return i.length>0?{type:"shiftCard",cardId:i[Math.floor(Math.random()*i.length)].id}:{type:"skip"}}case"select_face_down_card_to_shift_for_gravity_4":{const{targetLaneIndex:i}=n,d=[];for(const u of["player","opponent"])for(let h=0;h<a[u].lanes.length;h++)if(h!==i)for(const f of a[u].lanes[h])f.isFaceUp||d.push(f);return d.length>0?{type:"deleteCard",cardId:d[Math.floor(Math.random()*d.length)].id}:{type:"skip"}}case"select_face_down_card_to_shift_for_darkness_4":{const i=[];for(const d of["player","opponent"])for(const u of a[d].lanes)if(u.length>0){const h=u[u.length-1];h.isFaceUp||i.push(h)}return i.length>0?{type:"deleteCard",cardId:i[Math.floor(Math.random()*i.length)].id}:{type:"skip"}}case"shift_flipped_card_optional":{const i=n.cardId,d=n.optional,u=_e(a,i);if(!u)return{type:"skip"};const h=u.card,f=u.owner,m=h.isFaceUp?h.value:2;let y=u.laneIndex??-1;if(y===-1){const F=a[f];for(let L=0;L<F.lanes.length;L++)if(F.lanes[L].some(U=>U.id===i)){y=L;break}}if(y===-1)return{type:"skip"};const v=[0,1,2].filter(F=>F!==y);if(v.length===0)return{type:"skip"};const _=a.opponent,w=a.player,b=_.laneValues[y],N=_.compiled[y],S=w.laneValues[y],k=b-m;let C=-1,j=-1/0;const R=0;for(const F of v){const L=_.laneValues[F],U=_.compiled[F],Q=w.laneValues[F],X=L+m;let V=0;!N&&b>=8&&b>S&&(V-=100),!U&&X>=10&&X>Q&&(V+=80),!U&&L<b&&(N||b<6)&&(V+=20),U&&(V-=30),!U&&L<=Q&&X>Q&&(V+=25),!N&&b>S&&k<=S&&(V-=40),V>j&&(j=V,C=F)}return d&&j<R?{type:"skip"}:C!==-1?{type:"selectLane",laneIndex:C}:d?{type:"skip"}:{type:"selectLane",laneIndex:v[0]}}case"select_opponent_face_down_card_to_shift":{const i=[];for(const d of a.player.lanes)if(d.length>0){const u=d[d.length-1];u.isFaceUp||i.push(u)}return i.length>0?{type:"deleteCard",cardId:i[Math.floor(Math.random()*i.length)].id}:{type:"skip"}}case"select_opponent_covered_card_to_shift":{const i=[];for(const d of a.player.lanes)for(let u=0;u<d.length-1;u++)i.push(d[u]);return i.length>0?{type:"deleteCard",cardId:i[Math.floor(Math.random()*i.length)].id}:{type:"skip"}}case"select_own_covered_card_to_shift":{const i=[];for(const d of a.opponent.lanes)for(let u=0;u<d.length-1;u++)i.push(d[u]);return i.length>0?{type:"deleteCard",cardId:i[Math.floor(Math.random()*i.length)].id}:{type:"skip"}}case"select_card_to_flip":{const i=n.targetFilter||{},d=n.currentLaneIndex??n.laneIndex,u=n.scope,h=n.actor,f=n.sourceCardId,m=[];for(const v of["player","opponent"])if(!(i.owner==="own"&&v!==h)&&!(i.owner==="opponent"&&v===h))for(let _=0;_<a[v].lanes.length;_++){if(d!==void 0&&_!==d||u==="this_lane"&&d!==void 0&&_!==d)continue;const w=a[v].lanes[_];for(let b=0;b<w.length;b++){const N=w[b];if(xo(a,N.id))continue;const S=wo(a,w,b);$r(N,S,i,f)&&(i.position==="covered_in_this_line"&&S||m.push({card:N,owner:v,laneIndex:_}))}}if(m.length===0)return{type:"skip"};const y=m.map(({card:v,owner:_,laneIndex:w})=>{let b=0;const N=a[_].laneValues[w],S=a[_].compiled[w],k=v.isFaceUp?v.value:2,j=(v.isFaceUp?2:v.value)-k;return _==="player"?v.isFaceUp?(b=-j*15,b+=qr(v,"player",a)):v.value<=1?b=20:b=-30:v.isFaceUp?j>0?(b=j*20+50,!S&&N+j>=10&&(b+=200)):b=j*15-30:j>0?(b=j*20+40,!S&&N+j>=10&&(b+=200)):b=-10,{card:v,score:b}});if(y.sort((v,_)=>_.score-v.score),Ir()&&y.length>1){const v=Math.floor(Math.random()*y.length);return{type:"flipCard",cardId:y[v].card.id}}return{type:"flipCard",cardId:y[0].card.id}}case"select_card_to_shift":{const i=n.targetFilter||{},u=n.scope==="this_lane"?n.sourceLaneIndex??n.currentLaneIndex??n.laneIndex:void 0,h=n.actor,f=n.sourceCardId,m=[];for(const y of["player","opponent"])if(!(i.owner==="own"&&y!==h)&&!(i.owner==="opponent"&&y===h))for(let v=0;v<a[y].lanes.length;v++){if(u!==void 0&&v!==u)continue;const _=a[y].lanes[v];for(let w=0;w<_.length;w++){const b=_[w],N=w===_.length-1;$r(b,N,i,f)&&m.push(b)}}return m.length>0?{type:"shiftCard",cardId:m[Math.floor(Math.random()*m.length)].id}:{type:"skip"}}case"select_board_card_to_reveal_custom":{const i=[];for(const d of["player","opponent"])for(const u of a[d].lanes)if(u.length>0){const h=u[u.length-1];h.isFaceUp||i.push({card:h,owner:d})}if(i.length>0){const d=i.filter(u=>u.owner==="player");return d.length>0?{type:"deleteCard",cardId:d[0].card.id}:{type:"deleteCard",cardId:i[0].card.id}}return{type:"skip"}}case"prompt_shift_or_flip_board_card_custom":{const{revealedCardId:i}=n,d=_e(a,i);return d?d.owner==="opponent"?{type:"resolveRevealBoardCardPrompt",choice:"flip"}:{type:"resolveRevealBoardCardPrompt",choice:"shift"}:{type:"resolveRevealBoardCardPrompt",choice:"skip"}}case"select_lane_to_shift_revealed_board_card_custom":{const i=[0,1,2];return i.sort((d,u)=>a.player.laneValues[d]-a.player.laneValues[u]),{type:"selectLane",laneIndex:i[0]}}case"gravity_2_shift_after_flip":{const{targetLaneIndex:i}=n;return{type:"selectLane",laneIndex:i}}case"flip_self":case"flip_self_for_water_0":case"flip_self_for_psychic_4":case"speed_3_self_flip_after_shift":return n.sourceCardId?{type:"flipCard",cardId:n.sourceCardId}:{type:"skip"};case"anarchy_0_conditional_draw":return{type:"skip"};case"select_any_opponent_card_to_shift":{const i=a.player.lanes.map(d=>d.length>0?d[d.length-1]:null).filter(d=>d!==null);return i.length>0?{type:"deleteCard",cardId:i[Math.floor(Math.random()*i.length)].id}:{type:"skip"}}case"select_own_other_card_to_shift":{const i=a.opponent.lanes.flat().find(d=>d.id!==n.sourceCardId);return i?{type:"deleteCard",cardId:i.id}:{type:"skip"}}case"select_own_face_up_covered_card_to_flip":return{type:"skip"};case"plague_4_opponent_delete":{const i=[];return a.opponent.lanes.forEach(d=>{if(d.length>0){const u=d[d.length-1];u.isFaceUp||i.push(u)}}),i.length>0?(i.sort((d,u)=>d.value-u.value),{type:"deleteCard",cardId:i[0].id}):{type:"skip"}}case"reveal_opponent_hand":case"plague_2_player_discard":case"delete_self":return{type:"skip"};case"select_lane_for_delete":{const i=n.validLanes||[0,1,2],d=n.valueFilter,u=i.map(h=>{let f=0,m=0;for(const y of a.player.lanes[h]){const v=y.isFaceUp?y.value:2;d?y.isFaceUp?y.value>=d.min&&y.value<=d.max&&(f+=v+1):f+=(v+1)*.5:f+=v+1}for(const y of a.opponent.lanes[h]){const v=y.isFaceUp?y.value:2;d?y.isFaceUp?y.value>=d.min&&y.value<=d.max&&(m+=v+3):m+=(v+3)*.5:m+=v+3}return{laneIndex:h,score:f-m}});return u.sort((h,f)=>f.score-h.score),u[0].score>0?{type:"selectLane",laneIndex:u[0].laneIndex}:{type:"selectLane",laneIndex:u[0].laneIndex}}case"select_lane_for_shift_all":{const i=n.validDestinationLanes||n.validLanes||[0,1,2],d=n.sourceLaneIndex,u=i.filter(h=>h!==d);if(u.length>0){const h=u.map(f=>{let m=0;return m+=a.opponent.lanes[f].length*2,m+=a.opponent.laneValues[f],a.player.laneValues[f]>=8&&(m-=5),{laneIndex:f,score:m}});return h.sort((f,m)=>m.score-f.score),{type:"selectLane",laneIndex:h[0].laneIndex}}return i.length>0?{type:"selectLane",laneIndex:i[0]}:{type:"selectLane",laneIndex:0}}case"prompt_optional_draw":return{type:"resolveOptionalEffectPrompt",accept:!0};case"prompt_optional_discard_custom":return{type:"resolveOptionalEffectPrompt",accept:a.opponent.hand.length>4};case"prompt_optional_shuffle_trash":return{type:"resolvePrompt",accept:(n.trashCount||0)>0};case"select_card_from_revealed_deck":{const i=n.selectableCardIds||[];if(i.length>0){const d=Math.floor(Math.random()*i.length);return{type:"selectRevealedDeckCard",cardId:i[d]}}return{type:"resolvePrompt",accept:!1}}case"custom_choice":{const{options:i}=n;if(!i||i.length!==2)return{type:"resolveCustomChoice",optionIndex:0};const d=f=>{var v,_,w;let m=0;const y=((v=f.action)==null?void 0:v.toLowerCase())||"";return y.includes("draw")&&(m+=30),y.includes("discard")&&(m-=20),y.includes("delete")&&((_=f.targetFilter)==null?void 0:_.owner)==="opponent"&&(m+=40),y.includes("delete")&&((w=f.targetFilter)==null?void 0:w.owner)==="own"&&(m-=30),m},u=d(i[0]),h=d(i[1]);return{type:"resolveCustomChoice",optionIndex:u>=h?0:1}}case"select_phase_effect":{const i=n;if(i.availableEffects.length===0)return{type:"skip"};const d=i.availableEffects.map(h=>{let f=0;const m=h.effectDescription.toLowerCase();return m.includes("draw")?f+=100:m.includes("delete")?f+=80:m.includes("shift")?f+=60:m.includes("flip")?f+=40:f+=20,Math.random()<.2&&(f=Math.random()*50),{effect:h,score:f}});return d.sort((h,f)=>f.score-h.score),{type:"flipCard",cardId:d[0].effect.cardId}}default:{if("optional"in n&&n.optional)return{type:"skip"};const i=[...a.player.lanes.flat(),...a.opponent.lanes.flat()];return i.length>0&&(n.type.includes("select_")||n.type.includes("shift"))?{type:"deleteCard",cardId:i[0].id}:{type:"skip"}}}},Hh=(a,n)=>n?T0(a,n):a.phase==="compile"&&a.compilableLanes.length>0?{type:"compile",laneIndex:a.compilableLanes.reduce((c,i)=>a.opponent.laneValues[i]>a.opponent.laneValues[c]?i:c)}:a.phase==="action"?A0(a):{type:"fillHand"};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Ct=(a,n)=>a.phase==="start"?n.continueTurnAfterStartPhaseAction(a):n.processEndOfAction(a),fm=(a,n,l,c,i,d,u,h)=>{const{cardId:f,laneIndex:m,isFaceUp:y}=n,{newState:v,animationRequests:_}=i.playCard({...a,actionRequired:null},f,m,y,"opponent"),w={...v,animationState:{type:"playCard",cardId:f,owner:"opponent"}};return setTimeout(()=>{l(b=>{let N={...b,animationState:null};return _&&_.length>0?(d(_,()=>l(S=>{const k={...S,animationState:null};return h&&k.actionRequired?(vn(k,l,c,i,d,u),k):k.actionRequired&&k.actionRequired.actor==="opponent"?k:{...Ct(k,u),animationState:null}})),N):h&&N.actionRequired?(vn(N,l,c,i,d,u),N):N.actionRequired&&N.actionRequired.actor==="opponent"?N:Ct(N,u)})},500),w},mc=(a,n,l)=>{switch(l){case"normal":return Hh(a,n);case"hard":return console.warn("[AI] Hard AI temporarily disabled, using Normal AI"),Hh(a,n);default:return R0(a,n)}},D0=(a,n,l,c,i,d,u,h,f)=>{n(m=>{const y=m.actionRequired;if(!y||!((m.turn==="player"||m._interruptedTurn==="player")&&"actor"in y&&y.actor==="opponent"))return m;if(y.type==="discard_completed"){const{followUpEffect:N,conditionalType:S,previousHandSize:k,sourceCardId:C,actor:j}=y;if(N&&C){const R=_e(m,C);if(R){const F=m[j].hand.length,L=Math.max(0,(k||0)-F);if(S==="then"||S==="if_executed"&&L>0){let Q=-1;for(let X=0;X<m[R.owner].lanes.length;X++)if(m[R.owner].lanes[X].some(V=>V.id===C)){Q=X;break}if(Q!==-1){const X={cardOwner:R.owner,opponent:R.owner==="player"?"opponent":"player",currentTurn:m.turn,actor:j,discardedCount:L},{executeCustomEffect:V}=require("../customProtocols/effectInterpreter");return V(R.card,Q,{...m,actionRequired:null},X,N).newState}}}}return{...m,actionRequired:null}}const w=mc(m,y,l);if(w.type==="discardCards"&&y.type==="discard"){const S=y.variableCount===!0?w.cardIds.length:y.count,k=w.cardIds.slice(0,S);k.length!==w.cardIds.length&&console.warn(`[AI Manager] Fixed discard count: AI wanted ${w.cardIds.length} but action.count=${y.count}`);const C=c.discardCards(m,k,"opponent");return C.actionRequired?C:Ct(C,i)}if(w.type==="rearrangeProtocols"&&y.type==="prompt_rearrange_protocols"){f&&y.sourceCardId==="CONTROL_MECHANIC"&&y.actor&&f(y.actor);const N=c.resolveRearrangeProtocols(m,w.newOrder);return Ct(N,i)}if(y.type==="reveal_opponent_hand"){const N=c.revealOpponentHand(m);return Ct(N,i)}if(w.type==="resolveOptionalEffectPrompt"&&y.type==="prompt_optional_effect"){const N=Dd(m,w.accept);return N.actionRequired?N:Ct(N,i)}if(w.type==="resolveCustomChoice"&&y.type==="custom_choice"){const N=qd(m,w.optionIndex);return N.actionRequired?N:Ct(N,i)}if(w.type==="selectLane"){const{nextState:N,requiresAnimation:S}=h(m,w.laneIndex);if(S){const k=m.phase==="start";return d(S.animationRequests,()=>{n(C=>{const j={...C,animationState:null},R=S.onCompleteCallback(j,L=>L);return R.actionRequired&&R.actionRequired.actor==="opponent"?{...R,animationState:null}:{...k?i.continueTurnAfterStartPhaseAction(R):i.processEndOfAction(R),animationState:null}})}),N}return Ct(N,i)}if(w.type==="deleteCard"||w.type==="flipCard"||w.type==="returnCard"||w.type==="shiftCard"){const{nextState:N,requiresAnimation:S}=u(m,w.cardId);if(S){const k=m.phase==="start";return d(S.animationRequests,()=>{n(C=>{const j={...C,animationState:null},R=S.onCompleteCallback(j,L=>L);return R.actionRequired&&R.actionRequired.actor==="opponent"?{...R,animationState:null}:{...k?i.continueTurnAfterStartPhaseAction(R):i.processEndOfAction(R),animationState:null}})}),N}return N.actionRequired&&N.actionRequired.actor==="opponent"?N:Ct(N,i)}if(w.type==="playCard"&&y.type==="select_card_from_hand_to_play")return fm(m,w,n,l,c,d,i,!1);console.warn(`AI has no logic for mandatory action during player turn, clearing it: ${y.type}, aiDecision: ${JSON.stringify(w)}`);const b={...m,actionRequired:null};return Ct(b,i)})},F0=(a,n,l,c,i,d,u)=>{const h=a.actionRequired;if(h.type==="discard_completed"){const{followUpEffect:y,conditionalType:v,previousHandSize:_,sourceCardId:w,actor:b}=h;if(y&&w){const N=_e(a,w);if(N){const S=a[b].hand.length,k=Math.max(0,(_||0)-S);if(v==="then"||v==="if_executed"&&k>0){let j=-1;for(let R=0;R<a[N.owner].lanes.length;R++)if(a[N.owner].lanes[R].some(F=>F.id===w)){j=R;break}if(j!==-1){const R={cardOwner:N.owner,opponent:N.owner==="player"?"opponent":"player",currentTurn:a.turn,actor:b,discardedCount:k},{executeCustomEffect:F}=require("../customProtocols/effectInterpreter");return F(N.card,j,{...a,actionRequired:null},R,y).newState}}}}return{...a,actionRequired:null}}const f=mc(a,a.actionRequired,l);if(f.type==="skip"){const y=c.skipAction(a),v=a.phase==="start"?d.continueTurnAfterStartPhaseAction(y):d.processEndOfAction(y);return!v.actionRequired&&v.turn==="opponent"&&!v.winner&&setTimeout(()=>{vn(v,n,l,c,i,d,u)},500),v}if(f.type==="resolveControlMechanicPrompt"&&h.type==="prompt_use_control_mechanic"){const{choice:y}=f,{originalAction:v,actor:_}=h;if(y==="skip"){let w=ae(a,_,"Opponent skips rearranging protocols.");if(w.actionRequired=null,w={...w,_logIndentLevel:0},v.type==="compile"){const b=v.laneIndex;return setTimeout(()=>{n(N=>{const S=c.compileLane(N,b);return S.winner?S:{...d.processEndOfAction(S),animationState:null}})},1e3),{...w,animationState:{type:"compile",laneIndex:b},compilableLanes:[]}}else if(v.type==="fill_hand"){const b=c.fillHand(w,_);return d.processEndOfAction(b)}else return d.processEndOfAction(w)}else{const w=y;let S=ae(a,_,`Opponent chooses to rearrange ${w==="opponent"?"the player's":"their own"} protocols.`);return S.actionRequired={type:"prompt_rearrange_protocols",sourceCardId:"CONTROL_MECHANIC",target:w,actor:_,originalAction:v},S}}if(f.type==="resolveOptionalDiscardCustomPrompt"&&h.type==="prompt_optional_discard_custom"){const y=c.resolveOptionalDiscardCustomPrompt(a,f.accept);return y.actionRequired?y:Ct(y,d)}if(f.type==="resolveOptionalEffectPrompt"){const y=c.resolveOptionalEffectPrompt(a,f.accept);return y.actionRequired?y:Ct(y,d)}if(f.type==="resolvePrompt"&&h.type==="prompt_optional_shuffle_trash"){if(!f.accept){let v={...a};return v.actionRequired=null,v=ae(v,h.actor,`${h.actor==="player"?"Player":"Opponent"} skips shuffling trash into deck.`),Ct(v,d)}const y=em(a,h.actor,"Clarity-4");return Ct(y.newState,d)}if(f.type==="resolveSwapProtocols"&&h.type==="prompt_swap_protocols"){const y=c.resolveSwapProtocols(a,f.indices);return Ct(y,d)}if(f.type==="resolveCustomChoice"&&h.type==="custom_choice"){const y=c.resolveCustomChoice(a,f.optionIndex);return y.actionRequired?y:Ct(y,d)}if(f.type==="resolveRevealBoardCardPrompt"&&(h.type==="prompt_shift_or_flip_revealed_card"||h.type==="prompt_shift_or_flip_board_card_custom")){const y=Fd(a,f.choice);return y.actionRequired?y:Ct(y,d)}if(f.type==="rearrangeProtocols"&&h.type==="prompt_rearrange_protocols"){u&&h.sourceCardId==="CONTROL_MECHANIC"&&h.actor&&u(h.actor);const y=c.resolveRearrangeProtocols(a,f.newOrder);return Ct(y,d)}if(f.type==="selectLane"){const{nextState:y,requiresAnimation:v}=Td(a,f.laneIndex);if(v){const{animationRequests:_,onCompleteCallback:w}=v;return i(_,()=>{n(b=>{const N={...b,animationState:null};return w(N,S=>{const k={...S,animationState:null},j={...a.phase==="start"?d.continueTurnAfterStartPhaseAction(k):d.processEndOfAction(k),animationState:null};return!j.actionRequired&&j.turn==="opponent"&&!j.winner?setTimeout(()=>{vn(j,n,l,c,i,d,u)},500):j.actionRequired&&j.turn==="opponent"&&setTimeout(()=>{vn(j,n,l,c,i,d,u)},300),j})})}),y}return Ct(y,d)}if(f.type==="flipCard"||f.type==="deleteCard"||f.type==="returnCard"||f.type==="shiftCard"){const{nextState:y,requiresAnimation:v,requiresTurnEnd:_}=Ad(a,f.cardId);if(v){const{animationRequests:w,onCompleteCallback:b}=v;return i(w,()=>{n(N=>{const S={...N,animationState:null};return b(S,k=>{const C={...k,animationState:null};if(C.queuedActions&&C.queuedActions.length>0){const j=d.processEndOfAction(C);return j.actionRequired?(vn(j,n,l,c,i,d),{...j,animationState:null}):{...j,animationState:null}}if(C.actionRequired)return vn(C,n,l,c,i,d),C;if(C.phase==="start"){const R={...d.continueTurnAfterStartPhaseAction(C),animationState:null};return!R.actionRequired&&R.turn==="opponent"&&!R.winner&&setTimeout(()=>{vn(R,n,l,c,i,d,u)},500),R}else return{...d.processEndOfAction(C),animationState:null}})})}),y}return _||y.queuedActions&&y.queuedActions.length>0?Ct(y,d):y}if(f.type==="playCard"&&h.type==="select_card_from_hand_to_play")return fm(a,f,n,l,c,i,d,!0);if(f.type==="discardCards"&&h.type==="discard"){const v=h.variableCount===!0?f.cardIds.length:h.count,_=f.cardIds.slice(0,v);_.length!==f.cardIds.length&&console.warn(`[AI Manager] Fixed discard count: AI wanted ${f.cardIds.length} but action.count=${h.count}`);const w=c.discardCards(a,_,"opponent");return w.actionRequired?w:Ct(w,d)}if(f.type==="giveCard"&&h.type==="select_card_from_hand_to_give"){const y=c.resolveActionWithHandCard(a,f.cardId);return y.actionRequired?y:Ct(y,d)}if(f.type==="revealCard"&&h.type==="select_card_from_hand_to_reveal")return c.resolveActionWithHandCard(a,f.cardId);if(f.type==="selectRevealedDeckCard"&&h.type==="select_card_from_revealed_deck"){const y=lm(a,f.cardId);return Ct(y,d)}console.warn(`AI has no logic for mandatory action, clearing it: ${h.type}`);const m={...a,actionRequired:null};return Ct(m,d)},vn=(a,n,l,c,i,d,u)=>{n(h=>{if(h.turn!=="opponent"||h.winner||h.animationState||!["start","compile","action","hand_limit","end"].includes(h.phase))return h;if(h.actionRequired){const y=h.actionRequired;let v=!1;if((y.type==="discard"&&y.actor==="player"||y.type==="plague_4_opponent_delete"&&y.actor==="opponent"||"actor"in y&&y.actor==="player")&&(v=!0),v)return h}let m={...h};if(m.actionRequired&&m.actionRequired.type==="reveal_opponent_hand"){const y=c.revealOpponentHand(m);return d.processEndOfAction(y)}if(m.phase==="start"&&(m=d.processStartOfTurn(m)),m.actionRequired){const y=F0(m,n,l,c,i,d,u);return!y.actionRequired&&y.turn==="opponent"&&!y.winner&&y.phase!=="hand_limit"&&setTimeout(()=>{vn(y,n,l,c,i,d,u)},300),y}if(m.phase==="compile"&&m.compilableLanes.length>0){const y=mc(m,null,l);if(y.type==="compile"){const v=y.laneIndex,_=rm(m);return _.actionRequired?_:(setTimeout(()=>{n(w=>{const b=c.compileLane(w,v);return b.winner?b:{...d.processEndOfAction(b),animationState:null}})},1e3),{..._,animationState:{type:"compile",laneIndex:v},compilableLanes:[]})}}if(m.phase==="action"){const y=mc(m,null,l);if(y.type==="fillHand"){const v=om(m,"opponent");return v.actionRequired?v:d.processEndOfAction(v)}if(y.type==="playCard"){const{newState:v,animationRequests:_}=c.playCard(m,y.cardId,y.laneIndex,y.isFaceUp,"opponent"),w={...v,animationState:{type:"playCard",cardId:y.cardId,owner:"opponent"}};return setTimeout(()=>{const b=()=>{n(N=>{let S={...N},k={newState:S};if(!S.actionRequired){if(S.queuedEffect){const{card:F,laneIndex:L}=S.queuedEffect,U={cardOwner:"opponent",actor:"opponent",currentTurn:S.turn,opponent:"player",triggerType:"play"};k=Zl(F,L,S,U),k.newState.queuedEffect=void 0}}const C=k.animationRequests,j=k.newState,R=()=>{n(F=>{if(F.queuedActions&&F.queuedActions.length>0){const L=d.processEndOfAction(F);return L.actionRequired&&vn(L,n,l,c,i,d),L}return F.actionRequired?(vn(F,n,l,c,i,d),F):d.processEndOfAction(F)})};if(C&&C.length>0)return i(C,R),j;if(j.queuedActions&&j.queuedActions.length>0){const F=d.processEndOfAction(j);return F.actionRequired&&vn(F,n,l,c,i,d),F}return j.actionRequired?(vn(j,n,l,c,i,d),j):d.processEndOfAction(j)})};n(N=>{const S={...N,animationState:null};return _&&_.length>0?i(_,b):b(),S})},500),w}}return m.phase==="end"||m.phase==="hand_limit"?d.continueTurnProgression(m):d.processEndOfAction(m)})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function q0(a,n){let l=null,c=null;const i=["player","opponent"];for(const y of i){for(const v of a[y].lanes){const _=v.find(w=>w.id===n);if(_){l=y,c=_;break}}if(l)break}if(!l||!c)return console.error("Card to delete not found on board:",n),a;const d={...a},u={...d[l]};u.lanes=u.lanes.map(y=>y.filter(v=>v.id!==n));const{id:h,isFaceUp:f,...m}=c;return u.discard=[...u.discard,m],d[l]=u,d}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const $0=(a,n,l,c,i,d="player",u)=>{const[h,f]=re.useState(()=>{const W=Hl(a,n,i,d);return we(W)}),[m,y]=re.useState(null),v=re.useRef(!1),_=re.useRef(0);re.useEffect(()=>{h.turn!==d&&h.log.length<=4&&f(W=>{const G=d==="player"?"Player":"Opponent",H=[...W.log];return H.length>0&&(H[H.length-1]={player:"player",message:`${G} goes first.`}),{...W,turn:d,log:H}})},[d,h.turn,h.log.length]);const w=re.useCallback(W=>{switch(W){case"start":return Zh;case"end":return Lr;default:return Hr}},[]),b=re.useCallback((W,G)=>{const H=B=>{if(B.length===0){G();return}const[ee,...de]=B;ee.type==="delete"?(f(J=>({...J,animationState:{type:"deleteCard",cardId:ee.cardId,owner:ee.owner}})),setTimeout(()=>{f(J=>{if(!(J.player.lanes.flat().some(ye=>ye.id===ee.cardId)||J.opponent.lanes.flat().some(ye=>ye.id===ee.cardId)))return{...J,animationState:null};let fe=q0(J,ee.cardId);return fe=we(fe),{...fe,animationState:null}}),setTimeout(()=>{de.length>0?H(de):G()},10)},500)):ee.type==="return"?(f(J=>({...J,animationState:{type:"returnCard",cardId:ee.cardId,owner:ee.owner}})),setTimeout(()=>{f(J=>{const pe=J[ee.owner].lanes.findIndex(Le=>Le.some(at=>at.id===ee.cardId)),fe=pe!==-1&&J[ee.owner].lanes[pe].length>0&&J[ee.owner].lanes[pe][J[ee.owner].lanes[pe].length-1].id===ee.cardId,ye=J[ee.owner].lanes.flat().find(Le=>Le.id===ee.cardId);if(!ye)return{...J,animationState:null};const ke=J[ee.owner].lanes.map(Le=>Le.filter(at=>at.id!==ee.cardId));let Ve={...J,[ee.owner]:{...J[ee.owner],lanes:ke,hand:[...J[ee.owner].hand,ye]}};return Ve=we(Ve),fe&&pe!==-1&&Ve[ee.owner].lanes[pe].length>0&&(Ve=An(Ve,ee.owner,pe).newState),{...Ve,animationState:null}}),setTimeout(()=>{de.length>0?H(de):G()},10)},500)):ee.type==="play"?(f(J=>({...J,animationState:{type:"playCard",cardId:ee.cardId,owner:ee.owner}})),setTimeout(()=>{f(J=>({...J,animationState:null})),setTimeout(()=>{de.length>0?H(de):G()},10)},500)):ee.type==="draw"?(f(J=>({...J,animationState:{type:"draw",player:ee.player,count:ee.count}})),setTimeout(()=>{f(J=>({...J,animationState:null})),setTimeout(()=>{de.length>0?H(de):G()},10)},500)):setTimeout(()=>{de.length>0?H(de):G()},10)};H(W)},[]),N=(W,G,H="player")=>{if(!m||h.turn!=="player"||h.phase!=="action")return;const B=m;y(null),f(ee=>{const de=w(ee.phase),{newState:J,animationRequests:pe}=fc(ee,B,W,G,"player",H),fe={...J,animationState:{type:"playCard",cardId:B,owner:"player"}};return setTimeout(()=>{f(ye=>{let ke={...ye,animationState:null};return pe&&pe.length>0?(b(pe,()=>{f(Ve=>de(Ve))}),ke):ke.actionRequired?ke:de(ke)})},500),fe})},S=()=>{h.turn!=="player"||h.phase!=="action"||h.actionRequired||f(W=>{const G=w(W.phase),H=om(W,"player");return H.actionRequired?H:G(H)})},k=re.useCallback(W=>{f(G=>{var H;return((H=G.actionRequired)==null?void 0:H.type)!=="discard"||G.actionRequired.actor!=="player"?G:{...G,animationState:{type:"discardCard",owner:"player",cardIds:[W],originalAction:G.actionRequired}}})},[]),C=re.useCallback(W=>{f(G=>{if(G.winner||G.phase!=="compile")return G;const H=w(G.phase),ee={...rm(G),animationState:{type:"compile",laneIndex:W},compilableLanes:[]};return setTimeout(()=>{f(de=>{var ye;const J=Gl(de,W,l);if(J.winner)return J;if(((ye=J.actionRequired)==null?void 0:ye.type)==="prompt_use_control_mechanic")return{...J,animationState:null};const pe=J._compileAnimations;if(pe&&pe.length>0){b(pe,()=>{f(Ve=>{const Le={...Ve};return delete Le._compileAnimations,{...H(Le),animationState:null}})});const ke={...J};return delete ke._compileAnimations,ke}return{...H(J),animationState:null}})},1e3),ee})},[l,w]),j=W=>{f(G=>{const H=G.turn,B=w(G.phase),{nextState:ee,requiresAnimation:de,requiresTurnEnd:J}=Ad(G,W);return de?(b(de.animationRequests,()=>{f(pe=>{const fe=pe.turn!==H?ye=>ye:B;return de.onCompleteCallback(pe,fe)})}),ee):ee.actionRequired?ee:B(ee)})},R=W=>{f(G=>{const H=w(G.phase),{nextState:B,requiresAnimation:ee}=Td(G,W);return ee?(b(ee.animationRequests,()=>{f(de=>ee.onCompleteCallback(de,H))}),B):B.actionRequired?B:H(B)})},F=W=>{f(G=>{const H=w(G.phase),B=Ed(G,W);return B.actionRequired?B:H(B)})},L=W=>{f(G=>b0(G,W))},U=()=>{f(W=>{var B,ee;const G=w(W.phase);let H={...W,animationState:null};return((B=H.actionRequired)==null?void 0:B.type)==="prompt_shift_or_flip_board_card_custom"?H=Fd(H,"skip"):H=Dh(H),((ee=H.actionRequired)==null?void 0:ee.type)==="plague_4_player_flip_optional"?H:G(H)})},Q=re.useCallback(W=>{f(G=>{var ee;if(((ee=G.actionRequired)==null?void 0:ee.type)!=="prompt_use_control_mechanic")return G;const{originalAction:H,actor:B}=G.actionRequired;if(W==="skip"){let de=ae(G,B,"Player skips rearranging protocols.");if(de.actionRequired=null,de={...de,_logIndentLevel:0},H.type==="compile"){const pe={...de,animationState:{type:"compile",laneIndex:H.laneIndex},compilableLanes:[]};return setTimeout(()=>{f(fe=>{const ye=Gl(fe,H.laneIndex,l);return ye.winner?ye:{...w(ye.phase)(ye),animationState:null}})},1e3),pe}else if(H.type==="continue_turn"){let J={...de};return H.queuedSpeed2Actions&&H.queuedSpeed2Actions.length>0&&(J.queuedActions=[...H.queuedSpeed2Actions,...J.queuedActions||[]]),w(J.phase)(J)}else if(H.type==="resume_interrupted_turn"){let J={...de};return J._interruptedTurn=H.interruptedTurn,J._interruptedPhase=H.interruptedPhase,H.queuedSpeed2Actions&&H.queuedSpeed2Actions.length>0&&(J.queuedActions=[...H.queuedSpeed2Actions,...J.queuedActions||[]]),Hr(J)}else{const J=Xl(de,B);return w(J.phase)(J)}}else{const de=W;let fe=ae(G,B,`${B==="player"?"Player":"Opponent"} chooses to rearrange ${de==="player"?"their own":"the opponent's"} protocols.`);return fe.actionRequired={type:"prompt_rearrange_protocols",sourceCardId:"CONTROL_MECHANIC",target:de,actor:B,originalAction:H},fe}})},[l,w]),X=re.useCallback(W=>{f(G=>{const H=w(G.phase),B=Ih(G,W);return B.actionRequired?B:H(B)})},[w]),V=re.useCallback(W=>{f(G=>{var H;return((H=G.actionRequired)==null?void 0:H.type)!=="plague_2_player_discard"?G:{...G,animationState:{type:"discardCard",owner:"player",cardIds:W,originalAction:G.actionRequired}}})},[]),$=re.useCallback(W=>{f(G=>{const H=w(G.phase),B=Uh(G,W,"player");return H(B)})},[w]),E=re.useCallback(W=>{f(G=>{const H=w(G.phase),B=Ph(G,W);return W?B:H(B)})},[w]),A=re.useCallback(W=>{f(G=>{const H=w(G.phase),B=Dd(G,W);return B.actionRequired?B:H(B)})},[w]),O=re.useCallback(W=>{f(G=>{var ee,de,J;const H=((ee=G.actionRequired)==null?void 0:ee.type)==="select_cards_from_hand_to_discard_for_fire_4",B=((de=G.actionRequired)==null?void 0:de.type)==="discard"&&((J=G.actionRequired)==null?void 0:J.variableCount);return!H&&!B?G:{...G,animationState:{type:"discardCard",owner:"player",cardIds:W,originalAction:G.actionRequired}}})},[]),I=re.useCallback(W=>{f(G=>{var H;return((H=G.actionRequired)==null?void 0:H.type)!=="select_cards_from_hand_to_discard_for_hate_1"?G:{...G,animationState:{type:"discardCard",owner:"player",cardIds:W,originalAction:G.actionRequired}}})},[]),T=re.useCallback(W=>{f(G=>{const H=w(G.phase),B=Fd(G,W);return B.actionRequired?B:H(B)})},[w]),q=re.useCallback(W=>{f(G=>{var ee,de;u&&((ee=G.actionRequired)==null?void 0:ee.sourceCardId)==="CONTROL_MECHANIC"&&((de=G.actionRequired)!=null&&de.actor)&&u(G.actionRequired.actor);const H=w(G.phase),B=Sd(G,W,l);return B.winner?B:H(B)})},[w,l,u]),Y=re.useCallback(W=>{f(G=>{const H=w(G.phase),B=qd(G,W);return B.actionRequired?B:H(B)})},[w]),K=re.useCallback(W=>{f(G=>{const H=w(G.phase),B=Lh(G,W,l);return B.winner?B:H(B)})},[w,l]),P=re.useCallback(W=>{f(G=>{const H=w(G.phase),B=lm(G,W);return B.winner?B:H(B)})},[w]),Z=re.useCallback(W=>{v.current=!1,_.current++,f(G=>{if(typeof W=="function")return W(G);const H=W;if(H==="speed-0-interrupt"){const B=["Speed","Life","Water"],ee=["Metal","Death","Hate"];let de=Nn(Pa(B)),J=Nn(Pa(ee));const pe=(qe,_t,Ft)=>{const He=qe.findIndex($e=>$e.protocol===_t&&$e.value===Ft);return He>-1?qe.splice(He,1)[0]:Rn.find($e=>$e.protocol===_t&&$e.value===Ft)},fe=pe(de,"Speed",0),ye=pe(J,"Metal",0),ke=pe(de,"Speed",1),Ve=pe(de,"Life",1),Le=pe(de,"Water",1),at=pe(de,"Speed",3);let Te=Hl(B,ee,i,d);return Te.player.lanes=[[],[],[]],Te.player.lanes[0]=[{...fe,id:Xe(),isFaceUp:!1}],Te.player.hand=[{...ke,id:Xe(),isFaceUp:!0},{...Ve,id:Xe(),isFaceUp:!0},{...Le,id:Xe(),isFaceUp:!0},{...at,id:Xe(),isFaceUp:!0}],Te.player.deck=de,Te.player.discard=[],Te.opponent.lanes=[[],[],[]],Te.opponent.hand=[{...ye,id:Xe(),isFaceUp:!0}],Te.opponent.deck=J,Te.opponent.discard=[],Te.turn="opponent",Te.phase="start",Te.actionRequired=null,Te.queuedActions=[],Te=we(Te),Te=ae(Te,"player","DEBUG: Dynamic Speed-0 interrupt scenario set up. AI will play Metal-0."),Te}else if(H==="speed-1-trigger"){const B=["Speed","Life","Water"],ee=["Metal","Death","Hate"];let de=Nn(Pa(B));const J=Nn(Pa(ee)),fe=((Le,at,Te)=>{const qe=Le.findIndex(_t=>_t.protocol===at&&_t.value===Te);return qe>-1?Le.splice(qe,1)[0]:Rn.find(_t=>_t.protocol===at&&_t.value===Te)})(de,"Speed",1);let ye=Hl(B,ee,i,d);ye.player.lanes=[[],[],[]],ye.player.lanes[0]=[{...fe,id:Xe(),isFaceUp:!0}];const{drawnCards:ke,remainingDeck:Ve}=Hn(de,[],6);return ye.player.hand=ke.map(Le=>({...Le,id:Xe(),isFaceUp:!0})),ye.player.deck=Ve,ye.player.discard=[],ye.opponent.lanes=[[],[],[]],ye.opponent.hand=[],ye.opponent.deck=J,ye.opponent.discard=[],ye.turn="player",ye.phase="hand_limit",ye.actionRequired={type:"discard",actor:"player",count:1},ye.queuedActions=[],ye=we(ye),ye=ae(ye,"player","DEBUG: Speed-1 discard trigger scenario set up."),ye}else if(H==="fire-oncover-test"){const B=["Death","Hate","Water"],ee=["Fire","Plague","Metal"],de=Nn(Pa(B));let J=Nn(Pa(ee));const pe=(qe,_t,Ft)=>{const He=qe.findIndex($e=>$e.protocol===_t&&$e.value===Ft);return He>-1?qe.splice(He,1)[0]:Rn.find($e=>$e.protocol===_t&&$e.value===Ft)},fe=pe(J,"Fire",0),ye=pe(J,"Fire",2),ke=pe(J,"Fire",3),Ve=Rn.find(qe=>qe.protocol==="Death"&&qe.value===1),Le=Rn.find(qe=>qe.protocol==="Hate"&&qe.value===2),at=Rn.find(qe=>qe.protocol==="Water"&&qe.value===3);let Te=Hl(B,ee,i,"opponent");return Te.player.lanes=[[{...Ve,id:Xe(),isFaceUp:!0}],[{...Le,id:Xe(),isFaceUp:!0}],[{...at,id:Xe(),isFaceUp:!0}]],Te.player.hand=[],Te.player.deck=de,Te.player.discard=[],Te.opponent.lanes=[[{...fe,id:Xe(),isFaceUp:!0}],[],[]],Te.opponent.hand=[{...ke,id:Xe(),isFaceUp:!0},{...ye,id:Xe(),isFaceUp:!0}],Te.opponent.deck=J,Te.opponent.discard=[],Te.turn="opponent",Te.phase="action",Te.actionRequired=null,Te.queuedActions=[],Te=we(Te),Te=ae(Te,"opponent","DEBUG: Fire On-Cover test scenario. Opponent has Fire-0 in play, Fire-3 and Fire-2 in hand. Ready to play Fire-3."),Te}else if(H==="speed-2-control-test"){const B=["Speed","Light","Water"],ee=["Fire","Plague","Metal"],de=Nn(Pa(B)),J=Nn(Pa(ee)),fe=((ke,Ve,Le)=>{const at=ke.findIndex(Te=>Te.protocol===Ve&&Te.value===Le);return at>-1?ke.splice(at,1)[0]:Rn.find(Te=>Te.protocol===Ve&&Te.value===Le)})(de,"Speed",2);let ye=Hl(B,ee,!0,"player");return ye.player.lanes=[[{...fe,id:Xe(),isFaceUp:!0}],[],[]],ye.player.protocols[0]="Speed",ye.player.laneValues[0]=10,ye.player.hand=[],ye.player.deck=de,ye.player.discard=[],ye.controlCardHolder="player",ye.opponent.lanes=[[],[],[]],ye.opponent.hand=[],ye.opponent.deck=J,ye.opponent.discard=[],ye.turn="player",ye.phase="compile",ye.compilableLanes=[0],ye.actionRequired=null,ye.queuedActions=[],ye=we(ye),ye=ae(ye,"player","DEBUG: Speed-2 + Control test scenario. Player has Speed-2 (value 10), Control Component active. Ready to compile Protocol Speed!"),ye}return G})},[i]);return re.useEffect(()=>{const W=h.animationState;if(!W)return;let G=0,H=!1;if(W.type==="flipCard"?(G=600,H=!0):W.type==="drawCard"?(G=1e3,H=!0):W.type==="discardCard"&&(G=800,H=!0),H){const B=setTimeout(()=>{f(ee=>({...ee,animationState:null}))},G);return()=>clearTimeout(B)}},[h.animationState]),re.useEffect(()=>{const W=h.animationState;if((W==null?void 0:W.type)==="discardCard"&&W.owner==="player"){const G=setTimeout(()=>{f(H=>{const B=H.animationState;if((B==null?void 0:B.type)!=="discardCard"||!B.originalAction)return H;const{cardIds:ee,originalAction:de}=B,J=w(H.phase);let pe;return de.type==="plague_2_player_discard"?pe=C0(H,ee):de.type==="select_cards_from_hand_to_discard_for_fire_4"?pe=Th(H,ee):de.type==="select_cards_from_hand_to_discard_for_hate_1"?pe=bd(H,ee):pe=Go(H,ee,"player"),pe.animationState=null,pe.actionRequired?pe:J(pe)})},500);return()=>clearTimeout(G)}},[h.animationState,w]),re.useEffect(()=>{if(h.turn==="opponent"&&!h.winner&&!h.animationState&&!h._interruptedTurn&&!v.current){v.current=!0;const W=_.current,G=h,H=setTimeout(()=>{_.current===W&&vn(G,f,c,{compileLane:(B,ee)=>Gl(B,ee,l),playCard:fc,fillHand:Xl,discardCards:Go,flipCard:qh,deleteCard:(B,ee)=>({newState:B,animationRequests:[{type:"delete",cardId:ee,owner:"opponent"}]}),returnCard:$h,skipAction:Dh,resolveOptionalDrawPrompt:Ih,resolvePlague4Flip:(B,ee)=>Uh(B,ee,"opponent"),resolvePlague2Discard:Cd,resolvePlague2OpponentDiscard:Cd,resolveOptionalDiscardCustomPrompt:Ph,resolveOptionalEffectPrompt:Dd,resolveFire4Discard:Th,resolveHate1Discard:bd,resolveRearrangeProtocols:(B,ee)=>Sd(B,ee,l),resolveActionWithHandCard:Ed,resolveSwapProtocols:(B,ee)=>Lh(B,ee,l),revealOpponentHand:Fh,resolveCustomChoice:qd},b,jh,u)},1500);return()=>{clearTimeout(H),v.current=!1}}},[h.turn,h.phase,h.winner,h.animationState,h._interruptedTurn,c,l,b,h.actionRequired]),re.useEffect(()=>{const W=h.actionRequired,G=h.turn==="player"||h._interruptedTurn==="player",H=W&&"actor"in W&&W.actor==="opponent";G&&!h.animationState&&H&&!v.current&&(v.current=!0,D0(h,f,c,{playCard:fc,discardCards:Go,flipCard:qh,returnCard:$h,deleteCard:(ee,de)=>({newState:ee,animationRequests:[{type:"delete",cardId:de,owner:"opponent"}]}),resolveActionWithHandCard:Ed,resolveHate1Discard:bd,resolvePlague2OpponentDiscard:Cd,revealOpponentHand:Fh,resolveRearrangeProtocols:(ee,de)=>Sd(ee,de,l)},jh,b,Ad,Td,u),v.current=!1)},[h.actionRequired,h.turn,h.animationState,c,b,l]),re.useEffect(()=>{f(W=>{let G=we(W);return G.turn==="player"&&G.phase==="start"&&!G.actionRequired?Kh(G):G})},[h.turn,h.phase]),{gameState:h,selectedCard:m,setSelectedCard:y,playSelectedCard:N,fillHand:S,discardCardFromHand:k,compileLane:C,resolveActionWithCard:j,resolveActionWithLane:R,selectHandCardForAction:L,skipAction:U,resolvePlague2Discard:V,resolveActionWithHandCard:F,resolvePlague4Flip:$,resolveOptionalDiscardCustomPrompt:E,resolveOptionalEffectPrompt:A,resolveFire4Discard:O,resolveHate1Discard:I,resolveRevealBoardCardPrompt:T,resolveRearrangeProtocols:q,resolveOptionalDrawPrompt:X,resolveSwapProtocols:K,resolveControlMechanicPrompt:Q,resolveCustomChoice:Y,resolveSelectRevealedDeckCard:P,setupTestScenario:Z}},zh=({cards:a,isPlayable:n,isCompilable:l,isShiftTarget:c,isEffectTarget:i,isMatching:d,onLanePointerDown:u,onPlayFaceDown:h,onCardPointerDown:f,onCardPointerEnter:m,onCardPointerLeave:y,owner:v,animationState:_,isCardTargetable:w,laneIndex:b,sourceCardId:N,gameState:S})=>{const k=["lane"];return n&&k.push("playable"),d&&k.push("matching-protocol"),l&&k.push("compilable"),c&&k.push("shift-target"),i&&k.push("effect-target"),o.jsxs("div",{className:k.join(" "),onPointerDown:u,children:[n&&d&&v==="player"&&h&&o.jsx("button",{className:"btn btn-play-facedown",onPointerDown:C=>{C.stopPropagation(),h()},children:"Play Face-Down"}),o.jsx("div",{className:"lane-stack",children:a.map((C,j)=>{var L;const R=((L=S.actionRequired)==null?void 0:L.type)==="prompt_shift_or_flip_for_light_2"&&S.actionRequired.revealedCardId===C.id,F=ea(C,a,S,b,v);return o.jsx(kt,{card:C,isFaceUp:C.isFaceUp||R,style:{"--i":j},onPointerDown:U=>{U.stopPropagation(),f(C)},onPointerEnter:()=>m(C),animationState:_,isTargetable:w(C),isSourceOfEffect:C.id===N,faceDownValue:F},C.id)})})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const mo=(a,n)=>xo(a,n),Mn=(a,n)=>_n(a).some(({rule:c,laneIndex:i})=>c.type==="block_shifts_from_and_to_lane"&&i===n),yc=(a,n)=>{const{actionRequired:l}=n;if(!l||"actor"in l&&l.actor!=="player")return!1;let c=null,i=-1,d=[];for(const f of["player","opponent"]){for(let m=0;m<n[f].lanes.length;m++)if(n[f].lanes[m].some(y=>y.id===a.id)){c=f,i=m,d=n[f].lanes[m];break}if(c)break}if(!c)return!1;const u=d.findIndex(f=>f.id===a.id),h=wo(n,d,u);if(l.type==="select_lane_for_shift"){const f=l.cardToShiftId;return!!(f&&a.id===f)}if(l.type==="shift_flipped_card_optional"){const f=l.cardId;return!!(f&&a.id===f)}switch(l.type){case"select_opponent_face_up_card_to_flip":return c==="opponent"&&a.isFaceUp&&h;case"select_card_to_flip":{if(mo(n,a.id))return!1;const f=l.targetFilter||{},m=d.findIndex(N=>N.id===a.id),y=l.currentLaneIndex,v=l.laneIndex,_=l.scope;if(y!==void 0&&i!==y||_==="this_lane"&&v!==void 0&&i!==v)return!1;const w=f.position||"uncovered";return!(w==="uncovered"&&!h||w==="covered"&&m>=d.length-1||f.owner==="own"&&c!==l.actor||f.owner==="opponent"&&c===l.actor||f.faceState==="face_up"&&!a.isFaceUp||f.faceState==="face_down"&&a.isFaceUp||f.excludeSelf&&a.id===l.sourceCardId||!Yl(n,a.id).allowed)}case"select_own_face_up_covered_card_to_flip":{const f=d.findIndex(m=>m.id===a.id);return c==="player"&&a.isFaceUp&&f<d.length-1}case"select_opponent_covered_card_to_shift":{const f=d.findIndex(y=>y.id===a.id),m=n.turn==="player"?"opponent":"player";return Mn(n,i)?!1:c===m&&f<d.length-1}case"select_own_covered_card_to_shift":{const f=d.findIndex(m=>m.id===a.id);return Mn(n,i)?!1:c===l.actor&&f<d.length-1}case"select_covered_card_in_line_to_flip_optional":{const m=d.findIndex(v=>v.id===a.id)<d.length-1;return ma(n)&&!a.isFaceUp?!1:i===l.laneIndex&&m}case"select_covered_card_to_flip_for_chaos_0":{const m=d.findIndex(v=>v.id===a.id)<d.length-1;return ma(n)&&!a.isFaceUp?!1:i===l.laneIndex&&m}case"shift_flipped_card_optional":return Mn(n,i)?!1:a.id===l.cardId;case"select_opponent_card_to_flip":return ma(n)&&!a.isFaceUp?!1:c==="opponent"&&h;case"select_face_down_card_to_shift_for_darkness_4":return Mn(n,i)?!1:!a.isFaceUp&&h;case"select_cards_to_delete":{if(mo(n,a.id)||l.disallowedIds.includes(a.id))return!1;const f=l.allowedIds;if(f&&!f.includes(a.id))return!1;const m=l.currentLaneIndex;if(m!==void 0&&i!==m)return!1;const y=l.targetFilter;if(y){const v=d.findIndex(k=>k.id===a.id),_=y.position||"uncovered";if(_==="uncovered"&&!h||_==="covered"&&v>=d.length-1||y.faceState==="face_up"&&!a.isFaceUp||y.faceState==="face_down"&&a.isFaceUp)return!1;if(y.valueRange){const{min:k,max:C}=y.valueRange;if(a.value<k||a.value>C)return!1}const w=l.actorChooses,b=l.sourceCardId;let N=null;for(const k of["player","opponent"])if(n[k].lanes.flat().some(C=>C.id===b)){N=k;break}if(w==="card_owner"&&N){if(y.owner==="own"&&c!==N||y.owner==="opponent"&&c===N)return!1}else if(y.owner==="own"&&c!==l.actor||y.owner==="opponent"&&c===l.actor)return!1;const S=l.protocolMatching;if(S){const k=n.player.protocols[i],C=n.opponent.protocols[i],j=a.protocol,R=j===k||j===C;if(S==="must_match"&&!R||S==="must_not_match"&&R)return!1}return!0}return h}case"select_face_down_card_to_delete":return!a.isFaceUp&&h;case"select_low_value_card_to_delete":return a.isFaceUp&&(a.value===0||a.value===1)&&h;case"select_card_from_other_lanes_to_delete":{if(mo(n,a.id))return!1;const{disallowedLaneIndex:f,lanesSelected:m}=l;return i!==f&&!m.includes(i)&&h}case"plague_4_opponent_delete":return(n.turn==="player"?"opponent":"player")==="player"?c==="player"&&!a.isFaceUp&&h:!1;case"select_any_other_card_to_flip":return ma(n)&&!a.isFaceUp?!1:a.id!==l.sourceCardId&&h;case"select_card_to_return":{if(mo(n,a.id))return!1;const f=l.targetOwner||"any",m=l.targetFilter,y=l.actor,v=(m==null?void 0:m.position)||"uncovered",w=d.findIndex(b=>b.id===a.id)<d.length-1;return v==="uncovered"&&!h||v==="covered"&&!w?!1:f==="own"?c===y:f==="opponent"?c!==y:!0}case"select_card_to_shift_for_gravity_1":return mo(n,a.id)||Mn(n,i)?!1:h;case"select_face_down_card_to_shift_for_gravity_4":return Mn(n,i)?!1:!a.isFaceUp&&i!==l.targetLaneIndex&&h;case"select_any_card_to_flip":case"select_any_card_to_flip_optional":return ma(n)&&!a.isFaceUp||!Yl(n,a.id).allowed?!1:h;case"select_any_face_down_card_to_flip_optional":return Yl(n,a.id).allowed?!a.isFaceUp&&h:!1;case"select_board_card_to_reveal_custom":{const f=l.targetFilter;if(!f)return!a.isFaceUp&&h;const m=d.findIndex(v=>v.id===a.id),y=f.position||"uncovered";return!(y==="uncovered"&&!h||y==="covered"&&m>=d.length-1||f.owner==="own"&&c!==l.actor||f.owner==="opponent"&&c===l.actor||f.faceState==="face_up"&&!a.isFaceUp||f.faceState==="face_down"&&a.isFaceUp)}case"select_own_other_card_to_shift":return Mn(n,i)?!1:c===l.actor&&a.id!==l.sourceCardId&&h;case"select_opponent_face_down_card_to_shift":return Mn(n,i)?!1:c!==l.actor&&!a.isFaceUp&&h;case"select_any_opponent_card_to_shift":return Mn(n,i)?!1:c!==l.actor&&h;case"select_opponent_card_to_return":return c==="opponent"&&h;case"select_card_to_shift_for_anarchy_1":return mo(n,a.id)||Mn(n,i)?!1:h;case"select_card_to_shift_for_anarchy_0":return mo(n,a.id)||Mn(n,i)?!1:h;case"select_card_to_shift":{if(mo(n,a.id)||Mn(n,i))return!1;const f=l.targetFilter||{},m=l.destinationRestriction,y=l.scope,v=l.sourceLaneIndex;if(y==="this_lane"&&v!==void 0&&i!==v||(m==null?void 0:m.type)==="non_matching_protocol"&&!a.isFaceUp)return!1;const _=f.position||"uncovered",b=d.findIndex(N=>N.id===a.id)<d.length-1;return!(_==="uncovered"&&!h||_==="covered"&&!b||f.owner==="own"&&c!==l.actor||f.owner==="opponent"&&c===l.actor||f.faceState==="face_up"&&!a.isFaceUp||f.faceState==="face_down"&&a.isFaceUp||f.excludeSelf&&a.id===l.sourceCardId)}case"select_phase_effect":return l.availableEffects.some(m=>m.cardId===a.id);default:return!1}},I0=({gameState:a,onLanePointerDown:n,onPlayFaceDown:l,onCardPointerDown:c,onCardPointerEnter:i,onCardPointerLeave:d,onOpponentHandCardPointerEnter:u,onOpponentHandCardPointerLeave:h,selectedCardId:f,sourceCardId:m})=>{const{player:y,opponent:v,animationState:_,phase:w,turn:b,compilableLanes:N,actionRequired:S,controlCardHolder:k}=a,C=V=>{const $=w==="compile"&&b==="player"&&!S&&N.includes(V),E=b==="player",A=w==="action"&&!S&&f,O=(S==null?void 0:S.type)==="select_lane_for_play";if(!(O?(S==null?void 0:S.actor)==="player":E)||!A&&!O)return{isPlayable:!1,isMatching:!1,isCompilable:$};let T;if(A)T=y.hand.find(J=>J.id===f);else if(O){if(S.disallowedLaneIndex!==void 0&&V===S.disallowedLaneIndex)return{isPlayable:!1,isMatching:!1,isCompilable:$};const J=S.validLanes;if(J&&!J.includes(V))return{isPlayable:!1,isMatching:!1,isCompilable:$};if(S.source==="deck")return S.excludeCurrentLane&&V===S.currentLaneIndex?{isPlayable:!1,isMatching:!1,isCompilable:$}:{isPlayable:!0,isMatching:!1,isCompilable:$};T=y.hand.find(pe=>pe.id===S.cardInHandId)}if(!T)return{isPlayable:!1,isMatching:!1,isCompilable:$};const q=v.lanes[V];if(q.length>0&&q[q.length-1].isFaceUp&&q[q.length-1].protocol==="Plague"&&q[q.length-1].value===0)return{isPlayable:!1,isMatching:!1,isCompilable:$};const K=v.lanes.flat().some(J=>J.isFaceUp&&J.protocol==="Psychic"&&J.value===1),P=y.lanes.flat().some(J=>J.isFaceUp&&J.protocol==="Spirit"&&J.value===1),Z=y.lanes.some(J=>{if(J.length===0)return!1;const pe=J[J.length-1];return pe.isFaceUp&&pe.protocol==="Chaos"&&pe.value===3}),W=[...y.lanes.flat(),...v.lanes.flat()].some(J=>J.isFaceUp&&J.protocol==="Anarchy"&&J.value===1),G=vc(a),H=_c(a,"player",V),B=Wl(a,T);let ee;return B?ee=!K:W||G?ee=T.protocol!==y.protocols[V]&&T.protocol!==v.protocols[V]&&!K:ee=(P||H||Z||T.protocol===y.protocols[V]||T.protocol===v.protocols[V])&&!K,q.some(J=>J.isFaceUp&&J.protocol==="Metal"&&J.value===2)&&!ee?{isPlayable:!1,isMatching:!1,isCompilable:$}:O&&(S.isFaceDown||S.faceDown)?{isPlayable:!0,isMatching:!1,isCompilable:$}:{isPlayable:!0,isMatching:ee,isCompilable:$}},j=V=>{if(!(b==="player")||!(w==="action"&&!S&&f))return{isPlayable:!1,isMatching:!1};const A=y.hand.find(T=>T.id===f);if(!A)return{isPlayable:!1,isMatching:!1};if(!Wl(a,A))return{isPlayable:!1,isMatching:!1};const O=y.lanes[V];return O.length>0&&O[O.length-1].isFaceUp&&O[O.length-1].protocol==="Plague"&&O[O.length-1].value===0?{isPlayable:!1,isMatching:!1}:{isPlayable:!0,isMatching:!0}},R=V=>{if(!S||S.actor!=="player")return!1;switch(S.type){case"select_lane_for_delete":{const $=S.validLanes;return!($&&!$.includes(V))}case"select_lane_for_death_2":case"select_lane_for_water_3":case"select_lane_for_return":return!0;case"select_lane_for_metal_3_delete":return V===S.disallowedLaneIndex?!1:y.lanes[V].length+v.lanes[V].length>=8;case"select_lane_for_delete_all":return(S.validLanes||[]).includes(V);default:return!1}},F=(V,$)=>{if(!S||S.actor!=="player")return!1;const E=S.type==="select_lane_for_shift"?S.originalLaneIndex:(S.type==="select_card_to_shift",-1);if(E!==-1&&!Ql(a,E,V).allowed)return!1;switch(S.type){case"select_lane_for_shift":{if($!==S.cardOwner||V===S.originalLaneIndex)return!1;const A=S.validLanes;if(A&&!A.includes(V))return!1;const O=[...a.player.lanes.flat(),...a.opponent.lanes.flat()].find(T=>T.id===S.sourceCardId),I=S.destinationRestriction;if(I&&I.type==="to_or_from_this_lane"){let T=I.laneIndex;if(I.laneIndex==="current"&&O)for(const q of["player","opponent"]){for(let Y=0;Y<a[q].lanes.length;Y++)if(a[q].lanes[Y].some(K=>K.id===S.sourceCardId)){T=Y;break}if(typeof T=="number")break}if(typeof T=="number"&&!(S.originalLaneIndex===T)&&!(V===T))return!1}else if(O&&O.protocol==="Gravity"&&O.value===1){let T=-1;for(const q of["player","opponent"]){for(let Y=0;Y<a[q].lanes.length;Y++)if(a[q].lanes[Y].some(K=>K.id===S.sourceCardId)){T=Y;break}if(T!==-1)break}if(T!==-1&&!(S.originalLaneIndex===T)&&!(V===T))return!1}return!0}case"shift_flipped_card_optional":{const A=S.cardId;let O=null,I=-1;for(let T=0;T<y.lanes.length;T++)if(y.lanes[T].some(q=>q.id===A)){O="player",I=T;break}if(O===null){for(let T=0;T<v.lanes.length;T++)if(v.lanes[T].some(q=>q.id===A)){O="opponent",I=T;break}}return $!==O?!1:V!==I}case"select_lane_for_life_3_play":return $==="player"&&V!==S.disallowedLaneIndex;case"select_lane_to_shift_revealed_card_for_light_2":return $==="player";case"select_lane_to_shift_revealed_board_card_custom":{const A=S.revealedCardId;if(![...a.player.lanes.flat(),...a.opponent.lanes.flat()].find(q=>q.id===A))return!1;let I=null,T=-1;for(const q of["player","opponent"]){for(let Y=0;Y<a[q].lanes.length;Y++)if(a[q].lanes[Y].some(K=>K.id===A)){I=q,T=Y;break}if(I)break}return $===I&&V!==T}case"select_lane_for_shift_all":{const A=S.sourceLaneIndex;return V!==A}case"select_lane_to_shift_cards_for_light_3":return V!==S.sourceLaneIndex;default:return!1}},L=(V,$,E)=>{let A=[V];return $&&A.push("compiled"),(_==null?void 0:_.type)==="compile"&&_.laneIndex===E&&A.push("is-compiling"),A.join(" ")},U=()=>k==="player"?"player-controlled":k==="opponent"?"opponent-controlled":"neutral",Q=()=>k==="player"?"Player has control.":k==="opponent"?"Opponent has control.":"Control is neutral.",X=()=>k==="player"?"Control Player":k==="opponent"?"Control Opponent":"Control Neutral";return o.jsxs("div",{className:"game-board",children:[o.jsx("div",{className:"opponent-hand-area",children:v.hand.map(V=>o.jsx(kt,{card:V,isFaceUp:V.isRevealed||!1,additionalClassName:"in-hand",onPointerEnter:()=>u(V)},V.id))}),o.jsx("div",{className:`player-side opponent-side ${b==="opponent"?"active-turn":""}`,children:o.jsx("div",{className:"lanes",children:v.lanes.map((V,$)=>{const{isPlayable:E,isMatching:A}=j($);return o.jsx(zh,{cards:V,isPlayable:E,isMatching:A,isCompilable:!1,isShiftTarget:F($,"opponent"),isEffectTarget:R($),onLanePointerDown:()=>n($,"opponent"),onCardPointerDown:O=>c(O,"opponent",$),onCardPointerEnter:O=>i(O,"opponent"),onCardPointerLeave:()=>d(),owner:"opponent",animationState:_,isCardTargetable:O=>yc(O,a),laneIndex:$,sourceCardId:m,gameState:a},`opp-lane-${$}`)})})}),o.jsxs("div",{className:"protocol-bars-container",children:[a.useControlMechanic&&o.jsxs("div",{className:"control-coin-container",children:[o.jsx("div",{className:`control-coin ${U()}`,title:Q(),children:"C"}),o.jsx("div",{className:`control-coin-label ${U()}`,children:X()})]}),o.jsx("div",{className:`protocol-bar opponent-bar ${b==="opponent"?"active-turn":""}`,children:v.protocols.map((V,$)=>o.jsxs("div",{className:L("protocol-display",v.compiled[$],$),children:[o.jsx("span",{className:"protocol-name",children:V}),o.jsx("span",{className:"protocol-value",children:v.laneValues[$]})]},`opp-proto-${V}-${$}`))}),o.jsx("div",{className:`protocol-bar player-bar ${b==="player"?"active-turn":""}`,children:y.protocols.map((V,$)=>o.jsxs("div",{className:L("protocol-display",y.compiled[$],$),children:[o.jsx("span",{className:"protocol-name",children:V}),o.jsx("span",{className:"protocol-value",children:y.laneValues[$]})]},`player-proto-${V}-${$}`))})]}),o.jsx("div",{className:`player-side ${b==="player"?"active-turn":""}`,children:o.jsx("div",{className:"lanes",children:y.lanes.map((V,$)=>{const{isPlayable:E,isMatching:A,isCompilable:O}=C($);return o.jsx(zh,{cards:V,isPlayable:E,isMatching:A,isCompilable:O,isShiftTarget:F($,"player"),isEffectTarget:R($),onLanePointerDown:()=>n($,"player"),onPlayFaceDown:()=>l($),onCardPointerDown:I=>c(I,"player",$),onCardPointerEnter:I=>i(I,"player"),onCardPointerLeave:()=>d(),owner:"player",animationState:_,isCardTargetable:I=>yc(I,a),laneIndex:$,sourceCardId:m,gameState:a},`player-lane-${$}`)})})})]})},U0=({gameState:a,onFillHand:n,onSkipAction:l,onResolvePlague2Discard:c,onResolvePlague4Flip:i,onResolveFire3Prompt:d,onResolveOptionalDiscardCustomPrompt:u,onResolveOptionalEffectPrompt:h,onResolveFire4Discard:f,onResolveHate1Discard:m,onResolveRevealBoardCardPrompt:y,onResolveOptionalDrawPrompt:v,onResolveDeath1Prompt:_,onResolveLove1Prompt:w,onResolvePsychic4Prompt:b,onResolveSpirit1Prompt:N,onResolveControlMechanicPrompt:S,onResolveCustomChoice:k,selectedCardId:C,multiSelectedCardIds:j,actionRequiredClass:R})=>{const{phase:F,turn:L,actionRequired:U,player:Q,compilableLanes:X}=a,V=q=>{for(const Y of["player","opponent"])for(const K of a[Y].lanes){const P=K.find(Z=>Z.id===q);if(P)return P}return null},$=U==null?void 0:U.sourceCardId,E=$?V($):null,A=(U==null?void 0:U.actor)||L,O=A.charAt(0).toUpperCase()+A.slice(1),I=()=>{var q,Y,K,P;if(L!=="player"&&(!U||U.actor!=="player"))return o.jsx("button",{className:"btn",disabled:!0,children:"Processing..."});if((U==null?void 0:U.type)==="prompt_use_control_mechanic")return o.jsxs(o.Fragment,{children:[o.jsx("button",{className:"btn",onClick:()=>S("player"),children:"Rearrange Own"}),o.jsx("button",{className:"btn",onClick:()=>S("opponent"),children:"Rearrange Opponent's"}),o.jsx("button",{className:"btn btn-back",onClick:()=>S("skip"),children:"Skip"})]});if((U==null?void 0:U.type)==="prompt_optional_draw")return o.jsxs(o.Fragment,{children:[o.jsx("button",{className:"btn",onClick:()=>v(!0),children:"Draw"}),o.jsx("button",{className:"btn btn-back",onClick:()=>v(!1),children:"Skip"})]});if((U==null?void 0:U.type)==="prompt_death_1_effect")return o.jsxs(o.Fragment,{children:[o.jsx("button",{className:"btn",onClick:()=>_(!0),children:"Draw & Delete"}),o.jsx("button",{className:"btn btn-back",onClick:()=>_(!1),children:"Skip"})]});if((U==null?void 0:U.type)==="prompt_give_card_for_love_1")return o.jsxs(o.Fragment,{children:[o.jsx("button",{className:"btn",onClick:()=>w(!0),children:"Give 1 Card"}),o.jsx("button",{className:"btn btn-back",onClick:()=>w(!1),children:"Skip"})]});if((U==null?void 0:U.type)==="prompt_fire_3_discard")return o.jsxs(o.Fragment,{children:[o.jsx("button",{className:"btn",onClick:()=>d(!0),children:"Discard 1 Card"}),o.jsx("button",{className:"btn btn-back",onClick:()=>d(!1),children:"Skip"})]});if((U==null?void 0:U.type)==="prompt_optional_discard_custom")return o.jsxs(o.Fragment,{children:[o.jsxs("button",{className:"btn",onClick:()=>u(!0),children:["Discard ",U.count," Card(s)"]}),o.jsx("button",{className:"btn btn-back",onClick:()=>u(!1),children:"Skip"})]});if((U==null?void 0:U.type)==="prompt_optional_effect"){const Z=((Y=(q=U.effectDef)==null?void 0:q.params)==null?void 0:Y.action)||"effect",W=(P=(K=U.effectDef)==null?void 0:K.params)==null?void 0:P.count,G=W?`${Z} ${W}`:Z;return o.jsxs(o.Fragment,{children:[o.jsxs("button",{className:"btn",onClick:()=>h(!0),children:["Execute (",G,")"]}),o.jsx("button",{className:"btn btn-back",onClick:()=>h(!1),children:"Skip"})]})}if((U==null?void 0:U.type)==="prompt_spirit_1_start")return o.jsxs(o.Fragment,{children:[o.jsx("button",{className:"btn",onClick:()=>N("discard"),children:"Discard 1"}),o.jsx("button",{className:"btn btn-back",onClick:()=>N("flip"),children:"Flip Card"})]});if((U==null?void 0:U.type)==="custom_choice"){const Z=U.options||[];if(Z.length===2){const W=Z[0].params,G=Z[1].params,H=B=>B.action==="discard"?`Discard ${B.count||1}`:B.action==="flip"&&B.flipSelf?"Flip This Card":B.action==="draw"?`Draw ${B.count||1}`:B.action==="delete"&&B.deleteSelf?"Delete This Card":B.action==="delete"?`Delete ${B.count||1}`:B.action==="return"?`Return ${B.count||1}`:B.action==="shift"?"Shift":B.action||"Option";return o.jsxs(o.Fragment,{children:[o.jsx("button",{className:"btn",onClick:()=>k(0),children:H(W)}),o.jsx("button",{className:"btn btn-back",onClick:()=>k(1),children:H(G)})]})}}if((U==null?void 0:U.type)==="prompt_return_for_psychic_4")return o.jsxs(o.Fragment,{children:[o.jsx("button",{className:"btn",onClick:()=>b(!0),children:"Return Card"}),o.jsx("button",{className:"btn btn-back",onClick:()=>b(!1),children:"Skip"})]});if((U==null?void 0:U.type)==="prompt_shift_or_flip_board_card_custom")return o.jsxs(o.Fragment,{children:[o.jsx("button",{className:"btn",onClick:()=>y("shift"),children:"Shift"}),o.jsx("button",{className:"btn",onClick:()=>y("flip"),children:"Flip"}),o.jsx("button",{className:"btn btn-back",onClick:()=>y("skip"),children:"Skip"})]});if((U==null?void 0:U.type)==="discard"&&U.variableCount&&U.actor==="player")return o.jsxs("button",{className:"btn",onClick:()=>f(j),disabled:j.length<1,children:["Confirm Discard (",j.length,")"]});if((U==null?void 0:U.type)==="plague_2_player_discard"||(U==null?void 0:U.type)==="select_cards_from_hand_to_discard_for_fire_4"||(U==null?void 0:U.type)==="select_cards_from_hand_to_discard_for_hate_1"){let Z,W=0;return U.type==="plague_2_player_discard"?(Z=c,W=1):U.type==="select_cards_from_hand_to_discard_for_fire_4"?(Z=f,W=1):(Z=m,W=U.count),o.jsxs("button",{className:"btn",onClick:()=>Z(j),disabled:j.length<W,children:["Confirm Discard (",j.length,")"]})}if((U==null?void 0:U.type)==="plague_4_player_flip_optional")return o.jsxs(o.Fragment,{children:[o.jsx("button",{className:"btn",onClick:()=>i(!0),children:"Flip Plague-4"}),o.jsx("button",{className:"btn btn-back",onClick:()=>i(!1),children:"Skip"})]});if(U&&"optional"in U&&U.optional)return o.jsx("button",{className:"btn btn-back",onClick:l,children:"Skip Action"});if(U)return o.jsx("button",{className:"btn",disabled:!0,children:"Action Required"});if(F==="compile"&&X.length>0)return o.jsx("button",{className:"btn",disabled:!0,children:"Select Lane to Compile"});if(F==="action"){const Z=Q.hand.length<5,W=Q.hand.length===0,G=Ld(a,"player"),H=Z&&G.allowed;return W?o.jsx("button",{className:"btn",onClick:n,disabled:!G.allowed,title:G.allowed?void 0:G.reason,children:"Refresh (Required)"}):o.jsx("button",{className:"btn",onClick:n,disabled:!H||!!C,title:G.allowed?void 0:G.reason,children:"Refresh"})}return o.jsx("button",{className:"btn",disabled:!0,children:"Processing..."})},T=()=>{var q,Y,K,P;if(U)switch(U.type){case"discard":return U.actor==="player"?U.variableCount?"Action: Select 1 or more cards to discard":`Action: Discard ${U.count} card(s) from your hand`:"Waiting for Opponent to discard...";case"prompt_use_control_mechanic":return"Control Action: Rearrange protocols?";case"select_opponent_face_up_card_to_flip":return"Action: Select an opponent's face-up card to flip";case"select_own_face_up_covered_card_to_flip":return"Action: Select one of your face-up, covered cards to flip";case"select_opponent_covered_card_to_shift":return"Action: Select one of your opponent's covered cards to shift";case"select_own_covered_card_to_shift":return"Action: Select one of your covered cards to shift";case"select_lane_for_shift":return"Action: Select a new lane for the card";case"select_lane_for_shift_all":return"Action: Select a lane to shift all cards to";case"select_opponent_card_to_flip":return"Action: Select an opponent's card to flip";case"select_card_to_flip":{const Z=U.targetFilter||{},W=Z.owner||"any",G=Z.faceState||"any",H=Z.position||"uncovered";let B="Action: Flip ";return W==="own"?B+="one of your ":W==="opponent"?B+="an opponent's ":B+="a ",G==="face_down"?B+="face-down ":G==="face_up"&&(B+="face-up "),H==="covered"?B+="covered ":H==="uncovered"&&(B+="uncovered "),B+="card",B}case"shift_flipped_card_optional":return"Action: You may shift the card you just flipped. Select a lane or skip.";case"select_covered_card_in_line_to_flip_optional":return"Action: You may flip one of your covered cards in this lane. Select a card or skip.";case"select_card_from_hand_to_play":{const Z=U.valueFilter;return Z!==void 0?`Action: Select a card with value ${Z} from your hand to play`:"Action: Select a card from your hand to play"}case"select_lane_for_play":return"Action: Select another lane to play your card in";case"select_face_down_card_to_shift_for_darkness_4":return"Action: Select any face-down card to shift";case"select_cards_to_delete":return`Action: Select a card to delete (${U.count} remaining)`;case"select_face_down_card_to_delete":return"Action: Select a face-down card to delete";case"select_low_value_card_to_delete":return"Action: Select a card with value 0 or 1 to delete";case"select_card_from_other_lanes_to_delete":return`Action: Select a card to delete (${U.count} remaining)`;case"select_lane_for_death_2":return"Action: Select a lane to delete cards with value 1 or 2";case"select_lane_for_delete":return"Action: Select a lane";case"prompt_optional_draw":return"Optional: Draw card(s)?";case"prompt_death_1_effect":return"Start Phase: Use Death-1 effect?";case"select_card_to_delete_for_death_1":return"Action: Select a card to delete";case"delete_self":return"Deleting card...";case"prompt_give_card_for_love_1":return"End Phase: Give 1 card to draw 2?";case"select_card_from_hand_to_give":return"Action: Select a card from your hand to give";case"select_card_from_hand_to_reveal":return"Action: Select a card from your hand to reveal";case"plague_2_player_discard":return"Action: Select 1 or more cards to discard";case"plague_4_opponent_delete":return"Waiting for opponent to delete one of their face-down cards";case"plague_4_player_flip_optional":return"Action: You may flip Plague-4";case"select_any_other_card_to_flip":return"Action: Select any other card to flip";case"select_card_to_return":{const Z=U.targetFilter||{},W=U.targetOwner||Z.owner||"any",G=Z.position||"uncovered";let H="Action: Select ";return W==="own"?H+="one of your ":W==="opponent"?H+="an opponent's ":H+="a ",G==="any"?H+="covered or uncovered ":G==="covered"&&(H+="covered "),H+="card to return",H}case"select_covered_card_to_flip_for_chaos_0":return"Action: Select a covered card to flip in this lane";case"prompt_fire_3_discard":return"End Phase: Discard 1 card to flip 1 card?";case"prompt_optional_discard_custom":return`Optional: Discard ${U.count} card(s) to continue?`;case"prompt_optional_effect":{const Z=((Y=(q=U.effectDef)==null?void 0:q.params)==null?void 0:Y.action)||"effect",W=(P=(K=U.effectDef)==null?void 0:K.params)==null?void 0:P.count;return`Do you want to ${Z==="shift"?"shift a card":Z==="flip"?"flip a card":Z==="draw"?`draw ${W||1} card(s)`:Z==="discard"?`discard ${W||1} card(s)`:Z==="delete"?"delete a card":Z==="return"?"return a card":`execute ${Z}${W?` ${W}`:""}`}?`}case"select_card_to_flip_for_fire_3":return"Action: Select a card to flip";case"select_own_other_card_to_shift":return"Action: Select one of your cards to shift";case"select_opponent_face_down_card_to_shift":return"Action: Select an opponent's face-down card to shift";case"prompt_spirit_1_start":return"Start Phase: Discard 1 card or flip Spirit-1?";case"select_any_card_to_flip_optional":return"Action: You may flip one card. Select a card or skip.";case"prompt_swap_protocols":return"Action: Swap two protocols.";case"select_cards_from_hand_to_discard_for_fire_4":return"Action: Select 1 or more cards to discard";case"select_cards_from_hand_to_discard_for_hate_1":return`Action: Select ${U.count} card(s) to discard for Hate-1`;case"select_any_card_to_flip":return`Action: Select a card to flip (${U.count} remaining)`;case"select_any_face_down_card_to_flip_optional":return"Action: You may flip a face-down card. Select a card or skip.";case"select_lane_for_life_3_play":return"Action: Select another lane to play a card into";case"select_card_to_flip_for_light_0":return"Action: Select any card to flip";case"prompt_shift_or_flip_board_card_custom":return"Action: Choose to shift, flip, or skip";case"select_board_card_to_reveal_custom":return"Action: Select a face-down card to reveal";case"select_lane_to_shift_revealed_card_for_light_2":return"Action: Select a lane to shift the revealed card to";case"select_lane_to_shift_revealed_board_card_custom":return"Action: Select a lane to shift the revealed card to";case"select_lane_to_shift_cards_for_light_3":return"Action: Select a lane to shift all face-down cards to";case"select_lane_for_metal_3_delete":return"Action: Select a lane with 8+ cards to delete";case"select_lane_for_delete_all":return"Action: Select a lane to delete all cards";case"select_any_other_card_to_flip_for_water_0":return"Action: Select any other card to flip";case"prompt_rearrange_protocols":return"Action: Rearrange protocols";case"select_lane_for_water_3":return"Action: Select a lane to return cards from";case"select_own_card_to_return_for_water_4":return"Action: Select one of your cards to return to your hand";case"prompt_return_for_psychic_4":return"End Phase: Return an opponent's card?";case"select_any_opponent_card_to_shift":return"Action: Select an opponent's card to shift";case"select_card_to_shift":{const Z=U.targetFilter||{},W=Z.owner||"any",G=Z.faceState||"any",H=Z.position||"uncovered";let B="Action: Select ";return W==="own"?B+="one of your ":W==="opponent"?B+="an opponent's ":B+="a ",G==="face_down"?B+="face-down ":G==="face_up"&&(B+="face-up "),H==="covered"?B+="covered ":H==="uncovered"&&(B+="uncovered "),B+="card to shift",B}case"select_opponent_card_to_return":return"Action: Select an opponent's card to return";case"select_own_highest_card_to_delete_for_hate_2":return"Action: Select your highest value uncovered card to delete";case"select_opponent_highest_card_to_delete_for_hate_2":return"Action: Select opponent's highest value uncovered card to delete";case"custom_choice":{const Z=U.options||[];if(Z.length===2){const W=Z[0].params,G=Z[1].params,H=B=>B.action==="discard"?`you discard ${B.count||1} card${B.count!==1?"s":""}`:B.action==="flip"&&B.flipSelf?"flip this card":B.action==="draw"?`draw ${B.count||1} card${B.count!==1?"s":""}`:B.action==="delete"&&B.deleteSelf?"delete this card":B.action==="delete"?`delete ${B.count||1} card${B.count!==1?"s":""}`:B.action==="return"?`return ${B.count||1} card${B.count!==1?"s":""}`:B.action==="shift"?"shift a card":B.action||"option";return`Either ${H(W)} or ${H(G)}.`}return"Action: Make a choice"}case"select_card_from_revealed_deck":return`Action: Select a card with value ${U.valueFilter} from your revealed deck`;case"select_phase_effect":{const Z=U,W=Z.availableEffects.map(G=>G.cardName).join(", ");return`${Z.phase} Phase: Choose which effect to resolve first (${W})`}default:return"Action Required"}return F==="compile"&&X.length>0?"Phase: Compile":`Phase: ${F.replace("_"," ")}`};return o.jsxs("div",{className:`phase-controller ${R}`,children:[o.jsxs("div",{className:"effect-source-info",children:[o.jsxs("span",{children:[O,"'s Turn"]}),U&&E&&o.jsxs(o.Fragment,{children:[" | Effect from: ",o.jsxs("span",{children:[E.protocol,"-",E.value]})]}),(U==null?void 0:U.sourceCardId)==="CONTROL_MECHANIC"&&o.jsxs(o.Fragment,{children:[" | Effect from: ",o.jsx("span",{children:"Control Component"})]})]}),o.jsxs("div",{className:"phase-controller-main",children:[o.jsx("div",{className:"phase-info",children:T()}),o.jsx("div",{className:"phase-actions",children:I()})]})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const P0={start:"Start",control:"Control",action:"Action",compile:"Compile",hand_limit:"Hand Limit",end:"End"},L0=({gameState:a,turn:n,animationState:l,difficulty:c,onPlayerClick:i,onOpponentClick:d})=>{const{player:u,opponent:h}=a,f=y=>{const v=["info-section"];return v.push(y==="player"?"player-info":"opponent-info"),n===y&&v.push("active-turn"),(l==null?void 0:l.type)==="drawCard"&&l.owner===y&&v.push("is-drawing"),(l==null?void 0:l.type)==="discardCard"&&l.owner===y&&v.push("is-discarding"),v.join(" ")},m=y=>{const v=y==="player"?u:h,_=y==="player"?i:d,w=y==="player"?"Player":`Opponent${c?` (${c.charAt(0).toUpperCase()+c.slice(1)})`:""}`,b=n===y;return o.jsx("div",{className:f(y),onClick:_,children:o.jsxs("div",{className:"info-section-body",children:[o.jsx("h3",{children:w}),b&&o.jsx("span",{className:"phase-badge",children:P0[a.phase]}),o.jsxs("div",{className:"info-line",children:[o.jsx("span",{children:"Hand:"}),o.jsx("span",{children:v.hand.length})]}),o.jsxs("div",{className:"info-line",children:[o.jsx("span",{children:"Deck:"}),o.jsx("span",{children:v.deck.length})]}),o.jsxs("div",{className:"info-line",children:[o.jsx("span",{children:"Trash:"}),o.jsx("span",{children:v.discard.length})]})]})})};return o.jsxs("div",{className:"game-info-panel",children:[m("opponent"),m("player")]})},O0=/\b([A-Z][a-z]+(?:_custom)?)-(\d)\b/g;function cc(a,n){return{...a,id:`preview-${a.protocol}-${a.value}`,isFaceUp:n}}function pm(a){const n=a.match(/^([A-Z][a-z]+(?:_custom)?)-(\d)$/);return n?{protocol:n[1],value:parseInt(n[2],10)}:null}function hm(a){const n=[];let l;const c=new RegExp(O0);for(;(l=c.exec(a))!==null;)n.push({protocol:l[1],value:parseInt(l[2],10)});return n}function Vh(a,n){if(a.sourceCardRef||a.targetCardRefs&&a.targetCardRefs.length>0)return!0;if(a.sourceCard){const c=pm(a.sourceCard);if(c&&n.some(i=>i.protocol===c.protocol&&i.value===c.value))return!0}const l=hm(a.message);return!!(l.length>0&&l.some(c=>n.some(i=>i.protocol===c.protocol&&i.value===c.value)))}function M0(a,n){const l={source:null,targets:[]};if(a.sourceCardRef){const c=n.find(i=>i.protocol===a.sourceCardRef.protocol&&i.value===a.sourceCardRef.value);c&&(l.source=cc(c,a.sourceCardRef.isFaceUp))}if(a.targetCardRefs&&a.targetCardRefs.length>0)for(const c of a.targetCardRefs){const i=n.find(d=>d.protocol===c.protocol&&d.value===c.value);i&&l.targets.push(cc(i,c.isFaceUp))}if(!l.source&&l.targets.length===0){if(a.sourceCard){const i=pm(a.sourceCard);if(i){const d=n.find(u=>u.protocol===i.protocol&&u.value===i.value);d&&(l.source=cc(d,!0))}}const c=hm(a.message);for(const i of c){const d=n.find(u=>u.protocol===i.protocol&&u.value===i.value);if(d){const u=cc(d,!0);l.source?(l.source.protocol!==i.protocol||l.source.value!==i.value)&&l.targets.push(u):l.source=u}}}return l}function H0({log:a,onClose:n}){const[l,c]=re.useState(null),[i,d]=re.useState(0),u=re.useMemo(()=>{const y=Co();return[...Rn,...y]},[]),h=y=>{let v="";if(y.phase){const _=y.phase.charAt(0).toUpperCase()+y.phase.slice(1);v+=`[${_}] `}return y.sourceCard&&!y.message.startsWith(y.sourceCard)&&(v+=`${y.sourceCard}: `),`${v}${y.message}`},f=re.useMemo(()=>{if(l===null)return null;const y=a[l];return y?M0(y,u):null},[l,a,u]),m=(y,v)=>{Vh(v,u)&&(l===y?f&&f.targets.length>1?d(_=>(_+1)%f.targets.length):(c(null),d(0)):(c(y),d(0)))};return o.jsx("div",{className:"modal-overlay",onClick:n,children:o.jsxs("div",{className:"modal-content log-modal-content log-modal-with-preview",onClick:y=>y.stopPropagation(),children:[o.jsx("button",{className:"btn btn-back modal-close-btn",onClick:n,children:"X"}),o.jsx("h2",{children:"Game Log"}),o.jsxs("div",{className:"log-content-wrapper",children:[o.jsx("div",{className:"log-preview-area log-preview-left",children:(f==null?void 0:f.source)&&o.jsx("div",{className:"log-preview-card",children:o.jsx(kt,{card:f.source,isFaceUp:f.source.isFaceUp})})}),o.jsx("ol",{className:"log-list",children:a.map((y,v)=>{const _=y.indentLevel!==void 0,w=_?{paddingLeft:`${y.indentLevel*20+40}px`}:{};_&&y.indentLevel===0&&(w.fontWeight="bold");const b=Vh(y,u),N=l===v;return o.jsx("li",{className:`log-entry log-entry-${y.player}${b?" log-entry-clickable":""}${N?" log-entry-selected":""}`,style:w,onClick:()=>m(v,y),children:h(y)},v)})}),o.jsx("div",{className:"log-preview-area log-preview-right",children:(f==null?void 0:f.targets)&&f.targets.length>0&&o.jsxs("div",{className:"log-preview-card",children:[o.jsx(kt,{card:f.targets[i],isFaceUp:f.targets[i].isFaceUp}),f.targets.length>1&&o.jsxs("div",{className:"log-preview-counter",children:[i+1," / ",f.targets.length]})]})})]})]})})}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const z0=({message:a,player:n})=>o.jsx("div",{className:`toaster toaster-${n}`,children:a});function V0({gameState:a,targetPlayer:n,onConfirm:l}){var q;const[c]=re.useState([...a[n].protocols]),[i,d]=re.useState([...a[n].protocols]),[u,h]=re.useState([0,1,2]),f=re.useRef(null),m=re.useRef(null),y=re.useRef(0),v=re.useRef(null),_=re.useRef(0),w=((q=a.actionRequired)==null?void 0:q.type)==="prompt_rearrange_protocols"?a.actionRequired.disallowedProtocolForLane:void 0,b=re.useMemo(()=>{if(i.length!==c.length)return!1;for(let Y=0;Y<i.length;Y++)if(i[Y]!==c[Y])return!0;return!1},[i,c]),N=re.useMemo(()=>{if(!w)return console.log("[RearrangeModal] No disallowedProtocolForLane set"),!1;const{laneIndex:Y,protocol:K}=w,P=i[Y],Z=P===K;return console.log("[RearrangeModal] Checking violation:",{disallowedProtocol:K,disallowedLaneIndex:Y,currentProtocolAtLane:P,protocols:i,hasViolation:Z}),Z},[i,w]),S=a[n],C=a[n==="player"?"opponent":"player"],j=S.laneValues,R=S.compiled,F=(Y,K)=>{let P=[Y];return K&&P.push("compiled"),P.join(" ")},L=(Y,K)=>{f.current=K,Y.dataTransfer.effectAllowed="move"},U=(Y,K)=>{Y.preventDefault(),m.current=K},Q=()=>{if(f.current!==null&&m.current!==null&&f.current!==m.current){const Y=[...i],K=[...u],P=Y[f.current];Y[f.current]=Y[m.current],Y[m.current]=P;const Z=K[f.current];K[f.current]=K[m.current],K[m.current]=Z,f.current=null,m.current=null,d(Y),h(K)}},X=Y=>{Y.preventDefault()},V=(Y,K)=>{v.current=K,y.current=Y.touches[0].clientY,_.current=Y.touches[0].clientY},$=Y=>{var Z;if(v.current===null)return;_.current=Y.touches[0].clientY;const K=Y.touches[0],P=document.elementFromPoint(K.clientX,K.clientY);if(P){const W=P.closest(".rearrange-item");if(W){const H=Array.from(((Z=W.parentElement)==null?void 0:Z.children)||[]).indexOf(W);H!==-1&&H!==v.current&&(m.current=H)}}},E=()=>{if(v.current!==null&&m.current!==null&&v.current!==m.current){const Y=[...i],K=[...u],P=Y[v.current];Y[v.current]=Y[m.current],Y[m.current]=P;const Z=K[v.current];K[v.current]=K[m.current],K[m.current]=Z,d(Y),h(K)}v.current=null,m.current=null,y.current=0,_.current=0},A=n==="player",O=A?"Rearrange Your Protocols":"Rearrange Opponent's Protocols",I=o.jsx("div",{className:`protocol-bar ${A?"player-bar":"opponent-bar"} rearrange-editable`,onDragOver:X,children:i.map((Y,K)=>{const P=Y!==c[K],Z=w&&w.laneIndex===K&&Y===w.protocol,W=u[K],G=R[W],H=F("protocol-display rearrange-item",G);return o.jsxs("div",{className:`${H} ${P?"changed":""} ${Z?"violation":""}`,draggable:!0,onDragStart:B=>L(B,K),onDragEnter:B=>U(B,K),onDragEnd:Q,onTouchStart:B=>V(B,K),onTouchMove:$,onTouchEnd:E,children:[o.jsx("span",{className:"protocol-name",children:Y}),o.jsx("span",{className:"protocol-value",children:j[K]})]},`${Y}-${K}`)})}),T=o.jsx("div",{className:`protocol-bar ${A?"opponent-bar":"player-bar"}`,children:C.protocols.map((Y,K)=>o.jsxs("div",{className:F("protocol-display",C.compiled[K]),children:[o.jsx("span",{className:"protocol-name",children:Y}),o.jsx("span",{className:"protocol-value",children:C.laneValues[K]})]},`other-proto-${Y}-${K}`))});return o.jsx("div",{className:"modal-overlay",children:o.jsxs("div",{className:"modal-content rearrange-modal-content",onClick:Y=>Y.stopPropagation(),children:[o.jsx("h2",{children:O}),o.jsx("p",{children:"Drag and drop the protocols to reorder them. You must change the order to continue."}),w&&o.jsxs("p",{className:"warning-text",children:[" ",o.jsx("strong",{children:w.protocol})," cannot be placed on line ",o.jsx("strong",{children:w.laneIndex})," due to Anarchy-3's restriction."]}),o.jsx("div",{className:"rearrange-board-view",children:o.jsxs("div",{className:"protocol-bars-container",children:[A?T:I,A?I:T]})}),o.jsxs("div",{className:"rearrange-actions",children:[o.jsx("button",{className:"btn",onClick:()=>l(i),disabled:!b||N,children:"Confirm Rearrangement"}),N&&o.jsxs("p",{className:"error-text",children:["Cannot confirm: ",w.protocol," is on line ",w.laneIndex]})]})]})})}function B0({gameState:a,targetPlayer:n,onConfirm:l}){const[c,i]=re.useState([]),d=a[n],u=n==="player",h=u?"Swap Your Protocols":"Swap Opponent's Protocols",f=v=>{c.includes(v)?i(_=>_.filter(w=>w!==v)):c.length<2&&i(_=>[..._,v])},m=()=>{c.length===2&&l(c)},y=v=>{let _=["protocol-display","rearrange-item"];return d.compiled[v]&&_.push("compiled"),c.includes(v)&&_.push("selected"),_.join(" ")};return o.jsx("div",{className:"modal-overlay",children:o.jsxs("div",{className:"modal-content rearrange-modal-content",onClick:v=>v.stopPropagation(),children:[o.jsx("h2",{children:h}),o.jsx("p",{children:"Select two protocols to swap their positions. This action is mandatory."}),o.jsx("div",{className:"rearrange-board-view",children:o.jsx("div",{className:"protocol-bars-container",children:o.jsx("div",{className:`protocol-bar ${u?"player-bar":"opponent-bar"}`,children:d.protocols.map((v,_)=>o.jsxs("div",{className:y(_),onClick:()=>f(_),children:[o.jsx("span",{className:"protocol-name",children:v}),o.jsx("span",{className:"protocol-value",children:d.laneValues[_]})]},v))})})}),o.jsx("div",{className:"rearrange-actions",children:o.jsx("button",{className:"btn",onClick:m,disabled:c.length!==2,children:"Confirm Swap"})})]})})}function Y0({gameState:a,onSelectCard:n}){var N;const[l,c]=re.useState(null),i=re.useRef(!1),d=a.actionRequired,u=d==null?void 0:d.revealedCards,h=d==null?void 0:d.selectableCardIds,f=u||(d!=null&&d.actor?(N=a[d.actor])==null?void 0:N.deck:[])||[],m=re.useMemo(()=>f.map((S,k)=>({...S,id:S.id||`deck-${k}`,isFaceUp:!0})),[f]);if(re.useEffect(()=>{if((d==null?void 0:d.type)==="select_card_from_revealed_deck"&&(h==null?void 0:h.length)>0&&!i.current){const S=m.find(k=>h.includes(k.id));S&&(c(S),i.current=!0)}},[d==null?void 0:d.type,h,m]),re.useEffect(()=>{(!d||d.type!=="select_card_from_revealed_deck")&&(i.current=!1,c(null))},[d]),!d||d.type!=="select_card_from_revealed_deck")return null;const{valueFilter:y}=d,v=S=>h==null?void 0:h.includes(S),_=S=>{v(S.id)&&c(S)},w=S=>{v(S.id)&&c(S)},b=()=>{l&&v(l.id)&&n(l.id)};return o.jsx("div",{className:"modal-overlay",children:o.jsxs("div",{className:"modal-content revealed-deck-modal",onClick:S=>S.stopPropagation(),children:[o.jsx("h2",{children:"Your Revealed Deck"}),o.jsxs("p",{children:["Select a card with value ",y," to draw:"]}),o.jsxs("div",{className:"revealed-deck-content-wrapper",children:[o.jsx("div",{className:"revealed-deck-preview-area",children:l&&o.jsxs("div",{className:"revealed-deck-preview-card",children:[o.jsx(kt,{card:l,isFaceUp:!0}),o.jsxs("button",{className:"btn preview-confirm-btn",onClick:b,children:["Draw ",l.protocol,"-",l.value]})]})}),o.jsx("div",{className:"revealed-deck-grids-area",children:o.jsx("div",{className:"revealed-deck-card-grid",children:m.length>0?m.map(S=>{const k=v(S.id),C=(l==null?void 0:l.id)===S.id;return o.jsx("div",{onClick:j=>{j.stopPropagation(),w(S)},onMouseEnter:()=>_(S),style:{cursor:k?"pointer":"default"},children:o.jsx(kt,{card:S,isFaceUp:!0,additionalClassName:`in-hand ${k?C?"highlight-selectable":"":"dimmed"}`})},S.id)}):o.jsx("p",{className:"no-cards",children:"No cards in deck."})})})]})]})})}function G0({gameState:a,onAccept:n,onDecline:l}){var v,_;const c=a.actionRequired;if(!c||c.type!=="prompt_optional_effect")return null;const i=c.effectDef;if(!i||((v=i.params)==null?void 0:v.action)!=="discard"||!((_=i.params)!=null&&_.useCardFromPreviousEffect))return null;const d=a.lastCustomEffectTargetCardId;if(!d)return null;const u=c.actor||"player",f=a[u].deck.find(w=>w.id===d);if(!f)return null;const m={...f,id:f.id||"revealed-top",isFaceUp:!0},y=`${f.protocol}-${f.value}`;return o.jsx("div",{className:"modal-overlay",children:o.jsxs("div",{className:"modal-content revealed-deck-top-modal",onClick:w=>w.stopPropagation(),children:[o.jsx("h2",{children:"Revealed: Top Card of Your Deck"}),o.jsx("p",{children:"You may discard this card:"}),o.jsx("div",{className:"revealed-card-display",children:o.jsx(kt,{card:m,isFaceUp:!0})}),o.jsxs("div",{className:"revealed-deck-top-actions",children:[o.jsxs("button",{className:"btn",onClick:n,children:["Discard ",y]}),o.jsx("button",{className:"btn btn-back",onClick:l,children:"Keep in Deck"})]})]})})}function W0({player:a,playerState:n,onClose:l,difficulty:c}){const i=a==="player"?"Player":`Opponent${c?` (${c.charAt(0).toUpperCase()+c.slice(1)})`:""}`,[d,u]=re.useState(null),h=m=>{u(m)},f=(m,y,v)=>{const _=m.map((w,b)=>({...w,id:`${y}-${w.protocol}-${w.value}-${b}`,isFaceUp:v}));return o.jsxs(o.Fragment,{children:[o.jsxs("h3",{children:[y," (",_.length,")"]}),o.jsx("div",{className:"debug-card-grid",children:_.length>0?_.map(w=>o.jsx("div",{onClick:b=>{b.stopPropagation(),u(w)},onMouseEnter:()=>h(w),onMouseLeave:()=>h(null),style:{cursor:"pointer"},children:o.jsx(kt,{card:w,isFaceUp:v,additionalClassName:"in-hand"})},w.id)):o.jsxs("p",{className:"no-cards",children:["No cards in ",y.toLowerCase(),"."]})})]})};return o.jsx("div",{className:"modal-overlay",onClick:l,children:o.jsxs("div",{className:"modal-content debug-modal-content debug-modal-with-preview",onClick:m=>m.stopPropagation(),children:[o.jsx("button",{className:"btn btn-back modal-close-btn",onClick:l,children:"X"}),o.jsxs("h2",{children:[i,"'s Info"]}),o.jsxs("div",{className:"debug-content-wrapper",children:[o.jsx("div",{className:"debug-preview-area",children:d&&o.jsx("div",{className:"debug-preview-card",children:o.jsx(kt,{card:d,isFaceUp:d.isFaceUp})})}),o.jsxs("div",{className:"debug-grids-area",children:[f(n.deck,"Deck",!1),f(n.discard,"Discard Pile",!0)]})]})]})})}function Q0({onComplete:a}){const[n,l]=re.useState("choose"),[c,i]=re.useState(null),[d,u]=re.useState(null),[h,f]=re.useState(!1),m=v=>{i(v),l("flipping"),f(!0);const _=Math.random()<.5?"heads":"tails";setTimeout(()=>{u(_),f(!1),l("result")},2e3)},y=()=>{if(d===null||c===null)return;const v=d===c;a(v?"player":"opponent",c,v)};return o.jsx("div",{className:"coin-flip-modal-overlay",children:o.jsxs("div",{className:"modal-content coin-flip-modal-content",onClick:v=>v.stopPropagation(),children:[n==="choose"&&o.jsxs(o.Fragment,{children:[o.jsx("h2",{children:"Coin Flip"}),o.jsx("p",{children:"Choose heads or tails to determine who starts the game."}),o.jsxs("div",{className:"coin-flip-choices",children:[o.jsxs("button",{className:"btn coin-flip-choice-btn",onClick:()=>m("heads"),children:[o.jsx("div",{className:"coin-choice-icon",children:"H"}),o.jsx("div",{className:"coin-choice-label",children:"Heads"})]}),o.jsxs("button",{className:"btn coin-flip-choice-btn",onClick:()=>m("tails"),children:[o.jsx("div",{className:"coin-choice-icon",children:"T"}),o.jsx("div",{className:"coin-choice-label",children:"Tails"})]})]})]}),n==="flipping"&&o.jsxs(o.Fragment,{children:[o.jsx("h2",{children:"Flipping..."}),o.jsxs("p",{children:["You chose: ",o.jsx("span",{className:"coin-flip-highlight",children:c==="heads"?"Heads":"Tails"})]}),o.jsx("div",{className:"coin-flip-animation-container",children:o.jsxs("div",{className:`coin-3d ${h?"is-flipping":""}`,children:[o.jsx("div",{className:"coin-face coin-heads",children:"H"}),o.jsx("div",{className:"coin-face coin-tails",children:"T"})]})})]}),n==="result"&&d&&c&&o.jsxs(o.Fragment,{children:[o.jsx("h2",{children:"Result"}),o.jsxs("p",{children:["You chose: ",o.jsx("span",{className:"coin-flip-highlight",children:c==="heads"?"Heads":"Tails"})]}),o.jsx("div",{className:"coin-flip-animation-container",children:o.jsxs("div",{className:`coin-3d result-${d}`,children:[o.jsx("div",{className:"coin-face coin-heads",children:"H"}),o.jsx("div",{className:"coin-face coin-tails",children:"T"})]})}),o.jsxs("p",{className:"coin-flip-result-text",children:["The coin landed on: ",o.jsx("span",{className:"coin-flip-highlight",children:d==="heads"?"Heads":"Tails"})]}),d===c?o.jsx("p",{className:"coin-flip-winner-text",children:"You won! You will start the game."}):o.jsx("p",{className:"coin-flip-loser-text",children:"Opponent won! Opponent will start the game."}),o.jsx("button",{className:"btn",onClick:y,children:"Continue"})]})]})})}const X0="anarchy-custom-001",Z0="Anarchy",K0="Custom recreation of Anarchy protocol to validate editor capabilities",J0="System Validation",ex="2025-11-08T00:00:00.000Z",tx="#8B0000",nx="chaos",ax=[{value:0,topEffects:[],middleEffects:[{id:"anarchy-0-shift",params:{action:"shift",targetFilter:{owner:"any",position:"uncovered",faceState:"any"}},position:"middle",trigger:"on_play"},{id:"anarchy-0-draw",params:{action:"draw",count:1,target:"self",source:"own_deck",conditional:{type:"non_matching_protocols"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[{id:"anarchy-1-passive",params:{action:"passive_rule",rule:{type:"require_non_matching_protocol",target:"all",scope:"global"}},position:"top",trigger:"passive"}],middleEffects:[{id:"anarchy-1-shift",params:{action:"shift",targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!0},destinationRestriction:{type:"non_matching_protocol"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"anarchy-2-delete",params:{action:"delete",count:1,targetFilter:{position:"any",faceState:"face_up"},protocolMatching:"must_match",excludeSelf:!1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"anarchy-3-swap",params:{action:"swap_protocols",target:"opponent"},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"anarchy-3-end-rearrange",params:{action:"rearrange_protocols",target:"own",restriction:{disallowedProtocol:"Anarchy",laneIndex:"current"}},position:"bottom",trigger:"end"}]},{value:5,topEffects:[],middleEffects:[{id:"anarchy-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:6,topEffects:[{id:"anarchy-6-start-flip",params:{action:"flip",count:1,flipSelf:!0,optional:!1,targetFilter:{owner:"any",position:"any",faceState:"any",excludeSelf:!1},advancedConditional:{type:"protocol_match",protocol:"Anarchy"}},position:"top",trigger:"start"}],middleEffects:[],bottomEffects:[]}],ox="Fan-Content",mm={id:X0,name:Z0,description:K0,author:J0,createdAt:ex,color:tx,pattern:nx,cards:ax,category:ox},rx="apathy_custom",lx="Apathy",sx="Custom implementation of Apathy protocol",cx="System",ix="2025-01-08T00:00:00Z",dx="#9E9E9E",ux="radial",fx=[{value:0,topEffects:[{id:"apathy-0-value-modifier",params:{action:"value_modifier",modifier:{type:"add_per_condition",value:1,condition:"per_face_down_card",target:"own_total",scope:"this_lane"}},position:"top",trigger:"passive"}],middleEffects:[],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"apathy-1-flip-all",params:{action:"flip",count:"all",optional:!1,scope:"this_lane",targetFilter:{owner:"any",position:"any",faceState:"face_up",excludeSelf:!0}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:2,topEffects:[{id:"apathy-2-passive",params:{action:"passive_rule",rule:{type:"ignore_middle_commands",target:"all",scope:"this_lane"}},position:"top",trigger:"passive"}],middleEffects:[],bottomEffects:[{id:"apathy-2-on-cover",params:{action:"flip",count:1,flipSelf:!0,optional:!1,targetFilter:{owner:"any",position:"any",faceState:"any",excludeSelf:!1}},position:"bottom",trigger:"on_cover"}]},{value:3,topEffects:[],middleEffects:[{id:"apathy-3-flip-opponent",params:{action:"flip",count:1,optional:!1,targetFilter:{owner:"opponent",position:"uncovered",faceState:"face_up",excludeSelf:!1}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"apathy-4-flip-covered",params:{action:"flip",count:1,optional:!0,targetFilter:{owner:"own",position:"covered",faceState:"face_up",excludeSelf:!1}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"apathy-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],px="Aux 1",ym={id:rx,name:lx,description:sx,author:cx,createdAt:ix,color:dx,pattern:ux,cards:fx,category:px},hx="chaos_custom_1",mx="Chaos",yx="Embrace the unpredictable. Custom protocol migration of original Chaos protocol.",gx="#E64DB8",vx="chaos",_x=[{value:0,topEffects:[],middleEffects:[{id:"chaos_0_flip_covered",trigger:"on_play",params:{action:"flip",count:1,scope:"each_lane",targetFilter:{owner:"any",position:"covered",faceState:"any"}},position:"middle"}],bottomEffects:[{id:"chaos_0_start_swap_draws",trigger:"start",params:{action:"mutual_draw",count:1},position:"bottom"}]},{value:1,topEffects:[],middleEffects:[{id:"chaos_1_rearrange_own",trigger:"on_play",params:{action:"rearrange_protocols",target:"own"},position:"middle"},{id:"chaos_1_rearrange_opponent",trigger:"on_play",params:{action:"rearrange_protocols",target:"opponent"},position:"middle"}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"chaos_2_shift_covered",trigger:"on_play",params:{action:"shift",count:1,targetFilter:{owner:"own",position:"covered",faceState:"any"}},position:"middle"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[],bottomEffects:[{id:"chaos_3_allow_any_protocol",trigger:"passive",params:{action:"passive_rule",rule:{type:"allow_any_protocol_play",target:"self",scope:"global"}},position:"bottom"}]},{value:4,topEffects:[],middleEffects:[],bottomEffects:[{id:"chaos_4_end_discard_draw",trigger:"end",params:{action:"discard",count:"all",actor:"self"},conditional:{type:"then",thenEffect:{id:"chaos_4_draw_after_discard",trigger:"on_play",params:{action:"draw",count:1,countType:"equal_to_discarded",countOffset:0,target:"self",source:"own_deck"},position:"bottom"}},position:"bottom"}]},{value:5,topEffects:[],middleEffects:[{id:"chaos_5_discard",trigger:"on_play",params:{action:"discard",count:1,actor:"self"},position:"middle"}],bottomEffects:[]}],xx="Main 2",gm={id:hx,name:mx,description:yx,color:gx,pattern:vx,cards:_x,category:xx},wx="darkness_custom_v1",Cx="Darkness",bx="Custom Darkness protocol - manipulate face-down cards, flip and shift",Sx="System",Ex="2025-01-08T00:00:00Z",jx="#1a0033",kx="grid",Nx=[{value:0,topEffects:[],middleEffects:[{id:"dark-0-draw",params:{action:"draw",count:3,target:"self",source:"own_deck"},position:"middle",trigger:"on_play"},{id:"dark-0-shift",params:{action:"shift",targetFilter:{owner:"opponent",position:"covered",faceState:"any",excludeSelf:!1},destinationRestriction:{type:"any"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"dark-1-flip",params:{action:"flip",count:1,optional:!1,targetFilter:{owner:"opponent",position:"uncovered",faceState:"any",excludeSelf:!1}},position:"middle",trigger:"on_play"},{id:"dark-1-shift",params:{action:"shift",optional:!0,targetFilter:{owner:"any",position:"any",faceState:"any",excludeSelf:!1},destinationRestriction:{type:"any"}},position:"middle",trigger:"on_play",useCardFromPreviousEffect:!0}],bottomEffects:[]},{value:2,topEffects:[{id:"dark-2-value-modifier",params:{action:"value_modifier",modifier:{type:"set_to_fixed",value:4,target:"own_cards",scope:"this_lane",filter:{faceState:"face_down",position:"any"}}},position:"top",trigger:"passive"}],middleEffects:[{id:"dark-2-flip",params:{action:"flip",count:1,optional:!0,scope:"this_lane",targetFilter:{owner:"any",position:"covered",faceState:"any",excludeSelf:!1}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"dark-3-play",params:{action:"play",source:"hand",count:1,faceDown:!0,destinationRule:{type:"other_lines",excludeCurrentLane:!0}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"dark-4-shift",params:{action:"shift",targetFilter:{owner:"any",position:"uncovered",faceState:"face_down",excludeSelf:!1},destinationRestriction:{type:"any"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"dark-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],Rx="Main 1",vm={id:wx,name:Cx,description:bx,author:Sx,createdAt:Ex,color:jx,pattern:kx,cards:Nx,category:Rx},Ax="death_custom_v1",Tx="Death",Dx="Custom Death protocol - delete cards with various conditions",Fx="System",qx="2025-01-09T00:00:00Z",$x="#8B0000",Ix="stripes",Ux=[{value:0,topEffects:[],middleEffects:[{id:"death-0-delete-from-each-lane",params:{action:"delete",count:1,scope:{type:"each_other_line"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[{id:"death-1-optional-draw",params:{action:"draw",count:1,optional:!0},position:"top",trigger:"start",conditional:{type:"if_executed",thenEffect:{id:"death-1-delete-other",params:{action:"delete",count:1,excludeSelf:!0},position:"top",trigger:"start",conditional:{type:"then",thenEffect:{id:"death-1-delete-self",params:{action:"delete",count:1,targetFilter:{position:"any",owner:"own"},deleteSelf:!0},position:"top",trigger:"start"}}}}}],middleEffects:[],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"death-2-delete-lane-values",params:{action:"delete",count:"all",selectLane:!0,targetFilter:{faceState:"any",valueRange:{min:1,max:2}}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"death-3-delete-facedown",params:{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"face_down"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"death-4-delete-low-value",params:{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"face_up",valueRange:{min:0,max:1}}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"death-5-discard",params:{action:"discard",count:1},position:"middle",trigger:"on_play"}],bottomEffects:[]}],Px="Main 1",_m={id:Ax,name:Tx,description:Dx,author:Fx,createdAt:qx,color:$x,pattern:Ix,cards:Ux,category:Px},Lx="fire-custom-001",Ox="Fire",Mx="Fire protocol - discard cards to fuel powerful effects",Hx="System",zx="2025-11-09T00:00:00.000Z",Vx="#F06838",Bx="radial",Yx=[{value:0,topEffects:[],middleEffects:[{id:"fire-0-flip",params:{action:"flip",count:1,targetFilter:{excludeSelf:!0}},position:"middle",trigger:"on_play"},{id:"fire-0-draw",params:{action:"draw",count:2},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"fire-0-oncover-draw",params:{action:"draw",count:1},position:"bottom",trigger:"on_cover",conditional:{type:"then",thenEffect:{id:"fire-0-oncover-flip",params:{action:"flip",count:1,targetFilter:{excludeSelf:!0}},position:"bottom",trigger:"on_cover"}}}]},{value:1,topEffects:[],middleEffects:[{id:"fire-1-discard",params:{action:"discard",count:1},position:"middle",trigger:"on_play",conditional:{type:"if_executed",thenEffect:{id:"fire-1-delete",params:{action:"delete",count:1},position:"middle",trigger:"on_play"}}}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"fire-2-discard",params:{action:"discard",count:1},position:"middle",trigger:"on_play",conditional:{type:"if_executed",thenEffect:{id:"fire-2-return",params:{action:"return",count:1,targetFilter:{position:"uncovered"}},position:"middle",trigger:"on_play"}}}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[],bottomEffects:[{id:"fire-3-discard",params:{action:"discard",count:1,optional:!0},position:"bottom",trigger:"end",conditional:{type:"if_executed",thenEffect:{id:"fire-3-flip",params:{action:"flip",count:1},position:"bottom",trigger:"end"}}}]},{value:4,topEffects:[],middleEffects:[{id:"fire-4-discard-variable",params:{action:"discard",count:1,variableCount:!0},position:"middle",trigger:"on_play",conditional:{type:"then",thenEffect:{id:"fire-4-draw-based-on-discard",params:{action:"draw",countType:"equal_to_discarded",countOffset:1},position:"middle",trigger:"on_play"}}}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"fire-5-discard",params:{action:"discard",count:1,optional:!1},position:"middle",trigger:"on_play"}],bottomEffects:[]}],Gx="Main 1",xm={id:Lx,name:Ox,description:Mx,author:Hx,createdAt:zx,color:Vx,pattern:Bx,cards:Yx,category:Gx},Wx="frost_custom_1",Qx="Frost",Xx="Freeze the game state. Frost blocks actions and preserves face-down cards.",Zx="#87CEEB",Kx="frost",Jx=[{value:0,topEffects:[],middleEffects:[{id:"frost_0_draw_per_face_down",trigger:"on_play",position:"middle",params:{action:"draw",count:1,source:"own_deck",target:"self",countType:"count_face_down"}}],bottomEffects:[]},{value:1,topEffects:[{id:"frost_1_block_flips",trigger:"passive",position:"top",params:{action:"passive_rule",rule:{type:"block_flips",target:"all",scope:"global"}}}],middleEffects:[],bottomEffects:[{id:"frost_1_block_rearrange",trigger:"passive",position:"bottom",params:{action:"passive_rule",rule:{type:"block_protocol_rearrange",target:"all",scope:"global"}}}]},{value:2,topEffects:[],middleEffects:[{id:"frost_2_play_face_down",trigger:"on_play",position:"middle",params:{action:"play",count:1,source:"hand",faceDown:!0}}],bottomEffects:[]},{value:3,topEffects:[{id:"frost_3_block_shifts",trigger:"passive",position:"top",params:{action:"passive_rule",rule:{type:"block_shifts_from_and_to_lane",target:"all",scope:"this_lane"}}}],middleEffects:[],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"frost_4_flip_covered",trigger:"on_play",position:"middle",params:{action:"flip",count:1,optional:!0,targetFilter:{owner:"own",faceState:"face_up",position:"covered"}}}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"frost_5_discard",trigger:"on_play",position:"middle",params:{action:"discard",count:1,target:"self"}}],bottomEffects:[]}],ew="Fan-Content",wm={id:Wx,name:Qx,description:Xx,color:Zx,pattern:Kx,cards:Jx,category:ew},tw="hate-custom-001",nw="Hate",aw="Focused on deletion and sacrifice. Delete cards to gain advantage.",ow="System Migration",rw="2025-11-13T00:00:00.000Z",lw="#E67A7A",sw="diagonal-lines",cw=[{value:0,topEffects:[],middleEffects:[{id:"hate-0-delete",params:{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"any"},scope:{type:"anywhere"},excludeSelf:!1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"hate-1-discard",params:{action:"discard",count:3,actor:"self",upTo:!0},position:"middle",trigger:"on_play"},{id:"hate-1-delete-1",params:{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"any"},scope:{type:"anywhere"},excludeSelf:!1,upTo:!0},position:"middle",trigger:"on_play"},{id:"hate-1-delete-2",params:{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"any"},scope:{type:"anywhere"},excludeSelf:!1,upTo:!0},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"hate-2-delete-own",params:{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"any",calculation:"highest_value",owner:"own"},scope:{type:"anywhere"},excludeSelf:!1},position:"middle",trigger:"on_play"},{id:"hate-2-delete-opponent",params:{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"any",calculation:"highest_value",owner:"opponent"},scope:{type:"anywhere"},excludeSelf:!1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[{id:"hate-3-reactive-draw",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"top",trigger:"after_delete",reactiveTriggerActor:"self"}],middleEffects:[],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[],bottomEffects:[{id:"hate-4-on-cover-delete",params:{action:"delete",count:1,targetFilter:{position:"covered_by_context",faceState:"any",calculation:"lowest_value"},scope:{type:"this_line"},excludeSelf:!1,autoExecute:!0},position:"bottom",trigger:"on_cover"}]},{value:5,topEffects:[],middleEffects:[{id:"hate-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],iw="Aux 1",Cm={id:tw,name:nw,description:aw,author:ow,createdAt:rw,color:lw,pattern:sw,cards:cw,category:iw},dw="water_custom_1",uw="Water",fw="Wash away and renew. Custom protocol migration of original Water protocol.",pw="#5DADE2",hw="multi-radial",mw=[{value:0,topEffects:[],middleEffects:[{id:"water_0_flip_other",trigger:"immediate",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!0},optional:!1},position:"middle"},{id:"water_0_flip_self",trigger:"immediate",params:{action:"flip",flipSelf:!0},position:"middle"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"water_1_play",trigger:"immediate",params:{action:"play",source:"deck",count:1,faceDown:!0,destinationRule:{type:"each_other_line"}},position:"middle"}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"water_2_draw",trigger:"immediate",params:{action:"draw",count:2},position:"middle"},{id:"water_2_rearrange",trigger:"immediate",params:{action:"rearrange_protocols",target:"own"},position:"middle"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"water_3_return",trigger:"immediate",params:{action:"return",count:"all",targetFilter:{owner:"any",position:"uncovered",valueEquals:2},selectLane:!0},position:"middle"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"water_4_return",trigger:"immediate",params:{action:"return",count:1,targetFilter:{owner:"own",position:"uncovered"}},position:"middle"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"water_5_discard",trigger:"immediate",params:{action:"discard",count:1,actor:"self"},position:"middle"}],bottomEffects:[]}],yw="Main 1",bm={id:dw,name:uw,description:fw,color:pw,pattern:hw,cards:mw,category:yw},gw="spirit_custom_1",vw="Spirit",_w="True strength from within. Custom protocol migration of original Spirit protocol.",xw="#5DD9C1",ww="dual-radial",Cw=[{value:0,topEffects:[],middleEffects:[{id:"spirit_0_refresh",trigger:"on_play",params:{action:"refresh",target:"self"},position:"middle"},{id:"spirit_0_draw",trigger:"on_play",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"middle"}],bottomEffects:[{id:"spirit_0_skip_cache",trigger:"passive",params:{action:"passive_rule",rule:{type:"skip_check_cache_phase",target:"self",scope:"global"}},position:"bottom"}]},{value:1,topEffects:[{id:"spirit_1_play_anywhere",trigger:"passive",params:{action:"passive_rule",rule:{type:"allow_any_protocol_play",target:"self",scope:"global"}},position:"top"}],middleEffects:[{id:"spirit_1_draw",trigger:"on_play",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"middle"}],bottomEffects:[{id:"spirit_1_choice",trigger:"start",params:{action:"choice",options:[{id:"spirit_1_choice_discard",trigger:"on_play",params:{action:"discard",count:1,actor:"self"},position:"bottom"},{id:"spirit_1_choice_flip",trigger:"on_play",params:{action:"flip",flipSelf:!0},position:"bottom"}]},position:"bottom"}]},{value:2,topEffects:[],middleEffects:[{id:"spirit_2_flip",trigger:"on_play",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1},optional:!0},position:"middle"}],bottomEffects:[]},{value:3,topEffects:[{id:"spirit_3_shift",trigger:"after_draw",reactiveTriggerActor:"self",params:{action:"shift",count:1,optional:!0,targetFilter:{owner:"own",position:"any",faceState:"any",excludeSelf:!1}},position:"top"}],middleEffects:[],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"spirit_4_swap",trigger:"on_play",params:{action:"swap_protocols",target:"own"},position:"middle"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"spirit_5_discard",trigger:"on_play",params:{action:"discard",count:1,actor:"self"},position:"middle"}],bottomEffects:[]}],bw="Main 1",Sm={id:gw,name:vw,description:_w,color:xw,pattern:ww,cards:Cw,category:bw},Sw="gravity_custom_1",Ew="Gravity",jw="Pull everything together. Gravity draws cards towards this line.",kw="#7599EB",Nw="grid",Rw=[{value:0,topEffects:[],middleEffects:[{id:"gravity_0_play_per_2_cards",trigger:"on_play",params:{action:"play",source:"deck",count:1,faceDown:!0,destinationRule:{type:"under_this_card"},condition:{type:"per_x_cards_in_line",cardCount:2},actor:"self"},position:"middle"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"gravity_1_draw_2",trigger:"on_play",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"middle"},{id:"gravity_1_shift_to_or_from",trigger:"on_play",params:{action:"shift",targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1},destinationRestriction:{type:"to_or_from_this_lane",laneIndex:"current"}},position:"middle"}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"gravity_2_flip",trigger:"on_play",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1},optional:!1},position:"middle"},{id:"gravity_2_shift_to_this_line",trigger:"on_play",params:{action:"shift",targetFilter:{owner:"any",position:"any",faceState:"any",excludeSelf:!1},destinationRestriction:{type:"to_this_lane",laneIndex:"current"}},position:"middle",useCardFromPreviousEffect:!0}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"gravity_4_shift_face_down_to_this_line",trigger:"on_play",params:{action:"shift",targetFilter:{owner:"any",position:"uncovered",faceState:"face_down",excludeSelf:!1},destinationRestriction:{type:"to_this_lane",laneIndex:"current"}},position:"middle"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"gravity_5_discard",trigger:"on_play",params:{action:"discard",count:1,actor:"self"},position:"middle"}],bottomEffects:[]},{value:6,topEffects:[],middleEffects:[{id:"gravity_6_opponent_plays",trigger:"on_play",params:{action:"play",source:"deck",count:1,faceDown:!0,destinationRule:{type:"specific_lane",laneIndex:"current"},actor:"opponent"},position:"middle",comment:"Opponent plays top of their deck in this line"}],bottomEffects:[]}],Aw="Main 1",Em={id:Sw,name:Ew,description:jw,color:kw,pattern:Nw,cards:Rw,category:Aw},Tw="life_custom_1",Dw="Life",Fw="Life begets more life. Play cards from your deck to grow your presence.",qw="#3CE076",$w="hexagons",Iw=[{value:0,topEffects:[],middleEffects:[{id:"life_0_play_each_line_with_card",trigger:"on_play",position:"middle",params:{action:"play",source:"deck",count:1,faceDown:!0,destinationRule:{type:"each_line_with_card",ownerFilter:"own"},actor:"self"}}],bottomEffects:[{id:"life_0_on_cover_delete_self",trigger:"on_cover",position:"bottom",params:{action:"delete",deleteSelf:!0}}]},{value:1,topEffects:[],middleEffects:[{id:"life_1_flip_1",trigger:"on_play",position:"middle",params:{action:"flip",count:1,optional:!1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1}}},{id:"life_1_flip_2",trigger:"on_play",position:"middle",params:{action:"flip",count:1,optional:!1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1}}}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"life_2_draw",trigger:"on_play",position:"middle",params:{action:"draw",count:1,target:"self",source:"own_deck"}},{id:"life_2_flip",trigger:"on_play",position:"middle",params:{action:"flip",count:1,optional:!0,targetFilter:{owner:"any",position:"uncovered",faceState:"face_down",excludeSelf:!1}}}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[],bottomEffects:[{id:"life_3_on_cover_play",trigger:"on_cover",position:"bottom",params:{action:"play",source:"deck",count:1,faceDown:!0,destinationRule:{type:"another_line",excludeCurrentLane:!0},actor:"self"}}]},{value:4,topEffects:[],middleEffects:[{id:"life_4_conditional_draw",trigger:"on_play",position:"middle",params:{action:"draw",count:1,target:"self",source:"own_deck",conditional:{type:"is_covering"}}}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"life_5_discard",trigger:"on_play",position:"middle",params:{action:"discard",count:1,actor:"self"}}],bottomEffects:[]}],Uw="Main 1",jm={id:Tw,name:Dw,description:Fw,color:qw,pattern:$w,cards:Iw,category:Uw},Pw="light_custom_1",Lw="Light",Ow="Burn away the dark. Light protocol reveals and manipulates through illumination.",Mw="System",Hw="2025-11-14T00:00:00.000Z",zw="#F4D03F",Vw="radial",Bw=[{value:0,topEffects:[],middleEffects:[{id:"light-0-flip",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1},optional:!1},position:"middle",trigger:"on_play"},{id:"light-0-draw",params:{action:"draw",count:1,target:"self",source:"own_deck",countType:"equal_to_card_value"},position:"middle",trigger:"on_play",useCardFromPreviousEffect:!0}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[],bottomEffects:[{id:"light-1-draw",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"bottom",trigger:"end"}]},{value:2,topEffects:[],middleEffects:[{id:"light-2-draw",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"middle",trigger:"on_play"},{id:"light-2-reveal-board-card",params:{action:"reveal",source:"board",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"face_down"},optional:!0},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"light-3-shift-all",params:{action:"shift",count:"all",targetFilter:{owner:"any",position:"any",faceState:"face_down",excludeSelf:!1},destinationRestriction:{type:"to_another_line"},scope:"this_lane"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"light-4-reveal",params:{action:"reveal",source:"opponent_hand",count:-1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"light-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],Yw="Main 1",km={id:Pw,name:Lw,description:Ow,author:Mw,createdAt:Hw,color:zw,pattern:Vw,cards:Bw,category:Yw},Gw="speed_custom_1",Ww="Speed",Qw="Swift and adaptive. Custom protocol migration of original Speed protocol.",Xw="#33E6E6",Zw="cross",Kw=[{value:0,topEffects:[],middleEffects:[{id:"speed_0_play",trigger:"on_play",params:{action:"play",source:"hand",count:1},position:"middle"}],bottomEffects:[]},{value:1,topEffects:[{id:"speed_1_reactive_draw",trigger:"after_clear_cache",reactiveTriggerActor:"self",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"top"}],middleEffects:[{id:"speed_1_draw",trigger:"on_play",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"middle"}],bottomEffects:[]},{value:2,topEffects:[{id:"speed_2_before_compile",trigger:"before_compile_delete",params:{action:"shift",count:1,shiftSelf:!0,allowCoveredSelf:!0,targetFilter:{owner:"own",position:"any",faceState:"any"}},position:"top"}],middleEffects:[],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"speed_3_shift_other",trigger:"on_play",params:{action:"shift",count:1,targetFilter:{owner:"own",position:"uncovered",faceState:"any",excludeSelf:!0}},position:"middle"}],bottomEffects:[{id:"speed_3_end_shift",trigger:"end",params:{action:"shift",count:1,optional:!0,targetFilter:{owner:"own",position:"uncovered",faceState:"any"}},position:"bottom",conditional:{type:"if_executed",thenEffect:{id:"speed_3_flip_self",trigger:"on_play",params:{action:"flip",flipSelf:!0},position:"bottom"}}}]},{value:4,topEffects:[],middleEffects:[{id:"speed_4_shift_opponent",trigger:"on_play",params:{action:"shift",count:1,targetFilter:{owner:"opponent",position:"uncovered",faceState:"face_down"}},position:"middle"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"speed_5_discard",trigger:"on_play",params:{action:"discard",count:1,actor:"self"},position:"middle"}],bottomEffects:[]}],Jw="Main 1",Nm={id:Gw,name:Ww,description:Qw,color:Xw,pattern:Zw,cards:Kw,category:Jw},e1="metal_custom_1",t1="Metal",n1="Unyielding defense. Custom protocol migration of original Metal protocol.",a1="#B0BEC5",o1="grid",r1=[{value:0,topEffects:[{id:"metal_0_reduce_opponent",trigger:"passive",params:{action:"value_modifier",modifier:{type:"add_to_total",value:-2,target:"opponent_total",scope:"this_lane"}},position:"top"}],middleEffects:[{id:"metal_0_flip",trigger:"on_play",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any"}},position:"middle"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"metal_1_draw",trigger:"on_play",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"middle"},{id:"metal_1_block_compile",trigger:"on_play",params:{action:"block_compile",target:"opponent"},position:"middle"}],bottomEffects:[]},{value:2,topEffects:[{id:"metal_2_block_face_down",trigger:"passive",params:{action:"passive_rule",rule:{type:"block_face_down_play",scope:"this_lane"}},position:"top"}],middleEffects:[],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"metal_3_draw",trigger:"on_play",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"middle"},{id:"metal_3_delete_lane",trigger:"on_play",params:{action:"delete_all_in_lane",laneCondition:{type:"min_cards",count:8},excludeCurrentLane:!0},position:"middle"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"metal_5_discard",trigger:"on_play",params:{action:"discard",count:1,actor:"self"},position:"middle"}],bottomEffects:[]},{value:6,topEffects:[{id:"metal_6_delete_on_cover_or_flip",trigger:"on_cover_or_flip",params:{action:"delete",deleteSelf:!0},position:"top"}],middleEffects:[],bottomEffects:[]}],l1="Main 1",Rm={id:e1,name:t1,description:n1,color:a1,pattern:o1,cards:r1,category:l1},s1="plague-custom-001",c1="Plague",i1="Focused on forcing opponent discards and restricting their plays. Spread suffering.",d1="System Migration",u1="2025-11-26T00:00:00.000Z",f1="#8FBC3A",p1="dual-radial",h1=[{value:0,topEffects:[],middleEffects:[{id:"plague-0-opponent-discard",params:{action:"discard",count:1,actor:"opponent"},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"plague-0-block-play",params:{action:"passive_rule",rule:{type:"block_all_play",target:"opponent",scope:"this_lane"}},position:"bottom",trigger:"passive"}]},{value:1,topEffects:[{id:"plague-1-reactive-draw",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"top",trigger:"after_opponent_discard"}],middleEffects:[{id:"plague-1-opponent-discard",params:{action:"discard",count:1,actor:"opponent"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"plague-2-self-discard",params:{action:"discard",count:1,actor:"self",variableCount:!0},position:"middle",trigger:"on_play",conditional:{type:"then",thenEffect:{id:"plague-2-opponent-discard",params:{action:"discard",actor:"opponent",countType:"equal_to_discarded",countOffset:1},position:"middle",trigger:"on_play"}}}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"plague-3-flip-each-other",params:{action:"flip",count:"all",scope:{type:"anywhere"},targetFilter:{faceState:"face_up",owner:"any",position:"uncovered",excludeSelf:!0}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,text:{bottom:"<div><span class='emphasis'>End:</span> Your opponent deletes 1 of their face-down cards. You may flip this card.</div>"},topEffects:[],middleEffects:[],bottomEffects:[{id:"plague-4-opponent-delete",params:{action:"delete",count:1,targetFilter:{faceState:"face_down",owner:"opponent",position:"uncovered"},scope:{type:"anywhere"},actorChooses:"card_owner"},position:"bottom",trigger:"end"},{id:"plague-4-may-flip-self",params:{action:"flip",flipSelf:!0,optional:!0},position:"bottom",trigger:"end"}]},{value:5,topEffects:[],middleEffects:[{id:"plague-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],m1="Main 1",Am={id:s1,name:c1,description:i1,author:d1,createdAt:u1,color:f1,pattern:p1,cards:h1,category:m1},y1="love_custom_v1",g1="Love",v1="Custom Love protocol - hand manipulation, giving and taking cards",_1="System",x1="2025-01-08T00:00:00Z",w1="#f2a3d7",C1="radial",b1=[{value:1,topEffects:[],middleEffects:[{id:"love-1-draw-opponent-deck",params:{action:"draw",count:1,target:"self",source:"opponent_deck"},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"love-1-end-give",params:{action:"give",count:1,source:"own_hand",optional:!0},conditional:{type:"if_executed",thenEffect:{id:"love-1-end-draw",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"bottom",trigger:"on_play"}},position:"bottom",trigger:"end"}]},{value:2,topEffects:[],middleEffects:[{id:"love-2-opponent-draw",params:{action:"draw",count:1,target:"opponent",source:"own_deck"},position:"middle",trigger:"on_play"},{id:"love-2-refresh",params:{action:"refresh",target:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"love-3-take",params:{action:"take",count:1,random:!0},position:"middle",trigger:"on_play"},{id:"love-3-give",params:{action:"give",count:1,source:"own_hand",optional:!1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"love-4-reveal",params:{action:"reveal",count:1,source:"own_hand"},position:"middle",trigger:"on_play"},{id:"love-4-flip",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"love-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:6,topEffects:[],middleEffects:[{id:"love-6-opponent-draw",params:{action:"draw",count:2,target:"opponent",source:"own_deck"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],S1="Aux 1",Tm={id:y1,name:g1,description:v1,author:_1,createdAt:x1,color:w1,pattern:C1,cards:b1,category:S1},E1="psychic_custom_v1",j1="Psychic",k1="Custom Psychic protocol - mind control, discard, reveal, and protocol manipulation",N1="System",R1="2025-01-08T00:00:00Z",A1="#c78dd9",T1="radial",D1=[{value:0,topEffects:[],middleEffects:[{id:"psychic-0-draw",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"middle",trigger:"on_play"},{id:"psychic-0-opponent-discard",params:{action:"discard",count:2,actor:"opponent"},position:"middle",trigger:"on_play"},{id:"psychic-0-reveal-hand",params:{action:"reveal",source:"opponent_hand",count:-1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[{id:"psychic-1-force-face-down",params:{action:"passive_rule",rule:{type:"require_face_down_play",target:"opponent",scope:"global"}},position:"top",trigger:"passive"}],middleEffects:[],bottomEffects:[{id:"psychic-1-start-flip-self",params:{action:"flip",count:1,targetFilter:{owner:"self",position:"any",faceState:"any",excludeSelf:!1},flipSelf:!0},position:"bottom",trigger:"start"}]},{value:2,topEffects:[],middleEffects:[{id:"psychic-2-opponent-discard",params:{action:"discard",count:2,actor:"opponent"},position:"middle",trigger:"on_play"},{id:"psychic-2-rearrange",params:{action:"rearrange_protocols",target:"opponent"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"psychic-3-opponent-discard",params:{action:"discard",count:1,actor:"opponent"},position:"middle",trigger:"on_play"},{id:"psychic-3-shift-opponent",params:{action:"shift",targetFilter:{owner:"opponent",position:"uncovered",faceState:"any",excludeSelf:!1},destinationRestriction:{type:"any"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[],bottomEffects:[{id:"psychic-4-end-return",params:{action:"return",count:1,optional:!0,targetFilter:{owner:"opponent",position:"uncovered",faceState:"any",excludeSelf:!1}},conditional:{type:"if_executed",thenEffect:{id:"psychic-4-end-flip-self",params:{action:"flip",count:1,flipSelf:!0,targetFilter:{owner:"self",position:"any",faceState:"any",excludeSelf:!1}},position:"bottom",trigger:"end"}},position:"bottom",trigger:"end"}]},{value:5,topEffects:[],middleEffects:[{id:"psychic-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],F1="Main 1",Dm={id:E1,name:j1,description:k1,author:N1,createdAt:R1,color:A1,pattern:T1,cards:D1,category:F1},q1="smoke-custom-001",$1="Smoke",I1="Shroud your cards in mystery. Use face-down cards to gain value and control.",U1="System",P1="2025-12-09T00:00:00.000Z",L1="#5A5A5A",O1="radial",M1=[{value:0,topEffects:[],middleEffects:[{id:"smoke-0-play-deck-each-facedown",params:{action:"play",source:"deck",count:1,faceDown:!0,destinationRule:{type:"each_line_with_card",cardFilter:{faceState:"face_down"}}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"smoke-1-flip-own",params:{action:"flip",count:1,targetFilter:{owner:"own",position:"uncovered",faceState:"any"},optional:!1},position:"middle",trigger:"on_play"},{id:"smoke-1-shift-that-card",params:{action:"shift",optional:!0,targetFilter:{owner:"own",position:"uncovered",faceState:"any"}},position:"middle",trigger:"on_play",useCardFromPreviousEffect:!0}],bottomEffects:[]},{value:2,topEffects:[{id:"smoke-2-value-per-facedown",params:{action:"value_modifier",modifier:{type:"add_per_condition",value:1,condition:"per_face_down_card",target:"own_total",scope:"this_lane"}},position:"top",trigger:"passive"}],middleEffects:[],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"smoke-3-play-hand-facedown-lane",params:{action:"play",source:"hand",count:1,faceDown:!0,destinationRule:{type:"line_with_matching_cards",cardFilter:{faceState:"face_down"}}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"smoke-4-shift-covered-facedown",params:{action:"shift",optional:!1,targetFilter:{owner:"any",position:"covered",faceState:"face_down"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"smoke-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],H1="Main 2",Fm={id:q1,name:$1,description:I1,author:U1,createdAt:P1,color:L1,pattern:O1,cards:M1,category:H1},z1="clarity-custom-001",V1="Clarity",B1="See through the fog of war. Reveal your deck and hand to gain powerful advantages.",Y1="System",G1="2025-12-09T00:00:00.000Z",W1="#87CEEB",Q1="radial",X1=[{value:0,topEffects:[{id:"clarity-0-value-per-hand",params:{action:"value_modifier",modifier:{type:"add_per_condition",value:1,condition:"per_card_in_hand",target:"own_total",scope:"this_lane"}},position:"top",trigger:"passive"}],middleEffects:[],bottomEffects:[]},{value:1,topEffects:[{id:"clarity-1-start-reveal-deck-top",params:{action:"reveal",source:"own_deck_top",count:1},position:"top",trigger:"start",conditional:{type:"optional",thenEffect:{id:"clarity-1-discard-revealed",params:{action:"discard",count:1,actor:"self",useCardFromPreviousEffect:!0}}}}],middleEffects:[{id:"clarity-1-middle-reveal-opponent-hand",params:{action:"reveal",source:"opponent_hand",count:-1},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"clarity-1-bottom-draw-3",params:{action:"draw",count:3,target:"self",source:"own_deck"},position:"bottom",trigger:"on_cover"}]},{value:2,topEffects:[],middleEffects:[{id:"clarity-2-reveal-deck",params:{action:"reveal",source:"own_deck",count:-1},position:"middle",trigger:"on_play"},{id:"clarity-2-draw-value-1",params:{action:"draw",count:1,target:"self",source:"own_deck",valueFilter:{equals:1},fromRevealed:!0},position:"middle",trigger:"on_play"},{id:"clarity-2-shuffle-deck",params:{action:"shuffle_deck"},position:"middle",trigger:"on_play"},{id:"clarity-2-play-value-1",params:{action:"play",source:"hand",count:1,faceDown:!1,valueFilter:{equals:1}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"clarity-3-reveal-deck",params:{action:"reveal",source:"own_deck",count:-1},position:"middle",trigger:"on_play"},{id:"clarity-3-draw-value-5",params:{action:"draw",count:1,target:"self",source:"own_deck",valueFilter:{equals:5},fromRevealed:!0},position:"middle",trigger:"on_play"},{id:"clarity-3-shuffle-deck",params:{action:"shuffle_deck"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"clarity-4-shuffle-trash",params:{action:"shuffle_trash",optional:!0},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"clarity-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],Z1="Main 2",qm={id:z1,name:V1,description:B1,author:Y1,createdAt:G1,color:W1,pattern:Q1,cards:X1,category:Z1},K1="corruption-custom-001",J1="Corruption",eC="Corrupt your opponents plans. Use discard synergies and manipulate the return mechanic.",tC="System",nC="2025-12-09T00:00:00.000Z",aC="#4A0080",oC="stripes",rC=[{value:0,topEffects:[{id:"corruption-0-start-flip",params:{action:"flip",count:1,scope:"this_lane",targetFilter:{owner:"own",position:"any",faceState:"face_up",excludeSelf:!0},optional:!1},position:"top",trigger:"start"}],middleEffects:[],bottomEffects:[{id:"corruption-0-play-opponent-side",params:{action:"passive_rule",rule:{type:"allow_play_on_opponent_side",target:"self",scope:"global"}},position:"bottom",trigger:"passive"}]},{value:1,topEffects:[],middleEffects:[{id:"corruption-1-return",params:{action:"return",count:1,targetFilter:{owner:"any",position:"uncovered"}},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"corruption-1-redirect-return",params:{action:"redirect_return_to_deck",faceDown:!0,targetOwner:"opponent"},position:"bottom",trigger:"when_card_returned"}]},{value:2,topEffects:[{id:"corruption-2-after-discard",params:{action:"discard",count:1,actor:"opponent"},position:"top",trigger:"after_discard",reactiveTriggerActor:"self"}],middleEffects:[{id:"corruption-2-draw",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"middle",trigger:"on_play"},{id:"corruption-2-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"corruption-3-flip-covered",params:{action:"flip",count:1,optional:!0,targetFilter:{owner:"any",position:"covered",faceState:"face_up",excludeSelf:!1}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"corruption-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:6,topEffects:[{id:"corruption-6-end-choice",params:{action:"choice",options:[{id:"corruption-6-choice-discard",params:{action:"discard",count:1,actor:"self"},position:"top",trigger:"end"},{id:"corruption-6-choice-delete-self",params:{action:"delete",deleteSelf:!0},position:"top",trigger:"end"}]},position:"top",trigger:"end"}],middleEffects:[],bottomEffects:[]}],lC="Main 2",$m={id:K1,name:J1,description:eC,author:tC,createdAt:nC,color:aC,pattern:oC,cards:rC,category:lC},sC="courage-custom-001",cC="Courage",iC="Face challenges head-on. Gain power when outnumbered.",dC="System",uC="2025-12-10T00:00:00.000Z",fC="#D4AF37",pC="radial",hC=[{value:0,topEffects:[{id:"courage-0-start-draw",params:{action:"draw",count:1,advancedConditional:{type:"empty_hand"}},position:"top",trigger:"start"}],middleEffects:[{id:"courage-0-draw",params:{action:"draw",count:1},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"courage-0-end-discard",params:{action:"discard",count:1,optional:!0},position:"bottom",trigger:"end",conditional:{type:"if_executed",thenEffect:{id:"courage-0-opponent-discard",params:{action:"discard",count:1,actor:"opponent"},position:"bottom",trigger:"end"}}}]},{value:1,topEffects:[],middleEffects:[{id:"courage-1-delete",params:{action:"delete",count:1,targetFilter:{owner:"opponent",position:"uncovered"},selectLane:!0,laneCondition:{type:"opponent_higher_value"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"courage-2-draw",params:{action:"draw",count:1},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"courage-2-end-draw",params:{action:"draw",count:1,advancedConditional:{type:"opponent_higher_value_in_lane"}},position:"bottom",trigger:"end"}]},{value:3,topEffects:[],middleEffects:[],bottomEffects:[{id:"courage-3-shift",params:{action:"shift",shiftSelf:!0,optional:!0,destinationRestriction:{type:"opponent_highest_value_lane"}},position:"bottom",trigger:"end"}]},{value:5,topEffects:[],middleEffects:[{id:"courage-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:6,topEffects:[{id:"courage-6-flip",params:{action:"flip",flipSelf:!0,advancedConditional:{type:"opponent_higher_value_in_lane"}},position:"top",trigger:"end"}],middleEffects:[],bottomEffects:[]}],mC="Main 2",Im={id:sC,name:cC,description:iC,author:dC,createdAt:uC,color:fC,pattern:pC,cards:hC,category:mC},yC="fear_custom",gC="Fear",vC="Terror and disruption protocol - Control through fear",_C="System",xC="2025-01-10T00:00:00Z",wC="#800020",CC="radial",bC="Main 2",SC=[{value:0,topEffects:[{id:"fear-0-passive",params:{action:"passive_rule",rule:{type:"ignore_middle_commands",target:"opponent",scope:"global",onlyDuringYourTurn:!0}},position:"top",trigger:"passive"}],middleEffects:[{id:"fear-0-choice",params:{action:"choice",options:[{id:"fear-0-shift",params:{action:"shift",targetFilter:{owner:"any",position:"uncovered",faceState:"any"}},position:"middle",trigger:"on_play"},{id:"fear-0-flip",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1},optional:!1},position:"middle",trigger:"on_play"}]},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"fear-1-draw",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"middle",trigger:"on_play",conditional:{type:"then",thenEffect:{id:"fear-1-opponent-discard-hand",params:{action:"discard",count:"all",actor:"opponent"},position:"middle",trigger:"on_play",conditional:{type:"then",thenEffect:{id:"fear-1-opponent-draw",params:{action:"draw",countType:"equal_to_discarded",countOffset:-1,target:"opponent",source:"own_deck"},position:"middle",trigger:"on_play"}}}}}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"fear-2-return",params:{action:"return",count:1,targetFilter:{owner:"opponent"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"fear-3-shift",params:{action:"shift",targetFilter:{owner:"opponent",position:"any",faceState:"any"},scope:"this_lane"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"fear-4-discard-random",params:{action:"discard",count:1,actor:"opponent",random:!0},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"fear-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],Um={id:yC,name:gC,description:vC,author:_C,createdAt:xC,color:wC,pattern:CC,category:bC,cards:SC},EC="ice_custom",jC="Ice",kC="Control and disruption through shifting and conditional effects",NC="System",RC="2025-12-10T00:00:00Z",AC="#B0E0E6",TC="radial",DC="Main 2",FC=[{value:1,topEffects:[],middleEffects:[{id:"ice-1-shift",params:{action:"shift",shiftSelf:!0,optional:!0},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"ice-1-reactive",params:{action:"discard",actor:"opponent",count:1},position:"bottom",trigger:"after_play",reactiveTriggerActor:"opponent",reactiveScope:"this_lane"}]},{value:2,topEffects:[],middleEffects:[{id:"ice-2-shift",params:{action:"shift",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!0}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[{id:"ice-3-end-shift",params:{action:"shift",shiftSelf:!0,optional:!0,advancedConditional:{type:"this_card_is_covered"}},position:"top",trigger:"end"}],middleEffects:[],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[],bottomEffects:[{id:"ice-4-passive",params:{action:"passive_rule",rule:{type:"block_flip_this_card",target:"this_card",scope:"this_card"}},position:"bottom",trigger:"passive"}]},{value:5,topEffects:[],middleEffects:[{id:"ice-5-discard",params:{action:"discard",actor:"self",count:1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:6,topEffects:[{id:"ice-6-passive",params:{action:"passive_rule",rule:{type:"block_draw_conditional",conditionTarget:"self",blockTarget:"self",scope:"global"}},position:"top",trigger:"passive"}],middleEffects:[],bottomEffects:[]}],Pm={id:EC,name:jC,description:kC,author:NC,createdAt:RC,color:AC,pattern:TC,category:DC,cards:FC};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const qC=[mm,ym,gm,vm,_m,xm,wm,Cm,bm,Sm,Em,jm,km,Nm,Rm,Am,Tm,Dm,Fm,qm,$m,Im,Um,Pm],$C=()=>qC.map(a=>a.name.replace(/_custom$/i,"")),IC=()=>{try{const a=Qo(),n=a.findIndex(l=>l.id==="dark_cust_v2"||l.name==="Dark_cust");n>=0&&(a.splice(n,1),Ud(a)),vt(mm),vt(ym),vt(vm),vt(_m),vt(xm),vt(bm),vt(Sm),vt(gm),vt(Em),vt(wm),vt(Cm),vt(jm),vt(km),vt(Nm),vt(Rm),vt(Am),vt(Tm),vt(Dm),vt(Fm),vt(qm),vt($m),vt(Im),vt(Um),vt(Pm)}catch(a){console.error("[Default Protocols] Error loading default protocols:",a)}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const zd="compile_game_statistics",Lm=()=>{const a=__,n=$C(),l=new Set([...a,...n]);return Array.from(l).sort()},Om=1;function Bh(){const a=Lm(),n={};return a.forEach(l=>{n[l]={timesUsed:0,wins:0,losses:0}}),{version:Om,global:{totalGamesPlayed:0,totalGamesWon:0,totalGamesLost:0,totalPlaytime:0,fastestWin:null,longestGame:null,lastGameDuration:null,currentStreak:0,longestWinStreak:0,longestLoseStreak:0},protocols:n,aiDifficulty:{easy:{played:0,wins:0,losses:0},normal:{played:0,wins:0,losses:0},hard:{played:0,wins:0,losses:0}},cards:{played:{},deleted:{}},actions:{totalCardsDrawn:0,totalCardsPlayed:0,totalShifts:0,totalDeletes:0,totalDiscards:0,totalFlips:0,totalCompiles:0,totalRefreshes:0,totalReturns:0,detailedStats:{cardsPlayed:{total:0,player:0,ai:0,playerFromHand:0,playerFromEffect:0,aiFromHand:0,aiFromEffect:0,playerFaceUp:0,playerFaceDown:0,aiFaceUp:0,aiFaceDown:0},cardsDrawn:{total:0,player:0,ai:0,playerFromRefresh:0,playerFromEffect:0,aiFromRefresh:0,aiFromEffect:0},discards:{total:0,player:0,ai:0},deletes:{total:0,player:0,ai:0},flips:{total:0,player:0,ai:0},shifts:{total:0,player:0,ai:0},returns:{total:0,player:0,ai:0},compiles:{total:0,player:0,ai:0,playerFirstCompile:0,playerRecompile:0,aiFirstCompile:0,aiRecompile:0},refreshes:{total:0,player:0,ai:0,playerCardsDrawn:0,aiCardsDrawn:0}}},control:{gamesWithControl:0,gamesWithoutControl:0,playerRearranges:0,aiRearranges:0,totalRearranges:0},coinFlip:{headsChosen:0,tailsChosen:0,headsWon:0,tailsWon:0}}}function $d(){var a,n,l,c,i,d,u,h,f,m,y,v,_,w,b,N,S,k,C,j,R,F,L,U,Q,X,V,$,E,A,O,I,T,q,Y,K,P,Z,W,G,H,B,ee,de,J,pe,fe,ye,ke,Ve,Le,at,Te,qe,_t,Ft,He,$e,nt,ot,Pt,bt,xt,yt,Mt,wt,Vn,ga,ta,Tn,un,qt,tn,xn,va,na,aa,Bn,fn,Yn,oa,ra,Gn,Wn,la,sa,nn,St,At,ue,Ce,Re,Ie,De,ze,Je,Be,Fe,rt,Qt,me,xe,be,We,Et,rn,ca,ln,Dn,Fn,sn,pn,bo,Bt,Qn,Ma,Ha,Zo,So,Xt,ia,Ht,za,_a,Eo,Kl,cn,Ko,Vr,Jo,xa,Br,Yr,wa,Jl,Gr,Wr,er,es,ts,jo,tr,nr,Ca,ba,Qr,ar;try{const ko=localStorage.getItem(zd);if(!ko)return Bh();const Se=JSON.parse(ko),Xn=Lm(),Va={...Se.protocols||{}};Xn.forEach(or=>{Va[or]||(Va[or]={timesUsed:0,wins:0,losses:0})});const Ba={...Se,version:Om,global:{...Se.global,lastGameDuration:((a=Se.global)==null?void 0:a.lastGameDuration)||null},protocols:Va,control:{gamesWithControl:((n=Se.control)==null?void 0:n.gamesWithControl)||0,gamesWithoutControl:((l=Se.control)==null?void 0:l.gamesWithoutControl)||0,playerRearranges:((c=Se.control)==null?void 0:c.playerRearranges)||0,aiRearranges:((i=Se.control)==null?void 0:i.aiRearranges)||0,totalRearranges:((d=Se.control)==null?void 0:d.totalRearranges)||0},coinFlip:Se.coinFlip||{headsChosen:0,tailsChosen:0,headsWon:0,tailsWon:0},actions:{...Se.actions,totalCompiles:((u=Se.actions)==null?void 0:u.totalCompiles)||0,totalRefreshes:((h=Se.actions)==null?void 0:h.totalRefreshes)||0,totalReturns:((f=Se.actions)==null?void 0:f.totalReturns)||0,detailedStats:{cardsPlayed:{total:((v=(y=(m=Se.actions)==null?void 0:m.detailedStats)==null?void 0:y.cardsPlayed)==null?void 0:v.total)||0,player:((b=(w=(_=Se.actions)==null?void 0:_.detailedStats)==null?void 0:w.cardsPlayed)==null?void 0:b.player)||0,ai:((k=(S=(N=Se.actions)==null?void 0:N.detailedStats)==null?void 0:S.cardsPlayed)==null?void 0:k.ai)||0,playerFromHand:((R=(j=(C=Se.actions)==null?void 0:C.detailedStats)==null?void 0:j.cardsPlayed)==null?void 0:R.playerFromHand)||0,playerFromEffect:((U=(L=(F=Se.actions)==null?void 0:F.detailedStats)==null?void 0:L.cardsPlayed)==null?void 0:U.playerFromEffect)||0,aiFromHand:((V=(X=(Q=Se.actions)==null?void 0:Q.detailedStats)==null?void 0:X.cardsPlayed)==null?void 0:V.aiFromHand)||0,aiFromEffect:((A=(E=($=Se.actions)==null?void 0:$.detailedStats)==null?void 0:E.cardsPlayed)==null?void 0:A.aiFromEffect)||0,playerFaceUp:((T=(I=(O=Se.actions)==null?void 0:O.detailedStats)==null?void 0:I.cardsPlayed)==null?void 0:T.playerFaceUp)||0,playerFaceDown:((K=(Y=(q=Se.actions)==null?void 0:q.detailedStats)==null?void 0:Y.cardsPlayed)==null?void 0:K.playerFaceDown)||0,aiFaceUp:((W=(Z=(P=Se.actions)==null?void 0:P.detailedStats)==null?void 0:Z.cardsPlayed)==null?void 0:W.aiFaceUp)||0,aiFaceDown:((B=(H=(G=Se.actions)==null?void 0:G.detailedStats)==null?void 0:H.cardsPlayed)==null?void 0:B.aiFaceDown)||0},cardsDrawn:{total:((J=(de=(ee=Se.actions)==null?void 0:ee.detailedStats)==null?void 0:de.cardsDrawn)==null?void 0:J.total)||0,player:((ye=(fe=(pe=Se.actions)==null?void 0:pe.detailedStats)==null?void 0:fe.cardsDrawn)==null?void 0:ye.player)||0,ai:((Le=(Ve=(ke=Se.actions)==null?void 0:ke.detailedStats)==null?void 0:Ve.cardsDrawn)==null?void 0:Le.ai)||0,playerFromRefresh:((qe=(Te=(at=Se.actions)==null?void 0:at.detailedStats)==null?void 0:Te.cardsDrawn)==null?void 0:qe.playerFromRefresh)||0,playerFromEffect:((He=(Ft=(_t=Se.actions)==null?void 0:_t.detailedStats)==null?void 0:Ft.cardsDrawn)==null?void 0:He.playerFromEffect)||0,aiFromRefresh:((ot=(nt=($e=Se.actions)==null?void 0:$e.detailedStats)==null?void 0:nt.cardsDrawn)==null?void 0:ot.aiFromRefresh)||0,aiFromEffect:((xt=(bt=(Pt=Se.actions)==null?void 0:Pt.detailedStats)==null?void 0:bt.cardsDrawn)==null?void 0:xt.aiFromEffect)||0},discards:{total:((wt=(Mt=(yt=Se.actions)==null?void 0:yt.detailedStats)==null?void 0:Mt.discards)==null?void 0:wt.total)||0,player:((ta=(ga=(Vn=Se.actions)==null?void 0:Vn.detailedStats)==null?void 0:ga.discards)==null?void 0:ta.player)||0,ai:((qt=(un=(Tn=Se.actions)==null?void 0:Tn.detailedStats)==null?void 0:un.discards)==null?void 0:qt.ai)||0},deletes:{total:((va=(xn=(tn=Se.actions)==null?void 0:tn.detailedStats)==null?void 0:xn.deletes)==null?void 0:va.total)||0,player:((Bn=(aa=(na=Se.actions)==null?void 0:na.detailedStats)==null?void 0:aa.deletes)==null?void 0:Bn.player)||0,ai:((oa=(Yn=(fn=Se.actions)==null?void 0:fn.detailedStats)==null?void 0:Yn.deletes)==null?void 0:oa.ai)||0},flips:{total:((Wn=(Gn=(ra=Se.actions)==null?void 0:ra.detailedStats)==null?void 0:Gn.flips)==null?void 0:Wn.total)||0,player:((nn=(sa=(la=Se.actions)==null?void 0:la.detailedStats)==null?void 0:sa.flips)==null?void 0:nn.player)||0,ai:((ue=(At=(St=Se.actions)==null?void 0:St.detailedStats)==null?void 0:At.flips)==null?void 0:ue.ai)||0},shifts:{total:((Ie=(Re=(Ce=Se.actions)==null?void 0:Ce.detailedStats)==null?void 0:Re.shifts)==null?void 0:Ie.total)||0,player:((Je=(ze=(De=Se.actions)==null?void 0:De.detailedStats)==null?void 0:ze.shifts)==null?void 0:Je.player)||0,ai:((rt=(Fe=(Be=Se.actions)==null?void 0:Be.detailedStats)==null?void 0:Fe.shifts)==null?void 0:rt.ai)||0},returns:{total:((xe=(me=(Qt=Se.actions)==null?void 0:Qt.detailedStats)==null?void 0:me.returns)==null?void 0:xe.total)||0,player:((Et=(We=(be=Se.actions)==null?void 0:be.detailedStats)==null?void 0:We.returns)==null?void 0:Et.player)||0,ai:((ln=(ca=(rn=Se.actions)==null?void 0:rn.detailedStats)==null?void 0:ca.returns)==null?void 0:ln.ai)||0},compiles:{total:((sn=(Fn=(Dn=Se.actions)==null?void 0:Dn.detailedStats)==null?void 0:Fn.compiles)==null?void 0:sn.total)||0,player:((Bt=(bo=(pn=Se.actions)==null?void 0:pn.detailedStats)==null?void 0:bo.compiles)==null?void 0:Bt.player)||0,ai:((Ha=(Ma=(Qn=Se.actions)==null?void 0:Qn.detailedStats)==null?void 0:Ma.compiles)==null?void 0:Ha.ai)||0,playerFirstCompile:((Xt=(So=(Zo=Se.actions)==null?void 0:Zo.detailedStats)==null?void 0:So.compiles)==null?void 0:Xt.playerFirstCompile)||0,playerRecompile:((za=(Ht=(ia=Se.actions)==null?void 0:ia.detailedStats)==null?void 0:Ht.compiles)==null?void 0:za.playerRecompile)||0,aiFirstCompile:((Kl=(Eo=(_a=Se.actions)==null?void 0:_a.detailedStats)==null?void 0:Eo.compiles)==null?void 0:Kl.aiFirstCompile)||0,aiRecompile:((Vr=(Ko=(cn=Se.actions)==null?void 0:cn.detailedStats)==null?void 0:Ko.compiles)==null?void 0:Vr.aiRecompile)||0},refreshes:{total:((Br=(xa=(Jo=Se.actions)==null?void 0:Jo.detailedStats)==null?void 0:xa.refreshes)==null?void 0:Br.total)||0,player:((Jl=(wa=(Yr=Se.actions)==null?void 0:Yr.detailedStats)==null?void 0:wa.refreshes)==null?void 0:Jl.player)||0,ai:((er=(Wr=(Gr=Se.actions)==null?void 0:Gr.detailedStats)==null?void 0:Wr.refreshes)==null?void 0:er.ai)||0,playerCardsDrawn:((jo=(ts=(es=Se.actions)==null?void 0:es.detailedStats)==null?void 0:ts.refreshes)==null?void 0:jo.playerCardsDrawn)||0,aiCardsDrawn:((Ca=(nr=(tr=Se.actions)==null?void 0:tr.detailedStats)==null?void 0:nr.refreshes)==null?void 0:Ca.aiCardsDrawn)||0}}}};return(!((ba=Se.control)!=null&&ba.playerRearranges)||!Se.coinFlip||!((Qr=Se.actions)!=null&&Qr.totalCompiles)||!((ar=Se.actions)!=null&&ar.detailedStats)||Object.keys(Va).length!==Object.keys(Se.protocols||{}).length)&&Ur(Ba),Ba}catch(ko){return console.error("Failed to load statistics:",ko),Bh()}}function Ur(a){try{localStorage.setItem(zd,JSON.stringify(a))}catch(n){console.error("Failed to save statistics:",n)}}function UC(){try{localStorage.removeItem(zd)}catch(a){console.error("Failed to reset statistics:",a)}}function PC(a,n,l,c,i,d=!1,u,h,f,m){const y=n==="player",v={...a.global},_={...a.protocols},w={easy:{...a.aiDifficulty.easy},normal:{...a.aiDifficulty.normal},hard:{...a.aiDifficulty.hard}},b={...a.control},N={...a.actions},S={...a.coinFlip},k={played:{...a.cards.played},deleted:{...a.cards.deleted}};v.totalGamesPlayed++,y?v.totalGamesWon++:v.totalGamesLost++,v.totalPlaytime+=i,y&&(v.fastestWin===null||i<v.fastestWin)&&(v.fastestWin=i),(v.longestGame===null||i>v.longestGame)&&(v.longestGame=i),v.lastGameDuration=i,y?(v.currentStreak>=0?v.currentStreak++:v.currentStreak=1,v.currentStreak>v.longestWinStreak&&(v.longestWinStreak=v.currentStreak)):(v.currentStreak<=0?v.currentStreak--:v.currentStreak=-1,Math.abs(v.currentStreak)>v.longestLoseStreak&&(v.longestLoseStreak=Math.abs(v.currentStreak))),l.forEach(j=>{_[j]?_[j]={..._[j]}:_[j]={timesUsed:0,wins:0,losses:0},_[j].timesUsed++,y?_[j].wins++:_[j].losses++}),w[c].played++,y?w[c].wins++:w[c].losses++,d?b.gamesWithControl++:b.gamesWithoutControl++;const C={cardsPlayed:{...a.actions.detailedStats.cardsPlayed},cardsDrawn:{...a.actions.detailedStats.cardsDrawn},discards:{...a.actions.detailedStats.discards},deletes:{...a.actions.detailedStats.deletes},flips:{...a.actions.detailedStats.flips},shifts:{...a.actions.detailedStats.shifts},returns:{...a.actions.detailedStats.returns},compiles:{...a.actions.detailedStats.compiles},refreshes:{...a.actions.detailedStats.refreshes}};return u&&(N.totalCardsPlayed+=u.cardsPlayed,N.totalCardsDrawn+=u.cardsDrawn,N.totalDiscards+=u.cardsDiscarded,N.totalDeletes+=u.cardsDeleted,N.totalFlips+=u.cardsFlipped,N.totalShifts+=u.cardsShifted,N.totalRefreshes+=u.handsRefreshed,N.totalReturns+=u.cardsReturned||0,C.cardsPlayed.total+=u.cardsPlayed,C.cardsPlayed.player+=u.cardsPlayed,C.cardsDrawn.total+=u.cardsDrawn,C.cardsDrawn.player+=u.cardsDrawn,C.discards.total+=u.cardsDiscarded,C.discards.player+=u.cardsDiscarded,C.deletes.total+=u.cardsDeleted,C.deletes.player+=u.cardsDeleted,C.flips.total+=u.cardsFlipped,C.flips.player+=u.cardsFlipped,C.shifts.total+=u.cardsShifted,C.shifts.player+=u.cardsShifted,C.returns.total+=u.cardsReturned||0,C.returns.player+=u.cardsReturned||0,C.refreshes.total+=u.handsRefreshed,C.refreshes.player+=u.handsRefreshed),f&&(N.totalCardsPlayed+=f.cardsPlayed,N.totalCardsDrawn+=f.cardsDrawn,N.totalDiscards+=f.cardsDiscarded,N.totalDeletes+=f.cardsDeleted,N.totalFlips+=f.cardsFlipped,N.totalShifts+=f.cardsShifted,N.totalRefreshes+=f.handsRefreshed,N.totalReturns+=f.cardsReturned||0,C.cardsPlayed.total+=f.cardsPlayed,C.cardsPlayed.ai+=f.cardsPlayed,C.cardsDrawn.total+=f.cardsDrawn,C.cardsDrawn.ai+=f.cardsDrawn,C.discards.total+=f.cardsDiscarded,C.discards.ai+=f.cardsDiscarded,C.deletes.total+=f.cardsDeleted,C.deletes.ai+=f.cardsDeleted,C.flips.total+=f.cardsFlipped,C.flips.ai+=f.cardsFlipped,C.shifts.total+=f.cardsShifted,C.shifts.ai+=f.cardsShifted,C.returns.total+=f.cardsReturned||0,C.returns.ai+=f.cardsReturned||0,C.refreshes.total+=f.handsRefreshed,C.refreshes.ai+=f.handsRefreshed),m&&(m.cardsPlayed&&(C.cardsPlayed.playerFromHand+=m.cardsPlayed.playerFromHand,C.cardsPlayed.playerFromEffect+=m.cardsPlayed.playerFromEffect,C.cardsPlayed.aiFromHand+=m.cardsPlayed.aiFromHand,C.cardsPlayed.aiFromEffect+=m.cardsPlayed.aiFromEffect,C.cardsPlayed.playerFaceUp+=m.cardsPlayed.playerFaceUp,C.cardsPlayed.playerFaceDown+=m.cardsPlayed.playerFaceDown,C.cardsPlayed.aiFaceUp+=m.cardsPlayed.aiFaceUp,C.cardsPlayed.aiFaceDown+=m.cardsPlayed.aiFaceDown),m.cardsDrawn&&(C.cardsDrawn.playerFromRefresh+=m.cardsDrawn.playerFromRefresh,C.cardsDrawn.playerFromEffect+=m.cardsDrawn.playerFromEffect,C.cardsDrawn.aiFromRefresh+=m.cardsDrawn.aiFromRefresh,C.cardsDrawn.aiFromEffect+=m.cardsDrawn.aiFromEffect),m.compiles&&(C.compiles.playerFirstCompile+=m.compiles.playerFirstCompile,C.compiles.playerRecompile+=m.compiles.playerRecompile,C.compiles.aiFirstCompile+=m.compiles.aiFirstCompile,C.compiles.aiRecompile+=m.compiles.aiRecompile,C.compiles.player+=m.compiles.playerFirstCompile+m.compiles.playerRecompile,C.compiles.ai+=m.compiles.aiFirstCompile+m.compiles.aiRecompile,C.compiles.total+=m.compiles.playerFirstCompile+m.compiles.playerRecompile+m.compiles.aiFirstCompile+m.compiles.aiRecompile),m.refreshes&&(C.refreshes.playerCardsDrawn+=m.refreshes.playerCardsDrawn,C.refreshes.aiCardsDrawn+=m.refreshes.aiCardsDrawn)),h!==void 0&&(N.totalCompiles+=h),N.detailedStats=C,{version:a.version,global:v,protocols:_,aiDifficulty:w,cards:k,actions:N,control:b,coinFlip:S}}function LC(a,n){const l={...a,cards:{...a.cards,played:{...a.cards.played}}};return l.cards.played[n]||(l.cards.played[n]=0),l.cards.played[n]++,l}function OC(a,n){const l={...a,cards:{...a.cards,deleted:{...a.cards.deleted}}};return l.cards.deleted[n]||(l.cards.deleted[n]=0),l.cards.deleted[n]++,l}function MC(a,n){const l={...a,control:{...a.control}};return n==="player"?l.control.playerRearranges++:l.control.aiRearranges++,l.control.totalRearranges++,l}function HC(a,n,l){const c={...a,coinFlip:{...a.coinFlip}};return n==="heads"?(c.coinFlip.headsChosen++,l&&c.coinFlip.headsWon++):(c.coinFlip.tailsChosen++,l&&c.coinFlip.tailsWon++),c}function zC(a){return a.global.totalGamesPlayed===0?0:a.global.totalGamesWon/a.global.totalGamesPlayed*100}function VC(a){return a.global.totalGamesPlayed===0?0:Math.floor(a.global.totalPlaytime/a.global.totalGamesPlayed)}function BC(a){return Object.entries(a.protocols).map(([l,c])=>({protocol:l,timesUsed:c.timesUsed,winRate:c.timesUsed>0?c.wins/c.timesUsed*100:0})).sort((l,c)=>c.timesUsed-l.timesUsed).slice(0,5)}function YC(a){return Object.entries(a.protocols).filter(([l,c])=>c.timesUsed>=3).map(([l,c])=>({protocol:l,timesUsed:c.timesUsed,winRate:c.wins/c.timesUsed*100})).sort((l,c)=>c.winRate-l.winRate).slice(0,5)}function GC(a){return Object.entries(a.protocols).map(([l,c])=>({protocol:l,timesUsed:c.timesUsed,winRate:c.timesUsed>0?c.wins/c.timesUsed*100:0})).sort((l,c)=>l.timesUsed-c.timesUsed).slice(0,5)}function WC(a){return Object.entries(a.cards.played).map(([l,c])=>({card:l,count:c})).sort((l,c)=>c.count-l.count).slice(0,5)}function QC(a){return Object.entries(a.cards.deleted).map(([l,c])=>({card:l,count:c})).sort((l,c)=>c.count-l.count).slice(0,5)}function Vl(a){const n=Math.floor(a/3600),l=Math.floor(a%3600/60),c=a%60;return n>0?`${n}h ${l}m`:l>0?`${l}m ${c}s`:`${c}s`}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function XC(a,n,l){const[c,i]=re.useState(()=>$d()),d=re.useRef(null),u=re.useCallback(()=>{d.current=Date.now()},[]),h=re.useCallback((_,w)=>{i(b=>{const N=`${_}-${w}`,S=LC(b,N);return Ur(S),S})},[]),f=re.useCallback((_,w)=>{i(b=>{const N=`${_}-${w}`,S=OC(b,N);return Ur(S),S})},[]),m=re.useCallback((_,w)=>{i(b=>{const N=HC(b,_,w);return Ur(N),N})},[]),y=re.useCallback(_=>{i(w=>{const b=MC(w,_);return Ur(b),b})},[]),v=re.useCallback((_,w,b,N,S)=>{if(d.current===null)return;const k=Math.floor((Date.now()-d.current)/1e3);i(C=>{const j=PC(C,_,a,n,k,l,w,b,N,S);return Ur(j),j}),d.current=null},[a,n,l]);return{statistics:c,startGame:u,endGame:v,trackPlayerCardPlayed:h,trackPlayerCardDeleted:f,trackPlayerCoinFlip:m,trackPlayerRearrange:y}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function x(a,n,l=!0){const i=Co().find(d=>d.protocol===a&&d.value===n);return i?{id:Xe(),protocol:i.protocol,value:i.value,top:i.top,middle:i.middle,bottom:i.bottom,keywords:i.keywords,isFaceUp:l,isRevealed:!1,category:i.category||"Main",...i.customEffects&&{customEffects:i.customEffects}}:(console.warn(`Card not found: ${a}-${n}`),{id:Xe(),protocol:a,value:n,top:"",middle:"",bottom:"",keywords:{},isFaceUp:l,isRevealed:!1,category:"Main"})}function z(a,n,l,c){const i={...a},d={...i[n]},u=[...d.lanes];return u[l]=[...u[l],c],d.lanes=u,i[n]=d,i}function Yh(a,n){const l=[],c=Co();for(const i of a){const d=c.filter(u=>u.protocol===i);for(const u of d)n.some(f=>f.protocol===u.protocol&&f.value===u.value)||l.push(x(u.protocol,u.value,!0))}return l}function Ee(a,n,l,c,i){return{...a,player:{...a.player,protocols:n,lanes:[[],[],[]],hand:[]},opponent:{...a.opponent,protocols:l,lanes:[[],[],[]],hand:[]},turn:c,phase:i,actionRequired:null,queuedActions:[],_interruptedTurn:void 0,_interruptedPhase:void 0,processedStartEffectIds:[],processedEndEffectIds:[],processedUncoverEventIds:[]}}function je(a){const n=[...a.player.hand,...a.player.lanes.flat()],l=[...a.opponent.hand,...a.opponent.lanes.flat()],c=Yh(a.player.protocols,n),i=Yh(a.opponent.protocols,l),d=a.turn==="player"?"Player":"Opponent",u=[{player:"player",message:`Player protocols: ${a.player.protocols.join(", ")}`},{player:"opponent",message:`Opponent protocols: ${a.opponent.protocols.join(", ")}`},{player:a.turn,message:`${d} goes first.`},{player:"player",message:"---"},{player:a.turn,message:`[Test Scenario] Phase: ${a.phase}`}];return{...a,player:{...a.player,deck:c,discard:[],compiled:[!1,!1,!1]},opponent:{...a.opponent,deck:i,discard:[],compiled:[!1,!1,!1]},log:u}}const Mm={name:"Psychic-3 Uncover whrend Opponent's Turn",description:"Player lscht Opponent's face-down card  Psychic-3 uncovered  Player discardet, Opponent shiftet",setup:a=>{let n=Ee(a,["Hate","Fire","Water"],["Psychic","Death","Spirit"],"player","action");return n.player.hand=[x("Hate",0,!0),x("Fire",1,!0),x("Water",1,!0)],n=z(n,"opponent",1,x("Psychic",3,!0)),n=z(n,"opponent",1,x("Fire",1,!1)),n=we(n),je(n)}},Hm={name:"Psychic-4 End Effect mit Uncover-Interrupt",description:"Psychic-4 returnt Fire-2  Fire-4 uncovered  Interrupt  Psychic-4 flip aus Queue",setup:a=>{let n=Ee(a,["Fire","Water","Spirit"],["Psychic","Death","Metal"],"opponent","end");return n=z(n,"opponent",0,x("Psychic",4,!0)),n=z(n,"player",1,x("Fire",4,!0)),n=z(n,"player",1,x("Fire",2,!0)),n.opponent.hand=[x("Water",1),x("Water",2)],n=we(n),je(n)}},zm={name:"Spirit-3 Draw whrend End Phase",description:"Spirit-3 draw in End Phase  Shift-prompt in Queue  Player kann lanes klicken",setup:a=>{let n=Ee(a,["Spirit","Fire","Water"],["Death","Metal","Psychic"],"player","action");n=z(n,"player",0,x("Spirit",3,!0));const l=Co(),c=l.find(u=>u.protocol==="Fire"&&u.value===1),i=l.find(u=>u.protocol==="Water"&&u.value===1),d=l.find(u=>u.protocol==="Spirit"&&u.value===1);return n.player.deck=[c,i,d],n=we(n),je(n)}},Vm={name:"Plague-2 Actor Propagation",description:"Player spielt Plague-2  Player discardet  Opponent discardet (actor korrekt)",setup:a=>{let n=Ee(a,["Plague","Death","Hate"],["Fire","Water","Spirit"],"player","action");return n.player.hand=[x("Plague",2,!0),x("Fire",1),x("Water",1),x("Spirit",1)],n.opponent.hand=[x("Fire",2),x("Water",2),x("Spirit",2),x("Death",2)],n=we(n),je(n)}},Bm={name:"Darkness-1 Flip + Shift mit Interrupt",description:"Darkness-1 flippt Fire-0  Delete-Interrupt  Player shiftet",setup:a=>{let n=Ee(a,["Darkness","Fire","Water"],["Spirit","Death","Metal"],"player","action");return n.player.hand=[x("Darkness",1,!0)],n=z(n,"opponent",0,x("Fire",0,!1)),n=we(n),je(n)}},Ym={name:"Plague-4 Owner vs Turn Check",description:"Plague-4 End  Player deletet  Opponent (owner) wird fr flip gefragt",setup:a=>{let n=Ee(a,["Fire","Water","Spirit"],["Plague","Death","Metal"],"opponent","end");return n=z(n,"opponent",0,x("Plague",4,!0)),n=z(n,"player",1,x("Water",2,!1)),n=we(n),je(n)}},Gm={name:"Water Owner vs Turn Check",description:"Plague-4 End  Player deletet  Opponent (owner) wird fr flip gefragt",setup:a=>{let n=Ee(a,["Fire","Water","Spirit"],["Plague","Death","Metal"],"player","action");return n=z(n,"opponent",0,x("Plague",4,!0)),n=z(n,"player",2,x("Water",4,!1)),n.player.hand=[x("Water",0,!0),x("Fire",1),x("Water",1),x("Spirit",1)],n.opponent.hand=[x("Fire",2),x("Water",2),x("Spirit",2),x("Death",2)],n=we(n),je(n)}},Wm={name:"Hate-1 Multi-Delete mit Uncover-Interrupt",description:"Hate-1 lscht Plague-0  Plague-5 uncovered  Interrupt  Player macht 2. Delete",setup:a=>{let n=Ee(a,["Fire","Hate","Water"],["Plague","Death","Metal"],"player","action");return n.player.hand=[x("Hate",1,!0),x("Psychic",2,!0),x("Psychic",4,!0),x("Hate",4,!0),x("Water",1,!0)],n=z(n,"opponent",0,x("Plague",2,!0)),n=z(n,"opponent",0,x("Plague",0,!0)),n.opponent.hand=[x("Fire",2,!0),x("Water",2,!0),x("Spirit",2,!0),x("Death",2,!0),x("Metal",2,!0)],n=we(n),je(n)}},Qm={name:"Darkness-1  Hate-0 Flip  Multi-Effect Chain",description:" Darkness-1 flippt Hate-0  Delete-Interrupt  Draw-Interrupt  Shift aus Queue",setup:a=>{let n=Ee(a,["Darkness","Fire","Water"],["Hate","Death","Metal"],"player","action");n.player.hand=[x("Darkness",1,!0)],n=z(n,"opponent",0,x("Hate",0,!1)),n=z(n,"opponent",1,x("Hate",3,!0)),n=z(n,"opponent",2,x("Fire",1,!1)),n=z(n,"player",1,x("Water",2,!0)),n.opponent.hand=[x("Death",2),x("Metal",3)];const c=Co().find(i=>i.protocol==="Death"&&i.value===1);return n.opponent.deck=[c],n=we(n),je(n)}},Xm={name:"Water-4 Return  Turn End",description:" Water-4 returnt Karte  Turn endet (Bug-Fix: Opponent spielt nicht zweimal)",setup:a=>{let n=Ee(a,["Hate","Spirit","Light"],["Fire","Water","Death"],"opponent","action");return n.opponent.hand=[x("Water",4,!0)],n=z(n,"opponent",0,x("Life",4,!0)),n=z(n,"opponent",2,x("Death",4,!1)),n=z(n,"player",1,x("Spirit",1,!0)),n=z(n,"player",2,x("Light",5,!1)),n.player.hand=[x("Fire",1),x("Spirit",2),x("Hate",4)],n=we(n),je(n)}},Zm={name:"Psychic-3 Discard + Shift",description:" Psychic-3 On-Play  Player discardet  AI shiftet (Bug-Fix: AI kann shiften)",setup:a=>{let n=Ee(a,["Fire","Water","Spirit"],["Psychic","Death","Metal"],"opponent","action");return n.opponent.hand=[x("Psychic",3,!0)],n.player.hand=[x("Fire",1),x("Water",2),x("Spirit",1)],n=z(n,"player",0,x("Fire",2,!0)),n=z(n,"player",1,x("Water",3,!0)),n=z(n,"player",2,x("Spirit",4,!0)),n=we(n),je(n)}},Km={name:"Death-1 Delete  Speed-3 Uncover",description:" Death-1 lscht Light-0  Speed-3 uncovered  Player shiftet (Bug-Fix Test)",setup:a=>{let n=Ee(a,["Speed","Light","Water"],["Death","Fire","Metal"],"opponent","start");return n=z(n,"player",0,x("Speed",3,!0)),n=z(n,"player",0,x("Light",0,!0)),n=z(n,"player",1,x("Water",1,!0)),n=z(n,"opponent",0,x("Death",1,!0)),n.player.hand=[],n.opponent.hand=[],n=we(n),je(n)}},Jm={name:"Gravity-2 Flip  Metal-5 Discard  Shift",description:" Gravity-2 flippt Metal-5  Discard Interrupt  shiften (Bug-Fix: AI stuck)",setup:a=>{let n=Ee(a,["Fire","Water","Light"],["Gravity","Metal","Fire"],"opponent","action");return n.opponent.hand=[x("Gravity",2,!0),x("Fire",1)],n=z(n,"opponent",1,x("Metal",5,!1)),n=z(n,"player",0,x("Fire",2,!0)),n=z(n,"player",2,x("Light",3,!0)),n.player.hand=[x("Water",1),x("Fire",3)],n=we(n),je(n)}},ey={name:"Hate-2 Player spielt (Einfach)",description:" Player spielt Hate-2  Whlt eigene & Gegners hchste Karte",setup:a=>{let n=Ee(a,["Hate","Water","Light"],["Metal","Death","Gravity"],"player","action");return n.player.hand=[x("Hate",2,!0)],n=z(n,"player",0,x("Fire",4,!0)),n=z(n,"player",1,x("Water",2,!0)),n=z(n,"player",2,x("Light",5,!0)),n=z(n,"opponent",0,x("Metal",3,!0)),n=z(n,"opponent",1,x("Death",5,!0)),n=z(n,"opponent",2,x("Gravity",2,!1)),n=we(n),je(n)}},ty={name:"Hate-2 AI spielt (Normal)",description:" AI spielt Hate-2  AI whlt eigene & Players hchste automatisch",setup:a=>{let n=Ee(a,["Water","Spirit","Light"],["Hate","Metal","Death"],"opponent","action");return n.opponent.hand=[x("Hate",2,!0)],n=z(n,"opponent",0,x("Fire",5,!0)),n=z(n,"opponent",1,x("Metal",3,!0)),n=z(n,"opponent",2,x("Death",2,!1)),n=z(n,"player",0,x("Water",4,!0)),n=z(n,"player",1,x("Spirit",5,!0)),n=z(n,"player",2,x("Light",2,!0)),n=we(n),je(n)}},ny={name:"Hate-2 AI spielt (Normal) mit Auswahl",description:" AI spielt Hate-2  AI whlt eigene & Players hchste automatisch",setup:a=>{let n=Ee(a,["Water","Spirit","Light"],["Hate","Metal","Death"],"opponent","action");return n.opponent.hand=[x("Hate",2,!0)],n=z(n,"opponent",0,x("Fire",5,!0)),n=z(n,"opponent",1,x("Metal",3,!0)),n=z(n,"opponent",2,x("Death",2,!1)),n=z(n,"player",0,x("Water",4,!0)),n=z(n,"player",1,x("Spirit",5,!0)),n=z(n,"player",2,x("Light",5,!0)),n=we(n),je(n)}},ay={name:"Hate-2 Selbst-Lschung",description:" Hate-2 lscht sich selbst  Zweite Klausel entfllt (Regelwerk-Check)",setup:a=>{let n=Ee(a,["Hate","Fire","Water"],["Metal","Death","Gravity"],"player","action");return n.player.hand=[x("Hate",2,!0)],n=z(n,"player",1,x("Fire",1,!0)),n=z(n,"player",2,x("Water",0,!0)),n=z(n,"opponent",0,x("Metal",3,!0)),n=z(n,"opponent",1,x("Death",5,!0)),n=we(n),je(n)}},oy={name:"Hate-2 Gleichstand (Auswahl)",description:" Hate-2 mit mehreren hchsten  Player muss whlen (Tied values)",setup:a=>{let n=Ee(a,["Hate","Water","Spirit"],["Metal","Death","Gravity"],"player","action");return n.player.hand=[x("Hate",2,!0)],n=z(n,"player",0,x("Fire",4,!0)),n=z(n,"player",1,x("Water",4,!0)),n=z(n,"player",2,x("Spirit",4,!0)),n=z(n,"opponent",0,x("Metal",5,!0)),n=z(n,"opponent",1,x("Death",5,!0)),n=z(n,"opponent",2,x("Gravity",2,!1)),n=we(n),je(n)}},ry={name:"Hate-2 Face-Down Karten",description:" Hate-2 mit face-down  Alle face-down sind value 2 (Tied mit Hate-2)",setup:a=>{let n=Ee(a,["Hate","Fire","Water"],["Metal","Death","Gravity"],"player","action");return n.player.hand=[x("Hate",2,!0)],n=z(n,"player",1,x("Fire",5,!1)),n=z(n,"player",2,x("Water",5,!1)),n=z(n,"opponent",0,x("Metal",5,!0)),n=z(n,"opponent",1,x("Death",4,!1)),n=z(n,"opponent",2,x("Gravity",1,!0)),n=we(n),je(n)}},ly={name:"Hate-2 AI Play-Validation",description:" AI spielt Hate-2 NICHT face-up wenn es sich selbst lschen wrde",setup:a=>{let n=Ee(a,["Fire","Water","Spirit"],["Hate","Death","Metal"],"opponent","action");return n.opponent.hand=[x("Hate",2,!0)],n=z(n,"opponent",1,x("Fire",0,!0)),n=z(n,"opponent",2,x("Water",1,!0)),n=z(n,"player",0,x("Fire",5,!0)),n=z(n,"player",1,x("Water",4,!0)),n=we(n),je(n)}},sy={name:"Hate-2 AI spielt OFFEN (Optimal)",description:" AI spielt Hate-2 offen weil nicht hchste Karte",setup:a=>{let n=Ee(a,["Water","Spirit","Light"],["Hate","Metal","Death"],"opponent","action");return n.opponent.hand=[x("Hate",2,!0)],n=z(n,"opponent",0,x("Fire",5,!0)),n=z(n,"opponent",1,x("Metal",4,!0)),n=z(n,"opponent",2,x("Death",3,!0)),n=z(n,"player",0,x("Water",2,!0)),n=z(n,"player",1,x("Spirit",5,!0)),n=z(n,"player",2,x("Light",1,!0)),n=we(n),je(n)}},ZC={name:"Chaos-3 Protocol-Free Playing",description:"Player with Chaos-3 can play any card face-up in any lane",setup:a=>{let n=Ee(a,["Chaos","Fire","Water"],["Spirit","Death","Metal"],"player","action");return n=z(n,"player",0,x("Chaos",3,!0)),n.player.hand=[x("Gravity",2,!0),x("Hate",3,!0),x("Love",1,!0)],n=we(n),je(n)}},KC={name:"Frost-3 Blocks Shifts (Covered)",description:"Frost-3 should prevent shifts even when covered (Top-Box effect always active)",setup:a=>{let n=Ee(a,["Gravity","Water","Fire"],["Frost","Metal","Death"],"player","action");return n=z(n,"opponent",0,x("Frost",3,!0)),n=z(n,"opponent",0,x("Metal",2,!1)),n=z(n,"player",1,x("Water",2,!0)),n.player.hand=[x("Gravity",1,!0),x("Fire",2,!0)],n=we(n),je(n)}},JC={name:"Water-0 Softlock Bug Fix",description:"Water-0 self-flip should be cancelled when card becomes covered before self-flip executes",setup:a=>{let n=Ee(a,["Water","Darkness","Light"],["Apathy","Fire","Death"],"player","action");return n=z(n,"player",1,x("Darkness",3,!1)),n.player.hand=[x("Water",0,!0),x("Darkness",2,!0),x("Fire",1,!0)],n=we(n),je(n)}},eb={name:"Darkness-1 Flip and Shift Chain",description:"Darkness-1 should flip opponent card, then allow shifting that same card",setup:a=>{let n=Ee(a,["Darkness","Water","Fire"],["Metal","Fire","Death"],"player","action");return n=z(n,"opponent",0,x("Metal",2,!1)),n=z(n,"opponent",1,x("Fire",1,!0)),n=z(n,"opponent",2,x("Hate",0,!1)),n.player.hand=[x("Darkness",1,!0),x("Water",2,!0),x("Fire",3,!0)],n=we(n),je(n)}},tb={name:"Darkness-1 Flips Speed-3 - Middle Effect Execution",description:"When Darkness-1 flips Speed-3, Speed-3's middle effect (shift) should execute before Darkness-1's shift",setup:a=>{let n=Ee(a,["Darkness","Water","Fire"],["Speed","Fire","Metal"],"player","action");return n=z(n,"opponent",0,x("Speed",3,!1)),n=z(n,"opponent",1,x("Fire",1,!0)),n=z(n,"opponent",2,x("Metal",2,!0)),n.player.hand=[x("Darkness",1,!0),x("Water",2,!0),x("Fire",3,!0)],n=we(n),je(n)}},nb={name:"Darkness-1 Flips Speed-3 - Middle Effect Execution",description:"When Darkness-1 flips Speed-3, Speed-3's middle effect (shift) should execute before Darkness-1's shift",setup:a=>{let n=Ee(a,["Darkness","Water","Fire"],["Speed","Fire","Metal"],"player","action");return n=z(n,"opponent",0,x("Speed",3,!1)),n=z(n,"opponent",1,x("Fire",1,!0)),n=z(n,"opponent",2,x("Metal",2,!0)),n.player.hand=[x("Darkness",1,!0),x("Water",2,!0),x("Fire",3,!0)],n=we(n),je(n)}},cy={name:"Fire-1 & Fire-2 Conditional Test",description:" Fire-1 (discard -> delete) & Fire-2 (discard -> return) if_executed logic",setup:a=>{let n=Ee(a,["Fire","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[x("Fire",1,!0),x("Fire",2,!0),x("Fire",0,!0),x("Fire",3,!0),x("Fire",4,!0),x("Fire",5,!0)],n=z(n,"opponent",0,x("Metal",3,!0)),n=z(n,"opponent",1,x("Death",4,!0)),n=z(n,"opponent",2,x("Fire",2,!0)),n=z(n,"opponent",0,x("Metal",1,!0)),n=z(n,"player",2,x("Spirit",3,!0)),n=z(n,"player",1,x("Water",3,!0)),n=z(n,"player",2,x("Spirit",2,!0)),n=we(n),je(n)}},iy={name:"Anarchy Test Playground",description:" All Anarchy cards on hand for testing",setup:a=>{let n=Ee(a,["Anarchy","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[x("Anarchy",0,!0),x("Anarchy",1,!0),x("Anarchy",2,!0),x("Anarchy",3,!0),x("Anarchy",5,!0),x("Anarchy",6,!0)],n=z(n,"opponent",0,x("Metal",3,!0)),n=z(n,"opponent",1,x("Death",4,!1)),n=z(n,"opponent",2,x("Fire",2,!0)),n=z(n,"opponent",0,x("Metal",1,!0)),n=z(n,"player",2,x("Spirit",3,!0)),n=z(n,"player",1,x("Water",3,!0)),n=z(n,"player",2,x("Spirit",2,!0)),n=we(n),je(n)}},dy={name:"Darkness Test Playground",description:" All Darkness cards on hand for testing",setup:a=>{let n=Ee(a,["Darkness","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[x("Darkness",0,!0),x("Darkness",1,!0),x("Darkness",2,!0),x("Darkness",3,!0),x("Darkness",4,!0),x("Darkness",5,!0)],n=z(n,"opponent",0,x("Metal",3,!1)),n=z(n,"opponent",1,x("Death",4,!0)),n=z(n,"opponent",2,x("Fire",2,!1)),n=z(n,"opponent",0,x("Metal",1,!0)),n=z(n,"opponent",1,x("Death",2,!1)),n=z(n,"player",2,x("Spirit",3,!0)),n=z(n,"player",1,x("Water",3,!0)),n=z(n,"player",2,x("Spirit",2,!0)),n=we(n),je(n)}},uy={name:"Apathy Test Playground",description:" All Apathy cards on hand for testing",setup:a=>{let n=Ee(a,["Apathy","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[x("Apathy",0,!0),x("Apathy",1,!0),x("Apathy",2,!0),x("Apathy",3,!0),x("Apathy",4,!0),x("Apathy",5,!0)],n=z(n,"opponent",0,x("Metal",3,!0)),n=z(n,"opponent",1,x("Death",4,!0)),n=z(n,"opponent",2,x("Fire",2,!0)),n=z(n,"opponent",0,x("Metal",1,!0)),n=z(n,"opponent",2,x("Fire",1,!1)),n=z(n,"player",2,x("Spirit",3,!0)),n=z(n,"player",1,x("Water",3,!0)),n=z(n,"player",2,x("Spirit",2,!0)),n=we(n),je(n)}},fy={name:"Death Test Playground",description:" All Death cards on hand for testing",setup:a=>{let n=Ee(a,["Death_cust","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[x("Death_cust",0,!0),x("Death_cust",1,!0),x("Death_cust",2,!0),x("Death_cust",3,!0),x("Death_cust",4,!0),x("Death_cust",5,!0)],n=z(n,"opponent",0,x("Metal",0,!0)),n=z(n,"opponent",1,x("Death",1,!0)),n=z(n,"opponent",2,x("Fire",3,!0)),n=z(n,"opponent",0,x("Metal",2,!0)),n=z(n,"opponent",1,x("Death",4,!1)),n=z(n,"player",2,x("Spirit",3,!0)),n=z(n,"player",1,x("Water",3,!0)),n=z(n,"player",2,x("Spirit",2,!0)),n=we(n),je(n)}},py={name:"Water Test Playground",description:" All Water cards on hand for testing - wash away and renew",setup:a=>{let n=Ee(a,["Water","Fire","Spirit"],["Metal","Death","Light"],"player","action");return n.player.hand=[x("Water",0,!0),x("Water",1,!0),x("Water",2,!0),x("Water",3,!0),x("Water",4,!0),x("Water",5,!0)],n=z(n,"opponent",0,x("Metal",2,!0)),n=z(n,"opponent",1,x("Death",3,!0)),n=z(n,"opponent",2,x("Light",2,!0)),n=z(n,"opponent",0,x("Metal",4,!0)),n=z(n,"opponent",1,x("Death",2,!1)),n=z(n,"opponent",2,x("Light",5,!1)),n=z(n,"player",1,x("Fire",2,!0)),n=z(n,"player",2,x("Spirit",3,!0)),n=z(n,"player",1,x("Fire",4,!0)),n=z(n,"player",2,x("Spirit",5,!1)),n=we(n),je(n)}},hy={name:"Spirit Test Playground",description:" All Spirit cards on hand - true strength from within",setup:a=>{let n=Ee(a,["Spirit","Fire","Water"],["Metal","Death","Light"],"player","action");return n.player.hand=[x("Spirit",0,!0),x("Spirit",1,!0),x("Spirit",2,!0),x("Spirit",3,!0),x("Spirit",4,!0),x("Spirit",5,!0)],n=z(n,"opponent",0,x("Metal",3,!0)),n=z(n,"opponent",1,x("Death",2,!1)),n=z(n,"opponent",2,x("Light",4,!0)),n=z(n,"opponent",0,x("Metal",5,!1)),n=z(n,"opponent",2,x("Light",3,!0)),n=z(n,"player",1,x("Fire",2,!0)),n=z(n,"player",2,x("Water",4,!0)),n=z(n,"player",1,x("Fire",3,!1)),n=we(n),je(n)}},my={name:"Chaos Test Playground",description:" All Chaos cards on hand - embrace the unpredictable",setup:a=>{let n=Ee(a,["Chaos","Fire","Water"],["Metal","Death","Light"],"player","action");return n.player.hand=[x("Chaos",0,!0),x("Chaos",1,!0),x("Chaos",2,!0),x("Chaos",3,!0),x("Chaos",4,!0),x("Chaos",5,!0)],n=z(n,"opponent",0,x("Metal",2,!0)),n=z(n,"opponent",0,x("Metal",4,!0)),n=z(n,"opponent",1,x("Death",3,!1)),n=z(n,"opponent",1,x("Death",5,!0)),n=z(n,"opponent",2,x("Light",1,!0)),n=z(n,"opponent",2,x("Light",3,!1)),n=z(n,"player",0,x("Fire",2,!0)),n=z(n,"player",0,x("Fire",4,!0)),n=z(n,"player",1,x("Water",3,!1)),n=z(n,"player",1,x("Water",5,!0)),n=z(n,"player",2,x("Fire",1,!0)),n=we(n),je(n)}},yy={name:"Gravity Test Playground",description:" All Gravity cards on hand - pull everything together",setup:a=>{let n=Ee(a,["Fire","Gravity","Water"],["Metal","Death","Light"],"player","action");return n.player.hand=[x("Gravity",0,!0),x("Gravity",1,!0),x("Gravity",2,!0),x("Gravity",4,!0),x("Gravity",5,!0),x("Gravity",6,!0)],n=z(n,"player",0,x("Fire",1,!0)),n=z(n,"player",2,x("Water",2,!1)),n=z(n,"opponent",0,x("Metal",3,!1)),n=z(n,"opponent",0,x("Metal",4,!0)),n=z(n,"opponent",1,x("Death",2,!1)),n=z(n,"opponent",1,x("Death",3,!0)),n=z(n,"opponent",2,x("Light",4,!1)),n.opponent.deck=[x("Metal",5,!0),x("Death",4,!0),x("Light",5,!0)],n=we(n),je(n)}},gy={name:"Frost Test Playground",description:" All Frost cards on hand - pull everything together",setup:a=>{let n=Ee(a,["Fire","Frost","Water"],["Metal","Death","Light"],"player","action");return n.player.hand=[x("Frost",0,!0),x("Frost",1,!0),x("Frost",2,!0),x("Frost",3,!0),x("Frost",4,!0),x("Frost",5,!0)],n=z(n,"player",0,x("Fire",1,!0)),n=z(n,"player",2,x("Water",2,!1)),n=z(n,"opponent",0,x("Metal",3,!1)),n=z(n,"opponent",0,x("Metal",4,!0)),n=z(n,"opponent",1,x("Death",2,!1)),n=z(n,"opponent",1,x("Death",3,!0)),n=z(n,"opponent",2,x("Light",4,!1)),n.opponent.deck=[x("Metal",5,!0),x("Death",4,!0),x("Light",5,!0)],n=we(n),je(n)}},vy={name:"Hate Test Playground",description:" All Hate cards on hand - test deletion mechanics",setup:a=>{let n=Ee(a,["Hate","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[x("Hate",0,!0),x("Hate",1,!0),x("Hate",2,!0),x("Hate",3,!0),x("Hate",4,!0),x("Hate",5,!0)],n=z(n,"player",1,x("Water",1,!0)),n=z(n,"player",1,x("Water",2,!0)),n=z(n,"player",1,x("Water",3,!0)),n=z(n,"player",2,x("Spirit",2,!0)),n=z(n,"player",2,x("Spirit",4,!1)),n=z(n,"opponent",0,x("Metal",5,!0)),n=z(n,"opponent",1,x("Death",2,!0)),n=z(n,"opponent",1,x("Death",4,!0)),n=z(n,"opponent",2,x("Fire",3,!1)),n.player.deck=[x("Water",0,!0),x("Water",4,!0),x("Spirit",0,!0),x("Spirit",5,!0)],n.opponent.deck=[x("Metal",3,!0),x("Death",5,!0),x("Fire",1,!0)],n=we(n),je(n)}},_y={name:"Life Test Playground",description:" All Life cards on hand - test play and flip mechanics",setup:a=>{let n=Ee(a,["Life","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[x("Life",0,!0),x("Life",1,!0),x("Life",2,!0),x("Life",3,!0),x("Life",4,!0),x("Life",5,!0)],n=z(n,"player",1,x("Water",1,!0)),n=z(n,"player",1,x("Water",2,!0)),n=z(n,"player",1,x("Water",3,!0)),n=z(n,"player",2,x("Spirit",2,!0)),n=z(n,"player",2,x("Spirit",4,!1)),n=z(n,"opponent",0,x("Metal",3,!1)),n=z(n,"opponent",1,x("Death",2,!0)),n=z(n,"opponent",1,x("Death",4,!1)),n=z(n,"opponent",2,x("Fire",5,!1)),n.player.deck=[x("Water",0,!0),x("Water",3,!0),x("Water",4,!0),x("Spirit",0,!0),x("Spirit",1,!0),x("Spirit",2,!0),x("Spirit",3,!0),x("Spirit",4,!0)],n.opponent.deck=[x("Metal",1,!0),x("Death",3,!0),x("Fire",2,!0)],n=we(n),je(n)}},xy={name:"Light Test Playground",description:" All Light cards on hand - burn away the dark",setup:a=>{let n=Ee(a,["Light","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[x("Light",0,!0),x("Light",1,!0),x("Light",2,!0),x("Light",3,!0),x("Light",4,!0),x("Light",5,!0)],n=z(n,"opponent",0,x("Fire",3,!1)),n=z(n,"opponent",1,x("Metal",4,!1)),n=z(n,"opponent",2,x("Death",5,!0)),n=z(n,"player",1,x("Water",2,!1)),n=z(n,"player",1,x("Water",3,!1)),n=z(n,"player",1,x("Water",4,!1)),n=z(n,"player",0,x("Spirit",1,!0)),n=z(n,"player",0,x("Spirit",2,!1)),n=z(n,"player",2,x("Spirit",5,!1)),n.player.deck=[x("Water",0,!0),x("Water",1,!0),x("Spirit",0,!0),x("Spirit",3,!0),x("Spirit",4,!0)],n.opponent.hand=[x("Metal",1,!0),x("Death",2,!0),x("Fire",3,!0),x("Metal",0,!0)],n=we(n),je(n)}},wy={name:"Death-2 Uncover Interrupt - Turn Wechsel Test",description:"Death-2 lscht  Darkness-4 uncovered  Opponent shiftet  Turn muss zu Opponent wechseln",setup:a=>{let n=Ee(a,["Death","Fire","Hate"],["Water","Darkness","Spirit"],"player","action");return n.player.hand=[x("Death",2,!0),x("Fire",1,!0),x("Hate",1,!0)],n=z(n,"player",0,x("Fire",0,!1)),n=z(n,"opponent",1,x("Darkness",4,!0)),n=z(n,"opponent",1,x("Darkness",1,!0)),n=z(n,"opponent",0,x("Water",0,!1)),n.opponent.hand=[x("Water",1,!0),x("Spirit",1,!0)],n=we(n),je(n)}},Cy={name:"Apathy-5 Uncover - darf nur einmal triggern",description:"Hate-0 lscht Apathy-0  Apathy-5 uncovered  darf nur 1x triggern",setup:a=>{let n=Ee(a,["Hate","Fire","Death"],["Apathy","Darkness","Plague"],"player","action");return n.player.hand=[x("Hate",0,!0),x("Fire",2,!0),x("Death",2,!0)],n=z(n,"opponent",0,x("Apathy",5,!0)),n=z(n,"opponent",0,x("Apathy",4,!0)),n.opponent.hand=[x("Darkness",1,!0),x("Apathy",1,!0),x("Darkness",2,!0)],n=we(n),je(n)}},by={name:"Psychic-1 facedown flip darkness 2 test",description:"Psychic-1 facedown, darkness-2 flippt Karte nur noch facedown bug",setup:a=>{let n=Ee(a,["Frost","Gravity","Plague"],["Psychic","Darkness","Speed"],"player","action");return n.player.hand=[x("Darkness",1,!0),x("Darkness",2,!0),x("Speed",3,!0)],n=z(n,"opponent",0,x("Frost",0,!1)),n=z(n,"opponent",1,x("Gravity",6,!1)),n=z(n,"player",0,x("Psychic",4,!1)),n=z(n,"player",1,x("Psychic",1,!1)),n.opponent.hand=[x("Gravity",1,!0)],n=we(n),je(n)}},Sy={name:"Speed Test Playground",description:" All Speed cards on hand - swift and adaptive",setup:a=>{let n=Ee(a,["Speed","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[x("Speed",0,!0),x("Speed",1,!0),x("Speed",2,!0),x("Speed",3,!0),x("Speed",4,!0),x("Speed",5,!0)],n=z(n,"player",0,x("Water",2,!0)),n=z(n,"player",1,x("Spirit",3,!0)),n=z(n,"opponent",0,x("Metal",3,!1)),n=z(n,"opponent",1,x("Death",4,!1)),n=z(n,"opponent",2,x("Fire",2,!0)),n=z(n,"player",2,x("Spirit",5,!0)),n=z(n,"player",2,x("Spirit",4,!0)),n=we(n),je(n)}},Ey={name:"Metal Test Playground",description:" All Metal cards on hand - unyielding defense",setup:a=>{let n=Ee(a,["Metal","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[x("Metal",0,!0),x("Metal",1,!0),x("Metal",2,!0),x("Metal",3,!0),x("Metal",5,!0),x("Metal",6,!0)],n=z(n,"opponent",0,x("Metal",3,!1)),n=z(n,"opponent",1,x("Death",4,!0)),n=z(n,"player",1,x("Water",3,!0)),n=z(n,"opponent",2,x("Fire",0,!0)),n=z(n,"opponent",2,x("Fire",1,!0)),n=z(n,"opponent",2,x("Fire",2,!0)),n=z(n,"opponent",2,x("Fire",3,!0)),n=z(n,"opponent",2,x("Fire",4,!0)),n=z(n,"opponent",2,x("Fire",5,!0)),n=z(n,"player",2,x("Spirit",3,!0)),n=z(n,"player",2,x("Spirit",2,!0)),n=we(n),je(n)}},jy={name:"Plague Test Playground",description:" All Plague cards on hand - spread suffering",setup:a=>{let n=Ee(a,["Plague","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[x("Plague",0,!0),x("Plague",1,!0),x("Plague",2,!0),x("Plague",3,!0),x("Plague",4,!0),x("Plague",5,!0)],n.opponent.hand=[x("Fire",2,!0),x("Death",3,!0),x("Water",1,!0)],n.player.lanes[0]=[x("Spirit",2,!0)],n.player.lanes[1]=[],n.player.lanes[2]=[],n.opponent.lanes[0]=[x("Metal",1,!0)],n.opponent.lanes[1]=[x("Death",2,!1)],n.opponent.lanes[2]=[x("Fire",3,!0)],n=we(n),je(n)}},ky={name:"Love Test Playground",description:" All Love cards on hand - share the love",setup:a=>{let n=Ee(a,["Love","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[x("Love",1,!0),x("Love",2,!0),x("Love",3,!0),x("Love",4,!0),x("Love",5,!0),x("Love",6,!0)],n.opponent.hand=[x("Fire",2,!0),x("Death",3,!0),x("Water",1,!0),x("Metal",4,!0)],n.player.lanes[0]=[x("Spirit",2,!0)],n.player.lanes[1]=[],n.player.lanes[2]=[],n.opponent.lanes[0]=[x("Metal",1,!0)],n.opponent.lanes[1]=[x("Death",2,!1)],n.opponent.lanes[2]=[x("Fire",3,!0)],n=we(n),je(n)}},Ny={name:"Psychic Test Playground",description:" All Psychic cards on hand - read minds and control",setup:a=>{let n=Ee(a,["Psychic","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[x("Psychic",0,!0),x("Psychic",1,!0),x("Psychic",2,!0),x("Psychic",3,!0),x("Psychic",4,!0),x("Psychic",5,!0)],n.opponent.hand=[x("Fire",2,!0),x("Death",3,!0),x("Water",1,!0),x("Metal",4,!0)],n.player.lanes[0]=[x("Spirit",2,!0)],n.player.lanes[1]=[],n.player.lanes[2]=[],n.opponent.lanes[0]=[x("Metal",1,!0)],n.opponent.lanes[1]=[x("Death",2,!1)],n.opponent.lanes[2]=[x("Fire",3,!0)],n=we(n),je(n)}},Ry={name:" Gravity-2 AI Single Card Bug",description:"AI spielt Gravity-2  Flip  Shift  Turn endet (NUR 1 Karte!)",setup:a=>{let n=Ee(a,["Hate","Fire","Water"],["Gravity","Death","Metal"],"opponent","action");return n.opponent.hand=[x("Gravity",2,!0),x("Death",1,!0),x("Metal",3,!0)],n=z(n,"player",1,x("Hate",5,!0)),n=z(n,"player",1,x("Hate",4,!0)),n=z(n,"player",0,x("Fire",2,!0)),n=z(n,"player",2,x("Water",3,!0)),n=we(n),je(n)}},Ay={name:"Speed-3 End-Effekt Softlock Test",description:"Speed-3 als einzige uncovered Karte sollte sich selbst im End-Effekt shiften knnen",setup:a=>{let n=Ee(a,["Fire","Water","Death"],["Speed","Gravity","Light"],"opponent","end");return n.player.hand=[x("Fire",1,!0),x("Water",2,!0),x("Death",0,!0)],n=z(n,"player",0,x("Fire",3,!0)),n=z(n,"player",1,x("Water",1,!0)),n=z(n,"opponent",0,x("Speed",3,!0)),n.opponent.hand=[x("Gravity",1,!0),x("Light",2,!0)],n=we(n),je(n)}},Ty={name:"Uncover nach Delete All in Lane Test",description:"Death-2 lscht alle 1/2er  Karte darunter wird uncovered  Effekt triggert",setup:a=>{let n=Ee(a,["Death","Fire","Water"],["Fire","Spirit","Light"],"player","action");return n.player.hand=[x("Death",2,!0),x("Fire",3,!0),x("Water",4,!0)],n=z(n,"opponent",0,x("Fire",5,!0)),n=z(n,"opponent",0,x("Fire",2,!0)),n=z(n,"player",0,x("Fire",4,!0)),n=z(n,"player",1,x("Water",3,!0)),n=z(n,"opponent",1,x("Spirit",2,!0)),n=we(n),je(n)}},Dy={name:"Mehrfach-Uncover nach Delete All Test",description:"Death-2 lscht bei beiden Spielern  beide Karten darunter werden uncovered",setup:a=>{let n=Ee(a,["Death","Water","Spirit"],["Fire","Light","Gravity"],"player","action");return n.player.hand=[x("Death",2,!0),x("Spirit",3,!0)],n.opponent.hand=[x("Fire",3,!0),x("Light",5,!0)],n=z(n,"player",0,x("Water",5,!0)),n=z(n,"player",0,x("Water",1,!0)),n=z(n,"opponent",0,x("Fire",5,!0)),n=z(n,"opponent",0,x("Fire",2,!0)),n=we(n),je(n)}},Fy={name:"Life-1 Uncover  Double Flip Bug",description:"Death-1 Start lscht  Life-1 uncovered  BEIDE Flips mssen ausgefhrt werden",setup:a=>{let n=Ee(a,["Death","Fire","Water"],["Life","Metal","Spirit"],"player","start");return n.player.hand=[x("Fire",2,!0)],n.opponent.hand=[x("Metal",3,!0),x("Spirit",2,!0)],n=z(n,"player",0,x("Death",1,!0)),n=z(n,"opponent",0,x("Life",1,!0)),n=z(n,"opponent",0,x("Metal",0,!0)),n=z(n,"player",1,x("Water",1,!0)),n=z(n,"opponent",1,x("Metal",1,!0)),n=z(n,"opponent",2,x("Spirit",0,!0)),n=we(n),je(n)}},qy={name:"Smoke Test Playground",description:" All Smoke cards on hand - shroud your cards in mystery",setup:a=>{let n=Ee(a,["Smoke","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[x("Smoke",0,!0),x("Smoke",1,!0),x("Smoke",2,!0),x("Smoke",3,!0),x("Smoke",4,!0),x("Smoke",5,!0)],n=z(n,"player",0,x("Water",2,!1)),n=z(n,"opponent",1,x("Metal",3,!1)),n=z(n,"opponent",1,x("Death",2,!0)),n=z(n,"opponent",2,x("Fire",2,!0)),n=z(n,"player",2,x("Spirit",3,!0)),n=z(n,"player",1,x("Spirit",4,!0)),n=we(n),je(n)}},$y={name:"Smoke AI Test",description:" AI spielt Smoke Karten - test all Smoke card effects with AI",setup:a=>{let n=Ee(a,["Water","Spirit","Light"],["Smoke","Metal","Death"],"opponent","action");return n.opponent.hand=[x("Smoke",0,!0),x("Smoke",1,!0),x("Smoke",2,!0),x("Smoke",3,!0),x("Smoke",4,!0),x("Smoke",5,!0)],n=z(n,"opponent",0,x("Metal",2,!1)),n=z(n,"player",0,x("Water",3,!0)),n=z(n,"player",1,x("Spirit",2,!1)),n=z(n,"player",1,x("Spirit",4,!0)),n=z(n,"opponent",2,x("Death",3,!0)),n=z(n,"player",2,x("Light",2,!0)),n=z(n,"opponent",1,x("Metal",4,!0)),n=we(n),je(n)}},Iy={name:"Clarity Test Playground",description:"All Clarity cards on hand - see through the fog of war",setup:a=>{let n=Ee(a,["Clarity","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[x("Clarity",0,!0),x("Clarity",1,!0),x("Clarity",2,!0),x("Clarity",3,!0),x("Clarity",4,!0),x("Clarity",5,!0)],n.player.deck=[x("Clarity",1,!0),x("Water",1,!0),x("Spirit",5,!0),x("Spirit",3,!0),x("Water",2,!0),x("Fire",4,!0)],n.player.discard=[x("Water",4,!0),x("Spirit",1,!0)],n=z(n,"player",0,x("Water",2,!0)),n.opponent.hand=[x("Metal",3,!0),x("Death",2,!0),x("Fire",4,!0)],n=z(n,"opponent",1,x("Metal",3,!0)),n=z(n,"opponent",2,x("Fire",2,!0)),n=we(n),je(n)}},Uy={name:"Clarity AI Test",description:"AI spielt Clarity Karten - test all Clarity card effects with AI",setup:a=>{let n=Ee(a,["Water","Spirit","Light"],["Clarity","Metal","Death"],"opponent","action");return n.opponent.hand=[x("Clarity",0,!0),x("Clarity",1,!0),x("Clarity",2,!0),x("Clarity",3,!0),x("Clarity",4,!0),x("Clarity",5,!0)],n.opponent.deck=[x("Clarity",1,!0),x("Metal",1,!0),x("Death",5,!0),x("Death",3,!0),x("Metal",2,!0)],n.opponent.discard=[x("Metal",4,!0),x("Death",2,!0)],n.player.hand=[x("Water",3,!0),x("Spirit",2,!0),x("Light",4,!0)],n=z(n,"player",0,x("Water",3,!0)),n=z(n,"opponent",0,x("Metal",2,!0)),n=z(n,"player",1,x("Spirit",4,!0)),n=z(n,"opponent",2,x("Death",3,!0)),n=we(n),je(n)}},Py={name:"Courage Custom Playground",description:"Test all Courage effects: empty hand draw, opponent higher value delete, conditional draw/flip, highest value shift",setup:a=>{let c=Ee(a,["Courage","Fire","Speed"],["Spirit","Water","Darkness"],"player","action");return c.player.hand=[x("Courage",0,!0),x("Courage",1,!0),x("Courage",2,!0),x("Courage",3,!0),x("Courage",5,!0),x("Courage",6,!0)],c=z(c,"opponent",0,x("Spirit",3,!0)),c=z(c,"opponent",0,x("Spirit",5,!0)),c=z(c,"player",0,x("Fire",3,!0)),c=z(c,"opponent",1,x("Water",6,!0)),c=z(c,"player",1,x("Speed",4,!0)),c=z(c,"opponent",2,x("Darkness",2,!0)),c=z(c,"player",2,x("Fire",5,!0)),je(c)}},Ly={name:"Courage AI Test",description:"Test AI with Courage protocol: lane-restricted delete, self-shift to highest value lane",setup:a=>{let c=Ee(a,["Spirit","Water","Fire"],["Courage","Speed","Darkness"],"opponent","action");return c.opponent.hand=[x("Courage",0,!0),x("Courage",1,!0),x("Courage",2,!0),x("Courage",3,!0),x("Courage",5,!0),x("Courage",6,!0)],c=z(c,"player",0,x("Spirit",5,!0)),c=z(c,"player",0,x("Spirit",5,!0)),c=z(c,"opponent",0,x("Speed",3,!0)),c=z(c,"player",1,x("Water",6,!0)),c=z(c,"opponent",1,x("Darkness",2,!0)),c=z(c,"opponent",1,x("Darkness",2,!1)),c=z(c,"player",2,x("Fire",3,!0)),c=z(c,"opponent",2,x("Speed",5,!0)),je(c)}},Oy={name:"Corruption Test Playground",description:" All Corruption cards on hand - corrupt your opponent's plans",setup:a=>{let n=Ee(a,["Corruption","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[x("Corruption",0,!0),x("Corruption",1,!0),x("Corruption",2,!0),x("Corruption",3,!0),x("Corruption",5,!0),x("Corruption",6,!0)],n=z(n,"player",0,x("Water",2,!0)),n=z(n,"opponent",0,x("Metal",3,!0)),n=z(n,"opponent",1,x("Death",4,!0)),n=z(n,"opponent",2,x("Fire",2,!0)),n=z(n,"player",1,x("Spirit",3,!0)),n=z(n,"player",1,x("Spirit",5,!0)),n.opponent.hand=[x("Fire",3,!0),x("Metal",4,!0),x("Death",5,!0)],n=we(n),je(n)}},My={name:"Fear Custom Playground",description:"Test all Fear effects: passive ignore middle, choice shift/flip, chain discard, return, random discard",setup:a=>{let c=Ee(a,["Fear","Fire","Speed"],["Spirit","Water","Darkness"],"player","action");return c.player.hand=[x("Fear",0,!0),x("Fear",1,!0),x("Fear",2,!0),x("Fear",3,!0),x("Fear",4,!0),x("Fear",5,!0)],c=z(c,"opponent",0,x("Spirit",2,!0)),c=z(c,"opponent",0,x("Spirit",3,!0)),c=z(c,"player",0,x("Fire",3,!0)),c=z(c,"opponent",1,x("Water",4,!0)),c=z(c,"player",1,x("Speed",4,!0)),c=z(c,"opponent",2,x("Darkness",2,!1)),c=z(c,"player",2,x("Fire",5,!0)),c.opponent.hand=[x("Spirit",1,!0),x("Water",2,!0),x("Darkness",3,!0),x("Spirit",4,!0)],je(c)}},Hy={name:"Fear AI Test",description:"Test AI with Fear protocol: random discard execution, passive rule handling",setup:a=>{let c=Ee(a,["Spirit","Water","Fire"],["Fear","Speed","Darkness"],"opponent","action");return c.opponent.hand=[x("Fear",0,!0),x("Fear",1,!0),x("Fear",2,!0),x("Fear",3,!0),x("Fear",4,!0),x("Fear",5,!0)],c=z(c,"player",0,x("Spirit",3,!0)),c=z(c,"player",0,x("Spirit",5,!0)),c=z(c,"opponent",0,x("Speed",3,!0)),c=z(c,"player",1,x("Water",2,!0)),c=z(c,"player",1,x("Water",4,!0)),c=z(c,"player",2,x("Fire",3,!0)),c=z(c,"opponent",2,x("Darkness",5,!0)),c.player.hand=[x("Spirit",1,!0),x("Water",3,!0),x("Fire",4,!0)],je(c)}},zy={name:"Ice Custom Playground",description:" Test all Ice effects: conditional shift, flip block, draw block, lane-reactive discard",setup:a=>{let c=Ee(a,["Ice","Fire","Speed"],["Spirit","Water","Darkness"],"player","action");return c.player.hand=[x("Ice",1,!0),x("Ice",2,!0),x("Ice",3,!0),x("Ice",4,!0),x("Ice",5,!0),x("Ice",6,!0),x("Fire",0,!0)],c=z(c,"player",0,x("Fire",3,!0)),c=z(c,"player",0,x("Fire",5,!0)),c=z(c,"opponent",1,x("Water",4,!0)),c=z(c,"player",1,x("Speed",4,!0)),c=z(c,"opponent",2,x("Darkness",2,!0)),c=z(c,"player",2,x("Fire",5,!0)),c.opponent.hand=[x("Spirit",1,!0),x("Water",2,!0),x("Darkness",3,!0)],je(c)}},Vy={name:"Ice AI Test",description:" Test AI with Ice protocol: shift self, shift others, passive rules",setup:a=>{let c=Ee(a,["Spirit","Water","Fire"],["Ice","Speed","Darkness"],"opponent","action");return c.opponent.hand=[x("Ice",1,!0),x("Ice",2,!0),x("Ice",3,!0),x("Ice",4,!0),x("Ice",5,!0),x("Ice",6,!0)],c=z(c,"player",0,x("Spirit",3,!0)),c=z(c,"player",0,x("Spirit",5,!0)),c=z(c,"opponent",0,x("Speed",3,!0)),c=z(c,"opponent",1,x("Darkness",2,!0)),c=z(c,"opponent",1,x("Darkness",4,!0)),c=z(c,"player",1,x("Water",4,!0)),c=z(c,"player",2,x("Fire",3,!0)),c=z(c,"opponent",2,x("Speed",5,!0)),c.player.hand=[x("Spirit",1,!0),x("Water",3,!0),x("Fire",4,!0)],je(c)}},By={name:"End Phase Test",description:"Test the game rule for the end or start phase, only 1 trigger",setup:a=>{let c=Ee(a,["Light","Fire","Speed"],["Spirit","Water","Darkness"],"player","action");return c.player.hand=[x("Light",5,!0),x("Fire",0,!0)],c=z(c,"player",0,x("Light",1,!0)),c=z(c,"player",0,x("Light",2,!0)),c=z(c,"player",1,x("Fire",3,!0)),c=z(c,"player",2,x("Speed",3,!0)),c.opponent.hand=[x("Spirit",1,!0),x("Water",2,!0),x("Darkness",3,!0)],je(c)}},Yy={name:"Start Phase Test",description:"Test the game rule for the end or start phase, only 1 trigger",setup:a=>{let c=Ee(a,["Spirit","Death","Psychic"],["Light","Water","Darkness"],"player","action");return c.player.hand=[x("Spirit",5,!0),x("Death",0,!0)],c=z(c,"player",0,x("Spirit",1,!0)),c=z(c,"player",0,x("Spirit",2,!0)),c=z(c,"player",1,x("Death",1,!0)),c=z(c,"player",1,x("Spirit",3,!0)),c=z(c,"player",2,x("Psychic",1,!0)),c.opponent.hand=[x("Light",1,!0),x("Water",2,!0),x("Darkness",3,!0)],je(c)}},Gy={name:"Committed Card Test",description:"Committed Card Test",setup:a=>{let c=Ee(a,["Spirit","Darkness","Psychic"],["Light","Water","Fire"],"player","action");return c.player.hand=[x("Darkness",0,!0),x("Death",0,!0)],c=z(c,"player",0,x("Spirit",0,!0)),c=z(c,"player",0,x("Spirit",3,!0)),c=z(c,"opponent",0,x("Light",1,!0)),c=z(c,"opponent",0,x("Light",2,!0)),c.opponent.hand=[x("Light",5,!0),x("Water",2,!0),x("Darkness",3,!0)],je(c)}},Wy={name:"Fear 0 prob Test",description:"Bla bla",setup:a=>{let c=Ee(a,["Chaos","Fear","Psychic"],["Light","Water","Fire"],"player","action");return c.player.hand=[x("Chaos",2,!0),x("Fear",3,!0)],c=z(c,"player",1,x("Fear",2,!0)),c=z(c,"player",1,x("Fear",0,!0)),c=z(c,"opponent",1,x("Water",5,!0)),c=z(c,"opponent",2,x("Darkness",2,!1)),c.opponent.hand=[x("Light",5,!0),x("Water",2,!0),x("Darkness",3,!0)],je(c)}},Qy={name:"MultiChain Test",description:"Multi Chain test",setup:a=>{let c=Ee(a,["Chaos","Smoke","Test"],["Light","Water","Fire"],"player","action");return c.player.hand=[x("Smoke",1,!0),x("Chaos",3,!0)],c=z(c,"player",2,x("Test",1,!1)),c=z(c,"opponent",1,x("Water",5,!0)),c=z(c,"opponent",2,x("Darkness",2,!1)),c.opponent.hand=[x("Light",5,!0),x("Water",2,!0),x("Darkness",3,!0)],je(c)}},Xy={name:"Light3-Uncover Test",description:"Light3-Uncover_actionType Test",setup:a=>{let c=Ee(a,["Chaos","Smoke","Test"],["Light","Water","Fire"],"player","action");return c.player.hand=[x("Smoke",1,!0),x("Chaos",3,!0)],c=z(c,"player",0,x("Chaos",3,!0)),c=z(c,"player",0,x("Chaos",2,!0)),c=z(c,"player",0,x("Test",1,!1)),c.opponent.hand=[x("Light",3,!0)],je(c)}},Zy=[Mm,Hm,zm,Vm,Bm,Ym,Gm,Wm,Qm,Xm,Zm,Km,Jm,ey,ty,ny,ay,oy,ry,ly,sy,ZC,KC,JC,eb,tb,nb,cy,iy,dy,uy,fy,py,hy,my,yy,gy,vy,_y,xy,wy,Cy,by,Sy,Ey,jy,ky,Ny,Ry,Ay,Ty,Dy,Fy,qy,$y,Iy,Uy,Oy,Py,Ly,My,Hy,zy,Vy,By,Yy,Gy,Wy,Qy,Xy],ab=Object.freeze(Object.defineProperty({__proto__:null,allScenarios:Zy,scenario10_Hate1Interrupt:Wm,scenario11_Darkness1HateChain:Qm,scenario12_Water4TurnEnd:Xm,scenario13_Psychic3ShiftTest:Zm,scenario14_Death1UncoverTest:Km,scenario15_Gravity2ShiftInterrupt:Jm,scenario16_Hate2PlayerPlays:ey,scenario171_Hate2AIPlays:ny,scenario17_Hate2AIPlays:ty,scenario18_Hate2SelfDelete:ay,scenario19_Hate2MultipleTies:oy,scenario1_Psychic3Uncover:Mm,scenario20_Hate2FaceDown:ry,scenario21_Hate2AIValidation:ly,scenario22_Hate2AIPlaysOpen:sy,scenario29_FireCustomConditional:cy,scenario2_Psychic4EndEffect:Hm,scenario30_AnarchyCustomPlayground:iy,scenario31_DarkCustPlayground:dy,scenario32_ApathyCustomPlayground:uy,scenario33_DeathCustomPlayground:fy,scenario34_WaterCustomPlayground:py,scenario35_SpiritCustomPlayground:hy,scenario36_ChaosCustomPlayground:my,scenario37_GravityCustomPlayground:yy,scenario38_FrostCustomPlayground:gy,scenario39_HateCustomPlayground:vy,scenario3_Spirit3EndPhase:zm,scenario40_LifeCustomPlayground:_y,scenario41_LightCustomPlayground:xy,scenario42_Death2UncoverInterruptTurn:wy,scenario43_Apathy5DoubleUncover:Cy,scenario44_Psychic1Darkness2Test:by,scenario45_SpeedCustomPlayground:Sy,scenario46_MetalCustomPlayground:Ey,scenario47_PlagueCustomPlayground:jy,scenario48_LoveCustomPlayground:ky,scenario49_PsychicCustomPlayground:Ny,scenario4_Plague2Actor:Vm,scenario50_Gravity2SingleCardBug:Ry,scenario51_Speed3EndEffectSoftlock:Ay,scenario52_UncoverAfterBulkDelete:Ty,scenario53_MultiUncoverAfterBulkDelete:Dy,scenario54_Life1UncoverDoubleFlip:Fy,scenario55_SmokeCustomPlayground:qy,scenario56_SmokeAITest:$y,scenario57_ClarityCustomPlayground:Iy,scenario58_ClarityAITest:Uy,scenario59_CorruptionCustomPlayground:Oy,scenario5_Darkness1Interrupt:Bm,scenario60_CourageCustomPlayground:Py,scenario61_CourageAITest:Ly,scenario62_FearCustomPlayground:My,scenario63_FearAITest:Hy,scenario64_IceCustomPlayground:zy,scenario65_IceAITest:Vy,scenario66_endPhasePlayground:By,scenario67_startPhasePlayground:Yy,scenario68_CommittedCardPlayground:Gy,scenario69_fear0shiftCardPlayground:Wy,scenario70_multiChainCardPlayground:Qy,scenario71_Light3ProblemPlayground:Xy,scenario8_Plague4Owner:Ym,scenario9_Water:Gm},Symbol.toStringTag,{value:"Module"})),ob=({onLoadScenario:a,onSkipCoinFlip:n,onForceWin:l,onForceLose:c})=>{const[i,d]=re.useState(!1);return i?o.jsxs("div",{style:{position:"fixed",top:"20px",left:"20px",width:"400px",maxHeight:"600px",backgroundColor:"#2c2c2c",border:"2px solid #ff6b6b",borderRadius:"8px",padding:"20px",zIndex:9999,overflowY:"auto",color:"white",fontFamily:"monospace"},children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"20px"},children:[o.jsx("h3",{style:{margin:0},children:" Debug Panel"}),o.jsx("button",{onClick:()=>d(!1),style:{backgroundColor:"transparent",border:"none",color:"white",cursor:"pointer",fontSize:"20px"},children:""})]}),o.jsx("div",{style:{marginBottom:"15px",fontSize:"12px",color:"#aaa"},children:"Lade vordefinierte Test-Szenarien zum Testen der Actor/Owner-Fixes."}),o.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:Zy.map((u,h)=>o.jsxs("div",{style:{backgroundColor:"#1a1a1a",padding:"12px",borderRadius:"5px",border:"1px solid #444"},children:[o.jsx("div",{style:{fontWeight:"bold",marginBottom:"5px",color:"#4ecdc4"},children:u.name}),o.jsx("div",{style:{fontSize:"11px",color:"#bbb",marginBottom:"10px"},children:u.description}),o.jsx("button",{onClick:()=>{n&&n(),a(u.setup),d(!1)},style:{padding:"6px 12px",backgroundColor:"#4ecdc4",color:"#1a1a1a",border:"none",borderRadius:"3px",cursor:"pointer",fontWeight:"bold",fontSize:"12px"},children:"Load Scenario"})]},h))}),(l||c)&&o.jsxs("div",{style:{marginTop:"20px",paddingTop:"15px",borderTop:"1px solid #444",display:"flex",gap:"10px",justifyContent:"center"},children:[l&&o.jsx("button",{onClick:()=>{l(),d(!1)},style:{padding:"10px 20px",backgroundColor:"#4ecdc4",color:"#1a1a1a",border:"none",borderRadius:"5px",cursor:"pointer",fontWeight:"bold",fontSize:"14px"},children:" Force Win"}),c&&o.jsx("button",{onClick:()=>{c(),d(!1)},style:{padding:"10px 20px",backgroundColor:"#ff6b6b",color:"white",border:"none",borderRadius:"5px",cursor:"pointer",fontWeight:"bold",fontSize:"14px"},children:" Force Lose"})]}),o.jsx("div",{style:{marginTop:"20px",fontSize:"11px",color:"#666",textAlign:"center"},children:"Drcke ESC oder klicke  zum Schlieen"})]}):o.jsx("button",{onClick:()=>d(!0),style:{position:"fixed",top:"20px",left:"20px",padding:"10px 20px",backgroundColor:"#ff6b6b",color:"white",border:"none",borderRadius:"5px",cursor:"pointer",fontWeight:"bold",zIndex:9999,fontSize:"14px"},children:" DEBUG"})},Gh=(a,n)=>{if(!n)return null;for(const l of["player","opponent"])for(const c of a[l].lanes){const i=c.find(d=>d.id===n);if(i)return{card:i,owner:l}}return null},rb=new Set(["discard","select_card_from_hand_to_play","select_card_from_hand_to_give","select_card_from_hand_to_reveal","plague_2_player_discard","select_cards_from_hand_to_discard_for_fire_4","select_cards_from_hand_to_discard_for_hate_1"]);function lb({onBack:a,onEndGame:n,playerProtocols:l,opponentProtocols:c,difficulty:i,useControlMechanic:d,startingPlayer:u="player"}){var Ie,De,ze,Je,Be,Fe,rt,Qt;const[h,f]=re.useState(null),[m,y]=re.useState(!0),{startGame:v,endGame:_,trackPlayerCoinFlip:w,trackPlayerRearrange:b}=XC(l,i,d),N=re.useCallback((me,xe,be)=>{f(me),y(!1),w(xe,be)},[w]),S=re.useCallback(()=>{f("player"),y(!1),v()},[v]);re.useEffect(()=>{!m&&h&&v()},[m,h,v]);const k=re.useCallback((me,xe)=>{const be=xe.player.compiled.filter(We=>We).length;_(me,xe.stats.player,be,xe.stats.opponent,xe.detailedGameStats),n(me,xe)},[_,n]),{gameState:C,selectedCard:j,setSelectedCard:R,playSelectedCard:F,fillHand:L,discardCardFromHand:U,compileLane:Q,resolveActionWithCard:X,resolveActionWithLane:V,selectHandCardForAction:$,resolveActionWithHandCard:E,skipAction:A,resolveOptionalDrawPrompt:O,resolveDeath1Prompt:I,resolveLove1Prompt:T,resolvePlague2Discard:q,resolvePlague4Flip:Y,resolveFire3Prompt:K,resolveOptionalDiscardCustomPrompt:P,resolveOptionalEffectPrompt:Z,resolveFire4Discard:W,resolveHate1Discard:G,resolveLight2Prompt:H,resolveRevealBoardCardPrompt:B,resolveRearrangeProtocols:ee,resolveSpirit1Prompt:de,resolveSpirit3Prompt:J,resolveSwapProtocols:pe,resolveSpeed3Prompt:fe,resolvePsychic4Prompt:ye,resolveControlMechanicPrompt:ke,resolveCustomChoice:Ve,resolveSelectRevealedDeckCard:Le,setupTestScenario:at}=$0(l,c,k,i,d,h??"player",b),[Te,qe]=re.useState(null),[_t,Ft]=re.useState([]),[He,$e]=re.useState(!1),[nt,ot]=re.useState([]),Pt=re.useRef(C.log.length),[bt,xt]=re.useState(!1),[yt,Mt]=re.useState(!1),[wt,Vn]=re.useState(null),[ga,ta]=re.useState(!1),[Tn,un]=re.useState(0),qt=re.useRef(null),tn=re.useRef(C);re.useEffect(()=>{tn.current=C},[C]);const xn=()=>{const me=Tn+1;if(un(me),me>=5){ta(xe=>!xe),un(0),qt.current&&(clearTimeout(qt.current),qt.current=null);return}qt.current&&clearTimeout(qt.current),qt.current=setTimeout(()=>{un(0),qt.current=null},2e3)},va=re.useCallback(()=>{console.log("Debug: Forcing player win via DebugPanel."),k("player",C)},[k,C]),na=re.useCallback(()=>{console.log("Debug: Forcing player loss via DebugPanel."),k("opponent",C)},[k,C]),aa=re.useMemo(()=>{if(C.lastPlayedCardId){const me=Gh(C,C.lastPlayedCardId);if(me){const xe=me.owner==="player"||me.card.isFaceUp;return{card:me.card,showContents:xe}}}return null},[C.lastPlayedCardId,C.player.lanes,C.opponent.lanes]),Bn=re.useMemo(()=>{var xe;const me=(xe=C.actionRequired)==null?void 0:xe.sourceCardId;if(me){const be=Gh(C,me);if(be){const We=be.owner==="player"||be.card.isFaceUp;return{card:be.card,showContents:We}}}return null},[(Ie=C.actionRequired)==null?void 0:Ie.sourceCardId,C.player.lanes,C.opponent.lanes]);re.useEffect(()=>{var me;(me=C.actionRequired)!=null&&me.sourceCardId&&qe(null)},[(De=C.actionRequired)==null?void 0:De.sourceCardId]);const fn=Te||Bn||aa;re.useEffect(()=>{C.log.length>Pt.current&&C.log.slice(Pt.current).forEach(xe=>{if(xe.message!=="Game Started."){const be={message:xe.message,player:xe.player,id:Xe()};ot(We=>[...We,be]),setTimeout(()=>{ot(We=>We.filter(Et=>Et.id!==be.id))},5e3)}}),Pt.current=C.log.length},[C.log]),re.useEffect(()=>{var xe,be,We,Et,rn;!(((xe=C.actionRequired)==null?void 0:xe.type)==="discard"&&((be=C.actionRequired)==null?void 0:be.variableCount))&&((We=C.actionRequired)==null?void 0:We.type)!=="plague_2_player_discard"&&((Et=C.actionRequired)==null?void 0:Et.type)!=="select_cards_from_hand_to_discard_for_fire_4"&&((rn=C.actionRequired)==null?void 0:rn.type)!=="select_cards_from_hand_to_discard_for_hate_1"&&Ft([])},[C.actionRequired]),re.useEffect(()=>{var me,xe;xt(((me=C.actionRequired)==null?void 0:me.type)==="prompt_rearrange_protocols"&&C.actionRequired.actor==="player"),Mt(((xe=C.actionRequired)==null?void 0:xe.type)==="prompt_swap_protocols"&&C.actionRequired.actor==="player")},[C.actionRequired]),re.useEffect(()=>{const me=xe=>{xe.ctrlKey&&xe.shiftKey&&(xe.preventDefault(),xe.key.toLowerCase()==="d"?(console.log("Debug: Toggling debug button visibility."),ta(be=>!be)):xe.key.toLowerCase()==="w"?(console.log("Debug: Forcing player win."),n("player",C)):xe.key.toLowerCase()==="o"?(console.log("Debug: Forcing opponent win."),n("opponent",C)):xe.key.toLowerCase()==="p"?(console.log("Debug: Setting up Speed-0 interrupt scenario."),at("speed-0-interrupt")):xe.key.toLowerCase()==="l"?(console.log("Debug: Setting up Speed-1 discard trigger scenario."),at("speed-1-trigger")):xe.key.toLowerCase()==="f"?(console.log("Debug: Setting up Fire On-Cover test scenario."),at("fire-oncover-test")):xe.key.toLowerCase()==="s"?(console.log("Debug: Setting up Speed-2 + Control test scenario."),at("speed-2-control-test")):xe.key.toLowerCase()==="u"&&(console.log("Debug: Setting up Death-1 Uncover test scenario."),D_(()=>Promise.resolve().then(()=>ab),void 0).then(be=>{at(be.scenario14_Death1UncoverTest.setup)})))};return window.addEventListener("keydown",me),()=>{window.removeEventListener("keydown",me)}},[C,n,at]);const Yn=(me,xe)=>{const be=tn.current;if(be.animationState)return;const{actionRequired:We,turn:Et,phase:rn,compilableLanes:ca,player:ln,opponent:Dn}=be;if(xe==="player"&&Et==="player"&&rn==="compile"&&ca.includes(me)){if(We){console.warn("Compile click blocked by pending action:",We);return}Q(me);return}if(We&&We.actor==="player"&&["select_lane_for_shift","select_lane_for_shift_all","shift_flipped_card_optional","select_lane_for_play","select_lane_for_delete","select_lane_for_death_2","select_lane_for_life_3_play","select_lane_to_shift_revealed_card_for_light_2","select_lane_to_shift_revealed_board_card_custom","select_lane_to_shift_cards_for_light_3","select_lane_for_water_3","select_lane_for_metal_3_delete","select_lane_for_delete_all","select_lane_for_return"].includes(We.type)){V(me);return}const Fn=Dn.lanes.flat().some(Bt=>Bt.isFaceUp&&Bt.protocol==="Psychic"&&Bt.value===1),sn=Dn.lanes[me],pn=sn.length>0&&sn[sn.length-1].isFaceUp&&sn[sn.length-1].protocol==="Plague"&&sn[sn.length-1].value===0;if(j&&rn==="action"&&!We&&ln.hand.some(Bt=>Bt.id===j)&&!pn){const Bt=ln.hand.find(Ht=>Ht.id===j);if(xe==="opponent"){if(!Wl(be,Bt)){R(null),qe(null);return}if(Fn){R(null),qe(null);return}F(me,!0,"opponent"),qe(null);return}const Qn=ln.lanes.flat().some(Ht=>Ht.isFaceUp&&Ht.protocol==="Spirit"&&Ht.value===1),Ma=ln.lanes.some((Ht,za)=>{if(Ht.length===0)return!1;const _a=Ht[Ht.length-1];return _a.isFaceUp&&_a.protocol==="Chaos"&&_a.value===3}),Ha=[...ln.lanes.flat(),...Dn.lanes.flat()].some(Ht=>Ht.isFaceUp&&Ht.protocol==="Anarchy"&&Ht.value===1),Zo=vc(be),So=_c(be,"player",me),Xt=Wl(be,Bt);let ia;Xt?ia=!Fn:Ha||Zo?ia=Bt.protocol!==ln.protocols[me]&&Bt.protocol!==Dn.protocols[me]&&!Fn:ia=(Qn||So||Ma||Bt.protocol===ln.protocols[me]||Bt.protocol===Dn.protocols[me])&&!Fn,F(me,ia),qe(null);return}j&&(R(null),qe(null))},oa=me=>{const xe=tn.current;if(xe.animationState||!j)return;const{phase:be,actionRequired:We,player:Et}=xe;be!=="action"||We||!Et.hand.some(rn=>rn.id===j)||(F(me,!1),qe(null))},ra=me=>{const xe=tn.current;if(!xe.animationState){if(xe.actionRequired){if(xe.actionRequired.type==="discard"&&xe.actionRequired.actor==="player")if(xe.actionRequired.variableCount){Ft(be=>be.includes(me.id)?be.filter(We=>We!==me.id):[...be,me.id]);return}else{U(me.id);return}if(xe.actionRequired.type==="select_card_from_hand_to_play"){$(me.id);return}if(xe.actionRequired.type==="select_card_from_hand_to_give"||xe.actionRequired.type==="select_card_from_hand_to_reveal"){E(me.id);return}if(xe.actionRequired.type==="plague_2_player_discard"||xe.actionRequired.type==="select_cards_from_hand_to_discard_for_fire_4"||xe.actionRequired.type==="select_cards_from_hand_to_discard_for_hate_1"){Ft(be=>be.includes(me.id)?be.filter(We=>We!==me.id):[...be,me.id]);return}return}xe.turn!=="player"||xe.phase!=="action"&&xe.phase!=="compile"||(me.id===j?(R(null),qe(null)):(R(me.id),qe({card:me,showContents:!0})))}},Gn=(me,xe,be)=>{const We=tn.current;if(We.animationState)return;const{actionRequired:Et,turn:rn,phase:ca,compilableLanes:ln}=We;if(rn==="player"&&ca==="compile"&&ln.includes(be)){Yn(be,xe);return}if(rn==="player"&&!Et&&j&&ca==="action"){Yn(be,xe);return}if(Et&&Et.actor==="player"&&(Et.type==="select_own_highest_card_to_delete_for_hate_2"||Et.type==="select_opponent_highest_card_to_delete_for_hate_2")&&yc(me,We)){X(me.id);return}if(yc(me,We))X(me.id);else if(j)R(null),qe(null);else{const Dn=xe==="player"||me.isFaceUp;qe({card:me,showContents:Dn})}},Wn=me=>{j||qe({card:me,showContents:!0})},la=(me,xe)=>{if(!j){const be=xe==="player"||me.isFaceUp;qe({card:me,showContents:be})}},sa=()=>{j||qe(null)},nn=me=>{!j&&!C.actionRequired&&qe({card:me,showContents:me.isRevealed||!1})},St=()=>{if(!fn)return null;const{card:me,showContents:xe}=fn;return o.jsx(kt,{card:me,isFaceUp:xe})},At=C.turn==="player"&&!C.actionRequired&&C.phase==="compile"&&C.compilableLanes.length>0,ue=((ze=C.actionRequired)==null?void 0:ze.sourceCardId)??null,Ce=re.useMemo(()=>{var me;return(me=C.actionRequired)!=null&&me.actor?C.actionRequired.actor==="player"?"action-required-player":"action-required-opponent":""},[C.actionRequired]),Re=re.useMemo(()=>{const me=C.actionRequired;return me&&me.actor==="player"?rb.has(me.type)?"":"hand-in-background":""},[C.actionRequired]);return o.jsxs("div",{className:"screen game-screen",children:[wt&&o.jsx(W0,{player:wt,playerState:C[wt],onClose:()=>Vn(null),difficulty:i}),bt&&((Je=C.actionRequired)==null?void 0:Je.type)==="prompt_rearrange_protocols"&&o.jsx(V0,{gameState:C,targetPlayer:C.actionRequired.target,onConfirm:me=>{var xe,be;((xe=C.actionRequired)==null?void 0:xe.sourceCardId)==="CONTROL_MECHANIC"&&((be=C.actionRequired)!=null&&be.actor)&&b(C.actionRequired.actor),ee(me),xt(!1)}}),yt&&((Be=C.actionRequired)==null?void 0:Be.type)==="prompt_swap_protocols"&&o.jsx(B0,{gameState:C,targetPlayer:C.actionRequired.target,onConfirm:me=>{pe(me),Mt(!1)}}),((Fe=C.actionRequired)==null?void 0:Fe.type)==="select_card_from_revealed_deck"&&C.actionRequired.actor==="player"&&o.jsx(Y0,{gameState:C,onSelectCard:me=>{Le(me)}}),((rt=C.actionRequired)==null?void 0:rt.type)==="prompt_optional_effect"&&C.actionRequired.actor==="player"&&o.jsx(G0,{gameState:C,onAccept:()=>Z(!0),onDecline:()=>Z(!1)}),o.jsx("div",{className:"toaster-container",children:nt.map(me=>o.jsx(z0,{message:me.message,player:me.player},me.id))}),He&&o.jsx(H0,{log:C.log,onClose:()=>$e(!1)}),o.jsx("button",{className:"btn log-button",onClick:()=>$e(!0),children:"Log"}),o.jsxs("div",{className:"game-screen-layout",children:[o.jsxs("div",{className:"game-preview-container",children:[o.jsx("h2",{onClick:xn,style:{cursor:"pointer",userSelect:"none"},title:"Click 5 times to toggle debug mode",children:"Mainframe"}),o.jsx(L0,{gameState:C,turn:((Qt=C.actionRequired)==null?void 0:Qt.actor)||C.turn,animationState:C.animationState,difficulty:i,onPlayerClick:()=>Vn("player"),onOpponentClick:()=>Vn("opponent")}),o.jsx("div",{className:"preview-card-area",children:St()}),o.jsx("button",{className:"btn btn-back",onClick:a,children:"Back"})]}),o.jsxs("div",{className:"game-main-area",children:[At&&o.jsx("div",{className:"compile-prompt-container",children:o.jsx("h3",{children:"Select a Protocol to Compile"})}),o.jsx(I0,{gameState:C,onLanePointerDown:Yn,onPlayFaceDown:oa,selectedCardId:j,onCardPointerDown:Gn,onCardPointerEnter:la,onCardPointerLeave:sa,onOpponentHandCardPointerEnter:nn,onOpponentHandCardPointerLeave:sa,sourceCardId:ue}),o.jsxs("div",{className:"player-action-area",children:[o.jsx(U0,{gameState:C,onFillHand:L,onSkipAction:A,onResolveOptionalDrawPrompt:O,onResolveDeath1Prompt:I,onResolveLove1Prompt:T,onResolvePlague2Discard:q,onResolvePlague4Flip:Y,onResolveFire3Prompt:K,onResolveOptionalDiscardCustomPrompt:P,onResolveOptionalEffectPrompt:Z,onResolveSpeed3Prompt:fe,onResolveFire4Discard:W,onResolveHate1Discard:G,onResolveLight2Prompt:H,onResolveRevealBoardCardPrompt:B,onResolvePsychic4Prompt:ye,onResolveSpirit1Prompt:de,onResolveSpirit3Prompt:J,onResolveControlMechanicPrompt:ke,onResolveCustomChoice:Ve,selectedCardId:j,multiSelectedCardIds:_t,actionRequiredClass:Ce}),o.jsx("div",{className:`player-hand-area ${Re}`,children:C.player.hand.filter(me=>{const xe=C.actionRequired;return(xe==null?void 0:xe.type)==="select_card_from_hand_to_play"&&(xe==null?void 0:xe.selectableCardIds)?xe.selectableCardIds.includes(me.id):!0}).map(me=>{var be;const xe=((be=C.actionRequired)==null?void 0:be.type)==="select_lane_for_play"?me.id===C.actionRequired.cardInHandId:me.id===j;return o.jsx(kt,{card:me,isFaceUp:!0,onPointerDown:()=>ra(me),onPointerEnter:()=>Wn(me),isSelected:xe,isMultiSelected:_t.includes(me.id),animationState:C.animationState,additionalClassName:"in-hand"},me.id)})})]})]})]}),m&&o.jsx(Q0,{onComplete:N}),ga&&o.jsx(ob,{onLoadScenario:at,onSkipCoinFlip:S,onForceWin:va,onForceLose:na})]})}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function sb({onPlayAgain:a,winner:n,finalState:l,difficulty:c}){if(!l)return o.jsxs("div",{className:"screen",children:[o.jsx("h1",{children:"Loading Results..."}),o.jsx("button",{className:"btn",onClick:a,children:"Back to Menu"})]});const i=n==="player",d=(u,h)=>{let f=[u];return h&&f.push("compiled"),f.join(" ")};return o.jsx("div",{className:`screen results-screen ${i?"victory":"defeat"}`,children:o.jsxs("div",{className:"results-screen-content",children:[o.jsxs("header",{className:"results-header",children:[o.jsx("h1",{children:i?"VICTORY":"DEFEAT"}),o.jsx("p",{children:i?"System compiled successfully.":"Critical error in the mainframe."})]}),o.jsxs("div",{className:"results-body",children:[o.jsxs("div",{className:"final-score-section",children:[o.jsx("h3",{children:"Final Score"}),o.jsxs("h4",{className:"results-label results-opponent-label",children:["Opponent (",c.charAt(0).toUpperCase()+c.slice(1),")"]}),o.jsxs("div",{className:"protocol-bars-container",children:[o.jsx("div",{className:"protocol-bar opponent-bar",children:l.opponent.protocols.map((u,h)=>o.jsxs("div",{className:d("protocol-display",l.opponent.compiled[h]),children:[o.jsx("span",{className:"protocol-name",children:u}),o.jsx("span",{className:"protocol-value",children:l.opponent.laneValues[h]})]},`opp-proto-${u}-${h}`))}),o.jsx("div",{className:"protocol-bar player-bar",children:l.player.protocols.map((u,h)=>o.jsxs("div",{className:d("protocol-display",l.player.compiled[h]),children:[o.jsx("span",{className:"protocol-name",children:u}),o.jsx("span",{className:"protocol-value",children:l.player.laneValues[h]})]},`player-proto-${u}-${h}`))})]}),o.jsx("h4",{className:"results-label results-player-label",children:"Player"})]}),o.jsxs("div",{className:"stats-section",children:[o.jsx("h3",{children:"Statistics"}),o.jsxs("div",{className:"stats-grid",children:[o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-item-label",children:"Cards Played"}),o.jsx("span",{className:"stat-item-value opponent",children:l.stats.opponent.cardsPlayed}),o.jsx("span",{className:"stat-item-value player",children:l.stats.player.cardsPlayed})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-item-label",children:"Cards Drawn"}),o.jsx("span",{className:"stat-item-value opponent",children:l.stats.opponent.cardsDrawn}),o.jsx("span",{className:"stat-item-value player",children:l.stats.player.cardsDrawn})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-item-label",children:"Cards Discarded"}),o.jsx("span",{className:"stat-item-value opponent",children:l.stats.opponent.cardsDiscarded}),o.jsx("span",{className:"stat-item-value player",children:l.stats.player.cardsDiscarded})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-item-label",children:"Cards Deleted"}),o.jsx("span",{className:"stat-item-value opponent",children:l.stats.opponent.cardsDeleted}),o.jsx("span",{className:"stat-item-value player",children:l.stats.player.cardsDeleted})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-item-label",children:"Cards Flipped"}),o.jsx("span",{className:"stat-item-value opponent",children:l.stats.opponent.cardsFlipped}),o.jsx("span",{className:"stat-item-value player",children:l.stats.player.cardsFlipped})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-item-label",children:"Cards Shifted"}),o.jsx("span",{className:"stat-item-value opponent",children:l.stats.opponent.cardsShifted}),o.jsx("span",{className:"stat-item-value player",children:l.stats.player.cardsShifted})]})]})]})]}),o.jsx("button",{className:"btn",onClick:a,children:"Play Again"})]})})}function cb({onBack:a}){const[n,l]=re.useState(0);re.useEffect(()=>{Bl(),l(S=>S+1)},[]);const c=re.useMemo(()=>{console.log("[Card Library] Loading cards, refreshKey:",n);const S=Pd(),k=Co(),C=Qo(),j=new Set(C.filter(F=>Or(F)).map(F=>F.name)),R=k.filter(F=>j.has(F.protocol)||S);return console.log("[Card Library] Total cards:",R.length,"(custom enabled:",S,")"),R},[n]),i=re.useMemo(()=>{const S=new Set(c.map(k=>k.protocol));return Array.from(S).sort()},[c]),[d,u]=re.useState(null),h=re.useMemo(()=>{const S=new Set(c.map(k=>k.category));return Array.from(S).sort()},[c]),[f,m]=re.useState(()=>new Set(h));re.useEffect(()=>{c.length>0&&!d&&u(c[0])},[c,d]);const y=S=>{m(k=>{const C=new Set(k);return C.has(S)?C.delete(S):C.add(S),C})},v=S=>{const k=c.find(C=>C.protocol===S);return(k==null?void 0:k.category)||""},_=re.useMemo(()=>i.filter(S=>{const k=v(S);return f.has(k)}),[i,f,c]),w=re.useMemo(()=>{const S={};for(const k of c)S[k.protocol]||(S[k.protocol]=[]),S[k.protocol].push(k);for(const k in S)S[k].sort((C,j)=>C.value-j.value);return S},[c]),b=S=>{u(S)},N=()=>{if(!d)return null;const S={...d,id:"preview",isFaceUp:!0};return o.jsx(kt,{card:S,isFaceUp:!0})};return o.jsxs("div",{className:"screen card-library-screen",children:[o.jsx(gc,{title:"Card Library",onBack:a}),o.jsxs("div",{className:"card-library-layout",children:[o.jsxs("div",{className:"game-preview-container",children:[o.jsx("h2",{children:"Card Preview"}),o.jsx("div",{className:"preview-card-area",children:N()})]}),o.jsxs("div",{className:"card-list-container",children:[o.jsx("div",{className:"category-filters",children:h.map(S=>o.jsxs("label",{className:"category-filter-item",children:[o.jsx("input",{type:"checkbox",checked:f.has(S),onChange:()=>y(S)}),o.jsx("span",{children:S})]},S))}),_.map(S=>o.jsxs("div",{className:"protocol-group",children:[o.jsxs("h3",{children:[S,o.jsxs("span",{className:"protocol-category-label",children:[" (",v(S),")"]})]}),o.jsx("div",{className:"protocol-card-grid",children:w[S].map(k=>{const C={...k,id:`${k.protocol}-${k.value}`,isFaceUp:!0};return o.jsx(kt,{card:C,isFaceUp:!0,additionalClassName:"in-hand",onPointerEnter:()=>b(k),onPointerDown:()=>b(k)},C.id)})})]},S))]})]})]})}function ib({onBack:a}){const[n,l]=re.useState(()=>$d()),[c,i]=re.useState(!1),d=zC(n),u=VC(n),h=BC(n),f=YC(n),m=GC(n),y=WC(n),v=QC(n),[_,w]=re.useState(null),b=()=>{UC(),l($d()),i(!1)},N=K=>{w(P=>P===K?null:K)},S=n.global.totalGamesPlayed,k=n.actions.detailedStats,C=K=>S>0?(K/S).toFixed(1):"0.0",j=(K,P)=>P>0?(K/P).toFixed(1):"0.0",R=k.cardsDrawn.playerFromRefresh+k.cardsDrawn.playerFromEffect,F=k.cardsDrawn.aiFromRefresh+k.cardsDrawn.aiFromEffect,L=R+F,U=k.cardsPlayed.playerFromHand+k.cardsPlayed.playerFromEffect,Q=k.cardsPlayed.aiFromHand+k.cardsPlayed.aiFromEffect,X=U+Q,V=k.compiles.playerFirstCompile+k.compiles.playerRecompile,$=k.compiles.aiFirstCompile+k.compiles.aiRecompile,E=V+$,A=k.discards.player+k.discards.ai,O=k.deletes.player+k.deletes.ai,I=k.flips.player+k.flips.ai,T=k.shifts.player+k.shifts.ai,q=k.returns.player+k.returns.ai,Y=k.refreshes.player+k.refreshes.ai;return o.jsxs("div",{className:"screen statistics-screen",children:[o.jsx(gc,{title:"STATISTICS",onBack:a}),o.jsxs("div",{className:"stats-content",children:[o.jsxs("section",{className:"stats-section",children:[o.jsx("h2",{className:"section-title",children:"Overview"}),o.jsxs("div",{className:"stats-grid",children:[o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Games Played"}),o.jsx("span",{className:"stat-value",children:n.global.totalGamesPlayed})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Win Rate"}),o.jsxs("span",{className:"stat-value",children:[d.toFixed(1),"%"]})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Games Won"}),o.jsx("span",{className:"stat-value win",children:n.global.totalGamesWon})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Games Lost"}),o.jsx("span",{className:"stat-value loss",children:n.global.totalGamesLost})]})]})]}),o.jsxs("section",{className:"stats-section",children:[o.jsx("h2",{className:"section-title",children:"Streaks"}),o.jsxs("div",{className:"stats-grid",children:[o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Current Streak"}),o.jsx("span",{className:`stat-value ${n.global.currentStreak>0?"win":n.global.currentStreak<0?"loss":""}`,children:n.global.currentStreak>0?`+${n.global.currentStreak}`:n.global.currentStreak})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Best Win Streak"}),o.jsx("span",{className:"stat-value win",children:n.global.longestWinStreak})]})]})]}),o.jsxs("section",{className:"stats-section",children:[o.jsx("h2",{className:"section-title",children:"Playtime"}),o.jsxs("div",{className:"stats-grid",children:[o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Total Playtime"}),o.jsx("span",{className:"stat-value",children:Vl(n.global.totalPlaytime)})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Average Game"}),o.jsx("span",{className:"stat-value",children:Vl(u)})]}),n.global.fastestWin&&o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Fastest Win"}),o.jsx("span",{className:"stat-value",children:Vl(n.global.fastestWin)})]}),n.global.longestGame&&o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Longest Game"}),o.jsx("span",{className:"stat-value",children:Vl(n.global.longestGame)})]}),n.global.lastGameDuration&&o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Last Game"}),o.jsx("span",{className:"stat-value",children:Vl(n.global.lastGameDuration)})]})]})]}),o.jsxs("section",{className:"stats-section",children:[o.jsx("h2",{className:"section-title",children:"AI Performance"}),o.jsx("div",{className:"ai-stats",children:["easy","normal","hard"].map(K=>{const P=n.aiDifficulty[K],Z=P.played>0?P.wins/P.played*100:0;return o.jsxs("div",{className:"ai-item",children:[o.jsx("span",{className:"ai-name",children:K}),o.jsxs("span",{className:"ai-record",children:[o.jsxs("span",{className:"win",children:[P.wins,"W"]})," - ",o.jsxs("span",{className:"loss",children:[P.losses,"L"]})]}),o.jsxs("span",{className:"ai-winrate",children:["(",Z.toFixed(1),"%)"]})]},K)})})]}),f.length>0&&o.jsxs("section",{className:"stats-section",children:[o.jsx("h2",{className:"section-title",children:"Best Win Rate"}),o.jsx("div",{className:"protocol-list",children:f.map((K,P)=>o.jsxs("div",{className:"protocol-item",children:[o.jsxs("span",{className:"protocol-rank",children:[P+1,"."]}),o.jsx("span",{className:"protocol-name",children:K.protocol}),o.jsxs("span",{className:"protocol-stats win",children:[K.winRate.toFixed(0),"%  ",K.timesUsed]})]},K.protocol))})]}),h.length>0&&o.jsxs("section",{className:"stats-section",children:[o.jsx("h2",{className:"section-title",children:"Favorite Protocols"}),o.jsx("div",{className:"protocol-list",children:h.map((K,P)=>o.jsxs("div",{className:"protocol-item",children:[o.jsxs("span",{className:"protocol-rank",children:[P+1,"."]}),o.jsx("span",{className:"protocol-name",children:K.protocol}),o.jsxs("span",{className:"protocol-stats",children:[K.timesUsed,"  ",K.winRate.toFixed(0),"%"]})]},K.protocol))})]}),m.length>0&&o.jsxs("section",{className:"stats-section",children:[o.jsx("h2",{className:"section-title",children:"Least Used Protocols"}),o.jsx("div",{className:"protocol-list",children:m.map((K,P)=>o.jsxs("div",{className:"protocol-item",children:[o.jsxs("span",{className:"protocol-rank",children:[P+1,"."]}),o.jsx("span",{className:"protocol-name",children:K.protocol}),o.jsxs("span",{className:"protocol-stats",children:[K.timesUsed,"  ",K.winRate.toFixed(0),"%"]})]},K.protocol))})]}),y.length>0&&o.jsxs("section",{className:"stats-section",children:[o.jsx("h2",{className:"section-title",children:"Most Played Cards"}),o.jsx("div",{className:"card-list",children:y.map((K,P)=>o.jsxs("div",{className:"card-item",children:[o.jsxs("span",{className:"card-rank",children:[P+1,"."]}),o.jsx("span",{className:"card-name",children:K.card}),o.jsxs("span",{className:"card-count",children:[K.count,""]})]},K.card))})]}),v.length>0&&o.jsxs("section",{className:"stats-section",children:[o.jsx("h2",{className:"section-title",children:"Most Deleted Cards"}),o.jsx("div",{className:"card-list",children:v.map((K,P)=>o.jsxs("div",{className:"card-item",children:[o.jsxs("span",{className:"card-rank",children:[P+1,"."]}),o.jsx("span",{className:"card-name",children:K.card}),o.jsxs("span",{className:"card-count",children:[K.count,""]})]},K.card))})]}),o.jsxs("section",{className:"stats-section",children:[o.jsx("h2",{className:"section-title",children:"Control Mechanic"}),o.jsxs("div",{className:"stats-grid",children:[o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"With Control"}),o.jsx("span",{className:"stat-value",children:n.control.gamesWithControl})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Without Control"}),o.jsx("span",{className:"stat-value",children:n.control.gamesWithoutControl})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Your Rearranges"}),o.jsx("span",{className:"stat-value",children:n.control.playerRearranges})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"AI Rearranges"}),o.jsx("span",{className:"stat-value",children:n.control.aiRearranges})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Total Rearranges"}),o.jsx("span",{className:"stat-value",children:n.control.totalRearranges})]})]})]}),o.jsxs("section",{className:"stats-section",children:[o.jsx("h2",{className:"section-title",children:"Coin Flip"}),o.jsxs("div",{className:"stats-grid",children:[o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Heads Chosen"}),o.jsxs("span",{className:"stat-value",children:[n.coinFlip.headsChosen," (",n.coinFlip.headsChosen>0?(n.coinFlip.headsWon/n.coinFlip.headsChosen*100).toFixed(0):0,"%)"]})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Tails Chosen"}),o.jsxs("span",{className:"stat-value",children:[n.coinFlip.tailsChosen," (",n.coinFlip.tailsChosen>0?(n.coinFlip.tailsWon/n.coinFlip.tailsChosen*100).toFixed(0):0,"%)"]})]})]})]}),o.jsxs("section",{className:"stats-section full-width",children:[o.jsx("h2",{className:"section-title",children:"Actions (click for details)"}),o.jsxs("div",{className:"actions-container",children:[o.jsxs("div",{className:`stat-item clickable ${_==="played"?"expanded":""}`,onClick:()=>N("played"),children:[o.jsx("span",{className:"stat-label",children:"Cards Played"}),o.jsx("span",{className:"stat-value",children:X})]}),o.jsxs("div",{className:`stat-item clickable ${_==="drawn"?"expanded":""}`,onClick:()=>N("drawn"),children:[o.jsx("span",{className:"stat-label",children:"Cards Drawn"}),o.jsx("span",{className:"stat-value",children:L})]}),o.jsxs("div",{className:`stat-item clickable ${_==="discards"?"expanded":""}`,onClick:()=>N("discards"),children:[o.jsx("span",{className:"stat-label",children:"Discards"}),o.jsx("span",{className:"stat-value",children:A})]}),o.jsxs("div",{className:`stat-item clickable ${_==="deletes"?"expanded":""}`,onClick:()=>N("deletes"),children:[o.jsx("span",{className:"stat-label",children:"Deletes"}),o.jsx("span",{className:"stat-value",children:O})]}),o.jsxs("div",{className:`stat-item clickable ${_==="flips"?"expanded":""}`,onClick:()=>N("flips"),children:[o.jsx("span",{className:"stat-label",children:"Flips"}),o.jsx("span",{className:"stat-value",children:I})]}),o.jsxs("div",{className:`stat-item clickable ${_==="shifts"?"expanded":""}`,onClick:()=>N("shifts"),children:[o.jsx("span",{className:"stat-label",children:"Shifts"}),o.jsx("span",{className:"stat-value",children:T})]}),o.jsxs("div",{className:`stat-item clickable ${_==="returns"?"expanded":""}`,onClick:()=>N("returns"),children:[o.jsx("span",{className:"stat-label",children:"Returns"}),o.jsx("span",{className:"stat-value",children:q})]}),o.jsxs("div",{className:`stat-item clickable ${_==="compiles"?"expanded":""}`,onClick:()=>N("compiles"),children:[o.jsx("span",{className:"stat-label",children:"Compiles"}),o.jsx("span",{className:"stat-value",children:E})]}),o.jsxs("div",{className:`stat-item clickable ${_==="refreshes"?"expanded":""}`,onClick:()=>N("refreshes"),children:[o.jsx("span",{className:"stat-label",children:"Refreshes"}),o.jsx("span",{className:"stat-value",children:Y})]})]}),_==="played"&&o.jsxs("div",{className:"action-details-section",children:[o.jsx("h3",{className:"section-title",children:"Cards Played"}),o.jsxs("div",{className:"action-details-total",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:X})]}),o.jsxs("div",{className:"action-details-columns",children:[o.jsxs("div",{className:"action-details-column player",children:[o.jsx("div",{className:"column-header",children:"Player"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:U})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"From Hand"}),o.jsx("span",{className:"detail-value",children:k.cardsPlayed.playerFromHand})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"From Effect"}),o.jsx("span",{className:"detail-value",children:k.cardsPlayed.playerFromEffect})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Face-Up"}),o.jsx("span",{className:"detail-value",children:k.cardsPlayed.playerFaceUp})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Face-Down"}),o.jsx("span",{className:"detail-value",children:k.cardsPlayed.playerFaceDown})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:C(U)})]})]}),o.jsxs("div",{className:"action-details-column ai",children:[o.jsx("div",{className:"column-header",children:"AI"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:Q})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"From Hand"}),o.jsx("span",{className:"detail-value",children:k.cardsPlayed.aiFromHand})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"From Effect"}),o.jsx("span",{className:"detail-value",children:k.cardsPlayed.aiFromEffect})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Face-Up"}),o.jsx("span",{className:"detail-value",children:k.cardsPlayed.aiFaceUp})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Face-Down"}),o.jsx("span",{className:"detail-value",children:k.cardsPlayed.aiFaceDown})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:C(Q)})]})]})]})]}),_==="drawn"&&o.jsxs("div",{className:"action-details-section",children:[o.jsx("h3",{className:"section-title",children:"Cards Drawn"}),o.jsxs("div",{className:"action-details-total",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:L})]}),o.jsxs("div",{className:"action-details-columns",children:[o.jsxs("div",{className:"action-details-column player",children:[o.jsx("div",{className:"column-header",children:"Player"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:R})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"From Refresh"}),o.jsx("span",{className:"detail-value",children:k.cardsDrawn.playerFromRefresh})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"From Effect"}),o.jsx("span",{className:"detail-value",children:k.cardsDrawn.playerFromEffect})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:C(R)})]})]}),o.jsxs("div",{className:"action-details-column ai",children:[o.jsx("div",{className:"column-header",children:"AI"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:F})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"From Refresh"}),o.jsx("span",{className:"detail-value",children:k.cardsDrawn.aiFromRefresh})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"From Effect"}),o.jsx("span",{className:"detail-value",children:k.cardsDrawn.aiFromEffect})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:C(F)})]})]})]})]}),_==="discards"&&o.jsxs("div",{className:"action-details-section",children:[o.jsx("h3",{className:"section-title",children:"Discards"}),o.jsxs("div",{className:"action-details-total",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:A})]}),o.jsxs("div",{className:"action-details-columns",children:[o.jsxs("div",{className:"action-details-column player",children:[o.jsx("div",{className:"column-header",children:"Player"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:k.discards.player})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:C(k.discards.player)})]})]}),o.jsxs("div",{className:"action-details-column ai",children:[o.jsx("div",{className:"column-header",children:"AI"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:k.discards.ai})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:C(k.discards.ai)})]})]})]})]}),_==="deletes"&&o.jsxs("div",{className:"action-details-section",children:[o.jsx("h3",{className:"section-title",children:"Deletes"}),o.jsxs("div",{className:"action-details-total",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:O})]}),o.jsxs("div",{className:"action-details-columns",children:[o.jsxs("div",{className:"action-details-column player",children:[o.jsx("div",{className:"column-header",children:"Player"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:k.deletes.player})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:C(k.deletes.player)})]})]}),o.jsxs("div",{className:"action-details-column ai",children:[o.jsx("div",{className:"column-header",children:"AI"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:k.deletes.ai})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:C(k.deletes.ai)})]})]})]})]}),_==="flips"&&o.jsxs("div",{className:"action-details-section",children:[o.jsx("h3",{className:"section-title",children:"Flips"}),o.jsxs("div",{className:"action-details-total",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:I})]}),o.jsxs("div",{className:"action-details-columns",children:[o.jsxs("div",{className:"action-details-column player",children:[o.jsx("div",{className:"column-header",children:"Player"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:k.flips.player})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:C(k.flips.player)})]})]}),o.jsxs("div",{className:"action-details-column ai",children:[o.jsx("div",{className:"column-header",children:"AI"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:k.flips.ai})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:C(k.flips.ai)})]})]})]})]}),_==="shifts"&&o.jsxs("div",{className:"action-details-section",children:[o.jsx("h3",{className:"section-title",children:"Shifts"}),o.jsxs("div",{className:"action-details-total",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:T})]}),o.jsxs("div",{className:"action-details-columns",children:[o.jsxs("div",{className:"action-details-column player",children:[o.jsx("div",{className:"column-header",children:"Player"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:k.shifts.player})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:C(k.shifts.player)})]})]}),o.jsxs("div",{className:"action-details-column ai",children:[o.jsx("div",{className:"column-header",children:"AI"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:k.shifts.ai})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:C(k.shifts.ai)})]})]})]})]}),_==="returns"&&o.jsxs("div",{className:"action-details-section",children:[o.jsx("h3",{className:"section-title",children:"Returns"}),o.jsxs("div",{className:"action-details-total",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:q})]}),o.jsxs("div",{className:"action-details-columns",children:[o.jsxs("div",{className:"action-details-column player",children:[o.jsx("div",{className:"column-header",children:"Player"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:k.returns.player})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:C(k.returns.player)})]})]}),o.jsxs("div",{className:"action-details-column ai",children:[o.jsx("div",{className:"column-header",children:"AI"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:k.returns.ai})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:C(k.returns.ai)})]})]})]})]}),_==="compiles"&&o.jsxs("div",{className:"action-details-section",children:[o.jsx("h3",{className:"section-title",children:"Compiles"}),o.jsxs("div",{className:"action-details-total",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:E})]}),o.jsxs("div",{className:"action-details-columns",children:[o.jsxs("div",{className:"action-details-column player",children:[o.jsx("div",{className:"column-header",children:"Player"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:V})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"First-Compile"}),o.jsx("span",{className:"detail-value",children:k.compiles.playerFirstCompile})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Re-Compile"}),o.jsx("span",{className:"detail-value",children:k.compiles.playerRecompile})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:C(V)})]})]}),o.jsxs("div",{className:"action-details-column ai",children:[o.jsx("div",{className:"column-header",children:"AI"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:$})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"First-Compile"}),o.jsx("span",{className:"detail-value",children:k.compiles.aiFirstCompile})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Re-Compile"}),o.jsx("span",{className:"detail-value",children:k.compiles.aiRecompile})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:C($)})]})]})]})]}),_==="refreshes"&&o.jsxs("div",{className:"action-details-section",children:[o.jsx("h3",{className:"section-title",children:"Refreshes"}),o.jsxs("div",{className:"action-details-total",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:Y})]}),o.jsxs("div",{className:"action-details-columns",children:[o.jsxs("div",{className:"action-details-column player",children:[o.jsx("div",{className:"column-header",children:"Player"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:k.refreshes.player})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Cards / Refresh"}),o.jsx("span",{className:"detail-value",children:j(k.refreshes.playerCardsDrawn,k.refreshes.player)})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:C(k.refreshes.player)})]})]}),o.jsxs("div",{className:"action-details-column ai",children:[o.jsx("div",{className:"column-header",children:"AI"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:k.refreshes.ai})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Cards / Refresh"}),o.jsx("span",{className:"detail-value",children:j(k.refreshes.aiCardsDrawn,k.refreshes.ai)})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:C(k.refreshes.ai)})]})]})]})]})]}),o.jsx("section",{className:"stats-section reset-section",children:o.jsx("button",{className:"reset-stats-button",onClick:()=>i(!0),children:"Reset All Statistics"})})]}),c&&o.jsx("div",{className:"reset-modal-overlay",onClick:()=>i(!1),children:o.jsxs("div",{className:"reset-modal",onClick:K=>K.stopPropagation(),children:[o.jsx("h3",{children:"Reset Statistics?"}),o.jsx("p",{children:"This will permanently delete all your statistics. This action cannot be undone."}),o.jsxs("div",{className:"reset-modal-buttons",children:[o.jsx("button",{className:"cancel-button",onClick:()=>i(!1),children:"Cancel"}),o.jsx("button",{className:"confirm-reset-button",onClick:b,children:"Reset"})]})]})})]})}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Ky=({params:a,onChange:n})=>{var l,c,i,d,u;return o.jsxs("div",{className:"param-editor draw-effect-editor",children:[o.jsx("h4",{children:"Draw Effect Parameters"}),o.jsxs("label",{children:["Count Type",o.jsxs("select",{value:a.countType||"fixed",onChange:h=>{const f=h.target.value;n({...a,countType:f,countOffset:f==="equal_to_discarded"?0:void 0})},children:[o.jsx("option",{value:"fixed",children:"Fixed Amount"}),o.jsx("option",{value:"equal_to_card_value",children:"Equal to Card Value (from previous effect)"}),o.jsx("option",{value:"equal_to_discarded",children:"Equal to Discarded Cards"}),o.jsx("option",{value:"hand_size",children:"Equal to Hand Size"})]})]}),(!a.countType||a.countType==="fixed")&&o.jsxs("label",{children:["Card Count",o.jsx("input",{type:"number",min:1,max:6,value:a.count,onChange:h=>n({...a,count:parseInt(h.target.value)||1})})]}),a.countType==="equal_to_discarded"&&o.jsxs("label",{children:["Offset (+/-)",o.jsx("input",{type:"number",min:-5,max:5,value:a.countOffset||0,onChange:h=>n({...a,countOffset:parseInt(h.target.value)||0})}),o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:'Example: +1 for "discard count plus 1" (Fire-4)'})]}),o.jsxs("label",{children:["Target",o.jsxs("select",{value:a.target,onChange:h=>n({...a,target:h.target.value}),children:[o.jsx("option",{value:"self",children:"Self"}),o.jsx("option",{value:"opponent",children:"Opponent"})]})]}),o.jsxs("label",{children:["Source",o.jsxs("select",{value:a.source,onChange:h=>n({...a,source:h.target.value}),children:[o.jsx("option",{value:"own_deck",children:"Own Deck"}),o.jsx("option",{value:"opponent_deck",children:"Opponent's Deck"})]})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a.preAction==="refresh",onChange:h=>n({...a,preAction:h.target.checked?"refresh":void 0})}),"Refresh hand first (shuffle hand into deck, then draw)"]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a.optional||!1,onChange:h=>n({...a,optional:h.target.checked})}),'Optional ("You may draw" instead of "Draw")']}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a.valueFilter!==void 0,onChange:h=>{if(h.target.checked)n({...a,valueFilter:{equals:1}});else{const{valueFilter:f,...m}=a;n(m)}}}),'Draw specific value only (e.g., "Draw 1 card with a value of X")']}),a.valueFilter!==void 0&&o.jsxs(o.Fragment,{children:[o.jsxs("label",{children:["Card Value to Draw",o.jsx("input",{type:"number",min:0,max:5,value:((l=a.valueFilter)==null?void 0:l.equals)??1,onChange:h=>n({...a,valueFilter:{equals:parseInt(h.target.value)||0}})}),o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"Only draws cards with this exact value from the deck"})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a.fromRevealed||!1,onChange:h=>n({...a,fromRevealed:h.target.checked})}),'From revealed deck ("revealed this way" - player selects)',o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:'Requires "Reveal your deck" effect before this. Player picks from revealed cards.'})]})]}),o.jsxs("label",{children:["Conditional",o.jsxs("select",{value:((c=a.conditional)==null?void 0:c.type)||"none",onChange:h=>{if(h.target.value==="none"){const{conditional:f,...m}=a;n(m)}else n({...a,conditional:{type:h.target.value}})},children:[o.jsx("option",{value:"none",children:"None"}),o.jsx("option",{value:"count_face_down",children:"1 per face-down card (all on board)"}),o.jsx("option",{value:"is_covering",children:"Only if this card is covering another"}),o.jsx("option",{value:"non_matching_protocols",children:"1 per line with non-matching protocol"})]})]}),o.jsxs("label",{children:["Advanced Conditional",o.jsxs("select",{value:((i=a.advancedConditional)==null?void 0:i.type)||"none",onChange:h=>{if(h.target.value==="none"){const{advancedConditional:f,...m}=a;n(m)}else h.target.value==="protocol_match"?n({...a,advancedConditional:{type:"protocol_match",protocol:""}}):h.target.value==="compile_block"?n({...a,advancedConditional:{type:"compile_block",turnDuration:1}}):h.target.value==="empty_hand"?n({...a,advancedConditional:{type:"empty_hand"}}):h.target.value==="opponent_higher_value_in_lane"&&n({...a,advancedConditional:{type:"opponent_higher_value_in_lane"}})},children:[o.jsx("option",{value:"none",children:"None"}),o.jsx("option",{value:"protocol_match",children:"Only if in line with matching protocol"}),o.jsx("option",{value:"compile_block",children:"Block opponent's compile next turn"}),o.jsx("option",{value:"empty_hand",children:"Only if hand is empty"}),o.jsx("option",{value:"opponent_higher_value_in_lane",children:"Only if opponent has higher value in this lane"})]})]}),((d=a.advancedConditional)==null?void 0:d.type)==="protocol_match"&&o.jsxs("label",{children:["Required Protocol",o.jsx("input",{type:"text",placeholder:"e.g., Fire, Water, Lightning",value:a.advancedConditional.protocol||"",onChange:h=>n({...a,advancedConditional:{...a.advancedConditional,type:"protocol_match",protocol:h.target.value}})}),o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"Only draw if this card is in a line with this protocol"})]}),((u=a.advancedConditional)==null?void 0:u.type)==="compile_block"&&o.jsxs("label",{children:["Block Duration (turns)",o.jsx("input",{type:"number",min:1,max:3,value:a.advancedConditional.turnDuration||1,onChange:h=>n({...a,advancedConditional:{...a.advancedConditional,type:"compile_block",turnDuration:parseInt(h.target.value)||1}})}),o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"Opponent can't compile for this many turns"})]})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const db=({params:a,onChange:n})=>o.jsxs("div",{className:"param-editor refresh-effect-editor",children:[o.jsx("h4",{children:"Refresh Effect Parameters"}),o.jsx("p",{className:"effect-description",children:'Refresh fills the hand to 5 cards (Spirit-0: "Refresh.")'}),o.jsxs("label",{children:["Target",o.jsxs("select",{value:a.target||"self",onChange:l=>n({...a,target:l.target.value}),children:[o.jsx("option",{value:"self",children:"Self"}),o.jsx("option",{value:"opponent",children:"Opponent"})]})]})]});/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const ub=({params:a,onChange:n})=>o.jsxs("div",{className:"param-editor mutual-draw-effect-editor",children:[o.jsx("h4",{children:"Mutual Draw Effect Parameters"}),o.jsx("p",{className:"effect-description",children:`Both players draw from each other's decks (Chaos-0: "Draw the top card of your opponent's deck. Your opponent draws the top card of your deck.")`}),o.jsxs("label",{children:["Count",o.jsx("input",{type:"number",min:"1",max:"10",value:a.count||1,onChange:l=>n({...a,count:parseInt(l.target.value)||1})})]})]});/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Jy=({params:a,onChange:n})=>{var i,d;const l=a.targetFilter||{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1},c=a.count??1;return o.jsxs("div",{className:"param-editor flip-effect-editor",children:[o.jsx("h4",{children:"Flip Effect Parameters"}),o.jsxs("label",{children:["Card Count/Scope",o.jsxs("select",{value:c==="all"?"all":c==="each"?"each":c.toString(),onChange:u=>{const h=u.target.value;n(h==="all"?{...a,count:"all"}:h==="each"?{...a,count:"each"}:{...a,count:parseInt(h)})},children:[o.jsx("option",{value:"1",children:"1 card"}),o.jsx("option",{value:"2",children:"2 cards"}),o.jsx("option",{value:"3",children:"3 cards"}),o.jsx("option",{value:"all",children:"All matching cards"}),o.jsx("option",{value:"each",children:"Each matching card"})]})]}),typeof a.count=="number"&&o.jsxs("label",{children:["Scope",o.jsxs("select",{value:a.scope||"any",onChange:u=>n({...a,scope:u.target.value}),children:[o.jsx("option",{value:"any",children:"Any lane"}),o.jsx("option",{value:"this_lane",children:"This lane only"}),o.jsx("option",{value:"each_lane",children:'Each lane (Chaos-0: "In each line...")'})]})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a.optional,onChange:u=>n({...a,optional:u.target.checked})}),'Optional ("May flip" instead of "Flip")']}),a.count==="each"&&o.jsxs("label",{children:["Each Line Scope",o.jsxs("select",{value:a.eachLineScope||"all_lines",onChange:u=>n({...a,eachLineScope:u.target.value}),children:[o.jsx("option",{value:"all_lines",children:"Each card on board"}),o.jsx("option",{value:"each_line",children:"1 card in each line"})]})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a.flipSelf||!1,onChange:u=>n({...a,flipSelf:u.target.checked})}),"Flip ONLY this card (no target selection)",o.jsx("small",{style:{display:"block",marginLeft:"24px",color:"#8A79E8"},children:"The card flips itself, ignoring count and target filter."})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a.selfFlipAfter||!1,onChange:u=>n({...a,selfFlipAfter:u.target.checked})}),"ALSO flip this card after flipping targets",o.jsx("small",{style:{display:"block",marginLeft:"24px",color:"#8A79E8"},children:"After flipping target(s), also flip this card as bonus."})]}),o.jsx("h5",{children:"Advanced Conditional"}),o.jsxs("label",{children:["Conditional Type",o.jsxs("select",{value:((i=a.advancedConditional)==null?void 0:i.type)||"",onChange:u=>{if(u.target.value===""){const{advancedConditional:h,...f}=a;n(f)}else u.target.value==="protocol_match"?n({...a,advancedConditional:{type:"protocol_match",protocol:""}}):n({...a,advancedConditional:{type:u.target.value}})},children:[o.jsx("option",{value:"",children:"None"}),o.jsx("option",{value:"protocol_match",children:"Only if in specific protocol line"}),o.jsx("option",{value:"opponent_higher_value_in_lane",children:"Only if opponent has higher value in this lane"})]})]}),((d=a.advancedConditional)==null?void 0:d.type)==="protocol_match"&&o.jsxs("label",{children:["Required Protocol",o.jsx("input",{type:"text",value:a.advancedConditional.protocol||"",onChange:u=>n({...a,advancedConditional:{...a.advancedConditional,protocol:u.target.value}}),placeholder:"e.g., Anarchy, Fire, Death"})]}),o.jsx("h5",{children:"Target Filter"}),o.jsxs("label",{children:["Owner",o.jsxs("select",{value:l.owner,onChange:u=>n({...a,targetFilter:{...l,owner:u.target.value}}),children:[o.jsx("option",{value:"any",children:"Any"}),o.jsx("option",{value:"own",children:"Own"}),o.jsx("option",{value:"opponent",children:"Opponent"})]})]}),o.jsxs("label",{children:["Position",o.jsxs("select",{value:l.position,onChange:u=>n({...a,targetFilter:{...l,position:u.target.value}}),children:[o.jsx("option",{value:"any",children:"Any"}),o.jsx("option",{value:"uncovered",children:"Uncovered (top card)"}),o.jsx("option",{value:"covered",children:"Covered"}),o.jsx("option",{value:"covered_in_this_line",children:"Covered in this line"})]})]}),o.jsxs("label",{children:["Face State",o.jsxs("select",{value:l.faceState,onChange:u=>n({...a,targetFilter:{...l,faceState:u.target.value}}),children:[o.jsx("option",{value:"any",children:"Any"}),o.jsx("option",{value:"face_up",children:"Face-up"}),o.jsx("option",{value:"face_down",children:"Face-down"})]})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:l.excludeSelf,onChange:u=>n({...a,targetFilter:{...l,excludeSelf:u.target.checked}})}),'Exclude self ("other cards")']})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const eg=({params:a,onChange:n})=>{var c,i,d;const l=a.targetFilter||{owner:"any",position:"uncovered",faceState:"any"};return o.jsxs("div",{className:"param-editor",children:[o.jsx("h4",{children:"Shift Effect"}),o.jsxs("label",{children:["Count/Scope",o.jsxs("select",{value:a.count==="all"?"all":"1",onChange:u=>{if(u.target.value==="all")n({...a,count:"all"});else{const{count:h,...f}=a;n(f)}},children:[o.jsx("option",{value:"1",children:"1 card"}),o.jsx("option",{value:"all",children:"All matching cards"})]})]}),o.jsxs("label",{children:["Target Owner",o.jsxs("select",{value:l.owner||"any",onChange:u=>n({...a,targetFilter:{...l,owner:u.target.value}}),children:[o.jsx("option",{value:"any",children:"Any"}),o.jsx("option",{value:"own",children:"Own"}),o.jsx("option",{value:"opponent",children:"Opponent"})]})]}),o.jsxs("label",{children:["Position",o.jsxs("select",{value:l.position||"uncovered",onChange:u=>n({...a,targetFilter:{...l,position:u.target.value}}),children:[o.jsx("option",{value:"any",children:"Any"}),o.jsx("option",{value:"uncovered",children:"Uncovered"}),o.jsx("option",{value:"covered",children:"Covered"})]})]}),o.jsxs("label",{children:["Face State",o.jsxs("select",{value:l.faceState||"any",onChange:u=>n({...a,targetFilter:{...l,faceState:u.target.value}}),children:[o.jsx("option",{value:"any",children:"Any"}),o.jsx("option",{value:"face_up",children:"Face-up"}),o.jsx("option",{value:"face_down",children:"Face-down"})]})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:l.excludeSelf||!1,onChange:u=>n({...a,targetFilter:{...l,excludeSelf:u.target.checked}})}),'Exclude self ("other card")']}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a.optional||!1,onChange:u=>n({...a,optional:u.target.checked})}),'Optional ("You may shift" instead of "Shift")']}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a.shiftSelf||!1,onChange:u=>n({...a,shiftSelf:u.target.checked})}),"Shift this card (instead of selecting target)",o.jsx("small",{style:{display:"block",marginLeft:"24px",color:"#8A79E8"},children:"The card shifts itself, ignoring target filter."})]}),o.jsx("h5",{children:"Advanced Conditional"}),o.jsxs("label",{children:["Conditional Type",o.jsxs("select",{value:((c=a.advancedConditional)==null?void 0:c.type)||"none",onChange:u=>{if(u.target.value==="none"){const{advancedConditional:h,...f}=a;n(f)}else n({...a,advancedConditional:{type:u.target.value}})},children:[o.jsx("option",{value:"none",children:"None"}),o.jsx("option",{value:"empty_hand",children:"Only if hand is empty"}),o.jsx("option",{value:"opponent_higher_value_in_lane",children:"Only if opponent has higher value in this lane"}),o.jsx("option",{value:"this_card_is_covered",children:"Only if this card is covered"})]})]}),o.jsxs("label",{children:["Destination",o.jsxs("select",{value:((i=a.destinationRestriction)==null?void 0:i.type)||"any",onChange:u=>{if(u.target.value==="any"){const{destinationRestriction:h,...f}=a;n(f)}else n({...a,destinationRestriction:{type:u.target.value}})},children:[o.jsx("option",{value:"any",children:"Any line"}),o.jsx("option",{value:"to_another_line",children:"To another line"}),o.jsx("option",{value:"non_matching_protocol",children:"Non-matching protocol"}),o.jsx("option",{value:"specific_lane",children:"This line (within)"}),o.jsx("option",{value:"to_this_lane",children:"To THIS lane only"}),o.jsx("option",{value:"to_or_from_this_lane",children:"To OR from this lane"}),o.jsx("option",{value:"opponent_highest_value_lane",children:"To opponent's highest value lane"})]}),((d=a.destinationRestriction)==null?void 0:d.type)==="opponent_highest_value_lane"&&o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"Card can only be shifted to the lane where opponent has highest total value."})]}),o.jsxs("label",{children:["Source Scope",o.jsxs("select",{value:a.scope||"any",onChange:u=>{if(u.target.value==="any"){const{scope:h,...f}=a;n(f)}else n({...a,scope:u.target.value})},children:[o.jsx("option",{value:"any",children:"Any lane (select from all lanes)"}),o.jsx("option",{value:"this_lane",children:"This line only"}),o.jsx("option",{value:"each_lane",children:"Each lane (execute per lane)"})]}),a.scope==="this_lane"&&o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"Only cards in this line can be selected as shift targets."})]})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const tg=({params:a,onChange:n})=>{var c,i,d,u,h,f,m,y;const l=a.targetFilter||{position:"uncovered",faceState:"any"};return o.jsxs("div",{className:"param-editor delete-effect-editor",children:[o.jsx("h4",{children:"Delete Effect Parameters"}),o.jsxs("label",{children:["Anzahl",o.jsxs("select",{value:typeof a.count=="number"?a.count.toString():"all",onChange:v=>n({...a,count:v.target.value==="all"?"all_in_lane":parseInt(v.target.value)}),children:[o.jsx("option",{value:"1",children:"1"}),o.jsx("option",{value:"2",children:"2"}),o.jsx("option",{value:"3",children:"3"}),o.jsx("option",{value:"all",children:"All in a lane"})]})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a.excludeSelf,onChange:v=>n({...a,excludeSelf:v.target.checked})}),"Exclude self (other cards only)"]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a.deleteSelf||!1,onChange:v=>n({...a,deleteSelf:v.target.checked})}),"Delete this card (ignores all other settings)"]}),o.jsx("h5",{children:"Target Filter"}),o.jsxs("label",{children:["Position",o.jsxs("select",{value:l.position,onChange:v=>n({...a,targetFilter:{...l,position:v.target.value}}),children:[o.jsx("option",{value:"any",children:"Any"}),o.jsx("option",{value:"uncovered",children:"Uncovered"}),o.jsx("option",{value:"covered",children:"Covered"})]})]}),o.jsxs("label",{children:["Face State",o.jsxs("select",{value:l.faceState,onChange:v=>n({...a,targetFilter:{...l,faceState:v.target.value}}),children:[o.jsx("option",{value:"any",children:"Any"}),o.jsx("option",{value:"face_up",children:"Face-up"}),o.jsx("option",{value:"face_down",children:"Face-down"})]})]}),o.jsxs("label",{children:["Owner",o.jsxs("select",{value:l.owner||"any",onChange:v=>{const _=v.target.value,w={...l};_==="any"?delete w.owner:w.owner=_,n({...a,targetFilter:w})},children:[o.jsx("option",{value:"any",children:"Any (own or opponent)"}),o.jsx("option",{value:"own",children:"Own cards only"}),o.jsx("option",{value:"opponent",children:"Opponent's cards only"})]})]}),o.jsxs("label",{children:["Calculation",o.jsxs("select",{value:l.calculation||"none",onChange:v=>{const _=v.target.value,w={...l};_==="none"?delete w.calculation:w.calculation=_,n({...a,targetFilter:w})},children:[o.jsx("option",{value:"none",children:"None"}),o.jsx("option",{value:"highest_value",children:"Highest value"}),o.jsx("option",{value:"lowest_value",children:"Lowest value"})]})]}),o.jsxs("label",{children:["Value Range (specific values to target)",o.jsxs("select",{value:l.valueRange?`${l.valueRange.min}-${l.valueRange.max}`:"none",onChange:v=>{const _=v.target.value,w={...l};_==="none"?delete w.valueRange:_==="0-1"?w.valueRange={min:0,max:1}:_==="1-2"?w.valueRange={min:1,max:2}:_==="0-0"&&(w.valueRange={min:0,max:0}),n({...a,targetFilter:w})},children:[o.jsx("option",{value:"none",children:"Any value"}),o.jsx("option",{value:"0-0",children:"Value 0 only"}),o.jsx("option",{value:"0-1",children:"Values 0 or 1"}),o.jsx("option",{value:"1-2",children:"Values 1 or 2"})]})]}),o.jsx("h5",{children:"Scope"}),o.jsxs("label",{children:["Lane Scope",o.jsxs("select",{value:((c=a.scope)==null?void 0:c.type)||"any",onChange:v=>{const _=v.target.value;if(_==="any"){const{scope:w,...b}=a;n(b)}else n({...a,scope:{type:_}})},children:[o.jsx("option",{value:"any",children:"Any lane"}),o.jsx("option",{value:"this_line",children:"This line only"}),o.jsx("option",{value:"other_lanes",children:"Other lanes"}),o.jsx("option",{value:"each_other_line",children:"Each other line (1 per line)"}),o.jsx("option",{value:"each_lane",children:"Each lane (flexible, 1 per line)"})]})]}),(((i=a.scope)==null?void 0:i.type)==="other_lanes"||((d=a.scope)==null?void 0:d.type)==="any")&&o.jsxs("label",{children:["Minimum Cards in Lane",o.jsxs("select",{value:((u=a.scope)==null?void 0:u.minCardsInLane)||0,onChange:v=>{const _=parseInt(v.target.value);if(_===0){const w={...a.scope};delete w.minCardsInLane,n({...a,scope:w})}else n({...a,scope:{...a.scope,minCardsInLane:_}})},children:[o.jsx("option",{value:0,children:"No minimum"}),o.jsx("option",{value:8,children:"8 or more cards (Metal-3)"}),o.jsx("option",{value:6,children:"6 or more cards"}),o.jsx("option",{value:4,children:"4 or more cards"})]}),((h=a.scope)==null?void 0:h.minCardsInLane)&&o.jsxs("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:["Only delete from lanes with ",a.scope.minCardsInLane,"+ cards total."]})]}),o.jsxs("label",{children:["Who Chooses Target?",o.jsxs("select",{value:a.actorChooses||"effect_owner",onChange:v=>{const _=v.target.value;if(_==="effect_owner"){const{actorChooses:w,...b}=a;n(b)}else n({...a,actorChooses:_})},children:[o.jsx("option",{value:"effect_owner",children:"Effect owner chooses (default)"}),o.jsx("option",{value:"card_owner",children:"Card owner chooses (Plague-4: opponent deletes their own)"})]}),a.actorChooses==="card_owner"&&o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"The owner of the targeted card chooses which card to delete."})]}),o.jsx("h5",{children:"Advanced Conditional"}),o.jsxs("label",{children:["Conditional Type",o.jsxs("select",{value:((f=a.advancedConditional)==null?void 0:f.type)||"none",onChange:v=>{if(v.target.value==="none"){const{advancedConditional:_,...w}=a;n(w)}else n({...a,advancedConditional:{type:v.target.value}})},children:[o.jsx("option",{value:"none",children:"None"}),o.jsx("option",{value:"empty_hand",children:"Only if hand is empty"}),o.jsx("option",{value:"opponent_higher_value_in_lane",children:"Only if opponent has higher value in this lane"})]})]}),o.jsx("h5",{children:"Lane Restriction"}),o.jsxs("label",{children:["Lane Condition",o.jsxs("select",{value:((m=a.laneCondition)==null?void 0:m.type)||"none",onChange:v=>{const _=v.target.value;if(_==="none"){const{laneCondition:w,selectLane:b,...N}=a;n(N)}else n({...a,laneCondition:{type:_},selectLane:!0})},children:[o.jsx("option",{value:"none",children:"None (any lane)"}),o.jsx("option",{value:"opponent_higher_value",children:"Only lanes where opponent has higher value"})]}),((y=a.laneCondition)==null?void 0:y.type)==="opponent_higher_value"&&o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"Can only delete cards in lanes where opponent's total value is higher than yours. Player selects lane first, then card."})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a.selectLane||!1,onChange:v=>n({...a,selectLane:v.target.checked})}),"Select lane first (player chooses lane, then card)",o.jsx("small",{style:{display:"block",marginLeft:"24px",color:"#8A79E8"},children:"Enable if player should pick a lane before selecting a card."})]})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const ng=({params:a,onChange:n})=>{const l=a.countType||"fixed",c=a.variableCount,i=l==="equal_to_discarded";return o.jsxs("div",{className:"param-editor",children:[o.jsx("h4",{children:"Discard Effect"}),o.jsxs("label",{children:["Count Type",o.jsxs("select",{value:l,onChange:d=>n({...a,countType:d.target.value}),children:[o.jsx("option",{value:"fixed",children:"Fixed Count"}),o.jsx("option",{value:"equal_to_discarded",children:"Equal to Previously Discarded (Plague-2)"})]})]}),l==="fixed"&&o.jsxs("label",{children:["Count",o.jsxs("select",{value:c?"variable":a.count.toString(),onChange:d=>{const u=d.target.value;if(u==="variable")n({...a,variableCount:!0,count:1});else if(u==="all"){const{variableCount:h,...f}=a;n({...f,count:"all"})}else{const{variableCount:h,...f}=a;n({...f,count:parseInt(u)})}},children:[o.jsx("option",{value:"1",children:"1 card"}),o.jsx("option",{value:"2",children:"2 cards"}),o.jsx("option",{value:"3",children:"3 cards"}),o.jsx("option",{value:"all",children:"All cards (entire hand)"}),o.jsx("option",{value:"variable",children:"1 or more cards (variable)"})]})]}),i&&o.jsxs("label",{children:["Offset (add to count)",o.jsx("input",{type:"number",value:a.countOffset||0,onChange:d=>n({...a,countOffset:parseInt(d.target.value)}),min:"-5",max:"5"})]}),o.jsxs("label",{children:["Actor",o.jsxs("select",{value:a.actor,onChange:d=>n({...a,actor:d.target.value}),children:[o.jsx("option",{value:"self",children:"Self"}),o.jsx("option",{value:"opponent",children:"Opponent"})]})]}),a.actor==="opponent"&&o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a.random||!1,onChange:d=>n({...a,random:d.target.checked})}),"Random selection (opponent can't choose which card)",o.jsx("small",{style:{display:"block",marginLeft:"24px",marginTop:"4px",color:"#8A79E8"},children:"A random card is discarded instead of opponent choosing."})]})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const ag=({params:a,onChange:n})=>{var u,h,f,m;const l=((u=a.targetFilter)==null?void 0:u.owner)||"any",c=((h=a.targetFilter)==null?void 0:h.position)||"uncovered",i=(f=a.targetFilter)==null?void 0:f.valueEquals,d=a.selectLane||!1;return o.jsxs("div",{className:"param-editor",children:[o.jsx("h4",{children:"Return Effect"}),o.jsxs("label",{children:["Count",o.jsxs("select",{value:typeof a.count=="number"?a.count.toString():"all",onChange:y=>n({...a,count:y.target.value==="all"?"all":parseInt(y.target.value)}),children:[o.jsx("option",{value:"1",children:"1"}),o.jsx("option",{value:"2",children:"2"}),o.jsx("option",{value:"all",children:"All"})]})]}),o.jsxs("label",{children:["Whose cards?",o.jsxs("select",{value:l,onChange:y=>n({...a,targetFilter:{...a.targetFilter,owner:y.target.value}}),children:[o.jsx("option",{value:"any",children:"Any card (own or opponent)"}),o.jsx("option",{value:"own",children:"Only own cards"}),o.jsx("option",{value:"opponent",children:"Only opponent cards"})]})]}),o.jsxs("label",{children:["Position",o.jsxs("select",{value:c,onChange:y=>n({...a,targetFilter:{...a.targetFilter,position:y.target.value}}),children:[o.jsx("option",{value:"uncovered",children:"Uncovered (default)"}),o.jsx("option",{value:"covered",children:"Covered"}),o.jsx("option",{value:"any",children:"Any (covered or uncovered)"})]})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:d,onChange:y=>{if(y.target.checked)n({...a,selectLane:!0});else{const{selectLane:v,..._}=a;n(_)}}}),'Select lane first (Water-3: "in 1 line")']}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:i!==void 0,onChange:y=>{if(y.target.checked)n({...a,targetFilter:{...a.targetFilter,valueEquals:2}});else{const{valueEquals:v,..._}=a.targetFilter||{};n({...a,targetFilter:_})}}}),"Filter by value"]}),i!==void 0&&o.jsxs("label",{children:["Value to return",o.jsx("input",{type:"number",min:0,max:6,value:i,onChange:y=>n({...a,targetFilter:{...a.targetFilter,valueEquals:parseInt(y.target.value)||0}})})]}),o.jsx("h5",{children:"Advanced Conditional"}),o.jsxs("label",{children:["Conditional Type",o.jsxs("select",{value:((m=a.advancedConditional)==null?void 0:m.type)||"none",onChange:y=>{if(y.target.value==="none"){const{advancedConditional:v,..._}=a;n(_)}else n({...a,advancedConditional:{type:y.target.value}})},children:[o.jsx("option",{value:"none",children:"None"}),o.jsx("option",{value:"empty_hand",children:"Only if hand is empty"}),o.jsx("option",{value:"opponent_higher_value_in_lane",children:"Only if opponent has higher value in this lane"})]})]})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const og=({params:a,onChange:n})=>{var c,i,d,u;const l=a.destinationRule||{type:"other_lines"};return o.jsxs("div",{className:"param-editor",children:[o.jsx("h4",{children:"Play Effect"}),o.jsxs("label",{children:["Actor (who plays)",o.jsxs("select",{value:a.actor||"self",onChange:h=>{if(h.target.value==="self"){const{actor:f,...m}=a;n(m)}else n({...a,actor:h.target.value})},children:[o.jsx("option",{value:"self",children:"You"}),o.jsx("option",{value:"opponent",children:"Opponent"})]})]}),o.jsxs("label",{children:["Source",o.jsxs("select",{value:a.source,onChange:h=>n({...a,source:h.target.value}),children:[o.jsx("option",{value:"hand",children:"Hand"}),o.jsx("option",{value:"deck",children:"Deck"})]})]}),o.jsxs("label",{children:["Anzahl",o.jsx("input",{type:"number",min:1,max:6,value:a.count,onChange:h=>n({...a,count:parseInt(h.target.value)||1})})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a.faceDown,onChange:h=>n({...a,faceDown:h.target.checked})}),"Face-down"]}),o.jsxs("label",{children:["Destination",o.jsxs("select",{value:l.type,onChange:h=>n({...a,destinationRule:{...l,type:h.target.value}}),children:[o.jsx("option",{value:"other_lines",children:"Other lines (choose 1)"}),o.jsx("option",{value:"each_other_line",children:"Each other line (1 per line)"}),o.jsx("option",{value:"specific_lane",children:"Specific lane (this line)"}),o.jsx("option",{value:"each_line_with_card",children:"Each line with card"}),o.jsx("option",{value:"line_with_matching_cards",children:"Line with matching cards (choose 1)"}),o.jsx("option",{value:"under_this_card",children:"Under this card"})]})]}),(l.type==="each_line_with_card"||l.type==="line_with_matching_cards")&&o.jsxs("label",{children:["Card Filter (which cards must be in line)",o.jsxs("select",{value:((c=l.cardFilter)==null?void 0:c.faceState)||"any",onChange:h=>{const f=h.target.value;if(f==="any"){const{cardFilter:m,...y}=l;n({...a,destinationRule:y})}else n({...a,destinationRule:{...l,cardFilter:{faceState:f}}})},children:[o.jsx("option",{value:"any",children:"Any card"}),o.jsx("option",{value:"face_down",children:"Face-down cards only"}),o.jsx("option",{value:"face_up",children:"Face-up cards only"})]})]}),o.jsxs("label",{children:["Condition",o.jsxs("select",{value:((i=a.condition)==null?void 0:i.type)||"none",onChange:h=>{const f=h.target.value;if(f==="none"){const{condition:m,...y}=a;n(y)}else n(f==="per_x_cards_in_line"?{...a,condition:{type:f,cardCount:2}}:{...a,condition:{type:f}})},children:[o.jsx("option",{value:"none",children:"None (always play)"}),o.jsx("option",{value:"per_x_cards_in_line",children:"For every X cards in this line"}),o.jsx("option",{value:"only_in_lines_with_cards",children:"Only in lines where you have a card"})]})]}),((d=a.condition)==null?void 0:d.type)==="per_x_cards_in_line"&&o.jsxs("label",{children:["Cards per play (X)",o.jsx("input",{type:"number",min:1,max:6,value:a.condition.cardCount||2,onChange:h=>n({...a,condition:{...a.condition,cardCount:parseInt(h.target.value)||2}})}),o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:'Example: "For every 2 cards in this line, play..."  X = 2'})]}),o.jsx("h5",{children:"Advanced Conditional"}),o.jsxs("label",{children:["Conditional Type",o.jsxs("select",{value:((u=a.advancedConditional)==null?void 0:u.type)||"none",onChange:h=>{if(h.target.value==="none"){const{advancedConditional:f,...m}=a;n(m)}else n({...a,advancedConditional:{type:h.target.value}})},children:[o.jsx("option",{value:"none",children:"None"}),o.jsx("option",{value:"empty_hand",children:"Only if hand is empty"}),o.jsx("option",{value:"opponent_higher_value_in_lane",children:"Only if opponent has higher value in this lane"})]})]})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const rg=({params:a,onChange:n})=>o.jsxs("div",{className:"param-editor",children:[o.jsx("h4",{children:"Protocol Effect"}),o.jsxs("label",{children:["Action",o.jsxs("select",{value:a.action,onChange:l=>n({...a,action:l.target.value}),children:[o.jsx("option",{value:"rearrange_protocols",children:"Rearrange"}),o.jsx("option",{value:"swap_protocols",children:"Swap"})]})]}),o.jsxs("label",{children:["Target",o.jsxs("select",{value:a.target,onChange:l=>n({...a,target:l.target.value}),children:[o.jsx("option",{value:"own",children:"Own"}),o.jsx("option",{value:"opponent",children:"Opponent"}),o.jsx("option",{value:"both_sequential",children:"Beide (nacheinander)"})]})]}),o.jsx("h5",{children:"Restriction (Anarchy-3)"}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:!!a.restriction,onChange:l=>{if(l.target.checked)n({...a,restriction:{disallowedProtocol:"",laneIndex:"current"}});else{const{restriction:c,...i}=a;n(i)}}}),"Add restriction (protocol cannot be on specific lane)"]}),a.restriction&&o.jsxs(o.Fragment,{children:[o.jsxs("label",{children:["Disallowed Protocol",o.jsx("input",{type:"text",value:a.restriction.disallowedProtocol,onChange:l=>n({...a,restriction:{...a.restriction,disallowedProtocol:l.target.value}}),placeholder:"e.g., Anarchy, Fire, Death"})]}),o.jsxs("label",{children:["Lane",o.jsxs("select",{value:a.restriction.laneIndex,onChange:l=>n({...a,restriction:{...a.restriction,laneIndex:l.target.value==="current"?"current":parseInt(l.target.value)}}),children:[o.jsx("option",{value:"current",children:"Current lane (where this card is)"}),o.jsx("option",{value:"0",children:"Lane 1 (Left)"}),o.jsx("option",{value:"1",children:"Lane 2 (Middle)"}),o.jsx("option",{value:"2",children:"Lane 3 (Right)"})]})]})]})]});/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const lg=({params:a,onChange:n})=>o.jsxs("div",{className:"param-editor",children:[o.jsx("h4",{children:"Reveal/Give Effect"}),o.jsxs("label",{children:["Action",o.jsxs("select",{value:a.action,onChange:l=>n({...a,action:l.target.value}),children:[o.jsx("option",{value:"reveal",children:"Reveal"}),o.jsx("option",{value:"give",children:"Give"})]})]}),o.jsxs("label",{children:["Source",o.jsxs("select",{value:a.source,onChange:l=>n({...a,source:l.target.value}),children:[o.jsx("option",{value:"own_hand",children:"Your hand"}),o.jsx("option",{value:"opponent_hand",children:"Opponent's hand"}),o.jsx("option",{value:"own_deck_top",children:"Top of your deck"}),o.jsx("option",{value:"own_deck",children:"Your entire deck"}),o.jsx("option",{value:"board",children:"Board card"})]})]}),(a.source==="own_hand"||a.source==="opponent_hand"||a.source==="board")&&o.jsxs("label",{children:["Anzahl",o.jsx("input",{type:"number",min:1,max:6,value:a.count,onChange:l=>n({...a,count:parseInt(l.target.value)||1})})]}),a.source==="board"&&o.jsxs("label",{children:["Follow-up action",o.jsxs("select",{value:a.followUpAction||"none",onChange:l=>{if(l.target.value==="none"){const{followUpAction:c,...i}=a;n(i)}else n({...a,followUpAction:l.target.value})},children:[o.jsx("option",{value:"none",children:"None"}),o.jsx("option",{value:"flip",children:"Then flip"}),o.jsx("option",{value:"shift",children:"Then shift"})]})]})]});/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const sg=({params:a,onChange:n})=>o.jsxs("div",{className:"param-editor take-effect-editor",children:[o.jsx("h4",{children:"Take Effect Parameters"}),o.jsxs("label",{children:["Card Count",o.jsx("input",{type:"number",min:1,max:6,value:a.count,onChange:l=>n({...a,count:parseInt(l.target.value)||1})})]}),o.jsxs("label",{children:["Source",o.jsx("select",{value:a.source,onChange:l=>n({...a,source:l.target.value}),children:o.jsx("option",{value:"opponent_hand",children:"Opponent's Hand"})})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a.random,onChange:l=>n({...a,random:l.target.checked})}),"Random (if unchecked, you choose)"]})]}),ic=a=>{switch(a){case"draw":return{action:"draw",count:1,target:"self",source:"own_deck"};case"flip":return{action:"flip",count:1,targetFilter:{owner:"any",position:"any",faceState:"any",excludeSelf:!1},optional:!1};case"shift":return{action:"shift",targetFilter:{owner:"any",position:"any",faceState:"any"},destinationRestriction:{type:"any"}};case"delete":return{action:"delete",count:1,targetFilter:{position:"any",faceState:"any"},scope:{type:"anywhere"},excludeSelf:!1};case"discard":return{action:"discard",count:1,actor:"self"};case"return":return{action:"return",count:1,targetFilter:{},scope:{type:"any_card"}};case"play":return{action:"play",source:"hand",count:1,faceDown:!1,destinationRule:{type:"other_lines"}};case"rearrange_protocols":return{action:"rearrange_protocols",target:"own"};case"swap_protocols":return{action:"swap_protocols",target:"own"};case"reveal":case"give":return{action:a,source:"own_hand",count:1};case"take":return{action:"take",source:"opponent_hand",count:1,random:!0};default:return{}}},fb=({params:a,onChange:n})=>{const[l,c]=re.useState(""),[i,d]=re.useState(""),[u,h]=re.useState(null),f=a.options||[],m=f[0],y=f[1],v=()=>{if(!l)return;const R={id:Xe(),params:ic(l),position:"middle",trigger:"on_play"};n({...a,options:[R,y].filter(Boolean)}),c(""),h(1)},_=()=>{if(!i)return;const R={id:Xe(),params:ic(i),position:"middle",trigger:"on_play"};n({...a,options:[m,R].filter(Boolean)}),d(""),h(2)},w=()=>{n({...a,options:[y].filter(Boolean)}),u===1&&h(null)},b=()=>{n({...a,options:[m].filter(Boolean)}),u===2&&h(null)},N=R=>{const F={...m,params:R};n({...a,options:[F,y].filter(Boolean)})},S=R=>{const F={...y,params:R};n({...a,options:[m,F].filter(Boolean)})},k=R=>{const F=ic(R),L={...m,params:F};n({...a,options:[L,y].filter(Boolean)})},C=R=>{const F=ic(R),L={...y,params:F};n({...a,options:[m,L].filter(Boolean)})},j=(R,F)=>{switch(R.params.action){case"draw":return o.jsx(Ky,{params:R.params,onChange:F});case"flip":return o.jsx(Jy,{params:R.params,onChange:F});case"shift":return o.jsx(eg,{params:R.params,onChange:F});case"delete":return o.jsx(tg,{params:R.params,onChange:F});case"discard":return o.jsx(ng,{params:R.params,onChange:F});case"return":return o.jsx(ag,{params:R.params,onChange:F});case"play":return o.jsx(og,{params:R.params,onChange:F});case"rearrange_protocols":case"swap_protocols":return o.jsx(rg,{params:R.params,onChange:F});case"reveal":case"give":return o.jsx(lg,{params:R.params,onChange:F});case"take":return o.jsx(sg,{params:R.params,onChange:F});default:return o.jsx("div",{children:"Unknown effect type"})}};return o.jsxs("div",{style:{padding:"10px",backgroundColor:"#2c1d63",borderRadius:"4px",border:"1px solid rgba(97, 239, 255, 0.3)"},children:[o.jsx("h4",{style:{color:"#61EFFF",marginTop:0},children:"Either/Or Choice"}),o.jsx("p",{style:{color:"#F0F0F0",fontSize:"14px",marginBottom:"15px"},children:'Player chooses one of two options. Example: "Either discard 1 card or flip this card"'}),o.jsxs("div",{style:{marginBottom:"15px",padding:"10px",backgroundColor:"rgba(97, 239, 255, 0.05)",borderRadius:"4px"},children:[o.jsx("label",{style:{color:"#61EFFF",display:"block",marginBottom:"10px",fontWeight:"bold"},children:"Option 1:"}),m?o.jsxs(o.Fragment,{children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"10px"},children:[o.jsxs("select",{value:m.params.action,onChange:R=>k(R.target.value),style:{flex:1,padding:"8px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px"},children:[o.jsx("option",{value:"draw",children:"Draw Cards"}),o.jsx("option",{value:"flip",children:"Flip Cards"}),o.jsx("option",{value:"shift",children:"Shift Card"}),o.jsx("option",{value:"delete",children:"Delete Cards"}),o.jsx("option",{value:"discard",children:"Discard Cards"}),o.jsx("option",{value:"return",children:"Return to Hand"}),o.jsx("option",{value:"play",children:"Play from Hand/Deck"})]}),o.jsx("button",{onClick:()=>h(u===1?null:1),style:{padding:"8px 15px",backgroundColor:u===1?"#8B0000":"#61EFFF",color:u===1?"#F0F0F0":"#0A051A",border:"none",borderRadius:"4px",cursor:"pointer",fontWeight:"bold"},children:u===1?"Hide":"Edit"}),o.jsx("button",{onClick:w,style:{padding:"8px 15px",backgroundColor:"#8B0000",color:"#F0F0F0",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Remove"})]}),u===1&&o.jsx("div",{style:{marginTop:"10px"},children:j(m,N)})]}):o.jsxs("div",{style:{display:"flex",gap:"10px"},children:[o.jsxs("select",{value:l,onChange:R=>c(R.target.value),style:{flex:1,padding:"8px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px"},children:[o.jsx("option",{value:"",children:"Choose Action"}),o.jsx("option",{value:"draw",children:"Draw Cards"}),o.jsx("option",{value:"flip",children:"Flip Cards"}),o.jsx("option",{value:"shift",children:"Shift Card"}),o.jsx("option",{value:"delete",children:"Delete Cards"}),o.jsx("option",{value:"discard",children:"Discard Cards"}),o.jsx("option",{value:"return",children:"Return to Hand"}),o.jsx("option",{value:"play",children:"Play from Hand/Deck"})]}),o.jsx("button",{onClick:v,disabled:!l,style:{padding:"8px 15px",backgroundColor:l?"#61EFFF":"#444",color:"#0A051A",border:"none",borderRadius:"4px",cursor:l?"pointer":"not-allowed",fontWeight:"bold"},children:"Add"})]})]}),o.jsxs("div",{style:{padding:"10px",backgroundColor:"rgba(97, 239, 255, 0.05)",borderRadius:"4px"},children:[o.jsx("label",{style:{color:"#61EFFF",display:"block",marginBottom:"10px",fontWeight:"bold"},children:"Option 2:"}),y?o.jsxs(o.Fragment,{children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"10px"},children:[o.jsxs("select",{value:y.params.action,onChange:R=>C(R.target.value),style:{flex:1,padding:"8px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px"},children:[o.jsx("option",{value:"draw",children:"Draw Cards"}),o.jsx("option",{value:"flip",children:"Flip Cards"}),o.jsx("option",{value:"shift",children:"Shift Card"}),o.jsx("option",{value:"delete",children:"Delete Cards"}),o.jsx("option",{value:"discard",children:"Discard Cards"}),o.jsx("option",{value:"return",children:"Return to Hand"}),o.jsx("option",{value:"play",children:"Play from Hand/Deck"})]}),o.jsx("button",{onClick:()=>h(u===2?null:2),style:{padding:"8px 15px",backgroundColor:u===2?"#8B0000":"#61EFFF",color:u===2?"#F0F0F0":"#0A051A",border:"none",borderRadius:"4px",cursor:"pointer",fontWeight:"bold"},children:u===2?"Hide":"Edit"}),o.jsx("button",{onClick:b,style:{padding:"8px 15px",backgroundColor:"#8B0000",color:"#F0F0F0",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Remove"})]}),u===2&&o.jsx("div",{style:{marginTop:"10px"},children:j(y,S)})]}):o.jsxs("div",{style:{display:"flex",gap:"10px"},children:[o.jsxs("select",{value:i,onChange:R=>d(R.target.value),style:{flex:1,padding:"8px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px"},children:[o.jsx("option",{value:"",children:"Choose Action"}),o.jsx("option",{value:"draw",children:"Draw Cards"}),o.jsx("option",{value:"flip",children:"Flip Cards"}),o.jsx("option",{value:"shift",children:"Shift Card"}),o.jsx("option",{value:"delete",children:"Delete Cards"}),o.jsx("option",{value:"discard",children:"Discard Cards"}),o.jsx("option",{value:"return",children:"Return to Hand"}),o.jsx("option",{value:"play",children:"Play from Hand/Deck"})]}),o.jsx("button",{onClick:_,disabled:!i,style:{padding:"8px 15px",backgroundColor:i?"#61EFFF":"#444",color:"#0A051A",border:"none",borderRadius:"4px",cursor:i?"pointer":"not-allowed",fontWeight:"bold"},children:"Add"})]})]}),f.length===2&&o.jsx("div",{style:{marginTop:"15px",padding:"10px",backgroundColor:"rgba(97, 239, 255, 0.1)",borderRadius:"4px"},children:o.jsx("p",{style:{color:"#61EFFF",fontSize:"14px",margin:0},children:" Both options configured. Player will choose one during gameplay."})})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const pb=({params:a,onChange:n})=>{var f,m,y,v,_,w;const l=((f=a.rule)==null?void 0:f.type)||"block_all_play",c=((m=a.rule)==null?void 0:m.target)||"opponent",i=((y=a.rule)==null?void 0:y.scope)||"this_lane",d=((v=a.rule)==null?void 0:v.onlyDuringYourTurn)||!1,u=((_=a.rule)==null?void 0:_.conditionTarget)||"self",h=((w=a.rule)==null?void 0:w.blockTarget)||"self";return o.jsxs("div",{className:"param-editor passive-rule-editor",children:[o.jsx("h4",{children:"Passive Rule Parameters"}),o.jsx("p",{style:{color:"#8A79E8",fontSize:"14px",marginBottom:"15px"},children:"This rule is active while the card is face-up. It modifies game behavior."}),o.jsxs("label",{children:["Rule Type",o.jsxs("select",{value:l,onChange:b=>n({...a,rule:{...a.rule,type:b.target.value,target:c,scope:i}}),children:[o.jsxs("optgroup",{label:"Play Restrictions",children:[o.jsx("option",{value:"block_face_down_play",children:"Block Face-Down Plays (Metal-2)"}),o.jsx("option",{value:"block_face_up_play",children:"Block Face-Up Plays"}),o.jsx("option",{value:"block_all_play",children:"Block All Plays (Plague-0)"}),o.jsx("option",{value:"require_face_down_play",children:"Require Face-Down Plays (Psychic-1)"})]}),o.jsxs("optgroup",{label:"Protocol Matching",children:[o.jsx("option",{value:"allow_any_protocol_play",children:"Allow Any Protocol (Spirit-1, Chaos-3)"}),o.jsx("option",{value:"allow_play_on_opponent_side",children:"Allow Play on Opponent Side (Corruption-0)"}),o.jsx("option",{value:"require_non_matching_protocol",children:"Require Non-Matching (Anarchy-1)"})]}),o.jsxs("optgroup",{label:"Action Blocks",children:[o.jsx("option",{value:"block_flips",children:"Block Flips (Frost-1)"}),o.jsx("option",{value:"block_protocol_rearrange",children:"Block Protocol Rearrange (Frost-1)"}),o.jsx("option",{value:"block_shifts_from_lane",children:"Block Shifts From Lane (Frost-3)"}),o.jsx("option",{value:"block_shifts_to_lane",children:"Block Shifts To Lane (Frost-3)"}),o.jsx("option",{value:"block_flip_this_card",children:"This Card Cannot Be Flipped"})]}),o.jsx("optgroup",{label:"Draw Restrictions",children:o.jsx("option",{value:"block_draw_conditional",children:"Conditional Draw Block"})}),o.jsx("optgroup",{label:"Effect Modifications",children:o.jsx("option",{value:"ignore_middle_commands",children:"Ignore Middle Commands (Apathy-2)"})}),o.jsx("optgroup",{label:"Phase Modifications",children:o.jsx("option",{value:"skip_check_cache_phase",children:"Skip Check Cache Phase (Spirit-0)"})})]})]}),o.jsxs("label",{children:["Affected Player",o.jsxs("select",{value:c,onChange:b=>n({...a,rule:{...a.rule,type:l,target:b.target.value,scope:i}}),children:[o.jsx("option",{value:"self",children:"Self (You)"}),o.jsx("option",{value:"opponent",children:"Opponent"}),o.jsx("option",{value:"all",children:"All Players"})]})]}),o.jsxs("label",{children:["Scope",o.jsxs("select",{value:i,onChange:b=>n({...a,rule:{...a.rule,type:l,target:c,scope:b.target.value,onlyDuringYourTurn:d}}),children:[o.jsx("option",{value:"this_lane",children:"This Lane Only"}),o.jsx("option",{value:"global",children:"Global (All Lanes)"})]})]}),l==="ignore_middle_commands"&&o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:d,onChange:b=>n({...a,rule:{...a.rule,type:l,target:c,scope:i,onlyDuringYourTurn:b.target.checked}})}),"Only during your turn",o.jsx("small",{style:{display:"block",marginLeft:"24px",marginTop:"4px",color:"#8A79E8"},children:"Effect only applies during card owner's turn, not during opponent's turn."})]}),l==="block_draw_conditional"&&o.jsxs(o.Fragment,{children:[o.jsxs("label",{children:["Condition (who must have cards in hand)",o.jsxs("select",{value:u,onChange:b=>n({...a,rule:{...a.rule,type:l,target:"this_card",scope:"global",conditionTarget:b.target.value,blockTarget:h}}),children:[o.jsx("option",{value:"self",children:"Card owner (you)"}),o.jsx("option",{value:"opponent",children:"Opponent of card owner"})]}),o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"If this player has any cards in hand, the draw block activates."})]}),o.jsxs("label",{children:["Block target (who cannot draw)",o.jsxs("select",{value:h,onChange:b=>n({...a,rule:{...a.rule,type:l,target:"this_card",scope:"global",conditionTarget:u,blockTarget:b.target.value}}),children:[o.jsx("option",{value:"self",children:"Card owner (you)"}),o.jsx("option",{value:"opponent",children:"Opponent of card owner"}),o.jsx("option",{value:"all",children:"Both players"})]}),o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"This player cannot draw cards when the condition is met."})]})]}),l==="block_flip_this_card"&&o.jsx("small",{style:{display:"block",marginTop:"8px",color:"#8A79E8"},children:"This card cannot be flipped by any effect. Only affects this specific card."})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const hb=({params:a,onChange:n})=>{var v,_,w,b,N,S,k,C,j;const l=((v=a.modifier)==null?void 0:v.type)||"add_per_condition",c=((_=a.modifier)==null?void 0:_.value)||1,i=((w=a.modifier)==null?void 0:w.condition)||"per_face_down_card",d=((b=a.modifier)==null?void 0:b.target)||"own_total",u=((N=a.modifier)==null?void 0:N.scope)||"this_lane",h=((k=(S=a.modifier)==null?void 0:S.filter)==null?void 0:k.faceState)||"face_down",f=((j=(C=a.modifier)==null?void 0:C.filter)==null?void 0:j.position)||"any",m=l==="add_per_condition",y=l==="set_to_fixed"&&(d==="own_cards"||d==="opponent_cards"||d==="all_cards");return o.jsxs("div",{className:"param-editor value-modifier-editor",children:[o.jsx("h4",{children:"Value Modifier Parameters"}),o.jsx("p",{style:{color:"#8A79E8",fontSize:"14px",marginBottom:"15px"},children:"This modifier is active while the card is face-up. It modifies card values or lane totals."}),o.jsxs("label",{children:["Modifier Type",o.jsxs("select",{value:l,onChange:R=>n({...a,modifier:{...a.modifier,type:R.target.value,value:c,condition:m?i:void 0,target:d,scope:u,filter:y?{faceState:h,position:f}:void 0}}),children:[o.jsx("option",{value:"add_per_condition",children:"Add Per Condition (Apathy-0: +1 per face-down)"}),o.jsx("option",{value:"set_to_fixed",children:"Set Cards To Fixed Value (Darkness-2: face-down = 4)"}),o.jsx("option",{value:"add_to_total",children:"Add To Lane Total (Metal-0: opponent total -2)"})]})]}),o.jsxs("label",{children:["Value",o.jsx("input",{type:"number",value:c,onChange:R=>n({...a,modifier:{...a.modifier,type:l,value:parseInt(R.target.value)||0,condition:m?i:void 0,target:d,scope:u,filter:y?{faceState:h,position:f}:void 0}}),style:{width:"100%",padding:"8px",marginTop:"5px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px"}}),o.jsxs("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:[l==="add_per_condition"&&"Value to add per condition (e.g., +1)",l==="set_to_fixed"&&"Fixed value to set cards to (e.g., 4)",l==="add_to_total"&&"Value to add to total (use negative for subtraction, e.g., -2)"]})]}),m&&o.jsxs("label",{children:["Condition",o.jsxs("select",{value:i,onChange:R=>n({...a,modifier:{...a.modifier,type:l,value:c,condition:R.target.value,target:d,scope:u,filter:y?{faceState:h,position:f}:void 0}}),children:[o.jsx("option",{value:"per_face_down_card",children:"Per Face-Down Card"}),o.jsx("option",{value:"per_face_up_card",children:"Per Face-Up Card"}),o.jsx("option",{value:"per_card",children:"Per Card (any)"}),o.jsx("option",{value:"per_card_in_hand",children:"Per Card in Your Hand"})]})]}),o.jsxs("label",{children:["Target",o.jsxs("select",{value:d,onChange:R=>n({...a,modifier:{...a.modifier,type:l,value:c,condition:m?i:void 0,target:R.target.value,scope:u,filter:y?{faceState:h,position:f}:void 0}}),children:[o.jsxs("optgroup",{label:"Card Values",children:[o.jsx("option",{value:"own_cards",children:"Own Cards"}),o.jsx("option",{value:"opponent_cards",children:"Opponent Cards"}),o.jsx("option",{value:"all_cards",children:"All Cards"})]}),o.jsxs("optgroup",{label:"Lane Totals",children:[o.jsx("option",{value:"own_total",children:"Own Total"}),o.jsx("option",{value:"opponent_total",children:"Opponent Total"})]})]})]}),y&&o.jsxs(o.Fragment,{children:[o.jsxs("label",{children:["Card Face State (Filter)",o.jsxs("select",{value:h,onChange:R=>n({...a,modifier:{...a.modifier,type:l,value:c,condition:m?i:void 0,target:d,scope:u,filter:{faceState:R.target.value,position:f}}}),children:[o.jsx("option",{value:"face_down",children:"Face-Down Only"}),o.jsx("option",{value:"face_up",children:"Face-Up Only"}),o.jsx("option",{value:"any",children:"Any"})]})]}),o.jsxs("label",{children:["Card Position (Filter)",o.jsxs("select",{value:f,onChange:R=>n({...a,modifier:{...a.modifier,type:l,value:c,condition:m?i:void 0,target:d,scope:u,filter:{faceState:h,position:R.target.value}}}),children:[o.jsx("option",{value:"any",children:"Any Position"}),o.jsx("option",{value:"covered",children:"Covered Only"}),o.jsx("option",{value:"uncovered",children:"Uncovered Only"})]})]})]}),o.jsxs("label",{children:["Scope",o.jsxs("select",{value:u,onChange:R=>n({...a,modifier:{...a.modifier,type:l,value:c,condition:m?i:void 0,target:d,scope:R.target.value,filter:y?{faceState:h,position:f}:void 0}}),children:[o.jsx("option",{value:"this_lane",children:"This Lane Only"}),o.jsx("option",{value:"global",children:"Global (All Lanes)"})]})]})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const mb=({params:a,onChange:n})=>o.jsxs("div",{className:"param-editor block-compile-effect-editor",children:[o.jsx("h4",{children:"Block Compile Effect Parameters"}),o.jsxs("label",{children:["Target",o.jsxs("select",{value:a.target||"opponent",onChange:l=>n({...a,target:l.target.value}),children:[o.jsx("option",{value:"opponent",children:"Opponent cannot compile next turn"}),o.jsx("option",{value:"self",children:"You cannot compile next turn"})]})]})]});/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const yb=({params:a,onChange:n})=>{var c;const l=((c=a.laneCondition)==null?void 0:c.count)||8;return o.jsxs("div",{className:"param-editor delete-all-in-lane-effect-editor",children:[o.jsx("h4",{children:"Delete All In Lane Effect Parameters"}),o.jsxs("label",{children:["Minimum cards in lane",o.jsxs("select",{value:l,onChange:i=>n({...a,laneCondition:{type:"min_cards",count:parseInt(i.target.value)}}),children:[o.jsx("option",{value:0,children:"No minimum (any lane)"}),o.jsx("option",{value:4,children:"4 or more cards"}),o.jsx("option",{value:6,children:"6 or more cards"}),o.jsx("option",{value:8,children:"8 or more cards (Metal-3)"}),o.jsx("option",{value:10,children:"10 or more cards"})]})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a.excludeCurrentLane!==!1,onChange:i=>n({...a,excludeCurrentLane:i.target.checked})}),"Exclude current lane (other lanes only)"]})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const gb=({params:a,onChange:n})=>o.jsxs("div",{className:"param-editor",children:[o.jsx("h4",{children:"Shuffle Trash Effect"}),o.jsx("p",{style:{color:"#8A79E8",fontSize:"14px",marginBottom:"15px"},children:"Shuffle your trash (discarded/deleted cards) back into your deck."}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:a.optional!==!1,onChange:l=>n({...a,optional:l.target.checked})}),'Optional ("You may shuffle...")']})]}),vb=({params:a})=>o.jsxs("div",{className:"param-editor",children:[o.jsx("h4",{children:"Shuffle Deck Effect"}),o.jsx("p",{style:{color:"#8A79E8",fontSize:"14px",marginBottom:"15px"},children:"Shuffle your deck. Typically used after revealing the deck."})]}),dc=a=>{switch(a){case"draw":return{action:"draw",count:1,target:"self",source:"own_deck"};case"refresh":return{action:"refresh",target:"self"};case"mutual_draw":return{action:"mutual_draw",count:1};case"flip":return{action:"flip",count:1,targetFilter:{owner:"any",position:"any",faceState:"any",excludeSelf:!1},optional:!1};case"shift":return{action:"shift",targetFilter:{owner:"any",position:"any",faceState:"any"},destinationRestriction:{type:"any"}};case"delete":return{action:"delete",count:1,targetFilter:{position:"any",faceState:"any"},scope:{type:"anywhere"},excludeSelf:!1};case"discard":return{action:"discard",count:1,actor:"self"};case"return":return{action:"return",count:1,targetFilter:{},scope:{type:"any_card"}};case"play":return{action:"play",source:"hand",count:1,faceDown:!1,destinationRule:{type:"other_lines"}};case"rearrange_protocols":return{action:"rearrange_protocols",target:"own"};case"swap_protocols":return{action:"swap_protocols",target:"own"};case"reveal":case"give":return{action:a,source:"own_hand",count:1};case"take":return{action:"take",source:"opponent_hand",count:1,random:!0};case"choice":return{action:"choice",options:[]};case"passive_rule":return{action:"passive_rule",rule:{type:"block_all_play",target:"opponent",scope:"this_lane"}};case"value_modifier":return{action:"value_modifier",modifier:{type:"add_per_condition",value:1,condition:"per_face_down_card",target:"own_total",scope:"this_lane"}};case"block_compile":return{action:"block_compile",target:"opponent"};case"delete_all_in_lane":return{action:"delete_all_in_lane",laneCondition:{type:"min_cards",count:8},excludeCurrentLane:!0};case"shuffle_trash":return{action:"shuffle_trash",optional:!0};case"shuffle_deck":return{action:"shuffle_deck"};case"redirect_return_to_deck":return{action:"redirect_return_to_deck",faceDown:!0};default:return{}}},_b=({effect:a,onChange:n,readOnly:l=!1})=>{const c=w=>{l||n({...a,params:w})},i=w=>{if(w){const b={id:Xe(),params:dc("draw"),position:a.position,trigger:a.trigger};n({...a,conditional:{type:"then",thenEffect:b}})}else{const{conditional:b,...N}=a;n(N)}},d=w=>{a.conditional&&n({...a,conditional:{...a.conditional,type:w}})},u=w=>{a.conditional&&n({...a,conditional:{...a.conditional,thenEffect:w}})},h=w=>{if(!a.conditional)return;const b=dc(w),N={...a.conditional.thenEffect,params:b};n({...a,conditional:{...a.conditional,thenEffect:N}})},f=w=>{if(a.conditional)if(w){const b={id:Xe(),params:dc("delete"),position:a.position,trigger:a.trigger};n({...a,conditional:{...a.conditional,thenEffect:{...a.conditional.thenEffect,conditional:{type:"then",thenEffect:b}}}})}else{const{conditional:b,...N}=a.conditional.thenEffect;n({...a,conditional:{...a.conditional,thenEffect:N}})}},m=w=>{var b;(b=a.conditional)!=null&&b.thenEffect.conditional&&n({...a,conditional:{...a.conditional,thenEffect:{...a.conditional.thenEffect,conditional:{...a.conditional.thenEffect.conditional,type:w}}}})},y=w=>{var b;(b=a.conditional)!=null&&b.thenEffect.conditional&&n({...a,conditional:{...a.conditional,thenEffect:{...a.conditional.thenEffect,conditional:{...a.conditional.thenEffect.conditional,thenEffect:w}}}})},v=w=>{var S;if(!((S=a.conditional)!=null&&S.thenEffect.conditional))return;const b=dc(w),N={...a.conditional.thenEffect.conditional.thenEffect,params:b};n({...a,conditional:{...a.conditional,thenEffect:{...a.conditional.thenEffect,conditional:{...a.conditional.thenEffect.conditional,thenEffect:N}}}})},_=(w,b)=>{switch(w.params.action){case"draw":return o.jsx(Ky,{params:w.params,onChange:b});case"refresh":return o.jsx(db,{params:w.params,onChange:b});case"mutual_draw":return o.jsx(ub,{params:w.params,onChange:b});case"flip":return o.jsx(Jy,{params:w.params,onChange:b});case"shift":return o.jsx(eg,{params:w.params,onChange:b});case"delete":return o.jsx(tg,{params:w.params,onChange:b});case"discard":return o.jsx(ng,{params:w.params,onChange:b});case"return":return o.jsx(ag,{params:w.params,onChange:b});case"play":return o.jsx(og,{params:w.params,onChange:b});case"rearrange_protocols":case"swap_protocols":return o.jsx(rg,{params:w.params,onChange:b});case"reveal":case"give":return o.jsx(lg,{params:w.params,onChange:b});case"take":return o.jsx(sg,{params:w.params,onChange:b});case"choice":return o.jsx(fb,{params:w.params,onChange:b});case"passive_rule":return o.jsx(pb,{params:w.params,onChange:b});case"value_modifier":return o.jsx(hb,{params:w.params,onChange:b});case"block_compile":return o.jsx(mb,{params:w.params,onChange:b});case"delete_all_in_lane":return o.jsx(yb,{params:w.params,onChange:b});case"shuffle_trash":return o.jsx(gb,{params:w.params,onChange:b});case"shuffle_deck":return o.jsx(vb,{params:w.params,onChange:b});default:return o.jsxs("div",{children:["Unknown effect type: ",w.params.action]})}};return o.jsxs("div",{className:`effect-editor ${l?"read-only-mode":""}`,children:[o.jsx("div",{className:"trigger-info",style:{marginBottom:"15px",padding:"10px",backgroundColor:"#1A113B",borderRadius:"4px",border:"1px solid rgba(97, 239, 255, 0.3)"},children:o.jsxs("div",{style:{display:"flex",gap:"20px",alignItems:"center",flexWrap:"wrap"},children:[o.jsxs("label",{style:{flex:1,minWidth:"200px"},children:[o.jsx("strong",{children:"Trigger:"}),o.jsxs("select",{value:a.trigger,onChange:w=>!l&&n({...a,trigger:w.target.value}),disabled:l,style:{width:"100%",padding:"6px",marginTop:"4px",backgroundColor:"#2c1d63",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px"},children:[o.jsx("optgroup",{label:"Immediate",children:o.jsx("option",{value:"on_play",children:"On Play"})}),o.jsx("optgroup",{label:"Passive (Top Box)",children:o.jsx("option",{value:"passive",children:"Passive (always active)"})}),o.jsxs("optgroup",{label:"Phase Triggers (Bottom Box)",children:[o.jsx("option",{value:"start",children:"Start Phase"}),o.jsx("option",{value:"end",children:"End Phase"}),o.jsx("option",{value:"on_cover",children:"When Covered"})]}),o.jsxs("optgroup",{label:"Reactive (Top Box)",children:[o.jsx("option",{value:"on_flip",children:"When this card would be flipped"}),o.jsx("option",{value:"on_cover_or_flip",children:"When covered or flipped"}),o.jsx("option",{value:"after_delete",children:"After cards are deleted"}),o.jsx("option",{value:"after_discard",children:"After cards are discarded"}),o.jsx("option",{value:"after_draw",children:"After cards are drawn"}),o.jsx("option",{value:"after_shift",children:"After cards are shifted"}),o.jsx("option",{value:"after_flip",children:"After cards are flipped"}),o.jsx("option",{value:"after_play",children:"After a card is played"}),o.jsx("option",{value:"after_clear_cache",children:"After cache is cleared"}),o.jsx("option",{value:"after_opponent_discard",children:"After opponent discards"}),o.jsx("option",{value:"before_compile_delete",children:"Before deleted by compile"}),o.jsx("option",{value:"when_card_returned",children:"When card returned to hand"})]})]})]}),o.jsxs("div",{style:{color:"#8A79E8",fontSize:"13px"},children:[o.jsx("strong",{children:"Position:"})," ",a.position.charAt(0).toUpperCase()+a.position.slice(1)," Box"]})]})}),o.jsxs("div",{className:"main-effect",children:[o.jsx("h3",{children:"Main Effect"}),_(a,c),o.jsxs("div",{className:"effect-preview",children:[o.jsx("strong",{children:"Preview:"})," ",o.jsx("span",{dangerouslySetInnerHTML:{__html:Yo([a])}})]})]}),o.jsxs("div",{style:{marginTop:"15px"},children:[o.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[o.jsx("input",{type:"checkbox",checked:!!a.useCardFromPreviousEffect,onChange:w=>n({...a,useCardFromPreviousEffect:w.target.checked})}),o.jsx("span",{children:`Use card from previous effect (for "shift THAT card", "draw equal to THAT card's value", etc.)`})]}),a.useCardFromPreviousEffect&&o.jsx("small",{style:{display:"block",marginLeft:"24px",marginTop:"4px",color:"#8A79E8"},children:"This effect will target/use the card selected by the previous effect in the chain."})]}),(a.trigger==="after_draw"||a.trigger==="after_delete"||a.trigger==="after_discard"||a.trigger==="after_shift"||a.trigger==="after_flip"||a.trigger==="after_clear_cache"||a.trigger==="after_opponent_discard"||a.trigger==="after_play")&&o.jsxs("div",{style:{marginTop:"15px"},children:[o.jsxs("label",{children:["Trigger Actor (who triggers this effect?)",o.jsxs("select",{value:a.reactiveTriggerActor||"self",onChange:w=>n({...a,reactiveTriggerActor:w.target.value}),style:{width:"100%",padding:"8px",marginTop:"5px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px",cursor:"pointer"},children:[o.jsx("option",{value:"self",children:"Only when YOU perform the action (default)"}),o.jsx("option",{value:"opponent",children:"Only when OPPONENT performs the action"}),o.jsx("option",{value:"any",children:"When ANYONE performs the action"})]})]}),o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:a.reactiveTriggerActor==="self"||!a.reactiveTriggerActor?"Effect triggers only when YOU delete/draw/etc.":a.reactiveTriggerActor==="opponent"?"Effect triggers only when OPPONENT deletes/draws/etc.":"Effect triggers when ANYONE deletes/draws/etc."})]}),(a.trigger==="after_play"||a.trigger==="after_shift"||a.trigger==="after_flip"||a.trigger==="after_delete")&&o.jsxs("div",{style:{marginTop:"15px"},children:[o.jsxs("label",{children:["Reactive Scope",o.jsxs("select",{value:a.reactiveScope||"global",onChange:w=>n({...a,reactiveScope:w.target.value}),style:{width:"100%",padding:"8px",marginTop:"5px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px",cursor:"pointer"},children:[o.jsx("option",{value:"global",children:"Any lane (default)"}),o.jsx("option",{value:"this_lane",children:"This lane only"})]})]}),o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:a.reactiveScope==="this_lane"?"Effect only triggers when the action happens in the same lane as this card.":"Effect triggers when the action happens anywhere on the board."})]}),o.jsxs("div",{className:"conditional-section",style:{marginTop:"20px",borderTop:"1px solid #2c1d63",paddingTop:"15px"},children:[o.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"10px"},children:[o.jsx("input",{type:"checkbox",checked:!!a.conditional,onChange:w=>i(w.target.checked)}),o.jsx("strong",{children:"Add follow-up effect"})]}),a.conditional&&o.jsxs("div",{className:"follow-up-effect",style:{marginLeft:"20px",padding:"10px",backgroundColor:"#2c1d63",borderRadius:"4px",border:"1px solid rgba(97, 239, 255, 0.2)"},children:[o.jsx("h4",{style:{marginTop:0},children:"Follow-Up Effect"}),o.jsxs("label",{children:["Connection Type",o.jsxs("select",{value:a.conditional.type||"then",onChange:w=>d(w.target.value),style:{width:"100%",padding:"8px",marginTop:"5px",marginBottom:"15px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px",cursor:"pointer"},children:[o.jsx("option",{value:"then",children:"Then (always executes)"}),o.jsx("option",{value:"if_executed",children:"If you do (only if first effect succeeds)"})]})]}),o.jsxs("label",{children:["Effect Type",o.jsxs("select",{value:a.conditional.thenEffect.params.action,onChange:w=>h(w.target.value),style:{width:"100%",padding:"8px",marginTop:"5px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px",cursor:"pointer"},children:[o.jsx("option",{value:"draw",children:"Draw Cards"}),o.jsx("option",{value:"refresh",children:"Refresh Hand"}),o.jsx("option",{value:"mutual_draw",children:"Mutual Draw (Exchange)"}),o.jsx("option",{value:"flip",children:"Flip Cards"}),o.jsx("option",{value:"shift",children:"Shift Card"}),o.jsx("option",{value:"delete",children:"Delete Cards"}),o.jsx("option",{value:"delete_all_in_lane",children:"Delete All in Lane"}),o.jsx("option",{value:"discard",children:"Discard Cards"}),o.jsx("option",{value:"return",children:"Return to Hand"}),o.jsx("option",{value:"play",children:"Play from Hand/Deck"}),o.jsx("option",{value:"rearrange_protocols",children:"Rearrange Protocols"}),o.jsx("option",{value:"swap_protocols",children:"Swap Protocols"}),o.jsx("option",{value:"reveal",children:"Reveal Hand"}),o.jsx("option",{value:"give",children:"Give Cards"}),o.jsx("option",{value:"take",children:"Take from Hand"}),o.jsx("option",{value:"choice",children:"Either/Or Choice"}),o.jsx("option",{value:"block_compile",children:"Block Compile"}),o.jsx("option",{value:"shuffle_trash",children:"Shuffle Trash into Deck"}),o.jsx("option",{value:"shuffle_deck",children:"Shuffle Deck"})]})]}),o.jsx("div",{style:{marginTop:"15px"},children:_(a.conditional.thenEffect,w=>u({...a.conditional.thenEffect,params:w}))}),o.jsxs("div",{className:"nested-conditional-section",style:{marginTop:"15px",borderTop:"1px solid rgba(97, 239, 255, 0.2)",paddingTop:"15px"},children:[o.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"10px"},children:[o.jsx("input",{type:"checkbox",checked:!!a.conditional.thenEffect.conditional,onChange:w=>f(w.target.checked)}),o.jsx("strong",{children:"Add 2nd follow-up effect"})]}),a.conditional.thenEffect.conditional&&o.jsxs("div",{className:"nested-follow-up-effect",style:{marginLeft:"10px",padding:"10px",backgroundColor:"#1A113B",borderRadius:"4px",border:"1px solid rgba(97, 239, 255, 0.2)"},children:[o.jsx("h5",{style:{marginTop:0,fontSize:"0.9rem"},children:"2nd Follow-Up Effect"}),o.jsxs("label",{children:["Connection Type",o.jsxs("select",{value:a.conditional.thenEffect.conditional.type||"then",onChange:w=>m(w.target.value),style:{width:"100%",padding:"6px",marginTop:"5px",marginBottom:"10px",backgroundColor:"#0D0825",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px",cursor:"pointer",fontSize:"0.9rem"},children:[o.jsx("option",{value:"then",children:"Then (always executes)"}),o.jsx("option",{value:"if_executed",children:"If you do (only if first effect succeeds)"})]})]}),o.jsxs("label",{children:["Effect Type",o.jsxs("select",{value:a.conditional.thenEffect.conditional.thenEffect.params.action,onChange:w=>v(w.target.value),style:{width:"100%",padding:"6px",marginTop:"5px",backgroundColor:"#0D0825",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px",cursor:"pointer",fontSize:"0.9rem"},children:[o.jsx("option",{value:"draw",children:"Draw Cards"}),o.jsx("option",{value:"refresh",children:"Refresh Hand"}),o.jsx("option",{value:"mutual_draw",children:"Mutual Draw (Exchange)"}),o.jsx("option",{value:"flip",children:"Flip Cards"}),o.jsx("option",{value:"shift",children:"Shift Card"}),o.jsx("option",{value:"delete",children:"Delete Cards"}),o.jsx("option",{value:"delete_all_in_lane",children:"Delete All in Lane"}),o.jsx("option",{value:"discard",children:"Discard Cards"}),o.jsx("option",{value:"return",children:"Return to Hand"}),o.jsx("option",{value:"play",children:"Play from Hand/Deck"}),o.jsx("option",{value:"rearrange_protocols",children:"Rearrange Protocols"}),o.jsx("option",{value:"swap_protocols",children:"Swap Protocols"}),o.jsx("option",{value:"reveal",children:"Reveal Hand"}),o.jsx("option",{value:"give",children:"Give Cards"}),o.jsx("option",{value:"take",children:"Take from Hand"}),o.jsx("option",{value:"choice",children:"Either/Or Choice"}),o.jsx("option",{value:"block_compile",children:"Block Compile"}),o.jsx("option",{value:"shuffle_trash",children:"Shuffle Trash into Deck"}),o.jsx("option",{value:"shuffle_deck",children:"Shuffle Deck"})]})]}),o.jsx("div",{style:{marginTop:"10px"},children:_(a.conditional.thenEffect.conditional.thenEffect,w=>y({...a.conditional.thenEffect.conditional.thenEffect,params:w}))})]})]})]})]})]})},xb=({card:a,protocolName:n,protocolColor:l,protocolPattern:c,onChange:i,readOnly:d=!1})=>{const[u,h]=re.useState(null),[f,m]=re.useState(null),[y,v]=re.useState(!1);re.useEffect(()=>{h(null)},[a.value]);const _=(E,A,O)=>{const I={id:Xe(),params:wb(A),position:E,trigger:O},T={...a};E==="top"?T.topEffects=[...T.topEffects,I]:E==="middle"?T.middleEffects=[...T.middleEffects,I]:T.bottomEffects=[...T.bottomEffects,I],i(T);const q=E==="top"?T.topEffects.length-1:E==="middle"?T.middleEffects.length-1:T.bottomEffects.length-1;h({box:E,effectIndex:q,effect:I})},w=(E,A)=>{m({box:E,effectIndex:A})},b=()=>{if(!f)return;const{box:E,effectIndex:A}=f,O={...a};E==="top"?O.topEffects.splice(A,1):E==="middle"?O.middleEffects.splice(A,1):O.bottomEffects.splice(A,1),i(O),u&&u.box===E&&u.effectIndex===A&&h(null),m(null)},N=E=>{if(!u)return;const{box:A,effectIndex:O}=u,I={...a};A==="top"?(I.topEffects=[...I.topEffects],I.topEffects[O]=E):A==="middle"?(I.middleEffects=[...I.middleEffects],I.middleEffects[O]=E):(I.bottomEffects=[...I.bottomEffects],I.bottomEffects[O]=E),i(I),h({box:A,effectIndex:O,effect:E})},S=(E,A)=>{const O=E==="top"?a.topEffects[A]:E==="middle"?a.middleEffects[A]:a.bottomEffects[A];h({box:E,effectIndex:A,effect:O})},k=(E,A)=>{const O=(A==null?void 0:A.reactiveTriggerActor)||"self",I=(A==null?void 0:A.reactiveScope)||"global";if(E==="after_play")return`After ${O==="opponent"?"your opponent plays":O==="any"?"a card is played":"you play"} a card${I==="this_lane"?" in this line":""}`;if(["after_delete","after_discard","after_draw","after_shift","after_flip"].includes(E)){const T={after_delete:"delete cards",after_discard:"discard cards",after_draw:"draw cards",after_shift:"shift cards",after_flip:"flip cards"},q=O==="opponent"?"your opponent":O==="any"?"anyone":"you",Y=I==="this_lane"?" in this line":"";return`After ${q} ${T[E]}${Y}`}switch(E){case"passive":return"";case"on_play":return"";case"start":return"Start";case"end":return"End";case"on_cover":return"On Cover";case"after_opponent_discard":return"After opponent discards";case"after_clear_cache":return"After you clear cache";case"before_compile_delete":return"Before deleted by compile";case"on_flip":return"When this card would be flipped";case"on_cover_or_flip":return"When covered or flipped";default:return E}},C=E=>{const A={...a,value:E};i(A)},j=Yo(a.topEffects),R=Yo(a.middleEffects),F=Yo(a.bottomEffects),L=JSON.stringify({top:a.topEffects.map(E=>({id:E.id,params:E.params})),middle:a.middleEffects.map(E=>({id:E.id,params:E.params})),bottom:a.bottomEffects.map(E=>({id:E.id,params:E.params}))}),U=`${n}-${a.value}-${L}`,Q={id:U,protocol:n,value:a.value,top:j,middle:R,bottom:F,isFaceUp:!0,owner:"player",laneIndex:0,category:"Custom",keywords:{}},X=(E,A)=>{E=E.replace("#","");const O=parseInt(E.substring(0,2),16),I=parseInt(E.substring(2,4),16),T=parseInt(E.substring(4,6),16);return`rgba(${O}, ${I}, ${T}, ${A})`},V=`card-custom-preview pattern-${c}`,$={"--custom-color":l,"--custom-color-alpha-05":X(l,.05),"--custom-color-alpha-06":X(l,.06),"--custom-color-alpha-08":X(l,.08),"--custom-color-alpha-10":X(l,.1),"--custom-color-alpha-15":X(l,.15),"--custom-color-alpha-20":X(l,.2),"--custom-color-alpha-25":X(l,.25),borderColor:l};return o.jsxs("div",{className:"card-editor-container",children:[o.jsxs("div",{className:"card-editor-content",children:[o.jsxs("div",{className:"card-live-preview",children:[o.jsx("h4",{children:"Card Preview"}),o.jsxs("label",{className:"card-value-selector",children:["Card Value:",o.jsxs("select",{value:a.value,onChange:E=>C(Number(E.target.value)),children:[o.jsx("option",{value:-1,children:"-1"}),o.jsx("option",{value:0,children:"0"}),o.jsx("option",{value:1,children:"1"}),o.jsx("option",{value:2,children:"2"}),o.jsx("option",{value:3,children:"3"}),o.jsx("option",{value:4,children:"4"}),o.jsx("option",{value:5,children:"5"}),o.jsx("option",{value:6,children:"6"})]})]}),o.jsx("div",{className:"card-preview-wrapper",style:$,children:o.jsx(kt,{card:Q,isFaceUp:!0,additionalClassName:V},U)})]}),o.jsx("div",{className:"card-effects-editor",children:o.jsxs("div",{className:"card-preview",style:{borderColor:l},children:[o.jsx("div",{className:"card-header",style:{backgroundColor:l},children:o.jsxs("h3",{children:[n,"-",a.value]})}),o.jsxs("div",{className:"card-box top-box",children:[o.jsx("h4",{children:"Top Box (Passive/Reactive)"}),o.jsx("p",{className:"box-description",children:"Passive effects or reactive triggers"}),o.jsxs("div",{className:"effects-list",children:[a.topEffects.map((E,A)=>o.jsxs("div",{className:"effect-item",children:[o.jsxs("span",{onClick:()=>S("top",A),className:d?"read-only-clickable":"",children:[E.trigger!=="passive"&&o.jsxs("strong",{children:[k(E.trigger,E),":"]})," ",Pr(E)]}),!d&&o.jsx("button",{onClick:()=>w("top",A),children:""})]},E.id)),a.topEffects.length===0&&o.jsx("p",{className:"empty-box",children:"No effects"})]}),!d&&o.jsxs("div",{className:"add-effect-controls",children:[o.jsxs("select",{id:"top-trigger",defaultValue:"",children:[o.jsx("option",{value:"",children:"Choose Trigger"}),o.jsx("optgroup",{label:"Passive",children:o.jsx("option",{value:"passive",children:"Passive (always active)"})}),o.jsxs("optgroup",{label:"Phase Triggers",children:[o.jsx("option",{value:"start",children:"Start Phase"}),o.jsx("option",{value:"end",children:"End Phase"}),o.jsx("option",{value:"on_cover",children:"On Cover"})]}),o.jsxs("optgroup",{label:"Reactive Triggers",children:[o.jsx("option",{value:"after_delete",children:"After you delete cards"}),o.jsx("option",{value:"after_opponent_discard",children:"After opponent discards"}),o.jsx("option",{value:"after_draw",children:"After you draw cards"}),o.jsx("option",{value:"after_clear_cache",children:"After you clear cache"}),o.jsx("option",{value:"before_compile_delete",children:"Before deleted by compile"}),o.jsx("option",{value:"after_flip",children:"After cards are flipped"}),o.jsx("option",{value:"after_shift",children:"After cards are shifted"}),o.jsx("option",{value:"after_play",children:"After cards are played"}),o.jsx("option",{value:"on_flip",children:"When this card would be flipped"}),o.jsx("option",{value:"on_cover_or_flip",children:"When this card would be covered or flipped"})]})]}),o.jsxs("select",{id:"top-action",defaultValue:"",children:[o.jsx("option",{value:"",children:"Choose Action"}),o.jsx("option",{value:"draw",children:"Draw Cards"}),o.jsx("option",{value:"refresh",children:"Refresh Hand"}),o.jsx("option",{value:"mutual_draw",children:"Mutual Draw (Exchange)"}),o.jsx("option",{value:"flip",children:"Flip Cards"}),o.jsx("option",{value:"shift",children:"Shift Card"}),o.jsx("option",{value:"delete",children:"Delete Cards"}),o.jsx("option",{value:"discard",children:"Discard Cards"}),o.jsx("option",{value:"return",children:"Return to Hand"}),o.jsx("option",{value:"play",children:"Play from Hand/Deck"}),o.jsx("option",{value:"rearrange_protocols",children:"Rearrange Protocols"}),o.jsx("option",{value:"swap_protocols",children:"Swap Protocols"}),o.jsx("option",{value:"reveal",children:"Reveal Hand"}),o.jsx("option",{value:"give",children:"Give Cards"}),o.jsx("option",{value:"take",children:"Take from Hand"}),o.jsx("option",{value:"choice",children:"Either/Or Choice"}),o.jsx("option",{value:"passive_rule",children:"Passive Rule"}),o.jsx("option",{value:"value_modifier",children:"Value Modifier"}),o.jsx("option",{value:"block_compile",children:"Block Compile"}),o.jsx("option",{value:"delete_all_in_lane",children:"Delete All in Lane"})]}),o.jsx("button",{className:"btn btn-add-effect",onClick:()=>{const E=document.getElementById("top-trigger"),A=document.getElementById("top-action"),O=E.value,I=A.value;O&&I?(_("top",I,O),E.value="",A.value=""):v(!0)},children:"+"})]})]}),o.jsxs("div",{className:"card-box middle-box",children:[o.jsx("h4",{children:"Middle Box (On Play)"}),o.jsx("p",{className:"box-description",children:"When played or uncovered"}),o.jsxs("div",{className:"effects-list",children:[a.middleEffects.map((E,A)=>o.jsxs("div",{className:"effect-item",children:[o.jsx("span",{onClick:()=>S("middle",A),className:d?"read-only-clickable":"",children:Pr(E)}),!d&&o.jsx("button",{onClick:()=>w("middle",A),children:""})]},E.id)),a.middleEffects.length===0&&o.jsx("p",{className:"empty-box",children:"No effects"})]}),!d&&o.jsxs("select",{onChange:E=>{E.target.value&&(_("middle",E.target.value,"on_play"),E.target.value="")},children:[o.jsx("option",{value:"",children:"+ Add Effect"}),o.jsx("option",{value:"draw",children:"Draw Cards"}),o.jsx("option",{value:"refresh",children:"Refresh Hand"}),o.jsx("option",{value:"flip",children:"Flip Cards"}),o.jsx("option",{value:"shift",children:"Shift Card"}),o.jsx("option",{value:"delete",children:"Delete Cards"}),o.jsx("option",{value:"discard",children:"Discard Cards"}),o.jsx("option",{value:"return",children:"Return to Hand"}),o.jsx("option",{value:"play",children:"Play from Hand/Deck"}),o.jsx("option",{value:"rearrange_protocols",children:"Rearrange Protocols"}),o.jsx("option",{value:"swap_protocols",children:"Swap Protocols"}),o.jsx("option",{value:"reveal",children:"Reveal Hand"}),o.jsx("option",{value:"give",children:"Give Cards"}),o.jsx("option",{value:"take",children:"Take from Hand"}),o.jsx("option",{value:"choice",children:"Either/Or Choice"}),o.jsx("option",{value:"passive_rule",children:"Passive Rule"}),o.jsx("option",{value:"value_modifier",children:"Value Modifier"}),o.jsx("option",{value:"block_compile",children:"Block Compile"}),o.jsx("option",{value:"delete_all_in_lane",children:"Delete All in Lane"})]})]}),o.jsxs("div",{className:"card-box bottom-box",children:[o.jsx("h4",{children:"Bottom Box (Triggered)"}),o.jsx("p",{className:"box-description",children:"Only when uncovered AND face-up"}),o.jsxs("div",{className:"effects-list",children:[a.bottomEffects.map((E,A)=>o.jsxs("div",{className:"effect-item",children:[o.jsxs("span",{onClick:()=>S("bottom",A),className:d?"read-only-clickable":"",children:[o.jsxs("strong",{children:[k(E.trigger,E),":"]})," ",Pr(E)]}),!d&&o.jsx("button",{onClick:()=>w("bottom",A),children:""})]},E.id)),a.bottomEffects.length===0&&o.jsx("p",{className:"empty-box",children:"No effects"})]}),!d&&o.jsxs("div",{className:"bottom-effect-add",children:[o.jsxs("select",{id:"bottom-trigger",children:[o.jsx("option",{value:"",children:"1. Choose Trigger"}),o.jsx("option",{value:"start",children:"Start Phase"}),o.jsx("option",{value:"end",children:"End Phase"}),o.jsx("option",{value:"on_cover",children:"On Cover"})]}),o.jsxs("select",{id:"bottom-action",children:[o.jsx("option",{value:"",children:"2. Choose Effect"}),o.jsx("option",{value:"draw",children:"Draw Cards"}),o.jsx("option",{value:"refresh",children:"Refresh Hand"}),o.jsx("option",{value:"mutual_draw",children:"Mutual Draw (Exchange)"}),o.jsx("option",{value:"flip",children:"Flip Cards"}),o.jsx("option",{value:"shift",children:"Shift Card"}),o.jsx("option",{value:"delete",children:"Delete Cards"}),o.jsx("option",{value:"discard",children:"Discard Cards"}),o.jsx("option",{value:"return",children:"Return to Hand"}),o.jsx("option",{value:"play",children:"Play from Hand/Deck"}),o.jsx("option",{value:"rearrange_protocols",children:"Rearrange Protocols"}),o.jsx("option",{value:"swap_protocols",children:"Swap Protocols"}),o.jsx("option",{value:"reveal",children:"Reveal Hand"}),o.jsx("option",{value:"give",children:"Give Cards"}),o.jsx("option",{value:"take",children:"Take from Hand"}),o.jsx("option",{value:"choice",children:"Either/Or Choice"}),o.jsx("option",{value:"passive_rule",children:"Passive Rule"}),o.jsx("option",{value:"value_modifier",children:"Value Modifier"}),o.jsx("option",{value:"block_compile",children:"Block Compile"}),o.jsx("option",{value:"delete_all_in_lane",children:"Delete All in Lane"})]}),o.jsx("button",{className:"btn btn-add-effect",onClick:()=>{const E=document.getElementById("bottom-trigger"),A=document.getElementById("bottom-action"),O=E.value,I=A.value;O&&I?(_("bottom",I,O),E.value="",A.value=""):v(!0)},children:"+"})]})]})]})})]}),u&&o.jsxs("div",{className:"effect-parameter-editor",children:[o.jsx("h3",{children:d?"View Effect":"Configure Effect"}),d&&o.jsx("div",{className:"read-only-notice",children:"This effect is read-only"}),o.jsx(_b,{effect:u.effect,onChange:N,readOnly:d}),o.jsx("button",{onClick:()=>h(null),className:"btn",children:d?"Close":"Done"})]}),f&&o.jsx("div",{className:"custom-protocol-modal-overlay",onClick:()=>m(null),children:o.jsxs("div",{className:"custom-protocol-modal-content",onClick:E=>E.stopPropagation(),children:[o.jsx("h3",{children:"Delete Effect"}),o.jsx("p",{children:"Are you sure you want to delete this effect?"}),o.jsxs("div",{className:"custom-protocol-modal-actions",children:[o.jsx("button",{onClick:()=>m(null),className:"btn btn-back",children:"Cancel"}),o.jsx("button",{onClick:b,className:"btn btn-delete",children:"Delete"})]})]})}),y&&o.jsx("div",{className:"custom-protocol-modal-overlay",onClick:()=>v(!1),children:o.jsxs("div",{className:"custom-protocol-modal-content",onClick:E=>E.stopPropagation(),children:[o.jsx("h3",{children:"Missing Selection"}),o.jsx("p",{children:"Please select both a trigger and an effect before adding."}),o.jsx("div",{className:"custom-protocol-modal-actions",children:o.jsx("button",{onClick:()=>v(!1),className:"btn",children:"OK"})})]})})]})},wb=a=>{switch(a){case"draw":return{action:"draw",count:1,target:"self",source:"own_deck"};case"flip":return{action:"flip",count:1,targetFilter:{owner:"any",position:"any",faceState:"any",excludeSelf:!1},optional:!1};case"shift":return{action:"shift",targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1}};case"delete":return{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"any"},excludeSelf:!0};case"discard":return{action:"discard",count:1,actor:"self"};case"return":return{action:"return",count:1,targetFilter:{},scope:{type:"any_card"}};case"play":return{action:"play",source:"hand",count:1,faceDown:!0,destinationRule:{type:"other_lines"}};case"rearrange_protocols":return{action:"rearrange_protocols",target:"own"};case"swap_protocols":return{action:"swap_protocols",target:"own"};case"reveal":case"give":return{action:a,source:"own_hand",count:1};case"take":return{action:"take",source:"opponent_hand",count:1,random:!0};case"choice":return{action:"choice",options:[]};case"passive_rule":return{action:"passive_rule",rule:{type:"block_all_play",target:"opponent",scope:"this_lane"}};case"value_modifier":return{action:"value_modifier",modifier:{type:"add_per_condition",value:1,condition:"per_face_down_card",target:"own_total",scope:"this_lane"}};default:return{}}},Cb=(a,n)=>{const l=(i,d)=>{i=i.replace("#","");const u=parseInt(i.substring(0,2),16),h=parseInt(i.substring(2,4),16),f=parseInt(i.substring(4,6),16);return`rgba(${u}, ${h}, ${f}, ${d})`},c={borderColor:n};switch(a){case"solid":return{...c,backgroundColor:n};case"radial":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`radial-gradient(circle at 50% 50%, ${l(n,.25)} 0%, transparent 60%)`};case"dual-radial":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 0% 0%, ${l(n,.2)}, transparent 50%),
                    radial-gradient(at 100% 100%, ${l(n,.2)}, transparent 50%)
                `};case"multi-radial":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 0%, ${l(n,.2)}, transparent 70%),
                    radial-gradient(circle at 20% 30%, ${l(n,.15)}, transparent 40%),
                    radial-gradient(circle at 80% 70%, ${l(n,.2)}, transparent 50%)
                `};case"chaos":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 10% 10%, hsla(60, 100%, 50%, 0.15), transparent 30%),
                    radial-gradient(at 90% 20%, hsla(180, 100%, 50%, 0.15), transparent 35%),
                    radial-gradient(at 30% 80%, hsla(300, 100%, 50%, 0.15), transparent 40%),
                    radial-gradient(at 70% 60%, hsla(0, 100%, 50%, 0.1), transparent 25%)
                `};case"grid":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(circle at 50% 50%, ${l(n,.2)} 0%, transparent 40%),
                    linear-gradient(hsla(0,0%,100%,0.03) 1px, transparent 1px),
                    linear-gradient(90deg, hsla(0,0%,100%,0.03) 1px, transparent 1px)
                `,backgroundSize:"100% 100%, 20px 20px, 20px 20px"};case"diagonal-lines":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 0% 100%, ${l(n,.25)}, transparent 70%),
                    repeating-linear-gradient(120deg, transparent, transparent 15px, ${l(n,.05)} 15px, ${l(n,.05)} 30px)
                `};case"cross-diagonal":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 50%, ${l(n,.25)} 0%, transparent 50%),
                    repeating-linear-gradient(45deg, transparent, transparent 8px, ${l(n,.08)} 8px, ${l(n,.08)} 16px),
                    repeating-linear-gradient(-45deg, transparent, transparent 8px, ${l(n,.06)} 8px, ${l(n,.06)} 16px)
                `};case"horizontal-lines":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 80% 80%, ${l(n,.1)}, transparent 50%),
                    repeating-linear-gradient(0deg, hsla(0,0%,100%,0.02), hsla(0,0%,100%,0.02) 1px, transparent 1px, transparent 3px)
                `};case"vertical-lines":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 10% 10%, ${l(n,.2)}, transparent 50%),
                    repeating-linear-gradient(175deg, transparent, transparent 1px, ${l(n,.05)} 1px, ${l(n,.05)} 2px)
                `};case"cross":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    linear-gradient(0deg, transparent 40%, ${l(n,.1)} 50%, transparent 60%),
                    linear-gradient(90deg, transparent 48%, ${l(n,.2)} 50%, transparent 52%)
                `};case"hexagons":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 0%, ${l(n,.2)}, transparent 70%),
                    url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='28' height='49' viewBox='0 0 28 49'%3E%3Cg fill-rule='evenodd'%3E%3Cg id='hexagons' fill='%23ffffff' fill-opacity='0.05' fill-rule='nonzero'%3E%3Cpath d='M13.99 9.25l13 7.5v15l-13 7.5L1 31.75v-15l12.99-7.5zM3 17.9v12.7l10.99 6.34 11-6.35V17.9l-11-6.34L3 17.9zM0 15l12.99-7.5L26 15v18.5l-13 7.5L0 33.5V15z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")
                `};case"stripes":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 100%, ${l(n,.25)}, transparent 60%),
                    linear-gradient(135deg, hsla(0,0%,0%,0.1) 23%, transparent 23%, transparent 25%, hsla(0,0%,0%,0.1) 25%, hsla(0,0%,0%,0.1) 27%, transparent 27%, transparent 73%, hsla(0,0%,0%,0.1) 73%, hsla(0,0%,0%,0.1) 75%, transparent 75%, transparent 77%, hsla(0,0%,0%,0.1) 77%)
                `};case"frost":return{...c,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(circle at 50% 50%, ${l(n,.2)} 0%, transparent 50%),
                    repeating-linear-gradient(30deg, transparent, transparent 10px, ${l(n,.08)} 10px, ${l(n,.08)} 11px),
                    repeating-linear-gradient(-30deg, transparent, transparent 10px, ${l(n,.08)} 10px, ${l(n,.08)} 11px),
                    repeating-linear-gradient(90deg, transparent, transparent 8px, ${l(n,.05)} 8px, ${l(n,.05)} 9px)
                `};default:return c}},bb=[{name:"Anarchy",hex:"#EA5A3C"},{name:"Apathy",hex:"#989A9A"},{name:"Chaos",hex:"#E53FE5"},{name:"Darkness",hex:"#A772D4"},{name:"Death",hex:"#E25656"},{name:"Fire",hex:"#F06838"},{name:"Gravity",hex:"#7599EB"},{name:"Hate",hex:"#E03E5E"},{name:"Life",hex:"#3CE076"},{name:"Light",hex:"#FFEB7F"},{name:"Love",hex:"#F074D9"},{name:"Metal",hex:"#B3B8BD"},{name:"Plague",hex:"#A2CD3A"},{name:"Psychic",hex:"#C971EB"},{name:"Speed",hex:"#33DDDD"},{name:"Spirit",hex:"#42D4A8"},{name:"Water",hex:"#3FA4EB"}],Sb=[{name:"Solid",value:"solid",description:"Solid color background"},{name:"Radial Glow",value:"radial",description:"Single radial gradient glow"},{name:"Dual Radial",value:"dual-radial",description:"Two radial gradient spots"},{name:"Multi Radial",value:"multi-radial",description:"Multiple radial gradient spots"},{name:"Chaos",value:"chaos",description:"Colorful chaotic spots"},{name:"Grid",value:"grid",description:"Grid line pattern"},{name:"Diagonal Lines",value:"diagonal-lines",description:"Repeating diagonal lines"},{name:"Cross Diagonal",value:"cross-diagonal",description:"Crossed diagonal lines"},{name:"Horizontal Lines",value:"horizontal-lines",description:"Fine horizontal lines"},{name:"Vertical Lines",value:"vertical-lines",description:"Fine vertical lines"},{name:"Cross Pattern",value:"cross",description:"Cross/plus pattern"},{name:"Hexagons",value:"hexagons",description:"Hexagon pattern"},{name:"Stripes",value:"stripes",description:"Diagonal stripe pattern"},{name:"Frost",value:"frost",description:"Icy crystalline pattern with crossing lines"}],Eb=({onSave:a,onCancel:n,onDelete:l,initialProtocol:c})=>{const[i,d]=re.useState("name"),[u,h]=re.useState(0),[f,m]=re.useState(!1),[y,v]=re.useState(""),[_,w]=re.useState(!1),b=c?Or(c):!1;console.log("ProtocolWizard render - initialProtocol:",c,"isReadOnly:",b);const[N,S]=re.useState((c==null?void 0:c.name)||""),[k,C]=re.useState((c==null?void 0:c.description)||""),[j,R]=re.useState((c==null?void 0:c.color)||"#1976D2"),[F,L]=re.useState((c==null?void 0:c.pattern)||"solid"),[U,Q]=re.useState((c==null?void 0:c.cards)||[{value:0,topEffects:[],middleEffects:[],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[],bottomEffects:[]}]);console.log("ProtocolWizard state - name:",N,"color:",j,"pattern:",F);const X=()=>{if(i==="name"){if(!N.trim()){alert("Please enter a protocol name.");return}d("color")}else i==="color"?d("pattern"):i==="pattern"&&d("cards")},V=q=>{const Y=[...U];Y[u]=q,Q(Y)},$=()=>{const q={id:(c==null?void 0:c.id)||Xe(),name:N,description:k,author:"Player",createdAt:(c==null?void 0:c.createdAt)||new Date().toISOString(),color:j,pattern:F,cards:U};a(q)},E=()=>{c&&l&&l(c.id),w(!1)},A=()=>{const q={id:(c==null?void 0:c.id)||Xe(),name:N,description:k,author:"Player",createdAt:(c==null?void 0:c.createdAt)||new Date().toISOString(),color:j,pattern:F,cards:U},Y=JSON.stringify(q,null,2);v(Y),m(!0)},O=()=>{navigator.clipboard.writeText(y).then(()=>{alert("Protocol JSON copied to clipboard!"),m(!1)}).catch(()=>{alert("Failed to copy to clipboard. Please try again.")})},I=q=>!(!N.trim()&&q!=="name"),T=q=>{if(!I(q)){alert("Please enter a protocol name first.");return}d(q)};return o.jsxs("div",{className:"protocol-wizard",children:[o.jsxs("div",{className:"wizard-header",children:[o.jsxs("h2",{children:[b?`View Protocol: ${N}`:c?`Edit Protocol: ${N}`:"Create New Protocol",b&&o.jsx("span",{className:"read-only-badge",children:"Read-Only"})]}),o.jsxs("div",{className:"wizard-progress",children:[o.jsx("button",{className:`step ${i==="name"?"active":"done"}`,onClick:()=>T("name"),type:"button",children:"1. Name"}),o.jsx("button",{className:`step ${i==="color"?"active":i==="pattern"||i==="cards"?"done":""}`,onClick:()=>T("color"),disabled:!I("color"),type:"button",children:"2. Color"}),o.jsx("button",{className:`step ${i==="pattern"?"active":i==="cards"?"done":""}`,onClick:()=>T("pattern"),disabled:!I("pattern"),type:"button",children:"3. Pattern"}),o.jsx("button",{className:`step ${i==="cards"?"active":""}`,onClick:()=>T("cards"),disabled:!I("cards"),type:"button",children:"4. Cards"})]})]}),o.jsxs("div",{className:"wizard-content",children:[i==="name"&&o.jsxs("div",{className:"wizard-step name-step",children:[o.jsx("h3",{children:"Step 1: Name and Description"}),o.jsxs("label",{children:["Protocol Name *",o.jsx("input",{type:"text",value:N,onChange:q=>!b&&S(q.target.value),placeholder:"e.g. Lightning, Shadow, Void",autoFocus:!0,readOnly:b,className:b?"read-only":""})]}),o.jsxs("label",{children:["Description",o.jsx("textarea",{value:k,onChange:q=>!b&&C(q.target.value),placeholder:"Describe the strategy and theme of your protocol",rows:4,readOnly:b,className:b?"read-only":""})]})]}),i==="color"&&o.jsxs("div",{className:"wizard-step color-step",children:[o.jsx("h3",{children:"Step 2: Choose Color"}),o.jsx("div",{className:"color-preview",style:{backgroundColor:j},children:o.jsx("span",{children:N||"Your Protocol"})}),o.jsx("h4",{children:"Predefined Colors"}),o.jsx("div",{className:`color-grid ${b?"read-only":""}`,children:bb.map(q=>o.jsx("button",{className:`color-option ${j===q.hex?"selected":""}`,style:{backgroundColor:q.hex},onClick:()=>!b&&R(q.hex),title:q.name,disabled:b,children:j===q.hex&&""},q.hex))}),o.jsx("h4",{children:"Custom Color"}),o.jsxs("div",{className:"custom-color",children:[o.jsx("input",{type:"color",value:j,onChange:q=>!b&&R(q.target.value),disabled:b}),o.jsx("input",{type:"text",value:j,onChange:q=>!b&&R(q.target.value),placeholder:"#1976D2",readOnly:b,className:b?"read-only":""})]})]}),i==="pattern"&&o.jsxs("div",{className:"wizard-step pattern-step",children:[o.jsx("h3",{children:"Step 3: Choose Card Pattern"}),o.jsx("div",{className:`pattern-selection-grid ${b?"read-only":""}`,children:Sb.map(q=>{const Y=Cb(q.value,j);return o.jsxs("div",{className:`pattern-option ${F===q.value?"selected":""}`,onClick:()=>!b&&L(q.value),children:[o.jsxs("div",{className:"pattern-preview",style:Y,children:[N||"Protocol","-0"]}),o.jsx("h4",{children:q.name}),o.jsx("p",{children:q.description}),F===q.value&&o.jsx("div",{className:"selected-badge",children:" Selected"})]},q.value)})})]}),i==="cards"&&o.jsxs("div",{className:"wizard-step cards-step",children:[o.jsx("h3",{children:"Step 4: Configure Cards"}),o.jsx("div",{className:"card-navigation",children:U.map((q,Y)=>o.jsxs("button",{className:`card-nav-btn ${u===Y?"active":""}`,onClick:()=>h(Y),type:"button",children:["Card ",q.value]},Y))}),o.jsx(xb,{card:U[u],protocolName:N,protocolColor:j,protocolPattern:F,onChange:V,readOnly:b})]})]}),o.jsxs("div",{className:"wizard-actions",children:[o.jsxs("div",{className:"wizard-actions-left",children:[o.jsx("button",{onClick:n,className:"btn btn-back",children:b?"Back":"Cancel"}),c&&l&&!b&&o.jsx("button",{onClick:()=>w(!0),className:"btn btn-delete",children:"Delete Protocol"})]}),o.jsxs("div",{className:"wizard-actions-right",children:[c&&o.jsxs(o.Fragment,{children:[o.jsx("button",{onClick:A,className:"btn btn-export",children:"Export JSON"}),!b&&o.jsx("button",{onClick:$,className:"btn",children:"Save"})]}),!c&&o.jsxs(o.Fragment,{children:[i!=="cards"&&o.jsx("button",{onClick:X,className:"btn",children:"Next"}),i==="cards"&&o.jsxs(o.Fragment,{children:[o.jsx("button",{onClick:A,className:"btn btn-export",children:"Export JSON"}),o.jsx("button",{onClick:$,className:"btn",children:"Save"})]})]})]})]}),f&&o.jsx("div",{className:"custom-protocol-modal-overlay",onClick:()=>m(!1),children:o.jsxs("div",{className:"custom-protocol-modal-content custom-protocol-modal-large",onClick:q=>q.stopPropagation(),children:[o.jsx("h3",{children:"Export Protocol JSON"}),o.jsx("p",{children:"Copy the JSON below to share or backup your protocol:"}),o.jsx("textarea",{value:y,readOnly:!0,rows:15,className:"export-textarea",onClick:q=>q.target.select()}),o.jsxs("div",{className:"custom-protocol-modal-actions",children:[o.jsx("button",{onClick:()=>m(!1),className:"btn btn-back",children:"Close"}),o.jsx("button",{onClick:O,className:"btn",children:"Copy to Clipboard"})]})]})}),_&&o.jsx("div",{className:"custom-protocol-modal-overlay",onClick:()=>w(!1),children:o.jsxs("div",{className:"custom-protocol-modal-content",onClick:q=>q.stopPropagation(),children:[o.jsx("h3",{children:"Delete Protocol"}),o.jsxs("p",{children:['Are you sure you want to delete "',N,'"?']}),o.jsx("p",{style:{color:"var(--danger-color)",fontSize:"0.9rem"},children:"This action cannot be undone."}),o.jsxs("div",{className:"custom-protocol-modal-actions",children:[o.jsx("button",{onClick:()=>w(!1),className:"btn btn-back",children:"Cancel"}),o.jsx("button",{onClick:E,className:"btn btn-delete",children:"Delete"})]})]})})]})},jb=({onBack:a})=>{const[n,l]=re.useState("list"),[c,i]=re.useState([]),[d,u]=re.useState(void 0);re.useEffect(()=>{h()},[]);const h=()=>{const b=Qo();i(b)},f=()=>{u(void 0),l("create")},m=b=>{console.log("handleEdit called with protocol:",b),u(b),l("edit"),console.log("View set to edit, editingProtocol:",b)},y=b=>{b_(b),Bl(),h(),l("list"),u(void 0)},v=b=>{vt(b),Bl(),h(),l("list"),u(void 0)},_=b=>{vt(b),Bl(),h()},w=()=>{l("list"),u(void 0)};return o.jsxs("div",{className:"custom-protocol-creator",children:[n==="list"&&o.jsx(j_,{protocols:c,onCreateNew:f,onEdit:m,onDelete:y,onImport:_,onBack:a}),(n==="create"||n==="edit")&&o.jsx(Eb,{onSave:v,onCancel:w,onDelete:y,initialProtocol:d})]})},kb={id:"spirit-1-example",protocol:"Spirit",value:1,top:"When you play cards face-up, they may be played without matching protocols.",middle:"Draw 2 cards.",bottom:'<span class="emphasis">Start:</span> Either discard 1 card or flip this card.',isFaceUp:!0,category:"Main 1",keywords:{}},Nb={id:"face-down-example",protocol:"Spirit",value:1,top:"",middle:"",bottom:"",isFaceUp:!1,category:"Main 1",keywords:{}},Rb=[{id:"opp-light-4",protocol:"Light",value:4,top:"",middle:"Your opponent reveals their hand.",bottom:"",isFaceUp:!0,category:"Main 1",keywords:{reveal:!0}}],Ab=[{id:"opp-spirit-3",protocol:"Spirit",value:3,top:"<div><span class='emphasis'>After you draw cards:</span> You may shift this card, even if this card is covered.</div>",middle:"",bottom:"",isFaceUp:!0,category:"Main 1",keywords:{shift:!0}},{id:"opp-spirit-2",protocol:"Spirit",value:2,top:"",middle:"You may flip 1 card.",bottom:"",isFaceUp:!0,category:"Main 1",keywords:{flip:!0}}],Tb=[{id:"opp-water-3",protocol:"Water",value:3,top:"",middle:"Return all cards with a value of 2 in 1 line.",bottom:"",isFaceUp:!0,category:"Main 1",keywords:{return:!0}}],Db=[{id:"player-darkness-5",protocol:"Darkness",value:5,top:"",middle:"You discard 1 card.",bottom:"",isFaceUp:!0,category:"Main 1",keywords:{discard:!0}},{id:"player-facedown-0",protocol:"Darkness",value:2,top:"",middle:"",bottom:"",isFaceUp:!1,category:"Main 1",keywords:{}}],Fb=[{id:"player-plague-1",protocol:"Plague",value:1,top:"<div><span class='emphasis'>After your opponent discards cards:</span> Draw 1 card.</div>",middle:"Your opponent discards 1 card.",bottom:"",isFaceUp:!0,category:"Main 1",keywords:{draw:!0,discard:!0}},{id:"player-plague-5",protocol:"Plague",value:5,top:"",middle:"You discard 1 card.",bottom:"",isFaceUp:!0,category:"Main 1",keywords:{discard:!0}},{id:"player-plague-4",protocol:"Plague",value:4,top:"",middle:"",bottom:"<div><span class='emphasis'>End:</span> Your opponent deletes 1 of their face-down cards. You may flip this card.</div>",isFaceUp:!0,category:"Main 1",keywords:{delete:!0,flip:!0}}],qb=[{id:"player-death-0",protocol:"Death",value:0,top:"",middle:"Delete 1 card from each other line.",bottom:"",isFaceUp:!0,category:"Main 1",keywords:{delete:!0}},{id:"player-facedown-3",protocol:"Death",value:2,top:"",middle:"",bottom:"",isFaceUp:!1,category:"Main 1",keywords:{}}],yo={opponent:["Light","Spirit","Water"],player:["Darkness","Plague","Death"],opponentCompiled:[!0,!1,!1],playerCompiled:[!1,!1,!1],opponentValues:[4,5,3],playerValues:[7,10,2]};function $b({onBack:a}){const n=[Rb,Ab,Tb],l=[Db,Fb,qb];return o.jsxs("div",{className:"screen rules-screen",children:[o.jsx(gc,{title:"GAME RULES",onBack:a}),o.jsxs("div",{className:"rules-content",children:[o.jsxs("section",{className:"rules-section",children:[o.jsx("h2",{className:"section-title",children:"Objective"}),o.jsxs("div",{className:"rules-text",children:[o.jsxs("p",{children:["You play as an artificial intelligence trying to ",o.jsx("span",{className:"emphasis",children:"compile your 3 protocols"}),". Play command cards on protocols and execute their effects. If you reach a total value of",o.jsx("span",{className:"emphasis",children:" at least 10"})," with your cards on a protocol and exceed the opponent's total value in the same line, you may compile that protocol."]}),o.jsx("p",{className:"rules-highlight",children:"The first player to compile all 3 protocols wins!"})]})]}),o.jsxs("section",{className:"rules-section field-overview-section",children:[o.jsx("h2",{className:"section-title",children:"The Field"}),o.jsx("div",{className:"field-intro",children:o.jsxs("p",{children:["The field consists of ",o.jsx("span",{className:"emphasis",children:"3 lines"}),", each passing through two opposing protocols. Both players place cards on their side of each line. The goal is to build up value in your stacks to reach the compile threshold."]})}),o.jsxs("div",{className:"demo-board-container",children:[o.jsxs("div",{className:"demo-board",children:[o.jsx("div",{className:"demo-side-label opponent-label",children:"Opponent"}),o.jsx("div",{className:"demo-player-side demo-opponent-side",children:o.jsx("div",{className:"demo-lanes",children:n.map((c,i)=>o.jsx("div",{className:`demo-lane ${yo.opponentCompiled[i]?"demo-lane-compiled":""}`,children:o.jsx("div",{className:"demo-lane-stack",children:c.map((d,u)=>o.jsx(kt,{card:d,isFaceUp:d.isFaceUp,style:{"--i":u},faceDownValue:2},d.id))})},`opp-lane-${i}`))})}),o.jsxs("div",{className:"demo-protocol-bars-container",children:[o.jsx("div",{className:"demo-protocol-bar demo-opponent-bar",children:yo.opponent.map((c,i)=>o.jsxs("div",{className:`demo-protocol-display ${yo.opponentCompiled[i]?"compiled":""}`,children:[o.jsx("span",{className:"demo-protocol-name",children:c}),o.jsx("span",{className:"demo-protocol-value",children:yo.opponentValues[i]})]},`opp-proto-${i}`))}),o.jsx("div",{className:"demo-protocol-bar demo-player-bar",children:yo.player.map((c,i)=>o.jsxs("div",{className:`demo-protocol-display ${yo.playerCompiled[i]?"compiled":""}`,children:[o.jsx("span",{className:"demo-protocol-name",children:c}),o.jsx("span",{className:"demo-protocol-value",children:yo.playerValues[i]})]},`player-proto-${i}`))})]}),o.jsx("div",{className:"demo-player-side",children:o.jsx("div",{className:"demo-lanes",children:l.map((c,i)=>o.jsx("div",{className:`demo-lane ${yo.playerCompiled[i]?"demo-lane-compiled":""} ${i===1?"demo-lane-compilable":""}`,children:o.jsx("div",{className:"demo-lane-stack",children:c.map((d,u)=>o.jsx(kt,{card:d,isFaceUp:d.isFaceUp,style:{"--i":u},faceDownValue:2},d.id))})},`player-lane-${i}`))})}),o.jsx("div",{className:"demo-side-label player-label",children:"You"})]}),o.jsxs("div",{className:"demo-board-annotations",children:[o.jsxs("div",{className:"demo-annotation compiled-annotation",children:[o.jsx("div",{className:"demo-annotation-marker compiled-marker",children:"1"}),o.jsxs("div",{className:"demo-annotation-content",children:[o.jsx("strong",{children:"Compiled Protocol"}),o.jsx("p",{children:"Light has been compiled by the opponent! The protocol bar glows cyan."})]})]}),o.jsxs("div",{className:"demo-annotation compilable-annotation",children:[o.jsx("div",{className:"demo-annotation-marker compilable-marker",children:"2"}),o.jsxs("div",{className:"demo-annotation-content",children:[o.jsx("strong",{children:"Ready to Compile!"}),o.jsx("p",{children:"Plague has value 10 (1+5+4) which is 10 and higher than opponent's Spirit at 5. This protocol can be compiled!"})]})]}),o.jsxs("div",{className:"demo-annotation inprogress-annotation",children:[o.jsx("div",{className:"demo-annotation-marker inprogress-marker",children:"3"}),o.jsxs("div",{className:"demo-annotation-content",children:[o.jsx("strong",{children:"In Progress"}),o.jsx("p",{children:"Death/Water lanes are still building up. Keep playing cards to reach the compile threshold of 10!"})]})]}),o.jsxs("div",{className:"demo-annotation topbox-annotation",children:[o.jsx("div",{className:"demo-annotation-marker topbox-marker",children:"4"}),o.jsxs("div",{className:"demo-annotation-content",children:[o.jsx("strong",{children:"Top Effect Always Visible"}),o.jsx("p",{children:"See Plague-1's top effect? It stays active even when covered! Top effects are always visible and active on face-up cards."})]})]})]})]}),o.jsxs("div",{className:"field-legend",children:[o.jsxs("div",{className:"legend-item",children:[o.jsx("div",{className:"legend-swatch legend-compiled"}),o.jsx("span",{children:"Compiled Protocol"})]}),o.jsxs("div",{className:"legend-item",children:[o.jsx("div",{className:"legend-swatch legend-compilable"}),o.jsx("span",{children:"Ready to Compile (10 value & higher than opponent)"})]}),o.jsxs("div",{className:"legend-item",children:[o.jsx("div",{className:"legend-swatch legend-facedown"}),o.jsx("span",{children:"Face-down Card (base value: 2)"})]})]})]}),o.jsxs("section",{className:"rules-section card-anatomy-section",children:[o.jsx("h2",{className:"section-title",children:"Card Anatomy"}),o.jsxs("div",{className:"card-anatomy-layout",children:[o.jsx("div",{className:"card-anatomy-display",children:o.jsxs("div",{className:"anatomy-card-wrapper",children:[o.jsx(kt,{card:kb,isFaceUp:!0}),o.jsxs("div",{className:"anatomy-annotation annotation-protocol",children:[o.jsx("div",{className:"annotation-line annotation-line-left"}),o.jsxs("div",{className:"annotation-label",children:[o.jsx("span",{className:"annotation-letter",children:"A"}),o.jsx("span",{className:"annotation-text",children:"Protocol"})]})]}),o.jsxs("div",{className:"anatomy-annotation annotation-value",children:[o.jsx("div",{className:"annotation-line annotation-line-right"}),o.jsxs("div",{className:"annotation-label",children:[o.jsx("span",{className:"annotation-letter",children:"B"}),o.jsx("span",{className:"annotation-text",children:"Value"})]})]}),o.jsxs("div",{className:"anatomy-annotation annotation-top",children:[o.jsx("div",{className:"annotation-line annotation-line-right"}),o.jsxs("div",{className:"annotation-label",children:[o.jsx("span",{className:"annotation-letter",children:"C"}),o.jsx("span",{className:"annotation-text",children:"Top Effect"})]})]}),o.jsxs("div",{className:"anatomy-annotation annotation-middle",children:[o.jsx("div",{className:"annotation-line annotation-line-right"}),o.jsxs("div",{className:"annotation-label",children:[o.jsx("span",{className:"annotation-letter",children:"D"}),o.jsx("span",{className:"annotation-text",children:"Middle Effect"})]})]}),o.jsxs("div",{className:"anatomy-annotation annotation-bottom",children:[o.jsx("div",{className:"annotation-line annotation-line-right"}),o.jsxs("div",{className:"annotation-label",children:[o.jsx("span",{className:"annotation-letter",children:"E"}),o.jsx("span",{className:"annotation-text",children:"Bottom Effect"})]})]})]})}),o.jsxs("div",{className:"card-anatomy-descriptions",children:[o.jsxs("div",{className:"anatomy-item",children:[o.jsx("span",{className:"anatomy-letter",children:"A"}),o.jsxs("div",{className:"anatomy-desc",children:[o.jsx("strong",{children:"Protocol Indicator"}),o.jsx("p",{children:"Dictates which line a card can be played face-up in. Cards must match the protocol of that line."})]})]}),o.jsxs("div",{className:"anatomy-item",children:[o.jsx("span",{className:"anatomy-letter",children:"B"}),o.jsxs("div",{className:"anatomy-desc",children:[o.jsx("strong",{children:"Value"}),o.jsx("p",{children:"The value added to the total value of a stack. Higher values help you reach the compile threshold of 10."})]})]}),o.jsxs("div",{className:"anatomy-item anatomy-item-highlight",children:[o.jsx("span",{className:"anatomy-letter",children:"C"}),o.jsxs("div",{className:"anatomy-desc",children:[o.jsx("strong",{children:"Top Command - Persistent"}),o.jsxs("p",{children:["While this card is face-up, this passive text is ",o.jsx("span",{className:"emphasis",children:"always active"}),", even when covered by other cards."]})]})]}),o.jsxs("div",{className:"anatomy-item anatomy-item-highlight",children:[o.jsx("span",{className:"anatomy-letter",children:"D"}),o.jsxs("div",{className:"anatomy-desc",children:[o.jsx("strong",{children:"Middle Command - Immediate"}),o.jsx("p",{children:"Resolve this active text immediately when the card is played, flipped face-up, or uncovered."})]})]}),o.jsxs("div",{className:"anatomy-item anatomy-item-highlight",children:[o.jsx("span",{className:"anatomy-letter",children:"E"}),o.jsxs("div",{className:"anatomy-desc",children:[o.jsx("strong",{children:"Bottom Command - Auxiliary"}),o.jsxs("p",{children:['This passive text (often triggered effects like "Start:" or "End:") is only active when the card is ',o.jsx("span",{className:"emphasis",children:"uncovered"}),"."]})]})]})]})]})]}),o.jsxs("section",{className:"rules-section face-down-section",children:[o.jsx("h2",{className:"section-title",children:"Face-Down Cards"}),o.jsxs("div",{className:"face-down-layout",children:[o.jsx("div",{className:"face-down-card-wrapper",children:o.jsx(kt,{card:Nb,isFaceUp:!1,faceDownValue:2})}),o.jsxs("div",{className:"face-down-description",children:[o.jsxs("p",{children:["Cards can be played ",o.jsx("span",{className:"emphasis",children:"face-down"})," into any line, regardless of protocol matching."]}),o.jsxs("ul",{children:[o.jsxs("li",{children:["Face-down cards have a ",o.jsx("span",{className:"emphasis",children:"base value of 2"})]}),o.jsx("li",{children:"No effects are active while face-down"}),o.jsx("li",{children:"Can be flipped face-up by card effects"}),o.jsx("li",{children:"When flipped, the middle effect triggers"}),o.jsx("li",{children:"Some cards modify face-down values (e.g., Darkness-2)"})]})]})]})]}),o.jsxs("section",{className:"rules-section",children:[o.jsx("h2",{className:"section-title",children:"Turn Order"}),o.jsxs("div",{className:"turn-order-grid",children:[o.jsxs("div",{className:"turn-phase",children:[o.jsx("span",{className:"phase-number",children:"1"}),o.jsxs("div",{className:"phase-content",children:[o.jsx("strong",{children:"Start Phase"}),o.jsx("p",{children:'Resolve all visible "Start" effects of your face-up command cards.'})]})]}),o.jsxs("div",{className:"turn-phase",children:[o.jsx("span",{className:"phase-number",children:"2"}),o.jsxs("div",{className:"phase-content",children:[o.jsx("strong",{children:"Check Control"}),o.jsx("p",{children:"If your total value is higher than opponent's in at least 2 lines, take the control component."})]})]}),o.jsxs("div",{className:"turn-phase",children:[o.jsx("span",{className:"phase-number",children:"3"}),o.jsxs("div",{className:"phase-content",children:[o.jsx("strong",{children:"Check Compile"}),o.jsx("p",{children:"If you can compile (10+ value and higher than opponent), you must compile one protocol."})]})]}),o.jsxs("div",{className:"turn-phase",children:[o.jsx("span",{className:"phase-number",children:"4"}),o.jsxs("div",{className:"phase-content",children:[o.jsx("strong",{children:"Action"}),o.jsx("p",{children:"Play 1 card from hand OR refresh your hand (draw until you have 5 cards)."})]})]}),o.jsxs("div",{className:"turn-phase",children:[o.jsx("span",{className:"phase-number",children:"5"}),o.jsxs("div",{className:"phase-content",children:[o.jsx("strong",{children:"Check Cache"}),o.jsx("p",{children:"If you have more than 5 cards, discard down to 5."})]})]}),o.jsxs("div",{className:"turn-phase",children:[o.jsx("span",{className:"phase-number",children:"6"}),o.jsxs("div",{className:"phase-content",children:[o.jsx("strong",{children:"End Phase"}),o.jsx("p",{children:'Resolve all visible "End" effects of your face-up command cards.'})]})]})]})]}),o.jsxs("section",{className:"rules-section glossary-section",children:[o.jsx("h2",{className:"section-title",children:"Glossary"}),o.jsxs("div",{className:"glossary-grid",children:[o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Compile"}),o.jsx("p",{children:'Delete all cards in a line on both sides and flip your protocol to "Compiled".'})]}),o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Covered"}),o.jsx("p",{children:"A card with another card on top of it. Only top effects remain active."})]}),o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Uncovered"}),o.jsx("p",{children:"The topmost card in a stack, furthest from the protocol."})]}),o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Delete"}),o.jsx("p",{children:"Move a card from the field to the trash."})]}),o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Discard"}),o.jsx("p",{children:"Move a card from hand to the owner's trash."})]}),o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Flip"}),o.jsx("p",{children:"Change a card from face-down to face-up, or vice versa."})]}),o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Shift"}),o.jsx("p",{children:"Move a card to another line on the same side of the field."})]}),o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Return"}),o.jsx("p",{children:"Move a card from the field to its owner's hand."})]}),o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Reveal"}),o.jsx("p",{children:"Show hidden information publicly, then return it to its previous state."})]}),o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Refresh"}),o.jsx("p",{children:"Draw cards until you have 5 cards in hand."})]}),o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Line"}),o.jsx("p",{children:"The area passing through two opposing protocols. The field has 3 lines."})]}),o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Stack"}),o.jsx("p",{children:"The cards in a line on one player's side."})]})]})]})]})]})}function Ib(){const[a,n]=re.useState("MainMenu"),[l,c]=re.useState([]),[i,d]=re.useState([]),[u,h]=re.useState(null),[f,m]=re.useState("easy"),[y,v]=re.useState(null),[_,w]=re.useState(!0),[b,N]=re.useState("player");re.useEffect(()=>{IC()},[]);const S=re.useCallback(()=>{n("MainMenu"),c([]),d([]),h(null),v(null)},[]);re.useEffect(()=>{const R=F=>{F.key==="Escape"&&S()};return window.addEventListener("keydown",R),()=>{window.removeEventListener("keydown",R)}},[S]);const k=re.useCallback((R,F)=>{c(R),d(F),h(null),v(null),N("player"),n("GameScreen")},[]),C=re.useCallback((R,F)=>{h(R),v(F),n("ResultsScreen")},[]),j=()=>{switch(a){case"MainMenu":return o.jsx(bh,{onNavigate:R=>n(R),difficulty:f,setDifficulty:m,useControl:_,onUseControlChange:w});case"ProtocolSelection":return o.jsx(R_,{onBack:S,onStartGame:k});case"GameScreen":return o.jsx(lb,{onBack:S,onEndGame:C,playerProtocols:l,opponentProtocols:i,difficulty:f,useControlMechanic:_,startingPlayer:b});case"ResultsScreen":return o.jsx(sb,{onPlayAgain:S,winner:u,finalState:y,difficulty:f});case"CardLibrary":return o.jsx(cb,{onBack:S});case"Statistics":return o.jsx(ib,{onBack:S});case"CustomProtocols":return o.jsx(jb,{onBack:S});case"Rules":return o.jsx($b,{onBack:S});default:return o.jsx(bh,{onNavigate:R=>n(R),difficulty:f,setDifficulty:m,useControl:_,onUseControlChange:w})}};return o.jsx(o.Fragment,{children:j()})}const Ub=document.getElementById("root"),Pb=g_.createRoot(Ub);Pb.render(o.jsx(Ib,{}));
