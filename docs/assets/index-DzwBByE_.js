(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const d of s)if(d.type==="childList")for(const u of d.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&i(u)}).observe(document,{childList:!0,subtree:!0});function r(s){const d={};return s.integrity&&(d.integrity=s.integrity),s.referrerPolicy&&(d.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?d.credentials="include":s.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function i(s){if(s.ep)return;s.ep=!0;const d=r(s);fetch(s.href,d)}})();var Rd={exports:{}},Ql={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Qh;function E0(){if(Qh)return Ql;Qh=1;var t=Symbol.for("react.transitional.element"),n=Symbol.for("react.fragment");function r(i,s,d){var u=null;if(d!==void 0&&(u=""+d),s.key!==void 0&&(u=""+s.key),"key"in s){d={};for(var p in s)p!=="key"&&(d[p]=s[p])}else d=s;return s=d.ref,{$$typeof:t,type:i,key:u,ref:s!==void 0?s:null,props:d}}return Ql.Fragment=n,Ql.jsx=r,Ql.jsxs=r,Ql}var Xh;function j0(){return Xh||(Xh=1,Rd.exports=E0()),Rd.exports}var o=j0(),Fd={exports:{}},Xl={},Dd={exports:{}},$d={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Zh;function k0(){return Zh||(Zh=1,(function(t){function n(T,q){var P=T.length;T.push(q);e:for(;0<P;){var Z=P-1>>>1,G=T[Z];if(0<s(G,q))T[Z]=q,T[P]=G,P=Z;else break e}}function r(T){return T.length===0?null:T[0]}function i(T){if(T.length===0)return null;var q=T[0],P=T.pop();if(P!==q){T[0]=P;e:for(var Z=0,G=T.length,A=G>>>1;Z<A;){var W=2*(Z+1)-1,J=T[W],Q=W+1,ee=T[Q];if(0>s(J,P))Q<G&&0>s(ee,J)?(T[Z]=ee,T[Q]=P,Z=Q):(T[Z]=J,T[W]=P,Z=W);else if(Q<G&&0>s(ee,P))T[Z]=ee,T[Q]=P,Z=Q;else break e}}return q}function s(T,q){var P=T.sortIndex-q.sortIndex;return P!==0?P:T.id-q.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var d=performance;t.unstable_now=function(){return d.now()}}else{var u=Date,p=u.now();t.unstable_now=function(){return u.now()-p}}var f=[],h=[],w=1,g=null,y=3,m=!1,x=!1,S=!1,E=!1,j=typeof setTimeout=="function"?setTimeout:null,b=typeof clearTimeout=="function"?clearTimeout:null,k=typeof setImmediate<"u"?setImmediate:null;function N(T){for(var q=r(h);q!==null;){if(q.callback===null)i(h);else if(q.startTime<=T)i(h),q.sortIndex=q.expirationTime,n(f,q);else break;q=r(h)}}function U(T){if(S=!1,N(T),!x)if(r(f)!==null)x=!0,V||(V=!0,B());else{var q=r(h);q!==null&&L(U,q.startTime-T)}}var V=!1,R=-1,O=5,X=-1;function M(){return E?!0:!(t.unstable_now()-X<O)}function $(){if(E=!1,V){var T=t.unstable_now();X=T;var q=!0;try{e:{x=!1,S&&(S=!1,b(R),R=-1),m=!0;var P=y;try{t:{for(N(T),g=r(f);g!==null&&!(g.expirationTime>T&&M());){var Z=g.callback;if(typeof Z=="function"){g.callback=null,y=g.priorityLevel;var G=Z(g.expirationTime<=T);if(T=t.unstable_now(),typeof G=="function"){g.callback=G,N(T),q=!0;break t}g===r(f)&&i(f),N(T)}else i(f);g=r(f)}if(g!==null)q=!0;else{var A=r(h);A!==null&&L(U,A.startTime-T),q=!1}}break e}finally{g=null,y=P,m=!1}q=void 0}}finally{q?B():V=!1}}}var B;if(typeof k=="function")B=function(){k($)};else if(typeof MessageChannel<"u"){var I=new MessageChannel,D=I.port2;I.port1.onmessage=$,B=function(){D.postMessage(null)}}else B=function(){j($,0)};function L(T,q){R=j(function(){T(t.unstable_now())},q)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(T){T.callback=null},t.unstable_forceFrameRate=function(T){0>T||125<T?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):O=0<T?Math.floor(1e3/T):5},t.unstable_getCurrentPriorityLevel=function(){return y},t.unstable_next=function(T){switch(y){case 1:case 2:case 3:var q=3;break;default:q=y}var P=y;y=q;try{return T()}finally{y=P}},t.unstable_requestPaint=function(){E=!0},t.unstable_runWithPriority=function(T,q){switch(T){case 1:case 2:case 3:case 4:case 5:break;default:T=3}var P=y;y=T;try{return q()}finally{y=P}},t.unstable_scheduleCallback=function(T,q,P){var Z=t.unstable_now();switch(typeof P=="object"&&P!==null?(P=P.delay,P=typeof P=="number"&&0<P?Z+P:Z):P=Z,T){case 1:var G=-1;break;case 2:G=250;break;case 5:G=1073741823;break;case 4:G=1e4;break;default:G=5e3}return G=P+G,T={id:w++,callback:q,priorityLevel:T,startTime:P,expirationTime:G,sortIndex:-1},P>Z?(T.sortIndex=P,n(h,T),r(f)===null&&T===r(h)&&(S?(b(R),R=-1):S=!0,L(U,P-Z))):(T.sortIndex=G,n(f,T),x||m||(x=!0,V||(V=!0,B()))),T},t.unstable_shouldYield=M,t.unstable_wrapCallback=function(T){var q=y;return function(){var P=y;y=q;try{return T.apply(this,arguments)}finally{y=P}}}})($d)),$d}var Kh;function T0(){return Kh||(Kh=1,Dd.exports=k0()),Dd.exports}var qd={exports:{}},at={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Jh;function N0(){if(Jh)return at;Jh=1;var t=Symbol.for("react.transitional.element"),n=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),d=Symbol.for("react.consumer"),u=Symbol.for("react.context"),p=Symbol.for("react.forward_ref"),f=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),w=Symbol.for("react.lazy"),g=Symbol.for("react.activity"),y=Symbol.iterator;function m(A){return A===null||typeof A!="object"?null:(A=y&&A[y]||A["@@iterator"],typeof A=="function"?A:null)}var x={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},S=Object.assign,E={};function j(A,W,J){this.props=A,this.context=W,this.refs=E,this.updater=J||x}j.prototype.isReactComponent={},j.prototype.setState=function(A,W){if(typeof A!="object"&&typeof A!="function"&&A!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,A,W,"setState")},j.prototype.forceUpdate=function(A){this.updater.enqueueForceUpdate(this,A,"forceUpdate")};function b(){}b.prototype=j.prototype;function k(A,W,J){this.props=A,this.context=W,this.refs=E,this.updater=J||x}var N=k.prototype=new b;N.constructor=k,S(N,j.prototype),N.isPureReactComponent=!0;var U=Array.isArray;function V(){}var R={H:null,A:null,T:null,S:null},O=Object.prototype.hasOwnProperty;function X(A,W,J){var Q=J.ref;return{$$typeof:t,type:A,key:W,ref:Q!==void 0?Q:null,props:J}}function M(A,W){return X(A.type,W,A.props)}function $(A){return typeof A=="object"&&A!==null&&A.$$typeof===t}function B(A){var W={"=":"=0",":":"=2"};return"$"+A.replace(/[=:]/g,function(J){return W[J]})}var I=/\/+/g;function D(A,W){return typeof A=="object"&&A!==null&&A.key!=null?B(""+A.key):W.toString(36)}function L(A){switch(A.status){case"fulfilled":return A.value;case"rejected":throw A.reason;default:switch(typeof A.status=="string"?A.then(V,V):(A.status="pending",A.then(function(W){A.status==="pending"&&(A.status="fulfilled",A.value=W)},function(W){A.status==="pending"&&(A.status="rejected",A.reason=W)})),A.status){case"fulfilled":return A.value;case"rejected":throw A.reason}}throw A}function T(A,W,J,Q,ee){var oe=typeof A;(oe==="undefined"||oe==="boolean")&&(A=null);var me=!1;if(A===null)me=!0;else switch(oe){case"bigint":case"string":case"number":me=!0;break;case"object":switch(A.$$typeof){case t:case n:me=!0;break;case w:return me=A._init,T(me(A._payload),W,J,Q,ee)}}if(me)return ee=ee(A),me=Q===""?"."+D(A,0):Q,U(ee)?(J="",me!=null&&(J=me.replace(I,"$&/")+"/"),T(ee,W,J,"",function(ie){return ie})):ee!=null&&($(ee)&&(ee=M(ee,J+(ee.key==null||A&&A.key===ee.key?"":(""+ee.key).replace(I,"$&/")+"/")+me)),W.push(ee)),1;me=0;var ke=Q===""?".":Q+":";if(U(A))for(var xe=0;xe<A.length;xe++)Q=A[xe],oe=ke+D(Q,xe),me+=T(Q,W,J,oe,ee);else if(xe=m(A),typeof xe=="function")for(A=xe.call(A),xe=0;!(Q=A.next()).done;)Q=Q.value,oe=ke+D(Q,xe++),me+=T(Q,W,J,oe,ee);else if(oe==="object"){if(typeof A.then=="function")return T(L(A),W,J,Q,ee);throw W=String(A),Error("Objects are not valid as a React child (found: "+(W==="[object Object]"?"object with keys {"+Object.keys(A).join(", ")+"}":W)+"). If you meant to render a collection of children, use an array instead.")}return me}function q(A,W,J){if(A==null)return A;var Q=[],ee=0;return T(A,Q,"","",function(oe){return W.call(J,oe,ee++)}),Q}function P(A){if(A._status===-1){var W=A._result;W=W(),W.then(function(J){(A._status===0||A._status===-1)&&(A._status=1,A._result=J)},function(J){(A._status===0||A._status===-1)&&(A._status=2,A._result=J)}),A._status===-1&&(A._status=0,A._result=W)}if(A._status===1)return A._result.default;throw A._result}var Z=typeof reportError=="function"?reportError:function(A){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var W=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof A=="object"&&A!==null&&typeof A.message=="string"?String(A.message):String(A),error:A});if(!window.dispatchEvent(W))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",A);return}console.error(A)},G={map:q,forEach:function(A,W,J){q(A,function(){W.apply(this,arguments)},J)},count:function(A){var W=0;return q(A,function(){W++}),W},toArray:function(A){return q(A,function(W){return W})||[]},only:function(A){if(!$(A))throw Error("React.Children.only expected to receive a single React element child.");return A}};return at.Activity=g,at.Children=G,at.Component=j,at.Fragment=r,at.Profiler=s,at.PureComponent=k,at.StrictMode=i,at.Suspense=f,at.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=R,at.__COMPILER_RUNTIME={__proto__:null,c:function(A){return R.H.useMemoCache(A)}},at.cache=function(A){return function(){return A.apply(null,arguments)}},at.cacheSignal=function(){return null},at.cloneElement=function(A,W,J){if(A==null)throw Error("The argument must be a React element, but you passed "+A+".");var Q=S({},A.props),ee=A.key;if(W!=null)for(oe in W.key!==void 0&&(ee=""+W.key),W)!O.call(W,oe)||oe==="key"||oe==="__self"||oe==="__source"||oe==="ref"&&W.ref===void 0||(Q[oe]=W[oe]);var oe=arguments.length-2;if(oe===1)Q.children=J;else if(1<oe){for(var me=Array(oe),ke=0;ke<oe;ke++)me[ke]=arguments[ke+2];Q.children=me}return X(A.type,ee,Q)},at.createContext=function(A){return A={$$typeof:u,_currentValue:A,_currentValue2:A,_threadCount:0,Provider:null,Consumer:null},A.Provider=A,A.Consumer={$$typeof:d,_context:A},A},at.createElement=function(A,W,J){var Q,ee={},oe=null;if(W!=null)for(Q in W.key!==void 0&&(oe=""+W.key),W)O.call(W,Q)&&Q!=="key"&&Q!=="__self"&&Q!=="__source"&&(ee[Q]=W[Q]);var me=arguments.length-2;if(me===1)ee.children=J;else if(1<me){for(var ke=Array(me),xe=0;xe<me;xe++)ke[xe]=arguments[xe+2];ee.children=ke}if(A&&A.defaultProps)for(Q in me=A.defaultProps,me)ee[Q]===void 0&&(ee[Q]=me[Q]);return X(A,oe,ee)},at.createRef=function(){return{current:null}},at.forwardRef=function(A){return{$$typeof:p,render:A}},at.isValidElement=$,at.lazy=function(A){return{$$typeof:w,_payload:{_status:-1,_result:A},_init:P}},at.memo=function(A,W){return{$$typeof:h,type:A,compare:W===void 0?null:W}},at.startTransition=function(A){var W=R.T,J={};R.T=J;try{var Q=A(),ee=R.S;ee!==null&&ee(J,Q),typeof Q=="object"&&Q!==null&&typeof Q.then=="function"&&Q.then(V,Z)}catch(oe){Z(oe)}finally{W!==null&&J.types!==null&&(W.types=J.types),R.T=W}},at.unstable_useCacheRefresh=function(){return R.H.useCacheRefresh()},at.use=function(A){return R.H.use(A)},at.useActionState=function(A,W,J){return R.H.useActionState(A,W,J)},at.useCallback=function(A,W){return R.H.useCallback(A,W)},at.useContext=function(A){return R.H.useContext(A)},at.useDebugValue=function(){},at.useDeferredValue=function(A,W){return R.H.useDeferredValue(A,W)},at.useEffect=function(A,W){return R.H.useEffect(A,W)},at.useEffectEvent=function(A){return R.H.useEffectEvent(A)},at.useId=function(){return R.H.useId()},at.useImperativeHandle=function(A,W,J){return R.H.useImperativeHandle(A,W,J)},at.useInsertionEffect=function(A,W){return R.H.useInsertionEffect(A,W)},at.useLayoutEffect=function(A,W){return R.H.useLayoutEffect(A,W)},at.useMemo=function(A,W){return R.H.useMemo(A,W)},at.useOptimistic=function(A,W){return R.H.useOptimistic(A,W)},at.useReducer=function(A,W,J){return R.H.useReducer(A,W,J)},at.useRef=function(A){return R.H.useRef(A)},at.useState=function(A){return R.H.useState(A)},at.useSyncExternalStore=function(A,W,J){return R.H.useSyncExternalStore(A,W,J)},at.useTransition=function(){return R.H.useTransition()},at.version="19.2.3",at}var em;function tu(){return em||(em=1,qd.exports=N0()),qd.exports}var Id={exports:{}},vn={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var tm;function A0(){if(tm)return vn;tm=1;var t=tu();function n(f){var h="https://react.dev/errors/"+f;if(1<arguments.length){h+="?args[]="+encodeURIComponent(arguments[1]);for(var w=2;w<arguments.length;w++)h+="&args[]="+encodeURIComponent(arguments[w])}return"Minified React error #"+f+"; visit "+h+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function r(){}var i={d:{f:r,r:function(){throw Error(n(522))},D:r,C:r,L:r,m:r,X:r,S:r,M:r},p:0,findDOMNode:null},s=Symbol.for("react.portal");function d(f,h,w){var g=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:s,key:g==null?null:""+g,children:f,containerInfo:h,implementation:w}}var u=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function p(f,h){if(f==="font")return"";if(typeof h=="string")return h==="use-credentials"?h:""}return vn.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=i,vn.createPortal=function(f,h){var w=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11)throw Error(n(299));return d(f,h,null,w)},vn.flushSync=function(f){var h=u.T,w=i.p;try{if(u.T=null,i.p=2,f)return f()}finally{u.T=h,i.p=w,i.d.f()}},vn.preconnect=function(f,h){typeof f=="string"&&(h?(h=h.crossOrigin,h=typeof h=="string"?h==="use-credentials"?h:"":void 0):h=null,i.d.C(f,h))},vn.prefetchDNS=function(f){typeof f=="string"&&i.d.D(f)},vn.preinit=function(f,h){if(typeof f=="string"&&h&&typeof h.as=="string"){var w=h.as,g=p(w,h.crossOrigin),y=typeof h.integrity=="string"?h.integrity:void 0,m=typeof h.fetchPriority=="string"?h.fetchPriority:void 0;w==="style"?i.d.S(f,typeof h.precedence=="string"?h.precedence:void 0,{crossOrigin:g,integrity:y,fetchPriority:m}):w==="script"&&i.d.X(f,{crossOrigin:g,integrity:y,fetchPriority:m,nonce:typeof h.nonce=="string"?h.nonce:void 0})}},vn.preinitModule=function(f,h){if(typeof f=="string")if(typeof h=="object"&&h!==null){if(h.as==null||h.as==="script"){var w=p(h.as,h.crossOrigin);i.d.M(f,{crossOrigin:w,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0})}}else h==null&&i.d.M(f)},vn.preload=function(f,h){if(typeof f=="string"&&typeof h=="object"&&h!==null&&typeof h.as=="string"){var w=h.as,g=p(w,h.crossOrigin);i.d.L(f,w,{crossOrigin:g,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0,type:typeof h.type=="string"?h.type:void 0,fetchPriority:typeof h.fetchPriority=="string"?h.fetchPriority:void 0,referrerPolicy:typeof h.referrerPolicy=="string"?h.referrerPolicy:void 0,imageSrcSet:typeof h.imageSrcSet=="string"?h.imageSrcSet:void 0,imageSizes:typeof h.imageSizes=="string"?h.imageSizes:void 0,media:typeof h.media=="string"?h.media:void 0})}},vn.preloadModule=function(f,h){if(typeof f=="string")if(h){var w=p(h.as,h.crossOrigin);i.d.m(f,{as:typeof h.as=="string"&&h.as!=="script"?h.as:void 0,crossOrigin:w,integrity:typeof h.integrity=="string"?h.integrity:void 0})}else i.d.m(f)},vn.requestFormReset=function(f){i.d.r(f)},vn.unstable_batchedUpdates=function(f,h){return f(h)},vn.useFormState=function(f,h,w){return u.H.useFormState(f,h,w)},vn.useFormStatus=function(){return u.H.useHostTransitionStatus()},vn.version="19.2.3",vn}var nm;function R0(){if(nm)return Id.exports;nm=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(n){console.error(n)}}return t(),Id.exports=A0(),Id.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var am;function F0(){if(am)return Xl;am=1;var t=T0(),n=tu(),r=R0();function i(e){var a="https://react.dev/errors/"+e;if(1<arguments.length){a+="?args[]="+encodeURIComponent(arguments[1]);for(var l=2;l<arguments.length;l++)a+="&args[]="+encodeURIComponent(arguments[l])}return"Minified React error #"+e+"; visit "+a+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function d(e){var a=e,l=e;if(e.alternate)for(;a.return;)a=a.return;else{e=a;do a=e,(a.flags&4098)!==0&&(l=a.return),e=a.return;while(e)}return a.tag===3?l:null}function u(e){if(e.tag===13){var a=e.memoizedState;if(a===null&&(e=e.alternate,e!==null&&(a=e.memoizedState)),a!==null)return a.dehydrated}return null}function p(e){if(e.tag===31){var a=e.memoizedState;if(a===null&&(e=e.alternate,e!==null&&(a=e.memoizedState)),a!==null)return a.dehydrated}return null}function f(e){if(d(e)!==e)throw Error(i(188))}function h(e){var a=e.alternate;if(!a){if(a=d(e),a===null)throw Error(i(188));return a!==e?null:e}for(var l=e,c=a;;){var v=l.return;if(v===null)break;var C=v.alternate;if(C===null){if(c=v.return,c!==null){l=c;continue}break}if(v.child===C.child){for(C=v.child;C;){if(C===l)return f(v),e;if(C===c)return f(v),a;C=C.sibling}throw Error(i(188))}if(l.return!==c.return)l=v,c=C;else{for(var F=!1,Y=v.child;Y;){if(Y===l){F=!0,l=v,c=C;break}if(Y===c){F=!0,c=v,l=C;break}Y=Y.sibling}if(!F){for(Y=C.child;Y;){if(Y===l){F=!0,l=C,c=v;break}if(Y===c){F=!0,c=C,l=v;break}Y=Y.sibling}if(!F)throw Error(i(189))}}if(l.alternate!==c)throw Error(i(190))}if(l.tag!==3)throw Error(i(188));return l.stateNode.current===l?e:a}function w(e){var a=e.tag;if(a===5||a===26||a===27||a===6)return e;for(e=e.child;e!==null;){if(a=w(e),a!==null)return a;e=e.sibling}return null}var g=Object.assign,y=Symbol.for("react.element"),m=Symbol.for("react.transitional.element"),x=Symbol.for("react.portal"),S=Symbol.for("react.fragment"),E=Symbol.for("react.strict_mode"),j=Symbol.for("react.profiler"),b=Symbol.for("react.consumer"),k=Symbol.for("react.context"),N=Symbol.for("react.forward_ref"),U=Symbol.for("react.suspense"),V=Symbol.for("react.suspense_list"),R=Symbol.for("react.memo"),O=Symbol.for("react.lazy"),X=Symbol.for("react.activity"),M=Symbol.for("react.memo_cache_sentinel"),$=Symbol.iterator;function B(e){return e===null||typeof e!="object"?null:(e=$&&e[$]||e["@@iterator"],typeof e=="function"?e:null)}var I=Symbol.for("react.client.reference");function D(e){if(e==null)return null;if(typeof e=="function")return e.$$typeof===I?null:e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case S:return"Fragment";case j:return"Profiler";case E:return"StrictMode";case U:return"Suspense";case V:return"SuspenseList";case X:return"Activity"}if(typeof e=="object")switch(e.$$typeof){case x:return"Portal";case k:return e.displayName||"Context";case b:return(e._context.displayName||"Context")+".Consumer";case N:var a=e.render;return e=e.displayName,e||(e=a.displayName||a.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case R:return a=e.displayName||null,a!==null?a:D(e.type)||"Memo";case O:a=e._payload,e=e._init;try{return D(e(a))}catch{}}return null}var L=Array.isArray,T=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,q=r.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,P={pending:!1,data:null,method:null,action:null},Z=[],G=-1;function A(e){return{current:e}}function W(e){0>G||(e.current=Z[G],Z[G]=null,G--)}function J(e,a){G++,Z[G]=e.current,e.current=a}var Q=A(null),ee=A(null),oe=A(null),me=A(null);function ke(e,a){switch(J(oe,a),J(ee,e),J(Q,null),a.nodeType){case 9:case 11:e=(e=a.documentElement)&&(e=e.namespaceURI)?vh(e):0;break;default:if(e=a.tagName,a=a.namespaceURI)a=vh(a),e=_h(a,e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}W(Q),J(Q,e)}function xe(){W(Q),W(ee),W(oe)}function ie(e){e.memoizedState!==null&&J(me,e);var a=Q.current,l=_h(a,e.type);a!==l&&(J(ee,e),J(Q,l))}function K(e){ee.current===e&&(W(Q),W(ee)),me.current===e&&(W(me),Bl._currentValue=P)}var z,le;function ne(e){if(z===void 0)try{throw Error()}catch(l){var a=l.stack.trim().match(/\n( *(at )?)/);z=a&&a[1]||"",le=-1<l.stack.indexOf(`
    at`)?" (<anonymous>)":-1<l.stack.indexOf("@")?"@unknown:0:0":""}return`
`+z+e+le}var ue=!1;function ce(e,a){if(!e||ue)return"";ue=!0;var l=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var c={DetermineComponentFrameRoot:function(){try{if(a){var Ee=function(){throw Error()};if(Object.defineProperty(Ee.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Ee,[])}catch(_e){var ye=_e}Reflect.construct(e,[],Ee)}else{try{Ee.call()}catch(_e){ye=_e}e.call(Ee.prototype)}}else{try{throw Error()}catch(_e){ye=_e}(Ee=e())&&typeof Ee.catch=="function"&&Ee.catch(function(){})}}catch(_e){if(_e&&ye&&typeof _e.stack=="string")return[_e.stack,ye.stack]}return[null,null]}};c.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var v=Object.getOwnPropertyDescriptor(c.DetermineComponentFrameRoot,"name");v&&v.configurable&&Object.defineProperty(c.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var C=c.DetermineComponentFrameRoot(),F=C[0],Y=C[1];if(F&&Y){var ae=F.split(`
`),fe=Y.split(`
`);for(v=c=0;c<ae.length&&!ae[c].includes("DetermineComponentFrameRoot");)c++;for(;v<fe.length&&!fe[v].includes("DetermineComponentFrameRoot");)v++;if(c===ae.length||v===fe.length)for(c=ae.length-1,v=fe.length-1;1<=c&&0<=v&&ae[c]!==fe[v];)v--;for(;1<=c&&0<=v;c--,v--)if(ae[c]!==fe[v]){if(c!==1||v!==1)do if(c--,v--,0>v||ae[c]!==fe[v]){var we=`
`+ae[c].replace(" at new "," at ");return e.displayName&&we.includes("<anonymous>")&&(we=we.replace("<anonymous>",e.displayName)),we}while(1<=c&&0<=v);break}}}finally{ue=!1,Error.prepareStackTrace=l}return(l=e?e.displayName||e.name:"")?ne(l):""}function Se(e,a){switch(e.tag){case 26:case 27:case 5:return ne(e.type);case 16:return ne("Lazy");case 13:return e.child!==a&&a!==null?ne("Suspense Fallback"):ne("Suspense");case 19:return ne("SuspenseList");case 0:case 15:return ce(e.type,!1);case 11:return ce(e.type.render,!1);case 1:return ce(e.type,!0);case 31:return ne("Activity");default:return""}}function De(e){try{var a="",l=null;do a+=Se(e,l),l=e,e=e.return;while(e);return a}catch(c){return`
Error generating stack: `+c.message+`
`+c.stack}}var be=Object.prototype.hasOwnProperty,Ge=t.unstable_scheduleCallback,Be=t.unstable_cancelCallback,Me=t.unstable_shouldYield,He=t.unstable_requestPaint,je=t.unstable_now,Re=t.unstable_getCurrentPriorityLevel,Ie=t.unstable_ImmediatePriority,Ve=t.unstable_UserBlockingPriority,it=t.unstable_NormalPriority,nt=t.unstable_LowPriority,Rt=t.unstable_IdlePriority,Zt=t.log,nn=t.unstable_setDisableYieldValue,an=null,Lt=null;function hn(e){if(typeof Zt=="function"&&nn(e),Lt&&typeof Lt.setStrictMode=="function")try{Lt.setStrictMode(an,e)}catch{}}var Pt=Math.clz32?Math.clz32:Ma,fa=Math.log,ha=Math.LN2;function Ma(e){return e>>>=0,e===0?32:31-(fa(e)/ha|0)|0}var Ln=256,Zn=262144,En=4194304;function Ht(e){var a=e&42;if(a!==0)return a;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return e&261888;case 262144:case 524288:case 1048576:case 2097152:return e&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return e&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function mn(e,a,l){var c=e.pendingLanes;if(c===0)return 0;var v=0,C=e.suspendedLanes,F=e.pingedLanes;e=e.warmLanes;var Y=c&134217727;return Y!==0?(c=Y&~C,c!==0?v=Ht(c):(F&=Y,F!==0?v=Ht(F):l||(l=Y&~e,l!==0&&(v=Ht(l))))):(Y=c&~C,Y!==0?v=Ht(Y):F!==0?v=Ht(F):l||(l=c&~e,l!==0&&(v=Ht(l)))),v===0?0:a!==0&&a!==v&&(a&C)===0&&(C=v&-v,l=a&-a,C>=l||C===32&&(l&4194048)!==0)?a:v}function Pn(e,a){return(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&a)===0}function Ha(e,a){switch(e){case 1:case 2:case 4:case 8:case 64:return a+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ka(){var e=En;return En<<=1,(En&62914560)===0&&(En=4194304),e}function ma(e){for(var a=[],l=0;31>l;l++)a.push(e);return a}function Un(e,a){e.pendingLanes|=a,a!==268435456&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function Ta(e,a,l,c,v,C){var F=e.pendingLanes;e.pendingLanes=l,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=l,e.entangledLanes&=l,e.errorRecoveryDisabledLanes&=l,e.shellSuspendCounter=0;var Y=e.entanglements,ae=e.expirationTimes,fe=e.hiddenUpdates;for(l=F&~l;0<l;){var we=31-Pt(l),Ee=1<<we;Y[we]=0,ae[we]=-1;var ye=fe[we];if(ye!==null)for(fe[we]=null,we=0;we<ye.length;we++){var _e=ye[we];_e!==null&&(_e.lane&=-536870913)}l&=~Ee}c!==0&&Kn(e,c,0),C!==0&&v===0&&e.tag!==0&&(e.suspendedLanes|=C&~(F&~a))}function Kn(e,a,l){e.pendingLanes|=a,e.suspendedLanes&=~a;var c=31-Pt(a);e.entangledLanes|=a,e.entanglements[c]=e.entanglements[c]|1073741824|l&261930}function Na(e,a){var l=e.entangledLanes|=a;for(e=e.entanglements;l;){var c=31-Pt(l),v=1<<c;v&a|e[c]&a&&(e[c]|=a),l&=~v}}function Aa(e,a){var l=a&-a;return l=(l&42)!==0?1:ya(l),(l&(e.suspendedLanes|a))!==0?0:l}function ya(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function ga(e){return e&=-e,2<e?8<e?(e&134217727)!==0?32:268435456:8:2}function Ra(){var e=q.p;return e!==0?e:(e=window.event,e===void 0?32:Hh(e.type))}function va(e,a){var l=q.p;try{return q.p=e,a()}finally{q.p=l}}var yn=Math.random().toString(36).slice(2),Dt="__reactFiber$"+yn,Ut="__reactProps$"+yn,jn="__reactContainer$"+yn,_a="__reactEvents$"+yn,Va="__reactListeners$"+yn,Fa="__reactHandles$"+yn,wa="__reactResources$"+yn,kn="__reactMarker$"+yn;function Jn(e){delete e[Dt],delete e[Ut],delete e[_a],delete e[Va],delete e[Fa]}function _n(e){var a=e[Dt];if(a)return a;for(var l=e.parentNode;l;){if(a=l[jn]||l[Dt]){if(l=a.alternate,a.child!==null||l!==null&&l.child!==null)for(e=jh(e);e!==null;){if(l=e[Dt])return l;e=jh(e)}return a}e=l,l=e.parentNode}return null}function wn(e){if(e=e[Dt]||e[jn]){var a=e.tag;if(a===5||a===6||a===13||a===31||a===26||a===27||a===3)return e}return null}function Tn(e){var a=e.tag;if(a===5||a===26||a===27||a===6)return e.stateNode;throw Error(i(33))}function xn(e){var a=e[wa];return a||(a=e[wa]={hoistableStyles:new Map,hoistableScripts:new Map}),a}function Nt(e){e[kn]=!0}var xa=new Set,Ca={};function gn(e,a){Cn(e,a),Cn(e+"Capture",a)}function Cn(e,a){for(Ca[e]=a,e=0;e<a.length;e++)xa.add(a[e])}var he=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Fe={},Pe={};function ge(e){return be.call(Pe,e)?!0:be.call(Fe,e)?!1:he.test(e)?Pe[e]=!0:(Fe[e]=!0,!1)}function ve(e,a,l){if(ge(a))if(l===null)e.removeAttribute(a);else{switch(typeof l){case"undefined":case"function":case"symbol":e.removeAttribute(a);return;case"boolean":var c=a.toLowerCase().slice(0,5);if(c!=="data-"&&c!=="aria-"){e.removeAttribute(a);return}}e.setAttribute(a,""+l)}}function Te(e,a,l){if(l===null)e.removeAttribute(a);else{switch(typeof l){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(a);return}e.setAttribute(a,""+l)}}function Le(e,a,l,c){if(c===null)e.removeAttribute(l);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(l);return}e.setAttributeNS(a,l,""+c)}}function Oe(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function Je(e){var a=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(a==="checkbox"||a==="radio")}function Qe(e,a,l){var c=Object.getOwnPropertyDescriptor(e.constructor.prototype,a);if(!e.hasOwnProperty(a)&&typeof c<"u"&&typeof c.get=="function"&&typeof c.set=="function"){var v=c.get,C=c.set;return Object.defineProperty(e,a,{configurable:!0,get:function(){return v.call(this)},set:function(F){l=""+F,C.call(this,F)}}),Object.defineProperty(e,a,{enumerable:c.enumerable}),{getValue:function(){return l},setValue:function(F){l=""+F},stopTracking:function(){e._valueTracker=null,delete e[a]}}}}function Xe(e){if(!e._valueTracker){var a=Je(e)?"checked":"value";e._valueTracker=Qe(e,a,""+e[a])}}function gt(e){if(!e)return!1;var a=e._valueTracker;if(!a)return!0;var l=a.getValue(),c="";return e&&(c=Je(e)?e.checked?"true":"false":e.value),e=c,e!==l?(a.setValue(e),!0):!1}function Ct(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}var St=/[\n"\\]/g;function on(e){return e.replace(St,function(a){return"\\"+a.charCodeAt(0).toString(16)+" "})}function Bo(e,a,l,c,v,C,F,Y){e.name="",F!=null&&typeof F!="function"&&typeof F!="symbol"&&typeof F!="boolean"?e.type=F:e.removeAttribute("type"),a!=null?F==="number"?(a===0&&e.value===""||e.value!=a)&&(e.value=""+Oe(a)):e.value!==""+Oe(a)&&(e.value=""+Oe(a)):F!=="submit"&&F!=="reset"||e.removeAttribute("value"),a!=null?za(e,F,Oe(a)):l!=null?za(e,F,Oe(l)):c!=null&&e.removeAttribute("value"),v==null&&C!=null&&(e.defaultChecked=!!C),v!=null&&(e.checked=v&&typeof v!="function"&&typeof v!="symbol"),Y!=null&&typeof Y!="function"&&typeof Y!="symbol"&&typeof Y!="boolean"?e.name=""+Oe(Y):e.removeAttribute("name")}function io(e,a,l,c,v,C,F,Y){if(C!=null&&typeof C!="function"&&typeof C!="symbol"&&typeof C!="boolean"&&(e.type=C),a!=null||l!=null){if(!(C!=="submit"&&C!=="reset"||a!=null)){Xe(e);return}l=l!=null?""+Oe(l):"",a=a!=null?""+Oe(a):l,Y||a===e.value||(e.value=a),e.defaultValue=a}c=c??v,c=typeof c!="function"&&typeof c!="symbol"&&!!c,e.checked=Y?e.checked:!!c,e.defaultChecked=!!c,F!=null&&typeof F!="function"&&typeof F!="symbol"&&typeof F!="boolean"&&(e.name=F),Xe(e)}function za(e,a,l){a==="number"&&Ct(e.ownerDocument)===e||e.defaultValue===""+l||(e.defaultValue=""+l)}function ea(e,a,l,c){if(e=e.options,a){a={};for(var v=0;v<l.length;v++)a["$"+l[v]]=!0;for(l=0;l<e.length;l++)v=a.hasOwnProperty("$"+e[l].value),e[l].selected!==v&&(e[l].selected=v),v&&c&&(e[l].defaultSelected=!0)}else{for(l=""+Oe(l),a=null,v=0;v<e.length;v++){if(e[v].value===l){e[v].selected=!0,c&&(e[v].defaultSelected=!0);return}a!==null||e[v].disabled||(a=e[v])}a!==null&&(a.selected=!0)}}function co(e,a,l){if(a!=null&&(a=""+Oe(a),a!==e.value&&(e.value=a),l==null)){e.defaultValue!==a&&(e.defaultValue=a);return}e.defaultValue=l!=null?""+Oe(l):""}function uo(e,a,l,c){if(a==null){if(c!=null){if(l!=null)throw Error(i(92));if(L(c)){if(1<c.length)throw Error(i(93));c=c[0]}l=c}l==null&&(l=""),a=l}l=Oe(a),e.defaultValue=l,c=e.textContent,c===l&&c!==""&&c!==null&&(e.value=c),Xe(e)}function ta(e,a){if(a){var l=e.firstChild;if(l&&l===e.lastChild&&l.nodeType===3){l.nodeValue=a;return}}e.textContent=a}var Vt=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Go(e,a,l){var c=a.indexOf("--")===0;l==null||typeof l=="boolean"||l===""?c?e.setProperty(a,""):a==="float"?e.cssFloat="":e[a]="":c?e.setProperty(a,l):typeof l!="number"||l===0||Vt.has(a)?a==="float"?e.cssFloat=l:e[a]=(""+l).trim():e[a]=l+"px"}function Yo(e,a,l){if(a!=null&&typeof a!="object")throw Error(i(62));if(e=e.style,l!=null){for(var c in l)!l.hasOwnProperty(c)||a!=null&&a.hasOwnProperty(c)||(c.indexOf("--")===0?e.setProperty(c,""):c==="float"?e.cssFloat="":e[c]="");for(var v in a)c=a[v],a.hasOwnProperty(v)&&l[v]!==c&&Go(e,v,c)}else for(var C in a)a.hasOwnProperty(C)&&Go(e,C,a[C])}function po(e){if(e.indexOf("-")===-1)return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var vr=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),_r=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Ba(e){return _r.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}function Nn(){}var Sa=null;function Ft(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var Kt=null,Jt=null;function Wo(e){var a=wn(e);if(a&&(e=a.stateNode)){var l=e[Ut]||null;e:switch(e=a.stateNode,a.type){case"input":if(Bo(e,l.value,l.defaultValue,l.defaultValue,l.checked,l.defaultChecked,l.type,l.name),a=l.name,l.type==="radio"&&a!=null){for(l=e;l.parentNode;)l=l.parentNode;for(l=l.querySelectorAll('input[name="'+on(""+a)+'"][type="radio"]'),a=0;a<l.length;a++){var c=l[a];if(c!==e&&c.form===e.form){var v=c[Ut]||null;if(!v)throw Error(i(90));Bo(c,v.value,v.defaultValue,v.defaultValue,v.checked,v.defaultChecked,v.type,v.name)}}for(a=0;a<l.length;a++)c=l[a],c.form===e.form&&gt(c)}break e;case"textarea":co(e,l.value,l.defaultValue);break e;case"select":a=l.value,a!=null&&ea(e,!!l.multiple,a,!1)}}}var Ue=!1;function ss(e,a,l){if(Ue)return e(a,l);Ue=!0;try{var c=e(a);return c}finally{if(Ue=!1,(Kt!==null||Jt!==null)&&(Qs(),Kt&&(a=Kt,e=Jt,Jt=Kt=null,Wo(a),e)))for(a=0;a<e.length;a++)Wo(e[a])}}function Da(e,a){var l=e.stateNode;if(l===null)return null;var c=l[Ut]||null;if(c===null)return null;l=c[a];e:switch(a){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(c=!c.disabled)||(e=e.type,c=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!c;break e;default:e=!1}if(e)return null;if(l&&typeof l!="function")throw Error(i(231,a,typeof l));return l}var na=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),is=!1;if(na)try{var fo={};Object.defineProperty(fo,"passive",{get:function(){is=!0}}),window.addEventListener("test",fo,fo),window.removeEventListener("test",fo,fo)}catch{is=!1}var ho=null,Fi=null,cs=null;function vu(){if(cs)return cs;var e,a=Fi,l=a.length,c,v="value"in ho?ho.value:ho.textContent,C=v.length;for(e=0;e<l&&a[e]===v[e];e++);var F=l-e;for(c=1;c<=F&&a[l-c]===v[C-c];c++);return cs=v.slice(e,1<c?1-c:void 0)}function ds(e){var a=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&a===13&&(e=13)):e=a,e===10&&(e=13),32<=e||e===13?e:0}function us(){return!0}function _u(){return!1}function An(e){function a(l,c,v,C,F){this._reactName=l,this._targetInst=v,this.type=c,this.nativeEvent=C,this.target=F,this.currentTarget=null;for(var Y in e)e.hasOwnProperty(Y)&&(l=e[Y],this[Y]=l?l(C):C[Y]);return this.isDefaultPrevented=(C.defaultPrevented!=null?C.defaultPrevented:C.returnValue===!1)?us:_u,this.isPropagationStopped=_u,this}return g(a.prototype,{preventDefault:function(){this.defaultPrevented=!0;var l=this.nativeEvent;l&&(l.preventDefault?l.preventDefault():typeof l.returnValue!="unknown"&&(l.returnValue=!1),this.isDefaultPrevented=us)},stopPropagation:function(){var l=this.nativeEvent;l&&(l.stopPropagation?l.stopPropagation():typeof l.cancelBubble!="unknown"&&(l.cancelBubble=!0),this.isPropagationStopped=us)},persist:function(){},isPersistent:us}),a}var Qo={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ps=An(Qo),dl=g({},Qo,{view:0,detail:0}),Sv=An(dl),Di,$i,ul,fs=g({},dl,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ii,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==ul&&(ul&&e.type==="mousemove"?(Di=e.screenX-ul.screenX,$i=e.screenY-ul.screenY):$i=Di=0,ul=e),Di)},movementY:function(e){return"movementY"in e?e.movementY:$i}}),wu=An(fs),bv=g({},fs,{dataTransfer:0}),Ev=An(bv),jv=g({},dl,{relatedTarget:0}),qi=An(jv),kv=g({},Qo,{animationName:0,elapsedTime:0,pseudoElement:0}),Tv=An(kv),Nv=g({},Qo,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Av=An(Nv),Rv=g({},Qo,{data:0}),xu=An(Rv),Fv={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Dv={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},$v={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function qv(e){var a=this.nativeEvent;return a.getModifierState?a.getModifierState(e):(e=$v[e])?!!a[e]:!1}function Ii(){return qv}var Iv=g({},dl,{key:function(e){if(e.key){var a=Fv[e.key]||e.key;if(a!=="Unidentified")return a}return e.type==="keypress"?(e=ds(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?Dv[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ii,charCode:function(e){return e.type==="keypress"?ds(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?ds(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),Lv=An(Iv),Pv=g({},fs,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Cu=An(Pv),Uv=g({},dl,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ii}),Ov=An(Uv),Mv=g({},Qo,{propertyName:0,elapsedTime:0,pseudoElement:0}),Hv=An(Mv),Vv=g({},fs,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),zv=An(Vv),Bv=g({},Qo,{newState:0,oldState:0}),Gv=An(Bv),Yv=[9,13,27,32],Li=na&&"CompositionEvent"in window,pl=null;na&&"documentMode"in document&&(pl=document.documentMode);var Wv=na&&"TextEvent"in window&&!pl,Su=na&&(!Li||pl&&8<pl&&11>=pl),bu=" ",Eu=!1;function ju(e,a){switch(e){case"keyup":return Yv.indexOf(a.keyCode)!==-1;case"keydown":return a.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function ku(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var wr=!1;function Qv(e,a){switch(e){case"compositionend":return ku(a);case"keypress":return a.which!==32?null:(Eu=!0,bu);case"textInput":return e=a.data,e===bu&&Eu?null:e;default:return null}}function Xv(e,a){if(wr)return e==="compositionend"||!Li&&ju(e,a)?(e=vu(),cs=Fi=ho=null,wr=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(a.ctrlKey||a.altKey||a.metaKey)||a.ctrlKey&&a.altKey){if(a.char&&1<a.char.length)return a.char;if(a.which)return String.fromCharCode(a.which)}return null;case"compositionend":return Su&&a.locale!=="ko"?null:a.data;default:return null}}var Zv={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Tu(e){var a=e&&e.nodeName&&e.nodeName.toLowerCase();return a==="input"?!!Zv[e.type]:a==="textarea"}function Nu(e,a,l,c){Kt?Jt?Jt.push(c):Jt=[c]:Kt=c,a=ni(a,"onChange"),0<a.length&&(l=new ps("onChange","change",null,l,c),e.push({event:l,listeners:a}))}var fl=null,hl=null;function Kv(e){ph(e,0)}function hs(e){var a=Tn(e);if(gt(a))return e}function Au(e,a){if(e==="change")return a}var Ru=!1;if(na){var Pi;if(na){var Ui="oninput"in document;if(!Ui){var Fu=document.createElement("div");Fu.setAttribute("oninput","return;"),Ui=typeof Fu.oninput=="function"}Pi=Ui}else Pi=!1;Ru=Pi&&(!document.documentMode||9<document.documentMode)}function Du(){fl&&(fl.detachEvent("onpropertychange",$u),hl=fl=null)}function $u(e){if(e.propertyName==="value"&&hs(hl)){var a=[];Nu(a,hl,e,Ft(e)),ss(Kv,a)}}function Jv(e,a,l){e==="focusin"?(Du(),fl=a,hl=l,fl.attachEvent("onpropertychange",$u)):e==="focusout"&&Du()}function e_(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return hs(hl)}function t_(e,a){if(e==="click")return hs(a)}function n_(e,a){if(e==="input"||e==="change")return hs(a)}function a_(e,a){return e===a&&(e!==0||1/e===1/a)||e!==e&&a!==a}var On=typeof Object.is=="function"?Object.is:a_;function ml(e,a){if(On(e,a))return!0;if(typeof e!="object"||e===null||typeof a!="object"||a===null)return!1;var l=Object.keys(e),c=Object.keys(a);if(l.length!==c.length)return!1;for(c=0;c<l.length;c++){var v=l[c];if(!be.call(a,v)||!On(e[v],a[v]))return!1}return!0}function qu(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Iu(e,a){var l=qu(e);e=0;for(var c;l;){if(l.nodeType===3){if(c=e+l.textContent.length,e<=a&&c>=a)return{node:l,offset:a-e};e=c}e:{for(;l;){if(l.nextSibling){l=l.nextSibling;break e}l=l.parentNode}l=void 0}l=qu(l)}}function Lu(e,a){return e&&a?e===a?!0:e&&e.nodeType===3?!1:a&&a.nodeType===3?Lu(e,a.parentNode):"contains"in e?e.contains(a):e.compareDocumentPosition?!!(e.compareDocumentPosition(a)&16):!1:!1}function Pu(e){e=e!=null&&e.ownerDocument!=null&&e.ownerDocument.defaultView!=null?e.ownerDocument.defaultView:window;for(var a=Ct(e.document);a instanceof e.HTMLIFrameElement;){try{var l=typeof a.contentWindow.location.href=="string"}catch{l=!1}if(l)e=a.contentWindow;else break;a=Ct(e.document)}return a}function Oi(e){var a=e&&e.nodeName&&e.nodeName.toLowerCase();return a&&(a==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||a==="textarea"||e.contentEditable==="true")}var o_=na&&"documentMode"in document&&11>=document.documentMode,xr=null,Mi=null,yl=null,Hi=!1;function Uu(e,a,l){var c=l.window===l?l.document:l.nodeType===9?l:l.ownerDocument;Hi||xr==null||xr!==Ct(c)||(c=xr,"selectionStart"in c&&Oi(c)?c={start:c.selectionStart,end:c.selectionEnd}:(c=(c.ownerDocument&&c.ownerDocument.defaultView||window).getSelection(),c={anchorNode:c.anchorNode,anchorOffset:c.anchorOffset,focusNode:c.focusNode,focusOffset:c.focusOffset}),yl&&ml(yl,c)||(yl=c,c=ni(Mi,"onSelect"),0<c.length&&(a=new ps("onSelect","select",null,a,l),e.push({event:a,listeners:c}),a.target=xr)))}function Xo(e,a){var l={};return l[e.toLowerCase()]=a.toLowerCase(),l["Webkit"+e]="webkit"+a,l["Moz"+e]="moz"+a,l}var Cr={animationend:Xo("Animation","AnimationEnd"),animationiteration:Xo("Animation","AnimationIteration"),animationstart:Xo("Animation","AnimationStart"),transitionrun:Xo("Transition","TransitionRun"),transitionstart:Xo("Transition","TransitionStart"),transitioncancel:Xo("Transition","TransitionCancel"),transitionend:Xo("Transition","TransitionEnd")},Vi={},Ou={};na&&(Ou=document.createElement("div").style,"AnimationEvent"in window||(delete Cr.animationend.animation,delete Cr.animationiteration.animation,delete Cr.animationstart.animation),"TransitionEvent"in window||delete Cr.transitionend.transition);function Zo(e){if(Vi[e])return Vi[e];if(!Cr[e])return e;var a=Cr[e],l;for(l in a)if(a.hasOwnProperty(l)&&l in Ou)return Vi[e]=a[l];return e}var Mu=Zo("animationend"),Hu=Zo("animationiteration"),Vu=Zo("animationstart"),r_=Zo("transitionrun"),l_=Zo("transitionstart"),s_=Zo("transitioncancel"),zu=Zo("transitionend"),Bu=new Map,zi="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");zi.push("scrollEnd");function ba(e,a){Bu.set(e,a),gn(a,[e])}var ms=typeof reportError=="function"?reportError:function(e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var a=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof e=="object"&&e!==null&&typeof e.message=="string"?String(e.message):String(e),error:e});if(!window.dispatchEvent(a))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",e);return}console.error(e)},aa=[],Sr=0,Bi=0;function ys(){for(var e=Sr,a=Bi=Sr=0;a<e;){var l=aa[a];aa[a++]=null;var c=aa[a];aa[a++]=null;var v=aa[a];aa[a++]=null;var C=aa[a];if(aa[a++]=null,c!==null&&v!==null){var F=c.pending;F===null?v.next=v:(v.next=F.next,F.next=v),c.pending=v}C!==0&&Gu(l,v,C)}}function gs(e,a,l,c){aa[Sr++]=e,aa[Sr++]=a,aa[Sr++]=l,aa[Sr++]=c,Bi|=c,e.lanes|=c,e=e.alternate,e!==null&&(e.lanes|=c)}function Gi(e,a,l,c){return gs(e,a,l,c),vs(e)}function Ko(e,a){return gs(e,null,null,a),vs(e)}function Gu(e,a,l){e.lanes|=l;var c=e.alternate;c!==null&&(c.lanes|=l);for(var v=!1,C=e.return;C!==null;)C.childLanes|=l,c=C.alternate,c!==null&&(c.childLanes|=l),C.tag===22&&(e=C.stateNode,e===null||e._visibility&1||(v=!0)),e=C,C=C.return;return e.tag===3?(C=e.stateNode,v&&a!==null&&(v=31-Pt(l),e=C.hiddenUpdates,c=e[v],c===null?e[v]=[a]:c.push(a),a.lane=l|536870912),C):null}function vs(e){if(50<Pl)throw Pl=0,td=null,Error(i(185));for(var a=e.return;a!==null;)e=a,a=e.return;return e.tag===3?e.stateNode:null}var br={};function i_(e,a,l,c){this.tag=e,this.key=l,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=a,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=c,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Mn(e,a,l,c){return new i_(e,a,l,c)}function Yi(e){return e=e.prototype,!(!e||!e.isReactComponent)}function Ga(e,a){var l=e.alternate;return l===null?(l=Mn(e.tag,a,e.key,e.mode),l.elementType=e.elementType,l.type=e.type,l.stateNode=e.stateNode,l.alternate=e,e.alternate=l):(l.pendingProps=a,l.type=e.type,l.flags=0,l.subtreeFlags=0,l.deletions=null),l.flags=e.flags&65011712,l.childLanes=e.childLanes,l.lanes=e.lanes,l.child=e.child,l.memoizedProps=e.memoizedProps,l.memoizedState=e.memoizedState,l.updateQueue=e.updateQueue,a=e.dependencies,l.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext},l.sibling=e.sibling,l.index=e.index,l.ref=e.ref,l.refCleanup=e.refCleanup,l}function Yu(e,a){e.flags&=65011714;var l=e.alternate;return l===null?(e.childLanes=0,e.lanes=a,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=l.childLanes,e.lanes=l.lanes,e.child=l.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=l.memoizedProps,e.memoizedState=l.memoizedState,e.updateQueue=l.updateQueue,e.type=l.type,a=l.dependencies,e.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext}),e}function _s(e,a,l,c,v,C){var F=0;if(c=e,typeof e=="function")Yi(e)&&(F=1);else if(typeof e=="string")F=f0(e,l,Q.current)?26:e==="html"||e==="head"||e==="body"?27:5;else e:switch(e){case X:return e=Mn(31,l,a,v),e.elementType=X,e.lanes=C,e;case S:return Jo(l.children,v,C,a);case E:F=8,v|=24;break;case j:return e=Mn(12,l,a,v|2),e.elementType=j,e.lanes=C,e;case U:return e=Mn(13,l,a,v),e.elementType=U,e.lanes=C,e;case V:return e=Mn(19,l,a,v),e.elementType=V,e.lanes=C,e;default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case k:F=10;break e;case b:F=9;break e;case N:F=11;break e;case R:F=14;break e;case O:F=16,c=null;break e}F=29,l=Error(i(130,e===null?"null":typeof e,"")),c=null}return a=Mn(F,l,a,v),a.elementType=e,a.type=c,a.lanes=C,a}function Jo(e,a,l,c){return e=Mn(7,e,c,a),e.lanes=l,e}function Wi(e,a,l){return e=Mn(6,e,null,a),e.lanes=l,e}function Wu(e){var a=Mn(18,null,null,0);return a.stateNode=e,a}function Qi(e,a,l){return a=Mn(4,e.children!==null?e.children:[],e.key,a),a.lanes=l,a.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},a}var Qu=new WeakMap;function oa(e,a){if(typeof e=="object"&&e!==null){var l=Qu.get(e);return l!==void 0?l:(a={value:e,source:a,stack:De(a)},Qu.set(e,a),a)}return{value:e,source:a,stack:De(a)}}var Er=[],jr=0,ws=null,gl=0,ra=[],la=0,mo=null,$a=1,qa="";function Ya(e,a){Er[jr++]=gl,Er[jr++]=ws,ws=e,gl=a}function Xu(e,a,l){ra[la++]=$a,ra[la++]=qa,ra[la++]=mo,mo=e;var c=$a;e=qa;var v=32-Pt(c)-1;c&=~(1<<v),l+=1;var C=32-Pt(a)+v;if(30<C){var F=v-v%5;C=(c&(1<<F)-1).toString(32),c>>=F,v-=F,$a=1<<32-Pt(a)+v|l<<v|c,qa=C+e}else $a=1<<C|l<<v|c,qa=e}function Xi(e){e.return!==null&&(Ya(e,1),Xu(e,1,0))}function Zi(e){for(;e===ws;)ws=Er[--jr],Er[jr]=null,gl=Er[--jr],Er[jr]=null;for(;e===mo;)mo=ra[--la],ra[la]=null,qa=ra[--la],ra[la]=null,$a=ra[--la],ra[la]=null}function Zu(e,a){ra[la++]=$a,ra[la++]=qa,ra[la++]=mo,$a=a.id,qa=a.overflow,mo=e}var rn=null,$t=null,mt=!1,yo=null,sa=!1,Ki=Error(i(519));function go(e){var a=Error(i(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw vl(oa(a,e)),Ki}function Ku(e){var a=e.stateNode,l=e.type,c=e.memoizedProps;switch(a[Dt]=e,a[Ut]=c,l){case"dialog":pt("cancel",a),pt("close",a);break;case"iframe":case"object":case"embed":pt("load",a);break;case"video":case"audio":for(l=0;l<Ol.length;l++)pt(Ol[l],a);break;case"source":pt("error",a);break;case"img":case"image":case"link":pt("error",a),pt("load",a);break;case"details":pt("toggle",a);break;case"input":pt("invalid",a),io(a,c.value,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name,!0);break;case"select":pt("invalid",a);break;case"textarea":pt("invalid",a),uo(a,c.value,c.defaultValue,c.children)}l=c.children,typeof l!="string"&&typeof l!="number"&&typeof l!="bigint"||a.textContent===""+l||c.suppressHydrationWarning===!0||yh(a.textContent,l)?(c.popover!=null&&(pt("beforetoggle",a),pt("toggle",a)),c.onScroll!=null&&pt("scroll",a),c.onScrollEnd!=null&&pt("scrollend",a),c.onClick!=null&&(a.onclick=Nn),a=!0):a=!1,a||go(e,!0)}function Ju(e){for(rn=e.return;rn;)switch(rn.tag){case 5:case 31:case 13:sa=!1;return;case 27:case 3:sa=!0;return;default:rn=rn.return}}function kr(e){if(e!==rn)return!1;if(!mt)return Ju(e),mt=!0,!1;var a=e.tag,l;if((l=a!==3&&a!==27)&&((l=a===5)&&(l=e.type,l=!(l!=="form"&&l!=="button")||yd(e.type,e.memoizedProps)),l=!l),l&&$t&&go(e),Ju(e),a===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(i(317));$t=Eh(e)}else if(a===31){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(i(317));$t=Eh(e)}else a===27?(a=$t,Ro(e.type)?(e=xd,xd=null,$t=e):$t=a):$t=rn?ca(e.stateNode.nextSibling):null;return!0}function er(){$t=rn=null,mt=!1}function Ji(){var e=yo;return e!==null&&($n===null?$n=e:$n.push.apply($n,e),yo=null),e}function vl(e){yo===null?yo=[e]:yo.push(e)}var ec=A(null),tr=null,Wa=null;function vo(e,a,l){J(ec,a._currentValue),a._currentValue=l}function Qa(e){e._currentValue=ec.current,W(ec)}function tc(e,a,l){for(;e!==null;){var c=e.alternate;if((e.childLanes&a)!==a?(e.childLanes|=a,c!==null&&(c.childLanes|=a)):c!==null&&(c.childLanes&a)!==a&&(c.childLanes|=a),e===l)break;e=e.return}}function nc(e,a,l,c){var v=e.child;for(v!==null&&(v.return=e);v!==null;){var C=v.dependencies;if(C!==null){var F=v.child;C=C.firstContext;e:for(;C!==null;){var Y=C;C=v;for(var ae=0;ae<a.length;ae++)if(Y.context===a[ae]){C.lanes|=l,Y=C.alternate,Y!==null&&(Y.lanes|=l),tc(C.return,l,e),c||(F=null);break e}C=Y.next}}else if(v.tag===18){if(F=v.return,F===null)throw Error(i(341));F.lanes|=l,C=F.alternate,C!==null&&(C.lanes|=l),tc(F,l,e),F=null}else F=v.child;if(F!==null)F.return=v;else for(F=v;F!==null;){if(F===e){F=null;break}if(v=F.sibling,v!==null){v.return=F.return,F=v;break}F=F.return}v=F}}function Tr(e,a,l,c){e=null;for(var v=a,C=!1;v!==null;){if(!C){if((v.flags&524288)!==0)C=!0;else if((v.flags&262144)!==0)break}if(v.tag===10){var F=v.alternate;if(F===null)throw Error(i(387));if(F=F.memoizedProps,F!==null){var Y=v.type;On(v.pendingProps.value,F.value)||(e!==null?e.push(Y):e=[Y])}}else if(v===me.current){if(F=v.alternate,F===null)throw Error(i(387));F.memoizedState.memoizedState!==v.memoizedState.memoizedState&&(e!==null?e.push(Bl):e=[Bl])}v=v.return}e!==null&&nc(a,e,l,c),a.flags|=262144}function xs(e){for(e=e.firstContext;e!==null;){if(!On(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function nr(e){tr=e,Wa=null,e=e.dependencies,e!==null&&(e.firstContext=null)}function ln(e){return ep(tr,e)}function Cs(e,a){return tr===null&&nr(e),ep(e,a)}function ep(e,a){var l=a._currentValue;if(a={context:a,memoizedValue:l,next:null},Wa===null){if(e===null)throw Error(i(308));Wa=a,e.dependencies={lanes:0,firstContext:a},e.flags|=524288}else Wa=Wa.next=a;return l}var c_=typeof AbortController<"u"?AbortController:function(){var e=[],a=this.signal={aborted:!1,addEventListener:function(l,c){e.push(c)}};this.abort=function(){a.aborted=!0,e.forEach(function(l){return l()})}},d_=t.unstable_scheduleCallback,u_=t.unstable_NormalPriority,Gt={$$typeof:k,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function ac(){return{controller:new c_,data:new Map,refCount:0}}function _l(e){e.refCount--,e.refCount===0&&d_(u_,function(){e.controller.abort()})}var wl=null,oc=0,Nr=0,Ar=null;function p_(e,a){if(wl===null){var l=wl=[];oc=0,Nr=sd(),Ar={status:"pending",value:void 0,then:function(c){l.push(c)}}}return oc++,a.then(tp,tp),a}function tp(){if(--oc===0&&wl!==null){Ar!==null&&(Ar.status="fulfilled");var e=wl;wl=null,Nr=0,Ar=null;for(var a=0;a<e.length;a++)(0,e[a])()}}function f_(e,a){var l=[],c={status:"pending",value:null,reason:null,then:function(v){l.push(v)}};return e.then(function(){c.status="fulfilled",c.value=a;for(var v=0;v<l.length;v++)(0,l[v])(a)},function(v){for(c.status="rejected",c.reason=v,v=0;v<l.length;v++)(0,l[v])(void 0)}),c}var np=T.S;T.S=function(e,a){Of=je(),typeof a=="object"&&a!==null&&typeof a.then=="function"&&p_(e,a),np!==null&&np(e,a)};var ar=A(null);function rc(){var e=ar.current;return e!==null?e:At.pooledCache}function Ss(e,a){a===null?J(ar,ar.current):J(ar,a.pool)}function ap(){var e=rc();return e===null?null:{parent:Gt._currentValue,pool:e}}var Rr=Error(i(460)),lc=Error(i(474)),bs=Error(i(542)),Es={then:function(){}};function op(e){return e=e.status,e==="fulfilled"||e==="rejected"}function rp(e,a,l){switch(l=e[l],l===void 0?e.push(a):l!==a&&(a.then(Nn,Nn),a=l),a.status){case"fulfilled":return a.value;case"rejected":throw e=a.reason,sp(e),e;default:if(typeof a.status=="string")a.then(Nn,Nn);else{if(e=At,e!==null&&100<e.shellSuspendCounter)throw Error(i(482));e=a,e.status="pending",e.then(function(c){if(a.status==="pending"){var v=a;v.status="fulfilled",v.value=c}},function(c){if(a.status==="pending"){var v=a;v.status="rejected",v.reason=c}})}switch(a.status){case"fulfilled":return a.value;case"rejected":throw e=a.reason,sp(e),e}throw rr=a,Rr}}function or(e){try{var a=e._init;return a(e._payload)}catch(l){throw l!==null&&typeof l=="object"&&typeof l.then=="function"?(rr=l,Rr):l}}var rr=null;function lp(){if(rr===null)throw Error(i(459));var e=rr;return rr=null,e}function sp(e){if(e===Rr||e===bs)throw Error(i(483))}var Fr=null,xl=0;function js(e){var a=xl;return xl+=1,Fr===null&&(Fr=[]),rp(Fr,e,a)}function Cl(e,a){a=a.props.ref,e.ref=a!==void 0?a:null}function ks(e,a){throw a.$$typeof===y?Error(i(525)):(e=Object.prototype.toString.call(a),Error(i(31,e==="[object Object]"?"object with keys {"+Object.keys(a).join(", ")+"}":e)))}function ip(e){function a(de,re){if(e){var pe=de.deletions;pe===null?(de.deletions=[re],de.flags|=16):pe.push(re)}}function l(de,re){if(!e)return null;for(;re!==null;)a(de,re),re=re.sibling;return null}function c(de){for(var re=new Map;de!==null;)de.key!==null?re.set(de.key,de):re.set(de.index,de),de=de.sibling;return re}function v(de,re){return de=Ga(de,re),de.index=0,de.sibling=null,de}function C(de,re,pe){return de.index=pe,e?(pe=de.alternate,pe!==null?(pe=pe.index,pe<re?(de.flags|=67108866,re):pe):(de.flags|=67108866,re)):(de.flags|=1048576,re)}function F(de){return e&&de.alternate===null&&(de.flags|=67108866),de}function Y(de,re,pe,Ce){return re===null||re.tag!==6?(re=Wi(pe,de.mode,Ce),re.return=de,re):(re=v(re,pe),re.return=de,re)}function ae(de,re,pe,Ce){var We=pe.type;return We===S?we(de,re,pe.props.children,Ce,pe.key):re!==null&&(re.elementType===We||typeof We=="object"&&We!==null&&We.$$typeof===O&&or(We)===re.type)?(re=v(re,pe.props),Cl(re,pe),re.return=de,re):(re=_s(pe.type,pe.key,pe.props,null,de.mode,Ce),Cl(re,pe),re.return=de,re)}function fe(de,re,pe,Ce){return re===null||re.tag!==4||re.stateNode.containerInfo!==pe.containerInfo||re.stateNode.implementation!==pe.implementation?(re=Qi(pe,de.mode,Ce),re.return=de,re):(re=v(re,pe.children||[]),re.return=de,re)}function we(de,re,pe,Ce,We){return re===null||re.tag!==7?(re=Jo(pe,de.mode,Ce,We),re.return=de,re):(re=v(re,pe),re.return=de,re)}function Ee(de,re,pe){if(typeof re=="string"&&re!==""||typeof re=="number"||typeof re=="bigint")return re=Wi(""+re,de.mode,pe),re.return=de,re;if(typeof re=="object"&&re!==null){switch(re.$$typeof){case m:return pe=_s(re.type,re.key,re.props,null,de.mode,pe),Cl(pe,re),pe.return=de,pe;case x:return re=Qi(re,de.mode,pe),re.return=de,re;case O:return re=or(re),Ee(de,re,pe)}if(L(re)||B(re))return re=Jo(re,de.mode,pe,null),re.return=de,re;if(typeof re.then=="function")return Ee(de,js(re),pe);if(re.$$typeof===k)return Ee(de,Cs(de,re),pe);ks(de,re)}return null}function ye(de,re,pe,Ce){var We=re!==null?re.key:null;if(typeof pe=="string"&&pe!==""||typeof pe=="number"||typeof pe=="bigint")return We!==null?null:Y(de,re,""+pe,Ce);if(typeof pe=="object"&&pe!==null){switch(pe.$$typeof){case m:return pe.key===We?ae(de,re,pe,Ce):null;case x:return pe.key===We?fe(de,re,pe,Ce):null;case O:return pe=or(pe),ye(de,re,pe,Ce)}if(L(pe)||B(pe))return We!==null?null:we(de,re,pe,Ce,null);if(typeof pe.then=="function")return ye(de,re,js(pe),Ce);if(pe.$$typeof===k)return ye(de,re,Cs(de,pe),Ce);ks(de,pe)}return null}function _e(de,re,pe,Ce,We){if(typeof Ce=="string"&&Ce!==""||typeof Ce=="number"||typeof Ce=="bigint")return de=de.get(pe)||null,Y(re,de,""+Ce,We);if(typeof Ce=="object"&&Ce!==null){switch(Ce.$$typeof){case m:return de=de.get(Ce.key===null?pe:Ce.key)||null,ae(re,de,Ce,We);case x:return de=de.get(Ce.key===null?pe:Ce.key)||null,fe(re,de,Ce,We);case O:return Ce=or(Ce),_e(de,re,pe,Ce,We)}if(L(Ce)||B(Ce))return de=de.get(pe)||null,we(re,de,Ce,We,null);if(typeof Ce.then=="function")return _e(de,re,pe,js(Ce),We);if(Ce.$$typeof===k)return _e(de,re,pe,Cs(re,Ce),We);ks(re,Ce)}return null}function ze(de,re,pe,Ce){for(var We=null,vt=null,Ye=re,lt=re=0,ht=null;Ye!==null&&lt<pe.length;lt++){Ye.index>lt?(ht=Ye,Ye=null):ht=Ye.sibling;var _t=ye(de,Ye,pe[lt],Ce);if(_t===null){Ye===null&&(Ye=ht);break}e&&Ye&&_t.alternate===null&&a(de,Ye),re=C(_t,re,lt),vt===null?We=_t:vt.sibling=_t,vt=_t,Ye=ht}if(lt===pe.length)return l(de,Ye),mt&&Ya(de,lt),We;if(Ye===null){for(;lt<pe.length;lt++)Ye=Ee(de,pe[lt],Ce),Ye!==null&&(re=C(Ye,re,lt),vt===null?We=Ye:vt.sibling=Ye,vt=Ye);return mt&&Ya(de,lt),We}for(Ye=c(Ye);lt<pe.length;lt++)ht=_e(Ye,de,lt,pe[lt],Ce),ht!==null&&(e&&ht.alternate!==null&&Ye.delete(ht.key===null?lt:ht.key),re=C(ht,re,lt),vt===null?We=ht:vt.sibling=ht,vt=ht);return e&&Ye.forEach(function(Io){return a(de,Io)}),mt&&Ya(de,lt),We}function Ke(de,re,pe,Ce){if(pe==null)throw Error(i(151));for(var We=null,vt=null,Ye=re,lt=re=0,ht=null,_t=pe.next();Ye!==null&&!_t.done;lt++,_t=pe.next()){Ye.index>lt?(ht=Ye,Ye=null):ht=Ye.sibling;var Io=ye(de,Ye,_t.value,Ce);if(Io===null){Ye===null&&(Ye=ht);break}e&&Ye&&Io.alternate===null&&a(de,Ye),re=C(Io,re,lt),vt===null?We=Io:vt.sibling=Io,vt=Io,Ye=ht}if(_t.done)return l(de,Ye),mt&&Ya(de,lt),We;if(Ye===null){for(;!_t.done;lt++,_t=pe.next())_t=Ee(de,_t.value,Ce),_t!==null&&(re=C(_t,re,lt),vt===null?We=_t:vt.sibling=_t,vt=_t);return mt&&Ya(de,lt),We}for(Ye=c(Ye);!_t.done;lt++,_t=pe.next())_t=_e(Ye,de,lt,_t.value,Ce),_t!==null&&(e&&_t.alternate!==null&&Ye.delete(_t.key===null?lt:_t.key),re=C(_t,re,lt),vt===null?We=_t:vt.sibling=_t,vt=_t);return e&&Ye.forEach(function(b0){return a(de,b0)}),mt&&Ya(de,lt),We}function Tt(de,re,pe,Ce){if(typeof pe=="object"&&pe!==null&&pe.type===S&&pe.key===null&&(pe=pe.props.children),typeof pe=="object"&&pe!==null){switch(pe.$$typeof){case m:e:{for(var We=pe.key;re!==null;){if(re.key===We){if(We=pe.type,We===S){if(re.tag===7){l(de,re.sibling),Ce=v(re,pe.props.children),Ce.return=de,de=Ce;break e}}else if(re.elementType===We||typeof We=="object"&&We!==null&&We.$$typeof===O&&or(We)===re.type){l(de,re.sibling),Ce=v(re,pe.props),Cl(Ce,pe),Ce.return=de,de=Ce;break e}l(de,re);break}else a(de,re);re=re.sibling}pe.type===S?(Ce=Jo(pe.props.children,de.mode,Ce,pe.key),Ce.return=de,de=Ce):(Ce=_s(pe.type,pe.key,pe.props,null,de.mode,Ce),Cl(Ce,pe),Ce.return=de,de=Ce)}return F(de);case x:e:{for(We=pe.key;re!==null;){if(re.key===We)if(re.tag===4&&re.stateNode.containerInfo===pe.containerInfo&&re.stateNode.implementation===pe.implementation){l(de,re.sibling),Ce=v(re,pe.children||[]),Ce.return=de,de=Ce;break e}else{l(de,re);break}else a(de,re);re=re.sibling}Ce=Qi(pe,de.mode,Ce),Ce.return=de,de=Ce}return F(de);case O:return pe=or(pe),Tt(de,re,pe,Ce)}if(L(pe))return ze(de,re,pe,Ce);if(B(pe)){if(We=B(pe),typeof We!="function")throw Error(i(150));return pe=We.call(pe),Ke(de,re,pe,Ce)}if(typeof pe.then=="function")return Tt(de,re,js(pe),Ce);if(pe.$$typeof===k)return Tt(de,re,Cs(de,pe),Ce);ks(de,pe)}return typeof pe=="string"&&pe!==""||typeof pe=="number"||typeof pe=="bigint"?(pe=""+pe,re!==null&&re.tag===6?(l(de,re.sibling),Ce=v(re,pe),Ce.return=de,de=Ce):(l(de,re),Ce=Wi(pe,de.mode,Ce),Ce.return=de,de=Ce),F(de)):l(de,re)}return function(de,re,pe,Ce){try{xl=0;var We=Tt(de,re,pe,Ce);return Fr=null,We}catch(Ye){if(Ye===Rr||Ye===bs)throw Ye;var vt=Mn(29,Ye,null,de.mode);return vt.lanes=Ce,vt.return=de,vt}finally{}}}var lr=ip(!0),cp=ip(!1),_o=!1;function sc(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function ic(e,a){e=e.updateQueue,a.updateQueue===e&&(a.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function wo(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function xo(e,a,l){var c=e.updateQueue;if(c===null)return null;if(c=c.shared,(wt&2)!==0){var v=c.pending;return v===null?a.next=a:(a.next=v.next,v.next=a),c.pending=a,a=vs(e),Gu(e,null,l),a}return gs(e,c,a,l),vs(e)}function Sl(e,a,l){if(a=a.updateQueue,a!==null&&(a=a.shared,(l&4194048)!==0)){var c=a.lanes;c&=e.pendingLanes,l|=c,a.lanes=l,Na(e,l)}}function cc(e,a){var l=e.updateQueue,c=e.alternate;if(c!==null&&(c=c.updateQueue,l===c)){var v=null,C=null;if(l=l.firstBaseUpdate,l!==null){do{var F={lane:l.lane,tag:l.tag,payload:l.payload,callback:null,next:null};C===null?v=C=F:C=C.next=F,l=l.next}while(l!==null);C===null?v=C=a:C=C.next=a}else v=C=a;l={baseState:c.baseState,firstBaseUpdate:v,lastBaseUpdate:C,shared:c.shared,callbacks:c.callbacks},e.updateQueue=l;return}e=l.lastBaseUpdate,e===null?l.firstBaseUpdate=a:e.next=a,l.lastBaseUpdate=a}var dc=!1;function bl(){if(dc){var e=Ar;if(e!==null)throw e}}function El(e,a,l,c){dc=!1;var v=e.updateQueue;_o=!1;var C=v.firstBaseUpdate,F=v.lastBaseUpdate,Y=v.shared.pending;if(Y!==null){v.shared.pending=null;var ae=Y,fe=ae.next;ae.next=null,F===null?C=fe:F.next=fe,F=ae;var we=e.alternate;we!==null&&(we=we.updateQueue,Y=we.lastBaseUpdate,Y!==F&&(Y===null?we.firstBaseUpdate=fe:Y.next=fe,we.lastBaseUpdate=ae))}if(C!==null){var Ee=v.baseState;F=0,we=fe=ae=null,Y=C;do{var ye=Y.lane&-536870913,_e=ye!==Y.lane;if(_e?(ft&ye)===ye:(c&ye)===ye){ye!==0&&ye===Nr&&(dc=!0),we!==null&&(we=we.next={lane:0,tag:Y.tag,payload:Y.payload,callback:null,next:null});e:{var ze=e,Ke=Y;ye=a;var Tt=l;switch(Ke.tag){case 1:if(ze=Ke.payload,typeof ze=="function"){Ee=ze.call(Tt,Ee,ye);break e}Ee=ze;break e;case 3:ze.flags=ze.flags&-65537|128;case 0:if(ze=Ke.payload,ye=typeof ze=="function"?ze.call(Tt,Ee,ye):ze,ye==null)break e;Ee=g({},Ee,ye);break e;case 2:_o=!0}}ye=Y.callback,ye!==null&&(e.flags|=64,_e&&(e.flags|=8192),_e=v.callbacks,_e===null?v.callbacks=[ye]:_e.push(ye))}else _e={lane:ye,tag:Y.tag,payload:Y.payload,callback:Y.callback,next:null},we===null?(fe=we=_e,ae=Ee):we=we.next=_e,F|=ye;if(Y=Y.next,Y===null){if(Y=v.shared.pending,Y===null)break;_e=Y,Y=_e.next,_e.next=null,v.lastBaseUpdate=_e,v.shared.pending=null}}while(!0);we===null&&(ae=Ee),v.baseState=ae,v.firstBaseUpdate=fe,v.lastBaseUpdate=we,C===null&&(v.shared.lanes=0),jo|=F,e.lanes=F,e.memoizedState=Ee}}function dp(e,a){if(typeof e!="function")throw Error(i(191,e));e.call(a)}function up(e,a){var l=e.callbacks;if(l!==null)for(e.callbacks=null,e=0;e<l.length;e++)dp(l[e],a)}var Dr=A(null),Ts=A(0);function pp(e,a){e=oo,J(Ts,e),J(Dr,a),oo=e|a.baseLanes}function uc(){J(Ts,oo),J(Dr,Dr.current)}function pc(){oo=Ts.current,W(Dr),W(Ts)}var Hn=A(null),ia=null;function Co(e){var a=e.alternate;J(zt,zt.current&1),J(Hn,e),ia===null&&(a===null||Dr.current!==null||a.memoizedState!==null)&&(ia=e)}function fc(e){J(zt,zt.current),J(Hn,e),ia===null&&(ia=e)}function fp(e){e.tag===22?(J(zt,zt.current),J(Hn,e),ia===null&&(ia=e)):So()}function So(){J(zt,zt.current),J(Hn,Hn.current)}function Vn(e){W(Hn),ia===e&&(ia=null),W(zt)}var zt=A(0);function Ns(e){for(var a=e;a!==null;){if(a.tag===13){var l=a.memoizedState;if(l!==null&&(l=l.dehydrated,l===null||_d(l)||wd(l)))return a}else if(a.tag===19&&(a.memoizedProps.revealOrder==="forwards"||a.memoizedProps.revealOrder==="backwards"||a.memoizedProps.revealOrder==="unstable_legacy-backwards"||a.memoizedProps.revealOrder==="together")){if((a.flags&128)!==0)return a}else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===e)break;for(;a.sibling===null;){if(a.return===null||a.return===e)return null;a=a.return}a.sibling.return=a.return,a=a.sibling}return null}var Xa=0,ot=null,jt=null,Yt=null,As=!1,$r=!1,sr=!1,Rs=0,jl=0,qr=null,h_=0;function Ot(){throw Error(i(321))}function hc(e,a){if(a===null)return!1;for(var l=0;l<a.length&&l<e.length;l++)if(!On(e[l],a[l]))return!1;return!0}function mc(e,a,l,c,v,C){return Xa=C,ot=a,a.memoizedState=null,a.updateQueue=null,a.lanes=0,T.H=e===null||e.memoizedState===null?Xp:Ac,sr=!1,C=l(c,v),sr=!1,$r&&(C=mp(a,l,c,v)),hp(e),C}function hp(e){T.H=Nl;var a=jt!==null&&jt.next!==null;if(Xa=0,Yt=jt=ot=null,As=!1,jl=0,qr=null,a)throw Error(i(300));e===null||Wt||(e=e.dependencies,e!==null&&xs(e)&&(Wt=!0))}function mp(e,a,l,c){ot=e;var v=0;do{if($r&&(qr=null),jl=0,$r=!1,25<=v)throw Error(i(301));if(v+=1,Yt=jt=null,e.updateQueue!=null){var C=e.updateQueue;C.lastEffect=null,C.events=null,C.stores=null,C.memoCache!=null&&(C.memoCache.index=0)}T.H=Zp,C=a(l,c)}while($r);return C}function m_(){var e=T.H,a=e.useState()[0];return a=typeof a.then=="function"?kl(a):a,e=e.useState()[0],(jt!==null?jt.memoizedState:null)!==e&&(ot.flags|=1024),a}function yc(){var e=Rs!==0;return Rs=0,e}function gc(e,a,l){a.updateQueue=e.updateQueue,a.flags&=-2053,e.lanes&=~l}function vc(e){if(As){for(e=e.memoizedState;e!==null;){var a=e.queue;a!==null&&(a.pending=null),e=e.next}As=!1}Xa=0,Yt=jt=ot=null,$r=!1,jl=Rs=0,qr=null}function Sn(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Yt===null?ot.memoizedState=Yt=e:Yt=Yt.next=e,Yt}function Bt(){if(jt===null){var e=ot.alternate;e=e!==null?e.memoizedState:null}else e=jt.next;var a=Yt===null?ot.memoizedState:Yt.next;if(a!==null)Yt=a,jt=e;else{if(e===null)throw ot.alternate===null?Error(i(467)):Error(i(310));jt=e,e={memoizedState:jt.memoizedState,baseState:jt.baseState,baseQueue:jt.baseQueue,queue:jt.queue,next:null},Yt===null?ot.memoizedState=Yt=e:Yt=Yt.next=e}return Yt}function Fs(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function kl(e){var a=jl;return jl+=1,qr===null&&(qr=[]),e=rp(qr,e,a),a=ot,(Yt===null?a.memoizedState:Yt.next)===null&&(a=a.alternate,T.H=a===null||a.memoizedState===null?Xp:Ac),e}function Ds(e){if(e!==null&&typeof e=="object"){if(typeof e.then=="function")return kl(e);if(e.$$typeof===k)return ln(e)}throw Error(i(438,String(e)))}function _c(e){var a=null,l=ot.updateQueue;if(l!==null&&(a=l.memoCache),a==null){var c=ot.alternate;c!==null&&(c=c.updateQueue,c!==null&&(c=c.memoCache,c!=null&&(a={data:c.data.map(function(v){return v.slice()}),index:0})))}if(a==null&&(a={data:[],index:0}),l===null&&(l=Fs(),ot.updateQueue=l),l.memoCache=a,l=a.data[a.index],l===void 0)for(l=a.data[a.index]=Array(e),c=0;c<e;c++)l[c]=M;return a.index++,l}function Za(e,a){return typeof a=="function"?a(e):a}function $s(e){var a=Bt();return wc(a,jt,e)}function wc(e,a,l){var c=e.queue;if(c===null)throw Error(i(311));c.lastRenderedReducer=l;var v=e.baseQueue,C=c.pending;if(C!==null){if(v!==null){var F=v.next;v.next=C.next,C.next=F}a.baseQueue=v=C,c.pending=null}if(C=e.baseState,v===null)e.memoizedState=C;else{a=v.next;var Y=F=null,ae=null,fe=a,we=!1;do{var Ee=fe.lane&-536870913;if(Ee!==fe.lane?(ft&Ee)===Ee:(Xa&Ee)===Ee){var ye=fe.revertLane;if(ye===0)ae!==null&&(ae=ae.next={lane:0,revertLane:0,gesture:null,action:fe.action,hasEagerState:fe.hasEagerState,eagerState:fe.eagerState,next:null}),Ee===Nr&&(we=!0);else if((Xa&ye)===ye){fe=fe.next,ye===Nr&&(we=!0);continue}else Ee={lane:0,revertLane:fe.revertLane,gesture:null,action:fe.action,hasEagerState:fe.hasEagerState,eagerState:fe.eagerState,next:null},ae===null?(Y=ae=Ee,F=C):ae=ae.next=Ee,ot.lanes|=ye,jo|=ye;Ee=fe.action,sr&&l(C,Ee),C=fe.hasEagerState?fe.eagerState:l(C,Ee)}else ye={lane:Ee,revertLane:fe.revertLane,gesture:fe.gesture,action:fe.action,hasEagerState:fe.hasEagerState,eagerState:fe.eagerState,next:null},ae===null?(Y=ae=ye,F=C):ae=ae.next=ye,ot.lanes|=Ee,jo|=Ee;fe=fe.next}while(fe!==null&&fe!==a);if(ae===null?F=C:ae.next=Y,!On(C,e.memoizedState)&&(Wt=!0,we&&(l=Ar,l!==null)))throw l;e.memoizedState=C,e.baseState=F,e.baseQueue=ae,c.lastRenderedState=C}return v===null&&(c.lanes=0),[e.memoizedState,c.dispatch]}function xc(e){var a=Bt(),l=a.queue;if(l===null)throw Error(i(311));l.lastRenderedReducer=e;var c=l.dispatch,v=l.pending,C=a.memoizedState;if(v!==null){l.pending=null;var F=v=v.next;do C=e(C,F.action),F=F.next;while(F!==v);On(C,a.memoizedState)||(Wt=!0),a.memoizedState=C,a.baseQueue===null&&(a.baseState=C),l.lastRenderedState=C}return[C,c]}function yp(e,a,l){var c=ot,v=Bt(),C=mt;if(C){if(l===void 0)throw Error(i(407));l=l()}else l=a();var F=!On((jt||v).memoizedState,l);if(F&&(v.memoizedState=l,Wt=!0),v=v.queue,bc(_p.bind(null,c,v,e),[e]),v.getSnapshot!==a||F||Yt!==null&&Yt.memoizedState.tag&1){if(c.flags|=2048,Ir(9,{destroy:void 0},vp.bind(null,c,v,l,a),null),At===null)throw Error(i(349));C||(Xa&127)!==0||gp(c,a,l)}return l}function gp(e,a,l){e.flags|=16384,e={getSnapshot:a,value:l},a=ot.updateQueue,a===null?(a=Fs(),ot.updateQueue=a,a.stores=[e]):(l=a.stores,l===null?a.stores=[e]:l.push(e))}function vp(e,a,l,c){a.value=l,a.getSnapshot=c,wp(a)&&xp(e)}function _p(e,a,l){return l(function(){wp(a)&&xp(e)})}function wp(e){var a=e.getSnapshot;e=e.value;try{var l=a();return!On(e,l)}catch{return!0}}function xp(e){var a=Ko(e,2);a!==null&&qn(a,e,2)}function Cc(e){var a=Sn();if(typeof e=="function"){var l=e;if(e=l(),sr){hn(!0);try{l()}finally{hn(!1)}}}return a.memoizedState=a.baseState=e,a.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Za,lastRenderedState:e},a}function Cp(e,a,l,c){return e.baseState=l,wc(e,jt,typeof c=="function"?c:Za)}function y_(e,a,l,c,v){if(Ls(e))throw Error(i(485));if(e=a.action,e!==null){var C={payload:v,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(F){C.listeners.push(F)}};T.T!==null?l(!0):C.isTransition=!1,c(C),l=a.pending,l===null?(C.next=a.pending=C,Sp(a,C)):(C.next=l.next,a.pending=l.next=C)}}function Sp(e,a){var l=a.action,c=a.payload,v=e.state;if(a.isTransition){var C=T.T,F={};T.T=F;try{var Y=l(v,c),ae=T.S;ae!==null&&ae(F,Y),bp(e,a,Y)}catch(fe){Sc(e,a,fe)}finally{C!==null&&F.types!==null&&(C.types=F.types),T.T=C}}else try{C=l(v,c),bp(e,a,C)}catch(fe){Sc(e,a,fe)}}function bp(e,a,l){l!==null&&typeof l=="object"&&typeof l.then=="function"?l.then(function(c){Ep(e,a,c)},function(c){return Sc(e,a,c)}):Ep(e,a,l)}function Ep(e,a,l){a.status="fulfilled",a.value=l,jp(a),e.state=l,a=e.pending,a!==null&&(l=a.next,l===a?e.pending=null:(l=l.next,a.next=l,Sp(e,l)))}function Sc(e,a,l){var c=e.pending;if(e.pending=null,c!==null){c=c.next;do a.status="rejected",a.reason=l,jp(a),a=a.next;while(a!==c)}e.action=null}function jp(e){e=e.listeners;for(var a=0;a<e.length;a++)(0,e[a])()}function kp(e,a){return a}function Tp(e,a){if(mt){var l=At.formState;if(l!==null){e:{var c=ot;if(mt){if($t){t:{for(var v=$t,C=sa;v.nodeType!==8;){if(!C){v=null;break t}if(v=ca(v.nextSibling),v===null){v=null;break t}}C=v.data,v=C==="F!"||C==="F"?v:null}if(v){$t=ca(v.nextSibling),c=v.data==="F!";break e}}go(c)}c=!1}c&&(a=l[0])}}return l=Sn(),l.memoizedState=l.baseState=a,c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:kp,lastRenderedState:a},l.queue=c,l=Yp.bind(null,ot,c),c.dispatch=l,c=Cc(!1),C=Nc.bind(null,ot,!1,c.queue),c=Sn(),v={state:a,dispatch:null,action:e,pending:null},c.queue=v,l=y_.bind(null,ot,v,C,l),v.dispatch=l,c.memoizedState=e,[a,l,!1]}function Np(e){var a=Bt();return Ap(a,jt,e)}function Ap(e,a,l){if(a=wc(e,a,kp)[0],e=$s(Za)[0],typeof a=="object"&&a!==null&&typeof a.then=="function")try{var c=kl(a)}catch(F){throw F===Rr?bs:F}else c=a;a=Bt();var v=a.queue,C=v.dispatch;return l!==a.memoizedState&&(ot.flags|=2048,Ir(9,{destroy:void 0},g_.bind(null,v,l),null)),[c,C,e]}function g_(e,a){e.action=a}function Rp(e){var a=Bt(),l=jt;if(l!==null)return Ap(a,l,e);Bt(),a=a.memoizedState,l=Bt();var c=l.queue.dispatch;return l.memoizedState=e,[a,c,!1]}function Ir(e,a,l,c){return e={tag:e,create:l,deps:c,inst:a,next:null},a=ot.updateQueue,a===null&&(a=Fs(),ot.updateQueue=a),l=a.lastEffect,l===null?a.lastEffect=e.next=e:(c=l.next,l.next=e,e.next=c,a.lastEffect=e),e}function Fp(){return Bt().memoizedState}function qs(e,a,l,c){var v=Sn();ot.flags|=e,v.memoizedState=Ir(1|a,{destroy:void 0},l,c===void 0?null:c)}function Is(e,a,l,c){var v=Bt();c=c===void 0?null:c;var C=v.memoizedState.inst;jt!==null&&c!==null&&hc(c,jt.memoizedState.deps)?v.memoizedState=Ir(a,C,l,c):(ot.flags|=e,v.memoizedState=Ir(1|a,C,l,c))}function Dp(e,a){qs(8390656,8,e,a)}function bc(e,a){Is(2048,8,e,a)}function v_(e){ot.flags|=4;var a=ot.updateQueue;if(a===null)a=Fs(),ot.updateQueue=a,a.events=[e];else{var l=a.events;l===null?a.events=[e]:l.push(e)}}function $p(e){var a=Bt().memoizedState;return v_({ref:a,nextImpl:e}),function(){if((wt&2)!==0)throw Error(i(440));return a.impl.apply(void 0,arguments)}}function qp(e,a){return Is(4,2,e,a)}function Ip(e,a){return Is(4,4,e,a)}function Lp(e,a){if(typeof a=="function"){e=e();var l=a(e);return function(){typeof l=="function"?l():a(null)}}if(a!=null)return e=e(),a.current=e,function(){a.current=null}}function Pp(e,a,l){l=l!=null?l.concat([e]):null,Is(4,4,Lp.bind(null,a,e),l)}function Ec(){}function Up(e,a){var l=Bt();a=a===void 0?null:a;var c=l.memoizedState;return a!==null&&hc(a,c[1])?c[0]:(l.memoizedState=[e,a],e)}function Op(e,a){var l=Bt();a=a===void 0?null:a;var c=l.memoizedState;if(a!==null&&hc(a,c[1]))return c[0];if(c=e(),sr){hn(!0);try{e()}finally{hn(!1)}}return l.memoizedState=[c,a],c}function jc(e,a,l){return l===void 0||(Xa&1073741824)!==0&&(ft&261930)===0?e.memoizedState=a:(e.memoizedState=l,e=Hf(),ot.lanes|=e,jo|=e,l)}function Mp(e,a,l,c){return On(l,a)?l:Dr.current!==null?(e=jc(e,l,c),On(e,a)||(Wt=!0),e):(Xa&42)===0||(Xa&1073741824)!==0&&(ft&261930)===0?(Wt=!0,e.memoizedState=l):(e=Hf(),ot.lanes|=e,jo|=e,a)}function Hp(e,a,l,c,v){var C=q.p;q.p=C!==0&&8>C?C:8;var F=T.T,Y={};T.T=Y,Nc(e,!1,a,l);try{var ae=v(),fe=T.S;if(fe!==null&&fe(Y,ae),ae!==null&&typeof ae=="object"&&typeof ae.then=="function"){var we=f_(ae,c);Tl(e,a,we,Gn(e))}else Tl(e,a,c,Gn(e))}catch(Ee){Tl(e,a,{then:function(){},status:"rejected",reason:Ee},Gn())}finally{q.p=C,F!==null&&Y.types!==null&&(F.types=Y.types),T.T=F}}function __(){}function kc(e,a,l,c){if(e.tag!==5)throw Error(i(476));var v=Vp(e).queue;Hp(e,v,a,P,l===null?__:function(){return zp(e),l(c)})}function Vp(e){var a=e.memoizedState;if(a!==null)return a;a={memoizedState:P,baseState:P,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Za,lastRenderedState:P},next:null};var l={};return a.next={memoizedState:l,baseState:l,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Za,lastRenderedState:l},next:null},e.memoizedState=a,e=e.alternate,e!==null&&(e.memoizedState=a),a}function zp(e){var a=Vp(e);a.next===null&&(a=e.alternate.memoizedState),Tl(e,a.next.queue,{},Gn())}function Tc(){return ln(Bl)}function Bp(){return Bt().memoizedState}function Gp(){return Bt().memoizedState}function w_(e){for(var a=e.return;a!==null;){switch(a.tag){case 24:case 3:var l=Gn();e=wo(l);var c=xo(a,e,l);c!==null&&(qn(c,a,l),Sl(c,a,l)),a={cache:ac()},e.payload=a;return}a=a.return}}function x_(e,a,l){var c=Gn();l={lane:c,revertLane:0,gesture:null,action:l,hasEagerState:!1,eagerState:null,next:null},Ls(e)?Wp(a,l):(l=Gi(e,a,l,c),l!==null&&(qn(l,e,c),Qp(l,a,c)))}function Yp(e,a,l){var c=Gn();Tl(e,a,l,c)}function Tl(e,a,l,c){var v={lane:c,revertLane:0,gesture:null,action:l,hasEagerState:!1,eagerState:null,next:null};if(Ls(e))Wp(a,v);else{var C=e.alternate;if(e.lanes===0&&(C===null||C.lanes===0)&&(C=a.lastRenderedReducer,C!==null))try{var F=a.lastRenderedState,Y=C(F,l);if(v.hasEagerState=!0,v.eagerState=Y,On(Y,F))return gs(e,a,v,0),At===null&&ys(),!1}catch{}finally{}if(l=Gi(e,a,v,c),l!==null)return qn(l,e,c),Qp(l,a,c),!0}return!1}function Nc(e,a,l,c){if(c={lane:2,revertLane:sd(),gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null},Ls(e)){if(a)throw Error(i(479))}else a=Gi(e,l,c,2),a!==null&&qn(a,e,2)}function Ls(e){var a=e.alternate;return e===ot||a!==null&&a===ot}function Wp(e,a){$r=As=!0;var l=e.pending;l===null?a.next=a:(a.next=l.next,l.next=a),e.pending=a}function Qp(e,a,l){if((l&4194048)!==0){var c=a.lanes;c&=e.pendingLanes,l|=c,a.lanes=l,Na(e,l)}}var Nl={readContext:ln,use:Ds,useCallback:Ot,useContext:Ot,useEffect:Ot,useImperativeHandle:Ot,useLayoutEffect:Ot,useInsertionEffect:Ot,useMemo:Ot,useReducer:Ot,useRef:Ot,useState:Ot,useDebugValue:Ot,useDeferredValue:Ot,useTransition:Ot,useSyncExternalStore:Ot,useId:Ot,useHostTransitionStatus:Ot,useFormState:Ot,useActionState:Ot,useOptimistic:Ot,useMemoCache:Ot,useCacheRefresh:Ot};Nl.useEffectEvent=Ot;var Xp={readContext:ln,use:Ds,useCallback:function(e,a){return Sn().memoizedState=[e,a===void 0?null:a],e},useContext:ln,useEffect:Dp,useImperativeHandle:function(e,a,l){l=l!=null?l.concat([e]):null,qs(4194308,4,Lp.bind(null,a,e),l)},useLayoutEffect:function(e,a){return qs(4194308,4,e,a)},useInsertionEffect:function(e,a){qs(4,2,e,a)},useMemo:function(e,a){var l=Sn();a=a===void 0?null:a;var c=e();if(sr){hn(!0);try{e()}finally{hn(!1)}}return l.memoizedState=[c,a],c},useReducer:function(e,a,l){var c=Sn();if(l!==void 0){var v=l(a);if(sr){hn(!0);try{l(a)}finally{hn(!1)}}}else v=a;return c.memoizedState=c.baseState=v,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:v},c.queue=e,e=e.dispatch=x_.bind(null,ot,e),[c.memoizedState,e]},useRef:function(e){var a=Sn();return e={current:e},a.memoizedState=e},useState:function(e){e=Cc(e);var a=e.queue,l=Yp.bind(null,ot,a);return a.dispatch=l,[e.memoizedState,l]},useDebugValue:Ec,useDeferredValue:function(e,a){var l=Sn();return jc(l,e,a)},useTransition:function(){var e=Cc(!1);return e=Hp.bind(null,ot,e.queue,!0,!1),Sn().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,a,l){var c=ot,v=Sn();if(mt){if(l===void 0)throw Error(i(407));l=l()}else{if(l=a(),At===null)throw Error(i(349));(ft&127)!==0||gp(c,a,l)}v.memoizedState=l;var C={value:l,getSnapshot:a};return v.queue=C,Dp(_p.bind(null,c,C,e),[e]),c.flags|=2048,Ir(9,{destroy:void 0},vp.bind(null,c,C,l,a),null),l},useId:function(){var e=Sn(),a=At.identifierPrefix;if(mt){var l=qa,c=$a;l=(c&~(1<<32-Pt(c)-1)).toString(32)+l,a="_"+a+"R_"+l,l=Rs++,0<l&&(a+="H"+l.toString(32)),a+="_"}else l=h_++,a="_"+a+"r_"+l.toString(32)+"_";return e.memoizedState=a},useHostTransitionStatus:Tc,useFormState:Tp,useActionState:Tp,useOptimistic:function(e){var a=Sn();a.memoizedState=a.baseState=e;var l={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return a.queue=l,a=Nc.bind(null,ot,!0,l),l.dispatch=a,[e,a]},useMemoCache:_c,useCacheRefresh:function(){return Sn().memoizedState=w_.bind(null,ot)},useEffectEvent:function(e){var a=Sn(),l={impl:e};return a.memoizedState=l,function(){if((wt&2)!==0)throw Error(i(440));return l.impl.apply(void 0,arguments)}}},Ac={readContext:ln,use:Ds,useCallback:Up,useContext:ln,useEffect:bc,useImperativeHandle:Pp,useInsertionEffect:qp,useLayoutEffect:Ip,useMemo:Op,useReducer:$s,useRef:Fp,useState:function(){return $s(Za)},useDebugValue:Ec,useDeferredValue:function(e,a){var l=Bt();return Mp(l,jt.memoizedState,e,a)},useTransition:function(){var e=$s(Za)[0],a=Bt().memoizedState;return[typeof e=="boolean"?e:kl(e),a]},useSyncExternalStore:yp,useId:Bp,useHostTransitionStatus:Tc,useFormState:Np,useActionState:Np,useOptimistic:function(e,a){var l=Bt();return Cp(l,jt,e,a)},useMemoCache:_c,useCacheRefresh:Gp};Ac.useEffectEvent=$p;var Zp={readContext:ln,use:Ds,useCallback:Up,useContext:ln,useEffect:bc,useImperativeHandle:Pp,useInsertionEffect:qp,useLayoutEffect:Ip,useMemo:Op,useReducer:xc,useRef:Fp,useState:function(){return xc(Za)},useDebugValue:Ec,useDeferredValue:function(e,a){var l=Bt();return jt===null?jc(l,e,a):Mp(l,jt.memoizedState,e,a)},useTransition:function(){var e=xc(Za)[0],a=Bt().memoizedState;return[typeof e=="boolean"?e:kl(e),a]},useSyncExternalStore:yp,useId:Bp,useHostTransitionStatus:Tc,useFormState:Rp,useActionState:Rp,useOptimistic:function(e,a){var l=Bt();return jt!==null?Cp(l,jt,e,a):(l.baseState=e,[e,l.queue.dispatch])},useMemoCache:_c,useCacheRefresh:Gp};Zp.useEffectEvent=$p;function Rc(e,a,l,c){a=e.memoizedState,l=l(c,a),l=l==null?a:g({},a,l),e.memoizedState=l,e.lanes===0&&(e.updateQueue.baseState=l)}var Fc={enqueueSetState:function(e,a,l){e=e._reactInternals;var c=Gn(),v=wo(c);v.payload=a,l!=null&&(v.callback=l),a=xo(e,v,c),a!==null&&(qn(a,e,c),Sl(a,e,c))},enqueueReplaceState:function(e,a,l){e=e._reactInternals;var c=Gn(),v=wo(c);v.tag=1,v.payload=a,l!=null&&(v.callback=l),a=xo(e,v,c),a!==null&&(qn(a,e,c),Sl(a,e,c))},enqueueForceUpdate:function(e,a){e=e._reactInternals;var l=Gn(),c=wo(l);c.tag=2,a!=null&&(c.callback=a),a=xo(e,c,l),a!==null&&(qn(a,e,l),Sl(a,e,l))}};function Kp(e,a,l,c,v,C,F){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(c,C,F):a.prototype&&a.prototype.isPureReactComponent?!ml(l,c)||!ml(v,C):!0}function Jp(e,a,l,c){e=a.state,typeof a.componentWillReceiveProps=="function"&&a.componentWillReceiveProps(l,c),typeof a.UNSAFE_componentWillReceiveProps=="function"&&a.UNSAFE_componentWillReceiveProps(l,c),a.state!==e&&Fc.enqueueReplaceState(a,a.state,null)}function ir(e,a){var l=a;if("ref"in a){l={};for(var c in a)c!=="ref"&&(l[c]=a[c])}if(e=e.defaultProps){l===a&&(l=g({},l));for(var v in e)l[v]===void 0&&(l[v]=e[v])}return l}function ef(e){ms(e)}function tf(e){console.error(e)}function nf(e){ms(e)}function Ps(e,a){try{var l=e.onUncaughtError;l(a.value,{componentStack:a.stack})}catch(c){setTimeout(function(){throw c})}}function af(e,a,l){try{var c=e.onCaughtError;c(l.value,{componentStack:l.stack,errorBoundary:a.tag===1?a.stateNode:null})}catch(v){setTimeout(function(){throw v})}}function Dc(e,a,l){return l=wo(l),l.tag=3,l.payload={element:null},l.callback=function(){Ps(e,a)},l}function of(e){return e=wo(e),e.tag=3,e}function rf(e,a,l,c){var v=l.type.getDerivedStateFromError;if(typeof v=="function"){var C=c.value;e.payload=function(){return v(C)},e.callback=function(){af(a,l,c)}}var F=l.stateNode;F!==null&&typeof F.componentDidCatch=="function"&&(e.callback=function(){af(a,l,c),typeof v!="function"&&(ko===null?ko=new Set([this]):ko.add(this));var Y=c.stack;this.componentDidCatch(c.value,{componentStack:Y!==null?Y:""})})}function C_(e,a,l,c,v){if(l.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){if(a=l.alternate,a!==null&&Tr(a,l,v,!0),l=Hn.current,l!==null){switch(l.tag){case 31:case 13:return ia===null?Xs():l.alternate===null&&Mt===0&&(Mt=3),l.flags&=-257,l.flags|=65536,l.lanes=v,c===Es?l.flags|=16384:(a=l.updateQueue,a===null?l.updateQueue=new Set([c]):a.add(c),od(e,c,v)),!1;case 22:return l.flags|=65536,c===Es?l.flags|=16384:(a=l.updateQueue,a===null?(a={transitions:null,markerInstances:null,retryQueue:new Set([c])},l.updateQueue=a):(l=a.retryQueue,l===null?a.retryQueue=new Set([c]):l.add(c)),od(e,c,v)),!1}throw Error(i(435,l.tag))}return od(e,c,v),Xs(),!1}if(mt)return a=Hn.current,a!==null?((a.flags&65536)===0&&(a.flags|=256),a.flags|=65536,a.lanes=v,c!==Ki&&(e=Error(i(422),{cause:c}),vl(oa(e,l)))):(c!==Ki&&(a=Error(i(423),{cause:c}),vl(oa(a,l))),e=e.current.alternate,e.flags|=65536,v&=-v,e.lanes|=v,c=oa(c,l),v=Dc(e.stateNode,c,v),cc(e,v),Mt!==4&&(Mt=2)),!1;var C=Error(i(520),{cause:c});if(C=oa(C,l),Ll===null?Ll=[C]:Ll.push(C),Mt!==4&&(Mt=2),a===null)return!0;c=oa(c,l),l=a;do{switch(l.tag){case 3:return l.flags|=65536,e=v&-v,l.lanes|=e,e=Dc(l.stateNode,c,e),cc(l,e),!1;case 1:if(a=l.type,C=l.stateNode,(l.flags&128)===0&&(typeof a.getDerivedStateFromError=="function"||C!==null&&typeof C.componentDidCatch=="function"&&(ko===null||!ko.has(C))))return l.flags|=65536,v&=-v,l.lanes|=v,v=of(v),rf(v,e,l,c),cc(l,v),!1}l=l.return}while(l!==null);return!1}var $c=Error(i(461)),Wt=!1;function sn(e,a,l,c){a.child=e===null?cp(a,null,l,c):lr(a,e.child,l,c)}function lf(e,a,l,c,v){l=l.render;var C=a.ref;if("ref"in c){var F={};for(var Y in c)Y!=="ref"&&(F[Y]=c[Y])}else F=c;return nr(a),c=mc(e,a,l,F,C,v),Y=yc(),e!==null&&!Wt?(gc(e,a,v),Ka(e,a,v)):(mt&&Y&&Xi(a),a.flags|=1,sn(e,a,c,v),a.child)}function sf(e,a,l,c,v){if(e===null){var C=l.type;return typeof C=="function"&&!Yi(C)&&C.defaultProps===void 0&&l.compare===null?(a.tag=15,a.type=C,cf(e,a,C,c,v)):(e=_s(l.type,null,c,a,a.mode,v),e.ref=a.ref,e.return=a,a.child=e)}if(C=e.child,!Hc(e,v)){var F=C.memoizedProps;if(l=l.compare,l=l!==null?l:ml,l(F,c)&&e.ref===a.ref)return Ka(e,a,v)}return a.flags|=1,e=Ga(C,c),e.ref=a.ref,e.return=a,a.child=e}function cf(e,a,l,c,v){if(e!==null){var C=e.memoizedProps;if(ml(C,c)&&e.ref===a.ref)if(Wt=!1,a.pendingProps=c=C,Hc(e,v))(e.flags&131072)!==0&&(Wt=!0);else return a.lanes=e.lanes,Ka(e,a,v)}return qc(e,a,l,c,v)}function df(e,a,l,c){var v=c.children,C=e!==null?e.memoizedState:null;if(e===null&&a.stateNode===null&&(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),c.mode==="hidden"){if((a.flags&128)!==0){if(C=C!==null?C.baseLanes|l:l,e!==null){for(c=a.child=e.child,v=0;c!==null;)v=v|c.lanes|c.childLanes,c=c.sibling;c=v&~C}else c=0,a.child=null;return uf(e,a,C,l,c)}if((l&536870912)!==0)a.memoizedState={baseLanes:0,cachePool:null},e!==null&&Ss(a,C!==null?C.cachePool:null),C!==null?pp(a,C):uc(),fp(a);else return c=a.lanes=536870912,uf(e,a,C!==null?C.baseLanes|l:l,l,c)}else C!==null?(Ss(a,C.cachePool),pp(a,C),So(),a.memoizedState=null):(e!==null&&Ss(a,null),uc(),So());return sn(e,a,v,l),a.child}function Al(e,a){return e!==null&&e.tag===22||a.stateNode!==null||(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),a.sibling}function uf(e,a,l,c,v){var C=rc();return C=C===null?null:{parent:Gt._currentValue,pool:C},a.memoizedState={baseLanes:l,cachePool:C},e!==null&&Ss(a,null),uc(),fp(a),e!==null&&Tr(e,a,c,!0),a.childLanes=v,null}function Us(e,a){return a=Ms({mode:a.mode,children:a.children},e.mode),a.ref=e.ref,e.child=a,a.return=e,a}function pf(e,a,l){return lr(a,e.child,null,l),e=Us(a,a.pendingProps),e.flags|=2,Vn(a),a.memoizedState=null,e}function S_(e,a,l){var c=a.pendingProps,v=(a.flags&128)!==0;if(a.flags&=-129,e===null){if(mt){if(c.mode==="hidden")return e=Us(a,c),a.lanes=536870912,Al(null,e);if(fc(a),(e=$t)?(e=bh(e,sa),e=e!==null&&e.data==="&"?e:null,e!==null&&(a.memoizedState={dehydrated:e,treeContext:mo!==null?{id:$a,overflow:qa}:null,retryLane:536870912,hydrationErrors:null},l=Wu(e),l.return=a,a.child=l,rn=a,$t=null)):e=null,e===null)throw go(a);return a.lanes=536870912,null}return Us(a,c)}var C=e.memoizedState;if(C!==null){var F=C.dehydrated;if(fc(a),v)if(a.flags&256)a.flags&=-257,a=pf(e,a,l);else if(a.memoizedState!==null)a.child=e.child,a.flags|=128,a=null;else throw Error(i(558));else if(Wt||Tr(e,a,l,!1),v=(l&e.childLanes)!==0,Wt||v){if(c=At,c!==null&&(F=Aa(c,l),F!==0&&F!==C.retryLane))throw C.retryLane=F,Ko(e,F),qn(c,e,F),$c;Xs(),a=pf(e,a,l)}else e=C.treeContext,$t=ca(F.nextSibling),rn=a,mt=!0,yo=null,sa=!1,e!==null&&Zu(a,e),a=Us(a,c),a.flags|=4096;return a}return e=Ga(e.child,{mode:c.mode,children:c.children}),e.ref=a.ref,a.child=e,e.return=a,e}function Os(e,a){var l=a.ref;if(l===null)e!==null&&e.ref!==null&&(a.flags|=4194816);else{if(typeof l!="function"&&typeof l!="object")throw Error(i(284));(e===null||e.ref!==l)&&(a.flags|=4194816)}}function qc(e,a,l,c,v){return nr(a),l=mc(e,a,l,c,void 0,v),c=yc(),e!==null&&!Wt?(gc(e,a,v),Ka(e,a,v)):(mt&&c&&Xi(a),a.flags|=1,sn(e,a,l,v),a.child)}function ff(e,a,l,c,v,C){return nr(a),a.updateQueue=null,l=mp(a,c,l,v),hp(e),c=yc(),e!==null&&!Wt?(gc(e,a,C),Ka(e,a,C)):(mt&&c&&Xi(a),a.flags|=1,sn(e,a,l,C),a.child)}function hf(e,a,l,c,v){if(nr(a),a.stateNode===null){var C=br,F=l.contextType;typeof F=="object"&&F!==null&&(C=ln(F)),C=new l(c,C),a.memoizedState=C.state!==null&&C.state!==void 0?C.state:null,C.updater=Fc,a.stateNode=C,C._reactInternals=a,C=a.stateNode,C.props=c,C.state=a.memoizedState,C.refs={},sc(a),F=l.contextType,C.context=typeof F=="object"&&F!==null?ln(F):br,C.state=a.memoizedState,F=l.getDerivedStateFromProps,typeof F=="function"&&(Rc(a,l,F,c),C.state=a.memoizedState),typeof l.getDerivedStateFromProps=="function"||typeof C.getSnapshotBeforeUpdate=="function"||typeof C.UNSAFE_componentWillMount!="function"&&typeof C.componentWillMount!="function"||(F=C.state,typeof C.componentWillMount=="function"&&C.componentWillMount(),typeof C.UNSAFE_componentWillMount=="function"&&C.UNSAFE_componentWillMount(),F!==C.state&&Fc.enqueueReplaceState(C,C.state,null),El(a,c,C,v),bl(),C.state=a.memoizedState),typeof C.componentDidMount=="function"&&(a.flags|=4194308),c=!0}else if(e===null){C=a.stateNode;var Y=a.memoizedProps,ae=ir(l,Y);C.props=ae;var fe=C.context,we=l.contextType;F=br,typeof we=="object"&&we!==null&&(F=ln(we));var Ee=l.getDerivedStateFromProps;we=typeof Ee=="function"||typeof C.getSnapshotBeforeUpdate=="function",Y=a.pendingProps!==Y,we||typeof C.UNSAFE_componentWillReceiveProps!="function"&&typeof C.componentWillReceiveProps!="function"||(Y||fe!==F)&&Jp(a,C,c,F),_o=!1;var ye=a.memoizedState;C.state=ye,El(a,c,C,v),bl(),fe=a.memoizedState,Y||ye!==fe||_o?(typeof Ee=="function"&&(Rc(a,l,Ee,c),fe=a.memoizedState),(ae=_o||Kp(a,l,ae,c,ye,fe,F))?(we||typeof C.UNSAFE_componentWillMount!="function"&&typeof C.componentWillMount!="function"||(typeof C.componentWillMount=="function"&&C.componentWillMount(),typeof C.UNSAFE_componentWillMount=="function"&&C.UNSAFE_componentWillMount()),typeof C.componentDidMount=="function"&&(a.flags|=4194308)):(typeof C.componentDidMount=="function"&&(a.flags|=4194308),a.memoizedProps=c,a.memoizedState=fe),C.props=c,C.state=fe,C.context=F,c=ae):(typeof C.componentDidMount=="function"&&(a.flags|=4194308),c=!1)}else{C=a.stateNode,ic(e,a),F=a.memoizedProps,we=ir(l,F),C.props=we,Ee=a.pendingProps,ye=C.context,fe=l.contextType,ae=br,typeof fe=="object"&&fe!==null&&(ae=ln(fe)),Y=l.getDerivedStateFromProps,(fe=typeof Y=="function"||typeof C.getSnapshotBeforeUpdate=="function")||typeof C.UNSAFE_componentWillReceiveProps!="function"&&typeof C.componentWillReceiveProps!="function"||(F!==Ee||ye!==ae)&&Jp(a,C,c,ae),_o=!1,ye=a.memoizedState,C.state=ye,El(a,c,C,v),bl();var _e=a.memoizedState;F!==Ee||ye!==_e||_o||e!==null&&e.dependencies!==null&&xs(e.dependencies)?(typeof Y=="function"&&(Rc(a,l,Y,c),_e=a.memoizedState),(we=_o||Kp(a,l,we,c,ye,_e,ae)||e!==null&&e.dependencies!==null&&xs(e.dependencies))?(fe||typeof C.UNSAFE_componentWillUpdate!="function"&&typeof C.componentWillUpdate!="function"||(typeof C.componentWillUpdate=="function"&&C.componentWillUpdate(c,_e,ae),typeof C.UNSAFE_componentWillUpdate=="function"&&C.UNSAFE_componentWillUpdate(c,_e,ae)),typeof C.componentDidUpdate=="function"&&(a.flags|=4),typeof C.getSnapshotBeforeUpdate=="function"&&(a.flags|=1024)):(typeof C.componentDidUpdate!="function"||F===e.memoizedProps&&ye===e.memoizedState||(a.flags|=4),typeof C.getSnapshotBeforeUpdate!="function"||F===e.memoizedProps&&ye===e.memoizedState||(a.flags|=1024),a.memoizedProps=c,a.memoizedState=_e),C.props=c,C.state=_e,C.context=ae,c=we):(typeof C.componentDidUpdate!="function"||F===e.memoizedProps&&ye===e.memoizedState||(a.flags|=4),typeof C.getSnapshotBeforeUpdate!="function"||F===e.memoizedProps&&ye===e.memoizedState||(a.flags|=1024),c=!1)}return C=c,Os(e,a),c=(a.flags&128)!==0,C||c?(C=a.stateNode,l=c&&typeof l.getDerivedStateFromError!="function"?null:C.render(),a.flags|=1,e!==null&&c?(a.child=lr(a,e.child,null,v),a.child=lr(a,null,l,v)):sn(e,a,l,v),a.memoizedState=C.state,e=a.child):e=Ka(e,a,v),e}function mf(e,a,l,c){return er(),a.flags|=256,sn(e,a,l,c),a.child}var Ic={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Lc(e){return{baseLanes:e,cachePool:ap()}}function Pc(e,a,l){return e=e!==null?e.childLanes&~l:0,a&&(e|=Bn),e}function yf(e,a,l){var c=a.pendingProps,v=!1,C=(a.flags&128)!==0,F;if((F=C)||(F=e!==null&&e.memoizedState===null?!1:(zt.current&2)!==0),F&&(v=!0,a.flags&=-129),F=(a.flags&32)!==0,a.flags&=-33,e===null){if(mt){if(v?Co(a):So(),(e=$t)?(e=bh(e,sa),e=e!==null&&e.data!=="&"?e:null,e!==null&&(a.memoizedState={dehydrated:e,treeContext:mo!==null?{id:$a,overflow:qa}:null,retryLane:536870912,hydrationErrors:null},l=Wu(e),l.return=a,a.child=l,rn=a,$t=null)):e=null,e===null)throw go(a);return wd(e)?a.lanes=32:a.lanes=536870912,null}var Y=c.children;return c=c.fallback,v?(So(),v=a.mode,Y=Ms({mode:"hidden",children:Y},v),c=Jo(c,v,l,null),Y.return=a,c.return=a,Y.sibling=c,a.child=Y,c=a.child,c.memoizedState=Lc(l),c.childLanes=Pc(e,F,l),a.memoizedState=Ic,Al(null,c)):(Co(a),Uc(a,Y))}var ae=e.memoizedState;if(ae!==null&&(Y=ae.dehydrated,Y!==null)){if(C)a.flags&256?(Co(a),a.flags&=-257,a=Oc(e,a,l)):a.memoizedState!==null?(So(),a.child=e.child,a.flags|=128,a=null):(So(),Y=c.fallback,v=a.mode,c=Ms({mode:"visible",children:c.children},v),Y=Jo(Y,v,l,null),Y.flags|=2,c.return=a,Y.return=a,c.sibling=Y,a.child=c,lr(a,e.child,null,l),c=a.child,c.memoizedState=Lc(l),c.childLanes=Pc(e,F,l),a.memoizedState=Ic,a=Al(null,c));else if(Co(a),wd(Y)){if(F=Y.nextSibling&&Y.nextSibling.dataset,F)var fe=F.dgst;F=fe,c=Error(i(419)),c.stack="",c.digest=F,vl({value:c,source:null,stack:null}),a=Oc(e,a,l)}else if(Wt||Tr(e,a,l,!1),F=(l&e.childLanes)!==0,Wt||F){if(F=At,F!==null&&(c=Aa(F,l),c!==0&&c!==ae.retryLane))throw ae.retryLane=c,Ko(e,c),qn(F,e,c),$c;_d(Y)||Xs(),a=Oc(e,a,l)}else _d(Y)?(a.flags|=192,a.child=e.child,a=null):(e=ae.treeContext,$t=ca(Y.nextSibling),rn=a,mt=!0,yo=null,sa=!1,e!==null&&Zu(a,e),a=Uc(a,c.children),a.flags|=4096);return a}return v?(So(),Y=c.fallback,v=a.mode,ae=e.child,fe=ae.sibling,c=Ga(ae,{mode:"hidden",children:c.children}),c.subtreeFlags=ae.subtreeFlags&65011712,fe!==null?Y=Ga(fe,Y):(Y=Jo(Y,v,l,null),Y.flags|=2),Y.return=a,c.return=a,c.sibling=Y,a.child=c,Al(null,c),c=a.child,Y=e.child.memoizedState,Y===null?Y=Lc(l):(v=Y.cachePool,v!==null?(ae=Gt._currentValue,v=v.parent!==ae?{parent:ae,pool:ae}:v):v=ap(),Y={baseLanes:Y.baseLanes|l,cachePool:v}),c.memoizedState=Y,c.childLanes=Pc(e,F,l),a.memoizedState=Ic,Al(e.child,c)):(Co(a),l=e.child,e=l.sibling,l=Ga(l,{mode:"visible",children:c.children}),l.return=a,l.sibling=null,e!==null&&(F=a.deletions,F===null?(a.deletions=[e],a.flags|=16):F.push(e)),a.child=l,a.memoizedState=null,l)}function Uc(e,a){return a=Ms({mode:"visible",children:a},e.mode),a.return=e,e.child=a}function Ms(e,a){return e=Mn(22,e,null,a),e.lanes=0,e}function Oc(e,a,l){return lr(a,e.child,null,l),e=Uc(a,a.pendingProps.children),e.flags|=2,a.memoizedState=null,e}function gf(e,a,l){e.lanes|=a;var c=e.alternate;c!==null&&(c.lanes|=a),tc(e.return,a,l)}function Mc(e,a,l,c,v,C){var F=e.memoizedState;F===null?e.memoizedState={isBackwards:a,rendering:null,renderingStartTime:0,last:c,tail:l,tailMode:v,treeForkCount:C}:(F.isBackwards=a,F.rendering=null,F.renderingStartTime=0,F.last=c,F.tail=l,F.tailMode=v,F.treeForkCount=C)}function vf(e,a,l){var c=a.pendingProps,v=c.revealOrder,C=c.tail;c=c.children;var F=zt.current,Y=(F&2)!==0;if(Y?(F=F&1|2,a.flags|=128):F&=1,J(zt,F),sn(e,a,c,l),c=mt?gl:0,!Y&&e!==null&&(e.flags&128)!==0)e:for(e=a.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&gf(e,l,a);else if(e.tag===19)gf(e,l,a);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===a)break e;for(;e.sibling===null;){if(e.return===null||e.return===a)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}switch(v){case"forwards":for(l=a.child,v=null;l!==null;)e=l.alternate,e!==null&&Ns(e)===null&&(v=l),l=l.sibling;l=v,l===null?(v=a.child,a.child=null):(v=l.sibling,l.sibling=null),Mc(a,!1,v,l,C,c);break;case"backwards":case"unstable_legacy-backwards":for(l=null,v=a.child,a.child=null;v!==null;){if(e=v.alternate,e!==null&&Ns(e)===null){a.child=v;break}e=v.sibling,v.sibling=l,l=v,v=e}Mc(a,!0,l,null,C,c);break;case"together":Mc(a,!1,null,null,void 0,c);break;default:a.memoizedState=null}return a.child}function Ka(e,a,l){if(e!==null&&(a.dependencies=e.dependencies),jo|=a.lanes,(l&a.childLanes)===0)if(e!==null){if(Tr(e,a,l,!1),(l&a.childLanes)===0)return null}else return null;if(e!==null&&a.child!==e.child)throw Error(i(153));if(a.child!==null){for(e=a.child,l=Ga(e,e.pendingProps),a.child=l,l.return=a;e.sibling!==null;)e=e.sibling,l=l.sibling=Ga(e,e.pendingProps),l.return=a;l.sibling=null}return a.child}function Hc(e,a){return(e.lanes&a)!==0?!0:(e=e.dependencies,!!(e!==null&&xs(e)))}function b_(e,a,l){switch(a.tag){case 3:ke(a,a.stateNode.containerInfo),vo(a,Gt,e.memoizedState.cache),er();break;case 27:case 5:ie(a);break;case 4:ke(a,a.stateNode.containerInfo);break;case 10:vo(a,a.type,a.memoizedProps.value);break;case 31:if(a.memoizedState!==null)return a.flags|=128,fc(a),null;break;case 13:var c=a.memoizedState;if(c!==null)return c.dehydrated!==null?(Co(a),a.flags|=128,null):(l&a.child.childLanes)!==0?yf(e,a,l):(Co(a),e=Ka(e,a,l),e!==null?e.sibling:null);Co(a);break;case 19:var v=(e.flags&128)!==0;if(c=(l&a.childLanes)!==0,c||(Tr(e,a,l,!1),c=(l&a.childLanes)!==0),v){if(c)return vf(e,a,l);a.flags|=128}if(v=a.memoizedState,v!==null&&(v.rendering=null,v.tail=null,v.lastEffect=null),J(zt,zt.current),c)break;return null;case 22:return a.lanes=0,df(e,a,l,a.pendingProps);case 24:vo(a,Gt,e.memoizedState.cache)}return Ka(e,a,l)}function _f(e,a,l){if(e!==null)if(e.memoizedProps!==a.pendingProps)Wt=!0;else{if(!Hc(e,l)&&(a.flags&128)===0)return Wt=!1,b_(e,a,l);Wt=(e.flags&131072)!==0}else Wt=!1,mt&&(a.flags&1048576)!==0&&Xu(a,gl,a.index);switch(a.lanes=0,a.tag){case 16:e:{var c=a.pendingProps;if(e=or(a.elementType),a.type=e,typeof e=="function")Yi(e)?(c=ir(e,c),a.tag=1,a=hf(null,a,e,c,l)):(a.tag=0,a=qc(null,a,e,c,l));else{if(e!=null){var v=e.$$typeof;if(v===N){a.tag=11,a=lf(null,a,e,c,l);break e}else if(v===R){a.tag=14,a=sf(null,a,e,c,l);break e}}throw a=D(e)||e,Error(i(306,a,""))}}return a;case 0:return qc(e,a,a.type,a.pendingProps,l);case 1:return c=a.type,v=ir(c,a.pendingProps),hf(e,a,c,v,l);case 3:e:{if(ke(a,a.stateNode.containerInfo),e===null)throw Error(i(387));c=a.pendingProps;var C=a.memoizedState;v=C.element,ic(e,a),El(a,c,null,l);var F=a.memoizedState;if(c=F.cache,vo(a,Gt,c),c!==C.cache&&nc(a,[Gt],l,!0),bl(),c=F.element,C.isDehydrated)if(C={element:c,isDehydrated:!1,cache:F.cache},a.updateQueue.baseState=C,a.memoizedState=C,a.flags&256){a=mf(e,a,c,l);break e}else if(c!==v){v=oa(Error(i(424)),a),vl(v),a=mf(e,a,c,l);break e}else{switch(e=a.stateNode.containerInfo,e.nodeType){case 9:e=e.body;break;default:e=e.nodeName==="HTML"?e.ownerDocument.body:e}for($t=ca(e.firstChild),rn=a,mt=!0,yo=null,sa=!0,l=cp(a,null,c,l),a.child=l;l;)l.flags=l.flags&-3|4096,l=l.sibling}else{if(er(),c===v){a=Ka(e,a,l);break e}sn(e,a,c,l)}a=a.child}return a;case 26:return Os(e,a),e===null?(l=Ah(a.type,null,a.pendingProps,null))?a.memoizedState=l:mt||(l=a.type,e=a.pendingProps,c=ai(oe.current).createElement(l),c[Dt]=a,c[Ut]=e,cn(c,l,e),Nt(c),a.stateNode=c):a.memoizedState=Ah(a.type,e.memoizedProps,a.pendingProps,e.memoizedState),null;case 27:return ie(a),e===null&&mt&&(c=a.stateNode=kh(a.type,a.pendingProps,oe.current),rn=a,sa=!0,v=$t,Ro(a.type)?(xd=v,$t=ca(c.firstChild)):$t=v),sn(e,a,a.pendingProps.children,l),Os(e,a),e===null&&(a.flags|=4194304),a.child;case 5:return e===null&&mt&&((v=c=$t)&&(c=e0(c,a.type,a.pendingProps,sa),c!==null?(a.stateNode=c,rn=a,$t=ca(c.firstChild),sa=!1,v=!0):v=!1),v||go(a)),ie(a),v=a.type,C=a.pendingProps,F=e!==null?e.memoizedProps:null,c=C.children,yd(v,C)?c=null:F!==null&&yd(v,F)&&(a.flags|=32),a.memoizedState!==null&&(v=mc(e,a,m_,null,null,l),Bl._currentValue=v),Os(e,a),sn(e,a,c,l),a.child;case 6:return e===null&&mt&&((e=l=$t)&&(l=t0(l,a.pendingProps,sa),l!==null?(a.stateNode=l,rn=a,$t=null,e=!0):e=!1),e||go(a)),null;case 13:return yf(e,a,l);case 4:return ke(a,a.stateNode.containerInfo),c=a.pendingProps,e===null?a.child=lr(a,null,c,l):sn(e,a,c,l),a.child;case 11:return lf(e,a,a.type,a.pendingProps,l);case 7:return sn(e,a,a.pendingProps,l),a.child;case 8:return sn(e,a,a.pendingProps.children,l),a.child;case 12:return sn(e,a,a.pendingProps.children,l),a.child;case 10:return c=a.pendingProps,vo(a,a.type,c.value),sn(e,a,c.children,l),a.child;case 9:return v=a.type._context,c=a.pendingProps.children,nr(a),v=ln(v),c=c(v),a.flags|=1,sn(e,a,c,l),a.child;case 14:return sf(e,a,a.type,a.pendingProps,l);case 15:return cf(e,a,a.type,a.pendingProps,l);case 19:return vf(e,a,l);case 31:return S_(e,a,l);case 22:return df(e,a,l,a.pendingProps);case 24:return nr(a),c=ln(Gt),e===null?(v=rc(),v===null&&(v=At,C=ac(),v.pooledCache=C,C.refCount++,C!==null&&(v.pooledCacheLanes|=l),v=C),a.memoizedState={parent:c,cache:v},sc(a),vo(a,Gt,v)):((e.lanes&l)!==0&&(ic(e,a),El(a,null,null,l),bl()),v=e.memoizedState,C=a.memoizedState,v.parent!==c?(v={parent:c,cache:c},a.memoizedState=v,a.lanes===0&&(a.memoizedState=a.updateQueue.baseState=v),vo(a,Gt,c)):(c=C.cache,vo(a,Gt,c),c!==v.cache&&nc(a,[Gt],l,!0))),sn(e,a,a.pendingProps.children,l),a.child;case 29:throw a.pendingProps}throw Error(i(156,a.tag))}function Ja(e){e.flags|=4}function Vc(e,a,l,c,v){if((a=(e.mode&32)!==0)&&(a=!1),a){if(e.flags|=16777216,(v&335544128)===v)if(e.stateNode.complete)e.flags|=8192;else if(Gf())e.flags|=8192;else throw rr=Es,lc}else e.flags&=-16777217}function wf(e,a){if(a.type!=="stylesheet"||(a.state.loading&4)!==0)e.flags&=-16777217;else if(e.flags|=16777216,!qh(a))if(Gf())e.flags|=8192;else throw rr=Es,lc}function Hs(e,a){a!==null&&(e.flags|=4),e.flags&16384&&(a=e.tag!==22?ka():536870912,e.lanes|=a,Or|=a)}function Rl(e,a){if(!mt)switch(e.tailMode){case"hidden":a=e.tail;for(var l=null;a!==null;)a.alternate!==null&&(l=a),a=a.sibling;l===null?e.tail=null:l.sibling=null;break;case"collapsed":l=e.tail;for(var c=null;l!==null;)l.alternate!==null&&(c=l),l=l.sibling;c===null?a||e.tail===null?e.tail=null:e.tail.sibling=null:c.sibling=null}}function qt(e){var a=e.alternate!==null&&e.alternate.child===e.child,l=0,c=0;if(a)for(var v=e.child;v!==null;)l|=v.lanes|v.childLanes,c|=v.subtreeFlags&65011712,c|=v.flags&65011712,v.return=e,v=v.sibling;else for(v=e.child;v!==null;)l|=v.lanes|v.childLanes,c|=v.subtreeFlags,c|=v.flags,v.return=e,v=v.sibling;return e.subtreeFlags|=c,e.childLanes=l,a}function E_(e,a,l){var c=a.pendingProps;switch(Zi(a),a.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return qt(a),null;case 1:return qt(a),null;case 3:return l=a.stateNode,c=null,e!==null&&(c=e.memoizedState.cache),a.memoizedState.cache!==c&&(a.flags|=2048),Qa(Gt),xe(),l.pendingContext&&(l.context=l.pendingContext,l.pendingContext=null),(e===null||e.child===null)&&(kr(a)?Ja(a):e===null||e.memoizedState.isDehydrated&&(a.flags&256)===0||(a.flags|=1024,Ji())),qt(a),null;case 26:var v=a.type,C=a.memoizedState;return e===null?(Ja(a),C!==null?(qt(a),wf(a,C)):(qt(a),Vc(a,v,null,c,l))):C?C!==e.memoizedState?(Ja(a),qt(a),wf(a,C)):(qt(a),a.flags&=-16777217):(e=e.memoizedProps,e!==c&&Ja(a),qt(a),Vc(a,v,e,c,l)),null;case 27:if(K(a),l=oe.current,v=a.type,e!==null&&a.stateNode!=null)e.memoizedProps!==c&&Ja(a);else{if(!c){if(a.stateNode===null)throw Error(i(166));return qt(a),null}e=Q.current,kr(a)?Ku(a):(e=kh(v,c,l),a.stateNode=e,Ja(a))}return qt(a),null;case 5:if(K(a),v=a.type,e!==null&&a.stateNode!=null)e.memoizedProps!==c&&Ja(a);else{if(!c){if(a.stateNode===null)throw Error(i(166));return qt(a),null}if(C=Q.current,kr(a))Ku(a);else{var F=ai(oe.current);switch(C){case 1:C=F.createElementNS("http://www.w3.org/2000/svg",v);break;case 2:C=F.createElementNS("http://www.w3.org/1998/Math/MathML",v);break;default:switch(v){case"svg":C=F.createElementNS("http://www.w3.org/2000/svg",v);break;case"math":C=F.createElementNS("http://www.w3.org/1998/Math/MathML",v);break;case"script":C=F.createElement("div"),C.innerHTML="<script><\/script>",C=C.removeChild(C.firstChild);break;case"select":C=typeof c.is=="string"?F.createElement("select",{is:c.is}):F.createElement("select"),c.multiple?C.multiple=!0:c.size&&(C.size=c.size);break;default:C=typeof c.is=="string"?F.createElement(v,{is:c.is}):F.createElement(v)}}C[Dt]=a,C[Ut]=c;e:for(F=a.child;F!==null;){if(F.tag===5||F.tag===6)C.appendChild(F.stateNode);else if(F.tag!==4&&F.tag!==27&&F.child!==null){F.child.return=F,F=F.child;continue}if(F===a)break e;for(;F.sibling===null;){if(F.return===null||F.return===a)break e;F=F.return}F.sibling.return=F.return,F=F.sibling}a.stateNode=C;e:switch(cn(C,v,c),v){case"button":case"input":case"select":case"textarea":c=!!c.autoFocus;break e;case"img":c=!0;break e;default:c=!1}c&&Ja(a)}}return qt(a),Vc(a,a.type,e===null?null:e.memoizedProps,a.pendingProps,l),null;case 6:if(e&&a.stateNode!=null)e.memoizedProps!==c&&Ja(a);else{if(typeof c!="string"&&a.stateNode===null)throw Error(i(166));if(e=oe.current,kr(a)){if(e=a.stateNode,l=a.memoizedProps,c=null,v=rn,v!==null)switch(v.tag){case 27:case 5:c=v.memoizedProps}e[Dt]=a,e=!!(e.nodeValue===l||c!==null&&c.suppressHydrationWarning===!0||yh(e.nodeValue,l)),e||go(a,!0)}else e=ai(e).createTextNode(c),e[Dt]=a,a.stateNode=e}return qt(a),null;case 31:if(l=a.memoizedState,e===null||e.memoizedState!==null){if(c=kr(a),l!==null){if(e===null){if(!c)throw Error(i(318));if(e=a.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(i(557));e[Dt]=a}else er(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;qt(a),e=!1}else l=Ji(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=l),e=!0;if(!e)return a.flags&256?(Vn(a),a):(Vn(a),null);if((a.flags&128)!==0)throw Error(i(558))}return qt(a),null;case 13:if(c=a.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(v=kr(a),c!==null&&c.dehydrated!==null){if(e===null){if(!v)throw Error(i(318));if(v=a.memoizedState,v=v!==null?v.dehydrated:null,!v)throw Error(i(317));v[Dt]=a}else er(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;qt(a),v=!1}else v=Ji(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=v),v=!0;if(!v)return a.flags&256?(Vn(a),a):(Vn(a),null)}return Vn(a),(a.flags&128)!==0?(a.lanes=l,a):(l=c!==null,e=e!==null&&e.memoizedState!==null,l&&(c=a.child,v=null,c.alternate!==null&&c.alternate.memoizedState!==null&&c.alternate.memoizedState.cachePool!==null&&(v=c.alternate.memoizedState.cachePool.pool),C=null,c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(C=c.memoizedState.cachePool.pool),C!==v&&(c.flags|=2048)),l!==e&&l&&(a.child.flags|=8192),Hs(a,a.updateQueue),qt(a),null);case 4:return xe(),e===null&&ud(a.stateNode.containerInfo),qt(a),null;case 10:return Qa(a.type),qt(a),null;case 19:if(W(zt),c=a.memoizedState,c===null)return qt(a),null;if(v=(a.flags&128)!==0,C=c.rendering,C===null)if(v)Rl(c,!1);else{if(Mt!==0||e!==null&&(e.flags&128)!==0)for(e=a.child;e!==null;){if(C=Ns(e),C!==null){for(a.flags|=128,Rl(c,!1),e=C.updateQueue,a.updateQueue=e,Hs(a,e),a.subtreeFlags=0,e=l,l=a.child;l!==null;)Yu(l,e),l=l.sibling;return J(zt,zt.current&1|2),mt&&Ya(a,c.treeForkCount),a.child}e=e.sibling}c.tail!==null&&je()>Ys&&(a.flags|=128,v=!0,Rl(c,!1),a.lanes=4194304)}else{if(!v)if(e=Ns(C),e!==null){if(a.flags|=128,v=!0,e=e.updateQueue,a.updateQueue=e,Hs(a,e),Rl(c,!0),c.tail===null&&c.tailMode==="hidden"&&!C.alternate&&!mt)return qt(a),null}else 2*je()-c.renderingStartTime>Ys&&l!==536870912&&(a.flags|=128,v=!0,Rl(c,!1),a.lanes=4194304);c.isBackwards?(C.sibling=a.child,a.child=C):(e=c.last,e!==null?e.sibling=C:a.child=C,c.last=C)}return c.tail!==null?(e=c.tail,c.rendering=e,c.tail=e.sibling,c.renderingStartTime=je(),e.sibling=null,l=zt.current,J(zt,v?l&1|2:l&1),mt&&Ya(a,c.treeForkCount),e):(qt(a),null);case 22:case 23:return Vn(a),pc(),c=a.memoizedState!==null,e!==null?e.memoizedState!==null!==c&&(a.flags|=8192):c&&(a.flags|=8192),c?(l&536870912)!==0&&(a.flags&128)===0&&(qt(a),a.subtreeFlags&6&&(a.flags|=8192)):qt(a),l=a.updateQueue,l!==null&&Hs(a,l.retryQueue),l=null,e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(l=e.memoizedState.cachePool.pool),c=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(c=a.memoizedState.cachePool.pool),c!==l&&(a.flags|=2048),e!==null&&W(ar),null;case 24:return l=null,e!==null&&(l=e.memoizedState.cache),a.memoizedState.cache!==l&&(a.flags|=2048),Qa(Gt),qt(a),null;case 25:return null;case 30:return null}throw Error(i(156,a.tag))}function j_(e,a){switch(Zi(a),a.tag){case 1:return e=a.flags,e&65536?(a.flags=e&-65537|128,a):null;case 3:return Qa(Gt),xe(),e=a.flags,(e&65536)!==0&&(e&128)===0?(a.flags=e&-65537|128,a):null;case 26:case 27:case 5:return K(a),null;case 31:if(a.memoizedState!==null){if(Vn(a),a.alternate===null)throw Error(i(340));er()}return e=a.flags,e&65536?(a.flags=e&-65537|128,a):null;case 13:if(Vn(a),e=a.memoizedState,e!==null&&e.dehydrated!==null){if(a.alternate===null)throw Error(i(340));er()}return e=a.flags,e&65536?(a.flags=e&-65537|128,a):null;case 19:return W(zt),null;case 4:return xe(),null;case 10:return Qa(a.type),null;case 22:case 23:return Vn(a),pc(),e!==null&&W(ar),e=a.flags,e&65536?(a.flags=e&-65537|128,a):null;case 24:return Qa(Gt),null;case 25:return null;default:return null}}function xf(e,a){switch(Zi(a),a.tag){case 3:Qa(Gt),xe();break;case 26:case 27:case 5:K(a);break;case 4:xe();break;case 31:a.memoizedState!==null&&Vn(a);break;case 13:Vn(a);break;case 19:W(zt);break;case 10:Qa(a.type);break;case 22:case 23:Vn(a),pc(),e!==null&&W(ar);break;case 24:Qa(Gt)}}function Fl(e,a){try{var l=a.updateQueue,c=l!==null?l.lastEffect:null;if(c!==null){var v=c.next;l=v;do{if((l.tag&e)===e){c=void 0;var C=l.create,F=l.inst;c=C(),F.destroy=c}l=l.next}while(l!==v)}}catch(Y){Et(a,a.return,Y)}}function bo(e,a,l){try{var c=a.updateQueue,v=c!==null?c.lastEffect:null;if(v!==null){var C=v.next;c=C;do{if((c.tag&e)===e){var F=c.inst,Y=F.destroy;if(Y!==void 0){F.destroy=void 0,v=a;var ae=l,fe=Y;try{fe()}catch(we){Et(v,ae,we)}}}c=c.next}while(c!==C)}}catch(we){Et(a,a.return,we)}}function Cf(e){var a=e.updateQueue;if(a!==null){var l=e.stateNode;try{up(a,l)}catch(c){Et(e,e.return,c)}}}function Sf(e,a,l){l.props=ir(e.type,e.memoizedProps),l.state=e.memoizedState;try{l.componentWillUnmount()}catch(c){Et(e,a,c)}}function Dl(e,a){try{var l=e.ref;if(l!==null){switch(e.tag){case 26:case 27:case 5:var c=e.stateNode;break;case 30:c=e.stateNode;break;default:c=e.stateNode}typeof l=="function"?e.refCleanup=l(c):l.current=c}}catch(v){Et(e,a,v)}}function Ia(e,a){var l=e.ref,c=e.refCleanup;if(l!==null)if(typeof c=="function")try{c()}catch(v){Et(e,a,v)}finally{e.refCleanup=null,e=e.alternate,e!=null&&(e.refCleanup=null)}else if(typeof l=="function")try{l(null)}catch(v){Et(e,a,v)}else l.current=null}function bf(e){var a=e.type,l=e.memoizedProps,c=e.stateNode;try{e:switch(a){case"button":case"input":case"select":case"textarea":l.autoFocus&&c.focus();break e;case"img":l.src?c.src=l.src:l.srcSet&&(c.srcset=l.srcSet)}}catch(v){Et(e,e.return,v)}}function zc(e,a,l){try{var c=e.stateNode;W_(c,e.type,l,a),c[Ut]=a}catch(v){Et(e,e.return,v)}}function Ef(e){return e.tag===5||e.tag===3||e.tag===26||e.tag===27&&Ro(e.type)||e.tag===4}function Bc(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||Ef(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.tag===27&&Ro(e.type)||e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Gc(e,a,l){var c=e.tag;if(c===5||c===6)e=e.stateNode,a?(l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l).insertBefore(e,a):(a=l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l,a.appendChild(e),l=l._reactRootContainer,l!=null||a.onclick!==null||(a.onclick=Nn));else if(c!==4&&(c===27&&Ro(e.type)&&(l=e.stateNode,a=null),e=e.child,e!==null))for(Gc(e,a,l),e=e.sibling;e!==null;)Gc(e,a,l),e=e.sibling}function Vs(e,a,l){var c=e.tag;if(c===5||c===6)e=e.stateNode,a?l.insertBefore(e,a):l.appendChild(e);else if(c!==4&&(c===27&&Ro(e.type)&&(l=e.stateNode),e=e.child,e!==null))for(Vs(e,a,l),e=e.sibling;e!==null;)Vs(e,a,l),e=e.sibling}function jf(e){var a=e.stateNode,l=e.memoizedProps;try{for(var c=e.type,v=a.attributes;v.length;)a.removeAttributeNode(v[0]);cn(a,c,l),a[Dt]=e,a[Ut]=l}catch(C){Et(e,e.return,C)}}var eo=!1,Qt=!1,Yc=!1,kf=typeof WeakSet=="function"?WeakSet:Set,en=null;function k_(e,a){if(e=e.containerInfo,hd=di,e=Pu(e),Oi(e)){if("selectionStart"in e)var l={start:e.selectionStart,end:e.selectionEnd};else e:{l=(l=e.ownerDocument)&&l.defaultView||window;var c=l.getSelection&&l.getSelection();if(c&&c.rangeCount!==0){l=c.anchorNode;var v=c.anchorOffset,C=c.focusNode;c=c.focusOffset;try{l.nodeType,C.nodeType}catch{l=null;break e}var F=0,Y=-1,ae=-1,fe=0,we=0,Ee=e,ye=null;t:for(;;){for(var _e;Ee!==l||v!==0&&Ee.nodeType!==3||(Y=F+v),Ee!==C||c!==0&&Ee.nodeType!==3||(ae=F+c),Ee.nodeType===3&&(F+=Ee.nodeValue.length),(_e=Ee.firstChild)!==null;)ye=Ee,Ee=_e;for(;;){if(Ee===e)break t;if(ye===l&&++fe===v&&(Y=F),ye===C&&++we===c&&(ae=F),(_e=Ee.nextSibling)!==null)break;Ee=ye,ye=Ee.parentNode}Ee=_e}l=Y===-1||ae===-1?null:{start:Y,end:ae}}else l=null}l=l||{start:0,end:0}}else l=null;for(md={focusedElem:e,selectionRange:l},di=!1,en=a;en!==null;)if(a=en,e=a.child,(a.subtreeFlags&1028)!==0&&e!==null)e.return=a,en=e;else for(;en!==null;){switch(a=en,C=a.alternate,e=a.flags,a.tag){case 0:if((e&4)!==0&&(e=a.updateQueue,e=e!==null?e.events:null,e!==null))for(l=0;l<e.length;l++)v=e[l],v.ref.impl=v.nextImpl;break;case 11:case 15:break;case 1:if((e&1024)!==0&&C!==null){e=void 0,l=a,v=C.memoizedProps,C=C.memoizedState,c=l.stateNode;try{var ze=ir(l.type,v);e=c.getSnapshotBeforeUpdate(ze,C),c.__reactInternalSnapshotBeforeUpdate=e}catch(Ke){Et(l,l.return,Ke)}}break;case 3:if((e&1024)!==0){if(e=a.stateNode.containerInfo,l=e.nodeType,l===9)vd(e);else if(l===1)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":vd(e);break;default:e.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((e&1024)!==0)throw Error(i(163))}if(e=a.sibling,e!==null){e.return=a.return,en=e;break}en=a.return}}function Tf(e,a,l){var c=l.flags;switch(l.tag){case 0:case 11:case 15:no(e,l),c&4&&Fl(5,l);break;case 1:if(no(e,l),c&4)if(e=l.stateNode,a===null)try{e.componentDidMount()}catch(F){Et(l,l.return,F)}else{var v=ir(l.type,a.memoizedProps);a=a.memoizedState;try{e.componentDidUpdate(v,a,e.__reactInternalSnapshotBeforeUpdate)}catch(F){Et(l,l.return,F)}}c&64&&Cf(l),c&512&&Dl(l,l.return);break;case 3:if(no(e,l),c&64&&(e=l.updateQueue,e!==null)){if(a=null,l.child!==null)switch(l.child.tag){case 27:case 5:a=l.child.stateNode;break;case 1:a=l.child.stateNode}try{up(e,a)}catch(F){Et(l,l.return,F)}}break;case 27:a===null&&c&4&&jf(l);case 26:case 5:no(e,l),a===null&&c&4&&bf(l),c&512&&Dl(l,l.return);break;case 12:no(e,l);break;case 31:no(e,l),c&4&&Rf(e,l);break;case 13:no(e,l),c&4&&Ff(e,l),c&64&&(e=l.memoizedState,e!==null&&(e=e.dehydrated,e!==null&&(l=I_.bind(null,l),n0(e,l))));break;case 22:if(c=l.memoizedState!==null||eo,!c){a=a!==null&&a.memoizedState!==null||Qt,v=eo;var C=Qt;eo=c,(Qt=a)&&!C?ao(e,l,(l.subtreeFlags&8772)!==0):no(e,l),eo=v,Qt=C}break;case 30:break;default:no(e,l)}}function Nf(e){var a=e.alternate;a!==null&&(e.alternate=null,Nf(a)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(a=e.stateNode,a!==null&&Jn(a)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var It=null,Rn=!1;function to(e,a,l){for(l=l.child;l!==null;)Af(e,a,l),l=l.sibling}function Af(e,a,l){if(Lt&&typeof Lt.onCommitFiberUnmount=="function")try{Lt.onCommitFiberUnmount(an,l)}catch{}switch(l.tag){case 26:Qt||Ia(l,a),to(e,a,l),l.memoizedState?l.memoizedState.count--:l.stateNode&&(l=l.stateNode,l.parentNode.removeChild(l));break;case 27:Qt||Ia(l,a);var c=It,v=Rn;Ro(l.type)&&(It=l.stateNode,Rn=!1),to(e,a,l),Hl(l.stateNode),It=c,Rn=v;break;case 5:Qt||Ia(l,a);case 6:if(c=It,v=Rn,It=null,to(e,a,l),It=c,Rn=v,It!==null)if(Rn)try{(It.nodeType===9?It.body:It.nodeName==="HTML"?It.ownerDocument.body:It).removeChild(l.stateNode)}catch(C){Et(l,a,C)}else try{It.removeChild(l.stateNode)}catch(C){Et(l,a,C)}break;case 18:It!==null&&(Rn?(e=It,Ch(e.nodeType===9?e.body:e.nodeName==="HTML"?e.ownerDocument.body:e,l.stateNode),Wr(e)):Ch(It,l.stateNode));break;case 4:c=It,v=Rn,It=l.stateNode.containerInfo,Rn=!0,to(e,a,l),It=c,Rn=v;break;case 0:case 11:case 14:case 15:bo(2,l,a),Qt||bo(4,l,a),to(e,a,l);break;case 1:Qt||(Ia(l,a),c=l.stateNode,typeof c.componentWillUnmount=="function"&&Sf(l,a,c)),to(e,a,l);break;case 21:to(e,a,l);break;case 22:Qt=(c=Qt)||l.memoizedState!==null,to(e,a,l),Qt=c;break;default:to(e,a,l)}}function Rf(e,a){if(a.memoizedState===null&&(e=a.alternate,e!==null&&(e=e.memoizedState,e!==null))){e=e.dehydrated;try{Wr(e)}catch(l){Et(a,a.return,l)}}}function Ff(e,a){if(a.memoizedState===null&&(e=a.alternate,e!==null&&(e=e.memoizedState,e!==null&&(e=e.dehydrated,e!==null))))try{Wr(e)}catch(l){Et(a,a.return,l)}}function T_(e){switch(e.tag){case 31:case 13:case 19:var a=e.stateNode;return a===null&&(a=e.stateNode=new kf),a;case 22:return e=e.stateNode,a=e._retryCache,a===null&&(a=e._retryCache=new kf),a;default:throw Error(i(435,e.tag))}}function zs(e,a){var l=T_(e);a.forEach(function(c){if(!l.has(c)){l.add(c);var v=L_.bind(null,e,c);c.then(v,v)}})}function Fn(e,a){var l=a.deletions;if(l!==null)for(var c=0;c<l.length;c++){var v=l[c],C=e,F=a,Y=F;e:for(;Y!==null;){switch(Y.tag){case 27:if(Ro(Y.type)){It=Y.stateNode,Rn=!1;break e}break;case 5:It=Y.stateNode,Rn=!1;break e;case 3:case 4:It=Y.stateNode.containerInfo,Rn=!0;break e}Y=Y.return}if(It===null)throw Error(i(160));Af(C,F,v),It=null,Rn=!1,C=v.alternate,C!==null&&(C.return=null),v.return=null}if(a.subtreeFlags&13886)for(a=a.child;a!==null;)Df(a,e),a=a.sibling}var Ea=null;function Df(e,a){var l=e.alternate,c=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:Fn(a,e),Dn(e),c&4&&(bo(3,e,e.return),Fl(3,e),bo(5,e,e.return));break;case 1:Fn(a,e),Dn(e),c&512&&(Qt||l===null||Ia(l,l.return)),c&64&&eo&&(e=e.updateQueue,e!==null&&(c=e.callbacks,c!==null&&(l=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=l===null?c:l.concat(c))));break;case 26:var v=Ea;if(Fn(a,e),Dn(e),c&512&&(Qt||l===null||Ia(l,l.return)),c&4){var C=l!==null?l.memoizedState:null;if(c=e.memoizedState,l===null)if(c===null)if(e.stateNode===null){e:{c=e.type,l=e.memoizedProps,v=v.ownerDocument||v;t:switch(c){case"title":C=v.getElementsByTagName("title")[0],(!C||C[kn]||C[Dt]||C.namespaceURI==="http://www.w3.org/2000/svg"||C.hasAttribute("itemprop"))&&(C=v.createElement(c),v.head.insertBefore(C,v.querySelector("head > title"))),cn(C,c,l),C[Dt]=e,Nt(C),c=C;break e;case"link":var F=Dh("link","href",v).get(c+(l.href||""));if(F){for(var Y=0;Y<F.length;Y++)if(C=F[Y],C.getAttribute("href")===(l.href==null||l.href===""?null:l.href)&&C.getAttribute("rel")===(l.rel==null?null:l.rel)&&C.getAttribute("title")===(l.title==null?null:l.title)&&C.getAttribute("crossorigin")===(l.crossOrigin==null?null:l.crossOrigin)){F.splice(Y,1);break t}}C=v.createElement(c),cn(C,c,l),v.head.appendChild(C);break;case"meta":if(F=Dh("meta","content",v).get(c+(l.content||""))){for(Y=0;Y<F.length;Y++)if(C=F[Y],C.getAttribute("content")===(l.content==null?null:""+l.content)&&C.getAttribute("name")===(l.name==null?null:l.name)&&C.getAttribute("property")===(l.property==null?null:l.property)&&C.getAttribute("http-equiv")===(l.httpEquiv==null?null:l.httpEquiv)&&C.getAttribute("charset")===(l.charSet==null?null:l.charSet)){F.splice(Y,1);break t}}C=v.createElement(c),cn(C,c,l),v.head.appendChild(C);break;default:throw Error(i(468,c))}C[Dt]=e,Nt(C),c=C}e.stateNode=c}else $h(v,e.type,e.stateNode);else e.stateNode=Fh(v,c,e.memoizedProps);else C!==c?(C===null?l.stateNode!==null&&(l=l.stateNode,l.parentNode.removeChild(l)):C.count--,c===null?$h(v,e.type,e.stateNode):Fh(v,c,e.memoizedProps)):c===null&&e.stateNode!==null&&zc(e,e.memoizedProps,l.memoizedProps)}break;case 27:Fn(a,e),Dn(e),c&512&&(Qt||l===null||Ia(l,l.return)),l!==null&&c&4&&zc(e,e.memoizedProps,l.memoizedProps);break;case 5:if(Fn(a,e),Dn(e),c&512&&(Qt||l===null||Ia(l,l.return)),e.flags&32){v=e.stateNode;try{ta(v,"")}catch(ze){Et(e,e.return,ze)}}c&4&&e.stateNode!=null&&(v=e.memoizedProps,zc(e,v,l!==null?l.memoizedProps:v)),c&1024&&(Yc=!0);break;case 6:if(Fn(a,e),Dn(e),c&4){if(e.stateNode===null)throw Error(i(162));c=e.memoizedProps,l=e.stateNode;try{l.nodeValue=c}catch(ze){Et(e,e.return,ze)}}break;case 3:if(li=null,v=Ea,Ea=oi(a.containerInfo),Fn(a,e),Ea=v,Dn(e),c&4&&l!==null&&l.memoizedState.isDehydrated)try{Wr(a.containerInfo)}catch(ze){Et(e,e.return,ze)}Yc&&(Yc=!1,$f(e));break;case 4:c=Ea,Ea=oi(e.stateNode.containerInfo),Fn(a,e),Dn(e),Ea=c;break;case 12:Fn(a,e),Dn(e);break;case 31:Fn(a,e),Dn(e),c&4&&(c=e.updateQueue,c!==null&&(e.updateQueue=null,zs(e,c)));break;case 13:Fn(a,e),Dn(e),e.child.flags&8192&&e.memoizedState!==null!=(l!==null&&l.memoizedState!==null)&&(Gs=je()),c&4&&(c=e.updateQueue,c!==null&&(e.updateQueue=null,zs(e,c)));break;case 22:v=e.memoizedState!==null;var ae=l!==null&&l.memoizedState!==null,fe=eo,we=Qt;if(eo=fe||v,Qt=we||ae,Fn(a,e),Qt=we,eo=fe,Dn(e),c&8192)e:for(a=e.stateNode,a._visibility=v?a._visibility&-2:a._visibility|1,v&&(l===null||ae||eo||Qt||cr(e)),l=null,a=e;;){if(a.tag===5||a.tag===26){if(l===null){ae=l=a;try{if(C=ae.stateNode,v)F=C.style,typeof F.setProperty=="function"?F.setProperty("display","none","important"):F.display="none";else{Y=ae.stateNode;var Ee=ae.memoizedProps.style,ye=Ee!=null&&Ee.hasOwnProperty("display")?Ee.display:null;Y.style.display=ye==null||typeof ye=="boolean"?"":(""+ye).trim()}}catch(ze){Et(ae,ae.return,ze)}}}else if(a.tag===6){if(l===null){ae=a;try{ae.stateNode.nodeValue=v?"":ae.memoizedProps}catch(ze){Et(ae,ae.return,ze)}}}else if(a.tag===18){if(l===null){ae=a;try{var _e=ae.stateNode;v?Sh(_e,!0):Sh(ae.stateNode,!1)}catch(ze){Et(ae,ae.return,ze)}}}else if((a.tag!==22&&a.tag!==23||a.memoizedState===null||a===e)&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===e)break e;for(;a.sibling===null;){if(a.return===null||a.return===e)break e;l===a&&(l=null),a=a.return}l===a&&(l=null),a.sibling.return=a.return,a=a.sibling}c&4&&(c=e.updateQueue,c!==null&&(l=c.retryQueue,l!==null&&(c.retryQueue=null,zs(e,l))));break;case 19:Fn(a,e),Dn(e),c&4&&(c=e.updateQueue,c!==null&&(e.updateQueue=null,zs(e,c)));break;case 30:break;case 21:break;default:Fn(a,e),Dn(e)}}function Dn(e){var a=e.flags;if(a&2){try{for(var l,c=e.return;c!==null;){if(Ef(c)){l=c;break}c=c.return}if(l==null)throw Error(i(160));switch(l.tag){case 27:var v=l.stateNode,C=Bc(e);Vs(e,C,v);break;case 5:var F=l.stateNode;l.flags&32&&(ta(F,""),l.flags&=-33);var Y=Bc(e);Vs(e,Y,F);break;case 3:case 4:var ae=l.stateNode.containerInfo,fe=Bc(e);Gc(e,fe,ae);break;default:throw Error(i(161))}}catch(we){Et(e,e.return,we)}e.flags&=-3}a&4096&&(e.flags&=-4097)}function $f(e){if(e.subtreeFlags&1024)for(e=e.child;e!==null;){var a=e;$f(a),a.tag===5&&a.flags&1024&&a.stateNode.reset(),e=e.sibling}}function no(e,a){if(a.subtreeFlags&8772)for(a=a.child;a!==null;)Tf(e,a.alternate,a),a=a.sibling}function cr(e){for(e=e.child;e!==null;){var a=e;switch(a.tag){case 0:case 11:case 14:case 15:bo(4,a,a.return),cr(a);break;case 1:Ia(a,a.return);var l=a.stateNode;typeof l.componentWillUnmount=="function"&&Sf(a,a.return,l),cr(a);break;case 27:Hl(a.stateNode);case 26:case 5:Ia(a,a.return),cr(a);break;case 22:a.memoizedState===null&&cr(a);break;case 30:cr(a);break;default:cr(a)}e=e.sibling}}function ao(e,a,l){for(l=l&&(a.subtreeFlags&8772)!==0,a=a.child;a!==null;){var c=a.alternate,v=e,C=a,F=C.flags;switch(C.tag){case 0:case 11:case 15:ao(v,C,l),Fl(4,C);break;case 1:if(ao(v,C,l),c=C,v=c.stateNode,typeof v.componentDidMount=="function")try{v.componentDidMount()}catch(fe){Et(c,c.return,fe)}if(c=C,v=c.updateQueue,v!==null){var Y=c.stateNode;try{var ae=v.shared.hiddenCallbacks;if(ae!==null)for(v.shared.hiddenCallbacks=null,v=0;v<ae.length;v++)dp(ae[v],Y)}catch(fe){Et(c,c.return,fe)}}l&&F&64&&Cf(C),Dl(C,C.return);break;case 27:jf(C);case 26:case 5:ao(v,C,l),l&&c===null&&F&4&&bf(C),Dl(C,C.return);break;case 12:ao(v,C,l);break;case 31:ao(v,C,l),l&&F&4&&Rf(v,C);break;case 13:ao(v,C,l),l&&F&4&&Ff(v,C);break;case 22:C.memoizedState===null&&ao(v,C,l),Dl(C,C.return);break;case 30:break;default:ao(v,C,l)}a=a.sibling}}function Wc(e,a){var l=null;e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(l=e.memoizedState.cachePool.pool),e=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(e=a.memoizedState.cachePool.pool),e!==l&&(e!=null&&e.refCount++,l!=null&&_l(l))}function Qc(e,a){e=null,a.alternate!==null&&(e=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==e&&(a.refCount++,e!=null&&_l(e))}function ja(e,a,l,c){if(a.subtreeFlags&10256)for(a=a.child;a!==null;)qf(e,a,l,c),a=a.sibling}function qf(e,a,l,c){var v=a.flags;switch(a.tag){case 0:case 11:case 15:ja(e,a,l,c),v&2048&&Fl(9,a);break;case 1:ja(e,a,l,c);break;case 3:ja(e,a,l,c),v&2048&&(e=null,a.alternate!==null&&(e=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==e&&(a.refCount++,e!=null&&_l(e)));break;case 12:if(v&2048){ja(e,a,l,c),e=a.stateNode;try{var C=a.memoizedProps,F=C.id,Y=C.onPostCommit;typeof Y=="function"&&Y(F,a.alternate===null?"mount":"update",e.passiveEffectDuration,-0)}catch(ae){Et(a,a.return,ae)}}else ja(e,a,l,c);break;case 31:ja(e,a,l,c);break;case 13:ja(e,a,l,c);break;case 23:break;case 22:C=a.stateNode,F=a.alternate,a.memoizedState!==null?C._visibility&2?ja(e,a,l,c):$l(e,a):C._visibility&2?ja(e,a,l,c):(C._visibility|=2,Lr(e,a,l,c,(a.subtreeFlags&10256)!==0||!1)),v&2048&&Wc(F,a);break;case 24:ja(e,a,l,c),v&2048&&Qc(a.alternate,a);break;default:ja(e,a,l,c)}}function Lr(e,a,l,c,v){for(v=v&&((a.subtreeFlags&10256)!==0||!1),a=a.child;a!==null;){var C=e,F=a,Y=l,ae=c,fe=F.flags;switch(F.tag){case 0:case 11:case 15:Lr(C,F,Y,ae,v),Fl(8,F);break;case 23:break;case 22:var we=F.stateNode;F.memoizedState!==null?we._visibility&2?Lr(C,F,Y,ae,v):$l(C,F):(we._visibility|=2,Lr(C,F,Y,ae,v)),v&&fe&2048&&Wc(F.alternate,F);break;case 24:Lr(C,F,Y,ae,v),v&&fe&2048&&Qc(F.alternate,F);break;default:Lr(C,F,Y,ae,v)}a=a.sibling}}function $l(e,a){if(a.subtreeFlags&10256)for(a=a.child;a!==null;){var l=e,c=a,v=c.flags;switch(c.tag){case 22:$l(l,c),v&2048&&Wc(c.alternate,c);break;case 24:$l(l,c),v&2048&&Qc(c.alternate,c);break;default:$l(l,c)}a=a.sibling}}var ql=8192;function Pr(e,a,l){if(e.subtreeFlags&ql)for(e=e.child;e!==null;)If(e,a,l),e=e.sibling}function If(e,a,l){switch(e.tag){case 26:Pr(e,a,l),e.flags&ql&&e.memoizedState!==null&&h0(l,Ea,e.memoizedState,e.memoizedProps);break;case 5:Pr(e,a,l);break;case 3:case 4:var c=Ea;Ea=oi(e.stateNode.containerInfo),Pr(e,a,l),Ea=c;break;case 22:e.memoizedState===null&&(c=e.alternate,c!==null&&c.memoizedState!==null?(c=ql,ql=16777216,Pr(e,a,l),ql=c):Pr(e,a,l));break;default:Pr(e,a,l)}}function Lf(e){var a=e.alternate;if(a!==null&&(e=a.child,e!==null)){a.child=null;do a=e.sibling,e.sibling=null,e=a;while(e!==null)}}function Il(e){var a=e.deletions;if((e.flags&16)!==0){if(a!==null)for(var l=0;l<a.length;l++){var c=a[l];en=c,Uf(c,e)}Lf(e)}if(e.subtreeFlags&10256)for(e=e.child;e!==null;)Pf(e),e=e.sibling}function Pf(e){switch(e.tag){case 0:case 11:case 15:Il(e),e.flags&2048&&bo(9,e,e.return);break;case 3:Il(e);break;case 12:Il(e);break;case 22:var a=e.stateNode;e.memoizedState!==null&&a._visibility&2&&(e.return===null||e.return.tag!==13)?(a._visibility&=-3,Bs(e)):Il(e);break;default:Il(e)}}function Bs(e){var a=e.deletions;if((e.flags&16)!==0){if(a!==null)for(var l=0;l<a.length;l++){var c=a[l];en=c,Uf(c,e)}Lf(e)}for(e=e.child;e!==null;){switch(a=e,a.tag){case 0:case 11:case 15:bo(8,a,a.return),Bs(a);break;case 22:l=a.stateNode,l._visibility&2&&(l._visibility&=-3,Bs(a));break;default:Bs(a)}e=e.sibling}}function Uf(e,a){for(;en!==null;){var l=en;switch(l.tag){case 0:case 11:case 15:bo(8,l,a);break;case 23:case 22:if(l.memoizedState!==null&&l.memoizedState.cachePool!==null){var c=l.memoizedState.cachePool.pool;c!=null&&c.refCount++}break;case 24:_l(l.memoizedState.cache)}if(c=l.child,c!==null)c.return=l,en=c;else e:for(l=e;en!==null;){c=en;var v=c.sibling,C=c.return;if(Nf(c),c===l){en=null;break e}if(v!==null){v.return=C,en=v;break e}en=C}}}var N_={getCacheForType:function(e){var a=ln(Gt),l=a.data.get(e);return l===void 0&&(l=e(),a.data.set(e,l)),l},cacheSignal:function(){return ln(Gt).controller.signal}},A_=typeof WeakMap=="function"?WeakMap:Map,wt=0,At=null,ut=null,ft=0,bt=0,zn=null,Eo=!1,Ur=!1,Xc=!1,oo=0,Mt=0,jo=0,dr=0,Zc=0,Bn=0,Or=0,Ll=null,$n=null,Kc=!1,Gs=0,Of=0,Ys=1/0,Ws=null,ko=null,Xt=0,To=null,Mr=null,ro=0,Jc=0,ed=null,Mf=null,Pl=0,td=null;function Gn(){return(wt&2)!==0&&ft!==0?ft&-ft:T.T!==null?sd():Ra()}function Hf(){if(Bn===0)if((ft&536870912)===0||mt){var e=Zn;Zn<<=1,(Zn&3932160)===0&&(Zn=262144),Bn=e}else Bn=536870912;return e=Hn.current,e!==null&&(e.flags|=32),Bn}function qn(e,a,l){(e===At&&(bt===2||bt===9)||e.cancelPendingCommit!==null)&&(Hr(e,0),No(e,ft,Bn,!1)),Un(e,l),((wt&2)===0||e!==At)&&(e===At&&((wt&2)===0&&(dr|=l),Mt===4&&No(e,ft,Bn,!1)),La(e))}function Vf(e,a,l){if((wt&6)!==0)throw Error(i(327));var c=!l&&(a&127)===0&&(a&e.expiredLanes)===0||Pn(e,a),v=c?D_(e,a):ad(e,a,!0),C=c;do{if(v===0){Ur&&!c&&No(e,a,0,!1);break}else{if(l=e.current.alternate,C&&!R_(l)){v=ad(e,a,!1),C=!1;continue}if(v===2){if(C=a,e.errorRecoveryDisabledLanes&C)var F=0;else F=e.pendingLanes&-536870913,F=F!==0?F:F&536870912?536870912:0;if(F!==0){a=F;e:{var Y=e;v=Ll;var ae=Y.current.memoizedState.isDehydrated;if(ae&&(Hr(Y,F).flags|=256),F=ad(Y,F,!1),F!==2){if(Xc&&!ae){Y.errorRecoveryDisabledLanes|=C,dr|=C,v=4;break e}C=$n,$n=v,C!==null&&($n===null?$n=C:$n.push.apply($n,C))}v=F}if(C=!1,v!==2)continue}}if(v===1){Hr(e,0),No(e,a,0,!0);break}e:{switch(c=e,C=v,C){case 0:case 1:throw Error(i(345));case 4:if((a&4194048)!==a)break;case 6:No(c,a,Bn,!Eo);break e;case 2:$n=null;break;case 3:case 5:break;default:throw Error(i(329))}if((a&62914560)===a&&(v=Gs+300-je(),10<v)){if(No(c,a,Bn,!Eo),mn(c,0,!0)!==0)break e;ro=a,c.timeoutHandle=wh(zf.bind(null,c,l,$n,Ws,Kc,a,Bn,dr,Or,Eo,C,"Throttled",-0,0),v);break e}zf(c,l,$n,Ws,Kc,a,Bn,dr,Or,Eo,C,null,-0,0)}}break}while(!0);La(e)}function zf(e,a,l,c,v,C,F,Y,ae,fe,we,Ee,ye,_e){if(e.timeoutHandle=-1,Ee=a.subtreeFlags,Ee&8192||(Ee&16785408)===16785408){Ee={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Nn},If(a,C,Ee);var ze=(C&62914560)===C?Gs-je():(C&4194048)===C?Of-je():0;if(ze=m0(Ee,ze),ze!==null){ro=C,e.cancelPendingCommit=ze(Kf.bind(null,e,a,C,l,c,v,F,Y,ae,we,Ee,null,ye,_e)),No(e,C,F,!fe);return}}Kf(e,a,C,l,c,v,F,Y,ae)}function R_(e){for(var a=e;;){var l=a.tag;if((l===0||l===11||l===15)&&a.flags&16384&&(l=a.updateQueue,l!==null&&(l=l.stores,l!==null)))for(var c=0;c<l.length;c++){var v=l[c],C=v.getSnapshot;v=v.value;try{if(!On(C(),v))return!1}catch{return!1}}if(l=a.child,a.subtreeFlags&16384&&l!==null)l.return=a,a=l;else{if(a===e)break;for(;a.sibling===null;){if(a.return===null||a.return===e)return!0;a=a.return}a.sibling.return=a.return,a=a.sibling}}return!0}function No(e,a,l,c){a&=~Zc,a&=~dr,e.suspendedLanes|=a,e.pingedLanes&=~a,c&&(e.warmLanes|=a),c=e.expirationTimes;for(var v=a;0<v;){var C=31-Pt(v),F=1<<C;c[C]=-1,v&=~F}l!==0&&Kn(e,l,a)}function Qs(){return(wt&6)===0?(Ul(0),!1):!0}function nd(){if(ut!==null){if(bt===0)var e=ut.return;else e=ut,Wa=tr=null,vc(e),Fr=null,xl=0,e=ut;for(;e!==null;)xf(e.alternate,e),e=e.return;ut=null}}function Hr(e,a){var l=e.timeoutHandle;l!==-1&&(e.timeoutHandle=-1,Z_(l)),l=e.cancelPendingCommit,l!==null&&(e.cancelPendingCommit=null,l()),ro=0,nd(),At=e,ut=l=Ga(e.current,null),ft=a,bt=0,zn=null,Eo=!1,Ur=Pn(e,a),Xc=!1,Or=Bn=Zc=dr=jo=Mt=0,$n=Ll=null,Kc=!1,(a&8)!==0&&(a|=a&32);var c=e.entangledLanes;if(c!==0)for(e=e.entanglements,c&=a;0<c;){var v=31-Pt(c),C=1<<v;a|=e[v],c&=~C}return oo=a,ys(),l}function Bf(e,a){ot=null,T.H=Nl,a===Rr||a===bs?(a=lp(),bt=3):a===lc?(a=lp(),bt=4):bt=a===$c?8:a!==null&&typeof a=="object"&&typeof a.then=="function"?6:1,zn=a,ut===null&&(Mt=1,Ps(e,oa(a,e.current)))}function Gf(){var e=Hn.current;return e===null?!0:(ft&4194048)===ft?ia===null:(ft&62914560)===ft||(ft&536870912)!==0?e===ia:!1}function Yf(){var e=T.H;return T.H=Nl,e===null?Nl:e}function Wf(){var e=T.A;return T.A=N_,e}function Xs(){Mt=4,Eo||(ft&4194048)!==ft&&Hn.current!==null||(Ur=!0),(jo&134217727)===0&&(dr&134217727)===0||At===null||No(At,ft,Bn,!1)}function ad(e,a,l){var c=wt;wt|=2;var v=Yf(),C=Wf();(At!==e||ft!==a)&&(Ws=null,Hr(e,a)),a=!1;var F=Mt;e:do try{if(bt!==0&&ut!==null){var Y=ut,ae=zn;switch(bt){case 8:nd(),F=6;break e;case 3:case 2:case 9:case 6:Hn.current===null&&(a=!0);var fe=bt;if(bt=0,zn=null,Vr(e,Y,ae,fe),l&&Ur){F=0;break e}break;default:fe=bt,bt=0,zn=null,Vr(e,Y,ae,fe)}}F_(),F=Mt;break}catch(we){Bf(e,we)}while(!0);return a&&e.shellSuspendCounter++,Wa=tr=null,wt=c,T.H=v,T.A=C,ut===null&&(At=null,ft=0,ys()),F}function F_(){for(;ut!==null;)Qf(ut)}function D_(e,a){var l=wt;wt|=2;var c=Yf(),v=Wf();At!==e||ft!==a?(Ws=null,Ys=je()+500,Hr(e,a)):Ur=Pn(e,a);e:do try{if(bt!==0&&ut!==null){a=ut;var C=zn;t:switch(bt){case 1:bt=0,zn=null,Vr(e,a,C,1);break;case 2:case 9:if(op(C)){bt=0,zn=null,Xf(a);break}a=function(){bt!==2&&bt!==9||At!==e||(bt=7),La(e)},C.then(a,a);break e;case 3:bt=7;break e;case 4:bt=5;break e;case 7:op(C)?(bt=0,zn=null,Xf(a)):(bt=0,zn=null,Vr(e,a,C,7));break;case 5:var F=null;switch(ut.tag){case 26:F=ut.memoizedState;case 5:case 27:var Y=ut;if(F?qh(F):Y.stateNode.complete){bt=0,zn=null;var ae=Y.sibling;if(ae!==null)ut=ae;else{var fe=Y.return;fe!==null?(ut=fe,Zs(fe)):ut=null}break t}}bt=0,zn=null,Vr(e,a,C,5);break;case 6:bt=0,zn=null,Vr(e,a,C,6);break;case 8:nd(),Mt=6;break e;default:throw Error(i(462))}}$_();break}catch(we){Bf(e,we)}while(!0);return Wa=tr=null,T.H=c,T.A=v,wt=l,ut!==null?0:(At=null,ft=0,ys(),Mt)}function $_(){for(;ut!==null&&!Me();)Qf(ut)}function Qf(e){var a=_f(e.alternate,e,oo);e.memoizedProps=e.pendingProps,a===null?Zs(e):ut=a}function Xf(e){var a=e,l=a.alternate;switch(a.tag){case 15:case 0:a=ff(l,a,a.pendingProps,a.type,void 0,ft);break;case 11:a=ff(l,a,a.pendingProps,a.type.render,a.ref,ft);break;case 5:vc(a);default:xf(l,a),a=ut=Yu(a,oo),a=_f(l,a,oo)}e.memoizedProps=e.pendingProps,a===null?Zs(e):ut=a}function Vr(e,a,l,c){Wa=tr=null,vc(a),Fr=null,xl=0;var v=a.return;try{if(C_(e,v,a,l,ft)){Mt=1,Ps(e,oa(l,e.current)),ut=null;return}}catch(C){if(v!==null)throw ut=v,C;Mt=1,Ps(e,oa(l,e.current)),ut=null;return}a.flags&32768?(mt||c===1?e=!0:Ur||(ft&536870912)!==0?e=!1:(Eo=e=!0,(c===2||c===9||c===3||c===6)&&(c=Hn.current,c!==null&&c.tag===13&&(c.flags|=16384))),Zf(a,e)):Zs(a)}function Zs(e){var a=e;do{if((a.flags&32768)!==0){Zf(a,Eo);return}e=a.return;var l=E_(a.alternate,a,oo);if(l!==null){ut=l;return}if(a=a.sibling,a!==null){ut=a;return}ut=a=e}while(a!==null);Mt===0&&(Mt=5)}function Zf(e,a){do{var l=j_(e.alternate,e);if(l!==null){l.flags&=32767,ut=l;return}if(l=e.return,l!==null&&(l.flags|=32768,l.subtreeFlags=0,l.deletions=null),!a&&(e=e.sibling,e!==null)){ut=e;return}ut=e=l}while(e!==null);Mt=6,ut=null}function Kf(e,a,l,c,v,C,F,Y,ae){e.cancelPendingCommit=null;do Ks();while(Xt!==0);if((wt&6)!==0)throw Error(i(327));if(a!==null){if(a===e.current)throw Error(i(177));if(C=a.lanes|a.childLanes,C|=Bi,Ta(e,l,C,F,Y,ae),e===At&&(ut=At=null,ft=0),Mr=a,To=e,ro=l,Jc=C,ed=v,Mf=c,(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?(e.callbackNode=null,e.callbackPriority=0,P_(it,function(){return ah(),null})):(e.callbackNode=null,e.callbackPriority=0),c=(a.flags&13878)!==0,(a.subtreeFlags&13878)!==0||c){c=T.T,T.T=null,v=q.p,q.p=2,F=wt,wt|=4;try{k_(e,a,l)}finally{wt=F,q.p=v,T.T=c}}Xt=1,Jf(),eh(),th()}}function Jf(){if(Xt===1){Xt=0;var e=To,a=Mr,l=(a.flags&13878)!==0;if((a.subtreeFlags&13878)!==0||l){l=T.T,T.T=null;var c=q.p;q.p=2;var v=wt;wt|=4;try{Df(a,e);var C=md,F=Pu(e.containerInfo),Y=C.focusedElem,ae=C.selectionRange;if(F!==Y&&Y&&Y.ownerDocument&&Lu(Y.ownerDocument.documentElement,Y)){if(ae!==null&&Oi(Y)){var fe=ae.start,we=ae.end;if(we===void 0&&(we=fe),"selectionStart"in Y)Y.selectionStart=fe,Y.selectionEnd=Math.min(we,Y.value.length);else{var Ee=Y.ownerDocument||document,ye=Ee&&Ee.defaultView||window;if(ye.getSelection){var _e=ye.getSelection(),ze=Y.textContent.length,Ke=Math.min(ae.start,ze),Tt=ae.end===void 0?Ke:Math.min(ae.end,ze);!_e.extend&&Ke>Tt&&(F=Tt,Tt=Ke,Ke=F);var de=Iu(Y,Ke),re=Iu(Y,Tt);if(de&&re&&(_e.rangeCount!==1||_e.anchorNode!==de.node||_e.anchorOffset!==de.offset||_e.focusNode!==re.node||_e.focusOffset!==re.offset)){var pe=Ee.createRange();pe.setStart(de.node,de.offset),_e.removeAllRanges(),Ke>Tt?(_e.addRange(pe),_e.extend(re.node,re.offset)):(pe.setEnd(re.node,re.offset),_e.addRange(pe))}}}}for(Ee=[],_e=Y;_e=_e.parentNode;)_e.nodeType===1&&Ee.push({element:_e,left:_e.scrollLeft,top:_e.scrollTop});for(typeof Y.focus=="function"&&Y.focus(),Y=0;Y<Ee.length;Y++){var Ce=Ee[Y];Ce.element.scrollLeft=Ce.left,Ce.element.scrollTop=Ce.top}}di=!!hd,md=hd=null}finally{wt=v,q.p=c,T.T=l}}e.current=a,Xt=2}}function eh(){if(Xt===2){Xt=0;var e=To,a=Mr,l=(a.flags&8772)!==0;if((a.subtreeFlags&8772)!==0||l){l=T.T,T.T=null;var c=q.p;q.p=2;var v=wt;wt|=4;try{Tf(e,a.alternate,a)}finally{wt=v,q.p=c,T.T=l}}Xt=3}}function th(){if(Xt===4||Xt===3){Xt=0,He();var e=To,a=Mr,l=ro,c=Mf;(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?Xt=5:(Xt=0,Mr=To=null,nh(e,e.pendingLanes));var v=e.pendingLanes;if(v===0&&(ko=null),ga(l),a=a.stateNode,Lt&&typeof Lt.onCommitFiberRoot=="function")try{Lt.onCommitFiberRoot(an,a,void 0,(a.current.flags&128)===128)}catch{}if(c!==null){a=T.T,v=q.p,q.p=2,T.T=null;try{for(var C=e.onRecoverableError,F=0;F<c.length;F++){var Y=c[F];C(Y.value,{componentStack:Y.stack})}}finally{T.T=a,q.p=v}}(ro&3)!==0&&Ks(),La(e),v=e.pendingLanes,(l&261930)!==0&&(v&42)!==0?e===td?Pl++:(Pl=0,td=e):Pl=0,Ul(0)}}function nh(e,a){(e.pooledCacheLanes&=a)===0&&(a=e.pooledCache,a!=null&&(e.pooledCache=null,_l(a)))}function Ks(){return Jf(),eh(),th(),ah()}function ah(){if(Xt!==5)return!1;var e=To,a=Jc;Jc=0;var l=ga(ro),c=T.T,v=q.p;try{q.p=32>l?32:l,T.T=null,l=ed,ed=null;var C=To,F=ro;if(Xt=0,Mr=To=null,ro=0,(wt&6)!==0)throw Error(i(331));var Y=wt;if(wt|=4,Pf(C.current),qf(C,C.current,F,l),wt=Y,Ul(0,!1),Lt&&typeof Lt.onPostCommitFiberRoot=="function")try{Lt.onPostCommitFiberRoot(an,C)}catch{}return!0}finally{q.p=v,T.T=c,nh(e,a)}}function oh(e,a,l){a=oa(l,a),a=Dc(e.stateNode,a,2),e=xo(e,a,2),e!==null&&(Un(e,2),La(e))}function Et(e,a,l){if(e.tag===3)oh(e,e,l);else for(;a!==null;){if(a.tag===3){oh(a,e,l);break}else if(a.tag===1){var c=a.stateNode;if(typeof a.type.getDerivedStateFromError=="function"||typeof c.componentDidCatch=="function"&&(ko===null||!ko.has(c))){e=oa(l,e),l=of(2),c=xo(a,l,2),c!==null&&(rf(l,c,a,e),Un(c,2),La(c));break}}a=a.return}}function od(e,a,l){var c=e.pingCache;if(c===null){c=e.pingCache=new A_;var v=new Set;c.set(a,v)}else v=c.get(a),v===void 0&&(v=new Set,c.set(a,v));v.has(l)||(Xc=!0,v.add(l),e=q_.bind(null,e,a,l),a.then(e,e))}function q_(e,a,l){var c=e.pingCache;c!==null&&c.delete(a),e.pingedLanes|=e.suspendedLanes&l,e.warmLanes&=~l,At===e&&(ft&l)===l&&(Mt===4||Mt===3&&(ft&62914560)===ft&&300>je()-Gs?(wt&2)===0&&Hr(e,0):Zc|=l,Or===ft&&(Or=0)),La(e)}function rh(e,a){a===0&&(a=ka()),e=Ko(e,a),e!==null&&(Un(e,a),La(e))}function I_(e){var a=e.memoizedState,l=0;a!==null&&(l=a.retryLane),rh(e,l)}function L_(e,a){var l=0;switch(e.tag){case 31:case 13:var c=e.stateNode,v=e.memoizedState;v!==null&&(l=v.retryLane);break;case 19:c=e.stateNode;break;case 22:c=e.stateNode._retryCache;break;default:throw Error(i(314))}c!==null&&c.delete(a),rh(e,l)}function P_(e,a){return Ge(e,a)}var Js=null,zr=null,rd=!1,ei=!1,ld=!1,Ao=0;function La(e){e!==zr&&e.next===null&&(zr===null?Js=zr=e:zr=zr.next=e),ei=!0,rd||(rd=!0,O_())}function Ul(e,a){if(!ld&&ei){ld=!0;do for(var l=!1,c=Js;c!==null;){if(e!==0){var v=c.pendingLanes;if(v===0)var C=0;else{var F=c.suspendedLanes,Y=c.pingedLanes;C=(1<<31-Pt(42|e)+1)-1,C&=v&~(F&~Y),C=C&201326741?C&201326741|1:C?C|2:0}C!==0&&(l=!0,ch(c,C))}else C=ft,C=mn(c,c===At?C:0,c.cancelPendingCommit!==null||c.timeoutHandle!==-1),(C&3)===0||Pn(c,C)||(l=!0,ch(c,C));c=c.next}while(l);ld=!1}}function U_(){lh()}function lh(){ei=rd=!1;var e=0;Ao!==0&&X_()&&(e=Ao);for(var a=je(),l=null,c=Js;c!==null;){var v=c.next,C=sh(c,a);C===0?(c.next=null,l===null?Js=v:l.next=v,v===null&&(zr=l)):(l=c,(e!==0||(C&3)!==0)&&(ei=!0)),c=v}Xt!==0&&Xt!==5||Ul(e),Ao!==0&&(Ao=0)}function sh(e,a){for(var l=e.suspendedLanes,c=e.pingedLanes,v=e.expirationTimes,C=e.pendingLanes&-62914561;0<C;){var F=31-Pt(C),Y=1<<F,ae=v[F];ae===-1?((Y&l)===0||(Y&c)!==0)&&(v[F]=Ha(Y,a)):ae<=a&&(e.expiredLanes|=Y),C&=~Y}if(a=At,l=ft,l=mn(e,e===a?l:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),c=e.callbackNode,l===0||e===a&&(bt===2||bt===9)||e.cancelPendingCommit!==null)return c!==null&&c!==null&&Be(c),e.callbackNode=null,e.callbackPriority=0;if((l&3)===0||Pn(e,l)){if(a=l&-l,a===e.callbackPriority)return a;switch(c!==null&&Be(c),ga(l)){case 2:case 8:l=Ve;break;case 32:l=it;break;case 268435456:l=Rt;break;default:l=it}return c=ih.bind(null,e),l=Ge(l,c),e.callbackPriority=a,e.callbackNode=l,a}return c!==null&&c!==null&&Be(c),e.callbackPriority=2,e.callbackNode=null,2}function ih(e,a){if(Xt!==0&&Xt!==5)return e.callbackNode=null,e.callbackPriority=0,null;var l=e.callbackNode;if(Ks()&&e.callbackNode!==l)return null;var c=ft;return c=mn(e,e===At?c:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),c===0?null:(Vf(e,c,a),sh(e,je()),e.callbackNode!=null&&e.callbackNode===l?ih.bind(null,e):null)}function ch(e,a){if(Ks())return null;Vf(e,a,!0)}function O_(){K_(function(){(wt&6)!==0?Ge(Ie,U_):lh()})}function sd(){if(Ao===0){var e=Nr;e===0&&(e=Ln,Ln<<=1,(Ln&261888)===0&&(Ln=256)),Ao=e}return Ao}function dh(e){return e==null||typeof e=="symbol"||typeof e=="boolean"?null:typeof e=="function"?e:Ba(""+e)}function uh(e,a){var l=a.ownerDocument.createElement("input");return l.name=a.name,l.value=a.value,e.id&&l.setAttribute("form",e.id),a.parentNode.insertBefore(l,a),e=new FormData(e),l.parentNode.removeChild(l),e}function M_(e,a,l,c,v){if(a==="submit"&&l&&l.stateNode===v){var C=dh((v[Ut]||null).action),F=c.submitter;F&&(a=(a=F[Ut]||null)?dh(a.formAction):F.getAttribute("formAction"),a!==null&&(C=a,F=null));var Y=new ps("action","action",null,c,v);e.push({event:Y,listeners:[{instance:null,listener:function(){if(c.defaultPrevented){if(Ao!==0){var ae=F?uh(v,F):new FormData(v);kc(l,{pending:!0,data:ae,method:v.method,action:C},null,ae)}}else typeof C=="function"&&(Y.preventDefault(),ae=F?uh(v,F):new FormData(v),kc(l,{pending:!0,data:ae,method:v.method,action:C},C,ae))},currentTarget:v}]})}}for(var id=0;id<zi.length;id++){var cd=zi[id],H_=cd.toLowerCase(),V_=cd[0].toUpperCase()+cd.slice(1);ba(H_,"on"+V_)}ba(Mu,"onAnimationEnd"),ba(Hu,"onAnimationIteration"),ba(Vu,"onAnimationStart"),ba("dblclick","onDoubleClick"),ba("focusin","onFocus"),ba("focusout","onBlur"),ba(r_,"onTransitionRun"),ba(l_,"onTransitionStart"),ba(s_,"onTransitionCancel"),ba(zu,"onTransitionEnd"),Cn("onMouseEnter",["mouseout","mouseover"]),Cn("onMouseLeave",["mouseout","mouseover"]),Cn("onPointerEnter",["pointerout","pointerover"]),Cn("onPointerLeave",["pointerout","pointerover"]),gn("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),gn("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),gn("onBeforeInput",["compositionend","keypress","textInput","paste"]),gn("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),gn("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),gn("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ol="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),z_=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Ol));function ph(e,a){a=(a&4)!==0;for(var l=0;l<e.length;l++){var c=e[l],v=c.event;c=c.listeners;e:{var C=void 0;if(a)for(var F=c.length-1;0<=F;F--){var Y=c[F],ae=Y.instance,fe=Y.currentTarget;if(Y=Y.listener,ae!==C&&v.isPropagationStopped())break e;C=Y,v.currentTarget=fe;try{C(v)}catch(we){ms(we)}v.currentTarget=null,C=ae}else for(F=0;F<c.length;F++){if(Y=c[F],ae=Y.instance,fe=Y.currentTarget,Y=Y.listener,ae!==C&&v.isPropagationStopped())break e;C=Y,v.currentTarget=fe;try{C(v)}catch(we){ms(we)}v.currentTarget=null,C=ae}}}}function pt(e,a){var l=a[_a];l===void 0&&(l=a[_a]=new Set);var c=e+"__bubble";l.has(c)||(fh(a,e,2,!1),l.add(c))}function dd(e,a,l){var c=0;a&&(c|=4),fh(l,e,c,a)}var ti="_reactListening"+Math.random().toString(36).slice(2);function ud(e){if(!e[ti]){e[ti]=!0,xa.forEach(function(l){l!=="selectionchange"&&(z_.has(l)||dd(l,!1,e),dd(l,!0,e))});var a=e.nodeType===9?e:e.ownerDocument;a===null||a[ti]||(a[ti]=!0,dd("selectionchange",!1,a))}}function fh(e,a,l,c){switch(Hh(a)){case 2:var v=v0;break;case 8:v=_0;break;default:v=jd}l=v.bind(null,a,l,e),v=void 0,!is||a!=="touchstart"&&a!=="touchmove"&&a!=="wheel"||(v=!0),c?v!==void 0?e.addEventListener(a,l,{capture:!0,passive:v}):e.addEventListener(a,l,!0):v!==void 0?e.addEventListener(a,l,{passive:v}):e.addEventListener(a,l,!1)}function pd(e,a,l,c,v){var C=c;if((a&1)===0&&(a&2)===0&&c!==null)e:for(;;){if(c===null)return;var F=c.tag;if(F===3||F===4){var Y=c.stateNode.containerInfo;if(Y===v)break;if(F===4)for(F=c.return;F!==null;){var ae=F.tag;if((ae===3||ae===4)&&F.stateNode.containerInfo===v)return;F=F.return}for(;Y!==null;){if(F=_n(Y),F===null)return;if(ae=F.tag,ae===5||ae===6||ae===26||ae===27){c=C=F;continue e}Y=Y.parentNode}}c=c.return}ss(function(){var fe=C,we=Ft(l),Ee=[];e:{var ye=Bu.get(e);if(ye!==void 0){var _e=ps,ze=e;switch(e){case"keypress":if(ds(l)===0)break e;case"keydown":case"keyup":_e=Lv;break;case"focusin":ze="focus",_e=qi;break;case"focusout":ze="blur",_e=qi;break;case"beforeblur":case"afterblur":_e=qi;break;case"click":if(l.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":_e=wu;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":_e=Ev;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":_e=Ov;break;case Mu:case Hu:case Vu:_e=Tv;break;case zu:_e=Hv;break;case"scroll":case"scrollend":_e=Sv;break;case"wheel":_e=zv;break;case"copy":case"cut":case"paste":_e=Av;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":_e=Cu;break;case"toggle":case"beforetoggle":_e=Gv}var Ke=(a&4)!==0,Tt=!Ke&&(e==="scroll"||e==="scrollend"),de=Ke?ye!==null?ye+"Capture":null:ye;Ke=[];for(var re=fe,pe;re!==null;){var Ce=re;if(pe=Ce.stateNode,Ce=Ce.tag,Ce!==5&&Ce!==26&&Ce!==27||pe===null||de===null||(Ce=Da(re,de),Ce!=null&&Ke.push(Ml(re,Ce,pe))),Tt)break;re=re.return}0<Ke.length&&(ye=new _e(ye,ze,null,l,we),Ee.push({event:ye,listeners:Ke}))}}if((a&7)===0){e:{if(ye=e==="mouseover"||e==="pointerover",_e=e==="mouseout"||e==="pointerout",ye&&l!==Sa&&(ze=l.relatedTarget||l.fromElement)&&(_n(ze)||ze[jn]))break e;if((_e||ye)&&(ye=we.window===we?we:(ye=we.ownerDocument)?ye.defaultView||ye.parentWindow:window,_e?(ze=l.relatedTarget||l.toElement,_e=fe,ze=ze?_n(ze):null,ze!==null&&(Tt=d(ze),Ke=ze.tag,ze!==Tt||Ke!==5&&Ke!==27&&Ke!==6)&&(ze=null)):(_e=null,ze=fe),_e!==ze)){if(Ke=wu,Ce="onMouseLeave",de="onMouseEnter",re="mouse",(e==="pointerout"||e==="pointerover")&&(Ke=Cu,Ce="onPointerLeave",de="onPointerEnter",re="pointer"),Tt=_e==null?ye:Tn(_e),pe=ze==null?ye:Tn(ze),ye=new Ke(Ce,re+"leave",_e,l,we),ye.target=Tt,ye.relatedTarget=pe,Ce=null,_n(we)===fe&&(Ke=new Ke(de,re+"enter",ze,l,we),Ke.target=pe,Ke.relatedTarget=Tt,Ce=Ke),Tt=Ce,_e&&ze)t:{for(Ke=B_,de=_e,re=ze,pe=0,Ce=de;Ce;Ce=Ke(Ce))pe++;Ce=0;for(var We=re;We;We=Ke(We))Ce++;for(;0<pe-Ce;)de=Ke(de),pe--;for(;0<Ce-pe;)re=Ke(re),Ce--;for(;pe--;){if(de===re||re!==null&&de===re.alternate){Ke=de;break t}de=Ke(de),re=Ke(re)}Ke=null}else Ke=null;_e!==null&&hh(Ee,ye,_e,Ke,!1),ze!==null&&Tt!==null&&hh(Ee,Tt,ze,Ke,!0)}}e:{if(ye=fe?Tn(fe):window,_e=ye.nodeName&&ye.nodeName.toLowerCase(),_e==="select"||_e==="input"&&ye.type==="file")var vt=Au;else if(Tu(ye))if(Ru)vt=n_;else{vt=e_;var Ye=Jv}else _e=ye.nodeName,!_e||_e.toLowerCase()!=="input"||ye.type!=="checkbox"&&ye.type!=="radio"?fe&&po(fe.elementType)&&(vt=Au):vt=t_;if(vt&&(vt=vt(e,fe))){Nu(Ee,vt,l,we);break e}Ye&&Ye(e,ye,fe),e==="focusout"&&fe&&ye.type==="number"&&fe.memoizedProps.value!=null&&za(ye,"number",ye.value)}switch(Ye=fe?Tn(fe):window,e){case"focusin":(Tu(Ye)||Ye.contentEditable==="true")&&(xr=Ye,Mi=fe,yl=null);break;case"focusout":yl=Mi=xr=null;break;case"mousedown":Hi=!0;break;case"contextmenu":case"mouseup":case"dragend":Hi=!1,Uu(Ee,l,we);break;case"selectionchange":if(o_)break;case"keydown":case"keyup":Uu(Ee,l,we)}var lt;if(Li)e:{switch(e){case"compositionstart":var ht="onCompositionStart";break e;case"compositionend":ht="onCompositionEnd";break e;case"compositionupdate":ht="onCompositionUpdate";break e}ht=void 0}else wr?ju(e,l)&&(ht="onCompositionEnd"):e==="keydown"&&l.keyCode===229&&(ht="onCompositionStart");ht&&(Su&&l.locale!=="ko"&&(wr||ht!=="onCompositionStart"?ht==="onCompositionEnd"&&wr&&(lt=vu()):(ho=we,Fi="value"in ho?ho.value:ho.textContent,wr=!0)),Ye=ni(fe,ht),0<Ye.length&&(ht=new xu(ht,e,null,l,we),Ee.push({event:ht,listeners:Ye}),lt?ht.data=lt:(lt=ku(l),lt!==null&&(ht.data=lt)))),(lt=Wv?Qv(e,l):Xv(e,l))&&(ht=ni(fe,"onBeforeInput"),0<ht.length&&(Ye=new xu("onBeforeInput","beforeinput",null,l,we),Ee.push({event:Ye,listeners:ht}),Ye.data=lt)),M_(Ee,e,fe,l,we)}ph(Ee,a)})}function Ml(e,a,l){return{instance:e,listener:a,currentTarget:l}}function ni(e,a){for(var l=a+"Capture",c=[];e!==null;){var v=e,C=v.stateNode;if(v=v.tag,v!==5&&v!==26&&v!==27||C===null||(v=Da(e,l),v!=null&&c.unshift(Ml(e,v,C)),v=Da(e,a),v!=null&&c.push(Ml(e,v,C))),e.tag===3)return c;e=e.return}return[]}function B_(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5&&e.tag!==27);return e||null}function hh(e,a,l,c,v){for(var C=a._reactName,F=[];l!==null&&l!==c;){var Y=l,ae=Y.alternate,fe=Y.stateNode;if(Y=Y.tag,ae!==null&&ae===c)break;Y!==5&&Y!==26&&Y!==27||fe===null||(ae=fe,v?(fe=Da(l,C),fe!=null&&F.unshift(Ml(l,fe,ae))):v||(fe=Da(l,C),fe!=null&&F.push(Ml(l,fe,ae)))),l=l.return}F.length!==0&&e.push({event:a,listeners:F})}var G_=/\r\n?/g,Y_=/\u0000|\uFFFD/g;function mh(e){return(typeof e=="string"?e:""+e).replace(G_,`
`).replace(Y_,"")}function yh(e,a){return a=mh(a),mh(e)===a}function kt(e,a,l,c,v,C){switch(l){case"children":typeof c=="string"?a==="body"||a==="textarea"&&c===""||ta(e,c):(typeof c=="number"||typeof c=="bigint")&&a!=="body"&&ta(e,""+c);break;case"className":Te(e,"class",c);break;case"tabIndex":Te(e,"tabindex",c);break;case"dir":case"role":case"viewBox":case"width":case"height":Te(e,l,c);break;case"style":Yo(e,c,C);break;case"data":if(a!=="object"){Te(e,"data",c);break}case"src":case"href":if(c===""&&(a!=="a"||l!=="href")){e.removeAttribute(l);break}if(c==null||typeof c=="function"||typeof c=="symbol"||typeof c=="boolean"){e.removeAttribute(l);break}c=Ba(""+c),e.setAttribute(l,c);break;case"action":case"formAction":if(typeof c=="function"){e.setAttribute(l,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof C=="function"&&(l==="formAction"?(a!=="input"&&kt(e,a,"name",v.name,v,null),kt(e,a,"formEncType",v.formEncType,v,null),kt(e,a,"formMethod",v.formMethod,v,null),kt(e,a,"formTarget",v.formTarget,v,null)):(kt(e,a,"encType",v.encType,v,null),kt(e,a,"method",v.method,v,null),kt(e,a,"target",v.target,v,null)));if(c==null||typeof c=="symbol"||typeof c=="boolean"){e.removeAttribute(l);break}c=Ba(""+c),e.setAttribute(l,c);break;case"onClick":c!=null&&(e.onclick=Nn);break;case"onScroll":c!=null&&pt("scroll",e);break;case"onScrollEnd":c!=null&&pt("scrollend",e);break;case"dangerouslySetInnerHTML":if(c!=null){if(typeof c!="object"||!("__html"in c))throw Error(i(61));if(l=c.__html,l!=null){if(v.children!=null)throw Error(i(60));e.innerHTML=l}}break;case"multiple":e.multiple=c&&typeof c!="function"&&typeof c!="symbol";break;case"muted":e.muted=c&&typeof c!="function"&&typeof c!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(c==null||typeof c=="function"||typeof c=="boolean"||typeof c=="symbol"){e.removeAttribute("xlink:href");break}l=Ba(""+c),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",l);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":c!=null&&typeof c!="function"&&typeof c!="symbol"?e.setAttribute(l,""+c):e.removeAttribute(l);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":c&&typeof c!="function"&&typeof c!="symbol"?e.setAttribute(l,""):e.removeAttribute(l);break;case"capture":case"download":c===!0?e.setAttribute(l,""):c!==!1&&c!=null&&typeof c!="function"&&typeof c!="symbol"?e.setAttribute(l,c):e.removeAttribute(l);break;case"cols":case"rows":case"size":case"span":c!=null&&typeof c!="function"&&typeof c!="symbol"&&!isNaN(c)&&1<=c?e.setAttribute(l,c):e.removeAttribute(l);break;case"rowSpan":case"start":c==null||typeof c=="function"||typeof c=="symbol"||isNaN(c)?e.removeAttribute(l):e.setAttribute(l,c);break;case"popover":pt("beforetoggle",e),pt("toggle",e),ve(e,"popover",c);break;case"xlinkActuate":Le(e,"http://www.w3.org/1999/xlink","xlink:actuate",c);break;case"xlinkArcrole":Le(e,"http://www.w3.org/1999/xlink","xlink:arcrole",c);break;case"xlinkRole":Le(e,"http://www.w3.org/1999/xlink","xlink:role",c);break;case"xlinkShow":Le(e,"http://www.w3.org/1999/xlink","xlink:show",c);break;case"xlinkTitle":Le(e,"http://www.w3.org/1999/xlink","xlink:title",c);break;case"xlinkType":Le(e,"http://www.w3.org/1999/xlink","xlink:type",c);break;case"xmlBase":Le(e,"http://www.w3.org/XML/1998/namespace","xml:base",c);break;case"xmlLang":Le(e,"http://www.w3.org/XML/1998/namespace","xml:lang",c);break;case"xmlSpace":Le(e,"http://www.w3.org/XML/1998/namespace","xml:space",c);break;case"is":ve(e,"is",c);break;case"innerText":case"textContent":break;default:(!(2<l.length)||l[0]!=="o"&&l[0]!=="O"||l[1]!=="n"&&l[1]!=="N")&&(l=vr.get(l)||l,ve(e,l,c))}}function fd(e,a,l,c,v,C){switch(l){case"style":Yo(e,c,C);break;case"dangerouslySetInnerHTML":if(c!=null){if(typeof c!="object"||!("__html"in c))throw Error(i(61));if(l=c.__html,l!=null){if(v.children!=null)throw Error(i(60));e.innerHTML=l}}break;case"children":typeof c=="string"?ta(e,c):(typeof c=="number"||typeof c=="bigint")&&ta(e,""+c);break;case"onScroll":c!=null&&pt("scroll",e);break;case"onScrollEnd":c!=null&&pt("scrollend",e);break;case"onClick":c!=null&&(e.onclick=Nn);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Ca.hasOwnProperty(l))e:{if(l[0]==="o"&&l[1]==="n"&&(v=l.endsWith("Capture"),a=l.slice(2,v?l.length-7:void 0),C=e[Ut]||null,C=C!=null?C[l]:null,typeof C=="function"&&e.removeEventListener(a,C,v),typeof c=="function")){typeof C!="function"&&C!==null&&(l in e?e[l]=null:e.hasAttribute(l)&&e.removeAttribute(l)),e.addEventListener(a,c,v);break e}l in e?e[l]=c:c===!0?e.setAttribute(l,""):ve(e,l,c)}}}function cn(e,a,l){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":pt("error",e),pt("load",e);var c=!1,v=!1,C;for(C in l)if(l.hasOwnProperty(C)){var F=l[C];if(F!=null)switch(C){case"src":c=!0;break;case"srcSet":v=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(i(137,a));default:kt(e,a,C,F,l,null)}}v&&kt(e,a,"srcSet",l.srcSet,l,null),c&&kt(e,a,"src",l.src,l,null);return;case"input":pt("invalid",e);var Y=C=F=v=null,ae=null,fe=null;for(c in l)if(l.hasOwnProperty(c)){var we=l[c];if(we!=null)switch(c){case"name":v=we;break;case"type":F=we;break;case"checked":ae=we;break;case"defaultChecked":fe=we;break;case"value":C=we;break;case"defaultValue":Y=we;break;case"children":case"dangerouslySetInnerHTML":if(we!=null)throw Error(i(137,a));break;default:kt(e,a,c,we,l,null)}}io(e,C,Y,ae,fe,F,v,!1);return;case"select":pt("invalid",e),c=F=C=null;for(v in l)if(l.hasOwnProperty(v)&&(Y=l[v],Y!=null))switch(v){case"value":C=Y;break;case"defaultValue":F=Y;break;case"multiple":c=Y;default:kt(e,a,v,Y,l,null)}a=C,l=F,e.multiple=!!c,a!=null?ea(e,!!c,a,!1):l!=null&&ea(e,!!c,l,!0);return;case"textarea":pt("invalid",e),C=v=c=null;for(F in l)if(l.hasOwnProperty(F)&&(Y=l[F],Y!=null))switch(F){case"value":c=Y;break;case"defaultValue":v=Y;break;case"children":C=Y;break;case"dangerouslySetInnerHTML":if(Y!=null)throw Error(i(91));break;default:kt(e,a,F,Y,l,null)}uo(e,c,v,C);return;case"option":for(ae in l)if(l.hasOwnProperty(ae)&&(c=l[ae],c!=null))switch(ae){case"selected":e.selected=c&&typeof c!="function"&&typeof c!="symbol";break;default:kt(e,a,ae,c,l,null)}return;case"dialog":pt("beforetoggle",e),pt("toggle",e),pt("cancel",e),pt("close",e);break;case"iframe":case"object":pt("load",e);break;case"video":case"audio":for(c=0;c<Ol.length;c++)pt(Ol[c],e);break;case"image":pt("error",e),pt("load",e);break;case"details":pt("toggle",e);break;case"embed":case"source":case"link":pt("error",e),pt("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(fe in l)if(l.hasOwnProperty(fe)&&(c=l[fe],c!=null))switch(fe){case"children":case"dangerouslySetInnerHTML":throw Error(i(137,a));default:kt(e,a,fe,c,l,null)}return;default:if(po(a)){for(we in l)l.hasOwnProperty(we)&&(c=l[we],c!==void 0&&fd(e,a,we,c,l,void 0));return}}for(Y in l)l.hasOwnProperty(Y)&&(c=l[Y],c!=null&&kt(e,a,Y,c,l,null))}function W_(e,a,l,c){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var v=null,C=null,F=null,Y=null,ae=null,fe=null,we=null;for(_e in l){var Ee=l[_e];if(l.hasOwnProperty(_e)&&Ee!=null)switch(_e){case"checked":break;case"value":break;case"defaultValue":ae=Ee;default:c.hasOwnProperty(_e)||kt(e,a,_e,null,c,Ee)}}for(var ye in c){var _e=c[ye];if(Ee=l[ye],c.hasOwnProperty(ye)&&(_e!=null||Ee!=null))switch(ye){case"type":C=_e;break;case"name":v=_e;break;case"checked":fe=_e;break;case"defaultChecked":we=_e;break;case"value":F=_e;break;case"defaultValue":Y=_e;break;case"children":case"dangerouslySetInnerHTML":if(_e!=null)throw Error(i(137,a));break;default:_e!==Ee&&kt(e,a,ye,_e,c,Ee)}}Bo(e,F,Y,ae,fe,we,C,v);return;case"select":_e=F=Y=ye=null;for(C in l)if(ae=l[C],l.hasOwnProperty(C)&&ae!=null)switch(C){case"value":break;case"multiple":_e=ae;default:c.hasOwnProperty(C)||kt(e,a,C,null,c,ae)}for(v in c)if(C=c[v],ae=l[v],c.hasOwnProperty(v)&&(C!=null||ae!=null))switch(v){case"value":ye=C;break;case"defaultValue":Y=C;break;case"multiple":F=C;default:C!==ae&&kt(e,a,v,C,c,ae)}a=Y,l=F,c=_e,ye!=null?ea(e,!!l,ye,!1):!!c!=!!l&&(a!=null?ea(e,!!l,a,!0):ea(e,!!l,l?[]:"",!1));return;case"textarea":_e=ye=null;for(Y in l)if(v=l[Y],l.hasOwnProperty(Y)&&v!=null&&!c.hasOwnProperty(Y))switch(Y){case"value":break;case"children":break;default:kt(e,a,Y,null,c,v)}for(F in c)if(v=c[F],C=l[F],c.hasOwnProperty(F)&&(v!=null||C!=null))switch(F){case"value":ye=v;break;case"defaultValue":_e=v;break;case"children":break;case"dangerouslySetInnerHTML":if(v!=null)throw Error(i(91));break;default:v!==C&&kt(e,a,F,v,c,C)}co(e,ye,_e);return;case"option":for(var ze in l)if(ye=l[ze],l.hasOwnProperty(ze)&&ye!=null&&!c.hasOwnProperty(ze))switch(ze){case"selected":e.selected=!1;break;default:kt(e,a,ze,null,c,ye)}for(ae in c)if(ye=c[ae],_e=l[ae],c.hasOwnProperty(ae)&&ye!==_e&&(ye!=null||_e!=null))switch(ae){case"selected":e.selected=ye&&typeof ye!="function"&&typeof ye!="symbol";break;default:kt(e,a,ae,ye,c,_e)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Ke in l)ye=l[Ke],l.hasOwnProperty(Ke)&&ye!=null&&!c.hasOwnProperty(Ke)&&kt(e,a,Ke,null,c,ye);for(fe in c)if(ye=c[fe],_e=l[fe],c.hasOwnProperty(fe)&&ye!==_e&&(ye!=null||_e!=null))switch(fe){case"children":case"dangerouslySetInnerHTML":if(ye!=null)throw Error(i(137,a));break;default:kt(e,a,fe,ye,c,_e)}return;default:if(po(a)){for(var Tt in l)ye=l[Tt],l.hasOwnProperty(Tt)&&ye!==void 0&&!c.hasOwnProperty(Tt)&&fd(e,a,Tt,void 0,c,ye);for(we in c)ye=c[we],_e=l[we],!c.hasOwnProperty(we)||ye===_e||ye===void 0&&_e===void 0||fd(e,a,we,ye,c,_e);return}}for(var de in l)ye=l[de],l.hasOwnProperty(de)&&ye!=null&&!c.hasOwnProperty(de)&&kt(e,a,de,null,c,ye);for(Ee in c)ye=c[Ee],_e=l[Ee],!c.hasOwnProperty(Ee)||ye===_e||ye==null&&_e==null||kt(e,a,Ee,ye,c,_e)}function gh(e){switch(e){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function Q_(){if(typeof performance.getEntriesByType=="function"){for(var e=0,a=0,l=performance.getEntriesByType("resource"),c=0;c<l.length;c++){var v=l[c],C=v.transferSize,F=v.initiatorType,Y=v.duration;if(C&&Y&&gh(F)){for(F=0,Y=v.responseEnd,c+=1;c<l.length;c++){var ae=l[c],fe=ae.startTime;if(fe>Y)break;var we=ae.transferSize,Ee=ae.initiatorType;we&&gh(Ee)&&(ae=ae.responseEnd,F+=we*(ae<Y?1:(Y-fe)/(ae-fe)))}if(--c,a+=8*(C+F)/(v.duration/1e3),e++,10<e)break}}if(0<e)return a/e/1e6}return navigator.connection&&(e=navigator.connection.downlink,typeof e=="number")?e:5}var hd=null,md=null;function ai(e){return e.nodeType===9?e:e.ownerDocument}function vh(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function _h(e,a){if(e===0)switch(a){case"svg":return 1;case"math":return 2;default:return 0}return e===1&&a==="foreignObject"?0:e}function yd(e,a){return e==="textarea"||e==="noscript"||typeof a.children=="string"||typeof a.children=="number"||typeof a.children=="bigint"||typeof a.dangerouslySetInnerHTML=="object"&&a.dangerouslySetInnerHTML!==null&&a.dangerouslySetInnerHTML.__html!=null}var gd=null;function X_(){var e=window.event;return e&&e.type==="popstate"?e===gd?!1:(gd=e,!0):(gd=null,!1)}var wh=typeof setTimeout=="function"?setTimeout:void 0,Z_=typeof clearTimeout=="function"?clearTimeout:void 0,xh=typeof Promise=="function"?Promise:void 0,K_=typeof queueMicrotask=="function"?queueMicrotask:typeof xh<"u"?function(e){return xh.resolve(null).then(e).catch(J_)}:wh;function J_(e){setTimeout(function(){throw e})}function Ro(e){return e==="head"}function Ch(e,a){var l=a,c=0;do{var v=l.nextSibling;if(e.removeChild(l),v&&v.nodeType===8)if(l=v.data,l==="/$"||l==="/&"){if(c===0){e.removeChild(v),Wr(a);return}c--}else if(l==="$"||l==="$?"||l==="$~"||l==="$!"||l==="&")c++;else if(l==="html")Hl(e.ownerDocument.documentElement);else if(l==="head"){l=e.ownerDocument.head,Hl(l);for(var C=l.firstChild;C;){var F=C.nextSibling,Y=C.nodeName;C[kn]||Y==="SCRIPT"||Y==="STYLE"||Y==="LINK"&&C.rel.toLowerCase()==="stylesheet"||l.removeChild(C),C=F}}else l==="body"&&Hl(e.ownerDocument.body);l=v}while(l);Wr(a)}function Sh(e,a){var l=e;e=0;do{var c=l.nextSibling;if(l.nodeType===1?a?(l._stashedDisplay=l.style.display,l.style.display="none"):(l.style.display=l._stashedDisplay||"",l.getAttribute("style")===""&&l.removeAttribute("style")):l.nodeType===3&&(a?(l._stashedText=l.nodeValue,l.nodeValue=""):l.nodeValue=l._stashedText||""),c&&c.nodeType===8)if(l=c.data,l==="/$"){if(e===0)break;e--}else l!=="$"&&l!=="$?"&&l!=="$~"&&l!=="$!"||e++;l=c}while(l)}function vd(e){var a=e.firstChild;for(a&&a.nodeType===10&&(a=a.nextSibling);a;){var l=a;switch(a=a.nextSibling,l.nodeName){case"HTML":case"HEAD":case"BODY":vd(l),Jn(l);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(l.rel.toLowerCase()==="stylesheet")continue}e.removeChild(l)}}function e0(e,a,l,c){for(;e.nodeType===1;){var v=l;if(e.nodeName.toLowerCase()!==a.toLowerCase()){if(!c&&(e.nodeName!=="INPUT"||e.type!=="hidden"))break}else if(c){if(!e[kn])switch(a){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if(C=e.getAttribute("rel"),C==="stylesheet"&&e.hasAttribute("data-precedence"))break;if(C!==v.rel||e.getAttribute("href")!==(v.href==null||v.href===""?null:v.href)||e.getAttribute("crossorigin")!==(v.crossOrigin==null?null:v.crossOrigin)||e.getAttribute("title")!==(v.title==null?null:v.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(C=e.getAttribute("src"),(C!==(v.src==null?null:v.src)||e.getAttribute("type")!==(v.type==null?null:v.type)||e.getAttribute("crossorigin")!==(v.crossOrigin==null?null:v.crossOrigin))&&C&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else if(a==="input"&&e.type==="hidden"){var C=v.name==null?null:""+v.name;if(v.type==="hidden"&&e.getAttribute("name")===C)return e}else return e;if(e=ca(e.nextSibling),e===null)break}return null}function t0(e,a,l){if(a==="")return null;for(;e.nodeType!==3;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!l||(e=ca(e.nextSibling),e===null))return null;return e}function bh(e,a){for(;e.nodeType!==8;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!a||(e=ca(e.nextSibling),e===null))return null;return e}function _d(e){return e.data==="$?"||e.data==="$~"}function wd(e){return e.data==="$!"||e.data==="$?"&&e.ownerDocument.readyState!=="loading"}function n0(e,a){var l=e.ownerDocument;if(e.data==="$~")e._reactRetry=a;else if(e.data!=="$?"||l.readyState!=="loading")a();else{var c=function(){a(),l.removeEventListener("DOMContentLoaded",c)};l.addEventListener("DOMContentLoaded",c),e._reactRetry=c}}function ca(e){for(;e!=null;e=e.nextSibling){var a=e.nodeType;if(a===1||a===3)break;if(a===8){if(a=e.data,a==="$"||a==="$!"||a==="$?"||a==="$~"||a==="&"||a==="F!"||a==="F")break;if(a==="/$"||a==="/&")return null}}return e}var xd=null;function Eh(e){e=e.nextSibling;for(var a=0;e;){if(e.nodeType===8){var l=e.data;if(l==="/$"||l==="/&"){if(a===0)return ca(e.nextSibling);a--}else l!=="$"&&l!=="$!"&&l!=="$?"&&l!=="$~"&&l!=="&"||a++}e=e.nextSibling}return null}function jh(e){e=e.previousSibling;for(var a=0;e;){if(e.nodeType===8){var l=e.data;if(l==="$"||l==="$!"||l==="$?"||l==="$~"||l==="&"){if(a===0)return e;a--}else l!=="/$"&&l!=="/&"||a++}e=e.previousSibling}return null}function kh(e,a,l){switch(a=ai(l),e){case"html":if(e=a.documentElement,!e)throw Error(i(452));return e;case"head":if(e=a.head,!e)throw Error(i(453));return e;case"body":if(e=a.body,!e)throw Error(i(454));return e;default:throw Error(i(451))}}function Hl(e){for(var a=e.attributes;a.length;)e.removeAttributeNode(a[0]);Jn(e)}var da=new Map,Th=new Set;function oi(e){return typeof e.getRootNode=="function"?e.getRootNode():e.nodeType===9?e:e.ownerDocument}var lo=q.d;q.d={f:a0,r:o0,D:r0,C:l0,L:s0,m:i0,X:d0,S:c0,M:u0};function a0(){var e=lo.f(),a=Qs();return e||a}function o0(e){var a=wn(e);a!==null&&a.tag===5&&a.type==="form"?zp(a):lo.r(e)}var Br=typeof document>"u"?null:document;function Nh(e,a,l){var c=Br;if(c&&typeof a=="string"&&a){var v=on(a);v='link[rel="'+e+'"][href="'+v+'"]',typeof l=="string"&&(v+='[crossorigin="'+l+'"]'),Th.has(v)||(Th.add(v),e={rel:e,crossOrigin:l,href:a},c.querySelector(v)===null&&(a=c.createElement("link"),cn(a,"link",e),Nt(a),c.head.appendChild(a)))}}function r0(e){lo.D(e),Nh("dns-prefetch",e,null)}function l0(e,a){lo.C(e,a),Nh("preconnect",e,a)}function s0(e,a,l){lo.L(e,a,l);var c=Br;if(c&&e&&a){var v='link[rel="preload"][as="'+on(a)+'"]';a==="image"&&l&&l.imageSrcSet?(v+='[imagesrcset="'+on(l.imageSrcSet)+'"]',typeof l.imageSizes=="string"&&(v+='[imagesizes="'+on(l.imageSizes)+'"]')):v+='[href="'+on(e)+'"]';var C=v;switch(a){case"style":C=Gr(e);break;case"script":C=Yr(e)}da.has(C)||(e=g({rel:"preload",href:a==="image"&&l&&l.imageSrcSet?void 0:e,as:a},l),da.set(C,e),c.querySelector(v)!==null||a==="style"&&c.querySelector(Vl(C))||a==="script"&&c.querySelector(zl(C))||(a=c.createElement("link"),cn(a,"link",e),Nt(a),c.head.appendChild(a)))}}function i0(e,a){lo.m(e,a);var l=Br;if(l&&e){var c=a&&typeof a.as=="string"?a.as:"script",v='link[rel="modulepreload"][as="'+on(c)+'"][href="'+on(e)+'"]',C=v;switch(c){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":C=Yr(e)}if(!da.has(C)&&(e=g({rel:"modulepreload",href:e},a),da.set(C,e),l.querySelector(v)===null)){switch(c){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(l.querySelector(zl(C)))return}c=l.createElement("link"),cn(c,"link",e),Nt(c),l.head.appendChild(c)}}}function c0(e,a,l){lo.S(e,a,l);var c=Br;if(c&&e){var v=xn(c).hoistableStyles,C=Gr(e);a=a||"default";var F=v.get(C);if(!F){var Y={loading:0,preload:null};if(F=c.querySelector(Vl(C)))Y.loading=5;else{e=g({rel:"stylesheet",href:e,"data-precedence":a},l),(l=da.get(C))&&Cd(e,l);var ae=F=c.createElement("link");Nt(ae),cn(ae,"link",e),ae._p=new Promise(function(fe,we){ae.onload=fe,ae.onerror=we}),ae.addEventListener("load",function(){Y.loading|=1}),ae.addEventListener("error",function(){Y.loading|=2}),Y.loading|=4,ri(F,a,c)}F={type:"stylesheet",instance:F,count:1,state:Y},v.set(C,F)}}}function d0(e,a){lo.X(e,a);var l=Br;if(l&&e){var c=xn(l).hoistableScripts,v=Yr(e),C=c.get(v);C||(C=l.querySelector(zl(v)),C||(e=g({src:e,async:!0},a),(a=da.get(v))&&Sd(e,a),C=l.createElement("script"),Nt(C),cn(C,"link",e),l.head.appendChild(C)),C={type:"script",instance:C,count:1,state:null},c.set(v,C))}}function u0(e,a){lo.M(e,a);var l=Br;if(l&&e){var c=xn(l).hoistableScripts,v=Yr(e),C=c.get(v);C||(C=l.querySelector(zl(v)),C||(e=g({src:e,async:!0,type:"module"},a),(a=da.get(v))&&Sd(e,a),C=l.createElement("script"),Nt(C),cn(C,"link",e),l.head.appendChild(C)),C={type:"script",instance:C,count:1,state:null},c.set(v,C))}}function Ah(e,a,l,c){var v=(v=oe.current)?oi(v):null;if(!v)throw Error(i(446));switch(e){case"meta":case"title":return null;case"style":return typeof l.precedence=="string"&&typeof l.href=="string"?(a=Gr(l.href),l=xn(v).hoistableStyles,c=l.get(a),c||(c={type:"style",instance:null,count:0,state:null},l.set(a,c)),c):{type:"void",instance:null,count:0,state:null};case"link":if(l.rel==="stylesheet"&&typeof l.href=="string"&&typeof l.precedence=="string"){e=Gr(l.href);var C=xn(v).hoistableStyles,F=C.get(e);if(F||(v=v.ownerDocument||v,F={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},C.set(e,F),(C=v.querySelector(Vl(e)))&&!C._p&&(F.instance=C,F.state.loading=5),da.has(e)||(l={rel:"preload",as:"style",href:l.href,crossOrigin:l.crossOrigin,integrity:l.integrity,media:l.media,hrefLang:l.hrefLang,referrerPolicy:l.referrerPolicy},da.set(e,l),C||p0(v,e,l,F.state))),a&&c===null)throw Error(i(528,""));return F}if(a&&c!==null)throw Error(i(529,""));return null;case"script":return a=l.async,l=l.src,typeof l=="string"&&a&&typeof a!="function"&&typeof a!="symbol"?(a=Yr(l),l=xn(v).hoistableScripts,c=l.get(a),c||(c={type:"script",instance:null,count:0,state:null},l.set(a,c)),c):{type:"void",instance:null,count:0,state:null};default:throw Error(i(444,e))}}function Gr(e){return'href="'+on(e)+'"'}function Vl(e){return'link[rel="stylesheet"]['+e+"]"}function Rh(e){return g({},e,{"data-precedence":e.precedence,precedence:null})}function p0(e,a,l,c){e.querySelector('link[rel="preload"][as="style"]['+a+"]")?c.loading=1:(a=e.createElement("link"),c.preload=a,a.addEventListener("load",function(){return c.loading|=1}),a.addEventListener("error",function(){return c.loading|=2}),cn(a,"link",l),Nt(a),e.head.appendChild(a))}function Yr(e){return'[src="'+on(e)+'"]'}function zl(e){return"script[async]"+e}function Fh(e,a,l){if(a.count++,a.instance===null)switch(a.type){case"style":var c=e.querySelector('style[data-href~="'+on(l.href)+'"]');if(c)return a.instance=c,Nt(c),c;var v=g({},l,{"data-href":l.href,"data-precedence":l.precedence,href:null,precedence:null});return c=(e.ownerDocument||e).createElement("style"),Nt(c),cn(c,"style",v),ri(c,l.precedence,e),a.instance=c;case"stylesheet":v=Gr(l.href);var C=e.querySelector(Vl(v));if(C)return a.state.loading|=4,a.instance=C,Nt(C),C;c=Rh(l),(v=da.get(v))&&Cd(c,v),C=(e.ownerDocument||e).createElement("link"),Nt(C);var F=C;return F._p=new Promise(function(Y,ae){F.onload=Y,F.onerror=ae}),cn(C,"link",c),a.state.loading|=4,ri(C,l.precedence,e),a.instance=C;case"script":return C=Yr(l.src),(v=e.querySelector(zl(C)))?(a.instance=v,Nt(v),v):(c=l,(v=da.get(C))&&(c=g({},l),Sd(c,v)),e=e.ownerDocument||e,v=e.createElement("script"),Nt(v),cn(v,"link",c),e.head.appendChild(v),a.instance=v);case"void":return null;default:throw Error(i(443,a.type))}else a.type==="stylesheet"&&(a.state.loading&4)===0&&(c=a.instance,a.state.loading|=4,ri(c,l.precedence,e));return a.instance}function ri(e,a,l){for(var c=l.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),v=c.length?c[c.length-1]:null,C=v,F=0;F<c.length;F++){var Y=c[F];if(Y.dataset.precedence===a)C=Y;else if(C!==v)break}C?C.parentNode.insertBefore(e,C.nextSibling):(a=l.nodeType===9?l.head:l,a.insertBefore(e,a.firstChild))}function Cd(e,a){e.crossOrigin==null&&(e.crossOrigin=a.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=a.referrerPolicy),e.title==null&&(e.title=a.title)}function Sd(e,a){e.crossOrigin==null&&(e.crossOrigin=a.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=a.referrerPolicy),e.integrity==null&&(e.integrity=a.integrity)}var li=null;function Dh(e,a,l){if(li===null){var c=new Map,v=li=new Map;v.set(l,c)}else v=li,c=v.get(l),c||(c=new Map,v.set(l,c));if(c.has(e))return c;for(c.set(e,null),l=l.getElementsByTagName(e),v=0;v<l.length;v++){var C=l[v];if(!(C[kn]||C[Dt]||e==="link"&&C.getAttribute("rel")==="stylesheet")&&C.namespaceURI!=="http://www.w3.org/2000/svg"){var F=C.getAttribute(a)||"";F=e+F;var Y=c.get(F);Y?Y.push(C):c.set(F,[C])}}return c}function $h(e,a,l){e=e.ownerDocument||e,e.head.insertBefore(l,a==="title"?e.querySelector("head > title"):null)}function f0(e,a,l){if(l===1||a.itemProp!=null)return!1;switch(e){case"meta":case"title":return!0;case"style":if(typeof a.precedence!="string"||typeof a.href!="string"||a.href==="")break;return!0;case"link":if(typeof a.rel!="string"||typeof a.href!="string"||a.href===""||a.onLoad||a.onError)break;switch(a.rel){case"stylesheet":return e=a.disabled,typeof a.precedence=="string"&&e==null;default:return!0}case"script":if(a.async&&typeof a.async!="function"&&typeof a.async!="symbol"&&!a.onLoad&&!a.onError&&a.src&&typeof a.src=="string")return!0}return!1}function qh(e){return!(e.type==="stylesheet"&&(e.state.loading&3)===0)}function h0(e,a,l,c){if(l.type==="stylesheet"&&(typeof c.media!="string"||matchMedia(c.media).matches!==!1)&&(l.state.loading&4)===0){if(l.instance===null){var v=Gr(c.href),C=a.querySelector(Vl(v));if(C){a=C._p,a!==null&&typeof a=="object"&&typeof a.then=="function"&&(e.count++,e=si.bind(e),a.then(e,e)),l.state.loading|=4,l.instance=C,Nt(C);return}C=a.ownerDocument||a,c=Rh(c),(v=da.get(v))&&Cd(c,v),C=C.createElement("link"),Nt(C);var F=C;F._p=new Promise(function(Y,ae){F.onload=Y,F.onerror=ae}),cn(C,"link",c),l.instance=C}e.stylesheets===null&&(e.stylesheets=new Map),e.stylesheets.set(l,a),(a=l.state.preload)&&(l.state.loading&3)===0&&(e.count++,l=si.bind(e),a.addEventListener("load",l),a.addEventListener("error",l))}}var bd=0;function m0(e,a){return e.stylesheets&&e.count===0&&ci(e,e.stylesheets),0<e.count||0<e.imgCount?function(l){var c=setTimeout(function(){if(e.stylesheets&&ci(e,e.stylesheets),e.unsuspend){var C=e.unsuspend;e.unsuspend=null,C()}},6e4+a);0<e.imgBytes&&bd===0&&(bd=62500*Q_());var v=setTimeout(function(){if(e.waitingForImages=!1,e.count===0&&(e.stylesheets&&ci(e,e.stylesheets),e.unsuspend)){var C=e.unsuspend;e.unsuspend=null,C()}},(e.imgBytes>bd?50:800)+a);return e.unsuspend=l,function(){e.unsuspend=null,clearTimeout(c),clearTimeout(v)}}:null}function si(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)ci(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}}var ii=null;function ci(e,a){e.stylesheets=null,e.unsuspend!==null&&(e.count++,ii=new Map,a.forEach(y0,e),ii=null,si.call(e))}function y0(e,a){if(!(a.state.loading&4)){var l=ii.get(e);if(l)var c=l.get(null);else{l=new Map,ii.set(e,l);for(var v=e.querySelectorAll("link[data-precedence],style[data-precedence]"),C=0;C<v.length;C++){var F=v[C];(F.nodeName==="LINK"||F.getAttribute("media")!=="not all")&&(l.set(F.dataset.precedence,F),c=F)}c&&l.set(null,c)}v=a.instance,F=v.getAttribute("data-precedence"),C=l.get(F)||c,C===c&&l.set(null,v),l.set(F,v),this.count++,c=si.bind(this),v.addEventListener("load",c),v.addEventListener("error",c),C?C.parentNode.insertBefore(v,C.nextSibling):(e=e.nodeType===9?e.head:e,e.insertBefore(v,e.firstChild)),a.state.loading|=4}}var Bl={$$typeof:k,Provider:null,Consumer:null,_currentValue:P,_currentValue2:P,_threadCount:0};function g0(e,a,l,c,v,C,F,Y,ae){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=ma(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ma(0),this.hiddenUpdates=ma(null),this.identifierPrefix=c,this.onUncaughtError=v,this.onCaughtError=C,this.onRecoverableError=F,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=ae,this.incompleteTransitions=new Map}function Ih(e,a,l,c,v,C,F,Y,ae,fe,we,Ee){return e=new g0(e,a,l,F,ae,fe,we,Ee,Y),a=1,C===!0&&(a|=24),C=Mn(3,null,null,a),e.current=C,C.stateNode=e,a=ac(),a.refCount++,e.pooledCache=a,a.refCount++,C.memoizedState={element:c,isDehydrated:l,cache:a},sc(C),e}function Lh(e){return e?(e=br,e):br}function Ph(e,a,l,c,v,C){v=Lh(v),c.context===null?c.context=v:c.pendingContext=v,c=wo(a),c.payload={element:l},C=C===void 0?null:C,C!==null&&(c.callback=C),l=xo(e,c,a),l!==null&&(qn(l,e,a),Sl(l,e,a))}function Uh(e,a){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var l=e.retryLane;e.retryLane=l!==0&&l<a?l:a}}function Ed(e,a){Uh(e,a),(e=e.alternate)&&Uh(e,a)}function Oh(e){if(e.tag===13||e.tag===31){var a=Ko(e,67108864);a!==null&&qn(a,e,67108864),Ed(e,67108864)}}function Mh(e){if(e.tag===13||e.tag===31){var a=Gn();a=ya(a);var l=Ko(e,a);l!==null&&qn(l,e,a),Ed(e,a)}}var di=!0;function v0(e,a,l,c){var v=T.T;T.T=null;var C=q.p;try{q.p=2,jd(e,a,l,c)}finally{q.p=C,T.T=v}}function _0(e,a,l,c){var v=T.T;T.T=null;var C=q.p;try{q.p=8,jd(e,a,l,c)}finally{q.p=C,T.T=v}}function jd(e,a,l,c){if(di){var v=kd(c);if(v===null)pd(e,a,c,ui,l),Vh(e,c);else if(x0(v,e,a,l,c))c.stopPropagation();else if(Vh(e,c),a&4&&-1<w0.indexOf(e)){for(;v!==null;){var C=wn(v);if(C!==null)switch(C.tag){case 3:if(C=C.stateNode,C.current.memoizedState.isDehydrated){var F=Ht(C.pendingLanes);if(F!==0){var Y=C;for(Y.pendingLanes|=2,Y.entangledLanes|=2;F;){var ae=1<<31-Pt(F);Y.entanglements[1]|=ae,F&=~ae}La(C),(wt&6)===0&&(Ys=je()+500,Ul(0))}}break;case 31:case 13:Y=Ko(C,2),Y!==null&&qn(Y,C,2),Qs(),Ed(C,2)}if(C=kd(c),C===null&&pd(e,a,c,ui,l),C===v)break;v=C}v!==null&&c.stopPropagation()}else pd(e,a,c,null,l)}}function kd(e){return e=Ft(e),Td(e)}var ui=null;function Td(e){if(ui=null,e=_n(e),e!==null){var a=d(e);if(a===null)e=null;else{var l=a.tag;if(l===13){if(e=u(a),e!==null)return e;e=null}else if(l===31){if(e=p(a),e!==null)return e;e=null}else if(l===3){if(a.stateNode.current.memoizedState.isDehydrated)return a.tag===3?a.stateNode.containerInfo:null;e=null}else a!==e&&(e=null)}}return ui=e,null}function Hh(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Re()){case Ie:return 2;case Ve:return 8;case it:case nt:return 32;case Rt:return 268435456;default:return 32}default:return 32}}var Nd=!1,Fo=null,Do=null,$o=null,Gl=new Map,Yl=new Map,qo=[],w0="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Vh(e,a){switch(e){case"focusin":case"focusout":Fo=null;break;case"dragenter":case"dragleave":Do=null;break;case"mouseover":case"mouseout":$o=null;break;case"pointerover":case"pointerout":Gl.delete(a.pointerId);break;case"gotpointercapture":case"lostpointercapture":Yl.delete(a.pointerId)}}function Wl(e,a,l,c,v,C){return e===null||e.nativeEvent!==C?(e={blockedOn:a,domEventName:l,eventSystemFlags:c,nativeEvent:C,targetContainers:[v]},a!==null&&(a=wn(a),a!==null&&Oh(a)),e):(e.eventSystemFlags|=c,a=e.targetContainers,v!==null&&a.indexOf(v)===-1&&a.push(v),e)}function x0(e,a,l,c,v){switch(a){case"focusin":return Fo=Wl(Fo,e,a,l,c,v),!0;case"dragenter":return Do=Wl(Do,e,a,l,c,v),!0;case"mouseover":return $o=Wl($o,e,a,l,c,v),!0;case"pointerover":var C=v.pointerId;return Gl.set(C,Wl(Gl.get(C)||null,e,a,l,c,v)),!0;case"gotpointercapture":return C=v.pointerId,Yl.set(C,Wl(Yl.get(C)||null,e,a,l,c,v)),!0}return!1}function zh(e){var a=_n(e.target);if(a!==null){var l=d(a);if(l!==null){if(a=l.tag,a===13){if(a=u(l),a!==null){e.blockedOn=a,va(e.priority,function(){Mh(l)});return}}else if(a===31){if(a=p(l),a!==null){e.blockedOn=a,va(e.priority,function(){Mh(l)});return}}else if(a===3&&l.stateNode.current.memoizedState.isDehydrated){e.blockedOn=l.tag===3?l.stateNode.containerInfo:null;return}}}e.blockedOn=null}function pi(e){if(e.blockedOn!==null)return!1;for(var a=e.targetContainers;0<a.length;){var l=kd(e.nativeEvent);if(l===null){l=e.nativeEvent;var c=new l.constructor(l.type,l);Sa=c,l.target.dispatchEvent(c),Sa=null}else return a=wn(l),a!==null&&Oh(a),e.blockedOn=l,!1;a.shift()}return!0}function Bh(e,a,l){pi(e)&&l.delete(a)}function C0(){Nd=!1,Fo!==null&&pi(Fo)&&(Fo=null),Do!==null&&pi(Do)&&(Do=null),$o!==null&&pi($o)&&($o=null),Gl.forEach(Bh),Yl.forEach(Bh)}function fi(e,a){e.blockedOn===a&&(e.blockedOn=null,Nd||(Nd=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,C0)))}var hi=null;function Gh(e){hi!==e&&(hi=e,t.unstable_scheduleCallback(t.unstable_NormalPriority,function(){hi===e&&(hi=null);for(var a=0;a<e.length;a+=3){var l=e[a],c=e[a+1],v=e[a+2];if(typeof c!="function"){if(Td(c||l)===null)continue;break}var C=wn(l);C!==null&&(e.splice(a,3),a-=3,kc(C,{pending:!0,data:v,method:l.method,action:c},c,v))}}))}function Wr(e){function a(ae){return fi(ae,e)}Fo!==null&&fi(Fo,e),Do!==null&&fi(Do,e),$o!==null&&fi($o,e),Gl.forEach(a),Yl.forEach(a);for(var l=0;l<qo.length;l++){var c=qo[l];c.blockedOn===e&&(c.blockedOn=null)}for(;0<qo.length&&(l=qo[0],l.blockedOn===null);)zh(l),l.blockedOn===null&&qo.shift();if(l=(e.ownerDocument||e).$$reactFormReplay,l!=null)for(c=0;c<l.length;c+=3){var v=l[c],C=l[c+1],F=v[Ut]||null;if(typeof C=="function")F||Gh(l);else if(F){var Y=null;if(C&&C.hasAttribute("formAction")){if(v=C,F=C[Ut]||null)Y=F.formAction;else if(Td(v)!==null)continue}else Y=F.action;typeof Y=="function"?l[c+1]=Y:(l.splice(c,3),c-=3),Gh(l)}}}function Yh(){function e(C){C.canIntercept&&C.info==="react-transition"&&C.intercept({handler:function(){return new Promise(function(F){return v=F})},focusReset:"manual",scroll:"manual"})}function a(){v!==null&&(v(),v=null),c||setTimeout(l,20)}function l(){if(!c&&!navigation.transition){var C=navigation.currentEntry;C&&C.url!=null&&navigation.navigate(C.url,{state:C.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var c=!1,v=null;return navigation.addEventListener("navigate",e),navigation.addEventListener("navigatesuccess",a),navigation.addEventListener("navigateerror",a),setTimeout(l,100),function(){c=!0,navigation.removeEventListener("navigate",e),navigation.removeEventListener("navigatesuccess",a),navigation.removeEventListener("navigateerror",a),v!==null&&(v(),v=null)}}}function Ad(e){this._internalRoot=e}mi.prototype.render=Ad.prototype.render=function(e){var a=this._internalRoot;if(a===null)throw Error(i(409));var l=a.current,c=Gn();Ph(l,c,e,a,null,null)},mi.prototype.unmount=Ad.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var a=e.containerInfo;Ph(e.current,2,null,e,null,null),Qs(),a[jn]=null}};function mi(e){this._internalRoot=e}mi.prototype.unstable_scheduleHydration=function(e){if(e){var a=Ra();e={blockedOn:null,target:e,priority:a};for(var l=0;l<qo.length&&a!==0&&a<qo[l].priority;l++);qo.splice(l,0,e),l===0&&zh(e)}};var Wh=n.version;if(Wh!=="19.2.3")throw Error(i(527,Wh,"19.2.3"));q.findDOMNode=function(e){var a=e._reactInternals;if(a===void 0)throw typeof e.render=="function"?Error(i(188)):(e=Object.keys(e).join(","),Error(i(268,e)));return e=h(a),e=e!==null?w(e):null,e=e===null?null:e.stateNode,e};var S0={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:T,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var yi=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!yi.isDisabled&&yi.supportsFiber)try{an=yi.inject(S0),Lt=yi}catch{}}return Xl.createRoot=function(e,a){if(!s(e))throw Error(i(299));var l=!1,c="",v=ef,C=tf,F=nf;return a!=null&&(a.unstable_strictMode===!0&&(l=!0),a.identifierPrefix!==void 0&&(c=a.identifierPrefix),a.onUncaughtError!==void 0&&(v=a.onUncaughtError),a.onCaughtError!==void 0&&(C=a.onCaughtError),a.onRecoverableError!==void 0&&(F=a.onRecoverableError)),a=Ih(e,1,!1,null,null,l,c,null,v,C,F,Yh),e[jn]=a.current,ud(e),new Ad(a)},Xl.hydrateRoot=function(e,a,l){if(!s(e))throw Error(i(299));var c=!1,v="",C=ef,F=tf,Y=nf,ae=null;return l!=null&&(l.unstable_strictMode===!0&&(c=!0),l.identifierPrefix!==void 0&&(v=l.identifierPrefix),l.onUncaughtError!==void 0&&(C=l.onUncaughtError),l.onCaughtError!==void 0&&(F=l.onCaughtError),l.onRecoverableError!==void 0&&(Y=l.onRecoverableError),l.formState!==void 0&&(ae=l.formState)),a=Ih(e,1,!0,a,l??null,c,v,ae,C,F,Y,Yh),a.context=Lh(null),l=a.current,c=Gn(),c=ya(c),v=wo(c),v.callback=null,xo(l,v,c),l=c,a.current.lanes=l,Un(a,l),La(a),e[jn]=a.current,ud(e),new mi(a)},Xl.version="19.2.3",Xl}var om;function D0(){if(om)return Fd.exports;om=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(n){console.error(n)}}return t(),Fd.exports=F0(),Fd.exports}var $0=D0(),se=tu();/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const xt=({card:t,onPointerDown:n,onPointerEnter:r,onPointerLeave:i,isFaceUp:s,faceDownValue:d=2,isSelected:u,isMultiSelected:p,isTargetable:f,isSourceOfEffect:h,style:w,additionalClassName:g,animationState:y})=>{const m=O=>O.replace(/<[^>]*>/g,"").length,x=({content:O,className:X})=>{const M=m(O),$=M>95,I=M>140?"very-long-text":$?"long-text":"";return o.jsx("div",{className:`card-rule-box ${X||""} ${I}`,dangerouslySetInnerHTML:{__html:O}})},E=(y==null?void 0:y.type)==="playCard"&&y.cardId===t.id?`is-entering-${y.owner}`:"",b=(y==null?void 0:y.type)==="deleteCard"&&y.cardId===t.id?`is-deleting-${y.owner}`:"",k=(y==null?void 0:y.type)==="drawCard"||(y==null?void 0:y.type)==="discardCard"?y.owner:void 0,N=k==="player"&&(y==null?void 0:y.type)==="drawCard"&&y.cardIds.includes(t.id),U=k==="player"&&(y==null?void 0:y.type)==="discardCard"&&y.cardIds.includes(t.id),V=["card-component"];t.protocol&&V.push(`card-protocol-${t.protocol.toLowerCase()}`),t.color&&V.push("has-custom-color"),t.pattern&&V.push(`card-pattern-${t.pattern}`),u&&V.push("selected"),p&&V.push("multi-selected"),U&&V.push("is-discarding"),f&&V.push("is-targetable"),h&&V.push("is-source-of-effect"),E&&V.push(E),b&&V.push(b),N&&V.push("is-drawing"),g&&V.push(g);const R={...w};return t.color&&(R["--card-custom-color"]=t.color),o.jsx("div",{className:V.join(" "),onPointerDown:n,onPointerEnter:r,onPointerLeave:i,role:"button",tabIndex:n?0:-1,style:R,children:o.jsxs("div",{className:`card-inner ${s?"":"is-flipped"}`,children:[o.jsxs("div",{className:"card-face card-front",children:[o.jsxs("div",{className:"card-header",children:[o.jsx("span",{className:`card-protocol ${t.protocol.length<=10?"short-protocol":""}`,children:t.protocol.slice(0,10)}),o.jsx("span",{className:"card-value",children:t.value})]}),o.jsxs("div",{className:"card-body",children:[o.jsx(x,{content:t.top,className:"card-rule-top"}),o.jsx(x,{content:t.middle,className:"card-rule-middle"}),o.jsx(x,{content:t.bottom,className:"card-rule-bottom"})]})]}),o.jsx("div",{className:"card-face card-back",children:o.jsx("div",{className:"card-back-value",children:d})})]})})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Wn=[{protocol:"Apathy",value:0,top:"Your total value in this line is increased by 1 for each face-down card in this line.",middle:"",bottom:"",keywords:{},category:"Aux 1"},{protocol:"Apathy",value:1,top:"",middle:"Flip all other face-up cards in this line.",bottom:"",keywords:{flip:!0},category:"Aux 1"},{protocol:"Apathy",value:2,top:"Ignore all middle commands of cards in this line.",middle:"",bottom:"<div><span class='emphasis'>When this card would be covered:</span> First, flip this card.</div>",keywords:{flip:!0},category:"Aux 1"},{protocol:"Apathy",value:3,top:"",middle:"Flip 1 of your opponent's face-up cards.",bottom:"",keywords:{flip:!0},category:"Aux 1"},{protocol:"Apathy",value:4,top:"",middle:"You may flip 1 of your face-up covered cards.",bottom:"",keywords:{flip:!0},category:"Aux 1"},{protocol:"Apathy",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Aux 1"},{protocol:"Chaos",value:0,top:"",middle:"In each line, flip 1 covered card.",bottom:"<div><span class='emphasis'>Start:</span> Draw the top card of your opponent's deck. Your opponent draws the top card of your deck.</div>",keywords:{flip:!0,draw:!0},category:"Main 2"},{protocol:"Chaos",value:1,top:"",middle:"Rearrange your protocols. Rearrange your opponent's protocols.",bottom:"",keywords:{},category:"Main 2"},{protocol:"Chaos",value:2,top:"",middle:"Shift 1 of your covered cards.",bottom:"",keywords:{shift:!0},category:"Main 2"},{protocol:"Chaos",value:3,top:"",middle:"",bottom:"You may play cards without matching protocols.",keywords:{play:!0},category:"Main 2"},{protocol:"Chaos",value:4,top:"",middle:"",bottom:"<div><span class='emphasis'>End:</span> Discard your hand. Draw the same amount of cards.</div>",keywords:{discard:!0,draw:!0},category:"Main 2"},{protocol:"Chaos",value:5,top:"",middle:"Discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 2"},{protocol:"Darkness",value:0,top:"",middle:"Draw 3 cards. Shift 1 of your opponent's covered cards.",bottom:"",keywords:{draw:!0,shift:!0},category:"Main 1"},{protocol:"Darkness",value:1,top:"",middle:"Flip 1 of your opponent's cards. You may shift that card.",bottom:"",keywords:{flip:!0,shift:!0},category:"Main 1"},{protocol:"Darkness",value:2,top:"All face-down cards in this stack have a value of 4.",middle:"You may flip 1 covered card in this line.",bottom:"",keywords:{flip:!0},category:"Main 1"},{protocol:"Darkness",value:3,top:"",middle:"Play 1 card face-down in another line.",bottom:"",keywords:{play:!0},category:"Main 1"},{protocol:"Darkness",value:4,top:"",middle:"Shift 1 face-down card.",bottom:"",keywords:{shift:!0},category:"Main 1"},{protocol:"Darkness",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Death",value:0,top:"",middle:"Delete 1 card from each other line.",bottom:"",keywords:{delete:!0},category:"Main 1"},{protocol:"Death",value:1,top:"<div><span class='emphasis'>Start:</span> You may draw 1 card. If you do, delete 1 other card, then delete this card.</div>",middle:"",bottom:"",keywords:{draw:!0,delete:!0},category:"Main 1"},{protocol:"Death",value:2,top:"",middle:"Delete all cards in 1 line with values of 1 or 2.",bottom:"",keywords:{delete:!0},category:"Main 1"},{protocol:"Death",value:3,top:"",middle:"Delete 1 face-down card.",bottom:"",keywords:{delete:!0},category:"Main 1"},{protocol:"Death",value:4,top:"",middle:"Delete a card with a value of 0 or 1.",bottom:"",keywords:{delete:!0},category:"Main 1"},{protocol:"Death",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Fire",value:0,top:"",middle:"Flip 1 other card. Draw 2 cards.",bottom:"<div><span class='emphasis'>When this card would be covered:</span> First, draw 1 card and flip 1 other card.</div>",keywords:{draw:!0,flip:!0},category:"Main 1"},{protocol:"Fire",value:1,top:"",middle:"Discard 1 card. If you do, delete 1 card.",bottom:"",keywords:{delete:!0,discard:!0},category:"Main 1"},{protocol:"Fire",value:2,top:"",middle:"Discard 1 card. If you do, return 1 card.",bottom:"",keywords:{discard:!0,return:!0},category:"Main 1"},{protocol:"Fire",value:3,top:"",middle:"",bottom:"<div><span class='emphasis'>End:</span> You may discard 1 card. If you do, flip 1 card.</div>",keywords:{discard:!0,flip:!0},category:"Main 1"},{protocol:"Fire",value:4,top:"",middle:"Discard 1 or more cards. Draw the amount discarded plus 1.",bottom:"",keywords:{discard:!0,draw:!0},category:"Main 1"},{protocol:"Fire",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Gravity",value:0,top:"",middle:"For every 2 cards in this line, play the top card of your deck face-down under this card.",bottom:"",keywords:{play:!0},category:"Main 1"},{protocol:"Gravity",value:1,top:"",middle:"Draw 2 cards. Shift 1 card either to or from this line.",bottom:"",keywords:{draw:!0,shift:!0},category:"Main 1"},{protocol:"Gravity",value:2,top:"",middle:"Flip 1 card. Shift that card to this line.",bottom:"",keywords:{flip:!0,shift:!0},category:"Main 1"},{protocol:"Gravity",value:4,top:"",middle:"Shift 1 face-down card to this line.",bottom:"",keywords:{shift:!0},category:"Main 1"},{protocol:"Gravity",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Gravity",value:6,top:"",middle:"Your opponent plays the top card of their deck face-down in this line.",bottom:"",keywords:{play:!0},category:"Main 1"},{protocol:"Hate",value:0,top:"",middle:"Delete 1 card.",bottom:"",keywords:{delete:!0},category:"Aux 1"},{protocol:"Hate",value:1,top:"",middle:"Discard 3 cards. Delete 1 card. Delete 1 card.",bottom:"",keywords:{delete:!0,discard:!0},category:"Aux 1"},{protocol:"Hate",value:2,top:"",middle:"Delete your highest value uncovered card. Delete your opponent's highest value uncovered card.",bottom:"",keywords:{delete:!0},category:"Aux 1"},{protocol:"Hate",value:3,top:"<div><span class='emphasis'>After you delete cards:</span> Draw 1 card.</div>",middle:"",bottom:"",keywords:{draw:!0},category:"Aux 1"},{protocol:"Hate",value:4,top:"",middle:"",bottom:"<div><span class='emphasis'>When this card would be covered:</span> First, delete the lowest value covered card in this line.</div>",keywords:{delete:!0},category:"Aux 1"},{protocol:"Hate",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Aux 1"},{protocol:"Life",value:0,top:"",middle:"Play the top card of your deck face-down in each line where you have a card.",bottom:"<div><span class='emphasis'>When this card would be covered:</span> First, delete this card.</div>",keywords:{delete:!0,play:!0},category:"Main 1"},{protocol:"Life",value:1,top:"",middle:"Flip 1 card. Flip 1 card.",bottom:"",keywords:{flip:!0},category:"Main 1"},{protocol:"Life",value:2,top:"",middle:"Draw 1 card. You may flip 1 face-down card.",bottom:"",keywords:{draw:!0,flip:!0},category:"Main 1"},{protocol:"Life",value:3,top:"",middle:"",bottom:"<div><span class='emphasis'>When this card would be covered:</span> First, play the top card of your deck face-down in another line.</div>",keywords:{play:!0},category:"Main 1"},{protocol:"Life",value:4,top:"",middle:"If this card is covering a card, draw 1 card.",bottom:"",keywords:{draw:!0},category:"Main 1"},{protocol:"Life",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Light",value:0,top:"",middle:"Flip 1 card. Draw cards equal to that card's value.",bottom:"",keywords:{draw:!0,flip:!0},category:"Main 1"},{protocol:"Light",value:1,top:"",middle:"",bottom:"<div><span class='emphasis'>End:</span> Draw 1 card.</div>",keywords:{draw:!0},category:"Main 1"},{protocol:"Light",value:2,top:"",middle:"Draw 2 cards. Reveal 1 face-down card. You may shift or flip that card.",bottom:"",keywords:{draw:!0,flip:!0,reveal:!0,shift:!0},category:"Main 1"},{protocol:"Light",value:3,top:"",middle:"Shift all face-down cards in this line to another line.",bottom:"",keywords:{shift:!0},category:"Main 1"},{protocol:"Light",value:4,top:"",middle:"Your opponent reveals their hand.",bottom:"",keywords:{reveal:!0},category:"Main 1"},{protocol:"Light",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Love",value:1,top:"",middle:"Draw the top card of your opponent's deck.",bottom:"<div><span class='emphasis'>End:</span> You may give 1 card from your hand to your opponent. If you do, draw 2 cards.</div>",keywords:{draw:!0,give:!0},category:"Aux 1"},{protocol:"Love",value:2,top:"",middle:"Your opponent draws 1 card. Refresh.",bottom:"",keywords:{draw:!0,refresh:!0},category:"Aux 1"},{protocol:"Love",value:3,top:"",middle:"Take 1 random card from your opponent's hand. Give 1 card from your hand to your opponent.",bottom:"",keywords:{give:!0,take:!0},category:"Aux 1"},{protocol:"Love",value:4,top:"",middle:"Reveal 1 card from your hand. Flip 1 card.",bottom:"",keywords:{flip:!0,reveal:!0},category:"Aux 1"},{protocol:"Love",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Aux 1"},{protocol:"Love",value:6,top:"",middle:"Your opponent draws 2 cards.",bottom:"",keywords:{draw:!0},category:"Aux 1"},{protocol:"Metal",value:0,top:"Your opponent's total value in this line is reduced by 2.",middle:"Flip 1 card.",bottom:"",keywords:{flip:!0},category:"Main 1"},{protocol:"Metal",value:1,top:"",middle:"Draw 2 cards. Your opponent cannot compile next turn.",bottom:"",keywords:{draw:!0},category:"Main 1"},{protocol:"Metal",value:2,top:"Your opponent cannot play cards face-down in this line.",middle:"",bottom:"",keywords:{},category:"Main 1"},{protocol:"Metal",value:3,top:"",middle:"Draw 1 card. Delete all cards in 1 other line with 8 or more cards.",bottom:"",keywords:{delete:!0,draw:!0},category:"Main 1"},{protocol:"Metal",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Metal",value:6,top:"<div><span class='emphasis'>When this card would be covered or flipped:</span> First, delete this card.</div>",middle:"",bottom:"",keywords:{delete:!0},category:"Main 1"},{protocol:"Plague",value:0,top:"",middle:"Your opponent discards 1 card.",bottom:"Your opponent cannot play cards in this line.",keywords:{discard:!0},category:"Main 1"},{protocol:"Plague",value:1,top:"<div><span class='emphasis'>After your opponent discards cards:</span> Draw 1 card.</div>",middle:"Your opponent discards 1 card.",bottom:"",keywords:{discard:!0,draw:!0},category:"Main 1"},{protocol:"Plague",value:2,top:"",middle:"Dicard 1 or more cards. Your opponent discards the amount of cards discarded plus 1.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Plague",value:3,top:"",middle:"Flip each other face-up card.",bottom:"",keywords:{flip:!0},category:"Main 1"},{protocol:"Plague",value:4,top:"",middle:"",bottom:"<div><span class='emphasis'>End:</span> Your opponent deletes 1 of their face-down cards. You may flip this card.</div>",keywords:{delete:!0,flip:!0},category:"Main 1"},{protocol:"Plague",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Psychic",value:0,top:"",middle:"Draw 2 cards. Your opponent discards 2 cards, then reveals their hand.",bottom:"",keywords:{discard:!0,draw:!0,reveal:!0},category:"Main 1"},{protocol:"Psychic",value:1,top:"Your opponent can only play cards face-down.",middle:"",bottom:"<div><span class='emphasis'>Start:</span> Flip this card.</div>",keywords:{flip:!0},category:"Main 1"},{protocol:"Psychic",value:2,top:"",middle:"Your opponent discards 2 cards. Rearrange their protocols.",bottom:"",keywords:{discard:!0,rearrange:!0},category:"Main 1"},{protocol:"Psychic",value:3,top:"",middle:"Your opponent discards 1 card. Shift 1 of their cards.",bottom:"",keywords:{discard:!0,shift:!0},category:"Main 1"},{protocol:"Psychic",value:4,top:"",middle:"",bottom:"<div><span class='emphasis'>End:</span> You may return 1 of your opponent's cards. If you do, flip this card.</div>",keywords:{flip:!0,return:!0},category:"Main 1"},{protocol:"Psychic",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Speed",value:0,top:"",middle:"Play 1 card.",bottom:"",keywords:{play:!0},category:"Main 1"},{protocol:"Speed",value:1,top:"<div><span class='emphasis'>After you clear cache:</span> Draw 1 card.</div>",middle:"Draw 2 cards.",bottom:"",keywords:{draw:!0},category:"Main 1"},{protocol:"Speed",value:2,top:"<div><span class='emphasis'>When this card would be deleted by compiling:</span> Shift this card, even if this card is covered.</div>",middle:"",bottom:"",keywords:{shift:!0},category:"Main 1"},{protocol:"Speed",value:3,top:"",middle:"Shift 1 of your other cards.",bottom:"<div><span class='emphasis'>End:</span> You may shift 1 of your cards. If you do, flip this card.</div>",keywords:{flip:!0,shift:!0},category:"Main 1"},{protocol:"Speed",value:4,top:"",middle:"Shift 1 of your opponent's face-down cards.",bottom:"",keywords:{shift:!0},category:"Main 1"},{protocol:"Speed",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Spirit",value:0,top:"",middle:"Refresh. Draw 1 card.",bottom:"Skip your check cache phase.",keywords:{draw:!0,refresh:!0},category:"Main 1"},{protocol:"Spirit",value:1,top:"You can play cards in any line.",middle:"Draw 2 cards.",bottom:"<div><span class='emphasis'>Start:</span> Either discard 1 card or flip this card.</div>",keywords:{discard:!0,draw:!0,flip:!0},category:"Main 1"},{protocol:"Spirit",value:2,top:"",middle:"You may flip 1 card.",bottom:"",keywords:{flip:!0},category:"Main 1"},{protocol:"Spirit",value:3,top:"<div><span class='emphasis'>After you draw cards:</span> You may shift this card, even if this card is covered.</div>",middle:"",bottom:"",keywords:{shift:!0},category:"Main 1"},{protocol:"Spirit",value:4,top:"",middle:"Swap the positions of 2 of your protocols",bottom:"",keywords:{swap:!0},category:"Main 1"},{protocol:"Spirit",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Water",value:0,top:"",middle:"Flip 1 other card. Flip this card.",bottom:"",keywords:{flip:!0},category:"Main 1"},{protocol:"Water",value:1,top:"",middle:"Play the top card of your deck face-down in each other line.",bottom:"",keywords:{play:!0},category:"Main 1"},{protocol:"Water",value:2,top:"",middle:"Draw 2 cards. Rearrange your protocols.",bottom:"",keywords:{draw:!0,rearrange:!0},category:"Main 1"},{protocol:"Water",value:3,top:"",middle:"Return all cards with a value of 2 in 1 line.",bottom:"",keywords:{return:!0},category:"Main 1"},{protocol:"Water",value:4,top:"",middle:"Return 1 of your cards.",bottom:"",keywords:{return:!0},category:"Main 1"},{protocol:"Water",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Main 1"},{protocol:"Frost",value:0,top:"",middle:"Draw 1 card for each face-down card.",bottom:"",keywords:{draw:!0},category:"Fan-Content"},{protocol:"Frost",value:1,top:"Cards cannot be flipped face-up.",middle:"",bottom:"Protocols cannot be rearranged.",keywords:{flip:!0,rearrange:!0},category:"Fan-Content"},{protocol:"Frost",value:2,top:"",middle:"Play a card face-down.",bottom:"",keywords:{play:!0},category:"Fan-Content"},{protocol:"Frost",value:3,top:"Cards cannot shift from or to this line.",middle:"",bottom:"",keywords:{shift:!0},category:"Fan-Content"},{protocol:"Frost",value:4,top:"",middle:"You may flip 1 card of your face-up covered cards.",bottom:"",keywords:{flip:!0},category:"Fan-Content"},{protocol:"Frost",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Fan-Content"},{protocol:"Anarchy",value:0,top:"",middle:"Shift 1 card. For each line that contains a face-up card without matching protocol, draw 1 card.",bottom:"",keywords:{shift:!0,draw:!0},category:"Fan-Content"},{protocol:"Anarchy",value:1,top:"Cards can only be played without matching protocols.",middle:"Shift 1 other card to a line without a matching protocol.",bottom:"",keywords:{shift:!0,play:!0},category:"Fan-Content"},{protocol:"Anarchy",value:2,top:"",middle:"Delete a covered or uncovered card in a line with a matching protocol.",bottom:"",keywords:{delete:!0},category:"Fan-Content"},{protocol:"Anarchy",value:3,top:"",middle:"Swap the positions of 2 of your opponent's protocols.",bottom:"<div><span class='emphasis'>End:</span> Rearrange your protocols. Anarchy cannot be on this line.</div>",keywords:{swap:!0,rearrange:!0},category:"Fan-Content"},{protocol:"Anarchy",value:5,top:"",middle:"You discard 1 card.",bottom:"",keywords:{discard:!0},category:"Fan-Content"},{protocol:"Anarchy",value:6,top:"<div><span class='emphasis'>Start:</span> Flip this card, if this card is in the line with the Anarchy protocol.</div>",middle:"",bottom:"",keywords:{flip:!0},category:"Fan-Content"}],q0=new Set(Wn.map(t=>t.protocol)),I0=Array.from(q0).sort();/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const tl=(t,n)=>{var d,u,p,f,h,w,g,y,m,x,S,E,j,b,k,N,U,V,R,O,X,M,$,B,I,D,L,T,q,P,Z,G,A,W,J,Q,ee,oe,me,ke,xe,ie,K,z,le,ne,ue,ce,Se,De,be,Ge,Be,Me,He,je,Re,Ie,Ve,it,nt,Rt,Zt,nn,an,Lt,hn,Pt,fa,ha,Ma,Ln,Zn,En,Ht,mn,Pn,Ha,ka,ma,Un,Ta,Kn,Na,Aa,ya,ga,Ra,va,yn,Dt,Ut,jn,_a,Va,Fa,wa,kn,Jn,_n,wn,Tn,xn,Nt,xa,Ca,gn,Cn;const r=t.params,i=(n==null?void 0:n.protocolName)||"[protocol]";let s="";switch(r.action){case"refresh":{r.target==="opponent"?s="Your opponent refreshes their hand.":s="Refresh.";break}case"mutual_draw":{const he=r.count||1;s=`Draw the top card${he!==1?"s":""} of your opponent's deck. Your opponent draws the top card${he!==1?"s":""} of your deck.`;break}case"draw":{if(t.useCardFromPreviousEffect){r.target==="opponent"?s="Opponent draws cards equal to that card's value.":s="Draw cards equal to that card's value.";break}if(r.revealFromDrawn){const Pe=r.count||3;let ve=`Draw ${Pe} ${Pe===1?"card":"cards"}.`;const Te=r.revealFromDrawn.count||1,Le=Te==="all"?"all cards":Te===1?"1 card":`${Te} cards`;(r.revealFromDrawn.valueSource||"stated_number")==="stated_number"?ve+=` Reveal ${Le} drawn with the face-up value of your stated number.`:ve+=` Reveal ${Le} drawn.`,r.revealFromDrawn.thenAction==="may_play"&&(ve+=" You may play it."),s=ve;break}if(r.countType==="count_face_down"){s="Draw 1 card for each face-down card.";break}if(r.conditional){switch(r.conditional.type){case"count_face_down":s="Draw 1 card for each face-down card.";break;case"is_covering":s=`Draw ${r.count} card${r.count!==1?"s":""} if this card is covering another.`;break;case"non_matching_protocols":s="Draw 1 card for each line with a non-matching protocol.";break}break}let he="";if(r.countType==="equal_to_discarded"){const Pe=r.countOffset||0;Pe===1?he+="Draw 1 more card than the amount discarded.":Pe===0?he+="Draw the same amount of cards.":he+=`Draw the amount discarded plus ${Pe}.`,s=he;break}else if(r.countType==="equal_to_card_value"){he+="Draw cards equal to that card's value.",s=he;break}else if(r.countType==="hand_size"){he+="Draw the same amount of cards.",s=he;break}else if(r.countType==="all_matching"&&((d=r.valueFilter)==null?void 0:d.equals)!==void 0){const Pe=r.valueFilter.equals;he+=`Draw all cards with a value of ${Pe}.`,s=he;break}else if(r.countType==="equal_to_unique_protocols_in_lane"){he+="Draw cards equal to the number of different protocols in this line.",s=he;break}else if(r.countType==="count_own_protocol_cards_on_field"){he+=`Draw cards equal to the number of face-up ${i} cards in the field.`,s=he;break}else if(((u=r.valueFilter)==null?void 0:u.equals)!==void 0&&r.count){const Pe=r.valueFilter.equals,ge=r.count===1?"card":"cards",ve=r.fromRevealed?" revealed this way":"";he+=`Draw ${r.count} ${ge} with a value of ${Pe}${ve}.`,s=he;break}if(((p=r.protocolFilter)==null?void 0:p.type)==="same_as_source"){((f=r.advancedConditional)==null?void 0:f.type)==="empty_hand"?s=`If your hand is empty, reveal your deck, draw all ${i} cards from it, and shuffle your deck.`:s=`Reveal your deck and draw all ${i} cards.`;break}if(((h=r.advancedConditional)==null?void 0:h.type)==="empty_hand"){const Pe=r.count||1;s=`If you have no cards in hand, draw ${Pe} card${Pe!==1?"s":""}.`;break}if(((w=r.advancedConditional)==null?void 0:w.type)==="opponent_higher_value_in_lane"){const Pe=r.count||1;s=`If your opponent has a higher total value than you do in this line, draw ${Pe} card${Pe!==1?"s":""}.`;break}if(((g=r.advancedConditional)==null?void 0:g.type)==="same_protocol_on_field"){const Pe=r.count||1;s=`If there is another face-up ${i} card in the field, draw ${Pe} card${Pe!==1?"s":""}.`;break}const Fe=r.optional?"You may ":"";if(r.source==="opponent_deck"){const Pe=r.count===1?"the top card":`the top ${r.count} cards`;he+=`${Fe}Draw ${Pe} of your opponent's deck.`}else if(r.target==="opponent")if(r.source==="own_deck"){const Pe=r.count===1?"the top card":`the top ${r.count} cards`;he+=`Your opponent draws ${Pe} of your deck.`}else he+=`Opponent draws ${r.count} card${r.count!==1?"s":""}.`;else{const Pe=r.optional?"draw":"Draw";he+=`${Fe}${Pe} ${r.count} card${r.count!==1?"s":""}.`}s=he;break}case"flip":{if(t.useCardFromPreviousEffect){const Qe=r.optional?"May flip":"Flip",Xe=r.skipMiddleCommand?", ignoring its middle commands":"";s=`${Qe} that card${Xe}.`;break}if(r.flipSelf){if(((y=r.advancedConditional)==null?void 0:y.type)==="opponent_higher_value_in_lane"){s="If your opponent has a higher value in this line than you do, flip this card.";break}if(((m=r.advancedConditional)==null?void 0:m.type)==="hand_size_greater_than"){const Xe=r.advancedConditional.threshold??0;s=`If you have more than ${Xe} ${Xe===1?"card":"cards"} in your hand, flip this card.`;break}if(((x=r.advancedConditional)==null?void 0:x.type)==="same_protocol_on_field"){s=`If there is another face-up ${i} card in the field, you may flip this card.`;break}if(((S=r.advancedConditional)==null?void 0:S.type)==="this_card_is_covered"){s=r.optional?"If this card is covered, you may flip this card.":"If this card is covered, flip this card.";break}let Qe=r.optional?"You may flip this card":"Flip this card";((E=r.advancedConditional)==null?void 0:E.type)==="protocol_match"&&(Qe+=`, if this card is in the line with the ${r.advancedConditional.protocol||"[Protocol]"} protocol`),s=Qe+".";break}if(((j=r.advancedConditional)==null?void 0:j.type)==="same_protocol_on_field"){const Qe=r.count||1,Xe=((b=r.targetFilter)==null?void 0:b.faceState)==="face_up"?"face-up ":"";s=`If there is another face-up ${i} card in the field, you may flip ${Qe} ${Xe}card${Qe!==1?"s":""}.`;break}const he=r.optional?"You may flip":"Flip",Fe=((k=r.targetFilter)==null?void 0:k.owner)==="own",Pe=((N=r.targetFilter)==null?void 0:N.owner)==="opponent",ge=(U=r.targetFilter)==null?void 0:U.excludeSelf;let ve="";Fe&&ge?ve+="of your other ":Fe?ve+="of your ":Pe?ve+="of your opponent's ":ge&&(ve+="other "),((V=r.targetFilter)==null?void 0:V.position)==="any"?ve+="covered or uncovered ":((R=r.targetFilter)==null?void 0:R.position)==="covered"&&(ve+="covered "),((O=r.targetFilter)==null?void 0:O.faceState)==="face_down"&&(ve+="face-down "),((X=r.targetFilter)==null?void 0:X.faceState)==="face_up"&&(ve+="face-up ");let Te="";r.count==="all"?Te="all":r.count==="each"?r.eachLineScope==="each_line"?(Te="1",ve=ve+"(in each line) "):Te="each":Te=r.count.toString();const Oe=Fe||Pe?"cards":r.count===1?"card":"cards";let Je="";if(Fe&&((M=r.targetFilter)==null?void 0:M.position)==="covered"&&(($=r.targetFilter)==null?void 0:$.faceState)==="face_up"&&r.optional?Je=`${he} ${Te} of your ${r.targetFilter.faceState.replace("_","-")} ${r.targetFilter.position} cards`:Je=`${he} ${Te} ${ve}${Oe}`,r.scope==="this_lane"){const Qe=((B=r.targetFilter)==null?void 0:B.owner)==="own";Je+=Qe?" in this stack":" in this line"}else r.scope==="each_lane"&&(Je=`In each line, ${Je.charAt(0).toLowerCase()+Je.slice(1)}`);r.sameLaneAsFirst&&(Je+=" in the same line"),(I=r.targetFilter)!=null&&I.valueMinGreaterThanHandSize&&(Je+=" that has a value greater than the number of cards in your hand"),(D=r.targetFilter)!=null&&D.valueLessThanUniqueProtocolsOnField&&(Je+=" with a value less than the number of different protocols on cards in the field"),Je+=".",r.selfFlipAfter&&(Je+=" Then flip this card."),s=Je;break}case"shift":{const he=r.optional?"You may shift":"Shift";if(((L=r.advancedConditional)==null?void 0:L.type)==="empty_hand"){s=`If you have no cards in hand, ${he.toLowerCase()} 1 card.`;break}if(((T=r.advancedConditional)==null?void 0:T.type)==="opponent_higher_value_in_lane"){s=`If your opponent has a higher total value than you do in this line, ${he.toLowerCase()} 1 card.`;break}if(((q=r.advancedConditional)==null?void 0:q.type)==="this_card_is_covered"){s=`If this card is covered, ${he.toLowerCase()} it.`;break}if(r.shiftSelf){if(((P=r.destinationRestriction)==null?void 0:P.type)==="opponent_highest_value_lane"){s=`${he} this card to the line where your opponent has their highest total value.`;break}let St=`${he} this card`;r.allowCoveredSelf&&(St+=", even if this card is covered"),s=St+".";break}if(t.useCardFromPreviousEffect){let St=`${he} that card`;((Z=r.destinationRestriction)==null?void 0:Z.type)==="to_this_lane"?St+=" to this line":((G=r.destinationRestriction)==null?void 0:G.type)==="to_another_line"?St+=" to another line":((A=r.destinationRestriction)==null?void 0:A.type)==="non_matching_protocol"?St+=" to a line without a matching protocol":((W=r.destinationRestriction)==null?void 0:W.type)==="specific_lane"&&(St+=" within this line"),s=St+".";break}const Fe=r.count||1,Pe=((J=r.targetFilter)==null?void 0:J.owner)==="own",ge=((Q=r.targetFilter)==null?void 0:Q.position)==="covered";if(Pe&&ge&&Fe===1){let St=`${he} 1 of your covered cards`;((ee=r.destinationRestriction)==null?void 0:ee.type)==="non_matching_protocol"?St+=" to a line without a matching protocol":((oe=r.destinationRestriction)==null?void 0:oe.type)==="specific_lane"?St+=" within this line":((me=r.destinationRestriction)==null?void 0:me.type)==="to_another_line"&&(St+=" to another line"),s=St+".";break}if(((ke=r.targetFilter)==null?void 0:ke.owner)==="own"&&((xe=r.targetFilter)==null?void 0:xe.position)==="any"&&!((ie=r.targetFilter)!=null&&ie.excludeSelf)&&Fe===1){s=`${he} this card, even if this card is covered`+".";break}if(Pe&&!ge&&!((K=r.targetFilter)!=null&&K.excludeSelf)&&Fe===1){s=`${he} 1 of your cards`+".";break}let Te="";const Le=((z=r.targetFilter)==null?void 0:z.owner)==="opponent",Oe=(le=r.targetFilter)==null?void 0:le.excludeSelf,Je=((ne=r.targetFilter)==null?void 0:ne.position)==="any";Pe&&Oe?Te+="of your other ":Le?Te+="of your opponent's ":Oe&&(Te+="other "),Je?Te+="covered or uncovered ":((ue=r.targetFilter)==null?void 0:ue.position)==="covered"&&(Te+="covered "),((ce=r.targetFilter)==null?void 0:ce.faceState)==="face_down"&&(Te+="face-down "),((Se=r.targetFilter)==null?void 0:Se.faceState)==="face_up"&&(Te+="face-up ");const Qe=r.count==="all"?"all":"1";let Ct=`${he} ${Qe} ${Te}${Pe&&Oe||Le?"cards":Qe==="1"?"card":"cards"}`;r.scope==="this_lane"&&(Ct+=" in this line"),((De=r.destinationRestriction)==null?void 0:De.type)==="non_matching_protocol"?Ct+=" to a line without a matching protocol":((be=r.destinationRestriction)==null?void 0:be.type)==="specific_lane"?Ct+=" within this line":((Ge=r.destinationRestriction)==null?void 0:Ge.type)==="to_another_line"?Ct+=" to another line":((Be=r.destinationRestriction)==null?void 0:Be.type)==="to_this_lane"?Ct+=" to this line":((Me=r.destinationRestriction)==null?void 0:Me.type)==="to_or_from_this_lane"&&(Ct+=" either to or from this line"),s=Ct+".";break}case"delete":{if(((He=r.advancedConditional)==null?void 0:He.type)==="empty_hand"){const Oe=r.count||1;s=`If you have no cards in hand, delete ${Oe} card${Oe!==1?"s":""}.`;break}if(((je=r.advancedConditional)==null?void 0:je.type)==="opponent_higher_value_in_lane"){const Oe=r.count||1;s=`If your opponent has a higher total value than you do in this line, delete ${Oe} card${Oe!==1?"s":""}.`;break}if(t.useCardFromPreviousEffect){s="Delete that card.";break}if(r.deleteSelf){((Re=r.protocolCountConditional)==null?void 0:Re.type)==="unique_protocols_on_field_below"?s=`If there are not at least ${r.protocolCountConditional.threshold} different protocols on cards in the field, delete this card.`:((Ie=r.advancedConditional)==null?void 0:Ie.type)==="this_card_is_covered"?s="If this card is covered, delete this card.":s="Delete this card.";break}if(((Ve=r.laneCondition)==null?void 0:Ve.type)==="opponent_higher_value"){const Oe=r.count||1,Je=((it=r.targetFilter)==null?void 0:it.owner)==="opponent"?"of your opponent's ":"";s=`Delete ${Oe} ${Je}${Oe===1?"card":"cards"} in a line where they have a higher total value than you do.`;break}let he=r.optional?"You may delete ":"Delete ";const Fe=((nt=r.targetFilter)==null?void 0:nt.position)==="any",Pe=((Rt=r.targetFilter)==null?void 0:Rt.calculation)==="highest_value"||((Zt=r.targetFilter)==null?void 0:Zt.calculation)==="lowest_value",ge=((nn=r.targetFilter)==null?void 0:nn.owner)==="own"||((an=r.targetFilter)==null?void 0:an.owner)==="opponent",ve=r.count===1&&Pe&&ge,Te=r.count===1&&Pe&&!ge;if(r.count==="all_in_lane"?he+="all ":ve||(Te?he+="the ":he+=Fe?"a ":`${r.count} `),ve&&(((Lt=r.targetFilter)==null?void 0:Lt.owner)==="own"?he+="your ":((hn=r.targetFilter)==null?void 0:hn.owner)==="opponent"&&(he+="opponent's ")),((Pt=r.targetFilter)==null?void 0:Pt.calculation)==="highest_value"?he+="highest value ":((fa=r.targetFilter)==null?void 0:fa.calculation)==="lowest_value"&&(he+="lowest value "),(ha=r.targetFilter)!=null&&ha.valueRange){const{min:Oe,max:Je}=r.targetFilter.valueRange,Qe=[];for(let gt=Oe;gt<=Je;gt++)Qe.push(gt);const Xe=Qe.join(" or ");he+=`value ${Xe} `}ve||(((Ma=r.targetFilter)==null?void 0:Ma.owner)==="own"?he+="your ":((Ln=r.targetFilter)==null?void 0:Ln.owner)==="opponent"&&(he+="opponent's ")),r.excludeSelf&&(he+="other "),Fe?he+="covered or uncovered ":(((Zn=r.targetFilter)==null?void 0:Zn.position)==="covered"||((En=r.targetFilter)==null?void 0:En.position)==="covered_by_context")&&(he+="covered "),((Ht=r.targetFilter)==null?void 0:Ht.faceState)==="face_down"?he+="face-down ":((mn=r.targetFilter)==null?void 0:mn.faceState)==="face_up"&&(he+="face-up ");const Le=r.count===1?"card":"cards";he+=Le,r.selectLane&&(he+=" in 1 line"),r.protocolMatching==="must_match"?he+=" in a line with a matching protocol":r.protocolMatching==="must_not_match"&&(he+=" in a line without a matching protocol"),((Pn=r.scope)==null?void 0:Pn.type)==="this_line"?he+=" in this line":((Ha=r.scope)==null?void 0:Ha.type)==="other_lanes"?he+=" in other lanes":((ka=r.scope)==null?void 0:ka.type)==="each_other_line"&&(he+=" from each other line"),((ma=r.targetFilter)==null?void 0:ma.valueSource)==="previous_effect_card"&&(he+=" that shares a value with the discarded card"),s=he+".";break}case"discard":{if(r.source==="top_deck_own"){s="Discard the top card of your deck.";break}if(r.source==="top_deck_opponent"){s="Discard the top card of your opponent's deck.";break}if(r.source==="entire_deck"){s="Discard your entire deck.";break}if(r.useCardFromPreviousEffect){r.actor==="opponent"?s="Opponent discards that card.":s="discard that card.";break}if(r.countType==="equal_to_discarded"){const Te=r.countOffset||0;r.actor==="opponent"?Te===1?s="Your opponent discards the amount of cards discarded plus 1.":Te===0?s="Your opponent discards the same amount of cards.":s=`Your opponent discards the amount discarded plus ${Te}.`:Te===1?s="Discard 1 more card than the amount discarded.":Te===0?s="Discard the same amount of cards.":s=`Discard the amount discarded plus ${Te}.`;break}const he=r.variableCount;let Fe="";if(he)Fe="1 or more cards";else if(r.count==="all")Fe="your hand";else{const Te=r.count===1?"card":"cards";Fe=`${r.count} ${Te}`}const Pe=r.optional?"You may discard":r.count==="all"||he?"Discard":"You discard";if(r.actor==="both"){if(r.count==="all")s="Both players discard their hand.";else{const Te=r.count===1?"card":"cards";s=`Both players discard ${r.count} ${Te}.`}break}const ve=(r.discardTo||"own_trash")==="opponent_trash"?" into their trash":"";if(r.actor==="opponent")if(r.count==="all")s=`Opponent discards their hand${ve}.`;else if(r.random){const Te=r.count===1?"card":"cards";s=`Your opponent discards ${r.count} random ${Te}${ve}.`}else s=`Your opponent discards ${Fe}${ve}.`;else s=`${Pe} ${Fe}${ve}.`;break}case"return":{if(((Un=r.advancedConditional)==null?void 0:Un.type)==="empty_hand"){const Ct=r.count||1;s=`If you have no cards in hand, return ${Ct} card${Ct!==1?"s":""}.`;break}if(((Ta=r.advancedConditional)==null?void 0:Ta.type)==="opponent_higher_value_in_lane"){const Ct=r.count||1;s=`If your opponent has a higher total value than you do in this line, return ${Ct} card${Ct!==1?"s":""}.`;break}if(r.returnSelf){((Kn=r.advancedConditional)==null?void 0:Kn.type)==="this_card_is_covered"?s=r.optional?"If this card is covered, you may return this card to hand.":"If this card is covered, return this card to hand.":s=r.optional?"You may return this card to hand.":"Return this card to hand.";break}if(t.useCardFromPreviousEffect){s="Return that card to hand.";break}const Fe=r.selectLane||!1?" in 1 line":"";if(((Na=r.targetFilter)==null?void 0:Na.valueEquals)!==void 0){s=`Return all cards with a value of ${r.targetFilter.valueEquals}${Fe}.`;break}const Pe=((Aa=r.targetFilter)==null?void 0:Aa.owner)||"any",ge=((ya=r.targetFilter)==null?void 0:ya.position)||"uncovered",ve=(ga=r.targetFilter)==null?void 0:ga.faceState,Te=r.destination||"owner_hand";let Le="";ge==="any"?Le="covered or uncovered ":ge==="covered"&&(Le="covered ");let Oe="";ve==="face_down"?Oe="face-down ":ve==="face_up"&&(Oe="face-up ");const Je=r.count,Qe=Je===1?"card":"cards";let Xe="";if(Pe==="own"?Xe=`${Je==="all"?"all":Je} of your ${Le}${Oe}${Qe}`:Pe==="opponent"?Xe=`${Je==="all"?"all":Je} of your opponent's ${Le}${Oe}${Qe}`:Xe=Je==="all"?`all ${Le}${Oe}cards`:`${Je} ${Le}${Oe}${Qe}`,Te==="actor_hand"&&Pe==="opponent"){s=`${r.optional?"You may p":"P"}ut ${Xe}${Fe} into your hand.`;break}s=`${r.optional?"You may r":"R"}eturn ${Xe}${Fe}.`;break}case"play":{if(((Ra=r.advancedConditional)==null?void 0:Ra.type)==="empty_hand"){const Xe=r.count||1;s=`If you have no cards in hand, play ${Xe} card${Xe!==1?"s":""}.`;break}if(((va=r.advancedConditional)==null?void 0:va.type)==="opponent_higher_value_in_lane"){const Xe=r.count||1;s=`If your opponent has a higher total value than you do in this line, play ${Xe} card${Xe!==1?"s":""}.`;break}if(t.useCardFromPreviousEffect){const Xe=r.faceDown===!0?"face-down":r.faceDown===!1?"face-up":"";let gt="";((yn=r.destinationRule)==null?void 0:yn.type)==="other_lines"&&(gt=" in another line"),s=Xe?`Play that card ${Xe}${gt}.`:`Play that card${gt}.`;break}if(r.source==="trash"){const Xe=r.count||1,gt=Xe===1?"card":"cards",St=(r.sourceOwner||"own")==="opponent"?"your opponent's trash":"your trash";s=`Play ${Xe} ${gt} from ${St}.`;break}const he=r.actor,Fe=r.count||1,Pe=r.faceDown===!0?" face-down":r.faceDown===!1?" face-up":"",ge=r.sourceOwner||"own",ve=r.targetBoard||"own";let Te="",Le="";const Oe=((Dt=r.valueFilter)==null?void 0:Dt.equals)!==void 0?` with a value of ${r.valueFilter.equals}`:"";he==="opponent"?(Te="Your opponent plays",r.source==="deck"?ge==="opponent"?Le=Fe===1?"the top card of your deck":`${Fe} cards from your deck`:Le=Fe===1?"the top card of their deck":`${Fe} cards from their deck`:Le=Fe===1?`a card${Oe} from their hand`:`${Fe} cards${Oe} from their hand`):(Te=r.optional?"You may play":"Play",r.source==="deck"?ge==="opponent"?Le=Fe===1?"the top card of your opponent's deck":`${Fe} cards from your opponent's deck`:Le=Fe===1?"the top card of your deck":`${Fe} cards from your deck`:Le=Fe===1?`1 card${Oe}`:`${Fe} cards${Oe}`);let Je="";((Ut=r.condition)==null?void 0:Ut.type)==="per_x_cards_in_line"&&(Je=`For every ${r.condition.cardCount||2} cards in this line, `,Te=Te.toLowerCase());let Qe=`${Je}${Te} ${Le}${Pe}`;if(((jn=r.destinationRule)==null?void 0:jn.type)==="other_lines")Qe+=" to other lines";else if(((_a=r.destinationRule)==null?void 0:_a.type)==="another_line")Qe+=" in another line";else if(((Va=r.destinationRule)==null?void 0:Va.type)==="each_other_line")Qe+=" in each other line";else if(((Fa=r.destinationRule)==null?void 0:Fa.type)==="under_this_card")Qe+=" under this card";else if(((wa=r.destinationRule)==null?void 0:wa.type)==="each_line_with_card"){const Xe=r.destinationRule.ownerFilter,gt=r.destinationRule.cardFilter;(gt==null?void 0:gt.faceState)==="face_down"?Qe+=" in each line with a face-down card":(gt==null?void 0:gt.faceState)==="face_up"?Qe+=" in each line with a face-up card":Xe==="own"?Qe+=" in each line where you have a card":Xe==="opponent"?Qe+=" in each line where opponent has a card":Qe+=" to each line with a card"}else if(((kn=r.destinationRule)==null?void 0:kn.type)==="line_with_matching_cards"){const Xe=r.destinationRule.cardFilter;(Xe==null?void 0:Xe.faceState)==="face_down"?Qe+=" in a line with a face-down card":(Xe==null?void 0:Xe.faceState)==="face_up"?Qe+=" in a line with a face-up card":Qe+=" in a line with a card"}else((Jn=r.destinationRule)==null?void 0:Jn.type)==="specific_lane"&&(Qe+=" in this line");ve==="opponent"&&(Qe+=" on your opponent's side"),r.excludeSourceProtocol&&(Qe=Qe.replace(/(\d+) card/,`$1 non-${i} card`)),s=Qe+".";break}case"rearrange_protocols":case"swap_protocols":{const he=r.target==="opponent"?"your opponent's":r.target==="both_sequential"?"both players'":"your";let Fe="";r.action==="rearrange_protocols"?Fe=`Rearrange ${he} protocols`:Fe=`Swap the positions of 2 of ${he} protocols`,r.restriction&&r.restriction.disallowedProtocol&&(Fe+=`. ${r.restriction.disallowedProtocol} cannot be on this line`),s=Fe+".";break}case"reveal":case"give":{if(t.useCardFromPreviousEffect){s=`${r.action==="give"?"Give":"Reveal"} that card.`;break}if(r.action,r.source==="board"){const Le=((_n=r.targetFilter)==null?void 0:_n.faceState)==="face_down"?"face-down ":"",Oe=r.count||1;let Qe=`Reveal ${Oe} ${Le}${Oe===1?"card":"cards"}`;r.optional?Qe+=". You may shift or flip that card":r.followUpAction==="flip"?Qe+=". Then flip it":r.followUpAction==="shift"&&(Qe+=". Then shift it"),s=Qe+".";break}if(r.source==="own_deck_top"){let Le="Reveal the top card of your deck";r.followUpAction==="may_discard"&&(Le+=". You may discard it"),s=Le+".";break}if(r.source==="own_deck"){s="Reveal your deck.";break}if(r.source==="own_trash"){const Le=r.count||1;s=`Reveal ${Le} ${Le===1?"card":"cards"} from your trash.`;break}if(((wn=r.protocolFilter)==null?void 0:wn.type)==="same_as_source"){s=`Reveal all ${i} cards in your hand.`;break}if(r.count===-1){r.source==="opponent_hand"?s=r.action==="reveal"?"Your opponent reveals their hand.":"Give your entire hand to your opponent.":s=r.action==="reveal"?"Reveal your hand.":"Give your entire hand.";break}const he=r.count===1?"card":"cards",Fe=r.source==="opponent_hand"?"opponent's hand":"your hand",Pe=r.optional?"You may ":"",ge=r.action==="give"?"give":"reveal",ve=r.action==="give"?"Give":"Reveal";let Te;r.optional?Te=`${Pe}${ge} ${r.count} ${he} from ${Fe}`:Te=`${ve} ${r.count} ${he} from ${Fe}`,r.action==="give"&&r.source!=="opponent_hand"&&(Te+=" to your opponent"),r.followUpAction==="flip"?Te+=". Then flip it.":r.followUpAction==="shift"?Te+=". Then shift it.":Te+=".",s=Te;break}case"take":{const he=r.count===1?"card":"cards",Fe=r.random!==!1?"random ":"";s=`Take ${r.count} ${Fe}${he} from your opponent's hand.`;break}case"choice":{const he=r.options||[];if(he.length===0){s="Effect";break}if(he.length===2){const Fe=he.map(Pe=>{const ge={params:Pe.params};let ve=tl(ge);return ve.endsWith(".")&&(ve=ve.slice(0,-1)),ve=ve.charAt(0).toLowerCase()+ve.slice(1),ve});((Tn=r.advancedConditional)==null?void 0:Tn.type)==="same_protocol_on_field"?s=`If there is another ${i} card in the field, either ${Fe[0]} or ${Fe[1]}.`:s=`Either ${Fe[0]} or ${Fe[1]}.`}else s="Effect";break}case"passive_rule":{const he=r.rule;switch(he==null?void 0:he.type){case"require_non_matching_protocol":s="Cards can only be played without matching protocols.";break;case"block_all_play":he.target==="opponent"?s="Your opponent cannot play cards in this line.":he.target==="self"?s="You cannot play cards in this line.":s="Cards cannot be played in this line.";break;case"ignore_middle_commands":if(he.onlyDuringYourTurn&&he.target==="opponent"&&he.scope==="global")s="During your turn, your opponent's cards do not have middle commands.";else if(he.onlyDuringYourTurn){const Fe=he.target==="opponent"?"your opponent's ":he.target==="self"?"your ":"",Pe=he.scope==="global"?"":" in this line";s=`During your turn, ignore all middle commands of ${Fe}cards${Pe}.`}else s="Ignore all middle commands of cards in this line.";break;case"block_face_down_play":s="Opponent can't play cards face-down in this line.";break;case"require_face_down_play":s=he.scope==="global"?"Your opponent can only play cards face-down.":"Opponent can only play cards face-down in this line.";break;case"allow_any_protocol_play":s="You may play cards without matching protocols.";break;case"allow_play_on_opponent_side":s="You may play this card in any line on either player's side.";break;case"block_flips":s=he.scope==="global"?"Cards cannot be flipped face-up.":"Cards can't be flipped face-up in this line.";break;case"block_protocol_rearrange":s="Protocols can't be rearranged.";break;case"block_shifts_from_lane":s="Cards can't shift from this line.";break;case"block_shifts_to_lane":s="Cards can't shift to this line.";break;case"block_shifts_from_and_to_lane":s="Cards cannot shift from or to this line.";break;case"skip_check_cache_phase":s="Skip check cache phase.";break;case"block_flip_this_card":s="This card cannot be flipped.";break;case"allow_same_protocol_face_up_play":s=`${i} cards may be played face-up in this line.`;break;case"block_draw_conditional":{const Fe=he.conditionTarget||"self",Pe=he.blockTarget||"self",ge=Fe==="self"?"you have":"your opponent has";let ve;Pe==="self"?ve="you cannot draw":Pe==="opponent"?ve="your opponent cannot draw":ve="neither player can draw",s=`If ${ge} any cards in hand, ${ve} cards.`;break}default:s="Passive rule effect."}break}case"value_modifier":{const he=r.modifier;switch(he==null?void 0:he.type){case"add_per_condition":{const Fe=he.scope==="this_lane"?"in this line":"",Pe=he.target==="own_total"?"Your total value":he.target==="opponent_total"?"Your opponent's total value":"Total value";let ge="",ve="";he.condition==="per_face_down_card"?(ge="for each face-down card",ve=Fe):he.condition==="per_face_up_card"?(ge="for each face-up card",ve=Fe):he.condition==="per_card"?(ge="for each card",ve=Fe):he.condition==="per_card_in_hand"?ge="for each card in your hand":he.condition==="per_opponent_card_in_lane"&&(ge="for each of your opponent's cards",ve=Fe);const Te=Math.abs(he.value),Le=he.value>=0?"increased":"reduced";s=`${Pe} ${Fe} is ${Le} by ${Te} ${ge} ${ve}.`.replace(/\s+/g," ").trim();break}case"set_to_fixed":{let Fe="";he.target==="own_cards"?Fe="your":he.target==="opponent_cards"?Fe="opponent's":Fe="all";let Pe="";((xn=he.filter)==null?void 0:xn.faceState)==="face_down"?Pe=" face-down":((Nt=he.filter)==null?void 0:Nt.faceState)==="face_up"&&(Pe=" face-up");let ge="";he.scope==="this_lane"&&(ge=" in this stack"),s=`All ${Fe}${Pe} cards${ge} have a value of ${he.value}.`;break}case"add_to_total":{const Fe=he.scope==="this_lane"?" in this line":"",Pe=he.condition==="has_non_own_protocol_face_up"?` if there are any non-${i} face-up cards in this stack`:"";he.target==="opponent_total"?he.value<0?s=`Your opponent's total value${Fe} is reduced by ${Math.abs(he.value)}${Pe}.`:s=`Your opponent's total value${Fe} is increased by ${he.value}${Pe}.`:he.value<0?s=`Your total value${Fe} is reduced by ${Math.abs(he.value)}${Pe}.`:s=`Your total value${Fe} is increased by ${he.value}${Pe}.`;break}default:s="Value modifier effect."}break}case"block_compile":{s=`${r.target==="opponent"?"Your opponent":"You"} cannot compile next turn.`;break}case"delete_all_in_lane":{const he=((xa=r.laneCondition)==null?void 0:xa.count)||8;s=`Delete all cards in ${r.excludeCurrentLane?"1 other line":"1 line"} with ${he} or more cards.`;break}case"modify_value":{const he=r.modifier||0,Fe=r.target==="opponent"?"Your opponent's":"Your",Pe=he<0?`reduced by ${Math.abs(he)}`:`increased by ${he}`;s=`${Fe} total value in this line is ${Pe}.`;break}case"block_play_face_down":{s="Your opponent cannot play cards face-down in this line.";break}case"shuffle_trash":{let Fe=`${r.optional!==!1?"You may shuffle":"Shuffle"} your trash into your deck.`;((Ca=r.advancedConditional)==null?void 0:Ca.type)==="trash_not_empty"&&(Fe=`If there are any cards in your trash, ${Fe.charAt(0).toLowerCase()+Fe.slice(1)}`),s=Fe;break}case"shuffle_deck":{s="Shuffle your deck.";break}case"redirect_return_to_deck":{s=`Put that card on top of their deck ${r.faceDown!==!1?"face-down ":""}instead.`;break}case"state_number":{s="State a number.";break}case"state_protocol":{s="State a protocol.";break}case"swap_stacks":{s="Swap all of your cards in one of your stacks with another one of your stacks.";break}case"copy_opponent_middle":{s=`${r.optional?"You may resolve":"Resolve"} the middle command of 1 of your opponent's cards as if it were on this card.`;break}case"auto_compile":{if(((gn=r.protocolCountConditional)==null?void 0:gn.type)==="unique_protocols_on_field")s=`If there are ${r.protocolCountConditional.threshold} different protocols on cards in the field, compile this protocol.`;else if(((Cn=r.protocolCountConditional)==null?void 0:Cn.type)==="same_protocol_count_on_field"){const he=r.protocolCountConditional.threshold,Fe=r.protocolCountConditional.faceState==="face_up"?"face-up ":"",Pe=r.deleteAllInLane?" and delete all cards in this line":"";s=`If there are ${he} or more ${Fe}${i} cards in the field, compile this protocol${Pe}.`}else s="Compile this protocol.";break}case"card_property":{r.property==="ignore_protocol_matching"?s="This card may be played without matching protocols.":s="Card property.";break}default:s="Effect";break}if(t.conditional&&t.conditional.thenEffect){let he=tl(t.conditional.thenEffect);const Fe=t.conditional.thenEffect.params;Fe!=null&&Fe.useCardFromPreviousEffect&&(he=he.replace(/\d+ cards?/i,"that card")),t.conditional.type==="then"?s=`${s.endsWith(".")?s.slice(0,-1):s}, then ${he.toLowerCase()}`:t.conditional.type==="optional"?s=`${s.endsWith(".")?s.slice(0,-1):s}. You may ${he.toLowerCase()}`:t.conditional.type==="if_protocol_matches_stated"?s=`${s} If the discarded card matches the stated protocol, ${he.toLowerCase()}`:s=`${s} If you do, ${he.toLowerCase()}`}return s},L0=t=>{const n={};for(const r of t){const s=r.params.action;s==="draw"&&(n.draw=!0),s==="flip"&&(n.flip=!0),s==="shift"&&(n.shift=!0),s==="delete"&&(n.delete=!0),s==="discard"&&(n.discard=!0),s==="return"&&(n.return=!0),s==="play"&&(n.play=!0),s==="reveal"&&(n.reveal=!0),s==="give"&&(n.give=!0),s==="take"&&(n.take=!0)}return n},pr=(t,n)=>t.length===0?"":t.map(r=>{var d;const i=tl(r,n),s=r.trigger;if(s==="start")return`<div><span class='emphasis'>Start:</span> ${i}</div>`;if(s==="end")return`<div><span class='emphasis'>End:</span> ${i}</div>`;if(s==="on_cover")return r.onCoverProtocolRestriction==="same_protocol"?`<div><span class='emphasis'>When this card would be covered by another ${(n==null?void 0:n.protocolName)||"[protocol]"} card:</span> First, ${i.toLowerCase()}</div>`:`<div><span class='emphasis'>When this card would be covered:</span> First, ${i.toLowerCase()}</div>`;if(s==="on_flip")return`<div><span class='emphasis'>When this card would be flipped:</span> First, ${i.toLowerCase()}</div>`;if(s==="on_cover_or_flip")return`<div><span class='emphasis'>When this card would be covered or flipped:</span> First, ${i.toLowerCase()}</div>`;if(s==="after_draw"||s==="after_delete"||s==="after_discard"||s==="after_shift"||s==="after_flip"||s==="after_clear_cache"){const u=r.reactiveTriggerActor||"self",p=u==="self"?"you":u==="opponent"?"opponent":"a card is";let f="";s==="after_draw"?f=u==="any"?"drawn":"draw cards":s==="after_delete"?f=u==="any"?"deleted":"delete cards":s==="after_discard"?f=u==="any"?"discarded":"discard cards":s==="after_shift"?f=u==="any"?"shifted":"shift cards":s==="after_flip"?f=u==="any"?"flipped":"flip cards":s==="after_clear_cache"&&(f="clear cache");const h=r.onlyDuringOpponentTurn?" during your opponent's turn":"";return`<div><span class='emphasis'>${`After ${p} ${f}${h}`}:</span> ${i}</div>`}if(s==="after_opponent_discard")return`<div><span class='emphasis'>After your opponent discards cards:</span> ${i}</div>`;if(s==="after_opponent_draw")return`<div><span class='emphasis'>After your opponent draws cards:</span> ${i}</div>`;if(s==="after_refresh"){const u=r.reactiveTriggerActor||"self";let p="After you refresh:";return u==="opponent"?p="After your opponent refreshes:":u==="any"&&(p="After a player refreshes:"),`<div><span class='emphasis'>${p}</span> ${i}</div>`}if(s==="after_opponent_refresh")return`<div><span class='emphasis'>After your opponent refreshes:</span> ${i}</div>`;if(s==="after_compile")return`<div><span class='emphasis'>After you compile:</span> ${i}</div>`;if(s==="after_opponent_compile")return`<div><span class='emphasis'>After your opponent compiles:</span> ${i}</div>`;if(s==="after_shuffle"){const u=r.reactiveTriggerActor||"self";let p="After you shuffle your deck:";return u==="opponent"?p="After your opponent shuffles their deck:":u==="any"&&(p="After any player shuffles their deck:"),`<div><span class='emphasis'>${p}</span> ${i}</div>`}if(s==="after_play"){const u=r.reactiveTriggerActor||"self",p=r.reactiveScope||"global";return u==="opponent"&&p==="this_lane"?`<div><span class='emphasis'>After your opponent plays a card in this line:</span> ${i}</div>`:u==="opponent"?`<div><span class='emphasis'>After your opponent plays a card:</span> ${i}</div>`:p==="this_lane"?`<div><span class='emphasis'>After you play a card in this line:</span> ${i}</div>`:`<div><span class='emphasis'>After you play a card:</span> ${i}</div>`}return s==="before_compile_delete"?`<div><span class='emphasis'>When this card would be deleted by compiling:</span> ${i}</div>`:s==="when_card_returned"?`<div><span class='emphasis'>When a card would be returned to ${(((d=r.params)==null?void 0:d.targetOwner)||"opponent")==="opponent"?"your opponent's":"your"} hand:</span> ${i}</div>`:i}).join(" "),P0=(t,n)=>{var h,w,g;const r={protocolName:n.name},i=((h=t.text)==null?void 0:h.top)!==void 0?t.text.top:pr(t.topEffects,r),s=((w=t.text)==null?void 0:w.middle)!==void 0?t.text.middle:pr(t.middleEffects,r),d=((g=t.text)==null?void 0:g.bottom)!==void 0?t.text.bottom:pr(t.bottomEffects,r),u=[...t.topEffects,...t.middleEffects,...t.bottomEffects],p=L0(u);return{protocol:n.name,value:t.value,top:i,middle:s,bottom:d,keywords:p,category:n.category||"Custom",color:n.color,pattern:n.pattern,customEffects:{topEffects:t.topEffects,middleEffects:t.middleEffects,bottomEffects:t.bottomEffects}}},U0=t=>t.cards.map(n=>P0(n,t)),zo=()=>{try{const t=localStorage.getItem("custom_protocols_v1");if(!t)return[];const r=JSON.parse(t).protocols||[],i=[];for(const s of r){const d=U0(s);i.push(...d)}return i}catch(t){return console.error("Failed to load custom protocol cards:",t),[]}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Rm="custom_protocols_v1",zd=1,yr=()=>{try{const t=localStorage.getItem(Rm);if(!t)return[];const n=JSON.parse(t);return n.version!==zd&&console.warn(`Custom protocol storage version mismatch: expected ${zd}, got ${n.version}`),n.protocols||[]}catch(t){return console.error("Error loading custom protocols:",t),[]}},nu=t=>{try{const n={protocols:t,version:zd};localStorage.setItem(Rm,JSON.stringify(n))}catch(n){console.error("Error saving custom protocols:",n)}},yt=t=>{const n=yr(),r=n.findIndex(i=>i.id===t.id);r>=0?n[r]=t:n.push(t),nu(n)},O0=t=>{const r=yr().filter(i=>i.id!==t);nu(r)},M0=["anarchy-custom-001","apathy_custom","assimilation-custom-001","chaos_custom_1","clarity-custom-001","corruption-custom-001","courage-custom-001","darkness_custom_v1","death_custom_v1","diversity-custom-001","fear_custom","fire-custom-001","frost_custom_1","gravity_custom_1","hate-custom-001","ice_custom","life_custom_1","light_custom_1","love_custom_v1","luck-custom-001","metal_custom_1","mirror-custom-001","peace-custom-001","plague-custom-001","psychic_custom_v1","smoke-custom-001","speed_custom_1","spirit_custom_1","time-custom-001","unity-custom-001","war-custom-001","water_custom_1"],al=t=>M0.includes(t.id),H0=(t,n)=>{const r=(s,d)=>{s=s.replace("#","");const u=parseInt(s.substring(0,2),16),p=parseInt(s.substring(2,4),16),f=parseInt(s.substring(4,6),16);return`rgba(${u}, ${p}, ${f}, ${d})`},i={borderColor:n};switch(t){case"solid":return{...i,backgroundColor:n};case"radial":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`radial-gradient(circle at 50% 50%, ${r(n,.25)} 0%, transparent 60%)`};case"dual-radial":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 0% 0%, ${r(n,.2)}, transparent 50%),
                    radial-gradient(at 100% 100%, ${r(n,.2)}, transparent 50%)
                `};case"multi-radial":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 0%, ${r(n,.2)}, transparent 70%),
                    radial-gradient(circle at 20% 30%, ${r(n,.15)}, transparent 40%),
                    radial-gradient(circle at 80% 70%, ${r(n,.2)}, transparent 50%)
                `};case"chaos":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 10% 10%, hsla(60, 100%, 50%, 0.15), transparent 30%),
                    radial-gradient(at 90% 20%, hsla(180, 100%, 50%, 0.15), transparent 35%),
                    radial-gradient(at 30% 80%, hsla(300, 100%, 50%, 0.15), transparent 40%),
                    radial-gradient(at 70% 60%, hsla(0, 100%, 50%, 0.1), transparent 25%)
                `};case"grid":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(circle at 50% 50%, ${r(n,.2)} 0%, transparent 40%),
                    linear-gradient(hsla(0,0%,100%,0.03) 1px, transparent 1px),
                    linear-gradient(90deg, hsla(0,0%,100%,0.03) 1px, transparent 1px)
                `,backgroundSize:"100% 100%, 20px 20px, 20px 20px"};case"diagonal-lines":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 0% 100%, ${r(n,.25)}, transparent 70%),
                    repeating-linear-gradient(120deg, transparent, transparent 15px, ${r(n,.05)} 15px, ${r(n,.05)} 30px)
                `};case"cross-diagonal":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 50%, ${r(n,.25)} 0%, transparent 50%),
                    repeating-linear-gradient(45deg, transparent, transparent 8px, ${r(n,.08)} 8px, ${r(n,.08)} 16px),
                    repeating-linear-gradient(-45deg, transparent, transparent 8px, ${r(n,.06)} 8px, ${r(n,.06)} 16px)
                `};case"horizontal-lines":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 80% 80%, ${r(n,.1)}, transparent 50%),
                    repeating-linear-gradient(0deg, hsla(0,0%,100%,0.02), hsla(0,0%,100%,0.02) 1px, transparent 1px, transparent 3px)
                `};case"vertical-lines":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 10% 10%, ${r(n,.2)}, transparent 50%),
                    repeating-linear-gradient(175deg, transparent, transparent 1px, ${r(n,.05)} 1px, ${r(n,.05)} 2px)
                `};case"cross":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    linear-gradient(0deg, transparent 40%, ${r(n,.1)} 50%, transparent 60%),
                    linear-gradient(90deg, transparent 48%, ${r(n,.2)} 50%, transparent 52%)
                `};case"hexagons":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 0%, ${r(n,.2)}, transparent 70%),
                    url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='28' height='49' viewBox='0 0 28 49'%3E%3Cg fill-rule='evenodd'%3E%3Cg id='hexagons' fill='${encodeURIComponent(n)}' fill-opacity='0.05' fill-rule='nonzero'%3E%3Cpath d='M13.99 9.25l13 7.5v15l-13 7.5L1 31.75v-15l12.99-7.5zM3 17.9v12.7l10.99 6.34 11-6.35V17.9l-11-6.34L3 17.9zM0 15l12.99-7.5L26 15v18.5l-13 7.5L0 33.5V15z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")
                `};case"stripes":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 100%, ${r(n,.25)}, transparent 60%),
                    linear-gradient(135deg, hsla(0,0%,0%,0.1) 23%, transparent 23%, transparent 25%, hsla(0,0%,0%,0.1) 25%, hsla(0,0%,0%,0.1) 27%, transparent 27%, transparent 73%, hsla(0,0%,0%,0.1) 73%, hsla(0,0%,0%,0.1) 75%, transparent 75%, transparent 77%, hsla(0,0%,0%,0.1) 77%)
                `};default:return{...i,backgroundColor:n}}},V0=({protocols:t,onCreateNew:n,onEdit:r,onDelete:i,onImport:s,onBack:d})=>{const[u,p]=se.useState(!1),[f,h]=se.useState(!1),[w,g]=se.useState(""),[y,m]=se.useState(""),x=u?t:t.filter(E=>!al(E)),S=()=>{m("");try{const E=JSON.parse(w);if(!E.name||!E.color||!E.pattern||!Array.isArray(E.cards)){m("Invalid protocol format. Missing required fields.");return}if(E.cards.length!==6){m("Invalid protocol: must have exactly 6 cards.");return}const j=t.find(b=>b.name.toLowerCase()===E.name.toLowerCase());if(j){confirm(`A protocol named "${E.name}" already exists. Overwrite it?`)&&(E.id=j.id,s(E),h(!1),g(""),alert("Protocol imported and overwritten successfully!"));return}E.id=Date.now().toString(),E.createdAt=new Date().toISOString(),s(E),h(!1),g(""),alert("Protocol imported successfully!")}catch{m("Invalid JSON format. Please check your input.")}};return o.jsxs("div",{className:"protocol-list",children:[o.jsxs("div",{className:"list-header",children:[o.jsx("h2",{children:"Custom Protocols"}),o.jsxs("div",{className:"header-actions",children:[o.jsxs("label",{className:"system-protocols-toggle",children:[o.jsx("input",{type:"checkbox",checked:u,onChange:E=>p(E.target.checked)}),"Show System Protocols"]}),o.jsx("button",{onClick:()=>h(!0),className:"btn",children:"Import Protocol"}),d&&o.jsx("button",{onClick:d,className:"btn btn-back",children:"Back"})]})]}),f&&o.jsx("div",{className:"custom-protocol-modal-overlay",onClick:()=>h(!1),children:o.jsxs("div",{className:"custom-protocol-modal-content",onClick:E=>E.stopPropagation(),children:[o.jsx("h3",{children:"Import Protocol"}),o.jsx("p",{children:"Paste the protocol JSON below:"}),o.jsx("textarea",{value:w,onChange:E=>g(E.target.value),placeholder:'{"name":"Protocol Name","color":"#1976D2",...}',rows:10,className:"import-textarea"}),y&&o.jsx("div",{className:"error-message",children:y}),o.jsxs("div",{className:"custom-protocol-modal-actions",children:[o.jsx("button",{onClick:()=>h(!1),className:"btn btn-back",children:"Cancel"}),o.jsx("button",{onClick:S,className:"btn",children:"Import"})]})]})}),o.jsxs("div",{className:"protocols-grid",children:[o.jsxs("div",{className:"protocol-card new-protocol-card",onClick:n,children:[o.jsx("div",{className:"protocol-header new-protocol-header",children:o.jsxs("div",{className:"protocol-header-content",children:[o.jsx("h3",{children:"+ New Protocol"}),o.jsx("p",{className:"header-description",children:"Create a custom protocol"})]})}),o.jsx("div",{className:"protocol-body new-protocol-body"})]}),x.map(E=>{const j=al(E);return o.jsx("div",{className:`protocol-card ${j?"system-protocol":""}`,style:H0(E.pattern,E.color),onClick:()=>r(E),children:o.jsxs("div",{className:"protocol-header-content",children:[o.jsx("h3",{children:E.name}),j&&o.jsx("span",{className:"system-badge",children:"System"}),E.description&&o.jsx("p",{className:"header-description",children:E.description})]})},E.id)})]})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Fm="customProtocolsEnabled";function au(){try{return localStorage.getItem(Fm)==="true"}catch{return!1}}function z0(t){try{localStorage.setItem(Fm,t?"true":"false")}catch{}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */let xi=null;function B0(){if(!xi){const t=au(),n=zo(),r=yr(),i=new Set(r.filter(s=>al(s)).map(s=>s.name));xi=n.filter(s=>i.has(s.protocol)||t)}return xi}function Jl(){xi=null}function so(t){const n=B0(),r=[];for(const i of t){const s=n.filter(d=>d.protocol===i);r.push(...s)}return r}function Yn(t){const n=[...t];for(let r=n.length-1;r>0;r--){const i=Math.floor(Math.random()*(r+1));[n[r],n[i]]=[n[i],n[r]]}return n}function rm({onNavigate:t,difficulty:n,setDifficulty:r,useControl:i,onUseControlChange:s}){const[d,u]=se.useState(null),[p,f]=se.useState(null),[h,w]=se.useState(null),[g,y]=se.useState([]),[m,x]=se.useState(!0),[S,E]=se.useState(0);se.useEffect(()=>{const b=new Set;for(;b.size<2&&b.size<Wn.length;)b.add(Math.floor(Math.random()*Wn.length));const k=Array.from(b).map(N=>Wn[N]);k.length>0&&(w(k[0]),f(k[0])),k.length>1&&u(k[1]),y(Yn(Wn))},[]);const j=()=>{const b=S+1;if(E(b),b>=5){const k=!m;x(k),z0(k),E(0)}};return o.jsxs("div",{className:"screen main-menu",children:[o.jsx("h1",{children:"COMPILE: MAIN 1 & 2"}),o.jsxs("div",{className:"main-menu-attribution",children:[o.jsxs("p",{children:["based on the card game ",o.jsx("a",{href:"https://boardgamegeek.com/boardgame/406652/compile-main-1",target:"_blank",rel:"noopener noreferrer",children:"Compile: Main 1"})," designed by ",o.jsx("a",{href:"https://justgravyllc.com/",target:"_blank",rel:"noopener noreferrer",children:"Michael Yang"})]}),o.jsxs("p",{children:[o.jsx("span",{onClick:j,style:{cursor:"default",userSelect:"none"},children:"developed"})," by ",o.jsx("a",{href:"https://apo-games.de/",target:"_blank",rel:"noopener noreferrer",children:"Dirk Aporius"})]})]}),o.jsxs("div",{className:"main-menu-layout",children:[o.jsx("div",{className:"main-menu-preview decorative-card",children:p&&o.jsx(xt,{card:{...p,id:"preview",isFaceUp:!0},isFaceUp:!0})}),o.jsxs("div",{className:"main-menu-actions-container",children:[o.jsxs("div",{className:"main-menu-start-group",children:[o.jsxs("div",{className:"difficulty-selector",children:[o.jsx("h3",{className:"difficulty-title",children:"Difficulty"}),o.jsxs("div",{className:"difficulty-options",children:[o.jsx("button",{className:`btn ${n==="easy"?"active":""}`,onClick:()=>r("easy"),children:"Easy"}),o.jsx("button",{className:`btn ${n==="normal"?"active":""}`,onClick:()=>r("normal"),children:"Normal"}),o.jsx("button",{className:`btn btn-wip ${n==="hard"?"active":""}`,disabled:!0,children:"Hard"})]})]}),o.jsxs("div",{className:"control-mechanic-selector",children:[o.jsx("input",{type:"checkbox",id:"control-mechanic",checked:i,onChange:b=>s(b.target.checked)}),o.jsx("label",{htmlFor:"control-mechanic",children:"Use Control Mechanic"})]}),o.jsx("button",{className:"btn btn-start",onClick:()=>t("ProtocolSelection"),children:"Start Game"})]}),o.jsxs("div",{className:"main-menu-other-actions",children:[o.jsx("button",{className:"btn",onClick:()=>t("CardLibrary"),children:"Cards"}),o.jsx("button",{className:"btn",onClick:()=>t("Statistics"),children:"Statistics"}),m&&o.jsx("button",{className:"btn",onClick:()=>t("CustomProtocols"),children:"Custom Protocols"}),o.jsx("button",{className:"btn",onClick:()=>t("Rules"),children:"Rules"}),o.jsx("p",{className:"version-info",children:"Version 0.30"})]})]}),o.jsx("div",{className:"decorative-card decorative-card-right",children:d&&o.jsx(xt,{card:{...d,id:"deco-2",isFaceUp:!0},isFaceUp:!0})})]}),o.jsx("div",{className:"card-ticker-container",onPointerLeave:()=>f(h),children:o.jsxs("div",{className:"card-ticker-track",children:[g.map((b,k)=>o.jsx(xt,{card:{...b,id:`ticker-1-${k}`,isFaceUp:!0},isFaceUp:!0,additionalClassName:"in-hand",onPointerEnter:()=>f(b)},`ticker-1-${k}`)),g.map((b,k)=>o.jsx(xt,{card:{...b,id:`ticker-2-${k}`,isFaceUp:!0},isFaceUp:!0,additionalClassName:"in-hand",onPointerEnter:()=>f(b)},`ticker-2-${k}`))]})})]})}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function Ai({title:t,onBack:n}){return o.jsxs("header",{className:"app-header",children:[o.jsx("h2",{children:t}),n&&o.jsx("button",{className:"btn btn-back",onClick:n,children:"Back"})]})}const gi=[{player:"Player",picks:1},{player:"Opponent",picks:2},{player:"Player",picks:2},{player:"Opponent",picks:1}];function G0({onBack:t,onStartGame:n}){const[r,i]=se.useState(0),[s,d]=se.useState([]),[u,p]=se.useState([]),[f,h]=se.useState([]),[w,g]=se.useState(!1),[y,m]=se.useState(null),[x,S]=se.useState(null),[E,j]=se.useState(0);se.useEffect(()=>{Jl(),j(Q=>Q+1)},[]);const b=se.useMemo(()=>{const Q=au(),ee=zo(),oe=yr(),me=new Set(oe.filter(xe=>al(xe)).map(xe=>xe.name));return ee.filter(xe=>me.has(xe.protocol)||Q)},[E]),k=se.useMemo(()=>{const Q=new Set(b.map(ee=>ee.protocol));return Array.from(Q).sort()},[b]),N=se.useMemo(()=>{const Q=new Set(b.map(ee=>ee.category));return Array.from(Q).sort()},[b]),U=["Fan-Content","Main 2","Aux 2"],[V,R]=se.useState(new Set),[O,X]=se.useState(!1);se.useEffect(()=>{if(N.length>0&&!O){const Q=new Set(N);U.forEach(ee=>Q.delete(ee)),R(Q),X(!0)}},[N,O]);const M=Q=>{const ee=b.find(oe=>oe.protocol===Q);return(ee==null?void 0:ee.category)||""},$=Q=>{const oe=b.find(me=>me.protocol===Q);return oe!=null&&oe.color?{"--card-custom-color":oe.color,borderColor:oe.color}:{}},B=Q=>{const oe=b.find(me=>me.protocol===Q);return oe!=null&&oe.pattern?`pattern-${oe.pattern}`:""},I=se.useMemo(()=>k.filter(Q=>{const ee=M(Q);return V.has(ee)}),[V]),D=Q=>{R(ee=>{const oe=new Set(ee);return oe.has(Q)?oe.delete(Q):oe.add(Q),oe})},L=gi[r],T=(L==null?void 0:L.player)==="Player",q=(L==null?void 0:L.player)==="Opponent",P=se.useMemo(()=>new Set([...s,...u]),[s,u]),Z=se.useMemo(()=>f.map(Q=>({name:Q,cards:b.filter(ee=>ee.protocol===Q).sort((ee,oe)=>ee.value-oe.value)})),[f]),G=Q=>{if(!T||w)return;const ee=b.filter(oe=>oe.protocol===Q).sort((oe,me)=>oe.value-me.value);ee.length>0&&S(ee[0]),h(oe=>{if(oe.includes(Q))return oe.filter(me=>me!==Q);if(oe.length<L.picks)return[...oe,Q];if(oe.length===L.picks){const me=oe.slice(1);return me.push(Q),me}return oe})},A=async()=>{if(!T||w||f.length!==L.picks)return;g(!0);const Q=[...f];h([]);for(const ee of Q)d(oe=>[...oe,ee]),await new Promise(oe=>setTimeout(oe,300));g(!1),i(ee=>ee+1)};se.useEffect(()=>{q&&!w&&r<gi.length&&(async()=>{g(!0),await new Promise(K=>setTimeout(K,100));const ee=[],oe=k.filter(K=>{if(P.has(K))return!1;const z=M(K);return V.has(z)}),me=k.filter(K=>!P.has(K)),ke=oe.length>=L.picks?[...oe]:[...me],xe=[],ie=ee.filter(K=>ke.includes(K));for(let K=0;K<L.picks;K++)if(ie.length>0){const z=ie.shift();xe.push(z);const le=ke.indexOf(z);le>-1&&ke.splice(le,1)}else if(ke.length>0){const z=Math.floor(Math.random()*ke.length);xe.push(ke.splice(z,1)[0])}for(const K of xe)await new Promise(z=>setTimeout(z,1e3)),m(K),await new Promise(z=>setTimeout(z,1e3)),m(null),p(z=>[...z,K]);g(!1),i(K=>K+1)})()},[r,q,w,P,L,V,k,M]),se.useEffect(()=>{r>=gi.length&&!w&&setTimeout(()=>{n(s,u)},1e3)},[r,w,n,s,u]);const W=Q=>{const ee=["protocol-card",`card-protocol-${Q.toLowerCase()}`];return f.includes(Q)&&ee.push("selected"),P.has(Q)&&ee.push("chosen"),y===Q&&ee.push("is-scanning"),ee.join(" ")},J=()=>w&&q?"Opponent is selecting protocols...":(L==null?void 0:L.player)==="Player"?`Player, select ${L.picks} protocol(s). (${f.length}/${L.picks})`:r>=gi.length?"Finalizing selections...":"Waiting for Opponent...";return o.jsxs("div",{className:"screen protocol-selection-screen",children:[o.jsx(Ai,{title:"Protocol Selection",onBack:t}),o.jsxs("div",{className:"protocol-selection-layout",children:[o.jsxs("div",{className:"protocol-selection-sidebar",children:[o.jsxs("div",{className:"player-protocols-area",children:[o.jsx("h3",{children:"Your Protocols"}),s.map(Q=>o.jsx("div",{className:`protocol-display-card player card-protocol-${Q.toLowerCase()} ${B(Q)}`,style:$(Q),children:Q},Q))]}),o.jsx("div",{className:"protocol-preview-area",children:x?o.jsx(xt,{card:{...x,id:"preview",isFaceUp:!0},isFaceUp:!0}):o.jsx("p",{children:Z.length>0?"Hover over a card below to see details.":"Select a protocol to see its cards."})})]}),o.jsxs("div",{className:"protocol-grid-container",children:[o.jsx("p",{children:J()}),o.jsx("div",{className:"category-filters",children:N.map(Q=>o.jsxs("label",{className:"category-filter-item",children:[o.jsx("input",{type:"checkbox",checked:V.has(Q),onChange:()=>D(Q)}),o.jsx("span",{children:Q})]},Q))}),o.jsx("div",{className:"protocol-grid-scroll-wrapper",children:o.jsx("div",{className:"protocol-grid",children:I.map(Q=>{const ee=$(Q),me={fontSize:Q.length>10?"0.65em":"1em"};return o.jsxs("div",{className:`${W(Q)} ${B(Q)}`,style:ee,onClick:()=>G(Q),role:"button","aria-disabled":P.has(Q)||!T||w,tabIndex:!P.has(Q)&&T&&!w?0:-1,onKeyPress:ke=>ke.key==="Enter"&&G(Q),children:[o.jsx("span",{className:"protocol-category-label",children:M(Q)}),o.jsx("span",{className:"protocol-name",style:me,children:Q})]},Q)})})}),T&&o.jsx("button",{className:"btn",onClick:A,disabled:w||f.length!==(L==null?void 0:L.picks),children:"Confirm Selection"})]}),o.jsxs("div",{className:"opponent-protocols-area",children:[o.jsx("h3",{children:"Opponent Protocols"}),u.map(Q=>o.jsx("div",{className:`protocol-display-card opponent card-protocol-${Q.toLowerCase()} ${B(Q)}`,style:$(Q),children:Q},Q))]})]}),o.jsx("div",{className:"selected-protocol-cards-container",children:Z.length>0&&[...Z].reverse().map(Q=>o.jsx("div",{className:"protocol-card-row",children:Q.cards.map(ee=>o.jsx(xt,{card:{...ee,id:`selection-${ee.protocol}-${ee.value}`,isFaceUp:!0},isFaceUp:!0,additionalClassName:"in-hand",onClick:()=>S(ee),onPointerEnter:()=>S(ee)},`${Q.name}-${ee.value}`))},Q.name))})]})}const Y0="modulepreload",W0=function(t){return"/"+t},lm={},Q0=function(n,r,i){let s=Promise.resolve();if(r&&r.length>0){let u=function(h){return Promise.all(h.map(w=>Promise.resolve(w).then(g=>({status:"fulfilled",value:g}),g=>({status:"rejected",reason:g}))))};document.getElementsByTagName("link");const p=document.querySelector("meta[property=csp-nonce]"),f=(p==null?void 0:p.nonce)||(p==null?void 0:p.getAttribute("nonce"));s=u(r.map(h=>{if(h=W0(h),h in lm)return;lm[h]=!0;const w=h.endsWith(".css"),g=w?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${g}`))return;const y=document.createElement("link");if(y.rel=w?"stylesheet":Y0,w||(y.as="script"),y.crossOrigin="",y.href=h,f&&y.setAttribute("nonce",f),document.head.appendChild(y),w)return new Promise((m,x)=>{y.addEventListener("load",m),y.addEventListener("error",()=>x(new Error(`Unable to preload CSS for ${h}`)))})}))}function d(u){const p=new Event("vite:preloadError",{cancelable:!0});if(p.payload=u,window.dispatchEvent(p),!p.defaultPrevented)throw u}return s.then(u=>{for(const p of u||[])p.status==="rejected"&&d(p.reason);return n().catch(d)})},pn=[];for(let t=0;t<256;++t)pn.push((t+256).toString(16).slice(1));function X0(t,n=0){return(pn[t[n+0]]+pn[t[n+1]]+pn[t[n+2]]+pn[t[n+3]]+"-"+pn[t[n+4]]+pn[t[n+5]]+"-"+pn[t[n+6]]+pn[t[n+7]]+"-"+pn[t[n+8]]+pn[t[n+9]]+"-"+pn[t[n+10]]+pn[t[n+11]]+pn[t[n+12]]+pn[t[n+13]]+pn[t[n+14]]+pn[t[n+15]]).toLowerCase()}let Ld;const Z0=new Uint8Array(16);function K0(){if(!Ld){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Ld=crypto.getRandomValues.bind(crypto)}return Ld(Z0)}const J0=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),sm={randomUUID:J0};function st(t,n,r){var s;if(sm.randomUUID&&!t)return sm.randomUUID();t=t||{};const i=t.random??((s=t.rng)==null?void 0:s.call(t))??K0();if(i.length<16)throw new Error("Random bytes length must be >= 16");return i[6]=i[6]&15|64,i[8]=i[8]&63|128,X0(i)}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const te=(t,n,r,i)=>{let s=t._logIndentLevel||0;t._currentPhaseContext&&s===0&&(s=1);const d={player:n,message:r,indentLevel:s,sourceCard:t._currentEffectSource,phase:t._currentPhaseContext,sourceCardRef:i==null?void 0:i.sourceCardRef,targetCardRefs:i==null?void 0:i.targetCardRefs};return{...t,log:[...t.log,d]}},Ua=t=>({...t,_logIndentLevel:(t._logIndentLevel||0)+1}),Mo=t=>({...t,_logIndentLevel:Math.max(0,(t._logIndentLevel||0)-1)}),Ze=(t,n)=>({...t,_currentEffectSource:n}),et=(t,n)=>({...t,_currentPhaseContext:n});/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function bn(t){const n=[];for(const r of["player","opponent"])t[r].lanes.forEach((i,s)=>{i.forEach((d,u)=>{if(d.isFaceUp){const p=d;if(p.customEffects){const f=u===i.length-1;(p.customEffects.topEffects||[]).forEach(g=>{g.params.action==="passive_rule"&&g.trigger==="passive"&&n.push({rule:g.params.rule,cardOwner:r,laneIndex:s,sourceCardId:d.id})}),(p.customEffects.middleEffects||[]).forEach(g=>{g.params.action==="passive_rule"&&g.trigger==="passive"&&n.push({rule:g.params.rule,cardOwner:r,laneIndex:s,sourceCardId:d.id})}),f&&(p.customEffects.bottomEffects||[]).forEach(y=>{y.params.action==="passive_rule"&&y.trigger==="passive"&&n.push({rule:y.params.rule,cardOwner:r,laneIndex:s,sourceCardId:d.id})})}d.protocol==="Frost"&&d.value===1&&(n.push({rule:{type:"block_flips",target:"all",scope:"global"},cardOwner:r,laneIndex:s}),u===i.length-1&&n.push({rule:{type:"block_protocol_rearrange",target:"all",scope:"global"},cardOwner:r,laneIndex:s})),d.protocol==="Frost"&&d.value===3&&n.push({rule:{type:"block_shifts_from_and_to_lane",target:"all",scope:"this_lane"},cardOwner:r,laneIndex:s})}})});return n}function fr(t,n,r,i,s,d){var E,j,b;const u=bn(t),p=n==="player"?"opponent":"player",f=t[n].protocols[r],h=t[p].protocols[r],w=s===f||s===h;let g=!1,y=!1;if(d){const k=d,N=[...((E=k.customEffects)==null?void 0:E.topEffects)||[],...((j=k.customEffects)==null?void 0:j.middleEffects)||[],...((b=k.customEffects)==null?void 0:b.bottomEffects)||[]];g=N.some(U=>{var V,R,O;return((V=U.params)==null?void 0:V.action)==="passive_rule"&&((O=(R=U.params)==null?void 0:R.rule)==null?void 0:O.type)==="allow_play_on_opponent_side"}),y=N.some(U=>{var V,R;return((V=U.params)==null?void 0:V.action)==="card_property"&&((R=U.params)==null?void 0:R.property)==="ignore_protocol_matching"})}for(const{rule:k,cardOwner:N,laneIndex:U}of u){const V=k.scope==="global"||U===r,R=k.target==="all"||k.target==="self"&&N===n||k.target==="opponent"&&N===p;if(!(!V||!R))switch(k.type){case"block_all_play":return{allowed:!1,reason:"Cannot play cards in this lane (passive rule)"};case"block_face_down_play":if(!i)return{allowed:!1,reason:"Cannot play cards face-down in this lane (passive rule)"};break;case"block_face_up_play":if(i)return{allowed:!1,reason:"Cannot play cards face-up in this lane (passive rule)"};break;case"require_face_down_play":if(i)return{allowed:!1,reason:"Can only play cards face-down (passive rule)"};break;case"allow_any_protocol_play":break;case"require_non_matching_protocol":if(i&&w)return{allowed:!1,reason:"Can only play cards without matching protocols (passive rule)"};break}}const m=u.some(({rule:k,cardOwner:N,laneIndex:U})=>{if(k.type!=="allow_any_protocol_play")return!1;const V=k.scope==="global"||U===r,R=k.target==="all"||k.target==="self"&&N===n||k.target==="opponent"&&N===p;return V&&R}),x=u.some(({rule:k,cardOwner:N,laneIndex:U})=>{if(k.type!=="require_non_matching_protocol")return!1;const V=k.scope==="global"||U===r,R=k.target==="all"||k.target==="self"&&N===n||k.target==="opponent"&&N===p;return V&&R}),S=il(t,n,r,s);return i&&!w&&!m&&!x&&!g&&!S&&!y?{allowed:!1,reason:"Face-up play requires matching protocol"}:{allowed:!0}}function ou(t){return bn(t).some(({rule:r})=>r.type==="require_non_matching_protocol"&&r.scope==="global")}function Ri(t,n,r){const i=bn(t),s=n==="player"?"opponent":"player";return i.some(({rule:d,cardOwner:u,laneIndex:p})=>{if(d.type!=="allow_any_protocol_play")return!1;const f=d.scope==="global"||r!==void 0&&p===r,h=d.target==="all"||d.target==="self"&&u===n||d.target==="opponent"&&u===s;return f&&h})}function ns(t,n){const r=n.customEffects;return r?(r.bottomEffects||[]).some(s=>{var d,u,p;return((d=s.params)==null?void 0:d.action)!=="passive_rule"?!1:((p=(u=s.params)==null?void 0:u.rule)==null?void 0:p.type)==="allow_play_on_opponent_side"}):!1}function ew(t,n){const r=bn(t);for(const{rule:i,laneIndex:s}of r)if(!(i.type!=="block_flips"||!(i.scope==="global"||s===n)))return{allowed:!1,reason:"Cards cannot be flipped face-up in this lane (passive rule)"};return{allowed:!0}}function as(t,n,r){const i=bn(t);for(const{rule:s,laneIndex:d}of i){if(s.type==="block_shifts_from_lane"&&d===n)return s.scope,{allowed:!1,reason:"Cards cannot shift from this lane (passive rule)"};if(s.type==="block_shifts_to_lane"&&d===r)return s.scope,{allowed:!1,reason:"Cards cannot shift to this lane (passive rule)"};if(s.type==="block_shifts_from_and_to_lane"&&(d===n||d===r))return{allowed:!1,reason:"Cards cannot shift from or to this lane (passive rule)"}}return{allowed:!0}}function tw(t){const n=bn(t);for(const{rule:r}of n)if(r.type==="block_protocol_rearrange")return{allowed:!1,reason:"Protocols cannot be rearranged (passive rule)"};return{allowed:!0}}function nw(t,n,r){const i=bn(t),s=t.turn;for(const{rule:d,cardOwner:u,laneIndex:p,sourceCardId:f}of i)if(!(d.type!=="ignore_middle_commands"||!(d.scope==="global"||p===n))&&!(d.onlyDuringYourTurn&&s!==u)){if(r!==void 0){const w=u==="player"?"opponent":"player";if(d.target==="opponent"&&r!==w||d.target==="self"&&r!==u)continue}if(f)for(const w of["player","opponent"])for(const g of t[w].lanes){const y=g.find(m=>m.id===f);if(y)return y}return null}return null}function Pa(t){return bn(t).some(({rule:r})=>r.type==="block_flips"&&r.scope==="global")}function aw(t){return bn(t).some(({rule:r})=>r.type==="block_protocol_rearrange")}function es(t,n){const r=bn(t);for(const{rule:i,sourceCardId:s}of r)if(i.type==="block_flip_this_card"&&s===n)return{allowed:!1,reason:"This card cannot be flipped (passive rule)"};return{allowed:!0}}function ru(t,n){const r=bn(t);for(const{rule:i,cardOwner:s}of r)if(i.type==="block_draw_conditional"){const u=(i.conditionTarget||"self")==="self"?s:s==="player"?"opponent":"player",p=i.blockTarget||"self";let f;if(p==="self"?f=s:p==="opponent"?f=s==="player"?"opponent":"player":f="all",t[u].hand.length>0&&(f==="all"||f===n))return{allowed:!1,reason:"Cannot draw cards (passive rule)"}}return{allowed:!0}}function il(t,n,r,i){const s=bn(t);for(const{rule:d,cardOwner:u,laneIndex:p}of s)if(d.type==="allow_same_protocol_face_up_play"&&!(d.scope!=="this_lane"||p!==r)&&u===n&&d.protocolScope==="same_as_source"){const f=t[u].lanes[p];for(let h=0;h<f.length;h++){const w=f[h];if(!w.isFaceUp||!(h===f.length-1))continue;const y=w;if(!y.customEffects)continue;if([...y.customEffects.topEffects||[],...y.customEffects.middleEffects||[],...y.customEffects.bottomEffects||[]].some(S=>{var E,j,b;return((E=S.params)==null?void 0:E.action)==="passive_rule"&&((b=(j=S.params)==null?void 0:j.rule)==null?void 0:b.type)==="allow_same_protocol_face_up_play"})&&w.protocol===i)return!0}}return!1}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const ow={},rw={},lw={},sw={};function cl(t,n,r,i){const{cardOwner:s,opponent:d,triggerType:u}=i,p=r[s].lanes[n];if(!p.find(x=>x.id===t.id))return{newState:r};if(!(u==="uncover"||p.length>0&&p[p.length-1].id===t.id))return{newState:r};const w=nw(r,n,s);if(w){const x=`${t.protocol}-${t.value}`,S=`${w.protocol}-${w.value}`;return{newState:te(r,s,`${x}: Effect blocked by ${S}.`)}}if(r.skipNextMiddleCommand===t.id){const x=`${t.protocol}-${t.value}`;let S={...r};return delete S.skipNextMiddleCommand,S=te(S,s,`${x}: Middle commands ignored.`),{newState:S}}const g=t;if(g.customEffects&&g.customEffects.middleEffects&&g.customEffects.middleEffects.length>0){let x=Ua(r);const S=`${t.protocol}-${t.value}`;x=Ze(x,S),x=et(x,"middle");let E=x;const j=E._pendingCustomEffects;if(j&&j.sourceCardId!==t.id){const N=E.lastCustomEffectTargetCardId,U={type:"execute_remaining_custom_effects",sourceCardId:j.sourceCardId,laneIndex:j.laneIndex,effects:j.effects,context:j.context,actor:j.context.cardOwner,selectedCardFromPreviousEffect:N||j.selectedCardFromPreviousEffect,savedLastCustomEffectTargetCardId:E.lastCustomEffectTargetCardId,logSource:j.logSource,logPhase:j.logPhase,logIndentLevel:j.logIndentLevel},V=E._deferredParentEffects||[];E={...E,_deferredParentEffects:[...V,U]},delete E._pendingCustomEffects}E.lastCustomEffectTargetCardId&&(E={...E,lastCustomEffectTargetCardId:null});for(let N=0;N<g.customEffects.middleEffects.length;N++){const U=g.customEffects.middleEffects[N],V=g.customEffects.middleEffects.slice(N+1),R=V.length>0;if(R&&(E._pendingCustomEffects={sourceCardId:t.id,laneIndex:n,context:i,effects:V,logSource:E._currentEffectSource,logPhase:E._currentPhaseContext,logIndentLevel:E._logIndentLevel||0}),E=ct(t,n,E,i,U).newState,E.actionRequired)return{newState:Ae(E)};const X=E._pendingCustomEffects;X&&R&&X.sourceCardId===t.id&&delete E._pendingCustomEffects}const b=E._deferredParentEffects;if(b&&b.length>0){const N=b[b.length-1],U=b.slice(0,-1);E={...E,_deferredParentEffects:U.length>0?U:void 0,lastCustomEffectTargetCardId:N.savedLastCustomEffectTargetCardId||N.selectedCardFromPreviousEffect,_pendingCustomEffects:{sourceCardId:N.sourceCardId,laneIndex:N.laneIndex,context:N.context,effects:N.effects,selectedCardFromPreviousEffect:N.selectedCardFromPreviousEffect,logSource:N.logSource,logPhase:N.logPhase,logIndentLevel:N.logIndentLevel}}}return{newState:Ae(E)}}const y=`${t.protocol}-${t.value}`,m=ow[y];if(m){let x=Ua(r);const S=`${t.protocol}-${t.value}`;x=Ze(x,S),x=et(x,"middle");const E=m(t,n,x,i);let j=E.newState;const b=Ae(j);return{...E,newState:b}}return{newState:r}}function lu(t,n,r,i){if(!t.isFaceUp)return{newState:r};const s=t;if(s.customEffects){const f=[...s.customEffects.topEffects||[],...s.customEffects.middleEffects||[],...s.customEffects.bottomEffects||[]].filter(h=>{if(!(h.trigger==="on_cover"||h.trigger==="on_cover_or_flip"))return!1;if(h.onCoverProtocolRestriction==="same_protocol"){const g=r._coveringCardProtocol;if(g&&g!==t.protocol)return!1}return!0});if(f.length>0){const h=`${t.protocol}-${t.value}`;let w=Ze(r,h);w=et(w,"oncover");let g=w;const y=[];for(const x of f){const S=ct(t,n,g,i,x);if(g=S.newState,S.animationRequests&&y.push(...S.animationRequests),g.actionRequired)return{newState:Ae(g),animationRequests:y.length>0?y:void 0}}return{newState:Ae(g),animationRequests:y.length>0?y:void 0}}}const d=`${t.protocol}-${t.value}`,u=sw[d];if(u){const p=`${t.protocol}-${t.value}`;let f=Ze(r,p);f=et(f,"oncover");const h=u(t,n,f,i),w=Ae(h.newState);return{...h,newState:w}}return{newState:r}}function iw(t,n,r){const i=[],s=new Set,d=r==="Start"?"start":"end";return t[n].lanes.flat().forEach(u=>{var f;if(!u.isFaceUp||s.has(u.id))return;const p=u;if((f=p.customEffects)!=null&&f.topEffects){const h=p.customEffects.topEffects.filter(w=>w.trigger===d);h.length>0&&(i.push({cardId:u.id,box:"top",effectIds:h.map(w=>w.id)}),s.add(u.id))}u.top.includes(`'emphasis'>${r}:`)&&(s.has(u.id)||(i.push({cardId:u.id,box:"top",effectIds:[]}),s.add(u.id)))}),t[n].lanes.forEach(u=>{var h;if(u.length===0)return;const p=u[u.length-1];if(!p.isFaceUp||s.has(p.id))return;const f=p;if((h=f.customEffects)!=null&&h.bottomEffects){const w=f.customEffects.bottomEffects.filter(g=>g.trigger===d);w.length>0&&(i.push({cardId:p.id,box:"bottom",effectIds:w.map(g=>g.id)}),s.add(p.id))}p.bottom.includes(`'emphasis'>${r}:`)&&(s.has(p.id)||(i.push({cardId:p.id,box:"bottom",effectIds:[]}),s.add(p.id)))}),i}function cw(t,n,r){for(let i=0;i<t[n].lanes.length;i++){const s=t[n].lanes[i],d=s.find(u=>u.id===r.cardId);if(d)return!d.isFaceUp||r.box==="bottom"&&!(s.length>0&&s[s.length-1].id===d.id)?null:{card:d,laneIndex:i}}return null}function dw(t,n,r){const i=t,s=r==="Start"?"start":"end";if(i.customEffects){const p=n==="top"?i.customEffects.topEffects:i.customEffects.bottomEffects,f=(p==null?void 0:p.filter(h=>h.trigger===s))||[];if(f.length>0)return f.map(w=>{var m,x;const g=((m=w.params)==null?void 0:m.action)||"effect",y=(x=w.params)==null?void 0:x.count;return y?`${g} ${y}`:g}).join(", ")}const u=(n==="top"?t.top:t.bottom).match(new RegExp(`${r}:\\s*</span>\\s*([^<]+)`,"i"));return u?u[1].trim():r+" effect"}function bi(t,n,r){const i=t.turn;let s={...t,_logIndentLevel:0};const d=n==="Start",u=d?"_startPhaseEffectSnapshot":"_endPhaseEffectSnapshot",p=d?"_selectedStartEffectId":"_selectedEndEffectId",f=s[p];let h=s[u];h&&h.length>0&&(h.some(R=>s[i].lanes.flat().some(O=>O.id===R.cardId))||(h=void 0,s[u]=void 0)),h||(h=iw(s,i,n),s[u]=h);const w=d?s.processedStartEffectIds||[]:s.processedEndEffectIds||[],g=[];for(const V of h){if(w.includes(V.cardId))continue;const O=cw(s,i,V);O&&g.push({entry:V,card:O.card,laneIndex:O.laneIndex})}if(g.length===0)return s[u]=void 0,s[p]=void 0,{newState:s};let y;if(f&&(y=g.find(V=>V.entry.cardId===f),y||console.warn(`[processTriggeredEffects] Selected effect ${f} not found in valid effects!`),s[p]=void 0),!y){if(g.length>1){const V=g.map(({entry:R,card:O})=>({cardId:R.cardId,cardName:`${O.protocol}-${O.value}`,box:R.box,effectDescription:dw(O,R.box,n)}));return s.actionRequired={type:"select_phase_effect",actor:i,phase:n,availableEffects:V},{newState:s}}y=g[0]}const{entry:m,card:x,laneIndex:S}=y,E=i==="player"?"opponent":"player",j={cardOwner:i,actor:i,currentTurn:t.turn,opponent:E,triggerType:n==="Start"?"start":"end"},b=x,k=n==="Start"?"start":"end";if(b.customEffects){const V=m.box==="top"?b.customEffects.topEffects:b.customEffects.bottomEffects,R=(V==null?void 0:V.filter(O=>O.trigger===k))||[];if(R.length>0){const O=`${x.protocol}-${x.value}`,X=n==="Start"?"start":"end";s=Ze(s,O),s=et(s,X);const M={...s,_currentPhaseContext:void 0},$=te(M,i,`${n} effect triggers.`);s={...s,log:$.log},s=Ua(s);for(let B=0;B<R.length;B++){const I=R[B],D=ct(x,S,s,j,I);if(s=Ae(D.newState),s.actionRequired){const L=R.slice(B+1);return L.length>0&&(s._pendingCustomEffects={sourceCardId:x.id,laneIndex:S,context:j,effects:L,logSource:s._currentEffectSource,logPhase:s._currentPhaseContext,logIndentLevel:s._logIndentLevel||0}),d?s.processedStartEffectIds=[...s.processedStartEffectIds||[],x.id]:s.processedEndEffectIds=[...s.processedEndEffectIds||[],x.id],{newState:s}}}return d?s.processedStartEffectIds=[...s.processedStartEffectIds||[],x.id]:s.processedEndEffectIds=[...s.processedEndEffectIds||[],x.id],s=Mo(s),s=Ze(s,void 0),s=et(s,void 0),bi(s,n,r)}}const N=`${x.protocol}-${x.value}`,U=r[N];if(U){const V=`${x.protocol}-${x.value}`,R=n==="Start"?"start":"end";s=Ze(s,V),s=et(s,R);const O={...s,_currentPhaseContext:void 0},X=te(O,i,`${n} effect triggers.`);s={...s,log:X.log},s=Ua(s);const M=U(x,s,j);return s=Ae(M.newState),d?s.processedStartEffectIds=[...s.processedStartEffectIds||[],x.id]:s.processedEndEffectIds=[...s.processedEndEffectIds||[],x.id],s.actionRequired?{newState:s}:(s=Mo(s),s=Ze(s,void 0),s=et(s,void 0),bi(s,n,r))}return{newState:s}}function su(t){return bi(t,"Start",rw)}function Dm(t){return bi(t,"End",lw)}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const uw=t=>{if(!t.useControlMechanic)return t;const n=t.turn,r=n==="player"?"opponent":"player",i=t[n],s=t[r];let d=0;const u=i.laneValues[0],p=i.laneValues[1],f=i.laneValues[2],h=s.laneValues[0],w=s.laneValues[1],g=s.laneValues[2];if(u>h&&d++,p>w&&d++,f>g&&d++,d>=2&&t.controlCardHolder!==n){let y=Ze(t,void 0);return y=et(y,void 0),y={...y,_logIndentLevel:0},y=te(y,n,`${n==="player"?"Player":"Opponent"} gains the Control Component.`),{...y,controlCardHolder:n}}return t},ol=t=>{if(t.winner)return t;const n=t.turn;let r={...t};switch(r=Ze(r,void 0),r=et(r,void 0),r={...r,_logIndentLevel:0},t.phase){case"start":return r=su(r).newState,r.actionRequired?r:(r=Ze(r,void 0),r=et(r,void 0),r={...r,_logIndentLevel:0},r._startPhaseEffectSnapshot=void 0,{...r,phase:"control"});case"control":{const i=uw(r);let s=Ze(i,void 0);return s=et(s,void 0),s={...s,_logIndentLevel:0},{...s,phase:"compile"}}case"compile":{const i=Um(r,n);return i.length>0?{...r,compilableLanes:i}:(r=Ze(r,void 0),r=et(r,void 0),r={...r,_logIndentLevel:0},{...r,phase:"action",compilableLanes:[]})}case"action":return r=Ze(r,void 0),r=et(r,void 0),r={...r,_logIndentLevel:0},{...r,phase:"hand_limit"};case"hand_limit":{const i=r[n],s=i.lanes.some(p=>p.length>0&&p[p.length-1].isFaceUp&&p[p.length-1].protocol==="Spirit"&&p[p.length-1].value===0),u=bn(r).some(({rule:p,cardOwner:f})=>p.type==="skip_check_cache_phase"&&(p.target==="self"&&f===n||p.target==="all")&&f===n);if(s||u){let p=te(r,n,"Skipping Check Cache phase.");return p=Ze(p,void 0),p=et(p,void 0),p={...p,_logIndentLevel:0},{...p,phase:"end"}}if(i.hand.length>5){const p=i.hand.length-5;let h=te(r,n,`Check Cache: ${n==="player"?"Player":"Opponent"} has ${i.hand.length} cards, must discard ${p}.`);return h=Ua(h),{...h,actionRequired:{type:"discard",actor:n,count:p}}}return r=Ze(r,void 0),r=et(r,void 0),r={...r,_logIndentLevel:0},{...r,phase:"end"}}case"end":{const i={...r};r=Dm(r).newState;const s=i.actionRequired,d=r.actionRequired;if(d&&d!==s||r.queuedActions&&r.queuedActions.length>0&&(r=rl(r),r.actionRequired))return r;const u=n==="player"?"opponent":"player",p={...r[n],cannotCompile:!1};return r=Ze(r,void 0),r=et(r,void 0),r={...r,_logIndentLevel:0},r=Ae(r),{...r,[n]:p,turn:u,phase:"start",processedStartEffectIds:[],processedEndEffectIds:[],processedSpeed1TriggerThisTurn:!1,processedUncoverEventIds:[],_startPhaseEffectSnapshot:void 0,_endPhaseEffectSnapshot:void 0,_interruptedTurn:void 0,_interruptedPhase:void 0}}}return t};function tt(t){var p,f;const n=t._pendingCustomEffects;if(!n||n.effects.length===0)return t;console.log("[queuePendingCustomEffects] Queueing effects for sourceCardId:",n.sourceCardId,"effects:",(p=n.effects)==null?void 0:p.map(h=>{var w;return{id:h.id,action:(w=h.params)==null?void 0:w.action,hasConditional:!!h.conditional}}));const r=n.effects.map(h=>h.id).join(",");if((f=t.queuedActions)==null?void 0:f.some(h=>{var w;return h.type==="execute_remaining_custom_effects"&&h.sourceCardId===n.sourceCardId&&((w=h.effects)==null?void 0:w.map(g=>g.id).join(","))===r})){const h={...t};return delete h._pendingCustomEffects,h}const s=n.selectedCardFromPreviousEffect||t.lastCustomEffectTargetCardId,d={type:"execute_remaining_custom_effects",sourceCardId:n.sourceCardId,laneIndex:n.laneIndex,effects:n.effects,context:n.context,actor:n.context.cardOwner,selectedCardFromPreviousEffect:s,logSource:n.logSource,logPhase:n.logPhase,logIndentLevel:n.logIndentLevel},u={...t,queuedActions:[d,...t.queuedActions||[]]};return delete u._pendingCustomEffects,u}const Oa=t=>{var s,d;let n=tt(t);const r=n._pendingFollowUpEffect;if(r&&!n.actionRequired){const{followUpEffect:u,conditionalType:p,previousHandSize:f,sourceCardId:h,actor:w,savedIndentLevel:g}=r;delete n._pendingFollowUpEffect;const y=Ne(n,h);if(y){const m=w,x=n[m].hand.length,S=Math.max(0,(f||0)-x);if(p==="then"||p==="if_executed"&&S>0){const j=`${y.card.protocol}-${y.card.value}`;n=Ze(n,j),n=et(n,"middle"),g!==void 0&&(n={...n,_logIndentLevel:g});let b=-1;for(let k=0;k<n[y.owner].lanes.length;k++)if(n[y.owner].lanes[k].some(N=>N.id===h)){b=k;break}if(b!==-1){const k={cardOwner:y.owner,opponent:y.owner==="player"?"opponent":"player",currentTurn:n.turn,actor:m,discardedCount:S};if(n=ct(y.card,b,n,k,u).newState,n.actionRequired)return n}}}}if(!n.queuedActions||n.queuedActions.length===0){const u=n._deferredParentEffects;if(u&&u.length>0&&!n.actionRequired){const p=u[u.length-1],f=u.slice(0,-1),h={type:"execute_remaining_custom_effects",sourceCardId:p.sourceCardId,laneIndex:p.laneIndex,effects:p.effects,context:p.context,actor:p.actor||((s=p.context)==null?void 0:s.cardOwner),selectedCardFromPreviousEffect:p.selectedCardFromPreviousEffect,savedLastCustomEffectTargetCardId:p.savedLastCustomEffectTargetCardId,logSource:p.logSource,logPhase:p.logPhase,logIndentLevel:p.logIndentLevel};return Oa({...n,_deferredParentEffects:f.length>0?f:void 0,lastCustomEffectTargetCardId:p.savedLastCustomEffectTargetCardId||p.selectedCardFromPreviousEffect,queuedActions:[h]})}return n}let i=[...n.queuedActions];for(;i.length>0;){const u=i.shift();if(u.sourceCardId&&u.type!=="flip_self"){const p=Ne(n,u.sourceCardId);if(!p||!p.card.isFaceUp){const f=p?`${p.card.protocol}-${p.card.value}`:"a card",h=n._logSource;n=Ze(n,f),n=te(n,u.actor,"Queued effect was cancelled because the source is no longer active."),n=Ze(n,h);continue}}if(u.type==="flip_self"){const{sourceCardId:p,actor:f}=u,h=Ne(n,p),w=Oo(n,p);if(h&&h.card.isFaceUp&&w){const g=`${h.card.protocol}-${h.card.value}`;n=te(n,f,`${g}: Flips itself.`),n=mr(new Set([p]),n),n.animationState={type:"flipCard",cardId:p}}else{const g=h?`${h.card.protocol}-${h.card.value}`:"the source card",y=h?h.card.isFaceUp?"now covered":"flipped face-down":"deleted";n=te(n,f,`The self-flip effect from ${g} was cancelled because it is ${y}.`)}continue}if(u.type==="execute_follow_up_effect"){const{sourceCardId:p,followUpEffect:f,actor:h,logContext:w}=u,g=Ne(n,p),y=Oo(n,p);if(g&&g.card.isFaceUp&&y){const m=n[g.owner].lanes.find(k=>k.some(N=>N.id===p)),x=n[g.owner].lanes.indexOf(m),S={cardOwner:g.owner,actor:h,currentTurn:n.turn,opponent:g.owner==="player"?"opponent":"player"},E=(w==null?void 0:w.sourceCardName)||`${g.card.protocol}-${g.card.value}`,j=(w==null?void 0:w.phase)||(n.phase==="start"?"start":"end");if(n={...n,_logIndentLevel:(w==null?void 0:w.indentLevel)||1,_currentEffectSource:E,_currentPhaseContext:j},n=ct(g.card,x,n,S,f).newState,n.actionRequired)return n={...n,queuedActions:i},n}else{const m=g?`${g.card.protocol}-${g.card.value}`:"the source card",x=g?g.card.isFaceUp?"now covered":"flipped face-down":"deleted";n=te(n,h,`The follow-up effect from ${m} was cancelled because it is ${x}.`)}continue}if(u.type==="execute_conditional_followup"){const{sourceCardId:p,laneIndex:f,followUpEffect:h,context:w,actor:g}=u,y=[...n.player.lanes.flat(),...n.opponent.lanes.flat()].find(x=>x.id===p);if(!y){n=te(n,g,"Conditional follow-up effect skipped: source card no longer exists.");continue}if(!y.isFaceUp){const x=`${y.protocol}-${y.value}`;n=te(n,g,`Conditional follow-up effect from ${x} cancelled: card was flipped face-down.`);continue}const m=ct(y,f,n,w,h);if(n=Ae(m.newState),n.actionRequired)return h.conditional&&h.conditional.thenEffect&&(n.actionRequired={...n.actionRequired,followUpEffect:h.conditional.thenEffect,conditionalType:h.conditional.type}),n={...n,queuedActions:i},n;if(h.conditional&&h.conditional.thenEffect){const x=ct(y,f,n,w,h.conditional.thenEffect);if(n=Ae(x.newState),n.actionRequired)return n={...n,queuedActions:i},n}continue}if(u.type==="execute_remaining_custom_effects"){const{sourceCardId:p,laneIndex:f,effects:h,context:w,selectedCardFromPreviousEffect:g,logSource:y,logPhase:m,logIndentLevel:x}=u;console.log("[phaseManager] execute_remaining_custom_effects for sourceCardId:",p,"effects:",h==null?void 0:h.map(k=>{var N;return{id:k.id,action:(N=k.params)==null?void 0:N.action,hasConditional:!!k.conditional}})),y!==void 0&&(n={...n,_currentEffectSource:y}),m!==void 0&&(n={...n,_currentPhaseContext:m}),x!==void 0&&(n={...n,_logIndentLevel:x});const S=Ne(n,p);if(!S){n=te(n,w.cardOwner,"Remaining effects cancelled because the source card was deleted or returned.");continue}if(!S.card.isFaceUp){const k=`${S.card.protocol}-${S.card.value}`;n=te(n,w.cardOwner,`Remaining effects from ${k} cancelled because it was flipped face-down.`);continue}if(!hw(n,p)){const k=`${S.card.protocol}-${S.card.value}`;n=te(n,w.cardOwner,`Remaining effects from ${k} cancelled because it is now covered.`);continue}const j=u.savedLastCustomEffectTargetCardId;j&&(n.lastCustomEffectTargetCardId=j),g&&(n._selectedCardFromPreviousEffect=g,j||(n.lastCustomEffectTargetCardId=g));for(let k=0;k<h.length;k++){const N=h[k],U=ct(S.card,f,n,w,N);if(n=U.newState,U.animationRequests&&U.animationRequests.length>0&&!n.actionRequired){const V=h.slice(k+1);if(V.length>0){const O={type:"execute_remaining_custom_effects",sourceCardId:p,laneIndex:f,effects:V,context:w,actor:w.cardOwner,logSource:n._currentEffectSource,logPhase:n._currentPhaseContext,logIndentLevel:n._logIndentLevel||0};n.queuedActions=[O,...i||[]]}else n.queuedActions=i;const R=U.animationRequests[0];return R.type==="draw"?n.animationState={type:"drawCard",owner:R.player,cardIds:[]}:R.type==="play"?n.animationState={type:"playCard",cardId:R.cardId,owner:R.owner}:R.type==="delete"&&(n.animationState={type:"deleteCard",cardId:R.cardId,owner:R.owner}),n}if(n.actionRequired){const V=h.slice(k+1);if(V.length>0&&(n._pendingCustomEffects={sourceCardId:p,laneIndex:f,context:w,effects:V,logSource:n._currentEffectSource,logPhase:n._currentPhaseContext,logIndentLevel:n._logIndentLevel||0}),n._interruptedTurn){const R=n._interruptedTurn,O=n._interruptedPhase||n.phase;delete n._interruptedTurn,delete n._interruptedPhase,n.turn=R,n.phase=O}return n.queuedActions=i,n}}const b=n._deferredParentEffects;if(b&&b.length>0){const k=b[b.length-1],N=b.slice(0,-1);i=[{type:"execute_remaining_custom_effects",sourceCardId:k.sourceCardId,laneIndex:k.laneIndex,effects:k.effects,context:k.context,actor:k.actor||((d=k.context)==null?void 0:d.cardOwner),selectedCardFromPreviousEffect:k.selectedCardFromPreviousEffect,savedLastCustomEffectTargetCardId:k.savedLastCustomEffectTargetCardId,logSource:k.logSource,logPhase:k.logPhase,logIndentLevel:k.logIndentLevel},...i||[]],n={...n,_deferredParentEffects:N.length>0?N:void 0,lastCustomEffectTargetCardId:k.savedLastCustomEffectTargetCardId||k.selectedCardFromPreviousEffect}}continue}if(u.type==="reveal_opponent_hand"){const p=n.turn==="player"?"opponent":"player",f={...n[p]};if(f.hand.length>0){f.hand=f.hand.map(g=>({...g,isRevealed:!0})),n[p]=f;const h=Ne(n,u.sourceCardId),w=h?`${h.card.protocol}-${h.card.value}`:"A card effect";n=te(n,n.turn,`${w}: Opponent reveals their hand.`)}else{const h=Ne(n,u.sourceCardId),w=h?`${h.card.protocol}-${h.card.value}`:"A card effect";n=te(n,n.turn,`${w}: Opponent has no cards to reveal.`)}continue}if(u.type==="pending_uncover_effect"){const{owner:p,laneIndex:f}=u;if(n=Xn(n,p,f).newState,n.actionRequired)return n.queuedActions=i,n;continue}if(u.type==="discard"&&u.actor){const p=u.actor,f=n[p].hand.length,h=u.count||1;if(f===0){const w=p==="player"?"Player":"Opponent";if(u.sourceCardId){const g=Ne(n,u.sourceCardId);if(g){const y=`${g.card.protocol}-${g.card.value}`;n=Ze(n,y),n=et(n,"middle");const m=u._savedIndentLevel;m!==void 0&&(n={...n,_logIndentLevel:m})}}n=te(n,p,`${w} has no cards to discard - effect skipped.`),n=Ze(n,void 0),n=et(n,void 0),n={...n,_logIndentLevel:0};continue}else typeof h=="number"&&f<h&&(u.count=f)}return n.actionRequired=u,n.queuedActions=i,n}return{...n,queuedActions:[],actionRequired:null}},rl=t=>{var d;if(t.winner||t.actionRequired)return t;const n=t._deferredParentEffects&&t._deferredParentEffects.length>0;if(t.queuedActions&&t.queuedActions.length>0||n){const u=Oa(t);if(u.actionRequired)return u;t=u}if(t._interruptedTurn){const u=t._interruptedTurn,p=t._interruptedPhase||t.phase;let f={...t};if(delete f._interruptedTurn,delete f._interruptedPhase,f.turn=u,f.phase=p,p==="start"||p==="end"){if(f.queuedActions&&f.queuedActions.length>0&&(f=Oa(f)),!f.actionRequired&&p==="end"){const h=Dm(f).newState;if(h.actionRequired)return h;const w=h.turn==="player"?"opponent":"player",g={...h[h.turn],cannotCompile:!1};let y=Ze(h,void 0);return y=et(y,void 0),y={...y,_logIndentLevel:0},y=Ae(y),{...y,[h.turn]:g,turn:w,phase:"start",processedStartEffectIds:[],processedEndEffectIds:[],processedSpeed1TriggerThisTurn:!1,processedUncoverEventIds:[],_startPhaseEffectSnapshot:void 0,_endPhaseEffectSnapshot:void 0,_interruptedTurn:void 0,_interruptedPhase:void 0}}if(p==="start"&&!f.actionRequired){const h=su(f).newState;if(h.actionRequired)return h;let w={...h,phase:"control"};return nl(w)}return f}t=f}if(((d=t.actionRequired)==null?void 0:d.type)==="prompt_rearrange_protocols"&&t.actionRequired.originalAction){const u=t.actionRequired.originalAction;let p={...t,actionRequired:null,controlCardHolder:null};if(u.type==="compile")return nl(p);if(u.type==="fill_hand"){const f=gr(p,p.turn,5-p[p.turn].hand.length);return nl(f)}}if(t.queuedEffect){const{card:u,laneIndex:p}=t.queuedEffect,f={...t,queuedEffect:void 0,_committedCardId:void 0},h=Ne(f,u.id);if(h){const{card:w,owner:g}=h;let y={...f,_logIndentLevel:0};const m={cardOwner:g,actor:g,currentTurn:y.turn,opponent:g==="player"?"opponent":"player",triggerType:"play"},{newState:x}=cl(w,p,y,m);if(x.actionRequired)return x;t=x}else console.warn(`Skipping queued effect for ${u.protocol}-${u.value} as it is no longer on the board.`),t=te(t,t.turn,`Skipping queued effect for ${u.protocol}-${u.value} as it is no longer on the board.`),t=f}if(t.queuedActions&&t.queuedActions.length>0){let u={...t},p=[...u.queuedActions];for(;p.length>0;){const f=p.shift(),h=f.type==="flip_self";if(f.sourceCardId&&!h){const w=Ne(u,f.sourceCardId);if(!w||!w.card.isFaceUp){const g=w?`${w.card.protocol}-${w.card.value}`:"a card",y=u._logSource;u=Ze(u,g),u=te(u,f.actor,"Queued effect was cancelled because the source is no longer active."),u=Ze(u,y);continue}}if(h){const{sourceCardId:w,actor:g}=f,y=Ne(u,w),m=Oo(u,w);if(y&&y.card.isFaceUp&&m){const x=`${y.card.protocol}-${y.card.value}`;u=te(u,g,`${x}: Flips itself.`),u=mr(new Set([w]),u),u.animationState={type:"flipCard",cardId:w}}else{const x=y?`${y.card.protocol}-${y.card.value}`:"the source card",S=y?y.card.isFaceUp?"now covered":"flipped face-down":"deleted";u=te(u,g,`The self-flip effect from ${x} was cancelled because it is ${S}.`)}continue}if(f.type==="reveal_opponent_hand"){const w=u.turn==="player"?"opponent":"player",g={...u[w]};if(g.hand.length>0){g.hand=g.hand.map(x=>({...x,isRevealed:!0})),u[w]=g;const y=Ne(u,f.sourceCardId),m=y?`${y.card.protocol}-${y.card.value}`:"A card effect";u=te(u,u.turn,`${m}: Opponent reveals their hand.`)}else{const y=Ne(u,f.sourceCardId),m=y?`${y.card.protocol}-${y.card.value}`:"A card effect";u=te(u,u.turn,`${m}: Opponent has no cards to reveal.`)}continue}if(f.type==="discard"&&f.actor){const w=f.actor,g=u[w].hand.length,y=f.count||1;if(g===0){const m=w==="player"?"Player":"Opponent";if(f.sourceCardId){const x=Ne(u,f.sourceCardId);if(x){const S=`${x.card.protocol}-${x.card.value}`;u=Ze(u,S),u=et(u,"middle");const E=f._savedIndentLevel;E!==void 0&&(u={...u,_logIndentLevel:E})}}u=te(u,w,`${m} has no cards to discard - effect skipped.`),u=Ze(u,void 0),u=et(u,void 0),u={...u,_logIndentLevel:0};continue}else typeof y=="number"&&g<y&&(f.count=g)}return u.actionRequired=f,u.queuedActions=p,u}t={...u,queuedActions:[],actionRequired:null}}const r=t.phase==="action"?"hand_limit":t.phase;let i={...t,phase:r,compilableLanes:[],processedUncoverEventIds:[]};const s=t.turn;for(;i.turn===s&&!i.winner;){const u=i.actionRequired,p=i.phase;i=ol(i);const f=i.actionRequired;if(f&&f!==u)break;if(i.phase===p&&i.turn===s){console.error("Game is stuck in a phase loop:",i.phase);break}}return i},nl=t=>{if(t.winner)return t;let n={...t};if(n._interruptedTurn){const i=n._interruptedTurn,s=n._interruptedPhase||n.phase;delete n._interruptedTurn,delete n._interruptedPhase,n.turn=i,n.phase=s}const r=n.turn;for(;n.turn===r&&!n.actionRequired&&!n.winner;){const i=n.phase;if(i==="action")break;if(i==="compile"){const d=Um(n,r);if(d.length>0){n={...n,compilableLanes:d};break}}const s=n.phase;if(n=ol(n),s===n.phase&&!n.actionRequired){console.error("Game is stuck in an automatic phase loop:",s),console.error("State:",{phase:n.phase,turn:n.turn,actionRequired:n.actionRequired,queuedActions:n.queuedActions,interruptedTurn:n._interruptedTurn});break}}return{...n,animationState:null}},$m=t=>{let n={...t,actionRequired:null};if(n._interruptedTurn)return rl(n);const r=n._deferredParentEffects&&n._deferredParentEffects.length>0;if(n.queuedActions&&n.queuedActions.length>0||r){const d=Oa(n);if(d.actionRequired)return d;n=d}const i=su(n).newState;if(i.actionRequired)return i;let s=i;return s.phase!=="control"&&(s={...s,phase:"control"}),s=ol(s),s.actionRequired||(s=ol(s)),s},qm=t=>{if(t.winner)return t;let n={...t,phase:"start"};return n=Ae(n),n=ol(n),n.actionRequired?n:nl(n)},im=Object.freeze(Object.defineProperty({__proto__:null,advancePhase:ol,continueTurnAfterStartPhaseAction:$m,continueTurnProgression:nl,processEndOfAction:rl,processQueuedActions:Oa,processStartOfTurn:qm,queuePendingCustomEffects:tt},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * AI Card Memory - Tracks known values of face-down cards
 *
 * The AI can remember card values when:
 * 1. AI plays its own card face-down (AI knows what's in its hand)
 * 2. A face-up card is flipped to face-down (the value was visible)
 * 3. A card is revealed (Psychic effects, etc.)
 *
 * This allows the AI to make smarter decisions about flipping cards.
 */function Im(t,n,r){const i=t.aiCardMemory||{};return{...t,aiCardMemory:{...i,[n]:r}}}function cm(t,n){return t.aiCardMemory?t.aiCardMemory[n]??null:null}function pw(t,n){return Im(t,n.id,n.value)}function Ci(t,n){return n.isFaceUp?Im(t,n.id,n.value):t}function fw(t){if(!t.aiCardMemory)return t;const n=new Set;for(const i of["player","opponent"])for(const s of t[i].lanes)for(const d of s)n.add(d.id);const r={};for(const[i,s]of Object.entries(t.aiCardMemory))n.has(i)&&(r[i]=s);return{...t,aiCardMemory:r}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function Ne(t,n){if(!n)return null;for(const r of["player","opponent"])for(let i=0;i<t[r].lanes.length;i++){const d=t[r].lanes[i].find(u=>u.id===n);if(d)return{card:d,owner:r,laneIndex:i}}return null}function Oo(t,n){var i;if(!n)return!1;const r=t._committedCardId;for(const s of["player","opponent"])for(const d of t[s].lanes){if(d.length===0)continue;let u=d.length-1;const p=d[d.length-1].id;if(r&&d.length>=2&&p===r&&n!==r&&(u=d.length-2),((i=d[u])==null?void 0:i.id)===n)return!0}return!1}function hw(t,n){if(!n)return!1;for(const r of["player","opponent"])for(const i of t[r].lanes)if(i.length!==0&&i[i.length-1].id===n)return!0;return!1}function Ho(t,n){return n?t._committedCardId===n:!1}function Vo(t,n,r){if(n.length===0||r<0||r>=n.length)return!1;const i=t._committedCardId;let s=n.length-1;return i&&n.length>=2&&n[n.length-1].id===i&&(s=n.length-2),r===s}function mw(t,n,r,i){var f;let s={...t};const d=i||((f=t.actionRequired)==null?void 0:f.followUpEffect),u=Ne(s,n),p=u?fn(u.card,s[u.owner].lanes.find(h=>h.some(w=>w.id===n))||[]):0;if(s=tt(s),s.actionRequired=null,d&&r){const h=Ne(s,r);if(h){const w={cardOwner:h.owner,opponent:h.owner==="player"?"opponent":"player",currentTurn:s.turn,actor:h.owner,referencedCard:u==null?void 0:u.card,referencedCardValue:p};let g=-1;for(let y=0;y<s[h.owner].lanes.length;y++)if(s[h.owner].lanes[y].some(m=>m.id===r)){g=y;break}if(g!==-1)return ct(h.card,g,s,w,d).newState}}return s}function yw(t,n,r,i){var m,x,S,E,j;let s={...t};const d=(m=t.actionRequired)==null?void 0:m.followUpEffect,u=(x=t.actionRequired)==null?void 0:x.conditionalType;if(s=tt(s),s.actionRequired=null,i&&(s=Mo(s)),d&&i){const b=Ne(s,i);if(b){const k=((S=t.actionRequired)==null?void 0:S.previousHandSize)||0,N=s[n].hand.length,U=Math.max(0,k-N);if(!(u==="then"||u==="if_executed"&&U>0))return s;const R={cardOwner:b.owner,opponent:b.owner==="player"?"opponent":"player",currentTurn:s.turn,actor:n,discardedCount:U,previousHandSize:k};let O=-1;for(let X=0;X<s[b.owner].lanes.length;X++)if(s[b.owner].lanes[X].some(M=>M.id===i)){O=X;break}if(O!==-1)return ct(b.card,O,s,R,d).newState}return s}if(!r||!i)return s;const p=((E=t.actionRequired)==null?void 0:E.previousHandSize)||0,f=s[n].hand.length;if(Math.max(0,p-f)===0)return s;const w=(j=Ne(s,i))==null?void 0:j.card;w&&`${w.protocol}${w.value}`;const g=s.queuedActions&&s.queuedActions.length>0;let y=null;switch(r){case"fire_1":y={type:"select_cards_to_delete",count:1,sourceCardId:i,disallowedIds:[i],actor:n};break;case"fire_2":y={type:"select_card_to_return",sourceCardId:i,actor:n};break;case"fire_3":y={type:"select_card_to_flip",sourceCardId:i,actor:n,targetFilter:{position:"uncovered",excludeSelf:!0}};break}if(y)if(g){const b=s.queuedActions||[],k=b.filter(U=>U.type==="select_card_to_shift"&&U.followUpEffect),N=b.filter(U=>!(U.type==="select_card_to_shift"&&U.followUpEffect));s.queuedActions=[...N,y,...k]}else s.actionRequired=y;return s}function Bd(t,n,r=null){const i=Ne(t,n);if(!i)return t;const{card:s,owner:d}=i;if(!s.isFaceUp){let E=-1;for(let j=0;j<t[d].lanes.length;j++)if(t[d].lanes[j].some(b=>b.id===n)){E=j;break}if(E!==-1&&!ew(t,E).allowed)return t}let p=dt(t,"on_flip",{player:d,cardId:n}).newState;if(!Ne(p,n))return p;const h=p.actionRequired&&"actor"in p.actionRequired?p.actionRequired.actor:p.turn,w=h==="player"?"Player":"Opponent",g=d==="player"?"Player's":"Opponent's",y=s.isFaceUp?"face-down":"face-up",m=`${s.protocol}-${s.value}`;p=te(p,h,`${w} flips ${g} ${m} ${y}.`);const x={...p.stats[h],cardsFlipped:p.stats[h].cardsFlipped+1},S={...p[h],stats:x};return p={...p,[h]:S,stats:{...p.stats,[h]:x}},s.isFaceUp&&(p=Ci(p,s)),p=mr(new Set([n]),p),p.animationState={type:"flipCard",cardId:n},p.actionRequired=r,p}function Xn(t,n,r){var u;const i=t[n].lanes[r];if(i.length===0)return{newState:t};const s=i[i.length-1],d=Oo(t,s.id);if(s.isFaceUp&&d){const p=`${s.id}-${r}`;if((u=t.processedUncoverEventIds)!=null&&u.includes(p))return{newState:t};const f={source:t._currentEffectSource,phase:t._currentPhaseContext,indentLevel:t._logIndentLevel||0},h=`${s.protocol}-${s.value}`;let w=Ze(t,h);w=et(w,"uncover"),w=te(w,n,`${s.protocol}-${s.value} is uncovered and its effects are re-triggered.`),w.processedUncoverEventIds=[...w.processedUncoverEventIds||[],p];const g={cardOwner:n,actor:n,currentTurn:w.turn,opponent:n==="player"?"opponent":"player",triggerType:"uncover"},y=cl(s,r,w,g);if(y.newState.actionRequired||(y.newState={...y.newState,_currentEffectSource:f.source,_currentPhaseContext:f.phase,_logIndentLevel:f.indentLevel}),y.newState.actionRequired){const m=y.newState.actionRequired.actor;if(t._interruptedTurn&&m===t._interruptedTurn){const x=y.newState.actionRequired;return y.newState.actionRequired=null,y.newState.queuedActions=[...y.newState.queuedActions||[],x],y.newState=tt(y.newState),y}y.newState=tt(y.newState),m!==t.turn&&(y.newState._interruptedTurn=t.turn,y.newState._interruptedPhase=t.phase,y.newState.turn=m,y.newState.actionRequired.type==="prompt_rearrange_protocols"&&(y.newState.actionRequired={...y.newState.actionRequired,originalAction:{type:"resume_interrupted_turn",interruptedTurn:t.turn,interruptedPhase:t.phase}}))}else y.newState._interruptedTurn&&(y.newState.turn=y.newState._interruptedTurn,y.newState._interruptedTurn=void 0,y.newState._interruptedPhase=void 0);return y}return{newState:t}}function gw(t,n,r){var i,s;for(const d of["player","opponent"])for(const u of t[d].lanes)for(const p of u){if(!p.isFaceUp)continue;const f=p.customEffects;if(!f)continue;const h=f.bottomEffects||[];for(const w of h){if(w.trigger!=="when_card_returned"||((i=w.params)==null?void 0:i.action)!=="redirect_return_to_deck")continue;const g=((s=w.params)==null?void 0:s.targetOwner)||"opponent",y=d;if(g==="opponent"&&n!==y||g==="own"&&n===y)return p}}return null}function Gd(t,n,r){const i=Ne(t,n);if(!i)return{newState:t};const{card:s,owner:d}=i,u=t[d].lanes.findIndex(U=>U.some(V=>V.id===s.id));if(u===-1)return{newState:t};const p=t[d].lanes[u],f=p.length>0&&p[p.length-1].id===n;let h={...t};const w=h.actionRequired&&"actor"in h.actionRequired?h.actionRequired.actor:h.turn,g=w==="player"?"Player":"Opponent",y=d==="player"?"Player's":"Opponent's",m=`${s.protocol}-${s.value}`,x=r||"owner_hand",S=x==="actor_hand"?w:d,E=x==="owner_hand"?gw(t,d):null,j={...h[d]};if(j.lanes=j.lanes.map(U=>U.filter(V=>V.id!==n)),h[d]=j,E){const U={...s,isFaceUp:!1,isRevealed:!1},V={...h[d]};V.deck=[U,...V.deck],h[d]=V;const R=`${E.protocol}-${E.value}`;h=te(h,w,`${R}: ${y} ${m} is put on top of their deck face-down instead of returning to hand.`)}else if(x==="actor_hand"&&w!==d){const U={...h[S]};U.hand=[...U.hand,{...s,isFaceUp:!0,isRevealed:!1}],h[S]=U,h=te(h,w,`${g} takes ${y} ${m} and puts it into their hand.`)}else{const U={...h[S]};U.hand=[...U.hand,{...s,isFaceUp:!0,isRevealed:!1}],h[S]=U,h=te(h,w,`${g} returns ${y} ${m} to their hand.`)}h=tt(h);const b={...h.stats[w],cardsReturned:h.stats[w].cardsReturned+1},k={...h[w],stats:b};h={...h,[w]:k},h.actionRequired=null;const N=Ae(h);return f&&N[d].lanes[u].length>0?Xn(N,d,u):{newState:N}}function Uo(t,n,r,i,s){const d=Ne(t,n);if(!d||d.owner!==r)return{newState:t};const{card:u}=d,p=t[r];let f=-1;for(let T=0;T<p.lanes.length;T++)if(p.lanes[T].some(q=>q.id===n)){f=T;break}if(f===-1)return{newState:t};if(f===i)return{newState:t};if(!as(t,f,i).allowed)return{newState:t};const w=t[r].lanes[f],g=w.length>0&&w[w.length-1].id===n,y=p.lanes.map((T,q)=>q===f?T.filter(P=>P.id!==n):T),m=y[i].length>0?y[i][y[i].length-1]:null;let x={...t,[r]:{...p,lanes:y}};x._committedCardId=n;const S=y.map((T,q)=>q===i?[...T,u]:T),E={...p,lanes:S};let j={...x,[r]:E};(!t._currentEffectSource||!t._currentPhaseContext)&&(j=Ze(j,void 0),j=et(j,void 0));const b=s==="player"?"Player":"Opponent",k=r==="player"?"Player's":"Opponent's",N=u.isFaceUp?`${u.protocol}-${u.value}`:"a card",U=j[r].protocols[i];j=te(j,s,`${b} shifts ${k} ${N} to Protocol ${U}.`);const V={...j.stats[s],cardsShifted:j.stats[s].cardsShifted+1},R={...j[s],stats:V};j={...j,[s]:R,stats:{...j.stats,[s]:V}},j=tt(j),j.actionRequired=null;let O=Ae(j),X={newState:O};if(m){m.customEffects;const T={cardOwner:r,actor:s,currentTurn:O.turn,opponent:r==="player"?"opponent":"player",triggerType:"cover"};X=lu(m,i,O,T)}let M=X.newState,$=[...X.animationRequests||[]];if(g){const T=Xn(M,r,f);M=T.newState,T.animationRequests&&$.push(...T.animationRequests)}const B=M[r].lanes[i],I=B.length>0&&B[B.length-1].id===n,D=!g;if(I&&u.isFaceUp&&D){const T=Xn(M,r,i);T.animationRequests&&$.push(...T.animationRequests);let q=T.newState;return!q.actionRequired&&(!q.queuedActions||q.queuedActions.length===0)&&(q._committedCardId=void 0),{newState:q,animationRequests:$.length>0?$:void 0}}let L=M;return!L.actionRequired&&(!L.queuedActions||L.queuedActions.length===0)&&(L._committedCardId=void 0),{newState:L,animationRequests:$.length>0?$:void 0}}const vw=(t,n,r)=>{let i=0;for(const s of["player","opponent"])for(let d=0;d<t[s].lanes.length;d++){const u=t[s].lanes[d];if(u.length>0){const p=u[u.length-1];n.includes(p.id)||i++}}return i},Yd=(t,n)=>{var w;const r=Ne(t,n);if(!r)return{newState:t};const{card:i,owner:s}=r,d=t[s].lanes.findIndex(g=>g.some(y=>y.id===i.id));if(d===-1)return{newState:t};let u=t;const p=t._pendingCustomEffects;p&&((w=p.effects)==null?void 0:w.length)>0&&p.effects.some(y=>y.useCardFromPreviousEffect)&&(u={...t,_pendingCustomEffects:{...p,selectedCardFromPreviousEffect:n}});const f={cardOwner:s,actor:s,currentTurn:u.turn,opponent:s==="player"?"opponent":"player",triggerType:"flip"},h=cl(i,d,u,f);if(h.newState.actionRequired){h.newState=tt(h.newState);const g=h.newState.actionRequired.actor;if(t._interruptedTurn&&g===t._interruptedTurn)return h.newState.queuedActions=[...h.newState.queuedActions||[],h.newState.actionRequired],h.newState=tt(h.newState),h.newState.actionRequired=null,h;g!==t.turn&&(h.newState._interruptedTurn=t.turn,h.newState._interruptedPhase=t.phase,h.newState.turn=g,h.newState.actionRequired.type==="prompt_rearrange_protocols"&&(h.newState.actionRequired={...h.newState.actionRequired,originalAction:{type:"resume_interrupted_turn",interruptedTurn:t.turn,interruptedPhase:t.phase}}))}return h};function _w(t,n){const r=[];if(t[n].lanes.forEach((s,d)=>{if(s.length>0){const u=s[s.length-1],p=fn(u,s);r.push({card:u,laneIndex:d,owner:n,value:p})}}),r.length===0)return[];const i=Math.max(...r.map(s=>s.value));return r.filter(s=>s.value===i)}function os(t){const n=new Set;for(const r of["player","opponent"])for(const i of t[r].lanes)for(const s of i)s.isFaceUp&&n.add(s.protocol);return n.size}function ww(t,n){const r=new Set;for(const i of["player","opponent"]){const s=t[i].lanes[n];if(s)for(const d of s)d.isFaceUp&&r.add(d.protocol)}return r.size}function iu(t,n,r){let i=0;for(const s of["player","opponent"])for(const d of t[s].lanes)for(const u of d)if(u.isFaceUp&&u.protocol===n){if(r&&u.id===r)continue;i++}return i}function rs(t,n){return iu(t,n.protocol,n.id)>0}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Draw Effect Executor
 *
 * Handles all draw-related effects.
 * Extracted 1:1 from effectInterpreter.ts for modularity.
 */function dm(t,n,r){const i=Math.min(r,t.length),s=t.slice(0,i).map(p=>({...p,id:st(),isFaceUp:!0})),d=[...n,...s],u=t.slice(i);return{drawnCards:d,remainingDeck:u,newCards:s}}function xw(t,n,r,i,s){var N,U,V,R,O,X,M,$,B,I;const d=s._conditional,{cardOwner:u}=i,f=(s.target||"self")==="opponent"?i.opponent:u,h=ru(r,f);if(!h.allowed)return{newState:te(r,u,h.reason||"Cannot draw cards.")};if(s.conditional){let D=0;switch(s.conditional.type){case"non_matching_protocols":{for(let Q=0;Q<3;Q++){const ee=r.player.protocols[Q],oe=r.opponent.protocols[Q],me=r.player.lanes[Q].filter(K=>K.isFaceUp),ke=r.opponent.lanes[Q].filter(K=>K.isFaceUp);[...me,...ke].some(K=>K.protocol!==ee&&K.protocol!==oe)&&D++}break}case"count_face_down":{let Q=0;for(const ee of["player","opponent"])for(const oe of r[ee].lanes)Q+=oe.filter(me=>!me.isFaceUp).length;D=Q;break}case"is_covering":{D=r[u].lanes[n].length>1?s.count||1:0;break}case"same_protocol_on_field":{rs(r,t)?D=s.count||1:D=0;break}}let L=D;if(L<=0)return{newState:r};const{drawnCards:T,remainingDeck:q,newCards:P}=dm(r[f].deck,r[f].hand,L);let Z={...r};if(Z[f]={...Z[f],deck:q,hand:T},Z.detailedGameStats&&P.length>0){const Q=f==="player"?"playerFromEffect":"aiFromEffect";Z={...Z,detailedGameStats:{...Z.detailedGameStats,cardsDrawn:{...Z.detailedGameStats.cardsDrawn,[Q]:Z.detailedGameStats.cardsDrawn[Q]+P.length}}}}const G=f==="player"?"Player":"Opponent";let A="";switch(s.conditional.type){case"non_matching_protocols":A=" from non-matching protocols";break;case"is_covering":A=" (this card is covering another)";break;case"count_face_down":A=" (for face-down cards)";break;default:A=""}const W=P.length>0&&f==="player"?` (${P.map(Q=>`${Q.protocol}-${Q.value}`).join(", ")})`:"";Z=te(Z,f,`${G} draws ${L} card${L!==1?"s":""}${A}${W}.`),L>0&&(Z=dt(Z,"after_draw",{player:f}).newState,Z=dt(Z,"after_opponent_draw",{player:f==="player"?"opponent":"player"}).newState);const J=L>0?[{type:"draw",player:f,count:L}]:void 0;return{newState:Z,animationRequests:J}}let w=s.count||1;const g=s.countType||"fixed";switch(g){case"equal_to_card_value":{const D=r.lastCustomEffectTargetCardId;if(D){const L=Ne(r,D);if(L){const T=L.owner,q=r[T].lanes.find(P=>P.some(Z=>Z.id===D))||[];w=fn(L.card,q)}else if(r.lastCustomEffectTargetValue!==void 0)w=r.lastCustomEffectTargetValue;else return w=0,{newState:te(r,u,"Cannot draw cards - referenced card is no longer available.")}}else r.lastCustomEffectTargetValue!==void 0?w=r.lastCustomEffectTargetValue:w=i.referencedCardValue||0;break}case"equal_to_discarded":w=(i.discardedCount||0)+(s.countOffset||0);break;case"hand_size":case"previous_hand_size":w=i.previousHandSize||i.handSize||0;break;case"count_face_down":{let D=0;for(const L of["player","opponent"])for(const T of r[L].lanes)D+=T.filter(q=>!q.isFaceUp).length;w=D*(s.count||1);break}case"all_matching":{if(((N=s.valueFilter)==null?void 0:N.equals)!==void 0){const D=s.valueFilter.equals;w=r[f].deck.filter(T=>T.value===D).length}else w=0;break}case"equal_to_unique_protocols_in_lane":{w=ww(r,n);break}case"count_own_protocol_cards_on_field":{w=iu(r,t.protocol);break}case"fixed":default:w=s.count||1;break}if(w<=0)return{newState:r};if(((U=s.advancedConditional)==null?void 0:U.type)==="protocol_match"){const D=s.advancedConditional.protocol;if(r[u].protocols[n]!==D)return{newState:r}}if(((V=s.advancedConditional)==null?void 0:V.type)==="empty_hand"&&r[f].hand.length>0)return{newState:r};if(((R=s.advancedConditional)==null?void 0:R.type)==="opponent_higher_value_in_lane"){const D=u==="player"?"opponent":"player",L=pa(r,u,n);if(pa(r,D,n)<=L)return{newState:r}}if(((O=s.advancedConditional)==null?void 0:O.type)==="same_protocol_on_field"&&!rs(r,t))return{newState:r};let y={...r};if(((X=s.advancedConditional)==null?void 0:X.type)==="compile_block"){const D=s.advancedConditional.turnDuration||1,L=u==="player"?"opponent":"player";y={...y,compileBlockedUntilTurn:(y.turnNumber||0)+D,compileBlockedPlayer:L},y=te(y,u,`Opponent can't compile for ${D} turn${D!==1?"s":""}.`)}if(s.optional)return y.actionRequired={type:"prompt_optional_draw",sourceCardId:t.id,actor:u,count:w,drawingPlayer:f,followUpEffect:d==null?void 0:d.thenEffect,conditionalType:d==null?void 0:d.type,logSource:r._currentEffectSource,logPhase:r._currentPhaseContext,logIndentLevel:r._logIndentLevel||0},{newState:y};const m=s.source;let x;m==="opponent_deck"?x=i.opponent:m==="own_deck"?x=u:x=f;let S,E,j=[];if(g==="all_matching"&&((M=s.valueFilter)==null?void 0:M.equals)!==void 0){const D=s.valueFilter.equals,L=y[x].deck,T=L.filter(P=>P.value===D),q=L.filter(P=>P.value!==D);j=T.map(P=>({...P,id:st(),isFaceUp:!0})),S=[...y[f].hand,...j],E=q}else if((($=s.valueFilter)==null?void 0:$.equals)!==void 0&&s.fromRevealed){const D=s.valueFilter.equals,L=y[x].deck,T=L.filter(q=>q.value===D);if(T.length===0){const q=`${t.protocol}-${t.value}`;y=te(y,f,`${q}: No cards with value ${D} in deck.`),S=y[f].hand,E=L,j=[]}else return y.actionRequired={type:"select_card_from_revealed_deck",sourceCardId:t.id,actor:f,count:w,valueFilter:D,revealedCards:L,selectableCardIds:T.map(q=>q.id||`deck-${L.indexOf(q)}`)},{newState:y}}else if(((B=s.valueFilter)==null?void 0:B.equals)!==void 0){const D=s.valueFilter.equals,L=[...y[x].deck],T=[];for(let Z=0;Z<L.length&&T.length<w;Z++)L[Z].value===D&&T.push(Z);const q=T.map(Z=>L[Z]),P=L.filter((Z,G)=>!T.includes(G));j=q.map(Z=>({...Z,id:st(),isFaceUp:!0})),S=[...y[f].hand,...j],E=P}else if(((I=s.protocolFilter)==null?void 0:I.type)==="same_as_source"){const D=y[x].deck,L=t.protocol,T=[];return D.forEach((q,P)=>{q.protocol===L&&T.push(P)}),y.actionRequired={type:"reveal_deck_draw_protocol",sourceCardId:t.id,actor:f,revealedCards:D,targetProtocol:L,autoSelectedIndices:T,shuffleAfter:s.shuffleAfter||!1},{newState:y}}else{const D=dm(y[x].deck,y[f].hand,w);S=D.drawnCards,E=D.remainingDeck,j=D.newCards}if(y[x]={...y[x],deck:E},y[f]={...y[f],hand:S},y.detailedGameStats&&j.length>0){const D=f==="player"?"playerFromEffect":"aiFromEffect";y={...y,detailedGameStats:{...y.detailedGameStats,cardsDrawn:{...y.detailedGameStats.cardsDrawn,[D]:y.detailedGameStats.cardsDrawn[D]+j.length}}}}const b=f==="player"?"Player":"Opponent";if(j.length===0)return m==="opponent_deck"?y=te(y,f,`${x==="player"?"Player's":"Opponent's"} deck is empty. No cards drawn.`):m==="own_deck"&&f!==u?y=te(y,f,`${u==="player"?"Player's":"Opponent's"} deck is empty. No cards drawn.`):y=te(y,f,"Deck is empty. No cards drawn."),{newState:y};const k=j.length>0&&f==="player"?` (${j.map(D=>`${D.protocol}-${D.value}`).join(", ")})`:"";if(m==="opponent_deck"){const D=x==="player"?"Player's":"Opponent's";y=te(y,f,`${b} draws the top ${w===1?"card":`${w} cards`} of ${D} deck${k}.`)}else if(m==="own_deck"&&f!==u){const D=u==="player"?"Player's":"Opponent's";y=te(y,f,`${b} draws the top ${w===1?"card":`${w} cards`} of ${D} deck${k}.`)}else y=te(y,f,`${b} draws ${w} card${w!==1?"s":""}${k}.`);if(S.length>0&&(y=dt(y,"after_draw",{player:f,count:S.length}).newState,y=dt(y,"after_opponent_draw",{player:f==="player"?"opponent":"player",count:S.length}).newState),s.revealFromDrawn&&j.length>0){const D=s.revealFromDrawn.valueSource||"stated_number",L=s.revealFromDrawn.count||1;let T=j;if(D==="stated_number"){const P=y.lastStatedNumber;P===void 0?y=te(y,f,"No number was stated. Cannot filter drawn cards."):T=j.filter(Z=>Z.value===P)}const q=L==="all"?T.length:Math.min(L,T.length);return y.actionRequired={type:"select_from_drawn_to_reveal",actor:f,sourceCardId:t.id,allDrawnCardIds:j.map(P=>P.id),eligibleCardIds:T.map(P=>P.id),revealCount:q,statedNumber:D==="stated_number"?y.lastStatedNumber:void 0,thenAction:s.revealFromDrawn.thenAction},{newState:y}}return{newState:y}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Flip Effect Executor
 *
 * Handles all flip-related effects.
 * Extracted 1:1 from effectInterpreter.ts for modularity.
 */function Cw(t,n,r,i,s){var j,b,k,N,U,V,R;const{cardOwner:d}=i,u=s._conditional;if(((j=s.advancedConditional)==null?void 0:j.type)==="same_protocol_on_field"&&!rs(r,t))return{newState:r};if(s.useCardFromPreviousEffect&&r.lastCustomEffectTargetCardId){const O=r.lastCustomEffectTargetCardId,X=Ne(r,O);if(!X)return{newState:te(r,d,"Target card from previous effect no longer exists. Flip skipped.")};let M={...r};const $=X.owner,B=M[$].lanes.findIndex(I=>I.some(D=>D.id===O));if(B!==-1){const D=M[$].lanes[B].find(L=>L.id===O);if(D){s.skipMiddleCommand&&!D.isFaceUp&&(M.skipNextMiddleCommand=O),D.isFaceUp&&(M=Ci(M,D)),D.isFaceUp=!D.isFaceUp;const L=D.isFaceUp?"face-up":"face-down",T=s.skipMiddleCommand&&D.isFaceUp?", ignoring its middle commands":"";M=te(M,d,`Flips that card ${L}${T}.`)}}return{newState:M}}if(s.scope==="each_lane"){const O=s.targetFilter||{},X=Pa(r),M=L=>{const T=r.player.lanes[L],q=r.opponent.lanes[L];let P=[];if(O.position==="covered"?P=[...T.filter((G,A)=>A<T.length-1),...q.filter((G,A)=>A<q.length-1)]:P=[...T,...q],O.owner==="own")P=P.filter(G=>T.includes(G)&&d==="player"||q.includes(G)&&d==="opponent");else if(O.owner==="opponent"){const G=d==="player"?"opponent":"player";P=P.filter(A=>T.includes(A)&&G==="player"||q.includes(A)&&G==="opponent")}return O.excludeSelf&&(P=P.filter(G=>G.id!==t.id)),(X?P.filter(G=>G.isFaceUp):P).length>0},$=[0,1,2].filter(L=>M(L));if($.length===0){let L=te(r,d,X?"No valid face-up targets to flip (Frost-1 is active).":"No valid targets to flip in any lane.");return L._effectSkippedNoTargets=!0,{newState:L}}const B=$[0],I=$.slice(1);let D={...r};return D.actionRequired={type:"select_card_to_flip",sourceCardId:t.id,actor:d,currentLaneIndex:B,remainingLanes:I,targetFilter:s.targetFilter,params:s,followUpEffect:u==null?void 0:u.thenEffect,conditionalType:u==null?void 0:u.type},{newState:D}}if(s.flipSelf){if(((b=s.advancedConditional)==null?void 0:b.type)==="protocol_match"){const $=s.advancedConditional.protocol;if(r[d].protocols[n]!==$)return{newState:r}}if(((k=s.advancedConditional)==null?void 0:k.type)==="opponent_higher_value_in_lane"){const $=d==="player"?"opponent":"player",B=pa(r,d,n);if(pa(r,$,n)<=B)return{newState:r}}if(((N=s.advancedConditional)==null?void 0:N.type)==="hand_size_greater_than"){const $=s.advancedConditional.threshold??0;if(r[d].hand.length<=$)return{newState:r}}if(((U=s.advancedConditional)==null?void 0:U.type)==="same_protocol_on_field"&&!rs(r,t))return{newState:r};if(((V=s.advancedConditional)==null?void 0:V.type)==="this_card_is_covered"){const $=r[d].lanes;let B=!1;for(let I=0;I<$.length;I++){const D=$[I],L=D.findIndex(T=>T.id===t.id);if(L!==-1&&L<D.length-1){B=!0;break}}if(!B)return{newState:r}}let O={...r};const M=O[d].lanes[n].find($=>$.id===t.id);if(M){M.isFaceUp&&(O=Ci(O,M)),M.isFaceUp=!M.isFaceUp;const $=d==="player"?"Player":"Opponent",B=M.isFaceUp?"face-up":"face-down";O=te(O,d,`${$} flips this card ${B}.`)}return{newState:O}}const p=s.count||1,f=((R=s.scope)==null?void 0:R.type)||s.scope||"anywhere",h=p==="all"||typeof p!="number",w=f==="this_lane"&&h,g=f==="anywhere"&&h;if(w||g){let O={...r};const X=d==="player"?"opponent":"player",M=s.targetFilter||{},$=Pa(r),B=new Set,I=g?[0,1,2]:[n];for(const D of I){const L=O[d].lanes[D];for(const q of L){if(M.excludeSelf&&q.id===t.id||M.faceState==="face_up"&&!q.isFaceUp||M.faceState==="face_down"&&q.isFaceUp||M.owner==="opponent")continue;const P=L.indexOf(q)===L.length-1;M.position==="uncovered"&&!P||M.position==="covered"&&P||g&&!M.position&&!P||$&&!q.isFaceUp||B.add(q.id)}const T=O[X].lanes[D];for(const q of T){if(M.faceState==="face_up"&&!q.isFaceUp||M.faceState==="face_down"&&q.isFaceUp||M.owner==="own")continue;const P=T.indexOf(q)===T.length-1;M.position==="uncovered"&&!P||M.position==="covered"&&P||g&&!M.position&&!P||$&&!q.isFaceUp||B.add(q.id)}}if(B.size>0){const D=g?"":" in this lane";O=te(O,d,`Flipping ${B.size} card(s)${D}.`);for(const L of B)for(const T of["player","opponent"])for(const q of O[T].lanes){const P=q.find(Z=>Z.id===L);P&&(P.isFaceUp&&(O=Ci(O,P)),P.isFaceUp=!P.isFaceUp)}return{newState:O}}else return O=te(O,d,`No cards to flip${g?"":" in this lane"}.`),{newState:O}}const y=s.targetFilter||{},m=y.position||"uncovered",x=Pa(r),S=[];for(const O of["player","opponent"])for(let X=0;X<r[O].lanes.length;X++){const M=r[O].lanes[X];if(!(s.scope==="this_lane"&&X!==n)&&!(s.sameLaneAsFirst&&r.lastFlipLaneIndex!==void 0&&X!==r.lastFlipLaneIndex))for(let $=0;$<M.length;$++){const B=M[$];if(Ho(r,B.id))continue;const I=Vo(r,M,$);if(!(y.excludeSelf&&B.id===t.id||y.owner==="own"&&O!==d||y.owner==="opponent"&&O===d||m==="uncovered"&&!I||m==="covered"&&I||y.faceState==="face_up"&&!B.isFaceUp||y.faceState==="face_down"&&B.isFaceUp||x&&!B.isFaceUp||!es(r,B.id).allowed)){if(y.valueMinGreaterThanHandSize){const L=r[d].hand.length;if(B.value<=L)continue}if(y.valueLessThanUniqueProtocolsOnField){const L=os(r);if(B.value>=L)continue}S.push(B.id)}}}if(S.length===0){let O=r;if(y.valueMinGreaterThanHandSize){const X=r[d].hand.length,M=X+1;O=te(O,d,`Hand size: ${X} cards. No cards with value ${M} or higher available. Effect skipped.`)}else if(y.valueLessThanUniqueProtocolsOnField){const X=os(r);O=te(O,d,`${X} unique protocols on field. No cards with value less than ${X} available. Effect skipped.`)}else O=te(O,d,"No valid cards to flip. Effect skipped.");return O._effectSkippedNoTargets=!0,{newState:O}}let E={...r};if(y.valueMinGreaterThanHandSize){const O=r[d].hand.length,X=O+1,M=p==="all"?"all cards":p===1?"1 card":`${p} cards`;E=te(E,d,`Hand size: ${O} cards. Flip ${M} with value ${X} or higher.`)}return E.actionRequired={type:"select_card_to_flip",count:p,sourceCardId:t.id,actor:d,targetFilter:s.targetFilter,optional:s.optional||!1,scope:s.scope,laneIndex:s.scope==="this_lane"?n:void 0,sameLaneAsFirst:s.sameLaneAsFirst||!1,restrictedLaneIndex:s.sameLaneAsFirst?r.lastFlipLaneIndex:void 0,followUpEffect:u==null?void 0:u.thenEffect,conditionalType:u==null?void 0:u.type},{newState:E}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Delete Effect Executor
 *
 * Handles all delete-related effects.
 * Extracted 1:1 from effectInterpreter.ts for modularity.
 */function Sw(t,n,r,i,s){var k,N,U,V,R,O,X,M,$,B,I,D;const{cardOwner:d}=i,u=s._conditional;let p=s.count||1;if(((k=s.advancedConditional)==null?void 0:k.type)==="empty_hand"&&r[d].hand.length>0)return{newState:r};if(((N=s.advancedConditional)==null?void 0:N.type)==="opponent_higher_value_in_lane"){const L=d==="player"?"opponent":"player",T=pa(r,d,n);if(pa(r,L,n)<=T)return{newState:r}}if(((U=s.advancedConditional)==null?void 0:U.type)==="this_card_is_covered"){const L=r[d].lanes;let T=!1;for(let q=0;q<L.length;q++){const P=L[q],Z=P.findIndex(G=>G.id===t.id);if(Z!==-1&&Z<P.length-1){T=!0;break}}if(!T)return{newState:r}}if(s.useCardFromPreviousEffect&&r.lastCustomEffectTargetCardId){const L=r.lastCustomEffectTargetCardId,T=Ne(r,L);if(!T)return{newState:te(r,d,"Target card from previous effect no longer exists. Delete skipped.")};let q={...r};const P=T.owner,Z=q[P].lanes.findIndex(G=>G.some(A=>A.id===L));if(Z!==-1){const G=[...q[P].lanes[Z]],A=G.findIndex(W=>W.id===L);if(A!==-1){const W=A===G.length-1;G.splice(A,1);const J=[...q[P].lanes];J[Z]=G,q={...q,[P]:{...q[P],lanes:J}};const Q=T.card.isFaceUp?`${T.card.protocol}-${T.card.value}`:"that card";q=te(q,d,`Deletes ${Q}.`);const ee={...q.stats[d],cardsDeleted:q.stats[d].cardsDeleted+1};q={...q,stats:{...q.stats,[d]:ee}};const oe=i.triggerType==="cover"||i.triggerType==="on_cover";return W&&G.length>0&&!oe&&(q=Xn(q,P,Z).newState),{newState:q,animationRequests:[{type:"delete",cardId:L,owner:P}]}}}return{newState:q}}if((V=s.scope)!=null&&V.minCardsInLane){const L=s.scope.minCardsInLane,T=((R=r.player.lanes[n])==null?void 0:R.length)||0,q=((O=r.opponent.lanes[n])==null?void 0:O.length)||0;if(T+q<L)return{newState:r}}let f=[0,1,2];if(((X=s.laneCondition)==null?void 0:X.type)==="opponent_higher_value"&&(f=Xw(r,d),f.length===0)){let L=te(r,d,"No lanes where opponent has higher value. Delete effect skipped.");return L._effectSkippedNoTargets=!0,{newState:L}}const h=s.actorChooses||"effect_owner",w=((M=s.targetFilter)==null?void 0:M.owner)||"any";let g=d;h==="card_owner"&&w==="opponent"&&(g=i.opponent);const y=s.targetFilter||{},m=y.position||"uncovered",x=[];for(const L of["player","opponent"])for(let T=0;T<r[L].lanes.length;T++){if((($=s.scope)==null?void 0:$.type)==="this_line"&&T!==n)continue;const q=r[L].lanes[T];for(let P=0;P<q.length;P++){const Z=q[P];if(Ho(r,Z.id))continue;const G=Vo(r,q,P);if(!(s.excludeSelf&&Z.id===t.id)&&!(y.owner==="own"&&L!==d)&&!(y.owner==="opponent"&&L===d)&&!(m==="uncovered"&&!G)&&!(m==="covered"&&G)){if(m==="covered_by_context"&&i.triggerType==="cover"){if(L!==i.cardOwner&&G)continue}else if(m==="covered_by_context"&&G)continue;if(!(y.faceState==="face_up"&&!Z.isFaceUp)&&!(y.faceState==="face_down"&&Z.isFaceUp)){if(y.valueRange){const{min:A,max:W}=y.valueRange;if(Z.value<A||Z.value>W)continue}if(y.valueSource==="previous_effect_card"){const A=r.lastCustomEffectTargetValue;if(A===void 0||Z.value!==A)continue}if(s.protocolMatching){const A=r.player.protocols[T],W=r.opponent.protocols[T],J=Z.protocol,Q=J===A||J===W;if(s.protocolMatching==="must_match"&&!Q||s.protocolMatching==="must_not_match"&&Q)continue}x.push(Z.id)}}}}if(x.length===0){let L=te(r,d,"No valid cards to delete. Effect skipped.");return L._effectSkippedNoTargets=!0,{newState:L}}if(s.upTo&&(p=Math.min(p,x.length),p===0))return{newState:te(r,d,"No valid targets available. Delete effect skipped.")};let S=x;if(y.calculation==="highest_value"||y.calculation==="lowest_value"){const L=new Map;for(const P of x){const Z=Ne(r,P);if(!Z)continue;let G=-1;for(let W=0;W<r[Z.owner].lanes.length;W++)if(r[Z.owner].lanes[W].some(J=>J.id===P)){G=W;break}let A=Z.card.value;!Z.card.isFaceUp&&G!==-1&&(A=r[Z.owner].lanes[G].some(J=>J.isFaceUp&&J.protocol==="Darkness"&&J.value===2)?4:2),L.set(P,A)}const T=Array.from(L.values()),q=y.calculation==="highest_value"?Math.max(...T):Math.min(...T);S=x.filter(P=>L.get(P)===q)}if(s.autoExecute){const L=S.slice(0,p);let T=r;const q=[];for(const P of L){const Z=Ne(T,P);if(!Z)continue;const{card:G,owner:A}=Z;let W=-1;for(let z=0;z<T[A].lanes.length;z++)if(T[A].lanes[z].some(le=>le.id===P)){W=z;break}if(W===-1)continue;const J=T[A].lanes[W],Q=J[J.length-1].id===P,ee=G.isFaceUp?`${G.protocol}-${G.value}`:"a face-down card";T=te(T,d,`Effect triggers, deleting the lowest value covered card (${A==="player"?"Player's":"Opponent's"} ${ee}).`);const me=[...J],ke=me.findIndex(z=>z.id===P);me.splice(ke,1);const xe=[...T[A].lanes];xe[W]=me,T={...T,[A]:{...T[A],lanes:xe}};const ie={...T.stats[d],cardsDeleted:T.stats[d].cardsDeleted+1};T={...T,stats:{...T.stats,[d]:ie}},q.push({type:"delete",cardId:P,owner:A});const K=i.triggerType==="cover"||i.triggerType==="on_cover";Q&&me.length>0&&!K&&(T=Xn(T,A,W).newState)}return{newState:T,animationRequests:q}}let E={...r};if(s.deleteSelf){if(((B=s.protocolCountConditional)==null?void 0:B.type)==="unique_protocols_on_field_below"){const oe=s.protocolCountConditional.threshold,me=os(r);if(me>=oe)return E=te(E,d,`${me} different protocols on field (need less than ${oe}). Card not deleted.`),{newState:E};E=te(E,d,`Only ${me} different protocols on field (need ${oe}). Deleting this card.`)}const L=d,T=r[L].lanes[n];if(!T||T.length===0)return E=te(E,d,"Card already deleted. Delete effect skipped."),{newState:E};if(T.findIndex(oe=>oe.id===t.id)===-1)return E=te(E,d,"Card already deleted. Delete effect skipped."),{newState:E};const P=r[L].lanes[n],Z=P.length>0&&P[P.length-1].id===t.id;E=te(E,d,`Deleting ${t.protocol}-${t.value}.`);const G=[...P],A=G.findIndex(oe=>oe.id===t.id);if(A===-1)return{newState:E};G.splice(A,1);const W=[...E[L].lanes];W[n]=G,E={...E,[L]:{...E[L],lanes:W}};const J={...E.stats[d],cardsDeleted:E.stats[d].cardsDeleted+1};E={...E,stats:{...E.stats,[d]:J}};const Q=[{type:"delete",cardId:t.id,owner:L}],ee=i.triggerType==="cover"||i.triggerType==="on_cover";if(Z&&G.length>0&&!ee){const oe=Xn(E,L,n);E=oe.newState,oe.animationRequests&&Q.push(...oe.animationRequests)}return{newState:E,animationRequests:Q}}if(s.selectLane)return E.actionRequired={type:"select_lane_for_delete",sourceCardId:t.id,actor:g,count:s.count,targetFilter:s.targetFilter,deleteAll:s.count==="all_in_lane"||s.count==="all",validLanes:f.length<3?f:void 0,laneCondition:s.laneCondition,followUpEffect:u==null?void 0:u.thenEffect,conditionalType:u==null?void 0:u.type},{newState:E};if(((I=s.scope)==null?void 0:I.type)==="each_lane"){const L=Z=>{for(const G of["player","opponent"]){const A=r[G].lanes[Z];for(let W=0;W<A.length;W++){const J=A[W];if(Ho(r,J.id))continue;const Q=Vo(r,A,W);if(!(s.excludeSelf&&J.id===t.id)&&!(y.owner==="own"&&G!==g)&&!(y.owner==="opponent"&&G===g)&&!(m==="uncovered"&&!Q)&&!(m==="covered"&&Q)&&!(y.faceState==="face_up"&&!J.isFaceUp)&&!(y.faceState==="face_down"&&J.isFaceUp))return!0}}return!1},T=[0,1,2].filter(Z=>L(Z));if(T.length===0)return E=te(E,d,"No valid targets to delete in any lane."),E._effectSkippedNoTargets=!0,{newState:E};const q=T[0],P=T.slice(1);return E.actionRequired={type:"select_cards_to_delete",count:p,sourceCardId:t.id,actor:g,currentLaneIndex:q,remainingLanes:P,disallowedIds:s.excludeSelf?[t.id]:[],targetFilter:s.targetFilter,scope:s.scope,protocolMatching:s.protocolMatching,params:s,followUpEffect:u==null?void 0:u.thenEffect,conditionalType:u==null?void 0:u.type},{newState:E}}if(((D=s.scope)==null?void 0:D.type)==="each_other_line"){const q=[0,1,2].filter(P=>P!==n).filter(P=>r.player.lanes[P].length>0||r.opponent.lanes[P].length>0).length;return q===0?(E=te(E,d,"No other lanes have cards. Effect skipped."),{newState:E}):(E.actionRequired={type:"select_card_from_other_lanes_to_delete",sourceCardId:t.id,disallowedLaneIndex:n,lanesSelected:[],count:q,actor:g,targetFilter:s.targetFilter,followUpEffect:u==null?void 0:u.thenEffect,conditionalType:u==null?void 0:u.type},{newState:E})}const j=y.valueSource==="previous_effect_card",b=S.length<x.length||j?S:void 0;return E.actionRequired={type:"select_cards_to_delete",count:p,sourceCardId:t.id,actor:g,actorChooses:h,disallowedIds:s.excludeSelf?[t.id]:[],followUpEffect:u==null?void 0:u.thenEffect,conditionalType:u==null?void 0:u.type,allowedIds:b,targetFilter:s.targetFilter,scope:s.scope,protocolMatching:s.protocolMatching},{newState:E}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Discard Effect Executor
 *
 * Handles all discard-related effects.
 * Extracted 1:1 from effectInterpreter.ts for modularity.
 */function bw(t,n,r,i,s){const{cardOwner:d}=i,u=s._conditional;if(s.actor==="both"){let x={...r};const S=N=>{const U=x[N].hand;if(U.length===0)return{discardedCount:0,discardedCards:[]};const V=U.map(({id:R,isFaceUp:O,...X})=>X);return x[N]={...x[N],hand:[],discard:[...x[N].discard,...V],stats:{...x[N].stats,cardsDiscarded:x[N].stats.cardsDiscarded+V.length}},{discardedCount:V.length,discardedCards:V}},E=S(d),j=d==="player"?"Player":"Opponent";if(E.discardedCount>0){const N=E.discardedCards.map(U=>`${U.protocol}-${U.value}`).join(", ");x=te(x,d,`${j} discards their hand (${E.discardedCount} cards: ${N}).`)}else x=te(x,d,`${j} has no cards to discard.`);const b=S(i.opponent),k=i.opponent==="player"?"Player":"Opponent";if(b.discardedCount>0){const N=b.discardedCards.map(U=>`${U.protocol}-${U.value}`).join(", ");x=te(x,i.opponent,`${k} discards their hand (${b.discardedCount} cards: ${N}).`)}else x=te(x,i.opponent,`${k} has no cards to discard.`);return x._discardContext={actor:"both",discardedCount:E.discardedCount+b.discardedCount,sourceCardId:t.id},{newState:x}}const p=s.actor==="opponent"?i.opponent:d;if(s.useCardFromPreviousEffect&&r.lastCustomEffectTargetCardId){const x=r.lastCustomEffectTargetCardId;let S={...r};const E={...S[p]},j=`${t.protocol}-${t.value}`,b=p==="player"?"Player":"Opponent",k=E.deck.findIndex(U=>U.id===x);if(k!==-1){const U=[...E.deck],V=U.splice(k,1)[0];return E.deck=U,E.discard=[...E.discard,V],S[p]=E,S=te(S,p,`${b} discards ${V.protocol}-${V.value} from their deck.`),S._discardContext={actor:p,discardedCount:1,sourceCardId:t.id},{newState:S}}const N=E.hand.findIndex(U=>U.id===x);if(N!==-1){const U=[...E.hand],V=U.splice(N,1)[0],{id:R,isFaceUp:O,...X}=V;return E.hand=U,E.discard=[...E.discard,X],S[p]=E,S=te(S,p,`${b} discards ${V.protocol}-${V.value}.`),S._discardContext={actor:p,discardedCount:1,sourceCardId:t.id},{newState:S}}return console.warn(`[Discard Effect] useCardFromPreviousEffect: Card ${x} not found`),S=te(S,p,`${j}: Card to discard not found - effect skipped.`),S._discardContext={discardedCount:0},{newState:S}}const f=s.source||"hand";if(f==="entire_deck"){let x={...r};const S={...x[d]},E=`${t.protocol}-${t.value}`;if(S.deck.length===0)return x=te(x,d,`${E}: No cards in deck - effect skipped.`),x._effectSkippedNoTargets=!0,x._discardContext={discardedCount:0},{newState:x};const j=S.deck.length,b=[...S.deck];return S.discard=[...S.discard,...b],S.deck=[],x[d]=S,x=te(x,d,`${E}: Discards entire deck (${j} card${j!==1?"s":""}).`),x._discardContext={actor:d,discardedCount:j,sourceCardId:t.id},{newState:x}}if(f==="top_deck_own"||f==="top_deck_opponent"){const x=f==="top_deck_own"?d:i.opponent;let S={...r};const E={...S[x]},j=x===d?"your":"opponent's";if(E.deck.length===0)return S=te(S,d,`No cards in ${j} deck - effect skipped.`),S._effectSkippedNoTargets=!0,S._discardContext={discardedCount:0},{newState:S};const b=[...E.deck],k=b.shift();return E.deck=b,E.discard=[...E.discard,k],S[x]=E,S=te(S,d,`Discard the top card of ${j} deck: ${k.protocol}-${k.value}.`),S.lastCustomEffectTargetCardId=k.id,S.lastCustomEffectTargetValue=k.value,S._discardContext={actor:x,discardedCount:1,sourceCardId:t.id,discardedCardValue:k.value,discardedCardProtocol:k.protocol},S.actionRequired={type:"confirm_deck_discard",actor:d,sourceCardId:t.id,discardedCard:k,deckOwner:f==="top_deck_own"?"own":"opponent",followUpEffect:u==null?void 0:u.thenEffect,conditionalType:u==null?void 0:u.type,laneIndex:n},{newState:S}}let h=s.count||1;if((s.countType||"fixed")==="equal_to_discarded"){const x=(i.discardedCount||0)+(s.countOffset||0);if(h=Math.min(x,r[p].hand.length),h<=0){let E=te(r,p,`${p==="player"?"Player":"Opponent"} has no cards to discard - effect skipped.`);return E._effectSkippedNoTargets=!0,E._discardContext={discardedCount:0},{newState:E}}}if(r[p].hand.length===0){let S=te(r,p,`${p==="player"?"Player":"Opponent"} has no cards to discard - effect skipped.`);return S._effectSkippedNoTargets=!0,S._discardContext={discardedCount:0},{newState:S}}s.upTo&&(h=Math.min(h,r[p].hand.length));const g=h;typeof h=="number"&&h>r[p].hand.length&&(h=r[p].hand.length);const y=!s.upTo&&typeof g=="number"&&g>h;if(s.random&&p!==d){const x=[...r[p].hand],S=Math.min(h,x.length),E=[],j=x.map((M,$)=>$);for(let M=0;M<S&&j.length>0;M++){const $=Math.floor(Math.random()*j.length);E.push(j[$]),j.splice($,1)}E.sort((M,$)=>$-M);const b=[],k=[...x];for(const M of E){const{id:$,isFaceUp:B,...I}=k.splice(M,1)[0];b.push(I)}const N=[...r[p].discard,...b],U={...r[p].stats,cardsDiscarded:r[p].stats.cardsDiscarded+b.length},V={...r[p],hand:k,discard:N,stats:U};let R={...r,[p]:V,stats:{...r.stats,[p]:U}};const O=p==="player"?"Player":"Opponent",X=b.length===1?"card":"cards";if(p==="player"||b.every(M=>M.isRevealed)){const M=b.map($=>`${$.protocol}-${$.value}`).join(", ");R=te(R,p,`${O} randomly discards ${b.length} ${X}: ${M}.`)}else R=te(R,p,`${O} randomly discards ${b.length} ${X}.`);return R._discardContext={actor:p,discardedCount:b.length,sourceCardId:t.id},{newState:R}}if(h==="all"){const x=r[p].hand,S=x.map(({id:V,isFaceUp:R,...O})=>O),E=[],j=[...r[p].discard,...S],b={...r[p].stats,cardsDiscarded:r[p].stats.cardsDiscarded+S.length},k={...r[p],hand:E,discard:j,stats:b};let N={...r,[p]:k,stats:{...r.stats,[p]:b}};const U=p==="player"?"Player":"Opponent";if(p==="player"||S.every(V=>V.isRevealed)){const V=S.map(R=>`${R.protocol}-${R.value}`).join(", ");N=te(N,p,`${U} discards entire hand (${S.length} cards: ${V}).`)}else N=te(N,p,`${U} discards entire hand (${S.length} cards).`);return N._discardContext={actor:p,discardedCount:S.length,previousHandSize:x.length,sourceCardId:t.id},{newState:N}}let m={...r};return y&&(m=te(m,p,`${p==="player"?"Player":"Opponent"} only has ${h} card${h!==1?"s":""} (${g} required) - discarding all.`)),m.actionRequired={type:"discard",actor:p,count:h,sourceCardId:t.id,variableCount:s.variableCount||!1,previousHandSize:r[p].hand.length,followUpEffect:u==null?void 0:u.thenEffect,conditionalType:u==null?void 0:u.type,_savedIndentLevel:r._logIndentLevel,discardTo:s.discardTo||"own_trash"},{newState:m}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Shift Effect Executor
 *
 * Handles all shift-related effects.
 * Extracted 1:1 from effectInterpreter.ts for modularity.
 */function Ew(t,n,r,i,s){var R,O,X,M;const{cardOwner:d}=i,u=s._conditional;let p={...r};if(((R=s.advancedConditional)==null?void 0:R.type)==="empty_hand"&&r[d].hand.length>0)return{newState:r};if(((O=s.advancedConditional)==null?void 0:O.type)==="opponent_higher_value_in_lane"){const $=d==="player"?"opponent":"player",B=pa(r,d,n);if(pa(r,$,n)<=B)return{newState:r}}if(((X=s.advancedConditional)==null?void 0:X.type)==="this_card_is_covered"){const $=r[d].lanes;let B=!1;for(let I=0;I<$.length;I++){const D=$[I],L=D.findIndex(T=>T.id===t.id);if(L!==-1){B=L<D.length-1;break}}if(!B)return{newState:r}}if(s.useCardFromPreviousEffect&&r.lastCustomEffectTargetCardId){const $=r.lastCustomEffectTargetCardId,B=Ne(r,$);if(!B)return{newState:te(r,d,"Target card from previous effect no longer exists. Shift skipped.")};const I=s.destinationRestriction;if((I==null?void 0:I.type)==="to_this_lane"){const L=I.laneIndex==="current"?n:I.laneIndex;if(L===void 0||L<0||L>2)return console.error(`[Shift Effect] Invalid target lane index: ${L}`),{newState:r};const T=Uo(r,$,B.owner,L,d);return{newState:T.newState,animationRequests:T.animationRequests}}let D=-1;for(let L=0;L<r[B.owner].lanes.length;L++)if(r[B.owner].lanes[L].some(T=>T.id===$)){D=L;break}return D===-1?{newState:r}:(p.actionRequired={type:"select_lane_for_shift",cardToShiftId:$,cardOwner:B.owner,originalLaneIndex:D,sourceCardId:t.id,actor:d,destinationRestriction:I,followUpEffect:u==null?void 0:u.thenEffect,conditionalType:u==null?void 0:u.type},{newState:p})}const f=r._selectedCardFromPreviousEffect;if(p._selectedCardFromPreviousEffect&&delete p._selectedCardFromPreviousEffect,f&&s.useCardFromPreviousEffect){const $=s.destinationRestriction;if(($==null?void 0:$.type)==="to_this_lane"){const B=$.laneIndex==="current"?n:$.laneIndex;if(B===void 0||B<0||B>2)return console.error(`[Shift Effect] Invalid target lane index: ${B}`),{newState:p};const I=Ne(p,f);if(!I)return console.error(`[Shift Effect] Selected card not found: ${f}`),{newState:p};const D=Uo(p,f,I.owner,B,d);return{newState:D.newState,animationRequests:D.animationRequests}}return p.actionRequired={type:"shift_flipped_card_optional",cardId:f,sourceCardId:t.id,optional:s.optional||!1,actor:d,followUpEffect:u==null?void 0:u.thenEffect,conditionalType:u==null?void 0:u.type},{newState:p}}if(s.shiftSelf){if(((M=s.destinationRestriction)==null?void 0:M.type)==="opponent_highest_value_lane"){const $=Om(p,d);if($.includes(n))return p=te(p,d,"Card is already in opponent's highest value lane. Shift skipped."),{newState:p};const B=$.filter(I=>I!==n);if(B.length===0)return p=te(p,d,"No valid destination lane. Shift skipped."),{newState:p};if(B.length===1){if(s.optional)return p.actionRequired={type:"select_lane_for_shift",cardToShiftId:t.id,cardOwner:d,originalLaneIndex:n,sourceCardId:t.id,actor:d,validLanes:B,destinationRestriction:s.destinationRestriction,optional:!0,followUpEffect:u==null?void 0:u.thenEffect,conditionalType:u==null?void 0:u.type},{newState:p};const I=B[0],D=Uo(p,t.id,d,I,d);return{newState:D.newState,animationRequests:D.animationRequests}}return p.actionRequired={type:"select_lane_for_shift",cardToShiftId:t.id,cardOwner:d,originalLaneIndex:n,sourceCardId:t.id,actor:d,validLanes:B,destinationRestriction:s.destinationRestriction,optional:s.optional||!1,followUpEffect:u==null?void 0:u.thenEffect,conditionalType:u==null?void 0:u.type},{newState:p}}return p.actionRequired={type:"shift_flipped_card_optional",cardId:t.id,sourceCardId:t.id,optional:s.optional||!1,actor:d,allowCovered:s.allowCoveredSelf||!1,followUpEffect:u==null?void 0:u.thenEffect,conditionalType:u==null?void 0:u.type},{newState:p}}const h=s.targetFilter||{},w=h.position||"uncovered",g=h.faceState||"any",y=h.owner||"any",m=h.excludeSelf||!1,x=s.count||1;if(w==="any"&&y==="own"&&!m&&x===1)return p.actionRequired={type:"shift_flipped_card_optional",cardId:t.id,sourceCardId:t.id,optional:s.optional||!1,actor:d,followUpEffect:u==null?void 0:u.thenEffect,conditionalType:u==null?void 0:u.type},{newState:p};const E=[];for(const $ of["player","opponent"])if(!(y==="own"&&$!==d)&&!(y==="opponent"&&$===d))for(let B=0;B<p[$].lanes.length;B++){if(s.scope==="this_lane"&&B!==n)continue;const I=p[$].lanes[B];for(let D=0;D<I.length;D++){const L=I[D];if(Ho(p,L.id)||m&&L.id===t.id)continue;const T=Vo(p,I,D);w==="uncovered"&&!T||w==="covered"&&T||g==="face_up"&&!L.isFaceUp||g==="face_down"&&L.isFaceUp||E.push({card:L,currentLane:B,owner:$})}}if(E.length===0)return p=te(p,d,"No valid cards to shift."),p._effectSkippedNoTargets=!0,{newState:p};if((x==="all"||typeof x!="number"&&x!==1)&&E.length>0){const $=[],B=s.destinationRestriction;for(let I=0;I<3;I++){if((B==null?void 0:B.type)==="to_another_line"){if(I===n)continue}else if((B==null?void 0:B.type)==="to_this_lane"){const D=B.laneIndex==="current"?n:B.laneIndex;if(I!==D)continue}else if(!B&&I===n)continue;$.push(I)}return $.length===0?(p=te(p,d,"No valid destination lanes for shifting all cards."),{newState:p}):(p=te(p,d,`Shifting ${E.length} card(s) from this lane.`),p.actionRequired={type:"select_lane_for_shift_all",sourceCardId:t.id,actor:d,cardsToShift:E.map(I=>({cardId:I.card.id,owner:I.owner})),validDestinationLanes:$,sourceLaneIndex:n,followUpEffect:u==null?void 0:u.thenEffect,conditionalType:u==null?void 0:u.type},{newState:p})}const b=s.destinationRestriction;let k=!1;const N=(b==null?void 0:b.laneIndex)==="current"?n:b==null?void 0:b.laneIndex;for(const{card:$,currentLane:B,owner:I}of E){if((b==null?void 0:b.type)==="non_matching_protocol"&&!$.isFaceUp)continue;const D=$.protocol;for(let L=0;L<3;L++){if(b){if(b.type==="non_matching_protocol"){if(L===B)continue;const q=p.player.protocols[L],P=p.opponent.protocols[L];if(D===q||D===P)continue}else if(b.type==="specific_lane"){if(L!==B)continue}else if(b.type==="to_this_lane"){if(L!==N||B===N)continue}else if(b.type==="to_another_line"){if(L===B)continue}else if(b.type==="to_or_from_this_lane"&&(!(B===N)&&!(L===N)||L===B))continue}else if(L===B)continue;if(as(p,B,L).allowed){k=!0;break}}if(k)break}if(!k)return p=te(p,d,"No valid shift destinations available."),{newState:p};const U=b&&N!==void 0?{...b,laneIndex:N}:b,V=(b==null?void 0:b.type)==="to_this_lane"&&N!==void 0?N:void 0;return p.actionRequired={type:"select_card_to_shift",sourceCardId:t.id,actor:d,targetFilter:s.targetFilter,destinationRestriction:U,sourceLaneIndex:n,targetLaneIndex:V,scope:s.scope,followUpEffect:u==null?void 0:u.thenEffect,conditionalType:u==null?void 0:u.type},{newState:p}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Return Effect Executor
 *
 * Handles all return-related effects.
 * Extracted 1:1 from effectInterpreter.ts for modularity.
 */function jw(t,n,r,i,s){var S,E,j,b,k,N;const{cardOwner:d,opponent:u}=i,p=s._conditional;s.count==="all"||s.count;const f=((S=s.targetFilter)==null?void 0:S.owner)||"any",h=((E=s.targetFilter)==null?void 0:E.position)||"uncovered",w=(j=s.targetFilter)==null?void 0:j.faceState,g=s.destination||"owner_hand";if(((b=s.advancedConditional)==null?void 0:b.type)==="empty_hand"&&r[d].hand.length>0)return{newState:r};if(((k=s.advancedConditional)==null?void 0:k.type)==="opponent_higher_value_in_lane"){const U=d==="player"?"opponent":"player",V=pa(r,d,n);if(pa(r,U,n)<=V)return{newState:r}}if(((N=s.advancedConditional)==null?void 0:N.type)==="this_card_is_covered"){const U=r[d].lanes;let V=!1;for(let R=0;R<U.length;R++){const O=U[R],X=O.findIndex(M=>M.id===t.id);if(X!==-1&&X<O.length-1){V=!0;break}}if(!V)return{newState:r}}if(s.returnSelf){let U={...r};const V=U[d].lanes;for(let R=0;R<V.length;R++){const O=V[R],X=O.findIndex(M=>M.id===t.id);if(X!==-1){const[M]=O.splice(X,1);U[d].hand.push(M),U=te(U,d,`${d==="player"?"Player":"Opponent"} returns this card to hand.`);break}}return{newState:U}}if(s.selectLane){let U={...r};return U.actionRequired={type:"select_lane_for_return",sourceCardId:t.id,actor:d,count:s.count,targetFilter:s.targetFilter,followUpEffect:p==null?void 0:p.thenEffect,conditionalType:p==null?void 0:p.type},{newState:U}}let y=[];const m=U=>{for(const V of r[U].lanes)for(let R=0;R<V.length;R++){const O=V[R];if(Ho(r,O.id))continue;const X=Vo(r,V,R);h==="uncovered"&&!X||h==="covered"&&X||w==="face_up"&&!O.isFaceUp||w==="face_down"&&O.isFaceUp||y.push({card:O,isUncovered:X})}};if(f==="own"?m(d):f==="opponent"?m(u):(m("player"),m("opponent")),y.length===0)return{newState:te(r,d,"No cards on board to return. Effect skipped.")};let x={...r};return x.actionRequired={type:"select_card_to_return",sourceCardId:t.id,actor:d,targetOwner:f,targetFilter:s.targetFilter,destination:g,followUpEffect:p==null?void 0:p.thenEffect,conditionalType:p==null?void 0:p.type},{newState:x}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Play Effect Executor
 *
 * Handles all play-related effects (play cards from hand/deck to board).
 * Extracted 1:1 from effectInterpreter.ts for modularity.
 */function kw(t,n,r,i,s){var E,j,b,k,N,U,V,R,O,X,M;const{cardOwner:d,opponent:u}=i,p=s._conditional,f=s.count||1,h=s.source||"hand",w=s.faceDown,g=s.actor==="opponent"?u:d;if(((E=s.advancedConditional)==null?void 0:E.type)==="empty_hand"&&r[d].hand.length>0)return{newState:r};if(((j=s.advancedConditional)==null?void 0:j.type)==="opponent_higher_value_in_lane"){const $=d==="player"?"opponent":"player",B=pa(r,d,n);if(pa(r,$,n)<=B)return{newState:r}}if(h==="deck"&&((b=s.destinationRule)==null?void 0:b.type)==="each_other_line"){const $=[0,1,2].filter(W=>W!==n);if($.length===0)return{newState:r};const B=r[g];if(B.deck.length===0&&B.discard.length===0)return{newState:te(r,d,`${g==="player"?"Player":"Opponent"} has no cards in deck/discard - effect skipped.`)};const{drawnCards:I,remainingDeck:D,newDiscard:L}=Qn(B.deck,B.discard,$.length);if(I.length===0)return{newState:r};const T=I.map(W=>({...W,id:st(),isFaceUp:!1})),q=[...B.lanes];for(let W=0;W<T.length;W++){const J=$[W];q[J]=[...q[J],T[W]]}const P={...B,lanes:q,deck:D,discard:L};let Z={...r,[g]:P};if(Z.detailedGameStats&&I.length>0){const W=g==="player"?"playerFromEffect":"aiFromEffect",J=g==="player"?"playerFaceDown":"aiFaceDown";Z={...Z,detailedGameStats:{...Z.detailedGameStats,cardsPlayed:{...Z.detailedGameStats.cardsPlayed,[W]:Z.detailedGameStats.cardsPlayed[W]+I.length,[J]:Z.detailedGameStats.cardsPlayed[J]+I.length}}}}const G=Ne(r,t.id),A=G?`${G.card.protocol}-${G.card.value}`:"a card effect";return Z=te(Z,d,`${A}: Plays ${I.length} card(s) face-down in other lines.`),{newState:Z}}if(h==="deck"&&((k=s.destinationRule)==null?void 0:k.type)==="each_line_with_card"){const $=s.destinationRule.ownerFilter||"any",B=s.destinationRule.cardFilter,I=$==="own"?g:$==="opponent"?g==="player"?"opponent":"player":null,D=K=>{const z=le=>le.length===0?!1:B?le.some(ne=>B.faceState==="face_down"?!ne.isFaceUp:B.faceState==="face_up"?ne.isFaceUp:!0):!0;return I?z(r[I].lanes[K]):z(r.player.lanes[K])||z(r.opponent.lanes[K])},L=[];for(let K=0;K<3;K++)D(K)&&L.push(K);if(L.length===0)return{newState:r};const T=r[g];if(T.deck.length===0&&T.discard.length===0)return{newState:te(r,d,`${g==="player"?"Player":"Opponent"} has no cards in deck/discard - effect skipped.`)};const{drawnCards:q,remainingDeck:P,newDiscard:Z}=Qn(T.deck,T.discard,L.length);if(q.length===0)return{newState:r};const G=q.map(K=>({...K,id:st(),isFaceUp:!w}));let A=r;const W=[];for(let K=0;K<L.length;K++){const z=L[K],le=A[g].lanes[z];if(le.length>0){const ne=le[le.length-1],ue={...i,triggerType:"cover"},ce=lu(ne,z,A,ue);if(A=ce.newState,ce.animationRequests&&W.push(...ce.animationRequests),A.actionRequired)break}}const J=[...A[g].lanes],Q=[];for(let K=0;K<G.length;K++){const z=L[K];J[z]=[...J[z],G[K]],Q.push({type:"play",cardId:G[K].id,owner:g})}const ee={...A[g],lanes:J,deck:P,discard:Z};let oe={...A,[g]:ee};if(oe.detailedGameStats&&q.length>0){const K=g==="player"?"playerFromEffect":"aiFromEffect",z=g==="player"?"playerFaceDown":"aiFaceDown";oe={...oe,detailedGameStats:{...oe.detailedGameStats,cardsPlayed:{...oe.detailedGameStats.cardsPlayed,[K]:oe.detailedGameStats.cardsPlayed[K]+q.length,[z]:oe.detailedGameStats.cardsPlayed[z]+q.length}}}}const me=Ne(r,t.id),ke=me?`${me.card.protocol}-${me.card.value}`:"a card effect";let xe="";(B==null?void 0:B.faceState)==="face_down"?xe="with a face-down card":(B==null?void 0:B.faceState)==="face_up"?xe="with a face-up card":$==="own"?xe="where you have a card":$==="opponent"?xe="where opponent has a card":xe="with a card",oe=te(oe,d,`${ke}: Plays ${q.length} card(s) face-down in each line ${xe}.`);const ie=[...W,...Q];return{newState:oe,animationRequests:ie.length>0?ie:void 0}}if(h==="deck"&&((N=s.destinationRule)==null?void 0:N.type)==="another_line"){if([0,1,2].filter(P=>P!==n).length===0)return{newState:r};const B=r[g];if(B.deck.length===0&&B.discard.length===0)return{newState:te(r,d,`${g==="player"?"Player":"Opponent"} has no cards in deck/discard - effect skipped.`)};const{drawnCards:I,remainingDeck:D,newDiscard:L}=Qn(B.deck,B.discard,1);if(I.length===0)return{newState:r};const T={...I[0],id:st(),isFaceUp:!0};let q={...r,[g]:{...B,deck:D,discard:L}};return q.actionRequired={type:"confirm_deck_play_preview",sourceCardId:t.id,actor:g,drawnCard:T,isFaceDown:s.faceDown,excludeCurrentLane:!0,currentLaneIndex:n,followUpEffect:p==null?void 0:p.thenEffect,conditionalType:p==null?void 0:p.type},{newState:q}}if(h==="deck"&&((U=s.destinationRule)==null?void 0:U.type)==="under_this_card"&&((V=s.condition)==null?void 0:V.type)==="per_x_cards_in_line"){const $=s.condition.cardCount||2,B=r[d].lanes[n].length,I=r[u].lanes[n].length,D=B+I,L=Math.floor(D/$);if(L===0)return{newState:r};const T=r[g];if(T.deck.length===0&&T.discard.length===0)return{newState:r};const{drawnCards:q,remainingDeck:P,newDiscard:Z}=Qn(T.deck,T.discard,L);if(q.length===0)return{newState:r};const G=q.map(me=>({...me,id:st(),isFaceUp:!1})),A=[...T.lanes[n]];A.splice(A.length-1,0,...G);const W=[...T.lanes];W[n]=A;const J={...T,lanes:W,deck:P,discard:Z};let Q={...r,[g]:J};if(Q.detailedGameStats&&q.length>0){const me=g==="player"?"playerFromEffect":"aiFromEffect",ke=g==="player"?"playerFaceDown":"aiFaceDown";Q={...Q,detailedGameStats:{...Q.detailedGameStats,cardsPlayed:{...Q.detailedGameStats.cardsPlayed,[me]:Q.detailedGameStats.cardsPlayed[me]+q.length,[ke]:Q.detailedGameStats.cardsPlayed[ke]+q.length}}}}const ee=Ne(r,t.id),oe=ee?`${ee.card.protocol}-${ee.card.value}`:"a card effect";return Q=te(Q,d,`${oe}: Plays ${q.length} card(s) face-down under itself.`),{newState:Q}}if(h==="deck"&&((R=s.destinationRule)==null?void 0:R.type)==="specific_lane"){const $=s.destinationRule.laneIndex==="current"?n:s.destinationRule.laneIndex;if($===void 0||$<0||$>2)return console.error(`[Play Effect] Invalid lane index: ${$}`),{newState:r};const B=s.sourceOwner||"own",I=B==="opponent"?g==="player"?"opponent":"player":g,D=r[I],L=s.targetBoard||"own",T=L==="opponent"?g==="player"?"opponent":"player":g;if(D.deck.length===0&&D.discard.length===0)return{newState:te(r,d,`No cards in ${B==="opponent"?"opponent's":"your"} deck/discard - effect skipped.`)};const{drawnCards:q,remainingDeck:P,newDiscard:Z}=Qn(D.deck,D.discard,f);if(q.length===0)return{newState:r};const G=q.map(ke=>({...ke,id:st(),isFaceUp:!w}));let A={...r};A[I]={...A[I],deck:P,discard:Z};const W=[...A[T].lanes];if(W[$]=[...W[$],...G],A[T]={...A[T],lanes:W},A.detailedGameStats&&q.length>0){const ke=d==="player"?"playerFromEffect":"aiFromEffect",xe=d==="player"?w?"playerFaceDown":"playerFaceUp":w?"aiFaceDown":"aiFaceUp";A={...A,detailedGameStats:{...A.detailedGameStats,cardsPlayed:{...A.detailedGameStats.cardsPlayed,[ke]:A.detailedGameStats.cardsPlayed[ke]+q.length,[xe]:A.detailedGameStats.cardsPlayed[xe]+q.length}}}}const J=Ne(r,t.id),Q=J?`${J.card.protocol}-${J.card.value}`:"a card effect",ee=w?"face-down":"face-up",oe=r.player.protocols[$];let me=`${Q}: Plays `;return B==="opponent"?me+="the top card of opponent's deck ":me+=`${q.length} card(s) from deck `,me+=`${ee} `,L==="opponent"?me+=`on opponent's ${oe} line.`:me+=`in ${oe} line.`,A=te(A,d,me),{newState:A}}if(h==="hand"&&((O=s.destinationRule)==null?void 0:O.type)==="line_with_matching_cards"){const $=s.destinationRule.cardFilter,B=L=>{const T=q=>q.length===0?!1:$?q.some(P=>$.faceState==="face_down"?!P.isFaceUp:$.faceState==="face_up"?P.isFaceUp:!0):!0;return T(r.player.lanes[L])||T(r.opponent.lanes[L])},I=[];for(let L=0;L<3;L++)B(L)&&I.push(L);if(I.length===0){const L=Ne(r,t.id),T=L?`${L.card.protocol}-${L.card.value}`:"Effect";return{newState:te(r,d,`${T}: No valid lanes with face-down cards. Effect skipped.`)}}if(r[g].hand.length===0)return{newState:r};let D={...r};return D.actionRequired={type:"select_card_from_hand_to_play",sourceCardId:t.id,actor:g,count:s.count||1,faceDown:s.faceDown,source:"hand",validLanes:I,cardFilter:$,followUpEffect:p==null?void 0:p.thenEffect,conditionalType:p==null?void 0:p.type},{newState:D}}if(h==="hand"&&((X=s.valueFilter)==null?void 0:X.equals)!==void 0&&!s.destinationRule){const $=s.valueFilter.equals,B=r[g].hand.filter(D=>D.value===$);if(B.length===0){const D=Ne(r,t.id),L=D?`${D.card.protocol}-${D.card.value}`:"Effect";return{newState:te(r,d,`${L}: No cards with value ${$} in hand. Effect skipped.`)}}let I={...r};return I.actionRequired={type:"select_card_from_hand_to_play",sourceCardId:t.id,actor:g,count:s.count||1,faceDown:s.faceDown,source:"hand",valueFilter:$,selectableCardIds:B.map(D=>D.id),followUpEffect:p==null?void 0:p.thenEffect,conditionalType:p==null?void 0:p.type},{newState:I}}if(h==="trash"){if(r[g].discard.length===0){const I=Ne(r,t.id),D=I?`${I.card.protocol}-${I.card.value}`:"Effect";return{newState:te(r,d,`${D}: No cards in trash. Effect skipped.`)}}let B={...r};return B.actionRequired={type:"select_card_from_trash_to_play",sourceCardId:t.id,actor:g,count:s.count||1,faceDown:s.faceDown,destinationRule:s.destinationRule,followUpEffect:p==null?void 0:p.thenEffect,conditionalType:p==null?void 0:p.type,sourceLaneIndex:n},{newState:B}}if(h==="hand"&&r[g].hand.length===0)return{newState:r};let y;if(s.excludeSourceProtocol&&h==="hand"){const $=t.protocol,B=r[g].hand.filter(I=>I.protocol!==$);if(B.length===0){const I=Ne(r,t.id),D=I?`${I.card.protocol}-${I.card.value}`:"Effect";return{newState:te(r,d,`${D}: No non-${$} cards in hand. Effect skipped.`)}}y=B.map(I=>I.id)}let m={...r},x;(M=s.destinationRule)!=null&&M.excludeCurrentLane&&(x=n);let S;if(s.useCardFromPreviousEffect&&h==="hand"){const $=r.lastCustomEffectTargetCardId;if($&&(S=[$],!r[g].hand.find(I=>I.id===$)))return{newState:r}}return y&&(S=y),m.actionRequired={type:"select_card_from_hand_to_play",count:f,sourceCardId:t.id,actor:g,faceDown:w,source:h,disallowedLaneIndex:x,destinationRule:s.destinationRule,condition:s.condition,selectableCardIds:S,excludeSourceProtocol:s.excludeSourceProtocol,sourceProtocol:s.excludeSourceProtocol?t.protocol:void 0,optional:s.optional,followUpEffect:p==null?void 0:p.thenEffect,conditionalType:p==null?void 0:p.type},{newState:m}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Reveal/Give Effect Executor
 *
 * Handles reveal and give card effects.
 * Extracted 1:1 from effectInterpreter.ts for modularity.
 */function Tw(t,n,r,i,s){var y;const{cardOwner:d,opponent:u}=i,p=s._conditional,f=s.count||1,h=s.action,w=s.source||"own_hand";if(h==="reveal"&&w==="board"){const m=s.targetFilter||{owner:"any",position:"uncovered",faceState:"face_down"},x=s.followUpAction,S=s.optional!==!1,E=[],j=m.owner==="own"?[d]:m.owner==="opponent"?[u]:[d,u];for(const k of j)for(let N=0;N<r[k].lanes.length;N++){const U=r[k].lanes[N];if(U.length>0){let V=[];m.position==="uncovered"?V=[U[U.length-1]]:m.position==="covered"?V=U.slice(0,-1):V=[...U];const R=V.filter(O=>m.faceState==="face_up"?O.isFaceUp:m.faceState==="face_down"?!O.isFaceUp:!0);E.push(...R)}}if(E.length===0)return{newState:te(r,d,"No valid cards to reveal. Effect skipped.")};let b={...r};return b.actionRequired={type:"select_board_card_to_reveal_custom",sourceCardId:t.id,actor:d,targetFilter:m,followUpAction:x,optional:S,followUpEffect:p==null?void 0:p.thenEffect,conditionalType:p==null?void 0:p.type},{newState:b}}if(h==="reveal"&&w==="opponent_hand"){let m={...r};const x={...m[u]};if(x.hand.length>0){x.hand=x.hand.map(E=>({...E,isRevealed:!0})),m[u]=x;const S=`${t.protocol}-${t.value}`;m=te(m,d,`${S}: Your opponent reveals their hand.`)}else{const S=`${t.protocol}-${t.value}`;m=te(m,d,`${S}: Opponent has no cards to reveal.`)}return{newState:m}}if(h==="reveal"&&w==="own_deck_top"){let m={...r};const x={...m[d]},S=`${t.protocol}-${t.value}`;if(x.deck.length===0)return m=te(m,d,`${S}: No cards in deck to reveal.`),{newState:m};const E=[...x.deck],j=E[0];m=te(m,d,`${S}: Revealed ${j.protocol}-${j.value} from top of deck.`);const b=`deck-top-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;return E[0]={...j,id:b},x.deck=E,m[d]=x,m.lastCustomEffectTargetCardId=b,{newState:m}}if(h==="reveal"&&w==="own_trash"){let m={...r};const x={...m[d]},S=`${t.protocol}-${t.value}`;return x.discard.length===0?(m=te(m,d,`${S}: No cards in trash to reveal.`),m._effectSkippedNoTargets=!0,{newState:m}):(m.actionRequired={type:"select_card_from_trash_to_reveal",sourceCardId:t.id,actor:d,count:f,followUpEffect:p==null?void 0:p.thenEffect,conditionalType:p==null?void 0:p.type,sourceLaneIndex:n},{newState:m})}if(h==="reveal"&&w==="own_deck"){let m={...r};const x={...m[d]},S=`${t.protocol}-${t.value}`;if(x.deck.length===0)return m=te(m,d,`${S}: No cards in deck to reveal.`),{newState:m};x.deckRevealed=!0,m[d]=x;const E=x.deck.map(j=>`${j.protocol}-${j.value}`).join(", ");return m=te(m,d,`${S}: Revealed deck: ${E}`),{newState:m}}if(h==="reveal"&&w==="own_hand"&&((y=s.protocolFilter)==null?void 0:y.type)==="same_as_source"){let m={...r};const x={...m[d]},S=`${t.protocol}-${t.value}`,E=x.hand.filter(b=>b.protocol===t.protocol);if(E.length===0)return m=te(m,d,`${S}: No ${t.protocol} cards in hand to reveal.`),{newState:m};x.hand=x.hand.map(b=>b.protocol===t.protocol?{...b,isRevealed:!0}:b),m[d]=x;const j=E.map(b=>`${b.protocol}-${b.value}`).join(", ");return m=te(m,d,`${S}: Revealed ${E.length} ${t.protocol} card(s) from hand: ${j}`),{newState:m}}if(r[d].hand.length===0)return{newState:te(r,d,`No cards in hand to ${h}. Effect skipped.`)};let g={...r};return h==="reveal"?g.actionRequired={type:"select_card_from_hand_to_reveal",count:f,sourceCardId:t.id,actor:d,followUpEffect:p==null?void 0:p.thenEffect,conditionalType:p==null?void 0:p.type}:h==="give"&&(g.actionRequired={type:"select_card_from_hand_to_give",count:f,sourceCardId:t.id,actor:d,followUpEffect:p==null?void 0:p.thenEffect,conditionalType:p==null?void 0:p.type}),{newState:g}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Shuffle Effect Executor
 *
 * Handles shuffle_trash and shuffle_deck effects.
 * - shuffle_trash: Clarity-4 "You may shuffle your trash into your deck."
 *   (In this codebase, "trash" = "discard pile")
 * - shuffle_deck: Clarity-2/3 "Shuffle your deck."
 */function Nw(t,n,r,i,s){var h;const{cardOwner:d}=i,u=s._conditional,p=`${t.protocol}-${t.value}`,f=s.optional!==!1;if(((h=s.advancedConditional)==null?void 0:h.type)==="trash_not_empty"&&r[d].discard.length===0)return{newState:te(r,d,`${p}: No cards in trash - effect skipped.`)};if(r[d].discard.length===0)return{newState:te(r,d,`${p}: No cards in trash to shuffle.`)};if(f){let w={...r};return w.actionRequired={type:"prompt_optional_shuffle_trash",sourceCardId:t.id,actor:d,trashCount:r[d].discard.length,followUpEffect:u==null?void 0:u.thenEffect,conditionalType:u==null?void 0:u.type},{newState:w}}return Lm(r,d,p)}function Lm(t,n,r){let i={...t};const s={...i[n]},d=s.discard.length;return d===0?(i=te(i,n,`${r}: No cards in trash to shuffle.`),{newState:i}):(s.deck=[...s.deck,...s.discard],s.discard=[],s.deck=Yn([...s.deck]),i[n]=s,i=te(i,n,`${r}: Shuffled ${d} card${d!==1?"s":""} from trash into deck.`),i=dt(i,"after_shuffle",{player:n}).newState,{newState:i})}function Aw(t,n,r,i,s){const{cardOwner:d}=i,u=`${t.protocol}-${t.value}`;let p={...r};const f={...p[d]};return f.deck.length===0?(p=te(p,d,`${u}: No cards in deck to shuffle.`),{newState:p}):(f.deck=Yn([...f.deck]),f.deckRevealed=!1,p[d]=f,p=te(p,d,`${u}: Shuffled deck.`),p=dt(p,"after_shuffle",{player:d}).newState,{newState:p})}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * State Number Effect Executor
 *
 * Handles the "state a number" effect (Luck-0).
 * Player chooses a number (0-5) which is stored in state for subsequent effects.
 */function Rw(t,n,r,i,s){const{cardOwner:d}=i;let u={...r};return u.actionRequired={type:"state_number",actor:d,sourceCardId:t.id,numberSource:s.numberSource||"own_protocol_values"},{newState:u}}function Fw(t,n,r){let i={...t};return i.lastStatedNumber=r,i=te(i,n,`${n==="player"?"Player":"Opponent"} states the number ${r}.`),i.actionRequired=null,i}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * State Protocol Effect Executor
 *
 * Handles the "state a protocol" effect (Luck-3).
 * Player chooses a protocol from opponent's cards which is stored for subsequent effects.
 */function Dw(t,n){const r=new Set;t[n].deck.forEach(u=>r.add(u.protocol)),t[n].hand.forEach(u=>r.add(u.protocol)),t[n].lanes.forEach(u=>{u.forEach(p=>r.add(p.protocol))}),t[n].discard.forEach(u=>r.add(u.protocol));const i=[],s=t[n].protocols;for(const u of s)r.has(u)&&!i.includes(u)&&i.push(u);const d=Array.from(r).filter(u=>!i.includes(u)).sort();return i.push(...d),i}function $w(t,n,r,i,s){const{cardOwner:d,opponent:u}=i;let p=[];if(s.protocolSource==="opponent_cards"&&(p=Dw(r,u)),p.length===0){let h=te(r,d,"No protocols available to state - effect skipped.");return h._effectSkippedNoTargets=!0,{newState:h}}let f={...r};return f.actionRequired={type:"state_protocol",actor:d,sourceCardId:t.id,protocolSource:s.protocolSource||"opponent_cards",availableProtocols:p},{newState:f}}function qw(t,n,r){let i={...t};return i.lastStatedProtocol=r,i=te(i,n,`${n==="player"?"Player":"Opponent"} states the protocol "${r}".`),i.actionRequired=null,i}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Swap Stacks Effect Executor (Mirror-2)
 *
 * Swaps all cards between two of the player's own lanes.
 * Does NOT swap protocols - only the card stacks.
 */function Iw(t,n,r,i,s){const{cardOwner:d}=i;if(!r[d].lanes.some(h=>h.length>0))return{newState:te(r,d,"Cannot swap stacks: no cards on board.")};const p=[0,1,2];let f={...r};return f.actionRequired={type:"select_lanes_for_swap_stacks",actor:d,sourceCardId:t.id,validLanes:p,selectedFirstLane:void 0},{newState:f}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Copy Opponent Middle Effect Executor (Mirror-1)
 *
 * Allows the player to select one of the opponent's face-up uncovered cards
 * and execute its middle effects as if they were on this card.
 */function Lw(t){var r,i;return((i=(r=t.customEffects)==null?void 0:r.middleEffects)==null?void 0:i.length)>0}function Pw(t){var r;return((r=t.customEffects)==null?void 0:r.middleEffects)||[]}function Uw(t,n,r,i,s){const{cardOwner:d}=i,u=d==="player"?"opponent":"player",p=s.optional??!1,f=[];for(let w=0;w<r[u].lanes.length;w++){const g=r[u].lanes[w];if(g.length===0)continue;const y=g[g.length-1];y.isFaceUp&&Lw(y)&&f.push(y.id)}if(f.length===0)return{newState:te(r,d,"No opponent cards with middle commands to copy.")};let h={...r};return h.actionRequired={type:"select_card_for_copy_middle",actor:d,sourceCardId:t.id,validTargetIds:f,optional:p},{newState:h}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function Ow(t,n,r,i,s){var p,f;const{cardOwner:d}=i;let u={...r};if(((p=s.protocolCountConditional)==null?void 0:p.type)==="unique_protocols_on_field"){const h=s.protocolCountConditional.threshold,w=os(r);if(w<h)return u=te(u,d,`Not enough different protocols on field (${w}/${h}). Effect skipped.`),{newState:u};u=te(u,d,`${w} different protocols on field. Protocol compiled!`)}else if(((f=s.protocolCountConditional)==null?void 0:f.type)==="same_protocol_count_on_field"){const h=s.protocolCountConditional.threshold,w=iu(r,t.protocol);if(w<h)return u=te(u,d,`Not enough face-up ${t.protocol} cards on field (${w}/${h}). Effect skipped.`),{newState:u};u=te(u,d,`${w} face-up ${t.protocol} cards on field. Protocol compiled!`)}if(!u[d].compiled[n]){u[d]={...u[d],compiled:[...u[d].compiled.slice(0,n),!0,...u[d].compiled.slice(n+1)]};const h={...u.stats[d],protocolsCompiled:u.stats[d].protocolsCompiled+1};u={...u,stats:{...u.stats,[d]:h}}}if(s.deleteAllInLane){const h=d==="player"?"opponent":"player",w=[...u[d].lanes[n]],g=[...u[h].lanes[n]],y=w.map(({id:S,isFaceUp:E,...j})=>j),m=g.map(({id:S,isFaceUp:E,...j})=>j);u={...u,[d]:{...u[d],lanes:[...u[d].lanes.slice(0,n),[],...u[d].lanes.slice(n+1)],discard:[...u[d].discard,...y]},[h]:{...u[h],lanes:[...u[h].lanes.slice(0,n),[],...u[h].lanes.slice(n+1)],discard:[...u[h].discard,...m]}};const x=w.length+g.length;x>0&&(u=te(u,d,`All ${x} cards in this line deleted.`))}return{newState:u}}function ct(t,n,r,i,s,d){var j,b,k;const u={...s.params,_conditional:s.conditional},p=u.action,f=Ne(r,t.id);if(!f)return{newState:r};if(!f.card.isFaceUp)return{newState:r};const h=s.position||"middle",g=s.trigger==="on_cover",y=u.useCardFromPreviousEffect===!0;if(h!=="top"&&!g&&!y&&!Oo(r,t.id))return{newState:r};const x=p==="reveal"&&u.source==="board";if(u.optional===!0&&!x){const N=u.actor==="opponent"?i.opponent:i.cardOwner,U=N==="player"?"opponent":"player",V=u.targetFilter||{},R=$=>{for(const B of["player","opponent"])for(let I=0;I<r[B].lanes.length;I++){const D=r[B].lanes[I];for(let L=0;L<D.length;L++)if($(D[L],B,I,L))return!0}return!1};let O=!0,X="";switch(p){case"discard":!u.useCardFromPreviousEffect&&r[N].hand.length===0&&(O=!1,X="No cards to discard");break;case"flip":{const $=(j=r.passiveEffects)==null?void 0:j.some(B=>B.type==="prevent_flip_to_face_up"&&B.isActive);O=R((B,I,D,L)=>{if(V.excludeSelf&&B.id===t.id||V.owner==="own"&&I!==N||V.owner==="opponent"&&I===N)return!1;const T=L===r[I].lanes[D].length-1;return!(V.position==="uncovered"&&!T||V.position==="covered"&&T||V.faceState==="face_up"&&!B.isFaceUp||V.faceState==="face_down"&&B.isFaceUp||$&&!B.isFaceUp)}),O||(X="No valid cards to flip");break}case"delete":{O=R(($,B,I,D)=>{if(V.excludeSelf&&$.id===t.id||V.owner==="own"&&B!==N||V.owner==="opponent"&&B===N)return!1;const L=D===r[B].lanes[I].length-1,T=V.position||"uncovered";return!(T==="uncovered"&&!L||T==="covered"&&L||V.faceState==="face_up"&&!$.isFaceUp||V.faceState==="face_down"&&$.isFaceUp)}),O||(X="No valid cards to delete");break}case"shift":{if(s.useCardFromPreviousEffect){const $=r.lastCustomEffectTargetCardId||r._selectedCardFromPreviousEffect;$?(O=!!Ne(r,$),O||(X="Target card no longer exists")):(O=!1,X="No target card from previous effect")}else if(u.shiftSelf&&((b=u.destinationRestriction)==null?void 0:b.type)==="opponent_highest_value_lane")Om(r,i.cardOwner).includes(n)&&(O=!1,X="Card is already in opponent's highest value lane");else if(((k=u.advancedConditional)==null?void 0:k.type)==="this_card_is_covered"){const $=r[i.cardOwner].lanes;let B=!1;for(let I=0;I<$.length;I++){const D=$[I],L=D.findIndex(T=>T.id===t.id);if(L!==-1){B=L<D.length-1;break}}B||(O=!1,X="Card is not covered")}else{const $=V.position||"uncovered";$==="any"&&V.owner==="own"&&!V.excludeSelf?O=!0:(O=R((I,D,L,T)=>{if(V.excludeSelf&&I.id===t.id||V.owner==="own"&&D!==N||V.owner==="opponent"&&D===N)return!1;const q=T===r[D].lanes[L].length-1;return!($==="uncovered"&&!q||$==="covered"&&q)}),O||(X="No valid cards to shift"))}break}case"return":{const $=V.owner==="opponent"?U:N;O=R((B,I,D,L)=>{if(I!==$)return!1;const T=L===r[I].lanes[D].length-1,q=V.position||"uncovered";return!(q==="uncovered"&&!T||q==="covered"&&T)}),O||(X="No valid cards to return");break}case"draw":r[N].deck.length===0&&r[N].discard.length===0&&(O=!1,X="No cards to draw");break;case"play":r[N].hand.length===0&&(O=!1,X="No cards to play");break}if(!O){let $=te(r,N,`${X} - effect skipped.`);return $._effectSkippedNoTargets=!0,p==="discard"&&($._discardContext={discardedCount:0}),{newState:$}}let M={...r};return M.actionRequired={type:"prompt_optional_effect",actor:i.cardOwner,sourceCardId:t.id,effectDef:s,laneIndex:n,logSource:r._currentEffectSource,logPhase:r._currentPhaseContext,logIndentLevel:r._logIndentLevel||0},{newState:M}}let S;const E={logSource:r._currentEffectSource,logPhase:r._currentPhaseContext,logIndentLevel:r._logIndentLevel||0};switch(p){case"refresh":{const U=(u.target||"self")==="opponent"?i.opponent:i.actor,V=ru(r,U);if(!V.allowed){S={newState:te(r,i.cardOwner,V.reason||"Cannot refresh (draw blocked).")};break}const R=r[U].hand.length,O=Math.max(0,5-R);if(O>0){const{drawnCards:X,remainingDeck:M,newDiscard:$}=Qn(r[U].deck,r[U].discard,O),B=X.map(q=>({...q,id:st()}));let I={...r,[U]:{...r[U],hand:[...r[U].hand,...B],deck:M,discard:$}};const D=U==="player"?` (${X.map(q=>`${q.protocol}-${q.value}`).join(", ")})`:"";I=te(I,U,`[Refresh] Drew ${X.length} cards to reach hand size 5${D}.`),I=dt(I,"after_draw",{player:U,count:X.length}).newState,I=dt(I,"after_refresh",{player:U}).newState,S={newState:I}}else{let X=te(r,U,`[Refresh] Hand already at ${R} cards, no draw needed.`);X=dt(X,"after_refresh",{player:U}).newState,S={newState:X}}break}case"mutual_draw":{const N=i.actor,U=N==="player"?"opponent":"player",V=u.count||1;let R={...r};if(R[U].deck.length>0){const{drawnCards:O,remainingDeck:X,newDiscard:M}=Qn(R[U].deck,R[U].discard,V);if(O.length>0){const $=O.map(L=>({...L,id:st(),isFaceUp:!0}));R={...R,[U]:{...R[U],deck:X,discard:M},[N]:{...R[N],hand:[...R[N].hand,...$]}};const B=N==="player"?"Player":"Opponent",I=U==="player"?"Player":"Opponent",D=N==="player"?` (${$.map(L=>`${L.protocol}-${L.value}`).join(", ")})`:"";R=te(R,N,`${B} drew ${O.length} card(s) from ${I}'s deck${D}.`)}}if(R[N].deck.length>0){const{drawnCards:O,remainingDeck:X,newDiscard:M}=Qn(R[N].deck,R[N].discard,V);if(O.length>0){const $=O.map(L=>({...L,id:st(),isFaceUp:!0}));R={...R,[N]:{...R[N],deck:X,discard:M},[U]:{...R[U],hand:[...R[U].hand,...$]}};const B=U==="player"?"Player":"Opponent",I=N==="player"?"Player":"Opponent",D=U==="player"?` (${$.map(L=>`${L.protocol}-${L.value}`).join(", ")})`:"";R=te(R,U,`${B} drew ${O.length} card(s) from ${I}'s deck${D}.`)}}S={newState:R};break}case"draw":S=xw(t,n,r,i,u);break;case"flip":S=Cw(t,n,r,i,{...u,useCardFromPreviousEffect:s.useCardFromPreviousEffect,_conditional:s.conditional});break;case"delete":S=Sw(t,n,r,i,u);break;case"discard":S=bw(t,n,r,i,{...u,_conditional:s.conditional});break;case"shift":S=Ew(t,n,r,i,{...u,useCardFromPreviousEffect:s.useCardFromPreviousEffect});break;case"return":S=jw(t,n,r,i,u);break;case"play":S=kw(t,n,r,i,u);break;case"rearrange_protocols":case"swap_protocols":S=Mw(t,n,r,i,u);break;case"reveal":case"give":S=Tw(t,n,r,i,u);break;case"take":S=Hw(t,n,r,i,u);break;case"choice":S=Vw(t,n,r,i,u);break;case"block_compile":S=zw(t,n,r,i,u);break;case"delete_all_in_lane":S=Bw(t,n,r,i,u);break;case"shuffle_trash":S=Nw(t,n,r,i,u);break;case"shuffle_deck":S=Aw(t,n,r,i);break;case"state_number":S=Rw(t,n,r,i,u);break;case"state_protocol":S=$w(t,n,r,i,u);break;case"swap_stacks":S=Iw(t,n,r,i);break;case"copy_opponent_middle":S=Uw(t,n,r,i,u);break;case"auto_compile":S=Ow(t,n,r,i,u);break;default:console.error(`[Custom Effect] Unknown action: ${p}`),S={newState:r};break}if(S.newState.actionRequired&&!S.newState.actionRequired.logSource&&(S={...S,newState:{...S.newState,actionRequired:{...S.newState.actionRequired,logSource:E.logSource,logPhase:E.logPhase,logIndentLevel:E.logIndentLevel}}}),s.conditional&&s.conditional.thenEffect){const{newState:N}=S;if(N.actionRequired)S={newState:{...N,actionRequired:{...N.actionRequired,followUpEffect:s.conditional.thenEffect,conditionalType:s.conditional.type,outerSourceCardId:t.id,outerLaneIndex:n}}};else{if(s.conditional.type==="if_executed"){const R=N._discardContext;if(((R==null?void 0:R.discardedCount)||0)===0)return delete N._discardContext,S={newState:N},S}if(s.conditional.type==="if_protocol_matches_stated"){const R=N._discardContext,O=R==null?void 0:R.discardedCardProtocol,X=N.lastStatedProtocol;if(!X||!O||O!==X){let $=te(N,i.cardOwner,`Discarded card does not match stated protocol "${X||"none"}". Effect skipped.`);return delete $._discardContext,S={newState:$},S}let M=te(N,i.cardOwner,`Discarded card matches stated protocol "${X}"!`);delete M._discardContext,S={newState:M}}if(s.conditional.type==="optional"){let R={...N};return R.actionRequired={type:"prompt_optional_effect",actor:i.cardOwner,sourceCardId:t.id,effectDef:s.conditional.thenEffect,laneIndex:n,savedTargetCardId:N.lastCustomEffectTargetCardId},S={newState:R},S}let U=i;const V=N._discardContext;V&&(U={...i,discardedCount:V.discardedCount,previousHandSize:V.previousHandSize},delete N._discardContext),S=ct(t,n,N,U,s.conditional.thenEffect)}}return S}function Mw(t,n,r,i,s){const{cardOwner:d,opponent:u}=i,p=s.action,h=(s.target||"own")==="opponent"?u:d,w=d;if(aw(r)&&p==="rearrange_protocols")return{newState:te(r,d,"Protocols cannot be rearranged (Frost-1 bottom effect is active).")};let y={...r},m;return s.restriction&&(m={laneIndex:s.restriction.laneIndex==="current"?n:s.restriction.laneIndex,protocol:s.restriction.disallowedProtocol}),p==="rearrange_protocols"?y.actionRequired={type:"prompt_rearrange_protocols",actor:w,target:h,sourceCardId:t.id,disallowedProtocolForLane:m}:p==="swap_protocols"&&(y.actionRequired={type:"prompt_swap_protocols",actor:w,target:h,sourceCardId:t.id,disallowedProtocolForLane:m}),{newState:y}}function Hw(t,n,r,i,s){const{cardOwner:d,opponent:u}=i,p=s.count||1,f=s.random!==!1;if(r[u].hand.length===0)return{newState:te(r,d,"Opponent has no cards in hand. Effect skipped.")};let h={...r};const w={...h[u]},g={...h[d]};if(f){const y=Math.min(p,w.hand.length),m=[];for(let j=0;j<y;j++){const b=Math.floor(Math.random()*w.hand.length),k=w.hand.splice(b,1)[0];g.hand.push(k),m.push(k)}h={...h,[d]:g,[u]:w};const x=d==="player"?"Player":"Opponent",S=`${t.protocol}-${t.value}`,E=m.map(j=>d==="player"?`${j.protocol}-${j.value}`:"a card").join(", ");return h=te(h,d,`${S}: ${x} takes ${E} from the opponent's hand.`),{newState:h}}else{console.warn("[Take Effect] Non-random take not yet implemented, falling back to random");const y=Math.floor(Math.random()*w.hand.length),m=w.hand.splice(y,1)[0];g.hand.push(m),h={...h,[d]:g,[u]:w};const x=d==="player"?"Player":"Opponent",S=`${t.protocol}-${t.value}`,E=d==="player"?`${m.protocol}-${m.value}`:"a card";return h=te(h,d,`${S}: ${x} takes ${E} from the opponent's hand.`),{newState:h}}}function Vw(t,n,r,i,s){var f;const{cardOwner:d}=i,u=s.options||[];if(((f=s.advancedConditional)==null?void 0:f.type)==="same_protocol_on_field"&&!rs(r,t))return{newState:r};if(u.length!==2)return console.error(`[Choice Effect] Expected 2 options, got ${u.length}`),{newState:r};let p={...r};return p.actionRequired={type:"custom_choice",options:u,sourceCardId:t.id,actor:d,laneIndex:n},{newState:p}}function zw(t,n,r,i,s){const{cardOwner:d,opponent:u}=i,f=(s.target||"opponent")==="opponent"?u:d,h={...r[f],cannotCompile:!0};let w={...r,[f]:h};const g=Ne(r,t.id),y=g?`${g.card.protocol}-${g.card.value}`:"Effect";return w=te(w,d,`${y}: ${f==="player"?"Player":"Opponent"} cannot compile next turn.`),{newState:w}}function Bw(t,n,r,i,s){var w;const{cardOwner:d}=i,u=s.excludeCurrentLane!==!1,p=((w=s.laneCondition)==null?void 0:w.count)||8,f=[];for(let g=0;g<3;g++){if(u&&g===n)continue;r.player.lanes[g].length+r.opponent.lanes[g].length>=p&&f.push(g)}if(f.length===0){const g=`${t.protocol}-${t.value}`;return{newState:te(r,d,`${g}: No line has ${p} or more cards. Effect skipped.`)}}let h={...r};return h.actionRequired={type:"select_lane_for_delete_all",sourceCardId:t.id,actor:d,validLanes:f,minCards:p},{newState:h}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function dt(t,n,r){var p;let i={...t};if(i._processingReactiveEffects)return{newState:i};i={...i,_processingReactiveEffects:!0};const s=i.processedClearCacheTriggerIds||[],d=[],u=f=>f.some(h=>h.trigger===n||h.trigger==="on_cover_or_flip"&&(n==="on_cover"||n==="on_flip"));for(const f of["player","opponent"])i[f].lanes.forEach((h,w)=>{h.forEach((g,y)=>{if(!g.isFaceUp)return;const m=i._committedCardId;if(m&&g.id===m)return;const x=g;if(!x.customEffects)return;const S=y===h.length-1;if(x.customEffects.topEffects&&u(x.customEffects.topEffects)){if(n==="after_clear_cache"&&s.includes(g.id))return;d.push({card:g,owner:f,laneIndex:w,box:"top"})}if(x.customEffects.middleEffects&&u(x.customEffects.middleEffects)){if(n==="after_clear_cache"&&s.includes(g.id))return;d.push({card:g,owner:f,laneIndex:w,box:"middle"})}if(S&&x.customEffects.bottomEffects){const E=x.customEffects.bottomEffects.filter(j=>j.trigger!=="on_cover");if(E.length>0&&u(E)){if(n==="after_clear_cache"&&s.includes(g.id))return;d.push({card:g,owner:f,laneIndex:w,box:"bottom"})}}})});if(d.length===0)return delete i._processingReactiveEffects,{newState:i};for(const{card:f,owner:h,laneIndex:w,box:g}of d){const y=i[h].lanes[w],m=y==null?void 0:y.findIndex(V=>V.id===f.id);if(!(m!==void 0&&m!==-1&&((p=y[m])==null?void 0:p.isFaceUp))||g==="bottom"&&!(m===y.length-1)||n==="before_compile_delete"&&(r==null?void 0:r.cardId)!==f.id||n==="on_flip"&&(r==null?void 0:r.cardId)!==f.id||(n==="on_cover"||n==="on_flip")&&r!=null&&r.cardId&&r.cardId!==f.id)continue;const S=f,b=(g==="top"?S.customEffects.topEffects:g==="middle"?S.customEffects.middleEffects:S.customEffects.bottomEffects).filter(V=>V.trigger===n||V.trigger==="on_cover_or_flip"&&(n==="on_cover"||n==="on_flip")).filter(V=>{const R=V.reactiveTriggerActor||"self";if(!(r!=null&&r.player))return!0;if(n==="after_opponent_discard"||n==="after_opponent_draw"||n==="after_opponent_refresh"||n==="after_opponent_compile")return r.player===h;if(R==="self"){if(r.player!==h)return!1}else if(R==="opponent"&&r.player===h)return!1;return!((V.reactiveScope||"global")==="this_lane"&&(r==null?void 0:r.laneIndex)!==void 0&&w!==r.laneIndex||V.onlyDuringOpponentTurn&&i.turn===h)});if(b.length===0)continue;const k=`${f.protocol}-${f.value}`;i=Ua(i),i=Ze(i,k),i=et(i,"after");const N=h==="player"?"opponent":"player",U={cardOwner:h,actor:h,currentTurn:i.turn,opponent:N,triggerType:n};if(n==="after_clear_cache"){const V=i.processedClearCacheTriggerIds||[];i.processedClearCacheTriggerIds=[...V,f.id]}for(const V of b){const R=ct(f,w,i,U,V);if(i=Ae(R.newState),i.actionRequired){const O=i.actionRequired.actor||h;O!==t.turn&&!i._interruptedTurn&&(i._interruptedTurn=t.turn,i._interruptedPhase=t.phase,i.turn=O);const X=i._pendingCustomEffects;if(X&&X.effects.length>0){const M={type:"execute_remaining_custom_effects",sourceCardId:X.sourceCardId,laneIndex:X.laneIndex,effects:X.effects,context:X.context,actor:X.context.cardOwner};i.queuedActions=[M,...i.queuedActions||[]],delete i._pendingCustomEffects}return delete i._processingReactiveEffects,{newState:i}}}i=Mo(i),i=Ze(i,void 0),i=et(i,void 0)}return delete i._processingReactiveEffects,{newState:i}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function Qn(t,n,r){let i=[...t],s=[...n],d=[],u=!1;for(let p=0;p<r;p++){if(i.length===0){if(s.length===0)break;i=Yn(s),s=[],u=!0}d.push(i.shift())}return{drawnCards:d,remainingDeck:i,newDiscard:s,reshuffled:u}}function gr(t,n,r,i="effect"){const s=t[n],{drawnCards:d,remainingDeck:u,newDiscard:p,reshuffled:f}=Qn(s.deck,s.discard,r);if(d.length===0)return t;const h=d.map(x=>({...x,id:st(),isFaceUp:!0})),w=h.map(x=>x.id),g={...s.stats,cardsDrawn:s.stats.cardsDrawn+d.length},y={...s,deck:u,discard:p,hand:[...s.hand,...h],stats:g};let m={...t,[n]:y,stats:{...t.stats,[n]:g}};if(m.detailedGameStats&&d.length>0){const x=i==="refresh",S=n==="player"?x?"playerFromRefresh":"playerFromEffect":x?"aiFromRefresh":"aiFromEffect";m={...m,detailedGameStats:{...m.detailedGameStats,cardsDrawn:{...m.detailedGameStats.cardsDrawn,[S]:m.detailedGameStats.cardsDrawn[S]+d.length}}}}return w.length>0&&(m.animationState={type:"drawCard",owner:n,cardIds:w}),f&&(m=te(m,n,`${n==="player"?"Player":"Opponent"}'s deck is empty. Discard pile has been reshuffled into the deck.`)),d.length>0&&(m=dt(m,"after_draw",{player:n,count:d.length}).newState,m=dt(m,"after_opponent_draw",{player:n==="player"?"opponent":"player",count:d.length}).newState),m}function Gw(t,n,r){const i=n==="player"?"opponent":"player";let s={...t};const d={...s[i]},u={...s[n]},{drawnCards:p,remainingDeck:f,newDiscard:h,reshuffled:w}=Qn(d.deck,d.discard,r);if(p.length>0){const g=p.map(x=>({...x,id:st(),isFaceUp:!0})),y=g.map(x=>x.id);u.hand=[...u.hand,...g];const m={...u.stats,cardsDrawn:u.stats.cardsDrawn+p.length};if(u.stats=m,d.deck=f,d.discard=h,s={...s,[n]:u,[i]:d,stats:{...s.stats,[n]:m}},y.length>0&&(s.animationState={type:"drawCard",owner:n,cardIds:y}),w&&(s=te(s,n,`${i==="player"?"Player":"Opponent"}'s deck is empty. Discard pile has been reshuffled into the deck.`)),s.detailedGameStats&&p.length>0){const x=n==="player"?"playerFromEffect":"aiFromEffect";s={...s,detailedGameStats:{...s.detailedGameStats,cardsDrawn:{...s.detailedGameStats.cardsDrawn,[x]:s.detailedGameStats.cardsDrawn[x]+p.length}}}}}return s}function Yw(t,n){const i=5-t[n].hand.length;if(i<=0)return t;let d=te(t,n,`${n==="player"?"Player":"Opponent"} refreshes their hand, drawing ${i} card(s).`);d=gr(d,n,i,"refresh");const u={...d[n],stats:{...d[n].stats,handsRefreshed:d[n].stats.handsRefreshed+1}};if(d={...d,[n]:u,stats:{...d.stats,[n]:u.stats}},d.detailedGameStats){const w=n==="player"?"playerCardsDrawn":"aiCardsDrawn";d={...d,detailedGameStats:{...d.detailedGameStats,refreshes:{...d.detailedGameStats.refreshes,[w]:d.detailedGameStats.refreshes[w]+i}}}}return d=dt(d,"after_refresh",{player:n}).newState,d=dt(d,"after_opponent_refresh",{player:n==="player"?"opponent":"player"}).newState,d}function mr(t,n){const r={...n},i=s=>s.map(d=>d.map(u=>t.has(u.id)?{...u,isFaceUp:!u.isFaceUp}:u));return r.player.lanes=i(r.player.lanes),r.opponent.lanes=i(r.opponent.lanes),Ae(r)}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const um=t=>{const n=Yn(so(t)),{drawnCards:r,remainingDeck:i}=Qn(n,[],5),s={cardsPlayed:0,cardsDiscarded:0,cardsDeleted:0,cardsFlipped:0,cardsShifted:0,cardsDrawn:r.length,cardsReturned:0,handsRefreshed:0},d=r.map(u=>({...u,id:st(),isFaceUp:!0}));return{protocols:t,deck:i,hand:d,lanes:[[],[],[]],discard:[],compiled:[!1,!1,!1],laneValues:[0,0,0],cannotCompile:!1,stats:s}},Zl=(t,n,r,i="player")=>{const s=um(t),d=um(n),u={player:s,opponent:d,turn:i,phase:"start",controlCardHolder:null,useControlMechanic:r,winner:null,log:[],actionRequired:null,queuedActions:[],animationState:null,compilableLanes:[],processedStartEffectIds:[],processedEndEffectIds:[],lastPlayedCardId:void 0,stats:{player:s.stats,opponent:d.stats},detailedGameStats:{cardsPlayed:{playerFromHand:0,playerFromEffect:0,aiFromHand:0,aiFromEffect:0,playerFaceUp:0,playerFaceDown:0,aiFaceUp:0,aiFaceDown:0},cardsDrawn:{playerFromRefresh:0,playerFromEffect:0,aiFromRefresh:0,aiFromEffect:0},compiles:{playerFirstCompile:0,playerRecompile:0,aiFirstCompile:0,aiRecompile:0},refreshes:{playerCardsDrawn:0,aiCardsDrawn:0}}},p=i==="player"?"Player":"Opponent",f=t.join(", "),h=n.join(", ");let w=te(u,"player","Game Started.");return w=te(w,"player",`Player protocols: ${f}`),w=te(w,"opponent",`Opponent protocols: ${h}`),w=te(w,"player",`${p} goes first.`),w},fn=(t,n,r,i,s)=>{if(t.isFaceUp)return t.value;if(n.some(u=>u.isFaceUp&&u.protocol==="Darkness"&&u.value===2))return 4;if(r&&i!==void 0&&s!==void 0){const u=Pm(r);for(const p of u)if(p.type==="set_to_fixed"){if(!(p.scope==="global"||p.scope==="this_lane"&&p.laneIndex===i))continue;const h=p.cardOwner;if(p.target==="own_cards"&&h!==s||p.target==="opponent_cards"&&h===s)continue;const w=p.filter;if(w&&(!w.faceState||w.faceState==="any"||w.faceState==="face_down"&&!t.isFaceUp||w.faceState==="face_up"&&t.isFaceUp))return p.value}}return 2},pm=(t,n,r,i)=>{let s=0;for(const d of t)d.isFaceUp?s+=d.value:s+=fn(d,t,n,r,i);return Math.max(0,s)};function Pm(t){const n=[];for(const r of["player","opponent"])t[r].lanes.forEach((i,s)=>{i.forEach(d=>{if(d.isFaceUp){const u=d;u.customEffects&&[...u.customEffects.topEffects||[],...u.customEffects.middleEffects||[],...u.customEffects.bottomEffects||[]].forEach(f=>{f.params.action==="value_modifier"&&f.trigger==="passive"&&n.push({...f.params.modifier,cardOwner:r,laneIndex:s,sourceCardProtocol:d.protocol})})}})});return n}function Ww(t,n,r){const i=Pm(t),s=[...n],d=[...r];for(const u of i){const{type:p,value:f,condition:h,target:w,scope:g,filter:y,cardOwner:m,laneIndex:x}=u,S=g==="global"?[0,1,2]:[x];for(const E of S)switch(p){case"add_per_condition":{if(!h)continue;let j=0;const b=t.player.lanes[E],k=t.opponent.lanes[E];h==="per_face_down_card"?j=b.filter(N=>!N.isFaceUp).length+k.filter(N=>!N.isFaceUp).length:h==="per_face_up_card"?j=b.filter(N=>N.isFaceUp).length+k.filter(N=>N.isFaceUp).length:h==="per_card"?j=b.length+k.length:h==="per_card_in_hand"?j=t[m].hand.length:h==="per_opponent_card_in_lane"&&(j=t[m==="player"?"opponent":"player"].lanes[E].length),w==="own_total"&&m==="player"?s[E]+=f*j:w==="own_total"&&m==="opponent"||w==="opponent_total"&&m==="player"?d[E]+=f*j:w==="opponent_total"&&m==="opponent"&&(s[E]+=f*j);break}case"set_to_fixed":break;case"add_to_total":{if(h==="has_non_own_protocol_face_up"){const j=t[m].lanes[x],b=u.sourceCardProtocol;if(!b||!j.some(N=>N.isFaceUp&&N.protocol!==b))continue}w==="own_total"&&m==="player"?s[E]+=f:w==="own_total"&&m==="opponent"||w==="opponent_total"&&m==="player"?d[E]+=f:w==="opponent_total"&&m==="opponent"&&(s[E]+=f);break}}}return{finalPlayerValues:s.map(u=>Math.max(0,u)),finalOpponentValues:d.map(u=>Math.max(0,u))}}function Qw(t,n,r){let i=[...n],s=[...r];return{finalPlayerValues:i,finalOpponentValues:s}}const Ae=t=>{const n=t.player.lanes.map((u,p)=>pm(u,t,p,"player")),r=t.opponent.lanes.map((u,p)=>pm(u,t,p,"opponent")),i=Qw(t,n,r),{finalPlayerValues:s,finalOpponentValues:d}=Ww(t,i.finalPlayerValues,i.finalOpponentValues);return{...t,player:{...t.player,laneValues:s},opponent:{...t.opponent,laneValues:d}}},Um=(t,n)=>{const r=[],i=t[n],s=t[n==="player"?"opponent":"player"];if(!i.cannotCompile)for(let d=0;d<3;d++){const u=i.laneValues[d],p=s.laneValues[d];u>=10&&u>p&&r.push(d)}return r},pa=(t,n,r)=>t[n].laneValues[r],Xw=(t,n)=>{const r=n==="player"?"opponent":"player",i=[];for(let s=0;s<3;s++){const d=t[n].laneValues[s];t[r].laneValues[s]>d&&i.push(s)}return i},Om=(t,n)=>{const r=n==="player"?"opponent":"player";let i=-1,s=[];for(let d=0;d<3;d++){const u=t[r].laneValues[d];u>i?(i=u,s=[d]):u===i&&s.push(d)}return s};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Zw=["select_card_to_flip","select_any_card_to_flip"];function Kw(t,n,r){if(!r||!Zw.includes(r.type))return null;const i=Ne(t,n);if(i&&i.card.protocol==="Metal"&&i.card.value===6){const s="actor"in r?r.actor:t.turn,d=s==="player"?"Player":"Opponent",u=i.owner==="player"?"Player's":"Opponent's";let p="An effect";if("sourceCardId"in r&&r.sourceCardId){const b=Ne(t,r.sourceCardId);b&&(p=`${b.card.protocol}-${b.card.value}`)}let f=te(t,s,`${p}: ${d} flips ${u} Metal-6.`);f=te(f,s,"Metal-6: Deletes itself when flipped.");const h={...t.stats[s],cardsDeleted:t.stats[s].cardsDeleted+1},w={...t[s],stats:h};f={...f,[s]:w,stats:{...f.stats,[s]:h}};const g=i.owner,y=t[g].lanes.findIndex(b=>b.some(k=>k.id===n)),m=t[g].lanes[y],x=m&&m.length>0&&m[m.length-1].id===n,S=m&&m.length>1,E=t._pendingCustomEffects,j=(b,k)=>{var X,M;let N={...b};const U=E&&((X=N.queuedActions)==null?void 0:X.some($=>$.type==="execute_remaining_custom_effects"&&$.sourceCardId===E.sourceCardId));E&&!U&&(N._pendingCustomEffects=E,N.lastCustomEffectTargetCardId=n);let R=dt(N,"after_delete",{player:N.turn}).newState;if(x&&S&&(R=Xn(R,g,y).newState),r&&"count"in r&&r.count>1){const $=r.count-1;return R.actionRequired={...r,count:$},{...R,animationState:null}}if(N.actionRequired||N.queuedActions&&N.queuedActions.length>0)return{...R,actionRequired:N.actionRequired,queuedActions:N.queuedActions,animationState:null};const O=E&&((M=R.queuedActions)==null?void 0:M.some($=>$.type==="execute_remaining_custom_effects"&&$.sourceCardId===E.sourceCardId));if(E&&!R._pendingCustomEffects&&!O&&(R._pendingCustomEffects=E,R.lastCustomEffectTargetCardId=n),R=tt(R),R.actionRequired=null,R.queuedActions&&R.queuedActions.length>0){const $=[...R.queuedActions],B=$.shift();if((B==null?void 0:B.type)==="execute_remaining_custom_effects"){const I={...R,queuedActions:[B,...$]},D=Oa(I);if(D.actionRequired)return{...D,animationState:null};if(D.queuedActions&&D.queuedActions.length>0){const L=[...D.queuedActions],T=L.shift();return{...D,actionRequired:T,queuedActions:L,animationState:null}}return k(D)}return{...R,actionRequired:B,queuedActions:$,animationState:null}}return k(R)};return{nextState:{...f,actionRequired:null},requiresAnimation:{animationRequests:[{type:"delete",cardId:n,owner:i.owner}],onCompleteCallback:j},requiresTurnEnd:!1}}return null}const Wd=(t,n)=>{var u,p,f,h,w,g,y,m,x,S,E,j,b,k,N,U,V,R;if(!t.actionRequired)return{nextState:t};let r={...t},i=!0,s=null;const d=Kw(t,n,t.actionRequired);if(d)return d;switch(t.actionRequired.type){case"select_card_to_flip":{const{logSource:O,logPhase:X,logIndentLevel:M}=t.actionRequired;O!==void 0&&(r=Ze(r,O)),X!==void 0&&(r=et(r,X)),M!==void 0&&(r._logIndentLevel=M);const $=t._committedCardId;if($&&n===$)return{nextState:t};if(!es(t,n).allowed)return{nextState:t};const I=Ne(t,n),D="draws"in t.actionRequired?t.actionRequired.draws:0;r=Bd(t,n);const L=n;r.lastCustomEffectTargetCardId=L;let T;if(I){const oe=t[I.owner].lanes.findIndex(me=>me.some(ke=>ke.id===n));oe!==-1&&(T=oe,r.lastFlipLaneIndex=oe)}const q=(u=t.actionRequired)==null?void 0:u.sourceCardId;if(q&&r.queuedActions&&(r.queuedActions=r.queuedActions.map(oe=>{var me;return oe.type==="execute_remaining_custom_effects"&&oe.sourceCardId===q&&!oe.selectedCardFromPreviousEffect&&((me=oe.effects)==null?void 0:me.some(xe=>xe.useCardFromPreviousEffect))?{...oe,selectedCardFromPreviousEffect:n}:oe})),D&&D>0){const{actor:oe,sourceCardId:me}=t.actionRequired,ke=Ne(r,me),xe=ke?`${ke.card.protocol}-${ke.card.value}`:"A card effect";r=te(r,oe,`${xe}: Drawing ${D} card(s).`),r=gr(r,oe,D)}if(I&&!I.card.isFaceUp){const oe=Yd(r,n);r=oe.newState,r.lastCustomEffectTargetCardId=L,T!==void 0&&(r.lastFlipLaneIndex=T),oe.animationRequests&&(s={animationRequests:oe.animationRequests,onCompleteCallback:(me,ke)=>me.actionRequired||me.queuedActions&&me.queuedActions.length>0?me:ke(me)})}const Z=((p=t.actionRequired)==null?void 0:p._followUpAlreadyExecuted)||(f=t.actionRequired)==null?void 0:f.followUpEffect,G=(h=t.actionRequired)==null?void 0:h.sourceCardId;Z&&G&&(r=mw(r,n,G,Z));const A=((w=t.actionRequired)==null?void 0:w.actor)||t.turn,W=r.actionRequired;W&&(r.actionRequired=null),r=dt(r,"after_flip",{player:A,cardId:n}).newState,W&&(r.actionRequired?r.queuedActions=[{...W,type:W.type},...r.queuedActions||[]]:r.actionRequired=W);const Q=r._pendingCustomEffects;if(Q&&Q.effects.length>0){const oe={type:"execute_remaining_custom_effects",sourceCardId:Q.sourceCardId,laneIndex:Q.laneIndex,effects:Q.effects,context:Q.context,actor:Q.context.cardOwner,selectedCardFromPreviousEffect:Q.effects[0].useCardFromPreviousEffect?n:void 0,logSource:Q.logSource,logPhase:Q.logPhase,logIndentLevel:Q.logIndentLevel};r.queuedActions=[oe,...r.queuedActions||[]],delete r._pendingCustomEffects}const ee=(g=t.actionRequired)==null?void 0:g.remainingLanes;if(ee&&ee.length>0&&!r.actionRequired){const oe=ee[0],me=ee.slice(1),ke=(y=t.actionRequired)==null?void 0:y.params,xe=(m=t.actionRequired)==null?void 0:m.sourceCardId,ie=(x=t.actionRequired)==null?void 0:x.actor,K=(S=t.actionRequired)==null?void 0:S.targetFilter;r.actionRequired={type:"select_card_to_flip",sourceCardId:xe,actor:ie,currentLaneIndex:oe,remainingLanes:me,targetFilter:K,params:ke,followUpEffect:(E=t.actionRequired)==null?void 0:E.followUpEffect,conditionalType:(j=t.actionRequired)==null?void 0:j.conditionalType}}(r.actionRequired||r.queuedActions&&r.queuedActions.length>0)&&(i=!1);break}case"select_card_to_shift":{const{logSource:O,logPhase:X,logIndentLevel:M}=t.actionRequired;O!==void 0&&(r=Ze(r,O)),X!==void 0&&(r=et(r,X)),M!==void 0&&(r._logIndentLevel=M);const{sourceCardId:$,optional:B}=t.actionRequired;if(B&&$){const D=Ne(t,$);if(!D||!D.card.isFaceUp){const L=D?`${D.card.protocol}-${D.card.value}`:"the source card",T=t._logSource;r=Ze(t,L),r=te(r,t.actionRequired.actor,"Shift was cancelled because the source is no longer active."),r=Ze(r,T),r=tt(r),r.actionRequired=null,i=!0;break}}const I=Ne(t,n);if(I){const{owner:D}=I;let L=-1;for(let J=0;J<t[D].lanes.length;J++)if(t[D].lanes[J].some(Q=>Q.id===n)){L=J;break}if(L===-1)return{nextState:t,requiresTurnEnd:!1};const q=(t.actionRequired.targetFilter||{}).position||"uncovered",P=t[D].lanes[L],G=P.findIndex(J=>J.id===n)===P.length-1;if(q==="uncovered"&&!G)return{nextState:t,requiresTurnEnd:!1};if(q==="covered"&&G)return{nextState:t,requiresTurnEnd:!1};const A=t.actionRequired.scope,W=t.actionRequired.sourceLaneIndex;if(A==="this_lane"&&W!==void 0&&L!==W)return{nextState:t,requiresTurnEnd:!1};if(L!==-1){const J=t.actionRequired.targetLaneIndex;if(J!==void 0){const ee=t.actionRequired.actor;r=Uo(t,n,D,J,ee).newState,i=!r.actionRequired;break}const Q={type:"select_lane_for_shift",cardToShiftId:n,cardOwner:D,originalLaneIndex:L,sourceCardId:t.actionRequired.sourceCardId,actor:t.actionRequired.actor,destinationRestriction:t.actionRequired.destinationRestriction,followUpEffect:t.actionRequired.followUpEffect,conditionalType:t.actionRequired.conditionalType};r.actionRequired=Q}}i=!1;break}case"delete_self":{const{sourceCardId:O,cardToDeleteId:X,actor:M,logSource:$,logPhase:B,logIndentLevel:I}=t.actionRequired;$!==void 0&&(r=Ze(r,$)),B!==void 0&&(r=et(r,B)),I!==void 0&&(r._logIndentLevel=I);const D=Ne(t,X);if(!D){r=te(r,M,"Card no longer on board. Delete skipped."),r=tt(r),r.actionRequired=null,i=!0;break}const L=`${D.card.protocol}-${D.card.value}`;r=te(r,M,`Deleting ${L}.`);const{owner:T,laneIndex:q}=D,P=t[T].lanes[q][t[T].lanes[q].length-1].id===X,Z=[...t[T].lanes[q]],G=Z.findIndex(Q=>Q.id===X);Z.splice(G,1);const A=[...t[T].lanes];A[q]=Z;let W={...t,[T]:{...t[T],lanes:A}};r=tt(W),r.actionRequired=null;const J={...r.stats[M],cardsDeleted:r.stats[M].cardsDeleted+1};r={...r,stats:{...r.stats,[M]:J}},P&&Z.length>0&&(r=Xn(r,T,q).newState),i=!0;break}case"select_cards_to_delete":case"select_face_down_card_to_delete":case"select_low_value_card_to_delete":case"select_card_from_other_lanes_to_delete":{const{sourceCardId:O,actor:X}=t.actionRequired,{logSource:M,logPhase:$,logIndentLevel:B}=t.actionRequired;M!==void 0&&(r=Ze(r,M)),$!==void 0&&(r=et(r,$)),B!==void 0&&(r._logIndentLevel=B);const I=Ne(t,O);if(!I||!I.card.isFaceUp){const xe=I?`${I.card.protocol}-${I.card.value}`:"the source card";r=te(r,X,`Effect from ${xe} was cancelled because the source is no longer active.`),r=tt(r),r.actionRequired=null,i=!0;break}const D=Ne(t,n);if(!D)return{nextState:t};const L=t.actionRequired.allowedIds;if(L&&!L.includes(n))return console.error(`Illegal delete: Card ${n} is not in allowedIds - value filter not met`),{nextState:t};if(t.actionRequired.protocolMatching){const xe=t.actionRequired.protocolMatching,ie=t[D.owner].lanes.findIndex(K=>K.some(z=>z.id===n));if(ie!==-1){const K=t.player.protocols[ie],z=t.opponent.protocols[ie],le=D.card.protocol,ne=le===K||le===z;if(xe==="must_match"&&!ne)return console.error(`Illegal delete: ${le}-${D.card.value} in lane ${ie} (protocols: ${K}/${z}) - card must be in lane with matching protocol`),{nextState:t};if(xe==="must_not_match"&&ne)return console.error(`Illegal delete: ${le}-${D.card.value} in lane ${ie} (protocols: ${K}/${z}) - card must be in lane without matching protocol`),{nextState:t}}}const T=t.actionRequired.targetFilter;if((T==null?void 0:T.calculation)==="highest_value"||(T==null?void 0:T.calculation)==="lowest_value"){const xe=T.owner,ie=xe==="opponent"?X==="player"?"opponent":"player":xe==="own"?X:D.owner,z=_w(t,ie).some(ne=>ne.card.id===n),le=T.calculation==="highest_value"?"highest":"lowest";if(!z)return console.error(`Illegal delete: Card ${n} is not one of the ${le} value uncovered cards`),{nextState:t}}const q=X==="player"?"Player":"Opponent",P=D.owner==="player"?"Player's":"Opponent's",Z=t[D.owner].lanes.findIndex(xe=>xe.some(ie=>ie.id===n)),G=Z!==-1?t[D.owner].protocols[Z]:"unknown",A=D.card.isFaceUp?`${D.card.protocol}-${D.card.value}`:`face-down card in Protocol ${G}`,W=Ne(t,t.actionRequired.sourceCardId),J=W?`${W.card.protocol}-${W.card.value}`:"a card effect";r=te(r,X,`${J}: ${q} deletes ${P} ${A}.`);const Q={...r.stats[X],cardsDeleted:r.stats[X].cardsDeleted+1},ee={...r[X],stats:Q};r={...r,[X]:ee,stats:{...r.stats,[X]:Q}};const oe=t[D.owner].lanes.findIndex(xe=>xe.some(ie=>ie.id===n)),me=t[D.owner].lanes[oe],ke=me&&me.length>0&&me[me.length-1].id===n;r=tt(r),r.actionRequired=null,s={animationRequests:[{type:"delete",cardId:n,owner:D.owner}],onCompleteCallback:(xe,ie)=>{var Be,Me,He;const K=t.actionRequired.actor,z=t.actionRequired;let ne=dt(xe,"after_delete",{player:K}).newState;ne=tt(ne);let ue=null;const ce=Ne(ne,z.sourceCardId),Se=Oo(ne,z.sourceCardId),De=z.followUpEffect;if(ce&&ce.card.isFaceUp&&Se){const je=z.remainingLanes;if(z.type==="select_cards_to_delete"&&je&&je.length>0){const Re=je[0],Ie=je.slice(1);ue={type:"select_cards_to_delete",count:((Be=z.params)==null?void 0:Be.count)||z.count,sourceCardId:z.sourceCardId,actor:z.actor,currentLaneIndex:Re,remainingLanes:Ie,disallowedIds:(Me=z.params)!=null&&Me.excludeSelf?[z.sourceCardId]:[],targetFilter:z.targetFilter,scope:z.scope,protocolMatching:z.protocolMatching,params:z.params}}else if(z.type==="select_cards_to_delete"&&z.count>1)ue={type:"select_cards_to_delete",count:z.count-1,sourceCardId:z.sourceCardId,disallowedIds:[...z.disallowedIds,n],actor:z.actor,followUpEffect:De};else if(z.type==="select_card_from_other_lanes_to_delete"&&z.count>1){const Re=t[D.owner].lanes.findIndex(nt=>nt.some(Rt=>Rt.id===n)),Ie=[...z.lanesSelected,Re];[0,1,2].filter(nt=>nt!==z.disallowedLaneIndex&&!Ie.includes(nt)).some(nt=>ne.player.lanes[nt].length>0||ne.opponent.lanes[nt].length>0)?ue={type:"select_card_from_other_lanes_to_delete",count:z.count-1,sourceCardId:z.sourceCardId,disallowedLaneIndex:z.disallowedLaneIndex,lanesSelected:Ie,actor:z.actor}:ne=te(ne,z.actor,"No cards left in remaining lanes. Effect skipped.")}}else if("count"in z&&z.count>1){const je=ce?`${ce.card.protocol}-${ce.card.value}`:"the source card",Re=!ce||!ce.card.isFaceUp?"the source is no longer active":"the source was covered";ne=te(ne,z.actor,`Remaining deletes from ${je} were cancelled because ${Re}.`)}let be=!1;if(ke){const je=ne,Re=Xn(je,D.owner,oe),Ie=Re.newState._interruptedTurn!==void 0;je._interruptedTurn&&!Re.newState._interruptedTurn&&(be=!0);const Ve=[...Re.newState.queuedActions||[]];ue&&(Ie?Ve.push(ue):Ve.unshift(ue)),ne={...Re.newState,queuedActions:Ve}}else ue&&(ne.queuedActions=[...ne.queuedActions||[],ue]);if(De&&!ue)if(ne.actionRequired){const je=Ne(ne,z.sourceCardId),Re=z.actor==="player"?"opponent":"player";let Ie=-1;je&&(Ie=ne[je.owner].lanes.findIndex(nt=>nt.some(Rt=>Rt.id===z.sourceCardId)));const Ve={cardOwner:z.actor,actor:z.actor,currentTurn:ne.turn,opponent:Re,triggerType:"start"},it={type:"execute_remaining_custom_effects",sourceCardId:z.sourceCardId,actor:z.actor,laneIndex:Ie,effects:[De],context:Ve,logSource:z.logSource,logPhase:z.logPhase,logIndentLevel:z.logIndentLevel??1};ne.queuedActions=[...ne.queuedActions||[],it]}else{const je=Ne(ne,z.sourceCardId),Re=z.actor==="player"?"opponent":"player";if(je){const Ie=ne[je.owner].lanes.findIndex(Rt=>Rt.some(Zt=>Zt.id===z.sourceCardId)),Ve={cardOwner:z.actor,actor:z.actor,currentTurn:ne.turn,opponent:Re,triggerType:"start"},it=`${je.card.protocol}-${je.card.value}`;ne=Ze(ne,z.logSource||it),ne=et(ne,z.logPhase||"start"),ne._logIndentLevel=z.logIndentLevel??1,ne=ct(je.card,Ie,ne,Ve,De).newState,ne=tt(ne)}else(He=De.params)!=null&&He.deleteSelf&&(ne=Ze(ne,z.logSource||"the source card"),ne=et(ne,z.logPhase||"start"),ne._logIndentLevel=z.logIndentLevel??1,ne=internalDeleteCard(ne,z.sourceCardId).newState,ne=te(ne,z.actor,"Deletes itself."))}if(ne.actionRequired)return ne;if(ne.queuedActions&&ne.queuedActions.length>0){const je=ne.queuedActions[0];if((je==null?void 0:je.type)==="execute_remaining_custom_effects"){const Ve=Oa(ne);return Ve.actionRequired?Ve:ie(Ve)}const Re=[...ne.queuedActions],Ie=Re.shift();if((Ie==null?void 0:Ie.type)==="shift_flipped_card_optional"||(Ie==null?void 0:Ie.type)==="gravity_2_shift_after_flip"){const Ve=Ne(ne,Ie.sourceCardId),it=Oo(ne,Ie.sourceCardId);if(!Ve||!Ve.card.isFaceUp||!it){const nt=Ve?`${Ve.card.protocol}-${Ve.card.value}`:"the source card";let Rt=te(ne,Ie.actor,`Shift from ${nt} was cancelled because the source is no longer active.`);if(Re.length>0){const Zt=Re.shift();return{...Rt,actionRequired:Zt,queuedActions:Re}}else return ie({...Rt,actionRequired:null,queuedActions:[]})}}return{...ne,actionRequired:Ie,queuedActions:Re}}if(be){if(ne.queuedActions&&ne.queuedActions.length>0){const je=[...ne.queuedActions],Re=je.shift();if((Re==null?void 0:Re.type)==="execute_remaining_custom_effects"){const Ie={...ne,queuedActions:[Re,...je]},Ve=Oa(Ie);return Ve.actionRequired?Ve:ne}return{...ne,actionRequired:Re,queuedActions:je}}return ne}if(De&&ce&&ce.card.isFaceUp&&(!((De.position||"middle")!=="top")||Se)){const Ve=ne[ce.owner].lanes.findIndex(nn=>nn.some(an=>an.id===z.sourceCardId)),it=z.actor==="player"?"opponent":"player",nt=De.trigger||"on_play",Rt={cardOwner:z.actor,actor:z.actor,currentTurn:ne.turn,opponent:it,triggerType:nt};if(ne=ct(ce.card,Ve,ne,Rt,De).newState,Ne(ne,z.sourceCardId),ne.actionRequired)return ne}return ie(ne)}},i=!1;break}case"plague_4_opponent_delete":{const O=Ne(t,n);if(!O)return{nextState:t};const X=t.actionRequired.actor;r=te(r,X,"Plague-4: Opponent deletes one of their face-down cards.");const M={...r.stats[X],cardsDeleted:r.stats[X].cardsDeleted+1},$={...r[X],stats:M};r={...r,[X]:$,stats:{...r.stats,[X]:M}};const B=t[O.owner].lanes.findIndex(L=>L.some(T=>T.id===n)),I=t[O.owner].lanes[B],D=I&&I.length>0&&I[I.length-1].id===n;r=tt(r),r.actionRequired=null,s={animationRequests:[{type:"delete",cardId:n,owner:O.owner}],onCompleteCallback:(L,T)=>{let P=dt(L,"after_delete",{player:X}).newState;D&&(P=Xn(P,O.owner,B).newState);const Z=Ne(P,t.actionRequired.sourceCardId),G=(Z==null?void 0:Z.owner)||t.turn,A={type:"plague_4_player_flip_optional",sourceCardId:t.actionRequired.sourceCardId,optional:!0,actor:G};return P.actionRequired?P.queuedActions=[...P.queuedActions||[],A]:P.actionRequired=A,P}},i=!1;break}case"select_card_to_return":{const{logSource:O,logPhase:X,logIndentLevel:M}=t.actionRequired;O!==void 0&&(r=Ze(r,O)),X!==void 0&&(r=et(r,X)),M!==void 0&&(r._logIndentLevel=M);const{sourceCardId:$,actor:B}=t.actionRequired,D=((b=t.actionRequired)==null?void 0:b._followUpAlreadyExecuted)||(k=t.actionRequired)==null?void 0:k.followUpEffect,L=(N=t.actionRequired)==null?void 0:N.conditionalType,T=(U=t.actionRequired)==null?void 0:U.targetFilter,q=(V=t.actionRequired)==null?void 0:V.destination,P=Ne(t,n);if(P){const G=t[P.owner].lanes[P.laneIndex],A=((R=G[G.length-1])==null?void 0:R.id)===n,W=(T==null?void 0:T.position)==="covered"||(T==null?void 0:T.position)==="any";if(!A&&!W)return console.error(`[cardResolver] Invalid return target: ${P.card.protocol}-${P.card.value} is covered`),{nextState:t,requiresTurnEnd:!1}}const Z=Gd(t,n,q);if(r=Z.newState,Z.animationRequests)s={animationRequests:Z.animationRequests,onCompleteCallback:(G,A)=>{if(G.actionRequired)return G;let W=G;if(D&&$&&(L!=="if_executed"||n)){const Q=Ne(W,$);if(Q&&Q.card.isFaceUp){const ee=W[Q.owner].lanes.find(xe=>xe.some(ie=>ie.id===$)),oe=W[Q.owner].lanes.indexOf(ee),me={cardOwner:Q.owner,actor:B,currentTurn:W.turn,opponent:Q.owner==="player"?"opponent":"player"};if(W=ct(Q.card,oe,W,me,D).newState,W.actionRequired)return W}}return A(W)}};else if(D&&$&&(L!=="if_executed"||n)){const A=Ne(r,$);if(A&&A.card.isFaceUp){const W=r[A.owner].lanes.find(oe=>oe.some(me=>me.id===$)),J=r[A.owner].lanes.indexOf(W),Q={cardOwner:A.owner,actor:B,currentTurn:r.turn,opponent:A.owner==="player"?"opponent":"player"};r=ct(A.card,J,r,Q,D).newState}}r=tt(r),i=!r.actionRequired&&(!r.queuedActions||r.queuedActions.length===0);break}case"select_opponent_card_to_return":{const{sourceCardId:O,actor:X}=t.actionRequired,M=Gd(t,n);let $=M.newState;if($.actionRequired){const B={type:"flip_self",sourceCardId:O,actor:X};$.queuedActions=[B,...$.queuedActions||[]],r=$,i=!1}else{const B=Ne($,O);if(B){const I=`${B.card.protocol}-${B.card.value}`;$=te($,X,`${I}: Flips itself.`),$=mr(new Set([O]),$),$.animationState={type:"flipCard",cardId:O}}r=$,i=!0}M.animationRequests&&(s={animationRequests:M.animationRequests,onCompleteCallback:(B,I)=>B.actionRequired?B:I(B)}),r=tt(r),i||(i=!r.actionRequired&&(!r.queuedActions||r.queuedActions.length===0));break}case"select_any_card_to_flip":{const O=Ne(t,n),{count:X,sourceCardId:M,actor:$}=t.actionRequired,B=Ne(t,M);if(!B||!B.card.isFaceUp){const L=B?`${B.card.protocol}-${B.card.value}`:"a card";r=te(t,$,`Effect from ${L} was cancelled because the source is no longer active.`),r=tt(r),r.actionRequired=null,i=!0;break}let I=null;X>1&&(I={type:"select_any_card_to_flip",count:X-1,sourceCardId:M,actor:$});let D=Bd(t,n,I);if(O&&!O.card.isFaceUp){const L=Yd(D,n),T=L.newState.actionRequired;T&&T!==I&&I&&(L.newState.queuedActions=[...L.newState.queuedActions||[],I]),r=L.newState,L.animationRequests&&(s={animationRequests:L.animationRequests,onCompleteCallback:(q,P)=>q.actionRequired||q.queuedActions&&q.queuedActions.length>0?q:P(q)})}else r=D;r=tt(r),i=!r.actionRequired&&(!r.queuedActions||r.queuedActions.length===0);break}case"select_board_card_to_reveal_custom":{const{sourceCardId:O,actor:X,followUpAction:M,optional:$}=t.actionRequired,B=X.charAt(0).toUpperCase()+X.slice(1),I=Ne(t,n);if(!I)return{nextState:t,requiresTurnEnd:!0};const D=I.owner,L=t[D].lanes.findIndex(G=>G.some(A=>A.id===n));if(L===-1)return{nextState:t,requiresTurnEnd:!0};const T=[...t[D].lanes[L]],q=T.findIndex(G=>G.id===n);if(q===-1)return{nextState:t,requiresTurnEnd:!0};T[q]={...T[q],isFaceUp:!0};const P=[...t[D].lanes];P[L]=T,r={...t,[D]:{...t[D],lanes:P}};const Z=`${T[q].protocol}-${T[q].value}`;r=te(r,X,`${B} reveals ${Z}.`),r.actionRequired={type:"prompt_shift_or_flip_board_card_custom",sourceCardId:O,revealedCardId:n,followUpAction:M,optional:$!==!1,actor:X},i=!1;break}case"select_phase_effect":{const O=t.actionRequired;if(!O.availableEffects.find($=>$.cardId===n))return console.warn(`[cardResolver] Invalid phase effect selection: ${n} not in available effects`),{nextState:t};const M=O.phase==="Start"?"_selectedStartEffectId":"_selectedEndEffectId";r[M]=n,r.actionRequired=null,i=!1;break}case"select_card_for_copy_middle":{const O=t.actionRequired;if(!O.validTargetIds.includes(n))return console.warn(`[cardResolver] Invalid copy_middle target: ${n}`),{nextState:t};const X=Ne(t,n);if(!X)return console.error(`[cardResolver] Target card not found: ${n}`),{nextState:t};const{card:M,owner:$}=X;r[$].lanes.findIndex(q=>q.some(P=>P.id===n));const B=Pw(M);if(B.length===0){r=te(r,O.actor,`${M.protocol}-${M.value} has no middle commands.`),r.actionRequired=null;break}r=te(r,O.actor,`Copies the middle command of ${M.protocol}-${M.value}.`);const I=Ne(t,O.sourceCardId),D=I?r[I.owner].lanes.findIndex(q=>q.some(P=>P.id===O.sourceCardId)):0,L={cardOwner:O.actor,triggerType:"on_play"};let T=r;for(const q of B){if(q.trigger!=="on_play")continue;const P=I==null?void 0:I.card;if(!P)continue;if(T=ct(P,D,T,L,q).newState,T.actionRequired)return{nextState:T,requiresTurnEnd:!1}}T.actionRequired=null,r=T;break}default:return{nextState:t,requiresTurnEnd:!0}}if(!s&&r.actionRequired===null){if(r.queuedActions&&r.queuedActions.length>0){const O=[...r.queuedActions],X=O.shift();if((X==null?void 0:X.type)==="execute_remaining_custom_effects")return{nextState:{...tt(r),actionRequired:null,queuedActions:[X,...O]},requiresTurnEnd:!1};if((X==null?void 0:X.type)==="shift_flipped_card_optional"||(X==null?void 0:X.type)==="gravity_2_shift_after_flip"){const M=Ne(r,X.sourceCardId),$=Oo(r,X.sourceCardId);if(!M||!M.card.isFaceUp||!$){const B=M?`${M.card.protocol}-${M.card.value}`:"the source card",I=te(r,X.actor,`Shift from ${B} was cancelled because the source is no longer active.`);if(O.length>0){const D=O.shift();return(D==null?void 0:D.type)==="execute_remaining_custom_effects"?{nextState:{...I,queuedActions:[D,...O]},requiresTurnEnd:!1}:{nextState:{...I,actionRequired:D,queuedActions:O},requiresTurnEnd:!1}}else return{nextState:{...I,actionRequired:null,queuedActions:[]},requiresTurnEnd:!0}}}return(X==null?void 0:X.type)==="execute_remaining_custom_effects"?{nextState:{...r,queuedActions:[X,...O]},requiresTurnEnd:!1}:{nextState:{...r,actionRequired:X,queuedActions:O},requiresTurnEnd:!1}}}else!s&&r.actionRequired!==null&&(i=!1);return{nextState:r,requiresAnimation:s,requiresTurnEnd:i}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Si=(t,n,r,i,s,d=s)=>{var D,L,T,q,P,Z;const u={...t[s]},p=u.hand.find(G=>G.id===n);if(!p)return{newState:t};if(d===s){const G=fr(t,s,r,i,p.protocol,p);if(!G.allowed)return console.error(`Illegal Move: ${s} tried to play ${p.protocol}-${p.value} - ${G.reason}`),{newState:t}}const f=s==="player"?"opponent":"player",w=t[d==="player"?"opponent":"player"].lanes[r],g=w.length>0?w[w.length-1]:null;if(g&&g.isFaceUp&&g.protocol==="Plague"&&g.value===0)return{newState:t};if(!i&&g&&g.isFaceUp&&g.protocol==="Metal"&&g.value===2)return console.error(`Illegal Move: ${s} tried to play face-down against Metal-2 in lane ${r}`),{newState:t};if(i){const G=t[d].protocols[r],A=u.protocols[r],W=t[f].protocols[r],J=t[f].lanes.flat().some(z=>z.isFaceUp&&z.protocol==="Psychic"&&z.value===1),Q=[...t.player.lanes.flat(),...t.opponent.lanes.flat()].some(z=>z.isFaceUp&&z.protocol==="Anarchy"&&z.value===1),ee=ou(t),oe=t[s].lanes.flat().some(z=>z.isFaceUp&&z.protocol==="Spirit"&&z.value===1),me=((L=(D=p.customEffects)==null?void 0:D.bottomEffects)==null?void 0:L.some(z=>{var le,ne;return((le=z.params)==null?void 0:le.action)==="card_property"&&((ne=z.params)==null?void 0:ne.property)==="ignore_protocol_matching"}))||((q=(T=p.customEffects)==null?void 0:T.topEffects)==null?void 0:q.some(z=>{var le,ne;return((le=z.params)==null?void 0:le.action)==="card_property"&&((ne=z.params)==null?void 0:ne.property)==="ignore_protocol_matching"}))||((Z=(P=p.customEffects)==null?void 0:P.middleEffects)==null?void 0:Z.some(z=>{var le,ne;return((le=z.params)==null?void 0:le.action)==="card_property"&&((ne=z.params)==null?void 0:ne.property)==="ignore_protocol_matching"})),ke=Ri(t,s,r),xe=ns(t,p),ie=il(t,s,r,p.protocol);let K;if(xe?K=!J:d!==s?K=p.protocol===G&&!J:Q||ee?K=p.protocol!==A&&p.protocol!==W&&!J:K=(p.protocol===A||p.protocol===W||oe||me||ke||ie)&&!J,!K){const z=Q||ee?"Non-matching protocol required":"matching protocol required";return console.error(`Illegal Move: ${s} tried to play ${p.protocol}-${p.value} face-up in lane ${r} (${z}, protocols: player=${A}, opponent=${W})`),{newState:t}}}let y={...t,_committedCardId:n};t._currentEffectSource!==void 0||t._currentPhaseContext!==void 0||t._logIndentLevel!==void 0&&t._logIndentLevel>0?y._currentPhaseContext!=="after"&&(y=Ua(y)):(y=Ze(y,void 0),y=et(y,void 0),y={...y,_logIndentLevel:0});const x=s==="player"?"Player":"Opponent",S=y[d].protocols[r];let E;if(s==="opponent"&&!i)E=`${x} plays a face-down card into Protocol ${S}.`;else{const G=`${p.protocol}-${p.value}`;E=`${x} plays ${G}`,i||(E+=" face-down"),d!==s?E+=` into ${d==="player"?"Player's":"Opponent's"} Protocol ${S}.`:E+=` into Protocol ${S}.`}y=te(y,s,E),y=Ua(y);let j={newState:y};const b=y[d].lanes[r];if(b.length>0){const G=b[b.length-1];let W=dt(y,"on_cover",{player:d,cardId:G.id}).newState;if(W[d].lanes[r].some(ee=>ee.id===G.id)&&G.isFaceUp){const ee={cardOwner:d,actor:s,currentTurn:W.turn,opponent:d==="player"?"opponent":"player",triggerType:"cover"},oe={...W,_coveringCardProtocol:p.protocol};j=lu(G,r,oe,ee)}else j={newState:W}}const k=j.newState,N={...p,isFaceUp:i,isRevealed:!1},U={...k[s]},V={...U.stats,cardsPlayed:U.stats.cardsPlayed+1},R=s==="player"?"playerFromHand":"aiFromHand",O=s==="player"?i?"playerFaceUp":"playerFaceDown":i?"aiFaceUp":"aiFaceDown",X=k.detailedGameStats?{...k.detailedGameStats,cardsPlayed:{...k.detailedGameStats.cardsPlayed,[R]:k.detailedGameStats.cardsPlayed[R]+1,[O]:k.detailedGameStats.cardsPlayed[O]+1}}:void 0;let M;if(d===s){const G={...U,hand:U.hand.filter(A=>A.id!==n),lanes:U.lanes.map((A,W)=>W===r?[...A,N]:A),stats:V};M={...k,[s]:G,stats:{...k.stats,[s]:V},detailedGameStats:X}}else{const G={...U,hand:U.hand.filter(J=>J.id!==n),stats:V},A={...k[d]},W={...A,lanes:A.lanes.map((J,Q)=>Q===r?[...J,N]:J)};M={...k,[s]:G,[d]:W,stats:{...k.stats,[s]:V},detailedGameStats:X}}const $=t.queuedActions||[],B=k.queuedActions||[];if(B===$||B.length===$.length&&B.every((G,A)=>G===$[A])?$.length>0&&(M.queuedActions=$):M.queuedActions=[...$,...B],M.lastPlayedCardId=N.id,M=Ae(M),s==="opponent"&&!i&&(M=pw(M,N)),k.actionRequired||(M={...M,_logIndentLevel:0}),M=dt(M,"after_play",{player:s,cardId:N.id,laneIndex:r}).newState,k.actionRequired)return i&&(M.queuedEffect={card:N,laneIndex:r}),{newState:M,animationRequests:j.animationRequests};{if(M={...M,_committedCardId:void 0},s==="opponent")return i&&(M.queuedEffect={card:N,laneIndex:r}),{newState:M,animationRequests:j.animationRequests};let G={newState:M};if(i&&!M.actionRequired){const W={cardOwner:d,actor:s,currentTurn:M.turn,opponent:d==="player"?"opponent":"player",triggerType:"play"};G=cl(N,r,M,W)}const A=[...j.animationRequests||[],...G.animationRequests||[]];return{newState:G.newState,animationRequests:A.length>0?A:void 0}}},ls=(t,n)=>{let r=Ze(t,void 0);return r=et(r,void 0),r={...r,_logIndentLevel:0},Yw(r,n)},Mm=(t,n)=>{if(t.useControlMechanic&&t.controlCardHolder===n){let r=te(t,n,`${n==="player"?"Player":"Opponent"} has Control and may rearrange protocols before refreshing.`);return r=Ua(r),{...r,controlCardHolder:null,actionRequired:{type:"prompt_use_control_mechanic",sourceCardId:"CONTROL_MECHANIC",actor:n,originalAction:{type:"fill_hand"}}}}return ls(t,n)};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Qd=(t,n)=>{var s,d,u,p,f,h,w,g,y,m,x,S,E,j,b,k,N,U,V,R,O,X,M,$,B,I,D,L,T,q;if(!t.actionRequired)return{nextState:t};let r={...t},i=null;switch(t.actionRequired.type){case"select_lane_for_shift_all":{const{cardsToShift:P,validDestinationLanes:Z,sourceLaneIndex:G,actor:A,sourceCardId:W}=t.actionRequired;if(!Z.includes(n))return console.error(`Illegal shift: Lane ${n} is not a valid destination`),{nextState:t};if(n===G)return console.error(`Illegal shift: Cannot shift to the same lane ${G}`),{nextState:t};let J={...t};const Q=[];for(const{cardId:ee,owner:oe}of P){if(!Ne(J,ee))continue;const ke=J[oe].lanes.findIndex(K=>K.some(z=>z.id===ee));if(ke===-1||!as(J,ke,n).allowed)continue;const ie=Uo(J,ee,oe,n,A);J=ie.newState,ie.animationRequests&&Q.push(...ie.animationRequests)}if(r=J,r=tt(r),(!r.actionRequired||r.actionRequired.type==="select_lane_for_shift_all")&&(r.actionRequired=null),Q.length>0){const ee=(s=t.actionRequired)==null?void 0:s.followUpEffect,oe=(d=t.actionRequired)==null?void 0:d.conditionalType;i={animationRequests:Q,onCompleteCallback:(me,ke)=>{if(me.actionRequired||me.queuedActions&&me.queuedActions.length>0)return me;let xe=me;if(ee&&W&&(oe!=="if_executed"||Q.length>0)){const K=Ne(xe,W);if(K&&K.card.isFaceUp){const z=xe[K.owner].lanes.find(ce=>ce.some(Se=>Se.id===W)),le=xe[K.owner].lanes.indexOf(z),ne={cardOwner:K.owner,actor:A,currentTurn:xe.turn,opponent:K.owner==="player"?"opponent":"player"};if(xe=ct(K.card,le,xe,ne,ee).newState,xe.actionRequired)return xe}}return ke(xe)}}}break}case"select_lane_for_shift":{const{cardToShiftId:P,cardOwner:Z,actor:G,sourceEffect:A,originalLaneIndex:W,sourceCardId:J}=t.actionRequired;if(n===W)return console.error(`Illegal shift: Cannot shift to the same lane ${W}`),{nextState:t};const Q=t.actionRequired.validLanes;if(Q&&!Q.includes(n))return console.error(`Illegal shift: Lane ${n} not in valid lanes ${Q}`),{nextState:t};const ee=Ne(t,J),oe=Ne(t,P);if(ee&&ee.card.protocol==="Anarchy"&&ee.card.value===1&&oe&&oe.card.isFaceUp){const ie=t.player.protocols[n],K=t.opponent.protocols[n],z=oe.card.protocol;if(z===ie||z===K)return console.error(`Illegal Anarchy-1 shift: ${z}-${oe.card.value} cannot be shifted to lane ${n} (protocols: ${ie}/${K}) - matching protocol not allowed`),{nextState:t}}if(ee&&ee.card.protocol==="Gravity"&&ee.card.value===1){let ie=-1;for(let K=0;K<t[ee.owner].lanes.length;K++)if(t[ee.owner].lanes[K].some(z=>z.id===J)){ie=K;break}if(ie!==-1&&!(W===ie)&&!(n===ie))return console.error(`Illegal Gravity-1 shift: Must shift to or from Gravity lane ${ie}, but tried ${W}  ${n}`),{nextState:t}}if(t.actionRequired.destinationRestriction&&oe){const ie=t.actionRequired.destinationRestriction;if(ie.type==="non_matching_protocol"&&oe.card.isFaceUp){const K=t.player.protocols[n],z=t.opponent.protocols[n],le=oe.card.protocol;if(le===K||le===z)return console.error(`Illegal shift: ${le} cannot be shifted to lane ${n} (protocols: ${K}/${z}) - matching protocol not allowed`),{nextState:t}}if(ie.type==="to_or_from_this_lane"){const K=ie.laneIndex==="current"&&ee?(()=>{for(let z=0;z<t[ee.owner].lanes.length;z++)if(t[ee.owner].lanes[z].some(le=>le.id===J))return z;return-1})():ie.laneIndex;if(K!==void 0&&K!==-1&&!(W===K)&&!(n===K))return console.error(`Illegal shift: Must shift to or from lane ${K}, but tried ${W}  ${n}`),{nextState:t}}}const me=as(t,W,n);if(!me.allowed)return console.error(`Illegal shift: Cannot shift from lane ${W} to ${n} - ${me.reason}`),{nextState:t};const ke=Uo(t,P,Z,n,G);r=ke.newState;const xe=r.actionRequired!==null;if(ke.animationRequests)i={animationRequests:ke.animationRequests,onCompleteCallback:(ie,K)=>{var Se,De,be,Ge;let z=ie;if(xe){if(A==="speed_3_end"){const Re={type:"speed_3_self_flip_after_shift",sourceCardId:t.actionRequired.sourceCardId,actor:G};z.queuedActions=[...z.queuedActions||[],Re]}const Be=(Se=t.actionRequired)==null?void 0:Se.followUpEffect,Me=(De=t.actionRequired)==null?void 0:De.conditionalType;if(Be&&J&&(Me!=="if_executed"||P)){const Re=Ne(z,J),Ie=t._currentPhaseContext||(t.phase==="start"?"start":"end"),Ve={type:"execute_follow_up_effect",sourceCardId:J,followUpEffect:Be,actor:G,logContext:{indentLevel:1,sourceCardName:Re?`${Re.card.protocol}-${Re.card.value}`:void 0,phase:Ie}};z.queuedActions=[...z.queuedActions||[],Ve]}Ne(z,J);const He=z._pendingCustomEffects;if(He){const je=Ne(z,He.sourceCardId);if(je&&je.card.isFaceUp){const Re=z[je.owner].lanes.find(Ve=>Ve.some(it=>it.id===He.sourceCardId));if(Re&&Re.length>0&&Re[Re.length-1].id===He.sourceCardId){const Ve={type:"execute_remaining_custom_effects",sourceCardId:He.sourceCardId,laneIndex:He.laneIndex,effects:He.effects,context:He.context,actor:G,logSource:He.logSource,logPhase:He.logPhase,logIndentLevel:He.logIndentLevel};z.queuedActions=[Ve,...z.queuedActions||[]]}}delete z._pendingCustomEffects}return z}if(A==="speed_3_end"){const Be=t.actionRequired.sourceCardId;z=te(z,G,"Speed-3: Flipping itself after shifting a card."),z=mr(new Set([Be]),z),z.animationState={type:"flipCard",cardId:Be}}const le=z._pendingCustomEffects;if(le){const Be=Ne(z,le.sourceCardId);if(Be&&Be.card.isFaceUp){const Me=z[Be.owner].lanes.find(je=>je.some(Re=>Re.id===le.sourceCardId));if(Me&&Me.length>0&&Me[Me.length-1].id===le.sourceCardId){for(const je of le.effects)z=ct(Be.card,le.laneIndex,z,le.context,je).newState;delete z._pendingCustomEffects}else z=te(z,G,"Pending effects cancelled because source card is now covered."),delete z._pendingCustomEffects}else delete z._pendingCustomEffects}J&&(z=Mo(z)),z=dt(z,"after_shift",{player:G,cardId:P}).newState;const ue=(be=t.actionRequired)==null?void 0:be.followUpEffect,ce=(Ge=t.actionRequired)==null?void 0:Ge.conditionalType;if(ue&&J&&(ce!=="if_executed"||P)){const Me=Ne(z,J);if(Me&&Me.card.isFaceUp){const He=z[Me.owner].lanes.find(nt=>nt.some(Rt=>Rt.id===J)),je=z[Me.owner].lanes.indexOf(He),Re={cardOwner:Me.owner,actor:G,currentTurn:z.turn,opponent:Me.owner==="player"?"opponent":"player"},Ie=`${Me.card.protocol}-${Me.card.value}`,Ve=t._currentPhaseContext||(t.phase==="start"?"start":"end");z={...z,_logIndentLevel:1,_currentEffectSource:Ie,_currentPhaseContext:Ve},z=ct(Me.card,je,z,Re,ue).newState}}if(z=tt(z),z.actionRequired=null,z.queuedActions&&z.queuedActions.length>0){const Be=z.queuedActions[0];Be.type==="execute_remaining_custom_effects"?(z=Oa(z),z.animationState&&(z={...z,animationState:null})):(z.queuedActions=z.queuedActions.slice(1),z.actionRequired=Be)}return z._interruptedTurn?rl(z):K(z)}};else if(xe){if(A==="speed_3_end"){const le={type:"speed_3_self_flip_after_shift",sourceCardId:t.actionRequired.sourceCardId,actor:G};r.queuedActions=[...r.queuedActions||[],le]}const ie=(u=t.actionRequired)==null?void 0:u.followUpEffect,K=(p=t.actionRequired)==null?void 0:p.conditionalType;if(ie&&J&&(K!=="if_executed"||P)){const le=Ne(r,J),ne=t._currentPhaseContext||(t.phase==="start"?"start":"end"),ue={type:"execute_follow_up_effect",sourceCardId:J,followUpEffect:ie,actor:G,logContext:{indentLevel:1,sourceCardName:le?`${le.card.protocol}-${le.card.value}`:void 0,phase:ne}};r.queuedActions=[...r.queuedActions||[],ue]}}else{if(A==="speed_3_end"){const ne=t.actionRequired.sourceCardId;r=te(r,G,"Speed-3: Flipping itself after shifting a card."),r=mr(new Set([ne]),r),r.animationState={type:"flipCard",cardId:ne}}const ie=r._pendingCustomEffects;if(ie){const ne=Ne(r,ie.sourceCardId);if(ne&&ne.card.isFaceUp){const ue=r[ne.owner].lanes.find(Se=>Se.some(De=>De.id===ie.sourceCardId));if(ue&&ue.length>0&&ue[ue.length-1].id===ie.sourceCardId){for(const Se of ie.effects)r=ct(ne.card,ie.laneIndex,r,ie.context,Se).newState;delete r._pendingCustomEffects}else r=te(r,G,"Pending effects cancelled because source card is now covered."),delete r._pendingCustomEffects}else delete r._pendingCustomEffects}J&&(r=Mo(r)),r=dt(r,"after_shift",{player:G,cardId:P}).newState;const z=(f=t.actionRequired)==null?void 0:f.followUpEffect,le=(h=t.actionRequired)==null?void 0:h.conditionalType;if(z&&J&&(le!=="if_executed"||P)){const ue=Ne(r,J);if(ue&&ue.card.isFaceUp){const ce=r[ue.owner].lanes.find(Me=>Me.some(He=>He.id===J)),Se=r[ue.owner].lanes.indexOf(ce),De={cardOwner:ue.owner,actor:G,currentTurn:r.turn,opponent:ue.owner==="player"?"opponent":"player"},be=`${ue.card.protocol}-${ue.card.value}`,Ge=t._currentPhaseContext||(t.phase==="start"?"start":"end");r={...r,_logIndentLevel:1,_currentEffectSource:be,_currentPhaseContext:Ge},r=ct(ue.card,Se,r,De,z).newState}}if(r=tt(r),r.actionRequired=null,r.queuedActions&&r.queuedActions.length>0){const ne=r.queuedActions[0];if(ne.type==="execute_remaining_custom_effects"){if(r=Oa(r),r.animationState&&!r.actionRequired){const ue=r.animationState;ue.type==="draw"&&(i={animationRequests:[{type:"draw",player:ue.player,count:ue.count}],onCompleteCallback:(ce,Se)=>{const De={...ce,animationState:null};return Se(De)}},r={...r,animationState:null})}}else r.queuedActions=r.queuedActions.slice(1),r.actionRequired=ne}}break}case"shift_flipped_card_optional":{const P=t.actionRequired.cardId,Z=t.actionRequired.actor;let G=null;for(const ee of["player","opponent"])if(t[ee].lanes.flat().some(oe=>oe.id===P)){G=ee;break}if(!G){console.error("[shift_flipped_card_optional] Card not found on board:",P),r=t;break}const A=(w=t.actionRequired)==null?void 0:w.followUpEffect,W=(g=t.actionRequired)==null?void 0:g.conditionalType,J=(y=t.actionRequired)==null?void 0:y.sourceCardId,Q=Uo(t,P,G,n,Z);if(r=Q.newState,A&&J&&(W!=="if_executed"||P)){const oe=Ne(r,J),me=t._currentPhaseContext||(t.phase==="start"?"start":"end"),ke={type:"execute_follow_up_effect",sourceCardId:J,followUpEffect:A,actor:Z,logContext:{indentLevel:1,sourceCardName:oe?`${oe.card.protocol}-${oe.card.value}`:void 0,phase:me}};r={...r,queuedActions:[...r.queuedActions||[],ke]}}Q.animationRequests&&(i={animationRequests:Q.animationRequests,onCompleteCallback:(ee,oe)=>oe(ee)});break}case"select_lane_for_play":{const{cardInHandId:P,isFaceDown:Z,actor:G,source:A,disallowedLaneIndex:W,validLanes:J,preSelectedLane:Q}=t.actionRequired,ee=Q!==void 0?Q:n;if(W!==void 0&&ee===W)return{nextState:t,requiresTurnEnd:!1};if(J&&!J.includes(ee))return{nextState:t,requiresTurnEnd:!1};if(A==="deck"){const K=(m=t.actionRequired)==null?void 0:m.followUpEffect;(x=t.actionRequired)==null||x.conditionalType;const z=(S=t.actionRequired)==null?void 0:S.sourceCardId,le=(E=t.actionRequired)==null?void 0:E.preDrawnCard,ne={...t,actionRequired:null},ue=ne[G];let ce,Se=ue.deck,De=ue.discard;if(le)ce={...le,isFaceUp:!Z};else{const He=Qn(ue.deck,ue.discard,1);if(Se=He.remainingDeck,De=He.newDiscard,He.drawnCards.length===0){console.error("No cards in deck/discard to play"),r=ne;break}ce={...He.drawnCards[0],id:st(),isFaceUp:!Z}}const be=[...ue.lanes];be[ee]=[...be[ee],ce];const Ge={...ue,lanes:be,deck:Se,discard:De};r={...ne,[G]:Ge,lastCustomEffectTargetCardId:ce.id};const Be=G==="player"?"Player":"Opponent",Me=Z?"face-down":"face-up";r=te(r,G,`${Be} plays ${ce.protocol}-${ce.value} ${Me} from deck.`),i={animationRequests:[{type:"play",cardId:ce.id,owner:G,laneIndex:ee,isFaceUp:ce.isFaceUp}],onCompleteCallback:(He,je)=>{let Re=He;if(K&&z){const Ie=Ne(Re,z);if(Ie&&Ie.card.isFaceUp){const Ve=Re[Ie.owner].lanes.find(Zt=>Zt.some(nn=>nn.id===z)),it=Re[Ie.owner].lanes.indexOf(Ve),nt={cardOwner:Ie.owner,actor:G,currentTurn:Re.turn,opponent:Ie.owner==="player"?"opponent":"player"};if(Re=ct(Ie.card,it,Re,nt,K).newState,Re.actionRequired)return Re}}return je(Re)}};break}if(A==="trash"){const K=(j=t.actionRequired)==null?void 0:j.preDrawnCard,z=(b=t.actionRequired)==null?void 0:b.sourceCardId,le=(k=t.actionRequired)==null?void 0:k.followUpEffect,ne=(N=t.actionRequired)==null?void 0:N.conditionalType,ue=(U=t.actionRequired)==null?void 0:U.useNormalPlayRules;if(!K){console.error("No preDrawnCard for trash play"),r={...t,actionRequired:null};break}const ce={...t,actionRequired:null},Se=ce[G];let De;if(typeof Z=="boolean")De=!Z;else if(ue){const je=G==="player"?"opponent":"player",Re=t[G].protocols[ee],Ie=t[je].protocols[ee],Ve=K.protocol===Re||K.protocol===Ie,it=Ri(t,G,ee);De=Ve||it}else De=!0;const be={...K,isFaceUp:De},Ge=[...Se.lanes];Ge[ee]=[...Ge[ee],be];const Be={...Se,lanes:Ge};r={...ce,[G]:Be,lastCustomEffectTargetCardId:be.id};const Me=G==="player"?"Player":"Opponent",He=De?"face-up":"face-down";r=te(r,G,`${Me} plays ${be.protocol}-${be.value} ${He} from trash.`),r=Ae(r),i={animationRequests:[{type:"play",cardId:be.id,owner:G,laneIndex:ee,isFaceUp:be.isFaceUp}],onCompleteCallback:(je,Re)=>{let Ie=je;if(be.isFaceUp){const Ve=Ne(Ie,be.id);if(Ve){const it={cardOwner:G,actor:G,currentTurn:Ie.turn,opponent:G==="player"?"opponent":"player",triggerType:"play"};if(Ie=cl(Ve.card,ee,Ie,it).newState,Ie.actionRequired)return le&&z&&(Ie={...Ie,queuedActions:[...Ie.queuedActions||[],{type:"execute_followup_effect",sourceCardId:z,followUpEffect:le,conditionalType:ne,actor:G}]}),Ie}}if(le&&z){const Ve=Ne(Ie,z);if(Ve&&Ve.card.isFaceUp){const it=Ie[Ve.owner].lanes.find(nn=>nn.some(an=>an.id===z)),nt=Ie[Ve.owner].lanes.indexOf(it),Rt={cardOwner:Ve.owner,actor:G,currentTurn:Ie.turn,opponent:Ve.owner==="player"?"opponent":"player"};if(Ie=ct(Ve.card,nt,Ie,Rt,le).newState,Ie.actionRequired)return Ie}}return Re(Ie)}};break}const oe=t[G].hand.find(K=>K.id===P);if(!oe){console.error("Card for play not found in hand"),r={...t,actionRequired:null};break}const me={...t,actionRequired:null};let ke;if(typeof Z=="boolean")ke=!Z;else{const K=t[G].lanes.flat().some(ce=>ce.isFaceUp&&ce.protocol==="Spirit"&&ce.value===1),z=((R=(V=oe.customEffects)==null?void 0:V.bottomEffects)==null?void 0:R.some(ce=>{var Se,De;return((Se=ce.params)==null?void 0:Se.action)==="card_property"&&((De=ce.params)==null?void 0:De.property)==="ignore_protocol_matching"}))||((X=(O=oe.customEffects)==null?void 0:O.topEffects)==null?void 0:X.some(ce=>{var Se,De;return((Se=ce.params)==null?void 0:Se.action)==="card_property"&&((De=ce.params)==null?void 0:De.property)==="ignore_protocol_matching"}))||(($=(M=oe.customEffects)==null?void 0:M.middleEffects)==null?void 0:$.some(ce=>{var Se,De;return((Se=ce.params)==null?void 0:Se.action)==="card_property"&&((De=ce.params)==null?void 0:De.property)==="ignore_protocol_matching"})),le=G==="player"?"opponent":"player",ne=t[le].lanes.flat().some(ce=>ce.isFaceUp&&ce.protocol==="Psychic"&&ce.value===1),ue=il(t,G,ee,oe.protocol);ke=(K||z||ue||oe.protocol===t[G].protocols[ee]||oe.protocol===t[le].protocols[ee])&&!ne}const{newState:xe,animationRequests:ie}=Si(me,P,ee,ke,G);r=xe,ie&&(i={animationRequests:ie,onCompleteCallback:(K,z)=>(K.queuedActions&&K.queuedActions.length>0,z(K))});break}case"select_lane_for_delete":{const P=t.actionRequired.actor,Z=P==="player"?"Player":"Opponent",G=t.player.protocols[n],A=t.actionRequired.targetFilter||{},W=Ne(t,t.actionRequired.sourceCardId),J=W?`${W.card.protocol}-${W.card.value}`:"a card effect",Q=t.actionRequired.count||1,ee=t.actionRequired.deleteAll===!0,oe=t.actionRequired.validLanes;if(oe&&!oe.includes(n))return console.error(`Illegal delete lane selection: Lane ${n} not in valid lanes ${oe}`),{nextState:t};r=te(r,P,`${J}: ${Z} targets Protocol ${G}.`);const me=new Map;for(const K of["player","opponent"]){const z=t[K].lanes[n];me.set(K,z.length>0?z[z.length-1].id:null)}const ke=[],xe=[],ie=new Set;for(const K of["player","opponent"]){const z=t[K],le=z.lanes[n].some(ue=>ue.isFaceUp&&ue.protocol==="Darkness"&&ue.value===2)?4:2,ne=z.lanes[n];for(let ue=0;ue<ne.length;ue++){const ce=ne[ue],Se=ue===ne.length-1,De=ce.isFaceUp?ce.value:le;if(A.valueRange){const{min:Be,max:Me}=A.valueRange;if(De<Be||De>Me)continue}if(A.faceState==="face_up"&&!ce.isFaceUp||A.faceState==="face_down"&&ce.isFaceUp||A.owner==="own"&&K!==P||A.owner==="opponent"&&K===P||A.position==="uncovered"&&!Se||A.position==="covered"&&Se)continue;ke.push({type:"delete",cardId:ce.id,owner:K}),ie.add(ce.id);const be=K==="player"?"Player's":"Opponent's",Ge=ce.isFaceUp?`${ce.protocol}-${ce.value}`:"a face-down card";if(xe.push(`${be} ${Ge}`),!ee&&ke.length>=Q)break}if(!ee&&ke.length>=Q)break}if(xe.length>0){r=te(r,P,`${J}: Deleting ${xe.join(", ")}.`);const K={...r.stats[P],cardsDeleted:r.stats[P].cardsDeleted+xe.length},z={...r[P],stats:K};r={...r,[P]:z,stats:{...r.stats,[P]:K}}}if(r=tt(r),r.actionRequired=null,ke.length>0){const K=(B=t.actionRequired)==null?void 0:B.followUpEffect,z=(I=t.actionRequired)==null?void 0:I.conditionalType,le=t.actionRequired.sourceCardId;i={animationRequests:ke,onCompleteCallback:(ne,ue)=>{let ce=ne;ce=dt(ce,"after_delete",{player:P}).newState;const De=[];for(const be of["player","opponent"]){const Ge=me.get(be),Be=ce[be].lanes[n];Ge&&ie.has(Ge)&&Be.length>0&&De.push(be)}for(let be=0;be<De.length;be++){const Ge=De[be];if(ce=Xn(ce,Ge,n).newState,ce.actionRequired&&be<De.length-1){const Me=De.slice(be+1);for(const He of Me)ce.queuedActions=[...ce.queuedActions||[],{type:"pending_uncover_effect",owner:He,laneIndex:n}];return ce}}if(K&&le&&(z!=="if_executed"||ke.length>0)){const Ge=Ne(ce,le);if(Ge&&Ge.card.isFaceUp){const Be=ce[Ge.owner].lanes.find(Re=>Re.some(Ie=>Ie.id===le)),Me=ce[Ge.owner].lanes.indexOf(Be),He={cardOwner:Ge.owner,actor:P,currentTurn:ce.turn,opponent:Ge.owner==="player"?"opponent":"player"};if(ce=ct(Ge.card,Me,ce,He,K).newState,ce.actionRequired)return ce}}return ue(ce)}}}break}case"select_lane_for_return":{const P=t.actionRequired.actor,Z=P==="player"?"Player":"Opponent",G=t.player.protocols[n],A=t.actionRequired.targetFilter||{},W=Ne(t,t.actionRequired.sourceCardId),J=W?`${W.card.protocol}-${W.card.value}`:"a card effect";r=te(r,P,`${J}: ${Z} targets Protocol ${G}.`);const Q=[],ee=[];for(const oe of["player","opponent"]){const me=t[oe],ke=me.lanes[n].some(xe=>xe.isFaceUp&&xe.protocol==="Darkness"&&xe.value===2)?4:2;for(const xe of me.lanes[n]){const ie=xe.isFaceUp?xe.value:ke;if(A.valueEquals!==void 0&&ie!==A.valueEquals||A.faceState==="face_up"&&!xe.isFaceUp||A.faceState==="face_down"&&xe.isFaceUp||A.owner==="own"&&oe!==P||A.owner==="opponent"&&oe===P)continue;Q.push({type:"return",cardId:xe.id,owner:oe});const K=oe==="player"?"Player's":"Opponent's",z=xe.isFaceUp?`${xe.protocol}-${xe.value}`:"a face-down card";ee.push(`${K} ${z}`)}}if(Q.length===0){r=te(r,P,`${J}: No matching cards in Protocol ${G}.`),r=tt(r),r.actionRequired=null;break}if(ee.length>0&&(r=te(r,P,`${J}: Returning ${ee.join(", ")}.`)),r=tt(r),r.actionRequired=null,Q.length>0){const oe=(D=t.actionRequired)==null?void 0:D.followUpEffect,me=(L=t.actionRequired)==null?void 0:L.conditionalType,ke=t.actionRequired.sourceCardId;i={animationRequests:Q,onCompleteCallback:(xe,ie)=>{let K=xe;if(oe&&ke&&(me!=="if_executed"||Q.length>0)){const le=Ne(K,ke);if(le&&le.card.isFaceUp){const ne=K[le.owner].lanes.find(De=>De.some(be=>be.id===ke)),ue=K[le.owner].lanes.indexOf(ne),ce={cardOwner:le.owner,actor:P,currentTurn:K.turn,opponent:le.owner==="player"?"opponent":"player"};if(K=ct(le.card,ue,K,ce,oe).newState,K.actionRequired)return K}}return ie(K)}}}break}case"select_lane_for_delete_all":{const P=t.actionRequired.actor,Z=P==="player"?"Player":"Opponent",G=t.player.protocols[n],A=t.actionRequired.minCards||8;if(!(t.actionRequired.validLanes||[0,1,2]).includes(n)){r=te(r,P,"Cannot select this lane for deletion.");break}const J=t.player.lanes[n].length+t.opponent.lanes[n].length;if(J<A){r=te(r,P,`Cannot delete ${G} line (only ${J} cards, need ${A}+).`),r=tt(r),r.actionRequired=null;break}const Q=Ne(t,t.actionRequired.sourceCardId),ee=Q?`${Q.card.protocol}-${Q.card.value}`:"Effect";r=te(r,P,`${ee}: ${Z} deletes all cards in ${G} line.`);const oe=[];for(const xe of["player","opponent"])for(const ie of t[xe].lanes[n])oe.push({type:"delete",cardId:ie.id,owner:xe});const me={...r.stats[P],cardsDeleted:r.stats[P].cardsDeleted+oe.length},ke={...r[P],stats:me};if(r={...r,[P]:ke,stats:{...r.stats,[P]:me}},r=tt(r),r.actionRequired=null,oe.length>0){const xe=(T=t.actionRequired)==null?void 0:T.followUpEffect,ie=(q=t.actionRequired)==null?void 0:q.conditionalType,K=t.actionRequired.sourceCardId;i={animationRequests:oe,onCompleteCallback:(z,le)=>{let ne=z;if(ne=dt(ne,"after_delete",{player:P}).newState,xe&&K&&(ie!=="if_executed"||oe.length>0)){const Se=Ne(ne,K);if(Se&&Se.card.isFaceUp){const De=ne[Se.owner].lanes.find(Me=>Me.some(He=>He.id===K)),be=ne[Se.owner].lanes.indexOf(De),Ge={cardOwner:Se.owner,actor:P,currentTurn:ne.turn,opponent:Se.owner==="player"?"opponent":"player"};if(ne=ct(Se.card,be,ne,Ge,xe).newState,ne.actionRequired)return ne}}return le(ne)}}}break}case"select_lane_to_shift_revealed_board_card_custom":{const{revealedCardId:P,actor:Z}=t.actionRequired,G=Ne(t,P);if(G){const A=Uo(t,P,G.owner,n,Z);r=A.newState,A.animationRequests&&(i={animationRequests:A.animationRequests,onCompleteCallback:(W,J)=>W.actionRequired?W:J(W)})}break}case"select_lanes_for_swap_stacks":{const{actor:P,sourceCardId:Z,validLanes:G,selectedFirstLane:A}=t.actionRequired;if(!G.includes(n))return console.error(`Illegal swap_stacks: Lane ${n} is not a valid selection`),{nextState:t};if(A===void 0)r.actionRequired={type:"select_lanes_for_swap_stacks",actor:P,sourceCardId:Z,validLanes:G.filter(W=>W!==n),selectedFirstLane:n},r=te(r,P,`Selected lane ${n+1} for swap.`);else{const W=A,J=n,Q=[...r[P].lanes[W]],ee=[...r[P].lanes[J]];r[P].lanes[W]=ee,r[P].lanes[J]=Q,r=te(r,P,`Swapped all cards between lane ${W+1} and lane ${J+1}.`),r.actionRequired=null}break}default:return{nextState:t}}return{nextState:Ae(r),requiresAnimation:i}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const fm=(t,n)=>{if(t.processedSpeed1TriggerThisTurn)return t;if(t[n].lanes.flat().some(s=>s.isFaceUp&&s.protocol==="Speed"&&s.value===1)){let s={...t};return s=Ze(s,"Speed-1"),s=et(s,void 0),s=te(s,n,"Triggers after clearing cache: Draw 1 card."),s=gr(s,n,1),s.processedSpeed1TriggerThisTurn=!0,s=Ze(s,void 0),s.phase="end",s}return t},hm=(t,n,r,i,s,d,u)=>{const p=Ne(t,s);if(!p)return t;const f=t[d].hand.length,h=Math.max(0,(i||0)-f);if(!(r==="then"||r==="if_executed"&&h>0))return t;const g=`${p.card.protocol}-${p.card.value}`;let y=Ze(t,g);y=et(y,"middle"),u!==void 0&&(y={...y,_logIndentLevel:u});let m=-1;for(let E=0;E<y[p.owner].lanes.length;E++)if(y[p.owner].lanes[E].some(j=>j.id===s)){m=E;break}if(m===-1)return y;const x={cardOwner:p.owner,opponent:p.owner==="player"?"opponent":"player",currentTurn:y.turn,actor:d,discardedCount:h};return ct(p.card,m,y,x,n).newState},hr=(t,n,r)=>{var X,M,$,B;const i=t[r],s=new Set(n),d=i.hand.filter(I=>s.has(I.id));if(d.length===0)return t;const u=i.hand.filter(I=>!s.has(I.id)),p=((X=t.animationState)==null?void 0:X.type)==="discardCard"&&((M=t.animationState.originalAction)==null?void 0:M.type)==="discard"?t.animationState.originalAction:(($=t.actionRequired)==null?void 0:$.type)==="discard"?t.actionRequired:null,f=(p==null?void 0:p.discardTo)||"own_trash",h=r==="player"?"opponent":"player",w=f==="opponent_trash"?h:r,g=d.map(({id:I,isFaceUp:D,...L})=>L),y={...i.stats,cardsDiscarded:i.stats.cardsDiscarded+d.length},m={...i,hand:u,stats:y};w===r&&(m.discard=[...i.discard,...g]),p==null||p.followUpEffect,p==null||p.conditionalType,p==null||p.previousHandSize;let x;if(w===h){const I=t[h],D={...I,discard:[...I.discard,...g]};x={...t,[r]:m,[h]:D,stats:{...t.stats,[r]:y},actionRequired:null}}else x={...t,[r]:m,stats:{...t.stats,[r]:y},actionRequired:null};if(p!=null&&p.sourceCardId){const I=x.player.lanes.flat().find(D=>D.id===p.sourceCardId)||x.opponent.lanes.flat().find(D=>D.id===p.sourceCardId);if(I){const D=`${I.protocol}-${I.value}`;x=Ze(x,D),x=et(x,"middle")}else x=Ze(x,void 0),x=et(x,void 0),x={...x,_logIndentLevel:0}}else x=Ze(x,void 0),x=et(x,void 0);const S=r==="player"?"Player":"Opponent",E=w!==r?" into their trash":"";let j;if(r==="player"||d.every(I=>I.isRevealed)){const I=d.map(D=>`${D.protocol}-${D.value}`).join(", ");j=`${S} discards ${I}${E}.`}else{const I=d.length===1?"card":"cards";j=`${S} discards ${d.length} ${I}${E}.`}x=te(x,r,j);const b=(I,D)=>{var W;const L=t.phase==="hand_limit"&&!(D!=null&&D.sourceCardId);let T=I;L&&(T=Mo(T),T=fm(T,r),T=dt(T,"after_clear_cache",{player:r}).newState,((W=T.processedClearCacheTriggerIds)==null?void 0:W.length)>0&&(T.phase="end")),T=yw(T,r,D==null?void 0:D.sourceEffect,D==null?void 0:D.sourceCardId);const q=T.actionRequired,P=(D==null?void 0:D._savedIndentLevel)||T._logIndentLevel||1;if(q&&(T.actionRequired=null),T=dt(T,"after_discard",{player:r}).newState,T=dt(T,"after_opponent_discard",{player:r==="player"?"opponent":"player"}).newState,q){const J=q.actor,Q=J?T[J].hand.length:0,ee=q.count||1,oe=Math.min(ee,Q);oe<=0||(T.actionRequired?T.queuedActions=[{...q,type:q.type,count:oe,_savedIndentLevel:P},...T.queuedActions||[]]:T.actionRequired={...q,count:oe})}return T};if(p&&p.actor===r){const I=p.count-n.length;if(I>0)return x.actionRequired={...p,count:I},x;if(p.followUpEffect){const D=x._logIndentLevel||2;let T=dt(x,"after_discard",{player:r}).newState;return T=dt(T,"after_opponent_discard",{player:r==="player"?"opponent":"player"}).newState,T.actionRequired?(T._pendingFollowUpEffect={followUpEffect:p.followUpEffect,conditionalType:p.conditionalType,previousHandSize:p.previousHandSize,sourceCardId:p.sourceCardId,actor:r,savedIndentLevel:D},T):hm(T,p.followUpEffect,p.conditionalType,p.previousHandSize,p.sourceCardId,r,D)}return b(x,p)}const k=t.actionRequired;if(k&&k.type==="discard"&&k.actor===r){const I=k.count-n.length;if(I>0)return x.actionRequired={...k,count:I},x;if(k.followUpEffect){const D=x._logIndentLevel||2;let T=dt(x,"after_discard",{player:r}).newState;return T=dt(T,"after_opponent_discard",{player:r==="player"?"opponent":"player"}).newState,T.actionRequired?(T._pendingFollowUpEffect={followUpEffect:k.followUpEffect,conditionalType:k.conditionalType,previousHandSize:k.previousHandSize,sourceCardId:k.sourceCardId,actor:r,savedIndentLevel:D},T):hm(T,k.followUpEffect,k.conditionalType,k.previousHandSize,k.sourceCardId,r,D)}return b(x,k)}const N=t.phase==="hand_limit";x=dt(x,"after_discard",{player:r}).newState;let O=dt(x,"after_opponent_discard",{player:r==="player"?"opponent":"player"}).newState;return N&&(O=fm(O,r),O=dt(O,"after_clear_cache",{player:r}).newState,((B=O.processedClearCacheTriggerIds)==null?void 0:B.length)>0&&(O.phase="end")),O},Jw=(t,n)=>{var u;if(((u=t.actionRequired)==null?void 0:u.type)!=="plague_2_player_discard")return t;const r=t.actionRequired.actor,i=r==="player"?"opponent":"player";let s=hr(t,n,r);const d=n.length+1;return s[i].hand.length>0?s.actionRequired={type:"discard",actor:i,count:Math.min(d,s[i].hand.length),sourceCardId:t.actionRequired.sourceCardId}:(s=tt(s),s.actionRequired=null),s},Pd=(t,n)=>{var u;if(((u=t.actionRequired)==null?void 0:u.type)!=="plague_2_opponent_discard")return t;const r=t.actionRequired.actor,i=r==="player"?"opponent":"player";let s=hr(t,n,r);const d=n.length+1;return s[i].hand.length>0?s.actionRequired={type:"discard",actor:i,count:Math.min(d,s[i].hand.length),sourceCardId:t.actionRequired.sourceCardId}:(s=tt(s),s.actionRequired=null),s},Ud=(t,n)=>{var h,w,g,y;const r=((h=t.actionRequired)==null?void 0:h.type)==="discard"&&((w=t.actionRequired)==null?void 0:w.variableCount),i=((g=t.actionRequired)==null?void 0:g.type)==="discard"&&t.actionRequired.count>1,s=((y=t.actionRequired)==null?void 0:y.type)==="select_cards_from_hand_to_discard_for_fire_4";if(!r&&!i&&!s)return t;const d=t.actionRequired.actor,u=t.actionRequired.sourceCardId;let p=hr(t,n,d);if((r||i)&&u||i&&!u)return p;const f=n.length+1;return p=te(p,d,`Fire-4: Drawing ${f} card(s).`),p=gr(p,d,f),p},Od=(t,n)=>{var f;if(((f=t.actionRequired)==null?void 0:f.type)!=="select_cards_from_hand_to_discard_for_hate_1")return t;const{sourceCardId:r,actor:i}=t.actionRequired;let s=hr(t,n,i);const u=vw(s,[]),p=Math.min(2,u);return p>0?s.actionRequired={type:"select_cards_to_delete",count:p,sourceCardId:r,disallowedIds:[],actor:i}:(s=te(s,i,"Hate-1: No valid targets to delete."),s=tt(s),s.actionRequired=null),s};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const ts=(t,n,r)=>{const i=t.turn,s=i==="player"?"opponent":"player";let d={...t};if(d.compileBlockedPlayer===i&&d.compileBlockedUntilTurn>(d.turnNumber||0))return d=te(d,i,`${i==="player"?"Player":"Opponent"} can't compile - blocked by opponent's effect.`),d;if(d.useControlMechanic&&d.controlCardHolder===i){const D=i==="player"?"Player":"Opponent";return d=Ze(d,void 0),d=et(d,void 0),d={...d,_logIndentLevel:0},d=te(d,i,`${D} has Control and may rearrange protocols before compiling.`),d=Ua(d),d.actionRequired={type:"prompt_use_control_mechanic",sourceCardId:"CONTROL_MECHANIC",actor:i,originalAction:{type:"compile",laneIndex:n}},d.controlCardHolder=null,d}let f={...d[i]},h={...d[s]};const w=f.compiled[n],g=[];for(const D of[i,s])d[D].lanes[n].forEach(T=>{if(T.isFaceUp){const q=T;q.customEffects&&q.customEffects.topEffects&&q.customEffects.topEffects.some(Z=>Z.trigger==="before_compile_delete")&&g.push({card:T,owner:D})}});for(const{card:D,owner:L}of g)d=dt(d,"before_compile_delete",{player:L,cardId:D.id}).newState;f={...d[i]},h={...d[s]};const y=D=>{if(D.protocol==="Speed"&&D.value===2&&D.isFaceUp)return!0;const L=D;return L.customEffects&&L.customEffects.topEffects&&D.isFaceUp?L.customEffects.topEffects.some(T=>{var q,P;return T.trigger==="before_compile_delete"&&((q=T.params)==null?void 0:q.action)==="shift"&&((P=T.params)==null?void 0:P.shiftSelf)===!0}):!1},m=[],x=[],S=f.lanes[n].filter(D=>y(D)?(m.push(D),!1):!0),E=h.lanes[n].filter(D=>y(D)?(x.push(D),!1):!0),j={...f.stats},b={...h.stats};f.discard=[...f.discard,...S.map(({id:D,isFaceUp:L,...T})=>T)],h.discard=[...h.discard,...E.map(({id:D,isFaceUp:L,...T})=>T)];const k=[...f.lanes];k[n]=m,f.lanes=k;const N=[...h.lanes];N[n]=x,h.lanes=N;const U=[...f.compiled];if(U[n]=!0,f.compiled=U,d={...d,[i]:f,[s]:h,stats:{...d.stats,[i]:j,[s]:b}},d.detailedGameStats){const D=w,L=i==="player"?D?"playerRecompile":"playerFirstCompile":D?"aiRecompile":"aiFirstCompile";d={...d,detailedGameStats:{...d.detailedGameStats,compiles:{...d.detailedGameStats.compiles,[L]:d.detailedGameStats.compiles[L]+1}}}}d=Ze(d,void 0),d=et(d,void 0),d={...d,_logIndentLevel:0};const V=i==="player"?"Player":"Opponent",R=f.protocols[n];if(d=te(d,i,`${V} compiles Protocol ${R}!`),w&&(d=te(d,i,`${V} draws 1 card from the opponent's deck as a re-compile reward.`),d=Gw(d,i,1)),d=Ae(d),f.compiled.every(D=>D===!0))return d.winner=i,r(i,d),d;S.length+E.length>0&&(d=dt(d,"after_delete",{player:i}).newState),d=dt(d,"after_compile",{player:i}).newState,d=dt(d,"after_opponent_compile",{player:s}).newState;const I=[...m,...x].map(D=>{const L=Ne(d,D.id).owner,T=D.isFaceUp?`${D.protocol}-${D.value}`:"Card";return d=te(d,L,`${T} survives compilation and must be shifted.`),{type:"select_lane_for_shift",cardToShiftId:D.id,cardOwner:L,originalLaneIndex:n,sourceCardId:D.id,actor:L}});if(I.length>0){const D=I.shift();d.actionRequired=D,d.queuedActions=I,D.actor!==i&&(d._interruptedTurn=i,d._interruptedPhase=d.phase,d.turn=D.actor)}else d.actionRequired=null,d.queuedActions=[];return d},Hm=(t,n)=>t,ex=(t,n)=>{var m;if(((m=t.actionRequired)==null?void 0:m.type)!=="select_card_from_hand_to_play")return t;const{disallowedLaneIndex:r,sourceCardId:i,isFaceDown:s,actor:d,destinationRule:u,condition:p,faceDown:f,targetLaneIndex:h,validLanes:w,selectableCardIds:g,valueFilter:y}=t.actionRequired;return g&&!g.includes(n)?t:h!==void 0?{...t,actionRequired:{type:"select_lane_for_play",cardInHandId:n,sourceCardId:i,isFaceDown:s||f,actor:d,source:"hand",preSelectedLane:h}}:{...t,actionRequired:{type:"select_lane_for_play",cardInHandId:n,disallowedLaneIndex:r,sourceCardId:i,isFaceDown:s||f,actor:d,destinationRule:u,condition:p,validLanes:w}}},mm=t=>{if(!t.actionRequired||!("optional"in t.actionRequired)||!t.actionRequired.optional)return t;const n="actor"in t.actionRequired?t.actionRequired.actor:t.turn,r=n==="player"?"Player":"Opponent";let i={...t,actionRequired:null};return i=te(i,n,`${r} skips the optional action.`),i},ym=t=>{var d;if(((d=t.actionRequired)==null?void 0:d.type)!=="reveal_opponent_hand")return t;const n=t.actionRequired.actor,r=n==="player"?"opponent":"player";let i={...t};const s={...i[r]};if(s.hand.length>0){s.hand=s.hand.map(f=>({...f,isRevealed:!0})),i[r]=s;const u=Ne(i,t.actionRequired.sourceCardId),p=u?`${u.card.protocol}-${u.card.value}`:"A card effect";i=te(i,n,`${p}: Opponent reveals their hand.`)}return i.actionRequired=null,i},gm=(t,n)=>Bd(t,n),vm=(t,n)=>Gd(t,n).newState,Vm=(t,n)=>{var g;if(((g=t.actionRequired)==null?void 0:g.type)!=="select_card_from_revealed_deck")return t;const i=t.actionRequired.actor,s=i==="player"?"Player":"Opponent";let d={...t};const u={...d[i]},p=[...u.deck],f=p.findIndex(y=>(y.id||`deck-${p.indexOf(y)}`)===n);if(f===-1)return console.warn(`[resolveSelectRevealedDeckCard] Card ${n} not found in deck`),d.actionRequired=null,d;const h=p.splice(f,1)[0],w={...h,id:h.id||`drawn-${Date.now()}`,isFaceUp:!0};return u.deck=p,u.hand=[...u.hand,w],u.deckRevealed=!1,d[i]=u,d=te(d,i,`${s} draws ${h.protocol}-${h.value} from the revealed deck.`),d.actionRequired=null,d=tt(d),d},zm=t=>{var y;if(((y=t.actionRequired)==null?void 0:y.type)!=="reveal_deck_draw_protocol")return t;const n=t.actionRequired,r=n.actor,i=r==="player"?"Player":"Opponent",s=n.targetProtocol,d=n.shuffleAfter;let u={...t};const p={...u[r]},f=[...p.deck],h=f.filter(m=>m.protocol===s),w=f.filter(m=>m.protocol!==s),g=h.map(m=>({...m,id:st(),isFaceUp:!0}));if(p.deck=w,p.hand=[...p.hand,...g],p.deckRevealed=!1,u[r]=p,g.length>0){const m=g.map(x=>`${x.protocol}-${x.value}`).join(", ");u=te(u,r,`${i} draws ${g.length} ${s} card${g.length!==1?"s":""} (${m}).`)}else u=te(u,r,`No ${s} cards in deck.`);if(d){const m=[...u[r].deck].sort(()=>Math.random()-.5);u[r]={...u[r],deck:m},u=te(u,r,`${i} shuffles their deck.`)}return u.actionRequired=null,u=tt(u),u},cu=(t,n)=>{var d;if(((d=t.actionRequired)==null?void 0:d.type)!=="state_number")return t;const i=t.actionRequired.actor;let s=Fw(t,i,n);return s=tt(s),s},du=(t,n)=>{var d;if(((d=t.actionRequired)==null?void 0:d.type)!=="state_protocol")return t;const i=t.actionRequired.actor;let s=qw(t,i,n);return s=tt(s),s},uu=(t,n)=>{var g;if(((g=t.actionRequired)==null?void 0:g.type)!=="select_from_drawn_to_reveal")return t;const r=t.actionRequired,i=r.actor,s=i==="player"?"Player":"Opponent",d=r.statedNumber,u=r.thenAction;let p={...t};const h=p[i].hand.find(y=>y.id===n);if(!h)return p.actionRequired=null,p=tt(p),p;const w=d!==void 0?` (stated value: ${d})`:"";return p=te(p,i,`${s} reveals ${h.protocol}-${h.value}${w}.`),p.lastCustomEffectTargetCardId=n,p.actionRequired=null,u==="may_play"&&(p.actionRequired={type:"prompt_optional_effect",actor:i,sourceCardId:r.sourceCardId,effectDef:{params:{action:"play",source:"hand",useCardFromPreviousEffect:!0}},optional:!0}),p},pu=t=>{var h;if(((h=t.actionRequired)==null?void 0:h.type)!=="confirm_deck_discard")return t;const n=t.actionRequired,{sourceCardId:r,followUpEffect:i,conditionalType:s,laneIndex:d,actor:u,discardedCard:p}=n;let f={...t};if(f.actionRequired=null,i&&r){const w=Ne(f,r);if(w&&w.card.isFaceUp){const g={cardOwner:w.owner,opponent:w.owner==="player"?"opponent":"player"},y=d!==void 0?d:f[w.owner].lanes.findIndex(x=>x.some(S=>S.id===r));if(s==="if_protocol_matches_stated"){const x=p==null?void 0:p.protocol,S=f.lastStatedProtocol;if(!S||!x||x!==S)return f=te(f,w.owner,`Discarded card (${x}) does not match stated protocol "${S||"none"}". Effect skipped.`),f=tt(f),f;f=te(f,w.owner,`Discarded card matches stated protocol "${S}"!`)}if(f=ct(w.card,y,f,g,i).newState,f.actionRequired)return f}}return f=tt(f),f},Bm=(t,n)=>{var j;if(((j=t.actionRequired)==null?void 0:j.type)!=="select_card_from_trash_to_play")return t;const r=t.actionRequired,i=r.actor,s=i==="player"?"Player":"Opponent",{sourceCardId:d,faceDown:u,destinationRule:p,followUpEffect:f,conditionalType:h,sourceLaneIndex:w}=r;let g={...t};const y={...g[i]};if(n<0||n>=y.discard.length)return console.warn(`[resolveSelectTrashCardToPlay] Invalid index ${n}`),g.actionRequired=null,g;const m=[...y.discard],x=m.splice(n,1)[0];y.discard=m,g[i]=y;const S={...x,id:`trash-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,isFaceUp:u!==!0};g=te(g,i,`${s} selects ${x.protocol}-${x.value} from trash.`);const E=u===void 0;if((p==null?void 0:p.type)==="other_lines"){const b=[0,1,2].filter(k=>k!==w);g.actionRequired={type:"select_lane_for_play",sourceCardId:d,actor:i,isFaceDown:u,source:"trash",preDrawnCard:S,disallowedLaneIndex:w,validLanes:b,useNormalPlayRules:E,followUpEffect:f,conditionalType:h}}else g.actionRequired={type:"select_lane_for_play",sourceCardId:d,actor:i,isFaceDown:u,source:"trash",preDrawnCard:S,useNormalPlayRules:E,followUpEffect:f,conditionalType:h};return g},Gm=(t,n)=>{var x,S;if(((x=t.actionRequired)==null?void 0:x.type)!=="select_card_from_trash_to_reveal")return t;const r=t.actionRequired,i=r.actor,s=i==="player"?"Player":"Opponent",{sourceCardId:d,followUpEffect:u,conditionalType:p,sourceLaneIndex:f}=r;let h={...t};const w={...h[i]};if(n<0||n>=w.discard.length)return console.warn(`[resolveSelectTrashCardToReveal] Invalid index ${n}`),h.actionRequired=null,h;const g=[...w.discard],y=g.splice(n,1)[0];w.discard=g,h[i]=w,h=te(h,i,`${s} reveals ${y.protocol}-${y.value} from trash.`);const m={...y,id:`trash-revealed-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,isFaceUp:!1};if(u){const E=Ne(h,d);if(E&&E.card.isFaceUp){const j=(S=u.params)==null?void 0:S.destinationRule,b=(j==null?void 0:j.type)==="other_lines"?[0,1,2].filter(k=>k!==f):[0,1,2];h.actionRequired={type:"select_lane_for_play",sourceCardId:d,actor:i,isFaceDown:!0,source:"trash",preDrawnCard:m,disallowedLaneIndex:(j==null?void 0:j.type)==="other_lines"?f:void 0,validLanes:(j==null?void 0:j.type)==="other_lines"?b:void 0}}else h=te(h,i,"Source card no longer active. Play effect skipped."),h.actionRequired=null,h=tt(h)}else h.actionRequired=null,h=tt(h);return h},fu=t=>{var g;if(((g=t.actionRequired)==null?void 0:g.type)!=="confirm_deck_play_preview")return t;const n=t.actionRequired,{sourceCardId:r,actor:i,drawnCard:s,isFaceDown:d,excludeCurrentLane:u,currentLaneIndex:p,followUpEffect:f,conditionalType:h}=n;let w={...t};return w.actionRequired={type:"select_lane_for_play",sourceCardId:r,actor:i,count:1,isFaceDown:d,excludeCurrentLane:u,currentLaneIndex:p,source:"deck",preDrawnCard:s,followUpEffect:f,conditionalType:h},w};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Xd=(t,n)=>{var g,y;if(((g=t.actionRequired)==null?void 0:g.type)!=="prompt_optional_draw")return t;const{sourceCardId:r,actor:i,count:s,drawingPlayer:d,logSource:u,logPhase:p,logIndentLevel:f}=t.actionRequired,h=i.charAt(0).toUpperCase()+i.slice(1);let w={...t};if(u!==void 0&&(w=Ze(w,u)),p!==void 0&&(w=et(w,p)),f!==void 0&&(w._logIndentLevel=f),n){w=te(w,i,`${h} chooses to execute the optional draw effect.`),w=gr(w,d||i,s),w=te(w,i,`${h} draws ${s} card${s!==1?"s":""}.`);const m=t.actionRequired.followUpEffect;if(t.actionRequired.conditionalType,m){const x=Ne(w,r);if(x){const S=w[x.owner].lanes.findIndex(k=>k.some(N=>N.id===r)),E=i==="player"?"opponent":"player",j={cardOwner:i,actor:i,currentTurn:w.turn,opponent:E,triggerType:"start"};w=ct(x.card,S,w,j,m).newState,w=tt(w)}else{const S=t.actionRequired.logSource||"deleted card";w=te(w,i,`${S}: Follow-up effect skipped (source no longer active).`),w.actionRequired=null,((y=w._pendingCustomEffects)==null?void 0:y.sourceCardId)===r&&delete w._pendingCustomEffects,w.queuedActions&&w.queuedActions.length>0&&(w.queuedActions=w.queuedActions.filter(E=>E.sourceCardId!==r))}}else w.actionRequired=null}else w=te(w,i,`${h} skips the draw.`),w.actionRequired=null;return w},_m=(t,n,r)=>{var s;if(((s=t.actionRequired)==null?void 0:s.type)!=="plague_4_player_flip_optional")return t;let i={...t,actionRequired:null};if(i=Ze(i,"Plague-4"),i=et(i,"end"),n){const{sourceCardId:d}=t.actionRequired;i=te(i,r,`${r==="player"?"Player":"Opponent"} chooses to flip the card.`),i=mr(new Set([d]),i),i.animationState={type:"flipCard",cardId:d}}else i=te(i,r,`${r==="player"?"Player":"Opponent"} skips flipping the card.`);return i=Ze(i,void 0),i=et(i,void 0),i=Mo(i),i},wm=(t,n)=>{var h,w,g;if(((h=t.actionRequired)==null?void 0:h.type)!=="prompt_optional_discard_custom")return t;const{actor:r,count:i,sourceCardId:s}=t.actionRequired,d=r.charAt(0).toUpperCase()+r.slice(1);let u={...t};const p=(w=t.actionRequired)==null?void 0:w.followUpEffect,f=(g=t.actionRequired)==null?void 0:g.conditionalType;return n?(u=te(u,r,`${d} chooses to discard ${i} card(s).`),u.actionRequired={type:"discard",actor:r,count:i,sourceCardId:s,followUpEffect:p,conditionalType:f,previousHandSize:u[r].hand.length}):(u=te(u,r,`${d} skips the discard.`),u.actionRequired=null),u},Zd=(t,n)=>{var h,w,g,y,m,x,S;if(((h=t.actionRequired)==null?void 0:h.type)!=="prompt_optional_effect")return t;const{actor:r,sourceCardId:i,effectDef:s,laneIndex:d,savedTargetCardId:u}=t.actionRequired,p=r.charAt(0).toUpperCase()+r.slice(1);let f={...t};if(u&&(f.lastCustomEffectTargetCardId=u),n){const E=s.params.action;f=te(f,r,`${p} chooses to execute the optional ${E} effect.`),f.actionRequired=null;const j=[...f.player.lanes.flat(),...f.opponent.lanes.flat()].find($=>$.id===i);if(!j)return console.error("[Optional Effect] Source card not found!"),f;const b={cardOwner:r,opponent:r==="player"?"opponent":"player",currentTurn:f.turn,actor:r},k={...s,params:{...s.params,optional:!1},conditional:void 0},N=ct(j,d,f,b,k),U=!!N.newState.actionRequired,V=!!N.newState._effectSkippedNoTargets;if(V&&!U){const $={...N.newState};return delete $._effectSkippedNoTargets,$.actionRequired=null,$}if(V&&U&&delete N.newState._effectSkippedNoTargets,s.conditional&&s.conditional.type==="if_executed"&&s.conditional.thenEffect){if(N.newState.actionRequired){const D=N.newState.actionRequired.sourceCardId;if(D&&D!==i){const T={type:"execute_conditional_followup",sourceCardId:i,laneIndex:d,followUpEffect:s.conditional.thenEffect,context:b,actor:r,logSource:t.actionRequired.logSource,logPhase:t.actionRequired.logPhase,logIndentLevel:t.actionRequired.logIndentLevel};return{...N.newState,queuedActions:[...N.newState.queuedActions||[],T]}}return{...N.newState,actionRequired:{...N.newState.actionRequired,followUpEffect:s.conditional.thenEffect,conditionalType:"if_executed"}}}const $=[...N.newState.player.lanes.flat(),...N.newState.opponent.lanes.flat()].find(D=>D.id===i);if(!$){let D={...N.newState};const L=t.actionRequired.logSource,T=t.actionRequired.logPhase,q=t.actionRequired.logIndentLevel;return L!==void 0&&(D._currentEffectSource=L),T!==void 0&&(D._currentPhaseContext=T),q!==void 0&&(D._logIndentLevel=q),D=te(D,r,"Follow-up effect skipped (source no longer active)."),D}const B=s.conditional.thenEffect,I=ct($,d,N.newState,b,B);return I.newState.actionRequired&&B.conditional&&B.conditional.thenEffect?{...I.newState,actionRequired:{...I.newState.actionRequired,followUpEffect:B.conditional.thenEffect,conditionalType:B.conditional.type}}:I.newState}const O=(w=t.actionRequired)==null?void 0:w.followUpEffect,X=(g=t.actionRequired)==null?void 0:g.outerSourceCardId,M=(y=t.actionRequired)==null?void 0:y.outerLaneIndex;if(O&&X){let $=N.newState;if($.actionRequired)return{...$,actionRequired:{...$.actionRequired,followUpEffect:O,outerSourceCardId:X,outerLaneIndex:M}};const B=[...$.player.lanes.flat(),...$.opponent.lanes.flat()].find(I=>I.id===X);if(B){const I=$.player.lanes.flat().some(q=>q.id===X)?"player":"opponent",D={cardOwner:I,opponent:I==="player"?"opponent":"player",currentTurn:$.turn,actor:I};let T=ct(B,M||0,$,D,O).newState;return T._interruptedTurn&&!T.actionRequired&&(T={...T,turn:T._interruptedTurn,_interruptedTurn:void 0,_interruptedPhase:void 0}),T}}return N.newState}else{const E=s.params.action;f=te(f,r,`${p} skips the optional ${E} effect.`),f.actionRequired=null;const j=(m=t.actionRequired)==null?void 0:m.followUpEffect,b=(x=t.actionRequired)==null?void 0:x.outerSourceCardId,k=(S=t.actionRequired)==null?void 0:S.outerLaneIndex;if(j&&b){const N=[...f.player.lanes.flat(),...f.opponent.lanes.flat()].find(U=>U.id===b);if(N){let U=k;if(U===void 0){for(const M of["player","opponent"])for(let $=0;$<f[M].lanes.length;$++)if(f[M].lanes[$].some(B=>B.id===b)){U=$;break}}const V=f.player.lanes.flat().some(M=>M.id===b)?"player":"opponent",R={cardOwner:V,opponent:V==="player"?"opponent":"player",currentTurn:f.turn,actor:V};let X=ct(N,U||0,f,R,j).newState;return X._interruptedTurn&&!X.actionRequired&&(X={...X,turn:X._interruptedTurn,_interruptedTurn:void 0,_interruptedPhase:void 0}),X}}return f}},Md=(t,n,r)=>{var k;if(((k=t.actionRequired)==null?void 0:k.type)!=="prompt_rearrange_protocols")return t;const i=tw(t);if(!i.allowed)return console.error(`Protocol rearrangement blocked: ${i.reason}`),t;const{target:s,actor:d,originalAction:u,sourceCardId:p,disallowedProtocolForLane:f}=t.actionRequired;if(f){const{laneIndex:N,protocol:U}=f;if(n[N]===U)return console.error(`Illegal rearrange: ${U} cannot be placed on lane ${N} due to Anarchy-3 restriction`),t}let h={...t};const w={...h[s]},g={};w.protocols.forEach((N,U)=>{g[N]=w.compiled[U]});const y=n.map(N=>g[N]);w.protocols=n,w.compiled=y,h[s]=w,h.actionRequired=null;const m=h._pendingCustomEffects;if(m&&m.effects.length>0){const N={type:"execute_remaining_custom_effects",sourceCardId:m.sourceCardId,laneIndex:m.laneIndex,effects:m.effects,context:m.context,actor:d,logSource:m.logSource,logPhase:m.logPhase,logIndentLevel:m.logIndentLevel};h.queuedActions=[N,...h.queuedActions||[]],delete h._pendingCustomEffects}let x="Control Action";if(p!=="CONTROL_MECHANIC"){const N=[...h.player.lanes.flat(),...h.opponent.lanes.flat()].find(U=>U.id===p);N&&(x=`${N.protocol}-${N.value}`)}const S=d.charAt(0).toUpperCase()+d.slice(1),E=s===d?"their own":"the opponent's",j=n.join(" | ");h=te(h,d,`${x}: ${S} rearranges ${E} protocols.`),h=te(h,d,`New protocol order for ${s}: ${j}`);let b=Ae(h);if(u){if(b={...b,_logIndentLevel:0},u.type==="compile")return ts(b,u.laneIndex,r);if(u.type==="fill_hand")return ls(b,d);u.type==="continue_turn"?u.queuedSpeed2Actions&&u.queuedSpeed2Actions.length>0?(b=te(b,d,"Processing remaining Speed-2 effects..."),b.queuedActions=[...u.queuedSpeed2Actions,...b.queuedActions||[]]):(b=te(b,d,"Turn ends after compile."),b.phase="hand_limit"):u.type==="resume_interrupted_turn"&&(b=te(b,d,"Resuming interrupted turn..."),b._interruptedTurn=u.interruptedTurn,b._interruptedPhase=u.interruptedPhase,u.queuedSpeed2Actions&&u.queuedSpeed2Actions.length>0&&(b.queuedActions=[...u.queuedSpeed2Actions,...b.queuedActions||[]]))}return b},xm=(t,n,r)=>{var b;if(((b=t.actionRequired)==null?void 0:b.type)!=="prompt_swap_protocols")return t;const{actor:i,target:s,originalAction:d,sourceCardId:u}=t.actionRequired,p={...t[s]},[f,h]=n.sort((k,N)=>k-N),w=[...p.protocols],g=[...p.compiled];[w[f],w[h]]=[w[h],w[f]],[g[f],g[h]]=[g[h],g[f]],p.protocols=w,p.compiled=g;let y={...t,[s]:p,actionRequired:null};const m=y._pendingCustomEffects;if(m&&m.effects.length>0){const k={type:"execute_remaining_custom_effects",sourceCardId:m.sourceCardId,laneIndex:m.laneIndex,effects:m.effects,context:m.context,actor:i,logSource:m.logSource,logPhase:m.logPhase,logIndentLevel:m.logIndentLevel};y.queuedActions=[k,...y.queuedActions||[]],delete y._pendingCustomEffects}const x=i.charAt(0).toUpperCase()+i.slice(1),S=s.charAt(0).toUpperCase()+s.slice(1);y=te(y,i,`${u==="CONTROL_MECHANIC"?"Control":"Spirit-4"}: ${x} swaps ${S}'s protocols ${w[h]} and ${w[f]}.`),u==="CONTROL_MECHANIC"&&(y.controlCardHolder=null);let j=Ae(y);if(d){if(d.type==="compile")return j=te(j,i,"Resuming Compile action..."),ts(j,d.laneIndex,r);if(d.type==="fill_hand")return j=te(j,i,"Resuming Refresh action..."),ls(j,i)}return j},Kd=(t,n)=>{var y;if(((y=t.actionRequired)==null?void 0:y.type)!=="prompt_shift_or_flip_board_card_custom")return t;const{actor:r,sourceCardId:i,revealedCardId:s,followUpAction:d,optional:u}=t.actionRequired,p=r.charAt(0).toUpperCase()+r.slice(1),f=Ne(t,s);if(!f)return t;if(d&&n!=="skip"&&n!==d)return console.error(`Invalid choice: ${n}, followUpAction restricts to: ${d}`),t;const h=f.owner,w=t[h].lanes.findIndex(m=>m.some(x=>x.id===s));if(w===-1)return t;let g={...t};switch(n){case"shift":{const m=[...g[h].lanes[w]],x=m.findIndex(S=>S.id===s);if(x!==-1){m[x]={...m[x],isFaceUp:!1};const S=[...g[h].lanes];S[w]=m,g={...g,[h]:{...g[h],lanes:S}}}g=te(g,r,`${p} chooses to shift the revealed card (face-down).`),g.actionRequired={type:"select_lane_to_shift_revealed_board_card_custom",sourceCardId:i,revealedCardId:s,actor:r};break}case"flip":{g=te(g,r,`${p} chooses to flip the revealed card face-up permanently.`);const m={...g,actionRequired:null};g=Yd(m,s).newState;break}case"skip":{const m=[...g[h].lanes[w]],x=m.findIndex(S=>S.id===s);if(x!==-1){m[x]={...m[x],isFaceUp:!1};const S=[...g[h].lanes];S[w]=m,g={...g,[h]:{...g[h],lanes:S}}}g=te(g,r,`${p} chooses to do nothing with the revealed card.`),g.actionRequired=null;break}}return g};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Hd=(t,n)=>{if(!t.actionRequired)return t;const{actionRequired:r}=t,i=r.actor,s=i==="player"?"opponent":"player";switch(r.type){case"select_card_from_hand_to_give":{const d=t[i].hand.find(m=>m.id===n);if(!d)return t;let u={...t};const p={...u[i]},f={...u[s]};p.hand=p.hand.filter(m=>m.id!==n),f.hand=[...f.hand,d],u={...u,[i]:p,[s]:f};const h=i==="player"?"Player":"Opponent",w=`${d.protocol}-${d.value}`;u=te(u,i,`${h} gives ${w} to the opponent.`),r.sourceEffect==="love_1_end"&&(u=te(u,i,`Love-1: ${h} draws 2 cards.`),u=gr(u,i,2));const g=r.followUpEffect,y=r.conditionalType;if(g&&y==="if_executed"){const m=Ne(u,r.sourceCardId);if(m){const{card:x,laneIndex:S}=m,E={cardOwner:i,actor:i,currentTurn:u.turn,opponent:s,triggerType:"play"};u=ct(x,S,u,E,g).newState}}return u.actionRequired=null,u}case"select_card_from_hand_to_reveal":{const d=t[i].hand.find(y=>y.id===n);if(!d)return t;let u={...t};const p={...u[i]},f=p.hand.map(y=>y.id===n?{...y,isRevealed:!0}:y);p.hand=f,u={...u,[i]:p};const h=i==="player"?"Player":"Opponent",w=`${d.protocol}-${d.value}`;u=te(u,i,`${h} reveals ${w} from their hand.`);const g=u._pendingCustomEffects;if(g&&g.effects.length>0){const y=Ne(u,g.sourceCardId);if(y){const{card:m}=y,x=g.effects[0],S=g.effects.slice(1),E={cardOwner:i,actor:i,currentTurn:u.turn,opponent:s,triggerType:"play"};return u=ct(m,g.laneIndex,u,E,x).newState,S.length>0?u._pendingCustomEffects={...g,effects:S}:delete u._pendingCustomEffects,u}}return u.actionRequired={type:"select_any_card_to_flip",count:1,sourceCardId:r.sourceCardId,actor:i},u}default:return t}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Jd=(t,n)=>{var m;if(((m=t.actionRequired)==null?void 0:m.type)!=="custom_choice")return t;const{options:r,sourceCardId:i,actor:s,laneIndex:d}=t.actionRequired;if(n<0||n>=r.length)return console.error(`[Choice Resolver] Invalid option index: ${n}`),t;const u=r[n],p=Ne(t,i);if(!p){console.error(`[Choice Resolver] Source card ${i} not found`);let x={...t};return x.actionRequired=null,x}const f=s==="player"?"opponent":"player",h={cardOwner:s,actor:s,currentTurn:t.turn,opponent:f};let w={...t,actionRequired:null};const g=ct(p.card,d,w,h,u);return Ae(g.newState)};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * Control Mechanic Logic for AI
 *
 * CRITICAL: When evaluating rearrangements during a compile action,
 * the lane being compiled will have its value RESET TO 0 after the compile.
 * This must be considered when determining beneficial swaps!
 */function Ei(t,n){const r=[...t];return n!==null&&n>=0&&n<3&&(r[n]=0),r}function Ym(t,n=null){const r=t.player,i=[],s=[];for(let u=0;u<3;u++)r.compiled[u]?i.push(u):s.push(u);if(i.length===0||s.length===0)return!1;const d=Ei(r.laneValues,n);for(const u of i)for(const p of s)if(d[p]-d[u]>0)return!0;return!1}function ji(t,n=null){const r=t.opponent,i=[],s=[];for(let u=0;u<3;u++)r.compiled[u]?i.push(u):s.push(u);if(i.length===0||s.length===0)return!1;const d=Ei(r.laneValues,n);for(const u of i)for(const p of s){const h=10-d[u];if(h>=0&&h<=3){const g=10-d[p];if(h<g)return!0}}return!1}function Wm(t,n){if(!n||n.type!=="prompt_rearrange_protocols")return{type:"rearrangeProtocols",newOrder:[...t.opponent.protocols]};const r=n.target,i=n.disallowedProtocolForLane;let s=null;n.originalAction&&n.originalAction.type==="compile"&&(s=n.originalAction.laneIndex);const d=m=>{if(!i)return!0;const{laneIndex:x,protocol:S}=i;return m[x]!==S},u=t.opponent,p=t.player,f=Ei(u.laneValues,s),h=Ei(p.laneValues,s),w=u.compiled.filter(m=>m).length;if(p.compiled.filter(m=>m).length===2&&w===2){const m=p.compiled.findIndex(j=>!j),x=u.compiled.findIndex(j=>!j),S=h[m],E=f[x];if(S>E&&r==="player"){let j=-1,b=1/0;for(let k=0;k<3;k++)p.compiled[k]&&h[k]<b&&(b=h[k],j=k);if(j!==-1&&b<=S){const k=[...p.protocols];if([k[m],k[j]]=[k[j],k[m]],d(k))return{type:"rearrangeProtocols",newOrder:k}}return ur(p.protocols,d)}if(S<=E&&r==="opponent"){let j=-1,b=-1;for(let k=0;k<3;k++)u.compiled[k]&&f[k]>b&&(b=f[k],j=k);if(j!==-1&&b>E&&b>0){const k=[...u.protocols];if([k[x],k[j]]=[k[j],k[x]],d(k))return{type:"rearrangeProtocols",newOrder:k}}return ur(u.protocols,d)}}if(r==="player"){const m=[],x=[];for(let b=0;b<3;b++)p.compiled[b]?m.push(b):x.push(b);if(m.length===0||x.length===0){if(n.sourceCardId!=="CONTROL_MECHANIC")for(let k=0;k<3;k++)for(let N=k+1;N<3;N++){const U=[...p.protocols];if([U[k],U[N]]=[U[N],U[k]],d(U))return{type:"rearrangeProtocols",newOrder:U}}return ur(p.protocols,d)}let S=null;for(const b of x)if(h[b]>=10&&h[b]>f[b]){for(const N of m){S={compiledIdx:N,uncompiledIdx:b};break}if(S)break}if(S){const b=[...p.protocols];if([b[S.compiledIdx],b[S.uncompiledIdx]]=[b[S.uncompiledIdx],b[S.compiledIdx]],d(b))return{type:"rearrangeProtocols",newOrder:b}}let E=null;for(const b of m)for(const k of x){const N=h[k]-h[b];(!E||N>E.score)&&(E={compiledIdx:b,uncompiledIdx:k,score:N})}const j=n.sourceCardId!=="CONTROL_MECHANIC";if(E&&E.score>0){const b=[...p.protocols];if([b[E.compiledIdx],b[E.uncompiledIdx]]=[b[E.uncompiledIdx],b[E.compiledIdx]],d(b))return{type:"rearrangeProtocols",newOrder:b}}if(j)for(let b=0;b<3;b++)for(let k=b+1;k<3;k++){const N=[...p.protocols];if([N[b],N[k]]=[N[k],N[b]],d(N))return{type:"rearrangeProtocols",newOrder:N}}return ur(p.protocols,d)}if(r==="opponent"){const m=[],x=[];for(let j=0;j<3;j++)u.compiled[j]?m.push(j):x.push(j);if(m.length===0||x.length===0){if(n.sourceCardId!=="CONTROL_MECHANIC")for(let b=0;b<3;b++)for(let k=b+1;k<3;k++){const N=[...u.protocols];if([N[b],N[k]]=[N[k],N[b]],d(N))return{type:"rearrangeProtocols",newOrder:N}}return ur(u.protocols,d)}let S=null;for(const j of m)for(const b of x){const k=f[j],N=f[b],U=k-N,R=k>=10&&k>h[j]?U+100:U;(!S||R>S.score)&&(S={compiledIdx:j,uncompiledIdx:b,score:R,newUncompiledValue:k})}const E=n.sourceCardId!=="CONTROL_MECHANIC";if(S&&S.score>0){const j=[...u.protocols];if([j[S.compiledIdx],j[S.uncompiledIdx]]=[j[S.uncompiledIdx],j[S.compiledIdx]],d(j))return{type:"rearrangeProtocols",newOrder:j}}if(E)for(let j=0;j<3;j++)for(let b=j+1;b<3;b++){const k=[...u.protocols];if([k[j],k[b]]=[k[b],k[j]],d(k))return{type:"rearrangeProtocols",newOrder:k}}return ur(u.protocols,d)}const y=r==="player"?[...p.protocols]:[...u.protocols];return ur(y,d)}function ur(t,n){if(n(t))return{type:"rearrangeProtocols",newOrder:[...t]};for(let r=0;r<3;r++)for(let i=r+1;i<3;i++){const s=[...t];if([s[r],s[i]]=[s[i],s[r]],n(s))return{type:"rearrangeProtocols",newOrder:s}}return console.error("[AI Rearrange] Could not find any valid arrangement - returning current order"),{type:"rearrangeProtocols",newOrder:[...t]}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function Qm(t,n){return bn(t).some(({rule:i,cardOwner:s})=>i.type!=="require_face_down_play"?!1:i.target==="all"||i.target==="opponent"&&s!==n)}function hu(t){const n=t;return n.customEffects?[...n.customEffects.topEffects||[],...n.customEffects.middleEffects||[],...n.customEffects.bottomEffects||[]].some(i=>{var u,p;const s=i.trigger;return(s==="on_cover"||s==="on_cover_or_flip")&&((u=i.params)==null?void 0:u.action)==="delete"&&((p=i.params)==null?void 0:p.deleteSelf)===!0}):!1}function Xm(t,n,r){const i=t[n].lanes[r];if(i.length===0)return null;const s=i[i.length-1];return s.isFaceUp&&hu(s)?s.value:null}function Zm(t){const n=t;return n.customEffects?[...n.customEffects.topEffects||[],...n.customEffects.middleEffects||[],...n.customEffects.bottomEffects||[]].some(i=>{var s;return i.params.action==="return"&&((s=i.params.targetFilter)==null?void 0:s.owner)==="own"}):!1}function Km(t){const n=t;return n.customEffects?[...n.customEffects.topEffects||[],...n.customEffects.middleEffects||[],...n.customEffects.bottomEffects||[]].some(i=>{var s,d,u;return i.params.action==="delete"&&((s=i.params.targetFilter)==null?void 0:s.owner)==="own"&&(((d=i.params.targetFilter)==null?void 0:d.valueFilter)==="highest"||((u=i.params.targetFilter)==null?void 0:u.calculation)==="highest_value")}):!1}function tx(t){const n=t;if(!n.customEffects)return 0;const r=n.customEffects.topEffects||[];for(const i of r)if(i.trigger==="passive"&&i.params.action==="value_modifier"&&(i.params.condition==="per_face_down_card"||i.params.applyTo==="face_down_cards"))return i.params.modifier||0;return 0}function Jm(t,n){let r=0;for(const i of["player","opponent"])for(const s of t[i].lanes[n])if(s.isFaceUp){const d=tx(s);d>0&&(r=Math.max(r,d))}return r}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * EASY AI - Old Normal AI logic (before strategic modules)
 * - Makes good strategic decisions
 * - No memory of revealed cards
 * - 5% chance to make suboptimal moves for slight unpredictability
 * - Challenging but beatable
 */const ll=["delete","flip","shift","return","discard"],dn=t=>{let n=12-t.value;return ll.some(r=>t.keywords[r])&&(n+=6),t.keywords.draw&&(n+=3),t.keywords.play&&(n+=8),t.keywords.prevent&&(n+=4),n},Qr=(t,n,r)=>{let i;for(const d of r[n].lanes)if(d.some(u=>u.id===t.id)){i=d;break}if(!i)return 0;if(!t.isFaceUp)return i.some(u=>u.isFaceUp&&u.protocol==="Darkness"&&u.value===2)?4:2;let s=t.value*2.5;return t.top.length>0&&(s+=6),(t.bottom.includes("Start:")||t.bottom.includes("End:"))&&(s+=8),t.bottom.includes("covered:")&&(s+=5),ll.some(d=>t.keywords[d])&&(s+=4),s},Kr=()=>Math.random()<.05,Cm=t=>t+(Math.random()*4-2),Xr=(t,n,r,i)=>{const s=r.position||"uncovered";return!(s==="uncovered"&&!n||s==="covered"&&n||r.faceState==="face_up"&&!t.isFaceUp||r.faceState==="face_down"&&t.isFaceUp||r.excludeSelf&&i&&t.id===i||r.valueRange&&(!t.isFaceUp||t.value<r.valueRange.min||t.value>r.valueRange.max)||r.valueEquals!==void 0&&(!t.isFaceUp||t.value!==r.valueEquals))},nx=t=>{var k,N,U,V;const n=[],r=Qm(t,"opponent"),i=t.player.lanes.flat().length+t.opponent.lanes.flat().length,s=i<=3,d=i>3&&i<=8,p=t.player.lanes.flat().length>0,f=t.player.compiled.filter(Boolean).length,h=t.controlCardHolder==="opponent";t.controlCardHolder;let w=0;for(let R=0;R<3;R++)t.opponent.laneValues[R]>t.player.laneValues[R]?w++:t.player.laneValues[R]>t.opponent.laneValues[R];const y=t.useControlMechanic===!0&&f>=1&&!h;for(let R=0;R<3&&!(!t.player.compiled[R]&&t.player.laneValues[R]>=10&&t.player.laneValues[R]>t.opponent.laneValues[R]);R++);const m=t.opponent.compiled.filter(Boolean).length;let x=-1;if(m<3&&!y){const R=[];for(let O=0;O<3;O++){if(t.opponent.compiled[O])continue;const X=t.opponent.protocols[O],M=t.player.protocols[O],$=t.opponent.laneValues[O],B=t.player.laneValues[O],I=t.opponent.hand.filter(q=>q.protocol===X||q.protocol===M);if(B>=10&&!t.player.compiled[O]){const q=Math.max(...I.map(A=>A.value),0),Z=Math.max(q,2);if($+Z<=B)continue}let D=0,L=`Lane ${O} (${X}): value=${$}`;D+=$*15,$>=8?(D+=100,L+=` [ALMOST COMPILE: ${$}]`):$>=6?(D+=60,L+=` [Near compile: ${$}]`):$>=4&&(D+=30,L+=` [Building: ${$}]`),D+=I.length*10,I.length>0&&(L+=` [${I.length} cards]`);const T=I.filter(q=>q.value>=4);D+=T.length*20,B>$&&(D-=(B-$)*5),I.length===0&&(D-=30,L+=" [No matching cards - face-down only]"),R.push({laneIndex:O,score:D,reason:L})}R.sort((O,X)=>X.score-O.score),R.length>0&&(x=R[0].laneIndex)}const S=(R,O)=>R.keywords.flip||R.keywords.delete||R.keywords.shift||R.keywords.return?t.player.lanes.flat().length>0||t.opponent.lanes.some(($,B)=>B!==O&&$.length>0)||t.opponent.lanes[O].length>0:!0,E=R=>R.keywords.draw?t.opponent.hand.length>=5:!1;for(const R of t.opponent.hand)for(let O=0;O<3;O++){const X=fr(t,"opponent",O,!0,R.protocol),M=fr(t,"opponent",O,!1,R.protocol);if(!X.allowed&&!M.allowed||t.opponent.compiled[O])continue;const $=t.player.laneValues[O]>=10&&t.player.laneValues[O]>t.opponent.laneValues[O]&&!t.player.compiled[O];if($){const q=Math.max(X.allowed?R.value:0,M.allowed?fn({...R,isFaceUp:!1},t.opponent.lanes[O]):0);if(t.opponent.laneValues[O]+q<t.player.laneValues[O]&&!ll.some(Z=>R.keywords[Z]))continue}let B=!1;if(Zm(R)){let q=0;for(let P=0;P<3;P++)if(t.opponent.lanes[P].length>0){if(P===O)continue;q++}q===0&&(B=!0)}if(hu(R)){const q=t.opponent.laneValues[O],P=Math.max(0,10-R.value);if(q<P)continue;const Z=q+R.value,G=t.player.laneValues[O];if(Z<=G)continue}const I=Xm(t,"opponent",O);if(I!==null){const q=t.opponent.laneValues[O],P=q+R.value-I,Z=P>=10&&P>t.player.laneValues[O],G=q-I>=4;if(!Z&&!G)continue}const D=$;let L=!1;if(Km(R)){let q=0;for(let P=0;P<3;P++){const Z=t.opponent.lanes[P];if(Z.length>0&&P!==O){const G=Z[Z.length-1],A=G.isFaceUp?G.value:2;A>q&&(q=A)}}R.value>=q&&(L=!0)}if(X.allowed&&!r&&!L&&!B){let q=0,P=`Play ${R.protocol}-${R.value} face-up in lane ${O}`;const Z=R.value,G=t.opponent.laneValues[O]+Z;if(D)G>t.player.laneValues[O]?(q=180+G*5,P+=" [Blocks compile!]"):G===t.player.laneValues[O]?(q=160+G*3,P+=" [Blocks compile with tie!]"):(q=-500,P+=" [WASTE: Card goes to trash when player compiles!]");else{if(q+=Z*10,G>=10&&G>t.player.laneValues[O]&&!t.opponent.compiled[O])q+=200,P+=` [COMPILE: ${G}]`;else if(G>=8&&G<10&&!t.opponent.compiled[O]){const W=t.opponent.lanes[O].some(Q=>Q.isFaceUp&&Q.protocol==="Darkness"&&Q.value===2)?4:2;t.opponent.laneValues[O]+W>=10&&G<10?(q-=50,P+=` [Near ${G} but face-down could compile!]`):(q+=40,P+=` [Near compile: ${G}]`)}s&&Z<=2&&(q-=50,P+=" [Low value early game penalty]"),S(R,O)||(q-=80,P+=" [No valid targets for effect]"),E(R)&&(q-=30,P+=" [Draw would cause discard]");const A=ll.some(W=>R.keywords[W]);if(A&&p?d&&t.player.laneValues[O]>=5?(q+=35,P+=" [Disruption with targets]"):t.player.laneValues[O]>=8&&(q+=50,P+=" [Disruption near compile]"):A&&!p&&(q-=40,P+=" [Disruption but no targets]"),x!==-1&&!y&&(O===x?(q+=150,P+=" [FOCUS LANE]"):(q-=100,P+=" [Not focus lane]")),y){const W=t.opponent.laneValues[O]>t.player.laneValues[O],J=G>t.player.laneValues[O],Q=t.opponent.laneValues[O]===t.player.laneValues[O];if(W)q-=200,P+=" [ALREADY LEADING - DON'T WASTE!]";else if(!W&&J)w===1?(q+=500,P+=" [CONTROL CAPTURE! 1->2 leads]"):w===0?(q+=300,P+=" [First lead! 0->1 leads]"):(q+=100,P+=" [Extra lead]");else if(Q&&J)w===1?(q+=450,P+=" [BREAK TIE FOR CONTROL!]"):(q+=250,P+=" [Break tie]");else if(!W&&!J&&w===1){const ee=t.player.laneValues[O]-G;ee<=3?(q+=200,P+=` [BUILD toward 2nd lead, gap=${ee}]`):ee<=6?(q+=150,P+=` [BUILD toward 2nd lead, gap=${ee}]`):(q+=100,P+=` [BUILD toward 2nd lead, gap=${ee}]`)}}}n.push({move:{type:"playCard",cardId:R.id,laneIndex:O,isFaceUp:!0},score:Cm(q),reason:P})}if(M.allowed){const q=fn({...R,isFaceUp:!1},t.opponent.lanes[O]),P=t.opponent.laneValues[O]+q,Z=t.opponent.laneValues[O];let G=-100,A=`Play ${R.protocol}-${R.value} face-down in lane ${O}`;if(D?P>=t.player.laneValues[O]?(G=150,A+=` [Blocks compile: ${P} vs ${t.player.laneValues[O]}]`):(G=-500,A+=" [WASTE: Card goes to trash when player compiles!]"):!t.opponent.compiled[O]&&P>=10&&P>t.player.laneValues[O]?(G=300,A+=` [COMPILE: Face-down finishes at ${Z} -> ${P} beats player ${t.player.laneValues[O]}]`):!t.opponent.compiled[O]&&t.player.laneValues[O]>=10&&P>=t.player.laneValues[O]?(G=250,A+=` [BLOCK COMPILE: Face-down reaches ${P} vs player ${t.player.laneValues[O]}]`):!t.opponent.compiled[O]&&t.player.laneValues[O]>=10&&P<t.player.laneValues[O]?(G=-500,A+=" [WASTE: Card goes to trash when player compiles!]"):x===O&&!t.opponent.compiled[O]&&Z>=4?(G=50+Z*10,A+=` [BUILD FOCUS: ${Z} -> ${P}]`):!X.allowed&&R.value<=1?(G=-20,A+=" [No face-up option, low value]"):(G=-120,A+=" [Avoid: Face-up is better]"),x!==-1&&G<50&&!y&&(O===x?(G+=50,A+=" [Focus lane]"):(G-=80,A+=" [Not focus lane]")),y){const W=t.opponent.laneValues[O]>t.player.laneValues[O],J=P>t.player.laneValues[O],Q=t.opponent.laneValues[O]===t.player.laneValues[O];if(W)G-=200,A+=" [FD ALREADY LEADING - DON'T WASTE!]";else if(!W&&J)w===1?(G+=400,A+=" [FD CONTROL CAPTURE! 1->2 leads]"):w===0&&(G+=250,A+=" [FD First lead!]");else if(Q&&J)w===1?(G+=350,A+=" [FD BREAK TIE FOR CONTROL!]"):(G+=200,A+=" [FD Break tie]");else if(!W&&!J&&w===1){const ee=t.player.laneValues[O]-P;ee<=3?(G+=150,A+=` [FD BUILD toward 2nd lead, gap=${ee}]`):ee<=6&&(G+=100,A+=` [FD BUILD toward 2nd lead, gap=${ee}]`)}}n.push({move:{type:"playCard",cardId:R.id,laneIndex:O,isFaceUp:!1},score:Cm(G),reason:A})}}if(t.opponent.hand.length===0)n.push({move:{type:"fillHand"},score:500,reason:"Must refill - no cards"});else{const R=t.player.laneValues.some((M,$)=>M>=10&&M>t.opponent.laneValues[$]&&!t.player.compiled[$]),O=t.controlCardHolder==="opponent",X=t.player.compiled.some(M=>M);R&&O&&X&&n.push({move:{type:"fillHand"},score:200,reason:"Emergency draw to block compile with control swap"})}if(n.length===0)return{type:"fillHand"};n.sort((R,O)=>O.score-R.score);const j=R=>{if(R.type==="playCard"&&R.isFaceUp){const O=t.opponent.hand.find(M=>M.id===R.cardId);if(!O)return!1;const X=fr(t,"opponent",R.laneIndex,!0,O.protocol);if(!X.allowed)return console.warn(`[AI Safety] Rejecting invalid face-up play: ${O.protocol}-${O.value} in lane ${R.laneIndex} - ${X.reason}`),!1}return!0};if(!(((N=(k=n[0])==null?void 0:k.reason)==null?void 0:N.includes("Blocks compile"))||((V=(U=n[0])==null?void 0:U.reason)==null?void 0:V.includes("BLOCK COMPILE")))&&Kr()&&n.length>1&&n[1].score>0&&j(n[1].move))return n[1].move;for(const R of n)if(j(R.move))return R.move;return console.warn("[AI Safety] No valid moves found, falling back to fillHand"),{type:"fillHand"}},ax=(t,n)=>{var r,i;switch(n.type){case"prompt_use_control_mechanic":{const s=t.player.compiled.filter(f=>f).length,d=t.compilableLanes.length>0?t.compilableLanes[0]:null;let u=-1;for(let f=0;f<3;f++)if(!t.player.compiled[f]&&t.player.laneValues[f]>=10&&t.player.laneValues[f]>t.opponent.laneValues[f]){u=f;break}const p=t.player.compiled.map((f,h)=>f?h:-1).filter(f=>f!==-1);return u!==-1&&p.length>0?{type:"resolveControlMechanicPrompt",choice:"player"}:s===0?ji(t,d)&&!Kr()?{type:"resolveControlMechanicPrompt",choice:"opponent"}:{type:"resolveControlMechanicPrompt",choice:"skip"}:Ym(t,d)?{type:"resolveControlMechanicPrompt",choice:"player"}:ji(t,d)&&!Kr()?{type:"resolveControlMechanicPrompt",choice:"opponent"}:{type:"resolveControlMechanicPrompt",choice:"skip"}}case"discard":return{type:"discardCards",cardIds:[...t.opponent.hand].sort((d,u)=>{const p=ll.some(h=>d.keywords[h]),f=ll.some(h=>u.keywords[h]);return p&&!f?1:!p&&f?-1:dn(d)-dn(u)}).slice(0,n.count).map(d=>d.id)};case"discard_completed":return{type:"skip"};case"select_opponent_card_to_flip":{const d=(p=>t[p].lanes.map(f=>f.length>0?f[f.length-1]:null).filter(f=>f!==null))("player");if(d.length===0)return{type:"skip"};const u=d.map(p=>({cardId:p.id,score:p.isFaceUp?p.value+5:3}));return u.sort((p,f)=>f.score-p.score),{type:"flipCard",cardId:u[0].cardId}}case"select_cards_to_delete":{const s=n.disallowedIds||[],d=n.allowedIds,u=n.targetFilter??{},p="actorChooses"in n?n.actorChooses:"effect_owner",f=n.sourceCardId;if(p==="card_owner"&&(u==null?void 0:u.owner)==="opponent"){const g=[];return t.opponent.lanes.forEach(y=>{if(y.length>0){const m=y[y.length-1];if(Xr(m,!0,u,f)){if(d&&!d.includes(m.id))return;g.push(m)}}}),g.length>0?(g.sort((y,m)=>y.value-m.value),{type:"deleteCard",cardId:g[0].id}):{type:"skip"}}const h=g=>t[g].lanes.map(y=>y.length>0?y[y.length-1]:null).filter(y=>y!==null).filter(y=>Xr(y,!0,u,f)).filter(y=>!d||d.includes(y.id)),w=u==null?void 0:u.owner;if(w==="own"){const g=h("opponent").filter(y=>!s.includes(y.id));if(g.length>0)return{type:"deleteCard",cardId:g.sort((m,x)=>m.value-x.value)[0].id}}else if(w==="opponent"){const g=h("player").filter(y=>!s.includes(y.id));if(g.length>0){const y=g.map(m=>{const x=t.player.lanes.findIndex(j=>j.some(b=>b.id===m.id)),S=t.player.laneValues[x],E=S>=10&&S>t.opponent.laneValues[x];return{cardId:m.id,score:Qr(m,"player",t)+S+(E?50:0)}});return y.sort((m,x)=>x.score-m.score),{type:"deleteCard",cardId:y[0].cardId}}}else{const g=h("player").filter(m=>!s.includes(m.id));if(g.length>0){const m=g.map(x=>{const S=t.player.lanes.findIndex(b=>b.some(k=>k.id===x.id)),E=t.player.laneValues[S],j=E>=10&&E>t.opponent.laneValues[S];return{cardId:x.id,score:Qr(x,"player",t)+E+(j?50:0)}});return m.sort((x,S)=>S.score-x.score),{type:"deleteCard",cardId:m[0].cardId}}const y=h("opponent").filter(m=>!s.includes(m.id));if(y.length>0)return{type:"deleteCard",cardId:y.sort((x,S)=>x.value-S.value)[0].id}}return{type:"skip"}}case"select_any_card_to_flip":case"select_any_other_card_to_flip":case"select_any_face_down_card_to_flip_optional":case"select_any_card_to_flip_optional":{const s=Pa(t),d=n.targetFilter,u=n.sourceCardId,p=n.actor,f=n.currentLaneIndex??n.laneIndex,h=n.scope,w=[];for(const y of["player","opponent"])if(!(d&&(d.owner==="own"&&y!==p||d.owner==="opponent"&&y===p)))for(let m=0;m<t[y].lanes.length;m++){if(f!==void 0&&m!==f||h==="this_lane"&&f!==void 0&&m!==f)continue;const x=t[y].lanes[m];if(x.length!==0)for(let S=0;S<x.length;S++){const E=x[S],j=S===x.length-1;if(d){if(!Xr(E,j,d,u))continue}else if(!j)continue;s&&!E.isFaceUp||w.push({card:E,owner:y})}}if(w.length===0)return{type:"skip"};const g=w.map(({card:y,owner:m})=>{let x=0,S=-1;for(let U=0;U<t[m].lanes.length;U++)if(t[m].lanes[U].some(V=>V.id===y.id)){S=U;break}const E=S>=0?t[m].laneValues[S]:0,j=S>=0?t[m].compiled[S]:!1,b=y.isFaceUp?y.value:2,N=(y.isFaceUp?2:y.value)-b;return m==="player"?y.isFaceUp?(x=-N*15,x+=Qr(y,"player",t)):y.value<=1?x=20:x=-30:y.isFaceUp?N>0?(x=N*20+50,!j&&E+N>=10&&(x+=200)):x=N*15-30:N>0?(x=N*20+40,!j&&E+N>=10&&(x+=200)):x=-10,{cardId:y.id,score:x}});return g.sort((y,m)=>m.score-y.score),{type:"flipCard",cardId:g[0].cardId}}case"plague_2_opponent_discard":return t.opponent.hand.length===0?{type:"skip"}:{type:"discardCards",cardIds:[[...t.opponent.hand].sort((d,u)=>dn(d)-dn(u))[0].id]};case"select_card_from_hand_to_play":{if(t.opponent.hand.length===0)return{type:"skip"};const s=n.faceDown===!0,d=n.selectableCardIds,u=d?t.opponent.hand.filter(w=>d.includes(w.id)):t.opponent.hand;if(u.length===0)return{type:"skip"};let p=n.validLanes||[0,1,2].filter(w=>w!==n.disallowedLaneIndex);if(p=p.filter(w=>{const g=t.player.lanes[w],y=g.length>0?g[g.length-1]:null;return!(y&&y.isFaceUp&&y.protocol==="Plague"&&y.value===0)}),p.length===0)return{type:"skip"};const f=[];for(const w of u)for(const g of p){if(!s){const x=t.opponent.lanes.flat().some(b=>b.isFaceUp&&b.protocol==="Spirit"&&b.value===1),S=t.opponent.lanes.some(b=>{if(b.length===0)return!1;const k=b[b.length-1];return k.isFaceUp&&k.protocol==="Chaos"&&k.value===3}),E=[...t.player.lanes.flat(),...t.opponent.lanes.flat()].some(b=>b.isFaceUp&&b.protocol==="Anarchy"&&b.value===1);let j;if(E?j=w.protocol!==t.opponent.protocols[g]&&w.protocol!==t.player.protocols[g]:j=w.protocol===t.opponent.protocols[g]||w.protocol===t.player.protocols[g]||x||S,j){const b=w.value,k=t.opponent.laneValues[g]+b;let N=dn(w)+b*2;k>=10&&k>t.player.laneValues[g]&&(N+=100);const U=t.player.laneValues[g],V=t.player.compiled[g],R=t.opponent.compiled[g],O=t.opponent.laneValues[g];!V&&!R&&U>=10&&U>O&&k>=U&&(N+=160),f.push({cardId:w.id,laneIndex:g,isFaceUp:!0,score:N})}}if(!t.player.lanes[g].some(x=>x.isFaceUp&&x.protocol==="Metal"&&x.value===2)){const x=fn({...w,isFaceUp:!1},t.opponent.lanes[g]),S=t.opponent.laneValues[g]+x;let E=x*2;S>=10&&S>t.player.laneValues[g]&&(E+=80);const j=t.player.laneValues[g],b=t.player.compiled[g],k=t.opponent.compiled[g],N=t.opponent.laneValues[g];!b&&!k&&j>=10&&j>N&&S>=j&&(E+=150),f.push({cardId:w.id,laneIndex:g,isFaceUp:!1,score:E})}}if(f.length===0)return{type:"skip"};f.sort((w,g)=>g.score-w.score);const h=f[0];return{type:"playCard",cardId:h.cardId,laneIndex:h.laneIndex,isFaceUp:h.isFaceUp}}case"select_card_from_hand_to_give":return t.opponent.hand.length===0?{type:"skip"}:{type:"giveCard",cardId:[...t.opponent.hand].sort((d,u)=>dn(d)-dn(u))[0].id};case"select_card_from_hand_to_reveal":return t.opponent.hand.length===0?{type:"skip"}:{type:"revealCard",cardId:[...t.opponent.hand].sort((d,u)=>dn(u)-dn(d))[0].id};case"select_card_to_return":case"select_opponent_card_to_return":{const d={position:"uncovered",...n.targetFilter||{}},u=n.targetOwner||d.owner,p=n.sourceCardId,f=n.actor,h=[];for(const y of["player","opponent"])if(!(u==="own"&&y!==f)&&!(u==="opponent"&&y===f))for(const m of t[y].lanes)for(let x=0;x<m.length;x++){const S=m[x],E=x===m.length-1;Xr(S,E,d,p)&&h.push({card:S,owner:y})}if(h.length===0)return{type:"skip"};const w=h.filter(y=>y.owner==="player"),g=h.filter(y=>y.owner==="opponent");return w.length>0?(w.sort((y,m)=>Qr(m.card,"player",t)-Qr(y.card,"player",t)),{type:"returnCard",cardId:w[0].card.id}):g.length>0?(g.sort((y,m)=>y.card.value-m.card.value),{type:"returnCard",cardId:g[0].card.id}):{type:"returnCard",cardId:h[0].card.id}}case"select_lane_for_play":{let s=n.validLanes||[0,1,2];if(s=s.filter(p=>!("disallowedLaneIndex"in n)||p!==n.disallowedLaneIndex),s=s.filter(p=>{const f=t.player.lanes[p],h=f.length>0?f[f.length-1]:null,w=h&&h.isFaceUp&&h.protocol==="Plague"&&h.value===0,g="isFaceDown"in n&&n.isFaceDown&&f.some(y=>y.isFaceUp&&y.protocol==="Metal"&&y.value===2);return!w&&!g}),s.length===0)return{type:"skip"};const d=s.filter(p=>{const f=t.player.laneValues[p],h=t.opponent.laneValues[p],w=t.player.compiled[p],g=t.opponent.compiled[p],y=!w&&f>=10&&f>h,m=h+2>=f;return y&&m&&!g});if(d.length>0)return d.sort((p,f)=>t.player.laneValues[f]-t.player.laneValues[p]),{type:"selectLane",laneIndex:d[0]};const u=s.map(p=>{const f=t.opponent.laneValues[p]-t.player.laneValues[p];return{laneIndex:p,score:-f}});return u.sort((p,f)=>f.score-p.score),{type:"selectLane",laneIndex:u[0].laneIndex}}case"prompt_rearrange_protocols":return Wm(t,n);case"prompt_swap_protocols":{const{target:s}=n,d=t[s].protocols,u=t[s].hand,p=t[s].compiled,f=t[s].laneValues,h=[[0,1],[0,2],[1,2]];let w=[0,1],g=-1/0;for(const y of h){const[m,x]=y,S=[...d];[S[m],S[x]]=[S[x],S[m]];let E=0;const j=p[m],b=p[x],k=f[m],N=f[x];if(s==="opponent"){j&&!b?N<k&&(E+=30):b&&!j&&k<N&&(E+=30);for(const U of u){const V=U.protocol===d[m],R=U.protocol===d[x],O=U.protocol===S[m],X=U.protocol===S[x],M=j?.5:1.5,$=b?.5:1.5;O&&!V&&(E+=dn(U)*M),X&&!R&&(E+=dn(U)*$),!O&&V&&(E-=dn(U)*M),!X&&R&&(E-=dn(U)*$)}}else{j&&!b?k>N&&(E+=25):b&&!j&&N>k&&(E+=25);for(const U of u){const V=U.protocol===d[m],R=U.protocol===d[x],O=U.protocol===S[m],X=U.protocol===S[x],M=j?.5:1.5,$=b?.5:1.5;O&&!V&&(E-=dn(U)*M),X&&!R&&(E-=dn(U)*$),!O&&V&&(E+=dn(U)*M),!X&&R&&(E+=dn(U)*$)}}E>g&&(g=E,w=y)}return{type:"resolveSwapProtocols",indices:w}}case"select_lane_for_shift":{let s=n.validLanes||[0,1,2];if(s=s.filter(d=>!("disallowedLaneIndex"in n)||d!==n.disallowedLaneIndex).filter(d=>!("originalLaneIndex"in n)||d!==n.originalLaneIndex),"sourceCardId"in n){const d=[...t.player.lanes.flat(),...t.opponent.lanes.flat()].find(u=>u.id===n.sourceCardId);if(d&&d.protocol==="Gravity"&&d.value===1){let u=null;for(let p=0;p<3;p++)if([...t.player.lanes[p],...t.opponent.lanes[p]].some(h=>h.id===n.sourceCardId)){u=p;break}u!==null&&"originalLaneIndex"in n&&(n.originalLaneIndex===u||(s=[u]))}if(d&&d.protocol==="Anarchy"&&d.value===1){const u="cardToShiftId"in n?n.cardToShiftId:null;if(u){const p=[...t.player.lanes.flat(),...t.opponent.lanes.flat()].find(f=>f.id===u);p&&(s=s.filter(f=>{const h=t.player.protocols[f],w=t.opponent.protocols[f],g=p.protocol;return g!==h&&g!==w}))}}}if(s.length>0){const d="cardToShiftId"in n?n.cardToShiftId:null;let u=null,p=0;if(d)for(const h of["player","opponent"]){for(const w of t[h].lanes){const g=w.find(y=>y.id===d);if(g){u=h,p=g.isFaceUp?g.value:2;break}}if(u)break}const f=s.map(h=>{let w=0;const g=t.player.laneValues[h],y=t.opponent.laneValues[h],m=t.player.compiled[h],x=t.opponent.compiled[h];return u==="player"?m?w+=100:y>g?w+=50:g>=6&&g<10&&!m&&(w-=50):u==="opponent"&&(!x&&y<10?y+p>=10?w+=100:y>=6?w+=60:w+=30:x&&(w-=50)),{laneIdx:h,score:w}});if(f.sort((h,w)=>w.score-h.score),Kr()&&f.length>1){const h=Math.floor(Math.random()*f.length);return{type:"selectLane",laneIndex:f[h].laneIdx}}return{type:"selectLane",laneIndex:f[0].laneIdx}}return{type:"selectLane",laneIndex:0}}case"select_lane_for_delete_all":{const s="validLanes"in n?n.validLanes:[0,1,2];return s.length>0?{type:"selectLane",laneIndex:s[Math.floor(Math.random()*s.length)]}:{type:"skip"}}case"select_lanes_for_swap_stacks":{const s=n.validLanes,d=n.selectedFirstLane;if(s.length===0)return{type:"skip"};if(d===void 0){const u=s.map(p=>{const f=t.opponent.laneValues[p];return{laneIdx:p,score:f}});return u.sort((p,f)=>p.score-f.score),{type:"selectLane",laneIndex:u[0].laneIdx}}else{const u=s.map(p=>{const f=t.opponent.laneValues[p];return{laneIdx:p,score:f}});return u.sort((p,f)=>f.score-p.score),{type:"selectLane",laneIndex:u[0].laneIdx}}}case"select_card_for_copy_middle":{const s=n.validTargetIds||[];if(s.length===0)return{type:"skip"};const d=s.map(u=>{var f,h;let p=0;for(const w of["player","opponent"])for(const g of t[w].lanes){const y=g.find(m=>m.id===u);if(y){const x=((f=y.customEffects)==null?void 0:f.middleEffects)||[];for(const S of x){const E=(h=S.params)==null?void 0:h.action;E==="draw"&&(p+=5),E==="flip"&&(p+=3),E==="delete"&&(p+=4),E==="shift"&&(p+=2),E==="discard"&&(p-=2)}}}return{cardId:u,score:p}});return d.sort((u,p)=>p.score-u.score),{type:"selectCard",cardId:d[0].cardId}}case"select_lane_for_return":{const s=n.targetFilter||{},d=n.actor,u=s.valueEquals,p=s.valueRange,f=[];for(let h=0;h<3;h++){let w=0,g=0;const y=Jm(t,h);for(const S of["player","opponent"]){if(s.owner==="own"&&S!==d||s.owner==="opponent"&&S===d)continue;const E=t[S].lanes[h];for(let j=0;j<E.length;j++){const b=E[j],k=j===E.length-1;if(s.position==="uncovered"&&!k||s.position==="covered"&&k)continue;const N=b.isFaceUp?b.value:2+y;u!==void 0&&N!==u||p&&(N<p.min||N>p.max)||(S==="player"?w+=N:g+=N)}}const m=w-g,x=`Lane ${h}: Player loses ${w}, we lose ${g}, net=${m}`;f.push({laneIndex:h,score:m,reason:x})}f.sort((h,w)=>w.score-h.score);for(const h of f);return f.length>0?{type:"selectLane",laneIndex:f[0].laneIndex}:{type:"selectLane",laneIndex:0}}case"prompt_optional_effect":{const{effectDef:s}=n,d=(r=s==null?void 0:s.params)==null?void 0:r.action,u=(i=s==null?void 0:s.params)==null?void 0:i.targetFilter;if(d==="give")return{type:"resolveOptionalEffectPrompt",accept:!1};if(d==="flip"){let p=!1;const f=(u==null?void 0:u.position)||"uncovered";for(const h of["player","opponent"])if(!((u==null?void 0:u.owner)==="own"&&h!=="opponent")&&!((u==null?void 0:u.owner)==="opponent"&&h==="opponent")){for(let w=0;w<t[h].lanes.length;w++){const g=t[h].lanes[w];if(g.length!==0){for(let y=0;y<g.length;y++){const m=g[y],x=y===g.length-1,S=!x;if(f==="uncovered"&&!x||f==="covered"&&!S||(u==null?void 0:u.faceState)==="face_up"&&!m.isFaceUp||(u==null?void 0:u.faceState)==="face_down"&&m.isFaceUp)continue;const E=m.isFaceUp?m.value:2,j=m.isFaceUp?2:m.value;if(h==="player"){if(m.isFaceUp&&E>j){p=!0;break}}else{const b=t.opponent.laneValues[w],k=j-E;if(m.isFaceUp&&k>0){p=!0;break}if(!m.isFaceUp&&m.value>2){p=!0;break}if(k>0&&b+k>=10&&!t.opponent.compiled[w]){p=!0;break}}}if(p)break}}if(p)break}return{type:"resolveOptionalEffectPrompt",accept:p}}return{type:"resolveOptionalEffectPrompt",accept:!Kr()}}case"select_card_from_other_lanes_to_delete":{const{disallowedLaneIndex:s,lanesSelected:d}=n,u=[];for(let p=0;p<3;p++){if(p===s||d.includes(p))continue;const f=t.player.lanes[p];if(f.length>0){u.push(f[f.length-1]);continue}const h=t.opponent.lanes[p];h.length>0&&u.push(h[h.length-1])}return u.length>0?{type:"deleteCard",cardId:u[0].id}:{type:"skip"}}case"select_face_down_card_to_delete":{const s="disallowedIds"in n&&Array.isArray(n.disallowedIds)?n.disallowedIds:[],d=f=>t[f].lanes.map(h=>h.length>0?h[h.length-1]:null).filter(h=>h!==null),u=d("player").filter(f=>!s.includes(f.id));if(u.length>0)return{type:"deleteCard",cardId:u[0].id};const p=d("opponent").filter(f=>!s.includes(f.id));return p.length>0?{type:"deleteCard",cardId:p[0].id}:{type:"skip"}}case"select_low_value_card_to_delete":{const s=[];for(const u of["player","opponent"])for(const p of t[u].lanes)p.length>0&&s.push(p[p.length-1]);const d=s.filter(u=>u.isFaceUp&&(u.value===0||u.value===1));return d.length>0?{type:"deleteCard",cardId:d[0].id}:{type:"skip"}}case"select_opponent_face_up_card_to_flip":{const d=(u=>t[u].lanes.map(p=>p.length>0?p[p.length-1]:null).filter(p=>p!==null))("player").filter(u=>u.isFaceUp);return d.length>0?(d.sort((u,p)=>p.value-u.value),{type:"flipCard",cardId:d[0].id}):{type:"skip"}}case"select_covered_card_in_line_to_flip_optional":{const s="optional"in n&&n.optional,u=!["select_any_other_card_to_flip","select_any_other_card_to_flip_for_water_0"].includes(n.type);if(n.type==="select_covered_card_in_line_to_flip_optional"){const{laneIndex:y}=n,m=t.opponent.lanes[y],x=t.player.lanes[y],S=m.filter((V,R,O)=>R<O.length-1),E=x.filter((V,R,O)=>R<O.length-1),j=t.opponent.laneValues[y];if(!t.opponent.compiled[y]){let V=null,R=null;for(const O of S){let X,M;O.isFaceUp?(X=O.value,M=2):(X=fn(O,m,t,y,"opponent"),M=O.value);const $=M-X,B=j+$;$>0&&B>=10&&(!V||B>V.newValue)&&(V={card:O,newValue:B,gain:$}),$>0&&(!R||$>R.gain)&&(R={card:O,gain:$,newValue:B})}if(V)return{type:"flipCard",cardId:V.card.id};if(R&&R.gain>0)return{type:"flipCard",cardId:R.card.id}}if(t.opponent.compiled[y]){let V=null;for(const R of S){const O=R.isFaceUp?R.value:fn(R,m,t,y,"opponent"),M=(R.isFaceUp?2:R.value)-O;M>0&&(!V||M>V.gain)&&(V={card:R,gain:M})}if(V)return{type:"flipCard",cardId:V.card.id}}const k=E.filter(V=>V.isFaceUp);if(k.length>0)return k.sort((V,R)=>R.value-V.value),{type:"flipCard",cardId:k[0].id};const N=S.filter(V=>!V.isFaceUp).map(V=>({card:V,gain:V.value-fn(V,m,t,y,"opponent")})).filter(V=>V.gain>0).sort((V,R)=>R.gain-V.gain);if(N.length>0)return{type:"flipCard",cardId:N[0].card.id};const U=E.filter(V=>!V.isFaceUp);return U.length>0?{type:"flipCard",cardId:U[0].id}:{type:"skip"}}const p=y=>t[y].lanes.map(m=>m.length>0?m[m.length-1]:null).filter(m=>m!==null),f=p("player"),h=p("opponent");{const y=f.filter(m=>m.isFaceUp).sort((m,x)=>x.value-m.value);if(y.length>0)return{type:"flipCard",cardId:y[0].id}}const w=h.filter(y=>!y.isFaceUp);if(w.length>0)return{type:"flipCard",cardId:w[0].id};const g=f.filter(y=>!y.isFaceUp);if(g.length>0)return{type:"flipCard",cardId:g[0].id};{const y=h.filter(x=>!(!x.isFaceUp||!u&&x.id===n.sourceCardId)),m=y.filter(x=>{const S=t.opponent.lanes.findIndex(E=>E.length>0&&E[E.length-1].id===x.id);return S!==-1&&t.opponent.compiled[S]});if(m.length>0&&!s)return{type:"flipCard",cardId:m[0].id};if(y.length>0&&!s)return{type:"flipCard",cardId:y[0].id}}return{type:"skip"}}case"shift_flipped_card_optional":{const s=n.cardId,d=n.optional,u=Ne(t,s);if(!u)return{type:"skip"};const p=u.card,f=u.owner,h=p.isFaceUp?p.value:2;let w=u.laneIndex??-1;if(w===-1){const U=t[f];for(let V=0;V<U.lanes.length;V++)if(U.lanes[V].some(R=>R.id===s)){w=V;break}}if(w===-1)return{type:"skip"};const g=[0,1,2].filter(U=>U!==w);if(g.length===0)return{type:"skip"};const y=t.opponent,m=t.player,x=y.laneValues[w],S=y.compiled[w],E=m.laneValues[w],j=x-h;let b=-1,k=-1/0;const N=0;for(const U of g){const V=y.laneValues[U],R=y.compiled[U],O=m.laneValues[U],X=V+h;let M=0;!S&&x>=8&&x>E&&(M-=100),!R&&X>=10&&X>O&&(M+=80),!R&&V<x&&(S||x<6)&&(M+=20),R&&(M-=30),!R&&V<=O&&X>O&&(M+=25),!S&&x>E&&j<=E&&(M-=40),M>k&&(k=M,b=U)}return d&&k<N?{type:"skip"}:b!==-1?{type:"selectLane",laneIndex:b}:d?{type:"skip"}:{type:"selectLane",laneIndex:g[0]}}case"select_lane_to_shift_revealed_card_for_light_2":case"select_lane_to_shift_revealed_card":{const s=n.revealedCardId,d=Ne(t,s);if(!d)return{type:"selectLane",laneIndex:0};let u=-1;for(let f=0;f<t[d.owner].lanes.length;f++)if(t[d.owner].lanes[f].some(h=>h.id===s)){u=f;break}const p=[0,1,2].filter(f=>f!==u);return p.length>0?(d.owner==="opponent"?p.sort((f,h)=>{const w=t.opponent.laneValues[f],g=t.opponent.laneValues[h];return!t.opponent.compiled[f]&&t.opponent.compiled[h]?-1:t.opponent.compiled[f]&&!t.opponent.compiled[h]?1:g-w}):p.sort((f,h)=>t.player.laneValues[f]-t.player.laneValues[h]),{type:"selectLane",laneIndex:p[0]}):{type:"selectLane",laneIndex:0}}case"select_opponent_face_down_card_to_shift":{const s=[];for(const d of t.player.lanes)if(d.length>0){const u=d[d.length-1];u.isFaceUp||s.push(u)}return s.length>0?{type:"deleteCard",cardId:s[Math.floor(Math.random()*s.length)].id}:{type:"skip"}}case"select_opponent_covered_card_to_shift":{const s=[];for(const d of t.player.lanes)for(let u=0;u<d.length-1;u++)s.push(d[u]);return s.length>0?{type:"deleteCard",cardId:s[Math.floor(Math.random()*s.length)].id}:{type:"skip"}}case"select_own_covered_card_to_shift":{const s=[];for(const d of t.opponent.lanes)for(let u=0;u<d.length-1;u++)s.push(d[u]);return s.length>0?{type:"deleteCard",cardId:s[Math.floor(Math.random()*s.length)].id}:{type:"skip"}}case"select_card_to_flip":{const s=n.targetFilter||{},d=n.restrictedLaneIndex??n.currentLaneIndex??n.laneIndex,u=n.scope,p=n.actor,f=n.sourceCardId,h=[];for(const g of["player","opponent"])if(!(s.owner==="own"&&g!==p)&&!(s.owner==="opponent"&&g===p))for(let y=0;y<t[g].lanes.length;y++){if(d!==void 0&&y!==d||u==="this_lane"&&d!==void 0&&y!==d)continue;const m=t[g].lanes[y];for(let x=0;x<m.length;x++){const S=m[x];if(Ho(t,S.id))continue;const E=Vo(t,m,x);if(Xr(S,E,s,f)&&!(s.position==="covered_in_this_line"&&E)){if(s.valueMinGreaterThanHandSize){const j=t[p].hand.length;if(S.value<=j)continue}h.push({card:S,owner:g,laneIndex:y})}}}if(h.length===0)return{type:"skip"};const w=h.map(({card:g,owner:y,laneIndex:m})=>{let x=0;const S=t[y].laneValues[m],E=t[y].compiled[m],j=g.isFaceUp?g.value:2,k=(g.isFaceUp?2:g.value)-j;return y==="player"?g.isFaceUp?(x=-k*15,x+=Qr(g,"player",t)):g.value<=1?x=20:x=-30:g.isFaceUp?k>0?(x=k*20+50,!E&&S+k>=10&&(x+=200)):x=k*15-30:k>0?(x=k*20+40,!E&&S+k>=10&&(x+=200)):x=-10,{card:g,score:x}});if(w.sort((g,y)=>y.score-g.score),Kr()&&w.length>1){const g=Math.floor(Math.random()*w.length);return{type:"flipCard",cardId:w[g].card.id}}return{type:"flipCard",cardId:w[0].card.id}}case"select_card_to_shift":{const s=n.targetFilter||{},u=n.scope==="this_lane"?n.sourceLaneIndex??n.currentLaneIndex??n.laneIndex:void 0,p=n.actor,f=n.sourceCardId,h=[];for(const w of["player","opponent"])if(!(s.owner==="own"&&w!==p)&&!(s.owner==="opponent"&&w===p))for(let g=0;g<t[w].lanes.length;g++){if(u!==void 0&&g!==u)continue;const y=t[w].lanes[g];for(let m=0;m<y.length;m++){const x=y[m],S=m===y.length-1;Xr(x,S,s,f)&&h.push(x)}}return h.length>0?{type:"shiftCard",cardId:h[Math.floor(Math.random()*h.length)].id}:{type:"skip"}}case"select_board_card_to_reveal_custom":{const s=[];for(const d of["player","opponent"])for(const u of t[d].lanes)if(u.length>0){const p=u[u.length-1];p.isFaceUp||s.push({card:p,owner:d})}if(s.length>0){const d=s.filter(u=>u.owner==="player");return d.length>0?{type:"deleteCard",cardId:d[0].card.id}:{type:"deleteCard",cardId:s[0].card.id}}return{type:"skip"}}case"prompt_shift_or_flip_board_card_custom":{const{revealedCardId:s}=n,d=Ne(t,s);return d?d.owner==="opponent"?{type:"resolveRevealBoardCardPrompt",choice:"flip"}:{type:"resolveRevealBoardCardPrompt",choice:"shift"}:{type:"resolveRevealBoardCardPrompt",choice:"skip"}}case"select_lane_to_shift_revealed_board_card_custom":{const s=[0,1,2];return s.sort((d,u)=>t.player.laneValues[d]-t.player.laneValues[u]),{type:"selectLane",laneIndex:s[0]}}case"gravity_2_shift_after_flip":{const{targetLaneIndex:s}=n;return{type:"selectLane",laneIndex:s}}case"flip_self":case"flip_self_for_water_0":case"flip_self_for_psychic_4":case"speed_3_self_flip_after_shift":return n.sourceCardId?{type:"flipCard",cardId:n.sourceCardId}:{type:"skip"};case"anarchy_0_conditional_draw":return{type:"skip"};case"select_any_opponent_card_to_shift":{const s=t.player.lanes.map(d=>d.length>0?d[d.length-1]:null).filter(d=>d!==null);return s.length>0?{type:"deleteCard",cardId:s[Math.floor(Math.random()*s.length)].id}:{type:"skip"}}case"select_own_other_card_to_shift":{const s=t.opponent.lanes.flat().find(d=>d.id!==n.sourceCardId);return s?{type:"deleteCard",cardId:s.id}:{type:"skip"}}case"select_own_face_up_covered_card_to_flip":return{type:"skip"};case"plague_4_opponent_delete":{const s=[];return t.opponent.lanes.forEach(d=>{if(d.length>0){const u=d[d.length-1];u.isFaceUp||s.push(u)}}),s.length>0?(s.sort((d,u)=>d.value-u.value),{type:"deleteCard",cardId:s[0].id}):{type:"skip"}}case"reveal_opponent_hand":case"plague_2_player_discard":case"delete_self":return{type:"skip"};case"select_card_from_trash_to_play":{const s=t.opponent.discard;return s.length===0?{type:"skip"}:{type:"selectTrashCard",cardIndex:[...s].map((u,p)=>{var h,w,g;let f=u.value*10;for(let y=0;y<3;y++){if(t.opponent.compiled[y])continue;const m=t.opponent.laneValues[y]+u.value;m>=10&&m>t.player.laneValues[y]&&(f+=100)}return(h=u.keywords)!=null&&h.flip&&(f+=5),(w=u.keywords)!=null&&w.draw&&(f+=3),(g=u.keywords)!=null&&g.delete&&(f+=5),{card:u,index:p,score:f}}).sort((u,p)=>p.score-u.score)[0].index}}case"select_card_from_trash_to_reveal":{const s=t.opponent.discard;return s.length===0?{type:"skip"}:{type:"selectTrashCard",cardIndex:[...s].map((u,p)=>({card:u,index:p,value:u.value})).sort((u,p)=>p.value-u.value)[0].index}}case"select_lane_for_delete":{const s=n.validLanes||[0,1,2],d=n.valueFilter,u=s.map(p=>{let f=0,h=0;for(const w of t.player.lanes[p]){const g=w.isFaceUp?w.value:2;d?w.isFaceUp?w.value>=d.min&&w.value<=d.max&&(f+=g+1):f+=(g+1)*.5:f+=g+1}for(const w of t.opponent.lanes[p]){const g=w.isFaceUp?w.value:2;d?w.isFaceUp?w.value>=d.min&&w.value<=d.max&&(h+=g+3):h+=(g+3)*.5:h+=g+3}return{laneIndex:p,score:f-h}});return u.sort((p,f)=>f.score-p.score),u[0].score>0?{type:"selectLane",laneIndex:u[0].laneIndex}:{type:"selectLane",laneIndex:u[0].laneIndex}}case"select_lane_for_shift_all":{const s=n.validDestinationLanes||n.validLanes||[0,1,2],d=n.sourceLaneIndex,u=s.filter(p=>p!==d);if(u.length>0){const p=u.map(f=>{let h=0;return h+=t.opponent.lanes[f].length*2,h+=t.opponent.laneValues[f],t.player.laneValues[f]>=8&&(h-=5),{laneIndex:f,score:h}});return p.sort((f,h)=>h.score-f.score),{type:"selectLane",laneIndex:p[0].laneIndex}}return s.length>0?{type:"selectLane",laneIndex:s[0]}:{type:"selectLane",laneIndex:0}}case"prompt_optional_draw":return{type:"resolveOptionalEffectPrompt",accept:!0};case"prompt_optional_discard_custom":return{type:"resolveOptionalEffectPrompt",accept:t.opponent.hand.length>4};case"prompt_optional_shuffle_trash":return{type:"resolvePrompt",accept:(n.trashCount||0)>0};case"select_card_from_revealed_deck":{const s=n.selectableCardIds||[];if(s.length>0){const d=Math.floor(Math.random()*s.length);return{type:"selectRevealedDeckCard",cardId:s[d]}}return{type:"resolvePrompt",accept:!1}}case"custom_choice":{const{options:s}=n;if(!s||s.length!==2)return{type:"resolveCustomChoice",optionIndex:0};const d=f=>{var g,y,m;let h=0;const w=((g=f.action)==null?void 0:g.toLowerCase())||"";return w.includes("draw")&&(h+=30),w.includes("discard")&&(h-=20),w.includes("delete")&&((y=f.targetFilter)==null?void 0:y.owner)==="opponent"&&(h+=40),w.includes("delete")&&((m=f.targetFilter)==null?void 0:m.owner)==="own"&&(h-=30),h},u=d(s[0]),p=d(s[1]);return{type:"resolveCustomChoice",optionIndex:u>=p?0:1}}case"select_phase_effect":{const s=n;if(s.availableEffects.length===0)return{type:"skip"};const d=s.availableEffects.map(p=>{let f=0;const h=p.effectDescription.toLowerCase();return h.includes("draw")?f+=100:h.includes("delete")?f+=80:h.includes("shift")?f+=60:h.includes("flip")?f+=40:f+=20,Math.random()<.05&&(f=Math.random()*50),{effect:p,score:f}});return d.sort((p,f)=>f.score-p.score),{type:"flipCard",cardId:d[0].effect.cardId}}case"state_number":{const s={0:0,1:0,2:0,3:0,4:0,5:0};t.opponent.hand.forEach(p=>{p.value>=0&&p.value<=5&&s[p.value]++}),s[2]+=2,s[3]+=2;let d=0,u=s[0];for(let p=1;p<=5;p++)s[p]>u&&(u=s[p],d=p);return Math.random()<.05&&(d=Math.floor(Math.random()*6)),{type:"stateNumber",number:d}}case"state_protocol":{const d=n.availableProtocols||[];if(d.length===0)return{type:"skip"};const u=t.player.protocols,p=d.map(f=>{let h=0;return u.includes(f)&&(h+=50),h+=Math.random()*20,{protocol:f,score:h}});return p.sort((f,h)=>h.score-f.score),{type:"stateProtocol",protocol:p[0].protocol}}case"select_from_drawn_to_reveal":{const d=n.eligibleCardIds||[];if(d.length===0)return{type:"skip"};const u=t.opponent.hand,p=d.map(f=>{const h=u.find(g=>g.id===f);if(!h)return{cardId:f,score:0};let w=h.value;return t.opponent.protocols.includes(h.protocol)&&(w+=10),{cardId:f,score:w}});return p.sort((f,h)=>h.score-f.score),{type:"selectFromDrawnToReveal",cardId:p[0].cardId}}case"confirm_deck_discard":return{type:"confirmDeckDiscard"};case"confirm_deck_play_preview":return{type:"confirmDeckPlayPreview"};default:{if("optional"in n&&n.optional)return{type:"skip"};const s=[...t.player.lanes.flat(),...t.opponent.lanes.flat()];return s.length>0&&(n.type.includes("select_")||n.type.includes("shift"))?{type:"deleteCard",cardId:s[0].id}:{type:"skip"}}}},ox=(t,n)=>n?ax(t,n):t.phase==="compile"&&t.compilableLanes.length>0?{type:"compile",laneIndex:t.compilableLanes.reduce((i,s)=>t.opponent.laneValues[s]>t.opponent.laneValues[i]?s:i)}:t.phase==="action"?nx(t):{type:"fillHand"};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * GameStateAnalyzer - Analyzes the current game state to recommend strategies
 *
 * This module provides deep analysis of the game state to help the AI make
 * intelligent decisions based on the current situation rather than just card values.
 */function rx(t){const n=t.player.lanes.flat().length,r=t.opponent.lanes.flat().length;return n+r}function ki(t,n){return t[n].compiled.filter(r=>r).length}function lx(t){const n=rx(t),r=ki(t,"player"),i=ki(t,"opponent"),s=r+i;return r===2||i===2?"endgame":s>=2?"late":n<=4?"early":"mid"}function sx(t,n,r,i=3.5){if(r)return-1;const s=Math.max(10-t,n-t+1);return s<=0?0:Math.ceil(s/i)}function ix(t){const n=[];for(let r=0;r<3;r++){const i=t.opponent.laneValues[r],s=t.player.laneValues[r],d=t.opponent.compiled[r],u=t.player.compiled[r];n.push({laneIndex:r,ourValue:i,playerValue:s,weAreLeading:i>s,playerIsLeading:s>i,isTied:i===s,ourDistanceToCompile:d?-1:Math.max(10-i,s-i+1),playerDistanceToCompile:u?-1:Math.max(10-s,i-s+1),ourProtocol:t.opponent.protocols[r],playerProtocol:t.player.protocols[r],isCompiled:d,playerLaneCompiled:u})}return n}function cx(t,n){const r=[],i=[];for(const d of n)d.playerLaneCompiled||(d.playerValue>=10&&d.playerValue>d.ourValue?r.push(d.laneIndex):d.playerValue>=8&&d.playerValue<10&&i.push(d.laneIndex));let s=1/0;for(const d of n){if(d.playerLaneCompiled)continue;const u=sx(d.playerValue,d.ourValue,d.playerLaneCompiled);u>=0&&u<s&&(s=u)}return{playerCanCompile:r.length>0,playerCompileLanes:r,playerNearCompileLanes:i,turnsUntilPlayerCompile:s===1/0?99:s,playerHasControl:t.controlCardHolder==="player",playerCompiledCount:ki(t,"player")}}function dx(t,n){const r=n.map(f=>f.ourValue),i=n.filter(f=>f.weAreLeading&&!f.isCompiled).length,s=t.controlCardHolder==="opponent";let d=-1,u=1/0;for(const f of n)f.isCompiled||f.ourDistanceToCompile>=0&&f.ourDistanceToCompile<u&&(u=f.ourDistanceToCompile,d=f.laneIndex);const p=!s&&i>=1;return{ourCompileProgress:r,closestLane:d,closestLaneDistance:u===1/0?99:u,weHaveControl:s,lanesWeLeadIn:i,canGetControlThisTurn:p,ourCompiledCount:ki(t,"opponent")}}function ux(t,n,r){let i=0;switch(t.playerCanCompile&&(i+=80),i+=t.playerNearCompileLanes.length*20,r){case"endgame":i+=30;break;case"late":i+=15;break;case"mid":i+=5;break}return t.playerCompiledCount>n.ourCompiledCount&&(i+=20),t.playerHasControl&&(i+=15,t.playerCompiledCount>=1&&(i+=30)),Math.min(100,i)}function px(t,n,r,i){if(n.playerCanCompile){for(const s of n.playerCompileLanes){const d=i[s];if(d.playerValue-d.ourValue<=6)return"defend"}return r.closestLaneDistance<=3?"rush":"disrupt"}if(n.playerHasControl&&n.playerCompiledCount>=1)return"control";if(t==="endgame"){if(r.ourCompiledCount===2)return"rush";if(n.playerCompiledCount===2)return n.playerNearCompileLanes.length>0?"defend":"disrupt"}if(n.playerCompiledCount>=1){if(!r.weHaveControl&&r.canGetControlThisTurn)return"control";if(n.playerNearCompileLanes.length>0)return r.lanesWeLeadIn>=1?"control":"disrupt"}if(r.closestLaneDistance<=4)return"rush";if(t==="early"||t==="mid"){if(r.closestLaneDistance<=6)return"rush";if(n.turnsUntilPlayerCompile<3)return"disrupt"}return"rush"}function ey(t){const n=ix(t),r=lx(t),i=cx(t,n),s=dx(t,n),d=ux(i,s,r),u=px(r,i,s,n);return{gamePhase:r,threats:i,position:s,lanes:n,recommendedStrategy:u,urgency:d}}function fx(t,n){const r=n.lanes[t],{recommendedStrategy:i}=n;if(r.isCompiled)return{isGood:!1,reason:"Already compiled",score:-1e3};switch(i){case"rush":{const s=100-r.ourDistanceToCompile*10;return{isGood:r.ourDistanceToCompile<=6,reason:`Distance to compile: ${r.ourDistanceToCompile}`,score:s}}case"control":{if(r.weAreLeading)return{isGood:!1,reason:"Already leading - need other lanes for control",score:-50};const s=r.playerValue-r.ourValue,d=100-s*15;return{isGood:s<=4,reason:`Gap to lead: ${s}`,score:d}}case"disrupt":{if(r.playerLaneCompiled)return{isGood:!1,reason:"Player already compiled",score:-100};const s=r.playerValue*10;return{isGood:r.playerValue>=5,reason:`Player value: ${r.playerValue}`,score:s}}case"defend":return n.threats.playerCompileLanes.includes(t)?{isGood:!0,reason:"BLOCKING COMPILE THREAT",score:200}:{isGood:!1,reason:"Not a threat lane",score:0}}}function hx(t){const n=[];for(let r=0;r<3;r++){const i=fx(r,t);i.score>-100&&n.push({laneIndex:r,score:i.score,reason:i.reason})}return n.sort((r,i)=>i.score-r.score),n}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * EffectEvaluator - Evaluates card effects in context
 *
 * This module provides intelligent evaluation of card effects based on
 * the current game state and strategy, not just raw card values.
 *
 * KEY INSIGHT: A flip effect on a 6-value card is GREAT (reduces by 4),
 * but on a 0-value card is TERRIBLE (increases by 2)!
 *
 * NEW: Uses AI Card Memory to remember face-down card values for smarter decisions.
 */function mu(t,n){for(const r of["player","opponent"])for(let i=0;i<t[r].lanes.length;i++)if(t[r].lanes[i].some(s=>s.id===n))return i;return-1}function yu(t,n){const r=[];for(const i of t[n].lanes)i.length>0&&r.push(i[i.length-1]);return r}function ty(t){const n=t.keywords;return n.delete||n.return||n.discard||t.top.length>0||t.bottom.includes("Start:")||t.bottom.includes("End:")}function mx(t,n,r,i){const s=[],d=r||{};for(const u of["player","opponent"]){if(d.owner==="own"&&u!=="opponent"||d.owner==="opponent"&&u!=="player")continue;const p=yu(t,u);for(const f of p){if(i&&f.id===i||d.faceState==="face_up"&&!f.isFaceUp||d.faceState==="face_down"&&f.isFaceUp)continue;const h=mu(t,f.id);let w=0,g="";if(u==="player")if(f.isFaceUp){const y=f.value-2;w=y*25,y>0?g=`Flip ${f.protocol}-${f.value}: Enemy loses ${y} value`:y<0?g=`BAD: Flip ${f.protocol}-${f.value}: Enemy GAINS ${-y} value!`:g=`Neutral: Flip ${f.protocol}-${f.value}: No value change`;const m=n.lanes[h];m&&m.playerValue>=8&&(w+=40,g+=" [Near compile!]"),ty(f)&&(w+=30,g+=" [Has dangerous effects]")}else{const y=cm(t,f.id);if(y!==null){const m=y-2;m>0?(w=-m*20,g=`BAD: KNOWN card ${f.protocol}-${y}: Enemy gains ${m}!`):m<0?(w=-m*20,g=`GOOD: KNOWN card ${f.protocol}-${y}: Enemy loses ${-m}`):(w=10,g=`Neutral: KNOWN card ${f.protocol}-${y}: No change`)}else w=5,g="Reveal UNKNOWN enemy card (risky - might help them)"}else if(f.isFaceUp){const y=f.value-2;w=-y*30,g=`BAD: Flip own ${f.protocol}-${f.value}: We lose ${y} value`}else{const y=cm(t,f.id),m=y!==null?y:f.value,x=m-2;x>0?(w=x*25+20,g=`Flip own card: Gain ${x} value (${m} - 2)`):x<0?(w=x*20,g=`BAD: Flip own card: LOSE ${-x} value`):(w=5,g="Neutral: Flip own card: No value change");const S=n.lanes[h];if(S&&!S.isCompiled){const E=S.ourValue-2+m;E>=10&&E>S.playerValue?(w+=150,g+=" [ENABLES COMPILE!]"):S.ourDistanceToCompile<=4&&(w+=30,g+=" [Near compile]")}}s.push({targetId:f.id,targetOwner:u,laneIndex:h,score:w,reasoning:g})}}return s.sort((u,p)=>p.score-u.score),s}function Sm(t,n,r,i){const s=[],d=r||{};for(const u of["player","opponent"]){if(d.owner==="own"&&u!=="opponent"||d.owner==="opponent"&&u!=="player")continue;const p=yu(t,u);for(const f of p){if(i&&f.id===i||d.faceState==="face_up"&&!f.isFaceUp||d.faceState==="face_down"&&f.isFaceUp)continue;const h=mu(t,f.id),w=f.isFaceUp?f.value:2;let g=0,y="";if(u==="player"){g=w*25,y=`Delete ${f.isFaceUp?f.protocol+"-"+f.value:"face-down"}: Remove ${w} value`;const m=n.lanes[h];m&&(m.playerValue>=10&&m.playerValue>m.ourValue?(g+=100,y+=" [BLOCKS COMPILE!]"):m.playerValue>=8&&(g+=50,y+=" [Near compile]")),f.isFaceUp&&ty(f)&&(g+=40,y+=" [Has dangerous effects]")}else{g=-w*30,y=`BAD: Delete own ${f.isFaceUp?f.protocol+"-"+f.value:"face-down"}: Lose ${w} value`;const m=n.lanes[h];m&&m.isCompiled&&(g+=50,y+=" [Lane already compiled]")}s.push({targetId:f.id,targetOwner:u,laneIndex:h,score:g,reasoning:y})}}return s.sort((u,p)=>p.score-u.score),s}function yx(t,n,r,i){const s=[],d=r||{};for(const u of["player","opponent"]){if(d.owner==="own"&&u!=="opponent"||d.owner==="opponent"&&u!=="player")continue;const p=yu(t,u);for(const f of p){if(i&&f.id===i)continue;const h=mu(t,f.id),w=f.isFaceUp?f.value:2;let g=0,y="";if(u==="player"){g=w*20,y=`Return ${f.isFaceUp?f.protocol+"-"+f.value:"face-down"}: Remove ${w} value (to hand)`;const m=n.lanes[h];m&&(m.playerValue>=10&&m.playerValue>m.ourValue?(g+=80,y+=" [BLOCKS COMPILE!]"):m.playerValue>=8&&(g+=40,y+=" [Near compile]")),g+=15,y+=" [Tempo gain]"}else g=-w*20,y=`Return own ${f.isFaceUp?f.protocol+"-"+f.value:"face-down"}: Lose ${w} value (recoverable)`;s.push({targetId:f.id,targetOwner:u,laneIndex:h,score:g,reasoning:y})}}return s.sort((u,p)=>p.score-u.score),s}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 *
 * NORMAL AI - Strategic AI that plays to win
 *
 * NEW ARCHITECTURE:
 * - Uses GameStateAnalyzer to understand the current situation
 * - Uses EffectEvaluator to score card effects contextually
 * - Uses Strategies to make decisions based on game phase
 * - 5% chance to make suboptimal moves for slight unpredictability
 */const sl=["delete","flip","shift","return","discard"],un=t=>{let n=12-t.value;return sl.some(r=>t.keywords[r])&&(n+=6),t.keywords.draw&&(n+=3),t.keywords.play&&(n+=8),t.keywords.prevent&&(n+=4),n},Vd=(t,n,r)=>{let i;for(const d of r[n].lanes)if(d.some(u=>u.id===t.id)){i=d;break}if(!i)return 0;if(!t.isFaceUp)return i.some(u=>u.isFaceUp&&u.protocol==="Darkness"&&u.value===2)?4:2;let s=t.value*2.5;return t.top.length>0&&(s+=6),(t.bottom.includes("Start:")||t.bottom.includes("End:"))&&(s+=8),t.bottom.includes("covered:")&&(s+=5),sl.some(d=>t.keywords[d])&&(s+=4),s},Jr=()=>Math.random()<.05,bm=t=>t+(Math.random()*4-2),Zr=(t,n,r,i)=>{const s=r.position||"uncovered";return!(s==="uncovered"&&!n||s==="covered"&&n||r.faceState==="face_up"&&!t.isFaceUp||r.faceState==="face_down"&&t.isFaceUp||r.excludeSelf&&i&&t.id===i||r.valueRange&&(!t.isFaceUp||t.value<r.valueRange.min||t.value>r.valueRange.max)||r.valueEquals!==void 0&&(!t.isFaceUp||t.value!==r.valueEquals))},gx=t=>{var V,R,O,X;t=fw(t);const n=[],r=ey(t),{gamePhase:i,threats:s,position:d,lanes:u,recommendedStrategy:p}=r,f=Qm(t,"opponent");t.player.lanes.flat().length+t.opponent.lanes.flat().length;const h=i==="early",w=i==="mid",y=t.player.lanes.flat().length>0;s.playerCompiledCount,d.weHaveControl,s.playerHasControl;const m=d.lanesWeLeadIn;3-m-u.filter(M=>M.isTied&&!M.isCompiled).length;const x=t.useControlMechanic===!0,S=p==="control"&&x;s.playerCanCompile,s.playerCompileLanes[0],d.ourCompiledCount;const E=hx(r),j=E.length>0?E[0].laneIndex:-1,b=(M,$)=>M.keywords.flip||M.keywords.delete||M.keywords.shift||M.keywords.return?t.player.lanes.flat().length>0||t.opponent.lanes.some((D,L)=>L!==$&&D.length>0)||t.opponent.lanes[$].length>0:!0,k=M=>M.keywords.draw?t.opponent.hand.length>=5:!1;for(const M of t.opponent.hand)for(let $=0;$<3;$++){const B=fr(t,"opponent",$,!0,M.protocol),I=fr(t,"opponent",$,!1,M.protocol);if(!B.allowed&&!I.allowed||t.opponent.compiled[$])continue;const D=t.player.laneValues[$]>=10&&t.player.laneValues[$]>t.opponent.laneValues[$]&&!t.player.compiled[$];if(D){const G=Math.max(B.allowed?M.value:0,I.allowed?fn({...M,isFaceUp:!1},t.opponent.lanes[$]):0);if(t.opponent.laneValues[$]+G<t.player.laneValues[$]&&!sl.some(W=>M.keywords[W]))continue}let L=!1;if(Zm(M)){let G=0;for(let A=0;A<3;A++)if(t.opponent.lanes[A].length>0){if(A===$)continue;G++}G===0&&(L=!0)}if(hu(M)){const G=t.opponent.laneValues[$],A=Math.max(0,10-M.value);if(G<A)continue;const W=G+M.value,J=t.player.laneValues[$];if(W<=J)continue}const T=Xm(t,"opponent",$);if(T!==null){const G=t.opponent.laneValues[$],A=G+M.value-T,W=A>=10&&A>t.player.laneValues[$],J=G-T>=4;if(!W&&!J)continue}const q=D;let P=!1;if(Km(M)){let G=0;for(let A=0;A<3;A++){const W=t.opponent.lanes[A];if(W.length>0&&A!==$){const J=W[W.length-1],Q=J.isFaceUp?J.value:2;Q>G&&(G=Q)}}M.value>=G&&(P=!0)}if(B.allowed&&!f&&!P&&!L){let G=0,A=`Play ${M.protocol}-${M.value} face-up in lane ${$}`;const W=M.value,J=t.opponent.laneValues[$]+W;if(q)J>t.player.laneValues[$]?(G=180+J*5,A+=" [Blocks compile!]"):J===t.player.laneValues[$]?(G=160+J*3,A+=" [Blocks compile with tie!]"):(G=-500,A+=" [WASTE: Card goes to trash when player compiles!]");else{if(G+=W*10,J>=10&&J>t.player.laneValues[$]&&!t.opponent.compiled[$])G+=200,A+=` [COMPILE: ${J}]`;else if(J>=8&&J<10&&!t.opponent.compiled[$]){const ee=t.opponent.lanes[$].some(me=>me.isFaceUp&&me.protocol==="Darkness"&&me.value===2)?4:2;t.opponent.laneValues[$]+ee>=10&&J<10?(G-=50,A+=` [Near ${J} but face-down could compile!]`):(G+=40,A+=` [Near compile: ${J}]`)}h&&W<=2&&(G-=50,A+=" [Low value early game penalty]"),b(M,$)||(G-=80,A+=" [No valid targets for effect]"),k(M)&&(G-=30,A+=" [Draw would cause discard]");const Q=sl.some(ee=>M.keywords[ee]);if(Q&&y?w&&t.player.laneValues[$]>=5?(G+=35,A+=" [Disruption with targets]"):t.player.laneValues[$]>=8&&(G+=50,A+=" [Disruption near compile]"):Q&&!y&&(G-=40,A+=" [Disruption but no targets]"),j!==-1&&!S&&($===j?(G+=150,A+=" [FOCUS LANE]"):(G-=100,A+=" [Not focus lane]")),S){const ee=t.opponent.laneValues[$]>t.player.laneValues[$],oe=J>t.player.laneValues[$],me=t.opponent.laneValues[$]===t.player.laneValues[$];if(ee)G-=200,A+=" [ALREADY LEADING - DON'T WASTE!]";else if(!ee&&oe)m===1?(G+=500,A+=" [CONTROL CAPTURE! 1->2 leads]"):m===0?(G+=300,A+=" [First lead! 0->1 leads]"):(G+=100,A+=" [Extra lead]");else if(me&&oe)m===1?(G+=450,A+=" [BREAK TIE FOR CONTROL!]"):(G+=250,A+=" [Break tie]");else if(!ee&&!oe&&m===1){const ke=t.player.laneValues[$]-J;ke<=3?(G+=200,A+=` [BUILD toward 2nd lead, gap=${ke}]`):ke<=6?(G+=150,A+=` [BUILD toward 2nd lead, gap=${ke}]`):(G+=100,A+=` [BUILD toward 2nd lead, gap=${ke}]`)}}}n.push({move:{type:"playCard",cardId:M.id,laneIndex:$,isFaceUp:!0},score:bm(G),reason:A})}if(I.allowed){const G=fn({...M,isFaceUp:!1},t.opponent.lanes[$]),A=t.opponent.laneValues[$]+G,W=t.opponent.laneValues[$];let J=-100,Q=`Play ${M.protocol}-${M.value} face-down in lane ${$}`;if(q?A>=t.player.laneValues[$]?(J=150,Q+=` [Blocks compile: ${A} vs ${t.player.laneValues[$]}]`):(J=-500,Q+=" [WASTE: Card goes to trash when player compiles!]"):!t.opponent.compiled[$]&&A>=10&&A>t.player.laneValues[$]?(J=300,Q+=` [COMPILE: Face-down finishes at ${W} -> ${A} beats player ${t.player.laneValues[$]}]`):!t.opponent.compiled[$]&&t.player.laneValues[$]>=10&&A>=t.player.laneValues[$]?(J=250,Q+=` [BLOCK COMPILE: Face-down reaches ${A} vs player ${t.player.laneValues[$]}]`):!t.opponent.compiled[$]&&t.player.laneValues[$]>=10&&A<t.player.laneValues[$]?(J=-500,Q+=" [WASTE: Card goes to trash when player compiles!]"):j===$&&!t.opponent.compiled[$]&&W>=4?(J=50+W*10,Q+=` [BUILD FOCUS: ${W} -> ${A}]`):!B.allowed&&M.value<=1?(J=-20,Q+=" [No face-up option, low value]"):(J=-120,Q+=" [Avoid: Face-up is better]"),j!==-1&&J<50&&!S&&($===j?(J+=50,Q+=" [Focus lane]"):(J-=80,Q+=" [Not focus lane]")),S){const ee=t.opponent.laneValues[$]>t.player.laneValues[$],oe=A>t.player.laneValues[$],me=t.opponent.laneValues[$]===t.player.laneValues[$];if(ee)J-=200,Q+=" [FD ALREADY LEADING - DON'T WASTE!]";else if(!ee&&oe)m===1?(J+=400,Q+=" [FD CONTROL CAPTURE! 1->2 leads]"):m===0&&(J+=250,Q+=" [FD First lead!]");else if(me&&oe)m===1?(J+=350,Q+=" [FD BREAK TIE FOR CONTROL!]"):(J+=200,Q+=" [FD Break tie]");else if(!ee&&!oe&&m===1){const ke=t.player.laneValues[$]-A;ke<=3?(J+=150,Q+=` [FD BUILD toward 2nd lead, gap=${ke}]`):ke<=6&&(J+=100,Q+=` [FD BUILD toward 2nd lead, gap=${ke}]`)}}n.push({move:{type:"playCard",cardId:M.id,laneIndex:$,isFaceUp:!1},score:bm(J),reason:Q})}}if(t.opponent.hand.length===0)n.push({move:{type:"fillHand"},score:500,reason:"Must refill - no cards"});else{const M=t.player.laneValues.some((I,D)=>I>=10&&I>t.opponent.laneValues[D]&&!t.player.compiled[D]),$=t.controlCardHolder==="opponent",B=t.player.compiled.some(I=>I);M&&$&&B&&n.push({move:{type:"fillHand"},score:200,reason:"Emergency draw to block compile with control swap"})}if(n.length===0)return{type:"fillHand"};n.sort((M,$)=>$.score-M.score);const N=M=>{if(M.type==="playCard"&&M.isFaceUp){const $=t.opponent.hand.find(I=>I.id===M.cardId);if(!$)return!1;const B=fr(t,"opponent",M.laneIndex,!0,$.protocol);if(!B.allowed)return console.warn(`[AI Safety] Rejecting invalid face-up play: ${$.protocol}-${$.value} in lane ${M.laneIndex} - ${B.reason}`),!1}return!0};if(!(((R=(V=n[0])==null?void 0:V.reason)==null?void 0:R.includes("Blocks compile"))||((X=(O=n[0])==null?void 0:O.reason)==null?void 0:X.includes("BLOCK COMPILE")))&&Jr()&&n.length>1&&n[1].score>0&&N(n[1].move))return n[1].move;for(const M of n)if(N(M.move))return M.move;return console.warn("[AI Safety] No valid moves found, falling back to fillHand"),{type:"fillHand"}},vx=(t,n)=>{var i,s,d,u,p,f,h,w;const r=ey(t);switch(n.type){case"prompt_use_control_mechanic":{const g=t.player.compiled.filter(S=>S).length,y=t.compilableLanes.length>0?t.compilableLanes[0]:null;let m=-1;for(let S=0;S<3;S++)if(!t.player.compiled[S]&&t.player.laneValues[S]>=10&&t.player.laneValues[S]>t.opponent.laneValues[S]){m=S;break}const x=t.player.compiled.map((S,E)=>S?E:-1).filter(S=>S!==-1);return m!==-1&&x.length>0?{type:"resolveControlMechanicPrompt",choice:"player"}:g===0?ji(t,y)&&!Jr()?{type:"resolveControlMechanicPrompt",choice:"opponent"}:{type:"resolveControlMechanicPrompt",choice:"skip"}:Ym(t,y)?{type:"resolveControlMechanicPrompt",choice:"player"}:ji(t,y)&&!Jr()?{type:"resolveControlMechanicPrompt",choice:"opponent"}:{type:"resolveControlMechanicPrompt",choice:"skip"}}case"discard":return{type:"discardCards",cardIds:[...t.opponent.hand].sort((y,m)=>{const x=sl.some(E=>y.keywords[E]),S=sl.some(E=>m.keywords[E]);return x&&!S?1:!x&&S?-1:un(y)-un(m)}).slice(0,n.count).map(y=>y.id)};case"discard_completed":return{type:"skip"};case"select_opponent_card_to_flip":{const y=(x=>t[x].lanes.map(S=>S.length>0?S[S.length-1]:null).filter(S=>S!==null))("player");if(y.length===0)return{type:"skip"};const m=y.map(x=>({cardId:x.id,score:x.isFaceUp?x.value+5:3}));return m.sort((x,S)=>S.score-x.score),{type:"flipCard",cardId:m[0].cardId}}case"select_cards_to_delete":{const g=n.disallowedIds||[],y=n.allowedIds,m=n.targetFilter??{},x="actorChooses"in n?n.actorChooses:"effect_owner",S=n.sourceCardId;if(x==="card_owner"&&(m==null?void 0:m.owner)==="opponent"){const b=[];return t.opponent.lanes.forEach(k=>{if(k.length>0){const N=k[k.length-1];if(Zr(N,!0,m,S)){if(y&&!y.includes(N.id))return;b.push(N)}}}),b.length>0?(b.sort((k,N)=>k.value-N.value),{type:"deleteCard",cardId:b[0].id}):{type:"skip"}}const E=b=>t[b].lanes.map(k=>k.length>0?k[k.length-1]:null).filter(k=>k!==null).filter(k=>Zr(k,!0,m,S)).filter(k=>!y||y.includes(k.id)),j=m==null?void 0:m.owner;if(j==="own"){const b=E("opponent").filter(k=>!g.includes(k.id));if(b.length>0)return{type:"deleteCard",cardId:b.sort((N,U)=>N.value-U.value)[0].id}}else if(j==="opponent"){const b=E("player").filter(k=>!g.includes(k.id));if(b.length>0){const k=Sm(t,r,{owner:"opponent"},S),N=new Set(b.map(V=>V.id)),U=k.filter(V=>N.has(V.targetId));return U.length>0?{type:"deleteCard",cardId:U[0].targetId}:{type:"deleteCard",cardId:b[0].id}}}else{const b=E("player").filter(N=>!g.includes(N.id));if(b.length>0){const N=Sm(t,r,void 0,S),U=new Set(b.map(R=>R.id)),V=N.filter(R=>U.has(R.targetId));return V.length>0?{type:"deleteCard",cardId:V[0].targetId}:{type:"deleteCard",cardId:b[0].id}}const k=E("opponent").filter(N=>!g.includes(N.id));if(k.length>0)return{type:"deleteCard",cardId:k.sort((U,V)=>U.value-V.value)[0].id}}return{type:"skip"}}case"select_any_card_to_flip":case"select_any_other_card_to_flip":case"select_any_face_down_card_to_flip_optional":case"select_any_card_to_flip_optional":{const g=Pa(t),y=n.targetFilter,m=n.sourceCardId,x=n.actor,S=n.currentLaneIndex??n.laneIndex,E=n.scope,j=[];for(const U of["player","opponent"])if(!(y&&(y.owner==="own"&&U!==x||y.owner==="opponent"&&U===x)))for(let V=0;V<t[U].lanes.length;V++){if(S!==void 0&&V!==S||E==="this_lane"&&S!==void 0&&V!==S)continue;const R=t[U].lanes[V];if(R.length!==0)for(let O=0;O<R.length;O++){const X=R[O],M=O===R.length-1;if(y){if(!Zr(X,M,y,m))continue}else if(!M)continue;g&&!X.isFaceUp||j.push({card:X,owner:U})}}if(j.length===0)return{type:"skip"};const b=mx(t,r,y,m),k=new Set(j.map(U=>U.card.id)),N=b.filter(U=>k.has(U.targetId));return N.length>0?{type:"flipCard",cardId:N[0].targetId}:{type:"flipCard",cardId:j[0].card.id}}case"plague_2_opponent_discard":return t.opponent.hand.length===0?{type:"skip"}:{type:"discardCards",cardIds:[[...t.opponent.hand].sort((y,m)=>un(y)-un(m))[0].id]};case"select_card_from_hand_to_play":{if(t.opponent.hand.length===0)return{type:"skip"};const g=n.faceDown===!0,y=n.selectableCardIds,m=y?t.opponent.hand.filter(j=>y.includes(j.id)):t.opponent.hand;if(m.length===0)return{type:"skip"};let x=n.validLanes||[0,1,2].filter(j=>j!==n.disallowedLaneIndex);if(x=x.filter(j=>{const b=t.player.lanes[j],k=b.length>0?b[b.length-1]:null;return!(k&&k.isFaceUp&&k.protocol==="Plague"&&k.value===0)}),x.length===0)return{type:"skip"};const S=[];for(const j of m)for(const b of x){if(!g){const U=t.opponent.lanes.flat().some(M=>M.isFaceUp&&M.protocol==="Spirit"&&M.value===1),V=((s=(i=j.customEffects)==null?void 0:i.bottomEffects)==null?void 0:s.some(M=>{var $,B;return(($=M.params)==null?void 0:$.action)==="card_property"&&((B=M.params)==null?void 0:B.property)==="ignore_protocol_matching"}))||((u=(d=j.customEffects)==null?void 0:d.topEffects)==null?void 0:u.some(M=>{var $,B;return(($=M.params)==null?void 0:$.action)==="card_property"&&((B=M.params)==null?void 0:B.property)==="ignore_protocol_matching"}))||((f=(p=j.customEffects)==null?void 0:p.middleEffects)==null?void 0:f.some(M=>{var $,B;return(($=M.params)==null?void 0:$.action)==="card_property"&&((B=M.params)==null?void 0:B.property)==="ignore_protocol_matching"})),R=[...t.player.lanes.flat(),...t.opponent.lanes.flat()].some(M=>M.isFaceUp&&M.protocol==="Anarchy"&&M.value===1),O=il(t,"opponent",b,j.protocol);let X;if(R?X=j.protocol!==t.opponent.protocols[b]&&j.protocol!==t.player.protocols[b]:X=j.protocol===t.opponent.protocols[b]||j.protocol===t.player.protocols[b]||U||V||O,X){const M=j.value,$=t.opponent.laneValues[b]+M;let B=un(j)+M*2;$>=10&&$>t.player.laneValues[b]&&(B+=100);const I=t.player.laneValues[b],D=t.player.compiled[b],L=t.opponent.compiled[b],T=t.opponent.laneValues[b];!D&&!L&&I>=10&&I>T&&$>=I&&(B+=160),S.push({cardId:j.id,laneIndex:b,isFaceUp:!0,score:B})}}if(!t.player.lanes[b].some(U=>U.isFaceUp&&U.protocol==="Metal"&&U.value===2)){const U=fn({...j,isFaceUp:!1},t.opponent.lanes[b]),V=t.opponent.laneValues[b]+U;let R=U*2;V>=10&&V>t.player.laneValues[b]&&(R+=80);const O=t.player.laneValues[b],X=t.player.compiled[b],M=t.opponent.compiled[b],$=t.opponent.laneValues[b];!X&&!M&&O>=10&&O>$&&V>=O&&(R+=150),S.push({cardId:j.id,laneIndex:b,isFaceUp:!1,score:R})}}if(S.length===0)return{type:"skip"};S.sort((j,b)=>b.score-j.score);const E=S[0];return{type:"playCard",cardId:E.cardId,laneIndex:E.laneIndex,isFaceUp:E.isFaceUp}}case"select_card_from_hand_to_give":return t.opponent.hand.length===0?{type:"skip"}:{type:"giveCard",cardId:[...t.opponent.hand].sort((y,m)=>un(y)-un(m))[0].id};case"select_card_from_hand_to_reveal":return t.opponent.hand.length===0?{type:"skip"}:{type:"revealCard",cardId:[...t.opponent.hand].sort((y,m)=>un(m)-un(y))[0].id};case"select_card_to_return":case"select_opponent_card_to_return":{const y={position:"uncovered",...n.targetFilter||{}},m=n.targetOwner||y.owner,x=n.sourceCardId,S=n.actor,E=[];for(const V of["player","opponent"])if(!(m==="own"&&V!==S)&&!(m==="opponent"&&V===S))for(const R of t[V].lanes)for(let O=0;O<R.length;O++){const X=R[O],M=O===R.length-1;Zr(X,M,y,x)&&E.push({card:X,owner:V})}if(E.length===0)return{type:"skip"};const j=yx(t,r,y,x),b=new Set(E.map(V=>V.card.id)),k=j.filter(V=>b.has(V.targetId));if(k.length>0)return{type:"returnCard",cardId:k[0].targetId};const N=E.filter(V=>V.owner==="player"),U=E.filter(V=>V.owner==="opponent");return N.length>0?(N.sort((V,R)=>Vd(R.card,"player",t)-Vd(V.card,"player",t)),{type:"returnCard",cardId:N[0].card.id}):U.length>0?(U.sort((V,R)=>V.card.value-R.card.value),{type:"returnCard",cardId:U[0].card.id}):{type:"returnCard",cardId:E[0].card.id}}case"select_lane_for_play":{let g=n.validLanes||[0,1,2];if(g=g.filter(x=>!("disallowedLaneIndex"in n)||x!==n.disallowedLaneIndex),g=g.filter(x=>{const S=t.player.lanes[x],E=S.length>0?S[S.length-1]:null,j=E&&E.isFaceUp&&E.protocol==="Plague"&&E.value===0,b="isFaceDown"in n&&n.isFaceDown&&S.some(k=>k.isFaceUp&&k.protocol==="Metal"&&k.value===2);return!j&&!b}),g.length===0)return{type:"skip"};const y=g.filter(x=>{const S=t.player.laneValues[x],E=t.opponent.laneValues[x],j=t.player.compiled[x],b=t.opponent.compiled[x],k=!j&&S>=10&&S>E,N=E+2>=S;return k&&N&&!b});if(y.length>0)return y.sort((x,S)=>t.player.laneValues[S]-t.player.laneValues[x]),{type:"selectLane",laneIndex:y[0]};const m=g.map(x=>{const S=t.opponent.laneValues[x]-t.player.laneValues[x];return{laneIndex:x,score:-S}});return m.sort((x,S)=>S.score-x.score),{type:"selectLane",laneIndex:m[0].laneIndex}}case"prompt_rearrange_protocols":return Wm(t,n);case"prompt_swap_protocols":{const{target:g}=n,y=t[g].protocols,m=t[g].hand,x=t[g].compiled,S=t[g].laneValues,E=[[0,1],[0,2],[1,2]];let j=[0,1],b=-1/0;for(const k of E){const[N,U]=k,V=[...y];[V[N],V[U]]=[V[U],V[N]];let R=0;const O=x[N],X=x[U],M=S[N],$=S[U];if(g==="opponent"){O&&!X?$<M&&(R+=30):X&&!O&&M<$&&(R+=30);for(const B of m){const I=B.protocol===y[N],D=B.protocol===y[U],L=B.protocol===V[N],T=B.protocol===V[U],q=O?.5:1.5,P=X?.5:1.5;L&&!I&&(R+=un(B)*q),T&&!D&&(R+=un(B)*P),!L&&I&&(R-=un(B)*q),!T&&D&&(R-=un(B)*P)}}else{O&&!X?M>$&&(R+=25):X&&!O&&$>M&&(R+=25);for(const B of m){const I=B.protocol===y[N],D=B.protocol===y[U],L=B.protocol===V[N],T=B.protocol===V[U],q=O?.5:1.5,P=X?.5:1.5;L&&!I&&(R-=un(B)*q),T&&!D&&(R-=un(B)*P),!L&&I&&(R+=un(B)*q),!T&&D&&(R+=un(B)*P)}}R>b&&(b=R,j=k)}return{type:"resolveSwapProtocols",indices:j}}case"select_lane_for_shift":{let g=n.validLanes||[0,1,2];if(g=g.filter(y=>!("disallowedLaneIndex"in n)||y!==n.disallowedLaneIndex).filter(y=>!("originalLaneIndex"in n)||y!==n.originalLaneIndex),"sourceCardId"in n){const y=[...t.player.lanes.flat(),...t.opponent.lanes.flat()].find(m=>m.id===n.sourceCardId);if(y&&y.protocol==="Gravity"&&y.value===1){let m=null;for(let x=0;x<3;x++)if([...t.player.lanes[x],...t.opponent.lanes[x]].some(E=>E.id===n.sourceCardId)){m=x;break}m!==null&&"originalLaneIndex"in n&&(n.originalLaneIndex===m||(g=[m]))}if(y&&y.protocol==="Anarchy"&&y.value===1){const m="cardToShiftId"in n?n.cardToShiftId:null;if(m){const x=[...t.player.lanes.flat(),...t.opponent.lanes.flat()].find(S=>S.id===m);x&&(g=g.filter(S=>{const E=t.player.protocols[S],j=t.opponent.protocols[S],b=x.protocol;return b!==E&&b!==j}))}}}if(g.length>0){const y="cardToShiftId"in n?n.cardToShiftId:null;let m=null,x=0;if(y)for(const E of["player","opponent"]){for(const j of t[E].lanes){const b=j.find(k=>k.id===y);if(b){m=E,x=b.isFaceUp?b.value:2;break}}if(m)break}const S=g.map(E=>{let j=0;const b=t.player.laneValues[E],k=t.opponent.laneValues[E],N=t.player.compiled[E],U=t.opponent.compiled[E];return m==="player"?N?j+=100:k>b?j+=50:b>=6&&b<10&&!N&&(j-=50):m==="opponent"&&(!U&&k<10?k+x>=10?j+=100:k>=6?j+=60:j+=30:U&&(j-=50)),{laneIdx:E,score:j}});if(S.sort((E,j)=>j.score-E.score),Jr()&&S.length>1){const E=Math.floor(Math.random()*S.length);return{type:"selectLane",laneIndex:S[E].laneIdx}}return{type:"selectLane",laneIndex:S[0].laneIdx}}return{type:"selectLane",laneIndex:0}}case"select_lane_for_delete_all":{const g="validLanes"in n?n.validLanes:[0,1,2];return g.length>0?{type:"selectLane",laneIndex:g[Math.floor(Math.random()*g.length)]}:{type:"skip"}}case"select_lanes_for_swap_stacks":{const g=n.validLanes,y=n.selectedFirstLane;if(g.length===0)return{type:"skip"};if(y===void 0){const m=g.map(x=>{const S=t.opponent.laneValues[x];return{laneIdx:x,score:S}});return m.sort((x,S)=>x.score-S.score),{type:"selectLane",laneIndex:m[0].laneIdx}}else{const m=g.map(x=>{const S=t.opponent.laneValues[x];return{laneIdx:x,score:S}});return m.sort((x,S)=>S.score-x.score),{type:"selectLane",laneIndex:m[0].laneIdx}}}case"select_card_for_copy_middle":{const g=n.validTargetIds||[];if(g.length===0)return{type:"skip"};const y=g.map(m=>{var S,E;let x=0;for(const j of["player","opponent"])for(const b of t[j].lanes){const k=b.find(N=>N.id===m);if(k){const U=((S=k.customEffects)==null?void 0:S.middleEffects)||[];for(const V of U){const R=(E=V.params)==null?void 0:E.action;R==="draw"&&(x+=5),R==="flip"&&(x+=3),R==="delete"&&(x+=4),R==="shift"&&(x+=2),R==="discard"&&(x-=2)}}}return{cardId:m,score:x}});return y.sort((m,x)=>x.score-m.score),{type:"selectCard",cardId:y[0].cardId}}case"select_lane_for_return":{const g=n.targetFilter||{},y=n.actor,m=g.valueEquals,x=g.valueRange,S=[];for(let E=0;E<3;E++){let j=0,b=0;const k=Jm(t,E);for(const V of["player","opponent"]){if(g.owner==="own"&&V!==y||g.owner==="opponent"&&V===y)continue;const R=t[V].lanes[E];for(let O=0;O<R.length;O++){const X=R[O],M=O===R.length-1;if(g.position==="uncovered"&&!M||g.position==="covered"&&M)continue;const $=X.isFaceUp?X.value:2+k;m!==void 0&&$!==m||x&&($<x.min||$>x.max)||(V==="player"?j+=$:b+=$)}}const N=j-b,U=`Lane ${E}: Player loses ${j}, we lose ${b}, net=${N}`;S.push({laneIndex:E,score:N,reason:U})}S.sort((E,j)=>j.score-E.score);for(const E of S);return S.length>0?{type:"selectLane",laneIndex:S[0].laneIndex}:{type:"selectLane",laneIndex:0}}case"prompt_optional_effect":{const{effectDef:g}=n,y=(h=g==null?void 0:g.params)==null?void 0:h.action,m=(w=g==null?void 0:g.params)==null?void 0:w.targetFilter;if(y==="give")return{type:"resolveOptionalEffectPrompt",accept:!1};if(y==="flip"){let x=!1;const S=(m==null?void 0:m.position)||"uncovered";for(const E of["player","opponent"])if(!((m==null?void 0:m.owner)==="own"&&E!=="opponent")&&!((m==null?void 0:m.owner)==="opponent"&&E==="opponent")){for(let j=0;j<t[E].lanes.length;j++){const b=t[E].lanes[j];if(b.length!==0){for(let k=0;k<b.length;k++){const N=b[k],U=k===b.length-1,V=!U;if(S==="uncovered"&&!U||S==="covered"&&!V||(m==null?void 0:m.faceState)==="face_up"&&!N.isFaceUp||(m==null?void 0:m.faceState)==="face_down"&&N.isFaceUp)continue;const R=N.isFaceUp?N.value:2,O=N.isFaceUp?2:N.value;if(E==="player"){if(N.isFaceUp&&R>O){x=!0;break}}else{const X=t.opponent.laneValues[j],M=O-R;if(N.isFaceUp&&M>0){x=!0;break}if(!N.isFaceUp&&N.value>2){x=!0;break}if(M>0&&X+M>=10&&!t.opponent.compiled[j]){x=!0;break}}}if(x)break}}if(x)break}return{type:"resolveOptionalEffectPrompt",accept:x}}return{type:"resolveOptionalEffectPrompt",accept:!Jr()}}case"select_card_from_other_lanes_to_delete":{const{disallowedLaneIndex:g,lanesSelected:y}=n,m=[];for(let x=0;x<3;x++){if(x===g||y.includes(x))continue;const S=t.player.lanes[x];if(S.length>0){m.push(S[S.length-1]);continue}const E=t.opponent.lanes[x];E.length>0&&m.push(E[E.length-1])}return m.length>0?{type:"deleteCard",cardId:m[0].id}:{type:"skip"}}case"select_face_down_card_to_delete":{const g="disallowedIds"in n&&Array.isArray(n.disallowedIds)?n.disallowedIds:[],y=S=>t[S].lanes.map(E=>E.length>0?E[E.length-1]:null).filter(E=>E!==null),m=y("player").filter(S=>!g.includes(S.id));if(m.length>0)return{type:"deleteCard",cardId:m[0].id};const x=y("opponent").filter(S=>!g.includes(S.id));return x.length>0?{type:"deleteCard",cardId:x[0].id}:{type:"skip"}}case"select_low_value_card_to_delete":{const g=[];for(const m of["player","opponent"])for(const x of t[m].lanes)x.length>0&&g.push(x[x.length-1]);const y=g.filter(m=>m.isFaceUp&&(m.value===0||m.value===1));return y.length>0?{type:"deleteCard",cardId:y[0].id}:{type:"skip"}}case"select_opponent_face_up_card_to_flip":{const y=(m=>t[m].lanes.map(x=>x.length>0?x[x.length-1]:null).filter(x=>x!==null))("player").filter(m=>m.isFaceUp);return y.length>0?(y.sort((m,x)=>x.value-m.value),{type:"flipCard",cardId:y[0].id}):{type:"skip"}}case"select_covered_card_in_line_to_flip_optional":{const g="optional"in n&&n.optional,m=!["select_any_other_card_to_flip","select_any_other_card_to_flip_for_water_0"].includes(n.type);if(n.type==="select_covered_card_in_line_to_flip_optional"){const{laneIndex:k}=n,N=t.opponent.lanes[k],U=t.player.lanes[k],V=N.filter((I,D,L)=>D<L.length-1),R=U.filter((I,D,L)=>D<L.length-1),O=t.opponent.laneValues[k];if(!t.opponent.compiled[k]){let I=null,D=null;for(const L of V){let T,q;L.isFaceUp?(T=L.value,q=2):(T=fn(L,N,t,k,"opponent"),q=L.value);const P=q-T,Z=O+P;P>0&&Z>=10&&(!I||Z>I.newValue)&&(I={card:L,newValue:Z,gain:P}),P>0&&(!D||P>D.gain)&&(D={card:L,gain:P,newValue:Z})}if(I)return{type:"flipCard",cardId:I.card.id};if(D&&D.gain>0)return{type:"flipCard",cardId:D.card.id}}if(t.opponent.compiled[k]){let I=null;for(const D of V){const L=D.isFaceUp?D.value:fn(D,N,t,k,"opponent"),q=(D.isFaceUp?2:D.value)-L;q>0&&(!I||q>I.gain)&&(I={card:D,gain:q})}if(I)return{type:"flipCard",cardId:I.card.id}}const M=R.filter(I=>I.isFaceUp);if(M.length>0)return M.sort((I,D)=>D.value-I.value),{type:"flipCard",cardId:M[0].id};const $=V.filter(I=>!I.isFaceUp).map(I=>({card:I,gain:I.value-fn(I,N,t,k,"opponent")})).filter(I=>I.gain>0).sort((I,D)=>D.gain-I.gain);if($.length>0)return{type:"flipCard",cardId:$[0].card.id};const B=R.filter(I=>!I.isFaceUp);return B.length>0?{type:"flipCard",cardId:B[0].id}:{type:"skip"}}const x=k=>t[k].lanes.map(N=>N.length>0?N[N.length-1]:null).filter(N=>N!==null),S=x("player"),E=x("opponent");{const k=S.filter(N=>N.isFaceUp).sort((N,U)=>U.value-N.value);if(k.length>0)return{type:"flipCard",cardId:k[0].id}}const j=E.filter(k=>!k.isFaceUp);if(j.length>0)return{type:"flipCard",cardId:j[0].id};const b=S.filter(k=>!k.isFaceUp);if(b.length>0)return{type:"flipCard",cardId:b[0].id};{const k=E.filter(U=>!(!U.isFaceUp||!m&&U.id===n.sourceCardId)),N=k.filter(U=>{const V=t.opponent.lanes.findIndex(R=>R.length>0&&R[R.length-1].id===U.id);return V!==-1&&t.opponent.compiled[V]});if(N.length>0&&!g)return{type:"flipCard",cardId:N[0].id};if(k.length>0&&!g)return{type:"flipCard",cardId:k[0].id}}return{type:"skip"}}case"shift_flipped_card_optional":{const g=n.cardId,y=n.optional,m=Ne(t,g);if(!m)return{type:"skip"};const x=m.card,S=m.owner,E=x.isFaceUp?x.value:2;let j=m.laneIndex??-1;if(j===-1){const B=t[S];for(let I=0;I<B.lanes.length;I++)if(B.lanes[I].some(D=>D.id===g)){j=I;break}}if(j===-1)return{type:"skip"};const b=[0,1,2].filter(B=>B!==j);if(b.length===0)return{type:"skip"};const k=t.opponent,N=t.player,U=k.laneValues[j],V=k.compiled[j],R=N.laneValues[j],O=U-E;let X=-1,M=-1/0;const $=0;for(const B of b){const I=k.laneValues[B],D=k.compiled[B],L=N.laneValues[B],T=I+E;let q=0;!V&&U>=8&&U>R&&(q-=100),!D&&T>=10&&T>L&&(q+=80),!D&&I<U&&(V||U<6)&&(q+=20),D&&(q-=30),!D&&I<=L&&T>L&&(q+=25),!V&&U>R&&O<=R&&(q-=40),q>M&&(M=q,X=B)}return y&&M<$?{type:"skip"}:X!==-1?{type:"selectLane",laneIndex:X}:y?{type:"skip"}:{type:"selectLane",laneIndex:b[0]}}case"select_lane_to_shift_revealed_card_for_light_2":case"select_lane_to_shift_revealed_card":{const g=n.revealedCardId,y=Ne(t,g);if(!y)return{type:"selectLane",laneIndex:0};let m=-1;for(let S=0;S<t[y.owner].lanes.length;S++)if(t[y.owner].lanes[S].some(E=>E.id===g)){m=S;break}const x=[0,1,2].filter(S=>S!==m);return x.length>0?(y.owner==="opponent"?x.sort((S,E)=>{const j=t.opponent.laneValues[S],b=t.opponent.laneValues[E];return!t.opponent.compiled[S]&&t.opponent.compiled[E]?-1:t.opponent.compiled[S]&&!t.opponent.compiled[E]?1:b-j}):x.sort((S,E)=>t.player.laneValues[S]-t.player.laneValues[E]),{type:"selectLane",laneIndex:x[0]}):{type:"selectLane",laneIndex:0}}case"select_opponent_face_down_card_to_shift":{const g=[];for(const y of t.player.lanes)if(y.length>0){const m=y[y.length-1];m.isFaceUp||g.push(m)}return g.length>0?{type:"deleteCard",cardId:g[Math.floor(Math.random()*g.length)].id}:{type:"skip"}}case"select_opponent_covered_card_to_shift":{const g=[];for(const y of t.player.lanes)for(let m=0;m<y.length-1;m++)g.push(y[m]);return g.length>0?{type:"deleteCard",cardId:g[Math.floor(Math.random()*g.length)].id}:{type:"skip"}}case"select_own_covered_card_to_shift":{const g=[];for(const y of t.opponent.lanes)for(let m=0;m<y.length-1;m++)g.push(y[m]);return g.length>0?{type:"deleteCard",cardId:g[Math.floor(Math.random()*g.length)].id}:{type:"skip"}}case"select_card_to_flip":{const g=n.targetFilter||{},y=n.restrictedLaneIndex??n.currentLaneIndex??n.laneIndex,m=n.scope,x=n.actor,S=n.sourceCardId,E=[];for(const b of["player","opponent"])if(!(g.owner==="own"&&b!==x)&&!(g.owner==="opponent"&&b===x))for(let k=0;k<t[b].lanes.length;k++){if(y!==void 0&&k!==y||m==="this_lane"&&y!==void 0&&k!==y)continue;const N=t[b].lanes[k];for(let U=0;U<N.length;U++){const V=N[U];if(Ho(t,V.id))continue;const R=Vo(t,N,U);if(Zr(V,R,g,S)&&!(g.position==="covered_in_this_line"&&R)){if(g.valueMinGreaterThanHandSize){const O=t[x].hand.length;if(V.value<=O)continue}E.push({card:V,owner:b,laneIndex:k})}}}if(E.length===0)return{type:"skip"};const j=E.map(({card:b,owner:k,laneIndex:N})=>{let U=0;const V=t[k].laneValues[N],R=t[k].compiled[N],O=b.isFaceUp?b.value:2,M=(b.isFaceUp?2:b.value)-O;return k==="player"?b.isFaceUp?(U=-M*15,U+=Vd(b,"player",t)):b.value<=1?U=20:U=-30:b.isFaceUp?M>0?(U=M*20+50,!R&&V+M>=10&&(U+=200)):U=M*15-30:M>0?(U=M*20+40,!R&&V+M>=10&&(U+=200)):U=-10,{card:b,score:U}});if(j.sort((b,k)=>k.score-b.score),Jr()&&j.length>1){const b=Math.floor(Math.random()*j.length);return{type:"flipCard",cardId:j[b].card.id}}return{type:"flipCard",cardId:j[0].card.id}}case"select_card_to_shift":{const g=n.targetFilter||{},m=n.scope==="this_lane"?n.sourceLaneIndex??n.currentLaneIndex??n.laneIndex:void 0,x=n.actor,S=n.sourceCardId,E=[];for(const j of["player","opponent"])if(!(g.owner==="own"&&j!==x)&&!(g.owner==="opponent"&&j===x))for(let b=0;b<t[j].lanes.length;b++){if(m!==void 0&&b!==m)continue;const k=t[j].lanes[b];for(let N=0;N<k.length;N++){const U=k[N],V=N===k.length-1;Zr(U,V,g,S)&&E.push(U)}}return E.length>0?{type:"shiftCard",cardId:E[Math.floor(Math.random()*E.length)].id}:{type:"skip"}}case"select_board_card_to_reveal_custom":{const g=[];for(const y of["player","opponent"])for(const m of t[y].lanes)if(m.length>0){const x=m[m.length-1];x.isFaceUp||g.push({card:x,owner:y})}if(g.length>0){const y=g.filter(m=>m.owner==="player");return y.length>0?{type:"deleteCard",cardId:y[0].card.id}:{type:"deleteCard",cardId:g[0].card.id}}return{type:"skip"}}case"prompt_shift_or_flip_board_card_custom":{const{revealedCardId:g}=n,y=Ne(t,g);return y?y.owner==="opponent"?{type:"resolveRevealBoardCardPrompt",choice:"flip"}:{type:"resolveRevealBoardCardPrompt",choice:"shift"}:{type:"resolveRevealBoardCardPrompt",choice:"skip"}}case"select_lane_to_shift_revealed_board_card_custom":{const g=[0,1,2];return g.sort((y,m)=>t.player.laneValues[y]-t.player.laneValues[m]),{type:"selectLane",laneIndex:g[0]}}case"gravity_2_shift_after_flip":{const{targetLaneIndex:g}=n;return{type:"selectLane",laneIndex:g}}case"flip_self":case"flip_self_for_water_0":case"flip_self_for_psychic_4":case"speed_3_self_flip_after_shift":return n.sourceCardId?{type:"flipCard",cardId:n.sourceCardId}:{type:"skip"};case"anarchy_0_conditional_draw":return{type:"skip"};case"select_any_opponent_card_to_shift":{const g=t.player.lanes.map(y=>y.length>0?y[y.length-1]:null).filter(y=>y!==null);return g.length>0?{type:"deleteCard",cardId:g[Math.floor(Math.random()*g.length)].id}:{type:"skip"}}case"select_own_other_card_to_shift":{const g=t.opponent.lanes.flat().find(y=>y.id!==n.sourceCardId);return g?{type:"deleteCard",cardId:g.id}:{type:"skip"}}case"select_own_face_up_covered_card_to_flip":return{type:"skip"};case"plague_4_opponent_delete":{const g=[];return t.opponent.lanes.forEach(y=>{if(y.length>0){const m=y[y.length-1];m.isFaceUp||g.push(m)}}),g.length>0?(g.sort((y,m)=>y.value-m.value),{type:"deleteCard",cardId:g[0].id}):{type:"skip"}}case"reveal_opponent_hand":case"plague_2_player_discard":case"delete_self":return{type:"skip"};case"select_card_from_trash_to_play":{const g=t.opponent.discard;return g.length===0?{type:"skip"}:{type:"selectTrashCard",cardIndex:[...g].map((m,x)=>{var E,j,b;let S=m.value*10;for(let k=0;k<3;k++){if(t.opponent.compiled[k])continue;const N=t.opponent.laneValues[k]+m.value;N>=10&&N>t.player.laneValues[k]&&(S+=100)}return(E=m.keywords)!=null&&E.flip&&(S+=5),(j=m.keywords)!=null&&j.draw&&(S+=3),(b=m.keywords)!=null&&b.delete&&(S+=5),{card:m,index:x,score:S}}).sort((m,x)=>x.score-m.score)[0].index}}case"select_card_from_trash_to_reveal":{const g=t.opponent.discard;return g.length===0?{type:"skip"}:{type:"selectTrashCard",cardIndex:[...g].map((m,x)=>({card:m,index:x,value:m.value})).sort((m,x)=>x.value-m.value)[0].index}}case"select_lane_for_delete":{const g=n.validLanes||[0,1,2],y=n.valueFilter,m=g.map(x=>{let S=0,E=0;for(const j of t.player.lanes[x]){const b=j.isFaceUp?j.value:2;y?j.isFaceUp?j.value>=y.min&&j.value<=y.max&&(S+=b+1):S+=(b+1)*.5:S+=b+1}for(const j of t.opponent.lanes[x]){const b=j.isFaceUp?j.value:2;y?j.isFaceUp?j.value>=y.min&&j.value<=y.max&&(E+=b+3):E+=(b+3)*.5:E+=b+3}return{laneIndex:x,score:S-E}});return m.sort((x,S)=>S.score-x.score),m[0].score>0?{type:"selectLane",laneIndex:m[0].laneIndex}:{type:"selectLane",laneIndex:m[0].laneIndex}}case"select_lane_for_shift_all":{const g=n.validDestinationLanes||n.validLanes||[0,1,2],y=n.sourceLaneIndex,m=g.filter(x=>x!==y);if(m.length>0){const x=m.map(S=>{let E=0;return E+=t.opponent.lanes[S].length*2,E+=t.opponent.laneValues[S],t.player.laneValues[S]>=8&&(E-=5),{laneIndex:S,score:E}});return x.sort((S,E)=>E.score-S.score),{type:"selectLane",laneIndex:x[0].laneIndex}}return g.length>0?{type:"selectLane",laneIndex:g[0]}:{type:"selectLane",laneIndex:0}}case"prompt_optional_draw":return{type:"resolveOptionalEffectPrompt",accept:!0};case"prompt_optional_discard_custom":return{type:"resolveOptionalEffectPrompt",accept:t.opponent.hand.length>4};case"prompt_optional_shuffle_trash":return{type:"resolvePrompt",accept:(n.trashCount||0)>0};case"select_card_from_revealed_deck":{const g=n.selectableCardIds||[];if(g.length>0){const y=Math.floor(Math.random()*g.length);return{type:"selectRevealedDeckCard",cardId:g[y]}}return{type:"resolvePrompt",accept:!1}}case"reveal_deck_draw_protocol":return{type:"confirmRevealDeckDrawProtocol"};case"custom_choice":{const{options:g}=n;if(!g||g.length!==2)return{type:"resolveCustomChoice",optionIndex:0};const y=S=>{var b,k,N;let E=0;const j=((b=S.action)==null?void 0:b.toLowerCase())||"";return j.includes("draw")&&(E+=30),j.includes("discard")&&(E-=20),j.includes("delete")&&((k=S.targetFilter)==null?void 0:k.owner)==="opponent"&&(E+=40),j.includes("delete")&&((N=S.targetFilter)==null?void 0:N.owner)==="own"&&(E-=30),E},m=y(g[0]),x=y(g[1]);return{type:"resolveCustomChoice",optionIndex:m>=x?0:1}}case"select_phase_effect":{const g=n;if(g.availableEffects.length===0)return{type:"skip"};const y=g.availableEffects.map(x=>{let S=0;const E=x.effectDescription.toLowerCase();return E.includes("draw")?S+=100:E.includes("delete")?S+=80:E.includes("shift")?S+=60:E.includes("flip")?S+=40:S+=20,Math.random()<.05&&(S=Math.random()*50),{effect:x,score:S}});return y.sort((x,S)=>S.score-x.score),{type:"flipCard",cardId:y[0].effect.cardId}}case"state_number":{const g={0:0,1:0,2:0,3:0,4:0,5:0};t.opponent.hand.forEach(x=>{x.value>=0&&x.value<=5&&g[x.value]++}),g[2]+=2,g[3]+=2;let y=0,m=g[0];for(let x=1;x<=5;x++)g[x]>m&&(m=g[x],y=x);return Math.random()<.05&&(y=Math.floor(Math.random()*6)),{type:"stateNumber",number:y}}case"state_protocol":{const y=n.availableProtocols||[];if(y.length===0)return{type:"skip"};const m=t.player.protocols,x=y.map(S=>{let E=0;return m.includes(S)&&(E+=50),E+=Math.random()*20,{protocol:S,score:E}});return x.sort((S,E)=>E.score-S.score),{type:"stateProtocol",protocol:x[0].protocol}}case"select_from_drawn_to_reveal":{const y=n.eligibleCardIds||[];if(y.length===0)return{type:"skip"};const m=t.opponent.hand,x=y.map(S=>{const E=m.find(b=>b.id===S);if(!E)return{cardId:S,score:0};let j=E.value;return t.opponent.protocols.includes(E.protocol)&&(j+=10),{cardId:S,score:j}});return x.sort((S,E)=>E.score-S.score),{type:"selectFromDrawnToReveal",cardId:x[0].cardId}}case"confirm_deck_discard":return{type:"confirmDeckDiscard"};case"confirm_deck_play_preview":return{type:"confirmDeckPlayPreview"};default:{if("optional"in n&&n.optional)return{type:"skip"};const g=[...t.player.lanes.flat(),...t.opponent.lanes.flat()];return g.length>0&&(n.type.includes("select_")||n.type.includes("shift"))?{type:"deleteCard",cardId:g[0].id}:{type:"skip"}}}},Em=(t,n)=>n?vx(t,n):t.phase==="compile"&&t.compilableLanes.length>0?{type:"compile",laneIndex:t.compilableLanes.reduce((i,s)=>t.opponent.laneValues[s]>t.opponent.laneValues[i]?s:i)}:t.phase==="action"?gx(t):{type:"fillHand"};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const rt=(t,n)=>t.phase==="start"?n.continueTurnAfterStartPhaseAction(t):n.processEndOfAction(t),ny=(t,n,r,i,s,d,u,p)=>{const{cardId:f,laneIndex:h,isFaceUp:w}=n,{newState:g,animationRequests:y}=s.playCard({...t,actionRequired:null},f,h,w,"opponent"),m={...g,animationState:{type:"playCard",cardId:f,owner:"opponent"}};return setTimeout(()=>{r(x=>{let S={...x,animationState:null};return y&&y.length>0?(d(y,()=>r(E=>{const j={...E,animationState:null};return p&&j.actionRequired?(In(j,r,i,s,d,u),j):j.actionRequired&&j.actionRequired.actor==="opponent"?j:{...rt(j,u),animationState:null}})),S):p&&S.actionRequired?(In(S,r,i,s,d,u),S):S.actionRequired&&S.actionRequired.actor==="opponent"?S:rt(S,u)})},500),m},Ti=(t,n,r)=>{switch(r){case"normal":return Em(t,n);case"hard":return console.warn("[AI] Hard AI temporarily disabled, using Normal AI"),Em(t,n);default:return ox(t,n)}},_x=(t,n,r,i,s,d,u,p,f)=>{n(h=>{const w=h.actionRequired;if(!w||!((h.turn==="player"||h._interruptedTurn==="player")&&"actor"in w&&w.actor==="opponent"))return h;const m=Ti(h,w,r);if(m.type==="discardCards"&&w.type==="discard"){const E=w.variableCount===!0?m.cardIds.length:w.count,j=m.cardIds.slice(0,E);j.length!==m.cardIds.length&&console.warn(`[AI Manager] Fixed discard count: AI wanted ${m.cardIds.length} but action.count=${w.count}`);const b=i.discardCards(h,j,"opponent");return b.actionRequired?b:rt(b,s)}if(m.type==="rearrangeProtocols"&&w.type==="prompt_rearrange_protocols"){f&&w.sourceCardId==="CONTROL_MECHANIC"&&w.actor&&f(w.actor);const S=i.resolveRearrangeProtocols(h,m.newOrder);return rt(S,s)}if(w.type==="reveal_opponent_hand"){const S=i.revealOpponentHand(h);return rt(S,s)}if(m.type==="resolveOptionalEffectPrompt"&&w.type==="prompt_optional_draw"){const S=Xd(h,m.accept);return S.actionRequired?S:rt(S,s)}if(m.type==="resolveOptionalEffectPrompt"&&w.type==="prompt_optional_effect"){const S=Zd(h,m.accept);return S.actionRequired?S:rt(S,s)}if(m.type==="resolveCustomChoice"&&w.type==="custom_choice"){const S=Jd(h,m.optionIndex);return S.actionRequired?S:rt(S,s)}if(m.type==="selectLane"){const{nextState:S,requiresAnimation:E}=p(h,m.laneIndex);if(E){const j=h.phase==="start";return d(E.animationRequests,()=>{n(b=>{const k={...b,animationState:null},N=E.onCompleteCallback(k,V=>V);return N.actionRequired&&N.actionRequired.actor==="opponent"?{...N,animationState:null}:{...j?s.continueTurnAfterStartPhaseAction(N):s.processEndOfAction(N),animationState:null}})}),S}return rt(S,s)}if(m.type==="deleteCard"||m.type==="flipCard"||m.type==="returnCard"||m.type==="shiftCard"||m.type==="selectCard"){const{nextState:S,requiresAnimation:E}=u(h,m.cardId);if(E){const j=h.phase==="start";return d(E.animationRequests,()=>{n(b=>{const k={...b,animationState:null},N=E.onCompleteCallback(k,V=>V);return N.actionRequired&&N.actionRequired.actor==="opponent"?{...N,animationState:null}:{...j?s.continueTurnAfterStartPhaseAction(N):s.processEndOfAction(N),animationState:null}})}),S}return S.actionRequired&&S.actionRequired.actor==="opponent"?S:rt(S,s)}if(m.type==="playCard"&&w.type==="select_card_from_hand_to_play")return ny(h,m,n,r,i,d,s,!1);if(m.type==="stateNumber"&&w.type==="state_number"){const S=cu(h,m.number);return S.actionRequired&&S.actionRequired.actor==="opponent"?S:rt(S,s)}if(m.type==="stateProtocol"&&w.type==="state_protocol"){const S=du(h,m.protocol);return S.actionRequired&&S.actionRequired.actor==="opponent"?S:rt(S,s)}if(m.type==="selectFromDrawnToReveal"&&w.type==="select_from_drawn_to_reveal"){const S=uu(h,m.cardId);return S.actionRequired&&S.actionRequired.actor==="opponent"?S:rt(S,s)}if(m.type==="confirmDeckDiscard"&&w.type==="confirm_deck_discard"){const S=pu(h);return S.actionRequired&&S.actionRequired.actor==="opponent"?S:rt(S,s)}if(m.type==="confirmDeckPlayPreview"&&w.type==="confirm_deck_play_preview"){const S=fu(h);return S.actionRequired&&S.actionRequired.actor==="opponent"?S:rt(S,s)}if(w.type==="execute_conditional_followup"){const{sourceCardId:S,laneIndex:E,followUpEffect:j,context:b,actor:k,logSource:N,logPhase:U,logIndentLevel:V}=w,R=Ne(h,S);if(!R){let M={...h};return N!==void 0&&(M._currentEffectSource=N),U!==void 0&&(M._currentPhaseContext=U),V!==void 0&&(M._logIndentLevel=V),M=te(M,k,"Follow-up effect skipped (source no longer active)."),M.actionRequired=null,rt(M,s)}let O={...h,actionRequired:null};return O=ct(R.card,E,O,b,j).newState,O.actionRequired?O:rt(O,s)}console.warn(`AI has no logic for mandatory action during player turn, clearing it: ${w.type}, aiDecision: ${JSON.stringify(m)}`);const x={...h,actionRequired:null};return rt(x,s)})},wx=(t,n,r,i,s,d,u)=>{const p=t.actionRequired,f=Ti(t,t.actionRequired,r);if(f.type==="skip"){const w=i.skipAction(t),g=t.phase==="start"?d.continueTurnAfterStartPhaseAction(w):d.processEndOfAction(w);return!g.actionRequired&&g.turn==="opponent"&&!g.winner&&setTimeout(()=>{In(g,n,r,i,s,d,u)},500),g}if(f.type==="resolveControlMechanicPrompt"&&p.type==="prompt_use_control_mechanic"){const{choice:w}=f,{originalAction:g,actor:y}=p;if(w==="skip"){let m=te(t,y,"Opponent skips rearranging protocols.");if(m.actionRequired=null,m={...m,_logIndentLevel:0},g.type==="compile"){const x=g.laneIndex;return setTimeout(()=>{n(S=>{const E=i.compileLane(S,x);return E.winner?E:{...d.processEndOfAction(E),animationState:null}})},1e3),{...m,animationState:{type:"compile",laneIndex:x},compilableLanes:[]}}else if(g.type==="fill_hand"){const x=i.fillHand(m,y);return d.processEndOfAction(x)}else return d.processEndOfAction(m)}else{const m=w;let E=te(t,y,`Opponent chooses to rearrange ${m==="opponent"?"the player's":"their own"} protocols.`);return E.actionRequired={type:"prompt_rearrange_protocols",sourceCardId:"CONTROL_MECHANIC",target:m,actor:y,originalAction:g},E}}if(f.type==="resolveOptionalDiscardCustomPrompt"&&p.type==="prompt_optional_discard_custom"){const w=i.resolveOptionalDiscardCustomPrompt(t,f.accept);return w.actionRequired?w:rt(w,d)}if(f.type==="resolveOptionalEffectPrompt"&&p.type==="prompt_optional_draw"){const w=i.resolveOptionalDrawPrompt(t,f.accept);return w.actionRequired?w:rt(w,d)}if(f.type==="resolveOptionalEffectPrompt"){const w=i.resolveOptionalEffectPrompt(t,f.accept);return w.actionRequired?w:rt(w,d)}if(f.type==="resolvePrompt"&&p.type==="prompt_optional_shuffle_trash"){if(!f.accept){let g={...t};return g.actionRequired=null,g=te(g,p.actor,`${p.actor==="player"?"Player":"Opponent"} skips shuffling trash into deck.`),rt(g,d)}const w=Lm(t,p.actor,"Clarity-4");return rt(w.newState,d)}if(f.type==="resolveSwapProtocols"&&p.type==="prompt_swap_protocols"){const w=i.resolveSwapProtocols(t,f.indices);return rt(w,d)}if(f.type==="resolveCustomChoice"&&p.type==="custom_choice"){const w=i.resolveCustomChoice(t,f.optionIndex);return w.actionRequired?w:rt(w,d)}if(f.type==="resolveRevealBoardCardPrompt"&&(p.type==="prompt_shift_or_flip_revealed_card"||p.type==="prompt_shift_or_flip_board_card_custom")){const w=Kd(t,f.choice);return w.actionRequired?w:rt(w,d)}if(f.type==="rearrangeProtocols"&&p.type==="prompt_rearrange_protocols"){u&&p.sourceCardId==="CONTROL_MECHANIC"&&p.actor&&u(p.actor);const w=i.resolveRearrangeProtocols(t,f.newOrder);return rt(w,d)}if(f.type==="selectLane"){const{nextState:w,requiresAnimation:g}=Qd(t,f.laneIndex);if(g){const{animationRequests:y,onCompleteCallback:m}=g;return s(y,()=>{n(x=>{const S={...x,animationState:null};return m(S,E=>{const j={...E,animationState:null},k={...t.phase==="start"?d.continueTurnAfterStartPhaseAction(j):d.processEndOfAction(j),animationState:null};return!k.actionRequired&&k.turn==="opponent"&&!k.winner?setTimeout(()=>{In(k,n,r,i,s,d,u)},500):k.actionRequired&&k.turn==="opponent"&&setTimeout(()=>{In(k,n,r,i,s,d,u)},300),k})})}),w}return rt(w,d)}if(f.type==="flipCard"||f.type==="deleteCard"||f.type==="returnCard"||f.type==="shiftCard"||f.type==="selectCard"){const{nextState:w,requiresAnimation:g,requiresTurnEnd:y}=Wd(t,f.cardId);if(g){const{animationRequests:m,onCompleteCallback:x}=g;return s(m,()=>{n(S=>{const E={...S,animationState:null};return x(E,j=>{const b={...j,animationState:null};if(b.queuedActions&&b.queuedActions.length>0){const k=d.processEndOfAction(b);return k.actionRequired?(In(k,n,r,i,s,d),{...k,animationState:null}):{...k,animationState:null}}if(b.actionRequired)return In(b,n,r,i,s,d),b;if(b.phase==="start"){const N={...d.continueTurnAfterStartPhaseAction(b),animationState:null};return!N.actionRequired&&N.turn==="opponent"&&!N.winner&&setTimeout(()=>{In(N,n,r,i,s,d,u)},500),N}else return{...d.processEndOfAction(b),animationState:null}})})}),w}return y||w.queuedActions&&w.queuedActions.length>0?rt(w,d):w}if(f.type==="playCard"&&p.type==="select_card_from_hand_to_play")return ny(t,f,n,r,i,s,d,!0);if(f.type==="discardCards"&&p.type==="discard"){const g=p.variableCount===!0?f.cardIds.length:p.count,y=f.cardIds.slice(0,g);y.length!==f.cardIds.length&&console.warn(`[AI Manager] Fixed discard count: AI wanted ${f.cardIds.length} but action.count=${p.count}`);const m=i.discardCards(t,y,"opponent");return m.actionRequired?m:rt(m,d)}if(f.type==="giveCard"&&p.type==="select_card_from_hand_to_give"){const w=i.resolveActionWithHandCard(t,f.cardId);return w.actionRequired?w:rt(w,d)}if(f.type==="revealCard"&&p.type==="select_card_from_hand_to_reveal")return i.resolveActionWithHandCard(t,f.cardId);if(f.type==="selectRevealedDeckCard"&&p.type==="select_card_from_revealed_deck"){const w=Vm(t,f.cardId);return rt(w,d)}if(f.type==="confirmRevealDeckDrawProtocol"&&p.type==="reveal_deck_draw_protocol"){const w=zm(t);return rt(w,d)}if(f.type==="stateNumber"&&p.type==="state_number"){const w=cu(t,f.number);return w.actionRequired?w:rt(w,d)}if(f.type==="stateProtocol"&&p.type==="state_protocol"){const w=du(t,f.protocol);return w.actionRequired?w:rt(w,d)}if(f.type==="selectFromDrawnToReveal"&&p.type==="select_from_drawn_to_reveal"){const w=uu(t,f.cardId);return w.actionRequired?w:rt(w,d)}if(f.type==="confirmDeckDiscard"&&p.type==="confirm_deck_discard"){const w=pu(t);return w.actionRequired?w:rt(w,d)}if(f.type==="confirmDeckPlayPreview"&&p.type==="confirm_deck_play_preview"){const w=fu(t);return w.actionRequired?w:rt(w,d)}if(f.type==="selectTrashCard"&&p.type==="select_card_from_trash_to_play"){const w=Bm(t,f.cardIndex);return w.actionRequired?w:rt(w,d)}if(f.type==="selectTrashCard"&&p.type==="select_card_from_trash_to_reveal"){const w=Gm(t,f.cardIndex);return w.actionRequired?w:rt(w,d)}console.warn(`AI has no logic for mandatory action, clearing it: ${p.type}`);const h={...t,actionRequired:null};return rt(h,d)},In=(t,n,r,i,s,d,u)=>{n(p=>{if(p.turn!=="opponent"||p.winner||p.animationState||!["start","compile","action","hand_limit","end"].includes(p.phase))return p;if(p.actionRequired){const w=p.actionRequired;let g=!1;if((w.type==="discard"&&w.actor==="player"||w.type==="plague_4_opponent_delete"&&w.actor==="opponent"||"actor"in w&&w.actor==="player")&&(g=!0),g)return p}let h={...p};if(h.actionRequired&&h.actionRequired.type==="reveal_opponent_hand"){const w=i.revealOpponentHand(h);return d.processEndOfAction(w)}if(h.phase==="start"&&(h=d.processStartOfTurn(h)),h.actionRequired){const w=wx(h,n,r,i,s,d,u);return!w.actionRequired&&w.turn==="opponent"&&!w.winner&&w.phase!=="hand_limit"&&setTimeout(()=>{In(w,n,r,i,s,d,u)},300),w}if(h.phase==="compile"&&h.compilableLanes.length>0){const w=Ti(h,null,r);if(w.type==="compile"){const g=w.laneIndex,y=Hm(h);return y.actionRequired?y:(setTimeout(()=>{n(m=>{const x=i.compileLane(m,g);return x.winner?x:{...d.processEndOfAction(x),animationState:null}})},1e3),{...y,animationState:{type:"compile",laneIndex:g},compilableLanes:[]})}}if(h.phase==="action"){const w=Ti(h,null,r);if(w.type==="fillHand"){const g=Mm(h,"opponent");return g.actionRequired?g:d.processEndOfAction(g)}if(w.type==="playCard"){const{newState:g,animationRequests:y}=i.playCard(h,w.cardId,w.laneIndex,w.isFaceUp,"opponent"),m={...g,animationState:{type:"playCard",cardId:w.cardId,owner:"opponent"}};return setTimeout(()=>{const x=()=>{n(S=>{let E={...S},j={newState:E};if(!E.actionRequired){if(E.queuedEffect){const{card:U,laneIndex:V}=E.queuedEffect,R={cardOwner:"opponent",actor:"opponent",currentTurn:E.turn,opponent:"player",triggerType:"play"};j=cl(U,V,E,R),j.newState.queuedEffect=void 0}}const b=j.animationRequests,k=j.newState,N=()=>{n(U=>{if(U.queuedActions&&U.queuedActions.length>0){const V=d.processEndOfAction(U);return V.actionRequired&&In(V,n,r,i,s,d),V}return U.actionRequired?(In(U,n,r,i,s,d),U):d.processEndOfAction(U)})};if(b&&b.length>0)return s(b,N),k;if(k.queuedActions&&k.queuedActions.length>0){const U=d.processEndOfAction(k);return U.actionRequired&&In(U,n,r,i,s,d),U}return k.actionRequired?(In(k,n,r,i,s,d),k):d.processEndOfAction(k)})};n(S=>{const E={...S,animationState:null};return y&&y.length>0?s(y,x):x(),E})},500),m}}return h.phase==="end"||h.phase==="hand_limit"?d.continueTurnProgression(h):d.processEndOfAction(h)})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function xx(t,n){let r=null,i=null;const s=["player","opponent"];for(const w of s){for(const g of t[w].lanes){const y=g.find(m=>m.id===n);if(y){r=w,i=y;break}}if(r)break}if(!r||!i)return console.error("Card to delete not found on board:",n),t;const d={...t},u={...d[r]};u.lanes=u.lanes.map(w=>w.filter(g=>g.id!==n));const{id:p,isFaceUp:f,...h}=i;return u.discard=[...u.discard,h],d[r]=u,d}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Cx=(t,n,r,i,s,d="player",u)=>{const[p,f]=se.useState(()=>{const ie=Zl(t,n,s,d);return Ae(ie)}),[h,w]=se.useState(null),g=se.useRef(!1),y=se.useRef(0);se.useEffect(()=>{p.turn!==d&&p.log.length<=4&&f(ie=>{const K=d==="player"?"Player":"Opponent",z=[...ie.log];return z.length>0&&(z[z.length-1]={player:"player",message:`${K} goes first.`}),{...ie,turn:d,log:z}})},[d,p.turn,p.log.length]);const m=se.useCallback(ie=>{switch(ie){case"start":return $m;case"end":return nl;default:return rl}},[]),x=se.useCallback((ie,K)=>{const z=le=>{if(le.length===0){K();return}const[ne,...ue]=le;ne.type==="delete"?(f(ce=>({...ce,animationState:{type:"deleteCard",cardId:ne.cardId,owner:ne.owner}})),setTimeout(()=>{f(ce=>{if(!(ce.player.lanes.flat().some(be=>be.id===ne.cardId)||ce.opponent.lanes.flat().some(be=>be.id===ne.cardId)))return{...ce,animationState:null};let De=xx(ce,ne.cardId);return De=Ae(De),{...De,animationState:null}}),setTimeout(()=>{ue.length>0?z(ue):K()},10)},500)):ne.type==="return"?(f(ce=>({...ce,animationState:{type:"returnCard",cardId:ne.cardId,owner:ne.owner}})),setTimeout(()=>{f(ce=>{const Se=ce[ne.owner].lanes.findIndex(Me=>Me.some(He=>He.id===ne.cardId)),De=Se!==-1&&ce[ne.owner].lanes[Se].length>0&&ce[ne.owner].lanes[Se][ce[ne.owner].lanes[Se].length-1].id===ne.cardId,be=ce[ne.owner].lanes.flat().find(Me=>Me.id===ne.cardId);if(!be)return{...ce,animationState:null};const Ge=ce[ne.owner].lanes.map(Me=>Me.filter(He=>He.id!==ne.cardId));let Be={...ce,[ne.owner]:{...ce[ne.owner],lanes:Ge,hand:[...ce[ne.owner].hand,be]}};return Be=Ae(Be),De&&Se!==-1&&Be[ne.owner].lanes[Se].length>0&&(Be=Xn(Be,ne.owner,Se).newState),{...Be,animationState:null}}),setTimeout(()=>{ue.length>0?z(ue):K()},10)},500)):ne.type==="play"?(f(ce=>({...ce,animationState:{type:"playCard",cardId:ne.cardId,owner:ne.owner}})),setTimeout(()=>{f(ce=>({...ce,animationState:null})),setTimeout(()=>{ue.length>0?z(ue):K()},10)},500)):ne.type==="draw"?(f(ce=>({...ce,animationState:{type:"draw",player:ne.player,count:ne.count}})),setTimeout(()=>{f(ce=>({...ce,animationState:null})),setTimeout(()=>{ue.length>0?z(ue):K()},10)},500)):setTimeout(()=>{ue.length>0?z(ue):K()},10)};z(ie)},[]),S=(ie,K,z="player")=>{if(!h||p.turn!=="player"||p.phase!=="action")return;const le=h;w(null),f(ne=>{const ue=m(ne.phase),{newState:ce,animationRequests:Se}=Si(ne,le,ie,K,"player",z),De={...ce,animationState:{type:"playCard",cardId:le,owner:"player"}};return setTimeout(()=>{f(be=>{let Ge={...be,animationState:null};return Se&&Se.length>0?(x(Se,()=>{f(Be=>ue(Be))}),Ge):Ge.actionRequired?Ge:ue(Ge)})},500),De})},E=()=>{p.turn!=="player"||p.phase!=="action"||p.actionRequired||f(ie=>{const K=m(ie.phase),z=Mm(ie,"player");return z.actionRequired?z:K(z)})},j=se.useCallback(ie=>{f(K=>{var z;return((z=K.actionRequired)==null?void 0:z.type)!=="discard"||K.actionRequired.actor!=="player"?K:{...K,animationState:{type:"discardCard",owner:"player",cardIds:[ie],originalAction:K.actionRequired}}})},[]),b=se.useCallback(ie=>{f(K=>{if(K.winner||K.phase!=="compile")return K;const z=m(K.phase),ne={...Hm(K),animationState:{type:"compile",laneIndex:ie},compilableLanes:[]};return setTimeout(()=>{f(ue=>{var be;const ce=ts(ue,ie,r);if(ce.winner)return ce;if(((be=ce.actionRequired)==null?void 0:be.type)==="prompt_use_control_mechanic")return{...ce,animationState:null};const Se=ce._compileAnimations;if(Se&&Se.length>0){x(Se,()=>{f(Be=>{const Me={...Be};return delete Me._compileAnimations,{...z(Me),animationState:null}})});const Ge={...ce};return delete Ge._compileAnimations,Ge}return{...z(ce),animationState:null}})},1e3),ne})},[r,m]),k=ie=>{f(K=>{const z=K.turn,le=m(K.phase),{nextState:ne,requiresAnimation:ue,requiresTurnEnd:ce}=Wd(K,ie);return ue?(x(ue.animationRequests,()=>{f(Se=>{const De=Se.turn!==z?be=>be:le;return ue.onCompleteCallback(Se,De)})}),ne):ne.actionRequired?ne:le(ne)})},N=ie=>{f(K=>{const z=m(K.phase),{nextState:le,requiresAnimation:ne}=Qd(K,ie);return ne?(x(ne.animationRequests,()=>{f(ue=>ne.onCompleteCallback(ue,z))}),le):le.actionRequired?le:z(le)})},U=ie=>{f(K=>{const z=m(K.phase),le=Hd(K,ie);return le.actionRequired?le:z(le)})},V=ie=>{f(K=>ex(K,ie))},R=()=>{f(ie=>{var le,ne;const K=m(ie.phase);let z={...ie,animationState:null};return((le=z.actionRequired)==null?void 0:le.type)==="prompt_shift_or_flip_board_card_custom"?z=Kd(z,"skip"):z=mm(z),((ne=z.actionRequired)==null?void 0:ne.type)==="plague_4_player_flip_optional"?z:K(z)})},O=se.useCallback(ie=>{f(K=>{var ne;if(((ne=K.actionRequired)==null?void 0:ne.type)!=="prompt_use_control_mechanic")return K;const{originalAction:z,actor:le}=K.actionRequired;if(ie==="skip"){let ue=te(K,le,"Player skips rearranging protocols.");if(ue.actionRequired=null,ue={...ue,_logIndentLevel:0},z.type==="compile"){const Se={...ue,animationState:{type:"compile",laneIndex:z.laneIndex},compilableLanes:[]};return setTimeout(()=>{f(De=>{const be=ts(De,z.laneIndex,r);return be.winner?be:{...m(be.phase)(be),animationState:null}})},1e3),Se}else if(z.type==="continue_turn"){let ce={...ue};return z.queuedSpeed2Actions&&z.queuedSpeed2Actions.length>0&&(ce.queuedActions=[...z.queuedSpeed2Actions,...ce.queuedActions||[]]),m(ce.phase)(ce)}else if(z.type==="resume_interrupted_turn"){let ce={...ue};return ce._interruptedTurn=z.interruptedTurn,ce._interruptedPhase=z.interruptedPhase,z.queuedSpeed2Actions&&z.queuedSpeed2Actions.length>0&&(ce.queuedActions=[...z.queuedSpeed2Actions,...ce.queuedActions||[]]),rl(ce)}else{const ce=ls(ue,le);return m(ce.phase)(ce)}}else{const ue=ie;let De=te(K,le,`${le==="player"?"Player":"Opponent"} chooses to rearrange ${ue==="player"?"their own":"the opponent's"} protocols.`);return De.actionRequired={type:"prompt_rearrange_protocols",sourceCardId:"CONTROL_MECHANIC",target:ue,actor:le,originalAction:z},De}})},[r,m]),X=se.useCallback(ie=>{f(K=>{const z=m(K.phase),le=Xd(K,ie);return le.actionRequired?le:z(le)})},[m]),M=se.useCallback(ie=>{f(K=>{var z;return((z=K.actionRequired)==null?void 0:z.type)!=="plague_2_player_discard"?K:{...K,animationState:{type:"discardCard",owner:"player",cardIds:ie,originalAction:K.actionRequired}}})},[]),$=se.useCallback(ie=>{f(K=>{const z=m(K.phase),le=_m(K,ie,"player");return z(le)})},[m]),B=se.useCallback(ie=>{f(K=>{const z=m(K.phase),le=wm(K,ie);return ie?le:z(le)})},[m]),I=se.useCallback(ie=>{f(K=>{const z=m(K.phase),le=Zd(K,ie);return le.actionRequired?le:z(le)})},[m]),D=se.useCallback(ie=>{f(K=>{var ue,ce,Se,De;const z=((ue=K.actionRequired)==null?void 0:ue.type)==="select_cards_from_hand_to_discard_for_fire_4",le=((ce=K.actionRequired)==null?void 0:ce.type)==="discard"&&((Se=K.actionRequired)==null?void 0:Se.variableCount),ne=((De=K.actionRequired)==null?void 0:De.type)==="discard"&&K.actionRequired.count>1;return!z&&!le&&!ne?K:{...K,animationState:{type:"discardCard",owner:"player",cardIds:ie,originalAction:K.actionRequired}}})},[]),L=se.useCallback(ie=>{f(K=>{var z;return((z=K.actionRequired)==null?void 0:z.type)!=="select_cards_from_hand_to_discard_for_hate_1"?K:{...K,animationState:{type:"discardCard",owner:"player",cardIds:ie,originalAction:K.actionRequired}}})},[]),T=se.useCallback(ie=>{f(K=>{const z=m(K.phase),le=Kd(K,ie);return le.actionRequired?le:z(le)})},[m]),q=se.useCallback(ie=>{f(K=>{var ne,ue;u&&((ne=K.actionRequired)==null?void 0:ne.sourceCardId)==="CONTROL_MECHANIC"&&((ue=K.actionRequired)!=null&&ue.actor)&&u(K.actionRequired.actor);const z=m(K.phase),le=Md(K,ie,r);return le.winner?le:z(le)})},[m,r,u]),P=se.useCallback(ie=>{f(K=>{const z=m(K.phase),le=Jd(K,ie);return le.actionRequired?le:z(le)})},[m]),Z=se.useCallback(ie=>{f(K=>{const z=m(K.phase),le=xm(K,ie,r);return le.winner?le:z(le)})},[m,r]),G=se.useCallback(ie=>{f(K=>{const z=m(K.phase),le=Vm(K,ie);return le.winner?le:z(le)})},[m]),A=se.useCallback(()=>{f(ie=>{const K=m(ie.phase),z=zm(ie);return z.winner?z:K(z)})},[m]),W=se.useCallback(ie=>{f(K=>{const z=m(K.phase),le=cu(K,ie);return le.winner?le:z(le)})},[m]),J=se.useCallback(ie=>{f(K=>{const z=m(K.phase),le=du(K,ie);return le.winner?le:z(le)})},[m]),Q=se.useCallback(ie=>{f(K=>{const z=m(K.phase),le=uu(K,ie);return le.winner?le:z(le)})},[m]),ee=se.useCallback(()=>{f(ie=>{const K=m(ie.phase),z=pu(ie);return z.winner?z:K(z)})},[m]),oe=se.useCallback(()=>{f(ie=>fu(ie))},[]),me=se.useCallback(ie=>{f(K=>Bm(K,ie))},[]),ke=se.useCallback(ie=>{f(K=>Gm(K,ie))},[]),xe=se.useCallback(ie=>{g.current=!1,y.current++,f(K=>{if(typeof ie=="function")return ie(K);const z=ie;if(z==="speed-0-interrupt"){const le=["Speed","Life","Water"],ne=["Metal","Death","Hate"];let ue=Yn(so(le)),ce=Yn(so(ne));const Se=(Re,Ie,Ve)=>{const it=Re.findIndex(nt=>nt.protocol===Ie&&nt.value===Ve);return it>-1?Re.splice(it,1)[0]:Wn.find(nt=>nt.protocol===Ie&&nt.value===Ve)},De=Se(ue,"Speed",0),be=Se(ce,"Metal",0),Ge=Se(ue,"Speed",1),Be=Se(ue,"Life",1),Me=Se(ue,"Water",1),He=Se(ue,"Speed",3);let je=Zl(le,ne,s,d);return je.player.lanes=[[],[],[]],je.player.lanes[0]=[{...De,id:st(),isFaceUp:!1}],je.player.hand=[{...Ge,id:st(),isFaceUp:!0},{...Be,id:st(),isFaceUp:!0},{...Me,id:st(),isFaceUp:!0},{...He,id:st(),isFaceUp:!0}],je.player.deck=ue,je.player.discard=[],je.opponent.lanes=[[],[],[]],je.opponent.hand=[{...be,id:st(),isFaceUp:!0}],je.opponent.deck=ce,je.opponent.discard=[],je.turn="opponent",je.phase="start",je.actionRequired=null,je.queuedActions=[],je=Ae(je),je=te(je,"player","DEBUG: Dynamic Speed-0 interrupt scenario set up. AI will play Metal-0."),je}else if(z==="speed-1-trigger"){const le=["Speed","Life","Water"],ne=["Metal","Death","Hate"];let ue=Yn(so(le));const ce=Yn(so(ne)),De=((Me,He,je)=>{const Re=Me.findIndex(Ie=>Ie.protocol===He&&Ie.value===je);return Re>-1?Me.splice(Re,1)[0]:Wn.find(Ie=>Ie.protocol===He&&Ie.value===je)})(ue,"Speed",1);let be=Zl(le,ne,s,d);be.player.lanes=[[],[],[]],be.player.lanes[0]=[{...De,id:st(),isFaceUp:!0}];const{drawnCards:Ge,remainingDeck:Be}=Qn(ue,[],6);return be.player.hand=Ge.map(Me=>({...Me,id:st(),isFaceUp:!0})),be.player.deck=Be,be.player.discard=[],be.opponent.lanes=[[],[],[]],be.opponent.hand=[],be.opponent.deck=ce,be.opponent.discard=[],be.turn="player",be.phase="hand_limit",be.actionRequired={type:"discard",actor:"player",count:1},be.queuedActions=[],be=Ae(be),be=te(be,"player","DEBUG: Speed-1 discard trigger scenario set up."),be}else if(z==="fire-oncover-test"){const le=["Death","Hate","Water"],ne=["Fire","Plague","Metal"],ue=Yn(so(le));let ce=Yn(so(ne));const Se=(Re,Ie,Ve)=>{const it=Re.findIndex(nt=>nt.protocol===Ie&&nt.value===Ve);return it>-1?Re.splice(it,1)[0]:Wn.find(nt=>nt.protocol===Ie&&nt.value===Ve)},De=Se(ce,"Fire",0),be=Se(ce,"Fire",2),Ge=Se(ce,"Fire",3),Be=Wn.find(Re=>Re.protocol==="Death"&&Re.value===1),Me=Wn.find(Re=>Re.protocol==="Hate"&&Re.value===2),He=Wn.find(Re=>Re.protocol==="Water"&&Re.value===3);let je=Zl(le,ne,s,"opponent");return je.player.lanes=[[{...Be,id:st(),isFaceUp:!0}],[{...Me,id:st(),isFaceUp:!0}],[{...He,id:st(),isFaceUp:!0}]],je.player.hand=[],je.player.deck=ue,je.player.discard=[],je.opponent.lanes=[[{...De,id:st(),isFaceUp:!0}],[],[]],je.opponent.hand=[{...Ge,id:st(),isFaceUp:!0},{...be,id:st(),isFaceUp:!0}],je.opponent.deck=ce,je.opponent.discard=[],je.turn="opponent",je.phase="action",je.actionRequired=null,je.queuedActions=[],je=Ae(je),je=te(je,"opponent","DEBUG: Fire On-Cover test scenario. Opponent has Fire-0 in play, Fire-3 and Fire-2 in hand. Ready to play Fire-3."),je}else if(z==="speed-2-control-test"){const le=["Speed","Light","Water"],ne=["Fire","Plague","Metal"],ue=Yn(so(le)),ce=Yn(so(ne)),De=((Ge,Be,Me)=>{const He=Ge.findIndex(je=>je.protocol===Be&&je.value===Me);return He>-1?Ge.splice(He,1)[0]:Wn.find(je=>je.protocol===Be&&je.value===Me)})(ue,"Speed",2);let be=Zl(le,ne,!0,"player");return be.player.lanes=[[{...De,id:st(),isFaceUp:!0}],[],[]],be.player.protocols[0]="Speed",be.player.laneValues[0]=10,be.player.hand=[],be.player.deck=ue,be.player.discard=[],be.controlCardHolder="player",be.opponent.lanes=[[],[],[]],be.opponent.hand=[],be.opponent.deck=ce,be.opponent.discard=[],be.turn="player",be.phase="compile",be.compilableLanes=[0],be.actionRequired=null,be.queuedActions=[],be=Ae(be),be=te(be,"player","DEBUG: Speed-2 + Control test scenario. Player has Speed-2 (value 10), Control Component active. Ready to compile Protocol Speed!"),be}return K})},[s]);return se.useEffect(()=>{const ie=p.animationState;if(!ie)return;let K=0,z=!1;if(ie.type==="flipCard"?(K=600,z=!0):ie.type==="drawCard"?(K=1e3,z=!0):ie.type==="discardCard"&&(K=800,z=!0),z){const le=setTimeout(()=>{f(ne=>({...ne,animationState:null}))},K);return()=>clearTimeout(le)}},[p.animationState]),se.useEffect(()=>{const ie=p.animationState;if((ie==null?void 0:ie.type)==="discardCard"&&ie.owner==="player"){const K=setTimeout(()=>{f(z=>{const le=z.animationState;if((le==null?void 0:le.type)!=="discardCard"||!le.originalAction)return z;const{cardIds:ne,originalAction:ue}=le,ce=m(z.phase);let Se;return ue.type==="plague_2_player_discard"?Se=Jw(z,ne):ue.type==="select_cards_from_hand_to_discard_for_fire_4"?Se=Ud(z,ne):ue.type==="select_cards_from_hand_to_discard_for_hate_1"?Se=Od(z,ne):ue.type==="discard"&&(ue.count>1||ue.variableCount)?Se=Ud(z,ne):Se=hr(z,ne,"player"),Se.animationState=null,Se.actionRequired?Se:ce(Se)})},500);return()=>clearTimeout(K)}},[p.animationState,m]),se.useEffect(()=>{if(p.turn==="opponent"&&!p.winner&&!p.animationState&&!p._interruptedTurn&&!g.current){g.current=!0;const ie=y.current,K=p,z=setTimeout(()=>{y.current===ie&&In(K,f,i,{compileLane:(le,ne)=>ts(le,ne,r),playCard:Si,fillHand:ls,discardCards:hr,flipCard:gm,deleteCard:(le,ne)=>({newState:le,animationRequests:[{type:"delete",cardId:ne,owner:"opponent"}]}),returnCard:vm,skipAction:mm,resolveOptionalDrawPrompt:Xd,resolvePlague4Flip:(le,ne)=>_m(le,ne,"opponent"),resolvePlague2Discard:Pd,resolvePlague2OpponentDiscard:Pd,resolveOptionalDiscardCustomPrompt:wm,resolveOptionalEffectPrompt:Zd,resolveFire4Discard:Ud,resolveHate1Discard:Od,resolveRearrangeProtocols:(le,ne)=>Md(le,ne,r),resolveActionWithHandCard:Hd,resolveSwapProtocols:(le,ne)=>xm(le,ne,r),revealOpponentHand:ym,resolveCustomChoice:Jd},x,im,u)},1500);return()=>{clearTimeout(z),g.current=!1}}},[p.turn,p.phase,p.winner,p.animationState,p._interruptedTurn,i,r,x,p.actionRequired]),se.useEffect(()=>{const ie=p.actionRequired,K=p.turn==="player"||p._interruptedTurn==="player",z=ie&&"actor"in ie&&ie.actor==="opponent";K&&!p.animationState&&z&&!g.current&&(g.current=!0,_x(p,f,i,{playCard:Si,discardCards:hr,flipCard:gm,returnCard:vm,deleteCard:(ne,ue)=>({newState:ne,animationRequests:[{type:"delete",cardId:ue,owner:"opponent"}]}),resolveActionWithHandCard:Hd,resolveHate1Discard:Od,resolvePlague2OpponentDiscard:Pd,revealOpponentHand:ym,resolveRearrangeProtocols:(ne,ue)=>Md(ne,ue,r)},im,x,Wd,Qd,u),g.current=!1)},[p.actionRequired,p.turn,p.animationState,i,x,r]),se.useEffect(()=>{f(ie=>{let K=Ae(ie);return K.turn==="player"&&K.phase==="start"&&!K.actionRequired?qm(K):K})},[p.turn,p.phase]),{gameState:p,selectedCard:h,setSelectedCard:w,playSelectedCard:S,fillHand:E,discardCardFromHand:j,compileLane:b,resolveActionWithCard:k,resolveActionWithLane:N,selectHandCardForAction:V,skipAction:R,resolvePlague2Discard:M,resolveActionWithHandCard:U,resolvePlague4Flip:$,resolveOptionalDiscardCustomPrompt:B,resolveOptionalEffectPrompt:I,resolveFire4Discard:D,resolveHate1Discard:L,resolveRevealBoardCardPrompt:T,resolveRearrangeProtocols:q,resolveOptionalDrawPrompt:X,resolveSwapProtocols:Z,resolveControlMechanicPrompt:O,resolveCustomChoice:P,resolveSelectRevealedDeckCard:G,resolveRevealDeckDrawProtocol:A,resolveStateNumber:W,resolveStateProtocol:J,resolveSelectFromDrawnToReveal:Q,resolveConfirmDeckDiscard:ee,resolveConfirmDeckPlayPreview:oe,resolveSelectTrashCardToPlay:me,resolveSelectTrashCardToReveal:ke,setupTestScenario:xe}},jm=({cards:t,isPlayable:n,isCompilable:r,isShiftTarget:i,isEffectTarget:s,isMatching:d,onLanePointerDown:u,onPlayFaceDown:p,onCardPointerDown:f,onCardPointerEnter:h,onCardPointerLeave:w,owner:g,animationState:y,isCardTargetable:m,laneIndex:x,sourceCardId:S,gameState:E})=>{const j=["lane"];return n&&j.push("playable"),d&&j.push("matching-protocol"),r&&j.push("compilable"),i&&j.push("shift-target"),s&&j.push("effect-target"),o.jsxs("div",{className:j.join(" "),onPointerDown:u,children:[n&&d&&g==="player"&&p&&o.jsx("button",{className:"btn btn-play-facedown",onPointerDown:b=>{b.stopPropagation(),p()},children:"Play Face-Down"}),o.jsx("div",{className:"lane-stack",children:t.map((b,k)=>{var V;const N=((V=E.actionRequired)==null?void 0:V.type)==="prompt_shift_or_flip_for_light_2"&&E.actionRequired.revealedCardId===b.id,U=fn(b,t,E,x,g);return o.jsx(xt,{card:b,isFaceUp:b.isFaceUp||N,style:{"--i":k},onPointerDown:R=>{R.stopPropagation(),f(b)},onPointerEnter:()=>h(b),animationState:y,isTargetable:m(b),isSourceOfEffect:b.id===S,faceDownValue:U},b.id)})})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Lo=(t,n)=>Ho(t,n),ua=(t,n)=>bn(t).some(({rule:i,laneIndex:s})=>i.type==="block_shifts_from_and_to_lane"&&s===n),Ni=(t,n)=>{const{actionRequired:r}=n;if(!r||"actor"in r&&r.actor!=="player")return!1;let i=null,s=-1,d=[];for(const f of["player","opponent"]){for(let h=0;h<n[f].lanes.length;h++)if(n[f].lanes[h].some(w=>w.id===t.id)){i=f,s=h,d=n[f].lanes[h];break}if(i)break}if(!i)return!1;const u=d.findIndex(f=>f.id===t.id),p=Vo(n,d,u);if(r.type==="select_lane_for_shift"){const f=r.cardToShiftId;return!!(f&&t.id===f)}if(r.type==="shift_flipped_card_optional"){const f=r.cardId;return!!(f&&t.id===f)}switch(r.type){case"select_opponent_face_up_card_to_flip":return i==="opponent"&&t.isFaceUp&&p;case"select_card_to_flip":{if(Lo(n,t.id))return!1;const f=r.targetFilter||{},h=d.findIndex(E=>E.id===t.id),w=r.currentLaneIndex,g=r.laneIndex,y=r.scope,m=r.restrictedLaneIndex;if(w!==void 0&&s!==w||y==="this_lane"&&g!==void 0&&s!==g||m!==void 0&&s!==m)return!1;const x=f.position||"uncovered";if(x==="uncovered"&&!p||x==="covered"&&h>=d.length-1||f.owner==="own"&&i!==r.actor||f.owner==="opponent"&&i===r.actor||f.faceState==="face_up"&&!t.isFaceUp||f.faceState==="face_down"&&t.isFaceUp||f.excludeSelf&&t.id===r.sourceCardId||!es(n,t.id).allowed)return!1;if(f.valueMinGreaterThanHandSize){const E=n[r.actor].hand.length;if(t.value<=E)return!1}if(f.valueLessThanUniqueProtocolsOnField){const E=os(n);if(t.value>=E)return!1}return!0}case"select_own_face_up_covered_card_to_flip":{const f=d.findIndex(h=>h.id===t.id);return i==="player"&&t.isFaceUp&&f<d.length-1}case"select_opponent_covered_card_to_shift":{const f=d.findIndex(w=>w.id===t.id),h=n.turn==="player"?"opponent":"player";return ua(n,s)?!1:i===h&&f<d.length-1}case"select_own_covered_card_to_shift":{const f=d.findIndex(h=>h.id===t.id);return ua(n,s)?!1:i===r.actor&&f<d.length-1}case"select_covered_card_in_line_to_flip_optional":{const h=d.findIndex(g=>g.id===t.id)<d.length-1;return Pa(n)&&!t.isFaceUp?!1:s===r.laneIndex&&h}case"select_covered_card_to_flip_for_chaos_0":{const h=d.findIndex(g=>g.id===t.id)<d.length-1;return Pa(n)&&!t.isFaceUp?!1:s===r.laneIndex&&h}case"shift_flipped_card_optional":return ua(n,s)?!1:t.id===r.cardId;case"select_opponent_card_to_flip":return Pa(n)&&!t.isFaceUp?!1:i==="opponent"&&p;case"select_face_down_card_to_shift_for_darkness_4":return ua(n,s)?!1:!t.isFaceUp&&p;case"select_cards_to_delete":{if(Lo(n,t.id)||r.disallowedIds.includes(t.id))return!1;const f=r.allowedIds;if(f&&!f.includes(t.id))return!1;const h=r.currentLaneIndex;if(h!==void 0&&s!==h)return!1;const w=r.targetFilter;if(w){const g=d.findIndex(j=>j.id===t.id),y=w.position||"uncovered";if(y==="uncovered"&&!p||y==="covered"&&g>=d.length-1||w.faceState==="face_up"&&!t.isFaceUp||w.faceState==="face_down"&&t.isFaceUp)return!1;if(w.valueRange){const{min:j,max:b}=w.valueRange;if(t.value<j||t.value>b)return!1}const m=r.actorChooses,x=r.sourceCardId;let S=null;for(const j of["player","opponent"])if(n[j].lanes.flat().some(b=>b.id===x)){S=j;break}if(m==="card_owner"&&S){if(w.owner==="own"&&i!==S||w.owner==="opponent"&&i===S)return!1}else if(w.owner==="own"&&i!==r.actor||w.owner==="opponent"&&i===r.actor)return!1;const E=r.protocolMatching;if(E){const j=n.player.protocols[s],b=n.opponent.protocols[s],k=t.protocol,N=k===j||k===b;if(E==="must_match"&&!N||E==="must_not_match"&&N)return!1}return!0}return p}case"select_face_down_card_to_delete":return!t.isFaceUp&&p;case"select_low_value_card_to_delete":return t.isFaceUp&&(t.value===0||t.value===1)&&p;case"select_card_from_other_lanes_to_delete":{if(Lo(n,t.id))return!1;const{disallowedLaneIndex:f,lanesSelected:h}=r;return s!==f&&!h.includes(s)&&p}case"plague_4_opponent_delete":return(n.turn==="player"?"opponent":"player")==="player"?i==="player"&&!t.isFaceUp&&p:!1;case"select_any_other_card_to_flip":return Pa(n)&&!t.isFaceUp?!1:t.id!==r.sourceCardId&&p;case"select_card_to_return":{if(Lo(n,t.id))return!1;const f=r.targetOwner||"any",h=r.targetFilter,w=r.actor,g=(h==null?void 0:h.position)||"uncovered",m=d.findIndex(S=>S.id===t.id)<d.length-1;if(g==="uncovered"&&!p||g==="covered"&&!m)return!1;const x=h==null?void 0:h.faceState;return x==="face_up"&&!t.isFaceUp||x==="face_down"&&t.isFaceUp?!1:f==="own"?i===w:f==="opponent"?i!==w:!0}case"select_card_to_shift_for_gravity_1":return Lo(n,t.id)||ua(n,s)?!1:p;case"select_face_down_card_to_shift_for_gravity_4":return ua(n,s)?!1:!t.isFaceUp&&s!==r.targetLaneIndex&&p;case"select_any_card_to_flip":case"select_any_card_to_flip_optional":return Pa(n)&&!t.isFaceUp||!es(n,t.id).allowed?!1:p;case"select_any_face_down_card_to_flip_optional":return es(n,t.id).allowed?!t.isFaceUp&&p:!1;case"select_board_card_to_reveal_custom":{const f=r.targetFilter;if(!f)return!t.isFaceUp&&p;const h=d.findIndex(g=>g.id===t.id),w=f.position||"uncovered";return!(w==="uncovered"&&!p||w==="covered"&&h>=d.length-1||f.owner==="own"&&i!==r.actor||f.owner==="opponent"&&i===r.actor||f.faceState==="face_up"&&!t.isFaceUp||f.faceState==="face_down"&&t.isFaceUp)}case"select_own_other_card_to_shift":return ua(n,s)?!1:i===r.actor&&t.id!==r.sourceCardId&&p;case"select_opponent_face_down_card_to_shift":return ua(n,s)?!1:i!==r.actor&&!t.isFaceUp&&p;case"select_any_opponent_card_to_shift":return ua(n,s)?!1:i!==r.actor&&p;case"select_opponent_card_to_return":return i==="opponent"&&p;case"select_card_to_shift_for_anarchy_1":return Lo(n,t.id)||ua(n,s)?!1:p;case"select_card_to_shift_for_anarchy_0":return Lo(n,t.id)||ua(n,s)?!1:p;case"select_card_to_shift":{if(Lo(n,t.id)||ua(n,s))return!1;const f=r.targetFilter||{},h=r.destinationRestriction,w=r.scope,g=r.sourceLaneIndex;if(w==="this_lane"&&g!==void 0&&s!==g||(h==null?void 0:h.type)==="non_matching_protocol"&&!t.isFaceUp)return!1;const y=f.position||"uncovered",x=d.findIndex(S=>S.id===t.id)<d.length-1;return!(y==="uncovered"&&!p||y==="covered"&&!x||f.owner==="own"&&i!==r.actor||f.owner==="opponent"&&i===r.actor||f.faceState==="face_up"&&!t.isFaceUp||f.faceState==="face_down"&&t.isFaceUp||f.excludeSelf&&t.id===r.sourceCardId)}case"select_phase_effect":return r.availableEffects.some(h=>h.cardId===t.id);case"select_card_for_copy_middle":return(r.validTargetIds||[]).includes(t.id);default:return!1}},Sx=({gameState:t,onLanePointerDown:n,onPlayFaceDown:r,onCardPointerDown:i,onCardPointerEnter:s,onCardPointerLeave:d,onOpponentHandCardPointerEnter:u,onOpponentHandCardPointerLeave:p,selectedCardId:f,sourceCardId:h})=>{const{player:w,opponent:g,animationState:y,phase:m,turn:x,compilableLanes:S,actionRequired:E,controlCardHolder:j}=t,b=M=>{var xe,ie,K,z,le,ne;const $=m==="compile"&&x==="player"&&!E&&S.includes(M),B=x==="player",I=m==="action"&&!E&&f,D=(E==null?void 0:E.type)==="select_lane_for_play";if(!(D?(E==null?void 0:E.actor)==="player":B)||!I&&!D)return{isPlayable:!1,isMatching:!1,isCompilable:$};let T;if(I)T=w.hand.find(ue=>ue.id===f);else if(D){if(E.disallowedLaneIndex!==void 0&&M===E.disallowedLaneIndex)return{isPlayable:!1,isMatching:!1,isCompilable:$};const ue=E.validLanes;if(ue&&!ue.includes(M))return{isPlayable:!1,isMatching:!1,isCompilable:$};if(E.source==="deck")return E.excludeCurrentLane&&M===E.currentLaneIndex?{isPlayable:!1,isMatching:!1,isCompilable:$}:{isPlayable:!0,isMatching:!1,isCompilable:$};if(E.source==="trash"){const ce=E.useNormalPlayRules,Se=E.preDrawnCard;if(ce&&Se){const De=w.protocols[M],be=g.protocols[M];return{isPlayable:!0,isMatching:Se.protocol===De||Se.protocol===be,isCompilable:$}}return{isPlayable:!0,isMatching:!1,isCompilable:$}}T=w.hand.find(ce=>ce.id===E.cardInHandId)}if(!T)return{isPlayable:!1,isMatching:!1,isCompilable:$};const q=g.lanes[M];if(q.length>0&&q[q.length-1].isFaceUp&&q[q.length-1].protocol==="Plague"&&q[q.length-1].value===0)return{isPlayable:!1,isMatching:!1,isCompilable:$};const Z=g.lanes.flat().some(ue=>ue.isFaceUp&&ue.protocol==="Psychic"&&ue.value===1),G=w.lanes.flat().some(ue=>ue.isFaceUp&&ue.protocol==="Spirit"&&ue.value===1),A=((ie=(xe=T.customEffects)==null?void 0:xe.bottomEffects)==null?void 0:ie.some(ue=>{var ce,Se;return((ce=ue.params)==null?void 0:ce.action)==="card_property"&&((Se=ue.params)==null?void 0:Se.property)==="ignore_protocol_matching"}))||((z=(K=T.customEffects)==null?void 0:K.topEffects)==null?void 0:z.some(ue=>{var ce,Se;return((ce=ue.params)==null?void 0:ce.action)==="card_property"&&((Se=ue.params)==null?void 0:Se.property)==="ignore_protocol_matching"}))||((ne=(le=T.customEffects)==null?void 0:le.middleEffects)==null?void 0:ne.some(ue=>{var ce,Se;return((ce=ue.params)==null?void 0:ce.action)==="card_property"&&((Se=ue.params)==null?void 0:Se.property)==="ignore_protocol_matching"})),W=[...w.lanes.flat(),...g.lanes.flat()].some(ue=>ue.isFaceUp&&ue.protocol==="Anarchy"&&ue.value===1),J=ou(t),Q=Ri(t,"player",M),ee=ns(t,T),oe=il(t,"player",M,T.protocol);let me;return ee?me=!Z:W||J?me=T.protocol!==w.protocols[M]&&T.protocol!==g.protocols[M]&&!Z:me=(G||Q||A||oe||T.protocol===w.protocols[M]||T.protocol===g.protocols[M])&&!Z,q.some(ue=>ue.isFaceUp&&ue.protocol==="Metal"&&ue.value===2)&&!me?{isPlayable:!1,isMatching:!1,isCompilable:$}:D&&(E.isFaceDown||E.faceDown)?{isPlayable:!0,isMatching:!1,isCompilable:$}:{isPlayable:!0,isMatching:me,isCompilable:$}},k=M=>{if(!(x==="player")||!(m==="action"&&!E&&f))return{isPlayable:!1,isMatching:!1};const I=w.hand.find(T=>T.id===f);if(!I)return{isPlayable:!1,isMatching:!1};if(!ns(t,I))return{isPlayable:!1,isMatching:!1};const D=w.lanes[M];return D.length>0&&D[D.length-1].isFaceUp&&D[D.length-1].protocol==="Plague"&&D[D.length-1].value===0?{isPlayable:!1,isMatching:!1}:{isPlayable:!0,isMatching:!0}},N=M=>{if(!E||E.actor!=="player")return!1;switch(E.type){case"select_lane_for_delete":{const $=E.validLanes;return!($&&!$.includes(M))}case"select_lane_for_death_2":case"select_lane_for_water_3":case"select_lane_for_return":return!0;case"select_lane_for_metal_3_delete":return M===E.disallowedLaneIndex?!1:w.lanes[M].length+g.lanes[M].length>=8;case"select_lane_for_delete_all":return(E.validLanes||[]).includes(M);case"select_lanes_for_swap_stacks":return(E.validLanes||[]).includes(M);default:return!1}},U=(M,$)=>{if(!E||E.actor!=="player")return!1;const B=E.type==="select_lane_for_shift"?E.originalLaneIndex:(E.type==="select_card_to_shift",-1);if(B!==-1&&!as(t,B,M).allowed)return!1;switch(E.type){case"select_lane_for_shift":{if($!==E.cardOwner||M===E.originalLaneIndex)return!1;const I=E.validLanes;if(I&&!I.includes(M))return!1;const D=[...t.player.lanes.flat(),...t.opponent.lanes.flat()].find(T=>T.id===E.sourceCardId),L=E.destinationRestriction;if(L&&L.type==="to_or_from_this_lane"){let T=L.laneIndex;if(L.laneIndex==="current"&&D)for(const q of["player","opponent"]){for(let P=0;P<t[q].lanes.length;P++)if(t[q].lanes[P].some(Z=>Z.id===E.sourceCardId)){T=P;break}if(typeof T=="number")break}if(typeof T=="number"&&!(E.originalLaneIndex===T)&&!(M===T))return!1}else if(D&&D.protocol==="Gravity"&&D.value===1){let T=-1;for(const q of["player","opponent"]){for(let P=0;P<t[q].lanes.length;P++)if(t[q].lanes[P].some(Z=>Z.id===E.sourceCardId)){T=P;break}if(T!==-1)break}if(T!==-1&&!(E.originalLaneIndex===T)&&!(M===T))return!1}return!0}case"shift_flipped_card_optional":{const I=E.cardId;let D=null,L=-1;for(let T=0;T<w.lanes.length;T++)if(w.lanes[T].some(q=>q.id===I)){D="player",L=T;break}if(D===null){for(let T=0;T<g.lanes.length;T++)if(g.lanes[T].some(q=>q.id===I)){D="opponent",L=T;break}}return $!==D?!1:M!==L}case"select_lane_for_life_3_play":return $==="player"&&M!==E.disallowedLaneIndex;case"select_lane_to_shift_revealed_card_for_light_2":return $==="player";case"select_lane_to_shift_revealed_board_card_custom":{const I=E.revealedCardId;if(![...t.player.lanes.flat(),...t.opponent.lanes.flat()].find(q=>q.id===I))return!1;let L=null,T=-1;for(const q of["player","opponent"]){for(let P=0;P<t[q].lanes.length;P++)if(t[q].lanes[P].some(Z=>Z.id===I)){L=q,T=P;break}if(L)break}return $===L&&M!==T}case"select_lane_for_shift_all":{const I=E.sourceLaneIndex;return M!==I}case"select_lane_to_shift_cards_for_light_3":return M!==E.sourceLaneIndex;default:return!1}},V=(M,$,B)=>{let I=[M];return $&&I.push("compiled"),(y==null?void 0:y.type)==="compile"&&y.laneIndex===B&&I.push("is-compiling"),I.join(" ")},R=()=>j==="player"?"player-controlled":j==="opponent"?"opponent-controlled":"neutral",O=()=>j==="player"?"Player has control.":j==="opponent"?"Opponent has control.":"Control is neutral.",X=()=>j==="player"?"Control Player":j==="opponent"?"Control Opponent":"Control Neutral";return o.jsxs("div",{className:"game-board",children:[o.jsx("div",{className:"opponent-hand-area",children:g.hand.map(M=>o.jsx(xt,{card:M,isFaceUp:M.isRevealed||!1,additionalClassName:"in-hand",onPointerEnter:()=>u(M)},M.id))}),o.jsx("div",{className:`player-side opponent-side ${x==="opponent"?"active-turn":""}`,children:o.jsx("div",{className:"lanes",children:g.lanes.map((M,$)=>{const{isPlayable:B,isMatching:I}=k($);return o.jsx(jm,{cards:M,isPlayable:B,isMatching:I,isCompilable:!1,isShiftTarget:U($,"opponent"),isEffectTarget:N($),onLanePointerDown:()=>n($,"opponent"),onCardPointerDown:D=>i(D,"opponent",$),onCardPointerEnter:D=>s(D,"opponent"),onCardPointerLeave:()=>d(),owner:"opponent",animationState:y,isCardTargetable:D=>Ni(D,t),laneIndex:$,sourceCardId:h,gameState:t},`opp-lane-${$}`)})})}),o.jsxs("div",{className:"protocol-bars-container",children:[t.useControlMechanic&&o.jsxs("div",{className:"control-coin-container",children:[o.jsx("div",{className:`control-coin ${R()}`,title:O(),children:"C"}),o.jsx("div",{className:`control-coin-label ${R()}`,children:X()})]}),o.jsx("div",{className:`protocol-bar opponent-bar ${x==="opponent"?"active-turn":""}`,children:g.protocols.map((M,$)=>o.jsxs("div",{className:V("protocol-display",g.compiled[$],$),children:[o.jsx("span",{className:"protocol-name",children:M}),o.jsx("span",{className:"protocol-value",children:g.laneValues[$]})]},`opp-proto-${M}-${$}`))}),o.jsx("div",{className:`protocol-bar player-bar ${x==="player"?"active-turn":""}`,children:w.protocols.map((M,$)=>o.jsxs("div",{className:V("protocol-display",w.compiled[$],$),children:[o.jsx("span",{className:"protocol-name",children:M}),o.jsx("span",{className:"protocol-value",children:w.laneValues[$]})]},`player-proto-${M}-${$}`))})]}),o.jsx("div",{className:`player-side ${x==="player"?"active-turn":""}`,children:o.jsx("div",{className:"lanes",children:w.lanes.map((M,$)=>{const{isPlayable:B,isMatching:I,isCompilable:D}=b($);return o.jsx(jm,{cards:M,isPlayable:B,isMatching:I,isCompilable:D,isShiftTarget:U($,"player"),isEffectTarget:N($),onLanePointerDown:()=>n($,"player"),onPlayFaceDown:()=>r($),onCardPointerDown:L=>i(L,"player",$),onCardPointerEnter:L=>s(L,"player"),onCardPointerLeave:()=>d(),owner:"player",animationState:y,isCardTargetable:L=>Ni(L,t),laneIndex:$,sourceCardId:h,gameState:t},`player-lane-${$}`)})})})]})},bx=({gameState:t,onFillHand:n,onSkipAction:r,onResolvePlague2Discard:i,onResolvePlague4Flip:s,onResolveFire3Prompt:d,onResolveOptionalDiscardCustomPrompt:u,onResolveOptionalEffectPrompt:p,onResolveFire4Discard:f,onResolveHate1Discard:h,onResolveRevealBoardCardPrompt:w,onResolveOptionalDrawPrompt:g,onResolveDeath1Prompt:y,onResolveLove1Prompt:m,onResolvePsychic4Prompt:x,onResolveSpirit1Prompt:S,onResolveControlMechanicPrompt:E,onResolveCustomChoice:j,selectedCardId:b,multiSelectedCardIds:k,actionRequiredClass:N})=>{const{phase:U,turn:V,actionRequired:R,player:O,compilableLanes:X}=t,M=q=>{for(const P of["player","opponent"])for(const Z of t[P].lanes){const G=Z.find(A=>A.id===q);if(G)return G}return null},$=R==null?void 0:R.sourceCardId,B=$?M($):null,I=(R==null?void 0:R.actor)||V,D=I.charAt(0).toUpperCase()+I.slice(1),L=()=>{var q,P,Z,G;if(V!=="player"&&(!R||R.actor!=="player"))return o.jsx("button",{className:"btn",disabled:!0,children:"Processing..."});if((R==null?void 0:R.type)==="prompt_use_control_mechanic")return o.jsxs(o.Fragment,{children:[o.jsx("button",{className:"btn",onClick:()=>E("player"),children:"Rearrange Own"}),o.jsx("button",{className:"btn",onClick:()=>E("opponent"),children:"Rearrange Opponent's"}),o.jsx("button",{className:"btn btn-back",onClick:()=>E("skip"),children:"Skip"})]});if((R==null?void 0:R.type)==="prompt_optional_draw")return o.jsxs(o.Fragment,{children:[o.jsx("button",{className:"btn",onClick:()=>g(!0),children:"Draw"}),o.jsx("button",{className:"btn btn-back",onClick:()=>g(!1),children:"Skip"})]});if((R==null?void 0:R.type)==="prompt_death_1_effect")return o.jsxs(o.Fragment,{children:[o.jsx("button",{className:"btn",onClick:()=>y(!0),children:"Draw & Delete"}),o.jsx("button",{className:"btn btn-back",onClick:()=>y(!1),children:"Skip"})]});if((R==null?void 0:R.type)==="prompt_give_card_for_love_1")return o.jsxs(o.Fragment,{children:[o.jsx("button",{className:"btn",onClick:()=>m(!0),children:"Give 1 Card"}),o.jsx("button",{className:"btn btn-back",onClick:()=>m(!1),children:"Skip"})]});if((R==null?void 0:R.type)==="prompt_fire_3_discard")return o.jsxs(o.Fragment,{children:[o.jsx("button",{className:"btn",onClick:()=>d(!0),children:"Discard 1 Card"}),o.jsx("button",{className:"btn btn-back",onClick:()=>d(!1),children:"Skip"})]});if((R==null?void 0:R.type)==="prompt_optional_discard_custom")return o.jsxs(o.Fragment,{children:[o.jsxs("button",{className:"btn",onClick:()=>u(!0),children:["Discard ",R.count," Card(s)"]}),o.jsx("button",{className:"btn btn-back",onClick:()=>u(!1),children:"Skip"})]});if((R==null?void 0:R.type)==="prompt_optional_effect"){const A=((P=(q=R.effectDef)==null?void 0:q.params)==null?void 0:P.action)||"effect",W=(G=(Z=R.effectDef)==null?void 0:Z.params)==null?void 0:G.count,J=W?`${A} ${W}`:A;return o.jsxs(o.Fragment,{children:[o.jsxs("button",{className:"btn",onClick:()=>p(!0),children:["Execute (",J,")"]}),o.jsx("button",{className:"btn btn-back",onClick:()=>p(!1),children:"Skip"})]})}if((R==null?void 0:R.type)==="prompt_spirit_1_start")return o.jsxs(o.Fragment,{children:[o.jsx("button",{className:"btn",onClick:()=>S("discard"),children:"Discard 1"}),o.jsx("button",{className:"btn btn-back",onClick:()=>S("flip"),children:"Flip Card"})]});if((R==null?void 0:R.type)==="custom_choice"){const A=R.options||[];if(A.length===2){const W=A[0].params,J=A[1].params,Q=ee=>ee.action==="discard"?`Discard ${ee.count||1}`:ee.action==="flip"&&ee.flipSelf?"Flip This Card":ee.action==="draw"?`Draw ${ee.count||1}`:ee.action==="delete"&&ee.deleteSelf?"Delete This Card":ee.action==="delete"?`Delete ${ee.count||1}`:ee.action==="return"?`Return ${ee.count||1}`:ee.action==="shift"?"Shift":ee.action||"Option";return o.jsxs(o.Fragment,{children:[o.jsx("button",{className:"btn",onClick:()=>j(0),children:Q(W)}),o.jsx("button",{className:"btn btn-back",onClick:()=>j(1),children:Q(J)})]})}}if((R==null?void 0:R.type)==="prompt_return_for_psychic_4")return o.jsxs(o.Fragment,{children:[o.jsx("button",{className:"btn",onClick:()=>x(!0),children:"Return Card"}),o.jsx("button",{className:"btn btn-back",onClick:()=>x(!1),children:"Skip"})]});if((R==null?void 0:R.type)==="prompt_shift_or_flip_board_card_custom")return o.jsxs(o.Fragment,{children:[o.jsx("button",{className:"btn",onClick:()=>w("shift"),children:"Shift"}),o.jsx("button",{className:"btn",onClick:()=>w("flip"),children:"Flip"}),o.jsx("button",{className:"btn btn-back",onClick:()=>w("skip"),children:"Skip"})]});if((R==null?void 0:R.type)==="discard"&&R.actor==="player"){const A=R.count,W=R.variableCount;if(A>1||W){const J=W?1:A;return o.jsxs("button",{className:"btn",onClick:()=>f(k),disabled:k.length<J,children:["Confirm Discard (",k.length,"/",W?"?":A,")"]})}}if((R==null?void 0:R.type)==="plague_2_player_discard"||(R==null?void 0:R.type)==="select_cards_from_hand_to_discard_for_fire_4"||(R==null?void 0:R.type)==="select_cards_from_hand_to_discard_for_hate_1"){let A,W=0;return R.type==="plague_2_player_discard"?(A=i,W=1):R.type==="select_cards_from_hand_to_discard_for_fire_4"?(A=f,W=1):(A=h,W=R.count),o.jsxs("button",{className:"btn",onClick:()=>A(k),disabled:k.length<W,children:["Confirm Discard (",k.length,")"]})}if((R==null?void 0:R.type)==="plague_4_player_flip_optional")return o.jsxs(o.Fragment,{children:[o.jsx("button",{className:"btn",onClick:()=>s(!0),children:"Flip Plague-4"}),o.jsx("button",{className:"btn btn-back",onClick:()=>s(!1),children:"Skip"})]});if(R&&"optional"in R&&R.optional)return o.jsx("button",{className:"btn btn-back",onClick:r,children:"Skip Action"});if(R)return o.jsx("button",{className:"btn",disabled:!0,children:"Action Required"});if(U==="compile"&&X.length>0)return o.jsx("button",{className:"btn",disabled:!0,children:"Select Lane to Compile"});if(U==="action"){const A=O.hand.length<5,W=O.hand.length===0,J=ru(t,"player"),Q=A&&J.allowed;return W?o.jsx("button",{className:"btn",onClick:n,disabled:!J.allowed,title:J.allowed?void 0:J.reason,children:"Refresh (Required)"}):o.jsx("button",{className:"btn",onClick:n,disabled:!Q||!!b,title:J.allowed?void 0:J.reason,children:"Refresh"})}return o.jsx("button",{className:"btn",disabled:!0,children:"Processing..."})},T=()=>{var q,P,Z,G;if(R)switch(R.type){case"discard":return R.actor==="player"?R.variableCount?"Action: Select 1 or more cards to discard":R.count>1?`Action: Select ${R.count} cards to discard, then confirm`:`Action: Discard ${R.count} card from your hand`:"Waiting for Opponent to discard...";case"prompt_use_control_mechanic":return"Control Action: Rearrange protocols?";case"select_opponent_face_up_card_to_flip":return"Action: Select an opponent's face-up card to flip";case"select_own_face_up_covered_card_to_flip":return"Action: Select one of your face-up, covered cards to flip";case"select_opponent_covered_card_to_shift":return"Action: Select one of your opponent's covered cards to shift";case"select_own_covered_card_to_shift":return"Action: Select one of your covered cards to shift";case"select_lane_for_shift":return"Action: Select a new lane for the card";case"select_lane_for_shift_all":return"Action: Select a lane to shift all cards to";case"select_opponent_card_to_flip":return"Action: Select an opponent's card to flip";case"select_card_to_flip":{const A=R.targetFilter||{},W=A.owner||"any",J=A.faceState||"any",Q=A.position||"uncovered";let ee="Action: Flip ";return W==="own"?ee+="one of your ":W==="opponent"?ee+="an opponent's ":ee+="a ",J==="face_down"?ee+="face-down ":J==="face_up"&&(ee+="face-up "),Q==="covered"?ee+="covered ":Q==="uncovered"&&(ee+="uncovered "),ee+="card",ee}case"shift_flipped_card_optional":return"Action: You may shift the card you just flipped. Select a lane or skip.";case"select_covered_card_in_line_to_flip_optional":return"Action: You may flip one of your covered cards in this lane. Select a card or skip.";case"select_card_from_hand_to_play":{const A=R.valueFilter;return A!==void 0?`Action: Select a card with value ${A} from your hand to play`:"Action: Select a card from your hand to play"}case"select_lane_for_play":return"Action: Select another lane to play your card in";case"select_face_down_card_to_shift_for_darkness_4":return"Action: Select any face-down card to shift";case"select_cards_to_delete":return`Action: Select a card to delete (${R.count} remaining)`;case"select_face_down_card_to_delete":return"Action: Select a face-down card to delete";case"select_low_value_card_to_delete":return"Action: Select a card with value 0 or 1 to delete";case"select_card_from_other_lanes_to_delete":return`Action: Select a card to delete (${R.count} remaining)`;case"select_lane_for_death_2":return"Action: Select a lane to delete cards with value 1 or 2";case"select_lane_for_delete":return"Action: Select a lane";case"prompt_optional_draw":return"Optional: Draw card(s)?";case"prompt_death_1_effect":return"Start Phase: Use Death-1 effect?";case"select_card_to_delete_for_death_1":return"Action: Select a card to delete";case"delete_self":return"Deleting card...";case"prompt_give_card_for_love_1":return"End Phase: Give 1 card to draw 2?";case"select_card_from_hand_to_give":return"Action: Select a card from your hand to give";case"select_card_from_hand_to_reveal":return"Action: Select a card from your hand to reveal";case"plague_2_player_discard":return"Action: Select 1 or more cards to discard";case"plague_4_opponent_delete":return"Waiting for opponent to delete one of their face-down cards";case"plague_4_player_flip_optional":return"Action: You may flip Plague-4";case"select_any_other_card_to_flip":return"Action: Select any other card to flip";case"select_card_to_return":{const A=R.targetFilter||{},W=R.targetOwner||A.owner||"any",J=A.position||"uncovered";let Q="Action: Select ";return W==="own"?Q+="one of your ":W==="opponent"?Q+="an opponent's ":Q+="a ",J==="any"?Q+="covered or uncovered ":J==="covered"&&(Q+="covered "),Q+="card to return",Q}case"select_covered_card_to_flip_for_chaos_0":return"Action: Select a covered card to flip in this lane";case"prompt_fire_3_discard":return"End Phase: Discard 1 card to flip 1 card?";case"prompt_optional_discard_custom":return`Optional: Discard ${R.count} card(s) to continue?`;case"prompt_optional_effect":{const A=((P=(q=R.effectDef)==null?void 0:q.params)==null?void 0:P.action)||"effect",W=(G=(Z=R.effectDef)==null?void 0:Z.params)==null?void 0:G.count;return`Do you want to ${A==="shift"?"shift a card":A==="flip"?"flip a card":A==="draw"?`draw ${W||1} card(s)`:A==="discard"?`discard ${W||1} card(s)`:A==="delete"?"delete a card":A==="return"?"return a card":`execute ${A}${W?` ${W}`:""}`}?`}case"select_card_to_flip_for_fire_3":return"Action: Select a card to flip";case"select_own_other_card_to_shift":return"Action: Select one of your cards to shift";case"select_opponent_face_down_card_to_shift":return"Action: Select an opponent's face-down card to shift";case"prompt_spirit_1_start":return"Start Phase: Discard 1 card or flip Spirit-1?";case"select_any_card_to_flip_optional":return"Action: You may flip one card. Select a card or skip.";case"prompt_swap_protocols":return"Action: Swap two protocols.";case"select_cards_from_hand_to_discard_for_fire_4":return"Action: Select 1 or more cards to discard";case"select_cards_from_hand_to_discard_for_hate_1":return`Action: Select ${R.count} card(s) to discard for Hate-1`;case"select_any_card_to_flip":return`Action: Select a card to flip (${R.count} remaining)`;case"select_any_face_down_card_to_flip_optional":return"Action: You may flip a face-down card. Select a card or skip.";case"select_lane_for_life_3_play":return"Action: Select another lane to play a card into";case"select_card_to_flip_for_light_0":return"Action: Select any card to flip";case"prompt_shift_or_flip_board_card_custom":return"Action: Choose to shift, flip, or skip";case"select_board_card_to_reveal_custom":return"Action: Select a face-down card to reveal";case"select_lane_to_shift_revealed_card_for_light_2":return"Action: Select a lane to shift the revealed card to";case"select_lane_to_shift_revealed_board_card_custom":return"Action: Select a lane to shift the revealed card to";case"select_lane_to_shift_cards_for_light_3":return"Action: Select a lane to shift all face-down cards to";case"select_lane_for_metal_3_delete":return"Action: Select a lane with 8+ cards to delete";case"select_lane_for_delete_all":return"Action: Select a lane to delete all cards";case"select_lanes_for_swap_stacks":{const A=R.selectedFirstLane;return A===void 0?"Action: Select the first lane to swap":`Action: Select the second lane to swap with lane ${A+1}`}case"select_any_other_card_to_flip_for_water_0":return"Action: Select any other card to flip";case"prompt_rearrange_protocols":return"Action: Rearrange protocols";case"select_lane_for_water_3":return"Action: Select a lane to return cards from";case"select_own_card_to_return_for_water_4":return"Action: Select one of your cards to return to your hand";case"prompt_return_for_psychic_4":return"End Phase: Return an opponent's card?";case"select_any_opponent_card_to_shift":return"Action: Select an opponent's card to shift";case"select_card_to_shift":{const A=R.targetFilter||{},W=A.owner||"any",J=A.faceState||"any",Q=A.position||"uncovered";let ee="Action: Select ";return W==="own"?ee+="one of your ":W==="opponent"?ee+="an opponent's ":ee+="a ",J==="face_down"?ee+="face-down ":J==="face_up"&&(ee+="face-up "),Q==="covered"?ee+="covered ":Q==="uncovered"&&(ee+="uncovered "),ee+="card to shift",ee}case"select_opponent_card_to_return":return"Action: Select an opponent's card to return";case"select_own_highest_card_to_delete_for_hate_2":return"Action: Select your highest value uncovered card to delete";case"select_opponent_highest_card_to_delete_for_hate_2":return"Action: Select opponent's highest value uncovered card to delete";case"custom_choice":{const A=R.options||[];if(A.length===2){const W=A[0].params,J=A[1].params,Q=ee=>ee.action==="discard"?`you discard ${ee.count||1} card${ee.count!==1?"s":""}`:ee.action==="flip"&&ee.flipSelf?"flip this card":ee.action==="draw"?`draw ${ee.count||1} card${ee.count!==1?"s":""}`:ee.action==="delete"&&ee.deleteSelf?"delete this card":ee.action==="delete"?`delete ${ee.count||1} card${ee.count!==1?"s":""}`:ee.action==="return"?`return ${ee.count||1} card${ee.count!==1?"s":""}`:ee.action==="shift"?"shift a card":ee.action||"option";return`Either ${Q(W)} or ${Q(J)}.`}return"Action: Make a choice"}case"select_card_from_revealed_deck":return`Action: Select a card with value ${R.valueFilter} from your revealed deck`;case"select_phase_effect":{const A=R,W=A.availableEffects.map(J=>J.cardName).join(", ");return`${A.phase} Phase: Choose which effect to resolve first (${W})`}case"select_card_from_trash_to_play":{const A=R.trashOwner||"own";return`Action: Select a card from ${A==="opponent"?"opponent's":A==="any"?"any player's":"your"} trash to play`}case"select_card_from_trash_to_reveal":{const A=R.trashOwner||"own";return`Action: Select a card from ${A==="opponent"?"opponent's":A==="any"?"any player's":"your"} trash to reveal`}default:return"Action Required"}return U==="compile"&&X.length>0?"Phase: Compile":`Phase: ${U.replace("_"," ")}`};return o.jsxs("div",{className:`phase-controller ${N}`,children:[o.jsxs("div",{className:"effect-source-info",children:[o.jsxs("span",{children:[D,"'s Turn"]}),R&&B&&o.jsxs(o.Fragment,{children:[" | Effect from: ",o.jsxs("span",{children:[B.protocol,"-",B.value]})]}),(R==null?void 0:R.sourceCardId)==="CONTROL_MECHANIC"&&o.jsxs(o.Fragment,{children:[" | Effect from: ",o.jsx("span",{children:"Control Component"})]})]}),o.jsxs("div",{className:"phase-controller-main",children:[o.jsx("div",{className:"phase-info",children:T()}),o.jsx("div",{className:"phase-actions",children:L()})]})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Ex={start:"Start",control:"Control",action:"Action",compile:"Compile",hand_limit:"Hand Limit",end:"End"},jx=({gameState:t,turn:n,animationState:r,difficulty:i,onPlayerClick:s,onOpponentClick:d})=>{const{player:u,opponent:p}=t,f=w=>{const g=["info-section"];return g.push(w==="player"?"player-info":"opponent-info"),n===w&&g.push("active-turn"),(r==null?void 0:r.type)==="drawCard"&&r.owner===w&&g.push("is-drawing"),(r==null?void 0:r.type)==="discardCard"&&r.owner===w&&g.push("is-discarding"),g.join(" ")},h=w=>{const g=w==="player"?u:p,y=w==="player"?s:d,m=w==="player"?"Player":`Opponent${i?` (${i.charAt(0).toUpperCase()+i.slice(1)})`:""}`,x=n===w;return o.jsx("div",{className:f(w),onClick:y,children:o.jsxs("div",{className:"info-section-body",children:[o.jsx("h3",{children:m}),x&&o.jsx("span",{className:"phase-badge",children:Ex[t.phase]}),o.jsxs("div",{className:"info-line",children:[o.jsx("span",{children:"Hand:"}),o.jsx("span",{children:g.hand.length})]}),o.jsxs("div",{className:"info-line",children:[o.jsx("span",{children:"Deck:"}),o.jsx("span",{children:g.deck.length})]}),o.jsxs("div",{className:"info-line",children:[o.jsx("span",{children:"Trash:"}),o.jsx("span",{children:g.discard.length})]})]})})};return o.jsxs("div",{className:"game-info-panel",children:[h("opponent"),h("player")]})},kx=/\b([A-Z][a-z]+(?:_custom)?)-(\d)\b/g;function vi(t,n){return{...t,id:`preview-${t.protocol}-${t.value}`,isFaceUp:n}}function ay(t){const n=t.match(/^([A-Z][a-z]+(?:_custom)?)-(\d)$/);return n?{protocol:n[1],value:parseInt(n[2],10)}:null}function oy(t){const n=[];let r;const i=new RegExp(kx);for(;(r=i.exec(t))!==null;)n.push({protocol:r[1],value:parseInt(r[2],10)});return n}function km(t,n){if(t.sourceCardRef||t.targetCardRefs&&t.targetCardRefs.length>0)return!0;if(t.sourceCard){const i=ay(t.sourceCard);if(i&&n.some(s=>s.protocol===i.protocol&&s.value===i.value))return!0}const r=oy(t.message);return!!(r.length>0&&r.some(i=>n.some(s=>s.protocol===i.protocol&&s.value===i.value)))}function Tx(t,n){const r={source:null,targets:[]};if(t.sourceCardRef){const i=n.find(s=>s.protocol===t.sourceCardRef.protocol&&s.value===t.sourceCardRef.value);i&&(r.source=vi(i,t.sourceCardRef.isFaceUp))}if(t.targetCardRefs&&t.targetCardRefs.length>0)for(const i of t.targetCardRefs){const s=n.find(d=>d.protocol===i.protocol&&d.value===i.value);s&&r.targets.push(vi(s,i.isFaceUp))}if(!r.source&&r.targets.length===0){if(t.sourceCard){const s=ay(t.sourceCard);if(s){const d=n.find(u=>u.protocol===s.protocol&&u.value===s.value);d&&(r.source=vi(d,!0))}}const i=oy(t.message);for(const s of i){const d=n.find(u=>u.protocol===s.protocol&&u.value===s.value);if(d){const u=vi(d,!0);r.source?(r.source.protocol!==s.protocol||r.source.value!==s.value)&&r.targets.push(u):r.source=u}}}return r}function Nx({log:t,onClose:n}){const[r,i]=se.useState(null),[s,d]=se.useState(0),u=se.useMemo(()=>{const w=zo();return[...Wn,...w]},[]),p=w=>{let g="";if(w.phase){const y=w.phase.charAt(0).toUpperCase()+w.phase.slice(1);g+=`[${y}] `}return w.sourceCard&&!w.message.startsWith(w.sourceCard)&&(g+=`${w.sourceCard}: `),`${g}${w.message}`},f=se.useMemo(()=>{if(r===null)return null;const w=t[r];return w?Tx(w,u):null},[r,t,u]),h=(w,g)=>{km(g,u)&&(r===w?f&&f.targets.length>1?d(y=>(y+1)%f.targets.length):(i(null),d(0)):(i(w),d(0)))};return o.jsx("div",{className:"modal-overlay",onClick:n,children:o.jsxs("div",{className:"modal-content log-modal-content log-modal-with-preview",onClick:w=>w.stopPropagation(),children:[o.jsx("button",{className:"btn btn-back modal-close-btn",onClick:n,children:"X"}),o.jsx("h2",{children:"Game Log"}),o.jsxs("div",{className:"log-content-wrapper",children:[o.jsx("div",{className:"log-preview-area log-preview-left",children:(f==null?void 0:f.source)&&o.jsx("div",{className:"log-preview-card",children:o.jsx(xt,{card:f.source,isFaceUp:f.source.isFaceUp})})}),o.jsx("ol",{className:"log-list",children:t.map((w,g)=>{const y=w.indentLevel!==void 0,m=y?{paddingLeft:`${w.indentLevel*20+40}px`}:{};y&&w.indentLevel===0&&(m.fontWeight="bold");const x=km(w,u),S=r===g;return o.jsx("li",{className:`log-entry log-entry-${w.player}${x?" log-entry-clickable":""}${S?" log-entry-selected":""}`,style:m,onClick:()=>h(g,w),children:p(w)},g)})}),o.jsx("div",{className:"log-preview-area log-preview-right",children:(f==null?void 0:f.targets)&&f.targets.length>0&&o.jsxs("div",{className:"log-preview-card",children:[o.jsx(xt,{card:f.targets[s],isFaceUp:f.targets[s].isFaceUp}),f.targets.length>1&&o.jsxs("div",{className:"log-preview-counter",children:[s+1," / ",f.targets.length]})]})})]})]})})}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Ax=({message:t,player:n})=>o.jsx("div",{className:`toaster toaster-${n}`,children:t});function Rx({gameState:t,targetPlayer:n,onConfirm:r}){var q;const[i]=se.useState([...t[n].protocols]),[s,d]=se.useState([...t[n].protocols]),[u,p]=se.useState([0,1,2]),f=se.useRef(null),h=se.useRef(null),w=se.useRef(0),g=se.useRef(null),y=se.useRef(0),m=((q=t.actionRequired)==null?void 0:q.type)==="prompt_rearrange_protocols"?t.actionRequired.disallowedProtocolForLane:void 0,x=se.useMemo(()=>{if(s.length!==i.length)return!1;for(let P=0;P<s.length;P++)if(s[P]!==i[P])return!0;return!1},[s,i]),S=se.useMemo(()=>{if(!m)return console.log("[RearrangeModal] No disallowedProtocolForLane set"),!1;const{laneIndex:P,protocol:Z}=m,G=s[P],A=G===Z;return console.log("[RearrangeModal] Checking violation:",{disallowedProtocol:Z,disallowedLaneIndex:P,currentProtocolAtLane:G,protocols:s,hasViolation:A}),A},[s,m]),E=t[n],b=t[n==="player"?"opponent":"player"],k=E.laneValues,N=E.compiled,U=(P,Z)=>{let G=[P];return Z&&G.push("compiled"),G.join(" ")},V=(P,Z)=>{f.current=Z,P.dataTransfer.effectAllowed="move"},R=(P,Z)=>{P.preventDefault(),h.current=Z},O=()=>{if(f.current!==null&&h.current!==null&&f.current!==h.current){const P=[...s],Z=[...u],G=P[f.current];P[f.current]=P[h.current],P[h.current]=G;const A=Z[f.current];Z[f.current]=Z[h.current],Z[h.current]=A,f.current=null,h.current=null,d(P),p(Z)}},X=P=>{P.preventDefault()},M=(P,Z)=>{g.current=Z,w.current=P.touches[0].clientY,y.current=P.touches[0].clientY},$=P=>{var A;if(g.current===null)return;y.current=P.touches[0].clientY;const Z=P.touches[0],G=document.elementFromPoint(Z.clientX,Z.clientY);if(G){const W=G.closest(".rearrange-item");if(W){const Q=Array.from(((A=W.parentElement)==null?void 0:A.children)||[]).indexOf(W);Q!==-1&&Q!==g.current&&(h.current=Q)}}},B=()=>{if(g.current!==null&&h.current!==null&&g.current!==h.current){const P=[...s],Z=[...u],G=P[g.current];P[g.current]=P[h.current],P[h.current]=G;const A=Z[g.current];Z[g.current]=Z[h.current],Z[h.current]=A,d(P),p(Z)}g.current=null,h.current=null,w.current=0,y.current=0},I=n==="player",D=I?"Rearrange Your Protocols":"Rearrange Opponent's Protocols",L=o.jsx("div",{className:`protocol-bar ${I?"player-bar":"opponent-bar"} rearrange-editable`,onDragOver:X,children:s.map((P,Z)=>{const G=P!==i[Z],A=m&&m.laneIndex===Z&&P===m.protocol,W=u[Z],J=N[W],Q=U("protocol-display rearrange-item",J);return o.jsxs("div",{className:`${Q} ${G?"changed":""} ${A?"violation":""}`,draggable:!0,onDragStart:ee=>V(ee,Z),onDragEnter:ee=>R(ee,Z),onDragEnd:O,onTouchStart:ee=>M(ee,Z),onTouchMove:$,onTouchEnd:B,children:[o.jsx("span",{className:"protocol-name",children:P}),o.jsx("span",{className:"protocol-value",children:k[Z]})]},`${P}-${Z}`)})}),T=o.jsx("div",{className:`protocol-bar ${I?"opponent-bar":"player-bar"}`,children:b.protocols.map((P,Z)=>o.jsxs("div",{className:U("protocol-display",b.compiled[Z]),children:[o.jsx("span",{className:"protocol-name",children:P}),o.jsx("span",{className:"protocol-value",children:b.laneValues[Z]})]},`other-proto-${P}-${Z}`))});return o.jsx("div",{className:"modal-overlay",children:o.jsxs("div",{className:"modal-content rearrange-modal-content",onClick:P=>P.stopPropagation(),children:[o.jsx("h2",{children:D}),o.jsx("p",{children:"Drag and drop the protocols to reorder them. You must change the order to continue."}),m&&o.jsxs("p",{className:"warning-text",children:[" ",o.jsx("strong",{children:m.protocol})," cannot be placed on line ",o.jsx("strong",{children:m.laneIndex})," due to Anarchy-3's restriction."]}),o.jsx("div",{className:"rearrange-board-view",children:o.jsxs("div",{className:"protocol-bars-container",children:[I?T:L,I?L:T]})}),o.jsxs("div",{className:"rearrange-actions",children:[o.jsx("button",{className:"btn",onClick:()=>r(s),disabled:!x||S,children:"Confirm Rearrangement"}),S&&o.jsxs("p",{className:"error-text",children:["Cannot confirm: ",m.protocol," is on line ",m.laneIndex]})]})]})})}function Fx({gameState:t,targetPlayer:n,onConfirm:r}){const[i,s]=se.useState([]),d=t[n],u=n==="player",p=u?"Swap Your Protocols":"Swap Opponent's Protocols",f=g=>{i.includes(g)?s(y=>y.filter(m=>m!==g)):i.length<2&&s(y=>[...y,g])},h=()=>{i.length===2&&r(i)},w=g=>{let y=["protocol-display","rearrange-item"];return d.compiled[g]&&y.push("compiled"),i.includes(g)&&y.push("selected"),y.join(" ")};return o.jsx("div",{className:"modal-overlay",children:o.jsxs("div",{className:"modal-content rearrange-modal-content",onClick:g=>g.stopPropagation(),children:[o.jsx("h2",{children:p}),o.jsx("p",{children:"Select two protocols to swap their positions. This action is mandatory."}),o.jsx("div",{className:"rearrange-board-view",children:o.jsx("div",{className:"protocol-bars-container",children:o.jsx("div",{className:`protocol-bar ${u?"player-bar":"opponent-bar"}`,children:d.protocols.map((g,y)=>o.jsxs("div",{className:w(y),onClick:()=>f(y),children:[o.jsx("span",{className:"protocol-name",children:g}),o.jsx("span",{className:"protocol-value",children:d.laneValues[y]})]},g))})})}),o.jsx("div",{className:"rearrange-actions",children:o.jsx("button",{className:"btn",onClick:h,disabled:i.length!==2,children:"Confirm Swap"})})]})})}function Dx({gameState:t,onConfirm:n}){const[r,i]=se.useState(null),s=p=>{i(p)},d=()=>{r!==null&&n(r)},u=p=>{let f=["number-button"];return r===p&&f.push("selected"),f.join(" ")};return o.jsx("div",{className:"modal-overlay",children:o.jsxs("div",{className:"modal-content state-number-modal",onClick:p=>p.stopPropagation(),children:[o.jsx("h2",{children:"State a Number"}),o.jsx("p",{children:"Choose a number (0-5) to state. Cards drawn with this value may be revealed and played."}),o.jsx("div",{className:"number-selection",children:[0,1,2,3,4,5].map(p=>o.jsx("button",{className:u(p),onClick:()=>s(p),children:p},p))}),o.jsx("div",{className:"modal-actions",children:o.jsx("button",{className:"btn",onClick:d,disabled:r===null,children:"Confirm"})})]})})}function $x({gameState:t,availableProtocols:n,onConfirm:r}){const[i,s]=se.useState(null),d=f=>{s(f)},u=()=>{i!==null&&r(i)},p=f=>{let h=["protocol-button"];return i===f&&h.push("selected"),h.join(" ")};return o.jsx("div",{className:"modal-overlay",children:o.jsxs("div",{className:"modal-content state-protocol-modal",onClick:f=>f.stopPropagation(),children:[o.jsx("h2",{children:"State a Protocol"}),o.jsx("p",{children:"Choose a protocol from your opponent's cards. If the discarded card matches, you'll delete a card."}),o.jsx("div",{className:"protocol-selection",children:n.map(f=>o.jsx("button",{className:p(f),onClick:()=>d(f),children:f},f))}),o.jsx("div",{className:"modal-actions",children:o.jsx("button",{className:"btn",onClick:u,disabled:i===null,children:"Confirm"})})]})})}function qx({gameState:t,allDrawnCardIds:n,eligibleCardIds:r,statedNumber:i,revealCount:s=1,onConfirm:d,onClose:u}){const[p,f]=se.useState(null),h=se.useRef(!1),w=t.player.hand.filter(j=>n.includes(j.id)),g=j=>r.includes(j),y=r.length>0;se.useEffect(()=>{if(!h.current&&r.length>0){const j=w.find(b=>g(b.id));j&&(f(j),h.current=!0)}},[w,r]);const m=j=>{g(j.id)&&f(j)},x=j=>{g(j.id)&&f(j)},S=()=>{p&&g(p.id)&&d(p.id)},E=()=>{u&&u()};return o.jsx("div",{className:"modal-overlay",children:o.jsxs("div",{className:"modal-content revealed-deck-modal",onClick:j=>j.stopPropagation(),children:[o.jsx("h2",{children:"Cards Drawn"}),i!==void 0?o.jsxs("p",{children:["Select a card with value ",o.jsx("strong",{children:i})," to reveal:"]}):o.jsx("p",{children:"Select a card to reveal:"}),o.jsxs("div",{className:"revealed-deck-content-wrapper",children:[o.jsx("div",{className:"revealed-deck-preview-area",children:p?o.jsxs("div",{className:"revealed-deck-preview-card",children:[o.jsx(xt,{card:p,isFaceUp:!0}),o.jsxs("button",{className:"btn preview-confirm-btn",onClick:S,children:["Reveal ",p.protocol,"-",p.value]})]}):o.jsx("div",{className:"revealed-deck-preview-card no-selection",children:o.jsx("p",{className:"no-match-message",children:y?"Select an eligible card":`No cards match value ${i}`})})}),o.jsx("div",{className:"revealed-deck-grids-area",children:o.jsx("div",{className:"revealed-deck-card-grid",children:w.length>0?w.map(j=>{const b=g(j.id),k=(p==null?void 0:p.id)===j.id;return o.jsx("div",{onClick:N=>{N.stopPropagation(),x(j)},onMouseEnter:()=>m(j),style:{cursor:b?"pointer":"default"},children:o.jsx(xt,{card:j,isFaceUp:!0,additionalClassName:`in-hand ${b?k?"highlight-selectable":"":"dimmed"}`})},j.id)}):o.jsx("p",{className:"no-cards",children:"No cards drawn."})})})]}),!y&&o.jsx("div",{className:"modal-actions",children:o.jsx("button",{className:"btn",onClick:E,children:"Continue"})})]})})}function Ix({gameState:t,onSelectCard:n,onConfirmProtocolDraw:r}){var B;const[i,s]=se.useState(null),[d,u]=se.useState(null),p=se.useRef(!1),f=d||i,h=t.actionRequired,w=(h==null?void 0:h.type)==="reveal_deck_draw_protocol",g=h==null?void 0:h.revealedCards,y=h==null?void 0:h.selectableCardIds,m=(h==null?void 0:h.autoSelectedIndices)||[],x=h==null?void 0:h.targetProtocol,S=g||(h!=null&&h.actor?(B=t[h.actor])==null?void 0:B.deck:[])||[],E=se.useMemo(()=>S.map((I,D)=>({...I,id:I.id||`deck-${D}`,deckIndex:D,isFaceUp:!0})),[S]),j=se.useMemo(()=>w?E.filter((I,D)=>m.includes(D)):[],[w,E,m]);if(se.useEffect(()=>{if((h==null?void 0:h.type)==="select_card_from_revealed_deck"&&(y==null?void 0:y.length)>0&&!p.current){const I=E.find(D=>y.includes(D.id));I&&(s(I),p.current=!0)}},[h==null?void 0:h.type,y,E]),se.useEffect(()=>{(!h||h.type!=="select_card_from_revealed_deck"&&h.type!=="reveal_deck_draw_protocol")&&(p.current=!1,s(null),u(null))},[h]),!h||h.type!=="select_card_from_revealed_deck"&&h.type!=="reveal_deck_draw_protocol")return null;const{valueFilter:b}=h,k=I=>w?!1:y==null?void 0:y.includes(I),N=I=>w&&m.includes(I),U=I=>{(w||k(I.id))&&u(I)},V=()=>{u(null)},R=I=>{!w&&k(I.id)&&s(I)},O=()=>{w?r==null||r():f&&k(f.id)&&n(f.id)},X=w?"Revealed Deck":"Your Revealed Deck",M=w?`All ${x} cards will be drawn (${j.length} found):`:`Select a card with value ${b} to draw:`,$=w?j.length>0?`Draw ${j.length} ${x} card${j.length!==1?"s":""}`:"Confirm (no matching cards)":f?`Draw ${f.protocol}-${f.value}`:"Select a card";return o.jsx("div",{className:"modal-overlay",children:o.jsxs("div",{className:"modal-content revealed-deck-modal",onClick:I=>I.stopPropagation(),children:[o.jsx("h2",{children:X}),o.jsx("p",{children:M}),o.jsxs("div",{className:"revealed-deck-content-wrapper",children:[o.jsx("div",{className:"revealed-deck-preview-area",children:w?o.jsxs("div",{className:"revealed-deck-preview-card",children:[f&&o.jsx(xt,{card:f,isFaceUp:!0}),o.jsx("button",{className:"btn preview-confirm-btn",onClick:O,children:$})]}):f&&o.jsxs("div",{className:"revealed-deck-preview-card",children:[o.jsx(xt,{card:f,isFaceUp:!0}),o.jsx("button",{className:"btn preview-confirm-btn",onClick:O,children:$})]})}),o.jsx("div",{className:"revealed-deck-grids-area",children:o.jsx("div",{className:"revealed-deck-card-grid",children:E.length>0?E.map(I=>{const D=k(I.id),L=N(I.deckIndex),T=(i==null?void 0:i.id)===I.id,P=(d==null?void 0:d.id)===I.id||T,Z=L||D&&P,G=w?!L:!D;return o.jsx("div",{onClick:A=>{A.stopPropagation(),R(I)},onMouseEnter:()=>U(I),onMouseLeave:V,style:{cursor:D?"pointer":"default"},children:o.jsx(xt,{card:I,isFaceUp:!0,additionalClassName:`in-hand ${Z?"highlight-selectable":""} ${G?"dimmed":""} ${T||L?"selected-card":""}`})},I.id)}):o.jsx("p",{className:"no-cards",children:"No cards in deck."})})})]})]})})}function Lx({gameState:t,onAccept:n,onDecline:r}){var g,y;const i=t.actionRequired;if(!i||i.type!=="prompt_optional_effect")return null;const s=i.effectDef;if(!s||((g=s.params)==null?void 0:g.action)!=="discard"||!((y=s.params)!=null&&y.useCardFromPreviousEffect))return null;const d=t.lastCustomEffectTargetCardId;if(!d)return null;const u=i.actor||"player",f=t[u].deck.find(m=>m.id===d);if(!f)return null;const h={...f,id:f.id||"revealed-top",isFaceUp:!0},w=`${f.protocol}-${f.value}`;return o.jsx("div",{className:"modal-overlay",children:o.jsxs("div",{className:"modal-content revealed-deck-top-modal",onClick:m=>m.stopPropagation(),children:[o.jsx("h2",{children:"Revealed: Top Card of Your Deck"}),o.jsx("p",{children:"You may discard this card:"}),o.jsx("div",{className:"revealed-card-display",children:o.jsx(xt,{card:h,isFaceUp:!0})}),o.jsxs("div",{className:"revealed-deck-top-actions",children:[o.jsxs("button",{className:"btn",onClick:n,children:["Discard ",w]}),o.jsx("button",{className:"btn btn-back",onClick:r,children:"Keep in Deck"})]})]})})}function Px({discardedCard:t,deckOwner:n,onConfirm:r}){const i=n==="own"?"your":"opponent's",s={...t,id:t.id||"deck-discard-preview",isFaceUp:!0};return o.jsx("div",{className:"modal-overlay",children:o.jsxs("div",{className:"modal-content deck-discard-modal",onClick:d=>d.stopPropagation(),children:[o.jsx("h2",{children:"Card Discarded"}),o.jsxs("p",{children:["From the top of ",o.jsx("strong",{children:i})," deck:"]}),o.jsx("div",{className:"deck-discard-preview-content",children:o.jsx("div",{className:"deck-discard-preview-card",children:o.jsx(xt,{card:s,isFaceUp:!0})})}),o.jsx("div",{className:"modal-actions",children:o.jsx("button",{className:"btn",onClick:r,children:"Continue"})})]})})}function Ux({card:t,isFaceDown:n,onConfirm:r}){const i=n?"face-down":"face-up";return o.jsx("div",{className:"modal-overlay",children:o.jsxs("div",{className:"modal-content deck-play-preview-modal",onClick:s=>s.stopPropagation(),children:[o.jsx("h2",{children:"Card from Deck"}),o.jsxs("p",{children:["You will play this card ",o.jsx("strong",{children:i}),":"]}),o.jsx("div",{className:"deck-play-preview-content",children:o.jsx("div",{className:"deck-play-preview-card",children:o.jsx(xt,{card:t,isFaceUp:!0})})}),o.jsx("div",{className:"modal-actions",children:o.jsx("button",{className:"btn",onClick:r,children:"Select Lane"})})]})})}function Tm({gameState:t,onSelectCard:n}){var $,B,I,D;const[r,i]=se.useState(null),[s,d]=se.useState(null),[u,p]=se.useState(null),[f,h]=se.useState(null),w=se.useRef(!1),g=u||r,y=f!==null?f:s,m=t.actionRequired,x=m==null?void 0:m.actor,S=(m==null?void 0:m.trashOwner)||"own";let E=[];S==="own"?E=x?(($=t[x])==null?void 0:$.discard)||[]:[]:S==="opponent"?E=((B=t[x==="player"?"opponent":"player"])==null?void 0:B.discard)||[]:S==="any"&&(E=[...((I=t.player)==null?void 0:I.discard)||[],...((D=t.opponent)==null?void 0:D.discard)||[]]);const j=se.useMemo(()=>(E||[]).map((L,T)=>({...L,id:L.id||`trash-${T}`,isFaceUp:!0,_trashIndex:T})),[E]);se.useEffect(()=>{((m==null?void 0:m.type)==="select_card_from_trash_to_play"||(m==null?void 0:m.type)==="select_card_from_trash_to_reveal")&&j.length>0&&!w.current&&(i(j[0]),d(0),w.current=!0)},[m==null?void 0:m.type,j]),se.useEffect(()=>{const L=(m==null?void 0:m.type)==="select_card_from_trash_to_play"||(m==null?void 0:m.type)==="select_card_from_trash_to_reveal";(!m||!L)&&(w.current=!1,i(null),d(null),p(null),h(null))},[m]);const b=(m==null?void 0:m.type)==="select_card_from_trash_to_play"||(m==null?void 0:m.type)==="select_card_from_trash_to_reveal";if(!m||!b)return null;const k=m.type==="select_card_from_trash_to_play",N=k?"Select Card to Play":"Select Card to Reveal",U=S==="opponent"?"opponent's":S==="any"?"any player's":"your",V=k?`Select a card from ${U} trash to play:`:`Select a card from ${U} trash to reveal:`,R=(L,T)=>{p(L),h(T)},O=()=>{p(null),h(null)},X=(L,T)=>{i(L),d(T)},M=()=>{g&&y!==null&&n(y)};return o.jsx("div",{className:"modal-overlay",children:o.jsxs("div",{className:"modal-content revealed-deck-modal",onClick:L=>L.stopPropagation(),children:[o.jsx("h2",{children:N}),o.jsx("p",{children:V}),o.jsxs("div",{className:"revealed-deck-content-wrapper",children:[o.jsx("div",{className:"revealed-deck-preview-area",children:g&&o.jsxs("div",{className:"revealed-deck-preview-card",children:[o.jsx(xt,{card:g,isFaceUp:!0}),o.jsxs("button",{className:"btn preview-confirm-btn",onClick:M,children:[k?"Play":"Reveal"," ",g.protocol,"-",g.value]})]})}),o.jsx("div",{className:"revealed-deck-grids-area",children:o.jsx("div",{className:"revealed-deck-card-grid",children:j.length>0?j.map((L,T)=>{const q=s===T,Z=f===T||q;return o.jsx("div",{onClick:G=>{G.stopPropagation(),X(L,T)},onMouseEnter:()=>R(L,T),onMouseLeave:O,style:{cursor:"pointer"},children:o.jsx(xt,{card:L,isFaceUp:!0,additionalClassName:`in-hand ${Z?"highlight-selectable":""} ${q?"selected-card":""}`})},L.id)}):o.jsx("p",{className:"no-cards",children:"No cards in trash."})})})]})]})})}function Ox({player:t,playerState:n,onClose:r,difficulty:i}){const s=t==="player"?"Player":`Opponent${i?` (${i.charAt(0).toUpperCase()+i.slice(1)})`:""}`,[d,u]=se.useState(null),p=h=>{u(h)},f=(h,w,g)=>{const y=h.map((m,x)=>({...m,id:`${w}-${m.protocol}-${m.value}-${x}`,isFaceUp:g}));return o.jsxs(o.Fragment,{children:[o.jsxs("h3",{children:[w," (",y.length,")"]}),o.jsx("div",{className:"debug-card-grid",children:y.length>0?y.map(m=>o.jsx("div",{onClick:x=>{x.stopPropagation(),u(m)},onMouseEnter:()=>p(m),onMouseLeave:()=>p(null),style:{cursor:"pointer"},children:o.jsx(xt,{card:m,isFaceUp:g,additionalClassName:"in-hand"})},m.id)):o.jsxs("p",{className:"no-cards",children:["No cards in ",w.toLowerCase(),"."]})})]})};return o.jsx("div",{className:"modal-overlay",onClick:r,children:o.jsxs("div",{className:"modal-content debug-modal-content debug-modal-with-preview",onClick:h=>h.stopPropagation(),children:[o.jsx("button",{className:"btn btn-back modal-close-btn",onClick:r,children:"X"}),o.jsxs("h2",{children:[s,"'s Info"]}),o.jsxs("div",{className:"debug-content-wrapper",children:[o.jsx("div",{className:"debug-preview-area",children:d&&o.jsx("div",{className:"debug-preview-card",children:o.jsx(xt,{card:d,isFaceUp:d.isFaceUp})})}),o.jsxs("div",{className:"debug-grids-area",children:[f(n.deck,"Deck",!1),f(n.discard,"Discard Pile",!0)]})]})]})})}function Mx({onComplete:t}){const[n,r]=se.useState("choose"),[i,s]=se.useState(null),[d,u]=se.useState(null),[p,f]=se.useState(!1),h=g=>{s(g),r("flipping"),f(!0);const y=Math.random()<.5?"heads":"tails";setTimeout(()=>{u(y),f(!1),r("result")},2e3)},w=()=>{if(d===null||i===null)return;const g=d===i;t(g?"player":"opponent",i,g)};return o.jsx("div",{className:"coin-flip-modal-overlay",children:o.jsxs("div",{className:"modal-content coin-flip-modal-content",onClick:g=>g.stopPropagation(),children:[n==="choose"&&o.jsxs(o.Fragment,{children:[o.jsx("h2",{children:"Coin Flip"}),o.jsx("p",{children:"Choose heads or tails to determine who starts the game."}),o.jsxs("div",{className:"coin-flip-choices",children:[o.jsxs("button",{className:"btn coin-flip-choice-btn",onClick:()=>h("heads"),children:[o.jsx("div",{className:"coin-choice-icon",children:"H"}),o.jsx("div",{className:"coin-choice-label",children:"Heads"})]}),o.jsxs("button",{className:"btn coin-flip-choice-btn",onClick:()=>h("tails"),children:[o.jsx("div",{className:"coin-choice-icon",children:"T"}),o.jsx("div",{className:"coin-choice-label",children:"Tails"})]})]})]}),n==="flipping"&&o.jsxs(o.Fragment,{children:[o.jsx("h2",{children:"Flipping..."}),o.jsxs("p",{children:["You chose: ",o.jsx("span",{className:"coin-flip-highlight",children:i==="heads"?"Heads":"Tails"})]}),o.jsx("div",{className:"coin-flip-animation-container",children:o.jsxs("div",{className:`coin-3d ${p?"is-flipping":""}`,children:[o.jsx("div",{className:"coin-face coin-heads",children:"H"}),o.jsx("div",{className:"coin-face coin-tails",children:"T"})]})})]}),n==="result"&&d&&i&&o.jsxs(o.Fragment,{children:[o.jsx("h2",{children:"Result"}),o.jsxs("p",{children:["You chose: ",o.jsx("span",{className:"coin-flip-highlight",children:i==="heads"?"Heads":"Tails"})]}),o.jsx("div",{className:"coin-flip-animation-container",children:o.jsxs("div",{className:`coin-3d result-${d}`,children:[o.jsx("div",{className:"coin-face coin-heads",children:"H"}),o.jsx("div",{className:"coin-face coin-tails",children:"T"})]})}),o.jsxs("p",{className:"coin-flip-result-text",children:["The coin landed on: ",o.jsx("span",{className:"coin-flip-highlight",children:d==="heads"?"Heads":"Tails"})]}),d===i?o.jsx("p",{className:"coin-flip-winner-text",children:"You won! You will start the game."}):o.jsx("p",{className:"coin-flip-loser-text",children:"Opponent won! Opponent will start the game."}),o.jsx("button",{className:"btn",onClick:w,children:"Continue"})]})]})})}const Hx="anarchy-custom-001",Vx="Anarchy",zx="Custom recreation of Anarchy protocol to validate editor capabilities",Bx="System Validation",Gx="2025-11-08T00:00:00.000Z",Yx="#8B0000",Wx="chaos",Qx=[{value:0,topEffects:[],middleEffects:[{id:"anarchy-0-shift",params:{action:"shift",targetFilter:{owner:"any",position:"uncovered",faceState:"any"}},position:"middle",trigger:"on_play"},{id:"anarchy-0-draw",params:{action:"draw",count:1,target:"self",source:"own_deck",conditional:{type:"non_matching_protocols"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[{id:"anarchy-1-passive",params:{action:"passive_rule",rule:{type:"require_non_matching_protocol",target:"all",scope:"global"}},position:"top",trigger:"passive"}],middleEffects:[{id:"anarchy-1-shift",params:{action:"shift",targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!0},destinationRestriction:{type:"non_matching_protocol"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"anarchy-2-delete",params:{action:"delete",count:1,targetFilter:{position:"any",faceState:"face_up"},protocolMatching:"must_match",excludeSelf:!1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"anarchy-3-swap",params:{action:"swap_protocols",target:"opponent"},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"anarchy-3-end-rearrange",params:{action:"rearrange_protocols",target:"own",restriction:{disallowedProtocol:"Anarchy",laneIndex:"current"}},position:"bottom",trigger:"end"}]},{value:5,topEffects:[],middleEffects:[{id:"anarchy-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:6,topEffects:[{id:"anarchy-6-start-flip",params:{action:"flip",count:1,flipSelf:!0,optional:!1,targetFilter:{owner:"any",position:"any",faceState:"any",excludeSelf:!1},advancedConditional:{type:"protocol_match",protocol:"Anarchy"}},position:"top",trigger:"start"}],middleEffects:[],bottomEffects:[]}],Xx="Fan-Content",ry={id:Hx,name:Vx,description:zx,author:Bx,createdAt:Gx,color:Yx,pattern:Wx,cards:Qx,category:Xx},Zx="apathy_custom",Kx="Apathy",Jx="Custom implementation of Apathy protocol",eC="System",tC="2025-01-08T00:00:00Z",nC="#9E9E9E",aC="radial",oC=[{value:0,topEffects:[{id:"apathy-0-value-modifier",params:{action:"value_modifier",modifier:{type:"add_per_condition",value:1,condition:"per_face_down_card",target:"own_total",scope:"this_lane"}},position:"top",trigger:"passive"}],middleEffects:[],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"apathy-1-flip-all",params:{action:"flip",count:"all",optional:!1,scope:"this_lane",targetFilter:{owner:"any",position:"any",faceState:"face_up",excludeSelf:!0}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:2,topEffects:[{id:"apathy-2-passive",params:{action:"passive_rule",rule:{type:"ignore_middle_commands",target:"all",scope:"this_lane"}},position:"top",trigger:"passive"}],middleEffects:[],bottomEffects:[{id:"apathy-2-on-cover",params:{action:"flip",count:1,flipSelf:!0,optional:!1,targetFilter:{owner:"any",position:"any",faceState:"any",excludeSelf:!1}},position:"bottom",trigger:"on_cover"}]},{value:3,topEffects:[],middleEffects:[{id:"apathy-3-flip-opponent",params:{action:"flip",count:1,optional:!1,targetFilter:{owner:"opponent",position:"uncovered",faceState:"face_up",excludeSelf:!1}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"apathy-4-flip-covered",params:{action:"flip",count:1,optional:!0,targetFilter:{owner:"own",position:"covered",faceState:"face_up",excludeSelf:!1}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"apathy-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],rC="Aux 1",ly={id:Zx,name:Kx,description:Jx,author:eC,createdAt:tC,color:nC,pattern:aC,cards:oC,category:rC},lC="assimilation-custom-001",sC="Assimilation",iC="Absorb your opponent's resources. Draw from their deck, steal their cards, and infiltrate their board.",cC="System",dC="2025-12-18T00:00:00.000Z",uC="#8B008B",pC="radial",fC=[{value:0,topEffects:[],middleEffects:[{id:"assimilation-0-steal-facedown",params:{action:"return",count:1,targetFilter:{owner:"opponent",position:"any",faceState:"face_down"},destination:"actor_hand"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"assimilation-1-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"},{id:"assimilation-1-refresh",params:{action:"refresh",target:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"assimilation-1-reactive-draw",params:{action:"draw",count:1,target:"self",source:"opponent_deck"},position:"bottom",trigger:"after_refresh",reactiveTriggerActor:"any",conditional:{type:"then",thenEffect:{id:"assimilation-1-reactive-discard",params:{action:"discard",count:1,actor:"self",discardTo:"opponent_trash"},position:"bottom",trigger:"on_play"}}}]},{value:2,topEffects:[],middleEffects:[],bottomEffects:[{id:"assimilation-2-play-opponent-deck",params:{action:"play",source:"deck",sourceOwner:"opponent",count:1,faceDown:!0,destinationRule:{type:"specific_lane",laneIndex:"current"}},position:"bottom",trigger:"end"}]},{value:4,topEffects:[],middleEffects:[{id:"assimilation-4-draw-opponent-deck",params:{action:"draw",count:1,target:"self",source:"opponent_deck"},position:"middle",trigger:"on_play"},{id:"assimilation-4-opponent-draw-own-deck",params:{action:"draw",count:1,target:"opponent",source:"own_deck"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"assimilation-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:6,topEffects:[],middleEffects:[],bottomEffects:[{id:"assimilation-6-play-to-opponent-board",params:{action:"play",source:"deck",count:1,faceDown:!0,destinationRule:{type:"specific_lane",laneIndex:"current"},targetBoard:"opponent"},position:"bottom",trigger:"end"}]}],hC="Aux 2",sy={id:lC,name:sC,description:iC,author:cC,createdAt:dC,color:uC,pattern:pC,cards:fC,category:hC},mC="chaos_custom_1",yC="Chaos",gC="Embrace the unpredictable. Custom protocol migration of original Chaos protocol.",vC="#E64DB8",_C="chaos",wC=[{value:0,topEffects:[],middleEffects:[{id:"chaos_0_flip_covered",trigger:"on_play",params:{action:"flip",count:1,scope:"each_lane",targetFilter:{owner:"any",position:"covered",faceState:"any"}},position:"middle"}],bottomEffects:[{id:"chaos_0_start_swap_draws",trigger:"start",params:{action:"mutual_draw",count:1},position:"bottom"}]},{value:1,topEffects:[],middleEffects:[{id:"chaos_1_rearrange_own",trigger:"on_play",params:{action:"rearrange_protocols",target:"own"},position:"middle"},{id:"chaos_1_rearrange_opponent",trigger:"on_play",params:{action:"rearrange_protocols",target:"opponent"},position:"middle"}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"chaos_2_shift_covered",trigger:"on_play",params:{action:"shift",count:1,targetFilter:{owner:"own",position:"covered",faceState:"any"}},position:"middle"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[],bottomEffects:[{id:"chaos_3_ignore_protocol",trigger:"passive",params:{action:"card_property",property:"ignore_protocol_matching"},position:"bottom"}]},{value:4,topEffects:[],middleEffects:[],bottomEffects:[{id:"chaos_4_end_discard_draw",trigger:"end",params:{action:"discard",count:"all",actor:"self"},conditional:{type:"then",thenEffect:{id:"chaos_4_draw_after_discard",trigger:"on_play",params:{action:"draw",count:1,countType:"equal_to_discarded",countOffset:0,target:"self",source:"own_deck"},position:"bottom"}},position:"bottom"}]},{value:5,topEffects:[],middleEffects:[{id:"chaos_5_discard",trigger:"on_play",params:{action:"discard",count:1,actor:"self"},position:"middle"}],bottomEffects:[]}],xC="Main 2",iy={id:mC,name:yC,description:gC,color:vC,pattern:_C,cards:wC,category:xC},CC="darkness_custom_v1",SC="Darkness",bC="Custom Darkness protocol - manipulate face-down cards, flip and shift",EC="System",jC="2025-01-08T00:00:00Z",kC="#1a0033",TC="grid",NC=[{value:0,topEffects:[],middleEffects:[{id:"dark-0-draw",params:{action:"draw",count:3,target:"self",source:"own_deck"},position:"middle",trigger:"on_play"},{id:"dark-0-shift",params:{action:"shift",targetFilter:{owner:"opponent",position:"covered",faceState:"any",excludeSelf:!1},destinationRestriction:{type:"any"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"dark-1-flip",params:{action:"flip",count:1,optional:!1,targetFilter:{owner:"opponent",position:"uncovered",faceState:"any",excludeSelf:!1}},position:"middle",trigger:"on_play"},{id:"dark-1-shift",params:{action:"shift",optional:!0,targetFilter:{owner:"any",position:"any",faceState:"any",excludeSelf:!1},destinationRestriction:{type:"any"}},position:"middle",trigger:"on_play",useCardFromPreviousEffect:!0}],bottomEffects:[]},{value:2,topEffects:[{id:"dark-2-value-modifier",params:{action:"value_modifier",modifier:{type:"set_to_fixed",value:4,target:"own_cards",scope:"this_lane",filter:{faceState:"face_down",position:"any"}}},position:"top",trigger:"passive"}],middleEffects:[{id:"dark-2-flip",params:{action:"flip",count:1,optional:!0,scope:"this_lane",targetFilter:{owner:"any",position:"covered",faceState:"any",excludeSelf:!1}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"dark-3-play",params:{action:"play",source:"hand",count:1,faceDown:!0,destinationRule:{type:"other_lines",excludeCurrentLane:!0}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"dark-4-shift",params:{action:"shift",targetFilter:{owner:"any",position:"uncovered",faceState:"face_down",excludeSelf:!1},destinationRestriction:{type:"any"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"dark-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],AC="Main 1",cy={id:CC,name:SC,description:bC,author:EC,createdAt:jC,color:kC,pattern:TC,cards:NC,category:AC},RC="death_custom_v1",FC="Death",DC="Custom Death protocol - delete cards with various conditions",$C="System",qC="2025-01-09T00:00:00Z",IC="#8B0000",LC="stripes",PC=[{value:0,topEffects:[],middleEffects:[{id:"death-0-delete-from-each-lane",params:{action:"delete",count:1,scope:{type:"each_other_line"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[{id:"death-1-optional-draw",params:{action:"draw",count:1,optional:!0},position:"top",trigger:"start",conditional:{type:"if_executed",thenEffect:{id:"death-1-delete-other",params:{action:"delete",count:1,excludeSelf:!0},position:"top",trigger:"start",conditional:{type:"then",thenEffect:{id:"death-1-delete-self",params:{action:"delete",count:1,targetFilter:{position:"any",owner:"own"},deleteSelf:!0},position:"top",trigger:"start"}}}}}],middleEffects:[],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"death-2-delete-lane-values",params:{action:"delete",count:"all",selectLane:!0,targetFilter:{faceState:"any",valueRange:{min:1,max:2}}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"death-3-delete-facedown",params:{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"face_down"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"death-4-delete-low-value",params:{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"face_up",valueRange:{min:0,max:1}}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"death-5-discard",params:{action:"discard",count:1},position:"middle",trigger:"on_play"}],bottomEffects:[]}],UC="Main 1",dy={id:RC,name:FC,description:DC,author:$C,createdAt:qC,color:IC,pattern:LC,cards:PC,category:UC},OC="fire-custom-001",MC="Fire",HC="Fire protocol - discard cards to fuel powerful effects",VC="System",zC="2025-11-09T00:00:00.000Z",BC="#F06838",GC="radial",YC=[{value:0,topEffects:[],middleEffects:[{id:"fire-0-flip",params:{action:"flip",count:1,targetFilter:{excludeSelf:!0}},position:"middle",trigger:"on_play"},{id:"fire-0-draw",params:{action:"draw",count:2},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"fire-0-oncover-draw",params:{action:"draw",count:1},position:"bottom",trigger:"on_cover",conditional:{type:"then",thenEffect:{id:"fire-0-oncover-flip",params:{action:"flip",count:1,targetFilter:{excludeSelf:!0}},position:"bottom",trigger:"on_cover"}}}]},{value:1,topEffects:[],middleEffects:[{id:"fire-1-discard",params:{action:"discard",count:1},position:"middle",trigger:"on_play",conditional:{type:"if_executed",thenEffect:{id:"fire-1-delete",params:{action:"delete",count:1},position:"middle",trigger:"on_play"}}}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"fire-2-discard",params:{action:"discard",count:1},position:"middle",trigger:"on_play",conditional:{type:"if_executed",thenEffect:{id:"fire-2-return",params:{action:"return",count:1,targetFilter:{position:"uncovered"}},position:"middle",trigger:"on_play"}}}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[],bottomEffects:[{id:"fire-3-discard",params:{action:"discard",count:1,optional:!0},position:"bottom",trigger:"end",conditional:{type:"if_executed",thenEffect:{id:"fire-3-flip",params:{action:"flip",count:1},position:"bottom",trigger:"end"}}}]},{value:4,topEffects:[],middleEffects:[{id:"fire-4-discard-variable",params:{action:"discard",count:1,variableCount:!0},position:"middle",trigger:"on_play",conditional:{type:"then",thenEffect:{id:"fire-4-draw-based-on-discard",params:{action:"draw",countType:"equal_to_discarded",countOffset:1},position:"middle",trigger:"on_play"}}}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"fire-5-discard",params:{action:"discard",count:1,optional:!1},position:"middle",trigger:"on_play"}],bottomEffects:[]}],WC="Main 1",uy={id:OC,name:MC,description:HC,author:VC,createdAt:zC,color:BC,pattern:GC,cards:YC,category:WC},QC="frost_custom_1",XC="Frost",ZC="Freeze the game state. Frost blocks actions and preserves face-down cards.",KC="#87CEEB",JC="frost",e1=[{value:0,topEffects:[],middleEffects:[{id:"frost_0_draw_per_face_down",trigger:"on_play",position:"middle",params:{action:"draw",count:1,source:"own_deck",target:"self",countType:"count_face_down"}}],bottomEffects:[]},{value:1,topEffects:[{id:"frost_1_block_flips",trigger:"passive",position:"top",params:{action:"passive_rule",rule:{type:"block_flips",target:"all",scope:"global"}}}],middleEffects:[],bottomEffects:[{id:"frost_1_block_rearrange",trigger:"passive",position:"bottom",params:{action:"passive_rule",rule:{type:"block_protocol_rearrange",target:"all",scope:"global"}}}]},{value:2,topEffects:[],middleEffects:[{id:"frost_2_play_face_down",trigger:"on_play",position:"middle",params:{action:"play",count:1,source:"hand",faceDown:!0}}],bottomEffects:[]},{value:3,topEffects:[{id:"frost_3_block_shifts",trigger:"passive",position:"top",params:{action:"passive_rule",rule:{type:"block_shifts_from_and_to_lane",target:"all",scope:"this_lane"}}}],middleEffects:[],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"frost_4_flip_covered",trigger:"on_play",position:"middle",params:{action:"flip",count:1,optional:!0,targetFilter:{owner:"own",faceState:"face_up",position:"covered"}}}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"frost_5_discard",trigger:"on_play",position:"middle",params:{action:"discard",count:1,target:"self"}}],bottomEffects:[]}],t1="Fan-Content",py={id:QC,name:XC,description:ZC,color:KC,pattern:JC,cards:e1,category:t1},n1="hate-custom-001",a1="Hate",o1="Focused on deletion and sacrifice. Delete cards to gain advantage.",r1="System Migration",l1="2025-11-13T00:00:00.000Z",s1="#E67A7A",i1="diagonal-lines",c1=[{value:0,topEffects:[],middleEffects:[{id:"hate-0-delete",params:{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"any"},scope:{type:"anywhere"},excludeSelf:!1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"hate-1-discard",params:{action:"discard",count:3,actor:"self",upTo:!0},position:"middle",trigger:"on_play"},{id:"hate-1-delete-1",params:{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"any"},scope:{type:"anywhere"},excludeSelf:!1,upTo:!0},position:"middle",trigger:"on_play"},{id:"hate-1-delete-2",params:{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"any"},scope:{type:"anywhere"},excludeSelf:!1,upTo:!0},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"hate-2-delete-own",params:{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"any",calculation:"highest_value",owner:"own"},scope:{type:"anywhere"},excludeSelf:!1},position:"middle",trigger:"on_play"},{id:"hate-2-delete-opponent",params:{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"any",calculation:"highest_value",owner:"opponent"},scope:{type:"anywhere"},excludeSelf:!1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[{id:"hate-3-reactive-draw",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"top",trigger:"after_delete",reactiveTriggerActor:"self"}],middleEffects:[],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[],bottomEffects:[{id:"hate-4-on-cover-delete",params:{action:"delete",count:1,targetFilter:{position:"covered_by_context",faceState:"any",calculation:"lowest_value"},scope:{type:"this_line"},excludeSelf:!1,autoExecute:!0},position:"bottom",trigger:"on_cover"}]},{value:5,topEffects:[],middleEffects:[{id:"hate-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],d1="Aux 1",fy={id:n1,name:a1,description:o1,author:r1,createdAt:l1,color:s1,pattern:i1,cards:c1,category:d1},u1="water_custom_1",p1="Water",f1="Wash away and renew. Custom protocol migration of original Water protocol.",h1="#5DADE2",m1="multi-radial",y1=[{value:0,topEffects:[],middleEffects:[{id:"water_0_flip_other",trigger:"immediate",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!0},optional:!1},position:"middle"},{id:"water_0_flip_self",trigger:"immediate",params:{action:"flip",flipSelf:!0},position:"middle"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"water_1_play",trigger:"immediate",params:{action:"play",source:"deck",count:1,faceDown:!0,destinationRule:{type:"each_other_line"}},position:"middle"}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"water_2_draw",trigger:"immediate",params:{action:"draw",count:2},position:"middle"},{id:"water_2_rearrange",trigger:"immediate",params:{action:"rearrange_protocols",target:"own"},position:"middle"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"water_3_return",trigger:"immediate",params:{action:"return",count:"all",targetFilter:{owner:"any",position:"uncovered",valueEquals:2},selectLane:!0},position:"middle"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"water_4_return",trigger:"immediate",params:{action:"return",count:1,targetFilter:{owner:"own",position:"uncovered"}},position:"middle"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"water_5_discard",trigger:"immediate",params:{action:"discard",count:1,actor:"self"},position:"middle"}],bottomEffects:[]}],g1="Main 1",hy={id:u1,name:p1,description:f1,color:h1,pattern:m1,cards:y1,category:g1},v1="spirit_custom_1",_1="Spirit",w1="True strength from within. Custom protocol migration of original Spirit protocol.",x1="#5DD9C1",C1="dual-radial",S1=[{value:0,topEffects:[],middleEffects:[{id:"spirit_0_refresh",trigger:"on_play",params:{action:"refresh",target:"self"},position:"middle"},{id:"spirit_0_draw",trigger:"on_play",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"middle"}],bottomEffects:[{id:"spirit_0_skip_cache",trigger:"passive",params:{action:"passive_rule",rule:{type:"skip_check_cache_phase",target:"self",scope:"global"}},position:"bottom"}]},{value:1,topEffects:[{id:"spirit_1_play_anywhere",trigger:"passive",params:{action:"passive_rule",rule:{type:"allow_any_protocol_play",target:"self",scope:"global"}},position:"top"}],middleEffects:[{id:"spirit_1_draw",trigger:"on_play",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"middle"}],bottomEffects:[{id:"spirit_1_choice",trigger:"start",params:{action:"choice",options:[{id:"spirit_1_choice_discard",trigger:"on_play",params:{action:"discard",count:1,actor:"self"},position:"bottom"},{id:"spirit_1_choice_flip",trigger:"on_play",params:{action:"flip",flipSelf:!0},position:"bottom"}]},position:"bottom"}]},{value:2,topEffects:[],middleEffects:[{id:"spirit_2_flip",trigger:"on_play",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1},optional:!0},position:"middle"}],bottomEffects:[]},{value:3,topEffects:[{id:"spirit_3_shift",trigger:"after_draw",reactiveTriggerActor:"self",params:{action:"shift",count:1,optional:!0,targetFilter:{owner:"own",position:"any",faceState:"any",excludeSelf:!1}},position:"top"}],middleEffects:[],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"spirit_4_swap",trigger:"on_play",params:{action:"swap_protocols",target:"own"},position:"middle"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"spirit_5_discard",trigger:"on_play",params:{action:"discard",count:1,actor:"self"},position:"middle"}],bottomEffects:[]}],b1="Main 1",my={id:v1,name:_1,description:w1,color:x1,pattern:C1,cards:S1,category:b1},E1="gravity_custom_1",j1="Gravity",k1="Pull everything together. Gravity draws cards towards this line.",T1="#7599EB",N1="grid",A1=[{value:0,topEffects:[],middleEffects:[{id:"gravity_0_play_per_2_cards",trigger:"on_play",params:{action:"play",source:"deck",count:1,faceDown:!0,destinationRule:{type:"under_this_card"},condition:{type:"per_x_cards_in_line",cardCount:2},actor:"self"},position:"middle"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"gravity_1_draw_2",trigger:"on_play",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"middle"},{id:"gravity_1_shift_to_or_from",trigger:"on_play",params:{action:"shift",targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1},destinationRestriction:{type:"to_or_from_this_lane",laneIndex:"current"}},position:"middle"}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"gravity_2_flip",trigger:"on_play",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1},optional:!1},position:"middle"},{id:"gravity_2_shift_to_this_line",trigger:"on_play",params:{action:"shift",targetFilter:{owner:"any",position:"any",faceState:"any",excludeSelf:!1},destinationRestriction:{type:"to_this_lane",laneIndex:"current"}},position:"middle",useCardFromPreviousEffect:!0}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"gravity_4_shift_face_down_to_this_line",trigger:"on_play",params:{action:"shift",targetFilter:{owner:"any",position:"uncovered",faceState:"face_down",excludeSelf:!1},destinationRestriction:{type:"to_this_lane",laneIndex:"current"}},position:"middle"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"gravity_5_discard",trigger:"on_play",params:{action:"discard",count:1,actor:"self"},position:"middle"}],bottomEffects:[]},{value:6,topEffects:[],middleEffects:[{id:"gravity_6_opponent_plays",trigger:"on_play",params:{action:"play",source:"deck",count:1,faceDown:!0,destinationRule:{type:"specific_lane",laneIndex:"current"},actor:"opponent"},position:"middle",comment:"Opponent plays top of their deck in this line"}],bottomEffects:[]}],R1="Main 1",yy={id:E1,name:j1,description:k1,color:T1,pattern:N1,cards:A1,category:R1},F1="life_custom_1",D1="Life",$1="Life begets more life. Play cards from your deck to grow your presence.",q1="#3CE076",I1="hexagons",L1=[{value:0,topEffects:[{id:"life_0_end_delete_if_covered",trigger:"end",position:"top",params:{action:"delete",deleteSelf:!0,advancedConditional:{type:"this_card_is_covered"}}}],middleEffects:[{id:"life_0_play_each_line_with_card",trigger:"on_play",position:"middle",params:{action:"play",source:"deck",count:1,faceDown:!0,destinationRule:{type:"each_line_with_card",ownerFilter:"own"},actor:"self"}}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"life_1_flip_1",trigger:"on_play",position:"middle",params:{action:"flip",count:1,optional:!1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1}}},{id:"life_1_flip_2",trigger:"on_play",position:"middle",params:{action:"flip",count:1,optional:!1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1}}}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"life_2_draw",trigger:"on_play",position:"middle",params:{action:"draw",count:1,target:"self",source:"own_deck"}},{id:"life_2_flip",trigger:"on_play",position:"middle",params:{action:"flip",count:1,optional:!0,targetFilter:{owner:"any",position:"uncovered",faceState:"face_down",excludeSelf:!1}}}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[],bottomEffects:[{id:"life_3_on_cover_play",trigger:"on_cover",position:"bottom",params:{action:"play",source:"deck",count:1,faceDown:!0,destinationRule:{type:"another_line",excludeCurrentLane:!0},actor:"self"}}]},{value:4,topEffects:[],middleEffects:[{id:"life_4_conditional_draw",trigger:"on_play",position:"middle",params:{action:"draw",count:1,target:"self",source:"own_deck",conditional:{type:"is_covering"}}}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"life_5_discard",trigger:"on_play",position:"middle",params:{action:"discard",count:1,actor:"self"}}],bottomEffects:[]}],P1="Main 1",gy={id:F1,name:D1,description:$1,color:q1,pattern:I1,cards:L1,category:P1},U1="light_custom_1",O1="Light",M1="Burn away the dark. Light protocol reveals and manipulates through illumination.",H1="System",V1="2025-11-14T00:00:00.000Z",z1="#F4D03F",B1="radial",G1=[{value:0,topEffects:[],middleEffects:[{id:"light-0-flip",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1},optional:!1},position:"middle",trigger:"on_play"},{id:"light-0-draw",params:{action:"draw",count:1,target:"self",source:"own_deck",countType:"equal_to_card_value"},position:"middle",trigger:"on_play",useCardFromPreviousEffect:!0}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[],bottomEffects:[{id:"light-1-draw",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"bottom",trigger:"end"}]},{value:2,topEffects:[],middleEffects:[{id:"light-2-draw",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"middle",trigger:"on_play"},{id:"light-2-reveal-board-card",params:{action:"reveal",source:"board",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"face_down"},optional:!0},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"light-3-shift-all",params:{action:"shift",count:"all",targetFilter:{owner:"any",position:"any",faceState:"face_down",excludeSelf:!1},destinationRestriction:{type:"to_another_line"},scope:"this_lane"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"light-4-reveal",params:{action:"reveal",source:"opponent_hand",count:-1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"light-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],Y1="Main 1",vy={id:U1,name:O1,description:M1,author:H1,createdAt:V1,color:z1,pattern:B1,cards:G1,category:Y1},W1="speed_custom_1",Q1="Speed",X1="Swift and adaptive. Custom protocol migration of original Speed protocol.",Z1="#33E6E6",K1="cross",J1=[{value:0,topEffects:[],middleEffects:[{id:"speed_0_play",trigger:"on_play",params:{action:"play",source:"hand",count:1},position:"middle"}],bottomEffects:[]},{value:1,topEffects:[{id:"speed_1_reactive_draw",trigger:"after_clear_cache",reactiveTriggerActor:"self",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"top"}],middleEffects:[{id:"speed_1_draw",trigger:"on_play",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"middle"}],bottomEffects:[]},{value:2,topEffects:[{id:"speed_2_before_compile",trigger:"before_compile_delete",params:{action:"shift",count:1,shiftSelf:!0,allowCoveredSelf:!0,targetFilter:{owner:"own",position:"any",faceState:"any"}},position:"top"}],middleEffects:[],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"speed_3_shift_other",trigger:"on_play",params:{action:"shift",count:1,targetFilter:{owner:"own",position:"uncovered",faceState:"any",excludeSelf:!0}},position:"middle"}],bottomEffects:[{id:"speed_3_end_shift",trigger:"end",params:{action:"shift",count:1,optional:!0,targetFilter:{owner:"own",position:"uncovered",faceState:"any"}},position:"bottom",conditional:{type:"if_executed",thenEffect:{id:"speed_3_flip_self",trigger:"on_play",params:{action:"flip",flipSelf:!0},position:"bottom"}}}]},{value:4,topEffects:[],middleEffects:[{id:"speed_4_shift_opponent",trigger:"on_play",params:{action:"shift",count:1,targetFilter:{owner:"opponent",position:"uncovered",faceState:"face_down"}},position:"middle"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"speed_5_discard",trigger:"on_play",params:{action:"discard",count:1,actor:"self"},position:"middle"}],bottomEffects:[]}],eS="Main 1",_y={id:W1,name:Q1,description:X1,color:Z1,pattern:K1,cards:J1,category:eS},tS="metal_custom_1",nS="Metal",aS="Unyielding defense. Custom protocol migration of original Metal protocol.",oS="#B0BEC5",rS="grid",lS=[{value:0,topEffects:[{id:"metal_0_reduce_opponent",trigger:"passive",params:{action:"value_modifier",modifier:{type:"add_to_total",value:-2,target:"opponent_total",scope:"this_lane"}},position:"top"}],middleEffects:[{id:"metal_0_flip",trigger:"on_play",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any"}},position:"middle"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"metal_1_draw",trigger:"on_play",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"middle"},{id:"metal_1_block_compile",trigger:"on_play",params:{action:"block_compile",target:"opponent"},position:"middle"}],bottomEffects:[]},{value:2,topEffects:[{id:"metal_2_block_face_down",trigger:"passive",params:{action:"passive_rule",rule:{type:"block_face_down_play",scope:"this_lane"}},position:"top"}],middleEffects:[],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"metal_3_draw",trigger:"on_play",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"middle"},{id:"metal_3_delete_lane",trigger:"on_play",params:{action:"delete_all_in_lane",laneCondition:{type:"min_cards",count:8},excludeCurrentLane:!0},position:"middle"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"metal_5_discard",trigger:"on_play",params:{action:"discard",count:1,actor:"self"},position:"middle"}],bottomEffects:[]},{value:6,topEffects:[{id:"metal_6_delete_on_cover_or_flip",trigger:"on_cover_or_flip",params:{action:"delete",deleteSelf:!0},position:"top"}],middleEffects:[],bottomEffects:[]}],sS="Main 1",wy={id:tS,name:nS,description:aS,color:oS,pattern:rS,cards:lS,category:sS},iS="plague-custom-001",cS="Plague",dS="Focused on forcing opponent discards and restricting their plays. Spread suffering.",uS="System Migration",pS="2025-11-26T00:00:00.000Z",fS="#8FBC3A",hS="dual-radial",mS=[{value:0,topEffects:[],middleEffects:[{id:"plague-0-opponent-discard",params:{action:"discard",count:1,actor:"opponent"},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"plague-0-block-play",params:{action:"passive_rule",rule:{type:"block_all_play",target:"opponent",scope:"this_lane"}},position:"bottom",trigger:"passive"}]},{value:1,topEffects:[{id:"plague-1-reactive-draw",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"top",trigger:"after_opponent_discard"}],middleEffects:[{id:"plague-1-opponent-discard",params:{action:"discard",count:1,actor:"opponent"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"plague-2-self-discard",params:{action:"discard",count:1,actor:"self",variableCount:!0},position:"middle",trigger:"on_play",conditional:{type:"then",thenEffect:{id:"plague-2-opponent-discard",params:{action:"discard",actor:"opponent",countType:"equal_to_discarded",countOffset:1},position:"middle",trigger:"on_play"}}}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"plague-3-flip-each-other",params:{action:"flip",count:"all",scope:{type:"anywhere"},targetFilter:{faceState:"face_up",owner:"any",position:"uncovered",excludeSelf:!0}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,text:{bottom:"<div><span class='emphasis'>End:</span> Your opponent deletes 1 of their face-down cards. You may flip this card.</div>"},topEffects:[],middleEffects:[],bottomEffects:[{id:"plague-4-opponent-delete",params:{action:"delete",count:1,targetFilter:{faceState:"face_down",owner:"opponent",position:"uncovered"},scope:{type:"anywhere"},actorChooses:"card_owner"},position:"bottom",trigger:"end"},{id:"plague-4-may-flip-self",params:{action:"flip",flipSelf:!0,optional:!0},position:"bottom",trigger:"end"}]},{value:5,topEffects:[],middleEffects:[{id:"plague-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],yS="Main 1",xy={id:iS,name:cS,description:dS,author:uS,createdAt:pS,color:fS,pattern:hS,cards:mS,category:yS},gS="love_custom_v1",vS="Love",_S="Custom Love protocol - hand manipulation, giving and taking cards",wS="System",xS="2025-01-08T00:00:00Z",CS="#f2a3d7",SS="radial",bS=[{value:1,topEffects:[],middleEffects:[{id:"love-1-draw-opponent-deck",params:{action:"draw",count:1,target:"self",source:"opponent_deck"},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"love-1-end-give",params:{action:"give",count:1,source:"own_hand",optional:!0},conditional:{type:"if_executed",thenEffect:{id:"love-1-end-draw",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"bottom",trigger:"on_play"}},position:"bottom",trigger:"end"}]},{value:2,topEffects:[],middleEffects:[{id:"love-2-opponent-draw",params:{action:"draw",count:1,target:"opponent"},position:"middle",trigger:"on_play"},{id:"love-2-refresh",params:{action:"refresh",target:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"love-3-take",params:{action:"take",count:1,random:!0},position:"middle",trigger:"on_play"},{id:"love-3-give",params:{action:"give",count:1,source:"own_hand",optional:!1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"love-4-reveal",params:{action:"reveal",count:1,source:"own_hand"},position:"middle",trigger:"on_play"},{id:"love-4-flip",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"love-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:6,topEffects:[],middleEffects:[{id:"love-6-opponent-draw",params:{action:"draw",count:2,target:"opponent"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],ES="Aux 1",Cy={id:gS,name:vS,description:_S,author:wS,createdAt:xS,color:CS,pattern:SS,cards:bS,category:ES},jS="psychic_custom_v1",kS="Psychic",TS="Custom Psychic protocol - mind control, discard, reveal, and protocol manipulation",NS="System",AS="2025-01-08T00:00:00Z",RS="#c78dd9",FS="radial",DS=[{value:0,topEffects:[],middleEffects:[{id:"psychic-0-draw",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"middle",trigger:"on_play"},{id:"psychic-0-opponent-discard",params:{action:"discard",count:2,actor:"opponent"},position:"middle",trigger:"on_play"},{id:"psychic-0-reveal-hand",params:{action:"reveal",source:"opponent_hand",count:-1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[{id:"psychic-1-force-face-down",params:{action:"passive_rule",rule:{type:"require_face_down_play",target:"opponent",scope:"global"}},position:"top",trigger:"passive"}],middleEffects:[],bottomEffects:[{id:"psychic-1-start-flip-self",params:{action:"flip",count:1,targetFilter:{owner:"self",position:"any",faceState:"any",excludeSelf:!1},flipSelf:!0},position:"bottom",trigger:"start"}]},{value:2,topEffects:[],middleEffects:[{id:"psychic-2-opponent-discard",params:{action:"discard",count:2,actor:"opponent"},position:"middle",trigger:"on_play"},{id:"psychic-2-rearrange",params:{action:"rearrange_protocols",target:"opponent"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"psychic-3-opponent-discard",params:{action:"discard",count:1,actor:"opponent"},position:"middle",trigger:"on_play"},{id:"psychic-3-shift-opponent",params:{action:"shift",targetFilter:{owner:"opponent",position:"uncovered",faceState:"any",excludeSelf:!1},destinationRestriction:{type:"any"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[],bottomEffects:[{id:"psychic-4-end-return",params:{action:"return",count:1,optional:!0,targetFilter:{owner:"opponent",position:"uncovered",faceState:"any",excludeSelf:!1}},conditional:{type:"if_executed",thenEffect:{id:"psychic-4-end-flip-self",params:{action:"flip",count:1,flipSelf:!0,targetFilter:{owner:"self",position:"any",faceState:"any",excludeSelf:!1}},position:"bottom",trigger:"end"}},position:"bottom",trigger:"end"}]},{value:5,topEffects:[],middleEffects:[{id:"psychic-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],$S="Main 1",Sy={id:jS,name:kS,description:TS,author:NS,createdAt:AS,color:RS,pattern:FS,cards:DS,category:$S},qS="smoke-custom-001",IS="Smoke",LS="Shroud your cards in mystery. Use face-down cards to gain value and control.",PS="System",US="2025-12-09T00:00:00.000Z",OS="#5A5A5A",MS="radial",HS=[{value:0,topEffects:[],middleEffects:[{id:"smoke-0-play-deck-each-facedown",params:{action:"play",source:"deck",count:1,faceDown:!0,destinationRule:{type:"each_line_with_card",cardFilter:{faceState:"face_down"}}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"smoke-1-flip-own",params:{action:"flip",count:1,targetFilter:{owner:"own",position:"uncovered",faceState:"any"},optional:!1},position:"middle",trigger:"on_play"},{id:"smoke-1-shift-that-card",params:{action:"shift",optional:!0,targetFilter:{owner:"own",position:"uncovered",faceState:"any"}},position:"middle",trigger:"on_play",useCardFromPreviousEffect:!0}],bottomEffects:[]},{value:2,topEffects:[{id:"smoke-2-value-per-facedown",params:{action:"value_modifier",modifier:{type:"add_per_condition",value:1,condition:"per_face_down_card",target:"own_total",scope:"this_lane"}},position:"top",trigger:"passive"}],middleEffects:[],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"smoke-3-play-hand-facedown-lane",params:{action:"play",source:"hand",count:1,faceDown:!0,destinationRule:{type:"line_with_matching_cards",cardFilter:{faceState:"face_down"}}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"smoke-4-shift-covered-facedown",params:{action:"shift",optional:!1,targetFilter:{owner:"any",position:"covered",faceState:"face_down"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"smoke-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],VS="Main 2",by={id:qS,name:IS,description:LS,author:PS,createdAt:US,color:OS,pattern:MS,cards:HS,category:VS},zS="clarity-custom-001",BS="Clarity",GS="See through the fog of war. Reveal your deck and hand to gain powerful advantages.",YS="System",WS="2025-12-09T00:00:00.000Z",QS="#87CEEB",XS="radial",ZS=[{value:0,topEffects:[{id:"clarity-0-value-per-hand",params:{action:"value_modifier",modifier:{type:"add_per_condition",value:1,condition:"per_card_in_hand",target:"own_total",scope:"this_lane"}},position:"top",trigger:"passive"}],middleEffects:[],bottomEffects:[]},{value:1,topEffects:[{id:"clarity-1-start-reveal-deck-top",params:{action:"reveal",source:"own_deck_top",count:1},position:"top",trigger:"start",conditional:{type:"optional",thenEffect:{id:"clarity-1-discard-revealed",params:{action:"discard",count:1,actor:"self",useCardFromPreviousEffect:!0}}}}],middleEffects:[{id:"clarity-1-middle-reveal-opponent-hand",params:{action:"reveal",source:"opponent_hand",count:-1},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"clarity-1-bottom-draw-3",params:{action:"draw",count:3,target:"self",source:"own_deck"},position:"bottom",trigger:"on_cover"}]},{value:2,topEffects:[],middleEffects:[{id:"clarity-2-reveal-deck",params:{action:"reveal",source:"own_deck",count:-1},position:"middle",trigger:"on_play"},{id:"clarity-2-draw-value-1",params:{action:"draw",count:1,target:"self",source:"own_deck",valueFilter:{equals:1},fromRevealed:!0},position:"middle",trigger:"on_play"},{id:"clarity-2-shuffle-deck",params:{action:"shuffle_deck"},position:"middle",trigger:"on_play"},{id:"clarity-2-play-value-1",params:{action:"play",source:"hand",count:1,valueFilter:{equals:1}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"clarity-3-reveal-deck",params:{action:"reveal",source:"own_deck",count:-1},position:"middle",trigger:"on_play"},{id:"clarity-3-draw-value-5",params:{action:"draw",count:1,target:"self",source:"own_deck",valueFilter:{equals:5},fromRevealed:!0},position:"middle",trigger:"on_play"},{id:"clarity-3-shuffle-deck",params:{action:"shuffle_deck"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"clarity-4-shuffle-trash",params:{action:"shuffle_trash",optional:!0},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"clarity-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],KS="Main 2",Ey={id:zS,name:BS,description:GS,author:YS,createdAt:WS,color:QS,pattern:XS,cards:ZS,category:KS},JS="corruption-custom-001",eb="Corruption",tb="Corrupt your opponents plans. Use discard synergies and manipulate the return mechanic.",nb="System",ab="2025-12-09T00:00:00.000Z",ob="#4A0080",rb="stripes",lb=[{value:0,topEffects:[{id:"corruption-0-start-flip",params:{action:"flip",count:1,scope:"this_lane",targetFilter:{owner:"own",position:"any",faceState:"face_up",excludeSelf:!0},optional:!1},position:"top",trigger:"start"}],middleEffects:[],bottomEffects:[{id:"corruption-0-play-opponent-side",params:{action:"passive_rule",rule:{type:"allow_play_on_opponent_side",target:"self",scope:"global"}},position:"bottom",trigger:"passive"}]},{value:1,topEffects:[],middleEffects:[{id:"corruption-1-return",params:{action:"return",count:1,targetFilter:{owner:"any",position:"uncovered"}},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"corruption-1-redirect-return",params:{action:"redirect_return_to_deck",faceDown:!0,targetOwner:"opponent"},position:"bottom",trigger:"when_card_returned"}]},{value:2,topEffects:[{id:"corruption-2-after-discard",params:{action:"discard",count:1,actor:"opponent"},position:"top",trigger:"after_discard",reactiveTriggerActor:"self"}],middleEffects:[{id:"corruption-2-draw",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"middle",trigger:"on_play"},{id:"corruption-2-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"corruption-3-flip-covered",params:{action:"flip",count:1,optional:!0,targetFilter:{owner:"any",position:"covered",faceState:"face_up",excludeSelf:!1}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"corruption-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:6,topEffects:[{id:"corruption-6-end-choice",params:{action:"choice",options:[{id:"corruption-6-choice-discard",params:{action:"discard",count:1,actor:"self"},position:"top",trigger:"end"},{id:"corruption-6-choice-delete-self",params:{action:"delete",deleteSelf:!0},position:"top",trigger:"end"}]},position:"top",trigger:"end"}],middleEffects:[],bottomEffects:[]}],sb="Main 2",jy={id:JS,name:eb,description:tb,author:nb,createdAt:ab,color:ob,pattern:rb,cards:lb,category:sb},ib="courage-custom-001",cb="Courage",db="Face challenges head-on. Gain power when outnumbered.",ub="System",pb="2025-12-10T00:00:00.000Z",fb="#D4AF37",hb="radial",mb=[{value:0,topEffects:[{id:"courage-0-start-draw",params:{action:"draw",count:1,advancedConditional:{type:"empty_hand"}},position:"top",trigger:"start"}],middleEffects:[{id:"courage-0-draw",params:{action:"draw",count:1},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"courage-0-end-discard",params:{action:"discard",count:1,optional:!0},position:"bottom",trigger:"end",conditional:{type:"if_executed",thenEffect:{id:"courage-0-opponent-discard",params:{action:"discard",count:1,actor:"opponent"},position:"bottom",trigger:"end"}}}]},{value:1,topEffects:[],middleEffects:[{id:"courage-1-delete",params:{action:"delete",count:1,targetFilter:{owner:"opponent",position:"uncovered"},selectLane:!0,laneCondition:{type:"opponent_higher_value"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"courage-2-draw",params:{action:"draw",count:1},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"courage-2-end-draw",params:{action:"draw",count:1,advancedConditional:{type:"opponent_higher_value_in_lane"}},position:"bottom",trigger:"end"}]},{value:3,topEffects:[],middleEffects:[],bottomEffects:[{id:"courage-3-shift",params:{action:"shift",shiftSelf:!0,optional:!0,destinationRestriction:{type:"opponent_highest_value_lane"}},position:"bottom",trigger:"end"}]},{value:5,topEffects:[],middleEffects:[{id:"courage-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:6,topEffects:[{id:"courage-6-flip",params:{action:"flip",flipSelf:!0,advancedConditional:{type:"opponent_higher_value_in_lane"}},position:"top",trigger:"end"}],middleEffects:[],bottomEffects:[]}],yb="Main 2",ky={id:ib,name:cb,description:db,author:ub,createdAt:pb,color:fb,pattern:hb,cards:mb,category:yb},gb="diversity-custom-001",vb="Diversity",_b="Embrace variety. The more different protocols on the field, the stronger your effects become.",wb="System",xb="2025-12-18T00:00:00.000Z",Cb="#FF6B6B",Sb="zigzag",bb=[{value:0,topEffects:[],middleEffects:[{id:"diversity-0-auto-compile",params:{action:"auto_compile",protocolCountConditional:{type:"unique_protocols_on_field",threshold:6}},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"diversity-0-play-non-protocol",params:{action:"play",source:"hand",count:1,excludeSourceProtocol:!0,optional:!0,destinationRule:{type:"specific_lane",laneIndex:"current"}},position:"bottom",trigger:"end"}]},{value:1,topEffects:[],middleEffects:[{id:"diversity-1-shift",params:{action:"shift",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any"}},position:"middle",trigger:"on_play"},{id:"diversity-1-draw-protocols",params:{action:"draw",countType:"equal_to_unique_protocols_in_lane",target:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[{id:"diversity-3-value-modifier",params:{action:"value_modifier",modifier:{type:"add_to_total",value:2,target:"own_total",scope:"this_lane",condition:"has_non_own_protocol_face_up"}},position:"top",trigger:"passive"}],middleEffects:[],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"diversity-4-flip-dynamic",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1,valueLessThanUniqueProtocolsOnField:!0}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"diversity-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:6,topEffects:[{id:"diversity-6-conditional-delete",params:{action:"delete",deleteSelf:!0,protocolCountConditional:{type:"unique_protocols_on_field_below",threshold:3}},position:"top",trigger:"end"}],middleEffects:[],bottomEffects:[]}],Eb="Aux 2",Ty={id:gb,name:vb,description:_b,author:wb,createdAt:xb,color:Cb,pattern:Sb,cards:bb,category:Eb},jb="fear_custom",kb="Fear",Tb="Terror and disruption protocol - Control through fear",Nb="System",Ab="2025-01-10T00:00:00Z",Rb="#800020",Fb="radial",Db="Main 2",$b=[{value:0,topEffects:[{id:"fear-0-passive",params:{action:"passive_rule",rule:{type:"ignore_middle_commands",target:"opponent",scope:"global",onlyDuringYourTurn:!0}},position:"top",trigger:"passive"}],middleEffects:[{id:"fear-0-choice",params:{action:"choice",options:[{id:"fear-0-shift",params:{action:"shift",targetFilter:{owner:"any",position:"uncovered",faceState:"any"}},position:"middle",trigger:"on_play"},{id:"fear-0-flip",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1},optional:!1},position:"middle",trigger:"on_play"}]},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"fear-1-draw",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"middle",trigger:"on_play",conditional:{type:"then",thenEffect:{id:"fear-1-opponent-discard-hand",params:{action:"discard",count:"all",actor:"opponent"},position:"middle",trigger:"on_play",conditional:{type:"then",thenEffect:{id:"fear-1-opponent-draw",params:{action:"draw",countType:"equal_to_discarded",countOffset:-1,target:"opponent"},position:"middle",trigger:"on_play"}}}}}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"fear-2-return",params:{action:"return",count:1,targetFilter:{owner:"opponent"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"fear-3-shift",params:{action:"shift",targetFilter:{owner:"opponent",position:"any",faceState:"any"},scope:"this_lane"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"fear-4-discard-random",params:{action:"discard",count:1,actor:"opponent",random:!0},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"fear-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],Ny={id:jb,name:kb,description:Tb,author:Nb,createdAt:Ab,color:Rb,pattern:Fb,category:Db,cards:$b},qb="ice_custom",Ib="Ice",Lb="Control and disruption through shifting and conditional effects",Pb="System",Ub="2025-12-10T00:00:00Z",Ob="#B0E0E6",Mb="radial",Hb="Main 2",Vb=[{value:1,topEffects:[],middleEffects:[{id:"ice-1-shift",params:{action:"shift",shiftSelf:!0,optional:!0},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"ice-1-reactive",params:{action:"discard",actor:"opponent",count:1},position:"bottom",trigger:"after_play",reactiveTriggerActor:"opponent",reactiveScope:"this_lane"}]},{value:2,topEffects:[],middleEffects:[{id:"ice-2-shift",params:{action:"shift",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!0}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[{id:"ice-3-end-shift",params:{action:"shift",shiftSelf:!0,optional:!0,advancedConditional:{type:"this_card_is_covered"}},position:"top",trigger:"end"}],middleEffects:[],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[],bottomEffects:[{id:"ice-4-passive",params:{action:"passive_rule",rule:{type:"block_flip_this_card",target:"this_card",scope:"this_card"}},position:"bottom",trigger:"passive"}]},{value:5,topEffects:[],middleEffects:[{id:"ice-5-discard",params:{action:"discard",actor:"self",count:1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:6,topEffects:[{id:"ice-6-passive",params:{action:"passive_rule",rule:{type:"block_draw_conditional",conditionTarget:"self",blockTarget:"self",scope:"global"}},position:"top",trigger:"passive"}],middleEffects:[],bottomEffects:[]}],Ay={id:qb,name:Ib,description:Lb,author:Pb,createdAt:Ub,color:Ob,pattern:Mb,category:Hb,cards:Vb},zb="luck-custom-001",Bb="Luck",Gb="Gamble with fate. State numbers and protocols to manipulate the top of decks.",Yb="System",Wb="2025-01-15T00:00:00.000Z",Qb="#FFD700",Xb="chaos",Zb=[{value:0,topEffects:[],middleEffects:[{id:"luck-0-state-number",params:{action:"state_number",numberSource:"own_protocol_values"},position:"middle",trigger:"on_play"},{id:"luck-0-draw-and-reveal",params:{action:"draw",count:3,target:"self",source:"own_deck",revealFromDrawn:{valueSource:"stated_number",thenAction:"may_play"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"luck-1-play-deck-top",params:{action:"play",source:"deck",count:1,faceDown:!0,destinationRule:{type:"another_line"}},position:"middle",trigger:"on_play",conditional:{type:"then",thenEffect:{id:"luck-1-flip-skip-middle",params:{action:"flip",skipMiddleCommand:!0},useCardFromPreviousEffect:!0}}}],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[{id:"luck-2-discard-deck-top",params:{action:"discard",source:"top_deck_own",count:1},position:"middle",trigger:"on_play",conditional:{type:"then",thenEffect:{id:"luck-2-draw-equal-value",params:{action:"draw",countType:"equal_to_card_value",target:"self",source:"own_deck"},useCardFromPreviousEffect:!0}}}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"luck-3-state-protocol",params:{action:"state_protocol",protocolSource:"opponent_cards"},position:"middle",trigger:"on_play"},{id:"luck-3-discard-opponent-deck",params:{action:"discard",source:"top_deck_opponent",count:1},position:"middle",trigger:"on_play",conditional:{type:"if_protocol_matches_stated",thenEffect:{id:"luck-3-delete",params:{action:"delete",count:1}}}}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"luck-4-discard-deck-top",params:{action:"discard",source:"top_deck_own",count:1},position:"middle",trigger:"on_play",conditional:{type:"then",thenEffect:{id:"luck-4-delete-same-value",params:{action:"delete",count:1,targetFilter:{position:"any",valueSource:"previous_effect_card"}}}}}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"luck-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],Kb="Main 2",Ry={id:zb,name:Bb,description:Gb,author:Yb,createdAt:Wb,color:Qb,pattern:Xb,cards:Zb,category:Kb},Jb="mirror-custom-001",eE="Mirror",tE="Copy, symmetry, and reflection. Mirror your opponent's actions.",nE="System",aE="2025-01-15T00:00:00.000Z",oE="#C0C0C0",rE="radial",lE="Main 2",sE=[{value:0,topEffects:[{id:"mirror-0-value-modifier",params:{action:"value_modifier",modifier:{type:"add_per_condition",value:1,condition:"per_opponent_card_in_lane",target:"own_total",scope:"this_lane"}},position:"top",trigger:"passive"}],middleEffects:[],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[],bottomEffects:[{id:"mirror-1-copy-middle",params:{action:"copy_opponent_middle",optional:!0},position:"bottom",trigger:"end"}]},{value:2,topEffects:[],middleEffects:[{id:"mirror-2-swap-stacks",params:{action:"swap_stacks",target:"own"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"mirror-3-flip-own",params:{action:"flip",count:1,targetFilter:{owner:"own",position:"uncovered",faceState:"any",excludeSelf:!0},optional:!1},position:"middle",trigger:"on_play",conditional:{type:"then",thenEffect:{id:"mirror-3-flip-opponent-same-lane",params:{action:"flip",count:1,targetFilter:{owner:"opponent",position:"uncovered",faceState:"any"},sameLaneAsFirst:!0,optional:!1},position:"middle",trigger:"on_play"}}}],bottomEffects:[]},{value:4,topEffects:[{id:"mirror-4-after-opponent-draw",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"top",trigger:"after_opponent_draw"}],middleEffects:[],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"mirror-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],Fy={id:Jb,name:eE,description:tE,author:nE,createdAt:aE,color:oE,pattern:rE,category:lE,cards:sE},iE="peace-custom-001",cE="Peace",dE="Harmony and balance. Sacrifice to achieve equilibrium.",uE="System",pE="2025-01-16T00:00:00.000Z",fE="#87CEEB",hE="radial",mE="Main 2",yE=[{value:1,topEffects:[],middleEffects:[{id:"peace-1-both-discard",params:{action:"discard",actor:"both",count:"all"},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"peace-1-end-draw",params:{action:"draw",count:1,target:"self",source:"own_deck",advancedConditional:{type:"empty_hand"}},position:"bottom",trigger:"end"}]},{value:2,topEffects:[],middleEffects:[{id:"peace-2-draw",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"middle",trigger:"on_play"},{id:"peace-2-play",params:{action:"play",source:"hand",count:1,faceDown:!0},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"peace-3-discard-flip",params:{action:"discard",actor:"self",count:1},position:"middle",trigger:"on_play",optional:!0,conditional:{type:"if_executed",thenEffect:{id:"peace-3-flip",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1,valueMinGreaterThanHandSize:!0},optional:!1},position:"middle",trigger:"on_play"}}}],bottomEffects:[]},{value:4,topEffects:[{id:"peace-4-reactive-draw",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"top",trigger:"after_discard",reactiveTriggerActor:"self",onlyDuringOpponentTurn:!0}],middleEffects:[],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"peace-5-discard",params:{action:"discard",actor:"self",count:1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:6,topEffects:[],middleEffects:[{id:"peace-6-flip-self",params:{action:"flip",count:1,flipSelf:!0,advancedConditional:{type:"hand_size_greater_than",threshold:1}},position:"middle",trigger:"on_play"}],bottomEffects:[]}],Dy={id:iE,name:cE,description:dE,author:uE,createdAt:pE,color:fE,pattern:hE,category:mE,cards:yE},gE="time-custom-001",vE="Time",_E="Manipulate time through your trash and deck. Recycle discarded cards and control the flow of battle.",wE="System",xE="2025-12-17T00:00:00.000Z",CE="#8B4513",SE="hexagons",bE=[{value:0,topEffects:[],middleEffects:[{id:"time-0-play-from-trash",params:{action:"play",source:"trash",count:1},position:"middle",trigger:"on_play"},{id:"time-0-shuffle-trash",params:{action:"shuffle_trash",optional:!1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[{id:"time-1-flip-covered",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"covered",faceState:"any",excludeSelf:!1},optional:!1},position:"middle",trigger:"on_play"},{id:"time-1-discard-entire-deck",params:{action:"discard",count:1,actor:"self",source:"entire_deck"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:2,topEffects:[{id:"time-2-after-shuffle-draw",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"top",trigger:"after_shuffle",reactiveTriggerActor:"self",conditional:{type:"then",thenEffect:{id:"time-2-then-shift-self",params:{action:"shift",targetFilter:{owner:"own"},shiftSelf:!0,optional:!0}}}}],middleEffects:[{id:"time-2-conditional-shuffle-trash",params:{action:"shuffle_trash",optional:!0,advancedConditional:{type:"trash_not_empty"}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"time-3-reveal-from-trash",params:{action:"reveal",source:"own_trash",count:1},position:"middle",trigger:"on_play",conditional:{type:"if_executed",thenEffect:{id:"time-3-play-face-down",params:{action:"play",source:"trash",count:1,faceDown:!0,destinationRule:{type:"other_lines"}},useCardFromPreviousEffect:!0}}}],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[{id:"time-4-draw-2",params:{action:"draw",count:2,target:"self",source:"own_deck"},position:"middle",trigger:"on_play"},{id:"time-4-discard-2",params:{action:"discard",count:2,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"time-5-discard-1",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],EE="Main 2",$y={id:gE,name:vE,description:_E,author:wE,createdAt:xE,color:CE,pattern:SE,cards:bE,category:EE},jE="unity-custom-001",kE="Unity",TE="Strength in unity. Unity cards synergize with each other - effects become stronger with more face-up Unity cards on the field.",NE="System",AE="2025-12-18T00:00:00.000Z",RE="#4CAF50",FE="hexagons",DE=[{value:0,topEffects:[],middleEffects:[{id:"unity-0-choice",params:{action:"choice",advancedConditional:{type:"same_protocol_on_field"},options:[{id:"unity-0-choice-flip",trigger:"on_play",params:{action:"flip",count:1,optional:!0,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1}},position:"middle"},{id:"unity-0-choice-draw",trigger:"on_play",params:{action:"draw",count:1,target:"self"},position:"middle"}]},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"unity-0-on-cover-choice",params:{action:"choice",options:[{id:"unity-0-cover-choice-flip",trigger:"on_cover",params:{action:"flip",count:1,optional:!1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1}},position:"bottom"},{id:"unity-0-cover-choice-draw",trigger:"on_cover",params:{action:"draw",count:1,target:"self"},position:"bottom"}]},position:"bottom",trigger:"on_cover",onCoverProtocolRestriction:"same_protocol"}]},{value:1,topEffects:[{id:"unity-1-shift-if-covered",params:{action:"shift",shiftSelf:!0,optional:!0,advancedConditional:{type:"this_card_is_covered"}},position:"top",trigger:"start"}],middleEffects:[{id:"unity-1-auto-compile",params:{action:"auto_compile",protocolCountConditional:{type:"same_protocol_count_on_field",threshold:5,faceState:"face_up"},deleteAllInLane:!0},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"unity-1-face-up-play",params:{action:"passive_rule",rule:{type:"allow_same_protocol_face_up_play",scope:"this_lane",protocolScope:"same_as_source"}},position:"bottom",trigger:"passive"}]},{value:2,topEffects:[],middleEffects:[{id:"unity-2-draw-count",params:{action:"draw",countType:"count_own_protocol_cards_on_field",target:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[{id:"unity-3-conditional-flip",params:{action:"flip",count:1,optional:!0,advancedConditional:{type:"same_protocol_on_field"},targetFilter:{owner:"any",position:"uncovered",faceState:"face_up",excludeSelf:!1}},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:4,topEffects:[{id:"unity-4-draw-all-protocol",params:{action:"draw",advancedConditional:{type:"empty_hand"},protocolFilter:{type:"same_as_source"},revealDeck:!0,shuffleAfter:!0,target:"self"},position:"top",trigger:"start"}],middleEffects:[],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"unity-5-discard",params:{action:"discard",count:1,actor:"self"},position:"middle",trigger:"on_play"}],bottomEffects:[]}],$E="Aux 2",qy={id:jE,name:kE,description:TE,author:NE,createdAt:AE,color:RE,pattern:FE,cards:DE,category:$E},qE="war-custom-001",IE="War",LE="CONFLICT, AGGRESSION - Punishes opponent actions with reactive effects",PE="System",UE="2025-01-01T00:00:00.000Z",OE="#8B0000",ME="grid",HE="Main 2",VE=[{value:0,topEffects:[{id:"war-0-top-flip-self",params:{action:"flip",flipSelf:!0,optional:!0},position:"top",trigger:"after_refresh"}],middleEffects:[],bottomEffects:[{id:"war-0-bottom-delete",params:{action:"delete",count:1,optional:!0,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1},scope:{type:"anywhere"}},position:"bottom",trigger:"after_opponent_draw"}]},{value:1,topEffects:[],middleEffects:[],bottomEffects:[{id:"war-1-discard-refresh",params:{action:"discard",actor:"self",variableCount:!0},position:"bottom",trigger:"after_opponent_refresh",conditional:{type:"then",thenEffect:{id:"war-1-refresh",params:{action:"refresh",target:"self"},position:"bottom",trigger:"after_opponent_refresh"}}}]},{value:2,topEffects:[],middleEffects:[{id:"war-2-flip",params:{action:"flip",count:1,targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1}},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"war-2-opponent-discard-all",params:{action:"discard",actor:"opponent",count:"all"},position:"bottom",trigger:"after_opponent_compile"}]},{value:3,topEffects:[],middleEffects:[{id:"war-3-draw",params:{action:"draw",count:1,target:"self",source:"own_deck"},position:"middle",trigger:"on_play"}],bottomEffects:[{id:"war-3-play-facedown",params:{action:"play",source:"hand",count:1,faceDown:!0,optional:!0,destinationRule:{type:"other_lines"}},position:"bottom",trigger:"after_opponent_discard"}]},{value:4,topEffects:[],middleEffects:[{id:"war-4-opponent-discard",params:{action:"discard",actor:"opponent",count:1},position:"middle",trigger:"on_play"}],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[{id:"war-5-self-discard",params:{action:"discard",actor:"self",count:1},position:"middle",trigger:"on_play"}],bottomEffects:[]}],Iy={id:qE,name:IE,description:LE,author:PE,createdAt:UE,color:OE,pattern:ME,category:HE,cards:VE};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const zE=[ry,ly,sy,iy,cy,dy,Ty,uy,py,fy,hy,my,yy,gy,vy,_y,wy,xy,Cy,Sy,by,Ey,jy,ky,Ny,Ay,Ry,Fy,Dy,$y,qy,Iy],BE=()=>zE.map(t=>t.name.replace(/_custom$/i,"")),GE=()=>{try{const t=yr(),n=t.findIndex(r=>r.id==="dark_cust_v2"||r.name==="Dark_cust");n>=0&&(t.splice(n,1),nu(t)),yt(ry),yt(ly),yt(sy),yt(cy),yt(dy),yt(uy),yt(hy),yt(my),yt(iy),yt(yy),yt(py),yt(fy),yt(gy),yt(vy),yt(_y),yt(wy),yt(xy),yt(Cy),yt(Sy),yt(by),yt(Ey),yt(jy),yt(ky),yt(Ty),yt(Ny),yt(Ay),yt(Ry),yt(Fy),yt(Dy),yt($y),yt(qy),yt(Iy)}catch(t){console.error("[Default Protocols] Error loading default protocols:",t)}};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const gu="compile_game_statistics",Ly=()=>{const t=I0,n=BE(),r=new Set([...t,...n]);return Array.from(r).sort()},Py=1;function Nm(){const t=Ly(),n={};return t.forEach(r=>{n[r]={timesUsed:0,wins:0,losses:0}}),{version:Py,global:{totalGamesPlayed:0,totalGamesWon:0,totalGamesLost:0,totalPlaytime:0,fastestWin:null,longestGame:null,lastGameDuration:null,currentStreak:0,longestWinStreak:0,longestLoseStreak:0},protocols:n,aiDifficulty:{easy:{played:0,wins:0,losses:0},normal:{played:0,wins:0,losses:0},hard:{played:0,wins:0,losses:0}},cards:{played:{},deleted:{}},actions:{totalCardsDrawn:0,totalCardsPlayed:0,totalShifts:0,totalDeletes:0,totalDiscards:0,totalFlips:0,totalCompiles:0,totalRefreshes:0,totalReturns:0,detailedStats:{cardsPlayed:{total:0,player:0,ai:0,playerFromHand:0,playerFromEffect:0,aiFromHand:0,aiFromEffect:0,playerFaceUp:0,playerFaceDown:0,aiFaceUp:0,aiFaceDown:0},cardsDrawn:{total:0,player:0,ai:0,playerFromRefresh:0,playerFromEffect:0,aiFromRefresh:0,aiFromEffect:0},discards:{total:0,player:0,ai:0},deletes:{total:0,player:0,ai:0},flips:{total:0,player:0,ai:0},shifts:{total:0,player:0,ai:0},returns:{total:0,player:0,ai:0},compiles:{total:0,player:0,ai:0,playerFirstCompile:0,playerRecompile:0,aiFirstCompile:0,aiRecompile:0},refreshes:{total:0,player:0,ai:0,playerCardsDrawn:0,aiCardsDrawn:0}}},control:{gamesWithControl:0,gamesWithoutControl:0,playerRearranges:0,aiRearranges:0,totalRearranges:0},coinFlip:{headsChosen:0,tailsChosen:0,headsWon:0,tailsWon:0}}}function eu(){var t,n,r,i,s,d,u,p,f,h,w,g,y,m,x,S,E,j,b,k,N,U,V,R,O,X,M,$,B,I,D,L,T,q,P,Z,G,A,W,J,Q,ee,oe,me,ke,xe,ie,K,z,le,ne,ue,ce,Se,De,be,Ge,Be,Me,He,je,Re,Ie,Ve,it,nt,Rt,Zt,nn,an,Lt,hn,Pt,fa,ha,Ma,Ln,Zn,En,Ht,mn,Pn,Ha,ka,ma,Un,Ta,Kn,Na,Aa,ya,ga,Ra,va,yn,Dt,Ut,jn,_a,Va,Fa,wa,kn,Jn,_n,wn,Tn,xn,Nt,xa,Ca,gn,Cn,he,Fe,Pe,ge,ve,Te,Le,Oe,Je,Qe,Xe,gt,Ct,St,on,Bo,io,za,ea,co,uo,ta,Vt,Go,Yo,po,vr,_r,Ba,Nn,Sa,Ft,Kt,Jt;try{const Wo=localStorage.getItem(gu);if(!Wo)return Nm();const Ue=JSON.parse(Wo),ss=Ly(),Da={...Ue.protocols||{}};ss.forEach(fo=>{Da[fo]||(Da[fo]={timesUsed:0,wins:0,losses:0})});const na={...Ue,version:Py,global:{...Ue.global,lastGameDuration:((t=Ue.global)==null?void 0:t.lastGameDuration)||null},protocols:Da,control:{gamesWithControl:((n=Ue.control)==null?void 0:n.gamesWithControl)||0,gamesWithoutControl:((r=Ue.control)==null?void 0:r.gamesWithoutControl)||0,playerRearranges:((i=Ue.control)==null?void 0:i.playerRearranges)||0,aiRearranges:((s=Ue.control)==null?void 0:s.aiRearranges)||0,totalRearranges:((d=Ue.control)==null?void 0:d.totalRearranges)||0},coinFlip:Ue.coinFlip||{headsChosen:0,tailsChosen:0,headsWon:0,tailsWon:0},actions:{...Ue.actions,totalCompiles:((u=Ue.actions)==null?void 0:u.totalCompiles)||0,totalRefreshes:((p=Ue.actions)==null?void 0:p.totalRefreshes)||0,totalReturns:((f=Ue.actions)==null?void 0:f.totalReturns)||0,detailedStats:{cardsPlayed:{total:((g=(w=(h=Ue.actions)==null?void 0:h.detailedStats)==null?void 0:w.cardsPlayed)==null?void 0:g.total)||0,player:((x=(m=(y=Ue.actions)==null?void 0:y.detailedStats)==null?void 0:m.cardsPlayed)==null?void 0:x.player)||0,ai:((j=(E=(S=Ue.actions)==null?void 0:S.detailedStats)==null?void 0:E.cardsPlayed)==null?void 0:j.ai)||0,playerFromHand:((N=(k=(b=Ue.actions)==null?void 0:b.detailedStats)==null?void 0:k.cardsPlayed)==null?void 0:N.playerFromHand)||0,playerFromEffect:((R=(V=(U=Ue.actions)==null?void 0:U.detailedStats)==null?void 0:V.cardsPlayed)==null?void 0:R.playerFromEffect)||0,aiFromHand:((M=(X=(O=Ue.actions)==null?void 0:O.detailedStats)==null?void 0:X.cardsPlayed)==null?void 0:M.aiFromHand)||0,aiFromEffect:((I=(B=($=Ue.actions)==null?void 0:$.detailedStats)==null?void 0:B.cardsPlayed)==null?void 0:I.aiFromEffect)||0,playerFaceUp:((T=(L=(D=Ue.actions)==null?void 0:D.detailedStats)==null?void 0:L.cardsPlayed)==null?void 0:T.playerFaceUp)||0,playerFaceDown:((Z=(P=(q=Ue.actions)==null?void 0:q.detailedStats)==null?void 0:P.cardsPlayed)==null?void 0:Z.playerFaceDown)||0,aiFaceUp:((W=(A=(G=Ue.actions)==null?void 0:G.detailedStats)==null?void 0:A.cardsPlayed)==null?void 0:W.aiFaceUp)||0,aiFaceDown:((ee=(Q=(J=Ue.actions)==null?void 0:J.detailedStats)==null?void 0:Q.cardsPlayed)==null?void 0:ee.aiFaceDown)||0},cardsDrawn:{total:((ke=(me=(oe=Ue.actions)==null?void 0:oe.detailedStats)==null?void 0:me.cardsDrawn)==null?void 0:ke.total)||0,player:((K=(ie=(xe=Ue.actions)==null?void 0:xe.detailedStats)==null?void 0:ie.cardsDrawn)==null?void 0:K.player)||0,ai:((ne=(le=(z=Ue.actions)==null?void 0:z.detailedStats)==null?void 0:le.cardsDrawn)==null?void 0:ne.ai)||0,playerFromRefresh:((Se=(ce=(ue=Ue.actions)==null?void 0:ue.detailedStats)==null?void 0:ce.cardsDrawn)==null?void 0:Se.playerFromRefresh)||0,playerFromEffect:((Ge=(be=(De=Ue.actions)==null?void 0:De.detailedStats)==null?void 0:be.cardsDrawn)==null?void 0:Ge.playerFromEffect)||0,aiFromRefresh:((He=(Me=(Be=Ue.actions)==null?void 0:Be.detailedStats)==null?void 0:Me.cardsDrawn)==null?void 0:He.aiFromRefresh)||0,aiFromEffect:((Ie=(Re=(je=Ue.actions)==null?void 0:je.detailedStats)==null?void 0:Re.cardsDrawn)==null?void 0:Ie.aiFromEffect)||0},discards:{total:((nt=(it=(Ve=Ue.actions)==null?void 0:Ve.detailedStats)==null?void 0:it.discards)==null?void 0:nt.total)||0,player:((nn=(Zt=(Rt=Ue.actions)==null?void 0:Rt.detailedStats)==null?void 0:Zt.discards)==null?void 0:nn.player)||0,ai:((hn=(Lt=(an=Ue.actions)==null?void 0:an.detailedStats)==null?void 0:Lt.discards)==null?void 0:hn.ai)||0},deletes:{total:((ha=(fa=(Pt=Ue.actions)==null?void 0:Pt.detailedStats)==null?void 0:fa.deletes)==null?void 0:ha.total)||0,player:((Zn=(Ln=(Ma=Ue.actions)==null?void 0:Ma.detailedStats)==null?void 0:Ln.deletes)==null?void 0:Zn.player)||0,ai:((mn=(Ht=(En=Ue.actions)==null?void 0:En.detailedStats)==null?void 0:Ht.deletes)==null?void 0:mn.ai)||0},flips:{total:((ka=(Ha=(Pn=Ue.actions)==null?void 0:Pn.detailedStats)==null?void 0:Ha.flips)==null?void 0:ka.total)||0,player:((Ta=(Un=(ma=Ue.actions)==null?void 0:ma.detailedStats)==null?void 0:Un.flips)==null?void 0:Ta.player)||0,ai:((Aa=(Na=(Kn=Ue.actions)==null?void 0:Kn.detailedStats)==null?void 0:Na.flips)==null?void 0:Aa.ai)||0},shifts:{total:((Ra=(ga=(ya=Ue.actions)==null?void 0:ya.detailedStats)==null?void 0:ga.shifts)==null?void 0:Ra.total)||0,player:((Dt=(yn=(va=Ue.actions)==null?void 0:va.detailedStats)==null?void 0:yn.shifts)==null?void 0:Dt.player)||0,ai:((_a=(jn=(Ut=Ue.actions)==null?void 0:Ut.detailedStats)==null?void 0:jn.shifts)==null?void 0:_a.ai)||0},returns:{total:((wa=(Fa=(Va=Ue.actions)==null?void 0:Va.detailedStats)==null?void 0:Fa.returns)==null?void 0:wa.total)||0,player:((_n=(Jn=(kn=Ue.actions)==null?void 0:kn.detailedStats)==null?void 0:Jn.returns)==null?void 0:_n.player)||0,ai:((xn=(Tn=(wn=Ue.actions)==null?void 0:wn.detailedStats)==null?void 0:Tn.returns)==null?void 0:xn.ai)||0},compiles:{total:((Ca=(xa=(Nt=Ue.actions)==null?void 0:Nt.detailedStats)==null?void 0:xa.compiles)==null?void 0:Ca.total)||0,player:((he=(Cn=(gn=Ue.actions)==null?void 0:gn.detailedStats)==null?void 0:Cn.compiles)==null?void 0:he.player)||0,ai:((ge=(Pe=(Fe=Ue.actions)==null?void 0:Fe.detailedStats)==null?void 0:Pe.compiles)==null?void 0:ge.ai)||0,playerFirstCompile:((Le=(Te=(ve=Ue.actions)==null?void 0:ve.detailedStats)==null?void 0:Te.compiles)==null?void 0:Le.playerFirstCompile)||0,playerRecompile:((Qe=(Je=(Oe=Ue.actions)==null?void 0:Oe.detailedStats)==null?void 0:Je.compiles)==null?void 0:Qe.playerRecompile)||0,aiFirstCompile:((Ct=(gt=(Xe=Ue.actions)==null?void 0:Xe.detailedStats)==null?void 0:gt.compiles)==null?void 0:Ct.aiFirstCompile)||0,aiRecompile:((Bo=(on=(St=Ue.actions)==null?void 0:St.detailedStats)==null?void 0:on.compiles)==null?void 0:Bo.aiRecompile)||0},refreshes:{total:((ea=(za=(io=Ue.actions)==null?void 0:io.detailedStats)==null?void 0:za.refreshes)==null?void 0:ea.total)||0,player:((ta=(uo=(co=Ue.actions)==null?void 0:co.detailedStats)==null?void 0:uo.refreshes)==null?void 0:ta.player)||0,ai:((Yo=(Go=(Vt=Ue.actions)==null?void 0:Vt.detailedStats)==null?void 0:Go.refreshes)==null?void 0:Yo.ai)||0,playerCardsDrawn:((_r=(vr=(po=Ue.actions)==null?void 0:po.detailedStats)==null?void 0:vr.refreshes)==null?void 0:_r.playerCardsDrawn)||0,aiCardsDrawn:((Sa=(Nn=(Ba=Ue.actions)==null?void 0:Ba.detailedStats)==null?void 0:Nn.refreshes)==null?void 0:Sa.aiCardsDrawn)||0}}}};return(!((Ft=Ue.control)!=null&&Ft.playerRearranges)||!Ue.coinFlip||!((Kt=Ue.actions)!=null&&Kt.totalCompiles)||!((Jt=Ue.actions)!=null&&Jt.detailedStats)||Object.keys(Da).length!==Object.keys(Ue.protocols||{}).length)&&el(na),na}catch(Wo){return console.error("Failed to load statistics:",Wo),Nm()}}function el(t){try{localStorage.setItem(gu,JSON.stringify(t))}catch(n){console.error("Failed to save statistics:",n)}}function YE(){try{localStorage.removeItem(gu)}catch(t){console.error("Failed to reset statistics:",t)}}function WE(t,n,r,i,s,d=!1,u,p,f,h){const w=n==="player",g={...t.global},y={...t.protocols},m={easy:{...t.aiDifficulty.easy},normal:{...t.aiDifficulty.normal},hard:{...t.aiDifficulty.hard}},x={...t.control},S={...t.actions},E={...t.coinFlip},j={played:{...t.cards.played},deleted:{...t.cards.deleted}};g.totalGamesPlayed++,w?g.totalGamesWon++:g.totalGamesLost++,g.totalPlaytime+=s,w&&(g.fastestWin===null||s<g.fastestWin)&&(g.fastestWin=s),(g.longestGame===null||s>g.longestGame)&&(g.longestGame=s),g.lastGameDuration=s,w?(g.currentStreak>=0?g.currentStreak++:g.currentStreak=1,g.currentStreak>g.longestWinStreak&&(g.longestWinStreak=g.currentStreak)):(g.currentStreak<=0?g.currentStreak--:g.currentStreak=-1,Math.abs(g.currentStreak)>g.longestLoseStreak&&(g.longestLoseStreak=Math.abs(g.currentStreak))),r.forEach(k=>{y[k]?y[k]={...y[k]}:y[k]={timesUsed:0,wins:0,losses:0},y[k].timesUsed++,w?y[k].wins++:y[k].losses++}),m[i].played++,w?m[i].wins++:m[i].losses++,d?x.gamesWithControl++:x.gamesWithoutControl++;const b={cardsPlayed:{...t.actions.detailedStats.cardsPlayed},cardsDrawn:{...t.actions.detailedStats.cardsDrawn},discards:{...t.actions.detailedStats.discards},deletes:{...t.actions.detailedStats.deletes},flips:{...t.actions.detailedStats.flips},shifts:{...t.actions.detailedStats.shifts},returns:{...t.actions.detailedStats.returns},compiles:{...t.actions.detailedStats.compiles},refreshes:{...t.actions.detailedStats.refreshes}};return u&&(S.totalCardsPlayed+=u.cardsPlayed,S.totalCardsDrawn+=u.cardsDrawn,S.totalDiscards+=u.cardsDiscarded,S.totalDeletes+=u.cardsDeleted,S.totalFlips+=u.cardsFlipped,S.totalShifts+=u.cardsShifted,S.totalRefreshes+=u.handsRefreshed,S.totalReturns+=u.cardsReturned||0,b.cardsPlayed.total+=u.cardsPlayed,b.cardsPlayed.player+=u.cardsPlayed,b.cardsDrawn.total+=u.cardsDrawn,b.cardsDrawn.player+=u.cardsDrawn,b.discards.total+=u.cardsDiscarded,b.discards.player+=u.cardsDiscarded,b.deletes.total+=u.cardsDeleted,b.deletes.player+=u.cardsDeleted,b.flips.total+=u.cardsFlipped,b.flips.player+=u.cardsFlipped,b.shifts.total+=u.cardsShifted,b.shifts.player+=u.cardsShifted,b.returns.total+=u.cardsReturned||0,b.returns.player+=u.cardsReturned||0,b.refreshes.total+=u.handsRefreshed,b.refreshes.player+=u.handsRefreshed),f&&(S.totalCardsPlayed+=f.cardsPlayed,S.totalCardsDrawn+=f.cardsDrawn,S.totalDiscards+=f.cardsDiscarded,S.totalDeletes+=f.cardsDeleted,S.totalFlips+=f.cardsFlipped,S.totalShifts+=f.cardsShifted,S.totalRefreshes+=f.handsRefreshed,S.totalReturns+=f.cardsReturned||0,b.cardsPlayed.total+=f.cardsPlayed,b.cardsPlayed.ai+=f.cardsPlayed,b.cardsDrawn.total+=f.cardsDrawn,b.cardsDrawn.ai+=f.cardsDrawn,b.discards.total+=f.cardsDiscarded,b.discards.ai+=f.cardsDiscarded,b.deletes.total+=f.cardsDeleted,b.deletes.ai+=f.cardsDeleted,b.flips.total+=f.cardsFlipped,b.flips.ai+=f.cardsFlipped,b.shifts.total+=f.cardsShifted,b.shifts.ai+=f.cardsShifted,b.returns.total+=f.cardsReturned||0,b.returns.ai+=f.cardsReturned||0,b.refreshes.total+=f.handsRefreshed,b.refreshes.ai+=f.handsRefreshed),h&&(h.cardsPlayed&&(b.cardsPlayed.playerFromHand+=h.cardsPlayed.playerFromHand,b.cardsPlayed.playerFromEffect+=h.cardsPlayed.playerFromEffect,b.cardsPlayed.aiFromHand+=h.cardsPlayed.aiFromHand,b.cardsPlayed.aiFromEffect+=h.cardsPlayed.aiFromEffect,b.cardsPlayed.playerFaceUp+=h.cardsPlayed.playerFaceUp,b.cardsPlayed.playerFaceDown+=h.cardsPlayed.playerFaceDown,b.cardsPlayed.aiFaceUp+=h.cardsPlayed.aiFaceUp,b.cardsPlayed.aiFaceDown+=h.cardsPlayed.aiFaceDown),h.cardsDrawn&&(b.cardsDrawn.playerFromRefresh+=h.cardsDrawn.playerFromRefresh,b.cardsDrawn.playerFromEffect+=h.cardsDrawn.playerFromEffect,b.cardsDrawn.aiFromRefresh+=h.cardsDrawn.aiFromRefresh,b.cardsDrawn.aiFromEffect+=h.cardsDrawn.aiFromEffect),h.compiles&&(b.compiles.playerFirstCompile+=h.compiles.playerFirstCompile,b.compiles.playerRecompile+=h.compiles.playerRecompile,b.compiles.aiFirstCompile+=h.compiles.aiFirstCompile,b.compiles.aiRecompile+=h.compiles.aiRecompile,b.compiles.player+=h.compiles.playerFirstCompile+h.compiles.playerRecompile,b.compiles.ai+=h.compiles.aiFirstCompile+h.compiles.aiRecompile,b.compiles.total+=h.compiles.playerFirstCompile+h.compiles.playerRecompile+h.compiles.aiFirstCompile+h.compiles.aiRecompile),h.refreshes&&(b.refreshes.playerCardsDrawn+=h.refreshes.playerCardsDrawn,b.refreshes.aiCardsDrawn+=h.refreshes.aiCardsDrawn)),p!==void 0&&(S.totalCompiles+=p),S.detailedStats=b,{version:t.version,global:g,protocols:y,aiDifficulty:m,cards:j,actions:S,control:x,coinFlip:E}}function QE(t,n){const r={...t,cards:{...t.cards,played:{...t.cards.played}}};return r.cards.played[n]||(r.cards.played[n]=0),r.cards.played[n]++,r}function XE(t,n){const r={...t,cards:{...t.cards,deleted:{...t.cards.deleted}}};return r.cards.deleted[n]||(r.cards.deleted[n]=0),r.cards.deleted[n]++,r}function ZE(t,n){const r={...t,control:{...t.control}};return n==="player"?r.control.playerRearranges++:r.control.aiRearranges++,r.control.totalRearranges++,r}function KE(t,n,r){const i={...t,coinFlip:{...t.coinFlip}};return n==="heads"?(i.coinFlip.headsChosen++,r&&i.coinFlip.headsWon++):(i.coinFlip.tailsChosen++,r&&i.coinFlip.tailsWon++),i}function JE(t){return t.global.totalGamesPlayed===0?0:t.global.totalGamesWon/t.global.totalGamesPlayed*100}function ej(t){return t.global.totalGamesPlayed===0?0:Math.floor(t.global.totalPlaytime/t.global.totalGamesPlayed)}function tj(t){return Object.entries(t.protocols).map(([r,i])=>({protocol:r,timesUsed:i.timesUsed,winRate:i.timesUsed>0?i.wins/i.timesUsed*100:0})).sort((r,i)=>i.timesUsed-r.timesUsed).slice(0,5)}function nj(t){return Object.entries(t.protocols).filter(([r,i])=>i.timesUsed>=3).map(([r,i])=>({protocol:r,timesUsed:i.timesUsed,winRate:i.wins/i.timesUsed*100})).sort((r,i)=>i.winRate-r.winRate).slice(0,5)}function aj(t){return Object.entries(t.protocols).map(([r,i])=>({protocol:r,timesUsed:i.timesUsed,winRate:i.timesUsed>0?i.wins/i.timesUsed*100:0})).sort((r,i)=>r.timesUsed-i.timesUsed).slice(0,5)}function oj(t){return Object.entries(t.cards.played).map(([r,i])=>({card:r,count:i})).sort((r,i)=>i.count-r.count).slice(0,5)}function rj(t){return Object.entries(t.cards.deleted).map(([r,i])=>({card:r,count:i})).sort((r,i)=>i.count-r.count).slice(0,5)}function Kl(t){const n=Math.floor(t/3600),r=Math.floor(t%3600/60),i=t%60;return n>0?`${n}h ${r}m`:r>0?`${r}m ${i}s`:`${i}s`}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function lj(t,n,r){const[i,s]=se.useState(()=>eu()),d=se.useRef(null),u=se.useCallback(()=>{d.current=Date.now()},[]),p=se.useCallback((y,m)=>{s(x=>{const S=`${y}-${m}`,E=QE(x,S);return el(E),E})},[]),f=se.useCallback((y,m)=>{s(x=>{const S=`${y}-${m}`,E=XE(x,S);return el(E),E})},[]),h=se.useCallback((y,m)=>{s(x=>{const S=KE(x,y,m);return el(S),S})},[]),w=se.useCallback(y=>{s(m=>{const x=ZE(m,y);return el(x),x})},[]),g=se.useCallback((y,m,x,S,E)=>{if(d.current===null)return;const j=Math.floor((Date.now()-d.current)/1e3);s(b=>{const k=WE(b,y,t,n,j,r,m,x,S,E);return el(k),k}),d.current=null},[t,n,r]);return{statistics:i,startGame:u,endGame:g,trackPlayerCardPlayed:p,trackPlayerCardDeleted:f,trackPlayerCoinFlip:h,trackPlayerRearrange:w}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function _(t,n,r=!0){const s=zo().find(d=>d.protocol===t&&d.value===n);return s?{id:st(),protocol:s.protocol,value:s.value,top:s.top,middle:s.middle,bottom:s.bottom,keywords:s.keywords,isFaceUp:r,isRevealed:!1,category:s.category||"Main",...s.customEffects&&{customEffects:s.customEffects}}:(console.warn(`Card not found: ${t}-${n}`),{id:st(),protocol:t,value:n,top:"",middle:"",bottom:"",keywords:{},isFaceUp:r,isRevealed:!1,category:"Main"})}function H(t,n,r,i){const s={...t},d={...s[n]},u=[...d.lanes];return u[r]=[...u[r],i],d.lanes=u,s[n]=d,s}function tn(t,n){const r=[],i=zo();for(const s of t){const d=i.filter(u=>u.protocol===s);for(const u of d)n.some(f=>f.protocol===u.protocol&&f.value===u.value)||r.push(_(u.protocol,u.value,!0))}return r}function $e(t,n,r,i,s){return{...t,player:{...t.player,protocols:n,lanes:[[],[],[]],hand:[]},opponent:{...t.opponent,protocols:r,lanes:[[],[],[]],hand:[]},turn:i,phase:s,actionRequired:null,queuedActions:[],_interruptedTurn:void 0,_interruptedPhase:void 0,processedStartEffectIds:[],processedEndEffectIds:[],processedUncoverEventIds:[]}}function qe(t){const n=[...t.player.hand,...t.player.lanes.flat()],r=[...t.opponent.hand,...t.opponent.lanes.flat()],i=tn(t.player.protocols,n),s=tn(t.opponent.protocols,r),d=t.turn==="player"?"Player":"Opponent",u=[{player:"player",message:`Player protocols: ${t.player.protocols.join(", ")}`},{player:"opponent",message:`Opponent protocols: ${t.opponent.protocols.join(", ")}`},{player:t.turn,message:`${d} goes first.`},{player:"player",message:"---"},{player:t.turn,message:`[Test Scenario] Phase: ${t.phase}`}];return{...t,player:{...t.player,deck:i,discard:[],compiled:[!1,!1,!1]},opponent:{...t.opponent,deck:s,discard:[],compiled:[!1,!1,!1]},log:u}}const Uy={name:"Psychic-3 Uncover whrend Opponent's Turn",description:"Player lscht Opponent's face-down card  Psychic-3 uncovered  Player discardet, Opponent shiftet",setup:t=>{let n=$e(t,["Hate","Fire","Water"],["Psychic","Death","Spirit"],"player","action");return n.player.hand=[_("Hate",0,!0),_("Fire",1,!0),_("Water",1,!0)],n=H(n,"opponent",1,_("Psychic",3,!0)),n=H(n,"opponent",1,_("Fire",1,!1)),n=Ae(n),qe(n)}},Oy={name:"Psychic-4 End Effect mit Uncover-Interrupt",description:"Psychic-4 returnt Fire-2  Fire-4 uncovered  Interrupt  Psychic-4 flip aus Queue",setup:t=>{let n=$e(t,["Fire","Water","Spirit"],["Psychic","Death","Metal"],"opponent","end");return n=H(n,"opponent",0,_("Psychic",4,!0)),n=H(n,"player",1,_("Fire",4,!0)),n=H(n,"player",1,_("Fire",2,!0)),n.opponent.hand=[_("Water",1),_("Water",2)],n=Ae(n),qe(n)}},My={name:"Spirit-3 Draw whrend End Phase",description:"Spirit-3 draw in End Phase  Shift-prompt in Queue  Player kann lanes klicken",setup:t=>{let n=$e(t,["Spirit","Fire","Water"],["Death","Metal","Psychic"],"player","action");n=H(n,"player",0,_("Spirit",3,!0));const r=zo(),i=r.find(u=>u.protocol==="Fire"&&u.value===1),s=r.find(u=>u.protocol==="Water"&&u.value===1),d=r.find(u=>u.protocol==="Spirit"&&u.value===1);return n.player.deck=[i,s,d],n=Ae(n),qe(n)}},Hy={name:"Plague-2 Actor Propagation",description:"Player spielt Plague-2  Player discardet  Opponent discardet (actor korrekt)",setup:t=>{let n=$e(t,["Plague","Death","Hate"],["Fire","Water","Spirit"],"player","action");return n.player.hand=[_("Plague",2,!0),_("Fire",1),_("Water",1),_("Spirit",1)],n.opponent.hand=[_("Fire",2),_("Water",2),_("Spirit",2),_("Death",2)],n=Ae(n),qe(n)}},Vy={name:"Darkness-1 Flip + Shift mit Interrupt",description:"Darkness-1 flippt Fire-0  Delete-Interrupt  Player shiftet",setup:t=>{let n=$e(t,["Darkness","Fire","Water"],["Spirit","Death","Metal"],"player","action");return n.player.hand=[_("Darkness",1,!0)],n=H(n,"opponent",0,_("Fire",0,!1)),n=Ae(n),qe(n)}},zy={name:"Plague-4 Owner vs Turn Check",description:"Plague-4 End  Player deletet  Opponent (owner) wird fr flip gefragt",setup:t=>{let n=$e(t,["Fire","Water","Spirit"],["Plague","Death","Metal"],"opponent","end");return n=H(n,"opponent",0,_("Plague",4,!0)),n=H(n,"player",1,_("Water",2,!1)),n=Ae(n),qe(n)}},By={name:"Water Owner vs Turn Check",description:"Plague-4 End  Player deletet  Opponent (owner) wird fr flip gefragt",setup:t=>{let n=$e(t,["Fire","Water","Spirit"],["Plague","Death","Metal"],"player","action");return n=H(n,"opponent",0,_("Plague",4,!0)),n=H(n,"player",2,_("Water",4,!1)),n.player.hand=[_("Water",0,!0),_("Fire",1),_("Water",1),_("Spirit",1)],n.opponent.hand=[_("Fire",2),_("Water",2),_("Spirit",2),_("Death",2)],n=Ae(n),qe(n)}},Gy={name:"Hate-1 Multi-Delete mit Uncover-Interrupt",description:"Hate-1 lscht Plague-0  Plague-5 uncovered  Interrupt  Player macht 2. Delete",setup:t=>{let n=$e(t,["Fire","Hate","Water"],["Plague","Death","Metal"],"player","action");return n.player.hand=[_("Hate",1,!0),_("Psychic",2,!0),_("Psychic",4,!0),_("Hate",4,!0),_("Water",1,!0)],n=H(n,"opponent",0,_("Plague",2,!0)),n=H(n,"opponent",0,_("Plague",0,!0)),n=H(n,"player",0,_("War",3,!0)),n.opponent.hand=[_("Fire",2,!0),_("Water",2,!0),_("Spirit",2,!0),_("Death",2,!0),_("Metal",2,!0)],n=Ae(n),qe(n)}},Yy={name:"Darkness-1  Hate-0 Flip  Multi-Effect Chain",description:" Darkness-1 flippt Hate-0  Delete-Interrupt  Draw-Interrupt  Shift aus Queue",setup:t=>{let n=$e(t,["Darkness","Fire","Water"],["Hate","Death","Metal"],"player","action");n.player.hand=[_("Darkness",1,!0)],n=H(n,"opponent",0,_("Hate",0,!1)),n=H(n,"opponent",1,_("Hate",3,!0)),n=H(n,"opponent",2,_("Fire",1,!1)),n=H(n,"player",1,_("Water",2,!0)),n.opponent.hand=[_("Death",2),_("Metal",3)];const i=zo().find(s=>s.protocol==="Death"&&s.value===1);return n.opponent.deck=[i],n=Ae(n),qe(n)}},Wy={name:"Water-4 Return  Turn End",description:" Water-4 returnt Karte  Turn endet (Bug-Fix: Opponent spielt nicht zweimal)",setup:t=>{let n=$e(t,["Hate","Spirit","Light"],["Fire","Water","Death"],"opponent","action");return n.opponent.hand=[_("Water",4,!0)],n=H(n,"opponent",0,_("Life",4,!0)),n=H(n,"opponent",2,_("Death",4,!1)),n=H(n,"player",1,_("Spirit",1,!0)),n=H(n,"player",2,_("Light",5,!1)),n.player.hand=[_("Fire",1),_("Spirit",2),_("Hate",4)],n=Ae(n),qe(n)}},Qy={name:"Psychic-3 Discard + Shift",description:" Psychic-3 On-Play  Player discardet  AI shiftet (Bug-Fix: AI kann shiften)",setup:t=>{let n=$e(t,["Fire","Water","Spirit"],["Psychic","Death","Metal"],"opponent","action");return n.opponent.hand=[_("Psychic",3,!0)],n.player.hand=[_("Fire",1),_("Water",2),_("Spirit",1)],n=H(n,"player",0,_("Fire",2,!0)),n=H(n,"player",1,_("Water",3,!0)),n=H(n,"player",2,_("Spirit",4,!0)),n=Ae(n),qe(n)}},Xy={name:"Death-1 Delete  Speed-3 Uncover",description:" Death-1 lscht Light-0  Speed-3 uncovered  Player shiftet (Bug-Fix Test)",setup:t=>{let n=$e(t,["Speed","Light","Water"],["Death","Fire","Metal"],"opponent","start");return n=H(n,"player",0,_("Speed",3,!0)),n=H(n,"player",0,_("Light",0,!0)),n=H(n,"player",1,_("Water",1,!0)),n=H(n,"opponent",0,_("Death",1,!0)),n.player.hand=[],n.opponent.hand=[],n=Ae(n),qe(n)}},Zy={name:"Gravity-2 Flip  Metal-5 Discard  Shift",description:" Gravity-2 flippt Metal-5  Discard Interrupt  shiften (Bug-Fix: AI stuck)",setup:t=>{let n=$e(t,["Fire","Water","Light"],["Gravity","Metal","Fire"],"opponent","action");return n.opponent.hand=[_("Gravity",2,!0),_("Fire",1)],n=H(n,"opponent",1,_("Metal",5,!1)),n=H(n,"player",0,_("Fire",2,!0)),n=H(n,"player",2,_("Light",3,!0)),n.player.hand=[_("Water",1),_("Fire",3)],n=Ae(n),qe(n)}},Ky={name:"Hate-2 Player spielt (Einfach)",description:" Player spielt Hate-2  Whlt eigene & Gegners hchste Karte",setup:t=>{let n=$e(t,["Hate","Water","Light"],["Metal","Death","Gravity"],"player","action");return n.player.hand=[_("Hate",2,!0)],n=H(n,"player",0,_("Fire",4,!0)),n=H(n,"player",1,_("Water",2,!0)),n=H(n,"player",2,_("Light",5,!0)),n=H(n,"opponent",0,_("Metal",3,!0)),n=H(n,"opponent",1,_("Death",5,!0)),n=H(n,"opponent",2,_("Gravity",2,!1)),n=Ae(n),qe(n)}},Jy={name:"Hate-2 AI spielt (Normal)",description:" AI spielt Hate-2  AI whlt eigene & Players hchste automatisch",setup:t=>{let n=$e(t,["Water","Spirit","Light"],["Hate","Metal","Death"],"opponent","action");return n.opponent.hand=[_("Hate",2,!0)],n=H(n,"opponent",0,_("Fire",5,!0)),n=H(n,"opponent",1,_("Metal",3,!0)),n=H(n,"opponent",2,_("Death",2,!1)),n=H(n,"player",0,_("Water",4,!0)),n=H(n,"player",1,_("Spirit",5,!0)),n=H(n,"player",2,_("Light",2,!0)),n=Ae(n),qe(n)}},eg={name:"Hate-2 AI spielt (Normal) mit Auswahl",description:" AI spielt Hate-2  AI whlt eigene & Players hchste automatisch",setup:t=>{let n=$e(t,["Water","Spirit","Light"],["Hate","Metal","Death"],"opponent","action");return n.opponent.hand=[_("Hate",2,!0)],n=H(n,"opponent",0,_("Fire",5,!0)),n=H(n,"opponent",1,_("Metal",3,!0)),n=H(n,"opponent",2,_("Death",2,!1)),n=H(n,"player",0,_("Water",4,!0)),n=H(n,"player",1,_("Spirit",5,!0)),n=H(n,"player",2,_("Light",5,!0)),n=Ae(n),qe(n)}},tg={name:"Hate-2 Selbst-Lschung",description:" Hate-2 lscht sich selbst  Zweite Klausel entfllt (Regelwerk-Check)",setup:t=>{let n=$e(t,["Hate","Fire","Water"],["Metal","Death","Gravity"],"player","action");return n.player.hand=[_("Hate",2,!0)],n=H(n,"player",1,_("Fire",1,!0)),n=H(n,"player",2,_("Water",0,!0)),n=H(n,"opponent",0,_("Metal",3,!0)),n=H(n,"opponent",1,_("Death",5,!0)),n=Ae(n),qe(n)}},ng={name:"Hate-2 Gleichstand (Auswahl)",description:" Hate-2 mit mehreren hchsten  Player muss whlen (Tied values)",setup:t=>{let n=$e(t,["Hate","Water","Spirit"],["Metal","Death","Gravity"],"player","action");return n.player.hand=[_("Hate",2,!0)],n=H(n,"player",0,_("Fire",4,!0)),n=H(n,"player",1,_("Water",4,!0)),n=H(n,"player",2,_("Spirit",4,!0)),n=H(n,"opponent",0,_("Metal",5,!0)),n=H(n,"opponent",1,_("Death",5,!0)),n=H(n,"opponent",2,_("Gravity",2,!1)),n=Ae(n),qe(n)}},ag={name:"Hate-2 Face-Down Karten",description:" Hate-2 mit face-down  Alle face-down sind value 2 (Tied mit Hate-2)",setup:t=>{let n=$e(t,["Hate","Fire","Water"],["Metal","Death","Gravity"],"player","action");return n.player.hand=[_("Hate",2,!0)],n=H(n,"player",1,_("Fire",5,!1)),n=H(n,"player",2,_("Water",5,!1)),n=H(n,"opponent",0,_("Metal",5,!0)),n=H(n,"opponent",1,_("Death",4,!1)),n=H(n,"opponent",2,_("Gravity",1,!0)),n=Ae(n),qe(n)}},og={name:"Hate-2 AI Play-Validation",description:" AI spielt Hate-2 NICHT face-up wenn es sich selbst lschen wrde",setup:t=>{let n=$e(t,["Fire","Water","Spirit"],["Hate","Death","Metal"],"opponent","action");return n.opponent.hand=[_("Hate",2,!0)],n=H(n,"opponent",1,_("Fire",0,!0)),n=H(n,"opponent",2,_("Water",1,!0)),n=H(n,"player",0,_("Fire",5,!0)),n=H(n,"player",1,_("Water",4,!0)),n=Ae(n),qe(n)}},rg={name:"Hate-2 AI spielt OFFEN (Optimal)",description:" AI spielt Hate-2 offen weil nicht hchste Karte",setup:t=>{let n=$e(t,["Water","Spirit","Light"],["Hate","Metal","Death"],"opponent","action");return n.opponent.hand=[_("Hate",2,!0)],n=H(n,"opponent",0,_("Fire",5,!0)),n=H(n,"opponent",1,_("Metal",4,!0)),n=H(n,"opponent",2,_("Death",3,!0)),n=H(n,"player",0,_("Water",2,!0)),n=H(n,"player",1,_("Spirit",5,!0)),n=H(n,"player",2,_("Light",1,!0)),n=Ae(n),qe(n)}},sj={name:"Chaos-3 Protocol-Free Playing",description:"Player with Chaos-3 can play any card face-up in any lane",setup:t=>{let n=$e(t,["Chaos","Fire","Water"],["Spirit","Death","Metal"],"player","action");return n=H(n,"player",0,_("Chaos",3,!0)),n.player.hand=[_("Gravity",2,!0),_("Hate",3,!0),_("Love",1,!0)],n=Ae(n),qe(n)}},ij={name:"Frost-3 Blocks Shifts (Covered)",description:"Frost-3 should prevent shifts even when covered (Top-Box effect always active)",setup:t=>{let n=$e(t,["Gravity","Water","Fire"],["Frost","Metal","Death"],"player","action");return n=H(n,"opponent",0,_("Frost",3,!0)),n=H(n,"opponent",0,_("Metal",2,!1)),n=H(n,"player",1,_("Water",2,!0)),n.player.hand=[_("Gravity",1,!0),_("Fire",2,!0)],n=Ae(n),qe(n)}},cj={name:"Water-0 Softlock Bug Fix",description:"Water-0 self-flip should be cancelled when card becomes covered before self-flip executes",setup:t=>{let n=$e(t,["Water","Darkness","Light"],["Apathy","Fire","Death"],"player","action");return n=H(n,"player",1,_("Darkness",3,!1)),n.player.hand=[_("Water",0,!0),_("Darkness",2,!0),_("Fire",1,!0)],n=Ae(n),qe(n)}},dj={name:"Darkness-1 Flip and Shift Chain",description:"Darkness-1 should flip opponent card, then allow shifting that same card",setup:t=>{let n=$e(t,["Darkness","Water","Fire"],["Metal","Fire","Death"],"player","action");return n=H(n,"opponent",0,_("Metal",2,!1)),n=H(n,"opponent",1,_("Fire",1,!0)),n=H(n,"opponent",2,_("Hate",0,!1)),n.player.hand=[_("Darkness",1,!0),_("Water",2,!0),_("Fire",3,!0)],n=Ae(n),qe(n)}},uj={name:"Darkness-1 Flips Speed-3 - Middle Effect Execution",description:"When Darkness-1 flips Speed-3, Speed-3's middle effect (shift) should execute before Darkness-1's shift",setup:t=>{let n=$e(t,["Darkness","Water","Fire"],["Speed","Fire","Metal"],"player","action");return n=H(n,"opponent",0,_("Speed",3,!1)),n=H(n,"opponent",1,_("Fire",1,!0)),n=H(n,"opponent",2,_("Metal",2,!0)),n.player.hand=[_("Darkness",1,!0),_("Water",2,!0),_("Fire",3,!0)],n=Ae(n),qe(n)}},pj={name:"Darkness-1 Flips Speed-3 - Middle Effect Execution",description:"When Darkness-1 flips Speed-3, Speed-3's middle effect (shift) should execute before Darkness-1's shift",setup:t=>{let n=$e(t,["Darkness","Water","Fire"],["Speed","Fire","Metal"],"player","action");return n=H(n,"opponent",0,_("Speed",3,!1)),n=H(n,"opponent",1,_("Fire",1,!0)),n=H(n,"opponent",2,_("Metal",2,!0)),n.player.hand=[_("Darkness",1,!0),_("Water",2,!0),_("Fire",3,!0)],n=Ae(n),qe(n)}},lg={name:"Fire-1 & Fire-2 Conditional Test",description:" Fire-1 (discard -> delete) & Fire-2 (discard -> return) if_executed logic",setup:t=>{let n=$e(t,["Fire","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[_("Fire",1,!0),_("Fire",2,!0),_("Fire",0,!0),_("Fire",3,!0),_("Fire",4,!0),_("Fire",5,!0)],n=H(n,"opponent",0,_("Metal",3,!0)),n=H(n,"opponent",1,_("Death",4,!0)),n=H(n,"opponent",2,_("Fire",2,!0)),n=H(n,"opponent",0,_("Metal",1,!0)),n=H(n,"player",2,_("Spirit",3,!0)),n=H(n,"player",1,_("Water",3,!0)),n=H(n,"player",2,_("Spirit",2,!0)),n=Ae(n),qe(n)}},sg={name:"Anarchy Test Playground",description:" All Anarchy cards on hand for testing",setup:t=>{let n=$e(t,["Anarchy","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[_("Anarchy",0,!0),_("Anarchy",1,!0),_("Anarchy",2,!0),_("Anarchy",3,!0),_("Anarchy",5,!0),_("Anarchy",6,!0)],n=H(n,"opponent",0,_("Metal",3,!0)),n=H(n,"opponent",1,_("Death",4,!1)),n=H(n,"opponent",2,_("Fire",2,!0)),n=H(n,"opponent",0,_("Metal",1,!0)),n=H(n,"player",2,_("Spirit",3,!0)),n=H(n,"player",1,_("Water",3,!0)),n=H(n,"player",2,_("Spirit",2,!0)),n=Ae(n),qe(n)}},ig={name:"Darkness Test Playground",description:" All Darkness cards on hand for testing",setup:t=>{let n=$e(t,["Darkness","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[_("Darkness",0,!0),_("Darkness",1,!0),_("Darkness",2,!0),_("Darkness",3,!0),_("Darkness",4,!0),_("Darkness",5,!0)],n=H(n,"opponent",0,_("Metal",3,!1)),n=H(n,"opponent",1,_("Death",4,!0)),n=H(n,"opponent",2,_("Fire",2,!1)),n=H(n,"opponent",0,_("Metal",1,!0)),n=H(n,"opponent",1,_("Death",2,!1)),n=H(n,"player",2,_("Spirit",3,!0)),n=H(n,"player",1,_("Water",3,!0)),n=H(n,"player",2,_("Spirit",2,!0)),n=Ae(n),qe(n)}},cg={name:"Apathy Test Playground",description:" All Apathy cards on hand for testing",setup:t=>{let n=$e(t,["Apathy","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[_("Apathy",0,!0),_("Apathy",1,!0),_("Apathy",2,!0),_("Apathy",3,!0),_("Apathy",4,!0),_("Apathy",5,!0)],n=H(n,"opponent",0,_("Metal",3,!0)),n=H(n,"opponent",1,_("Death",4,!0)),n=H(n,"opponent",2,_("Fire",2,!0)),n=H(n,"opponent",0,_("Metal",1,!0)),n=H(n,"opponent",2,_("Fire",1,!1)),n=H(n,"player",2,_("Spirit",3,!0)),n=H(n,"player",1,_("Water",3,!0)),n=H(n,"player",2,_("Spirit",2,!0)),n=Ae(n),qe(n)}},dg={name:"Death Test Playground",description:" All Death cards on hand for testing",setup:t=>{let n=$e(t,["Death_cust","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[_("Death_cust",0,!0),_("Death_cust",1,!0),_("Death_cust",2,!0),_("Death_cust",3,!0),_("Death_cust",4,!0),_("Death_cust",5,!0)],n=H(n,"opponent",0,_("Metal",0,!0)),n=H(n,"opponent",1,_("Death",1,!0)),n=H(n,"opponent",2,_("Fire",3,!0)),n=H(n,"opponent",0,_("Metal",2,!0)),n=H(n,"opponent",1,_("Death",4,!1)),n=H(n,"player",2,_("Spirit",3,!0)),n=H(n,"player",1,_("Water",3,!0)),n=H(n,"player",2,_("Spirit",2,!0)),n=Ae(n),qe(n)}},ug={name:"Water Test Playground",description:" All Water cards on hand for testing - wash away and renew",setup:t=>{let n=$e(t,["Water","Fire","Spirit"],["Metal","Death","Light"],"player","action");return n.player.hand=[_("Water",0,!0),_("Water",1,!0),_("Water",2,!0),_("Water",3,!0),_("Water",4,!0),_("Water",5,!0)],n=H(n,"opponent",0,_("Metal",2,!0)),n=H(n,"opponent",1,_("Death",3,!0)),n=H(n,"opponent",2,_("Light",2,!0)),n=H(n,"opponent",0,_("Metal",4,!0)),n=H(n,"opponent",1,_("Death",2,!1)),n=H(n,"opponent",2,_("Light",5,!1)),n=H(n,"player",1,_("Fire",2,!0)),n=H(n,"player",2,_("Spirit",3,!0)),n=H(n,"player",1,_("Fire",4,!0)),n=H(n,"player",2,_("Spirit",5,!1)),n=Ae(n),qe(n)}},pg={name:"Spirit Test Playground",description:" All Spirit cards on hand - true strength from within",setup:t=>{let n=$e(t,["Spirit","Fire","Water"],["Metal","Death","Light"],"player","action");return n.player.hand=[_("Spirit",0,!0),_("Spirit",1,!0),_("Spirit",2,!0),_("Spirit",3,!0),_("Spirit",4,!0),_("Spirit",5,!0)],n=H(n,"opponent",0,_("Metal",3,!0)),n=H(n,"opponent",1,_("Death",2,!1)),n=H(n,"opponent",2,_("Light",4,!0)),n=H(n,"opponent",0,_("Metal",5,!1)),n=H(n,"opponent",2,_("Light",3,!0)),n=H(n,"player",1,_("Fire",2,!0)),n=H(n,"player",2,_("Water",4,!0)),n=H(n,"player",1,_("Fire",3,!1)),n=Ae(n),qe(n)}},fg={name:"Chaos Test Playground",description:" All Chaos cards on hand - embrace the unpredictable",setup:t=>{let n=$e(t,["Chaos","Fire","Water"],["Metal","Death","Light"],"player","action");return n.player.hand=[_("Chaos",0,!0),_("Chaos",1,!0),_("Chaos",2,!0),_("Chaos",3,!0),_("Chaos",4,!0),_("Chaos",5,!0)],n=H(n,"opponent",0,_("Metal",2,!0)),n=H(n,"opponent",0,_("Metal",4,!0)),n=H(n,"opponent",1,_("Death",3,!1)),n=H(n,"opponent",1,_("Death",5,!0)),n=H(n,"opponent",2,_("Light",1,!0)),n=H(n,"opponent",2,_("Light",3,!1)),n=H(n,"player",0,_("Fire",2,!0)),n=H(n,"player",0,_("Fire",4,!0)),n=H(n,"player",1,_("Water",3,!1)),n=H(n,"player",1,_("Water",5,!0)),n=H(n,"player",2,_("Fire",1,!0)),n=Ae(n),qe(n)}},hg={name:"Gravity Test Playground",description:" All Gravity cards on hand - pull everything together",setup:t=>{let n=$e(t,["Fire","Gravity","Water"],["Metal","Death","Light"],"player","action");return n.player.hand=[_("Gravity",0,!0),_("Gravity",1,!0),_("Gravity",2,!0),_("Gravity",4,!0),_("Gravity",5,!0),_("Gravity",6,!0)],n=H(n,"player",0,_("Fire",1,!0)),n=H(n,"player",2,_("Water",2,!1)),n=H(n,"opponent",0,_("Metal",3,!1)),n=H(n,"opponent",0,_("Metal",4,!0)),n=H(n,"opponent",1,_("Death",2,!1)),n=H(n,"opponent",1,_("Death",3,!0)),n=H(n,"opponent",2,_("Light",4,!1)),n.opponent.deck=[_("Metal",5,!0),_("Death",4,!0),_("Light",5,!0)],n=Ae(n),qe(n)}},mg={name:"Frost Test Playground",description:" All Frost cards on hand - pull everything together",setup:t=>{let n=$e(t,["Fire","Frost","Water"],["Metal","Death","Light"],"player","action");return n.player.hand=[_("Frost",0,!0),_("Frost",1,!0),_("Frost",2,!0),_("Frost",3,!0),_("Frost",4,!0),_("Frost",5,!0)],n=H(n,"player",0,_("Fire",1,!0)),n=H(n,"player",2,_("Water",2,!1)),n=H(n,"opponent",0,_("Metal",3,!1)),n=H(n,"opponent",0,_("Metal",4,!0)),n=H(n,"opponent",1,_("Death",2,!1)),n=H(n,"opponent",1,_("Death",3,!0)),n=H(n,"opponent",2,_("Light",4,!1)),n.opponent.deck=[_("Metal",5,!0),_("Death",4,!0),_("Light",5,!0)],n=Ae(n),qe(n)}},yg={name:"Hate Test Playground",description:" All Hate cards on hand - test deletion mechanics",setup:t=>{let n=$e(t,["Hate","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[_("Hate",0,!0),_("Hate",1,!0),_("Hate",2,!0),_("Hate",3,!0),_("Hate",4,!0),_("Hate",5,!0)],n=H(n,"player",1,_("Water",1,!0)),n=H(n,"player",1,_("Water",2,!0)),n=H(n,"player",1,_("Water",3,!0)),n=H(n,"player",2,_("Spirit",2,!0)),n=H(n,"player",2,_("Spirit",4,!1)),n=H(n,"opponent",0,_("Metal",5,!0)),n=H(n,"opponent",1,_("Death",2,!0)),n=H(n,"opponent",1,_("Death",4,!0)),n=H(n,"opponent",2,_("Fire",3,!1)),n.player.deck=[_("Water",0,!0),_("Water",4,!0),_("Spirit",0,!0),_("Spirit",5,!0)],n.opponent.deck=[_("Metal",3,!0),_("Death",5,!0),_("Fire",1,!0)],n=Ae(n),qe(n)}},gg={name:"Life Test Playground",description:" All Life cards on hand - test play and flip mechanics",setup:t=>{let n=$e(t,["Life","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[_("Life",0,!0),_("Life",1,!0),_("Life",2,!0),_("Life",3,!0),_("Life",4,!0),_("Life",5,!0)],n=H(n,"player",1,_("Water",1,!0)),n=H(n,"player",1,_("Water",2,!0)),n=H(n,"player",1,_("Water",3,!0)),n=H(n,"player",2,_("Spirit",2,!0)),n=H(n,"player",2,_("Spirit",4,!1)),n=H(n,"opponent",0,_("Metal",3,!1)),n=H(n,"opponent",1,_("Death",2,!0)),n=H(n,"opponent",1,_("Death",4,!1)),n=H(n,"opponent",2,_("Fire",5,!1)),n.player.deck=[_("Water",0,!0),_("Water",3,!0),_("Water",4,!0),_("Spirit",0,!0),_("Spirit",1,!0),_("Spirit",2,!0),_("Spirit",3,!0),_("Spirit",4,!0)],n.opponent.deck=[_("Metal",1,!0),_("Death",3,!0),_("Fire",2,!0)],n=Ae(n),qe(n)}},vg={name:"Light Test Playground",description:" All Light cards on hand - burn away the dark",setup:t=>{let n=$e(t,["Light","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[_("Light",0,!0),_("Light",1,!0),_("Light",2,!0),_("Light",3,!0),_("Light",4,!0),_("Light",5,!0)],n=H(n,"opponent",0,_("Fire",3,!1)),n=H(n,"opponent",1,_("Metal",4,!1)),n=H(n,"opponent",2,_("Death",5,!0)),n=H(n,"player",1,_("Water",2,!1)),n=H(n,"player",1,_("Water",3,!1)),n=H(n,"player",1,_("Water",4,!1)),n=H(n,"player",0,_("Spirit",1,!0)),n=H(n,"player",0,_("Spirit",2,!1)),n=H(n,"player",2,_("Spirit",5,!1)),n.player.deck=[_("Water",0,!0),_("Water",1,!0),_("Spirit",0,!0),_("Spirit",3,!0),_("Spirit",4,!0)],n.opponent.hand=[_("Metal",1,!0),_("Death",2,!0),_("Fire",3,!0),_("Metal",0,!0)],n=Ae(n),qe(n)}},_g={name:"Death-2 Uncover Interrupt - Turn Wechsel Test",description:"Death-2 lscht  Darkness-4 uncovered  Opponent shiftet  Turn muss zu Opponent wechseln",setup:t=>{let n=$e(t,["Death","Fire","Hate"],["Water","Darkness","Spirit"],"player","action");return n.player.hand=[_("Death",2,!0),_("Fire",1,!0),_("Hate",1,!0)],n=H(n,"player",0,_("Fire",0,!1)),n=H(n,"opponent",1,_("Darkness",4,!0)),n=H(n,"opponent",1,_("Darkness",1,!0)),n=H(n,"opponent",0,_("Water",0,!1)),n.opponent.hand=[_("Water",1,!0),_("Spirit",1,!0)],n=Ae(n),qe(n)}},wg={name:"Apathy-5 Uncover - darf nur einmal triggern",description:"Hate-0 lscht Apathy-0  Apathy-5 uncovered  darf nur 1x triggern",setup:t=>{let n=$e(t,["Hate","Fire","Death"],["Apathy","Darkness","Plague"],"player","action");return n.player.hand=[_("Hate",0,!0),_("Fire",2,!0),_("Death",2,!0)],n=H(n,"opponent",0,_("Apathy",5,!0)),n=H(n,"opponent",0,_("Apathy",4,!0)),n.opponent.hand=[_("Darkness",1,!0),_("Apathy",1,!0),_("Darkness",2,!0)],n=Ae(n),qe(n)}},xg={name:"Psychic-1 facedown flip darkness 2 test",description:"Psychic-1 facedown, darkness-2 flippt Karte nur noch facedown bug",setup:t=>{let n=$e(t,["Frost","Gravity","Plague"],["Psychic","Darkness","Speed"],"player","action");return n.player.hand=[_("Darkness",1,!0),_("Darkness",2,!0),_("Speed",3,!0)],n=H(n,"opponent",0,_("Frost",0,!1)),n=H(n,"opponent",1,_("Gravity",6,!1)),n=H(n,"player",0,_("Psychic",4,!1)),n=H(n,"player",1,_("Psychic",1,!1)),n.opponent.hand=[_("Gravity",1,!0)],n=Ae(n),qe(n)}},Cg={name:"Speed Test Playground",description:" All Speed cards on hand - swift and adaptive",setup:t=>{let n=$e(t,["Speed","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[_("Speed",0,!0),_("Speed",1,!0),_("Speed",2,!0),_("Speed",3,!0),_("Speed",4,!0),_("Speed",5,!0)],n=H(n,"player",0,_("Water",2,!0)),n=H(n,"player",1,_("Spirit",3,!0)),n=H(n,"opponent",0,_("Metal",3,!1)),n=H(n,"opponent",1,_("Death",4,!1)),n=H(n,"opponent",2,_("Fire",2,!0)),n=H(n,"player",2,_("Spirit",5,!0)),n=H(n,"player",2,_("Spirit",4,!0)),n=Ae(n),qe(n)}},Sg={name:"Metal Test Playground",description:" All Metal cards on hand - unyielding defense",setup:t=>{let n=$e(t,["Metal","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[_("Metal",0,!0),_("Metal",1,!0),_("Metal",2,!0),_("Metal",3,!0),_("Metal",5,!0),_("Metal",6,!0)],n=H(n,"opponent",0,_("Metal",3,!1)),n=H(n,"opponent",1,_("Death",4,!0)),n=H(n,"player",1,_("Water",3,!0)),n=H(n,"opponent",2,_("Fire",0,!0)),n=H(n,"opponent",2,_("Fire",1,!0)),n=H(n,"opponent",2,_("Fire",2,!0)),n=H(n,"opponent",2,_("Fire",3,!0)),n=H(n,"opponent",2,_("Fire",4,!0)),n=H(n,"opponent",2,_("Fire",5,!0)),n=H(n,"player",2,_("Spirit",3,!0)),n=H(n,"player",2,_("Spirit",2,!0)),n=Ae(n),qe(n)}},bg={name:"Plague Test Playground",description:" All Plague cards on hand - spread suffering",setup:t=>{let n=$e(t,["Plague","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[_("Plague",0,!0),_("Plague",1,!0),_("Plague",2,!0),_("Plague",3,!0),_("Plague",4,!0),_("Plague",5,!0)],n.opponent.hand=[_("Fire",2,!0),_("Death",3,!0),_("Water",1,!0)],n.player.lanes[0]=[_("Spirit",2,!0)],n.player.lanes[1]=[],n.player.lanes[2]=[],n.opponent.lanes[0]=[_("Metal",1,!0)],n.opponent.lanes[1]=[_("Death",2,!1)],n.opponent.lanes[2]=[_("Fire",3,!0)],n=Ae(n),qe(n)}},Eg={name:"Love Test Playground",description:" All Love cards on hand - share the love",setup:t=>{let n=$e(t,["Love","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[_("Love",1,!0),_("Love",2,!0),_("Love",3,!0),_("Love",4,!0),_("Love",5,!0),_("Love",6,!0)],n.opponent.hand=[_("Fire",2,!0),_("Death",3,!0),_("Water",1,!0),_("Metal",4,!0)],n.player.lanes[0]=[_("Spirit",2,!0)],n.player.lanes[1]=[],n.player.lanes[2]=[],n.opponent.lanes[0]=[_("Metal",1,!0)],n.opponent.lanes[1]=[_("Death",2,!1)],n.opponent.lanes[2]=[_("Fire",3,!0)],n=Ae(n),qe(n)}},jg={name:"Psychic Test Playground",description:" All Psychic cards on hand - read minds and control",setup:t=>{let n=$e(t,["Psychic","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[_("Psychic",0,!0),_("Psychic",1,!0),_("Psychic",2,!0),_("Psychic",3,!0),_("Psychic",4,!0),_("Psychic",5,!0)],n.opponent.hand=[_("Fire",2,!0),_("Death",3,!0),_("Water",1,!0),_("Metal",4,!0)],n.player.lanes[0]=[_("Spirit",2,!0)],n.player.lanes[1]=[],n.player.lanes[2]=[],n.opponent.lanes[0]=[_("Metal",1,!0)],n.opponent.lanes[1]=[_("Death",2,!1)],n.opponent.lanes[2]=[_("Fire",3,!0)],n=Ae(n),qe(n)}},kg={name:" Gravity-2 AI Single Card Bug",description:"AI spielt Gravity-2  Flip  Shift  Turn endet (NUR 1 Karte!)",setup:t=>{let n=$e(t,["Hate","Fire","Water"],["Gravity","Death","Metal"],"opponent","action");return n.opponent.hand=[_("Gravity",2,!0),_("Death",1,!0),_("Metal",3,!0)],n=H(n,"player",1,_("Hate",5,!0)),n=H(n,"player",1,_("Hate",4,!0)),n=H(n,"player",0,_("Fire",2,!0)),n=H(n,"player",2,_("Water",3,!0)),n=Ae(n),qe(n)}},Tg={name:"Speed-3 End-Effekt Softlock Test",description:"Speed-3 als einzige uncovered Karte sollte sich selbst im End-Effekt shiften knnen",setup:t=>{let n=$e(t,["Fire","Water","Death"],["Speed","Gravity","Light"],"opponent","end");return n.player.hand=[_("Fire",1,!0),_("Water",2,!0),_("Death",0,!0)],n=H(n,"player",0,_("Fire",3,!0)),n=H(n,"player",1,_("Water",1,!0)),n=H(n,"opponent",0,_("Speed",3,!0)),n.opponent.hand=[_("Gravity",1,!0),_("Light",2,!0)],n=Ae(n),qe(n)}},Ng={name:"Uncover nach Delete All in Lane Test",description:"Death-2 lscht alle 1/2er  Karte darunter wird uncovered  Effekt triggert",setup:t=>{let n=$e(t,["Death","Fire","Water"],["Fire","Spirit","Light"],"player","action");return n.player.hand=[_("Death",2,!0),_("Fire",3,!0),_("Water",4,!0)],n=H(n,"opponent",0,_("Fire",5,!0)),n=H(n,"opponent",0,_("Fire",2,!0)),n=H(n,"player",0,_("Fire",4,!0)),n=H(n,"player",1,_("Water",3,!0)),n=H(n,"opponent",1,_("Spirit",2,!0)),n=Ae(n),qe(n)}},Ag={name:"Mehrfach-Uncover nach Delete All Test",description:"Death-2 lscht bei beiden Spielern  beide Karten darunter werden uncovered",setup:t=>{let n=$e(t,["Death","Water","Spirit"],["Fire","Light","Gravity"],"player","action");return n.player.hand=[_("Death",2,!0),_("Spirit",3,!0)],n.opponent.hand=[_("Fire",3,!0),_("Light",5,!0)],n=H(n,"player",0,_("Water",5,!0)),n=H(n,"player",0,_("Water",1,!0)),n=H(n,"opponent",0,_("Fire",5,!0)),n=H(n,"opponent",0,_("Fire",2,!0)),n=Ae(n),qe(n)}},Rg={name:"Life-1 Uncover  Double Flip Bug",description:"Death-1 Start lscht  Life-1 uncovered  BEIDE Flips mssen ausgefhrt werden",setup:t=>{let n=$e(t,["Death","Fire","Water"],["Life","Metal","Spirit"],"player","start");return n.player.hand=[_("Fire",2,!0)],n.opponent.hand=[_("Metal",3,!0),_("Spirit",2,!0)],n=H(n,"player",0,_("Death",1,!0)),n=H(n,"opponent",0,_("Life",1,!0)),n=H(n,"opponent",0,_("Metal",0,!0)),n=H(n,"player",1,_("Water",1,!0)),n=H(n,"opponent",1,_("Metal",1,!0)),n=H(n,"opponent",2,_("Spirit",0,!0)),n=Ae(n),qe(n)}},Fg={name:"Smoke Test Playground",description:" All Smoke cards on hand - shroud your cards in mystery",setup:t=>{let n=$e(t,["Smoke","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[_("Smoke",0,!0),_("Smoke",1,!0),_("Smoke",2,!0),_("Smoke",3,!0),_("Smoke",4,!0),_("Smoke",5,!0)],n=H(n,"player",0,_("Water",2,!1)),n=H(n,"opponent",1,_("Metal",3,!1)),n=H(n,"opponent",1,_("Death",2,!0)),n=H(n,"opponent",2,_("Fire",2,!0)),n=H(n,"player",2,_("Spirit",3,!0)),n=H(n,"player",1,_("Spirit",4,!0)),n=Ae(n),qe(n)}},Dg={name:"Smoke AI Test",description:" AI spielt Smoke Karten - test all Smoke card effects with AI",setup:t=>{let n=$e(t,["Water","Spirit","Light"],["Smoke","Metal","Death"],"opponent","action");return n.opponent.hand=[_("Smoke",0,!0),_("Smoke",1,!0),_("Smoke",2,!0),_("Smoke",3,!0),_("Smoke",4,!0),_("Smoke",5,!0)],n=H(n,"opponent",0,_("Metal",2,!1)),n=H(n,"player",0,_("Water",3,!0)),n=H(n,"player",1,_("Spirit",2,!1)),n=H(n,"player",1,_("Spirit",4,!0)),n=H(n,"opponent",2,_("Death",3,!0)),n=H(n,"player",2,_("Light",2,!0)),n=H(n,"opponent",1,_("Metal",4,!0)),n=Ae(n),qe(n)}},$g={name:"Clarity Test Playground",description:"All Clarity cards on hand - see through the fog of war",setup:t=>{let n=$e(t,["Clarity","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[_("Clarity",0,!0),_("Clarity",1,!0),_("Clarity",2,!0),_("Clarity",3,!0),_("Clarity",4,!0),_("Clarity",5,!0)],n.player.deck=[_("Clarity",1,!0),_("Water",1,!0),_("Spirit",5,!0),_("Spirit",3,!0),_("Water",2,!0),_("Fire",4,!0)],n.player.discard=[_("Water",4,!0),_("Spirit",1,!0)],n=H(n,"player",0,_("Water",2,!0)),n.opponent.hand=[_("Metal",3,!0),_("Death",2,!0),_("Fire",4,!0)],n=H(n,"opponent",1,_("Metal",3,!0)),n=H(n,"opponent",2,_("Fire",2,!0)),n=Ae(n),qe(n)}},qg={name:"Clarity AI Test",description:"AI spielt Clarity Karten - test all Clarity card effects with AI",setup:t=>{let n=$e(t,["Water","Spirit","Light"],["Clarity","Metal","Death"],"opponent","action");return n.opponent.hand=[_("Clarity",0,!0),_("Clarity",1,!0),_("Clarity",2,!0),_("Clarity",3,!0),_("Clarity",4,!0),_("Clarity",5,!0)],n.opponent.deck=[_("Clarity",1,!0),_("Metal",1,!0),_("Death",5,!0),_("Death",3,!0),_("Metal",2,!0)],n.opponent.discard=[_("Metal",4,!0),_("Death",2,!0)],n.player.hand=[_("Water",3,!0),_("Spirit",2,!0),_("Light",4,!0)],n=H(n,"player",0,_("Water",3,!0)),n=H(n,"opponent",0,_("Metal",2,!0)),n=H(n,"player",1,_("Spirit",4,!0)),n=H(n,"opponent",2,_("Death",3,!0)),n=Ae(n),qe(n)}},Ig={name:"Courage Custom Playground",description:"Test all Courage effects: empty hand draw, opponent higher value delete, conditional draw/flip, highest value shift",setup:t=>{let i=$e(t,["Courage","Fire","Speed"],["Spirit","Water","Darkness"],"player","action");return i.player.hand=[_("Courage",0,!0),_("Courage",1,!0),_("Courage",2,!0),_("Courage",3,!0),_("Courage",5,!0),_("Courage",6,!0)],i=H(i,"opponent",0,_("Spirit",3,!0)),i=H(i,"opponent",0,_("Spirit",5,!0)),i=H(i,"player",0,_("Fire",3,!0)),i=H(i,"opponent",1,_("Water",6,!0)),i=H(i,"player",1,_("Speed",4,!0)),i=H(i,"opponent",2,_("Darkness",2,!0)),i=H(i,"player",2,_("Fire",5,!0)),qe(i)}},Lg={name:"Courage AI Test",description:"Test AI with Courage protocol: lane-restricted delete, self-shift to highest value lane",setup:t=>{let i=$e(t,["Spirit","Water","Fire"],["Courage","Speed","Darkness"],"opponent","action");return i.opponent.hand=[_("Courage",0,!0),_("Courage",1,!0),_("Courage",2,!0),_("Courage",3,!0),_("Courage",5,!0),_("Courage",6,!0)],i=H(i,"player",0,_("Spirit",5,!0)),i=H(i,"player",0,_("Spirit",5,!0)),i=H(i,"opponent",0,_("Speed",3,!0)),i=H(i,"player",1,_("Water",6,!0)),i=H(i,"opponent",1,_("Darkness",2,!0)),i=H(i,"opponent",1,_("Darkness",2,!1)),i=H(i,"player",2,_("Fire",3,!0)),i=H(i,"opponent",2,_("Speed",5,!0)),qe(i)}},Pg={name:"Corruption Test Playground",description:" All Corruption cards on hand - corrupt your opponent's plans",setup:t=>{let n=$e(t,["Corruption","Water","Spirit"],["Metal","Death","Fire"],"player","action");return n.player.hand=[_("Corruption",0,!0),_("Corruption",1,!0),_("Corruption",2,!0),_("Corruption",3,!0),_("Corruption",5,!0),_("Corruption",6,!0)],n=H(n,"player",0,_("Water",2,!0)),n=H(n,"opponent",0,_("Metal",3,!0)),n=H(n,"opponent",1,_("Death",4,!0)),n=H(n,"opponent",2,_("Fire",2,!0)),n=H(n,"player",1,_("Spirit",3,!0)),n=H(n,"player",1,_("Spirit",5,!0)),n.opponent.hand=[_("Fire",3,!0),_("Metal",4,!0),_("Death",5,!0)],n=Ae(n),qe(n)}},Ug={name:"Fear Custom Playground",description:"Test all Fear effects: passive ignore middle, choice shift/flip, chain discard, return, random discard",setup:t=>{let i=$e(t,["Fear","Fire","Speed"],["Spirit","Water","Darkness"],"player","action");return i.player.hand=[_("Fear",0,!0),_("Fear",1,!0),_("Fear",2,!0),_("Fear",3,!0),_("Fear",4,!0),_("Fear",5,!0)],i=H(i,"opponent",0,_("Spirit",2,!0)),i=H(i,"opponent",0,_("Spirit",3,!0)),i=H(i,"player",0,_("Fire",3,!0)),i=H(i,"opponent",1,_("Water",4,!0)),i=H(i,"player",1,_("Speed",4,!0)),i=H(i,"opponent",2,_("Darkness",2,!1)),i=H(i,"player",2,_("Fire",5,!0)),i.opponent.hand=[_("Spirit",1,!0),_("Water",2,!0),_("Darkness",3,!0),_("Spirit",4,!0)],qe(i)}},Og={name:"Fear AI Test",description:"Test AI with Fear protocol: random discard execution, passive rule handling",setup:t=>{let i=$e(t,["Spirit","Water","Fire"],["Fear","Speed","Darkness"],"opponent","action");return i.opponent.hand=[_("Fear",0,!0),_("Fear",1,!0),_("Fear",2,!0),_("Fear",3,!0),_("Fear",4,!0),_("Fear",5,!0)],i=H(i,"player",0,_("Spirit",3,!0)),i=H(i,"player",0,_("Spirit",5,!0)),i=H(i,"opponent",0,_("Speed",3,!0)),i=H(i,"player",1,_("Water",2,!0)),i=H(i,"player",1,_("Water",4,!0)),i=H(i,"player",2,_("Fire",3,!0)),i=H(i,"opponent",2,_("Darkness",5,!0)),i.player.hand=[_("Spirit",1,!0),_("Water",3,!0),_("Fire",4,!0)],qe(i)}},Mg={name:"Ice Custom Playground",description:" Test all Ice effects: conditional shift, flip block, draw block, lane-reactive discard",setup:t=>{let i=$e(t,["Ice","Fire","Speed"],["Spirit","Water","Darkness"],"player","action");return i.player.hand=[_("Ice",1,!0),_("Ice",2,!0),_("Ice",3,!0),_("Ice",4,!0),_("Ice",5,!0),_("Ice",6,!0),_("Fire",0,!0)],i=H(i,"player",0,_("Fire",3,!0)),i=H(i,"player",0,_("Fire",5,!0)),i=H(i,"opponent",1,_("Water",4,!0)),i=H(i,"player",1,_("Speed",4,!0)),i=H(i,"opponent",2,_("Darkness",2,!0)),i=H(i,"player",2,_("Fire",5,!0)),i.opponent.hand=[_("Spirit",1,!0),_("Water",2,!0),_("Darkness",3,!0)],qe(i)}},Hg={name:"Ice AI Test",description:" Test AI with Ice protocol: shift self, shift others, passive rules",setup:t=>{let i=$e(t,["Spirit","Water","Fire"],["Ice","Speed","Darkness"],"opponent","action");return i.opponent.hand=[_("Ice",1,!0),_("Ice",2,!0),_("Ice",3,!0),_("Ice",4,!0),_("Ice",5,!0),_("Ice",6,!0)],i=H(i,"player",0,_("Spirit",3,!0)),i=H(i,"player",0,_("Spirit",5,!0)),i=H(i,"opponent",0,_("Speed",3,!0)),i=H(i,"opponent",1,_("Darkness",2,!0)),i=H(i,"opponent",1,_("Darkness",4,!0)),i=H(i,"player",1,_("Water",4,!0)),i=H(i,"player",2,_("Fire",3,!0)),i=H(i,"opponent",2,_("Speed",5,!0)),i.player.hand=[_("Spirit",1,!0),_("Water",3,!0),_("Fire",4,!0)],qe(i)}},Vg={name:"End Phase Test",description:"Test the game rule for the end or start phase, only 1 trigger",setup:t=>{let i=$e(t,["Light","Fire","Speed"],["Spirit","Water","Darkness"],"player","action");return i.player.hand=[_("Light",5,!0),_("Fire",0,!0)],i=H(i,"player",0,_("Light",1,!0)),i=H(i,"player",0,_("Light",2,!0)),i=H(i,"player",1,_("Fire",3,!0)),i=H(i,"player",2,_("Speed",3,!0)),i.opponent.hand=[_("Spirit",1,!0),_("Water",2,!0),_("Darkness",3,!0)],qe(i)}},zg={name:"Start Phase Test",description:"Test the game rule for the end or start phase, only 1 trigger",setup:t=>{let i=$e(t,["Spirit","Death","Psychic"],["Light","Water","Darkness"],"player","action");return i.player.hand=[_("Spirit",5,!0),_("Death",0,!0)],i=H(i,"player",0,_("Spirit",1,!0)),i=H(i,"player",0,_("Spirit",2,!0)),i=H(i,"player",1,_("Death",1,!0)),i=H(i,"player",1,_("Spirit",3,!0)),i=H(i,"player",2,_("Psychic",1,!0)),i.opponent.hand=[_("Light",1,!0),_("Water",2,!0),_("Darkness",3,!0)],qe(i)}},Bg={name:"Committed Card Test",description:"Committed Card Test",setup:t=>{let i=$e(t,["Spirit","Darkness","Psychic"],["Light","Water","Fire"],"player","action");return i.player.hand=[_("Darkness",0,!0),_("Death",0,!0)],i=H(i,"player",0,_("Spirit",0,!0)),i=H(i,"player",0,_("Spirit",3,!0)),i=H(i,"opponent",0,_("Light",1,!0)),i=H(i,"opponent",0,_("Light",2,!0)),i.opponent.hand=[_("Light",5,!0),_("Water",2,!0),_("Darkness",3,!0)],qe(i)}},Gg={name:"Fear 0 prob Test",description:"Bla bla",setup:t=>{let i=$e(t,["Chaos","Fear","Psychic"],["Light","Water","Fire"],"player","action");return i.player.hand=[_("Chaos",2,!0),_("Fear",3,!0)],i=H(i,"player",1,_("Fear",2,!0)),i=H(i,"player",1,_("Fear",0,!0)),i=H(i,"opponent",1,_("Water",5,!0)),i=H(i,"opponent",2,_("Darkness",2,!1)),i.opponent.hand=[_("Light",5,!0),_("Water",2,!0),_("Darkness",3,!0)],qe(i)}},Yg={name:"MultiChain Test",description:"Multi Chain test",setup:t=>{let i=$e(t,["Chaos","Smoke","Test"],["Light","Water","Fire"],"player","action");return i.player.hand=[_("Smoke",1,!0),_("Chaos",3,!0)],i=H(i,"player",2,_("Test",1,!1)),i=H(i,"opponent",1,_("Water",5,!0)),i=H(i,"opponent",2,_("Darkness",2,!1)),i.opponent.hand=[_("Light",5,!0),_("Water",2,!0),_("Darkness",3,!0)],qe(i)}},Wg={name:"Light3-Uncover Test",description:"Light3-Uncover_actionType Test",setup:t=>{let i=$e(t,["Chaos","Smoke","Test"],["Light","Water","Fire"],"player","action");return i.player.hand=[_("Smoke",1,!0),_("Chaos",3,!0)],i=H(i,"player",0,_("Chaos",3,!0)),i=H(i,"player",0,_("Chaos",2,!0)),i=H(i,"player",0,_("Test",1,!1)),i.opponent.hand=[_("Light",3,!0)],qe(i)}},Qg={name:"Luck Test Playground",description:" All Luck cards on hand - gamble with fate!",setup:t=>{let n=$e(t,["Luck","Fire","Water"],["Death","Life","Gravity"],"player","action");return n.player.hand=[_("Luck",0,!0),_("Luck",1,!0),_("Luck",2,!0),_("Luck",3,!0),_("Luck",4,!0),_("Luck",5,!0)],n=H(n,"opponent",0,_("Death",3,!0)),n=H(n,"opponent",0,_("Death",2,!1)),n=H(n,"opponent",1,_("Life",2,!0)),n=H(n,"player",1,_("Fire",3,!0)),n=H(n,"opponent",2,_("Gravity",4,!0)),n=H(n,"player",2,_("Water",3,!0)),n=Ae(n),qe(n)}},Xg={name:"Luck AI Test",description:" AI spielt Luck Karten - test all Luck card effects with AI",setup:t=>{let n=$e(t,["Fire","Water","Spirit"],["Luck","Death","Life"],"opponent","action");return n.opponent.hand=[_("Luck",0,!0),_("Luck",1,!0),_("Luck",2,!0),_("Luck",3,!0),_("Luck",4,!0),_("Luck",5,!0)],n=H(n,"player",0,_("Fire",3,!0)),n=H(n,"opponent",0,_("Death",2,!0)),n=H(n,"player",1,_("Water",2,!0)),n=H(n,"player",1,_("Water",4,!1)),n=H(n,"player",2,_("Spirit",3,!0)),n=H(n,"opponent",2,_("Life",4,!0)),n=Ae(n),qe(n)}},Zg={name:"Mirror Test Playground",description:" All Mirror cards on hand - copy, reflect, and swap",setup:t=>{let n=$e(t,["Mirror","Fire","Water"],["Death","Metal","Spirit"],"player","action");return n.player.hand=[_("Mirror",0,!0),_("Mirror",1,!0),_("Mirror",2,!0),_("Mirror",3,!0),_("Mirror",4,!0),_("Mirror",5,!0)],n=H(n,"player",0,_("Fire",3,!0)),n=H(n,"player",0,_("Fire",2,!1)),n=H(n,"player",1,_("Water",4,!0)),n=H(n,"player",2,_("Water",1,!0)),n=H(n,"opponent",0,_("Death",3,!0)),n=H(n,"opponent",0,_("Death",2,!1)),n=H(n,"opponent",1,_("Metal",4,!0)),n=H(n,"opponent",2,_("Spirit",2,!0)),n.opponent.hand=[_("Metal",1,!0),_("Spirit",3,!0),_("Death",4,!0)],n=Ae(n),qe(n)}},Kg={name:"Mirror AI Test",description:" AI spielt Mirror Karten - test all Mirror card effects with AI",setup:t=>{let n=$e(t,["Fire","Water","Spirit"],["Mirror","Death","Metal"],"opponent","action");return n.opponent.hand=[_("Mirror",0,!0),_("Mirror",1,!0),_("Mirror",2,!0),_("Mirror",3,!0),_("Mirror",4,!0),_("Mirror",5,!0)],n=H(n,"opponent",0,_("Death",3,!0)),n=H(n,"opponent",0,_("Death",2,!1)),n=H(n,"opponent",1,_("Metal",4,!0)),n=H(n,"opponent",2,_("Metal",1,!0)),n=H(n,"player",0,_("Fire",3,!0)),n=H(n,"player",0,_("Fire",2,!1)),n=H(n,"player",1,_("Water",4,!0)),n=H(n,"player",2,_("Spirit",2,!0)),n.player.hand=[_("Fire",1,!0),_("Water",3,!0),_("Spirit",4,!0)],n=Ae(n),qe(n)}},Jg={name:"Peace Test Playground",description:" All Peace cards on hand - harmony, balance, sacrifice",setup:t=>{let n=$e(t,["Peace","Fire","Water"],["Death","Metal","Spirit"],"player","action");return n.player.hand=[_("Peace",1,!0),_("Peace",2,!0),_("Peace",3,!0),_("Peace",4,!0),_("Peace",5,!0),_("Peace",6,!0)],n=H(n,"player",0,_("Fire",3,!0)),n=H(n,"player",1,_("Water",4,!0)),n=H(n,"player",2,_("Water",5,!0)),n=H(n,"opponent",0,_("Death",5,!1)),n=H(n,"opponent",1,_("Metal",6,!0)),n=H(n,"opponent",2,_("Spirit",4,!0)),n.opponent.hand=[_("Metal",1,!0),_("Spirit",4,!0),_("Death",0,!0)],n=Ae(n),qe(n)}},ev={name:"Peace AI Test",description:" AI spielt Peace Karten - test all Peace card effects with AI",setup:t=>{let n=$e(t,["Fire","Water","Spirit"],["Peace","Death","Life"],"opponent","action");return n.opponent.hand=[_("Peace",1,!0),_("Peace",2,!0),_("Peace",3,!0),_("Peace",4,!0),_("Peace",5,!0),_("Peace",6,!0)],n=H(n,"player",0,_("Fire",3,!0)),n=H(n,"player",1,_("Water",4,!0)),n=H(n,"player",2,_("Spirit",5,!0)),n=H(n,"opponent",0,_("Death",2,!0)),n=H(n,"opponent",1,_("Life",3,!0)),n.player.hand=[_("Fire",1,!0),_("Water",3,!0),_("Spirit",4,!0)],n=Ae(n),qe(n)}},tv={name:"Peace-4 Reactive Test",description:" Test Peace-4: AI spielt Plague  du discardest  Peace-4 triggert  du ziehst",setup:t=>{let n=$e(t,["Peace","Fire","Water"],["Plague","Death","Life"],"opponent","action");return n=H(n,"player",0,_("Peace",4,!0)),n=H(n,"player",1,_("Fire",3,!0)),n=H(n,"player",2,_("Water",2,!0)),n.opponent.hand=[_("Plague",0,!0),_("Plague",1,!0)],n=H(n,"opponent",0,_("Death",5,!0)),n.player.hand=[_("Fire",1,!0),_("Water",3,!0),_("Peace",2,!0)],n=Ae(n),qe(n)}},nv={name:"War Custom Protocol Playground",description:"Player has War protocol with cards on board for testing reactive triggers",setup:t=>{let n=$e(t,["War","Fire","Water"],["Plague","Death","Spirit"],"player","action");return n.player.hand=[_("War",1,!0),_("War",2,!0),_("War",3,!0),_("War",4,!0),_("War",5,!0)],n=H(n,"player",2,_("War",0,!0)),n=H(n,"opponent",0,_("Fire",1,!0)),n=H(n,"opponent",1,_("Spirit",5,!0)),n=H(n,"opponent",1,_("Death",5,!0)),n.opponent.hand=[_("Death",1,!0),_("Spirit",2,!0),_("Plague",1,!0)],n=Ae(n),qe(n)}},av={name:"War AI Test",description:"AI plays with War protocol - tests reactive trigger handling",setup:t=>{let n=$e(t,["Fire","Water","Death"],["War","Plague","Spirit"],"player","action");return n=H(n,"opponent",0,_("War",0,!0)),n=H(n,"opponent",1,_("War",1,!0)),n=H(n,"opponent",2,_("War",2,!0)),n=H(n,"player",0,_("Fire",1,!0)),n=H(n,"player",1,_("Water",2,!0)),n=H(n,"player",2,_("Death",1,!0)),n.player.hand=[_("Fire",2,!0),_("Water",3,!0),_("Death",2,!0)],n.opponent.hand=[_("Spirit",1,!0),_("Plague",2,!0)],n=Ae(n),qe(n)}},ov={name:"Time Test Playground",description:" All Time cards on hand - manipulate trash and deck",setup:t=>{const n=["Time","Clarity","Life"],r=["Fire","Water","Death"];let i=$e(t,n,r,"player","action");const s=[_("Time",0),_("Time",1),_("Time",2),_("Time",3),_("Time",4),_("Time",5)],d=[_("Life",3),_("Clarity",2),_("Life",1)];i={...i,player:{...i.player,hand:s,discard:d}},i=H(i,"player",0,_("Clarity",0,!0)),i=H(i,"player",0,_("Life",0,!1)),i=H(i,"opponent",1,_("Fire",2,!1));const u=[...s,...d,...i.player.lanes.flat(),...i.opponent.lanes.flat()];return i.player.deck=tn(n,u),i.opponent.deck=tn(r,[]),i=Ae(i),qe(i)}},rv={name:"Time AI Test",description:" AI plays Time cards - test trash selection and shuffle triggers",setup:t=>{const n=["Fire","Water","Death"],r=["Time","Clarity","Life"];let i=$e(t,n,r,"opponent","action");const s=[_("Fire",2),_("Water",3)],d=[_("Time",0),_("Time",1),_("Time",2),_("Time",3),_("Time",4),_("Time",5)],u=[_("Life",4),_("Clarity",3)];i={...i,player:{...i.player,hand:s},opponent:{...i.opponent,hand:d,discard:u}},i=H(i,"player",0,_("Fire",1,!0)),i=H(i,"player",0,_("Water",0,!1)),i=H(i,"opponent",1,_("Clarity",1,!0));const p=[...s,...d,...u,...i.player.lanes.flat(),...i.opponent.lanes.flat()];return i.player.deck=tn(n,p),i.opponent.deck=tn(r,p),i=Ae(i),qe(i)}},lv={name:"Assimilation Test Playground",description:"All Assimilation cards on hand - steal, draw from opponent, play to opponent's board",setup:t=>{const n=["Assimilation","Clarity","Life"],r=["Fire","Water","Death"];let i=$e(t,n,r,"player","action");const s=[_("Assimilation",0),_("Assimilation",1),_("Assimilation",2),_("Assimilation",4),_("Assimilation",5),_("Assimilation",6)];i={...i,player:{...i.player,hand:s}},i=H(i,"opponent",0,_("Fire",3,!1)),i=H(i,"opponent",0,_("Fire",2,!1)),i=H(i,"opponent",1,_("Water",4,!0)),i=H(i,"opponent",2,_("Death",1,!1)),i=H(i,"player",0,_("Clarity",0,!0)),i=H(i,"player",1,_("Life",1,!0));const d=[...s,...i.player.lanes.flat(),...i.opponent.lanes.flat()];return i.player.deck=tn(n,d),i.opponent.deck=tn(r,[]),i=Ae(i),qe(i)}},sv={name:"Assimilation AI Test",description:"AI plays Assimilation cards - test steal and play to opponent's board",setup:t=>{const n=["Fire","Water","Death"],r=["Assimilation","Clarity","Life"];let i=$e(t,n,r,"opponent","action");const s=[_("Fire",2),_("Water",3)],d=[_("Assimilation",0),_("Assimilation",1),_("Assimilation",2),_("Assimilation",4),_("Assimilation",5),_("Assimilation",6)];i={...i,player:{...i.player,hand:s},opponent:{...i.opponent,hand:d}},i=H(i,"player",0,_("Fire",5,!1)),i=H(i,"player",1,_("Water",4,!0)),i=H(i,"player",2,_("Death",2,!1)),i=H(i,"opponent",0,_("Clarity",1,!0));const u=[...s,...d,...i.player.lanes.flat(),...i.opponent.lanes.flat()];return i.player.deck=tn(n,u),i.opponent.deck=tn(r,[]),i=Ae(i),qe(i)}},iv={name:"Diversity Test Playground",description:"All Diversity cards on hand - test auto-compile, value modifiers, and protocol-count effects",setup:t=>{const n=["Diversity","Fire","Water"],r=["Death","Life","Light"];let i=$e(t,n,r,"player","action");const s=[_("Diversity",0),_("Diversity",1),_("Diversity",3),_("Diversity",4),_("Diversity",5),_("Diversity",6)];i={...i,player:{...i.player,hand:s}},i=H(i,"player",0,_("Fire",2,!0)),i=H(i,"player",1,_("Water",3,!0)),i=H(i,"opponent",0,_("Death",4,!0)),i=H(i,"opponent",1,_("Life",2,!0)),i=H(i,"opponent",2,_("Light",1,!0));const d=[...s,...i.player.lanes.flat(),...i.opponent.lanes.flat()];return i.player.deck=tn(n,d),i.opponent.deck=tn(r,[]),i=Ae(i),qe(i)}},cv={name:"Diversity AI Test",description:"AI plays Diversity cards - test auto-compile and conditional effects",setup:t=>{const n=["Fire","Water","Death"],r=["Diversity","Life","Light"];let i=$e(t,n,r,"opponent","action");const s=[_("Fire",2),_("Water",3)],d=[_("Diversity",0),_("Diversity",1),_("Diversity",3),_("Diversity",4),_("Diversity",5),_("Diversity",6)];i={...i,player:{...i.player,hand:s},opponent:{...i.opponent,hand:d}},i=H(i,"player",0,_("Fire",4,!0)),i=H(i,"player",1,_("Water",2,!0)),i=H(i,"player",2,_("Death",1,!0)),i=H(i,"opponent",0,_("Life",3,!0)),i=H(i,"opponent",1,_("Light",2,!0));const u=[...s,...d,...i.player.lanes.flat(),...i.opponent.lanes.flat()];return i.player.deck=tn(n,u),i.opponent.deck=tn(r,[]),i=Ae(i),qe(i)}},dv={name:"Unity Custom Playground (Player)",description:"Test Unity synergy effects - cards become stronger with more face-up Unity on field",setup:t=>{const n=["Unity","Fire","Water"],r=["Death","Spirit","Light"];let i=$e(t,n,r,"player","action");const s=[_("Unity",0,!0),_("Unity",1,!0),_("Unity",2,!0),_("Unity",3,!0),_("Unity",4,!0),_("Unity",5,!0)];i.player.hand=s;const d=[_("Death",1,!0),_("Spirit",2,!0),_("Light",3,!0)];i.opponent.hand=d,i=H(i,"player",0,_("Fire",2,!0)),i=H(i,"opponent",0,_("Death",3,!0));const u=[...s,...d,...i.player.lanes.flat(),...i.opponent.lanes.flat()];return i.player.deck=tn(n,u),i.opponent.deck=tn(r,[]),i=Ae(i),qe(i)}},uv={name:"Unity AI Test (Opponent)",description:"Test AI handling of Unity synergy effects",setup:t=>{const n=["Fire","Water","Spirit"],r=["Unity","Death","Light"];let i=$e(t,n,r,"opponent","action");const s=[_("Fire",1,!0),_("Water",2,!0),_("Spirit",3,!0)];i.player.hand=s;const d=[_("Unity",0,!0),_("Unity",2,!0),_("Unity",3,!0),_("Unity",5,!0)];i.opponent.hand=d,i=H(i,"opponent",0,_("Unity",1,!0)),i=H(i,"player",1,_("Fire",4,!0));const u=[...s,...d,...i.player.lanes.flat(),...i.opponent.lanes.flat()];return i.player.deck=tn(n,u),i.opponent.deck=tn(r,[]),i=Ae(i),qe(i)}},pv=[Uy,Oy,My,Hy,Vy,zy,By,Gy,Yy,Wy,Qy,Xy,Zy,Ky,Jy,eg,tg,ng,ag,og,rg,sj,ij,cj,dj,uj,pj,lg,sg,ig,cg,dg,ug,pg,fg,hg,mg,yg,gg,vg,_g,wg,xg,Cg,Sg,bg,Eg,jg,kg,Tg,Ng,Ag,Rg,Fg,Dg,$g,qg,Pg,Ig,Lg,Ug,Og,Mg,Hg,Vg,zg,Bg,Gg,Yg,Wg,Qg,Xg,Zg,Kg,Jg,ev,tv,nv,av,ov,rv,lv,sv,iv,cv,dv,uv],fj=Object.freeze(Object.defineProperty({__proto__:null,allScenarios:pv,scenario10_Hate1Interrupt:Gy,scenario11_Darkness1HateChain:Yy,scenario12_Water4TurnEnd:Wy,scenario13_Psychic3ShiftTest:Qy,scenario14_Death1UncoverTest:Xy,scenario15_Gravity2ShiftInterrupt:Zy,scenario16_Hate2PlayerPlays:Ky,scenario171_Hate2AIPlays:eg,scenario17_Hate2AIPlays:Jy,scenario18_Hate2SelfDelete:tg,scenario19_Hate2MultipleTies:ng,scenario1_Psychic3Uncover:Uy,scenario20_Hate2FaceDown:ag,scenario21_Hate2AIValidation:og,scenario22_Hate2AIPlaysOpen:rg,scenario29_FireCustomConditional:lg,scenario2_Psychic4EndEffect:Oy,scenario30_AnarchyCustomPlayground:sg,scenario31_DarkCustPlayground:ig,scenario32_ApathyCustomPlayground:cg,scenario33_DeathCustomPlayground:dg,scenario34_WaterCustomPlayground:ug,scenario35_SpiritCustomPlayground:pg,scenario36_ChaosCustomPlayground:fg,scenario37_GravityCustomPlayground:hg,scenario38_FrostCustomPlayground:mg,scenario39_HateCustomPlayground:yg,scenario3_Spirit3EndPhase:My,scenario40_LifeCustomPlayground:gg,scenario41_LightCustomPlayground:vg,scenario42_Death2UncoverInterruptTurn:_g,scenario43_Apathy5DoubleUncover:wg,scenario44_Psychic1Darkness2Test:xg,scenario45_SpeedCustomPlayground:Cg,scenario46_MetalCustomPlayground:Sg,scenario47_PlagueCustomPlayground:bg,scenario48_LoveCustomPlayground:Eg,scenario49_PsychicCustomPlayground:jg,scenario4_Plague2Actor:Hy,scenario50_Gravity2SingleCardBug:kg,scenario51_Speed3EndEffectSoftlock:Tg,scenario52_UncoverAfterBulkDelete:Ng,scenario53_MultiUncoverAfterBulkDelete:Ag,scenario54_Life1UncoverDoubleFlip:Rg,scenario55_SmokeCustomPlayground:Fg,scenario56_SmokeAITest:Dg,scenario57_ClarityCustomPlayground:$g,scenario58_ClarityAITest:qg,scenario59_CorruptionCustomPlayground:Pg,scenario5_Darkness1Interrupt:Vy,scenario60_CourageCustomPlayground:Ig,scenario61_CourageAITest:Lg,scenario62_FearCustomPlayground:Ug,scenario63_FearAITest:Og,scenario64_IceCustomPlayground:Mg,scenario65_IceAITest:Hg,scenario66_endPhasePlayground:Vg,scenario67_startPhasePlayground:zg,scenario68_CommittedCardPlayground:Bg,scenario69_fear0shiftCardPlayground:Gg,scenario70_multiChainCardPlayground:Yg,scenario71_Light3ProblemPlayground:Wg,scenario72_LuckCustomPlayground:Qg,scenario73_LuckAITest:Xg,scenario74_MirrorCustomPlayground:Zg,scenario75_MirrorAITest:Kg,scenario76_PeaceCustomPlayground:Jg,scenario77_PeaceAITest:ev,scenario78_Peace4ReactiveTest:tv,scenario79_WarCustomPlayground:nv,scenario80_WarAITest:av,scenario81_TimeCustomPlayground:ov,scenario82_TimeAITest:rv,scenario83_AssimilationCustomPlayground:lv,scenario84_AssimilationAITest:sv,scenario85_DiversityCustomPlayground:iv,scenario86_DiversityAITest:cv,scenario87_UnityCustomPlayground:dv,scenario88_UnityAITest:uv,scenario8_Plague4Owner:zy,scenario9_Water:By},Symbol.toStringTag,{value:"Module"})),hj=({onLoadScenario:t,onSkipCoinFlip:n,onForceWin:r,onForceLose:i})=>{const[s,d]=se.useState(!1);return s?o.jsxs("div",{style:{position:"fixed",top:"20px",left:"20px",width:"400px",maxHeight:"600px",backgroundColor:"#2c2c2c",border:"2px solid #ff6b6b",borderRadius:"8px",padding:"20px",zIndex:9999,overflowY:"auto",color:"white",fontFamily:"monospace"},children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"20px"},children:[o.jsx("h3",{style:{margin:0},children:" Debug Panel"}),o.jsx("button",{onClick:()=>d(!1),style:{backgroundColor:"transparent",border:"none",color:"white",cursor:"pointer",fontSize:"20px"},children:""})]}),o.jsx("div",{style:{marginBottom:"15px",fontSize:"12px",color:"#aaa"},children:"Lade vordefinierte Test-Szenarien zum Testen der Actor/Owner-Fixes."}),o.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:pv.map((u,p)=>o.jsxs("div",{style:{backgroundColor:"#1a1a1a",padding:"12px",borderRadius:"5px",border:"1px solid #444"},children:[o.jsx("div",{style:{fontWeight:"bold",marginBottom:"5px",color:"#4ecdc4"},children:u.name}),o.jsx("div",{style:{fontSize:"11px",color:"#bbb",marginBottom:"10px"},children:u.description}),o.jsx("button",{onClick:()=>{n&&n(),t(u.setup),d(!1)},style:{padding:"6px 12px",backgroundColor:"#4ecdc4",color:"#1a1a1a",border:"none",borderRadius:"3px",cursor:"pointer",fontWeight:"bold",fontSize:"12px"},children:"Load Scenario"})]},p))}),(r||i)&&o.jsxs("div",{style:{marginTop:"20px",paddingTop:"15px",borderTop:"1px solid #444",display:"flex",gap:"10px",justifyContent:"center"},children:[r&&o.jsx("button",{onClick:()=>{r(),d(!1)},style:{padding:"10px 20px",backgroundColor:"#4ecdc4",color:"#1a1a1a",border:"none",borderRadius:"5px",cursor:"pointer",fontWeight:"bold",fontSize:"14px"},children:" Force Win"}),i&&o.jsx("button",{onClick:()=>{i(),d(!1)},style:{padding:"10px 20px",backgroundColor:"#ff6b6b",color:"white",border:"none",borderRadius:"5px",cursor:"pointer",fontWeight:"bold",fontSize:"14px"},children:" Force Lose"})]}),o.jsx("div",{style:{marginTop:"20px",fontSize:"11px",color:"#666",textAlign:"center"},children:"Drcke ESC oder klicke  zum Schlieen"})]}):o.jsx("button",{onClick:()=>d(!0),style:{position:"fixed",top:"20px",left:"20px",padding:"10px 20px",backgroundColor:"#ff6b6b",color:"white",border:"none",borderRadius:"5px",cursor:"pointer",fontWeight:"bold",zIndex:9999,fontSize:"14px"},children:" DEBUG"})},Am=(t,n)=>{if(!n)return null;for(const r of["player","opponent"])for(const i of t[r].lanes){const s=i.find(d=>d.id===n);if(s)return{card:s,owner:r}}return null},mj=new Set(["discard","select_card_from_hand_to_play","select_card_from_hand_to_give","select_card_from_hand_to_reveal","plague_2_player_discard","select_cards_from_hand_to_discard_for_fire_4","select_cards_from_hand_to_discard_for_hate_1"]);function yj({onBack:t,onEndGame:n,playerProtocols:r,opponentProtocols:i,difficulty:s,useControlMechanic:d,startingPlayer:u="player"}){var Fa,wa,kn,Jn,_n,wn,Tn,xn,Nt,xa,Ca,gn,Cn,he,Fe,Pe;const[p,f]=se.useState(null),[h,w]=se.useState(!0),{startGame:g,endGame:y,trackPlayerCoinFlip:m,trackPlayerRearrange:x}=lj(r,s,d),S=se.useCallback((ge,ve,Te)=>{f(ge),w(!1),m(ve,Te)},[m]),E=se.useCallback(()=>{f("player"),w(!1),g()},[g]);se.useEffect(()=>{!h&&p&&g()},[h,p,g]);const j=se.useCallback((ge,ve)=>{const Te=ve.player.compiled.filter(Le=>Le).length;y(ge,ve.stats.player,Te,ve.stats.opponent,ve.detailedGameStats),n(ge,ve)},[y,n]),{gameState:b,selectedCard:k,setSelectedCard:N,playSelectedCard:U,fillHand:V,discardCardFromHand:R,compileLane:O,resolveActionWithCard:X,resolveActionWithLane:M,selectHandCardForAction:$,resolveActionWithHandCard:B,skipAction:I,resolveOptionalDrawPrompt:D,resolveDeath1Prompt:L,resolveLove1Prompt:T,resolvePlague2Discard:q,resolvePlague4Flip:P,resolveFire3Prompt:Z,resolveOptionalDiscardCustomPrompt:G,resolveOptionalEffectPrompt:A,resolveFire4Discard:W,resolveHate1Discard:J,resolveLight2Prompt:Q,resolveRevealBoardCardPrompt:ee,resolveRearrangeProtocols:oe,resolveSpirit1Prompt:me,resolveSpirit3Prompt:ke,resolveSwapProtocols:xe,resolveSpeed3Prompt:ie,resolvePsychic4Prompt:K,resolveControlMechanicPrompt:z,resolveCustomChoice:le,resolveSelectRevealedDeckCard:ne,resolveRevealDeckDrawProtocol:ue,resolveStateNumber:ce,resolveStateProtocol:Se,resolveSelectFromDrawnToReveal:De,resolveConfirmDeckDiscard:be,resolveConfirmDeckPlayPreview:Ge,resolveSelectTrashCardToPlay:Be,resolveSelectTrashCardToReveal:Me,setupTestScenario:He}=Cx(r,i,j,s,d,p??"player",x),[je,Re]=se.useState(null),[Ie,Ve]=se.useState([]),[it,nt]=se.useState(!1),[Rt,Zt]=se.useState([]),nn=se.useRef(b.log.length),[an,Lt]=se.useState(!1),[hn,Pt]=se.useState(!1),[fa,ha]=se.useState(null),[Ma,Ln]=se.useState(!1),[Zn,En]=se.useState(0),Ht=se.useRef(null),mn=se.useRef(b);se.useEffect(()=>{mn.current=b},[b]);const Pn=()=>{const ge=Zn+1;if(En(ge),ge>=5){Ln(ve=>!ve),En(0),Ht.current&&(clearTimeout(Ht.current),Ht.current=null);return}Ht.current&&clearTimeout(Ht.current),Ht.current=setTimeout(()=>{En(0),Ht.current=null},2e3)},Ha=se.useCallback(()=>{console.log("Debug: Forcing player win via DebugPanel."),j("player",b)},[j,b]),ka=se.useCallback(()=>{console.log("Debug: Forcing player loss via DebugPanel."),j("opponent",b)},[j,b]),ma=se.useMemo(()=>{if(b.lastPlayedCardId){const ge=Am(b,b.lastPlayedCardId);if(ge){const ve=ge.owner==="player"||ge.card.isFaceUp;return{card:ge.card,showContents:ve}}}return null},[b.lastPlayedCardId,b.player.lanes,b.opponent.lanes]),Un=se.useMemo(()=>{var ve;const ge=(ve=b.actionRequired)==null?void 0:ve.sourceCardId;if(ge){const Te=Am(b,ge);if(Te){const Le=Te.owner==="player"||Te.card.isFaceUp;return{card:Te.card,showContents:Le}}}return null},[(Fa=b.actionRequired)==null?void 0:Fa.sourceCardId,b.player.lanes,b.opponent.lanes]);se.useEffect(()=>{var ge;(ge=b.actionRequired)!=null&&ge.sourceCardId&&Re(null)},[(wa=b.actionRequired)==null?void 0:wa.sourceCardId]);const Ta=je||Un||ma;se.useEffect(()=>{b.log.length>nn.current&&b.log.slice(nn.current).forEach(ve=>{if(ve.message!=="Game Started."){const Te={message:ve.message,player:ve.player,id:st()};Zt(Le=>[...Le,Te]),setTimeout(()=>{Zt(Le=>Le.filter(Oe=>Oe.id!==Te.id))},5e3)}}),nn.current=b.log.length},[b.log]),se.useEffect(()=>{var ve,Te,Le,Oe,Je;!(((ve=b.actionRequired)==null?void 0:ve.type)==="discard"&&((Te=b.actionRequired)==null?void 0:Te.variableCount))&&((Le=b.actionRequired)==null?void 0:Le.type)!=="plague_2_player_discard"&&((Oe=b.actionRequired)==null?void 0:Oe.type)!=="select_cards_from_hand_to_discard_for_fire_4"&&((Je=b.actionRequired)==null?void 0:Je.type)!=="select_cards_from_hand_to_discard_for_hate_1"&&Ve([])},[b.actionRequired]),se.useEffect(()=>{var ge,ve;Lt(((ge=b.actionRequired)==null?void 0:ge.type)==="prompt_rearrange_protocols"&&b.actionRequired.actor==="player"),Pt(((ve=b.actionRequired)==null?void 0:ve.type)==="prompt_swap_protocols"&&b.actionRequired.actor==="player")},[b.actionRequired]),se.useEffect(()=>{const ge=ve=>{ve.ctrlKey&&ve.shiftKey&&(ve.preventDefault(),ve.key.toLowerCase()==="d"?(console.log("Debug: Toggling debug button visibility."),Ln(Te=>!Te)):ve.key.toLowerCase()==="w"?(console.log("Debug: Forcing player win."),n("player",b)):ve.key.toLowerCase()==="o"?(console.log("Debug: Forcing opponent win."),n("opponent",b)):ve.key.toLowerCase()==="p"?(console.log("Debug: Setting up Speed-0 interrupt scenario."),He("speed-0-interrupt")):ve.key.toLowerCase()==="l"?(console.log("Debug: Setting up Speed-1 discard trigger scenario."),He("speed-1-trigger")):ve.key.toLowerCase()==="f"?(console.log("Debug: Setting up Fire On-Cover test scenario."),He("fire-oncover-test")):ve.key.toLowerCase()==="s"?(console.log("Debug: Setting up Speed-2 + Control test scenario."),He("speed-2-control-test")):ve.key.toLowerCase()==="u"&&(console.log("Debug: Setting up Death-1 Uncover test scenario."),Q0(()=>Promise.resolve().then(()=>fj),void 0).then(Te=>{He(Te.scenario14_Death1UncoverTest.setup)})))};return window.addEventListener("keydown",ge),()=>{window.removeEventListener("keydown",ge)}},[b,n,He]);const Kn=(ge,ve)=>{var io,za,ea,co,uo,ta;const Te=mn.current;if(Te.animationState)return;const{actionRequired:Le,turn:Oe,phase:Je,compilableLanes:Qe,player:Xe,opponent:gt}=Te;if(ve==="player"&&Oe==="player"&&Je==="compile"&&Qe.includes(ge)){if(Le){console.warn("Compile click blocked by pending action:",Le);return}O(ge);return}if(Le&&Le.actor==="player"&&["select_lane_for_shift","select_lane_for_shift_all","shift_flipped_card_optional","select_lane_for_play","select_lane_for_delete","select_lane_for_death_2","select_lane_for_life_3_play","select_lane_to_shift_revealed_card_for_light_2","select_lane_to_shift_revealed_board_card_custom","select_lane_to_shift_cards_for_light_3","select_lane_for_water_3","select_lane_for_metal_3_delete","select_lane_for_delete_all","select_lane_for_return","select_lanes_for_swap_stacks"].includes(Le.type)){M(ge);return}const Ct=gt.lanes.flat().some(Vt=>Vt.isFaceUp&&Vt.protocol==="Psychic"&&Vt.value===1),St=gt.lanes[ge],on=St.length>0&&St[St.length-1].isFaceUp&&St[St.length-1].protocol==="Plague"&&St[St.length-1].value===0;if(k&&Je==="action"&&!Le&&Xe.hand.some(Vt=>Vt.id===k)&&!on){const Vt=Xe.hand.find(Ft=>Ft.id===k);if(ve==="opponent"){if(!ns(Te,Vt)){N(null),Re(null);return}if(Ct){N(null),Re(null);return}U(ge,!0,"opponent"),Re(null);return}const Go=Xe.lanes.flat().some(Ft=>Ft.isFaceUp&&Ft.protocol==="Spirit"&&Ft.value===1),Yo=((za=(io=Vt.customEffects)==null?void 0:io.bottomEffects)==null?void 0:za.some(Ft=>{var Kt,Jt;return((Kt=Ft.params)==null?void 0:Kt.action)==="card_property"&&((Jt=Ft.params)==null?void 0:Jt.property)==="ignore_protocol_matching"}))||((co=(ea=Vt.customEffects)==null?void 0:ea.topEffects)==null?void 0:co.some(Ft=>{var Kt,Jt;return((Kt=Ft.params)==null?void 0:Kt.action)==="card_property"&&((Jt=Ft.params)==null?void 0:Jt.property)==="ignore_protocol_matching"}))||((ta=(uo=Vt.customEffects)==null?void 0:uo.middleEffects)==null?void 0:ta.some(Ft=>{var Kt,Jt;return((Kt=Ft.params)==null?void 0:Kt.action)==="card_property"&&((Jt=Ft.params)==null?void 0:Jt.property)==="ignore_protocol_matching"})),po=[...Xe.lanes.flat(),...gt.lanes.flat()].some(Ft=>Ft.isFaceUp&&Ft.protocol==="Anarchy"&&Ft.value===1),vr=ou(Te),_r=Ri(Te,"player",ge),Ba=ns(Te,Vt),Nn=il(Te,"player",ge,Vt.protocol);let Sa;Ba?Sa=!Ct:po||vr?Sa=Vt.protocol!==Xe.protocols[ge]&&Vt.protocol!==gt.protocols[ge]&&!Ct:Sa=(Go||_r||Yo||Nn||Vt.protocol===Xe.protocols[ge]||Vt.protocol===gt.protocols[ge])&&!Ct,U(ge,Sa),Re(null);return}k&&(N(null),Re(null))},Na=ge=>{const ve=mn.current;if(ve.animationState||!k)return;const{phase:Te,actionRequired:Le,player:Oe}=ve;Te!=="action"||Le||!Oe.hand.some(Je=>Je.id===k)||(U(ge,!1),Re(null))},Aa=ge=>{const ve=mn.current;if(!ve.animationState){if(ve.actionRequired){if(ve.actionRequired.type==="discard"&&ve.actionRequired.actor==="player"){const Te=ve.actionRequired.count;if(Te>1||ve.actionRequired.variableCount){Ve(Le=>Le.includes(ge.id)?Le.filter(Oe=>Oe!==ge.id):!ve.actionRequired.variableCount&&Le.length>=Te?Le:[...Le,ge.id]);return}else{R(ge.id);return}}if(ve.actionRequired.type==="select_card_from_hand_to_play"){$(ge.id);return}if(ve.actionRequired.type==="select_card_from_hand_to_give"||ve.actionRequired.type==="select_card_from_hand_to_reveal"){B(ge.id);return}if(ve.actionRequired.type==="plague_2_player_discard"||ve.actionRequired.type==="select_cards_from_hand_to_discard_for_fire_4"||ve.actionRequired.type==="select_cards_from_hand_to_discard_for_hate_1"){Ve(Te=>Te.includes(ge.id)?Te.filter(Le=>Le!==ge.id):[...Te,ge.id]);return}return}ve.turn!=="player"||ve.phase!=="action"&&ve.phase!=="compile"||(ge.id===k?(N(null),Re(null)):(N(ge.id),Re({card:ge,showContents:!0})))}},ya=(ge,ve,Te)=>{const Le=mn.current;if(Le.animationState)return;const{actionRequired:Oe,turn:Je,phase:Qe,compilableLanes:Xe}=Le;if(Je==="player"&&Qe==="compile"&&Xe.includes(Te)){Kn(Te,ve);return}if(Je==="player"&&!Oe&&k&&Qe==="action"){Kn(Te,ve);return}if(Oe&&Oe.actor==="player"&&(Oe.type==="select_own_highest_card_to_delete_for_hate_2"||Oe.type==="select_opponent_highest_card_to_delete_for_hate_2")&&Ni(ge,Le)){X(ge.id);return}if(Ni(ge,Le))X(ge.id);else if(k)N(null),Re(null);else{const gt=ve==="player"||ge.isFaceUp;Re({card:ge,showContents:gt})}},ga=ge=>{k||Re({card:ge,showContents:!0})},Ra=(ge,ve)=>{if(!k){const Te=ve==="player"||ge.isFaceUp;Re({card:ge,showContents:Te})}},va=()=>{k||Re(null)},yn=ge=>{!k&&!b.actionRequired&&Re({card:ge,showContents:ge.isRevealed||!1})},Dt=()=>{if(!Ta)return null;const{card:ge,showContents:ve}=Ta;return o.jsx(xt,{card:ge,isFaceUp:ve})},Ut=b.turn==="player"&&!b.actionRequired&&b.phase==="compile"&&b.compilableLanes.length>0,jn=((kn=b.actionRequired)==null?void 0:kn.sourceCardId)??null,_a=se.useMemo(()=>{var ge;return(ge=b.actionRequired)!=null&&ge.actor?b.actionRequired.actor==="player"?"action-required-player":"action-required-opponent":""},[b.actionRequired]),Va=se.useMemo(()=>{const ge=b.actionRequired;return ge&&ge.actor==="player"?mj.has(ge.type)?"":"hand-in-background":""},[b.actionRequired]);return o.jsxs("div",{className:"screen game-screen",children:[fa&&o.jsx(Ox,{player:fa,playerState:b[fa],onClose:()=>ha(null),difficulty:s}),an&&((Jn=b.actionRequired)==null?void 0:Jn.type)==="prompt_rearrange_protocols"&&o.jsx(Rx,{gameState:b,targetPlayer:b.actionRequired.target,onConfirm:ge=>{var ve,Te;((ve=b.actionRequired)==null?void 0:ve.sourceCardId)==="CONTROL_MECHANIC"&&((Te=b.actionRequired)!=null&&Te.actor)&&x(b.actionRequired.actor),oe(ge),Lt(!1)}}),hn&&((_n=b.actionRequired)==null?void 0:_n.type)==="prompt_swap_protocols"&&o.jsx(Fx,{gameState:b,targetPlayer:b.actionRequired.target,onConfirm:ge=>{xe(ge),Pt(!1)}}),(((wn=b.actionRequired)==null?void 0:wn.type)==="select_card_from_revealed_deck"||((Tn=b.actionRequired)==null?void 0:Tn.type)==="reveal_deck_draw_protocol")&&b.actionRequired.actor==="player"&&o.jsx(Ix,{gameState:b,onSelectCard:ge=>{ne(ge)},onConfirmProtocolDraw:()=>{ue()}}),((xn=b.actionRequired)==null?void 0:xn.type)==="select_card_from_trash_to_play"&&b.actionRequired.actor==="player"&&o.jsx(Tm,{gameState:b,onSelectCard:ge=>{Be(ge)}}),((Nt=b.actionRequired)==null?void 0:Nt.type)==="select_card_from_trash_to_reveal"&&b.actionRequired.actor==="player"&&o.jsx(Tm,{gameState:b,onSelectCard:ge=>{Me(ge)}}),((xa=b.actionRequired)==null?void 0:xa.type)==="prompt_optional_effect"&&b.actionRequired.actor==="player"&&o.jsx(Lx,{gameState:b,onAccept:()=>A(!0),onDecline:()=>A(!1)}),((Ca=b.actionRequired)==null?void 0:Ca.type)==="state_number"&&b.actionRequired.actor==="player"&&o.jsx(Dx,{gameState:b,onConfirm:ge=>ce(ge)}),((gn=b.actionRequired)==null?void 0:gn.type)==="state_protocol"&&b.actionRequired.actor==="player"&&o.jsx($x,{gameState:b,availableProtocols:b.actionRequired.availableProtocols||[],onConfirm:ge=>Se(ge)}),((Cn=b.actionRequired)==null?void 0:Cn.type)==="select_from_drawn_to_reveal"&&b.actionRequired.actor==="player"&&o.jsx(qx,{gameState:b,allDrawnCardIds:b.actionRequired.allDrawnCardIds||[],eligibleCardIds:b.actionRequired.eligibleCardIds||[],statedNumber:b.actionRequired.statedNumber,revealCount:b.actionRequired.revealCount,onConfirm:ge=>De(ge),onClose:()=>{De("")}}),((he=b.actionRequired)==null?void 0:he.type)==="confirm_deck_discard"&&b.actionRequired.actor==="player"&&o.jsx(Px,{discardedCard:b.actionRequired.discardedCard,deckOwner:b.actionRequired.deckOwner,onConfirm:()=>be()}),((Fe=b.actionRequired)==null?void 0:Fe.type)==="confirm_deck_play_preview"&&b.actionRequired.actor==="player"&&o.jsx(Ux,{card:b.actionRequired.drawnCard,isFaceDown:b.actionRequired.isFaceDown,onConfirm:()=>Ge()}),o.jsx("div",{className:"toaster-container",children:Rt.map(ge=>o.jsx(Ax,{message:ge.message,player:ge.player},ge.id))}),it&&o.jsx(Nx,{log:b.log,onClose:()=>nt(!1)}),o.jsx("button",{className:"btn log-button",onClick:()=>nt(!0),children:"Log"}),o.jsxs("div",{className:"game-screen-layout",children:[o.jsxs("div",{className:"game-preview-container",children:[o.jsx("h2",{onClick:Pn,style:{cursor:"pointer",userSelect:"none"},title:"Click 5 times to toggle debug mode",children:"Mainframe"}),o.jsx(jx,{gameState:b,turn:((Pe=b.actionRequired)==null?void 0:Pe.actor)||b.turn,animationState:b.animationState,difficulty:s,onPlayerClick:()=>ha("player"),onOpponentClick:()=>ha("opponent")}),o.jsx("div",{className:"preview-card-area",children:Dt()}),o.jsx("button",{className:"btn btn-back",onClick:t,children:"Back"})]}),o.jsxs("div",{className:"game-main-area",children:[Ut&&o.jsx("div",{className:"compile-prompt-container",children:o.jsx("h3",{children:"Select a Protocol to Compile"})}),o.jsx(Sx,{gameState:b,onLanePointerDown:Kn,onPlayFaceDown:Na,selectedCardId:k,onCardPointerDown:ya,onCardPointerEnter:Ra,onCardPointerLeave:va,onOpponentHandCardPointerEnter:yn,onOpponentHandCardPointerLeave:va,sourceCardId:jn}),o.jsxs("div",{className:"player-action-area",children:[o.jsx(bx,{gameState:b,onFillHand:V,onSkipAction:I,onResolveOptionalDrawPrompt:D,onResolveDeath1Prompt:L,onResolveLove1Prompt:T,onResolvePlague2Discard:q,onResolvePlague4Flip:P,onResolveFire3Prompt:Z,onResolveOptionalDiscardCustomPrompt:G,onResolveOptionalEffectPrompt:A,onResolveSpeed3Prompt:ie,onResolveFire4Discard:W,onResolveHate1Discard:J,onResolveLight2Prompt:Q,onResolveRevealBoardCardPrompt:ee,onResolvePsychic4Prompt:K,onResolveSpirit1Prompt:me,onResolveSpirit3Prompt:ke,onResolveControlMechanicPrompt:z,onResolveCustomChoice:le,selectedCardId:k,multiSelectedCardIds:Ie,actionRequiredClass:_a}),o.jsx("div",{className:`player-hand-area ${Va}`,children:b.player.hand.filter(ge=>{const ve=b.actionRequired;return(ve==null?void 0:ve.type)==="select_card_from_hand_to_play"&&(ve==null?void 0:ve.selectableCardIds)?ve.selectableCardIds.includes(ge.id):!0}).map(ge=>{var Te;const ve=((Te=b.actionRequired)==null?void 0:Te.type)==="select_lane_for_play"?ge.id===b.actionRequired.cardInHandId:ge.id===k;return o.jsx(xt,{card:ge,isFaceUp:!0,onPointerDown:()=>Aa(ge),onPointerEnter:()=>ga(ge),isSelected:ve,isMultiSelected:Ie.includes(ge.id),animationState:b.animationState,additionalClassName:"in-hand"},ge.id)})})]})]})]}),h&&o.jsx(Mx,{onComplete:S}),Ma&&o.jsx(hj,{onLoadScenario:He,onSkipCoinFlip:E,onForceWin:Ha,onForceLose:ka})]})}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function gj({onPlayAgain:t,winner:n,finalState:r,difficulty:i}){if(!r)return o.jsxs("div",{className:"screen",children:[o.jsx("h1",{children:"Loading Results..."}),o.jsx("button",{className:"btn",onClick:t,children:"Back to Menu"})]});const s=n==="player",d=(u,p)=>{let f=[u];return p&&f.push("compiled"),f.join(" ")};return o.jsx("div",{className:`screen results-screen ${s?"victory":"defeat"}`,children:o.jsxs("div",{className:"results-screen-content",children:[o.jsxs("header",{className:"results-header",children:[o.jsx("h1",{children:s?"VICTORY":"DEFEAT"}),o.jsx("p",{children:s?"System compiled successfully.":"Critical error in the mainframe."})]}),o.jsxs("div",{className:"results-body",children:[o.jsxs("div",{className:"final-score-section",children:[o.jsx("h3",{children:"Final Score"}),o.jsxs("h4",{className:"results-label results-opponent-label",children:["Opponent (",i.charAt(0).toUpperCase()+i.slice(1),")"]}),o.jsxs("div",{className:"protocol-bars-container",children:[o.jsx("div",{className:"protocol-bar opponent-bar",children:r.opponent.protocols.map((u,p)=>o.jsxs("div",{className:d("protocol-display",r.opponent.compiled[p]),children:[o.jsx("span",{className:"protocol-name",children:u}),o.jsx("span",{className:"protocol-value",children:r.opponent.laneValues[p]})]},`opp-proto-${u}-${p}`))}),o.jsx("div",{className:"protocol-bar player-bar",children:r.player.protocols.map((u,p)=>o.jsxs("div",{className:d("protocol-display",r.player.compiled[p]),children:[o.jsx("span",{className:"protocol-name",children:u}),o.jsx("span",{className:"protocol-value",children:r.player.laneValues[p]})]},`player-proto-${u}-${p}`))})]}),o.jsx("h4",{className:"results-label results-player-label",children:"Player"})]}),o.jsxs("div",{className:"stats-section",children:[o.jsx("h3",{children:"Statistics"}),o.jsxs("div",{className:"stats-grid",children:[o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-item-label",children:"Cards Played"}),o.jsx("span",{className:"stat-item-value opponent",children:r.stats.opponent.cardsPlayed}),o.jsx("span",{className:"stat-item-value player",children:r.stats.player.cardsPlayed})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-item-label",children:"Cards Drawn"}),o.jsx("span",{className:"stat-item-value opponent",children:r.stats.opponent.cardsDrawn}),o.jsx("span",{className:"stat-item-value player",children:r.stats.player.cardsDrawn})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-item-label",children:"Cards Discarded"}),o.jsx("span",{className:"stat-item-value opponent",children:r.stats.opponent.cardsDiscarded}),o.jsx("span",{className:"stat-item-value player",children:r.stats.player.cardsDiscarded})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-item-label",children:"Cards Deleted"}),o.jsx("span",{className:"stat-item-value opponent",children:r.stats.opponent.cardsDeleted}),o.jsx("span",{className:"stat-item-value player",children:r.stats.player.cardsDeleted})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-item-label",children:"Cards Flipped"}),o.jsx("span",{className:"stat-item-value opponent",children:r.stats.opponent.cardsFlipped}),o.jsx("span",{className:"stat-item-value player",children:r.stats.player.cardsFlipped})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-item-label",children:"Cards Shifted"}),o.jsx("span",{className:"stat-item-value opponent",children:r.stats.opponent.cardsShifted}),o.jsx("span",{className:"stat-item-value player",children:r.stats.player.cardsShifted})]})]})]})]}),o.jsx("button",{className:"btn",onClick:t,children:"Play Again"})]})})}function vj({onBack:t}){const[n,r]=se.useState(0);se.useEffect(()=>{Jl(),r(E=>E+1)},[]);const i=se.useMemo(()=>{const E=au(),j=zo(),b=yr(),k=new Set(b.filter(U=>al(U)).map(U=>U.name));return j.filter(U=>k.has(U.protocol)||E)},[n]),s=se.useMemo(()=>{const E=new Set(i.map(j=>j.protocol));return Array.from(E).sort()},[i]),[d,u]=se.useState(null),p=se.useMemo(()=>{const E=new Set(i.map(j=>j.category));return Array.from(E).sort()},[i]),[f,h]=se.useState(()=>new Set(p));se.useEffect(()=>{i.length>0&&!d&&u(i[0])},[i,d]);const w=E=>{h(j=>{const b=new Set(j);return b.has(E)?b.delete(E):b.add(E),b})},g=E=>{const j=i.find(b=>b.protocol===E);return(j==null?void 0:j.category)||""},y=se.useMemo(()=>s.filter(E=>{const j=g(E);return f.has(j)}),[s,f,i]),m=se.useMemo(()=>{const E={};for(const j of i)E[j.protocol]||(E[j.protocol]=[]),E[j.protocol].push(j);for(const j in E)E[j].sort((b,k)=>b.value-k.value);return E},[i]),x=E=>{u(E)},S=()=>{if(!d)return null;const E={...d,id:"preview",isFaceUp:!0};return o.jsx(xt,{card:E,isFaceUp:!0})};return o.jsxs("div",{className:"screen card-library-screen",children:[o.jsx(Ai,{title:"Card Library",onBack:t}),o.jsxs("div",{className:"card-library-layout",children:[o.jsxs("div",{className:"game-preview-container",children:[o.jsx("h2",{children:"Card Preview"}),o.jsx("div",{className:"preview-card-area",children:S()})]}),o.jsxs("div",{className:"card-list-container",children:[o.jsx("div",{className:"category-filters",children:p.map(E=>o.jsxs("label",{className:"category-filter-item",children:[o.jsx("input",{type:"checkbox",checked:f.has(E),onChange:()=>w(E)}),o.jsx("span",{children:E})]},E))}),y.map(E=>o.jsxs("div",{className:"protocol-group",children:[o.jsxs("h3",{children:[E,o.jsxs("span",{className:"protocol-category-label",children:[" (",g(E),")"]})]}),o.jsx("div",{className:"protocol-card-grid",children:m[E].map(j=>{const b={...j,id:`${j.protocol}-${j.value}`,isFaceUp:!0};return o.jsx(xt,{card:b,isFaceUp:!0,additionalClassName:"in-hand",onPointerEnter:()=>x(j),onPointerDown:()=>x(j)},b.id)})})]},E))]})]})]})}function _j({onBack:t}){const[n,r]=se.useState(()=>eu()),[i,s]=se.useState(!1),d=JE(n),u=ej(n),p=tj(n),f=nj(n),h=aj(n),w=oj(n),g=rj(n),[y,m]=se.useState(null),x=()=>{YE(),r(eu()),s(!1)},S=Z=>{m(G=>G===Z?null:Z)},E=n.global.totalGamesPlayed,j=n.actions.detailedStats,b=Z=>E>0?(Z/E).toFixed(1):"0.0",k=(Z,G)=>G>0?(Z/G).toFixed(1):"0.0",N=j.cardsDrawn.playerFromRefresh+j.cardsDrawn.playerFromEffect,U=j.cardsDrawn.aiFromRefresh+j.cardsDrawn.aiFromEffect,V=N+U,R=j.cardsPlayed.playerFromHand+j.cardsPlayed.playerFromEffect,O=j.cardsPlayed.aiFromHand+j.cardsPlayed.aiFromEffect,X=R+O,M=j.compiles.playerFirstCompile+j.compiles.playerRecompile,$=j.compiles.aiFirstCompile+j.compiles.aiRecompile,B=M+$,I=j.discards.player+j.discards.ai,D=j.deletes.player+j.deletes.ai,L=j.flips.player+j.flips.ai,T=j.shifts.player+j.shifts.ai,q=j.returns.player+j.returns.ai,P=j.refreshes.player+j.refreshes.ai;return o.jsxs("div",{className:"screen statistics-screen",children:[o.jsx(Ai,{title:"STATISTICS",onBack:t}),o.jsxs("div",{className:"stats-content",children:[o.jsxs("section",{className:"stats-section",children:[o.jsx("h2",{className:"section-title",children:"Overview"}),o.jsxs("div",{className:"stats-grid",children:[o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Games Played"}),o.jsx("span",{className:"stat-value",children:n.global.totalGamesPlayed})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Win Rate"}),o.jsxs("span",{className:"stat-value",children:[d.toFixed(1),"%"]})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Games Won"}),o.jsx("span",{className:"stat-value win",children:n.global.totalGamesWon})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Games Lost"}),o.jsx("span",{className:"stat-value loss",children:n.global.totalGamesLost})]})]})]}),o.jsxs("section",{className:"stats-section",children:[o.jsx("h2",{className:"section-title",children:"Streaks"}),o.jsxs("div",{className:"stats-grid",children:[o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Current Streak"}),o.jsx("span",{className:`stat-value ${n.global.currentStreak>0?"win":n.global.currentStreak<0?"loss":""}`,children:n.global.currentStreak>0?`+${n.global.currentStreak}`:n.global.currentStreak})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Best Win Streak"}),o.jsx("span",{className:"stat-value win",children:n.global.longestWinStreak})]})]})]}),o.jsxs("section",{className:"stats-section",children:[o.jsx("h2",{className:"section-title",children:"Playtime"}),o.jsxs("div",{className:"stats-grid",children:[o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Total Playtime"}),o.jsx("span",{className:"stat-value",children:Kl(n.global.totalPlaytime)})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Average Game"}),o.jsx("span",{className:"stat-value",children:Kl(u)})]}),n.global.fastestWin&&o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Fastest Win"}),o.jsx("span",{className:"stat-value",children:Kl(n.global.fastestWin)})]}),n.global.longestGame&&o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Longest Game"}),o.jsx("span",{className:"stat-value",children:Kl(n.global.longestGame)})]}),n.global.lastGameDuration&&o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Last Game"}),o.jsx("span",{className:"stat-value",children:Kl(n.global.lastGameDuration)})]})]})]}),o.jsxs("section",{className:"stats-section",children:[o.jsx("h2",{className:"section-title",children:"AI Performance"}),o.jsx("div",{className:"ai-stats",children:["easy","normal","hard"].map(Z=>{const G=n.aiDifficulty[Z],A=G.played>0?G.wins/G.played*100:0;return o.jsxs("div",{className:"ai-item",children:[o.jsx("span",{className:"ai-name",children:Z}),o.jsxs("span",{className:"ai-record",children:[o.jsxs("span",{className:"win",children:[G.wins,"W"]})," - ",o.jsxs("span",{className:"loss",children:[G.losses,"L"]})]}),o.jsxs("span",{className:"ai-winrate",children:["(",A.toFixed(1),"%)"]})]},Z)})})]}),f.length>0&&o.jsxs("section",{className:"stats-section",children:[o.jsx("h2",{className:"section-title",children:"Best Win Rate"}),o.jsx("div",{className:"protocol-list",children:f.map((Z,G)=>o.jsxs("div",{className:"protocol-item",children:[o.jsxs("span",{className:"protocol-rank",children:[G+1,"."]}),o.jsx("span",{className:"protocol-name",children:Z.protocol}),o.jsxs("span",{className:"protocol-stats win",children:[Z.winRate.toFixed(0),"%  ",Z.timesUsed]})]},Z.protocol))})]}),p.length>0&&o.jsxs("section",{className:"stats-section",children:[o.jsx("h2",{className:"section-title",children:"Favorite Protocols"}),o.jsx("div",{className:"protocol-list",children:p.map((Z,G)=>o.jsxs("div",{className:"protocol-item",children:[o.jsxs("span",{className:"protocol-rank",children:[G+1,"."]}),o.jsx("span",{className:"protocol-name",children:Z.protocol}),o.jsxs("span",{className:"protocol-stats",children:[Z.timesUsed,"  ",Z.winRate.toFixed(0),"%"]})]},Z.protocol))})]}),h.length>0&&o.jsxs("section",{className:"stats-section",children:[o.jsx("h2",{className:"section-title",children:"Least Used Protocols"}),o.jsx("div",{className:"protocol-list",children:h.map((Z,G)=>o.jsxs("div",{className:"protocol-item",children:[o.jsxs("span",{className:"protocol-rank",children:[G+1,"."]}),o.jsx("span",{className:"protocol-name",children:Z.protocol}),o.jsxs("span",{className:"protocol-stats",children:[Z.timesUsed,"  ",Z.winRate.toFixed(0),"%"]})]},Z.protocol))})]}),w.length>0&&o.jsxs("section",{className:"stats-section",children:[o.jsx("h2",{className:"section-title",children:"Most Played Cards"}),o.jsx("div",{className:"card-list",children:w.map((Z,G)=>o.jsxs("div",{className:"card-item",children:[o.jsxs("span",{className:"card-rank",children:[G+1,"."]}),o.jsx("span",{className:"card-name",children:Z.card}),o.jsxs("span",{className:"card-count",children:[Z.count,""]})]},Z.card))})]}),g.length>0&&o.jsxs("section",{className:"stats-section",children:[o.jsx("h2",{className:"section-title",children:"Most Deleted Cards"}),o.jsx("div",{className:"card-list",children:g.map((Z,G)=>o.jsxs("div",{className:"card-item",children:[o.jsxs("span",{className:"card-rank",children:[G+1,"."]}),o.jsx("span",{className:"card-name",children:Z.card}),o.jsxs("span",{className:"card-count",children:[Z.count,""]})]},Z.card))})]}),o.jsxs("section",{className:"stats-section",children:[o.jsx("h2",{className:"section-title",children:"Control Mechanic"}),o.jsxs("div",{className:"stats-grid",children:[o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"With Control"}),o.jsx("span",{className:"stat-value",children:n.control.gamesWithControl})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Without Control"}),o.jsx("span",{className:"stat-value",children:n.control.gamesWithoutControl})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Your Rearranges"}),o.jsx("span",{className:"stat-value",children:n.control.playerRearranges})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"AI Rearranges"}),o.jsx("span",{className:"stat-value",children:n.control.aiRearranges})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Total Rearranges"}),o.jsx("span",{className:"stat-value",children:n.control.totalRearranges})]})]})]}),o.jsxs("section",{className:"stats-section",children:[o.jsx("h2",{className:"section-title",children:"Coin Flip"}),o.jsxs("div",{className:"stats-grid",children:[o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Heads Chosen"}),o.jsxs("span",{className:"stat-value",children:[n.coinFlip.headsChosen," (",n.coinFlip.headsChosen>0?(n.coinFlip.headsWon/n.coinFlip.headsChosen*100).toFixed(0):0,"%)"]})]}),o.jsxs("div",{className:"stat-item",children:[o.jsx("span",{className:"stat-label",children:"Tails Chosen"}),o.jsxs("span",{className:"stat-value",children:[n.coinFlip.tailsChosen," (",n.coinFlip.tailsChosen>0?(n.coinFlip.tailsWon/n.coinFlip.tailsChosen*100).toFixed(0):0,"%)"]})]})]})]}),o.jsxs("section",{className:"stats-section full-width",children:[o.jsx("h2",{className:"section-title",children:"Actions (click for details)"}),o.jsxs("div",{className:"actions-container",children:[o.jsxs("div",{className:`stat-item clickable ${y==="played"?"expanded":""}`,onClick:()=>S("played"),children:[o.jsx("span",{className:"stat-label",children:"Cards Played"}),o.jsx("span",{className:"stat-value",children:X})]}),o.jsxs("div",{className:`stat-item clickable ${y==="drawn"?"expanded":""}`,onClick:()=>S("drawn"),children:[o.jsx("span",{className:"stat-label",children:"Cards Drawn"}),o.jsx("span",{className:"stat-value",children:V})]}),o.jsxs("div",{className:`stat-item clickable ${y==="discards"?"expanded":""}`,onClick:()=>S("discards"),children:[o.jsx("span",{className:"stat-label",children:"Discards"}),o.jsx("span",{className:"stat-value",children:I})]}),o.jsxs("div",{className:`stat-item clickable ${y==="deletes"?"expanded":""}`,onClick:()=>S("deletes"),children:[o.jsx("span",{className:"stat-label",children:"Deletes"}),o.jsx("span",{className:"stat-value",children:D})]}),o.jsxs("div",{className:`stat-item clickable ${y==="flips"?"expanded":""}`,onClick:()=>S("flips"),children:[o.jsx("span",{className:"stat-label",children:"Flips"}),o.jsx("span",{className:"stat-value",children:L})]}),o.jsxs("div",{className:`stat-item clickable ${y==="shifts"?"expanded":""}`,onClick:()=>S("shifts"),children:[o.jsx("span",{className:"stat-label",children:"Shifts"}),o.jsx("span",{className:"stat-value",children:T})]}),o.jsxs("div",{className:`stat-item clickable ${y==="returns"?"expanded":""}`,onClick:()=>S("returns"),children:[o.jsx("span",{className:"stat-label",children:"Returns"}),o.jsx("span",{className:"stat-value",children:q})]}),o.jsxs("div",{className:`stat-item clickable ${y==="compiles"?"expanded":""}`,onClick:()=>S("compiles"),children:[o.jsx("span",{className:"stat-label",children:"Compiles"}),o.jsx("span",{className:"stat-value",children:B})]}),o.jsxs("div",{className:`stat-item clickable ${y==="refreshes"?"expanded":""}`,onClick:()=>S("refreshes"),children:[o.jsx("span",{className:"stat-label",children:"Refreshes"}),o.jsx("span",{className:"stat-value",children:P})]})]}),y==="played"&&o.jsxs("div",{className:"action-details-section",children:[o.jsx("h3",{className:"section-title",children:"Cards Played"}),o.jsxs("div",{className:"action-details-total",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:X})]}),o.jsxs("div",{className:"action-details-columns",children:[o.jsxs("div",{className:"action-details-column player",children:[o.jsx("div",{className:"column-header",children:"Player"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:R})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"From Hand"}),o.jsx("span",{className:"detail-value",children:j.cardsPlayed.playerFromHand})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"From Effect"}),o.jsx("span",{className:"detail-value",children:j.cardsPlayed.playerFromEffect})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Face-Up"}),o.jsx("span",{className:"detail-value",children:j.cardsPlayed.playerFaceUp})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Face-Down"}),o.jsx("span",{className:"detail-value",children:j.cardsPlayed.playerFaceDown})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:b(R)})]})]}),o.jsxs("div",{className:"action-details-column ai",children:[o.jsx("div",{className:"column-header",children:"AI"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:O})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"From Hand"}),o.jsx("span",{className:"detail-value",children:j.cardsPlayed.aiFromHand})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"From Effect"}),o.jsx("span",{className:"detail-value",children:j.cardsPlayed.aiFromEffect})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Face-Up"}),o.jsx("span",{className:"detail-value",children:j.cardsPlayed.aiFaceUp})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Face-Down"}),o.jsx("span",{className:"detail-value",children:j.cardsPlayed.aiFaceDown})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:b(O)})]})]})]})]}),y==="drawn"&&o.jsxs("div",{className:"action-details-section",children:[o.jsx("h3",{className:"section-title",children:"Cards Drawn"}),o.jsxs("div",{className:"action-details-total",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:V})]}),o.jsxs("div",{className:"action-details-columns",children:[o.jsxs("div",{className:"action-details-column player",children:[o.jsx("div",{className:"column-header",children:"Player"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:N})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"From Refresh"}),o.jsx("span",{className:"detail-value",children:j.cardsDrawn.playerFromRefresh})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"From Effect"}),o.jsx("span",{className:"detail-value",children:j.cardsDrawn.playerFromEffect})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:b(N)})]})]}),o.jsxs("div",{className:"action-details-column ai",children:[o.jsx("div",{className:"column-header",children:"AI"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:U})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"From Refresh"}),o.jsx("span",{className:"detail-value",children:j.cardsDrawn.aiFromRefresh})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"From Effect"}),o.jsx("span",{className:"detail-value",children:j.cardsDrawn.aiFromEffect})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:b(U)})]})]})]})]}),y==="discards"&&o.jsxs("div",{className:"action-details-section",children:[o.jsx("h3",{className:"section-title",children:"Discards"}),o.jsxs("div",{className:"action-details-total",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:I})]}),o.jsxs("div",{className:"action-details-columns",children:[o.jsxs("div",{className:"action-details-column player",children:[o.jsx("div",{className:"column-header",children:"Player"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:j.discards.player})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:b(j.discards.player)})]})]}),o.jsxs("div",{className:"action-details-column ai",children:[o.jsx("div",{className:"column-header",children:"AI"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:j.discards.ai})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:b(j.discards.ai)})]})]})]})]}),y==="deletes"&&o.jsxs("div",{className:"action-details-section",children:[o.jsx("h3",{className:"section-title",children:"Deletes"}),o.jsxs("div",{className:"action-details-total",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:D})]}),o.jsxs("div",{className:"action-details-columns",children:[o.jsxs("div",{className:"action-details-column player",children:[o.jsx("div",{className:"column-header",children:"Player"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:j.deletes.player})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:b(j.deletes.player)})]})]}),o.jsxs("div",{className:"action-details-column ai",children:[o.jsx("div",{className:"column-header",children:"AI"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:j.deletes.ai})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:b(j.deletes.ai)})]})]})]})]}),y==="flips"&&o.jsxs("div",{className:"action-details-section",children:[o.jsx("h3",{className:"section-title",children:"Flips"}),o.jsxs("div",{className:"action-details-total",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:L})]}),o.jsxs("div",{className:"action-details-columns",children:[o.jsxs("div",{className:"action-details-column player",children:[o.jsx("div",{className:"column-header",children:"Player"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:j.flips.player})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:b(j.flips.player)})]})]}),o.jsxs("div",{className:"action-details-column ai",children:[o.jsx("div",{className:"column-header",children:"AI"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:j.flips.ai})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:b(j.flips.ai)})]})]})]})]}),y==="shifts"&&o.jsxs("div",{className:"action-details-section",children:[o.jsx("h3",{className:"section-title",children:"Shifts"}),o.jsxs("div",{className:"action-details-total",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:T})]}),o.jsxs("div",{className:"action-details-columns",children:[o.jsxs("div",{className:"action-details-column player",children:[o.jsx("div",{className:"column-header",children:"Player"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:j.shifts.player})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:b(j.shifts.player)})]})]}),o.jsxs("div",{className:"action-details-column ai",children:[o.jsx("div",{className:"column-header",children:"AI"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:j.shifts.ai})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:b(j.shifts.ai)})]})]})]})]}),y==="returns"&&o.jsxs("div",{className:"action-details-section",children:[o.jsx("h3",{className:"section-title",children:"Returns"}),o.jsxs("div",{className:"action-details-total",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:q})]}),o.jsxs("div",{className:"action-details-columns",children:[o.jsxs("div",{className:"action-details-column player",children:[o.jsx("div",{className:"column-header",children:"Player"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:j.returns.player})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:b(j.returns.player)})]})]}),o.jsxs("div",{className:"action-details-column ai",children:[o.jsx("div",{className:"column-header",children:"AI"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:j.returns.ai})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:b(j.returns.ai)})]})]})]})]}),y==="compiles"&&o.jsxs("div",{className:"action-details-section",children:[o.jsx("h3",{className:"section-title",children:"Compiles"}),o.jsxs("div",{className:"action-details-total",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:B})]}),o.jsxs("div",{className:"action-details-columns",children:[o.jsxs("div",{className:"action-details-column player",children:[o.jsx("div",{className:"column-header",children:"Player"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:M})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"First-Compile"}),o.jsx("span",{className:"detail-value",children:j.compiles.playerFirstCompile})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Re-Compile"}),o.jsx("span",{className:"detail-value",children:j.compiles.playerRecompile})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:b(M)})]})]}),o.jsxs("div",{className:"action-details-column ai",children:[o.jsx("div",{className:"column-header",children:"AI"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:$})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"First-Compile"}),o.jsx("span",{className:"detail-value",children:j.compiles.aiFirstCompile})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Re-Compile"}),o.jsx("span",{className:"detail-value",children:j.compiles.aiRecompile})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:b($)})]})]})]})]}),y==="refreshes"&&o.jsxs("div",{className:"action-details-section",children:[o.jsx("h3",{className:"section-title",children:"Refreshes"}),o.jsxs("div",{className:"action-details-total",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:P})]}),o.jsxs("div",{className:"action-details-columns",children:[o.jsxs("div",{className:"action-details-column player",children:[o.jsx("div",{className:"column-header",children:"Player"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:j.refreshes.player})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Cards / Refresh"}),o.jsx("span",{className:"detail-value",children:k(j.refreshes.playerCardsDrawn,j.refreshes.player)})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:b(j.refreshes.player)})]})]}),o.jsxs("div",{className:"action-details-column ai",children:[o.jsx("div",{className:"column-header",children:"AI"}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Total"}),o.jsx("span",{className:"detail-value",children:j.refreshes.ai})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Cards / Refresh"}),o.jsx("span",{className:"detail-value",children:k(j.refreshes.aiCardsDrawn,j.refreshes.ai)})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"detail-label",children:"Avg / Game"}),o.jsx("span",{className:"detail-value",children:b(j.refreshes.ai)})]})]})]})]})]}),o.jsx("section",{className:"stats-section reset-section",children:o.jsx("button",{className:"reset-stats-button",onClick:()=>s(!0),children:"Reset All Statistics"})})]}),i&&o.jsx("div",{className:"reset-modal-overlay",onClick:()=>s(!1),children:o.jsxs("div",{className:"reset-modal",onClick:Z=>Z.stopPropagation(),children:[o.jsx("h3",{children:"Reset Statistics?"}),o.jsx("p",{children:"This will permanently delete all your statistics. This action cannot be undone."}),o.jsxs("div",{className:"reset-modal-buttons",children:[o.jsx("button",{className:"cancel-button",onClick:()=>s(!1),children:"Cancel"}),o.jsx("button",{className:"confirm-reset-button",onClick:x,children:"Reset"})]})]})})]})}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const fv=({params:t,onChange:n})=>{var r,i,s,d,u,p;return o.jsxs("div",{className:"param-editor draw-effect-editor",children:[o.jsx("h4",{children:"Draw Effect Parameters"}),o.jsxs("label",{children:["Count Type",o.jsxs("select",{value:t.countType||"fixed",onChange:f=>{const h=f.target.value;n({...t,countType:h,countOffset:h==="equal_to_discarded"?0:void 0})},children:[o.jsx("option",{value:"fixed",children:"Fixed Amount"}),o.jsx("option",{value:"equal_to_card_value",children:"Equal to Card Value (from previous effect)"}),o.jsx("option",{value:"equal_to_discarded",children:"Equal to Discarded Cards"}),o.jsx("option",{value:"hand_size",children:"Equal to Hand Size"}),o.jsx("option",{value:"count_own_protocol_cards_on_field",children:"Count Same Protocol Cards on Field (Unity)"})]})]}),(!t.countType||t.countType==="fixed")&&o.jsxs("label",{children:["Card Count",o.jsx("input",{type:"number",min:1,max:6,value:t.count,onChange:f=>n({...t,count:parseInt(f.target.value)||1})})]}),t.countType==="equal_to_discarded"&&o.jsxs("label",{children:["Offset (+/-)",o.jsx("input",{type:"number",min:-5,max:5,value:t.countOffset||0,onChange:f=>n({...t,countOffset:parseInt(f.target.value)||0})}),o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:'Example: +1 for "discard count plus 1" (Fire-4)'})]}),o.jsxs("label",{children:["Target",o.jsxs("select",{value:t.target,onChange:f=>n({...t,target:f.target.value}),children:[o.jsx("option",{value:"self",children:"Self"}),o.jsx("option",{value:"opponent",children:"Opponent"})]})]}),o.jsxs("label",{children:["Source",o.jsxs("select",{value:t.source,onChange:f=>n({...t,source:f.target.value}),children:[o.jsx("option",{value:"own_deck",children:"Own Deck"}),o.jsx("option",{value:"opponent_deck",children:"Opponent's Deck"})]})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:t.preAction==="refresh",onChange:f=>n({...t,preAction:f.target.checked?"refresh":void 0})}),"Refresh hand first (shuffle hand into deck, then draw)"]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:t.optional||!1,onChange:f=>n({...t,optional:f.target.checked})}),'Optional ("You may draw" instead of "Draw")']}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:t.revealFromDrawn!==void 0,onChange:f=>{if(f.target.checked)n({...t,revealFromDrawn:{valueSource:"stated_number"}});else{const{revealFromDrawn:h,...w}=t;n(w)}}}),"Reveal from Drawn Cards",o.jsx("small",{style:{display:"block",marginLeft:"24px",color:"#8A79E8"},children:"After drawing, reveal cards from the drawn pile (optionally filtered by value)."})]}),t.revealFromDrawn&&o.jsxs(o.Fragment,{children:[o.jsxs("label",{children:["Reveal Count",o.jsxs("select",{value:t.revealFromDrawn.count==="all"?"all":(t.revealFromDrawn.count||1).toString(),onChange:f=>{const h=f.target.value;n({...t,revealFromDrawn:{...t.revealFromDrawn,count:h==="all"?"all":parseInt(h)}})},children:[o.jsx("option",{value:"1",children:"1 card"}),o.jsx("option",{value:"2",children:"2 cards"}),o.jsx("option",{value:"3",children:"3 cards"}),o.jsx("option",{value:"all",children:"All matching cards"})]})]}),o.jsxs("label",{children:["Value Filter",o.jsxs("select",{value:t.revealFromDrawn.valueSource||"stated_number",onChange:f=>n({...t,revealFromDrawn:{...t.revealFromDrawn,valueSource:f.target.value}}),children:[o.jsx("option",{value:"stated_number",children:"Stated Number (requires state_number before)"}),o.jsx("option",{value:"any",children:"Any (no filter)"})]})]}),o.jsxs("label",{children:["After Reveal",o.jsxs("select",{value:t.revealFromDrawn.thenAction||"",onChange:f=>{if(f.target.value===""){const{thenAction:h,...w}=t.revealFromDrawn;n({...t,revealFromDrawn:w})}else n({...t,revealFromDrawn:{...t.revealFromDrawn,thenAction:f.target.value}})},children:[o.jsx("option",{value:"",children:"None"}),o.jsx("option",{value:"may_play",children:'May Play ("You may play it")'})]})]})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:t.valueFilter!==void 0,onChange:f=>{if(f.target.checked)n({...t,valueFilter:{equals:1}});else{const{valueFilter:h,...w}=t;n(w)}}}),'Draw specific value only (e.g., "Draw 1 card with a value of X")']}),t.valueFilter!==void 0&&o.jsxs(o.Fragment,{children:[o.jsxs("label",{children:["Card Value to Draw",o.jsx("input",{type:"number",min:0,max:5,value:((r=t.valueFilter)==null?void 0:r.equals)??1,onChange:f=>n({...t,valueFilter:{equals:parseInt(f.target.value)||0}})}),o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"Only draws cards with this exact value from the deck"})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:t.fromRevealed||!1,onChange:f=>n({...t,fromRevealed:f.target.checked})}),'From revealed deck ("revealed this way" - player selects)',o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:'Requires "Reveal your deck" effect before this. Player picks from revealed cards.'})]})]}),o.jsxs("label",{children:["Conditional",o.jsxs("select",{value:((i=t.conditional)==null?void 0:i.type)||"none",onChange:f=>{if(f.target.value==="none"){const{conditional:h,...w}=t;n(w)}else n({...t,conditional:{type:f.target.value}})},children:[o.jsx("option",{value:"none",children:"None"}),o.jsx("option",{value:"count_face_down",children:"1 per face-down card (all on board)"}),o.jsx("option",{value:"is_covering",children:"Only if this card is covering another"}),o.jsx("option",{value:"non_matching_protocols",children:"1 per line with non-matching protocol"})]})]}),o.jsxs("label",{children:["Advanced Conditional",o.jsxs("select",{value:((s=t.advancedConditional)==null?void 0:s.type)||"none",onChange:f=>{if(f.target.value==="none"){const{advancedConditional:h,...w}=t;n(w)}else f.target.value==="protocol_match"?n({...t,advancedConditional:{type:"protocol_match",protocol:""}}):f.target.value==="compile_block"?n({...t,advancedConditional:{type:"compile_block",turnDuration:1}}):f.target.value==="empty_hand"?n({...t,advancedConditional:{type:"empty_hand"}}):f.target.value==="opponent_higher_value_in_lane"?n({...t,advancedConditional:{type:"opponent_higher_value_in_lane"}}):f.target.value==="same_protocol_on_field"&&n({...t,advancedConditional:{type:"same_protocol_on_field"}})},children:[o.jsx("option",{value:"none",children:"None"}),o.jsx("option",{value:"protocol_match",children:"Only if in line with matching protocol"}),o.jsx("option",{value:"compile_block",children:"Block opponent's compile next turn"}),o.jsx("option",{value:"empty_hand",children:"Only if hand is empty"}),o.jsx("option",{value:"opponent_higher_value_in_lane",children:"Only if opponent has higher value in this lane"}),o.jsx("option",{value:"same_protocol_on_field",children:"Only if another face-up same-protocol card exists (Unity)"})]})]}),((d=t.advancedConditional)==null?void 0:d.type)==="protocol_match"&&o.jsxs("label",{children:["Required Protocol",o.jsx("input",{type:"text",placeholder:"e.g., Fire, Water, Lightning",value:t.advancedConditional.protocol||"",onChange:f=>n({...t,advancedConditional:{...t.advancedConditional,type:"protocol_match",protocol:f.target.value}})}),o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"Only draw if this card is in a line with this protocol"})]}),((u=t.advancedConditional)==null?void 0:u.type)==="compile_block"&&o.jsxs("label",{children:["Block Duration (turns)",o.jsx("input",{type:"number",min:1,max:3,value:t.advancedConditional.turnDuration||1,onChange:f=>n({...t,advancedConditional:{...t.advancedConditional,type:"compile_block",turnDuration:parseInt(f.target.value)||1}})}),o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"Opponent can't compile for this many turns"})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:((p=t.protocolFilter)==null?void 0:p.type)==="same_as_source",onChange:f=>{if(f.target.checked)n({...t,protocolFilter:{type:"same_as_source"}});else{const{protocolFilter:h,...w}=t;n(w)}}}),"Draw all same-protocol cards from deck (Unity-4)",o.jsx("small",{style:{display:"block",marginLeft:"24px",color:"#8A79E8"},children:"Reveals deck and draws all cards matching this card's protocol."})]})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const wj=({params:t,onChange:n})=>o.jsxs("div",{className:"param-editor refresh-effect-editor",children:[o.jsx("h4",{children:"Refresh Effect Parameters"}),o.jsx("p",{className:"effect-description",children:'Refresh fills the hand to 5 cards (Spirit-0: "Refresh.")'}),o.jsxs("label",{children:["Target",o.jsxs("select",{value:t.target||"self",onChange:r=>n({...t,target:r.target.value}),children:[o.jsx("option",{value:"self",children:"Self"}),o.jsx("option",{value:"opponent",children:"Opponent"})]})]})]});/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const xj=({params:t,onChange:n})=>o.jsxs("div",{className:"param-editor mutual-draw-effect-editor",children:[o.jsx("h4",{children:"Mutual Draw Effect Parameters"}),o.jsx("p",{className:"effect-description",children:`Both players draw from each other's decks (Chaos-0: "Draw the top card of your opponent's deck. Your opponent draws the top card of your deck.")`}),o.jsxs("label",{children:["Count",o.jsx("input",{type:"number",min:"1",max:"10",value:t.count||1,onChange:r=>n({...t,count:parseInt(r.target.value)||1})})]})]});/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const hv=({params:t,onChange:n})=>{var s,d,u;const r=t.targetFilter||{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1},i=t.count??1;return o.jsxs("div",{className:"param-editor flip-effect-editor",children:[o.jsx("h4",{children:"Flip Effect Parameters"}),o.jsxs("label",{children:["Card Count/Scope",o.jsxs("select",{value:i==="all"?"all":i==="each"?"each":i.toString(),onChange:p=>{const f=p.target.value;n(f==="all"?{...t,count:"all"}:f==="each"?{...t,count:"each"}:{...t,count:parseInt(f)})},children:[o.jsx("option",{value:"1",children:"1 card"}),o.jsx("option",{value:"2",children:"2 cards"}),o.jsx("option",{value:"3",children:"3 cards"}),o.jsx("option",{value:"all",children:"All matching cards"}),o.jsx("option",{value:"each",children:"Each matching card"})]})]}),typeof t.count=="number"&&o.jsxs("label",{children:["Scope",o.jsxs("select",{value:t.scope||"any",onChange:p=>n({...t,scope:p.target.value}),children:[o.jsx("option",{value:"any",children:"Any lane"}),o.jsx("option",{value:"this_lane",children:"This lane only"}),o.jsx("option",{value:"each_lane",children:'Each lane (Chaos-0: "In each line...")'})]})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:t.optional,onChange:p=>n({...t,optional:p.target.checked})}),'Optional ("May flip" instead of "Flip")']}),t.count==="each"&&o.jsxs("label",{children:["Each Line Scope",o.jsxs("select",{value:t.eachLineScope||"all_lines",onChange:p=>n({...t,eachLineScope:p.target.value}),children:[o.jsx("option",{value:"all_lines",children:"Each card on board"}),o.jsx("option",{value:"each_line",children:"1 card in each line"})]})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:t.flipSelf||!1,onChange:p=>n({...t,flipSelf:p.target.checked})}),"Flip ONLY this card (no target selection)",o.jsx("small",{style:{display:"block",marginLeft:"24px",color:"#8A79E8"},children:"The card flips itself, ignoring count and target filter."})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:t.selfFlipAfter||!1,onChange:p=>n({...t,selfFlipAfter:p.target.checked})}),"ALSO flip this card after flipping targets",o.jsx("small",{style:{display:"block",marginLeft:"24px",color:"#8A79E8"},children:"After flipping target(s), also flip this card as bonus."})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:t.skipMiddleCommand||!1,onChange:p=>n({...t,skipMiddleCommand:p.target.checked})}),"Skip Middle Command",o.jsx("small",{style:{display:"block",marginLeft:"24px",color:"#8A79E8"},children:"Flip the card but ignore its middle commands."})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:t.sameLaneAsFirst||!1,onChange:p=>n({...t,sameLaneAsFirst:p.target.checked})}),"Same Lane as First Flip",o.jsx("small",{style:{display:"block",marginLeft:"24px",color:"#8A79E8"},children:"Follow-up flip must target the same lane as the previous flip."})]}),o.jsx("h5",{children:"Advanced Conditional"}),o.jsxs("label",{children:["Conditional Type",o.jsxs("select",{value:((s=t.advancedConditional)==null?void 0:s.type)||"",onChange:p=>{if(p.target.value===""){const{advancedConditional:f,...h}=t;n(h)}else p.target.value==="protocol_match"?n({...t,advancedConditional:{type:"protocol_match",protocol:""}}):p.target.value==="hand_size_greater_than"?n({...t,advancedConditional:{type:"hand_size_greater_than",threshold:1}}):n({...t,advancedConditional:{type:p.target.value}})},children:[o.jsx("option",{value:"",children:"None"}),o.jsx("option",{value:"protocol_match",children:"Only if in specific protocol line"}),o.jsx("option",{value:"opponent_higher_value_in_lane",children:"Only if opponent has higher value in this lane"}),o.jsx("option",{value:"hand_size_greater_than",children:"Only if hand size greater than X"}),o.jsx("option",{value:"same_protocol_on_field",children:"Only if another face-up same-protocol card exists (Unity)"}),o.jsx("option",{value:"this_card_is_covered",children:"Only if this card is covered"})]})]}),((d=t.advancedConditional)==null?void 0:d.type)==="protocol_match"&&o.jsxs("label",{children:["Required Protocol",o.jsx("input",{type:"text",value:t.advancedConditional.protocol||"",onChange:p=>n({...t,advancedConditional:{...t.advancedConditional,protocol:p.target.value}}),placeholder:"e.g., Anarchy, Fire, Death"})]}),((u=t.advancedConditional)==null?void 0:u.type)==="hand_size_greater_than"&&o.jsxs("label",{children:["Hand Size Threshold (more than X cards)",o.jsx("input",{type:"number",min:"0",max:"10",value:t.advancedConditional.threshold??1,onChange:p=>n({...t,advancedConditional:{...t.advancedConditional,threshold:parseInt(p.target.value)||0}})}),o.jsx("small",{style:{display:"block",color:"#8A79E8"},children:"Effect only triggers if you have MORE than this many cards in hand."})]}),o.jsx("h5",{children:"Target Filter"}),o.jsxs("label",{children:["Owner",o.jsxs("select",{value:r.owner,onChange:p=>n({...t,targetFilter:{...r,owner:p.target.value}}),children:[o.jsx("option",{value:"any",children:"Any"}),o.jsx("option",{value:"own",children:"Own"}),o.jsx("option",{value:"opponent",children:"Opponent"})]})]}),o.jsxs("label",{children:["Position",o.jsxs("select",{value:r.position,onChange:p=>n({...t,targetFilter:{...r,position:p.target.value}}),children:[o.jsx("option",{value:"any",children:"Any"}),o.jsx("option",{value:"uncovered",children:"Uncovered (top card)"}),o.jsx("option",{value:"covered",children:"Covered"}),o.jsx("option",{value:"covered_in_this_line",children:"Covered in this line"})]})]}),o.jsxs("label",{children:["Face State",o.jsxs("select",{value:r.faceState,onChange:p=>n({...t,targetFilter:{...r,faceState:p.target.value}}),children:[o.jsx("option",{value:"any",children:"Any"}),o.jsx("option",{value:"face_up",children:"Face-up"}),o.jsx("option",{value:"face_down",children:"Face-down"})]})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:r.excludeSelf,onChange:p=>n({...t,targetFilter:{...r,excludeSelf:p.target.checked}})}),'Exclude self ("other cards")']}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:r.valueMinGreaterThanHandSize||!1,onChange:p=>n({...t,targetFilter:{...r,valueMinGreaterThanHandSize:p.target.checked}})}),"Value Greater Than Hand Size",o.jsx("small",{style:{display:"block",marginLeft:"24px",color:"#8A79E8"},children:"Target must have value greater than the number of cards in your hand."})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:r.valueLessThanUniqueProtocolsOnField||!1,onChange:p=>n({...t,targetFilter:{...r,valueLessThanUniqueProtocolsOnField:p.target.checked}})}),"Value Less Than Protocol Count",o.jsx("small",{style:{display:"block",marginLeft:"24px",color:"#8A79E8"},children:"Target must have value less than the number of different protocols on cards in the field."})]})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const mv=({params:t,onChange:n})=>{var i,s,d;const r=t.targetFilter||{owner:"any",position:"uncovered",faceState:"any"};return o.jsxs("div",{className:"param-editor",children:[o.jsx("h4",{children:"Shift Effect"}),o.jsxs("label",{children:["Count/Scope",o.jsxs("select",{value:t.count==="all"?"all":"1",onChange:u=>{if(u.target.value==="all")n({...t,count:"all"});else{const{count:p,...f}=t;n(f)}},children:[o.jsx("option",{value:"1",children:"1 card"}),o.jsx("option",{value:"all",children:"All matching cards"})]})]}),o.jsxs("label",{children:["Target Owner",o.jsxs("select",{value:r.owner||"any",onChange:u=>n({...t,targetFilter:{...r,owner:u.target.value}}),children:[o.jsx("option",{value:"any",children:"Any"}),o.jsx("option",{value:"own",children:"Own"}),o.jsx("option",{value:"opponent",children:"Opponent"})]})]}),o.jsxs("label",{children:["Position",o.jsxs("select",{value:r.position||"uncovered",onChange:u=>n({...t,targetFilter:{...r,position:u.target.value}}),children:[o.jsx("option",{value:"any",children:"Any"}),o.jsx("option",{value:"uncovered",children:"Uncovered"}),o.jsx("option",{value:"covered",children:"Covered"})]})]}),o.jsxs("label",{children:["Face State",o.jsxs("select",{value:r.faceState||"any",onChange:u=>n({...t,targetFilter:{...r,faceState:u.target.value}}),children:[o.jsx("option",{value:"any",children:"Any"}),o.jsx("option",{value:"face_up",children:"Face-up"}),o.jsx("option",{value:"face_down",children:"Face-down"})]})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:r.excludeSelf||!1,onChange:u=>n({...t,targetFilter:{...r,excludeSelf:u.target.checked}})}),'Exclude self ("other card")']}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:t.optional||!1,onChange:u=>n({...t,optional:u.target.checked})}),'Optional ("You may shift" instead of "Shift")']}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:t.shiftSelf||!1,onChange:u=>n({...t,shiftSelf:u.target.checked})}),"Shift this card (instead of selecting target)",o.jsx("small",{style:{display:"block",marginLeft:"24px",color:"#8A79E8"},children:"The card shifts itself, ignoring target filter."})]}),o.jsx("h5",{children:"Advanced Conditional"}),o.jsxs("label",{children:["Conditional Type",o.jsxs("select",{value:((i=t.advancedConditional)==null?void 0:i.type)||"none",onChange:u=>{if(u.target.value==="none"){const{advancedConditional:p,...f}=t;n(f)}else n({...t,advancedConditional:{type:u.target.value}})},children:[o.jsx("option",{value:"none",children:"None"}),o.jsx("option",{value:"empty_hand",children:"Only if hand is empty"}),o.jsx("option",{value:"opponent_higher_value_in_lane",children:"Only if opponent has higher value in this lane"}),o.jsx("option",{value:"this_card_is_covered",children:"Only if this card is covered"})]})]}),o.jsxs("label",{children:["Destination",o.jsxs("select",{value:((s=t.destinationRestriction)==null?void 0:s.type)||"any",onChange:u=>{if(u.target.value==="any"){const{destinationRestriction:p,...f}=t;n(f)}else n({...t,destinationRestriction:{type:u.target.value}})},children:[o.jsx("option",{value:"any",children:"Any line"}),o.jsx("option",{value:"to_another_line",children:"To another line"}),o.jsx("option",{value:"non_matching_protocol",children:"Non-matching protocol"}),o.jsx("option",{value:"specific_lane",children:"This line (within)"}),o.jsx("option",{value:"to_this_lane",children:"To THIS lane only"}),o.jsx("option",{value:"to_or_from_this_lane",children:"To OR from this lane"}),o.jsx("option",{value:"opponent_highest_value_lane",children:"To opponent's highest value lane"})]}),((d=t.destinationRestriction)==null?void 0:d.type)==="opponent_highest_value_lane"&&o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"Card can only be shifted to the lane where opponent has highest total value."})]}),o.jsxs("label",{children:["Source Scope",o.jsxs("select",{value:t.scope||"any",onChange:u=>{if(u.target.value==="any"){const{scope:p,...f}=t;n(f)}else n({...t,scope:u.target.value})},children:[o.jsx("option",{value:"any",children:"Any lane (select from all lanes)"}),o.jsx("option",{value:"this_lane",children:"This line only"}),o.jsx("option",{value:"each_lane",children:"Each lane (execute per lane)"})]}),t.scope==="this_lane"&&o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"Only cards in this line can be selected as shift targets."})]})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const yv=({params:t,onChange:n})=>{var i,s,d,u,p,f,h,w,g;const r=t.targetFilter||{position:"uncovered",faceState:"any"};return o.jsxs("div",{className:"param-editor delete-effect-editor",children:[o.jsx("h4",{children:"Delete Effect Parameters"}),o.jsxs("label",{children:["Anzahl",o.jsxs("select",{value:typeof t.count=="number"?t.count.toString():"all",onChange:y=>n({...t,count:y.target.value==="all"?"all_in_lane":parseInt(y.target.value)}),children:[o.jsx("option",{value:"1",children:"1"}),o.jsx("option",{value:"2",children:"2"}),o.jsx("option",{value:"3",children:"3"}),o.jsx("option",{value:"all",children:"All in a lane"})]})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:t.excludeSelf,onChange:y=>n({...t,excludeSelf:y.target.checked})}),"Exclude self (other cards only)"]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:t.deleteSelf||!1,onChange:y=>n({...t,deleteSelf:y.target.checked})}),"Delete this card (ignores all other settings)"]}),t.deleteSelf&&o.jsxs("label",{style:{marginLeft:"24px"},children:["Protocol Count Condition",o.jsxs("select",{value:((i=t.protocolCountConditional)==null?void 0:i.threshold)||"none",onChange:y=>{const m=y.target.value;if(m==="none"){const{protocolCountConditional:x,...S}=t;n(S)}else n({...t,protocolCountConditional:{type:"unique_protocols_on_field_below",threshold:parseInt(m)}})},children:[o.jsx("option",{value:"none",children:"Always delete (no condition)"}),o.jsx("option",{value:"2",children:"If less than 2 different protocols"}),o.jsx("option",{value:"3",children:"If less than 3 different protocols"}),o.jsx("option",{value:"4",children:"If less than 4 different protocols"}),o.jsx("option",{value:"5",children:"If less than 5 different protocols"}),o.jsx("option",{value:"6",children:"If less than 6 different protocols"})]}),o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:'"If there are not at least X different protocols on cards in the field, delete this card."'})]}),o.jsx("h5",{children:"Target Filter"}),o.jsxs("label",{children:["Position",o.jsxs("select",{value:r.position,onChange:y=>n({...t,targetFilter:{...r,position:y.target.value}}),children:[o.jsx("option",{value:"any",children:"Any"}),o.jsx("option",{value:"uncovered",children:"Uncovered"}),o.jsx("option",{value:"covered",children:"Covered"})]})]}),o.jsxs("label",{children:["Face State",o.jsxs("select",{value:r.faceState,onChange:y=>n({...t,targetFilter:{...r,faceState:y.target.value}}),children:[o.jsx("option",{value:"any",children:"Any"}),o.jsx("option",{value:"face_up",children:"Face-up"}),o.jsx("option",{value:"face_down",children:"Face-down"})]})]}),o.jsxs("label",{children:["Owner",o.jsxs("select",{value:r.owner||"any",onChange:y=>{const m=y.target.value,x={...r};m==="any"?delete x.owner:x.owner=m,n({...t,targetFilter:x})},children:[o.jsx("option",{value:"any",children:"Any (own or opponent)"}),o.jsx("option",{value:"own",children:"Own cards only"}),o.jsx("option",{value:"opponent",children:"Opponent's cards only"})]})]}),o.jsxs("label",{children:["Calculation",o.jsxs("select",{value:r.calculation||"none",onChange:y=>{const m=y.target.value,x={...r};m==="none"?delete x.calculation:x.calculation=m,n({...t,targetFilter:x})},children:[o.jsx("option",{value:"none",children:"None"}),o.jsx("option",{value:"highest_value",children:"Highest value"}),o.jsx("option",{value:"lowest_value",children:"Lowest value"})]})]}),o.jsxs("label",{children:["Value Range (specific values to target)",o.jsxs("select",{value:r.valueRange?`${r.valueRange.min}-${r.valueRange.max}`:"none",onChange:y=>{const m=y.target.value,x={...r};m==="none"?delete x.valueRange:m==="0-1"?x.valueRange={min:0,max:1}:m==="1-2"?x.valueRange={min:1,max:2}:m==="0-0"&&(x.valueRange={min:0,max:0}),n({...t,targetFilter:x})},children:[o.jsx("option",{value:"none",children:"Any value"}),o.jsx("option",{value:"0-0",children:"Value 0 only"}),o.jsx("option",{value:"0-1",children:"Values 0 or 1"}),o.jsx("option",{value:"1-2",children:"Values 1 or 2"})]})]}),o.jsxs("label",{children:["Value Source (dynamic value from previous effect)",o.jsxs("select",{value:r.valueSource||"none",onChange:y=>{const m=y.target.value,x={...r};m==="none"?delete x.valueSource:x.valueSource=m,n({...t,targetFilter:x})},children:[o.jsx("option",{value:"none",children:"None (use value range above)"}),o.jsx("option",{value:"previous_effect_card",children:"Previous Effect Card Value"})]}),r.valueSource==="previous_effect_card"&&o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"Delete cards that share the value with the card from the previous effect."})]}),o.jsx("h5",{children:"Scope"}),o.jsxs("label",{children:["Lane Scope",o.jsxs("select",{value:((s=t.scope)==null?void 0:s.type)||"any",onChange:y=>{const m=y.target.value;if(m==="any"){const{scope:x,...S}=t;n(S)}else n({...t,scope:{type:m}})},children:[o.jsx("option",{value:"any",children:"Any lane"}),o.jsx("option",{value:"this_line",children:"This line only"}),o.jsx("option",{value:"other_lanes",children:"Other lanes"}),o.jsx("option",{value:"each_other_line",children:"Each other line (1 per line)"}),o.jsx("option",{value:"each_lane",children:"Each lane (flexible, 1 per line)"})]})]}),(((d=t.scope)==null?void 0:d.type)==="other_lanes"||((u=t.scope)==null?void 0:u.type)==="any")&&o.jsxs("label",{children:["Minimum Cards in Lane",o.jsxs("select",{value:((p=t.scope)==null?void 0:p.minCardsInLane)||0,onChange:y=>{const m=parseInt(y.target.value);if(m===0){const x={...t.scope};delete x.minCardsInLane,n({...t,scope:x})}else n({...t,scope:{...t.scope,minCardsInLane:m}})},children:[o.jsx("option",{value:0,children:"No minimum"}),o.jsx("option",{value:8,children:"8 or more cards (Metal-3)"}),o.jsx("option",{value:6,children:"6 or more cards"}),o.jsx("option",{value:4,children:"4 or more cards"})]}),((f=t.scope)==null?void 0:f.minCardsInLane)&&o.jsxs("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:["Only delete from lanes with ",t.scope.minCardsInLane,"+ cards total."]})]}),o.jsxs("label",{children:["Who Chooses Target?",o.jsxs("select",{value:t.actorChooses||"effect_owner",onChange:y=>{const m=y.target.value;if(m==="effect_owner"){const{actorChooses:x,...S}=t;n(S)}else n({...t,actorChooses:m})},children:[o.jsx("option",{value:"effect_owner",children:"Effect owner chooses (default)"}),o.jsx("option",{value:"card_owner",children:"Card owner chooses (Plague-4: opponent deletes their own)"})]}),t.actorChooses==="card_owner"&&o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"The owner of the targeted card chooses which card to delete."})]}),o.jsx("h5",{children:"Advanced Conditional"}),o.jsxs("label",{children:["Conditional Type",o.jsxs("select",{value:((h=t.advancedConditional)==null?void 0:h.type)||"none",onChange:y=>{if(y.target.value==="none"){const{advancedConditional:m,...x}=t;n(x)}else n({...t,advancedConditional:{type:y.target.value}})},children:[o.jsx("option",{value:"none",children:"None"}),o.jsx("option",{value:"empty_hand",children:"Only if hand is empty"}),o.jsx("option",{value:"opponent_higher_value_in_lane",children:"Only if opponent has higher value in this lane"}),o.jsx("option",{value:"this_card_is_covered",children:"Only if this card is covered"})]})]}),o.jsx("h5",{children:"Lane Restriction"}),o.jsxs("label",{children:["Lane Condition",o.jsxs("select",{value:((w=t.laneCondition)==null?void 0:w.type)||"none",onChange:y=>{const m=y.target.value;if(m==="none"){const{laneCondition:x,selectLane:S,...E}=t;n(E)}else n({...t,laneCondition:{type:m},selectLane:!0})},children:[o.jsx("option",{value:"none",children:"None (any lane)"}),o.jsx("option",{value:"opponent_higher_value",children:"Only lanes where opponent has higher value"})]}),((g=t.laneCondition)==null?void 0:g.type)==="opponent_higher_value"&&o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"Can only delete cards in lanes where opponent's total value is higher than yours. Player selects lane first, then card."})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:t.selectLane||!1,onChange:y=>n({...t,selectLane:y.target.checked})}),"Select lane first (player chooses lane, then card)",o.jsx("small",{style:{display:"block",marginLeft:"24px",color:"#8A79E8"},children:"Enable if player should pick a lane before selecting a card."})]})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const gv=({params:t,onChange:n})=>{const r=t.countType||"fixed",i=t.variableCount,s=r==="equal_to_discarded",d=t.source||"hand";return o.jsxs("div",{className:"param-editor",children:[o.jsx("h4",{children:"Discard Effect"}),o.jsxs("label",{children:["Source",o.jsxs("select",{value:d,onChange:u=>n({...t,source:u.target.value}),children:[o.jsx("option",{value:"hand",children:"From Hand"}),o.jsx("option",{value:"top_deck_own",children:"Top of Own Deck (automatic)"}),o.jsx("option",{value:"top_deck_opponent",children:"Top of Opponent's Deck (automatic)"}),o.jsx("option",{value:"entire_deck",children:"Entire Deck (automatic)"})]}),(d==="top_deck_own"||d==="top_deck_opponent")&&o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"Deck discard is automatic - no player choice needed. The discarded card's value is saved for follow-up effects."}),d==="entire_deck"&&o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"Discards all cards from your deck to trash automatically."})]}),d==="hand"&&o.jsxs("label",{children:["Count Type",o.jsxs("select",{value:r,onChange:u=>n({...t,countType:u.target.value}),children:[o.jsx("option",{value:"fixed",children:"Fixed Count"}),o.jsx("option",{value:"equal_to_discarded",children:"Equal to Previously Discarded (Plague-2)"})]})]}),d==="hand"&&r==="fixed"&&o.jsxs("label",{children:["Count",o.jsxs("select",{value:i?"variable":t.count.toString(),onChange:u=>{const p=u.target.value;if(p==="variable")n({...t,variableCount:!0,count:1});else if(p==="all"){const{variableCount:f,...h}=t;n({...h,count:"all"})}else{const{variableCount:f,...h}=t;n({...h,count:parseInt(p)})}},children:[o.jsx("option",{value:"1",children:"1 card"}),o.jsx("option",{value:"2",children:"2 cards"}),o.jsx("option",{value:"3",children:"3 cards"}),o.jsx("option",{value:"all",children:"All cards (entire hand)"}),o.jsx("option",{value:"variable",children:"1 or more cards (variable)"})]})]}),d==="hand"&&s&&o.jsxs("label",{children:["Offset (add to count)",o.jsx("input",{type:"number",value:t.countOffset||0,onChange:u=>n({...t,countOffset:parseInt(u.target.value)}),min:"-5",max:"5"})]}),d==="hand"&&o.jsxs("label",{children:["Actor",o.jsxs("select",{value:t.actor,onChange:u=>n({...t,actor:u.target.value}),children:[o.jsx("option",{value:"self",children:"Self"}),o.jsx("option",{value:"opponent",children:"Opponent"}),o.jsx("option",{value:"both",children:"Both Players"})]}),t.actor==="both"&&o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"Both players discard simultaneously (automatic, no selection needed)."})]}),d==="hand"&&t.actor==="opponent"&&o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:t.random||!1,onChange:u=>n({...t,random:u.target.checked})}),"Random selection (opponent can't choose which card)",o.jsx("small",{style:{display:"block",marginLeft:"24px",marginTop:"4px",color:"#8A79E8"},children:"A random card is discarded instead of opponent choosing."})]}),d==="hand"&&o.jsxs("label",{children:["Discard to",o.jsxs("select",{value:t.discardTo||"own_trash",onChange:u=>n({...t,discardTo:u.target.value}),children:[o.jsx("option",{value:"own_trash",children:"Own trash (default)"}),o.jsx("option",{value:"opponent_trash",children:"Opponent's trash"})]}),t.discardTo==="opponent_trash"&&o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"Card goes to opponent's trash instead of your own."})]})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const vv=({params:t,onChange:n})=>{var f,h,w,g,y;const r=((f=t.targetFilter)==null?void 0:f.owner)||"any",i=((h=t.targetFilter)==null?void 0:h.position)||"uncovered",s=(w=t.targetFilter)==null?void 0:w.faceState,d=(g=t.targetFilter)==null?void 0:g.valueEquals,u=t.selectLane||!1,p=t.destination||"owner_hand";return o.jsxs("div",{className:"param-editor",children:[o.jsx("h4",{children:"Return Effect"}),o.jsxs("label",{children:["Count",o.jsxs("select",{value:typeof t.count=="number"?t.count.toString():"all",onChange:m=>n({...t,count:m.target.value==="all"?"all":parseInt(m.target.value)}),children:[o.jsx("option",{value:"1",children:"1"}),o.jsx("option",{value:"2",children:"2"}),o.jsx("option",{value:"all",children:"All"})]})]}),o.jsxs("label",{children:["Whose cards?",o.jsxs("select",{value:r,onChange:m=>n({...t,targetFilter:{...t.targetFilter,owner:m.target.value}}),children:[o.jsx("option",{value:"any",children:"Any card (own or opponent)"}),o.jsx("option",{value:"own",children:"Only own cards"}),o.jsx("option",{value:"opponent",children:"Only opponent cards"})]})]}),o.jsxs("label",{children:["Position",o.jsxs("select",{value:i,onChange:m=>n({...t,targetFilter:{...t.targetFilter,position:m.target.value}}),children:[o.jsx("option",{value:"uncovered",children:"Uncovered (default)"}),o.jsx("option",{value:"covered",children:"Covered"}),o.jsx("option",{value:"any",children:"Any (covered or uncovered)"})]})]}),o.jsxs("label",{children:["Face State Filter",o.jsxs("select",{value:s||"any",onChange:m=>{const x=m.target.value;if(x==="any"){const{faceState:S,...E}=t.targetFilter||{};n({...t,targetFilter:E})}else n({...t,targetFilter:{...t.targetFilter,faceState:x}})},children:[o.jsx("option",{value:"any",children:"Any (face-up or face-down)"}),o.jsx("option",{value:"face_up",children:"Face-up only"}),o.jsx("option",{value:"face_down",children:"Face-down only"})]})]}),r==="opponent"&&o.jsxs("label",{children:["Card goes to",o.jsxs("select",{value:p,onChange:m=>n({...t,destination:m.target.value}),children:[o.jsx("option",{value:"owner_hand",children:"Owner's hand (normal return)"}),o.jsx("option",{value:"actor_hand",children:"Your hand (steal)"})]}),p==="actor_hand"&&o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"Steal: Card goes to your hand instead of owner's hand."})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:u,onChange:m=>{if(m.target.checked)n({...t,selectLane:!0});else{const{selectLane:x,...S}=t;n(S)}}}),'Select lane first (Water-3: "in 1 line")']}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:d!==void 0,onChange:m=>{if(m.target.checked)n({...t,targetFilter:{...t.targetFilter,valueEquals:2}});else{const{valueEquals:x,...S}=t.targetFilter||{};n({...t,targetFilter:S})}}}),"Filter by value"]}),d!==void 0&&o.jsxs("label",{children:["Value to return",o.jsx("input",{type:"number",min:0,max:6,value:d,onChange:m=>n({...t,targetFilter:{...t.targetFilter,valueEquals:parseInt(m.target.value)||0}})})]}),o.jsx("h5",{children:"Return This Card"}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:t.returnSelf||!1,onChange:m=>{if(m.target.checked)n({...t,returnSelf:!0});else{const{returnSelf:x,...S}=t;n(S)}}}),"Return this card (self)"]}),t.returnSelf&&o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:t.optional||!1,onChange:m=>n({...t,optional:m.target.checked})}),'Optional ("You may return")']}),o.jsx("h5",{children:"Advanced Conditional"}),o.jsxs("label",{children:["Conditional Type",o.jsxs("select",{value:((y=t.advancedConditional)==null?void 0:y.type)||"none",onChange:m=>{if(m.target.value==="none"){const{advancedConditional:x,...S}=t;n(S)}else n({...t,advancedConditional:{type:m.target.value}})},children:[o.jsx("option",{value:"none",children:"None"}),o.jsx("option",{value:"empty_hand",children:"Only if hand is empty"}),o.jsx("option",{value:"opponent_higher_value_in_lane",children:"Only if opponent has higher value in this lane"}),o.jsx("option",{value:"this_card_is_covered",children:"Only if this card is covered"})]})]})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const _v=({params:t,onChange:n})=>{var i,s,d,u;const r=t.destinationRule||{type:"other_lines"};return o.jsxs("div",{className:"param-editor",children:[o.jsx("h4",{children:"Play Effect"}),o.jsxs("label",{children:["Actor (who plays)",o.jsxs("select",{value:t.actor||"self",onChange:p=>{if(p.target.value==="self"){const{actor:f,...h}=t;n(h)}else n({...t,actor:p.target.value})},children:[o.jsx("option",{value:"self",children:"You"}),o.jsx("option",{value:"opponent",children:"Opponent"})]})]}),o.jsxs("label",{children:["Source",o.jsxs("select",{value:t.source,onChange:p=>n({...t,source:p.target.value}),children:[o.jsx("option",{value:"hand",children:"Hand"}),o.jsx("option",{value:"deck",children:"Deck"}),o.jsx("option",{value:"trash",children:"Trash (Discard Pile)"})]})]}),(t.source==="deck"||t.source==="trash")&&o.jsxs("label",{children:["Source Owner",o.jsxs("select",{value:t.sourceOwner||"own",onChange:p=>n({...t,sourceOwner:p.target.value}),children:[o.jsxs("option",{value:"own",children:["Own ",t.source]}),o.jsxs("option",{value:"opponent",children:["Opponent's ",t.source]})]}),t.sourceOwner==="opponent"&&o.jsxs("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:["Card is taken from opponent's ",t.source," instead of your own."]})]}),o.jsxs("label",{children:["Anzahl",o.jsx("input",{type:"number",min:1,max:6,value:t.count,onChange:p=>n({...t,count:parseInt(p.target.value)||1})})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:t.faceDown,onChange:p=>n({...t,faceDown:p.target.checked})}),"Face-down"]}),o.jsxs("label",{children:["Destination",o.jsxs("select",{value:r.type,onChange:p=>n({...t,destinationRule:{...r,type:p.target.value}}),children:[o.jsx("option",{value:"other_lines",children:"Other lines (choose 1)"}),o.jsx("option",{value:"each_other_line",children:"Each other line (1 per line)"}),o.jsx("option",{value:"specific_lane",children:"Specific lane (this line)"}),o.jsx("option",{value:"each_line_with_card",children:"Each line with card"}),o.jsx("option",{value:"line_with_matching_cards",children:"Line with matching cards (choose 1)"}),o.jsx("option",{value:"under_this_card",children:"Under this card"})]})]}),(r.type==="each_line_with_card"||r.type==="line_with_matching_cards")&&o.jsxs("label",{children:["Card Filter (which cards must be in line)",o.jsxs("select",{value:((i=r.cardFilter)==null?void 0:i.faceState)||"any",onChange:p=>{const f=p.target.value;if(f==="any"){const{cardFilter:h,...w}=r;n({...t,destinationRule:w})}else n({...t,destinationRule:{...r,cardFilter:{faceState:f}}})},children:[o.jsx("option",{value:"any",children:"Any card"}),o.jsx("option",{value:"face_down",children:"Face-down cards only"}),o.jsx("option",{value:"face_up",children:"Face-up cards only"})]})]}),o.jsxs("label",{children:["Target Board",o.jsxs("select",{value:t.targetBoard||"own",onChange:p=>n({...t,targetBoard:p.target.value}),children:[o.jsx("option",{value:"own",children:"Own board (default)"}),o.jsx("option",{value:"opponent",children:"Opponent's board"})]}),t.targetBoard==="opponent"&&o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"Card is played on opponent's board instead of your own."})]}),o.jsxs("label",{children:["Condition",o.jsxs("select",{value:((s=t.condition)==null?void 0:s.type)||"none",onChange:p=>{const f=p.target.value;if(f==="none"){const{condition:h,...w}=t;n(w)}else n(f==="per_x_cards_in_line"?{...t,condition:{type:f,cardCount:2}}:{...t,condition:{type:f}})},children:[o.jsx("option",{value:"none",children:"None (always play)"}),o.jsx("option",{value:"per_x_cards_in_line",children:"For every X cards in this line"}),o.jsx("option",{value:"only_in_lines_with_cards",children:"Only in lines where you have a card"})]})]}),((d=t.condition)==null?void 0:d.type)==="per_x_cards_in_line"&&o.jsxs("label",{children:["Cards per play (X)",o.jsx("input",{type:"number",min:1,max:6,value:t.condition.cardCount||2,onChange:p=>n({...t,condition:{...t.condition,cardCount:parseInt(p.target.value)||2}})}),o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:'Example: "For every 2 cards in this line, play..."  X = 2'})]}),o.jsx("h5",{children:"Advanced Conditional"}),o.jsxs("label",{children:["Conditional Type",o.jsxs("select",{value:((u=t.advancedConditional)==null?void 0:u.type)||"none",onChange:p=>{if(p.target.value==="none"){const{advancedConditional:f,...h}=t;n(h)}else n({...t,advancedConditional:{type:p.target.value}})},children:[o.jsx("option",{value:"none",children:"None"}),o.jsx("option",{value:"empty_hand",children:"Only if hand is empty"}),o.jsx("option",{value:"opponent_higher_value_in_lane",children:"Only if opponent has higher value in this lane"})]})]})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const wv=({params:t,onChange:n})=>o.jsxs("div",{className:"param-editor",children:[o.jsx("h4",{children:"Protocol Effect"}),o.jsxs("label",{children:["Action",o.jsxs("select",{value:t.action,onChange:r=>n({...t,action:r.target.value}),children:[o.jsx("option",{value:"rearrange_protocols",children:"Rearrange"}),o.jsx("option",{value:"swap_protocols",children:"Swap"})]})]}),o.jsxs("label",{children:["Target",o.jsxs("select",{value:t.target,onChange:r=>n({...t,target:r.target.value}),children:[o.jsx("option",{value:"own",children:"Own"}),o.jsx("option",{value:"opponent",children:"Opponent"}),o.jsx("option",{value:"both_sequential",children:"Beide (nacheinander)"})]})]}),o.jsx("h5",{children:"Restriction (Anarchy-3)"}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:!!t.restriction,onChange:r=>{if(r.target.checked)n({...t,restriction:{disallowedProtocol:"",laneIndex:"current"}});else{const{restriction:i,...s}=t;n(s)}}}),"Add restriction (protocol cannot be on specific lane)"]}),t.restriction&&o.jsxs(o.Fragment,{children:[o.jsxs("label",{children:["Disallowed Protocol",o.jsx("input",{type:"text",value:t.restriction.disallowedProtocol,onChange:r=>n({...t,restriction:{...t.restriction,disallowedProtocol:r.target.value}}),placeholder:"e.g., Anarchy, Fire, Death"})]}),o.jsxs("label",{children:["Lane",o.jsxs("select",{value:t.restriction.laneIndex,onChange:r=>n({...t,restriction:{...t.restriction,laneIndex:r.target.value==="current"?"current":parseInt(r.target.value)}}),children:[o.jsx("option",{value:"current",children:"Current lane (where this card is)"}),o.jsx("option",{value:"0",children:"Lane 1 (Left)"}),o.jsx("option",{value:"1",children:"Lane 2 (Middle)"}),o.jsx("option",{value:"2",children:"Lane 3 (Right)"})]})]})]})]});/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const xv=({params:t,onChange:n})=>{var r;return o.jsxs("div",{className:"param-editor",children:[o.jsx("h4",{children:"Reveal/Give Effect"}),o.jsxs("label",{children:["Action",o.jsxs("select",{value:t.action,onChange:i=>n({...t,action:i.target.value}),children:[o.jsx("option",{value:"reveal",children:"Reveal"}),o.jsx("option",{value:"give",children:"Give"})]})]}),o.jsxs("label",{children:["Source",o.jsxs("select",{value:t.source,onChange:i=>n({...t,source:i.target.value}),children:[o.jsx("option",{value:"own_hand",children:"Your hand"}),o.jsx("option",{value:"opponent_hand",children:"Opponent's hand"}),o.jsx("option",{value:"own_deck_top",children:"Top of your deck"}),o.jsx("option",{value:"own_deck",children:"Your entire deck"}),o.jsx("option",{value:"own_trash",children:"Your trash (discard pile)"}),o.jsx("option",{value:"board",children:"Board card"})]})]}),(t.source==="own_hand"||t.source==="opponent_hand"||t.source==="board"||t.source==="own_trash")&&o.jsxs("label",{children:["Anzahl",o.jsx("input",{type:"number",min:1,max:6,value:t.count,onChange:i=>n({...t,count:parseInt(i.target.value)||1})})]}),t.source==="board"&&o.jsxs("label",{children:["Follow-up action",o.jsxs("select",{value:t.followUpAction||"none",onChange:i=>{if(i.target.value==="none"){const{followUpAction:s,...d}=t;n(d)}else n({...t,followUpAction:i.target.value})},children:[o.jsx("option",{value:"none",children:"None"}),o.jsx("option",{value:"flip",children:"Then flip"}),o.jsx("option",{value:"shift",children:"Then shift"})]})]}),t.source==="own_hand"&&t.action==="reveal"&&o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:((r=t.protocolFilter)==null?void 0:r.type)==="same_as_source",onChange:i=>{if(i.target.checked)n({...t,protocolFilter:{type:"same_as_source"}});else{const{protocolFilter:s,...d}=t;n(d)}}}),"Reveal all same-protocol cards (Unity-0)",o.jsx("small",{style:{display:"block",marginLeft:"24px",color:"#8A79E8"},children:"Reveals all cards in hand that match this card's protocol."})]})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Cv=({params:t,onChange:n})=>o.jsxs("div",{className:"param-editor take-effect-editor",children:[o.jsx("h4",{children:"Take Effect Parameters"}),o.jsxs("label",{children:["Card Count",o.jsx("input",{type:"number",min:1,max:6,value:t.count,onChange:r=>n({...t,count:parseInt(r.target.value)||1})})]}),o.jsxs("label",{children:["Source",o.jsx("select",{value:t.source,onChange:r=>n({...t,source:r.target.value}),children:o.jsx("option",{value:"opponent_hand",children:"Opponent's Hand"})})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:t.random,onChange:r=>n({...t,random:r.target.checked})}),"Random (if unchecked, you choose)"]})]}),_i=t=>{switch(t){case"draw":return{action:"draw",count:1,target:"self",source:"own_deck"};case"flip":return{action:"flip",count:1,targetFilter:{owner:"any",position:"any",faceState:"any",excludeSelf:!1},optional:!1};case"shift":return{action:"shift",targetFilter:{owner:"any",position:"any",faceState:"any"},destinationRestriction:{type:"any"}};case"delete":return{action:"delete",count:1,targetFilter:{position:"any",faceState:"any"},scope:{type:"anywhere"},excludeSelf:!1};case"discard":return{action:"discard",count:1,actor:"self"};case"return":return{action:"return",count:1,targetFilter:{},scope:{type:"any_card"}};case"play":return{action:"play",source:"hand",count:1,faceDown:!1,destinationRule:{type:"other_lines"}};case"rearrange_protocols":return{action:"rearrange_protocols",target:"own"};case"swap_protocols":return{action:"swap_protocols",target:"own"};case"reveal":case"give":return{action:t,source:"own_hand",count:1};case"take":return{action:"take",source:"opponent_hand",count:1,random:!0};default:return{}}},Cj=({params:t,onChange:n})=>{const[r,i]=se.useState(""),[s,d]=se.useState(""),[u,p]=se.useState(null),f=t.options||[],h=f[0],w=f[1],g=()=>{if(!r)return;const N={id:st(),params:_i(r),position:"middle",trigger:"on_play"};n({...t,options:[N,w].filter(Boolean)}),i(""),p(1)},y=()=>{if(!s)return;const N={id:st(),params:_i(s),position:"middle",trigger:"on_play"};n({...t,options:[h,N].filter(Boolean)}),d(""),p(2)},m=()=>{n({...t,options:[w].filter(Boolean)}),u===1&&p(null)},x=()=>{n({...t,options:[h].filter(Boolean)}),u===2&&p(null)},S=N=>{const U={...h,params:N};n({...t,options:[U,w].filter(Boolean)})},E=N=>{const U={...w,params:N};n({...t,options:[h,U].filter(Boolean)})},j=N=>{const U=_i(N),V={...h,params:U};n({...t,options:[V,w].filter(Boolean)})},b=N=>{const U=_i(N),V={...w,params:U};n({...t,options:[h,V].filter(Boolean)})},k=(N,U)=>{switch(N.params.action){case"draw":return o.jsx(fv,{params:N.params,onChange:U});case"flip":return o.jsx(hv,{params:N.params,onChange:U});case"shift":return o.jsx(mv,{params:N.params,onChange:U});case"delete":return o.jsx(yv,{params:N.params,onChange:U});case"discard":return o.jsx(gv,{params:N.params,onChange:U});case"return":return o.jsx(vv,{params:N.params,onChange:U});case"play":return o.jsx(_v,{params:N.params,onChange:U});case"rearrange_protocols":case"swap_protocols":return o.jsx(wv,{params:N.params,onChange:U});case"reveal":case"give":return o.jsx(xv,{params:N.params,onChange:U});case"take":return o.jsx(Cv,{params:N.params,onChange:U});default:return o.jsx("div",{children:"Unknown effect type"})}};return o.jsxs("div",{style:{padding:"10px",backgroundColor:"#2c1d63",borderRadius:"4px",border:"1px solid rgba(97, 239, 255, 0.3)"},children:[o.jsx("h4",{style:{color:"#61EFFF",marginTop:0},children:"Either/Or Choice"}),o.jsx("p",{style:{color:"#F0F0F0",fontSize:"14px",marginBottom:"15px"},children:'Player chooses one of two options. Example: "Either discard 1 card or flip this card"'}),o.jsxs("div",{style:{marginBottom:"15px",padding:"10px",backgroundColor:"rgba(97, 239, 255, 0.05)",borderRadius:"4px"},children:[o.jsx("label",{style:{color:"#61EFFF",display:"block",marginBottom:"10px",fontWeight:"bold"},children:"Option 1:"}),h?o.jsxs(o.Fragment,{children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"10px"},children:[o.jsxs("select",{value:h.params.action,onChange:N=>j(N.target.value),style:{flex:1,padding:"8px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px"},children:[o.jsx("option",{value:"draw",children:"Draw Cards"}),o.jsx("option",{value:"flip",children:"Flip Cards"}),o.jsx("option",{value:"shift",children:"Shift Card"}),o.jsx("option",{value:"delete",children:"Delete Cards"}),o.jsx("option",{value:"discard",children:"Discard Cards"}),o.jsx("option",{value:"return",children:"Return to Hand"}),o.jsx("option",{value:"play",children:"Play from Hand/Deck"})]}),o.jsx("button",{onClick:()=>p(u===1?null:1),style:{padding:"8px 15px",backgroundColor:u===1?"#8B0000":"#61EFFF",color:u===1?"#F0F0F0":"#0A051A",border:"none",borderRadius:"4px",cursor:"pointer",fontWeight:"bold"},children:u===1?"Hide":"Edit"}),o.jsx("button",{onClick:m,style:{padding:"8px 15px",backgroundColor:"#8B0000",color:"#F0F0F0",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Remove"})]}),u===1&&o.jsx("div",{style:{marginTop:"10px"},children:k(h,S)})]}):o.jsxs("div",{style:{display:"flex",gap:"10px"},children:[o.jsxs("select",{value:r,onChange:N=>i(N.target.value),style:{flex:1,padding:"8px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px"},children:[o.jsx("option",{value:"",children:"Choose Action"}),o.jsx("option",{value:"draw",children:"Draw Cards"}),o.jsx("option",{value:"flip",children:"Flip Cards"}),o.jsx("option",{value:"shift",children:"Shift Card"}),o.jsx("option",{value:"delete",children:"Delete Cards"}),o.jsx("option",{value:"discard",children:"Discard Cards"}),o.jsx("option",{value:"return",children:"Return to Hand"}),o.jsx("option",{value:"play",children:"Play from Hand/Deck"})]}),o.jsx("button",{onClick:g,disabled:!r,style:{padding:"8px 15px",backgroundColor:r?"#61EFFF":"#444",color:"#0A051A",border:"none",borderRadius:"4px",cursor:r?"pointer":"not-allowed",fontWeight:"bold"},children:"Add"})]})]}),o.jsxs("div",{style:{padding:"10px",backgroundColor:"rgba(97, 239, 255, 0.05)",borderRadius:"4px"},children:[o.jsx("label",{style:{color:"#61EFFF",display:"block",marginBottom:"10px",fontWeight:"bold"},children:"Option 2:"}),w?o.jsxs(o.Fragment,{children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"10px"},children:[o.jsxs("select",{value:w.params.action,onChange:N=>b(N.target.value),style:{flex:1,padding:"8px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px"},children:[o.jsx("option",{value:"draw",children:"Draw Cards"}),o.jsx("option",{value:"flip",children:"Flip Cards"}),o.jsx("option",{value:"shift",children:"Shift Card"}),o.jsx("option",{value:"delete",children:"Delete Cards"}),o.jsx("option",{value:"discard",children:"Discard Cards"}),o.jsx("option",{value:"return",children:"Return to Hand"}),o.jsx("option",{value:"play",children:"Play from Hand/Deck"})]}),o.jsx("button",{onClick:()=>p(u===2?null:2),style:{padding:"8px 15px",backgroundColor:u===2?"#8B0000":"#61EFFF",color:u===2?"#F0F0F0":"#0A051A",border:"none",borderRadius:"4px",cursor:"pointer",fontWeight:"bold"},children:u===2?"Hide":"Edit"}),o.jsx("button",{onClick:x,style:{padding:"8px 15px",backgroundColor:"#8B0000",color:"#F0F0F0",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Remove"})]}),u===2&&o.jsx("div",{style:{marginTop:"10px"},children:k(w,E)})]}):o.jsxs("div",{style:{display:"flex",gap:"10px"},children:[o.jsxs("select",{value:s,onChange:N=>d(N.target.value),style:{flex:1,padding:"8px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px"},children:[o.jsx("option",{value:"",children:"Choose Action"}),o.jsx("option",{value:"draw",children:"Draw Cards"}),o.jsx("option",{value:"flip",children:"Flip Cards"}),o.jsx("option",{value:"shift",children:"Shift Card"}),o.jsx("option",{value:"delete",children:"Delete Cards"}),o.jsx("option",{value:"discard",children:"Discard Cards"}),o.jsx("option",{value:"return",children:"Return to Hand"}),o.jsx("option",{value:"play",children:"Play from Hand/Deck"})]}),o.jsx("button",{onClick:y,disabled:!s,style:{padding:"8px 15px",backgroundColor:s?"#61EFFF":"#444",color:"#0A051A",border:"none",borderRadius:"4px",cursor:s?"pointer":"not-allowed",fontWeight:"bold"},children:"Add"})]})]}),f.length===2&&o.jsx("div",{style:{marginTop:"15px",padding:"10px",backgroundColor:"rgba(97, 239, 255, 0.1)",borderRadius:"4px"},children:o.jsx("p",{style:{color:"#61EFFF",fontSize:"14px",margin:0},children:" Both options configured. Player will choose one during gameplay."})})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Sj=({params:t,onChange:n})=>{var f,h,w,g,y,m;const r=((f=t.rule)==null?void 0:f.type)||"block_all_play",i=((h=t.rule)==null?void 0:h.target)||"opponent",s=((w=t.rule)==null?void 0:w.scope)||"this_lane",d=((g=t.rule)==null?void 0:g.onlyDuringYourTurn)||!1,u=((y=t.rule)==null?void 0:y.conditionTarget)||"self",p=((m=t.rule)==null?void 0:m.blockTarget)||"self";return o.jsxs("div",{className:"param-editor passive-rule-editor",children:[o.jsx("h4",{children:"Passive Rule Parameters"}),o.jsx("p",{style:{color:"#8A79E8",fontSize:"14px",marginBottom:"15px"},children:"This rule is active while the card is face-up. It modifies game behavior."}),o.jsxs("label",{children:["Rule Type",o.jsxs("select",{value:r,onChange:x=>n({...t,rule:{...t.rule,type:x.target.value,target:i,scope:s}}),children:[o.jsxs("optgroup",{label:"Play Restrictions",children:[o.jsx("option",{value:"block_face_down_play",children:"Block Face-Down Plays (Metal-2)"}),o.jsx("option",{value:"block_face_up_play",children:"Block Face-Up Plays"}),o.jsx("option",{value:"block_all_play",children:"Block All Plays (Plague-0)"}),o.jsx("option",{value:"require_face_down_play",children:"Require Face-Down Plays (Psychic-1)"})]}),o.jsxs("optgroup",{label:"Protocol Matching",children:[o.jsx("option",{value:"allow_any_protocol_play",children:"Allow Any Protocol (Spirit-1, Chaos-3)"}),o.jsx("option",{value:"allow_play_on_opponent_side",children:"Allow Play on Opponent Side (Corruption-0)"}),o.jsx("option",{value:"allow_same_protocol_face_up_play",children:"Allow Same Protocol Face-Up Play (Unity-1)"}),o.jsx("option",{value:"require_non_matching_protocol",children:"Require Non-Matching (Anarchy-1)"})]}),o.jsxs("optgroup",{label:"Action Blocks",children:[o.jsx("option",{value:"block_flips",children:"Block Flips (Frost-1)"}),o.jsx("option",{value:"block_protocol_rearrange",children:"Block Protocol Rearrange (Frost-1)"}),o.jsx("option",{value:"block_shifts_from_lane",children:"Block Shifts From Lane (Frost-3)"}),o.jsx("option",{value:"block_shifts_to_lane",children:"Block Shifts To Lane (Frost-3)"}),o.jsx("option",{value:"block_flip_this_card",children:"This Card Cannot Be Flipped"})]}),o.jsx("optgroup",{label:"Draw Restrictions",children:o.jsx("option",{value:"block_draw_conditional",children:"Conditional Draw Block"})}),o.jsx("optgroup",{label:"Effect Modifications",children:o.jsx("option",{value:"ignore_middle_commands",children:"Ignore Middle Commands (Apathy-2)"})}),o.jsx("optgroup",{label:"Phase Modifications",children:o.jsx("option",{value:"skip_check_cache_phase",children:"Skip Check Cache Phase (Spirit-0)"})})]})]}),o.jsxs("label",{children:["Affected Player",o.jsxs("select",{value:i,onChange:x=>n({...t,rule:{...t.rule,type:r,target:x.target.value,scope:s}}),children:[o.jsx("option",{value:"self",children:"Self (You)"}),o.jsx("option",{value:"opponent",children:"Opponent"}),o.jsx("option",{value:"all",children:"All Players"})]})]}),o.jsxs("label",{children:["Scope",o.jsxs("select",{value:s,onChange:x=>n({...t,rule:{...t.rule,type:r,target:i,scope:x.target.value,onlyDuringYourTurn:d}}),children:[o.jsx("option",{value:"this_lane",children:"This Lane Only"}),o.jsx("option",{value:"global",children:"Global (All Lanes)"})]})]}),r==="ignore_middle_commands"&&o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:d,onChange:x=>n({...t,rule:{...t.rule,type:r,target:i,scope:s,onlyDuringYourTurn:x.target.checked}})}),"Only during your turn",o.jsx("small",{style:{display:"block",marginLeft:"24px",marginTop:"4px",color:"#8A79E8"},children:"Effect only applies during card owner's turn, not during opponent's turn."})]}),r==="block_draw_conditional"&&o.jsxs(o.Fragment,{children:[o.jsxs("label",{children:["Condition (who must have cards in hand)",o.jsxs("select",{value:u,onChange:x=>n({...t,rule:{...t.rule,type:r,target:"this_card",scope:"global",conditionTarget:x.target.value,blockTarget:p}}),children:[o.jsx("option",{value:"self",children:"Card owner (you)"}),o.jsx("option",{value:"opponent",children:"Opponent of card owner"})]}),o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"If this player has any cards in hand, the draw block activates."})]}),o.jsxs("label",{children:["Block target (who cannot draw)",o.jsxs("select",{value:p,onChange:x=>n({...t,rule:{...t.rule,type:r,target:"this_card",scope:"global",conditionTarget:u,blockTarget:x.target.value}}),children:[o.jsx("option",{value:"self",children:"Card owner (you)"}),o.jsx("option",{value:"opponent",children:"Opponent of card owner"}),o.jsx("option",{value:"all",children:"Both players"})]}),o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"This player cannot draw cards when the condition is met."})]})]}),r==="block_flip_this_card"&&o.jsx("small",{style:{display:"block",marginTop:"8px",color:"#8A79E8"},children:"This card cannot be flipped by any effect. Only affects this specific card."}),r==="allow_same_protocol_face_up_play"&&o.jsx("small",{style:{display:"block",marginTop:"8px",color:"#8A79E8"},children:"Cards of the same protocol as this card may be played face-up in this lane (bypasses the normal face-down play requirement for non-first cards)."})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const bj=({params:t,onChange:n})=>{var g,y,m,x,S,E,j,b,k;const r=((g=t.modifier)==null?void 0:g.type)||"add_per_condition",i=((y=t.modifier)==null?void 0:y.value)||1,s=((m=t.modifier)==null?void 0:m.condition)||"per_face_down_card",d=((x=t.modifier)==null?void 0:x.target)||"own_total",u=((S=t.modifier)==null?void 0:S.scope)||"this_lane",p=((j=(E=t.modifier)==null?void 0:E.filter)==null?void 0:j.faceState)||"face_down",f=((k=(b=t.modifier)==null?void 0:b.filter)==null?void 0:k.position)||"any",h=r==="add_per_condition",w=r==="set_to_fixed"&&(d==="own_cards"||d==="opponent_cards"||d==="all_cards");return o.jsxs("div",{className:"param-editor value-modifier-editor",children:[o.jsx("h4",{children:"Value Modifier Parameters"}),o.jsx("p",{style:{color:"#8A79E8",fontSize:"14px",marginBottom:"15px"},children:"This modifier is active while the card is face-up. It modifies card values or lane totals."}),o.jsxs("label",{children:["Modifier Type",o.jsxs("select",{value:r,onChange:N=>n({...t,modifier:{...t.modifier,type:N.target.value,value:i,condition:h?s:void 0,target:d,scope:u,filter:w?{faceState:p,position:f}:void 0}}),children:[o.jsx("option",{value:"add_per_condition",children:"Add Per Condition (Apathy-0: +1 per face-down)"}),o.jsx("option",{value:"set_to_fixed",children:"Set Cards To Fixed Value (Darkness-2: face-down = 4)"}),o.jsx("option",{value:"add_to_total",children:"Add To Lane Total (Metal-0: opponent total -2)"})]})]}),o.jsxs("label",{children:["Value",o.jsx("input",{type:"number",value:i,onChange:N=>n({...t,modifier:{...t.modifier,type:r,value:parseInt(N.target.value)||0,condition:h?s:void 0,target:d,scope:u,filter:w?{faceState:p,position:f}:void 0}}),style:{width:"100%",padding:"8px",marginTop:"5px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px"}}),o.jsxs("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:[r==="add_per_condition"&&"Value to add per condition (e.g., +1)",r==="set_to_fixed"&&"Fixed value to set cards to (e.g., 4)",r==="add_to_total"&&"Value to add to total (use negative for subtraction, e.g., -2)"]})]}),h&&o.jsxs("label",{children:["Condition",o.jsxs("select",{value:s,onChange:N=>n({...t,modifier:{...t.modifier,type:r,value:i,condition:N.target.value,target:d,scope:u,filter:w?{faceState:p,position:f}:void 0}}),children:[o.jsx("option",{value:"per_face_down_card",children:"Per Face-Down Card"}),o.jsx("option",{value:"per_face_up_card",children:"Per Face-Up Card"}),o.jsx("option",{value:"per_card",children:"Per Card (any)"}),o.jsx("option",{value:"per_card_in_hand",children:"Per Card in Your Hand"}),o.jsx("option",{value:"per_opponent_card_in_lane",children:"Per Opponent Card in Lane"})]})]}),o.jsxs("label",{children:["Target",o.jsxs("select",{value:d,onChange:N=>n({...t,modifier:{...t.modifier,type:r,value:i,condition:h?s:void 0,target:N.target.value,scope:u,filter:w?{faceState:p,position:f}:void 0}}),children:[o.jsxs("optgroup",{label:"Card Values",children:[o.jsx("option",{value:"own_cards",children:"Own Cards"}),o.jsx("option",{value:"opponent_cards",children:"Opponent Cards"}),o.jsx("option",{value:"all_cards",children:"All Cards"})]}),o.jsxs("optgroup",{label:"Lane Totals",children:[o.jsx("option",{value:"own_total",children:"Own Total"}),o.jsx("option",{value:"opponent_total",children:"Opponent Total"})]})]})]}),w&&o.jsxs(o.Fragment,{children:[o.jsxs("label",{children:["Card Face State (Filter)",o.jsxs("select",{value:p,onChange:N=>n({...t,modifier:{...t.modifier,type:r,value:i,condition:h?s:void 0,target:d,scope:u,filter:{faceState:N.target.value,position:f}}}),children:[o.jsx("option",{value:"face_down",children:"Face-Down Only"}),o.jsx("option",{value:"face_up",children:"Face-Up Only"}),o.jsx("option",{value:"any",children:"Any"})]})]}),o.jsxs("label",{children:["Card Position (Filter)",o.jsxs("select",{value:f,onChange:N=>n({...t,modifier:{...t.modifier,type:r,value:i,condition:h?s:void 0,target:d,scope:u,filter:{faceState:p,position:N.target.value}}}),children:[o.jsx("option",{value:"any",children:"Any Position"}),o.jsx("option",{value:"covered",children:"Covered Only"}),o.jsx("option",{value:"uncovered",children:"Uncovered Only"})]})]})]}),o.jsxs("label",{children:["Scope",o.jsxs("select",{value:u,onChange:N=>n({...t,modifier:{...t.modifier,type:r,value:i,condition:h?s:void 0,target:d,scope:N.target.value,filter:w?{faceState:p,position:f}:void 0}}),children:[o.jsx("option",{value:"this_lane",children:"This Lane Only"}),o.jsx("option",{value:"global",children:"Global (All Lanes)"})]})]})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Ej=({params:t,onChange:n})=>o.jsxs("div",{className:"param-editor block-compile-effect-editor",children:[o.jsx("h4",{children:"Block Compile Effect Parameters"}),o.jsxs("label",{children:["Target",o.jsxs("select",{value:t.target||"opponent",onChange:r=>n({...t,target:r.target.value}),children:[o.jsx("option",{value:"opponent",children:"Opponent cannot compile next turn"}),o.jsx("option",{value:"self",children:"You cannot compile next turn"})]})]})]});/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const jj=({params:t,onChange:n})=>{var i;const r=((i=t.laneCondition)==null?void 0:i.count)||8;return o.jsxs("div",{className:"param-editor delete-all-in-lane-effect-editor",children:[o.jsx("h4",{children:"Delete All In Lane Effect Parameters"}),o.jsxs("label",{children:["Minimum cards in lane",o.jsxs("select",{value:r,onChange:s=>n({...t,laneCondition:{type:"min_cards",count:parseInt(s.target.value)}}),children:[o.jsx("option",{value:0,children:"No minimum (any lane)"}),o.jsx("option",{value:4,children:"4 or more cards"}),o.jsx("option",{value:6,children:"6 or more cards"}),o.jsx("option",{value:8,children:"8 or more cards (Metal-3)"}),o.jsx("option",{value:10,children:"10 or more cards"})]})]}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:t.excludeCurrentLane!==!1,onChange:s=>n({...t,excludeCurrentLane:s.target.checked})}),"Exclude current lane (other lanes only)"]})]})};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const kj=({params:t,onChange:n})=>{var r;return o.jsxs("div",{className:"param-editor",children:[o.jsx("h4",{children:"Shuffle Trash Effect"}),o.jsx("p",{style:{color:"#8A79E8",fontSize:"14px",marginBottom:"15px"},children:"Shuffle your trash (discarded/deleted cards) back into your deck."}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:t.optional!==!1,onChange:i=>n({...t,optional:i.target.checked})}),'Optional ("You may shuffle...")']}),o.jsx("h5",{style:{marginTop:"15px"},children:"Conditional"}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:((r=t.advancedConditional)==null?void 0:r.type)==="trash_not_empty",onChange:i=>{if(i.target.checked)n({...t,advancedConditional:{type:"trash_not_empty"}});else{const{advancedConditional:s,...d}=t;n(d)}}}),'Only if trash is not empty ("If there are any cards in your trash...")']})]})},Tj=({params:t})=>o.jsxs("div",{className:"param-editor",children:[o.jsx("h4",{children:"Shuffle Deck Effect"}),o.jsx("p",{style:{color:"#8A79E8",fontSize:"14px",marginBottom:"15px"},children:"Shuffle your deck. Typically used after revealing the deck."})]});/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Nj=({params:t,onChange:n})=>o.jsxs("div",{className:"param-editor state-number-effect-editor",children:[o.jsx("h4",{children:"State Number Effect"}),o.jsxs("label",{children:["Number Source",o.jsx("select",{value:t.numberSource||"own_protocol_values",onChange:r=>n({...t,numberSource:r.target.value}),children:o.jsx("option",{value:"own_protocol_values",children:"Own Protocol Values (0-5)"})}),o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"Player chooses a number from the available protocol card values. The stated number is stored for subsequent effects."})]})]});/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Aj=({params:t,onChange:n})=>o.jsxs("div",{className:"param-editor state-protocol-effect-editor",children:[o.jsx("h4",{children:"State Protocol Effect"}),o.jsxs("label",{children:["Protocol Source",o.jsx("select",{value:t.protocolSource||"opponent_cards",onChange:r=>n({...t,protocolSource:r.target.value}),children:o.jsx("option",{value:"opponent_cards",children:"Opponent's Cards (unique protocols)"})}),o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:"Player chooses a protocol from the opponent's unique protocols. The stated protocol is stored for subsequent effects (e.g., matching conditionals)."})]})]}),wi=t=>{switch(t){case"draw":return{action:"draw",count:1,target:"self",source:"own_deck"};case"refresh":return{action:"refresh",target:"self"};case"mutual_draw":return{action:"mutual_draw",count:1};case"flip":return{action:"flip",count:1,targetFilter:{owner:"any",position:"any",faceState:"any",excludeSelf:!1},optional:!1};case"shift":return{action:"shift",targetFilter:{owner:"any",position:"any",faceState:"any"},destinationRestriction:{type:"any"}};case"delete":return{action:"delete",count:1,targetFilter:{position:"any",faceState:"any"},scope:{type:"anywhere"},excludeSelf:!1};case"discard":return{action:"discard",count:1,actor:"self"};case"return":return{action:"return",count:1,targetFilter:{},scope:{type:"any_card"}};case"play":return{action:"play",source:"hand",count:1,faceDown:!1,destinationRule:{type:"other_lines"}};case"rearrange_protocols":return{action:"rearrange_protocols",target:"own"};case"swap_protocols":return{action:"swap_protocols",target:"own"};case"reveal":case"give":return{action:t,source:"own_hand",count:1};case"take":return{action:"take",source:"opponent_hand",count:1,random:!0};case"choice":return{action:"choice",options:[]};case"passive_rule":return{action:"passive_rule",rule:{type:"block_all_play",target:"opponent",scope:"this_lane"}};case"value_modifier":return{action:"value_modifier",modifier:{type:"add_per_condition",value:1,condition:"per_face_down_card",target:"own_total",scope:"this_lane"}};case"block_compile":return{action:"block_compile",target:"opponent"};case"delete_all_in_lane":return{action:"delete_all_in_lane",laneCondition:{type:"min_cards",count:8},excludeCurrentLane:!0};case"shuffle_trash":return{action:"shuffle_trash",optional:!0};case"shuffle_deck":return{action:"shuffle_deck"};case"redirect_return_to_deck":return{action:"redirect_return_to_deck",faceDown:!0};case"state_number":return{action:"state_number",numberSource:"own_protocol_values"};case"state_protocol":return{action:"state_protocol",protocolSource:"opponent_cards"};case"swap_stacks":return{action:"swap_stacks",target:"own"};case"copy_opponent_middle":return{action:"copy_opponent_middle",optional:!0};case"auto_compile":return{action:"auto_compile",protocolCountConditional:{type:"unique_protocols_on_field",threshold:6}};case"card_property":return{action:"card_property",property:"ignore_protocol_matching"};default:return{}}},Rj=({effect:t,onChange:n,readOnly:r=!1})=>{const i=m=>{r||n({...t,params:m})},s=m=>{if(m){const x={id:st(),params:wi("draw"),position:t.position,trigger:t.trigger};n({...t,conditional:{type:"then",thenEffect:x}})}else{const{conditional:x,...S}=t;n(S)}},d=m=>{t.conditional&&n({...t,conditional:{...t.conditional,type:m}})},u=m=>{t.conditional&&n({...t,conditional:{...t.conditional,thenEffect:m}})},p=m=>{if(!t.conditional)return;const x=wi(m),S={...t.conditional.thenEffect,params:x};n({...t,conditional:{...t.conditional,thenEffect:S}})},f=m=>{if(t.conditional)if(m){const x={id:st(),params:wi("delete"),position:t.position,trigger:t.trigger};n({...t,conditional:{...t.conditional,thenEffect:{...t.conditional.thenEffect,conditional:{type:"then",thenEffect:x}}}})}else{const{conditional:x,...S}=t.conditional.thenEffect;n({...t,conditional:{...t.conditional,thenEffect:S}})}},h=m=>{var x;(x=t.conditional)!=null&&x.thenEffect.conditional&&n({...t,conditional:{...t.conditional,thenEffect:{...t.conditional.thenEffect,conditional:{...t.conditional.thenEffect.conditional,type:m}}}})},w=m=>{var x;(x=t.conditional)!=null&&x.thenEffect.conditional&&n({...t,conditional:{...t.conditional,thenEffect:{...t.conditional.thenEffect,conditional:{...t.conditional.thenEffect.conditional,thenEffect:m}}}})},g=m=>{var E;if(!((E=t.conditional)!=null&&E.thenEffect.conditional))return;const x=wi(m),S={...t.conditional.thenEffect.conditional.thenEffect,params:x};n({...t,conditional:{...t.conditional,thenEffect:{...t.conditional.thenEffect,conditional:{...t.conditional.thenEffect.conditional,thenEffect:S}}}})},y=(m,x)=>{var S,E,j,b;switch(m.params.action){case"draw":return o.jsx(fv,{params:m.params,onChange:x});case"refresh":return o.jsx(wj,{params:m.params,onChange:x});case"mutual_draw":return o.jsx(xj,{params:m.params,onChange:x});case"flip":return o.jsx(hv,{params:m.params,onChange:x});case"shift":return o.jsx(mv,{params:m.params,onChange:x});case"delete":return o.jsx(yv,{params:m.params,onChange:x});case"discard":return o.jsx(gv,{params:m.params,onChange:x});case"return":return o.jsx(vv,{params:m.params,onChange:x});case"play":return o.jsx(_v,{params:m.params,onChange:x});case"rearrange_protocols":case"swap_protocols":return o.jsx(wv,{params:m.params,onChange:x});case"reveal":case"give":return o.jsx(xv,{params:m.params,onChange:x});case"take":return o.jsx(Cv,{params:m.params,onChange:x});case"choice":return o.jsx(Cj,{params:m.params,onChange:x});case"passive_rule":return o.jsx(Sj,{params:m.params,onChange:x});case"value_modifier":return o.jsx(bj,{params:m.params,onChange:x});case"block_compile":return o.jsx(Ej,{params:m.params,onChange:x});case"auto_compile":return o.jsxs("div",{className:"param-editor auto-compile-effect-editor",children:[o.jsx("h4",{children:"Auto Compile Effect Parameters"}),o.jsxs("label",{children:["Conditional Type",o.jsxs("select",{value:((S=m.params.protocolCountConditional)==null?void 0:S.type)||"unique_protocols_on_field",onChange:k=>{var U;const N=k.target.value;x(N==="same_protocol_count_on_field"?{...m.params,protocolCountConditional:{type:"same_protocol_count_on_field",threshold:5,faceState:"face_up"}}:{...m.params,protocolCountConditional:{type:"unique_protocols_on_field",threshold:((U=m.params.protocolCountConditional)==null?void 0:U.threshold)||6}})},children:[o.jsx("option",{value:"unique_protocols_on_field",children:"Unique Protocols on Field (Diversity)"}),o.jsx("option",{value:"same_protocol_count_on_field",children:"Same Protocol Count on Field (Unity)"})]})]}),o.jsxs("label",{children:["Required Count",o.jsxs("select",{value:((E=m.params.protocolCountConditional)==null?void 0:E.threshold)||6,onChange:k=>x({...m.params,protocolCountConditional:{...m.params.protocolCountConditional,threshold:parseInt(k.target.value)}}),children:[o.jsx("option",{value:"2",children:"2"}),o.jsx("option",{value:"3",children:"3"}),o.jsx("option",{value:"4",children:"4"}),o.jsx("option",{value:"5",children:"5"}),o.jsx("option",{value:"6",children:"6"}),o.jsx("option",{value:"7",children:"7"}),o.jsx("option",{value:"8",children:"8"})]})]}),((j=m.params.protocolCountConditional)==null?void 0:j.type)==="same_protocol_count_on_field"&&o.jsxs(o.Fragment,{children:[o.jsxs("label",{style:{marginTop:"10px"},children:[o.jsx("input",{type:"checkbox",checked:m.params.deleteAllInLane||!1,onChange:k=>x({...m.params,deleteAllInLane:k.target.checked})}),"Also delete all cards in this lane (Unity-1)"]}),o.jsx("p",{className:"param-hint",style:{marginTop:"10px"},children:'"If there are X or more face-up [Protocol] cards in the field, compile this protocol."'})]}),((b=m.params.protocolCountConditional)==null?void 0:b.type)!=="same_protocol_count_on_field"&&o.jsx("p",{className:"param-hint",children:'"If there are X different protocols on cards in the field, compile this protocol."'})]});case"delete_all_in_lane":return o.jsx(jj,{params:m.params,onChange:x});case"shuffle_trash":return o.jsx(kj,{params:m.params,onChange:x});case"shuffle_deck":return o.jsx(Tj,{params:m.params,onChange:x});case"state_number":return o.jsx(Nj,{params:m.params,onChange:x});case"state_protocol":return o.jsx(Aj,{params:m.params,onChange:x});case"swap_stacks":return o.jsxs("div",{className:"param-editor swap-stacks-editor",children:[o.jsx("h4",{children:"Swap Stacks"}),o.jsx("p",{style:{color:"#8A79E8"},children:"Swap all of your cards in one of your stacks with another one of your stacks."})]});case"copy_opponent_middle":return o.jsxs("div",{className:"param-editor copy-opponent-middle-editor",children:[o.jsx("h4",{children:"Copy Opponent's Middle Command"}),o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:m.params.optional??!0,onChange:k=>x({...m.params,optional:k.target.checked})}),'Optional ("You may resolve..." instead of "Resolve...")']}),o.jsx("p",{style:{color:"#8A79E8",marginTop:"10px"},children:"Select one of your opponent's face-up uncovered cards and execute its middle commands as if they were on this card."})]});case"card_property":return o.jsxs("div",{className:"param-editor card-property-editor",children:[o.jsx("h4",{children:"Card Property"}),o.jsxs("label",{children:["Property",o.jsx("select",{value:m.params.property||"ignore_protocol_matching",onChange:k=>x({...m.params,property:k.target.value}),children:o.jsx("option",{value:"ignore_protocol_matching",children:"Ignore Protocol Matching (Chaos-3)"})})]}),o.jsx("p",{style:{color:"#8A79E8",marginTop:"10px"},children:"This card may be played face-up in any lane, regardless of protocol matching rules."})]});default:return o.jsxs("div",{children:["Unknown effect type: ",m.params.action]})}};return o.jsxs("div",{className:`effect-editor ${r?"read-only-mode":""}`,children:[o.jsx("div",{className:"trigger-info",style:{marginBottom:"15px",padding:"10px",backgroundColor:"#1A113B",borderRadius:"4px",border:"1px solid rgba(97, 239, 255, 0.3)"},children:o.jsxs("div",{style:{display:"flex",gap:"20px",alignItems:"center",flexWrap:"wrap"},children:[o.jsxs("label",{style:{flex:1,minWidth:"200px"},children:[o.jsx("strong",{children:"Trigger:"}),o.jsxs("select",{value:t.trigger,onChange:m=>!r&&n({...t,trigger:m.target.value}),disabled:r,style:{width:"100%",padding:"6px",marginTop:"4px",backgroundColor:"#2c1d63",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px"},children:[o.jsx("optgroup",{label:"Immediate",children:o.jsx("option",{value:"on_play",children:"On Play"})}),o.jsx("optgroup",{label:"Passive (Top Box)",children:o.jsx("option",{value:"passive",children:"Passive (always active)"})}),o.jsxs("optgroup",{label:"Phase Triggers (Bottom Box)",children:[o.jsx("option",{value:"start",children:"Start Phase"}),o.jsx("option",{value:"end",children:"End Phase"}),o.jsx("option",{value:"on_cover",children:"When Covered"})]}),o.jsxs("optgroup",{label:"Reactive (Top Box)",children:[o.jsx("option",{value:"on_flip",children:"When this card would be flipped"}),o.jsx("option",{value:"on_cover_or_flip",children:"When covered or flipped"}),o.jsx("option",{value:"after_delete",children:"After cards are deleted"}),o.jsx("option",{value:"after_discard",children:"After cards are discarded"}),o.jsx("option",{value:"after_draw",children:"After cards are drawn"}),o.jsx("option",{value:"after_shift",children:"After cards are shifted"}),o.jsx("option",{value:"after_flip",children:"After cards are flipped"}),o.jsx("option",{value:"after_play",children:"After a card is played"}),o.jsx("option",{value:"after_shuffle",children:"After deck is shuffled"}),o.jsx("option",{value:"after_clear_cache",children:"After cache is cleared"}),o.jsx("option",{value:"after_refresh",children:"After you refresh"}),o.jsx("option",{value:"after_opponent_refresh",children:"After opponent refreshes"}),o.jsx("option",{value:"after_compile",children:"After you compile"}),o.jsx("option",{value:"after_opponent_compile",children:"After opponent compiles"}),o.jsx("option",{value:"after_opponent_discard",children:"After opponent discards"}),o.jsx("option",{value:"after_opponent_draw",children:"After opponent draws"}),o.jsx("option",{value:"before_compile_delete",children:"Before deleted by compile"}),o.jsx("option",{value:"when_card_returned",children:"When card returned to hand"})]})]})]}),o.jsxs("div",{style:{color:"#8A79E8",fontSize:"13px"},children:[o.jsx("strong",{children:"Position:"})," ",t.position.charAt(0).toUpperCase()+t.position.slice(1)," Box"]})]})}),o.jsxs("div",{className:"main-effect",children:[o.jsx("h3",{children:"Main Effect"}),y(t,i),o.jsxs("div",{className:"effect-preview",children:[o.jsx("strong",{children:"Preview:"})," ",o.jsx("span",{dangerouslySetInnerHTML:{__html:pr([t])}})]})]}),o.jsxs("div",{style:{marginTop:"15px"},children:[o.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[o.jsx("input",{type:"checkbox",checked:!!t.useCardFromPreviousEffect,onChange:m=>n({...t,useCardFromPreviousEffect:m.target.checked})}),o.jsx("span",{children:`Use card from previous effect (for "shift THAT card", "draw equal to THAT card's value", etc.)`})]}),t.useCardFromPreviousEffect&&o.jsx("small",{style:{display:"block",marginLeft:"24px",marginTop:"4px",color:"#8A79E8"},children:"This effect will target/use the card selected by the previous effect in the chain."})]}),(t.trigger==="after_draw"||t.trigger==="after_delete"||t.trigger==="after_discard"||t.trigger==="after_shift"||t.trigger==="after_flip"||t.trigger==="after_shuffle"||t.trigger==="after_clear_cache"||t.trigger==="after_opponent_discard"||t.trigger==="after_play")&&o.jsxs("div",{style:{marginTop:"15px"},children:[o.jsxs("label",{children:["Trigger Actor (who triggers this effect?)",o.jsxs("select",{value:t.reactiveTriggerActor||"self",onChange:m=>n({...t,reactiveTriggerActor:m.target.value}),style:{width:"100%",padding:"8px",marginTop:"5px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px",cursor:"pointer"},children:[o.jsx("option",{value:"self",children:"Only when YOU perform the action (default)"}),o.jsx("option",{value:"opponent",children:"Only when OPPONENT performs the action"}),o.jsx("option",{value:"any",children:"When ANYONE performs the action"})]})]}),o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:t.reactiveTriggerActor==="self"||!t.reactiveTriggerActor?"Effect triggers only when YOU delete/draw/etc.":t.reactiveTriggerActor==="opponent"?"Effect triggers only when OPPONENT deletes/draws/etc.":"Effect triggers when ANYONE deletes/draws/etc."})]}),(t.trigger==="after_play"||t.trigger==="after_shift"||t.trigger==="after_flip"||t.trigger==="after_delete")&&o.jsxs("div",{style:{marginTop:"15px"},children:[o.jsxs("label",{children:["Reactive Scope",o.jsxs("select",{value:t.reactiveScope||"global",onChange:m=>n({...t,reactiveScope:m.target.value}),style:{width:"100%",padding:"8px",marginTop:"5px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px",cursor:"pointer"},children:[o.jsx("option",{value:"global",children:"Any lane (default)"}),o.jsx("option",{value:"this_lane",children:"This lane only"})]})]}),o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:t.reactiveScope==="this_lane"?"Effect only triggers when the action happens in the same lane as this card.":"Effect triggers when the action happens anywhere on the board."})]}),t.trigger==="on_cover"&&o.jsxs("div",{style:{marginTop:"15px"},children:[o.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",cursor:"pointer"},children:[o.jsx("input",{type:"checkbox",checked:t.onCoverProtocolRestriction==="same_protocol",onChange:m=>{if(m.target.checked)n({...t,onCoverProtocolRestriction:"same_protocol"});else{const{onCoverProtocolRestriction:x,...S}=t;n(S)}},style:{width:"18px",height:"18px",cursor:"pointer"}}),"Only trigger when covered by same protocol (Unity)"]}),o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:t.onCoverProtocolRestriction==="same_protocol"?"Effect only triggers when covered by another card of the same protocol.":"Effect triggers when covered by any card."})]}),(t.trigger==="after_draw"||t.trigger==="after_delete"||t.trigger==="after_discard"||t.trigger==="after_shift"||t.trigger==="after_flip"||t.trigger==="after_shuffle")&&o.jsxs("div",{style:{marginTop:"15px"},children:[o.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",cursor:"pointer"},children:[o.jsx("input",{type:"checkbox",checked:t.onlyDuringOpponentTurn||!1,onChange:m=>n({...t,onlyDuringOpponentTurn:m.target.checked}),style:{width:"18px",height:"18px",cursor:"pointer"}}),"Only During Opponent's Turn"]}),o.jsx("small",{style:{display:"block",marginTop:"4px",color:"#8A79E8"},children:t.onlyDuringOpponentTurn?"Effect only triggers during your opponent's turn.":"Effect triggers during any turn."})]}),o.jsxs("div",{className:"conditional-section",style:{marginTop:"20px",borderTop:"1px solid #2c1d63",paddingTop:"15px"},children:[o.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"10px"},children:[o.jsx("input",{type:"checkbox",checked:!!t.conditional,onChange:m=>s(m.target.checked)}),o.jsx("strong",{children:"Add follow-up effect"})]}),t.conditional&&o.jsxs("div",{className:"follow-up-effect",style:{marginLeft:"20px",padding:"10px",backgroundColor:"#2c1d63",borderRadius:"4px",border:"1px solid rgba(97, 239, 255, 0.2)"},children:[o.jsx("h4",{style:{marginTop:0},children:"Follow-Up Effect"}),o.jsxs("label",{children:["Connection Type",o.jsxs("select",{value:t.conditional.type||"then",onChange:m=>d(m.target.value),style:{width:"100%",padding:"8px",marginTop:"5px",marginBottom:"15px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px",cursor:"pointer"},children:[o.jsx("option",{value:"then",children:"Then (always executes)"}),o.jsx("option",{value:"if_executed",children:"If you do (only if first effect succeeds)"})]})]}),o.jsxs("label",{children:["Effect Type",o.jsxs("select",{value:t.conditional.thenEffect.params.action,onChange:m=>p(m.target.value),style:{width:"100%",padding:"8px",marginTop:"5px",backgroundColor:"#1A113B",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px",cursor:"pointer"},children:[o.jsx("option",{value:"draw",children:"Draw Cards"}),o.jsx("option",{value:"refresh",children:"Refresh Hand"}),o.jsx("option",{value:"mutual_draw",children:"Mutual Draw (Exchange)"}),o.jsx("option",{value:"flip",children:"Flip Cards"}),o.jsx("option",{value:"shift",children:"Shift Card"}),o.jsx("option",{value:"delete",children:"Delete Cards"}),o.jsx("option",{value:"delete_all_in_lane",children:"Delete All in Lane"}),o.jsx("option",{value:"discard",children:"Discard Cards"}),o.jsx("option",{value:"return",children:"Return to Hand"}),o.jsx("option",{value:"play",children:"Play from Hand/Deck"}),o.jsx("option",{value:"rearrange_protocols",children:"Rearrange Protocols"}),o.jsx("option",{value:"swap_protocols",children:"Swap Protocols"}),o.jsx("option",{value:"reveal",children:"Reveal Hand"}),o.jsx("option",{value:"give",children:"Give Cards"}),o.jsx("option",{value:"take",children:"Take from Hand"}),o.jsx("option",{value:"choice",children:"Either/Or Choice"}),o.jsx("option",{value:"block_compile",children:"Block Compile"}),o.jsx("option",{value:"auto_compile",children:"Auto Compile (Diversity)"}),o.jsx("option",{value:"shuffle_trash",children:"Shuffle Trash into Deck"}),o.jsx("option",{value:"shuffle_deck",children:"Shuffle Deck"}),o.jsx("option",{value:"state_number",children:"State a Number"}),o.jsx("option",{value:"state_protocol",children:"State a Protocol"}),o.jsx("option",{value:"swap_stacks",children:"Swap Stacks"}),o.jsx("option",{value:"copy_opponent_middle",children:"Copy Opponent's Middle"}),o.jsx("option",{value:"card_property",children:"Card Property (Chaos-3)"})]})]}),o.jsx("div",{style:{marginTop:"15px"},children:y(t.conditional.thenEffect,m=>u({...t.conditional.thenEffect,params:m}))}),o.jsxs("div",{className:"nested-conditional-section",style:{marginTop:"15px",borderTop:"1px solid rgba(97, 239, 255, 0.2)",paddingTop:"15px"},children:[o.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"10px"},children:[o.jsx("input",{type:"checkbox",checked:!!t.conditional.thenEffect.conditional,onChange:m=>f(m.target.checked)}),o.jsx("strong",{children:"Add 2nd follow-up effect"})]}),t.conditional.thenEffect.conditional&&o.jsxs("div",{className:"nested-follow-up-effect",style:{marginLeft:"10px",padding:"10px",backgroundColor:"#1A113B",borderRadius:"4px",border:"1px solid rgba(97, 239, 255, 0.2)"},children:[o.jsx("h5",{style:{marginTop:0,fontSize:"0.9rem"},children:"2nd Follow-Up Effect"}),o.jsxs("label",{children:["Connection Type",o.jsxs("select",{value:t.conditional.thenEffect.conditional.type||"then",onChange:m=>h(m.target.value),style:{width:"100%",padding:"6px",marginTop:"5px",marginBottom:"10px",backgroundColor:"#0D0825",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px",cursor:"pointer",fontSize:"0.9rem"},children:[o.jsx("option",{value:"then",children:"Then (always executes)"}),o.jsx("option",{value:"if_executed",children:"If you do (only if first effect succeeds)"})]})]}),o.jsxs("label",{children:["Effect Type",o.jsxs("select",{value:t.conditional.thenEffect.conditional.thenEffect.params.action,onChange:m=>g(m.target.value),style:{width:"100%",padding:"6px",marginTop:"5px",backgroundColor:"#0D0825",color:"#F0F0F0",border:"1px solid rgba(97, 239, 255, 0.3)",borderRadius:"4px",cursor:"pointer",fontSize:"0.9rem"},children:[o.jsx("option",{value:"draw",children:"Draw Cards"}),o.jsx("option",{value:"refresh",children:"Refresh Hand"}),o.jsx("option",{value:"mutual_draw",children:"Mutual Draw (Exchange)"}),o.jsx("option",{value:"flip",children:"Flip Cards"}),o.jsx("option",{value:"shift",children:"Shift Card"}),o.jsx("option",{value:"delete",children:"Delete Cards"}),o.jsx("option",{value:"delete_all_in_lane",children:"Delete All in Lane"}),o.jsx("option",{value:"discard",children:"Discard Cards"}),o.jsx("option",{value:"return",children:"Return to Hand"}),o.jsx("option",{value:"play",children:"Play from Hand/Deck"}),o.jsx("option",{value:"rearrange_protocols",children:"Rearrange Protocols"}),o.jsx("option",{value:"swap_protocols",children:"Swap Protocols"}),o.jsx("option",{value:"reveal",children:"Reveal Hand"}),o.jsx("option",{value:"give",children:"Give Cards"}),o.jsx("option",{value:"take",children:"Take from Hand"}),o.jsx("option",{value:"choice",children:"Either/Or Choice"}),o.jsx("option",{value:"block_compile",children:"Block Compile"}),o.jsx("option",{value:"auto_compile",children:"Auto Compile (Diversity)"}),o.jsx("option",{value:"shuffle_trash",children:"Shuffle Trash into Deck"}),o.jsx("option",{value:"shuffle_deck",children:"Shuffle Deck"}),o.jsx("option",{value:"state_number",children:"State a Number"}),o.jsx("option",{value:"state_protocol",children:"State a Protocol"}),o.jsx("option",{value:"swap_stacks",children:"Swap Stacks"}),o.jsx("option",{value:"copy_opponent_middle",children:"Copy Opponent's Middle"}),o.jsx("option",{value:"card_property",children:"Card Property (Chaos-3)"})]})]}),o.jsx("div",{style:{marginTop:"10px"},children:y(t.conditional.thenEffect.conditional.thenEffect,m=>w({...t.conditional.thenEffect.conditional.thenEffect,params:m}))})]})]})]})]})]})},Fj=({card:t,protocolName:n,protocolColor:r,protocolPattern:i,onChange:s,readOnly:d=!1})=>{const[u,p]=se.useState(null),[f,h]=se.useState(null),[w,g]=se.useState(!1);se.useEffect(()=>{p(null)},[t.value]);const y=(I,D,L)=>{const T={id:st(),params:Dj(D),position:I,trigger:L},q={...t};I==="top"?q.topEffects=[...q.topEffects,T]:I==="middle"?q.middleEffects=[...q.middleEffects,T]:q.bottomEffects=[...q.bottomEffects,T],s(q);const P=I==="top"?q.topEffects.length-1:I==="middle"?q.middleEffects.length-1:q.bottomEffects.length-1;p({box:I,effectIndex:P,effect:T})},m=(I,D)=>{h({box:I,effectIndex:D})},x=()=>{if(!f)return;const{box:I,effectIndex:D}=f,L={...t};I==="top"?L.topEffects.splice(D,1):I==="middle"?L.middleEffects.splice(D,1):L.bottomEffects.splice(D,1),s(L),u&&u.box===I&&u.effectIndex===D&&p(null),h(null)},S=I=>{if(!u)return;const{box:D,effectIndex:L}=u,T={...t};D==="top"?(T.topEffects=[...T.topEffects],T.topEffects[L]=I):D==="middle"?(T.middleEffects=[...T.middleEffects],T.middleEffects[L]=I):(T.bottomEffects=[...T.bottomEffects],T.bottomEffects[L]=I),s(T),p({box:D,effectIndex:L,effect:I})},E=(I,D)=>{const L=I==="top"?t.topEffects[D]:I==="middle"?t.middleEffects[D]:t.bottomEffects[D];p({box:I,effectIndex:D,effect:L})},j=(I,D)=>{const L=(D==null?void 0:D.reactiveTriggerActor)||"self",T=(D==null?void 0:D.reactiveScope)||"global";if(I==="after_play")return`After ${L==="opponent"?"your opponent plays":L==="any"?"a card is played":"you play"} a card${T==="this_lane"?" in this line":""}`;if(["after_delete","after_discard","after_draw","after_shift","after_flip"].includes(I)){const q={after_delete:"delete cards",after_discard:"discard cards",after_draw:"draw cards",after_shift:"shift cards",after_flip:"flip cards"},P=L==="opponent"?"your opponent":L==="any"?"anyone":"you",Z=T==="this_lane"?" in this line":"";return`After ${P} ${q[I]}${Z}`}switch(I){case"passive":return"";case"on_play":return"";case"start":return"Start";case"end":return"End";case"on_cover":return"On Cover";case"after_opponent_discard":return"After opponent discards";case"after_clear_cache":return"After you clear cache";case"before_compile_delete":return"Before deleted by compile";case"on_flip":return"When this card would be flipped";case"on_cover_or_flip":return"When covered or flipped";default:return I}},b=I=>{const D={...t,value:I};s(D)},k={protocolName:n},N=pr(t.topEffects,k),U=pr(t.middleEffects,k),V=pr(t.bottomEffects,k),R=JSON.stringify({top:t.topEffects.map(I=>({id:I.id,params:I.params})),middle:t.middleEffects.map(I=>({id:I.id,params:I.params})),bottom:t.bottomEffects.map(I=>({id:I.id,params:I.params}))}),O=`${n}-${t.value}-${R}`,X={id:O,protocol:n,value:t.value,top:N,middle:U,bottom:V,isFaceUp:!0,owner:"player",laneIndex:0,category:"Custom",keywords:{}},M=(I,D)=>{I=I.replace("#","");const L=parseInt(I.substring(0,2),16),T=parseInt(I.substring(2,4),16),q=parseInt(I.substring(4,6),16);return`rgba(${L}, ${T}, ${q}, ${D})`},$=`card-custom-preview pattern-${i}`,B={"--custom-color":r,"--custom-color-alpha-05":M(r,.05),"--custom-color-alpha-06":M(r,.06),"--custom-color-alpha-08":M(r,.08),"--custom-color-alpha-10":M(r,.1),"--custom-color-alpha-15":M(r,.15),"--custom-color-alpha-20":M(r,.2),"--custom-color-alpha-25":M(r,.25),borderColor:r};return o.jsxs("div",{className:"card-editor-container",children:[o.jsxs("div",{className:"card-editor-content",children:[o.jsxs("div",{className:"card-live-preview",children:[o.jsx("h4",{children:"Card Preview"}),o.jsxs("label",{className:"card-value-selector",children:["Card Value:",o.jsxs("select",{value:t.value,onChange:I=>b(Number(I.target.value)),children:[o.jsx("option",{value:-1,children:"-1"}),o.jsx("option",{value:0,children:"0"}),o.jsx("option",{value:1,children:"1"}),o.jsx("option",{value:2,children:"2"}),o.jsx("option",{value:3,children:"3"}),o.jsx("option",{value:4,children:"4"}),o.jsx("option",{value:5,children:"5"}),o.jsx("option",{value:6,children:"6"})]})]}),o.jsx("div",{className:"card-preview-wrapper",style:B,children:o.jsx(xt,{card:X,isFaceUp:!0,additionalClassName:$},O)})]}),o.jsx("div",{className:"card-effects-editor",children:o.jsxs("div",{className:"card-preview",style:{borderColor:r},children:[o.jsx("div",{className:"card-header",style:{backgroundColor:r},children:o.jsxs("h3",{children:[n,"-",t.value]})}),o.jsxs("div",{className:"card-box top-box",children:[o.jsx("h4",{children:"Top Box (Passive/Reactive)"}),o.jsx("p",{className:"box-description",children:"Passive effects or reactive triggers"}),o.jsxs("div",{className:"effects-list",children:[t.topEffects.map((I,D)=>o.jsxs("div",{className:"effect-item",children:[o.jsxs("span",{onClick:()=>E("top",D),className:d?"read-only-clickable":"",children:[I.trigger!=="passive"&&o.jsxs("strong",{children:[j(I.trigger,I),":"]})," ",tl(I)]}),!d&&o.jsx("button",{onClick:()=>m("top",D),children:""})]},I.id)),t.topEffects.length===0&&o.jsx("p",{className:"empty-box",children:"No effects"})]}),!d&&o.jsxs("div",{className:"add-effect-controls",children:[o.jsxs("select",{id:"top-trigger",defaultValue:"",children:[o.jsx("option",{value:"",children:"Choose Trigger"}),o.jsx("optgroup",{label:"Passive",children:o.jsx("option",{value:"passive",children:"Passive (always active)"})}),o.jsxs("optgroup",{label:"Phase Triggers",children:[o.jsx("option",{value:"start",children:"Start Phase"}),o.jsx("option",{value:"end",children:"End Phase"}),o.jsx("option",{value:"on_cover",children:"On Cover"})]}),o.jsxs("optgroup",{label:"Reactive Triggers",children:[o.jsx("option",{value:"after_delete",children:"After you delete cards"}),o.jsx("option",{value:"after_opponent_discard",children:"After opponent discards"}),o.jsx("option",{value:"after_draw",children:"After you draw cards"}),o.jsx("option",{value:"after_clear_cache",children:"After you clear cache"}),o.jsx("option",{value:"before_compile_delete",children:"Before deleted by compile"}),o.jsx("option",{value:"after_flip",children:"After cards are flipped"}),o.jsx("option",{value:"after_shift",children:"After cards are shifted"}),o.jsx("option",{value:"after_play",children:"After cards are played"}),o.jsx("option",{value:"on_flip",children:"When this card would be flipped"}),o.jsx("option",{value:"on_cover_or_flip",children:"When this card would be covered or flipped"})]})]}),o.jsxs("select",{id:"top-action",defaultValue:"",children:[o.jsx("option",{value:"",children:"Choose Action"}),o.jsx("option",{value:"draw",children:"Draw Cards"}),o.jsx("option",{value:"refresh",children:"Refresh Hand"}),o.jsx("option",{value:"mutual_draw",children:"Mutual Draw (Exchange)"}),o.jsx("option",{value:"flip",children:"Flip Cards"}),o.jsx("option",{value:"shift",children:"Shift Card"}),o.jsx("option",{value:"delete",children:"Delete Cards"}),o.jsx("option",{value:"discard",children:"Discard Cards"}),o.jsx("option",{value:"return",children:"Return to Hand"}),o.jsx("option",{value:"play",children:"Play from Hand/Deck"}),o.jsx("option",{value:"rearrange_protocols",children:"Rearrange Protocols"}),o.jsx("option",{value:"swap_protocols",children:"Swap Protocols"}),o.jsx("option",{value:"reveal",children:"Reveal Hand"}),o.jsx("option",{value:"give",children:"Give Cards"}),o.jsx("option",{value:"take",children:"Take from Hand"}),o.jsx("option",{value:"choice",children:"Either/Or Choice"}),o.jsx("option",{value:"passive_rule",children:"Passive Rule"}),o.jsx("option",{value:"value_modifier",children:"Value Modifier"}),o.jsx("option",{value:"block_compile",children:"Block Compile"}),o.jsx("option",{value:"delete_all_in_lane",children:"Delete All in Lane"})]}),o.jsx("button",{className:"btn btn-add-effect",onClick:()=>{const I=document.getElementById("top-trigger"),D=document.getElementById("top-action"),L=I.value,T=D.value;L&&T?(y("top",T,L),I.value="",D.value=""):g(!0)},children:"+"})]})]}),o.jsxs("div",{className:"card-box middle-box",children:[o.jsx("h4",{children:"Middle Box (On Play)"}),o.jsx("p",{className:"box-description",children:"When played or uncovered"}),o.jsxs("div",{className:"effects-list",children:[t.middleEffects.map((I,D)=>o.jsxs("div",{className:"effect-item",children:[o.jsx("span",{onClick:()=>E("middle",D),className:d?"read-only-clickable":"",children:tl(I)}),!d&&o.jsx("button",{onClick:()=>m("middle",D),children:""})]},I.id)),t.middleEffects.length===0&&o.jsx("p",{className:"empty-box",children:"No effects"})]}),!d&&o.jsxs("select",{onChange:I=>{I.target.value&&(y("middle",I.target.value,"on_play"),I.target.value="")},children:[o.jsx("option",{value:"",children:"+ Add Effect"}),o.jsx("option",{value:"draw",children:"Draw Cards"}),o.jsx("option",{value:"refresh",children:"Refresh Hand"}),o.jsx("option",{value:"flip",children:"Flip Cards"}),o.jsx("option",{value:"shift",children:"Shift Card"}),o.jsx("option",{value:"delete",children:"Delete Cards"}),o.jsx("option",{value:"discard",children:"Discard Cards"}),o.jsx("option",{value:"return",children:"Return to Hand"}),o.jsx("option",{value:"play",children:"Play from Hand/Deck"}),o.jsx("option",{value:"rearrange_protocols",children:"Rearrange Protocols"}),o.jsx("option",{value:"swap_protocols",children:"Swap Protocols"}),o.jsx("option",{value:"reveal",children:"Reveal Hand"}),o.jsx("option",{value:"give",children:"Give Cards"}),o.jsx("option",{value:"take",children:"Take from Hand"}),o.jsx("option",{value:"choice",children:"Either/Or Choice"}),o.jsx("option",{value:"passive_rule",children:"Passive Rule"}),o.jsx("option",{value:"value_modifier",children:"Value Modifier"}),o.jsx("option",{value:"block_compile",children:"Block Compile"}),o.jsx("option",{value:"delete_all_in_lane",children:"Delete All in Lane"})]})]}),o.jsxs("div",{className:"card-box bottom-box",children:[o.jsx("h4",{children:"Bottom Box (Triggered)"}),o.jsx("p",{className:"box-description",children:"Only when uncovered AND face-up"}),o.jsxs("div",{className:"effects-list",children:[t.bottomEffects.map((I,D)=>o.jsxs("div",{className:"effect-item",children:[o.jsxs("span",{onClick:()=>E("bottom",D),className:d?"read-only-clickable":"",children:[o.jsxs("strong",{children:[j(I.trigger,I),":"]})," ",tl(I)]}),!d&&o.jsx("button",{onClick:()=>m("bottom",D),children:""})]},I.id)),t.bottomEffects.length===0&&o.jsx("p",{className:"empty-box",children:"No effects"})]}),!d&&o.jsxs("div",{className:"bottom-effect-add",children:[o.jsxs("select",{id:"bottom-trigger",children:[o.jsx("option",{value:"",children:"1. Choose Trigger"}),o.jsx("option",{value:"start",children:"Start Phase"}),o.jsx("option",{value:"end",children:"End Phase"}),o.jsx("option",{value:"on_cover",children:"On Cover"})]}),o.jsxs("select",{id:"bottom-action",children:[o.jsx("option",{value:"",children:"2. Choose Effect"}),o.jsx("option",{value:"draw",children:"Draw Cards"}),o.jsx("option",{value:"refresh",children:"Refresh Hand"}),o.jsx("option",{value:"mutual_draw",children:"Mutual Draw (Exchange)"}),o.jsx("option",{value:"flip",children:"Flip Cards"}),o.jsx("option",{value:"shift",children:"Shift Card"}),o.jsx("option",{value:"delete",children:"Delete Cards"}),o.jsx("option",{value:"discard",children:"Discard Cards"}),o.jsx("option",{value:"return",children:"Return to Hand"}),o.jsx("option",{value:"play",children:"Play from Hand/Deck"}),o.jsx("option",{value:"rearrange_protocols",children:"Rearrange Protocols"}),o.jsx("option",{value:"swap_protocols",children:"Swap Protocols"}),o.jsx("option",{value:"reveal",children:"Reveal Hand"}),o.jsx("option",{value:"give",children:"Give Cards"}),o.jsx("option",{value:"take",children:"Take from Hand"}),o.jsx("option",{value:"choice",children:"Either/Or Choice"}),o.jsx("option",{value:"passive_rule",children:"Passive Rule"}),o.jsx("option",{value:"value_modifier",children:"Value Modifier"}),o.jsx("option",{value:"block_compile",children:"Block Compile"}),o.jsx("option",{value:"delete_all_in_lane",children:"Delete All in Lane"})]}),o.jsx("button",{className:"btn btn-add-effect",onClick:()=>{const I=document.getElementById("bottom-trigger"),D=document.getElementById("bottom-action"),L=I.value,T=D.value;L&&T?(y("bottom",T,L),I.value="",D.value=""):g(!0)},children:"+"})]})]})]})})]}),u&&o.jsxs("div",{className:"effect-parameter-editor",children:[o.jsx("h3",{children:d?"View Effect":"Configure Effect"}),d&&o.jsx("div",{className:"read-only-notice",children:"This effect is read-only"}),o.jsx(Rj,{effect:u.effect,onChange:S,readOnly:d}),o.jsx("button",{onClick:()=>p(null),className:"btn",children:d?"Close":"Done"})]}),f&&o.jsx("div",{className:"custom-protocol-modal-overlay",onClick:()=>h(null),children:o.jsxs("div",{className:"custom-protocol-modal-content",onClick:I=>I.stopPropagation(),children:[o.jsx("h3",{children:"Delete Effect"}),o.jsx("p",{children:"Are you sure you want to delete this effect?"}),o.jsxs("div",{className:"custom-protocol-modal-actions",children:[o.jsx("button",{onClick:()=>h(null),className:"btn btn-back",children:"Cancel"}),o.jsx("button",{onClick:x,className:"btn btn-delete",children:"Delete"})]})]})}),w&&o.jsx("div",{className:"custom-protocol-modal-overlay",onClick:()=>g(!1),children:o.jsxs("div",{className:"custom-protocol-modal-content",onClick:I=>I.stopPropagation(),children:[o.jsx("h3",{children:"Missing Selection"}),o.jsx("p",{children:"Please select both a trigger and an effect before adding."}),o.jsx("div",{className:"custom-protocol-modal-actions",children:o.jsx("button",{onClick:()=>g(!1),className:"btn",children:"OK"})})]})})]})},Dj=t=>{switch(t){case"draw":return{action:"draw",count:1,target:"self",source:"own_deck"};case"flip":return{action:"flip",count:1,targetFilter:{owner:"any",position:"any",faceState:"any",excludeSelf:!1},optional:!1};case"shift":return{action:"shift",targetFilter:{owner:"any",position:"uncovered",faceState:"any",excludeSelf:!1}};case"delete":return{action:"delete",count:1,targetFilter:{position:"uncovered",faceState:"any"},excludeSelf:!0};case"discard":return{action:"discard",count:1,actor:"self"};case"return":return{action:"return",count:1,targetFilter:{},scope:{type:"any_card"}};case"play":return{action:"play",source:"hand",count:1,faceDown:!0,destinationRule:{type:"other_lines"}};case"rearrange_protocols":return{action:"rearrange_protocols",target:"own"};case"swap_protocols":return{action:"swap_protocols",target:"own"};case"reveal":case"give":return{action:t,source:"own_hand",count:1};case"take":return{action:"take",source:"opponent_hand",count:1,random:!0};case"choice":return{action:"choice",options:[]};case"passive_rule":return{action:"passive_rule",rule:{type:"block_all_play",target:"opponent",scope:"this_lane"}};case"value_modifier":return{action:"value_modifier",modifier:{type:"add_per_condition",value:1,condition:"per_face_down_card",target:"own_total",scope:"this_lane"}};default:return{}}},$j=(t,n)=>{const r=(s,d)=>{s=s.replace("#","");const u=parseInt(s.substring(0,2),16),p=parseInt(s.substring(2,4),16),f=parseInt(s.substring(4,6),16);return`rgba(${u}, ${p}, ${f}, ${d})`},i={borderColor:n};switch(t){case"solid":return{...i,backgroundColor:n};case"radial":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`radial-gradient(circle at 50% 50%, ${r(n,.25)} 0%, transparent 60%)`};case"dual-radial":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 0% 0%, ${r(n,.2)}, transparent 50%),
                    radial-gradient(at 100% 100%, ${r(n,.2)}, transparent 50%)
                `};case"multi-radial":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 0%, ${r(n,.2)}, transparent 70%),
                    radial-gradient(circle at 20% 30%, ${r(n,.15)}, transparent 40%),
                    radial-gradient(circle at 80% 70%, ${r(n,.2)}, transparent 50%)
                `};case"chaos":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 10% 10%, hsla(60, 100%, 50%, 0.15), transparent 30%),
                    radial-gradient(at 90% 20%, hsla(180, 100%, 50%, 0.15), transparent 35%),
                    radial-gradient(at 30% 80%, hsla(300, 100%, 50%, 0.15), transparent 40%),
                    radial-gradient(at 70% 60%, hsla(0, 100%, 50%, 0.1), transparent 25%)
                `};case"grid":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(circle at 50% 50%, ${r(n,.2)} 0%, transparent 40%),
                    linear-gradient(hsla(0,0%,100%,0.03) 1px, transparent 1px),
                    linear-gradient(90deg, hsla(0,0%,100%,0.03) 1px, transparent 1px)
                `,backgroundSize:"100% 100%, 20px 20px, 20px 20px"};case"diagonal-lines":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 0% 100%, ${r(n,.25)}, transparent 70%),
                    repeating-linear-gradient(120deg, transparent, transparent 15px, ${r(n,.05)} 15px, ${r(n,.05)} 30px)
                `};case"cross-diagonal":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 50%, ${r(n,.25)} 0%, transparent 50%),
                    repeating-linear-gradient(45deg, transparent, transparent 8px, ${r(n,.08)} 8px, ${r(n,.08)} 16px),
                    repeating-linear-gradient(-45deg, transparent, transparent 8px, ${r(n,.06)} 8px, ${r(n,.06)} 16px)
                `};case"horizontal-lines":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 80% 80%, ${r(n,.1)}, transparent 50%),
                    repeating-linear-gradient(0deg, hsla(0,0%,100%,0.02), hsla(0,0%,100%,0.02) 1px, transparent 1px, transparent 3px)
                `};case"vertical-lines":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 10% 10%, ${r(n,.2)}, transparent 50%),
                    repeating-linear-gradient(175deg, transparent, transparent 1px, ${r(n,.05)} 1px, ${r(n,.05)} 2px)
                `};case"cross":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    linear-gradient(0deg, transparent 40%, ${r(n,.1)} 50%, transparent 60%),
                    linear-gradient(90deg, transparent 48%, ${r(n,.2)} 50%, transparent 52%)
                `};case"hexagons":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 0%, ${r(n,.2)}, transparent 70%),
                    url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='28' height='49' viewBox='0 0 28 49'%3E%3Cg fill-rule='evenodd'%3E%3Cg id='hexagons' fill='%23ffffff' fill-opacity='0.05' fill-rule='nonzero'%3E%3Cpath d='M13.99 9.25l13 7.5v15l-13 7.5L1 31.75v-15l12.99-7.5zM3 17.9v12.7l10.99 6.34 11-6.35V17.9l-11-6.34L3 17.9zM0 15l12.99-7.5L26 15v18.5l-13 7.5L0 33.5V15z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")
                `};case"stripes":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(at 50% 100%, ${r(n,.25)}, transparent 60%),
                    linear-gradient(135deg, hsla(0,0%,0%,0.1) 23%, transparent 23%, transparent 25%, hsla(0,0%,0%,0.1) 25%, hsla(0,0%,0%,0.1) 27%, transparent 27%, transparent 73%, hsla(0,0%,0%,0.1) 73%, hsla(0,0%,0%,0.1) 75%, transparent 75%, transparent 77%, hsla(0,0%,0%,0.1) 77%)
                `};case"frost":return{...i,backgroundColor:"var(--surface-color)",backgroundImage:`
                    radial-gradient(circle at 50% 50%, ${r(n,.2)} 0%, transparent 50%),
                    repeating-linear-gradient(30deg, transparent, transparent 10px, ${r(n,.08)} 10px, ${r(n,.08)} 11px),
                    repeating-linear-gradient(-30deg, transparent, transparent 10px, ${r(n,.08)} 10px, ${r(n,.08)} 11px),
                    repeating-linear-gradient(90deg, transparent, transparent 8px, ${r(n,.05)} 8px, ${r(n,.05)} 9px)
                `};default:return i}},qj=[{name:"Anarchy",hex:"#EA5A3C"},{name:"Apathy",hex:"#989A9A"},{name:"Chaos",hex:"#E53FE5"},{name:"Darkness",hex:"#A772D4"},{name:"Death",hex:"#E25656"},{name:"Fire",hex:"#F06838"},{name:"Gravity",hex:"#7599EB"},{name:"Hate",hex:"#E03E5E"},{name:"Life",hex:"#3CE076"},{name:"Light",hex:"#FFEB7F"},{name:"Love",hex:"#F074D9"},{name:"Metal",hex:"#B3B8BD"},{name:"Plague",hex:"#A2CD3A"},{name:"Psychic",hex:"#C971EB"},{name:"Speed",hex:"#33DDDD"},{name:"Spirit",hex:"#42D4A8"},{name:"Water",hex:"#3FA4EB"}],Ij=[{name:"Solid",value:"solid",description:"Solid color background"},{name:"Radial Glow",value:"radial",description:"Single radial gradient glow"},{name:"Dual Radial",value:"dual-radial",description:"Two radial gradient spots"},{name:"Multi Radial",value:"multi-radial",description:"Multiple radial gradient spots"},{name:"Chaos",value:"chaos",description:"Colorful chaotic spots"},{name:"Grid",value:"grid",description:"Grid line pattern"},{name:"Diagonal Lines",value:"diagonal-lines",description:"Repeating diagonal lines"},{name:"Cross Diagonal",value:"cross-diagonal",description:"Crossed diagonal lines"},{name:"Horizontal Lines",value:"horizontal-lines",description:"Fine horizontal lines"},{name:"Vertical Lines",value:"vertical-lines",description:"Fine vertical lines"},{name:"Cross Pattern",value:"cross",description:"Cross/plus pattern"},{name:"Hexagons",value:"hexagons",description:"Hexagon pattern"},{name:"Stripes",value:"stripes",description:"Diagonal stripe pattern"},{name:"Frost",value:"frost",description:"Icy crystalline pattern with crossing lines"}],Lj=({onSave:t,onCancel:n,onDelete:r,initialProtocol:i})=>{const[s,d]=se.useState("name"),[u,p]=se.useState(0),[f,h]=se.useState(!1),[w,g]=se.useState(""),[y,m]=se.useState(!1),x=i?al(i):!1;console.log("ProtocolWizard render - initialProtocol:",i,"isReadOnly:",x);const[S,E]=se.useState((i==null?void 0:i.name)||""),[j,b]=se.useState((i==null?void 0:i.description)||""),[k,N]=se.useState((i==null?void 0:i.color)||"#1976D2"),[U,V]=se.useState((i==null?void 0:i.pattern)||"solid"),[R,O]=se.useState((i==null?void 0:i.cards)||[{value:0,topEffects:[],middleEffects:[],bottomEffects:[]},{value:1,topEffects:[],middleEffects:[],bottomEffects:[]},{value:2,topEffects:[],middleEffects:[],bottomEffects:[]},{value:3,topEffects:[],middleEffects:[],bottomEffects:[]},{value:4,topEffects:[],middleEffects:[],bottomEffects:[]},{value:5,topEffects:[],middleEffects:[],bottomEffects:[]}]);console.log("ProtocolWizard state - name:",S,"color:",k,"pattern:",U);const X=()=>{if(s==="name"){if(!S.trim()){alert("Please enter a protocol name.");return}d("color")}else s==="color"?d("pattern"):s==="pattern"&&d("cards")},M=q=>{const P=[...R];P[u]=q,O(P)},$=()=>{const q={id:(i==null?void 0:i.id)||st(),name:S,description:j,author:"Player",createdAt:(i==null?void 0:i.createdAt)||new Date().toISOString(),color:k,pattern:U,cards:R};t(q)},B=()=>{i&&r&&r(i.id),m(!1)},I=()=>{const q={id:(i==null?void 0:i.id)||st(),name:S,description:j,author:"Player",createdAt:(i==null?void 0:i.createdAt)||new Date().toISOString(),color:k,pattern:U,cards:R},P=JSON.stringify(q,null,2);g(P),h(!0)},D=()=>{navigator.clipboard.writeText(w).then(()=>{alert("Protocol JSON copied to clipboard!"),h(!1)}).catch(()=>{alert("Failed to copy to clipboard. Please try again.")})},L=q=>!(!S.trim()&&q!=="name"),T=q=>{if(!L(q)){alert("Please enter a protocol name first.");return}d(q)};return o.jsxs("div",{className:"protocol-wizard",children:[o.jsxs("div",{className:"wizard-header",children:[o.jsxs("h2",{children:[x?`View Protocol: ${S}`:i?`Edit Protocol: ${S}`:"Create New Protocol",x&&o.jsx("span",{className:"read-only-badge",children:"Read-Only"})]}),o.jsxs("div",{className:"wizard-progress",children:[o.jsx("button",{className:`step ${s==="name"?"active":"done"}`,onClick:()=>T("name"),type:"button",children:"1. Name"}),o.jsx("button",{className:`step ${s==="color"?"active":s==="pattern"||s==="cards"?"done":""}`,onClick:()=>T("color"),disabled:!L("color"),type:"button",children:"2. Color"}),o.jsx("button",{className:`step ${s==="pattern"?"active":s==="cards"?"done":""}`,onClick:()=>T("pattern"),disabled:!L("pattern"),type:"button",children:"3. Pattern"}),o.jsx("button",{className:`step ${s==="cards"?"active":""}`,onClick:()=>T("cards"),disabled:!L("cards"),type:"button",children:"4. Cards"})]})]}),o.jsxs("div",{className:"wizard-content",children:[s==="name"&&o.jsxs("div",{className:"wizard-step name-step",children:[o.jsx("h3",{children:"Step 1: Name and Description"}),o.jsxs("label",{children:["Protocol Name *",o.jsx("input",{type:"text",value:S,onChange:q=>!x&&E(q.target.value),placeholder:"e.g. Lightning, Shadow, Void",autoFocus:!0,readOnly:x,className:x?"read-only":""})]}),o.jsxs("label",{children:["Description",o.jsx("textarea",{value:j,onChange:q=>!x&&b(q.target.value),placeholder:"Describe the strategy and theme of your protocol",rows:4,readOnly:x,className:x?"read-only":""})]})]}),s==="color"&&o.jsxs("div",{className:"wizard-step color-step",children:[o.jsx("h3",{children:"Step 2: Choose Color"}),o.jsx("div",{className:"color-preview",style:{backgroundColor:k},children:o.jsx("span",{children:S||"Your Protocol"})}),o.jsx("h4",{children:"Predefined Colors"}),o.jsx("div",{className:`color-grid ${x?"read-only":""}`,children:qj.map(q=>o.jsx("button",{className:`color-option ${k===q.hex?"selected":""}`,style:{backgroundColor:q.hex},onClick:()=>!x&&N(q.hex),title:q.name,disabled:x,children:k===q.hex&&""},q.hex))}),o.jsx("h4",{children:"Custom Color"}),o.jsxs("div",{className:"custom-color",children:[o.jsx("input",{type:"color",value:k,onChange:q=>!x&&N(q.target.value),disabled:x}),o.jsx("input",{type:"text",value:k,onChange:q=>!x&&N(q.target.value),placeholder:"#1976D2",readOnly:x,className:x?"read-only":""})]})]}),s==="pattern"&&o.jsxs("div",{className:"wizard-step pattern-step",children:[o.jsx("h3",{children:"Step 3: Choose Card Pattern"}),o.jsx("div",{className:`pattern-selection-grid ${x?"read-only":""}`,children:Ij.map(q=>{const P=$j(q.value,k);return o.jsxs("div",{className:`pattern-option ${U===q.value?"selected":""}`,onClick:()=>!x&&V(q.value),children:[o.jsxs("div",{className:"pattern-preview",style:P,children:[S||"Protocol","-0"]}),o.jsx("h4",{children:q.name}),o.jsx("p",{children:q.description}),U===q.value&&o.jsx("div",{className:"selected-badge",children:" Selected"})]},q.value)})})]}),s==="cards"&&o.jsxs("div",{className:"wizard-step cards-step",children:[o.jsx("h3",{children:"Step 4: Configure Cards"}),o.jsx("div",{className:"card-navigation",children:R.map((q,P)=>o.jsxs("button",{className:`card-nav-btn ${u===P?"active":""}`,onClick:()=>p(P),type:"button",children:["Card ",q.value]},P))}),o.jsx(Fj,{card:R[u],protocolName:S,protocolColor:k,protocolPattern:U,onChange:M,readOnly:x})]})]}),o.jsxs("div",{className:"wizard-actions",children:[o.jsxs("div",{className:"wizard-actions-left",children:[o.jsx("button",{onClick:n,className:"btn btn-back",children:x?"Back":"Cancel"}),i&&r&&!x&&o.jsx("button",{onClick:()=>m(!0),className:"btn btn-delete",children:"Delete Protocol"})]}),o.jsxs("div",{className:"wizard-actions-right",children:[i&&o.jsxs(o.Fragment,{children:[o.jsx("button",{onClick:I,className:"btn btn-export",children:"Export JSON"}),!x&&o.jsx("button",{onClick:$,className:"btn",children:"Save"})]}),!i&&o.jsxs(o.Fragment,{children:[s!=="cards"&&o.jsx("button",{onClick:X,className:"btn",children:"Next"}),s==="cards"&&o.jsxs(o.Fragment,{children:[o.jsx("button",{onClick:I,className:"btn btn-export",children:"Export JSON"}),o.jsx("button",{onClick:$,className:"btn",children:"Save"})]})]})]})]}),f&&o.jsx("div",{className:"custom-protocol-modal-overlay",onClick:()=>h(!1),children:o.jsxs("div",{className:"custom-protocol-modal-content custom-protocol-modal-large",onClick:q=>q.stopPropagation(),children:[o.jsx("h3",{children:"Export Protocol JSON"}),o.jsx("p",{children:"Copy the JSON below to share or backup your protocol:"}),o.jsx("textarea",{value:w,readOnly:!0,rows:15,className:"export-textarea",onClick:q=>q.target.select()}),o.jsxs("div",{className:"custom-protocol-modal-actions",children:[o.jsx("button",{onClick:()=>h(!1),className:"btn btn-back",children:"Close"}),o.jsx("button",{onClick:D,className:"btn",children:"Copy to Clipboard"})]})]})}),y&&o.jsx("div",{className:"custom-protocol-modal-overlay",onClick:()=>m(!1),children:o.jsxs("div",{className:"custom-protocol-modal-content",onClick:q=>q.stopPropagation(),children:[o.jsx("h3",{children:"Delete Protocol"}),o.jsxs("p",{children:['Are you sure you want to delete "',S,'"?']}),o.jsx("p",{style:{color:"var(--danger-color)",fontSize:"0.9rem"},children:"This action cannot be undone."}),o.jsxs("div",{className:"custom-protocol-modal-actions",children:[o.jsx("button",{onClick:()=>m(!1),className:"btn btn-back",children:"Cancel"}),o.jsx("button",{onClick:B,className:"btn btn-delete",children:"Delete"})]})]})})]})},Pj=({onBack:t})=>{const[n,r]=se.useState("list"),[i,s]=se.useState([]),[d,u]=se.useState(void 0);se.useEffect(()=>{p()},[]);const p=()=>{const x=yr();s(x)},f=()=>{u(void 0),r("create")},h=x=>{console.log("handleEdit called with protocol:",x),u(x),r("edit"),console.log("View set to edit, editingProtocol:",x)},w=x=>{O0(x),Jl(),p(),r("list"),u(void 0)},g=x=>{yt(x),Jl(),p(),r("list"),u(void 0)},y=x=>{yt(x),Jl(),p()},m=()=>{r("list"),u(void 0)};return o.jsxs("div",{className:"custom-protocol-creator",children:[n==="list"&&o.jsx(V0,{protocols:i,onCreateNew:f,onEdit:h,onDelete:w,onImport:y,onBack:t}),(n==="create"||n==="edit")&&o.jsx(Lj,{onSave:g,onCancel:m,onDelete:w,initialProtocol:d})]})},Uj={id:"spirit-1-example",protocol:"Spirit",value:1,top:"When you play cards face-up, they may be played without matching protocols.",middle:"Draw 2 cards.",bottom:'<span class="emphasis">Start:</span> Either discard 1 card or flip this card.',isFaceUp:!0,category:"Main 1",keywords:{}},Oj={id:"face-down-example",protocol:"Spirit",value:1,top:"",middle:"",bottom:"",isFaceUp:!1,category:"Main 1",keywords:{}},Mj=[{id:"opp-light-4",protocol:"Light",value:4,top:"",middle:"Your opponent reveals their hand.",bottom:"",isFaceUp:!0,category:"Main 1",keywords:{reveal:!0}}],Hj=[{id:"opp-spirit-3",protocol:"Spirit",value:3,top:"<div><span class='emphasis'>After you draw cards:</span> You may shift this card, even if this card is covered.</div>",middle:"",bottom:"",isFaceUp:!0,category:"Main 1",keywords:{shift:!0}},{id:"opp-spirit-2",protocol:"Spirit",value:2,top:"",middle:"You may flip 1 card.",bottom:"",isFaceUp:!0,category:"Main 1",keywords:{flip:!0}}],Vj=[{id:"opp-water-3",protocol:"Water",value:3,top:"",middle:"Return all cards with a value of 2 in 1 line.",bottom:"",isFaceUp:!0,category:"Main 1",keywords:{return:!0}}],zj=[{id:"player-darkness-5",protocol:"Darkness",value:5,top:"",middle:"You discard 1 card.",bottom:"",isFaceUp:!0,category:"Main 1",keywords:{discard:!0}},{id:"player-facedown-0",protocol:"Darkness",value:2,top:"",middle:"",bottom:"",isFaceUp:!1,category:"Main 1",keywords:{}}],Bj=[{id:"player-plague-1",protocol:"Plague",value:1,top:"<div><span class='emphasis'>After your opponent discards cards:</span> Draw 1 card.</div>",middle:"Your opponent discards 1 card.",bottom:"",isFaceUp:!0,category:"Main 1",keywords:{draw:!0,discard:!0}},{id:"player-plague-5",protocol:"Plague",value:5,top:"",middle:"You discard 1 card.",bottom:"",isFaceUp:!0,category:"Main 1",keywords:{discard:!0}},{id:"player-plague-4",protocol:"Plague",value:4,top:"",middle:"",bottom:"<div><span class='emphasis'>End:</span> Your opponent deletes 1 of their face-down cards. You may flip this card.</div>",isFaceUp:!0,category:"Main 1",keywords:{delete:!0,flip:!0}}],Gj=[{id:"player-death-0",protocol:"Death",value:0,top:"",middle:"Delete 1 card from each other line.",bottom:"",isFaceUp:!0,category:"Main 1",keywords:{delete:!0}},{id:"player-facedown-3",protocol:"Death",value:2,top:"",middle:"",bottom:"",isFaceUp:!1,category:"Main 1",keywords:{}}],Po={opponent:["Light","Spirit","Water"],player:["Darkness","Plague","Death"],opponentCompiled:[!0,!1,!1],playerCompiled:[!1,!1,!1],opponentValues:[4,5,3],playerValues:[7,10,2]};function Yj({onBack:t}){const n=[Mj,Hj,Vj],r=[zj,Bj,Gj];return o.jsxs("div",{className:"screen rules-screen",children:[o.jsx(Ai,{title:"GAME RULES",onBack:t}),o.jsxs("div",{className:"rules-content",children:[o.jsxs("section",{className:"rules-section",children:[o.jsx("h2",{className:"section-title",children:"Objective"}),o.jsxs("div",{className:"rules-text",children:[o.jsxs("p",{children:["You play as an artificial intelligence trying to ",o.jsx("span",{className:"emphasis",children:"compile your 3 protocols"}),". Play command cards on protocols and execute their effects. If you reach a total value of",o.jsx("span",{className:"emphasis",children:" at least 10"})," with your cards on a protocol and exceed the opponent's total value in the same line, you may compile that protocol."]}),o.jsx("p",{className:"rules-highlight",children:"The first player to compile all 3 protocols wins!"})]})]}),o.jsxs("section",{className:"rules-section field-overview-section",children:[o.jsx("h2",{className:"section-title",children:"The Field"}),o.jsx("div",{className:"field-intro",children:o.jsxs("p",{children:["The field consists of ",o.jsx("span",{className:"emphasis",children:"3 lines"}),", each passing through two opposing protocols. Both players place cards on their side of each line. The goal is to build up value in your stacks to reach the compile threshold."]})}),o.jsxs("div",{className:"demo-board-container",children:[o.jsxs("div",{className:"demo-board",children:[o.jsx("div",{className:"demo-side-label opponent-label",children:"Opponent"}),o.jsx("div",{className:"demo-player-side demo-opponent-side",children:o.jsx("div",{className:"demo-lanes",children:n.map((i,s)=>o.jsx("div",{className:`demo-lane ${Po.opponentCompiled[s]?"demo-lane-compiled":""}`,children:o.jsx("div",{className:"demo-lane-stack",children:i.map((d,u)=>o.jsx(xt,{card:d,isFaceUp:d.isFaceUp,style:{"--i":u},faceDownValue:2},d.id))})},`opp-lane-${s}`))})}),o.jsxs("div",{className:"demo-protocol-bars-container",children:[o.jsx("div",{className:"demo-protocol-bar demo-opponent-bar",children:Po.opponent.map((i,s)=>o.jsxs("div",{className:`demo-protocol-display ${Po.opponentCompiled[s]?"compiled":""}`,children:[o.jsx("span",{className:"demo-protocol-name",children:i}),o.jsx("span",{className:"demo-protocol-value",children:Po.opponentValues[s]})]},`opp-proto-${s}`))}),o.jsx("div",{className:"demo-protocol-bar demo-player-bar",children:Po.player.map((i,s)=>o.jsxs("div",{className:`demo-protocol-display ${Po.playerCompiled[s]?"compiled":""}`,children:[o.jsx("span",{className:"demo-protocol-name",children:i}),o.jsx("span",{className:"demo-protocol-value",children:Po.playerValues[s]})]},`player-proto-${s}`))})]}),o.jsx("div",{className:"demo-player-side",children:o.jsx("div",{className:"demo-lanes",children:r.map((i,s)=>o.jsx("div",{className:`demo-lane ${Po.playerCompiled[s]?"demo-lane-compiled":""} ${s===1?"demo-lane-compilable":""}`,children:o.jsx("div",{className:"demo-lane-stack",children:i.map((d,u)=>o.jsx(xt,{card:d,isFaceUp:d.isFaceUp,style:{"--i":u},faceDownValue:2},d.id))})},`player-lane-${s}`))})}),o.jsx("div",{className:"demo-side-label player-label",children:"You"})]}),o.jsxs("div",{className:"demo-board-annotations",children:[o.jsxs("div",{className:"demo-annotation compiled-annotation",children:[o.jsx("div",{className:"demo-annotation-marker compiled-marker",children:"1"}),o.jsxs("div",{className:"demo-annotation-content",children:[o.jsx("strong",{children:"Compiled Protocol"}),o.jsx("p",{children:"Light has been compiled by the opponent! The protocol bar glows cyan."})]})]}),o.jsxs("div",{className:"demo-annotation compilable-annotation",children:[o.jsx("div",{className:"demo-annotation-marker compilable-marker",children:"2"}),o.jsxs("div",{className:"demo-annotation-content",children:[o.jsx("strong",{children:"Ready to Compile!"}),o.jsx("p",{children:"Plague has value 10 (1+5+4) which is 10 and higher than opponent's Spirit at 5. This protocol can be compiled!"})]})]}),o.jsxs("div",{className:"demo-annotation inprogress-annotation",children:[o.jsx("div",{className:"demo-annotation-marker inprogress-marker",children:"3"}),o.jsxs("div",{className:"demo-annotation-content",children:[o.jsx("strong",{children:"In Progress"}),o.jsx("p",{children:"Death/Water lanes are still building up. Keep playing cards to reach the compile threshold of 10!"})]})]}),o.jsxs("div",{className:"demo-annotation topbox-annotation",children:[o.jsx("div",{className:"demo-annotation-marker topbox-marker",children:"4"}),o.jsxs("div",{className:"demo-annotation-content",children:[o.jsx("strong",{children:"Top Effect Always Visible"}),o.jsx("p",{children:"See Plague-1's top effect? It stays active even when covered! Top effects are always visible and active on face-up cards."})]})]})]})]}),o.jsxs("div",{className:"field-legend",children:[o.jsxs("div",{className:"legend-item",children:[o.jsx("div",{className:"legend-swatch legend-compiled"}),o.jsx("span",{children:"Compiled Protocol"})]}),o.jsxs("div",{className:"legend-item",children:[o.jsx("div",{className:"legend-swatch legend-compilable"}),o.jsx("span",{children:"Ready to Compile (10 value & higher than opponent)"})]}),o.jsxs("div",{className:"legend-item",children:[o.jsx("div",{className:"legend-swatch legend-facedown"}),o.jsx("span",{children:"Face-down Card (base value: 2)"})]})]})]}),o.jsxs("section",{className:"rules-section card-anatomy-section",children:[o.jsx("h2",{className:"section-title",children:"Card Anatomy"}),o.jsxs("div",{className:"card-anatomy-layout",children:[o.jsx("div",{className:"card-anatomy-display",children:o.jsxs("div",{className:"anatomy-card-wrapper",children:[o.jsx(xt,{card:Uj,isFaceUp:!0}),o.jsxs("div",{className:"anatomy-annotation annotation-protocol",children:[o.jsx("div",{className:"annotation-line annotation-line-left"}),o.jsxs("div",{className:"annotation-label",children:[o.jsx("span",{className:"annotation-letter",children:"A"}),o.jsx("span",{className:"annotation-text",children:"Protocol"})]})]}),o.jsxs("div",{className:"anatomy-annotation annotation-value",children:[o.jsx("div",{className:"annotation-line annotation-line-right"}),o.jsxs("div",{className:"annotation-label",children:[o.jsx("span",{className:"annotation-letter",children:"B"}),o.jsx("span",{className:"annotation-text",children:"Value"})]})]}),o.jsxs("div",{className:"anatomy-annotation annotation-top",children:[o.jsx("div",{className:"annotation-line annotation-line-right"}),o.jsxs("div",{className:"annotation-label",children:[o.jsx("span",{className:"annotation-letter",children:"C"}),o.jsx("span",{className:"annotation-text",children:"Top Effect"})]})]}),o.jsxs("div",{className:"anatomy-annotation annotation-middle",children:[o.jsx("div",{className:"annotation-line annotation-line-right"}),o.jsxs("div",{className:"annotation-label",children:[o.jsx("span",{className:"annotation-letter",children:"D"}),o.jsx("span",{className:"annotation-text",children:"Middle Effect"})]})]}),o.jsxs("div",{className:"anatomy-annotation annotation-bottom",children:[o.jsx("div",{className:"annotation-line annotation-line-right"}),o.jsxs("div",{className:"annotation-label",children:[o.jsx("span",{className:"annotation-letter",children:"E"}),o.jsx("span",{className:"annotation-text",children:"Bottom Effect"})]})]})]})}),o.jsxs("div",{className:"card-anatomy-descriptions",children:[o.jsxs("div",{className:"anatomy-item",children:[o.jsx("span",{className:"anatomy-letter",children:"A"}),o.jsxs("div",{className:"anatomy-desc",children:[o.jsx("strong",{children:"Protocol Indicator"}),o.jsx("p",{children:"Dictates which line a card can be played face-up in. Cards must match the protocol of that line."})]})]}),o.jsxs("div",{className:"anatomy-item",children:[o.jsx("span",{className:"anatomy-letter",children:"B"}),o.jsxs("div",{className:"anatomy-desc",children:[o.jsx("strong",{children:"Value"}),o.jsx("p",{children:"The value added to the total value of a stack. Higher values help you reach the compile threshold of 10."})]})]}),o.jsxs("div",{className:"anatomy-item anatomy-item-highlight",children:[o.jsx("span",{className:"anatomy-letter",children:"C"}),o.jsxs("div",{className:"anatomy-desc",children:[o.jsx("strong",{children:"Top Command - Persistent"}),o.jsxs("p",{children:["While this card is face-up, this passive text is ",o.jsx("span",{className:"emphasis",children:"always active"}),", even when covered by other cards."]})]})]}),o.jsxs("div",{className:"anatomy-item anatomy-item-highlight",children:[o.jsx("span",{className:"anatomy-letter",children:"D"}),o.jsxs("div",{className:"anatomy-desc",children:[o.jsx("strong",{children:"Middle Command - Immediate"}),o.jsx("p",{children:"Resolve this active text immediately when the card is played, flipped face-up, or uncovered."})]})]}),o.jsxs("div",{className:"anatomy-item anatomy-item-highlight",children:[o.jsx("span",{className:"anatomy-letter",children:"E"}),o.jsxs("div",{className:"anatomy-desc",children:[o.jsx("strong",{children:"Bottom Command - Auxiliary"}),o.jsxs("p",{children:['This passive text (often triggered effects like "Start:" or "End:") is only active when the card is ',o.jsx("span",{className:"emphasis",children:"uncovered"}),"."]})]})]})]})]})]}),o.jsxs("section",{className:"rules-section face-down-section",children:[o.jsx("h2",{className:"section-title",children:"Face-Down Cards"}),o.jsxs("div",{className:"face-down-layout",children:[o.jsx("div",{className:"face-down-card-wrapper",children:o.jsx(xt,{card:Oj,isFaceUp:!1,faceDownValue:2})}),o.jsxs("div",{className:"face-down-description",children:[o.jsxs("p",{children:["Cards can be played ",o.jsx("span",{className:"emphasis",children:"face-down"})," into any line, regardless of protocol matching."]}),o.jsxs("ul",{children:[o.jsxs("li",{children:["Face-down cards have a ",o.jsx("span",{className:"emphasis",children:"base value of 2"})]}),o.jsx("li",{children:"No effects are active while face-down"}),o.jsx("li",{children:"Can be flipped face-up by card effects"}),o.jsx("li",{children:"When flipped, the middle effect triggers"}),o.jsx("li",{children:"Some cards modify face-down values (e.g., Darkness-2)"})]})]})]})]}),o.jsxs("section",{className:"rules-section",children:[o.jsx("h2",{className:"section-title",children:"Turn Order"}),o.jsxs("div",{className:"turn-order-grid",children:[o.jsxs("div",{className:"turn-phase",children:[o.jsx("span",{className:"phase-number",children:"1"}),o.jsxs("div",{className:"phase-content",children:[o.jsx("strong",{children:"Start Phase"}),o.jsx("p",{children:'Resolve all visible "Start" effects of your face-up command cards.'})]})]}),o.jsxs("div",{className:"turn-phase",children:[o.jsx("span",{className:"phase-number",children:"2"}),o.jsxs("div",{className:"phase-content",children:[o.jsx("strong",{children:"Check Control"}),o.jsx("p",{children:"If your total value is higher than opponent's in at least 2 lines, take the control component."})]})]}),o.jsxs("div",{className:"turn-phase",children:[o.jsx("span",{className:"phase-number",children:"3"}),o.jsxs("div",{className:"phase-content",children:[o.jsx("strong",{children:"Check Compile"}),o.jsx("p",{children:"If you can compile (10+ value and higher than opponent), you must compile one protocol."})]})]}),o.jsxs("div",{className:"turn-phase",children:[o.jsx("span",{className:"phase-number",children:"4"}),o.jsxs("div",{className:"phase-content",children:[o.jsx("strong",{children:"Action"}),o.jsx("p",{children:"Play 1 card from hand OR refresh your hand (draw until you have 5 cards)."})]})]}),o.jsxs("div",{className:"turn-phase",children:[o.jsx("span",{className:"phase-number",children:"5"}),o.jsxs("div",{className:"phase-content",children:[o.jsx("strong",{children:"Check Cache"}),o.jsx("p",{children:"If you have more than 5 cards, discard down to 5."})]})]}),o.jsxs("div",{className:"turn-phase",children:[o.jsx("span",{className:"phase-number",children:"6"}),o.jsxs("div",{className:"phase-content",children:[o.jsx("strong",{children:"End Phase"}),o.jsx("p",{children:'Resolve all visible "End" effects of your face-up command cards.'})]})]})]})]}),o.jsxs("section",{className:"rules-section glossary-section",children:[o.jsx("h2",{className:"section-title",children:"Glossary"}),o.jsxs("div",{className:"glossary-grid",children:[o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Compile"}),o.jsx("p",{children:'Delete all cards in a line on both sides and flip your protocol to "Compiled".'})]}),o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Covered"}),o.jsx("p",{children:"A card with another card on top of it. Only top effects remain active."})]}),o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Uncovered"}),o.jsx("p",{children:"The topmost card in a stack, furthest from the protocol."})]}),o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Delete"}),o.jsx("p",{children:"Move a card from the field to the trash."})]}),o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Discard"}),o.jsx("p",{children:"Move a card from hand to the owner's trash."})]}),o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Flip"}),o.jsx("p",{children:"Change a card from face-down to face-up, or vice versa."})]}),o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Shift"}),o.jsx("p",{children:"Move a card to another line on the same side of the field."})]}),o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Return"}),o.jsx("p",{children:"Move a card from the field to its owner's hand."})]}),o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Reveal"}),o.jsx("p",{children:"Show hidden information publicly, then return it to its previous state."})]}),o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Refresh"}),o.jsx("p",{children:"Draw cards until you have 5 cards in hand."})]}),o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Line"}),o.jsx("p",{children:"The area passing through two opposing protocols. The field has 3 lines."})]}),o.jsxs("div",{className:"glossary-item",children:[o.jsx("strong",{children:"Stack"}),o.jsx("p",{children:"The cards in a line on one player's side."})]})]})]})]})]})}function Wj(){const[t,n]=se.useState("MainMenu"),[r,i]=se.useState([]),[s,d]=se.useState([]),[u,p]=se.useState(null),[f,h]=se.useState("easy"),[w,g]=se.useState(null),[y,m]=se.useState(!0),[x,S]=se.useState("player");se.useEffect(()=>{GE()},[]);const E=se.useCallback(()=>{n("MainMenu"),i([]),d([]),p(null),g(null)},[]);se.useEffect(()=>{const N=U=>{U.key==="Escape"&&E()};return window.addEventListener("keydown",N),()=>{window.removeEventListener("keydown",N)}},[E]);const j=se.useCallback((N,U)=>{i(N),d(U),p(null),g(null),S("player"),n("GameScreen")},[]),b=se.useCallback((N,U)=>{p(N),g(U),n("ResultsScreen")},[]),k=()=>{switch(t){case"MainMenu":return o.jsx(rm,{onNavigate:N=>n(N),difficulty:f,setDifficulty:h,useControl:y,onUseControlChange:m});case"ProtocolSelection":return o.jsx(G0,{onBack:E,onStartGame:j});case"GameScreen":return o.jsx(yj,{onBack:E,onEndGame:b,playerProtocols:r,opponentProtocols:s,difficulty:f,useControlMechanic:y,startingPlayer:x});case"ResultsScreen":return o.jsx(gj,{onPlayAgain:E,winner:u,finalState:w,difficulty:f});case"CardLibrary":return o.jsx(vj,{onBack:E});case"Statistics":return o.jsx(_j,{onBack:E});case"CustomProtocols":return o.jsx(Pj,{onBack:E});case"Rules":return o.jsx(Yj,{onBack:E});default:return o.jsx(rm,{onNavigate:N=>n(N),difficulty:f,setDifficulty:h,useControl:y,onUseControlChange:m})}};return o.jsx(o.Fragment,{children:k()})}const Qj=document.getElementById("root"),Xj=$0.createRoot(Qj);Xj.render(o.jsx(Wj,{}));
